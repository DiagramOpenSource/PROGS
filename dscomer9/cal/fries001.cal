|FICHEROS;
     agifa084 #0;  || Facturas directas
     agifa024 #6;
     agifa069 #3;
     agifa019 #2;
     agifa025 #8;

     agifa038 #13;
     agifa048 #15;
     agifa049 #16;

     agifa133 #19;
     agifa091 #20;
     agifa007 #40;
     agifa142 #41;
     agifa027 #42;
     agifa321 #35;  || Parametros de Divisas
     agifa328 #36;  || Clientes/Divisas
     agifa329 #37;  || Lineas de Clientes/Divisas
     agifa324 #38;  || Divisas
     dsm00003 #49,MANTE;
     tempo084 #50,MANTE;  || a Pagar.......
     agifa065 #165;
     agifa134 #134;
     fries003 #33;
     dsm00247 #141;
     dsm00246 #140;
|FIN;

|VARIABLES;
     nSal = 0;
     aUs = "";
     nAudito = "";
     aAlfa = "";
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     &nMasRies  = 0;
     &enDescuento2 = 0;
     &eaTComision  = "";
     &enComision = = 0;

     &eaTag         = "";
     &enHayIMEI     = 0;
     nMult          = 0;
 {-1}menu           = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";
     so             = "";
     no             = "";
     contador       = 0;
     cont           = "";

     fecha           = "          ";
     &aPrograma      = "";
     &fechae         = @;
     &SFactura       = "";
     &NFactura       = 0;
     &CFactura       = 0;
     &TAcuenta       = 0;
     &DesdeRec       = 0;
     cafe            = "";
     diafe           = "";
     dianu           = "";
     dia_venci       = "";
     mes_venci       = "";
     mes_ven         = "";
     any_venci       = "";
     fechas          = "";
     &ser_fac         = "";
     &num_fac         = 0;
     i               = 0;
     j               = 0;
     k               = 0;
     em              = 0;
     tipo_imp        = 0;
     num             = 0;
     num9            = 0;
     resto           = 0;
     redondeo        = 0;
     fecha_fac       = @;

     nModo           = 0;
     nNume           = 0;
     nForma          = 0;
     nMargen         = 0;
     nImpo           = 0;
     nDto            = 0;
     aOpera          = "";
     aArti           = "";
     &cli            = "";
     &ser            = "";
     nTecla          = 0;

     &eaCodigo       = "";
     &eaTipoCodigo   = "CL";

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     nfecha    = 0;
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     nModo084 = 0;
     &ser_alb            = "";
     &num_alb            = 0;
     valor               = "";
     &serie              = "";  ||
     &numero             = 0;  || Usadas en el subejecuta de impresion
     &reimpr             = "";  ||
     &ext1               = "";
     &dto_prom           = "N";
     &def_exp            = "N";
     nLin = 0;
     &bl                 = "                              ";
     &codigo             = "";
     &descrip            = "";
     &ascii              = 0;


     mensaje01           = "0423Actualizando linea:";
     fmes                = "  ";
     mensajei            = "2400NDesea imprimir esta factura? ";
     mensarec           = "2400NDesea dejar la factura como NO impresa y anular los recibos? ";
     informe             = "";
     informe1            = "agifa084";
     tato = 0;
     tota = 0;
     base = 0;
     vacio               = "";
     puente              = "";
     digito              = "";
     &iva1               = 0;
     &iva2               = 0;
     &iva3               = 0;
     &iva4               = 0;
     &iva5               = 0;
     &re1                = 0;
     &re2                = 0;
     &re3                = 0;
     &re4                = 0;
     &re5                = 0;
     &precio             = 0;
     &dto                = 0;
     &dto1               = 0;
     &unid               = 0;
     &imptot             = 0;
     &tiva               = 0;
     &linea              = 0;
     &n_pre              = 0;
     &def_alm            = 0;
     &n_dec              = 0;

     imneto              = 0;
     tf                  = 0;
     retencion           = 0;
     con                 = 0;
     margen              = 0;
     indtope             = 0;
     ind                 = 0;
     control             = 0;
     mes                 = 0;
     modo                = 0;
     iva_ant             = 0;
     contenido           = 0;
     importe             = 0;
     bloqueo = "0000Cliente Bloqueado en Riesgos !!";

    base0 = 0;
    base1 = 0;
    base2 = 0;
    base3 = 0;
    base4 = 0;
    base5 = 0;
    caltot = 0;
    recalpre = 0;
    nEuro = 0;
    aEuro = "";
    nImpDiv = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;


|INCLUYE i_varart;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO letranif2;
     nSal = FSalida;

     |ABRE #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |CIERRA #6;
     eaPais = #6#205;

     |SI nSal = 10;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;
     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Promo084_7; |TIPO 7;
     |SI #41#129 = "S";
          |C_M #0#79, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Promo084_0; |TIPO 0;
|FPRC;

|CALCULO bajarec;|TIPO 2;
     |ABRE #41; |LEE 000#41p; |CIERRA #41;
     |HAZ ControlUsuFT;
     |SI enErr ! 0; |ERROR; |ACABA; |FINSI;

     nForma = nForma +. 1;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 3;
          |SI modo = 3;
               eaSer = #0#48;
               enDocu = #0#0;
               efFec = #0#1;
               |HAZ MiraHisF;
               |SI enErrHis ! 0;
                    |ERROR;
                    |ACABA;
               |FINSI;
          |FINSI;
          |SI #0#39 = "S";
               |AVISO;
               |CONFI "0000NEsta Factura Esta Contabilizada: Desea Continuar? ";
               |SI FSalida ! 0;
                    |ERROR;
                    |ACABA;
               |FINSI;
          |FINSI;
          |SI #41#47 = "S";
               |HAZ borrarec;
          |FINSI;
          |HAZ borravenci;
     |FINSI;
     |HAZ fcaccli;
     |SI nForma = -1;
          ||컴컴컴컴컴컴컴컴컴컴컴Modlo '000car'  Y el de friesa
          |HAZ EsCarnicas;
          |SI FSalida = 0;
               |HAZ BajaCarnicasFD;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴
     |FINSI;
|FCAL;

|CALCULO crec;   |TIPO 7;
     |ABRE #41; |LEE 000#41p; |CIERRA #41;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 2; |Y #41#47 = "S"; |Y #0#10 = "S";
       |AVISO;
       |CONFI mensarec;
       |SI FSalida = 0;
          #0#10 = "N";
          |PINTA #0#10;
          |HAZ borrarec;
          |HAZ borravenci;
       |SINO;
          |PTEC 807;
          |ERROR;
          |ACABA;
       |FINSI;
     |FINSI;
|FCAL;

|CALCULO fecfc;|TIPO 7;
modo = (FEntrada / 100) ! 0;
|SI modo = 2;
  |CAMPO_MODIFICA #0#1 , 1 , "N";
|SINO;
  |CAMPO_MODIFICA #0#1 , 1 , "S";
|FINSI;
|FCAL;

|PROCESO ActArti;
     fmes = #0#1 % A402;
     mes = fmes - 1;
     mes = mes * 5;
     mes = mes + 35;
     #2#0 = #3#2;
     |LEE 101#2=;
     |SI FSalida = 0;
          |SI #2#194 = 2;
               nImpo = ((((#3#30 * #3#6) < #3#8) < #3#21) < #0#5) < #0#32;
          |SINO;
               nImpo = ((((#3#5 * #3#6) < #3#8) < #3#21) < #0#5) < #0#32;
          |FINSI;
          |SI #41#115 = "S";
               nImpo = nImpo < #0#7;
          |FINSI;
          nMargen = nImpo - #3#14;
          #2mes = #2mes + (nImpo * nForma);
          #2#95 = #2#95 + (nImpo * nForma);
          mes = mes + 1;
          #2mes = #2mes + (nMargen * nForma);
          #2#96 = #2#96 + (nMargen * nForma);
          |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
|FPRC;

|CALCULO fcaccli;
     nForma = 0 +. 1;
     modo = (FEntrada / 100) ! 0;

     |SI control = 1; |Y nForma = 1;
          |HAZ Totaliza;
     |FINSI;
     |ABRE #6;
     #6#0 = #0#3;
     |LEE 121#6=;
     |SI 0 = FSalida;
          fmes = #0#1 % A402;
          mes = fmes - 1;
          mes = mes * 4;
          mes = mes + 54;
          imneto = #0#15 - #0#25;
          |SI #41#115 = "N";
               nImpo = (imneto * 100) / (100 - #0#7);
               nDto = #0#25 + (imneto - nImpo);
          |SINO;
               nImpo = imneto;
               nDto = #0#25;
          |FINSI;
          #6mes = #6mes +. nImpo; || imneto;
          mes = mes + 1;
          #6mes = #6mes +. nDto;  || #0#25;
          mes = mes + 1;
          #6mes = #6mes +. #0#37;
          #6#102 = #6#102 +. nImpo; || imneto;
          #6#103 = #6#103 +. nDto;  || #0#25;
          #6#104 = #6#104 +. #0#37;
          mes = FEntrada / 100;
          mes = mes ! 0;
          |SI 1 = mes;
               #6#45 = #0#1;
               #6#46 = imneto;
          |FINSI;
          #6#110 = #6#110 +. imneto;
          imneto = imneto + #0#24;
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;
     |CIERRA #6;

     |ABRE #8;
     #8#0 = #0#6;
     |LEE 121#8=;
     |SI 0 = FSalida;
           imneto = #0#15 - #0#25;
           fmes = #0#1 % A402;
           mes = fmes - 1;
           mes = mes * 2;
           mes = mes + 11;
           #8mes = #8mes +. #0#26;
           retencion = #8mes % #8#39;
           mes = mes + 1;
           #8mes = #8mes +. imneto;
           #8#35 = #8#35 +. #0#26;
           #8#36 = #8#36 +. imneto;
           mes = fmes - 1;
           mes = mes + 40;
           #8mes = retencion;
           retencion = #8#35 % #8#39;
           #8#52 = retencion;
           |GRABA 020#8a;
           |LIBERA #8;
     |FINSI;
     |CIERRA #8;
     |ABRE #2;
     |BUCLELIN 2 ActArti #0;
     |CIERRA #2;
     |SI #41#47 = "S";  ||컴컴컴컴컴 Acumula en riesgos Si Crea Recibo
          eaTag = "FC";  |HAZ Riesgos;
     |FINSI;
|FCAL;

|CALCULO cogecon0;|TIPO 0;
     control = 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #41#26 = "S"; |Y nModo = 1;   || Fac Directa = Fact. Venta
          |ABRE #134;
          #134#49 = #0#48;
          #134#0 = #0#0;
          |LEE 101#134=;
          |SI FSalida = 0;
               |MENAV "0000Numero facutra existente en Facturas Venta...";
               |ERROR;
          |FINSI;
          |CIERRA #134;
     |FINSI;
|FCAL;

|CALCULO pedcon0;|TIPO 6;
con = FEntrada / 100;
con = con ! 0;
|SI con = 2;|Y #0Campo ! Contenido;
  control = 1;
|FINSI;
|FCAL;

|| **********************************************************
|CALCULO acttl;|TIPO 0;
     |SI caltot = 0;
          |PINTA 445,#3#1;
          #3#15 = #0#3;
          #3#16 = #0#34;
          #3#17 = #0#35;
          |GRABA 020#3a;
          |LIBERA #3;
     |SINO;
          |SI recalpre = 1;
               |HAZ TotalLin69;
               |GRABA 001#3a;
          |FINSI;
     |FINSI;

     ||-----------------------------Calcula la Cabecera
     |HAZ CalCabAgifa084;

     ||-----------------------------Modifi His
     |HAZ ModiHistoFC;
|FCAL;

|CALCULO leepago;|TIPO 0;
     |ABRE #20;
     #20#0 = #0#8;
     |LEE 020#20=;
     |CIERRA #20;
|FCAL;

|CALCULO cambios;
     fecha = fechae;
     cafe = fecha;
     diafe = fecha % A102;
     dianu = diafe;
|FCAL;

|CALCULO fijos;
     |SI #6#22 = 0;
          |VETE finfijos;
     |FINSI;
     |HAZ cambios;
     |SI dianu > #6#22;
          |VETE  fijos2;
     |FINSI;
     |ET fijos1;
     |SI dianu = #6#22;
          |VETE finfijos;
     |FINSI;
     fechae = fechae +1;
     |HAZ cambios;
     |VETE fijos1;
     |ET fijos2;
     |SI #6#23 = 0; |O dianu [ #6#22;
      |VETE fijos1;
 |FINSI;
 |SI dianu > #6#23;
     |VETE fijos3;
 |FINSI;
 |SI dianu = #6#23;
     |VETE finfijos;
 |FINSI;
 fechae = fechae + 1;
 |HAZ cambios;
 |VETE fijos2;
|ET fijos3;
 |SI #6#24 = 0;|O dianu > #6#24; |O dianu [ #6#22; |O dianu [ #6#23;
     |VETE fijos1;
 |FINSI;
 |SI dianu = #6#24;
     |VETE finfijos;
 |FINSI;
 fechae = fechae +1;
 |HAZ cambios;
 |VETE fijos3;
|ET finfijos;
 fecha = fechae;
|FCAL;

|PROCESO vencical;
     j = #20k / em;
     |SI j ! 0; |O #6#22 ! 0; |O #6#23 ! 0; |O #6#24 ! 0;
          fechae = fecha_fac + j;
          |HAZ fijos;
          mes_venci = fechae % 402;
          mes_ven = mes_venci;
          |SI mes_ven = #6#21;          ||Si es mes de no pago...
               fechae = fechae + .001;
               fecha = fechae;
          |FINSI;
          #19#3 = fecha;
          #19#2 = importe * tipo_imp;
          |SI i = num; #19#2 = #19#2 + (resto * tipo_imp); |FINSI;
     |SINO;
          #19#2 = importe * tipo_imp;
          #19#3 = #0#1;
     |FINSI;
     #19#2 = #19#2 / nEuro;
|FPRC;

|CALCULO calvenci;|TIPO 0;
     |HAZ borravenci;
     DesdeRec = 0;
     |HAZ leepago;
     num = #20#3;
     num9 = #20#3;
     importe = (#0#41 - #0#63) ! nDeci_Base;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI importe < 0;
          tipo_imp = -1;
          importe = -importe;
     |SINO;
          tipo_imp = 1;
     |FINSI;
     aEuro = "0" * nDeci_Base;
     aEuro = "1" + aEuro;
     nEuro = aEuro;
     importe = (importe * nEuro) ! 0;

     resto = importe $ num;
     importe = importe / num;

     redondeo = importe ! 0;
     |SI redondeo ! importe;                 || trunca importe
          |SI redondeo > importe;
               importe = redondeo - 1;
          |SINO;
               importe = redondeo;
          |FINSI;
     |FINSI;

     |ABRE #19;
     |SI #20#5 = "N";
          em = 1;
     |SINO;
          em = 1000;
     |FINSI;
     fecha_fac = #0#1;
     DesdeRec  = DesdeRec + 1;
     |SI DesdeRec ! 1; num9 = (DesdeRec + num) - 1; |FINSI;
     k = 5;
     |PARA i = DesdeRec; |SI i [ num9; |HACIENDO i = i + 1;
          k = k + 1;
          |DDEFECTO #19;
          #19#4 = #0#48; ||serie
          #19#0 = #0#0;||numero factura;
          #19#1 = i;   ||numero linea;
          |LEE 101#19=;
          |SI FSalida ! 0;
               |GRABA 021#19b;
          |FINSI;
          |HAZ vencical;
          |GRABA 021#19a;
          |LIBERA #19;
     |SIGUE;
     |CIERRA #19;
|FCAL;

|DEFBUCLE agifa069;
     #3#1;
     ;
     #0#48, #0#0, 001;
     #0#48, #0#0, 999;
     ;
     NULL, acttl;
|FIN;

|CALCULO Totaliza;
    |SI caltot = 0;
         |MENSA mensaje01;
    |FINSI;

    |HAZ LimCabAgifa084;
    |BUCLE agifa069;

    |SI caltot = 0;
        |BLIN 4;
    |FINSI;
|FCAL;

|CALCULO Final84;|TIPO 3;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴 ||Modulo '000car' y el de friesa
     |HAZ EsCarnicas;
     |SI FSalida = 0;
          |HAZ AltaCarnicasFD;
          |HAZ Totaliza;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴
|FCAL;

|| ********************************************************

|CALCULO siimpre; |TIPO 30;
     |SI #41#47 = "S";
          |HAZ calvenci;
          |SI #agifa142#2 = "S";
                |GRABA 021#agifa084.a;
                |LIBERA #agifa084;
                ser_fac = #agifa084#48;
                num_fac = #agifa084#0;
                |CIERRAT #agifa084;
                |MODULO aPrograma;
                |SUB_EJECUTA_NP "agifa133.run";
                |ABRET #agifa084;
                #agifa084#48 = ser_fac;
                #agifa084#0 = num_fac;
                |LEE 101#agifa084.=;
          |FINSI;
     |FINSI;
     |SI #41#116 = "S";
          nNume = 0;
          |SI #0#16 ! 0; nNume = nNume + 1; |FINSI;
          |SI #0#19 ! 0; nNume = nNume + 1; |FINSI;
          |SI #0#22 ! 0; nNume = nNume + 1; |FINSI;
          |SI #0#42 ! 0; nNume = nNume + 1; |FINSI;
          |SI #0#45 ! 0; nNume = nNume + 1; |FINSI;
          |SI nNume = 1;
               |HAZ apagar;
          |FINSI;
     |FINSI;
     |CONFI mensajei;
     |SI 0 = FSalida;
          |HAZ impreal;
     |FINSI;
|FCAL;

|CALCULO impreal;|TIPO 4;
     nModo = (FEntrada/ 100) ! 0;
     |SI nModo [ 2;
          |GRABA 020#0a;
          |LIBERA #0;
     |FINSI;
     |CIERRAT #0;
     serie = #0#48;
     numero = #0#0;
     reimpr = #0#10;
     |SUB_EJECUTA_NP "agifa086";
     |ABRET #0;
     |LEE 000#0=;
|FCAL;

|CALCULO actutot;|TIPO 0;
   #0#41 = #0#15 - #0#25;
   #0#41 = #0#41 + #0#11;
   #0#41 = #0#41 + #0#13;
   #0#41 = #0#41 + #0#24;
   |PINTA  #0#41;
|FCAL;

|PROCESO ParGer; |TIPO 0;
     |ABRE #41; |LEE 000#41p; |CIERRA #41;

     n_dec = #41#8;
     n_pre = #41#9;
     dto_prom = #41#18;
     |SI #41#47 = "S";
      ||    |C_M #0#8, 1, "S";
     |SINO;
      ||    |C_M #0#8, 1, "N";
     |FINSI;
     |ABRE #agifa007;
     #agifa007#26 = #agifa084#48;
     |LEE 001#agifa007.=;
     |SI FSalida ! 0; |DDEFECTO #agifa007; |FINSI;
     |CIERRA #agifa007;
     def_alm = #agifa007#29;
     def_exp = #agifa007#30;
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
|FPRC;

|PROCESO Tipo84_0; |TIPO 0;
     |HAZ mira_obs;
     |HAZ mira_riesgo;
     |HAZ CamDiv;
|FPRC;

|PROCESO mira_obs;
     |SI #agifa142#14 = "S";
          puente = #agifa024#53;     |QBF puente;
          |SI puente ! "";
               |PUSHV 1008 1370;
               |SI #agifa142#20 = "S"; |AVISO; |FINSI;
               |BLANCO 1009 1369;
               |CUADRO 1008 1370;
               |ATRI R;
               |PINTA 1110 , #agifa024#53;
               |ATRI 0;
               |PAUSA;
               |POPV;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO mira_riesgo;
     |SI aRieBloqu = "S";
          aAlfa = "    Riesgo bloqueado. Referencia : " + aBloquead;
          |MENAV aAlfa;
          |ERROR; nError6 = 1;
          |ACABA;
     |FINSI;
     |SI #agifa142#6 = "S";
          |SI nRieTotal ! 0;
               |PUSHV 0501 2380;
               |BLANCO 0948 1672;
               |CUADRO 1148 1672;
               |CUADRO 0948 1672;
               |ATRI R; |PINTA 1049, "  < CONTROL RIESGOS >  "; |ATRI 0;
               |ATRI I;
               |PINTA 1250, "Concedido:";
               |PINTA 1350, "Total ...:";
               |PINTA 1261, nRieTotal;
               |PINTA 1361, nRieUtili;
               |ATRI 0;
               |PAUSA;
               |POPV;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO borrarec;
/*
     |ABRE #17;
     #17#17 = #0#48;     ||Serie Facturas
     #17#0 = #0#0;
     #17#1 = 1;
     |LEE 001#17=;
     |PARA ; |SI FSalida = 0; |Y #17#0 = #0#0; |Y #17#17 = #0#48; |HACIENDO ;
          |BORRA 020#17a;
          |LEE 001#17s;
     |SIGUE;
     |CIERRA #17;

     |ABRE #18;          ||Borro los recibos parciales
     #18#0 = #0#48;
     #18#1 = #0#0;
     #18#2 = 0;
     #18#3 = 0;
     |LEE 001#18];
     |PARA ; |SI FSalida = 0; |Y #18#0 = #0#48; |Y #18#1 = #0#0; |HACIENDO;
          |BORRA 001#18a;
          |LEE 001#18s;
     |SIGUE;
     |CIERRA #18;
*/
|FPRC;

|PROCESO borravenci;
     |ABRE #19;
     #19#4 = #0#48;
     #19#0 = #0#0;
     #19#1 = 0;
     |LEE 001#19];
     |PARA ; |SI FSalida = 0; |Y #19#0 = #0#0; |Y #19#4 = #0#48; |HACIENDO;
          |BORRA 021#19a;
          |LEE 001#19s;
     |SIGUE;
     |LIBERA #19;
     |CIERRA #19;
|FPRC;

|PROCESO LeeMonBase; ||Lee los parametros de la moneda base
|ABRE #agifa321;
|ABRE #agifa324;
|LEE 010#agifa321.p;   ||Leo parametros de divisa
#agifa084#68 = #agifa321#9;  ||Cojo la Moneda Base de parametros
#agifa324#0 = #agifa321#9;
|LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
#agifa084#69 = #agifa324#2;  ||Asigno el cambio de la moneda base con el euro
decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
|CIERRA #agifa324;
|CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     |ABRE #agifa324;
     pintado = 0;  ||Controla pintados de las lineas
     #agifa324#0 = #agifa084#65;
     |LEE 001#agifa324.=;   || Leo la divisa
     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |SI #0#67 = "B";   || Si trabajo con la moneda base ...
       nDeci_PreVis   = precio_divisa;
       nDeci_ImpVis   = decim_divisa;
       nDeci_Base     = decim_base;
       nDeci_PreBase  = precio_base;
       nDeci_BaseMx  = decim_base;
       nDeci_PreBaseMx = precio_base;
       nDeci_TotVis   = decim_base;
       nDeci_TotNoVis = decim_divisa;
     |SINO;     || Si trabajo con la divisa ...
       nDeci_PreVis   = precio_base;
       nDeci_ImpVis   = decim_base;
       nDeci_Base     = decim_base; || Max. precision en los decimales de la moneda base
       nDeci_PreBase  = precio_base;  || Max. precision en los dec. del precio de la moneda base
       |SI #0#66 = 1;
            nDeci_BaseMx    = decim_base;    || sin triangulacion
            nDeci_PreBaseMx = precio_base;
       |SINO;
            nDeci_BaseMx    = 5;             || con triangulacion
            nDeci_PreBaseMx = 5;
       |FINSI;
       nDeci_TotVis   = decim_divisa;
       nDeci_TotNoVis = decim_base;
     |FINSI;
     |CIERRA #agifa324;
     |HAZ Deci_IVA;
|FPRC;

|PROCESO LeeParamDiv; |TIPO 0;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;    || Leo parametros de divisas
     |ABRE #agifa007;
     #agifa007#26 = #agifa084#48;
     |LEE 001#agifa007.=;        || Leo la serie
     |SI #0#67 = "D";      || Si la mon. de trabajo es la divisa...
       || ...escondo los campos de la moneda base :
       |CAMPO_POSICION #3#6 , 1 , 1009;
       |CAMPO_POSICION #3#9 , 1 ,1026;
       |CAMPO_VISUAL #3#6 , 1 , "N";
       |CAMPO_VISUAL #3#9 , 1 , "N";
       |CAMPO_LINEAL #3#6 , 1 , "N";
       |CAMPO_LINEAL #3#9 , 1 , "N";
       |CAMPO_MODIFICA #3#6 , 1 , "N";
       || ...y pongo en pantalla los de divisa
       |CAMPO_POSICION #3#26 , 1 , 1544;
       |CAMPO_POSICION #3#27 , 1 ,1568;
       |CAMPO_VISUAL #3#26 , 1 , "S";
       |CAMPO_VISUAL #3#27 , 1 , "S";
       |CAMPO_MODIFICA #3#26 , 1 , "S";
       |CAMPO_LINEAL #3#26 , 1 , "S";
       |CAMPO_LINEAL #3#27 , 1 , "S";
       |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; ||Si la serie es de ...
          ac_divisa = "S";  || ... divisas, y en parametros estan activadas ...
          || ... pongo como modificables los campos relacionados con divisas
          || |CAMPO_MODIFICA #0#65 , 1 , "S";
          || |CAMPO_MODIFICA #0#66 , 1 , "S";
          || |CAMPO_MODIFICA #0#67 , 1 , "S";
          |SI #agifa321#3 = "S";  || Si la visualizacion de parametros esta activada
            || ... pongo los campos visual. de lineas como visualizables
            |CAMPO_VISUAL #3#28, 1 , "S";
            |CAMPO_VISUAL #3#29 , 1 , "S";
          |SINO;
            || ... los pongo como no visualizables
            |CAMPO_VISUAL #3#28 , 1 , "N";
            |CAMPO_VISUAL #3#29 , 1 , "N";
          |FINSI;
       |SINO; || Si la serie no es de divisas, o no estan activados parametros
          ac_divisa = "N";
          #0#67 = "B";  || La moneda de trabajo es por fuerza la moneda base
          |PINTA #0#67;
          || Pongo como no modificables los campos relacionados con divisas
          || |CAMPO_MODIFICA #0#67 , 1 , "N";
          || |CAMPO_MODIFICA #0#65 , 1 , "N";
          || |CAMPO_MODIFICA #0#66 , 1 , "N";
          || Pongo como no visualizables los campos visual. de lineas
          |CAMPO_VISUAL #3#28, 1 , "N";
          |CAMPO_VISUAL #3#29, 1 , "N";
       |FINSI;
     |SINO;  || Si la moneda de trabajo es la moneda base
       || ...escondo los campos en divisa :
       |CAMPO_POSICION #3#26 , 1 , 1009;
       |CAMPO_POSICION #3#27 , 1 ,1026;
       |CAMPO_VISUAL #3#26 , 1 , "N";
       |CAMPO_VISUAL #3#27 , 1 , "N";
       |CAMPO_MODIFICA #3#26 , 1 , "N";
       |CAMPO_LINEAL #3#26 , 1 , "N";
       |CAMPO_LINEAL #3#27 , 1 , "N";

       || ...coloco los campos en moneda base:
       |CAMPO_POSICION #3#6 , 1 , 1544;
       |CAMPO_POSICION #3#9 , 1 ,1568;
       |CAMPO_VISUAL #3#6 , 1 , "S";
       |CAMPO_VISUAL #3#9 , 1 , "S";
       |CAMPO_MODIFICA #3#6 , 1 , "S";
       |CAMPO_LINEAL #3#6 , 1 , "S";
       |CAMPO_LINEAL #3#9 , 1 , "S";
       |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; || Si la serie es de divisas...
          ac_divisa = "S"; || ... y divisas estan activadas en parametros
          || Pongo como modificables los campos relacionados con divisas
          || |CAMPO_MODIFICA #0#65 , 1 , "S";
          || |CAMPO_MODIFICA #0#66 , 1 , "S";
          || |CAMPO_MODIFICA #0#67 , 1 , "S";
          |SI #agifa321#3 = "S";  || Si la visualizacion esta activada en parametros ...
            || Pongo como visualizables los campos visual. de las lineas
            |CAMPO_VISUAL #3#28, 1 , "S";
            |CAMPO_VISUAL #3#29 , 1 , "S";
          |SINO; || Los pongo como no visualizables
            |CAMPO_VISUAL #3#28 , 1 , "N";
            |CAMPO_VISUAL #3#29 , 1 , "N";
          |FINSI;
       |SINO;  || Si la serie no es de divisas o no estan activados los parametros
          ac_divisa = "N";
          #0#67 = "B";  || La moneda de trabajo es por fuerza la moneda base
          || Pongo como no modificables los campos relacionados con divisas
          || |CAMPO_MODIFICA #0#67 , 1 , "N";
          || |CAMPO_MODIFICA #0#65 , 1 , "N";
          || |CAMPO_MODIFICA #0#66 , 1 , "N";
          || Pongo como no visualizables los campos visual. de lineas
          |CAMPO_VISUAL #3#28, 1 , "N";
          |CAMPO_VISUAL #3#29, 1 , "N";
       |FINSI;
     |FINSI;
     |CIERRA #agifa007;
|CIERRA #agifa321;
|HAZ Param_Divisas;
|FPRC;

|PROCESO CamDiv; |TIPO 0;
     nModo084 = (FEntrada / 100) ! 0;
     |SI nModo084 = 1;   ||Si cambia el valor o es alta
          |SI Campo = 3; || Si llamo al proceso desde el cod. de cliente ...
               |ABRE #agifa024;
               #agifa024#0 = #0#3;
               |LEE 020#agifa024.=;
               |CIERRA #agifa024;
               #0#36 = #agifa024#47;   || Regimen Equi.
               #0#65 = #agifa024#192;  || Asigno la divisa por defecto del cliente
               #0#67 = #agifa024#193;  || Asigno la moneda de trabajo del cliente
               |PINTA #0#67;
          |FINSI;
          |ABRE #agifa007;
          #agifa007#26 = #agifa084#48;
          |LEE 020#agifa007.=;  || Leo la serie
          |CIERRA #agifa007;
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S";
               |SI #agifa024#191 = "S"; || Si el cliente es de divisa pactada
                    |ABRE #agifa328;
                    |ABRE #agifa329;
                    #agifa329#0 = #agifa084#3;
                    #agifa329#2 = #agifa084#65;
                    #agifa329#7 = "N";
                    |SELECT #2#agifa329;  || Con esta clave ...
                    |LEE 011#agifa329.=;  || ... busco periodos no finalizados de esa divisa
                    |SI FSalida = 0;  || Si existe un periodo no finalizado
                         |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                              #agifa084#65 = #agifa329#2;        || Cargo la divisa ...
                              #agifa084#66 = #agifa329#3;        || ...y el cambio
                              |LEE 001#agifa329.=;   || Leo las lineas de Clientes/Divisas
                              nfecha = #agifa084#1 - #agifa329#6;  || Resto la fecha de fin de periodo a la actual
                              |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                                   |MENAV "0000ATENCION deberia Actualizar primero la divisa en Clientes/Divisas";
                                   cli_divisa = #agifa084#3;  || Le envio el cod. de cliente a "agifa328"
                                   |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientess/Divisas
                                   |ERROR;
                              |SINO;
                                   div_act = 1;  || Para salir del PARA
                              |FINSI;
                         |SIGUE;
                    |SINO;  || Si no existe un periodo no finalizado para esa divisa
                         |MENAV "0000No existe un periodo activo para la divisa en Clientes / Divisas";
                         cli_divisa = #agifa084#3;  || Le paso a "agifa328" el cliente
                         |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes / Divisas
                         |ERROR;
                    |FINSI;
                    |SELECT #1#agifa329;
                    |CIERRA #agifa329;
                    |CIERRA #agifa328;
               |SINO; || Si el Cliente no es de Divisa pactada ...
                    |ABRE #agifa324; || ...miro  directamente en divisas
                    #agifa324#0 = #agifa084#65;
                    |LEE 001#agifa324.=;
                    |SI FSalida = 0; ||Si existe la divisa...
                         #agifa084#66 = #agifa324#2; || la recojo
                         |SI #agifa324#5 ! -1; || Si los dias de margen de actualizacion no
                                           || son = -1 (indefinidos)
                              |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                                   #agifa084#65 = #agifa324#0;        ||Cargo el valor de la divisa
                                   #agifa084#66 = #agifa324#2;        ||Cargo el valor del cambio
                                   |LEE 001#agifa324.=;  || Leo la divisa
                                   nfecha = #agifa084#1 - #agifa324#4;
                                   |SI nfecha > #agifa324#5; |Y #agifa324#5 ! -1;  || Si la fecha actual
                                        |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                                        divisa = #agifa084#65;
                                        |SUB_EJECUTA_NP "agifa326.tab";
                                        |ERROR;
                                   |SINO;
                                        div_act = 1;
                                   |FINSI;
                              |SIGUE;
                         |FINSI;
                    |FINSI;
                    |CIERRA #agifa324;
               |FINSI;
          |SINO;
               #agifa084#65 = #agifa084#68;
               #agifa084#66 = #agifa084#69;
         |FINSI;
         |PINTA #agifa084#65;
         |PINTA #agifa084#66;
         |SI Campo = 3; || Si llamo al proceso desde el cod. de cliente ...
               |HAZ LeeParamDiv;
         |SINO;
              |HAZ Param_Divisas;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO convportes; |TIPO 6;  || Convierte los portes a la mon. base
|SI #0#67 = "B";  || Si la moneda de trabajo es la moneda base ...
  #0#11 = #0#76;  || ... basta con asignarlo
|SINO;    || Si la moneda de trabajo es la divisa
  #0#11 = #0#76 / #0#66 * #0#69;   || ... lo convierto
|FINSI;
|FPRC;

|PROCESO convvarios; |TIPO 6;  || Convierte los varios a la mon. base
|SI #0#67 = "B";  || Si la moneda de trabajo es la moneda base ...
  #0#13 = #0#77;  || ... basta con asignarlo
|SINO;    || Si la moneda de trabajo es la divisa ...
  #0#13 = #0#77 / #0#66 * #0#69;  || ... lo convierto
|FINSI;
|FPRC;


|PROCESO LeeFac; |TIPO 13;  || Sirve para cargar los valores cada vez que
                            || cambio de ficha
pintado = 0;   || controla pintado de las lineas
|HAZ LeeMonBase;
|HAZ LeeParamDiv;
|FPRC;

|CALCULO modomod; |TIPO 6;
   |SI nModo084 = 2; |Y #0Campo ! Contenido;
       |MENAV "0000No se puede modificar el campo.";
       #0Campo = Contenido;
       |PINTA #0Campo;
       |ERROR;
   |FINSI;
   |SI #0Campo ! Contenido; |Y Campo = 67;
     |HAZ LeeParamDiv;
   |FINSI;
|FCAL;

|PROCESO caltotal; |TIPO 0; ||Proceso especial para casos determinados como
                            ||modificar los campos de cabecera en dtos, cambio divisas etc
                            ||Recalcula total factura cont., descuentos y ivas de lineas
                            ||En el caso de cambiar el cambio de divisas recalcula tambien precio... de lineas
     |SI #0Campo ! Contenido;||Solo si cambia
          caltot = 1;
          |SI Campo = 66; ||Si viene del cambio divisa
              recalpre = 1; ||Recalcular tambien precios linea
          |FINSI;
          |HAZ convportes;
          |HAZ convvarios;
          |HAZ Totaliza;
          |PINTA #0#73;
          caltot = 0;
          recalpre = 0;
     |FINSI;
|FPRC;


|PROCESO LeeDesde; |TIPO 7;
     |HAZ ControlUsuFT;
     |SI enErr ! 0; |PTEC 807; |ACABA; |FINSI;

     |SI num_alb ! "";
        #0#48 = ser_alb;
        #0#0 = num_alb;
        |PTEC 802;
        |PTEC 802;
        |PINTA #0#48;
        |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO linf;
  #49#0 = #0#3;
  #49#1 = 1;
|FPRC;

|PROCESO lsup;
  #49#0 = #0#3;
  #49#1 = 999;
|FPRC;

|PROCESO Extra; |TIPO 6;
     nTecla = FSalida;
     |SI nTecla = 13;
          modo = (FEntrada / 100) ! 0;
          |SI modo = 4;
               |ABRE #6;
               #6#0 = #0#3;
               |LEE 001#6=;
               |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
               |CIERRA #6;
          |FINSI;
          |PUSHV 0501 2380;
          ext1 = #6#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO ModiLinFac;
     #3#15 = #0#3;
     #3#16 = #0#34;
     #3#17 = #6#4
     enDescuento2 = #3#21;
     eaTComision  = #3#16;
     eaCliente    = #0#3;
     eaArticulo   = #3#2;
     eaRepre      = #0#6;
     |HAZ Comisiones;
     #3#10 = enComision;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|PROCESO Dir; |TIPO 0;  ||Direccion de entrega
     nModo084 = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |ABRE #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |CIERRA #6;

     |SI Campo ! Contenido;
          #0#6 = #6#25;
          #0#34 = #6#7;
          |SI nModo084 = 2;
               |BUCLELIN 2ModiLinFac#0;
          |FINSI;
     |FINSI;
     |SI #0#3 ! Contenido; |O nTecla = 10;
        |ABRE #49;
        #49#0 = #0#3;
        #49#1 = 1;
        |LEE 101#49=;
        |SI FSalida = 0;
           |LEE 101#49s;
           |SI FSalida = 0;
              |SI #49#0 = #0#3; ||El cliente tiene mas de una direccion de entrega
                 |CONSULTA_F_CLAVE #1#49,linf,lsup;
                 |SI FSalida ] 0;
                    #0#4 = #49#10; |PINTA #0#4;
                    #0#29 = #49#10;|PINTA #0#29;
                    #0#30 = #49#2; |PINTA #0#30;
                    #0#31 = #49#3; |PINTA #0#31;
                    #0#33 = #49#7; |PINTA #0#33;
                    #0#64 = #49#6; |PINTA #0#62;
                    |SI #49#14 = "  ";
                        #0#6 = #6#25;
                    |SINO;
                        #0#6 = #49#14;
                    |FINSI;
                    |PINTA #0#6;
                 |FINSI;
              |FINSI;
           |FINSI;
       |FINSI;
       |CIERRA #49;
     |FINSI;

     |SI nTecla = 11;  |O #41#102 = "S";
         eaCodigo = #0#3;
         |SUB_EJECUTA_NP "dsz99994";
         |SI #41#102 = "N"; |Y nModo084 ! 2; |ERROR;  |FINSI;
     |FINSI;

     |ABRE #6;
     |DDEFECTO #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |SI FSalida ! 0;
          |SI #41#1 = "S";
                |HAZ Menus;
          |FINSI;
     |FINSI;
     |CIERRA #6;
|FPRC;

|PROCESO Menus;
     |MENU menu;
     |SI FSalida = 1;    ||Automatico
          |ABRE #42;
          #42#2 = "";
          #42#0 = "clientes";
          |LEE 101#42=;
          |SI FSalida = 0;
               #42#1 = #42#1 + 1;
               contador = #42#1;
               |GRABA 021#42a;
          |SINO;
               contador = 1;
               #42#1 = 1;
               |GRABA 021#42n;
          |FINSI;
          cont = contador;
          cont = ("000000" + cont) % -106;
          #0Campo = cont;
          |PINTA #0Campo;
          |LIBERA #42;
          |CIERRA #42;
     |FINSI;
|FPRC;


|PROCESO apagar;
               || solo si hay un tipo de iva
               || y esta parametrizado
     |PUSHV 0501 2380;
     #50#0 = #0#73;
     #50#1 = #0#73;
     #50#2 = #50#0 - #50#1;
     |PINPA #0#50;
     |PINDA #0#50;
     |ENDATOS #1#50;
     |SI FSalida = 0;
          |SI #50#2 ! 0;
               |HAZ Recalcula;
          |FINSI;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO dif;
    #50#2 = #50#0 - #50#1;
    |PINTA #50#2;
|FPRC;

|PROCESO dif2;
    #50#1 = #50#0 - #50#2;
    |PINTA #50#1;
|FPRC;

|PROCESO Recalcula;
     |SI #0#16 ! 0; tato = #0#50 + 100; |FINSI;
     |SI #0#19 ! 0; tato = #0#52 + 100; |FINSI;
     |SI #0#22 ! 0; tato = #0#54 + 100; |FINSI;
     |SI #0#42 ! 0; tato = #0#56 + 100; |FINSI;
     |SI #0#45 ! 0; tato = #0#58 + 100; |FINSI;
     tota  = (#50#1 * 100) / tato;
     base  = #0#15 - tota;
     tato  = (base / #0#15) * 100;
     #0#7 = tato;
     |HAZ caltotal;
     |GRABA 020#0a;
|FPRC;

|PROCESO Matricula66; |TIPO 66;
|FPRC;

|PROCESO Matricula0; |TIPO 0;
|FPRC;

|PROCESO sacaser;  |TIPO 7;
     |ABRE #33;
     #33#0 = 1;
     |LEE 101#33=;
     |SI FSalida = 0;
          #0#48 = #33#1;
          |PINTA #0#48;
     |FINSI;
     |CIERRA #33;
|FPRC;

|PROCESO Cliente84_0;
     |HAZ CamDiv;

     eaCliente = #0#3;
     eaSerie = #0#48;
     eaTipo = "F";
     |HAZ ExisteCliRie;
|FPRC;

|PROCESO Cliente84_6;
     nError6 = 0;
     |HAZ Extra;
     |HAZ Dir;
     |HAZ Riesgo;
     |SI nError6 ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO Riesgo;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴 Control Riesgo Cliente.
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |ACABA; |FINSI;
     nMasRies = 0;
     eaTag = "FD";  |HAZ SacaRiesgo;
     |SI #agifa142#6 = "S"; |Y eaExisteCliRie = "S";
          |SI nRieUtili ] nRieTotal; |Y nRieTotal ! 0;
               |SI #agifa142#22 = "N";
                    |MENAV "0000Superado Riesgo Cliente";
                    |BLIN 4;
               |FINSI;
               |SI #agifa142#22 = "S";
                    |HAZ AvisaRiesgo;
               |FINSI;
               |SI #agifa142#22 = "P";
                    |ABRE #140;
                    aUs = Usuario % 0810;
                    #140#0 = "A";
                    #140#1 = aUs;
                    |LEE 000#140=;
                    |SI FSalida ! 0;
                         |CIERRA #140;
                         |HAZ mira_riesgo;
                         |ERROR; nError6 = 1; |ACABA;
                    |FINSI;
                    |CIERRA #140;
                    |DDEFECTO #141;
                    #141#0 = nRieTotal;
                    #141#1 = nRieUtili;
                    #141#2 = #140#2;
                    #141#5 = nRieUtili;
                    #141#3 = (nRieTotal % #140#2);
                    #141#4 = #140#3;
                    |SI #141#3 < #141#4;|Y #141#3 ! 0;
                         #141#6 = nRieTotal + #141#3;
                         nMasRies  = #141#3;
                    |SINO;
                         #141#6 = nRieTotal + #141#4;
                         nMasRies  = #141#4;
                    |FINSI;
                    |SI #141#6 [ #141#5;
                         #141#7 = "DENEGADA ";
                         nAudito = 1;
                         nMasRies = 0;
                    |SINO;
                         #141#7 = "PERMITIDA";
                         nAudito = 0;
                    |FINSI;
                    |PUSHV 0501 2380;
                    |PINPA #0#141;
                    |PINDA #0#141;
                    |PAUSA;
                    |POPV;
                    |SI nAudito = 1;
                         |ERROR; nError6 = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ mira_riesgo;

|FPRC;

|PROCESO IVA001_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA001_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ caltotal;
     |FINSI;
|FPRC;
