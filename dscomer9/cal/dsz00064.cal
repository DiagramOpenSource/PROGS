|FICHEROS;
     dsz00064 #0;
     agifa019 #19;
     agifa024 #24;
     agifa060 #60;
     agifa120 #120;
     dsm00239 #239;

     dsm00252 #252;
     dsm00253 #253;
     dsm00254 #254;
     dsm00255 #255;
     dsm00256 #256;
     dsm00257 #257;
     dsm00258 #258;
     dsm00259 #259;
     dsm00260 #260;
     dsm00262 #262;
     dsm00268 #268;
     dsm00269 #269;
     dsm00270 #270;
     dsm00271 #271;
     dsm00272 #272;
     dsm00273 #273;
     dsm00275 #275;
     agifa321 #321;
     agifa324 #324;
     agifa505 #505;
     agifa514 #514;
     agifa515 #515;
     agifa517 #517;
     dscam003@;
     dscam045@;
     dsw00080 #80;  || Temporal
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nSwDs_suite = 0;
     nSwPalmHotel = 0;
     nReg = 0;
     aPathOrg = "";
     nBoton1 = 0;
     nBoton2 = 0;
     &Tempo = "";
     nEmpresa = 0;
     aDef = "";
     aAlta = "";
     fFecha = @;
     aDesBase = "";
     {1}aBaseLocal = "";
     nHay = 0;
     aSubfam = "";
     aDato = "";
     aFinReg = "";
     nHandle = 0;
     aAlfa = "";
     aTab = "";
     aFic = "";
     nPvpCon = 0;
     nPvpSin = 0;
     aHIni = "";
     aHFin = "";
     aLon1 = "";
     aLon2 = "";
     aReg = "";
     nLon1 = 0;
     nLon2 = 0;
     nNume = 0;
     nCampos = 0;
     i = 0;
     &nDeci_PreBase = 0;
     aCarpeta = "";
     aNomFic = "";
     {1}aConte = "";
     aIP = "";
     aVer1 = "";
     aVer2 = "";
     aOrg = "";
     aDes = "";
     aDesPath = "";
     nPvpCon2 = 0;
     nPvpCon3 = 0;
     nPvpCon4 = 0;
     nPvpCon5 = 0;
     nPvpCon6 = 0;
     nPvpSin2 = 0;
     nPvpSin3 = 0;
     nPvpSin4 = 0;
     nPvpSin5 = 0;
     nPvpSin6 = 0;
|FIN;

|PROCESO QuitaRaros;
     |ANSI_OEM aAlfa, aAlfa;
     |QBF aAlfa;
|FPRC;

|PROCESO EnviaFichero;
     aOrg = aDesBase + aFic;
     aDes = #0#1; |QBF aDes;
     aDes = aDes + "tactil/" + aFic;
     |BLIN 23; |PINTA 2302, "enviando...";
     |HAZ Envia;
     |BLIN 23;
     nReg = 0;
|FPRC;

|PROCESO Envia;
     |XABRE "E", aOrg, 0;
     |SI FSalida < 0; |ACABA; |FINSI;

     aIP = "";
     |IP_REMOTO aIP;
     |SI aIP ! "";
          |RMKDIR aDesPath;
          |ENVIA_FICHERO aOrg, aDes;
     |SINO;
          |MKDIR aDesPath;
          |COPIA_FICHERO aOrg, aDes;
     |FINSI;
     |SI FSalida ! 0;
          |DBASE aAlfa;
          aAlfa = aOrg - aAlfa;
          aAlfa = "0000Error al copiar: /" + aAlfa;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO SonIguales;
     aConte = aOrg;
     |ESPECIFICA "MD5", aConte;
     aVer1 = FSalida;
     aConte = aDes;
     |ESPECIFICA "REMOTOMD5", aConte;
     aVer2 = FSalida;
     |SI aVer1 ! aVer2;
          FSalida = 1;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO CopiaImagen;
     |DBASE aOrg;
     aOrg = aOrg + "imagen/" + aCarpeta + "/" + aNomFic;
   ||  aDes = aDesBase + aCarpeta + "/";
   ||  aDesPath = aDes;
   ||  aDes = aDes + aNomFic + ".bmp";

     aDes = #0#1; |QBF aDes;
     aDes = aDes + "tactil/" + aCarpeta + "/";
     aDesPath = aDes;
     |RMKDIR aDesPath;
     aDes = aDes + aNomFic + ".bmp";

     |HAZ SonIguales;
     |SI FSalida ! 0;
          |HAZ Envia;
     |FINSI;
|FPRC;

|PROCESO dscam003;
     |SI #dscam003@#14 = "P"; |O #dscam003@#14 = "I";
               |O #dscam003@#14 = "C";

          #80#0 = #dscam003@#0;
          #80#1 = #dscam003@#1;
          #80#2 = #dscam003@#2;
          |LEE 000#80=;            || Para que no grabe duplicados
          |SI FSalida = 0;
               |ACABA;
          |SINO;
               |GRABA 020#80n;
          |FINSI;

          aDato = #dscam003@#0;
          aDato = aDato + aTab + #dscam003@#1;
          aDato = aDato + aTab + #dscam003@#2;
          aDato = aDato + aTab + #dscam003@#32;
          aDato = aDato + aTab + #dscam003@#6;
          aDato = aDato + aTab + #dscam003@#30;
          aDato = aDato + aTab + #dscam003@#31;
          aDato = aDato + aTab + #dscam003@#15;
          aDato = aDato + aTab + #dscam003@#4;
          aDato = aDato + aFinReg;
          |XGRABA nHandle, aDato;
          nReg = nReg + 1; |PINTA 2302, nReg;
     |FINSI;
|FPRC;

|DEFBUCLE dscam003;
     #dscam003@#1001;
     ;
     000000001;
     999999999;
     ;
     NULL, dscam003;
|FIN;

|PROCESO LinControl;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
     |PATH_DAT #dscam003@#aAlfa#;
     |BUCLE dscam003;
|FPRC;

|DEFBUCLE LinControl;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, LinControl;
|FIN;

|PROCESO Recibos;
     |DBASS aAlfa;
     aDef = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aDef, dscam045@;
     |SI FSalida = 0;
          aDef = aAlfa + "dscarter/def/dscam003.mas";
          |CARGA_DEF aDef, dscam003@;
          |SI FSalida = 0;
               aAlfa = aAlfa + "dscarter/fich/";
               |PATH_DAT #dscam045@#aAlfa#;
               nEmpresa = #48#0;

               aFic = "RecibosPdtes.txt";
               aAlfa = aDesBase + aFic;
               |BLIN 22; |PINTA 2202, aFic;
               |XABRE "W", aAlfa, nHandle;
               |SI FSalida ] 0;
                    |HAZ CreaTempo; |NOME_DAT #80#Tempo#; |DELINDEX #80;
                    |ABRE #80;
                    |BUCLE LinControl;
                    |CIERRA #80;
                    |HAZ BoraTempo; |DELINDEX #80;
                    |XCIERRA nHandle;
                    |HAZ EnviaFichero;
               |SINO;
                    aAlfa = "0000Error al crear:" + aFic;
                    |MENAV aAlfa;
               |FINSI;
               |DESCARGA_DEF #dscam003@;
          |FINSI;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;

|PROCESO dsm00275;
     aDato = #275#0;
     aDato = aDato + aTab + #275#1;
     aDato = aDato + aTab + #275#2;
     aDato = aDato + aTab + #275#8;
     aDato = aDato + aTab + #275#3;
     aDato = aDato + aTab + #275#4;
     aDato = aDato + aTab + #275#5;
     aDato = aDato + aTab + #275#6;
     aDato = aDato + aTab + #275#7;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00275;
     #275#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00275;
|FIN;

|PROCESO PrecCombi;
     aFic =  "preccombi.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00275;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
---------------------------------------------
|PROCESO dsm00273;
     aDato = #273#0;
     aDato = aDato + aTab + #273#1;
     aDato = aDato + aTab + #273#2;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00273;
     #273#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00273;
|FIN;

|PROCESO NotasCocina;
     aFic = "notascocina.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00273;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
---------------------------------------------
|PROCESO dsm00272;
     aDato = "A";
     aDato = aDato + aTab + #272#0;
     aDato = aDato + aTab + #272#1;
     aDato = aDato + aTab + #272#2;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00272;
     #272#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00272;
|FIN;

|PROCESO dsm00271;
     aDato = "S";
     aDato = aDato + aTab + #271#0;
     aDato = aDato + aTab + #271#1;
     aDato = aDato + aTab + #271#2;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00271;
     #271#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00271;
|FIN;

|PROCESO dsm00270;
     aDato = "F";
     aDato = aDato + aTab + #270#0;
     aDato = aDato + aTab + #270#1;
     aDato = aDato + aTab + #270#2;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00270;
     #270#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00270;
|FIN;

|PROCESO ComandaLin;
     aFic = "impartic.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00270;
          |BUCLE dsm00271;
          |BUCLE dsm00272;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
---------------------------------------------
|PROCESO dsm00269;
     aDato = #269#0;
     aDato = aDato + aTab + #269#1;
     aDato = aDato + aTab + #269#2;
     aDato = aDato + aTab + #269#3;
     aDato = aDato + aTab + #269#4;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00269;
     #269#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00269;
|FIN;

|PROCESO ComandaCab;
     aFic = "impcoman.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00269;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
---------------------------------------------
|PROCESO dsm00268;
     aDato = #268#0;
     aDato = aDato + aTab + #268#1;
     aDato = aDato + aTab + #268#2;
     aDato = aDato + aTab + #268#3;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00268;
     #268#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00268;
|FIN;

|PROCESO Salas;
     aFic = "salas.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00268;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
------------------------------------------------
|PROCESO agifa505;
     |SI nSwPalmHotel = 0; |O nSwDs_suite = 0;
||          #505#100 = "S";
     |FINSI;

     |PARA i = 0; |SI i [ 180; |HACIENDO i = i + 1;
          aDato = #505i; |QBF aDato;
          aDato = aDato + aTab;
          |XGRABA nHandle, aDato;
     |SIGUE;
     aDato = #505#183 + aTab;
     |XGRABA nHandle, aDato;

     aDato = #321#9 + aTab;
     |XGRABA nHandle, aDato;

     |XGRABA nHandle, aFinReg;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE agifa505;
     #505#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa505;
|FIN;

|PROCESO ParamCaja;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     aFic = "paramcaja.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "WB", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE agifa505;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
------------------------------------------------
|PROCESO agifa517;
     aDato = #517#21;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|PROCESO ParamTpv;
     aFic = "parametro.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #517;
          |LEE 000#517p;
          |CIERRA #517;
          |HAZ agifa517;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
------------------------------------------------
|PROCESO PerfilCajeros;
     aDato = #514#0;
     aDato = aDato + aTab + #262#1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE PerfilCajeros;
     #514#1;
     16;
     01, #262#0;
     99, #262#0;
     ;
     NULL, PerfilCajeros;
|FIN;

|PROCESO dsm00262;
     |BUCLE PerfilCajeros;
|FPRC;

|DEFBUCLE dsm00262;
     #262#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00262;
|FIN;

|PROCESO Perfiles;
     aFic = "perfiles.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00262;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00260;
     |SI #260#5 ] fFecha;
          |DDEFECTO #24;
          #24#0 = #260#1;
          |LEE 000#24=;

          aDato = #260#0;
          aDato = aDato + aTab + #260#1;

          aAlfa = #24#1; |HAZ QuitaRaros;
          aDato = aDato + aTab + aAlfa;
          aDato = aDato + aTab + #260#3;
          aDato = aDato + aTab + #260#8;
          aDato = aDato + aTab + #260#5;
          aDato = aDato + aTab + #260#2;
          aDato = aDato + aFinReg;
          |XGRABA nHandle, aDato;
          nReg = nReg + 1; |PINTA 2302, nReg;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00260;
     #260#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00260;
|FIN;

|PROCESO TarjetaCli;
     |SI #260#5 ] fFecha;
          aAlta = "N";
     |FINSI;
|FPRC;

|DEFBUCLE TarjetaCli;
     #260#2;
     ;
     #24#0, 000000;
     #24#0, 999999;
     ;
     NULL, TarjetaCli;
|FIN;

|PROCESO TClientes;
     |SI #24#4 = "97";
          |ACABA;
     |FINSI;

     aAlta = "S";
     |BUCLE TarjetaCli;
     |SI aAlta = "S";
          |DDEFECTO #260;
          |ABRE #260;
          #260#0 = #24#0;
          #260#1 = #24#0;
          |LEE 101#260=;
          |SI FSalida = 0;
               |SI #260#5 ] fFecha;     || No esta caducada
                    |SELECT #2#260;
                    #260#1 = #24#0;
                    #260#0 = 999999;
                    |LEE 000#260];
                    |SI FSalida = 0;
                         |LEE 000#260a;
                    |SINO;
                         |LEE 000#260u;
                    |FINSI;
                    |SI FSalida = 0; |Y #260#1 = #24#0;
                         nNume = #260#0 + 1;
                    |SINO;
                         nNume = 1;
                    |FINSI;
                    |SI nNume < 1000; nNume = 1000; |FINSI;
                    |SELECT #1#260;
                    |DDEFECTO #260;
                    #260#0 = nNume;
                    #260#1 = #24#0;
                    |GRABA 020#260b;
               |FINSI;
          |SINO;
               |GRABA 020#260b;
          |FINSI;
          #260#1 = #24#1;
          #260#2 = "S";
          #260#4 = fFecha;
          #260#5 = "31.12.2999";
          #260#6 = 999999;
          #260#8 = 999999;
          |CIERRA #260;
     |FINSI;
|FPRC;

|DEFBUCLE TClientes;
     #24#1;
     ;
     "000001";
     "zzzzzz";
     ;
     NULL, TClientes;
|FIN;

|PROCESO TarjetasCli;
     |BUCLE TClientes;
     aFic = "tarcli.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #24;
          |BUCLE dsm00260;
          |CIERRA #24;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO agifa515;
     aDato = #515#0;
     aDato = aDato + aTab + #515#1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE agifa515;
     #515#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa515;
|FIN;

|PROCESO Tarjetas;
     aFic = "tarjetas.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE agifa515;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO agifa514;
     aAlfa = "|NC";
     aAlfa = #514#aAlfa#;
     nCampos = aAlfa;
     aReg = "";
     |PARA i = 0; |SI i < nCampos; |HACIENDO i = i + 1;
          aDato = #514#i# + aTab;
          |XGRABA nHandle, aDato;
     |SIGUE;
     aReg = aReg + aFinReg;
     |XGRABA nHandle, aReg;
     nReg = nReg + 1; |PINTA 2302, nReg;

     aCarpeta = "cajeros";
     aNomFic = #514#0;
     |HAZ CopiaImagen;
|FPRC;

|DEFBUCLE agifa514;
     #514#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa514;
|FIN;

|PROCESO Cajeros;
     aFic = "cajeros.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "WB", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE agifa514;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00259;
     aHIni = (("00" + #259#2) % -102) + ":" + (("00" + #259#3) % -102);
     aHFin = (("00" + #259#4) % -102) + ":" + (("00" + #259#5) % -102);
     aDato = #258#1;
     aDato = aDato + aTab + #258#2;
     aDato = aDato + aTab + aHIni;
     aDato = aDato + aTab + aHFin;
     aDato = aDato + aTab + #259#6;
     aDato = aDato + aTab + #259#7;
     aDato = aDato + aTab + #259#8;
     aDato = aDato + aTab + #259#9;
     aDato = aDato + aTab + #259#10;
     aDato = aDato + aTab + #259#11;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00259;
     #259#2;
     ;
     #258#0, 00, 00;
     #258#0, 23, 59;
     ;
     NULL, dsm00259;
|FIN;

|PROCESO dsm00258;
     |BUCLE dsm00259;
|FPRC;

|DEFBUCLE dsm00258;
     #258#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00258;
|FIN;

|PROCESO Promociones;
     aFic = "promociones.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE dsm00258;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO agifa019;
     |SI #252#3 = 1;
          |DDEFECTO #19;
          #19#0 = #255#0;
          |LEE 000#19=;
     |FINSI;

     aAlfa = #19#128; |QBF aAlfa;
     |SI aAlfa = "";
          |ACABA;
     |FINSI;

     |SI #252#3 = 0;
          |DDEFECTO #255;
          #255#0 = #19#0;
          |LEE 000#255=;
     |FINSI;

     enTiva = #19#30;
     efFiva = ~;
     |HAZ SacaIVA;

     aDato = #257#0;
     aDato = aDato + aTab + #255#4;
     aAlfa = #19#1; |HAZ QuitaRaros;
     aDato = aDato + aTab + aAlfa;
     aDato = aDato + aTab + #19#128;
     aDato = aDato + aTab + #257#3;
     aDato = aDato + aTab + #257#5;
     aDato = aDato + aTab + #257#6;
     aDato = aDato + aTab + #257#7;
     aDato = aDato + aTab + #257#8;
     aDato = aDato + aTab + #257#9;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|PROCESO Orden19;
     |DDEFECTO #255;
     #255#0 = #19#0;
     |LEE 000#255=;
|FPRC;

|DEFBUCLE FamCombinado;
     #19#7;
     ;
     #257#2, "                    ";
     #257#2, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Orden19, NULL, NULL, NULL, agifa019;
     #255#4, #19#1;
|FIN;

|PROCESO Orden19Aux;
     |DDEFECTO #19;
     #19#0 = #255#0;
     |LEE 000#19=;
|FPRC;

|DEFBUCLE FamCombinadoAux;
     #255#2;
     ;
     #257#2, "                    ";
     #257#2, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Orden19Aux, NULL, NULL, NULL, agifa019;
     #255#4, #19#1;
|FIN;

|PROCESO dsm00257;
     |DDEFECTO #252;
     #252#0 = #257#2;
     |LEE 000#252=;
     |SI #252#3 = 0;
          |BUCLE FamCombinado;
     |SINO;
          |BUCLE FamCombinadoAux;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00257;
     #257#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00257;
|FIN;

|PROCESO Combinados;
     aFic = "combinados.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #255;
          |ABRE #252;
          |ABRE #19;
          |BUCLE dsm00257;
          |CIERRA #19;
          |CIERRA #252;
          |CIERRA #255;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00256;
     aAlfa = #256#2; |QBF aAlfa;
     |SI aAlfa = "";
          |ACABA;
     |FINSI;

     |DDEFECTO #255;
     #255#0 = #256#0;
     |LEE 000#255=;

     |DDEFECTO #239;
     #239#0 = #256#2;
     |LEE 000#239=;

     |DDEFECTO #254;
     #254#0 = #239#0;
     |LEE 000#254=;

     |DDEFECTO #19;
     #19#0 = #256#0;
     |LEE 000#19=;

     aAlfa = #19#128; |QBF aAlfa;
     |SI aAlfa = "";
          |ACABA;
     |FINSI;

     aDato = #19#128;
     aDato = aDato + aTab + #256#2;
     aDato = aDato + aTab + #256#5;
     aDato = aDato + aTab + #256#12;
     aDato = aDato + aTab + #255#3; ||dto promo
     aDato = aDato + aTab + #256#11;
     aDato = aDato + aTab + #239#1;
     aDato = aDato + aTab + #254#2;
     aDato = aDato + aTab + #256#6;
     aDato = aDato + aTab + #256#7;
     aDato = aDato + aTab + #256#8;
     aDato = aDato + aTab + #256#9;
     aDato = aDato + aTab + #256#10;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00256;
     #256#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00256;
|FIN;

|PROCESO ArticulosLin;
     aFic = "articuloslin.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #257;
          |ABRE #239;
          |ABRE #255;
          |ABRE #254;
          |ABRE #19;
          |BUCLE dsm00256;
          |CIERRA #19;
          |CIERRA #254;
          |CIERRA #255;
          |CIERRA #239;
          |CIERRA #257;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00255;
     aAlfa = #19#128; |QBF aAlfa;
     |SI aAlfa = "";
          |ACABA;
     |FINSI;
     |DDEFECTO #255;
     #255#0 = #19#0;
     |LEE 000#255=;
     |SI FSalida ! 0
          #255#1 = "S";
          #255#2 = 0;
          #255#3 = 0;
          #255#4 = 0;
     |FINSI;

     |SI #255#7 = 0 ; |Y #255#6 = "S";
          #257#0 = #19#2;
          |LEE 000#257=;
          |SI FSalida = 0;
               #255#7 = #257#4
          |FINSI;
     |FINSI;

     |SI #505#177 = "N"
          #19#30 = #505#178;
     |FINSI;

     enTiva = #19#30;
     efFiva = ~;
     |HAZ SacaIVA;

     |SI #19#130 = "S";
          nPvpCon = #19#18;
          nPvpCon2 = #19#19;
          nPvpCon3 = #19#20;
          nPvpCon4 = #19#147;
          nPvpCon5 = #19#148;
          nPvpCon6 = #19#149;
          nPvpSin = nPvpCon / (1+(enIva/100));
          nPvpSin2 = nPvpCon2 / (1+(enIva/100));
          nPvpSin3 = nPvpCon3 / (1+(enIva/100));
          nPvpSin4 = nPvpCon4 / (1+(enIva/100));
          nPvpSin5 = nPvpCon5 / (1+(enIva/100));
          nPvpSin6 = nPvpCon6 / (1+(enIva/100));
     |SINO;
          nPvpSin = #19#18;
          nPvpSin2 = #19#19;
          nPvpSin3 = #19#20;
          nPvpSin4 = #19#147;
          nPvpSin5 = #19#148;
          nPvpSin6 = #19#149;
          nPvpCon = nPvpSin + (nPvpSin * enIva / 100);
          nPvpCon2 = nPvpSin2 + (nPvpSin2 * enIva / 100);
          nPvpCon3 = nPvpSin3 + (nPvpSin3 * enIva / 100);
          nPvpCon4 = nPvpSin4 + (nPvpSin4 * enIva / 100);
          nPvpCon5 = nPvpSin5 + (nPvpSin5 * enIva / 100);
          nPvpCon6 = nPvpSin6 + (nPvpSin6 * enIva / 100);
     |FINSI;
     nPvpCon = nPvpCon ! nDeci_PreBase;
     nPvpCon2 = nPvpCon2 ! nDeci_PreBase;
     nPvpCon3 = nPvpCon3 ! nDeci_PreBase;
     nPvpCon4 = nPvpCon4 ! nDeci_PreBase;
     nPvpCon5 = nPvpCon5 ! nDeci_PreBase;
     nPvpCon6 = nPvpCon6 ! nDeci_PreBase;

     aDato = #255#11; |QBF aDato;
     |SI aDato ! ""; #19#3 = #255#11; |FINSI;

     aDato = #255#10; |QBF aDato;
     |SI aDato ! ""; #19#2 = #255#10; |FINSI;


     aSubfam = #19#3; |QBF aSubfam;
     |SI aSubfam = ""; aSubfam = "99999"; |FINSI;

     aDato = #19#2;
     aDato = aDato + aTab + aSubfam;
     aDato = aDato + aTab + #255#4;
     aAlfa = #19#1; |HAZ QuitaRaros;
     aDato = aDato + aTab + aAlfa;
     aDato = aDato + aTab + #19#128;
     aDato = aDato + aTab + nPvpCon;
     aDato = aDato + aTab + #19#21;
     aDato = aDato + aTab + enIva;
     aDato = aDato + aTab + #255#2;
     aDato = aDato + aTab + #255#3;
     aDato = aDato + aTab + #255#1;
     aDato = aDato + aTab + #255#7;
     aDato = aDato + aTab + #19#206;
     aDato = aDato + aTab + nPvpCon2;
     aDato = aDato + aTab + nPvpCon3;
     aDato = aDato + aTab + nPvpCon4;
     aDato = aDato + aTab + nPvpCon5;
     aDato = aDato + aTab + nPvpCon6;
     aDato = aDato + aTab + #19#22;
     aDato = aDato + aTab + #19#23;
     aDato = aDato + aTab + #19#150;
     aDato = aDato + aTab + #19#151;
     aDato = aDato + aTab + #19#152;
     aDato = aDato + aTab + #255#8;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;

     aCarpeta = "articulos";
     aNomFic = #19#0; |QBF aNomFic;
     |HAZ CopiaImagen;
|FPRC;

|DEFBUCLE dsm00255;
     #19#1;
     136;
     "                    ", "S";
     "zzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, dsm00255;
|FIN;

|PROCESO Articulos;
     aFic =  "articulos.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #255;
          |ABRE #257;
          |BUCLE dsm00255;
          |CIERRA #257;
          |CIERRA #255;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00254;
     |SI #254#1 ! "S";
          |ACABA;
     |FINSI;

     |DDEFECTO #239;
     #239#0 = #254#0;
     |LEE 000#239=;
     aDato = #254#2;
     aDato = aDato + aTab + #239#1;
     aDato = aDato + aTab + #254#0;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;

     aCarpeta = "unidades";
     aNomFic = #254#0; |QBF aNomFic;
     |HAZ CopiaImagen;
|FPRC;

|PROCESO Orden254;
     |DDEFECTO #239;
     #239#0 = #254#0;
     |LEE 000#239=;
|FPRC;

|DEFBUCLE dsm00254;
     #254#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Orden254, NULL, NULL, NULL, dsm00254;
     #254#2, #239#1;
|FIN;

|PROCESO Unidades;
     aFic = "unidades.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #239;
          |BUCLE dsm00254;
          |CIERRA #239;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00253;
     nHay = 1;
     |DDEFECTO #120;
     #120#0 = #253#0;
     |LEE 000#120=;
     aDato = #253#2;
     aDato = aDato + aTab + #253#1;
     aDato = aDato + aTab + #120#1;
     aDato = aDato + aTab + #253#0;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|PROCESO Orden253;
     aAlfa = #253#2;
     |QBF aAlfa;
     |SI aAlfa = "";
          |ERROR;
     |SINO;
          |DDEFECTO #120;
          #120#0 = #253#0;
          |LEE 000#120=;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00253;
     #253#2;
     ;
     #252#0;
     #252#0;
     ;
     NULL, Orden253, NULL, NULL, NULL, dsm00253;
     #253#2, #253#1, #120#1;
|FIN;

|PROCESO dsm00252_1;
     nHay = 0;
     |BUCLE dsm00253;
     |SI nHay ! 0; |ACABA; |FINSI;
     aDato = #252#0;
     aDato = aDato + aTab + "1";
     aDato = aDato + aTab + "UNICA";
     aDato = aDato + aTab + "99999";
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE dsm00252_1;
     #252#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00252_1;
|FIN;

|PROCESO Subfamilia;
     aFic = "subfamilias.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #120;
          |||BUCLE dsm00253;
          |BUCLE dsm00252_1;
          |CIERRA #120;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO dsm00252;
     |DDEFECTO #60;
     #60#0 = #252#0;
     |LEE 000#60=;
     aDato = #252#1;
     aDato = aDato + aTab + #60#1;
     aDato = aDato + aTab + #252#0;
     aDato = aDato + aTab + #252#2;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|PROCESO Orden252;
     |DDEFECTO #60;
     #60#0 = #252#0;
     |LEE 000#60=;
|FPRC;

|DEFBUCLE dsm00252;
     #252#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Orden252, NULL, NULL, NULL, dsm00252;
     #252#1, #60#1;
|FIN;

|PROCESO Familia;
     aFic = "familias.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |ABRE #60;
          |BUCLE dsm00252;
          |CIERRA #60;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO agifa324;
     aDato = #324#0;
     aDato = aDato + aTab + #324#1;
     aDato = aDato + aTab + #324#2;
     aDato = aDato + aTab + #324#3;
     aDato = aDato + aTab + #324#4;
     aDato = aDato + aTab + #324#5;
     aDato = aDato + aTab + #324#6;
     aDato = aDato + aTab + #324#7;
     aDato = aDato + aTab + #324#8;
     aDato = aDato + aTab + #324#9;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE agifa324;
     #324#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa324;
|FIN;

|PROCESO Divisas;
     aFic = "divisas.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE agifa324;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO agifa024;
     aDato = #24#0;
     aDato = aDato + aTab + #24#1;
     aDato = aDato + aTab + #24#15;
     aDato = aDato + aTab + #24#8;
     aDato = aDato + aTab + #24#183;
     aDato = aDato + aTab + #24#9;
     aDato = aDato + aTab + #24#10;
     aDato = aDato + aTab + #24#17;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
     nReg = nReg + 1; |PINTA 2302, nReg;
|FPRC;

|DEFBUCLE agifa024;
     #24#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa024;
|FIN;

|PROCESO Clientes;
     aFic = "clientes.txt";
     aAlfa = aDesBase + aFic;
     |BLIN 22; |PINTA 2202, aFic;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ] 0;
          |BUCLE agifa024;
          |XCIERRA nHandle;
          |HAZ EnviaFichero;
     |SINO;
          aAlfa = "0000Error al crear:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO PonBarra; |TIPO 0;
     aAlfa = #0#1; |QBF aAlfa;
     aAlfa = aAlfa % -101;
     |SI aAlfa ! "/"; |Y aAlfa ! "\";
          aAlfa = #0#1; |QBF aAlfa;
          aAlfa = aAlfa + "/";
          #0#1 = aAlfa;
          |PINTA #0#1;
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
                         || Av.Pag.
     |SI FSalida ! 0; |Y FSalida ! 5; |ACABA; |FINSI;

     |HAZ PonBarra;

     |ATRI I; |PINTA 1417, " Exportando..."; |ATRI 0;

     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";

     fFecha = ~;

     |DFICE aDesBase;

     |HAZ DecimalesBase;

     |RMKDIR aDesBase;

     aTab = &9;
     aFinReg = &13;
     aFinReg = aFinReg + & 10;

     aDes = #0#1; |QBF aDes;
     aDes = aDes + "tactil/";
     aDesPath = aDes;
     |HAZ Recibos;
     |HAZ TarjetasCli
     |SI #0#3 = "T";
          |HAZ Familia;
          |HAZ Subfamilia;
          |HAZ Unidades;
          |HAZ Articulos;
          |HAZ ArticulosLin;
          |HAZ Combinados;
          |HAZ Promociones;
          |HAZ Cajeros;
          |HAZ Tarjetas;
          |HAZ Perfiles;
          |HAZ ParamCaja;
          |HAZ ParamTpv;
          |HAZ Salas;
          |HAZ ComandaCab;
          |HAZ ComandaLin;
          |HAZ NotasCocina;
          |HAZ PrecCombi;
          |HAZ Divisas;
          |HAZ Clientes;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 815;     || Av.Pag.
|FPRC;

|PROCESO Boton2;
     |PTEC 807;
|FPRC;

|PROGRAMA;
     |ABRE #505;
     |LEE 000#505p;
     |SI FSalida ! 0;
          |MENAV "0000No hay Cajas definidas....";
          |ACABA;
     |FINSI;
     |CIERRA #505;

     |HAZ EsDs_suite;
     nSwDs_suite = FSalida;

     |HAZ EsPalmHotel;
     nSwPalmHotel = FSalida;

     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     aDesBase = #0#1; |QBF aDesBase;
     |SI aDesBase = "";
          aIP = ""; |IP_REMOTO aIP;
          |SI aIP = "";
               |DBASS aAlfa;
               #0#1 = aAlfa;
          |SINO;
               aBaseLocal1 = "";
               |ESPECIFICA "RBASS", aBaseLocal;
               #0#1 = aBaseLocal1;
          |FINSI;
     |FINSI;

     |SI PARAMETRO = "menu";
          |CONTROL_SIMPLE 0, "BOTON, Aceptar ", 1520, 1640, Boton1;
          nBoton1 = FSalida;
          |CONTROL_SIMPLE 0, "BOTON, Cancelar ", 1545, 1665, Boton2;
          nBoton2 = FSalida;

          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0; |GRABA 020#0a; |FINSI;

          |FIN_CONTROL_WINDOWS nBoton2;
          |FIN_CONTROL_WINDOWS nBoton1;
          |PULSATECLA;
     |SINO;
          |SI PARAMETRO ! "";
               #0#1 = PARAMETRO;
          |FINSI;
          FSalida = 0;
          |HAZ Tipo12;
     |FINSI;

     |CIERRA #0;
|FPRO;
