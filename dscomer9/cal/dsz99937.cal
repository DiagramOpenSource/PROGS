|FICHEROS;
     refere0@ #0;
     refere1@ #1;
     agifa041@ #41;
     agifa142@ #142;
     agifa200@ #200;
     agifa208@ #208;

     agifa023;
     dsm00123;
     agifa095;
     agifa039;
     agifa310;
     agifa290;
     dsm00117;
     agifa281;

     rodm0005@;
|FIN;

|VARIABLES;
     &enSwNoCopia = 0; || Para desactivar la actualizacion
     &eaRodExporta = "";
     nTipo = 0;
     aClave = "";
     nReg = 0;
     aPath = "";
     aCopia = "";
     nModoCam = 0;
     nCampo = 0;
     aDef = "";
     aAlfa = "";
     aFic0 = "";
     aFic1 = "";
     aDef0 = "";
     aDef1 = "";
     nModo = 0;
     nCamBaja = 0;
     nCamAlta = 0;
     nCamModi = 0;
     nPasa = 0;
|FIN;

|PROCESO GrabaFic0;
     |SI aFic0 = ""; |ACABA; |FINSI;

     |PATH_DAT #0 aPath;
     |ABRE #0;

     |SI aFic1 = "agifa023";
          #0#0 = #1#0;
     |FINSI;
     |SI aFic1 = "dsm00123";
          #0#0 = #1#0;
          #0#1 = #1#1;
     |FINSI;
     |SI aFic1 = "agifa095";
          #0#0 = #1#0;
     |FINSI;

     |LEE 000#0=
     |SI FSalida ! 0;
          |GRABA 020#0n;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO LeeReg;
     |SI aFic1 = "agifa023";
          #1#0 = #agifa023#0;
          #1#1 = #agifa023#1;
     |FINSI;
     |SI aFic1 = "dsm00123";
          #1#0 = #dsm00123#0;
          #1#1 = #dsm00123#1;
          #1#2 = #dsm00123#2;
     |FINSI;
     |SI aFic1 = "agifa095";
          #1#0 = #agifa095#0;
          #1#1 = #agifa095#1;
     |FINSI;
     |SI aFic1 = "agifa039";
          #1#0 = #agifa039#0;
          #1#1 = #agifa039#1;
     |FINSI;
     |SI aFic1 = "agifa310";
          #1#0 = #agifa310#0;
          #1#1 = #agifa310#1;
          #1#2 = #agifa310#2;
     |FINSI;
     |SI aFic1 = "agifa290";
          #1#0 = #agifa290#0;
          #1#41 = #agifa290#41;
     |FINSI;
     |SI aFic1 = "dsm00117";
          #1#0 = #dsm00117#0;
     |FINSI;
     |SI aFic1 = "agifa281";
          #1#0 = #agifa281#0;
     |FINSI;

     |LEE 101#1=;
|FPRC;

|PROCESO CamCopia;
     nPasa = 0;
     |SI nModoCam = 1; |Y #208#3 = "S"; nPasa = 1; |FINSI;
     |SI nModoCam = 2; |Y #208#4 = "S"; nPasa = 1; |FINSI;
     |SI nPasa = 0; |ACABA; |FINSI;
     nCampo = #208#1;
     |SI aFic1 = "agifa023";
          #1#nCampo# = #agifa023#nCampo#;
     |FINSI;
     |SI aFic1 = "dsm00123";
          #1#nCampo# = #dsm00123#nCampo#;
     |FINSI;
     |SI aFic1 = "agifa095";
          #1#nCampo# = #agifa095#nCampo#;
     |FINSI;
     |SI aFic1 = "agifa039";
          #1#nCampo# = #agifa039#nCampo#;
     |FINSI;
     |SI aFic1 = "agifa310";
          #1#nCampo# = #agifa310#nCampo#;
     |FINSI;
     |SI aFic1 = "agifa290";
          #1#nCampo# = #agifa290#nCampo#;
     |FINSI;
     |SI aFic1 = "dsm00117";
          #1#nCampo# = #dsm00117#nCampo#;
     |FINSI;
     |SI aFic1 = "agifa281";
          #1#nCampo# = #agifa281#nCampo#;
     |FINSI;
|FPRC;

|DEFBUCLE CamCopiaModi;
     #208#3003;
     ;
     aFic1, 001, "S";
     aFic1, 999, "S";
     ;
     NULL, CamCopia;
|FIN;

|DEFBUCLE CamCopiaAlta;
     #208#2003;
     ;
     aFic1, 001, "S";
     aFic1, 999, "S";
     ;
     NULL, CamCopia;
|FIN;

|PROCESO EmCopia;
     |DFICB aAlfa; |QBF aAlfa;
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     |SALVA_FICHA #41;
     #41#0 = #200#0;
     |LEE 000#41=;
     |SI FSalida = 0;
          |DFICB aAlfa; |QBF aAlfa;
          aPath = aAlfa + (("00000" + #200#0) % -105) + "/";
          |PATH_DAT #1 aPath;
          |ABRE #1;
          |DDEFECTO #1;
          |HAZ LeeReg;
          |SI FSalida = 0;
               |SI nModo = 3; |Y #200nCamBaja = "S";
                    |BORRA 000#1a;
               |FINSI;
               |SI nModo ! 3; |Y #200nCamModi = "S";
                    nModoCam = 2;
                    |BUCLE CamCopiaModi;
                    |GRABA 020#1a;
                    |HAZ GrabaFic0;
               |FINSI;
          |SINO;
               |SI #200nCamAlta = "S";
                    nModoCam = 1;
                    |BUCLE CamCopiaAlta;
                    |HAZ GrabaFic0;
                    |GRABA 020#1n;
               |FINSI;
          |FINSI;
          |CIERRA #1;
     |FINSI;
     |REPON_FICHA #41;
|FPRC;

|DEFBUCLE EmCopia;
     #200#1001;
     ;
     00001;
     99999;
     ;
     NULL, EmCopia;
|FIN;

|PROCESO Cargadef;
     |DDEF aDef;

     aAlfa = aDef + "agifa041"; |CARGA_DEF aAlfa, agifa041@;
     aAlfa = aDef + "agifa200"; |CARGA_DEF aAlfa, agifa200@;
     aAlfa = aDef + "agifa208"; |CARGA_DEF aAlfa, agifa208@;

     |SI aFic0 ! "";
          aDef0 = aDef + aFic0;
          |CARGA_DEF aDef0, refere0@;
          |SI FSalida ! 0;
               aAlfa = "0000ERROR al cargar + " aFic0;
               |MENAV aAlfa;
               aDef0 = ""; |ACABA;
          |FINSI;
     |FINSI;
     |SI aFic1 ! "";
          aDef1 = aDef + aFic1;
          |CARGA_DEF aDef1, refere1@;
          |SI FSalida ! 0;
               aAlfa = "0000ERROR al cargar + " aFic1;
               |MENAV aAlfa;
               aDef1 = "";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Descargadef;
     |SI aDef1 ! ""; |DESCARGA_DEF #refere1@; |FINSI;
     |SI aDef0 ! ""; |DESCARGA_DEF #refere0@; |FINSI;
     |DESCARGA_DEF #agifa208@;
     |DESCARGA_DEF #agifa200@;
     |DESCARGA_DEF #agifa041@;
|FPRC;

|PROCESO LeeParame;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa142";
     |CARGA_DEF aAlfa, agifa142@;
     |SI FSalida = 0;
          |ABRE #142; |LEE 000#142p; |CIERRA #142;
          aCopia = #142#28;
          |DESCARGA_DEF #agifa142@;
     |FINSI;
|FPRC;

|PROCESO Tipo15;
     |SI enSwNoCopia ! 0; |ACABA; |FINSI;
     |HAZ LeeParame;
     |SI aCopia ! "S"; |ACABA; |FINSI;

     nTipo = 15; |HAZ RodacalCopia;
     |SI FSalida = 0; |ACABA; |FINSI;

     nModo = 1;
     |HAZ Cargadef;
     |SI FSalida = 0;
          |BUCLE EmCopia;
          |HAZ Descargadef;
     |FINSI;
|FPRC;

|PROCESO Tipo16;
     |SI enSwNoCopia ! 0; |ACABA; |FINSI;
     |HAZ LeeParame;
     |SI aCopia ! "S"; |ACABA; |FINSI;

     nTipo = 16; |HAZ RodacalCopia;
     |SI FSalida = 0; |ACABA; |FINSI;

     nModo = 2;
     |HAZ Cargadef;
     |SI FSalida = 0;
          |BUCLE EmCopia;
          |HAZ Descargadef;
     |FINSI;
|FPRC;

|PROCESO Tipo17;
     |SI enSwNoCopia ! 0; |ACABA; |FINSI;
     |HAZ LeeParame;
     |SI aCopia ! "S"; |ACABA; |FINSI;

     nTipo = 17; |HAZ RodacalCopia;
     |SI FSalida = 0; |ACABA; |FINSI;

     nModo = 3;
     |HAZ Cargadef;
     |SI FSalida = 0;
          |BUCLE EmCopia;
          |HAZ Descargadef;
     |FINSI;
|FPRC;
------------------------------------------------------
|PROCESO &Copia023_15; |TIPO 15;
     nCamAlta = 13; nCamModi = 14; nCamBaja = 15;
     aFic0 = "agifa020";
     aFic1 = "agifa023";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia023_16; |TIPO 16;
     nCamAlta = 13; nCamModi = 14; nCamBaja = 15;
     aFic0 = "agifa020";
     aFic1 = "agifa023";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia023_17; |TIPO 17;
     nCamAlta = 13; nCamModi = 14; nCamBaja = 15;
     aFic0 = "agifa020";
     aFic1 = "agifa023";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia123_15; |TIPO 15;
     nCamAlta = 16; nCamModi = 17; nCamBaja = 18;
     aFic0 = "dsm00122";
     aFic1 = "dsm00123";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia123_16; |TIPO 16;
     nCamAlta = 16; nCamModi = 17; nCamBaja = 18;
     aFic0 = "dsm00122";
     aFic1 = "dsm00123";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia123_17; |TIPO 17;
     nCamAlta = 16; nCamModi = 17; nCamBaja = 18;
     aFic0 = "dsm00122";
     aFic1 = "dsm00123";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia095_15; |TIPO 15;
     nCamAlta = 19; nCamModi = 20; nCamBaja = 21;
     aFic0 = "agifa030";
     aFic1 = "agifa095";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia095_16; |TIPO 16;
     nCamAlta = 19; nCamModi = 20; nCamBaja = 21;
     aFic0 = "agifa030";
     aFic1 = "agifa095";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia095_17; |TIPO 17;
     nCamAlta = 19; nCamModi = 20; nCamBaja = 21;
     aFic0 = "agifa030";
     aFic1 = "agifa095";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia039_15; |TIPO 15;
     nCamAlta = 28; nCamModi = 29; nCamBaja = 30;
     aFic0 = "";
     aFic1 = "agifa039";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia039_16; |TIPO 16;
     nCamAlta = 28; nCamModi = 29; nCamBaja = 30;
     aFic0 = "";
     aFic1 = "agifa039";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia039_17; |TIPO 17;
     nCamAlta = 28; nCamModi = 29; nCamBaja = 30;
     aFic0 = "";
     aFic1 = "agifa039";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia310_15; |TIPO 15;
     nCamAlta = 31; nCamModi = 32; nCamBaja = 33;
     aFic0 = "";
     aFic1 = "agifa310";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia310_16; |TIPO 16;
     nCamAlta = 31; nCamModi = 32; nCamBaja = 33;
     aFic0 = "";
     aFic1 = "agifa310";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia310_17; |TIPO 17;
     nCamAlta = 31; nCamModi = 32; nCamBaja = 33;
     aFic0 = "";
     aFic1 = "agifa310";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia290_15; |TIPO 15;
     nCamAlta = 34; nCamModi = 35; nCamBaja = 36;
     aFic0 = "";
     aFic1 = "agifa290";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia290_16; |TIPO 16;
     nCamAlta = 34; nCamModi = 35; nCamBaja = 36;
     aFic0 = "";
     aFic1 = "agifa290";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia290_17; |TIPO 17;
     nCamAlta = 34; nCamModi = 35; nCamBaja = 36;
     aFic0 = "";
     aFic1 = "agifa290";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia117_15; |TIPO 15;
     nCamAlta = 37; nCamModi = 38; nCamBaja = 39;
     aFic0 = "";
     aFic1 = "dsm00117";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia117_16; |TIPO 16;
     nCamAlta = 37; nCamModi = 38; nCamBaja = 39;
     aFic0 = "";
     aFic1 = "dsm00117";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia117_17; |TIPO 17;
     nCamAlta = 37; nCamModi = 38; nCamBaja = 39;
     aFic0 = "";
     aFic1 = "dsm00117";
     |HAZ Tipo17;
|FPRC;

|PROCESO &Copia281_15; |TIPO 15;
     nCamAlta = 46; nCamModi = 47; nCamBaja = 48;
     aFic0 = "";
     aFic1 = "agifa281";
     |HAZ Tipo15;
|FPRC;
|PROCESO &Copia281_16; |TIPO 16;
     nCamAlta = 46; nCamModi = 47; nCamBaja = 48;
     aFic0 = "";
     aFic1 = "agifa281";
     |HAZ Tipo16;
|FPRC;
|PROCESO &Copia281_17; |TIPO 17;
     nCamAlta = 46; nCamModi = 47; nCamBaja = 48;
     aFic0 = "";
     aFic1 = "agifa281";
     |HAZ Tipo17;
|FPRC;

|PROCESO RodacalCopia;
     |SI eaRodExporta = "S"; |ACABA; |FINSI; || lo activa rodw0004

     |DBASE aPath;
     aPath = aPath + "/def/rodm0001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "rodm0005";
     |CARGA_DEF aDef, rodm0005@;
     |SI FSalida ! 0;
          |MENAV "0000ERROR al cargar 'rodm0005'";
     |SINO;
          |ABRE #rodm0005@;
          |LEE 000#rodm0005@.u;
          |SI FSalida = 0; nReg = #rodm0005@#0 + 1; |SINO; nReg = 1; |FINSI;
          |DDEFECTO #rodm0005@;
          #rodm0005@#0 = nReg;
          |SI aFic1 = "agifa023"; aClave = #agifa023#0 + "|" + #agifa023#1; |FINSI;
          |SI aFic1 = "dsm00123"; aClave = #dsm00123#0 + "|" + #dsm00123#1 + "|" + #dsm00123#2; |FINSI;
          |SI aFic1 = "agifa095"; aClave = #agifa095#0 + "|" + #agifa095#1; |FINSI;
          |SI aFic1 = "agifa039"; aClave = #agifa039#0 + "|" + #agifa039#1; |FINSI;
          |SI aFic1 = "agifa310"; aClave = #agifa310#0 + "|" + #agifa310#1 + "|" + #agifa310#2; |FINSI;
          |SI aFic1 = "agifa290"; aClave = #agifa290#0 + "|" + #agifa290#41; |FINSI;
          |SI aFic1 = "dsm00117"; aClave = #dsm00117#0; |FINSI;
          #rodm0005@#1 = aClave;
          #rodm0005@#2 = aFic1;
          |SI nTipo = 15; #rodm0005@#3 = "A"; |FINSI;
          |SI nTipo = 16; #rodm0005@#3 = "M"; |FINSI;
          |SI nTipo = 17; #rodm0005@#3 = "B"; |FINSI;
          |SELECT #3#rodm0005@;
          |LEE 101#rodm0005@.=;
          |SI FSalida ! 0; |GRABA 020#rodm0005@.b; |FINSI;
          aAlfa = Usuario % 810;
          #rodm0005@#4 = aAlfa;
          #rodm0005@#5 = ~;
          |HORA aAlfa;
          #rodm0005@#6 = aAlfa;
          |GRABA 020#rodm0005@.a;
          |CIERRA #rodm0005@;
          |DESCARGA_DEF #rodm0005@;
     |FINSI;
     FSalida = 0;
|FPRC;
