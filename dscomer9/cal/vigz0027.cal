|FICHEROS;
     vigz0027 #0;
     vigm0001 #1;
     vigm0002 #2;
     vigm0003 #3;
     vigw0018 #18; ||Tmp
     vigm0019 #19;
     vigm0020 #20;
     agifa019 #119;
|FIN;

|VARIABLES;
     &Tempo = "";
     &nUni = 0;
|FIN;

|PROCESO Tmp;
     |DDEFECTO #1;
     #1#0 = #18#0;
     |LEE 000#1=;

     |DDEFECTO #119;
     #119#0 = #18#0;
     |LEE 000#119=;

     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #18#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO LinFormula;
     |DDEFECTO #119;
     #119#0 = #3#2;
     |LEE 000#119=;

     |DDEFECTO #1;
     #1#0 = #3#2;
     |LEE 000#1=;

     |SI #1#1 ! "M"; |ACABA; |FINSI;

     nUni = #3#4 * #20#4 / #2#3;

     |DDEFECTO #18;
     #18#0 = #3#2;
     |LEE 101#18=;
     |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
     #18#1 = #3#3;
     #18#2 = #18#2 + nUni;
     #18#3 = #1#9;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE Formula;
     #2#2;
     ;
     #20#10;
     #20#10;
     ;
     NULL, NULL, LinFormula;
|FIN

|PROCESO vigm0020;
     |BUCLE Formula;
|FPRC;

|DEFBUCLE vigm0019;
     #19#2;
     ;
     #0#0, "     ", 000001;
     #0#0, "zzzzz", 999999;
     ;
     NULL, NULL, vigm0020;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "vigz0027";
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #18#Tempo#; |DELINDEX #18;
               |ABRE #1;
               |ABRE #119;
               |ABRE #18;
               |BUCLE vigm0019;
               |CIERRA #18;
               |BUCLE Tmp;
               |CIERRA #119;
               |CIERRA #1;
               |PIEINF;
               |FININF;
               |HAZ BoraTempo; |DELINDEX #18;
          |SINO;
               |MENAV "0000Error en informe 'vigz0027'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
