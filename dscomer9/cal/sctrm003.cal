|FICHEROS;
     sctrm003 #0;
     sctrm004 #1,MANTE;     || Pob.Transito (lineas, bot¢n)
     sctrm077 #77,MANTE;    || Pob.Enlace (lineas)

     sctrm002 #2;
     sctrm005 #5;
     sctrw005 #10; ||Tmp Pobla
     sctrm021 #21;
     sctrz025 #25,MANTE;
     sctrm001 #100;
     refere1@;
     refere2@;
|FIN;

|VARIABLES;
     &enPantaLogo = 0;
     &eaNomLogo = "";
     nPanta = 0;
     nModo = 0;
     nModoEntra = 0;
     aAlfa = "";
     nGrid1 = -1;
     nRango = 0;
     nForma = 0;
     nId = 0;
     nLin = 0;
     nBtnConsulta = -1;
     nBtnEnlace = -1;
     nPanCon = 0;
     &Tempo = "";
     nGrid = 0;
     &eaProg = "";
     &eaPobla = "";
     &enCtrFin = 0;
     nGridEnlace = 0;
|FIN;

|PROCESO Evento;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#77;
          |LEE 000#77=;
     |FINSI;
     |SI FSalida = 4;
     |FINSI;
|FPRC;

|PROCESO Min;
     #77#0 = #0#0;
     #77#1 = 001;
|FPRC;

|PROCESO Max;
     #77#0 = #0#0;
     #77#1 = 999;
|FPRC;

|PROCESO T3_14; |TIPO 14;    ||(*)
     |SI nGrid1 = -1;
          nRango = 1 + 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#77, nRango, 2102, 2998, Min, Max, Evento;
          nGrid1 = FSalida;
     |FINSI;
|FPRC;

|PROCESO T3_8; |TIPO 8; ||(*)
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |ABRET #77;
|FPRC;

|PROCESO T3_9; |TIPO 9; ||(*)
     |CIERRAT #77;
|FPRC;

|PROCESO BorraEnlace;
     |BORRA 020#77a;
|FPRC;

|DEFBUCLE BorraEnlace;
     #77#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, BorraEnlace;
|FIN;

|PROCESO BorraTransito;
     |BORRA 020#1a;
|FPRC;

|DEFBUCLE BorraTransito;
     #1#1;
     ;
     #0#0, 01;
     #0#0, 99;
     be;
     NULL, BorraTransito;
|FIN;

|PROCESO T3_2; |TIPO 2; ||(*)
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nModo = 3;
          |BUCLE BorraTransito;
          |BUCLE BorraEnlace;
     |FINSI;
|FPRC;

|PROCESO T3_0; |TIPO 0;     ||(*)
     ||* porque las lineas no son obligatorias
     aAlfa  = "|X000"; aAlfa = #0aAlfa; nId = aAlfa;
     ||ESTADO_CONTROL nId, "ENABLE";
     ||*

     |REFRESCACONTROL nGrid1;
|FPRC

|PROCESO T3_12; |TIPO 12;    ||(*)
     |SI nModoEntra = 1; |Y FSalida = 7;
          |BUCLE BorraTransito;
          |BUCLE BorraEnlace;
     |FINSI;
|FPRC;

|PROCESO T3_30; |TIPO 30;    ||(*)
/*
     nModo = (FEntrada / 100) ! 0;

     #77#0 = #0#0;
     #77#1 = 1;
     |LEE 000#77];
     |SI FSalida ! 0; |O #77#0 ! #0#0;
          |SI nModo = 1;
               |MENAV "0000Se anulan los datos entrados.";
          |SINO;
               |MENAV "0000No existen lineas, se borra la cabecera.";
          |FINSI;
          |BORRA 020#0a;
          |ERROR;
     |FINSI;
*/
|FPRC;

|PROCESO T3_13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |PINPA #0#0; nPanta = FSalida;
     eaNomLogo = #100#1;
     |HAZ TraeLogoPan;
     enPantaLogo = nPanta;
     |HAZ PintaLogoPan;
     |HAZ PinZonaTari;
     |HAZ PinPobInt;
     |SI nBtnConsulta = -1;
          aAlfa = "BOTON,{{155}}Consulta" + &13 + "Poblaciones";
          |CONTROL_SIMPLE nPanta, aAlfa, 986, 1098, BtnConsulta;
          nBtnConsulta = FSalida;

          aAlfa = "BOTON,{{133}}Poblaciones Transito";
          |CONTROL_SIMPLE nPanta, aAlfa, 1286, 1298, BtnTransito;
          nBtnEnlace = FSalida;
     |FINSI;
|FPRC;

|PROCESO T3_20; |TIPO 20;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = "OPCION";
          |ESTADO_CONTROL nBtnConsulta, "ENABLE";
          FSalida = "";
     |SINO;
     |FINSI;
|FPRC;

|PROCESO T3_7; |TIPO 7;
     nModoEntra = (FEntrada / 100) ! 0;
     |SI nModoEntra = 1;
          aAlfa  = "|X000"; aAlfa = #0aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO T3_1_7; |TIPO 7;
     nModoEntra = (FEntrada / 100) ! 0;
     |SI nModoEntra = 1;
          |BUCLE BorraTransito;
          |BUCLE BorraEnlace;
          |REFRESCACONTROL nGrid1;
     |FINSI;
     |ESTADO_CONTROL nBtnConsulta, "DISABLE";
|FPRC;

|PROCESO DefeLin; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #1#0 = #0#0;
          #1#1 = 99;
          |LEE 000#1];
          |SI FSalida = 0;
               |LEE 000#1a;
          |SINO;
               |LEE 000#1u;
          |FINSI;
          |SI FSalida = 0; |Y #1#0 = #0#0;
               nLin = #1#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = nLin; |PINTA #1#1;
/*
          aAlfa  = "|X000"; aAlfa = #0aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "ENABLE";
*/
     |FINSI;
|FPRC;

|PROCESO Pais; |TIPO 0;
     |ABRE #5;
     #5#0 = #0#3;
     |LEE 000#5=;
     |SI FSalida = 0;
          #0#4 = #5#1; |PINTA #0#4;
     |SINO;
          |MENAV "0000No existe c¢digo de pais...";
          |ERROR;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO ZonaTari; TIPO 0;
     |SI #0#12 ! "  ";
          |ABRE #2;
          #2#0 = #0#12;
          |LEE 000#2=;
          |SI FSalida ! 0;
               |MENAV "0000No existe c¢digo zona de tarificaci¢n...";
               |ERROR;
          |SINO;
               |HAZ PinZonaTari;
          |FINSI;
          |CIERRA #2;
     |SINO;
          |HAZ PinZonaTari;
     |FINSI;
|FPRC;

|PROCESO PinZonaTari;
     |ABRE #2;
     #2#0 = #0#12;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
     |CIERRA #2;
     |PINTA 1858, #2#1;
|FPRC;

|PROCESO PinPobInt;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm003";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          #refere2@#0 = #0#13;
          |LEE 000#refere2@.=;
          |SI FSalida ! 0; |DDEFECTO #refere2@; |FINSI;
          |CIERRA #refere2@;
          |PINTA 1958, #refere2@#1;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO PobInt0; |TIPO 0;
     |SI #0#13 ! "    ";
          |DDEF aAlfa;
          aAlfa = aAlfa + "sctrm003";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere1@;
               #refere1@#0 = #0#13;
               |LEE 000#refere1@.=;
               |SI FSalida = 0;
                    |HAZ PinPobInt;
               |SINO;
                    |MENAV "0000No existe c¢digo de poblaci¢n...";
                    |ERROR;
               |FINSI;
               |CIERRA #refere1@;
               |DESCARGA_DEF #refere1@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PobInt66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm003";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #0#13;
          |LEE 000#refere1@.];
          |CONSULTA_CLAVE #1#refere1@;
          |SI FSalida = 0;
               #0#13 = #refere1@#0; |PINTA #0#13;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO PobInt7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #0#13 = "    "; |Y nModo = 1;
          #0#13 = #100#17; |PINTA #0#13;
          |HAZ PinPobInt;
     |FINSI;
|FPRC;

|PROCESO CodPobla0; |TIPO 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm003";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #1#2;
          |LEE 000#refere1@.=;
          |SI FSalida = 0;
               #1#3 = #refere1@#1; |PINTA #1#3;
          |SINO;
               |MENAV "0000No existe c¢digo de poblaci¢n...";
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO CodPobla66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm003";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #1#2;
          |LEE 000#refere1@.];
          |CONSULTA_CLAVE #1#refere1@
          |SI FSalida = 0;
               #1#2 = #refere1@#0; |PINTA #1#2;
               #1#3 = #refere1@#1; |PINTA #1#3;
          |SINO;
               |MENAV "0000No existe c¢digo de poblaci¢n...";
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO BtnSalir;
     |PTEC 807;
|FPRC;

|PROCESO TraKms;
     |SI #25#2 = "O";
          #10#0 = #21#2;
          #10#1 = #21#3;
     |SINO;
          #10#0 = #21#4;
          #10#1 = #21#5;
     |FINSI;
     |GRABA 000#10n;
|FPRC;

|DEFBUCLE TraKms;
     #21#1;
     ;
     #25#0, "    ", "    ";
     #25#0, "zzzz", "zzzz";
     ;
     NULL, TraKms;
|FIN;

|PROCESO Evento10;
     |SI FSalida = 4;
          eaProg = "sctrz026";
          eaPobla = #10#0;
          |HAZ EjecutaProg;
     |FINSI;
|FPRC;

|PROCESO Ptec; |TIPO 0;
     |PTEC 806;
|FPRC;

|PROCESO BtnConsulta;
     |HAZ CreaTempo; |NOME_DAT #10 Tempo; |DELINDEX #10; |ABRET #10;

     |VENTANA 1001, 2898, -1, 17, "Incorporar Trayectos Origen/Destino";
     |HAZ PushVenModal;
     |DDEFECTO #25;
     |PINPA #0#25; nPanCon = FSalida;
     |PINDA #0#25;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#10, nRango, 0802, 2298, NULL, NULL, Evento10;
     nGrid = FSalida;
     |CONTROL_SIMPLE nPanCon, "BOTON,{{001}}Salir", 2487, 2497, BtnSalir;
     FSalida = "::ENDATOS::SINBOTONES::";
     |ENDATOS #1#25;
     |CIERRAT #10; |DELINDEX #10; |ABRET #10;
     |BUCLE TraKms;
     |REFRESCACONTROL nGrid;
     enCtrFin = nGrid;
     |HAZ EsperaFin;
     |HAZ PopVenModal;

     |CIERRAT #10; |DELINDEX #10; |HAZ BoraTempo;
|FPRC;

|PROCESO DefeLin77; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #77#0 = #0#0;
          #77#1 = 999;
          |LEE 000#77];
          |SI FSalida = 0;
               |LEE 000#77a;
          |SINO;
               |LEE 000#77u;
          |FINSI;
          |SI FSalida = 0; |Y #77#0 = #0#0;
               nLin = #77#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #77;
          #77#0 = #0#0;
          #77#1 = nLin; |PINTA #77#1;
     |FINSI;
|FPRC;

|PROCESO CodPobla77_0; |TIPO 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm003";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #77#2;
          |LEE 000#refere1@.=;
          |SI FSalida = 0;
               #77#3 = #refere1@#1; |PINTA #77#3;
          |SINO;
               |MENAV "0000No existe c¢digo de poblaci¢n...";
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO CodPobla77_66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm003";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #77#2;
          |LEE 000#refere1@.];
          |CONSULTA_CLAVE #1#refere1@
          |SI FSalida = 0;
               #77#2 = #refere1@#0; |PINTA #77#2;
               #77#3 = #refere1@#1; |PINTA #77#3;
          |SINO;
               |MENAV "0000No existe c¢digo de poblaci¢n...";
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO Min1;
     #1#0 = #0#0;
     #1#1 = 01;
|FPRC;

|PROCESO Max1;
     #1#0 = #0#0;
     #1#1 = 99;
|FPRC;

|PROCESO BtnTransito;
     |ABRET #1;
     |VENTANA 2001, 2898, -1, 17, "Poblaciones Transito";
     |HAZ PushVenModal;
     nRango = 1 + 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#1, nRango, 2002, 2698, Min1, Max1, NULL;
     nGridEnlace = FSalida;
     enCtrFin = nGridEnlace;
     |HAZ EsperaFin;
     |DESTRUYECONTROL nGridEnlace;
     |HAZ PopVenModal;
     |CIERRAT #1;
|FPRC;
