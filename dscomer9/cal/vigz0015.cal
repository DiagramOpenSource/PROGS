alba0011

|FICHEROS;
vigz0015 #0;
agifa071 #1;
agifa010 #2;
agifa019 #3;
vigw0013 #5;   ||Temporal.
agifa007;
vigm0043 #43;
|FIN;

|VARIABLES;
aSerie = "";
&Tempo = "";
informe   = "";
fecha     = @;
fecha_inf = "";
fecha_sup = "";
&familia  = "";
mes       = "";
mes1      = 0;
i         = 0;
sw        = 0;
&swlin    = 0;
&t1       = 0;
&t2       = 0;
&t3       = 0;
&t4       = 0;
&t5       = 0;
&t6       = 0;
&t7       = 0;
&t8       = 0;
&t9       = 0;
&t10      = 0;
&t11      = 0;
&t12      = 0;
&t13      = 0;
&tt1      = 0;
&tt2      = 0;
&tt3      = 0;
&tt4      = 0;
&tt5      = 0;
&tt6      = 0;
&tt7      = 0;
&tt8      = 0;
&tt9      = 0;
&tt10     = 0;
&tt11     = 0;
&tt12     = 0;
&tt13     = 0;
|FIN;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|CALCULO ao;|TIPO 7;
fecha = ~;
#0#0 = fecha % 0704;
|PINTA #0#0;
|FCAL;

|CALCULO pasa_lin;
     |DDEFECTO #2;
     #2#52 = #1#29;
     #2#0 = #1#0;
     |LEE 000#2=;

     aSerie = #agifa010#52;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #3;
     #3#0 = #1#2;
     |LEE 000#3=;

     |SI #2#1 ] fecha_inf;|Y #2#1 [ fecha_sup;
         |SI #3#2 ] #0#3;|Y #3#2 [ #0#4;
             |DDEFECTO #5;
             #5#0 = #3#2;
             #5#1 = #1#2;
             |LEE 101#5=;
             |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
             mes  = #2#1 % 402;
             mes1 = mes + 2;
             #5#0 = #3#2;
             #5#1 = #1#2;
             #5#2 = #3#1;
             #5mes1 = #5mes1 + #1#5;
             #5#15  = #5#15 + #1#5;
             |GRABA 020#5a;
             |LIBERA #5;
         |FINSI;
     |FINSI;
|FCAL;

|DEFBUCLE lee_lin;
     #1#1;
     ;
     #0#1 , 000001,  0;
     #0#2 , 999999,999;
     be;
     NULL,pasa_lin;
|FIN;

|CALCULO imprime;
|SI sw = 0;
    sw = 1;
    familia = #5#0;
    swlin = 2;
    |PRINT;
    swlin = 0;
|FINSI;

|SI familia ! #5#0;|Y sw = 1;
    swlin = 1;
    |PRINT;
    swlin = 0;
    familia = #5#0;
    swlin = 2;
    |PRINT;
    swlin = 0;
    t1 = 0;
    t2 = 0;
    t3 = 0;
    t4 = 0;
    t5 = 0;
    t6 = 0;
    t7 = 0;
    t8 = 0;
    t9 = 0;
    t10 = 0;
    t11 = 0;
    t12 = 0;
    t13 = 0;
|FINSI;

t1 = t1 + #5#3;
t2 = t2 + #5#4;
t3 = t3 + #5#5;
t4 = t4 + #5#6;
t5 = t5 + #5#7;
t6 = t6 + #5#8;
t7 = t7 + #5#9;
t8 = t8 + #5#10;
t9 = t9 + #5#11;
t10 = t10 + #5#12;
t11 = t11 + #5#13;
t12 = t12 + #5#14;
t13 = t13 + #5#15;

tt1 = tt1 + #5#3;
tt2 = tt2 + #5#4;
tt3 = tt3 + #5#5;
tt4 = tt4 + #5#6;
tt5 = tt5 + #5#7;
tt6 = tt6 + #5#8;
tt7 = tt7 + #5#9;
tt8 = tt8 + #5#10;
tt9 = tt9 + #5#11;
tt10 = tt10 + #5#12;
tt11 = tt11 + #5#13;
tt12 = tt12 + #5#14;
tt13 = tt13 + #5#15;
|PRINT;
|FCAL;

|DEFBUCLE impresion;
#5#1;
;
INICIO;
FINAL;
be;
NULL,imprime;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #3;
     #3#0 = #43#12;
     |LEE 000#3=;

     |DDEFECTO #5;
     #5#0 = #43#11;
     #5#1 = #43#12;
     |LEE 101#5=;
     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
     mes  = #43#6 % 402;
     mes1 = mes + 2;
     #5#0 = #43#11;
     #5#1 = #43#12;
     #5#2 = #3#1;
     #5mes1 = #5mes1 + #43#13;
     #5#15 = #5#15 + #43#13;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     11, 6;
     #0#1, 000001, 001, #0#3, fecha_inf;
     #0#2, 999999, 999, #0#4, fecha_sup;
     ;
     NULL, HistoTras;
|FIN;

|PROCESO Calculo;
     fecha_inf = "01.01." + #0#0;
     fecha_sup = "31.12." + #0#0;
     |ABRE #3;
     |ABRE #5;
     |ABRE #2;
     |BUCLE lee_lin;
     |CIERRA #2;
     |BUCLE HistoTras;
     |CIERRA #5;
     |CIERRA #3;
     |BUCLE impresion;
     swlin = 1;
     |PRINT;
     swlin = 0;
|FPRC;

|CALCULO alba0011;|TIPO 3;
     |SI #0#5 = "SI";|O #0#5 = "si";
         |HAZ CreaTempo; |NOME_DAT #5 Tempo; |DELINDEX #5;

         |IMPRE 0;
         |SI FSalida = 0;
             |SI #0#7 = "S";
                  informe = "vigcry15";
             |SINO;
                  informe = "vigz0015";
             |FINSI;
             |INFOR informe;
             |SI FSalida = 0;
                 |HAZ Calculo;
                 |PIEINF;
                 |FININF;
             |FINSI;
             |FINIMP;
         |FINSI;

         |HAZ BoraTempo; |DELINDEX #5;
     |FINSI;
|FCAL;
