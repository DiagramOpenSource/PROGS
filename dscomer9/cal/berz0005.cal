|FICHEROS;
     berz0005 #0;
     berm0008 #8;
     agifa017 #17;
     agifa019 #19;
     dsm00052 #52;
     agifa073 #73;
     agifa074 #74;
     agifa090 #90;
     agifa104 #104;
     agifa142 #142;
|FIN;

|VARIABLES;
     &ser_ped = "";
     &num_ped = 0;
     &eaArticulo = "";
     &eaSerie = "";
     &enOrden = 0;
     nHay = 0;
     nCrea = 0;
     nLin = 0;
     aAlfa = "";
|FIN;

|PROCESO UltLin;
     #52#6 = #74#9;
     #52#0 = #74#0;
     #52#1 = #74#1;
     #52#2 = 999;
     |LEE 000#52];
     |SI FSalida = 0;
          |LEE 000#52a;
     |SINO;
          |LEE 000#52u;
     |FINSI;
     |SI FSalida = 0; |Y #52#6 = #74#9; |Y #52#0 = #74#0; |Y #52#1 = #74#1;
          nLin = #52#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
|FPRC;

|PROCESO Berm0008;
     |DDEFECTO #52;
     #52#6 = #74#9;
     #52#0 = #74#0;
     #52#1 = #74#1;
     #52#2 = #8#6;

     aAlfa = #8#16; |QBF aAlfa;
     |SI aAlfa = "";
          #52#3 = #8#3;
     |SINO;
          #52#3 = #8#16;
     |FINSI;
     #52#4 = #8#5;
     #52#5 = #8#4;
     #52#9 = #8#9;
     #52#11 = #74#2;
     |GRABA 020#52n;

     |DDEFECTO #19;
     #19#0 = #52#3;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     |DDEFECTO #17;
     #17#0 = #52#3;
     #17#1 = #52#5;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     #19#12 = #19#12 + #52#4;
     #19#104 = #19#104 + #52#4;
     #17#8 = #17#8 + #52#4;
     #17#39 = #17#39 + #52#4;

     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|DEFBUCLE Berm0008;
     #8#1;
     ;
     #73#28, #73#0, #73#1, 001;
     #73#28, #73#0, #73#1, 999;
     ;
     NULL, Berm0008;
|FIN;

|PROCESO CreaLin;
     |DDEFECTO #74;
     #74#9 = #73#28;
     #74#0 = #73#0
     #74#1 = #73#1

     #74#2 = #73#2;
     #74#3 = #73#4;
     #74#4 = #73#5;
     #74#7 = #73#3;
     #74#8 = ~;
     #74#10 = #73#45;
     #74#11 = #73#5;
     |GRABA 020#74n;
     |BUCLE Berm0008;

     |DDEFECTO #19;
     #19#0 = #74#2;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     |DDEFECTO #17;
     #17#0 = #74#2;
     #17#1 = #74#7;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     #19#13 = #19#13 + #74#4;
     #17#9 = #17#9 + #74#4;

     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|PROCESO CreaCab;
     |DDEFECTO #90;
     #90#20 = #104#25;
     #90#0 = #104#0;
     |LEE 000#90=;
     |SI FSalida ! 0;
          |GRABA 020#90n;
     |FINSI;
|FPRC;

|PROCESO agifa073;
     eaArticulo = #73#2;
     |HAZ EsKit;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nHay = 1;

     #74#9 = #73#28;
     #74#0 = #73#0;
     #74#1 = #73#1;
     |LEE 000#74=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI PARAMETRO = "PREGUNTA";
          |CONFI "0000NCrear orden de fabricación?";
          |SI FSalida ! 0; |ERROR10; |ACABA; |FINSI;
     |FINSI;

     nCrea = 1;
     |HAZ CreaCab;
     |HAZ CreaLin;
|FPRC;

|DEFBUCLE agifa104;
     #104#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, NULL, agifa073;
|FIN;

|PROCESO T3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #90;
     |ABRE #74;
     |ABRE #52;
     |ABRE #19;
     |ABRE #17;
     |BUCLE agifa104;
     |CIERRA #17;
     |CIERRA #19;
     |CIERRA #52;
     |CIERRA #74;
     |CIERRA #90;
     |SI nHay = 1;
          |SI nCrea = 0;
               |SI PARAMETRO ! "PREGUNTA";
                    |MENAV "0000Las lineas de orden ya existen...";
               |FINSI;
          |SINO;
               |CONFI "0000NImprimir orden fabricación?";
               |SI FSalida = 0;
                    eaSerie = #90#20;
                    enOrden = #90#0;
                    |SUB_EJECUTA_NP "berz0006";
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000El pedido no tiene ningun KIT...";
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI num_ped = 0;
          |MANTE #0;
     |SINO;
          #0#0 = ser_ped;
          #0#1 = num_ped;
          |HAZ T3;
     |FINSI;
|FPRO;
