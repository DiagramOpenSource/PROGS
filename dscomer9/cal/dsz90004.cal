|FICHEROS;
     agifa017 #17;
     refere1@;
     refere2@;
|FIN;

|VARIABLES;
     &enOk5050 = 0;
     &eaSerie = 0;
     &enCodigo = 0;
     &enLinea = 0;
     &enModo = 0;
     nTipo = 0;
     aAlfa = "";
     aPath = "";
     fFecha = @;
     fHoy = @;
     nPendiente = 0;
|FIN;

|PROCESO &Alm16; |TIPO 16;
     nTipo = 16;
     |HAZ StockOk5050;
|FPRC;

|PROCESO &Alm17; |TIPO 17;
     nTipo = 17;
     |HAZ StockOk5050;
|FPRC;

|PROCESO PCompras;
     |SI enModo = 3; |Y eaSerie = #refere2@#28; |Y enOk5050 = 1;
               |Y enCodigo = #refere2@#0; |Y enLinea = #refere2@#1;
          |ACABA;
     |FINSI;

     nPendiente = #refere2@#5 - #refere2@#38;
     |SI nPendiente > 0;
          |SI fFecha > #refere2@#13; |O fFecha [ fHoy;
               |SI fFecha = "31.12.9999";
                    fFecha = #refere2@#13;
               |FINSI;
               |SI #refere2@#13 > fHoy
                    fFecha = #refere2@#13;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE PCompras;
     #refere2@#3004;
     ;
     #17#0, "     ", 000001, "      ";
     #17#0, "zzzzz", 999999, "zzzzzz";
     ;
     NULL, PCompras;
|FIN;

|PROCESO StockOk5050;
     |DDEF aPath;
     aAlfa = aPath + "okm00007";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          aAlfa = aPath + "agifa067";
          |CARGA_DEF aAlfa, refere2@;
          |SI FSalida = 0;
               |ABRE #refere1@;
               #refere1@#0 = #17#0;
               #refere1@#1 = #17#1;
               |LEE 101#refere1@.=;
               |SI nTipo = 17;
                    |SI FSalida = 0; |BORRA 000#refere1@.a; |FINSI;
               |SINO;
                    |SI FSalida ! 0; |GRABA 020#refere1@.b; |FINSI;
                    #refere1@#2 = #17#39;
                    |SI #17#43 > 0;
                         fFecha = "31.12.9999";
                         fHoy = ~;
                         |BUCLE PCompras;
                         #refere1@#3 = fFecha;
                    |SINO;
                         #refere1@#3 = "01.01.0000";
                    |FINSI;
                    |GRABA 020#refere1@.a;
               |FINSI;
               |CIERRA #refere1@;
               |DESCARGA_DEF #refere2@;
          |FINSI;
          |DESCARGA_DEF #refere1@;
     |FINSI;

     enOk5050 = 0;
|FPRC;
