|FICHEROS;
     evarz012 #0;
     evarm005 #1;
     evarm004 #2;
     evarm021 #21;
     evarm029 #29;
     evarm030 #30;
|FIN;

|VARIABLES;
     barra = "";
     alfa = "";
     modista = "";
     aPed = "";
     aLin = "";
     nBotonImg = -1;
     {1}aLocal = "";
     aLon = "";
     aOrg = "";
     aDes = "";
     aNom = "";
     aCar = "";
     i = 0;
     nPos = 0;
     {1}aContiene = "";
     aMd5Org = "";
     aMd5Des = "";
     aIPRemoto = "";
|FIN;

|PROCESO ModiSituBarra;
     |ABRE #21;
     |SELECT #5#21;
     #21#0 = #1#0;
     |LEE 101#21=;
     |SI FSalida = 0;
          #21#8 = #1#3;
          |GRABA 020#21a;
     |FINSI;
     |CIERRA #21;
|FPRC;

|PROGRAMA;
  |CLS;
  |CABEZA "Situacion Recibido de";
  |ABRE #1;
  |DDEFECTO #0;
  |PINPA #0#0;
  |PINDA #0#0;
  |HAZ Boton;
  |ENCAMPO #2#0;
  modista = #0#2;
  |PARA; |SI; |HACIENDO;
        |DDEFECTO #0;
        |PINDA #0#0;
        #0#2 = modista;
        |PINTA #0#2;
        |ENCAMPO #0#0;
        |SI FSalida ! 0; |SAL; |FINSI;

        barra = #0#0 % 112;
        #1#0 = barra;
        |LEE 101#1=;
        |SI 0 = FSalida;
                #1#2 = "3";
                alfa = "RECIBIDO DE ";
                alfa = alfa + #0#2;
                #1#3 = alfa;
                #1#12 = ~;
                #1#15 = #0#2;
            |GRABA 020#1a;
            |HAZ PintaImg;
            |HAZ ModiSituBarra;
            #0#1 = 1;
        |SINO;
            |MENAV "    Inexistente ...";
        |FINSI;
        |LIBERA #1;
  |SIGUE;
  |CIERRA #1;
  |FIN_CONTROL_WINDOWS nBotonImg;
|FPRO;

|PROCESO SacaNombre;
     aLon = aOrg % A0;
     aNom = "";
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = -(i * 100 + 1)
          aCar = aOrg % nPos;
          |SI aCar = "\"; |O aCar = "/"; |SAL; |FINSI;
          aNom = aCar + aNom;
     |SIGUE;
|FPRC;

|PROCESO PintaImg;
     aPed = #1#0 % 106;
     aLin = #1#0 % 702;
     |DDEFECTO #2;
     |ABRE #2;
     #2#30 = #1#1;
     #2#31 = aPed;
     #2#32 = aLin;
     |LEE 020#2=;
     |CIERRA #2;
     |DDEFECTO #29;
     |ABRE #29;
     #29#0 = #2#29;
     |LEE 000#29=;
     |CIERRA #29;
     |HAZ Boton;
|FPRC;

|PROCESO Boton;
     |SI nBotonImg ! -1;
          |FIN_CONTROL_WINDOWS nBotonImg;
     |FINSI;
     |ABRE #30; |LEE 000#30p; |CIERRA #30;
     aOrg = #30#1; |QBF aOrg;
     aOrg = aOrg + #29#1; |QBF aOrg;
     |HAZ SacaNombre;
     |ESPECIFICA "RBASS", aLocal;
     aDes = aLocal;
     aDes = aDes + "img/";
     |RMKDIR aDes;
     aDes = aDes + aNom;
     |HAZ TraeImg;
     |SI aNom = "";
          aDes = "BOTON, Sin imagen";
     |SINO;
          aDes = "IMAGEN," + aDes;
     |FINSI;
     ||CONTROL_SIMPLE 0, aDes, 0842, 1969, NULL;
     |CONTROL_SIMPLE 0, aDes, 0842, 2479, NULL;
     nBotonImg = FSalida;
|FPRC;

|PROCESO TraeImg;
     aContiene1 = aDes;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aMd5Des = FSalida;

     aContiene1 = aOrg;
     |ESPECIFICA "MD5", aContiene;
     aMd5Org = FSalida;

     |QBF aMd5Des;
     |QBF aMd5Org;

     |SI aMd5Des ! aMd5Org; |O aMd5Des = "";
          aIPRemoto = "";
          |IP_REMOTO aIPRemoto;
          |QBT aIPRemoto;

          |SI aIPRemoto ! "";
               |ENVIA_FICHERO aOrg, aDes;
          |SINO;
               |COPIA_FICHERO aOrg, aDes;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO F5; |TIPO 0;
     |SI FSalida = 13;
          |CONSULTA_CLAVE #1#1;
          |SI FSalida = 0;
               #0#0 = #1#0; |PINTA #0#0;
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;
