|FICHEROS;
     malpe160 #0;
     malpe154 #154;
     malpe155 #155; ||Calendario
     malpe156 #156; ||partes
     malpe157 #157;
     malpe158 #158;
     malpe159 #159; ||Resumen
     malpe170 #170; ||Tmp dias Trabajados
|FIN;

|VARIABLES;
     &Tempo = "";
     f = @;
     nHoras1 = 0;
     nNormal = 0;
     nExtraN = 0;
     nExtraE = 0;
     nTraba = -1;
     nPrime = 0;
     nTipoCal = 0;
     aDFecha = "";
     aHFecha = "";
     aAlfa = "";
     fFecha = @;
     fFec = @;
     nNocturno = 0;
     nHoraTra = 0;
     nHoraFes = 0;
     nHoraLic = 0;
     nDias = 0;
     aA¤o = "";
     aMes = "";
|FIN;

|PROCESO DiasFestivos;
     |SI #155#2 = 0; |Y #155#3 = 0; |Y #155#4 = 0;
          nDias = nDias + 1;
     |FINSI;
|FPRC;

|DEFBUCLE DiasFestivos;
     #155#1;
     ;
     #154#4, aDFecha;
     #154#4, aHFecha;
     ;
     NULL, DiasFestivos;
|FIN;

|PROCESO DiasTraba;
     |SI #170#4 = "S";
          #159#19 = #159#19 + 1;
     |FINSI;
|FPRC;

|DEFBUCLE DiasTraba;
     #170#1;
     ;
     #159#0, #159#1, #159#2, 00;
     #159#0, #159#1, #159#2, 99;
     ;
     NULL, DiasTraba;
|FIN;

|PROCESO Resumen;
     |SI #159#3 ! 1;
          |DDEFECTO #154;
          #154#0 = #159#0;
          |LEE 000#154=;

          aAlfa = "01." + (("00" + #159#2) % -102) + "." + (("0000" + #159#1) % -104);
          |HAZ SacaMes;
          |SI #154#2 > aDFecha; |Y aDFecha < #154#3;
               aDFecha = #154#2;
          |FINSI;
          |SI aDFecha > #154#3; aDFecha = ""; |FINSI;
          |SI #154#3 < aHFecha; |Y aHFecha > #154#2;
               aHFecha = #154#3;
          |FINSI;
          |SI aHFecha < #154#2; aHFecha = ""; |FINSI;
          nDias = 0;
          |SI aHFecha ! ""; |Y aDFecha ! "";
               |PARA f = aDFecha; |SI f [ aHFecha; |HACIENDO f = f + 1;
                    nDias = nDias + 1;
               |SIGUE;
          |FINSI;
          #159#13 = nDias;
          nDias = 0;
          |BUCLE DiasFestivos;
          #159#15 = nDias;
          #159#17 = (((#159#13 / 7)*40) ! 0) - (#159#15 * 8);
          #159#18 = #159#12 - #159#17;
          #159#7 = #159#18 * #154#6 / 100;
          #159#8 = #159#18 - #159#7;
     |FINSI;

     #159#19 = 0;
     |BUCLE DiasTraba;

     |GRABA 020#159a;
     |LIBERA #159;
|FPRC;

|DEFBUCLE Resumen;
     #159#1;
     ;
     #0#1, #0#3, #0#4;
     #0#2, #0#3, #0#5;
     be;
     NULL, Resumen;
|FIN;


|PROCESO SacaMes;
     aMes = aAlfa % 402;
     aA¤o = aAlfa % 704;
     aDFecha = "01." + aMes + "." + aA¤o;
     aHFecha = "27." + aMes + "." + aA¤o;
     |PARA; |SI; |HACIENDO;
          fFec = aHFecha;
          fFec = fFec + 1;
          aAlfa = fFec % 402;
          |SI aMes ! aAlfa; |SAL; |FINSI;
          aHFecha = fFec;
     |SIGUE;
|FPRC;

|PROCESO Calculo2;
     #159#12 = #159#12 + nHoraTra;
     #159#14 = #159#14 + nHoraFes;
     #159#16 = #159#16 + nHoraLic;
     #159#11 = #159#11 + nNocturno;

     aAlfa = #156#1;
     |HAZ SacaMes;

     nDias = 0;
     |SALVA_DATOS #155;
     |BUCLE DiasFestivos;
     |REPON_DATOS #155;
     #159#15 = nDias;
|FPRC;

|PROCESO Calculo1;
     nNormal = nHoras1;
     |SI nNormal > #155#2;
          nExtraN = nNormal - #155#2;
          nNormal = #155#2;
     |FINSI;
     |SI nExtraN > #155#3;
          nExtraE = nExtraN - #155#3;
          nExtraN = #155#3;
     |FINSI;

     #159#4 = #159#4 + nNormal;
     #159#5 = #159#5 + nExtraN;
     #159#6 = #159#6 + nExtraE;

     #159#7 = #159#5 * #154#6 / 100;    || Emp1
     #159#8 = #159#5 - #159#7;          || Emp2

     #159#9 = #159#6 * #154#6 / 100;    || Emp1
     #159#10 = #159#6 - #159#9;         || Emp2

     #159#11 = #159#11 + nNocturno;
|FPRC;

|PROCESO Acumula;
     |DDEFECTO #159;
     #159#0 = nTraba;
     aAlfa = fFecha % 704;
     #159#1 = aAlfa;
     aAlfa = fFecha % 402;
     #159#2 = aAlfa;
     |LEE 101#159=;
     |SI FSalida ! 0; |GRABA 020#159b; |FINSI;
     |SI nTipoCal = 1;
          |HAZ Calculo1;
     |SINO;
          |HAZ Calculo2;
     |FINSI;
     #159#3 = #154#7;    || Tipo calculo
     |GRABA 020#159a;
     |LIBERA #159;
|FPRC;

|PROCESO Partes;
     |SI nTraba ! #156#0; |O fFecha ! #156#1;
          |SI nPrime ! 0; |HAZ Acumula; |FINSI;
          nPrime = 1;
          nHoras1 = 0;
          nExtraN = 0;
          nExtraE = 0;
          nNocturno = 0;
          nHoraTra = 0;
          nHoraFes = 0;
          nHoraLic = 0;
          nTraba = #156#0;
          fFecha = #156#1;
     |FINSI;

     |DDEFECTO #154;
     #154#0 = #156#0;
     |LEE 000#154=;

     |DDEFECTO #155;
     #155#0 = #154#4;
     #155#1 = #156#1;
     |LEE 000#155=;

     nHoras1 = nHoras1 + #156#4;
     |SI #156#3 = "T"; |O #156#3 = "S"; || Trabajadas o Sabado Tarde
          nHoraTra = nHoraTra + #156#4;
          |SI #156#3 = "S"; |O #155#2 = 0;
               nHoraFes = nHoraFes + #156#4;
          |FINSI;
     |FINSI;
     |SI #156#3 = "L";
          nHoraLic = nHoraLic + #156#4;
     |FINSI;

     |SI #156#5 = 2;
          nNocturno = 1;
     |FINSI;

     nTipoCal = #154#7;

     |DDEFECTO #157;
     #157#0 = #156#3;
     |LEE 000#157=;

     |DDEFECTO #170;
     #170#0 = #156#0;
     aAlfa = #156#1 % 704;
     #170#1 = aAlfa;
     aAlfa = #156#1 % 402;
     #170#2 = aAlfa;
     aAlfa = #156#1 % 102;
     #170#3 = aAlfa;
     |LEE 101#170=;
     |SI FSalida ! 0; |GRABA 020#170b; |FINSI;
     |SI #156#3 ! "J";
          #170#4 = "S";
     |FINSI;
     |GRABA 020#170a;
     |LIBERA #170;
|FPRC;

|DEFBUCLE Partes;
     #156#1;
     ;
     #0#1, aDFecha, 00, " ";
     #0#2, aHFecha, 99, "z";
     ;
     NULL, Partes;
|FIN;

|PROCESO IniciaResumen;
     |PDEFECTO #159, 3, 18;
     |GRABA 020#159a;
     |LIBERA #159;
|FPRC;

|DEFBUCLE IniciaResumen;
     #159#1;
     ;
     #0#1, #0#3, #0#4;
     #0#2, #0#3, #0#5;
     ;
     NULL, IniciaResumen;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     aAlfa = "01." + (("00" + #0#4) % -102) +"."+ (("0000" + #0#3) % -104);
     |HAZ SacaMes;

     |BUCLE IniciaResumen;

     |HAZ CreaTempo; |NOME_DAT #170#Tempo#; |DELINDEX #170;

     |ABRE #154;
     |ABRET #155;
     |ABRE #157;
     |ABRE #159;
     |ABRE #170;
     |BUCLE Partes;
     |SI nPrime ! 0; |HAZ Acumula; |FINSI;
     |CIERRA #170;
     |CIERRA #159;
     |CIERRA #157;
     |CIERRAT #155;
     |CIERRA #156;
     |BUCLE Resumen;

     |DELINDEX #170; |HAZ BoraTempo;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |CLS;
     |DDEFECTO #0;
     fFecha = ~;
     aAlfa = fFecha % 705;
     #0#3 = aAlfa;
     aAlfa = fFecha % 402;
     #0#4 = aAlfa;
     #0#5 = aAlfa;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |GRABA 020#0a;
     |CIERRA #0;
|FPRO;
