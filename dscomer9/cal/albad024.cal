|FICHEROS;
     albad024 #0; ||=liquida
     albad025 #1; ||=liqart   || Liquidacion Articulos.
     albad026 #2; ||=liqcob   || Liquidacion Cobros.
     agifa065 #3;  || Historico.

     dscam004@; ||=agifa174   || Cobros Parciales Facturas.
     dscam003@;
     dscam045@;

     albad038 #5; ||=agif9174   || Cobros Parciales Albaranes.

     agifa019 #6;  || Articulos.
     albad027 #7;  ||=liqalbr    || Control Alb. Reparto.
     albad028 #8;  ||=liqalbg    || Control Alb. Generados.
     agifa010 #9;  || Cabeceras Albaran.
     agifa071 #10; || Lineas Albaran.
     albad029 #11; ||=liquipan  || Pantalla Albaranes Anteriores.
     albad030 #12; ||=liqmed    || Liquidacion Unidad Medida.
     agifa142 #142;
|FIN;

|VARIABLES;
     &eaFichero = "";
     Comodin = "";
     aLong = "";
     nLong = 0;
     Calc = 0;
     Parte1 = "";
     Parte2 = "";

     aTmp1 = "";
     aTmp2 = "";
     aTmp7 = "";
     aTmp8 = "";
     aTmp12 = "";
     &Tempo = "";
     aDef04 = "";
     aDef03 = "";
     aDef45 = "";
     nErr = 0;
     aPath = "";
     aPathDef = "";
     aMensa = "";
     aEmpre = "";
     aPathFic = "";
     nNumEmp = 0;
     aAlfa = "";
     nEmp = 0;

     menos = -1;
     unidad = 0;
     mensaje1 = "0000La Fecha Debe Estar Comprendida Entre La Fecha De Carga Y Descarga";
     serant = "";
     albant = "";
     i = 0;
|FIN;

|CALCULO liquipan;
|SI #0#13 = "S";
  |PUSHV 0501 2380;
  |PINPA #0#11;
  |PINDA #0#11;
  |ENDATOS #1#11;
  |POPV;
|SINO;
  |PARA i = 0;|SI i < 24;|HACIENDO i = i + 1;
    #11i = "";
  |SIGUE;
|FINSI;
|FCAL;

|CALCULO liquipan2;            || Acumulacion Albaranes Anteriores.
#9#52 = serant;
#9#0 = albant;
|LEE 000#9=;
|SI FSalida = 0;
  |ABRE #7;
  #7#0 = #9#1;
  #7#1 = #9#52;
  #7#2 = #9#0;
  |LEE 000#7=;
  |SI FSalida ! 0;
    |GRABA 000#7c;
    |LIBERA #7;
  |FINSI;
  #7#3 = #9#3;
  #7#4 = #9#4;
  #7#5 = "S";
  |GRABA 000#7a;
  |LIBERA #7;
  |CIERRA #7;
|FINSI;
|LIBERA #9;
|FCAL;


|CALCULO ayuda;
|SI FSalida = 9;
  |PINPA #1#0;
  |PAUSA;
  |PINPA #0#0;
  |PINDA #0#0;
  |ENCAMPO #12#0;
|FINSI;
|FCAL;

|CALCULO fdef;|TIPO 7;
#0#1 = #0#0 + 1;
|PINTA #0#1;
|FCAL;

|CALCULO fdef1;|TIPO 7;
#0#10 = #0#0;
#0#11 = #0#1;
#0#3 = #0#1;
#0#4 = #0#1;
|PINTA #0#10;
|PINTA #0#11;
|PINTA #0#3;
|PINTA #0#4;
|FCAL;

|CALCULO fec1;|TIPO 0;
|SI #0#10 < #0#0;|O #0#10 > #0#1;
  |MENAV mensaje1;
  |ERROR;
|FINSI;
|FCAL;

|CALCULO fec2;|TIPO 0;
|SI #0#11 < #0#0;|O #0#11 > #0#1;
  |MENAV mensaje1;
  |ERROR;
|FINSI;
|FCAL;

|CALCULO liqart1;
|SI #3#1 = #0#0;             || Cargas Almacen.
  |SI #3#2 = "ES";|O #3#2 = "EV";|O #3#2 = "ME";
    #1#0 = #3#5;
    #1#1 = #3#0;
    |LEE 000#1=;
    |SI FSalida ! 0;
      |GRABA 000#1c;
      |LIBERA #1;
    |FINSI;
    #1#2 = #1#2 + #3#6;
    #1#4 = #1#2 - #1#5;
    |GRABA 000#1a;
    |LIBERA #1;
  |FINSI;
|FINSI;

|SI #3#1 = #0#1;              || Descargas De Almacen.
  |SI #3#2 = "SS";|O #3#2 = "MS";
    #1#0 = #3#5;
    #1#1 = #3#0;
    |LEE 000#1=;
    |SI FSalida ! 0;
      |GRABA 000#1c;
      |LIBERA #1;
    |FINSI;
    unidad = #3#6 * menos;
    #1#5 = #1#5 + unidad;
    #1#4 = #1#2 - #1#5;
    |GRABA 000#1a;
    |LIBERA #1;
  |FINSI;
|FINSI;

#1#2 = 0;
#1#3 = 0;
#1#4 = 0;
#1#5 = 0;

|SI #3#1 = #0#10;|Y #3#2 = "AV";
  |SI #3#11 ] #0#14;|Y #3#11 [ #0#15;
    |HAZ liqalbr;
  |FINSI;
|FINSI;

|SI #3#1 = #0#11;|Y #3#2 = "AV";
  |SI #3#11 ] #0#16;|Y #3#11 [ #0#17;
    |HAZ liqalbg;
  |FINSI;
|FINSI;
|FCAL;

|DEFBUCLE liqart;
#3#1;
5;
"                    " , #0#0 , "  " , 000001, 0   , "     " , #0#2;
"zzzzzzzzzzzzzzzzzzzz" , #0#1 , "zz" , 999999, 999 , "zzzzz" , #0#2;
be;
NULL,liqart1;
|FIN;


|PROCESO DescargaDef;
     |SI aDef04 ! ""; |DESCARGA_DEF #dscam004@; |FINSI;
     |SI aDef03 ! ""; |DESCARGA_DEF #dscam003@; |FINSI;
     |SI aDef45 ! ""; |DESCARGA_DEF #dscam045@; |FINSI;
|FPRC;

|PROCESO CargaDef;
     nErr = 1;

     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aPath = aPath + "fich/";

     aDef45 = aPathDef + "dscam045";
     |CARGA_DEF aDef45, dscam045@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef45;
          |MENAV aMensa;
          aDef45 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef03 = aPathDef + "dscam003";
     |CARGA_DEF aDef03, dscam003@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef03;
          |MENAV aMensa;
          aDef03 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef04 = aPathDef + "dscam004";
     |CARGA_DEF aDef04, dscam004@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef04;
          |MENAV aMensa;
          aDef04 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     |PATH_DAT #dscam045@#aPath#;

     nErr = 0;
|FPRC;

|PROCESO dscam004;
     |DDEFECTO #2;
     #2#0 = 1;
     |LEE 000#2=;
     |SI FSalida ! 0;
          |GRABA 000#2b;
     |FINSI;
     #2#1 = #2#1 + #dscam004@#26;
     #2#3 = #2#1 + #2#2;
     |GRABA 000#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE dscam004;
     #dscam004@#1002;
     6,4;
     #dscam003@#40, 01, #0#3, #0#5;
     #dscam003@#40, 99, #0#3, #0#5;
     ;
     NULL, dscam004;
|FIN;

|PROCESO dscam003;
     |BUCLE dscam004;
|FPRC;

|DEFBUCLE dscam003;
     #dscam003@#1001;
     ;
     000000001;
     999999999;
     ;
     NULL, dscam003;
|FIN;

|PROCESO dscam045;
     |SI #dscam045@#2 = "V";
          aEmpre = ("00000" + #dscam045@#6) % -105;
          aPathFic = aPath + aEmpre + "/";

          |PATH_DAT #dscam003@#aPathFic#;
          |PATH_DAT #dscam004@#aPathFic#;

          |BUCLE dscam003;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     ;
     nNumEmp, 001;
     nNumEmp, 999;
     ;
     NULL, dscam045;
|FIN;

|PROCESO CobroFac;
     |DFICE aAlfa;
     aAlfa = aAlfa % -205;
     nEmp = aAlfa;
     |HAZ CargaDef;
     |SI nErr = 0;
          |BUCLE dscam045;
          |HAZ DescargaDef;
     |FINSI;
|FPRC;

|CALCULO liqcoba1;          || Cobros Albaranes.
     #2#0 = 1;
     |LEE 000#2=;
     |SI FSalida ! 0;
       |GRABA 000#2c;
       |LIBERA #2;
     |FINSI;
     #2#2 = #2#2 + #5#9;
     #2#3 = #2#1 + #2#2;
     |GRABA 000#2a;
     |LIBERA #2;
|FCAL;

|DEFBUCLE liqcoba;
     #5#1;
     6,5;
     "     ", 000001, 001, 001, #0#4, #0#6;
     "zzzzz", 999999, 999, 999, #0#4, #0#6;
     be;
     NULL,liqcoba1;
|FIN;

|CALCULO liqalbr;             || Acumulacion Albaranes Reparto.
#9#52 = #3#11;
#9#0 = #3#3;
|LEE 000#9=;
|SI FSalida = 0;
  |ABRE #7;
  #7#0 = #9#1;
  #7#1 = #9#52;
  #7#2 = #9#0;
  |LEE 000#7=;
  |SI FSalida ! 0;
    |GRABA 000#7c;
    |LIBERA #7;
  |FINSI;
  #7#3 = #9#3;
  #7#4 = #9#4;
  #7#5 = "S";
  |GRABA 000#7a;
  |LIBERA #7;
  |CIERRA #7;
|FINSI;
|LIBERA #9;
|FCAL;

|CALCULO liqalbg;            || Acumulacion Albaranes Generados.
#9#52 = #3#11;
#9#0 = #3#3;
|LEE 000#9=;
|SI FSalida = 0;
  |ABRE #8;
  #8#0 = #9#1;
  #8#1 = #9#52;
  #8#2 = #9#0;
  |LEE 000#8=;
  |SI FSalida ! 0;
    |GRABA 000#8c;
    |LIBERA #8;
  |FINSI;
  #8#3 = #9#3;
  #8#4 = #9#4;
  #8#5 = "S";
  |GRABA 000#8a;
  |LIBERA #8;
  |CIERRA #8;
|FINSI;
|LIBERA #9;
|FCAL;

|CALCULO liqalb;         || Descargas De Albaranes De Reparto Y Generados.
|SI #10#3 = #0#2;
  #1#0 = #10#3;
  #1#1 = #10#2;
  |LEE 000#1=;
  |SI FSalida ! 0;
    |GRABA 000#1c;
    |LIBERA #1;
  |FINSI;
  #1#3 = #1#3 + #10#5;
  #1#4 = #1#2 - #1#5;
  |GRABA 000#1a;
  |LIBERA #1;
|FINSI;
#1#2 = 0;
#1#3 = 0;
#1#4 = 0;
#1#5 = 0;
|FCAL;

|CALCULO liqalbr2;
#9#0 = #7#2;
#9#52 = #7#1;
|LEE 000#9=;
|BUCLELIN 0liqalb#9;
|FCAL;

|DEFBUCLE liqalbr1;
#7#1;
5;
"     " , 000001 , "S";
"zzzzz" , 999999 , "S";
be;
NULL,liqalbr2;
|FIN;

|CALCULO liqalbg2;
#9#0 = #8#2;
#9#52 = #8#1;
|LEE 000#9=;
|BUCLELIN 0liqalb#9;
|FCAL;

|DEFBUCLE liqalbg1;
#8#1;
5;
"     " , 000001 , "S";
"zzzzz" , 999999 , "S";
be;
NULL,liqalbg2;
|FIN;


|CALCULO impreart1;
|ABRE #6;
#6#0 = #1#1;
|LEE 000#6=;
|LIBERA #6;
|CIERRA #6;
|PRINT;
|ABRE #12;
#12#0 = #6#5;  || Grabacion De La Unidad De Medida
|LEE 000#12=;
|SI FSalida ! 0;
  |GRABA 000#12c;
  |LIBERA #12;
|FINSI;
#12#1 = #12#1 + #1#3; || Ventas.
#12#2 = #12#2 + #1#4; || Diferencia Car/Des.
|GRABA 000#12a;
|LIBERA #12;
|CIERRA #12;
#12#0 = "";
#12#1 = 0;
#12#2 = 0;
|FCAL;

|DEFBUCLE impreart;
#1#1;
;
00000 , "                    ";
99999 , "zzzzzzzzzzzzzzzzzzzz";
be;
NULL,impreart1;
|FIN;

|CALCULO impresion;
|IMPRE 1;
|INFOR "albad024";

|BUCLE impreart;

#2#0 = 1;
|LEE 000#2=;
|LIBERA #2;
|PIEINF;
|FININF;
|FINIMP;
|FCAL;


|PROCESO Cuenta;
   |ABRE #142; |LEE 000#142p; |CIERRA #142;
   Comodin = #0Campo; |QBF Comodin;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      aLong = Comodin % 0; nLong = aLong;
      Calc = ((FSalida / 100) ! 0) + 99;
      Parte1 = Comodin % Calc;
      Parte2 = Comodin - Parte1;
      Calc = #142#11 - nLong;
      Comodin = "0" * Calc;
      Comodin = Parte1 + Comodin + Parte2;
      #0Campo = Comodin;
      |PINTA #0Campo;
   |FINSI;
|FPRC;

|CALCULO liquida;|TIPO 3;
     |SI #0#7 = "SI";
       |HAZ CreaTempo; aTmp1 = Tempo;
       |HAZ CreaTempo; aTmp2 = Tempo;
       |HAZ CreaTempo; aTmp7 = Tempo;
       |HAZ CreaTempo; aTmp8 = Tempo;
       |HAZ CreaTempo; aTmp12 = Tempo;
       |NOME_DAT #1 aTmp1; |DELINDEX #1;
       |NOME_DAT #2 aTmp2; |DELINDEX #2;
       |NOME_DAT #7 aTmp7; |DELINDEX #7;
       |NOME_DAT #8 aTmp8; |DELINDEX #8;
       |NOME_DAT #12 aTmp12; |DELINDEX #12;

       |ABRE #1;
       |ABRE #2;
       |ABRE #3;
       |ABRE #9;
       |ABRE #10;
       || ----------- Acumulacion Albaranes Anteriores ------------------
       serant = #11#0;
       albant = #11#1;
       |HAZ liquipan2;
       serant = #11#2;
       albant = #11#3;
       |HAZ liquipan2;
       serant = #11#4;
       albant = #11#5;
       |HAZ liquipan2;
       serant = #11#6;
       albant = #11#7;
       |HAZ liquipan2;
       serant = #11#8;
       albant = #11#9;
       |HAZ liquipan2;
       serant = #11#10;
       albant = #11#11;
       |HAZ liquipan2;
       serant = #11#12;
       albant = #11#13;
       |HAZ liquipan2;
       serant = #11#14;
       albant = #11#15;
       |HAZ liquipan2;
       serant = #11#16;
       albant = #11#17;
       |HAZ liquipan2;
       serant = #11#18;
       albant = #11#19;
       |HAZ liquipan2;
       serant = #11#20;
       albant = #11#21;
       |HAZ liquipan2;
       serant = #11#22;
       albant = #11#23;
       |HAZ liquipan2;

       |BUCLE liqart;

       |HAZ CobroFac;

       |BUCLE liqcoba;

       eaFichero = aTmp7;
       |SUB_EJECUTA_NP "albad027";
       eaFichero = aTmp8;
       |SUB_EJECUTA_NP "albad028";

       |BUCLE liqalbr1;
       |BUCLE liqalbg1;

       |HAZ impresion;

       |CIERRA #1;
       |CIERRA #2;
       |CIERRA #3;
       |CIERRA #9;
       |CIERRA #10;

       aTmp1 = Tempo; |HAZ BoraTempo; |DELINDEX #1;
       aTmp2 = Tempo; |HAZ BoraTempo; |DELINDEX #2;
       aTmp7 = Tempo; |HAZ BoraTempo; |DELINDEX #7;
       aTmp8 = Tempo; |HAZ BoraTempo; |DELINDEX #8;
       aTmp12 = Tempo; |HAZ BoraTempo; |DELINDEX #12;
     |FINSI;
|FCAL;
