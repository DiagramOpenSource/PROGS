|FICHEROS;
     pfondo01 #0;
     dsm00223 #1;   || fichero exportacion-importacion

     dscom16@ #16;  || Bandeja de entrada
     agifa104 #104; || cabecera de pedidos
     agifa073 #73;  || lineas de pedidos
|FIN;


|VARIABLES;
     &nEsPedido=0;
     aCadena="";
     &aClienteSuper="";
     nTecla=0;
     i=0;
     aTecla="";
     aEstado="";

     Titulo1="";
     Titulo2="";
     Titulo3="";
     Titulo4="";
     Titulo5="";
     Titulo6="";
     Titulo7="";
     Titulo8="";
     Titulo9="";
     Titulo10="";
     Titulo11="";
     Titulo12="";
     Titulo13="";
     Titulo14="";
     Titulo111="";

     Titulo22="";
     Titulo23="";
     Titulo24="";
     Titulo25="";
     Titulo26="";
     Titulo212="";

     nBoton1   = 0;
     nBoton2   = 0;
     nBoton3   = 0;
     nBoton4   = 0;
     nBoton5   = 0;
     nBoton12  = 0;

     nBoton21   = 0;
     nBoton22   = 0;
     nBoton23   = 0;

     nBoton31   = 0;
     nBoton32   = 0;
     nBoton33   = 0;
     nBoton34   = 0;
     nBoton35   = 0;
     nBoton36   = 0;
     nBoton37   = 0;
     nBoton38   = 0;
     nBoton39   = 0;
     nBoton40   = 0;

     nBoton52   = 0;
     nBoton53   = 0;
     nBoton54   = 0;
     nBoton55   = 0;
     nBoton56   = 0;
     nBoton512  = 0;


     aAlfa1 = "";
     aPath = "";
     aPathDef = "";
     aPathDat = "";
     aEmpCom = "01";     ||Empresa Comunicaciones: fijo la 01
     aMensaje = "";
     &ser_ped="";
     &num_ped=0;
     &enAltaCliente = 0;
     aPrograma = "";
|FIN;

|PROCESO PulsaF2;
     |PTEC 824;
|FPRC;
|PROCESO PulsaF3;
     |PTEC 825;
|FPRC;

|PROCESO PulsaF4;
|FPRC;

|PROCESO PulsaF5;
|FPRC;

|PROCESO PulsaF6;
|FPRC;

|PROCESO PulsaF12;
     |PTEC 823;
|FPRC;

|PROCESO PulsaG2;
     |PTEC 824;
|FPRC;

|PROCESO PulsaG3;
     |PTEC 825;
|FPRC;

|PROCESO PulsaG4;
     |PTEC 826;
|FPRC;

|PROCESO PulsaG5;
     |PTEC 827;
|FPRC;

|PROCESO PulsaG6;
     |PTEC 828;
|FPRC;

|PROCESO PulsaG7;
     |PTEC 829;
|FPRC;

|PROCESO PulsaG8;
     |PTEC 830;
|FPRC;

|PROCESO PulsaG9;
     |PTEC 831;
|FPRC;

|PROCESO PulsaG10;
     |PTEC 832;
|FPRC;

|PROCESO PulsaG11;
     |PTEC 820;
|FPRC;

|PROCESO PulsaC2;
     |PTEC 824;
|FPRC;
|PROCESO PulsaC3;
     |PTEC 825;
|FPRC;
|PROCESO PulsaC4;
     |PTEC 826;
|FPRC;

|PROCESO ClientesAntiguos;
     |SUB_EJECUTA "porm0001;DesdeMenuAntiguos";
|FPRC;

|PROCESO ClientesNuevos;
     |SUB_EJECUTA "porm0001;DesdeMenuNuevos";
|FPRC;





|PROCESO BandejaEntrada;
     |SUB_EJECUTA "pora0001";
|FPRC;

|PROCESO BandejaSalida;
     |SUB_EJECUTA "pora0002";
|FPRC;

|PROCESO DeCentral;
     |AVISO;
     |CONFI "0000NRecibir de Central. Continuar con la opcion";
     |SI FSalida = 0;
          aAlfa1 = ":dscom/dscom015 dscom000 01";                || recibir correos
          |SUB_EJECUTA aAlfa1;
          aAlfa1 = ":dscom/dscom017 dscom000 01" + &59 + "A";    || procesar paquetes
          |SUB_EJECUTA aAlfa1;
          |SUB_EJECUTA "por00029;AUTO";      || preparar ficheros
          enAltaCliente = 1;  || para no crear los clientes inexistentes
          ||TODO CCC. Comentado el 04.04.02
          ||SUB_EJECUTA "agifa026;agifa655";  || recalculo acumulados maestros
          |SUB_EJECUTA "por00030";           || marcar pedidos como exportados
     |FINSI;
|FPRC;

|PROCESO ACentral;
     ||TODO CCC
/*
     |AVISO;
     |CONFI "0000NEnviar a Central. Continuar con la opcion";
     |SI FSalida = 0;
          aAlfa1 = ":dscom/dscom020 dscom000 51" + &59 + "AUTO";  || exportar
          |SUB_EJECUTA aAlfa1;
          aAlfa1 = ":dscom/dscom015 dscom000 01";  || recoger ecos
          |SUB_EJECUTA "por00030";           || marcar pedidos como exportados
     |FINSI;
*/
     aMensaje = "0000Envio a Central";
     ||MENAV aMensaje;
     |HAZ MenuEnvio;
|FPRC;

|PROCESO ModificarPedido;
     |SUB_EJECUTA "por00019";
|FPRC;

|PROCESO Incidencias;
     |SUB_EJECUTA "pord0001";
|FPRC;

|PROCESO Objetivos;
     |SUB_EJECUTA "poro0001";
|FPRC;

|PROCESO ResultadoVisita;
     |SUB_EJECUTA "porv0001";
|FPRC;

|PROCESO Verpedidos;
     ||ARA
     |ABRE #agifa104;
     |ABRE #agifa073;
     |PARA; |SI; |HACIENDO;
          |CONSULTA_CLAVE #1#104;
          |SI FSalida = 0;
               aMensaje = "0000SPulse (S) Ver detalle Pedido;  Pulse (N) Imprimir";
               |CONFI aMensaje;
               |SI FSalida = 0;
                    |CONSULTA_F_CLAVE #1#73,min,max;
               |SINO;
                    |HAZ Impresion;
               |FINSI;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     |CIERRA #agifa104;
     |CIERRA #agifa073;
     ||SUB_EJECUTA "por00026";
|FPRC;

|PROCESO PendientesServir;
     |SUB_EJECUTA "por00012";
|FPRC;

|PROCESO PonMenuClientes;
     Titulo7  = "LBOTON, F2 Clientes Antiguos";
     Titulo8  = "LBOTON, F3 Clientes Nuevos";
     Titulo12 = "LBOTON, F12 SALIR";

     |CONTROL_SIMPLE 0, Titulo7,  0830, 0950, PulsaC2;  nBoton21 = FSalida;
     |CONTROL_SIMPLE 0, Titulo8,  1130, 1250, PulsaC3;  nBoton22 = FSalida;
     |CONTROL_SIMPLE 0, Titulo12, 1730, 1850, PulsaF12; nBoton12 = FSalida;
|FPRC;

|PROCESO QuitaMenuClientes;
     |FIN_CONTROL_WINDOWS nBoton21;
     |FIN_CONTROL_WINDOWS nBoton22;
     |FIN_CONTROL_WINDOWS nBoton12;
     |PULSATECLA;
|FPRC;

|PROCESO EstadoClientes;
     |ESTADO_CONTROL nBoton21, aEstado;
     |ESTADO_CONTROL nBoton22, aEstado;
     |ESTADO_CONTROL nBoton12, aEstado;
|FPRC;

|PROCESO PonMenuAgenda;
     Titulo4 = "LBOTON, F2 Bandeja de Entrada";
     Titulo5 = "LBOTON, F3 Bandeja de Salida ";
     Titulo6 = "LBOTON, F4 Recoger de Central ";
     Titulo9 = "LBOTON, F5 Enviar a Central ";
     Titulo10 ="LBOTON, F6 Incidencias       ";
     Titulo11 ="LBOTON, F7 Objetivos         ";
     Titulo12 ="LBOTON, F8 Ver Pedidos       ";
||     Titulo13 ="LBOTON, F9 Art¡culos         ";
||     Titulo14 ="LBOTON, F10 Pdt. Servir      ";
     Titulo111="LBOTON, F12 SALIR";
     |CONTROL_SIMPLE 0, Titulo4, 0715, 0835, PulsaG2; nBoton31 = FSalida;
     |CONTROL_SIMPLE 0, Titulo5, 1015, 1135, PulsaG3; nBoton32 = FSalida;
     |CONTROL_SIMPLE 0, Titulo6, 1315, 1435, PulsaG4; nBoton33 = FSalida;
     |CONTROL_SIMPLE 0, Titulo9, 1615, 1735, PulsaG5; nBoton34 = FSalida;
     |CONTROL_SIMPLE 0, Titulo10, 0745, 0865, PulsaG6; nBoton35 = FSalida;
     |CONTROL_SIMPLE 0, Titulo11, 1045, 1165, PulsaG7; nBoton36 = FSalida;
     |CONTROL_SIMPLE 0, Titulo12, 1345, 1465, PulsaG8; nBoton37 = FSalida;
||     |CONTROL_SIMPLE 0, Titulo13, 1645, 1765, PulsaG9; nBoton38 = FSalida;
||     |CONTROL_SIMPLE 0, Titulo14, 1915, 2035, PulsaG10; nBoton39 = FSalida;
     |CONTROL_SIMPLE 0, Titulo111, 1645, 1765, PulsaF12; nBoton12 = FSalida;
|FPRC;

|PROCESO QuitaMenuAgenda;
     |FIN_CONTROL_WINDOWS nBoton31;
     |FIN_CONTROL_WINDOWS nBoton32;
     |FIN_CONTROL_WINDOWS nBoton33;
     |FIN_CONTROL_WINDOWS nBoton34;
     |FIN_CONTROL_WINDOWS nBoton35;
     |FIN_CONTROL_WINDOWS nBoton36;
     |FIN_CONTROL_WINDOWS nBoton37;
     ||FIN_CONTROL_WINDOWS nBoton38;
     ||FIN_CONTROL_WINDOWS nBoton39;
     |FIN_CONTROL_WINDOWS nBoton12;
     |PULSATECLA;
|FPRC;

|PROCESO EstadoAgenda;
     |ESTADO_CONTROL nBoton31, aEstado;
     |ESTADO_CONTROL nBoton32, aEstado;
     |ESTADO_CONTROL nBoton33, aEstado;
     |ESTADO_CONTROL nBoton34, aEstado;
     |ESTADO_CONTROL nBoton35, aEstado;
     |ESTADO_CONTROL nBoton36, aEstado;
     |ESTADO_CONTROL nBoton37, aEstado;
||     |ESTADO_CONTROL nBoton38, aEstado;
||     |ESTADO_CONTROL nBoton39, aEstado;
     |ESTADO_CONTROL nBoton12, aEstado;
|FPRC;

|PROCESO EstadoPrincipal;
     |ESTADO_CONTROL nBoton1, aEstado;
     |ESTADO_CONTROL nBoton2, aEstado;
     |ESTADO_CONTROL nBoton5, aEstado;
     |ESTADO_CONTROL nBoton12, aEstado;
|FPRC;

|PROCESO PonMenuPrincipal;
     Titulo1  = "LBOTON, F2 Cat logo";
     Titulo2  = "LBOTON, F3 Agenda  ";
     Titulo12 = "LBOTON, F12 SALIR";
     |CONTROL_SIMPLE 0, Titulo1,  0830, 0950, PulsaF2;  nBoton1  = FSalida;
     |CONTROL_SIMPLE 0, Titulo2,  1130, 1250, PulsaF3;  nBoton2  = FSalida;
     |CONTROL_SIMPLE 0, Titulo12, 1730, 1850, PulsaF12; nBoton12 = FSalida;

     |HAZ PonFechaHoraIE; || aCadena tiene el contenido

     aCadena="BOTON,"+aCadena;
     |CONTROL_SIMPLE 0,aCadena, 2020, 2160, PulsaF6; nBoton5 = FSalida;
     |ESTADO_CONTROL nBoton5, "DISABLE";
|FPRC;

|PROCESO QuitarMenuPrincipal;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton12;
     |PULSATECLA;
|FPRC;

|PROCESO Catalogo;
     |SUB_EJECUTA "por00001";
|FPRC;

|PROCESO Clientes;
     aEstado="SHOW"; |HAZ EstadoClientes; |HAZ PonMenuClientes;
     |PARA; |SI; |HACIENDO;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla=807; |O aTecla = 823; |SAL; |FINSI;
          nTecla = aTecla; nTecla = (nTecla - 824) + 1
          |SI nTecla ] 1; |Y  nTecla [ 2;
               aEstado="HIDE"; |HAZ EstadoClientes; |HAZ QuitaMenuClientes;
               |SI nTecla = 1;
                    |HAZ ClientesAntiguos;
               |FINSI;
               |SI nTecla = 2;
                    |HAZ ClientesNuevos;
               |FINSI;
               aEstado="SHOW"; |HAZ EstadoClientes; |HAZ PonMenuClientes;
          |FINSI;
     |SIGUE;
     aEstado="SHOW"; |HAZ EstadoClientes; |HAZ QuitaMenuClientes;
|FPRC;

|PROCESO Agenda;
     aEstado="SHOW"; |HAZ EstadoAgenda; |HAZ PonMenuAgenda;
     |PARA; |SI; |HACIENDO;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla = 807; |O aTecla = 823; |SAL; |FINSI;
          nTecla = aTecla; nTecla = (nTecla - 824) + 1
          |SI nTecla ] 1; |Y  nTecla [ 9;
               aEstado="HIDE"; |HAZ EstadoAgenda; |HAZ QuitaMenuAgenda;
               |SI nTecla = 1;
                    |HAZ BandejaEntrada;
               |FINSI;
               |SI nTecla = 2;
                    |HAZ BandejaSalida;
               |FINSI;
               |SI nTecla = 3;
                    |HAZ DeCentral;
               |FINSI;
               |SI nTecla = 4;
                    |HAZ ACentral;
               |FINSI;
               |SI nTecla = 5;
                    |HAZ Incidencias;
               |FINSI;
               |SI nTecla = 6;
                    |HAZ Objetivos;
               |FINSI;
               |SI nTecla = 7;
                    |HAZ Verpedidos;
               |FINSI;
               |SI nTecla = 9;
             ||       |HAZ PendientesServir;
               |FINSI;
               aEstado="SHOW"; |HAZ EstadoAgenda; |HAZ PonMenuAgenda;
          |FINSI;
     |SIGUE;
     aEstado="HIDE"; |HAZ EstadoAgenda; |HAZ QuitaMenuAgenda;
|FPRC;

|PROCESO PonFechaHoraIE;      || quitado de momento por el cambio a DSCOM
     ||TODO CCC
     aCadena = "";
     |DBASS aPath;
     |QBF aPath;
     aPath = aPath + "dscom/";
     aPathDef = aPath + "def/dscom016";
     aPathDat = aPath + "fich/";
     |CARGA_DEF aPathDef, dscom16@;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;
     |PATH_DAT #16 aPathDat;
     |ABRE #dscom16@;
     |SELECT #5#16;
     |LEE 000#dscom16@.u;
     |SI FSalida=0;
          aCadena="£ltima comunicaci¢n el "+ #dscom16@#23 +" a las "+ #dscom16@#24;
     |SINO;
          aCadena="";
     |FINSI;
     |CIERRA #dscom16@;
     |DESCARGA_DEF #dscom16@;



/*
     |ABRE #1;
     |SELECT #3#1;
     |LEE 000#1u;
     |SI FSalida=0;
          aCadena="£ltima comunicaci¢n el "+#1#1+" a las "+#1#3;
     |SINO;
          aCadena="";
     |FINSI;
*/
|FPRC;

|PROCESO Moneda;
     |FICHEROS;
          zmonedas;
          agifa321;
          agifa324;
     |FIN;
     |VARIABLES;
          &EURO = 0;
          &EURODB = 0;
          &EURODV = 0;
          aAlfa = "";
     |FIN;

     |ABRE #agifa321;
     |LEE 000#agifa321.p;
     |CIERRA #agifa321;

     |ABRE #agifa324;
     #agifa324#0 = #agifa321#9;
     |LEE 000#agifa324.=;
     |CIERRA #agifa324;

     |SI #agifa324#2 = 1;|Y #agifa324#3 = 1;                || en EUROS
          EURO = 166.186;
          EURODB = 2;
          EURODV = 0;
          #zmonedas#0 = "EURO";
     |FINSI;

     |SI #agifa324#2 = 166.386;|Y #agifa324#3 = 166.386;    || en PESETAS
          EURO = 1 / 166.186;
          EURODB = 0;
          EURODV = 2;
          #zmonedas#0 = "PESETA";
     |FINSI;

     |PINPA #0#zmonedas;
     |PINDA #0#zmonedas;

     #zmonedas#1 = EURO;
     |PINTA #zmonedas#1#;
|FPRC;

|PROGRAMA;
     aClienteSuper="";
     |HAZ Moneda;
     |CLS;
     aEstado="SHOW"; |HAZ EstadoPrincipal; |HAZ PonMenuPrincipal;
     |PARA; |SI; |HACIENDO;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla=807; |O aTecla = 823; |SAL; |FINSI;
          nTecla = aTecla; nTecla = (nTecla - 824) + 1
          |SI nTecla ] 1; |Y  nTecla [ 2;
               aEstado="HIDE"; |HAZ EstadoPrincipal; |HAZ QuitarMenuPrincipal;
               |SI nTecla = 1;
                    |HAZ Clientes;
               |FINSI;
               |SI nTecla = 2;
                    |HAZ Agenda;
               |FINSI;
               aEstado="SHOW"; |HAZ EstadoPrincipal; |HAZ PonMenuPrincipal;
          |FINSI;
     |SIGUE;
     aEstado="HIDE"; |HAZ EstadoPrincipal; |HAZ QuitarMenuPrincipal;
|FPRO;

|PROCESO min;
     #agifa073#28 = #agifa104#25;
     #agifa073#0 = #agifa104#0;
     #agifa073#1 = 1;
|FPRC;

|PROCESO max;
     #agifa073#28 = #agifa104#25;
     #agifa073#0 = #agifa104#0;
     #agifa073#1 = 999;
|FPRC;


|PROCESO Impresion;
     ser_ped = #agifa104#25;
     num_ped = #agifa104#0;
     |CIERRA #agifa104;
     |CIERRA #agifa073;
     |SUB_EJECUTA_NP "agifa105.run;marhv104";     || provocaba un error 0
     |ABRE #agifa104;                             ||/en windows
     |ABRE #agifa073;
     #agifa104#25 = ser_ped;
     #agifa104#0 = num_ped;
     |LEE 000#agifa104.=;
|FPRC;

__________________________________________________________________________
||Proceso Envio ...
__________________________________________________________________________

|PROCESO PulsaE2;
     |PTEC 824;
|FPRC;

|PROCESO PulsaE3;
     |PTEC 825;
|FPRC;

|PROCESO PulsaE4;
     |PTEC 826;
|FPRC;

|PROCESO PulsaE5;
     |PTEC 827;
|FPRC;

|PROCESO PulsaE6;
     |PTEC 828;
|FPRC;

|PROCESO PonMenuEnvio;
     Titulo22 = "LBOTON, F2 Configuraci¢n ";
     Titulo23 = "LBOTON, F3 Enviar ";
     Titulo24 = "LBOTON, F4 Ver Hist¢rico ";
     Titulo25 = "LBOTON, F5 Ver Dir.Export";
     Titulo26 = "LBOTON, F6 Ver Conf.Correo";
     Titulo212 = "LBOTON, F12 SALIR";
     |CONTROL_SIMPLE 0, Titulo22, 0715, 0835, PulsaE2; nBoton52 = FSalida;
     |CONTROL_SIMPLE 0, Titulo23, 1015, 1135, PulsaE3; nBoton53 = FSalida;
     |CONTROL_SIMPLE 0, Titulo24, 1315, 1435, PulsaE4; nBoton54 = FSalida;
     |CONTROL_SIMPLE 0, Titulo25, 0745, 0865, PulsaE5; nBoton55 = FSalida;
     |CONTROL_SIMPLE 0, Titulo26, 1045, 1165, PulsaE6; nBoton56 = FSalida;
     |CONTROL_SIMPLE 0, Titulo212, 1615, 1735, PulsaF12; nBoton512 = FSalida;
|FPRC;

|PROCESO QuitaMenuEnvio;
     |FIN_CONTROL_WINDOWS nBoton52;
     |FIN_CONTROL_WINDOWS nBoton53;
     |FIN_CONTROL_WINDOWS nBoton54;
     |FIN_CONTROL_WINDOWS nBoton55;
     |FIN_CONTROL_WINDOWS nBoton56;
     |FIN_CONTROL_WINDOWS nBoton512;
     |PULSATECLA;
|FPRC;

|PROCESO EstadoEnvio;
     |ESTADO_CONTROL nBoton52, aEstado;
     |ESTADO_CONTROL nBoton53, aEstado;
     |ESTADO_CONTROL nBoton54, aEstado;
     |ESTADO_CONTROL nBoton55, aEstado;
     |ESTADO_CONTROL nBoton56, aEstado;
     |ESTADO_CONTROL nBoton512, aEstado;
|FPRC;

|PROCESO MenuEnvio;
     aEstado="SHOW"; |HAZ EstadoEnvio; |HAZ PonMenuEnvio;
     |PARA; |SI; |HACIENDO;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla = 807; |O aTecla = 823; |SAL; |FINSI;
          nTecla = aTecla; nTecla = (nTecla - 824) + 1
          |SI nTecla ] 1; |Y  nTecla [ 5;
               aEstado="HIDE"; |HAZ EstadoEnvio; |HAZ QuitaMenuEnvio;

               |SI nTecla = 1;
                    |HAZ ConfigEnvio;
               |FINSI;
               |SI nTecla = 2;
                    |HAZ Envio;
               |FINSI;
               |SI nTecla = 3;
                    |HAZ VerHistorico;
               |FINSI;
               |SI nTecla = 4;
                    |HAZ VerDir;
               |FINSI;
               |SI nTecla = 5;
                    |HAZ VerConfCorreo;
               |FINSI;

               aEstado="SHOW"; |HAZ EstadoEnvio; |HAZ PonMenuEnvio;
               nTecla = 0;
          |FINSI;
     |SIGUE;
     aEstado="HIDE"; |HAZ EstadoEnvio; |HAZ QuitaMenuEnvio;
|FPRC;

|PROCESO ConfigEnvio;
     aPrograma = "dsm00249";
     |SUB_EJECUTA aPrograma;
|FPRC;

|PROCESO Envio;
     aPrograma = "dsm00227";
     |SUB_EJECUTA aPrograma;
     ||TODO CCC
|FPRC;

|PROCESO VerHistorico;
     aPrograma = "dsm00223";
     |SUB_EJECUTA aPrograma;
     ||TODO CCC
|FPRC;

|PROCESO VerDir;
     aPrograma = "dsm00220";
     |SUB_EJECUTA aPrograma;
|FPRC;

|PROCESO VerConfCorreo;
     aPrograma = "dsm00221";
     |SUB_EJECUTA aPrograma;
|FPRC;
