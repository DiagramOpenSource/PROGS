|FICHEROS;
     guerz039 #0;
     gopre001 #1;
     gomantho #10;
     gomantl1 #11;
     goparame #100;
|FIN;

|VARIABLES;
     nLin = 0;
     nUltLin = 0;
     &eaSerOrg = "";
     &enNumOrg = 0;
     &eaSerDes = "";
     &enNumDes = 0;
     &eaSer = "";
     &enNum = 0;
|FIN;

|PROCESO BuscaPre;
     |SI #11#3 = #0#2; |Y #11#4 = #0#3;
          nLin = #11#2;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaPre;
     #11#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, BuscaPre;
|FIN;

|PROCESO PresOrg;
     |SI FSalida = 2; |ACABA; |FINSI;
     nLin = 0;
     |BUCLE BuscaPre;
     |SI nLin = 0;
          |MENAV "0000No se encuentra el presupuesto en el expediente";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO PresDes;
     |SI FSalida = 2; |ACABA; |FINSI;
     |ABRE #1;
     #1#0 = #0#6;
     #1#1 = #0#7;
     |LEE 000#1=;
     |SI FSalida = 0;
          |MENAV "0000Presupuesto Existente";
          |ERROR;
     |FINSI;
     |CIERRA #1;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MarcaPres;
     |ABRE #1;
     #1#0 = #11#3;
     #1#1 = #11#4;
     |LEE 120#1=;
     |SI FSalida = 0;
          #1#40 = "S";
          #1#15 = #11#0;
          #1#16 = #11#1;
          #1#17 = #11#10;

          |GRABA 020#1a;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO UltLinExpe;
     #11#0 = #0#4;
     #11#1 = #0#5;
     #11#2 = 999;
     |LEE 000#11];
     |SI FSalida = 0;
          |LEE 000#11a;
     |SINO;
          |LEE 000#11u;
     |FINSI;
     |SI #11#0 = #0#4; |Y #11#1 = #0#5;
          nUltLin = #11#2 + 1;
     |SINO;
          nUltLin = 1;
     |FINSI;
|FPRC;

|PROCESO Inicio; |TIPO 3;
     || Lo copia
     eaSerOrg = #0#2;
     enNumOrg = #0#3;
     eaSerDes = #0#6;
     enNumDes = #0#7;
     |SUB_EJECUTA "gopredup;algo";

     || Asigna
     |ABRE #11;
     |HAZ UltLinExpe;
     #11#0 = #0#0;
     #11#1 = #0#1;
     #11#2 = nLin;
     |LEE 020#11=;
     |SI FSalida = 0;
          #11#0 = #0#4;
          #11#1 = #0#5;
          #11#2 = nUltLin;
          #11#3 = #0#6;
          #11#4 = #0#7;
          |GRABA 020#11n;
          |SI FSalida = 0;
               |HAZ MarcaPres;
          |FINSI;
     |FINSI;
     |CIERRA #11;

     ||Recalcula
     eaSer = #0#4;
     enNum = #0#5;
     |HAZ RecalExpe;     || llama al guerz015
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Tipo_13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |PINTA 1026, "O.T........:"
          |PINTA 1126, "O.E........:"
          |PINTA 1426, "O.T........:"
          |PINTA 1526, "O.E........:"
     |FINSI;
|FPRC;
