|VARIABLES;
     fFecha = @;
     nSemana = 0;
     nDiaSemana = 0;

     _fFecha = @;
     _f = @;
     _f1 = @;
     _aAlfa = "";
     _nJueves = 0;
     _nNume = 0;
|FIN;


|PROCESO CalculaSemana;
|| Norma ISO 8601
|| la semana 1 de cada a¤o es aquella en la que aparece
|| el primer jueves del a¤o
|| Ej: 02.01.2005 es la semana 53 del 2004

|| entrada fFecha, salida nSemana


     _fFecha = fFecha;
     _aAlfa = _fFecha % 704;
     |SI _aAlfa < "1900"; |ACABA; |FINSI;

     _aAlfa = "01.01." + _aAlfa;
     _fFecha = fFecha;
     nSemana = 0;
     _nJueves = 0;

     |PARA _f = _aAlfa; |SI _f [ _fFecha; |HACIENDO _f = _f + 1;
          _f1 = _f;
          _f1 = _f % A1;
          _aAlfa = _f1 % 1101;
          |SI _nJueves = 0;
               |SI _aAlfa = "J"; _nJueves = 1; nSemana = 1; |FINSI;
          |FINSI;
          |SI _nJueves = 1;
               |SI _aAlfa = "L"; nSemana = nSemana + 1; |FINSI;
          |FINSI;
     |SIGUE;
     |SI nSemana = 0;
          _fFecha = fFecha;
          _aAlfa = _fFecha % 704;
          _nNume = _aAlfa;
          _nNume = _nNume - 1;
          _aAlfa = ("0000" + _nNume) % -104;
          _aAlfa = "01.01." + _aAlfa;
          _fFecha = fFecha;
          nSemana = 0;
          _nJueves = 0;
          |PARA _f = _aAlfa; |SI _f [ _fFecha; |HACIENDO _f = _f + 1;
               _f1 = _f;
               _f1 = _f % A1;
               _aAlfa = _f1 % 1101;
               |SI _nJueves = 0;
                    |SI _aAlfa = "J"; _nJueves = 1; nSemana = 1; |FINSI;
               |FINSI;
               |SI _nJueves = 1;
                    |SI _aAlfa = "L"; nSemana = nSemana + 1; |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO DiaSemana;
     _f = fFecha % A1;
     _aAlfa = _f1 % 1102; _aAlfa = _aAlfa > ""
     |SI _aAlfa = "LU"; nDiaSemana = 1; |FINSI;
     |SI _aAlfa = "MA"; nDiaSemana = 2; |FINSI;
     |SI _aAlfa = "MI"; nDiaSemana = 3; |FINSI;
     |SI _aAlfa = "JU"; nDiaSemana = 4; |FINSI;
     |SI _aAlfa = "VI"; nDiaSemana = 5; |FINSI;
     |SI _aAlfa = "SA"; nDiaSemana = 6; |FINSI;
     |SI _aAlfa = "DO"; nDiaSemana = 7; |FINSI;
|FPRC;
