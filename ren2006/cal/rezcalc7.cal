|FICHEROS;
      rew99999 #999;
      retabla1 #401;

     &refere1@ #1001;
     &refere2@ #1002;
     &referr3@ #1003;

      datfic0@ #0;
      datfic1@ #1;
      datfic2@ #2;
|FIN;

|VARIABLES;
      aDef             = "";
      aAlfa            = "";
      aDecla           = "";
      aFichero         = "";

      nCoefi           = 0;
      nSwFich          = 0;
      nFactor          = 0;
      nCampo16         = 0;
      nValor           = 0;
      nValor1          = 0;
      nValor2          = 0;
      nValor3          = 0;
      nCatastral       = 0;
      nCampo1          = 0;
      nCampo2          = 0;
      nCampo3          = 0;
      nCampo4          = 0;
      nCampo5          = 0;
      nCampo6          = 0;
      nCampo7          = 0;
      nCampo8          = 0;
      nCampo9          = 0;
      nCampo10         = 0;
      nCampo11         = 0;
      nConta           = 0;
      nBaseImpo        = 0;
      nBaseImpo1       = 0;
      nBaseImpo2       = 0;
      nIntegra         = 0;
      nIntegraT        = 0;
      nIntegraC        = 0;
      nParte           = 0;
      nSw              = 0;
      nMenor           = 0;
      nTotalCuota      = 0;
      nDeduccion       = 0;
      nLimite          = 0;
      nValor33T        = 0;
      nValor33C        = 0;
      nValor35T        = 0;
      nValor35C        = 0;
      nValorTT         = 0;
      nValorTTT        = 0;
      nValorCC         = 0;
      nValorCCC        = 0;
      nValor27         = 0;
      nValor28         = 0;
      nPasada          = 0;
      nCuotaMino       = 0;
      nHipotetico      = 0;
      nCuotaHipotetica = 0;
      nPorce           = 0;

     &enEmpresa        = 0;
     &enComplementaria = 0;
     &eaPathDef        = "";
     &eaContri         = "";
     &enMinusvalia     = 0;
     &eaMinuAyuda      = "";
     &enBloque         = 0;
     &eaCasilla        = "";
     &enImporte        = 0;
     &enImporteA       = 0;
     &enSwAcum         = 0;
     &enNomeDat        = 0;
     &enNomeAgr        = 0;
     &eaMuerto         = "";
     &efFechaMuerto    = @;
     &enCalcuMuerto    = 0;
     &eaLiquida        = "";
     &eaModoRenta      = "";
|FIN;

|PROCESO Liquida7;
     enSwAcum  = 1;
     enImporte = 0;

     |SI #0#1 = "A1";
         aDef    = eaPathDef + "rem01044.mas";
         |CARGA_DEF aDef, datfic2@;
         |SI FSalida ! 0;
             aAlfa = "     Error en cargar el Def " + aDef;
             |MENAV aAlfa;
             |ACABA;
         |FINSI;

         |SI enNomeDat = 1;  |NOME_DAT #datfic2@#"zdat1044"#;  |FINSI;

         |ABRE #2;
         #2#0 = enEmpresa;
         #2#1 = enComplementaria;
         #2#2 = eaContri;
         |LEE 101#2=;
         |SI FSalida ! 0;
             |DDEFECTO #2;
             #2#0 = enEmpresa;
             #2#1 = enComplementaria;
             #2#2 = eaContri;
             |GRABA 020#2b;
         |FINSI;

         |SI #0#22 = "S";
             #2#3 = (N\ #2#3 + (#0#10 % nCoefi));
             |SI #0#3 = "VARIOS    ";
                 #2#4   = #401#90;
                 |SI #2#4 > #2#3;  #2#4 = #2#3;  |FINSI;
             |SINO;
                 #2#4 = (N\ #2#4 + (#0#23 % nCoefi));
             |FINSI;
             |SI #2#4 > #401#90;  #2#4 = #401#90;  |FINSI;
             #2#5 = (N\ #2#3 - #2#4);
         |SINO;
             #2#6 = (N\ #2#6 + (#0#10 % nCoefi));
         |FINSI;

         |GRABA 020#2a;
         |LIBERA #2;

         enBloque  = 1;
         eaCasilla = " 01";                || AAAAAAAAAAAAAAAAAAAAAAAAA
         enImporte = #2#5 + #2#6;

         |DESCARGA_DEF #datfic2@;
     |FINSI;

     |SI #0#1 = "B1"; enBloque  = 2;  eaCasilla = " 02";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "C1"; enBloque  = 3;  eaCasilla = " 03";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "C2"; enBloque  = 3;  eaCasilla = " 03";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "E1"; enBloque  = 4;  eaCasilla = " 05";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "F1"; enBloque  = 5;  eaCasilla = " 06";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "F2"; enBloque  = 5;  eaCasilla = " 07";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "G1"; enBloque  = 6;  eaCasilla = " 08";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "G2"; enBloque  = 6;  eaCasilla = " 09";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "G3"; enBloque  = 6;  eaCasilla = " 10";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "G4"; enBloque  = 6;  eaCasilla = " 11";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "I1"; enBloque  = 7;  eaCasilla = " 14";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "J1"; enBloque  = 8;  eaCasilla = " 15";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "K1"; enBloque  = 9;  eaCasilla = " 16";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "L1"; enBloque  = 10; eaCasilla = " 17";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "M1"; enBloque  = 11; eaCasilla = " 18";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "N1"; enBloque  = 12; eaCasilla = " 19";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "O1"; enBloque  = 13; eaCasilla = " 20";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "P1"; enBloque  = 14; eaCasilla = " 21";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "Q1"; enBloque  = 15; eaCasilla = " 22";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "U1"; enBloque  = 17; eaCasilla = " 24";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "D1"; enBloque  = 21; eaCasilla = " 04";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "H1"; enBloque  = 21; eaCasilla = " 12";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "H2"; enBloque  = 21; eaCasilla = " 13";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V1"; enBloque  = 23; eaCasilla = " 34";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V2"; enBloque  = 25; eaCasilla = "a  ";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V3"; enBloque  = 26; eaCasilla = " 40";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V4"; enBloque  = 23; eaCasilla = " 30";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V6"; enBloque  = 23; eaCasilla = " 31";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V7"; enBloque  = 28; eaCasilla = " 44";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V8"; enBloque  = 29; eaCasilla = " 47";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V9"; enBloque  = 22; eaCasilla = " 28";  enImporte = #0#10 % nCoefi;  |FINSI;
     |SI #0#1 = "V5";
         |SI eaContri = "ZPATRITIT ";
             nValor33T = nValor33T + (#0#10 % nCoefi);
             nValor35T = nValor35T + (#0#14 % nCoefi);
         |FINSI;
         |SI eaContri = "ZPATRICON ";
             nValor33C = nValor33C + (#0#10 % nCoefi);
             nValor35C = nValor35C + (#0#14 % nCoefi);
         |FINSI;
     |FINSI;

     |SI enImporte ! 0;
         enSwAcum  = 1;
         |SI #0#1 = "A1";  enSwAcum  = 0;  |FINSI;

         |HAZ CreaLiquida;               || En el rezcalut
         |HAZ GrabaLineal;
     |FINSI;

     enImporte = 0;

     |SI #0#1 = "V2"; enBloque  = 25; eaCasilla = "b  ";  enImporte = #0#14 % nCoefi;  |FINSI;
     |SI #0#1 = "V4"; enBloque  = 23; eaCasilla = " 33";  enImporte = #0#14 % nCoefi;  |FINSI;

     |SI enImporte ! 0;
         |HAZ CreaLiquida;               || En el rezcalut
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Seleccion7;
     |SI #0#3 = "GANANCIAL ";                || Si es Ganancial
         nCoefi = 50;  eaContri = "ZPATRITIT ";   |HAZ Liquida7;
         nCoefi = 50;  eaContri = "ZPATRICON ";   |HAZ Liquida7;

         |ACABA;
     |FINSI;

     |SI #0#3 ! "VARIOS    ";                || SI es TITULAR O CONYUGE;
         |SI #0#3 = "TITULAR   "; eaContri = "ZPATRITIT ";  |FINSI;
         |SI #0#3 = "CONYUGE   "; eaContri = "ZPATRICON ";  |FINSI;
         nCoefi = 100;
         |HAZ Liquida7;
         |ACABA;
     |FINSI;

     |SI #0#20 ! 0; nCoefi = #0#20;  eaContri = "ZPATRITIT ";  |HAZ Liquida7;  |FINSI;
     |SI #0#21 ! 0; nCoefi = #0#21;  eaContri = "ZPATRICON ";  |HAZ Liquida7;  |FINSI;
|FPRC;

|PROCESO Patrimonio;
     aDef    = eaPathDef + "rem00099.mas";
     |CARGA_DEF aDef, datfic0@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = enEmpresa;
     #0#1 = "  ";
     #0#2 = 1;
     |LEE 040#0];
     |PARA; |SI FSalida = 0;  |Y #0#0 = enEmpresa;  |HACIENDO;
            |HAZ Seleccion7;
            |LEE 040#0s;
     |SIGUE;
     |CIERRA #0;

     |DESCARGA_DEF #datfic0@;
|FPRC;

|PROCESO Hipotetico;
     nHipotetico = nValor27 + nValor28;
     nSw         = 0;
     nValor1     = 0;
     nValor2     = 0;
     nValor3     = 0;
     |PARA nCampo1 = 8;  |SI nCampo1 ] 1; |HACIENDO nCampo1 = nCampo1 - 1;
           |SI nHipotetico ] #1nCampo1;
               |SI #1nCampo1 ! 0;  |O nCampo1 = 1;
                   nCampo2 = nCampo1 + 16;
                   nCampo3 = nCampo1 + 8;
                   nValor1 = #1nCampo1;   || hasta
                   nValor2 = #1nCampo2;   || porcentaje
                   nValor3 = #1nCampo3;   || cuota hasta
                   |SAL;
               |FINSI;
           |FINSI;
     |SIGUE;

     |SI nHipotetico = 0;  nValor2 = 0;  |FINSI;

     nCuotaHipotetica = (nValor3 + ((nHipotetico - nValor1) % nValor2)) ! 2;
     nPorce           = ((nCuotaHipotetica  / nHipotetico) * 100) ! 2;
     enImporte        = (nValor27 % nPorce) ! 2;
|FPRC;

|PROCESO CalculaPatrim;
     aDef    = eaPathDef + "rem00100.mas";
     |CARGA_DEF aDef, datfic0@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aDef    = eaPathDef + "retabla3.mas";
     |CARGA_DEF aDef, datfic1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |ABRE #0;
     #0#0 = #1001#0;
     |LEE 040#0=;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
     |CIERRA #0;

     |ABRE #1;
     #1#0 = #999#7;
     |LEE 000#1=;
     |SI FSalida ! 0;
         #1#0 = 0;
         |LEE 000#1=;
         |SI FSalida ! 0;   |DDEFECTO #1;   |FINSI;
     |FINSI;
     |CIERRA #1;

     nValor   = 0;
     enBloque = 1;  eaCasilla = " 01"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 2;  eaCasilla = " 02"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 3;  eaCasilla = " 03"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 4;  eaCasilla = " 05"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 5;  eaCasilla = " 06"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 5;  eaCasilla = " 07"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 6;  eaCasilla = " 08"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 6;  eaCasilla = " 09"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 6;  eaCasilla = " 10"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 6;  eaCasilla = " 11"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 7;  eaCasilla = " 14"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 8;  eaCasilla = " 15"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 9;  eaCasilla = " 16"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 10; eaCasilla = " 17"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 11; eaCasilla = " 18"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 12; eaCasilla = " 19"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 13; eaCasilla = " 20"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 14; eaCasilla = " 21"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 15; eaCasilla = " 22"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enBloque = 22; eaCasilla = " 28"; |HAZ SacaImporte; nValor28 = enImporte;

     enSwAcum = 0;
     enBloque = 16; eaCasilla = " 23";  enImporte = nValor;  |HAZ GrabaLineal;
     nBaseImpo = enImporte;

     enBloque = 17; eaCasilla = " 24"; |HAZ SacaImporte; nValor1 = enImporte;

     nValor2  = nValor - nValor1;
     enBloque = 18; eaCasilla = " 25";  enImporte = nValor2;  |HAZ GrabaLineal;
     nBaseImpo1 = nValor2;

     |ABRE #999;
     |SELECT #2#999;
     #999#1 = "TITULAR";
     |SI nConta = 2;  #999#1 = "CONYUGE";  |FINSI;
     |LEE 040#999=;
     |SI FSalida  ! 0;  |DDEFECTO #999;  |FINSI;
     |CIERRA #999;

     enImporte = 0;
     |SI #0#94 = "N";
         enImporte = #401#69;

         |SI #999#7 = 12;
             enImporte = 112000;
             |SI #999#3 ] 65;  enImporte = 224000;  |FINSI;
         |FINSI;

         |SI #999#7 = 1;
             |SI #999#3 ] 33;  enImporte = 250000;  |FINSI;
         |FINSI;

         |SI #999#7 = 9;  |O #999#7 = 11;
             enImporte = 108200;
             |SI #999#3 ] 65;  enImporte = 216400;  |FINSI;
         |FINSI;

         |SI #999#7 = 17;
             enImporte = 108182.17;
             |SI #999#3 ] 65;  enImporte = 200000;  |FINSI;
         |FINSI;

         |SI #999#7 = 6;
             enImporte = 150000;
             |SI #999#3 ] 33;  enImporte = 200000;  |FINSI;
             |SI #999#3 ] 65;  enImporte = 300000;  |FINSI;
         |FINSI;

         |SI #999#7 = 10;
             |SI #999#3 ] 33;  enImporte = 120000;  |FINSI;
             |SI #999#3 ] 50;  enImporte = 150000;  |FINSI;
             |SI #999#3 ] 65;  enImporte = 180000;  |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#99 = "S";  #0#99 = "2";  |FINSI;

     |SI #0#94 = "S";  |Y #0#99 = "2";
         enImporte = #401#69;

         |SI #999#7 = 12;
             enImporte = 112000;
             |SI #999#3 ] 65;  enImporte = 224000;  |FINSI;
         |FINSI;

         |SI #999#7 = 1;
             |SI #999#3 ] 33;  enImporte = 250000;  |FINSI;
         |FINSI;

         |SI #999#7 = 9;  |O #999#7 = 11;
             enImporte = 108200;
             |SI #999#3 ] 65;  enImporte = 216400;  |FINSI;
         |FINSI;

         |SI #999#7 = 17;
             enImporte = 108182.17;
             |SI #999#3 ] 65;  enImporte = 200000;  |FINSI;
         |FINSI;
     |FINSI;

     enBloque = 19; eaCasilla = " 26";  |HAZ GrabaLineal;

     enImporte = nBaseImpo1 - enImporte;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;
     enBloque = 20; eaCasilla = " 27";  |HAZ GrabaLineal;
     nValor27 = enImporte;

     enBloque   = 22; eaCasilla = " 01";  |HAZ GrabaLineal;
     nBaseImpo2 = enImporte;

     nSw     = 0;
     nValor1 = 0;
     nValor2 = 0;
     nValor3 = 0;
     |PARA nCampo1 = 8;  |SI nCampo1 ] 1; |HACIENDO nCampo1 = nCampo1 - 1;
           |SI enImporte ] #1nCampo1;
               |SI #1nCampo1 ! 0;  |O nCampo1 = 1;
                   nCampo2 = nCampo1 + 16;
                   nCampo3 = nCampo1 + 8;
                   nValor1 = #1nCampo1;   || hasta
                   nValor2 = #1nCampo2;   || porcentaje
                   nValor3 = #1nCampo3;   || cuota hasta
                   |SAL;
               |FINSI;
           |FINSI;
     |SIGUE;

     |SI nBaseImpo2 = 0;  nValor2 = 0;      |FINSI;

     enImporte = nValor1; enBloque = 22; eaCasilla = " 02";  |HAZ GrabaLineal;
     enImporte = nValor2; enBloque = 22; eaCasilla = " 05";  |HAZ GrabaLineal;
     enImporte = nValor3; enBloque = 22; eaCasilla = " 03";  |HAZ GrabaLineal;

     enImporte = nBaseImpo2 - nValor1;
     enBloque  = 22; eaCasilla = " 04";  |HAZ GrabaLineal;

     enImporte = (nBaseImpo2 - nValor1) % nValor2;
     enBloque  = 22; eaCasilla = " 06";  |HAZ GrabaLineal;

     enImporte = (nValor3 + ((nBaseImpo2 - nValor1) % nValor2)) ! 2;
     enBloque  = 22; eaCasilla = " 07";  |HAZ GrabaLineal;

     |SI nValor28 = 0;
         enBloque  = 22; eaCasilla = " 29";  |HAZ GrabaLineal;
     |SINO;
         |HAZ Hipotetico;
         enBloque  = 22; eaCasilla = " 29";  |HAZ GrabaLineal;
     |FINSI;

                                  nIntegra  = enImporte;
     |SI #1001#2 = "ZPATRITIT ";  nIntegraT  = enImporte;  |FINSI;
     |SI #1001#2 = "ZPATRICON ";  nIntegraC  = enImporte;  |FINSI;

     |SI #0#94 = "N";
         enBloque  = 23; eaCasilla = " 34"; |HAZ SacaImporte;
         enImporte   = nIntegra;
         |SI eaModoRenta ! "";  |Y nPasada = 1;
             enBloque  = 23; eaCasilla = " 34"; |HAZ SacaImporte;
             |SI #1001#2 = "ZPATRITIT ";
                 nValorTT   = enImporte;
                 enImporte  = enImporte + nIntegraC;
                 nValorTTT  = enImporte;
             |FINSI;
             |SI #1001#2 = "ZPATRICON ";
                 nValorCC  = enImporte;
                 enImporte = enImporte + nIntegraT;
                 nValorCCC = enImporte;
             |FINSI;
         |FINSI;
         enBloque  = 23; eaCasilla = " 34";  |HAZ GrabaLineal;

         |SI #1001#2 = "ZPATRITIT ";
             |SI nValor33T ! 0;
                 enImporte = nValor33T;
                 enBloque  = 23; eaCasilla = " 34";  |HAZ GrabaLineal;
             |FINSI;
         |FINSI;

         |SI #1001#2 = "ZPATRICON ";
             |SI nValor33C ! 0;
                 enImporte = nValor33C;
                 enBloque  = 23; eaCasilla = " 34";  |HAZ GrabaLineal;
             |FINSI;
         |FINSI;

         enBloque  = 23; eaCasilla = " 30"; |HAZ SacaImporte;
         nValor1   = enImporte;

         enBloque  = 23; eaCasilla = " 33"; |HAZ SacaImporte;
         nValor2   = enImporte;

         |SI nValor1 = 0;  |Y nValor2 = 0;
             aDecla  = #1001#2;

             #1001#0 = enEmpresa;
             #1001#1 = enComplementaria;
             |SI eaModoRenta = "";
                 |SI nConta = 1;   #1001#2 = "TITULAR   ";  |FINSI;
                 |SI nConta = 2;   #1001#2 = "CONYUGE   ";  |FINSI;
             |SINO;
                 #1001#2 = "CONJUNTA  ";
             |FINSI;

             enBloque  = 10; eaCasilla = "484"; |HAZ SacaImporte;
             nValor1 = enImporte;

             enBloque  = 16; eaCasilla = "675"; |HAZ SacaImporte;
             nValor2 = enImporte + enImporteA;

             enImporteA = 0;
             #1001#0    = enEmpresa;
             #1001#1    = enComplementaria;
             #1001#2    = aDecla;
         |FINSI;

         |SI nValor1 < 0;  nValor1 = 0;  |FINSI;
         |SI nValor2 < 0;  nValor2 = 0;  |FINSI;

         enImporte = nValor1;
         enBloque  = 23; eaCasilla = " 30";  |HAZ GrabaLineal;

         enImporte = nValor2;
         enBloque  = 23; eaCasilla = " 33";  |HAZ GrabaLineal;

         nValor = 0;
         enBloque  = 23; eaCasilla = " 30"; |HAZ SacaImporte; nValor = nValor + enImporte;
         enBloque  = 23; eaCasilla = " 31"; |HAZ SacaImporte; nValor = nValor + enImporte;

         enImporte = nValor % 60;
         enBloque  = 23; eaCasilla = " 32";  |HAZ GrabaLineal;

         nValor = 0;
         enBloque  = 23; eaCasilla = " 33"; |HAZ SacaImporte; nValor = nValor + enImporte;
         enBloque  = 23; eaCasilla = " 34"; |HAZ SacaImporte; nValor = nValor + enImporte;

         enImporte = nValor;
         enBloque  = 23; eaCasilla = " 35";  |HAZ GrabaLineal;

         nValor1 = 0;
         nValor2 = 0;
         enBloque  = 23; eaCasilla = " 32"; |HAZ SacaImporte; nValor1 = enImporte;
         enBloque  = 23; eaCasilla = " 35"; |HAZ SacaImporte; nValor2 = enImporte;

         |SI nValor1 ] nValor2;
             enImporte = 0;
             enBloque  = 23; eaCasilla = " 36";  |HAZ GrabaLineal;
             enBloque  = 23; eaCasilla = " 37";  |HAZ GrabaLineal;

             enImporte = nIntegra;
             enBloque  = 24; eaCasilla = " 38";  |HAZ GrabaLineal;
         |SINO;
             |SI eaModoRenta ! "";  |Y nPasada = 1;
                 |SI #1001#2 = "ZPATRITIT ";
                     nCoefi  = (nValorTT / nValorTTT);
                     enImporte = (nValor2 - nValor1) * nCoefi;
                 |FINSI;

                 |SI #1001#2 = "ZPATRICON ";
                     nCoefi  = (nValorCC / nValorCCC);
                     enImporte = (nValor2 - nValor1) * nCoefi;
                 |FINSI;
            |SINO;
                 enImporte = nValor2 - nValor1;
            |FINSI;

            enBloque  = 23; eaCasilla = " 36";  |HAZ GrabaLineal;
            nMenor    = enImporte;
            enImporte = nIntegra % 80;
            enBloque  = 23; eaCasilla = " 37";  |HAZ GrabaLineal;
            |SI enImporte < nMenor; nMenor = enImporte;  |FINSI;

            nValor    = nIntegra - nMenor;
            enImporte = nValor;
            enBloque  = 24; eaCasilla = " 38";  |HAZ GrabaLineal;
         |FINSI;

         |SI #1001#2 = "ZPATRITIT ";  |Y nValor35T ! 0;
             enImporte = nValor35T;
             enBloque  = 23; eaCasilla = " 36";  |HAZ GrabaLineal;

             enImporte = nIntegra % 80;
             enBloque  = 23; eaCasilla = " 37";  |HAZ GrabaLineal;

             nValor    = nValor35T;
             |SI nValor > enImporte;  nValor = enImporte;  |FINSI;

             enImporte = nIntegra - nValor;
             enBloque  = 24; eaCasilla = " 38";  |HAZ GrabaLineal;
         |FINSI;

         |SI #1001#2 = "ZPATRICON ";  |Y nValor35C ! 0;
             enImporte = nValor35C;
             enBloque  = 23; eaCasilla = " 36";  |HAZ GrabaLineal;

             enImporte = nIntegra % 80;
             enBloque  = 23; eaCasilla = " 37";  |HAZ GrabaLineal;

             nValor    = nValor35C;
             |SI nValor > enImporte;  nValor = enImporte;  |FINSI;

             enImporte = nIntegra - nValor;
             enBloque  = 24; eaCasilla = " 38";  |HAZ GrabaLineal;
         |FINSI;
     |SINO;
         enImporte = 0;
         enBloque  = 23; eaCasilla = " 30";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 31";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 32";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 33";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 34";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 35";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 36";  |HAZ GrabaLineal;
         enBloque  = 23; eaCasilla = " 37";  |HAZ GrabaLineal;

         enImporte = nIntegra;
         enBloque  = 24; eaCasilla = " 38";  |HAZ GrabaLineal;
     |FINSI;

     nTotalCuota = enImporte;
     enImporte   = (nTotalCuota / nBaseImpo2) * 100;
     enBloque    = 25; eaCasilla = "TM ";  |HAZ GrabaLineal;

     enBloque    = 25; eaCasilla = "b  "; |HAZ SacaImporte;
     nValor      = (((nTotalCuota / nBaseImpo2) * enImporte) - 0.0049) ! 2;

     enBloque    = 25; eaCasilla = "a  "; |HAZ SacaImporte;
     |SI enImporte > nValor;  enImporte = nValor;  |FINSI;
     enBloque    = 25; eaCasilla = "z39";  |HAZ GrabaLineal;
     nDeduccion  = enImporte;

     enBloque    = 26; eaCasilla = " 40"; |HAZ SacaImporte;
     enImporte   = (enImporte / nBaseImpo1) * nTotalCuota;
     enBloque    = 26; eaCasilla = " 41";  |HAZ GrabaLineal;

     enImporte   = enImporte % 75;
     nLimite     = nTotalCuota % 75;
     |SI enImporte > nLimite;  enImporte = nLimite;  |FINSI;
     enBloque    = 26; eaCasilla = " 42";  |HAZ GrabaLineal;

     enImporte   = nTotalCuota - nDeduccion - enImporte;
     enBloque    = 27; eaCasilla = " 43";  |HAZ GrabaLineal;
     nCuotaMino  = enImporte;

     enBloque    = 28; eaCasilla = " 44"; |HAZ SacaImporte;
     enImporte   = (enImporte / nBaseImpo1) * nCuotaMino;
     enBloque    = 28; eaCasilla = " 45";  |HAZ GrabaLineal;

     enImporte   = enImporte  % 99;
     nLimite     = nCuotaMino % 99;
     |SI enImporte > nLimite;  enImporte = nLimite;  |FINSI;
     enBloque    = 28; eaCasilla = " 46";  |HAZ GrabaLineal;

     enBloque    = 29; eaCasilla = " 47"; |HAZ SacaImporte;
     enImporte   = (enImporte / nBaseImpo1) * nCuotaMino;
     enBloque    = 29; eaCasilla = " 48";  |HAZ GrabaLineal;

     enImporte   = enImporte  % 99;
     nLimite     = nCuotaMino % 99;
     |SI enImporte > nLimite;  enImporte = nLimite;  |FINSI;
     enBloque    = 29; eaCasilla = " 49";  |HAZ GrabaLineal;

     nValor   = 0;
     enBloque = 27; eaCasilla = " 43"; |HAZ SacaImporte; nValor = enImporte;
     enBloque = 28; eaCasilla = " 46"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 29; eaCasilla = " 49"; |HAZ SacaImporte; nValor = nValor - enImporte;

     enImporte = nValor;
     enBloque  = 30; eaCasilla = " 50";  |HAZ GrabaLineal;

     #1001#4     = "N";
     |SI enImporte > 0;
         #1001#3 = enImporte;
         #1001#4 = "S";
         #1001#5 = "714";
     |FINSI;

     |DESCARGA_DEF #datfic1@;
     |DESCARGA_DEF #datfic0@;
|FPRC;

|PROCESO Bloque7;
     nValor33T = 0;
     nValor33C = 0;
     nValor35T = 0;
     nValor35C = 0;
     nIntegraT = 0;
     nIntegraC = 0;
     nValorTT  = 0;
     nValorTTT = 0;
     nValorCC  = 0;
     nValorCCC = 0;
     nValor28  = 0;

     |HAZ Patrimonio;

     nPasada = 0;
     |DDEFECTO #1001;
     FSalida = 0;
     #1001#0 = enEmpresa;
     #1001#1 = enComplementaria;
     |PARA nConta = 1;  |SI nConta [ 2;  |HACIENDO nConta = nConta + 1;
            |SI nConta = 1;   #1001#2 = "ZPATRITIT ";  |FINSI;
            |SI nConta = 2;   #1001#2 = "ZPATRICON ";  |FINSI;
            |LEE 101#1001=;
            |SI FSalida = 0;
                |SI nConta = 1;  |Y eaMuerto = "T";
                    |LIBERA #1001;

                    eaLiquida = #1001#2;
                    |HAZ BorraLiquidacion;
                    eaLiquida = "";
                |FINSI;

                |SI nConta = 2;  |Y eaMuerto = "C";
                    |LIBERA #1001;

                    eaLiquida = #1001#2;
                    |HAZ BorraLiquidacion;
                    eaLiquida = "";
                |FINSI;

                |SI eaMuerto = "";
                    |HAZ CalculaPatrim;
                    |GRABA 020#1001a;
                |SINO;
                    |SI nConta = 1;  |Y eaMuerto = "C";
                        |HAZ CalculaPatrim;
                        |GRABA 020#1001a;
                    |FINSI;

                    |SI nConta = 2;  |Y eaMuerto = "T";
                        |HAZ CalculaPatrim;
                        |GRABA 020#1001a;
                    |FINSI;
                |FINSI;

                |LIBERA #1001;
            |FINSI;
     |SIGUE;

     nPasada = 1;
     |SI eaModoRenta ! "";
         |DDEFECTO #1001;
         FSalida = 0;
         #1001#0 = enEmpresa;
         #1001#1 = enComplementaria;
         |PARA nConta = 1;  |SI nConta [ 2;  |HACIENDO nConta = nConta + 1;
                |SI nConta = 1;   #1001#2 = "ZPATRITIT ";  |FINSI;
                |SI nConta = 2;   #1001#2 = "ZPATRICON ";  |FINSI;
                |LEE 101#1001=;
                |SI FSalida = 0;
                    |SI eaMuerto = "";
                        |HAZ CalculaPatrim;
                        |GRABA 020#1001a;
                    |FINSI;
                    |LIBERA #1001;
                |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;
