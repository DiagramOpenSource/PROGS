|FICHEROS;
     recapreo;
     reeoscnc;
     reeoscfg;

     rem00025;
     rem00026;
     rem00021;
     rem00031;
     rem00028;
     rem00029;
     rem00058;
     rem00905;
     retabla4;

     eoslinco@;
     eoslinve@;
     eosactiv@;
     eosclien@;
     eosm0017@;
     eosm0018@;
     eoscomul@;
     eosm0011@;
     eosm0012@;
     eosm3130@;
     eosm0020@;
     eosconcd@;
     agicontr@;
     eosexist@;

     :/agitool/def/zmonedas;
|FIN;

|VARIABLES;
     nPorceGasto = 0;
     Nombre = "";
     RCatastral = "";
     aAlfa   = "";
     nActi    = 0;
     ExistIni = 0;
     ExistFin = 0;

     nPatrones = 0;

     Concepto   = "";
     LongConcep = 0;
     Comodin    = "";
     Comodin1   = "";
     Path       = "";
     Linea      = 0;
     Linea1     = 0;
     &eaPrograma = "";
     &eaPunto    = "";
     &enEmpresa   = 0;
     &enLineaArre = 0;
     FEstado     = 0;
     Comunidad   = 0;

     Modifica = 0;
     TitCon   = "";

     nImporte  = 0;
     nImporte1 = 0;
     nImporte2 = 0;
     nImporte3 = 0;
     nImporte4 = 0;
     nImporte5 = 0;
     nImporte6 = 0;

     nRetenc  = 0;
     nRetenc1 = 0;
     nRetenc2 = 0;
     nRetenc3 = 0;
     nRetenc4 = 0;
     nRetenc5 = 0;
     nRetenc6 = 0;
     nVentana = 0;

     TotRetenc = 0;

     Calc       = 0;
     Cont       = 0;
     Total      = 0;
     nCanti     = 0;
     nCanti1    = 0;
     nCanti2    = 0;
     nRdto97    = 0;
     nActivid   = 0;
     nLinea     = 0;
     nAnyoRenta = 0;
     aTipo      = "";

     LinBase = 0;

     nCProducto = 0;
     nCoefi98   = 0;
     nCodInter  = 0;

     nOkDirec            = 0;
     nCmp                = 0;
     aCas                = "";

     &enEmprEos          = 0;
     &enActiEos          = 0;
     &enEmprRen          = 0;
     &eaCaracter         = "";
     &eaTitCony          = "";

     &enOk               = 0;
     &enLin              = 0;
     &eaModal            = "";
     &ea32_1             = "";
     &ea32_2_1           = "";
     &en0180             = 0;
     &en0218             = 0;
     &en0219             = 0;
     &en0220             = 0;
     &en0221             = 0;
     &en0222             = 0;
     &en0223             = 0;
     &en0224             = 0;
     &en0225             = 0;
     &en0226             = 0;
|FIN;

|PROCESO Comunidad;
     #eosactiv@#0 = #recapreo#0;
     #eosactiv@#1 = #recapreo#1;
     #eosactiv@#2 = nAnyoRenta;
     |LEE 010#eosactiv@.=;
     |SI FSalida = 0;
        |SI #eosactiv@#46 = "S";
           Comunidad = 1;
           |C_M #recapreo#5,1,"S";
           |C_M #recapreo#6,1,"S";
        |SINO;
           Comunidad = 0;
           |C_M #recapreo#5,1,"N";
           |C_M #recapreo#6,1,"N";
        |FINSI;
     |SINO;
        Comunidad = 0;
        |C_M #recapreo#5,1,"N";
        |C_M #recapreo#6,1,"N";
     |FINSI;
|FPRC;

|PROCESO rem00031;
     |BORRA 020#rem00031.a;
     |LIBERA #rem00031;
|FPRC;

|DEFBUCLE rem00031;
     #rem00031#2;
     2;
     #recapreo#2, 1, aTipo;
     #recapreo#2, 9, aTipo;
     be;
     NULL, rem00031;
|FIN;

|PROCESO PagosACuenta;
     || Se elimina el registro de renta que apunta a la actividad

     |SI #recapreo#3 = "T";
         aTipo = "TITULAR   ";
     |SINO;
         aTipo = "CONYUGE   ";
     |FINSI;

     |BUCLE rem00031;

     |SELECT #1#rem00031;
     Linea1 = 1;
     |PARA; |SI; |HACIENDO;
            #rem00031#0  = #recapreo#2;
            #rem00031#1  = Linea1;
            |LEE 000#rem00031.=;
            |SI FSalida ! 0;  |SAL;  |FINSI;
            Linea1 = Linea1 + 1;
     |SIGUE;

     || Se crea de nuevo el registro en vacio

     |DDEFECTO #rem00031;
     #rem00031#0  = #recapreo#2;
     #rem00031#1  = Linea1;
     |SI #recapreo#7 ! "A";
        |SI #eosactiv@#42 = "N";
           #rem00031#16 = 9;
        |SINO;
           |SI #eosactiv@#46 ! "S";
              #rem00031#16 = #eosactiv@#1;
           |SINO;
              #rem00031#16 = #eosactiv@#6;
           |FINSI;
        |FINSI;
     |SINO;
        #rem00031#16 = 0;
     |FINSI;
     |SI #recapreo#3 = "T";
         #rem00031#2 = "TITULAR";
     |SINO;
         #rem00031#2 = "CONYUGE";
     |FINSI;

     || Se leen los 4 periodos del modelo

     |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
        |SI #recapreo#7 ! "A";
           || El modelo 130 en caso de que la actividad no sea de modulos
           |SI #eosactiv@#42 = "N";
              |SI #eosactiv@#46 ! "S";
                 #eosm3130@#0 = #recapreo#0;
              |SINO;
                 #eosm3130@#0 = #recapreo#5;
              |FINSI;
              #eosm3130@#1 = 9;
           |SINO;
              |SI #eosactiv@#46 ! "S";
                 #eosm3130@#0 = #recapreo#0;
                 #eosm3130@#1 = #recapreo#1;
              |SINO;
                 #eosm3130@#0 = #recapreo#5;
                 #eosm3130@#1 = #recapreo#6;
              |FINSI;
           |FINSI;
           #eosm3130@#2 = Cont;
           #eosm3130@#3 = nAnyoRenta;
           |LEE 010#eosm3130@.=;
           |SI FSalida = 0;
              |SI #eosm3130@#4 ! "          ";
                 Calc = Cont + 10;
                 |SI #eosm3130@#46 > 0;
                     #rem00031#Calc# = #rem00031#Calc# + #eosm3130@#46;
                 |FINSI;

                 #rem00031#15    = #rem00031#15 + (#eosm3130@#23 + #eosm3130@#36);
              |FINSI;
           |FINSI;
        |SINO;
           || El modelo 131 en caso de que la actividad sea de modulos
           |SI Comunidad = 0;
              #eosm0020@#0 = #recapreo#0;
           |SINO;
              #eosm0020@#0 = #recapreo#5;
           |FINSI;
           #eosm0020@#1 = nAnyoRenta;
           #eosm0020@#2 = Cont;
           |LEE 010#eosm0020@.=;
           |SI FSalida = 0; |Y #eosm0020@#4 ! "01.01.0000";
              Calc = Cont + 10;
              |SI #eosm0020@#47 > 0;
                  #rem00031#Calc# = #rem00031#Calc# + #eosm0020@#47;
              |FINSI;
              #rem00031#15    = #rem00031#15 + #eosm0020@#54;
           |FINSI;
        |FINSI;
     |SIGUE;

     |SI #rem00031#11 ! 0; |O #rem00031#12 ! 0; |O #rem00031#13 ! 0;
      |O #rem00031#14 ! 0; |O #rem00031#15 ! 0;
         #rem00031#17 = #eosactiv@#14;

         |GRABA 020#rem00031.n;

         |LEE 010#rem00031.=;
     |FINSI;

     enEmpresa    = #recapreo#2;
     eaPrograma   = "rem00031";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;

     |LIBERA #rem00031;
|FPRC;

|PROCESO BuscaLinArrend;
     Linea1 = 1;

     #rem00021#0 = #recapreo#2;
     #rem00021#1 = enLineaArre;
     |LEE 101#rem00021.=;
     |SI FSalida ! 0;
         |SI #recapreo#3 = "T";
             #rem00021#2 = "TITULAR";
         |SINO;
             #rem00021#2 = "CONYUGE";
         |FINSI;
         |GRABA 020#rem00021.b;
     |FINSI;
|FPRC;

|PROCESO Arrendamiento;
     |SI enLineaArre = 0;
         |ACABA;
     |FINSI;

     #eosm0012@#0 = #eoslinve@#0;
     #eosm0012@#1 = #eoslinve@#14;
     #eosm0012@#2 = LinBase;
     #eosm0012@#3 = #eoslinve@#1;
     |LEE 010#eosm0012@.=;
     |SI FSalida = 0;
         #eosm0011@#0 = #eosm0012@#0;
         #eosm0011@#1 = #eosm0012@#4;
         |LEE 010#eosm0011@.=;
         |SI FSalida ! 0; |DDEFECTO #eosm0011@; |FINSI;

         RCatastral = #eosm0011@#5;
     |FINSI;

     |HAZ BuscaLinArrend;

     #rem00021#14 = RCatastral;
     #rem00021#31 = 365;

     #rem00021#37  = "A"; #rem00021#39  = "A"; #rem00021#41 = "A";
     #rem00021#43  = "A"; #rem00021#46  = "A"; #rem00021#48 = "A";
     #rem00021#49  = "A"; #rem00021#50  = "A"; #rem00021#52 = "A";
     #rem00021#54  = "A"; #rem00021#56  = "A"; #rem00021#59 = "A";
     #rem00021#132 = "A";

     #reeoscfg#0 = #reeoscnc#3;
     #reeoscfg#1 = #reeoscnc#6;
     |LEE 000#reeoscfg.=;
     |SI FSalida = 0;
         nCmp =  #reeoscfg#3;
         |SI nCmp ! 0;
             #rem00021#nCmp# = #rem00021#nCmp# + nImporte;
         |FINSI;
     |FINSI;

     |SI #reeoscnc#3 = "C";
         #rem00021#47 = #rem00021#47 + nRetenc;
         #rem00021#61 = #rem00021#61 + nImporte;
     |FINSI;

     |GRABA 020#rem00021.a;
     |LIBERA #rem00021;

     enEmpresa    = #recapreo#2;
     eaPrograma   = "rem00021";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO GrabaLinea;
     |LEE 101#rem00029.=;
     |SI FSalida = 0;
         |SI #rem00029#8 = "N";
             #rem00028#26 = #rem00028#26 - #rem00029#7;
         |SINO;
             #rem00028#27 = #rem00028#27 - #rem00029#7;
         |FINSI;

         #rem00029#6  = #rem00029#6 + nImporte;
         #rem00029#7  = #rem00029#6 * #rem00029#5;

         |GRABA 140#rem00029.a;
     |SINO;
         #rem00029#3  = nCProducto;
         #rem00029#4  = 0;
         #rem00029#5  = nCoefi98;
         #rem00029#6  = nImporte;
         #rem00029#7  = #rem00029#6 * #rem00029#5;
         #rem00029#8  = "N";
         #rem00029#9  = nCodInter;
         #rem00029#10 = 0;
         #rem00029#11 = 0;
         |GRABA 140#rem00029.n;
     |FINSI;
     |LIBERA #rem00029;

     |SI #rem00029#8 = "N";
         #rem00028#26 = #rem00028#26 + #rem00029#7;
     |SINO;
         #rem00028#27 = #rem00028#27 + #rem00029#7;
     |FINSI;
|FPRC;

|PROCESO Recalc1;
     #rem00028#30 = #rem00028#26 + #rem00028#27;
     #rem00028#34 = #rem00028#30 - #rem00028#33;

     nCanti1 = #rem00028#26 - #rem00028#31;
     |SI #rem00028#35 ! 0;  nCanti1 = nCanti1 * #rem00028#35;  |FINSI;
     |SI #rem00028#36 ! 0;  nCanti1 = nCanti1 * #rem00028#36;  |FINSI;
     |SI #rem00028#38 ! 0;  nCanti1 = nCanti1 * #rem00028#38;  |FINSI;
     |SI #rem00028#54 ! 0;  nCanti1 = nCanti1 * #rem00028#54;  |FINSI;
     |SI #rem00028#39 ! 0;  nCanti1 = nCanti1 * #rem00028#39;  |FINSI;
     |SI #rem00028#55 ! 0;  nCanti1 = nCanti1 * #rem00028#55;  |FINSI;

     nCanti2 = #rem00028#27 - #rem00028#32;
     |SI #rem00028#35 ! 0;  nCanti2 = nCanti2 * #rem00028#35;  |FINSI;
     |SI #rem00028#36 ! 0;  nCanti2 = nCanti2 * #rem00028#36;  |FINSI;
     |SI #rem00028#37 ! 0;  nCanti2 = nCanti2 * #rem00028#37;  |FINSI;
     |SI #rem00028#38 ! 0;  nCanti2 = nCanti2 * #rem00028#38;  |FINSI;
     |SI #rem00028#54 ! 0;  nCanti2 = nCanti2 * #rem00028#54;  |FINSI;
     |SI #rem00028#39 ! 0;  nCanti2 = nCanti2 * #rem00028#39;  |FINSI;
     |SI #rem00028#55 ! 0;  nCanti2 = nCanti2 * #rem00028#55;  |FINSI;

     #rem00028#40 = nCanti1 + nCanti2;

     #rem00028#57 = 0;
     #rem00028#64 = 0;
     |SI #rem00028#40 > 0;
         #rem00028#64 = 5;
         #rem00028#57 = #rem00028#40 % #rem00028#64;
     |FINSI;

     #rem00028#44 = #rem00028#40 - #rem00028#57;
     #rem00028#48 = #rem00028#44 % #rem00028#47;

     |SI #rem00028#48 < 0;  #rem00028#48 = -#rem00028#48;  |FINSI;
     #rem00028#49 = #rem00028#44 - #rem00028#48 - #rem00028#43;

     |SI #rem00028#49 < 0;
         |SI #rem00028#35 ! 0;  |O #rem00028#36 ! 0;  |O #rem00028#37 ! 0;  |O #rem00028#38 ! 0;
          |O #rem00028#39 ! 0;  |O #rem00028#54 ! 0;  |O #rem00028#55 ! 0;
             #rem00028#49 = 0;
         |FINSI;
     |FINSI;

     #rem00028#51 = 0;
     |SI #rem00028#50 = "S";
         #rem00028#51 = #rem00028#49 % 30;
          |SI #rem00028#51 > 90000; #rem00028#51 = 90000;  |FINSI;
     |FINSI;

     #rem00028#52 = #rem00028#49 - #rem00028#51;
|FPRC;

|PROCESO ModAgraria;
     |SI #recapreo#7 ! "A";
         |ACABA;
     |FINSI;

     Comodin = Concepto - "----";
     #eosconcd@#0 = Comodin;
     |LEE 010#eosconcd@.=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     TotRetenc = TotRetenc + nRetenc;
     Linea1 = 1;
     |DDEFECTO #rem00028;
     #rem00028#0 = #recapreo#2;
     #rem00028#1 = 1;
     |LEE 010#rem00028.]
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #rem00028#0 = #recapreo#2;
              TitCon = #rem00028#2 % 0101;
              |SI #rem00028#18 = #eosactiv@#4; |Y #rem00028#19 = #eosactiv@#5; |Y TitCon =   #recapreo#3;
                  Modifica = 1;
              |SINO;
                  Modifica = 0;
                  Linea1 = #rem00028#1 + 1;
              |FINSI;
          |SINO;
              |SAL;
          |FINSI;
          |LEE 010#rem00028.s;
     |SIGUE;

     |SI Modifica = 0;           || Si es la misma actividad no debe
         |DDEFECTO #rem00028;     ||   crear una linea nueva, sino
         #rem00028#0 = #recapreo#2; || a¤adirlo a la existente
         #rem00028#1 = Linea1;
         |SI #recapreo#3 = "T";
             #rem00028#2 ="TITULAR";
         |SINO;
             #rem00028#2 ="CONYUGE";
         |FINSI;

         #rem00028#18 = #eosactiv@#4;
         #rem00028#19 = #eosactiv@#5;
         #rem00028#70 = #eosactiv@#1;
         |GRABA 020#rem00028.n;
         |LIBERA #rem00028;
     |SINO;
         #rem00028#0 = #recapreo#2; || a¤adirlo a la existente
         #rem00028#1 = Linea1;
         |SI #recapreo#3 = "T";
             #rem00028#2 ="TITULAR";
         |SINO;
             #rem00028#2 ="CONYUGE";
         |FINSI;
     |FINSI;

     |LEE 010#rem00028.=;
     enEmpresa    = #recapreo#2;
     eaPrograma   = "rem00028";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;

     |DDEFECTO #rem00029;
     |SI #eosconcd@#7 = .13;
         #rem00029#0 = #rem00028#0;
         #rem00029#1 = #rem00028#1;
         #rem00029#2 = 1;
         nCProducto  = 80;
         nCoefi98    = .13;
         nCodInter   = 1;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #eosconcd@#7 = .26;
         #rem00029#0 = #rem00028#0;
         #rem00029#1 = #rem00028#1;
         #rem00029#2 = 3;
         nCProducto  = 24;
         nCoefi98   = .26;
         nCodInter  = 3;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #eosconcd@#7 = .32;
         #rem00029#0 = #rem00028#0;
         #rem00029#1 = #rem00028#1;
         #rem00029#2 = 6;
         nCProducto  = 3;
         nCoefi98    = .32;
         nCodInter   = 7;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #eosconcd@#7 = .37;
         #rem00029#0 = #rem00028#0;
         #rem00029#1 = #rem00028#1;
         #rem00029#2 = 8;
         nCProducto  = 5;
         nCoefi98    = .37;
         nCodInter   = 10;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #eosconcd@#7 = .42;
         #rem00029#0 = #rem00028#0;
         #rem00029#1 = #rem00028#1;
         #rem00029#2 = 10;
         nCProducto  = 26;
         nCoefi98    = .42;
         nCodInter   = 13;
         |HAZ GrabaLinea;
     |FINSI;

     |SI #eosconcd@#7 = .56;
        #rem00029#0 = #rem00028#0;
        #rem00029#1 = #rem00028#1;
        #rem00029#2 = 13;
        nCProducto  = 285;
        nCoefi98    = .56;
        nCodInter   = 17;
        |HAZ GrabaLinea;
     |FINSI;

     |HAZ Recalc1;

     #rem00028#25 = #rem00028#25 + nImporte;
     |GRABA 020#rem00028.a;

     |SI #rem00028#14 = "S";  |HAZ Graba58E4;  |FINSI;
|FPRC;

|PROCESO Suma;
     |QBF Concepto;
     |SI Concepto = "";
         |ACABA;
     |FINSI;

     |SI LongConcep = 2;
         Concepto = "----" + (("00" + Concepto) % -102);
     |SINO;
         Concepto = ("000000" + Concepto) % -106;
     |FINSI;

     |SELECT #2#reeoscnc;
     #reeoscnc#1 = Concepto;
     #reeoscnc#0 = 1;
     |LEE 010#reeoscnc.];
     |PARA; |SI FSalida = 0; |Y #reeoscnc#1 = Concepto; |HACIENDO;
           |SI enLineaArre = 0;
               |SI #reeoscnc#3 = "A";  |O #reeoscnc#3 = "B";
                   |HAZ ModDirecta;
               |FINSI;
           |FINSI;

           |SI enLineaArre ! 0;
               |SI #reeoscnc#3 = "C";  |O #reeoscnc#3 = "D";
                   |HAZ Arrendamiento;
               |FINSI;
           |FINSI;

           |LEE 000#reeoscnc.s;
     |SIGUE;

     |SI enLineaArre = 0;
         |SI LongConcep = 2; |Y #eosactiv@#41 = "S";
             |HAZ ModAgraria;
         |FINSI;
     |FINSI;

     |SELECT #1#reeoscnc;
|FPRC;

|PROCESO LinVentas;
     nImporte1 = #eoslinve@#7;
     nImporte2 = #eoslinve@#23;
     nImporte3 = #eoslinve@#24;
     nImporte4 = #eoslinve@#45;
     nImporte5 = #eoslinve@#46;
     nImporte6 = #eoslinve@#47;

     nRetenc1 = #eoslinve@#42;
     nRetenc2 = #eoslinve@#43;
     nRetenc3 = #eoslinve@#44;
     nRetenc4 = #eoslinve@#69;
     nRetenc5 = #eoslinve@#70;
     nRetenc6 = #eoslinve@#71;

     LongConcep = 2;
     Concepto = #eoslinve@#5;  nImporte = nImporte1; nRetenc = nRetenc1; LinBase = 1; |HAZ Suma;
     Concepto = #eoslinve@#33; nImporte = nImporte2; nRetenc = nRetenc2; LinBase = 2; |HAZ Suma;
     Concepto = #eoslinve@#34; nImporte = nImporte3; nRetenc = nRetenc3; LinBase = 3; |HAZ Suma;
     Concepto = #eoslinve@#60; nImporte = nImporte4; nRetenc = nRetenc4; LinBase = 4; |HAZ Suma;
     Concepto = #eoslinve@#61; nImporte = nImporte5; nRetenc = nRetenc5; LinBase = 5; |HAZ Suma;
     Concepto = #eoslinve@#62; nImporte = nImporte6; nRetenc = nRetenc6; LinBase = 6; |HAZ Suma;

     LongConcep = 6;
     Concepto = #eoslinve@#72; nImporte = nImporte1; nRetenc = nRetenc1; LinBase = 1; |HAZ Suma;
     Concepto = #eoslinve@#73; nImporte = nImporte2; nRetenc = nRetenc2; LinBase = 2; |HAZ Suma;
     Concepto = #eoslinve@#74; nImporte = nImporte3; nRetenc = nRetenc3; LinBase = 3; |HAZ Suma;
     Concepto = #eoslinve@#75; nImporte = nImporte4; nRetenc = nRetenc4; LinBase = 4; |HAZ Suma;
     Concepto = #eoslinve@#76; nImporte = nImporte5; nRetenc = nRetenc5; LinBase = 5; |HAZ Suma;
     Concepto = #eoslinve@#77; nImporte = nImporte6; nRetenc = nRetenc6; LinBase = 6; |HAZ Suma;
|FPRC;

|DEFBUCLE LinVentas;
     #eoslinve@#1003;
     19;
     #recapreo#0, nAnyoRenta, 00001, #recapreo#1;
     #recapreo#0, nAnyoRenta, 32000, #recapreo#1;
     ;
     NULL, LinVentas;
|FIN;

|PROCESO Graba58E4;
     |ABRE #rem00058;
     |SELECT #1#rem00058;
     #rem00058#0 = #rem00021#0;
     #rem00058#1 = 99;
     |LEE 040#rem00058.];
     |SI FSalida = 0;
         |LEE 040#rem00058.a;
     |SINO;
         |LEE 040#rem00058.u;
     |FINSI;
     nLinea = 1;

     |SI FSalida = 0;  |Y #rem00058#0 = #rem00028#0;
         nLinea = #rem00058#1 + 1;
     |FINSI;

     |DDEFECTO #rem00058;
     #rem00058#0  = #rem00028#0;
     #rem00058#1  = nLinea;
     #rem00058#2  = #rem00028#2;
     #rem00058#3  = "R";
     #rem00058#4  = #rem00028#4;
     #rem00058#5  = #rem00028#5;
     #rem00058#6  = #rem00028#6;
     #rem00058#7  = #rem00028#7;
     #rem00058#8  = #rem00028#8;
     #rem00058#9  = #rem00028#9;
     #rem00058#10 = #rem00028#10;
     #rem00058#11 = #rem00028#15;
     #rem00058#12 = #rem00028#20;
     #rem00058#13 = 3;
     #rem00058#14 = "E4";
     #rem00058#15 = #rem00028#1;
     #rem00058#27 = #rem00028#49 % #rem00058#11;
     #rem00058#29 = #rem00028#51 % #rem00058#11;
     #rem00058#30 = #rem00058#27 - #rem00058#28 - #rem00058#29;
     |GRABA 020#rem00058.n;
     |LIBERA #rem00058;

     |CIERRA #rem00058;

     eaPrograma   = "rem00058";
     eaPunto      = #rem00058#13;
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO Ventas;
     #eosclien@#0 = #recapreo#0;
     |LEE 010#eosclien@.=;
     #eosactiv@#0 = #recapreo#0;
     #eosactiv@#1 = #recapreo#1;
     #eosactiv@#2 = nAnyoRenta;
     |LEE 010#eosactiv@.=;
     |SI FSalida = 0;
         |SI enLineaArre = 0;
             #rem00025#0 = #recapreo#2;
             #rem00025#1 = Linea;
             |LEE 010#rem00025.=;
         |FINSI;

      |FINSI;

      |BUCLE LinVentas;
|FPRC;

|PROCESO Graba26;
     |SI aCas = "";     |ACABA;  |FINSI;
     |SI nImporte = 0;  |ACABA;  |FINSI;

     |SELECT #2#rem00026;

     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#4 = aCas;
     |LEE 101#rem00026.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #rem00026#5 = #rem00026#5 + nImporte;

     |GRABA 020#rem00026.a;
     |LIBERA #rem00026;
|FPRC;

|PROCESO ModDirecta;
     |SI #recapreo#7 ! "C";  |Y #recapreo#7 ! "B";
         |ACABA;
     |FINSI;

     #reeoscfg#0 = #reeoscnc#3;
     #reeoscfg#1 = #reeoscnc#6;
     |LEE 000#reeoscfg.=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |SI #reeoscfg#3 = "    ";
         |ACABA;
     |FINSI;

     aCas =  #reeoscfg#3;  |QBF aCas;
     |HAZ Graba26;
|FPRC;

|PROCESO LinCompras;
     nImporte1 = #eoslinco@#7;     nRetenc1 = #eoslinco@#42;
     nImporte2 = #eoslinco@#23;    nRetenc2 = #eoslinco@#43;
     nImporte3 = #eoslinco@#24;    nRetenc3 = #eoslinco@#44;

     LongConcep = 2;
     Concepto = #eoslinco@#5;  nImporte = nImporte1; nRetenc = nRetenc1; |HAZ Suma;
     Concepto = #eoslinco@#33; nImporte = nImporte2; nRetenc = nRetenc2; |HAZ Suma;
     Concepto = #eoslinco@#34; nImporte = nImporte3; nRetenc = nRetenc3; |HAZ Suma;

     LongConcep = 6;
     Concepto = #eoslinco@#72; nImporte = nImporte1; nRetenc = nRetenc1; |HAZ Suma;
     Concepto = #eoslinco@#73; nImporte = nImporte2; nRetenc = nRetenc2; |HAZ Suma;
     Concepto = #eoslinco@#74; nImporte = nImporte3; nRetenc = nRetenc3; |HAZ Suma;
|FPRC;

|DEFBUCLE LinCompras;
     #eoslinco@#1003;
     19;
     #recapreo#0, nAnyoRenta, 00001, #recapreo#1;
     #recapreo#0, nAnyoRenta, 32000, #recapreo#1;
     ;
     NULL, LinCompras;
|FIN;

|PROCESO rem00905;
     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#2 = #rem00905#0;
     |LEE 000#rem00026.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #rem00026;
     #rem00026#0 = #rem00025#0;
     #rem00026#1 = #rem00025#1;
     #rem00026#2 = #rem00905#0;
     #rem00026#3 = #rem00905#1;
     #rem00026#4 = #rem00905#2;
     #rem00026#6 = #rem00905#6;

     |GRABA 020#rem00026.n;
     |LIBERA #rem00026;
|FPRC;

|DEFBUCLE rem00905;
     #rem00905#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, rem00905;
|FIN;

|PROCESO AbreDirecta;
     |SI #recapreo#7 ! "C";  |Y #recapreo#7 ! "B";
         |ACABA;
     |FINSI;

     Linea = 1;
     #rem00025#0 = #recapreo#2;
     #rem00025#1 = 1;
     |LEE 010#rem00025.];
     |PARA; |SI FSalida = 0; |Y #rem00025#0 = #recapreo#2; |HACIENDO;
          Linea = #rem00025#1 + 1;
          |LEE 010#rem00025.s;
     |SIGUE;

     |DDEFECTO #rem00025;
     #rem00025#0 = #recapreo#2;
     #rem00025#1 = Linea;
     |SI #recapreo#3 = "T";
         #rem00025#2 = "TITULAR";
     |SINO;
         #rem00025#2 = "CONYUGE";
     |FINSI;

     |SI #recapreo#7 = "C";  #rem00025#11 = "N";  |FINSI;
     |SI #recapreo#7 = "B";  #rem00025#11 = "S";  |FINSI;

     #rem00025#18 = #recapreo#4;
     |SI #recapreo#4 = " ";
         |SI #rem00025#19 = "P"; #rem00025#18 = "5";  |FINSI;
         |SI #rem00025#19 = "A"; #rem00025#18 = "4";  |FINSI;
         |SI #rem00025#19 = "E"; #rem00025#18 = "1";  |FINSI;
     |FINSI;

     |SI #eosactiv@#46 = "S";
         #eoscomul@#3 = #recapreo#5
         #eoscomul@#5 = #recapreo#6;
         #eoscomul@#7 = nAnyoRenta;
         |LEE 010#eoscomul@.=;
         |SI FSalida = 0;
             #rem00025#14 = #eoscomul@#6;
         |FINSI;

         #rem00025#13 = "S";
         #rem00025#15 = #eosclien@#1;
         #rem00025#16 = #eosclien@#2;
     |FINSI;

     #rem00025#19 = #eosactiv@#4;
     #rem00025#20 = #eosactiv@#5;
     #rem00025#21 = #eosactiv@#6;
     #rem00025#22 = #eosactiv@#11;
     #rem00025#23 = #eosactiv@#12;
     #rem00025#24 = #eosactiv@#9;
     #rem00025#35 = #eosactiv@#1;

     |GRABA 020#rem00025.n;
     |LIBERA #rem00025;

     |BUCLE rem00905;

     aCas     = "0182";
     nImporte = ExistFin - ExistIni;
     |HAZ Graba26;

     nOkDirec = 1;
|FPRC;

|PROCESO Compras;
     #eosclien@#0 = #recapreo#0;
     |LEE 010#eosclien@.=;
     #eosactiv@#0 = #recapreo#0;
     #eosactiv@#1 = #recapreo#1;
     #eosactiv@#2 = nAnyoRenta;
     |LEE 010#eosactiv@.=;
     |SI FSalida = 0;
         |SI #eosactiv@#46 = "N";
             #eosexist@#0 = #recapreo#0;
             #eosexist@#1 = #recapreo#1;
         |SINO;
             #eosexist@#0 = #recapreo#2;
             #eosexist@#1 = #recapreo#3;
         |FINSI;

         #eosexist@#2 = nAnyoRenta;
         |LEE 010#eosexist@.=;
         ExistIni = #eosexist@#3;
         ExistFin = #eosexist@#10;

         |SI enLineaArre = 0;
             |HAZ AbreDirecta;
         |FINSI;
     |FINSI;

     |BUCLE LinCompras;
|FPRC;

|PROCESO DesglosaBien;
      Comodin1 = Comodin + "eoscomul.mas";
      |CARGA_DEF Comodin1,eoscomul@;

      |PATH_DAT #eoscomul@#Path#;

      |ABRE #eoscomul@;
      |SELECT #2#eoscomul@;
      #eoscomul@#3 = #recapreo#0;
      #eoscomul@#5 = #recapreo#1;
      #eoscomul@#7 = nAnyoRenta;
      |LEE 010#eoscomul@.=;
      |SI FSalida = 0;
          #recapreo#0 = #eoscomul@#0;
          #recapreo#1 = #eoscomul@#1;
          #recapreo#5 = #eoscomul@#3;
          #recapreo#6 = #eoscomul@#5;
      |FINSI;
      |CIERRA #eoscomul@;
      |DESCARGA_DEF #eoscomul@;
|FPRC;

|PROCESO ControlaTipo;
     #eosactiv@#0 = #recapreo#0;
     #eosactiv@#1 = #recapreo#1;
     #eosactiv@#2 = nAnyoRenta;
     |LEE 000#eosactiv@.=;
     |SI FSalida ! 0;  |DDEFECTO #eosactiv@;  |FINSI;

     #recapreo#7 = #eosactiv@#22;
     |SI #eosactiv@#22 = "N";
         |MENAV "0000La actividad tiene marcada una N en el tipo de actividad";
         |MENAV "0000Introduzca a continuacion el tipo,  una <B> para simplificada o una <C> para directa";

         |VENTANA 0501, 2399, -1, 0, "";
         nVentana = FSalida;

         |PTEC 802;  |PAUSA;

         |CONTROL_SIMPLE 0, "LABEL,{{16}}TIPO DE ACTIVIDAD", 1331, 1350, NULL;

         aAlfa = "B";
         E_inf = "BC";
         E_sup = "1";
         aAlfa = 1540 ? 1;

         |FINVENTANA nVentana;

         #recapreo#7 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO CierraDirecta;
     #rem00025#0 = #recapreo#2;
     #rem00025#1 = Linea;
     |LEE 101#rem00025.=;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     enLin    = #rem00025#1;
     eaModal  = #rem00025#11;
     ea32_1   = #rem00025#31;
     ea32_2_1 = #rem00025#32;
     |SUB_EJECUTA "rem00026;RECALCULA";

     #rem00025#25 = en0180;
     #rem00025#26 = en0218;
     #rem00025#27 = en0220 + en0223;
     #rem00025#28 = en0224;
     #rem00025#29 = en0225;
     #rem00025#30 = en0226;

     |GRABA 020#rem00025.a;
     |LIBERA #rem00025;
     |CIERRA #rem00025;

     eaPrograma   = "rem00025";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;

     |SI #rem00025#13 = "S";
         |ABRE #rem00058;
         |SELECT #2#rem00058;
         #rem00058#0  = #rem00025#0;
         #rem00058#14 = "E1";
         #rem00058#15 = #rem00025#1;
         |LEE 040#rem00058.=;
         |SI FSalida ! 0;
             |SELECT #1#rem00058;
             #rem00058#0 = #rem00025#0;
             #rem00058#1 = 99;
             |LEE 040#rem00058.];
             |SI FSalida = 0;
                 |LEE 040#rem00058.a;
             |SINO;
                 |LEE 040#rem00058.u;
             |FINSI;
             nLinea = 1;

             |SI FSalida = 0;  |Y #rem00058#0 = #rem00025#0;
                 nLinea = #rem00058#1 + 1;
             |FINSI;
         |SINO;
             nLinea = #rem00058#1;
         |FINSI;

         |DDEFECTO #rem00058;
         |SELECT #1#rem00058;
         #rem00058#0  = #rem00025#0;
         #rem00058#1  = nLinea;
         |LEE 101#rem00058.=;
         |SI FSalida ! 0;
             |DDEFECTO #rem00058;
             #rem00058#0  = #rem00025#0;
             #rem00058#1  = nLinea;
             |GRABA 020#rem00058.b;
         |FINSI;

         #rem00058#2  = #rem00025#2;
         #rem00058#3  = "R";
         #rem00058#4  = #rem00025#4;
         #rem00058#5  = #rem00025#5;
         #rem00058#6  = #rem00025#6;
         #rem00058#7  = #rem00025#7;
         #rem00058#8  = #rem00025#8;
         #rem00058#9  = #rem00025#9;
         #rem00058#10 = #rem00025#10;
         #rem00058#11 = #rem00025#14;
         #rem00058#12 = #rem00025#15;
         #rem00058#14 = "E1";
         #rem00058#15 = #rem00025#1;

         |SI #rem00025#20 ! "8612";
             #rem00058#13 = 3;
             #rem00058#27 = #rem00025#28 % #rem00058#11;
             #rem00058#29 = #rem00025#29 % #rem00058#11;
             #rem00058#30 = #rem00058#27 - #rem00058#28 - #rem00058#29;
         |SINO;
             #rem00058#13 = 2;
             #rem00058#23 = #rem00025#28 % #rem00058#11;
             #rem00058#56 = #rem00025#29 % #rem00058#11;
             #rem00058#26 = #rem00058#23 - #rem00058#24 - #rem00058#25 - #rem00058#56;
         |FINSI;

         |GRABA 020#rem00058.a;
         |LIBERA #rem00058;
         |CIERRA #rem00058;

         eaPrograma   = "rem00058";
         eaPunto      = #rem00058#13;
         |HAZ ProgramaActivo;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #retabla4;
     |LEE 000#retabla4.p;
     nPatrones = FSalida;
     |CIERRA #retabla4;

     |SI nPatrones ! 0;
         |SUB_EJECUTA_NP "rez00001;INSTALAR";
     |FINSI;

     nAnyoRenta = 19;     || 2019

     || Revisar Paths de Agicli

     |DBASS Comodin; |QBF Comodin;
     Comodin1 = Comodin + "agicli/def/agicontr.mas";
     |CARGA_DEF Comodin1,agicontr@;
     |PATH_DAT #agicontr@#Comodin#;

     |ABRE #agicontr@;
     |LEE 010#agicontr@.p;
     |SI FSalida = 0;
        Path = #agicontr@#3;
        |QBF Path;
        |SI Path = "*"; |O Path = "";
           |DBASS Comodin; |QBF Comodin;
           Path = Comodin + "agieos/fich/";
        |FINSI;
     |SINO;
        |DBASS Comodin; |QBF Comodin;
        Path = Comodin + "agieos/fich/";
     |FINSI;
     |CIERRA #agicontr@;

     |PATH_DAT #zmonedas#Path#;
     |ABRE #zmonedas;
     |LEE 040#zmonedas.p;
     |SI FSalida ! 0;  |O #zmonedas#1 ! "E";
         |CIERRA #zmonedas;
         |MENAV "    Para poder hacer el pase la REO debe estar en EUROS.";
         |ACABA;
     |FINSI;
     |CIERRA #zmonedas;

     Comodin = Comodin + "agieos/def/";

     |SI enEmpresa ! 0;
         #recapreo#0 = enEmprEos;
         #recapreo#1 = enActiEos;
         #recapreo#2 = enEmprRen;
         #recapreo#4 = eaCaracter;
         #recapreo#3 = eaTitCony;
         |HAZ DesglosaBien;
         FSalida = 0;
     |SINO;
         |CLS;
         |CABEZA "Captura datos de libros de REO a renta"
         |PINPA #0#recapreo;
         |PINDA #0#recapreo;
         Comodin1 = Comodin + "eosactiv.mas";
         |CARGA_DEF Comodin1,eosactiv@;
         |PATH_DAT #eosactiv@#Path#;
         |ABRE #eosactiv@;
         |ENDATOS #1#recapreo;
         FEstado = FSalida;
         |CIERRA #eosactiv@;
         |DESCARGA_DEF #eosactiv@;
         FSalida = FEstado;
     |FINSI;

     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     Comodin1 = Comodin + "eoslinco.mas";  |CARGA_DEF Comodin1,eoslinco@;
     Comodin1 = Comodin + "eoslinve.mas";  |CARGA_DEF Comodin1,eoslinve@;
     Comodin1 = Comodin + "eosactiv.mas";  |CARGA_DEF Comodin1,eosactiv@;
     Comodin1 = Comodin + "eosclien.mas";  |CARGA_DEF Comodin1,eosclien@;
     Comodin1 = Comodin + "eosm0017.mas";  |CARGA_DEF Comodin1,eosm0017@;
     Comodin1 = Comodin + "eosm0018.mas";  |CARGA_DEF Comodin1,eosm0018@;
     Comodin1 = Comodin + "eoscomul.mas";  |CARGA_DEF Comodin1,eoscomul@;
     Comodin1 = Comodin + "eosm0011.mas";  |CARGA_DEF Comodin1,eosm0011@;
     Comodin1 = Comodin + "eosm0012.mas";  |CARGA_DEF Comodin1,eosm0012@;
     Comodin1 = Comodin + "eosm0020.mas";  |CARGA_DEF Comodin1,eosm0020@;
     Comodin1 = Comodin + "eosm3130.mas";  |CARGA_DEF Comodin1,eosm3130@;
     Comodin1 = Comodin + "eosconcd.mas";  |CARGA_DEF Comodin1,eosconcd@;
     Comodin1 = Comodin + "eosexist.mas";  |CARGA_DEF Comodin1,eosexist@;

     |PATH_DAT #eoslinco@#Path#;
     |PATH_DAT #eoslinve@#Path#;
     |PATH_DAT #eosactiv@#Path#;
     |PATH_DAT #eosclien@#Path#;
     |PATH_DAT #eosm0017@#Path#;
     |PATH_DAT #eosm0018@#Path#;
     |PATH_DAT #eoscomul@#Path#;
     |PATH_DAT #eosm0011@#Path#;
     |PATH_DAT #eosm0012@#Path#;
     |PATH_DAT #eosm3130@#Path#;
     |PATH_DAT #eosm0020@#Path#;
     |PATH_DAT #eosconcd@#Path#;
     |PATH_DAT #eosexist@#Path#;

     |ABRE #reeoscnc;
     |ABRE #reeoscfg;
     |ABRE #eosactiv@;
     |ABRE #eosclien@;
     |ABRE #rem00025;
     |ABRE #rem00026;
     |ABRE #eosm0017@;
     |ABRE #eosm0018@;
     |ABRE #eoscomul@;
     |ABRE #eosm0011@;
     |ABRE #eosm0012@;
     |ABRE #rem00021;
     |ABRE #rem00028;
     |ABRE #rem00029;
     |ABRET #rem00031;
     |ABRE #eosm3130@;
     |ABRE #eosm0020@;
     |ABRE #eosconcd@;
     |ABRE #eosexist@;

     |HAZ ControlaTipo;

     |SI enLineaArre ! 0;
         #rem00021#0 = #recapreo#2;
         #rem00021#1 = enLineaArre;
         |LEE 101#rem00021.=;
         |SI FSalida = 0;
             |BORRA 020#rem00021.a;
             |LIBERA #rem00021;
         |FINSI;
     |FINSI;

     |SELECT #2#eoscomul@;

     Comodin = ("00000" + #recapreo#0) % -105;
     |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -103; aAlfa = aAlfa % 0102;
     Nombre = "c" + Comodin + aAlfa;
     |NOME_DAT #eoslinco@#Nombre#;

     nOkDirec  = 0;
     TotRetenc = 0;
     |ABRE #eoslinco@;
     |HAZ Compras;
     |CIERRA #eoslinco@;

     Comodin = ("00000" + #recapreo#0) % -105;
     |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -103; aAlfa = aAlfa % 0102;
     Nombre = "v" + Comodin + aAlfa;
     |NOME_DAT #eoslinve@#Nombre#;
     |HAZ Ventas;

     |SI nOkDirec = 1;
         |HAZ CierraDirecta;
     |FINSI;

     |HAZ PagosACuenta;

     |CIERRA #eosexist@;
     |SELECT #1#eoscomul@;
     |CIERRA #eosconcd@;
     |CIERRA #eosm3130@;
     |CIERRA #eosm0020@;
     |CIERRAT #rem00031;
     |CIERRA #rem00029;
     |CIERRA #rem00028;
     |CIERRA #rem00021;
     |CIERRA #eosm0012@;
     |CIERRA #eosm0011@;
     |CIERRA #eoscomul@;
     |CIERRA #eosm0017@;
     |CIERRA #eosm0018@;
     |CIERRA #eosactiv@;
     |CIERRA #eosactiv@;
     |CIERRA #eosclien@;
     |CIERRA #rem00025;
     |CIERRA #rem00026;
     |CIERRA #reeoscnc;
     |CIERRA #reeoscfg;

     |DESCARGA_DEF #eosexist@;
     |DESCARGA_DEF #eosconcd@;
     |DESCARGA_DEF #eosm3130@;
     |DESCARGA_DEF #eosm0020@;
     |DESCARGA_DEF #eosm0012@;
     |DESCARGA_DEF #eosm0011@;
     |DESCARGA_DEF #eoscomul@;
     |DESCARGA_DEF #eosm0018@;
     |DESCARGA_DEF #eosm0017@;
     |DESCARGA_DEF #eosclien@;
     |DESCARGA_DEF #eosactiv@;
     |DESCARGA_DEF #eoslinve@;
     |DESCARGA_DEF #eoslinco@;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 2499;
|FPRC;
