|FICHEROS;
   retotren #0;
   redatcon #3;
   retotpat #6;
   retotrea #11;
   reincide #7;
   rerecalc #1;
   reprogra #10;
   retotrec #116;
|FIN;

|INCLUYE i_varcal;

|VARIABLES;
    EmpresaDe = 0;
    EmpresaFi = 0;
    aBase     = "";
    aPathDef  = "";
    aPathFich = "";
|FIN;

|PROCESO liqborra;
   |BORRA 020#0a;
|FPRC;

|PROCESO recborra;
  |BORRA 020#116a;
  |LIBERA #116;
|FPRC;

|PROCESO patborra;
  |BORRA 020#6a;
  |LIBERA #6;
|FPRC;

|PROCESO adjborra;
  |BORRA 020#11a;
  |LIBERA #11;
|FPRC;

|PROCESO borrainci;
  |BORRA 020#7a;
  |LIBERA #7;
|FPRC;

|DEFBUCLE borraliq;
  #0#1;
  ;
  EmpresaDe, " ";
  EmpresaFi, "z";
  be;
  NULL, liqborra;
|FIN;

|DEFBUCLE borrarec;
#116#1;
;
EmpresaDe, " ";
EmpresaFi, "z";
be;
NULL, recborra;
|FIN;

|DEFBUCLE borrapat;
#6#1;
;
EmpresaDe, " ";
EmpresaFi, "z";
be;
NULL, patborra;
|FIN;

|DEFBUCLE borraadj;
#11#1;
;
EmpresaDe, " ";
EmpresaFi, "z";
be;
NULL, adjborra;
|FIN;

|DEFBUCLE borrainc;
#7#1;
3;
EmpresaDe, 0001, "S";
EmpresaFi, 9999, "S";
be;
NULL, borrainci;
|FIN;

|PROCESO acalcula;  |TIPO 3;
  |SI #1#2 = "NO"; |ACABA; |FINSI;

  |DBASS aBase;   |QBT aBase;
  aPathDef  = aBase + "agiren98/def/reparame";
  aPathFich = aBase + "agiren98/fich/reparame";

  |LEEDEDEF aPathDef, aPathFich, 0, 1, 10, incisino;

  |ATRI P;
  |CUADRO 1436 1660;
  |PINTA 1537, " ESTOY CALCULANDO .... ";
  |ATRI 0;

  EmpresaDe = #1#0;
  EmpresaFi = #1#1;

  swcalcu = 0;
  lininci = 0;
  recalcu = 1;

  |BUCLE borraliq;  || Borra la liquidacion si ya la hubiera
  |BUCLE borrarec;  || Borra Inc. y Dis. retotrec
  |BUCLE borrapat;  || Borra patrimonio
  |BUCLE borraadj;  || Borra liquidacion adjunta
  |BUCLE borrainc;  || Borra incidencias

||ATENCION !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  estoyempresa = #1#0 - 1;
|ET dandovueltas;
  |SI estoyempresa > #1#1;  |ACABA;  |FINSI;
  |ABRE #3;
  #3#0 = estoyempresa;
  |LEE 040#3>;
  |SI FSalida ! 0;
      |CIERRA #3;
      |ACABA;
  |SINO;
      #3#0 = estoyempresa;
      |LEE 040#3=;
      |SI FSalida ! 0;
          |CIERRA #3;
          estoyempresa = estoyempresa + 1;
          |VETE dandovueltas;
      |FINSI;
  |FINSI;
  |CIERRA #3;

  estoyempresa = #3#0;

  minusva1 = #3#5;
  minusva2 = #3#31;
  minusva3 = #3#88;
  minusva4 = #3#89;
  minusva5 = #3#90;
  minusva6 = #3#91;

  individu  = 0;
  |SI #3#34 = "X"; individu = 1; |FINSI;

  |ABRE #10;
  #10#0 = estoyempresa;
  |LEE 040#10=;
  |SI FSalida ! 0; |DDEFECTO #10; |FINSI;
  |CIERRA #10;

  |HAZ programas;
  empresa = estoyempresa;
  emprefi = estoyempresa;

|SI #10#01=1;|O #10#02=1;|O #10#03=1;|O #10#04=1;|O #10#05=1; |HAZ recalcu1; |FINSI;
|SI #10#06=1;|O #10#07=1;|O #10#08=1;|O #10#09=1;
 |O #10#10=1;|O #10#51=1;                                     |HAZ recalcu2; |FINSI;
|SI #10#11=1;|O #10#12=1;|O #10#13=1;|O #10#14=1;|O #10#15=1;
 |O #10#52=1;|O #10#60=1;                                     |HAZ recalcu3; |FINSI;
|SI #10#16=1;|O #10#17=1;|O #10#18=1;|O #10#19=1;|O #10#20=1; |HAZ recalcu4; |FINSI;
|SI #10#21=1;|O #10#22=1;|O #10#23=1;|O #10#24=1;|O #10#25=1; |HAZ recalcu5; |FINSI;
|SI #10#26=1;|O #10#27=1;|O #10#28=1;|O #10#29=1;             |HAZ recalcu6; |FINSI;
                                                              |HAZ recalcu8;
progra_52 = #10#52;
progra_60 = #10#60;
|SI #10#30=1;                                                 |HAZ recalcu7; |FINSI;

  estoyempresa = estoyempresa + 1;
  |VETE dandovueltas;
|FPRC;

|PROCESO programas;
progra_1  = #10#1;
progra_2  = #10#2;
progra_3  = #10#3;
progra_4  = #10#4;
progra_5  = #10#5;
progra_6  = #10#6;
progra_7  = #10#7;
progra_8  = #10#8;
progra_9  = #10#9;
progra_10 = #10#10;
progra_11 = #10#11;
progra_12 = #10#12;
progra_13 = #10#13;
progra_14 = #10#14;
progra_15 = #10#15;
progra_16 = #10#16;
progra_17 = #10#17;
progra_18 = #10#18;
progra_19 = #10#19;
progra_20 = #10#20;
progra_21 = #10#21;
progra_22 = #10#22;
progra_23 = #10#23;
progra_24 = #10#24;
progra_25 = #10#25;
progra_26 = #10#26;
progra_27 = #10#27;
progra_28 = #10#28;
progra_29 = #10#29;
progra_30 = #10#30;
progra_51 = #10#51;
progra_52 = #10#52;
progra_60 = #10#60;
|FPRC;
