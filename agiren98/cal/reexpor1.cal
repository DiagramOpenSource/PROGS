|FICHEROS;
    reexpor1 #00;

    zeprogra #20;

    reacceso #02;   zeacceso #03;
    redatcon #04;   zedatcon #05;
    rerendtr #06;   zerendtr #07;
    recapinm #08;   zecapinm #09;
    revalore #10;   zevalore #11;
    revalono #12;   zevalono #13;
    rectacor #14;   zectacor #15;
|FIN;

|VARIABLES;
    campos_1 = 29;  || nro. de campos de cada uno
    campos_2 = 75;
    campos_3 = 45;
    campos_4 = 48;
    campos_5 = 31;
    puntero = 0;    || puntero para 'reprogra'
|FIN;

|INCLUYE i_expor1;
|INCLUYE i_expor2;

|PROCESO path;
|DBASS alfa1;
    path = alfa1 + "agiren98/fich/";
|DFICE aqui;
|QBF aqui;
|FPRC;

|PROGRAMA;
|SI devuelta = 1;
        codi = codi + 1;
    |HAZ exporta;
|SINO;
        devuelta = 1;
    |CLS;
    |CABEZA "Exportacion";
    |PINPA #0#0;
    |PINDA #0#0;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |HAZ path;
        |SI #0#1 = "SI";|Y aqui ! path;
                codi = #0#0;
                has_cod = #0#2;
            |HAZ exporta;
        |FINSI;
        |SI path = aqui;
            |MENAV "    ATENCION!!! Esta situado en el directorio principal ...";
        |FINSI;
    |FINSI;
|FINSI;
|FPRO;

|PROCESO exporta;
|SI codi [ has_cod;
        alfa1 = codi;  alfa1 = "00000" + codi;  alfa1 = alfa1 % -105;
    |ATRI P;   |PINTA 1646, alfa1;   |ATRI 0;
        acceso = 0;
    |HAZ comprueba;
    |SI acceso = 1;
            acceso = 0;
        |HAZ imp_a;     || acceso introduccion
        |SI acceso = 1;
            |HAZ imp_b;     || datos contribuyentes
            |HAZ imp_c;     || programas en activo
            |HAZ lee_repro;
            |HAZ imp_1;     || 'rerendtr'
            |HAZ imp_2;     || 'recapinm'
            |HAZ imp_3;     || 'revalore'
            |HAZ imp_4;     || 'revalono'
            |HAZ imp_5;     || 'rectacor'
            |CORRE "reexpor2.run";
        |SINO;
            |CORRE "reexpor1.run";
        |FINSI;
    |SINO;
        |CORRE "reexpor1.run";
    |FINSI;
|FINSI;
|FPRC;

|PROCESO imp_a;
    |PATH_DAT #2 path;
        error = -1;
    |PARA; |SI error ! 0; |HACIENDO;
        |ABRE #2;
            error = FSalida;
    |SIGUE;
        #2#0 = codi;
    |LEE 001#2=;
    |SI FSalida = 0;     |BORRA 020#2a;      |FINSI;
    |ABRE #3;
        #3#0 = codi;
    |LEE 001#3=;
    |SI FSalida = 0;
            acceso = 1;
        |PARA nume1 = 0; |SI nume1 [ 2; |HACIENDO nume1 = nume1 + 1;
                #2nume1 = #3nume1;
        |SIGUE;
        |GRABA 020#2n;
        |BORRA 020#3a;
    |FINSI;
    |CIERRA #3;
    |CIERRA #2;
|FPRC;

|PROCESO imp_b;
    |PATH_DAT #4 path;
        error = -1;
    |PARA; |SI error ! 0; |HACIENDO;
        |ABRE #4;
            error = FSalida;
    |SIGUE;
        #4#0 = codi;
    |LEE 001#4=;
    |SI FSalida = 0;     |BORRA 020#4a;  |FINSI;
    |ABRE #5;
        #5#0 = codi;
    |LEE 001#5=;
    |SI FSalida = 0;|Y #5#142 = "S";    || si esta preparada
            acceso = 1;
        |PARA nume1 = 0; |SI nume1 [ 201; |HACIENDO nume1 = nume1 + 1;
            #4nume1 = #5nume1;
        |SIGUE;
        |GRABA 020#4n;
        |BORRA 020#5a;
    |FINSI;
    |CIERRA #5;
    |CIERRA #4;
|FPRC;

|PROCESO imp_c;
    |PATH_DAT #20 aqui;
    |ABRE #20;
        #20#0 = codi;
    |LEE 001#20=;
        nume1 = FSalida;
    |SI nume1 = 0;
        |BORRA 020#20a;
    |FINSI;
    |CIERRA #20;

    |SI nume1 = 0;
        |PATH_DAT #1 path;
            error = -1;
        |PARA; |SI error ! 0; |HACIENDO;
            |ABRE #1;
                error = FSalida;
        |SIGUE;
            #1#0 = codi;
        |LEE 001#1=;
        |SI FSalida = 0;     |BORRA 020#1a; |FINSI;
        |PARA nume1 = 0; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;
                #1nume1 = #20nume1;
        |SIGUE;
        |GRABA 020#1n;
        |CIERRA #1;               || este solo traga con esta estructura ¨...?
    |FINSI;
|FPRC;

|PROCESO comprueba;
    |ABRE #5;
        #5#0 = codi;
    |LEE 001#5=;
    |SI FSalida = 0;|Y #5#142 = "S";    || si esta preparada
            acceso = 1;
    |FINSI;
    |CIERRA #5;
|FPRC;
