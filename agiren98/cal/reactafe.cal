|FICHEROS;
     reactafe #0;
     rem00010 #1;
     rem00011 #2;
     rem00012 #3;
     rem00013 #4;
     reempmod #5;
     rem00014 #6;
     redifrei #7;
     reeleact #8;
     reeleact #30;
     reelea97 #31;
|FIN;

|VARIABLES;
     nPorce       = 0;
     nPorce1      = 0;
     nPorce2      = 0;
     nPorceL1     = 0;
     nPorceL2     = 0;
     nResto       = 0;
     nDife        = 0;
     nDifer       = 0;
     nCanti       = 0;
     nSwAsala2    = 0;
     aAlfa        = "";

     TipoClave    = "";
     FechaVenta   = @;
     FechaCompra  = @;
     SwFich       = 0;
     Linea        = 0;
     FEstado      = 0;
     sw           = 0;
     suma         = 0;
     valor        = 0;
     pantalla     = 0;
     nIncremento  = 0;
     Disminucion  = 0;
     pepe         = 0;
     arte         = "";
     SwTaxi       = 0;
     rendi        = 0;
     Porce        = 0;
     Dto1         = 0;
     Dto2         = 0;
     Dto3         = 0;
     EjerN1       = 0;
     EjerN2       = 0;
     EjerT        = 0;
     EjerA1       = "";
     EjerA2       = "";
     VAlfa        = "";

     nCampoRdto   = 0;
     nCanti1      = 0;
     nCanti2      = 0;
     nRdto97      = 0;

     &empresa     = 0;
     &nombre      = "";
     &modo        = 0;
     &modelito    = 0;
     &tipomod     = "";
     &errorlin    = 0;
     &indivi      = "";
     &numerica1   = 0;  &numerica2  = 0;   &numerica3  = 0;
     &numerica4   = 0;  &numerica5  = 0;   &numerica6  = 0;
     &numerica7   = 0;  &numerica8  = 8;   &numerica9  = 0;
     &numerica10  = 0;  &numerica11 = 8;   &numerica12 = 0;
     &numerica13  = 0;  &numerica14 = 8;   &numerica15 = 0;
     &numerica16  = 0;  &numerica17  = 0;  &numerica18  = 0;
     &numerica19  = 0;  &numerica20  = 0;  &numerica21  = 0;
     &numerica22  = 0;

     &alfanumer1  = ""; &alfanumer2 = "";  &alfanumer3 = "";
     &alfanumer4  = ""; &alfanumer5 = "";  &alfanumer6 = "";
     &alfanumer7  = ""; &alfanumer8 = "";  &alfanumer9 = "";
     &alfanumer10 = ""; &alfanumer11 = ""; &alfanumer12 = "";
     &alfanumer13 = ""; &alfanumer14 = ""; &alfanumer15 = "";
     &alfanumer16 = ""; &alfanumer17 = "";

     &fechas1     = @; &fechas2     = @;   &fechas3    = @;
     &fechas4     = @; &fechas5     = @;   &fechas6    = @;
|FIN;

|INCLUYE i_husuar;
|INCLUYE i_activo;
|INCLUYE i_patrim;

|RUTINA inferior;
  #0#0 = empresa;
  #0#1 = 1;
|FRUT;

|RUTINA superior;
  #0#0 = empresa;
  #0#1 = 99;
|FRUT;

|PROGRAMA;
  |PINPA #0#0;
  |SI modo = 1;  |ENTLINEAL #1#0,2,1,15,0,inferior,superior;  |FINSI;
  |SI modo = 2;  |ENTLINEAL #1#0,2,2,15,0,inferior,superior;  |FINSI;
  |SI modo = 4;  |ENTLINEAL #1#0,2,4,15,0,inferior,superior;  |FINSI;
  |HAZ actual;
|FPRO;

|PROCESO ayuda; |TIPO 2;
  pantalla = 0 +. 1;
  |HAZ baja_pat;
  |HAZ BajaDife;

  QueTipo    = (FEntrada / 100) ! 0;

  |SI pantalla = 1;
      |SI #0#2 = "PD"; |HAZ ProfModNormal; |FINSI;
      |SI #0#2 = "PC"; |HAZ ProfModSimpli; |FINSI;
      |SI #0#2 = "ED"; |HAZ EmprModNormal; |FINSI;
      |SI #0#2 = "EC"; |HAZ EmprModSimpli; |FINSI;
      |SI #0#2 = "EM"; |HAZ emprmodu;      |FINSI;
      |SI #0#2 = "AG"; |HAZ agricola;      |FINSI;
      |SI FEstado = 0;
          |HAZ cargadat;
      |SINO;
          |ERROR;  |ACABA;
      |FINSI;
  |FINSI;

  HContribu  = #0#0;
  HNombre    = nombre;
  HPrograma  = "(reactafe) ACTIVOS AFECTOS";
  HLinea     = #0#1;
  HPerceptor = #0#5;
  HRdto      = #0#26;

  |SI QueTipo = 1; HTipo = "ALTA FICHA";         |FINSI;
  |SI QueTipo = 2; HTipo = "MODIFICACION FICHA"; |FINSI;
  |SI QueTipo = 3; HTipo = "BAJA FICHA";         |FINSI;

  |SI QueTipo = 3; |Y pantalla ! 1;  |HAZ AltaHistorico;  |FINSI;
  |SI QueTipo < 3; |Y pantalla = 1;  |HAZ AltaHistorico;  |FINSI;

  |HAZ alta_pat;
  |HAZ AltaDife;
|FPRC;

|PROCESO consulta; |TIPO 0;
  modelito = (FEntrada / 100) ! 0;
  |SI modelito = 4; |HAZ cargadat; |FINSI;
|FPRC;

|PROCESO cargadat;
  |HAZ carga;
  |SUB_EJECUTA "repant13";
  |SI errorlin = 0;
      |ERROR;
  |SINO;
      |SI modelito ! 4; |HAZ descarga; |PINTA #0#26; |FINSI;
  |FINSI;
|FPRC;

|PROCESO descarga;
  #0#7  = alfanumer1;
  #0#8  = alfanumer2;
  #0#9  = numerica1;
  #0#10 = numerica2;
  #0#11 = numerica3;
  #0#12 = fechas1;
  #0#13 = numerica4;
  #0#14 = numerica5;
  #0#15 = fechas2;
  #0#16 = fechas3;
  #0#17 = fechas4;
  #0#18 = numerica6;
  #0#19 = numerica7;
  #0#20 = numerica8;
  #0#21 = alfanumer3;
  #0#22 = alfanumer4;
  #0#23 = alfanumer5;
  #0#24 = numerica9;
  #0#25 = fechas5;
  #0#26 = numerica10;
  #0#27 = alfanumer6;
  #0#28 = alfanumer7;
  #0#29 = numerica11;
  #0#30 = fechas6;
  #0#31 = numerica12;
  #0#32 = numerica13;
  #0#33 = numerica14;
  #0#34 = numerica15;
  #0#35 = alfanumer8;
  #0#36 = alfanumer9;
  #0#44 = alfanumer10;
  #0#45 = numerica16;
  #0#46 = numerica17;
  #0#47 = numerica18;
  #0#48 = alfanumer11;
  #0#49 = alfanumer12;
  #0#50 = alfanumer13;
  #0#51 = alfanumer14;
  #0#52 = alfanumer15;
  #0#55 = numerica19;
  #0#58 = numerica20;
  #0#59 = alfanumer16;
  #0#60 = alfanumer17;
  #0#61 = numerica21;
  #0#62 = numerica22;
  npro  = 12; |HAZ sigrabo;
|FPRC;

|PROCESO carga;
  alfanumer1  = #0#7;
  alfanumer2  = #0#8;
  numerica1   = #0#9;
  numerica2   = #0#10;
  numerica3   = #0#11;
  fechas1     = #0#12;
  numerica4   = #0#13;
  numerica5   = #0#14;
  fechas2     = #0#15;
  fechas3     = #0#16;
  fechas4     = #0#17;
  numerica6   = #0#18;
  numerica7   = #0#19;
  numerica8   = #0#20;
  alfanumer3  = #0#21;
  alfanumer4  = #0#22;
  alfanumer5  = #0#23;
  numerica9   = #0#24;
  fechas5     = #0#25;
  numerica10  = #0#26;
  alfanumer6  = #0#27;
  alfanumer7  = #0#28;
  numerica11  = #0#29;
  fechas6     = #0#30;
  numerica12  = #0#31;
  numerica13  = #0#32;
  numerica14  = #0#33;
  numerica15  = #0#34;
  alfanumer8  = #0#35;
  alfanumer9  = #0#36;
  alfanumer10 = #0#44;
  numerica16  = #0#45;
  numerica17  = #0#46;
  numerica18  = #0#47;
  alfanumer11 = #0#48;
  alfanumer12 = #0#49;
  alfanumer13 = #0#50;
  alfanumer14 = #0#51;
  alfanumer15 = #0#52;
  numerica19  = #0#55;
  numerica20  = #0#58;
  alfanumer16 = #0#59;
  alfanumer17 = #0#60;
  numerica21  = #0#61;
  numerica22  = #0#62;
|FPRC;

|PROCESO ProfModNormal;
     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#3;
     |LIBERA #1;
     |LEE 110#1=;
     FEstado = FSalida;
     |SI FSalida = 0;
         #0#4  = #1#2;
         #0#5  = #1#3;
         #0#6  = #1#14;
         #0#37 = #1#4;
         #0#38 = #1#5;
         #0#39 = #1#6;
         #0#40 = #1#7;
         #0#41 = #1#8;
         #0#42 = #1#9;
         #0#43 = #1#10;
         #0#45 = #1#11;
         #0#50 = #1#12 + #1#13;

         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#6;
      |SINO;
         |MENAV "     No existe registro en Actividad";
         |ERROR; |ACABA;
      |FINSI;
      |LIBERA #1;
      |CIERRA #1;
|FPRC;

|PROCESO ProfModSimpli;
     |ABRE #2;
     #2#0 = #0#0;
     #2#1 = #0#3;
     |LEE 040#2=;
     FEstado = FSalida;
     |SI FSalida = 0;
         #0#4  = #2#2;
         #0#5  = #2#3;
         #0#6  = #2#14;
         #0#37 = #2#4;
         #0#38 = #2#5;
         #0#39 = #2#6;
         #0#40 = #2#7;
         #0#41 = #2#8;
         #0#42 = #2#9;
         #0#43 = #2#10;
         #0#45 = #2#11;
         #0#50 = #2#12 + #2#13;
         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#6;
     |SINO;
         |MENAV "     No existe registro Rendimiento Irregulares";
         |ERROR; |ACABA;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO EmprModNormal;
     |ABRE #3;
     #3#0 = #0#0;
     #3#1 = #0#3;
     |LEE 040#3=;
     FEstado = FSalida;
     |SI FSalida = 0;
         #0#4  = #3#2;
         #0#5  = #3#3;
         #0#6  = #3#14;
         #0#37 = #3#4;
         #0#38 = #3#5;
         #0#39 = #3#6;
         #0#40 = #3#7;
         #0#41 = #3#8;
         #0#42 = #3#9;
         #0#43 = #3#10;
         #0#45 = #3#11;
         #0#50 = #3#12 + #3#13;
         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#6;
     |SINO;
         |MENAV "     No existe registro Rendimiento Irregulares";
         |ERROR; |ACABA;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO EmprModSimpli;
     |ABRE #4;
     #4#0 = #0#0;
     #4#1 = #0#3;
     |LEE 040#4=;
     FEstado = FSalida;
     |SI FSalida = 0;
         #0#4  = #4#2;
         #0#5  = #4#3;
         #0#6  = #4#14;
         #0#37 = #4#4;
         #0#38 = #4#5;
         #0#39 = #4#6;
         #0#40 = #4#7;
         #0#41 = #4#8;
         #0#42 = #4#9;
         #0#43 = #4#10;
         #0#45 = #4#11;
         #0#50 = #4#12 + #4#13;
         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#6;
     |SINO;
        |MENAV "     No existe registro Rendimiento Irregulares";
        |ERROR; |ACABA;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO emprmodu;
  |ABRE #5;
  #5#0 = #0#0;
  #5#1 = #0#3;
  |LEE 040#5=;
  FEstado = FSalida;
  |SI FSalida = 0;
     #0#4  = #5#2;
     #0#5  = #5#3;
     #0#6  = #5#19;
     #0#37 = #5#4;
     #0#38 = #5#5;
     #0#39 = #5#6;
     #0#40 = #5#7;
     #0#41 = #5#8;
     #0#42 = #5#9;
     #0#43 = #5#10;
     #0#45 = #5#11;
     #0#50 = #5#16 + #5#17;
     |PINTA #0#4;
     |PINTA #0#5;
     |PINTA #0#6;
  |SINO;
     |MENAV "     No existe registro Rendimiento Irregulares";
     |ERROR; |ACABA;
  |FINSI;
  |CIERRA #5;
|FPRC;

|| **************************************************************************

|PROCESO agricola;
     |ABRE #6;
     #6#0 = #0#0;
     #6#1 = #0#3;
     |LEE 040#6=;
     FEstado = FSalida;
     |SI FSalida = 0;
         #0#4  = #6#2;
         #0#5  = #6#3;
         #0#6  = #6#14;
         #0#37 = #6#4;
         #0#38 = #6#5;
         #0#39 = #6#6;
         #0#40 = #6#7;
         #0#41 = #6#8;
         #0#42 = #6#9;
         #0#43 = #6#10;
         #0#45 = #6#11;
         #0#50 = #6#12 + #6#13;

         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#6;
     |SINO;
         |MENAV "     No existe registro Rendimiento Irregulares";
         |ERROR; |ACABA;
     |FINSI;
     |CIERRA #6;
|FPRC;

||                          PROCESO ACTUALIZACION
|| **************************************************************************

|PROCESO IncreDismi;
     |SI #0#26 > 0;
         |SI #0#59 = "D";
             |SI #0#60 = "P";
                 nIncremento = nIncremento + #0#62;
             |FINSI;
         |SINO;
             nIncremento = nIncremento + (#0#26 - #0#34);
         |FINSI;
     |SINO;
         Disminucion = Disminucion + (#0#26 * -1);
     |FINSI;

     arte = #0#48 % 103;
|FPRC;

|PROCESO Acumula;
     |SI sw = 0;
         nIncremento  = 0;
         Disminucion  = 0;
         Linea        = #0#3;
         sw           = 1;
         TipoClave    = #0#52;
         FechaCompra  = #0#12;
         FechaVenta   = #0#25;
     |FINSI;

     |SI Linea ! #0#3;
         |SI SwFich = 1; |HAZ GrabaFic1; |FINSI;
         |SI SwFich = 2; |HAZ GrabaFic2; |FINSI;
         |SI SwFich = 3; |HAZ GrabaFic3; |FINSI;
         |SI SwFich = 4; |HAZ GrabaFic4; |FINSI;
         |SI SwFich = 5; |HAZ GrabaFic5; |FINSI;
         |SI SwFich = 6; |HAZ GrabaFic6; |FINSI;

         TipoClave    = #0#52;
         FechaCompra  = #0#12;
         FechaVenta   = #0#25;
         Linea        = #0#3;
         nIncremento  = 0;
         Disminucion  = 0;
         |HAZ IncreDismi;
     |SINO;
         |HAZ IncreDismi;
     |FINSI;
|FPRC;

|PROCESO GrabaFic1;
     #1#0 = empresa;
     #1#1 = Linea;
     |LIBERA #1;
     |LEE 110#1=;
     |SI FSalida = 0;
         #1#31 = nIncremento;
         #1#32 = Disminucion;
         #1#29 = #1#20 + #1#21 + #1#22 + #1#23 + #1#24 + #1#25 + #1#26 + #1#27 + #1#28;
         #1#30 = #1#19 - #1#29;
         #1#33 = #1#31 - #1#32;
         #1#34 = #1#30 + #1#33;
         |GRABA 020#1a;

         HContribu  = #1#0;
         HNombre    = nombre;
         HPrograma  = "(rem00010) PROFESIONALES MODALIDAD NORMAL";
         HLinea     = #1#1;
         HPerceptor = #1#3;
         HTipo      = "MODIFICACION DESDE ACTIVOS AFECTOS";
         HRdto      = #1#34;
         |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|PROCESO GrabaFic2;
     #2#0 = empresa;
     #2#1 = Linea;
     |LIBERA #2;
     |LEE 110#2=;
     |SI FSalida = 0;
         #2#34 = nIncremento;
         #2#35 = Disminucion;

         #2#30 = #2#21 + #2#22 + #2#23 + #2#24 + #2#25 + #2#26 + #2#27 + #2#28 + #2#29 - #2#20;
         #2#31 = #2#19 - #2#30;
         #2#32 = #2#31 % 5;      |SI #2#32 < 0;  #2#32 = 0;  |FINSI;
         #2#33 = #2#31 - #2#32;
         #2#36 = #2#34 - #2#35;
         #2#37 = #2#33 + #2#36;

         |GRABA 020#2a;

         HContribu  = #2#0;
         HNombre    = nombre;
         HPrograma  = "(rem00011) PROFESIONALES MOD.SIMPLIFICADA";
         HLinea     = #2#1;
         HPerceptor = #2#3;
         HTipo      = "MODIFICACION DESDE ACTIVOS AFECTOS";
         HRdto      = #2#37;
         |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|PROCESO GrabaFic3;
     #3#0 = empresa;
     #3#1 = Linea;
     |LIBERA #3;
     |LEE 110#3=;
     |SI FSalida = 0;
         #3#42 = nIncremento;
         #3#43 = Disminucion;
         #3#23 = #3#19 + #3#20 + #3#21 + #3#22;
         #3#40 = #3#24 + #3#25 + #3#26 + #3#27 + #3#28 + #3#29 + #3#30 + #3#31;
         #3#40 = #3#40 + #3#32 + #3#33 + #3#34 + #3#35 + #3#36 + #3#37 + #3#38 + #3#39;
         #3#41 = #3#23 - #3#40;
         #3#44 = #3#42 - #3#43;
         #3#45 = #3#41 + #3#44;

         |GRABA 020#3a;

         HContribu  = #3#0;
         HNombre    = nombre;
         HPrograma  = "(rem00012) EMPRESARIALES MOD.NORMAL";
         HLinea     = #3#1;
         HPerceptor = #3#3;
         HTipo      = "MODIFICACION DESDE ACTIVOS AFECTOS";
         HRdto      = #3#45;
         |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|PROCESO GrabaFic4;
     #4#0 = empresa;
     #4#1 = Linea;
     |LIBERA #4;
     |LEE 110#4=;
     |SI FSalida = 0;
         #4#43 = nIncremento;
         #4#44 = Disminucion;

         #4#23 = #4#19 + #4#20 + #4#21 + #4#22;
         #4#39 = #4#25 + #4#26 + #4#27 + #4#28 + #4#29 + #4#30 + #4#31 + #4#32;
         #4#39 = #4#39 + #4#33 + #4#34 + #4#35 + #4#36 + #4#37 + #4#38 - #4#24;
         #4#40 = #4#23 - #4#39;
         #4#41 = #4#40 % 5;      |SI #4#41 < 0;  #4#41 = 0;  |FINSI;
         #4#42 = #4#40 - #4#41;
         #4#45 = #4#43 - #4#44;
         #4#46 = #4#42 + #4#45;

         |GRABA 020#4a;

         HContribu  = #4#0;
         HNombre    = nombre;
         HPrograma  = "(rem00013) EMPRESARIALES MOD.SIMPLIFICADA";
         HLinea     = #4#1;
         HPerceptor = #4#3;
         HTipo      = "MODIFICACION DESDE ACTIVOS AFECTOS";
         HRdto      = #4#46;
         |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|PROCESO Incentivo97;
     nPorce1 = 0;
     |SI nDifer > 0;  nPorce1 = nDifer * .60;  |FINSI;

     nPorce2 = 0;
     |SI #5#48 = "I";
         |SI nResto > 8;
             nPorce  = nResto - 8;
             nPorce2 = nPorce2 + (nPorce * 0.70);
             nResto  = 8;
         |FINSI;

         |SI nResto > 5;
             nPorce  = nResto - 5;
             nPorce2 = nPorce2 + (nPorce * 0.75);
             nResto  = 5;
         |FINSI;

         |SI nResto > 3;
             nPorce  = nResto - 3;
             nPorce2 = nPorce2 + (nPorce * 0.80);
             nResto  = 3;
         |FINSI;

         |SI nResto > 1;
             nPorce  = nResto - 1;
             nPorce2 = nPorce2 + (nPorce * 0.85);
             nResto  = 1;
         |FINSI;

         |SI nResto > 0;
             nPorce2 = nPorce2 + (nResto * 0.90);
         |FINSI;
     |FINSI;

     |SI #5#48 = "P";
         |SI nResto > 0;    |Y nResto [ 1;  nPorce2 = 0.90;  |FINSI;
         |SI nResto ] 1.01; |Y nResto [ 3;  nPorce2 = 0.85;  |FINSI;
         |SI nResto ] 3.01; |Y nResto [ 5;  nPorce2 = 0.80;  |FINSI;
         |SI nResto ] 5.01; |Y nResto [ 8;  nPorce2 = 0.75;  |FINSI;
         |SI nResto > 8;                    nPorce2 = 0.70;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Incentivo98;
     nPorce1 = 0;
     |SI nDifer > 0;  nPorce1 = nDifer * .40;  |FINSI;

     nPorce2 = 0;
     |SI #5#48 = "I";
         |SI nResto > 8;
             nPorce  = nResto - 8;
             nPorce2 = nPorce2 + (nPorce * 0.30);
             nResto  = 8;
         |FINSI;

         |SI nResto > 5;
             nPorce  = nResto - 5;
             nPorce2 = nPorce2 + (nPorce * 0.25);
             nResto  = 5;
         |FINSI;

         |SI nResto > 3;
             nPorce  = nResto - 3;
             nPorce2 = nPorce2 + (nPorce * 0.20);
             nResto  = 3;
         |FINSI;

         |SI nResto > 1;
             nPorce  = nResto - 1;
             nPorce2 = nPorce2 + (nPorce * 0.15);
             nResto  = 1;
         |FINSI;

         |SI nResto > 0;
             nPorce2 = nPorce2 + (nResto * 0.10);
         |FINSI;
     |FINSI;

     |SI #5#48 = "P";
         |SI nResto > 0;    |Y nResto [ 1;  nPorce2 = 0.10;  |FINSI;
         |SI nResto ] 1.01; |Y nResto [ 3;  nPorce2 = 0.15;  |FINSI;
         |SI nResto ] 3.01; |Y nResto [ 5;  nPorce2 = 0.20;  |FINSI;
         |SI nResto ] 5.01; |Y nResto [ 8;  nPorce2 = 0.25;  |FINSI;
         |SI nResto > 8;                    nPorce2 = 0.30;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO TotalMod;
     |ABRE #31;
     #31#0 = #5#16;
     #31#1 = #5#17;
     #31#2 = #5#18;
     |LEE 040#31=;
     |SI FSalida ! 0;  |DDEFECTO #31;  |FINSI;
     |CIERRA #31;

     nResto  = #5#49;
     nPorce1 = 0;
     nPorce2 = 0;
     nDifer  = #5#50 - #5#49;
     |SI nDifer < 0;  nResto = #5#50;  |FINSI;
     |HAZ Incentivo97;
     nPorceL1 = nPorce1 + nPorce2;

     nResto   = #5#54;
     nPorce1 = 0;
     nPorce2 = 0;
     nDifer  = #5#55 - #5#54;
     |SI nDifer < 0;  nResto = #5#55;  |FINSI;
     |HAZ Incentivo97;
     nPorceL2 = nPorce1 + nPorce2;

     |SI #5#54 = 0;  |Y #5#55 =  0;
         #5#97 = nPorceL1 * #31#6;
         #5#97 = #5#97 + (#5#30  * #31#9);
     |SINO;
         #5#97 = nPorceL1 * #31#6;
         #5#97 = #5#97 + (nPorceL2 * #31#9);
     |FINSI;
     #5#97 = #5#97 + (#5#31  * #31#12);
     #5#97 = #5#97 + (#5#32  * #31#15);
     #5#97 = #5#97 + (#5#33  * #31#18);
     #5#97 = #5#97 + (#5#34  * #31#21);
     #5#97 = #5#97 + (#5#35  * #31#24);

     #5#113 = #31#25 % #5#116;

     #5#105 = #5#97;
     |SI #5#98  ! 0;  #5#105 = #5#105 * #5#98;   |FINSI;
     |SI #5#100 ! 0;  #5#105 = #5#105 * #5#100;  |FINSI;

     #5#102 = 0;
     nDife  = #5#105 - #5#113;
     nCanti = #5#113 + (nDife * 1.30);
     |SI nDife < 0;  nCanti = 0;  |FINSI;
     |SI #31#25 = 0; nCanti = 0;  |FINSI;
     |SI nCanti ! 0; #5#105 = nCanti;  #5#102 = 1.30;  |FINSI;

     #5#115 = #5#105 * 1.10;

     || CALCULO DEL RENDIMIENTO EN 1998

     |ABRE #30;
     #30#0 = #5#16;
     #30#1 = #5#17;
     #30#2 = #5#18;
     |LEE 040#30=;
     |SI FSalida ! 0;  |DDEFECTO #30;  |FINSI;
     |CIERRA #30;

     nSwAsala2 = 0;
     aAlfa     = #30#1 % 103;
     |SI aAlfa = "644";  nSwAsala2 = 1;  |FINSI;

     #5#47 =         (#5#29 * #5#38);
     #5#47 = #5#47 + (#5#30 * #5#39);
     #5#47 = #5#47 + (#5#31 * #5#40);
     #5#47 = #5#47 + (#5#32 * #5#41);
     #5#47 = #5#47 + (#5#33 * #5#42);
     #5#47 = #5#47 + (#5#34 * #5#43);
     #5#47 = #5#47 + (#5#35 * #5#44);
     #5#47 = #5#47 + (#5#36 * #5#45);
     #5#47 = #5#47 + (#5#37 * #5#46);

     #5#50 = #5#29;
     #5#52 = #5#38;
     #5#55 = 0;
     #5#57 = 0;
     |SI nSwAsala2 = 1;  #5#55 = #5#30;  #5#57 = #5#39;  |FINSI;

     || Minoracion de Empleo

     nResto  = #5#49;
     #5#51   = 0;
     #5#53   = 0;
     nPorce1 = 0;
     nPorce2 = 0;
     nDifer  = #5#50 - #5#49;
     |SI nDifer < 0;  nResto = #5#50;  |FINSI;
     |HAZ Incentivo98;
     #5#51   = nPorce1 + nPorce2;
     #5#53   = #5#52 * #5#51;

     nResto   = #5#54;
     #5#56   = 0;
     #5#58   = 0;
     nPorce1 = 0;
     nPorce2 = 0;
     nDifer  = #5#55 - #5#54;
     |SI nDifer < 0;  nResto = #5#55;  |FINSI;
     |HAZ Incentivo98;
     #5#56  = nPorce1 + nPorce2;
     #5#58  = #5#57 * #5#56;
     #5#59  = #5#53 + #5#58;

     || Minoracion Inversion

     #5#73 = #5#60 + #5#63 + #5#66 + #5#69 + #5#72;

     ||  Rdto Neto Minorado

     #5#74 = #5#47 - #5#59 - #5#73;
     |SI #5#74 < 0;  #5#74 = 0;  |FINSI;

     ||  Quioscos

     #5#76 = #5#74 * #5#75;
     |SI #30#32 = "N";  #5#76 = 0;  |FINSI;
     |SI #5#76 < 0;    #5#76 = 0;  |FINSI;

     ||  Taxis

     #5#78 = #5#74 * #5#77;
     |SI #30#33 = "N";  #5#78 = 0;  |FINSI;
     |SI #5#78 < 0;    #5#78 = 0;  |FINSI;

     ||  Urbanos

     #5#80 = #5#74 * #5#79;
     |SI #30#35 = "N";  #5#80 = 0;  |FINSI;
     |SI #5#80 < 0;    #5#80 = 0;  |FINSI;

     ||  Mercancias

     #5#82 = #5#74 * #5#81;
     |SI #30#34 = "N";  #5#82 = 0;  |FINSI;
     |SI #5#50 ! 0;     #5#82 = 0;  |FINSI;
     |SI #5#55 ! 0;     #5#82 = 0;  |FINSI;
     |SI #5#82 < 0;     #5#82 = 0;  |FINSI;

     ||  Empresas Peque¤as dimensiones

     nCampoRdto = 74;
     |SI #5#76 ! 0;  nCampoRdto = 76;  |FINSI;

     #5#84 = #5nCampoRdto * #5#83;
     |SI #5#78 ! 0; |O #5#80 ! 0; |O #5#82 ! 0;
         #5#84 = 0;
     |FINSI;
     |SI #5#84 < 0;  #5#84 = 0;  |FINSI;

     ||  Temporada

     nCampoRdto = 74;
     |SI #5#76 ! 0;  nCampoRdto = 76;  |FINSI;
     |SI #5#78 ! 0;  nCampoRdto = 78;  |FINSI;
     |SI #5#80 ! 0;  nCampoRdto = 80;  |FINSI;
     |SI #5#82 ! 0;  nCampoRdto = 82;  |FINSI;
     |SI #5#84 ! 0;  nCampoRdto = 84;  |FINSI;

     #5#87 = #5nCampoRdto * #5#86;
     |SI #5#87 < 0;  #5#87 = 0;  |FINSI;

     || Exceso

     nCampoRdto = 74;
     |SI #5#76 ! 0;  nCampoRdto = 76;  |FINSI;
     |SI #5#78 ! 0;  nCampoRdto = 78;  |FINSI;
     |SI #5#80 ! 0;  nCampoRdto = 80;  |FINSI;
     |SI #5#82 ! 0;  nCampoRdto = 80;  |FINSI;
     |SI #5#84 ! 0;  nCampoRdto = 84;  |FINSI;
     |SI #5#87 ! 0;  nCampoRdto = 87;  |FINSI;

     #5#114 = #30#31 % #5#116;
     #5#88  = #5nCampoRdto - #5#114;
     #5#89  = #5#114 + (#5#88 * 1.30);
     |SI #5#88 < 0;  #5#89 = 0;  |FINSI;
     |SI #30#31 = 0;  #5#89 = 0;  |FINSI;
     |SI #5#84 ! 0;  #5#89 = 0;  |FINSI;

     || Nueva Actividad

     nCampoRdto = 74;
     |SI #5#76 ! 0;  nCampoRdto = 76;  |FINSI;
     |SI #5#78 ! 0;  nCampoRdto = 78;  |FINSI;
     |SI #5#80 ! 0;  nCampoRdto = 80;  |FINSI;
     |SI #5#82 ! 0;  nCampoRdto = 82;  |FINSI;
     |SI #5#84 ! 0;  nCampoRdto = 84;  |FINSI;
     |SI #5#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #5#89 ! 0;  nCampoRdto = 89;  |FINSI;

     #5#91 = #5nCampoRdto * #5#90;
     |SI #5#87 ! 0;  #5#91 = 0;  |FINSI;
     |SI #5#91 < 0;  #5#91 = 0;  |FINSI;

     || Rendimiento Neto Modulos Ajustado

     nCampoRdto = 74;
     |SI #5#76 ! 0;  nCampoRdto = 76;  |FINSI;
     |SI #5#78 ! 0;  nCampoRdto = 78;  |FINSI;
     |SI #5#80 ! 0;  nCampoRdto = 80;  |FINSI;
     |SI #5#82 ! 0;  nCampoRdto = 82;  |FINSI;
     |SI #5#84 ! 0;  nCampoRdto = 84;  |FINSI;
     |SI #5#87 ! 0;  nCampoRdto = 87;  |FINSI;
     |SI #5#89 ! 0;  nCampoRdto = 89;  |FINSI;
     |SI #5#91 ! 0;  nCampoRdto = 91;  |FINSI;

     #5#106 = #5nCampoRdto;

     #5#108 = #5#106;
     |SI #5#115 < #5#108;  |Y #5#115 ! 0;
         #5#108 = #5#115;
     |FINSI;

     #5#107 = #5#106 - #5#108;

     || Rendimiento Neto Calculado

     #5#111 = #5#108 + #5#109 - #5#110;

     || Reduccion Ley 66/97

     #5#93 = #5#111;
     |SI #5#92 ! 0;
         #5#93 = #5#93 < #5#92;
         |SI #5#93 < 0;  #5#93 = 0;  |FINSI;
     |FINSI;

     || Rdto Neto

     #5#96 = #5#93 + #5#95 - #5#104 + #5#94;
|FPRC;

|PROCESO GrabaFic5;
  #5#0 = empresa;
  #5#1 = Linea;
  |LIBERA #5;
  |LEE 110#5=;
  |SI FSalida = 0;
      |ABRE #8;
      #8#0 = #5#16;
      #8#1 = #5#17;
      #8#2 = #5#18;
      |LEE 040#8=;
      |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
      |CIERRA #8;

      |SI #8#33 = "N";
          #5#95  = nIncremento;
          #5#104 = Disminucion;
          #5#109 = 0;
      |SINO;
          #5#109 = nIncremento - Disminucion;
          #5#104 = 0;
          #5#95  = 0;
      |FINSI;

      |HAZ TotalMod;

      |GRABA 020#5a;

      HContribu  = #5#0;
      HNombre    = nombre;
      HPrograma  = "(reempmod) EMPRESARIALES MODULOS";
      HLinea     = #5#1;
      HPerceptor = #5#3;
      HTipo      = "MODIFICACION DESDE ACTIVOS AFECTOS";
      HRdto      = #5#96;  |SI HRdto > #5#112;  HRdto = #5#112;  |FINSI;
      |HAZ AltaHistorico;
  |FINSI;
|FPRC;

|PROCESO GrabaFic6;  || Agricolas
     #6#0 = empresa;
     #6#1 = Linea;
     |LIBERA #6;
     |LEE 140#6=;
     |SI FSalida = 0;
         #6#39 = Disminucion;

         |SI TipoClave ! "F";
              #6#38 = nIncremento;
              #6#32 = 0;
         |SINO;
              #6#38 = 0;
              |HAZ Tiempo;
              Porce = EjerT * 14.28;
              |SI Porce > 99; Porce = 100; |FINSI;
              #6#32 = nIncremento - ((nIncremento * Porce) / 100);
         |FINSI;

         #6#21 = #6#19 + #6#20;
         #6#23 = #6#21 - #6#22;

         nCanti1 = #6#44;
         |SI #6#24 ! 0;  nCanti1 = nCanti1 * #6#24;  |FINSI;
         |SI #6#25 ! 0;  nCanti1 = nCanti1 * #6#25;  |FINSI;
         |SI #6#27 ! 0;  nCanti1 = nCanti1 * #6#27;  |FINSI;

         nCanti2 = #6#45;
         |SI #6#24 ! 0;  nCanti2 = nCanti2 * #6#24;  |FINSI;
         |SI #6#25 ! 0;  nCanti2 = nCanti2 * #6#25;  |FINSI;
         |SI #6#26 ! 0;  nCanti2 = nCanti2 * #6#26;  |FINSI;
         |SI #6#27 ! 0;  nCanti2 = nCanti2 * #6#27;  |FINSI;

         nRdto97 = (nCanti1 + nCanti2) * 1.05;

         nCanti1 = #6#19 - #6#46;
         |SI #6#24 ! 0;  nCanti1 = nCanti1 * #6#24;  |FINSI;
         |SI #6#25 ! 0;  nCanti1 = nCanti1 * #6#25;  |FINSI;
         |SI #6#27 ! 0;  nCanti1 = nCanti1 * #6#27;  |FINSI;
         |SI #6#28 ! 0;  nCanti1 = nCanti1 * #6#28;  |FINSI;

         nCanti2 = #6#20 - #6#47;
         |SI #6#24 ! 0;  nCanti2 = nCanti2 * #6#24;  |FINSI;
         |SI #6#25 ! 0;  nCanti2 = nCanti2 * #6#25;  |FINSI;
         |SI #6#26 ! 0;  nCanti2 = nCanti2 * #6#26;  |FINSI;
         |SI #6#27 ! 0;  nCanti2 = nCanti2 * #6#27;  |FINSI;
         |SI #6#28 ! 0;  nCanti2 = nCanti2 * #6#28;  |FINSI;

         #6#29 = nCanti1 + nCanti2;

         #6#31 = #6#29;
         |SI nRdto97 < #6#31;  |Y nRdto97 ! 0;
             #6#31 = nRdto97;
         |FINSI;
         #6#30 = #6#29 - #6#31;

         #6#34 = #6#31 + #6#32 - #6#33;
         |SI #6#34 < 0;  #6#34 = 0;  |FINSI;

         nCanti1 = #6#34 % #6#35;
         nCanti2 = #6#34 % #6#36;
         #6#37 = #6#34 - nCanti1 - nCanti2;
         |SI #6#37 < 0;  #6#37 = 0;  |FINSI;

         #6#40 = #6#37 + #6#38 - #6#39;

         |GRABA 140#6a;

         HContribu  = #6#0;
         HNombre    = nombre;
         HPrograma  = "(rem00014) AGRICOLAS Y GANADERAS";
         HLinea     = #6#1;
         HPerceptor = #6#3;
         HTipo      = "MODIFICACION DESDE ACTIVOS AFECTOS";
         HRdto      = #6#34;
        |HAZ AltaHistorico;
     |FINSI;
|FPRC;

|PROCESO Tiempo;
  EjerA1 = FechaVenta % -102;
  EjerA2 = FechaCompra % -102;
  EjerN1 = EjerA1;
  EjerN2 = EjerA2;
  EjerT  = EjerN1 - EjerN2;

  EjerA1 = FechaVenta % 402;
  EjerA2 = FechaCompra % 402;
  |SI EjerA1 > EjerA2; EjerT = EjerT + 1; |FINSI;

  |SI EjerA1 = EjerA2;
      EjerA1 = FechaVenta % 102;
      EjerA2 = FechaCompra % 102;
      |SI EjerA1 ] EjerA2; EjerT = EjerT + 1; |FINSI;
  |FINSI;
  EjerT = EjerT - 2;
|FPRC;

|DEFBUCLE leefic01;
  #0#2;
  ;
  empresa, "PD", 01;
  empresa, "PD", 99;
  e;
  NULL, Acumula;
|FIN;

|DEFBUCLE leefic02;
  #0#2;
  ;
  empresa, "PC", 01;
  empresa, "PC", 99;
  e;
  NULL, Acumula;
|FIN;

|DEFBUCLE leefic03;
  #0#2;
  ;
  empresa, "ED", 01;
  empresa, "ED", 99;
  e;
  NULL, Acumula;
|FIN;

|DEFBUCLE leefic04;
  #0#2;
  ;
  empresa, "EC", 01;
  empresa, "EC", 99;
  e;
  NULL, Acumula;
|FIN;

|DEFBUCLE leefic05;
  #0#2;
  ;
  empresa, "EM", 01;
  empresa, "EM", 99;
  e;
  NULL, Acumula;
|FIN;

|DEFBUCLE leefic06;
  #0#2;
  ;
  empresa, "AG", 01;
  empresa, "AG", 99;
  ;
  NULL, Acumula;
|FIN;

|PROCESO actual;
  |ABRE #1;
  SwFich = 1; sw = 0; |BUCLE leefic01;
  |SI sw = 1; |HAZ GrabaFic1; |FINSI;
  |CIERRA #1;

  |ABRE #2;
  SwFich = 2; sw = 0; |BUCLE leefic02;
  |SI sw = 1; |HAZ GrabaFic2; |FINSI;
  |CIERRA #2;

  |ABRE #3;
  SwFich = 3; sw = 0; |BUCLE leefic03;
  |SI sw = 1; |HAZ GrabaFic3; |FINSI;
  |CIERRA #3;

  |ABRE #4;
  SwFich = 4; sw = 0; |BUCLE leefic04;
  |SI sw = 1; |HAZ GrabaFic4; |FINSI;
  |CIERRA #4;

  |ABRE #5;
  SwFich = 5; sw = 0; |BUCLE leefic05;
  |SI sw = 1; |HAZ GrabaFic5; |FINSI;
  |CIERRA #5;

  |ABRE #6;
  SwFich = 6; sw = 0; |BUCLE leefic06;
  |SI sw = 1; |ABRE #0; |HAZ GrabaFic6; |CIERRA #0; |FINSI;
  |CIERRA #6;
|FPRC;

|| **************************************************************************
|| ***********************  ACTUALIZACION DEL DIFERIMIENTO ******************
|| **************************************************************************

|PROCESO BajaDife;
  |ABRE #7;
  #7#0 = #0#0;  #7#1 = 98;  #7#2 = #0#1;  |BORRA 140#7c; |LIBERA #7;
  |CIERRA #7;
|FPRC;

|PROCESO AltaDife;
  |SI #0#59 = "E"; |ACABA; |FINSI;

  |ABRE #7;
  #7#0  = #0#0;
  #7#1  = 98;
  #7#2  = #0#1;
  #7#3  = #0#24;
  #7#4  = #0#26;
  #7#5  = #0#29;
  Porce = #0#29 / #0#24;
  |SI Porce > 1; Porce = 1; |FINSI;
  #7#6 = Porce * #0#26;
  |SI #0#60 = "P";
      #7#7 = #0#61;
      #7#8 = (#7#6 * #0#61) / 100;
  |SINO;
      VAlfa = #0#61;
      VAlfa = ("00" + VAlfa) % -102;
      #7#7 = "1/" +  VAlfa;
      #7#8 = #7#6 / #0#61;
  |FINSI;
  |GRABA 140#7n;
  |LIBERA #7;

  |CIERRA #7;
|FPRC;
|| **************************************************************************
|| ***********************  ACTUALIZACION DEL PATRIMONIO ********************
|| **************************************************************************

|PROCESO baja_pat;
  patr_00 = #0#0;
  patr_01 = #0#53;
  patr_02 = #0#54;
  |HAZ borra_pat;
  patr_00 = #0#0;
  patr_01 = #0#56;
  patr_02 = #0#57;
  |HAZ borra_pat;
|FPRC;

|PROCESO alta_pat;
  |SI #0#37 = "X"; |O #0#37 = "R"; |ACABA; |FINSI;

  || TITULAR

  |SI #0#44 = "N";
      patr_09 = #0#9;
      |SI patr_09 < #0#10;  patr_09 = #0#10; |FINSI;
      |SI patr_09 < #0#11;  patr_09 = #0#11; |FINSI;
  |SINO;
      |SI #0#12 ! "01.01.1900";              || PORQUE???????????????????????
          patr_09 = #0#9;
          |SI patr_09 < #0#10;  patr_09 = #0#10; |FINSI;
          |SI patr_09 < #0#11;  patr_09 = #0#11; |FINSI;
      |FINSI;
      patr_09 = 0;   || no hay patrimonio en venta
  |FINSI;

  |SI patr_09 = 0; |ACABA; |FINSI;


  |SI #0#4 ! "T";  |Y #0#4 ! "C";  |Y #0#4 ! "G";
      #0#55 = 0;
  |FINSI;

  patr_09 = (patr_09 * ((100 - #0#55) / 100)) ! 0;

  tpro_p = "P";

  |SI #0#51 = "N";
      patr_01 = "C2";
  |SINO;
      patr_01 = "C3";
  |FINSI;

  patr_00 = #0#0;
  patr_03 = #0#4;
  patr_04 = #0#5;
  patr_05 = #0#48;
  patr_07 = #0#46;
  patr_08 = #0#47;
  patr_16 = #0#49;
  patr_17 = #0#50;
  patr_18 = #0#52;

  |SI #0#4 = "G";
      patr_03 = "T";
      patr_04 = "TITULAR";
  |FINSI;

  |HAZ graba_pat;


  || CONYUGE

  #0#53 = patr_01;
  #0#54 = patr_02;

  |SI #0#55 = 0;  |ACABA;  |FINSI;

  |SI #0#44 = "N";
      patr_09 = #0#9;
      |SI patr_09 < #0#10;  patr_09 = #0#10; |FINSI;
      |SI patr_09 < #0#11;  patr_09 = #0#11; |FINSI;
  |SINO;
      |SI #0#12 ! "01.01.1900";  || PORQUE ??????????????????????????????????
          patr_09 = #0#9;
          |SI patr_09 < #0#10;  patr_09 = #0#10; |FINSI;
          |SI patr_09 < #0#11;  patr_09 = #0#11; |FINSI;
      |FINSI;
      patr_09 = 0;   || no hay patrimonio en venta
  |FINSI;

  |SI patr_09 = 0; |ACABA; |FINSI;

  patr_09 = (patr_09 * (#0#55 / 100)) ! 0;

  tpro_p = "P";

  |SI #0#8 = "I";
      |SI #0#52 = "U";
          patr_01 = "A1";
      |SINO;
          patr_01 = "B1";
      |FINSI;
  |SINO;
      patr_01 = "C3";
  |FINSI;

  patr_00 = #0#0;
  patr_03 = #0#4;
  patr_04 = #0#5;
  patr_05 = #0#48;
  patr_07 = #0#46;
  patr_08 = #0#47;
  patr_15 = "P";
  patr_16 = #0#49;
  patr_17 = #0#50;
  patr_18 = #0#52;

  |SI #0#4 = "G";  |O #0#4 = "T";
      patr_03 = "C";
      patr_04 = "CONYUGE";
  |SINO;
      patr_03 = "T";
      patr_04 = "TITULAR";
  |FINSI;

  |HAZ graba_pat;

  #0#56 = patr_01;
  #0#57 = patr_02;
|FPRC;
