|FICHEROS;
     rezcap01 #0;
     rezcap00 #1,MANTE;
     rezcapco #2;

     rerendtr #3;
     redatcon #4;
|FIN;

|VARIABLES;
     aPasword     = "";
     aAlfa        = "";
     nSwPasado    = 0;
     aPath2       = "";
     nCampos      = 0;

     &aPath1      = "";
     &aFichero    = "";
     &nDEmpre     = 0;
     &nHEmpre     = 0;
     &empresa     = 0;
     &eaParametro = "";
|FIN;

|INCLUYE i_cambio;

|PROCESO Mayus;
     #0Campo = #0Campo > #0Campo;   |PINTA #0Campo;
|FPRC;

|RUTINA ClaveBaja;
     #1#0 = 01;
|FRUT;

|RUTINA ClaveAlta;
     #1#0 = 99;
|FRUT;

|PROCESO Seleccion; |TIPO 0;
     |SI #0#3 = "S";
         |C_M #0#04, 1, "S";
         |C_M #0#05, 1, "S";

         |PARA nCampos = 6; |SI nCampos [ 35; |HACIENDO nCampos = nCampos + 1;
               #0nCampos = 0; |PINTA #0nCampos;
               |C_M #0nCampos, 1, "N";
         |SIGUE;
     |SINO;
         #0#4 = 00001; |PINTA #0#4;    |C_M #0#04, 1, "N";
         #0#5 = 99999; |PINTA #0#5;    |C_M #0#05, 1, "N";

         |PARA nCampos = 6; |SI nCampos [ 35; |HACIENDO nCampos = nCampos + 1;
               |C_M #0nCampos, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Renta97; |TIPO 7;
     |DBASS aAlfa;
     #0#1 = aAlfa + "agiren97/fich/";
     |PINTA #0#1;
|FPRC;

|PROCESO Renta98; |TIPO 7;
     |DBASS aAlfa;
     #0#2 = aAlfa + "agiren98/fich/";
     |PINTA #0#2;
|FPRC;

|PROCESO Miralo;
     |SI #1#2 = "P"; nSwPasado = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE rezcap00_1;
     #1#1;
     ;
     01;
     99;
     e;
     NULL, Miralo;
|FIN;

|PROCESO reprogra;
     empresa = #4#0;  |SUB_EJECUTA "rerecdat";
|FPRC;

|DEFBUCLE redatcon;
     #4#1;
     ;
     nDEmpre;
     nHEmpre;
     ;
     NULL, reprogra;
|FIN;

|PROCESO CopiaPatrones;
     |CUADRO 2004 2233;
     |PINTA 2105, " COPIANDO FICHEROS MAESTROS ";

     |SI eaParametro = "";   |SUB_EJECUTA "rezcap03";  |FINSI;
     |SI eaParametro = "1";  |SUB_EJECUTA "rezcap07";  |FINSI;
|FPRC;

|PROCESO RentaMia;
     aFichero = #1#3;
     |SI aFichero = "reacceso";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "redatcon";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "rerendtr";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "recapinm";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "revalore";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "revalono";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "rectacor";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "retransp";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "reproedi";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "reprofco";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "reempedi";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "reemprco";  |SUB_EJECUTA "rezcap04";  |FINSI;
     |SI aFichero = "reempmod";  |SUB_EJECUTA "rezcap04";  |FINSI;

     |SI aFichero = "rerendir";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "reanuali";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "reincreg";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "reincire";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "reincpre";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "reincpen";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "rejerant";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "rededu01";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "rededu02";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "rededu03";  |SUB_EJECUTA "rezcap05";  |FINSI;
     |SI aFichero = "rededu04";  |SUB_EJECUTA "rezcap05";  |FINSI;

     |SI aFichero = "rededu05";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rededu06";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rededu07";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rededu08";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rededu09";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rededu10";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "reactafe";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "repatrim";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "reven210";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "realc210";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "reall210";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "reempagr";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "repagret";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "redifrei";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rem00002";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rem00003";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rem00004";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rem00005";  |SUB_EJECUTA "rezcap06";  |FINSI;
     |SI aFichero = "rem00006";  |SUB_EJECUTA "rezcap06";  |FINSI;
|FPRC;

|PROCESO RentaSuya;
     aFichero = #1#3;
     |SI aFichero = "reacceso";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "redatcon";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "rerendtr";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "recapinm";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "revalore";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "revalono";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "rectacor";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "retransp";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "reproedi";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "reprofco";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "reempedi";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "reemprco";  |SUB_EJECUTA "rezcap08";  |FINSI;
     |SI aFichero = "reempmod";  |SUB_EJECUTA "rezcap08";  |FINSI;

     |SI aFichero = "rerendir";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "reanuali";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "reincreg";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "reincire";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "reincpre";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "reincpen";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "rejerant";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "rededu01";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "rededu02";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "rededu03";  |SUB_EJECUTA "rezcap09";  |FINSI;
     |SI aFichero = "rededu04";  |SUB_EJECUTA "rezcap09";  |FINSI;

     |SI aFichero = "rededu05";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rededu06";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rededu07";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rededu08";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rededu09";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rededu10";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "reactafe";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "repatrim";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "reven210";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "realc210";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "reall210";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "reempagr";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "repagret";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "redifrei";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rem00002";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rem00003";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rem00004";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rem00005";  |SUB_EJECUTA "rezcap10";  |FINSI;
     |SI aFichero = "rem00006";  |SUB_EJECUTA "rezcap10";  |FINSI;
|FPRC;

|PROCESO Copialos;
     |SI #1#2 ! "S";  |ACABA;  |FINSI;

     |SI eaParametro = "";   |HAZ RentaMia;   |FINSI;
     |SI eaParametro = "1";  |HAZ RentaSuya;  |FINSI;
|FPRC;

|DEFBUCLE rezcap00_2;
     #1#1;
     ;
     00;
     99;
     ;
     NULL, Copialos;
|FIN;

|PROCESO CopiaResto;
     |CUADRO 2004 2242;
     |PINTA 2105, " COPIANDO FICHEROS ELEGIDOS RENTA 97 ";

     |BUCLE rezcap00_2;
|FPRC;

|PROCESO Pase;
     |PUSHV 0501 2380;

     aPath1 = #0#1; |QBF aPath1;
     aPath2 = #0#2; |QBF aPath2;

     nSwPasado = 0;
     |BUCLE rezcap00_1;

     |PINPA #0#1;
     |ENTLINEAL #1#1, 1, 4, 20, 0, ClaveBaja, ClaveAlta;
     |CONFI "2400SProcedo a ejecutar el pase : ";
     |POPV;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PINPA #1#0;
     |PINDA #1#0;

     |SI #0#36 = "S";  |HAZ CopiaPatrones;  |FINSI;

     |SI #0#3 = "S";
         nDEmpre = #0#4;
         nHEmpre = #0#5;
         |HAZ CopiaResto;
         |SUB_EJECUTA "rezcap02";
         |BUCLE redatcon;
     |SINO;
         |PARA nCampos = 6; |SI nCampos [ 35; |HACIENDO nCampos = nCampos + 1;
               |SI #0nCampos ! 0;
                   nDEmpre = #0nCampos;
                   nHEmpre = #0nCampos;
                   |HAZ CopiaResto;
                   |SUB_EJECUTA "rezcap02";
                   |BUCLE redatcon;
               |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ que_version;

     eaParametro = PARAMETRO;

     |SI eaParametro = 1;
         |PUSHV 0501 2380;
         |CUADRO 2022
         |PINTA 2123, "Introduzca Password .:       ";

         E_sup = "5";
         aPasword = 2146 ? -1;
         |POPV;
         |SI aPasword ! "BARNA";
             |MENAV "      Pasword Incorrecto.";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #1;
     |LEE 040#1p;
     |SI FSalida ! 0;
         |MENAV "      NO SE HA INSTALADO LOS FICHEROS PATRONES ";
         |CIERRA #1;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |ABRE #2;
     |LEE 040#2p;
     |SI FSalida ! 0;
         |MENAV "      NO SE HA GRABADO EL FICHERO CONTROL DE PASES";
         |CIERRA #2;
         |ACABA;
     |FINSI;
     |CIERRA #2;

     |CLS;
     |CABEZA "Captura RENTA 97";
     |PINPA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |HAZ Pase; |FINSI;
|FPRO;
