|FICHEROS;
   catbam02;
   catbam03,MANTE;
   catbam04,MANTE;

   cacuenta;

   catbam01;
   catbam05;
   catbaw02;
   cafantas;
   :/modelos/def/dsmom030 #5;
   caw00041;
   espejo@;
|FIN;

|VARIABLES;
   &entrada = 1;

   aAlfa    = "";
   aAlfa1   = "";
   aAlfa2   = "";
   nNume1   = 0;
   nNume2   = 0;
   nInkey   = 0;
   aBlancs  = "";
   aBusca   = "";
   nOk      = 0;
   &enLinea = 0;
   nTecla   = 0;
   saliext  = 0;
   &ext1    = "";
   &ext2    = 0;

   nModo    = 0;
   nBlanco  = 0;
   nCuadre  = 0;
   aCuadre  = "";
   &SwAlgun  = 0;

   SwBoton4  = 0;
   SwBoton5  = 0;
   SwBoton6  = 0;
   nDImporte = 0;
   nHImporte = 0;
   aDCamp6   = "";
   aHCamp6   = "";
   aDCamp19  = "";
   aHCamp19  = "";
   fFechaI   = @;
   fFechaF   = @;
   &enDias   = 0;

   aDef      = "";
   aMas      = "";
   nNumero   = 0;
   aFichero  = "";
   nConNum   = 0;
   nOpera    = 0;
   nSalida   = 0;
   nModi     = 0;

   &total = 0;
   &sumal = 0;
   &difer = 0;

   &fecapu   = @;
   &fecant   = @;
   &coant    = 1;
   &deant    = "";
   &snFiltrA = "";
   &snFiltr  = "";
   &snFilAc  = "";
   &snFilBa  = "";
   &eftbaz3  = @;
   &entbaz4  = 0;
   &entbaz5  = 0;
   &entbaz6  = 0;
   &enOk     = 0;
   &aModi1   = "";
   &aModi2   = "";

   aContra      = "";
   &enDiario    = 0;
   &efFecha     = @;
   &enDocumento = 0;
   &enApunte    = 0;
   &eaContra    = "";
   &SwContra    = 0;
   &enDesde     = 0;
|FIN;

|INCLUYE dscont_i;

||*******************************************************
|PROCESO ActuaW02;
   |ABRE #catbaw02;
   #catbaw02#0 = enDiario;
   #catbaw02#1 = efFecha;
   #catbaw02#2 = enDocumento;
   #catbaw02#3 = enApunte;
   |LEE 041#catbaw02.=;
   |SI FSalida = 0;
       |SI nOk = 1;
           #catbaw02#4 = #catbam03#0;
           #catbaw02#5 = #catbam03#2;
           #catbaw02#6 = 0;
           |GRABA 020#catbaw02.a;
       |SINO;
           |BORRA 020#catbaw02.a;
       |FINSI;
   |FINSI;
   |CIERRA #catbaw02;
|FPRC;

||*******************************************************
|PROCESO VerEnDiario;
   |SI #catbam03#19 = "X";
       enDiario    = #catbam03#20;
       efFecha     = #catbam03#21;
       enDocumento = #catbam03#22;
       enApunte    = #catbam03#23;
   |FINSI;
   |SI #catbam03#14 = "X";
       enDiario    = #catbam03#15;
       efFecha     = #catbam03#16;
       enDocumento = #catbam03#17;
       enApunte    = #catbam03#18;
   |FINSI;
   |SI #catbam03#19 = "X"; |O #catbam03#14 = "X";
       |HAZ ConsultaAsto;
   |FINSI;
|FPRC;

|PROCESO SoloContra;
    |ENCAMPO #8#catbam03;
    |SI FSalida ! 7;
        nModi = 1;
    |FINSI;
|FPRC;

|PROCESO TodosCampos;
    nSalida = 0;

    |ET mCampo4;
        |C_M #catbam03#4, 0, aAlfa1;
        |SI aAlfa1 = "S";
           |ENCAMPO #4#catbam03;
           nSalida = FSalida;
        |FINSI;
        |SI nSalida = 7; |VETE Salir; |FINSI;
        |SI nSalida = 1; |VETE mCampo0; |FINSI;

    |ET mCampo5;
        |C_M #catbam03#5, 0, aAlfa1;
        |SI aAlfa1 = "S";
           |ENCAMPO #5#catbam03;
           nSalida = FSalida;
        |FINSI;
        |SI nSalida = 7; |VETE Salir; |FINSI;
        |SI nSalida = 1; |VETE mCampo0; |FINSI;
        |SI nSalida = 2; |VETE mCampo4; |FINSI;

    |ET mCampo12;
        |C_M #catbam03#12, 0, aAlfa1;
        |SI aAlfa1 = "S";
           |ENCAMPO #12#catbam03;
           nSalida = FSalida;
        |FINSI;
        |SI nSalida = 7; |VETE Salir; |FINSI;
        |SI nSalida = 1; |VETE mCampo0; |FINSI;
        |SI nSalida = 2; |VETE mCampo5; |FINSI;

    |ET mCampo13;
        |C_M #catbam03#13, 0, aAlfa1;
        |SI aAlfa1 = "S";
           |ENCAMPO #13#catbam03;
           nSalida = FSalida;
        |FINSI;
        |SI nSalida = 7; |VETE Salir; |FINSI;
        |SI nSalida = 1; |VETE mCampo0; |FINSI;
        |SI nSalida = 2; |VETE mCampo12; |FINSI;

    |ET mCampo8;
        |ENCAMPO #8#catbam03;
        nSalida = FSalida;
        |SI nSalida = 7; |VETE Salir; |FINSI;
        |SI nSalida = 1; |VETE mCampo0; |FINSI;
        |SI nSalida = 2; |VETE mCampo12; |FINSI;

    |ET mCampo10;
        |C_M #catbam03#10, 0, aAlfa1;
        |SI aAlfa1 = "S";
           |ENCAMPO #10#catbam03;
           nSalida = FSalida;
        |FINSI;
        |SI nSalida = 7; |VETE Salir; |FINSI;
        |SI nSalida = 1; |VETE mCampo0; |FINSI;
        |SI nSalida = 2; |VETE mCampo8; |FINSI;

    |ET mCampo11;
        |C_M #catbam03#11, 0, aAlfa1;
        |SI aAlfa1 = "S";
           |ENCAMPO #11#catbam03;
           nSalida = FSalida;
        |FINSI;
        |SI nSalida = 7; |VETE Salir;    |FINSI;
        |SI nSalida = 1; |VETE mCampo0;  |FINSI;
        |SI nSalida = 2; |VETE mCampo10; |FINSI;

    |ET mCampo0;
        nModi = 1;

    |ET Salir;
|FPRC;

|PROCESO Modificacion;
  |LEE 141#catbam03.=;

||  |SALVA_DATOS #catbam03;

  nModi = 0;
  |SI #catbam03#19 = "X"; |ACABA; |FINSI;

  |C_V #catbam03#24, 1, "N";
  |C_V #catbam03#8,  1, "S";
  |PINTA #catbam03#8;

  |SI nInkey = 10;
      |HAZ TodosCampos;
  |SINO;
      |HAZ SoloContra;
  |FINSI;

  |SI nModi = 1;
      |HAZ alsalir;
      |GRABA 041#catbam03.a;
      |LIBERA #catbam03;
  |SINO;
      |ERROR;
      |PONCONTROL 23, "SI";
||      |REPON_DATOS #catbam03;
  |FINSI;

  |C_V #catbam03#24, 1, "S";
  |C_V #catbam03#8,  1, "N";
  |PINTA #catbam03#24;

|FPRC;

|PROCESO LeoEspejo;
  nNumero = #espejo@#2;
  nConNum = nConNum + 1;
  #caw00041#0  = #espejo@#0;
  #caw00041#1  = #espejo@#1;
  #caw00041#2  = #espejo@#2;
  #caw00041#3  = #espejo@#3;
  #caw00041#4  = #espejo@#4;
  #caw00041#5  = #espejo@#5;
  #caw00041#6  = #espejo@#6;
  #caw00041#7  = #espejo@#7;
  #caw00041#8  = #espejo@#24;
  #caw00041#9  = #espejo@#9;
  #caw00041#10 = #espejo@#10;
  #caw00041#11 = #espejo@#11;
  #caw00041#12 = #espejo@#12;
  #caw00041#13 = #espejo@#13;
  |GRABA 020#caw00041.n;
|FPRC;

|DEFBUCLE LeoEspejo;
  #espejo@#1002;
  3,6,7,19;
  #catbam03#0, 00001, fFechaI, aDCamp6, nDImporte, aDCamp19;
  #catbam03#0, 99999, fFechaF, aHCamp6, nHImporte, aHCamp19;
  ;
  NULL, LeoEspejo;
|FIN;

|PROCESO Alta998;
   #caw00041#0 = #catbam03#0;
   #caw00041#2 = 00001;
|FPRC;

|PROCESO Baja998;
   #caw00041#0 = #catbam03#0;
   #caw00041#2 = 99999;
|FPRC;

|PROCESO BuscaImporte;
       nNumero = 0;
       nConNum = 0;

       |PUSHV 0501 2180;
       |DBASE aMas;
       aDef = aMas + "def/catbam03";
       |CARGA_DEF aDef, espejo@;
       |SI FSalida ! 0;
           |MENAV "    Error al Carga fichero de catbam03";
           |POPV;
           |ACABA;
       |FINSI;

       aFichero = "5x" + Usuario;
       |NOME_DAT #caw00041#aFichero#;
       |DELINDEX #caw00041;

       |ABRE #caw00041;
       |BUCLE LeoEspejo;
       |CIERRA #caw00041;

       |SI nConNum = 0;
           |MENAV "    No Existe Apuntes dentro de la Seleccion";
       |SINO;
           |HAZ LaPantalla;
       |FINSI;
       |DESCARGA_DEF #espejo@;
       |POPV;
|FPRC;

|PROCESO LaPantalla;
  |BLANCO 0701 2180;

  |SI nInkey = 11;
     |ATRI R;
     aAlfa = "Seleccion de Apuntes por Importe: Desde:              Hasta:                  ";
     |PINTA 0802, aAlfa;
     |PINTA 0843, #cafantas#12;
     |PINTA 0863, #cafantas#13; |ATRI 0;
  |FINSI;

  |SI nInkey = 13;
     |ATRI R;
     aAlfa = "Asiento:                       Importe:                 Contrap.:             ";
     |PINTA 0802, aAlfa;
     |PINTA 0811, #cafantas#22;
     |PINTA 0814, #cafantas#11;
     |PINTA 0825, #cafantas#6;
     |PINTA 0842, #cafantas#15;
     |PINTA 0844, #cafantas#13;
     |C_A #cafantas#4,1,12; |PINTA 0868, #cafantas#4;
     |ATRI 0;
  |FINSI;

  |ATRI P;
  |PINTA 0759,"<Enter>=Recoger Linea";
  |ATRI 0;
  |C_V #caw00041#10, 1, "N"; |C_V #caw00041#11, 1, "N";
  |C_V #caw00041#14, 1, "N"; |C_V #caw00041#15, 1, "N";
  |C_V #caw00041#16, 1, "N"; |C_V #caw00041#17, 1, "N";
  |ABRE #caw00041;
  |LINEAL_SIMPLE #1#caw00041, 28, 0902, 2079, Alta998, Baja998, NULL;
  |SI FSalida ! -1;
      nNumero = #caw00041#2;
  |FINSI;
  |CIERRA #caw00041;
|FPRC;

/*
|| ... con entlineal
  |PINPA #0#caw00041;
  |ATRI R; |PINTA 0843, #cafantas#12;
  |PINTA 0863, #cafantas#13; |ATRI 0;
  |ENTLINEAL #1#caw00041, -1, 4, 20, 0, Alta998, Baja998;
|| ... por consulta
  |ABRE #caw00041;
  |CONSULTA_CLAVE #1#caw00041; || , Alta998, Baja998;
  |SI FSalida = 0; nNumero = #caw00041#2; |FINSI;
  |CIERRA #caw00041;
*/

|PROCESO PreguntaImporte;
       |PUSHV 1022 2353;
       |PINTA 1023, "                              ";
       |PINTA 1123, " Del importe:                 ";
       |PINTA 1223, " Al importe :                 ";
       |PINTA 1323, "                              ";
       |CUADRO 1022 1352;
       |C_P #cafantas#12, 1, 1137; |PINTA #cafantas#12;
       |C_P #cafantas#13, 1, 1237; |PINTA #cafantas#13;

    |ET Camp10;
       |ENCAMPO #12#cafantas;
       |SI FSalida = 1; |VETE  Campo0; |FINSI;
       #cafantas#13 = #cafantas#12; |PINTA #cafantas#13;

    |ET Camp11;
       |ENCAMPO #13#cafantas;
       |SI FSalida = 2; |VETE Camp10; |FINSI;
       |SI #cafantas#13 < #cafantas#12;
           |MENAV "    Error. Importe inferior al desde";
           |VETE Camp11;
       |FINSI;

    |ET Campo0;
       |POPV;
       nDImporte = #cafantas#12;
       nHImporte = #cafantas#13;

       aDCamp19 = " ";
       aHCamp19 = "z";
       aDCamp6  = " ";
       aHCamp6  = "z";
       fFechaI  = "01.01.0000";
       fFechaF  = "31.12.2099";

    |HAZ BuscaImporte;
|FPRC;

|PROCESO CambioConta;
   |LEE 041#catbam03.=;

   nNumero = 0;

   #cafantas#4  = #catbam03#8;
   #cafantas#10 = #catbam03#3;
   #cafantas#12 = #catbam03#7;
   #cafantas#13 = #catbam03#7;
   #cafantas#15 = #catbam03#6;
   #cafantas#22 = #catbam03#20;
   #cafantas#11 = #catbam03#21;
   #cafantas#6  = #catbam03#22;

   nNume1   = #catbam03#21;
   nNume2   = nNume1 - enDias; fFechaI  = nNume2;
   nNume2   = nNume1 + enDias; fFechaF  = nNume2;

   nDImporte = #cafantas#12;
   nHImporte = #cafantas#13;

    aDCamp19 = " ";
    aHCamp19 = " ";
    aDCamp6  = #catbam03#6;
    aHCamp6  = #catbam03#6;

    nOk = 0;
    |HAZ BuscaImporte;
    |SI nNumero ! 0;
        aAlfa = "0000SCambiar Contabilizado a la linea " + ("00000" + nNumero) % -105;
        |CONFI aAlfa;
        |SI FSalida = 0; nOk = 1; |FINSI;
    |FINSI;
    |SI nOk = 0;
        nNume1 = #catbam03#2;
        aAlfa = "0000NDejar No Contabilizada esta linea " + ("00000" + nNume1) % -105;
        |CONFI aAlfa;
        |SI FSalida = 0; nOk = 2; |FINSI;
    |FINSI;

    |SI nOk ] 1;
        aContra     = #catbam03#8;
        enDiario    = #catbam03#20;
        efFecha     = #catbam03#21;
        enDocumento = #catbam03#22;
        enApunte    = #catbam03#23;
        |PDEFECTO #catbam03, 19, 24;
        #catbam03#8  = "";
        #catbam03#24 = "PENDIENTE";
        |GRABA 020#catbam03.a;
        |LIBERA #catbam03;
    |FINSI;
    |SI nOk = 1;
        #catbam03#0= #catbam02#0;
        #catbam03#2= nNumero;
        |LEE 141#catbam03.=;

        #catbam03#19 = "X";
        #catbam03#20 = enDiario;
        #catbam03#21 = efFecha;
        #catbam03#22 = enDocumento;
        #catbam03#23 = enApunte;
        #catbam03#24 = "CONTABILIZADO";
        #catbam03#8  = aContra;
        |GRABA 020#catbam03.a;
    |FINSI;

    |SI nOk ] 1;
        aBusca = "A";
        |HAZ ActuaW02;
    |FINSI;
    |LIBERA 020#catbam03;
    |PONCONTROL 23, "SI";
|FPRC;

|| ==========================================================================

|PROCESO borracontra;

  |SI nOpera = 0;
      |BORRA 141#catbam04.a;
      enLinea = #catbam04#3;
      |HAZ BorraM05;
  |FINSI;

  |SI nOpera = 1;
      SwAlgun = SwAlgun + 1;
      sumal   = sumal + #catbam04#8;

      aAlfa1 = #catbam04#4; |QBF aAlfa1;
      |SI aAlfa1 = ""; nBlanco = 1; |FINSI;
  |FINSI;

  |LIBERA #catbam04;

|FPRC;

|DEFBUCLE borracontra;
   #catbam04#1;
   ;
   #catbam03#0, #catbam03#2, 1;
   #catbam03#0, #catbam03#2, 99999;
   ;
   NULL,borracontra;
|FIN;

|PROCESO alsalir;

   |SI #catbam03#19 = "X";
       nOpera = 0; |BUCLE borracontra;
       enLinea = 0; |HAZ BorraM05;
       #catbam03#24 = "CONTABILIZADO";
       |ACABA;
   |FINSI;

   |SI #catbam03#8 ! "            ";
       nOpera = 0; |BUCLE borracontra;
       #catbam03#24 = #catbam03#8;
   |SINO;
       sumal   = 0;
       SwAlgun = 0;
       nBlanco = 0;
       nOpera  = 1; |BUCLE borracontra;

       nNume1 = #catbam03#7 - sumal; aAlfa1 = nNume1; |QBF aAlfa1;
       |SI aAlfa1 = "0"; |O aAlfa1 = "-0"; nNume1 = 0; |FINSI;

       aAlfa  = "PENDIENTE";
       |SI nBlanco = 0; |Y SwAlgun ! 0;
           aAlfa = "DESGLOSE";
           |SI nNume1 ! 0;
               |SI nCuadre = 0; aAlfa = "CUADRE";    |FINSI;
               |SI nCuadre = 1; aAlfa = "PENDIENTE"; |FINSI;
           |FINSI;
       |FINSI;

       #catbam03#24 = aAlfa;
       enLinea = 0; |HAZ BorraM05;
   |FINSI;
|FPRC;

|RUTINA menorl;
   #catbam04#0 = #catbam03#0;
   #catbam04#1 = #catbam03#1;
   #catbam04#2 = #catbam03#2;
   #catbam04#3 = 1;
|FRUT;

|RUTINA mayorl;
   #catbam04#0 = #catbam03#0;
   #catbam04#1 = #catbam03#1;
   #catbam04#2 = #catbam03#2;
   #catbam04#3 = 99999;
|FRUT;

|PROCESO contrapartidas;

   |PUSHV 0701 2380;

   total   = #catbam03#7;
   sumal   = 0;
   SwAlgun = 0;
   nOpera  = 1; |BUCLE borracontra;
   difer   = (total - sumal) ! 2;
   coant   = #catbam03#4;
   deant   = #catbam03#5;

|ET Lineal4;
   aBlancs = " " * 78;
   |PINTA 2102, aBlancs;
   |PINTA 2202, aBlancs;
   |PINTA 2302, aBlancs;
   |ENTLINEAL #1#catbam04, -3, nModo, 20, 1, menorl, mayorl;
   aAlfa1 = difer; |QBF aAlfa1;
   |SI aAlfa1 = "0"; |O aAlfa1 = "-0"; difer = 0; |FINSI;
   |SI difer ! 0; |Y SwAlgun ! 0; |Y nModo ! 4;
       |CONFI "0000SATENCION!  NO Esta Cuadrado el Asiento. Salir";
       |SI FSalida ! 0;
           |VETE Lineal4;
       |FINSI;
   |FINSI;
   |POPV;
|FPRC;


|| ********* PROCESOS DEL CAMPO DE CONTRAPARTIDA

|PROCESO Tipo6C8m3;  |TIPO 6;
    nTecla = FSalida;

    |SI nTecla = 11;
        |SI #catbam03#24 ! "DESGLOSE    ";
            enDesde  = 3;
            eaContra = #catbam03#8;
            |HAZ BuscoContra;
            #catbam03#8 = eaContra;
            |PINTA #catbam03#8;
        |FINSI;
        |ERROR;
        |ACABA;
    |FINSI;

     eaCuenta = #catbam03#8;
     saliext  = FSalida;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #catbam03#8 = eaCuenta;
     |PINTA #catbam03#8;

     aAlfa1 = #catbam03#8; |QBF aAlfa1;
     |SI aAlfa1 = "";
         nModo = 2;
         |HAZ contrapartidas;
         |ACABA;
     |FINSI;

     eaCuenta = #catbam03#8;
     |HAZ SacaNivel;
     #catbam03#9 = enNivel;
     |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea

     |SI saliext = 9;
         ext1 = #catbam03#8;
         ext2 = #catbam03#9;
         |SUB_EJECUTA "caextrap"
         saliext = 0;
     |FINSI;
|FPRC;

|PROCESO Tipo0C8m3;  |TIPO 0;

    aAlfa1 = #catbam03#8; |QBF aAlfa1;
    |SI aAlfa1 = ""; |ACABA; |FINSI;

    |HAZ pinta_cta;
    |SI #cacuenta#3 ! "S";
       |MENAV "     LA CUENTA NO ES DE PASE DIRECTO";
       |ERROR;
       |ACABA;
    |FINSI;

    |C_M #catbam03#10, 1, aModi1;
    |C_M #catbam03#11, 1, aModi2;
    |SI #catbam03#8 = "            ";
        |C_M #catbam03#11, 1, "N";
        |C_M #catbam03#12, 1, "N";
   |FINSI;
|FPRC;

|| ////////////////////////////////////////////
|| //////////////////////////////////////////////////////////
|PROCESO c_departa; |TIPO 7;
   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI Haybasica = 1;
       |MENSA "    <F2> Consulta de actividades";
   |SINO;
       |MENSA "    <F2> Consulta de departamentos";
   |FINSI;
|FPRC;

|PROCESO c_subdepar; |TIPO 7;
   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI Haybasica = 1;
      |SI enArrend ! 2;
         |MENSA "    Subdepartamento: Referencias Catastrales <F2> Consultar <F3> Modificar";
      |SINO;
         |MENSA "    Subdepartamento. <F2> Consulta de Cultivos";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO iActividad; |TIPO 0;
   |BLIN 4;
   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   aBlancs = " "* 78; |PINTA 2202, aBlancs;

   eOpDep = 0;
   |SI FSalida = 10;  eOpDep = 1; |FINSI;
   enActividad = #catbam03#12;
   eaCodDep    = #catbam03#12;
   |HAZ Actividad;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Actividad / Departamento";
       |ERROR;
   |SINO;
       #catbam03#12 = eaCodDep; |PINTA #catbam03#12;
       |HAZ pDepartamento;
       |SI efActFin > "01.01.1900"; |Y snFilBa ! "N";
           aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
           |CONFI aAlfa1;
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
       |SI eaEsCom = "S";
           |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Movimientos ? ";
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO iSubActividad; |TIPO 0;
   |BLIN 4;
   |C_M #catbam03#Campo#, 0, aAlfa1;

   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpSub = 1; |FINSI;
   |SI FSalida = 11; eOpSub = 2; |FINSI;

   aBlancs = " " * 78; |PINTA 2302, aBlancs;
   enConcepto  = #catbam03#4;
   eaCodSubdep = #catbam03#13;
   enQue = 1;
   |HAZ SubActividad;
   enQue = 0;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe SubDepartamento";
       |ERROR;
   |SINO;
       #catbam03#13 = eaCodSubdep; |PINTA #catbam03#13;
       |HAZ pSubdepar;
   |FINSI;
|FPRC;

|CALCULO concepto; |TIPO 0;  || desde Campos conceptos
   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 10;
       enConcepto = #catbam03#4;
       |HAZ VerConcepto;
       #catbam03#4 = enConcepto; |PINTA #catbam03#4;
   |FINSI;

   enFilConc  = 1;
   eaCuenta   = #catbam02#0;
   enConcepto = #catbam03#4;
   |HAZ FiltroConcepto;
   |SI eswLect ! 0;
       |C_M #catbam03#4, 1, "S";
       |ACABA;
   |FINSI;

   #catbam03#10 = #catbam03#4; |PINTA #catbam03#10;
   #catbam03#11 = #catbam03#5; |PINTA #catbam03#11;
|FCAL;

|CALCULO otroconce; |TIPO 0;

   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 2;  |ACABA; |FINSI;

   enFilConc = 1;
   eaCuenta   = #catbam03#8;
   enConcepto = #catbam03#10;
   |HAZ FiltroConcepto;
   |SI eswLect ! 0; |ACABA; |FINSI;

   |SI #catbam03#10 ! #catbam03#4;
       #catbam03#11 = #dsmom030#1;
       |PINTA #catbam03#11;
   |FINSI;
|FCAL;

|CALCULO alfin;  |TIPO 7;
   |C_M #catbam03#Campo#,0,aAlfa1;
   |SI aAlfa1 = "S"; |Y eaSobreEs ! "S";
       |PTEC 816;
   |FINSI;
|FCAL;

|CALCULO descripcion; |TIPO 0;
   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   #catbam03#11 = #catbam03#5;
   |PINTA #catbam03#11;
|FCAL;

|CALCULO duplico;  |TIPO 0;   ||Desde campo descripcion 11
   |C_M #catbam03#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 10;
      #catbam03#11 = #catbam03#5;
      |PINTA #catbam03#11;
   |FINSI;
|FCAL;

|PROCESO pinta_cta;
   |ABRE #cacuenta;
   |DDEFECTO #cacuenta;
   #cacuenta#0 = #catbam03#8;
   |LEE 001#cacuenta.=;
   |CIERRA #cacuenta;
   |ATRI I;
   |PINTA 2102, #cacuenta#2;
   |PINTA 2140, #cacuenta#51;
   |PINTA 2154, #cacuenta#52;
   |PINTA 2168, #cacuenta#53;
   |ATRI 0;
|FPRC;

|PROCESO pinta_actividad;
   |SI eaDepar = "S";
       eOpDep = 0;
       enActividad = #catbam03#12;
       eaCodDep    = #catbam03#12;
       |HAZ Actividad;
       |HAZ pDepartamento;
   |FINSI;
|FPRC;

|PROCESO pinta_subdepar;
   |SI eaSubde = "S";
       eOpSub = 0;
       enConcepto  = #catbam03#4
       eaCodSubdep = #catbam03#13;
       |HAZ SubActividad;
       |HAZ pSubdepar;
   |FINSI;
|FPRC;

|CALCULO Tipo7C0m3; |TIPO 7;

   aBlancs = " " * 78;
   |PINTA 2202, aBlancs;
   |PINTA 2302, aBlancs;

   |HAZ pinta_cta;
   |HAZ pinta_actividad;
   |HAZ pinta_subdepar;

   nCuadre  = 0;
   aCuadre  = #catbam01#30; |QBF aCuadre;
   |SI aCuadre = ""; nCuadre = 1; |FINSI;

   |SI #catbam03#6 = "D";
       aModi1 = #catbam01#11;
       aModi2 = #catbam01#13;
   |SINO;
       aModi1 = #catbam01#16;
       aModi2 = #catbam01#18;
   |FINSI;
   |C_M #catbam03#4, 1,aModi1;
   |C_M #catbam03#11,1,aModi1;
   |C_M #catbam03#5, 1,aModi2;
   |C_M #catbam03#12,1,aModi2;

   SwBoton4 = 0;
   SwBoton5 = 0;
   SwBoton6 = 0;
   |SI #catbam03#19 = "X";
       SwBoton4 = 1;
       SwBoton5 = 1;
       aAlfa = "F3-Busca mov.Importe, F4-Consulta Asto, F5-Cambia Asto otra linea, F7-Informe";
   |SINO;
       |SI #catbam03#14 = "X";
           SwBoton4 = 1;
           aAlfa = "Intro-Contrapart., F2-Modifica, F3-Busca Importe, F4-Asto Punteado, F7-Informe";
       |SINO;
           |SI #catbam03#24 = "DESGLOSE    "; |O #catbam03#24 = "CUADRE      ";
               SwBoton6 = 1;
               aAlfa = "Intro-Contrapart., F2-Modifica, F3-Busca Importe, F6-Ver desglose, F7-Informe";
           |SINO;
               aAlfa = "<Intro> Contrapartida, F2-Modifica datos, F3-Busca por Importe, F7-Informe";
           |FINSI;
       |FINSI;
   |FINSI;
   aAlfa = "0000" + aAlfa;
   |MENSA aAlfa;
|FCAL;

|CALCULO Tipo0C1m3; |TIPO 0;
   |BLIN 4;
   nInkey = 0;
   |SI #catbam03#19 = "X";
       |MENAV "0000Movimiento ya contabilizado. No modificable";
   |SINO;
       |HAZ Modificacion;
   |FINSI;
|FCAL;

|CALCULO Tipo11C1; |TIPO 11;
   nInkey = FSalida;

   |SI nInkey = 11;
       |ERROR;
       nNumero = 0;
       |HAZ PreguntaImporte;
       |SI nNumero ! 0;
           #catbam03#2 = nNumero;
           |LEE 041#catbam03.=;
           |PONCONTROL 23, "SI";
           |PTEC 805;
       |FINSI;
   |FINSI;

   |SI nInkey = 0; |O nInkey = 10;
       |SI #catbam03#19 = "X";
           |MENAV "0000Movimiento ya contabilizado. No modificable";
       |SINO;
           |HAZ Modificacion;
           |PONCONTROL 23, "SI";
       |FINSI;
   |FINSI;

   |SI nInkey = 12; |Y SwBoton4 = 1;
       |HAZ VerEnDiario;
   |FINSI;

   |SI nInkey = 13; |Y SwBoton5 = 1;
       |HAZ CambioConta;
   |FINSI;

   |SI nInkey = 14; |Y SwBoton6 = 1;
       nModo = 4;
       |HAZ contrapartidas;
       |ERROR;
   |FINSI;

   |SI nInkey = 15;
       |CONFI "0000SDesea imprimir un listado del Extracto bancario";
       |SI FSalida = 0;
           eaCuenta = #catbam03#0;
           |SUB_EJECUTA "catbay01;INFOR";
       |FINSI;
       |ERROR;
   |FINSI;
|FCAL;

|PROCESO MTipo5;  |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;
