|FICHEROS;
   caerpcfg #0;

   caerpcf1 #10,MANTE;
   caerpcf2 #11,MANTE;
   caerpcf3 #12,MANTE;

   caivaasi #200;
   :/modelos/def/dsmom030;
|FIN;

|VARIABLES;
   nModo = 0;
   aAlfa = "";
  {40}aPopup        = "";
     nID            = 0;
     aID            = "";
     aTexto         = "";
   nNume1 = 0;
   aBlanco = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoiv_i;
|INCLUYE cla340_i;

|RUTINA inf10;
   #caerpcf1#0 = "     ";
   #caerpcf1#1 = " ";
|FRUT;

|RUTINA sup10;
   #caerpcf1#0 = "zzzzz";
   #caerpcf1#1 = "z";
|FRUT;

|RUTINA inf11;
   aBlanco = " " * 80;
   #caerpcf2#0 = aBlanco;
|FRUT;

|RUTINA sup11;
   aBlanco = "[" * 80;
   #caerpcf2#0 = aBlanco;
|FRUT;

|RUTINA inf12;
   #caerpcf3#0 = 00;
|FRUT;

|RUTINA sup12;
   #caerpcf3#0 = 99;
|FRUT;

|PROCESO CompruebaLibro;
   |SI #caerpcf1#1 ! #caerpcf1#4;
       |MENAV "     Libro incorrecto"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO EditaLineal1;
   |SI #caerpcfg#1 = "S";
       |ENTLINEAL #1#caerpcf1, -1, 2, 10, 0, inf10, sup10;
   |FINSI;
|FPRC;

|PROCESO EditaLineal2;
   |ENTLINEAL #1#caerpcf3, -1, 2, 15, 0, inf12, sup12;

   |ENTLINEAL #1#caerpcf2, -1, 2, 22, 0, inf11, sup11;
|FPRC;

|PROCESO PintaLins; |TIPO 13;
   |ENTLINEAL #1#caerpcf1, -1, 7, 10, 0, inf10, sup10;
   |ENTLINEAL #1#caerpcf3, -1, 7, 15, 0, inf12, sup12;
   |ENTLINEAL #1#caerpcf2, -1, 7, 22, 0, inf11, sup11;
|FPRC;

|PROCESO EsIBAN;
   aAlfa = "S";
   |SI #caerpcfg#6 = "S"; aAlfa = "N"; |FINSI;
   |C_M #caerpcfg#2, 1, aAlfa;
   |C_M #caerpcfg#3, 1, aAlfa;
   |C_M #caerpcfg#4, 1, aAlfa;
   |C_M #caerpcfg#5, 1, aAlfa;
|FPRC;


|| /////////////////////////////////////////////////////////////
|PROCESO DespuesCampo0;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
       Campo = 1; enConcepto = 0; |HAZ DefectoConcepto;
       #caerpcf2#1 = enConcepto; |PINTA #caerpcf2#1;

       Campo = 4; enConcepto = 0; |HAZ DefectoConcepto;
       #caerpcf2#4 = enConcepto; |PINTA #caerpcf2#4;

       Campo = 7;
   |FINSI;
|FPRC;

|PROCESO c_inf2;
   #dsmom030#0 = 1;
|FPRC;

|PROCESO c_sup2;
   #dsmom030#0 = 999;
|FPRC;

|PROCESO DefectoConcepto;
       |SI enConcepto = 0;
           |SI Campo = 1;
               |SI #caerpcf2#7 = " "; |O #caerpcf2#7 = "F"; #caerpcf2#7 = "B";
                   enConcepto = #caivaasi#5;
               |FINSI;
               |SI #caerpcf2#7 = "I"; |O #caerpcf2#7 = "R";
                   enConcepto = #caivaasi#13;
               |FINSI;
               |SI #caerpcf2#7 = "P";
                   enConcepto = #caivaasi#83;
               |FINSI;
           |FINSI;
           |SI Campo = 4;
               |SI #caerpcf2#7 = " "; |O #caerpcf2#7 = "F"; #caerpcf2#7 = "B";
                   enConcepto = #caivaasi#31;
               |FINSI;
               |SI #caerpcf2#7 = "I"; |O #caerpcf2#7 = "R";
                   enConcepto = #caivaasi#57;
               |FINSI;
               |SI #caerpcf2#7 = "P";
                   enConcepto = #caivaasi#85;
               |FINSI;
           |FINSI;
           |SI enConcepto = 0;
               |SI #caerpcf2#7 ! "P";
                  |SI Campo = 1; enConcepto = 700;  |FINSI;
                  |SI Campo = 4; enConcepto = 600;  |FINSI;
               |SINO;
                  enConcepto = 401;
               |FINSI;
           |FINSI;
       |FINSI;
|FPRC;

|PROCESO TrasConcepto;  |TIPO 0;
   enConcepto = #caerpcf2#Campo#;

   |SI FSalida = 10;

       |HAZ DefectoConcepto;
       |ABRE #dsmom030;
       #dsmom030#0 = enConcepto;
       |CONSULTA_F_CLAVE #1#dsmom030,c_inf2,c_sup2;
       #caerpcf2#Campo# = #dsmom030#0;
       |PINTA #caerpcf2#Campo#;
       |CIERRA #dsmom030;

   |FINSI;

   enConcepto = #caerpcf2#Campo#;
   |SI enConcepto = 0; |ACABA; |FINSI;

   |ABRE #dsmom030;
   #dsmom030#0 = enConcepto;
   |LEE 041#dsmom030.=;
   |SI FSalida ! 0;
       |MENAV "0000Error. No existe Concepto Contable";
       |ERROR;
   |SINO;
       |SI #caerpcf2#7 ! "P";
           |SI #dsmom030#4 = "N";
               |CONFI "0000NEl concepto no es de IVA. Continuar ";
               |SI FSalida ! 0;
                   |ERROR;
                   |CIERRA #dsmom030;
                   |ACABA;
               |FINSI;
           |FINSI;
       |SINO;
           |SI #dsmom030#5 = "N";
               |CONFI "0000NEl concepto no es de I.R.P.F. Continuar ";
               |SI FSalida ! 0;
                   |ERROR;
                   |CIERRA #dsmom030;
                   |ACABA;
               |FINSI;
           |FINSI;
       |FINSI;
   |FINSI;
   |CIERRA #dsmom030;
   nNume1 = Campo + 1;
   #caerpcf2#nNume1# = #dsmom030#1; |PINTA #caerpcf2#nNume1#;

   nNume1 = Campo + 2;
   |C_M #caerpcf2#nNume1#, 1, "N";
   |SI #caerpcf2#7 = "B";
       |C_M #caerpcf2#nNume1#, 1, "S";
       aClau340 = #caerpcf2#nNume1#;
       nNumFras = 1;
       aTipoIVA = "R"; |SI Campo = 4; aTipoIVA = "S"; |FINSI;
       |HAZ ClauDefecto;
       #caerpcf2#nNume1#  = aClau340;
       |PINTA #caerpcf2#nNume1#;
   |FINSI;
|FPRC;

|PROCESO Tipo66C2;  |TIPO 66;

     aAlfa = Campo;
     aAlfa = ("000" + aAlfa ) % -103;
     aAlfa = "|C"+ aAlfa+ "WID";
     aID   = #caerpcf2#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     |SI Campo = 6;
         aPopup2  = 27;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "F Adquisiciones realizadas por las agencias de viajes directamente en interés del viajero ";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "L Adquisiciones a comerciantes minoristas del IGIC";
         aPopup15 = "P Adquisiciones intracomunitarias de bienes.";
         aPopup16 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         aPopup17 = "R Operación de arrendamiento de local de negocio.";
         aPopup18 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
         aPopup19 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
         aPopup20 = "X Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo";
         aPopup21 = "Z Operaciones en Régimen especial de criterio de caja";
         aPopup22 = "1 IVA criterio de caja. Asiento resumen de facturas";
         aPopup23 = "2 IVA criterio de caja. Factura con varios asientos";
         aPopup24 = "3 IVA criterio de caja. Factura rectificativa";
         aPopup25 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
         aPopup26 = "5 IVA criterio de caja. Factura simplificada";
         aPopup27 = "6 IVA criterio de caja. Rectificación de errores registrales";
         aPopup28 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
         aPopup29 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";

     |SINO;
         aPopup1  = nID;  || Si fuera -1 en la posicion
         aPopup2  = 30;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "E IVA devengado pendiente de emitir factura";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "M IVA facturado pendiente de devengar (emitida factura)";
         aPopup15 = "N Facturación de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena";
         aPopup16 = "O Factura emitida en sustitución de tiques facturados y declarados.";
         aPopup17 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         aPopup18 = "R Operación de arrendamiento de local de negocio.";
         aPopup19 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
         aPopup20 = "T Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ...";
         aPopup21 = "U Operación de seguros.";
         aPopup22 = "V Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ...";
         aPopup23 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
         aPopup24 = "Z Operaciones en Régimen especial de criterio de caja";
         aPopup25 = "1 IVA criterio de caja. Asiento resumen de facturas";
         aPopup26 = "2 IVA criterio de caja. Factura con varios asientos";
         aPopup27 = "3 IVA criterio de caja. Factura rectificativa";
         aPopup28 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
         aPopup29 = "5 IVA criterio de caja. Factura simplificada";
         aPopup30 = "6 IVA criterio de caja. Rectificación de errores registrales";
         aPopup31 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
         aPopup32 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #caerpcf2#Campo# = aAlfa;
     |FINSI;

     |PINTA #caerpcf2#Campo#;
|FPRC;

|PROCESO Clau340; TIPO 0;

     aTexto = "";
     |SI #caerpcf2#Campo# = " "; aTexto = "Operaci¢n habitual"; |FINSI;
     |SI #caerpcf2#Campo# = "A"; aTexto = "Asiento resumen de facturas"; |FINSI;
     |SI #caerpcf2#Campo# = "B"; aTexto = "Asiento resumen de tiques"; |FINSI;

     |SI Campo = 3;
         |SI #caerpcf2#Campo# = "C"; aTexto = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #caerpcf2#Campo# = "D"; aTexto = "Factura rectificativa"; |FINSI;
         |SI #caerpcf2#Campo# = "E"; aTexto = "IVA devengado pendiente de emitir factura"; |FINSI;
         |SI #caerpcf2#Campo# = "G"; aTexto = "Rgimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #caerpcf2#Campo# = "H"; aTexto = "Rgimen especial de oro de inversi¢n"; |FINSI;
         |SI #caerpcf2#Campo# = "I"; aTexto = "Inversi¢n del Sujeto pasivo (ISP)";|FINSI;
         |SI #caerpcf2#Campo# = "J"; aTexto = "Tiques"; |FINSI;
         |SI #caerpcf2#Campo# = "K"; aTexto = "Rectificación anotaciones registrales"; |FINSI;
         |SI #caerpcf2#Campo# = "M"; aTexto = "IVA facturado pendiente de devengar (emitida factura)"; |FINSI;
         |SI #caerpcf2#Campo# = "N"; aTexto = "Facturaci¢n de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena"; |FINSI;
         |SI #caerpcf2#Campo# = "O"; aTexto = "Factura emitida en sustituci¢n de tiques facturados y declarados."; |FINSI;
         |SI #caerpcf2#Campo# = "Q"; aTexto = "Operaciones a las que se aplique el rgimen especial de bienes usados, ..."; |FINSI;
         |SI #caerpcf2#Campo# = "R"; aTexto = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
         |SI #caerpcf2#Campo# = "S"; aTexto = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
         |SI #caerpcf2#Campo# = "T"; aTexto = "Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ..."; |FINSI;
         |SI #caerpcf2#Campo# = "U"; aTexto = "Operación de seguros."; |FINSI;
         |SI #caerpcf2#Campo# = "V"; aTexto = "Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ..."; |FINSI;
         |SI #caerpcf2#Campo# = "W"; aTexto = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
         |SI #caerpcf2#Campo# = "Z"; aTexto = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
         |SI #caerpcf2#Campo# = "1"; aTexto = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
         |SI #caerpcf2#Campo# = "2"; aTexto = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
         |SI #caerpcf2#Campo# = "3"; aTexto = "IVA criterio de caja. Factura rectificativa"; |FINSI;
         |SI #caerpcf2#Campo# = "4"; aTexto = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
         |SI #caerpcf2#Campo# = "5"; aTexto = "IVA criterio de caja. Factura simplificada"; |FINSI;
         |SI #caerpcf2#Campo# = "6"; aTexto = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
         |SI #caerpcf2#Campo# = "7"; aTexto = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
         |SI #caerpcf2#Campo# = "8"; aTexto = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;

     |SINO;

         |SI #caerpcf2#Campo# = "C"; aTexto = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #caerpcf2#Campo# = "D"; aTexto = "Factura rectificativa";|FINSI;
         |SI #caerpcf2#Campo# = "F"; aTexto = "Adquisiciones realizadas por las agencias de viajes directamente en inters del viajero";|FINSI;
         |SI #caerpcf2#Campo# = "G"; aTexto = "Rgimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #caerpcf2#Campo# = "H"; aTexto = "Rgimen especial de oro de inversi¢n"; |FINSI;
         |SI #caerpcf2#Campo# = "I"; aTexto = "Inversi¢n del Sujeto pasivo (ISP)"; |FINSI;
         |SI #caerpcf2#Campo# = "J"; aTexto = "Tiques"; |FINSI;
         |SI #caerpcf2#Campo# = "K"; aTexto = "Rectificación anotaciones registrales"; |FINSI;
         |SI #caerpcf2#Campo# = "L"; aTexto = "Adquisiciones a comerciantes minoristas del IGIC"; |FINSI;
         |SI #caerpcf2#Campo# = "P"; aTexto = "Adquisiciones intracomunitarias de bienes."; |FINSI;
         |SI #caerpcf2#Campo# = "Q"; aTexto = "Operaciones a las que se aplique el rgimen especial de bienes usados, ..."; |FINSI;
         |SI #caerpcf2#Campo# = "R"; aTexto = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
         |SI #caerpcf2#Campo# = "S"; aTexto = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
         |SI #caerpcf2#Campo# = "W"; aTexto = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
         |SI #caerpcf2#Campo# = "X"; aTexto = "Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo"; |FINSI;
         |SI #caerpcf2#Campo# = "Z"; aTexto = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
         |SI #caerpcf2#Campo# = "1"; aTexto = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
         |SI #caerpcf2#Campo# = "2"; aTexto = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
         |SI #caerpcf2#Campo# = "3"; aTexto = "IVA criterio de caja. Factura rectificativa";|FINSI;
         |SI #caerpcf2#Campo# = "4"; aTexto = "IVA criterio de caja. Adquisiciones realizadas por las agencias de viajes"; |FINSI;
         |SI #caerpcf2#Campo# = "5"; aTexto = "IVA criterio de caja. Factura simplificada"; |FINSI;
         |SI #caerpcf2#Campo# = "6"; aTexto = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
         |SI #caerpcf2#Campo# = "7"; aTexto = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
         |SI #caerpcf2#Campo# = "8"; aTexto = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
     |FINSI;

     |SI #caerpcf2#Campo# = "C"; aTexto = ""; |FINSI; || no puede elegir C, es automatico
     |SI #caerpcf2#Campo# = "*"; aTexto = "No pasa al 340"; |FINSI;

     |SI aTexto = "";
         |MENAV "0000 Clave de operaci¢n incorrecta";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA " Configuracion pase facturas OpenERP";

   |ABRE #200;
   |DDEFECTO #200;
   |LEE 041#200p;
   |CIERRA #200;

   |ABRE #caerpcfg;
   |LEE 101#caerpcfg.p;
   |SI FSalida ! 0;
      |DDEFECTO #caerpcfg;
      |GRABA 020#caerpcfg.b;
   |FINSI;

   |HAZ PintaLins;
   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#caerpcfg.a;
   |FINSI;
   |LIBERA #caerpcfg;
   |CIERRA #caerpcfg;
|FPRO;
