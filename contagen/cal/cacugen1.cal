|FICHEROS;
   cacugen1 #0;
   cacuenta #1;
   caclipro #5,MANTE;
   cacuebal #15;

   cactrlal #11;
   cafanta1 #217,MANTE;
   &regisnif@ #709;
|FIN;

|INCLUYE dscont_i;

|VARIABLES;
   Comodin     = "";
   uno         = "";
   dos         = "";
   alfa1       = "";
   nEstado     = 0;
   nAhoraAlta  = 0;
   nPara1      = 0;
   nModo       = 0;
   &enSwBUENO  = 0;

   &raf_oper    = 0;
   &raf_empresa = 0;
   &raf_periodo = 0;
   &raf_ejercic = 0;
   &raf_sw      = 0;
   &raf_clpr    = "";
   &raf_cue     = "";
   &raf_dig     = 0;
   &raf_des     = "";
   &raf_pase    = "";
   &raf_blo     = 0;
   &raf_tipo    = "";
   &raf_agru    = 0;
   &raf_epi     = 0;
   &raf_par     = 0;
   swaltas = 0;
   swraf = 0;
   alfa2 = "";

|FIN;

|CALCULO Cuenta_0;
   |ABRE #1;
   #1#0 = #0#0;
   |LEE 001#1=;
   |SI FSalida ! 0;
       |HAZ AltaEstaCta;
   |FINSI;
   |CIERRA #1;
|FCAL;

|PROCESO LeeFicha;
 |LEE 001#5=;
 nEstado = FSalida;
|FPRC;

|PROGRAMA;

    |HAZ inicio;
    |HAZ DirAplicSt;
    |QBF eaNifEmp;
    enSwBUENO = 0;
    |PUSHV 0501 2380;

    #cafanta1#0 = "";
    |PINPA #0#cafanta1;
    |PINDA #0#cafanta1;
    |ENDATOS #1#cafanta1;
    |SI FSalida ! 0;
        enSwBUENO = 1;
        |POPV;
        |ACABA;
    |FINSI;

    eaCodNif = #cafanta1#0; |QBF eaCodNif;
    |SI eaCodNif = "";
        enSwBUENO = 1;
        |POPV;
        |ACABA;
    |FINSI;

    eaNomCta   = #709#1;
    nAhoraAlta = 0;
    enSwBUENO  = 0;

    |SI eaCodNif = eaNifEmp;
        |CONFI "    NIntroducido NIF de la Empresa Actual. Continuar";
        |SI FSalida ! 0;
            enSwBUENO = 1;
            |POPV;
            |ACABA;
        |FINSI;
    |FINSI;

    eaCuenta = "F*+";  || busco por nif, con la posibidad de dar de alta
    salidas  = FSalida;
    |HAZ FiltraPuntos;
    |SI eaCuenta [ "            ";
        enSwBUENO = 1;
        |POPV;
        |ACABA;
    |FINSI;

    |DDEFECTO #0;
    #0#0 = eaCuenta;
    #0#1 = enNivel;
    #0#2 = eaCodNif;
    #0#3 = eaElCam23;

    |ABRE #5;
    |DDEFECTO #5;

    alfa1 = eaCuenta % 508;
    #5#23  = eaElCam23;
    #5#10  = #0#0;
    #5#11  = #0#1;
    |HAZ LeeFicha;
    |SI nEstado = 0;
       |LIBERA #5;
       |CIERRA #5;
       |POPV;
       |ACABA;
   |FINSI;

    |PINPA #0#5;
    |PINTA #0#0;
    |PINTA #0#2;
    #5#0   = alfa1;
    #5#9   = #709#0;
    #5#1   = #709#1;
    Comodin = #709#9; |QBF Comodin;
    |SI Comodin = "";
        #5#2 = #709#2;
    |SINO;
        #5#2 = Comodin + " " + #709#2;
    |FINSI;
    Comodin = #5#2; |QBF Comodin;
    #5#2 = Comodin + ", " + #709#3;
    Comodin = #5#2; |QBF Comodin;
    #5#2 = Comodin + " " + #709#10;
    Comodin = #5#2; |QBF Comodin;
    #5#2 = Comodin + " " + #709#11;
    #5#3 = #709#4;
    #5#4 = #709#5;
    #5#5 = #709#7;
    #5#6 = #709#6;
    #5#7 = #709#8;
    #5#8 = #709#17;
    #5#24 = #709#12;
    |SI nEstado ! 0;
        #5#44 = #5#2;
        #5#45 = #5#3;
        #5#46 = #5#4;
        #5#47 = #5#5;
        #5#48 = #5#6;
        #5#49 = #5#27;
        #5#50 = #5#25;
    |FINSI;

    |PINDA #0#5;

    |HAZ Cuenta_0;

    |ENDATOS #1#caclipro;
    |SI FSalida = 0;
        |SI nEstado ! 0; |GRABA 020#5b; |FINSI;
        |SI nEstado = 0; |GRABA 020#5a; |FINSI;
        |SI nAhoraAlta = 1; |O nEstado ! 0;  |HAZ DoyVarias; |FINSI;
    |SINO;
        enSwBUENO = 1;
        |HAZ BajaCuenta;
    |FINSI;
    |LIBERA #5;
    |CIERRA #5;
    |POPV;
    eaCuenta = #0#0;
    eaNomCta = #5#1;
|FPRO;

|PROCESO BajaCuenta;
 |SI nAhoraAlta = 1;
     |ABRE #1;
     #1#0 = #0#0;
     |LEE 001#1=;
     |SI FSalida = 0;
         nAhoraAlta = 0;
         |PARA nPara1 = 9; |SI nPara1 [ 53; |HACIENDO nPara1 = nPara1 + 1;
               |SI #1nPara1 ! 0;
                   nAhoraAlta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
         |SI nAhoraAlta = 0; |BORRA 020#1a; |FINSI;
     |FINSI;
     |CIERRA #1;
 |FINSI;
|FPRC;

|PROCESO AltaEstaCta;
         #1#0 = #0#0;
         #1#1 = #0#1;
         #1#2 = #5#1;
         #1#3 = "S";
         |HAZ eldefecto;
         || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
         alfa1 = #1#0;
         |QBF alfa1;
         alfa1 = alfa1 +"zzzzzzzzzzzz";
         alfa1 = alfa1 % 112;
         #1#54 = alfa1;
         #1#55 = #1#1;
         |GRABA 020#1n;
         nAhoraAlta = 1;
|FPRC;

|PROCESO eldefecto;
   |ABRE #15;
   uno = #1#0;
   |QBF uno;
   dos = uno + "000000000000";
   uno = dos % A101;
   #15#0 = uno;
   |LEE 040#15=;
   |SI FSalida = 0;  |HAZ sacacamps;  |ACABA;  |FINSI;
   uno = dos % A102;
   #15#0 = uno;
   |LEE 040#15=;
   |SI FSalida = 0;  |HAZ sacacamps;  |ACABA;  |FINSI;
   uno = dos % A103;
   #15#0 = uno;
   |LEE 040#15=;
   |SI FSalida = 0;  |HAZ sacacamps;  |ACABA;  |FINSI;
   uno = dos % A104;
   #15#0 = uno;
   |LEE 040#15=;
   |SI FSalida = 0;
      |HAZ sacacamps;
   |SINO;
      |CIERRA #15;
   |FINSI;
|FPRC;

|PROCESO sacacamps;
   #1#4 = #15#1;
   #1#5 = #15#2;
   #1#6 = #15#3;
   #1#7 = #15#4;
   #1#8 = #15#5;
   |CIERRA #15;
|FPRC;

|PROCESO DoyVarias;
   raf_empresa = enEmpresa;
   raf_periodo = enPeriodo;
   raf_ejercic = enAny;

   |ABRE #11;
   |DDEFECTO #11;
   |LEE 101#11p;
   |SI FSalida ! 0; swaltas = 1; |FINSI;
   |LIBERA #11;
   |CIERRA #11;
   |SI swaltas = 1; |ACABA; |FINSI;

   swraf = 1;
   alfa1 = #cactrlal#1; |QBF alfa1;
   alfa2 = #cactrlal#2; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
   alfa1 = #cactrlal#3; |QBF alfa1;
   alfa2 = #cactrlal#4; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
   alfa1 = #cactrlal#5; |QBF alfa1;
   alfa2 = #cactrlal#6; |QBF alfa2;
   |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;

   |SI swraf = 1; |ACABA; |FINSI;

   swraf = 1;
   |SI #cacuenta#0 ] #cactrlal#1; |Y #cacuenta#0 [ #cactrlal#2; swraf = 0; |FINSI;
   |SI #cacuenta#0 ] #cactrlal#3; |Y #cacuenta#0 [ #cactrlal#4; swraf = 0; |FINSI;
   |SI #cacuenta#0 ] #cactrlal#5; |Y #cacuenta#0 [ #cactrlal#6; swraf = 0; |FINSI;

   |SI swraf = 1; |ACABA; |FINSI;

      raf_oper = 1;
      raf_clpr = #caclipro#23;
      raf_cue  = #cacuenta#0;
      raf_dig  = #cacuenta#1;
      raf_des  = #cacuenta#2;
      raf_pase = #cacuenta#3;
      raf_blo  = #cacuenta#4;
      raf_tipo = #cacuenta#5;
      raf_agru = #cacuenta#6;
      raf_epi  = #cacuenta#7;
      raf_par  = #cacuenta#8;

      |SUB_EJECUTA_NP "caltacta.tab";
|FPRC;
