|FICHEROS;
    caliquid #0;
    camaniva #1;
    caivalin #2;
    caivam03 #105;
    caivaasi #4;
    caconimp #8;

    camacc01 #501;
    camacc02 #502;
    camacc03 #503;

    canempre #30;
    caselem1 #998;
    caw00050 #999;  || Temporal para Informe
    cawdatos #900;

    :/modelos/def/dsmom007 #307;
    :/modelos/def/dsmom030 #330;
    :/modelos/def/dsmociva #300;
    :/modelos/def/dsmom117 #317;

    catra303 #303;
    catr1303 #304;
|FIN;

|VARIABLES;

    mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    aFichero = "";
    informe  = "caliquid";
    inform1  = "camod303";

    aAlfa1 = "";
    aAlfa2 = "";
    nNume1 = 0;
    nNume2 = 0;
    nNume3 = 0;
    nCampo1 = 0;
    nCampo2 = 0;
    nCampo3 = 0;
    inver1 = "";
    inver2 = "";
    sw_impr = 0;
    aTipo  = "";
    aDTipo = " ";
    aHTipo = "z";
    aDeduc = "";
    aInver = "";
    aIvRe  = "";           || Iva
    nNumero = 0;
    nCRep   = 0;
    nCSop   = 0;

    &nTipo  = 0;
    &nBase  = 0;
    &nCuota = 0;
    &nTot1  = 0;
    &nTot2  = 0;
    &swTLin = 0;

    &aText  = "";
    &aTexr  = "";
    aText1  = "";
    aText2  = "";
    &aDescr = "";

    &nTCuoRep = 0;
    &nTBasnR  = 0;
    &nTBasRep = 0;
    &nTCuoSop = 0;
    &nTBasnS  = 0;
    &nTBasSop = 0;

    &nBaseRR  = 0;
    &nBaseRS  = 0;
    &nCuotaRR = 0;
    &nCuotaRS = 0;

    nSwEsta   = 0;
    nEjerAnt  = 0;

    nPLiq     = 0;
    nDPLiq    = 0;
    nHPLiq    = 0;

    nDPFra    = 0;
    nHPFra    = 0;

    &nModelo   = 0;
    &nPeriodo  = 0;
    &nComplem  = 0;
    &nActividad = 0;
    nCampo11    = 0;
    nCampo22    = 0;
    nCampo33    = 0;
    nValor1     = 0;
    nValor2     = 0;
    nGrupo      = 0;
    nSubGrupo   = 0;
    nSwAcum     = 0;
    nDesde      = 0;
    nHasta      = 0;
    nContador   = 0;
    nResult     = 0;
    nIVA        = 0;
    nIVA7       = 0;
    nIVA10      = 0;
    nIVA13      = 0;
    nIVA16      = 0;
    nIVA19      = 0;
    nIVA22      = 0;
    nIVA25      = 0;
    nIVA28      = 0;
    nIVA31      = 0;
    nSubeIVA    = 0;

    nPorce      = 0;
    nBaseImpo   = 0;
    nEjerCobro  = 0;

    &enBase     = 0;
    &enBaseI    = 0;
    &enCuota    = 0;
    &enCuotaI   = 0;
    &enPorce    = 0;
    &enPorceI   = 0;
    &enSwLinea  = 0;
    nPrint      = 0;
    nEjerCarga  = 0;
    nCasilla    = 0;
    nMas        = 0;

    nPara1 = 0;
    nPara2 = 0;
    nPara3 = 0;
   &eaHora    = "";
   aHora      = "";
   &nConcepto = 0;
   fDFecha    = @;

     nHayCaja   = 0
     nBaseCaja  = 0;
     nCuotaCaja = 0;
     nBaseCajD  = 0;
     nCuotaCajD = 0;
     nSw105     = 0;
     aMulDep    = "";
     nDdepar    = 0;
     nHdepar    = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoiv_i;

____________________________________/ CALCULOS DE PANTALLA
|CALCULO PerLiq; |TIPO 0;
 |SI #0Campo = 0;
     |C_M #0#3,1,"S";
     |C_M #0#4,1,"S";
 |SINO;
     |C_M #0#3,1,"N";
     |C_M #0#4,1,"N";
 |FINSI;
|FCAL;

|CALCULO defectos; |TIPO 7;
  |HAZ eParaModelos;
  fDFecha = fec1;
  |SI enSwSelFc = 1; fDFecha = "01.01.2000"; |FINSI;
  #0#3 = fDFecha; |PINTA #0#3;
  #0#4 = fec2; |PINTA #0#4;
  |SI PARAMETRO = "AGENCIA"; |O enEjercicio < 2009;
      #0#14 = "R"; |C_M #0#14, 1, "N"; |C_V #0#14,1, "N";
      |PINTA 1456, "            ";
  |FINSI;
|FCAL;

|CALCULO fechad;
  fDFecha = fec1;
  |SI enSwSelFc = 1; fDFecha = "01.01.2000"; |FINSI;
  |SI #0#3 < fDFecha; |O #0#3 > fec2;
      |MENAV mensa1;
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO fechah;
  fDFecha = fec1;
  |SI enSwSelFc = 1; fDFecha = "01.01.2000"; |FINSI;
  |SI #0#4 < fDFecha; |O #0#4 > fec2; |O #0#4 < #0#3;
      |MENAV mensa1;
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO libroh;
  |SI #0#1 < #0#0;
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO TrasLiq; |TIPO 0;

 |SI #0#5 ! 99; |Y #0#5 > 12; |ERROR; |ACABA; |FINSI;

 |C_M #0#11,1,"N";
 |SI #0Campo = 99;  |C_M #0#11,1,"S"; |FINSI;

 |SI #0#5 ! 0;
    |ABRE #4;
    |LEE 040#4p;
    |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
    |CIERRA #4;

    aAlfa1 = "31.12.";
    |SI enEjercicio [ 2009;
        |SI #4#46 = "T";
            |SI #0#5 = 1; aAlfa1 = "31.03."; |FINSI;
            |SI #0#5 = 2; aAlfa1 = "30.06."; |FINSI;
            |SI #0#5 = 3; aAlfa1 = "30.09."; |FINSI;
            |SI #0#5 = 4; aAlfa1 = "31.12."; |FINSI;
            |SI #0#5 = 99; aAlfa1 = "31.12."; |FINSI;
        |FINSI;
        |SI #4#46 = "M";
            |SI #0#5 = 1; aAlfa1 = "31.01."; |FINSI;
            |SI #0#5 = 2; aAlfa1 = "29.02."; |FINSI;
            |SI #0#5 = 3; aAlfa1 = "31.03."; |FINSI;
            |SI #0#5 = 4; aAlfa1 = "30.04."; |FINSI;
            |SI #0#5 = 5; aAlfa1 = "31.05."; |FINSI;
            |SI #0#5 = 6; aAlfa1 = "30.06."; |FINSI;
            |SI #0#5 = 7; aAlfa1 = "31.07."; |FINSI;
            |SI #0#5 = 8; aAlfa1 = "31.08."; |FINSI;
            |SI #0#5 = 9; aAlfa1 = "30.09."; |FINSI;
            |SI #0#5 = 10; aAlfa1 = "31.10."; |FINSI;
            |SI #0#5 = 11; aAlfa1 = "30.11."; |FINSI;
            |SI #0#5 = 12; aAlfa1 = "31.12."; |FINSI;
            |SI #0#5 = 99; aAlfa1 = "31.12."; |FINSI;
        |FINSI;
    |SINO;
        |SI #4#46 = "T";
            |SI #0#5 = 1;  |O #0#5 = 2;  |O #0#5 = 3;  aAlfa1 = "31.03."; |FINSI;
            |SI #0#5 = 4;  |O #0#5 = 5;  |O #0#5 = 6;  aAlfa1 = "30.06."; |FINSI;
            |SI #0#5 = 7;  |O #0#5 = 8;  |O #0#5 = 9;  aAlfa1 = "30.09."; |FINSI;
            |SI #0#5 = 10; |O #0#5 = 11; |O #0#5 = 12; aAlfa1 = "31.12."; |FINSI;
            |SI #0#5 = 99; aAlfa1 = "31.12."; |FINSI;
        |FINSI;
        |SI #4#46 = "M";
            |SI #0#5 = 1; aAlfa1 = "31.01."; |FINSI;
            |SI #0#5 = 2; aAlfa1 = "29.02."; |FINSI;
            |SI #0#5 = 3; aAlfa1 = "31.03."; |FINSI;
            |SI #0#5 = 4; aAlfa1 = "30.04."; |FINSI;
            |SI #0#5 = 5; aAlfa1 = "31.05."; |FINSI;
            |SI #0#5 = 6; aAlfa1 = "30.06."; |FINSI;
            |SI #0#5 = 7; aAlfa1 = "31.07."; |FINSI;
            |SI #0#5 = 8; aAlfa1 = "31.08."; |FINSI;
            |SI #0#5 = 9; aAlfa1 = "30.09."; |FINSI;
            |SI #0#5 = 10; aAlfa1 = "31.10."; |FINSI;
            |SI #0#5 = 11; aAlfa1 = "30.11."; |FINSI;
            |SI #0#5 = 12; aAlfa1 = "31.12."; |FINSI;
            |SI #0#5 = 99; aAlfa1 = "31.12."; |FINSI;
        |FINSI;
    |FINSI;
    |SI #0#5 = 1;   #0#15 = "ENERO     ";  |FINSI;
    |SI #0#5 = 2;   #0#15 = "FEBRERO   ";  |FINSI;
    |SI #0#5 = 3;   #0#15 = "MARZO     ";  |FINSI;
    |SI #0#5 = 4;   #0#15 = "ABRIL     ";  |FINSI;
    |SI #0#5 = 5;   #0#15 = "MAYO      ";  |FINSI;
    |SI #0#5 = 6;   #0#15 = "JUNIO     ";  |FINSI;
    |SI #0#5 = 7;   #0#15 = "JULIO     ";  |FINSI;
    |SI #0#5 = 8;   #0#15 = "AGOSTO    ";  |FINSI;
    |SI #0#5 = 9;   #0#15 = "SEPTIEMBRE";  |FINSI;
    |SI #0#5 = 10;  #0#15 = "OCTUBRE   ";  |FINSI;
    |SI #0#5 = 11;  #0#15 = "NOVIEMBRE ";  |FINSI;
    |SI #0#5 = 12;  #0#15 = "DICIEMBRE ";  |FINSI;
    |SI #0#5 = 99;  #0#15 = "ANUAL     ";  |FINSI;

    aAlfa2 = enEjercicio;
    aAlfa1 = aAlfa1 + enEjercicio;
    fDFecha = fec1;
    |SI enSwSelFc = 1; fDFecha = "01.01.2000"; |FINSI;
    #0#3 = fDFecha; |PINTA #0#3;
    #0#4 = aAlfa1;  |PINTA #0#4;
 |FINSI;
|FCAL;

|CALCULO nodepar; |TIPO 7;
   |C_M #0#42, 1, eaDepar;
   |C_M #0#43, 1, eaDepar;
|FCAL;

|PROCESO DatosEmp; |TIPO 7;
 |ABRE #8;
 |DDEFECTO #8;
 #8#0 = 1;
 |LEE 011#8=;
 |CIERRA #8;
 #0#13 = #8#7; |PINTA #0#13;
 aAlfa1 = #8#8; |C_M #0#13,1,aAlfa1;

 aAlfa1 = "S";
 |SI #8#18 = "N"; |O #8#19 = "N"; aAlfa1 = "N"; |FINSI;
 |C_M #0#37, 1, aAlfa1;
 |C_M #0#38, 1, aAlfa1;
 |SI #8#18 = "N";
     |C_V #0#37, 1, aAlfa1;
     |C_V #0#38, 1, aAlfa1;
     |PINTA 1940, "                          ";
 |SINO;
     |HAZ PonHora;
 |FINSI;
|FPRC;

|PROCESO PonHora; |TIPO 7;
     |C_M #0#37, 0 , aAlfa1;
     |SI aHora = ""; |O aAlfa1 = "N";
         |HORA aHora;
         aAlfa1 = aHora % 102;  #0#37 = aAlfa1;  |PINTA #0#37;
         aAlfa1 = aHora % 402;  #0#38 = aAlfa1;  |PINTA #0#38;
     |FINSI;
|FPRC;

|PROCESO Formato;
  aAlfa1 = "S";
  |SI #0Campo = "M"; aAlfa1 = "N"; |FINSI;
  |C_M #0#39, 1, aAlfa1;
|FPRC;

||**********************************************************************
|PROCESO EjerCarga;
    nEjerCarga = #317#8;
|FPRC;

|DEFBUCLE EjerCarga;
  #317#1;
  ;
  2011,        1, 00;
  enEjercicio, 1, 01;
  ;
  NULL, EjerCarga;
|FIN;


|CALCULO imprimir; |TIPO 3;
   eaHora = (("00" + #0#37) % -102) + ":" + (("00" + #0#38) % -102):
   eaHora = "Hora: " + eaHora;
   |SI #8#18 = "N"; eaHora = ""; |FINSI;

   aFichero = ("iva" + Usuario) % 108; |NOME_DAT #999 aFichero;
   aFichero = ("0m"  + Usuario) % 108; |NOME_DAT #300 aFichero;

   |SI PARAMETRO = "AGENCIA";
      Impresora = "CrystalReport";
      |IMPRE -1;
   |SINO;
      |IMPRE 0;
   |FINSI;
   |SI FSalida ! 0;  |ACABA;  |FINSI;
   aAlfa1 = Impresora;
   aAlfa1 = aAlfa1 % 113;
   |SI aAlfa1 = "CrystalReport";
       informe = "ccliquid";
   |SINO;
       informe = "caliquid";
   |FINSI;

   |SI enEjercicio [ 2008;
       inform1 = "camod303";
   |SINO;
       inform1 = "camo1303";
       |SI enEjercicio ] 2014;
           inform1 = "camo2303";
       |FINSI;
   |FINSI;

   enDatos = 0; |SI #0#13 = "S"; enDatos = 1; |FINSI;

   inver1 = #0#7; inver2 = #0#7;
   |SI #0#7 = "A"; inver1 = " "; inver2 = "z"; |FINSI;

   nEjerCarga = 2010;
   |SI enEjercicio ] 2011;
       |BUCLE EjerCarga;
   |FINSI;

   |SI Haybasica = 1;
       |SI #0#42 = "  "; #0#42 = "00"; |FINSI;
       |SI #0#43 = "zz"; #0#43 = "99"; |FINSI;
   |FINSI;

   |SI #48#27 = "S";
       |HAZ MultiEmpresa;
   |SINO;
       |DFICE dirfich0; |QBF dirfich0;
       |HAZ HazTodo;
   |FINSI;
   |FINIMP;
   |DELINDEX #999;
|FCAL;

|PROCESO EsDeCaja;
      enSwCaja = 0;
      |SI enEjercicio ] 2014;
         |SI #camaniva#42 = "Z"; |O #camaniva#42 = "1"; |O #camaniva#42 = "2";
             |O #camaniva#42 = "3"; |O #camaniva#42 = "4"; |O #camaniva#42 = "5";
             |O #camaniva#42 = "6"; |O #camaniva#42 = "7"; |O #camaniva#42 = "8";
                enSwCaja = 1;
         |FINSI;

         |SI enSwCaja = 1;
             |ABRE #501;
             |DDEFECTO #501;
             #501#0  = #camaniva#0;
             #501#1  = #camaniva#1;
             #501#17 = nEjerCobro;
             |LEE 040#501=;
             |SI FSalida ! 0;  enSwCaja = 0;  |FINSI;
             |CIERRA #501;
         |FINSI;
    |FINSI;
|FPRC;
|| *********************************************************************
|PROCESO GrabaTemporal;
  |DDEFECTO #999;
  #999#0 = nConcepto;
  #999#1 = aTipo;
  #999#2 = aDeduc;
  #999#3 = aInver;
  #999#4 = aIvRe;
  #999#5 = nTipo; |SI #999#0 = 999;|O #999#0 = 998;  #999#5 = 0; |FINSI;
  |LEE 101#999=;
  |SI FSalida = 0;
      nNumero = #999#8;
  |SINO;
      |SI aTipo = "R"; nCRep = nCRep + 1; nNumero = nCRep; |FINSI;
      |SI aTipo = "S"; nCSop = nCSop + 1; nNumero = nCSop; |FINSI;
      #999#0 = nConcepto;
      #999#1 = aTipo;
      #999#2 = aDeduc;
      #999#3 = aInver;
      #999#4 = aIvRe;
      #999#5 = nTipo; |SI #999#0 = 999;|O #999#0 = 998;  #999#5 = 0; |FINSI;
      |GRABA 020#999b;
  |FINSI;
  #999#6 = #999#6 + nBase;
  #999#7 = #999#7 + nCuota;
  #999#8 = nNumero;
  |GRABA 020#999a;
  |LIBERA #999;
  sw_impr = 1;
|FPRC;

||************************************************************************
|PROCESO PonCasilla;

     |SI enSwCaja = 1;
         |SI nGrupo = 1;  nSubGrupo = 16; |FINSI;
         |SI nGrupo = 3;  nSubGrupo = 17; |FINSI;
     |FINSI;

     |SI enEjercicio ] 2015;
         |SI nGrupo = 1;  |Y nSubGrupo = 5; |Y nSw105 = 1;
             nSubGrupo = 19;
         |FINSI;
         |SI nGrupo = 1;  |Y nSubGrupo = 15; |Y nSw105 = 1;
             nSubGrupo = 19;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 5; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 6; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
         |SI nGrupo = 2;  |Y nSubGrupo = 13; |Y nSw105 = 1;
             nSubGrupo = 17;
         |FINSI;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = nGrupo;
     #300#7  = nSubGrupo;
     |LEE 101#300=;
     |SI FSalida = 0;
          |SI #300#11 = 0;
              |SI nPorce = 0;  |Y nCuota = 0;  |ACABA;  |FINSI;
              nSwEsta = 0;
              |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
                    nCampo1 = nCampo2 - 1;
                    nCampo3 = nCampo2 + 1;
                    |SI #300nCampo2 = nPorce;
                        #300nCampo1 = #300nCampo1 + nBaseImpo;
                        #300nCampo2 = nPorce;
                        #300nCampo3 = #300nCampo3 + nCuota;
                        nSwEsta = 1;
                        |SAL;
                    |FINSI;
              |SIGUE;

              |SI nSwEsta = 0;
                  |PARA nCampo2 = 15;  |SI nCampo2 [ 33;  |HACIENDO nCampo2 = nCampo2 + 3;
                        nCampo1 = nCampo2 - 1;
                        nCampo3 = nCampo2 + 1;
                        |SI #300nCampo2 = 0; |Y #300nCampo1 = 0;  |Y #300nCampo3 = 0;
                            #300nCampo1 = #300nCampo1 + nBaseImpo;
                            #300nCampo2 = nPorce;
                            #300nCampo3 = #300nCampo3 + nCuota;
                            nSwEsta = 1;
                            |SAL;
                        |FINSI;
                  |SIGUE;
              |FINSI;

              |SI nSwEsta = 0;
                  #300#32 = #300#32 + nBaseImpo;
                  #300#33 = 0;
                  #300#34 = #300#34 + nCuota;
              |FINSI;

              #300#12 = #300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32;
              #300#13 = #300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34;
          |SINO;
              #300#12 = #300#12 + nBaseImpo;
          |FINSI;

          |GRABA 020#300a;
          |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Grupo1;
     nBaseImpo = #caivalin#6;
     nPorce    = #caivalin#7;
     nCuota    = #caivalin#8;
     nGrupo    = 1;
     nSubGrupo = #330#26;
     |SI enEjercicio ] 2014; |Y nSubGrupo = 6;
         |SI #dsmom030#72 = "S"; nSubGrupo = 15; |FINSI;
     |FINSI;

     |SI enSwCaja = 1;
         |SI #0#5 = 00;
             nBaseImpo = nBaseCajD;
             nCuota    = nCuotaCajD;
         |SINO;
             |SI #0#5 ! 99; |O #0#11 = "S";
                 nBaseImpo = nBaseCaja;
                 nCuota    = nCuotaCaja;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ PonCasilla;

     |SI #caivalin#10 ! 0;
         nBaseImpo = #caivalin#6;
         nPorce    = #caivalin#9;
         nCuota    = #caivalin#10;
         nGrupo    = 1;
         nSubGrupo = 10;
         |SI #dsmom030#26 = 7;  nSubGrupo = 11; |FINSI;
         |SI #dsmom030#26 = 8;  nSubGrupo = 12; |FINSI;
         |SI #dsmom030#26 = 17; nSubGrupo = 11; |FINSI;
         |SI #dsmom030#26 = 19; nSubGrupo = 11; |FINSI;
         |SI #dsmom030#26 = 18; nSubGrupo = 20; |FINSI;
         |HAZ PonCasilla;
     |FINSI;

     |SI #330#74 = "S"; |Y #330#0 > 800;
         nCuota  = (nBaseImpo % #330#75) ! EURODB;
         nPorce  = #330#75;
         nGrupo    = 2;
         nSubGrupo = 11;
         |HAZ PonCasilla;
     |FINSI;
|FPRC;

|PROCESO Grupo2;
     nBaseImpo = #caivalin#6;
     nPorce    = #caivalin#7;
     nCuota    = #caivalin#8;
     nGrupo    = 2;
     nSubGrupo = #330#28;
     |SI enSwCaja = 1;
         |SI #0#5 = 00;
             nBaseImpo = nBaseCajD;
             nCuota    = nCuotaCajD;
         |SINO;
             |SI #0#5 ! 99; |O #0#11 = "S";
                 nBaseImpo = nBaseCaja;
                 nCuota    = nCuotaCaja;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo3;
     nBaseImpo = #caivalin#6;
     nPorce    = #caivalin#7;
     nCuota    = #caivalin#8;
     nGrupo    = 8;
     nSubGrupo = #330#30;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo4;
     nBaseImpo = #caivalin#6;
     nPorce    = #caivalin#7;
     nCuota    = #caivalin#8;
     nGrupo    = 9;
     nSubGrupo = #330#32;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo5;
     nBaseImpo = #caivalin#6;
     nPorce    = #caivalin#7;
     nCuota    = #caivalin#8;
     nGrupo    = 3;
     nSubGrupo = #330#34;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo6;
     nBaseImpo = #caivalin#6;
     nPorce    = #caivalin#7;
     nCuota    = #caivalin#8;
     nGrupo    = 4;
     nSubGrupo = #330#36;
     |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo9_R;
         nBaseImpo = #caivalin#6;
         nPorce    = #caivalin#7;
         nCuota    = #caivalin#8;
         nGrupo    = 4;
         nSubGrupo = 17;
         |HAZ PonCasilla;
|FPRC;

|PROCESO Grupo9_S;
         nBaseImpo = #caivalin#6;
         nPorce    = #caivalin#7;
         nCuota    = #caivalin#8;
         nGrupo    = 4;
         nSubGrupo = 18;
         |HAZ PonCasilla;
|FPRC;
||************************************************************************

|| ......................
|PROCESO LosCobros;

     |SI nEjerCobro ! 0;
         |SI #502#9 ! 0; |Y #502#9 ! enEjercicio;
             |ACABA;
         |FINSI;
     |FINSI;

     nHayCaja = 1;
     |DDEFECTO #503;
     |LIBERA #503;
     #503#7 = #502#17;
     #503#0 = #502#0;
     #503#1 = #502#1;
     #503#2 = #502#2;
     #503#3 = #caivalin#2;
     |LEE 041#503=;
     |SI FSalida = 0;
         nBaseCaja  = (nBaseCaja  + #503#5) ! EURODB;
         nCuotaCaja = (nCuotaCaja + #503#6) ! EURODB;

         |SI #0#5 = 0; |Y #502#8 = 0;
             nBaseCajD  = (nBaseCajD  + #503#5) ! EURODB;
             nCuotaCajD = (nCuotaCajD + #503#6) ! EURODB;
         |FINSI;
     |FINSI;
     |LIBERA #502;
|FPRC;

|DEFBUCLE LosCobros;
     #502#1;
     8,7;
     nEjerCobro, #camaniva#0, #camaniva#1, 01, nDPLiq, nDPFra;
     nEjerCobro, #camaniva#0, #camaniva#1, 99, nHPLiq, nHPFra;
     e;
     NULL, LosCobros;
|FIN;
||************************************************************************

|PROCESO LineasFactura;
  aAlfa1 = #caivalin#30; |QBF aAlfa1;
  |SI aAlfa1 = "";
      #caivalin#30 = #camaniva#10;
  |FINSI;
  |SI aMulDep = "S";
      |SI Haybasica = 1;
          nDepar  = #caivalin#30; |SI nDepar = 0;  nDepar = 1;   |FINSI;
          nDdepar = #0#42;
          nHdepar = #0#43;
          |SI nDepar < nDdepar; |O nDepar > nHdepar; |ACABA; |FINSI;
      |SINO;
          |SI #caivalin#30 < #0#42;  |O #caivalin#30 > #0#43;  |ACABA;  |FINSI;
      |FINSI;
  |FINSI;

  nBaseCaja  = 0; nBaseCajD  = 0;
  nCuotaCaja = 0; nCuotaCajD = 0;
  |SI enSwCaja = 1;    || suma el importe de lo cobrado
      |ABRE #503;
      |BUCLE LosCobros;
      |CIERRA #503;
      |SI nEjerCobro ! 0;
          |SI nBaseCaja = 0; |Y nCuotaCaja = 0;
              |ACABA;
          |FINSI;
      |FINSI;
  |FINSI;

  #caivalin#5 = #caivalin#5 > " ";
  |SI #caivalin#5 ! "S"; |Y #caivalin#5 ! "N";
      #caivalin#5 = "S";
  |FINSI;

  aTipo  = #camaniva#36;  || Repercutido/Soportado
  aDeduc = #caivalin#5;   || Deducible / O no
  aInver = #caivalin#17;  || Inversion

  aIvRe  = "I";           || Iva
  nTipo  = #caivalin#7;   ||  % IVA
  nBase  = #caivalin#6;   || Base IVA
  nCuota = #caivalin#8;   || Cuota

  |SI enSwCaja = 1;
      |SI #0#5 = 00;
          nBase  = nBaseCajD;
          nCuota = nCuotaCajD;
      |SINO;
          |SI #0#5 ! 99; |O #0#11 = "S";
              nBase  = nBaseCaja;
              nCuota = nCuotaCaja;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI enSwCaja = 0;
      |SI nBase = 0; |Y nCuota = 0; |ACABA; |FINSI;
  |FINSI;

  nConcepto = 001;
  |SI #0#39 = "S";
      |SI #camaniva#42 ! "I";
          |SI #caivalin#25 = "S"; nConcepto = 999; |FINSI;
      |SINO;
          nConcepto = 998;
      |FINSI;
  |FINSI;

  |HAZ GrabaTemporal;

  |SI #caivalin#9 ! 0;    || Existe Tanto por cien de Recargo
      aTipo  = #camaniva#36;  || Repercutido/Soportado
      aDeduc = #caivalin#5;   || Deducible / O no
      aInver = #caivalin#17;  || Inversion
      aIvRe  = "R";           || Recargo
      nTipo  = #caivalin#9;   ||  % IVA
      nBase  = #caivalin#6;   || Base IVA
      nCuota = #caivalin#10;  || Cuota
      |HAZ GrabaTemporal;
  |FINSI;

 |SI #caivalin#18 ! 0; |Y nEjerCobro = 0;
     |SI #camaniva#36 = "S";
         nBaseRS  = nBaseRS  + #caivalin#20;
         nCuotaRS = nCuotaRS + #caivalin#22;
     |SINO;
         nBaseRR  = nBaseRR  + #caivalin#20;
         nCuotaRR = nCuotaRR + #caivalin#22;
     |FINSI;
 |FINSI;

 |SI #camaniva#36 = "S"; |Y #caivalin#5 = "N"; |ACABA; |FINSI;

 |SI #0#14 = "M";
     #330#0 = #caivalin#3;
     |LEE 040#330=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #330#4 = "N";  |ACABA;  |FINSI;
     |SI #330#26 ! 0; |HAZ Grupo1;  |FINSI;
     |SI #330#28 ! 0; |HAZ Grupo2;  |FINSI;
     |SI #330#30 ! 0; |HAZ Grupo3;  |FINSI;
     |SI #330#32 ! 0; |HAZ Grupo4;  |FINSI;
     |SI #330#34 ! 0; |HAZ Grupo5;  |FINSI;
     |SI #330#36 ! 0; |HAZ Grupo6;  |FINSI;
     |SI enSwCaja = 1; |Y nEjerCobro = 0;
         |SI #camaniva#36 = "R"; |HAZ Grupo9_R; |FINSI;
         |SI #camaniva#36 = "S"; |HAZ Grupo9_S; |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE LineasFactura;
   #caivalin#1;
   17;
   #camaniva#0,#camaniva#1,01,inver1;
   #camaniva#0,#camaniva#1,99,inver2;
   ;
   NULL,LineasFactura;
|FIN;

|PROCESO Facturas;
  |SI aMulDep ! "S";
      |SI Haybasica = 1;
          nDepar  = #camaniva#10; |SI nDepar = 0;  nDepar = 1;   |FINSI;
          nDdepar = #0#42;
          nHdepar = #0#43;
          |SI nDepar < nDdepar; |O nDepar > nHdepar; |ACABA; |FINSI;
      |SINO;
          |SI #camaniva#10 < #0#42;  |O #camaniva#10 > #0#43;  |ACABA;  |FINSI;
      |FINSI;
  |FINSI;

  enSwCaja   = 0;
  nEjerCobro = 0;
  nSw105 = 0;
  |ABRE #105;
  |DDEFECTO #105;
  #105#0 = #camaniva#0;
  #105#1 = #camaniva#1;
  |LEE 040#105=;
  |SI FSalida = 0;
       nSw105 = 1;
       |SI #105#8 = 1; nSw105 = 0; |FINSI;
   |FINSI;
   |CIERRA #105;

  |SI #camaniva#36 = "S"; |O #camaniva#36 = "R";

      |SI enEjercicio ] 2014;
          |HAZ EsDeCaja;
          |SI enSwCaja = 0;   || No es de caja
              |SI #0#5 ! 0;  |Y #0#5 ! 99;   |Y #camaniva#40 < nDPLiq; |ACABA; |FINSI;
              |SI #0#5 = 0;                  |Y #camaniva#40 ! 0;      |ACABA; |FINSI;
              |SI #0#5 = 99; |Y #0#11 = "S"; |Y #camaniva#40 = 0;      |ACABA; |FINSI;
          |FINSI;
      |FINSI;

      |BUCLE LineasFactura;
  |FINSI;
|FPRC;

|DEFBUCLE FrasTodas;  ||Fecha Factura
   #camaniva#1;
   4,40,5;
   #0#0, 0000000001, #0#3, nPLiq,  nDPFra;
   #0#1, 9999999999, #0#4, nHPLiq, nHPFra;
   e;
   NULL,Facturas;
|FIN;

|PROCESO Lee501_14;
  ePerioCaja = #501#18; |HAZ ePathCaja;
  |PATH_DAT #1 ePathCaja;
  |PATH_DAT #2 ePathCaja;
  |PATH_DAT #105 ePathCaja;

  |ABRE #1;
  #1#0 = #501#0;
  #1#1 = #501#1;
  |LEE 041#1=;
  |SI FSalida ! 0;
      |CIERRA #1;
      |ACABA;
  |FINSI;

  nSw105     = 0;
  enSwCaja   = 1;
  nEjerCobro = #501#17;

  |BUCLE LineasFactura;
|FPRC;

|DEFBUCLE Lee501_14;
    #501#1;
    ;
    nEjerCobro, #0#0, 0000000001;
    nEjerCobro, #0#1, 9999999999;
    e;
    NULL, Lee501_14;
|FIN;
|| -------------------------------------------------
|PROCESO LeeCasilla;
     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = nGrupo;
     #300#7  = nSubGrupo;
     |LEE 040#300=;
     |SI FSalida ! 0;  |DDEFECTO #300;  |FINSI;
|FPRC;

|PROCESO Suma0;
   |PARA nPara1 = 14; |SI nPara1 [ 32; |HACIENDO nPara1 = nPara1 + 3;
         nPara2 = nPara1 + 1;
         nPara3 = nPara1 + 2;
         nBaseImpo = #300nPara1;
         nPorce    = #300nPara2;
         nCuota    = #300nPara3;

      |SI nBaseImpo ! 0; |O nCuota ! 0;
         nSwEsta = 0;
         |PARA nCampo2 = 17;  |SI nCampo2 [ 35;  |HACIENDO nCampo2 = nCampo2 + 3;
               nCampo1 = nCampo2 - 1;
               nCampo3 = nCampo2 + 1;
               |SI #0nCampo2 = nPorce;
                   #0nCampo1 = #0nCampo1 + nBaseImpo;
                   #0nCampo2 = nPorce;
                   #0nCampo3 = #0nCampo3 + nCuota;
                   nSwEsta = 1;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nSwEsta = 0;
            |PARA nCampo2 = 17;  |SI nCampo2 [ 35;  |HACIENDO nCampo2 = nCampo2 + 3;
                 nCampo1 = nCampo2 - 1;
                 nCampo3 = nCampo2 + 1;
                 |SI #0nCampo2 = 0; |Y #0nCampo1 = 0;  |Y #0nCampo3 = 0;
                     #0nCampo1 = #0nCampo1 + nBaseImpo;
                     #0nCampo2 = nPorce;
                     #0nCampo3 = #0nCampo3 + nCuota;
                     nSwEsta = 1;
                     |SAL;
                 |FINSI;
            |SIGUE;
         |FINSI;

         |SI nSwEsta = 0;
             #0#34 = #0#34 + nBaseImpo;
             #0#35 = 0;
             #0#36 = #0#36 + nCuota;
         |FINSI;

     |FINSI;
  |SIGUE;
|FPRC;

|PROCESO HazCasilla;

    |PDEFECTO #0, 16, 37;
    nCasilla = nSubGrupo;

    |HAZ LeeCasilla;
    |PARA nCampo1 = 14; |SI nCampo1 [ 34; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2   = nCampo1 + 2;
          #0nCampo2 = #300nCampo1;
    |SIGUE;

    |SI nMas = 1;
        |SI nCasilla = 1;
            nSubGrupo = 13; |HAZ LeeCasilla; |HAZ Suma0;
            nSubGrupo = 14; |HAZ LeeCasilla; |HAZ Suma0;
        |FINSI;

        |SI nCasilla = 2;
            nSubGrupo = 15; |HAZ LeeCasilla; |HAZ Suma0;
        |FINSI;
    |FINSI;
    |SI nMas = 2;
        nSubGrupo = 2;  |HAZ LeeCasilla; |HAZ Suma0;
        nSubGrupo = 3;  |HAZ LeeCasilla; |HAZ Suma0;
        nSubGrupo = 6;  |HAZ LeeCasilla; |HAZ Suma0;
        nSubGrupo = 7;  |HAZ LeeCasilla; |HAZ Suma0;
        nSubGrupo = 8;  |HAZ LeeCasilla; |HAZ Suma0;
        nSubGrupo = 14; |HAZ LeeCasilla; |HAZ Suma0;
    |FINSI;
    |SI nMas = 3;
        nSubGrupo = 11; |HAZ LeeCasilla; |HAZ Suma0;
        nSubGrupo = 12; |HAZ LeeCasilla; |HAZ Suma0;
    |FINSI;

    |PARA nCampo1 = 14; |SI nCampo1 [ 34; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2   = nCampo1 + 2;
          #300nCampo1 = #0nCampo2;
    |SIGUE;
|FPRC;

|PROCESO MiroCiva;
     nMas = 0;
     |SI nGrupo = 2;
        |SI nSubGrupo = 1; |O nSubGrupo = 2;  nMas = 1; |FINSI;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 1;
         nMas = 2;
     |FINSI;
     |SI nGrupo = 1; |Y nSubGrupo = 10;
         nMas = 3;
     |FINSI;

     |HAZ HazCasilla;

     |PARA nCampo1 = 14; |SI nCampo1 [ 53; |HACIENDO nCampo1 = nCampo1 + 3;

           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           |SI #300nCampo1 ! 0; |O #300nCampo3 ! 0;
               enBaseI  = #300nCampo1;
               enPorceI = #300nCampo2;
               enCuotaI = #300nCampo3;

               |SI nGrupo = 1;
                   |SI enPorceI = enPorce; |O enPorce = 0;
                       enSwLinea = 6; |PRINT;
                       aTexr = "";
                   |SINO;
                       |SI enPorceI = 16; |O enPorceI = 18; |O enPorceI = 21;
                           |SI enPorce ] 15; |Y enPorce < 22;
                               enSwLinea = 6; |PRINT;
                               aTexr = "";
                          |FINSI;
                       |SINO;
                          |SI enPorceI = 7; |O enPorceI = 8; |O enPorceI = 10;
                              |SI enPorce ] 6; |Y enPorce < 11;
                                  enSwLinea = 6; |PRINT;
                                  aTexr = "";
                               |FINSI;
                          |SINO;
                              |SI enPorceI = 4; |O enPorceI = 5.20;
                                  |SI enPorce ] 3; |Y enPorce < 5.50;
                                      enSwLinea = 6; |PRINT;
                                      aTexr = "";
                                  |FINSI;
                              |SINO;
                                  |SI enPorceI = 1; |O enPorceI = 1.40;
                                      |SI enPorce ] 0.80; |Y enPorce < 1.60;
                                          enSwLinea = 6; |PRINT;
                                          aTexr = "";
                                      |FINSI;
                                  |FINSI;
                              |FINSI;
                          |FINSI;
                      |FINSI;
                   |FINSI;
               |SINO;
                   enSwLinea = 6; |PRINT;
                   aTexr = "";
               |FINSI;
          |FINSI;

     |SIGUE;
|FPRC;
|| ////////////////////////////////////////////////////////////////
|PROCESO Total1_9;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 2;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 3;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 4;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 5;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 6;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 7;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 8;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 14;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     |SI enEjercicio ] 2014;
         nGrupo    = 1;  nSubGrupo = 15;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;

         nGrupo    = 1;  nSubGrupo = 16;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;

         nGrupo    = 1;  nSubGrupo = 17;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     |SI enEjercicio ] 2015;
         nGrupo    = 1;  nSubGrupo = 18;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;

         nGrupo    = 1;  nSubGrupo = 19;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 1;
     #300#7  = 9;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         #300#13 = nValor2;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Total1_13;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 1;  nSubGrupo = 12;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     |SI enEjercicio ] 2015;
         nGrupo    = 1;  nSubGrupo = 20;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 1;
     #300#7  = 13;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         #300#13 = nValor2;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Total3_1;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     |SI enEjercicio ] 2011;
         nGrupo    = 1;  nSubGrupo = 14;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
     |FINSI;

     |SI enEjercicio ] 2015;
         nGrupo    = 1;  nSubGrupo = 18;  |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 3;
     #300#7  = 1;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Total3_5;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 3;
     #300#7  = 5;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Total3_6;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 1;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 3;
     #300#7  = 6;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Total2_10;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 2;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     nGrupo    = 2;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;
     nValor2   = nValor2 + #300#13;

     |SI enEjercicio [ 2007;
         #300#0  = enEmpresa;
         #300#1  = enEjercicio;
         #300#2  = nPeriodo;
         #300#3  = nModelo;
         #300#4  = nComplem;
         #300#5  = nActividad;
         #300#6  = 2;
         #300#7  = 10;
         |LEE 101#0=;
         |SI FSalida = 0;
             #300#12 = nValor1;
             #300#13 = nValor2;
             |GRABA 020#300a;
             |LIBERA #300;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI enEjercicio ] 2008;
         nGrupo    = 2;  nSubGrupo = 10;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     |SI enEjercicio [ 2010;
         nGrupo    = 2;  nSubGrupo = 11;   |HAZ LeeCasilla;
         nValor1   = nValor1 - #300#12;
         nValor2   = nValor2 - #300#13;
     |FINSI;

     |SI enEjercicio ] 2011;
         nGrupo    = 2;  nSubGrupo = 13;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;

         nGrupo    = 2;  nSubGrupo = 14;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;

         nGrupo    = 2;  nSubGrupo = 15;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     |SI enEjercicio ] 2014;
         nGrupo    = 2;  nSubGrupo = 16;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     |SI enEjercicio ] 2015;
         nGrupo    = 2;  nSubGrupo = 17;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
         nValor2   = nValor2 + #300#13;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 2;
     #300#7  = 12;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         #300#13 = nValor2;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Total3_15;
     nValor1   = 0;
     nValor2   = 0;

     nGrupo    = 3;  nSubGrupo = 1;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 2;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 3;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 4;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 5;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 6;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 7;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 8;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 9;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 12;   |HAZ LeeCasilla;
     nValor1   = nValor1 + #300#12;

     nGrupo    = 3;  nSubGrupo = 13;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #300#12;

     nGrupo    = 3;  nSubGrupo = 14;   |HAZ LeeCasilla;
     nValor1   = nValor1 - #300#12;

     |SI enEjercicio ] 2014;
         nGrupo    = 3;  nSubGrupo = 16;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;

         nGrupo    = 3;  nSubGrupo = 17;   |HAZ LeeCasilla;
         nValor1   = nValor1 + #300#12;
     |FINSI;

     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = 3;
     #300#7  = 15;
     |LEE 101#300=;
     |SI FSalida = 0;
         #300#12 = nValor1;
         |GRABA 020#300a;
         |LIBERA #300;
     |FINSI;
|FPRC;

|PROCESO Totales;
     |HAZ Total1_9;   || Total Bases y Cuotas I.V.A.
     |HAZ Total1_13;  || Total Bases y Cuotas I.V.A. y Recargo

     |SI nModelo = 303;
         |HAZ Total3_1;   || Operaciones en Regimen General
         |HAZ Total3_5;   || Operaciones en Regimen especial bienes usados etc.
         |HAZ Total3_6;   || Operaciones en Regimen especial Agencias Viajes
     |FINSI;

     |HAZ Total2_10;  || Suma de Deducciones
     |HAZ Total3_15;  || Total Volumen de Operaciones
|FPRC;
||/////////////////////////////////////////////////////////////////////////

|PROCESO GrabaDevengado303;
     |SI #300nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     nIVA     = #300nCampo2;

     |SI nSubeIVA = 1;
         |SI nIVA = 16;  nIVA = 18;  |FINSI;
         |SI nIVA = 7;   nIVA = 8;   |FINSI;
     |FINSI;
     |SI nSubeIVA = 2;
         |SI nIVA = 18; |O nIVA = 16; nIVA = 21;  |FINSI;
         |SI nIVA = 8;  |O nIVA = 7;  nIVA = 10;  |FINSI;
     |FINSI;
     |SI nSubeIVA = 2;
         |SI nDesde = 17;
             |SI nIVA = 4; nIVA = 5.20;  |FINSI;
             |SI nIVA = 1; nIVA = 1.40;  |FINSI;
         |FINSI;
     |FINSI;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #303nCampo22 = nIVA;
               #303nCampo11 = #303nCampo11 + #300nCampo1;
               #303nCampo33 = #303nCampo33 + #300nCampo3;
               nSwAcum = 1;

               |SI nIVA ! #300nCampo2;
                   |SI nCampo22 = 7;   nIVA7  = 1;  |FINSI;
                   |SI nCampo22 = 10;  nIVA10 = 1;  |FINSI;
                   |SI nCampo22 = 13;  nIVA13 = 1;  |FINSI;
                   |SI nCampo22 = 16;  nIVA16 = 1;  |FINSI;
                   |SI nCampo22 = 19;  nIVA19 = 1;  |FINSI;
                   |SI nCampo22 = 22;  nIVA22 = 1;  |FINSI;
                   |SI nCampo22 = 25;  nIVA25 = 1;  |FINSI;
                   |SI nCampo22 = 28;  nIVA28 = 1;  |FINSI;
                   |SI nCampo22 = 31;  nIVA31 = 1;  |FINSI;
               |FINSI;

               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #303nCampo22 = 0;
                   #303nCampo11 = #300nCampo1;
                   #303nCampo22 = nIVA;
                   #303nCampo33 = #300nCampo3;

                   |SI nIVA ! #300nCampo2;
                       |SI nCampo22 = 7;   nIVA7  = 1;  |FINSI;
                       |SI nCampo22 = 10;  nIVA10 = 1;  |FINSI;
                       |SI nCampo22 = 13;  nIVA13 = 1;  |FINSI;
                       |SI nCampo22 = 16;  nIVA16 = 1;  |FINSI;
                       |SI nCampo22 = 19;  nIVA19 = 1;  |FINSI;
                       |SI nCampo22 = 22;  nIVA22 = 1;  |FINSI;
                       |SI nCampo22 = 25;  nIVA25 = 1;  |FINSI;
                       |SI nCampo22 = 28;  nIVA28 = 1;  |FINSI;
                       |SI nCampo22 = 31;  nIVA31 = 1;  |FINSI;
                   |FINSI;

                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #303nCampo11 = #303nCampo11 + #300nCampo1;
         #303nCampo22 = -1;
         #303nCampo33 = #303nCampo33 + #300nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible303;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #303nDesde = #303nDesde - (#300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32);
         #303nHasta = #303nHasta - (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 42;  |Y nDesde ! 44;
         |SI nHasta ! -1;
             #303nDesde = #303nDesde + (#300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32);
             #303nHasta = #303nHasta + (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
         |SINO;
             #303nDesde = #303nDesde + (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
         |FINSI;
     |SINO;
         #303nDesde = #303nDesde + (#300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32);
         #303nHasta = #303nHasta + (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     |SI #300#6 = 5;  |Y #300#7 = 6;  |Y #300#12 ! 0;
         nEjerAnt = #300#12;
     |FINSI;

     |SI #300#6  = 2; |Y #300#7 = 12; |ACABA; |FINSI;
     |SI #300#12 = 0; |Y #300#13 = 0; |ACABA; |FINSI;

     nDesde = 0;
     nHasta = 0;

     |SI #300#6 = 1;  |Y #300#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 14;  nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #300#6 = 1;  |Y #300#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #300#6 = 1;  |Y #300#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 32;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #300nCampo1 ! 0;  |O #300nCampo2 ! 0;  |O #300nCampo3 ! 0;
                   |HAZ GrabaDevengado303;
               |FINSI;
         |SIGUE;

         |SI #300#6 = 1;  |Y #300#7 = 6;
             |PARA nCampo1 = 35;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   |SI #300nCampo1 ! 0;  |O #300nCampo2 ! 0;  |O #300nCampo3 ! 0;
                       |HAZ GrabaDevengado303;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #303nCampo1 = -1;  #303nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #300#6 = 2;  |Y #300#7 = 1;   nDesde = 34;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 2;   nDesde = 36;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 3;   nDesde = 38;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 4;   nDesde = 40;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 5;   nDesde = 42;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 6;   nDesde = 44;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 7;   nDesde = 46;  nHasta = -1;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 9;   nDesde = 47;  nHasta = -1;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 10;  nDesde = 48;  nHasta = -1;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 13;  nDesde = 34;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 14;  nDesde = 34;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 15;  nDesde = 36;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible303;
     |FINSI;

     |SI #300#6 = 3;  |Y #300#7 = 9;
         #303#54 = #303#54 + #300#12;
     |FINSI;

     |SI #300#6 = 5;  |Y #300#7 = 1;
         #303#51   = #303#51 + #300#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #300#6 = 5;  |Y #300#7 = 2;
         #303#57 = #303#57 + #300#12;
     |FINSI;

     |SI #300#6 = 3;  |Y #300#7 = 10;
         #303#55 = #303#55 + #300#12;
     |FINSI;

     |SI #300#1 [ 2009;
         |SI #300#6 = 3;  |Y #300#7 = 11;
             #303#56 = #303#56 + #300#12;
         |FINSI;
     |SINO;
         |SI #300#6 = 3;  |Y #300#7 = 4;
             #303#56 = #303#56 + #300#12;
         |FINSI;
     |FINSI;

|FPRC;

|DEFBUCLE dsmociva;
     #300#1;
     ;
     enEmpresa, enEjercicio, nPeriodo, nModelo, nComplem, 01, 0,  0;
     enEmpresa, enEjercicio, nPeriodo, nModelo, nComplem, 99, 9, 99;
     e;
     NULL, GrabaModelo;
|FIN;
|| ///////////////////////////////////////////////////////////////////////

|PROCESO Registro0;
    |ABRE #300;
    |HAZ Totales;
    |CIERRA #300;

    |SI enEjercicio ] 2014;
        |HAZ Imp_2014;
        |ACABA;
    |FINSI;

    |DDEFECTO #303;
    #303#0 = enEmpresa;
    #303#1 = enEjercicio;
    #303#2 = nPeriodo;
    #303#3 = nModelo;
    #303#4 = nComplem;
    #303#5 = 0;

    nContador = 0;
    nIVA7     = 0;
    nIVA10    = 0;
    nIVA13    = 0;
    nIVA16    = 0;
    nIVA19    = 0;
    nIVA22    = 0;
    nIVA25    = 0;
    nIVA28    = 0;
    nIVA31    = 0;
    nSubeIVA  = 0;

    |SI #303#1 = 2010; |Y #303#2 ] 7; nSubeIVA = 1; |FINSI;
    |SI #303#1 ] 2011;                nSubeIVA = 1; |FINSI;

    |SI #303#1 = 2012; |Y #303#2 ] 9; nSubeIVA = 2; |FINSI;
    |SI #303#1 ] 2013;                nSubeIVA = 2; |FINSI;

    |SI #303#2 = 0;
        |SI #0#4 ] "01.07.2010"; nSubeIVA = 1; |FINSI;
        |SI #0#4 ] "01.09.2012"; nSubeIVA = 2; |FINSI;
    |FINSI;

    |BUCLE dsmociva;

    |SI nIVA7  = 1;  #303#7  = (#303#8  / #303#6)  * 100;   |FINSI;
    |SI nIVA10 = 1;  #303#10 = (#303#11 / #303#9)  * 100;   |FINSI;
    |SI nIVA13 = 1;  #303#13 = (#303#14 / #303#12) * 100;   |FINSI;
    |SI nIVA16 = 1;  #303#16 = (#303#17 / #303#15) * 100;   |FINSI;
    |SI nIVA19 = 1;  #303#19 = (#303#20 / #303#18) * 100;   |FINSI;
    |SI nIVA22 = 1;  #303#22 = (#303#23 / #303#21) * 100;   |FINSI;
    |SI nIVA25 = 1;  #303#25 = (#303#26 / #303#24) * 100;   |FINSI;
    |SI nIVA28 = 1;  #303#28 = (#303#29 / #303#27) * 100;   |FINSI;
    |SI nIVA31 = 1;  #303#31 = (#303#32 / #303#20) * 100;   |FINSI;

    #303#53 = nEjerAnt;
    #303#33 = #303#8  + #303#11 + #303#14 + #303#17 + #303#20 + #303#23
    #303#33 = #303#33 + #303#26 + #303#29 + #303#32;

    #303#49 = #303#35 + #303#37 + #303#39 + #303#41 + #303#43 + #303#45;
    #303#49 = #303#49 + #303#46 + #303#47 + #303#48;

    #303#50 = #303#33 - #303#49;
    #303#51 = 100;
    #303#52 = #303#50;

    #303#58 = #303#52 - #303#53 + #303#57;
    #303#60 = #303#58 - #303#59;

    |SI #303#60 > 0;
        #303#63 = #303#60;
        #303#61 = 0;
        #303#62 = 0;
    |SINO;
        #303#61 = -#303#60;
        #303#62 = 0;
        #303#63 = 0;
    |FINSI;

|| IVA REPERCUTIDO
    |ABRE #300;

    nGrupo = 1;
    aText = "I.V.A. DEVENGADO";
    aTexr = "----------------";
    enSwLinea = 0; |PRINT;
    enSwLinea = 1; |PRINT;

    aDescr = "Regimen General 1 ........";
    enBase = #303#6; enPorce = #303#7; enCuota = #303#8;
    enSwLinea = 2; |PRINT;
    |SI nIVA7  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva;
        nSubGrupo = 2; |HAZ MiroCiva;
        nSubGrupo = 3; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Regimen General 2 ........";
    enBase = #303#9; enPorce = #303#10; enCuota = #303#11;
    enSwLinea = 2; |PRINT;
    |SI nIVA10  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva;
        nSubGrupo = 2; |HAZ MiroCiva;
        nSubGrupo = 3; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Regimen General 3 ........";
    enBase = #303#12; enPorce = #303#13; enCuota = #303#14;
    enSwLinea = 2; |PRINT;
    |SI nIVA13  = 1;
        aTexr = "Desglose Tipos IVA";
        nSubGrupo = 1; |HAZ MiroCiva;
        nSubGrupo = 2; |HAZ MiroCiva;
        nSubGrupo = 3; |HAZ MiroCiva;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aDescr = "Recargo Equivalencia 1 ...";
    enBase = #303#15; enPorce = #303#16; enCuota = #303#17;
    enSwLinea = 2; |PRINT;
    |SI nIVA16  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva;
        nSubGrupo = 11; |HAZ MiroCiva;
        nSubGrupo = 12; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Recargo Equivalencia 2 ...";
    enBase = #303#18; enPorce = #303#19; enCuota = #303#20;
    enSwLinea = 2; |PRINT;
    |SI nIVA19  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva;
        nSubGrupo = 11; |HAZ MiroCiva;
        nSubGrupo = 12; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Recargo Equivalencia 3 ...";
    enBase = #303#21; enPorce = #303#22; enCuota = #303#23;
    enSwLinea = 2; |PRINT;
    |SI nIVA22  = 1;
        aTexr = "Desglose Tipos Recargo";
        nSubGrupo = 10; |HAZ MiroCiva;
        nSubGrupo = 11; |HAZ MiroCiva;
        nSubGrupo = 12; |HAZ MiroCiva;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aDescr  = "Adq.Intracomunitarias ....";
    enBase  = #303#24 + #303#27 + #303#30;
    enPorce = 0
    enCuota = #303#26 + #303#29 + #303#32;
    enSwLinea = 2; |PRINT;
    |SI #303#25 ! 0;
        |SI nIVA25 = 1;
            enPorce = #303#25;
            aTexr = "Desglose Tipos IVA";
            nSubGrupo = 5; |HAZ MiroCiva;
        |SINO;
            enBaseI = #303#24; enPorceI = #303#25; enCuotaI = #303#26;
            enSwLinea = 6; |PRINT;
        |FINSI;
    |FINSI;
    |SI #303#28 ! 0;
        |SI nIVA28 = 1;
            enPorce = #303#28;
            aTexr = "Desglose Tipos IVA";
            nSubGrupo = 5; |HAZ MiroCiva;
        |SINO;
            enBaseI = #303#27; enPorceI = #303#28; enCuotaI = #303#29;
            enSwLinea = 6; |PRINT;
        |FINSI;
    |FINSI;
    |SI #303#31 ! 0;
        |SI nIVA31 = 1;
            enPorce = #303#31;
            aTexr = "Desglose Tipos IVA";
            nSubGrupo = 5; |HAZ MiroCiva;
        |SINO;
            enBaseI = #303#27; enPorceI = #303#28; enCuotaI = #303#29;
            enSwLinea = 6; |PRINT;
        |FINSI;
   |FINSI;

    enSwLinea = 3; |PRINT;
    enSwLinea = 9; |PRINT;

|| IVA SOPORTADO
    nGrupo = 2;
    aText = "I.V.A. DEDUCIBLE";
    aTexr = "----------------";
    enSwLinea = 0; |PRINT;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Op.interiores corrientes ..............";
    enBase = #303#34; enCuota = #303#35; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 1; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Op.interiores bienes inversion ........";
    enBase = #303#36; enCuota = #303#37; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 2; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Importaciones bienes corrientes .......";
    enBase = #303#38; enCuota = #303#39; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 3; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Importaciones bienes inversion ........";
    enBase = #303#40; enCuota = #303#41; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 4; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Adq.intracomunitarias bienes corrientes";
    enBase = #303#42; enCuota = #303#43; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 5; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Adq.intracomunitarias bienes inversion ";
    enBase = #303#44; enCuota = #303#45; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nSubGrupo = 6; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Compensaciones Regimen Especial A.G.P. ................";
    enCuota = #303#46; enSwLinea = 5; |PRINT;
    |SI enCuota ! 0;  nSubGrupo = 7; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Regularizacion inversiones ............................";
    enCuota = #303#47; enSwLinea = 5; |PRINT;
    |SI enCuota ! 0;  nSubGrupo = 8; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Regularizacion aplicacion porcentaje def. prorrata ....";
    enCuota = #303#48; enSwLinea = 5; |PRINT;
    |SI enCuota ! 0;  nSubGrupo = 10; |HAZ MiroCiva;  |FINSI;

    |PIEINF;

    |CIERRA #300;
|FPRC;

|| ////////////////////////////////////////////////////////////////////////
|PROCESO GrabaRegistros;
     |SI nModelo = 300; |Y #307#4 = 2;
         |ACABA;
     |FINSI;

     |SI #307#0 = 2;  |Y #307#1 = 10;
         |SI enEjercicio [ 2007;
             #307#2 = "      Suma de deducciones ........................";
             #307#3 = "T";
             #307#4 = 0;
             #307#5 = 2;
             #307#6 = 0;
             #307#7 = 0;
         |SINO;
             #307#2 = "Regularizacion aplicacion porcentaje def.prorrata";
             #307#3 = "D";
             #307#4 = 0;
             #307#5 = 0;
             #307#6 = 0;
             #307#7 = 0;
         |FINSI;
     |FINSI;

     |SI #307#0 = 3;  |Y #307#1 = 4; |Y enEjercicio ] 2009;
         #307#2 = "Op.no sujeta por regla localiz. o con inv.suj.pas.";
     |FINSI;

     |SI enEjercicio ] 2010;
         |SI #307#0 = 1;  |Y #307#1 = 4;
             |ACABA;
         |FINSI;

         |SI #307#0 = 3;  |Y #307#1 = 7;
             #307#2 = "Entregas bienes obj.de inst.o mont.en otros E.M. .";
         |FINSI;

         |SI #307#0 = 4;  |Y #307#1 = 5;
             |ACABA;
         |FINSI;

         |SI #307#0 = 4;  |Y #307#1 = 7;
             |ACABA;
         |FINSI;
     |FINSI;

     |DDEFECTO #300;
     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = #307#0;
     #300#7  = #307#1;
     #300#8  = #307#2;
     #300#9  = #307#3;
     #300#11 = #307#5;

     |SI #307#0 = 5;  |Y #307#1 = 1;
         #300#12 = 100;
     |FINSI;

     |GRABA 020#300n;
     |LIBERA #300;
|FPRC;

|DEFBUCLE dsmom007;
     #307#1;
     ;
     0, 00;
     5, 99;
     ;
     NULL, GrabaRegistros;
|FIN;

|PROCESO GrabaRegistros117;
     |SI #317#7 = 0;
         |ACABA;
     |FINSI;

     |DDEFECTO #300;
     #300#0  = enEmpresa;
     #300#1  = enEjercicio;
     #300#2  = nPeriodo;
     #300#3  = nModelo;
     #300#4  = nComplem;
     #300#5  = nActividad;
     #300#6  = #317#0;
     #300#7  = #317#1;
     #300#8  = #317#2;
     #300#9  = #317#3;
     #300#11 = #317#5;
     #300#56 = #317#7;

     |SI #317#0 = 5;  |Y #317#1 = 1;
         #300#12 = 100;
     |FINSI;

     |GRABA 020#300n;
     |LIBERA #300;
|FPRC;

|DEFBUCLE dsmom117;
     #317#1;
     ;
     nEjerCarga, 0, 00;
     nEjerCarga, 9, 99;
     ;
     NULL, GrabaRegistros117;
|FIN;
|| ////////////////////////////////////////////////////////////////////////

|PROCESO HazTodo;

   |ABRE #caivaasi;
   |DDEFECTO #caivaasi;
   |LEE 000#caivaasi.p;
   |CIERRA #caivaasi;
   aMulDep = #caivaasi#132;

  |PATH_DAT #300 dirfich0;

  |DELINDEX #999;
  |DELINDEX #300;

  |SI #0#14 = "R";
      |INFOR informe;
  |SINO;
      |INFOR inform1;
  |FINSI;
  |SI FSalida ! 0; |ACABA;  |FINSI;

  eaIa = #30#21;
  aAlfa1 = #0#3; aAlfa1 = aAlfa1 % 0402; enM1 = aAlfa1;
  aAlfa1 = #0#4; aAlfa1 = aAlfa1 % 0402; enM2 = aAlfa1;
  |HAZ LeeDatosEmpresa;
  #900#13 = #0#3; #900#14 = #0#4;

  sw_impr = 0;
  nCRep   = 0;
  nCSop   = 0;

  nBaseRR = 0; nCuotaRR = 0;
  nBaseRS = 0; nCuotaRS = 0;

  |ABRE #4;
  |LEE 040#4p;
  |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
  |CIERRA #4;
  nPLiq  = 0;
  nHPLiq = 99;
  nDPLiq = #0#5;
  |SI enEjercicio > 2009;
      |SI #4#46 = "T";
          |SI #0#5 > 0; |Y #0#5 [ 3;  nDPLiq = 3;  |FINSI;
          |SI #0#5 > 3; |Y #0#5 [ 6;  nDPLiq = 6;  |FINSI;
          |SI #0#5 > 6; |Y #0#5 [ 9;  nDPLiq = 9;  |FINSI;
          |SI #0#5 > 9; |Y #0#5 [ 12; nDPLiq = 12; |FINSI;
      |FINSI;
  |FINSI;
  |SI #0#5 ! 0;  nHPLiq = nDPLiq; |FINSI;
  |SI enEjercicio < 2014; nPLiq = nDPLiq; nHPLiq = nDPLiq; |FINSI;

  nDPFra = #0#40;
  nHPFra = #0#41;
  nModelo    = 303; |SI enEjercicio < 2009; nModelo = 300; |FINSI;
  nPeriodo   = #0#5; |SI #0#5 = 99; nPeriodo = 0; |FINSI;
  nComplem   = 0;
  nActividad = 1;

  |SI #0#14 = "M";
      |ABRE #300;
      |SI enEjercicio [ 2010;
          |BUCLE dsmom007;
      |SINO;
          |BUCLE dsmom117;
      |FINSI;
      |CIERRA #300;
  |FINSI;

  nHayCaja = 0
  |DDEFECTO #303;
  |DDEFECTO #304;
  |ABRE #330;
  |ABRE #999;
  |ABRE #300;
  |SI #0#5 ! 99;
      |BUCLE FrasTodas;
  |SINO;
      |SI #0#11 = "T"; nDPLiq = 0; nHPLiq = 99; |FINSI;
      |SI #0#11 = "S"; nDPLiq = 1; nHPLiq = 99; |FINSI;
      |SI enEjercicio < 2014;   nPLiq = nDPLiq; |FINSI;

      nPeriodo = 0;
      |BUCLE FrasTodas;       ||Carga Temporal
  |FINSI;

  |SI enEjercicio ] 2015; || carga las de Caja anteriores;
      |CIERRA #camaniva;
      |CIERRA #caivalin;
      nEjerCobro = enEjercicio - 1;
      |BUCLE Lee501_14;
  |FINSI;
  |CIERRA #300;
  |CIERRA #999;
  |CIERRA #330;

  |SI #0#12 = "N";
      nBaseRR = 0; nCuotaRR = 0;
      nBaseRS = 0; nCuotaRS = 0;
  |FINSI;

  |SI sw_impr = 1;
      |SI #0#14 = "R";
          |HAZ Imprimir0;
      |SINO;
          |HAZ Registro0;
      |FINSI;
  |FINSI;
  |FININF;
|FPRC;

|| *************************************************************************
|PROCESO LeeTemporal0;
  |SI #999#0 = 1; |Y #999#1 ! aTipo; |ACABA; |FINSI;

  nConcepto = #999#0;
  aAlfa1 = aText % 0;
  nNume1 = aAlfa1;
  aTexr  = "=" * nNume1;

                    aDescr = " Base Imponible...:";
  |SI #999#5 = 0;   aDescr = " Base Exenta......:"; |FINSI;
  |SI aDeduc = "N"; aDescr = "*Base NO deducible:"; swTLin = 1;|FINSI;
  |SI #999#0 = 999;
      |SI #999#1 = "S"; aDescr = " Adq.Intracomunit.:"; |FINSI;
      |SI #999#1 = "R"; aDescr = " Ent.Intracomunit.:"; |FINSI;
  |FINSI;
  |SI #999#0 = 998;
      |SI #999#1 = "S"; aDescr = " Facturas ISP. ...:"; |FINSI;
      |SI #999#1 = "R"; aDescr = " Facturas ISP. ...:"; |FINSI;
  |FINSI;
  nBase  = #999#6;
  nTipo  = #999#5;
  nCuota = #999#7;

  |PRINT; nPrint = 1;
  swTLin = 1;
  nTot1 = nTot1 + nBase;
  nTot2 = nTot2 + nCuota;
|FPRC;

|PROCESO LeeTemporal1;  || Fin Fichero
  |SI swTLin = 0; |ACABA; |FINSI;
  swTLin = 2;
  |SI aDeduc = "N"; swTLin = 3; |FINSI;
  |PRINT; nPrint = 1;

  |SI aTipo = "R";
      |SI aDeduc = "N";
          |SI aIvRe = "I";
              nTBasnR  = nTBasnR  + nTot1;
          |FINSI;
      |SINO;
          |SI aIvRe = "I";
              nTBasRep = nTBasRep + nTot1;
          |FINSI;
          nTCuoRep = nTCuoRep + nTot2;
      |FINSI;
  |SINO;
      |SI aDeduc = "N";
          |SI aIvRe = "I";
              nTBasnS  = nTBasnS  + nTot1;
          |FINSI;
      |SINO;
          |SI aIvRe = "I";
              nTBasSop = nTBasSop + nTot1;
          |FINSI;
          nTCuoSop = nTCuoSop + nTot2;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE LeeTemporal;
   #999#1;
   ;
   001, aDTipo, aDeduc, aInver, aIvRe, 00000;
   999, aHTipo, aDeduc, aInver, aIvRe, 99999;
   e;
   NULL,LeeTemporal0,NULL,NULL, LeeTemporal1;
|FIN;

|PROCESO Imprimir02;
    || ...................... Deducible
       aDeduc = "S";
       || ... Primer Bucle  Deducible IVA
          aText  = "I.V.A." + aText1 + aText2;
          aIvRe  = "I";
          nTot1  = 0; nTot2 = 0; swTLin = 0;
          |BUCLE LeeTemporal;
       || ... Recargo
          aText  = "RECARGO DE EQUIVALENCIA" + aText1 + aText2;
          aIvRe  = "R";
          nTot1  = 0; nTot2 = 0; swTLin = 0;
          |BUCLE LeeTemporal;

    || ...................... No Deducible
       aDeduc = "N";
       || ... Primer Bucle  Deducible IVA
          aText  = "";
          aIvRe  = "I";
          nTot1  = 0; nTot2 = 0; swTLin = 0;
          |BUCLE LeeTemporal;
       || ... Recargo
          aIvRe  = "R";
          nTot1  = 0; nTot2 = 0; swTLin = 0;
          |BUCLE LeeTemporal;
|FPRC;

|PROCESO Imprimir01;
 aDTipo = aTipo;
 aHTipo = aTipo;
 |SI #0#39 = "S"; |Y aTipo = "R";
     aDTipo = " ";
     aHTipo = "z";
 |FINSI;

 || ...................... No Inversion
    aText2 = "";
    aInver = "N";
    |HAZ Imprimir02;
 || ...................... Inversion
    aText2 = "(INVERSION)";
    aInver = "S";
    |HAZ Imprimir02;
|FPRC;

|PROCESO Imprimir0;
    nTCuoRep = 0;
    nTBasnR  = 0;
    nTBasRep = 0;
    nTCuoSop = 0;
    nTBasnS  = 0;
    nTBasSop = 0;
nPrint = 0;
    aText1 = " SOPORTADO";
    aTipo = "S";
    |HAZ Imprimir01;

    aText1 = " REPERCUTIDO";
    aTipo = "R";
    |HAZ Imprimir01;
|SI nPrint = 1;     |PIEINF; |FINSI;

|FPRC;

|| ////////////////////////////////////
|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #1 dirfich0;
   |PATH_DAT #2 dirfich0;
   |PATH_DAT #4 dirfich0;
   |PATH_DAT #105 dirfich0;
   |PATH_DAT #501 dirfich0;
   |PATH_DAT #502 dirfich0;
   |PATH_DAT #503 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 00001;
 99999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
