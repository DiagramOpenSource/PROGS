|FICHEROS;
   caexcvip #0;

   camaniva #10;
   caivalin #11;
   camaasil #13;
|FIN;

|VARIABLES;
   aIP        = "";
   aAlfa      = "";
   aAlfa1     = "";
   aAlfa2     = "";

   aSerieOri  = "";
   nFactuOri  = "";
   fFechaOri  = "";
   aSerieDes  = "";
   nFactuDes  = "";
   fFechaDes  = "";

   nCalc      = 0;
   nDato      = 0;
   nSalir     = 0;
   nContSalir = 0;
|FIN;

|PROCESO MiraCamino;
   aAlfa = #caexcvip#1; |QBF aAlfa;
   |SI aAlfa = "";
      aAlfa = "F*.xls";
      |BROWSE aAlfa;
      aAlfa = aAlfa % 0299;
      #caexcvip#1 = aAlfa; |PINTA #caexcvip#1;
      |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO CambiaDesc;
   aAlfa = #caexcvip#2; |QBF aAlfa;
   |SI aAlfa ! "";
      aAlfa = aAlfa - "SSSSS";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
         nCalc = FSalida + 94;               aAlfa2 = aAlfa % nCalc;
         aAlfa = aAlfa1 + aSerieDes + aAlfa2;
      |FINSI;

      aAlfa = aAlfa - "FFFFFF";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
         nCalc = FSalida + 93;               aAlfa2 = aAlfa % nCalc;
         aAlfa = aAlfa1 + (("000000" + nFactuDes) % -106) + aAlfa2;
      |FINSI;

      aAlfa = aAlfa - "PPPPPPPPPP";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
         nCalc = FSalida + 89;               aAlfa2 = aAlfa % nCalc;
         aAlfa = aAlfa1 + fFechaDes + aAlfa2;
      |FINSI;

      |ACABA;
   |FINSI;

   aAlfa = aAlfa - aSerieOri;
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
      nCalc = FSalida + 94;               aAlfa2 = aAlfa % nCalc;
      aAlfa = aAlfa1 + aSerieDes + aAlfa2;
   |FINSI;

   aAlfa1 = nFactuOri;
   aAlfa1 = (("000000" + nFactuOri) % -106);
   aAlfa = aAlfa - aAlfa1;
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
      nCalc = FSalida + 94;               aAlfa2 = aAlfa % nCalc;
      aAlfa = aAlfa1 + (("000000" + nFactuDes) % -106) + aAlfa2;
   |SINO;
      aAlfa1 = nFactuOri;
      aAlfa = aAlfa - aAlfa1;
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
         nCalc = FSalida + 94;               aAlfa2 = aAlfa % nCalc;
         aAlfa = aAlfa1 + nFactuDes + aAlfa2;
      |FINSI;
   |FINSI;
   aAlfa1 = fFechaOri;
   aAlfa = aAlfa - aAlfa1;
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
      nCalc = FSalida + 94;               aAlfa2 = aAlfa % nCalc;
      aAlfa = aAlfa1 + fFechaDes + aAlfa2;
   |FINSI;
|FPRC;

|PROCESO CambiaAsto;
   aAlfa = #camaasil#7; |QBF aAlfa;
   |HAZ CambiaDesc;
   #camaasil#7 = aAlfa;
   |GRABA 020#camaasil.a;
|FPRC;

|DEFBUCLE CambiaAsto;
#camaasil#1;
;
#camaniva#7, #camaniva#8, #camaniva#9, 0000;
#camaniva#7, #camaniva#8, #camaniva#9, 9999;
be;
NULL, CambiaAsto;
|FIN;

|PROCESO CambiaLins;
   aAlfa = #caivalin#4; |QBF aAlfa;
   |HAZ CambiaDesc;
   #caivalin#4 = aAlfa;
   |GRABA 020#caivalin.a;
|FPRC;

|DEFBUCLE CambiaLins;
#caivalin#1;
;
#camaniva#0, #camaniva#1, 00;
#camaniva#0, #camaniva#1, 99;
be;
NULL, CambiaLins;
|FIN;

|PROCESO CambiaFra;
   #camaniva#0 = #caexcvip#3;
   #camaniva#2 = aSerieOri;
   #camaniva#3 = nFactuOri;
   |LEE 101#camaniva.=;
   |SI FSalida = 0;
      fFechaOri = #camaniva#4;
      #camaniva#2 = aSerieDes;
      #camaniva#3 = nFactuDes;
      #camaniva#4 = fFechaDes;

      aAlfa = #camaniva#28; |QBF aAlfa;
      |HAZ CambiaDesc;
      #camaniva#28 = aAlfa;

      aAlfa = #camaniva#30; |QBF aAlfa;
      |HAZ CambiaDesc;
      #camaniva#30 = aAlfa;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;

      |BUCLE CambiaLins;
      |BUCLE CambiaAsto;
   |FINSI;
|FPRC;

|PROCESO Cambio;
   |CARGADLL "agixl97.dll";
   |SI FSalida < 0;
      |MENAV "0000No se puede usar agixl97.dll";
   |SINO;
      aAlfa = #caexcvip#1; |QBF aAlfa;
      |ALFACALLDLL "agixl97.dll", "carga_book", aAlfa;
      aAlfa = "hoja01";
      |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aAlfa;
      nDato = 1; nSalir = 0; nContSalir = 0;
      |PARA; |SI nSalir = 0; |HACIENDO;
         aAlfa = "B" + nDato;
         |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
         |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = "A" + nDato; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
            aSerieOri = aAlfa;
            aAlfa = "B" + nDato; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
            nFactuOri = aAlfa;
            aAlfa = "C" + nDato; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
            aSerieDes = aAlfa;
            aAlfa = "D" + nDato; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
            nFactuDes = aAlfa;
            aAlfa = "E" + nDato; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
            fFechaDes = aAlfa;
            |HAZ CambiaFra;
            nContSalir = 0;
         |SINO;
            nContSalir = nContSalir + 1;
            |SI nContSalir = 5; nSalir = 1; |FINSI;
         |FINSI;
         nDato = nDato + 1;
      |SIGUE;
      |ALFACALLDLL "agixl97.dll", "fin_book", "salva";

      |DESCARGADLL "agixl97.dll";
   |FINSI;
|FPRC;

|PROGRAMA;
   |ABRE #caexcvip;
   |LEE 101#caexcvip.p;
   |SI FSalida ! 0;
      |DDEFECTO #caexcvip;
      |GRABA 020#caexcvip.b;
   |FINSI;

   |CLS;
   |CABEZA "Cambio numeracion y fecha en registro de IVA y descripcion asientos";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#caexcvip.a;
      |ABRE #camaniva; |ABRE #camaasil; |ABRE #caivalin;
      |SELECT #3#camaniva;
      |HAZ Cambio;
      |SELECT #1#camaniva;
      |CIERRA #caivalin; |CIERRA #camaasil; |CIERRA #camaniva;
      |LIBERA #caexcvip;
   |FINSI;
   |CIERRA #caexcvip;
|FPRO;
