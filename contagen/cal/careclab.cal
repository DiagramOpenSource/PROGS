|FICHEROS;
   careclab #0;
   camaasil #1;
   camaasic #2;
   camaniva #3;
   caivalin #4;

   camasic@ #5;
   camasil@ #6;
   camaiva@ #7;
   caivlin@ #8;

   careclal #10;

   canempre #30;
   canemp1@ #31;
|FIN;

|VARIABLES;
   Comodin   = "";
   Comodin1  = "";
   Comodin2  = "";

   nCalc     = 0;
   nCont     = 0;
   Linea     = 1;
   aAlfa1 = "";
|FIN;

|PROCESO LineasAsto;
   Comodin = "|NC"; nCalc = #camasil@#Comodin#; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #camasil@#nCont# = #camaasil#nCont#;
   |SIGUE;
   |GRABA 020#camasil@.n;
|FPRC;

|DEFBUCLE LineasAsto;
#camaasil#1;
;
#camaasic#0,#camaasic#1,#camaasic#2,0;
#camaasic#0,#camaasic#1,#camaasic#2,999999;
;
NULL,LineasAsto;
|FIN;

|PROCESO LineasIva;
   Comodin = "|NC"; nCalc = #caivlin@#Comodin#; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #caivlin@#nCont# = #caivalin#nCont#;
   |SIGUE;
   |GRABA 020#caivlin@.n;
|FPRC;

|DEFBUCLE LineasIva;
#caivalin#1;
;
#camaniva#0,#camaniva#1,01;
#camaniva#0,#camaniva#1,99;
;
NULL,LineasIva;
|FIN;

|PROCESO Traspasa;
   |SI #camaniva#4 ! "31.01.2001"; |Y #camaniva#4 ! "28.02.2001"; |ACABA; |FINSI;

   #camaiva@#0 = #camaniva#0; #camaiva@#1 = #camaniva#1;
   |LEE 000#camaiva@.=;
   |SI FSalida ! 111; |ACABA; |FINSI;

   #camaasic#0 = #camaniva#7;
   #camaasic#1 = #camaniva#8;
   #camaasic#2 = #camaniva#9;
   |LEE 000#camaasic.=;
   |SI FSalida = 0;
      #camasic@#0 = #camaniva#7;
      #camasic@#1 = #camaniva#8;
      #camasic@#2 = #camaniva#9;
      |LEE 000#camasic@.=;
      |SI FSalida ! 0;
         Comodin = "|NC"; nCalc = #camasic@#Comodin#;  nCalc = nCalc - 1;
         |PARA nCont = 3; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
            #camasic@#nCont# = #camaasic#nCont#;
         |SIGUE;
         |GRABA 020#camasic@.n;
         |BUCLE LineasAsto;
      |FINSI;
   |FINSI;

   Comodin = "|NC"; nCalc = #camaiva@#Comodin#;  nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #camaiva@#nCont# = #camaniva#nCont#;
   |SIGUE;
   |GRABA 020#camaiva@.n;
   |BUCLE LineasIva;

   |DDEFECTO #careclal;
   #careclal#0 = Linea;  Linea = Linea + 1;
   #careclal#1 = #30#2;
   #careclal#2 = #camaniva#0;
   #careclal#3 = #camaniva#1;
   #careclal#4 = #camaniva#13;
   #careclal#5 = #camaniva#7;
   #careclal#6 = #camaniva#8;
   #careclal#7 = #camaniva#9;
   |GRABA 020#careclal.n;
|FPRC;

|DEFBUCLE Traspasa;
#camaniva#1;
;
3,000000001;
3,999999999;
;
NULL,Traspasa;
|FIN;

|PROCESO Empresas;
   Comodin = #0#0; |QBF Comodin;
   Comodin = Comodin + (("00000" + #canempre#2) % -105) + "8/";
   Comodin1 = #0#1; |QBF Comodin1;
   Comodin1 = Comodin1 + (("00000" + #canempre#2) % -105) + "8/";

   aAlfa1 = "0000Empresa: [" + #canempre#0 + "] en proceso...";
   |MENSA aAlfa1;

   |PATH_DAT #1 Comodin; |PATH_DAT #5 Comodin1;
   |PATH_DAT #2 Comodin; |PATH_DAT #6 Comodin1;
   |PATH_DAT #3 Comodin; |PATH_DAT #7 Comodin1;
   |PATH_DAT #4 Comodin; |PATH_DAT #8 Comodin1;

   |ABRE #camaasic; |ABRE #camaasil; |ABRE #camaniva; |ABRE #caivalin;
   |ABRE #camasic@; |ABRE #camasil@; |ABRE #camaiva@; |ABRE #caivlin@;

   |BUCLE Traspasa;

   |CIERRA #caivlin@; |CIERRA #camaiva@; |CIERRA #camasil@; |CIERRA #camasic@;
   |CIERRA #caivalin; |CIERRA #camaniva; |CIERRA #camaasil; |CIERRA #camaasic;

|FPRC;

|DEFBUCLE Empresas;
#canempre#1;
;
#0#3,8;
#0#4,8;
;
NULL,Empresas;
|FIN;

|RUTINA inf;
   #careclal#0 = 1;
|FRUT;

|RUTINA sup;
   #careclal#0 = 999999;
|FRUT;

|PROGRAMA;
   |CLS;
   |CABEZA "Recalculo registros laboral";
   |ABRE #0;
   |LEE 000#0p;
   |SI FSalida ! 0;
      |DDEFECTO #careclab;
      |GRABA 020#0n;
      |LEE 000#0p;
   |FINSI;
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#0a;
      |DELINDEX #careclal; |ABRE #careclal; Linea = 1;
      Comodin = #0#0; |QBF Comodin; Comodin = Comodin - "fich/";
      Comodin1 = Comodin + "def/canempre.mas"; |CARGA_DEF Comodin1, canemp1@;
      |SI FSalida ! 0; |ACABA; |FINSI;

      Comodin1 = Comodin + "def/camaasic.mas"; |CARGA_DEF Comodin1, camasic@;
      |SI FSalida ! 0; |DESCARGA_DEF #canemp1@; |ACABA; |FINSI;
      Comodin1 = Comodin + "def/camaasil.mas"; |CARGA_DEF Comodin1, camasil@;

      |SI FSalida ! 0;
         |DESCARGA_DEF #canemp1@; |DESCARGA_DEF #camasic@; |ACABA;
      |FINSI;
      Comodin1 = Comodin + "def/camaniva.mas"; |CARGA_DEF Comodin1, camaiva@;
      |SI FSalida ! 0;
         |DESCARGA_DEF #canemp1@; |DESCARGA_DEF #camasic@;
         |DESCARGA_DEF #camasil@; |ACABA;
      |FINSI;

      Comodin1 = Comodin + "def/caivalin.mas"; |CARGA_DEF Comodin1, caivlin@;
      |SI FSalida ! 0;
         |DESCARGA_DEF #canemp1@; |DESCARGA_DEF #camasic@;
         |DESCARGA_DEF #camasil@; |DESCARGA_DEF #camaiva@;
         |ACABA;
      |FINSI;

      Comodin = #0#0; |QBF Comodin; |PATH_DAT #30 Comodin;
      Comodin = #0#1; |QBF Comodin; |PATH_DAT #31 Comodin;

      |BUCLE Empresas;
      |ENTLINEAL #1#careclal,-1,4,21,1,inf,sup;

      |CIERRA #caivalin; |CIERRA #camaniva;
      |CIERRA #camaasil; |CIERRA #camaasic; |CIERRA #careclal;

      |CIERRA #caivlin@; |DESCARGA_DEF #caivlin@;
      |CIERRA #camaiva@; |DESCARGA_DEF #camaiva@;
      |CIERRA #camasil@; |DESCARGA_DEF #camasil@;
      |CIERRA #camasic@; |DESCARGA_DEF #camasic@;

   |FINSI;
   |CIERRA #0;
|FPRO;
