|FICHEROS;
     gadm0005;

     gadz0100;
     caivases;
     calibros;

     :basica/agicen14;

     gadw0008;
|FIN;

|VARIABLES;
     nEmpresa            = 0;
     n0Vent              = 0;
     nPanta              = 0;
     nBtnAlt             = 0;
     nBtnMod             = 0;
     nBtnBaj             = 0;
     nGrid1              = 0;
     nGrid2              = 0;
     nRango              = 0;
     nDAct               = 0;
     nHAct               = 0;
     nIde                = 0;
     nIdSalir            = 0;
     nFSalida            = 0;
     nError              = 0;

     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aAlfa               = "";
     aMas                = "";
     aFic                = "";
     aFij                = "";
     aSer                = "";
     aAny                = "";
     aRojo               = "0,0,0;255,80,80";
     aDF                 = "0,0,0;255,80,80";
     aHF                 = "0,0,0;255,80,80";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     {2}nNivel           = 0;

     &enAct              = 0;
     &enError            = 0;
     &any_por            = 0;
     &enEj               = 0;
     &enEmpreDes         = 0;
|FIN;

|INCLUYE dscont_i;

|PROCESO QuitaBotonSalir;
     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO PonBotonSalir;
     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO Baja1;
     #agicen14#0 = nEmpresa;
     #agicen14#1 = nDAct;
|FPRC;

|PROCESO Alta1;
     #agicen14#0 = nEmpresa;
     #agicen14#1 = nHAct;
|FPRC;

|PROCESO Baja2;
     #gadm0005#3 = #agicen14#1;
     #gadm0005#0 = 01;
     #gadm0005#1 = "";
|FPRC;

|PROCESO Alta2;
     #gadm0005#3 = #agicen14#1;
     #gadm0005#0 = 99;
     #gadm0005#1 = "zzzzz";
|FPRC;

|PROCESO PintaDatos;
     #gadw0008#0  = #gadm0005#0;     |PINTA #gadw0008#0;
     #gadw0008#1  = #gadm0005#1;     |PINTA #gadw0008#1;
     #gadw0008#2  = #gadm0005#2;     |PINTA #gadw0008#2;
     #gadw0008#3  = #gadm0005#3;
     #gadw0008#4  = #gadm0005#4;     |PINTA #gadw0008#4;
     #gadw0008#5  = #gadm0005#5;     |PINTA #gadw0008#5;
     #gadw0008#6  = #gadm0005#6;     |PINTA #gadw0008#6;
     #gadw0008#7  = #gadm0005#7;     |PINTA #gadw0008#7;
     #gadw0008#8  = #gadm0005#8;     |PINTA #gadw0008#8;
     #gadw0008#9  = #gadm0005#9;     |PINTA #gadw0008#9;
     #gadw0008#10 = #gadm0005#10;    |PINTA #gadw0008#10;
     #gadw0008#11 = #gadm0005#11;    |PINTA #gadw0008#11;
     #gadw0008#12 = #gadm0005#12;    |PINTA #gadw0008#12;
     #gadw0008#13 = #gadm0005#13;    |PINTA #gadw0008#13;
     #gadw0008#14 = #gadm0005#14;    |PINTA #gadw0008#14;
     #gadw0008#15 = #gadm0005#15;    |PINTA #gadw0008#15;
     #gadw0008#16 = #gadm0005#16;
     #gadw0008#17 = #gadm0005#17;
|FPRC;

|PROCESO PideDatos;
     |HAZ QuitaBotonSalir;

     |ESTADO_CONTROL nBtnAlt, "DISABLE";
     |ESTADO_CONTROL nBtnMod, "DISABLE";
     |ESTADO_CONTROL nBtnBaj, "DISABLE";

     |C_M #gadw0008#12, 1, "S";
     |SI eaSubde = "N";
         |C_M #gadw0008#12, 1, "N";
     |FINSI;

     |HAZ PintaDatos;
     |ENDATOS #1#gadw0008;   nFSalida = FSalida;
     |SI FSalida = 0;
         |SELECT #1#gadm0005;
         #gadm0005#0  = #gadw0008#0;
         #gadm0005#1  = #gadw0008#1;
         |LEE 101#gadm0005.=;
         |SI FSalida ! 0;
             |DDEFECTO #gadm0005;
             #gadm0005#0  = #gadw0008#0;
             #gadm0005#1  = #gadw0008#1;
             |GRABA 020#gadm0005.b;
         |FINSI;

         #gadm0005#2  = #gadw0008#2;
         #gadm0005#3  = #gadw0008#3;
         #gadm0005#4  = #gadw0008#4;
         #gadm0005#5  = #gadw0008#5;
         #gadm0005#6  = #gadw0008#6;
         #gadm0005#7  = #gadw0008#7;
         #gadm0005#8  = #gadw0008#8;
         #gadm0005#9  = #gadw0008#9;
         #gadm0005#10 = #gadw0008#10;
         #gadm0005#11 = #gadw0008#11;
         #gadm0005#12 = #gadw0008#12;
         #gadm0005#13 = #gadw0008#13;
         #gadm0005#14 = #gadw0008#14;
         #gadm0005#15 = #gadw0008#15;
         #gadm0005#16 = #gadw0008#16;
         #gadm0005#17 = #gadw0008#17;

         |GRABA 020#gadm0005.a;
         |LIBERA #gadm0005;

         enEj = #48#26;
         |HAZ GrabaSerieConta;

         |SELECT #2#gadm0005;
     |FINSI;

     |HAZ PonBotonSalir;

     |ESTADO_CONTROL nBtnAlt, "ENABLE";
     |ESTADO_CONTROL nBtnMod, "ENABLE";
     |ESTADO_CONTROL nBtnBaj, "ENABLE";

     |SI nFSalida = 0;
         |C_M #gadw0008#1, 0, aAlfa;
         |SI aAlfa = "S";
             |HAZ AltaDSCOMER;
         |FINSI;
     |FINSI;

     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO Alta;
     |DDEFECTO #gadm0005;
     #gadm0005#3 = #agicen14#1;

     |C_M #gadw0008#1, 1, "S";

     |HAZ PideDatos;
|FPRC;

|PROCESO Modificar;
     |LEE 101#gadm0005.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |C_M #gadw0008#1, 1, "N";

     |HAZ PideDatos;
|FPRC;

|PROCESO Baja;
     |CONFI "0000 Confirma la baja del registro seleccionado";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SELECT #1#gadm0005;
     |LEE 101#gadm0005.=;
     |SI FSalida ! 0;
         |SELECT #2#gadm0005;
         |FOCOTECLADO nGrid1;
         |ACABA;
     |FINSI;

     |BORRA 020#gadm0005.a;
     |LIBERA #gadm0005;

     |ESTADO_CONTROL nBtnMod,  "DISABLE";
     |ESTADO_CONTROL nBtnBaj,  "DISABLE";

     |SELECT #2#gadm0005;
     |REFRESCACONTROL nGrid1;
     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO DePatrones;
     enAct = #agicen14#1;
     |SUB_EJECUTA "gadw0010";

     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO Evnt2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#gadm0005.=;

         |ESTADO_CONTROL nBtnMod, "ENABLE";
         |ESTADO_CONTROL nBtnBaj, "ENABLE";

         |HAZ PintaDatos;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#gadm0005.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         #gadm0005#17 = "";
         |SI #gadm0005#16 = "S";
             #gadm0005#16 = "N";
             #gadm0005#17 = aRojo;
         |SINO;
             #gadm0005#16 = "S";
         |FINSI;

         |GRABA 020#gadm0005.a;
         |LIBERA #gadm0005;

         |REFRESCACONTROL nGrid2;
         |FOCOTECLADO nGrid2;
     |FINSI;
|FPRC;

|PROCESO VariablesAct;
     eaCodDep     = #agicen14#1; |QBF eaCodDep;
     eaCodDep     = ("00" + eaCodDep) % -102;
     enTipoIva    = #agicen14#7;
     enTipoTribut = #agicen14#9;
     enTipoSector = #agicen14#11;
|FPRC;

|PROCESO Evnt1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#agicen14.=;

         |HAZ VariablesAct;

         |ESTADO_CONTROL nBtnMod, "DISABLE";
         |ESTADO_CONTROL nBtnBaj, "DISABLE";

         |REFRESCACONTROL nGrid2;
     |FINSI;
|FPRC;

|PROCESO caivasesB;
     |BORRA 020#caivases.a;
     |LIBERA #caivases;
|FPRC;

|DEFBUCLE caivasesB;
     #caivases#1;
     ;
     aDF, #gadm0005#5;
     aHF, #gadm0005#5;
     be;
     NULL, caivasesB;
|FIN;

|PROCESO gadm0005A;
     aSer  = #gadm0005#1;    |QBF aSer;
     aAlfa = aSer % -102;
     |SI aAlfa ! "XX";
         |ACABA;
     |FINSI;

     aFij  = aSer % -3;
     aSer = aFij + (("00" + any_por) % -102);

     aDF = aFij;
     aHF = (aFij + "zzzzz") % 105;
     |BUCLE caivasesB;

     enEj = any_por;
     |HAZ GrabaSerieConta;
     |HAZ PideComerAuto;
     |SI enError = 0;
         |HAZ AltaDSCOMER_Auto
     |FINSI;
|FPRC;

|DEFBUCLE gadm0005A;
     #gadm0005#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gadm0005A;
|FIN;

|PROGRAMA;
     |SI PARAMETRO = "APERTURA";
         |PATH_DAT #gadm0005#fich_alta#;
         |PATH_DAT #caivases#fich_alta#;
         |PATH_DAT #calibros#fich_alta#;
         |PATH_DAT #gadz0100#fich_alta#;

         |ABRE #gadz0100;
         |LEE 101#gadz0100.p;
         |SI FSalida ! 0;
             |DDEFECTO #gadz0100;
             #gadz0100#1 = "dscomer9";
             #gadz0100#2 = enEmpreDes;
             #gadz0100#3 = eaNombreEmp;
             |GRABA 020#gadz0100.n;
             |LIBERA #gadz0100;
         |FINSI;
         |CIERRA #gadz0100;

         |BUCLE gadm0005A;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 3799, -1, 16, "Configuraci¢n de Series por departamentos";
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#gadw0008;  nPanta = FSalida;
     |PINDA #0#gadw0008;

     |CONTROL_SIMPLE nPanta, "LABEL,{{7}}Doble click en la linea para activar o desactivar el enlace", 2802, 2843, NULL;
     |CONTROL_SIMPLE nPanta, "LABEL,{{7}}Registro en rojo desactivado", 2902, 2943, NULL;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta ", 2864, 2874, Alta;
     nBtnAlt = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar ", 2876, 2886, Modificar;
     nBtnMod = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja ", 2888, 2898, Baja;
     nBtnBaj = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Series de patrones", 2845, 2862, DePatrones;

     |ESTADO_CONTROL nBtnMod, "DISABLE";
     |ESTADO_CONTROL nBtnBaj, "DISABLE";

     nRango = 4 + 8 + 16 + 32;

     |LINEAL_SIMPLE #1#agicen14, nRango, 0502, 1298, Baja1, Alta1, Evnt1;
     nGrid1 = FSalida;

     |LINEAL_SIMPLE #2#gadm0005, nRango, 1402, 2798, Baja2, Alta2, Evnt2;
     nGrid2 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n0Vent;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |SI PARAMETRO = "APERTURA";
         |ACABA;
     |FINSI;

     |HAZ DirAplicSt;
     |HAZ inicio;

     |ABRET #agicen14;
     |ABRET #gadm0005;

     nEmpresa = #48#2;
     nDAct    = 1;
     nHAct    = 99;
     |SI PARAMETRO ! "";
         nDAct    = PARAMETRO;
         nHAct    = PARAMETRO;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |SI PARAMETRO = "APERTURA";
         |ACABA;
     |FINSI;

     |CIERRAT #agicen14;
     |CIERRAT #gadm0005;
|FPRC;
