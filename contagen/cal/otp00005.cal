|FICHEROS;
  otp00005 #0;
  otp00006;
  otp00007 #2,MANTE;
  otp00008 #3;
  otp00009 #4;
  otp00010 #5;

  canempre #30;
|FIN;

|VARIABLES;
 &enPor = 0;
 nEstado  = 0;
 &nMaxDes = 0;
 &eaDirDestino = "";
 &eaDirOrigen  = "";

 aAlfa         = "";
 aAlfa1        = "";
 aAlfa2        = "";

 aAseActual    = "";
 aBaseAse      = "";
|FIN;

|INCLUYE dscont_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|| ******************************************** Calculos Pantalla
|CALCULO wTipo12; |TIPO 12;
|FCAL;

|CALCULO wTipo7; |TIPO 7;
 |PUSHV  0905 1336;
 |CUADRO 0905 1335;
 |ATRI R;
 |PINTA 0906, " 1 - Acumulados Plan Contable ";
 |PINTA 1006, " 2 - Asientos Contables       ";
 |PINTA 1106, " 3 - Registros de IVA/IRPF    ";
 |PINTA 1206, " 4 - Todos los Datos          ";
 |ATRI 0;
|FCAL;

|CALCULO wTipo0; |TIPO 0;
 |POPV;
 |HAZ elTexto;
 |PINTA #0#9;
 |SI #0#5 ! 4;
     |C_M #0#8,1,"N"; #0#8 = "N"; || |PINTA #0#8;
 |SINO;
     |C_M #0#8,1,"S";
 |FINSI;
 |SI #0#5 < 3;
     |C_M #0#12,1,"N"; #0#12 = "N"; |PINTA #0#12;
 |SINO;
     |C_M #0#12,1,"S";
 |FINSI;
 |SI #0#5 ! 2; |Y #0#5 ! 4;
     |C_M #0#13,1,"N"; #0#13 = "N"; |PINTA #0#13;
 |SINO;
     |C_M #0#13,1,"S";
 |FINSI;
|FCAL;

|PROCESO elTexto;
 #0#9 = "";
 |SI #0#5 = 1; #0#9 = "Acumulados Plan Contable "; |FINSI;
 |SI #0#5 = 2; #0#9 = "Asientos Contables       "; |FINSI;
 |SI #0#5 = 3; #0#9 = "Registros de IVA/IRPF    "; |FINSI;
 |SI #0#5 = 4; #0#9 = "Todos los Datos          "; |FINSI;
|FPRC;

|CALCULO AntesAmor; |TIPO 7;
 |SI #0#8 = "N";
     |C_M #0#7,1, "N"; #0#7 = 0; |PINTA #0#7;
 |SINO;
     |C_M #0#7,1, "S";
 |FINSI;
|FCAL;

|CALCULO verDif; |TIPO 0;
 |SI #0Campo > nMaxDes;
     |MENAV "    Error. Posicion no valida ";
     |ERROR;
 |FINSI;
|FCAL;
|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|RUTINA ClaveBajaC;
 #2#19 = aAseActual;
 #2#0  = enEmpresa;
 #2#20 = 1;
 #2#1  = 1;
|FRUT;

|RUTINA ClaveAltaC;
 #2#19 = aAseActual;
 #2#0  = enEmpresa;
 #2#20 = 9999;
 #2#1  = 99999;
|FRUT;

|CALCULO wTipo3; |TIPO 3;
 || **************************************************  Tipo3;

 |ENTLINEAL #1#2, -3, 2, 22, 0, ClaveBajaC, ClaveAltaC;

 |SI FSalida = 0;
     |HAZ LaConsolidacion;
 |FINSI;
|FCAL;

|PROGRAMA;
 |HAZ inicio;

 |DBASS aAlfa; |QBF aAlfa;
 aAlfa = aAlfa % -299; aAlfa2 = ""; aAlfa1 = "";
 |PARA; |SI aAlfa1 ! "\"; |Y aAlfa1 ! "/"; |HACIENDO;
    aAlfa2 = aAlfa1 + aAlfa2;
    aAlfa1 = aAlfa % -101; aAlfa = aAlfa % -299;
 |SIGUE;
 aAseActual = aAlfa2 - "ase";
 aBaseAse  = aAlfa + "/";

 |PATH_DAT #otp00005#aBaseAse#; |PATH_DAT #otp00006#aBaseAse#;
 |PATH_DAT #otp00007#aBaseAse#; |PATH_DAT #otp00008#aBaseAse#;
 |PATH_DAT #otp00009#aBaseAse#; |PATH_DAT #otp00010#aBaseAse#;

 |ABRE #otp00006;
 #otp00006#0  = enEmpresa;
 #otp00006#10 = aAseActual;
 |LEE 101#otp00006.=;
 |SI FSalida ! 0;
     |DDEFECTO #otp00006;
     #otp00006#0  = enEmpresa;
     #otp00006#1  = eaNombreEmp;
     #otp00006#10 = aAseActual;
     |GRABA 020#otp00006.n;
 |FINSI;
 |LIBERA #otp00006;
 |CIERRA #otp00006;

 |DFICE eaDirDestino;
 enPor = 0;
 #0#0  = #otp00006#0;
 #0#1  = enPeriodo;
 #0#2  = #otp00006#1;
 #0#3  = enEjercicio;
 #0#10 = #30#26;
 #0#4  = eaMoneda;
 #0#5  = #otp00006#2;
 #0#6  = #otp00006#3;
 #0#7  = #otp00006#4;
 #0#8  = #otp00006#5;
 #0#11 = aAseActual;
 #0#12 = #otp00006#11;
 #0#13 = #otp00006#12;
 |HAZ elTexto;
 nMaxDes = MaximoDigitos;

 |CLS;
 |CABEZA "Consolidar Empresas";
 |PINPA #0#0;
 |PINDA #0#0;

 |ENTLINEAL #1#2, -3, 7, 22, 0, ClaveBajaC, ClaveAltaC;

 |HAZ Avisa; |SI nEstado ! 0; |ACABA; |FINSI;

 |ENDATOS #1#0;
|FPRO;

|| ********************************************************************
|PROCESO Borral30;
 |BORRA 020#3a;
 |LIBERA #3;
|FPRC;

|DEFBUCLE Borral3;
 #3#1;
 ;
 #0#11, #0#0, 0000, 00001, 00;
 #0#11, #0#0, 9999, 99999, 99;
 be;
 NULL, Borral30;
|FIN;

|PROCESO Borral40;
 |BORRA 020#4a;
 |LIBERA #4;
|FPRC;

|DEFBUCLE Borral4;
 #4#1;
 ;
 #0#11, #0#0, 0000, 00001, 00;
 #0#11, #0#0, 9999, 99999, 99;
 be;
 NULL, Borral40;
|FIN;

|PROCESO LaConsolidacion;
     |ABRE #otp00006;
     #otp00006#0  = #0#0;
     #otp00006#10 = aAseActual;
     |LEE 101#otp00006.=;
     nEstado = FSalida;
     #otp00006#0 = #0#0;  #otp00006#1 = #0#2;
     #otp00006#2 = #0#5;  #otp00006#3 = #0#6;
     #otp00006#4 = #0#7;  #otp00006#5 = #0#8;
     #otp00006#10 = #0#11;
     #otp00006#11 = #0#12;
     #otp00006#12 = #0#13;
     |SI nEstado = 0; |GRABA 020#otp00006.a; |FINSI;
     |SI nEstado ! 0; |GRABA 020#otp00006.n; |FINSI;
     |LIBERA #otp00006;
     |CIERRA #otp00006;

     |SI #0#5 = 3;
         |BUCLE Borral3;
     |FINSI;
     |SI #0#5 < 3;
         |BUCLE Borral4;
     |FINSI;

     |CONFI "    SDesea Consolidar Empresas Ahora S/N ";
     |SI FSalida = 0;
         |SUB_EJECUTA_NP "otp00013";
     |FINSI;
|FPRC;

|PROCESO Avisa;
   |PUSHV 05201160;
   |CUADRO 05201160;
   |ATRI I;
   |PINTA 0621, "             ญญ ATENCION !!            ";
   |PINTA 0721, " Esta opcion destruira todos los datos ";
   |PINTA 0821, " de esta empresa para prepararla con el";
   |PINTA 0921, " fin de englobar todos los datos de las";
   |PINTA 1021, " empresas indicadas.                   ";
   |CONFI "    Nจ Desea continuar ?";
   nEstado = FSalida;
   |POPV;
|FPRC;
