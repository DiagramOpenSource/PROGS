|FICHEROS;
   cabaexpl #0;
   cacuenta #1;
   caparexp #2;
   cabaexp0 #3;
   cabaexp1 #4;
   cabaexp2 #5;
   caexistc #6;
   caexistl #7;
   caconimp #8;

   canempre #30;
   cawdatos #900;
|FIN;

|VARIABLES;
   nRedon = 0;
   nRedo1 = 0;
   nCam1  = 0;
   nCam2  = 0;
   nCam3  = 0;

   &pathbal = "";
   &balance = 1;
   &entrada = 0;
   nNume1 = 0;
   mes = 0;
   campito = 0;
   nivel = 0;
   sw_pasa = 0;
   linea = 0;
   FEstado = 0;
   posici = 0;
   debe1 = 0;
   x = 0;
   &eldesde = 0;
   &elhasta = 0;
   sw_d1 = 0;
   debe2 = 0;
   sw_d2 = 0;
   debe3 = 0;
   sw_d3 = 0;
   debe4 = 0;
   sw_d4 = 0;
   haber1 = 0;
   sw_h1 = 0;
   haber2 = 0;
   sw_h2 = 0;
   haber3 = 0;
   sw_h3 = 0;
   sw = 0;
   bloque = 0;
   agrupaci = 0;
   epigrafe = 0;
   partida = 0;
   bloque1 = 0;
   H = 0;
   sw_epi = 0;
   sw_d21 = 0;
   sw_d31 = 0;
   sw_h21 = 0;
   sw_h31 = 0;
   sw_h32 = 0;
   punto_h1 = 0;
   punto_d1 = 0;
   punto_h2 = 0;
   punto_d2 = 0;
   punto_h3 = 0;
   punto_d3 = 0;
   punto_h4 = 0;
   punto_d4 = 0;
   punto_h5 = 0;
   punto_d5 = 0;
   punto_h6 = 0;
   punto_d6 = 0;
   punto_h12 = 0;
   punto_d12 = 0;
   punto_h22 = 0;
   punto_d22 = 0;
   punto_h32 = 0;
   punto_d32 = 0;
   punto_h42 = 0;
   punto_d42 = 0;
   punto_h52 = 0;
   punto_d52 = 0;
   punto_h61 = 0;
   punto_d61 = 0;

   letrames = "";
   d = "D";
   h = "H";
   tipo = "";
   tipo1 = "";
   &sw_inf = 0;
   &cantidad = 0;
   &cantidad2 = 0;
   &variable = "";
   &canti = 0;
   &canti2 = 0;
   &doh = "";
   mes_fin = 0;
   descar = 0;
   traraf = 0;
   informe = "";
   alfa1 = "";
   &r_emp = 0;
   &r_per = 0;
   &anu = 0;
   &anu1 = 0;
   &cta = "";
   &nom = "";
   acumula = 0;
   e1 = 0;
   e2 = 0;
   e3 = 0;
   e4 = 0;
   dos = 0;
   acumul2 = 0;
   alfa2 = "";
   alfa3 = "";
   debe11 = 0;
   debe21 = 0;
   debe31 = 0;
   debe41 = 0;
   haber11 = 0;
   haber21 = 0;
   haber31 = 0;
   tracan5 = 0;
   &d_mes = 0;
   &h_mes = 0;
   &estru = 0;
   &r_eje = 0;
   &r_nom = "";
   &aparam = "";

  &eaNomFEst  = "";  ||Nombre del Fichero Creado
  &eaEstruc   = "";
  &eaEstrucN  = "";
  &enCam1     = 0;
  &enCam2     = 0;
  aNomCta     = "";
  aNomCta1    = "";
   &nPagDup = 0;
   &nSwPagDup = 0;
   &pagina = 0;
   sw_pagina = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE digito_i;

|PROCESO &c_pagina;
   |SI sw_pagina = 0;
      pagina = #0#19;
      sw_pagina = 1;

      nPagDup = #0#19;
      nSwPagDup = 1;
   |SINO;
      pagina = pagina + 1;

      |HAZ PDuplex;
   |FINSI;
|FPRC;

|PROCESO antesque;

   aNomCta = "cacuenta";
   aparam = PARAMETRO;
   |QBF aparam; |SI aparam = " N"; aparam = ""; |FINSI;
   |SI aparam = "fech";
       aNomCta = "cabalano";
   |FINSI;
   |SI aparam = "Analitica";
       aNomCta = eaUsuAna;
   |FINSI;
   |SI aparam = "otp";
       aNomCta = eaNomFEst;
       #0#9    = 0;
       #0#10   = 0;
       #0#11   = "";
       d_desde = 0;
       d_hasta = 0;
       d_masca = "";
   |FINSI;
   |NOME_DAT #1 aNomCta;
   aNomCta1 = aNomCta;
|FPRC;

|| ========================================================================
||                        CALCULOS PANTALLA
|| ========================================================================
|CALCULO inicio_b; |TIPO 8;
  |HAZ inicial;
  |SI swerror = 2; |PTEC 807; |ACABA; |FINSI;
  |SI swerror = 3; |PTEC 831; |PTEC 807; |ACABA; |FINSI;
  |HAZ DirAplicSt;
|FCAL;

|CALCULO AnaT13; |TIPO 13;
 aparam = PARAMETRO; |QBF aparam; |SI aparam = " N"; aparam = ""; |FINSI;
 |SI aparam = "Analitica";
     |ATRI P;
     |PINTA 0572, "ANALITICO";
     |ATRI 0;
     #30#1 = eaNomAna;
 |FINSI;
   |SI aparam = "otp";
       #0#9  = enCam1;   |PINTA #0#9;
       #0#10 = enCam2;   |PINTA #0#10;
       #0#11 = eaEstruc; |PINTA #0#11;
       |C_M #0#9, 1,"N";
       |C_M #0#10,1,"N";
       |C_M #0#11,1,"N";
       |ATRI P;
       |PINTA 0570, "ESTRUCTURA";
       |ATRI 0;
   |FINSI;
|FCAL;

|PROCESO mayor1;
   |SI #0Campo = "N";
       #0#14 = empre;
       #0#15 = ejerc;
       |CAMPO_MODIFICA #0#14,1,"N";
       |CAMPO_MODIFICA #0#15,1,"N";
       |PINTA #0#14;
       |PINTA #0#15;
   |SINO;
       |CAMPO_MODIFICA #0#14,1,"S";
       |CAMPO_MODIFICA #0#15,1,"S";
   |FINSI;
|FPRC;

|PROCESO deentrada;  |TIPO 7;
   |SI #0#14 = 0;  |Y #0#15 = 0;
       #0#14 = empre;
       #0#15 = ejerc - 1;
       |SI #0#15 < 0; #0#15 = 9; |FINSI;
       |PINTA #0#14;
       |PINTA #0#15;
 |FINSI;
 #0#6 = 1;
 |SI Haybasica = 1; |Y eaDepar = "S";
     #0#6 = 0;
 |FINSI;
 |PINTA #0#6;
 |HAZ DatosEmp;
|FPRC;

|PROCESO esbuena;
   |SI FSalida = 9;  |ACABA;  |FINSI;
   |ABRE #30;
   #canempre#2 = #0#14;
   #canempre#3 = 0;
   |LEE 011#30];
   |SI FSalida ! 0;  |O #canempre#2 ! #0#14;
      |MENAV "     NO Existe la empresa Contable";
      |ERROR;
   |FINSI;
   |CIERRA #30;
|FPRC;

|PROCESO consulta;
   |SI FSalida ! 9;  |ACABA;  |FINSI;

   r_emp = 0;
   |SUB_EJECUTA "caconemp.run";

   |ERROR;
   |SI Campo = 14;
      #0#14 = r_emp;
      #0#15 = r_per;
      |PTEC 802;
      |PTEC 802;
   |FINSI;
|FPRC;

|PROCESO esbuena1;
   |SI FSalida = 2; |ACABA; |FINSI;
   |ABRE #30;
   #canempre#2 = #0#14;
   #canempre#3 = #0#15;
   |LEE 011#30=;
   |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la empresa Contable";
      |CIERRA #30;
      |ERROR;
      |ACABA;
   |FINSI;
   |SI #canempre#13 ! dig3;  |O #canempre#14 ! dig4;  |O #canempre#15 ! dig5;
      |O #canempre#16 ! dig6;  |O #canempre#17 ! dig7;
      |O #canempre#18 ! dig8;  |O #canempre#19 ! dig9;
      |MENAV "     NO CORRESPONDEN LOS NIVELES";
      |CIERRA #30;
      |ERROR;
      |ACABA;
   |FINSI;
   #0#16 = #canempre#1;
   anu1 = 1900 + #canempre#26;
   |SI anu1 [ 1970;
      anu1 = anu1 + 100;
   |FINSI;
   |PINTA #0#16;
   #canempre#2 = empre;
   #canempre#3 = ejerc;
   |LEE 011#30=;
   anu = 1900 + #canempre#26;
   |SI anu [ 1970;
      anu = anu + 100;
   |FINSI;
   |CIERRA #30;
|FPRC;

|PROCESO pintames; |TIPO 0;
  nNume1 = Campo + 2;
  |SI #0Campo ! 0; |Y #0Campo ! 13;
       NumMes = dig1 + (#0Campo - 1);
       |SI NumMes > 12;
           NumMes = NumMes - 12;
       |FINSI;
  |SINO;
       NumMes = #0Campo;
  |FINSI;
  |HAZ NombreMes;
  #0nNume1 = NombreMes; |PINTA #0nNume1;

   |SI Campo = 1;  |Y #0#0 > #0#1;
       |MENAV "    Error de Entrada ...";
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO pintames2; |TIPO 0;
  |SI #0Campo ! 0; |Y #0Campo ! 13;
      NumMes = dig1 + (#0Campo - 1);
      |SI NumMes > 12;   NumMes = NumMes - 12;  |FINSI;
  |SINO;
      NumMes = #0Campo;
  |FINSI;
  |HAZ NombreMes;

  |ATRI I;
  |SI Campo = 7;  |PINTA 1727, NombreMes;  |FINSI;
  |SI Campo = 8;  |PINTA 1827, NombreMes;  |FINSI;
  |ATRI 0;
  |SI Campo = 8;  |Y #0#7 > #0#8;
      |MENAV "    Error de Entrada ...";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO nivel; |TIPO 7;
   |SI #0#4 = "N";
       |CAMPO_MODIFICA #0#5,1,"N";
   |SINO;
       |CAMPO_MODIFICA #0#5,1,"S";
   |FINSI;
|FPRC;

|PROCESO miraniv; |TIPO 0;
   nivel = #0#5;
   |SI nivel = 1;|Y dig4 = 0;  |AVISO;  |ERROR;  |FINSI;
   |SI nivel = 2;|Y dig5 = 0;  |AVISO;  |ERROR;  |FINSI;
   |SI nivel = 3;|Y dig6 = 0;  |AVISO;  |ERROR;  |FINSI;
   |SI nivel = 4;|Y dig7 = 0;  |AVISO;  |ERROR;  |FINSI;
   |SI nivel = 5;|Y dig8 = 0;  |AVISO;  |ERROR;  |FINSI;
   |SI nivel = 6;|Y dig9 = 0;  |AVISO;  |ERROR;  |FINSI;
|FPRC;


|PROCESO estruct; |TIPO 0;
   |SI #0#6 ! 0;
       |ABRE #6;
       #caexistc#0 = #0#6;
       |LEE 040#6=;
       |SI FSalida ! 0;
           |MENAV "    No existe la estructura de descarga.";
           |CIERRA #6;
           |ERROR;
           |ACABA;
       |FINSI;
       |CIERRA #6;
   |FINSI;
|FPRC;

|PROCESO DatosEmp; |TIPO 7;
 |ABRE #8;
 |DDEFECTO #8;
 #8#0 = 1;
 |LEE 011#8=;
 |CIERRA #8;
 #0#18 = #8#7; |PINTA #0#18;
 alfa1 = #8#8; |C_M #0#18,1,alfa1;
|FPRC;

|| ========================================================================
||                        CALCULOS INFORME
|| ========================================================================
|PROCESO miracuen;
   |SI #4e3 = #1#0;

       descar = #4e1 - #4e2;
       |SI #1#5 = "H"; descar = -descar; |FINSI;
       cantidad = cantidad + descar;
       sw_pasa = 1;

   |FINSI;
|FPRC;

|DEFBUCLE cabaexpl4;
   #4#1;
   ;
   #0#6, 001;
   #0#6, 999;
   e;
   NULL, miracuen;
|FIN;

|PROCESO calculit;
   |HAZ digitos2;
   |SI d_error ! 0;  |ACABA;  |FINSI;
   |SI #0#4 = "N";  |Y #1#3 = "N";                     |ACABA;  |FINSI;
   |SI #0#4 = "S";  |Y #1#55 > nivel;                  |ACABA;  |FINSI;
   |SI #0#4 = "S";  |Y #1#3 = "N";  |Y #1#55 ! nivel;  |ACABA;  |FINSI;
   |HAZ grabatra;

   |SI #0#13 = "N"; |ACABA; |FINSI;
   |SI #0#4 = "N";  |ACABA; |FINSI;
   |BUCLE cabaexpl4;
   |SI sw_pasa = 1; |ACABA; |FINSI;
   |HAZ grabatr4;
|FPRC;

|DEFBUCLE cabaexpl0;
   #1#4;
   ;
   "D", 1, 01, 00, 00;
   "H", 4, 99, 99, 99;
   e;
   NULL, calculit;
|FIN;

|PROCESO SinDebe;
    tipo ="D";
    bloque = 4;
    |HAZ mirablo;
    |PIEINF;
|FPRC;

|PROCESO SinHaber;
    tipo ="H";
    bloque = 3;
    |HAZ mirablo;
|FPRC;

|PROCESO impresio;
   |SI sw = 0;
      |SI #cabaexp0#0 = "H";
          |HAZ SinDebe;
          doh = "HABER";
      |FINSI;
      |SI #cabaexp0#0 = "D"; doh = "DEBE";  |FINSI;
      bloque   = #cabaexp0#1;
      tipo     = #cabaexp0#0;
      agrupaci = #cabaexp0#2;
      epigrafe = #cabaexp0#3;
      partida  = #cabaexp0#4;
      sw_inf = 0;
      |PRINT;
      sw = 1;
   |FINSI;

   |SI bloque = #cabaexp0#1; |Y tipo = #cabaexp0#0;
      |HAZ epigraf;
   |SINO;
      |SI tipo ! #cabaexp0#0;                    || ruptura por tipo
         bloque1 = bloque;
         bloque = 4;
         |HAZ mirablo;
         |PIEINF;
         sw_inf = 0;
         doh = "HABER";
         |PRINT;
         |HAZ epigraf;
         bloque = bloque1;
      |SINO;                              || ruptura por bloque
         |HAZ mirablo;
         |HAZ epigraf;
      |FINSI;
      bloque = #cabaexp0#1;
      tipo = #cabaexp0#0;
   |FINSI;
|FPRC;

|DEFBUCLE cabaexpl1;
   #3#1;
   ;
   "D", 1, 01, 00, 00;
   "H", 4, 99, 99, 99;
   e;
   NULL, impresio;
|FIN;

|PROCESO cuentas;
   |HAZ digitos2;
   |SI d_error ! 0;  |ACABA;  |FINSI;
   |SI #0#4 = "N";  |Y #1#3 = "N";                     |ACABA;  |FINSI;
   |SI #0#4 = "S";  |Y #1#55 > nivel;                  |ACABA;  |FINSI;
   |SI #0#4 = "S";  |Y #1#3 = "N";  |Y #1#55 ! nivel;  |ACABA;  |FINSI;
   sw_pasa = 0;
   cantidad = 0;
   sw_inf = 6;
   e1 = 4;
   e2 = 5;
   e3 = 6;
   e4 = 7;
   |BUCLE cabaexpl4;
   |SI sw_pasa = 0;
       |SI #cabaexp0#0 =  "D";
           |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
                 impMoneda = #1x;
                 |SI aMonedaC ! aMonedaA; |Y dos = 2;
                     |HAZ ElCMoneda;
                 |FINSI;
                 cantidad = cantidad + impMoneda;
           |SIGUE;
      |SINO;
           |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
                 impMoneda = #1x;
                  |SI aMonedaC ! aMonedaA; |Y dos = 2;
                      |HAZ ElCMoneda;
                  |FINSI;
                  cantidad = cantidad + (impMoneda * -1);
           |SIGUE;
      |FINSI;
   |FINSI;
   cantidad = cantidad ! EURODB;
   |SI cantidad ! 0; |PRINT; |FINSI;
|FPRC;

|PROCESO cuenta1;

   sw_inf = 6;
   cantidad = 0;
   cantidad2 = 0;
   cta       = #cabaexp2#5;
   nom       = #cabaexp2#7;
   cantidad  = #cabaexp2#11;
   cantidad2 = #cabaexp2#12;

   cantidad   = cantidad ! EURODB;
   cantidad2  = cantidad2 ! EURODB;
   |SI cantidad ! 0;|O cantidad2 ! 0;
       |PRINT;
   |FINSI;

|FPRC;

|DEFBUCLE cabaexpl2;
   #1#4;
   ;
   #3#0, #3#1, #3#2, #3#3, #3#4;
   #3#0, #3#1, #3#2, #3#3, #3#4;
   e;
   NULL, NULL, NULL, NULL, NULL, cuentas;
   #1#0, #1#1;
|FIN;

|DEFBUCLE cabaexpl5;
   #5#1;
   ;
   #3#0, #3#1, #3#2, #3#3, #3#4, "            ", 0;
   #3#0, #3#1, #3#2, #3#3, #3#4, "zzzzzzzzzzzz", 9;
   e;
   NULL, NULL, NULL, NULL, NULL, cuenta1;
   #5#5, #5#6;
|FIN;

|PROCESO grabatra;
   #cabaexp0#0 = #1#5;
   #cabaexp0#1 = #1#4;
   #cabaexp0#2 = #1#6;
   #cabaexp0#3 = #1#7;
   #cabaexp0#4 = #1#8;
   |LEE 101#3=;
   FEstado = FSalida;
   |SI FEstado ! 0;
      |DDEFECTO #3;
      #cabaexp0#0 = #1#5;
      #cabaexp0#1 = #1#4;
      #cabaexp0#2 = #1#6;
      #cabaexp0#3 = #1#7;
      #cabaexp0#4 = #1#8;
      |HAZ leexplot;
      #cabaexp0#5 = #caparexp#3;
      #cabaexp0#6 = #caparexp#5;
      #cabaexp0#7 = #caparexp#7;
   |FINSI;
   sw_pasa = 0;
   |BUCLE cabaexpl4;
   |SI sw_pasa = 0;
      |HAZ resulta;
      #cabaexp0#9 = 0;
      |SI #cabaexp0#acumula# ! 0;
          |SI FEstado = 0;
              |GRABA 020#3a;
          |SINO;
              |GRABA 020#3n;
          |FINSI;
      |SINO;
         |SI FEstado = 0;
             |GRABA 020#3a;
         |FINSI;
      |FINSI;
   |FINSI;
   |LIBERA #3;
|FPRC;

|PROCESO grabatr1;
   #1#0 = #4e3;
   #1#1 = #4e4;
   |LEE 040#1=;
   |SI FSalida ! 0; |ACABA;  |FINSI;
   #cabaexp0#0 = #1#5;
   #cabaexp0#1 = #1#4;
   #cabaexp0#2 = #1#6;
   #cabaexp0#3 = #1#7;
   #cabaexp0#4 = #1#8;
   |LEE 101#3=;
   FEstado = FSalida;
   |SI FEstado ! 0;
       |DDEFECTO #3;
       #cabaexp0#0 = #1#5;
       #cabaexp0#1 = #1#4;
       #cabaexp0#2 = #1#6;
       #cabaexp0#3 = #1#7;
       #cabaexp0#4 = #1#8;
       |HAZ leexplot;
       #cabaexp0#5 = #caparexp#3;
       #cabaexp0#6 = #caparexp#5;
       #cabaexp0#7 = #caparexp#7;
   |FINSI;
   |SI #1#5 = "H"; descar = -descar; |FINSI;
   #cabaexp0#acumula# = #cabaexp0#acumula# + descar;
   #cabaexp0#9 = 1;
   |SI #cabaexp0#acumula# ! 0;
      |SI FEstado = 0; |GRABA 020#3a; |SINO; |GRABA 020#3n; |FINSI;
   |FINSI;
   |LIBERA #3;
   |HAZ sumasal;
|FPRC;

|PROCESO grabatr2; || graba cuenta de VARIACION DE EXISTENCIAS
   |HAZ cargatra;
   |SI #1#5 = "H"; tracan5 = -tracan5; |FINSI;
   #cabaexp2#acumul2# = #cabaexp2#acumul2# + tracan5;
   |GRABA 020#5a;
   |LIBERA #5;
|FPRC;

|PROCESO grabatr4; || graba cuenta de trabajo exp2
   |HAZ cargatra;
   #cabaexp2#acumul2# = 0;
   |SI #1#5 = "D";
       |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
             impMoneda = #1x;
             |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
             #cabaexp2#acumul2# = #cabaexp2#acumul2# + impMoneda;
      |SIGUE;
   |SINO;
      |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
             impMoneda = #1x;
             |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
            #cabaexp2#acumul2# = #cabaexp2#acumul2# + (impMoneda * -1);
       |SIGUE;
   |FINSI;
   |GRABA 020#5a;
   |LIBERA #5;
|FPRC;

|PROCESO cargatra;
   #cabaexp2#0 = #1#5;
   #cabaexp2#1 = #1#4;
   #cabaexp2#2 = #1#6;
   #cabaexp2#3 = #1#7;
   #cabaexp2#4 = #1#8;
   |HAZ acortacuen;
   #cabaexp2#5 = #1#0;
   #cabaexp2#6 = #1#1;
   #cabaexp2#7 = #1#2;
   |LEE 000#5=;
   |SI FSalida ! 0;
      |DDEFECTO #5;
      #cabaexp2#0 = #1#5;
      #cabaexp2#1 = #1#4;
      #cabaexp2#2 = #1#6;
      #cabaexp2#3 = #1#7;
      #cabaexp2#4 = #1#8;
      |HAZ acortacuen;
      #cabaexp2#5 = #1#0;
      #cabaexp2#6 = #1#1;
      #cabaexp2#7 = #1#2;
      #cabaexp2#11 = 0;
      #cabaexp2#12 = 0;
      |GRABA 020#5c;
   |FINSI;
   |DDEFECTO #2;
   #caparexp#0 = #1#5;
   #caparexp#1 = #1#6;
   #caparexp#3 = #1#7;
   #caparexp#5 = #1#8;
   |LEE 000#2=;
   |SI FSalida ! 0;
      #caparexp#2 = "";
      #caparexp#4 = "";
      #caparexp#6 = "";
   |FINSI;
   #cabaexp2#8 = #caparexp#2;
   #cabaexp2#9 = #caparexp#4;
   #cabaexp2#10 = #caparexp#6;
|FPRC;

|PROCESO acortacuen;
   |SI nivel < #1#1;
      |SI nivel = 1;  traraf = 100 + dig4;  |FINSI;
      |SI nivel = 2;  traraf = 100 + dig5;  |FINSI;
      |SI nivel = 3;  traraf = 100 + dig6;  |FINSI;
      |SI nivel = 4;  traraf = 100 + dig7;  |FINSI;
      |SI nivel = 5;  traraf = 100 + dig8;  |FINSI;
      #1#0 = #1#0 % traraf;
      #1#1 = #cabaexpl#5;
      #1#0 = #1#0 + "              ";
      #1#0 = #1#0 % 112;
   |FINSI;
|FPRC;


|PROCESO resulta;    || Calculamos cada cuenta

   |SI #cabaexp0#0 = "D"; |Y #cabaexp0#1 = 1;
      |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
             #cabaexp0#acumula# = #cabaexp0#acumula#   + impMoneda;
             debe1 = debe1 + impMoneda;
      |SIGUE;
       sw_d1 = 1;
   |FINSI;

   |SI #cabaexp0#0 = "D"; |Y #cabaexp0#1 = 2;
       |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
             #cabaexp0#acumula# = #cabaexp0#acumula#   + impMoneda;
             debe2 = debe2 + impMoneda;
      |SIGUE;
      sw_d2 = 1;
   |FINSI;

   |SI #cabaexp0#0 = "D"; |Y #cabaexp0#1 = 3;
      |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
             #cabaexp0#acumula# = #cabaexp0#acumula#   + impMoneda;
             debe3 = debe3 + impMoneda;
      |SIGUE;
      sw_d3 = 1;
   |FINSI;

   |SI #cabaexp0#0 = "D"; |Y #cabaexp0#1 = 4;
      |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
             #cabaexp0#acumula# = #cabaexp0#acumula#   + impMoneda;
             debe4 = debe4 + impMoneda;
      |SIGUE;
       sw_d4 = 0;
   |FINSI;

   |SI #cabaexp0#0 = "H"; |Y #cabaexp0#1 = 1;
       |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
             |FINSI;
            #cabaexp0#acumula#   = #cabaexp0#acumula#   + (impMoneda * -1);
            haber1 = haber1 + (impMoneda * -1);
      |SIGUE;
      sw_h1 = 1;
   |FINSI;

   |SI #cabaexp0#0 = "H"; |Y #cabaexp0#1 = 2;
      |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
            |FINSI;
            #cabaexp0#acumula#   = #cabaexp0#acumula#   + (impMoneda * -1);
            haber2 = haber2 + (impMoneda * -1);
      |SIGUE;
      sw_h2 = 1;
   |FINSI;

   |SI #cabaexp0#0 = "H"; |Y #cabaexp0#1 = 3;
      |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
            impMoneda = #1x;
            |SI aMonedaC ! aMonedaA; |Y dos = 2;
                 |HAZ ElCMoneda;
            |FINSI;
            #cabaexp0#acumula#   = #cabaexp0#acumula#   + (impMoneda * -1);
            haber3 = haber3 + (impMoneda * -1);
      |SIGUE;
      sw_h3 = 1;
   |FINSI;
|FPRC;

|PROCESO sumasal;    || Calculamos cada cuenta
   |SI #1#5 = "D"; |Y #1#4 = 1;
      debe1 = debe1 + descar;
   |FINSI;

   |SI #1#5 = "D"; |Y #1#4 = 2;
      debe2 = debe2 + descar;
   |FINSI;

   |SI #1#5 = "D"; |Y #1#4 = 3;
      debe3 = debe3 + descar;
   |FINSI;

   |SI #1#5 = "D"; |Y #1#4 = 4;
      debe4 = debe4 + descar;
   |FINSI;

   |SI #1#5 = "H"; |Y #1#4 = 1;
      haber1 = haber1 + descar;
   |FINSI;

   |SI #1#5 = "H"; |Y #1#4 = 2;
      haber2 = haber2 + descar;
   |FINSI;

   |SI #1#5 = "H"; |Y #1#4 = 3;
      haber3 = haber3 + descar;
   |FINSI;
|FPRC;

|PROCESO epigraf;
   |SI epigrafe ! #cabaexp0#3;
      sw_epi = 0;
   |FINSI;
   |HAZ rotura;
   epigrafe = #cabaexp0#3;
|FPRC;

|PROCESO rotura;
   |SI #cabaexp0#4 = 0;
      sw_inf = 2;
      |PRINT;
      |SI #0#4 = "S";
         |SI #0#13 = "N";
            |BUCLE cabaexpl2;
         |SINO;
            |BUCLE cabaexpl5;
         |FINSI;
         sw_inf = 5;
         |PRINT;
      |FINSI;
   |SINO;
      |SI sw_epi = 0;
         sw_inf = 3;       || epigrafe
         |PRINT;
         sw_epi = 1;       || variables
      |FINSI;
      sw_inf = 4;           || partida
      |PRINT;
      |SI #0#4 = "S";
         |SI #0#13 = "N";
            |BUCLE cabaexpl2;
         |SINO;
            |BUCLE cabaexpl5;
         |FINSI;
         sw_inf = 5;
         |PRINT;          || linea en blanco
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO leexplot;  || Lee el fichero de explotacion
   #caparexp#0 = #cabaexp0#1;
   #caparexp#1 = #cabaexp0#0;
   #caparexp#2 = #cabaexp0#2;
   #caparexp#4 = #cabaexp0#3;
   #caparexp#6 = #cabaexp0#4;
   |LEE 040#2=; |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
|FPRC;

|PROCESO final;    || Para cuando acaba el defbucle
  |SI tipo = "D";
       bloque = 4;
       |HAZ mirablo;
       |HAZ SinHaber;
  |FINSI;
  |SI tipo = "H";
       bloque = 3;
      |HAZ mirablo;
  |FINSI;
|FPRC;

|PROCESO mirablo;
   sw_inf = 1;
   |SI tipo = "D";
      |HAZ bloqued1;
      |SI bloque = 1;  |Y #cabaexp0#1 [ 2;  |ACABA;  |FINSI;
      |HAZ bloqued2;
      |SI bloque [ 2;  |Y #cabaexp0#1 [ 3;  |ACABA;  |FINSI;
      |HAZ bloqued3;
      |SI bloque [ 3;  |ACABA;  |FINSI;
      |HAZ bloqued4;
   |FINSI;
   |SI tipo = "H";
      |HAZ bloqueh1;
      |SI bloque = 1;  |Y #cabaexp0#1 [ 2;  |ACABA;  |FINSI;
      |HAZ bloqueh2;
      |SI bloque [ 2;  |ACABA;  |FINSI;
      |HAZ bloqueh3;
   |FINSI;
|FPRC;

|PROCESO bloqued1;
   |SI sw_d1 = 1; |O sw_h1 = 1; |HAZ tipod1;  |FINSI;      || I
|FPRC;

|PROCESO bloqued2;
   |SI sw_d2 = 1; |O sw_h2 = 1; |HAZ tipod2;  |FINSI;      || II
   |SI sw_d21 = 0;              |HAZ tipod21; |FINSI;      || III
|FPRC;

|PROCESO bloqued3;
   |SI sw_d3 = 1; |O sw_h3 = 1; |HAZ tipod3;  |FINSI;      || IV
   |SI sw_d31 = 0;              |HAZ tipod31; |FINSI;      || V
|FPRC;

|PROCESO bloqued4;
   |SI sw_d4 = 0;               |HAZ tipod4;  |FINSI;      || VI
|FPRC;

|PROCESO bloqueh1;
   |SI sw_d1 = 1; |O sw_h1 = 1; |HAZ tipoh1;  |FINSI;      || I
|FPRC;

|PROCESO bloqueh2;
   |SI sw_d2 = 1; |O sw_h2 = 1; |HAZ tipoh2;  |FINSI;      || II
   |SI sw_h21 = 0;              |HAZ tipoh21; |FINSI;      || III
|FPRC;

|PROCESO bloqueh3;
   |SI sw_d3 = 1; |O sw_h3 = 1; |HAZ tipoh3;  |FINSI;      || IV
   |SI sw_h31 = 0;              |HAZ tipoh31; |FINSI;      || V
   |SI sw_h32 = 0;              |HAZ tipoh32; |FINSI;      || VI
|FPRC;

|PROCESO tipod1;
   variable = "  I. BENEFICIOS DE EXPLOTACION ..........................";
   canti  = haber11 - debe11;
   canti2 = haber1 - debe1;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti < 0;
         punto_h1 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d1 = 0;
         sw_h1 = 0;
         punto_d1 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti < 0;
         punto_h1 = canti * -1;
         canti = 0;
      |SINO;
         punto_d1 = canti;
      |FINSI;
      |SI canti2 < 0;
         punto_h12 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_d12 = canti2;
      |FINSI;
      |SI sw_d1 = 0; |ACABA; |FINSI;
      |SI canti > 0; |Y canti2 > 0; sw_h1 = 0; |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d1 = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipoh1;
   variable = "  I. PERDIDAS DE EXPLOTACION ............................";
   canti = debe11 - haber11;
   canti2 = debe1 - haber1;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti [ 0;
         punto_d1 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d1 = 0;
         sw_h1 = 0;
         punto_h1 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti [ 0;
         punto_d1 = canti * -1;
         canti = 0;
      |SINO;
         punto_h1 = canti;
      |FINSI;
      |SI canti2 [ 0;
         punto_d12 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_h12 = canti2;
      |FINSI;
      |SI sw_h1 = 0; |ACABA; |FINSI;
      |SI canti > 0; |Y canti2 > 0; sw_d1 = 0; |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h1 = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipod2;
   variable = " II. RESULTADOS FINANCIEROS POSITIVOS ...................";
   canti = haber21 - debe21;
   canti2 = haber2 - debe2;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti < 0;
         punto_h2 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d2 = 0;
         sw_h2 = 0;
         punto_d2 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti < 0;
         punto_h2 = canti * -1;
         canti = 0;
      |SINO;
         punto_d2 = canti;
      |FINSI;
      |SI canti2 < 0;
         punto_h22 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_d22 = canti2;
      |FINSI;
      |SI sw_d2 = 0; |ACABA; |FINSI;
      |SI canti > 0; |Y canti2 > 0; sw_h2 = 0; |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d2 = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipod21;
   variable = "III. BENEFICIOS DE LAS ACTIVIDADES ORDINARIAS ...........";
   canti = punto_d1 + punto_d2 - punto_h1 - punto_h2;
   canti2 = punto_d12 + punto_d22 - punto_h12 - punto_h22;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti < 0;
         punto_h3 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d21 = 1;
         punto_d3 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti < 0;
         punto_h3 = canti * -1;
         canti = 0;
      |SINO;
         punto_d3 = canti;
      |FINSI;
      |SI canti2 < 0;
         punto_h32 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_d32 = canti2;
      |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d21 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipoh2;
   variable = " II. RESULTADOS FINANCIEROS NEGATIVOS ...................";
   canti = debe21 - haber21;
   canti2 = debe2 - haber2;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti [ 0;
         punto_d2 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d2 = 0;
         sw_h2 = 0;
         punto_h2 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti [ 0;
         punto_d2 = canti * -1;
         canti = 0;
      |SINO;
         punto_h2 = canti;
      |FINSI;
      |SI canti2 [ 0;
         punto_d22 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_h22 = canti2;
      |FINSI;
      |SI sw_h2 = 0; |ACABA; |FINSI;
      |SI canti > 0; |Y canti2 > 0; sw_d2 = 0; |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h2 = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipoh21;
   variable = "III. PERDIDAS DE LAS ACTIVIDADES ORDINARIAS .............";
   canti = punto_h1 + punto_h2 - punto_d1 - punto_d2;
   canti2 = punto_h12 + punto_h22 - punto_d12 - punto_d22;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti [ 0;
         punto_d3 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h21 = 1;
         punto_h3 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti [ 0;
         punto_d3 = canti * -1;
         canti = 0;
      |SINO;
         punto_h3 = canti;
      |FINSI;
      |SI canti2 [ 0;
         punto_d32 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_h32 = canti2;
      |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h21 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipod3;
   variable = " IV. RESULTADOS EXTRAORDINARIOS POSITIVOS ...............";
   canti = haber31 - debe31;
   canti2 = haber3 - debe3;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti < 0;
         punto_h4 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d3 = 0;
         sw_h3 = 0;
         punto_d4 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti < 0;
         punto_h4 = canti * -1;
         canti = 0;
      |SINO;
         punto_d4 = canti;
      |FINSI;
      |SI canti2 < 0;
         punto_h42 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_d42 = canti2;
      |FINSI;
      |SI sw_d3 = 0; |ACABA; |FINSI;
      |SI canti > 0; |Y canti2 > 0; sw_h3 = 0; |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d3 = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipod31;
   variable = "  V. BENEFICIO ANTES DE IMPUESTOS .......................";
   canti = punto_d3 + punto_d4 - punto_h3 - punto_h4;
   canti2 = punto_d32 + punto_d42 - punto_h32 - punto_h42;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti < 0;
         punto_h5 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d31 = 1;
         punto_d5 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti < 0;
         punto_h5 = canti * -1;
         canti = 0;
      |SINO;
         punto_d5 = canti;
      |FINSI;
      |SI canti2 < 0;
         punto_h52 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_d52 = canti2;
      |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d31 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipoh3;
   variable = " IV. RESULTADOS EXTRAORDINARIOS NEGATIVOS ...............";
   canti = debe31 - haber31;
   canti2 = debe3 - haber3;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti [ 0;
         punto_d5 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d3 = 0;
         sw_h3 = 0;
         punto_h4 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti [ 0;
         punto_d5 = canti * -1;
         canti = 0;
      |SINO;
         punto_h4 = canti;
      |FINSI;
      |SI canti2 [ 0;
         punto_d52 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_h42 = canti2;
      |FINSI;
      |SI sw_h3 = 0; |ACABA; |FINSI;
      |SI canti > 0; |Y canti2 > 0; sw_d3 = 0; |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h3 = 0;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipoh31;
   variable = "  V. PERDIDAS ANTES DE IMPUESTOS ........................";
   canti = punto_h3 + punto_h4 - punto_d3 - punto_d4;
   canti2 = punto_h32 + punto_h42 - punto_d32 - punto_d42;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti [ 0;
         punto_d5 = canti * -1;
         canti = 0;
      |SINO;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h31 = 1;
         punto_h5 = canti;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti [ 0;
         punto_d5 = canti * -1;
         canti = 0;
      |SINO;
         punto_h5 = canti;
      |FINSI;
      |SI canti2 [ 0;
         punto_d52 = canti2 * -1;
         canti2 = 0;
      |SINO;
         punto_h52 = canti2;
      |FINSI;
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h31 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipoh32;
   variable = " VI. RESULTADO DEL EJERCICO (PERDIDAS) ..................";
   canti = punto_h61;
   canti2 = punto_h6;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h32 = 1;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_h32 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO tipod4;
   variable = " VI. RESULTADO DEL EJERCICIO (BENEFICIOS) ...............";
   canti = punto_d61;
   canti2 = punto_d6;
   ||------------------------------------- Solo una empresa
   |SI #0#13 = "N";
      |SI canti > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d4 = 1;
      |FINSI;
   |SINO; || --------------------------------------- las dos empresas
      |SI canti > 0; |O canti2 > 0;
         sw_inf = 5; |PRINT;
         sw_inf = 1; |PRINT;
         sw_inf = 5; |PRINT;
         sw_d4 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO conexi; |TIPO 0;

   enTExi = 1;
   nCam1 = empre;
   nCam2 = ejerc;
   nCam3 = enEjercicio;
   d_mes = #0#7;
   h_mes = #0#8;
   estru = #0#6;
   r_emp = empre;
   r_per = ejerc;
   r_eje = #canempre#26;
   r_nom = #canempre#1;
   |SUB_EJECUTA "caexicon.run";

   |SI #0#13 = "N"; |ACABA; |FINSI;

   enTExi = 1;
   r_emp = #0#14;
   r_per = #0#15;
   r_eje = anu1 - 2000; |SI r_eje < 0; r_eje = anu1 - 1900; |FINSI;
   r_nom = #0#16;
   estru = #0#6;
   |SUB_EJECUTA "caexicon.run";

   eaMoneda = aMonedaA; |HAZ Monedas;

   empre = nCam1;
   ejerc = nCam2;
   enEjercicio = nCam3;
|FPRC;

|PROCESO impre; |TIPO 3;

   eaIa = #canempre#21;
   enM1 = #0#0;
   enM2 = #0#1;
   |HAZ LeeDatosEmpresa;
   |SI aparam = "fech";
       |SI enM1 ! enM1f;
           NumMes = enM1f; |HAZ NombreMes; #0#2 = NombreMes;
       |FINSI;
       |SI enM2 ! enM2f;
           NumMes = enM2f; |HAZ NombreMes; #0#3 = NombreMes;
       |FINSI;
   |FINSI;

   |SI enMAper ! dig1;
       |SI #0#1 < enMAper; |Y #0#1 ! 0;
           |ACABA;
       |FINSI;
   |FINSI;

   aMonedaA = eaMoneda;
   |SI #0#13 = "N"; aMonedaC = aMonedaA; |FINSI;
   |HAZ antesque;

   |SI #0#17 = "S";  |HAZ conexi;  |FINSI;


   |ABRE #3;  |CIERRA #3;  |DELINDEX #3;

   |ABRE #4;  |CIERRA #4;  |DELINDEX #4;

   |ABRE #5;  |CIERRA #5;  |DELINDEX #5;

   |IMPRE 0;
   |SI FSalida ! 0;  |ACABA;  |FINSI;
   |HAZ los_informes;
   |SI #0#13 = "N";
      informe = que_i1;
   |SINO;
      informe = que_i2;
   |FINSI;
   enDatos = 0; |SI #0#18 = "S"; enDatos = 1; |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
      |MENAV "     Error en informe.";
      |FINIMP;
      |ACABA;
   |FINSI;
   eldesde = (#0#0 * 3) + 11;
   elhasta = (#0#1 * 3) + 11;

   sw_d1 = 0; sw_d2 = 0; sw_d3 = 0; sw_d4 = 0;
   sw_h1 = 0; sw_h2 = 0; sw_h3 = 0;
   sw = 0;

   |PARA dos = 1; |SI dos [ 2; |HACIENDO dos = dos + 1;
      |NOME_DAT #1 aNomCta;
      acumula = 8;
      acumul2 = 11;
      e1 = 4;
      e2 = 5;
      e3 = 6;
      e4 = 7;
      |SI dos = 2;
          debe11  = debe1;  debe1  = 0;
          debe21  = debe2;  debe2  = 0;
          debe31  = debe3;  debe3  = 0;
          debe41  = debe4;  debe4  = 0;
          haber11 = haber1; haber1 = 0;
          haber21 = haber2; haber2 = 0;
          haber31 = haber3; haber3 = 0;

          punto_d61 = punto_d6;  punto_d6 = 0;
          punto_h61 = punto_h6;  punto_h6 = 0;
      |FINSI;

      |SI dos = 2; |Y #0#13 = "N";  |SAL;  |FINSI;

      |SI dos = 2;
         acumula = 10;
         acumul2 = 12;
         e1 =  9;
         e2 = 10;
         e3 = 11;
         e4 = 12;
         |DBASE dir_fich;
         dir_fich = dir_fich + "fich/";
         alfa1 = #0#14;   alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
         alfa2 = #0#15;   alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
         alfa3 = dir_fich + alfa1 + alfa2 + "/";
         |PATH_DAT #1 #alfa3#;
         |PATH_DAT #caparexp #alfa3#;
         |PATH_DAT #caexistc #alfa3#;
         |PATH_DAT #caexistl #alfa3#;
         |PATH_DAT #caconimp #alfa3#;
         |ABRE #30;
         #canempre#2 = #0#14;
         #canempre#3 = #0#15;
         |LEE 011#30=;
         |CIERRA #30;
         aMonedaC = #30#28;
         eaMoneda = aMonedaC;
         |HAZ Monedas;
         |SI aMonedaA = "E"; EURODB = 2; |FINSI;

         pathbal = dirfich0;
         dirfich0 = alfa3;
         |HAZ FecApeCie;
         dirfich0 = pathbal;
         |SI enMAper ! #30#11;
             |SI #0#1 < enMAper; |Y #0#1 ! 0; |SAL; |FINSI;
         |FINSI;

      |FINSI;
      ||... Modificar Cuentas a balance segun saldo
      |SI dos = 1;
         r_emp = empre;
         r_per = ejerc;
      |SINO;
         r_emp = #0#14;
         r_per = #0#15;
      |FINSI;
      enSwOper = 0;
      |SUB_EJECUTA "carecsig.run";

      |ABRE #8;
      #8#0 = 1;
      |LEE 000#8=;
      |CIERRA #8;
      |SI #caconimp#2 = "S";  |Y #caconimp#3 = "N";  |Y aparam = "";
         |SI dos = 2;
            pathbal = alfa3;
         |SINO;
            |DFICE pathbal;
         |FINSI;
         balance = 1;
         |SI #caconimp#10 = "S";
             enSwOper = 2;
             |SI dos = 1;
                 r_emp = empre;
                 r_per = ejerc;
             |SINO;
                 r_emp = #0#14;
                 r_per = #0#15;
             |FINSI;
             |SUB_EJECUTA "carecsig";
             enSwOper = 0;
             |SI enECuadre = 1; |ACABA; |FINSI;
             |NOME_DAT #1 eaNomFCta;
             |SI dos = 1; aNomCta1 = eaNomFCta; |FINSI;
         |SINO;
             |SUB_EJECUTA "careccue";
         |FINSI;
       |FINSI;

      || ---------------------------------------------------------------------
      |SI aMonedaA = "E"; EURODB = 2; |FINSI;

      |ABRE #1;
      |ABRE #2;
      |ABRE #3;
      |ABRE #4;
      |SI #0#13 = "S"; |Y #0#4 = "S";
         |ABRE #5; || si pide comparara y con cuentas abrimos el temporal exp2
      |FINSI;
      |ABRE #6;
      |HAZ pidepan;          || graba descarga de existencias
      |CIERRA #6;
      |CIERRA #1;

      |BUCLE cabaexpl0;      || Bucle de Calculos - resto cuentas
      |HAZ CalculaTotal;
      |CIERRA #2;
      |CIERRA #3;
      |CIERRA #4;
      |SI #0#13 = "S"; |Y #0#4 = "S";
          |CIERRA #5; || si pide comparara y con cuentas cerramos
      |FINSI;
   |SIGUE; || ==================================================================

   |ABRE #30;
   #canempre#2 = empre;
   #canempre#3 = ejerc;
   |LEE 011#30=;
   |CIERRA #30;
   |SI #0#13 = "S"; eaMoneda = #30#28; |HAZ Monedas; |FINSI;

   |ABRET #1;
   |ABRE #2;

   |BUCLE cabaexpl1;      || Bucle de impresion
   |HAZ final;
   |PIEINF;
   |FININF;
   |CIERRAT #1;
   |CIERRA #2;
   |FINIMP;
   |DELINDEX #3;
   |DELINDEX #4;
   |DELINDEX #5;

|FPRC;

|PROCESO descarg;
   |HAZ digitos2;
   |SI d_error ! 0;  |ACABA;  |FINSI;
   linea = linea + 1;
   #4#0 = linea;
   #4#8 = #0#6;
   |LEE 001#4=;
   |SI FSalida = 0;  |BORRA 020#4a;  |FINSI;
   |DDEFECTO #4;
   #4#0 = linea;    || linea
   #4#8 = #0#6;     || estructura
   #4#1 = #1#0;     || cuenta
   #4#2 = #1#1;     || digito
   #4#3 = #1#2;     || descripcion

   mes_fin = #0#7 + 11;
   #4e1 = #caexistl#mes_fin#;      || exist. iniciales

   mes_fin = #0#8 + 11;
   #4e2 = #caexistl#mes_fin#;    || exist. finales

   |SI aMonedaC ! aMonedaA; |Y dos = 2;
       impMoneda = #4e1; |HAZ ElCMoneda; #4e1 = impMoneda;
       impMoneda = #4e2; |HAZ ElCMoneda; #4e2 = impMoneda;
   |FINSI;
   descar = #4e1 - #4e2;

   tracan5 = descar; || diferencia entre iniciales y finales
   |SI descar ] 0;
      #4e3 = #caexistl#5;     || cuenta descarga D
      #4e4 = #caexistl#6;     || digito descarga D
   |SINO;
      #4e3 = #caexistl#8;     || cuenta descarga H
      #4e4 = #caexistl#9;     || digito descarga H
   |FINSI;

   eaCuenta = #4e3;
   |HAZ SacaNivel;
   #4e4 = enNivel;

   |SI #0#4 = "N";  nivel = #4e4;  |FINSI;
   |SI nivel < #4e4;
      |SI nivel = 1;  traraf = 100 + dig4;  |FINSI;
      |SI nivel = 2;  traraf = 100 + dig5;  |FINSI;
      |SI nivel = 3;  traraf = 100 + dig6;  |FINSI; || trata cta. descarga
      |SI nivel = 4;  traraf = 100 + dig7;  |FINSI;
      |SI nivel = 5;  traraf = 100 + dig8;  |FINSI;
      #4e3 = #4e3 % traraf;
      #4e4 = nivel;
      #4e3 = #4e3 + "              ";
      #4e3 = #4e3 % 112;
   |FINSI;

   |GRABA 020#4n;

   |HAZ grabatr1;
   |SI #0#13 = "S"; |Y #0#4 = "S"; |HAZ grabatr2; |FINSI;
|FPRC;

|PROCESO lineades;
   #1#0 = #caexistl#2;
   #1#1 = #caexistl#3;
   |LEE 000#1=;
   |SI FSalida = 0; |Y #1#0 > doce;
       |HAZ descarg;
   |FINSI;
|FPRC;

|PROCESO pidepan;
   posici = 100;
   || linea = 0; -- no borra la linea para continuar con la 2¦ emp.
   #caexistc#0 = #0#6;
   |LEE 001#6=;
   |BUCLELIN 0lineades#6;
|FPRC;

|PROCESO ElCMoneda;
     |SI aMonedaC = "P";                  || pesetas
         mulMoneda = 1 / 166.386;
         nRedon = 2;
     |FINSI;
     |SI aMonedaC = "E";                  || euros
         mulMoneda = 166.386;
         nRedon = 0;
     |FINSI;
     impMoneda = (impMoneda * mulMoneda) ! nRedon;
|FPRC;

|PROCESO CalculaTotal;
   punto_d1 = 0;   punto_h1 = 0;
   punto_d2 = 0;   punto_h2 = 0;
   punto_d3 = 0;   punto_h3 = 0;
   punto_d4 = 0;   punto_h4 = 0;
   punto_d5 = 0;   punto_h5 = 0;
   punto_d6 = 0;   punto_h6 = 0;

   canti = haber1 - debe1;
   |SI canti < 0;
       punto_h1 = - canti;
   |SINO;
       punto_d1 = canti;
   |FINSI;
   canti = haber2 - debe2;
   |SI canti < 0;
       punto_h2 = - canti;
   |SINO;
       punto_d2 = canti;
   |FINSI;
   canti = punto_d1 + punto_d2 - punto_h1 - punto_h2;
   |SI canti < 0;
       punto_h3 = - canti;
   |SINO;
       punto_d3 = canti;
   |FINSI;
   canti = haber3 - debe3;
   |SI canti < 0;
       punto_h4 = - canti;
   |SINO;
       punto_d4 = canti;
   |FINSI;

   canti = punto_d3 + punto_d4 - punto_h3 - punto_h4;
   |SI canti < 0;
       punto_h5 = - canti;
   |SINO;
       punto_d5 = canti;
   |FINSI;

   punto_h6 = punto_h5;
   |SI punto_h5 > 0;
       punto_h6 = punto_h6 + debe4;
   |FINSI;
   |SI punto_h6 < 0; punto_h6 = 0; |FINSI;

   punto_d6 = punto_d5;
   |SI punto_d6 > 0;
       punto_d6 = punto_d6 - debe4;
   |SINO;
       |SI debe4 > 0;                       || R.PRIEGO (24.03.99) impuesto neg.
           punto_d6 = punto_d6 - debe4;
       |FINSI;
   |FINSI;
   |SI punto_d6 < 0;
       |SI punto_h6 = 0;  punto_h6 = - punto_d6; |FINSI;
       punto_d6 = 0;
   |FINSI;
   punto_d1 = 0;   punto_h1 = 0;
   punto_d2 = 0;   punto_h2 = 0;
   punto_d3 = 0;   punto_h3 = 0;
   punto_d4 = 0;   punto_h4 = 0;
   punto_d5 = 0;   punto_h5 = 0;
|FPRC;
