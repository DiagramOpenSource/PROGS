|FICHEROS;
   cafinani #00;
   cafinanc #11;
   cafinanl #12;
   caconimp #8;

   canempre #30;
   cawdatos #900;
   caselem1 #998;
|FIN;

|VARIABLES;
   &entrada = 1;
   informe = "";
   inform1 = "cafinani";
   inform2 = "cafinany";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aAlfa4 = "";
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nNume4 = 0;
   fFech1 = @;
   fFech2 = @;
   nPara1 = 0;
   sw     = 0;
   estado = 0;
   swsel  = 0;
   aDSit  = "";
   aHSit  = "";
   &eaSit = "";
   &eaEL  = "";
|FIN;

|INCLUYE dscont_i;

|| ************************************************************************
|| *********** CALCULOS PANTALLA ******************************************
|| ************************************************************************
|RUTINA inf2;
   #11#0 = enEmpresa;
   #11#1 = 00001;
|FRUT;

|RUTINA sup2;
   #11#0 = enEmpresa;
   #11#1 = 99999;
|FRUT;

|CALCULO laOpera; |TIPO 0;
   |SI FSalida = 10;
      |ABRE #11;
      |CONSULTA_F_CLAVE #1#11,inf2,sup2;
      #0Campo = #11#1; |PINTA #0Campo;
      |ERROR;
      |CIERRA #11;
   |FINSI;
|FCAL;

|PROCESO DatosEmp; |TIPO 7;
 |ABRE #8;
 |DDEFECTO #8;
 #8#0 = 1;
 |LEE 011#8=;
 |CIERRA #8;
 #0#4 = #8#7; |PINTA #0#4;
 aAlfa1 = #8#8; |C_M #0#4,1,aAlfa1;
|FPRC;
|| ///////////////////////////////////////////////////////////////////////
|| ///////////////////////////////////////////////////////////////////////
|PROCESO LineasFin0;
  sw = 1;
  |SI aMonedaA ! aMonedaC;
      impMoneda = #12#4; |HAZ ElCambioMoneda; #12#4 = impMoneda;
      impMoneda = #12#5; |HAZ ElCambioMoneda; #12#5 = impMoneda;
      impMoneda = #12#6; |HAZ ElCambioMoneda; #12#6 = impMoneda;
      impMoneda = #12#8; |HAZ ElCambioMoneda; #12#8 = impMoneda;
      impMoneda = #12#9; |HAZ ElCambioMoneda; #12#9 = impMoneda;
      impMoneda = #12#10; |HAZ ElCambioMoneda; #12#10 = impMoneda;
  |FINSI;
  |PRINT;
|FPRC;

|DEFBUCLE LineasFin;
 #12#1;
 ;
 #11#0, #11#1, 001;
 #11#0, #11#1, 999;
 e;
 NULL, LineasFin0;
|FIN;

|PROCESO imprime1;
  |SI #0#4 = "S";
      enActividad = #11#33;
      |HAZ LeeDatosActividad;
  |FINSI;
  sw = 0;

  aMonedaC = #11#40;
  |SI aMonedaC ! aMonedaA;
     |PARA nPara1 = 22; |SI nPara1 [ 31; |HACIENDO nPara1 = nPara1 + 1;
           impMoneda = #11nPara1; |HAZ ElCambioMoneda; #11nPara1 = impMoneda;
     |SIGUE;
     impMoneda = #11#38; |HAZ ElCambioMoneda; #11#38 = impMoneda;
  |FINSI;
  eaSit = "";
  |SI #11#54 = "A";
      eaSit = "ACTIVA";
  |SINO;
      aAlfa1 = #11#55;
      eaSit = "INACTIVA DESDE LA FECHA "+ aAlfa1;
  |FINSI;
  eaEL = "";
  |SI #11#44 > "        ";
      aAlfa1 = #11#45; |QBF aAlfa1;
      aAlfa1 = ("00" + aAlfa1) % -102;
      eaEL = "Elemento Amortizable: " + #11#44 + " " + aAlfa1;
  |FINSI;
  |BUCLE LineasFin;
  |SI sw = 1;
      |PIEINF;
  |FINSI;
|FPRC;

|DEFBUCLE cafinani0;
   #11#1;
   3,54;
   enEmpresa, #0#0, #0#2, aDSit;
   enEmpresa, #0#1, #0#2, aHSit;
   e;
   NULL, imprime1;
|FIN;


|| **************************************************************************
|PROCESO HazTodo;
  |SI #0#4 = "S";
      eaIa = #30#21;
      enM1 = 01;
      enM2 = 12;
      |HAZ LeeDatosEmpresa;
  |FINSI;

  aMonedaA = eaMoneda;
  |BUCLE cafinani0;  || Bucle cabeceras Operaciones
|FPRC;

|CALCULO elinforme; |TIPO 3;

   aDSit = #0#3; aHSit = #0#3;
   |SI #0#3 = "T"; aDSit = "A"; aHSit = "z"; |FINSI;

   enDatos = 0; |SI #0#4 = "S"; enDatos = 1; |FINSI;

   |IMPRE 0;
   |SI FSalida ! 0; |ACABA; |FINSI;

   informe = inform1; |SI #0#4 = "S"; informe = inform2; |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |FINIMP;
       |ACABA;
   |FINSI;

   |SI #48#27 = "S";
       |HAZ MultiEmpresa;
   |SINO;
       |DFICE dirfich0; |QBF dirfich0;
       |HAZ HazTodo;
   |FINSI;
   |FININF;
   |FINIMP;
|FCAL;

|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3; |QBF dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
|| ************************************************************************
