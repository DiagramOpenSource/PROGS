|FICHEROS;
     casiim01;
     casiim02;
     casiim03;

     casiiw01;
     casiiw02;

     caivaasi;
     calibros;
     caclipro;
     camaniva;
     caivalin;
     cainliva;
     caerpnif;

     :/modelos/def/dsmom030;
     :/basica/def/agicen17;

     siim1000@;

     &regisnif@;
|FIN;

|VARIABLES;
     nID           = 0;
     nOk           = 0;
     nCmp1         = 0;
     nCmp2         = 0;
     nCmp3         = 0;

     aID           = "";
     aAlfa         = "";
     aAlfa1        = "";
     aClvPais      = "";
     aH60          = "";
     aMas          = "";
     nNume1        = 0;
     nSwDefectos   = 0;
     nNumLin       = 0;
     nMensa        = 0;

 {20}aPopup        = "";

     &aPais        = "";
     &eaCodNif     = "";
     &enCalcCif    = 0;
     &eaVarDni     = "";
     &ewNif        = 0;
     &eaIdenPais   = "";

     &aTipoIVA     = "";
     &enEmpresa    = 0;
     &enEjercicio  = 0;
     &SwCambia     = 0;
     &eaTConfig    = "";
     &enTConLin    = 0;
     &enExisDef    = 0;
     &enLinDef     = 0;

     &eaCuenta     = "";
     &emCta        = 0;
     &eaNomCta     = "";
     &eaPathConSII = "";
     &eaPathModSII = "";
     &eaPathBasSII = "";
|FIN;

|INCLUYE dscosi_i;

|PROCESO LeeNIFS;
     |ABRE #regisnif@;
     #regisnif@#0 = eaCodNif;
     |LEE 040#regisnif@.=;
     |SI FSalida ! 0;
         |DDEFECTO #regisnif@;
         ewNif = 1;
     |FINSI;
     |CIERRA #regisnif@;
|FPRC;

|PROCESO RecogeInmueble;
     |ABRE #agicen17;
     #agicen17#0 = enEmpresa;
     #agicen17#1 = eaSiiDep;
     #agicen17#2 = eaSiiSub;
     |LEE 000#agicen17.=;
     |SI FSalida = 0;
         #casiim01#19 = #agicen17#17;
         #casiim01#20 = #agicen17#3;
     |FINSI;
     |CIERRA #agicen17;
|FPRC;


|PROCESO Inmuebles;
     aAlfa = #casiim01#19 + #casiim01#20;  |QBF aAlfa;
     |SI aAlfa = "";
         |HAZ RecogeInmueble;
     |FINSI;

     |PUSHV 0501 2380;
     |PARA nCmp1 = 0;  |SI nCmp1 [ 29;  |HACIENDO nCmp1 = nCmp1 + 1;
           nCmp2 = nCmp1 + 19;
           #casiiw01#nCmp1# = #casiim01#nCmp2#;
     |SIGUE;

     |PINPA #0#casiiw01;
     |PINDA #0#casiiw01;
     |ENDATOS #1#casiiw01;
     |SI FSalida = 0;
         |PARA nCmp1 = 0;  |SI nCmp1 [ 29;  |HACIENDO nCmp1 = nCmp1 + 1;
               nCmp2 = nCmp1 + 19;
               #casiim01#nCmp2# = #casiiw01#nCmp1#;
         |SIGUE;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO Baja02;
     #casiim02#0 = #casiim01#0;
     #casiim02#1 = #casiim01#1;
     #casiim02#2 = #casiim01#2;
     #casiim02#3 = "";
|FPRC;

|PROCESO Alta02;
     #casiim02#0 = #casiim01#0;
     #casiim02#1 = #casiim01#1;
     #casiim02#2 = #casiim01#2;
     #casiim02#3 = "z" * 60;
|FPRC;

|PROCESO casiim02B;
     |BORRA 020#casiim02.a;
     |LIBERA #casiim02;
|FPRC;

|DEFBUCLE casiim02B;
     #casiim02#1;
     ;
     #casiim01#0, #casiim01#1, #casiim01#2, "";
     #casiim01#0, #casiim01#1, #casiim01#2, aH60;
     be;
     NULL, casiim02B;
|FIN;

|PROCESO IdentiFac;
     |PUSHV 0501 2380;

     |ENTLINEAL #1#casiim02, -4, 2, 21, 1, Baja02, Alta02;

     |POPV;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     |SI #casiim01#3 = "XX";
         |ACABA;
     |FINSI;

     |SI aTipoIVA = "R";
         nOk = 0;
         |SI #casiim01#4 = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#4 = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#5 = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#5 = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#6 = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#6 = "13";  nOk = 1;  |FINSI;

         |SI nOk = 1;
             |HAZ Inmuebles;
         |SINO;
             |PDEFECTO #casiim01,19,49;
         |FINSI;
     |FINSI;

     |SI #casiim01#3 = "R1";  |O #casiim01#3 = "R2";
      |O #casiim01#3 = "R3";  |O #casiim01#3 = "R4";
      |O #casiim01#3 = "R5";  |O #casiim01#3 = "R6";
      |O #casiim01#3 = "F3";
         |HAZ IdentiFac;
     |SINO;
         aH60 = "z" * 60;
         |BUCLE casiim02B;
     |FINSI;

     aAlfa = #casiim01#13;  |QBF aAlfa;
     |SI aAlfa = ""; |Y enSiiCtr = 0;
         |MENAV "0000Descripcion de la operacion debe tener contenido.";
         |POSICIONATE #casiim01#13;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO LeeIvaLin;
     |ABRE #caivalin;
     #caivalin#0 = #camaniva#0;
     #caivalin#1 = #camaniva#1;
     #caivalin#2 = #casiim01#nCmp1#;
     |LEE 000#caivalin.=;
     |SI FSalida ! 0;  |DDEFECTO #caivalin;  |FINSI;
     |CIERRA #caivalin;

     enSiiIva = #caivalin#7;
     eaCuenta = #caivalin#12;
     emCta = 0; |HAZ LeeCuenta;
     eaSiiCtr = eaNomCta;
|FPRC;

|PROCESO T0NDes;  |TIPO 0;
     |SI eaSiiPro ! "camaniva";  |ACABA;  |FINSI;

     |C_M #casiim01#nCmp3#, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     #casiiw02#1 = #casiim01#nCmp3#;

     |HAZ T0C1w2;
|FPRC;

|PROCESO T66NDes;  |TIPO 66;
     |SI eaSiiPro ! "camaniva";  |ACABA;  |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     #casiiw02#1 = #casiim01#nCmp3#;
     |HAZ T66C1w2;

     #casiim01#nCmp2# = #casiiw02#0;
     #casiim01#nCmp3# = #casiiw02#1;

     |PINTA #casiim01#nCmp2#;
     |PINTA #casiim01#nCmp3#;
|FPRC;

|PROCESO T7NDes;  |TIPO 7;
     |SI eaSiiPro ! "camaniva";  |ACABA;  |FINSI;

     |SI Campo = 8;   nCmp1 = 50;  |FINSI;
     |SI Campo = 53;  nCmp1 = 51;  |FINSI;
     |SI Campo = 56;  nCmp1 = 54;  |FINSI;
     |SI Campo = 59;  nCmp1 = 57;  |FINSI;
     |SI Campo = 62;  nCmp1 = 60;  |FINSI;
     |SI Campo = 65;  nCmp1 = 63;  |FINSI;

     |SI nCmp1 = 50;
         nCmp2 = 7;
         nCmp3 = 8;
     |SINO;
         nCmp2 = nCmp1 + 1;
         nCmp3 = nCmp1 + 2;
     |FINSI;

     |SI #casiim01#nCmp1# = 0;  |ACABA;  |FINSI;

     enSiiLin = #casiim01#nCmp1#;
     |HAZ LeeIvaLin;

     |C_M #casiim01#nCmp3#, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     |SI #casiim01#nCmp3# ! "  ";  |ACABA;  |FINSI;

     |SI enSiiIva > 0;
         #casiim01#nCmp3# = "S1";
      |SINO;
         |SI #casiim01#4 = "02";
             #casiim01#nCmp3# = "E2";
         |FINSI;

         |SI #dsmom030#34 = 9;
             #casiim01#nCmp3# = "E5";
         |FINSI;

         |SI #casiim01#nCmp3# ! "E2";  |Y #casiim01#nCmp3# ! "E5";
             #casiim01#nCmp3# = "E6";
         |FINSI;

         |SI #dsmom030#34 = 4;
              #casiim01#nCmp3# = "S2";
         |FINSI;

         |SI #dsmom030#34 = 16;
              #casiim01#nCmp3# = "N2";
         |FINSI;
      |FINSI;
|FPRC;

|PROCESO T0TDes;  |TIPO 0;
     |SI eaSiiPro ! "camaniva";  |ACABA;  |FINSI;

     |C_M #casiim01#nCmp2#, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     nOk = 0;
     |SI #casiim01#nCmp2# = "P";  nOk = 1;  |FINSI;
     |SI #casiim01#nCmp2# = "E";  nOk = 1;  |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. <P> o <E>";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T66TDes;  |TIPO 66;
     |SI eaSiiPro ! "camaniva";  |ACABA;  |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     |HAZ T66C0w2;

     #casiim01#nCmp2# = #casiiw02#0;
     |PINTA #casiim01#nCmp2#;
|FPRC;

|PROCESO T7TDes;  |TIPO 7;
     |SI eaSiiPro ! "camaniva";  |ACABA;  |FINSI;

     |SI Campo = 7;   nCmp1 = 50;  |FINSI;
     |SI Campo = 52;  nCmp1 = 51;  |FINSI;
     |SI Campo = 55;  nCmp1 = 54;  |FINSI;
     |SI Campo = 58;  nCmp1 = 57;  |FINSI;
     |SI Campo = 61;  nCmp1 = 60;  |FINSI;
     |SI Campo = 64;  nCmp1 = 63;  |FINSI;

     |SI nCmp1 = 50;
         nCmp2 = 7;
         nCmp3 = 8;
     |SINO;
         nCmp2 = nCmp1 + 1;
         nCmp3 = nCmp1 + 2;
     |FINSI;

     |SI #casiim01#nCmp1# = 0;  |ACABA;  |FINSI;

     enSiiLin = #casiim01#nCmp1#;
     |HAZ LeeIvaLin;

     aAlfa = #caclipro#9 % 101;


                                               nOk = 1;
     |SI eaIdenPais  = "01"; |Y aAlfa ! "N";   nOk = 0;  |FINSI;
     |SI eaIdenPais  = "07"; |Y aAlfa ! "N";   nOk = 0;  |FINSI;
     |SI eaIdenPais  ! "01";  |Y aPais = "ES";
                              |Y aAlfa ! "N";  nOk = 0;  |FINSI;
     |SI #casiim01#3 = "F2";                   nOk = 0;  |FINSI;
     |SI #casiim01#3 = "F4";                   nOk = 0;  |FINSI;
     |SI #casiim01#3 = "R5";                   nOk = 0;  |FINSI;

     |SI nOk = 0;
         |C_M #casiim01#nCmp2#, 1, "N";  #casiim01#nCmp2# = "";

         |PINTA #casiim01#nCmp2#;

         |ACABA;
     |FINSI;

     |C_M #casiim01#nCmp2#, 1, "S";

     |SI #casiim01#nCmp2# = " ";
         |SI eaIdenPais ! "01";
             |SI aPais ! "ES"; |O aAlfa = "N";
                 #casiim01#nCmp2# = "E";
             |FINSI;

             |SI #dsmom030#34 = 16;
                 #casiim01#nCmp2# = "P";
             |FINSI;
         |FINSI;
     |FINSI;

     |PINTA #casiim01#nCmp2#;
|FPRC;

|PROCESO T7C49m01;  |TIPO 7;
     |C_M #casiim01#49, 1, "S";
     |SI #casiim01#4 ! "06";  |Y #casiim01#5 ! "06";  |Y #casiim01#6 ! "06";
         |C_M #casiim01#49, 1, "N";  #casiim01#49 = 0;
     |FINSI;

     |PINTA #casiim01#49;
|FPRC;

|PROCESO T66C13m01;  |TIPO 66;
     |DBASS aMas;
     aMas = aMas + "siibase/def/siim1000.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;
         |MENAV "0000Opcion no instalada.";
         |ACABA;
     |FINSI;

     |CARGA_DEF aMas, siim1000@;
     |ABRE #siim1000@;
     |CONSULTA_CLAVE #2#siim1000@;
     |SI FSalida = 0;
         #casiim01#13 = #siim1000@#1;
         |PINTA #casiim01#13;
     |FINSI;
     |CIERRA #siim1000@;
     |DESCARGA_DEF #siim1000@;
|FPRC;

|PROCESO T0C15m01;  |TIPO 0;
     |C_M #casiim01#15, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     |SI #casiim01#15 =  " ";
         |MENAV "0000Introduzca valor <S> Sustitucion <I> Por diferencias";
         |ERROR;
         |ACABA;
     |FINSI;

     |C_M #casiim01#16, 1, "S";
     |C_M #casiim01#17, 1, "S";
     |C_M #casiim01#18, 1, "S";

     |SI #casiim01#15 = "I";
         |C_M #casiim01#16, 1, "N";  #casiim01#16 = 0;
         |C_M #casiim01#17, 1, "N";  #casiim01#17 = 0;
         |C_M #casiim01#18, 1, "N";  #casiim01#18 = 0;
     |FINSI;

     |PINTA #casiim01#16;
     |PINTA #casiim01#17;
     |PINTA #casiim01#18;
|FPRC;

|PROCESO T0C4R;
     nOk = 0;

     |SI Campo ! 4;
         |SI #casiim01#Campo# = "  ";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "02";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "04";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "09";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "10";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "16";  nOk = 1;  |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI Campo = 4;
         |C_M #casiim01#5,  1, "S";
         |C_M #casiim01#6,  1, "S";

         |SI #casiim01#4 ! "05";  |Y #casiim01#4 ! "06";
          |Y #casiim01#4 ! "07";  |Y #casiim01#4 ! "11";
          |Y #casiim01#4 ! "12";  |Y #casiim01#4 ! "13";
             |C_M #casiim01#5, 1, "N";  #casiim01#5 = "";
             |C_M #casiim01#6, 1, "N";  #casiim01#6 = "";
         |FINSI;

         |PINTA #casiim01#5;
         |PINTA #casiim01#6;

         |ACABA;
     |FINSI;

     |SI #casiim01#Campo# = "  ";
         |ACABA;
     |FINSI;

     nOk = 0;
     |SI #casiim01#4 = "05";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "06";
         |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "07";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "09";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "11";  |O #casiim01#4 = "12";  |O #casiim01#4 = "13";
         |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T0C4S;
     nOk = 0;

     |SI Campo ! 4;
         |SI #casiim01#Campo# = "  ";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "02";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "04";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "09";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI Campo = 4;
         |C_M #casiim01#5, 1, "S";
         |C_M #casiim01#6, 1, "S";

         |SI #casiim01#4 ! "05";  |Y #casiim01#4 ! "07";  |Y #casiim01#4 ! "12";
             |C_M #casiim01#5, 1, "N";  #casiim01#5 = "";
             |C_M #casiim01#6, 1, "N";  #casiim01#6 = "";
         |FINSI;

         |PINTA #casiim01#5;
         |PINTA #casiim01#6;

         |ACABA;
     |FINSI;

     |SI #casiim01#Campo# = "  ";
         |ACABA;
     |FINSI;

     nOk = 0;
     |SI #casiim01#4 = "05";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "07";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "12";
         |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
     |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T0C4m01;  |TIPO 0;
     |SI #casiim01#3 = "XX";
         |ACABA;
     |FINSI;

     |SI aTipoIVA = "R";
         |HAZ T0C4R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T0C4S;
     |FINSI;
|FPRC;

|PROCESO T66C4R;
     |SI Campo = 4;
         aPopup2  = 16;
         aPopup3  = "01. Operaciones de régimen general";
         aPopup4  = "02. Exportacion";
         aPopup5  = "03. Operaciones de R.E.B.U.";
         aPopup6  = "04. Operaciones régimen especial oro de inversión";
         aPopup7  = "05. Operaciones régimen especial agencias de viajes.";
         aPopup8  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
         aPopup9  = "07. Operaciones de R.E.C.C.";
         aPopup10 = "08. Operaciones sujetas al IPSI/IGIC";
         aPopup11 = "09. Operaciones de facturación de las prestaciones de servicios de agencias de viaje";
         aPopup12 = "10. Cobros por cuenta de terceros de honorarios profesionales";
         aPopup13 = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
         aPopup14 = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
         aPopup15 = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
         aPopup16 = "14. Factura con IVA pendiente de devengo (certificaciones de obra cuyo destinatario sea una Administración Pública)";
         aPopup17 = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         aPopup18 = "16. Facturas primer semestre 2017 y otras anteriores a la inclusion en el SII";
     |FINSI;

     |SI Campo ! 4;
         aPopup2  = "";

         |SI #casiim01#4 = "05";
             aPopup2  = "6";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "07. Operaciones de R.E.C.C.";
             aPopup6  = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
             aPopup7  = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
             aPopup8  = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
         |FINSI;

         |SI #casiim01#4 = "06";
             aPopup2  = "6";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
             aPopup5  = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
             aPopup6  = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
             aPopup7  = "14. Factura con IVA pendiente de devengo (certificaciones de obra cuyo destinatario sea una Administración Pública)";
             aPopup8  = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         |FINSI;

         |SI #casiim01#4 = "07";
             aPopup2  = "10";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "03. Operaciones de R.E.B.U.";
             aPopup6  = "05. Operaciones régimen especial agencias de viajes.";
             aPopup7  = "09. Operaciones de facturación de las prestaciones de servicios de agencias de viaje";
             aPopup8  = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
             aPopup9  = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
             aPopup10 = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
             aPopup11 = "14. Factura con IVA pendiente de devengo (certificaciones de obra cuyo destinatario sea una Administración Pública)";
             aPopup12 = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         |FINSI;

         |SI #casiim01#4 = "11";  |O #casiim01#4 = "12";  |O #casiim01#4 = "13";
             aPopup2  = "05";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
             aPopup5  = "07. Operaciones de R.E.C.C.";
             aPopup6  = "08. Operaciones sujetas al IPSI/IGIC";
             aPopup7  = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T66C4S;
     |SI Campo = 4;
         aPopup2  = 12;
         aPopup3  = "01. Operaciones de régimen general";
         aPopup4  = "02. Operaciones por las que los Empresarios satisfacen compensaciones REAGYP";
         aPopup5  = "03. Operaciones de R.E.B.U.";
         aPopup6  = "04. Operaciones régimen especial oro de inversión";
         aPopup7  = "05. Operaciones régimen especial agencias de viajes.";
         aPopup8  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
         aPopup9  = "07. Operaciones de R.E.C.C.";
         aPopup10 = "08. Operaciones sujetas al IPSI/IGIC";
         aPopup11 = "09. Adquisiciones intracomunitarias de bienes y prestaciones de servicios";
         aPopup12 = "12. Operaciones de arrendamiento de local de negocio";
         aPopup13 = "13. Factura correspondiente a una importación (informada sin asociar a un DUA)";
         aPopup14 = "14. Primer semestre 2017 y otras facturas anteriores a la inclusion en el SII";
     |FINSI;

     |SI Campo ! 4;
         aPopup2  = "";
         |SI #casiim01#4 = "05";
             aPopup2  = "4";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "07. Operaciones de R.E.C.C.";
             aPopup6  = "12. Operaciones de arrendamiento de local de negocio";
         |FINSI;

         |SI #casiim01#4 = "07";
             aPopup2  = "5";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "03. Operaciones de R.E.B.U.";
             aPopup6  = "05. Operaciones régimen especial agencias de viajes.";
             aPopup7  = "12. Operaciones de arrendamiento de local de negocio";
         |FINSI;

         |SI #casiim01#4 = "12";
             aPopup2  = "5";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "05. Operaciones régimen especial agencias de viajes.";
             aPopup5  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
             aPopup6  = "07. Operaciones de R.E.C.C.";
             aPopup7  = "08. Operaciones sujetas al IPSI/IGIC";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T66C4m01;  |TIPO 66;
     aAlfa = "|C004WID";
     aID   = #casiim01#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion

     |SI aTipoIVA = "R";
         |HAZ T66C4R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T66C4S;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #casiim01#Campo# = aAlfa;
     |FINSI;

     |PINTA #casiim01#Campo#;
|FPRC;

|PROCESO T0C3R;
     |SI #casiim01#3 = "F1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R5";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "XX";  nOk = 1;  |FINSI;
|FPRC;

|PROCESO T0C3S;
     |SI #casiim01#3 = "F1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F5";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F6";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "LC";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R5";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "XX";  nOk = 1;  |FINSI;
|FPRC;

|PROCESO T0C3m01;  |TIPO 0;
     nOk = 0;

     |SI aTipoIVA = "R";
         |HAZ T0C3R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T0C3S;
     |FINSI;

     |SI #casiim01#3 = "XX";
         |PTEC 806;
         |ACABA;
     |FINSI;

     nMensa = 0;
     |SI #casiim01#3 = "R1";  |O #casiim01#3 = "R2";  |O #casiim01#3 = "R3";
                              |O #casiim01#3 = "R4";  |O #casiim01#3 = "R5";
         |SI eaSii340 ! "D";
             nOk = 0; nMensa = 2;
         |FINSI;
     |SINO;
         |SI eaSii340 = "D";
             nOk = 0; nMensa = 1;
         |FINSI;
     |FINSI;

     |SI enExisDef = 1;
         |HAZ eLeoDefM03;
         |SI #casiim01#3 = #casiim03#6;
             nOk = 1;
         |FINSI;
     |FINSI;

     |SI nOk = 0;
         |SI nMensa = 0;
            aAlfa =  "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |FINSI;
         |SI nMensa = 1;
            aAlfa =  "0000Concepto de fra.rectificativa y tipo factura distinto de Rx. Reviselo";
         |FINSI;
         |SI nMensa = 2;
            aAlfa =  "0000Tipo factura rectificativa y concepto no. Reviselo";
         |FINSI;

         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;

     |C_M #casiim01#15, 1, "S";
     |C_M #casiim01#16, 1, "S";
     |C_M #casiim01#17, 1, "S";
     |C_M #casiim01#18, 1, "S";

     |SI #casiim01#15 =  " ";
         #casiim01#15 = "I";
     |FINSI;

     |SI #casiim01#3 ! "R1";  |Y #casiim01#3 ! "R2";  |Y #casiim01#3 ! "R3";
                              |Y #casiim01#3 ! "R4";  |Y #casiim01#3 ! "R5";
         |C_M #casiim01#15, 1, "N";  #casiim01#15 = "";
         |C_M #casiim01#16, 1, "N";  #casiim01#16 = 0;
         |C_M #casiim01#17, 1, "N";  #casiim01#17 = 0;
         |C_M #casiim01#18, 1, "N";  #casiim01#18 = 0;
     |FINSI;

     |C_M #casiim01#12, 1, "S";
     |SI #casiim01#3 ! "R5";  |Y #casiim01#3 ! "F4";
         |C_M #casiim01#12, 1, "N";  #casiim01#12 = "N";
     |FINSI;

     |C_M #casiim01#67, 1, "S";
     |C_M #casiim01#68, 1, "S";
     |SI #casiim01#3 = "F2";  |O #casiim01#3 = "F4";
          |O #casiim01#3 = "R5";  |O #casiim01#3 = "LC";
        |C_M #casiim01#67, 1, "N";
        |SI #casiim01#3 = "LC";
            #casiim01#67 = "N";
        |SINO;
            #casiim01#67 = "S";
        |FINSI;
     |FINSI;
     |SI #casiim01#67 = " "; #casiim01#67 = "N"; |FINSI;
     |SI #casiim01#68 = " "; #casiim01#68 = "N"; |FINSI;

     |SI aTipoIVA = "S";
         #casiim01#68 = " ";
         |C_M #casiim01#68, 1, "N";
     |FINSI;

     |PINTA #casiim01#67;
     |PINTA #casiim01#68;
     |PINTA #casiim01#4;
     |PINTA #casiim01#12;
     |PINTA #casiim01#13;
     |PINTA #casiim01#15;
     |PINTA #casiim01#16;
     |PINTA #casiim01#17;
     |PINTA #casiim01#18;
|FPRC;

|PROCESO T66C3R;
     aPopup2  = 10;
     aPopup3  = "F1. Factura completa o simplificada cualificada del art.7.2 y 7.3.";
     aPopup4  = "F2. Factura simplificada o sin identificacion del destinatario art.6.1d";
     aPopup5  = "F3. Factura emitida en sustitucion de facturas simplificadas";
     aPopup6  = "F4. Asiento resumen de facturas.";
     aPopup7  = "R1. Factura rectificativa. Error fundado y Articulo 80 uno y dos LIVA.";
     aPopup8  = "R2. Factura rectificativa. Articulo 80 tres LIVA - concurso acreedores";
     aPopup9  = "R3. Articulo 80 cuatro LIVA - deuda incobrable.";
     aPopup10 = "R4. Resto";
     aPopup11 = "R5. Rectificativa en facturas simplificadas.";
     aPopup12 = "XX. No importable al SII";
|FPRC;

|PROCESO T66C3S;
     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 13;
     aPopup3  = "F1. Factura completa o simplificada cualificada del art.7.2 y 7.3.";
     aPopup4  = "F2. Factura simplificada o sin identificacion del destinatario art.6.1d";
     aPopup5  = "F3. Factura emitida en sustitucion de facturas simplificadas";
     aPopup6  = "F4. Asiento resumen de facturas.";
     aPopup7  = "F5. Importaciones (DUA)";
     aPopup8  = "F6. Otros justificantes contables y documentos justificativos";
     aPopup9  = "LC. Aduanas - Liquidacion complementaria";
     aPopup10 = "R1. Factura rectificativa. Error fundado y Articulo 80 uno y dos LIVA.";
     aPopup11 = "R2. Factura rectificativa. Articulo 80 tres LIVA - concurso acreedores";
     aPopup12 = "R3. Articulo 80 cuatro LIVA - deuda incobrable.";
     aPopup13 = "R4. Resto";
     aPopup14 = "R5. Rectificativa en facturas simplificadas.";
     aPopup15 = "XX. No importable al SII";
|FPRC;

|PROCESO T66C3m01;  |TIPO 66;
     aAlfa = "|C003WID";
     aID   = #casiim01#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion

     |SI aTipoIVA = "R";
         |HAZ T66C3R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T66C3S;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #casiim01#3 = aAlfa;
     |FINSI;

     |PINTA #casiim01#3;
|FPRC;

|CALCULO elDNI; |TIPO 6;

  |SI FSalida = 2; |ACABA; |FINSI;
  |SI FSalida = 10;
      enCalcCif = 1;
      eaVarDni  = #casiim01#70;
      |HAZ CalculoDNI;
      #casiim01#70 = eaVarDni;
      |PINTA #casiim01#70;
      |ERROR;
      |ACABA;
  |FINSI;

  eaVarDni  = #casiim01#70;
  enCalcCif = 0;
  |HAZ CalculoDNI;
  eaVarDni = (eaVarDni + "                ") % 112;
  |SI #casiim01#70 ! eaVarDni;
      |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
      |SI FSalida = 0;
          #casiim01#70 = eaVarDni;  |PINTA #casiim01#70;
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
|FCAL;


|CALCULO elDNI0; |TIPO 0;
  |SI FSalida = 2; |ACABA; |FINSI;

  eaCodNif = #casiim01#70; |HAZ LeeNIFS; |QBF eaCodNif;
  |SI ewNif = 0;
      #casiim01#71 = #regisnif@#1;
      |SI eaCodNif = ""; #casiim01#71 = ""; |FINSI;

      |PINTA #casiim01#71;
  |FINSI;
|FCAL;

|| //////////////////////////////////////////////////////////////////////
|PROCESO CampoDesdeM03;
  |ABRE #casiim03;
  |DDEFECTO #casiim03;
  #casiim03#15 = eaTConfig;
  #casiim03#0  = enTConLin;
  |LEE 041#casiim03.=;
  |CIERRA #casiim03;

  |SI eaSiiEje = "2017"; |Y enSiiPer [ 6; |Y enEjercicio < 2018;
      |SI aTipoIVA = "R";
          |SI #casiim03#7 ! "11"; |Y #casiim03#7 ! "12"; |Y #casiim03#7 ! "13";
              #casiim03#7 = "16";
          |FINSI;
      |SINO;
          #casiim03#7 = "14";
      |FINSI;
  |FINSI;

  |SI nNumLin = 0;
      #casiim01#3 = #casiim03#6;
      #casiim01#4 = #casiim03#7;
      #casiim01#5 = #casiim03#8;
      #casiim01#6 = #casiim03#9;
      #casiim01#7 = #casiim03#10;  || Tipo 1
      #casiim01#8 = #casiim03#11;  || Nivel 1

      aAlfa = "";
      |SI #casiim03#14 ! "C";
          |SI #casiim03#14 ! "D";
              aAlfa = eaSiiDes; |QBF aAlfa;
              aAlfa = aAlfa + " ";
          |FINSI;
          |SI #casiim03#14 ! "F";
              aAlfa1 = #casiim03#12; |QBF aAlfa1;
              aAlfa = aAlfa + aAlfa1;
              |QBF aAlfa;
          |FINSI;
          enSiiCtr = 0;
          #casiim01#13 = aAlfa;
      |SINO;
          enSiiCtr = 1;
          |SI eaSiiPro = "cainliva";
              #casiim01#13 = eaSiiCtr;
          |FINSI;
      |FINSI;
      #casiim01#15 = #casiim03#13;
      #casiim01#10 = #casiim03#18;
      #casiim01#67 = #casiim03#19;
      #casiim01#68 = #casiim03#20;
  |SINO;
      |SI PARAMETRO = "DEFECTOSGECONET";
          #casiim01#nCmp2# = #casiim03#10;  || Tipo
          #casiim01#nCmp3# = #casiim03#11;  || Nivel
      |FINSI;
  |FINSI;

  |SI nNumLin = 1;
      #casiiw02#0 = #casiim03#10;
      #casiiw02#1 = #casiim03#11;
      |SI enSiiCtr = 1;
          aAlfa = #casiim01#13; |QBF aAlfa;
          |SI aAlfa ! "";
              aAlfa = aAlfa + " ";
          |FINSI;
          #casiim01#13 = aAlfa + eaSiiCtr;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO NuevosDefectos;

     |SI #casiim01#4 ! "  ";  |ACABA;  |FINSI;
     |SI #casiim01#3 = "XX";  |ACABA;  |FINSI;

     nSwDefectos   = 0;
     enSiiCtr      = 0;
     |HAZ CojoConfig;
     |SI eaTConfig ! "X";
         nNumLin   = 0;
         enSiiCon = eaSiiCpt;
         |HAZ ePorLinea;
         |SI SwCambia ! 0;
             |HAZ CampoDesdeM03;
             nSwDefectos = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ElDefectoLin;
     nSwDefectos   = 0;
     |HAZ CojoConfig;
     |SI eaTConfig ! "X";
         nNumLin   = 1;
         enSiiCon = eaSiiCpt;
         |HAZ ePorLinea;
         |SI SwCambia ! 0;
             |HAZ CampoDesdeM03;
             nSwDefectos = 1;
         |FINSI;
     |FINSI;
     |SI nSwDefectos = 0;
         |HAZ T7C0w2;
         |HAZ T7C1w2;
     |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|PROCESO Defectos;
     |SI #casiim01#4 ! "  "; |ACABA; |FINSI;
     |SI #casiim01#3 = "XX"; |ACABA; |FINSI;

     || Tipo Factura

     #casiim01#3 = "F1";

     |SI eaSiiCIF = "";
         #casiim01#3 = "F2";
     |FINSI;

     |SI eaSiiUlt ! "";
         #casiim01#3 = "F4";
     |FINSI;

     |SI eaSii340 = "D";
         #casiim01#3  = "R4";
         #casiim01#15 = "I";

         |SI eaSiiCIF = "";
             #casiim01#3 = "R5";
         |FINSI;
     |FINSI;

     |SI aTipoIVA = "S";
         |SI #dsmom030#28 = 3;
             #casiim01#3 = "F5";
         |FINSI;

         |SI #dsmom030#28 = 4;
             #casiim01#3 = "F5";
         |FINSI;

         |SI #dsmom030#28 = 7;
             #casiim01#3 = "F6";
         |FINSI;
     |FINSI;

     || Clave operacion

     #casiim01#4 = "01";

     |SI aTipoIVA = "R";
         |SI #dsmom030#34 = 10;
             #casiim01#4 = "02";
         |FINSI;

         |SI #dsmom030#34 = 5;
             #casiim01#4 = "03";
         |FINSI;

         |SI #dsmom030#34 = 6;
             #casiim01#4 = "05";
         |FINSI;

         nOk = 0;
         |SI eaSii340 = "Z";  nOk = 1;  |FINSI;
         |SI eaSii340 = "0";  nOk = 1;  |FINSI;
         |SI eaSii340 = "1";  nOk = 1;  |FINSI;
         |SI eaSii340 = "2";  nOk = 1;  |FINSI;
         |SI eaSii340 = "3";  nOk = 1;  |FINSI;
         |SI eaSii340 = "4";  nOk = 1;  |FINSI;
         |SI eaSii340 = "5";  nOk = 1;  |FINSI;
         |SI eaSii340 = "6";  nOk = 1;  |FINSI;
         |SI eaSii340 = "7";  nOk = 1;  |FINSI;
         |SI eaSii340 = "8";  nOk = 1;  |FINSI;
         |SI eaSii340 = "9";  nOk = 1;  |FINSI;

         |SI nOk = 1;
             #casiim01#4 = "07";
         |FINSI;

         |SI eaSiiEje = "2017";  |Y enSiiPer [ 6; |Y enEjercicio < 2018;
             #casiim01#4 = "16";
         |FINSI;

         |SI eaSiiCpt = "704";  |Y enSiiRet ! 0;
             #casiim01#4 = "11";
         |FINSI;

         |SI eaSiiCpt = "704";  |Y enSiiRet = 0;
             #casiim01#4 = "12";
         |FINSI;

         |SI #dsmom030#49 = "X";
             #casiim01#4 = "12";
         |FINSI;
     |FINSI;

     |SI aTipoIVA = "S";
         || Clave operacion

         |SI #dsmom030#28 = 7;
             #casiim01#4 = "02";
         |FINSI;

         nOk = 0;
         |SI eaSii340 = "Z";  nOk = 1;  |FINSI;
         |SI eaSii340 = "0";  nOk = 1;  |FINSI;
         |SI eaSii340 = "1";  nOk = 1;  |FINSI;
         |SI eaSii340 = "2";  nOk = 1;  |FINSI;
         |SI eaSii340 = "3";  nOk = 1;  |FINSI;
         |SI eaSii340 = "4";  nOk = 1;  |FINSI;
         |SI eaSii340 = "5";  nOk = 1;  |FINSI;
         |SI eaSii340 = "6";  nOk = 1;  |FINSI;
         |SI eaSii340 = "7";  nOk = 1;  |FINSI;
         |SI eaSii340 = "8";  nOk = 1;  |FINSI;
         |SI eaSii340 = "9";  nOk = 1;  |FINSI;

         |SI nOk = 1;
             #casiim01#4 = "07";
         |FINSI;

         |SI #dsmom030#28 = 5;
             #casiim01#4 = "09";
         |FINSI;

         |SI #dsmom030#28 = 6;
             #casiim01#4 = "09";
         |FINSI;

         |SI #dsmom030#28 = 13;
             #casiim01#4 = "09";
         |FINSI;

         |SI #dsmom030#28 = 17;
             #casiim01#4 = "09";
         |FINSI;

         |SI #dsmom030#38 = 180;  |Y #dsmom030#40 = 1;
             #casiim01#4 = "12";
         |FINSI;

         |SI eaSiiEje = "2017";  |Y enSiiPer [ 6; |Y enEjercicio < 2018;
             #casiim01#4 = "14";
         |FINSI;
     |FINSI;

     #casiim01#67 = "N";
     |SI #casiim01#3 = "F2";  |O #casiim01#3 = "F4";
          |O #casiim01#3 = "R5";
            #casiim01#67 = "S";
     |FINSI;
|FPRC;

|PROCESO EntraTipoDesglose;
     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = enSiiDoc;
     |LEE 101#casiim01.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #casiim01#3 = "XX";  |ACABA;  |FINSI;

     nCmp1 = 0;
     |SI #casiim01#50 = enSiiLin;  nCmp1 = 50;  |FINSI;
     |SI #casiim01#51 = enSiiLin;  nCmp1 = 51;  |FINSI;
     |SI #casiim01#54 = enSiiLin;  nCmp1 = 54;  |FINSI;
     |SI #casiim01#57 = enSiiLin;  nCmp1 = 57;  |FINSI;
     |SI #casiim01#60 = enSiiLin;  nCmp1 = 60;  |FINSI;
     |SI #casiim01#63 = enSiiLin;  nCmp1 = 63;  |FINSI;

     |SI nCmp1 = 0;
         |SI #casiim01#63 = 0;  nCmp1 = 63;  |FINSI;
         |SI #casiim01#60 = 0;  nCmp1 = 60;  |FINSI;
         |SI #casiim01#57 = 0;  nCmp1 = 57;  |FINSI;
         |SI #casiim01#54 = 0;  nCmp1 = 54;  |FINSI;
         |SI #casiim01#51 = 0;  nCmp1 = 51;  |FINSI;
         |SI #casiim01#50 = 0;  nCmp1 = 50;  |FINSI;

         |SI nCmp1 = 0;  |ACABA;  |FINSI;
     |FINSI;

     nNume1 = #casiim01#nCmp1#;

     #casiim01#nCmp1# = enSiiLin;

     |SI nCmp1 = 50;
         nCmp2 = 7;
         nCmp3 = 8;
     |SINO;
         nCmp2 = nCmp1 + 1;
         nCmp3 = nCmp1 + 2;
     |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     #casiiw02#1 = #casiim01#nCmp3#;

     |SI nNume1 = 0; |Y aTipoIVA = "R";
         |HAZ ElDefectoLin;
     |FINSI;

     |SI enSiiMod = 1;
         |PINPA #0#casiiw02;
         |PINDA #0#casiiw02;
         |ENDATOS #1#casiiw02;
         |SI FSalida = 0;
             #casiim01#nCmp2# = #casiiw02#0;
             #casiim01#nCmp3# = #casiiw02#1;
         |FINSI;
     |FINSI;

     |SI enSiiMod = -1;
         #casiim01#nCmp1# = 0;
         #casiim01#nCmp2# = "";
         #casiim01#nCmp3# = "";
     |FINSI;

     |GRABA 020#casiim01.a;
     |LIBERA #casiim01;
|FPRC;

|PROCESO caivalin;
     enSiiLin = #caivalin#2;
     enSiiIva = #caivalin#7;

     eaCuenta = #caivalin#12;
     emCta = 0; |HAZ LeeCuenta;
     eaSiiCtr = eaNomCta;

     |SI enSiiCtr = 1;
         aAlfa = #casiim01#13; |QBF aAlfa;
         |SI aAlfa ! "";
             aAlfa = aAlfa + " ";
         |FINSI;
         #casiim01#13 = aAlfa + eaSiiCtr;
     |FINSI;
     |SI aTipoIVA = "S"; |ACABA; |FINSI;

     nCmp1 = 0;
     |SI #casiim01#50 = enSiiLin;  nCmp1 = 50;  |FINSI;
     |SI #casiim01#51 = enSiiLin;  nCmp1 = 51;  |FINSI;
     |SI #casiim01#54 = enSiiLin;  nCmp1 = 54;  |FINSI;
     |SI #casiim01#57 = enSiiLin;  nCmp1 = 57;  |FINSI;
     |SI #casiim01#60 = enSiiLin;  nCmp1 = 60;  |FINSI;
     |SI #casiim01#63 = enSiiLin;  nCmp1 = 63;  |FINSI;

     |SI nCmp1 = 0;
         |SI #casiim01#63 = 0;  nCmp1 = 63;  |FINSI;
         |SI #casiim01#60 = 0;  nCmp1 = 60;  |FINSI;
         |SI #casiim01#57 = 0;  nCmp1 = 57;  |FINSI;
         |SI #casiim01#54 = 0;  nCmp1 = 54;  |FINSI;
         |SI #casiim01#51 = 0;  nCmp1 = 51;  |FINSI;
         |SI #casiim01#50 = 0;  nCmp1 = 50;  |FINSI;

         |SI nCmp1 = 0;  |ACABA;  |FINSI;
     |FINSI;

     #casiim01#nCmp1# = enSiiLin;

     |SI nCmp1 = 50;
         nCmp2 = 7;
         nCmp3 = 8;
     |SINO;
         nCmp2 = nCmp1 + 1;
         nCmp3 = nCmp1 + 2;
     |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     #casiiw02#1 = #casiim01#nCmp3#;

     |HAZ T7C0w2;
     |HAZ T7C1w2;

     #casiim01#nCmp1# = enSiiLin;
     #casiim01#nCmp2# = #casiiw02#0;
     #casiim01#nCmp3# = #casiiw02#1;
|FPRC;

|DEFBUCLE caivalin;
     #caivalin#1;
     ;
     #camaniva#0, #camaniva#1, 01;
     #camaniva#0, #camaniva#1, 99;
     ;
     NULL, caivalin;
|FIN;

|PROGRAMA;
     |SI enSiiLin ! 0;
         |HAZ EntraTipoDesglose;

         |ACABA;
     |FINSI;

     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = enSiiDoc;
     |LEE 101#casiim01.=;
     |SI FSalida ! 0;
         |DDEFECTO #casiim01;
         #casiim01#0 = eaSiiPro;
         #casiim01#1 = enSiiLib;
         #casiim01#2 = enSiiDoc;

         |GRABA 020#casiim01.b;
     |FINSI;

     |SI enSiiL = 0; || No viene de Predefinido ni del Boton SiiDatos
         |HAZ NuevosDefectos;
         |SI nSwDefectos = 0;
             |HAZ Defectos;
         |FINSI;
     |FINSI;

     |SI PARAMETRO = "DEFECTOS";
      |O PARAMETRO = "DEFECTOS_SII";
         aAlfa = #casiim01#13; |QBF aAlfa;
         |SI aAlfa = ""; |Y enSiiCtr = 0;
             #casiim01#13 = #camaniva#30;
         |FINSI;

         |SI aTipoIVA = "R";
             |BUCLE caivalin;
         |FINSI;

         |SI aTipoIVA = "S"; |Y enSiiCtr = 1;
             |BUCLE caivalin;
         |FINSI;

         |GRABA 020#casiim01.a;
         |LIBERA #casiim01;

         |ACABA;
     |FINSI;

     |SI PARAMETRO = "DEFECTOSGECONET";
         |GRABA 020#casiim01.a;
         |LIBERA #casiim01;

         |ACABA;
     |FINSI;

     |SI enSiiL = 1; |Y aTipoIVA = "R";
         |C_M #casiim01#7, 1, "S";
         |C_M #casiim01#8, 1, "S";
         |SI #casiim01#51 ! 0; |C_M #casiim01#52, 1, "S"; |C_M #casiim01#53, 1, "S"; |FINSI;
         |SI #casiim01#54 ! 0; |C_M #casiim01#55, 1, "S"; |C_M #casiim01#56, 1, "S"; |FINSI;
         |SI #casiim01#57 ! 0; |C_M #casiim01#58, 1, "S"; |C_M #casiim01#59, 1, "S"; |FINSI;
         |SI #casiim01#60 ! 0; |C_M #casiim01#61, 1, "S"; |C_M #casiim01#62, 1, "S"; |FINSI;
         |SI #casiim01#63 ! 0; |C_M #casiim01#64, 1, "S"; |C_M #casiim01#65, 1, "S"; |FINSI;
     |FINSI;

     |PINPA #0#casiim01;
     |PINDA #0#casiim01;
     |ENDATOS #1#casiim01;
     |SI FSalida = 0;
         |GRABA 020#casiim01.a;
     |FINSI;
     |LIBERA #casiim01;
|FPRO;

|PROCESO LeeCliPro;
     |ABRE #calibros;
     #calibros#0 = enSiiLib;
     |LEE 000#calibros.=;
     |SI FSalida ! 0;  |DDEFECTO #calibros;  |FINSI;
     |CIERRA #calibros;

     |ABRE #dsmom030;
     #dsmom030#0 = eaSiiCpt;
     |LEE 001#dsmom030.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom030;  |FINSI;
     |CIERRA #dsmom030;

     eaSii340R = eaSii340;
     aTipoIVA  = #calibros#2;

     enExisDef = 0;
     enLinDef  = 0;
     |HAZ CojoConfig;
     |SI eaTConfig ! "X";
         enSiiCon = eaSiiCpt;
         |HAZ ePorLinea;
         enExisDef = SwCambia;
         enLinDef  = enTConLin;
     |FINSI;

     |SI eaSii340 ! "Z"; |Y eaSii340 ! "0"; |Y eaSii340 ! "1";
       |Y eaSii340 ! "2"; |Y eaSii340 ! "3"; |Y eaSii340 ! "4";
         |Y eaSii340 ! "5"; |Y eaSii340 ! "6"; |Y eaSii340 ! "7";
          |Y eaSii340 ! "8"; |Y eaSii340 ! "9";

       eaSii340 = "";
         |SI aTipoIVA = "R";
             |SI #dsmom030#26 = 7; |O #dsmom030#26 = 8;
               |O #dsmom030#26 = 17; |O #dsmom030#26 = 18; |O #dsmom030#26 = 19;
                  eaSii340 = "D";
             |FINSI;
         |FINSI;
         |SI aTipoIVA = "S";
             |SI #dsmom030#28 = 8; |O #dsmom030#28 = 16;
               |O #dsmom030#28 = 17;
                  eaSii340 = "D";
             |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #caclipro;
     |SI aTipoIVA = "R";
         #caclipro#23 = "C";
     |SINO;
         #caclipro#23 = "P";
     |FINSI;
     #caclipro#10 = eaSiiCta;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     aPais     = #caclipro#24;
     eaIdenPais = "01";

     aAlfa    = #caclipro#9; |QBF aAlfa;
     eaCodNif = #caclipro#9;
     |HAZ LeeNIFS;
     |SI ewNif = 0; |Y aAlfa ! "";
         aPais = #regisnif@#12;
     |FINSI;
     |QBF aPais;

     |SI aPais = "";
         aPais = "ES";
     |FINSI;

     |SI aPais = "ESP";
         aPais = "ES";
     |FINSI;

     |SI aPais ! "ES";
         aAlfa   = aPais;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                            eaIdenPais = "06";
         |SI aAlfa = "DE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "AT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "BE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "BG";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "CY";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "DK";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "SI";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "EE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "FI";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "FR";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "EL";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "GB";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "NL";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "HU";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "IT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "IE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "LV";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "LT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "LU";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "MT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "PL";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "PT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "CZ";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "SK";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "RO";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "SE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "HR";  eaIdenPais = "02";  |FINSI;
     |FINSI;

     |SI #dsmom030#34 = 9;
         aAlfa   = aPais;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         eaIdenPais = "02";
     |FINSI;

     |SI #dsmom030#34 = 10;
         aAlfa = aPais;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         eaIdenPais = "04";

         aAlfa   = eaSiiCIF;   |QBF aAlfa;
         |SI aAlfa = "";  eaIdenPais = "06";  |FINSI;
     |FINSI;

     |SI aClvPais ! "";
         eaIdenPais = aClvPais;
     |FINSI;
|FPRC;

|PROCESO CambiaPath;
     |PATH_DAT #casiim01#eaPathConSII#;
     |PATH_DAT #casiim02#eaPathConSII#;
     |PATH_DAT #casiim03#eaPathConSII#;
     |PATH_DAT #casiiw01#eaPathConSII#;
     |PATH_DAT #casiiw02#eaPathConSII#;
     |PATH_DAT #caivaasi#eaPathConSII#;
     |PATH_DAT #calibros#eaPathConSII#;
     |PATH_DAT #caclipro#eaPathConSII#;
     |PATH_DAT #camaniva#eaPathConSII#;
     |PATH_DAT #caivalin#eaPathConSII#;
     |PATH_DAT #caivalin#eaPathConSII#;
     |PATH_DAT #cainliva#eaPathConSII#;
     |PATH_DAT #caerpnif#eaPathConSII#;
     |PATH_DAT #dsmom030#eaPathModSII#;
     |PATH_DAT #agicen17#eaPathBasSII#;
     |PATH_DAT #regisnif@#eaPathBasSII#;
|FPRC;

|PROCESO T80;  |TIPO 80;
     |BLIN 04;

     |HAZ LeeNifs;
     aClvPais = "";
     aPais    = "";

     |SI PARAMETRO = "DEFECTOS";
         |ABRE #camaniva;
         #camaniva#0 = enSiiLib;
         #camaniva#1 = enSiiDoc;
         |LEE 000#camaniva.=;
         |SI FSalida ! 0;  |CIERRA #camaniva;  |FINSI;
         |CIERRA #camaniva;

         enSiiLin = 0;
         enSiiLCp = 0;
         eaSiiSer = #camaniva#2;
         eaSiiCpt = #camaniva#27;
         eaSiiCta = #camaniva#12;
         eaSiiCIF = #camaniva#14;  |QBF eaSiiCIF;
         eaSiiDes = #camaniva#28;
         eaSiiUlt = #camaniva#44;  |QBF eaSiiUlt;
         eaSii340 = #camaniva#42;  |QBF eaSii340;
         eaSiiEje = #camaniva#4 % -104;
         enSiiPer = #camaniva#5;
         eaSiiDep = #camaniva#10;
         eaSiiSub = #camaniva#11;
         enSiiRet = #camaniva#20;
     |FINSI;

     |SI PARAMETRO = "DEFECTOS_SII";
         |HAZ CambiaPath;

         |ABRE #camaniva;
         #camaniva#0 = enSiiLib;
         #camaniva#1 = enSiiDoc;
         |LEE 000#camaniva.=;
         |SI FSalida ! 0;  |CIERRA #camaniva;  |FINSI;
         |CIERRA #camaniva;

         enSiiLin = 0;
         enSiiLCp = 0;
         eaSiiSer = #camaniva#2;
         eaSiiCpt = #camaniva#27;
         eaSiiCta = #camaniva#12;
         eaSiiCIF = #camaniva#14;  |QBF eaSiiCIF;
         eaSiiDes = #camaniva#28;
         eaSiiUlt = #camaniva#44;  |QBF eaSiiUlt;
         eaSii340 = #camaniva#42;  |QBF eaSii340;
         eaSiiEje = #camaniva#4 % -104;
         enSiiPer = #camaniva#5;
         eaSiiDep = #camaniva#10;
         eaSiiSub = #camaniva#11;
         enSiiRet = #camaniva#20;
     |FINSI;

     |SI eaSiiPro = "camaniva";
         |ABRE #camaniva;
         #camaniva#0 = enSiiLib;
         #camaniva#1 = enSiiDoc;
         |LEE 000#camaniva.=;
         |SI FSalida ! 0;  |CIERRA #camaniva;  |FINSI;
         |CIERRA #camaniva;

         |ABRE #caerpnif;
         #caerpnif#0 = #camaniva#0;
         #caerpnif#1 = #camaniva#1;
         |LEE 000#caerpnif.=;
         |SI FSalida = 0;
             aClvPais = #caerpnif#4;
         |FINSI;
         |CIERRA #caerpnif;
     |FINSI;

     |HAZ LeeCliPro;

     |ABRET #casiim01;
     |ABRET #casiim02;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #casiim01;
     |CIERRAT #casiim02;
|FPRC;
