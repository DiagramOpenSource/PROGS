|FICHEROS;
   canempre #0;
   caportad #1;

   camandia #10;
   cientasl #11;  || por cuentas
   cajainli #12;  || por cajas
   caplalab #13;  || por nominas
   caentasc #14;  || por bloques
   cainliva #15;  || por facturas
   cavengli #16;  || por ventas englobadas
   cavenaut #17;  || por ventas diarias
   caconvel #18;

   camaasic #19;
   camemori #24;

   :/basica/def/agifigen #118;
   :/basica/def/agim0019 #119;
   :/basica/def/agim0020 #120;
   :/basica/def/agim0050 #150;
   :/basica/def/agim0051 #151;
   :/basica/def/agicen17;
   :/modelos/def/dsmom033;

   ca8ctrle #400;
   ca8comay #401;
|FIN;

|VARIABLES;
   &enTipOpera = 0;
   &enModelo   = 0;
   &efPn10 = @;
   &efPn11 = @;

   &efPn10A = @;
   &efPn11A = @;

   &enPin12 = 0;
   &eaPin13 = "";

   aBlancs = "";
   traba = "";
   aPin1 = "";
   aPin2 = "";
   aPin3 = "";
   aPin4 = "";
   aPin5 = "";
   aPin6 = "";
   aPin7 = "";
   aPin8 = "";
   aPin9 = "";
   aPin10 = "";
   aPin11 = "";
   aPin12 = "";
   nPin10 = 0;

   sPin1 = "";
   sPin2 = "";
   sPin3 = "";
   sPin4 = "";
   sPin5 = "";

   swExiste  = 0;
   &enEmpres = 0;
   &enPeriod = 0;
   &enActivi = 0;
   &eaCodSub = "";
   &enEjerci = 0;
   &enOperar = 0;
   &eaTipSoc = "";
   &enTipSoc = 0;
   nNume1    = 0;
   &enDesde  = 0;
   &eaPlan0  = "";
   &eaPlan1  = "";
   &enDescuadre = 0;
   &enParaActua = 0;
   &eaFecUltimo = "";
   &eaDocUltimo = "";
   &enActu1     = 0;
   &enActu2     = 0;
   &enActu3     = 0;
   &enActu4     = 0;
   &enActu5     = 0;
   &enActu6     = 0;
   &enActu7     = 0;
   enActu8      = 0;

   fFecha       = @;
   nNu          = 0;
   aAlfa1       = "";
   nPara1       = 0;
   &fichpath    = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE datpor_i;

|| **************************************************************************

|PROCESO FaltaActual;
 |SI nNu = 1; enActu1 = 1; |FINSI;
 |SI nNu = 2; enActu2 = 1; |FINSI;
 |SI nNu = 3; enActu3 = 1; |FINSI;
 |SI nNu = 4; enActu4 = 1; |FINSI;
 |SI nNu = 5; enActu5 = 1; |FINSI;
 |SI nNu = 6; enActu6 = 1; |FINSI;

 |SI nNu < 7;
     enParaActua = 1;
     |ERROR10;
 |FINSI;

 |SI nNu = 7;
     |PARA nPara1 = 2; |SI nPara1 [ 93; |HACIENDO nPara1 = nPara1 + 1;
           |SI #17nPara1 ! 0;
               enActu7 = 1;
               |SAL;
           |FINSI;
     |SIGUE;
     |SI enActu7 = 1;
         enParaActua = 1;
         |ERROR10;
     |FINSI;
 |FINSI;

 |SI nNu = 8;
     enActu8 = 1;
     |SI #18#4 ! 0;
         |SI #18#12 = " "; |O #18#12 = "N";
             enActu8 = 2;
         |FINSI;
     |FINSI;
     |SI enActu8 = 2;
         enParaActua = 1;
         |ERROR10;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE PorVentaMe;
 #18#1;
 ;
 "  ", 00;
 "zz", 99;
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorVentaDi;
 #17#1;
 ;
 00001, 1, "  ";
 99999, 9, "zz";
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorVentaEn;
 #16#1;
 ;
 "01.01.1900", 001;
 "31.12.2999", 999;
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorFactura;
 #15#1;
 ;
 00, 001;
 99, 999;
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorBloque;
 #14#1;
 ;
 "        ";
 "zzzzzzzz";
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorNomina;
 #13#1;
 ;
 0001;
 9999;
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorCaja;
 #12#1;
 ;
 "01.01.0000", 0001;
 "31.12.9999", 9999;
 ;
 NULL, FaltaActual;
|FIN;

|DEFBUCLE PorCuenta;
 #11#1;
 ;
 "            ", 00001;
 "zzzzzzzzzzzz", 99999;
 ;
 NULL, FaltaActual;
|FIN;

|PROCESO LeeLosDiarios;
 |SI #10#2 ! #10#3;
     enDescuadre = 1;
     |ERROR10;
 |FINSI;
|FPRC;

|DEFBUCLE LeeLosDiarios;
 #10#1;
 ;
 00;
 99;
 ;
 NULL, LeeLosDiarios;
|FIN;

|PROCESO VerCosasNuevas;
 enDescuadre = 0;
 |BUCLE LeeLosDiarios;

 enParaActua = 0;
 |SI enTipOpera ! 2;
     enActu1 = 0; nNu = 1; |BUCLE PorCuenta;
     enActu2 = 0; nNu = 2; |BUCLE PorCaja;
     enActu4 = 0; nNu = 4; |BUCLE PorBloque;
 |FINSI;
 |SI enModelo ! 303;
     enActu3 = 0; nNu = 3; |BUCLE PorNomina;
 |FINSI;
 enActu5 = 0; nNu = 5; |BUCLE PorFactura;
 |SI enTipOpera ! 2;
     enActu6 = 0; nNu = 6; |BUCLE PorVentaEn;
     enActu8 = 0; nNu = 8; |BUCLE PorVentaMe;
     |SI enActu8 = 0;
         enActu7 = 0; nNu = 7; |BUCLE PorVentaDi;
     |SINO;
         |SI enActu8 = 2;
             enActu7 = 1;
         |FINSI;
    |FINSI;
 |FINSI;

 |SI enTipOpera = 2; |ACABA; |FINSI;

 |ABRE #24;
 #24#0  = enEmpresa;
 #24#25 = enPeriodo;
 |LEE 001#24=;
 |SI FSalida = 0;
     eaFecUltimo = #24#6;
     aAlfa1 = #24#9; |QBF aAlfa1; aAlfa1 = ("000000" + aAlfa1) % -106;
     eaDocUltimo = aAlfa1;
     |CIERRA #24;
 |SINO;
     |CIERRA #24;

     aAlfa1 = Usuario;
     |QBF aAlfa1;
     aAlfa1 = "T" + (aAlfa1 % 107);
     |NOME_DAT #24 aAlfa1;

     |ABRE #24;
     #24#0  = enEmpresa;
     #24#25 = enPeriodo;
     |LEE 001#24=;
     |SI FSalida = 0;
         eaFecUltimo = #24#6;
         aAlfa1 = #24#9; |QBF aAlfa1; aAlfa1 = ("000000" + aAlfa1) % -106;
         eaDocUltimo = aAlfa1;
     |FINSI;
     |CIERRA #24;
 |FINSI;

 |ABRE #19;
 |SELECT #6#19;
 |LEE 001#19u;
 eaFecUltimo = #19#1;
 aAlfa1 = #19#2; |QBF aAlfa1; aAlfa1 = ("000000" + aAlfa1) % -106;
 eaDocUltimo = aAlfa1;
 |SELECT #1#19;
 |CIERRA #19;
|FPRC;

|PROCESO PonPaths;
   |PATH_DAT #10 fichpath;
   |PATH_DAT #11 fichpath;
   |PATH_DAT #12 fichpath;
   |PATH_DAT #13 fichpath;
   |PATH_DAT #14 fichpath;
   |PATH_DAT #15 fichpath;
   |PATH_DAT #16 fichpath;
   |PATH_DAT #17 fichpath;
   |PATH_DAT #18 fichpath;
   |PATH_DAT #19 fichpath;
   |PATH_DAT #24 fichpath;
|FPRC;

|PROCESO DatosActividad;

    aPin1 = #agicen14#7;
    aPin2 = #agicen14#9;
    aPin3 = #agicen14#1;

    aPin5 = (("00" + aPin1) % -102) + " " + #agicen14#8  % A129;
    aPin6 = (("00" + aPin2) % -102) + " " + #agicen14#10 % A129;
    aPin7 = #agicen14#04 % A134;
    aPin8 = #agicen14#3;

    aPin1 = "IVA ";
    aPin2 = "Tribut ";
    aPin3 = "Act ";
    aPin4 = "Ep ";

    efPn10 = #agicen14#5; efPn10A = #agicen14#5;
    efPn11 = #agicen14#6; efPn11A = #agicen14#6;
|FPRC;

|PROCESO PrimActividad;
    |HAZ DatosActividad;

    |SI #agicen14#6 [ "01.01.0000"; |O #agicen14#6 ] fFecha;
        |ERROR10;
    |FINSI;
|FPRC;

|DEFBUCLE PrimActividad;
    #agicen14#1;
    ;
    enEmpres, 01;
    enEmpres, 99;
    ;
    NULL, PrimActividad;
|FIN;

|PROCESO Subdepartamento;
   |SI eaCodSub [ "   "; |ACABA; |FINSI;

||   |SI enSubde = 1; |HAZ SubOtros; |ACABA; |FINSI;
aBlancs = " " * 40;
   |SI #agicen14#9 = 6;  |O #agicen14#9 = 7;
    |O #agicen14#9 = 11; |O #agicen14#9 = 12;
    |O #agicen14#9 = 16; |O #agicen14#9 = 17;
       |ABRE #dsmom033;
       #dsmom033#0 = eaCodSub;
       |LEE 001#dsmom033.=;
       |SI FSalida = 0;
           aPin10 = "Cultivo ";
           aPin11 = #dsmom033#1 % 170;
           nPin10 = 1;
       |FINSI;
       |CIERRA #dsmom033;
   |SINO;
       |ABRE #agicen17;
       #agicen17#0 = #agicen14#0;
       #agicen17#1 = #agicen14#1;
       #agicen17#2 = eaCodSub;
       |LEE 040#agicen17.=;
       |SI FSalida = 0;
           aPin10 = "Rf.Cat.";
           aPin11 = #agicen17#3 % 120;
           aPin12 = #agicen17#4; |QBF aPin12;
           |SI aPin12 ! ""; aPin12 = aPin12 + " "; |FINSI;
           aPin12 = (aPin12 + #agicen17#5) % 145;
           nPin10 = 2;
       |FINSI;
       |CIERRA #agicen17;
   |FINSI;
|FPRC;

|PROGRAMA;

   |HAZ DirAplicSt;
   |SI Haybasica = 0; |ACABA; |FINSI;

   |SI fichpath ! ""; |HAZ PonPaths; |FINSI;

   |SI enTipOpera = 0;
       |BLANCO 1901 2380;
   |FINSI;

   enDescuadre = 0;
   enParaActua = 0;
   eaFecUltimo = "";
   eaDocUltimo = "";
   enPin12 = 0;
   eaPin13 = "";

   efPn10  = "01.01.0000";
   efPn10A = "01.01.0000";
   efPn11  = "01.01.0000";
   efPn11A = "01.01.0000";
   aPin1   = "";
   aPin2   = "";
   aPin3   = "";
   aPin4   = "";
   aPin5   = "";
   aPin6   = "";
   aPin7   = "";
   aPin8   = "";
   aPin9   = "";
   aPin10  = "";
   aPin11  = "";
   aPin12  = "";
   nPin10  = 0;

   sPin1   = "";
   sPin2   = "";
   sPin3   = "";
   sPin4   = "";
   sPin5   = "";

   fFecha = ~;
   |SI enEjerci > 0;
       aAlfa1 = enEjerci;
       aAlfa1 = "01.01."+ aAlfa1;
       fFecha = aAlfa1;
   |FINSI;

   |SI enTipOpera = 2;  || Comprobar cuadre y actualizacion
       |HAZ VerCosasNuevas;
       |ACABA;
   |FINSI;

 || Lee Primera Actividad
    |BUCLE PrimActividad;

 || Lee Actividad
    |SI enActivi ! 0;
        |ABRE #agicen14;
        #agicen14#0 = enEmpres; || Empresa
        #agicen14#1 = enActivi;
        |LEE 041#agicen14.=;
        |SI FSalida = 0; |Y #agicen14#0 = enEmpres;
            |HAZ DatosActividad;
        |FINSI;
        |CIERRA #agicen14;
    |FINSI;

    |HAZ Subdepartamento;

 || Lee Ficha Sociedades
    swExiste = 0;
    |ABRE #agim0019;
    #agim0019#0 = enEmpres; || Empresa
    #agim0019#1 = 99;
    |LEE 041#agim0019.];
    |SI FSalida = 0;
       |LEE 041#agim0019.a;
    |SINO;
       |LEE 041#agim0019.u;
    |FINSI;
    |SI FSalida = 0; |Y #agim0019#0 = enEmpres;
         swExiste = 1;
    |FINSI;
    |SI swExiste = 1;

        efPn10  = #agim0019#7;      || Fecha Activa
        efPn11  = #agim0019#55;     || Fecha Inactiva
        sPin1   = #agim0019#4;
        sPin3   = (("00" + sPin1) % -102) + " " + #agim0019#5;
        sPin1   = "Sociedad ";
        enPin12 = #agim0019#4;
        eaPin13 = #agim0019#5;

        |ABRE #agim0020;
        #agim0020#0 = enEmpres; || Empresa
        #agim0020#1 = 000;
        |LEE 041#agim0020.];
        |SI FSalida = 0; |Y #agim0020#0 = enEmpres;

            sPin2 = #agim0020#1;
            sPin4 = (("000" + sPin2) % -103) + " " + (#agim0020#2  + sPin4) % A150;
            sPin2 = "Car.Declaracion Imp.Soc. "

            |SI #agim0020#1 = 12; |O #agim0020#1 = 13; |O #agim0020#1 = 15;
                sPin5 = "Transparencia Fiscal";
            |FINSI;
        |FINSI;
        |CIERRA #agim0020;
    |FINSI;
    |CIERRA #agim0019;

    |ABRE #agifigen;
    #agifigen#0 = enEmpres; || Empresa
    |LEE 041#agifigen.=;
    |SI FSalida = 0;
        efPn10  = #agifigen#93;
        efPn11  = #agifigen#94;
        enPin12 = #agifigen#87;
        eaPin13 = #agifigen#88;
    |FINSI;
    |CIERRA #agifigen;

    |SI efPn10 [ "01.01.1900"; efPn10 = "01.01.0000"; |FINSI;
    |SI efPn11 [ "01.01.1900"; efPn11 = "01.01.0000"; |FINSI;

    |SI enPin12 = 2;  || Lee tipo de Empresa

        nNume1      = enEjercicio;
        enEmpresa   = enEmpres;
        enEjercicio = enEjerci;
        eaNombreEmp = #agifigen#1;
        |HAZ ElTipoEmpSoc;
        aPin9 = eaTipSoc; |QBF aPin9;
        |SI aPin9 ! "";
            |QBF sPin3;
            sPin3 = sPin3 + " (" + aPin9 + ")";
        |FINSI;
        enEjercicio = nNume1;
    |FINSI;

    enDesde = 0;
    |SI enEjerci ] 2008;
        |ABRE #400;
        #400#0 = enEmpres;
        #400#1 = enPeriod;
        |LEE 141#400=;
        |SI FSalida = 0;
            |ABRE #401;
            |DDEFECTO #401;
            #401#0 = #400#2;
            |LEE 000#401=;
            |CIERRA #401;
            enDesde = 1;
            eaPlan0 = #400#2; eaPlan0 = ("00" + eaPlan0) % -102;
            eaPlan1 = #401#2;
        |FINSI;
        |CIERRA #400;
    |FINSI;

    |SI enTipOpera = 1;  || Comprobar cuadre y actualizacion
        |HAZ VerCosasNuevas;
    |FINSI;

    |SI enTipOpera = 0;
        |ATRI P;
        |PINTA 1902, aPin1;
        |PINTA 1940, aPin2;
        |PINTA 2002, aPin4;
        |SI efPn10A > "01.01.0000"; |PINTA 2045, "F.Alta "; |FINSI;
        |SI efPn11A > "01.01.0000"; |PINTA 2063, "F.Baja "; |FINSI;

        |PINTA 2202, sPin1;
        |PINTA 2302, sPin2;

        |SI nPin10 ! 0;
            |PINTA 2102, aPin10;
            |SI nPin10 = 2; |PINTA 2131, "Nom "; |FINSI;
        |FINSI;
        |ATRI 0;

        |ATRI I;
        |PINTA 1906, aPin5;
        |PINTA 1947, aPin6;
        |PINTA 2005, aPin8;
        |PINTA 2010, aPin7;
        |SI efPn10A > "01.01.0000"; |PINTA 2052, efPn10A; |FINSI;
        |SI efPn11A > "01.01.0000"; |PINTA 2070, efPn11A; |FINSI;

        |SI nPin10 ! 0;
            |PINTA 2110, aPin11;
            |SI nPin10 = 2; |PINTA 2135, aPin12; |FINSI;
        |FINSI;

        |PINTA 2212, sPin3;
        |PINTA 2327, sPin4;
        |PINTA 2258, sPin5;
        |ATRI 0;

        |PUSHV 1901 2380;
    |FINSI;
|FPRO;
