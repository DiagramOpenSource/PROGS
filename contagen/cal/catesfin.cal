|FICHEROS;
   catesfin #0,MANTE;
   cacuenta #2;
   caz00001 #999;
   canempre #30;
   n43saldo #43;

   caselem1 #998;
   &catesfi@ #900;
   &n43sald@ #943;
|FIN;

|VARIABLES;
    &entrada  = 1;
    &Fin      = 0;
    &nDelMant = 0;
    &eaPathO  = "";
    &eaPathI  = "";
    &aParam   = "";

    nInkey    = 0;
    nume1     = 0;
    nSumo     = 0;
    nPinta    = 0;
    nModo     = 0;

    aQueQuiero = "";
    aNumCampos = "";
    nNumCampos = 0;
    nCampo     = 0;
|FIN;

|INCLUYE dscont_i;

||:::::::::::::::::::::::: Calculos Pantalla
|CALCULO Cuenta; |TIPO 6;
     eaCuenta = #0Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
|FCAL;

|CALCULO CueFin; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI eaCuenta = doce; |Y nModo = 1;
         |ERROR;
         |ACABA;
     |FINSI;

     emCta    = 1;
     eaCuenta = #0Campo;
     |HAZ SacaNivel;
     |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
     nume1 = Campo + 1; #0nume1 = enNivel;
     |HAZ LeeCuenta;
     |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea

     #0#2 = #cacuenta#2;  |PINTA #0#2;
     #0#3 = #cacuenta#53; |PINTA #0#3;
     #0#4 = #cacuenta#58; |PINTA #0#4;
|FCAL;

|CALCULO Tipo2;  |TIPO 2;
     |SI #0#3 > 0; #999#0 = #999#0 +.    #0#3;  |FINSI;
     |SI #0#3 < 0; #999#1 = #999#1 +. (-#0#3);  |FINSI;
     #999#2 = #999#0 - #999#1;
     |PINTA #999#0;
     |PINTA #999#1;
     |PINTA #999#2;
|FCAL;

|| ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
|PROCESO Refresca;
  #2#0 = #900#0;
  |LEE 041#2=;
  |SI FSalida = 0;
      #900#2 = #cacuenta#2;
      #900#3 = #cacuenta#53;
      #900#4 = #cacuenta#58;
      |GRABA 101#900a;
  |SINO;
      |BORRA 020#900a;
      |LIBERA #900;
      |ACABA;
  |FINSI;
  |LIBERA #900;

  |SI nPinta = 1;
      |PINTA 2214, #900#0;
      |PINTA 2226, #900#2;
      |PINTA 2263, #900#3;
  |FINSI;

  |SI nSumo = 1;
      |SI #900#3 > 0;  #999#0 = #999#0 + #900#3;     |FINSI;
      |SI #900#3 < 0;  #999#1 = #999#1 + (-#900#3);  |FINSI;
      #999#2 = #999#0 - #999#1;
      |PINTA #999#0;
      |PINTA #999#1;
      |PINTA #999#2;
  |FINSI;
|FPRC;

|DEFBUCLE catesfinA;
     #900#1001;
     ;
     "            ";
     "zzzzzzzzzzzz";
     be;
     NULL, Refresca;
|FIN;

|PROCESO n43saldo_A;
  #900#0 = #43#6;
  |LEE 041#900=;
  |SI FSalida ! 0;
      |DDEFECTO #900;
      #900#0 = #43#6;
      #900#1 = #43#7;
      #900#2 = #43#1;
      |GRABA 101#900n;
  |FINSI;
  |LIBERA #900;
|FPRC;

|DEFBUCLE n43saldo_A;
     #43#1;
     10;
     001, "S";
     999, "S";
     e;
     NULL, n43saldo_A;
|FIN;

|PROCESO LeoBancos;
  #43#0 = #943#0;
  |LEE 041#43=;
  |SI FSalida ! 0;
      |DDEFECTO #43;
      #43#0 = #943#0;
      |PARA nCampo = 1; |SI nCampo [ nNumCampos; |HACIENDO nCampo = nCampo + 1;
            #43nCampo = #943nCampo;
      |SIGUE;
      |GRABA 101#43n;
  |FINSI;
  |LIBERA #43;
|FPRC;

|DEFBUCLE LeoBancos;
     #943#1001;
     ;
     001;
     999;
     e;
     NULL, LeoBancos;
|FIN;

|PROCESO Actua_Con43;
  |SI aParam = "Cierre";
     |PATH_DAT #2   eaPathO;
     |PATH_DAT #900 eaPathO;
     |PATH_DAT #43  eaPathO;
     |PATH_DAT #943 eaPathI;

     aQueQuiero = "|NC";
     aNumCampos = #n43saldo#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |ABRE #43;
     |BUCLE LeoBancos;
     |CIERRA #43;
  |FINSI;

  |ABRE #2;
  |ABRE #900;
  |BUCLE n43saldo_A;
  |CIERRA #900;
  |BUCLE catesfinA;
  |CIERRA #2;

|FPRC;


||...... Funciones
|CALCULO Tipo11;  |TIPO 11;

    nInkey = FSalida;
    salidas = 0;

    |SI nInkey = 15;                    || (F7)
        |HAZ MultiEmpresa;

        |PONCONTROL  23, "SI";

        |ACABA;
   |FINSI;

   |SI nInkey = 14; |O nInkey = 16;  || (F6 y F8)  Imprimir
       nDelMant = 1; |SI nInkey = 14; nDelMant = 0; |FINSI;
       |SUB_EJECUTA_NP "cay00001";
       |ERROR;
       |ACABA;
   |FINSI;

   |SI nInkey = 17;                    || (F9)

       nSumo  = 1;
       nPinta = 0;
       #999#0 = 0; |PINTA #999#0;
       #999#1 = 0; |PINTA #999#1;
       #999#2 = 0; |PINTA #999#2;

       |HAZ Actua_Con43;

       |PONCONTROL  23, "SI";

       |ACABA;
  |FINSI;

  |SI nInkey = 20;                    || (Ctrl-F2)
     eaCuenta = #0Campo;
     salidas  = nInkey;
     |HAZ FiltraPuntos;
  |FINSI;

  |SI nInkey = 1; |O nInkey = 7;
      Fin = 0
      |CONFI "    SSalir de la Introduccion";
      |SI FSalida = 0; Fin = 1; |FINSI;
  |FINSI;
|FCAL;

|| ***********************************************************************
|PROCESO MultiEmp1;

  |ATRI S;
  |PINTA 2204," Cuenta :                                                                ";
  |ATRI 0;

  |DDEFECTO #30;
  #30#2 = #caselem1#1;
  #30#3 = #caselem1#2;
  |LEE 041#30=;

  dirfich0 = #caselem1#3;
  |QBF dirfich0;

  |PATH_DAT #2   dirfich0;
  |PATH_DAT #900 dirfich0;
  |PATH_DAT #43  dirfich0;

  |PINTA 2114, #30#2;
  |PINTA 2120, #30#3;
  |PINTA 2122, #30#1;

  nSumo = 0;
  |SI eaPathO  = dirfich0;  ||estoy en la empresa de la pantalla
      #999#0 = 0; |PINTA #999#0;
      #999#1 = 0; |PINTA #999#1;
      #999#2 = 0; |PINTA #999#2;
      nSumo  = 1;
  |FINSI;

  |HAZ Actua_Con43;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
   |SUB_EJECUTA "caselemp";
   |NOME_DAT #998 eaFichsel;

   |PUSHV 2003 2380;
   |ATRI S;
   |PINTA 2104," Empresa:                                                                 ";
   |PINTA 2204," Cuenta :                                                                 ";
   |ATRI 0;
   |CUADRO 2003 2377;

   nPinta = 1;
   |ABRE #30;
   |BUCLE MultiEmp0;
   |CIERRA #30;
   |DELINDEX #998;

   |POPV;
   |PATH_DAT #2   eaPathO;
   |PATH_DAT #900 eaPathO;
   |PATH_DAT #43  eaPathO;
   |PATH_DAT #943 eaPathI;
|FPRC;
