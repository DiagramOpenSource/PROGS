|FICHEROS;
     comz0002 #0;

     caenlace #100;      ||Fichero TMP Enlace
     canempre #1;

     camaasic #3;
     caconasi #102;

     comw0003 #333;      ||Aux. Impor.Cobros

     :/modelos/def/dsmom030 #30;        || conceptos
|FIN;

|VARIABLES;
     aSerAnt = "";
     fEmiAnt = @;
     nSuma = 0;
     aSerie = "";
     fEmision = @;

     aDesc = "";
     nVoyPor = 0;
     nDocumento = 0;

 aAlfa = "";

 t0=""; ||fra A(6)
 t1=""; ||recibo N ||3
 t3=""; ||nombre A(30)
 t7=""; ||fecha Emision   || 10
 t8=""; ||fecha Vto       || 10
 t9=""; ||importe * 100   || 10
 t12="";||numero contable ||A10
 t15="";||Periodo         ||A1
 t16="";||Serie           ||A2
 n0=0;
 n1=0;
 n3=0;
 n7=0;
 d7=@;
 n8=0;
 d8=@;
 n9=0;
 n12=0;
 n15=0;
 alfa007="";
 varalfa="";
 hw_eof=0;
 f=0;
 f2=0;
 longitud=0;

 cbanco = "";
 &modcon = 0;
 &codcon = 0;
 &path = "";
 &path1 = "";
 &dig1 = 0;
 &dig2 = 0;
 &dig3 = 0;
 &dig4 = 0;
 &dig5 = 0;
 &dig6 = 0;
 &dig7 = 0;
 &dig8 = 0;
 &dig9 = 0;
 opera = "A";
 importe = 0;
 empresa = "";
 anyo = "";
 cuenta = "";         ||Cuenta Contable
 puente = "";         ||Digito de la Cuenta
 digito = 0;
 digito1 = 0;
 digito2 = 0;
 nivel = 0;
 long = "";
 i = 0;
 fecha = @;
 fecha2= @;
 pongo = 0;
    cojo = 0;
    cojo1 = "";
    alfa = "";
    alfa1 = "";
    sw = 0;
    lin = 0;
    nopasa = "S";
    prim_lin = "S";
    cuenta1 = "";
    imp = 0.0;
    imp_d = 0;
    imp_h = 0;
    signo = "";
    desc = "";
    desc1 = "";
    d_bueno = 0;
    c_buena = "";
    ult_fec = @;
    conc = 0;
    linea = 0;
    ini = 0;
    fecalf = "";
    mes = "";
    mesfec = 0;
    mesac = 0;
    a = 0;
    b = 0;
    c = 0;
    uno = "";
    dos = "";
    mensa2 = "    No Esta definida Esta cuenta en Cuentas de Balance";
    mascara = "";
    &EURO = 166.386;
    &EURODB = 2;
    &EURODV = 0;
    permisos="chmod 777 u/agi/comersan/fich/02/tmp00001*"

|FIN;

|PROCESO Contador1;
     |ABRE #caconasi;
     |LEE 101#caconasi.p;
     |SI FSalida ! 0;
         |DDEFECTO #caconasi;
         |GRABA 020#caconasi.n;
         |LEE 101#caconasi.p;
     |FINSI;
         #caconasi#1 = #caconasi#1 + 1;
     |GRABA 020#caconasi.a;
     |LIBERA #caconasi;
     |CIERRA #caconasi;
|FPRC;

|PROCESO MeteDebe;
     ||EL DEBE
     nVoyPor = nVoyPor +1;
     |DDEFECTO #caenlace;
     #caenlace#0 = #comz0002#2;
     #caenlace#1 = fEmiAnt;
     #caenlace#2 = nDocumento;
     #caenlace#3 = nVoyPor;
     #caenlace#37 = #comz0002#0;
     #caenlace#38 = #comz0002#1;
     |LEE 101#caenlace.=
     |SI FSalida ! 0; |GRABA 020#caenlace.b; |FINSI;
     #caenlace#4 = "4310000000";
     #caenlace#5 = 5;
     #caenlace#6  = #comz0002#3;
     aDesc = #comz0002#5;
     |QBF aDesc;
     aDesc = aDesc + " " + d8;
     #caenlace#7  = "VARIOS EFECTOS";
     #caenlace#8  = "D";
     #caenlace#9  = nSuma;

     ||#caenlace#10 = ;  ||Sop/Rep/Cob/Pag

     #caenlace#11 = 0;

     #caenlace#12 = aSerAnt;
     #caenlace#13 = "";
     #caenlace#14 = "";
     ||#caenlace#15 = ;    ||Departamento
     #caenlace#29 = fEmiAnt;
     #caenlace#31 = "N";
     #caenlace#32 = "N";
     ||#caenlace#39 = ;    ||Cuenta Analitica
     ||#caenlace#45 = ;    ||Departamento
     ||#caenlace#26 = ;    ||Serie Fac. Original

     ||#caenlace#27 = ;    ||Numero Acumulador
     #caenlace#26 = "F";
     #caenlace#27 = 0;
     #caenlace#43 = "";
     |GRABA 020#caenlace.a;
     |LIBERA #caenlace;

     nSuma = 0;
|FPRC;

|PROCESO hacer;
     ||TODO CCC

     aSerie = #comw0003#8;
     fEmision = #comw0003#3;

     |SI aSerie ! aSerAnt; |O fEmision ! fEmiAnt;
          |SI aSerAnt ! "-1";
               |HAZ MeteDebe;
          |FINSI;
          |HAZ Contador1;
          nDocumento = #caconasi#1;
          nVoyPor = 0;

          aSerAnt = aSerie;
          fEmiAnt = fEmision;
     |FINSI;

     ||Primero Hago el HABER
     nVoyPor = nVoyPor +1;
     |DDEFECTO #caenlace;
     #caenlace#0 = #comz0002#2;
     #caenlace#1 = d7;
     #caenlace#2 = nDocumento;
     #caenlace#3 = nVoyPor;
     #caenlace#37 = #comz0002#0;
     #caenlace#38 = #comz0002#1;
     |LEE 101#caenlace.=
     |SI FSalida ! 0; |GRABA 020#caenlace.b; |FINSI;
     #caenlace#4 = t12;
     #caenlace#5 = 5;
     #caenlace#6  = #comz0002#3;
     aDesc = #comz0002#6;
     |QBF aDesc;
     aDesc = aDesc + " " + d8;
     #caenlace#7  = aDesc;
     #caenlace#8  = "H";
     #caenlace#9  = n9;

     ||#caenlace#10 = ;  ||Sop/Rep/Cob/Pag

     #caenlace#11 = 0;

     #caenlace#12 = t16;
     #caenlace#13 = t0;
     #caenlace#14 = t1;
     ||#caenlace#15 = ;    ||Departamento
     #caenlace#29 = d7;
     #caenlace#31 = "N";
     #caenlace#32 = "N";
     ||#caenlace#39 = ;    ||Cuenta Analitica
     ||#caenlace#45 = ;    ||Departamento
     ||#caenlace#26 = ;    ||Serie Fac. Original

     ||#caenlace#27 = ;    ||Numero Acumulador
     #caenlace#26 = "F";
     #caenlace#27 = 0;
     #caenlace#43 = t3;
     |GRABA 020#caenlace.a;
     |LIBERA #caenlace;

     nSuma = nSuma + n9;
|FPRC;

|PROCESO ControlDiario;
     ||TODO CCC
|FPRC;

|PROCESO comw0003;
     ||TODO CCC
     t0 = #comw0003#0;
     t1 = #comw0003#1;
     t3 = #comw0003#2;
     t7 = #comw0003#3;
     d7 = t7;
     t8 = #comw0003#4;
     d8 = t8;
     t9 = #comw0003#5;
     n9 = t9;
     n9 = n9 * 0.010;
     t12 = #comw0003#6;
     t15 = #comw0003#7;
     t16 = #comw0003#8;
     |HAZ hacer;
|FPRC;

||TODO CCC
|DEFBUCLE comw0003;
 #comw0003#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, comw0003;
|FIN;

|PROCESO MeteTempo;
     |DDEFECTO #comw0003;
     #comw0003#8 = t16;
     #comw0003#3 = t7;
     #comw0003#0 = t0;
     #comw0003#1 = t1;
     |LEE 101#comw0003.=;
     |SI FSalida ! 0; |GRABA 020#comw0003.b; |FINSI;
     #comw0003#2 = t3;
     #comw0003#4 = t8;
     #comw0003#5 = t9;
     #comw0003#6 = t12;
     #comw0003#7 = t15;
     |GRABA 020#comw0003.a;
     |LIBERA #comw0003;
|FPRC;

|PROCESO inicioz0002; |TIPO 3;
     |HAZ empre;

     aAlfa = "xu" + Usuario;
     |NOME_DAT #caenlace#aAlfa#;
     |DELINDEX #caenlace;
     |ABRE #caenlace;

     |HAZ ControlDiario;

     |ABRE #3;

     |DELINDEX #333;
     |ABRE #333;

     linea=1;
     alfa007 ="rt  /u/win95/dbfs/recibo.txt";
     |FABRE alfa007
     f=FSalida;
     |SI FSalida ] 0;
          |PARA;|SI hw_eof = 0;|HACIENDO;
               varalfa= f + " " + 250;
               |FLEE varalfa;
               longitud=FSalida;
               |SI longitud>0;
                    t0 = varalfa %106;
                    t1 = varalfa %703;
                    t3 = varalfa %1030;
                    n3 = t3;
                    t7 = varalfa %4010;
                    d7 = t7;
                    |||||||n4 = n4 * 0.10;
                    t8 = varalfa %5010;
                    d8 = t8;
                    t9 = varalfa %6010
                    n9 = t9;
                    n9 = n9 * 0.010;
                    t12 = varalfa %7010;
                    t15 = varalfa %8001;
                    t16 = varalfa %8102;
                    |HAZ MeteTempo;
                    linea=linea+1;
                    hw_eof=0;
               |SINO;
                    hw_eof=1;
               |FINSI;
          |SIGUE;
     |FINSI;

     FSalida=f;
     |SI f ] 0;
          |FCIERRA FSalida;  ||Sentencia TFD
          alfa007 ="/u/win95/dbfs/recibo.txt";
||TODO CCC. Descomentar
          |FBORRA alfa007;
     |FINSI;

     |CIERRA #333;

     |SI linea > 1;
          nSuma = 0;
          aSerAnt = "-1";
          fEmiAnt = "01.01.0000";
          |BUCLE comw0003;
          |HAZ MeteDebe;
     |FINSI;

     |CIERRA #3;

     |DFICE aAlfa; |QBF aAlfa;
     aAlfa = "dsapunte.tab;" + aAlfa + ",xu" + Usuario;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO empre;

     dig1 = #48#11;    ||Desde mes
     dig3 = #48#13;    ||Num. niveles
     dig4 = #48#14;    ||digito 1
     dig5 = #48#15;    ||Digito 2
     dig6 = #48#16;    ||3
     dig7 = #48#17;    ||4
     dig8 = #48#18;    ||5
     dig9 = #48#19;    ||6

/*
     path ????
    long   = path % 0;
    digito = long - 5;
    long   = digito;
    long   = "1" + long;
    path1  = (path % long) + "pan/";
    path   = path + empresa +  "/";
*/

|FPRC;


|PROCESO Tipo7C0; |TIPO 7;
     empresa = #48#2;
     anyo = #48#3;

     #comz0002#0 = empresa;
     #comz0002#1 = anyo;
     |PINTA #comz0002#0;
     |PINTA #comz0002#1;
|FPRC;

|PROCESO Tipo0C3; |TIPO 0;
     |ABRE #30;
     #30#0 = #comz0002#3;
     |LEE 000#30=;
     #comz0002#5 = #30#1;
     |PINTA #comz0002#5;
     |CIERRA #30;
|FPRC;

|PROCESO Tipo0C4; |TIPO 0;
     |ABRE #30;
     #30#0 = #comz0002#4;
     |LEE 000#30=;
     #comz0002#6 = #30#1;
     |PINTA #comz0002#6;
     |CIERRA #30;
|FPRC;
