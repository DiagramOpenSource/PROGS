|FICHEROS;
   caextrap #0;
   camaasil #1;         || apuntes lins.
   cacuenta #3;         || cuentas
   caextrp2 #4;         || pantalla display
   caextrp5 #5;         || pantalla display II
   caextrp7 #7;         || pantalla display III

   camaasic #11;
   calicont #31;

   caclipro #13;
   canempre #30;
   caselem1 #998;

   caconimp #8;
   ca8m0003 #403;
   ca8m0004 #404;
|FIN;

|VARIABLES;
   &enBtnItemDoc = -1;
   aParam = "";
   mensa1 = "    ATENCION!!! Fecha fuera de periodo ...";
   linea = 0;
   FEstado = 0;
   hay_alguno = 0;
   &entrada = 1;
   &efDFecha = @;
   &efHFecha = @;
   &ext1   = "";
   &ext2   = "";
   &d_abajo = 0;
   &h_abajo = 0;
   &s_abajo = 0;
   &runnom = "";
   &espe1 = @;
   &espe2 = @;
   &espe3 = 0;
   &espe4 = 0;
   &espe5 = "";
   &espe6 = "";
   &espe7 = 0;
   &espe8 = 0;
   &espe9 = 0;
   &espe10 = "";
   &espe11 = "";
   &eSwMul = 0;
   &espe15 = "";
   &espe16 = 0;
   &sino = "";
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   alfa5 = "";
   fe1 = @;
   fe2 = @;
   &aFitxer = "";

   nDebe  = 0;
   nHaber = 0;
   &enEmpOrg = 0;
   &enPerOrg = 0;
   &eaFEmp   = "";
   &swVarios = 0;
   &eaMonOrg = "";
   &enBEjer  = 0;
   nDeb1 = 0;
   nHab1 = 0;
   aContrapartida = "";
   aNomContra     = "";
   &enDesAna = 0;

   aAlfa  = "";
   nCalc = 0;
   nCont = 0;

   nDia8     = 0;
   fFec8     = @;
   nDoc8     = 0;
   nIgual     = 0;
   nAsto8     = 0;
   nDiaAper   = 0;
   contra_ad  = "";
   contra_tad = "";
   contra_ah  = "";
   contra_tah = "";
   contra_d   = "";
   contra_td  = "";
   contra_h   = "";
   contra_th  = "";
   nSwAper    = 0;
   aCta08 = "";
   aCta90 = "";
   aPath08 = "";
   aCtaSe = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aAlfa4 = "";
   aFichOri = "";
   aFichDes = "";

   nSwDsPreven = 0;

   &eaEspTabla = "";
   &enInkey    = 0;
   &nQuantHay  = 0;
   &enEste     = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscopi_i;
|INCLUYE modulo_i;

|| ... Procesos de Pantalla
|CALCULO fechad; |TIPO 0;
   |SI #0#2 < fec1; |O #0#2 > fec2;
      |MENAV mensa1;
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO fechah; |TIPO 0;
   |SI #0#3 < fec1; |O #0#3 > fec2; |O #0#3 < #0#2;
      |MENAV mensa1;
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO no_dep; |TIPO 7;
   |CAMPO_MODIFICA #0#7, 1, eaDepar;
   |CAMPO_MODIFICA #0#8, 1, eaDepar;
|FCAL;

|CALCULO nosubde; |TIPO 7;
   |CAMPO_MODIFICA #0#13, 1, eaSubde;
   |CAMPO_MODIFICA #0#14, 1, eaSubde;
|FCAL;

|| **********************************************************************
|PROCESO ParaApertura;
   nDia8  = -1;
   nAsto8 = 0;
   contra_ad  = ""; contra_tad = "";
   contra_ah  = ""; contra_tah = "";

   |SI enEjercicio = 2008;
       |ABRE #8;
       |DDEFECTO #8;
       #8#0 = 1;
       |LEE 001#8=;
       |CIERRA #8;

       |SI #8#11 = "S";
           |ABRE #404;
           |LEE 001#404p;
           |SI FSalida = 0;
               nDia8 = #404#10;
               fFec8 = #404#11;
               nDoc8 = #404#12;
           |FINSI;
           |CIERRA #404;
           |ABRE #11;
           #11#0 = nDia8;
           #11#1 = fFec8;
           #11#2 = nDoc8;
           |LEE 001#11=;
           |SI FSalida = 0;
               contra_ad  = #11#10; contra_tad = "";
               contra_ah  = #11#8;  contra_tah = "";
               |HAZ LeeContra;
           |FINSI;
           |CIERRA #11;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO LeeContra;
  |ABRE #3;
  |DDEFECTO #3;
  #3#0 = contra_ad;
  |LEE 000#3=;
  contra_tad = #3#2;

  |DDEFECTO #3;
  #3#0 = contra_ah;
  |LEE 000#3=;
  contra_tah = #3#2;

  |CIERRA #3;
|FPRC;

|| **********************************************************************
|PROCESO BuscaContra;
    aContrapartida = "";
    aNomContra     = "";

|SI nSwAper = 0;
    #31#0 = #1#0;
    #31#1 = #1#1;
    #31#2 = #1#2;
    #31#3 = #1#3;
    |LEE 001#31=;
    |SI FSalida = 0;
        aContrapartida = #31#4;
    |SINO;

        #11#0 = #1#0;
        #11#1 = #1#1;
        #11#2 = #1#2;
        |LEE 001#11=;
        |SI FSalida = 0;
            |SI #1#8 = "D"; aContrapartida = #11#10; |FINSI;
            |SI #1#8 = "H"; aContrapartida = #11#8;  |FINSI;
        |FINSI;
   |FINSI;
|SINO;
   |SI #1#8 = "D"; aContrapartida = contra_d; |FINSI;
   |SI #1#8 = "H"; aContrapartida = contra_h; |FINSI;
|FINSI;

   #3#0 = aContrapartida;
   |LEE 001#3=;
   |SI FSalida = 0;
       aNomContra = #3#2;
   |FINSI;
|FPRC;

|| .... Crear Auxiliares
|PROCESO Apertura2008;
   |SALVA_DATOS #1;

   |ABRE #404;
   |DDEFECTO #404;
   #404#10 = nDia8;
   #404#11 = fFec8;
   #404#12 = nDoc8;
   #404#0  = #1#3;
   |LEE 041#404=;
   |SI FSalida ! 0; |O #404#8 ! #1#4; || no existe o no son iguales
       |CIERRA #404;
       |REPON_DATOS #1;
       |HAZ ParaImprimir;
       |ACABA;
   |FINSI;
   || .... Primer Asiento Apertura 2007
   nSwAper   = 1;
   contra_d  = contra_ad;
   contra_td = contra_tad;
   contra_h  = contra_ah;
   contra_th = contra_tah;
   #1#4 = #404#1;
   #1#5 = #404#7;
   |HAZ ParaImprimir;
   |SI #404#8 ! #404#1;
       nSwAper = 2;
       contra_d  = #404#8; contra_td = #404#2;
       contra_h  = #404#8; contra_th = #404#2;
       #1#4 = #404#1;   || 2§ asiento
       #1#5 = #404#7;
       #1#7 = #8#13;
       |SI #404#3 = "D";
           #1#8 = "H";
       |SINO;
           #1#8 = "D";
       |FINSI;
       #1#9 = #404#4 + #404#5;
       |HAZ ParaImprimir;

       nSwAper = 3;
       contra_d  = #404#1; contra_td = #404#2;
       contra_h  = #404#1; contra_th = #404#2;
       #1#4 = #404#8;   || 2§ asiento
       #1#5 = #404#9;
       #1#7 = #8#13;
       #1#8 = #404#3;
       #1#9 = #404#4 + #404#5;
       |HAZ ParaImprimir;
   |FINSI;
   |CIERRA #404;
   |REPON_DATOS #1;
|FPRC;

|PROCESO buclepan_esp;
   nSwAper = 0;
   |SI nDia8 ! -1;
       |SI #1#0 = nDia8; |Y #1#1 = fFec8; |Y #1#2 = nDoc8;
           |HAZ Apertura2008;
           nDiaAper = 1;
           |ACABA;           ||este asiento se trata de forma diferente
       |FINSI;
   |FINSI;

   |HAZ ParaImprimir;
|FPRC;

|PROCESO ParaImprimir;
  |SI #0#9 = 1;
      |HAZ buclepan;
  |SINO;
      |HAZ buclepan1;
  |FINSI;
|FPRC;

|PROCESO buclepan;
 |SI #1#28 ] #0#13; |Y #1#28 [ #0#14;
   |SI eaMonOrg ! eaMoneda;
       |HAZ LoCambio;
   |FINSI;

   #4#00 = linea;            || linea
   |LEE 101#4=;
   FEstado = FSalida;
   #4#00 = linea;            || linea
   #4#01 = #0#0;             || cuenta
   #4#02 = #0#4;             || descripcion
   #4#03 = #0#2;             || desde fecha
   #4#04 = #0#3;             || hasta fecha
   #4#45 = #0#17;            || NIF
   #4#18 = #camaasil#0;             || diario
   #4#08 = #camaasil#1;             || fecha
   #4#09 = #camaasil#2;             || documento
   #4#19 = #camaasil#3;             || Apunte
   #4#10 = #camaasil#7;             || descripcion
   #4#20 = #camaasil#21;            || Departamento
   #4#21 = #camaasil#28;            || Subdepartamento
   #4#11 = #camaasil#8;             || signo (no en pantalla!!!)
   #4#29 = #camaasil#6;             || Numero de Concepto

   |SI #4#11 = "D";
       #4#05 = #4#05 + #camaasil#9; || total debe arriba
       #4#12 = #camaasil#9;                || importe debe
       #4#13 = #4#13 + #camaasil#9; || total saldo detalle
       #4#14 = #4#14 + #camaasil#9; || total debe abajo
       #4#17 = 0;                          || importe haber detalle
       d_abajo = d_abajo + #camaasil#9;           || ACUMULADO DEBE FINAL
   |SINO;
       #4#06 = #4#06 + #camaasil#9; || total haber arriba
       #4#12 = 0;            || importe debe
       #4#13 = #4#13 - #camaasil#9; || total saldo detalle
       #4#15 = #4#15 + #camaasil#9; || total haber abajo
       #4#17 = #camaasil#9;                || importe haber detalle
       h_abajo      = h_abajo + #camaasil#9;      || ACUMULADO HABER FINAL
   |FINSI;

   #4#07 = #4#05 - #4#06;              || saldo arriba
   s_abajo = d_abajo - h_abajo;        || SALDO FINAL

||.. grabo la Empresa
   #4#23 = enEmpresa;
   #4#24 = enPeriodo;
   #4#25 = dirfich0;
   #4#26 = eaMoneda;
   #4#27 = eaDepar;
   #4#28 = eaSubde;
   #4#44 = fec3;

   || ... Grabar todos los campos del camaasil
   #4#30 = #camaasil#12;
   #4#31 = #camaasil#13;
   #4#32 = #camaasil#14;
   #4#33 = #camaasil#15;
   #4#34 = #camaasil#19;
   #4#35 = #camaasil#20;
   #4#36 = #camaasil#22;
   #4#37 = #camaasil#23;
   #4#38 = #camaasil#24;
   #4#39 = #camaasil#25;
   #4#40 = #camaasil#26;
   #4#41 = #camaasil#27;
   #4#42 = #camaasil#29;
   #4#43 = #camaasil#1;
   |HAZ BuscaContra;
   #4#46 = aContrapartida;
   #4#47 = aNomContra;

   #4#48 = aCta08;
   #4#49 = aCta90;
   #4#50 = nSwAper;

   |SI #camaasil#1 ] #0#2;|Y #camaasil#1 [ #0#3;
        hay_alguno = 1;
   |FINSI;

   |SI #camaasil#1 [ #0#3;              || fecha dentro del limite hasta

       |SI #camaasil#1 ] #0#2;
           |SI FEstado = 0;
               |GRABA 020#4a;
           |SINO;
               |GRABA 020#4n;
           |FINSI;
           linea = linea + 1;
       |SINO;
           |SI #4#11 = "D"; nDeb1 = nDeb1 + #camaasil#9; |FINSI;
           |SI #4#11 = "H"; nHab1 = nHab1 + #camaasil#9; |FINSI;
       |FINSI;
   |FINSI;
   |LIBERA #4;
 |FINSI;
|FPRC;

|DEFBUCLE caextrp00;
   #1#3;
   0, 6, 21;
   aCtaSe, fe1,      0, 0000, #0#10, #0#5, #0#7;
   aCtaSe, fe2, 999999, 9999, #0#11, #0#6, #0#8;
   ;
   NULL, NULL, NULL, NULL, NULL, buclepan_esp;
   #1#1,#1#0,#1#2,#1#3;
|FIN;
_____________________________________________________________________________
|PROCESO buclepan1;
|SI #1#28 ] #0#13; |Y #1#28 [ #0#14;
   |SI eaMonOrg ! eaMoneda;
       |HAZ LoCambio;
   |FINSI;

   #5#00 = linea;            || linea
   |LEE 101#5=;
   FEstado = FSalida;
   #5#00 = linea;            || linea
   #5#01 = #0#0;             || cuenta
   #5#02 = #0#4;             || descripcion
   #5#03 = #0#2;             || desde fecha
   #5#04 = #0#3;             || hasta fecha
   #5#47 = #0#17;
   #5#18 = #camaasil#0;             || diario
   #5#08 = #camaasil#1;             || fecha
   alfa5 = #camaasil#1;
   alfa2 = alfa5 % 102;
   alfa3 = alfa5 % 402;
   alfa4 = alfa5 % 902;
   alfa5 = alfa2 + alfa3 + alfa4;
   #5#17 = alfa5;
   #5#26 = alfa2 + alfa3;
   #5#09 = #camaasil#2;             || documento
   #5#19 = #camaasil#3;
   #5#10 = #camaasil#7;             || descripcion
   #5#11 = #camaasil#8;             || signo
   #5#20 = #camaasil#21;            || Departamento
   #5#21 = #camaasil#28;            || Subdepartamento

   #5#12 = #camaasil#9;             || importe debe
   |SI #5#11 = "D";
       #5#05 = #5#05 + #camaasil#9; || total debe arriba
       #5#13 = #5#13 + #camaasil#9; || total saldo detalle
       #5#14 = #5#14 + #camaasil#9; || total debe abajo
       d_abajo = d_abajo + #camaasil#9;       || ACUMULADO DEBE FINAL
   |SINO;
       #5#06 = #5#06 + #camaasil#9; || total haber arriba
       #5#13 = #5#13 - #camaasil#9; || total saldo detalle
       #5#15 = #5#15 + #camaasil#9; || total haber abajo:
       h_abajo = h_abajo + #camaasil#9;       || ACUMULADO HABER FINAL
   |FINSI;
   #5#07 = #5#05 - #5#06;              || saldo arriba
   s_abajo = d_abajo - h_abajo;        || SALDO FINAL

   #5#30 = #camaasil#6;
||.. grabo la Empresa
   #5#22 = dirfich0;
   #5#23 = enEmpresa;
   #5#24 = enPeriodo;
   #5#25 = eaMoneda;
   #5#27 = enEjercicio;
   #5#28 = eaDepar;
   #5#29 = eaSubde;
   #5#46 = fec3;

   #5#31 = #camaasil#12;
   #5#32 = #camaasil#13;
   #5#33 = #camaasil#14;
   #5#34 = #camaasil#15;
   #5#35 = #camaasil#19;
   #5#36 = #camaasil#20;
   #5#37 = #camaasil#22;
   #5#38 = #camaasil#23;
   #5#39 = #camaasil#24;
   #5#40 = #camaasil#25;
   #5#41 = #camaasil#26;
   #5#42 = #camaasil#27;
   #5#43 = #camaasil#29;
   #5#44 = #camaasil#1;
   #5#45 = #camaasil#18;
   |HAZ BuscaContra;
   #5#48 = aContrapartida;
   #5#49 = aNomContra;
   #5#50 = aCta08;
   #5#51 = aCta90;
   #5#52 = nSwAper;

   |SI #camaasil#1 ] #0#2;|Y #camaasil#1 [ #0#3;
       hay_alguno = 1;
   |FINSI;

   |SI #camaasil#1 [ #0#3;              || fecha dentro del limite hasta

      |SI #camaasil#1 ] #0#2;
          |SI FEstado = 0;
              |GRABA 020#5a;
          |SINO;
             |GRABA 020#5n;
          |FINSI;
          linea = linea + 1;
      |SINO;
          |SI #5#11 = "D"; nDeb1 = nDeb1 + #1#9; |FINSI;
          |SI #5#11 = "H"; nHab1 = nHab1 + #1#9; |FINSI;
      |FINSI;

   |FINSI;
   |LIBERA #5;

   |SI #0#9 > 2;
      #caextrp7#0 = #caextrp5#0;
      |LEE 000#caextrp7.=;
      |SI FSalida ! 0;
         |DDEFECTO #caextrp7;
         #caextrp7#0 = #caextrp5#0;
         |GRABA 020#caextrp7.c;
      |FINSI;
      aAlfa = "|NC"; aAlfa = #caextrp7#aAlfa#; nCalc = aAlfa;
      |PARA nCont = 1; |SI nCont < nCalc; |HACIENDO nCont = nCont + 1;
         #caextrp7#nCont# = #caextrp5#nCont#;
      |SIGUE;
      |GRABA 020#caextrp7.a;
   |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE caextrp01;
   #1#3;
   0, 6, 21;
   aCtaSe, fe1, 000000, 0000, #0#10, #0#5, #0#7;
   aCtaSe, fe2, 999999, 9999, #0#11, #0#6, #0#8;
   ;
   NULL, NULL, NULL, NULL, NULL, buclepan_esp;
   #1#1,#1#0,#1#2,#1#3;
|FIN;

|PROCESO HazTodo;

   |HAZ ParaApertura;

   |SI enEjercicio ] 2008;
       aCtaSe = aCta08;
   |SINO;
       aCtaSe = aCta90;
   |FINSI;

   |ABRE #31;
   |ABRE #11;
   |ABRE #3;
   |SI #0#9 = 1;
      |ABRE #4;
      |BUCLE caextrp00;
      |CIERRA #4;
   |SINO;
      |ABRE #5; |ABRE #7;
      |BUCLE caextrp01;
      |CIERRA #5; |CIERRA #7;
   |FINSI;
   |CIERRA #3;
   |CIERRA #11;
   |CIERRA #31;
|FPRC;
||**************************************************************

|RUTINA min;
   #4#0  = 1;
   #4#8  = #0#2;
   #4#18 = #0#10;
   #4#9  = 000000;
   #4#19 = 0001;
   #4#23 = 00001;
|FRUT;

|RUTINA max;
   #4#0 = 999999;
   #4#8  = #0#3;
   #4#18 = #0#11;
   #4#9  = 999999;
   #4#19 = 9999;
   #4#23 = 99999;
|FRUT;

|PROCESO min1;
   #5#0 = 1;
   #5#8  = #0#2;
   #5#18 = #0#10;
   #5#9  = 000000;
   #5#19 = 0000;
   #5#23 = 00001;
|FPRC;

|PROCESO max1;
   #5#0 = 999999;
   #5#8  = #0#3;
   #5#18 = #0#11;
   #5#9  = 999999;
   #5#19 = 9999;
   #5#23 = 99999;
|FPRC;

|PROCESO min2;
   #7#0 = 1;
   #7#8  = #0#2;
   #7#18 = #0#10;
   #7#9  = 000000;
   #7#19 = 0000;
   #7#23 = 00001;
|FPRC;

|PROCESO max2;
   #7#0 = 999999;
   #7#8  = #0#3;
   #7#18 = #0#11;
   #7#9  = 999999;
   #7#19 = 9999;
   #7#23 = 99999;
|FPRC;

|PROCESO CamCuenta;
   aPath08 = "";
   |SI enEjercicio = 2008;
       aPath08 = eaFEmp;
   |SINO;
       |ABRE #30;
       |SELECT #4#30;
       #30#2  = enEmpresa;
       #30#26 = 8;
       |LEE 001#30=;
       |SI FSalida = 0;
           aAlfa1 = #30#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
           aAlfa2 = #30#3; |QBF aAlfa2; aAlfa2 = ("0"     + aAlfa2) % -101;
           |DFICB aPath08;
           aPath08 = aPath08 + aAlfa1 + aAlfa2 + "/";
       |FINSI;
       |SELECT #1#30;
       |CIERRA #30;
   |FINSI;

   |SI aPath08 ! "";
       |PATH_DAT #403 aPath08;
       |ABRE #403;
       |DDEFECTO #403;
       |SI enBEjer ] 2008;
           |SELECT #2#403;
           #403#2 = #0#0;
           |LEE 041#403];
           |SI FSalida = 0; |Y #403#2 = #0#0;
               aCta08 = #403#2;
               aCta90 = #403#0;
           |FINSI;
           |SELECT #1#403;
       |SINO;
           #403#0 = #0#0;
           |LEE 041#403=;
           |SI FSalida = 0;
               aCta08 = #403#2;
               aCta90 = #403#0;
           |FINSI;
       |FINSI;
       |CIERRA #403;
   |FINSI;

|FPRC;

|PROCESO ModiPantalla;
   |SI eaSubde = "N";
        |C_A #5#10, 1, 29;
        |C_P #5#10, 1, 1126;
        |C_V #5#21, 1, "N";
        |PINTA 0929, "Ä";
        |ATRI R; |PINTA 1026, "Descripcion               "; |ATRI 0;
        |PINTA 1129, " ";
        |PINTA 1229, " ";
        |PINTA 1329, " ";
        |PINTA 1429, " ";
        |PINTA 1529, " ";
        |PINTA 1629, " ";
        |PINTA 1729, " ";
        |PINTA 1829, " ";
        |PINTA 1929, " ";
        |PINTA 2029, "Ä";
   |SINO;
        |SI enSubde = 1; |Y eaDepar = "N";
            |C_A #5#10, 1, 28;
            |C_P #5#21, 1, 1123;
            |C_P #5#10, 1, 1127;
            |C_V #5#20, 1, "N";
            |PINTA 0923, "ÄÄÄÂÄÄÄ";
            |PINTA 1026, "³";
            |ATRI R; |PINTA 1023, "Sdp";
                     |PINTA 1027, "Descripcion               "; |ATRI 0;
            |PINTA 1125, " ³   ³";
            |PINTA 1225, " ³   ³";
            |PINTA 1325, " ³   ³";
            |PINTA 1425, " ³   ³";
            |PINTA 1525, " ³   ³";
            |PINTA 1625, " ³   ³";
            |PINTA 1725, " ³   ³";
            |PINTA 1825, " ³   ³";
            |PINTA 1925, " ³   ³";
            |PINTA 2025, "ÄÁÄÄÄÁ";
        |FINSI;
   |FINSI;
|FPRC;

|PROCESO ParaExtracto;
   #0#17 = "";
   |ABRE #13;
   #13#23 = "C";
   #13#10 = #0#0;
   |LEE 041#13=;
   |SI FSalida = 0;
       #0#17 = #13#9;
   |SINO;
       #13#23 = "P";
       #13#10 = #0#0;
       |LEE 041#13=;
       |SI FSalida = 0;
           #0#17 = #13#9;
       |FINSI;
   |FINSI;
   |CIERRA #13;

   |SI #0#12 ="N";
        fe1 = #0#2;
        fe2 = #0#3;
    |SINO;
        |SI #0#15 = "S";
            alfa1 = #0#2;
            alfa1 = alfa1 % -104;
            alfa2 = dig1; alfa2 = ("00" + alfa2) % -102;
            alfa3 = "01.01." + alfa1;
            fe1   = alfa3;
            fe2   = #0#3;
        |SINO;
            fe1 = fec1;
            fe2 = #0#3;
        |FINSI;
    |FINSI;

    aCta08 = #0#0;
    aCta90 = #0#0;
    |SI #0#15 = "S";
        |HAZ CamCuenta;
    |FINSI;

    linea = 1;
    nDeb1 = 0;   || la suma del debe y haber para arrastrar el saldo
    nHab1 = 0;   || cuando calculamos el anterior.
    hay_alguno = 0;

    |SI #0#9 = 1;
        alfa1 = ("4o" + Usuario);
        |NOME_DAT #4 alfa1;
        |DELINDEX #4;
    |SINO;
        alfa1 = ("5o" + Usuario);
        |NOME_DAT #5 alfa1;
        |DELINDEX #5;
        |SI #0#9 > 2;
           alfa1 = ("7o" + Usuario);
           |NOME_DAT #7 alfa1;
           |DELINDEX #7;
        |FINSI;
    |FINSI;
    aFitxer = alfa1;

    |SI swVarios = 1;
        |HAZ MultiEjercicio;
    |SINO;
        |DFICE dirfich0;
        |HAZ HazTodo;
    |FINSI;

    |HAZ EstaMoneda;
    |SI #0#12 = "N"; |Y swVarios = 0;
        d_abajo = #cacuenta#51;
        h_abajo = #cacuenta#52;
        s_abajo = #cacuenta#53;
    |FINSI;

    |SI nSwDsPreven = 1;
       |SI swVarios ! 0; |HAZ Ordena5; |FINSI;

       |DBASS aAlfa3; |QBF aAlfa3;
       |SI efDFecha = "00.00.0000"; |Y efHFecha = "00.00.0000"; || No es el modulo de Luxegas de Contagen
          ||aAlfa3 = aAlfa3 + "dspreven/fich/" + (("00000" + #48#2) % -105) + "/";
          aAlfa3 = aAlfa3 + "dspreven/fich/";
          |DFICE aAlfa4; |QBF aAlfa4;

          aFichOri = aAlfa4 + "5o" + Usuario + ".dat";
          aFichDes = aAlfa3 + "5o" + Usuario + ".dat";
          |COPIA_FICHERO aFichOri, aFichDes;

          aFichOri = aAlfa4 + "5o" + Usuario + ".ddx";
          aFichDes = aAlfa3 + "5o" + Usuario + ".ddx";
          |COPIA_FICHERO aFichOri, aFichDes;

          aFichOri = aAlfa4 + "5o" + Usuario + ".ixx";
          aFichDes = aAlfa3 + "5o" + Usuario + ".ixx";
          |COPIA_FICHERO aFichOri, aFichDes;


          |CIERRA #5; |DELINDEX #5;
       |SINO;                    || Es el modulo de Luxegas de Contagen
          |CIERRA #5;
       |FINSI;

       |ACABA;
    |FINSI;

    |SI hay_alguno = 0;
        |SI eaEspTabla ! "S";
            |MENAV "    Seleccion vacia ...";
        |FINSI;
    |SINO;
        enInkey = 0;
        enEmpresaPINET = enEmpresa;
        |HAZ RestriccionPINET;
        |SI #0#9 = 1;
            |HAZ PonBtnTagloma;
            |SI swVarios = 0;
                |ENTLINEAL #1#4, -1, 4, 19, 1, min, max;
            |SINO;
                |HAZ Ordena4;
                |ENTLINEAL #2#4, -6, 4, 19, 1, min, max;
            |FINSI;
            |CIERRA #4;
            |DELINDEX #4;
            |HAZ QuitaBtnTagloma;
        |SINO;
            |SI #0#9 = 2;
               |HAZ PonBtnTagloma;
               |SI swVarios = 0;
                   |PINPA #0#5; |HAZ ModiPantalla;
                   |ENTLINEAL #1#5, -1, 4, 19, 0, min1, max1;
               |SINO;
                   |HAZ Ordena5;
                   |PINPA #0#5; |HAZ ModiPantalla;
                   |ENTLINEAL #2#5, -6, 4, 19, 0, min1, max1;
               |FINSI;
               |CIERRA #5;
               |DELINDEX #5;
               |HAZ QuitaBtnTagloma;
            |SINO;
               |SI swVarios = 0;
                   |ENTLINEAL #1#7, -1, 4, 19, 1, min2, max2;
               |SINO;
                   |HAZ Ordena7;
                   |ENTLINEAL #2#7, -6, 4, 19, 1, min2, max2;
               |FINSI;
               |CIERRA #7; |DELINDEX #7;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

_____________________________________________________________________________
|PROGRAMA;
   nSwDsPreven = 0;
   |SI runnom = "dspreven";
      eaMonOrg = "E";
      nSwDsPreven = 1;
      runnom = "caextrax";
      |SI efDFecha ! "00.00.0000"; |O efHFecha ! "00.00.0000"; || Modulo de Luxegas de Contagen
         espe1 = efDFecha;
         espe2 = efHFecha;
      |SINO;
         espe1 = "01.01.0000";
         espe2 = "31.12.9999";
      |FINSI;
      espe3 = 0;
      espe4 = 999;
      espe5 = "  ";
      espe6 = "zz";
      espe7 = 2;
      espe8 = 00;
      espe9 = 99;
      espe10 = "   ";
      espe11 = "zzz";
      espe15 = "S";
      sino   = "S";
   |FINSI;

   |HAZ DirAplicSt;
   enDesAna = 0;

   |SI runnom = "caycosy0"; |Y dirfich0 ! "";
       |PATH_DAT #1 dirfich0;
       |PATH_DAT #3 dirfich0;
       |PATH_DAT #11 dirfich0;
       |PATH_DAT #13 dirfich0;
       |PATH_DAT #31 dirfich0;
       |PATH_DAT #8   dirfich0;
       |PATH_DAT #404 dirfich0;
       eaFEmp = dirfich0;
   |SINO;
       |DFICE eaFEmp;
       |PATH_DAT #3 eaFEmp;
       |PATH_DAT #11 eaFEmp;
       |PATH_DAT #13 eaFEmp;
       |PATH_DAT #31 eaFEmp;
       |PATH_DAT #8 eaFEmp;
       |PATH_DAT #404 eaFEmp;
   |FINSI;

   |ABRE #0;
   |DDEFECTO #0;
   |LEE 041#0p;
   |CIERRA #0;

   #0#0 = ext1;
   |ABRE #3;
   #3#0 = #0#0;
   |LEE 001#3=;
   |SI FSalida ! 0;  |CIERRA #3;  |ACABA;   |FINSI;
   |CIERRA #3;


   |SI runnom ! "caycosy0";
       enNoBloq = 1;
       |HAZ inicio;
       enNoBloq = 0;
   |FINSI;
   |SI runnom ! "caextrax";
       #0#2 = fec1;
       #0#3 = fec2;
       #0#15 = "N";
       #0#16 = 00;
       eaMonOrg = eaMoneda;
   |SINO;
       #0#2 = espe1;
       #0#3 = espe2;
       #0#5 = espe3;
       #0#6 = espe4;
       #0#7 = espe5;
       #0#8 = espe6;
       #0#9 = espe7;
       #0#10 = espe8;
       #0#11 = espe9;
       #0#12 = sino;
       #0#13 = espe10;
       #0#14 = espe11;
       #0#15 = espe15;
       #0#16 = espe16;
   |FINSI;
   #0#4 = #3#2;

   |BLIN 4;

   |SI runnom ! "caextrax"; |Y runnom ! "caycosy0";
       |PINPA #0#0;
       |PINDA #0#0;
       |ENDATOS #1#0;
   |SINO;
       FSalida = 0;
   |FINSI;

   |SI FSalida = 0;
       |SI #0#9 = 3;
           ext1  = #0#0;
           ext2  = #0#4;
           espe1 = #0#2;
           espe2 = #0#3;
           espe3 = #0#5;
           espe4 = #0#6;
           espe5 = #0#7;
           espe6 = #0#8;
           espe7 = #0#9;
           espe8 = #0#10;
           espe9 = #0#11;
           sino  = #0#12;
           espe10 = #0#13;
           espe11 = #0#14;
           espe15 = #0#15;
           espe16 = #0#16;
           |SUB_EJECUTA_NP "caextraz;NOMEQUITESQUETECORTOLOSGUEVOS";
       |SINO;
           swVarios = 0;
           |SI #0#15 = "S"; |O #0#16 ! 0;
               swVarios = 1;
           |FINSI;
           enBEjer = enEjercicio;
           |HAZ ParaExtracto;
       |FINSI;
   |FINSI;

   espe7 = #0#9;
   |ABRE #0;
   |DDEFECTO #0;
   #0#18 = "A";
   |LEE 041#0=;
   |SI FSalida ! 0;
       |DDEFECTO #0;
       #0#18 = "A";
       #0#9 = espe7;
       |GRABA 020#0n;
   |SINO;
       |DDEFECTO #0;
       #0#18 = "A";
       #0#9 = espe7;
       |GRABA 020#0a;
   |FINSI;
   |CIERRA #0;

   |PULSATECLA;
   swVarios = 0;
|FPRO;

|| ***********************************************************************
|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |SI #0#2 > #caselem1#5; |O #0#3 < #caselem1#4;
       |ACABA;  || Fuera de la seleccion
   |FINSI;
   |SI #0#12 = "S";
       fe1 = fec1;
       fe2 = #0#3;
   |FINSI;
   |PATH_DAT #1 dirfich0;
   |PATH_DAT #3 dirfich0;
   |PATH_DAT #11 dirfich0;
   |PATH_DAT #31 dirfich0;
   |PATH_DAT #8 dirfich0;
   |PATH_DAT #404 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
  #caselem1#1;
  ;
  000001;
  999999;
  ;
  NULL,MultiEmp1;
|FIN;

|PROCESO MultiEjercicio;
   eSwMul = 1;
   espe15 = #0#15;
   espe16 = #0#16;

   |SUB_EJECUTA "caselemp";
   |NOME_DAT #998 eaFichsel;

   |BUCLE MultiEmp0;
   |DELINDEX #998;
|FPRC;

|| ***************** Proceso Ordenaciones

|PROCESO Ordenar4;
   nDebe  = nDebe + #4#12;
   nHaber = nHaber + #4#17;
   #4#5 = nDebe;
   #4#6 = nHaber;
   #4#7 = nDebe - nHaber;
   #4#13  = nDebe - nHaber;
   #4#14 = d_abajo;
   #4#15 = h_abajo;
   #4#16 = s_abajo;
   |GRABA 020#4a;
|FPRC;

|DEFBUCLE Ordenar4;
 #4#2;
 ;
 #0#2, #0#10, 000000, 0000, 00001, 000001;
 #0#3, #0#11, 999999, 9999, 99999, 999999;
 ;
 NULL, Ordenar4;
|FIN;

|PROCESO Ordena4;
  |C_V #4#23,1,"S";
  nDebe  = nDeb1;
  nHaber = nHab1;
  |BUCLE Ordenar4;
|FPRC;

|PROCESO Ordenar5;
   |SI #5#11 = "D";
       nDebe  = nDebe + #5#12;
   |SINO;
       nHaber = nHaber + #5#12;
   |FINSI;
   #5#5  = nDebe;
   #5#6  = nHaber;
   #5#7  = nDebe - nHaber;
   #5#13 = nDebe - nHaber;
   #5#14 = d_abajo;
   #5#15 = h_abajo;
   #5#16 = s_abajo;
   |GRABA 020#5a;
|FPRC;

|DEFBUCLE Ordenar5;
 #5#2;
 ;
 #0#2, #0#10, 000000, 0000, 00001, 000001;
 #0#3, #0#11, 999999, 9999, 99999, 999999;
 ;
 NULL, Ordenar5;
|FIN;

|PROCESO Ordena5;
  nDebe  = nDeb1;
  nHaber = nHab1;
  |C_V #5#23,1,"S";
  |C_V #5#27,1,"S";
  |BUCLE Ordenar5;
|FPRC;

|PROCESO Ordenar7;
   |SI #7#11 = "D";
       nDebe  = nDebe + #7#12;
   |SINO;
       nHaber = nHaber + #7#12;
   |FINSI;
   #7#5  = nDebe;
   #7#6  = nHaber;
   #7#7  = nDebe - nHaber;
   #7#13 = nDebe - nHaber;
   #7#14 = d_abajo;
   #7#15 = h_abajo;
   #7#16 = s_abajo;
   |GRABA 020#7a;
|FPRC;

|DEFBUCLE Ordenar7;
 #7#2;
 ;
 #0#2, #0#10, 000000, 0000, 00001, 000001;
 #0#3, #0#11, 999999, 9999, 99999, 999999;
 ;
 NULL, Ordenar7;
|FIN;

|PROCESO Ordena7;
  nDebe  = nDeb1;
  nHaber = nHab1;
  |C_V #7#23,1,"S";
  |C_V #7#27,1,"S";
  |BUCLE Ordenar7;
|FPRC;

|PROCESO LoCambio;
     |HAZ EstaMoneda;

     impMoneda= #camaasil#9;
     |SI eaMoneda = "P";                  || pesetas
         mulMoneda = 1 / 166.386;
     |FINSI;
     |SI eaMoneda = "E";                  || euros
         mulMoneda = 166.386;
     |FINSI;
     impMoneda = (impMoneda * mulMoneda) ! EURODB;
     #camaasil#9 = impMoneda;
|FPRC;

|PROCESO EstaMoneda;
     |SI eaMonOrg = "P";                  || pesetas
         EURO = 1 / 166.386;
         EURODB = 0;
         EURODV = 2;
     |SINO;
         EURO = 166.386;
         EURODB = 2;
         EURODV = 0;
     |FINSI;
|FPRC;

|PROCESO AntesTipo; |TIPO 7;
   |HAZ EsComersan;
   |SI FSalida = 0;
      |CAMPO_MAXIMO #0#9, 1, "4";
      |MENSA "0000(1) Debe,Haber,Saldo; (2) Des.,Importe,Saldo; (3) Det.Asto/Anot.(4) Referencia";
   |SINO;
      |CAMPO_MAXIMO #0#9, 1, "3";
      |MENSA "    (1) Debe,Haber y Saldo; (2) Descripcion,Importe y Saldo, (3) Detalle Asto/Anot";
   |FINSI;
|FPRC;

|PROCESO TrasTipo;
   |BLIN 4;
|FPRC;

|PROCESO PonBtnTagloma;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0901, 0909, BtnItemDoc;
          enBtnItemDoc = FSalida;
     |FINSI;
|FPRC;

|PROCESO QuitaBtnTagloma;
      |SI enBtnItemDoc ! -1;
          |FIN_CONTROL_WINDOWS enBtnItemDoc;
          enBtnItemDoc = -1;
      |FINSI;
|FPRC;

|PROCESO BtnItemDoc;
     |SI #0#9 = 1;
          aAlfa = (("00"+#04#18)%-102)+ #04#8 + (("000000"+#04#9)%-106)+(("0000"+#04#19)%-104);
     |SINO;
          aAlfa = (("00"+#05#18)%-102)+ #05#8 + (("000000"+#05#9)%-106)+(("0000"+#05#19)%-104);
     |FINSI;
     aAlfa = "tagz0001;ASI" + aAlfa;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;
