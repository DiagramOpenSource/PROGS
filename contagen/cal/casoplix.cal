|FICHEROS;
     casoplib #0;
     cauxinva #2;

     caconimp #8;
     casoplim #11,MANTE;

     :/basica/def/agim0019 #500;     || registro sociedades
     :/basica/def/agim0026 #502;     || cargos sociedades
     :/basica/def/agim0024 #504;     || Representantes
     :/basica/def/agicen15 #515;     || Representante
     :/basica/def/agifigen #118;

     :/integral/def/dsam0005 #205;   || Domicilios
     caselem1 #998;

     fichero@ #900;
|FIN;

|VARIABLES;
     nInkey = 0;
     aReser      = "";
     aPath       = "";
     aPathContas = "";
     nSalir      = 0;
     aSistema    = "";
     aOrigen     = "";
     aDestino    = "";
     EstadoAnt   = "";
     Comodin     = "";
     Comodin1    = "";
     Comodin2    = "";
     Comodin3    = "";
     NombreTotal = "";
     Nombre      = "";
     aApell1     = "";
     aApell2     = "";
     aLong       = "";
     Directorio  = "";
     Dia         = "";
     anyo        = "";
     Cuenta      = "";
     aDia        = "";
     aMes        = "";
     aAnyo       = "";
     ComFecha    = "";
     Caracter    = "";
     aNumer      = "";
     aAlfa       = "";
     aImpre      = "";
     aMasNombre  = "";
     aApertura   = "";
     aSaldoCero  = "";
     aBorro      = "";
     aVerDatos   = "";

     Local       = 0;
     ModoEntrada = 0;
     nLong       = 0;
     nParte1     = 0;
     nParte2     = 0;
     Handle      = 0;
     Calc        = 0;
     Linea       = 1;
     Cuentador   = 0;
     nCont       = 0;
     NumFecha    = 0;
     Ejercicio   = 0;
     Numeracion  = 0;
     Empre1      = 0;

     Fecha       = @;

     nBoton01    = 0;
     nBoton02    = 0;
     nBoton03    = 0;
     nBoton04    = 0;
     nBoton05    = 0;
     nBoton06    = 0;
     nBoton07    = 0;
     nBoton08    = 0;
     nBoton09    = 0;
     nBoton10    = 0;
     nBoton11    = 0;
     nBoton12    = 0;
     nBoton13    = 0;
     nBoton14    = 0;
     nBoton15    = 0;
     nBoton16    = 0;

     nDejaSI = 0;
     nClau1 = 0;
     nClau2 = 0;
     aAlfa0 = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aAlfa6 = "";

     &eaAlfa     = "";
     nNume1      = 0;
     nSecretario = 0;
     nSociedad   = 0;
     nDSocial    = 0;

     nNoborro = 0;
     nVerDat  = 0;

     &aMemoria   = "";
     &eaMemSoc   = "";
     &eaFormato  = "";
     &efFecLeg   = @;
     &eaDatLeg   = "";
     &eaPathLeg  = "";
     &eaUnidadBasico = "";
     &eaUnidadBTmp   = "";
     &eaCtasLeg   = "";
     &enCtasLeg   = 0;
     aEstado      = "";
     nNumLibros   = 0;
     nError       = 0;
     &eaDirGuarda = "";
     &eaOrigen    = "";
     &eaDestino   = "";
     aDef         = "";
     nErrorSec    = 0;
     nBueno       = 0;
     nSw15        = 0;
     nSwBal       = 0;
|FIN;

|INCLUYE dscont_i;

|| ____________________ DIARIO

|PROCESO Diario;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;

     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;
     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;

     |SUB_EJECUTA_NP "cadiario.tab;LEGALIA";
|FPRC;

|DEFBUCLE Diario;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Diario;
|FIN;

|PROCESO Proceso01;
     |HAZ EscondeBotones;
     |ABRE #48;
     |BUCLE Diario;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;


|| ____________________ INVENTARIO

|PROCESO CopiaLaMemoria;
  eaDirGuarda  = aPContas + "emisiones";
  eaDirGuarda  = eaDirGuarda + "/" + eaLegEmp;
  aAlfa        = enEjercicio;
  eaDirGuarda  = eaDirGuarda + "/" + aAlfa;
  eaDirGuarda  = eaDirGuarda + "/";
  eaOrigen     = eaDirGuarda + "wmemori.doc";   ||recojo la Memoria

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
   Comodin1 = Comodin1 + "MEMORIA_*.doc";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1  = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
  Comodin1  = Comodin1 + "MEMORIA_" + (("000" + Numeracion) % -103) + ".doc";
  eaDestino = Comodin1;

  |COPIA_FICHERO eaOrigen, eaDestino;
|FPRC;

|PROCESO CopiaGestion;
  eaDirGuarda  = aPContas + "emisiones";
  eaDirGuarda  = eaDirGuarda + "/" + eaLegEmp;
  aAlfa        = enEjercicio;
  eaDirGuarda  = eaDirGuarda + "/" + aAlfa;
  eaDirGuarda  = eaDirGuarda + "/";
  eaOrigen     = eaDirGuarda + "wgestio.doc";   ||recojo la Memoria

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
   Comodin1 = Comodin1 + "GESTION_*.doc";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1  = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
  Comodin1  = Comodin1 + "GESTION_" + (("000" + Numeracion) % -103) + ".doc";
  eaDestino = Comodin1;

  |COPIA_FICHERO eaOrigen, eaDestino;
|FPRC;

|PROCESO MemoriaNueva;
    |SI HaySociedad = 0;  |ACABA; |FINSI;

    aDef = aPContas + "def/zregdocu";
    |CARGA_DEF aDef, fichero@;
    |SI FSalida ! 0;
         |MENAV "    Error al Carga fichero de Registro Documentos";
         |ACABA;
    |FINSI;

    aPathContas = aPContas + "fich/";
    |PATH_DAT #900 aPathContas;

    |ABRE #900;
    #900#0 = eaLegEmp;
    #900#1 = enEjercicio;
    |LEE 001#900=;
    |SI FSalida ! 0;
        |MENAV "    No existe Registro de Documentos de la Empresa";
    |SINO;
        |SI #900#4 = "N";
            |MENAV "    No esta creada la Memoria de la Empresa";
        |SINO;
            |HAZ CopiaLaMemoria;
        |FINSI;
        |SI enEjercicio ] 2010;
            |SI #900#8 = "N";
                |MENAV "    No esta creado el Informe de Gestion";
            |SINO;
                |HAZ CopiaGestion;
            |FINSI;
        |FINSI;
    |FINSI;
    |CIERRA #900;
    |DESCARGA_DEF #900;
|FPRC;

|PROCESO ComInventario;
  nSwBal = 0;
  |DFICB Comodin; |QBF Comodin;
  Comodin = Comodin  + ((("00000" + #caselem1#1) % -105) + #caselem1#2) + "/";
  |PATH_DAT #2 Comodin;
  |ABRE #2;
  |LEE 041#2p;
  |SI FSalida = 0;
      nSwBal = 1;
  |FINSI;
  |CIERRA #2;
|FPRC;

|PROCESO Inventario;
    #48#2 = #caselem1#1;
    #48#3 = #caselem1#2;
    |LEE 000#48=;

    |SI #48#26 > 80;
        enEjercicio = #48#26 + 1900;
    |SINO;
        enEjercicio = #48#26 + 2000;
    |FINSI;

    Comodin = "Procesando " + #48#1;
    |ATRI I; |PINTA 2110, Comodin; |ATRI N;

    |SI eaFormato = "S";

        |HAZ InvNuevo;

    |SINO;
         |HAZ CopiaNuevo;

         eaLegEmp = ("00000" + #caselem1#1) % -105;
         eaLegPer = #caselem1#2;

         |HAZ ComInventario;
         |SI nSwBal = 0;
             |SUB_EJECUTA_NP "cainvaux.tab;LEGALIA";
         |SINO;
             |SUB_EJECUTA_NP "cauxinva.tab;LEGALIA";
         |FINSI;

         |SI aMemoria = "S";
             |SI enEjercicio < 2008;
                 aReser = eaMoneda;
                 |SI aReser = "E";
                     eaMoneda = "EUROS  ";
                 |SINO;
                     eaMoneda = "PESETAS";
                 |FINSI;
                 Comodin = ":contasoc/memoria1.tab;" + #caselem1#1; |SUB_EJECUTA_NP Comodin;
                 eaMoneda = aReser;
             |SINO;
                 |HAZ MemoriaNueva;
             |FINSI;
         |FINSI;

         |SI enEjercicio < 2008;
             |SUB_EJECUTA_NP "cabatodo.tab;0,12,C";   |PULSATECLA;
             |SUB_EJECUTA_NP "cabatodo.tab;0,12";     |PULSATECLA;
         |SINO;
             |SI enEjercicio > 2008;
                 |SUB_EJECUTA_NP "ca8yf001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yc001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yp001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ye001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ys001.tab;0,12,C";     |PULSATECLA;
             |SINO;
                 |SUB_EJECUTA_NP "ca8yf001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yc001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yp001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ye001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ys001.tab;0,12";       |PULSATECLA;
             |FINSI;
         |FINSI;

         |SI aApertura = "N";
             Comodin = "caycosy0.tab;1,12," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;1,9," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;1,6," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;1,3," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
         |SINO;
             Comodin = "caycosy0.tab;0,12," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;0,9," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;0,6," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;0,3," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
         |FINSI;
         Comodin = "caycosy0.tab;0,0," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;

         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
         Comodin1 = Comodin1 + "INV_CUEN_*.xls";
         Numeracion = 1;
         |_PDIR Comodin1;
         |PARA; |SI FSalida = 0; |HACIENDO;
                Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
                Numeracion = Comodin; Numeracion = Numeracion + 1;
                |_SDIR Comodin1;
         |SIGUE;

         Comodin = eaUnidadBTmp + "/tmp1.xls";
         |XCIERRA Handle;
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "PresLibr/";
         |MKDIR Comodin1;
         Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
          |MKDIR Comodin1;
          Comodin1 = Comodin1 + "INV_CUEN_" + (("000" + Numeracion) % -103) + ".xls";
          aAlfa = "";
          |IP_REMOTO aAlfa; |QBF aAlfa;
          |SI aAlfa ! "";
               |RECIBE_FICHERO Comodin, Comodin1;
          |SINO;
               |COPIA_FICHERO Comodin, Comodin1;
          |FINSI;
    |FINSI;
|FPRC;

|PROCESO InvNuevo;

    eaLegEmp = ("00000" + #caselem1#1) % -105;
    eaLegPer = #caselem1#2;
    |SI aApertura = "N";
        Comodin = "ca8ytodo.tab;1,12,C," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
    |SINO;
        Comodin = "ca8ytodo.tab;0,12,C," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
    |FINSI;
|FPRC;

|DEFBUCLE Inventario;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Inventario;
|FIN;

|PROCESO Proceso02;
     |HAZ EscondeBotones;
     |ABRE #48;
     |BUCLE Inventario;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ********************************************************************
|| ____________________ MAYOR

|PROCESO Mayor;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;

     |SUB_EJECUTA_NP "camaydia.tab;LEGALIA";
|FPRC;

|DEFBUCLE Mayor;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Mayor;
|FIN;

|PROCESO Proceso07;
     |HAZ EscondeBotones;
     |ABRE #48;
     |BUCLE Mayor;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ Facturas Emitidas
|PROCESO Emitidas;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;

     |SUB_EJECUTA_NP ":modelos/dsmoy008;LEGALIA";
|FPRC;

|DEFBUCLE Emitidas;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Emitidas;
|FIN;

|PROCESO Proceso10;
     |HAZ EscondeBotones;
     |ABRE #48;
     |BUCLE Emitidas;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;


|| ____________________ Facturas Emitidas

|PROCESO Recibidas;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;

     |SUB_EJECUTA_NP ":modelos/dsmoy009;LEGALIA";
|FPRC;

|DEFBUCLE Recibidas;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Recibidas;
|FIN;

|PROCESO Proceso11;
     |HAZ EscondeBotones;
     |ABRE #48;
     |BUCLE Recibidas;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ Bienes de Invercturas Emitidas
|PROCESO Bienes;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;

     |SUB_EJECUTA_NP ":modelos/dsmoy066;LEGALIA";
|FPRC;

|DEFBUCLE Bienes;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Bienes;
|FIN;

|PROCESO Proceso12;
     |HAZ EscondeBotones;
     |ABRE #48;
     |BUCLE Bienes;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ CREACION DE FICHEROS
|PROCESO PongoNombre;
 #48#2 = #caselem1#1;
 #48#3 = #caselem1#2;
 |LEE 000#48=;
 eaAlfa = #48#1; |QBF eaAlfa;
 |HAZ QuitaRaros_D;
|FPRC;

|PROCESO PasaFicheros;
     |DBASE aOrigen; |QBF aOrigen;
     aOrigen = aOrigen + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/*.*";
     Comodin = aOrigen - "*.*";
     |_PDIR aOrigen;
     |PARA; |SI FSalida = 0; |HACIENDO;

            |SI aMasNombre ! "S";
                aDestino = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2) + "/";
            |SINO;
                aDestino = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2);
                |HAZ PongoNombre;
                aDestino = aDestino + eaAlfa + "/";
            |FINSI;

            |RMKDIR aDestino;
            aDestino = aDestino + (aOrigen - Comodin);
            |SI Local = 0;
                |ENVIA_FICHERO aOrigen, aDestino;
            |SINO;
                |COPIA_FICHERO aOrigen, aDestino;
            |FINSI;
            |FBORRA aOrigen;
            |_SDIR aOrigen;
     |SIGUE;
     |RMDIR Comodin;
|FPRC;

|DEFBUCLE PasaFicheros;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PasaFicheros;
|FIN;

|PROCESO Fecha;
     |SI aMes = "Ultimo"; |O aMes = "Tercero"; |O aMes = "Sexto";|O aMes = "Noveno";
          |SI #48#12 ! 12;
               Calc = aAnyo; Calc = Calc + 1; aAnyo = ("00" + Calc) % -102;
          |FINSI;
     |FINSI;
     |SI aAnyo ] "80";
          aAnyo = "19" + aAnyo;
     |SINO;
          aAnyo = "20" + aAnyo;
     |FINSI;
     |SI aMes = "Primero"; aMes = ("00" + #48#11) % -102; |FINSI;
     |SI aMes = "Tercero"; aMes = ("00" + (#48#11+3)) % -102; |FINSI;
     |SI aMes = "Sexto";   aMes = ("00" + (#48#11+6)) % -102; |FINSI;
     |SI aMes = "Noveno";  aMes = ("00" + (#48#11+9)) % -102; |FINSI;
     |SI aMes = "Ultimo";  aMes = ("00" + #48#12) % -102; |FINSI;
     |SI aDia = "Primero"; aDia = "01"; |FINSI;
     |SI aDia = "Ultimo";
          |SI aMes = "02";
               |SI aAnyo = "80"; |O aAnyo = "84"; |O aAnyo = "88"; |O aAnyo = "92";
                |O aAnyo = "96"; |O aAnyo = "04"; |O aAnyo = "08"; |O aAnyo = "12";
                |O aAnyo = "16"; |O aAnyo = "20"; |O aAnyo = "24"; |O aAnyo = "28";
                    aDia = "29";
               |SINO;
                    aDia = "28";
               |FINSI;
          |SINO;
               |SI aMes = "01"; |O aMes = "03"; |O aMes = "05"; |O aMes = "07";
                |O aMes = "08"; |O aMes = "10"; |O aMes = "12";
                    aDia = "31";
               |SINO;
                    aDia = "30";
               |FINSI;
          |FINSI;
     |FINSI;
     ComFecha = aDia + "." + aMes + "." + aAnyo;
|FPRC;

|PROCESO SeparaNombre;
     Comodin = NombreTotal; |QBF Comodin;

     Nombre = ""; aApell1 = ""; aApell2 = "";
     Comodin = Comodin - " ";
     |SI FSalida ! 0;
          nParte1 = FSalida;
          Comodin = Comodin - ",";
          |SI FSalida ! 0;
               nParte2 = FSalida + 98;
               Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
               nParte1 = nParte1 + 98;
               aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
               aApell1 = Comodin;
          |SINO;
               Comodin = Comodin - " ";
               |SI FSalida ! 0;
                    nParte2 = FSalida + 98;
                    Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
                    nParte1 = nParte1 + 98;
                    aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
                    aApell1 = Comodin;
               |FINSI;
          |FINSI;
     |FINSI;

     |QBF Nombre; |QBF aApell1; |QBF aApell2;

     |SI Nombre ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = Nombre % 0101;
               |SI Comodin = " "; Nombre = Nombre - " "; |FINSI;
          |SIGUE;
     |FINSI;

     |SI aApell1 ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = aApell1 % 0101;
               |SI Comodin = " "; aApell1 = aApell1 - " "; |FINSI;
          |SIGUE;
     |FINSI;

     |SI aApell2 ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = aApell2 % 0101;
               |SI Comodin = " "; aApell2 = aApell2 - " "; |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO CuentaLibros;
     nNumLibros = 0;
     |DBASE Comodin1; |QBF Comodin1;
     Comodin1 = Comodin1 + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
     Comodin1 = Comodin1 + "*.*";
     |_PDIR Comodin1;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aAlfa1 = Comodin1 % -103;
            |SI eaFormato ! "S";
                |SI aAlfa1 = "xls"; |O aAlfa1 = "doc";
                    nNumLibros = nNumLibros + 1;
                |FINSI;
            |SINO;
                |SI aAlfa1 =  "pdf";
                    nNumLibros = nNumLibros + 1;
                |FINSI;
            |FINSI;
            |_SDIR Comodin1;
     |SIGUE;

     #casoplib#28 = ("000" + nNumLibros) % -103;
|FPRC;

|PROCESO CreaSecuenciales;
     |DBASE Directorio; |QBF Directorio;
     Directorio = Directorio + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";

     Comodin = "wb  " + Directorio + "desc.txt";
     |FABRE Comodin;
     |SI FSalida ] 0;
        Comodin = Handle + " " + #casoplib#2  + &0;  |FGRABA Comodin;
        || Comodin = Handle + " " + #casoplib#2  + &10;  |FGRABA Comodin;
        || Comodin = Handle + " " + #casoplib#2  + &13 + &10;  |FGRABA Comodin;
        FSalida = Handle; |FCIERRA FSalida;
     |FINSI;

     Comodin = "wb  " + Directorio + "nombres.txt";
     |FABRE Comodin;
     |SI FSalida ] 0;
          Handle = FSalida; Nombre = "";
          |DBASE Comodin1; |QBF Comodin1;
          Comodin1 = Comodin1 + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
          Comodin1 = Comodin1 + "*.*";
          |_PDIR Comodin1;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aLong = Comodin1 % 0; nLong = aLong;

               aAlfa1 = Comodin1 % -103;
               nBueno = 0;
               |SI eaFormato ! "S";
                   |SI aAlfa1 = "xls"; |O aAlfa1 = "doc"; nBueno = 1; |FINSI;
               |SINO;
                    |SI aAlfa1 = "pdf";                   nBueno = 1; |FINSI;
               |FINSI;
               |SI nBueno = 1;
                    |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                         Calc = -((nCont * 100) + 1);
                         Caracter = Comodin1 % Calc;
                         |SI Caracter = "/";
                              |SAL;
                         |SINO;
                              Nombre = Caracter + Nombre;
                         |FINSI;
                    |SIGUE;
                    Nombre = Handle + " " + Nombre + &13 + &10; |FGRABA Nombre;
                    Nombre = "";
               |FINSI;

               |_SDIR Comodin1;
          |SIGUE;
          FSalida = Handle;
          |FCIERRA FSalida;
     |SINO;
          aAlfa1 = "0000[" + (Comodin % 5) "] inaccesible.";
          |MENAV aAlfa1;
          nErrorSec = 1;
          |ACABA;
     |FINSI;

     Comodin = "wb  " + Directorio + "datos.txt";
     |FABRE Comodin;
     |SI FSalida ] 0;
          Handle = FSalida;

          Comodin = Handle + " 100" + #casoplib#10 + &13 + &10;  |FGRABA Comodin; || Provincia Presentacion
          Comodin = #casoplib#30; |QBF Comodin;
          Comodin = Comodin - "."; Comodin = Comodin - ".";
          Comodin = Handle + " 101" + Comodin + &13 + &10;       |FGRABA Comodin; || Fecha solicitud
          Comodin = Handle + " 102" + #casoplib#2  + &13 + &10;  |FGRABA Comodin; || Nombre Empresario
          Comodin = Handle + " 103" + #casoplib#5  + &13 + &10;  |FGRABA Comodin; || 1 Apellido Empresario
          Comodin = Handle + " 104" + #casoplib#6  + &13 + &10;  |FGRABA Comodin; || 2 Apellido Empresario
          Comodin = Handle + " 105" + #casoplib#3  + &13 + &10;  |FGRABA Comodin; || NIF Empresario
          Comodin = Handle + " 106" + #casoplib#7  + &13 + &10;  |FGRABA Comodin; || Direccion Empresario
          Comodin = Handle + " 107" + #casoplib#9  + &13 + &10;  |FGRABA Comodin; || Localidad Empresario
          Comodin = Handle + " 108" + #casoplib#8  + &13 + &10;  |FGRABA Comodin; || C.P. Empresario
          Comodin = Handle + " 109" + (#casoplib#8 % 0102) + &13 + &10; |FGRABA Comodin; || Cod.Provincia Empresario
          Comodin = Handle + " 110" + #casoplib#12 + &13 + &10; |FGRABA Comodin; || Fax Empresario
          Comodin = Handle + " 111" + #casoplib#11 + &13 + &10; |FGRABA Comodin; || Telefono Empresario

          Comodin = Handle + " 201" + #casoplib#23 + &13 + &10; |FGRABA Comodin; || N§ Tomo Registro
          Comodin = Handle + " 202" + #casoplib#24 + &13 + &10; |FGRABA Comodin; || N§ Libro Registro
          Comodin = Handle + " 203" + #casoplib#25 + &13 + &10; |FGRABA Comodin; || N§ Seccion Registro
          Comodin = Handle + " 204" + #casoplib#26 + &13 + &10; |FGRABA Comodin; || N§ Folio Registro
          Comodin = Handle + " 205" + #casoplib#27 + &13 + &10; |FGRABA Comodin; || Tipo Registro Publico
          Comodin = Handle + " 206" + #casoplib#31 + &13 + &10; |FGRABA Comodin; || N§ Hoja Registro

          Comodin = Handle + " 301" + #casoplib#14 + &13 + &10; |FGRABA Comodin; || Nombre Representante
          Comodin = Handle + " 302" + #casoplib#15 + &13 + &10; |FGRABA Comodin; || 1 Apellido Representante
          Comodin = Handle + " 303" + #casoplib#16 + &13 + &10; |FGRABA Comodin; || 2 Apellido Representante
          Comodin = Handle + " 304" + #casoplib#13 + &13 + &10; |FGRABA Comodin; || DNI Representante
          Comodin = Handle + " 305" + #casoplib#17 + &13 + &10; |FGRABA Comodin; || Direccion Representante
          Comodin = Handle + " 306" + #casoplib#19 + &13 + &10; |FGRABA Comodin; || Localidad Representante
          Comodin = Handle + " 307" + #casoplib#18 + &13 + &10; |FGRABA Comodin; || C.P. Representante
          Comodin = Handle + " 308" + #casoplib#20 + &13 + &10; |FGRABA Comodin; || Provincia Representante
          Comodin = Handle + " 309" + #casoplib#22 + &13 + &10; |FGRABA Comodin; || Fax Representante
          Comodin = Handle + " 310" + #casoplib#21 + &13 + &10; |FGRABA Comodin; || Telefono Representante

          Comodin = Handle + " 401" + #casoplib#29 + &13 + &10; |FGRABA Comodin; || Solicita Retencion
          Comodin = ("000" + #casoplib#28) % -103;
          Comodin = Handle + " 501" + Comodin + &13 + &10;      |FGRABA Comodin; || Numero libros presentados

          Numeracion = 1;
          |DBASE Comodin1; |QBF Comodin1;
          Comodin1 = Comodin1 + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
          Comodin1 = Comodin1 + "*.*";
          |_PDIR Comodin1;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aLong = Comodin1 % 0; nLong = aLong;

               aAlfa1 = Comodin1 % -103;
               nBueno = 0;
               |SI eaFormato ! "S";
                   |SI aAlfa1 = "xls"; |O aAlfa1 = "doc"; nBueno = 1; |FINSI;
               |SINO;
                   |SI aAlfa1 = "pdf";                    nBueno = 1; |FINSI;
               |FINSI;

               |SI nBueno = 1;

                   |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                        Calc = -((nCont * 100) + 1);
                        Caracter = Comodin1 % Calc;
                        |SI Caracter = "/";
                             |SAL;
                        |SINO;
                             Nombre = Caracter + Nombre;
                        |FINSI;
                   |SIGUE;
                   Comodin3 = Nombre % -107; Nombre = Nombre - Comodin3; Nombre = Nombre > "";
                   Comodin3 = Comodin3 % 0103;
                   aNumer = ("000" + Numeracion) % -103;
                   Numeracion = Numeracion + 1;
                   |SI Nombre = "DIARIO_";
                       Comodin2 = Handle + " " + aNumer + "01Diario                          " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "INV_CUEN_";
                       Comodin2 = Handle + " " + aNumer + "01Inventario y cuentas anuales    " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "BAL_SUMS_";
                       Comodin2 = Handle + " " + aNumer + "01Balance comprob.sumas y saldos  " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "FAC_EMIT_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de facturas emitidas      " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "FAC_RECI_";
                        Comodin2 = Handle + " " + aNumer + "01Libro de facturas recibidas     " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "OTROS_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de Bienes de Inversion con Regularizacion por Prorrata " + &13 + &10; |FGRABA Comodin2;
                  |FINSI;
                  |SI Nombre = "MEMORIA_";
                      Comodin2 = Handle + " " + aNumer + "01Memoria                         " + &13 + &10; |FGRABA Comodin2;
                  |FINSI;
                  |SI Nombre = "GESTION_";
                      Comodin2 = Handle + " " + aNumer + "01Informe de Gestion              " + &13 + &10; |FGRABA Comodin2;
                  |FINSI;

                  Comodin2 = Handle + " " + aNumer + "02" + Comodin3 + &13 + &10; |FGRABA Comodin2;
                  aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
                  |HAZ Fecha;
                  ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                  Comodin2 = Handle + " " + aNumer + "03" + ComFecha + &13 + &10; |FGRABA Comodin2;
                  aDia = "Ultimo"; aMes = "Ultimo"; aAnyo = (("00" + #48#26) % -102);
                  |HAZ Fecha;
                  ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                  Comodin2 = Handle + " " + aNumer + "04" + ComFecha + &13 + &10; |FGRABA Comodin2;
                  aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
                  |HAZ Fecha;
                  Fecha = ComFecha; NumFecha = Fecha; NumFecha = NumFecha - 1; Fecha = NumFecha; ComFecha = Fecha;
                  ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                  Comodin2 = Handle + " " + aNumer + "05" + ComFecha + &13 + &10; |FGRABA Comodin2;
                  Nombre = "";
               |FINSI;
               |_SDIR Comodin1;
          |SIGUE;
           FSalida = Handle; |FCIERRA FSalida;
     |SINO;
          aAlfa1 = "0000[" + (Comodin % 5) "] inaccesible.";
          |MENAV aAlfa1;
          nErrorSec = 1;
     |FINSI;
|FPRC;

|PROCESO LeeSecre;
  nSecretario = 1;
  nClau1 = #agim0026#1;
  nClau2 = #agim0026#2;
|FPRC;

|DEFBUCLE LeeSecretario;
 #agim0026#1;
 16;
 enEmpresa, 01, 01, 03;
 enEmpresa, 99, 99, 03;
 e;
 NULL, LeeSecre;
|FIN;

|PROCESO LeeRepre;
  |SI #agim0024#15 ! "A";
      nSecretario = 1;
      nClau1 = #agim0024#1;
      nClau2 = #agim0024#2;
      |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE LeeRepresentante;
 #agim0024#1;
 ;
 enEmpresa, nSociedad, 01;
 enEmpresa, nSociedad, 99;
 e;
 NULL, LeeRepre;
|FIN;

|PROCESO MiraCabecera;

     enEmpresa = #48#2;

     nSociedad = 0;
     |DDEFECTO #agim0019;
     |ABRE #agim0019;
     #agim0019#0 = enEmpresa;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
          |LEE 000#agim0019.a;
     |SINO;
          |LEE 000#agim0019.u;
     |FINSI;
     |SI FSalida ! 0;|O #agim0019#0 ! enEmpresa;
          |DDEFECTO #agim0019;
          nSociedad = 0;
     |SINO;
          nSociedad = #agim0019#1;
     |FINSI;
     |CIERRA #agim0019;

     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = enEmpresa;
     |LEE 041#agifigen.=;
     |CIERRA #agifigen;

     nSw15 = 0;
     |ABRE #agicen15;
     |DDEFECTO #agicen15;
     #agicen15#0 = enEmpresa;
     |LEE 041#agicen15.=;
     |SI FSalida = 0; nSw15 = 1; |FINSI;
     |CIERRA #agicen15;

     nDSocial = 0;
     |SI HayAcceso = 1;
         |ABRE #205;
         #205#0 = enEmpresa;
         #205#1 = 97;
         |LEE 041#205=;
         |SI FSalida = 0;
             nDSocial = 1;
         |FINSI;
         |CIERRA #205;
    |FINSI;

     nSecretario = 0;           || Tique 2422_801 / 3725_510
     |BUCLE LeeRepresentante;
     |SI nSecretario = 0;
         |DDEFECTO #agim0024;
         #agim0024#4 = "<representante_no_informado>";
     |SINO;
         |ABRE #agim0024;
         #agim0024#0 = enEmpresa;
         #agim0024#1 = nClau1;
         #agim0024#2 = nClau2;
         |LEE 041#agim0024.=;
         |CIERRA #agim0024;
     |FINSI;

     #casoplib#0 = enEmpresa;      || codigo
     #casoplib#1 = #48#26;         || ejercicio
     |SI #casoplib#1 < 80;
         #casoplib#1 = #casoplib#1 + 2000;
     |SINO;
         #casoplib#1 = #casoplib#1 + 1900;
     |FINSI;

     #casoplib#2 = #agifigen#1;          || nombre
     #casoplib#3 = #agifigen#13;         || cif

     NombreTotal = #agifigen#2;
     |HAZ SeparaNombre;
     aAlfa = #casoplib#3; |QBF aAlfa; aAlfa = aAlfa % 0101;
     |SI aAlfa = "A"; |O aAlfa = "B"; |O aAlfa = "E";
        aApell1 = ""; aApell2 = "";
     |FINSI;
     |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
          #casoplib#4 = Nombre;
          #casoplib#5 = aApell1;
          #casoplib#6 = aApell2;
     |SINO;
          #casoplib#4 = NombreTotal;
          #casoplib#5 = "";
          #casoplib#6 = "";
     |FINSI;

     |SI nDSocial = 0;
         aAlfa0 = #agifigen#3; |QBF aAlfa0;
         |SI aAlfa0 ! ""; aAlfa0 = aAlfa0 + " "; |FINSI;
         aAlfa1 = #agifigen#4; |QBF aAlfa1;
         aAlfa2 = #agifigen#5; |QBF aAlfa2;
         |SI aAlfa2 ! "";  aAlfa2 = ", " + aAlfa2; |FINSI;
         aAlfa3 = #agifigen#6; |QBF aAlfa3;
         aAlfa4 = #agifigen#7; |QBF aAlfa4;
         aAlfa5 = #agifigen#8; |QBF aAlfa5;
         aAlfa6 = aAlfa0 + aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4 + aAlfa5;
         #casoplib#7  = aAlfa6;

         aAlfa1 = #agifigen#9;  |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
         aAlfa2 = #agifigen#10; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#8  = aAlfa3;

         #casoplib#9  = #agifigen#11;
         #casoplib#10 = #agifigen#12;
     |SINO;
         aAlfa0 = #dsam0005#3; |QBF aAlfa0;
         |SI aAlfa0 ! ""; aAlfa0 = aAlfa0 + " "; |FINSI;
         aAlfa1 = #dsam0005#4; |QBF aAlfa1;
         aAlfa2 = #dsam0005#5; |QBF aAlfa2;
         |SI aAlfa2 ! "";  aAlfa2 = ", " + aAlfa2; |FINSI;
         aAlfa3 = #dsam0005#6; |QBF aAlfa3;
         aAlfa4 = #dsam0005#7; |QBF aAlfa4;
         aAlfa5 = #dsam0005#8; |QBF aAlfa5;
         aAlfa6 = aAlfa0 + aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4 + aAlfa5;
         #casoplib#7  = aAlfa6;

         aAlfa1 = #dsam0005#9;  |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
         aAlfa2 = #dsam0005#10; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#8  = aAlfa3;

         #casoplib#9  = #dsam0005#11;
         #casoplib#10 = #dsam0005#12;
     |FINSI;
     #casoplib#11 = #agifigen#14;
     #casoplib#12 = #agifigen#15;

     |SI nSociedad ! 0;
         #casoplib#13 = #agim0024#3;
         NombreTotal  = #agim0024#4;
         |HAZ SeparaNombre;
         |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
              #casoplib#14 = Nombre;
              #casoplib#15 = aApell1;
              #casoplib#16 = aApell2;
         |SINO;
              #casoplib#14 = NombreTotal;
              #casoplib#15 = "";
              #casoplib#16 = "";
         |FINSI;
         aAlfa1 = #agim0024#7;  |QBF aAlfa1;
         aAlfa2 = #agim0024#8;  |QBF aAlfa2;
         |SI aAlfa2 ! ""; aAlfa2 = ", " + aAlfa2; |FINSI;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#17  = aAlfa3;

         aAlfa1 = #agim0024#9;  |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
         aAlfa2 = #agim0024#10; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#18  = aAlfa3;

         #casoplib#19 = #agim0024#11;
         #casoplib#20 = #agim0024#12;
         #casoplib#21 = #agim0024#13;

         #casoplib#23 = #agim0019#29;
         #casoplib#24 = #agim0019#30;
         #casoplib#25 = #agim0019#31;
         #casoplib#26 = #agim0019#32;
         #casoplib#27 = #agim0019#25;
         #casoplib#31 = #agim0019#33;
   |SINO;
         #casoplib#13 = #casoplib#3;
         #casoplib#14 = #casoplib#4;
         #casoplib#15 = #casoplib#5;
         #casoplib#16 = #casoplib#6;
         #casoplib#17 = #casoplib#7;
         #casoplib#18 = #casoplib#8;
         #casoplib#19 = #casoplib#9;
         #casoplib#20 = #casoplib#10;
         #casoplib#21 = #casoplib#11;
         #casoplib#22 = #casoplib#12;
   |FINSI;

   |SI nSecretario = 0; |Y nSw15 = 1;
         #casoplib#13 = #agicen15#4;
         NombreTotal  = #agicen15#5;
         |HAZ SeparaNombre;
         |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
              #casoplib#14 = Nombre;
              #casoplib#15 = aApell1;
              #casoplib#16 = aApell2;
         |SINO;
              #casoplib#14 = NombreTotal;
              #casoplib#15 = "";
              #casoplib#16 = "";
         |FINSI;
         aAlfa1 = #agicen15#8;  |QBF aAlfa1;
         aAlfa2 = #agicen15#9;  |QBF aAlfa2;
         |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + " "; |FINSI;
         aAlfa1 = aAlfa1 + aAlfa2;
         aAlfa2 = #agicen15#10; |QBF aAlfa2;
         |SI aAlfa2 ! ""; aAlfa2 = ", " + aAlfa2; |FINSI;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#17  = aAlfa3;

         aAlfa1 = #agicen15#15; |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
         aAlfa2 = #agicen15#16; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#18  = aAlfa3;

         #casoplib#19 = #agicen15#17;
         #casoplib#20 = #agicen15#18;
         #casoplib#21 = #agicen15#14;
   |FINSI;

   |PULSATECLA;
|FPRC;

|PROCESO Secuenciales;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     |SI FSalida = 0;
          Comodin = "Procesando " + #48#1;
          |ATRI I; |PINTA 2110, Comodin; |ATRI N;
          |HAZ CuentaLibros;
          |HAZ MiraCabecera;

          |SI nVerDat = 1;
              |PINPA #0#casoplib;
              |PINDA #0#casoplib;
              nSalir = 1;
              |PARA; |SI nSalir ! 0; |HACIENDO;
                     |ENDATOS #1#casoplib;
                     nSalir = FSalida;
              |SIGUE;
          |FINSI;

          |HAZ CreaSecuenciales;
     |FINSI;
|FPRC;

|DEFBUCLE Secuenciales;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Secuenciales;
|FIN;

|PROCESO Proceso14;
     |SI nVerDat = 0;
          |HAZ EscondeBotones;
          |ABRE #48;
          |BUCLE Secuenciales;
          |CIERRA #48;
          |BUCLE PasaFicheros;
          |PULSATECLA;
          |HAZ ReponBotones;
     |SINO;
          |HAZ FinBoton;
          |ABRE #48;
          |BUCLE Secuenciales;
          |CIERRA #48;
          |BUCLE PasaFicheros;
          |PULSATECLA;
          |CLS;
          |HAZ LosBotones;
     |FINSI;
     |PULSATECLA;
|FPRC;

|| ____________________ SALIR

|PROCESO Proceso15;
     Calc = 1;
     |PULSATECLA;
     |PTEC 801;
|FPRC;

|| ____________________ ETIQUETAS

|PROCESO Etiquetas;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;

     |SI #48#26 < 80;
          nNume1 = #48#26 + 2000;
     |SINO;
          nNume1 = #48#26 + 1900;
     |FINSI;

     #casoplib#32  = "LIBROS OFICIALES";
     #casoplib#33  = "EJERCICIO " + nNume1;
     #casoplib#34  = #48#2 + "/" + #48#3;
     #casoplib#35  = #48#1;
     #casoplib#36  = #48#8;

     |INFOR "casoplib";
     |SI FSalida = 0;
          |PRINT;
          |PIEINF;
     |SINO;
          |MENAV "0000Informe [casoplib] inaccesible";
     |FINSI;
     |FININF;
|FPRC;

|DEFBUCLE Etiquetas;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Etiquetas;
|FIN;

|PROCESO Proceso16;
     |HAZ EscondeBotones;
     |SI eaFormato ! "S";
         |HAZ QuitaExcel;
     |FINSI;
     Impresora = "Pantalla Estandard";
     |IMPRE 0;
     |SI FSalida = 0;
          |ABRE #48;
          |BUCLE Etiquetas;
          |CIERRA #48;
     |FINSI;
     |FINIMP;
     |SI eaFormato ! "S";
         |HAZ PonExcel;
     |FINSI;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ GESTION PANTALLA

|PROCESO EscondeBotones;
   |ESTADO_CONTROL nBoton01,"DISABLE";
   |ESTADO_CONTROL nBoton02,"DISABLE";
   |ESTADO_CONTROL nBoton03,"DISABLE";
   |ESTADO_CONTROL nBoton05,"DISABLE";
   |ESTADO_CONTROL nBoton06,"DISABLE";
   |ESTADO_CONTROL nBoton04,"DISABLE";
   |ESTADO_CONTROL nBoton07,"DISABLE";
   |ESTADO_CONTROL nBoton09,"DISABLE";
   |ESTADO_CONTROL nBoton08,"DISABLE";
   |ATRI I; |PINTA 2330, "Imprimiendo, espere por favor"; |ATRI N;
|FPRC;

|PROCESO ReponBotones;
   |ESTADO_CONTROL nBoton01,"ENABLE";
   |ESTADO_CONTROL nBoton02,"ENABLE";
   |ESTADO_CONTROL nBoton03,"ENABLE";
   |ESTADO_CONTROL nBoton05,"ENABLE";
   |ESTADO_CONTROL nBoton06,"ENABLE";
   |ESTADO_CONTROL nBoton04,"ENABLE";
   |ESTADO_CONTROL nBoton07,"ENABLE";
   |ESTADO_CONTROL nBoton09,"ENABLE";
   |ESTADO_CONTROL nBoton08,"ENABLE";
   |PINTA 2110, "                                                            ";
   |PINTA 2330, "                             ";
|FPRC;

|PROCESO QuitaExcel;
     || ... Impresora = "";
     |SI enBasImp ! 0;  |ACABA; |FINSI;

     Comodin = "0,9," + aImpre;
     |MENUITEM 0,Comodin;
|FPRC;

|PROCESO PonExcel;
     || .... Impresora = "Excel";

     Comodin = "0,9,1";
     |MENUITEM 0,Comodin; EstadoAnt = FSalida;
     aEstado = FSalida;
     |SI FSalida = "UNCHECKED";
          Comodin = "0,9,0";
          |MENUITEM 0,Comodin;
          aImpre = "0";
     |SINO;
          aImpre = "1";
     |FINSI;

     |SI aEstado = "CHECKED";  |O aEstado = "UNCHECKED";
         enBasImp = 0;  || .... BASICO 9
         eaNomImp = "";
     |SINO;
         enBasImp = 1;  || .... BASICO 9 - 10
         eaNomImp = "ExcelEstandard";
     |FINSI;
|FPRC;

|PROCESO Borrado;
    |SI aMasNombre ! "S";
         Comodin = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2) + "/";
    |SINO;
        Comodin = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2);
        |HAZ PongoNombre;
        Comodin = Comodin + eaAlfa + "/";
    |FINSI;

     Comodin1 = Comodin + "datos.txt";   |RFBORRA Comodin1;
     Comodin1 = Comodin + "desc.txt";    |RFBORRA Comodin1;
     Comodin1 = Comodin + "nombres.txt"; |RFBORRA Comodin1;
     |PARA nCont = 1; |SI nCont [ 10; |HACIENDO nCont = nCont + 1;
          Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xls";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xls";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xls";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xls";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xls";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xls";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".doc";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".doc";
          |RFBORRA Comodin1;

          Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".pdf";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".pdf";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".pdf";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".pdf";
          |RFBORRA Comodin1;
          Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".pdf";
          |RFBORRA Comodin1;

     |SIGUE;
     |RRMDIR Comodin;
|FPRC;

|DEFBUCLE Borrado;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Borrado;
|FIN;

|PROCESO CampoPath;
    nInkey = FSalida;
    |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        |SI aAlfa1 = ""; |ACABA; |FINSI;
        aAlfa1 = aAlfa1 % 280;
        #11#1 = aAlfa1;
        |PINTA #11#1;
    |FINSI;
    aAlfa1 = #11#1;
    |QBF aAlfa1;
    aAlfa2 = aAlfa1 % -101;
    |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
         #11#1 = aAlfa1 + "\";
         |PINTA #11#1;
    |FINSI;
|FPRC;

|PROCESO aMemoria;
  |SI #11#2 = "S";
      |ATRI P; |PINTA 2013 , " Incluir Datos Socios Memorias Anteriores a 2008  "; |ATRI N;
      |C_V #11#5, 1, "S"; |C_M #11#5, 1, "S";
      |PINTA #11#5;
  |SINO;
      |C_V #11#5, 1, "N"; |C_M #11#5, 1, "N";
      |PINTA 2013 , "                                                  ";
  |FINSI;
|FPRC;

|PROCESO nivel_leg; |TIPO 7;
 aAlfa1 = #11#13;
 |C_M #11#14, 1,aAlfa1;
 |SI aAlfa1 = "N";
     #11#14  = 0; |PINTA #11#14;
 |FINSI;
|FPRC;

|PROCESO Datos; |TIPO 12;
|FPRC;

|PROCESO PideVarios;

     aPath = "C:/Progra~1/Adhoc/Legalia/Legalia.exe";
     |XABRE "C", aPath, Handle;
     |SI FSalida < 0;
          aPath = "C:/Archiv~1/Adhoc/Legalia/Legalia.exe";
          |XABRE "C", aPath, Handle;
          |SI FSalida < 0;
               aPath = "C:/Archiv~1/Legalia/Legalia.exe";
               |XABRE "C", aPath, Handle;
               |SI FSalida < 0;
                    aPath = "C:/Adhoc/Legalia/Legalia.exe";
                    |XABRE "C", aPath, Handle;
                    |SI FSalida < 0;
                         aPath = "C:/Legalia/Legalia.exe";
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     aPath = aPath - "Legalia.exe"; aPath = aPath + "Data/";

     |ABRE #11;
     |DDEFECTO #11;
     |LEE 001#11p;
     |SI FSalida ! 0;
         |DDEFECTO #11;
         #11#1 = aPath;
         |GRABA 020#11n;
     |FINSI;
     |CIERRA #11;

     |PUSHV 0510 2380;
     |PINPA #0#11;

     aAlfa1 = #11#2;
     |C_V #11#5,1,aAlfa1; |C_M #11#5,1,aAlfa1;
     |HAZ aMemoria;
     |PINDA #0#11;
     |ENDATOS #1#11;
     |SI FSalida ! 0;
         nError = 1;
     |SINO;
         Comodin = "";
         |IP_REMOTO Comodin;
         |QBF Comodin;
         |SI Comodin = "";
              Local = 1;
         |SINO;
              Local = 0;
         |FINSI;

         aPath      = #11#1; |QBF aPath;
         aMemoria   = #11#2;
         aSaldoCero = #11#3;
         aApertura  = #11#4;
         eaMemSoc   = #11#5;
         aBorro     = #11#6;
         aVerDatos  = #11#7;
         eaUltNiv   = #11#8;
         aMasNombre = #11#9;
         eaFormato  = #11#10;
         efFecLeg   = #11#11;
         eaDatLeg   = #11#12;
         eaPathLeg  = #11#1;
         eaCtasLeg  = #11#13;
         enCtasLeg  = #11#14;
         nVerDat = 0; |SI aVerDatos = "S"; nVerDat = 1; |FINSI;

         |ABRE #11;
         |LEE 141#11p;
         |SI FSalida ! 0;
             |DDEFECTO #11;
             #11#1 = aPath;
             |GRABA 020#11b;
         |FINSI;
         #11#1  = aPath;
         #11#2  = aMemoria;
         #11#3  = aSaldoCero;
         #11#4  = aApertura;
         #11#5  = eaMemSoc;
         #11#6  = aBorro;
         #11#7  = aVerDatos;
         #11#8  = eaUltNiv;
         #11#9  = aMasNombre;
         #11#10 = eaFormato;
         #11#11 = efFecLeg;
         #11#12 = eaDatLeg;
         #11#13 = eaCtasLeg;
         #11#14 = enCtasLeg;

         |GRABA 020#11a;
         |LIBERA #11;
         |CIERRA #11;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO ConRayas;
     |SI nDejaSI = 1;
          |ABRE #8;
          |DDEFECTO #8;
          #8#0 = 1;
          |LEE 101#8=;
          |SI FSalida ! 0;
              |DDEFECTO #8;
              #8#0 = 1;
              |GRABA 020#8b;
          |FINSI;
          #caconimp#4 = "S";
          |GRABA 020#8a;
          |LIBERA #8;
          |CIERRA #8;
     |FINSI;
|FPRC;

|PROCESO SinRayas;
     nDejaSI = 0;
     |ABRE #8;
     |DDEFECTO #8;
     #8#0 = 1;
     |LEE 101#8=;
     |SI FSalida ! 0;
          |DDEFECTO #8;
          #8#0 = 1;
          |GRABA 020#8b;
     |FINSI;
     |SI #8#4 = "S";
          nDejaSI = 1;
     |FINSI;
     #8#4 = "N";
     |GRABA 020#8a;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Emision LEGALIA";

     |SUB_EJECUTA_NP "caselemp";
     |NOME_DAT #998 eaFichsel;

     |ABRE #caselem1;
     |LEE 000#caselem1.p;
     |SI FSalida ! 0; |CIERRA #caselem1; |ACABA; |FINSI;

     |HAZ DirAplicSt;

     nError = 0;
     |HAZ PideVarios;
     |SI nError = 1;  |DELINDEX #998; |ACABA; |FINSI;

     |HAZ SinRayas;

     |SI nNoborro = 0;
         |BUCLE Borrado;
     |FINSI;

     |HAZ LeeUnidadBasico;
     |SI eaFormato ! "S";
         |HAZ PonExcel;
     |SINO;
         enBasImp = 1;
         eaNomImp = "CrystalReport";
     |FINSI;

     Comodin = "Carpeta LEGALIA: " + aPath;
     |ATRI I; |PINTA 2210, Comodin; |ATRI N;

     |HAZ LosBotones;

     |PARA; |SI Calc = 0; |HACIENDO;
          |LEETECLA Comodin;
     |SIGUE;

     |HAZ FinBoton;
     |PULSATECLA;

     |HAZ ConRayas;

     |SI eaFormato ! "S";
         |HAZ QuitaExcel;
     |FINSI;
     |DELINDEX #998;
|FPRO;

|PROCESO FinBoton;
     |FIN_CONTROL_WINDOWS nBoton01;
     |FIN_CONTROL_WINDOWS nBoton02;
     |FIN_CONTROL_WINDOWS nBoton03;
     |FIN_CONTROL_WINDOWS nBoton05;
     |FIN_CONTROL_WINDOWS nBoton06;
     |FIN_CONTROL_WINDOWS nBoton04;
     |FIN_CONTROL_WINDOWS nBoton07;
     |FIN_CONTROL_WINDOWS nBoton09;
     |FIN_CONTROL_WINDOWS nBoton08;
|FPRC;

|PROCESO LosBotones;
                                                                             || 0530 0658
     |CONTROL_SIMPLE 0,"LBOTON, A) Diario Ampliado                        ", 0712,0840,Proceso01; nBoton01 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, B) Inventario y cuentas anuales           ", 0912,1040,Proceso02; nBoton02 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, C) Diario Resumido                        ", 1112,1240,Proceso07; nBoton03 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, D Facturas Emitidas                       ", 1312,1440,Proceso10; nBoton05 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, E) Facturas Recibidas                     ", 1512,1640,Proceso11; nBoton06 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, F) Bienes de Inversion por Regularizacion ", 1712,1840,Proceso12; nBoton04 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, G) Generar ficheros                       ", 1343,1471,Proceso14; nBoton07 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, I) Imprimir Etiquetas                     ", 1543,1671,Proceso16; nBoton09 = FSalida;
     |CONTROL_SIMPLE 0,"LBOTON, S) Salir                                  ", 1743,1871,Proceso15; nBoton08 = FSalida;
|FPRC;
