|FICHEROS;
   cacuent2 #0;
   :/contagen/def/cacuenta #1;
   canempre #30;

   :/contagen/def/cacuebal #5;    || Cuentas de balance
   :/contagen/def/caparbal #6;    || partidas balances
   :/contagen/def/caparexp #7;    || partidas explotacion
|FIN;

|VARIABLES;
   nCampo   = 0;
   aFichero = "";

   men1     = "     NO EXISTE EMPRESA !";
   men2     = "     LONGITUD DE CUENTA FUERA DE NIVEL !";
   men3     = "     CUENTA ERRONEA !!";
   error    = "     CLAVE EXISTENTE !";
   valida   = "     Conforme S/N.:";
   mascara  = "";
   digito2  = "  ";
   num      = 0;
   sw       = 0;
   mes      = "                ";
   me       = 0;
   cta      = "            ";
   ctanum   = 0;
   ctaalf   = " ";
   longalf  = " ";
   longnum  = " ";
   nivel    = 0;
   codcli   = 0;
   codpr    = 0;
   nompro   = "";
   uno = "";
   dos = "";
   nada = "";
   &entrada = 0;
   cuen1 = "";
   cuen2 = "";
   cuen3 = "";
   desdec = "";
   hastac = "";
   mesdes = "";
   meshas = "";
   modo = 0;
   &eaTex1 = "";
   &eaTex2 = "";
   &eaTex3 = "";
|FIN;

|INCLUYE dscont_i;

|PROCESO GrabaTempo;
   |PARA nCampo = 0;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
      #0nCampo = #1nCampo;
   |SIGUE;
   |SI #1#58 [ "01.01.1900"; #0#58 = "01.01.0000"; |FINSI;

   #0#61 = #1#11 + #1#14;
   #0#62 = #0#61 + #1#17;
   #0#63 = #0#62 + #1#20;
   #0#64 = #0#63 + #1#23;
   #0#65 = #0#64 + #1#26;
   #0#66 = #0#65 + #1#29;
   #0#67 = #0#66 + #1#32;
   #0#68 = #0#67 + #1#35;
   #0#69 = #0#68 + #1#38;
   #0#70 = #0#69 + #1#41;
   #0#71 = #0#70 + #1#44;
   #0#72 = #0#71 + #1#47;
   #0#73 = #0#72 + #1#50;
||    #0#74 = #0#73 + #1#53;
   |GRABA 020#0n;
   |LIBERA #0;
|FPRC;

|DEFBUCLE cacuenta;
   #1#1;
   ;
   "            ";
   "zzzzzzzzzzzz";
   ;
   NULL, GrabaTempo;
|FIN;

|PROCESO Tipo8;  |TIPO 8;
   aFichero = ((Usuario % 810) + "zzzzzzzz") % 108;
   |NOME_DAT  #0 #aFichero#;
   |ABRET #0;  |CIERRAT #0;  |DELINDEX #0;

   |ABRET #0;
   |BUCLE cacuenta;

   |HAZ inicio;
|FPRC;

|PROCESO defect;
|FPRC;

|PROCESO Nivel; |TIPO 0;
     eaCuenta = #cacuent2#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #cacuent2#Campo# = eaCuenta;
     |PINTA #cacuent2#Campo#;

   cta = #0#0;  |QBF cta;
   |SI cta = ""; |ACABA; |FINSI;

   |HAZ defect;
   cta = #0#0;  |QBF cta;
   nada = cta % A101;

   |SI nada ! "0";
      ctanum = cta;
      ctaalf = ctanum;
      longnum = ctaalf % A0;
   |SINO;
      ctanum = 1;
      ctaalf = cta;
      longnum = ctaalf % A0;
   |FINSI;

   longalf = cta    % A0;
   |SI longnum ! longalf;|O ctanum = 0;
      |MENAV men3;
      |PINTA #0#0;
      |ERROR;
      |ACABA;
   |FINSI;

   nivel= 0;
   sw = 0;
   |SI longnum = dig4; sw = 1; nivel = 1; |FINSI;
   |SI longnum = dig5; sw = 1; nivel = 2; |FINSI;
   |SI longnum = dig6; sw = 1; nivel = 3; |FINSI;
   |SI longnum = dig7; sw = 1; nivel = 4; |FINSI;
   |SI longnum = dig8; sw = 1; nivel = 5; |FINSI;
   |SI longnum = dig9; sw = 1; nivel = 6; |FINSI;
   |SI sw = 0;
      |MENAV men2;
      |PINTA #0#0;
      |ERROR;
      |ACABA;
   |FINSI;
   ||***** 1a Clave;
   ||***** nivel = nivel de la cta;
   #0#1 = nivel;
   || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
   mascara = #0#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 112;
   #0#54    = mascara;
   #0#55    = nivel;
   #0#56 = mesdes;
   #0#57 = meshas;

   |SI #0#1 = #canempre#13;
      #0#3 = "S";
   |SINO;
      #0#3 = "N";
   |FINSI;
|FPRC;


|PROCESO Tipo9;  |TIPO 9;
   |DELINDEX #0;
|FPRC;

|PROCESO Tipo1;  |TIPO 1;
   |MENAV "      De de Alta, Modifique o de de Baja por el Plan Contable.";
   |ERROR;
|FPRC;

|PROCESO Tipo4; |TIPO 4;
   |IMPRE 0;
   |SI FSalida = 0;
      |DDEFECTO #1;
      |ABRE #1;
      #1#0 = #0#0;
      #1#1 = #0#1;
      |LEE 020#1=;
      |CIERRA #1;
      |HAZ Lecturas;

      |INFOR "cacuenta";
      |PRINT;
      |PIEINF;
      |FININF;
   |SINO;
      |MENAV "    Proceso abortado ...";
   |FINSI;
   |FINIMP;
|FPRC;

|PROCESO Lecturas;
 eaTex1 = "";
 eaTex2 = "";
 eaTex3 = "";
 |SI #0#4 = 0;
    |ABRE #6;
    #caparbal#0 = #0#5;     || tipo
    #caparbal#1 = #0#6;     || agrupacion
    #caparbal#3 = #0#7;     || epigrafe
    #caparbal#5 = #0#8;     || partida
    |LEE 001#6=;
    |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
    eaTex1 = #6#2;
    eaTex2 = #6#4;
    eaTex3 = #6#6;
    |CIERRA #6;
  |SINO;
     |ABRE #7;
     #caparexp#0 = #0#4;     || bloque
     #caparexp#1 = #0#5;     || tipo
     #caparexp#2 = #0#6;     || agrupacion
     #caparexp#4 = #0#7;     || epigrafe
     #caparexp#6 = #0#8;     || partida
     |LEE 001#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
     eaTex1 = #7#3;
     eaTex2 = #7#5;
     eaTex3 = #7#7;
     |CIERRA #7;
  |FINSI;
|FPRC;
