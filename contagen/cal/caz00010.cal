|FICHEROS;
  caz00010 #0;
  cam00001 #1;
  cam00002 #2,MANTE;
  cam00003 #3;
  cam00004 #4;
  cam00005 #5;

  canempre #30;
|FIN;

|VARIABLES;
 &enPor = 0;
 nEstado  = 0;
 &nMaxDes = 0;
 &eaDirDestino = "";
 &eaDirOrigen  = "";
|FIN;

|INCLUYE dscont_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|| ******************************************** Calculos Pantalla
|CALCULO wTipo12; |TIPO 12;
|FCAL;

|CALCULO wTipo7; |TIPO 7;
 |PUSHV  0905 1336;
 |CUADRO 0905 1335;
 |ATRI R;
 |PINTA 0906, " 1 - Acumulados Plan Contable ";
 |PINTA 1006, " 2 - Asientos Contables       ";
 |PINTA 1106, " 3 - Registros de IVA/IRPF    ";
 |PINTA 1206, " 4 - Todos los Datos          ";
 |ATRI 0;
|FCAL;

|CALCULO wTipo0; |TIPO 0;
 |POPV;
 |HAZ elTexto;
 |PINTA #0#9;
 |SI #0#5 ! 4;
     |C_M #0#8,1,"N"; #0#8 = "N"; |PINTA #0#8;
 |SINO;
     |C_M #0#8,1,"S";
 |FINSI;
 |SI #0#5 < 3;
     |C_M #0#11,1,"N"; #0#11 = "N"; |PINTA #0#11;
 |SINO;
     |C_M #0#11,1,"S";
 |FINSI;
 |SI #0#5 ! 2; |Y #0#5 ! 4;
     |C_M #0#12,1,"N"; #0#12 = "N"; |PINTA #0#12;
 |SINO;
     |C_M #0#12,1,"S";
 |FINSI;
|FCAL;

|PROCESO elTexto;
 #0#9 = "";
 |SI #0#5 = 1; #0#9 = "Acumulados Plan Contable "; |FINSI;
 |SI #0#5 = 2; #0#9 = "Asientos Contables       "; |FINSI;
 |SI #0#5 = 3; #0#9 = "Registros de IVA/IRPF    "; |FINSI;
 |SI #0#5 = 4; #0#9 = "Todos los Datos          "; |FINSI;
|FPRC;

|CALCULO AntesAmor; |TIPO 7;
 |SI #0#8 = "N";
     |C_M #0#7,1, "N"; #0#7 = 0; |PINTA #0#7;
 |SINO;
     |C_M #0#7,1, "S";
 |FINSI;
|FCAL;

|CALCULO verDif; |TIPO 0;
 |SI #0Campo > nMaxDes;
     |MENAV "    Error. Posicion no valida ";
     |ERROR;
 |FINSI;
|FCAL;
|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|RUTINA ClaveBajaC;
 #2#0 = enEmpresa;
 #2#1 = 1;
|FRUT;

|RUTINA ClaveAltaC;
 #2#0 = enEmpresa;
 #2#1 = 99999;
|FRUT;

|CALCULO wTipo3; |TIPO 3;
 || **************************************************  Tipo3;

 |SI PARAMETRO ! "AUTO";
    |ENTLINEAL #1#2, -2, 2, 22, 0, ClaveBajaC, ClaveAltaC;
    |BLIN 4;
 |SINO;
     FSalida = 0;
 |FINSI;

 |SI FSalida = 0;
     |HAZ LaConsolidacion;
 |FINSI;
|FCAL;


|PROGRAMA;
 |HAZ inicio;
 |ABRE #1;
 #1#0 = enEmpresa;
 |LEE 101#1=;
 |SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = enEmpresa;
     #1#1 = eaNombreEmp;
     |GRABA 020#1n;
 |FINSI;
 |LIBERA #1;
 |CIERRA #1;

 |DFICE eaDirDestino;
 enPor = 0;
 #0#0  = #1#0;
 #0#1  = enPeriodo;
 #0#2  = #1#1;
 #0#3  = enEjercicio;
 #0#10 = #30#26;
 #0#4  = eaMoneda;
 #0#5  = #1#2;
 #0#6  = #1#3;
 #0#7  = #1#4;
 #0#8  = #1#5;
 #0#11 = #1#10;
 #0#12 = #1#11;
 |HAZ elTexto;
 nMaxDes = MaximoDigitos;

 |SI PARAMETRO ! "AUTO";
    enAutom = 0;
    |CLS;
    |CABEZA "Consolidar Empresas";
    |PINPA #0#0;
    |PINDA #0#0;

    |ENTLINEAL #1#2, -2, 7, 22, 0, ClaveBajaC, ClaveAltaC;

    |HAZ Avisa; |SI nEstado ! 0; |ACABA; |FINSI;

    |ENDATOS #1#0;
 |SINO;
    enAutom = 1;
    |HAZ wTipo3;
    enAutom = 0;
 |FINSI;
|FPRO;

|| ********************************************************************
|PROCESO Borral30;
 |BORRA 020#3a;
 |LIBERA #3;
|FPRC;

|DEFBUCLE Borral3;
 #3#1;
 ;
 #0#0, 00001, 00;
 #0#0, 99999, 99;
 be;
 NULL, Borral30;
|FIN;

|PROCESO Borral40;
 |BORRA 020#4a;
 |LIBERA #4;
|FPRC;

|DEFBUCLE Borral4;
 #4#1;
 ;
 #0#0, 00001, 00;
 #0#0, 99999, 99;
 be;
 NULL, Borral40;
|FIN;


|PROCESO LaConsolidacion;

     |ABRE #1;
     #1#0 = #0#0;
     |LEE 101#1=;
     nEstado = FSalida;
     #1#0  = #0#0;  #1#1  = #0#2;
     #1#2  = #0#5;  #1#3  = #0#6;
     #1#4  = #0#7;  #1#5  = #0#8;
     #1#10 = #0#11; #1#11 = #0#12;
     |SI nEstado = 0; |GRABA 020#1a; |FINSI;
     |SI nEstado ! 0; |GRABA 020#1n; |FINSI;
     |LIBERA #1;
     |CIERRA #1;

     |SI #0#5 = 3;
         |BUCLE Borral3;
     |FINSI;
     |SI #0#5 < 3;
         |BUCLE Borral4;
     |FINSI;

     |SI PARAMETRO ! "AUTO";
        |CONFI "    SDesea Consolidar Empresas Ahora S/N ";
        |SI FSalida = 0;
            |SUB_EJECUTA_NP "caz00011";
        |FINSI;
     |SINO;
        |SUB_EJECUTA_NP "caz00011";
     |FINSI;
|FPRC;

|PROCESO Avisa;
   |PUSHV 05201160;
   |CUADRO 05201160;
   |ATRI I;
   |PINTA 0621, "             ญญ ATENCION !!            ";
   |PINTA 0721, " Esta opcion destruira todos los datos ";
   |PINTA 0821, " de esta empresa para prepararla con el";
   |PINTA 0921, " fin de englobar todos los datos de las";
   |PINTA 1021, " empresas indicadas.                   ";
   |CONFI "    Nจ Desea continuar ?";
   nEstado = FSalida;
   |POPV;
|FPRC;
