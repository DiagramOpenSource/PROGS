|FICHEROS;
     dscsvz10;
     dscsvz14;

     canempre;
     cacuenta;
     caclipro;
     camaasic;
     camaasil;
     camaniva;
     caivalin;

     :modelos/dsmom030;

     dscsvw19;
     dscsvw10;

     &regisnif@;
|FIN;

|VARIABLES;
     nDigiOrigen     = 0;
     nDigiDestino    = 0;
     nOrden1         = 0;
     nOrden2         = 0;
     nPausa          = 0;
     nImpor          = 0;
     nImpor1         = 0;
     nOk             = 0;

     aNombre1        = "";
     aNombre2        = "";
     aNombre3        = "";
     aNombre4        = "";
     aModificaAsiIva = "";
     aFicheroLCK     = "";
     aPathContagen   = "";
     aBorra          = "";
     aEjecuta        = "";
     aMensaje        = "";
     aFicheroMDB     = "";
     aFicheroAux     = "";
     nBtnInfo        = -1;
     aPathDavid      = "";
     aTextoVentana   = "";
     aBaseConta      = "";

     aAlf1           = "";
     aLen            = "";
     aCaracter       = "";
     aTipoCliPro     = "";
     aCuenta         = "";
     aAux            = "";
     aDireccion      = "";
     aCP             = "";
     aCP1            = "";
     aCP2            = "";
     aNif            = "";
     aFechaDiario    = "";
     aCar            = "";
     aLF             = "";
     aCR             = "";
     aSeparador      = "";
     aTmp            = "";
     aBass           = "";
     aPathIntegral   = "";
     aPathDatosInte  = "";

     nDocumentoDiario= 0;
     nApunte         = 0;
     nLen            = 0;
     nAux            = 0;
     nLinea          = 0;
     i               = 0;
     nSal            = 0;

     n0Vent          = -1;
     n1Vent          = -1;
     n2Vent          = -1;
     nBtnUni         = -1;
     nBtnCan         = -1;
     nBtnCar1        = -1;
     nBtnCar2        = -1;
     nBtnCar3        = -1;
     nBtnCar4        = -1;
     nLblReg1        = -1;
     nLblReg2        = -1;
     nLblReg3        = -1;
     nLblReg4        = -1;
     nLblReg5        = -1;

     nRango          = 0;
     nHandle         = 0;
     nIde            = 0;
     nDCampo         = 0;
     nCampo          = 0;
     nPanta          = 0;
     nLong           = 0;
     nCarac          = 0;
     nPos            = 0;
     nFSalida        = 0;
     nColum          = 0;
     nNume1          = 0;
     nNume2          = 0;
     nRam1           = 0;
     nRam2           = 0;
     nPide           = 0;
     nFila           = 0;
     nCargar         = 0;
     nPosi           = 0;
     nTotCmp         = 0;
     nTCampos        = 0;
     nTValor         = 0;
     nReg            = 0;
     nPorce          = 0;
     nError          = 0;
     nCmp            = 0;
     nLongVar        = 0;
     nCarVar         = 0;
     nPosVar         = 0;
     nDife           = 0;
     nDesdeCar       = 0;
     nPos1           = 0;
     nPos2           = 0;
     nChequeo        = 0;
     nDocu           = 0;
     nApun           = 0;
     nBarra          = 0;
     nDia            = 0;
     nMes            = 0;
     nAny            = 0;
     nLibro          = 0;
     nIBas           = 0;
     nIIva           = 0;
     nITot           = 0;
     nIRet           = 0;
     nConcep         = 0;
     nBuscoCli       = 0;
     nPrint          = 0;
     nDiario         = 0;
     nDocum          = 0;
     nPas            = 0;

     aCtaBas         = "";
     aCtaIva         = "";
     aCtaTot         = "";
     aCtaRet         = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aFecha          = "";
     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aPathLocal      = "";
     aPathTmp        = "";
     aFicTree        = "";
     aAbre           = "";
     aTabla          = "";
     aTablaTree      = "";
     aFilaTree       = "";
     aDescri         = "";
     aRuta           = "";
     aLong           = "";
     aCadena         = "";
     aOrigen         = "";
     aDestino        = "";
     aDTabla         = "";
     aHTabla         = "";
     aBuscar         = "";
     aRefresca       = "";
     aCarac          = "";
     aContenido      = "";
     a100            = "";
     aVar            = "";
     aLee            = "";
     aC10            = "";
     aC13            = "";
     aFicTmp         = "";
     aLongVar        = "";
     aComilla        = "";
     aCarVar         = "";
     aTipo           = "";
     aAsiento        = "";
     aLibro          = "";
     aParam1         = "";
     aParam2         = "";
     aParam3         = "";
     aProg           = "";
     aFicBrowse      = "";
     aVer1           = "";
     aVer2           = "";
     aModAsiento     = "";

     fFecha          = @;

     {1}aConte       = "";
     {300}aDato      = "";
     {300}aCamp      = "";
     {300}aValor     = "";

     {-1}sTree       = 0;
         sT_nID      = 0;
         sT_nOper    = 0;
         sT_aData    = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &eaUnidadBasico = "";
     &eaIP           = "";
     &eaModoImpo     = "";
     &eaRepeSopo     = "";
     &eaFicheroCSV   = "";
     &eaTipoCSV      = "";
     &eaFicheroIVA   = "";
     aAnyo           = "";
     &eaFicheroDatos = "";
     &eaNombreDatos  = "";
     &eaBinarioConve = "";
     &eaNombrePDF    = "";
|FIN;

|INCLUYE dscont_i;

|PROCESO Tipo12z14;  |TIPO 12;
|FPRC;

|| ------------------------------------------------------------------------

|PROCESO MiniBrowse;
     aFicBrowse = "F*.*";
     |BROWSE aFicBrowse;

     aAlfa      = aFicBrowse;   |QBF aAlfa;
     aFicBrowse = "";
     aLong      = aAlfa % 0;
     nLong      = aLong;
     |PARA nCarac = 2;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos  = (nCarac * 100) + 1;
           aFicBrowse = aFicBrowse + (aAlfa % nPos);
     |SIGUE;
|FPRC;

|| ------------------------------------------------------------------------

|PROCESO CalculaFecha;
     |QBT aFecha;
     aLongVar = aFecha % 0;
     nLongVar = aLongVar;
     nBarra   = 0;
     aAlfa1   = "";
     aAlfa2   = "";
     aAlfa3   = "";
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = aFecha % nPosVar;

           |SI  aCarVar = "0"; |O aCarVar = "1"; |O aCarVar = "2";
             |O aCarVar = "3"; |O aCarVar = "4"; |O aCarVar = "5";
             |O aCarVar = "6"; |O aCarVar = "7"; |O aCarVar = "8";
             |O aCarVar = "9";
                |SI nBarra = 0;  aAlfa1 = aAlfa1 + aCarVar;  |FINSI;
                |SI nBarra = 1;  aAlfa2 = aAlfa2 + aCarVar;  |FINSI;
                |SI nBarra = 2;  aAlfa3 = aAlfa3 + aCarVar;  |FINSI;
           |SINO;
                |SI aCarVar = ".";  |O aCarVar = "/";  |O aCarVar = "\";
                    nBarra = nBarra + 1;
               |FINSI;
           |FINSI;
      |SIGUE;

      |QBF aAlfa1;
      |QBF aAlfa2;
      |QBF aAlfa3;

      nDia = aAlfa1;
      nMes = aAlfa2;
      nAny = aAlfa3;

      |SI nAny < 1000;
          nAny = 2000 + nAny;
      |FINSI;

      |SI nDia = 0;  nDia = 1;                    |FINSI;
      |SI nMes = 0;  nMes = 1;                    |FINSI;
      |SI nAny = 0;  nAny = 2000 + #canempre#26;  |FINSI;

      aFecha = (("00" + nDia) % -102);
      aFecha = aFecha + "." + (("00" + nMes) % -102);
      aFecha = aFecha + "." + (("0000" + nAny) % -104);
|FPRC;

|PROCESO QuitaPuntos;
     |QBT aAlfa;
     aLongVar = aAlfa % 0;
     nLongVar = aLongVar;
     aAlfa1   = "";
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = aAlfa % nPosVar;

           |SI  aCarVar ! ".";
                aAlfa1 = aAlfa1 + aCarVar;
           |FINSI;
      |SIGUE;

      aAlfa = aAlfa1;
|FPRC;

|PROCESO QuitaComillas;
     aLongVar = aAlfa % 0;
     nLongVar = aLongVar;

     aAlfa1   = "";
     aComilla = &34;
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = aAlfa % nPosVar;

           |SI aCarVar ! aComilla;
                aAlfa1 = aAlfa1 + aCarVar;
           |FINSI;
     |SIGUE;

     aAlfa = aAlfa1;
|FPRC;

|PROCESO MiraRaros;
     |QBF aAlf1;
     aCadena = "";
     aLen    = aAlf1 % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlf1 % nPos;

           aCarac = &209;  |SI aCaracter = aCarac;  aCaracter = "¥"; |FINSI;
           aCarac = &241;  |SI aCaracter = aCarac;  aCaracter = "¤"; |FINSI;
           aCarac = &186;  |SI aCaracter = aCarac;  aCaracter = "§"; |FINSI;
           aCarac = &170;  |SI aCaracter = aCarac;  aCaracter = "¦"; |FINSI;
           aCarac = &225;  |SI aCaracter = aCarac;  aCaracter = " "; |FINSI;
           aCarac = &233;  |SI aCaracter = aCarac;  aCaracter = "‚"; |FINSI;
           aCarac = &237;  |SI aCaracter = aCarac;  aCaracter = "¡"; |FINSI;
           aCarac = &243;  |SI aCaracter = aCarac;  aCaracter = "¢"; |FINSI;
           aCarac = &250;  |SI aCaracter = aCarac;  aCaracter = "£"; |FINSI;
           aCarac = &210;  |SI aCaracter = aCarac;  aCaracter = "O"; |FINSI;
           aCarac = &211;  |SI aCaracter = aCarac;  aCaracter = "O"; |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlf1 = aCadena;
|FPRC;

|PROCESO CalculaCuenta;
     |QBF eaCuenta;
     |SI eaCuenta = "";  |ACABA;  |FINSI;

     aLongVar = eaCuenta % 0;
     nLongVar = aLongVar;

     |SI nLongVar ! MaximoDigitos;
         nDife = MaximoDigitos - nLongVar;
         |SI nDife < 0;  |ACABA;  |FINSI;

         nDesdeCar = 5;

         nPos1    = 100 + nDesdeCar;
         nPos2    = (100 * (nDesdeCar + 1)) + 99;
         aAlfa    = (eaCuenta % nPos1) + ("0" * nDife) + (eaCuenta % nPos2);
         eaCuenta = aAlfa;
     |FINSI;

     |HAZ SacaNivel;
|FPRC;

|PROCESO CACLIPRO;
     nOk   = 0;
     aAlfa = aCuenta % 102;
     |SI aAlfa = "40";  nOk = 1;  |FINSI;
     |SI aAlfa = "41";  nOk = 1;  |FINSI;
     |SI aAlfa = "43";  nOk = 1;  |FINSI;
     |SI aAlfa = "44";  nOk = 1;  |FINSI;

     |SI nOk = 0;  |ACABA;  |FINSI;

     IaValor = aValor1<-; IaValor = IaValor + 15;
     aTipoCliPro = aValor;

     |DDEFECTO #caclipro;
     #caclipro#23 = aTipoCliPro;
     #caclipro#10 = aCuenta;
     |LEE 101#caclipro.=;
     |SI FSalida ! 0; |GRABA 020#caclipro.b; |FINSI;

     ||Cod. Cliente/Prov
     IaValor = aValor1<-;
     nAux = aValor;
     #caclipro#0 = nAux;

     ||Razon Social
     IaValor = aValor1<-; IaValor = IaValor + 1;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #caclipro#1 = aAux;

     ||Direccion
     IaValor = aValor1<-; IaValor = IaValor + 3;
     aAux = aValor; |QBF aAux;
     aDireccion = aAux;
     IaValor = aValor1<-; IaValor = IaValor + 4;
     aAux = aValor; |QBF aAux;
     |SI aAux ! "";
         aDireccion = aDireccion + ", " + aAux;
     |FINSI;
     aAlf1 = aDireccion; |HAZ MiraRaros; aDireccion = aAlf1;
     #caclipro#2 = aDireccion;

     ||Cod. Postal
     IaValor = aValor1<-; IaValor = IaValor + 5;
     nAux = aValor;

     aCP = ("00000" + nAux) % -105;
     aCP1 = aCP % 102;
     aCP2 = aCP % 303;
     #caclipro#3  = aCP1;
     #caclipro#4  = aCP2;
     #caclipro#25 = aCP;

     ||Provincia
     IaValor = aValor1<-; IaValor = IaValor + 9;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #caclipro#5 = aAux;

     ||Poblacion
     IaValor = aValor1<-; IaValor = IaValor + 6;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #caclipro#6 = aAux;

     ||Telefono
     IaValor = aValor1<-; IaValor = IaValor + 7;
     aAux = aValor; |QBT aAux;
     #caclipro#7 = aAux;

     ||CIF
     IaValor = aValor1<-; IaValor = IaValor + 2;
     aAux = aValor; |QBF aAux;
     #caclipro#9 = aAux;

     ||DIGITO CONTABLE
     IaValor = aValor1<-; IaValor = IaValor + 14;
     nAux = aValor;
     #caclipro#11 = nAux;

     ||CODIGO PAIS
     IaValor = aValor1<-; IaValor = IaValor + 12;
     aAux = aValor; |QBF aAux;
     #caclipro#24 = aAux;

     |GRABA 020#caclipro.a;
     |LIBERA #caclipro;
|FPRC;

|PROCESO CACUENTA;
     |DDEFECTO #cacuenta;
     #cacuenta#0 = aCuenta;
     |LEE 101#cacuenta.=;
     |SI FSalida ! 0; |GRABA 020#cacuenta.b; |FINSI;

     ||DIGITO CONTABLE
     IaValor = aValor1<-; IaValor = IaValor + 14;
     nAux = aValor;
     #cacuenta#1 = nAux;

     ||DESCRIPCION
     IaValor = aValor1<-; IaValor = IaValor + 1;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #cacuenta#2 = aAux;

     ||PASE S/N
     IaValor = aValor1<-; IaValor = IaValor + 16;
     aAux = aValor; |QBF aAux;
     #cacuenta#3 = aAux;

     #cacuenta#54 = #cacuenta#0;
     #cacuenta#55 = #cacuenta#1;

     |GRABA 020#cacuenta.a;
     |LIBERA #cacuenta;
|FPRC;

|PROCESO REGISNIF;
     |DDEFECTO #regisnif@;

     ||NIF
     IaValor = aValor1<-; IaValor = IaValor + 2;

     aNif = aValor;  |QBF aNif;
     |SI aNif = "";  |ACABA;  |FINSI;

     |DDEFECTO #regisnif@;
     #regisnif@#0 = aNif;
     |LEE 101#regisnif@.=;
     |SI FSalida ! 0; |GRABA 020#regisnif@.b; |FINSI;

     ||APELLIDOS Y NOMBRE
     IaValor = aValor1<-; IaValor = IaValor + 1;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#1 = aAux;

     ||DOMICILIO
     IaValor = aValor1<-; IaValor = IaValor + 3;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#2 = aAux;

     ||NUMERO
     IaValor = aValor1<-; IaValor = IaValor + 4;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#3 = aAux;

     ||CP
     #regisnif@#4 = aCP1;
     #regisnif@#5 = aCP2;

     ||POBLACION
     IaValor = aValor1<-; IaValor = IaValor + 6;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#6 = aAux;

     ||PROVINCIA
     IaValor = aValor1<-; IaValor = IaValor + 9;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#7 = aAux;

     ||TELEFONO
     IaValor = aValor1<-; IaValor = IaValor + 7;
     aAux = aValor; |QBT aAux;
     #regisnif@#8 = aAux;

     ||COD. PAIS
     IaValor = aValor1<-; IaValor = IaValor + 12;
     aAux = aValor; |QBF aAux;
     #regisnif@#12 = aAux;

     ||NOMBRE PAIS
     IaValor = aValor1<-; IaValor = IaValor + 13;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#13 = aAux;

     ||COD. COMUNIDAD
     IaValor = aValor1<-; IaValor = IaValor + 10;
     aAux = aValor; |QBF aAux;
     #regisnif@#14 = aAux;

     ||NOMBRE PAIS
     IaValor = aValor1<-; IaValor = IaValor + 11;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #regisnif@#15 = aAux;

     |GRABA 020#regisnif@.a;
     |LIBERA #regisnif@;
|FPRC;

|PROCESO CACUENTA_DIARIO;
     |DDEFECTO #cacuenta;
     #cacuenta#0 = aCuenta;
     |LEE 101#cacuenta.=;
     |SI FSalida ! 0; |GRABA 020#cacuenta.b; |FINSI;

     ||DIGITO CONTABLE
     IaValor = aValor1<-; IaValor = IaValor + 10;
     nAux = aValor;
     #cacuenta#1 = nAux;

     ||DESCRIPCION
     IaValor = aValor1<-; IaValor = IaValor + 7;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #cacuenta#2 = aAux;

     ||PASE S/N
     IaValor = aValor1<-; IaValor = IaValor + 16;
     aAux = aValor; |QBF aAux;
     #cacuenta#3 = aAux;

     ||CUENTA
     #cacuenta#54 = #cacuenta#0;
     #cacuenta#55 = #cacuenta#1;

     |GRABA 020#cacuenta.a;
     |LIBERA #cacuenta;
|FPRC;

|PROCESO CAMAASIL;
     IaValor = aValor1<-;
     nDiario = aValor;

     IaValor = aValor1<-; IaValor = IaValor + 1;
     aFechaDiario = aValor; |QBF aFechaDiario;

     IaValor = aValor1<-; IaValor = IaValor + 2;
     nDocumentoDiario = aValor;

     IaValor = aValor1<-; IaValor = IaValor + 3;
     nApunte = aValor;

     |DDEFECTO #camaasil;
     #camaasil#0 = nDiario;
     #camaasil#1 = aFechaDiario;
     #camaasil#2 = nDocumentoDiario;
     #camaasil#3 = nApunte;
     |LEE 101#camaasil.=;
     |SI FSalida ! 0; |GRABA 020#camaasil.b; |FINSI;

     #camaasil#4 = aCuenta;

     ||DIGITO
     IaValor = aValor1<-; IaValor = IaValor + 10;
     nAux = aValor;
     #camaasil#5 = nAux;

     ||CONCEPTO
     IaValor = aValor1<-; IaValor = IaValor + 11;
     nAux = aValor;
     #camaasil#6 = nAux;

     ||DESCRIPCION
     IaValor = aValor1<-; IaValor = IaValor + 4;
     aAux = aValor; |QBF aAux;
     aAlf1 = aAux; |HAZ MiraRaros; aAux = aAlf1;
     #camaasil#7 = aAux;

     ||SIGNO
     IaValor = aValor1<-; IaValor = IaValor + 12;
     aAux = aValor; |QBF aAux;
     #camaasil#8 = aAux;

     ||IMPORTE
     IaValor = aValor1<-; IaValor = IaValor + 13;
     nAux = aValor;
     #camaasil#9 = nAux;

     ||CUENTA HABER
     IaValor = aValor1<-; IaValor = IaValor + 15;
     aAux = aValor; |QBF aAux;
     #camaasil#10 = aAux;

     ||DIGITO HABER
     IaValor = aValor1<-; IaValor = IaValor + 10;
     aAux = aValor; |QBF aAux;
     #camaasil#11 = aAux;

     ||CUENTA DEBE
     IaValor = aValor1<-; IaValor = IaValor + 14;
     aAux = aValor; |QBF aAux;
     #camaasil#16 = aAux;

     ||DIGITO DEBE
     IaValor = aValor1<-; IaValor = IaValor + 10;
     aAux = aValor; |QBF aAux;
     #camaasil#17 = aAux;

     |SI #dscsvz14#8 = "S";
         ||REFERENCIA

         IaValor = aValor1<-; IaValor = IaValor + 5;
         aAux = aValor; |QBT aAux;
         #camaasil#26 = aAux;
     |FINSI;

     |GRABA 020#camaasil.a;
     |LIBERA #camaasil;
|FPRC;

|PROCESO FinalLinea;
     IaDato = aDato1<-;
     IaCamp = aCamp1<-;

     |SI aCuenta = "";
          |ACABA;
     |FINSI;

     |SI eaTipoCSV = "cuentas";
         |HAZ CACLIPRO;
         |HAZ CACUENTA;
         |HAZ REGISNIF;
     |FINSI;

     |SI eaTipoCSV = "diario";
         |HAZ CACUENTA_DIARIO;
         |HAZ CAMAASIL;
     |FINSI;
|FPRC;

|PROCESO Caracter;
     |SI aCar = aLF; |ACABA; |FINSI;
     |SI aCar = aCR;
          aValor = aDato;
          |SI eaTipoCSV = "diario"; |Y nLinea = 1;
               ||Nos saltamos la primera linea
          |SINO;
               |HAZ FinalLinea;
          |FINSI;
          nCampo = 0;
          aDato = "";
          IaValor = aValor1<-;
          |PARA i = 0; |SI i [ 250; |HACIENDO i = i + 1;
               aValor = "";
               IaValor = IaValor + 1;
          |SIGUE;
          IaValor = aValor1<-;
          aCuenta = "";
     |SINO;
          |SI aCar = aSeparador;
               |SI nCampo = 0; |Y eaTipoCSV = "cuentas";
                    aCuenta = aDato;
                    |QBF aCuenta;
               |FINSI;
               |SI nCampo = 6; |Y eaTipoCSV = "diario";
                    aCuenta = aDato;
                    |QBF aCuenta;
               |FINSI;

               aValor = aDato;
               IaValor = IaValor + 1;
               nCampo = nCampo + 1;
               aDato = "";
               |SI nCampo ] 250;
                     |MENAV "0000Se supera el maximo de campos (250)...";
                    nSal = 1;
               |FINSI;
          |SINO;
               aDato = aDato + aCar;
          |FINSI;
     |FINSI;
     || |PULSATECLA;
|FPRC;

|PROCESO LeeCSV1;
     nLinea = 0;
     aLF    = &13;
     aCR    = &10;
     nCampo = 0;
     aDato  = "";

     IaValor = aValor1<-;
     |XLEE nHandle, 250, aTmp;
     |PARA; |SI FSalida > 0; |HACIENDO;
             nLinea = nLinea + 1;
            |PARA; |SI aTmp ! ""; |HACIENDO;
                 aCar = aTmp % 101;
                 |SI aTmp = aCar;
                     aTmp = ""; ||con un caracter falla: "aTmp = aTmp % 2"
                 |SINO;
                     aTmp = aTmp % 2;
                 |FINSI;
                 |HAZ Caracter;
               |SI nSal ! 0; |SAL; |FINSI;
          |SIGUE;

          |XLEE nHandle, 250, aTmp;
          |SI nSal ! 0; |SAL; |FINSI;
     |SIGUE;

     |SI nSal = 0;
          |HAZ FinalLinea;
     |FINSI;
|FPRC;

|PROCESO Importacion1;
     |DBASS aBass;  |QBF aBass;

     eaCodNif = "";
     |HAZ LeeNifs;

     |ABRE #caclipro;
     |ABRE #cacuenta;
     |ABRE #regisnif@;
     |ABRE #cacuenta;
     |ABRE #camaasil;

     aSeparador = ";";
     nSal = 0;

     |QBF eaFicheroCSV;
     |SI eaFicheroCSV = "";  |ACABA;  |FINSI;

     ||Leo el fichero CSV y relleno los ficheros que le correspondan
     ||Ver documentacion en PDF para controlar los campos

     |XABRE "B", eaFicheroCSV, nHandle;
     |SI FSalida ] 0; FSalida = 0; |FINSI;
     |HAZ LeeCSV1;
     |XCIERRA nHandle;

     |CIERRA #caclipro;
     |CIERRA #cacuenta;
     |CIERRA #regisnif@;
     |CIERRA #cacuenta;
     |CIERRA #camaasil;
|FPRC;

|PROCESO GrabaIva;
     #dscsvw19#0  = nReg;

     |SI nCampo = 1;
         aFecha      = #dscsvw10#1;  |QBF aFecha;
         |HAZ CalculaFecha;
         #dscsvw19#1 = aFecha;
     |FINSI;

     |SI nCampo = 22;
         |SI #dscsvz14#8 = "N";
             #dscsvw19#2  = #dscsvw10#1;
         |FINSI;
     |FINSI;

     |SI nCampo = 0;   #dscsvw19#3  = #dscsvw10#1;  |FINSI;

     |SI nCampo = 2;   #dscsvw19#4  = #dscsvw10#1;  |FINSI;

     |SI nCampo = 3;
         aAlfa1       = #dscsvw19#4;  |QBF aAlfa1;
         aAlfa2       = #dscsvw10#1;  |QBF aAlfa2;
         #dscsvw19#4  = aAlfa1 + aAlfa2;

         |SI #dscsvz14#8 = "S";
             |QBT aAlfa2;
             #dscsvw19#2  = aAlfa2;
         |FINSI;
     |FINSI;

     |SI nCampo = 20;  #dscsvw19#5  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 23;  #dscsvw19#6  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 18;  #dscsvw19#7  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 13;  #dscsvw19#8  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 12;  #dscsvw19#9  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 24;  #dscsvw19#10 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 25;  #dscsvw19#11 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 15;  #dscsvw19#12 = #dscsvw10#1;  |FINSI;

     |SI nCampo = 4;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#13 = aAlfa;
     |FINSI;

     |SI nCampo = 5;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#14 = aAlfa;
     |FINSI;

     |SI nCampo = 6;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#15 = aAlfa;
     |FINSI;

     |SI nCampo = 7;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#16 = aAlfa;
     |FINSI;

     |SI nCampo = 8;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#17 = aAlfa;
     |FINSI;

     |SI nCampo = 26;  #dscsvw19#18 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 27;  #dscsvw19#19 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 28;  #dscsvw19#20 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 29;  #dscsvw19#21 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 30;  #dscsvw19#22 = #dscsvw10#1;  |FINSI;

     |SI nCampo = 9;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#23 = aAlfa;
     |FINSI;

     |SI nCampo = 10;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#24 = aAlfa;
     |FINSI;

     |SI nCampo = 11;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw19#25 = aAlfa;
     |FINSI;

     |SI nCampo = 31;   #dscsvw19#26 = #dscsvw10#1;  |FINSI;
|FPRC;

|PROCESO dscsvw10Carga;
     nCampo = #dscsvw10#0 - 1;

     |HAZ GrabaIva;
|FPRC;

|DEFBUCLE dscsvw10Carga;
     #dscsvw10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw10Carga;
|FIN;

|PROCESO dscsvw10Campos;
     nTCampos  = nTCampos + 1;
|FPRC;

|DEFBUCLE dscsvw10Campos;
     #dscsvw10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw10Campos;
|FIN;

|PROCESO GrabaDatos;
     |CIERRA #dscsvw10;
     nTCampos = 0;
     |BUCLE dscsvw10Campos;

     nError   = 0;
     nTValor  = nTotCmp;
     |SI nTCampos < nTValor;
         |DELINDEX #dscsvw10;
         |ACABA;
     |FINSI;

     nPorce = ((nTValor * 100) / nTCampos) ! 0;
     |SI nPorce < 70;
         |DELINDEX #dscsvw10;
         |ACABA;
     |FINSI;

     nReg = nReg + 1;
     |SI nReg = 1;
         |DELINDEX #dscsvw10;
         |ACABA;
     |FINSI;

     |DDEFECTO #dscsvw19;
     |BUCLE dscsvw10Carga;

     |SI #dscsvw19#3 = "R";  |O #dscsvw19#3 = "S";
         |GRABA 000#dscsvw19.n;
         |LIBERA #dscsvw19;
     |FINSI;

     |DELINDEX #dscsvw10;
     |PULSATECLA;
|FPRC;

|PROCESO Grabaw10;
     #dscsvw10#0 = nCmp;
     #dscsvw10#1 = aVar;
     |GRABA 020#dscsvw10.n;
     |LIBERA #dscsvw10;
|FPRC;

|PROCESO SacaDatos;
     aLong  = aLee % 0;
     nLong  = aLong;
     aC10   = &10;
     aC13   = &13;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac = aLee % nPos;

           |SI aCarac = aC13;
               aCarac = ";";
           |FINSI;

           |SI aCarac = ";";
               nCmp   = nCmp + 1;
               |HAZ Grabaw10;

               aVar   = "";
               aCarac = "";
           |FINSI;

           |SI aCarac = aC10;
               aCarac = "";
           |FINSI;

           |SI nCmp = nTotCmp;  |Y nCmp ! 0;
               |HAZ GrabaDatos;

               |ABRE #dscsvw10;

               nCmp = 0;
           |FINSI;

           aVar = aVar + aCarac;
      |SIGUE;
|FPRC;

|PROCESO LeeCSV;
     |ABRE #dscsvw10;

     nCmp  = 0;
     |XABRE "B", aAbre, nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 255, aLee;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          |HAZ SacaDatos;
     |SIGUE;
     |XCIERRA nHandle;

     |LEE 000#dscsvw10.p;
     |SI FSalida = 0;
         nCmp   = nCmp + 1;
         |HAZ Grabaw10;
         |HAZ GrabaDatos;
     |FINSI;

     |ABRE #dscsvw10; |CIERRA #dscsvw10; |DELINDEX #dscsvw10;
|FPRC;

|PROCESO dscsvw19Gra;
                             nLibro = 1;
     |SI #dscsvw19#3 = "S";  nLibro = 2;  |FINSI;

     |SI #dscsvw19#4 ! aAsiento;  |O #dscsvw19#1 ! fFecha;
         #camaniva#0 = nLibro;
         #camaniva#1 = 9999999999;
         |LEE 000#camaniva.];
         |SI FSalida = 0;
             |LEE 000#camaniva.a;
         |SINO;
             |LEE 000#camaniva.u;
         |FINSI;

         nDocu = 1;
         |SI FSalida = 0;  |Y #camaniva#0 = nLibro;
             nDocu = #camaniva#1 + 1;
         |FINSI;

         |DDEFECTO #camaniva;
         #camaniva#0  = nLibro;
         #camaniva#1  = nDocu;
         #camaniva#2  = "";
         #camaniva#3  = nDocu;
         #camaniva#4  = #dscsvw19#1;
         #camaniva#5  = #dscsvw19#5;
         #camaniva#6  = "N";
         #camaniva#8  = #dscsvw19#1;
         #camaniva#10 = #dscsvw19#6;
         #camaniva#12 = #dscsvw19#7;
         #camaniva#13 = #dscsvw19#8;
         #camaniva#14 = #dscsvw19#9;
         #camaniva#22 = #dscsvw19#2;
         #camaniva#27 = #dscsvw19#10;
         #camaniva#28 = #dscsvw19#11;
         #camaniva#29 = #dscsvw19#10;
         #camaniva#30 = #dscsvw19#11;
         #camaniva#36 = #dscsvw19#3;
         #camaniva#42 = #dscsvw19#12;
         #camaniva#19 = #dscsvw19#13;

         |GRABA 020#camaniva.n;
         |LIBERA #camaniva;

         nApun = 0;
     |FINSI;

     nApun = nApun + 1;

     |DDEFECTO #caivalin;
     #caivalin#0  = #camaniva#0;
     #caivalin#1  = #camaniva#1;
     #caivalin#2  = nApun;
     #caivalin#3  = #dscsvw19#10;
     #caivalin#4  = #dscsvw19#11;
     #caivalin#6  = #dscsvw19#13;
     #caivalin#7  = #dscsvw19#14;
     #caivalin#8  = #dscsvw19#15;
     #caivalin#9  = #dscsvw19#16;
     #caivalin#10 = #dscsvw19#17;
     #caivalin#12 = #dscsvw19#18;
     #caivalin#13 = #dscsvw19#19;
     #caivalin#14 = #dscsvw19#19;
     #caivalin#16 = #dscsvw19#20;
     #caivalin#18 = #dscsvw19#21;
     #caivalin#19 = #dscsvw19#22;
     #caivalin#20 = #dscsvw19#23;
     #caivalin#21 = #dscsvw19#24;
     #caivalin#22 = #dscsvw19#25;
     #caivalin#23 = #dscsvw19#26;

     |GRABA 020#caivalin.n;
     |LIBERA #caivalin;

     aAsiento    = #dscsvw19#4;
     fFecha      = #dscsvw19#1;
     nIRet       = 0;
|FPRC;

|DEFBUCLE dscsvw19Gra;
     #dscsvw19#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw19Gra;
|FIN;

|PROCESO camaasilBSinRef;
     |SI #camaasil#9 ! nImpor;
         |ACABA;
     |FINSI;

     |SI #camaasil#1 ! #camaniva#8;
         |ACABA;
     |FINSI;

     aAlfa = #camaasil#26;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     nDiario = #camaasil#0;
     fFecha  = #camaasil#1;
     nDocum  = #camaasil#2;

     |ERROR10;
|FPRC;

|DEFBUCLE camaasilBSinRef;
     #camaasil#3;
     ;
     #camaniva#12, "01.01.0000", 000000, 0000;
     #camaniva#12, "31.12.9999", 999999, 9999;
     ;
     NULL, camaasilBSinRef;
|FIN;

|PROCESO camaasilBConRef;
     |SI #camaniva#0 = 1;
         |SI nImpor1 > 0;
             |SI #camaasil#8 = "H";  |ACABA;  |FINSI;
         |SINO;
             |SI #camaasil#8 = "D";  |Y #camaasil#9 > 0;
                 |ACABA;
             |FINSI;

             |SI #camaasil#8 = "H";  |Y #camaasil#9 < 0;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #camaniva#0 = 2;
         |SI nImpor1 > 0;
             |SI #camaasil#8 = "D";  |ACABA;  |FINSI;
         |SINO;
             |SI #camaasil#8 = "H";  |Y #camaasil#9 < 0;
                 |ACABA;
             |FINSI;

             |SI #camaasil#8 = "D";  |Y #camaasil#9 > 0;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     nDiario = #camaasil#0;
     fFecha  = #camaasil#1;
     nDocum  = #camaasil#2;

     |ERROR10;
|FPRC;

|DEFBUCLE camaasilBConRef;
     #camaasil#6;
     4;
     #camaniva#22, "01.01.0000", #camaniva#12;
     #camaniva#22, "31.12.9999", #camaniva#12;
     ;
     NULL, camaasilBConRef;
|FIN;

|PROCESO camaasilGra;
     #camaasil#12 = #camaniva#36;
     #camaasil#13 = #camaniva#0;
     #camaasil#14 = #camaniva#3;
     #camaasil#15 = #camaniva#2;
     #camaasil#26 = #camaniva#22;

     |GRABA 020#camaasil.a;
     |LIBERA #camaasil;
|FPRC;

|DEFBUCLE camaasilGra;
     #camaasil#1;
     ;
     #camaasic#0, #camaasic#1, #camaasic#2, 0001;
     #camaasic#0, #camaasic#1, #camaasic#2, 9999;
     be;
     NULL, camaasilGra;
|FIN;

|PROCESO camaniva;
     nDiario = 0;
     fFecha  = "";
     nDocum  = 0;

     nImpor  = #camaniva#21;
     |SI nImpor < 0;  nImpor  = -#camaniva#21;  |FINSI;

     |SI #dscsvz14#8 = "N";
         |BUCLE camaasilBSinRef;
         |SI nDocum = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dscsvz14#8 = "S";
         nImpor1  = #camaniva#21;

         |BUCLE camaasilBConRef;
         |SI nDocum = 0;  |ACABA;  |FINSI;
     |FINSI;

     #camaasic#0 = nDiario;
     #camaasic#1 = fFecha;
     #camaasic#2 = nDocum;
     |LEE 101#camaasic.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #camaniva#7 = #camaasic#0;
     #camaniva#8 = #camaasic#1;
     #camaniva#9 = #camaasic#2;

     |SI #dscsvz14#8 = "N";
         aAlfa = ("00" + #camaasic#0) % -102;
         aAlfa = aAlfa + (#camaasic#1 % 102);
         aAlfa = aAlfa + (#camaasic#1 % 402);
         aAlfa = aAlfa + (#camaasic#1 % 704);
         aAlfa = aAlfa + ("000000" + #camaasic#2) % -106;

         #camaniva#22 = aAlfa;
     |FINSI;

     |BUCLE camaasilGra;

     #camaasic#17 = #camaniva#22;

     |GRABA 020#camaasic.a;
     |LIBERA #camaasic;

     |GRABA 020#camaniva.a;
     |LIBERA #camaniva;
|FPRC;

|DEFBUCLE camaniva;
     #camaniva#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, camaniva;
|FIN;

|PROCESO CreaIVA;
     aAbre = eaFicheroIVA;   |QBF aAbre;
     |SI aAbre = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     nTotCmp  = 33;

     |ABRE #dscsvw19;
     aTabla = "iva";
     |HAZ LeeCSV;
     |CIERRA #dscsvw19;
|FPRC;

|PROCESO camaasilCheq;
     |SI nPas = 0;
         |SI aCtaTot = "";
             aAlfa = #camaasil#4 % 103;
             |SI aAlfa = "400";  |O aAlfa = "410";
              |O aAlfa = "430";  |O aAlfa = "440";
                 aCtaTot = #camaasil#4;
             |FINSI;
         |FINSI;

         |SI aCtaBas = "";
             |SI #caivalin#6 = #camaasil#9;
                 aAlfa = #camaasil#4 % 101;
                 |SI aAlfa ! "4";  |Y aAlfa ! " ";
                     aCtaBas = #camaasil#4;  |QBF aCtaBas;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI aCtaIva = "";
             |SI #caivalin#8 = #camaasil#9;
                 aAlfa = #camaasil#4 % 103;
                 |SI aAlfa = "472";  |O aAlfa = "477";
                     aCtaIva = #camaasil#4;  |QBF aCtaIva;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nPas = 1;
         #camaasil#12 = #camaniva#36;
         #camaasil#13 = #camaniva#0;
         #camaasil#14 = #camaniva#3;
         #camaasil#15 = #camaniva#2;
         #camaasil#20 = 1;

                                     #camaasil#19 = "P";
         |SI aCtaBas = #camaasil#4;  #camaasil#19 = "B";  |FINSI;
         |SI aCtaIva = #camaasil#4;  #camaasil#19 = "I";  |FINSI;
         |SI aCtaTot = #camaasil#4;  #camaasil#19 = "F";  #camaasil#20 = 0;  |FINSI;

         |GRABA 020#camaasil.a;
         |LIBERA #camaasil;
     |FINSI;
|FPRC;

|DEFBUCLE camaasilCheq;
     #camaasil#1;
     ;
     #camaasic#0, #camaasic#1, #camaasic#2, 0001;
     #camaasic#0, #camaasic#1, #camaasic#2, 9999;
     be;
     NULL, camaasilCheq;
|FIN;

|PROCESO caivalinCheq;
     #camaniva#0 = #caivalin#0;
     #camaniva#1 = #caivalin#1;
     |LEE 000#camaniva.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #camaasic#0 = #camaniva#7;
     #camaasic#1 = #camaniva#8;
     #camaasic#2 = #camaniva#9;
     |LEE 000#camaasic.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aCtaTot = "";
     aCtaBas = "";
     aCtaIva = "";
     nPas = 0;  |BUCLE camaasilCheq;

     |SI aCtaTot ! "";  |Y aCtaBas = "";  |Y  aCtaIva = "";
         nPas = 1;  |BUCLE camaasilCheq;
     |FINSI;

     #caivalin#12 = aCtaBas;
     #caivalin#13 = aCtaIva;

     |GRABA 020#caivalin.a;
     |LIBERA #caivalin;
|FPRC;

|DEFBUCLE caivalinCheq;
     #caivalin#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, caivalinCheq;
|FIN;

|PROCESO JuntaIVA;
     |BUCLE dscsvw19Gra;

     |SI aModAsiento = "NO";
         aAlfa = "*:contagen/careccab canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "100";
     |SINO;
         aAlfa = "*:contagen/careccab canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "000";
     |FINSI;
     |SUB_EJECUTA aAlfa;

     aAlfa = "*:contagen/caz00023 canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CREA";
     |SUB_EJECUTA aAlfa;

     |ABRET #camaasic;
     |BUCLE camaniva;

     |ABRE #camaasic;  |SELECT #1#camaasic;
     |ABRE #camaniva;  |SELECT #1#camaniva;
     |BUCLE caivalinCheq;
     |CIERRAT #camaasic;
     |CIERRA #camaniva;
|FPRC;

|PROCESO RecalculosFinales;
     |ABRE #dscsvw19;  |CIERRA #dscsvw19;  |DELINDEX #dscsvw19;

     |SI aModAsiento = "NO";
         aAlfa = "*:contagen/careccab canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "100";
     |SINO;
         aAlfa = "*:contagen/careccab canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "000";
     |FINSI;
     |SUB_EJECUTA aAlfa;

     aAlfa = "*:contagen/caz00023 canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CREA";
     |SUB_EJECUTA aAlfa;

     |MENAV "0000Importaci¢n realizada. A continuaci¢n se van a realizar una serie de chequeos";

     |MENAV "0000Chequeo general de asientos";
     aAlfa = "*:contagen/cacheapu canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     |MENAV "0000Chequeo general de facturas";
     aAlfa = "*:contagen/caconiva canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     |MENAV "0000Chequeo cuentas de IVA";
     aAlfa = "*:contagen/cacheiva canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     |MENAV "0000Asistente de balances";
     aAlfa = "*:contagen/caut0009 canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     |MENAV "0000Recuperaci¢n de saldos";
     aAlfa = "*:contagen/carecupe canempr1 " + (("00000" + #48#2) % -105) + #48#3 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     |MENAV "0000Proceso terminado.";
|FPRC;

|PROCESO Conversion;
     |HAZ LeeUnidadBasico;

     eaBinarioConve = "cpostal.csv";       |HAZ TraeteBinario;
     eaBinarioConve = "pdftotext.exe";     |HAZ TraeteBinario;
     eaBinarioConve = "a3conta.exe";       |HAZ TraeteBinario;

     nDigiOrigen  = #dscsvz14#2;
     nDigiDestino = #dscsvz14#3;
     nOrden1      = #dscsvz14#5;
     nOrden2      = #dscsvz14#7;

     aNombre1       = "NO";
     eaFicheroDatos = #dscsvz14#0;
     |QBF eaFicheroDatos;
     |SI eaFicheroDatos ! "";
          eaNombreDatos = "1.pdf";
          |HAZ BorraFicheroDestino;
          aNombre1 = "1.pdf";
          |HAZ CopiaFicheroDatos;
     |FINSI;

     aNombre2       = "NO";
     eaFicheroDatos = #dscsvz14#1;
     |QBF eaFicheroDatos;
     |SI eaFicheroDatos ! "";
          eaNombreDatos = "2.xls";
          |HAZ BorraFicheroDestino;
          aNombre2 = "2.xls";
          |HAZ CopiaFicheroDatos;
     |FINSI;

     aNombre3       = "NO";
     eaFicheroDatos = #dscsvz14#4;
     |QBF eaFicheroDatos;
     |SI eaFicheroDatos ! "";
          eaNombreDatos = "3.xls";
          |HAZ BorraFicheroDestino;
          aNombre3 = "3.xls";
          |HAZ CopiaFicheroDatos;
     |FINSI;

     aNombre4       = "NO";
     eaFicheroDatos = #dscsvz14#6;
     |QBF eaFicheroDatos;
     |SI eaFicheroDatos ! "";
          eaNombreDatos = "4.xls";
          |HAZ BorraFicheroDestino;
          aNombre4 = "4.xls";
          |HAZ CopiaFicheroDatos;
     |FINSI;

     aPathDavid = aPathContagen + "a3\";   |RMKDIR aPathDavid;

     aBorra = aPathDavid + "1.csv";   |RFBORRA aBorra;
     aBorra = aPathDavid + "2.csv";   |RFBORRA aBorra;
     aBorra = aPathDavid + "3.csv";   |RFBORRA aBorra;
     aBorra = aPathDavid + "4.csv";   |RFBORRA aBorra;
     aFicheroLCK = aPathDavid + "fin_dsa3conttods.txt";  |RFBORRA aFicheroLCK;

     aEjecuta = aPathContagen + eaBinarioConve + " ";
     |SI aNombre1 ! "NO";
          aEjecuta = aEjecuta + aPathContagen + aNombre1 + " ";
     |SINO;
          aEjecuta = aEjecuta + aNombre1 + " ";
     |FINSI;

     |SI aNombre2 ! "NO";
          aEjecuta = aEjecuta + aPathContagen + aNombre2 + " ";
     |SINO;
          aEjecuta = aEjecuta + aNombre2 + " ";
     |FINSI;

     aEjecuta = aEjecuta + nDigiOrigen + " " + nDigiDestino + " ";
     aEjecuta = aEjecuta + aPathDavid + " ";

     |SI aNombre3 ! "NO";
          aEjecuta = aEjecuta + aPathContagen + aNombre3 + " " + nOrden1 + " ";
     |SINO;
          aEjecuta = aEjecuta + aNombre3 + " " + nOrden1 + " ";
     |FINSI;

     |SI aNombre4 ! "NO";
          aEjecuta = aEjecuta + aPathContagen + aNombre4 + " " + nOrden2;
     |SINO;
          aEjecuta = aEjecuta + aNombre4 + " " + nOrden2;
     |FINSI;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aEjecuta + &34;
     |RSYSTEM aAlfa;

     |PARA;  |SI;  |HACIENDO;
          |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
          |SIGUE;

          |XABRE "EC", aFicheroLCK, nHandle;
          |SI FSalida ] 0;
               |SAL;
          |FINSI;

          |PULSATECLA;
     |SIGUE;

     aOrigen = aPathDavid + "1.csv";
     aDestino = aPathTmp + "uno.csv";
     |SI eaIP = "";
          |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
          |RECIBE_FICHERO aOrigen, aDestino;
     |FINSI;
     #dscsvz10#0 = aDestino;

     aOrigen = aPathDavid + "2.csv";
     aDestino = aPathTmp + "dos.csv";
     |SI eaIP = "";
          |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
          |RECIBE_FICHERO aOrigen, aDestino;
     |FINSI;
     #dscsvz10#1 = aDestino;

     aOrigen = aPathDavid + "3.csv";
     aDestino = aPathTmp + "iva.csv";
     |SI eaIP = "";
          |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
          |RECIBE_FICHERO aOrigen, aDestino;
     |FINSI;
     #dscsvz10#2 = aDestino;

     aOrigen = aPathDavid + "4.csv";
     aDestino = aPathTmp + "iva2.csv";
     |SI eaIP = "";
          |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
          |RECIBE_FICHERO aOrigen, aDestino;
     |FINSI;
     #dscsvz10#3 = aDestino;
|FPRC;

|PROCESO Importacion;
     |HAZ Conversion;

     eaFicheroCSV = #dscsvz10#0;
     eaTipoCSV    = "cuentas";
     |HAZ Importacion1;

     eaFicheroCSV = #dscsvz10#1;
     eaTipoCSV = "diario";
     |HAZ Importacion1;

     aFicTmp = "dscsvw19" + Usuario;  |NOME_DAT #dscsvw19#aFicTmp#;
     |ABRE #dscsvw19;  |CIERRA #dscsvw19;  |DELINDEX #dscsvw19;

     nReg         = 0;
     eaFicheroIVA = #dscsvz10#2;
     eaModoImpo   = "ae3conta";
     eaRepeSopo   = "RE";
     |HAZ CreaIVA;

     eaFicheroIVA = #dscsvz10#3;
     eaModoImpo   = "ae3conta";
     eaRepeSopo   = "SO";
     |HAZ CreaIVA;

     |HAZ JuntaIVA;

     aModAsiento = "NO";
     |HAZ RecalculosFinales;
|FPRC;


|PROCESO Cancelar;
     |PTEC 807;
|FPRC;

|PROCESO ModAsiento;
     |FIN_CONTROL_WINDOWS nBtnUni;

     |SI aModAsiento = "SI";
         aModAsiento = "NO";
     |SINO;
         aModAsiento = "SI";
     |FINSI;

     aAlfa = "BOTON," + aModAsiento;
     |CONTROL_SIMPLE nPanta, aAlfa, 2916, 3019, ModAsiento; nBtnUni = FSalida;
|FPRC;

|PROCESO Instrucciones;
     |HAZ LeeUnidadBasico;

     eaNombrePDF = "dscsvz14";
     |HAZ MuestraPDF;
|FPRC;

|PROCESO NucleoDocA3Conta;
     nFSalida = FSalida;

     |ESTADO_CONTROL nBtnCar1, "DISABLE";
     |ESTADO_CONTROL nBtnCar2, "DISABLE";
     |ESTADO_CONTROL nBtnCar3, "DISABLE";
     |ESTADO_CONTROL nBtnCar4, "DISABLE";

     |HAZ MiniBrowse;

     |ESTADO_CONTROL nBtnCar1, "ENABLE";
     |ESTADO_CONTROL nBtnCar2, "ENABLE";
     |ESTADO_CONTROL nBtnCar3, "ENABLE";
     |ESTADO_CONTROL nBtnCar4, "ENABLE";
|FPRC;

|PROCESO DocA3ContaUno;
     |HAZ NucleoDocA3Conta;
     |SI aFicBrowse = "";  |ACABA;  |FINSI;
     #dscsvz14#0 = aFicBrowse;  |PINTA #dscsvz14#0;
|FPRC;

|PROCESO DocA3ContaDos;
     |HAZ NucleoDocA3Conta;
     |SI aFicBrowse = "";  |ACABA;  |FINSI;
     #dscsvz14#1 = aFicBrowse;  |PINTA #dscsvz14#1;
|FPRC;

|PROCESO DocA3ContaTres;
     |HAZ NucleoDocA3Conta;
     |SI aFicBrowse = "";  |ACABA;  |FINSI;
     #dscsvz14#4 = aFicBrowse;  |PINTA #dscsvz14#4;
|FPRC;

|PROCESO DocA3ContaCuatro;
     |HAZ NucleoDocA3Conta;
     |SI aFicBrowse = "";  |ACABA;  |FINSI;
     #dscsvz14#6 = aFicBrowse;  |PINTA #dscsvz14#6;
|FPRC;

|PROGRAMA;
     |LEE 000#camaasil.p;
     |SI FSalida = 0;
         |CONFI "0000NYa existe movimientos en esta empresa/periodo. Continuamos con la importaci¢n?";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SINO;
         |LEE 000#camaniva.p;
         |SI FSalida = 0;
             |MENAV "0000Ya existe movimientos de IVA en esta empresa/periodo. Cancelamos la importaci¢n";
             |ACABA;
         |FINSI;
     |FINSI;

     aTextoVentana = "Importaci¢n A3CONTA";
     |VENTANA 0501, 3599, -1, 16, aTextoVentana;
     n0Vent = FSalida;

     |PINPA #0#dscsvz14;  nPanta = FSalida;
     |PINDA #0#dscsvz14;

     aModAsiento = "NO";

     |CONTROL_SIMPLE nPanta, "LABEL,{{15}}Asientos e IVA", 3002, 3015, NULL;
     |CONTROL_SIMPLE nPanta, "LABEL,{{15}}se dejan modificables", 3021, 3040, NULL;

     aAlfa = "BOTON," + aModAsiento;
     |CONTROL_SIMPLE nPanta, aAlfa, 2916, 3019, ModAsiento; nBtnUni = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Instrucciones", 0585, 0599, Instrucciones;
     nBtnInfo = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 0785, 0787, DocA3ContaUno;
     nBtnCar1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1085, 1087, DocA3ContaDos;
     nBtnCar2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1685, 1687, DocA3ContaTres;
     nBtnCar3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 2285, 2287, DocA3ContaCuatro;
     nBtnCar4 = FSalida;

     |ENDATOS #1#dscsvz14;
     nFSalida = FSalida;

     |FIN_CONTROL_WINDOWS nBtnCar1;
     |FIN_CONTROL_WINDOWS nBtnCar2;
     |FIN_CONTROL_WINDOWS nBtnCar3;
     |FIN_CONTROL_WINDOWS nBtnCar4;

     |SI nFSalida = 0;
         |HAZ Importacion;
     |SINO;
         |MENAV "0000Proceso cancelado.";
     |FINSI;

     |FINVENTANA n0Vent;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     nChequeo = 1;
     eaIP     = "";  |IP_REMOTO eaIP;

     |HAZ LeeUnidadBasico;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\tmp";              |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\";

     |DBASE aBaseConta;
     aPathTmp   = aBaseConta + "tmp";           |MKDIR aPathTmp;
     aPathTmp   = aPathTmp   + "/" + Usuario;   |MKDIR aPathTmp;
     aPathTmp   = aPathTmp   + "/";

     aPathContagen = eaUnidadBasico + "\documentos";   |RMKDIR aPathContagen;
     aPathContagen = aPathContagen + "\contagen\";     |RMKDIR aPathContagen;

     aAlfa = aPathTmp + "cuentas.csv";       |FBORRA aAlfa;
     aAlfa = aPathTmp + "clientes.csv";      |FBORRA aAlfa;
     aAlfa = aPathTmp + "proveedores.csv";   |FBORRA aAlfa;
     aAlfa = aPathTmp + "asientos.csv";      |FBORRA aAlfa;
     aAlfa = aPathTmp + "codiva.csv";        |FBORRA aAlfa;
     aAlfa = aPathTmp + "iva.csv";           |FBORRA aAlfa;

     |ABRET #cacuenta;

     |HAZ inicio;

     |ABRET #caclipro;
     |ABRET #camaasic;
     |ABRET #camaasil;
     |ABRET #camaniva;
     |ABRET #caivalin;
     |ABRET #dsmom030;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     aAlfa = aPathTmp + "cuentas.csv";       |FBORRA aAlfa;
     aAlfa = aPathTmp + "clientes.csv";      |FBORRA aAlfa;
     aAlfa = aPathTmp + "proveedores.csv";   |FBORRA aAlfa;
     aAlfa = aPathTmp + "asientos.csv";      |FBORRA aAlfa;
     aAlfa = aPathTmp + "codiva.csv";        |FBORRA aAlfa;
     aAlfa = aPathTmp + "iva.csv";           |FBORRA aAlfa;

     |CIERRAT #cacuenta;
     |CIERRAT #caclipro;
     |CIERRAT #camaasic;
     |CIERRAT #camaasil;
     |CIERRAT #camaniva;
     |CIERRAT #caivalin;
     |CIERRAT #dsmom030;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;
