|FICHEROS;
   camocab2 #0;
   :/modelos/def/dsmom042;
   :/modelos/def/dsmom041;
   :/modelos/def/dsmom040;
   :/modelos/def/dsmom107;
|FIN;

|VARIABLES;
   &ref_am  = "";
   &fec_am  = @;
   &imp_am  = 0;
   &c_am    = "";
   &c_conp  = 0;
   &nLib_am = 0;
   &aSer_am = "";
   &nFra_am = 0;
   &nDoc_am = 0;
   &iva_am  = 0;
   &tiva_am = 0;

   alfa1 = "";
   xx = 0;
   yy = 0;
   nume1 = 0;
   sw_er = 0;
   any = "";
   estado = 0;
   linea = 0;
   impcom = 0;
   p = 0;
   &entrada = 1;
   &sw_lin = 0;
   sw = 0;
   long = 0;

   &enModAmor   = 0;
   nSwEncuentro = 0;
   &aElemento   = "";
   &nNumero     = 0;
   nLinea       = 0;

   aAlfa1 = "";
   impiva = 0;
   impcomA= 0;
   impcomI= 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE numamo_i;

|PROCESO Elinicio;
 |HAZ inicio;
 |HAZ DirAplicSt;
 |SI Haymodelo = 0;
     |MENAV "    Error.! No Existe Aplicacion MODELOS.";
     |PTEC 807;
 |SINO;
     alfa1 = aPModelo + "fich/";
     |PATH_DAT #dsmom041 #alfa1#;
     |PATH_DAT #dsmom042 #alfa1#;
     |PATH_DAT #dsmom040 #alfa1#;
     |PATH_DAT #dsmom107 #alfa1#;
     aMonedaA = eaMoneda;
     aMonedaC = aMonedaA;
     |HAZ LeeConversor;
     |SI enConverModelo ! 0;   ||Hay diferencia de Monedas
         |SI enRedonPaYaModelo ! 0;
             aMonedaC = "E";
         |SINO;
             aMonedaC = "P";
         |FINSI;
     |FINSI;
     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 041#dsmom107.p;
     |CIERRA #dsmom107;
 |FINSI;
|FPRC;

|| .... Calculos de los campos por pantalla.
|CALCULO numamo; |TIPO 6;
   x_entra = entrada;
   x_alfa1 = #camocab2#Campo#;
   |HAZ x_punto;
   #camocab2#Campo# = x_alfa1;
   |PINTA #camocab2#Campo#;
|FCAL;

|CALCULO tracodi; |TIPO 0;


  |CAMPO_MODIFICA #0#1, 1, "S";

  alfa1 = #0#0; |QBF alfa1;
  |SI alfa1 = ""; |ERROR; |ACABA; |FINSI;

  #dsmom041#0 = enEmpresa;
  #dsmom041#2 = #0#0;
  #dsmom041#3 = 01;
  |LEE 011#dsmom041.];
  |SI FSalida ! 0; |O #dsmom041#0 ! enEmpresa; |O #dsmom041#2 ! #0#0;
      |CAMPO_MODIFICA #0#1, 1, "N";
      #0#1 = 0; |PINTA #0#1;
  |SINO;
      #0#1 = #dsmom041#3; |PINTA #0#1;
  |FINSI;
|FCAL;


|CALCULO fecha_venta; |TIPO 0;
   #camocab2#23 = #camocab2#29;
   |PINTA #camocab2#23;
|FCAL;

|CALCULO Ptec816; |TIPO 7;
  alfa1 = #camocab2#Campo#; |QBT alfa1;
  |SI alfa1 = ""; #camocab2#Campo# = c_am; |PINTA #camocab2#Campo#; |FINSI;
  |SI eaSobreEs ! "S";
      |PTEC 816;
  |FINSI;
|FCAL;
|| ======================================================================

|PROGRAMA;
   |HAZ Elinicio;
   |SI enModAmor = 2;
       |HAZ BuscoFactura;
       |SI nSwEncuentro = 2;
           |PINPA #0#0;
           #0#0 = #dsmom041#2; |PINTA #0#0;
           #0#1 = #dsmom041#3; |PINTA #0#1;
           #0#2 = #dsmom041#4; |PINTA #0#21;
           |MENAV aAlfa1;
           |ACABA;
       |FINSI;
   |FINSI;

   |ABRET #dsmom041;
   |DDEFECTO #dsmom041;

 |ET empieza;
    |PINPA #0#0;
    |SI eaSubde = "S"; |Y #dsmom107#28 = "S";
        |PINTA 1256, "Act/Subdep.: ";
        |C_V #0#38,1,"S";
    |FINSI;

    |HAZ def_campos;
    |SI sw_er = 1;
       |CIERRAT #dsmom041;
       |ACABA;
    |FINSI;
    |PINDA #0#0;

    |ENDATOS #1#0;
    |SI FSalida = 0;
        |HAZ actualiza;
    |SINO;
        |SI nSwEncuentro = 0;
            |CONFI "2400SINTRODUCCION NO CONFORME. ¨ Elegir otro Elemento? ";
            |SI FSalida = 0;
                |VETE empieza;
            |FINSI;
        |FINSI;
    |FINSI;
    |CIERRAT #dsmom041;
|FPRO;

|PROCESO def_campos;
   |ET otro;
   |PINTA 1232, "    ";

   sw_er = 0;
   linea = 0;
   impcom = 0;
   |DDEFECTO #0;
   #camocab2#33 = enEmpresa;

   |SI nSwEncuentro ! 0;
       #0#0 = aElemento; |PINTA #0#0;
       #0#1 = nNumero;   |PINTA #0#1;
   |SINO;
       |ENCAMPO #0#0;
       |SI FSalida ! 0; sw_er = 1; |ACABA; |FINSI;
       |ENCAMPO #1#0;
       |SI FSalida ! 0; sw_er = 1; |ACABA; |FINSI;
   |FINSI;

   |DDEFECTO #dsmom041;
   #dsmom041#0 = enEmpresa;
   #dsmom041#2 = #camocab2#0;
   #dsmom041#3 = #camocab2#1;
   |LEE 011#dsmom041.=;
   estado = FSalida;
   |SI estado ! 0;
      |MENAV "0000El Elemento NO existe";
      sw_er = 2;
      nSwEncuentro = 0;
      |VETE otro;
   |SINO;
      |HAZ tracod2;
      |SI sw_er = 1; |ACABA; |FINSI;
      |SI sw_er = 2; |VETE otro; |FINSI;

      |SI enConverModelo ! 0;
          #dsmom041#10 = (#dsmom041#10 * enConverModelo ) ! enRedonModelo;
          #dsmom041#15 = (#dsmom041#15 * enConverModelo ) ! enRedonModelo;
          #dsmom041#16 = (#dsmom041#16 * enConverModelo ) ! enRedonModelo;
          #dsmom041#21 = (#dsmom041#21 * enConverModelo ) ! enRedonModelo;
          #dsmom041#22 = (#dsmom041#22 * enConverModelo ) ! enRedonModelo;
      |FINSI;

      #camocab2#2 = #dsmom041#4;
      #camocab2#3 = #dsmom041#5;
      #camocab2#4 = #dsmom041#6;
      |PARA xx = 5; |SI xx [ 23; |HACIENDO xx = xx + 1;
            yy = xx + 3;
           #camocab2#xx# = #dsmom041#yy#;
      |SIGUE;
      #camocab2#6  = #dsmom041#27;
      #camocab2#31 = #dsmom041#1;
      #camocab2#34 = #dsmom041#9;
      |SI eaSubde = "S"; |Y #dsmom107#28 = "S";
          #camocab2#38 = #dsmom041#54;
      |FINSI;
   |FINSI;

   #camocab2#23 = fec_am;

   #camocab2#24 = linea;
   any   = #camocab2#23 % -104; #camocab2#25 = any;
   #camocab2#26 = "V";
   #camocab2#27 = imp_am;
   #camocab2#28 = c_am;
   #camocab2#29 = fec_am;
   #camocab2#30 = "S";
   #camocab2#32 = c_conp;

   #camocab2#36 = tiva_am;
   #camocab2#37 = iva_am;
   |SI enEjercicio < 2017;
       alfa1   = (("00" + nLib_am) % -102) + "-" + (("0000000000" + nDoc_am) % -110) + " / ";
       |SI aSer_am ! "     ";
           alfa1   = alfa1 + aSer_am + "-" + (("000000" + nFra_am) % -106);
       |SINO;
           alfa1   = alfa1 + (("000000" + nFra_am) % -106);
       |FINSI;
   |SINO;
       alfa1 = ref_am;
   |FINSI;
   #camocab2#35 = alfa1;
   |SI estado ! 0;
       #camocab2#31 = enActividad;
       |SI eaSubde = "S"; |Y #dsmom107#28 = "S";
           #camocab2#38 = eaCodSubdep;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO actualiza;
   |SI enConverModelo ! 0;
          eaMoneda = aMonedaC; |HAZ Monedas;
          #camocab2#07 = (#camocab2#07 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab2#12 = (#camocab2#12 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab2#13 = (#camocab2#13 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab2#18 = (#camocab2#18 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab2#19 = (#camocab2#19 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab2#27 = (#camocab2#27 / enConverModelo ) ! enRedonPaYaModelo;
   |FINSI;

   #camocab2#23 = #camocab2#29;

   #dsmom041#26 = #camocab2#23;
   #dsmom041#40 = "I";
   #dsmom041#50 = #camocab2#35;
   #dsmom041#51 = #camocab2#36;
   #dsmom041#52 = #camocab2#37;
   #dsmom041#58 = 2;
   #dsmom041#63 = nLib_am;
   #dsmom041#64 = nDoc_am;
   #dsmom041#65 = aSer_am;
   #dsmom041#66 = nFra_am;
   #dsmom041#67 = #camocab2#27;

   |GRABA 011#dsmom041.a;
   |LIBERA #dsmom041;

   |ABRE #dsmom042;
   #dsmom042#0 = #dsmom041#0;
   #dsmom042#2 = #dsmom041#2;
   #dsmom042#3 = #dsmom041#3;
   #dsmom042#4 = #camocab2#24;
   |LEE 000#dsmom042.=;
   estado = FSalida;
   #dsmom042#0 = #dsmom041#0; #dsmom042#2 = #dsmom041#2;
   #dsmom042#3 = #dsmom041#3; #dsmom042#4 = #camocab2#24;
   #dsmom042#5 = #camocab2#25; #dsmom042#6 = #camocab2#26; #dsmom042#7 = #camocab2#27;
   #dsmom042#8 = #camocab2#30; #dsmom042#9 = #camocab2#29; #dsmom042#10 = #camocab2#28;
   #dsmom042#11 = #camocab2#27; #dsmom042#12 = #camocab2#32;
   #dsmom042#13 = 0;
   #dsmom042#14 = nLib_am;
   #dsmom042#15 = aSer_am;
   #dsmom042#16 = nFra_am;

   #dsmom042#1  = enActividad;
   |SI eaSubde = "S"; |Y #dsmom107#28 = "S";
       #dsmom042#18 = eaCodSubdep;
   |FINSI;

   |SI estado = 0;
      |GRABA 011#dsmom042.a;
      |LIBERA #dsmom042;
   |SINO;
      |GRABA 011#dsmom042.n;
      |LIBERA #dsmom042;
   |FINSI;
   |CIERRA #dsmom042;
   eaMoneda = aMonedaA; |HAZ Monedas;
|FPRC;

|PROCESO tracod2;  || Existe
   |SI nSwEncuentro = 0;
       |SI #dsmom041#26 > "01.01.1900";
           |MENAV "0000El Elemento Ya esta vendido. ";
           sw_er = 2;
           |ACABA;
       |FINSI;
       |HAZ lineas;
   |SINO;
       linea = nLinea;
       impcom = #dsmom041#10 - impcomA;
   |FINSI;
|FPRC;

|PROCESO vercom1;
   linea = #dsmom042#4;
|FPRC;

|DEFBUCLE vercom;
     #dsmom042#1;
     ;
     #dsmom041#0, #dsmom041#2, #dsmom041#3, 000;
     #dsmom041#0, #dsmom041#2, #dsmom041#3, 999;
     be;
     NULL, vercom1;
|FIN;

|PROCESO lineas;
   linea = 0;
   |BUCLE  vercom;
   linea = linea + 1;
|FPRC;

|RUTINA infA2;
   #dsmom041#0 = enEmpresa;
   #dsmom041#2 = "        ";
   #dsmom041#3 = 00;
|FRUT;

|RUTINA supA2;
   #dsmom041#0 = enEmpresa;
   #dsmom041#2 = "zzzzzzzz";
   #dsmom041#3 = 00;
|FRUT;

|CALCULO elsElements; |TIPO 6;
   |SI FSalida = 10;
      |ABRE #dsmom041;
      |CONSULTA_F_CLAVE #1#dsmom041,infA2,supA2;
      #camocab2#0 = #dsmom041#2; |PINTA #camocab2#0;
      |CIERRA #dsmom041;
      |ERROR;
   |FINSI;
|FCAL;


|| ******************************************************
|PROCESO Encuentro;
 |SI #dsmom042#9 ] fec1; |Y #dsmom042#9 [ fec2;
     nSwEncuentro = 1;
     aElemento    = #dsmom042#2;
     nNumero      = #dsmom042#3;
     nLinea       = #dsmom042#4;
     impcomA      = #dsmom042#7;
     impcomI      = #dsmom042#7;
     |ERROR10;
 |FINSI;
|FPRC;

|DEFBUCLE BuscoFact;
 #dsmom042#1;
 6,14,15,16;
 enEmpresa, "        ", 00, 001, "V", nLib_am, aSer_am, nFra_am;
 enEmpresa, "zzzzzzzz", 99, 999, "V", nLib_am, aSer_am, nFra_am;
 e;
 NULL, Encuentro;
|FIN;

|PROCESO BuscoFactura;
 impcomI = 0;
 nSwEncuentro = 0;
 |BUCLE BuscoFact;
 |SI nSwEncuentro = 1;
     |ABRE #dsmom041;
     #dsmom041#0 = enEmpresa;
     #dsmom041#2 = aElemento;
     #dsmom041#3 = nNumero;
     |LEE 001#dsmom041.=;
     |SI FSalida ! 0;
         nSwEncuentro = 0;
         |CIERRA #dsmom041;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom041;

     impcomI = (impcomI % #dsmom041#46) ! 2;
 |FINSI;
|FPRC;
