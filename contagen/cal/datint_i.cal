|FICHEROS;
     caivam03 #223,MANTE;
|FIN;

|VARIABLES;
     nEstado = 0;
     &enIn03  = 0;
     aAlfa1   = "";
     aAlfa2   = "";
     &enPerIntra = 0;
     nError      = 0;
     nSw         = 0;
     nNume1      = 0;
     nPara1      = 0;
     &eaTip349   = "";
     nContenido     = 0;
     nCampo1        = 0;
     nCampo2        = 0;
     nCampo3        = 0;
|FIN;

|INCLUYE dscont_i;

|PROCESO BajaIntra;
 |SI enIn03 = 1;
     aAlfa1 = "m03caiva";
     |NOME_DAT #223 aAlfa1;
 |FINSI;

 |ABRE #223;
 #223#0 = enLibro;
 #223#1 = enRegistro;
 |LEE 141#223=;
 |SI FSalida = 0;
     |BORRA 020#223a;
 |FINSI;
 |LIBERA #223;
 |CIERRA #223;
|FPRC;

|PROCESO Tipo0m03;  |TIPO 0;

  |SI FSalida = 2; |ACABA; |FINSI;

  |SI FSalida = 10;
      |PUSHV 0501 2380;
      |BLANCO 0715 2147;
      |CUADRO 0715 2147;

      |PINTA 0816, "00.- Anual";
      |PINTA 0916, "                               ";
      |PINTA 1016, "01.- Primer  Trimestre         ";
      |PINTA 1116, "02.- Segundo Trimestre         ";
      |PINTA 1216, "03.- Tercero Trimestre         ";
      |PINTA 1316, "04.- Cuarto  Trimestre         ";
      |PINTA 1416, "                               ";
      |PINTA 1516, "11.- Enero      17.- Julio     ";
      |PINTA 1616, "12.- Febrero    18.- Agosto    ";
      |PINTA 1716, "13.- Marzo      19.- Septiembre";
      |PINTA 1816, "14.- Abril      20.- Octubre   ";
      |PINTA 1916, "15.- Mayo       21.- Noviembre ";
      |PINTA 2016, "16.- Junio      22.- Diciembre ";
      |PAUSA;
      |POPV;

      |ERROR;
      |ACABA;

  |FINSI;

  nSw = 0;
  |SI #223#4 = 0;   nSw = 1; |FINSI;
  |SI #223#4 = 1;   nSw = 1; |FINSI;
  |SI #223#4 = 2;   nSw = 1; |FINSI;
  |SI #223#4 = 3;   nSw = 1; |FINSI;
  |SI #223#4 = 4;   nSw = 1; |FINSI;

  |SI enEjercicio > 2009;
     |SI #223#4 = 11;  nSw = 1;  |FINSI;
     |SI #223#4 = 12;  nSw = 1;  |FINSI;
     |SI #223#4 = 13;  nSw = 1;  |FINSI;
     |SI #223#4 = 14;  nSw = 1;  |FINSI;
     |SI #223#4 = 15;  nSw = 1;  |FINSI;
     |SI #223#4 = 16;  nSw = 1;  |FINSI;
     |SI #223#4 = 17;  nSw = 1;  |FINSI;
     |SI #223#4 = 18;  nSw = 1;  |FINSI;
     |SI #223#4 = 19;  nSw = 1;  |FINSI;
     |SI #223#4 = 20;  nSw = 1;  |FINSI;
     |SI #223#4 = 21;  nSw = 1;  |FINSI;
     |SI #223#4 = 22;  nSw = 1;  |FINSI;
  |FINSI;

  |SI nSw = 0;
      |MENAV "0000Periodo incorrecto.";
      |ERROR;
      |ACABA;
  |FINSI;

|| ........ |PROCESO NoIgual;
  #223#8 = 0;

  |SI enEjercicio [ 2009;  || ... calculo anterior

     |SI #223#4 = enPerIntra; |Y #223#5 = enEjercicio;
         |CONFI "    SRectificacion en el Periodo y Ejercicio Actual. Continuar";
         |SI FSalida ! 0;
             |ERROR;
         |SINO;
             #223#8 = 1;
         |FINSI;
     |SINO;
         nError = 0;
         |SI #223#5 > enEjercicio; nError = 1; |FINSI;
         |SI #223#5 = enEjercicio; |Y #223#4 > enPerIntra; nError = 1; |FINSI;
         |SI nError = 1;
             |MENAV "    Error Periodo superior al Actual";
             |ERROR;
         |FINSI;
      |FINSI;

   |SINO;

      |SI #223#5 = enEjercicio;    ||Trabajos en el mismo ejercicio
          nError = 0;
          |SI #223#4 = 0; nError = 1; |FINSI;
          |SI #223#4 > 0; |Y #223#4 [ 4;  ||Trimestres
              |SI #223#4 = 1;
                  |SI enPerIntra = 1; |O enPerIntra = 2; |O enPerIntra = 3; nError = 1; |FINSI;
              |FINSI;
              |SI #223#4 = 2;
                  |SI enPerIntra = 4; |O enPerIntra = 5; |O enPerIntra = 6; nError = 1; |FINSI;
                  |SI enPerIntra < 4; nError = 2; |FINSI;
              |FINSI;
              |SI #223#4 = 3;
                  |SI enPerIntra = 7; |O enPerIntra = 8; |O enPerIntra = 9; nError = 1; |FINSI;
                  |SI enPerIntra < 7; nError = 2; |FINSI;
              |FINSI;
              |SI #223#4 = 4;
                  |SI enPerIntra = 10; |O enPerIntra = 11; |O enPerIntra = 12; nError = 1; |FINSI;
                  |SI enPerIntra < 10; nError = 2; |FINSI;
              |FINSI;
         |FINSI;
         |SI #223#4 ] 11;
             nNume1 = #223#4 - 10;
             |SI enPerIntra = nNume1; nError = 1; |FINSI;
             |SI enPerIntra < nNume1; nError = 2; |FINSI;
         |FINSI;
         |SI nError = 1;
             |CONFI "    SRectificacion en el Periodo y Ejercicio Actual. Continuar";
             |SI FSalida ! 0;
                |ERROR;
            |SINO;
                #223#8 = 1;
            |FINSI;
         |FINSI;
         |SI nError = 2;
             |MENAV "    Error Periodo superior al Actual";
             |ERROR;
         |FINSI;
      |SINO;
         |SI #223#5 > enEjercicio;
             |MENAV "    Error Periodo superior al Actual";
             |ERROR;
         |FINSI;
      |FINSI;

  |FINSI;
|FPRC;

|PROCESO TotalIva;
     nContenido = Contenido;
     |SI nContenido = #223Campo;  |ACABA;  |FINSI;

     |C_M #223Campo, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI Campo = 9;  |O Campo = 10;  nCampo1 = 9;   nCampo2 = 10;  nCampo3 = 11;  |FINSI;
     |SI Campo = 12; |O Campo = 13;  nCampo1 = 12;  nCampo2 = 13;  nCampo3 = 14;  |FINSI;
     |SI Campo = 15; |O Campo = 16;  nCampo1 = 15;  nCampo2 = 16;  nCampo3 = 17;  |FINSI;
     |SI Campo = 18; |O Campo = 19;  nCampo1 = 18;  nCampo2 = 19;  nCampo3 = 20;  |FINSI;
     |SI Campo = 21; |O Campo = 22;  nCampo1 = 21;  nCampo2 = 22;  nCampo3 = 23;  |FINSI;
     |SI Campo = 24; |O Campo = 25;  nCampo1 = 24;  nCampo2 = 25;  nCampo3 = 26;  |FINSI;
     |SI Campo = 27; |O Campo = 28;  nCampo1 = 27;  nCampo2 = 28;  nCampo3 = 29;  |FINSI;

     #223nCampo3 = #223nCampo1 % #223nCampo2;
     |PINTA #223nCampo3;

     |SI eaTip349 = "AR"; |O eaTip349 = "IR";
         #223#6 = #223#9 + #223#12 + #223#15 + #223#18 + #223#21 + #223#24 + #223#27;
         |PINTA #223#6;
     |FINSI;
|FPRC;

|PROCESO AltaIntra;

 |SI enIn03 = 1;
     aAlfa1 = "m03caiva";
     |NOME_DAT #223 aAlfa1;
 |FINSI;

 |PUSHV 07482280;

 |PUSHV 13482280;
 |PINPA #0#223;
 |SI eaTip349 ! "AR"; |Y eaTip349 ! "IR";
     |POPV;
     |PINTA 1348, "읕컴컴컴컴컴컴컴컴컴컴컴컴켸";
 |FINSI;

 |ABRE #223;
 |DDEFECTO #223;
 #223#0 = enLibro;
 #223#1 = enRegistro;
 |LEE 101#223=;
 nEstado = FSalida;
 #223#0 = enLibro;
 #223#1 = enRegistro;
 #223#2 = eaSerie;
 #223#3 = enFactura;

 aAlfa1 = "S"; aAlfa2 = "N";
 |SI eaTip349 = "AR"; |O eaTip349 = "IR";
     aAlfa1 = "N"; aAlfa2 = "S";
 |FINSI;
 |C_M #223#6, 1, aAlfa1;
 |PARA nPara1 = 9; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
       |C_M #223nPara1, 1, aAlfa2;
       |C_V #223nPara1, 1, aAlfa2;
 |SIGUE;

 |PINDA #0#223;
 |ENDATOS #2#223;
 |SI FSalida = 0;
     |SI eaTip349 ! "AR"; |Y eaTip349 ! "IR";  #223#9 = #223#6;  |FINSI;
     |SI nEstado = 0; |GRABA 020#223a; |FINSI;
     |SI nEstado ! 0; |GRABA 020#223n; |FINSI;
 |FINSI;
 |LIBERA #223;
 |CIERRA #223;

 |SI eaTip349 = "AR"; |O eaTip349 = "IR";
     |POPV;
 |FINSI;
 |POPV;
|FPRC;
