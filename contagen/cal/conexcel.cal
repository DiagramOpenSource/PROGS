|FICHEROS;
  conexcel #0;

  cacuenta@#11;

  cacuent1@#1;
  cacuent2@#2;
  cacuent3@#3;
  cacuent4@#4;
  cacuent5@#5;
  cacuent6@#6;
  cacuent7@#7;
  cacuent8@#8;
  cacuent9@#9;
  cacuent0@#10;

  canempre@#30;
|FIN;

|VARIABLES;
  aAlfa    = "";
  aFichero = "";
  nHandle  = 0;

  aParam   = "";
  aParam1  = "";
  auto     = 0;
  mante    = 0;
  nSwMulti = 0;
  &enSwErEx= 0;

  aDirDef  = "";
  aDirFich = "";
  aDef0    = "";
  aDef1    = "";
  aDef2    = "";
  aDef3    = "";
  aDef4    = "";
  aDef5    = "";
  aDef6    = "";
  aDef7    = "";
  aDef8    = "";
  aDef9    = "";
  aDef30   = "";

  nEmp     = 0;
  nPer     = 0;
  nNom     = 0;
  nInkey   = 0;

  alfa1 = "";
  alfa2 = "";
  alfa3 = "";
  alfa4 = "";
  alfa7 = "";
  alfa8 = "";
  i          = 0;
  j          = 0;
  n          = 0;
  hoja       = "";
  nombrehoja = "Hoja";
  dempre     = "";

  UsandoDLL = 0;
  tmp_i     = 0;
  hora1     = "";
  hora2     = "";
  E_FILA    = "F";
  E_COLUMNA = "C";

  ultima_linea = 0;
  trobada = 0;
  nivel = 0;
  nn = 0;
  pempre = 0;
  alfax = "";
  letra = "";
  mihoja = "";
  negativo = 0;
  saldo = 0;
  superior = 0;
  limite1 = "";
  limite2 = "";
  dir_excel = "Excel.EXE";
  {-1}pp = 0;
  &con_co_excel = "";
  jj = 0;
  plasmar = 0;
  iniformula = "";
  finformula = "";
  f_ini = 0;
  c_ini = 0;
  f_fin = 0;
  c_fin = 0;
  elsigno = 0;
  no_hay_nada = 0;
  campo_saldo = 53;
  ppp = 0;
  me_lo_sumas = 0;
  punto_int = 0;
  punto_no_int = 0;
  punto_fin_int = 0;
  cuentae = 0;
  alfax1 = "";
  alfax2 = "";
|FIN;

|INCLUYE dscont_i;

|| ***************************************************************************
|PROCESO EsMulti;
 |C_M #0Campo,0,alfa1;
 |SI alfa1 = "N"; |ACABA; |FINSI;

 alfa1 = "S";
 |SI #0Campo = "S"; alfa1 = "N"; |FINSI;
 |PARA j = 3; |SI j [ 30; |HACIENDO j = j + 3;
       nPer = j + 1;
       nNom = j + 2;
       |C_M #0j, 1, alfa1;
       |C_M #0nPer, 1, alfa1;
       |SI alfa1 = "N";
           #0j    = 0;  |PINTA #0j;
           #0nPer = 0;  |PINTA #0nPer;
           #0nNom = ""; |PINTA #0nNom;
       |FINSI;
 |SIGUE;
|FPRC;

|PROCESO cons;|TIPO 66;
  |C_M #0Campo,0,alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  |ABRE #30;
  nEmp = Campo;
  nPer = Campo + 1;
  nNom = Campo + 2;
  #30#2 = #0nEmp;
  #30#3 = #0nPer;
  |CONSULTA_CLAVE #3#30;
  |SI FSalida ] 0;
        #0Campo = #30#2; |PINTA #0Campo;
        #0nPer  = #30#3; |PINTA #0nPer;
        #0nNom  = #30#1; |PINTA #0nNom;
  |SINO;
        |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO perio;|TIPO 7;
  |C_M #0Campo,1,"S";
  nEmp = Campo - 1;
  nNom = Campo + 1;
  |SI #0nEmp = 0;
      |C_M #0Campo,1,"N";
      #0nNom = ""; |PINTA #0nNom;
 |FINSI;
|FPRC;

|PROCESO inf30;
 #30#2 = 00001;
 #30#3 = 0;
|FPRC;

|PROCESO sup30;
 #30#2 = 99999;
 #30#3 = 9;
|FPRC;

|PROCESO ConsultaEmp;
  |ABRE #30;
  #30#2 = #0nEmp;
  #30#3 = #0nPer;
  |CONSULTA_F_CLAVE #1#30, inf30, sup30;
  |CIERRA #30;
  #0nEmp = #30#2; |PINTA #0nEmp;
  #0nPer = #30#3; |PINTA #0nPer;
|FPRC;

|PROCESO descri;|TIPO 0;
  nInkey = FSalida;
  |C_M #0Campo, 0, alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  nEmp = Campo - 1;
  nPer = Campo;
  nNom = Campo + 1;

  |SI nInkey = 10;
      |HAZ ConsultaEmp;
  |FINSI;

  |ABRE #30;
  #30#2 = #0nEmp;
  #30#3 = #0nPer;
  |LEE 010#30=;
  |SI FSalida ! 0;
      |MENAV "    Error!. No existe Empresa";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #30;

  #0nNom = #30#1; |PINTA #0nNom;
|FPRC;


|| ************************************************************************

|PROCESO acumula;
   alfa7 = #cacuenta@#0;
   |QBF alfa7;
   ppp = (A\ alfa7 % 0);
   |SI ppp < nivel;|O ppp > superior;
       |ACABA;
   |FINSI;
   |SI punto_int > 0;
       ppp = punto_no_int * 100 + 1;
       |PARA;|SI ppp [ punto_fin_int;|HACIENDO ppp = ppp + 100;
           alfa7 = alfa2 % ppp;
           alfa8 = #cacuenta@#0 % ppp;
           |SI alfa7 ! "?";|Y alfa7 ! alfa8;
               |ACABA;
           |FINSI;
       |SIGUE;
   |FINSI;
   |SI me_lo_sumas = 1;
       |PARA ppp = 11;|SI ppp [ campo_saldo;|HACIENDO ppp = ppp + 3;
           saldo = saldo + #cacuenta@#ppp#;
       |SIGUE;
   |SINO;
       saldo = saldo + #cacuenta@#campo_saldo#;
   |FINSI;
|FPRC;

|PROCESO acumular;
  |DDEFECTO #cacuenta@;
  #cacuenta@#0 = limite1;
  #cacuenta@#1 = 0; || intentamos obviar el digito de control
  |LEE 010#cacuenta@.];
  |PARA;|SI FSalida = 0;|Y #cacuenta@#0 ] limite1;|Y #cacuenta@#0 [ limite2;|HACIENDO;
        |LEE 111#cacuenta@.=;
        |HAZ acumula;
        |LIBERA #cacuenta@;
        #cacuenta@#1 = 0;
        |LEE 010#cacuenta@.>;
  |SIGUE;
|FPRC;

|PROCESO LaCuenta;
  elsigno = 0
  alfa1 = alfa2 % 201;
  |SI alfa1 = "$";   || Quitar signo
      alfa1 = alfa2 % 101;
      |SI alfa1 = "+";
          elsigno = 1;
      |FINSI;
      |SI alfa1 = "-";
          elsigno = 2;
      |FINSI;
      alfa2 = alfa2 % 399;
  |FINSI;

  alfa1 = alfa2 % 101;
  |SI alfa1 = "-"; || Negativo?
      negativo = -1;
      alfa2 = alfa2 % 299;
  |SINO;
      negativo = 1;
  |FINSI;

  alfa1 = alfa2 % 102;
  me_lo_sumas = 0;
  |SI alfa1 = "D.";|O alfa1 = "H."
      |SI alfa1 = "D."
          campo_saldo = 9;
      |SINO;
          campo_saldo = 10;
      |FINSI;
      alfa2 = alfa2 % 399;
  |SINO;
      campo_saldo = 11;
  |FINSI;

  alfa1 = alfa2 % 101;
  alfax1 = alfa2 % 201;
  alfax2 = alfa2 % 301;
  |SI alfax1 = ".";|Y alfa1 ] "0";|Y alfa1 [ "9";
      alfa2 = alfa2 % 299;
      |SI alfa1 = "0";
          alfa1 = "M";
      |SINO;
          alfa1 = &(N\ 64 + alfa1 );
      |FINSI;
  |SINO;
      |SI alfax2 = ".";|Y alfa1 ] "0";|Y alfa1 [ "1";|Y alfax1 ] "0";|Y alfax1 [ "9";
          alfax1 = alfa1 + alfax1;   || alfax1 + alfa1;estaba al reves
          |SI alfax1 [ "12"
              alfa1 = &(N\ 64 + alfax1 );
          |SINO;
              alfa1 = "L";
          |FINSI;
          alfa2 = alfa2 % 399;
      |FINSI;
  |FINSI;

  |SI alfa1 ] "a";|Y alfa1 [ "l";
      campo_saldo = ((&alfa1 - 97) * 3) + 3 + campo_saldo;
  |SINO;
      |SI alfa1 ] "A";|Y alfa1 [ "L";
          me_lo_sumas = 1;
          campo_saldo = ((&alfa1 - 65) * 3) + 3 + campo_saldo;
      |SINO;
          |SI alfa1 ! "M";|Y alfa1 ! "m";
              campo_saldo = campo_saldo + 42;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI alfa1 ! "?"
      |SI alfa1 < "0";|O alfa1 > "9";
          alfa2 = alfa2 % 299;
      |FINSI;
  |FINSI;
  |QBF alfa2;

  nivel = (A\ alfa2 % 0);
  Ipp = dig3<-;
  superior = 0;
  |PARA j = 0;|SI j < dig3;|HACIENDO j = j + 1;
        Ipp = Ipp + 1;
        |SI nivel = pp;
            superior = nivel;
            |SAL;
        |FINSI;
        |SI superior = 0;|Y nivel < pp;
            superior = pp;
        |FINSI;
  |SIGUE;

  |SI #0i ! 0;
      |DDEFECTO #cacuenta@;
      #cacuenta@#0 = alfa2;
      alfax = #cacuenta@#0;
      #cacuenta@#1 = 0;
      |LEE 010#cacuenta@.];
      |SI FSalida ! 0;|O #cacuenta@#0 ! alfax;
          #cacuenta@#2 = "Sin definir "+#cacuenta@#0;
          FSalida = -1;
      |FINSI;
  |FINSI;



  |SI #0i ! 0;
     punto_int = 0;
     punto_no_int = 0;
     punto_fin_int = nivel * 100 + 1;
     |PARA ppp = 101;|SI ppp [ punto_fin_int;|HACIENDO ppp = ppp + 100;
           alfa7 = alfa2 % ppp;
           |SI alfa7 = "?";
               punto_int = (ppp-1) / 100;
               punto_no_int = punto_int + 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI j < dig3;|Y punto_int = 0;
         |SI me_lo_sumas = 1;
             saldo = 0;
             |PARA ppp = 11;|SI ppp [ campo_saldo;|HACIENDO ppp = ppp + 3;
                   saldo = saldo + #cacuenta@#ppp#;
             |SIGUE;
         |SINO;
             saldo = #cacuenta@#campo_saldo#;
         |FINSI;
     |SINO;
         || Hay que acumular !!!
         saldo = 0;
         || nivel superior inmediato
         |SI superior = 0;
             superior = nivel;
         |FINSI;

         |SI punto_int > 0;
             j = superior - punto_int + 1;
             |SI punto_int = 1;
                 limite1 = "";
                 limite2 = "";
             |SINO;
                 limite1 = alfa2 % (N\100+punto_int-1);
                 limite2 = alfa2 % (N\100+punto_int-1);
             |FINSI;
             limite1 = limite1 + "0" * j + "                 ";
             limite1 = limite1 % 112;

             limite2 = limite2 + "9" * j + "                 ";
             limite2 = limite2 % 112;
         |SINO;
             j = superior - nivel;
             limite1 = alfa2 + "0" * j + "                 ";
             limite1 = limite1 % 112;
             limite2 = alfa2 + "9" * j + "                 ";
             limite2 = limite2 % 112;
         |FINSI;
         |HAZ acumular;
         || ********************
     |FINSI;
     saldo = saldo * negativo;
     |SI elsigno = 1;
         |SI saldo < 0;
             saldo = 0;
         |FINSI;
     |SINO;
         |SI elsigno = 2;
             |SI saldo > 0;
                 saldo = 0;
             |SINO;
                 saldo = saldo * -1;
             |FINSI;
         |FINSI;
     |FINSI;
  |FINSI;

  |SI #0i ! 0;
      alfa1 = saldo;
  |SINO;
      alfa1 = "";
  |FINSI;

|FPRC;

|PROCESO Imprimir;
   |SI nSwMulti = 1;
       #0#3 = enEmpresa;
       #0#4 = enPeriodo;
       |PARA nEmp = 6; |SI nEmp [ 30; |HACIENDO nEmp = nEmp + 3;
             nPer = nEmp + 1;
             #0nEmp = 0;
             #0nPer = 0;
       |SIGUE;
   |FINSI;

   |CARGADLL "agixl97.dll";
   |SI FSalida < 0;
      |MENAV "0000No se puede usar agixl97.dll";
      enSwErEx = 1;
      |ACABA;
   |FINSI;

   alfa1 = #0#0; |QBF alfa1;
   n          = (A\ alfa1 % 0);
   hoja       = "";
   nombrehoja = "";

   |PARA i = 1;|SI i [ n;|HACIENDO i = i + 1;
         j = i * 100 + 1;
         alfa2 = alfa1 % j;
         |SI alfa2 = ","
             i = i + 1;
             |PARA; |SI i [ n;|HACIENDO i = i + 1;
                    j = i * 100 + 1;
                    alfa2 = alfa1 % j;
                    nombrehoja = nombrehoja + alfa2;
             |SIGUE;
             |SAL;
         |FINSI;
         hoja = hoja + alfa2;
   |SIGUE;

   dempre = aDirFich;

   |QBF hoja;
   |QBF nombrehoja;

   alfa2 = #0#1;
   |QBF alfa2;
   |SI nSwMulti = 1;
       alfa2 = alfa2 + aParam1;
   |FINSI;

   alfa4 = hoja;
   |ALFACALLDLL "agixl97.dll","carga_book",alfa4;
   |SI alfa4 = hoja;
        FSalida = -1;
   |SINO;
        |ALFACALLDLL "agixl97.dll","fichero_destino",alfa2; || fichero de trabajo
        alfa4 = nombrehoja; || si es "" seleccionara la activa
        |ALFACALLDLL "agixl97.dll","selecciona_hoja",alfa4;
        FSalida = 0;
   |FINSI;


   |SI FSalida ] 0;

      |SI #0#3 ! 0;
          alfa4 = dempre + (( "00000" + #0#3 + #0#4 ) % -106) + "/";
          |PATH_DAT #cacuent1@ #alfa4#;
          |ABRET #cacuent1@;
      |FINSI;
      |SI #0#6 ! 0;
          alfa4 = dempre + (( "00000" + #0#6 + #0#7 ) % -106) + "/";
          |PATH_DAT #cacuent2@ #alfa4#;
          |ABRET #cacuent2@;
      |FINSI;
      |SI #0#9 ! 0;
          alfa4 = dempre + (( "00000" + #0#9 + #0#10 ) % -106) + "/";
          |PATH_DAT #cacuent3@ #alfa4#;
          |ABRET #cacuent3@;
      |FINSI;
      |SI #0#12 ! 0;
         alfa4 = dempre + (( "00000" + #0#12 + #0#13 ) % -106) + "/";
         |PATH_DAT #cacuent4@ #alfa4#;
         |ABRET #cacuent4@;
      |FINSI;
      |SI #0#15 ! 0;
          alfa4 = dempre + (( "00000" + #0#15 + #0#16 ) % -106) + "/";
          |PATH_DAT #cacuent5@ #alfa4#;
          |ABRET #cacuent5@;
      |FINSI;
      |SI #0#18 ! 0;
          alfa4 = dempre + (( "00000" + #0#18 + #0#19 ) % -106) + "/";
          |PATH_DAT #cacuent6@ #alfa4#;
          |ABRET #cacuent6@;
      |FINSI;
      |SI #0#21 ! 0;
          alfa4 = dempre + (( "00000" + #0#21 + #0#22 ) % -106) + "/";
          |PATH_DAT #cacuent7@ #alfa4#;
          |ABRET #cacuent7@;
      |FINSI;
      |SI #0#24 ! 0;
          alfa4 = dempre + (( "00000" + #0#24 + #0#25 ) % -106) + "/";
          |PATH_DAT #cacuent8@ #alfa4#;
          |ABRET #cacuent8@;
      |FINSI;
      |SI #0#27 ! 0;
          alfa4 = dempre + (( "00000" + #0#27 + #0#28 ) % -106) + "/";
          |PATH_DAT #cacuent9@ #alfa4#;
          |ABRET #cacuent9@;
      |FINSI;
      |SI #0#30 ! 0;
          alfa4 = dempre + (( "00000" + #0#30 + #0#31 ) % -106) + "/";
          |PATH_DAT #cacuent0@ #alfa4#;
          |ABRET #cacuent0@;
      |FINSI;


      || |ALFACALLDLL "agixl97.dll","ejecuta_macro",alfa2;

      |PINTA 2223,">                      <";

      |PARA;|SI;|HACIENDO;

             alfa2 = "&*";
             |ALFACALLDLL "agixl97.dll","busca_dato",alfa2;
             |SI alfa2 = ""; |O alfa2 = "&*"; |O FSalida < 0;
                 |SAL;
             |FINSI;

             || |PINTA 501,alfa2;

             alfa3 = alfa2 % 101;
             alfa4 = alfa2 % 201;
             alfa1 = alfa2 % 301;
          |SI alfa4 ] "0";|Y alfa4 [ "9";|Y alfa3 = "&";
              |SI alfa1 = "!";|O alfa1 = "&";
                 |SI alfa4 = 0;
                     i = 30;
                 |SINO;
                     i = ((N\alfa4) * 3);
                 |FINSI;

                 j = i + 1;
                 |SI #0i ! 0;
                     |ABRE #30;
                     |DDEFECTO #30;
                     |PINTA 2224, "                    ";
                     |PINTA 2225, alfa2;
                     #30#2 = #0i;
                     #30#3 = #0j;
                     |LEE 010#30=;
                     |SI FSalida = 0;  ||por que ! ????
                         dig1 = #30#11;       || desde mes
                         dig3 = #30#13;       || nro. niveles
                         dig4 = #30#14;       || 1 nivel
                         dig5 = #30#15;       || 2 nivel
                         dig6 = #30#16;       || 3 nivel
                         dig7 = #30#17;       || 4 nivel
                         dig8 = #30#18;       || 5 nivel
                         dig9 = #30#19;       || 6 nivel

                         |SI alfa4 = 1; cacuenta@ = cacuent1@; |FINSI;
                         |SI alfa4 = 2; cacuenta@ = cacuent2@; |FINSI;
                         |SI alfa4 = 3; cacuenta@ = cacuent3@; |FINSI;
                         |SI alfa4 = 4; cacuenta@ = cacuent4@; |FINSI;
                         |SI alfa4 = 5; cacuenta@ = cacuent5@; |FINSI;
                         |SI alfa4 = 6; cacuenta@ = cacuent6@; |FINSI;
                         |SI alfa4 = 7; cacuenta@ = cacuent7@; |FINSI;
                         |SI alfa4 = 8; cacuenta@ = cacuent8@; |FINSI;
                         |SI alfa4 = 9; cacuenta@ = cacuent9@; |FINSI;
                         |SI alfa4 = 0; cacuenta@ = cacuent0@; |FINSI;

                         alfa3 = alfa2 % 4;
                         |QBF alfa3;
                         |SI alfa1 = "&";
                             |SI alfa3 > 0;|Y alfa3 < 6;|| Periodo

                             |SINO;                     || Nombre de la cuenta

                                  alfa1 = "No hay nombre";

                             |FINSI;
                         |SINO;
                             alfa2 = alfa3;
                             |HAZ LaCuenta;
                             || |PINTA 601,alfa1;
                         |FINSI;
                    |SINO;
                         alfa1 = "";
                    |FINSI;
                    |CIERRA #30;
                 |SINO;
                     |PINTA 2224, "                    ";
                     |PINTA 2225, alfa2;
                    alfa1 = "";
                 |FINSI;
                 |ALFACALLDLL "agixl97.dll","reemplaza_dato",alfa1;
                 |SI FSalida < 0;
                     cuentae = cuentae + 1;
                 |SINO;
                     cuentae = 0;
                 |FINSI;

              |FINSI;
          |FINSI;
      |SIGUE;

      || |ALFACALLDLL "agixl97.dll","ejecuta_macro",alfa2;

      |SI #0#3 ! 0;  |CIERRAT #cacuent1@; |FINSI;
      |SI #0#6 ! 0;  |CIERRAT #cacuent2@; |FINSI;
      |SI #0#9 ! 0;  |CIERRAT #cacuent3@; |FINSI;
      |SI #0#12 ! 0; |CIERRAT #cacuent4@; |FINSI;
      |SI #0#15 ! 0; |CIERRAT #cacuent5@; |FINSI;
      |SI #0#18 ! 0; |CIERRAT #cacuent6@; |FINSI;
      |SI #0#21 ! 0; |CIERRAT #cacuent7@; |FINSI;
      |SI #0#24 ! 0; |CIERRAT #cacuent8@; |FINSI;
      |SI #0#27 ! 0; |CIERRAT #cacuent9@; |FINSI;
      |SI #0#30 ! 0; |CIERRAT #cacuent0@; |FINSI;

      |SI #0#2 ! "N";|Y #0#2 ! "n";
          alfa4 = "imprime";
      |SINO;
          alfa4 = "";
      |FINSI;
      |ALFACALLDLL "agixl97.dll","fin_book",alfa4;

  |FINSI;
  |DESCARGADLL "agixl97.dll";

|FPRC;
|| **************************************************************************
|PROCESO LaPantalla;
      |PINPA #0#0;

      |PINTA 0502, "                                                             ";
      |ATRI R;
      |PINTA 0502, "Obtener Hoja Excel con Datos de Contabilidad ";
      |ATRI 0;
|FPRC;

|PROGRAMA;
  aParam = PARAMETRO; |QBF aParam;

  nSwMulti = 0;
  |SI aParam ! ""; |Y aParam ! "MANTE";
      alfa1 = aParam % 501;
      |SI alfa1 = "E";
          aParam1   = aParam % -106;
          alfa1 = aParam1 % 105;  enEmpresa = alfa1;
          alfa1 = aParam1 % -101; enPeriodo = alfa1;
          nSwMulti  = 1;
          aParam = aParam % 104;
      |SINO;
          |HAZ inicio;
      |FINSI;
  |FINSI;

  |DBASE aDirDef;
  aDirFich = aDirDef + "fich/";
  aDirDef  = aDirDef + "def/";

  alfa1 = aDirDef + "cacuenta";
  aDef1 = alfa1;
  |CARGA_DEF alfa1,cacuent1@;
  |SI FSalida < 0;
      |MENAV "0000Para esta opcion debe tener instalado el programa de CONTABILIDAD";
      aDef1 = "";
      |ACABA;
  |FINSI;

  |CARGA_DEF alfa1,cacuent2@; aDef2 = alfa1;
  |CARGA_DEF alfa1,cacuent3@; aDef3 = alfa1;
  |CARGA_DEF alfa1,cacuent4@; aDef4 = alfa1;
  |CARGA_DEF alfa1,cacuent5@; aDef5 = alfa1;
  |CARGA_DEF alfa1,cacuent6@; aDef6 = alfa1;
  |CARGA_DEF alfa1,cacuent7@; aDef7 = alfa1;
  |CARGA_DEF alfa1,cacuent8@; aDef8 = alfa1;
  |CARGA_DEF alfa1,cacuent9@; aDef9 = alfa1;
  |CARGA_DEF alfa1,cacuent0@; aDef0 = alfa1;

  alfa1  = aDirDef + "canempre";
  aDef30 = alfa1;
  |CARGA_DEF alfa1,canempre@;
  |SI FSalida < 0;
      |MENAV "0000Para esta opcion debe tener instalado el programa de CONTABILIDAD";
      aDef30 = "";
      |HAZ Descargar;
      |ACABA;
  |FINSI;

  |PATH_DAT #30 aDirFich;

  enSwErEx= 0;
  auto  = 0;
  mante = 0;
  |ABRET #conexcel;

  |SI aParam ] "0000";|Y aParam [ "9999";
      #0#33 = aParam;
      |LEE 010#0=;
      |SI FSalida = 0;
          auto  = 1;
          |SI nSwMulti = 1; #0#35 = "S"; |FINSI;
      |SINO;
          |SI nSwMulti = 1;
              enSwErEx= 1;
              |MENAV "    Error.! No existe la Definicion de la Hoja Excell. Proceso Abortado";
              |HAZ Descargar;
              |ACABA;
          |FINSI;
      |FINSI;
  |FINSI;
  |SI aParam = "MANTE";
      mante = 1;
  |FINSI;

  |SI auto = 1;
      |SI nSwMulti = 0;
          |CLS;
          |CABEZA "Balance Excel";
          |HAZ LaPantalla;
          |PINDA #0#0;
      |FINSI;
      FSalida = 0;
  |SINO;
      |SI mante = 1;
          |MANTE #0;
          FSalida = "-1";
      |SINO;
          |CLS;
          |CABEZA "Balance Excel";
          |HAZ LaPantalla;
          |LEE 010#0p;
          |SI FSalida = 0;
              |CONSULTA_CLAVE #2#0;
          |SINO;
               FSalida = 0;
          |FINSI;
          |SI FSalida ] 0;
              |PINDA #0#0;
              |ENDATOS #1#0;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI FSalida ] 0;
      |SI #0#35 = "S"; nSwMulti = 1; |FINSI;
      |HAZ Imprimir;
  |FINSI;

  |CIERRAT #conexcel;
  |HAZ Descargar;
|FPRO;

|PROCESO TrasCod; |TIPO 7;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "conexz01.mas";
   |XABRE "E", aAlfa, nHandle;
   |SI FSalida ] 0;
      |C_M #conexcel#35, 1, "N";
      #conexcel#35 = "N"; |PINTA #conexcel#35;
   |FINSI;
|FPRC;

|PROCESO Descargar;
 |SI aDef30 ! ""; |DESCARGA_DEF #canempre@; aDef30 = ""; |FINSI;
 |SI aDef0  ! ""; |DESCARGA_DEF #cacuent0@; aDef0  = ""; |FINSI;
 |SI aDef9  ! ""; |DESCARGA_DEF #cacuent9@; aDef9  = ""; |FINSI;
 |SI aDef8  ! ""; |DESCARGA_DEF #cacuent8@; aDef8  = ""; |FINSI;
 |SI aDef7  ! ""; |DESCARGA_DEF #cacuent7@; aDef7  = ""; |FINSI;
 |SI aDef6  ! ""; |DESCARGA_DEF #cacuent6@; aDef6  = ""; |FINSI;
 |SI aDef5  ! ""; |DESCARGA_DEF #cacuent5@; aDef5  = ""; |FINSI;
 |SI aDef4  ! ""; |DESCARGA_DEF #cacuent4@; aDef4  = ""; |FINSI;
 |SI aDef3  ! ""; |DESCARGA_DEF #cacuent3@; aDef3  = ""; |FINSI;
 |SI aDef2  ! ""; |DESCARGA_DEF #cacuent2@; aDef2  = ""; |FINSI;
 |SI aDef1  ! ""; |DESCARGA_DEF #cacuent1@; aDef1  = ""; |FINSI;
|FPRC;
