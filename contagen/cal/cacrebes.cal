|FICHEROS;
   cacrebes #00;   || def de datos
   caagrupa #01;   || agrupaciones
   cacuebal #02;   || cuentas de balance
   caepigra #03;   || epigrafes
   caparbal #04;   || partidas de balance
   caparexp #05;   || partidas de explotacion
   cacuenta #06;   || cuentas
|FIN;

|VARIABLES;
   &entrada = 1;
   &sw_conase4 = 1;
   vari1="rb  ";
   vari2="wb  ";
   fiche="";
   handle="";
   canal= "";
   espacio=" ";
   traba="";
   traba1 = "";
   saber = "";
   menos=-1;
   num = 0;
   field = 0;
   sw_vale = 0;
   FEstado = 0;
   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   para1 = 0;
   para2 = 0;
   para3 = 0;
   para4 = 0;
   pepe = 0;
   temporal1 = "";
   temporal2 = "";

   ceros   = "000000000000000";
   blancos = "                                                       ";
   elefe = "";
   ceerre = "";

   contenido = "";
   final = "";
   varalfa = "";
   alfa6 = "";
   alfa7 = "";
   alfa8 = "";
   alfa9 = "";
   alfa10 = "";
   alfa11 = "";
   alfa12 = "";
   alfa13 = "";
   alfa14 = "";
   alfa15 = "";
   alfa16 = "";
   nuevos = "";
   sw_existen = 0;
|FIN;

|INCLUYE dscont_i;

|| ==================== Datos pantalla

|PROCESO tipo8; |TIPO 8;
 |HAZ inicio;
|| |SI enEjercicio ] 2008;
||     |MENAV "    Ejercicio ] 2008, no corresponde estas estructuras";
||     |PTEC 807;
|| |FINSI;
|FPRC;

|PROCESO cuadro; |TIPO 7;
   |PUSHV 1010 1664;
   |CUADRO 1010 1663;
   |ATRI R;
   |PINTA 1111, " (E) Pasar los Ficheros de Balances de Esta Empresa ";
   |PINTA 1211, " a secuenciales para recogerlos en otra Empresa.    ";
   |PINTA 1311, "----------------------------------------------------";
   |PINTA 1411, " (I) Crear los Ficheros de Balance en Esta Empresa  ";
   |PINTA 1511, " a partir de los seleccionados.                     ";
   |ATRI r;
|FPRC;

|PROCESO repon; |TIPO 0;
   |POPV;
|FPRC;

|PROCESO minus; |TIPO 0;
   alfa1 = #0Campo < " ";
   #0Campo = alfa1;
   |PINTA #0Campo;
   |SI #0Campo [ "   ";
      |ERROR;
      |ACABA;
   |FINSI;
   |ATRI I;
   |PINTA 1524, #0Campo;
   |PINTA 1540, #0Campo;
   |PINTA 1640, #0Campo;
   |PINTA 1556, #0Campo;
   |PINTA 1656, #0Campo;
   |ATRI 0;

   |SI #0#1 = "E";
      |SI #0#0 = "amp"; |O #0#0 = "abr";
         |MENAV "    Extension de los Standard de AGICONT. ";
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|| =======================================================================
|PROCESO primer;
   elefe = &010;
   || ceerre = &013;
   || elefe = ceerre + elefe;
|FPRC;

|PROCESO tipo3;  |TIPO 3;
   |SI #0#2 = "N"; |ACABA; |FINSI;


   |QBF fich_alta;
   |SI fich_alta = "";
      |DFICE fich_alta;
   |FINSI;

   |SI #0#1 = "I";
      |HAZ creacion;   || agrupaciones, epigrafes, partidas y cuentas bal.
      |SI sw_existen = 1;
         |SUB_EJECUTA_NP  "carecepi.tab";
      |SINO;
         |MENAV "    NO EXISTEN FICHEROS INDICADOS ";
      |FINSI;
   |SINO;
      |HAZ copiarlos;
   |FINSI;
|FPRC;
|| *********************************************************************

|PROCESO gra_agrupa;
   varalfa = "";
   alfa6 = #caagrupa#0 + blancos;
   alfa6 = alfa6 % 101;
   alfa7 = blancos + #caagrupa#1;
   alfa7 = alfa7 % -102;
   alfa8 = #caagrupa#2 + blancos;
   alfa8 = alfa8 % 140;

   varalfa = varalfa + alfa6 + alfa7 + alfa8;
   contenido = handle + espacio + varalfa + elefe;
   |FGRABA contenido;

   saber = "Grabando Agrupacion: " + #caagrupa#0 + " " + #caagrupa#1 + "                  ";
   |PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_agrupa;
   #1#1;
   ;
   " ", 00;
   "z", 99;
   be;
   NULL, gra_agrupa;
|FIN;

|PROCESO gra_epigra;
   varalfa = "";
   alfa6 = #caepigra#0 + blancos;
   alfa6 = alfa6 % 101;
   alfa7 = blancos + #caepigra#1;
   alfa7 = alfa7 % -102;
   alfa8 = #caepigra#2 + blancos;
   alfa8 = alfa8 % 140;
   alfa9 = blancos + #caepigra#3;
   alfa9 = alfa9 % -102;
   alfa10 = #caepigra#4 + blancos;
   alfa10 = alfa10 % 140;

   varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9 + alfa10;
   contenido = handle + espacio + varalfa + elefe;
   |FGRABA contenido;

   saber = "Grabando Epigrafe: " + #caepigra#0 + "  " + #caepigra#1 + " " + #caepigra#3 + "        ";
   |PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_epigra;
   #3#1;
   ;
   " ", 00, 00;
   "z", 99, 99;
   be;
   NULL, gra_epigra;
|FIN;

|PROCESO gra_parbal;
   varalfa = "";
   alfa6 = #caparbal#0 + blancos;
   alfa6 = alfa6 % 101;
   alfa7 = blancos + #caparbal#1;
   alfa7 = alfa7 % -102;
   alfa8 = #caparbal#2 + blancos;
   alfa8 = alfa8 % 140;
   alfa9 = blancos + #caparbal#3;
   alfa9 = alfa9 % -102;
   alfa10 = #caparbal#4 + blancos;
   alfa10 = alfa10 % 140;
   alfa11 = blancos + #caparbal#5;
   alfa11 = alfa11 % -102;
   alfa12 = #caparbal#6 + blancos;
   alfa12 = alfa12 % 140;

   varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9;
   varalfa = varalfa + alfa10 + alfa11 + alfa12;

   contenido = handle + espacio + varalfa + elefe;
   |FGRABA contenido;

   saber = "Gra. Partidas Balance: " + #caparbal#0 + "  " + #caparbal#1 + " " + #caparbal#3 + " " + #caparbal#5 + "       ";
   |PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_parbal;
   #4#1;
   ;
   " ", 00, 00, 00;
   "z", 99, 99, 99;
   be;
   NULL, gra_parbal;
|FIN;

|PROCESO gra_parexp;
   varalfa = "";
   alfa6 = blancos + #caparexp#0;
   alfa6 = alfa6 % -101;
   alfa7 = #caparexp#1 + blancos;
   alfa7 = alfa7 % 101;
   alfa8 = blancos + #caparexp#2;
   alfa8 = alfa8 % -102;
   alfa9 = #caparexp#3 + blancos;
   alfa9 = alfa9 % 140;
   alfa10 = blancos + #caparexp#4;
   alfa10 = alfa10 % -102;
   alfa11 = #caparexp#5 + blancos;
   alfa11 = alfa11 % 140;
   alfa12 = blancos + #caparexp#6;
   alfa12 = alfa12 % -102;
   alfa13 = #caparexp#7 + blancos;
   alfa13 = alfa13 % 140;

   varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9;
   varalfa = varalfa + alfa10 + alfa11 + alfa12 + alfa13;

   contenido = handle + espacio + varalfa + elefe;
   |FGRABA contenido;

   saber = "Gra. Partidas Explotacion: " + #caparexp#0 + "  " + #caparexp#1 + " " + #caparexp#2 + " " + #caparexp#4 + " " + #caparexp#6;
   |PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_parexp;
   #5#1;
   ;
   0, " ", 00, 00, 00;
   9, "z", 99, 99, 99;
   be;
   NULL, gra_parexp;
|FIN;

|PROCESO gra_cuebal;
   varalfa = "";
   alfa6 = #cacuebal#0 + blancos;
   alfa6 = alfa6 % 112;
   alfa7 = blancos + #cacuebal#1;
   alfa7 = alfa7 % -101;
   alfa8 = #cacuebal#2 + blancos;
   alfa8 = alfa8 % 101;
   alfa9 = blancos + #cacuebal#3;
   alfa9 = alfa9 % -102;
   alfa10 = blancos + #cacuebal#4;
   alfa10 = alfa10 % -102;
   alfa11 = blancos + #cacuebal#5;
   alfa11 = alfa11 % -102;

   varalfa = varalfa + alfa6 + alfa7 + alfa8 + alfa9;
   varalfa = varalfa + alfa10 + alfa11;

   contenido = handle + espacio + varalfa + elefe;
   |FGRABA contenido;

   saber = "Grabando Cuenta de Balance: " + #cacuebal#0 + "           ";
   |PINTA 2211,saber;
|FPRC;

|DEFBUCLE c_cuebal;
   #2#1;
   ;
   "            ";
   "zzzzzzzzzzzz";
   be;
   NULL, gra_cuebal;
|FIN;

|PROCESO copiarlos;
   |HAZ primer;
   nuevos = "." + #0#0; ||Extension de los ficheros
   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";

   || ....................................... agrupaciones
   alfa4 = "agrupaci"; |SI enEjercicio ] 2008; alfa4 = "agrupa08"; |FINSI;
   fiche=vari2 + dir_fich + alfa4;
   fiche = fiche + nuevos;
   |QBF fiche;
   |FABRE fiche;
   handle = FSalida;
   |SI FSalida ] 0;
      |BUCLE c_agrupa;
   |FINSI;
   FSalida = handle;
   |FCIERRA FSalida;
   Pos = -1;
   || ....................................... epigrafes
   alfa4 = "epigrafe"; |SI enEjercicio ] 2008; alfa4 = "epigra08"; |FINSI;
   fiche=vari2 + dir_fich + alfa4;
   fiche = fiche + nuevos;
   |QBF fiche;
   |FABRE fiche;
   handle = FSalida;
   |SI FSalida ] 0;
      |BUCLE c_epigra;
   |FINSI;
   FSalida = handle;
   |FCIERRA FSalida;
   Pos = -1;
   || ....................................... Partidas Balance
   alfa4 = "parbalan"; |SI enEjercicio ] 2008; alfa4 = "parbal08"; |FINSI;
   fiche=vari2 + dir_fich + alfa4;
   fiche = fiche + nuevos;
   |QBF fiche;
   |FABRE fiche;
   handle = FSalida;
   |SI FSalida ] 0;
      |BUCLE c_parbal;
   |FINSI;
   FSalida = handle;
   |FCIERRA FSalida;
   Pos = -1;
   || ....................................... Partidas Explotacion
   alfa4 = "parexplo"; |SI enEjercicio ] 2008; alfa4 = "parexp08"; |FINSI;
   fiche=vari2 + dir_fich + alfa4;
   fiche = fiche + nuevos;
   |QBF fiche;
   |FABRE fiche;
   handle = FSalida;
   |SI FSalida ] 0;
      |BUCLE c_parexp;
   |FINSI;
   |FCIERRA FSalida;
   FSalida = handle;
   Pos = -1;
   || ....................................... Cuentas a Estructura
   alfa4 = "cuebalan"; |SI enEjercicio ] 2008; alfa4 = "cuebal08"; |FINSI;
   fiche=vari2 + dir_fich + alfa4;
   fiche = fiche + nuevos;
   |QBF fiche;
   |FABRE fiche;
   handle = FSalida;
   |SI FSalida ] 0;
      |BUCLE c_cuebal;
   |FINSI;
   |FCIERRA FSalida;
   FSalida = handle;
   Pos = -1;
|FPRC;

|| ************************************************************************

|PROCESO creacion;
|| ... Abrimos uno para ver que existen.
   nuevos = "." + #0#0; ||Extension de los ficheros
   sw_existen = 0;
   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";
   alfa4 = "agrupaci"; |SI enEjercicio ] 2008; alfa4 = "agrupa08"; |FINSI;
   fiche=vari1 + dir_fich + alfa4;
   fiche = fiche + nuevos;
   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      sw_existen = 1;
   |FINSI;
   |FCIERRA handle;
   |SI sw_existen = 0; |ACABA; |FINSI;

   || ...... Procesos de creacion
   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";

   |PATH_DAT #caagrupa #fich_alta#;
   |ABRE #1;
   |CIERRA #1;
   |DELINDEX #1;

   |ABRE #1;
   alfa4 = "agrupaci"; |SI enEjercicio ] 2008; alfa4 = "agrupa08"; |FINSI;
   fiche=vari1 + dir_fich + alfa4;
   fiche = fiche + nuevos;

   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seagru;
      |PARA; |SI field > 0; |HACIENDO;
         |HAZ seagru;
      |SIGUE;
      |FCIERRA handle;
   |FINSI;
   |CIERRA #1;
   Pos = menos;

   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";

   |PATH_DAT #cacuebal #fich_alta#;
   |ABRE #2;
   |CIERRA #2;
   |DELINDEX #2;
   |ABRE #2;
   alfa4 = "cuebalan"; |SI enEjercicio ] 2008; alfa4 = "cuebal08"; |FINSI;
   fiche=vari1 + dir_fich + alfa4;
   fiche = fiche + nuevos;

   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      |HAZ secueb;
      |PARA; |SI field > 0; |HACIENDO;
         |HAZ secueb;
      |SIGUE;
      |FCIERRA handle;
   |FINSI;
   |CIERRA #2;
   Pos = menos;

   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";
   |PATH_DAT #caepigra #fich_alta#;
   |ABRE #3;
   |CIERRA #3;
   |DELINDEX #3;
   |ABRE #3;
   alfa4 = "epigrafe"; |SI enEjercicio ] 2008; alfa4 = "epigra08"; |FINSI;
   fiche=vari1 + dir_fich + alfa4;
   fiche = fiche + nuevos;

   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seepig;
      |PARA; |SI field > 0; |HACIENDO;
         |HAZ seepig;
      |SIGUE;
      |FCIERRA handle;
   |FINSI;
   |CIERRA #3;
   Pos = menos;

   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";
   |PATH_DAT #caparbal #fich_alta#;
   |ABRE #4;
   |CIERRA #4;
   |DELINDEX #4;
   |ABRE #4;
   alfa4 = "parbalan"; |SI enEjercicio ] 2008; alfa4 = "parbal08"; |FINSI;
   fiche=vari1 + dir_fich + alfa4;
   fiche = fiche + nuevos;

   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      |HAZ sebala;
      |PARA; |SI field > 0; |HACIENDO;
         |HAZ sebala;
      |SIGUE;
      |FCIERRA handle;
   |FINSI;
   |CIERRA #4;
   Pos = menos;

   |DBASE dir_fich;
   dir_fich=dir_fich + "fich/";
   |PATH_DAT #caparexp #fich_alta#;
   |ABRE #5;
   |CIERRA #5;
   |DELINDEX #5;
   |ABRE #5;
   alfa4 = "parexplo"; |SI enEjercicio ] 2008; alfa4 = "parexp08"; |FINSI;
   fiche=vari1 + dir_fich + alfa4;
   fiche = fiche + nuevos;

   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seexpl;
      |PARA; |SI field > 0; |HACIENDO;
         |HAZ seexpl;
      |SIGUE;
      |FCIERRA handle;
   |FINSI;
   |CIERRA #5;
   Pos = menos;
|FPRC;

|PROCESO seagru;
   canal = handle + espacio;
   canal = canal + 44;
   |FLEE canal;
   field = FSalida;
   |SI field [ 0;  |ACABA;  |FINSI;
   traba = canal % 101;
   #caagrupa#0 = traba;
   traba = canal % 202;
   #caagrupa#1 = traba;
   |LEE 101#1=;
   |SI FSalida = 0;
      |HAZ seagru1;
      |GRABA 020#1a;
   |SINO;
      |DDEFECTO #1;
      |HAZ seagru1;
      |GRABA 020#1n;
   |FINSI;
   |LIBERA #1;
   saber = "Recuperando Agrupacion: " + #caagrupa#0 + " " + #caagrupa#1 + "         ";
   |PINTA 2211,saber;
|FPRC;

|PROCESO seagru1;
   traba = canal %101;
   #caagrupa#0 = traba;
   traba = canal %202;
   #caagrupa#1 = traba;
   traba = canal % 440;
   #caagrupa#2 = traba;
|FPRC;

|PROCESO secueb;
   canal = handle + espacio;
   canal = canal + 21;
   |FLEE canal;
   field = FSalida;
   |SI field [ 0;  |ACABA;  |FINSI;
   traba = canal % 112;
   #cacuebal#0 = traba;
   |LEE 101#2=;
   |SI FSalida = 0;
      |HAZ secueb1;
      |GRABA 020#2a;
   |SINO;
      |DDEFECTO #2;
      |HAZ secueb1;
      |GRABA 020#2n;
   |FINSI;
   |LIBERA #2;
   saber = "Recuperando Cuenta de Balance: " + #cacuebal#0 + "           ";
   |PINTA 2211,saber;
|FPRC;

|PROCESO secueb1;
   traba = canal %112;
   #cacuebal#0 = traba;
   traba = canal %1301;
   #cacuebal#1 = traba;
   traba = canal % 1401;
   #cacuebal#2 = traba;
   traba = canal %1502;
   #cacuebal#3 = traba;
   traba = canal %1702;
   #cacuebal#4 = traba;
   traba = canal % 1902;
   #cacuebal#5 = traba;
|FPRC;

|PROCESO seepig;
   canal = handle + espacio;
   canal = canal + 86;
   |FLEE canal;
   field = FSalida;
   |SI field [ 0;  |ACABA;  |FINSI;
   traba = canal % 101;
   #caepigra#0 = traba;
   traba = canal % 202;
   #caepigra#1 = traba;
   traba = canal % 4402;
   #caepigra#3 = traba;
   |LEE 101#3=;
   |SI FSalida = 0;
      |HAZ seepig1;
      |GRABA 020#3a;
   |SINO;
      |DDEFECTO #3;
      |HAZ seepig1;
      |GRABA 020#3n;
   |FINSI;
   |LIBERA #3;
   saber = "Recuperando Epigrafe: " + #caepigra#0 + "  " + #caepigra#1 + " " + #caepigra#3 + "        ";
   |PINTA 2211,saber;
|FPRC;

|PROCESO seepig1;
   traba = canal % 101;
   #caepigra#0 = traba;
   traba = canal % 202;
   #caepigra#1 = traba;
   traba = canal % 4402;
   #caepigra#3 = traba;
   traba = canal % 440;
   #caepigra#2 = traba;
   traba = canal % 4640;
   #caepigra#4 = traba;
|FPRC;

|PROCESO sebala;
   canal = handle + espacio;
   canal = canal + 128;
   |FLEE canal;
   field = FSalida;
   |SI field [ 0;  |ACABA;  |FINSI;
   traba = canal % 101;
   #caparbal#0 = traba;
   traba = canal % 202;
   #caparbal#1 = traba;
   traba = canal % 4402;
   #caparbal#3 = traba;
   traba = canal % 8602;
   #caparbal#5 = traba;
   |LEE 101#4=;
   |SI FSalida = 0;
      |HAZ sebala1;
      |GRABA 020#4a;
   |SINO;
      |DDEFECTO #4;
      |HAZ sebala1;
      |GRABA 020#4n;
   |FINSI;
   |LIBERA #4;
   saber = "Rec. Partidas Balance: " + #caparbal#0 + "  " + #caparbal#1 + " " + #caparbal#3 + " " + #caparbal#5 + "       ";
   |PINTA 2211,saber;
|FPRC;

|PROCESO sebala1;
   traba = canal % 101;
   #caparbal#0 = traba;
   traba = canal % 202;
   #caparbal#1 = traba;
   traba = canal % 4402;
   #caparbal#3 = traba;
   traba = canal % 8602;
   #caparbal#5 = traba;
   traba = canal % 440;
   #caparbal#2 = traba;
   traba = canal % 4640;
   #caparbal#4 = traba;
   traba = canal % 8840;
   #caparbal#6 = traba;
|FPRC;

|PROCESO seexpl;
   canal = handle + espacio;
   canal = canal + 129;
   |FLEE canal;
   field = FSalida;
   |SI field [ 0;  |ACABA;  |FINSI;
   traba = canal % 101;
   #caparexp#0 = traba;
   traba = canal % 201;
   #caparexp#1 = traba;
   traba = canal % 302;
   #caparexp#2 = traba;
   traba = canal % 4502;
   #caparexp#4 = traba;
   traba = canal % 8702;
   #caparexp#6 = traba;
   |LEE 101#5=;
   |SI FSalida = 0;
      |HAZ seexpl1;
      |GRABA 020#5a;
   |SINO;
      |DDEFECTO #5;
      |HAZ seexpl1;
      |GRABA 020#5n;
   |FINSI;
   |LIBERA #5;
   saber = "Rec. Partidas Explotacion: " + #caparexp#0 + "  " + #caparexp#1 + " " + #caparexp#2 + " " + #caparexp#4 + " " + #caparexp#6;
   |PINTA 2211,saber;
|FPRC;

|PROCESO seexpl1;
   traba = canal % 101;
   #caparexp#0 = traba;
   traba = canal % 201;
   #caparexp#1 = traba;
   traba = canal % 302;
   #caparexp#2 = traba;
   traba = canal % 4502;
   #caparexp#4 = traba;
   traba = canal % 8702;
   #caparexp#6 = traba;
   traba = canal % 540;
   #caparexp#3 = traba;
   traba = canal % 4740;
   #caparexp#5 = traba;
   traba = canal % 8940;
   #caparexp#7 = traba;
|FPRC;
