|FICHEROS;
  cam00001 #1;
  cam00002 #2;

  caw00011 #65;

  anm00001 #11;
  anm00002 #12;
  anm00003 #13;
  anm00004 #14;
  anm00005 #15;
  anm00006 #16;
  anm00007 #17;
  anm00010 #18;

  nm00001@ #21;
  nm00002@ #22;
  nm00003@ #23;
  nm00004@ #24;
  nm00005@ #25;
  nm00006@ #26;
  nm00007@ #27;
  nm00010@ #28;
|FIN;

|VARIABLES;
   aFichero  = "";
   nEstado   = 0;
   nNumGrupo = 0;
   aElemento = "";
   nNumero   = 0;
   nLinea    = 0;
   swPrimero = 0;


 &enEmpOrig = 0;
 &nMaxDes = 0;
 &eaDirDestino = "";
 &eaDirOrigen  = "";

 swOpera  = 0;
 nCalC    = 0;
 nNume1   = 0;
 nNume2   = 0;
 aAlfa1   = "";
 aAlfa2   = "";
 aAlfa3   = "";
 aDeparta = "";

 &nLong1   = 0;
 &nLong2   = 0;
 &nLong3   = 0;
 &nLong4   = 0;
 &nLong5   = 0;
 &nLong6   = 0;
 &aDigDif  = "";
 &nLonDif  = 0;
 &LineaErrores = 0;
 &UltNivel = 0;

 mascara = "";
 Comodin = "";
 Tipo = 0;
 Nivel = 0;
 LongAlfa = "";

 Long = 0;
 ComodNum = 0;
 ComodNum2 = 0;
 Comodin1 = "";
 Comodin2 = "";

 nSwBueno = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoan_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROGRAMA;

 |DBASE aAlfa1; |QBF aAlfa1;

 aAlfa2 = aAlfa1 + "def/anm00001.mas";
 |CARGA_DEF aAlfa2, nm00001@;
 |SI FSalida = 0;
     aAlfa2 = aAlfa1 + "def/anm00002.mas";
     |CARGA_DEF aAlfa2, nm00002@;
     |SI FSalida = 0;
         aAlfa2 = aAlfa1 + "def/anm00003.mas";
         |CARGA_DEF aAlfa2, nm00003@;
         |SI FSalida = 0;
             aAlfa2 = aAlfa1 + "def/anm00004.mas";
             |CARGA_DEF aAlfa2, nm00004@;
             |SI FSalida = 0;
                 aAlfa2 = aAlfa1 + "def/anm00005.mas";
                 |CARGA_DEF aAlfa2, nm00005@;
                 |SI FSalida = 0;
                     aAlfa2 = aAlfa1 + "def/anm00006.mas";
                     |CARGA_DEF aAlfa2, nm00006@;
                     |SI FSalida = 0;
                         aAlfa2 = aAlfa1 + "def/anm00007.mas";
                         |CARGA_DEF aAlfa2, nm00007@;
                         |SI FSalida = 0;
                             aAlfa2 = aAlfa1 + "def/anm00010.mas";
                             |CARGA_DEF aAlfa2, nm00010@;
                             |SI FSalida = 0;
                                 |HAZ HazTodo;
                                 |DESCARGA_DEF #nm00010@;
                             |FINSI;
                             |DESCARGA_DEF #nm00007@;
                         |FINSI;
                         |DESCARGA_DEF #nm00006@;
                     |FINSI;
                     |DESCARGA_DEF #nm00005@;
                 |FINSI;
                 |DESCARGA_DEF #nm00004@;
             |FINSI;
             |DESCARGA_DEF #nm00003@;
         |FINSI;
         |DESCARGA_DEF #nm00002@;
     |FINSI;
     |DESCARGA_DEF #nm00001@;
 |FINSI;
|FPRO;
|| **************************************************************************
|PROCESO LasCuentas20_10;
  #18#0 = #17#0;
  #18#1 = #28#1;
  |LEE 101#18=;
  |SI FSalida ! 0;
      |DDEFECTO #18;
      #18#0 = #17#0;
      #18#1 = #28#1;
      #18#2 = #28#2;
      #18#3 = #28#3;
      |GRABA 020#18b;
  |FINSI;
  |LIBERA #18;
|FPRC;

|DEFBUCLE LasCuentas2_10;
 #28#1002;
 ;
 #27#0, 001;
 #27#0, 999;
 e;
 NULL, LasCuentas20_10;
|FIN;

|PROCESO LasCuentas20;
  eaCuenta = #27#0; |HAZ FiltroCuenta; #17#0 = eaCuenta; #17#1 = enNivel;
  |SI enNivel = 0; |ACABA; |FINSI;

  |LEE 101#17=;
  |SI FSalida ! 0;
      |DDEFECTO #17;
      #17#0 = eaCuenta;
      #17#1 = enNivel;
      #17#2 = #27#2;
      #17#3 = #27#3;
      #17#4 = #27#4;
      |GRABA 020#17b;
  |FINSI;
  |LIBERA #17;

  |ABRE #18;
  |BUCLE LasCuentas2_10;
  |CIERRA #18;
|FPRC;

|DEFBUCLE LasCuentas2;
 #27#1001;
 ;
 "           ";
 "zzzzzzzzzzz";
 e;
 NULL, LasCuentas20;
|FIN;

|| **************************************************************************
|PROCESO LasLineas10;
  #16#0 = #26#0;
  #16#1 = #26#1;
  |LEE 101#16=;
  |SI FSalida ! 0;
      |DDEFECTO #16;
      #16#0 = #26#0;
      #16#1 = #26#1;
      eaCuenta = #26#2; |HAZ FiltroCuenta; #16#2 = eaCuenta; #16#4 = enNivel;
      eaCuenta = #26#3; |HAZ FiltroCuenta; #16#3 = eaCuenta; #16#5 = enNivel;
      |GRABA 020#16b;
  |FINSI;
  |LIBERA #16;
|FPRC;

|DEFBUCLE LasLineas1;
 #26#1002;
 ;
 #25#0, 000;
 #25#0, 999;
 e;
 NULL, LasLineas10;
|FIN;

|PROCESO Cabeceras10;
  #15#0 = #25#0;
  |LEE 101#15=;
  |SI FSalida ! 0;
      |DDEFECTO #15;
      #15#0 = #25#0;
      #15#1 = #25#1;
      |GRABA 020#15b;
      |BUCLE LasLineas1;
  |FINSI;
  |LIBERA #15;
|FPRC;

|DEFBUCLE LasCabeceras1;
 #25#1001;
 ;
 001;
 999;
 e;
 NULL, Cabeceras10;
|FIN;

|| ***********************************************************************
|PROCESO LasLineas0;
  #13#0 = #23#0;
  #13#1 = #23#1;
  |LEE 101#13=;
  |SI FSalida ! 0;
      |DDEFECTO #13;
      #13#0 = #23#0;
      #13#1 = #23#1;
      #13#2 = #23#2;
      #13#3 = #23#3;
      #13#4 = #23#4;
      |GRABA 020#13b;
  |FINSI;
  |LIBERA #13;
|FPRC;

|DEFBUCLE LasLineas;
 #23#1002;
 ;
 #22#0, 000;
 #22#0, 999;
 e;
 NULL, LasLineas0;
|FIN;

|PROCESO Cabeceras0;
  #12#0 = #22#0;
  |LEE 101#12=;
  |SI FSalida ! 0;
      |DDEFECTO #12;
      #12#0 = #22#0;
      #12#1 = #22#1;
      #12#2 = #22#2;
      |GRABA 020#12b;
      |BUCLE LasLineas;
  |FINSI;
  |LIBERA #12;
|FPRC;

|DEFBUCLE LasCabeceras;
 #22#1001;
 ;
 "       ";
 "zzzzzzz";
 e;
 NULL, Cabeceras0;
|FIN;

|| ***********************************************************************
|PROCESO LasCuentas10;
  #14#0 = #24#0;
  |LEE 101#14=;
  |SI FSalida ! 0;
      |DDEFECTO #14;
      #14#0 = #24#0;
      #14#1 = #24#1;
      #14#2 = #24#2;
      |GRABA 020#14b;
  |FINSI;
  |LIBERA #14;
  |PINTA 2202, "Cuentas de Mayor:                      ";
  |PINTA 2220, #14#0;
  |PINTA 2227, #14#1;
|FPRC;

|DEFBUCLE LasCuentas1;
 #24#1001;
 ;
 "      ";
 "zzzzzz";
 e;
 NULL, LasCuentas10;
|FIN;

|PROCESO LasCuentas0
  #11#0 = #21#0;
  |LEE 101#11=;
  |SI FSalida ! 0;
      |DDEFECTO #11;
      #11#0 = #21#0;
      #11#1 = #21#1;
      #11#2 = #21#2;
      #11#3 = #21#3;
      #11#4 = #21#4;
      #11#5 = #21#5;
      #11#6 = #21#6;
      |GRABA 020#11b;
  |FINSI;
  |LIBERA #11;

  |PINTA 2202, "Cuentas Analitica: ";
  |PINTA 2221, #11#0;
  |PINTA 2229, #11#1;
|FPRC;

|DEFBUCLE LasCuentas;
 #21#1001;
 ;
 "       ";
 "zzzzzzz";
 e;
 NULL, LasCuentas0;
|FIN;

|| -------------------------------------------------------------------
|PROCESO HazTodo;
 |ABRE #1;
 #1#0 = enEmpresa;
 |LEE 101#1=;
 |SI FSalida ! 0;
     |SI enAutom = 0; |MENAV "    ERROR EN LA CONSOLIDACION "; |FINSI;
     |CIERRA #1;
     |ACABA;
 |FINSI;
 |CIERRA #1;
 |ABRE #2;
 #2#0 = enEmpresa;
 #2#1 = enEmpOrig;
 |LEE 040#2=;
 |SI FSalida ! 0;
     |SI enAutom = 0; |MENAV "    ERROR EN LA CONSOLIDACION "; |FINSI;
     |CIERRA #2;
     |ACABA;
 |FINSI;
 |CIERRA #2;

 |PATH_DAT #21 eaDirOrigen;
 |PATH_DAT #22 eaDirOrigen;
 |PATH_DAT #23 eaDirOrigen;
 |PATH_DAT #24 eaDirOrigen;
 |PATH_DAT #25 eaDirOrigen;
 |PATH_DAT #26 eaDirOrigen;
 |PATH_DAT #27 eaDirOrigen;
 |PATH_DAT #28 eaDirOrigen;

 |ABRE #caw00011;

 |ABRE #11;
 |BUCLE LasCuentas;
 |CIERRA #11;

 |ABRE #14;
 |BUCLE LasCuentas1;
 |CIERRA #14;

 |ABRE #12;
 |ABRE #13;
 |BUCLE LasCabeceras;
 |CIERRA #13;
 |CIERRA #12;

 |ABRE #15;
 |ABRE #16;
 |BUCLE LasCabeceras1;
 |CIERRA #16;
 |CIERRA #15;

 |ABRE #17;
 |BUCLE LasCuentas2;
 |CIERRA #17;

 |CIERRA #caw00011;
|FPRC;

|| *********************************************************************
|| --------------------------------------------- Rutinas Varias
|PROCESO FiltroCuenta;
   enNivel = 0;
   |HAZ SacaNivel;
   |SI enNivel = 0; |ACABA; |FINSI;

   |SI #1#3 = 0; |ACABA; |FINSI;

      || Tomar la primera parte segun la posicion indicada
      ComodNum  = 100 + (#1#3 - 1);
      Comodin  = eaCuenta % ComodNum;

      || Sumar el digito diferenciador
      |QBF Comodin;
      Comodin = Comodin + aDigDif;
      |QBF Comodin;
      LongAlfa = Comodin % 0;
      Long = LongAlfa;

      || Tomar la segunda parte segun la posicion indicada
      |SI nLonDif = 3;
          ComodNum2 = ((#1#3 + 3) * 100) + 99;
      |SINO;
          |SI nLonDif = 2;
              ComodNum2 = ((#1#3 + 2) * 100) + 99;
          |SINO;
              ComodNum2 = ((#1#3 + 1) * 100) + 99;
          |FINSI;
      |FINSI;
      Comodin1 = eaCuenta % ComodNum2;
      |QBF Comodin1;
      LongAlfa = Comodin1 % 0;
      Long = Long + LongAlfa;

      || Obtengo la diferencia entre la longitud del ultimo nivel y la
      ||    longitud de la cadena que ya tengo calculada para rellenar
      ||    la cuenta con ceros (si procede)

      |SI UltNivel = 1; Long = dig4 - Long; |FINSI;
      |SI UltNivel = 2; Long = dig5 - Long; |FINSI;
      |SI UltNivel = 3; Long = dig6 - Long; |FINSI;
      |SI UltNivel = 4; Long = dig7 - Long; |FINSI;
      |SI UltNivel = 5; Long = dig8 - Long; |FINSI;
      |SI UltNivel = 6; Long = dig9 - Long; |FINSI;

      Comodin2 = "0" * Long;
      |QBF Comodin2;
      Comodin = Comodin + Comodin2 + Comodin1;
      |QBF Comodin;

      eaCuenta = Comodin;
      |HAZ SacaNivel;
|FPRC;
|| ********************************************************************
