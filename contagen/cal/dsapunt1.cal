|FICHEROS;
   dsapunt1;
   caenlac1;

   camaasic;
   camaasil;
   cacuenta;
   camandia;
   camaniva;
   caivalin;
   casiim01;
   casiim02;
   caivaasi;
   caclipro;
   caivases;
   cacuiv2l;
   calibros;
   cadeflab;

   :/basica/def/agicen14;
   :/basica/def/agicen17;

   :/modelos/def/dsmom030;

   canempre;
   Referen@;
|FIN;

|INCLUYE dscont_i
||INC-LUYE conasi_i;

|VARIABLES;
   nume1 = 0;
   Path = ""; Comodin = ""; Comodin1 = ""; ComodNum = 0; FEstado = 0;

   Calc = 0; Calc1 = 0; Calc2 = 0;
   nLong = 0; aLong = ""; alfa1 = "";
   SwNivel = 0; Nivel = 0; nCont = 0;

   NuevoNumero = 0; NumLinea = 0; TipoIva = 0; LineaIva = 0; CuentaIva = "";

   CmpDebe  = 0; CmpHaber = 0; CmpSaldo = 0;
   TotDebe  = 0; TotHaber = 0; TotSaldo = 0;

   Cuenta = ""; Cuenta1 = ""; nImporte = 0;
   Cont = 0;    EmpAnt = 0;   PerAnt   = 0;
   Libro  = 0;  Serie   = ""; Fact     = 0;

   EnDiario = 0; EnFecha = @; EnAsto = 0;
   Dig1 = 0; Dig2 = 0; Dig3 = 0; Dig4 = 0; Dig5 = 0; Dig6 = 0;

   aH = "";
|FIN;

|PROCESO casiim02;
     |BORRA 020#casiim02.a;
     |LIBERA #casiim02;
|FPRC;

|DEFBUCLE casiim02;
     #casiim02#1;
     ;
     #casiim01#0, #casiim01#1, #casiim01#2, "";
     #casiim01#0, #casiim01#1, #casiim01#2, aH;
     be;
     NULL, casiim02;
|FIN;

|PROCESO BorraSII;
     |ABRE #casiim01;
     #casiim01#0 = "camaniva";
     #casiim01#1 = #camaniva#0;
     #casiim01#2 = #camaniva#1;
     |LEE 101#casiim01.=;
     |SI FSalida = 0;
         aH = "z" * 60;
         |BUCLE casiim02;

         |BORRA 020#casiim01.a;
         |LIBERA #casiim01;
     |FINSI;
     |CIERRA #casiim01;
|FPRC;

|PROCESO BorraLinIva;
   |BORRA 020#caivalin.a;
|FPRC;

|DEFBUCLE BorraLinIva;
#caivalin#1;
;
#camaniva#0, #camaniva#1, 01;
#camaniva#0, #camaniva#1, 99;
be;
NULL,BorraLinIva;
|FIN;

|PROCESO BorraLinAsto;
   |ABRE #camaniva; |ABRE #caivalin;
   |SELECT #2#camaniva;
   #camaniva#7 = #caenlac1#0;
   #camaniva#8 = #caenlac1#1;
   #camaniva#9 = #caenlac1#2;
   |LEE 101#camaniva.=;
   |SI FSalida = 0;
      NuevoNumero = #camaniva#1;
      |BUCLE BorraLinIva;
      |BORRA 020#camaniva.a;
      |LIBERA #camaniva;

      |HAZ BorraSII;
   |FINSI;
   |SELECT #1#camaniva;
   |CIERRA #caivalin; |CIERRA #camaniva;
   Cuenta = #camaasil#4; nImporte = 0 - #camaasil#9; |HAZ Actualiza;
   |BORRA 020#camaasil.a;
|FPRC;

|DEFBUCLE BorraLinAsto;
#camaasil#1;
;
#camaasic#0,#camaasic#1,#camaasic#2,0001;
#camaasic#0,#camaasic#1,#camaasic#2,9999;
be;
NULL,BorraLinAsto;
|FIN;

|PROCESO BorraAsto;
   #camaasic#0  = #caenlac1#0;
   #camaasic#1  = #caenlac1#1;
   #camaasic#2  = nDOCUMENTO;
   #camaasic#12 = nREGISTRO;
   |LEE 101#camaasic.=;
   |SI FSalida = 0;
      |BUCLE BorraLinAsto;
      |BORRA 020#camaasic.a;
   |FINSI;
   |LIBERA #camaasic;
|FPRC;

|PROCESO ReparteIva;
   #caivalin#7 = TipoIva;
   #caivalin#8 = #caivalin#6 % #caivalin#7;
   #caivalin#16 = LineaIva;
   |SI #caivalin#13 = "XXXXXXXXXXXX";
      #caivalin#7  = 0;
      #caivalin#8  = 0;
      #caivalin#16 = 0;
   |SINO;
      #caivalin#13 = CuentaIva;
   |FINSI;
   |GRABA 020#caivalin.a;
|FPRC;

|DEFBUCLE ReparteIva;
#caivalin#1;
;
#camaniva#0,#camaniva#1,01;
#camaniva#0,#camaniva#1,99;
be;
NULL,ReparteIva;
|FIN;

|PROCESO LeeIva;
   |SI #caivalin#7 > TipoIva;
      TipoIva = #caivalin#7;
      CuentaIva = #caivalin#13;
   |FINSI;
|FPRC;

|DEFBUCLE LeeIva;
#caivalin#1;
;
#camaniva#0,#camaniva#1,01;
#camaniva#0,#camaniva#1,99;
;
NULL,LeeIva;
|FIN;

|PROCESO RevisaIva;
   |BUCLE LeeIva;

   LineaIva = 0;
   |ABRE #cacuiv2l;
   #cacuiv2l#0 = "R";
   Comodin = #caenlac1#1 % -104;
   #cacuiv2l#12 = Comodin;
   #cacuiv2l#1 = 1;
   |LEE 000#cacuiv2l.];
   |SI FSalida = 0; |Y #cacuiv2l#0 = "R"; |Y #cacuiv2l#12 = Comodin;
      |PARA; |SI FSalida = 0; |Y #cacuiv2l#0 = "R"; |Y #cacuiv2l#12 = Comodin; |HACIENDO;
         |SI #cacuiv2l#2 = TipoIva; |Y #cacuiv2l#4 = 0;
            LineaIva = #cacuiv2l#1;
         |FINSI;
         |LEE 000#cacuiv2l.s;
      |SIGUE;
   |FINSI;
   |CIERRA #cacuiv2l;

   |BUCLE ReparteIva;
|FPRC;

|PROCESO CreaRegistro;
   |SI #caenlac1#26 = "F";
      || Creo el registro de cabecera
      |ABRE #caivaasi; |LEE 000#caivaasi.p; |CIERRA #caivaasi;
      |SELECT #3#camaniva;
      #camaniva#0 = #caenlac1#11;
      #camaniva#2 = #caenlac1#12;
      #camaniva#3 = #caenlac1#13;
      |LEE 101#camaniva.=;
      |SI FSalida = 0;
         NuevoNumero = #camaniva#1;
         |SELECT #1#camaniva; |LIBERA #camaniva;
         |LEE 101#camaniva.=;
      |SINO;
         |SI NuevoNumero = 0;
            |SELECT #1#camaniva;
            #camaniva#0 = #caenlac1#11;
            #camaniva#1 = 1;
            |LEE 000#camaniva.];
            |SI FSalida = 0; |Y #camaniva#0 = #caenlac1#11;
               |PARA; |SI FSalida = 0; |Y #camaniva#0 = #caenlac1#11; |HACIENDO;
                  NuevoNumero = #camaniva#1 + 1;
                  |LEE 000#camaniva.s;
               |SIGUE;
            |SINO;
               NuevoNumero = 1;
            |FINSI;
         |FINSI;
         |DDEFECTO #camaniva;
         #camaniva#0  = #caenlac1#11;                         || Libro
         #camaniva#1  = NuevoNumero;                          || Documento
         |GRABA 020#camaniva.b;
      |FINSI;
      |SI #caivaasi#44 = "S";
         #camaniva#2 = #caenlac1#12;                             || Serie
         |ABRE #caivases;
         #caivases#0 = #caenlac1#12;
         #caivases#1 = "R";
         |LEE 101#caivases.=;
         |SI FSalida = 0;
            #camaniva#3 = #caivases#4;
            #caivases#3 = #caivases#3 + 1;
            |GRABA 020#caivases.a; |LIBERA #caivases;
         |SINO;
            |DDEFECTO #caivases;
            #caivases#0 = #caenlac1#12;
            #caivases#1 = "R";
            #caivases#3 = 1;
            #camaniva#3 = 1;
            |GRABA 020#caivases.n; |LIBERA #caivases;
         |FINSI;
         |CIERRA #caivases;
      |SINO;
         |ABRE #calibros;
         #calibros#0 = #caenlac1#11;
         |LEE 101#calibros.=;
         |SI FSalida = 0;
            #camaniva#3 = #calibros#4;
            |SI #calibros#2 = "S";
               #calibros#4 = #calibros#4 + #calibros#3;
            |SINO;
               #calibros#4 = #calibros#4 + 1;
            |FINSI;
            |GRABA 020#calibros.a; |LIBERA #calibros;
         |SINO;
            #camaniva#3 = 1;
         |FINSI;
         |CIERRA #calibros;
         #camaniva#2 = "  ";
      |FINSI;
      #camaniva#22 = #caenlac1#12 + "/" + #caenlac1#13;       || Serie + Numero factura
      #camaniva#4  = #caenlac1#1;                             || Fecha factura
      Comodin = #camaniva#4;
      |SI #caivaasi#168 = "A"; Comodin = #camaniva#8; |FINSI;
      Comodin = Comodin % 402;
      nume1   = Comodin;
      #camaniva#5 = nume1;
      |SI enEjercicio [ 2009;
          |SI #caivaasi#46 = "T";
              |SI nume1 ] 1;  |Y nume1 [ 3;  #camaniva#5 = 1; |FINSI;
              |SI nume1 ] 4;  |Y nume1 [ 6;  #camaniva#5 = 2; |FINSI;
              |SI nume1 ] 7;  |Y nume1 [ 9;  #camaniva#5 = 3; |FINSI;
              |SI nume1 ] 10; |Y nume1 [ 12; #camaniva#5 = 4; |FINSI;
          |SINO;
              #camaniva#5 = nume1;                            || Periodicidad
          |FINSI;
      |FINSI;
      #camaniva#7  = #caenlac1#0;                          || Diario
      #camaniva#8  = #caenlac1#1;                          || Fecha Contable
      #camaniva#9  = #caenlac1#2;                          || Documento
      #camaniva#10 = eaDfDepC;                         || Departamento
      #camaniva#11 = eaDfSubC;                         || SubDepartamento
      #camaniva#24 = eaDfDepN;                         || Nombre Actividad
      #camaniva#25 = eaDfSubN;                         || Nombre SubDepartamento
      #camaniva#12 = #caenlac1#4;                          || Cuenta Cliente
      |ABRE #caclipro;
      |SI #caenlac1#10 = "R"; #caclipro#23 = "C"; |FINSI;
      |SI #caenlac1#10 = "S"; #caclipro#23 = "P"; |FINSI;
      #caclipro#10 = #caenlac1#4;
      #caclipro#11 = #caenlac1#5;
      |LEE 000#caclipro.=;
      |SI FSalida = 0;
         #camaniva#13 = #caclipro#1;                       || Nombre Cliente
         #camaniva#14 = #caclipro#9;                       || CIF Cliente
      |FINSI;
      |CIERRA #caclipro;
      #camaniva#21 = #caenlac1#9;                          || Total Factura

      #camaniva#27 = #caenlac1#6;                          || Concepto
      #camaniva#28 = #caenlac1#7;                          || Descripcion
      #camaniva#29 = #caenlac1#6;                          || Concepto IVA
      #camaniva#30 = #caenlac1#7;                          || Descripcion IVA

      #camaniva#31 = "N";                                  || Desglose IVA
      #camaniva#32 = "S";                                  || Desglose Bases
      #camaniva#33 = "S";                                  || Desglose IRPF
      #camaniva#34 = "S";                                  || Desglose Descuento
      #camaniva#35 = "N";
      #camaniva#36 = #caenlac1#10;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;
   |FINSI;

   |SI #caenlac1#26 = "B";
      #camaniva#0 = #caenlac1#11;
      #camaniva#1 = NuevoNumero;
      |LEE 101#camaniva.=;

      #camaniva#19 = #camaniva#19 + #caenlac1#9;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;

      |DDEFECTO #caivalin;
      #caivalin#0 = #caenlac1#11;
      #caivalin#1 = NuevoNumero;
      #caivalin#2 = #caenlac1#27;
      |LEE 101#caivalin.=;
      |SI FSalida ! 0;
         #caivalin#0 = #caenlac1#11;
         #caivalin#1 = NuevoNumero;
         #caivalin#2 = #caenlac1#27;
         |GRABA 020#caivalin.b;
      |FINSI;
      #caivalin#3 = #caenlac1#6;                            || Concepto
      #caivalin#4 = #caenlac1#7;                            || Descripcion

      #dsmom030#0 = #caivalin#3;
      |LEE 000#dsmom030.=;
      |SI FSalida = 0;
         |SI #dsmom030#28 ! 0; |O #dsmom030#32 ! 0;
            #caivalin#5 = "S";
         |SINO;
            #caivalin#5 = "N";
         |FINSI;
      |FINSI;
      #caivalin#6  = #caenlac1#9;                           || Base imponible
      #caivalin#12 = #caenlac1#4;
      |SI #caenlac1#28 = -1;
         #caivalin#13 = "XXXXXXXXXXXX";
      |FINSI;

      |GRABA 020#caivalin.a;
      |HAZ RevisaIva;
   |FINSI;

   |SI #caenlac1#26 = "I";
      #camaniva#0 = #caenlac1#11;
      #camaniva#1 = NuevoNumero;
      |LEE 101#camaniva.=;

      #camaniva#23 = #camaniva#23 + #caenlac1#9;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;

      LineaIva = 0;
      |ABRE #cacuiv2l;
      #cacuiv2l#0 = "R";
      Comodin = #caenlac1#1 % -104;
      #cacuiv2l#12 = Comodin;
      #cacuiv2l#1 = 1;
      |LEE 000#cacuiv2l.];
      |SI FSalida = 0; |Y #cacuiv2l#0 = "R"; |Y #cacuiv2l#12 = Comodin;
         |PARA; |SI FSalida = 0; |Y #cacuiv2l#0 = "R"; |Y #cacuiv2l#12 = Comodin; |HACIENDO;
            |SI #cacuiv2l#2 = #caenlac1#28; |Y #caenlac1#4 = 0;
               LineaIva = #cacuiv2l#1;
            |FINSI;
            |LEE 000#cacuiv2l.s;
         |SIGUE;
      |FINSI;
      |CIERRA #cacuiv2l;
      #caivalin#16 = #cacuiv2l#1;

      |DDEFECTO #caivalin;
      #caivalin#0 = #caenlac1#11;
      #caivalin#1 = NuevoNumero;
      #caivalin#2 = #caenlac1#27;
      |LEE 101#caivalin.=;
      |SI FSalida ! 0;
         #caivalin#0 = #caenlac1#11;
         #caivalin#1 = NuevoNumero;
         #caivalin#2 = #caenlac1#27;
         |GRABA 020#caivalin.b;
      |FINSI;
      #caivalin#7  = #caenlac1#28;                          || Tipo de IVA
      #caivalin#8  = #caenlac1#9;
      #caivalin#13 = #caenlac1#4;
      |GRABA 020#caivalin.a;
      |HAZ RevisaIva;
   |FINSI;

   |SI #caenlac1#26 = "R";
      #camaniva#0 = #caenlac1#11;
      #camaniva#1 = NuevoNumero;
      |LEE 101#camaniva.=;

      #camaniva#23 = #camaniva#23 + #caenlac1#9;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;

      |DDEFECTO #caivalin;
      #caivalin#0 = #caenlac1#11;
      #caivalin#1 = NuevoNumero;
      #caivalin#2 = #caenlac1#27;
      |LEE 101#caivalin.=;
      |SI FSalida ! 0;
         #caivalin#0 = #caenlac1#11;
         #caivalin#1 = NuevoNumero;
         #caivalin#2 = #caenlac1#27;
         |GRABA 020#caivalin.b;
      |FINSI;
      #caivalin#9  = (#caenlac1#9 / #caivalin#6) * 100;     || Tipo de Recargo
      #caivalin#10 = #caenlac1#9;                           || Cuota de Recargo
      #caivalin#14 = #caenlac1#4;
      |GRABA 020#caivalin.a;
   |FINSI;

   |SI #caenlac1#26 = "P";
      #camaniva#0 = #caenlac1#11;
      #camaniva#1 = NuevoNumero;
      |LEE 101#camaniva.=;

      #camaniva#20 = #camaniva#20 + #caenlac1#9;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;

      |DDEFECTO #caivalin;
      #caivalin#0 = #caenlac1#11;
      #caivalin#1 = NuevoNumero;
      #caivalin#2 = #caenlac1#27;
      |LEE 101#caivalin.=;
      |SI FSalida ! 0;
         #caivalin#0 = #caenlac1#11;
         #caivalin#1 = NuevoNumero;
         #caivalin#2 = #caenlac1#27;
         |GRABA 020#caivalin.b;
      |FINSI;

      #caivalin#18 = #caenlac1#6;                           || Concepto
      #caivalin#19 = #caenlac1#7;                           || Descripcion
      #caivalin#22 = #caenlac1#9;                           || Cuota de IRPF
      #caivalin#23 = #caenlac1#4;
      |GRABA 020#caivalin.a;
   |FINSI;

   |SI #caenlac1#26 = "D";
      #camaniva#0 = #caenlac1#11;
      #camaniva#1 = NuevoNumero;
      |LEE 101#camaniva.=;

      #camaniva#26 = #camaniva#26 + #caenlac1#9;
      |GRABA 020#camaniva.a; |LIBERA #camaniva;

      |DDEFECTO #caivalin;
      #caivalin#0 = #caenlac1#11;
      #caivalin#1 = NuevoNumero;
      #caivalin#2 = #caenlac1#27;
      |LEE 101#caivalin.=;
      |SI FSalida ! 0;
         #caivalin#0 = #caenlac1#11;
         #caivalin#1 = NuevoNumero;
         #caivalin#2 = #caenlac1#27;
         |GRABA 020#caivalin.b;
      |FINSI;

      #caivalin#11 = #caenlac1#9;                           || Descuento
      #caivalin#15 = #caenlac1#4;                           || Cuenta descuento
      |GRABA 020#caivalin.a;
   |FINSI;
|FPRC;

|PROCESO Asientos;
   |SI Libro ! #caenlac1#11; |O Serie ! #caenlac1#12; |O Fact ! #caenlac1#13;
      NuevoNumero = 0;
      Libro = #caenlac1#11;
      Serie = #caenlac1#12;
      Fact  = #caenlac1#13;
   |FINSI;

   |SI #caenlac1#30 ! 0;
      |SI EmpAnt ! #caenlac1#30; |O PerAnt ! #caenlac1#31;
         Path = PARAMETRO; Comodin = Path % -107; Path = Path - Comodin;
         Path = Path + ((("00000" + #caenlac1#30) % -105) + #caenlac1#31) + "/";
         fich_alta = Path;
         |HAZ InitEmpresa;
         EmpAnt = #caenlac1#30; PerAnt = #caenlac1#31;
         EnDiario = 0; EnFecha = "01.01.0000"; EnAsto = 0;
      |FINSI;
   |FINSI;

   |SALVA_FICHA #caenlac1;
   |SI EnDiario ! #caenlac1#0; |O EnFecha ! #caenlac1#1; |O EnAsto ! #caenlac1#2;
      #camaasic#0  = #caenlac1#0;
      #camaasic#1  = #caenlac1#1;
      #camaasic#2  = #caenlac1#2; || nDOCUMENTO
      |LEE 101#camaasic.=;
      |SI FSalida = 0;
         nDOCUMENTO = #camaasic#2;
         nREGISTRO  = #caenlac1#16;
         NuevoNumero = 0;
         |HAZ BorraAsto;
      |SINO;
         nDOCUMENTO = #caenlac1#2;
         nREGISTRO  = #caenlac1#16;
         #camaasic#0  = #caenlac1#0;
         #camaasic#1  = #caenlac1#1;
         #camaasic#2  = nDOCUMENTO;
         #camaasic#12 = nREGISTRO;
         |GRABA 020#camaasic.n;
         |HAZ BorraAsto;
      |FINSI;
      |LIBERA #camaasic;

      |SI #caenlac1#25 = "S"; |O #caenlac1#9 = 0;
         |BORRA 020#caenlac1.a; |REPON_FICHA #caenlac1;
         |ACABA;
      |FINSI;

      |DDEFECTO #camaasic;
      #camaasic#0 = #caenlac1#0;
      #camaasic#1 = #caenlac1#1;
      #camaasic#2 = #caenlac1#2;
      nDOCUMENTO = #camaasic#2;
      nREGISTRO = #caenlac1#16;
      |GRABA 020#camaasic.b;
      #camaasic#3  = nDOCUMENTO;
      #camaasic#12 = nREGISTRO;
      #camaasic#4 = 0; #camaasic#5 = 0; #camaasic#6 = 0; #camaasic#7 = 0;
      #camaasic#8  = ""; #camaasic#9  = 0;
      #camaasic#10 = ""; #camaasic#11 = 0;
      #camaasic#13 = 0;
      |SI #caenlac1#10 = "R"; #camaasic#13 = 1; |FINSI;
      |SI #caenlac1#10 = "S"; #camaasic#13 = 2; |FINSI;
      #camaasic#14 = "";
      #camaasic#15 = #caenlac1#17;
      #camaasic#16 = #caenlac1#19;
      |GRABA 020#camaasic.a; |LIBERA #camaasic; |LEE 000#camaasic.=;
      EnDiario = #caenlac1#0; EnFecha  = #caenlac1#1; EnAsto   = #caenlac1#2;
   |FINSI;

   |SI #caenlac1#9 = 0;
      |REPON_FICHA #caenlac1;
      |ACABA;
   |FINSI;

   |DDEFECTO #camaasil;
   #camaasil#0 = #camaasic#0;
   #camaasil#1 = #camaasic#1;
   #camaasil#2 = #camaasic#2;
   #caenlac1#2 = #camaasic#2;
   #camaasil#3 = #caenlac1#3;
   |GRABA 020#camaasil.b;
   #camaasil#4 = #caenlac1#4;
   #camaasil#5 = #caenlac1#5;
   #camaasil#6 = #caenlac1#6;
   #camaasil#7 = #caenlac1#7;
   #camaasil#8 = #caenlac1#8;
   #camaasil#9 = #caenlac1#9;
   |SI #camaasil#8 = "D";
      #camaasil#10 = "";          #camaasil#11 = 0;
      #camaasil#16 = #camaasil#4; #camaasil#17 = #camaasil#5;
   |SINO;
      #camaasil#10 = #camaasil#4; #camaasil#11 = #camaasil#5;
      #camaasil#16 = "";          #camaasil#17 = 0;
   |FINSI;
   #camaasil#12 = #caenlac1#10;
   #camaasil#13 = #caenlac1#11;
   #camaasil#14 = #caenlac1#13;
   #camaasil#15 = #caenlac1#12;
   #camaasil#18 = " ";
   #camaasil#19 = #caenlac1#26;
   #camaasil#20 = #caenlac1#27;
   #camaasil#21 = eaDfDepC;
   #camaasil#22 = #caenlac1#14;
   #camaasil#23 = "N";
   #camaasil#24 = #camaasic#12;
   #caenlac1#16 = #camaasic#12;
   #camaasil#25 = #caenlac1#17;
   #camaasil#26 = #caenlac1#18;
   #camaasil#27 = #caenlac1#19;
   #camaasil#28 = eaDfSubC;

   #caenlac1#20 = "S";
   |GRABA 020#caenlac1.a;

   Cuenta = #camaasil#4; nImporte = #camaasil#9; |HAZ Actualiza;
   |SI #caenlac1#10 ! " ";
      |HAZ CreaRegistro;
      #camaasil#13 = #camaniva#0;
      #camaasil#14 = #camaniva#3;
      #camaasil#15 = #camaniva#2;
   |FINSI;
   |GRABA 020#camaasil.a; |LIBERA #camaasil; |LEE 000#camaasil.=;

   |REPON_FICHA #caenlac1;
|FPRC;

|DEFBUCLE Asientos;
#caenlac1#1;
20;
00000,0,00,"00.00.0000",000001,0000,"N";
99999,9,99,"31.12.9999",999999,9999,"N";
be;
NULL,Asientos;
|FIN;

|PROCESO Actualiza;
   || Actualiza la cabecera del asiento
   |SI #camaasil#8 = "D";
      #camaasic#4 = #camaasic#4 + nImporte;
   |SINO;
      #camaasic#5 = #camaasic#5 + nImporte;
   |FINSI;
   #camaasic#6 = #camaasic#4 - #camaasic#5;
   |GRABA 020#camaasic.a;

   MasMenos     = nImporte;
   DebeHaber    = #camaasil#8;
   aCUENTA      = #camaasil#4;
   nREGISTRO    = #camaasil#24;
   nDIARIO      = #camaasil#0;
   aFECHA       = #camaasil#1;
   nDOCUMENTO   = #camaasil#2;
   nNIVELCUENTA = #camaasil#5;
   |HAZ ActDiario;          || diario
   |HAZ ActCuenta;          || cuenta
   |HAZ ActTesteo;
|FPRC;

|PROCESO InitEmpresa;

   |CIERRA #caclipro;
   |CIERRA #camaniva; |CIERRA #caivalin; |CIERRA #canempre; |CIERRA #camandia;
   |CIERRA #cacuenta; |CIERRA #camaasil; |CIERRA #camaasic; |CIERRA #cadeflab;

   |PATH_DAT #camaasic#Path#;
   |PATH_DAT #camaasil#Path#;
   |PATH_DAT #cacuenta#Path#;
   |PATH_DAT #camandia#Path#;
   |PATH_DAT #camaniva#Path#;
   |PATH_DAT #caivalin#Path#;
   |PATH_DAT #casiim01#Path#;
   |PATH_DAT #casiim02#Path#;
   |PATH_DAT #caivaasi#Path#;
   |PATH_DAT #caclipro#Path#;
   |PATH_DAT #calibros#Path#;
   |PATH_DAT #cadeflab#Path#;

   |HAZ inicio;

   |ABRE #cadeflab; |ABRE #camaasic; |ABRE #camaasil; |ABRE #cacuenta;
   |ABRE #camandia; |ABRE #canempre; |ABRE #caivalin; |ABRE #camaniva;
   |ABRE #caclipro;

   Comodin = Path; |QBF Comodin;
   Comodin = Comodin % -107; Comodin = Comodin - "/";
   Comodin1 = Comodin % 0105; #canempre#2 = Comodin1;
   Comodin1 = Comodin % -101; #canempre#3 = Comodin1;
   |LEE 000#canempre.=;
   |SI FSalida = 0;
      Dig1 = #canempre#14; Dig2 = #canempre#15; Dig3 = #canempre#16;
      Dig4 = #canempre#17; Dig5 = #canempre#18; Dig6 = #canempre#19;
   |FINSI;

   |LEE 000#cadeflab.p;
   |SI FSalida ! 0;
      |DDEFECTO #cadeflab;
      |GRABA 020#cadeflab.n;
      |LEE 000#cadeflab.p;
   |FINSI;
   |ABRE #caivaasi;
   |DDEFECTO #caivaasi;
   |LEE 000#caivaasi.p;
   |CIERRA #caivaasi;
   eaPaCTA1 = #caivaasi#135;  ||permitir alta no estructuras 2008
   eaPaCTA2 = #caivaasi#136;  ||Aviso 1990
   eaPaNif1 = #caivaasi#152;
   eaPaNif2 = #caivaasi#153;
   eaABanco = #caivaasi#161;
   eaObClPr = #caivaasi#186;
|FPRC;

|PROGRAMA;
   Path = PARAMETRO;
   Comodin = Path % -107; Path = Path - Comodin;
   |PATH_DAT #canempre#Path#;

   Path = PARAMETRO;
   |PATH_DAT #caenlac1#Path#;
   |ABRE #caenlac1;
   fich_alta = Path;
   |HAZ InitEmpresa;
   |BUCLE Asientos;

   |CIERRA #caclipro; |CIERRA #camaniva; |CIERRA #caivalin; |CIERRA #canempre;
   |CIERRA #camandia; |CIERRA #cacuenta; |CIERRA #camaasil; |CIERRA #camaasic;
   |CIERRA #caenlac1;
   |HAZ NuevoDoc;
|FPRO;
