|FICHEROS;
     caparsim #0;
     caparsil #1;
     caz00022 #10;

     cacuebal #3;
     caparbal #4;
     caparexp #5;
     caagrupa #11;
     caepigra #12;

    :/modelos/def/dsmom100 #100;
     canempre #30;

     &caparsi@ #900;
|FIN;

|VARIABLES;
  &nBloque  = 0;
  aDef      = "";
  aAlfa1    = "";
  aAlfa2    = "";
  aDirBase  = "";
  nLinea    = 0;
  aTipo     = "";
  nNumero   = 0;
  nSwPr     = 0;
|FIN;

|INCLUYE dscont_i;

|| ******************************************** Calculos Pantalla
|CALCULO wTipo12; |TIPO 12;
|FCAL;

|CALCULO descri;  |TIPO 0;
  |SI #10#0 = 0; #10#1 = "Partidas de Balance: ACTIVO / PASIVO"; |FINSI;
  |SI #10#0 = 1; #10#1 = "Partidas de Resultado: DEBE / HABER"; |FINSI;
  |PINTA #10#1;
  nBloque = #10#0;
|FCAL;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|RUTINA min;
 #0#0 = #10#0;
 #0#1 = " ";
 #0#2 = 01;
 #0#3 = 00;
 #0#4 = 00;
|FRUT;

|RUTINA max;
  #0#0 = #10#0;
  #0#1 = "z";
  #0#2 = 99;
  #0#3 = 99;
  #0#4 = 99;
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
  aLosDefs = aPContag + "def/";
  aDef     = aLosDefs + "caparsim.mas";
  |CARGA_DEF aDef, caparsi@;
  |SI FSalida ! 0;
      aAlfa1 = "     Error en cargar el Def caparsim.mas";
      |MENAV aAlfa1;
      |ERROR;
      |ACABA;
  |FINSI;

  |PATH_DAT #3 dirfich0;
  |PATH_DAT #4 dirfich0;
  |PATH_DAT #5 dirfich0;
  |PATH_DAT #11 dirfich0;
  |PATH_DAT #12 dirfich0;
  |ENTLINEAL #1#0, -2, 2, 22, 0, min, max;

  |DESCARGA_DEF #caparsi@;
|FPRC;

|PROGRAMA;
   |CLS;
   |HAZ inicio;
 ||  |SI enEjercicio ] 2008;
 ||      |MENAV "    Estructuras Plan Contable 1990. No modificables en este Ejercicio";
 ||      |PTEC 807;
 ||  |FINSI;
   |HAZ DirAplicSt;

   |HAZ Eldirfich0;

   |ABRE #0;
   |LEE 001#0p;
   |SI FSalida ! 0;
       |CIERRA #0;
       |HAZ ElPrimero;
   |SINO;
       |CIERRA #0;
   |FINSI;

   |CABEZA "Asignar Cuentas a Diario Simplificado";
   |DDEFECTO #10;
   |PINPA #0#10;
   |PINDA #0#10;
   |ENDATOS #1#10;
|FPRO;
|| **********************************************************************

|PROCESO Eldirfich0;
   |DFICE dirfich0; |QBF dirfich0;

   |SI Haymodelo = 1;
|| ... Empresa Maestra
       aDirBase = aPModelo + "fich/";
       |PATH_DAT #100 aDirBase;
       |ABRE #100;
       |LEE 040#100p;
       |SI FSalida ! 0;
           |CIERRA #100;
           |ACABA;
           || ... No existe fichero de empresa maestra
       |FINSI;
       |CIERRA #100;

       |ABRE #30;
       #30#2 = #100#1;
       #30#3 = #100#2;
       |LEE 001#30=;
       |SI FSalida ! 0;
           |CIERRA #30;
           |ACABA;
           || ... No existe empresa maestra
       |FINSI;
       |CIERRA #30;

       aAlfa1 = #100#1; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
       aAlfa2 = #100#2; |QBF aAlfa2; aAlfa2 = ("0" + aAlfa2) % -101;

       |DFICB dirfich0; |QBF dirfich0;
       dirfich0 = dirfich0 + aAlfa1 + aAlfa2 + "/";
  |FINSI;
|FPRC;
||------------------------------------
/*
|PROCESO LeeCuentas;
 nLinea = nLinea + 1;
 #1#0 = #0#0;
 #1#1 = #0#1;
 #1#2 = #0#2;
 #1#3 = #0#3;
 #1#4 = #0#4;
 #1#5 = nLinea;
 |LEE 101#1=;
 |SI FSalida ! 0;
      #1#0 = #0#0;
      #1#1 = #0#1;
      #1#2 = #0#2;
      #1#3 = #0#3;
      #1#4 = #0#4;
      #1#5 = nLinea;
      |GRABA 020#1b;
 |FINSI;
 #1#6 = #3#0;
 |GRABA 020#1a;
 |LIBERA #1;
|FPRC;

|DEFBUCLE LeeCuentas;
 #3#1;
 2,3,4,5;
 "            ", #0#1, #0#2, #0#3, #0#4;
 "zzzzzzzzzzzz", #0#1, #0#2, #0#3, #0#4;
 ;
 NULL, LeeCuentas;
|FIN;
*/
|PROCESO PartResulta;
 |SI nSwPr = 0;
     nSwPr   = 1;
     nNumero = 0;
     aTipo    = #5#1;
 |FINSI;
 |SI aTipo ! #5#1;
     nNumero = 0;
     aTipo   = #5#1;
 |FINSI;

 nBloque = 1;
 #0#0 = nBloque;
 #0#1 = #5#1;   || Tipo
 #0#2 = #5#2;   || Agrupacion
 #0#3 = #5#4;   || Epigrafe
 #0#4 = #5#6;   || Partida
 |LEE 101#0=;
 |SI FSalida ! 0;
     #0#0 = nBloque;
     #0#1 = #5#1;   || Tipo
     #0#2 = #5#2;   || Agrupacion
     #0#3 = #5#4;   || Epigrafe
     #0#4 = #5#6;   || Partida
     |GRABA 020#0b;
 |FINSI;
 #0#5 = #5#3;
 #0#6 = #5#5;
 #0#7 = #5#7;
 |GRABA 020#0a;
 |LIBERA #0;
/*
 nLinea = 0;
 |ABRE #1;
 |BUCLE LeeCuentas;
 |CIERRA #1;
*/
 |HAZ RecogeLineas;
|FPRC;

|DEFBUCLE PartResulta;
 #5#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, PartResulta;
|FIN;

|PROCESO PartBalance;
 |SI nSwPr = 0;
     nSwPr   = 1;
     nNumero = 0;
     aTipo   = #4#0;
 |FINSI;
 |SI aTipo ! #4#0;
     nNumero = 0;
     aTipo   = #4#0;
 |FINSI;

 nNumero = nNumero + 1;

 nBloque = 0;
 #0#0 = nBloque;
 #0#1 = #4#0;   || Tipo
 #0#2 = #4#1;   || Agrupacion
 #0#3 = #4#3;   || Epigrafe
 #0#4 = #4#5;   || Partida
 |LEE 101#0=;
 |SI FSalida ! 0;
     #0#0 = nBloque;
     #0#1 = #4#0;   || Tipo
     #0#2 = #4#1;   || Agrupacion
     #0#3 = #4#3;   || Epigrafe
     #0#4 = #4#5;   || Partida
     |GRABA 020#0b;
 |FINSI;
 #0#5 = #4#2;
 #0#6 = #4#4;
 #0#7 = #4#6;
 #0#8 = nNumero;
 |GRABA 020#0a;
 |LIBERA #0;
/*
 nLinea = 0;
 |ABRE #1;
 |BUCLE LeeCuentas;
 |CIERRA #1;
*/
 |HAZ RecogeLineas;
|FPRC;

|DEFBUCLE PartBalance;
 #4#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, PartBalance;
|FIN;

|PROCESO BorrarNo;
 nSwPr = 0;
 |ABRE #1;
 #1#0 = #0#0;
 #1#1 = #0#1;
 #1#2 = #0#2;
 #1#3 = #0#3;
 #1#4 = #0#4;
 #1#5 = 1;
 |LEE 001#1];
 |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
     |Y #1#2 = #0#2; |Y #1#3 = #0#3; |Y #1#4 = #0#4;
        nSwPr = 1;
 |FINSI;
 |CIERRA #1;

 |SI nSwPr = 0;
     |BORRA 020#0a;
 |FINSI;
 |LIBERA #0;
|FPRC;

|DEFBUCLE BorrarNo;
 #0#1;
 ;
 INICIO;
 FINAL;
 be;
 NULL, BorrarNo;
|FIN;

|PROCESO ElPrimero;
  |PATH_DAT #3 dirfich0;
  |PATH_DAT #4 dirfich0;
  |PATH_DAT #5 dirfich0;

  |ABRE #0;
  nSwPr = 0;
  |BUCLE PartBalance;
  nSwPr = 0;
  |BUCLE PartResulta;
  |CIERRA #0;

  |BUCLE BorrarNo;
|FPRC;
