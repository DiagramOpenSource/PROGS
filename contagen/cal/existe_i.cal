|FICHEROS;
   caw00060 #100;

   caexistl #101;
   caexistc #102;

   caxistl@ #901;
|FIN;

|VARIABLES;
   &r_emp    = 0;
   &r_per    = 0;
   &r_eje    = 0;
   &r_nom    ="";
   dir_fich1 = "";
   alfa1     = "";
   alfa2     = "";
   nPara1    = 0;
   nPara2    = 0;
   nLinea    = 0;
   nEstado   = 0;

   nSwOpera = 0;
   nSwTodo  = 0;
|FIN;

|INCLUYE dscont_i;

|PROCESO T_exis1;

   |SI #101#0 = 0;

       |BORRA 020#101a;

   |SINO;
       |SI #101#2 ! doce;
           |DDEFECTO #100;
           #100#0 = #101#2;
           |LEE 101#100=;
           |SI FSalida ! 0;
               |DDEFECTO #100;
               #100#0 = #101#2;
               #100#1 = #101#3;
               #100#2 = #101#4;
               #100#3 = #101#5;
               #100#4 = #101#6;
               #100#5 = #101#7;
               #100#6 = #101#8;
               #100#7 = #101#9;
               #100#8 = #101#10;
               #100#23 = #101#1;
               |GRABA 020#100b;
           |FINSI;

           |PARA nPara1 = 9; |SI nPara1 [ 22; |HACIENDO  nPara1 = nPara1 + 1;
                 nPara2 = nPara1 + 2;
                 #100nPara1 = #100nPara1 + #101nPara2;
           |SIGUE;

           |GRABA 020#100a;
       |FINSI;
       |LIBERA #100;
  |FINSI;

  |LIBERA #101;
|FPRC;

|DEFBUCLE T_exis0;
   #101#1;
   ;
   00, 01;
   99, 99;
   be;
   NULL,T_exis1;
|FIN;

||**************************************************************
|PROCESO G_exis1;

   |SI nSwOpera = 0;

      |DDEFECTO #101;
      #101#0 = 00;
      #101#1 = #100#23;
      |LEE 001#101=;
      nEstado = FSalida;
      |SI nEstado = 0;
          |SI #101#2 ! #100#0;
              nSwTodo = 1;
              |ACABA;
          |FINSI;
      |FINSI;

      #101#0 = 00;
      #101#1 = #100#23;
      |PARA nPara1 = 0; |SI nPara1 [ 22; |HACIENDO  nPara1 = nPara1 + 1;
            nPara2 = nPara1 + 2;
            #101nPara2 = #100nPara1;
      |SIGUE;

      |SI nEstado ! 0; |GRABA 020#101n; |FINSI;
      |SI nEstado = 0; |GRABA 020#101a; |FINSI;
      |LIBERA #101;

  |SINO;
      nLinea = nLinea + 1;
      |DDEFECTO #101;
      #101#0 = 00;
      #101#1 = nLinea;

      |PARA nPara1 = 0; |SI nPara1 [ 22; |HACIENDO  nPara1 = nPara1 + 1;
            nPara2 = nPara1 + 2;
            #101nPara2 = #100nPara1;
      |SIGUE;

      |GRABA 020#101n;
      |LIBERA #101;
  |FINSI;
  |BORRA 020#100a;
|FPRC;

|DEFBUCLE G_exis0;
   #100#1;
   ;
   "            ";
   "zzzzzzzzzzzz";
   ;
   NULL, G_exis1;
|FIN;

|| ************************************************************

|PROCESO ExisGeneral;

   |DBASS dir_fich1;   || Directorio Base de las Aplicaciones
   dir_fich1 = dir_fich1 + "contagen/"; ||            Contabilidad General

   dirfich0 = dir_fich1 + "fich/";
   alfa1 = r_emp;
   alfa2 = r_per;
   alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
   alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
   dirfich0 = dirfich0 + alfa1 + alfa2 + "/";

   |PATH_DAT #100 dirfich0;
   |PATH_DAT #102 dirfich0;
   |PATH_DAT #101 dirfich0;

   |DELINDEX #100;

   |ABRE #100;
   |BUCLE T_exis0;  || acumula y borra lineas del 0
   |CIERRA #100;

|| ... Cabecera de la Estructura 00
   |ABRE #102;
   #102#0 = 0;
   |LEE 101#102=;
   |SI FSalida ! 0;
       |LIBERA #102;
       #102#0 = 1;
       |LEE 001#102];
       |SI FSalida ! 0;
           |DDEFECTO #102;
       |FINSI;
       #102#0 = 0;
       #102#1 = "DESCARGA EXISTENCIAS GENERAL ";
       |GRABA 001#102c;
   |SINO;
       |SI #102#2 = doce;
           #102#0 = 1;
           |LEE 001#102];
           |SI FSalida ! 0; |DDEFECTO #102; |FINSI;
           alfa1 =#102#2;
           #102#0 = 0;
           |LEE 001#102=;
           #102#2 = alfa1;
       |FINSI;
   |FINSI;
   eaCuenta = #102#2;
   |HAZ SacaNivel;
   #102#3 = enNivel;
   |GRABA 020#102a;
   |LIBERA #102;
   |CIERRA #102;
|| ..............................................................

   nSwTodo = 0;
   nLinea  = 0;
   |ABRE #101;
   nSwOpera = 0;
   |BUCLE G_exis0;
   |SI nSwTodo = 1;
       nLinea = 0;
       #101#0 = 00;
       #101#1 = 99;
       |LEE 001#101];
       |SI FSalida = 0;
           |LEE 040#101a;
       |SINO;
           |LEE 040#101u;
       |FINSI;
       |SI FSalida = 0; |Y #101#0 = 00;
           nLinea = #101#1;
       |FINSI;
       nSwOpera = 1;

       |BUCLE G_exis0;
   |FINSI;
   |SI nLinea = 0;
       |DDEFECTO #101;
       #101#0 = 00;
       #101#1 = 01;
       |GRABA 040#101n;
   |FINSI;
   |CIERRA #101;
   |DELINDEX #100;
|FPRC;
