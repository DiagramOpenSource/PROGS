|FICHEROS;
   caut0015 #0;

   :/modelos/def/dsmom030 #300;
   caivaasi #200;

   cadeflab #210;

   cacuenta #5;
   camandia #10;

   canempre #30;
   caselem1 #998;
   caw00026 #999;
|FIN;

|VARIABLES;
   &entrada     = 1;
   inkey        = 0;
   nCampo       = 0;
   ConcepAnt    = 0;
   aAlfa1       = "";
   aAlfa2       = "";
   &r_emp       = 0;
   &r_per       = 0;
   nEjer        = 0;
   aPath        = "";
   aPathOrigen  = "";
   aPathDestino = "";
   traba        = "";
   traba1       = "";
   temporal1    = "";
   temporal2    = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoiv_i;

|| **************************************************************************
|PROCESO losdefectos; |TIPO 7;

  #0#1 = enEjercicio;  |PINTA #0#1;
  #0#2 = enEmpresa;    |PINTA #0#2;
  #0#3 = enPeriodo;    |PINTA #0#3;
  #0#4 = eaNombreEmp;  |PINTA #0#4;

  |ABRE #210;
  |LEE 001#210p;
  |CIERRA #210;

  #0#5  = #210#78;   |PINTA #0#5;
  #0#6  = #210#79;   |PINTA #0#6;
  #0#7  = #210#108;  |PINTA #0#7;
  #0#8  = #210#109;  |PINTA #0#8;
  #0#84 = #210#110;  |PINTA #0#84;

  #0#10 = #210#1;
  #0#11 = #210#2;
  #0#12 = #210#3;
  #0#13 = #210#24;
  #0#14 = #210#25;
  #0#15 = #210#26;
  #0#16 = #210#44;
  #0#17 = #210#45;

  #0#19 = #210#4;
  #0#20 = #210#5;
  #0#21 = #210#6;
  #0#22 = #210#27;
  #0#23 = #210#28;
  #0#24 = #210#29;

  #0#26 = #210#10;
  #0#27 = #210#11;
  #0#28 = #210#12;
  #0#29 = #210#75;
  #0#30 = #210#33;
  #0#31 = #210#34;
  #0#32 = #210#35;
  #0#33 = #210#63;
  #0#34 = #210#64;
  #0#35 = #210#65;
  #0#36 = #210#76;
  #0#37 = #210#66;
  #0#38 = #210#67;
  #0#39 = #210#68;
  #0#40 = #210#69;
  #0#41 = #210#70;
  #0#42 = #210#71;
  #0#43 = #210#77;
  #0#44 = #210#72;
  #0#45 = #210#73;
  #0#46 = #210#74;

  #0#48 = #210#49;
  #0#49 = #210#50;
  #0#50 = #210#51;
  #0#51 = #210#46;
  #0#52 = #210#47;
  #0#53 = #210#48;

  #0#55 = #210#7;
  #0#56 = #210#8;
  #0#57 = #210#9;
  #0#58 = #210#30;
  #0#59 = #210#31;
  #0#60 = #210#32;

  #0#62 = #210#16;
  #0#63 = #210#17;
  #0#64 = #210#18;
  #0#65 = #210#39;
  #0#66 = #210#40;
  #0#67 = #210#41;

  #0#69 = #210#13;
  #0#70 = #210#14;
  #0#71 = #210#15;
  #0#72 = #210#36;
  #0#73 = #210#37;
  #0#74 = #210#38;

  #0#76 = #210#19;  |PINTA #0#76;
  #0#77 = #210#20;  |PINTA #0#77;
  #0#78 = #210#43;  |PINTA #0#78;
  #0#79 = #210#54;  |PINTA #0#79;
  #0#80 = #210#55;  |PINTA #0#80;
  #0#81 = #210#56;  |PINTA #0#81;
  #0#82 = #210#53;  |PINTA #0#82;

  #0#85 = #210#111;
  #0#86 = #210#112;
  #0#87 = #210#113;
  #0#88 = #210#114;
  #0#89 = #210#115;
  #0#90 = #210#116;

  #0#93 = #210#117; |PINTA #0#93;
|FPRC;

|PROCESO Copiar;
  aAlfa1 = "N"; aAlfa2 = "S";
  |SI #0#0 = "S";
      aAlfa1 = "S"; aAlfa2 = "N";
      #0#9  = "N";  |PINTA #0#9;
      #0#18 = "N";  |PINTA #0#18;
      #0#25 = "N";  |PINTA #0#25;
      #0#47 = "N";  |PINTA #0#47;
      #0#54 = "N";  |PINTA #0#54;
      #0#61 = "N";  |PINTA #0#61;
      #0#68 = "N";  |PINTA #0#68;
      #0#75 = "N";  |PINTA #0#75;
      #0#83 = "N";  |PINTA #0#83;
      #0#92 = "N";  |PINTA #0#92;
      #0#94 = "N";  |PINTA #0#94;
  |FINSI;
  |C_M #0#2,  1, aAlfa1;
  |C_M #0#3,  1, aAlfa1;
  |C_M #0#9,  1, aAlfa2;
  |C_M #0#18, 1, aAlfa2;
  |C_M #0#25, 1, aAlfa2;
  |C_M #0#47, 1, aAlfa2;
  |C_M #0#54, 1, aAlfa2;
  |C_M #0#61, 1, aAlfa2;
  |C_M #0#68, 1, aAlfa2;
  |C_M #0#75, 1, aAlfa2;
  |C_M #0#83, 1, aAlfa2;
  |C_M #0#92, 1, aAlfa2;
  |C_M #0#94, 1, aAlfa2;
|FPRC;

|CALCULO Consulta; |TIPO 0;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI FSalida ! 9;  |ACABA;  |FINSI;

     |SUB_EJECUTA_NP "caconemp";
     |ERROR;
     #0#2 = r_emp;
     #0#3 = r_per;
     |PTEC 802;
     |PTEC 802;
|FCAL;

|CALCULO EsBuena2;         || desde campo empresa Origen
     |C_M #0#2,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |ABRE #30;
     #30#2 = #0#2;
     #30#3 = 0;
     |LEE 011#30];
     |SI FSalida ! 0;  |O #30#2 ! #0#2;
         |MENAV "     NO Existe la Empresa Contable";
         |ERROR;
     |FINSI;
     |CIERRA #30;
|FCAL;

|CALCULO EsBuena3;        ||Desde campo Periodo Origen
     |C_M #0#3,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |ABRE #30;
     #30#2 = #0#2;
     #30#3 = #0#3;
     |LEE 011#30=;
     |SI FSalida ! 0;
         |MENAV "     NO Existe Periodo en la Empresa Contable";
         |CIERRA #30;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #30;
     #0#4 = #30#1; |PINTA #0#4;
     |SI #30#26 > 80;
         nEjer = #30#26 + 1900;
     |SINO;
         nEjer = #30#26 + 2000;
     |FINSI;
     #0#1 = nEjer; |PINTA #0#1;
|FCAL;

|CALCULO pasenominas;
  |C_M #0#7, 0, aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;
  aAlfa1 = "S";
  |SI #0#7 = "N"; |Y #0#8 = "N";
      aAlfa1 = "N";
  |FINSI;
  |C_M #0#84, 1, aAlfa1;
|FCAL;

|CALCULO AntesConcepto; |TIPO 7;
  ConcepAnt = #0Campo;
|FCAL;

|CALCULO TrasConcepto;  |TIPO 6;
  inkey = FSalida;
  |C_M #0Campo,0,aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  |ABRE #dsmom030;
  #dsmom030#0 = #0Campo;
  |LEE 021#dsmom030.=;
  |SI FSalida ! 0;
      |DDEFECTO #dsmom030;
      |MENAV "    No existe Concepto.";
      |CIERRA #dsmom030;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #dsmom030;

   |SI #0Campo ! ConcepAnt;
      |SI Campo = 63; |O Campo = 86;
          |SI #dsmom030#5 ! "S";
               |SI snFiltr ! "X";
                   |MENAV "      El Concepto no es de I.R.P.F.";
               |FINSI;
               |SI snFiltr = "S";
                   |ERROR;
                   |ACABA;
               |FINSI;
          |FINSI;
      |FINSI;
   |FINSI;
|FCAL;

|CALCULO recoge; |TIPO 7;
  |C_M #0Campo,0,aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

   nCampo = Campo - 1;
   |SI #0nCampo ! ConcepAnt;
       |ABRE #dsmom030;
       #dsmom030#0 = #0nCampo;
       |LEE 021#dsmom030.=;
       |SI FSalida ! 0;  |DDEFECTO #dsmom030;  |FINSI;
       #0Campo = #dsmom030#1;
       |PINTA #0Campo;
       |CIERRA #dsmom030;
       |PTEC 816;
   |FINSI;
|FCAL;

|CALCULO Cuenta; |TIPO 6;
    |C_M #0Campo,0,aAlfa1;
    |SI aAlfa1 = "N"; |ACABA; |FINSI;

     eaCuenta = #0Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
|FCAL;

|CALCULO TrasCuenta; |TIPO 0;
    |C_M #0Campo,0,aAlfa1;
    |SI aAlfa1 = "N"; |ACABA; |FINSI;
    emCta    = 1;

    eaCuenta = #0Campo;
    |HAZ SacaNivel;
    |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea

    |HAZ LeeCuenta;
|FCAL;

|CALCULO TrasDiario; |TIPO 0;
   |ABRE #10;
   #10#0 = #0#79;
   |LEE 000#10=;
   |SI FSalida = 0;
       #0#80 = #10#1; |PINTA #0#80;
   |FINSI;
   |CIERRA #10;
|FCAL;

|CALCULO QueHago; |TIPO 0;
  aAlfa1 = #0Campo;
  |SI Campo = 9;
      |C_M #0#5,  1, aAlfa1;
      |C_M #0#6,  1, aAlfa1;
      |C_M #0#7,  1, aAlfa1;
      |C_M #0#8,  1, aAlfa1;
      |C_M #0#84, 1, aAlfa1;
  |FINSI;

  |SI Campo = 18;
      |C_M #0#10, 1, aAlfa1;
      |C_M #0#11, 1, aAlfa1;
      |C_M #0#12, 1, aAlfa1;
      |C_M #0#13, 1, aAlfa1;
      |C_M #0#14, 1, aAlfa1;
      |C_M #0#15, 1, aAlfa1;
      |C_M #0#16, 1, aAlfa1;
      |C_M #0#17, 1, aAlfa1;
  |FINSI;

  |SI Campo = 25;
      |C_M #0#19, 1, aAlfa1;
      |C_M #0#20, 1, aAlfa1;
      |C_M #0#21, 1, aAlfa1;
      |C_M #0#22, 1, aAlfa1;
      |C_M #0#23, 1, aAlfa1;
      |C_M #0#24, 1, aAlfa1;
  |FINSI;

  |SI Campo = 47;
      |C_M #0#26, 1, aAlfa1;
      |C_M #0#27, 1, aAlfa1;
      |C_M #0#28, 1, aAlfa1;
      |C_M #0#29, 1, aAlfa1;
      |C_M #0#30, 1, aAlfa1;
      |C_M #0#31, 1, aAlfa1;
      |C_M #0#32, 1, aAlfa1;
      |C_M #0#33, 1, aAlfa1;
      |C_M #0#34, 1, aAlfa1;
      |C_M #0#35, 1, aAlfa1;
      |C_M #0#36, 1, aAlfa1;
      |C_M #0#37, 1, aAlfa1;
      |C_M #0#38, 1, aAlfa1;
      |C_M #0#39, 1, aAlfa1;
      |C_M #0#40, 1, aAlfa1;
      |C_M #0#41, 1, aAlfa1;
      |C_M #0#42, 1, aAlfa1;
      |C_M #0#43, 1, aAlfa1;
      |C_M #0#44, 1, aAlfa1;
      |C_M #0#45, 1, aAlfa1;
      |C_M #0#46, 1, aAlfa1;
  |FINSI;

  |SI Campo = 54;
      |C_M #0#48, 1, aAlfa1;
      |C_M #0#49, 1, aAlfa1;
      |C_M #0#50, 1, aAlfa1;
      |C_M #0#51, 1, aAlfa1;
      |C_M #0#52, 1, aAlfa1;
      |C_M #0#53, 1, aAlfa1;
  |FINSI;

  |SI Campo = 61;
      |C_M #0#55, 1, aAlfa1;
      |C_M #0#56, 1, aAlfa1;
      |C_M #0#57, 1, aAlfa1;
      |C_M #0#58, 1, aAlfa1;
      |C_M #0#59, 1, aAlfa1;
      |C_M #0#60, 1, aAlfa1;
  |FINSI;

  |SI Campo = 68;
      |C_M #0#62, 1, aAlfa1;
      |C_M #0#63, 1, aAlfa1;
      |C_M #0#64, 1, aAlfa1;
      |C_M #0#65, 1, aAlfa1;
      |C_M #0#66, 1, aAlfa1;
      |C_M #0#67, 1, aAlfa1;
  |FINSI;

  |SI Campo = 75;
      |C_M #0#69, 1, aAlfa1;
      |C_M #0#70, 1, aAlfa1;
      |C_M #0#71, 1, aAlfa1;
      |C_M #0#72, 1, aAlfa1;
      |C_M #0#73, 1, aAlfa1;
      |C_M #0#74, 1, aAlfa1;
  |FINSI;

  |SI Campo = 83;
      |C_M #0#76, 1, aAlfa1;
      |C_M #0#78, 1, aAlfa1;
      |C_M #0#79, 1, aAlfa1;
      |C_M #0#81, 1, aAlfa1;
      |C_M #0#82, 1, aAlfa1;
  |FINSI;

  |SI Campo = 92;
      |C_M #0#85, 1, aAlfa1;
      |C_M #0#86, 1, aAlfa1;
      |C_M #0#87, 1, aAlfa1;
      |C_M #0#88, 1, aAlfa1;
      |C_M #0#89, 1, aAlfa1;
      |C_M #0#90, 1, aAlfa1;
      |C_M #0#91, 1, aAlfa1;
  |FINSI;

  |SI Campo = 91; |Y #0#92 = "S";
      aAlfa1 = "S";
      |SI #0Campo = "S"; aAlfa1 = "N"; |FINSI;
      |C_M #0#85, 1, aAlfa1;
      |C_M #0#86, 1, aAlfa1;
      |C_M #0#87, 1, aAlfa1;
      |C_M #0#88, 1, aAlfa1;
      |C_M #0#89, 1, aAlfa1;
      |C_M #0#90, 1, aAlfa1;
  |FINSI;

  |SI Campo = 94;
      |C_M #0#93, 1, aAlfa1;
  |FINSI;
|FCAL;

|| ***********************************************************************
|PROCESO copiando;
  traba = " COPIANDO FICHERO: " + traba1 + "        ";
  |PINTA 2301, traba;

  temporal1 = aPathOrigen  + traba1 + ".ixx";
  temporal2 = aPathDestino + traba1 + ".ixx";
  |COPIA_FICHERO temporal1,temporal2;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  temporal1 = aPathOrigen  + traba1 + ".dat";
  temporal2 = aPathDestino + traba1 + ".dat";
  |COPIA_FICHERO temporal1,temporal2;
  |SI FSalida ! 0;
      temporal2 = aPathDestino + traba1 + ".ixx";
      |FBORRA temporal2;
      |ACABA;
  |FINSI;
  temporal1 = aPathOrigen  + traba1 + ".ddx";
  temporal2 = aPathDestino + traba1 + ".ddx";
  |COPIA_FICHERO temporal1,temporal2;
|FPRC;

|PROCESO LosCopio;
    |SI #30#2 = #0#2; |Y #30#3 = #0#3;
        |ACABA;
    |FINSI;

    aPathDestino = dirfich0;
    traba1 = "cadeflab";  |HAZ copiando;
    traba1 = "cadefxab";  |HAZ copiando;
    traba1 = "cadeflal";  |HAZ copiando;
    traba1 = "cadefxal";  |HAZ copiando;
    traba1 = "cadeflac";  |HAZ copiando;
    traba1 = "cadeflax";  |HAZ copiando;
    traba1 = "cadefxax";  |HAZ copiando;
    traba1 = "cadeflay";  |HAZ copiando;
    traba1 = "cadeflaz";  |HAZ copiando;
    traba1 = "cadefxaz";  |HAZ copiando;
|FPRC;

|| /////////////////////////////////////////////////////////////////////
|PROCESO HazTodo;

   |PATH_DAT #210 dirfich0;

   |ABRE #210;
   |LEE 141#210p;
   |SI FSalida ! 0;
       |DDEFECTO #210;
       |GRABA 020#210b;
   |FINSI;

   |SI #0#9 = "S";
       #210#78  = #0#5;
       #210#79  = #0#6;
       #210#108 = #0#7;
       #210#109 = #0#8;
       #210#110 = #0#84;
   |FINSI;

   |SI #0#18 = "S";
       #210#1   = #0#10;
       #210#2   = #0#11;
       #210#3   = #0#12;
       #210#24  = #0#13;
       #210#25  = #0#14;
       #210#26  = #0#15;
       #210#44  = #0#16;
       #210#45  = #0#17;
   |FINSI;

   |SI #0#25 = "S";
       #210#4   = #0#19;
       #210#5   = #0#20;
       #210#6   = #0#21;
       #210#27  = #0#22;
       #210#28  = #0#23;
       #210#29  = #0#24;
   |FINSI;

   |SI #0#47 = "S";
       #210#10  = #0#26;
       #210#11  = #0#27;
       #210#12  = #0#28;
       #210#75  = #0#29;
       #210#33  = #0#30;
       #210#34  = #0#31;
       #210#35  = #0#32;
       #210#63  = #0#33;
       #210#64  = #0#34;
       #210#65  = #0#35;
       #210#76  = #0#36;
       #210#66  = #0#37;
       #210#67  = #0#38;
       #210#68  = #0#39;
       #210#69  = #0#40;
       #210#70  = #0#41;
       #210#71  = #0#42;
       #210#77  = #0#43;
       #210#72  = #0#44;
       #210#73  = #0#45;
       #210#74  = #0#46;
   |FINSI;

   |SI #0#54 = "S";
       #210#49  = #0#48;
       #210#50  = #0#49;
       #210#51  = #0#50;
       #210#46  = #0#51;
       #210#47  = #0#52;
       #210#48  = #0#53;
   |FINSI;

   |SI #0#61 = "S";
       #210#7   = #0#55;
       #210#8   = #0#56;
       #210#9   = #0#57;
       #210#30  = #0#58;
       #210#31  = #0#59;
       #210#32  = #0#60;
   |FINSI;

   |SI #0#68 = "S";
       #210#16  = #0#62;
       #210#17  = #0#63;
       #210#18  = #0#64;
       #210#39  = #0#65;
       #210#40  = #0#66;
       #210#41  = #0#67;
   |FINSI;

   |SI #0#75 = "S";
       #210#13  = #0#69;
       #210#14  = #0#70;
       #210#15  = #0#71;
       #210#36  = #0#72;
       #210#37  = #0#73;
       #210#38  = #0#74;
   |FINSI;

   |SI #0#83 = "S";
       #210#19  = #0#76;
       #210#20  = #0#77;
       #210#43  = #0#78;
       #210#54  = #0#79;
       #210#55  = #0#80;
       #210#56  = #0#81;
       #210#53  = #0#82;
   |FINSI;

   |SI #0#92 = "S";
       |SI #0#91 = "S";
           #210#111 = #210#16;
           #210#112 = #210#17;
           #210#113 = #210#18;
           #210#114 = #210#39;
           #210#115 = #210#40;
           #210#116 = #210#41;
       |SINO;
           #210#111 = #0#85;
           #210#112 = #0#86;
           #210#113 = #0#87;
           #210#114 = #0#88;
           #210#115 = #0#89;
           #210#116 = #0#90;
       |FINSI;
   |FINSI;

   |SI #0#94 = "S";
       #210#117 = #0#93;
   |FINSI;

   |GRABA 020#210a;
   |LIBERA #210;
   |CIERRA #210;
|FPRC;

|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;


   |PINTA 2222, #30#2;
   |PINTA 2228, #30#3;
   |PINTA 2230, #30#1;

   dirfich0  = #caselem1#3;
   |QBF dirfich0;

   |SI #0#0 = "N";
       |HAZ HazTodo;
   |SINO;
       |HAZ LosCopio;
   |FINSI;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 00001;
 99999;
 ;
 NULL,MultiEmp1;
|FIN;

|| *************************************************************************

|CALCULO Tipo3; |TIPO 3;
   |SI #0#0 = "N";
       |SI #0#9 = "N"; |Y #0#18 = "N"; |Y #0#25 = "N"; |Y #0#47 = "N";
          |Y #0#54 = "N"; |Y #0#61 = "N"; |Y #0#68 = "N"; |Y #0#75 = "N";
         |Y #0#83 = "N"; |Y #0#92 = "N"; |Y #0#94 = "N";
           |MENAV "    NO MODIFICA NINGUN DATO DE LOS DEFECTOS DE ENTRADA";
           |ACABA;
       |FINSI;
   |FINSI;

   |DFICB aPath; |QBF aPath;
   aAlfa1 = #0#2; aAlfa1 = ("00000" + aAlfa1) % -105;
   aAlfa2 = #0#3; aAlfa2 = ("0"     + aAlfa2) % -101;
   aPathOrigen = aPath + aAlfa1 + aAlfa2 + "/";

   |SUB_EJECUTA "caselemp";
   |NOME_DAT #998 eaFichsel;
   |ATRI R; |PINTA 2202, "Procesando Empresa: "; |ATRI 0;
   |BUCLE MultiEmp0;
   |DELINDEX #998;
|FCAL;
