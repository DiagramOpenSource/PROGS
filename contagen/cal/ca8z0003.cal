|FICHEROS;
  ca8m0003 #0,MANTE;
  cacuenta #1;
  ca8cumay #2;
  &cacuent@ #3;

  ca8z0003 #10;
  canempre #30;

  ca8ctrle #400;  ||Control Empresa
  ca8comay #401;  ||Control Cuentas de mayor
|FIN;

|VARIABLES;
 &nSwQueO    = 0;
 &enConsulta = 0;

 nInkey    = 0;
 aAlfa1    = "";
 aAlfa2    = "";
 nNumero   = 0;
 nNume1    = 0;
 nNume2    = 0;
 aDirBase  = "";
 &aPathPlan = "";
 nEstado   = 0;
 aMas      = "";
 aDef      = "";
 fFecha    = @;
|FIN;

|INCLUYE dscont_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\

|PROCESO ca8m00003;
     #0#7 = "N";

     |SI #0#0 ! #0#2;
         #0#7 = "S";
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE ca8m0003;
     #0#1;
     ;
     "            ";
     "zzzzzzzzzzzz";
     be;
     NULL, ca8m00003;
|FIN;

|RUTINA min;
  #0#0  = "           ";
|FRUT;

|RUTINA max;
  #0#0 = "zzzzzzzzzzzz";
|FRUT;

|RUTINA min3;
  #0#0  = "           ";
  #0#7  = "S";
|FRUT;

|RUTINA max3;
  #0#0 = "zzzzzzzzzzzz";
  #0#7  = "S";
|FRUT;

|| ****************************************************************
|PROCESO Alta400;
       #400#4 = enPeriodo - 1; |SI #400#4 < 0; #400#4 = 9; |FINSI;
       |ABRE #30;
       |SELECT #4#30;
       #30#2 = enEmpresa;
       #30#26 = 07;
       |LEE 041#30=;
       |SI FSalida = 0;
           #400#4 = #30#3;
       |FINSI;
       |CIERRA #30;
       #400#0 = enEmpresa;
       #400#1 = enPeriodo;
       #400#2 = eNum2008;
       #400#3 = enEmpresa;
       #400#5 = 0;
       fFecha = ~; #400#6 = fFecha;
       aAlfa1 = Usuario % 810; #400#7 = aAlfa1;
       |GRABA 020#400n;
|FPRC;

|PROGRAMA;

   |HAZ inicio;
   |SI enEjercicio ! 2008;
       aAlfa1 = "    Proceso para el Ejercicio 2008. No ejecutable en el " + enEjercicio;
       |MENAV aAlfa1;
       |ACABA;
   |FINSI;

   |DFICB eaPath2008;

   |ABRE #400;
   |DDEFECTO #400;
   #400#0 = enEmpresa;
   #400#1 = enPeriodo;
   |LEE 000#400=;
   |SI FSalida ! 0;

       |ABRE #0;
       #0#0 = "";
       |LEE 040#0];
       |SI FSalida ! 0;
           |MENAV "    No realizada la Adaptacion del Plan Contable 2008. ";
           |CIERRA #0;
           |CIERRA #400;
           |ACABA;
       |FINSI;
       |HAZ Alta400;
       |CIERRA #0;
   |FINSI;
   |CIERRA #400;

   |SI #400#3 = 0;
       |MENAV "    Creada sin recoger del Plan Contable Anterior. No hay tabla de Equivalencia";
       |ACABA;
   |FINSI;

   |ABRE #30;
   #30#2  = #400#3;
   #30#3  = #400#4;
   |LEE 001#30=;
   |SI FSalida ! 0;
       |MENAV "    Error. Ya no existe Empresa Anterior";
       |CIERRA #30;
       |ACABA;
   |FINSI;
   |CIERRA #30;

   |ABRE #401;
   #401#0 = #400#2;
   |LEE 001#401=;
   |SI FSalida ! 0;
       |MENAV "    Error, no existe Codigo de Cuentas de Mayor";
       |CIERRA #401;
       |ACABA;
   |FINSI;
   |CIERRA #401;

   #10#0 = enEmpresa;
   #10#1 = enPeriodo;
   #10#2 = eaNombreEmp;
   #10#3 = enEjercicio;
   #10#4 = #400#3;
   #10#5 = #400#4;
   #10#6 = #30#1;
   |SI #30#26 < 80;
       #10#7 = #30#26 + 2000;
   |SINO;
       #10#7 = #30#26 + 1900;
   |FINSI;

   #10#8 = #400#2;
   #10#9 = #401#1;

   |SI #400#5 = 0;
       #10#10 = "Creacion";
   |SINO;
       #10#10 = "Apertura";
   |FINSI;
   #10#11 = #400#6;
   #10#12 = #400#7;

   |DBASE aMas;
   aDef = aMas + "def/cacuenta";
   |CARGA_DEF aDef, cacuent@;
   |SI FSalida ! 0;
       |MENAV "    Error al Carga fichero de Cuentas";
       |ACABA;
   |FINSI;

   aAlfa1 = #10#4; aAlfa1 = ("00000" + aAlfa1) % -105;
   aAlfa2 = #10#5; aAlfa2 = ("0"     + aAlfa2) % -101;
   |DFICB aPathPlan;
   aPathPlan = aPathPlan + aAlfa1 + aAlfa2 + "/";
   |PATH_DAT #3 aPathPlan;

   |CLS;
   |CABEZA "Equiv. Plan 1990 a Plan 2008";

   |PINPA #0#10;
   |PINDA #0#10;

   nSwQueO    = 2;
   enConsulta = 0;
   |PARA;  |SI;  |HACIENDO;
        |ENTLINEAL #1#0, -1, 2, 22, 0, min, max;
        |SI enConsulta = 0;
            |SAL;
        |FINSI;
        |SI enConsulta = 1;
            |BUCLE ca8m0003;
            |ENTLINEAL #3#0, -2, 4, 22, 0, min3, max3;
            enConsulta = 0;
        |FINSI;
   |SIGUE;

   |DESCARGA_DEF #cacuent@;
|FPRO;
