|FICHEROS;
     cacuenta #1;
     cacuebal #5;    || cuentas de balance
     ca8m0003 #403;
     ca8ctrle #400;  ||Control Empresa
     ca8comay #401;  ||Control Empresa
     ca8eqmay #402;  ||Control Empresa

     ca8cumay #410;
     ca8m0002 #422;
     ca8m0010 #430;
     canempre #330;
     imagen@  #11;

     canempre #30;
|FIN;

|VARIABLES;
 aAlfa1     = "";
 aAlfa2     = "";
 aAlfa3     = "";
 nNume1     = 0;
 nNume2     = 0;
 nNume3     = 0;
 period     = 0;
 nHay       = 0;

 mascara    = "";
 aLong      = "";
 nLong      = 0;
 nLong1     = 0;
 nLong2     = 0;
 nLongMax   = 0;
 nEstado    = 0;


 nSalir = 0;
 mes    = "";
 mesdes = "";
 meshas = "";
 num    = 0;

 nProv8 = 0;
 aMas   = "";
 aDef   = "";

|FIN;

|INCLUYE dscont_i;
|INCLUYE dsco08_i;
|INCLUYE defect_i;

|PROCESO ProvCta08;
  nProv8 = 1;
  |QBF eaCuenta;
  |SI dig3 = 1; nLongMax  = dig4; |FINSI;
  |SI dig3 = 2; nLongMax  = dig5; |FINSI;
  |SI dig3 = 3; nLongMax  = dig6; |FINSI;
  |SI dig3 = 4; nLongMax  = dig7; |FINSI;
  |SI dig3 = 5; nLongMax  = dig8; |FINSI;
  |SI dig3 = 6; nLongMax  = dig9; |FINSI;

||  enNivel   = dig3;
  eaCta2008 = eaCuenta;
  eaNom2008 = eaNomCta;

  eSwTabla = 0;
  |HAZ BuscoEq08;
  |SI eSwTabla = 0;
      |HAZ VerNivelNuevo;
      |HAZ eAltaPlan;
  |FINSI;
|FPRC;

|PROCESO CambioCta08;
  nProv8 = 0;
  |QBF eaCuenta;
  |SI dig3 = 1; nLongMax  = dig4; |FINSI;
  |SI dig3 = 2; nLongMax  = dig5; |FINSI;
  |SI dig3 = 3; nLongMax  = dig6; |FINSI;
  |SI dig3 = 4; nLongMax  = dig7; |FINSI;
  |SI dig3 = 5; nLongMax  = dig8; |FINSI;
  |SI dig3 = 6; nLongMax  = dig9; |FINSI;

||  enNivel   = dig3;
  eaCta2008 = eaCuenta;
  eaNom2008 = eaNomCta;

  eSwTabla = 0;
  nHay = 0;
  |PATH_DAT #1 eaPath2008;
  |PATH_DAT #5 eaPath2008;
  |PATH_DAT #403 eaPath2008;
  |ABRE #403;
  #403#0 = eaCuenta;
  |LEE 000#403=;
  |SI FSalida = 0;
      eaCta2008 = #403#2;
      eaNom2008 = #403#3;
      nHay      = 1;
      aAlfa1 = eaCta2008; |QBF aAlfa1;
      |SI aAlfa1 = "PDTE";
          eSwTabla = 1;
      |SINO;
          |HAZ VerNivelNuevo;
      |FINSI;
  |FINSI;
  |CIERRA #403;

  |SI nHay = 0;  || Lo transformo ahora
      |HAZ BuscoEq08;
      |SI eSwTabla = 0;
          |HAZ VerNivelNuevo;
          |HAZ eAltaPlan;
      |FINSI;
      |HAZ eAltaTabla;
  |FINSI;
|FPRC;

|PROCESO VerNivelNuevo;
   aLong = eaCta2008;
   |QBF aLong;
   aLong = aLong % 0;
   nLong = aLong;
   enNivel = 0;
   |SI nLong = dig4; |Y dig4 ! 0; enNivel = 1; |FINSI;
   |SI nLong = dig5; |Y dig5 ! 0; enNivel = 2; |FINSI;
   |SI nLong = dig6; |Y dig6 ! 0; enNivel = 3; |FINSI;
   |SI nLong = dig7; |Y dig7 ! 0; enNivel = 4; |FINSI;
   |SI nLong = dig8; |Y dig8 ! 0; enNivel = 5; |FINSI;
   |SI nLong = dig9; |Y dig9 ! 0; enNivel = 6; |FINSI;
|FPRC;

|PROCESO BuscoEq08;
      eSwTabla = 0;
      |ABRE #402;
      |DDEFECTO #402;

      uno = eaCuenta; |QBF uno;
      dos = uno + "000000000000";

      uno = dos % A104; nLong1 = 4;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;  |HAZ Datos08;  |ACABA;  |FINSI;

      uno = dos % A103; nLong1 = 3;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;  |HAZ Datos08;  |ACABA;  |FINSI;

      uno = dos % A102; nLong1 = 2;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;  |HAZ Datos08;  |ACABA;  |FINSI;

      uno = dos % A101; nLong1 = 1;
      #402#0 = eNum2008;
      #402#1 = uno;
      |LEE 040#402=;
      |SI FSalida = 0;
          |HAZ Datos08;
      |SINO;
          eSwTabla  = 1;
          eaCta2008 = "PDTE";
          eaNom2008 = "No existe Tabla equivalencia";
          |CIERRA #402;
      |FINSI;
|FPRC;

|PROCESO Datos08;
   eaPlan8  = #402#3;
   |QBF eaPlan8;
   |CIERRA #402;

   aAlfa1 = eaPlan8 % 0;
   nNume1 = aAlfa1;     || Longitud del Cambio
   nNume2 = nNume1 + 100; nLong2 = nNume1;

   |SI eaPlan8 = "PDTE";
       eaCta2008 = eaPlan8;
       eaNom2008 = #402#4;
       eSwTabla  = 1;
       |ACABA;
   |FINSI;

   nNume3 = 0 - ((nLongMax - nLong2) + 100)
   aAlfa1 = eaCuenta % nNume2;
   aAlfa2 = eaCuenta % nNume3;

   |SI aAlfa1 = eaPlan8;
       eaCta2008 = eaCuenta;
   |SINO;
       eaCta2008 = eaPlan8 + aAlfa2;
   |FINSI;
|FPRC;

|PROCESO eAltaTabla;

   |PATH_DAT #403 eaPath2008;
   |ABRE #403;
   |DDEFECTO #403;
   #403#0 = eaCuenta;
   |LEE 101#403=;
   nEstado = FSalida;
   |SI nEstado = 0;
       #403#4 = #403#2;
       #403#5 = #403#3;
   |FINSI;
   #403#0 = eaCuenta;
   #403#1 = eaNomCta;
   #403#2 = eaCta2008;
   #403#3 = eaNom2008;
   |SI eaCta2008 = "PDTE"; |Y #403#4 = ""; #403#4 = "116000000000"; #403#5 = #403#3; |FINSI;
   |SI nEstado ! 0; |GRABA 020#403n; |FINSI;
   |SI nEstado = 0; |GRABA 020#403a; |FINSI;
   |LIBERA #403;
   |CIERRA #403;
|FPRC;

|PROCESO eCreaPlan;
   |SI nProv8 = 1; |ACABA; |FINSI;

   num = dig1; |HAZ elmes; mesdes = mes;
   num = dig1 + 11; |SI num > 12; num = num - 12; |FINSI;
   |HAZ elmes; meshas = mes;
   |DDEFECTO #1;
   #1#0 = eaCta2008;
   #1#1 = enNivel;
   #1#2 = eaNom2008;
   #1#3 = "S";
   nMensa   = 1;
   nMensa9  = 1;
   |HAZ defect;
   || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
   mascara = #1#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 112;
   #1#54   = mascara;
   #1#55   = enNivel;
   #1#56   = mesdes;
   #1#57   = meshas;
   |GRABA 020#1n;
   |LIBERA #1;
|FPRC;

|PROCESO eAltaPlan;

  |ABRE #1;
  #1#0 = eaCta2008;
  #1#1 = enNivel;
  |LEE 001#1=;
  |SI FSalida ! 0;
      |HAZ eCreaPlan;
      |CIERRA #1;
      |ACABA;
  |FINSI;

  |SI eaCta2008 = eaCuenta; |CIERRA #1; |ACABA; |FINSI;      || ya la tenia dada de alta
  |SI #1#2      = eaNomCta; |CIERRA #1; |ACABA; |FINSI;      || ya la tenia dada de alta

  nSalir = 0;
  |PARA; |SI nSalir = 0; |HACIENDO;
        nNume1 = eaCta2008;
        nNume1 = nNume1 + 1;
        eaCta2008 = nNume1;
        aAlfa1 = eaCta2008 % nNume2;
        |SI aAlfa1 ! eaPlan8;
            nSalir = 1;     || no puedo sacarla
            eaCta2008 = "PDTE";
            eaNom2008 = "NO SE HA PODIDO CREAR";
        |SINO;
            #1#0 = eaCta2008;
            #1#1 = enNivel;
            |LEE 001#1=;
            |SI FSalida ! 0;
                |HAZ eCreaPlan;
                nSalir = 2;  ||ya lo grabo
            |SINO;
                |SI #1#2  = eaNomCta; |SAL; |FINSI;      || ya la tenia dada de alta
           |FINSI;
        |FINSI;
   |SIGUE;
   |CIERRA #1;
|FPRC;

|PROCESO elmes;
   |SI num =  1; mes = "Enero";     |FINSI;
   |SI num = 12; mes = "Diciembre"; |FINSI;
   |SI num =  2; mes = "Febrero";   |FINSI;
   |SI num =  3; mes = "Marzo";     |FINSI;
   |SI num =  4; mes = "Abril";     |FINSI;
   |SI num =  5; mes = "Mayo";      |FINSI;
   |SI num =  6; mes = "Junio";     |FINSI;
   |SI num =  7; mes = "Julio";     |FINSI;
   |SI num =  8; mes = "Agosto";    |FINSI;
   |SI num =  9; mes = "Septiembre";|FINSI;
   |SI num = 10; mes = "Octubre";   |FINSI;
   |SI num = 11; mes = "Noviembre"; |FINSI;
|FPRC;


||******************************
|PROCESO aContra8y9;
   |QBF eaCuenta;
   |SI dig3 = 1; nLongMax  = dig4; |FINSI;
   |SI dig3 = 2; nLongMax  = dig5; |FINSI;
   |SI dig3 = 3; nLongMax  = dig6; |FINSI;
   |SI dig3 = 4; nLongMax  = dig7; |FINSI;
   |SI dig3 = 5; nLongMax  = dig8; |FINSI;
   |SI dig3 = 6; nLongMax  = dig9; |FINSI;

   eSwT8y9   = 1;
   eaCon8y9  = "";
   eaTit8y9  = "";
   eaRaiz89 = "";

   |ABRE #430;
   |DDEFECTO #430;

   uno = eaCuenta; |QBF uno;
   dos = uno + "000000000000";

   uno = dos % A105; nLong1 = 5;  || no doy opcion a la de 5
   #430#5 = enEjerBal;
   #430#0 = eNum2008;
   #430#1 = uno;
   |LEE 040#430=;
   |SI FSalida = 0;  |HAZ Datos8y9;  |ACABA;  |FINSI;

   uno = dos % A104; nLong1 = 4;
   #430#5 = enEjerBal;
   #430#0 = eNum2008;
   #430#1 = uno;
   |LEE 040#430=;
   |SI FSalida = 0;  |HAZ Datos8y9;  |ACABA;  |FINSI;

   uno = dos % A103; nLong1 = 3;
   #430#5 = enEjerBal;
   #430#0 = eNum2008;
   #430#1 = uno;
   |LEE 040#430=;
   |SI FSalida = 0;  |HAZ Datos8y9;  |ACABA;  |FINSI;

   uno = dos % A102; nLong1 = 2;
   #430#5 = enEjerBal;
   #430#0 = eNum2008;
   #430#1 = uno;
   |LEE 040#430=;
   |SI FSalida = 0;  |HAZ Datos8y9;  |ACABA;  |FINSI;

   uno = dos % A101; nLong1 = 1;
   #430#5 = enEjerBal;
   #430#0 = eNum2008;
   #430#1 = uno;
   |LEE 040#430=;
   |SI FSalida = 0;
       |HAZ Datos8y9;
   |SINO;
       |CIERRA #402;
   |FINSI;
|FPRC;

|PROCESO Datos8y9;
   |CIERRA #430;

   eSwT8y9  = 0;
   eaRaiz89 = "";
   eaCon8y9 = "";
   eaTit8y9 = "";;
   aAlfa3   = #430#3; |QBF aAlfa3;
   eaRaiz89 = aAlfa3;

   aAlfa1    = aAlfa3 % -101;
   |SI aAlfa1 = "*";
       eaCon8y9 = aAlfa3 - aAlfa1;
       eaRaiz89 = eaCon8y9;
       eSwT8y9 = 3;
       |ACABA;
   |FINSI;

   aAlfa1 = aAlfa3 % 0;
   nNume1 = aAlfa1;    || Longitud del Cambio
   nNume2 = nNume1 + 100; nLong2 = nNume1;

   |SI aAlfa3 = "";
       eSwT8y9 = 2;
       |ACABA;
   |FINSI;

   nNume3 = 0 - ((nLongMax - nLong2) + 100)
   aAlfa1 = eaCuenta % nNume2;
   aAlfa2 = eaCuenta % nNume3;

   eaCon8y9 = aAlfa3 + aAlfa2;

   |DBASE aMas;
   aDef = aMas + "def/cacuenta";
   |CARGA_DEF aDef, imagen@;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |ABRE #11;
   #11#0 = eaCon8y9;
   |LEE 041#11=;
   |SI FSalida = 0;
       enNivel  = #11#1;
       eaTit8y9 = #11#2;
   |SINO;
       nNume2 = 100 + nLongMax;
       eaCon8y9 = (aAlfa3 + "000000000000") % nNume2;
       #11#0 = eaCon8y9;
       |LEE 041#11=;
       |SI FSalida = 0;
           enNivel  = #11#1;
           eaTit8y9 = #11#2;
       |SINO;
           eaCon8y9 = aAlfa3;
       |FINSI;
   |FINSI;
   |CIERRA #11;
   |DESCARGA_DEF #11;
|FPRC;

|PROCESO eCam_Primero;
   eaPath08 = "";
   |SI enEjercicio = 2008;
       eaPath08 = dirfich0;
   |SINO;
       |SALVA_DATOS #30;
       |ABRE #30;
       |SELECT #4#30;
       #30#2  = enEmpresa;
       #30#26 = 8;
       |LEE 001#30=;
       |SI FSalida = 0;
           aAlfa1 = #30#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
           aAlfa2 = #30#3; |QBF aAlfa2; aAlfa2 = ("0"     + aAlfa2) % -101;
           |DFICB eaPath08;
           eaPath08 = eaPath08 + aAlfa1 + aAlfa2 + "/";
       |FINSI;
       |SELECT #1#30;
       |CIERRA #30;
       |REPON_DATOS #30;
   |FINSI;
|FPRC;

|PROCESO eCam_Segundo;
   eaCta08 = eaCuenta;
   eaCta90 = eaCuenta;
   |SI eaPath08 ! "";
       |PATH_DAT #403 eaPath08;
       |ABRE #403;
       |DDEFECTO #403;
       |SI enBEjer ] 2008;
           |SELECT #2#403;
           #403#2 = eaCuenta;
           |LEE 041#403];
           |SI FSalida = 0; |Y #403#2 = eaCuenta;
               eaCta08 = #403#2;
               eaCta90 = #403#0;
           |FINSI;
           |SELECT #1#403;
       |SINO;
           #403#0 = eaCuenta;
           |LEE 041#403=;
           |SI FSalida = 0;
               eaCta08 = #403#2;
               eaCta90 = #403#0;
           |FINSI;
       |FINSI;
       |CIERRA #403;
   |FINSI;
|FPRC;
