|FICHEROS;
   cacuenta #0;
   cacuebal #1;
   paagicon #2;
   :/modelos/def/dsmom030 #3;
   camaasil #4;
   camaasic #6;
   caclipro #7;
   calibros #9;

   camaniva #10;
   caivalin #11;

   camandia #13;
   caprovin #14;
   caconasi #15;

   cacuepre #18;
  || camocabe #19;
  || camoline #21;
   caw00004 #100;
   caconasi #20;
|FIN;

/*
****************************
Longitudes:
cuentas -----> 642     cacuenta
conceptos --->  33     dsmom030
lineas apunt.> 126     camaasil
clientes ----> 326     caclipro
proveedores -> 326     caclipro
libros ------>  32     calibros
repercutido -> 462     caivarep
soportado ---> 461     caivasop
bancos ------> 384     camanban
cobros ------> 301     camancob
pagos -------> 246     camanpag
presupuestos > 167     cacuepre
amortizacion > 262     camocabe
****************************
*/

|VARIABLES;
   &error = "INEXISTENTE Cuentas Balance";
   &erro = 0

   &eaDirDestino = "";
   &eaRenumera   = "";

   aAsie = "";
   informe = "caliserr";
   fiche="";
   traba="";
   canal= "";
   canal1= "";
   canal2= "";
   canal3= "";
   canal4= "";
   canal5= "";
   handle="";
   vari1="rb";
   espacio=" ";
   menos=-1;
   mascara = "";
   uno = "";
   dos = "";
   saber = "";
   men1  = "     NO EXISTE EMPRESA !";
   men2  = "     Longitud de Cuenta Fuera de Nivel !";
   fecalf = "";
   pepito="";
   sinnu="S/N";
   mensa1="     ERROR no existe el fichero";
   mensa2="     ERROR en la lectura del secuencial";
   mensa3="     ERROR longitud de registro invalida";
   val = 0;
   val1 = 0;
   val2 = 0;
   val3 = 0;
   val4 = 0;
   fec = @;
   linea = 0;
   trab1 = "";
   prima = @;
   long = "  ";
   parte = "";
   parte1 = "";
   ulti = "";
   feini = @;
   fefin = @;
   doini = 1;
   dofin = 999999;

   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   eixida = 0;
   trim1 = @;
   trim2 = @;
   trim3 = @;
   mayor = 0;
   pepe1 = 0;
   pepe2 = 0;
   pepe3 = 0;
   pepe4 = 0;
   pepe5 = 0;
   para1 = 0;
   para2 = 0;
   para3 = 0;
   para4 = 0;
   sw_dir = 0;

|FIN;

|INCLUYE dscont_i;

*************************************************************************
CALCULOS DESDE CAMPOS
*************************************************************************

|PROCESO hazfiche; |TIPO 0;
   #paagicon#1 = "scue" + #paagicon#0;
   #paagicon#3 = "smov" + #paagicon#0;
   #paagicon#4 = "scli" + #paagicon#0;
   #paagicon#5 = "spro" + #paagicon#0;
   #paagicon#6 = "snat" + #paagicon#0;
   #paagicon#7 = "shic" + #paagicon#0;
   #paagicon#8 = "shiv" + #paagicon#0;
   #paagicon#9 = "sban" + #paagicon#0;
   #paagicon#10 = "scob" + #paagicon#0;
   #paagicon#11 = "spag" + #paagicon#0;
   #paagicon#12 = "spre" + #paagicon#0;
||   #paagicon#13 = "samo" + #paagicon#0;
   |PINDA #0#2;
|FPRC;

|PROCESO def_dir; |TIPO 7;
   |SI sw_dir = 0;
      alfa1 = "";
      |DIRECTORIO alfa1;
      #paagicon#14 = alfa1;
      |PINTA #paagicon#14;
      sw_dir = 1;
   |FINSI;
|FPRC;

*************************************************************************
ACTUALIZACION DE CABS. DE APUNTES DESDE IMPORTACION DE APUNTES
*************************************************************************

|PROCESO actuali;
   |DDEFECTO #6;
   #camaasic#0 = #camaasil#0;
   #camaasic#1 = #camaasil#1;
   #camaasic#2 = #camaasil#2;
   |LEE 101#6=;
   |SI FSalida ! 0;
      #camaasic#0 = #camaasil#0;
      #camaasic#1 = #camaasil#1;
      #camaasic#2 = #camaasil#2;
      #camaasic#3 = #camaasil#2;
      |GRABA 020#6b;
   |FINSI;
   |SI #camaasil#8 = "D";
      #camaasic#4 = #camaasic#4 + #camaasil#9;
      |SI #camaasic#09 = 0; #camaasic#08 = #camaasil#4; #camaasic#09 = #camaasil#5; |FINSI;      || contrp.HABER
   |SINO;
      #camaasic#5 = #camaasic#5 + #camaasil#9;
      |SI #camaasic#11 = 0; #camaasic#10 = #camaasil#4; #camaasic#11 = #camaasil#5; |FINSI;      || contrp.DEBE
   |FINSI;
   #camaasic#6 = #camaasic#4 - #camaasic#5;
   |GRABA 020#6a;
   |LIBERA #6;
|FPRC;

|DEFBUCLE paagicon0;
   #4#1;
   ;
   00, feini, doini,    1;
   99, fefin, dofin, 9999;
   be;
   NULL, actuali;
|FIN;

*************************************************************************
CALCULO PADRE
*************************************************************************

|PROCESO pase; |TIPO 3;
   FSalida = 0;
   |SI eaDirDestino = "";  |IMPRE 0;  |FINSI;
   |SI FSalida = 0;

      alfa1 = #paagicon#14;   |QBT alfa1;
      alfa2 = alfa1 % -101;
      |SI alfa2 ! "/";     alfa1 = alfa1 + "/";     |FINSI;
      vari1 = "rb  " + alfa1;

      |SI eaDirDestino = "";  |INFOR informe;  |FINSI;
      |PARA para1 = 1; |SI para1 [ 13; |HACIENDO para1 = para1 + 1;
         alfa1 = #paagicon#para1#;  |QBT alfa1;
         |SI alfa1 ! "*";|Y alfa1 ! "";
            |SI para1 = 1;    |HAZ hazcuent; |FINSI;
            |SI para1 = 3;    |HAZ hazmovim; |FINSI;
            |SI para1 = 4;    |HAZ hazclien; |FINSI;
            |SI para1 = 5;    |HAZ hazprove; |FINSI;
            |SI para1 = 6;    |HAZ hazlibro; |FINSI;
            ||SI para1 = 7;    |HAZ hazcompr; |FINSI;
            |SI para1 = 8;    |HAZ haziva;   |FINSI;
            |SI para1 = 12;   |HAZ hazpresu; |FINSI;
           || |SI para1 = 13;   |HAZ hazamort; |FINSI;
            |PINTA 2040, "                                       ";
         |FINSI;
      |SIGUE;
      |SI eaDirDestino = "";
         |PIEINF;
         |FININF;
      |FINSI;
   |FINSI;
   |SI eaDirDestino = "";
      |FINIMP;
   |FINSI;
|FPRC;

|PROCESO hazcuent;
   |ABRET #0;
   |ABRET #1;
   fiche=vari1 + #paagicon#1;
   |QBF fiche;
   |FABRE fiche;               ||  fichero de cuentas;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal  = handle + " 202";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida > 0;
            canal1 = handle + " 204";
            |FLEE canal1;
            eixida = FSalida;
            |SI FSalida > 0;
               canal2 = handle + " 236";
               |FLEE canal2;
               eixida = FSalida;
               |SI FSalida > 0;
                  |HAZ separa;
               |FINSI;
            |FINSI;
         |FINSI;
      |SIGUE;
      |FCIERRA handle;
      Pos = -1;
   |FINSI;
   |CIERRAT #0;
   |CIERRAT #1;
|FPRC;

|PROCESO hazmovim;
   mayor = 0;
   |ABRET #3;
   |ABRET #4;
   |ABRET #100;
   |ABRET #13;
   fiche=vari1 + #paagicon#3;           ||       FICHERO DE MOVIMIENTOS;
   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 126";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida ] 0;
            |HAZ sepdia;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   |CIERRAT #3;
   |CIERRAT #4;
   |CIERRAT #100;
   |CIERRAT #13;

   |ABRE #6;
   |CIERRA #6;
   |DELINDEX #6;
   |PINTA 2040," Recuperando Saldos de Cabeceras ...";
   |ABRE #6;
   feini = "01.01.0000";
   fefin = "31.12.9999";
   doini = 1;
   dofin = 999999;
   |BUCLE paagicon0;
   |CIERRA #6;

   |ABRE #15;
   |LEE 001#15p;
   |SI FSalida = 0;  |BORRA 020#15a;  |FINSI;
   |DDEFECTO #15;
   #caconasi#1 = mayor;
   |GRABA 020#15n;
   |CIERRA #15;
|FPRC;

|PROCESO hazclien;
   |ABRET #7;
   |ABRET #14;
   fiche=vari1 + #paagicon#4;
   |QBF fiche;
   |FABRE fiche;               ||  fichero de CLIENTES;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 206";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida > 0;
            canal1 = handle + " 163";    ||125
            |FLEE canal1;
            eixida = FSalida;
            |SI FSalida > 0;
               |HAZ sepcli;
            |FINSI;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   |CIERRAT #7;
   |CIERRAT #14;
|FPRC;

|PROCESO hazprove;
   |ABRET #7;
   |ABRET #14;
   fiche=vari1 + #paagicon#5;
   |QBF fiche;
   |FABRE fiche;               ||  fichero de PROVEEDORES;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 206";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida > 0;
            canal1 = handle + " 163";
            |FLEE canal1;
            eixida = FSalida;
            |SI FSalida > 0;
               |HAZ seppro;
            |FINSI;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   |CIERRAT #7;
   |CIERRAT #14;
|FPRC;

|PROCESO hazlibro;
   |ABRET #9;
   fiche=vari1 + #paagicon#6;
   |QBF fiche;
   |FABRE fiche;               ||  fichero de LIBROS DE IVA
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 32";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida ] 32;
            |HAZ seplib;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   |CIERRAT #9;
|FPRC;

|PROCESO haziva;
   |ABRET #3;
   |ABRET #7;
   |ABRET #9;
   |ABRET #11;
   fiche=vari1 + #paagicon#7;
   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 227";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida > 0;
            canal1 = handle + " 234";
            |FLEE canal1;
            eixida = FSalida;
            |SI FSalida > 0;
               |HAZ sepven;
            |FINSI;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   fiche=vari1 + #paagicon#8;
   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 227";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida > 0;
            canal1 = handle + " 235";
            |FLEE canal1;
            eixida = FSalida;
            |SI FSalida > 0;
               |HAZ sepven;
            |FINSI;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   |CIERRAT #3;
   |CIERRAT #7;
   |CIERRAT #9;
   |CIERRAT #11;
|FPRC;


|PROCESO hazpresu;
   |ABRET #18;
   fiche=vari1 + #paagicon#12;
   |QBF fiche;
   |FABRE fiche;
   |SI FSalida ] 0;
      handle = FSalida;
      eixida = 1;  || para que entre en el bucle
      |PARA; |SI eixida > 0; |HACIENDO;
         canal = handle + " 167";
         |FLEE canal;
         eixida = FSalida;
         |SI FSalida > 0;
            |HAZ seppre;
         |FINSI;
      |SIGUE;
   |FINSI;
   |FCIERRA handle;
   Pos = -1;
   |CIERRAT #18;
|FPRC;


*************************************************************************
'field' DEL PLAN CONTABLE
*************************************************************************

|PROCESO separa;
   traba = canal % 1301;
   #cacuenta#1 = traba;              || digito
   |SI #cacuenta#1 = 1;  val = 100 + dig4;  |FINSI;
   |SI #cacuenta#1 = 2;  val = 100 + dig5;  |FINSI;
   |SI #cacuenta#1 = 3;  val = 100 + dig6;  |FINSI;
   |SI #cacuenta#1 = 4;  val = 100 + dig7;  |FINSI;
   |SI #cacuenta#1 = 5;  val = 100 + dig8;  |FINSI;
   |SI #cacuenta#1 = 6;  val = 100 + dig9;  |FINSI;
   trab1 = val;
   traba = canal % 112;
   #cacuenta#0 = traba % trab1;    || cuenta
   |LEE 101#0=;
   |SI FSalida = 0;
      |HAZ separa1;
      |GRABA 020#0a;
   |SINO;
      |DDEFECTO #0;
      |HAZ separa1;
      |GRABA 020#0n;
   |FINSI;
   |LIBERA #0;
   saber = " Actualizada Cuenta .: " + #cacuenta#0;
   |PINTA 2040,saber;
|FPRC;

|PROCESO separa1;
   traba = canal % 1301;
   #cacuenta#1 = traba;          || digito
   |SI #cacuenta#1 = 1;  val = 100 + dig4;  |FINSI;
   |SI #cacuenta#1 = 2;  val = 100 + dig5;  |FINSI;
   |SI #cacuenta#1 = 3;  val = 100 + dig6;  |FINSI;
   |SI #cacuenta#1 = 4;  val = 100 + dig7;  |FINSI;
   |SI #cacuenta#1 = 5;  val = 100 + dig8;  |FINSI;
   |SI #cacuenta#1 = 6;  val = 100 + dig9;  |FINSI;
   trab1 = val;
   traba = canal % 112;
   #cacuenta#0 = traba % trab1;    || cuenta
   traba = canal % 1436;
   #cacuenta#2 = traba;            || descripcion
   traba = canal % 5001;
   #cacuenta#3 = traba;            || pase directo
   || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
   mascara = #cacuenta#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 112;
   #cacuenta#54    = mascara;
   #cacuenta#55    = #cacuenta#1;
   uno = #cacuenta#0;
   |QBF uno;
   dos = uno + "000000000000";
   uno = dos % A101;
   #cacuebal#0 = uno;
   |LEE 040#1=;
   |SI FSalida = 0;
      |HAZ saca;       || recoge bloque,tipo,agrupacion,epigrafe,partida
      |VETE findefe;
   |FINSI;
   uno = dos % A102;
   #cacuebal#0 = uno;
   |LEE 040#1=;
   |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
   |FINSI;
   uno = dos % A103;
   #cacuebal#0 = uno;
   |LEE 040#1=;
   |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
   |FINSI;
   uno = dos % A104;
   #cacuebal#0 = uno;
   |LEE 040#1=;
   |SI FSalida = 0;
      |HAZ saca;
      |VETE findefe;
   |SINO;
      error = "INEXISTENTE Cuentas Balance";
      |SI eaDirDestino = "";  |PRINT;  |FINSI;
   |FINSI;
   |ET findefe;
   |PARA nume1 =  9; |SI nume1 [ 20; |HACIENDO nume1 = nume1 + 1;
      nume2 = ( (59+ ((nume1-9)*12) ) * 100) + 12;
      alfa1 = nume2;
      traba = canal % alfa1;
      #cacuenta#nume1# = traba;
   |SIGUE;
   |PARA nume1 = 21; |SI nume1 [ 37; |HACIENDO nume1 = nume1 + 1;
      nume2 = ( (1+ ((nume1-21)*12) ) * 100) + 12;
      alfa1 = nume2;
      traba = canal1 % alfa1;
      #cacuenta#nume1# = traba;
   |SIGUE;
   |PARA nume1 = 38; |SI nume1 [ 53; |HACIENDO nume1 = nume1 + 1;
      nume2 = ( (1+ ((nume1-38)*12) ) * 100) + 12;
      alfa1 = nume2;
      traba = canal2 % alfa1;
      #cacuenta#nume1# = traba;
   |SIGUE;
   traba = canal2 % 20610;
   #cacuenta#56 = traba;
   traba = canal2 % 21610;
   #cacuenta#57 = traba;
   traba = canal2 % 22610;
   #cacuenta#58 = traba;
|FPRC;

|PROCESO saca;
   #cacuenta#4 = #cacuebal#1;
   #cacuenta#5 = #cacuebal#2;
   #cacuenta#6 = #cacuebal#3;
   #cacuenta#7 = #cacuebal#4;
   #cacuenta#8 = #cacuebal#5;
|FPRC;

*************************************************************************
'field' DE LINEAS DE APUNTES
*************************************************************************

|PROCESO GrabaTempo;
   #caw00004#0 = #camaasil#0;
   #caw00004#1 = #camaasil#1;
   #caw00004#2 = traba;
   #caw00004#3 = #camaasil#0;
   #caw00004#4 = #camaasil#1;
   #caw00004#5 = #caconasi#1;
   |GRABA 020#100n;
   |LIBERA #100;
|FPRC;

|PROCESO sepdia;
   traba = canal %  102;   #camaasil#0 = traba;  || diario
   traba = canal %  310;   #camaasil#1 = traba;  || fecha
   traba = canal % 1306;   #camaasil#2 = traba;  || documento

   |SI eaRenumera = "S";
      |SI aAsie ! traba;
         |HAZ contador;
         |HAZ GrabaTempo;
         aAsie = traba;
      |FINSI;
      #camaasil#2 = #caconasi#1;
   |FINSI;

   traba = canal % 1904;
   #camaasil#3 = traba;  || apunte
   |SI #camaasil#1 ] fec1; |Y #camaasil#1 [ fec2;
      |LEE 100#4=;
      |SI FSalida ! 0;
         |DDEFECTO #4;
         |HAZ sepdia1;
         |HAZ sepdia2;
         |GRABA 020#4n;
         |SI mayor < #camaasil#2;  mayor = #camaasil#2;  |FINSI;      || contador asientos
      |SINO;
         |HAZ sepdia1;
         |HAZ sepdia2;
         |GRABA 020#4a;
      |FINSI;
      |LIBERA #4;
      saber = " Recuperando fecha ..: "+ #camaasil#1;
      |PINTA 2040,saber;
   |FINSI;
|FPRC;

|PROCESO sepdia1;
   traba = canal %  102;  #camaasil#0 = traba;  || diario
   traba = canal %  310;  #camaasil#1 = traba;  || fecha
   |SI eaRenumera = "S";
      #camaasil#2 = #caconasi#1;
   |SINO;
      traba = canal % 1306;  #camaasil#2 = traba;  || documento
   |FINSI;
   traba = canal % 1904;  #camaasil#3 = traba;  || apunte
   traba = canal % 3501;
   #camaasil#5 = traba;  || digito
   |SI #camaasil#5 = 1;  val = 100 + dig4;  |FINSI;
   |SI #camaasil#5 = 2;  val = 100 + dig5;  |FINSI;
   |SI #camaasil#5 = 3;  val = 100 + dig6;  |FINSI;
   |SI #camaasil#5 = 4;  val = 100 + dig7;  |FINSI;
   |SI #camaasil#5 = 5;  val = 100 + dig8;  |FINSI;
   |SI #camaasil#5 = 6;  val = 100 + dig9;  |FINSI;
   trab1 = val;
   traba = canal % 2312;
   #camaasil#4 = traba % trab1;  || cuenta (segun digito)
   traba = canal % 3603;
   #camaasil#6 = traba;    || concepto
   |SI #camaasil#6 = 0;  #camaasil#6 = 999;    |FINSI;   || no se admite concepto cero
   traba = canal % 3930;
   #camaasil#7 = traba;    || descrip. concepto
   traba = canal % 6901;
   #camaasil#8 = traba;   || signo
   traba = canal % 7011;
   #camaasil#9 = traba;   || importe
   traba = canal % 8112;
   |SI #camaasil#8 = "D";
      #camaasil#16 = #camaasil#4;
      #camaasil#17 = #camaasil#5;
      #camaasil#10 = "";
      #camaasil#11 = 0;
   |SINO;
      #camaasil#16 = "";
      #camaasil#17 = 0;
      #camaasil#10 = #camaasil#4;
      #camaasil#11 = #camaasil#5;
   |FINSI;
   traba = canal % 9401;
   #camaasil#12 = traba;  || tipo ficha
   traba = canal % 9502;
   #camaasil#13 = traba;  || libro
   traba = canal % 9706;
   #camaasil#14 = traba;  || orden
   traba = canal % 10302;
   #camaasil#15 = traba;  || serie
   traba = canal % 11801;
   #camaasil#18 = traba;  || punteado
   traba = canal % 11901;
   #camaasil#19 = traba;  || tipo de acumulador iva
   traba = canal % 12001;
   #camaasil#20 = traba;  || nro. de acumulador iva
   traba = canal % 12102;
   #camaasil#21 = traba;  || departamento
   traba = canal % 12303;
   #camaasil#22 = traba; ||numero de recibo
   traba = canal % 12601;
   #camaasil#23 = traba; ||Exportado
|FPRC;

|PROCESO sepdia2;  || COMPRUEBA CONCEPTOS Y ACTUALIZA DIARIO
   #dsmom030#0 = #camaasil#6;
   |LEE 000#3=;
   |SI FSalida ! 0;    || si no existe el concepto lo genera con la descripcion
      |DDEFECTO #3;   ||/del apunte
      #dsmom030#0 = #camaasil#6;
      #dsmom030#1 = #camaasil#7;
      |GRABA 020#3n;
   |FINSI;

   #camandia#0 = #camaasil#0;
   |LEE 100#13=;
   |SI FSalida ! 0;
      |DDEFECTO #13;
      #camandia#0 = #camaasil#0;
      #camandia#1 = "<DIARIO IMPORTACION>";
      |LIBERA #13;
      |GRABA 020#13c;
      |LEE 100#13=;
   |FINSI;
   |SI #camaasil#8 = "D";  #camandia#2 = #camandia#2 + #camaasil#9;  |FINSI;
   |SI #camaasil#8 = "H";  #camandia#3 = #camandia#3 + #camaasil#9;  |FINSI;
   |GRABA 020#13a;
   |LIBERA #13;
|FPRC;

*************************************************************************
'field' DE CLIENTES
*************************************************************************

|PROCESO sepcli;
   traba = canal % 20501;
   #caclipro#11 = traba;        || dig. cuenta
   |SI #caclipro#11 = 1;  val = 100 + dig4;  |FINSI;
   |SI #caclipro#11 = 2;  val = 100 + dig5;  |FINSI;
   |SI #caclipro#11 = 3;  val = 100 + dig6;  |FINSI;
   |SI #caclipro#11 = 4;  val = 100 + dig7;  |FINSI;
   |SI #caclipro#11 = 5;  val = 100 + dig8;  |FINSI;
   |SI #caclipro#11 = 6;  val = 100 + dig9;  |FINSI;
   trab1 = val;
   traba = canal % 19312;
   #caclipro#10 = traba % trab1;  || cta. contable (segun digito)
   #caclipro#23 = "C";
   |LEE 100#7=;
   |SI FSalida = 0;
      |HAZ sepcli1;
      |GRABA 020#7a;
   |SINO;
      |DDEFECTO #7;
      #caclipro#23 = "C";
      |HAZ sepcli1;
      |GRABA 020#7n;
   |FINSI;
   |LIBERA #7;
   saber = " Actualizando Cliente: " + #caclipro#0;
   |PINTA 2040,saber;
|FPRC;

|PROCESO sepcli1;
   traba = canal % 112;
   #caclipro#0 = traba;    || codigo cliente
   traba = canal % 1340;
   #caclipro#1 = traba;    || razon social
   traba = canal % 5350;
   #caclipro#2 = traba;    || direccion
   traba = canal % 10302;
   #caclipro#3 = traba;    || codigo provincia
   traba = canal % 10503;
   #caclipro#4 = traba;    || codigo poblacion
   #caprovin#0 = #caclipro#3;
   |LEE 000#14=;
   |SI FSalida ! 0;  |DDEFECTO #14;  |FINSI;
   #caclipro#5 = #caprovin#1;         || provincia
   traba = canal % 12325;
   #caclipro#6 = traba;         || poblacion
   traba = canal % 14815;
   #caclipro#7 = traba;         || telefono
   traba = canal % 16315;
   #caclipro#8 = traba;         || fax
   traba = canal % 17815;
   #caclipro#9 = traba;         || cif
   traba = canal % 20501;
   #caclipro#11 = traba;        || dig. cuenta
   |SI #caclipro#11 = 1;  val = 100 + dig4;  |FINSI;
   |SI #caclipro#11 = 2;  val = 100 + dig5;  |FINSI;
   |SI #caclipro#11 = 3;  val = 100 + dig6;  |FINSI;
   |SI #caclipro#11 = 4;  val = 100 + dig7;  |FINSI;
   |SI #caclipro#11 = 5;  val = 100 + dig8;  |FINSI;
   |SI #caclipro#11 = 6;  val = 100 + dig9;  |FINSI;
   trab1 = val;
   traba = canal % 19312;
   #caclipro#10 = traba % trab1;  || cta. contable (segun digito)
   traba = canal % 20601;
   #caclipro#12 = traba;          || grupo iva

   traba = canal1 %  130;
   #caclipro#13 = traba;          || nombre banco
   traba = canal1 % 3130;
   #caclipro#14 = traba;          || direccion banco
   traba = canal1 % 6102;
   #caclipro#15 = traba;          || cod.post.1 banco
   traba = canal1 % 6303;
   #caclipro#16 = traba;          || cod.post.2 banco
   traba = canal1 % 6620;
   #caclipro#17 = traba;          || cta. cte.
   traba = canal1 % 8615;
   #caclipro#18 = traba;          || C.C.C.
   traba = canal1 % 10125;
   #caclipro#19 = traba;          || poblacion banco
|FPRC;

*************************************************************************
'field' DE PROVEEDORES
*************************************************************************

|PROCESO seppro;
   traba = canal % 20501;
   #caclipro#11 = traba;        || dig. cuenta
   |SI #caclipro#11 = 1;  val = 100 + dig4;  |FINSI;
   |SI #caclipro#11 = 2;  val = 100 + dig5;  |FINSI;
   |SI #caclipro#11 = 3;  val = 100 + dig6;  |FINSI;
   |SI #caclipro#11 = 4;  val = 100 + dig7;  |FINSI;
   |SI #caclipro#11 = 5;  val = 100 + dig8;  |FINSI;
   |SI #caclipro#11 = 6;  val = 100 + dig9;  |FINSI;
   trab1 = val;
   traba = canal % 19312;
   #caclipro#10 = traba % trab1;  || cta. contable (segun digito)
   #caclipro#23 = "P";
   |LEE 100#7=;
   |SI FSalida = 0;
      |HAZ sepcli1;
      |GRABA 020#7a;
   |SINO;
      |DDEFECTO #7;
      #caclipro#23 = "P";
      |HAZ sepcli1;
      |GRABA 020#7n;
   |FINSI;
   |LIBERA #7;
   saber = " Actualizando Proveed.:" + #caclipro#0;
   |PINTA 2040,saber;
|FPRC;


*************************************************************************
'field' DE LIBROS
*************************************************************************

|PROCESO seplib;
   traba = canal % 102;
   #calibros#0 = traba;
   |LEE 100#9=;
   |SI FSalida = 0;
      |HAZ seplib1;
      |GRABA 020#9a;
   |SINO;
      |DDEFECTO #9;
      |HAZ seplib1;
      |GRABA 020#9n;
   |FINSI;
   |LIBERA #9;
   saber = " Actualizado Libro ..: " + #calibros#0;
   |PINTA 2040,saber;
|FPRC;

|PROCESO seplib1;
   traba = canal %  102;
   #calibros#0 = traba;        || codigo
   traba = canal %  329;
   #calibros#1 = traba;        || descripcion
   traba = canal % 3201;
   #calibros#2 = traba;        || tipo de iva
|FPRC;

*************************************************************************
'field' DE REGISTRO IVA/IRPF
*************************************************************************

|PROCESO sepven;
   traba = canal % 102;
   #camaniva#0 = traba;        || libro
   traba = canal % 3306;
   #camaniva#2 = traba;        || orden
   |LEE 100#camaniva.=;
   |SI FSalida = 0;
      |HAZ sepven1;
      |HAZ sepven2;
      |GRABA 020#camaniva.a;
   |SINO;
      |DDEFECTO #camaniva;
      |HAZ sepven1;
      |HAZ sepven2;
      |GRABA 020#camaniva.n;
   |FINSI;
   |LIBERA #camaniva;
   saber = " Actualizado IVA :" + #camaniva#3 + #camaniva#2;
   |PINTA 2040,saber;
|FPRC;

|PROCESO sepven1;
   traba = canal % 102;
   #camaniva#0 = traba;       || libro
   #calibros#0 = #camaniva#0; |LEE 000#9=;
   traba = canal1 % 102;
   #camaniva#2 = traba;         || serie
   traba = canal % 3306;
   #camaniva#3 = traba;         || orden
   traba = canal % 3910;
   #camaniva#4 = traba;         || fecha
   alfa1 = fec1;      alfa1 = alfa1 %  -104;  || saca a¤o
   alfa2 = "31.03." + alfa1;  trim1 = alfa2;  || primer trimestre
   alfa2 = "30.06." + alfa1;  trim2 = alfa2;  || segundo trimestre
   alfa2 = "30.09." + alfa1;  trim3 = alfa2;  || tercer trimestre
   |SI #camaniva#4 [ trim1;                   #camaniva#5 = 1;  |FINSI;
   |SI #camaniva#4 > trim1;|Y #camaniva#4 [ trim2;  #camaniva#5 = 2;  |FINSI;
   |SI #camaniva#4 > trim2;|Y #camaniva#4 [ trim3;  #camaniva#5 = 3;  |FINSI;
   |SI #camaniva#4 > trim3;                   #camaniva#5 = 4;  |FINSI;
   || periodo (segun fecha)
   traba = canal1 % 301;
   #camaniva#6 = traba;           || liquidada
   traba = canal1 % 8402;
   #camaniva#7 = traba;           || diario
   traba = canal1 % 8610;
   #camaniva#8 = traba;           || fecha
   traba = canal1 % 9606;
   #camaniva#9 = traba;           || documento
   traba = canal1 % 10302;
   #camaniva#10 = traba;           || departamento
   traba = canal % 4912;
   #camaniva#12 = traba % trab1; || cuenta
   #caclipro#23 = "C";
   #caclipro#10 = #camaniva#12;  eaCuenta = #camaniva#12; |HAZ SacaNivel;
   #caclipro#11 = enNivel;
   |LEE 000#7=;
   |SI FSalida = 0;
      #camaniva#13 = #caclipro#1;
      #camaniva#14 = #caclipro#9;
   |SINO;
      traba = canal1 % 10536;
      #camaniva#13 = traba;           || nombre cliente/deudor
      traba = canal1 % 14115;
      #camaniva#14 = traba;           || cif cliente/deudor
   |FINSI;
   traba = canal % 6203;
   #camaniva#27 = traba;         || concepto
   traba = canal % 6530;
   #camaniva#28 = traba;         || descrip. concepto
   #camaniva#29 = #camaniva#27;  || Concepto IVA
   #camaniva#30 = #camaniva#28;  || Descripcion IVA
   #camaniva#36 = "R";


   |DDEFECTO #caivalin;
   #caivalin#0 = #camaniva#0;
   #caivalin#1 = #camaniva#1;
   #caivalin#2 = 1;
   #caivalin#3 = #camaniva#27;
   #caivalin#4 = #camaniva#28;
   traba = canal % 21501;
   #caivalin#5 = traba;        || deducible 1
   traba = canal % 9510;
   #caivalin#6 = traba;         || base 1
   traba = canal % 12505;
   #caivalin#7 = traba;        || (%) iva 1
   traba = canal % 14010;
   #caivalin#8 = traba;        || cuota iva 1
   traba = canal % 17005;
   #caivalin#9 = traba;        || (%) rec. 1
   traba = canal % 18510;
   #caivalin#10 = traba;        || cuota rec. 1
   traba = canal1 % 5210;
   #caivalin#11 = traba;        || importe dto. 1
   traba = canal1 % 1312;
   #caivalin#12 = traba;        || contrapartida 1

   || FALTAN LAS CUENTAS DE IVA, REC, IRPF Y DESCUENTO

   traba = canal1 % 702;
   #caivalin#16 = traba;           || tipo iva 1
   traba = canal1 % 10201;
   #caivalin#17 = traba;           || inversiones

   #camaniva#19 = #camaniva#19 + #caivalin#6;
   #camaniva#23 = #camaniva#23 + (#caivalin#8 + #caivalin#10);
   #camaniva#26 = #camaniva#26 + #caivalin#11;
   #camaniva#21 = #camaniva#19 + #camaniva#23 - #camaniva#26;
   |GRABA 020#caivalin.n;


   |DDEFECTO #caivalin;
   #caivalin#0 = #camaniva#0;
   #caivalin#1 = #camaniva#1;
   #caivalin#2 = 2;
   #caivalin#3 = #camaniva#27;
   #caivalin#4 = #camaniva#28;
   traba = canal % 21601;
   #caivalin#5 = traba;        || deducible 2
   traba = canal % 10510;
   #caivalin#6 = traba;         || base 2
   traba = canal % 13005;
   #caivalin#7 = traba;        || (%) iva 2
   traba = canal % 15010;
   #caivalin#8 = traba;        || cuota iva 2
   traba = canal % 17505;
   #caivalin#9 = traba;        || (%) rec. 2
   traba = canal % 19510;
   #caivalin#10 = traba;        || cuota rec. 2
   traba = canal1 % 6210;
   #caivalin#11 = traba;           || importe dto. 2
   traba = canal1 % 2512;
   #caivalin#12 = traba;           || contrapartida 2

   traba = canal1 % 902;
   #caivalin#16 = traba;           || tipo iva 2
   traba = canal1 % 10201;
   #caivalin#17 = traba;           || inversiones

   #camaniva#19 = #camaniva#19 + #caivalin#6;
   #camaniva#23 = #camaniva#23 + (#caivalin#8 + #caivalin#10);
   #camaniva#26 = #camaniva#26 + #caivalin#11;
   #camaniva#21 = #camaniva#19 + #camaniva#23 - #camaniva#26;
   |GRABA 020#caivalin.n;


   |DDEFECTO #caivalin;
   #caivalin#0 = #camaniva#0;
   #caivalin#1 = #camaniva#1;
   #caivalin#2 = 3;
   #caivalin#3 = #camaniva#27;
   #caivalin#4 = #camaniva#28;
   traba = canal % 21701;
   #caivalin#5 = traba;        || deducible 3
   traba = canal % 11510;
   #caivalin#6 = traba;        || base 3
   traba = canal % 13505;
   #caivalin#7 = traba;        || (%) iva 3
   traba = canal % 16010;
   #caivalin#8 = traba;        || cuota iva 3
   traba = canal % 18005;
   #caivalin#9 = traba;        || (%) rec. 3
   traba = canal % 20510;
   #caivalin#10 = traba;       || cuota rec. 3
   traba = canal1 % 7210;
   #caivalin#11 = traba;       || importe dto. 3
   traba = canal1 % 3712;
   #caivalin#12 = traba;       || contrapartida 3

   traba = canal1 % 1102;
   #caivalin#16 = traba;           || tipo iva 3
   traba = canal1 % 10201;
   #caivalin#17 = traba;           || inversiones

   #camaniva#19 = #camaniva#19 + #caivalin#6;
   #camaniva#23 = #camaniva#23 + (#caivalin#8 + #caivalin#10);
   #camaniva#26 = #camaniva#26 + #caivalin#11;
   #camaniva#21 = #camaniva#19 + #camaniva#23 - #camaniva#26;
   |GRABA 020#caivalin.n;


   |DDEFECTO #caivalin;
   #caivalin#0 = #camaniva#0;
   #caivalin#1 = #camaniva#1;
   #caivalin#2 = 4;
   #caivalin#3 = #camaniva#27;
   #caivalin#4 = #camaniva#28;
   #caivalin#5 = "N";
   traba = canal1 % 15610;
   #caivalin#6 = traba;           || base 4
   traba = canal1 % 17605;
   #caivalin#7 = traba;           || (%) iva 4
   traba = canal1 % 18610;
   #caivalin#8 = traba;           || cuota iva 4
   traba = canal1 % 20605;
   #caivalin#9 = traba;           || (%) rec 4
   traba = canal1 % 21610;
   #caivalin#10 = traba;           || cuota rec 4

   #camaniva#19 = #camaniva#19 + #caivalin#6;
   #camaniva#23 = #camaniva#23 + (#caivalin#8 + #caivalin#10);
   #camaniva#26 = #camaniva#26 + #caivalin#11;
   #camaniva#21 = #camaniva#19 + #camaniva#23 - #camaniva#26;
   |GRABA 020#caivalin.n;


   |DDEFECTO #caivalin;
   #caivalin#0 = #camaniva#0;
   #caivalin#1 = #camaniva#1;
   #caivalin#2 = 4;
   #caivalin#3 = #camaniva#27;
   #caivalin#4 = #camaniva#28;
   #caivalin#5 = "N";
   traba = canal1 % 16610;
   #caivalin#6 = traba;           || base 5
   traba = canal1 % 18105;
   #caivalin#7 = traba;           || (%) iva 5
   traba = canal1 % 19610;
   #caivalin#8 = traba;           || cuota iva 5
   traba = canal1 % 21105;
   #caivalin#9 = traba;           || (%) rec 5
   traba = canal1 % 22610;
   #caivalin#10 = traba;           || cuota rec 5

   #camaniva#19 = #camaniva#19 + #caivalin#6;
   #camaniva#23 = #camaniva#23 + (#caivalin#8 + #caivalin#10);
   #camaniva#26 = #camaniva#26 + #caivalin#11;
   #camaniva#21 = #camaniva#19 + #camaniva#23 - #camaniva#26;
   |GRABA 020#caivalin.n;

|FPRC;

|PROCESO sepven2;
   #dsmom030#0 = #camaniva#27;
   |LEE 000#3=;
   |SI FSalida ! 0;    || si no existe el concepto lo genera con la descripcion
      |DDEFECTO #3;   ||/del iva
      #dsmom030#0 = #camaniva#6;
      #dsmom030#1 = #camaniva#7;
      |GRABA 020#3n;
   |FINSI;

   |SI eaRenumera = "S";
      |ABRE #100;
      #caw00004#0 = #camaniva#7;
      #caw00004#1 = #camaniva#8;
      #caw00004#2 = #camaniva#9;
      |LEE 040#100=;
      |SI FSalida = 0;
         #camaniva#7 = #caw00004#3;
         #camaniva#8 = #caw00004#4;
         #camaniva#9 = #caw00004#5;
      |FINSI;
   |FINSI;
|FPRC;

*************************************************************************
CALCULO COMUN PARA SOPORTADO Y REPERCUTIDO (saca digito contrapartida)
*************************************************************************

|PROCESO conivas;
   |QBF traba;
   long = traba % 0;
   |SI long = dig4;|Y dig4 ! 0;   nume4 = 1;  |FINSI;
   |SI long = dig5;|Y dig5 ! 0;   nume4 = 2;  |FINSI;
   |SI long = dig6;|Y dig6 ! 0;   nume4 = 3;  |FINSI;
   |SI long = dig7;|Y dig7 ! 0;   nume4 = 4;  |FINSI;
   |SI long = dig8;|Y dig8 ! 0;   nume4 = 5;  |FINSI;
   |SI long = dig9;|Y dig9 ! 0;   nume4 = 6;  |FINSI;
|FPRC;

*************************************************************************
'field' DE LAS FICHAS PRESUPUESTARIAS
*************************************************************************

|PROCESO seppre;
   traba = canal % 16602;
   #cacuepre#19 = traba;
   traba = canal % 112;
   #cacuepre#0 = traba;
   traba = canal % 1301;
   #cacuepre#1 = traba;
   |LEE 100#18=;
   |SI FSalida = 0;
      |HAZ seppre1;
      |GRABA 020#18a;
   |SINO;
      |DDEFECTO #18;
      |HAZ seppre1;
      |GRABA 020#18n;
   |FINSI;
   |LIBERA #18;
   saber = " Actualizada Ficha: " + #cacuepre#19 + "-" + #cacuepre#0 + "-" + #cacuepre#1;
   |PINTA 2040,saber;
|FPRC;

|PROCESO seppre1;
   traba = canal % 16602;
   #cacuepre#19 = traba;           || agrupacion
   traba = canal % 112;
   #cacuepre#0 = traba;            || cuenta
   traba = canal % 1301;
   #cacuepre#1 = traba;            || digito
   traba = canal % 1401;
   #cacuepre#2 = traba;            || signo
   traba = canal % 1501;
   #cacuepre#3 = traba;            || anual/mensual
   traba = canal % 1610;
   #cacuepre#4 = traba;            || mes 1
   traba = canal % 2610;
   #cacuepre#5 = traba;            || mes 2
   traba = canal % 3610;
   #cacuepre#6 = traba;            || mes 3
   traba = canal % 4610;
   #cacuepre#7 = traba;            || mes 4
   traba = canal % 5610;
   #cacuepre#8 = traba;            || mes 5
   traba = canal % 6610;
   #cacuepre#9 = traba;            || mes 6
   traba = canal % 7610;
   #cacuepre#10 = traba;           || mes 7
   traba = canal % 8610;
   #cacuepre#11 = traba;           || mes 8
   traba = canal % 9610;
   #cacuepre#12 = traba;           || mes 9
   traba = canal % 10610;
   #cacuepre#13 = traba;           || mes 10
   traba = canal % 11610;
   #cacuepre#14 = traba;           || mes 11
   traba = canal % 12610;
   #cacuepre#15 = traba;           || mes 12
   traba = canal % 13610;
   #cacuepre#16 = traba;           || presup.a¤o
   traba = canal % 14610;
   #cacuepre#17 = traba;           || desde mes
   traba = canal % 15610;
   #cacuepre#18 = traba;           || hasta mes
|FPRC;

|PROGRAMA;
   |ABRE #100;  |CIERRA #100;  |DELINDEX #100;

   |HAZ inicio;

   |CLS;
   |CABEZA "PASE AGICON";
   |PINPA #0#2;

   |SI eaDirDestino ! "";
      |DDEFECTO #2;
      #paagicon#0   = "";
      #paagicon#14  = eaDirDestino;
      #paagicon#1   = "";
      #paagicon#2   = "";
      #paagicon#3   = "smov";
      #paagicon#4   = "";
      #paagicon#5   = "";
      #paagicon#6   = "";
      #paagicon#7   = "shic";
      #paagicon#8   = "shiv";
      #paagicon#9   = "";
      #paagicon#10  = "scob";
      #paagicon#11  = "spag";
      #paagicon#12  = "";
      #paagicon#13  = "";
      |PINDA #0#2;
      |HAZ pase;
   |SINO;
      |DDEFECTO #2;
      |PINDA #0#2;
      |ENDATOS #1#2;
   |FINSI;
|FPRO;
