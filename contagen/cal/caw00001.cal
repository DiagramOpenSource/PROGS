|FICHEROS;
   caw00001 #0;
   camaasil #1;    || apuntes lins.
   camaasic #2;    || apuntes cabs.
   cacuenta #3;
   camaniva #6;
   caivalin #7;
   camandia #10;

   canempre #30;
   caselem1 #998;
|FIN;

|VARIABLES;
   &entrada = 1;

   alfa1 = "";
   desdi = 0;
   hasdi = 0;
   desfe = @;
   hasfe = @;
   desdo = 0;
   hasdo = 0;

   nlibro = 0;
   swalgun = 0;
|FIN;

|INCLUYE dscont_i;

|| *************************************************************************
||                  ACTUALIZA
|| *************************************************************************

|PROCESO BorraLineas1;  || trabajo por cada lineas

   MasMenos     = - #camaasil#9;
   DebeHaber    = #camaasil#8;
   aCUENTA      = #camaasil#4; eaCuenta = aCUENTA; |HAZ SacaNivel;
   nREGISTRO    = #camaasil#24;
   nDIARIO      = #camaasil#0;
   aFECHA       = #camaasil#1;
   nDOCUMENTO   = #camaasil#2;
   nNIVELCUENTA = enNivel;
   |HAZ ActDiario;          || diario
   |HAZ ActCuenta;          || cuenta
   |HAZ ActTesteo;          || cuenta

   |BORRA 020#camaasil.a;  ||   borra l¡nea
|FPRC;

|DEFBUCLE BorraLineas;
   #camaasil#1;
   ;
   #camaasic#0, #camaasic#1, #camaasic#2,    1;
   #camaasic#0, #camaasic#1, #camaasic#2, 9999;
   e;
   NULL, BorraLineas1;
|FIN;

|PROCESO BorraAsiento;
   nDIARIO      = #camaasic#0;
   aFECHA       = #camaasic#1;
   nDOCUMENTO   = #camaasic#2;
   |BUCLE BorraLineas;  ||Borrar Lineas
   |BORRA 020#camaasic.a;        ||   borra cabecera
   |LIBERA #camaasic;
|FPRC;

|PROCESO LineasEspecial1;
   alfa1 = #camaasil#4; |QBF alfa1;
   |SI alfa1 = "";
       swalgun = 1;
       |ERROR10;
       |ACABA;
   |FINSI;
   |SI #camaasil#6 = 71;
       swalgun = 1;
       |ERROR10;
       |ACABA;
   |FINSI;
|FPRC;

|DEFBUCLE LineasEspecial;
   #camaasil#1;
   ;
   #camaasic#0, #camaasic#1, #camaasic#2,    1;
   #camaasic#0, #camaasic#1, #camaasic#2, 9999;
   e;
   NULL, LineasEspecial1;
|FIN;

|PROCESO BorraOtros1;
 swalgun = 0;
 |BUCLE LineasEspecial;
 |SI swalgun = 1;
     |HAZ BorraAsiento;
 |FINSI;
|FPRC;

|DEFBUCLE BorraOtros;
   #camaasic#1;
   ;
   desdi, desfe, desdo;
   hasdi, hasfe, hasdo;
   be;
   NULL, BorraOtros1;
|FIN;


|| ---------------------- IVA
|PROCESO LineasIva1;
   |BORRA 020#caivalin.a;
|FPRC;

|DEFBUCLE LineasIva;
#caivalin#1;
;
#camaniva#0,#camaniva#1,001;
#camaniva#0,#camaniva#1,999;
;
NULL,LineasIva1;
|FIN;

|PROCESO BorraIva1;
       #camaasic#0  = #camaniva#7;
       #camaasic#1  = #camaniva#8;
       #camaasic#2  = #camaniva#9;
       |LEE 141#camaasic.=;
       |SI FSalida = 0;
           |HAZ BorraAsiento;
       |FINSI;

       |BUCLE LineasIva;
       |BORRA 020#camaniva.a;
       |LIBERA #camaniva;
|FPRC;


|DEFBUCLE BorraIva;
   #camaniva#1;
   4;
   nlibro, 000000001, desfe;
   nlibro, 999999999, hasfe;
   be;
   NULL, BorraIva1;
|FIN;

|| **************************************************************************
|PROCESO HazTodo;
   |HAZ eLeeParametro;
   || ...  Proceso de IVA
   |ABRE #camaasic;
   |ABRE #camaasil;

   desfe  = "31.01.2001"; hasfe  = "31.01.2001";
   |BUCLE BorraIva;

   desfe  = "28.02.2001"; hasfe  = "28.02.2001";
   |BUCLE BorraIva;

   |CIERRA #camaasil;
   |CIERRA #camaasic;

   desfe  = "31.01.2001"; hasfe  = "31.01.2001";
   |BUCLE BorraOtros;
   desfe  = "28.02.2001"; hasfe  = "28.02.2001";
   |BUCLE BorraOtros;
|FPRC;

|| **************************************************************************
|PROCESO borrar; |TIPO 3;
  |SI #0#0 = "N"; |ACABA; |FINSI;

   nlibro = 3;
   desdi  = 1;
   hasdi  = 99;
   desdo  = 1;
   hasdo  = 999999;

   |HAZ MultiEmpresa;
|FPRC;

|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #1 dirfich0;
   |PATH_DAT #2 dirfich0;
   |PATH_DAT #3 dirfich0;
   |PATH_DAT #6 dirfich0;
   |PATH_DAT #7 dirfich0;
   |PATH_DAT #10 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
