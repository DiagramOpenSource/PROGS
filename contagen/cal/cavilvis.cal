|FICHEROS;
   cavilvis #0;

   camaniva #10;
   cavilm01 #11;
   cavilw01 #12,MANTE;
   caclipro #13;
|FIN;

|VARIABLES;
   aAlfa   = "";
   aParte1 = "";
   aParte2 = "";
   aLong   = "";

   nParte1 = 0;
   nParte2 = 0;
   nTecla  = 0;
   nCont   = 0;
   nMaxDig = 0;
   nLong   = 0;
   nCalc   = 0;
|FIN;

|PROCESO MontaLineal;
   #cavilm01#0 = #camaniva#0;
   #cavilm01#1 = #camaniva#1;
   |LEE 000#cavilm01.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   |DDEFECTO #cavilw01;
   #cavilw01#0 = #camaniva#0;
   #cavilw01#1 = #camaniva#2;
   #cavilw01#2 = #camaniva#3;
   #cavilw01#3 = #camaniva#22;
   #cavilw01#4 = #camaniva#4;
   #cavilw01#5 = #camaniva#21;
   #cavilw01#6 = #camaniva#12;
   #cavilw01#7 = #camaniva#13;
   #cavilw01#9 = #camaniva#1;
   |GRABA 020#cavilw01.n;
|FPRC;

|DEFBUCLE MontaLineal;
#camaniva#3;
4, 12, 36;
#cavilvis#0, #cavilvis#1, #cavilvis#2, #cavilvis#3, #cavilvis#4, "S";
#cavilvis#5, #cavilvis#6, #cavilvis#7, #cavilvis#8, #cavilvis#9, "S";
;
NULL, MontaLineal;
|FIN;

|RUTINA inf;
   #cavilw01#0 = 00;
   #cavilw01#1 = "     ";
   #cavilw01#2 = 000000;
|FRUT;

|RUTINA sup;
   #cavilw01#0 = 99;
   #cavilw01#1 = "zzzzz";
   #cavilw01#2 = 999999;
|FRUT;

|PROCESO VuelcaVisados;
   |SI #cavilw01#8 = " "; |ACABA; |FINSI;

   #cavilm01#0 = #cavilw01#0;
   #cavilm01#1 = #cavilw01#9;
   |LEE 000#cavilm01.=;
   |SI FSalida ! 0;
      |DDEFECTO #cavilm01;
      #cavilm01#0 = #cavilw01#0;
      #cavilm01#1 = #cavilw01#9;
      #cavilm01#2 = #cavilw01#1;
      #cavilm01#3 = #cavilw01#2;
      |GRABA 020#cavilm01.n;
   |FINSI;
|FPRC;

|DEFBUCLE VuelcaVisados;
#cavilw01#1;
;
INICIO;
FINAL;
;
NULL, VuelcaVisados;
|FIN;

|RUTINA infcaclipro;
   #caclipro#23 = "P";
   #caclipro#10 = "            ";
|FRUT;

|RUTINA supcaclipro;
   #caclipro#23 = "P";
   #caclipro#10 = "zzzzzzzzzzzz";
|FRUT;

|PROCESO MiraProv;
   nTecla = FSalida;

   aAlfa = #cavilvis#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |SI FSalida ! 0;
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nParte2 = FSalida + 98;               aParte2 = aAlfa % nParte2;
         nParte1 = ((FSalida / 100) ! 0) + 99; aParte1 = aAlfa % nParte1;
         aLong = aAlfa % 0; nLong = aLong;
         nCalc = nMaxDig - nLong;
         aAlfa = aParte1 + ("0" * nCalc) + aParte2;

         aAlfa = aAlfa - ".";
      |SIGUE;
      #cavilvis#Campo# = aAlfa; |PINTA #cavilvis#Campo#;
   |FINSI;

   |SI nTecla = 10;
      |ABRE #caclipro;
      #caclipro#23 = "P";
      #caclipro#10 = #cavilvis#Campo#;
      |LEE 000#caclipro.];

      |CONSULTA_F_CLAVE #1#caclipro, infcaclipro, supcaclipro;
      |SI FSalida = 0;
         #cavilvis#Campo# = #caclipro#10; |PINTA #cavilvis#Campo#;
      |FINSI;

      |CIERRA #caclipro;
   |FINSI;
|FPRC;

|PROGRAMA;
   nMaxDig = 0;
   |PARA nCont = 14; |SI nCont [ 19; |HACIENDO nCont = nCont + 1;
      |SI nMaxDig [ #48nCont; nMaxDig = #48nCont; |FINSI;
   |SIGUE;

   |CLS;
   |CABEZA "Visado de facturas de compra";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      aAlfa = "tm" + Usuario; |NOME_DAT #cavilw01#aAlfa#;
      |DELINDEX #cavilw01; |ABRE #cavilw01;
      |ABRE #cavilm01;
      |BUCLE MontaLineal;

      |ENTLINEAL #1#cavilw01, -3, 4, 20, 1, inf, sup;

      aAlfa = "    N" + &191 + " Conforme con los datos editados ?";
      |CONFI aAlfa;
      |SI FSalida = 0;
         |BUCLE VuelcaVisados;
      |FINSI;
      |CIERRA #cavilm01;
      |CIERRA #cavilw01; |DELINDEX #cavilw01;
   |FINSI;
|FPRO;
