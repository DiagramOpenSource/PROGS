|FICHEROS;
   cacuenta #10,MANTE;
   cacuebal #11;
   canempre #12;
   cadeflab #13;
   caivaasi #14;
   caagrupa #15;
   caepigra #16;

   ca8cumay #410;
   ca8m0002 #422;
|FIN;

|VARIABLES;
   Comodin = "";
   Cuenta  = "";
   aPath   = "";
   aLong   = "";
   aAlfa   = "";
   aAlfa1  = "";
   aAlfa2  = "";

   nLong   = 0;
   nCalc   = 0;
   nCont   = 0;
   nCont1  = 0;
   Nivel   = 0;
   Dig1    = 0;
   Dig2    = 0;
   Dig3    = 0;
   Dig4    = 0;
   Dig5    = 0;
   Dig6    = 0;
   Calc    = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE defec1_i;

|PROCESO InitEmpresa;
   |HAZ inicio;

   |LEE 000#cadeflab.p;
   |SI FSalida ! 0;
      |DDEFECTO #cadeflab;
      |GRABA 020#cadeflab.n;
      |LEE 000#cadeflab.p;
   |FINSI;

   |ABRE #caivaasi;
   |DDEFECTO #caivaasi;
   |LEE 000#caivaasi.p;
   |CIERRA #caivaasi;

   eaPaCTA1 = #caivaasi#135;  ||permitir alta no estructuras 2008
   eaPaCTA2 = #caivaasi#136;  ||Aviso 1990
   eaPaNif1 = #caivaasi#152;
   eaPaNif2 = #caivaasi#153;
   eaABanco = #caivaasi#161;
   eaObClPr = #caivaasi#186;
|FPRC;

|PROCESO SacaNivel1;
   Comodin = Cuenta; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Nivel = 0;
   |SI nLong > 0;
      |SI nLong = Dig1; Nivel = 1; |FINSI;
      |SI nLong = Dig2; Nivel = 2; |FINSI;
      |SI nLong = Dig3; Nivel = 3; |FINSI;
      |SI nLong = Dig4; Nivel = 4; |FINSI;
      |SI nLong = Dig5; Nivel = 5; |FINSI;
      |SI nLong = Dig6; Nivel = 6; |FINSI;
   |FINSI;
|FPRC;

|PROCESO AltaCuenta;
   #cacuenta#0 = Cuenta; ||HAZ SacaNivel1;
   #cacuenta#1 = Nivel;
   |LEE 101#cacuenta.=;
   |SI FSalida ! 0;
      |ABRE #cacuebal;

      |DDEFECTO #cacuenta;
      |PARA nCont = 6; |SI nCont ] 1; |HACIENDO nCont = nCont - 1;
         Calc = 13 + nCont;
         |SI #canempre#Calc# ! 0;
            Calc = 100 + #canempre#Calc#;
            Comodin = Cuenta % Calc;
            #cacuenta#0 = Comodin;
            #cacuenta#1 = nCont;
            |LEE 000#cacuenta.=;
            |SI FSalida = 0;
               #cacuebal#0 = Comodin
               |LEE 000#cacuebal.=;
               |SI FSalida = 0;
                  #cacuenta#4 = #cacuebal#1;
                  #cacuenta#5 = #cacuebal#2;
                  #cacuenta#6 = #cacuebal#3;
                  #cacuenta#7 = #cacuebal#4;
                  #cacuenta#8 = #cacuebal#5;
                  |SAL;
               |FINSI;
            |FINSI;
         |FINSI;
      |SIGUE;
      |CIERRA #cacuebal;

      |PARA nCont1 = 9; |SI nCont1 [ 53; |HACIENDO nCont1 = nCont1 + 1;
         #cacuenta#nCont1# = 0;
      |SIGUE;

      #cacuenta#0 = Cuenta;
      #cacuenta#1 = Nivel;
      #cacuenta#3 = "S";
      |GRABA 020#cacuenta.b;

      |PUSHV 0501 2380;

      |PINPA #0#cacuenta; |PINDA #0#cacuenta;
      |SI #canempre#26 ] 8; |Y #canempre#26 < 90;
          nMensa9 = 1;
          |HAZ defect1;
      |FINSI;

      |ENDATOS #1#cacuenta;
      |SI FSalida = 0;
         |GRABA 020#cacuenta.a;
      |FINSI;
      |LIBERA #cacuenta;
      |POPV;
   |FINSI;
|FPRC;

|PROGRAMA;
   aAlfa = PARAMETRO;
   aAlfa = aAlfa - ",";
   nCalc = ((FSalida / 100) ! 0) + 99;
   aPath = aAlfa % nCalc;

   aAlfa = PARAMETRO;
   aAlfa1 = (aPath % nCalc) + ",";
   Cuenta = aAlfa - aAlfa1;

   aAlfa = aPath; aAlfa2 = aAlfa % -101;
   |SI aAlfa2 = "/"; |O aAlfa2 = "\";
      aAlfa = aAlfa % -299;
   |FINSI;
   aAlfa2 = aAlfa % -101; aAlfa1 = "";
   |PARA; |SI aAlfa2 ! "/"; |Y aAlfa2 ! "\"; |HACIENDO;
      aAlfa1 = aAlfa2 + aAlfa1;
      aAlfa = aAlfa % -299; aAlfa2 = aAlfa % -101;
   |SIGUE;

   aAlfa2 = aAlfa1 % -299; || Empresa
   aAlfa1 = aAlfa1 % -101; || Periodo

   |PATH_DAT #canempre#aAlfa#; fich_alta = aPath;

   |ABRE #canempre;
   |PATH_DAT #cadeflab#aPath#; |ABRE #cadeflab;
   |PATH_DAT #caivaasi#aPath#; |ABRE #caivaasi;
   |PATH_DAT #cacuenta#aPath#; |ABRE #cacuenta;
   |PATH_DAT #caagrupa#aPath#;
   |PATH_DAT #caepigra#aPath#;
   |PATH_DAT #cacuebal#aPath#; |ABRE #cacuebal;

   |HAZ InitEmpresa;
   |HAZ AltaCuenta;

   |CIERRA #cacuebal;
   |CIERRA #cadeflab; |CIERRA #caivaasi;
   |CIERRA #canempre; |CIERRA #cacuenta;
|FPRO;
