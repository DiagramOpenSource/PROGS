|FICHEROS;
   caz00037 #0;
   caivatmp #900,MANTE;

   camaniva #11;
   caivalin #12;
   caivaasi #200;

  :/modelos/def/dsmom030 #330;
   caivatm@ #901;
|FIN;

|VARIABLES;
    nSwModi  = 0;
    nInkey   = 0;
    aAlfa    = "";
    aAlfa1   = "";
    aAlfa2   = "";
    aAlfa3   = "";
    aAlfa4   = "";
    nume1    = 0;
    aCampo1  = "";
    aCampo2  = "";
    aCampo3  = "";
    aCampo4  = "";
    nNume1   = 0;
    nNume2   = 0;
    nNume3   = 0;
    nNume4   = 0;
    aFichero = "";

    informe  = "caz00037";

    nExis    = 0;
    nSwOp    = 0;

    nSwAlgun = 0;
    nEstado  = 0;
    nSwEncon = 0;
    aDTipo   = "";
    aHTipo   = "";
    &enSwLinea = 0;

    aQueQuiero = "";
    aTitulo    = "";
    aNumCampos = "";
    nNumCampos = 0;
    nCampos    = 0;

   {-1}menu = "";
   menu1 = "2400";
   menu2 = "4";
   menu3 = " Elija: ";
   menu4 = "RIAC";
   menu5 = " Revisar ";
   menu6 = " Imprimir ";
   menu7 = " Actualizar ";
   menu8 = " Cancelar ";
  opcion = 0;

   nSw   = 0;
   aMas  = "";
   aDef  = "";

  &eaCamp35 = "";
  &enCamp38 = 0;
  &eaCamp42 = "";
  &eaCamp43 = "";
  &eaCamp44 = "";
  {40}aPopup        = "";
     nID            = 0;
     aID            = "";
     aTexto         = "";
     fDFecha        = @;
|FIN;

|INCLUYE dscont_i;

|| ***************** Calculos de Pantalla

|CALCULO fecha; |TIPO 0;
  fDFecha = fec1;
  |SI enSwSelFc = 1; fDFecha = "01.01.0000"; |FINSI;
  |SI #0Campo < fDFecha; |O #0Campo > fec2;
      |MENAV "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI Campo = 5; |Y #0#5 < #0#4;
      |MENAV "    FECHA ERRONEA ";
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO cuenta;|TIPO 6;
     eaCuenta = #0Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta; |PINTA #0Campo;
|FCAL;

|PROCESO Tipo7C21;  |TIPO 7;
   |SI enEjercicio > 2011;
       aAlfa1 = "<*> No se pasa al 340.";
   |SINO;
       aAlfa1 = "<X> No se pasa al 340.";
   |FINSI;
   aAlfa1 = "    <F11> para consultar Tipo Operaciones Mod. 340." + aAlfa1;
   |MENSA aAlfa1;
|FPRC;

|PROCESO Tipo66C21;  |TIPO 66;
     aAlfa = "|C021WID";
     aID   = #0#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     |SI #0#18 = "S";
         |SI enEjercicio [ 2011;
             aPopup2  = 14;
         |SINO;
             aPopup2  = 18;
             |SI enEjercicio ] 2014;
                 aPopup2  = 27;
             |FINSI;
         |FINSI;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "F Adquisiciones realizadas por las agencias de viajes directamente en interés del viajero ";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "L Adquisiciones a comerciantes minoristas del IGIC";
         aPopup15 = "P Adquisiciones intracomunitarias de bienes.";
         aPopup16 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         |SI enEjercicio > 2011;
            aPopup17 = "R Operación de arrendamiento de local de negocio.";
            aPopup18 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
            aPopup19 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
            aPopup20 = "X Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo";
             |SI enEjercicio ] 2014;
                 aPopup21 = "Z Operaciones en Régimen especial de criterio de caja";
                 aPopup22 = "1 IVA criterio de caja. Asiento resumen de facturas";
                 aPopup23 = "2 IVA criterio de caja. Factura con varios asientos";
                 aPopup24 = "3 IVA criterio de caja. Factura rectificativa";
                 aPopup25 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
                 aPopup26 = "5 IVA criterio de caja. Factura simplificada";
                 aPopup27 = "6 IVA criterio de caja. Rectificación de errores registrales";
                 aPopup28 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
                 aPopup29 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
             |FINSI;
         |FINSI;
     |SINO;
         aPopup1  = nID;  || Si fuera -1 en la posicion
         |SI enEjercicio [ 2011;
             aPopup2  = 15;
         |SINO;
             aPopup2  = 21;
             |SI enEjercicio ] 2014;
                 aPopup2  = 30;
             |FINSI;
         |FINSI;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "E IVA devengado pendiente de emitir factura";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "M IVA facturado pendiente de devengar (emitida factura)";
         aPopup15 = "N Facturación de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena";
         aPopup16 = "O Factura emitida en sustitución de tiques facturados y declarados.";
         aPopup17 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         |SI enEjercicio > 2011;
             aPopup18 = "R Operación de arrendamiento de local de negocio.";
             aPopup19 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
             aPopup20 = "T Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ...";
             aPopup21 = "U Operación de seguros.";
             aPopup22 = "V Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ...";
             aPopup23 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
             |SI enEjercicio ] 2014;
                 aPopup24 = "Z Operaciones en Régimen especial de criterio de caja";
                 aPopup25 = "1 IVA criterio de caja. Asiento resumen de facturas";
                 aPopup26 = "2 IVA criterio de caja. Factura con varios asientos";
                 aPopup27 = "3 IVA criterio de caja. Factura rectificativa";
                 aPopup28 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
                 aPopup29 = "5 IVA criterio de caja. Factura simplificada";
                 aPopup30 = "6 IVA criterio de caja. Rectificación de errores registrales";
                 aPopup31 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
                 aPopup32 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
             |FINSI;
         |FINSI;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #0#21 = aAlfa;
     |FINSI;

     |PINTA #0#21;
|FPRC;


|PROCESO LaOpera;
     nInkey = FSalida;
     |BLIN 4;
     aTexto = "";
     |SI #0#21 = "X"; aTexto = "No pasa al 340";  |FINSI;
     |SI #0#21 = " "; aTexto = "Operaci¢n habitual"; |FINSI;
     |SI #0#21 = "A"; aTexto = "Asiento resumen de facturas"; |FINSI;
     |SI #0#21 = "B"; aTexto = "Asiento resumen de tiques"; |FINSI;
     |SI #0#18 = "R";
         |SI #0#21 = "C"; aTexto = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #0#21 = "D"; aTexto = "Factura rectificativa"; |FINSI;
         |SI #0#21 = "E"; aTexto = "IVA devengado pendiente de emitir factura"; |FINSI;
         |SI #0#21 = "G"; aTexto = "R‚gimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #0#21 = "H"; aTexto = "R‚gimen especial de oro de inversi¢n"; |FINSI;
         |SI #0#21 = "I"; aTexto = "Inversi¢n del Sujeto pasivo (ISP)";|FINSI;
         |SI #0#21 = "J"; aTexto = "Tiques"; |FINSI;
         |SI #0#21 = "K"; aTexto = "Rectificación anotaciones registrales"; |FINSI;
         |SI #0#21 = "M"; aTexto = "IVA facturado pendiente de devengar (emitida factura)"; |FINSI;
         |SI #0#21 = "N"; aTexto = "Facturaci¢n de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena"; |FINSI;
         |SI #0#21 = "O"; aTexto = "Factura emitida en sustituci¢n de tiques facturados y declarados."; |FINSI;
         |SI #0#21 = "Q"; aTexto = "Operaciones a las que se aplique el r‚gimen especial de bienes usados, ..."; |FINSI;
         |SI enEjercicio > 2011;
             |SI #0#21 = "R"; aTexto = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
             |SI #0#21 = "S"; aTexto = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
             |SI #0#21 = "T"; aTexto = "Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ..."; |FINSI;
             |SI #0#21 = "U"; aTexto = "Operación de seguros."; |FINSI;
             |SI #0#21 = "V"; aTexto = "Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ..."; |FINSI;
             |SI #0#21 = "W"; aTexto = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
             |SI enEjercicio ] 2014;
                 |SI #0#21 = "Z"; aTexto = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
                 |SI #0#21 = "1"; aTexto = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
                 |SI #0#21 = "2"; aTexto = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
                 |SI #0#21 = "3"; aTexto = "IVA criterio de caja. Factura rectificativa"; |FINSI;
                 |SI #0#21 = "4"; aTexto = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
                 |SI #0#21 = "5"; aTexto = "IVA criterio de caja. Factura simplificada"; |FINSI;
                 |SI #0#21 = "6"; aTexto = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
                 |SI #0#21 = "7"; aTexto = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
                 |SI #0#21 = "8"; aTexto = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #0#21 = "C"; aTexto = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #0#21 = "D"; aTexto = "Factura rectificativa";|FINSI;
         |SI #0#21 = "F"; aTexto = "Adquisiciones realizadas por las agencias de viajes directamente en inter‚s del viajero";|FINSI;
         |SI #0#21 = "G"; aTexto = "R‚gimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #0#21 = "H"; aTexto = "R‚gimen especial de oro de inversi¢n"; |FINSI;
         |SI #0#21 = "I"; aTexto = "Inversi¢n del Sujeto pasivo (ISP)"; |FINSI;
         |SI #0#21 = "J"; aTexto = "Tiques"; |FINSI;
         |SI #0#21 = "K"; aTexto = "Rectificación anotaciones registrales"; |FINSI;
         |SI #0#21 = "L"; aTexto = "Adquisiciones a comerciantes minoristas del IGIC"; |FINSI;
         |SI #0#21 = "P"; aTexto = "Adquisiciones intracomunitarias de bienes."; |FINSI;
         |SI #0#21 = "Q"; aTexto = "Operaciones a las que se aplique el r‚gimen especial de bienes usados, ..."; |FINSI;
         |SI enEjercicio > 2011;
             |SI #0#21 = "R"; aTexto = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
             |SI #0#21 = "S"; aTexto = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
             |SI #0#21 = "W"; aTexto = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
             |SI #0#21 = "X"; aTexto = "Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo"; |FINSI;
             |SI enEjercicio ] 2014;
                 |SI #0#21 = "Z"; aTexto = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
                 |SI #0#21 = "1"; aTexto = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
                 |SI #0#21 = "2"; aTexto = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
                 |SI #0#21 = "3"; aTexto = "IVA criterio de caja. Factura rectificativa"; |FINSI;
                 |SI #0#21 = "4"; aTexto = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
                 |SI #0#21 = "5"; aTexto = "IVA criterio de caja. Factura simplificada"; |FINSI;
                 |SI #0#21 = "6"; aTexto = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
                 |SI #0#21 = "7"; aTexto = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
                 |SI #0#21 = "8"; aTexto = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#21 = "C"; aTexto = ""; |FINSI; || no puede elegir C, es automatico
     |SI enEjercicio [ 2011;
         |SI #0#21 = "X"; aTexto = "No pasa al 340"; |FINSI;
     |SINO;
         |SI #0#21 = "*"; aTexto = "No pasa al 340"; |FINSI;
     |FINSI;

     |SI aTexto = "";
         |MENAV "0000 Clave de operaci¢n incorrecta";
         |ERROR;
         |ACABA;
     |FINSI;
     #0#27 = aTexto; |PINTA #0#27;

     |C_M #0#22, 1, "S";
     |C_M #0#23, 1, "S";
     |C_M #0#24, 1, "S";
     |C_M #0#25, 1, "S";
     |C_M #0#26, 1, "S";
     |SI #0#21 ! "A";  |Y #0#21 ! "B";
         |C_M #0#22, 1, "N";  #0#22 = 0;
         |C_M #0#23, 1, "N";  #0#23 = 0;
         |C_M #0#24, 1, "N";  #0#24 = 0;
         |C_M #0#25, 1, "N";  #0#25 = 0;
         |C_M #0#26, 1, "N";  #0#25 = " ";
     |FINSI;

     |PINTA #0#22;|PINTA #0#23;
     |PINTA #0#24;|PINTA #0#25;
     |PINTA #0#26;
|FPRC;

|PROCESO cam_pos_2; |TIPO 0;
   |C_M #0Campo,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   nume1 = #0Campo;
   nume1 = Campo + 1;
   |C_M #0nume1,1,"S";
   |SI #0Campo = 0;
      |C_M #0nume1,1,"N"; #0nume1 = 0; |PINTA #0nume1;
   |FINSI;
|FPRC;

|| *************************************************************************
|PROCESO Tipo5_W;  |TIPO 5;
       |LEE 040#900p;
       #900#35 = "*";
       |LINEAS_BI_ATRI #900#35, D, S, -1;
|FPRC;

|PROCESO AlgoCam_W; |TIPO 0;
 |C_M #900Campo,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 aAlfa1 = Contenido;
 |SI aAlfa1 ! #900Campo; nSwModi = 1; |FINSI;

 |SI nSwModi = 1;
     aAlfa1 = #900#22; |QBF aAlfa1;
     aAlfa2 = #900#43 - aAlfa1; |QBF aAlfa2; nNume1 = aAlfa2;
     aAlfa2 = #900#44 - aAlfa1; |QBF aAlfa2; nNume2 = aAlfa2;
     nNume3 = nNume2 - nNume1 + 1;
     |SI nNume3 < 1; nNume3 = 1; |FINSI;
     #900#38 = nNume3; |PINTA #900#38;
 |FINSI;
|FPRC;

|PROCESO Tipo7C42_W;  |TIPO 7;
   |SI enEjercicio > 2011;
       aAlfa1 = "<*> No se pasa al 340.";
   |SINO;
       aAlfa1 = "<X> No se pasa al 340.";
   |FINSI;
   aAlfa1 = "    <F11> para consultar Tipo Operaciones Mod. 340." + aAlfa1;
   |MENSA aAlfa1;
|FPRC;

|PROCESO Tipo66C42_W;  |TIPO 66;
     aAlfa = "|C042WID";
     aID   = #900#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     |SI #900#36 = "S";
         |SI enEjercicio [ 2011;
             aPopup2  = 14;
         |SINO;
             aPopup2  = 18;
             |SI enEjercicio ] 2014;
                 aPopup2  = 27;
             |FINSI;
         |FINSI;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "F Adquisiciones realizadas por las agencias de viajes directamente en interés del viajero ";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "L Adquisiciones a comerciantes minoristas del IGIC";
         aPopup15 = "P Adquisiciones intracomunitarias de bienes.";
         aPopup16 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         |SI enEjercicio > 2011;
             aPopup17 = "R Operación de arrendamiento de local de negocio.";
             aPopup18 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
             aPopup19 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
             aPopup20 = "X Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo";
             |SI enEjercicio ] 2014;
                 aPopup21 = "Z Operaciones en Régimen especial de criterio de caja";
                 aPopup22 = "1 IVA criterio de caja. Asiento resumen de facturas";
                 aPopup23 = "2 IVA criterio de caja. Factura con varios asientos";
                 aPopup24 = "3 IVA criterio de caja. Factura rectificativa";
                 aPopup25 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
                 aPopup26 = "5 IVA criterio de caja. Factura simplificada";
                 aPopup27 = "6 IVA criterio de caja. Rectificación de errores registrales";
                 aPopup28 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
                 aPopup29 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
             |FINSI;
         |FINSI;
     |SINO;
         aPopup1  = nID;  || Si fuera -1 en la posicion
         |SI enEjercicio [ 2011;
             aPopup2  = 15;
         |SINO;
             aPopup2  = 21;
             |SI enEjercicio ] 2014;
                 aPopup2  = 30;
             |FINSI;
         |FINSI;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "E IVA devengado pendiente de emitir factura";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "M IVA facturado pendiente de devengar (emitida factura)";
         aPopup15 = "N Facturación de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena";
         aPopup16 = "O Factura emitida en sustitución de tiques facturados y declarados.";
         aPopup17 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         |SI enEjercicio > 2011;
             aPopup18 = "R Operación de arrendamiento de local de negocio.";
             aPopup19 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
             aPopup20 = "T Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ...";
             aPopup21 = "U Operación de seguros.";
             aPopup22 = "V Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ...";
             aPopup23 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
             |SI enEjercicio ] 2014;
                 aPopup24 = "Z Operaciones en Régimen especial de criterio de caja";
                 aPopup25 = "1 IVA criterio de caja. Asiento resumen de facturas";
                 aPopup26 = "2 IVA criterio de caja. Factura con varios asientos";
                 aPopup27 = "3 IVA criterio de caja. Factura rectificativa";
                 aPopup28 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
                 aPopup29 = "5 IVA criterio de caja. Factura simplificada";
                 aPopup30 = "6 IVA criterio de caja. Rectificación de errores registrales";
                 aPopup31 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
                 aPopup32 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
             |FINSI;
         |FINSI;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #900#42 = aAlfa;
     |FINSI;

     |PINTA #900#42;
|FPRC;

|PROCESO LaOp0_W;
     nInkey = FSalida;

     |BLIN 4;
     aTexto = "";
     |SI #900#42 = " "; aTexto = "Operaci¢n habitual"; |FINSI;
     |SI #900#42 = "X"; aTexto = "No pasa al 340";  |FINSI;
     |SI #900#42 = "A"; aTexto = "Asiento resumen de facturas"; |FINSI;
     |SI #900#42 = "B"; aTexto = "Asiento resumen de tiques"; |FINSI;
     |SI #900#36 = "R";
         |SI #900#42 = "C"; aTexto = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #900#42 = "D"; aTexto = "Factura rectificativa"; |FINSI;
         |SI #900#42 = "E"; aTexto = "IVA devengado pendiente de emitir factura"; |FINSI;
         |SI #900#42 = "G"; aTexto = "R‚gimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #900#42 = "H"; aTexto = "R‚gimen especial de oro de inversi¢n"; |FINSI;
         |SI #900#42 = "I"; aTexto = "Inversi¢n del Sujeto pasivo (ISP)";|FINSI;
         |SI #900#42 = "J"; aTexto = "Tiques"; |FINSI;
         |SI #900#42 = "K"; aTexto = "Rectificación anotaciones registrales"; |FINSI;
         |SI #900#42 = "M"; aTexto = "IVA facturado pendiente de devengar (emitida factura)"; |FINSI;
         |SI #900#42 = "N"; aTexto = "Facturaci¢n de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena"; |FINSI;
         |SI #900#42 = "O"; aTexto = "Factura emitida en sustituci¢n de tiques facturados y declarados."; |FINSI;
         |SI #900#42 = "Q"; aTexto = "Operaciones a las que se aplique el r‚gimen especial de bienes usados, ..."; |FINSI;
         |SI enEjercicio > 2011;
             |SI #900#42 = "R"; aTexto = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
             |SI #900#42 = "S"; aTexto = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
             |SI #900#42 = "T"; aTexto = "Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ..."; |FINSI;
             |SI #900#42 = "U"; aTexto = "Operación de seguros."; |FINSI;
             |SI #900#42 = "V"; aTexto = "Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ..."; |FINSI;
             |SI #900#42 = "W"; aTexto = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
             |SI enEjercicio ] 2014;
                 |SI #900#42 = "Z"; aTexto = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
                 |SI #900#42 = "1"; aTexto = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
                 |SI #900#42 = "2"; aTexto = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
                 |SI #900#42 = "3"; aTexto = "IVA criterio de caja. Factura rectificativa"; |FINSI;
                 |SI #900#42 = "4"; aTexto = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
                 |SI #900#42 = "5"; aTexto = "IVA criterio de caja. Factura simplificada"; |FINSI;
                 |SI #900#42 = "6"; aTexto = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
                 |SI #900#42 = "7"; aTexto = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
                 |SI #900#42 = "8"; aTexto = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #900#42 = "C"; aTexto = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #900#42 = "D"; aTexto = "Factura rectificativa";|FINSI;
         |SI #900#42 = "F"; aTexto = "Adquisiciones realizadas por las agencias de viajes directamente en inter‚s del viajero";|FINSI;
         |SI #900#42 = "G"; aTexto = "R‚gimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #900#42 = "H"; aTexto = "R‚gimen especial de oro de inversi¢n"; |FINSI;
         |SI #900#42 = "I"; aTexto = "Inversi¢n del Sujeto pasivo (ISP)"; |FINSI;
         |SI #900#42 = "J"; aTexto = "Tiques"; |FINSI;
         |SI #900#42 = "K"; aTexto = "Rectificación anotaciones registrales"; |FINSI;
         |SI #900#42 = "L"; aTexto = "Adquisiciones a comerciantes minoristas del IGIC"; |FINSI;
         |SI #900#42 = "P"; aTexto = "Adquisiciones intracomunitarias de bienes."; |FINSI;
         |SI #900#42 = "Q"; aTexto = "Operaciones a las que se aplique el r‚gimen especial de bienes usados, ..."; |FINSI;
         |SI enEjercicio > 2011;
             |SI #900#42 = "R"; aTexto = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
             |SI #900#42 = "S"; aTexto = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
             |SI #900#42 = "W"; aTexto = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
             |SI #900#42 = "X"; aTexto = "Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo"; |FINSI;
             |SI enEjercicio ] 2014;
                 |SI #900#42 = "Z"; aTexto = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
                 |SI #900#42 = "1"; aTexto = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
                 |SI #900#42 = "2"; aTexto = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
                 |SI #900#42 = "3"; aTexto = "IVA criterio de caja. Factura rectificativa"; |FINSI;
                 |SI #900#42 = "4"; aTexto = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
                 |SI #900#42 = "5"; aTexto = "IVA criterio de caja. Factura simplificada"; |FINSI;
                 |SI #900#42 = "6"; aTexto = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
                 |SI #900#42 = "7"; aTexto = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
                 |SI #900#42 = "8"; aTexto = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #900#42 = "C"; aTexto = ""; |FINSI; || no puede elegir C, es automatico
     |SI enEjercicio [ 2011;
         |SI #900#42 = "X"; aTexto = "No pasa al 340"; |FINSI;
     |SINO;
         |SI #900#42 = "*"; aTexto = "No pasa al 340"; |FINSI;
     |FINSI;

     |SI aTexto = "";
         |MENAV "0000 Clave de operaci¢n incorrecta";
         |ERROR;
         |ACABA;
     |FINSI;

     |C_M #900#43, 1, "S";
     |C_M #900#44, 1, "S";
     |C_M #900#38, 1, "S";
     |SI #900#42 ! "A";  |Y #900#42 ! "B";
         |C_M #900#43, 1, "N";  #900#43 = ""; |PINTA #900#43;
         |C_M #900#44, 1, "N";  #900#44 = ""; |PINTA #900#44;
         |C_M #900#38, 1, "N";  #900#38 = 1;  |PINTA #900#38;
     |FINSI;
|FPRC;

|PROCESO Baja12;
 #12#0 = #11#0;
 #12#1 = #11#1;
 #12#2 = 1;
|FPRC;

|PROCESO Alta12;
 #12#0 = #11#0;
 #12#1 = #11#1;
 #12#2 = 99;
|FPRC;

|PROCESO Modifico; |TIPO 11;

 nInkey = FSalida;
 |SI nInkey = 10;
     |LEE 141#900=;

     |SI #900#35 = "*";
         #900#35 = " ";
     |SINO;
         #900#35 = "*";
     |FINSI;
     |PINTA #900#35;

     |GRABA 000#900a;
     |LIBERA #900;
     |ERROR;
 |FINSI;

 |SI nInkey = 11;
     |LEE 141#900=;

     #900#35 = "*";
     nSwModi = 0;
    |ET Camp5;
       |ENCAMPO #42#900;
       |SI FSalida = 1; |VETE  Campo0; |FINSI;

    |ET Camp4;
       |ENCAMPO #43#900;
       |SI FSalida = 2; |VETE  Camp5; |FINSI;
       |SI FSalida = 1; |VETE  Campo0; |FINSI;

   |ET Camp3;
       |ENCAMPO #44#900;
       |SI FSalida = 2; |VETE  Camp4; |FINSI;
       |SI FSalida = 1; |VETE  Campo0; |FINSI;

      |ENCAMPO #38#900;
      |SI FSalida = 2; |VETE  Camp3; |FINSI;

   |ET Campo0;

      |GRABA 000#900a;
      |LIBERA #900;
      |ERROR;
 |FINSI;

 |SI nInkey = 12;
     |ABRE #11;
     #11#0 = #900#0;
     #11#1 = #900#1;
     |LEE 001#11=;
     |SI FSalida = 0;
         |PUSHV 0501 2380;
         |PINPA #0#11;
         |PINDA #0#11;
         |ENTLINEAL #1#12, -3, 4, 22, 0, Baja12, Alta12;
         |POPV;
     |FINSI;
     |CIERRA #11;

 |FINSI;
|FPRC;

|| *************************************************************************
|| **************************   MEOLLO   ***********************************
|| *************************************************************************

|PROCESO Calculo;
 aAlfa1 = #900#28;

 |PARA nNume1 = 1; |SI nNume1 [ 30; |HACIENDO nNume1 = nNume1 + 1;
       nNume2 = (nNume1 * 100) + 1;
       aAlfa2 = aAlfa1 % nNume2;
       |SI nNume1 = #0#22;  aCampo1 = ""; |FINSI;
       |SI nNume1 = #0#24;  aCampo2 = ""; |FINSI;
       |SI nNume1 ] #0#22; |Y nNume1 [ #0#23;
           aCampo1 = aCampo1 + aAlfa2;
       |FINSI;
       |SI nNume1 ] #0#24; |Y nNume1 [ #0#25;
           aCampo2 = aCampo2 + aAlfa2;
       |FINSI;
 |SIGUE;
 |QBT aCampo1; |QBT aCampo2;
 |SI aCampo1 ! "";
     aAlfa1 = #200#97; |QBF aAlfa1;
     aCampo1 = aCampo1 + aAlfa1;
 |FINSI;
 #900#22 = aCampo1;   ||Guardo la serie para ver si puedo calcular datos

 aCampo3 = "";  || Primer Numero
 aCampo4 = "";  || Ultimo Numero
 aAlfa1 = aCampo2 - #0#26;
 nNume4 = FSalida; |SI nNume4 ! 0; nNume4 = (nNume4 / 100) ! 0; |FINSI;
 aAlfa1 = aCampo2 % 0;
 nNume3 = aAlfa1;
 |SI nNume3 ! 0;
     |SI nNume4 > 1;
        |PARA nNume1 = 1; |SI nNume1 [ nNume3; |HACIENDO nNume1 = nNume1 + 1;
              nNume2 = (nNume1 * 100) + 1;
              aAlfa2 = aCampo2 % nNume2;
              |SI aAlfa2 ] "0"; |Y aAlfa2 [ "9";
                  |SI nNume1 < nNume4;
                      aCampo3 = aCampo3 + aAlfa2;
                  |FINSI;
                  |SI nNume1 > nNume4;
                      aCampo4 = aCampo4 + aAlfa2;
                  |FINSI;
             |FINSI;
        |SIGUE;
     |SINO;
        aCampo3 = aCampo2;
     |FINSI;
 |FINSI;
 nNume1 = aCampo3;
 nNume2 = aCampo4;
 nNume3 = nNume2 - nNume1 + 1;
 |SI aCampo3 ! ""; aCampo3 = aCampo1 + aCampo3; |FINSI;
 |SI aCampo4 ! ""; aCampo4 = aCampo1 + aCampo4; |FINSI;

 aAlfa1 = ""; aAlfa2 = "";
 |SI #0#30 = "S";
     aAlfa1 = #900#43; |QBF aAlfa1;
     aAlfa2 = #900#44; |QBF aAlfa2;
 |FINSI;

 |SI aAlfa1 = ""; |O aAlfa2 = "";
     |SI nNume3 [ 1;
         |SI #900#42 = "B"; #900#42 = "J"; |FINSI;
         |SI #900#42 = "A"; #900#42 = " "; |FINSI;
         #900#43 = "";
         #900#44 = "";
         #900#38 = 1;
     |SINO;
         #900#43 = aCampo3;
         #900#44 = aCampo4;
         #900#38 = nNume3;
     |FINSI;
  |SINO;
     |SI nNume3 > 0; |Y #900#38 [ 1;
         #900#38 = nNume3;
     |FINSI;
  |FINSI;
|FPRC;

|PROCESO GrabaAuxiliar;

  |PARA nCampos = 0;  |SI nCampos [ nNumCampos;  |HACIENDO nCampos = nCampos + 1;
        #900nCampos = #11nCampos;
  |SIGUE;
  #900#22 = "";  || no quiero la referencia
  #900#35 = " ";
  |SI #0#29 = "S"; #900#35 = "*"; |FINSI;

  |SI #0#30 = "S"; |O #900#42 = " ";
      #900#42 = #0#21;
  |FINSI;

  |SI #900#42 ! "A"; |Y #900#42 ! "B";
      #900#43 = "";
      #900#44 = "";
  |SINO;
      |HAZ Calculo;
  |FINSI;
  |GRABA 020#900n;
  nSwAlgun = 1;
|FPRC;

|DEFBUCLE caymaniva;
 #11#1;
 2, 3, 4, 12, 14, 27, 7, 36;
 #0#0, #0#8, #0#6, #0#2, #0#4, #0#10, #0#12, #0#14, #0#16, aDTipo;
 #0#1, #0#9, #0#7, #0#3, #0#5, #0#11, #0#13, #0#15, #0#17, aHTipo;
 e;
 NULL,GrabaAuxiliar;
|FIN;

|| ******************************************************
|PROCESO ImprimeAux;
 |DDEFECTO #11;
 #11#0 = #901#0;
 #11#1 = #901#1;
 |LEE 001#11=;

 eaCamp35 = #901#35;
 enCamp38 = #901#38;
 eaCamp42 = #901#42;
 eaCamp43 = #901#43;
 eaCamp44 = #901#44;

 enSwLinea = 0;
 |PRINT;
 nSw = 1;
|FPRC;

|DEFBUCLE ImprimeAux;
 #901#3002;
 ;
 00, 0000000001;
 99, 9999999999;
 ;
 NULL, ImprimeAux;
|FIN;

|PROCESO Imprimir;
  |IMPRE 0;
  |SI FSalida ! 0;
      |MENAV "    Proceso interrumpido";
      |ACABA;
  |FINSI;
  |INFOR informe;
  |SI FSalida ! 0;
      |MENAV "    Error. No existe informe";
      |FINIMP;
      |ACABA;
  |FINSI;


  nSw = 0;
  |ABRE #11;
  |BUCLE ImprimeAux;
  |CIERRA #11;
  |SI nSw = 1;
      |PIEINF;
  |FINSI;
  |FININF;
  |FINIMP;

|FPRC;
|| ********************************************************************

|PROCESO Actual;
 #11#0 = #900#0;
 #11#1 = #900#1;
 |LEE 101#11=;
 |SI FSalida = 0;
     #11#38 = #900#38;
     #11#42 = #900#42;
     #11#43 = #900#43;
     #11#44 = #900#44;
     |GRABA 020#11a;
 |FINSI;
 |LIBERA #11;
|FPRC;

|DEFBUCLE Actual;
 #900#3;
 35;
 00, 0000000001, "*";
 99, 9999999999, "*";
 ;
 NULL, Actual;
|FIN;

|PROCESO Actualiza;
 |ABRE #11;
 |BUCLE Actual;
 |CIERRA #11;
|FPRC;

|| ********************************************************************

|PROCESO AuxMin;
 #900#0 = 01;
 #900#1 = 0000000001;
|FPRC;

|PROCESO AuxMax;
 #900#0 = 99;
 #900#1 = 9999999999;
|FPRC;

|PROCESO HagoTodo;

  |PINPA #0#900;
  |ENTLINEAL #3#900, -2, 4, 22, 0, AuxMin, AuxMax;
  opcion = 1;
  |ATRI 0;
  |PARA; |SI; |HACIENDO;
          |MENU menu;
          opcion = FSalida;
          |SI opcion = 2;  |HAZ Imprimir;  |FINSI;
          |SI opcion = 1;
              |ENTLINEAL #3#900, -2, 4, 22, 0, AuxMin, AuxMax;
              |ATRI 0;
          |FINSI;
          |SI opcion = 3;  |HAZ Actualiza; |SAL;  |FINSI;
          |SI opcion = 4;  |SAL;  |FINSI;
  |SIGUE;
|FPRC;

|CALCULO impre; |TIPO 3;

   |DBASE aMas;
   aDef = aMas + "def/caivatmp";
   |CARGA_DEF aDef, caivatm@;
   |SI FSalida ! 0;
       |MENAV "    Error al Carga fichero Auxiliar";
       |ACABA;
   |FINSI;

   aFichero = ("7i" + Usuario) % 108;
   |NOME_DAT #900 aFichero;
   |NOME_DAT #901 aFichero;
   |ABRE #900; |CIERRA #900; |DELINDEX #900;

   aDTipo = #0#18;
   aHTipo = #0#18;
   |SI #0#18 = "A";
       aDTipo = "R"; aHTipo = "S";
   |FINSI;

   aQueQuiero = "|NC";
   aNumCampos = #camaniva#aQueQuiero#;
   nNumCampos = aNumCampos;
   nNumCampos = nNumCampos - 1;

   nSwAlgun = 0;
   |ABRE #900;
   |BUCLE caymaniva;
   |CIERRA #900;
   |SI nSwAlgun = 1;
       |HAZ HagoTodo;
   |SINO;
       |MENAV "    No existe Facturas dentro de la seleccion informada";
   |FINSI;
   |DELINDEX #900;

   |DESCARGA_DEF #901;
|FCAL;

|PROGRAMA;

  |HAZ inicio;

  |ABRE #200;
  |LEE 000#200p;
  |SI FSalida ! 0;
      |DDEFECTO #200;
      |GRABA 040#200n;
  |FINSI;
  |CIERRA #200;
  |HAZ eParaModelos;

  aAlfa1 = #200#44;
  |C_M #0#6,1,aAlfa1;
  |C_M #0#7,1,aAlfa1;

  |ABRE #0;
  #0#28 = "A";
  |LEE 101#0=;
  |SI FSalida ! 0;
      |DDEFECTO #0;
      #0#4 = fec1;
      #0#5 = fec2;
      |GRABA 020#0b;
  |FINSI;
  |CLS;
  |PINPA #0#0;
  |PINDA #0#0;

  |ENDATOS #1#0;
  |SI FSalida = 0;
      |GRABA 020#0a;
  |FINSI;
  |LIBERA #0;
  |CIERRA #0;
|FPRO;
