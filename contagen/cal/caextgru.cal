|FICHEROS;
   caextgru #0;
   camaasil #1;
   camaasic #2;
   cacuenta #3;
   :/modelos/def/dsmom035 #6;
   :/modelos/def/dsmom036 #7;
   caconimp #8;
   ca8m0004 #404;

   canempre #30;
|FIN;

|VARIABLES;
   &entrada = 1;

   nCampo   = 0;
   aAlfa1   = "";
   men1     = "    NO existe Grupo de Conceptos!";
   men2     = "     Longitud de Cuenta Fuera de Nivel !";
   mensa1   = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
   x = 0;
   xy = 0;
   informe = "caextgru";
   long = "  ";
   cta  = 0;
   num   = 0;
   swdig = 0;
   alfa1 = "";

   &cuenta = "";
   &asiento = 0;  || datos del informe por linea
   &debe = 0;
   &haber = 0;
   &saldo = 0;
   &t_debe  = 0; || totales por cuenta
   &t_haber = 0;
   &t_saldo = 0;
   &t_degru = 0;
   &t_hagru = 0;
   &grup1 = 0;
   &grup2 = "";

   t_debe1 = 0;
   t_habe1 = 0;
   t_debe2 = 0;
   t_habe2 = 0;
   t_debe3 = 0;
   t_habe3 = 0;
   t_debe4 = 0;
   t_habe4 = 0;
   t_debe5 = 0;
   t_habe5 = 0;

   &s_debe = 0;   || total general
   &s_haber = 0;
   &s_saldo = 0;
   &s_degru = 0;
   &s_hagru = 0;

   &s_debe1 = 0;
   &s_habe1 = 0;
   &s_debe2 = 0;
   &s_habe2 = 0;
   &s_debe3 = 0;
   &s_habe3 = 0;
   &s_debe4 = 0;
   &s_habe4 = 0;
   &s_debe5 = 0;
   &s_habe5 = 0;

   sw_con = 0;          || 1 = EL CONCEPTO ES BUENO
   sw_print = 0;        || 1 = NO DEBO ESCRIBIR
   sw_prim = 0;         || 0 = PRIMERA VEZ
   sw_cuen = 0;          ||1 = Hemos Leido la cuenta
   sw_pagina = 0;

   &swant = 0;
   &sw_inf = 0;
   &sw_cab = 0;
   &pagina = 0;

   cant1 = 0;
   cant2 = 0;
   cant3 = 0;
   cant4 = 0;
   cant5 = 0;

   nDia8      = 0;
   fFec8      = @;
   nDoc8      = 0;
   nIgual     = 0;
   nAsto8     = 0;
   nDiaAper   = 0;
   contra_ad  = "";
   contra_tad = "";
   contra_ah  = "";
   contra_tah = "";
   nSwAper    = 0;
   contra_d   = "";
   contra_td  = "";
   contra_h   = "";
   contra_th  = "";
|FIN;

|INCLUYE dscont_i;

|| *********************************************************************
||                             COMIENZO
|| *********************************************************************
|PROCESO seleccio2; |TIPO 0;
   |SI #caextgru#22 = "N";
      |CAMPO_MODIFICA #caextgru#23, 1, "S"; |CAMPO_MODIFICA #caextgru#24, 1, "S";
      |CAMPO_MODIFICA #caextgru#25, 1, "S"; |CAMPO_MODIFICA #caextgru#26, 1, "S";
      |CAMPO_MODIFICA #caextgru#27, 1, "S"; |CAMPO_MODIFICA #caextgru#28, 1, "S";
      |CAMPO_MODIFICA #caextgru#29, 1, "S"; |CAMPO_MODIFICA #caextgru#30, 1, "S";
      |CAMPO_MODIFICA #caextgru#31, 1, "S"; |CAMPO_MODIFICA #caextgru#32, 1, "S";
      |CAMPO_MODIFICA #caextgru#33, 1, "S"; |CAMPO_MODIFICA #caextgru#34, 1, "S";
      |CAMPO_MODIFICA #caextgru#35, 1, "S"; |CAMPO_MODIFICA #caextgru#36, 1, "S";
      |CAMPO_MODIFICA #caextgru#37, 1, "S";
      |CAMPO_MODIFICA #caextgru#0, 1, "N"; |CAMPO_MODIFICA #caextgru#1, 1, "N";
      #caextgru#0 = "            "; #caextgru#4 = 0; |PINTA #caextgru#0;
      #caextgru#1 = "            "; #caextgru#5 = 9; |PINTA #caextgru#1;
   |SINO;
      |CAMPO_MODIFICA #caextgru#0, 1, "S"; |CAMPO_MODIFICA #caextgru#1, 1, "S";
      |CAMPO_MODIFICA #caextgru#23, 1, "N"; |CAMPO_MODIFICA #caextgru#24, 1, "N";
      |CAMPO_MODIFICA #caextgru#25, 1, "N"; |CAMPO_MODIFICA #caextgru#26, 1, "N";
      |CAMPO_MODIFICA #caextgru#27, 1, "N"; |CAMPO_MODIFICA #caextgru#28, 1, "N";
      |CAMPO_MODIFICA #caextgru#29, 1, "N"; |CAMPO_MODIFICA #caextgru#30, 1, "N";
      |CAMPO_MODIFICA #caextgru#31, 1, "N"; |CAMPO_MODIFICA #caextgru#32, 1, "N";
      |CAMPO_MODIFICA #caextgru#33, 1, "N"; |CAMPO_MODIFICA #caextgru#34, 1, "N";
      |CAMPO_MODIFICA #caextgru#35, 1, "N"; |CAMPO_MODIFICA #caextgru#36, 1, "N";
      |CAMPO_MODIFICA #caextgru#37, 1, "N";
   |FINSI;
|FPRC;

|PROCESO empieza; |TIPO 7;
   #caextgru#2 = fec1;
   #caextgru#3 = fec2;
   |PINTA #caextgru#2;
   |PINTA #caextgru#3;
|FPRC;

|PROCESO leegrupo; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #caextgru#Campo# = 0; |ACABA; |FINSI;
   x = Campo + 5;
   |ABRE #6;
   #dsmom035#0 = #caextgru#Campo#;
   |LEE 001#6=;
   salidas = FSalida;
   |CIERRA #6;
   |SI salidas ! 0;
      |MENAV men1;
      |ERROR;
   |SINO;
      #caextgru#x# = #dsmom035#1;
      |PINTA #caextgru#x#;
   |FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 6;
     eaCuenta = #caextgru#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #caextgru#Campo# = eaCuenta;
     |PINTA #caextgru#Campo#;

   |SI #caextgru#Campo# = "            ";  |ACABA;  |FINSI;
   |SI Campo [ 1;
      x = Campo + 4;
   |SINO;
      x = Campo + 15;
   |FINSI;
   cta  = #caextgru#Campo#;
   long = cta % 0;
   swdig = 0;
   |SI long = #canempre#14; swdig = 1; #caextgru#x# = 1; |FINSI;
   |SI long = #canempre#15; swdig = 1; #caextgru#x# = 2; |FINSI;
   |SI long = #canempre#16; swdig = 1; #caextgru#x# = 3; |FINSI;
   |SI long = #canempre#17; swdig = 1; #caextgru#x# = 4; |FINSI;
   |SI long = #canempre#18; swdig = 1; #caextgru#x# = 5; |FINSI;
   |SI long = #canempre#19; swdig = 1; #caextgru#x# = 6; |FINSI;
   |SI swdig = 0;  |MENAV men2;  |ERROR;  |FINSI;
|FPRC;

|PROCESO fechad;
   |SI #caextgru#2 < fec1; |O #caextgru#2 > fec2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
   |FINSI;
|FPRC;

|PROCESO fechah;
   |SI #caextgru#3 < fec1; |O #caextgru#3 > fec2; |O #caextgru#3 < #caextgru#2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
   |FINSI;
|FPRC;
|FPRC;

|PROCESO no_dep; |TIPO 7;
   |CAMPO_MODIFICA #caextgru#6, 1, eaDepar;
   |CAMPO_MODIFICA #caextgru#7, 1, eaDepar;
|FPRC;
|PROCESO nosubde; |TIPO 7;
   |CAMPO_MODIFICA #caextgru#53, 1, eaSubde;
   |CAMPO_MODIFICA #caextgru#54, 1, eaSubde;
|FPRC;

|| **********************************************************************
|PROCESO ParaApertura;
   nDia8  = -1;
   nAsto8 = 0;
   contra_ad  = ""; contra_tad = "";
   contra_ah  = ""; contra_tah = "";

   |SI enEjercicio = 2008;
       |ABRE #8;
       |DDEFECTO #8;
       #8#0 = 1;
       |LEE 001#8=;
       |CIERRA #8;

       |SI #8#11 = "S";
           |ABRE #404;
           |LEE 001#404p;
           |SI FSalida = 0;
               nDia8 = #404#10;
               fFec8 = #404#11;
               nDoc8 = #404#12;
           |FINSI;
           |CIERRA #404;
           |ABRE #2;
           #2#0 = nDia8;
           #2#1 = fFec8;
           #2#2 = nDoc8;
           |LEE 001#2=;
           |SI FSalida = 0;
               contra_ad  = #2#10; contra_tad = "";
               contra_ah  = #2#8;  contra_tah = "";
               |HAZ LeeContra;
           |FINSI;
           |CIERRA #2;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO LeeContra;
  |ABRE #3;
  |DDEFECTO #3;
  #3#0 = contra_ad;
  |LEE 000#3=;
  contra_tad = #3#2;

  |DDEFECTO #3;
  #3#0 = contra_ah;
  |LEE 000#3=;
  contra_tah = #3#2;

  |CIERRA #3;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Extractos por Grupos ";
   |HAZ inicio;

   |HAZ DirAplicSt;
   |SI Haymodelo = 0; |ACABA; |FINSI;
   aAlfa1 = aPModelo + "/fich/";
   |PATH_DAT #6 aAlfa1;

   |HAZ ParaApertura;

   FSalida = 1;
   |PARA;|SI FSalida = 1; |HACIENDO;
      sw_pagina = 0;
      sw_prim   = 0;
      sw_print  = 0;
      sw_inf    = 0;
      sw_cuen   = 0;
      |DDEFECTO #0;
      |PINPA #0#0;
      |PINDA #0#0;                    || Pinta los datos por defecto
      |ENDATOS #1#0;                  || Seleccion informe
      |SI FSalida = 0;                || Si el conforme es igua a S
         |HAZ borrar;
         |HAZ impre;                 || Calculo impresion
         FSalida = 1;                || Vuelve al bucle
      |SINO;
         FSalida = 0;
      |FINSI;
   |SIGUE;
|FPRO;

|| *************************************************************************
||                               MEOLLO
|| *************************************************************************
|PROCESO cabecera;
   #camaasic#0 = #camaasil#0;
   #camaasic#1 = #camaasil#1;
   #camaasic#2 = #camaasil#2;
   |LEE 040#2=;
   |SI FSalida ! 0;
      |DDEFECTO #2;
   |FINSI;

   |SI nSwAper ! 0;
       |SI nSwAper = 1;
           nAsto8 = #2#3 - 1; |SI nAsto8 [ 0; nAsto8 = 1; |FINSI;
           #2#3 = nAsto8;
       |SINO;
           #2#3 = nAsto8 + 1;
       |FINSI;
   |FINSI;

   asiento = #camaasic#3;
|FPRC;

|PROCESO congru;
   sw_con = 0;
   cant1 = 0; cant2 = 0; cant3 = 0; cant4 = 0; cant5 = 0;
   |ABRE #7;

   |ET grupo1;
   |SI #caextgru#12 ! 0;
       #dsmom036#0 = #caextgru#12;
       #dsmom036#1 = #camaasil#6;
       |LEE 001#7=;
       |SI FSalida = 0;
           sw_con = 1;
           cant1 = #camaasil#9;
       |FINSI;
   |FINSI;

   |SI #caextgru#13 ! 0;
       #dsmom036#0 = #caextgru#13;
       #dsmom036#1 = #camaasil#6;
       |LEE 001#7=;
       |SI FSalida = 0;
           sw_con = 1;
           cant2 = #camaasil#9;
       |FINSI;
   |FINSI;

   |SI #caextgru#14 ! 0;
       #dsmom036#0 = #caextgru#14;
       #dsmom036#1 = #camaasil#6;
       |LEE 001#7=;
       |SI FSalida = 0;
           sw_con = 1;
           cant3 = #camaasil#9;
       |FINSI;
   |FINSI;

   |SI #caextgru#15 ! 0;
       #dsmom036#0 = #caextgru#15;
       #dsmom036#1 = #camaasil#6;
       |LEE 001#7=;
       |SI FSalida = 0;
           sw_con = 1;
           cant4 = #camaasil#9;
       |FINSI;
   |FINSI;

   |SI #caextgru#16 ! 0;
       #dsmom036#0 = #caextgru#16;
       #dsmom036#1 = #camaasil#6;
       |LEE 001#7=;
       |SI FSalida = 0;
           sw_con = 1;
           cant5 = #camaasil#9;
       |FINSI;
   |FINSI;

   |CIERRA #7;
|FPRC;

|PROCESO leecuen;
   sw_cuen = 1;
   #cacuenta#0 = #camaasil#4;
   #cacuenta#1 = #camaasil#5;
   |LEE 040#3=;
   |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
   swant = 0;
   t_debe = 0;
   t_haber = 0;
   t_saldo = 0;
   t_debe1 = 0;
   t_habe1 = 0;
   t_debe2 = 0;
   t_habe2 = 0;
   t_debe3 = 0;
   t_habe3 = 0;
   t_debe4 = 0;
   t_habe4 = 0;
   t_debe5 = 0;
   t_habe5 = 0;
|FPRC;

|PROCESO Apertura2008;
   |SALVA_DATOS #1;

   |ABRE #404;
   |DDEFECTO #404;
   #404#10 = nDia8;
   #404#11 = fFec8;
   #404#12 = nDoc8;
   #404#0  = #1#3;
   |LEE 041#404=;
   |SI FSalida ! 0; |O #404#8 ! #1#4; || no existe o no son iguales
       |CIERRA #404;
       |REPON_DATOS #1;
       |HAZ ParaImprimir;
       |ACABA;
   |FINSI;
   || .... Primer Asiento Apertura 2007
   nSwAper   = 1;
   contra_d  = contra_ad;
   contra_td = contra_tad;
   contra_h  = contra_ah;
   contra_th = contra_tah;
   #1#4 = #404#1;
   #1#5 = #404#7;
   |HAZ ParaImprimir;
   |SI #404#8 ! #404#1;
       nSwAper = 2;
       contra_d  = #404#8; contra_td = #404#2;
       contra_h  = #404#8; contra_th = #404#2;
       #1#4 = #404#1;   || 2§ asiento
       #1#5 = #404#7;
       #1#7 = #8#13;
       |SI #404#3 = "D";
           #1#8 = "H";
       |SINO;
           #1#8 = "D";
       |FINSI;
       #1#9 = #404#4 + #404#5;
       |HAZ ParaImprimir;

       contra_d  = #404#1; contra_td = #404#2;
       contra_h  = #404#1; contra_th = #404#2;
       #1#4 = #404#8;   || 2§ asiento
       #1#5 = #404#9;
       #1#7 = #8#13;
       #1#8 = #404#3;
       #1#9 = #404#4 + #404#5;
       |HAZ ParaImprimir;
   |FINSI;
   |CIERRA #404;
   |REPON_DATOS #1;
|FPRC;

|PROCESO buclepan;
   sw_con = 1;
   |HAZ congru;
   |SI sw_con = 0; |ACABA;  |FINSI; || no es concepto seleccionado

   |SI sw_prim = 0;
      cuenta = #camaasil#4;
      sw_prim  = 1;
      |HAZ leecuen;
   |FINSI;
   |SI cuenta ! #camaasil#4;
      |SI sw_print = 0;
         |HAZ impr_totales;
      |FINSI;
      || ........... |HAZ borrar;
      cuenta = #camaasil#4;
      |HAZ leecuen;
   |FINSI;

   nSwAper = 0;
   |SI nDia8 ! -1;
       |SI #1#0 = nDia8; |Y #1#1 = fFec8; |Y #1#2 = nDoc8;
           |HAZ Apertura2008;
           nDiaAper = 1;
           |ACABA;           ||este asiento se trata de forma diferente
       |FINSI;
   |FINSI;

   |HAZ ParaImprimir;
|FPRC;

|PROCESO ParaImprimir;
   |SI #camaasil#8 = "D";
      debe = #camaasil#9;
      haber = 0;
   |SINO;
      debe = 0;
      haber = #camaasil#9;
   |FINSI;
   saldo = t_saldo + (debe - haber);

   |SI #camaasil#1 < #caextgru#2;
      |HAZ suma_totales;
      sw_print = 1;
      swant = 1;
      |ACABA;
   |FINSI;

   |SI #camaasil#1 ] #caextgru#2; |Y #camaasil#1 [ #caextgru#3;
      |HAZ cabecera;
      |SI sw_cuen = 1;
         sw_cab = 1;
         sw_inf = 0;
         |PRINT;
         sw_cab = 0;
         sw_cuen = 0;
      |FINSI;
      sw_inf = 1;
      sw_cab = 0;
      |PRINT;
      sw_cab = 0;
      sw_print = 0;
      swant = 1;
   |FINSI;
   |HAZ suma_totales;

|FPRC;

|DEFBUCLE caextrim0;
   #1#3;
   0, 21,28;
   #0#0,  fec1, 000000, 0001, #0#8, #0#6, #0#53;
   #0#1,  #0#3, 999999, 9999, #0#9, #0#7, #0#54;
   e;
   NULL, buclepan;
|FIN;

|PROCESO impre;
   |IMPRE 0;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |INFOR "caextgru";

   |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

   |ABRE #2;
   |ABRE #3;
   |SI #caextgru#22 = "N";
      |PARA nCampo = 23; |SI nCampo [ 37; |HACIENDO nCampo = nCampo + 1;
         |SI #caextgru#x# ! "            ";
            #caextgru#0 = #caextgru#nCampo#;
            #caextgru#1 = #caextgru#nCampo#;
            |BUCLE caextrim0;
         |FINSI;
      |SIGUE;
   |SINO;
      |BUCLE caextrim0;
   |FINSI;
   |CIERRA #2;
   |CIERRA #3;
   |SI sw_prim = 1;
      |SI sw_print = 0;
         |HAZ impr_totales;
      |FINSI;
      |PIEINF;
   |FINSI;
   |FININF;
   |FINIMP;
|FPRC;

|PROCESO borrar;
   s_debe = 0;
   s_haber = 0;
   s_saldo = 0;
   swant = 0;
   s_degru = 0;
   s_hagru = 0;
   s_debe1 = 0;
   s_habe1 = 0;
   s_debe2 = 0;
   s_habe2 = 0;
   s_debe3 = 0;
   s_habe3 = 0;
   s_debe4 = 0;
   s_habe4 = 0;
   s_debe5 = 0;
   s_habe5 = 0;
   nDiaAper = 0;
|FPRC;

|PROCESO &c_pagina;
   |SI sw_pagina = 0;
      pagina = 1;
      sw_pagina = 1;
   |SINO;
      pagina = pagina + 1;
   |FINSI;
   sw_cab = 1;
|FPRC;

|PROCESO suma_totales;
   t_debe  = t_debe  + debe;
   t_haber = t_haber + haber;
   t_saldo = t_debe - t_haber;
   s_debe  = s_debe  + debe;
   s_haber = s_haber + haber;
   s_saldo = s_debe - s_haber;
   |SI #camaasil#8 = "D";
      t_debe1 = t_debe1 + cant1;
      t_debe2 = t_debe2 + cant2;
      t_debe3 = t_debe3 + cant3;
      t_debe4 = t_debe4 + cant4;
      t_debe5 = t_debe5 + cant5;
      s_debe1 = s_debe1 + cant1;
      s_debe2 = s_debe2 + cant2;
      s_debe3 = s_debe3 + cant3;
      s_debe4 = s_debe4 + cant4;
      s_debe5 = s_debe5 + cant5;
   |SINO;
      t_habe1 = t_habe1 + cant1;
      t_habe2 = t_habe2 + cant2;
      t_habe3 = t_habe3 + cant3;
      t_habe4 = t_habe4 + cant4;
      t_habe5 = t_habe5 + cant5;
      s_habe1 = s_habe1 + cant1;
      s_habe2 = s_habe2 + cant2;
      s_habe3 = s_habe3 + cant3;
      s_habe4 = s_habe4 + cant4;
      s_habe5 = s_habe5 + cant5;
   |FINSI;
|FPRC;

|PROCESO impr_totales;
   sw_cab = 0;
   sw_inf = 2; || linea totales
   |PRINT;
   sw_cab = 0;
   |SI #caextgru#12 ! 0;
      grup1 = #caextgru#12; grup2 = #caextgru#17;
      t_degru = t_debe1; t_hagru = t_habe1;
      sw_inf = 3;
      |PRINT;
      sw_cab = 0;
   |FINSI;
   |SI #caextgru#13 ! 0;
      grup1 = #caextgru#13; grup2 = #caextgru#18;
      t_degru = t_debe2; t_hagru = t_habe2;
      sw_inf = 3;
      |PRINT;
      sw_cab = 0;
   |FINSI;
   |SI #caextgru#14 ! 0;
      grup1 = #caextgru#14; grup2 = #caextgru#19;
      t_degru = t_debe3; t_hagru = t_habe3;
      sw_inf = 3;
      |PRINT;
      sw_cab = 0;
   |FINSI;
   |SI #caextgru#15 ! 0;
      grup1 = #caextgru#15; grup2 = #caextgru#20;
      t_degru = t_debe4; t_hagru = t_habe4;
      sw_inf = 3;
      |PRINT;
      sw_cab = 0;
   |FINSI;
   |SI #caextgru#16 ! 0;
      grup1 = #caextgru#16; grup2 = #caextgru#21;
      t_degru = t_debe5; t_hagru = t_habe5;
      sw_inf = 3;
      |PRINT;
      sw_cab = 0;
   |FINSI;
   sw_inf = 4;
   |PRINT;
   sw_cab = 0;
|FPRC;
