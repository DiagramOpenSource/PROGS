|FICHEROS;
     dsapum02;
     canempre;
|FIN;

|VARIABLES;
     nEj                 = 0;

     aAlfa               = "";
     aBase               = "";

     &enEmpresa          = 0;
     &enPeriodo          = 0;
     &eaNombreEmp        = "";
     &enEjercicio        = 0;
     &eaAsi              = "";
|FIN;

|PROCESO canempre;
     nEj = 2000 + #canempre#26;

     |SI nEj < #dsapum02#8;   |ACABA;  |FINSI;
     |SI nEj > #dsapum02#9;   |ACABA;  |FINSI;

     |DBASE aBase;
     aAlfa = aBase + "fich/" +  (("00000" + #canempre#2) % -105) + #canempre#3 + "/";
     aAlfa = aAlfa + "caenlace.dat";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     enEmpresa   = #canempre#2;
     enPeriodo   = #canempre#3;
     eaNombreEmp = #canempre#1;
     enEjercicio = #canempre#26;

     eaAsi = #dsapum02#10;
     aAlfa = ":contagen/dsapuz01 canempr1 ";
     aAlfa = aAlfa + (("00000" + #canempre#2) % -105) + #canempre#3;
     aAlfa = aAlfa + ";" + "CRON";
     |SUB_EJECUTA aAlfa;
|FPRC;

|DEFBUCLE canempre;
     #canempre#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, canempre;
|FIN;

|PROCESO Recoge;
     |BUCLE canempre;
|FPRC;

|PROGRAMA;
     |ABRE #dsapum02;
     |LEE 000#dsapum02.p;
     |SI FSalida = 0;
         |HAZ Recoge;
     |FINSI;
     |CIERRA #dsapum02;
|FPRO;
