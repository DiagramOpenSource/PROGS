|FICHEROS;
   caexicon #0;

   caexistl #1;
   cacuenta #2;
   caexistc #3;

|FIN;

|VARIABLES;
   &d_mes = 0;
   &h_mes = 0;
   &estru = 0;
   desmes = 0;
   hasmes = 0;
   &r_emp= 0;
   &r_per= 0;
   &r_eje= 0;
   &r_nom="";
   alfa1 = "";
   alfa2 = "";

   &enSoloF = 0;
   nLaEstructura = 0;
   nDLaEst = 0;
   nHLaEst = 0;

   nSwModifE = 0;
   nSwModifG = 0;
   nSwSalir  = 0;
   nInkey    = 0;
   nSwSinCta = 0;

   dir_fich1 = "";
   aPathFic  = "";
|FIN;

|INCLUYE dscont_i;

|| **************************************************************************
|PROCESO aPathFic; || calcular el directorio base de los ficheros
   |DBASE dir_fich1;
   aPathFic = dir_fich1 + "fich/";
   alfa1 = r_emp;
   alfa2 = r_per;
   alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
   alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
   aPathFic = aPathFic + alfa1 + alfa2 + "/";

   |PATH_DAT #caexicon #aPathFic#;
   |PATH_DAT #caexistc #aPathFic#;
   |PATH_DAT #caexistl #aPathFic#;
   |PATH_DAT #cacuenta #aPathFic#;

   cod1 = r_emp;
   cod2 = r_per;
   emEmp = 1;        || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;
|FPRC;

|| /////////////////////////////
|PROCESO lee_existenci1;
   |DDEFECTO #0;
   #caexicon#0 = #caexistl#1;
   #caexicon#1 = #caexistl#2;
   #caexicon#2 = #caexistl#3;
   #caexicon#3 = #caexistl#4;
   #caexicon#4 = #caexistl#11;
   #caexicon#5 = #caexistl#desmes#;
   #caexicon#6 = #caexistl#hasmes#;
   |GRABA 020#0n;
   |SI #caexistl#2 = doce; |Y #caexistl#1 = 1;
       nSwSinCta = 1;
   |FINSI;
|FPRC;

|DEFBUCLE lee_existencia;
   #1#1;
   ;
   estru,0;
   estru,99;
   e;
   NULL,lee_existenci1;
|FIN;
|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|| ////////////////////////////////////
|PROCESO gra_existenci1;
   #caexicon#0 = #caexistl#1;
   |LIBERA #0;
   |LEE 140#0=;
   #caexistl#11 = #caexicon#4;
   #caexistl#desmes# = #caexicon#5;
   #caexistl#hasmes# = #caexicon#6;
   |GRABA 140#1a;
   |LIBERA #1;
|FPRC;

|DEFBUCLE gra_existencia;
   #1#1;
   ;
   estru,0;
   estru,99;
   be;
   NULL,gra_existenci1;
|FIN;
|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO ImpNegativo; |TIPO 0;
  |SI #0Campo < 0;
      |MENAV "    Error. Importe de Existencias en Negativo";
      |ERROR;
  |FINSI;
|FCAL;


|CALCULO esbaja;  |TIPO 11;

   nInkey = FSalida;

   |SI nInkey = 11;
       nSwSalir = 1;
       |PTEC 806;
       |ACABA;
   |FINSI;

   |SI nInkey ! 10; |ACABA;  |FINSI;

   |SI estru = 0;
       |MENAV  "0000Estructura NO modificable";
       |AVISO;
       |ACABA;
   |FINSI;

   |SI nSwSinCta = 1;
       |MENAV  "0000Estructura SIN Cuentas. Toma Saldos de la Cuentas";
       |AVISO;
       |ACABA;
   |FINSI;

   |LIBERA #0;
   |LEE 140#0=;

   |ET campo1;
       |ENCAMPO #5#0;
       |SI FSalida = 9;
           |ENCAMPO #4#0;
           |SI FSalida = 7;
               |HAZ repinta;
               |ACABA;
           |FINSI;
           |VETE campo1;
       |FINSI;

       |SI FSalida = 10;
           |HAZ planconta;
           |VETE campo1;
       |FINSI;

       |SI FSalida = 7;
           |HAZ repinta;
           |ACABA;
       |FINSI;

       |SI FSalida = 2;  |VETE campo1;  |FINSI;
       |ENCAMPO #6#0;
       |SI FSalida = 7;
           |HAZ repinta;
           |ACABA;
       |FINSI;
       |SI FSalida = 2;  |VETE campo1;  |FINSI;

       |GRABA 140#0a;

       nSwModifE = 1;
|FCAL;


|PROCESO repinta;
   |LIBERA #0;
   |LEE 140#0=;
   |PINTA #caexicon#0;
   |PINTA #caexicon#1;
   |PINTA #caexicon#3;
   |PINTA #caexicon#4;
   |PINTA #caexicon#5;
   |PINTA #caexicon#6;
|FPRC;

|PROCESO planconta;
   |ABRE #2;
   #cacuenta#0 = #caexicon#1;
   #cacuenta#1 = #caexicon#2;
   |LEE 140#2=;
   #caexistl#11 = #cacuenta#9;
   #caexistl#12 = #cacuenta#12;
   #caexistl#13 = #cacuenta#15;
   #caexistl#14 = #cacuenta#18;
   #caexistl#15 = #cacuenta#21;
   #caexistl#16 = #cacuenta#24;
   #caexistl#17 = #cacuenta#27;
   #caexistl#18 = #cacuenta#30;
   #caexistl#19 = #cacuenta#33;
   #caexistl#20 = #cacuenta#36;
   #caexistl#21 = #cacuenta#39;
   #caexistl#22 = #cacuenta#42;
   #caexistl#23 = #cacuenta#45;
   #caexistl#24 = #cacuenta#48;
   #caexicon#4 = #caexistl#11;
   #caexicon#5 = #caexistl#desmes#;
   #caexicon#6 = #caexistl#hasmes#;
   |PINTA #caexicon#4;
   |PINTA #caexicon#5;
   |PINTA #caexicon#6;
   |LIBERA #2;
   |CIERRA #2;
|FPRC;

|| *********************************************************************
|RUTINA min;
   #caexicon#0 = 1;
|FRUT;

|RUTINA max;
   #caexicon#0 = 99;
|FRUT;


|PROGRAMA;

   |HAZ aPathFic;

   |SI enSoloF = 1;
       |C_M #0#5,1,"N";
       enSoloF = 0;
   |FINSI;
   desmes = d_mes + 11;
   hasmes = h_mes + 11;

   nLaEstructura = estru;
   nDLaEst       = estru;
   nHLaEst       = estru;
   |SI enTExi = 1; |Y estru = 0;
       nDLaEst = 1; nHLaEst = 99;
   |FINSI;

   |ABRE #3;
   nSwModifE = 0;
   nSwModifG = 0;
   nSwSalir  = 0;
   |PARA estru = nDLaEst; |SI estru [ nHLaEst; |HACIENDO estru = estru + 1;

         nSwSinCta = 0;
         nSwModifE = 0;
         #3#0 = estru;
         |LEE 001#3=;
         |SI FSalida = 0;

             |DELINDEX #0;
             |ABRE #0;
             |BUCLE lee_existencia;
             |CIERRA #0;

             |PINPA #0#0;
             |ATRI I;
             |PINTA 0713, alfa1;
             |PINTA 0719, r_per;
             |PINTA 0721, r_nom;
             |PINTA 0774, r_eje;
             |PINTA 0818, #3#0;
             |PINTA 0822, #3#1;
             |SI nSwSinCta = 1;
                 |ATRI P; |PINTA 0543, "ESTRUCTURA SIN CUENTAS"; |ATRI 0;
             |FINSI;

             |ATRI 0;
             |ENTLINEAL #1#0, -1, 4, 22, 0, min, max;

             |SI nSwModifE = 1;
                 |ABRE #0;
                 |BUCLE gra_existencia;
                 |CIERRA #0;
                 nSwModifG = 1;
             |FINSI;
             |SI nSwSalir = 1; estru = 99; |FINSI;

             |DELINDEX #0;
         |FINSI;

      |SIGUE;

      |CIERRA #3;

      estru = nLaEstructura;
      |SI nSwModifG = 1; |HAZ ExisGeneral; |FINSI;
|FPRO;

|| **************************************************************************
