|INCLUYE dscont_i;

|FICHEROS;
   canempre #0;         || para que sirvan las rutinas del 'basica'
   canempr2 #1;
   cafantas #2;

   caportad #12;
   :/basica/def/agicen14  #114;
   :/modelos/def/dsmom100 #100;

   ca8ctrle #400;
   ca8comay #401;
|FIN;

|VARIABLES;
   &entrada = 1;
     nSwNO = 0;
   nInkey  = 0;
   error1 = "0000Nivel repetido o valor mas bajo que los anteriores";
   traba ="";
   traba1 = 0;
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   fFecha1 = @;
   nume0 = 0;
   nume1 = 0;
   perio = 0;
   agi = "";
   agi1 = "";
   agi2 = "";
   nPeriodo = 0;
   men6 = "    NConfirma el Alta en 'Clientes General' (S/N): ";

   aCampo30 = "";
   aCampo31 = "";
   con = 0;
   aste = "";
   longi = "";
   num   = 0;
   limpe1 = 0;
   limpe2 = 0;
   letra = "";
   final = "";
   x = "";
   nume2 = 0;
   lugar = 0;
   nifnum = 0;
   resto = 0;
   Comodin  = "";
   elCodPostal = "";
   &any_pos = 0;
   nSwCambia = 0;
   aAlfa     = "";
   nNume     = 0;
   nTitulo   = 0;

   swEntrada  = 0;

   aDir       = "";
   aFich      = "";

   &enEmpres  = 0;
   &enEjerci  = 0;
   &enActivi  = 0;
   &eaCodSub  = "";
   &eaVarDni  = "";
   &enCalcCif = 0;

   nCam4  = 0;
   nCam5  = 0;
   nCam6  = 0;
   nCam7  = 0;
   nCam8  = 0;
   nCam9  = 0;
   nCam10 = 0;

   aClave    = "";
   aPassword = "";
   aDepAnt   = "";
   aSubAnt   = "";
   &enCambio = 0;
   nEjer     = 0;
|FIN;

|INCLUYE datpor_i;


|PROCESO letra_0;  |TIPO 6;
   |SI FSalida = 10;
      enCalcCif = 1;
      eaVarDni  = #canempr2#Campo#;
      |HAZ CalculoDNI;
      #canempr2#Campo# = eaVarDni;
      |PINTA #canempr2#Campo#;
      |ERROR;
      |ACABA;
   |FINSI;

     eaVarDni  = #1Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "                ") % 115;
     |SI #1Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #1Campo = eaVarDni;  |PINTA #1Campo;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO clave; |TIPO 0;
   traba1 = ((#canempr2#2*10) + #canempr2#3);
   traba = traba1;
   traba = "0000000" + traba;
   alfa1 = traba % -106;
   #canempr2#0 = alfa1;
|FPRC;

|PROCESO mismos; |TIPO 0;

   nume1 = (FEntrada / 100) ! 0;

   |SI nume1 = 1;
       perio = #canempr2#3;
       #canempr2#3 = #canempr2#3 - 1;
       |SI #canempr2#3 < 0; #canempr2#3 = 9; |FINSI;
       |LEE 041#1=;
       |SI FSalida = 0;
           #canempr2#26 = #canempr2#26 + 1;
           |SI #canempr2#26 = 100;
               #canempr2#26 = 0;
           |FINSI;
       |SINO;
           #canempr2#13 = nCam4;
           #canempr2#14 = nCam5;
           #canempr2#15 = nCam6;
           #canempr2#16 = nCam7;
           #canempr2#17 = nCam8;
           #canempr2#18 = nCam9;
           #canempr2#19 = nCam10;
           fFecha1 = ~;
           aAlfa1        = fFecha1; aAlfa1 = aAlfa1 % -102;
           #canempr2#26  = aAlfa1;

       |FINSI;
       #canempr2#3 = perio;
       traba1 = ((#canempr2#2*10) + #canempr2#3);
       traba = traba1;
       traba = "0000000" + traba;
       alfa1 = traba % -106;
       #canempr2#0 = alfa1;
       #canempr2#28 = "E";
       |PINDA #0#1;
   |FINSI;
|FPRC;

|PROCESO mismos2;

   perio = nPeriodo;
   #canempr2#3 = nPeriodo - 1;
   |SI #canempr2#3 < 0; #canempr2#3 = 9; |FINSI;
   |LEE 041#1=;
   |SI FSalida = 0;
       #canempr2#26 = #canempr2#26 + 1;
       |SI #canempr2#26 = 100;
           #canempr2#26 = 0;
       |FINSI;
   |SINO;
       #canempr2#13 = nCam4;
       #canempr2#14 = nCam5;
       #canempr2#15 = nCam6;
       #canempr2#16 = nCam7;
       #canempr2#17 = nCam8;
       #canempr2#18 = nCam9;
       #canempr2#19 = nCam10;
       fFecha1 = ~;
       aAlfa1        = fFecha1; aAlfa1 = aAlfa1 % -102;
       #canempr2#26  = aAlfa1;
   |FINSI;
   #canempr2#3 = perio;
   traba1 = ((#canempr2#2*10) + #canempr2#3);
   traba = traba1;
   traba = "0000000" + traba;
   alfa1 = traba % -106;
   #canempr2#0 = alfa1;
   #canempr2#34 = "01.01.0000";
   #canempr2#35 = "";
   #canempr2#28 = "E";
   |PINDA #0#1;
|FPRC;

|PROCESO mes; |TIPO 0;
   |SI #canempr2#11 = 1;       ||Si el mes desde es 1 entonces el hasta es 12
      #canempr2#12 = 12;
   |SINO;
      #canempr2#12 = #canempr2#11 - 1; || Si no es uno menos
   |FINSI;
   |PINTA #canempr2#12;
|FPRC;

|PROCESO nivel;|TIPO 7;
   |CAMPO_MODIFICA #canempr2#14, 1,"S";
   |CAMPO_MODIFICA #canempr2#15, 1,"S";
   |CAMPO_MODIFICA #canempr2#16, 1,"S";
   |CAMPO_MODIFICA #canempr2#17, 1,"S";
   |CAMPO_MODIFICA #canempr2#18, 1,"S";
   |CAMPO_MODIFICA #canempr2#19, 1,"S";
   |SI #canempr2#13 < 6;
      |CAMPO_MODIFICA #canempr2#19, 1,"N";
      #canempr2#19 = 0;
      |PINTA #canempr2#19;
      |SI #canempr2#13 < 5;
         |CAMPO_MODIFICA #canempr2#18, 1,"N";
         #canempr2#18 = 0;
         |PINTA #canempr2#18;
         |SI #canempr2#13 < 4;
            |CAMPO_MODIFICA #canempr2#17, 1,"N";
            #canempr2#17 = 0;
            |PINTA #canempr2#17;
            |SI #canempr2#13 < 3;
               |CAMPO_MODIFICA #canempr2#16, 1, "N";
               #canempr2#16 = 0;
               |PINTA #canempr2#16;
               |SI #canempr2#13 < 2;
                  |CAMPO_MODIFICA #canempr2#15, 1,"N";
                  #canempr2#15 = 0;
                  |PINTA #canempr2#15;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO nivelrep;|TIPO 0;  || Para comprobar que no repetimos los niveles
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI Campo = 15;  |Y #canempr2#15 = 0; |Y #canempr2#13 ] 2;
      |MENAV error1;
      |ERROR;
      |ACABA;
   |FINSI;

   |SI Campo = 16;  |Y #canempr2#16 = 0; |Y #canempr2#13 ] 3;
      |MENAV error1;
      |ERROR;
      |ACABA;
   |FINSI;
   |SI Campo = 17;  |Y #canempr2#17 = 0; |Y #canempr2#13 ] 4;
      |MENAV error1;
      |ERROR;
      |ACABA;
   |FINSI;
   |SI Campo = 18;  |Y #canempr2#18 = 0; |Y #canempr2#13 ] 5;
      |MENAV error1;
      |ERROR;
      |ACABA;
   |FINSI;
   |SI Campo = 19;  |Y #canempr2#19 = 0; |Y #canempr2#13 ] 6;
      |MENAV error1;
      |ERROR;
      |ACABA;
   |FINSI;

   |SI Campo = 15; |Y #canempr2#15 ! 0;    || Si hay dos niveles iguales o menor error
      |SI #canempr2#15 [ #canempr2#14;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI Campo = 16; |Y #canempr2#16 ! 0; || Si hay dos niveles iguales o menor error
      |SI #canempr2#16 [ #canempr2#14; |O #canempr2#16 [ #canempr2#15;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI Campo = 17; |Y #canempr2#17 ! 0; || Si hay dos niveles iguales o menor error
      |SI #canempr2#17 [ #canempr2#14; |O #canempr2#17 [ #canempr2#15; |O #canempr2#17 [ #canempr2#16;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI Campo = 18; |Y #canempr2#18 ! 0; || Si hay dos niveles iguales o menor error
      |SI #canempr2#18 [ #canempr2#14; |O #canempr2#18 [ #canempr2#15; |O #canempr2#18 [ #canempr2#16; |O #canempr2#18 [ #canempr2#17;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI Campo = 19; |Y #canempr2#19 ! 0;    || Si hay dos niveles iguales o menor error
      |SI #canempr2#19 [ #canempr2#14; |O #canempr2#19 [ #canempr2#15; |O #canempr2#19 [ #canempr2#16; |O #canempr2#19 [ #canempr2#17; |O #canempr2#19 [ #canempr2#18;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO SiCambia; |TIPO 7;
|FPRC;

|PROCESO Tipo13c2; |TIPO 13;
  enEmpres = enEmpresa;
  enEjerci = 2000 + #1#26;
  enActivi = #1#30;
  eaCodSub = #1#31;
  |SUB_EJECUTA_NP "caz00002";
  |POPV;

 |SI #0#34 > "01.01.0000";
     |PINTA 0658, "F.Bloqueo: ";
     |C_V #0#34,1,"S";
 |SINO;
     |PINTA 0658, "                      ";
     |C_V #0#34,1,"N";
 |FINSI;
 |PINTA 0758, "컴컴컴컴컴컴컴컴컴컴컴";

 |PINTA 0863, "                 ";
 |SI #0#26 < 80;
     nEjer = 2000 + #0#26;
 |SINO;
     nEjer = 1900 + #0#26;
 |FINSI;
 |SI nEjer ] 2008;
    |ABRE #400;
    #400#0 = #0#2;
    #400#1 = #0#3;
    |LEE 141#400=;
    |SI FSalida = 0;
        |ABRE #401;
        |DDEFECTO #401;
        #401#0 = #400#2;
        |LEE 000#401=;
        |CIERRA #401;
        |ATRI P; |PINTA 0863, "PCG:"; |ATRI 0;
        |PINTA 0867, #400#2;
        |PINTA 0870, #401#2;
   |FINSI;
   |CIERRA #400;
 |FINSI;
|FPRC;

||*****************************************************************
||  MANTENIMIENTO GENERAL
||*****************************************************************

|PROCESO postal;
   |SI HayAcceso = 1;
      alfa1 = #clientes@#35;  alfa1 = "00"  + alfa1;  alfa1 = alfa1 % -102;
      alfa2 = #clientes@#36;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
   |SINO;
      alfa1 = #clientes@#09;  alfa1 = "00"  + alfa1;  alfa1 = alfa1 % -102;
      alfa2 = #clientes@#10;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
   |FINSI;
   elCodPostal = alfa1 + alfa2;
|FPRC;

|PROCESO PonTitulo;  |TIPO 7;
     |ABRE #114;
     #114#0 = #0#2;
     #114#1 = 1;
     |LEE 040#114];
     |SI FSalida ! 0;  |O #114#0 ! #0#2;
         |DDEFECTO #114;
     |FINSI;
     |CIERRA #114;

     aAlfa = #0#29;  |QBF aAlfa;
     |SI aAlfa = "";  |O nTitulo = 1;
         |SI #0#26 ] 80;
             nNume = 1900 + #0#26;
         |SINO;
             nNume = 2000 + #0#26;
         |FINSI;

         aAlfa1 = #0#1;     |QBF aAlfa1;
         aAlfa2 = #114#8;   |QBF aAlfa2;
         aAlfa3 = #114#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #0#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;

         #0#29 = aAlfa;
         |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO ParaQuitar;
     #0#29 = "";
     #0#27 = "S";
     #0#24 = "S";
     |HAZ PonTitulo;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE canempre;
     #0#1;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, ParaQuitar;
|FIN;

|PROCESO CreaPortada;
   |ABRE #caportad;
   |DDEFECTO #caportad;
   #caportad#0  = #canempr2#2;             || Empresa
   #caportad#1  = #canempr2#26;            || Ejercicio
   |LEE 101#caportad.=;
   |SI FSalida ! 0;
      |DDEFECTO #caportad;
      #caportad#0  = #canempr2#2;             || Empresa
      #caportad#1  = #canempr2#26;            || Ejercicio
      |GRABA 020#caportad.b;
   |FINSI;

  |SI HayAcceso = 0; |Y Haybasica = 0; ||No existe ni acceso ni basica
      |HAZ desdecontab;                ||Lee de canempr2
  |SINO;
      enCodCli = #caportad#0;
      |HAZ LeePersona;
      |SI ewClien = 0;
          |HAZ desdebasica;
      |SINO;
          |HAZ desdecontab;
      |FINSI;
      |HAZ AltaNif;
  |FINSI;
  |GRABA 020#caportad.a;
  |LIBERA #caportad;
  |CIERRA #caportad;
|FPRC;
|| **********************************************************************
|PROCESO Tipo2; |TIPO 2;

 nume1 = 0 +. 1;

 |SI nume1 = -1;
     |HAZ MiraClave;
     |SI nSwNO = 1;
         |ERROR;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO MiraClave;
     nSwNO = 0;
     aPassword = "";
     |BLANCO 2302 2379;
     |PINTA 2327, "Entre la CLAVE: ";
     E_inf = "";
     E_sup = "10";
     aPassword = 2343 ? -1;
     |QBF aPassword;
     aClave = #canempr2#20; |QBF aClave;
     |SI aPassword ! aClave;
         |MENAV "     Clave incorrecta.";
         nSwNO = 1;
     |FINSI;
     |BLANCO 2302 2379;
|FPRC;

|PROCESO AltaNueva;

  |DFICE alfa2;
  alfa3 = #canempr2#0;    alfa3 = "000000" + #canempr2#0;    alfa3 = alfa3 % -106;
  alfa1 = alfa2 + alfa3;
  |MKDIR alfa1;
  fich_alta = alfa1 + "/";

  enEmpresa   = #canempr2#2;
  enPeriodo   = #canempr2#3;
  eaMoneda    = #canempr2#28;
  swOperacion = 3;
  |SUB_EJECUTA_NP "camoneda";
  swOperacion = 0;

   ||Creo la ficha en el fichero de portadas de modelos

   |HAZ CreaPortada;
   any_pos = #canempr2#26;
   |SUB_EJECUTA "cacrebal";
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     nInkey = FSalida;

     |SI nInkey = 17;
         nTitulo = 1;
         |BUCLE canempre;
         nTitulo = 0;
         |PTEC 807;
         |ACABA;
     |FINSI;

     |SI nInkey = 10;   ||Modificacion
         |LEE 101#1=;
         aDepAnt = #1#30;
         aSubAnt = #1#31;
         |ENDATOS #2#1;
         |SI FSalida = 0;
             |GRABA 020#1a;
             |HAZ cambiodep;
         |FINSI;
         |LIBERA #1;
     |FINSI;

     |SI nInkey = 11;
         |HAZ MiraClave;
         |SI nSwNO = 0;

             |CONFI "0000NEsta seguro de borrar el Periodo de Contabilidad ";
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             aDir = "";
             |DIRECTORIO aDir;
             |DBASS aBase;   |QBT aBase;
             aBase = aBase + "contagen/fich/";
             aFich = aBase + ((("00000" + #1#2) % -105) + #1#3);
             aAlfa = aDir + "bin/agirm -r " + aFich;
             |SYSTEM aAlfa;

             |LEE 101#1=;
             |SI FSalida = 0;  |BORRA 020#1a;  |FINSI;
             |LIBERA #1;

             enEmpresa = #canempr2#2;
             enPeriodo = #canempr2#3;
             swOperacion = 2;
             |SUB_EJECUTA_NP "camoneda";
             swOperacion = 0;

             |ABRE #400;
             #400#0 = #canempr2#2;
             #400#1 = #canempr2#3;
             |LEE 141#400=;
             |SI FSalida = 0;
                 |BORRA 040#400a;
             |FINSI;
             |LIBERA #400;
             |CIERRA #400;

             |ABRE #caportad;
             #caportad#0  = #canempr2#2;             || Empresa
             #caportad#1  = #canempr2#26;            || Ejercicio
             |LEE 141#caportad.=;
             |SI FSalida = 0;
                 |BORRA 020#caportad.a;
             |FINSI;
             |LIBERA #caportad;
             |CIERRA #caportad;

             |PONCONTROL 23, "SI";
         |FINSI;
     |FINSI;

     |SI nInkey = 12;
         |CONFI "0000NEsta seguro de crear un Periodo Nuevo";
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |LIBERA #1;
         |SALVA_DATOS #1;

         |PUSHV 0501 2380;
         |PARA;  |SI;  |HACIENDO;
              |CUADRO 0723 1151;
              |BLANCO 0824 1050;
              |PINTA 0824, "Introduzca el Nuevo Periodo";
              E_inf = 0;
              E_sup = 9;
              nPeriodo = 1036 ? 1;

              #1#3 = nPeriodo;
              |LEE 040#1=;
              |SI FSalida = 0;
                  |MENAV "     El Periodo ya Existe";
              |SINO;
                  |SAL;
              |FINSI;
         |SIGUE;
         |POPV;
         |PINTA 0658, "                      ";
         |REPON_DATOS #1;
         |HAZ mismos2;
         #1#3  = nPeriodo;
         #1#0  = (#1#2 * 10) + #1#3;
         #1#29 = "";   |PINTA #1#29;
         |GRABA 020#1b;

         |PINTA #1#3;  |PINTA #1#11;
         |PINTA #1#12; |PINTA #1#13;
         |PINTA #1#14; |PINTA #1#15;
         |PINTA #1#16; |PINTA #1#17;
         |PINTA #1#18; |PINTA #1#19;
         |HAZ altacli;

         |ENDATOS #1#1;
         |SI FSalida ! 0;
             |BORRA 020#1a;
             |LIBERA #1;
         |SINO;
             |GRABA 020#1a;
             |LIBERA #1;
             |HAZ AltaNueva;
         |FINSI;

         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|RUTINA ClaveBaja1;
     #1#2  = enEmpresa;
     #1#3  = 0;
|FRUT;

|RUTINA ClaveAlta1;
     #1#2  = enEmpresa;
     #1#3  = 9;
|FRUT;

|PROCESO LeeStandar;
     nCam4  = 4; nCam5  = 1;
     nCam6  = 2; nCam7  = 3;
     nCam8  = 4; nCam9  = 0;
     nCam10 = 0;
     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida = 0;
         |ABRE #0;
         #0#2 = #100#1;
         #0#3 = #100#2;
         |LEE 040#0=;
         |SI FSalida = 0;
             nCam4  = #0#13;
             nCam5  = #0#14;
             nCam6  = #0#15;
             nCam7  = #0#16;
             nCam8  = #0#17;
             nCam9  = #0#18;
             nCam10 = #0#19;
         |FINSI;
         |CIERRA #0;
    |FINSI;
    |CIERRA #100;
|FPRC;

|PROGRAMA;

||     |HAZ LeeStandar;

    |ENTLINEAL #1#1, -2, 4, 17, 1,ClaveBaja1, ClaveAlta1;
|FPRO;

||*****************************************************************
||  MANTENIMIENTO GENERAL
||*****************************************************************

|PROCESO altacli; |TIPO 0;

   |SI HayAcceso = 0; |Y Haybasica = 0; |ACABA; |FINSI;

   |ABRE #clientes@;
   |LIBERA #clientes@;
   #clientes@#0 = #canempr2#2;
   |LEE 101#clientes@.=;
   |SI FSalida = 0;                || Recoge variables del basica
       |SI HayAcceso = 1;
           #clientes@#65 = "S";
       |SINO;
           #clientes@#23 = "S";
       |FINSI;
       |GRABA 020#clientes@.a;             || Graba el basica
       |HAZ pinta_cli;
   |FINSI;
   |LIBERA #clientes@;
   |CIERRA #clientes@;
|FPRC;

|PROCESO pinta_cli;
   |SI HayAcceso = 1;
      #canempr2#1  = #clientes@#2;   |PINTA #canempr2#1;       || nombre
      #canempr2#4  = #clientes@#1;   |PINTA #canempr2#4;       || razon social
      alfa1 = #clientes@#30;   |QBF alfa1;   alfa2 = #clientes@#31;
      alfa1 = alfa1 + ", " + alfa2;
      #canempr2#5  = alfa1;  |PINTA #canempr2#5;        || direccion (numero incluido)
      |HAZ postal;
      #canempr2#6  = elCodPostal; |PINTA #canempr2#6;        || codigo postal
      #canempr2#7  = #clientes@#37; |PINTA #canempr2#7;        || poblacion
      #canempr2#8  = #clientes@#3;  |PINTA #canempr2#8;        || cif
      #canempr2#9  = #clientes@#54; |PINTA #canempr2#9;        || telefono
      #canempr2#10 = #clientes@#55; |PINTA #canempr2#10;       || fax
   |SINO;
      #canempr2#1  = #clientes@#2;   |PINTA #canempr2#1;       || nombre
      #canempr2#4  = #clientes@#1;   |PINTA #canempr2#4;       || razon social
      alfa1 = #clientes@#4;   |QBF alfa1;   alfa2 = #clientes@#5;
      alfa1 = alfa1 + ", " + alfa2;
      #canempr2#5  = alfa1;  |PINTA #canempr2#5;        || direccion (numero incluido)
      |HAZ postal;
      #canempr2#6  = elCodPostal; |PINTA #canempr2#6;        || codigo postal
      #canempr2#7  = #clientes@#11; |PINTA #canempr2#7;        || poblacion
      #canempr2#8  = #clientes@#13; |PINTA #canempr2#8;        || cif
      #canempr2#9  = #clientes@#14; |PINTA #canempr2#9;        || telefono
      #canempr2#10 = #clientes@#15; |PINTA #canempr2#10;       || fax
   |FINSI;
|FPRC;

|CALCULO defDep; |TIPO 0;
 aAlfa1 = #canempr2#24;
 |C_M #canempr2#30,1,aAlfa1;
|FCAL;

|CALCULO AntesDep; |TIPO 7;
   |C_M #canempr2#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "S"
      |SI Haybasica = 1;
          |MENSA "    Actividad por defecto. <F2> Consultar Actividades";
      |SINO;
          |MENSA "    Departamento por defecto. <F2> Consultar Departamentos";
      |FINSI;
   |FINSI;
|FCAL;

|CALCULO MiraActiv; |TIPO 0;
   |C_M #canempr2#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   aCampo30  = #canempre#30;
   enEmpresa = #canempr2#2;
   enPeriodo = #canempr2#3;

   eOpDep = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpDep = 1;  |FINSI;
   enActividad = #canempr2#Campo#;
   eaCodDep    = #canempr2#Campo#;
   |HAZ Actividad;
   |SI eswLect = 1;
       |CONFI "    NError.! No Existe Actividad / Departamento. Continuar S/N ?";
       |SI FSalida ! 0;
           |ERROR;
           |ACABA;
       |FINSI;
       #canempr2#32 = "";
   |SINO;
       aAlfa1 = enActividad;
       |SI Haybasica = 1;
           aAlfa1 = ("00" + aAlfa1) % A02;
       |FINSI;
       #canempr2#30 = eaCodDep; |PINTA #canempr2#30;
       #canempr2#32 = eaNombreAct;
       |SI efActFin > "01.01.1900";
           aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
           |CONFI aAlfa1;
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
       |SI eaEsCom = "S";
           |CONFI "    NAtencion!!!. Actividad Comunera,  Desea Continuar ? ";
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;
   |SI aCampo30 ! #canempre#30; |HAZ Tipo13c2; |FINSI;
|FCAL;

|CALCULO defSub; |TIPO 0;
 aAlfa1 = "S";
 |SI #canempr2#22 = "N"; aAlfa1 = "N"; |FINSI;

 |C_M #canempr2#31,1,aAlfa1;

 eaSubde = #canempr2#22;
 enSubde = 0; |SI eaSubde = "O"; eaSubde = "S"; enSubde = 1; |FINSI;
|FCAL;

|CALCULO AntesSub; |TIPO 7;
   |C_M #canempr2#Campo#, 0, aAlfa1;
   |SI aAlfa1  = "S";
      |SI Haybasica = 1;
          |MENSA "    Subdepartamento por defecto. <F2> Consultar Subdepartamentos";
      |FINSI;
   |FINSI;
|FCAL;

|CALCULO TrasSub; |TIPO 0;
   |SI #canempr2#22 = "N"; |ACABA; |FINSI;

   aCampo31 = Contenido;
   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpSub = 1;  |FINSI;
   enConcepto  = 1;
   eaCodSubdep = #canempr2#Campo#;
   enQue = 1;
   |HAZ SubActividad;
   enQue = 0;
   |SI eswLect = 1;
       |CONFI "    NError.! No Existe SubDepartamento. Continuar S/N ?";
       |SI FSalida ! 0;
           |ERROR;
       |FINSI;
       #canempr2#33 = "";
   |SINO;
       #canempr2#31 = eaCodSubdep; |PINTA #canempr2#31;
       #canempr2#33 = eaNomSubdep;
   |FINSI;

   |SI aCampo31 ! #canempre#31; |HAZ Tipo13c2; |FINSI;
|FCAL;

|PROCESO cambiodep;
    |SI aDepAnt ! #1#30; |O aSubAnt ! #1#31;
        enCambio = 0; |SI aDepAnt ! #1#30; enCambio = 1; |FINSI;
        enEmpresa = #1#2;
        enPeriodo = #1#3;
        eaDfDepC  = #1#30;
        eaDfSubC  = #1#31;
        eaDfDepN  = #1#32;
        eaDfSubN  = #1#33;
        eaDepar   = #1#24;
        eaSubde   = #1#22;
        |SUB_EJECUTA_NP "caut0003;1";
   |FINSI;
|FPRC;
