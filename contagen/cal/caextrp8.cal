|FICHEROS;
   caextrp8 #4;         || display extractos
   cacuenta #5;         || cuentas
   caextrp9 #6;         || display asientos completo
   camaasil #7;         || apuntes lins.
   caextras #8;         || fichero anot.extracontables
   caextral #9;         || anot.extracontables Lineas
   caexttip #10;        || Tipo anot.extracontables
   camaasic #11;
   calicont #31;

   imagen@  #999;
|FIN;

|VARIABLES;
   &enBEjer = 0;
   aFichero = "";
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   fech1 = @;
   fech2 = @;
   fech3 = @;
   fech4 = @;
   FEstado = 0;
   inkey = 0;
   seleccio = 0;

   &d_abajo = 0;
   &h_abajo = 0;
   &s_abajo = 0;
   lalinea = 0;
   totallin = 0;
   nDebe    = 0;
   nHaber   = 0;
   nApunte  = 0;
   informe  = "caextrp8";

   &enDiario          = 0;
   &efFecha           = @;
   &enDocumento       = 0;
   &enDiarioDentro    = 0;
   &efFechaDentro     = @;
   &enDocumentoDentro = 0;

   &aFitxer = "";
   aMas = "";
   &enDi = 0;
   &efFe = @;
   &enDo = 0;
   &enAp = 0;
   &eaDes = "";
   &eaD = "";
   &eaS = "";
   &enDeb = 0;
   &enHar = 0;
   &enSal = 0;
   &enTS  = 0;
   &enTD  = 0;
   &enTH  = 0;
   &eaCta = "";
   &eaRef = "";

   nPrim  = 0;
   &eaFEmp   = "";

   &enDnDIARIO   = 0;
   &enHnDIARIO   = 0;
   &efDFechas    = @;
   &efHFechas    = @;
   &enDDocume    = 0;
   &enHDocume    = 0;
   &enBorraAu    = 0;

   &swVarios     = 0;
   &eaMonOrg     = "";
   aBlancs       = "";
   &enDesAna     = 0;

   nSwAper = 0;
   aCta08  = "";
   aCta90  = "";
   aCtaSe  = "";
   aAlfa   = "";
   &enNumero  = 0;
   &eaEldef   = "";

   nSwF4 = 0;
   nSwF5 = 0;
   &eaEspTabla = "";
   &enInkey    = 0;
   &nQuantHay  = 0;
   &enEste     = 0;
   nSwPus      = 0;

   &efCamp8   = @;
   &enCamp18  = 0;
   &enCamp9   = 0;
   &enCamp19  = 0;
   &enCamp23  = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscopi_i;

|PROCESO pinta213; |TIPO 13;
   |C_V #4#23,0,alfa4;
   |SI alfa4 = "S";
       |ATRI I; |PINTA 0660, "Emp:"; |ATRI 0;
       |ATRI I; |PINTA 0671, "Ej:"; |ATRI 0;
       aAlfa = #4#8;
       aAlfa = aAlfa % -104;
       |ATRI S; |PINTA 0675, aAlfa; |ATRI 0;
   |FINSI;
   |HAZ totales_6;
   |HAZ MasDatos_6;
|FPRC;

|PROCESO Tipo7Cp8; |TIPO 7;
   nSwF4 = 0; nSwF5 = 0;
   aAlfa = "    F2-Consulta;F3-Informe;F4-Modificar;F5-Baja;F6-Anotaciones;F7-Buscar Apte.";
   |SI enModoPINET2 = 1;
       aAlfa = aAlfa - "F4-Modificar;";
       nSwF4 = 1;
   |FINSI;
   |SI enModoPINET3 = 1;
       aAlfa = aAlfa - "F5-Baja;";
       nSwF5 = 1;
   |FINSI;
   |MENSA aAlfa;
|FPRC;

|PROCESO pintando2; |TIPO 11;
   inkey = FSalida;
   |BLIN 4;
   nSwPus = 0;
   |SI inkey ] 10; |Y inkey [ 15;
       nSwPus = 1;
       |PUSHV 2401 2479;
       |BLIN 24;
   |FINSI;
   |SI swVarios = 1; |HAZ Situafich0_6; |FINSI;
   |SI inkey = 10;  |HAZ asiento_6;      |FINSI;
   |SI inkey = 11;  |HAZ ElInforme_6;    |FINSI;
   |SI inkey = 12; |Y nSwF4 = 0;  |HAZ VeteAsiento2_6; |FINSI;
   |SI inkey = 13; |Y nSwF5 = 0;  |HAZ VeteAsiento4_6; |FINSI;
   |SI inkey = 14;  |HAZ extraco_6;      |FINSI;
   |SI inkey = 15;  |HAZ LaBusqueda8;    |FINSI;
   |SI inkey = 181;  |Y eaEspTabla = "S";
       |SI enEste > 1;
           enInkey = inkey;
           |PTEC 806;
       |FINSI;
       |SI enEste = 1;
           |MENAV "0000Primera Cuenta Seleccionada";
       |FINSI;
   |FINSI;
   |SI inkey = 179;  |Y eaEspTabla = "S";
       |SI enEste = nQuantHay;
           |MENAV "0000Ultima Cuenta Seleccionada";
       |FINSI;
       |SI enEste < nQuantHay;
           enInkey = inkey;
           |PTEC 806;
       |FINSI;
   |FINSI;
   |SI nSwPus = 1;
       nSwPus = 0;
       |POPV;
   |FINSI;
|FPRC;
_____________________________________________________________________________
|PROCESO totales_6;                  || PINTA LOS TOTALES DEL EXTRACTO

   #4#14 = d_abajo;
   #4#15 = h_abajo;
   #4#16 = s_abajo;
   |PINTA #4#14;
   |PINTA #4#15;
   |PINTA #4#16;

|FPRC;
_____________________________________________________________________________
|PROCESO lee_asiento1_6;             || CARGA LA PANTALLA DEL ASIENTO COMPLETO
   seleccio = 1;
   |HAZ cuenta_6;
   |SI eaMonOrg ! eaMoneda;
        |HAZ LoCambio;
   |FINSI;
   |DDEFECTO #6;
   #6#00 = #7#3;        || apunte
   #6#01 = #7#4;        || cuenta
   #6#02 = #7#5;        || digito DEBE
   #6#03 = #7#6;        || concepto
   #6#04 = #7#7;        || descripcion
   #6#05 = #7#8;        || Signo
   #6#06 = #7#9;        || importe
   #6#07 = #7#29;       || Cuenta Analitica
   #6#08 = #7#26;       || Referencia
   #6#09 = #5#2;        || Descripcion Cuenta

   #6#10 = #5#51;       || debe
   #6#11 = #5#52;       || haber
   #6#12 = #5#53;       || saldo

   #6#13 = #7#0;        || diario
   #6#14 = #7#1;        || fecha
   #6#15 = #7#2;        || documento
   |SI #6#0 = #4#19;
       lalinea = #6#0;
   |FINSI;
   #6#16 = #11#7;
   |GRABA 020#6n;
   totallin = totallin + 1;
|FPRC;

|DEFBUCLE lee_asiento_6;
   #7#1;
   ;
   #4#18, #4#8, #4#9,    1;
   #4#18, #4#8, #4#9, 9999;
   e;
   NULL, lee_asiento1_6;
|FIN;

|PROCESO asiento_6;

   aFichero = ("p" + Usuario);
   aFichero = (aFichero + "zzzzzzzz") % 108;
   |NOME_DAT #6 aFichero;
   |DELINDEX #6;

   seleccio = 0;

   |ABRE #11;
   |DDEFECTO #11;
   #11#0 = #4#18;
   #11#1 = #4#8;
   #11#2 = #4#9;
   |LEE 001#11=;
   |CIERRA #11;

   |ABRE #6;
   lalinea = 1;
   totallin = 0;
   |BUCLE lee_asiento_6;
   |CIERRA #6;

   |SI seleccio ! 0;
      |PUSHV 07012380;
      |PINPA #0#6;
      alfa1 = "N";
      |SI #11#7 ! 0;
          alfa1 = "S";
          |ATRI R; |PINTA 0861, "Asto Predef.: "; |ATRI 0;
      |FINSI;
      |C_V #6#16, 1, alfa1;

      |ENTLINEAL #1#6, -1, 4, 20, 0, mini_6, maxi_6;
      |POPV;
   |SINO;
      |MENAV "    Seleccion vacia ...";
   |FINSI;
   |DELINDEX #6;

|FPRC;

|PROCESO mini_6;
   |SI FSalida = "POSICION";  |Y totallin > 8;
      #6#0 = lalinea;
   |SINO;
      #6#0 = 1;
   |FINSI;
|FPRC;

|PROCESO maxi_6;
   #6#0 = 9999;
|FPRC;

|PROCESO cuenta_6;
   |ABRE #5;
   |SELECT #1#5;
   #5#0 = #7#4;         || cuenta
   |LEE 001#5=;
   |SI FSalida ! 0;
      |DDEFECTO #5;
      #5#2 = "<CUENTA INEXISTENTE>";
   |FINSI;
   |CIERRA #5;
|FPRC;
_____________________________________________________________________________

|PROCESO extraco_6;             || CARGA LA PANTALLA DE LA ANOT.EXTRACONTABLE
/*
   |ABRE #8;
   #caextras#0 = #4#18;        || diario
   #caextras#1 = #4#8;         || fecha
   #caextras#2 = #4#9;         || documento
   |LEE 001#8=;
   |SI FSalida = 0;
      |PUSHV 08092067;
      |PINPA #1#4;
      |ATRI I; |PINTA 0927, #caextras#0;
      |PINTA 0937, #caextras#1;
      |PINTA 0959, #caextras#2;
      |PINTA 1128, #caextras#3;
      |ATRI 0;
      |HAZ mod_campos_6;
      |ENTLINEAL #1#9, -4, 4, 18, 0, minC, maxC;
      |POPV;
   |SINO;
      |MENAV "    Asiento sin Anotaciones Extracontables ...";
   |FINSI;
   |CIERRA #8;
*/

    enDiarioEx = #4#18;
    efFechaEx  = #4#8;
    enDocumEx  = #4#9;
    eaLaCtaEx  = #4#1;
    eaCtaDeEx  = #4#2;
    enConNuEx  = #4#29;
    eaConDeEx  = #4#10;
    enEmpresa  = #4#23;
    enPerEx    = #4#24;
    aAlfa = #4#25; |QBF aAlfa;
    |SI aAlfa ! "";
        dirfich0 = aAlfa;
    |SINO;
        |DFICE dirfich0;
    |FINSI;
    enTipoEx = 0;
    |SUB_EJECUTA_NP "caextmz1;extracto";
|FPRC;

/*
|RUTINA minC;
   #caextral#0 = #caextras#0;
   #caextral#1 = #caextras#1;
   #caextral#2 = #caextras#2;
   #caextral#3 = 1;
|FRUT;

|RUTINA maxC;
   #caextral#0 = #caextras#0;
   #caextral#1 = #caextras#1;
   #caextral#2 = #caextras#2;
   #caextral#3 = 9999;
|FRUT;

|PROCESO mod_campos_6;
   |C_M #caextral#4,1,"N";
   |C_P #caextral#3, 1, 1311;
   |C_P #caextral#4, 1, 1316;
   |ABRE #10;
   #caexttip#0 = #caextras#3;
   |LEE 001#10=;
   |SI FSalida = 0;
      |PINTA 1131, #caexttip#1;
   |FINSI;
   |CIERRA #10;
|FPRC;
*/
|| ________________________________________________________________________
|PROCESO LaBusqueda8;

       |ERROR;
       eaEldef = "caextrp8";
       |SUB_EJECUTA_NP "caw00044";

       |SI enNumero ! 0;
           #4#0  = enNumero;
           #4#8  = efCamp8;
           #4#18 = enCamp18;
           #4#9  = enCamp9;
           #4#19 = enCamp19;
           #4#23 = enCamp23;
           |PTEC 802;
           |PONCONTROL 23, "SI";
       |FINSI;

|FPRC;
_____________________________________________________________________________
|PROCESO LaContra8;
    #4#46 = "";
    #4#47 = "";

    |ABRE #31;
    #31#0 = #4#18;
    #31#1 = #4#8;
    #31#2 = #4#9;
    #31#3 = #4#19;
    |LEE 001#31=;
    |SI FSalida = 0;
        #4#46 = #31#4;
    |SINO;
        |ABRE #11;
        #11#0 = #4#18;
        #11#1 = #4#8;
        #11#2 = #4#9;
        |LEE 001#11=;
        |SI FSalida = 0;
            |SI #4#11 = "D"; #4#46 = #11#10; |FINSI;
            |SI #4#11 = "H"; #4#46 = #11#8;  |FINSI;
        |FINSI;
        |CIERRA #11;
   |FINSI;
   |CIERRA #31;
   |ABRE #5;
   #5#0 = #4#46;
   |LEE 001#5=;
   |SI FSalida = 0;
       #4#47 = #5#2;
   |FINSI;
   |CIERRA #5;
|FPRC;

|PROCESO CalculaTotales2_6;

    |SI swVarios = 1;
        dirfich0 = #4#25; |QBF dirfich0;
        eaMoneda = #4#26;
        |PATH_DAT #5  dirfich0;
        |PATH_DAT #7  dirfich0;
        |PATH_DAT #11 dirfich0;
        |PATH_DAT #31 dirfich0;
    |FINSI;

    |ABRE #7;
    #7#0 = #4#18;        || diario
    #7#1 = #4#8;         || fecha
    #7#2 = #4#9;         || documento
    #7#3 = #4#19;        || linea apunte

    |LEE 040#7=;
    |SI FSalida ! 0;
        |BORRA 020#4a;
    |SINO;
        nSwAper = #4#50;   || tipo asiento
        aCta08  = #4#48;
        aCta90  = #4#49;
        aCtaSe  = aCta08;
        |SI #7#1 < "01.01.2008"; aCtaSe = aCta90; |FINSI;
        |SI aCtaSe ! #7#4;
            |BORRA 020#4a;
        |SINO;
            |SI eaMonOrg ! eaMoneda;  |HAZ LoCambio; |FINSI;
            |SI nSwAper = 0;
                #4#11 = #7#8;
            |SINO;
                |SI nSwAper = 1; |O nSwAper = 3;
                    #4#11 = #7#8;
                |SINO;
                    |SI #7#8 = "D"; #4#11 = "H"; |FINSI;
                    |SI #7#8 = "H"; #4#11 = "D"; |FINSI;
                |FINSI;
            |FINSI;
           #4#12 = #7#9;

           |SI #4#11 = "D";
               #4#05 = #4#05 + #7#9; || total debe arriba
               #4#14 = #4#14 + #7#9; || total debe abajo
               #4#13 = #4#13 + #7#9; || total saldo detalle
               nDebe = nDebe + #7#9;           || ACUMULADO DEBE FINAL
           |SINO;
               #4#06 = #4#06 + #7#9; || total haber arriba
               #4#15 = #4#15 + #7#9; || total haber abajo
               #4#13 = #4#13 - #7#9; || total saldo detalle
               nHaber = nHaber + #7#9;      || ACUMULADO HABER FINAL
          |FINSI;
          #4#07 = #4#05 - #4#06;              || saldo arriba
          #4#5  = nDebe;
          #4#6  = nHaber;
          #4#13 = #4#5 - #4#6;
          #4#7  = #4#5 - #4#6;

           alfa1 = #7#1;
           #4#17 = (alfa1 % 0102) + (alfa1 % 0402);

           |SI nSwAper [ 1;
               #4#10 = #7#7;
               #4#29 = #7#6;
           |FINSI;
           #4#20 = #7#26;
           #4#21 = #7#21;
           #4#22 = #7#18;
           #4#30 = #7#12;
           #4#31 = #7#13;
           #4#32 = #7#14;
           #4#33 = #7#15;
           #4#34 = #7#19;
           #4#35 = #7#20;
           #4#36 = #7#22;
           #4#37 = #7#23;
           #4#38 = #7#24;
           #4#39 = #7#25;
           #4#40 = #7#28;
           #4#41 = #7#27;
           #4#42 = #7#29;
           #4#43 = #7#1;
           |HAZ LaContra8;

           |GRABA 020#4a;
       |FINSI;
    |FINSI;
    |LIBERA #4;
    |CIERRA #7;
|FPRC;

|DEFBUCLE caextrp2_6;
     #4#1;
     ;
     000000;
     999999;
     e;
     NULL, CalculaTotales2_6;
|FIN;

|PROCESO VeteAsiento2_6;

   |SI #4#8 [ #4#44;
       |MENAV "    ERROR FECHA INFERIOR O IGUAL AL BLOQUEO DE DATOS";
       |ACABA;
   |FINSI;

   enDiario    = #4#18;        || diario
   efFecha     = #4#8;         || fecha
   enDocumento = #4#9;         || documento

   |SI enDiarioDentro = enDiario;  |Y efFechaDentro = efFecha;
    |Y enDocumentoDentro = enDocumento;
       |MENAV "      Registro Bloqueado, usted a llamado al extracto desde este asiento.";
       |ERROR;
       |ACABA;
   |FINSI;

   |LEE 001#4=;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   #4#12 = 0;
   #4#17 = 0;

   |SI enDesAna = 1;
       |SUB_EJECUTA_NP "anz00010;NOMEQUITESQUETECORTOLOSGUEVOS";
   |SINO;
       |SUB_EJECUTA_NP "camaasic;NOMEQUITESQUETECORTOLOSGUEVOS";
   |FINSI;
   |ABRE #7;
   #7#0 = #4#18;        || diario
   #7#1 = #4#8;         || fecha
   #7#2 = #4#9;         || documento
   #7#3 = #4#19;        || linea apunte
   |LEE 040#7=;
   |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
   |CIERRA #7;

   |SI eaMonOrg ! eaMoneda;
       |HAZ LoCambio;
   |FINSI;

   #4#11 = #7#8;             || signo (no en pantalla!!!)
   #4#12 = #7#9;                || importe debe

   |GRABA 020#4a;
   |LIBERA #4;

   nApunte = #4#0;
   nDebe   = 0;
   nHaber  = 0;

   |BUCLE caextrp2_6;

   d_abajo = nDebe;
   h_abajo = nHaber;
   s_abajo = d_abajo - h_abajo;

   #4#0 = nApunte;
   |LEE 040#4=;

   |PONCONTROL 23, "SI";
   |PTEC 809;
|FPRC;


|PROCESO VeteAsiento4_6;  ||baja Asiento, primero lo vemos.

   |SI #4#8 [ #4#44;
       |MENAV "    ERROR FECHA INFERIOR O IGUAL AL BLOQUEO DE DATOS";
       |ACABA;
   |FINSI;

   enDiario    = #4#18;        || diario
   efFecha     = #4#8;         || fecha
   enDocumento = #4#9;         || documento

   |SI enDiarioDentro = enDiario;  |Y efFechaDentro = efFecha;
    |Y enDocumentoDentro = enDocumento;
       |MENAV "      Registro Bloqueado, usted a llamado al extracto desde este asiento.";
       |ERROR;
       |ACABA;
   |FINSI;

   |LEE 001#4=;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   aFichero = ("p" + Usuario);
   aFichero = (aFichero + "zzzzzzzz") % 108;
   |NOME_DAT #6 aFichero;
   |DELINDEX #6;

   seleccio = 0;

   |ABRE #6;
   lalinea = 1;
   totallin = 0;
   |BUCLE lee_asiento_6;
   |CIERRA #6;

   |SI seleccio ! 0;
      |PUSHV 07012380;

      |PINPA #0#6;
      |PINTA #6#13; |PINTA #6#14; |PINTA #6#15;
      |ATRI P; |PINTA 0861, "BAJA ASIENTO"; |ATRI 0;

      |ENTLINEAL #1#6, -1, 7, 20, 0, mini_6, maxi_6;
      |CONFI "    NBorrar Asiento S/N";
      |SI FSalida = 0;
          |HAZ BorroAsiento_6;
      |FINSI;
      |POPV;
   |FINSI;

   |DELINDEX #6;

|FPRC;

|PROCESO BorroAsiento_6;
   enDnDIARIO = enDiario;            || diario
   enHnDIARIO = enDiario;
   efDFechas  = efFecha;             || fecha
   efHFechas  = efFecha;             || fecha
   enDDocume  = enDocumento;         || documento
   enHDocume  = enDocumento;         || documento
   enBorraAu  = 2;

   |SUB_EJECUTA_NP "caborasi;NOMEQUITESQUETECORTOLOSGUEVOS";

   eaMoneda = eaMonOrg;
   |HAZ Monedas;
   nApunte = #4#0;
   nDebe   = 0;
   nHaber  = 0;

   |BUCLE caextrp2_6;

   d_abajo = nDebe;
   h_abajo = nHaber;
   s_abajo = d_abajo - h_abajo;

   #4#0 = nApunte;
   |LEE 040#4=;

   |PONCONTROL 23, "SI";
   |PTEC 809;
|FPRC;

|| ----------------------------------------------------------------------
|PROCESO LeeAuxiliar_6;
 enDi  = #999#18;
 efFe  = #999#8;
 enDo  = #999#9;
 enAp  = #999#19;
 eaDes = #999#10;
 eaRef = #999#20;
 |SI #999#11 = "D";
     enDeb = #999#12;
     enHar = 0;
 |SINO;
     enDeb = 0;
     enHar = #999#12;
 |FINSI;
 enSal = #999#13;
 |SI nPrim = 0;
     nPrim = 1;
     enTD = #999#5 - enDeb;
     enTH = #999#6 - enHar;
 |FINSI;

 |PRINT;
 enTD = enTD + enDeb;
 enTH = enTH + enHar;
 enTS = enTD - enTH;
|FPRC;

|DEFBUCLE LeeAuxiliar_6;
 #999#2006;
 ;
 "01.01.0000", 00, 000000, 0000, 00001, 000001;
 "31.12.2999", 99, 999999, 9999, 99999, 999999;
 ;
 NULL, LeeAuxiliar_6;
|FIN;

|PROCESO ElInforme_6;
 |PATH_DAT #5 eaFEmp;
 |ABRE #5;
 |DDEFECTO #5;
 #5#0 = #4#1;
 |LEE 001#5=;
 |CIERRA #5;

 |DBASE alfa1;
 aMas  = alfa1 + "def/caextrp8.mas";

 |CARGA_DEF aMas, imagen@;
 |SI FSalida = 0;

     |IMPRE 0;
     |SI FSalida ! 0;
         |PATH_DAT #5 dirfich0;
         |DESCARGA_DEF #imagen@;
         |ACABA;
     |FINSI;

     |INFOR informe;
     |SI FSalida ! 0;
         |PATH_DAT #5 dirfich0;
         |DESCARGA_DEF #imagen@;
         |FINIMP;
         |ACABA;
     |FINSI;

     |NOME_DAT #999 aFitxer;
     enTD = 0;
     enTH = 0;
     enTS = 0;
     nPrim = 0;
     enEjercicio =enBEjer;
     |BUCLE LeeAuxiliar_6;
     |PIEINF;

     |FININF;
     |FINIMP;
     |DESCARGA_DEF #imagen@;
 |FINSI;
 |PATH_DAT #5 dirfich0;
|FPRC;

|PROCESO Situafich0_6;
   enEmpresa = #4#23;
   enPeriodo = #4#24;
   dirfich0  = #4#25; |QBF dirfich0;
   eaMoneda  = #4#26;
   |PATH_DAT #5 dirfich0;
   |PATH_DAT #7 dirfich0;
   |PATH_DAT #8 dirfich0;
   |PATH_DAT #9 dirfich0;
   |PATH_DAT #10 dirfich0;
   |PATH_DAT #11 dirfich0;
   |PATH_DAT #31 dirfich0;

   enEmpresaPINET = enEmpresa;
   |HAZ RestriccionPINET;
|FPRC;

|PROCESO MasDatos_6;
  aBlancs = " " * 78;
  |PINTA 2202, aBlancs; |PINTA 2302, aBlancs;

  |SI #4#27 = "S";
       eOpDep = 0;
       enActividad = #4#21;
       eaCodDep    = #4#21;
       |HAZ Actividad;
       |HAZ pDepartamento;
   |FINSI;
   |SI #4#28 = "S";
       eOpSub = 0;
       enActividad = #4#21;
       eaCodDep    = #4#21;
       enConcepto  = #4#29;
       eaCodSubdep = #4#40;
       |HAZ SubActividad;
       |HAZ pSubdepar;
   |FINSI;
|FPRC;
