|FICHEROS;
   anz00011 #00;   || apuntes lins.
   anz00010 #01;   || apuntes cabs.
   cafantas #02;   || 'pintas' de acumulados diario

   camandia #10;   || diarios
   casieaca #11;   || predefinidos cabs.
   casieali #12;   || predefinidos lins.
   casieaax #13;   || consulta predefinido formato asiento

   caextras #23;   || anotaciones extracontables
   caextral #25;   || anotaciones extracontables Lineas
   camemori #24;   || ultimas tres operaciones
   caconasi #20;
   caivaasi #210;
   camaniva #500;
   caivalin #501;
   calicont;

   &Puente@ #398;
   calincob #1000;
   calinpag #1001;
   dscam000@ #100;
   dscam067@ #101;

   caivam01 #123;

   caivatm1 #900;  || cabecera iva
   caivalit #901;  || linea iva

   cacontar@ #5000;
   camaref@ #6000;
|FIN;

|VARIABLES;
   &enERP = 0;
   &enDesdeGrid = 0;
   {1}nPuntero   = 0;
     || NO PONER NINGUNA VARIABLE ENTRE ESTAS DOS ..... SE USAN COMO PUNTEROS
      aNume      = "";


   &enPulPre = 0;
   &enSwBaja = 0;
   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   nCont = 0;
   aBlancs = "";
   sumaasi = 0;
   nConte = 0;
   swcontador = 0;
   xx = 0;
   anter = 0;
   men1  = "     NO EXISTE EMPRESA !";
   men2  = "     Longitud de Cuenta Fuera de Nivel !";
   fecalf = "";
   mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
   mensa2 = "    ERROR FECHA INFERIOR O IGUAL AL BLOQUEO DE DATOS";
   &modcon = 0;
   traba1 = "";
   mas = 0;
   &entrada = 1;
   &inkey = 0;
   &coant = 0;
   &deant = "";
   &dhant = "";
   &imant = 0;
   &dpant = "";
   &refant = "";
   &sdant = "";
   &nsant = "";
   &ext1 = "";
   &ext2 = "";
   &ext3 = "";
   &ext4 = "";
   &ext5 = "";
   &ext10 = "";
   &ext11 = "";
   &ext13 = 0;
   &ext21 = "";
   &ext38 = 1;
   &ext42 = "";
   &ext43 = "";
   &ext44 = "";
   &eaCobPag = "";
   &predefine = 0;
   &predefine2 = 0;
   &sw_debe = 0;
   &sw_habe = 0;
   &j_d = 0;
   &j_h = 0;
   &i_serie = "";
   &i_factu = 0;
   &i_perio = 0;
   &i_perli = 0;
   &i_fecha = @;
   &i_activ = "";
   &aferlamar = 0;
   relacion = 0;
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   &p_tabla = 0;
   &sw_tabla = 0;
   &sw_ptec = 0;
   posic = 0;
   lin_con = 0;
   m_c = 0;
   &sw_ivamerr = 0;
   &avisos = "";
   &f1auto = 0;
   &clau = "";
   &ant_dia = 1;
   &ant_fec = @;
   &ant_doc = 0;
   &ctab1 = "";
   &ctab2 = 0;
   ult_pre = 0;
   l_alfa1 = "";
   ant_ref = "";

   Comodin = "";
   Comodin1 = "";
   Libro = 0;
   Serie = "";
   Factura = 0;
   nDiario = 0;
   nNumDocum = 0;

   SinTocar = 0;
   Cont = 0;
   FechaUlt = @;

   Empresa11 = 0;
   anyo11 = 0;
   acti11 = 0;

   &eaPath = "";
   &eaRetorno = "";
   &r_entra = "";
   &r_alfa1 = "";
   &swVPuente = 0;
   &enPred = 0;
   nSwUlt = 0;
   &ivacomun = "";
   &NumDocum = 0;
   &snFiltrA= "";
   &snFiltr = "";
   &snFilAc = "";
   &snFilBa = "";


   &enDiario      = 0;
   &efFecha       = @;
   &enDocumento   = 0;
   &swVarios      = 0;
   &snDescua      = "";

   nError = 0;
   nDocum = 0;
   fFecha = @;
   aFichero = "";
   aQueQuiero = "";
   aNumCampos = "";
   nNumCampos = 0;
   nPara1     = 0;
   &nModPred  = 0;
     nYaPinta = 0;
     nSwSalir = 0;

   &enSi340   = 0;
   &enSi303   = 0;
   &enSi111   = 0;
   &eSwReten  = 0;

   aMas = "";
   aDef = "";
     &enSwSalir = 0;
     &eModoCaja = 0;
     &nMenCaja  = 0;
     &aMenCaja  = "";
     &enConIRPF = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoan_i;

|PROCESO Atipo8; |TIPO 8;
  |HAZ inicial;
  |SI swerror = 2;
      |PTEC 807;
      |ACABA;
  |FINSI;

  |HAZ Analitica;
  |SI  enSwAna = 0;
       aAlfa1 = "    CONTABILIDAD NO ANALITICA ";
       |SI eaAnNiv = "E";
           aAlfa1 = "    EMPRESA NO ANALITICA ";
       |FINSI;
       |MENAV aAlfa1;
       |PTEC 807;
       |ACABA;
  |FINSI;
  |C_M #1#17, 1, eaRefer;
  |C_V #0#26, 1, eaRefer;
  |SI eaRefer = "S";   |C_A #casieaca#1,1,27; |FINSI;

  |SI eaSubde = "N";
      |C_A #0#7,  1, 80;
      |C_P #0#8,  1, 1258;
      |C_P #0#21, 1, 1254;
      |C_V #0#28, 1, "N";
  |SINO;
      |SI enSubde = 1; |Y eaDepar = "N";
          |C_P #0#7,  1, 1224;
          |C_A #0#7,  1, 80;
          |C_V #0#21, 1, "N";
      |FINSI;
  |FINSI;

  |HAZ DirAplicSt;
  enM349 = 1; |HAZ Consul303; enM349 = 0;

  |ABRE #210;
  |DDEFECTO #210;
  |LEE 101#210p;
  |SI FSalida ! 0;
      |DDEFECTO #210;
  |FINSI;
  |CIERRA #210;
  eaPtec  = #210#114;
  eaPaDOM2= #210#133;
  eaPaDOM3= #210#134;
  eaPaCTA1 = #210#135;  ||permitir alta no estructuras 2008
  eaPaCTA2 = #210#136;  ||Aviso 1990
  eaPaNif1 = #210#152;
  eaPaNif2 = #210#153;
  eaABanco = #210#161;
  eaCP347  = #210#164;
  eaTEmbargo = #210#165;
  enCEmbargo = #210#166;
  eaObClPr   = #210#186;

  snFiltrA= #210#185;
  snFiltr = #210#95;
  snFilAc = #210#118;
  snFilBa = #210#119;

  |ABRE #123;
  |DDEFECTO #123;
  #123#0 = enEmpresa;
  |LEE 000#123=;
  |CIERRA #123;
  snDescua = #123#5;

  aFichero = "1a" + Usuario; |NOME_DAT #901 aFichero; |DELINDEX #901;
|FPRC;

|| *********************************************************************
|CALCULO Tecla;TIPO 6;
   |SI FSalida = 1; |Y enDesdeGrid = 0;
       |PTEC 807;
       |ERROR;
       |ACABA;
   |FINSI;
|FCAL;

||\\\\\\\\\\\\\\\\\\\\\\\\  Borro facturas de este Asiento
|PROCESO BorraIvaLin;
 |BORRA 020#caivalin.a;
|FPRC;

|DEFBUCLE BorraIvaLin;
 #caivalin#1;
 ;
 #camaniva#0,#camaniva#1,01;
 #camaniva#0,#camaniva#1,99;
 ;
 NULL,BorraIvaLin;
|FIN;

|PROCESO BorraCobCa;
     |DDEFECTO #Puente@;
     #Puente@#0  = #calincob#0;
     #Puente@#1  = #calincob#2;
     #Puente@#2  = #calincob#1;
     #Puente@#3  = #calincob#3;
     #Puente@#5  = #calincob#6;
     #Puente@#22 = nCont;
     #Puente@#23 = #48#2;
     #Puente@#24 = #48#3;
     #Puente@#27 = "V";
     #Puente@#28 = "B";
     #Puente@#35 = " ";
     |GRABA 020#Puente@.n;
     nCont = nCont + 1;
     |BORRA 020#calincob.a;
     |LIBERA #calincob;
|FPRC;

|DEFBUCLE BorraCobCa;
 #calincob#1;
 ;
 #camaniva#0,#camaniva#2,#camaniva#3,001;
 #camaniva#0,#camaniva#2,#camaniva#3,999;
 be;
 NULL,BorraCobCa;
|FIN;

|PROCESO BorraPagCa;
     |DDEFECTO #Puente@;
     #Puente@#0  = #calinpag#0;
     #Puente@#1  = #calinpag#2;
     #Puente@#2  = #calinpag#1;
     #Puente@#3  = #calinpag#3;
     #Puente@#5  = #calinpag#6;
     #Puente@#22 = nCont;
     #Puente@#23 = #48#2;
     #Puente@#24 = #48#3;
     #Puente@#27 = "C";
     #Puente@#28 = "B";
     #Puente@#35 = " ";
     |GRABA 020#Puente@.n;
     nCont = nCont + 1;
     |BORRA 020#calinpag.a;
     |LIBERA #calinpag;
|FPRC;

|DEFBUCLE BorraPagCa;
 #calinpag#1;
 ;
 #camaniva#0,#camaniva#2,#camaniva#3,001;
 #camaniva#0,#camaniva#2,#camaniva#3,999;
 be;
 NULL,BorraPagCa;
|FIN;

|PROCESO BorraIvaCab;
   nCont = 1;
   |HAZ VerPuente;
   |SI swVPuente = 1;
       |SI #camaniva#36 = "R"; |BUCLE BorraCobCa; |FINSI;
       |SI #camaniva#36 = "S"; |BUCLE BorraPagCa; |FINSI;
       |HAZ CierraPuente;
   |FINSI;

   |BUCLE BorraIvaLin;

   |DBASE aMas; |QBF aMas;
   aDef = aMas + "def/camanref.mas";
   |CARGA_DEF aDef, camaref@;
   |SI FSalida = 0;
      |ABRE #camaref@;
      #camaref@#0 = #camaniva#0;
      #camaref@#1 = #camaniva#1;
      |LEE 101#camaref@.=;
      |SI FSalida = 0;
         |BORRA 020#camaref@.a; |LIBERA #camaref@;
      |FINSI;
      |CIERRA #camaref@; |DESCARGA_DEF #camaref@;
   |FINSI;

   |BORRA 020#camaniva.a;
   |LIBERA #camaniva;

   |HAZ DesactualizaDSarchi;
|FPRC;

|DEFBUCLE BorraIvaCab;
 #camaniva#2;
 ;
 #anz00010#0,#anz00010#1,#anz00010#2;
 #anz00010#0,#anz00010#1,#anz00010#2;
 be;
 NULL,BorraIvaCab;
|FIN;
||///////////////////////////////////////////////////////////

|PROCESO BuscoConIRPF;
   |SI #caivalin#18 ! 0;
       enConIRPF= #caivalin#18;
       |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE BuscoConIRPF;
 #caivalin#1;
 ;
 #camaniva#0, #camaniva#1, 01;
 #camaniva#0, #camaniva#1, 99;
 e;
 NULL, BuscoConIRPF;
|FIN;

|PROCESO CargoLinIVA;
   aQueQuiero = "|NC";
   aNumCampos = #caivalin#aQueQuiero#;
   nNumCampos = aNumCampos; nNumCampos = nNumCampos - 1;
   |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
         #901nPara1 = #caivalin#nPara1#;
   |SIGUE;
   |GRABA 040#901n;
|FPRC;

|DEFBUCLE CargoLinIVA;
 #caivalin#1;
 ;
 #camaniva#0, #camaniva#1, 01;
 #camaniva#0, #camaniva#1, 99;
 e;
 NULL, CargoLinIVA;
|FIN;

|PROCESO CargoDefectos;
  |SI #casieaca#2 = "S";  || Cargo la factura anterior
      |ABRE #camaniva;
      |SELECT #2#camaniva;
      #camaniva#7 = #1#0;
      #camaniva#8 = #1#1;
      #camaniva#9 = #1#2;
      |LEE 010#camaniva.=;
      |SI FSalida ! 0;
          |MENAV "    Error No existe Registro de IVA. Borre el asiento";
          |CIERRA #camaniva;
          |ERROR;
          |ACABA;
      |SINO;
          |SI #camaniva#36 ! "N";
              |SI enSi340 = 1; |O enSi303 = 1; |O enSi111 = 1;
                  nMenCaja  = 1;
                  eModoCaja = xx;
                  eSwReten = 0;
                  |SI #camaniva#20 ! 0;
                      eSwReten  = 1;
                      enConIRPF = 0;
                      |BUCLE BuscoConIRPF;
                  |FINSI;
                  |HAZ eElCtrlModIVA;
                  |SI enSwSalir ! 0;
                      |MENAV aMenCaja;
                      |SELECT #1#camaniva;
                      |CIERRA #camaniva;
                      |ERROR;
                      |ACABA;
                  |FINSI;
              |FINSI;
          |FINSI;
          || Comprobamos que los recibos de la factura a modificar no
          ||     tengan movimientos
          eaProg = "camaniva";
          eaVC   = #camaniva#36;
          |HAZ MiraRecibos;
          |SI enErrCarte ! 0;
             aAlfa1 = "0000Recibos con movimientos, NO SE PUEDE MODIFICAR LA FACTURA";
             |MENAV aAlfa1;
             |CIERRA #camaniva;
             |ERROR; |ACABA;
          |FINSI;
      |FINSI;
      aQueQuiero = "|NC";
      aNumCampos = #camaniva#aQueQuiero#;
      nNumCampos = aNumCampos; nNumCampos = nNumCampos - 1;
      |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
            #900nPara1 = #camaniva#nPara1#;
      |SIGUE;
      |CIERRA #camaniva;
      NumDocum =#camaniva#1;
      |ABRE #901;
      |BUCLE CargoLinIVA;
      |CIERRA #901;
      || |BUCLE BorraIvaCab;  Lo borro cuando este ya en el predefinido
      || Otras variables
      ext38    = #900#38;
      ext42    = #900#42;
      ext43    = #900#43;
      ext44    = #900#44;
      eaCobPag = #casieaca#6;
  |FINSI;
  |HAZ carga_con;
  nModPred = 1;
  |ATRI I; |PINTA 0928, #casieaca#1; |ATRI 0;
  predefine  = 1;
  predefine2 = 1;
  |SI #casieaca#2 = "S";
      i_serie = #900#2;
      i_factu = #900#3;
      i_fecha = #900#4;
      i_perio = #900#5;
      i_perli = #900#40;
      i_activ = #900#10;  |QBF i_activ;
      sw_ptec = 0;                      ||/este 'PTEC' sobra
      eaCobPag = #casieaca#6;
  |FINSI;
  #casieali#1 = 0;
|FPRC;
||///////////////////////////////////////////////////////////

|CALCULO modbaj; |TIPO 1;
   xx = (FEntrada / 100) ! 0;
   enModoEnt = xx;
   enSwAgr = 0;
   |SI xx ! 4;
       |SI #anz00010#1 [ fec3;
           |MENAV mensa2;
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   enTipoAsto = #1#13;
|SI #1#13 > 100; |Y xx = 3;
       enSwDejar = 0;
       aAlfa = "    FACTURA DESDE PASE DE GESTION. NO PUEDA DAR DE BAJA EN CONTABILIDAD";
       |SI #1#13 = 103; aAlfa = "    NOMINA DESDE PASE DE LABORAL. NO PUEDE DAR DE BAJA EN CONTABILIDAD"; |FINSI;
       |SI #1#13 = 104; aAlfa = "    NOMINA DE RETRIBUCION ADMINITRADORES. NO PUEDE DAR BAJA EN CONTABILIDAD"; |FINSI;
       |SI #1#13 = 105; aAlfa = "    ASTO DE CAJA. NO PUEDE DAR DE BAJA EN CONTABILIDAD"; |FINSI;
       |SI #1#13 = 106; aAlfa = "    ASTO DE PRESTAMO DE SOCIO. NO PUEDE DAR DE BAJA EN CONTABILIDAD"; |FINSI;
       |SI #1#13 = 190; aAlfa = "    ASTO SEG.SOCIALES DESDE PASE LABORAL. NO PUEDE DAR DE BAJA EN CONTABILIDAD"; |FINSI;

       |SI #1#13 ] 110; |Y #1#13 ! 190;
           |HAZ eDejarModificar;
           |SI enSwDejar = 0;
               |SI #1#13 = 110; aAlfa = "    ASIENTO DESDE PASE DE GESTION. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 150; aAlfa = "    ASIENTO DESDE PASE DE CARTERA. NO MODIFICABLE "; |FINSI;
           |SINO;
               enSwBaja = 1;
               ant_dia = #1#0;
               ant_fec = #1#1;
               ant_ref = #1#17;
               ant_doc = #1#2;
               |HAZ eGrabaModificar;
               enSwBaja = 0;
           |FINSI;
       |FINSI;

       |SI enSwDejar = 0;
           |MENAV aAlfa;
           |ERROR;
           |ACABA;
       |FINSI;

|FINSI;

   |SI xx = 3;              || BAJA ASIENTO
       || Comprobamos si el asiento es de IVA y si lo es, comprobamos si
       ||   tiene recibos en cartera y si se pueden eliminar
       |ABRE #camaniva;
       |SELECT #2#camaniva;
       #camaniva#7 = #1#0;
       #camaniva#8 = #1#1;
       #camaniva#9 = #1#2;
       |LEE 000#camaniva.=;
       |SI FSalida = 0;
            || ... ... Comprobamos primero el Modelo 340, para la baja
          |SI #camaniva#36 ! "N";
              |SI enSi340 = 1; |O enSi303 = 1; |O enSi111 = 1;
                  nMenCaja  = 1;
                  eModoCaja = xx;
                  eSwReten = 0;
                  |SI #camaniva#20 ! 0;
                      eSwReten  = 1;
                      enConIRPF = 0;
                      |BUCLE BuscoConIRPF;
                  |FINSI;
                  |HAZ eElCtrlModIVA;
                  |SI aMenCaja ! "";  |MENAV aMenCaja;  |FINSI;
                  |SI enSwSalir = 1;
                      |SELECT #1#camaniva;
                      |CIERRA #camaniva;
                      |ERROR; |ACABA;
                  |FINSI;
              |FINSI;
          |FINSI;

          eaProg = "camaniva";
          eaVC   = #camaniva#36;
          |HAZ MiraRecibos;
          |SI enErrCarte ! 0;
             aAlfa1 = "0000Recibos con movimientos, NO SE PUEDE DAR DE BAJA FACTURA";
             |MENAV aAlfa1;
             |SELECT #1#camaniva; |CIERRA #camaniva;
             |ERROR; |ACABA;
          |SINO;
             |SI #1#13 ! 0; |Y #1#13 ! 110; |Y #1#13 ! 150; |Y #1#13 ! 190;
                |HAZ extraco;        || borra anotaciones extracontables
                |BUCLE BorraIvaCab;
                |HAZ PongoNumFra;
             |FINSI;
          |FINSI;
       |FINSI;
       |SELECT #1#camaniva; |CIERRA #camaniva;
   |FINSI;

   enTipoAsto = #1#13;
   enSwDejar  = 0;
   ||... Si modificable el predefinido antes
   enPred = #1#7;
   |SI #1#7 ! 0; |Y xx = 2;
       |ABRE #casieaca;
       |DDEFECTO #casieaca;
       #casieaca#0 = #1#7;
       |LEE 001#casieaca.=;
       |CIERRA #casieaca;
       |SI #casieaca#17 = "N";
           |MENAV "    ATENCION!. ASIENTO NO MODIFICABLE ";
           |ERROR;
           |ACABA;
       |FINSI;
       |SI #casieaca#17 = "X";  ||modificacion especial
           |HAZ CargoDefectos;
           |ACABA;
       |FINSI;
   |FINSI;

   enTipoAsto = #1#13;
   enSwDejar  = 0;
||No dejo modificar facturas de pase de Gestion un poco especiales. Ej: Rent a Car

   |SI #1#13 > 100; |Y xx = 2;
       |HAZ eDejarModificar;
       |SI enSwDejar = 0;
           |SI eaTexError = "";
               aAlfa = "    FACTURA DESDE PASE DE GESTION. NO MODIFICABLE ";
               |SI #1#13 = 103; aAlfa = "    ASTO NOMINAS DESDE PASE DE LABORAL. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 104; aAlfa = "    ASTO NOMINAS DE RETRIBUCION ADMINITRADORES. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 105; aAlfa = "    ASTO DE CAJA. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 106; aAlfa = "    ASTO DE PRESTAMOS DE SOCIOS. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 110; aAlfa = "    ASIENTO DESDE PASE DE GESTION. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 150; aAlfa = "    ASIENTO DESDE PASE DE CARTERA. NO MODIFICABLE "; |FINSI;
               |SI #1#13 = 190; aAlfa = "    ASTO SEG.SOCIALES DESDE PASE DE LABORAL. NO MODIFICABLE "; |FINSI;
           |SINO;
               aAlfa = eaTexError;
           |FINSI;
           |MENAV aAlfa;
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;
|| ..........................................

|SI #1#13 ! 0; |Y xx = 2; |Y #1#13 ! 110; |Y #1#13 ! 150; |Y #1#13 ! 190;

       || ...   No puedo fiarme del campo #1#13, por ahora cuida
       nDIARIO    = #1#0;
       aFECHA     = #1#1;
       nDOCUMENTO = #1#2;
       |HAZ SwAgrupada;

       |SI enSwAgr = 1;
           |ABRE #camaniva;
           |SELECT #2#camaniva;
           #camaniva#7 = #1#0;
           #camaniva#8 = #1#1;
           #camaniva#9 = #1#2;
           |LEE 010#camaniva.=;
           |SI FSalida = 0;
               l_alfa1 = "camaniva.tab;"; |QBF l_alfa1;
               l_alfa1 = l_alfa1 + #camaniva#36 + ",";
               Comodin = ("00" + #1#0) % -102;
               l_alfa1 = l_alfa1 + Comodin + "," + #1#1 + ",";
               Comodin = ("000000" + #1#2) % -106;
               l_alfa1 = l_alfa1 + Comodin;
               |SELECT #1#camaniva;
               |CIERRA #camaniva;

               |LIBERA #anz00010;
               |CIERRAT #anz00010;
               |SUB_EJECUTA l_alfa1;
               |ABRET #anz00010;
               |LEE 101#anz00010.=;
               |ENTLINEAL #1#anz00011,-4,7,19,0,inf1,sup1; |HAZ el_di;
               |PINTA #1#4;
               |PINTA #1#5;
               |PINTA #1#6;
               |PTEC 807;

           |SINO;

               |SELECT #1#camaniva;
               |CIERRA #camaniva;
           |FINSI;

       |SINO;

           |SI enSwAgr = 2;
               |SI #camaniva#36 ! "N";
                   |MENAV "    ATENCION !!!. Asiento de Varias Facturas, No se modificaran los Registros relacionados";
               |SINO;
                    |MENAV "    ATENCION !!!. Asiento de Varias Nominas, No se modificaran los Registros relacionados";
               |FINSI;
           |FINSI;
       |FINSI;

|FINSI;

   |SI xx = 2;
       |HAZ carga_con;
   |FINSI;

|FCAL;

|CALCULO f1automa; |TIPO 7;             || desde el campo 'diario'
   enDesdeGrid = 0;
   |SI f1auto [ 1;
      #1#0  = ant_dia; |PINTA #1#0;
      #1#17 = ant_ref;
      |SI f1auto = 1;
          |PTEC 823;
          ||f1auto = 0;
      |FINSI;
   |FINSI;
   |SI nSwUlt = 1;
      #1#0 = ant_dia; |PINTA #1#0;
   |FINSI;
   |SI aferlamar = 1;
      #1#0 = ant_dia; |PINTA #1#0;
      #1#17 = ant_ref;
      |PTEC 824;
      aferlamar = 0;
   |FINSI;
   |SI aferlamar = 2;
      #1#0  = ant_dia; |PINTA #1#0;
      #1#1  = ant_fec; |PINTA #1#1;
      #1#2  = ant_doc; |PINTA #1#2;
      aferlamar = 0;
   |FINSI;
|FCAL;

|CALCULO el_di; |TIPO 13;  || desde campo 'diario' y calculo 'asie_nue'
   |DDEFECTO #10;
   |ABRE #10;
   #camandia#0 = #1#0;
   |LEE 101#10=;                 || lee el diario
   |CIERRA #10;
   #2#12 = #10#2;           || diario debe
   #2#13 = #10#3;           || diario haber
   #2#14 = #2#12 - #2#13;     || diario saldo
   #2#8  = #10#1;           || descripcion
   |ATRI I;
   |PINTA 0641, #2#12;
   |PINTA 0654, #2#13;
   |PINTA 0667, #2#14;
   |PINTA 0850, #2#8;
   |ATRI 0;
   aBlancs = " "* 78;
   |PINTA 2202, aBlancs;
   |PINTA 2302, aBlancs;
   aBlancs = " "* 44;
   |SI eaRefer = "S";   aBlancs = " " * 28; |FINSI;
   |PINTA 0925, aBlancs;

   |SI nYaPinta = 0;
       |SI eaSubde = "N";
           |PINTA 1051, "ÄÄÂÄÄÂÄÄ";
           |PINTA 1151, "  ³  ³  ";
           |PINTA 1251, "  ³  ³  ";
           |PINTA 1351, "  ³  ³  ";
           |PINTA 1451, "  ³  ³  ";
           |PINTA 1551, "  ³  ³  ";
           |PINTA 1651, "  ³  ³  ";
           |PINTA 1751, "  ³  ³  ";
           |PINTA 1851, "  ³  ³  ";
           |PINTA 1951, "  ³  ³  ";
           |ATRI R; |PINTA 1151, "   "; |PINTA 1154, "Dp"; |PINTA 1157, " S "; |ATRI 0;
       |SINO;
           |SI enSubde = 1; |Y eaDepar = "N";
               |PINTA 1051, "ÄÄÄ";
               |PINTA 1151, "   ";
               |PINTA 1251, "   ";
               |PINTA 1351, "   ";
               |PINTA 1451, "   ";
               |PINTA 1551, "   ";
               |PINTA 1651, "   ";
               |PINTA 1751, "   ";
               |PINTA 1851, "   ";
               |PINTA 1951, "   ";
               |ATRI R; |PINTA 1151, "   "; |ATRI 0;
           |FINSI;
        |FINSI;
        nYaPinta = 1;
   |FINSI;
|FCAL;

|PROCESO entrada; |TIPO 0;              || desde el campo 'diario'
   inkey = FSalida;
   ant_dia = #1#0;
   |HAZ asie_nue;
   xx = (FEntrada / 100) ! 0;
   |SI xx = 1; |Y inkey ! 11;              || en <F3> no

      |SI #1#0 = 0;
          |CONFI "    SATENCION. ESTA CREANDO EL ASIENTO EN EL DIARIO DE APERTURA. CONTINUAR ";
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;

      |HAZ EsForest;
      |SI FSalida = 0;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "cacontar.mas";
         |CARGA_DEF aAlfa, cacontar@;
         |SI FSalida = 0;
            |ABRE #cacontar@;
            #cacontar@#0 = #anz00010#0;
            |LEE 101#cacontar@.=;
            |SI FSalida ! 0;
               |ABRE #camandia;
               #camandia#0 = #anz00010#0;
               |LEE 000#camandia.=;
               |SI FSalida ! 0; |DDEFECTO #camandia; |FINSI;
               |CIERRA #camandia;

               |DDEFECTO #cacontar@;
               #cacontar@#0 = #anz00010#0;
               #cacontar@#1 = #camandia#1;
               |GRABA 020#cacontar@.c;
            |FINSI;
         |FINSI;
         nNumDocum = #cacontar@#2 + 1;
         nREGISTRO  = #cacontar@#2;

         |SALVA_DATOS #anz00010;
         |SELECT #7#1;
         |DDEFECTO #anz00010;
         #anz00010#1 = "01.01.0000";
         #anz00010#0 = #cacontar@#0 + 1;
         |LEE 000#anz00010.];
         |SI FSalida = 0;
            |LEE 000#anz00010.a;
         |SINO;
            |LEE 000#anz00010.u;
         |FINSI;
         |SI FSalida = 0;
            |SI #anz00010#0 = #cacontar@#0;
               |SI #anz00010#2 ] nNumDocum;
                  nNumDocum = #anz00010#2 + 1;
                  nREGISTRO = nNumDocum;
               |FINSI;
            |SINO;
               nNumDocum = 1;
               nREGISTRO = nNumDocum;
            |FINSI;
         |SINO;
            nNumDocum = 1;
            nREGISTRO = nNumDocum;
         |FINSI;
         |SELECT #1#1;
         |REPON_DATOS #anz00010;

         |SI nNumDocum > 999999;
             |MENAV "    Atencion. El Numero de Documento es superior a 999.999, Revise la Contabilidad";
             nNumDocum = 1;
         |FINSI;
         #1#2 = nNumDocum; |PINTA #1#2;
         |CIERRA #cacontar@; |DESCARGA_DEF #cacontar@;
      |SINO;
         |HAZ NuevoDoc;
         |HAZ NuevoRegistro;
         nNumDocum = #caconasi#1;
      |FINSI;

      anter = #1#0;
      #1#12 = nREGISTRO;
      #1#0  = anter;         || diario
      #1#2  = nNumDocum;     || documento
      #1#3  = #1#2;          || asiento
      #1#17 = ant_ref;       || Referencia
      #1#7  = 0;             || asiento predefinido

      || ....    |PINTA #anz00010#12;
      |HAZ asie_nue;
   |FINSI;
   |SI inkey = 9;
      |PTEC 802;
      |PTEC 802;
      |PTEC 802;
      |PTEC 802;
      |SI  eaPtec = "N"; |PTEC 802; |FINSI;
      |SI eaRefer = "S"; |PTEC 802; |FINSI;
   |FINSI;
   |SI inkey = 10;
      |PTEC 802;
      |PTEC 802;
      |SI  eaPtec = "N"; |PTEC 802; |FINSI;
      |SI eaRefer = "S"; |PTEC 802; |FINSI;
   |FINSI;
   |SI inkey = 11;
      |SUB_EJECUTA_NP "camemori";
      |ERROR;
   |FINSI;
   |SI inkey = 17; |Y xx ! 1; |Y eaRefer = "S";
       #1#1 = fec1;
       |CONSULTA_CLAVE #5#1;
       |SI FSalida ! 0;
           |ERROR;
       |SINO;
           |PTEC 802;
           |PTEC 802;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO fecha; |TIPO 0;                || desde campo 'fecha'
   inkey = FSalida;

   xx = (FEntrada / 100) ! 0;

   |SI xx ! 4;
       |SI #1#1 [ fec3;
           |MENAV mensa2;
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   |SI #1#1 < fec1; |O #1#1 > fec2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
   |SINO;
      |SI inkey = 9;
         |PTEC 802;
         |PTEC 802;
         |PTEC 802;
         |SI  eaPtec = "N"; |PTEC 802; |FINSI;
         |SI eaRefer = "S"; |PTEC 802; |FINSI;
      |FINSI;
      |SI inkey = 10;
         |PTEC 802;
         |SI  eaPtec = "N"; |PTEC 802; |FINSI;
         |SI eaRefer = "S"; |PTEC 802; |FINSI;
      |FINSI;
      |SI inkey = 11;
         |SUB_EJECUTA_NP "camemori";
         |ERROR;
      |FINSI;
      |SI inkey = 17; |Y xx ! 1; |Y eaRefer = "S";
          #1#1 = fec1;
          |CONSULTA_CLAVE #5#1;
          |SI FSalida ! 0;
              |ERROR;
          |SINO;
              |PTEC 802;
          |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO AntDocument; |TIPO 7;
   xx = (FEntrada / 100) ! 0;
   |SI xx = 1; |Y eaPtec = "S";
       |PTEC 802;
   |FINSI;
|FPRC;

|PROCESO document; |TIPO 0;             || desde campo 'documento'

   inkey = FSalida;
   nConte = Contenido;
   xx = (FEntrada / 100) ! 0;

   |SI xx = 1;
      |SI #1#2 ! nConte; |Y inkey ! 2;
         |SI eaPaDOM3 ! "S";
             nume1 = #20#1 + 1;
             |SI nume1 < #1#2;
                 nume1 = 0;
                 |SI eaPaDOM3 = "A";
                     |CONFI "    NNumero Documento superior al Ultimo + 1, Continuar";
                     |SI FSalida = 0;
                         nume1 = 1;
                     |FINSI;
                 |FINSI;
                 |SI nume1 = 0;
                     #1#2 = nConte;
                     |ERROR;
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI swcontador = 0;
             swcontador = 1;
             sumaasi = #1#2;
             |SI sumaasi > #20#1;
                 nDOCUMENTO = sumaasi;
                 |HAZ ActContador;
             |FINSI;
         |SINO;
            swcontador = 0;
            sumaasi = 0;
         |FINSI;
      |FINSI;
   |FINSI;

   xx = (FEntrada / 100) ! 0;

   |SI xx = 1; |Y inkey ! 2;
       #1#3 = #1#2; |PINTA #1#3;
       |HAZ RepiteDoc;
       |SI nError = 1; |ERROR; |ACABA; |FINSI;
   |FINSI;

   |SI inkey < 11;  |O inkey > 16;
      |ACABA;
   |FINSI;

   |SI inkey = 11;           || modificacion de asientos
      |SI xx ! 2; |ACABA; |FINSI;
      |ATRI P;  |MENSA "    Cargando Opcion ...";  |ATRI 0;
      ext1 = #1#0;          || diario viejo
      ext2 = #1#1;          || fecha viejo
      ext3 = #1#2;          || documento viejo
      ext4 = #1#3;          || asiento viejo
      |CIERRAT #0;
      |CIERRAT #1;
      |SUB_EJECUTA_NP "camoddi0";
      |ABRET #0;
      |ABRET #1;
      #1#0 = ext1;          || diario nuevo
      #1#1 = ext2;          || fecha nueva
      #1#2 = ext3;          || documento nuevo
      #1#3 = ext4;          || asiento nuevo
      |PINTA #1#0;
      |PINTA #1#1;
      |PINTA #1#2;
      |PINTA #1#3;
      |SI sw_ivamerr ! 0;  |ERROR;  |FINSI;
      |ACABA;
   |FINSI;

   |SI xx ! 1;
      |MENAV "    Este tipo de contabilizacion esta limitado al ALTA ...";
      |ACABA;
   |FINSI;
   |ATRI P;  |MENSA "    Cargando Opcion ...";  |ATRI 0;

   |SI inkey = 12;|O inkey = 13; |O inkey = 14;    || iva reperc./soport. manuales

       ext1 = ("00" + #anz00010#0) % -102;
       ext2 = #anz00010#1;
       ext3 = ("000000" + #anz00010#2) % -106;
       l_alfa1 = "camaniva.tab;"; |QBF l_alfa1;
       |SI inkey = 12; l_alfa1 = l_alfa1 + "R,"; |FINSI;
       |SI inkey = 13; l_alfa1 = l_alfa1 + "S,"; |FINSI;
       |SI inkey = 14; l_alfa1 = l_alfa1 + "N,"; |FINSI;
       l_alfa1 = l_alfa1 + ext1 + "," + ext2 + "," + ext3;

       |GRABA 020#1n;
       |SI FSalida ! 0;
           |ERROR;
           |ACABA;
       |FINSI;
       |LIBERA #1;  ||Prueba

       |SUB_EJECUTA_NP l_alfa1;
       #anz00010#0 = ext1;
       #anz00010#1 = ext2;
       #anz00010#2 = ext3;
       |SI sw_ivamerr ! 0;
           |LEE 121#1=;
           |BORRA 000#1a;
           |ERROR;
       |SINO;
          |ABRET #0;
          |ABRET #1;
          |LEE 121#1=;
          |PINDA #0#anz00010;
          enPred  = 0;
          ant_dia = #1#0;
          ant_fec = #1#1;
          ant_ref = #1#17;
          ant_doc = #1#2;
          nSwUlt = 1;
          ivacomun = "";
          NumDocum = 0;
          |PTEC 806;
          |PTEC 815;
          |ACABA;
       |FINSI;
   |FINSI;

   |ABRET #0;
   |ABRET #1;

   |SI sw_ivamerr ! 0;
     |ERROR;
   |FINSI;
|FPRC;

|PROCESO RepiteDoc;
   nError = 0;
   |SI eaPaDOM2 = "S"; |ACABA; |FINSI;  || no mira

   |SALVA_DATOS #1;
   |SELECT #3#1;
   nDocum  = #1#2;
   fFecha  = #1#1;
   nDiario = #1#0;
   #1#0 = 0;
   #1#1 = "01.01.1900";
   |LEE 000#1=;
   |SI FSalida = 0;
       |SI #1#0 ! nDiario; |O #1#1 ! fFecha;
           nError = 1;
       |FINSI;
   |FINSI;
   |SELECT #1#1;
   |REPON_DATOS #1;
   |SI nError = 1;
      |SI eaPaDOM2 = "A";
          |CONFI "    NAtencion, Ya existe numero de Documento. Continuar";
          |SI FSalida = 0;
              nError = 0;
              |ACABA;
          |FINSI;
      |FINSI;
      |HAZ NuevoDoc;
      #1#2 = #caconasi#1; |PINTA #1#2;
      #1#3 = #caconasi#1; |PINTA #1#3;
  |FINSI;
|FPRC;

|CALCULO DesdeExt; |TIPO 7;
   |SI enDocumento = 0; |ACABA; |FINSI;
   |SI Campo = 17;
       |SI eaRefer = "N"; |ACABA; |FINSI;
   |FINSI;
   |PTEC 802;
|FCAL;

|CALCULO r_referen; |TIPO 6;
   |SI eaRefer = "N"; |ACABA; |FINSI;
   inkey = FSalida;
   r_entra = entrada;
   r_alfa1 = #1Campo;
   |HAZ r1_punto;
   #1Campo = r_alfa1;
   |PINTA #1Campo;
|FCAL;

|CALCULO referen; |TIPO 0;
 ant_ref = #1#17;

 |SI inkey ! 1; |ACABA; |FINSI;

 xx = (FEntrada / 100) ! 0;
 |SI xx = 2; |Y nModPred = 1;
     |BUCLE BorraIvaCab;  ||borre anterior
 |FINSI;
|FCAL;

|CALCULO asinumero; |TIPO 0;
 inkey = FSalida;
 |SI inkey ! 1; |ACABA; |FINSI;

 xx = (FEntrada / 100) ! 0;
 |SI xx = 2; |Y nModPred = 1;
     |BUCLE BorraIvaCab;  ||borre anterior
 |FINSI;
|FCAL;

|PROCESO enalta; |TIPO 7;          || desde campo 'asiento predefinido'
   xx = (FEntrada / 100) ! 0;
   |SI xx = 1;
      |CAMPO_MODIFICA #anz00010#7, 1, "S";
   |SINO;
      |CAMPO_MODIFICA #anz00010#7, 1, "N";
   |FINSI;
|FPRC;

|PROCESO ver_guard; |TIPO 7;
   |SI xx = 1;
      #anz00010#7 = ult_pre; |PINTA #anz00010#7;
   |FINSI;
|FPRC;

|PROCESO guard_pr; |TIPO 0
   ult_pre = #anz00010#7;
|FPRC;

|PROCESO siesta; |TIPO 6;          || desde campo 'asiento predefinido'
   inkey = FSalida;
   |SI inkey = 1;|Y sw_ptec ! 0;  |ACABA;  |FINSI;  || ESC-ESC en repeticion
   ||/desde 'ENCAMPO' 'anz00011'
   |SI sw_ptec ! 0;
       |SI inkey ! 0; |Y inkey ! 10; |Y inkey ! 9;
           |ERROR;  || .. #0#7 = 0; |PINTA #0#7;
           |ACABA;
       |FINSI;
   |FINSI;
   |SI inkey = 10; |Y sw_ptec ! 1;
      |ERROR;
      |SI sw_ptec = 2; |PTEC 802; |PTEC 807; |FINSI;
      |SI sw_ptec = 0;            |PTEC 807; |FINSI;
      |ACABA;
   |FINSI;

   xx = (FEntrada / 100) ! 0;
   predefine = 0;

   |ABRE #11;
   #casieaca#0 = #anz00010#7;
   |LEE 001#11=;
   |SI FSalida ! 0;
      |SI #anz00010#7 = 0;
         |DDEFECTO #11;
         |GRABA 020#11n;       || graba la clave 'cero'
      |FINSI;
      |ATRI I; |PINTA 0926, #casieaca#1; |ATRI 0;
      |CIERRA #11;
      |ACABA;
   |SINO;
      |SI #casieaca#2 = "S";
          |SI #casieaca#15 < 2;
              #casieaca#15 = 3;
              |GRABA 020#casieaca.a;
          |FINSI;
      |FINSI;
   |FINSI;

   |ATRI I; |PINTA 0926, #casieaca#1; |ATRI 0;
   |SI #anz00010#7 = 0;  |CIERRA #11;  |ACABA;  |FINSI;  ||NO ES OPERATIVO EL CERO

   |SI xx ! 1; |Y #casieaca#17 ! "X"; |CIERRA #11;  |ACABA;  |FINSI;

   |SI inkey ! 9;|Y inkey ! 10; || en <F1> presenta el asiento
       predefine = 1;           || en <F2> sube al diario
       predefine2 = 1;          ||/(cuando se esta a¤adiendo)
       |SI #casieaca#2 = "S";
           |SI #casieaca#17 = "X"; |Y xx ! 1;
               i_serie = #900#2;
               i_factu = #900#3;
               i_fecha = #900#4;
               sw_ptec = 0;                      ||/este 'PTEC' sobra
               eaCobPag = #casieaca#6;
               |BUCLE BorraIvaCab;  ||borre anterior
           |SINO;
               |HAZ pide_iva;
           |FINSI;
      |FINSI;
   |SINO;
      |SI inkey = 9;               || presenta el asiento
          |HAZ consulta;
          |ERROR;
      |FINSI;
   |FINSI;
   |CIERRA #11;
   #casieali#1 = 0;
|FPRC;

|PROCESO cargconDos;
   |SI #anz00011#8 = "D";
       |SI j_d = 0; j_d = #anz00011#3; |FINSI;
       sw_debe = sw_debe + 1;
   |SINO;
       |SI j_h = 0; j_h = #anz00011#3; |FINSI;
       sw_habe = sw_habe + 1;
   |FINSI;

   |SI sw_debe > 1; |O sw_habe > 1;
       |ERROR10;
   |FINSI;
|FPRC;

|PROCESO VerContra;
   sw_debe = 0; j_d = 0;
   sw_habe = 0; j_h = 0;
   |BUCLELIN 2cargconDos#1;

   |SI sw_debe = 1; |Y sw_habe = 1;
       |ABRE #calicont;

       #calicont#0 = #anz00010#0;
       #calicont#1 = #anz00010#1;
       #calicont#2 = #anz00010#2;
       #calicont#3 = j_d;
       |LEE 141#calicont.=;
       |SI FSalida = 0;
           #calicont#4 = #anz00010#10;
           |GRABA 020#calicont.a;
       |FINSI;
       |LIBERA #calicont;

       #calicont#0 = #anz00010#0;
       #calicont#1 = #anz00010#1;
       #calicont#2 = #anz00010#2;
       #calicont#3 = j_h;
       |LEE 141#calicont.=;
       |SI FSalida = 0;
           #calicont#4 = #anz00010#8;
           |GRABA 020#calicont.a;
       |FINSI;
       |LIBERA #calicont;

       |CIERRA #calicont;
   |FINSI;
|FPRC;

|PROCESO descuadre; |TIPO 3;
   |SI #anz00010#6 ! 0; |Y #anz00010#7 = 0;
      avisos = "AVISO!!! Asiento Descuadrado";
      |HAZ aviso5;
      |PAUSA;
      |HAZ aviso9;
   |FINSI;
   enPred  = 0;
   ant_dia = #1#0;
   ant_fec = #1#1;
   ant_ref = #1#17;
   ant_doc = #1#2;
   nSwUlt = 1;
   ivacomun = "";
   NumDocum = 0;

   |HAZ VerContra;

   xx = (FEntrada / 100) ! 0;
   |SI xx = 1; |Y #1#7 ! 0;
       |SI #1#13 = 1; |O #1#13 = 2;
           |SI enPulPre = 0; |Y #casieaca#17 ! "N";
               enLibro    = #camaniva#0;
               enRegistro = #camaniva#1;
               |HAZ eRSChequeo;
           |FINSI;
       |FINSI;
   |FINSI;
   |SI xx = 2;
       |SI #1#13 > 106; |Y #1#13 ! 190; |Y enSwDejar = 1;
           |HAZ eGrabaModificar;
       |FINSI;
   |FINSI;
   enPulPre = 0;
   enSwDejar= 0;

   |HAZ EsForest;
   |SI FSalida = 0;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "cacontar.mas";
      |CARGA_DEF aAlfa, cacontar@;
      |SI FSalida = 0;
         |ABRE #cacontar@;
         #cacontar@#0 = #anz00010#0;
         |LEE 101#cacontar@.=;
         |SI FSalida ! 0;
            |DDEFECTO #cacontar@;
            #cacontar@#0 = #anz00010#0;
            #cacontar@#1 = #camandia#1;
            |GRABA 020#cacontar@.b;
         |FINSI;
         nume1 = #cacontar@#2 + 1;
         |SI #1#2 = nume1;
            #cacontar@#2 = #cacontar@#2 + 1;
            |GRABA 020#cacontar@.a; |LIBERA #cacontar@;
         |SINO;
            |SALVA_FICHA #anz00010;
            |SELECT #7#1;
            |DDEFECTO #anz00010;
            #anz00010#1 = "01.01.0000";
            #anz00010#0 = #cacontar@#0 + 1;
            |LEE 000#anz00010.];
            |SI FSalida = 0;
               |LEE 000#anz00010.a;
            |SINO;
               |LEE 000#anz00010.u;
            |FINSI;
            |SI FSalida = 0; |Y #anz00010#0 = #cacontar@#0;
               |SI #anz00010#2 > #cacontar@#2;
                  #cacontar@#2 = #anz00010#2;
               |FINSI;
            |SINO;
               #cacontar@#2 = 1;
            |FINSI;
            |GRABA 020#cacontar@.a; |LIBERA #cacontar@;
            |SELECT #1#1;
            |REPON_FICHA #anz00010;
         |FINSI;
         |CIERRA #cacontar@; |DESCARGA_DEF #cacontar@;
      |FINSI;
   |FINSI;
|FPRC;

****************************************************************************
RUTINAS VARIAS
****************************************************************************

|PROCESO asie_nue;            || calculo 'entrada' /prepara un nuevo asiento
   #anz00010#4 = 0;       || asiento debe
   #anz00010#5 = 0;       || asiento haber
   #anz00010#6 = 0;       || asiento saldo
   |PINTA #anz00010#4;
   |PINTA #anz00010#5;
   |PINTA #anz00010#6;
   coant = 0;
   deant = "";
   dhant = "";
   imant = 0;
   dpant = eaDfDepC;
   sdant = eaDfSubC;
   refant = "";
   predefine2 = 0;
   sw_debe = 0;
   sw_habe = 0;
   j_d = 0;
   j_h = 0;
   ctab1 = "";
   ctab2 = 0;
   |HAZ el_di;
   ivacomun = "";
   nModPred = 0;
   |DDEFECTO #900;
   |DELINDEX #901;
|FPRC;

|PROCESO aviso5;         || desde calculo 'c_importe' (anz00011)
   |PUSHV 09101171;
   |HAZ color_f;
   |CUADRO 09 10 11 71;
   ||            123456789012345678901234567890123456789012345678901234567890
   |HAZ color_c;

   |QBF avisos;
   alfa1 = avisos % 0;  nume1 = alfa1;
   nume2 = ((60 - nume1) / 2) ! 0;     nume1 = 60 - nume1 - nume2;
   avisos = (" " * nume1) + avisos + (" " * nume2);        || lo centra

   |PINTA 1011, avisos;
   |ATRI 0;
   |AVISO;
|FPRC;

|PROCESO aviso9;         || desde calculo 'descuadre', 'modbaj'
   |ATRI 0;
   |POPV;
|FPRC;

|PROCESO color_c;        || activa el color caracter en avisos
   |COLOR 14, 0;
   |ATRI 0;
|FPRC;

|PROCESO color_f;        || activa el color graficos en avisos
   |COLOR 4, 0;
   |ATRI 0;
|FPRC;

|PROCESO pide_iva;       || desde calculo 'siesta' / pide datos ivas
   ext1 = #anz00010#1;        || fecha del asiento
   ext2 = #casieaca#4;        || libro iva
   ext4 = #casieaca#16;       || serie Factura
   ext10 = #anz00010#17;
   ext11 = #casieaca#3;        || Tipo IVA
   ext42 = #casieaca#18;       || Clave del 340
   eaCobPag = #casieaca#6;
   ext13  = #anz00010#7;
   |SUB_EJECUTA_NP "camaasiv.tab";
   nume1 = ext3;
   |SI nume1 ! 0;                || esto es el FSalida
       predefine = 0;
       predefine2 = 0;
      |ERROR;
   |SINO;
      |QBF ext21;
      i_serie = ext4;
      i_factu = ext5;
      i_fecha = ext1;
      i_activ = ext21;   |QBF i_activ;
      sw_ptec = 0;                      ||/este 'PTEC' sobra
   |FINSI;
   #anz00010#17 = ext10; |PINTA #anz00010#17;
|FPRC;

|PROCESO bor_cobros;          || desde rutina 'a_busca' (anz00011)
   |HAZ VerPuente;
   |SI swVPuente = 1;
       |DDEFECTO #Puente@;
       #Puente@#0 = #camaniva#0;
       #Puente@#1 = #camaniva#2;
       #Puente@#2 = #camaniva#3;
       #Puente@#3 = 0;
       #Puente@#27 = "V";
       #Puente@#28 = "B";
       |GRABA 020#Puente@.n;
       |HAZ CierraPuente;
 |FINSI;
|FPRC;

|PROCESO bor_pagos;           || desde rutina 'a_busca' (anz00011)
   |HAZ VerPuente;
   |SI swVPuente = 1;
       |DDEFECTO #Puente@;
       #Puente@#0 = #camaniva#0;
       #Puente@#1 = #camaniva#2;
       #Puente@#2 = #camaniva#3;
       #Puente@#3 = 0;
       #Puente@#27 = "C";
       #Puente@#28 = "B";
       |GRABA 020#Puente@.n;
       |HAZ CierraPuente;
   |FINSI;
|FPRC;

|PROCESO borraextra;
   |BORRA 020#25a;
   |LIBERA #25;
|FPRC;

|PROCESO extraco;        || desde calculo 'modbaj'  /borra anotaciones
   |ABRE #23;
   #caextras#0 = #anz00011#0;
   #caextras#1 = #anz00011#1;
   #caextras#2 = #anz00011#2;
   |LEE 001#23=;
   |SI FSalida = 0;
      |BUCLELIN 0borraextra#23;
      |BORRA 020#23a;
   |FINSI;
   |CIERRA #23;
   enTipoEx   = 3;
   enDiarioEx = #anz00010#0;
   efFechaEx  = #anz00010#1;
   enDocumEx  = #anz00010#2;
   enPerEx    = enPeriodo;
   |HAZ eBorraExtras;
|FPRC;

|PROCESO situate;        || desde rutina 'consulta'
   |CAMPO_POSICION #casieaax#0,1,0847;
   |CAMPO_POSICION #casieaax#1,1,0860;
|FPRC;

|PROCESO correte;        || desde subrutina 'consulta2'
   |CAMPO_POSICION #casieaax#0,0,posic; posic=posic+m_c; |CAMPO_POSICION #casieaax#0,1,posic;
   |CAMPO_POSICION #casieaax#1,0,posic; posic=posic+m_c; |CAMPO_POSICION #casieaax#1,1,posic;
|FPRC;

|PROCESO consulta2;      || desde rutina 'consulta' /BUCLELIN
   lin_con = lin_con + 1;
   |SI #casieali#2 = "D";  #casieaax#0 = #casieali#3;  #casieaax#1 = "     --     ";  |FINSI;
   |SI #casieali#2 = "H";  #casieaax#0 = "     --     ";  #casieaax#1 = #casieali#3;  |FINSI;
   |PINDA #0#13;
   |SI lin_con < 12;
      m_c = 100;
   |SINO;
      m_c = -1100;
      lin_con = 0;
      |PAUSA;
      |PINPA #0#13;
   |FINSI;
   |HAZ correte;
|FPRC;

|PROCESO consulta;       || desde calculo 'siesta' /presenta predefinido
   |HAZ situate;
   |PUSHV 05451974;
   |PUSHV 19292374;
   lin_con = 0;
   |DDEFECTO #13;
   |PINPA #0#13;
   |PINPA #1#13;
   |SI #casieaca#2 = "S";
      |SI #casieaca#3 = "R";  #casieaax#2 = "IVA REPERCUTIDO ";  |FINSI;
      |SI #casieaca#3 = "S";  #casieaax#2 = "IVA SOPORTADO   ";  |FINSI;
      |SI #casieaca#3 = "N";  #casieaax#2 = "REGISTRO SIN IVA";  |FINSI;
      |SI #casieaca#3 = "R";|Y #casieaca#6 = "S";  #casieaax#3 = "/COBROS";  |FINSI;
      |SI #casieaca#3 = "S";|Y #casieaca#6 = "S";  #casieaax#3 = "/PAGOS ";  |FINSI;
   |FINSI;
   |PINDA #1#13;
   |BUCLELIN 2consulta2#11;
   |SI lin_con = 0;
      |MENAV "    ATENCION!!! Cabecera sin lineas ...";
   |SINO;
      |PAUSA;
   |FINSI;
   |POPV;
   |POPV;
|FPRC;

|PROCESO cargcon;
   |SI #anz00011#8 = "D";
      |SI j_d = 0; j_d = #anz00011#3; |FINSI;
   |SINO;
      |SI j_h = 0; j_h = #anz00011#3; |FINSI;
   |FINSI;
   |SI j_d ! 0; |Y j_h ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO carga_con;
   sw_debe = 0; j_d = 0;
   sw_habe = 0; j_h = 0;
   |SI #anz00010#8  ! doce; sw_debe = 1; |FINSI;
   |SI #anz00010#10 ! doce; sw_habe = 1; |FINSI;
   |SI sw_debe = 0; |Y sw_habe = 0; |ACABA; |FINSI;
   |BUCLELIN 2cargcon#1;
|FPRC;


|RUTINA inf1;
   #anz00011#0 = #anz00010#0;
   #anz00011#1 = #anz00010#1;
   #anz00011#2 = #anz00010#2;
   #anz00011#3 = 1;
|FRUT;

|RUTINA sup1;
   #anz00011#0 = #anz00010#0;
   #anz00011#1 = #anz00010#1;
   #anz00011#2 = #anz00010#2;
   #anz00011#3 = 9999;
|FRUT;

|PROCESO EligeLinea;
   |ENTLINEAL #1#anz00011,4,1,19,0,inf1,sup1;
|FPRC;

|PROCESO UltimaFecha; |TIPO 7;

  |SI f1auto ! 0; |O nSwUlt = 1;
      #1#1 = ant_fec;
      |PINTA #1#1;
      |ACABA;
      f1auto = 0;
  |FINSI;

  |SALVA_DATOS #anz00010;
  nDiario = #anz00010#0;
  #anz00010#0 = nDiario;
  #anz00010#1 = "31.12.2999";
  #anz00010#2 = 999999;
  |LEE 000#anz00010.];
  |SI FSalida = 0;
     |SI #anz00010#0 ! nDiario;
        |LEE 000#anz00010.a;
        |SI #anz00010#0 ! nDiario;
           #anz00010#1 = ~;
        |FINSI;
     |FINSI;
  |SINO;
     #anz00010#1 = ~;
  |FINSI;
  FechaUlt = #anz00010#1;
  |REPON_DATOS #anz00010;
  #anz00010#1 = FechaUlt;
  |SI #anz00010#1 [ fec3; #anz00010#1 = (fec3 + "01.00.0000"); |FINSI;
|FPRC;

|PROCESO VerPuente;
   swVPuente = 0;
   |ABRE #caivaasi;
   |LEE 000#caivaasi.p;
   |SI FSalida ! 0;
      |DDEFECTO #caivaasi;
      |GRABA 020#caivaasi.b;
   |FINSI;
   Comodin = #caivaasi#56; |QBF Comodin;
   |CIERRA #caivaasi;
   |SI Comodin = ""; |ACABA; |FINSI;

   eaPath = Comodin;
   |HAZ CreaPuente;
   |SI eaRetorno = "ERROR"; |ACABA; |FINSI;
   swVPuente = 1;
|FPRC;

|PROCESO Modificacion;
   |ABRE #anz00011;
   #anz00011#0 = #anz00010#0;
   #anz00011#1 = #anz00010#1;
   #anz00011#2 = #anz00010#2;
   #anz00011#3 = 9999;
   |LEE 041#anz00011.];
   |SI FSalida = 0;
       |LEE 041#anz00011.a;
   |SINO;
       |LEE 041#anz00011.u;
   |FINSI;
   |SI FSalida = 0; |Y #anz00011#0 = #anz00010#0;
      |Y #anz00011#1 = #anz00010#1; |Y #anz00011#2 = #anz00010#2;
         coant = #anz00011#6;
         deant = #anz00011#7;
         imant = #anz00011#9;
         dpant = #anz00011#21;
         sdant = #anz00011#28;
         refant = #anz00011#26;
   |FINSI;
   |CIERRA #anz00011;
|FPRC;

|PROGRAMA;

     |SI enDocumento = 0;
         enNoBloq = 1;
         |HAZ inicio;
         enNoBloq = 0;
         |HAZ Analitica;
         |SI enSwAna = 0;
             aAlfa1 = "    CONTABILIDAD NO ANALITICA.";
             |SI eaAnNiv = "E";
                 aAlfa1 = "    EMPRESA NO ANALITICA. ";
             |FINSI;
             |MENAV aAlfa1;
             |ACABA;
         |FINSI;
         |MANTE #1;
     |SINO;
         |SI swVarios = 1;
             |PATH_DAT #0  dirfich0;
             |PATH_DAT #1  dirfich0;
             |PATH_DAT #10 dirfich0;
             |PATH_DAT #11 dirfich0;
             |PATH_DAT #12 dirfich0;
             |PATH_DAT #23 dirfich0;
             |PATH_DAT #25 dirfich0;
             |PATH_DAT #24 dirfich0;
             |PATH_DAT #20 dirfich0;
             |PATH_DAT #500 dirfich0;
             |PATH_DAT #501 dirfich0;
             |PATH_DAT #210 dirfich0;
             |PATH_DAT #1000 dirfich0;
             |PATH_DAT #1001 dirfich0;
             fich_alta = dirfich0;
         |FINSI;

         |ABRET #1;
         |HAZ Atipo8;

         #1#0 = enDiario;
         #1#1 = efFecha;
         #1#2 = enDocumento;
         |LEE 121#1=;
         |SI FSalida = 0;
             |HAZ Modificacion;
             |PINPA #0#1;
             |PINDA #0#1;

             |ENDATOS #2#1;
             |SI FSalida = 0;
                 |GRABA 020#1a;
             |FINSI;
             |LIBERA #1;
         |FINSI;
         |CIERRAT #1;
     |FINSI;
|FPRO;
