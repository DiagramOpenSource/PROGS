|FICHEROS;
     careccdt #0;

     camaniva #1;
     caivaasi #2;
     calibros #3;
     caivases #4;

     canempre #30;
     caselem1 #998;
|FIN;

|VARIABLES;
     nFactura = 0;
|FIN;

|INCLUYE dscont_i;

|PROCESO GrabaLibro;
     |ABRE #1;
     |SELECT #3#1;
     #1#0 = #3#0;
     #1#2 = "     ";
     #1#3 = 999999;
     |LEE 040#1];
     |SI FSalida = 0;
         |LEE 040#1a;
     |SINO;
         |LEE 040#1u;
     |FINSI;
     |SI FSalida = 0;  |Y #1#0 = #3#0;
         nFactura = #1#3 + #3#3;
         |SI #3#4 < nFactura;
             #3#4 = nFactura;
             |GRABA 020#3a;
         |FINSI;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO GrabaSerie;
     #4#0 = #1#2;
     #4#1 = #3#2;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #1#2;
         #4#1 = #3#2;
         |GRABA 020#4b;
     |FINSI;

     nFactura = #1#3 + #4#4;
     |SI #4#3 < nFactura;
         #4#3 = nFactura;
         |GRABA 020#4a;
     |FINSI;
     |LIBERA #4;
|FPRC;

|DEFBUCLE camaniva;
     #1#3;
     ;
     #3#0, "     ", 000000;
     #3#0, "zzzzz", 999999;
     ;
     NULL, GrabaSerie;
|FIN;

|PROCESO calibros;
     |SI #2#44 = "N";
         |HAZ GrabaLibro;
     |SINO;
         |ABRE #4;
         |BUCLE camaniva;
         |CIERRA #4;
     |FINSI;
     |LIBERA #3;
|FPRC;

|DEFBUCLE calibros;
     #3#1;
     ;
     01;
     99;
     be;
     NULL, calibros;
|FIN;

|PROCESO HazTodo;
     |ABRE #2;
     |LEE 040#2p;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |BUCLE calibros;
|FPRC;

|PROCESO MultiEmp1;
     cod1 = #caselem1#1;
     cod2 = #caselem1#2;
     emEmp = 1;  || Sin mensaje
     |HAZ leelo;
     |SI swerror ! 0;  |ACABA;   |FINSI;

     dirfich0 = #caselem1#3;
     |QBF dirfich0;

     |PATH_DAT #1 dirfich0;
     |PATH_DAT #2 dirfich0;
     |PATH_DAT #3 dirfich0;
     |PATH_DAT #4 dirfich0;

     |ATRI N; |CUADRO 1508 1850;
     |ATRI R; |PINTA 1609, "Empresa: ";      |ATRI 0;
     |PINTA 1618, #30#2; |PINTA 1709, #30#1; |ATRI 0;
     |PINTA 1910, "                                                      ";
     |PINTA 2010, "                                                      ";

     |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
     #caselem1#1;
     ;
     001;
     999;
     ;
     NULL, MultiEmp1;
|FIN;

|PROGRAMA;
     |CLS;
     |CABEZA "Recalculo Contadores";
     |PINPA #0#0;

     |CONFI "0000NDesea Continuar ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SUB_EJECUTA "caselemp.tab";
     |NOME_DAT #998 eaFichsel;
     |BUCLE MultiEmp0;
     |DELINDEX #998;
|FPRO;
