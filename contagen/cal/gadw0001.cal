|FICHEROS;
     gadw0001,MANTE;

     gadm0002;
     gadm0001;
     gadm0000;
     gadm0003;
     gadm0004;
     gadm0005;
     gadm0006;

     caclipro;
     cacuenta;

     calibros;
     caivaasi;
     caivases;
     caintiva;
     cainliva;
     ca8cumay;
     ca8m0002;
     cacuebal;
     caforpag;

     gadw0005,MANTE;

     :/modelos/def/dsmom030;
     :basica/agicen14;

     :/dsarchi/def/dpntm100;
     :/dsarchi/def/dpntm101;

     &facturas@ #100;
     &regisnif@;
     agifa134@;
     agifa084@;
     agifa079@;
|FIN;

|VARIABLES;
     nConceIRPF      = 0;
     aDesIRPF        = "";
     aVerde          = "";
     aPeriodo        = "";
     aAlfa           = "";
     aSerFac         = "";

     nSwHazDesglose  = 0;
     nEmp48          = 0;
     nErr            = 0;
     nPas            = 0;

     nBotonSalir     = -1;
     nBotonCancelar  = -1;
     nBotonAceptar   = -1;
     nBotonContinuar = -1;
     nContinuar      = -1;
     nContenido      = -1;

     aQueBoton       = "";
     aID             = "";
     aTipo           = "";

     aMensa   = "";
     nInkey   = 0;
     aBlancs  = "";
     aAlfa1   = "";
     aAlfa2   = "";
     aAlfa3   = "";
     aAlfa5   = "";
     aAlfa7   = "";
     mesdes   = "";
     meshas   = "";
     aContenido = "";

     xx       = 0;
     aDCon1   = "";
     aDCon2   = "";
     nDCon0   = 0;
     nDCon1   = 0;

     swNuevo  = 0;
     swRepite = 0;


     a_param   = "";
     fFecha1   = @;
     alfa1     = "";
     alfa2     = "";
     alfa3     = "";
     alfa4     = "";
     alfa5     = "";
     alfa6     = "";
     nNume1    = 0;
     nNume2    = 0;
     nNume3    = 0;
     nNume4    = 0;
     nNume5    = 0;
     nNume6    = 0;
     muestra   = "";
     nSwLaC    = 0;
     asteris   = 0;
     longi     = 0;
     nTipoIVA  = 0;

     nSwYaTengoTipo = 0;
     nHay5          = 0;

     Comodin   = "";
     Comodin1  = "";
     ComodNum  = 0;
     nPara1    = 0;
     nActualizado = 0;
     nRegPpal     = 0;
     nConta       = 0;

     ModoEntrada = 0;
     factura     = 0;
     nNumFactura = 0;
     NumBase     = 0;
     SerieAnt    = "  XX";
     FacturaAnt  = 0;
     nFacCon     = 0;
     FechaAnt    = "";
     CuentaAnt   = "";
     DigitoAnt   = 0;
     PerioAnt    = 0;
     ClienAnt    = "";
     CifAnt      = "";
     ConceptoAnt = 0;
     DescAnt     = "";
     DeparAnt    = "";
     NDeparAnt   = "";
     SubdeAnt    = "";
     NSubdeAnt   = "";
     ReferAnt    = "";
     aAntesDes0 = "";
     aAntesDes1 = "";
     nAnterior  = 0;
     nAnteriorIRPF = 0;
     nCamp10     = 0;
     nCamp11     = 0;
     nCamp12     = 0;
     nCamp13     = 0;
     nCamp14     = 0;
     nCamp15     = 0;
     nCamp16     = 0;
     aCamp17     = "";
     nCamp18     = 0;
     aCamp19     = "";
     aCamp28     = "";
     nCamp29     = 0;
     aCamp32     = "";
     nCamp34     = 0;
     nCamp35     = 0;
     aCamp36     = "";
     nCamp37     = 0;
     aCamp39     = "";
     aCamp40     = "";
     nCamp41     = 0;
     aCamp42     = "";
     nCamp43     = 0;
     aCamp44     = "";
     aCamp49     = "";
     nCamp51     = 0;
     aCamp52     = "";
     aCamp54     = "";
     aCamp55     = "";
     aCamp56     = "";
     aCamp57     = "";
     aCamp58     = "";
     nCamp59     = 0;
     nCamp60     = 0;
     fCamp61     = @;
     aCamp62     = "";
     aCamp63     = "";
     aCamp64     = "";
     aCamp68     = "";
     aTexto      = "";
     aFraPrv     = "";

     sw     = 0;
     SwMovs = 0;
     Serie  = "";
     nTecla  = 0;
     aClv1   = "";
     aClv2   = "";

     BaseAnt = 0;
     Calc = 0;
     swpase = 0;

     aFich1 = "";
     aFich2 = "";
     nYaCrea = 0;
     swmalo  = 0;
     swpcta = 0;
     fechaW17    = @;

     aMas       = "";
     aDirInicio = "";
     nEstaLin   = 0;
     nEstado    = 0;

     aImpriSN   = "";
     nSwImp     = 0;
     aCPartida  = "";
     nCTiva     = 0;
     swclipro   = 0;

     nNumLin  = 0;
     aSerTot  = "";
     nFacTot  = 0;
     nLinTot  = 0;
     nRef     = 0;

     swAmor   = 0;
     swInve   = 0;
     nIva0    = 0;
     nPrimLin = 0;
     nMasLin  = 0;
     nSwOp    = 0;
     nNoSalta  = 0;
     nSwIntra  = 0;
     nCampo    = 0;
     nPanta1   = 0;
     nCamb     = 0;

     nID               = 0;
     swAmorC           = 0;

     aEjecuta          = "";
     aAbre             = "";
     aPathDefDSARCHI   = "";
     aPathFichGAD      = "";
     aPathFichDESPANET = "";
     aPathDSARCHI      = "";
     nDSARCHI          = 0;
     nHandle           = 0;
     nBoton1           = 0;
     nBoton2           = 0;
     nEstadoBoton1     = 0;
     nEstadoBoton2     = 0;
     nForma            = 0;
     aValor            = "";
     aSerieArc         = "";
     nFactuArc         = 0;
     nLinea            = 0;
     nNumBas           = 0;
     aPCorreo          = "";

     nPulsoF9          = 0;
     nContaMes         = 0;
     nDesdeComer       = 0;
     nVent             = 0;
     nVentTrab         = 0;
     nOk               = 0;
     nTIVA1            = 0;
     nTIVA2            = 0;
     nFacConta         = 0;
     nFacComer         = 0;

     fFechaFac         = @;

 {-1}aVent               = "";
     aVent1              = 0;
     aVent2              = 0;
     aVent3              = 0;
     aVent4              = 0;
     aVent5              = "";

     &enSWAut         = 0;
     &enLiAut         = 0;
     &enOrAut         = 0;
     &eaSeAut         = "";
     &eaVarDni        = "";
     &enCalcCif       = 0;
     &enQSerie        = 0;
     &entrada         = 1;
     &ct1_am          = "";
     &ct2_am          = 0;
     &fec_am          = @;
     &imp_am          = 0;
     &iva_am          = 0;
     &tiva_am         = 0;
     &c_am            = "";
     &prv_am          = "";
     &c_conp          = 0;
     &nLib_am         = 0;
     &aSer_am         = "";
     &nFra_am         = 0;
     &dni_am          = "";
     &clau_am         = "";
     &igic_am         = "";
     &nDoc_am         = 0;
     &nBas_am         = 0;
     &aElemento       = "";
     &nNumero         = 0;
     &enError         = 0;
     &enModAmor       = 0;
     &enSwActual      = 0;
     &en0W17          = 0;
     &ef1W17          = @;
     &en2W17          = 0;
     &nSwHay17        = 0;
     &eaFitW17        = "";
     &coant           = 0;
     &deant           = "";
     &dpant           = "";
     &sdant           = "";
     &refant          = "";
     &libro           = 0;
     &serie           = "";
     &orden           = 0;
     &depart          = "";
     &pesetas         = 0;
     &cuenta          = "";
     &digito          = 0;
     &emision         = "";
     &nConcep         = 0;
     &aDesc           = "";
     &enModoEsc       = 0;
     &enLinea         = 0;
     &enCyP           = "";
     &eaRef           = "";
     &enSwBUENO       = 0;
     &enDiAna         = 0;
     &efFeAna         = @;
     &enDoAna         = 0;
     &enApAna         = 0;
     &eaGrAna         = "";
     &enImAna         = 0;
     &enQueAna        = 0;
     &nSwGrupo        = 0;
     &eaFitnW12       = "";
     &eaFitnW13       = "";
     &r_entra         = "";
     &r_alfa1         = "";
     &ext1            = "";
     &ext2            = "";
     &enPerIntra      = 0;
     &enIn03          = 0;
     &eaTip349        = "";
     &eaFichCab       = "";
     &eaFichLin       = "";
     &eaFichIVA       = "";
     &eaFichIRPF      = "";
     &enMasivo        = 0;
     &eaAuto          = "";
     &enMensaMod      = 0;
     &eaErrorMod      = "";
     &enPerSCAN       = 0;
     &enActual        = 0;
     &eaPathDPNTM     = "";
     &enNumRegistro   = 0;
     &enSwHayDesglose = 0;
     &enSwDescuadre   = 0;
     &eaTipoCtb       = "";
     &eaPathComer     = "";
|FIN;


|INCLUYE dscoiv_i;
|INCLUYE dscont_i;
|INCLUYE dscoan_i;
|INCLUYE defec1_i;
|INCLUYE modulo_i;
|INCLUYE cla340_i;
|INCLUYE dscosi_i;

|PROCESO Tipo12gadw1;  |TIPO 12;
|FPRC;

|PROCESO Tipo15Fm5;
|FPRC;

|PROCESO Tipo16Fm5;
|FPRC;

|PROCESO Tipo17Fm5;
|FPRC;

|PROCESO gadm0003Cheq;
     |SI nPas = 0;
         |SI #gadw0001#17 ! #gadm0003#4;
             nErr = 1;
             |ERROR10;
         |FINSI;

         |ACABA;
     |FINSI;

     #gadm0003#4  = #gadw0001#17;
     #gadm0003#12 = #gadw0001#28;

     |GRABA 020#gadm0003.a;
     |LIBERA #gadm0003;
|FPRC;

|DEFBUCLE gadm0003Cheq;
     #gadm0003#1;
     ;
     nEmp48, #gadw0001#69, 01;
     nEmp48, #gadw0001#69, 99;
     be;
     NULL, gadm0003Cheq;
|FIN;

|PROCESO CtrlDesg;
     |SI aTipoIVA = "R";  nEmp48 = 1;  |FINSI;
     |SI aTipoIVA = "S";  nEmp48 = 2;  |FINSI;

     nErr = 0;
     nPas = 0;  |BUCLE gadm0003Cheq;
     |SI nErr = 1;
         |CONFI "0000SHay desglose de bases y tienen distintas contrapartidas. Quiere cambiarlas";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     nPas = 1;  |BUCLE gadm0003Cheq;
|FPRC;

|PROCESO gadm0000;
     #gadw0001#0 = #gadm0000#0;
     #gadw0001#7 = #gadm0000#3;
|FPRC;

|DEFBUCLE gadm0000;
     #gadm0000#2;
     ;
     #gadw0001#26, aTipoIVA, 00;
     #gadw0001#26, aTipoIVA, 99;
     ;
     NULL, gadm0000;
|FIN;

|PROCESO BuscaSerie;
     nOk = 0;

     |SELECT #3#gadm0005;
     #gadm0005#5 = aClv1;
     #gadm0005#1 = aClv2;
     |LEE 000#gadm0005.=;
     |SI FSalida = 0;
         nOk = 1;
         |ACABA;
     |FINSI;

     aAlfa = aClv2;  |QBF aAlfa;
     aAlfa = aAlfa % -3;
     aAlfa = aAlfa + "XX";
     #gadm0005#5 = aClv1;
     #gadm0005#1 = aAlfa;
     |LEE 000#gadm0005.=;
     |SI FSalida = 0;
         nOk = 1;
     |FINSI;
|FPRC;

|PROCESO gadm0005;
     aClv1 = aTipoIVA;
     aClv2 = aSerFac;
     |HAZ BuscaSerie;
     |SI nOk = 0;  |ACABA;  |FINSI;

     |ABRE #agicen14;
     #agicen14#0  = #48#2;
     #agicen14#1  = #gadm0005#3;
     |LEE 000#agicen14.=;
     |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;
     |CIERRA #agicen14;

     #gadw0001#0  = #gadm0005#0;
     #gadw0001#7  = #gadm0005#8;
     #gadw0001#8  = #gadm0005#9;
     #gadw0001#17 = #gadm0005#6;
     #gadw0001#26 = aSerFac;
     #gadw0001#28 = #gadm0005#7;
     #gadw0001#45 = ("00" + #gadm0005#3) % -102;
     #gadw0001#46 = #agicen14#4;
     #gadw0001#47 = #gadm0005#12;
     #gadw0001#48 = #gadm0005#13;

     |SI #facturas@#79 ! 0;
         #gadw0001#2  = #facturas@#79;
     |FINSI;

     nTipoIVA = #gadm0005#10;
     |SI nTipoIVA ! 0;
         efFechaIVA = #gadw0001#4;
         enLineaIVA = nTipoIVA;
         |HAZ SacaIVA;
         |SI enPorcIVA = #gadw0001#13;
             #gadw0001#10 = nTipoIVA;
             nSwYaTengoTipo = 1;
         |FINSI;
     |FINSI;

     |SI nSwYaTengoTipo = 0;
         nTipoIVA = #gadm0005#11;
         |SI nTipoIVA ! 0;
             efFechaIVA = #gadw0001#4;
             enLineaIVA = nTipoIVA;
             |HAZ SacaIVA;
             |SI enPorcIVA = #gadw0001#13;
                 #gadw0001#10 = nTipoIVA;
             |FINSI;
         |FINSI;
     |FINSI;

     nConceIRPF = #gadm0005#14;
     aDesIRPF   = #gadm0005#15;

     nHay5 = 1;
|FPRC;

|PROCESO BuscaLibro;
     |SI nHay5 = 1;  |ACABA;  |FINSI;

     |BUCLE gadm0000;
|FPRC;

|PROCESO PintaCobro;
    |SI #gadw0001#49 ! "N";
        |C_V #gadw0001#40,1,"S";
    |SINO;
        |C_V #gadw0001#40,1,"N";
    |FINSI;

    |PINTA #gadw0001#40;
|FPRC;

|PROCESO Bajacaivases;
     #caivases#0 = "";
     #caivases#1 = #gadw0001#50;
|FPRC;

|PROCESO Altacaivases;
     #caivases#0 = "zzzzz";
     #caivases#1 = #gadw0001#50;
|FPRC;

|PROCESO Tipo66C26;  |TIPO 66;
     |ABRE #caivases;
     #caivases#0 = #gadw0001#26;
     #caivases#1 = #gadw0001#50;
     |LEE 000#caivases.];

     |CONSULTA_F_CLAVE #1#caivases, Bajacaivases, Altacaivases;
     |SI FSalida = 0;
         #gadw0001#26 = #caivases#0;   |PINTA #gadw0001#26;
     |FINSI;
     |CIERRA #caivases;
|FPRC;

|PROCESO CogeMes;
     aPeriodo = #gadw0001#4; |QBF aPeriodo;
     aPeriodo = aPeriodo % 0402;
     |SI enEjercicio [ 2009;
         |SI #caivaasi#46 = "T";
             |SI aPeriodo ] "01"; |Y aPeriodo [ "03"; aPeriodo = "01"; |FINSI;
             |SI aPeriodo ] "04"; |Y aPeriodo [ "06"; aPeriodo = "02"; |FINSI;
             |SI aPeriodo ] "07"; |Y aPeriodo [ "09"; aPeriodo = "03"; |FINSI;
             |SI aPeriodo ] "10"; |Y aPeriodo [ "12"; aPeriodo = "04"; |FINSI;
         |SINO;
             |SI #caivaasi#46 = "A"; aPeriodo = "00"; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TrataFecha;
     eaFecMod   = fFechaFac;
     enPerMod   = 0;
     enMensaMod = 1;
     enPanMod   = 0;
     eSwReten   = 0;
     |HAZ ConsulModIVA;

     |HAZ CogeMes;
|FPRC;

|PROCESO Tipo0C4;  |TIPO 0;
     #gadw0001#75 = "";

     fFechaFac = #gadw0001#4;
     |HAZ TrataFecha;
     #gadw0001#31 = aPeriodo;

     |SI #caivaasi#167 = "X";  |ACABA;  |FINSI;

     |SI eaErrorMod ! "";
         #gadw0001#75 = aVerde;
         |MENAV eaErrorMod;
         |ERROR;
     |FINSI;

     #gadw0001#75 = "";

     |PINTA #gadw0001#31;
|FPRC;

|PROCESO Tipo0C0; |TIPO 0;
     |ABRE #calibros;
     #calibros#0 = #gadw0001#0;
     |LEE 000#calibros.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe el Libro.";
         |ERROR;
         |CIERRA #calibros;
         |ACABA;
     |FINSI;
     |CIERRA #calibros;

     |SI #calibros#2 ! #gadw0001#50;
         |MENAV "0000EL libro no coincide con el tipo de facturas.";
         |ERROR;
     |FINSI;

     |ABRE #gadm0002;
     #gadm0000#0 = #gadw0001#0;
     |LEE 000#gadm0000.=;
     |SI FSalida = 0;
        #gadw0001#26 = #gadm0000#2;

        |PINTA #gadw0001#26;
     |FINSI;
     |CIERRA #gadm0002;
|FPRC;

|PROCESO Tipo0C26; |TIPO 0;
     nContenido = Contenido;
     |SI #gadw0001#Campo# = nContenido;  |ACABA;  |FINSI;

     |ABRE #caivases;
     #caivases#0 = #gadw0001#26;
     #caivases#1 = #gadw0001#50;
     |LEE 000#caivases.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe la Serie.";
         |ERROR;
         |CIERRA #caivases;
         |ACABA;
     |FINSI;
     |CIERRA #caivases;

     |HAZ BuscaLibro;

     |PINTA #gadw0001#0;
     |PINTA #gadw0001#7;

     enFilConc  = 2;
     enConcepto = #gadw0001#7;
     eaReperc   = " ";
     |HAZ FiltroConcepto;
|FPRC;

|PROCESO Tipo0C2;  |TIPO 0;
    |HAZ PintaCobro;
|FPRC;

|PROCESO CalculaPeriodo;
     aVerde = "0,185,0;255,255,255";

     |DDEFECTO #caivaasi;
     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |CIERRA #caivaasi;

     |SI #gadw0001#4 < fec1; |O #gadw0001#4 > fec2;
         |SI enMasivo = 0;
             |MENAV "0000ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
         |FINSI;
         enError = 1;
         |ACABA;
     |SINO;
         |SI #gadw0001#4 [ fec3;
             |SI enMasivo = 0;
                 |MENAV  "0000ERROR FECHA INFERIOR O IGUAL AL BLOQUEO DE DATOS";
             |FINSI;
             enError = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     |HAZ CogeMes;

     |SI #caivaasi#167 ! "X";
         eSwReten   = 0;
         enMensaMod = 1;
         enPanMod   = 0;
         enPerMod   = aPeriodo;
         |HAZ ConsulModIVA;
         |SI eaErrorMod ! "";
             |SI #caivaasi#167 = "S";
                 |SI enMasivo = 0;
                     |MENAV eaErrorMod;
                 |FINSI;
             |FINSI;

             #gadw0001#75 = aVerde;
         |FINSI;
     |FINSI;

     ComodNum = aPeriodo;
     #gadw0001#31 = ComodNum; |PINTA #gadw0001#31;
|FPRC;

|PROCESO Tipo66C7;  |TIPO 66;
     eaFiCon    = eaFichIVA;
     enConcepto = #gadw0001#7;
     |HAZ VerConcepto;
     #gadw0001#7 = enConcepto;
     |PINTA #gadw0001#7;
|FPRC;

|PROCESO Tipo0C7;  |TIPO 0
     |SI Campo = 7;
         nContenido = Contenido;
         |SI #gadw0001#7 = nContenido;  |ACABA;  |FINSI;
     |FINSI;

     enLibIVA   = #gadw0001#0;
     enFilConc  = 2;
     enConcepto = #gadw0001#7;
     eaReperc   = " ";
     |HAZ FiltroConcepto;
     |SI eswLect ! 0; |ACABA; |FINSI;

     |C_M #gadw0001#45,0,aAlfa1;
     |SI aAlfa1 = "N";   ||no modifica Actividad
         enActividad = #gadw0001#45;
         |SI Haybasica = 1;
             enFilRegIVA = 0;
             enConcepto  = #gadw0001#7;
             |HAZ FilRegimenIVA;
             |SI eswLect ! 0; |ACABA; |FINSI;
         |FINSI;
     |FINSI;

     |SI #gadw0001#7 = dConc1;
         #dsmom030#1 = dDesc1;
     |FINSI;

     #gadw0001#8  = #dsmom030#1;   |PINTA #gadw0001#8;
     #gadw0001#54 = #dsmom030#72;  |PINTA #gadw0001#54;

     nSwIntra = 1;
     |SI #gadw0001#54 = "N";
         nSwImp = 0;
         nSwIntra = 0;
     |SINO;
         |SI #dsmom030#26 = 5; eaTip349 = "AR";  |FINSI;
         |SI #dsmom030#26 = 6; eaTip349 = "IR";  |FINSI;
         |SI #dsmom030#30 = 2; eaTip349 = "AR";  |FINSI;
         |SI #dsmom030#30 = 3; eaTip349 = "IR";  |FINSI;
         |SI #dsmom030#34 = 9; eaTip349 = "ER";  |FINSI;
         |SI #dsmom030#34 = 4; eaTip349 = "SR";  |FINSI;
     |FINSI;

     |SI #gadw0001#17 ! "            ";  |Y Campo ! 7;
         eaCtaIVA = #gadw0001#17;
     |FINSI;

     #gadw0001#17 = eaCtaIVA; |PINTA #gadw0001#17;
     emCta    = 0;
     eaCuenta = #gadw0001#17; |HAZ SacaNivel; #gadw0001#18 = enNivel;
     |HAZ LeeCuenta;
     |SI eswCta ! 0;
         |C_M #gadw0001#17,1,"S";
     |SINO;
         #gadw0001#28 = #cacuenta#2; |PINTA #gadw0001#28;
     |FINSI;

     #gadw0001#32 = "N";

     aClau340 = #gadw0001#62;
     nNumFras = #gadw0001#60;
     |HAZ ClauDefecto;
     #gadw0001#62 = aClau340;
|FPRC;

|PROCESO Tipo66C10; |TIPO 66;
     efFechaIVA = #gadw0001#4;
     |HAZ SelecTipoIVA;
     #gadw0001#10 = enLineaIVA; |PINTA #gadw0001#10;
|FPRC;

|PROCESO Tipo0C10; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     efFechaIVA = #gadw0001#4; enLineaIVA = #gadw0001#10;
     |HAZ SacaIVA;

     #gadw0001#20 = eaCtaIVA;
     #gadw0001#22 = eaCtaREC;
     #gadw0001#24 = eaCtaDTO;

     |SI #gadw0001#19 = "N";
         |SI dCtaNoD ! "";
             #gadw0001#20 = dCtaNoD;
             #gadw0001#22 = dCtaNoD;
         |SINO;
             #gadw0001#20 = #gadw0001#17;
             |SI #gadw0001#15 ! 0; #gadw0001#20 = #gadw0001#17; |FINSI;
         |FINSI;
     |FINSI;

     |SI #gadw0001#19 = "I";
         #gadw0001#20 = "";
         #gadw0001#22 = 0;
     |FINSI;

     emCta = 0;
     eaCuenta = #gadw0001#20; |HAZ SacaNivel; #gadw0001#21 = enNivel;
     eaCuenta = #gadw0001#22; |HAZ SacaNivel; #gadw0001#23 = enNivel;
     eaCuenta = #gadw0001#24; |HAZ SacaNivel; #gadw0001#25 = enNivel;
|FPRC;

|PROCESO ImprContra;
     |QBF aCPartida;
     |SI aCPartida ! "";
         #gadw0001#17 = aCPartida;
         |PINTA #gadw0001#17;
         emCta    = 0;
         eaCuenta = #gadw0001#17;
         |HAZ SacaNivel;
         #gadw0001#18 = enNivel;
         |HAZ LeeCuenta;
     |FINSI;

     |SI eswCta ! 0; |O aCPartida = "";
         #gadw0001#17 = eaCtaIVA;
         |PINTA #gadw0001#17;
         emCta    = 0;
         eaCuenta = #gadw0001#17;
         |HAZ SacaNivel;
         #gadw0001#18 = enNivel;
         |HAZ LeeCuenta;
     |FINSI;

     |SI eswCta ! 0;
         |C_M #gadw0001#17,1,"S";
     |SINO;
         #gadw0001#28 = #cacuenta#2; |PINTA #gadw0001#28;
     |FINSI;

     |SI nCTiva ! 0;
         |SI #gadw0001#10 ! nCTiva;
             #gadw0001#10 = nCTiva; |PINTA #gadw0001#10;
             nNoSalta = 1; |HAZ Tipo0C10; nNoSalta = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeLaContra;
     |ABRE #caclipro;
     |SI aTipoIVA = "R";
         #caclipro#23 = "C";
     |SINO;
         #caclipro#23 = "P";
     |FINSI;
     aCPartida = "";
     nCTiva    = 0;
     swclipro  = 0;
     #caclipro#10 = #gadw0001#5;
     #caclipro#11 = #gadw0001#6;
     |LEE 000#caclipro.=;
     |SI FSalida = 0;
         aCPartida = #caclipro#21; |QBF aCPartida;
         nCTiva    = #caclipro#42;
         |SI aCPartida = ""; |O nCTiva = 0; swclipro = 1; |FINSI;
     |FINSI;
     |CIERRA #caclipro;
     |HAZ ImprContra;
|FPRC;

|PROCESO Tipo6C17; |TIPO 6;
     |C_M #gadw0001#Campo#, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |SI FSalida = 10; || ... extractos
         ext1 = #gadw0001#5;          || cuenta
         ext2 = #gadw0001#6;          || digito
         |SUB_EJECUTA_NP "caextrap";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI Campo = 40; |Y #gadw0001#49 = "N"; |ACABA; |FINSI;

     eaCuenta = #gadw0001#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntosX;
     #gadw0001#Campo# = eaCuenta;
     |PINTA #gadw0001#Campo#;

     |SI #gadw0001#Campo# = "            ";
         |MENAV "0000Introduzca una cuenta";
         |ERROR;
     |FINSI;
|FPRC;

|CALCULO CuentaCobro;
    |SI #gadw0001#49 ! "N";
        #gadw0001#41 = #cacuenta#1;
        #gadw0001#42 = #cacuenta#2;
        |SI #gadw0001#49 = "T";
            #gadw0001#43 = dConCEf;
            #gadw0001#44 = dDesCEf;
        |SINO;
            #gadw0001#43 = dConCar;
            #gadw0001#44 = dDesCar;
       |FINSI;
   |FINSI;
|FCAL;

|PROCESO Tipo7C17; |TIPO 7;
     aContenido = #gadw0001#Campo#;
|FPRC;

|PROCESO Tipo0C17; |TIPO 0;
     |C_M #gadw0001#Campo#, 0, aAlfa;
     |SI aAlfa = "N";
         |ACABA;
     |FINSI;

     nCamb = 0;
     |SI aContenido ! #gadw0001#Campo#;
         nCamb = 1;
     |FINSI;

     emCta    = 1;
     eaCuenta = #gadw0001#Campo#;
     |HAZ SacaNivel;
     |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
     nNume1 = Campo + 1;
     #gadw0001#nNume1# = enNivel;

     |HAZ LeeCuenta;
     |SI eswCta ! 0; |ACABA; |FINSI;

     enConcepto = #gadw0001#7;
     |HAZ FiltraCtaIG;
     #gadw0001#28 = #cacuenta#2; |PINTA #gadw0001#28;

     |SI nCamb = 1;
         |HAZ CtrlDesg;
     |FINSI;
|FPRC;

|PROCESO Tipo66C45; |TIPO 66;
     |SI eaDepar = "N"; |ACABA; |FINSI;

     eOpDep      = 1;                            || 1 = Consulta pantalla
     enActividad = #gadw0001#45;
     eaCodDep    = #gadw0001#45;
     |HAZ Actividad;

     #gadw0001#45 = enActividad;   |PINTA #gadw0001#45;
|FPRC;

|PROCESO Tipo0C45; |TIPO 0;
     |SI eaDepar = "N"; |ACABA; |FINSI;
     |SI FSalida = 2;   |ACABA; |FINSI;

     eOpDep      = 0;                            || 1 = Consulta pantalla
     enActividad = #gadw0001#45;
     eaCodDep    = #gadw0001#45;
     |HAZ Actividad;
     |SI eswLect = 1;
         |SI enMasivo = 0;
             |MENAV "    Error.! No Existe Actividad / Departamento";
             |C_M #gadw0001#Campo#, 1, "S";
             |ERROR;
         |SINO;
             enError = 1;  |ACABA;
         |FINSI;
     |SINO;
         alfa1 = enActividad;
         |SI Haybasica = 1;
             enFilRegIVA = 1;
             enConcepto  = #gadw0001#7;
             |HAZ FilRegimenIVA;
             alfa1 = ("00" + alfa1) % A02;
         |FINSI;

         #gadw0001#45 = eaCodDep;     |PINTA #gadw0001#45;
         #gadw0001#46 = eaNombreAct;  |PINTA #gadw0001#46;
         |SI efActFin > "01.01.1900"; |Y snFilBa = "S";
             |SI enMasivo = 0;
                 aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
                 |CONFI aAlfa1;
                 |SI FSalida ! 0;
                     |ERROR;
                     |ACABA;
                 |FINSI;
             |SINO;
                 enError = 1;  |ACABA;
             |FINSI;
         |FINSI;

         |SI eaEsCom = "S";
             |SI enMasivo = 0;
                 |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Facturas ? ";
                 |SI FSalida ! 0;
                     |ERROR;
                     |ACABA;
                 |FINSI;
             |SINO;
                 enError = 1;  |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     enAParam = #gadw0001#45;
     nIvaInc = 1;
     |HAZ LeeDefIVA;
     |SI dDeduc = "N";
         #gadw0001#19 = "N";
         |PINTA #gadw0001#19;
     |FINSI;
|FPRC;

|PROCESO Tipo66C47; |TIPO 66;
     |SI eaSubde = "N"; |ACABA; |FINSI;

     eOpSub      = 1;                            || 1 = Consulta pantalla
     enActividad = #gadw0001#45;
     enConcepto  = #gadw0001#7;
     eaCodSubdep = #gadw0001#47;
     |HAZ SubActividad;

     #gadw0001#47 = eaCodSubdep;  |PINTA #gadw0001#47;
|FPRC;

|PROCESO Tipo0C47; |TIPO 0;
     |SI eaSubde = "N"; |ACABA; |FINSI;

     eOpSub      = 0;
     enActividad = #gadw0001#45;
     enConcepto  = #gadw0001#7;
     eaCodSubdep = #gadw0001#47;
     |SI enQue = 0;
         enQue = 1;
     |FINSI;
     |HAZ SubActividad;
     enQue = 0;

     #gadw0001#47 = eaCodSubdep;  |PINTA #gadw0001#47;
     #gadw0001#48 = eaNomSubdep;  |PINTA #gadw0001#48;
|FPRC;

|PROCESO CalCuenta;
     asteris = 0;
     muestra = dCtaCEf; |QBF muestra;
     alfa1   = dCtaCEf; |QBF alfa1;
     alfa2   = alfa1 % 0;
     longi   = alfa2;            || 'longi' sirve despues (no tocar)
     nNume3  = (longi * 100) + 1;
     alfa2   = alfa1 % nNume3;
     |SI alfa2 = "*";
         nNume3    = 99 + longi;
         muestra   = alfa1 % nNume3;
         asteris   = 1;
     |FINSI;

     nSwLaC = 0;
     |PARA nNume4 = 1; |SI nNume4 [ longi; |HACIENDO nNume4 = nNume4 + 1;
           nNume1 = (nNume4 * 100) + 1;
           alfa3  = alfa1 % nNume1;
           |SI alfa3 = "C";  nSwLaC = 1; |FINSI;
     |SIGUE;

     |SI nSwLaC = 1;
         alfa5 = muestra % 0;
         nNume5 = alfa5;
         alfa5 = "";
         |PARA nPara1 = 1; |SI nPara1 [ nNume5; |HACIENDO nPara1 = nPara1 + 1;
               nNume6 = (nPara1 * 100) + 1;
               alfa6  = muestra % nNume6;
               |SI alfa6 = "C";
                   alfa6 = #gadw0001#5 % nNume6;
               |FINSI;
               alfa5 = alfa5 + alfa6;
        |SIGUE;

        muestra = alfa5;
    |FINSI;

     nNume2 = MaximoDigitos - (longi - 1);
     |SI asteris = 1;
         nNume2 = (100 * longi) + nNume2;
         alfa1 = #gadw0001#5 % nNume2;
         muestra = muestra + alfa1;             || si es "*"
     |FINSI;

     #gadw0001#40 = muestra;
|FPRC;

|PROCESO Tipo0C49;  |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     #cacuenta#0 = "";

     alfa1 = Contenido;
     |SI alfa1 ! #gadw0001#49; |Y #gadw0001#49 = "T";
         #gadw0001#40 = "";
     |FINSI;
     |HAZ PintaCobro;

     |SI #gadw0001#49 = "N";
         #gadw0001#40 = ""; #gadw0001#41 = 0;
         #gadw0001#42 = ""; #gadw0001#43 = 1; #gadw0001#44 = "";
         |ACABA;
     |FINSI;

     alfa1 = "S";
     |SI #gadw0001#49 ! "T"; alfa1 = "N"; |FINSI;
     |SI #gadw0001#49 = "T"; alfa1 = snCtaEf; |FINSI;
     |SI #gadw0001#49 = "P"; alfa1 = snCtaCa; |FINSI;

     |C_M #gadw0001#40, 1, alfa1;

     |SI #gadw0001#49 ! "N";
         |SI #gadw0001#40 = doce; #gadw0001#40 = dCtaCar; |FINSI;
         |SI enMasivo = 0;
             |SI dCtaCar = ""; |Y snCtaCa = "N";
                 |MENAV "    Error, NO esta INFORMADA LA CUENTA DE COBRO/PAGO. No puede crear Asiento. ";
                 #gadw0001#49 = "N"; |PINTA #gadw0001#49;
                 |HAZ PintaCobro;
                 |ERROR;
                 |ACABA;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #gadw0001#40 = doce;
             |HAZ CalCuenta;
         |SINO;
             |C_M #gadw0001#Campo#,0,alfa1;
             |SI alfa1 = "S"; alfa1 = snCtaEf; |FINSI;
             |C_M #gadw0001#40,1,alfa1;
         |FINSI;
     |FINSI;
     |PINTA #gadw0001#40;

     |HAZ CuentaCobro;
|FPRC;

|PROCESO Tipo66C51;  |TIPO 66;
     eaFiCon    = eaFichIRPF;
     enConcepto = #gadw0001#51;
     |HAZ VerConcepto;
     #gadw0001#51 = enConcepto;
     |PINTA #gadw0001#51;
|FPRC;

|PROCESO Tipo0C51;  |TIPO 0;
     |C_M #gadw0001#51, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     |SI #gadw0001#51 = 0;
         |SI enMasivo = 0;
             |ERROR;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #gadw0001#51 < nDCIrpf; |O #gadw0001#51 > nHCIrpf;
         |SI snFiltr ! "X";
             |SI enMasivo = 0;
                |MENAV "    Error, Concepto Contable no Correcto ";
             |FINSI;
         |FINSI;
         |SI snFiltr = "S";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     enLibIVA  = #gadw0001#0;
     enFilConc = 3;        || Concepto de IRPF
     enConcepto = #gadw0001#51;
     |HAZ FiltroConcepto;  |SI eswLect ! 0; |ACABA; |FINSI;

     |SI snFiMod = "S";
         |SI #gadw0001#35 ! 0;
             enPanMod  = 0;
             eaFecMod  = #gadw0001#4;
             enPerMod = #gadw0001#31;
             |HAZ ConsulPlan;
             |SI enExiMod = 0; |Y snSeMod = "N";
                 |ERROR;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #gadw0001#51 ! nAnteriorIRPF;
         #gadw0001#52 = #dsmom030#1; |PINTA #gadw0001#52;
     |FINSI;

     #gadw0001#36 = eaCtaIVA;
     emCta    = 0;
     eaCuenta = #gadw0001#36; |HAZ SacaNivel; #gadw0001#37 = enNivel;

     |SI #dsmom030#38 = 180; |Y aTipoIVA = "S";
         |SI #gadw0001#62 ! "R"; |Y #gadw0001#62 ! "D";
             FSalida = 0;
             |SI enMasivo = 0;
                 |CONFI "    SFra con Retencion Mod.180 y Clave 340 diferente a <R>. Modificarla ?";
             |FINSI;
             |SI FSalida = 0;
                 #gadw0001#62 = "R"; |PINTA #gadw0001#62;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO adapta2_c;  ||El concepto
     aDCon1 = "";
     |SI aDCon2 = "S";
         aDCon1 = #gadw0001#26; |QBF aDCon1;
         |SI aDCon1 ! ""; aDCon1 = aDCon1 + aSepSer; |QBF aDCon1; |FINSI;
     |FINSI;                                         || Serie
     |SI aDCon2 = "F";
         aDCon1 = #gadw0001#2; |QBF aDCon1;
         |SI aNumIzq = "S";
             aDCon1 = ("000000" + aDCon1) % -106;
         |FINSI;
     |FINSI;                                         || Factura
     |SI aDCon2 = "C";
         aDCon1 = #gadw0001#5; |QBF aDCon1;
     |FINSI;                                         || Cuenta Cliente
     |SI aDCon2 = "N";
         aDCon1 = #gadw0001#27; |QBF aDCon1;
     |FINSI;                                         || Nombre Cliente
     |SI aDCon2 = "R";
         |SI #gadw0001#53 ! "                    ";
             aDCon1 = #gadw0001#53; |QBF aDCon1;
         |FINSI;
     |FINSI;                                         || Referencia
     |SI aDCon2 = "P";
         aDCon1 = #gadw0001#53;
         |SI aTipoIVA = "S";
             |HAZ EsComersan;
             |SI FSalida = 0; aDCon1 = #gadw0001#72;  |FINSI;
         |FINSI;
         |QBF aDCon1;
     |FINSI;                                         || Referencia Comersan

     |SI aDCon1 ! "";
         |SI aDCon2 = "F";
             aAlfa7 = aAlfa2 - "S";
             |SI aAlfa7 ! aAlfa2; |Y #gadw0001#26 > "     ";
                 |ACABA;
             |FINSI;
         |FINSI;
         aDCon1 = " " + aDCon1;
     |FINSI;
|FPRC;

|PROCESO Continuar;
     nContinuar = 1;
     |PTEC 806;
|FPRC;

|PROCESO Salir;
     |PTEC 807;
|FPRC;

|PROCESO ActualizaNIF;
     |SI nCampo ! 4;
         aAlfa = #regisnif@#nCampo#;  |QBF aAlfa;
         |SI aAlfa = "";  |O aAlfa = "0";
             #regisnif@#nCampo# = aValor;
         |FINSI;
     |SINO;
         |SI #regisnif@#4 = 0;  |Y #regisnif@#5 = 0;
             aAlfa1 = aValor % 102;
             aAlfa2 = aValor % 303;
             #regisnif@#4 = aAlfa1;
             #regisnif@#5 = aAlfa2;

             enCodProv = #regisnif@#4;  |HAZ LeeProvincia;
             #regisnif@#7 = eaProvincia;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaNIF;
     |HAZ LeeNifs;

     |ABRE #regisnif@;
     #regisnif@#0 = #gadw0001#30;
     |LEE 101#regisnif@.=;
     |SI FSalida ! 0;
         |DDEFECTO #regisnif@;
         #regisnif@#0 = #gadw0001#30;
         |GRABA 020#regisnif@.b;
     |FINSI;

     |SI aTipoIVA = "R";
         nCampo = 1;   aValor = #facturas@#4;  |HAZ ActualizaNIF;
         nCampo = 12;  aValor = #facturas@#5;  |HAZ ActualizaNIF;
     |FINSI;

     |SI aTipoIVA = "S";
         nCampo = 1;   aValor = #facturas@#4;   |HAZ ActualizaNIF;
         nCampo = 12;  aValor = #facturas@#5;   |HAZ ActualizaNIF;
         nCampo = 2;   aValor = #facturas@#51;  |HAZ ActualizaNIF;
         nCampo = 6;   aValor = #facturas@#53;  |HAZ ActualizaNIF;
         nCampo = 8;   aValor = #facturas@#54;  |HAZ ActualizaNIF;
         nCampo = 17;  aValor = #facturas@#55;  |HAZ ActualizaNIF;
         nCampo = 4;   aValor = #facturas@#52;  |HAZ ActualizaNIF;
     |FINSI;

     |GRABA 020#regisnif@.a;
     |LIBERA #regisnif@;
     |CIERRA #regisnif@;
|FPRC;

|PROCESO CreaCuenta;
     |VENTANA 0501, 2599, -1, 16, "No existe la cuenta contable correspondiente a este CIF/NIF. Elija con INTRO la cuenta a crear.";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     eaCodNif  = #gadw0001#30; |QBF eaCodNif;
     eaCuenta  = "F*+";
     eaNomCta  = #regisnif@#1;
     |HAZ FiltraPuntosX;
     |SI eaCuenta = "";
         enError = 1;
         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVentTrab;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVentTrab;

         |ACABA;
     |FINSI;

     |ABRE #cacuenta;
     |DDEFECTO #cacuenta;

     enNivel = dig3;
     #cacuenta#0    = eaCuenta;
     #cacuenta#1    = enNivel;
     #cacuenta#3    = "S";

     |SI aTipoIVA = "R";  #cacuenta#2 = #facturas@#4;  |FINSI;
     |SI aTipoIVA = "S";  #cacuenta#2 = #facturas@#4;  |FINSI;

     nMensa   = 1;
     nMensa9  = 1;
     |HAZ defect1;
     #cacuenta#56   = mesdes;
     #cacuenta#57   = meshas;

     |GRABA 020#cacuenta.n;
     |LIBERA #cacuenta;
     |CIERRA #cacuenta;

     |DDEFECTO #caclipro;
     |ABRE #caclipro;
     |SELECT #1#caclipro;

     |SI aTipoIVA = "R";  #caclipro#23 = "C";  |FINSI;
     |SI aTipoIVA = "S";  #caclipro#23 = "P";  |FINSI;

     #caclipro#10 = #cacuenta#0;
     #caclipro#0  = #caclipro#10;
     #caclipro#9 = #regisnif@#0;
     #caclipro#1 = #regisnif@#1;
     Comodin = #regisnif@#9; |QBF Comodin;
     |SI Comodin = "";
         #caclipro#2 = #regisnif@#2;
     |SINO;
         #caclipro#2 = Comodin + " " + #regisnif@#2;
     |FINSI;
     Comodin = #caclipro#2; |QBF Comodin;
     #caclipro#2    = Comodin + ", " + #regisnif@#3;
     Comodin = #caclipro#2; |QBF Comodin;
     #caclipro#2    = Comodin + " " + #regisnif@#10;
     Comodin = #caclipro#2; |QBF Comodin;
     #caclipro#2    = Comodin + " " + #regisnif@#11;

     #caclipro#3    = #regisnif@#4;
     #caclipro#4    = #regisnif@#5;
     #caclipro#5    = #regisnif@#7;
     #caclipro#6    = #regisnif@#6;
     #caclipro#7    = #regisnif@#8;
     #caclipro#8    = #regisnif@#17;
     #caclipro#24   = #regisnif@#12;

     #caclipro#44 = #caclipro#2;
     #caclipro#45 = #caclipro#3;
     #caclipro#46 = #caclipro#4;
     #caclipro#47 = #caclipro#5;
     #caclipro#48 = #caclipro#6;
     #caclipro#27 = aPCorreo;
     #caclipro#49 = #caclipro#27
     #caclipro#50 = #caclipro#25;

     |GRABA 020#caclipro.n;
     |LIBERA #caclipro;
     |CIERRA #caclipro;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;

     |MENAV "0000Creada nueva cuenta contable, revise la cuenta";
|FPRC;

|PROCESO CargaDefectos;
     enAParam = #gadw0001#45;
     nIvaInc = 1;
     |HAZ LeeDefIVA;

     #gadw0001#26 = dSerie;
     #gadw0001#50 = aTipoIVA;
     #gadw0001#19 = dDeduc;
     #gadw0001#32 = dInver;

     |SI #gadw0001#34 = 0;  |Y #gadw0001#35 = 0;
         snReten = "N";
         snDIrpf = "N";

         #gadw0001#55   = "N";
         #gadw0001#56   = "N";
     |FINSI;

     |SI aTipoIVA = "R";  #gadm0001#0 = "C";  |FINSI;
     |SI aTipoIVA = "S";  #gadm0001#0 = "P";  |FINSI;

     #gadm0001#1 = #gadw0001#5;
     |LEE 000#gadm0001.=;
     |SI FSalida = 0;
         #gadw0001#5  = #gadm0001#1;
         #gadw0001#7  = #gadm0001#3;
         #gadw0001#17 = #gadm0001#4;
         #gadw0001#51 = #gadm0001#5;
         #gadw0001#0  = #gadm0001#7;
         #gadw0001#45 = #gadm0001#8;
         #gadw0001#47 = #gadm0001#9;
         #gadw0001#19 = #gadm0001#10;

         |SI #gadm0001#11 ! "     ";
             #gadw0001#26 = #gadm0001#11;
         |FINSI;
     |FINSI;

     enAParam = #gadw0001#45;
     nIvaInc = 1;
     |HAZ LeeDefIVA;

     |SI dDeduc = "N";
         #gadw0001#19 = "N";
     |FINSI;

     |HAZ BuscaLibro;
|FPRC;

|PROCESO ModLosDefectos;
     enAParam = #gadw0001#45;
     nIvaInc = 1;
     |HAZ LeeDefIVA;

     |SI dDeduc = "N";
         #gadw0001#19 = "N";
     |FINSI;

     |C_M #gadw0001#26, 1, snSerie;  || Modificables S/N
     |C_M #gadw0001#0,  1, snLibro;
     |C_M #gadw0001#7,  1, snConc1;
     |C_M #gadw0001#8,  1, snDesc1;
     |C_M #gadw0001#32, 1, snInver;
     |C_M #gadw0001#19, 1, snDeduc;

     |SI #gadw0001#34 = 0;  |Y #gadw0001#35 = 0;
         snReten = "N";
         snDIrpf = "N";
     |FINSI;

     |C_M #gadw0001#52, 1,snDIrpf;
     |C_M #gadw0001#59, 1,snBIrpf;

     alfa1 = #caivaasi#20;        ||Departamento
     |SI eaDepar = "N"; alfa1 = "N"; |FINSI;
     |C_M #gadw0001#45, 1, alfa1;
     alfa1 = #caivaasi#68;        ||Subdepartamento
     |SI eaSubde = "N"; alfa1 = "N"; |FINSI;
     |C_M #gadw0001#47, 1, alfa1;

     alfa1 = #caivaasi#28;        ||Periodo Modifica o Calcular
     |C_M #gadw0001#31, 1, alfa1;

     alfa1 = #caivaasi#70;        ||Cuenta Base
     |C_M #gadw0001#17,1, alfa1;

     |C_M #gadw0001#49,1,snCoPa;

     |SI enNumAct > 1; |C_M #gadw0001#57, 1,"S"; |FINSI;

     |HAZ PintaCobro;
|FPRC;

|PROCESO gadm0003A;
     #gadm0003#2  = #gadw0001#7;
     #gadm0003#3  = #gadw0001#8;
     #gadm0003#5  = #gadw0001#33;
     #gadm0003#6  = #gadw0001#45;
     #gadm0003#7  = #gadw0001#47;
     #gadm0003#10 = #gadw0001#55;
     #gadm0003#11 = #gadw0001#56;
     #gadm0003#13 = #gadw0001#46;
     #gadm0003#14 = #gadw0001#48;

     |ABRE #cacuenta;
     #cacuenta#0 = #gadm0003#4;
     |LEE 000#cacuenta.=;
     |SI FSalida ! 0;  |DDEFECTO #cacuenta;  |FINSI;
     |CIERRA #cacuenta;

     #gadm0003#12 = #cacuenta#2;

     |GRABA 020#gadm0003.a;
     |LIBERA #gadm0003;

     |SI #gadm0003#1 = 1;
         #gadw0001#17 = #gadm0003#4;
         #gadw0001#28 = #gadm0003#12;
     |FINSI;
|FPRC;

|DEFBUCLE gadm0003A;
     #gadm0003#1;
     ;
     nEmp48, #gadw0001#69, 01;
     nEmp48, #gadw0001#69, 99;
     be;
     NULL, gadm0003A;
|FIN;

|PROCESO CargaFichero_gadm0002;
     |ABRE #gadm0004;
     |DDEFECTO #gadm0004;
     |LEE 000#gadm0004.p;
     nConceIRPF = #gadm0004#1;
     aDesIRPF   = #gadm0004#2;
     |CIERRA #gadm0004;

     enError  = 0;
     aPCorreo = "";
     nHay5    = 0;

     |SI aTipoIVA = "S";
         aPCorreo = #facturas@#56;
     |FINSI;

     |DDEFECTO #gadw0001;
     #gadw0001#69 = #facturas@#0;
     #gadw0001#4  = #facturas@#15;

     |SI #facturas@#79 ! 0;
         #gadw0001#2  = #facturas@#79;
     |FINSI;

     |SI aTipoIVA = "S";  #gadw0001#7  = 600;  |FINSI;
     |SI aTipoIVA = "R";  #gadw0001#7  = 700;  |FINSI;

     #gadw0001#12 = #facturas@#21;
     #gadw0001#13 = #facturas@#22;
     #gadw0001#14 = #facturas@#23;
     #gadw0001#15 = #facturas@#24;
     #gadw0001#16 = #facturas@#25;
     #gadw0001#27 = #facturas@#4;
     #gadw0001#29 = #facturas@#28;
     #gadw0001#30 = #facturas@#2;
     #gadw0001#32 = #facturas@#18;
     #gadw0001#45 = ("00" + #facturas@#1) % -102;
     |SI #gadw0001#45 = "00";  #gadw0001#45 = "01";  |FINSI;
     #gadw0001#49 = dCoPag;

     |SI #gadw0001#49 = " ";  #gadw0001#49 = "N";  |FINSI;

     #gadw0001#53 = #facturas@#13;
     #gadw0001#60 = #facturas@#9;
     #gadw0001#61 = #facturas@#16;
     #gadw0001#62 = #facturas@#8;
     #gadw0001#63 = #facturas@#11;
     #gadw0001#64 = #facturas@#12;
     #gadw0001#67 = #facturas@#28;
     #gadw0001#68 = #facturas@#14;
     #gadw0001#5  = #facturas@#80;

     |HAZ CalculaPeriodo;
     |SI enError = 1;  |ACABA;  |FINSI;

     |SI #facturas@#26 ! 0;
         #gadw0001#39 = #facturas@#71;
         |SI #gadw0001#39 = "F";
              #gadw0001#59 = #gadw0001#12 + #gadw0001#14 + #gadw0001#16;
         |SINO;
              #gadw0001#59 = #gadw0001#12;
         |FINSI;
         #gadw0001#34 = #facturas@#26;
         #gadw0001#35 = #facturas@#27;

         |SI enMasivo = 0;
             |MENAV "0000Factura con retencion, revise el concepto.";
         |FINSI;
     |FINSI;

     enLineaIVA = 0;
     efFechaIVA = #gadw0001#4;
     enPorcIVA  = #gadw0001#13;
     enPorcREC  = #gadw0001#15;
     eaCtaIVA   = "";
     eaCtaREC   = "";
     |HAZ BuscaTipoIVA;
     #gadw0001#10 = enLineaIVA;

     |HAZ CreaNIF;

     |SI #gadw0001#5 = "            ";
         |ABRE #caclipro;
         |SELECT #4#caclipro;
         #caclipro#9 = #gadw0001#30;
         |LEE 000#caclipro.];
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #caclipro#9 ! #gadw0001#30;  |SAL;  |FINSI;

              |SI aTipoIVA = "R";
                  |SI #caclipro#23 = "C";
                      #gadw0001#5  = #caclipro#10;
                      #gadw0001#17 = #caclipro#21;
                      #gadw0001#51 = #caclipro#52;

                      |SAL;
                  |FINSI;
              |FINSI;

              |SI aTipoIVA = "S";
                  |SI #caclipro#23 = "P";
                      #gadw0001#5  = #caclipro#10;
                      #gadw0001#17 = #caclipro#21;
                      #gadw0001#51 = #caclipro#52;

                      |SAL;
                   |FINSI;
              |FINSI;

              |LEE 000#caclipro.s;
         |SIGUE;

         |SELECT #1#caclipro;
         |CIERRA #caclipro;
     |FINSI;

     |SI enMasivo = 1;
         |SI aTipoIVA = "R";  #gadm0001#0 = "C";  |FINSI;
         |SI aTipoIVA = "S";  #gadm0001#0 = "P";  |FINSI;

         #gadm0001#1 = #gadw0001#5;
         |LEE 000#gadm0001.=;
         |SI FSalida ! 0;
             |DDEFECTO #gadm0001;
             enError = 1;
         |FINSI;

         |SI #gadm0001#2 = "N";
             enError = 1;
         |FINSI;

         aSerFac = #facturas@#78;

         |ABRE #gadm0005;
         |HAZ gadm0005;
         |CIERRA #gadm0005;

         |SI nHay5 = 1;
             enError = 0;
         |FINSI;

         |SI enError = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     swpcta        = 1;
     aAlfa         = #gadw0001#5;   |QBF aAlfa;
     |SI aAlfa = "";
         |SI enMasivo = 1;
             enError = 1;
             |ACABA;
         |FINSI;

         |HAZ CreaCuenta;
         #gadw0001#5 = #caclipro#10;

         |SI enError = 1;
             |MENAV "0000Creaci¢n de la cuenta cancelada.";
             |ACABA;
         |FINSI;
     |FINSI;

     |HAZ CargaDefectos;

     |SI #gadw0001#51 = 0;
         |SI #gadw0001#50 = "S";
               #gadw0001#51 = nConceIRPF;
               #gadw0001#52 = aDesIRPF;
         |FINSI;

         |SI #gadw0001#50 = "R";
             #gadw0001#51 = 500;
             #gadw0001#52 = "RETENCIONES IRPF DEUDORAS";
         |FINSI;
     |FINSI;

     |SI nHay5 = 1;
         #gadw0001#51 = nConceIRPF;
         #gadw0001#52 = aDesIRPF;
     |FINSI;

     #gadw0001#3 = 1;
     #gadw0001#0 = dLibro;
     enLibIVA    = dLibro;

     |SI #gadw0001#53 = "                    ";
         |HAZ EsComersan;
         |SI FSalida = 0; |Y aTipoIVA = "S";
             |SI eaRefer = "N"; enLgRef = #caivaasi#117; |FINSI;
              #gadw0001#53 = #gadw0001#26 + "-." + #gadw0001#2;
              r_entra = entrada;
              r_alfa1 = #gadw0001#53;
              |HAZ r1_punto;
              #gadw0001#53 = r_alfa1;
         |FINSI;
     |FINSI;

     |HAZ EsComersan;
     |SI FSalida = 0; |Y aTipoIVA = "S";
         #gadw0001#72 = #facturas@#13;
     |FINSI;

     |HAZ Tipo0C7;
     |HAZ Tipo0C10;
     |HAZ Tipo0C45;
     |SI enError = 1;  |ACABA;  |FINSI;

     enQue = 2;  |HAZ Tipo0C47;
     |HAZ Tipo0C49;
     |HAZ Tipo0C51;

     |SI nHay5 = 1;
         aSerFac = #facturas@#78;

         |ABRE #gadm0005;
         |HAZ gadm0005;
         |CIERRA #gadm0005;
     |FINSI;

     |SI aTipoIVA = "R";  #gadm0001#0 = "C";  |FINSI;
     |SI aTipoIVA = "S";  #gadm0001#0 = "P";  |FINSI;

     #gadm0001#1 = #gadw0001#5;
     |LEE 101#gadm0001.=;
     |SI FSalida ! 0;
         |DDEFECTO #gadm0001;

         |SI aTipoIVA = "R";  #gadm0001#0 = "C";  |FINSI;
         |SI aTipoIVA = "S";  #gadm0001#0 = "P";  |FINSI;

         #gadm0001#1  = #gadw0001#5;
         #gadm0001#2  = "N";
         #gadm0001#3  = #gadw0001#7;
         #gadm0001#4  = #gadw0001#17;
         #gadm0001#5  = #gadw0001#51;
         #gadm0001#6  = #gadw0001#49;
         #gadm0001#7  = #gadw0001#0;
         #gadm0001#8  = #gadw0001#45;
         #gadm0001#9  = #gadw0001#47;
         #gadm0001#10 = "S";
         #gadm0001#11 = #gadw0001#26;

         |GRABA 020#gadm0001.n;
     |FINSI;
     |LIBERA #gadm0001;

     |SI eaPathDPNTM ! "";
         |SI eaTipoCtb ! "1";
             |SI aTipoIVA = "R";  nEmp48 = 1;  |FINSI;
             |SI aTipoIVA = "S";  nEmp48 = 2;  |FINSI;

             |BUCLE gadm0003A;
         |FINSI;
     |FINSI;

     |DDEFECTO #gadm0006;
     |ABRE #gadm0006;
     #gadm0006#0 = #facturas@#56;
     |LEE 000#gadm0006.=;
     |SI FSalida = 0;
         #gadw0001#74 = #gadm0006#2;
     |FINSI;
     |CIERRA #gadm0006;

     |ABRE #caforpag;
     #caforpag#0 = #gadm0006#2;
     |LEE 000#caforpag.=;
     |SI FSalida ! 0;  |DDEFECTO #caforpag;  |FINSI;
     |CIERRA #caforpag;

     #gadw0001#49 = #caforpag#6;

     |SI #gadw0001#49 ! "N";
         |SI #gadw0001#40 = "            ";
             #gadw0001#40 = dCtaCar;
         |FINSI;

         #gadw0001#73 = #gadw0001#4;
         #gadw0001#43 = dConCar;
         #gadw0001#44 = dDesCar;
     |FINSI;

     |PARA nPara1 = 0; |SI nPara1 [ 75; |HACIENDO nPara1 = nPara1 + 1;
           #gadm0002#nPara1# = #gadw0001#nPara1#;
     |SIGUE;

     |GRABA 020#gadm0002.n;
     |LIBERA #gadm0002;
|FPRC;

|PROCESO GrabaPredeterminado;
     |ABRE #gadm0001;
     #gadm0001#1 = #gadw0001#5;
     |LEE 101#gadm0001.=;
     |SI FSalida ! 0;
         |DDEFECTO #gadm0001;

         |SI aTipoIVA = "R";  #gadm0001#0 = "C";  |FINSI;
         |SI aTipoIVA = "S";  #gadm0001#0 = "P";  |FINSI;

         #gadw0001#19 = "S";

         |GRABA 020#gadm0001.b;
     |FINSI;

     #gadm0001#1  = #gadw0001#5;
     #gadm0001#3  = #gadw0001#7;
     #gadm0001#4  = #gadw0001#17;
     #gadm0001#5  = #gadw0001#51;
     #gadm0001#6  = #gadw0001#49;
     #gadm0001#7  = #gadw0001#0;
     #gadm0001#8  = #gadw0001#45;
     #gadm0001#9  = #gadw0001#47;
     #gadm0001#10 = #gadw0001#19;
     #gadm0001#11 = #gadw0001#26;

     eaAuto = "N";
     |SI #gadm0001#2 = "N";
         |CONFI "0000SLo dejamos como autom tico";
         |SI FSalida = 0;
             #gadm0001#2  = "S";
             eaAuto       = "S";
         |FINSI;
     |SINO;
         |CONFI "0000NLo dejamos como manual";
         |SI FSalida = 0;
             #gadm0001#2 = "N";
         |FINSI;
     |FINSI;

     |GRABA 020#gadm0001.a;
     |LIBERA #gadm0001;
     |CIERRA #gadm0001;
|FPRC;

|PROCESO CreaVtos;
     enModoEsc = 1;
     |SI #gadw0001#49 = "S";
         |ACABA;
     |FINSI;

     enLinea = #gadw0001#1;
     libro   = #gadw0001#0;
     serie   = #gadw0001#26;
     orden   = #gadw0001#2;
     emision = #gadw0001#4;
     |SI #gadw0001#54 = "N";
         pesetas = #gadw0001#29;
     |SINO;
         pesetas = #gadw0001#12;
     |FINSI;
     cuenta = #gadw0001#5; eaCuenta = cuenta; |HAZ SacaNivel;
     digito = enNivel;
     enCyP  = #gadw0001#49;
     eaRef  = #gadw0001#53;
     |HAZ EsComersan;
     |SI FSalida = 0; |Y aTipoIVA = "S";
         aFraPrv = #gadw0001#72; |QBF aFraPrv;
         |SI aFraPrv ! "";  eaRef = aFraPrv; |FINSI;
     |FINSI;
     |SUB_EJECUTA_NP "caintvto;NOLINEAL";
|FPRC;

|PROCESO CuentaCont;
     |SI #gadw0001#2 ! 0;  |ACABA;  |FINSI;

     |SI enQSerie = 0;
         |ABRE #calibros;
         #calibros#0 = #gadw0001#0;
         |LEE 101#calibros.=;
         |SI FSalida = 0;
             nNumFactura  = #calibros#4;
             #calibros#4 = #calibros#4 + #calibros#3;
             |GRABA 020#calibros.a;
         |FINSI;
         |LIBERA #calibros;
         |CIERRA #calibros;
     |SINO;
         |ABRE #caivases;
         #caivases#0 = #gadw0001#26;
         #caivases#1 = aTipoIVA;
         |LEE 101#caivases.=;
         |SI FSalida = 0;
             nNumFactura  = #caivases#3;
             #caivases#3 = #caivases#3 + #caivases#4;
             |GRABA 020#caivases.a;
        |FINSI;
        |LIBERA #caivases;
        |CIERRA #caivases;
     |FINSI;

     #gadw0001#2 = nNumFactura;
|FPRC;

|PROCESO ActCliPro;
     |ABRE #caclipro;
     |SI aTipoIVA = "R";
         #caclipro#23 = "C";
     |SINO;
         #caclipro#23 = "P";
     |FINSI;
     #caclipro#10 = #gadw0001#5;
     #caclipro#11 = #gadw0001#6;
     |LEE 101#caclipro.=;
     |SI FSalida = 0;
         |SI aCPartida = ""; |Y #caivaasi#128 = "S";
             #caclipro#21 = #gadw0001#17;
         |FINSI;
         |SI nCTiva = 0; |Y #caivaasi#129 = "S";
             #caclipro#42 = #gadw0001#10;
         |FINSI;
         |GRABA 020#caclipro.a;
     |FINSI;
     |LIBERA #caclipro;
     |CIERRA #caclipro;
|FPRC;

|PROCESO adaptaC2;  ||El concepto en IVA
     aAlfa5 = "";
     aAlfa1 = #dsmom030#1;  |QBF aAlfa1;  || Descripcion
     |SI xx = 1; aAlfa2 = #caivaasi#45;  |FINSI;  ||Cliente
     |SI xx = 2; aAlfa2 = #caivaasi#130; |FINSI;  ||IVA
     |SI xx = 3; aAlfa2 = #caivaasi#96;  |FINSI;  ||IRPF
     |SI aAlfa2 = "=  "; aAlfa2 = #caivaasi#45; |FINSI;
     |QBF aAlfa2;  || lo que a¤ade

     aAlfa3 = aAlfa2 % 0;
     nDCon0 = aAlfa3;
     |PARA nDCon1 = 1; |SI nDCon1 [ nDCon0; |HACIENDO nDCon1 = nDCon1 + 1;
           aAlfa3 = nDCon1;
           aAlfa3 = aAlfa3 + "01";
           aDCon2 = aAlfa2 % aAlfa3;
           |HAZ adapta2_c;
           aAlfa5 = aAlfa5 + aDCon1;
     |SIGUE;
     aAlfa1  = aAlfa1 + aAlfa5;
|FPRC;

|PROCESO Filtro;
     swpcta = 0;
     swpase = 0;
     swmalo = 0;
     swRepite = 0;

     |SI #gadw0001#17 = doce;
         swmalo = 1;
         alfa1 = "    Error. Registro no valido. No Existe Cuenta Contrapartida";
     |FINSI;

     |SI #gadw0001#5 = doce;
         swmalo = 1;
         alfa1 = "    Error. Registro no valido. No Existe Cuenta Cliente/Proveeedor";
     |FINSI;

     |SI #gadw0001#4 < fec1; |O #gadw0001#4 > fec2;
         swmalo = 1;
         alfa1 = "    Error. Registro no valido. Fecha Incorrecta";
     |FINSI;

     |SI aElCero = "N"; |Y #gadw0001#12 = 0; |Y  #gadw0001#14 = 0;
          |Y #gadw0001#16 = 0; |Y #gadw0001#29 = 0; |Y  #gadw0001#35 = 0;
          swmalo = 1;
          alfa1 = "    Error. Factura de importe igual a 0";
     |FINSI;
|FPRC;

|PROCESO ColocaIVA;
     nSwYaTengoTipo = 0;

     nTipoIVA       = #gadw0001#10;
     |SI nTipoIVA ! 0;
         efFechaIVA = #gadw0001#4;
         enLineaIVA = nTipoIVA;
         |HAZ SacaIVA;
         |SI enPorcIVA = #gadw0001#13;
             #gadw0001#10 = nTipoIVA;
             nSwYaTengoTipo = 1;
         |FINSI;
     |FINSI;

     |SI nSwYaTengoTipo = 1;
         |ACABA;
     |FINSI;

     |ABRE #gadm0005;
     aClv1 = aTipoIVA;
     aClv2 = #gadw0001#26;
     |HAZ BuscaSerie;
     |CIERRA #gadm0005;

     |SI nOk = 1;
         nTIVA1 = #gadm0005#10;
         nTIVA2 = #gadm0005#11;
     |FINSI;

     nTipoIVA = nTIVA1;
     |SI nTipoIVA ! 0;
         efFechaIVA = #gadw0001#4;
         enLineaIVA = nTipoIVA;
         |HAZ SacaIVA;
         |SI enPorcIVA = #gadw0001#13;
             #gadw0001#10 = nTipoIVA;
             nSwYaTengoTipo = 1;
         |FINSI;
     |FINSI;

     |SI nSwYaTengoTipo = 1;
         |ACABA;
     |FINSI;

     nTipoIVA = nTIVA1;
     |SI nTipoIVA ! 0;
         efFechaIVA = #gadw0001#4;
         enLineaIVA = nTipoIVA;
         |HAZ SacaIVA;
         |SI enPorcIVA = #gadw0001#13;
             #gadw0001#10 = nTipoIVA;
             nSwYaTengoTipo = 1;
         |FINSI;
     |FINSI;

     |SI nSwYaTengoTipo = 1;
         |ACABA;
     |FINSI;

      enLineaIVA = 0;
      efFechaIVA = #gadw0001#4;
      enPorcIVA  = #gadw0001#13;
      enPorcREC  = #gadw0001#15;
      eaCtaIVA   = "";
      eaCtaREC   = "";
      |HAZ BuscaTipoIVA;
      #gadw0001#10 = enLineaIVA;
|FPRC;

|PROCESO BuscaLin;
     |ABRE #cainliva;
     |SELECT #1#cainliva;
     #cainliva#0 = #gadw0001#0;
     #cainliva#1 = 1000;
     |LEE 000#cainliva.];
     |SI FSalida = 0;
         |LEE 000#cainliva.a;
     |SINO;
         |LEE 000#cainliva.u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y #cainliva#0 = #gadw0001#0;
         nLinea = #cainliva#1 + 1;
     |FINSI;

     |SELECT #2#cainliva;
     #cainliva#0  = #gadw0001#0;
     #cainliva#26 = #gadw0001#26;
     #cainliva#2  = #gadw0001#2;
     #cainliva#3  = 99;
     |LEE 000#cainliva.];
     |SI FSalida = 0;
         |LEE 000#cainliva.a;
     |SINO;
         |LEE 000#cainliva.u;
     |FINSI;

     nRef = 1;
     |SI FSalida = 0;  |Y #cainliva#0  = #gadw0001#0;
                       |Y #cainliva#26 = #gadw0001#26;
                       |Y #cainliva#2  = #gadw0001#2;
         nRef = #cainliva#3 + 1;
     |FINSI;
     |SELECT #1#cainliva;
     |CIERRA #cainliva;

     #gadw0001#1  = nLinea;
     #gadw0001#3  = nRef;
|FPRC;

|PROCESO ActualizaEsto;
     |HAZ BuscaLin;

     |SI nSwHazDesglose = 0;
          #gadw0001#67 = #gadw0001#29;
     |FINSI;

     #gadw0001#65 = #gadw0001#5;
     #gadw0001#66 = #gadw0001#17;

     enLineaIVA = 0;
     efFechaIVA = #gadw0001#4;
     enPorcIVA  = #gadw0001#13;
     enPorcREC  = #gadw0001#15;
     eaCtaIVA   = "";
     eaCtaREC   = "";

     |HAZ ColocaIVA;

     |SI swclipro = 1;
         |ABRE #caivaasi;
         |DDEFECTO #caivaasi;
         |LEE 000#caivaasi.p;
         |CIERRA #caivaasi;
         |SI #caivaasi#128 = "S"; |O #caivaasi#129 = "S";
             |HAZ ActCliPro;
         |FINSI;
     |FINSI;

     swclipro = 0;

     |SI #caivaasi#1 = "S";
         |HAZ CreaVtos;
     |FINSI;

     |SI #caivaasi#131 = "S";
         |ABRE #dsmom030;
         #dsmom030#0 = #gadw0001#7;
         |LEE 000#dsmom030.=;
         nCampo = 8;   xx = 1;  |HAZ adaptaC2;  #gadw0001#nCampo# = aAlfa1;

         #dsmom030#0 = #gadw0001#51;
         |LEE 000#dsmom030.=;
         nCampo = 52;  xx = 3;  |HAZ adaptaC2;  #gadw0001#nCampo# = aAlfa1;
         |CIERRA #dsmom030;
     |FINSI;

     |SI #gadw0001#34 = 0;  |Y #gadw0001#35 = 0;
         #gadw0001#51 = 0;
         #gadw0001#52 = "";
     |FINSI;

     nPrimLin   = 0;
     nMasLin    = 0;

     |ABRE #cainliva;
     |PARA nPara1 = 0; |SI nPara1 [ 74; |HACIENDO nPara1 = nPara1 + 1;
           #cainliva#nPara1# = #gadw0001#nPara1#;
     |SIGUE;

     #cainliva#29 = #cainliva#12 + #cainliva#14 + #cainliva#16 - #cainliva#35;

     |SI nDesdeComer = 1;
         #cainliva#69 = 0;
     |FINSI;

     |GRABA 020#cainliva.n;
     |LIBERA #cainliva;
     |CIERRA #cainliva;

     nOk = 0;
     |SI enTipoIva = 11;  nOk = 1;  |FINSI;
     |SI enTipoIva = 12;  nOk = 1;  |FINSI;
     |SI enTipoIva = 13;  nOk = 1;  |FINSI;
     |SI enTipoIva = 15;  nOk = 1;  |FINSI;
     |SI enTipoIva = 16;  nOk = 1;  |FINSI;
     |SI enTipoIva = 17;  nOk = 1;  |FINSI;

     |SI #caivaasi#188 = "S";  nOk = 1; |FINSI;

     |SI nOk = 0;
         |ACABA;
     |FINSI;

     |SI #cainliva#3 = 1;
         eaSiiPro  = "cainliva";
         enSiiLib  = #cainliva#0;
         enSiiDoc  = #cainliva#1;
         enSiiOpe  = 0;
         enSiiLin  = 0;
         eaSiiSer  = #cainliva#26;
         eaSiiCpt  = #cainliva#7;
         eaSiiCta  = #cainliva#5;
         eaSiiCIF  = #cainliva#30;  |QBF eaSiiCIF;
         eaSiiDes  = #cainliva#8;
         eaSiiUlt  = #cainliva#64;  |QBF eaSiiUlt;
         eaSii340  = #cainliva#62;  |QBF eaSii340;
         eaSiiEje  = #cainliva#4 % -104;
         enSiiPer  = #cainliva#31;
         enSiiRet  = #cainliva#35;
         eaSiiDep  = #cainliva#45;
         eaSiiSub  = #cainliva#47;
         eaSiiCtr  = #cainliva#28;

         |SUB_EJECUTA "casiim01;DEFECTOSGECONET";
     |FINSI;

     enSiiMod  = 0;
     eaSiiPro  = "cainliva";
     enSiiLib  = #cainliva#0;
     enSiiOpe  = 0;
     enSiiLin  = #cainliva#3;
     eaSiiSer  = #cainliva#26;
     eaSiiCpt  = #cainliva#7;
     eaSiiCta  = #cainliva#5;
     eaSiiCIF  = #cainliva#30;  |QBF eaSiiCIF;
     eaSiiDes  = #cainliva#8;
     eaSiiUlt  = #cainliva#64;  |QBF eaSiiUlt;
     eaSii340  = #cainliva#62;  |QBF eaSii340;
     eaSiiEje  = #cainliva#4 % -104;
     enSiiPer  = #cainliva#31;
     enSiiRet  = #cainliva#35;
     eaSiiDep  = #cainliva#45;
     eaSiiSub  = #cainliva#47;
     eaSiiCtr  = #cainliva#28;

     |SUB_EJECUTA "casiim01;DEFECTOSGECONET";
|FPRC;

|PROCESO gadm0003_desglose;
     #gadw0001#29 = 0;
     #gadw0001#12 = #gadm0003#9;          ||Importe
     #gadw0001#14 = #gadw0001#12 % #gadw0001#13;

     #gadw0001#16 = #gadw0001#12 % #gadw0001#15;
     #gadw0001#67 = #gadw0001#12 + #gadw0001#14 + #gadw0001#16;

     #gadw0001#7  = #gadm0003#2;
     #gadw0001#8  = #gadm0003#3;
     #gadw0001#17 = #gadm0003#4;
     #gadw0001#33 = #gadm0003#5;
     #gadw0001#45 = #gadm0003#6;
     #gadw0001#46 = #gadm0003#13;
     #gadw0001#47 = #gadm0003#7;
     #gadw0001#48 = #gadm0003#14;
     #gadw0001#55 = #gadm0003#10;
     #gadw0001#56 = #gadm0003#11;
     #gadw0001#28 = #gadm0003#12;

     |SI aTipoIVA = "R";
         #gadw0001#69 = #dpntm100#0;
         #gadw0001#13 = #dpntm100#22;
         #gadw0001#15 = #dpntm100#24;
         |SI #gadw0001#3 = 1;
             #gadw0001#29 = #dpntm100#28;
         |FINSI;

         |SI #dpntm100#26 ! 0;
             #gadw0001#39 = #dpntm100#71;
             |SI #gadw0001#39 = "F";
                 #gadw0001#59 = #gadw0001#12 + #gadw0001#14 + #gadw0001#16;
             |SINO;
                  #gadw0001#59 = #gadw0001#12;
             |FINSI;
             #gadw0001#34 = #dpntm100#26;
             #gadw0001#35 = #gadw0001#59 % #gadw0001#34;
         |FINSI;
     |FINSI;

     |SI aTipoIVA = "S";
         #gadw0001#69 = #dpntm101#0;
         #gadw0001#13 = #dpntm101#22;
         #gadw0001#15 = #dpntm101#24;
         |SI #gadw0001#3 = 1;
             #gadw0001#29 = #dpntm101#28;
         |FINSI;

         |SI #dpntm101#26 ! 0;
             #gadw0001#39 = #dpntm101#71;
             |SI #gadw0001#39 = "F";
                 #gadw0001#59 = #gadw0001#12 + #gadw0001#14 + #gadw0001#16;
             |SINO;
                  #gadw0001#59 = #gadw0001#12;
             |FINSI;
             #gadw0001#34 = #dpntm101#26;
             #gadw0001#35 = #gadw0001#59 % #gadw0001#34;
         |FINSI;
     |FINSI;

     nFacConta = nFacConta + #gadw0001#67;

     |HAZ ActualizaEsto;
|FPRC;

|DEFBUCLE gadm0003_desglose;       ||nLinea es el numero de BASE
     #gadm0003#2;
     ;
     nEmp48, enNumRegistro, nNumBas, 01;
     nEmp48, enNumRegistro, nNumBas, 99;
     ;
     NULL, gadm0003_desglose;
|FIN;

|PROCESO AjusteDes;
     |SI aTipoIVA = "R";
         nFacConta = nFacConta - #dpntm100#27;
         nFacConta = nFacConta - #dpntm100#36;
         nFacConta = nFacConta - #dpntm100#43;
         nFacConta = nFacConta - #dpntm100#63;
         nFacConta = nFacConta - #dpntm100#70;
     |FINSI;

     |SI aTipoIVA = "S";
         nFacConta = nFacConta - #dpntm101#27;
         nFacConta = nFacConta - #dpntm101#36;
         nFacConta = nFacConta - #dpntm101#43;
         nFacConta = nFacConta - #dpntm101#63;
         nFacConta = nFacConta - #dpntm101#70;
     |FINSI;

     nFacConta = nFacConta ! 2;
     nFacComer = nFacComer ! 2;

     |SI nFacConta = nFacComer;
         |ACABA;
     |FINSI;

     |ABRE #cainliva;
     |SELECT #1#cainliva;
     #cainliva#0 = #gadw0001#0;
     #cainliva#1 = nLinea;
     |LEE 000#cainliva.=;
     |SI FSalida = 0;
         #cainliva#14 = #cainliva#14 - (nFacConta - nFacComer);
         #cainliva#29 = #cainliva#12 + #cainliva#14 + #cainliva#16 - #cainliva#35;

         |GRABA 020#cainliva.a;
         |LIBERA #cainliva;
     |FINSI;
     |CIERRA #cainliva;
|FPRC;

|PROCESO OtraBaseR;
     #gadw0001#69 = #dpntm100#0;
     #gadw0001#12 = #dpntm100#21;
     #gadw0001#13 = #dpntm100#22;
     #gadw0001#14 = #dpntm100#23;
     #gadw0001#15 = #dpntm100#24;
     #gadw0001#16 = #dpntm100#25;
     #gadw0001#29 = 0;
     #gadw0001#67 = #dpntm100#28;

     |SI #dpntm100#26 ! 0;
         #gadw0001#39 = #dpntm100#71;
         |SI #gadw0001#39 = "F";
              #gadw0001#59 = #gadw0001#12 + #gadw0001#14 + #gadw0001#16;
         |SINO;
              #gadw0001#59 = #gadw0001#12;
         |FINSI;
         #gadw0001#34 = #dpntm100#26;
         #gadw0001#35 = #dpntm100#27;
     |FINSI;

     |SI nSwHazDesglose = 1;
         nFacConta = 0;
         |BUCLE gadm0003_desglose;
         |HAZ AjusteDes;
     |SINO;
         |HAZ ActualizaEsto;
     |FINSI;
|FPRC;

|PROCESO OtraBaseS;
     #gadw0001#69 = #dpntm101#0;
     #gadw0001#12 = #dpntm101#21;
     #gadw0001#13 = #dpntm101#22;
     #gadw0001#14 = #dpntm101#23;
     #gadw0001#15 = #dpntm101#24;
     #gadw0001#16 = #dpntm101#25;
     #gadw0001#29 = 0;
     #gadw0001#67 = #dpntm101#28;

     |SI #dpntm101#26 ! 0;
         #gadw0001#39 = #dpntm101#71;
         |SI #gadw0001#39 = "F";
              #gadw0001#59 = #gadw0001#12 + #gadw0001#14 + #gadw0001#16;
         |SINO;
              #gadw0001#59 = #gadw0001#12;
         |FINSI;
         #gadw0001#34 = #dpntm101#26;
         #gadw0001#35 = #dpntm101#27;
     |FINSI;

     |SI nSwHazDesglose = 1;
         nFacConta = 0;
         |BUCLE gadm0003_desglose;
         |HAZ AjusteDes;
     |SINO;
          |HAZ ActualizaEsto;
     |FINSI;
|FPRC;

|PROCESO ContabGAD;
     aAlfa = #gadm0002#75;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     |DDEFECTO #gadw0001;
     |PARA nCampo = 0;  |SI nCampo [ 74;  |HACIENDO nCampo = nCampo + 1;
           #gadw0001#nCampo# = #gadm0002#nCampo#;
     |SIGUE;

     |HAZ Filtro;
     |SI swmalo = 1;  |ACABA;  |FINSI;

     nNumBas   = 1;
     swclipro  = 1;

     eaFichCab  = ("ca" + Usuario + "zzzzzzzz") % 108;
     eaFichLin  = ("li" + Usuario + "zzzzzzzz") % 108;

     |NOME_DAT #caintiva#eaFichCab#;
     |NOME_DAT #cainliva#eaFichLin#;

     |ABRE #caintiva;  |CIERRA #caintiva;  |DELINDEX #caintiva;
     |ABRE #cainliva;  |CIERRA #cainliva;  |DELINDEX #cainliva;

     |ABRE #caintiva;
     #caintiva#0 = #gadw0001#0;
     |GRABA 020#caintiva.n;
     |LIBERA #caintiva;
     |CIERRA #caintiva;

     |HAZ CuentaCont;

     enNumRegistro  = #gadm0002#69;
     nSwHazDesglose = 0;
     |HAZ ControlDescuadre;
     |SI enSwHayDesglose = 1; |Y enSwDescuadre = 0;
         nSwHazDesglose = 1;
     |FINSI;

     |SI nSwHazDesglose = 1;
         nEmp48 = #48#2;

         nFacConta = 0;
         |BUCLE gadm0003_desglose;
         |HAZ AjusteDes;
     |SINO;
         |HAZ ActualizaEsto;
     |FINSI;

     swclipro = 0;
     nRegPpal = #gadm0002#69;

     |DBASS aPathDSARCHI;   |QBF aPathDSARCHI;
     aPathFichDESPANET = aPathDSARCHI + "despanet/" + (("00000" + #48#2) % -105) + "/fich/";

     |SI aTipoIVA = "R";
         |PATH_DAT #dpntm100#aPathFichDESPANET#;

         |ABRE #dpntm100;
         |SELECT #4#dpntm100;
         #dpntm100#45 = nRegPpal;
         #dpntm100#0  = 1;
         |LEE 000#dpntm100.];

         nConta = 2;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #dpntm100#45 ! nRegPpal;  |SAL;  |FINSI;

              |SI #dpntm100#29 = "N";
                  nNumBas = nNumBas + 1;
                  |HAZ OtraBaseR;
              |FINSI;

              |LEE 000#dpntm100.s;
         |SIGUE;

         |CIERRA #dpntm100;
     |FINSI;

     |SI aTipoIVA = "S";
         |PATH_DAT #dpntm101#aPathFichDESPANET#;

         |ABRE #dpntm101;
         |SELECT #4#dpntm101;
         #dpntm101#45 = nRegPpal;
         #dpntm101#0  = 1;
         |LEE 000#dpntm101.];

         nConta = 2;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #dpntm101#45 ! nRegPpal;  |SAL;  |FINSI;

              |SI #dpntm101#29 = "N";
                  nNumBas = nNumBas + 1;
                  |HAZ OtraBaseS;
              |FINSI;

              |LEE 000#dpntm101.s;
         |SIGUE;

         |CIERRA #dpntm101;
     |FINSI;

     |BORRA 020#gadm0002.a;
     |LIBERA #gadm0002;

     enLibro    = #gadw0001#0;
     |SUB_EJECUTA "caivaact;GAD";

     |DELINDEX #caintiva;
     |DELINDEX #cainliva;
|FPRC;

|PROCESO PonContabilizado;
     |SI aTipoIVA = "R";
         |SELECT #1#dpntm100;
         #dpntm100#0 = #gadm0002#69;
         |LEE 000#dpntm100.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |DBASS aBase;

         aMas = aBase + #dpntm100#76;  |QBF aMas;
         aMas = aMas + "/def/" + #dpntm100#77 + ".mas";

         FSalida = -1;
         |SI #dpntm100#77 = "agifa134";  |CARGA_DEF aMas, agifa134@;  |FINSI;
         |SI #dpntm100#77 = "agifa084";  |CARGA_DEF aMas, agifa084@;  |FINSI;
         |SI FSalida ] 0;
             |SI #dpntm100#77 = "agifa134";
                 |PATH_DAT #agifa134@#eaPathComer#;

                 |ABRE #agifa134@;
                 #agifa134@#49 = #dpntm100#78;
                 #agifa134@#0  = #dpntm100#79;
                 |LEE 101#agifa134@.=;
                 |SI FSalida = 0;
                     #agifa134@#48 = "S";
                     |GRABA 020#agifa134@.a;
                     |LIBERA #agifa134@;
                 |FINSI;
                 |CIERRA #agifa134@;
             |FINSI;

             |SI #dpntm100#77 = "agifa084";
                 |PATH_DAT #agifa084@#eaPathComer#;

                 |ABRE #agifa084@;
                 #agifa084@#48 = #dpntm100#78;
                 #agifa084@#0  = #dpntm100#79;
                 |LEE 101#agifa084@.=;
                 |SI FSalida = 0;
                     #agifa084@#39 = "S";
                     |GRABA 020#agifa084@.a;
                     |LIBERA #agifa084@;
                 |FINSI;
                 |CIERRA #agifa084@;
             |FINSI;

             |SI #dpntm100#77 = "agifa134";  |DESCARGA_DEF #agifa134@;  |FINSI;
             |SI #dpntm100#77 = "agifa084";  |DESCARGA_DEF #agifa084@;  |FINSI;
         |FINSI;
     |FINSI;

     |SI aTipoIVA = "S";
         |SELECT #1#dpntm101;
         #dpntm101#0 = #gadm0002#69;
         |LEE 000#dpntm101.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |DBASS aBase;

         aMas = aBase + #dpntm101#76;  |QBF aMas;
         aMas = aMas + "/def/" + #dpntm101#77 + ".mas";

         FSalida = -1;
         |SI #dpntm101#77 = "agifa079";  |CARGA_DEF aMas, agifa079@;  |FINSI;

         |SI FSalida ] 0;
             |SI #dpntm101#77 = "agifa079";
                 |PATH_DAT #agifa079@#eaPathComer#;

                 |ABRE #agifa079@;
                 #agifa079@#66 = #dpntm101#78;
                 #agifa079@#0  = #dpntm101#79;
                 |LEE 101#agifa079@.=;
                 |SI FSalida = 0;
                     #agifa079@#48 = "S";
                     |GRABA 020#agifa079@.a;
                     |LIBERA #agifa079@;
                 |FINSI;
                 |CIERRA #agifa079@;
             |FINSI;

             |SI #dpntm101#77 = "agifa079";  |DESCARGA_DEF #agifa079@;  |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ContabCOMER;
     aAlfa = #gadm0002#75;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     |SI aTipoIVA = "R";
         |PATH_DAT #dpntm100#eaPathDPNTM#;

         |ABRET #dpntm100;
     |FINSI;

     |SI aTipoIVA = "S";
         |PATH_DAT #dpntm101#eaPathDPNTM#;

         |ABRET #dpntm101;
     |FINSI;

     |DDEFECTO #gadw0001;
     |PARA nCampo = 0;  |SI nCampo [ 74;  |HACIENDO nCampo = nCampo + 1;
           #gadw0001#nCampo# = #gadm0002#nCampo#;
     |SIGUE;

     |HAZ Filtro;
     |SI swmalo = 1;
         |SI aTipoIVA = "R";
             |CIERRAT #dpntm100;
         |FINSI;

         |SI aTipoIVA = "S";
             |CIERRAT #dpntm101;
         |FINSI;

         |ACABA;
     |FINSI;

     nNumBas   = 1;
     swclipro  = 1;

     |SI enActual = 1;
         eaFichCab  = ("ca" + Usuario + "zzzzzzzz") % 108;
         eaFichLin  = ("li" + Usuario + "zzzzzzzz") % 108;

         |NOME_DAT #caintiva#eaFichCab#;
         |NOME_DAT #cainliva#eaFichLin#;

         |ABRE #caintiva;  |CIERRA #caintiva;  |DELINDEX #caintiva;
         |ABRE #cainliva;  |CIERRA #cainliva;  |DELINDEX #cainliva;
     |FINSI;

     |ABRE #caintiva;
     #caintiva#0 = #gadw0001#0;
     |LEE 101#caintiva.=;
     |SI FSalida ! 0;
         #caintiva#0 = #gadw0001#0;
         |GRABA 020#caintiva.n;
     |FINSI;
     |LIBERA #caintiva;
     |CIERRA #caintiva;

     |HAZ CuentaCont;

     enNumRegistro  = #gadm0002#69;
     nSwHazDesglose = 0;
     |HAZ ControlDescuadre;
     |SI enSwHayDesglose = 1; |Y enSwDescuadre = 0;
         nSwHazDesglose = 1;
     |FINSI;

     |SI nSwHazDesglose = 1;
         |SI aTipoIVA = "R";  nEmp48 = 1;  nFacComer = #dpntm100#28;  |FINSI;
         |SI aTipoIVA = "S";  nEmp48 = 2;  nFacComer = #dpntm101#28;  |FINSI;

         nFacConta = 0;
         |BUCLE gadm0003_desglose;
         |HAZ AjusteDes;
     |SINO;
         |HAZ ActualizaEsto;
     |FINSI;

     swclipro = 0;
     nRegPpal = #gadm0002#69;

     |SI aTipoIVA = "R";
         |SELECT #4#dpntm100;
         #dpntm100#45 = nRegPpal;
         #dpntm100#0  = 1;
         |LEE 000#dpntm100.];

         nConta = 2;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #dpntm100#45 ! nRegPpal;  |SAL;  |FINSI;

              |SI #dpntm100#29 = "N";
                  nNumBas = nNumBas + 1;
                  |HAZ OtraBaseR;
              |FINSI;

              |LEE 000#dpntm100.s;
         |SIGUE;
     |FINSI;

     |SI aTipoIVA = "S";
         |SELECT #4#dpntm101;
         #dpntm101#45 = nRegPpal;
         #dpntm101#0  = 1;
         |LEE 000#dpntm101.];

         nConta = 2;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #dpntm101#45 ! nRegPpal;  |SAL;  |FINSI;

              |SI #dpntm101#29 = "N";
                  nNumBas = nNumBas + 1;
                  |HAZ OtraBaseS;
              |FINSI;

              |LEE 000#dpntm101.s;
         |SIGUE;
     |FINSI;

     |HAZ PonContabilizado;

     |SI aTipoIVA = "R";
         |CIERRAT #dpntm100;
     |FINSI;

     |SI aTipoIVA = "S";
         |CIERRAT #dpntm101;
     |FINSI;

     |BORRA 020#gadm0002.a;
     |LIBERA #gadm0002;

     |SI enActual = 1;
         enLibro    = #gadw0001#0;
         |SUB_EJECUTA "caivaact;GAD";

         |DELINDEX #caintiva;
         |DELINDEX #cainliva;
     |FINSI;
|FPRC;

|PROCESO gadm0002;
     |SI nDesdeComer = 0;
         |HAZ ContabGAD;
     |FINSI;

     |SI nDesdeComer = 1;
         |HAZ ContabCOMER;
     |FINSI;
|FPRC;

|DEFBUCLE gadm0002C2;
     #gadm0002#2;
     ;
     INICIO;
     FINAL;
     be;
     NULL, gadm0002;
|FIN;

|DEFBUCLE gadm0002C3;
     #gadm0002#3;
     ;
     INICIO;
     FINAL;
     be;
     NULL, gadm0002;
|FIN;

|PROCESO PasaFacturasGAD;
     nDesdeComer = 0;

     |SI aTipoIVA = "S";
         |BUCLE gadm0002C2;
     |SINO;
         |BUCLE gadm0002C3;
     |FINSI;

     |SI #caivaasi#120 = "S";
         |CONFI "    SDESEA REALIZAR LA BUSQUEDA DE FACTURAS DUPLICADAS S/N ?";
         |SI FSalida = 0;
             aAlfa1 = #gadw0001#0; aAlfa1 = ("00" + aAlfa1) % -102;
             aAlfa1 = "cacherep;" + aTipoIVA + aAlfa1;
              |SUB_EJECUTA_NP aAlfa1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PasaFacturasCOMER;
     nDesdeComer = 1;

     |SI aTipoIVA = "S";
         |BUCLE gadm0002C2;
     |SINO;
         |BUCLE gadm0002C3;
     |FINSI;

     |SI enActual = 1;
         |SI #caivaasi#120 = "S";
             |CONFI "    SDESEA REALIZAR LA BUSQUEDA DE FACTURAS DUPLICADAS S/N ?";
             |SI FSalida = 0;
                 aAlfa1 = #gadw0001#0; aAlfa1 = ("00" + aAlfa1) % -102;
                 aAlfa1 = "cacherep;" + aTipoIVA + aAlfa1;
                  |SUB_EJECUTA_NP aAlfa1;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO gadm0002Cambio;
     |SI #gadw0005#0 = "P";
         aAlfa = #gadm0002#75;  |QBF aAlfa;
         |SI aAlfa = "";  |ACABA;  |FINSI;
     |FINSI;

     #gadm0002#4  = #gadw0005#1;
     #gadm0002#31 = aPeriodo;
     #gadm0002#75 = "";

     |GRABA 020#gadm0002.a;
     |LIBERA #gadm0002;
|FPRC;

|DEFBUCLE gadm0002Cambio;
     #gadm0002#1;
     ;
     0
     999999;
     be;
     NULL, gadm0002Cambio;
|FIN;

|PROCESO Tipo0C1Fw5;  |TIPO 0;
     fFechaFac = #gadw0005#1;
     |HAZ TrataFecha;

     |SI #caivaasi#167 = "X";  |ACABA;  |FINSI;

     |SI eaErrorMod ! "";
         |MENAV eaErrorMod;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo12Fw5;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |HAZ Tipo0C1Fw5;
|FPRC;

|PROCESO ProcesoCambio;
     |VENTANA 0501, 1430, -1, 16, "Cambio fecha factura";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #gadw0005;
     |PINPA #0#gadw0005;
     |PINDA #0#gadw0005;
     |ENDATOS #1#gadw0005;
     |SI FSalida = 0;
         |CONFI "0000NRealizamos el cambio";
         |SI FSalida = 0;
             |BUCLE gadm0002Cambio;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;
|FPRC;
