|FICHEROS;
     nomagic1@ #101;
     nomagic2@ #102;
     :/laboral/def/labtraba #200;
|FIN;

|VARIABLES;
   aFich     = "";
   aMas      = "";
   aDef      = "";
   aDni      = "";
   nNumTraba = 0;
   aAlfa1    = "";
   nNume1    = 0;
   fFecha    = @;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscola_i;


|PROCESO eCtrlPaseT;

  aFich = aPNomina + "fich/";
  aDef  = aPNomina + "def/";
  aMas  = aDef + "nomagic1"
  |CARGA_DEF aMas, nomagic1@;
  |SI FSalida ! 0;
      |ACABA;
  |FINSI;

  |PATH_DAT #101 aFich;
  |ABRE #101;
  #101#0 = enLabC0;
  #101#1 = enLabC1;
  #101#2 = enLabC2;
  #101#3 = enLabC3;
  #101#4 = enLabC4;
  #101#5 = eaLabC5;
  |LEE 101#101=;
  |SI FSalida = 0; |Y #101#9 = enEmpresa; |Y #101#10 = enPeriodo;
      #101#6 = nDIARIO;
      #101#7 = aFECHA;
      #101#8 = nDOCUMENTO;
      |GRABA 020#101a;
  |FINSI;
  |LIBERA #101;
  |CIERRA #101;

  |DESCARGA_DEF #101;
|FPRC:

|PROCESO BuscoTrab;
   aAlfa1 = #200#36; |QBF aAlfa1;
   |SI aAlfa1 ! "";
       fFecha = aAlfa1;
       |SI fFecha > efRNomina; |ACABA |FINSI;
   |FINSI;
   aAlfa1 = #200#37; |QBF aAlfa1;
   |SI aAlfa1 ! "";
       fFecha = aAlfa1;
       |SI fFecha < efRNomina; |ACABA |FINSI;
   |FINSI;
   nNumTraba = #200#1;
   |ERROR10;
|FPRC;

|DEFBUCLE BuscoTrab;
  #200#5;
  ;
  enEmpresa, aDni;
  enEmpresa, aDni;
  ;
  NULL, BuscoTrab;
|FIN;

|PROCESO eBuscaRLaboral;
         aDni       = eaCodNif % 112;
         nNumTraba  = -1;
         |BUCLE BuscoTrab;
         |SI nNumTraba ! -1;
            |ABRE #200;
            |SELECT #1#200;
            #200#0 = enEmpresa;
            #200#1 = nNumTraba;
            |LEE 040#200=;
            |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
            |CIERRA #200;
         |SINO;
            |DDEFECTO #200;
         |FINSI;
         enRLaboral = #200#111;
         eaTrans    = #200#131;
         aAlfa1     = #200#36;
         aAlfa1     = aAlfa1 % -104;
         nNume1 = aAlfa1;
         |SI nNume1 ! enEjercicio;  eaTrans = "N";  |FINSI;
|FPRC;
