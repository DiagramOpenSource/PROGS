|FICHEROS;
   caw00103 #0;
   capcem01 #1;

   cacuenta #10;
   cacuebal #11;
   canempre #12;
   ca8cumay #410;
   ca8m0002 #422;
   caclipro #13;
   referen@ #100;
|FIN;

|VARIABLES;
   &eaTempo = "";
   nUlti = 0;
   nCta = 0;
   &entrada = 0;
   aCuenta = "";
   aAlfa   = "";
   aAlfa1  = "";

   nCont   = 0;
   nCont1  = 0;
   nCalc   = 0;
   nCalc1  = 0;
   nCalc2  = 0;
   nNivel  = 0;

   aLong   = "";
   nLong   = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE defec1_i;

|PROCESO LimpiaNif;
   || Quitamos los espacios y los caracteres extra¤os ...
   |QBT aAlfa;
   aAlfa = aAlfa - "-"; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "-"; |SIGUE;
   aAlfa = aAlfa - ":"; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - ":"; |SIGUE;
   aAlfa = aAlfa - ";"; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - ";"; |SIGUE;
   aAlfa = aAlfa - "_"; |PARA; |SI FSalida ! 0; |HACIENDO; aAlfa = aAlfa - "_"; |SIGUE;

   aAlfa1 = aAlfa % 0102;
   aAlfa = aAlfa % 0399;
|FPRC;

|PROCESO Cuenta66; |TIPO 66;
     |ABRE #cacuenta;
     #cacuenta#0 = #caw00103#2;
     |LEE 000#cacuenta.];
     |CONSULTA_CLAVE #1#cacuenta;
     |SI FSalida = 0;
          #caw00103#2 = #cacuenta#0; |PINTA #caw00103#2;
          |ABRE #caclipro;
          #caclipro#23 = "C";
          #caclipro#10 = #caw00103#2;
          |LEE 000#caclipro.=;
          |SI FSalida = 0; |Y #caw00103#3 = "               ";
               #caw00103#3 = #caclipro#9; |PINTA #caw00103#3;
          |FINSI;
          |CIERRA #caclipro;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #cacuenta;
|FPRC;

|PROCESO MiraCuenta; |TIPO 6;
     entrada = 1;
     salidas = FSalida;

     eaCuenta = #0#Campo#;
     aAlfa = #0#Campo# - ".a";
     nUlti = FSalida;

     |HAZ FiltraPuntos;
     #0#Campo# = eaCuenta;
     |PINTA #0#Campo#;

     |SI nUlti > 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "caw00103";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |NOME_DAT #referen@#eaTempo#;
               |ABRE #referen@; |SELECT #2#referen@;
               #referen@#2 = #0#2;
               |LEE 000#referen@.];
               |PARA; |SI FSalida = 0; |Y #referen@#2 = #0#2; |HACIENDO;
                    |SI #referen@#0 ! #0#0;
                         |LEE 000#referen@.u;
                         nCta = #referen@#2 + 1;
                         #0#2 = nCta; |PINTA #0#2;
                         |SAL;
                    |FINSI;
                    |LEE 000#referen@.s;
               |SIGUE;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     aCuenta  = #0#2; |QBF aCuenta;
     |HAZ AltaCuenta;
     |HAZ AltaCliPro;

/*
   aCuenta  = #caw00103#2; |QBF aCuenta;
   aCuenta  = aCuenta - ".";
   |SI FSalida = 0; aCuenta = ""; |ACABA; |FINSI;

   nNivel = 0;
   |SI #48#14 ! 0; nNivel = #48#14; |FINSI;
   |SI #48#15 ! 0; nNivel = #48#15; |FINSI;
   |SI #48#16 ! 0; nNivel = #48#16; |FINSI;
   |SI #48#17 ! 0; nNivel = #48#17; |FINSI;
   |SI #48#18 ! 0; nNivel = #48#18; |FINSI;
   |SI #48#19 ! 0; nNivel = #48#19; |FINSI;

   aCuenta  = #caw00103#2; |QBF aCuenta;
   aAlfa = aCuenta % 0; nCalc2 = aAlfa; nCalc2 = nNivel - nCalc2;
   aCuenta  = aCuenta - ".";
   nCalc  = ((FSalida / 100) ! 0) + 99;
   nCalc1 = FSalida + 98;

   aCuenta = (aCuenta % nCalc) + ("0" * nCalc2) + (aCuenta % nCalc1);
   #caw00103#2 = aCuenta; |PINTA #caw00103#2;

   |HAZ AltaCuenta; |HAZ AltaCliPro;
*/
|FPRC;

|PROCESO AltaCuenta;
   |ABRE #cacuenta;
   #cacuenta#0 = aCuenta;
   |LEE 000#cacuenta.=;
   |SI FSalida ! 0;
      |ABRE #cacuebal;

      |DDEFECTO #cacuenta;
      |PARA nCont = 6; |SI nCont ] 1; |HACIENDO nCont = nCont - 1;
         nCalc = 13 + nCont;
         |SI #canempre#nCalc# ! 0;
            nCalc = 100 + #canempre#nCalc#;
            aAlfa = aCuenta % nCalc;
            #cacuenta#0 = aAlfa;
            #cacuenta#1 = nCont;
            |LEE 000#cacuenta.=;
            |SI FSalida = 0;
               #cacuebal#0 = aAlfa;
               |LEE 000#cacuebal.=;
               |SI FSalida = 0;
                  #cacuenta#4 = #cacuebal#1;
                  #cacuenta#5 = #cacuebal#2;
                  #cacuenta#6 = #cacuebal#3;
                  #cacuenta#7 = #cacuebal#4;
                  #cacuenta#8 = #cacuebal#5;
                  |SAL;
               |FINSI;
            |FINSI;
         |FINSI;
      |SIGUE;
      |CIERRA #cacuebal;

      |PARA nCont1 = 9; |SI nCont1 [ 53; |HACIENDO nCont1 = nCont1 + 1;
         #cacuenta#nCont1# = 0;
      |SIGUE;

      #cacuenta#0 = aCuenta;
      #cacuenta#1 = nNivel;
      aAlfa = #caw00103#1; |QBF aAlfa;
      |SI aAlfa ! ""; #cacuenta#2 = aAlfa; |FINSI;
      #cacuenta#3 = "S";
      |GRABA 020#cacuenta.b;

      |PUSHV 0501 2380;

      |PINPA #0#cacuenta; |PINDA #0#cacuenta;
      |SI enEjercicio ] 2008;
          nMensa9 = 1; |HAZ defect1;
      |FINSI;

      |ENDATOS #1#cacuenta;
      |SI FSalida = 0;
         |GRABA 020#cacuenta.a;
      |FINSI;
      |LIBERA #cacuenta;
      |POPV;
   |FINSI;
   |CIERRA #cacuenta;
|FPRC;

|PROCESO BuscaNivel1;
   aLong = aCuenta % 0; nLong = aLong;
   nNivel = 0;
   |SI nLong > 0;
      |SI nLong = #48#14; nNivel = 1; |FINSI;
      |SI nLong = #48#15; nNivel = 2; |FINSI;
      |SI nLong = #48#16; nNivel = 3; |FINSI;
      |SI nLong = #48#17; nNivel = 4; |FINSI;
      |SI nLong = #48#18; nNivel = 5; |FINSI;
      |SI nLong = #48#19; nNivel = 6; |FINSI;
   |FINSI;
|FPRC;

|PROCESO AltaCliPro;
   |ABRE #capcem01;
   #capcem01#0 = #caw00103#0;
   |LEE 000#capcem01.=;
   |SI FSalida ! 0; |DDEFECTO #capcem01; |FINSI;
   |CIERRA #capcem01;

   |ABRE #caclipro;
   #caclipro#23 = "C";
   #caclipro#10 = #caw00103#2; aCuenta = #caclipro#10; |QBF aCuenta;
   |HAZ BuscaNivel1;
   #caclipro#11 = nNivel;
   |LEE 000#caclipro.=;
   |SI FSalida ! 0;
      |DDEFECTO #caclipro;
      #caclipro#23 = "C";
      #caclipro#10 = #caw00103#2;
      #caclipro#11 = nNivel;
      aAlfa = #caw00103#3; |HAZ LimpiaNif;
      #caclipro#9  = aAlfa;
      #caclipro#24 = aAlfa1;
      #caclipro#1  = #caw00103#1;
      #caclipro#2  = #capcem01#2;
      aAlfa = #capcem01#3; |QBF aAlfa;
      aAlfa = aAlfa % 0102; #caclipro#3  = aAlfa;
      aAlfa = #capcem01#3; |QBF aAlfa;
      aAlfa = aAlfa % 0303; #caclipro#4  = aAlfa;
      #caclipro#5  = #capcem01#5;
      #caclipro#6  = #capcem01#4;
      |GRABA 020#caclipro.c;
   |SINO;
      |SI #caw00103#3 = "               ";
          #caw00103#3 = #caclipro#9; |PINTA #caw00103#3;
      |FINSI;
   |FINSI;
   |CIERRA #caclipro;
|FPRC;

|PROCESO ActNifCliPro;
   |ABRE #caclipro;
   #caclipro#23 = "C";
   #caclipro#10 = #caw00103#2; aCuenta = #caclipro#10; |QBF aCuenta;
   |HAZ BuscaNivel1;
   #caclipro#11 = nNivel;
   |LEE 101#caclipro.=;
   |SI FSalida = 0;
      aAlfa = #caw00103#3; |QBF aAlfa;
      |SI aAlfa ! "";
         aAlfa = #caw00103#3; aAlfa = aAlfa % 0102; nCalc = aAlfa; aAlfa = nCalc;
         |SI aAlfa = "0";
            aAlfa = #caw00103#3; |HAZ LimpiaNif;
         |SINO;
            aAlfa = #caw00103#3;
         |FINSI;
         #caclipro#9 = aAlfa;
         |SI #caclipro#24 = "   "; #caclipro#24 = aAlfa1; |FINSI;
      |FINSI;
      |GRABA 020#caclipro.a; |LIBERA #caclipro;
   |FINSI;
|FPRC
