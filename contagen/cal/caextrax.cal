|FICHEROS;
   caextrax #0;
   cacuenta #1;

   camaasil #11;
   canempre #30;
   caselemz #911;
   caselem1 #998;

   caextrap #99;
   caextrpb #901;
   caextrpb@ #999;
|FIN;

|VARIABLES;
   sw        = 0;
   nInkey    = 0;
   aFichero  = "";
   &ext1     = "";
   &ext2     = "";
   &runnom   = "caextrax";
   &espe1    =  @;
   &espe2    = @;
   &espe3    = 0;
   &espe4    = 0;
   &espe5    = "";
   &espe6    = "";
   &espe7    = 0;
   &espe8    = 0;
   &espe9    = 0;
   &sino     = "",
   &espe10   = "";
   &espe11   = "";
   &espe15   = "";
   &espe16   = 0;
   &enEmpOrg = 0;
   &enPerOrg = 0;
   &eaFEmp   = "";
   &swVarios = 0;
   &eaMonOrg = "";
   &eSwMul   = 0;

   &eaEspTabla = "";
   aAlfa       = "";
   aAlfa1      = "";
   aAlfa2      = "";
   nCampo      = 0;
   &enInkey    = 0;
   &nQuantHay  = 0;
   &enEste     = 0;
   nNume1      = 0;
   nHay        = 0;
   aMas        = "";
   aDef        = "";
   &nSwAsto    = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE modulo_i;

|CALCULO recoge; |TIPO 7;
   |SI #0#14 = "N";
       #0#2 = fec1;
   |SINO;
       #0#2 = "01.01.2000";
   |FINSI;
   |PINTA #0#2;
   #0#3 = fec2; |PINTA #0#3;
|FCAL;

|CALCULO VariasCtas;
   aAlfa1 = "S";
   aAlfa2 = #0#16;
   |SI aAlfa2 = "S"; aAlfa1 = "N"; |FINSI;

   |C_M #0#0,  1, aAlfa1;
   |C_M #0#17, 1, aAlfa2; |C_M #0#18, 1, aAlfa2;
   |C_M #0#19, 1, aAlfa2; |C_M #0#20, 1, aAlfa2;
   |C_M #0#21, 1, aAlfa2; |C_M #0#22, 1, aAlfa2;
   |C_M #0#23, 1, aAlfa2; |C_M #0#24, 1, aAlfa2;
   |C_M #0#25, 1, aAlfa2; |C_M #0#26, 1, aAlfa2;
   |C_M #0#27, 1, aAlfa2; |C_M #0#28, 1, aAlfa2;
   |C_M #0#29, 1, aAlfa2; |C_M #0#30, 1, aAlfa2;
   |C_M #0#31, 1, aAlfa2;
   |SI aAlfa2 = "N";
       |PDEFECTO #0,17,32;
       |PARA nCampo = 17; |SI nCampo [ 31; |HACIENDO nCampo = nCampo + 1;
             |PINTA #0nCampo;
       |SIGUE;
   |SINO;
       #0#0 = ""; |PINTA #0#0;
       #0#1 = ""; |PINTA #0#1;
   |FINSI;
|FCAL;

|CALCULO cuenta; |TIPO 6;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     eaCuenta = #0Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
|FCAL;

|CALCULO cuefin; |TIPO 0;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |SI FSalida = 2; |ACABA; |FINSI;

     eaCuenta = #0Campo;
     |SI eaCuenta = doce;
         |SI Campo = 0; |Y #0#16 = "N"; |ERROR; |FINSI;
         |ACABA;
     |FINSI;

     emCta    = 1;
     eaCuenta = #0Campo;
     |HAZ SacaNivel;
     |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
     |HAZ LeeCuenta;
     |SI eswCta ! 0;
         |MENAV "0000No existe Cuenta";
         |ERROR;
     |SINO;
         |SI Campo = 0;
             #0#1 = #cacuenta#2; |PINTA #0#1;
         |FINSI;
     |FINSI;
|FCAL;

|PROCESO seleccio2; |TIPO 0;
   |C_M #0Campo, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI #0#17 = "N";
      |C_M #0#20, 1, "S"; |C_M #0#21, 1, "S";
      |C_M #0#22, 1, "S"; |C_M #0#23, 1, "S";
      |C_M #0#24, 1, "S"; |C_M #0#25, 1, "S";
      |C_M #0#26, 1, "S"; |C_M #0#27, 1, "S";
      |C_M #0#28, 1, "S"; |C_M #0#29, 1, "S";
      |C_M #0#30, 1, "S"; |C_M #0#31, 1, "S";

      |C_M #0#18, 1, "N"; |C_M #0#19, 1, "N";
      #0#18 = "            "; |PINTA #0#18;
      #0#19 = "zzzzzzzzzzzz"; |PINTA #0#19;
   |SINO;
      |C_M #0#18, 1, "S"; |C_M #0#19, 1, "S";
      |C_M #0#20, 1, "N"; |C_M #0#21, 1, "N";
      |C_M #0#22, 1, "N"; |C_M #0#23, 1, "N";
      |C_M #0#24, 1, "N"; |C_M #0#25, 1, "N";
      |C_M #0#26, 1, "N"; |C_M #0#27, 1, "N";
      |C_M #0#28, 1, "N"; |C_M #0#29, 1, "N";
      |C_M #0#30, 1, "N"; |C_M #0#31, 1, "N";
   |FINSI;
|FPRC;

|CALCULO NoMasCuentas; |TIPO 0;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |SI #0Campo = doce;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = "";  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO fechas; |TIPO 0;
   |SI #0#14 = "N";
       |SI #0Campo > fec2;|O #0Campo < fec1;
           |MENAV "    Fecha fuera de Periodo ...";
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;
   |SI Campo = 3;
       |SI #0#2 > #0#3;
           |MENAV "    Fechas erroneas";
           |ERROR;
       |FINSI;
   |FINSI;
|FCAL;

|CALCULO no_dep; |TIPO 7;
   |CAMPO_MODIFICA #0#6, 1, eaDepar;
   |CAMPO_MODIFICA #0#7, 1, eaDepar;
|FCAL;

|CALCULO nosubde; |TIPO 7;
   |CAMPO_MODIFICA #0#12, 1, eaSubde;
   |CAMPO_MODIFICA #0#13, 1, eaSubde;
|FCAL;

|CALCULO SalAnt; |TIPO 7;
 || ..   |SI #0#14 = "S"; |O #0#15 ! 0;
 ||   |SI #0#15 ! 0;
 ||       #0#11 = "N"; |PINTA #0#11;
 ||   |SINO;
 ||       |C_M #0#11,1,"S";
 ||   |FINSI;
|FCAL;

|CALCULO LeePlanilla; |TIPO 6;
 |ABRE #911;
 #911#0 = #0#15;
 |LEE 001#911=;
 |SI FSalida ! 0; |Y #0#15 = 0;
     |DDEFECTO #911;
     #911#0 = 0;
     #911#1 = "Empresa Actual";
     |GRABA 020#911n;
 |FINSI;
 |CIERRA #911;
|FCAL;

|PROCESO AntesTipo; |TIPO 7;
   |HAZ EsComersan;
   |SI FSalida = 0;
      |CAMPO_MAXIMO #0#8, 1, "4";
      |MENSA "0000(1) Debe,Haber,Saldo; (2) Des.,Importe,Saldo; (3) Det.Asto/Anot.(4) Referencia";
   |SINO;
      |CAMPO_MAXIMO #0#8, 1, "3";
      |MENSA "    (1) Debe,Haber y Saldo; (2) Descripcion,Importe y Saldo, (3) Detalle Asto/Anot";
   |FINSI;
|FPRC;

|PROCESO TrasTipo;
   |BLIN 4;
|FPRC;

|| ///////////////////////////////////////////////////////////////////////
|PROCESO ParaTodos;
   ext1 = #901#0;
   ext2 = #901#1;
   espe1 = #0#2;        || desde fecha
   espe2 = #0#3;        || hasta fecha
   espe3 = #0#4;        || desde concepto
   espe4 = #0#5;        || hasta concepto
   espe5 = #0#6;        || desde departamento
   espe6 = #0#7;        || hasta departamento
   espe7 = #0#8;        || tipo de Informe
   espe8 = #0#9;        || desde Diario
   espe9 = #0#10;       || hasta Diario
   espe10 = #0#12;      || desde subdepartamento
   espe11 = #0#13;      || hasta subdepartamento
   espe15 = #0#14;
   espe16 = #0#15;
   sino = "S"; |SI #0#11 = "N"; sino = "N"; |FINSI;

   |SI #0#8 ! 3;
       |SUB_EJECUTA_NP "caextrap;NOMEQUITESQUETECORTOLOSGUEVOS";
   |SINO;
       |SUB_EJECUTA_NP "caextraz;NOMEQUITESQUETECORTOLOSGUEVOS";
   |FINSI;

   |SI #0#16 = "S";
       cod1 = enEmpOrg;
       cod2 = enPerOrg;
       emEmp = 1;  || Sin mensaje
       |HAZ leelo;
       |PATH_DAT #1  eaFEmp;
       |PATH_DAT #11 eaFEmp;
       #0#2 = espe1;
       #0#3 = espe2;
   |FINSI;

   |PULSATECLA;
|FPRC;

|PROCESO PintaCuentas;
   |ATRI S; |PINTA 2401, "<Ctrl+Flecha Izq> Anterior ";
   |ATRI P; |PINTA 2428, #0#32;
   |ATRI S; |PINTA 2441, "<Ctrl+Flecha Der> Siguiente ";
   |ATRI P; |PINTA 2469, #0#34;
   |ATRI 0;
|FPRC;

|PROCESO ParaPintaCta;
   |SI enInkey = 181;
       #0#34 = #0#33;
       #0#33 = #0#32;
       #0#32 = "";
       |SI enEste > 1;
           #999#3 = enEste - 1;
           |LEE 041#999=;
           |SI FSalida = 0;
               #0#32 = #999#0;
           |FINSI;
       |FINSI;
   |FINSI;

   |SI enInkey = 179;
       #0#32 = #0#33;
       #0#33 = #0#34;
       #0#34 = "";
       |SI enEste < nQuantHay;
           #999#3 = enEste + 1;
           |LEE 041#999=;
           |SI FSalida = 0;
               #0#34 = #999#0;
           |FINSI;
       |FINSI;
   |FINSI;
   |HAZ PintaCuentas;
|FPRC;

|PROCESO DesdeParrilla;
   |HAZ PintaCuentas;

   |ABRE #999;
   |SELECT #2#999;

   |ABRE #901;
   |SELECT #2#901;
   |LEE 041#901p;
   enEste = #901#3;

   enInkey = 179;
   |PARA; |SI enInkey = 181; |O enInkey = 179; |HACIENDO;
          |HAZ ParaTodos;
          |SI enInkey = 181; |LEE 041#901a; |FINSI;
          |SI enInkey = 179; |LEE 041#901s; |FINSI;
          enEste = #901#3;
          |HAZ ParaPintaCta;
          |SI FSalida ! 0; enInkey = 0; |FINSI;
   |SIGUE;
   |SELECT #1#901;
   |CIERRA #901;

   |SELECT #1#999;
   |CIERRA #999;
|FPRC;

|PROCESO caextrp0;
  nHay = 1;
  |ERROR10;
|FPRC;

|DEFBUCLE caextrp0;
   #11#3;
   0, 6, 21, 28;
   #1#0, #0#2, 000000, 0000, #0#9,  #0#4, #0#6, #0#12;
   #1#0, #0#3, 999999, 9999, #0#10, #0#5, #0#7, #0#13;
   ;
   NULL, caextrp0;
|FIN;

|PROCESO MultiEmp1;
   dirfich0 = #caselem1#3; |QBF dirfich0;
   |SI dirfich0 = ""; |ACABA; |FINSI;
   |SI #0#2 > #caselem1#5; |O #0#3 < #caselem1#4;
       |ACABA;  || Fuera de la seleccion
   |FINSI;

   |PATH_DAT #11 dirfich0;
   |BUCLE caextrp0;
   |SI nHay = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE MultiEmp0;
  #caselem1#1;
  ;
  000001;
  999999;
  ;
  NULL,MultiEmp1;
|FIN;

|PROCESO MultiEjercicio;
   eSwMul = 1;
   espe15 = #0#14;
   espe16 = #0#15;

   |SUB_EJECUTA "caselemp";
   |NOME_DAT #998 eaFichsel;

   |BUCLE MultiEmp0;
   |DELINDEX #998;
|FPRC;

|PROCESO MiroSiHay;
    |BUCLE caextrp0;
    |SI nHay = 0;
        |SI #0#14 = "S"; |O #0#15 ! 0;
            |HAZ MultiEjercicio;
            |PATH_DAT #11 eaFEmp;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO HagoFichero;

   #901#0 = #1#0;
   |LEE 041#901=;
   |SI FSalida = 0; |ACABA; |FINSI;

   nHay = 0;
   |HAZ MiroSiHay;
   |SI nHay = 0; |ACABA; |FINSI;

   |DDEFECTO #901;
   nQuantHay = nQuantHay + 1;
   #901#0 = #1#0;
   #901#1 = #1#2;
   #901#3 = nQuantHay;
   |GRABA 020#901n;
   |SI nNume1 = 33; #0nNume1 = #1#0; |FINSI;
   |SI nNume1 = 34; #0nNume1 = #1#0; |FINSI;
   nNume1 = nNume1 + 1;
|FPRC;

|DEFBUCLE CaCuenta;
  #1#1;
  3;
  #0#18, "S";
  #0#19, "S";
  ;
  NULL, HagoFichero;
|FIN;

|CALCULO engancha; |TIPO 3;
   eaEspTabla = #0#16;

   |DELINDEX #901;
   nQuantHay = 0;
   |SI #0#16 = "S";
       nNume1 = 33;
       |ABRE #901;
       |SI #0#17 = "S";
           |BUCLE CaCuenta;
       |SINO;
           |ABRE #1;
           |PARA nCampo = 20; |SI nCampo [ 31; |HACIENDO nCampo = nCampo + 1;
                 |SI #0nCampo ! doce;
                     #1#0 = #0nCampo;
                     |LEE 041#1=;
                     |SI FSalida = 0; |Y #1#3 = "S";
                         |HAZ HagoFichero;
                     |FINSI;
                 |FINSI;
           |SIGUE;
           |CIERRA #1;
       |FINSI;
       |CIERRA #901;
       |SI nQuantHay ! 0;
           |HAZ DesdeParrilla;
       |SINO;
           |MENAV "0000Seleccion Vacia";
       |FINSI;
   |SINO;
       #901#0 = #0#0;
       #901#1 = #0#1;
       nQuantHay = 1;
       enEste    = 1;
       enInkey   = 0;
       |HAZ ParaTodos;
   |FINSI;
|FCAL;

|PROGRAMA;

 |CLS;
 |CABEZA "Extractos Contables";
 |HAZ DirAplicSt;
 |HAZ inicio;
 enEmpOrg = enEmpresa;
 enPerOrg = enPeriodo;
 |DFICE eaFEmp;
 eaMonOrg = eaMoneda;

 |ABRE #99;
 |DDEFECTO #99;
 |LEE 041#99p;
 |CIERRA #99;

 |DBASE aMas;
 aDef  = aMas + "def/caextrpb";
 |CARGA_DEF aDef, caextrpb@;
 |SI FSalida ! 0;
     |MENAV "    Error Cargado Fichero de Contagen. Proceso Interrumpido";
     |ACABA;
 |FINSI;

 aFichero = ("9b" + Usuario);
 |NOME_DAT #901 aFichero; |DELINDEX #901;
 |NOME_DAT #999 aFichero;

 |DDEFECTO #0;
 #0#8 = #99#9;

 FSalida = 0;
 |PARA;|SI FSalida = 0; |HACIENDO;
        sw = 0;
        |CLS;
        |PINPA #0#0;
        |PINDA #0#0;                    || Pinta los datos por defecto
        |ENDATOS #1#0;                  || Seleccion informe
        nInkey = FSalida;
        |SI #0#16 = "S";
            |SAL;
        |SINO;
            cod1 = enEmpOrg;
            cod2 = enPerOrg;
            emEmp = 1;  || Sin mensaje
            |HAZ leelo;

            |PATH_DAT #1 eaFEmp;
            #0#2 = espe1;
            #0#3 = espe2;
            FSalida = nInkey;
       |FINSI;
 |SIGUE;

 |DESCARGA_DEF #caextrpb@;

 |ABRE #99;
 |DDEFECTO #99;
 |LEE 041#99p;
 |SI FSalida = 0;
     #99#9 = #0#8;
     |GRABA 020#99a;
 |FINSI;
 |CIERRA #99;
|FPRO;
|| ***********************************************************************
