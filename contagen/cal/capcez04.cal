|FICHEROS;
     capcez04 #0;
     capcem01 #1;
     camaasil #2;
     camaniva #3;
     cacuenta #4;
     caclipro #5;
     referen@;
|FIN;

|VARIABLES;
     nHay = 0;
     aCta = "";
     aAlfa = "";
|FIN;

|PROCESO BuscaCta;
     nHay = 0;
     |QBF aCta;
     |SI aCta ! "";
          #1#10 = aCta;
          |LEE 000#1=;
          |SI FSalida = 0;
               nHay = 1;
               aCta = "430" + ("000000" + #1#0) % -106;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tempo;
     aCta = #referen@#0;
     |HAZ BuscaCta;
     #4#0 = #referen@#0;
     |LEE 121#4=;
     |SI FSalida = 0;
          |BORRA 020#4a;
          |LIBERA #4;

          #4#0 = aCta;
          |GRABA 000#4n;
     |FINSI;

     #5#23 = "C";
     #5#10 = #referen@#0;
     |LEE 101#5=;
     |SI FSalida = 0;
          |BORRA 020#5a;
          |LIBERA #5;

          #5#10 = aCta;
          |GRABA 000#5n;
     |FINSI;
|FPRC;

|DEFBUCLE Tempo;
     #referen@#1001;
     ;
     "            ";
     "zzzzzzzzzzzz";
     ;
     NULL, Tempo;
|FIN;

|PROCESO cacuenta;
     aCta = #4#0;
     |HAZ BuscaCta;
     |SI nHay = 1;
          #referen@#0 = #4#0;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE cacuenta;
     #4#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, cacuenta;
|FIN;

|PROCESO camaniva;
     #3#0 = #2#13;
     #3#2 = #2#15;
     #3#3 = #2#14;
     |LEE 101#3=;
     |SI FSalida = 0;
          #3#12 = aCta;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;
|FPRC;

|PROCESO camaasil;
     aCta = #2#4;
     |HAZ BuscaCta;
     |SI nHay = 1;
          #2#4 = aCta;
          |GRABA 020#2a;
          |HAZ camaniva;
     |FINSI;

     aCta = #2#16;
     |HAZ BuscaCta;
     |SI nHay = 1;
          #2#16 = aCta;
          |GRABA 020#2a;
          |HAZ camaniva;
     |FINSI;

     aCta = #2#10;
     |HAZ BuscaCta;
     |SI nHay = 1;
          #2#10 = aCta;
          |GRABA 020#2a;
          |HAZ camaniva;
     |FINSI;
|FPRC;

|DEFBUCLE camaasil;
     #2#1;
     ;
     00, "01.01.0000", 000001, 0001;
     99, "31.12.9999", 999999, 9999;
     be;
     NULL, camaasil;
|FIN;

|PROCESO T3; |TIPO 3;
     |SI #0#0 ! "SI"; |ACABA; |FINSI;

     |ABRE #1; |SELECT #2#1;

     |ABRE #3; |SELECT #3#3;
     |BUCLE camaasil;
     |CIERRA #3;

     |DDEF aAlfa;
     aAlfa = aAlfa + "cacuenta";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario;
          |NOME_DAT #referen@#Usuario#;
          |DELINDEX #referen@; |ABRE #referen@;

          |BUCLE cacuenta;

          |ABRE #4;
          |ABRE #5;
          |BUCLE Tempo;
          |CIERRA #4;
          |CIERRA #5;

          |CIERRA #referen@; |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |CIERRA #1;
|FPRC;
