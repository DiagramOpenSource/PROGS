|FICHEROS;
   camanads;

   caivaasi;
   caivases;
   calibros;
   cacuenta;
|FIN;

|VARIABLES;
   aAlfa = "";
|FIN;

|INCLUYE dscoiv_i;
|INCLUYE dscont_i;

|CALCULO TrasSubde; |TIPO 0;
   |C_M #camanads#Campo#,0,aAlfa;
   |SI aAlfa = "N";
       #camanads#13 = ""; |PINTA #camanads#13;
       |ACABA;
   |FINSI;

   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpSub = 1;  |FINSI;
   |SI FSalida = 11; eOpSub = 2;  |FINSI;

   enConcepto  = dConc1;
   eaCodSubdep = #camanads#11;
   enQue = 1;
   |HAZ SubActividad;
   enQue = 0;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Subdepartamento";
       |ERROR;
   |SINO;
       #camanads#11 = eaCodSubdep; |PINTA #camanads#11;
       #camanads#13 = eaNomSubdep; |PINTA #camanads#13;
   |FINSI;
|FCAL;

|CALCULO AntesSubde; |TIPO 0;
   aAlfa = "S";
   |SI eaSubde = "N";
       aAlfa = "N";
       #camanads#10 = "X"; |PINTA #camanads#10;
   |SINO;
       |SI #camanads#10 ! "V";
            aAlfa = "N";
       |FINSI;
   |FINSI;
   |C_M #camanads#11, 1, aAlfa;
   |SI aAlfa = "N";
       #camanads#11 = "  "; |PINTA #camanads#11;
       #camanads#13 = "  "; |PINTA #camanads#13;
   |FINSI;
|FCAL;

|CALCULO TrasDepar; |TIPO 0;
   |BLIN 4;
   |C_M #camanads#Campo#,0,aAlfa;
   |SI aAlfa = "N";
       enActividad = eaDfDepC;
       |SI enActividad = 0; enActividad = 1;|FINSI;
       #camanads#12 = "Actividad por Defecto "; |PINTA #camanads#12;
       |ACABA;
   |FINSI;

   eOpDep = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpDep = 1;  |FINSI;
   enActividad = #camanads#9;
   eaCodDep    = #camanads#9;
   |HAZ Actividad;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Actividad / Departamento";
       |ERROR;
   |SINO;
       #camanads#9  = eaCodDep; |PINTA #camanads#9;
       #camanads#12 = eaNombreAct; |PINTA #camanads#12;
       |SI efActFin > "01.01.1900"; |Y snFilBa = "S";
           aAlfa = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
           |CONFI aAlfa;
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
       |SI eaEsCom = "S";
           |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea continuar ? ";
           |SI FSalida ! 0;
               |ERROR;
           |FINSI;
       |FINSI;
   |FINSI;
|FCAL;

|CALCULO AntesAct; |TIPO 7;
   |C_M #camanads#Campo#, 0, aAlfa;
   |SI aAlfa = "S"
      |SI Haybasica = 1;
          |MENSA "    <F2> Consultar Actividades";
      |SINO;
          |MENSA "    <F2> Consultar Departamentos";
      |FINSI;
   |FINSI;
|FCAL;


|CALCULO AntesDepar; |TIPO 0;
   aAlfa = "S";
   |SI eaDepar = "N";
       aAlfa = "N";
       #camanads#8 = "X"; |PINTA #camanads#8;
   |SINO;
       |SI #camanads#8 ! "V";
            aAlfa = "N";
       |FINSI;
   |FINSI;
   |C_M #camanads#9, 1, aAlfa;
   |SI aAlfa = "N";
       #camanads#9 = "  "; |PINTA #camanads#9;
       #camanads#12 = "";  |PINTA #camanads#12;
   |FINSI;
|FCAL;

|CALCULO Tipo7C07; |TIPO 7;
   |C_M #camanads#Campo#,0,aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI #camanads#7 = doce;
       #camanads#7 = #camanads#6;
       |PINTA #camanads#7;
   |FINSI;
|FCAL;

|CALCULO DesHasCta; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI FSalida = 10;
       #camanads#7 = #camanads#6;
       |PINTA #camanads#7;
   |FINSI;

   |SI #camanads#7 < #camanads#6;
       |MENAV "0000Cuenta Hasta menor que Cuenta Desde. Modifique";
       |ERROR;
   |FINSI;
|FCAL;

|CALCULO cuenta; |TIPO 6;
   emCta = 0;        || Dar mensajes de error
   eaCuenta = #camanads#Campo#;
   salidas  = FSalida;
   |HAZ FiltraPuntos;
   #camanads#Campo# = eaCuenta;
   |PINTA #camanads#Campo#;
|FCAL;

|CALCULO Tipo7C05; |TIPO 7;
   |C_M #camanads#Campo#,0,aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI #camanads#5 = "     ";
       #camanads#5 = #camanads#4;
       |PINTA #camanads#5;
   |FINSI;
|FCAL;

|CALCULO DesHasSerie; |TIPO 0;
   |C_M #camanads#Campo#,0,aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI FSalida = 2; |ACABA; |FINSI;

   |SI FSalida = 10;
       #camanads#5 = #camanads#4;
       |PINTA #camanads#5;
   |FINSI;

   |SI #camanads#5 < #camanads#4;
       |MENAV "0000Serie Hasta menor que Serie Desde. Modifique";
       |ERROR;
   |FINSI;
|FCAL;


|CALCULO Libro; |TIPO 6;

   |ABRE #calibros;
   #calibros#0 = #camanads#1;
   |LEE 010#calibros.=;
   |SI FSalida ! 0;
       |MENAV "      No existe libro";
       |CIERRA #calibros;
       |ERROR;
       |ACABA;
   |FINSI;
   |CIERRA #calibros;
   aTipoIVA = #calibros#2;

   #camanads#2 = #calibros#2; |PINTA #camanads#2;
   #camanads#3 = #calibros#1; |PINTA #camanads#3;

   |ATRI I;
   |SI aTipoIVA = "R";
       |PINTA 0813, " IVA REPERCUTIDO ";
   |SINO;
       |SI aTipoIVA = "S";
          |PINTA 0813, " IVA SOPORTADO   ";
      |SINO;
          |PINTA 0813, " REGISTRO SIN IVA";
      |FINSI;
   |FINSI;
   |ATRI 0;
   |HAZ LeeDefIVA;
   |C_M #camanads#4, 1,snSerie;
   |C_M #camanads#5, 1,snSerie;
   |SI snSerie = "N";
       #camanads#4 = "     "; |PINTA #camanads#4;
       #camanads#5 = "zzzzz"; |PINTA #camanads#5;
   |FINSI;
|FCAL;

|PROCESO ClauMin;
   #camanads#0 = 001;
|FPRC;

|PROCESO ClauMax;
   #camanads#0 = 999;
|FPRC;

|PROGRAMA;

   |HAZ inicio;
   |SI eaDepar = "N"; |Y eaSubde = "N";
      |CONFI "0000NEsta Empresa No tiene Departamento ni Subdepartamento. Desea Continuar";
      |SI FSalida ! 0;
          |PTEC 807;
          |ACABA;
      |SINO;
          eaDepar = "S";
          eaSubde = "S";
      |FINSI;
   |FINSI;
   |HAZ DirAplicSt;

   |SI eaDepar = "N";  |C_M #camanads#8, 1,"N";  |FINSI;
   |SI eaSubde = "N";  |C_M #camanads#10,1,"N";  |FINSI;
   |HAZ eLeeParametro;

   |CLS;
   |CABEZA "Asignacion Dep/Subd";

   |PINPA #0#camanads;
   |ENTLINEAL #1#camanads, -1, 2, 22, 0, ClauMin, ClauMax;
|FPRO;
