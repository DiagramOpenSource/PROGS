|FICHEROS;
     gadz0100;
     gadw0009;
     caclipro;

     agifa024@;
     agifa112@;
     dsam0103@;

     &regisnif@;
|FIN;

|VARIABLES;
     nOk                 = 0;

     aAlfa               = "";
     aFic                = "";
     aCod                = "";
     aBase               = "";
     aMas                = "";
     aPathComer          = "";
|FIN;

|PROCESO caclipro;
     aAlfa = #caclipro#10 % 102;
     |SI aAlfa ! "43";  |Y aAlfa ! "40";
      |Y aAlfa ! "41";
         |ACABA;
     |FINSI;

     |SI aAlfa = "43";  |O aAlfa = "40";
         aAlfa = #caclipro#10 % -106;
     |FINSI;

     |SI aAlfa = "41";
         aAlfa = "1" + (#caclipro#10 % -105);
     |FINSI;

     #gadw0009#0  = #caclipro#23;
     #gadw0009#1  = #caclipro#10;
     #gadw0009#2  = #caclipro#9;
     #gadw0009#6  = aAlfa;
     #gadw0009#7  = #caclipro#1;
     #gadw0009#8  = #caclipro#3;
     #gadw0009#9  = #caclipro#24;

     |GRABA 020#gadw0009.n;
     |LIBERA #gadw0009;
|FPRC;

|DEFBUCLE caclipro;
     #caclipro#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, caclipro;
|FIN;

|PROCESO agifa024;
     #gadw0009#0  = "C";
     #gadw0009#1  = #agifa024@#16;
     #gadw0009#2  = #agifa024@#15;
     |LEE 000#gadw0009.=;
     |SI FSalida ! 0;
         |DDEFECTO #gadw0009;
         #gadw0009#0  = "C";
         #gadw0009#1  = #agifa024@#16;
         #gadw0009#2  = #agifa024@#15;
         |GRABA 020#gadw0009.b;
     |FINSI;

     #gadw0009#10 = #agifa024@#0;
     #gadw0009#11 = #agifa024@#1;
     #gadw0009#12 = #agifa024@#178;
     #gadw0009#13 = #agifa024@#205;

     |GRABA 020#gadw0009.a;
     |LIBERA #gadw0009;
|FPRC;

|DEFBUCLE agifa024;
     #agifa024@#1001;
     ;
     "      ";
     "zzzzzz";
     ;
     NULL, agifa024;
|FIN;

|PROCESO agifa112;
     #gadw0009#0  = "P";
     #gadw0009#1  = #agifa112@#10;
     #gadw0009#2  = #agifa112@#9;
     |LEE 000#gadw0009.=;
     |SI FSalida ! 0;
         |DDEFECTO #gadw0009;
         #gadw0009#0  = "P";
         #gadw0009#1  = #agifa112@#10;
         #gadw0009#2  = #agifa112@#9;
         |GRABA 020#gadw0009.b;
     |FINSI;

     #gadw0009#10 = #agifa112@#0;
     #gadw0009#11 = #agifa112@#1;
     #gadw0009#12 = #agifa112@#74;
     #gadw0009#13 = #agifa112@#89;

     |GRABA 020#gadw0009.a;
     |LIBERA #gadw0009;
|FPRC;

|DEFBUCLE agifa112;
     #agifa112@#1001;
     ;
     "      ";
     "zzzzzz";
     ;
     NULL, agifa112;
|FIN;

|PROCESO gadw0009;
     #regisnif@#0 = #gadw0009#2;
     |LEE 000#regisnif@.=;
     |SI FSalida ! 0;  |DDEFECTO #regisnif@;  |FINSI;

     #gadw0009#3 = #regisnif@#1;
     #gadw0009#4 = #regisnif@#4;
     #gadw0009#5 = #regisnif@#12;

     nOk = 1;

     |SI #gadw0009#6 ! #gadw0009#10;   nOk = 0;  |FINSI;
     |SI #gadw0009#7 ! #gadw0009#11;   nOk = 0;  |FINSI;
     |SI #gadw0009#8 ! #gadw0009#12;   nOk = 0;  |FINSI;
     |SI #gadw0009#9 ! #gadw0009#13;   nOk = 0;  |FINSI;
     |SI #gadw0009#3 ! #gadw0009#7;    nOk = 0;  |FINSI;
     |SI #gadw0009#4 ! #gadw0009#8;    nOk = 0;  |FINSI;
     |SI #gadw0009#5 ! #gadw0009#9;    nOk = 0;  |FINSI;

     |SI nOk = 0;
         |GRABA 020#gadw0009.a;
     |SINO;
         |BORRA 020#gadw0009.a;
     |FINSI;
     |LIBERA #gadw0009;
|FPRC;

|DEFBUCLE gadw0009;
     #gadw0009#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gadw0009;
|FIN;

|PROGRAMA;
     |SI #gadz0100#1 = "        ";
         |ACABA;
     |FINSI;

     |BUCLE caclipro;

     |DBASS aBase;

     aCod       = (("00000" + #gadz0100#2) % -105);
     aPathComer = aBase + #gadz0100#1;  |QBF aPathComer;
     aPathComer = aPathComer + "/fich/" + aCod + "/";

     aMas = aBase + #gadz0100#1;  |QBF aMas;
     aMas = aMas + "/def/agifa024.mas";
     |CARGA_DEF aMas, agifa024@;
     |PATH_DAT #agifa024@#aPathComer#;

     aMas = aBase + #gadz0100#1;  |QBF aMas;
     aMas = aMas + "/def/agifa112.mas";
     |CARGA_DEF aMas, agifa112@;
     |PATH_DAT #agifa112@#aPathComer#;

     |BUCLE agifa024;
     |BUCLE agifa112;

     |ABRE #regisnif@;
     |BUCLE gadw0009;
     |CIERRA #regisnif@;

     |CONSULTA_CLAVE #1#gadw0009;

     |DESCARGA_DEF #agifa112@;
     |DESCARGA_DEF #agifa024@;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ LeeNifs;

     aFic = "gadw0009" + Usuario;
     |NOME_DAT #gadw0009#aFic#;

     |ABRE #gadw0009;  |CIERRA #gadw0009;  |DELINDEX #gadw0009;

     |ABRE #gadz0100;
     |LEE 000#gadz0100.p;
     |SI FSalida ! 0;  |DDEFECTO #gadz0100;  |FINSI;
     |CIERRA #gadz0100;

     |ABRET #gadw0009;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #gadw0009;  |DELINDEX #gadw0009;
|FPRC;
