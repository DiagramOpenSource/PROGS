|FICHEROS;
     dscsvz11;
     dscsvm10;

     canempre;
     cacuenta;
     caclipro;
     camaasic;
     camaasil;
     camaniva;
     caivalin;
     camandia;

     :modelos/dsmom030;
     :modelos/dsmom040;
     :modelos/dsmom041;
     :modelos/dsmom042;

     dscsvw06;
     dscsvw07;
     dscsvw08;
     dscsvw09;
     dscsvw10;
     dscsvw12;
     dscsvw13;
     dscsvw15;

     dscsvw11,MANTE;
     dscsvw14,MANTE;

     camaasil@;
     dscsvw07@;

     &regisnif@;
|FIN;

|VARIABLES;
     nBtnInfo = -1;
     &eaNombrePDF = "";

     n0Vent          = -1;
     n1Vent          = -1;
     n2Vent          = -1;
     nBtnUni         = -1;
     nBtnCan         = -1;
     nBtnCon         = -1;
     nBtnCar1        = -1;
     nBtnCar2        = -1;
     nBtnCar3        = -1;
     nBtnCar4        = -1;
     nBtnCar5        = -1;
     nBtnCar6        = -1;
     nBtnCar7        = -1;
     nBtnCar8        = -1;
     nLblReg1        = -1;
     nLblReg2        = -1;
     nLblReg3        = -1;
     nLblReg4        = -1;
     nLblReg5        = -1;
     nLblReg6        = -1;
     nLblReg7        = -1;
     nLblReg8        = -1;

     nGrid10         = 0;
     nGrid13         = 0;
     nGrid15         = 0;
     nRango          = 0;
     nHandle         = 0;
     nIde            = 0;
     nDCampo         = 0;
     nCampo          = 0;
     nCampo1         = 0;
     nCampo2         = 0;
     nPanta          = 0;
     nLong           = 0;
     nCarac          = 0;
     nPos            = 0;
     nFSalida        = 0;
     nColum          = 0;
     nNume1          = 0;
     nNume2          = 0;
     nRam1           = 0;
     nRam2           = 0;
     nPide           = 0;
     nFila           = 0;
     nCargar         = 0;
     nPosi           = 0;
     nTotCmp         = 0;
     nTCampos        = 0;
     nTValor         = 0;
     nReg            = 0;
     nPorce          = 0;
     nError          = 0;
     nCmp            = 0;
     nLongVar        = 0;
     nCarVar         = 0;
     nPosVar         = 0;
     nDife           = 0;
     nDesdeCar       = 0;
     nPos1           = 0;
     nPos2           = 0;
     nChequeo        = 0;
     nDocu           = 0;
     nApun           = 0;
     nBarra          = 0;
     nDia            = 0;
     nMes            = 0;
     nAny            = 0;
     nLibro          = 0;
     nIBas           = 0;
     nIIva           = 0;
     nITot           = 0;
     nIRet           = 0;
     nConcep         = 0;
     nElem           = 0;
     nGrupo          = 0;
     nLinea          = 0;
     nImpor          = 0;
     nNume           = 0;
     nConta          = 0;
     nPrint          = 0;
     nPasada         = 0;
     nLong1          = 0;
     nLong2          = 0;
     nLongMax        = 0;
     nLongMin        = 0;
     nCheqCuentas    = 0;
     nAnyo           = 0;
     nHay            = 0;

     aCtaBas         = "";
     aCtaIva         = "";
     aCtaTot         = "";
     aCtaRet         = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aAlfa4          = "";
     aAlfa5          = "";
     aAlfa6          = "";
     aFecha          = "";
     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aPathLocal      = "";
     aPathTmp        = "";
     aFicTree        = "";
     aAbre           = "";
     aTabla          = "";
     aTablaTree      = "";
     aFilaTree       = "";
     aDescri         = "";
     aFicBrowse      = "";
     aLong           = "";
     aCadena         = "";
     aOrigen         = "";
     aDestino        = "";
     aDTabla         = "";
     aHTabla         = "";
     aBuscar         = "";
     aRefresca       = "";
     aCarac          = "";
     aContenido      = "";
     a100            = "";
     aVar            = "";
     aLee            = "";
     aC10            = "";
     aC13            = "";
     aFicTmp         = "";
     aFicCSV         = "";
     aLongVar        = "";
     aComilla        = "";
     aCarVar         = "";
     aTipo           = "";
     aAsiento        = "";
     aReferen        = "";
     aTipoDia        = "";
     aLibro          = "";
     aProg           = "";
     aParam1         = "";
     aParam2         = "";
     aParam3         = "";
     aIde            = "";
     aAnyo           = "";
     aVer1           = "";
     aVer2           = "";
     aVerde          = "0,185,0;255,255,255";
     aDef            = "0,185,0;255,255,255";
     aFic            = "0,185,0;255,255,255";
     aNumFac         = "";
     aNumAsi         = "";
     aModAsiento     = "";
     aBaseConta      = "";

     fFechaFac       = @;
     fFecha          = @;

     {1}aConte       = "";

     {-1}sTree       = 0;
         sT_nID      = 0;
         sT_nOper    = 0;
         sT_aData    = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &eaUnidadBasico = "";
     &eaIP           = "";
|FIN;

|INCLUYE dscont_i;

|| ------------------------------------------------------------------------

|PROCESO Conversion;
     nError  = 0;

     aAlfa = aPathLocal + "*.csv";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;

     aParam2 = aPathLocal + "ficcsv.txt";  |RFBORRA aParam2;

     aVer1   = "";
     aVer2   = "";
     aConte  = aBaseConta + "plugin/dsofficetxt.exe";
     |ESPECIFICA "MD5", aConte;
     aVer1 = FSalida;

     aConte  = aPathLocal + "dsofficetxt.exe";
     |ESPECIFICA "REMOTOMD5", aConte;
     aVer2 = FSalida;

     |SI aVer1 ! aVer2;
         aOrigen  = aBaseConta + "plugin/dsofficetxt.exe";
         aDestino = aPathLocal + "dsofficetxt.exe";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |ENVIA_FICHERO aOrigen, aDestino;
         |FINSI;

         aAlfa = aPathLocal + "dsofficetxt.exe";
         |XABRE "EC", aAlfa, 0;
         |SI FSalida < 0;
             |MENAV "0000No encuentro el conversor a CSV, por favor consulte con su administrador informatico.";
             aFicBrowse = "";
             |ACABA;
         |FINSI;
     |FINSI;

     aProg   = aPathLocal + "dsofficetxt.exe";
     aParam1 = aFicBrowse;
     aParam2 = aPathLocal + "ficcsv.csv";
     aParam3 = "";

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aProg + " " + aParam1 + " " + aParam2 + aParam3 + &34;
     |RSYSTEM aAlfa;

     |XABRE "EC", aParam2, 0;
     |SI FSalida < 0;
         aFicBrowse = "";
         |MENAV "0000No se ha podido convertir a CSV el fichero seleccionado.";
         |ACABA;
     |FINSI;

     aFicBrowse = aParam2;
|FPRC;

|PROCESO Browse;
     aFicBrowse = "F*.*";
     |BROWSE aFicBrowse;

     aAlfa      = aFicBrowse;   |QBF aAlfa;
     aFicBrowse = "";
     aLong      = aAlfa % 0;
     nLong      = aLong;
     |PARA nCarac = 2;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos  = (nCarac * 100) + 1;
           aFicBrowse = aFicBrowse + (aAlfa % nPos);
     |SIGUE;

     |SI aFicBrowse = "";
         |ACABA;
     |FINSI;

     |HAZ Conversion;
|FPRC;

|| ------------------------------------------------------------------------


|PROCESO CalculaFecha;
     |QBT aFecha;
     aLongVar = aFecha % 0;
     nLongVar = aLongVar;
     nBarra   = 0;
     aAlfa1   = "";
     aAlfa2   = "";
     aAlfa3   = "";
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = aFecha % nPosVar;

           |SI  aCarVar = "0"; |O aCarVar = "1"; |O aCarVar = "2";
             |O aCarVar = "3"; |O aCarVar = "4"; |O aCarVar = "5";
             |O aCarVar = "6"; |O aCarVar = "7"; |O aCarVar = "8";
             |O aCarVar = "9";
                |SI nBarra = 0;  aAlfa1 = aAlfa1 + aCarVar;  |FINSI;
                |SI nBarra = 1;  aAlfa2 = aAlfa2 + aCarVar;  |FINSI;
                |SI nBarra = 2;  aAlfa3 = aAlfa3 + aCarVar;  |FINSI;
           |SINO;
                |SI aCarVar = ".";  |O aCarVar = "/";  |O aCarVar = "\";
                    nBarra = nBarra + 1;
               |FINSI;
           |FINSI;
      |SIGUE;

      |QBF aAlfa1;
      |QBF aAlfa2;
      |QBF aAlfa3;

      nDia = aAlfa1;
      nMes = aAlfa2;
      nAny = aAlfa3;

      |SI nAny < 1000;
          nAny = 2000 + nAny;
      |FINSI;

      |SI nDia = 0;  nDia = 1;                    |FINSI;
      |SI nMes = 0;  nMes = 1;                    |FINSI;
      |SI nAny = 0;  nAny = 2000 + #canempre#26;  |FINSI;

      aFecha = (("00" + nDia) % -102);
      aFecha = aFecha + "." + (("00" + nMes) % -102);
      aFecha = aFecha + "." + (("0000" + nAny) % -104);
|FPRC;

|PROCESO QuitaPuntos;
     |QBT aAlfa;
     aLongVar = aAlfa % 0;
     nLongVar = aLongVar;
     aAlfa1   = "";
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = aAlfa % nPosVar;

           |SI  aCarVar ! ".";
                aAlfa1 = aAlfa1 + aCarVar;
           |FINSI;
      |SIGUE;

      aAlfa = aAlfa1;
|FPRC;

|PROCESO QuitaComillas;
     aLongVar = aAlfa % 0;
     nLongVar = aLongVar;

     aAlfa1   = "";
     aComilla = &34;
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = aAlfa % nPosVar;

           |SI aCarVar ! aComilla;
                aAlfa1 = aAlfa1 + aCarVar;
           |FINSI;
     |SIGUE;

     aAlfa = aAlfa1;
|FPRC;

|PROCESO CalculaCuenta;
     |QBF eaCuenta;
     |SI eaCuenta = "";  |ACABA;  |FINSI;

     |SI nCheqCuentas = 1;
         #dscsvw07#6 = eaCuenta;
         |LEE 000#dscsvw07.=;
         |SI FSalida = 0;
             eaCuenta  = #dscsvw07#1;
             |HAZ SacaNivel;
             |ACABA;
         |FINSI;
     |FINSI;

     aLongVar = eaCuenta % 0;
     nLongVar = aLongVar;

     |SI nLongVar ! MaximoDigitos;
         nDife = MaximoDigitos - nLongVar;
         |SI nDife < 0;  |ACABA;  |FINSI;

         nDesdeCar = 3;

         nPos1     = 100 + nDesdeCar;
         nPos2     = (100 * (nDesdeCar + 1)) + 99;
         aAlfa     = (eaCuenta % nPos1) + ("0" * nDife) + (eaCuenta % nPos2);
         eaCuenta  = aAlfa;
     |FINSI;

     |HAZ SacaNivel;
|FPRC;

|PROCESO dscsvw10Campos;
     nTCampos  = nTCampos + 1;
|FPRC;

|DEFBUCLE dscsvw10Campos;
     #dscsvw10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw10Campos;
|FIN;

|PROCESO GrabaCliente;
     #dscsvw08#0  = nReg;
     #dscsvw08#24 = "C";

     |SI nCampo = 0;  #dscsvw08#11 = #dscsvw10#1;  |FINSI;

     |SI nCampo = 1;
         aAlfa1 = #dscsvw08#11;   |QBF aAlfa1;
         aAlfa  = #dscsvw10#1;    |QBF aAlfa;
         |SI aAlfa = "D";
             aAlfa = "440" + aAlfa1;
         |SINO;
             aAlfa = "430" + aAlfa1;
         |FINSI;

         #dscsvw08#11 = aAlfa;
     |FINSI;

     |SI nCampo = 2;  #dscsvw08#34 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 3;  #dscsvw08#2  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 4;  #dscsvw08#25 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 5;  #dscsvw08#10 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 16; #dscsvw08#3  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 17; #dscsvw08#7  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 18; #dscsvw08#6  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 19; #dscsvw08#26 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 21; #dscsvw08#8  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 25; #dscsvw08#9  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 26; #dscsvw08#30 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 27; #dscsvw08#31 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 28; #dscsvw08#32 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 29; #dscsvw08#33 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 31; #dscsvw08#41 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 32; #dscsvw08#42 = #dscsvw10#1;  |FINSI;
|FPRC;

|PROCESO GrabaProveedor;
     #dscsvw08#0  = nReg;
     #dscsvw08#24 = "P";

     |SI nCampo = 0;  #dscsvw08#11 = #dscsvw10#1;  |FINSI;

     |SI nCampo = 1;
         aAlfa1 = #dscsvw08#11;   |QBF aAlfa1;
         aAlfa  = #dscsvw10#1;    |QBF aAlfa;
         |SI aAlfa = "A";
             aAlfa = "410" + aAlfa1;
         |SINO;
             aAlfa = "400" + aAlfa1;
         |FINSI;

         #dscsvw08#11 = aAlfa;
     |FINSI;

     |SI nCampo = 2;  #dscsvw08#34 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 3;  #dscsvw08#2  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 4;  #dscsvw08#25 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 5;  #dscsvw08#10 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 10; #dscsvw08#3  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 11; #dscsvw08#7  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 12; #dscsvw08#6  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 13; #dscsvw08#26 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 14; #dscsvw08#8  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 16; #dscsvw08#9  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 17; #dscsvw08#52 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 21; #dscsvw08#30 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 23; #dscsvw08#31 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 24; #dscsvw08#32 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 25; #dscsvw08#33 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 27; #dscsvw08#41 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 28; #dscsvw08#42 = #dscsvw10#1;  |FINSI;
|FPRC;

|PROCESO GrabaAsiento;
     #dscsvw06#0  = nReg;
     |SI nCampo = 5;
         aFecha = #dscsvw10#1;
         |HAZ CalculaFecha;
         #dscsvw06#31 = aFecha;
     |FINSI;

     |SI nCampo = 6;
         aFecha = #dscsvw10#1;
         |HAZ CalculaFecha;
         #dscsvw06#2  = aFecha;
         #dscsvw06#37 = aFecha;
     |FINSI;

     |SI nCampo = 12; #dscsvw06#9  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 13; #dscsvw06#5  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 9;  #dscsvw06#8  = #dscsvw10#1;  |FINSI;

     |SI nCampo = 14;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw06#10  = aAlfa;
     |FINSI;

     |SI nCampo = 2;   #dscsvw06#33  = #dscsvw10#1;  |FINSI;  ||Tipo diario
     |SI nCampo = 15;  #dscsvw06#34  = #dscsvw10#1;  |FINSI;  ||Numero asiento
     |SI nCampo = 7;   #dscsvw06#35  = #dscsvw10#1;  |FINSI;  ||Referencia
     |SI nCampo = 8;   #dscsvw06#36  = #dscsvw10#1;  |FINSI;  ||Concepto
|FPRC;

|PROCESO GrabaIva;
     #dscsvw09#0  = nReg;

     |SI nCampo = 5;
         aFecha      = #dscsvw10#1;  |QBF aFecha;
         |HAZ CalculaFecha;
         #dscsvw09#1 = aFecha;
     |FINSI;

     |SI nCampo = 15; #dscsvw09#2  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 16; #dscsvw09#16 = #dscsvw10#1;  |FINSI;  ||Numero asiento
     |SI nCampo = 2;  #dscsvw09#3  = aLibro;       |FINSI;
     |SI nCampo = 6;  #dscsvw09#4  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 8;  #dscsvw09#5  = #dscsvw10#1;  |FINSI;
     |SI nCampo = 12; #dscsvw09#13 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 17; #dscsvw09#15 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 19; #dscsvw09#11 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 20; #dscsvw09#10 = #dscsvw10#1;  |FINSI;

     |SI nCampo = 14;
         eaCuenta = #dscsvw10#1;
         |HAZ CalculaCuenta;
         #dscsvw09#14 = eaCuenta;
     |FINSI;

     |SI nCampo = 10;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw09#6  = aAlfa;
     |FINSI;

     |SI nCampo = 9;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw09#7  = aAlfa;
     |FINSI;

     |SI nCampo = 7;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         #dscsvw09#8  = aAlfa;
     |FINSI;

     |SI nCampo = 11;
         aAlfa = #dscsvw10#1;
         |HAZ QuitaPuntos;
         nNume1 = aAlfa;
         |SI nNume1 < #dscsvw09#7;
             #dscsvw09#7 = nNume1;
         |FINSI;
     |FINSI;

     |SI nCampo = 20;  #dscsvw09#10 = #dscsvw10#1;  |FINSI;
     |SI nCampo = 19;  #dscsvw09#11 = #dscsvw10#1;  |FINSI;
|FPRC;

|PROCESO GrabaAmortiza;
     #dscsvw12#0  = nReg;

     #dscsvw12#nCampo# = #dscsvw10#1;

     |SI nCampo = 2;
         aFecha      = #dscsvw10#1;  |QBF aFecha;
         |HAZ CalculaFecha;
         #dscsvw12#2 = aFecha;
     |FINSI;
|FPRC;

|PROCESO PonConcepDS;
     |SI #dscsvm10#0 = "1   ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "10  ";  #dscsvm10#2 = 63;  |FINSI;
     |SI #dscsvm10#0 = "101 ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "11  ";  #dscsvm10#2 = 70;  |FINSI;
     |SI #dscsvm10#0 = "12  ";  #dscsvm10#2 = 20;  |FINSI;
     |SI #dscsvm10#0 = "13  ";  #dscsvm10#2 = 63;  |FINSI;
     |SI #dscsvm10#0 = "14  ";  #dscsvm10#2 = 12;  |FINSI;
     |SI #dscsvm10#0 = "15  ";  #dscsvm10#2 = 62;  |FINSI;
     |SI #dscsvm10#0 = "151 ";  #dscsvm10#2 = 60;  |FINSI;
     |SI #dscsvm10#0 = "152 ";  #dscsvm10#2 = 62;  |FINSI;
     |SI #dscsvm10#0 = "153 ";  #dscsvm10#2 = 62;  |FINSI;
     |SI #dscsvm10#0 = "16  ";  #dscsvm10#2 = 63;  |FINSI;
     |SI #dscsvm10#0 = "17  ";  #dscsvm10#2 = 715; |FINSI;
     |SI #dscsvm10#0 = "18  ";  #dscsvm10#2 = 713; |FINSI;
     |SI #dscsvm10#0 = "19  ";  #dscsvm10#2 = 605; |FINSI;
     |SI #dscsvm10#0 = "2   ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "20  ";  #dscsvm10#2 = 1;   |FINSI;
     |SI #dscsvm10#0 = "201 ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "21  ";  #dscsvm10#2 = 600; |FINSI;
     |SI #dscsvm10#0 = "210 ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "211 ";  #dscsvm10#2 = 600; |FINSI;
     |SI #dscsvm10#0 = "212 ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "22  ";  #dscsvm10#2 = 1;   |FINSI;
     |SI #dscsvm10#0 = "28  ";  #dscsvm10#2 = 607; |FINSI;
     |SI #dscsvm10#0 = "3   ";  #dscsvm10#2 = 1;   |FINSI;
     |SI #dscsvm10#0 = "38  ";  #dscsvm10#2 = 713; |FINSI;
     |SI #dscsvm10#0 = "4   ";  #dscsvm10#2 = 705; |FINSI;
     |SI #dscsvm10#0 = "48  ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "5   ";  #dscsvm10#2 = 601; |FINSI;
     |SI #dscsvm10#0 = "55  ";  #dscsvm10#2 = 601; |FINSI;
     |SI #dscsvm10#0 = "58  ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "6   ";  #dscsvm10#2 = 600; |FINSI;
     |SI #dscsvm10#0 = "601 ";  #dscsvm10#2 = 600; |FINSI;
     |SI #dscsvm10#0 = "608 ";  #dscsvm10#2 = 729; |FINSI;
     |SI #dscsvm10#0 = "7   ";  #dscsvm10#2 = 600; |FINSI;
     |SI #dscsvm10#0 = "701 ";  #dscsvm10#2 = 600; |FINSI;
     |SI #dscsvm10#0 = "708 ";  #dscsvm10#2 = 729; |FINSI;
     |SI #dscsvm10#0 = "8   ";  #dscsvm10#2 = 607; |FINSI;
     |SI #dscsvm10#0 = "88  ";  #dscsvm10#2 = 628; |FINSI;
     |SI #dscsvm10#0 = "9   ";  #dscsvm10#2 = 63;  |FINSI;
     |SI #dscsvm10#0 = "98  ";  #dscsvm10#2 = 628; |FINSI;
     |SI #dscsvm10#0 = "APER";  #dscsvm10#2 = 96;  |FINSI;
     |SI #dscsvm10#0 = "CIER";  #dscsvm10#2 = 95;  |FINSI;
     |SI #dscsvm10#0 = "FAC ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "FAC ";  #dscsvm10#2 = 700; |FINSI;
     |SI #dscsvm10#0 = "REGU";  #dscsvm10#2 = 94;  |FINSI;

     nConcep = #dscsvm10#2;  |HAZ LeeConcep;
     #dscsvm10#3 = aDescri;
|FPRC;

|PROCESO dscsvw10Carga;
     nCampo = #dscsvw10#0 - 1;

     |SI aTabla = "conceptos";
         |SI nCampo = 1;  #dscsvm10#0 = #dscsvw10#1;  |FINSI;
         |SI nCampo = 2;  #dscsvm10#1 = #dscsvw10#1;  |FINSI;

         |HAZ PonConcepDS;
     |FINSI;

     |SI aTabla = "cacuenta";
                          #dscsvw07#0 = nReg;
         |SI nCampo = 0;  #dscsvw07#1 = #dscsvw10#1;  |FINSI;
         |SI nCampo = 1;  #dscsvw07#3 = #dscsvw10#1;  |FINSI;
         |SI nCampo = 2;  #dscsvw07#5 = #dscsvw10#1;  |FINSI;
     |FINSI;

     |SI aTabla = "clientes";
         |HAZ GrabaCliente;
     |FINSI;

     |SI aTabla = "proveedores";
         |HAZ GrabaProveedor;
     |FINSI;

     |SI aTabla = "diario";
         |SI nCampo = 0;  #dscsvw13#0 = #dscsvw10#1;  |FINSI;
         |SI nCampo = 1;  #dscsvw13#1 = #dscsvw10#1;  |FINSI;
     |FINSI;

     |SI aTabla = "asientos";
         |HAZ GrabaAsiento;
     |FINSI;

     |SI aTabla = "ivaventa";
         aLibro = "R";
         |HAZ GrabaIva;
     |FINSI;

     |SI aTabla = "ivacompra";
         aLibro = "S";
         |HAZ GrabaIva;
     |FINSI;

     |SI aTabla = "amortiza";
         aLibro = "S";
         |HAZ GrabaAmortiza;
     |FINSI;
|FPRC;

|DEFBUCLE dscsvw10Carga;
     #dscsvw10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw10Carga;
|FIN;

|PROCESO BuscaUltimo;
     |PARA nNume = 97;  |SI nNume ] 1;  |HACIENDO nNume = nNume - 1;
           #camandia#0 = nNume;
           |LEE 000#camandia.=;
           |SI FSalida ! 0;  |SAL;  |FINSI;
     |SIGUE;

     #dscsvw13#2 = nNume;
|FPRC;

|PROCESO CompruebaIde;
     #camandia#0 = nNume;
     |LEE 000#camandia.=;
     |SI FSalida = 0;
         nNume = 0;
     |FINSI;

     |SI nNume = 0;
         |HAZ BuscaUltimo;
     |FINSI;

     #dscsvw13#2 = nNume;
|FPRC;

|PROCESO BuscaIdeDiario
     |SI nLongVar = 3;
         aAlfa1 = #dscsvw13#0 % 101;
         aAlfa2 = #dscsvw13#0 % 201;
         aAlfa3 = #dscsvw13#0 % 301;

         |SI aAlfa2 = "0";
             aAlfa = aAlfa1 + aAlfa3;
         |SINO;
             nNume = aAlfa2;
             nNume = 6 + nNume;
             aAlfa = nNume + aAlfa3;
         |FINSI;

         nNume = aAlfa;
         |SI nNume ] 100;
             |HAZ BuscaUltimo;
             |ACABA;
         |FINSI;

         |HAZ CompruebaIde;

         |ACABA;
     |FINSI;

     |SI nLongVar = 4;
         |HAZ BuscaUltimo;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO PonDiario;
     #dscsvw13#2 = 1;
     #dscsvw13#3 = #dscsvw13#1;

     |SI #dscsvw13#0 = "APER";
         #dscsvw13#2 = 00;

         |ACABA;
     |FINSI;

     |SI #dscsvw13#0 = "REGU";
         #dscsvw13#2 = 98;

         |ACABA;
     |FINSI;

     |SI #dscsvw13#0 = "CIER";
         #dscsvw13#2 = 99;

         |ACABA;
     |FINSI;

     aAlfa    = #dscsvw13#0;  |QBF aAlfa;
     aLongVar = aAlfa % 0;
     nLongVar = aLongVar;
     |SI nLongVar ] 3;
         |HAZ BuscaIdeDiario
         |ACABA;
     |FINSI;

     nNume = #dscsvw13#0;

     |SI nNume = 0;   |HAZ BuscaUltimo;  |ACABA;  |FINSI;
     |SI nNume = 98;  |HAZ BuscaUltimo;  |ACABA;  |FINSI;
     |SI nNume = 99;  |HAZ BuscaUltimo;  |ACABA;  |FINSI;

     |HAZ CompruebaIde;
|FPRC;

|PROCESO GrabaDiario;
     #camandia#0 = #dscsvw13#2;
     |LEE 101#camandia.=;
     |SI FSalida ! 0;
         |DDEFECTO #camandia;
         #camandia#0 = #dscsvw13#2;
         |GRABA 020#camandia.b;
     |FINSI;

     #camandia#1 = #dscsvw13#3;
     |GRABA 020#camandia.a;
     |LIBERA #camandia;
|FPRC;

|PROCESO Print;
     |SI aTabla = "cacuenta";
         |SI nLblReg1 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg1;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 0790, 0798, NULL;
         nLblReg1 = FSalida;
     |FINSI;

     |SI aTabla = "clientes";
         |SI nLblReg2 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg2;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 1090, 1098, NULL;
         nLblReg2 = FSalida;
     |FINSI;

     |SI aTabla = "proveedores";
         |SI nLblReg3 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg3;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 1390, 1398, NULL;
         nLblReg3 = FSalida;
     |FINSI;

     |SI aTabla = "diario";
         |SI nLblReg4 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg4;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 1690, 1698, NULL;
         nLblReg4 = FSalida;
     |FINSI;

     |SI aTabla = "asientos";
         |SI nLblReg5 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg5;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 1990, 1998, NULL;
         nLblReg5 = FSalida;
     |FINSI;

     |SI aTabla = "ivaventa";
         |SI nLblReg6 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg6;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 2290, 2298, NULL;
         nLblReg6 = FSalida;
     |FINSI;

     |SI aTabla = "ivacompra";
         |SI nLblReg7 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg7;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 2590, 2598, NULL;
         nLblReg7 = FSalida;
     |FINSI;

     |SI aTabla = "amortiza";
         |SI nLblReg8 ! -1;
             |FIN_CONTROL_WINDOWS nLblReg8;
         |FINSI;

         aAlfa =  "LABEL,{{15}}" + (("00000" + nReg) % -105);
         |CONTROL_SIMPLE nPanta, aAlfa, 2890, 2898, NULL;
         nLblReg8 = FSalida;
     |FINSI;
|FPRC;

|PROCESO GrabaDatos;
     |CIERRA #dscsvw10;
     nTCampos = 0;
     |BUCLE dscsvw10Campos;

     nError   = 0;
     nTValor  = nTotCmp;
     |SI nTCampos < nTValor;
         |DELINDEX #dscsvw10;
         |ACABA;
     |FINSI;

     nPorce = ((nTValor * 100) / nTCampos) ! 0;
     |SI nPorce < 70;
         |DELINDEX #dscsvw10;
         |ACABA;
     |FINSI;

     nReg   = nReg + 1;
     |SI nReg = 1;
         |DELINDEX #dscsvw10;
         |ACABA;
     |FINSI;

||     nPrint = nReg $ 1000;
||     |SI nPrint = 0;  |HAZ Print;  |FINSI;

     |SI aTabla = "conceptos";
         |BUCLE dscsvw10Carga;

         |SI #dscsvm10#0 ! "CodC";  |Y #dscsvm10#0 ! "    ";
             |GRABA 020#dscsvm10.c;
             |LIBERA #dscsvm10;
         |FINSI;
     |FINSI;

     |SI aTabla = "cacuenta";
         |DDEFECTO #dscsvw07;

         |BUCLE dscsvw10Carga;

         |GRABA 020#dscsvw07.n;
         |LIBERA #dscsvw07;
     |FINSI;

     |SI aTabla = "clientes";
         |DDEFECTO #dscsvw08;

         |BUCLE dscsvw10Carga;

         |GRABA 020#dscsvw08.n;
         |LIBERA #dscsvw08;
     |FINSI;

     |SI aTabla = "proveedores";
         |DDEFECTO #dscsvw08;

         |BUCLE dscsvw10Carga;

         |GRABA 020#dscsvw08.n;
         |LIBERA #dscsvw08;
     |FINSI;

     |SI aTabla = "diario";
         |DDEFECTO #dscsvw13;

         |BUCLE dscsvw10Carga;

         |SI #dscsvw13#0 ! "Tipo";  |Y #dscsvw13#0 ! "    ";
             |HAZ PonDiario;
             |HAZ GrabaDiario;

             |GRABA 020#dscsvw13.n;
             |LIBERA #dscsvw13;
         |FINSI;
     |FINSI;

     |SI aTabla = "asientos";
         |DDEFECTO #dscsvw06;

         |BUCLE dscsvw10Carga;

         |GRABA 020#dscsvw06.n;
         |LIBERA #dscsvw06;
     |FINSI;

     |SI aTabla = "ivaventa";
         |DDEFECTO #dscsvw09;

         |BUCLE dscsvw10Carga;

         |GRABA 000#dscsvw09.n;
         |LIBERA #dscsvw09;
     |FINSI;

     |SI aTabla = "ivacompra";
         |DDEFECTO #dscsvw09;

         |BUCLE dscsvw10Carga;

         |GRABA 000#dscsvw09.n;
         |LIBERA #dscsvw09;
     |FINSI;

     |SI aTabla = "amortiza";
         |DDEFECTO #dscsvw12;

         |BUCLE dscsvw10Carga;

         |GRABA 000#dscsvw12.n;
         |LIBERA #dscsvw12;
     |FINSI;

     |DELINDEX #dscsvw10;
     |PULSATECLA;
|FPRC;

|PROCESO Grabaw10;
/*
     |OEM_ANSI aVar, aVar;
     aAlfa = aVar;
     |HAZ QuitaComillas;
     aVar = aAlfa;
*/

     #dscsvw10#0 = nCmp;
     #dscsvw10#1 = aVar;
     |GRABA 020#dscsvw10.n;
     |LIBERA #dscsvw10;
|FPRC;

|PROCESO SacaDatos;
     aLong  = aLee % 0;
     nLong  = aLong;
     aC10   = &10;
     aC13   = &13;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac = aLee % nPos;

           |SI aCarac = aC13;
               aCarac = ";";
           |FINSI;

           |SI aCarac = ";";
               nCmp   = nCmp + 1;
               |HAZ Grabaw10;

               aVar   = "";
               aCarac = "";
           |FINSI;

           |SI aCarac = aC10;
               aCarac = "";
           |FINSI;

           |SI nCmp = nTotCmp;  |Y nCmp ! 0;
               |HAZ GrabaDatos;

               |ABRE #dscsvw10;

               nCmp = 0;
           |FINSI;

           aVar = aVar + aCarac;
      |SIGUE;
|FPRC;

|PROCESO LeeCSV;
     aAlfa = "Procesando registros del fichero " + aTabla;
     |VENTANA 0501, 0560, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |ABRE #dscsvw10;

     nCmp       = 0;
     nReg       = 0;

     |XABRE "B", aFicCSV, nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 255, aLee;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          |HAZ SacaDatos;
     |SIGUE;
     |XCIERRA nHandle;

     |LEE 000#dscsvw10.p;
     |SI FSalida = 0;
         nCmp   = nCmp + 1;
         |HAZ Grabaw10;
         |HAZ GrabaDatos;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |HAZ Print;

     |ABRE #dscsvw10; |CIERRA #dscsvw10; |DELINDEX #dscsvw10;
|FPRC;

|PROCESO dscsvw07Dupli;
     |SI #dscsvw07@#0 ! #dscsvw07#0;
         nHay = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dscsvw07Dupli;
     #dscsvw07@#3003;
     ;
     eaCuenta, "A", 000000;
     eaCuenta, "A", 999999;
     ;
     NULL, dscsvw07Dupli;
|FIN;

|PROCESO dscsvw07Cheq;
     |SI #dscsvw07#5 ! "A";  |ACABA;  |FINSI;

     |SI nPasada = 1;
         aAlfa = #dscsvw07#1;  |QBF aAlfa;
         |SI aAlfa = "";
             |MENAV "0000Registros con cuentas sin contenido. Cancelamos la importaci¢n";

             nError = 1;
             |ERROR10;
             |ACABA;
         |FINSI;

         aLong = aAlfa % 0;
         nLong = aLong;

         |SI nLong1 = 0;
             nLong1 = nLong;
         |SINO;
             |SI nLong1 ! nLong;
                 nLong2 = nLong;
             |FINSI;
         |FINSI;

         |HAZ CalculaCuenta;
         #dscsvw07#7 = eaCuenta;

         |GRABA 020#dscsvw07.a;
         |LIBERA #dscsvw07;

         |ACABA;
     |FINSI;

     eaCuenta = #dscsvw07#1;  |QBF eaCuenta;
     aLong    = eaCuenta % 0;
     nLong    = aLong;

     |HAZ CalculaCuenta;

     || |SI #dscsvw07#5 = "A";  |Y nLong = nLongMin;  |Y nLong < nLongMax;
     |SI nLong = nLongMin;  |Y nLong < nLongMax;
         nHay = 0;
         |BUCLE dscsvw07Dupli;
         |SI nHay = 1;
             eaCuenta = (eaCuenta % 104) + "1" + (eaCuenta % 612);
         |FINSI;
     |FINSI;

     #dscsvw07#6 = #dscsvw07#1;
     #dscsvw07#1 = eaCuenta;
     #dscsvw07#2 = dig3;

     |GRABA 020#dscsvw07.a;
     |LIBERA #dscsvw07;
|FPRC;

|DEFBUCLE dscsvw07Cheq;
     #dscsvw07#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dscsvw07Cheq;
|FIN;

|PROCESO dscsvw07Gra;
     |SI #dscsvw07#5 ! "A";  |ACABA;  |FINSI;

     #cacuenta#0 = #dscsvw07#1;
     |LEE 000#cacuenta.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #cacuenta#0 = #dscsvw07#1;
     #cacuenta#1 = #dscsvw07#2;
     #cacuenta#2 = #dscsvw07#3;
     #cacuenta#3 = "S";

     |GRABA 020#cacuenta.n;
     |LIBERA #cacuenta;
|FPRC;

|DEFBUCLE dscsvw07Gra;
     #dscsvw07#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw07Gra;
|FIN;

|PROCESO CreaCuentas;
     aFicCSV = #dscsvz11#0;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw07" + Usuario;  |NOME_DAT #dscsvw07#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw07;  |CIERRA #dscsvw07;  |DELINDEX #dscsvw07;

     nTotCmp  = 72;

     |ABRE #dscsvw07;
     aTabla = "cacuenta";
     |HAZ LeeCSV;
     |CIERRA #dscsvw07;

     nError = 0;
     nPasada = 1;
     |BUCLE dscsvw07Cheq;

     nLongMax = 0;
     nLongMin = 0;
     |SI nLong1 > nLong2;
         nLongMax = nLong1;
         nLongMin = nLong2;
     |SINO;
         nLongMax = nLong2;
         nLongMin = nLong1;
     |FINSI;

     |SI nError = 0;
         |DDEF aDef;
         aDef = aDef + "dscsvw07.mas";
         |CARGA_DEF aDef, dscsvw07@;
         aFicTmp = "dscsvw07" + Usuario;  |NOME_DAT #dscsvw07@#aFicTmp#;

         nPasada = 2;
         |BUCLE dscsvw07Cheq;

         |DESCARGA_DEF #dscsvw07@;
     |FINSI;

     |SI nChequeo = 1;
         |CONFI "0000SRegistros de cuentas preparados para importar. Quiere consultarlos antes?";
         |SI FSalida = 0;
             |ABRE #dscsvw07;
             |CONSULTA_CLAVE #1#dscsvw07;
             |CIERRA #dscsvw07;
         |FINSI;
     |FINSI;

     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |DFICB aFic;
              aFic = aFic + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + "/";
              |PATH_DAT #cacuenta#aFic#;

              |ABRE #cacuenta;
              |BUCLE dscsvw07Gra;
              |CIERRA #cacuenta;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;
|FPRC;

|PROCESO dscsvw08Cheq;
     eaCuenta = #dscsvw08#11;
     |HAZ CalculaCuenta;

     #dscsvw08#1  = eaCuenta;
     #dscsvw08#11 = eaCuenta;
     #dscsvw08#12 = dig3;

     aAlfa = #dscsvw08#26 % 102;  #dscsvw08#4 = aAlfa;
     aAlfa = #dscsvw08#26 % 303;  #dscsvw08#5 = aAlfa;

     |GRABA 020#dscsvw08.a;
     |LIBERA #dscsvw08;
|FPRC;

|DEFBUCLE dscsvw08Cheq;
     #dscsvw08#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dscsvw08Cheq;
|FIN;

|PROCESO dscsvw08Gra;
     #caclipro#23 = #dscsvw08#24;
     #caclipro#10 = #dscsvw08#11;
     |LEE 000#caclipro.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 54;  |HACIENDO nCampo = nCampo + 1;
           nDCampo = nCampo - 1;
           #caclipro#nDCampo# = #dscsvw08#nCampo#
     |SIGUE;

     |GRABA 020#caclipro.n;
     |LIBERA #caclipro;

     #cacuenta#0 = #caclipro#10;
     |LEE 000#cacuenta.=;
     |SI FSalida ! 0;
         |DDEFECTO #cacuenta;
         #cacuenta#0 = #caclipro#10;
         #cacuenta#1 = #caclipro#11;
         #cacuenta#2 = #caclipro#1;
         #cacuenta#3 = "S";

         |GRABA 020#cacuenta.n;
         |LIBERA #cacuenta;
     |FINSI;

     eaCodNif = #caclipro#9;
     |HAZ LeeNifs;
     |SI ewNif = 0; |ACABA;  |FINSI;

     |ABRE #regisnif@;
     |DDEFECTO #regisnif@;

     #regisnif@#0  = #caclipro#9;
     #regisnif@#1  = #caclipro#1;
     #regisnif@#2  = #caclipro#2;
     #regisnif@#4  = #caclipro#3;
     #regisnif@#5  = #caclipro#4;
     #regisnif@#7  = #caclipro#5;
     #regisnif@#6  = #caclipro#6;
     #regisnif@#8  = #caclipro#7;
     #regisnif@#17 = #caclipro#8;
     #regisnif@#12 = #caclipro#24;

     |GRABA 020#regisnif@.n;
     |LIBERA #regisnif@;
     |CIERRA #regisnif@;
|FPRC;

|DEFBUCLE dscsvw08Gra;
     #dscsvw08#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw08Gra;
|FIN;

|PROCESO CreaClientes;
     aFicCSV = #dscsvz11#1;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw08" + Usuario;  |NOME_DAT #dscsvw08#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw08;  |CIERRA #dscsvw08;  |DELINDEX #dscsvw08;

     nTotCmp  = 36;

     |ABRE #dscsvw08;
     aTabla = "clientes";
     |HAZ LeeCSV;
     |CIERRA #dscsvw08;

     nError = 0;
     |BUCLE dscsvw08Cheq;
     |SI nChequeo = 1;
         |CONFI "0000SRegistros de clientes preparados para importar. Quiere consultarlos antes?";

         |SI FSalida = 0;
             |ABRE #dscsvw08;
             |CONSULTA_CLAVE #1#dscsvw08;
             |CIERRA #dscsvw08;
         |FINSI;
     |FINSI;

     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |DFICB aFic;
              aFic = aFic + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + "/";
              |PATH_DAT #cacuenta#aFic#;
              |PATH_DAT #caclipro#aFic#;

              |ABRE #cacuenta;
              |ABRE #caclipro;
              |BUCLE dscsvw08Gra;
              |CIERRA #cacuenta;
              |CIERRA #caclipro;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;
|FPRC;

|PROCESO CreaProveedores;
     aFicCSV = #dscsvz11#2;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw08" + Usuario;  |NOME_DAT #dscsvw08#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw08;  |CIERRA #dscsvw08;  |DELINDEX #dscsvw08;

     nTotCmp  = 29;

     |ABRE #dscsvw08;
     aTabla = "proveedores";
     |HAZ LeeCSV;
     |CIERRA #dscsvw08;

     nError = 0;
     |BUCLE dscsvw08Cheq;
     |SI nChequeo = 1;
         |CONFI "0000SRegistros de proveedores preparados para importar. Quiere consultarlos antes?";
         |SI FSalida = 0;
             |ABRE #dscsvw08;
             |CONSULTA_CLAVE #1#dscsvw08;
             |CIERRA #dscsvw08;
         |FINSI;
     |FINSI;

     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |DFICB aFic;
              aFic = aFic + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + "/";
              |PATH_DAT #cacuenta#aFic#;
              |PATH_DAT #caclipro#aFic#;

              |ABRE #cacuenta;
              |ABRE #caclipro;
              |BUCLE dscsvw08Gra;
              |CIERRA #cacuenta;
              |CIERRA #caclipro;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;
|FPRC;

|PROCESO PantaW14;
     |VENTANA 0501, 1260, -1, 16, "Diario DIAGRAM";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |LEE 101#dscsvw13.=;

     |DDEFECTO #dscsvw14;

     #dscsvw14#0 = #dscsvw13#2;
     #dscsvw14#1 = #dscsvw13#3;

     |PINPA #0#dscsvw14;
     |PINDA #0#dscsvw14;

     |ENDATOS #1#dscsvw14;
     |SI FSalida = 0;
         #dscsvw13#2 = #dscsvw14#0;
         #dscsvw13#3 = #dscsvw14#1;

         |GRABA 020#dscsvw13.a;

         |HAZ GrabaDiario;
     |FINSI;
     |LIBERA #dscsvw13;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |REFRESCACONTROL nGrid13;
     |FOCOTECLADO nGrid13;

     |PULSATECLA;
|FPRC;

|PROCESO Evnt13;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dscsvw13.=;
     |FINSI;

     |SI FSalida = 4;
         |HAZ PantaW14;
     |FINSI;
|FPRC;

|PROCESO EntraW13;
     |VENTANA 0501, 3599, -1, 16, "Diarios a definir";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{11}}(Doble click para entrar diarios diagram)", 0502, 0598, NULL;

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dscsvw13, nRango, 601, 3298, NULL, NULL, Evnt13;
     nGrid13 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid13;
          |LEETECLA aTecla;

          |CONFI "0000NLos diarios est n bien definidos";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO dscsvw13Gra;
     #camandia#0 = #dscsvw13#2;
     |LEE 000#camandia.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #camandia;
     #camandia#0 = #dscsvw13#2;
     #camandia#1 = #dscsvw13#3;

     |GRABA 020#camandia.n;
     |LIBERA #camandia;
|FPRC;

|DEFBUCLE dscsvw13Gra;
     #dscsvw13#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw13Gra;
|FIN;

|PROCESO CreaDiario;
     aFicCSV = #dscsvz11#3;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw13" + Usuario;  |NOME_DAT #dscsvw13#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw13;  |CIERRA #dscsvw13;  |DELINDEX #dscsvw13;
     |ABRE #camandia;  |CIERRA #camandia;  |DELINDEX #camandia;

     nTotCmp  = 4;

     |ABRET #dscsvw13;
     |ABRET #camandia;

     aTabla = "diario";
     |HAZ LeeCSV;

     |HAZ EntraW13;

     |CIERRAT #camandia;

     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |DFICB aFic;
              aFic = aFic + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + "/";
              |PATH_DAT #camandia#aFic#;

              |ABRE #camandia;
              |BUCLE dscsvw13Gra;
              |CIERRA #camandia;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;
|FPRC;

|PROCESO dscsvw06Cheq;
     #dscsvw13#0  = #dscsvw06#33;
     |LEE 000#dscsvw13.=;
     |SI FSalida ! 0;  |DDEFECTO #dscsvw13;  |FINSI;

     #dscsvw06#1  = #dscsvw13#2;

     eaCuenta = #dscsvw06#5;
     |HAZ CalculaCuenta;
     #dscsvw06#5  = eaCuenta;
     #dscsvw06#6  = dig3;

     #dscsvw06#2 = #dscsvw06#37;
     aAlfa1 = #dscsvw06#37 % -104;
     aAlfa2 = #dscsvw06#31 % -104;
     |SI aAlfa1 ! aAlfa2
         #dscsvw06#2 = #dscsvw06#31;
     |FINSI;

     aAlfa = #dscsvw06#2;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Registros con fecha de apunte sin contenido. Cancelamos la importaci¢n";

         nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     aAlfa = #dscsvw06#5;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Registros con cuentas sin contenido. Cancelamos la importaci¢n";

         nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI #dscsvw06#9 = " ";
         |MENAV "0000Registros sin signo en la cuenta. Cancelamos la importaci¢n";

         nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI #dscsvw06#9 = "D";
         #dscsvw06#17 = #dscsvw06#5;
         #dscsvw06#18 = #dscsvw06#6;
     |FINSI;

     |SI #dscsvw06#9 = "H";
         #dscsvw06#11 = #dscsvw06#5;
         #dscsvw06#12 = #dscsvw06#6;
     |FINSI;

     |SI #dscsvw06#22 = "  ";
         #dscsvw06#22 = #canempre#30;
     |FINSI;

     #dscsvm10#0 = #dscsvw06#36;
     |LEE 000#dscsvm10.=;
     |SI FSalida ! 0;
         |MENAV "0000Asientos con conceptos sin definir. Proceso cancelado.";
         nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     #dscsvw06#7 = #dscsvm10#2;

     nApun = nApun + 1;
     #dscsvw06#4 = nApun;
     |GRABA 020#dscsvw06.a;
     |LIBERA #dscsvw06;

     aAsiento = #dscsvw06#34;
|FPRC;

|DEFBUCLE dscsvw06Cheq;
     #dscsvw06#1;
     31;
     00000, #dscsvw15#2;
     99999, #dscsvw15#3;
     be;
     NULL, dscsvw06Cheq;
|FIN;

|PROCESO dscsvw06Gra1;
     |SI #dscsvw06#34 ! aAsiento;
         nApun = 0;
         nDocu = nDocu + 1;
     |FINSI;

     #dscsvw06#3  = nDocu;

     nApun = nApun + 1;

     #dscsvw06#4 = nApun;
     |GRABA 020#dscsvw06.a;
     |LIBERA #dscsvw06;

     aAsiento = #dscsvw06#34;
|FPRC;

|DEFBUCLE dscsvw06Gra1;
     #dscsvw06#3;
     31;
     "                                        ", 00000, #dscsvw15#2;
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", 99999, #dscsvw15#3;
     ;
     NULL, dscsvw06Gra1;
|FIN;

|PROCESO dscsvw06Gra2;
     |PARA nCampo = 1;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
           nDCampo = nCampo - 1;
           #camaasil#nDCampo# = #dscsvw06#nCampo#
     |SIGUE;

     #camaasil#26 = #dscsvw06#35;

     |GRABA 020#camaasil.n;
     |LIBERA #camaasil;

     #camaasic#0 = #camaasil#0;
     #camaasic#1 = #camaasil#1;
     #camaasic#2 = #camaasil#2;
     |LEE 000#camaasic.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #camaasic;
     #camaasic#0  = #camaasil#0;
     #camaasic#1  = #camaasil#1;
     #camaasic#2  = #camaasil#2;
     #camaasic#3  = #camaasil#2;
     #camaasic#17 = #dscsvw06#35;
     |GRABA 020#camaasic.n;
     |LIBERA #camaasic;
|FPRC;

|DEFBUCLE dscsvw06Gra2;
     #dscsvw06#1;
     31;
     00000, #dscsvw15#2;
     99999, #dscsvw15#3;
     ;
     NULL, dscsvw06Gra2;
|FIN;

|PROCESO PasaAsiento;
     nError = 0;
     |BUCLE dscsvw06Cheq;
     |SI nError = 1;
         |ACABA;
     |FINSI;

     |SI nChequeo = 1;
         |CONFI "0000SRegistros de asientos preparados para importar. Quiere consultarlos antes?";
         |SI FSalida = 0;
             |ABRE #dscsvw06;
             |CONSULTA_CLAVE #1#dscsvw06;
             |CIERRA #dscsvw06;
         |FINSI;
     |FINSI;

     |DFICB aFic;
     aFic = aFic + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + "/";

     |PATH_DAT #camandia#aFic#;
     |PATH_DAT #camaasic#aFic#;
     |PATH_DAT #camaasil#aFic#;

     |ABRET #camandia;
     |ABRET #camaasic;
     |ABRET #camaasil;

     nDocu = 0;
     nApun = 0;
     |SELECT #3#camaasic;
     |LEE 000#camaasic.u;
     |SI FSalida = 0;
         nDocu = #camaasic#2;
     |FINSI;

     aAsiento = "";
     |BUCLE dscsvw06Gra1;
     |BUCLE dscsvw06Gra2;

     |CIERRAT #camandia;
     |CIERRAT #camaasic;
     |CIERRAT #camaasil;
|FPRC;

|PROCESO CreaAsientos;
     aFicCSV = #dscsvz11#4;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw06" + Usuario;  |NOME_DAT #dscsvw06#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw06;  |CIERRA #dscsvw06;  |DELINDEX #dscsvw06;

     nTotCmp  = 27;

     |ABRE #dscsvw06;
     aTabla = "asientos";
     |HAZ LeeCSV;
     |CIERRA #dscsvw06;


     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |HAZ PasaAsiento;
              |SI nError = 1;  |SAL;  |FINSI;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;
|FPRC;

|PROCESO dscsvw09Cheq;
     aLibro =  #dscsvw09#3;  |QBF aLibro;

     |SI aTabla = "ivaventa";
         |SI #dscsvw09#13 = "P";  |O #dscsvw09#13 = "I";
             |BORRA 020#dscsvw09.a;
             |LIBERA #dscsvw09;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI aTabla = "ivacompra";
         aAlfa = #dscsvw09#14 % 102;
         |SI aAlfa = "64";
             |BORRA 020#dscsvw09.a;
             |LIBERA #dscsvw09;
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa =  #dscsvw09#2;  |QBF aAlfa;
     |SI aAlfa = "";
          |BORRA 020#dscsvw09.a;
          |LIBERA #dscsvw09;
          |ACABA;
     |FINSI;

     aAlfa =  #dscsvw09#3;  |QBF aAlfa;
     |SI aAlfa = "Tipo de asiento";
          |BORRA 020#dscsvw09.a;
          |LIBERA #dscsvw09;
          |ACABA;
     |FINSI;

     #dscsvw09#12 = aLibro;
     |GRABA 020#dscsvw09.a;
     |LIBERA #dscsvw09;
|FPRC;

|DEFBUCLE dscsvw09Cheq;
     #dscsvw09#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dscsvw09Cheq;
|FIN;

|PROCESO camaasil;
     |SI #camaasil#9 = nITot;
         aAlfa = #camaasil#4 % 103;
         |SI aAlfa = "400";  |O aAlfa = "410";
          |O aAlfa = "430";  |O aAlfa = "440";
             aCtaTot = #camaasil#4;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #camaasil#9 = nIBas;
         aCtaBas = #camaasil#4;
         |ACABA;
     |FINSI;

     |SI #camaasil#9 = nIIva;
         aCtaIva = #camaasil#4;
         |ACABA;
     |FINSI;

     |SI aCtaRet = "";
         aAlfa = aCtaTot % 103;
         |SI aAlfa = "400";  |O aAlfa = "410";
          |O aAlfa = "430";  |O aAlfa = "440";
             aAlfa = #camaasil#4 % 103;
             |SI aAlfa = "475";  |O aAlfa = "473";
                 aCtaRet = #camaasil#4;
                 nIRet   = #camaasil#9;
                 |SI #dscsvw09#8 < 0;
                     nIRet = -#camaasil#9;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE camaasil;
     #camaasil#1;
     ;
     #camaasic#0, #camaasic#1, #camaasic#2, 0001;
     #camaasic#0, #camaasic#1, #camaasic#2, 9999;
     ;
     NULL, camaasil;
|FIN;

|PROCESO camaasilGra;
     #camaasil#12 = #camaniva#36;
     #camaasil#13 = #camaniva#0;
     #camaasil#14 = #camaniva#3;
     #camaasil#15 = #camaniva#2;
     #camaasil#20 = 1;

     |SI aCtaBas = #camaasil#4;  #camaasil#19 = "B";  |FINSI;
     |SI aCtaIva = #camaasil#4;  #camaasil#19 = "I";  |FINSI;
     |SI aCtaTot = #camaasil#4;  #camaasil#19 = "F";  #camaasil#20 = 0;  |FINSI;
     |SI aCtaRet = #camaasil#4;
         |SI #camaniva#0 = 1;  #camaasil#6 = 500;  |FINSI;
         |SI #camaniva#0 = 2;  #camaasil#6 = 410;  |FINSI;

         nConcep = #camaasil#6;  |HAZ LeeConcep;
         #camaasil#7  = aDescri;
         #camaasil#19 = "P";
     |FINSI;

     |GRABA 020#camaasil.a;
     |LIBERA #camaasil;
|FPRC;

|DEFBUCLE camaasilGra;
     #camaasil#1;
     ;
     #camaasic#0, #camaasic#1, #camaasic#2, 0001;
     #camaasic#0, #camaasic#1, #camaasic#2, 9999;
     be;
     NULL, camaasilGra;
|FIN;

|PROCESO dscsvw06Bus;
     |SI aCtaTot = "";
         aAlfa = #dscsvw06#5 % 103;
         |SI aAlfa = "400";  |O aAlfa = "410";
          |O aAlfa = "430";  |O aAlfa = "440";
             aCtaTot = #dscsvw06#5;  |QBF aCtaTot;
         |FINSI;
     |FINSI;

     |SI aCtaBas = "";
         aAlfa = #dscsvw06#5 % 101;
         |SI aAlfa ! "4";  |Y aAlfa ! " ";
             aCtaBas = #dscsvw06#5;  |QBF aCtaBas;
         |FINSI;
     |FINSI;

     |SI aCtaIva = "";
         aAlfa = #dscsvw06#5 % 103;
         |SI aAlfa = "472";  |O aAlfa = "477";
             aCtaIva = #dscsvw06#5;  |QBF aCtaIva;
         |FINSI;
     |FINSI;

     |SI aCtaTot ! "";  |Y aCtaBas ! "";  |Y aCtaIva ! "";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dscsvw06Bus;
     #dscsvw06#3;
     33;
     #camaasic#17, 00000, #dscsvw13#0;
     #camaasic#17, 99999, #dscsvw13#0;
     ;
     NULL, dscsvw06Bus;
|FIN;

|PROCESO LeeConcep;
     #dsmom030#0 = nConcep;
     |LEE 000#dsmom030.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom030;  |FINSI;

     aDescri = #dsmom030#1;
|FPRC;

|PROCESO dscsvw09Gra;
     |SELECT #2#dscsvw13;
     #dscsvw13#1 = #dscsvw09#15;
     |LEE 000#dscsvw13.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nError = 1;
     |SELECT #4#dscsvw06;
     #dscsvw06#37 = #dscsvw09#1;
     #dscsvw06#8  = #dscsvw09#4;
     #dscsvw06#34 = #dscsvw09#16;
     |LEE 000#dscsvw06.];
     |SI FSalida = 0;
         aAlfa1 = #dscsvw06#37;   |QBF aAlfa1;
         aAlfa2 = #dscsvw06#8;    |QBF aAlfa2;
         aAlfa3 = #dscsvw06#34;   |QBF aAlfa3;
         aAlfa4 = #dscsvw09#1;    |QBF aAlfa4;
         aAlfa5 = #dscsvw09#4;    |QBF aAlfa5;
         aAlfa6 = #dscsvw09#16;   |QBF aAlfa6;

         |SI aAlfa1 = aAlfa4;
          |Y aAlfa2 = aAlfa5;
          |Y aAlfa3 = aAlfa6;
             |SELECT #1#camaasic;
             #camaasic#0 = #dscsvw06#1;
             #camaasic#1 = #dscsvw06#2;
             #camaasic#2 = #dscsvw06#3;
             |LEE 000#camaasic.=;
             |SI FSalida = 0;  nError = 0;  |FINSI;
         |FINSI;
     |FINSI;

     |SI nError = 1;
         |SELECT #5#camaasic;
         #camaasic#17 = #dscsvw09#2;
         |LEE 000#camaasic.];
         |PARA;  |SI;  |HACIENDO;
              |SI FSalida ! 0;  |SAL;  |FINSI;

              aAlfa1 = #camaasic#17;  |QBF aAlfa1;
              aAlfa2 = #dscsvw09#2;   |QBF aAlfa2;
              |SI aAlfa1 ! aAlfa2;
                  |SAL;
              |FINSI;

              |SI #camaasic#0 = #dscsvw13#2;
                  nError = 0;
                  |SAL;
              |FINSI;

              |LEE 000#camaasic.s;
         |SIGUE;
     |FINSI;

     |SI nError = 1;
         |ACABA;
     |FINSI;

     |SI #dscsvw09#4 ! aNumFac;  |O #dscsvw09#1  ! fFechaFac;
                                 |O #dscsvw09#16 ! aNumAsi;
         aCtaRet = "";
         nIRet   = 0;
     |FINSI;

     nIBas = #dscsvw09#8;  aCtaBas = "";
     nIIva = #dscsvw09#7;  aCtaIva = "";
     nITot = #dscsvw09#6;  aCtaTot = "";

     |SI nIBas < 0; nIBas = -nIBas;  |FINSI;
     |SI nIIva < 0; nIIva = -nIIva;  |FINSI;
     |SI nITot < 0; nITot = -nITot;  |FINSI;

                                nLibro = 1;
     |SI aTabla = "ivacompra";  nLibro = 2;  |FINSI;

     aCtaTot = #dscsvw09#14;  |QBF aCtaTot;
     |BUCLE camaasil;

     |SI aCtaTot = "";  |O aCtaBas = "";  |O aCtaIva = "";
         |BUCLE dscsvw06Bus;
     |FINSI;

     nIBas = #dscsvw09#8;
     nIIva = #dscsvw09#7;
     nITot = #dscsvw09#6;

     |SI nLibro = 2;
         |SI nIIva = 0;
             aAlfa   = aCtaTot % 101;
             |SI aAlfa = "2";  |O aAlfa = "6";
                 aAlfa   = aCtaTot;
                 aCtaTot = aCtaBas;
                 aCtaBas = aAlfa;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #dscsvw09#4 ! aNumFac;  |O #dscsvw09#1  ! fFechaFac;
                                 |O #dscsvw09#16 ! aNumAsi;
         #camaniva#0 = nLibro;
         #camaniva#1 = 9999999999;
         |LEE 000#camaniva.];
         |SI FSalida = 0;
             |LEE 000#camaniva.a;
         |SINO;
             |LEE 000#camaniva.u;
         |FINSI;

         nDocu = 1;
         |SI FSalida = 0;  |Y #camaniva#0 = nLibro;
             nDocu = #camaniva#1 + 1;
         |FINSI;

         |DDEFECTO #camaniva;
         #camaniva#0  = nLibro;
         #camaniva#1  = nDocu;
         #camaniva#2  = "";
         #camaniva#3  = nDocu;
         #camaniva#4  = #dscsvw09#1;
         aAlfa        = #camaasic#1 % 402;  #camaniva#5 = aAlfa;
         #camaniva#6  = "N";
         #camaniva#7  = #camaasic#0;
         #camaniva#8  = #camaasic#1;
         #camaniva#9  = #camaasic#2;
         #camaniva#10 = #canempre#30;
         #camaniva#24 = #canempre#32;
         #camaniva#12 = aCtaTot;
         #camaniva#13 = #dscsvw09#11;

         aAlfa = #camaniva#13; |QBF aAlfa;
         |SI aAlfa = "";
             #cacuenta#0 = #camaniva#12;
             |LEE 000#cacuenta.=;
             |SI FSalida ! 0;  |DDEFECTO #cacuenta;  |FINSI;

             #camaniva#13 = #cacuenta#2;
         |FINSI;

         #camaniva#14 = #dscsvw09#10;
         #camaniva#27 = 700;
         #camaniva#36 = "R";
         |SI #camaniva#0 = 2;
             #camaniva#27 = 600;
             #camaniva#36 = "S";
         |FINSI;
         #camaniva#22 = #camaasic#17;
         #camaniva#29 = #camaniva#27;

         nConcep = #camaniva#27;  |HAZ LeeConcep;  #camaniva#28 = aDescri;
         nConcep = #camaniva#29;  |HAZ LeeConcep;  #camaniva#30 = aDescri;

         |SI nLibro = 2;
             #camaniva#42 = #dscsvw09#13;
         |FINSI;

         |GRABA 020#camaniva.n;
         |LIBERA #camaniva;

         nApun = 0;
     |FINSI;

     nApun = nApun + 1;

     |DDEFECTO #caivalin;
     #caivalin#0  = #camaniva#0;
     #caivalin#1  = #camaniva#1;
     #caivalin#2  = nApun;
     #caivalin#3  = #camaniva#27;
     #caivalin#6  = nIBas;
     #caivalin#7  = #dscsvw09#5;
     #caivalin#8  = nIIva;
     #caivalin#12 = aCtaBas;
     #caivalin#13 = aCtaIva;
     #caivalin#30 = #camaniva#10;

     |SI nIRet ! 0;
         #caivalin#20 = nIBas;
         #caivalin#22 = nIRet;
         #caivalin#21 = ((nIRet * 100) / nIBas) ! 2;
         #caivalin#23 = aCtaRet;

         |SI #camaniva#0 = 1;  #caivalin#18 = 500;  |FINSI;
         |SI #camaniva#0 = 2;  #caivalin#18 = 410;  |FINSI;
     |FINSI;

     nConcep = #caivalin#3;  |HAZ LeeConcep;  #caivalin#4  = aDescri;
     nConcep = #caivalin#18; |HAZ LeeConcep;  #caivalin#19 = aDescri;

     efFechaIVA = #camaniva#4;
     enLineaIVA = 0;
     enPorcIVA  = #caivalin#7;
     enPorcREC  = #caivalin#9;
     aTipoIVA   = "S";
     |HAZ BuscaTipoIVA;
     #caivalin#16 = enLineaIVA;

     |GRABA 020#caivalin.n;
     |LIBERA #caivalin;

     |BUCLE camaasilGra;

     aReferen  = #dscsvw09#2;
     aTipoDia  = #dscsvw09#15;
     fFechaFac = #dscsvw09#1;
     aNumFac   = #dscsvw09#4;
     aNumAsi   = #dscsvw09#16;
     nIRet     = 0;
|FPRC;

|DEFBUCLE dscsvw09Gra;
     #dscsvw09#4;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw09Gra;
|FIN;

|PROCESO CreaIvaVenta;
     aFicCSV = #dscsvz11#5;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw09" + Usuario;  |NOME_DAT #dscsvw09#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw09;  |CIERRA #dscsvw09;  |DELINDEX #dscsvw09;

     nTotCmp  = 27;

     |ABRE #dscsvw09;
     aTabla = "ivaventa";
     |HAZ LeeCSV;
     |CIERRA #dscsvw09;

     |BUCLE dscsvw09Cheq;

     |SI nChequeo = 1;
         |CONFI "0000SRegistros de IVA preparados para importar. Quiere consultarlos antes?";

         |SI FSalida = 0;
             |ABRE #dscsvw09;
             |CONSULTA_CLAVE #1#dscsvw09;
             |CIERRA #dscsvw09;
         |FINSI;
     |FINSI;

     |ABRET #dscsvw06;
     |BUCLE dscsvw09Gra;
     |CIERRAT #dscsvw06;
|FPRC;

|PROCESO CreaIvaCompra;
     aFicCSV = #dscsvz11#6;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw09" + Usuario;  |NOME_DAT #dscsvw09#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw09;  |CIERRA #dscsvw09;  |DELINDEX #dscsvw09;

     nTotCmp  = 27;

     |ABRE #dscsvw09;
     aTabla = "ivacompra";
     |HAZ LeeCSV;
     |CIERRA #dscsvw09;

     |BUCLE dscsvw09Cheq;

     |SI nChequeo = 1;
         |CONFI "0000SRegistros de IVA preparados para importar. Quiere consultarlos antes?";

         |SI FSalida = 0;
             |ABRE #dscsvw09;
             |CONSULTA_CLAVE #1#dscsvw09;
             |CIERRA #dscsvw09;
         |FINSI;
     |FINSI;

     |ABRET #dscsvw06;
     |BUCLE dscsvw09Gra;
     |CIERRAT #dscsvw06;
|FPRC;

|PROCESO dsmom040;
     |SI #dsmom040#10 = #dscsvw12#8;
      |Y #dsmom040#12 = #dscsvw12#9;
         nGrupo = #dsmom040#2;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom040;
     #dsmom040#1;
     ;
     enEmpresa, 0001;
     enEmpresa, 9999;
     ;
     NULL, dsmom040;
|FIN;

|PROCESO GrabaLinAmor;
     nLinea = nLinea + 1;

     |DDEFECTO #dsmom042;
     #dsmom042#0  = #dsmom041#0;
     #dsmom042#1  = #dsmom041#1;
     #dsmom042#2  = #dsmom041#2;
     #dsmom042#3  = #dsmom041#3;
     #dsmom042#4  = nLinea;
     #dsmom042#5  = aAnyo;
     #dsmom042#6  = aTipo;
     #dsmom042#7  = nImpor;
     #dsmom042#8  = "S";
     #dsmom042#9  = fFecha;

     |SI aTipo = "A";
         aAlfa       = "31.12." + aAnyo;
         #dsmom042#9 = aAlfa;
     |FINSI;

     #dscsvm10#0  = #dscsvw12#1;
     |LEE 000#dscsvm10.=;
     |SI FSalida ! 0;  |DDEFECTO #dscsvm10;  |FINSI;

     #dsmom042#12 = #dscsvm10#2;
     #dsmom042#10 = #dscsvm10#3;
     #dsmom042#11 = nImpor;
     #dsmom042#13 = 0;
     |GRABA 020#dsmom042.n;
     |LIBERA #dsmom042;
|FPRC;

|PROCESO dscsvw12Gra;
     eaCuenta = #dscsvw12#7;  |HAZ CalculaCuenta;  #dscsvw12#7 = eaCuenta;
     eaCuenta = #dscsvw12#8;  |HAZ CalculaCuenta;  #dscsvw12#8 = eaCuenta;
     eaCuenta = #dscsvw12#9;  |HAZ CalculaCuenta;  #dscsvw12#9 = eaCuenta;

     aIde     =  #dscsvw12#5;  |QBF aIde;
     eaCuenta = "410" + aIde;  |HAZ CalculaCuenta;  #dscsvw12#5 = eaCuenta;
     #caclipro#23 = "P";
     #caclipro#10 = #dscsvw12#5;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;
         eaCuenta = "400" + aIde;  |HAZ CalculaCuenta;  #dscsvw12#5 = eaCuenta;
         #caclipro#23 = "P";
         #caclipro#10 = #dscsvw12#5;
         |LEE 000#caclipro.=;
         |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;
     |FINSI;

     nGrupo = 0;
     |BUCLE dsmom040;

     |SI nGrupo = 0;
         |PARA nGrupo = 1;  |SI nGrupo [ 9999;  |HACIENDO nGrupo = nGrupo + 1;
               #dsmom040#0 = enEmpresa;
               #dsmom040#2 = nGrupo;
               |LEE 000#dsmom040.=;
               |SI FSalida ! 0;  |SAL;  |FINSI;
         |SIGUE;

         |DDEFECTO #dsmom040;
         #dsmom040#0 = enEmpresa;
         #dsmom040#2 = nGrupo;
         #dsmom040#7 = "Grupo " + (("0000" + nGrupo) % -104);
         #dsmom040#8 = #canempre#1;

         eaCuenta = #dscsvw12#9;  |HAZ CalculaCuenta;
         #dsmom040#10 = eaCuenta;
         #dsmom040#11 = dig3;

         eaCuenta = #dscsvw12#8;  |HAZ CalculaCuenta;
         #dsmom040#12 = eaCuenta;
         #dsmom040#13 = dig3;

         |GRABA 020#dsmom040.n;
         |LIBERA #dsmom040;
     |FINSI;

     |PARA nElem = 1;  |SI nElem [ 99999999;  |HACIENDO nElem = nElem + 1;
           #dsmom041#0 = enEmpresa;
           #dsmom041#2 = nElem;
           #dsmom041#3 = 0;
           |LEE 000#dsmom041.=;
           |SI FSalida ! 0;  |SAL;  |FINSI;
     |SIGUE;

     |DDEFECTO #dsmom041;
     #dsmom041#0 = enEmpresa;
     #dsmom041#1 = 1;
     #dsmom041#2 = nElem;
     #dsmom041#3 = 0;

     aAlfa = #dscsvw12#3;  |QBF aAlfa;
     aAlfa = aAlfa + " " + #dscsvw12#4;
     #dsmom041#4 = aAlfa;

     eaCuenta = #dscsvw12#7;  |HAZ CalculaCuenta;
     #dsmom041#5 = eaCuenta;
     #dsmom041#6 = dig3;

     #dsmom041#7 = 0;

     #caclipro#23 = "P";
     #caclipro#10 = #dscsvw12#5;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     #dsmom041#8  = #caclipro#1;
     #dsmom041#9  = #dscsvw12#2;
     #dsmom041#27 = #dscsvw12#2;
     #dsmom041#10 = #dscsvw12#6;
     #dsmom041#13 = "N";
     #dsmom041#14 = #dscsvw12#12 * #dscsvw12#13;
     #dsmom041#18 = #dsmom040#2;
     #dsmom041#19 = #dsmom041#13;
     #dsmom041#20 = #dsmom041#14;

     #dsmom041#24 = "A";
     |SI #dscsvw12#10 ! "A";  #dsmom041#24 = "P";  |FINSI;

     #dsmom041#32 = #canempre#1;
     #dsmom041#57 = 1;

     |GRABA 020#dsmom041.n;
     |LIBERA #dsmom041;

     nLinea = 0;
     aTipo  = "C";
     aAnyo  = #dsmom041#27 % -104;
     nImpor = #dsmom041#10;
     fFecha = #dsmom041#27;
     |HAZ GrabaLinAmor;

     |PARA nCampo1 = 14;  |SI nCampo1 [ 60;  |HACIENDO nCampo1 = nCampo1 + 2;
           nCampo2 = nCampo1 + 1;
           |SI #dscsvw12#nCampo2# ! 0;
               aTipo  = "A";
               aAnyo  = #dscsvw12#nCampo1#;
               nImpor = #dscsvw12#nCampo2#;
               aAlfa  = (#dsmom041#27 % 106) + aAnyo;
               fFecha = aAlfa;
               |HAZ GrabaLinAmor;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dscsvw12Gra;
     #dscsvw12#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw12Gra;
|FIN;

|PROCESO CreaAmortizacion;
     aFicCSV = #dscsvz11#7;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     aFicTmp = "dscsvw12" + Usuario;  |NOME_DAT #dscsvw12#aFicTmp#;
     aFicTmp = "dscsvw10" + Usuario;  |NOME_DAT #dscsvw10#aFicTmp#;

     |ABRE #dscsvw12;  |CIERRA #dscsvw12;  |DELINDEX #dscsvw12;

     nTotCmp  = 66;

     |ABRE #dscsvw12;
     aTabla = "amortiza";
     |HAZ LeeCSV;
     |CIERRA #dscsvw12;

     |SI nChequeo = 1;
         |CONFI "0000SRegistros de cuentas preparados para importar. Quiere consultarlos antes?";
         |SI FSalida = 0;
             |ABRE #dscsvw12;
             |CONSULTA_CLAVE #1#dscsvw12;
             |CIERRA #dscsvw12;
         |FINSI;
     |FINSI;

     |BUCLE dscsvw12Gra;
|FPRC;

|PROCESO Recalculos;
     |SI aModAsiento = "NO";
         aAlfa = "*:contagen/careccab canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "100";
     |SINO;
         aAlfa = "*:contagen/careccab canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "000";
     |FINSI;
     |SUB_EJECUTA aAlfa;

     aAlfa = "*:contagen/caz00023 canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "CREA";
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO Informes;
     aAlfa = "0000Chequeo general de asientos ejercicio " + #dscsvw15#0;
     |MENAV aAlfa;
     aAlfa = "*:contagen/cacheapu canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     |SI #dscsvw15#1 = enPeriodo;
         aAlfa = "0000Chequeo general de facturas ejercicio " + #dscsvw15#0;
         |MENAV aAlfa;
         aAlfa = "*:contagen/caconiva canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "CHEQUEO";
         |SUB_EJECUTA aAlfa;

         aAlfa = "0000Chequeo cuentas de IVA ejercicio " + #dscsvw15#0;
         |MENAV aAlfa;
         aAlfa = "*:contagen/cacheiva canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "CHEQUEO";
         |SUB_EJECUTA aAlfa;
     |FINSI;

     aAlfa = "0000Asistente de balances ejercicio " + #dscsvw15#0;
     |MENAV aAlfa;
     aAlfa = "*:contagen/caut0009 canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;

     aAlfa = "*:contagen/carecupe canempr1 " + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + ";" + "CHEQUEO";
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO Importacion;
     nCheqCuentas = 0;
     |HAZ CreaCuentas;
     |HAZ CreaClientes;
     |HAZ CreaProveedores;

     nCheqCuentas = 1;
     |ABRET #dscsvw07;  |SELECT #2#dscsvw07;

     |HAZ CreaDiario;
     |HAZ CreaAsientos;

     |SI nError = 1;  |ACABA;  |FINSI;

     |DFICE aFic;

     |PATH_DAT #cacuenta#aFic#;
     |PATH_DAT #caclipro#aFic#;
     |PATH_DAT #camandia#aFic#;
     |PATH_DAT #camaasic#aFic#;
     |PATH_DAT #camaasil#aFic#;

     |ABRET #cacuenta;
     |ABRET #caclipro;
     |ABRET #camandia;
     |ABRET #camaasic;
     |ABRET #camaasil;
     |ABRET #camaniva;
     |ABRET #caivalin;

     |HAZ CreaIvaVenta;
     |HAZ CreaIvaCompra;
     |HAZ CreaAmortizacion;

     |CIERRAT #dscsvw07;
     |CIERRAT #dscsvw13;
     |CIERRAT #camandia;
     |CIERRAT #camaasic;
     |CIERRAT #camaasil;

     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |HAZ Recalculos;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;

     |MENAV "0000Importaci¢n realizada. A continuaci¢n se van a realizar una serie de chequeos";

     |LEE 000#dscsvw15.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dscsvw15#4 = "S";
              |HAZ Informes;
          |FINSI;

          |LEE 000#dscsvw15.s;
     |SIGUE;

     |MENAV "0000Proceso terminado.";
|FPRC;

|PROCESO Ubica;
     nFSalida = FSalida;

     |ESTADO_CONTROL nBtnCar1, "DISABLE";
     |ESTADO_CONTROL nBtnCar2, "DISABLE";
     |ESTADO_CONTROL nBtnCar3, "DISABLE";
     |ESTADO_CONTROL nBtnCar4, "DISABLE";
     |ESTADO_CONTROL nBtnCar5, "DISABLE";
     |ESTADO_CONTROL nBtnCar6, "DISABLE";
     |ESTADO_CONTROL nBtnCar7, "DISABLE";
     |ESTADO_CONTROL nBtnCar8, "DISABLE";
     |ESTADO_CONTROL nBtnCan,  "DISABLE";
     |ESTADO_CONTROL nBtnCon,  "DISABLE";

     |HAZ Browse;

     |ESTADO_CONTROL nBtnCar1, "ENABLE";
     |ESTADO_CONTROL nBtnCar2, "ENABLE";
     |ESTADO_CONTROL nBtnCar3, "ENABLE";
     |ESTADO_CONTROL nBtnCar4, "ENABLE";
     |ESTADO_CONTROL nBtnCar5, "ENABLE";
     |ESTADO_CONTROL nBtnCar6, "ENABLE";
     |ESTADO_CONTROL nBtnCar7, "ENABLE";
     |ESTADO_CONTROL nBtnCar8, "ENABLE";
     |ESTADO_CONTROL nBtnCan,  "ENABLE";
     |ESTADO_CONTROL nBtnCon,  "ENABLE";

     |SI aFicBrowse = "";  |ACABA;  |FINSI;

     |SI nFSalida = nBtnCar1;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "cuentas.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#0 = aDestino;  |PINTA #dscsvz11#0;
     |FINSI;

     |SI nFSalida = nBtnCar2;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "clientes.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#1 = aDestino;  |PINTA #dscsvz11#1;
     |FINSI;

     |SI nFSalida = nBtnCar3;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "proveedores.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#2 = aDestino;  |PINTA #dscsvz11#2;
     |FINSI;

     |SI nFSalida = nBtnCar4;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "diario.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#3 = aDestino;  |PINTA #dscsvz11#3;
     |FINSI;

     |SI nFSalida = nBtnCar5;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "asientos.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#4 = aDestino;  |PINTA #dscsvz11#4;
     |FINSI;

     |SI nFSalida = nBtnCar6;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "ivaventa.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#5 = aDestino;  |PINTA #dscsvz11#5;
     |FINSI;

     |SI nFSalida = nBtnCar7;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "ivacompra.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#6 = aDestino;  |PINTA #dscsvz11#6;
     |FINSI;

     |SI nFSalida = nBtnCar8;
         aOrigen  = aFicBrowse;
         aDestino = aPathTmp + "inmovi.csv";

         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |RECIBE_FICHERO aOrigen, aDestino;
         |FINSI;

         #dscsvz11#7 = aDestino;  |PINTA #dscsvz11#7;
     |FINSI;
|FPRC;

|PROCESO Cancelar;
     |PTEC 807;
|FPRC;

|PROCESO Chequeo;
     nError = 0;
     |LEE 000#dscsvm10.p;
     |SI FSalida ! 0;
         nError = 1;
         |MENAV "0000No se puede realizar la importaci¢n no est n los conceptos definidos.";
         |ACABA;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 4;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dscsvz11#nCampo#;  |QBF aAlfa;
           |SI aAlfa = ""; nError = 1;  |SAL;  |FINSI;
     |SIGUE;

     |SI nError = 1;
         |MENAV "0000Faltan ficheros a informar";
     |FINSI;
|FPRC;

|PROCESO CreaConceptos;
     aFicCSV = aPathTmp + "conceptos.csv";

     nTotCmp  = 6;
     aTabla   = "conceptos";
     |HAZ LeeCSV;
|FPRC;

|PROCESO PantaW11;
     |VENTANA 0501, 1260, -1, 16, "Concepto DIAGRAM";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |LEE 101#dscsvm10.=;

     |DDEFECTO #dscsvw11;

     #dscsvw11#0 = #dscsvm10#2;
     #dscsvw11#1 = #dscsvm10#3;

     |PINPA #0#dscsvw11;
     |PINDA #0#dscsvw11;

     |ENDATOS #1#dscsvw11;
     |SI FSalida = 0;
         #dscsvm10#2 = #dscsvw11#0;
         #dscsvm10#3 = #dscsvw11#1;

         |GRABA 020#dscsvm10.a;
     |FINSI;
     |LIBERA #dscsvm10;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |REFRESCACONTROL nGrid10;
     |FOCOTECLADO nGrid10;

     |PULSATECLA;
|FPRC;

|PROCESO Evnt10;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dscsvm10.=;
     |FINSI;

     |SI FSalida = 4;
         |HAZ PantaW11;
     |FINSI;
|FPRC;

|PROCESO ImportaConcep;
     aAlfa = "0000La tabla de conceptos est  vac¡a. ";
     aAlfa = aAlfa + "A continuaci¢n seleccione el fichero que contiene ";
     aAlfa = aAlfa + "los conceptos SYGA";
     |MENAV aAlfa;

     |HAZ Browse;

     |SI aFicBrowse = "";
         |MENAV "0000Importaci¢n cancelada.";
         |ACABA;
     |FINSI;

     aOrigen  = aFicBrowse;
     aDestino = aPathTmp + "conceptos.csv";

     |SI eaIP = "";
         |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
         |RECIBE_FICHERO aOrigen, aDestino;
     |FINSI;

     |HAZ CreaConceptos;
|FPRC;

|PROCESO EntraM10;
     |LEE 000#dscsvm10.p;
     |SI FSalida ! 0;
         |HAZ ImportaConcep;
     |FINSI;

     |LEE 000#dscsvm10.p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 3599, -1, 16, "Conceptos a definir";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{11}}(Doble click para entrar conceptos diagram)", 0502, 0598, NULL;

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dscsvm10, nRango, 601, 3298, NULL, NULL, Evnt10;
     nGrid10 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid10;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO canempre;
     #dscsvw15#0 = 2000 + #canempre#26;
     |LEE 000#dscsvw15.=;
     |SI FSalida = 0;
         nError = 1;
         |MENAV "0000Ejercicios repetidos en el acceso de Contagen";

         |ACABA;
     |FINSI;

     |DDEFECTO #dscsvw15;

     #dscsvw15#0 = 2000 + #canempre#26;
     #dscsvw15#1 = #canempre#3;

     aAlfa = "01." + (("00" + #canempre#11) % -102) + "." + #dscsvw15#0;
     #dscsvw15#2 = aAlfa;

     aAlfa = "31." + (("00" + #canempre#12) % -102) + "." + #dscsvw15#0;
     #dscsvw15#3 = aAlfa;

     |SI #canempre#11 ! 1;
         aAlfa = "01." + (("00" + #canempre#11) % -102) + "." + #dscsvw15#0;
         #dscsvw15#2 = aAlfa;

         nAnyo = #dscsvw15#0 + 1;
         aAnyo = nAnyo;

         aAlfa = "31." + (("00" + #canempre#12) % -102) + "." + aAnyo;
         #dscsvw15#3 = aAlfa;
     |FINSI;

     |SI #dscsvw15#1 = enPeriodo;
         #dscsvw15#4 = "S";
         #dscsvw15#5 = aVerde;
     |FINSI;

     |GRABA 020#dscsvw15.n;
     |LIBERA #dscsvw15;
|FPRC;

|DEFBUCLE canempre;
     #canempre#1;
     ;
     enEmpresa, 0;
     enEmpresa, 9;
     ;
     NULL, canempre;
|FIN;

|PROCESO Evnt15;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dscsvw15.=;
     |FINSI;

     |SI FSalida = 4;
         |SI #dscsvw15#0 > enEjercicio;
             |MENAV "0000No podemos seleccionar un ejercicio superior al periodo donde nos encontramos";
             |ACABA;
         |FINSI;

         |DDEF aDef;
         aDef = aDef + "camaasil.mas";
         |CARGA_DEF aDef, camaasil@;

         |DFICB aFic;
         aFic = aFic + (("00000" + enEmpresa) % -105) + #dscsvw15#1 + "/";
         |PATH_DAT #camaasil@#aFic#;

         |ABRE #camaasil@;
         |LEE 000#camaasil@.p;
         |SI FSalida = 0;
             |CIERRA #camaasil@;
             |DESCARGA_DEF #camaasil@;

             |MENAV "0000Ya existe movimientos en esta empresa/periodo. Cancelamos la importaci¢n";
             |ACABA;
         |FINSI;
         |CIERRA #camaasil@;
         |DESCARGA_DEF #camaasil@;

         |LEE 101#dscsvw15.=;
         |SI FSalida = 0;
             |SI #dscsvw15#4 = "N";
                 #dscsvw15#4 = "S";
                 #dscsvw15#5 = aVerde;
             |SINO;
                 #dscsvw15#4 = "N";
                 #dscsvw15#5 = "";
             |FINSI;
             |GRABA 020#dscsvw15.a;
             |LIBERA #dscsvw15;

             |REFRESCACONTROL nGrid15;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Periodos;
     aFicTmp = "dscsvw15" + Usuario;  |NOME_DAT #dscsvw15#aFicTmp#;
     |ABRE #dscsvw15;  |CIERRA #dscsvw15;  |DELINDEX #dscsvw15;

     |ABRE #dscsvw15;
     |BUCLE canempre;

     |VENTANA 0501, 3599, -1, 16, "Periodos a importar";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{11}}(Doble click para seleccionar los periodos)", 0502, 0584, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{137}}Instrucciones", 0585, 0599, Instrucciones;
     nBtnInfo = FSalida;

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dscsvw15, nRango, 601, 3298, NULL, NULL, Evnt15;
     nGrid15 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid15;
          |LEETECLA aTecla;

          |CONFI "0000NLos periodos est n bien definidos";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO Instrucciones;
     |HAZ LeeUnidadBasico;
     eaNombrePDF = "dscsvz11";
     |HAZ MuestraPDF;
|FPRC;


|PROCESO ModAsiento;
     |FIN_CONTROL_WINDOWS nBtnUni;

     |SI aModAsiento = "SI";
         aModAsiento = "NO";
     |SINO;
         aModAsiento = "SI";
     |FINSI;

     aAlfa = "BOTON," + aModAsiento;
     |CONTROL_SIMPLE 0, aAlfa, 2717, 2920, ModAsiento; nBtnUni = FSalida;
|FPRC;

|PROGRAMA;
     |LEE 000#camaasil.p;
     |SI FSalida = 0;
         |MENAV "0000Ya existe movimientos en esta empresa/periodo. Cancelamos la importaci¢n";
         |ACABA;
     |SINO;
         |LEE 000#camaniva.p;
         |SI FSalida = 0;
             |MENAV "0000Ya existe movimientos de IVA en esta empresa/periodo. Cancelamos la importaci¢n";
             |ACABA;
         |FINSI;
     |FINSI;

     |HAZ Periodos;
     |SI nError = 1;  |ACABA;  |FINSI;

     |VENTANA 0501, 3599, -1, 16, "Importaci¢n CSV SYGA";
     n0Vent = FSalida;

     |PINPA #0#dscsvz11;  nPanta = FSalida;
     |PINDA #0#dscsvz11;

     |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Instrucciones", 0585, 0599, Instrucciones;
     nBtnInfo = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 0785, 0787, Ubica; nBtnCar1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1085, 1087, Ubica; nBtnCar2 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1385, 1387, Ubica; nBtnCar3 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1685, 1687, Ubica; nBtnCar4 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1985, 1987, Ubica; nBtnCar5 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 2285, 2287, Ubica; nBtnCar6 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 2585, 2587, Ubica; nBtnCar7 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 2885, 2887, Ubica; nBtnCar8 = FSalida;

     aModAsiento = "NO";

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Asientos e IVA", 2803, 2815, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}se dejan modificables", 2822, 2850, NULL;

     aAlfa = "BOTON," + aModAsiento;
     |CONTROL_SIMPLE 0, aAlfa, 2717, 2920, ModAsiento; nBtnUni = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{207}}Cancelar", 3570, 3582, Cancelar;
     nBtnCan = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Definir conceptos", 3502, 3520, EntraM10;
     nBtnCon = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{230}}Continuar";
          |LEETECLA aTecla;

          |SI aTecla = aEsc1;  |O  aTecla = aRetu;
              nError = 0;
              |HAZ Chequeo;
              |SI nError = 0;  |SAL;  |FINSI;
          |FINSI;

          |SI aTecla = aEsc2; |SAL;  |FINSI;
     |SIGUE;

     |SI aTecla = aEsc2;
         |FINVENTANA n0Vent;

         |MENAV "0000Proceso cancelado.";
         |ACABA;
     |FINSI;

     |FIN_CONTROL_WINDOWS nBtnCar1;
     |FIN_CONTROL_WINDOWS nBtnCar2;
     |FIN_CONTROL_WINDOWS nBtnCar3;
     |FIN_CONTROL_WINDOWS nBtnCar4;
     |FIN_CONTROL_WINDOWS nBtnCar5;
     |FIN_CONTROL_WINDOWS nBtnCar6;
     |FIN_CONTROL_WINDOWS nBtnCar7;
     |FIN_CONTROL_WINDOWS nBtnCar8;
     |FIN_CONTROL_WINDOWS nBtnCan;
     |FIN_CONTROL_WINDOWS nBtnCon;

     |HAZ Importacion;

     |FINVENTANA n0Vent;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRO;

|PROCESO BorraTempos;
     aAlfa = aPathLocal + "ficcsv.txt";  |RFBORRA aAlfa;

     aAlfa = aPathLocal + "*.csv";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;

     aAlfa = aPathTmp + "*.csv";
     |_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |FBORRA aAlfa;

          |_SDIR aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     nChequeo = 0;

     eaIP     = "";  |IP_REMOTO eaIP;

     |HAZ LeeUnidadBasico;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\tmp";              |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\";

     |DBASE aBaseConta;
     aPathTmp   = aBaseConta     + "tmp";           |MKDIR aPathTmp;
     aPathTmp   = aPathTmp  + "/" + Usuario;   |MKDIR aPathTmp;
     aPathTmp   = aPathTmp  + "/";

     |HAZ BorraTempos;

     |ABRE #cacuenta;
     |HAZ inicio;
     |CIERRA #cacuenta;

     |ABRET #dsmom030;
     |ABRET #dsmom040;
     |ABRET #dsmom041;
     |ABRET #dsmom042;
     |ABRET #dscsvm10;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |ABRE #dscsvw06;  |CIERRA #dscsvw06;  |DELINDEX #dscsvw06;
     |ABRE #dscsvw07;  |CIERRA #dscsvw07;  |DELINDEX #dscsvw07;
     |ABRE #dscsvw08;  |CIERRA #dscsvw08;  |DELINDEX #dscsvw08;
     |ABRE #dscsvw09;  |CIERRA #dscsvw09;  |DELINDEX #dscsvw09;
     |ABRE #dscsvw12;  |CIERRA #dscsvw12;  |DELINDEX #dscsvw12;
     |ABRE #dscsvw13;  |CIERRA #dscsvw13;  |DELINDEX #dscsvw13;
     |ABRE #dscsvw15;  |CIERRA #dscsvw15;  |DELINDEX #dscsvw15;

     |CIERRAT #cacuenta;
     |CIERRAT #caclipro;
     |CIERRAT #camaasic;
     |CIERRAT #camaasil;
     |CIERRAT #camaniva;
     |CIERRAT #caivalin;
     |CIERRAT #camandia;

     |CIERRAT #dsmom030;
     |CIERRAT #dsmom040;
     |CIERRAT #dsmom041;
     |CIERRAT #dsmom042;
     |CIERRAT #dscsvm10;

     |HAZ BorraTempos;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;
