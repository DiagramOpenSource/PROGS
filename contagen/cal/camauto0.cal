|FICHEROS;
   camauto0 #1;
   camauto1 #0;
   cacuenta #2;

   caivaasi #200;
   :/modelos/def/dsmom030 #130;
   camautti #4;

   :/basica/def/agitab99 #199;
   caw00099 #902,MANTE;
|FIN;

|VARIABLES;
   &entrada  = 1;

   alfa1 = "";
   nSwCopiar = 0;
   &enNFijo  = 0;
   &enNFijE  = 0;

   aAlfa1   = "";
   aAlfa2   = "";
   aAlfa3   = "";

   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;

   cuant = "";
   diant = 0;
   coant = 0;
   deant = "";
   dhant = "";
   imant = 0;
   dpant = "";
   sdant = "";
   tfant = 0;
   blant = 0;
   caant = "";

   modo  = 0;
   &tex  = "";
   &tex2 = "";
   &tex3 = "";
   &swinf  = 0;
   swlin = 0;

   &eaPath    = "";
   &eaRetorno = "";
   sw         = 0;
   swTipCta   = 0;
   swModelo   = 0;
   &enModelo  = 0;
   &enSwConta = 0;  || 1= Para dar de alta codigos

   nUltCod    = 0;
   nInkey     = 0;
   nBloque    = 0;
   aCasilla   = "";
   nDBloque   = 0;
   nHBloque   = 0;
   aDCasilla  = "";
   aHCasilla  = "";

   &eaTabMod  = "";

   &enwModAu  = 0;
   &enQueRen  = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoan_i;

|| ********************************************************************
|CALCULO Atipo8; |TIPO 8;
  |HAZ inicio;
  |HAZ DirAplicSt;
  |SI Hayrenta = 0;
      |MENAV "    Error no existe Renta ";
      |ERROR;
      |PTEC 807;
  |FINSI;

  enwModAu = 1;
  enQueRen = enEjercicio - 1;
  |HAZ CargaAuxModelo;
  |NOME_DAT #902 eaTabMod;

  |HAZ Analitica;
  |SI enSwAna = 0;
      |C_M #0#14,1,"N";
      |C_V #0#14,1,"N";
      |C_A #0#5,1,24;
  |FINSI;

  |ABRE #200;
  |DDEFECTO #200;
  |LEE 041#200p;
  |CIERRA #200;
  eaSobreEs = #200#155;
|FCAL;

|CALCULO ElTipo30; |TIPO 30;
 |SI nSwCopiar = 1;
     enNFijE = #1#0;
     |PUSHV 0501 1180;
     |SUB_EJECUTA_NP "caut0004";
 |FINSI;
 nSwCopiar = 0;
 |PINTA 0574,"ÄÄÄÄÄÄ¿";
|FCAL;

|CALCULO ParaCopiar; |TIPO 0;
 |SI FSalida = 10;
     nSwCopiar = 1;
     |ATRI P; |PINTA 0574, "COPIAR"; |ATRI 0;
 |FINSI;
|FCAL;

|CALCULO ATipo9; |TIPO 9;
  |SI Haybasica = 1; |DELINDEX #902; |FINSI;
|FCAL;

|CALCULO alta; |TIPO 7;
   modo = (FEntrada / 100) ! 0;
   nNume1 = 0;
   |SI modo = 1;
       |DDEFECTO #1;
       |LEE 001#1u;
       |SI FSalida = 0;
           nNume1 = #1#0;
       |FINSI;
       |DDEFECTO #1;
       #1#0 = nNume1 + 1;
       |PINTA #1#0;
   |FINSI;
   cuant = "";
   diant = 0;
   coant = 0;
   deant = "";
   dhant = "";
   imant = 0;
   dpant = eaDfDepC;
   sdant = eaDfSubC;
   tfant = 0;
   blant = 0;
   caant = "";
|FCAL;

|CALCULO ElModelo; |TIPO 0;
 |HAZ LeeModelo;
 |SI swModelo = 1;
     |MENAV "    Error, no existe Modelo Oficial";
     |ERROR;
 |FINSI;
|FCAL;

|PROCESO LeeModelo;
 swModelo = 0;
 aAlfa1 = " " * 42;
 |PINTA 1023, aAlfa1;
 |SI Haybasica = 0; swModelo = 1; |ACABA; |FINSI;

 |ABRE #199;
 #199#0 = #1#21;
 |LEE 001#199=;
 |SI FSalida ! 0;
     |DDEFECTO #199;
     swModelo = 1;
 |FINSI;
 |PINTA 1023,#199#1;
 |CIERRA #199;
|FPRC;

|CALCULO Tipo13_C; |TIPO 13;
 |SI enSwAna = 0;
     alfa1 = &205;
     |ATRI R; |PINTA 1136, "cion       ";|ATRI 0;
     |PINTA 2139, alfa1;
 |FINSI;

 |HAZ LeeModelo;
 |PINTA 2301, "                                        ";
 |PINTA 2341, "                                        ";
|FCAL;

|| ------------------------------------------------------------------------/
|| Proceso para imprimirlos
|| ------------------------------------------------------------------------/
|PROCESO imprime2;
  #2#0 = #0#2;
  |LEE 001#2=;
  |SI FSalida ! 0;
      #2#2 = "NO EXISTE CUENTA";
  |FINSI;

  tex2 = "";
  |SI #0#7 = "D"; tex2 = "al DEBE     "; |FINSI;
  |SI #0#7 = "H"; tex2 = "al HABER    "; |FINSI;
  |SI #0#7 = "S"; tex2 = "segun SALDO "; |FINSI;
  |SI #0#7 = "C"; tex2 = "CUADRE ASTO."; |FINSI;

  tex3 = "";
  nBloque  = #0#11;
  aCasilla = #0#12;
  enModelo = #1#21;
  |HAZ LeeCodTab;
  |SI nUltCod = 0;
      tex3 = #902#3;
  |FINSI;

   swinf = 1;
   |PRINT;
   swlin = 1;
|FPRC;

|PROCESO impresion; |TIPO 4;
   sw = 0;
   |IMPRE 0;
   |SI FSalida = 0;
       |INFOR "camauti0";
       |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

      tex = "";
      tex = "Modelo Oficial";
      swinf = 0;
      |PRINT;
      swlin = 0;
      |ABRET #2;
      |BUCLELIN 2imprime2#1;
      |SI swlin = 1;
          swinf = 2;
          |PRINT;
      |FINSI;
      |CIERRAT #2;

      |PIEINF;
      |FININF;
   |SINO;
      |MENAV "    Proceso Abortado ...";
   |FINSI;
   |FINIMP;
|FPRC;

|| ------------------------------------------------------------------------/
|| *********************************** PROCESOS de Lineas
|PROCESO LosDefectos;
  modo = (FEntrada / 100) ! 0;
  |SI modo = 1;
      |SI #1#21 = 100;
          #0#11 = 25;
          #0#12 = "103";
      |SINO;
          #0#11 = 27;
          #0#12 = " 40";
      |FINSI;
      blant = #0#11;
      caant = #0#12;
      |PINTA #0#11;
      |PINTA #0#12;
  |FINSI;
|FPRC;

|PROCESO nodepar; |TIPO 7;
   |CAMPO_MODIFICA #0#6, 1, eaDepar;
   |SI eaDepar  = "S";
      |SI Haybasica = 1;
          |MENSA "    <F2> Consulta de actividades";
      |SINO;
          |MENSA "    <F2> Consulta de departamentos";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO nosubde; |TIPO 7;
   |CAMPO_MODIFICA #0#9, 1, eaSubde;
   |SI eaSubde  = "S";
      |SI Haybasica = 1;
         |SI enArrend = 1;
            |MENSA "    Subdepartamento. <F2> Consulta de Referencias Catastrales";
         |SINO;
            |MENSA "    Subdepartamento. <F2> Consulta de Cultivos";
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|CALCULO cuenta; |TIPO 6;
     eaCuenta = #camauto1#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #camauto1#Campo# = eaCuenta;
     |PINTA #camauto1#Campo#;
|FCAL;

|CALCULO cuefin; |TIPO 0;
  aAlfa1 = #0#2; |QBF aAlfa1;
  |SI aAlfa1 = "";
     |ERROR;
     |ACABA;
  |FINSI;
  emCta    = 1;
  eaCuenta = #0#2; |HAZ SacaNivel;
  |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
  |HAZ LeeCuenta;
  |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
  aAlfa1 = #cacuenta#2;
  |HAZ PintaCta;
|FCAL;

|PROCESO concepto; |TIPO 0;
   |SI FSalida = 10;
       enConcepto = #0#4;
       |HAZ VerConcepto30;
       #0#4 = enConcepto; |PINTA #0#4;
   |FINSI;

   enFilConc  = 1;
   eaCuenta   = #0#2;
   enConcepto = #0#4;
   |HAZ FiltroConcepto;  |SI eswLect ! 0; |ACABA; |FINSI;

   |SI FEntrada = 101;
      #0#5 = #dsmom030#1;
   |SINO;
      |SI #0#4 = coant;
          #0#5 = deant;
      |SINO;
          #0#5 = #dsmom030#1;
      |FINSI;
   |FINSI;
   |PINTA #0#5;
|FPRC;

|PROCESO descrip; |TIPO 0;
   nInkey = FSalida;
   |SI nInkey = 15;
      #0#5 = deant;
      |PINTA #0#5;
   |FINSI;
|FPRC;

|PROCESO c_descrip; |TIPO 7;
       |SI eaSobreEs ! "S";
           |PTEC 816;
       |FINSI;
|FPRC;

|CALCULO mayusl; |TIPO 0;
 |SI #0#7 = "S"; |O #0#7 = "C";
     |C_M #0#8, 1,"N";  #0#8  = 0;   |PINTA #0#8;
     |C_M #0#10,1,"N";  #0#10 = 0;   |PINTA #0#10;
     |C_M #0#11,1,"N";  #0#11 = 0;   |PINTA #0#11;
     |C_M #0#12,1,"N";  #0#12 = 0;   |PINTA #0#12;
 |SINO;
     |C_M #0#8, 1,"S";
     |C_M #0#10,1,"S";
     |C_M #0#11,1,"S";
     |C_M #0#12,1,"S";
 |FINSI;
|FCAL;

|PROCESO ElMensa; |TIPO 7;
   |SI #0#7 = "S"; |O #0#7 = "C";
       |MENSA "    (+) Asiento al Debe, (-) Asiento al Haber, (=) siempre";
   |SINO;
       |MENSA "    (+) si importe es positivo, (-) si importe es negativo, (=) siempre";
   |FINSI;
|FPRC;

|CALCULO AntesParam; |TIPO 7;
   |C_M #0#10, 0, aAlfa1; |SI aAlfa1 = "N"; |ACABA; |FINSI;
   |PUSHV 0912 2354;
   |ATRI R;
   |PINTA 0912, " PARAMETRO CONTRIBUYENTE                   ";
   |PINTA 1012, " ========================================= ";
   |PINTA 1112, "  0= Introducir Importe                    ";
|SI #1#21 ! 714;
   |PINTA 1212, "  1= Renta del Titular         (TITULAR)   ";
   |PINTA 1312, "  2= Renta del Conyuge         (CONYUGE)   ";
   |PINTA 1412, "  3= Renta Primer  Familiar    (1FAMILIAR) ";
   |PINTA 1512, "  4= Renta Segundo Familiar    (2FAMILIAR) ";
   |PINTA 1612, "  5= Renta Tercer  Familiar    (3FAMILIAR) ";
   |PINTA 1712, "  6= Renta Cuarto  Familiar    (4FAMILIAR) ";
   |PINTA 1812, "  7= Renta Conjunta            (CONJUNTA)  ";
   |PINTA 1912, "  8= Renta Conjunta Partida    (CONJUNTAE) ";
|SINO;
   |PINTA 1212, "  9= Patrimonio Titular        (ZPATRITIT) ";
   |PINTA 1312, " 10= Patrimonio Conyuge        (ZPATRICON) ";
|FINSI;
   |ATRI 0;
|FCAL;

|CALCULO TrasParam; |TIPO 0;
   |C_M #0#10, 0, aAlfa1; |SI aAlfa1 = "N"; |ACABA; |FINSI;
   |POPV;
   |SI #0#10 = 0;
       |C_M #0#8, 1,"S";
       |C_M #0#11,1,"N";  #0#11 = 0;   |PINTA #0#11;
       |C_M #0#12,1,"N";  #0#12 = 0;   |PINTA #0#12;
       |C_M #0#13,1,"N";  #0#13 = "="; |PINTA #0#13;
       |ACABA;
   |SINO;
       |C_M #0#8,1,"N";  #0#8 = 0;   |PINTA #0#8;
       |C_M #0#11,1,"S";
       |C_M #0#12,1,"S";
       |C_M #0#13,1,"S";
       |HAZ LosDefectos;
   |FINSI;

   |SI #1#21 = 714;
       |SI #0#10 < 9; |O #0#10 > 10; |ERROR; |FINSI;
   |SINO;
       |SI #0#10 > 8; |ERROR; |FINSI;
   |FINSI;
|FCAL;

|CALCULO AntesBloc; |TIPO 7;
  |C_M #0#11, 0, aAlfa1; |SI aAlfa1 = "N"; |ACABA; |FINSI;
  |MENSA "    Introduzca Bloque de Renta/Patrimonio / <F2> Consulta Campos";
  |HAZ TabModelos;
|FCAL;

|CALCULO TrasBloc; |TIPO 0;
 |C_M #0#11, 0, aAlfa1; |SI aAlfa1 = "N"; |ACABA; |FINSI;
 nInkey = FSalida;
 |POPV;
 |SI nInkey = 10;
     |HAZ TabModelos;
 |FINSI;
|FCAL;

|CALCULO AntesCas; |TIPO 7;
  |C_M #0#12, 0, aAlfa1; |SI aAlfa1 = "N"; |ACABA; |FINSI;
  |MENSA "    Introduzca Casilla de Renta/Patrimonio / <F2> Consulta Campos";
|FCAL;

|CALCULO TrasCas; |TIPO 0;
 |C_M #0#12, 0, aAlfa1; |SI aAlfa1 = "N"; |ACABA; |FINSI;
 nInkey = FSalida;
 |POPV;
 |SI nInkey = 10;
     |HAZ TabModelos;
 |FINSI;
 nBloque  = #0#11;
 aCasilla = #0#12;
 enModelo = #1#21;
 |HAZ LeeCodTab;
 |SI nUltCod = 1;
     |ERROR;
     |ACABA;
 |FINSI;
|FCAL;

|PROCESO LeeCodTab;
 nUltCod = 0;
 |ABRE #902;
 #902#0 = enModelo;
 #902#1 = nBloque;
 #902#2 = aCasilla;
 |LEE 001#902=;
 |SI FSalida ! 0;
     nUltCod = 1;
 |FINSI;
 |CIERRA #902;
|FPRC;

|RUTINA ClInf902;
 #902#0 = enModelo;
 |SI FSalida = "POSICION"; |Y blant ! 0; |Y caant ! "";
     #902#1 = blant;
     #902#2 = caant;
 |SINO;
     #902#1 = nDBloque;
     #902#2 = aDCasilla;
 |FINSI;
|FRUT;

|RUTINA ClSup902;
 #902#0 = enModelo;
 #902#1 = nHBloque;
 #902#2 = aHCasilla;
|FRUT;

|PROCESO TabModelos;
 |SI Haybasica = 0; |ACABA; |FINSI;
 enModelo = #1#21;

 |PUSHV 0701 2158;
 nDBloque = 0;      nHBloque  = 99;
 aDCasilla = "    "; aHCasilla = "zzzz";

 nBloque  = #0#11;
 aCasilla = #0#12;

 |PINPA #0#902;
 #902#0 = enModelo; |PINTA #902#0;
 |ENTLINEAL #1#902, -3, 4, 20, 0, ClInf902, ClSup902;
 |POPV;
 #0#11 = nBloque;  |PINTA #0#11;
 #0#12 = aCasilla; |PINTA #0#12;
|FPRC;

|| -------------------------------------------------
|CALCULO nocero; |TIPO 0;
   |C_M #0#Campo#,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI #0#Campo# = 0;
      |MENAV "    ATENCION!!! Importe cero ...";
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO tipo3; |TIPO 3;
   aAlfa1 = #0#2;  |QBF aAlfa1;
   |SI aAlfa1 = "";
      |MENAV "    ATENCION!!! Apunte sin cuentas ...";
      |ERROR;
      |ACABA;
   |FINSI;
   |SI #0#8 = 0; |Y #0#10 = 0;
      |SI #0#7 = "D"; |O #0#7 = "H";
         |MENAV "    ATENCION!!! Importe cero ...";
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;
   cuant = #0#2;
   diant = #0#3;
   coant = #0#4;
   deant = #0#5;
   dhant = #0#7;
   imant = #0#8;
   dpant = #0#6;
   sdant = #0#9;
   tfant = #0#10;
   blant = #0#11;
   caant = #0#12;
|FCAL;

|CALCULO tipo1; |TIPO 1;
   cuant = #0#2;
   diant = #0#3;
   coant = #0#4;
   deant = #0#5;
   dhant = #0#7;
   imant = #0#8;
   dpant = #0#6;
   sdant = #0#9;
   tfant = #0#10;
   blant = #0#11;
   caant = #0#12;
|FCAL;

|CALCULO tipo13; |TIPO 13;
  aAlfa1 = " " * 40;
  |SI #0#2 ! doce;
      |ABRE #2;
      #cacuenta#0 = #0#2;
      |LEE 001#2=;
      |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
      aAlfa1 = #cacuenta#2;
      |CIERRA #2;
  |FINSI;
  |HAZ PintaCta;

  modo = (FEntrada / 100) ! 0;
  |PINTA 2301, "                                        ";
  |PINTA 2341, "                                        ";
  |SI modo = 1; |ACABA; |FINSI;
  |SI eaDepar = "S";
      eOpDep = 0;
      enActividad = #0#6;
      eaCodDep    = #0#6;
      eaNombreAct = "";
      |HAZ Actividad;
      |ATRI S; |PINTA 2301, eaNombreAct; |ATRI 0;
  |FINSI;
  |PINTA 2341, "                                        ";
  |SI eaSubde = "S";
      eOpSub = 0;
      enConcepto  = #0#4;
      eaCodSubdep = #0#9;
      eaNomSubdep = "";
      |HAZ SubActividad;
      |ATRI S; |PINTA 2341, eaNomSubdep; |ATRI 0;
  |FINSI;
|FCAL;

|PROCESO PintaCta;
 |ATRI I;
 |PINTA 2221, aAlfa1;
 |ATRI 0;
|FPRC;

||***************************** Procesos para Departamento y Subdepartamento
|| ==========================================================================
|PROCESO cActividad; |TIPO 0;
   |SI eaDepar = "N"; |ACABA; |FINSI;
   |PINTA 2301, "                                        ";
   eOpDep = 0; || 1 = Consulta pantalla
   |SI FSalida = 10;  eOpDep = 1; |FINSI;
   enActividad = #0#6;
   eaCodDep    = #0#6;
   |HAZ Actividad;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Actividad / Departamento";
       |ERROR;
   |SINO;
       aAlfa1 = enActividad;
       |SI Haybasica = 1;
           aAlfa1 = ("00" + aAlfa1) % A02;
       |FINSI;
       #0#6 = eaCodDep; |PINTA #0#6;
       |ATRI S; |PINTA 2301, eaNombreAct; |ATRI 0;
   |FINSI;
|FPRC;

|PROCESO cSubActividad; |TIPO 0;
   |SI eaSubde = "N"; |ACABA; |FINSI;

   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpSub = 1; |FINSI;

   |PINTA 2341, "                                        ";
   enConcepto  = #0#4;
   eaCodSubdep = #0#9;
   enQue = 1;
   |HAZ SubActividad;
   enQue = 0;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe SubDepartamento";
       |ERROR;
   |SINO;
       #0#9 = eaCodSubdep; |PINTA #0#9;
       |ATRI S; |PINTA 2341, eaNomSubdep; |ATRI 0;
   |FINSI;
|FPRC;

|| -----------------------------Calculos de la tabla de Modelos
|CALCULO wTip11; |TIPO 11;
 nInkey = FSalida;
 |SI nInkey = 1; |O nInkey = 0;
     nBloque  = #902#1;
     aCasilla = ("   " + #902#2) %  -103;
 |FINSI;
|FCAL;

|CALCULO wTip5; |TIPO 0;
 nInkey = FSalida;
 |SI nInkey = 0;
     |PTEC 806;
     |PTEC 808;
 |FINSI;
|FCAL;

|CALCULO anacta; |TIPO 0;
   nInkey = FSalida;
   |SI enSwAna = 0; |ACABA; |FINSI;
   |SI nInkey = 2;  |ACABA; |FINSI;

   |SI nInkey = 15;
       #0Campo = caant;
       |PINTA #0Campo;
       |ACABA;
   |FINSI;

   |SI #0Campo ! "*TABLA ";
       salidas = FSalida; |HAZ FPuntosAna;
       eOpAna = 0; || 1 = Consulta pantalla
       |SI nInkey = 10; eOpAna = 1;  |FINSI;
       eaCtaAna = #0Campo;
       |HAZ LeeCtaAna;
       #0Campo = eaCtaAna;
       |PINTA #0Campo;
   |FINSI;
   caant = #0Campo;
|FCAL;
