|FICHEROS;
   paforma1 #0;

   caenlace #10;
|FIN;

|VARIABLES;
   aAlfa    = "";
   aAlfa1   = "";
   CR       = "";
   LF       = "";
   aVarAlfa = "";
   aCuenta  = "";
   aLong    = "";

   Handle  = 0;
   nLinea  = 0;
   nCalc   = 0;
   nAntDoc = 0;
   nNivel  = 0;
   nLong   = 0;
|FIN;

|PROCESO MiraFichero;
   aAlfa = #paforma1#0; |QBF aAlfa;
   |XABRE "E", aAlfa, Handle;
   |SI FSalida < 0;
      |MENAV "    No se encuentra el fichero indicado";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO SacaNivel;
   aAlfa = aCuenta; |QBF aAlfa;
   aLong = aAlfa % 0; nLong = aLong;
   nNivel = 0;
   |SI nLong = #48#14; nNivel = 1; |FINSI;
   |SI nLong = #48#15; nNivel = 2; |FINSI;
   |SI nLong = #48#16; nNivel = 3; |FINSI;
   |SI nLong = #48#17; nNivel = 4; |FINSI;
   |SI nLong = #48#18; nNivel = 5; |FINSI;
   |SI nLong = #48#19; nNivel = 6; |FINSI;
|FPRC;

|PROCESO ProcesaCadena;
   |DDEFECTO #caenlace;
   #caenlace#0 = #paforma1#1;
   aAlfa = aVarAlfa % 1708;
   aAlfa1 = aAlfa % -102; |QBF aAlfa1; nCalc = aAlfa1;
   |SI nCalc < 80;
      aAlfa = (aAlfa % 0102) + "." + (aAlfa % 0402) + ".20" + (aAlfa % 0702);
   |SINO;
      aAlfa = (aAlfa % 0102) + "." + (aAlfa % 0402) + ".19" + (aAlfa % 0702);
   |FINSI;
   #caenlace#1 = aAlfa;
   aAlfa = aVarAlfa % 2605; nCalc = aAlfa;
   |SI nAntDoc ! nCalc; nLinea = 1; nAntDoc = nCalc; |FINSI;
   #caenlace#2 = nCalc;
   #caenlace#3 = nLinea; nLinea = nLinea + 1;
   aAlfa = aVarAlfa % 0112; aCuenta = aAlfa; |HAZ SacaNivel;
   #caenlace#4 = aAlfa;
   #caenlace#5 = nNivel;
   #caenlace#6 = #paforma1#2;
   aAlfa = aVarAlfa % 3226; #caenlace#7 = aAlfa;
   aAlfa = aVarAlfa % 5801; #caenlace#8 = aAlfa;
   aAlfa = aVarAlfa % 6015; #caenlace#9 = aAlfa;
   #caenlace#15 = "01";
   |GRABA 020#caenlace.n;
|FPRC;

|PROCESO Importa;
   aAlfa = #0#0; |QBF aAlfa; aAlfa = "rb  " + aAlfa;
   |FABRE aAlfa;
   |SI FSalida ] 0;
       Handle = FSalida;
       |PARA; |SI; |HACIENDO;
          aVarAlfa = Handle + " 76"; |FLEE aVarAlfa;
          |SI FSalida ! 76; |SAL; |FINSI;
          |HAZ ProcesaCadena;
       |SIGUE;
       FSalida = Handle; |FCIERRA FSalida;
   |SINO;
       |MENAV "    Fichero no encontrado";
   |FINSI;
|FPRC;

|PROGRAMA;
   CR = &10; LF = &13; Pos = -1;

   |ABRE #paforma1;
   |LEE 000#paforma1.=;
   |SI FSalida ! 0;
      |DDEFECTO #paforma1;
      |GRABA 020#paforma1.c;
   |FINSI;

   |CLS;
   |CABEZA "Pase formato 1";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#paforma1.a;
      |DELINDEX #caenlace; |ABRE #caenlace;
      nAntDoc = -1;
      |HAZ Importa;
      |CIERRA #caenlace;
      |DFICE aAlfa; |QBF aAlfa; aAlfa = "dsapunte.tab;" + aAlfa;
      |SUB_EJECUTA aAlfa;
   |FINSI;

   |CIERRA #paforma1;
|FPRO;
