|FICHEROS;
   catramod #1;
   cacuenta #2;
   cacuebal #5;
   ca8m0002 #422;
   ca8cumay #410;
|FIN;

|VARIABLES;
   &entrada = 1;
   juan = 0;
   errant = 0;

   &modcon = 0;
   cuini = "            ";
   cufin = "999999999998";
   ||cufin = 0;

   diini = 0;
   difin = 9;
   fecini = @;
   fecfin = @;
   tiini = "D";
   tifin = "H";
   diain = 0;
   diafi = 99;
   prim = 0;
   cuant = "";
   lon = 0;
   aa = 0;
   ini = 0;
   fecalf = "";
   mes = "";
   mesfec = 0;
   mesac = 0;
   a = 0;
   b = 0;
   c = 0;
   mensa = "";
   aar = "";
   traba = "";
   errcuent = "aaaaaaaaaaaa";
   &no_mensaje = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE defec1_i;

|PROCESO actuali;
   |SI #catramod#2 < juan; |O #catramod#2 = 9;
      |SI prim = 1;
         |GRABA 101#2a;
      |FINSI;
      prim = 0;
      |ACABA;
   |FINSI;
   aa = 100 + lon;
   aar = aa;
   traba = #catramod#1 % aar;
   |ET iniemp;
   |SI prim = 0;
      cuant = traba;
      prim = 1;
      #cacuenta#0 = cuant;
      #cacuenta#1 = juan;
      |SI #cacuenta#0 = errcuent;
         prim = 0;
         |ACABA;
      |FINSI;
      |LIBERA #2;
      |LEE 101#2=;
      |SI FSalida ! 0;
         |LIBERA #2;
         |DDEFECTO #2;
         #cacuenta#0 = cuant;
         #cacuenta#1 = juan;
         |HAZ defect1;
         |PUSHV 0501 1980;
         |PINPA #0#2;
         |PINDA #0#2;
         |ENDATOS #1#2;
         |SI FSalida ! 0;
            |POPV;
            mensa = "Actualizando nivel: " + juan + "        ";
            |SI no_mensaje = 1;
               |PINTA 2410,mensa;
            |FINSI;
            errant = #cacuenta#0;
            prim = 0;
            |ACABA;
         |FINSI;
         |GRABA 101#2b;
         |POPV;
         mensa = "Actualizando nivel: " + juan + "        ";
         |SI no_mensaje = 1;
            |PINTA 2410,mensa;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI cuant ! traba;
      |GRABA 101#2a;
      prim = 0;
      |VETE iniemp;
   |FINSI;
   |HAZ suma;
|FPRC;

|PROCESO borrando;
   |BORRA 040#1a;
|FPRC;

|DEFBUCLE camoddac0;
   #1#1;
   ;
   codcon,cuini,diini,fecini,tiini,diain;
   codcon,cufin,difin,fecfin,tifin,diafi;
   be;
   NULL,actuali;
|FIN;

|DEFBUCLE camoddac1;
   #1#1;
   ;
   codcon,cuini,diini,fecini,tiini,diain;
   codcon,cufin,difin,fecfin,tifin,diafi;
   be;
   NULL,borrando;
|FIN;

|PROGRAMA;
   |SI no_mensaje = 1;
      |PINTA 2410,"Estoy Actualizando las Cuentas";
   |FINSI;
   |ABRE #2;
   |PARA juan = dig3; |SI juan ] 1; |HACIENDO juan = juan - 1;
      prim = 0;
      |SI juan = 1; lon = dig4; |FINSI;
      |SI juan = 2; lon = dig5; |FINSI;
      |SI juan = 3; lon = dig6; |FINSI;
      |SI juan = 4; lon = dig7; |FINSI;
      |SI juan = 5; lon = dig8; |FINSI;
      fecini = "01.01.0000";
      fecfin = "31.12.9999";
      |BUCLE camoddac0;
      |SI prim = 1;
         |GRABA 101#2a;
      |FINSI;
   |SIGUE;
   |CIERRA #2;
   fecini = "01.01.0000";
   fecfin = "31.12.9999";
   |BUCLE camoddac1;
   |ABRET #1;
   |LEE 101#1u;
   |SI FSalida ! 0;
      |CIERRAT #1;
      |DELINDEX #1;
   |SINO;
      |CIERRAT #1;
   |FINSI;
|FPRO;

|PROCESO suma;
   |SI #catramod#6 = 0;
      |SI #catramod#4 = "D";
         #cacuenta#9 = #cacuenta#9 + #catramod#5;
         #cacuenta#51 = #cacuenta#51 + #catramod#5;
      |SINO;
         #cacuenta#10 = #cacuenta#10 + #catramod#5;
         #cacuenta#52 = #cacuenta#52 + #catramod#5;
      |FINSI;
      #cacuenta#11 = #cacuenta#9 - #cacuenta#10;
      #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
   |SINO;
      |SI #catramod#6 = 99;
         |SI #catramod#4 = "D";
            #cacuenta#48 = #cacuenta#48 + #catramod#5;
            #cacuenta#51 = #cacuenta#51 + #catramod#5;
         |SINO;
            #cacuenta#49 = #cacuenta#49 + #catramod#5;
            #cacuenta#52 = #cacuenta#52 + #catramod#5;
         |FINSI;
         #cacuenta#50 = #cacuenta#48 - #cacuenta#49;
         #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
      |SINO;
         |HAZ actualiza;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO actualiza;
   ini = dig1;
   fecalf = #catramod#3;
   mes = fecalf % 402;
   mesfec = mes;
   |SI ini = 1;
      mesac = mesfec;
   |SINO;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
         mesac = (13 - ini) + mesfec;
      |FINSI;
   |FINSI;
   a = (mesac * 3) + 9;
   b = a + 1;
   c = a + 2;
   |SI #catramod#4 = "D";
      #cacuenta#a# = #cacuenta#a# + #catramod#5;
      #cacuenta#51 = #cacuenta#51 + #catramod#5;
   |SINO;
      #cacuenta#b# = #cacuenta#b# + #catramod#5;
      #cacuenta#52 = #cacuenta#52 + #catramod#5;
   |FINSI;
   #cacuenta#c# = #cacuenta#a# - #cacuenta#b#;
   #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
|FPRC;
