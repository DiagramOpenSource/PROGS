|FICHEROS;
    cabaexpz #0;
    cacuenta #1;   || plan contable
    caparexp #2;

    cabaexp0 #3;
    cabaexp1 #4;
    cabaexp2 #5;
    caexistc #6;
    caexistl #7;
    caconimp #8;
    caagrupr #9;

    cacuepre #11;   || fichas presupuestarias
    canempre #30;
|FIN;

|VARIABLES;
    nRedo1 = 0;
    nRedon = 0;
    nCam1  = 0;
    nCam2  = 0;
    nCam3  = 0;

    &entrada = 1;
    &pathbal = "";
    &balance = 1;
    alfa1    = "";
    alfa2    = "";
    alfa3    = "";

    linea    = 0;
    nNume1  = 0;
    &anu     = 0;
    &anu1    = 0;
    &r_eje   = 0;
    &r_nom   = "";
    &d_mes   = 0;
    &h_mes   = 0;
    &estru   = 0;
    &r_emp   = 0;
    &r_per   = 0;
    &cta     = "";
    &nom     = "";
    &aparam   = "";
    mes      = 0;
    nivel    = 0;
    informe  = "";
    inform1  = "cabaexpz";
    inform2  = "cabaexpy";
    posici   = 100;

    nMesEx   = 0;
    e1       = 0;
    e2       = 0;
    e3       = 0;
    e4       = 0;
    descar   = 0;
    descarA  = 0;
    tracan5  = 0;
    tracan6  = 0;

    nNum1    = 0;
    nNum2    = 0;
    nNum3    = 0;
    acumula  = 0;
    acumul2  = 0;
    x        = 0;
    dos      = 0;
    &eldesde = 0;
    &elhasta = 0;
    elmesmv  = 0;

    aCuenta     = "";
    nNivel      = 0;
    swExiCta    = 0;
    swCta       = 0;
    nImpMes     = 0;
    nImpAnu     = 0;
    nImpPr1     = 0;
    nImpPr2     = 0;
    &sw_inf     = 0;
    &cantidad1  = 0;
    &cantidad2  = 0;
    &cantidad3  = 0;
    &cantidad11 = 0;
    &cantidad21 = 0;
    &cantidad31 = 0;

    sw_pasa  = 0;
    sw       = 0;
    debe1    = 0;
    debe2    = 0;
    debe3    = 0;
    debe4    = 0;
    haber1   = 0;
    haber2   = 0;
    haber3   = 0;
    debA1    = 0;
    debA2    = 0;
    debA3    = 0;
    debA4    = 0;
    habeA1   = 0;
    habeA2   = 0;
    habeA3   = 0;
    debP1    = 0;
    debP2    = 0;
    debP3    = 0;
    debP4    = 0;
    habeP1   = 0;
    habeP2   = 0;
    habeP3   = 0;
    debe11   = 0;
    debe21   = 0;
    debe31   = 0;
    debe41   = 0;
    haber11  = 0;
    haber21  = 0;
    haber31  = 0;
    debA11   = 0;
    debA21   = 0;
    debA31   = 0;
    debA41   = 0;
    habeA11  = 0;
    habeA21  = 0;
    habeA31  = 0;
    debP11   = 0;
    debP21   = 0;
    debP31   = 0;
    debP41   = 0;
    habeP11  = 0;
    habeP21  = 0;
    habeP31  = 0;

    sw_d1 = 0;
    sw_d2 = 0;
    sw_d3 = 0;
    sw_d4 = 0;
    sw_h1 = 0;
    sw_h2 = 0;
    sw_h3 = 0;
    bloque = 0;
    agrupaci = 0;
    epigrafe = 0;
    partida = 0;
    bloque1 = 0;
    sw_epi = 0;
    sw_d21 = 0;
    sw_d31 = 0;
    sw_h21 = 0;
    sw_h31 = 0;
    sw_h32 = 0;
    punto_h1 = 0;
    punto_d1 = 0;
    punto_h2 = 0;
    punto_d2 = 0;
    punto_h3 = 0;
    punto_d3 = 0;
    punto_h4 = 0;
    punto_d4 = 0;
    punto_h5 = 0;
    punto_d5 = 0;
    punto_h12 = 0;
    punto_d12 = 0;
    punto_h22 = 0;
    punto_d22 = 0;
    punto_h32 = 0;
    punto_d32 = 0;
    punto_h42 = 0;
    punto_d42 = 0;
    punto_h52 = 0;
    punto_d52 = 0;
    puntA_h1 = 0;
    puntA_d1 = 0;
    puntA_h2 = 0;
    puntA_d2 = 0;
    puntA_h3 = 0;
    puntA_d3 = 0;
    puntA_h4 = 0;
    puntA_d4 = 0;
    puntA_h5 = 0;
    puntA_d5 = 0;
    puntA_h12 = 0;
    puntA_d12 = 0;
    puntA_h22 = 0;
    puntA_d22 = 0;
    puntA_h32 = 0;
    puntA_d32 = 0;
    puntA_h42 = 0;
    puntA_d42 = 0;
    puntA_h52 = 0;
    puntA_d52 = 0;
    puntP_h1 = 0;
    puntP_d1 = 0;
    puntP_h2 = 0;
    puntP_d2 = 0;
    puntP_h3 = 0;
    puntP_d3 = 0;
    puntP_h4 = 0;
    puntP_d4 = 0;
    puntP_h5 = 0;
    puntP_d5 = 0;
    puntP_h12 = 0;
    puntP_d12 = 0;
    puntP_h22 = 0;
    puntP_d22 = 0;
    puntP_h32 = 0;
    puntP_d32 = 0;
    puntP_h42 = 0;
    puntP_d42 = 0;
    puntP_h52 = 0;
    puntP_d52 = 0;
    d = "D";
    h = "H";
    tipo = "";
    tipo1 = "";
    &variable = "";
    &canti = 0;
    &canti2 = 0;
    &doh = "";

    aNomCta  = "";
    aNomCta1 = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE digito_i;

||//////////////////////////////////////////////////////////////////////////
|| ............ Calculos de Pantalla
|CALCULO inicio_b; |TIPO 8;
  |HAZ inicial;
  |SI swerror = 2; |PTEC 807; |ACABA; |FINSI;
  |SI swerror = 3; |PTEC 831; |PTEC 807; |ACABA; |FINSI;
  |HAZ DirAplicSt;
|FCAL;


|CALCULO LeeAgrupacion; |TIPO 0;
 #0#4 = "";
 |SI #0#3 = 0;
     #0#4 = "SIN PRESUPUESTO "; |PINTA #0#4;
     |ACABA;
 |FINSI;
 |ABRE #9;
 #9#0 = #0#3;
 |LEE 001#9=;
 |SI FSalida ! 0;
     |MENAV "    No exista agrupacion presupuestaria ";
     |ERROR;
 |FINSI;
 #0#4 = #9#1; |PINTA #0#4;
 |CIERRA #9;
|FCAL;

|CALCULO mayor; |TIPO 0;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FCAL;

|PROCESO deentrada;  |TIPO 7;

  |SI #0#0 = 0;  |Y #0#1 = 0;
      #0#0 = empre;
      #0#1 = ejerc - 1; |SI #0#1 = -1; #0#1 = 9; |FINSI;
      |PINTA #0#0;
      |PINTA #0#1;
  |FINSI;

 #0#17 = 1;
 |SI Haybasica = 1; |Y eaDepar = "S";
     #0#17 = 0;
 |FINSI;
 |PINTA #0#17;

|FPRC;

|PROCESO esbuena;
  |SI FSalida = 9;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0#0;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0#0;
      |MENAV "     NO Existe la empresa Contable";
      |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |CIERRAT #30;
  r_emp = 0;
  |SUB_EJECUTA_NP "caconemp";
  |ABRET #30;
  |ERROR;
  #0#0 = r_emp;
  #0#1 = r_per;
  |PTEC 802;
  |PTEC 802;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2; |ACABA; |FINSI;
  |ABRE #30;
  #30#2 = #0#0;
  #30#3 = #0#1;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la empresa Contable";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #30#13 ! dig3;  |O #30#14 ! dig4;  |O #30#15 ! dig5;
                      |O #30#16 ! dig6;  |O #30#17 ! dig7;
                      |O #30#18 ! dig8;  |O #30#19 ! dig9;
      |MENAV "     NO CORRESPONDEN LOS NIVELES";
  |FINSI;
  #0#2 = #30#1; |PINTA #0#2;
  anu1 = 1900 + #30#26;
  |SI anu1 [ 1970;
      anu1 = anu1 + 100;
  |FINSI;
  #30#2 = empre;
  #30#3 = ejerc;
  |LEE 011#30=;
  anu = 1900 + #30#26;
  |SI anu [ 1970;
      anu = anu + 100;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO pintames; |TIPO 0;
  |SI #0Campo ! 0; |Y #0Campo ! 13;
      NumMes = dig1 + (#0Campo - 1);
      |SI NumMes > 12;
          NumMes = NumMes - 12;
      |FINSI;
  |SINO;
      NumMes = #0Campo;
  |FINSI;
  |HAZ NombreMes;

  |SI Campo = 5;
      nNume1 = 6;
  |SINO;
      nNume1 = Campo + 2;
  |FINSI;
  #0nNume1 = NombreMes; |PINTA #0nNume1;
  |SI Campo = 5;
      #0#10 = #0#5; |PINTA #0#10;
      #0#12 = #0#6; |PINTA #0#12;
  |FINSI;

  |SI Campo = 10;
      |SI #0#9 > #0#10;
          |MENAV "    Error de Entrada ...";
          |ERROR;
      |FINSI;                           || Si el mes hasta es menor al desde
  |FINSI;
|FPRC;

|PROCESO pintames2; |TIPO 0;
  |SI #0Campo ! 0;|Y #0Campo ! 13;
      NumMes = dig1 + (#0Campo - 1);   || Operacion para saber que mes es
  |SINO;
      NumMes = #0Campo;
  |FINSI;
  |HAZ NombreMes;
  |ATRI I;
  |SI Campo = 7;   |PINTA 1258, NombreMes;  |FINSI;
  |SI Campo = 8;   |PINTA 1358, NombreMes;  |FINSI;
  |SI Campo = 13;  |PINTA 1558, NombreMes;  |FINSI;
  |SI Campo = 14;  |PINTA 1658, NombreMes;  |FINSI;
  |ATRI 0;
  |SI Campo = 7; #0#13 = #0#7; |PINTA #0#13; |FINSI;
  |SI Campo = 8; #0#14 = #0#8; |PINTA #0#14; |FINSI;
|FPRC;

|PROCESO nivel; |TIPO 7;
  |SI #0#15 = "N";
      |CAMPO_MODIFICA #0#16,1,"N";
      #0#16 = dig3; |PINTA #0#16;
  |SINO;
      |CAMPO_MODIFICA #0#16,1,"S";
  |FINSI;
|FPRC;

|PROCESO miraniv; |TIPO 0;
  nivel = #0#16;
  |SI nivel = 1;|Y dig4 = 0;  |AVISO;  |ERROR;  |FINSI;
  |SI nivel = 2;|Y dig5 = 0;  |AVISO;  |ERROR;  |FINSI;
  |SI nivel = 3;|Y dig6 = 0;  |AVISO;  |ERROR;  |FINSI;
  |SI nivel = 4;|Y dig7 = 0;  |AVISO;  |ERROR;  |FINSI;
  |SI nivel = 5;|Y dig8 = 0;  |AVISO;  |ERROR;  |FINSI;
  |SI nivel = 6;|Y dig9 = 0;  |AVISO;  |ERROR;  |FINSI;
|FPRC;

|PROCESO estruct; |TIPO 0;
  |SI #0#17 = 0;  |ACABA;  |FINSI;
  |ABRE #6;
  #6#0 = #0#17;
  |LEE 040#6=;
  |SI FSalida ! 0;
      |MENAV "    No existe la estructura de descarga.";
      |CIERRA #6;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #6;
|FPRC;

|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
|PROCESO antesque;
  aNomCta = "cacuenta";
  aparam = PARAMETRO;
  |QBF aparam; |SI aparam = " N"; aparam = ""; |FINSI;
  |SI aparam = "fech";
      aNomCta =  "cabalano";
      |NOME_DAT #11 "cabalpre";
  |FINSI;
  |NOME_DAT #1  aNomCta;
  aNomCta1 = aNomCta;

|FPRC;

|PROCESO conexi; |TIPO 0;

  nCam1 = empre;
  nCam2 = ejerc;
  nCam3 = enEjercicio;

  enTExi = 1;
  d_mes = #0#7;
  h_mes = #0#8;
  estru = #0#17;
  r_emp = empre;
  r_per = ejerc;
  r_nom = #30#1;
  r_eje = #30#26;
  |SUB_EJECUTA "caexicon";

  enTExi = 1;
  r_emp = #0#0;
  r_per = #0#1;
  r_nom = #0#2;
  estru = #0#17;
  r_eje = anu1 - 2000; |SI r_eje < 0; r_eje = anu1 - 1900; |FINSI;
  |SUB_EJECUTA "caexicon";

  |SI #0#13 = #0#14;
      |SI #0#13 = #0#7; |O #0#13 = #0#8;
          empre = nCam1;
          ejerc = nCam2;
          enEjercicio = nCam3;
          |ACABA;
      |FINSI;
  |SINO;
      |SI #0#7 ! #0#13; |O #0#8 ! #0#14;
          enTExi = 1;
          d_mes = #0#13;
          h_mes = #0#14;
          estru = #0#17;
          r_emp = empre;
          r_per = ejerc;
          r_nom = #30#1;
          r_eje = #30#26;
          |SUB_EJECUTA "caexicon";

          enTExi = 1;
          r_emp = #0#0;
          r_per = #0#1;
          r_nom = #0#2;
          estru = #0#17;
          r_eje = anu1 - 2000; |SI r_eje < 0; r_eje = anu1 - 1900; |FINSI;
          |SUB_EJECUTA "caexicon";
     |FINSI;
  |FINSI;
  empre = nCam1;
  ejerc = nCam2;
  enEjercicio = nCam3;
|FPRC;

|| ========================================================================
||                        CALCULOS INFORME
||     cantidad1  = mes          cantidad2  = anual              cantidad3  = presupuesto mes
||     cantidad11 = mes anterir  cantidad21 = anual anterior     cantidad31 = presupuesto -Ant
|| ========================================================================
|PROCESO MiraCta;
  |SI #4e3 = #1#0;
      sw_pasa = 1;
      |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE MiraExist;
 #4#1;
 ;
 #0#17, 001;
 #0#17, 999;
 e;
 NULL, MiraCta;
|FIN;

|| /////////////////////////////////
|PROCESO Calculit;
  |HAZ digitos2;
  |SI d_error ! 0;  |ACABA;  |FINSI;

  |SI #0#15 = "N"; |Y #1#3 = "N";                     |ACABA;  |FINSI;
  |SI #0#15 = "S"; |Y #1#55 > nivel;                  |ACABA;  |FINSI;
  |SI #0#15 = "S"; |Y #1#3 = "N";  |Y #1#55 ! nivel;  |ACABA;  |FINSI;

  sw_pasa = 0;
  |BUCLE MiraExist;
||   |SI sw_pasa = 1; |ACABA; |FINSI;

  aCuenta = #1#0;
  nNivel  = #1#1;
  nImpMes = 0;
  nImpAnu = 0;
  nImpPr1 = 0;
  nImpPr2 = 0;
  swCta   = 0;
  |HAZ resulta;

|SI sw_pasa = 1; |ACABA; |FINSI;

  |SI #1#5 = "H";
      nImpMes = - nImpMes;
      nImpAnu = - nImpAnu;
  |FINSI;

  |HAZ GrabaTmp0;
  |HAZ GrabaTmp2;
|FPRC;

|DEFBUCLE SumaCtas0;
 #1#4;
 ;
 "D", 1, 01, 00, 00;
 "H", 4, 99, 99, 99;
 e;
 NULL, Calculit;
|FIN;

|PROCESO resulta;    || Calculamos cada cuenta
 |PARA x = eldesde; |SI x [ elhasta; |HACIENDO x = x + 3;
       impMoneda = #1x;
       |SI aMonedaA ! aMonedaC; |Y dos = 2;
           |HAZ ElCMoneda;
       |FINSI;

       nImpAnu = nImpAnu + impMoneda;
 |SIGUE;
 impMoneda = #1elmesmv;
 |SI aMonedaA ! aMonedaC; |Y dos = 2;
     |HAZ ElCMoneda;
 |FINSI;
 nImpMes = impMoneda;
|FPRC;

|| //////////////////////////////////////////////////////////////////////
|PROCESO Calculit1;
  aCuenta = #11#0;
  nNivel  = #11#1;
  |HAZ LeeCta0; |SI swExiCta = 1; |ACABA; |FINSI;
  |SI #1#4 = 0; |ACABA; |FINSI;  || cuenta de Resultados
  |HAZ digitos2;
  |SI d_error ! 0;  |ACABA;  |FINSI;
  |SI #0#15 = "N"; |Y #1#3 = "N";                     |ACABA;  |FINSI;
  |SI #0#15 = "S"; |Y #1#55 > nivel;                  |ACABA;  |FINSI;
  |SI #0#15 = "S"; |Y #1#3 = "N";  |Y #1#55 ! nivel;  |ACABA;  |FINSI;

  nImpMes = 0;
  nImpAnu = 0;
  nImpPr1 = 0;
  nImpPr2 = 0;
  swCta   = 0;

  nNum1 = #0#9 + 3; nNum2 = #0#10 + 3;
  |SI nNum1 = 3; nNum1 = 4; |FINSI;
  |SI nNum2 = 3; nNum2 = 4; |FINSI;

  |PARA x = nNum1; |SI x [ nNum2; |HACIENDO x = x + 1;
        nImpPr2 = nImpPr2 + #11x;
  |SIGUE;
  nNum1 = #0#5 + 3; |SI nNum1 = 3; nNum1 = 4; |FINSI;
  nImpPr1 = #11nNum1;

  |SI #1#5 = "H";
      nImpPr1 = - nImpPr1;
      nImpPr2 = - nImpPr2;
  |FINSI;

  |HAZ GrabaTmp0;
  |HAZ GrabaTmp2;
|FPRC;

|DEFBUCLE SumaPres0;
 #11#1;
 ;
 #0#3, "            ", 0;
 #0#3, "zzzzzzzzzzzz", 9;
 e;
 NULL, Calculit1;
|FIN;

|| //////////////////////////////////////////////////////////////////////
|| //////////////////////////////////////////////////////////////////////
|| //////////////////////////////////////////////////////////////////////
|PROCESO impresio;
 |SI sw = 0;
     bloque   = #3#1;
     tipo     = #3#0;
     agrupaci = #3#2;
     epigrafe = #3#3;
     partida  = #3#4;
     |SI #3#0 = "D"; doh = "DEBE";  |FINSI;
     |SI #3#0 = "H"; doh = "HABER"; |FINSI;
     sw_inf = 0;
     |PRINT;
     sw = 1;
 |FINSI;

 |SI bloque = #3#1; |Y tipo = #3#0;
     |HAZ epigraf;
 |SINO;
     |SI tipo ! #3#0;                    || ruptura por tipo
         bloque1 = bloque;
         bloque = 4;
         |HAZ mirablo;
         |PIEINF;
         sw_inf = 0;
         doh = "HABER";
         |PRINT;
         |HAZ epigraf;
         bloque = bloque1;
      |SINO;                              || ruptura por bloque
         |HAZ mirablo;
         |HAZ epigraf;
      |FINSI;
      bloque = #3#1;
      tipo   = #3#0;
  |FINSI;
|FPRC;

|DEFBUCLE ImprCtas;
 #3#1;
 ;
 "D", 1, 01, 00, 00;
 "H", 4, 99, 99, 99;
 e;
 NULL, impresio;
|FIN;

||..................................................................
|PROCESO cuenta1;
  sw_inf = 6;
  cantidad1 = #5#11; cantidad11 = #5#12;  || mes
  cantidad2 = #5#13; cantidad21 = #5#15;  || a¤o
  cantidad3 = #5#14; cantidad31 = #5#16;  || presupuesto mes/a¤o

  cta = #5#5;
  nom = #5#7;
  |SI cantidad1  !  0; |O cantidad2  ! 0; |O cantidad3  ! 0;
   |O cantidad11 !  0; |O cantidad21 ! 0; |O cantidad31 ! 0;
      |PRINT;
 |FINSI;
|FPRC;

|DEFBUCLE cabaexpl5;
 #5#1;
 ;
 #3#0, #3#1, #3#2, #3#3, #3#4, "            ", 0;
 #3#0, #3#1, #3#2, #3#3, #3#4, "zzzzzzzzzzzz", 9;
 e;
 NULL, NULL, NULL, NULL, NULL, cuenta1;
 #5#5, #5#6;
|FIN;

|PROCESO epigraf;
  |SI epigrafe ! #3#3;
      sw_epi = 0;
  |FINSI;
  |HAZ rotura;
  epigrafe = #3#3;
|FPRC;

|PROCESO rotura;
  |SI #3#4 = 0;
      sw_inf = 2;
      |PRINT;
      |SI #0#15 = "S";
          |BUCLE cabaexpl5;
          sw_inf = 5;
          |PRINT;
      |FINSI;
  |SINO;
      |SI sw_epi = 0;
          sw_inf = 3;       || epigrafe
          |PRINT;
          sw_epi = 1;       || variables
      |FINSI;
      sw_inf = 4;           || partida
      |PRINT;
      |SI #0#15 = "S";
          |BUCLE cabaexpl5;
          sw_inf = 5;
          |PRINT;          || linea en blanco
      |FINSI;
  |FINSI;
|FPRC;
|| ....................................................................

|PROCESO final;    || Para cuando acaba el defbucle
  |SI tipo = "D"; bloque = 4; |FINSI;
  |SI tipo = "H"; bloque = 3; |FINSI;
  |HAZ mirablo;
|FPRC;

|PROCESO mirablo;
  sw_inf = 1;
  |SI tipo = "D";
      |HAZ bloqued1;
      |SI bloque = 1;  |Y #3#1 [ 2;  |ACABA;  |FINSI;
      |HAZ bloqued2;
      |SI bloque [ 2;  |Y #3#1 [ 3;  |ACABA;  |FINSI;
      |HAZ bloqued3;
      |SI bloque [ 3;  |ACABA;  |FINSI;
      |HAZ bloqued4;
  |FINSI;
  |SI tipo = "H";
      |HAZ bloqueh1;
      |SI bloque = 1;  |Y #3#1 [ 2;  |ACABA;  |FINSI;
      |HAZ bloqueh2;
      |SI bloque [ 2;  |ACABA;  |FINSI;
      |HAZ bloqueh3;
  |FINSI;
|FPRC;

|PROCESO bloqued1;
  |SI sw_d1 = 1; |O sw_h1 = 1; |HAZ tipod1;  |FINSI;      || I
|FPRC;

|PROCESO bloqued2;
  |SI sw_d2 = 1; |O sw_h2 = 1; |HAZ tipod2;  |FINSI;      || II
  |SI sw_d21 = 0;              |HAZ tipod21; |FINSI;      || III
|FPRC;

|PROCESO bloqued3;
  |SI sw_d3 = 1; |O sw_h3 = 1; |HAZ tipod3;  |FINSI;      || IV
  |SI sw_d31 = 0;              |HAZ tipod31; |FINSI;      || V
|FPRC;

|PROCESO bloqued4;
  |SI sw_d4 = 0;               |HAZ tipod4;  |FINSI;      || VI
|FPRC;

|PROCESO bloqueh1;
  |SI sw_d1 = 1; |O sw_h1 = 1; |HAZ tipoh1;  |FINSI;      || I
|FPRC;

|PROCESO bloqueh2;
  |SI sw_d2 = 1; |O sw_h2 = 1; |HAZ tipoh2;  |FINSI;      || II
  |SI sw_h21 = 0;              |HAZ tipoh21; |FINSI;      || III
|FPRC;

|PROCESO bloqueh3;
  |SI sw_d3 = 1; |O sw_h3 = 1; |HAZ tipoh3;  |FINSI;      || IV
  |SI sw_h31 = 0;              |HAZ tipoh31; |FINSI;      || V
  |SI sw_h32 = 0;              |HAZ tipoh32; |FINSI;      || VI
|FPRC;

|PROCESO tipod1;
  variable = "  I. BENEFICIOS DE EXPLOTACION ..........................";
  cantidad1 = haber11 - debe11;
  cantidad2 = habeA11 - debA11;
  cantidad3 = habeP11 - debP11;
  cantidad11 = haber1 - debe1;
  cantidad21 = habeA1 - debA1;
  cantidad31 = habeP1 - debP1;
 || --------------------------------------- las dos empresas
 |SI cantidad1  < 0; punto_h1  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_d1  = cantidad1; |FINSI;
 |SI cantidad2  < 0; puntA_h1  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_d1  = cantidad2; |FINSI;
 |SI cantidad3  < 0; puntP_h1  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_d1  = cantidad3; |FINSI;

 |SI cantidad11 < 0; punto_h12 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_d12 = cantidad11; |FINSI;
 |SI cantidad21 < 0; puntA_h12 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_d12 = cantidad21; |FINSI;
 |SI cantidad31 < 0; puntP_h12 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_d12 = cantidad31; |FINSI;


 |SI sw_d1 = 0; |ACABA; |FINSI;
 |SI cantidad1 > 0; |Y cantidad2 > 0; |Y cantidad3> 0;
     |Y cantidad11 > 0; |Y cantidad21 > 0; |Y cantidad31 > 0;
        sw_h1 = 0;
 |FINSI;
 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
     sw_d1 = 0;
  |FINSI;
|FPRC;

|PROCESO tipoh1;
  variable = "  I. PERDIDAS DE EXPLOTACION ............................";
  cantidad1  = debe11 - haber11;
  cantidad2  = debA11 - habeA11;
  cantidad3  = debP11 - habeP11;
  cantidad11 = debe1 - haber1;
  cantidad21 = debA1 - habeA1;
  cantidad31 = debP1 - habeP1;
  || --------------------------------------- las dos empresas
 |SI cantidad1  [ 0; punto_d1  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_h1  = cantidad1; |FINSI;
 |SI cantidad2  [ 0; puntA_d1  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_h1  = cantidad2; |FINSI;
 |SI cantidad3  [ 0; puntP_d1  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_h1  = cantidad3; |FINSI;

 |SI cantidad11 [ 0; punto_d12 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_h12 = cantidad11; |FINSI;
 |SI cantidad21 [ 0; puntA_d12 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_h12 = cantidad21; |FINSI;
 |SI cantidad31 [ 0; puntP_d12 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_h12 = cantidad31; |FINSI;

 |SI sw_h1 = 0; |ACABA; |FINSI;
 |SI cantidad1 > 0; |Y cantidad2 > 0; |Y cantidad3> 0;
     |Y cantidad11 > 0; |Y cantidad21 > 0; |Y cantidad31 > 0;
        sw_d1 = 0;
 |FINSI;
 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
     sw_h1 = 0;
 |FINSI;
|FPRC;

|PROCESO tipod2;
  variable = " II. RESULTADOS FINANCIEROS POSITIVOS ...................";
  cantidad1 = haber21 - debe21;
  cantidad2 = habeA21 - debA21;
  cantidad3 = habeP21 - debP21;
  cantidad11 = haber2 - debe2;
  cantidad21 = habeA2 - debA2;
  cantidad31 = habeP2 - debP2;

  || --------------------------------------- las dos empresas
 |SI cantidad1  < 0; punto_h2  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_d2  = cantidad1; |FINSI;
 |SI cantidad2  < 0; puntA_h2  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_d2  = cantidad2; |FINSI;
 |SI cantidad3  < 0; puntP_h2  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_d2  = cantidad3; |FINSI;

 |SI cantidad11 < 0; punto_h22 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_d22 = cantidad11; |FINSI;
 |SI cantidad21 < 0; puntA_h22 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_d22 = cantidad21; |FINSI;
 |SI cantidad31 < 0; puntP_h22 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_d22 = cantidad31; |FINSI;


  |SI sw_d2 = 0; |ACABA; |FINSI;

  |SI cantidad1 > 0; |Y cantidad2 > 0; |Y cantidad3> 0;
      |Y cantidad11 > 0; |Y cantidad21 > 0; |Y cantidad31 > 0;
      sw_h2 = 0;
 |FINSI;
 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
     sw_d2 = 0;
  |FINSI;
|FPRC;

|PROCESO tipod21;
  variable = "III. BENEFICIOS DE LAS ACTIVIDADES ORDINARIAS ...........";
  cantidad1  = punto_d1  + punto_d2  - punto_h1  - punto_h2;
  cantidad2  = puntA_d1  + puntA_d2  - puntA_h1  - puntA_h2;
  cantidad3  = puntP_d1  + puntP_d2  - puntP_h1  - puntP_h2;
  cantidad11 = punto_d12 + punto_d22 - punto_h12 - punto_h22;
  cantidad21 = puntA_d12 + puntA_d22 - puntA_h12 - puntA_h22;
  cantidad31 = puntP_d12 + puntP_d22 - puntP_h12 - puntP_h22;

 || --------------------------------------- las dos empresas
 |SI cantidad1  < 0; punto_h3  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_d3  = cantidad1; |FINSI;
 |SI cantidad2  < 0; puntA_h3  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_d3  = cantidad2; |FINSI;
 |SI cantidad3  < 0; puntP_h3  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_d3  = cantidad3; |FINSI;

 |SI cantidad11 < 0; punto_h32 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_d32 = cantidad11; |FINSI;
 |SI cantidad21 < 0; puntA_h32 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_d32 = cantidad21; |FINSI;
 |SI cantidad31 < 0; puntP_h32 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_d32 = cantidad31; |FINSI;

 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
    sw_inf = 5; |PRINT;
    sw_inf = 1; |PRINT;
    sw_inf = 5; |PRINT;
    sw_d21 = 1;
  |FINSI;
|FPRC;

|PROCESO tipoh2;
  variable = " II. RESULTADOS FINANCIEROS NEGATIVOS ...................";
  cantidad1  = debe21 - haber21;
  cantidad2  = debA21 - habeA21;
  cantidad3  = debP21 - habeP21;
  cantidad11 = debe2 - haber2;
  cantidad21 = debA2 - habeA2;
  cantidad31 = debP2 - habeP2;

  || --------------------------------------- las dos empresas
 |SI cantidad1  [ 0; punto_d2  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_h2  = cantidad1; |FINSI;
 |SI cantidad2  [ 0; puntA_d2  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_h2  = cantidad2; |FINSI;
 |SI cantidad3  [ 0; puntP_d2  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_h2  = cantidad3; |FINSI;

 |SI cantidad11 [ 0; punto_d22 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_h22 = cantidad11; |FINSI;
 |SI cantidad21 [ 0; puntA_d22 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_h22 = cantidad21; |FINSI;
 |SI cantidad31 [ 0; puntP_d22 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_h22 = cantidad31; |FINSI;


  |SI sw_h2 = 0; |ACABA; |FINSI;

  |SI cantidad1 > 0; |Y cantidad2 > 0; |Y cantidad3> 0;
      |Y cantidad11 > 0; |Y cantidad21 > 0; |Y cantidad31 > 0;
      sw_d2 = 0;
 |FINSI;
 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
     sw_h2 = 0;
 |FINSI;
|FPRC;

|PROCESO tipoh21;
  variable = "III. PERDIDAS DE LAS ACTIVIDADES ORDINARIAS .............";
  cantidad1  = punto_h1 +  punto_h2 -  punto_d1 -  punto_d2;
  cantidad2  = puntA_h1 +  puntA_h2 -  puntA_d1 -  puntA_d2;
  cantidad3  = puntP_h1 +  puntP_h2 -  puntP_d1 -  puntP_d2;
  cantidad11 = punto_h12 + punto_h22 - punto_d12 - punto_d22;
  cantidad21 = puntA_h12 + puntA_h22 - puntA_d12 - puntA_d22;
  cantidad31 = puntP_h12 + puntP_h22 - puntP_d12 - puntP_d22;
 || --------------------------------------- las dos empresas
 |SI cantidad1  < 0; punto_d3  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_h3  = cantidad1; |FINSI;
 |SI cantidad2  < 0; puntA_d3  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_h3  = cantidad2; |FINSI;
 |SI cantidad3  < 0; puntP_d3  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_h3  = cantidad3; |FINSI;

 |SI cantidad11 < 0; punto_d32 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_h32 = cantidad11; |FINSI;
 |SI cantidad21 < 0; puntA_d32 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_h32 = cantidad21; |FINSI;
 |SI cantidad31 < 0; puntP_d32 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_h32 = cantidad31; |FINSI;

 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
    sw_inf = 5; |PRINT;
    sw_inf = 1; |PRINT;
    sw_inf = 5; |PRINT;
    sw_h21 = 1;
  |FINSI;
|FPRC;

|PROCESO tipod3;
  variable = " IV. RESULTADOS EXTRAORDINARIOS POSITIVOS ...............";
  cantidad1 = haber31 - debe31;
  cantidad2 = habeA31 - debA31;
  cantidad3 = habeP31 - debP31;
  cantidad11 = haber3 - debe3;
  cantidad21 = habeA3 - debA3;
  cantidad31 = habeP3 - debP3;
 || --------------------------------------- las dos empresas
 |SI cantidad1  < 0; punto_h4  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_d4  = cantidad1; |FINSI;
 |SI cantidad2  < 0; puntA_h4  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_d4  = cantidad2; |FINSI;
 |SI cantidad3  < 0; puntP_h4  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_d4  = cantidad3; |FINSI;

 |SI cantidad11 < 0; punto_h42 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_d42 = cantidad11; |FINSI;
 |SI cantidad21 < 0; puntA_h42 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_d42 = cantidad21; |FINSI;
 |SI cantidad31 < 0; puntP_h42 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_d42 = cantidad31; |FINSI;

 |SI sw_d3 = 0; |ACABA; |FINSI;
  |SI cantidad1 > 0; |Y cantidad2 > 0; |Y cantidad3> 0;
      |Y cantidad11 > 0; |Y cantidad21 > 0; |Y cantidad31 > 0;
      sw_h3 = 0;
 |FINSI;
 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
     sw_d3 = 0;
 |FINSI;
|FPRC;

|PROCESO tipod31;
  variable = "  V. BENEFICIO ANTES DE IMPUESTOS .......................";
  cantidad1  = punto_d3  + punto_d4  - punto_h3 -  punto_h4;
  cantidad2  = puntA_d3  + puntA_d4  - puntA_h3 -  puntA_h4;
  cantidad3  = puntP_d3  + puntP_d4  - puntP_h3 -  puntP_h4;
  cantidad11 = punto_d32 + punto_d42 - punto_h32 - punto_h42;
  cantidad21 = puntA_d32 + puntA_d42 - puntA_h32 - puntA_h42;
  cantidad31 = puntP_d32 + puntP_d42 - puntP_h32 - puntP_h42;

  || --------------------------------------- las dos empresas
  |SI cantidad1  < 0; punto_h5  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_d5  = cantidad1; |FINSI;
  |SI cantidad2  < 0; puntA_h5  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_d5  = cantidad2; |FINSI;
  |SI cantidad3  < 0; puntP_h5  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_d5  = cantidad3; |FINSI;

  |SI cantidad11 < 0; punto_h52 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_d52 = cantidad11; |FINSI;
  |SI cantidad21 < 0; puntA_h52 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_d52 = cantidad21; |FINSI;
  |SI cantidad31 < 0; puntP_h52 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_d52 = cantidad31; |FINSI;

 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
     sw_d31 = 1;
  |FINSI;
|FPRC;


|PROCESO tipoh3;
  variable = " IV. RESULTADOS EXTRAORDINARIOS NEGATIVOS ...............";
  cantidad1  = debe31 - haber31;
  cantidad2  = debA31 - habeA31;
  cantidad3  = debP31 - habeP31;
  cantidad11 = debe3 - haber3;
  cantidad21 = debA3 - habeA3;
  cantidad31 = debP3 - habeP3;
  || --------------------------------------- las dos empresas
  |SI cantidad1  [ 0; punto_d5  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_h4  = cantidad1; |FINSI;
  |SI cantidad2  [ 0; puntA_d5  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_h4  = cantidad2; |FINSI;
  |SI cantidad3  [ 0; puntP_d5  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_h4  = cantidad3; |FINSI;

  |SI cantidad11 [ 0; punto_d52 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_h42 = cantidad11; |FINSI;
  |SI cantidad21 [ 0; puntA_d52 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_h42 = cantidad21; |FINSI;
  |SI cantidad31 [ 0; puntP_d52 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_h42 = cantidad31; |FINSI;

 |SI sw_h3 = 0; |ACABA; |FINSI;
 |SI cantidad1 > 0; |Y cantidad2 > 0; |Y cantidad3> 0;
     |Y cantidad11 > 0; |Y cantidad21 > 0; |Y cantidad31 > 0;
        sw_d3 = 0;
 |FINSI;
 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
     sw_inf = 5; |PRINT;
     sw_inf = 1; |PRINT;
     sw_inf = 5; |PRINT;
    sw_h3 = 0;
 |FINSI;
|FPRC;

|PROCESO tipoh31;
  variable = "  V. PERDIDAS ANTES DE IMPUESTOS ........................";
  cantidad1  = punto_h3  + punto_h4  - punto_d3  - punto_d4;
  cantidad2  = puntA_h3  + puntA_h4  - puntA_d3  - puntA_d4;
  cantidad3  = puntP_h3  + puntP_h4  - puntP_d3  - puntP_d4;
  cantidad11 = punto_h32 + punto_h42 - punto_d32 - punto_d42;
  cantidad21 = puntA_h32 + puntA_h42 - puntA_d32 - puntA_d42;
  cantidad31 = puntP_h32 + puntP_h42 - puntP_d32 - puntP_d42;

  || --------------------------------------- las dos empresas
  |SI cantidad1  [ 0; punto_d5  = cantidad1 * -1; cantidad1  = 0; |SINO; punto_h5  = cantidad1; |FINSI;
  |SI cantidad2  [ 0; puntA_d5  = cantidad2 * -1; cantidad2  = 0; |SINO; puntA_h5  = cantidad2; |FINSI;
  |SI cantidad3  [ 0; puntP_d5  = cantidad3 * -1; cantidad3  = 0; |SINO; puntP_h5  = cantidad3; |FINSI;

  |SI cantidad11 [ 0; punto_d52 = cantidad11 * -1; cantidad11 = 0; |SINO; punto_h52 = cantidad11; |FINSI;
  |SI cantidad21 [ 0; puntA_d52 = cantidad21 * -1; cantidad21 = 0; |SINO; puntA_h52 = cantidad21; |FINSI;
  |SI cantidad31 [ 0; puntP_d52 = cantidad31 * -1; cantidad31 = 0; |SINO; puntP_h52 = cantidad31; |FINSI;

 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
    sw_inf = 5; |PRINT;
    sw_inf = 1; |PRINT;
    sw_inf = 5; |PRINT;
    sw_h31 = 1;
  |FINSI;
|FPRC;

|PROCESO tipoh32;
  variable = " VI. RESULTADO DEL EJERCICO (PERDIDAS) ..................";
  cantidad1  = punto_h5;
  cantidad2  = puntA_h5;
  cantidad3  = puntP_h5;
  cantidad11 = punto_h52;
  cantidad21 = puntA_h52;
  cantidad31 = puntP_h52;
  || --------------------------------------- las dos empresas

  |SI punto_h5 > 0; cantidad1 = cantidad1 + debe41; |FINSI;
  |SI puntA_h5 > 0; cantidad2 = cantidad2 + debA41; |FINSI;
  |SI puntP_h5 > 0; cantidad3 = cantidad3 + debP41; |FINSI;

  |SI cantidad1 [ 0; cantidad1 = 0; |FINSI;
  |SI cantidad2 [ 0; cantidad2 = 0; |FINSI;
  |SI cantidad3 [ 0; cantidad3 = 0; |FINSI;

  |SI punto_h52 > 0; cantidad11 = cantidad11 + debe4; |FINSI;
  |SI puntA_h52 > 0; cantidad21 = cantidad21 + debA4; |FINSI;
  |SI puntP_h52 > 0; cantidad31 = cantidad31 + debP4; |FINSI;

  |SI cantidad11 [ 0; cantidad11 = 0; |FINSI;
  |SI cantidad21 [ 0; cantidad21 = 0; |FINSI;
  |SI cantidad31 [ 0; cantidad31 = 0; |FINSI;

 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
      sw_inf = 5; |PRINT;
      sw_inf = 1; |PRINT;
      sw_inf = 5; |PRINT;
      sw_h32 = 1;
  |FINSI;

|FPRC;

|PROCESO tipod4;
  variable = " VI. RESULTADO DEL EJERCICIO (BENEFICIOS) ...............";
  cantidad1  = punto_d5;
  cantidad2  = puntA_d5;
  cantidad3  = puntP_d5;
  cantidad11 = punto_d52;
  cantidad21 = puntA_d52;
  cantidad31 = puntP_d52;
  || --------------------------------------- las dos empresas
  |SI debe41 > 0; cantidad1= cantidad1  - debe41; |FINSI;
  |SI debA41 > 0; cantidad2= cantidad2  - debA41; |FINSI;
  |SI debP41 > 0; cantidad3= cantidad3  - debP41; |FINSI;

  |SI cantidad1 [ 0; cantidad1 = 0; |FINSI;
  |SI cantidad2 [ 0; cantidad2 = 0; |FINSI;
  |SI cantidad3 [ 0; cantidad3 = 0; |FINSI;

  |SI debe4 > 0; cantidad11 = cantidad11 - debe4; |FINSI;
  |SI debA4 > 0; cantidad21 = cantidad21 - debA4; |FINSI;
  |SI debP4 > 0; cantidad31 = cantidad31 - debP4; |FINSI;

  |SI cantidad11 [ 0; cantidad11 = 0; |FINSI;
  |SI cantidad21 [ 0; cantidad21 = 0; |FINSI;
  |SI cantidad31 [ 0; cantidad31 = 0; |FINSI;

 |SI cantidad1 > 0; |O cantidad2 > 0; |O cantidad3 > 0;
     |O cantidad11> 0; |O cantidad21 > 0; |O cantidad31 > 0;
      sw_inf = 5; |PRINT;
      sw_inf = 1; |PRINT;
      sw_inf = 5; |PRINT;
      sw_d4 = 1;
  |FINSI;

|FPRC;

||*************************************************************************
||*************************************************************************
|PROCESO impre; |TIPO 3;
  aMonedaA = eaMoneda;

  |HAZ antesque;
  |SI #0#23 = "S";
      |HAZ conexi;
      eaMoneda = aMonedaA; |HAZ Monedas;
  |FINSI;

  |ABRE #3; |CIERRA #3; |DELINDEX #3;
  |ABRE #4; |CIERRA #4; |DELINDEX #4;
  |ABRE #5; |CIERRA #5; |DELINDEX #5;

  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  informe = inform1;
  |SI #0#3 = 0;
      informe = inform2;
  |FINSI;

  |INFOR informe;
  |SI FSalida ! 0;
      |MENAV "     Error en informe.";
      |FINIMP;
      |ACABA;
  |FINSI;

  elmesmv = (#0#5  * 3) + 11;  ||mes de movimientos
  eldesde = (#0#9  * 3) + 11;  ||Desde / Hasta Anual
  elhasta = (#0#10 * 3) + 11;

  sw_d1 = 0; sw_d2 = 0; sw_d3 = 0; sw_d4 = 0;
  sw_h1 = 0; sw_h2 = 0; sw_h3 = 0;
  sw = 0;

|PARA dos = 1; |SI dos [ 2; |HACIENDO dos = dos + 1;

      |NOME_DAT #1 aNomCta;

      acumula = 8; acumul2 = 11;
      e1 = 4; e2 = 5; e3 = 6; e4 = 7;

      |SI dos = 2;
          debe11  = debe1;  debe21  = debe2;  debe31  = debe3;  debe41  = debe4;
          haber11 = haber1; haber21 = haber2; haber31 = haber3;

          debA11  = debA1;  debA21  = debA2;  debA31  = debA3;  debA41  = debA4;
          habeA11 = habeA1; habeA21 = habeA2; habeA31 = habeA3;

          debP11  = debP1;  debP21  = debP2;  debP31  = debP3;  debP41  = debP4;
          habeP11 = habeP1; habeP21 = habeP2; habeP31 = habeP3;

          debe1  = 0; debe2  = 0; debe3  = 0; debe4 = 0;
          haber1 = 0; haber2 = 0; haber3 = 0;
          debA1  = 0; debA2  = 0; debA3  = 0; debA4 = 0;
          habeA1 = 0; habeA2 = 0; habeA3 = 0;
          debP1  = 0; debP2  = 0; debP3  = 0; debP4 = 0;
          habeP1 = 0; habeP2 = 0; habeP3 = 0;

          acumula = 10; acumul2 = 12;
          e1 =  9; e2 = 10; e3 = 11; e4 = 12;

          |DBASE dir_fich;
          dir_fich = dir_fich + "fich/";
          alfa1 = #0#0;   alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
          alfa2 = #0#1;   alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
          alfa3 = dir_fich + alfa1 + alfa2 + "/";

          |PATH_DAT #1  alfa3;
          |PATH_DAT #2  alfa3;
          |PATH_DAT #6  alfa3;
          |PATH_DAT #7  alfa3;
          |PATH_DAT #8  alfa3;
          |PATH_DAT #11 alfa3;
          |ABRE #30;
          #30#2 = #0#0;
          #30#3 = #0#1;
          |LEE 011#30=;
          |CIERRA #30;

          aMonedaC = #30#28;
          eaMoneda = aMonedaC;
          |HAZ Monedas;

          pathbal = dirfich0;
          dirfich0 = alfa3;
          |HAZ FecApeCie;
          dirfich0 = pathbal;
          |SI enMAper ! #30#11;
              |SI #0#10 < enMAper; |Y #0#10 ! 0;
                  |VETE EstaNo;
              |FINSI;
          |FINSI;
     |FINSI;

  ||... Modificar Cuentas a balance segun saldo
  |SI dos = 1;
      r_emp = empre;
      r_per = ejerc;
  |SINO;
      r_emp = #0#0;
      r_per = #0#1;
  |FINSI;
  enSwOper = 0;
  |SUB_EJECUTA "carecsig.run";

  |ABRE #8;
  #8#0 = 1;
  |LEE 000#8=;
  |CIERRA #8;
  |SI #8#2 = "S";  |Y #8#3 = "N";  |Y aparam = "";
      |SI dos = 2;
          pathbal = alfa3;
          r_emp = #0#14;
          r_per = #0#15;
      |SINO;
          |DFICE pathbal;
           r_emp = empre;
           r_per = ejerc;
      |FINSI;
      balance = 1;
      |SI #caconimp#10 = "S";
          enSwOper = 2;
          |SUB_EJECUTA "carecsig";
           enSwOper = 0;
           |SI enECuadre = 1; |ACABA; |FINSI;
           |NOME_DAT #1 eaNomFCta;
           |SI dos = 1; aNomCta1 = eaNomFCta; |FINSI;
      |SINO;
           |SUB_EJECUTA "careccue";
      |FINSI;
  |FINSI;
|| ---------------------------------------------------------------------
  |ABRE #1;
  |ABRE #3;
  |ABRE #5;
  |ABRE #6;
  |ABRE #4;

  |HAZ CalculaExis;          || graba descarga de existencias

  |CIERRA #4;
  |CIERRA #6;
  |CIERRA #1;
  |BUCLE SumaCtas0;      || Bucle de Calculos - resto cuentas Saldo
  |SI dos = 1;
      |SI #0#3 ! 0;
          |ABRE #1;
          |BUCLE SumaPres0;      || Bucle de Calculos - Cuentas Presupuesto (( aqui ))
          |CIERRA #1;
      |FINSI;
  |FINSI;

  |CIERRA #3;
  |CIERRA #5;

  |ET EstaNo;
|SIGUE; || ==================================================================

   |DFICE pathbal;
   |NOME_DAT #1 aNomCta1;
   |PATH_DAT #1 pathbal;
   |ABRE #30;
   #30#2 = empre;
   #30#3 = ejerc;
   |LEE 011#30=;
   |CIERRA #30;
   eaMoneda = aMonedaA; |HAZ Monedas;

  |ABRE #1;
  |BUCLE ImprCtas; || Bucle de impresion

  |HAZ final;
  |PIEINF;
  |FININF;
  |CIERRA #1;

  |FINIMP;
  |DELINDEX #3;
  |DELINDEX #4;
  |DELINDEX #5;
|FPRC;
||*************************************************************************
||*************************************************************************
||*************************************************************************

|| Prepara ficheros de Existencias para calcular la variacion
|PROCESO descarg;
  |HAZ digitos2;
  |SI d_error ! 0;  |ACABA;  |FINSI;
  linea = linea + 1;
  #4#0 = linea;
  #4#8 = #0#17;
  |LEE 001#4=;
  |SI FSalida = 0;  |BORRA 020#4a;  |FINSI;

  |DDEFECTO #4;
  #4#0 = linea;    || linea
  #4#8 = #0#17;    || estructura
  #4#1 = #1#0;     || cuenta
  #4#2 = #1#1;     || digito
  #4#3 = #1#2;     || descripcion

|| ... Acumulado del Mes
  nMesEx = #0#7 + 11; #4e1   = #7nMesEx;    || exist. iniciales
  nMesEx = #0#8 + 11; #4e2   = #7nMesEx;    || exist. finales

  |SI aMonedaA ! aMonedaC; |Y dos = 2;
      impMoneda = #4e1; |HAZ ElCMoneda; #4e1 = impMoneda;
      impMoneda = #4e2; |HAZ ElCMoneda; #4e2 = impMoneda;
  |FINSI;
  descar  = #4e1 - #4e2;
  tracan5 = descar; || diferencia entre iniciales y finales MES
  |SI descar ] 0;
      #4e3 = #7#5;     || cuenta descarga D
      #4e4 = #7#6;     || digito descarga D
  |SINO;
      #4e3 = #7#8;     || cuenta descarga H
      #4e4 = #7#9;     || digito descarga H
  |FINSI;
   eaCuenta = #4e3;
   |HAZ SacaNivel;
   #4e4 = enNivel;


  |SI #0#15 = "N";  nivel = #4e4;  |FINSI;
  |SI nivel < #4e4;
      |SI nivel = 1;  nNum3 = 100 + dig4;  |FINSI;
      |SI nivel = 2;  nNum3 = 100 + dig5;  |FINSI;
      |SI nivel = 3;  nNum3 = 100 + dig6;  |FINSI; || trata cta. descarga
      |SI nivel = 4;  nNum3 = 100 + dig7;  |FINSI;
      |SI nivel = 5;  nNum3 = 100 + dig8;  |FINSI;
      alfa1 = nNum3;
      #4e3 = #4e3 % alfa1;
      #4e4 = nivel;
      #4e3 = #4e3 + "              ";
      #4e3 = #4e3 % 112;
  |FINSI;

  nNum1 = 28; nNum2 = 29; |SI dos = 2; nNum1 = 30; nNum2 = 31; |FINSI;
|| ... Acumulado del Anual
  nMesEx = #0#13 + 11; #4nNum1 = #7nMesEx;    || exist. iniciales
  nMesEx = #0#14 + 11; #4nNum2 = #7nMesEx;    || exist. finales
  |SI aMonedaA ! aMonedaC; |Y dos = 2;
      impMoneda = #4nNum1; |HAZ ElCMoneda; #4nNum1 = impMoneda;
      impMoneda = #4nNum2; |HAZ ElCMoneda; #4nNum2 = impMoneda;
  |FINSI;

  descarA = #4nNum1 - #4nNum2;
  tracan6 = descarA; || diferencia entre iniciales y finales ANUAL
  |GRABA 020#4n;

  aCuenta = #4e3;
  nNivel  = #4e4;
  nImpMes = descar;
  nImpAnu = descarA;
  nImpPr1 = 0;
  nImpPr2 = 0;
  swCta   = 1;  || Cuenta de Descarga

  |HAZ LeeCta0; |SI swExiCta = 1; |ACABA; |FINSI;

  |SI #1#5 = "H";
      nImpMes = - nImpMes;
      nImpAnu = - nImpAnu;
      nImpPr1 = - nImpPr1;
      nImpPr2 = - nImpPr2;
  |FINSI;

  |HAZ GrabaTmp0;
  |HAZ GrabaTmp2;
|FPRC;

|PROCESO lineades;
  #1#0 = #7#2;
  #1#1 = #7#3;
  |LEE 000#1=;
  |SI FSalida = 0;
      |HAZ descarg;
  |FINSI;
|FPRC;

|PROCESO CalculaExis;
  || linea = 0  -- no borra la linea para continuar con la 2¦ emp.

  posici = 100;
  #6#0 = #0#17;
  |LEE 001#6=;
  |BUCLELIN 0lineades#6;
|FPRC;

|| ...................................................................
|| ...................................................................
|PROCESO LeeCta0;
  swExiCta = 0;
  #1#0 = aCuenta;
  #1#1 = nNivel;
  |LEE 040#1=;
  |SI FSalida ! 0; swExiCta = 1; |FINSI;
|FPRC;

|PROCESO GrabaTmp0;  ||Temporal cabaexp0 - #3
   |SI aMonedaC ! aMonedaA; |Y dos = 2;
       nRedo1 = EURODB;
       EURODB = nRedon;
   |FINSI;

  #3#0 = #1#5;
  #3#1 = #1#4;
  #3#2 = #1#6;
  #3#3 = #1#7;
  #3#4 = #1#8;
  |LEE 101#3=;
  |SI FSalida ! 0;
      |DDEFECTO #3;
      #3#0 = #1#5;
      #3#1 = #1#4;
      #3#2 = #1#6;
      #3#3 = #1#7;
      #3#4 = #1#8;
      |HAZ leexplot;
      #3#5 = #2#3;
      #3#6 = #2#5;
      #3#7 = #2#7;
      |GRABA 020#3b;
  |FINSI;

  #3#9 = swCta;  || Cuenta de Descarga = 1

  nNum1 = 11; |SI dos = 2; nNum1 = 13; |FINSI;
  #3acumula = #3acumula + nImpMes;
  #3nNum1   = #3nNum1   + nImpAnu;
  #3#12     = #3#12 + nImpPr1;
  #3#14     = #3#14 + nImpPr2;

  |GRABA 020#3a;
  |LIBERA #3;

  |HAZ sumasal;

  |SI aMonedaC ! aMonedaA; |Y dos = 2;
      EURODB = nRedo1;
  |FINSI;

|FPRC;

|PROCESO GrabaTmp2;  ||Temporal cabaexp2 - #5
   |SI aMonedaC ! aMonedaA; |Y dos = 2;
       nRedo1 = EURODB;
       EURODB = nRedon;
   |FINSI;

  #5#0 = #1#5;
  #5#1 = #1#4;
  #5#2 = #1#6;
  #5#3 = #1#7;
  #5#4 = #1#8;
  |HAZ acortacuen;
  #5#5 = #1#0;
  #5#6 = #1#1;
  #5#7 = #1#2;
  |LEE 000#5=;
  |SI FSalida ! 0;
      |DDEFECTO #5;
      #5#0 = #1#5;
      #5#1 = #1#4;
      #5#2 = #1#6;
      #5#3 = #1#7;
      #5#4 = #1#8;
      |HAZ acortacuen;
      #5#5 = #1#0;
      #5#6 = #1#1;
      #5#7 = #1#2;
      |HAZ leexplot;
      #5#8  = #2#3;
      #5#9  = #2#5;
      #5#10 = #2#7;
      |GRABA 020#5b;
  |FINSI;

  nNum1 = 13; |SI dos = 2; nNum1 = 15; |FINSI;

  #5acumul2 = #5acumul2 + nImpMes;
  #5nNum1   = #5nNum1   + nImpAnu;
  #5#14     = #5#14     + nImpPr1;
  #5#16     = #5#16     + nImpPr2;

  |GRABA 020#5a;
  |LIBERA #5;

  |SI aMonedaC ! aMonedaA; |Y dos = 2;
      EURODB = nRedo1;
  |FINSI;
|FPRC;

|PROCESO sumasal;    || Calculamos cada cuenta
  |SI #1#5 = "D"; |Y #1#4 = 1;
      debe1 = debe1 + nImpMes;
      debA1 = debA1 + nImpAnu;
      debP1 = debP1 + nImpPr1;
      debP11 = debP11 + nImpPr2;
      sw_d1 = 1;
  |FINSI;

  |SI #1#5 = "D"; |Y #1#4 = 2;
      debe2 = debe2 + nImpMes;
      debA2 = debA2 + nImpAnu;
      debP2 = debP2 + nImpPr1;
      debP21 = debP21 + nImpPr2;
      sw_d2 = 1;
  |FINSI;

  |SI #1#5 = "D"; |Y #1#4 = 3;
      debe3 = debe3 + nImpMes;
      debA3 = debA3 + nImpAnu;
      debP3 = debP3 + nImpPr1;
      debP31 = debP31 + nImpPr2;
      sw_d3 = 1;
  |FINSI;

  |SI #1#5 = "D"; |Y #1#4 = 4;
      debe4 = debe4 + nImpMes;
      debA4 = debA4 + nImpAnu;
      debP4 = debP4 + nImpPr1;
      debP41 = debP41 + nImpPr2;
      sw_d4 = 1;
  |FINSI;

  |SI #1#5 = "H"; |Y #1#4 = 1;
      haber1 = haber1 + nImpMes;
      habeA1 = habeA1 + nImpAnu;
      habeP1 = habeP1 + nImpPr1;
      habeP11 = habeP11 + nImpPr2;
      sw_h1 = 1;
  |FINSI;

  |SI #1#5 = "H"; |Y #1#4 = 2;
      haber2 = haber2 + nImpMes;
      habeA2 = habeA2 + nImpAnu;
      habeP2 = habeP2 + nImpPr1;
      habeP21 = habeP21 + nImpPr2;
      sw_h2 = 1;
  |FINSI;

  |SI #1#5 = "H"; |Y #1#4 = 3;
      haber3 = haber3 + nImpMes;
      habeA3 = habeA3 + nImpAnu;
      habeP3 = habeP3 + nImpPr1;
      habeP31 = habeP31 + nImpPr2;
      sw_h3 = 1;
 |FINSI;
|FPRC;

|PROCESO leexplot;  || Lee el fichero de explotacion
 |ABRE #2;
  #2#0 = #1#4;
  #2#1 = #1#5;
  #2#2 = #1#6;
  #2#4 = #1#7;
  #2#6 = #1#8;
  |LEE 040#2=;
  |SI FSalida ! 0;
      |DDEFECTO #2;
  |FINSI;
  |CIERRA #2;
|FPRC;

|PROCESO acortacuen;
  |SI nivel < #1#1;
      |SI nivel = 1;  nNum3 = 100 + dig4;  |FINSI;
      |SI nivel = 2;  nNum3 = 100 + dig5;  |FINSI;
      |SI nivel = 3;  nNum3 = 100 + dig6;  |FINSI;
      |SI nivel = 4;  nNum3 = 100 + dig7;  |FINSI;
      |SI nivel = 5;  nNum3 = 100 + dig8;  |FINSI;
      alfa1 = nNum3;
      #1#0 = #1#0 % alfa1;
      #1#1 = #0#16;
      #1#0 = #1#0 + "              ";
      #1#0 = #1#0 % 112;
  |FINSI;
|FPRC;

|PROCESO ElCMoneda;
     |SI aMonedaC = "P";                  || pesetas
         mulMoneda = 1 / 166.386;
         nRedon = 2;
     |FINSI;
     |SI aMonedaC = "E";                  || euros
         mulMoneda = 166.386;
         nRedon = 0;
     |FINSI;
     impMoneda = (impMoneda * mulMoneda) ! nRedon;
|FPRC;
