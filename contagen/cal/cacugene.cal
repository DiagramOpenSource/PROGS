|FICHEROS;
     cacugene;
     exclipro;

     caforpag;
     cafantas;
     cacuenta;
     cactrlal;
     caivaasi;
     camaasil;
     canempre;

     &provinc@;
     &poblaci@;
     &regisnif@;
     &clientes@;
     &sgpaises@;

     Referenc@;
     dscam104@;

     agifa024@;
     dsm00003@;
     agifa112@;
     agifa065@;
|FIN;

|VARIABLES;
     antes    = 0;
     salida   = 0;
     cuenta   = 0;
     digito   = 0;
     pos1     = "";
     pos2     = "";
     cta      = "";
     long1    = "";
     long     = 0;
     pepe     = 0;
     sw       = 0;
     num      = 0;
     men6     = "    SConfirma el Alta en Fichero General (S/N): ";
     men2     = "     Longitud de Cuenta Fuera de Nivel !";

     nEmpCart = 0;
     modo     = 0;

     letra = "";
     alfa1 = "";
     alfa2 = "";
     final = "";
     x = "";
     pos3 = "";
     pos4 = "";
     nume1 = 0;
     nume2 = 0;
     cont = 0;
     lugar = 0;
     nifnum = 0;
     resto = 0;

     nSwErr = 0;
     aCliPro = "";

     aAlfa   = "";
     aAlfa4  = "";
     aAlfa5  = "";
     nNume1  = 0;
     aPath   = "";
     aCuenta = "";
     esalta  = 0;
     directo = "";
     direct1 = "";
     traba   = "";
     longi   = "";
     swraf   = 0;
     swaltas = 0;

     aAlfa1 = "";
     nInkey = 0;

     aDirec     = "";
     nSw        = 0;

     aCampo1    = "";
     aCampo2    = "";
     aCampo9    = "";
     nCampo3    = 0;

     nModo      = 0;
     nCalc      = 0;
     nHayIntegrada = 0;
     nAltaSbctr = 0;
     nOk        = 0;
     nCmp       = 0;

     nConsulta = 0;

     nBoton3 = -1;
     nEsPCEG = 0;
     nHandle = 0;
     nYaCrea = 0;
     aCod    = "";
     nSwC       = 0;

     aMas                 = "";
     aFic                 = "";

     &entrada = 0;
     &eaVarDni  = "";
     &enCalcCif = 0;
     &eaDi0_n   = "";
     &eaDi1_n   = "";
     &eaDi2_n   = "";
     &eaNom_n   = "";
     &enCP1_n   = 0;
     &enCP2_n   = 0;
     &eaPob_n   = "";
     &eaPro_n   = "";
     &eaTel_n   = "";
     &eaFax_n   = "";
     &eaNomPais = "";

     &raf_oper = 0;
     &raf_clpr = "";
     &raf_cue  = "";
     &raf_dig  = 0;
     &raf_des  = "";
     &raf_sw   = 0;
     &raf_pase = "";
     &raf_blo  = 0;
     &raf_tipo = "";
     &raf_agru = 0;
     &raf_epi  = 0;
     &raf_par  = 0;
     &raf_empresa = 0;
     &raf_periodo = 0;
     &raf_ejercic = 0;
     &raf_desde = 0;

     &enNoModDatosOTP = 0;
     &eaCta     = "";
     &eaPais    = "";
     &eaIBAN    = "";
     &eaIBANant = "";
|FIN;

|INCLUYE dscont_i;

|PROCESO Tipo7C1Fgene;  |TIPO 7;
     |C_M #cacugene#0,  1, "S";
     |C_M #cacugene#1,  1, "S";
     |C_M #cacugene#2,  1, "S";
     |C_M #cacugene#3,  1, "S";
     |C_M #cacugene#4,  1, "S";
     |C_M #cacugene#7,  1, "S";
     |C_M #cacugene#8,  1, "S";
     |C_M #cacugene#9,  1, "S";
     |C_M #cacugene#33, 1, "S";
     |C_M #cacugene#51, 1, "S";
     |C_M #cacugene#52, 1, "S";

     |SI #caivaasi#191 = "S";
         nModo = (FEntrada / 100) ! 0;
         |SI nModo ! 1;
            |C_M #cacugene#1, 1, "N";
            |C_M #cacugene#9, 1, "N";
        |FINSI;
     |FINSI;

     |SI enNoModDatosOTP = 0;  |ACABA;  |FINSI;

     |C_M #cacugene#0,  1, "N";
     |C_M #cacugene#1,  1, "N";
     |C_M #cacugene#2,  1, "N";
     |C_M #cacugene#3,  1, "N";
     |C_M #cacugene#4,  1, "N";
     |C_M #cacugene#7,  1, "N";
     |C_M #cacugene#8,  1, "N";
     |C_M #cacugene#9,  1, "N";
     |C_M #cacugene#33, 1, "N";
     |C_M #cacugene#51, 1, "N";
     |C_M #cacugene#52, 1, "N";
|FPRC;


|PROCESO ClLocalidad; |TIPO 0;
     nume1 = Campo - 1;
     enCodPobl = #cacugene#Campo#;
     enCodProv = #cacugene#nume1#;
     |HAZ LeeLocalidad;
     |SI nume1 = 3;
         #cacugene#5 = eaProvincia; |PINTA #cacugene#5;
         #cacugene#6 = eaPoblacion; |PINTA #cacugene#6;
     |SINO;
         |SI nume1 = 15;
             #cacugene#19 = eaPoblacion; |PINTA #cacugene#19;
         |SINO;
             #cacugene#47 = eaProvincia; |PINTA #cacugene#47;
             #cacugene#48 = eaPoblacion; |PINTA #cacugene#48;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 6;
     entrada = 2;
     digito = Campo + 1;

     eaCuenta = #cacugene#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #cacugene#Campo# = eaCuenta;
     |PINTA #cacugene#Campo#;

     |HAZ SacaNivel;
     #cacugene#digito# = enNivel;
     |SI eswCta = 1;
         |SI Campo = 21;
             #cacugene#digito# = 1;
             |ACABA;
         |SINO;
             |MENAV men2;
             |ERROR;
             |ACABA;
          |FINSI;
     |FINSI;

     |SI Campo ! 10;  |ACABA;  |FINSI;
     alfa1 = #cacugene#Campo# % 102;
     |SI alfa1 = "43";  |O alfa1 = "44";
        |SI #cacugene#23 = "P";
           |MENAV "     ATENCION Esta Cuenta DEBERIA ser de Clientes";
        |FINSI;
     |FINSI;
     |SI alfa1 = "40";  |O alfa1 = "41";  |O alfa1 = "52";
        |SI #cacugene#23 = "C";
           |MENAV "     ATENCION Esta Cuenta DEBERIA ser de Proveedores";
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO nocero; |TIPO 6;
     |SI #cacugene#20 ! 0;  |ACABA;  |FINSI;

     |ABRE #caforpag;
     #caforpag#0 = #cacugene#20;
     |LEE 001#caforpag.=;              || graba el codigo cero para que no
     |SI FSalida ! 0;          ||/salga la pantalla
         |DDEFECTO #caforpag;
         #caforpag#0 = #cacugene#20;
         #caforpag#2 = 1;
         |GRABA 020#caforpag.n;
     |FINSI;
     |CIERRA #caforpag;
|FPRC;

|PROCESO AltaCertificados;
     aAlfa = "    N" + &191 + " Alta certificado subcontratista ? ";
     |CONFI aAlfa;
     |SI FSalida = 0;
         aAlfa = "|:basica/tadz0001.tab;" + (("00000" + #48#2) % -105) + "," + #48#8; |QBF aAlfa;
         aAlfa = aAlfa + "," + #48#1; |QBF aAlfa;
         aAlfa1 = #cacugene#9; |QBT aAlfa1;
         aAlfa = aAlfa + "@NUEVO" + aAlfa1 + "," + #cacugene#1; |QBF aAlfa;
         |SUB_EJECUTA aAlfa;
     |FINSI;
|FPRC;

|PROCESO ConsultaCertific;
     aAlfa = "|:basica/tadz0001.tab;" + (("00000" + #48#2) % -105) + "," + #48#8; |QBF aAlfa;
     aAlfa = aAlfa + "," + #48#1; |QBF aAlfa;
     aAlfa = aAlfa + "|" + #cacugene#9; |QBF aAlfa;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO VerCertificados;
     nConsulta = 0;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "basica/def/tadm0001.mas";
     |CARGA_DEF aAlfa, Referenc@;
     |SI FSalida = 0;
         nConsulta = 1;
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "basica/fich/";
         |PATH_DAT #Referenc@#aAlfa#;
         |ABRE #Referenc@;
         #Referenc@#0 = enEmpresa;
         #Referenc@#1 = #cacugene#9;
         |LEE 000#Referenc@.=;
         |SI FSalida = 0;
             nConsulta = 4;
         |FINSI;
         |CIERRA #Referenc@;
         |DESCARGA_DEF #Referenc@;
      |FINSI;

      |SI nConsulta ! 0;
          |SI nConsulta = 1;
              |HAZ AltaCertificados;
          |SINO;
              |HAZ ConsultaCertific;
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO AntesNif; |TIPO 7;
     aAlfa = "    <F2> Calcular letra del NIF o Comprobacion CIF."
     |SI #caivaasi#163 = "S";
         aAlfa = "    F2-Calcular letra NIF o Comprobar CIF. F3-Consulta Certificados Contrat."
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO letra_0;  |TIPO 6;
     nInkey = FSalida;

     |BLIN 4;
     |SI nInkey = 10;
        enCalcCif = 1;
        eaVarDni  = #cacugene#Campo#;
        |HAZ CalculoDNI;
        #cacugene#Campo# = eaVarDni;
        |PINTA #cacugene#Campo#;
        |ERROR;
        |ACABA;
     |FINSI;

     eaVarDni  = #cacugene#Campo#;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "                ") % 115;
     |SI #cacugene#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #cacugene#Campo# = eaVarDni;  |PINTA #cacugene#Campo#;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nInkey = 11; |Y #caivaasi#163 = "S"; |Y nModo ! 1;
         |HAZ VerCertificados;
         |ERROR;
         |ACABA;
     |FINSI;

     eaCodNif = #cacugene#9; |QBF eaCodNif;
                      |QBF eaNifEmp;
     |SI eaCodNif = eaNifEmp;
         |CONFI "    NIntroducido NIF de la Empresa Actual. Continuar";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI Haybasica = 0; |Y HayAcceso = 0; |ACABA; |FINSI;
     eaCodNif = #cacugene#9;
     |HAZ LeeNifs;
     |SI ewNif = 1;
         eaNom_n = #cacugene#1;       || Nombre y Apellidos
         aDirec  = #cacugene#2;
         |HAZ LaDivision;
         enCP1_n = #cacugene#3;       || Codigo Provincia
         enCP2_n = #cacugene#4;       || Codigo Poblacion
         eaPob_n = #cacugene#6;       || Poblacion
         eaPro_n = #cacugene#5;       || Provincia
         eaTel_n = #cacugene#7;       || Telefono
         eaFax_n = #cacugene#8;       || Fax
         |SI #cacugene#24 = "   "; #cacugene#24 = "ES "; |FINSI;
         eaCodPais = #cacugene#24;
         |HAZ LeePais;
         eaNomPais = #sgpaises@#1;     || Nombre Pais
     |FINSI;
|FPRC;

|PROCESO LaDivision;
     eaDi0_n = "";
     eaDi1_n = aDirec;
     eaDi2_n = "";

     nSw    = 0;
     aAlfa1 = aDirec % 103;
     |SI aAlfa1 = "CL ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "AV ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "PA ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "PZ ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "PL ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "CR ";  nSw = 1; |FINSI;
     |SI nSw = 1;
         eaDi0_n = aAlfa1;
         eaDi1_n = aDirec % 440;
     |FINSI;
|FPRC;

|PROCESO defcodi;  |TIPO 7;
     esalta = (FEntrada /100) !0;
     |SI esalta = 1;
         #cacugene#0 = #cacugene#10;
         |PINTA #cacugene#0;
     |FINSI;
|FPRC;

|PROCESO creacod1; |TIPO 0;
     pos1 = #cacugene#3;
     pos2 = "000" + pos1;
     traba = pos2 % -102;
     pos1 = #cacugene#4;
     pos2 = "0000" + pos1;
     pos1 = pos2 % -103;
     #cacugene#25 = traba + pos1;
|FPRC;

|PROCESO creacod2; |TIPO 0;
     pos1 = #cacugene#15;
     pos2 = "000" + pos1;
     traba = pos2 % -102;
     pos1 = #cacugene#16;
     pos2 = "0000" + pos1;
     pos1 = pos2 % -103;
     #cacugene#26 = traba + pos1;
|FPRC;

|PROCESO creacod3; |TIPO 0;
     pos1 = #cacugene#45;
     pos2 = "000" + pos1;
     traba = pos2 % -102;
     pos1 = #cacugene#46;
     pos2 = "0000" + pos1;
     pos1 = pos2 % -103;
     #cacugene#50 = traba + pos1;
|FPRC;

|PROCESO ElPais; |TIPO 0;
     alfa1 = "N"; alfa2 = "S";
     |SI #cacugene#24 ! "ES "; |Y #cacugene#24 ! "   ";
         #cacugene#3 = "99";  |PINTA #cacugene#3;
         #cacugene#4 = "999"; |PINTA #cacugene#4;
         alfa1 = "S"; alfa2 = "N";
     |FINSI;
     |C_M #cacugene#3, 1, alfa2;
     |C_M #cacugene#4, 1, alfa2;
     |C_M #cacugene#53,1, alfa1;
|FPRC;

|PROCESO quetecla;
     |SI FSalida ! 9;  |ACABA;  |FINSI;
     |ENCAMPO #9#cacugene;
|FPRC;

|PROCESO ControlaClientes;
     aMas =  aBase + "dscomer9/def/agifa024.mas";
     |CARGA_DEF aMas, agifa024@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa024@#aFic#;

     |ABRE #agifa024@;

     |SELECT #4#agifa024@;
     #agifa024@#15 = #cacugene#9;
     |LEE 000#agifa024@.=;
     |SI FSalida = 0;
         |MENAV "0000El NIF del cliente ya existe en la gestion comercial.";

         aAlfa = "0000" + "Codigo: " + #agifa024@#0 + " Cuenta contable: " + #agifa024@#16;
         |MENAV aAlfa;
     |FINSI;
     |CIERRA #agifa024@;
     |DESCARGA_DEF #agifa024@;
|FPRC;

|PROCESO ControlaProveedor;
     aMas =  aBase + "dscomer9/def/agifa112.mas";
     |CARGA_DEF aMas, agifa112@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa112@#aFic#;

     |ABRE #agifa112@;
     |SELECT #6#agifa112@;

     #agifa112@#9 = #cacugene#9;
     |LEE 000#agifa112@.=;
     |SI FSalida = 0;
         |MENAV "0000El NIF del proveedor ya existe en la gestion comercial.";

         aAlfa = "0000" + "Codigo: " + #agifa112@#0 + " Cuenta contable: " + #agifa112@#10;
         |MENAV aAlfa;
     |FINSI;
     |CIERRA #agifa112@;
     |DESCARGA_DEF #agifa112@;
|FPRC;

|PROCESO ControlaDSCOMER9;
     |DBASS aBase;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0; |DDEFECTO #caivaasi; |FINSI;
     |CIERRA #caivaasi;

     |SI #caivaasi#191 = "N";
         |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;
         |ACABA;
     |FINSI;

     |SI #cacugene#23 = "C";
         |HAZ ControlaClientes;
     |FINSI;

     |SI #cacugene#23 = "P";
         |HAZ ControlaProveedor;
     |FINSI;
|FPRC;

|PROCESO clienprov;
     traba = #cacugene#9;
     |QBF traba;

     |SI traba = "";
         |SI eaPaNif2 ! "S";
             aAlfa1 = "NIF en Blanco";
             |SI eaPaNif2 = "N";
                 aAlfa1 = "    Error. " + aAlfa1;
                 |MENAV aAlfa1;
             |FINSI;
             |SI eaPaNif2 = "X";
                 aAlfa1 = "    NError. " + aAlfa1 + ". Continuar";
                 |CONFI aAlfa1;
             |FINSI;
             |SI FSalida ! 0; |O eaPaNif2 = "N";
                 |ERROR;
             |FINSI;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI Haybasica = 0; |Y HayAcceso = 0; |ACABA; |FINSI;

     nSwErr = 1;
     aCliPro  = #cacugene#23; aCuenta = #cacugene#10;
     eaCodNif = #cacugene#9;
     |HAZ LeeNifs;
     |ABRE #regisnif@;
     |SI ewNif = 0;
         nSwErr = 0;
         |SALVA_FICHA #cacugene;
         |SELECT #4#cacugene;
         #cacugene#9 = eaCodNif;
         |LEE 000#cacugene.];
         |PARA; |SI FSalida = 0; |Y #cacugene#9 = eaCodNif; |HACIENDO;
            |SI aCliPro = #cacugene#23; |Y aCuenta ! #cacugene#10; |SAL; |FINSI;
            |LEE 000#cacugene.s;
         |SIGUE;
         |SI aCliPro = #cacugene#23; |Y aCuenta ! #cacugene#10; |Y #cacugene#9 = eaCodNif;
             |SI eaPaNif1 ! "X";
                 aAlfa = "    El NIF ya existe en la cuenta " + #cacugene#10;
                 |MENAV aAlfa;
                 |SI eaPaNif1 = "N"; |ERROR; nSwErr = 1; |FINSI;
             |SINO;
                 aAlfa = "    NEl NIF ya existe en la cuenta " + #cacugene#10;
                 aAlfa = aAlfa + ". Continuar";
                 |CONFI aAlfa;
                 |SI FSalida ! 0; |ERROR; nSwErr = 1; |FINSI;
             |FINSI;
         |FINSI;
         |SELECT #1#cacugene; |REPON_FICHA #cacugene;

         |SI nSwErr = 0; |HAZ igualdad; |FINSI;
     |FINSI;
     |CIERRA #regisnif@;

     |HAZ ControlaDSCOMER9;
|FPRC;

|PROCESO igualdad;
     #cacugene#9 = #regisnif@#0;
     #cacugene#1 = #regisnif@#1;

     traba = #regisnif@#9;
     |QBF traba;
     |SI traba = "";
         #cacugene#2 = #regisnif@#2;
     |SINO;
         #cacugene#2 = traba + " " + #regisnif@#2;
     |FINSI;
     traba = #cacugene#2; |QBF traba;
     #cacugene#2 = traba + ", " + #regisnif@#3;
     traba = #cacugene#2; |QBF traba;
     #cacugene#2 = traba + " " + #regisnif@#10;
     traba = #cacugene#2; |QBF traba;
     #cacugene#2 = traba + " " + #regisnif@#11;

     #cacugene#3 = #regisnif@#4;
     #cacugene#4 = #regisnif@#5;
     #cacugene#5 = #regisnif@#7;
     #cacugene#6 = #regisnif@#6;
     #cacugene#7 = #regisnif@#8;
     #cacugene#8 = #regisnif@#17;
     #cacugene#24 = #regisnif@#12;

     |PINTA #cacugene#1; |PINTA #cacugene#2; |PINTA #cacugene#3;
     |PINTA #cacugene#4; |PINTA #cacugene#5; |PINTA #cacugene#6;
     |PINTA #cacugene#7; |PINTA #cacugene#9; |PINTA #cacugene#24;
     |PINTA #cacugene#8;

     |HAZ Envio7;
|FPRC;

|PROCESO Envio7; |TIPO 7;
     esalta = (FEntrada /100) !0;
     |SI esalta = 1; |HAZ IgualEnvio; |FINSI;
|FPRC;

|PROCESO Envio0; |TIPO 0;
     nInkey = FSalida;
     |SI nInkey = 10; |HAZ IgualEnvio; |FINSI;
|FPRC;

|PROCESO IgualEnvio;
     #cacugene#44 = #cacugene#2;  |PINTA #cacugene#44;
     #cacugene#45 = #cacugene#3;  |PINTA #cacugene#45;
     #cacugene#46 = #cacugene#4;  |PINTA #cacugene#46;
     #cacugene#47 = #cacugene#5;  |PINTA #cacugene#47;
     #cacugene#48 = #cacugene#6;  |PINTA #cacugene#48;
     #cacugene#49 = #cacugene#27; |PINTA #cacugene#49;
     #cacugene#50 = #cacugene#25;
|FPRC;

|PROCESO cuapais;
     |PUSHV 1102 1850;
     |D_CUADRO 1102, 1850;
     |ATRI R;
     |PINTA 1203 , " ------------ PAISES COMUNITARIOS -------------";
     |ATRI N;
     |PINTA 1303 , " ES Espa¤a      FR Francia       IT Italia     ";
     |PINTA 1403 , " DE Alemania    EL Grecia        IE Irlanda    ";
     |PINTA 1503 , " BE Belgica     GB Gran Breta¤a  LU Luxemburgo ";
     |PINTA 1603 , " DK Dinamarca   NL Holanda       PT Portugal   ";
     |PINTA 1703 , " FI Finlandia   SE Suecia        AT Austria    ";
     |ATRI I;
     |PINTA 1304 , "ES"; |PINTA 1319 , "FR"; |PINTA 1336 , "IT";
     |PINTA 1404 , "DE"; |PINTA 1419 , "EL"; |PINTA 1436 , "IE";
     |PINTA 1504 , "BE"; |PINTA 1519 , "GB"; |PINTA 1536 , "LU";
     |PINTA 1604 , "DK"; |PINTA 1619 , "NL"; |PINTA 1636 , "PT";
     |PINTA 1704 , "FI"; |PINTA 1719 , "SE"; |PINTA 1736 , "AT";
     |ATRI 0;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO filtro; |TIPO 0;
     |SI FSalida = 9;
        |HAZ cuapais;
        |ERROR;
        |ACABA;
     |FINSI;
     pepe = 0;
     |SI #cacugene#24 = "ES "; |O #cacugene#24 = "DE "; |O #cacugene#24 = "BE "; |O #cacugene#24 = "DK ";
        pepe = 1;
     |FINSI;
     |SI #cacugene#24 = "FR "; |O #cacugene#24 = "EL "; |O #cacugene#24 = "GB "; |O #cacugene#24 = "NL ";
        pepe = 1;
     |FINSI;
     |SI #cacugene#24 = "IT "; |O #cacugene#24 = "IE "; |O #cacugene#24 = "LU "; |O #cacugene#24 = "PT ";
        pepe = 1;
     |FINSI;
     |SI #cacugene#24 = "FI "; |O #cacugene#24 = "SE "; |O #cacugene#24 = "AT ";
        pepe = 1;
     |FINSI;
     |SI pepe = 0;
     || |MENAV "     Pais incorrecto.";
     |FINSI;
|FPRC;

|PROCESO AntesConf; |TIPO 7;
     |SI #cacugene#23 = "P";
         |C_M #cacugene#Campo#,1,"S";
     |SINO;
         |C_M #cacugene#Campo#,1,"N";
     |FINSI;
|FPRC;

|PROCESO ElBanco7; |TIPO 7;
     |SI #cacugene#23 =  "C"; eaVC = "V"; |FINSI;
     |SI #cacugene#23 =  "P"; eaVC = "C"; |FINSI;
     enSwLoLeo = 0;
     |HAZ LeeBanco;
     |SI enElBanco = 1;
         |C_M #cacugene#Campo#,1,"N";
         #cacugene#Campo# = 999; |PINTA #cacugene#Campo#;
     |SINO;
         |C_M #cacugene#Campo#,1,"S";
     |FINSI;
|FPRC;

|PROCESO ElBanco0; |TIPO 0;
     nInkey = FSalida;
     |C_M #cacugene#Campo#,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #cacugene#Campo# = 999;
         #cafantas#8 = "BANCO STANDAR";
         |PINTA 1724, #cafantas#8;
         |ACABA;
     |FINSI;
     eOpBan = 0; || 1 = Consulta pantalla
     |SI nInkey = 10; eOpBan = 1;  |FINSI;

     enSwLoLeo = 1;
     enBanco = #cacugene#Campo#;
     |HAZ LeeBanco;
     |SI eswLect = 0;
         #cacugene#Campo# = enBanco; |PINTA #cacugene#Campo#;
         #cafantas#8    = eaNomBanco;
     |SINO;
         #cafantas#8    = "NO EXISTE CODIGO DE BANCO PROPIO";
     |FINSI;
     |PINTA 1724, #cafantas#8;
|FPRC;

|PROCESO Boton3;
     |ESTADO_CONTROL nBoton3, "DISABLE";
     |SUB_EJECUTA_NP "capcez02.tab";
     |ESTADO_CONTROL nBoton3, "ENABLE";
|FPRC;

|PROCESO BotonPCEG; |TIPO 14;
     |SI nBoton3 = -1;
        |DDEF aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "capcem01.mas";
        |XABRE "E", aAlfa, nHandle;
        |SI FSalida < 0; nEsPCEG = 0; |SINO; nEsPCEG = 1; |FINSI;

        |SI nEsPCEG = 1;
           |CONTROL_SIMPLE 0, "LBOTON,F8 Importacion PCE", 0665, 0679, Boton3;
           nBoton3 = FSalida;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO T13clipro; |TIPO 13;
     |PARA nCmp = 0;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           #exclipro#nCmp# = #cacugene#nCmp#;
     |SIGUE;

     |SI #cacugene#28 = 999;
         #cafantas#8 = "BANCO STANDAR";
         |PINTA 1724, #cafantas#8;
         |ACABA;
     |FINSI;
     enSwLoLeo = 1;
     enBanco = #cacugene#28; eaVC = "V";
     |HAZ LeeBanco;
     |SI eswLect = 0;
         #cacugene#28 = enBanco; |PINTA #cacugene#28;
         #cafantas#8    = eaNomBanco;
     |SINO;
         #cafantas#8    = "NO EXISTE CODIGO DE BANCO PROPIO";
     |FINSI;

     |PINTA 1724, #cafantas#8;
|FPRC;
||----------------------------------------------------

|PROCESO TrasConClPr;  |TIPO 0;     ||Concepto IRPF
     |C_M #cacugene#Campo#,0,alfa1;
     |SI alfa1 = "N"; |ACABA; |FINSI;

     |SI FSalida = 2; |ACABA; |FINSI;

     |SI #cacugene#Campo# ! 0;
         aAlfa1 = aTipoIVA;
         aTipoIVA  = "";
         enFilConc = 3;        || Concepto de IRPF
         enConcepto = #cacugene#Campo#;
         |HAZ FiltroConcepto;
         aTipoIVA = aAlfa1;
     |FINSI;
|FPRC;
||----------------------------------------------------

|PROCESO TrasIVACl; |TIPO 0;
     nInkey = FSalida;

     |SI #cacugene#23 = "C";
         aTipoIVA = "R";
     |SINO;
         aTipoIVA = "S";
     |FINSI;

     |SI nInkey = 10;
        efFechaIVA = ~; enIvaTot = 1; |HAZ SelecTipoIVA; enIvaTot = 0;
        #cacugene#Campo# = enLineaIVA; |PINTA #cacugene#Campo#;
        |ERROR;
     |FINSI;

     |SI #cacugene#Campo# ! 0;
        efFechaIVA = "31.12.2999";
        enLineaIVA = #cacugene#Campo#;
        |HAZ SacaIVA;
        |SI enLineaIVA < 0;
           |MENAV "    Control de Tipo de IVA no definido";
           enLineaIVA = 0;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO NoBlanco; |TIPO 0;
     |SI Campo = 1; aAlfa1 = "Nombre en Blanco"; |FINSI;
     |SI Campo = 2; aAlfa1 = "Direccion en Blanco"; |FINSI;
     |SI Campo = 3; aAlfa1 = "Codigo Provincia"; |FINSI;
     traba = #cacugene#Campo#;
     |SI Campo = 3; |Y #cacugene#Campo# = 0;  traba = ""; |FINSI;

     |QBF traba;
     |SI traba = ""; |Y eaPaNif2 ! "S";
         |SI eaPaNif2 = "N";
             aAlfa1 = "    Error. " + aAlfa1;
             |MENAV aAlfa1;
         |FINSI;
         |SI eaPaNif2 = "X";
             aAlfa1 = "    NError. " + aAlfa1 + ". Continuar";
             |CONFI aAlfa1;
         |FINSI;
         |SI FSalida ! 0; |O eaPaNif2 = "N";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO VerSwC; |TIPO 0;
     aAlfa = Contenido;
     |SI aAlfa ! #cacugene#Campo#;
         nSwC = 1;
     |FINSI;
|FPRC;

|PROCESO Tipo7IBAN_Clp;  |TIPO 7;
     aAlfa = #cacugene#40;   |QBF aAlfa;

     |SI aAlfa ! "";  |Y nSwC = 0; |ACABA;  |FINSI;

     |SI nSwC = 1; |Y aAlfa ! "";
         |CONFI "0000NSe han modificado los datos de la Cuenta Corriente. Recalcular el IBAN?";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     eaIBANant = "";
     eaCta     = #cacugene#29 + #cacugene#30 + #cacugene#31 + #cacugene#32;
     eaPais    = #cacugene#24;
     |HAZ CalcuIBAN;

     #cacugene#40 = eaIBAN;
     |PINTA #cacugene#40;
     nSwC = 0;
|FPRC;

|PROCESO Tipo0IBAN_Clp;  |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     eaCta     = #cacugene#29 + #cacugene#30 + #cacugene#31 + #cacugene#32;
     eaPais    = #cacugene#24;
     eaIBANant = #cacugene#40;
     |HAZ CheqIBAN;

     aAlfa = eaIBANant; |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |SI aAlfa = "";
             #cacugene#40 = eaIBAN;
             |PINTA #cacugene#40;
         |SINO;
             |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
             |SI FSalida = 0;
                 #cacugene#40 = eaIBAN;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaDsm00003;
     |ABRE #dsm00003@;
     #dsm00003@#0  = #agifa024@#0;
     #dsm00003@#1  = 1;
     |LEE 101#dsm00003@.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm00003@;
         #dsm00003@#0  = #agifa024@#0;
         #dsm00003@#1  = 1;
         |GRABA 020#dsm00003@.b;
     |FINSI;

     #dsm00003@#2  = #agifa024@#5;
     #dsm00003@#3  = #agifa024@#6;
     #dsm00003@#4  = #agifa024@#178;
     #dsm00003@#5  = #agifa024@#179;
     #dsm00003@#6  = #agifa024@#180;
     #dsm00003@#7  = #agifa024@#7;
     #dsm00003@#8  = #agifa024@#14;
     #dsm00003@#10 = #agifa024@#2;
     #dsm00003@#11 = #agifa024@#3;
     #dsm00003@#13 = #agifa024@#17;
     #dsm00003@#14 = #agifa024@#25;
     #dsm00003@#16 = #agifa024@#189;
     #dsm00003@#19 = #agifa024@#205;
     #dsm00003@#20 = #agifa024@#196;
     #dsm00003@#21 = #agifa024@#18;
     #dsm00003@#22 = #agifa024@#36;
     #dsm00003@#23 = #agifa024@#211;
     #dsm00003@#24 = #agifa024@#197;

     |GRABA 020#dsm00003@.a;
     |CIERRA #dsm00003@;
|FPRC;

|PROCESO CarVars24;
     |SI nCmp =  7;  #agifa024@#17  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  8;  #agifa024@#18  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  9;  #agifa024@#15  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 10;  #agifa024@#16  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 13;  #agifa024@#29  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 14;  #agifa024@#34  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 17;  #agifa024@#30  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 19;  #agifa024@#162 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 20;  #agifa024@#20  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 20;  #agifa024@#20  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 25;  #agifa024@#183 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 24;  #agifa024@#205 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 28;  #agifa024@#203 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 29;  #agifa024@#32  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 30;  #agifa024@#33  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 31;  #agifa024@#31  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 32;  #agifa024@#30  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 33;  #agifa024@#3   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 34;  #agifa024@#22  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 35;  #agifa024@#23  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 36;  #agifa024@#24  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 40;  #agifa024@#215 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 41;  #agifa024@#216 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 44;  #agifa024@#11  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 45;  #agifa024@#184 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 46;  #agifa024@#185 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 47;  #agifa024@#13  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 48;  #agifa024@#12  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 49;  #agifa024@#27  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 50;  #agifa024@#186 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp = 51;  #agifa024@#197 = #cacugene#nCmp#;  |FINSI;

     |SI nCmp = 2;
         |SI #agifa024@#8   = #agifa024@#5;
             #agifa024@#5   = #cacugene#nCmp#;
         |FINSI;

         |SI #agifa024@#8   = #agifa024@#11;
             #agifa024@#11  = #cacugene#nCmp#;
         |FINSI;

         #agifa024@#8   = #cacugene#nCmp#;
     |FINSI;

     |SI nCmp = 3;
         |SI #agifa024@#181 = #agifa024@#178;
             #agifa024@#178 = #cacugene#nCmp#;
         |FINSI;

         |SI #agifa024@#181 = #agifa024@#184;
             #agifa024@#184 = #cacugene#nCmp#;
         |FINSI;

         #agifa024@#181 = #cacugene#nCmp#;
     |FINSI;

     |SI nCmp = 4;
         |SI #agifa024@#182 = #agifa024@#179;
             #agifa024@#179 = #cacugene#nCmp#;
         |FINSI;

         |SI #agifa024@#182 = #agifa024@#185;
             #agifa024@#185 = #cacugene#nCmp#;
         |FINSI;

         #agifa024@#182 = #cacugene#nCmp#;
     |FINSI;

     |SI nCmp = 5;
         |SI #agifa024@#10  = #agifa024@#7;
             #agifa024@#7   = #cacugene#nCmp#;
         |FINSI;

         |SI #agifa024@#10  = #agifa024@#13;
             #agifa024@#13  = #cacugene#nCmp#;
         |FINSI;

         #agifa024@#10  = #cacugene#nCmp#;
     |FINSI;

     |SI nCmp = 6;
         |SI #agifa024@#9   = #agifa024@#6;
             #agifa024@#6   = #cacugene#nCmp#;
         |FINSI;

         |SI #agifa024@#9   = #agifa024@#12;
             #agifa024@#12  = #cacugene#nCmp#;
         |FINSI;

         #agifa024@#9   = #cacugene#nCmp#;
     |FINSI;

     aAlfa = (("00" + #agifa024@#178) % -102);
     aAlfa = aAlfa + (("000" + #agifa024@#179) % -103);
     #agifa024@#180 = aAlfa;

     aAlfa = (("00" + #agifa024@#181) % -102);
     aAlfa = aAlfa + (("000" + #agifa024@#182) % -103);
     #agifa024@#183 = aAlfa;

     aAlfa = (("00" + #agifa024@#184) % -102);
     aAlfa = aAlfa + (("000" + #agifa024@#185) % -103);
     #agifa024@#186 = aAlfa;
|FPRC;

|PROCESO GrabaAgifa024;
     aMas =  aBase + "dscomer9/def/agifa024.mas";
     |CARGA_DEF aMas, agifa024@;

     aMas =  aBase + "dscomer9/def/dsm00003.mas";
     |CARGA_DEF aMas, dsm00003@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa024@#aFic#;
     |PATH_DAT #dsm00003@#aFic#;

     |ABRE #agifa024@;
     |SELECT #1#agifa024@;

     aCod = #cacugene#10 % -106;
     #agifa024@#0 = aCod;
     |LEE 101#agifa024@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agifa024@;
         #agifa024@#0   = aCod;
         #agifa024@#1   = #cacugene#1;
         #agifa024@#2   = #cacugene#1;

         #agifa024@#17  = #cacugene#7;
         #agifa024@#18  = #cacugene#8;
         #agifa024@#15  = #cacugene#9;
         #agifa024@#16  = #cacugene#10;
         #agifa024@#29  = #cacugene#13;
         #agifa024@#34  = #cacugene#14;
         #agifa024@#30  = #cacugene#17;
         #agifa024@#162 = #cacugene#19;
         #agifa024@#20  = #cacugene#20;
         #agifa024@#183 = #cacugene#25;
         #agifa024@#205 = #cacugene#24;
         #agifa024@#203 = #cacugene#28;
         #agifa024@#32  = #cacugene#29;
         #agifa024@#33  = #cacugene#30;
         #agifa024@#31  = #cacugene#31;
         #agifa024@#30  = #cacugene#32;
         #agifa024@#3   = #cacugene#33;
         #agifa024@#22  = #cacugene#34;
         #agifa024@#23  = #cacugene#35;
         #agifa024@#24  = #cacugene#36;
         #agifa024@#215 = #cacugene#40;
         #agifa024@#216 = #cacugene#41;
         #agifa024@#11  = #cacugene#44;
         #agifa024@#184 = #cacugene#45;
         #agifa024@#185 = #cacugene#46;
         #agifa024@#13  = #cacugene#47;
         #agifa024@#12  = #cacugene#48;
         #agifa024@#27  = #cacugene#49;
         #agifa024@#186 = #cacugene#50;
         #agifa024@#197 = #cacugene#51;

         #agifa024@#8   = #cacugene#2;
         #agifa024@#181 = #cacugene#3;
         #agifa024@#182 = #cacugene#4;
         #agifa024@#10  = #cacugene#5;
         #agifa024@#9   = #cacugene#6;

         aAlfa = #agifa024@#5;  |QBF aAlfa;
         |SI aAlfa = "";
             #agifa024@#5   = #agifa024@#8;
             #agifa024@#178 = #agifa024@#181;
             #agifa024@#179 = #agifa024@#182;
             #agifa024@#7   = #agifa024@#10;
             #agifa024@#6   = #agifa024@#9;
         |FINSI;

         aAlfa = #agifa024@#11;  |QBF aAlfa;
         |SI aAlfa = "";
             #agifa024@#11  = #agifa024@#8;
             #agifa024@#184 = #agifa024@#181;
             #agifa024@#185 = #agifa024@#182;
             #agifa024@#13  = #agifa024@#10;
             #agifa024@#12  = #agifa024@#9;
         |FINSI;

         aAlfa = (("00" + #agifa024@#178) % -102);
         aAlfa = aAlfa + (("000" + #agifa024@#179) % -103);
         #agifa024@#180 = aAlfa;

         aAlfa = (("00" + #agifa024@#181) % -102);
         aAlfa = aAlfa + (("000" + #agifa024@#182) % -103);
         #agifa024@#183 = aAlfa;

         aAlfa = (("00" + #agifa024@#184) % -102);
         aAlfa = aAlfa + (("000" + #agifa024@#185) % -103);
         #agifa024@#186 = aAlfa;

         |GRABA 020#agifa024@.n;
         |LIBERA #agifa024@;

         |HAZ CargaDsm00003;

         |ACABA;
     |FINSI;

     nOk = 0;
     |PARA nCmp = 0;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           |SI #cacugene#nCmp# ! #exclipro#nCmp#;
               nOk = 1;
               |HAZ CarVars24;
           |FINSI;
     |SIGUE;

     |SI nOk = 1;
         |GRABA 020#agifa024@.a;
         |LIBERA #agifa024@;

         |HAZ CargaDsm00003;
     |FINSI;

     |CIERRA #dsm00003@;  |DESCARGA_DEF #dsm00003@;
     |CIERRA #agifa024@;  |DESCARGA_DEF #agifa024@;
|FPRC;

|PROCESO CarVars112;
     |SI nCmp =  10;  #agifa112@#10  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   1;  #agifa112@#1   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   1;  #agifa112@#2   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   2;  #agifa112@#3   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   3;  #agifa112@#74  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   4;  #agifa112@#75  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  25;  #agifa112@#76  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  24;  #agifa112@#89  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   5;  #agifa112@#5   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   6;  #agifa112@#4   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   7;  #agifa112@#6   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   8;  #agifa112@#7   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =   9;  #agifa112@#9   = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  13;  #agifa112@#11  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  14;  #agifa112@#16  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  17;  #agifa112@#12  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  19;  #agifa112@#57  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  20;  #agifa112@#17  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  28;  #agifa112@#98  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  29;  #agifa112@#14  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  30;  #agifa112@#15  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  31;  #agifa112@#13  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  32;  #agifa112@#12  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  33;  #agifa112@#92  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  34;  #agifa112@#19  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  35;  #agifa112@#20  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  36;  #agifa112@#21  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  37;  #agifa112@#99  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  38;  #agifa112@#94  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  39;  #agifa112@#95  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  40;  #agifa112@#96  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  41;  #agifa112@#97  = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  44;  #agifa112@#101 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  45;  #agifa112@#102 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  46;  #agifa112@#103 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  47;  #agifa112@#104 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  48;  #agifa112@#105 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  49;  #agifa112@#106 = #cacugene#nCmp#;  |FINSI;
     |SI nCmp =  50;  #agifa112@#107 = #cacugene#nCmp#;  |FINSI;
|FPRC;

|PROCESO GrabaAgifa112;
     aMas =  aBase + "dscomer9/def/agifa112.mas";
     |CARGA_DEF aMas, agifa112@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa112@#aFic#;

     |ABRE #agifa112@;
     |SELECT #1#agifa112@;

     aCod = #cacugene#10 % -106;
     #agifa112@#0 = aCod;
     |LEE 101#agifa112@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agifa112@;
         #agifa112@#0   = aCod;
         #agifa112@#10  = #cacugene#10;
         #agifa112@#1   = #cacugene#1;
         #agifa112@#2   = #cacugene#1;
         #agifa112@#3   = #cacugene#2;
         #agifa112@#74  = #cacugene#3;
         #agifa112@#75  = #cacugene#4;
         #agifa112@#76  = #cacugene#25;
         #agifa112@#89  = #cacugene#24;
         #agifa112@#5   = #cacugene#5;
         #agifa112@#4   = #cacugene#6;
         #agifa112@#6   = #cacugene#7;
         #agifa112@#7   = #cacugene#8;
         #agifa112@#9   = #cacugene#9;
         #agifa112@#11  = #cacugene#13;
         #agifa112@#16  = #cacugene#14;
         #agifa112@#12  = #cacugene#17;
         #agifa112@#57  = #cacugene#19;
         #agifa112@#17  = #cacugene#20;
         #agifa112@#98  = #cacugene#28;
         #agifa112@#14  = #cacugene#29;
         #agifa112@#15  = #cacugene#30;
         #agifa112@#13  = #cacugene#31;
         #agifa112@#12  = #cacugene#32;
         #agifa112@#92  = #cacugene#33;
         #agifa112@#19  = #cacugene#34;
         #agifa112@#20  = #cacugene#35;
         #agifa112@#21  = #cacugene#36;
         #agifa112@#99  = #cacugene#37;
         #agifa112@#94  = #cacugene#38;
         #agifa112@#95  = #cacugene#39;
         #agifa112@#96  = #cacugene#40;
         #agifa112@#97  = #cacugene#41;
         #agifa112@#101 = #cacugene#44;
         #agifa112@#102 = #cacugene#45;
         #agifa112@#103 = #cacugene#46;
         #agifa112@#104 = #cacugene#47;
         #agifa112@#105 = #cacugene#48;
         #agifa112@#106 = #cacugene#49;
         #agifa112@#107 = #cacugene#50;

         |GRABA 020#agifa112@.n;
         |LIBERA #agifa112@;

         |ACABA;
     |FINSI;

     nOk = 0;
     |PARA nCmp = 0;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           |SI #cacugene#nCmp# ! #exclipro#nCmp#;
               nOk = 1;
               |HAZ CarVars112;
           |FINSI;
     |SIGUE;

     |SI nOk = 1;
         |GRABA 020#agifa112@.a;
         |LIBERA #agifa112@;
     |FINSI;

     |CIERRA #agifa112@;
     |DESCARGA_DEF #agifa112@;
|FPRC;

|PROCESO CtrlDSCOMER9;
     |SI #caivaasi#191 = "N";
         |ACABA;
     |FINSI;

     |DBASS aBase;

     |SI #cacugene#23 = "C";  |HAZ GrabaAgifa024;   |FINSI;
     |SI #cacugene#23 = "P";  |HAZ GrabaAgifa112;  |FINSI;
|FPRC;

|PROCESO T12clipro; |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     |CONFI "0000SEs correcto";
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     eaCta     = #cacugene#29 + #cacugene#30 + #cacugene#31 + #cacugene#32;
     eaPais    = #cacugene#24;
     eaIBANant = #cacugene#40;
     |HAZ CheqIBAN;

     aAlfa = #cacugene#40;  |QBF aAlfa;
     |SI aAlfa ! eaIBAN; |Y aAlfa ! "";
         |MENAV "0000El codigo IBAN puede ser erroneo.";
     |SINO;
         |SI aAlfa = "";
           ||  |MENAV "0000No esa informado el codigo IBAN";
         |FINSI;
     |FINSI;

     nSwC = 0;

     |HAZ eLeeParametro;
     |SI eaPaNif2 ! "S";
         aCampo1 = #cacugene#1; |QBF aCampo1;
         aCampo9 = #cacugene#9; |QBF aCampo9;
         aCampo2 = #cacugene#2; |QBF aCampo2;
         nCampo3 = #cacugene#3;

         aAlfa1 = ""; nNume1 = 0;
         |SI aCampo1 = ""; aAlfa1 = "Nombre en Blanco";    nNume1 = nNume1 + 1; |FINSI;
         |SI aCampo2 = ""; aAlfa1 = "Direccion en Blanco"; nNume1 = nNume1 + 1; |FINSI;
         |SI aCampo9 = ""; aAlfa1 = "NIF en Blanco";       nNume1 = nNume1 + 1; |FINSI;
         |SI nCampo3 = 0;  aAlfa1 = "Codigo Provincia";    nNume1 = nNume1 + 1; |FINSI;

         |SI nNume1 > 1;
             aAlfa4 = "";
             |SI aCampo1 = "";  aAlfa4 = "Nombre";  |FINSI;
             |SI aCampo2 = "";
                 aAlfa5 = " y ";
                 |SI aCampo9 = ""; |O nCampo3 = 0; aAlfa5 = ", "; |FINSI;
                 |SI aAlfa4  = "";                 aAlfa5 = "";   |FINSI;
                 aAlfa4 = aAlfa4 + aAlfa5 + "Direccion";
             |FINSI;

             |SI aCampo9 = "";
                 aAlfa5 = " y ";
                 |SI nCampo3 = 0;  aAlfa5 = ", "; |FINSI;
                 |SI aAlfa4 = "";  aAlfa5 = "";   |FINSI;
                 aAlfa4 = aAlfa4 + aAlfa5 + "DNI";
             |FINSI;

             |SI nCampo3 = 0;
                 aAlfa5 = " y ";
                 |SI aAlfa4 = "";  aAlfa5 = "";   |FINSI;
                 aAlfa4 = aAlfa4 + aAlfa5 + "Cod.Provincia";
             |FINSI;

             aAlfa1 = aAlfa4 + " en Blanco";
         |FINSI;

         |SI aAlfa1 ! "";
             |SI eaPaNif2 = "N";
                 aAlfa1 = "    Error. " + aAlfa1;
                 |MENAV aAlfa1;
             |FINSI;

             |SI eaPaNif2 = "X";
                 aAlfa1 = "    NError. " + aAlfa1 + ". Continuar";
                 |CONFI aAlfa1;
             |FINSI;

             |SI FSalida ! 0; |O eaPaNif2 = "N";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
         |ACABA;
     |FINSI;

     |SI nModo = 1;
         |SI #caivaasi#163 = "S";
             |HAZ AltaCertificados;
         |FINSI;
     |FINSI;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0; |DDEFECTO #caivaasi; |FINSI;
     |CIERRA #caivaasi;

     |HAZ CtrlDSCOMER9;
|FPRC;

|PROCESO AltaOtras; |TIPO 30;
     |ABRE #cacuenta;
     |DDEFECTO #cacuenta;
     #cacuenta#0 = #cacugene#10;
     #cacuenta#1 = #cacugene#11;
     |LEE 141#cacuenta.=;
     |SI FSalida = 0;
         #cacuenta#2 = #cacugene#1;
         |GRABA 040#cacuenta.a;
     |FINSI;
     |LIBERA #cacuenta;
     |CIERRA #cacuenta;

     esalta = (FEntrada /100) !0;

     swaltas = 0;
     raf_empresa = enEmpresa;
     raf_periodo = enPeriodo;
     raf_ejercic = enAny;

     |ABRE #cactrlal;
     |DDEFECTO #cactrlal;
     |LEE 101#cactrlal.p;
     |SI FSalida ! 0; swaltas = 1; |FINSI;
     |LIBERA #cactrlal;
     |CIERRA #cactrlal;
     |SI swaltas = 1; |ACABA; |FINSI;

     |SI #cactrlal#62 ! "S"; |Y esalta = 2; |ACABA; |FINSI;

     swraf = 1;
     alfa1 = #cactrlal#1; |QBF alfa1;
     alfa2 = #cactrlal#2; |QBF alfa2;
     |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
     alfa1 = #cactrlal#3; |QBF alfa1;
     alfa2 = #cactrlal#4; |QBF alfa2;
     |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
     alfa1 = #cactrlal#5; |QBF alfa1;
     alfa2 = #cactrlal#6; |QBF alfa2;
     |SI alfa1 ! ""; |O alfa2 ! ""; swraf = 0; |FINSI;
     |SI swraf = 1; |ACABA; |FINSI;

     swraf = 1;
     |SI #cacugene#10 ] #cactrlal#1; |Y #cacugene#10 [ #cactrlal#2; swraf = 0; |FINSI;
     |SI #cacugene#10 ] #cactrlal#3; |Y #cacugene#10 [ #cactrlal#4; swraf = 0; |FINSI;
     |SI #cacugene#10 ] #cactrlal#5; |Y #cacugene#10 [ #cactrlal#6; swraf = 0; |FINSI;

     |SI swraf = 1; |ACABA; |FINSI;

     raf_oper = esalta;
     raf_clpr = #cacugene#23;
     raf_cue  = #cacugene#10;
     raf_dig  = #cacugene#11;
     raf_des  = #cacugene#1;

     |ABRE #cacuenta;
     |DDEFECTO #cacuenta;
     #cacuenta#0 = #cacugene#10;
     #cacuenta#1 = #cacugene#11;
     |LEE 001#cacuenta.=;
     |CIERRA #cacuenta;
     raf_pase = #cacuenta#3;
     raf_blo  = #cacuenta#4;
     raf_tipo = #cacuenta#5;
     raf_agru = #cacuenta#6;
     raf_epi  = #cacuenta#7;
     raf_par  = #cacuenta#8;

     |CIERRAT #cacugene;
     raf_desde = 1;
     |SUB_EJECUTA_NP "caltacta.tab";
     raf_desde = 0;
     |ABRET #cacugene;
|FPRC;

|PROCESO BloqProvCartera; |TIPO 2;
     |SI #cacugene#23 ! "P"; |ACABA; |FINSI;

     modo = (FEntrada / 100) ! 0;
     |SI modo = 3;  |Y enNoModDatosOTP = 1;
         |ERROR;
         |ACABA;
     |FINSI;

     nEmpCart = -1;

     |DBASS aAlfa; |QBF aAlfa;
     aAlfa1 = aAlfa + "dscarter/def/dscam043.mas";
     |CARGA_DEF aAlfa1, Referenc@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa1 = aAlfa + "dscarter/fich/"; |PATH_DAT #Referenc@#aAlfa1#;
        |ABRE #Referenc@;
        #Referenc@#0 = #48#2;
        #Referenc@#1 = #48#3;
        #Referenc@#2 = 1;
        |LEE 000#Referenc@.];
        |PARA; |SI FSalida = 0; |Y #Referenc@#0 = #48#2; |Y #Referenc@#1 = #48#3; |HACIENDO;
           |SI #Referenc@#3 = "C"; nEmpCart = #Referenc@#9; |SAL; |FINSI;
           |LEE 000#Referenc@.s;
        |SIGUE;
        |CIERRA #Referenc@; |DESCARGA_DEF #Referenc@;
     |FINSI;

     aAlfa1 = aAlfa + "dscarter/def/dscam051.mas";
     |CARGA_DEF aAlfa1, Referenc@;
     |SI FSalida = 0;
        aAlfa1 = aAlfa + "dscarter/def/dscam104.mas";
        |CARGA_DEF aAlfa1, dscam104@;
        |SI FSalida = 0;
           aAlfa1 = aAlfa + "dscarter/fich/" + (("00000" + nEmpCart) % -105) + "/";
           |PATH_DAT #Referenc@#aAlfa1#; |PATH_DAT #dscam104@#aAlfa1#;
           |ABRE #Referenc@; |ABRE #dscam104@;

           |LEE 000#Referenc@.p;
           |SI FSalida ! 0; |DDEFECTO #Referenc@; |FINSI;

           |SI #Referenc@#96 = "S";
              |SI modo = 1;
                 |SELECT #4#dscam104@;
                 #dscam104@#1 = #cacugene#10;
                 |LEE 000#dscam104@.=;
                 |SI FSalida ! 0;
                    |DDEFECTO #dscam104@;
                    #dscam104@#0 = "";
                    #dscam104@#1 = #cacugene#10;
                    #dscam104@#2 = #cacugene#1;
                    #dscam104@#3 = "N";
                    #dscam104@#4 = "01.01.0000";
                    |GRABA 020#dscam104@.n;
                 |FINSI;
                 |SELECT #1#dscam104@;
              |FINSI;
              |SI modo = 3;
                 |SELECT #4#dscam104@;
                 #dscam104@#1 = #cacugene#10;
                 |LEE 101#dscam104@.=;
                 |SI FSalida = 0;
                    |SI #dscam104@#3 = "S";
                       aAlfa = "    NEste proveedor esta bloqueado en cartera. " + &191 + " Continuar con la baja ?";
                       |CONFI aAlfa;
                       |SI FSalida = 0;
                          |BORRA 020#dscam104@.a; |LIBERA #dscam104@;
                       |SINO;
                          |ERROR;
                       |FINSI;
                    |SINO;
                       |BORRA 020#dscam104@.a; |LIBERA #dscam104@;
                    |FINSI;
                 |FINSI;
                 |SELECT #1#dscam104@;
              |FINSI;
           |FINSI;
           |CIERRA #dscam104@; |DESCARGA_DEF #dscam104@;
        |FINSI;
        |CIERRA #Referenc@; |DESCARGA_DEF #Referenc@;
     |FINSI;
|FPRC;

|PROCESO Tipo90; |TIPO 90;
     |SI nBoton3 ! -1; |Y nEsPCEG = 1;
         |FIN_CONTROL_WINDOWS nBoton3;
     |FINSI;
|FPRC;

|PROCESO BajaCliente;
     aMas =  aBase + "dscomer9/def/agifa024.mas";
     |CARGA_DEF aMas, agifa024@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa024@#aFic#;

     |ABRE #agifa024@;
     |SELECT #1#agifa024@;

     #agifa024@#0 = aCod;
     |LEE 101#agifa024@.=;
     |SI FSalida = 0;
         |BORRA 020#agifa024@.a;
         |LIBERA #agifa024@;
     |FINSI;

     |CIERRA #agifa024@;
     |DESCARGA_DEF #agifa024@;
|FPRC;

|PROCESO BajaProveedor;
     aMas =  aBase + "dscomer9/def/agifa112.mas";
     |CARGA_DEF aMas, agifa112@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa112@#aFic#;

     |ABRE #agifa112@;
     |SELECT #1#agifa112@;
     #agifa112@#0 = aCod;
     |LEE 101#agifa112@.=;
     |SI FSalida = 0;
         |BORRA 020#agifa112@.a;
         |LIBERA #agifa112@;
     |FINSI;

     |CIERRA #agifa112@;
     |DESCARGA_DEF #agifa112@;
|FPRC;

|PROCESO T1Baja;  |TIPO 1;
     |SI #caivaasi#191 ! "S";  |ACABA;  |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;  |ACABA;  |FINSI;

     aCod = #cacugene#10 % -106;
     nOk  = 0;

     |ABRE #camaasil;
     |SELECT #3#camaasil;
     #camaasil#4 = #cacuenta#0;
     #camaasil#5 = #cacuenta#1;
     #camaasil#0 = 0;
     #camaasil#1 = "01.01.0000";
     #camaasil#2 = 0;
     |LEE 000#camaasil.];
     |SI FSalida = 0;  |Y #camaasil#4 = #cacuenta#0;
         nOk = 1;
     |FINSI;
     |CIERRA #camaasil;

     |SI nOk = 0;
         |DBASS aBase;
         aMas =  aBase + "dscomer9/def/agifa065.mas";
         |CARGA_DEF aMas, agifa065@;

         aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
         |PATH_DAT #agifa065@#aFic#;

         |ABRE #agifa065@;
         |SELECT #3#agifa065@;
         #agifa065@#10 = aCod;
         #agifa065@#1  = "01.01.0000";
         |LEE 000#agifa065@.];
         |SI FSalida = 0; |Y #agifa065@#10 = aCod;
             nOk = 1;
         |FINSI;
         |CIERRA #agifa065@;
     |FINSI;

     |SI nOk = 1;
         |MENAV "0000Existen movimientos de esta ficha. Se cancela la  baja.";
         |ERROR;
         |ACABA;
     |FINSI;

     |ABRE #cacuenta;
     |DDEFECTO #cacuenta;
     #cacuenta#0 = #cacugene#10;
     #cacuenta#1 = #cacugene#11;
     |LEE 101#cacuenta.=;
     |SI FSalida = 0;
         |BORRA 020#cacuenta.a;
         |LIBERA #cacuenta;
     |FINSI;
     |CIERRA #cacuenta;

|| |DEBUG;
     |SI #cacugene#23 = "C";  |HAZ BajaCliente;    |FINSI;
     |SI #cacugene#23 = "P";  |HAZ BajaProveedor;  |FINSI;
|FPRC;

|PROCESO LeoPara; |TIPO 0;
     || Dejar este proceso el ultimo sino da error de compilacion
     |HAZ eLeeParametro;
|FPRC;
