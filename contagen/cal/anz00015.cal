|FICHEROS;
   anz00015 #0;
   camaasil #1;         || apuntes lins.
   cacuenta #3;         || cuentas
   caextrp2 #4;         || pantalla display
   caextrp5 #5;         || pantalla display II
   caextrp8 #6;

   anm00003 #7;
   anm00013 #8;
   camaasic #11;
   calicont #31;
   caclipro #13;

   canempre #30;
   caselem1 #998;

   anm0003@ #103;

   caconimp #108;
   ca8m0003 #403;
   ca8m0004 #404;
|FIN;

|VARIABLES;
   mensa1 = "    ATENCION!!! Fecha fuera de periodo ...";
   linea = 0;
   FEstado = 0;
   hay_alguno = 0;
   &entrada = 1;
   &ext1   = "";
   &ext2   = "";
   &d_abajo = 0;
   &h_abajo = 0;
   &s_abajo = 0;
   &runnom = "";
   &espe1 = @;
   &espe2 = @;
   &espe3 = 0;
   &espe4 = 0;
   &espe5 = "";
   &espe6 = "";
   &espe7 = 0;
   &espe8 = 0;
   &espe9 = 0;
   &espe10 = "";
   &espe11 = "";
   &eSwMul = 0;
   &espe15 = "";
   &espe16 = 0;

   &espe18 = "";
   &espe19 = "";
   &espe20 = 0;
   &espe21 = 0;
   &espe22 = "";

   &sino = "";
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   alfa5 = "";
   fe1 = @;
   fe2 = @;
   &aFitxer = "";

   nDebe  = 0;
   nHaber = 0;
   &enEmpOrg = 0;
   &enPerOrg = 0;
   &eaFEmp   = "";
   &swVarios = 0;
   &eaMonOrg = "";
   nDeb1 = 0;
   nHab1 = 0;
   aIncta = "";
   aFicta = "";

   nSwEx = 0;
   swsel = 0;
   aContrapartida = "";
   aNomContra     = "";

   aCta2Gru  = "";
   dn_error2 = 0;
   aMas      = "";

   &enDesAna = 0;

   nDia8     = 0;
   fFec8     = @;
   nDoc8     = 0;
   nIgual     = 0;
   nAsto8     = 0;
   nDiaAper   = 0;
   contra_ad  = "";
   contra_tad = "";
   contra_ah  = "";
   contra_tah = "";
   contra_d   = "";
   contra_td  = "";
   contra_h   = "";
   contra_th  = "";
   nSwAper    = 0;
   aAlfa1 = "";
   aAlfa2 = "";

   &enBEjer = 0;
   aPath08 = "";
   aCta08  = "";
   aCta90  = "";
   aCtaSe  = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscopi_i;
|INCLUYE dscoan_i;
|INCLUYE digana_i;

|| ... Procesos de Pantalla
|CALCULO fechad; |TIPO 0;
   |SI #0#2 < fec1; |O #0#2 > fec2;
      |MENAV mensa1;
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO fechah; |TIPO 0;
   |SI #0#3 < fec1; |O #0#3 > fec2; |O #0#3 < #0#2;
      |MENAV mensa1;
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO no_dep; |TIPO 7;
   |CAMPO_MODIFICA #0#7, 1, eaDepar;
   |CAMPO_MODIFICA #0#8, 1, eaDepar;
|FCAL;

|CALCULO nosubde; |TIPO 7;
   |CAMPO_MODIFICA #0#13, 1, eaSubde;
   |CAMPO_MODIFICA #0#14, 1, eaSubde;
|FCAL;


|| **********************************************************************
|PROCESO ParaApertura;
   nDia8  = -1;
   nAsto8 = 0;
   contra_ad  = ""; contra_tad = "";
   contra_ah  = ""; contra_tah = "";

   |SI enEjercicio = 2008;
       |ABRE #108;
       |DDEFECTO #108;
       #108#0 = 1;
       |LEE 001#108=;
       |CIERRA #108;

       |SI #108#11 = "S";
           |ABRE #404;
           |LEE 001#404p;
           |SI FSalida = 0;
               nDia8 = #404#10;
               fFec8 = #404#11;
               nDoc8 = #404#12;
           |FINSI;
           |CIERRA #404;
           |ABRE #11;
           #11#0 = nDia8;
           #11#1 = fFec8;
           #11#2 = nDoc8;
           |LEE 001#11=;
           |SI FSalida = 0;
               contra_ad  = #11#10; contra_tad = "";
               contra_ah  = #11#8;  contra_tah = "";
               |HAZ LeeContra;
           |FINSI;
           |CIERRA #11;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO LeeContra;
  |ABRE #3;
  |DDEFECTO #3;
  #3#0 = contra_ad;
  |LEE 000#3=;
  contra_tad = #3#2;

  |DDEFECTO #3;
  #3#0 = contra_ah;
  |LEE 000#3=;
  contra_tah = #3#2;

  |CIERRA #3;
|FPRC;
|| ************************************************************************

|PROCESO BuscaContra;
    aContrapartida = "";
    aNomContra     = "";

|SI nSwAper = 0;
    #31#0 = #1#0;
    #31#1 = #1#1;
    #31#2 = #1#2;
    #31#3 = #1#3;
    |LEE 001#31=;
    |SI FSalida = 0;
        aContrapartida = #31#4;
    |SINO;
        #11#0 = #1#0;
        #11#1 = #1#1;
        #11#2 = #1#2;
        |LEE 001#11=;
        |SI FSalida = 0;
            |SI #1#8 = "D"; aContrapartida = #11#10; |FINSI;
            |SI #1#8 = "H"; aContrapartida = #11#8;  |FINSI;
        |FINSI;
   |FINSI;
|SINO;
   |SI #1#8 = "D"; aContrapartida = contra_d; |FINSI;
   |SI #1#8 = "H"; aContrapartida = contra_h; |FINSI;
|FINSI;
   #3#0 = aContrapartida;
   |LEE 001#3=;
   |SI FSalida = 0;
       aNomContra = #3#2;
   |FINSI;
|FPRC;

|| .... Crear Auxiliares
|PROCESO Apertura2008;
   |SALVA_DATOS #1;

   |ABRE #404;
   |DDEFECTO #404;
   #404#10 = nDia8;
   #404#11 = fFec8;
   #404#12 = nDoc8;
   #404#0  = #1#3;
   |LEE 041#404=;
   |SI FSalida ! 0; |O #404#8 ! #1#4; || no existe o no son iguales
       |CIERRA #404;
       |REPON_DATOS #1;
       |HAZ ParaImprimir;
       |ACABA;
   |FINSI;
   || .... Primer Asiento Apertura 2007
   nSwAper   = 1;
   contra_d  = contra_ad;
   contra_td = contra_tad;
   contra_h  = contra_ah;
   contra_th = contra_tah;
   #1#4 = #404#1;
   #1#5 = #404#7;
   |HAZ ParaImprimir;
   |SI #404#8 ! #404#1;
       nSwAper = 2;
       contra_d  = #404#8; contra_td = #404#2;
       contra_h  = #404#8; contra_th = #404#2;
       #1#4 = #404#1;   || 2§ asiento
       #1#5 = #404#7;
       #1#7 = #108#13;
       |SI #404#3 = "D";
           #1#8 = "H";
       |SINO;
           #1#8 = "D";
       |FINSI;
       #1#9 = #404#4 + #404#5;
       |HAZ ParaImprimir;

       nSwAper = 3;
       contra_d  = #404#1; contra_td = #404#2;
       contra_h  = #404#1; contra_th = #404#2;
       #1#4 = #404#8;   || 2§ asiento
       #1#5 = #404#9;
       #1#7 = #108#13;
       #1#8 = #404#3;
       #1#9 = #404#4 + #404#5;
       |HAZ ParaImprimir;
   |FINSI;
   |CIERRA #404;
   |REPON_DATOS #1;
|FPRC;

|PROCESO buclepan_esp;
   nSwAper = 0;
   |SI nDia8 ! -1;
       |SI #1#0 = nDia8; |Y #1#1 = fFec8; |Y #1#2 = nDoc8;
           |HAZ Apertura2008;
           nDiaAper = 1;
           |ACABA;           ||este asiento se trata de forma diferente
       |FINSI;
   |FINSI;

   |HAZ ParaImprimir;
|FPRC;

|PROCESO ParaImprimir;
  |SI #0#9 = 1; |HAZ buclepan0; |FINSI;
  |SI #0#9 = 2; |HAZ buclepan1; |FINSI;
  |SI #0#9 = 3; |HAZ buclepan2; |FINSI;
|FPRC;

|PROCESO buclepan0;
   #4#00 = linea;            || linea
   |LEE 101#4=;
   FEstado = FSalida;
   #4#00 = linea;            || linea
   #4#01 = #0#0;             || cuenta
   #4#02 = #0#4;             || descripcion
   #4#03 = #0#2;             || desde fecha
   #4#04 = #0#3;             || hasta fecha
   #4#45 = #0#17;            || NIF
   #4#18 = #camaasil#0;             || diario
   #4#08 = #camaasil#1;             || fecha
   #4#09 = #camaasil#2;             || documento
   #4#19 = #camaasil#3;             || Apunte
   #4#10 = #camaasil#7;             || descripcion
   #4#20 = #camaasil#21;            || Departamento
   #4#21 = #camaasil#28;            || Subdepartamento
   #4#11 = #camaasil#8;             || signo (no en pantalla!!!)
   #4#29 = #camaasil#6;             || Numero de Concepto

   |SI #4#11 = "D";
       #4#05 = #4#05 + #camaasil#9; || total debe arriba
       #4#12 = #camaasil#9;                || importe debe
       #4#13 = #4#13 + #camaasil#9; || total saldo detalle
       #4#14 = #4#14 + #camaasil#9; || total debe abajo
       #4#17 = 0;                          || importe haber detalle
       d_abajo = d_abajo + #camaasil#9;           || ACUMULADO DEBE FINAL
   |SINO;
       #4#06 = #4#06 + #camaasil#9; || total haber arriba
       #4#12 = 0;            || importe debe
       #4#13 = #4#13 - #camaasil#9; || total saldo detalle
       #4#15 = #4#15 + #camaasil#9; || total haber abajo
       #4#17 = #camaasil#9;                || importe haber detalle
       h_abajo      = h_abajo + #camaasil#9;      || ACUMULADO HABER FINAL
   |FINSI;

   #4#07 = #4#05 - #4#06;              || saldo arriba
   s_abajo = d_abajo - h_abajo;        || SALDO FINAL

||.. grabo la Empresa
   #4#23 = enEmpresa;
   #4#24 = enPeriodo;
   #4#25 = dirfich0;
   #4#26 = eaMoneda;
   #4#27 = eaDepar;
   #4#28 = eaSubde;
   #4#44 = fec3;

   || ... Grabar todos los campos del camaasil
   #4#30 = #camaasil#12;
   #4#31 = #camaasil#13;
   #4#32 = #camaasil#14;
   #4#33 = #camaasil#15;
   #4#34 = #camaasil#19;
   #4#35 = #camaasil#20;
   #4#36 = #camaasil#22;
   #4#37 = #camaasil#23;
   #4#38 = #camaasil#24;
   #4#39 = #camaasil#25;
   #4#40 = #camaasil#26;
   #4#41 = #camaasil#27;
   #4#42 = #camaasil#29;
   #4#43 = #camaasil#1;
   |HAZ BuscaContra;
   #4#46 = aContrapartida;
   #4#47 = aNomContra;
   #4#48 = aCta08;
   #4#49 = aCta90;
   #4#50 = nSwAper;


   |SI #camaasil#1 ] #0#2;|Y #camaasil#1 [ #0#3;
        hay_alguno = 1;
   |FINSI;

   |SI #camaasil#1 [ #0#3;              || fecha dentro del limite hasta
       |SI FEstado = 0;
           |GRABA 020#4a;
       |SINO;
           |GRABA 020#4n;
       |FINSI;
       |SI linea = 1;
           nDeb1 = #4#5 - #4#12;
           nHab1 = #4#6 - #4#17;
       |FINSI;
       |SI #camaasil#1 ] #0#2;              || fecha dentro del limite desde
           linea = linea + 1;
       |FINSI;
   |FINSI;
   |LIBERA #4;
|FPRC;


|PROCESO buclepan1;
   #5#00 = linea;            || linea
   |LEE 101#5=;
   FEstado = FSalida;
   #5#00 = linea;            || linea
   #5#01 = #0#0;             || cuenta
   #5#02 = #0#4;             || descripcion
   #5#03 = #0#2;             || desde fecha
   #5#04 = #0#3;             || hasta fecha
   #5#47 = #0#17;
   #5#18 = #camaasil#0;             || diario
   #5#08 = #camaasil#1;             || fecha
   alfa5 = #camaasil#1;
   alfa2 = alfa5 % 102;
   alfa3 = alfa5 % 402;
   alfa4 = alfa5 % 902;
   alfa5 = alfa2 + alfa3 + alfa4;
   #5#17 = alfa5;
   #5#26 = alfa2 + alfa3;
   #5#09 = #camaasil#2;             || documento
   #5#19 = #camaasil#3;
   #5#10 = #camaasil#7;             || descripcion
   #5#11 = #camaasil#8;             || signo
   #5#20 = #camaasil#21;            || Departamento
   #5#21 = #camaasil#28;            || Subdepartamento

   #5#12 = #camaasil#9;             || importe debe
   |SI #5#11 = "D";
       #5#05 = #5#05 + #camaasil#9; || total debe arriba
       #5#13 = #5#13 + #camaasil#9; || total saldo detalle
       #5#14 = #5#14 + #camaasil#9; || total debe abajo
       d_abajo = d_abajo + #camaasil#9;       || ACUMULADO DEBE FINAL
   |SINO;
       #5#06 = #5#06 + #camaasil#9; || total haber arriba
       #5#13 = #5#13 - #camaasil#9; || total saldo detalle
       #5#15 = #5#15 + #camaasil#9; || total haber abajo:
       h_abajo = h_abajo + #camaasil#9;       || ACUMULADO HABER FINAL
   |FINSI;
   #5#07 = #5#05 - #5#06;              || saldo arriba
   s_abajo = d_abajo - h_abajo;        || SALDO FINAL

   #5#30 = #camaasil#6;
||.. grabo la Empresa
   #5#22 = dirfich0;
   #5#23 = enEmpresa;
   #5#24 = enPeriodo;
   #5#25 = eaMoneda;
   #5#27 = enEjercicio;
   #5#28 = eaDepar;
   #5#29 = eaSubde;
   #5#46 = fec3;

   #5#31 = #camaasil#12;
   #5#32 = #camaasil#13;
   #5#33 = #camaasil#14;
   #5#34 = #camaasil#15;
   #5#35 = #camaasil#19;
   #5#36 = #camaasil#20;
   #5#37 = #camaasil#22;
   #5#38 = #camaasil#23;
   #5#39 = #camaasil#24;
   #5#40 = #camaasil#25;
   #5#41 = #camaasil#26;
   #5#42 = #camaasil#27;
   #5#43 = #camaasil#29;
   #5#44 = #camaasil#1;
   #5#45 = #camaasil#18;
   |HAZ BuscaContra;
   #5#48 = aContrapartida;
   #5#49 = aNomContra;
   #5#50 = aCta08;
   #5#51 = aCta90;
   #5#52 = nSwAper;

   |SI #camaasil#1 ] #0#2;|Y #camaasil#1 [ #0#3;
       hay_alguno = 1;
   |FINSI;
   |SI #camaasil#1 [ #0#3;              || fecha dentro del limite hasta
      |SI FEstado = 0;
         |GRABA 020#5a;
      |SINO;
         |GRABA 020#5n;
      |FINSI;
      |SI linea = 1;
          nDeb1 = #5#5;
          nHab1 = #5#6;
          |SI #5#11 = "D";
              nDeb1 = nDeb1 - #1#9;
          |SINO;
              nHab1 = nHab1 - #1#9;
          |FINSI;
      |FINSI;
      |SI #camaasil#1 ] #0#2;              || fecha dentro del limite desde
         linea = linea + 1;
      |FINSI;
   |FINSI;
   |LIBERA #5;
|FPRC;

|PROCESO buclepan2;

   #6#00 = linea;            || linea
   |LEE 101#6=;
   FEstado = FSalida;
   #6#00 = linea;            || linea
   #6#01 = #0#0;             || cuenta
   #6#02 = #0#4;             || descripcion
   #6#03 = #0#2;             || desde fecha
   #6#04 = #0#3;             || hasta fecha
   #6#45 = #0#17;            || NIF

   #6#08 = #camaasil#1;             || fecha
   #6#09 = #camaasil#2;             || documento
   #6#10 = #camaasil#7;             || descripcion
   #6#11 = #camaasil#8;             || signo (no en pantalla!!!)
   #6#12 = #camaasil#9;             || Importe

   |SI #6#11 = "D";
       #6#05 = #6#05 + #camaasil#9; || total debe arriba
       #6#14 = #6#14 + #camaasil#9; || total debe abajo
       #6#13 = #6#13 + #camaasil#9; || total saldo detalle
       d_abajo = d_abajo + #camaasil#9;           || ACUMULADO DEBE FINAL
   |SINO;
       #6#06 = #6#06 + #camaasil#9; || total haber arriba
       #6#15 = #6#15 + #camaasil#9; || total haber abajo
       #6#13 = #6#13 - #camaasil#9; || total saldo detalle
       h_abajo = h_abajo + #camaasil#9;      || ACUMULADO HABER FINAL
   |FINSI;

   #6#07 = #6#05 - #6#06;              || saldo arriba
   s_abajo = d_abajo - h_abajo;        || SALDO FINAL

   alfa1 = #camaasil#1;
   #6#17 = (alfa1 % 0102) + (alfa1 % 0402);

   #6#18 = #camaasil#0;             || diario
   #6#19 = #camaasil#3;             || Apunte

   #6#20 = #camaasil#26;            || Referencia
   #6#21 = #camaasil#21;            || Departamento
   #6#22 = #camaasil#18;            || Punteo

|| ... grabo la Empresa
   #6#23 = enEmpresa;
   #6#24 = enPeriodo;
   #6#25 = dirfich0;
   #6#26 = eaMoneda;
   #6#27 = eaDepar;
   #6#28 = eaSubde;
   #6#44 = fec3;

   || ... Grabar todos los campos del camaasil
   #6#29 = #camaasil#6;             || Numero de Concepto
   #6#30 = #camaasil#12;
   #6#31 = #camaasil#13;
   #6#32 = #camaasil#14;
   #6#33 = #camaasil#15;
   #6#34 = #camaasil#19;
   #6#35 = #camaasil#20;
   #6#36 = #camaasil#22;
   #6#37 = #camaasil#23;
   #6#38 = #camaasil#24;
   #6#39 = #camaasil#25;
   #6#40 = #camaasil#28;            || Subdepartamento
   #6#41 = #camaasil#27;
   #6#42 = #camaasil#29;
   #6#43 = #camaasil#1;
   |HAZ BuscaContra;
   #6#46 = aContrapartida;
   #6#47 = aNomContra;
   #6#48 = aCta08;
   #6#49 = aCta90;
   #6#50 = nSwAper;

   |SI #camaasil#1 ] #0#2;|Y #camaasil#1 [ #0#3;
        hay_alguno = 1;
   |FINSI;

   |SI #camaasil#1 [ #0#3;              || fecha dentro del limite hasta
       |SI FEstado = 0;
           |GRABA 020#6a;
       |SINO;
           |GRABA 020#6n;
       |FINSI;
       |SI linea = 1;
           nDeb1 = #6#5 - #6#14;
           nHab1 = #6#6 - #6#15;
       |FINSI;
       |SI #camaasil#1 ] #0#2;              || fecha dentro del limite desde
           linea = linea + 1;
       |FINSI;
   |FINSI;
   |LIBERA #6;
|FPRC;

|| ////////////////////////////////////////////////////////////////////
|| ... Segundo nivel de grupos dentro de la seleccion
|CALCULO ver_grupo2;
 |SI #103#2 ] #0#18; |Y #103#2 [ #0#19;
     dn_cuent = #103#2;
     |HAZ dig_ana2;
     |SI dn_error  = 0;
         dn_error2 = 0;
     |FINSI;
 |FINSI;
|FCAL;

|DEFBUCLE selegrupo2;
 #103#1002;
 ;
 aCta2Gru, 000;
 aCta2Gru, 999;
 e;
 NULL, ver_grupo2;
|FIN;


|PROCESO ver_grupoAsto;
 nSwEx = 1;
 |SI #8#6 ] #0#18; |Y #8#6 [ #0#19;
     dn_cuent = #8#6;
     |HAZ dig_ana2;
     |SI dn_error = 0;
         swsel = 1;
         |ERROR10;
     |FINSI;
 |SINO;
      alfa3 = #8#6 % 103;
      |SI alfa3 = "GRU";
         dn_error2 = 1;
         aCta2Gru  = #8#6;
         |BUCLE selegrupo2;
         |SI dn_error2 = 0;
             swsel = 1;
             |ERROR10;
         |FINSI;
      |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE selgrupoAsto;
 #8#1;
 ;
 #1#0, #1#1, #1#2, #1#3, #1#29, 001;
 #1#0, #1#1, #1#2, #1#3, #1#29, 999;
 e;
 NULL, ver_grupo;
|FIN;

|PROCESO ver_grupo;
 |SI #7#2 ] #0#18; |Y #7#2 [ #0#19;
     dn_cuent = #7#2;
     |HAZ dig_ana2;
     |SI dn_error = 0;
         swsel = 1;
         |ERROR10;
     |FINSI;
 |SINO;
      alfa3 = #7#2 % 103;
      |SI alfa3 = "GRU";
         dn_error2 = 1;
         aCta2Gru  = #7#2;
         |BUCLE selegrupo2;
         |SI dn_error2 = 0;
             swsel = 1;
             |ERROR10;
         |FINSI;
      |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE selegrupo;
 #7#1;
 ;
 #1#29, 000;
 #1#29, 999;
 e;
 NULL, ver_grupo;
|FIN;


|PROCESO cuenta_ana;

 swsel = 0;
 |SI #1#29 ] #0#18; |Y #1#29 [ #0#19;
      dn_cuent = #1#29;
      |HAZ dig_ana2;
      |SI dn_error = 0; swsel = 1; |FINSI;
 |SINO;
      alfa3 = #1#29 % 103;
      |SI alfa3 = "GRU";
          nSwEx = 0;
          |BUCLE selgrupoAsto;
          |SI nSwEx = 0;
              |BUCLE selegrupo;
          |FINSI;
      |FINSI;
 |FINSI;
|FPRC;

|PROCESO buclepan;
|SI #1#28 ] #0#13; |Y #1#28 [ #0#14;
   |HAZ cuenta_ana;
   |SI swsel = 0; |ACABA; |FINSI;

   |SI eaMonOrg ! eaMoneda;
       |HAZ LoCambio;
   |FINSI;

   |HAZ buclepan_esp;
|FINSI;
|FPRC;


|DEFBUCLE caextrp00;
   #1#3;
   0, 6, 21;
   #0#0, fe1,      0, 0000, #0#10, #0#5, #0#7;
   #0#0, fe2, 999999, 9999, #0#11, #0#6, #0#8;
   ;
   NULL, NULL, NULL, NULL, NULL, buclepan;
   #1#1, #1#0, #1#2, #1#3;
|FIN;
|| -----------------------------------------------------------------------

|PROCESO HazTodo;
   |HAZ ParaApertura;

   |SI enEjercicio ] 2008;
       aCtaSe = aCta08;
   |SINO;
       aCtaSe = aCta90;
   |FINSI;

   |ABRE #3;
   |ABRE #31;
   |ABRE #11;
   nDeb1 = 0;
   nHab1 = 0;
   |SI #0#9 = 1; |ABRE #4; |FINSI;
   |SI #0#9 = 2; |ABRE #5; |FINSI;
   |SI #0#9 = 3; |ABRE #6; |FINSI;
   |BUCLE caextrp00;
   |SI #0#9 = 1; |CIERRA #4; |FINSI;
   |SI #0#9 = 2; |CIERRA #5; |FINSI;
   |SI #0#9 = 3; |CIERRA #6; |FINSI;

   |CIERRA #11;
   |CIERRA #31;
   |CIERRA #3;
|FPRC;
||*******************************

|RUTINA min;
   #4#0  = 1;
   #4#8  = #0#2;
   #4#18 = #0#10;
   #4#9  = 000000;
   #4#19 = 0000;
   #4#23 = 00001;
|FRUT;

|RUTINA max;
   #4#0 = 999999;
   #4#8  = #0#3;
   #4#18 = #0#11;
   #4#9  = 999999;
   #4#19 = 9999;
   #4#23 = 99999;
|FRUT;

|PROCESO min1;
   #5#0 = 1;
   #5#8  = #0#2;
   #5#18 = #0#10;
   #5#9  = 000000;
   #5#19 = 0000;
   #5#23 = 00001;
|FPRC;

|PROCESO max1;
   #5#0 = 999999;
   #5#8  = #0#3;
   #5#18 = #0#11;
   #5#9  = 999999;
   #5#19 = 9999;
   #5#23 = 99999;
|FPRC;

|PROCESO min2;
   #6#0 = 1;
   #6#8  = #0#2;
   #6#18 = #0#10;
   #6#9  = 000000;
   #6#19 = 0000;
   #6#23 = 00001;
|FPRC;

|PROCESO max2;
   #6#0 = 999999;
   #6#8  = #0#3;
   #6#18 = #0#11;
   #6#9  = 999999;
   #6#19 = 9999;
   #6#23 = 99999;
|FPRC;

|PROCESO CamCuenta;
   aPath08 = "";
   |SI enEjercicio = 2008;
       aPath08 = eaFEmp;
   |SINO;
       |ABRE #30;
       |SELECT #4#30;
       #30#2  = enEmpresa;
       #30#26 = 8;
       |LEE 001#30=;
       |SI FSalida = 0;
           aAlfa1 = #30#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
           aAlfa2 = #30#3; |QBF aAlfa2; aAlfa2 = ("0"     + aAlfa2) % -101;
           |DFICB aPath08;
           aPath08 = aPath08 + aAlfa1 + aAlfa2 + "/";
       |FINSI;
       |SELECT #1#30;
       |CIERRA #30;
   |FINSI;

   |SI aPath08 ! "";
       |PATH_DAT #403 aPath08;
       |ABRE #403;
       |DDEFECTO #403;
       |SI enBEjer ] 2008;
           |SELECT #2#403;
           #403#2 = #0#0;
           |LEE 041#403];
           |SI FSalida = 0; |Y #403#2 = #0#0;
               aCta08 = #403#2;
               aCta90 = #403#0;
           |FINSI;
           |SELECT #1#403;
       |SINO;
           #403#0 = #0#0;
           |LEE 041#403=;
           |SI FSalida = 0;
               aCta08 = #403#2;
               aCta90 = #403#0;
           |FINSI;
       |FINSI;
   |FINSI;

|FPRC;

|PROCESO ModiPantalla;
   |SI eaSubde = "N";
        |C_A #5#10, 1, 29;
        |C_P #5#10, 1, 1126;
        |C_V #5#21, 1, "N";
        |PINTA 0929, "Ä";
        |ATRI R; |PINTA 1026, "Descripcion               "; |ATRI 0;
        |PINTA 1129, " ";
        |PINTA 1229, " ";
        |PINTA 1329, " ";
        |PINTA 1429, " ";
        |PINTA 1529, " ";
        |PINTA 1629, " ";
        |PINTA 1729, " ";
        |PINTA 1829, " ";
        |PINTA 1929, " ";
        |PINTA 2029, "Ä";
   |SINO;
        |SI enSubde = 1; |Y eaDepar = "N";
            |C_A #5#10, 1, 28;
            |C_P #5#21, 1, 1123;
            |C_P #5#10, 1, 1127;
            |C_V #5#20, 1, "N";
            |PINTA 0923, "ÄÄÄÂÄÄÄ";
            |PINTA 1026, "³";
            |ATRI R; |PINTA 1023, "Sdp";
                     |PINTA 1027, "Descripcion               "; |ATRI 0;
            |PINTA 1125, " ³   ³";
            |PINTA 1225, " ³   ³";
            |PINTA 1325, " ³   ³";
            |PINTA 1425, " ³   ³";
            |PINTA 1525, " ³   ³";
            |PINTA 1625, " ³   ³";
            |PINTA 1725, " ³   ³";
            |PINTA 1825, " ³   ³";
            |PINTA 1925, " ³   ³";
            |PINTA 2025, "ÄÁÄÄÄÁ";
        |FINSI;
   |FINSI;
|FPRC;

|PROCESO ParaExtracto;
   #0#17 = "";
   |ABRE #13;
   #13#23 = "C";
   #13#10 = #0#0;
   |LEE 041#13=;
   |SI FSalida = 0;
       #0#17 = #13#9;
   |SINO;
       #13#23 = "P";
       #13#10 = #0#0;
       |LEE 041#13=;
       |SI FSalida = 0;
           #0#17 = #13#9;
       |FINSI;
   |FINSI;
   |CIERRA #13;

   |SI #0#12 ="N";
        fe1 = #0#2;
        fe2 = #0#3;
    |SINO;
        |SI #0#15 = "S";
            alfa1 = #0#2;
            alfa1 = alfa1 % -104;
            alfa2 = dig1; alfa2 = ("00" + alfa2) % -102;
            alfa3 = "01." + alfa2 + "." + alfa1;
            fe1   = alfa3;
            fe2   = #0#3;
        |SINO;
            fe1 = fec1;
            fe2 = fec2;
        |FINSI;
    |FINSI;

    aCta08 = #0#0;
    aCta90 = #0#0;
    |SI #0#15 = "S";
        |HAZ CamCuenta;
    |FINSI;
    linea = 1;
    hay_alguno = 0;
    |SI #0#9 = 1;
        alfa1 = ("4o" + Usuario) % 108;
        |NOME_DAT #4 alfa1;
        |ABRE #4; |CIERRA #4;
        |DELINDEX #4;
    |SINO;
        |SI #0#9 = 2;
            alfa1 = ("5o" + Usuario) % 108;
            |NOME_DAT #5 alfa1;
            |ABRE #5; |CIERRA #5;
            |DELINDEX #5;
        |SINO;
            alfa1 = ("6o" + Usuario) % 108;
            |NOME_DAT #6 alfa1;
            |ABRE #6; |CIERRA #6;
            |DELINDEX #6;
        |FINSI;
    |FINSI;
    aFitxer = alfa1;

    |SI swVarios = 1;
        |HAZ MultiEjercicio;
    |SINO;
        |DFICE dirfich0;
        |HAZ HazTodo;
    |FINSI;

    |HAZ EstaMoneda;
    |SI #0#12 = "N"; |Y swVarios = 0;
        d_abajo = #cacuenta#51;
        h_abajo = #cacuenta#52;
        s_abajo = #cacuenta#53;
    |FINSI;

    |SI hay_alguno = 0;
        |MENAV "    Seleccion vacia ...";
    |SINO;
        enEmpresaPINET = enEmpresa;
        |HAZ RestriccionPINET;
        |SI #0#9 = 1;
            |SI swVarios = 0;
                |ENTLINEAL #1#4, -1, 4, 19, 1, min, max;
            |SINO;
                |HAZ Ordena4;
                |ENTLINEAL #2#4, -6, 4, 19, 1, min, max;
            |FINSI;
            |CIERRA #4;
            |DELINDEX #4;
        |SINO;
            |SI #0#9 = 2;
                |SI swVarios = 0;
                    |PINPA #0#5; |HAZ ModiPantalla;
                    |ENTLINEAL #1#5, -1, 4, 19, 0, min1, max1;
                |SINO;
                    |HAZ Ordena5;
                    |PINPA #0#5; |HAZ ModiPantalla;
                    |ENTLINEAL #2#5, -6, 4, 19, 0, min1, max1;
                |FINSI;
                |CIERRA #5;
                |DELINDEX #5;
            |SINO;
                |SI swVarios = 0;
                    |ENTLINEAL #1#6, -1, 4, 19, 1, min2, max2;
                |SINO;
                    |HAZ Ordena6;
                    |ENTLINEAL #2#6, -6, 4, 19, 1, min2, max2;
                |FINSI;
                |CIERRA #6;
                |DELINDEX #6;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

_____________________________________________________________________________
|PROGRAMA;
    |HAZ DirAplicSt;

    enDesAna = 1;
    |DBASE aMas;
    aMas  = aMas + "def/anm00003";
    |CARGA_DEF aMas, anm0003@;
    |SI FSalida ! 0;
        |MENAV "    Error Cargado Fichero de Grupos Analiticos. Proceso Interrumpido";
        |ACABA;
    |FINSI;

   |SI runnom = "caycosy0"; |Y dirfich0 ! "";
       |PATH_DAT #1 dirfich0;
       |PATH_DAT #3 dirfich0;
       |PATH_DAT #7 dirfich0;
       |PATH_DAT #8 dirfich0;
       |PATH_DAT #11 dirfich0;
       |PATH_DAT #13 dirfich0;
       |PATH_DAT #31 dirfich0;
       |PATH_DAT #103 dirfich0;
       |PATH_DAT #108 dirfich0;
       |PATH_DAT #404 dirfich0;
       eaFEmp = dirfich0;
   |SINO;
       |DFICE eaFEmp;
       |PATH_DAT #1 eaFEmp;
       |PATH_DAT #3 eaFEmp;
       |PATH_DAT #7 eaFEmp;
       |PATH_DAT #8 eaFEmp;
       |PATH_DAT #11 eaFEmp;
       |PATH_DAT #13 eaFEmp;
       |PATH_DAT #31 eaFEmp;
       |PATH_DAT #103 eaFEmp;
       |PATH_DAT #108 eaFEmp;
       |PATH_DAT #404 eaFEmp;
   |FINSI;

   |ABRE #0;
   |DDEFECTO #0;
   |LEE 041#0p;
   |CIERRA #0;

   #0#0 = ext1;
   |ABRE #3;
   #3#0 = #0#0;
   |LEE 001#3=;
   |SI FSalida ! 0;
       |CIERRA #3;
       |DESCARGA_DEF #anm0003@;
       |ACABA;
   |FINSI;
   |CIERRA #3;


   |SI runnom ! "caycosy0";  |HAZ inicio; |FINSI;
   |SI runnom ! "anz00016";
       #0#2 = fec1;
       #0#3 = fec2;
       #0#15 = "N";
       #0#16 = 00;
       eaMonOrg = eaMoneda;
   |SINO;
       #0#2 = espe1;
       #0#3 = espe2;
       #0#5 = espe3;
       #0#6 = espe4;
       #0#7 = espe5;
       #0#8 = espe6;
       #0#9 = espe7;
       #0#10 = espe8;
       #0#11 = espe9;
       #0#12 = sino;
       #0#13 = espe10;
       #0#14 = espe11;
       #0#15 = espe15;
       #0#16 = espe16;

       #0#18 = espe18;
       #0#19 = espe19;
       #0#20 = espe20;
       #0#21 = espe21;
       #0#22 = espe22;
   |FINSI;
   #0#4 = #3#2;

   |BLIN 4;

   |SI runnom ! "anz00016"; |Y runnom ! "caycosy0";
       |PINPA #0#0;
       |PINDA #0#0;
       |ENDATOS #1#0;
   |SINO;
       Campo = 22; |HAZ dig_ana1; FSalida = 0;
   |FINSI;

   |SI FSalida = 0;
       swVarios = 0;
       |SI #0#15 = "S"; |O #0#16 ! 0;
            swVarios = 1;
       |FINSI;
       enBEjer = enEjercicio;
       |HAZ  ParaExtracto;
   |FINSI;

   espe7 = #0#9;
   |ABRE #0;
   |DDEFECTO #0;
   #0#23 = "A";
   |LEE 041#0=;
   |SI FSalida ! 0;
       |DDEFECTO #0;
       #0#23 = "A";
       #0#9 = espe7;
       |GRABA 020#0n;
   |SINO;
       |DDEFECTO #0;
       #0#23 = "A";
       #0#9 = espe7;
       |GRABA 020#0a;
   |FINSI;
   |CIERRA #0;

   |DESCARGA_DEF #anm0003@;
   |PULSATECLA;
|FPRO;


|| ***********************************************************************
|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;
   |SI #0#2 > #caselem1#5; |O #0#3 < #caselem1#4;
       |ACABA;  || Fuera de la seleccion
   |FINSI;

   |PATH_DAT #1 dirfich0;
   |PATH_DAT #3 dirfich0;
   |PATH_DAT #7 dirfich0;
   |PATH_DAT #8 dirfich0;
   |PATH_DAT #11 dirfich0;
   |PATH_DAT #13 dirfich0;
   |PATH_DAT #31 dirfich0;
   |PATH_DAT #103 dirfich0;
   |PATH_DAT #108 dirfich0;
   |PATH_DAT #404 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 000001;
 999999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEjercicio;
   eSwMul = 1;
   espe15 = #0#15;
   espe16 = #0#16;
   |SUB_EJECUTA "caselemp";
   |NOME_DAT #998 eaFichsel;
   |BUCLE MultiEmp0;
   |DELINDEX #998;
|FPRC;

|| ***************** Proceso Ordenaciones

|PROCESO Ordenar4;
   nDebe  = nDebe + #4#12;
   nHaber = nHaber + #4#17;
   #4#5 = nDebe;
   #4#6 = nHaber;
   #4#7 = nDebe - nHaber;
   #4#13  = nDebe - nHaber;
   #4#14 = d_abajo;
   #4#15 = h_abajo;
   #4#16 = s_abajo;
   |GRABA 020#4a;
|FPRC;

|DEFBUCLE Ordenar4;
 #4#2;
 ;
 #0#2, #0#10, 000000, 0000, 00001, 000001;
 #0#3, #0#11, 999999, 9999, 99999, 999999;
 ;
 NULL, Ordenar4;
|FIN;

|PROCESO Ordena4;
  |C_V #4#23,1,"S";
  nDebe  = 0; nHaber = 0;
  nDebe = nDeb1; nHaber = nHab1;
  |BUCLE Ordenar4;
|FPRC;

|PROCESO Ordenar5;
   |SI #5#11 = "D";
       nDebe  = nDebe + #5#12;
   |SINO;
       nHaber = nHaber + #5#12;
   |FINSI;
   #5#5  = nDebe;
   #5#6  = nHaber;
   #5#7  = nDebe - nHaber;
   #5#13 = nDebe - nHaber;
   #5#14 = d_abajo;
   #5#15 = h_abajo;
   #5#16 = s_abajo;
   |GRABA 020#5a;
|FPRC;

|DEFBUCLE Ordenar5;
 #5#2;
 ;
 #0#2, #0#10, 000000, 0000, 00001, 000001;
 #0#3, #0#11, 999999, 9999, 99999, 999999;
 ;
 NULL, Ordenar5;
|FIN;

|PROCESO Ordena5;
  nDebe  = 0; nHaber = 0;
  nDebe = nDeb1; nHaber = nHab1;
  |C_V #5#23,1,"S";
  |C_V #5#27,1,"S";
  |BUCLE Ordenar5;
|FPRC;

|PROCESO Ordenar6;
   |SI #6#11 = "D";
       nDebe  = nDebe + #6#12;
   |SINO;
       nHaber = nHaber + #6#12;
   |FINSI;
   #6#5 = nDebe;
   #6#6 = nHaber;
   #6#7 = nDebe - nHaber;
   #6#13 = nDebe - nHaber;
   #6#14 = d_abajo;
   #6#15 = h_abajo;
   #6#16 = s_abajo;
   |GRABA 020#6a;
|FPRC;

|DEFBUCLE Ordenar6;
 #6#2;
 ;
 #0#2, #0#10, 000000, 0000, 00001, 000001;
 #0#3, #0#11, 999999, 9999, 99999, 999999;
 ;
 NULL, Ordenar6;
|FIN;

|PROCESO Ordena6;
  |C_V #6#23,1,"S";
  nDebe  = 0; nHaber = 0;
  nDebe = nDeb1; nHaber = nHab1;
  |BUCLE Ordenar6;
|FPRC;

|PROCESO LoCambio;
     |HAZ EstaMoneda;

     impMoneda= #camaasil#9;
     |SI eaMoneda = "P";                  || pesetas
         mulMoneda = 1 / 166.386;
     |FINSI;
     |SI eaMoneda = "E";                  || euros
         mulMoneda = 166.386;
     |FINSI;
     impMoneda = (impMoneda * mulMoneda) ! EURODB;
     #camaasil#9 = impMoneda;
|FPRC;

|PROCESO EstaMoneda;
     |SI eaMonOrg = "P";                  || pesetas
         EURO = 1 / 166.386;
         EURODB = 0;
         EURODV = 2;
     |SINO;
         EURO = 166.386;
         EURODB = 2;
         EURODV = 0;
     |FINSI;
|FPRC;
