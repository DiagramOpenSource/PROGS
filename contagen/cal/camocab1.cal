|FICHEROS;
   camocab1;

   :/modelos/def/dsmom042;
   :/modelos/def/dsmom041;
   :/modelos/def/dsmom040 #3;
   :/modelos/def/dsmom049 #49;
   :/modelos/def/dsmom107 #107;
   cacuenta #5;
   camoauxc #6;

   espejo@;
   :/modelos/def/dsmom030;
   :/basica/def/agicen14;
|FIN;

|VARIABLES;
   &ct1_am = "";
   &ct2_am = 0;
   &ct3_am = "";
   &fec_am = @;
   &imp_am = 0;
   &iva_am = 0;
   &tiva_am = 0;
   &prv_am  = "";
   &c_am    = "";
   &c_conp  = 0;
   &dni_am = "";
   &clau_am = "";
   &igic_am = "";

   &nLib_am = 0;
   &aSer_am = "";
   &nFra_am = 0;
   &nDoc_am = 0;
   &nBas_am = 0;
   &c_ctana = "";
   &enGrupo = 0;
   &eaFitnW12 = "";
   &eaFitnW13 = "";
   &ref_am  = "";

   nEstado = 0;


   xx = 0;
   sw_er = 0;
   any = "";
   estado = 0;
   linea = 0;
   impiva = 0;
   impcom = 0;
   impcomA= 0;
   impcomI= 0;
   p = 0;
   &entrada = 1;
   &sw_lin = 0;
   sw = 0;
   long = 0;
   aAlfa = "";
   aAlfa1 = "";
   alfa1 = "";
   alfa2 = "";
   aMas = "";
   nSw      = 0;
   nUltimo  = 0;
   nPosible = 0;
   nume1 = 0;
   swModulo = 0;
   nFactor  = 0;
   nContenido = "";
   nPorceMin = 0;
   nPorceMax = 0;
   yy = 0;
   &enModAmor   = 0;
   nSwEncuentro = 0;
   &aElemento    = "";
   &nNumero      = 0;
   nLinea       = 0;

  &eaElemento = "";
  &enElemeNum = 0;
  &eaElemeNom = "";
  &enElemeCom = 0;
   &enDiAna = 0;
   &efFeAna = @;
   &enDoAna = 0;
   &enApAna = 0;
   &eaGrAna = "";
   &enImAna = 0;
   &enQueAna = 0;

  &nSwGrupo   = 0;
  &nSwFra     = 0;
  nInkey      = 0;

  nCampo55    = 0;
  nOk         = 0;
  {30}aPopup        = "";
     aContenido     = "";
     aID            = "";
     nID            = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoan_i;
|INCLUYE numamo_i;

|PROCESO Elinicio;

 |HAZ inicio;
 |HAZ DirAplicSt;
 |SI Haymodelo = 0;
     |MENAV "    Error.! No Existe Aplicacion MODELOS.";
     |PTEC 807;
 |SINO;
     alfa1 = aPModelo + "fich/";
     |PATH_DAT #dsmom041 #alfa1#;
     |PATH_DAT #dsmom042 #alfa1#;
     |PATH_DAT #dsmom040 #alfa1#;
     |PATH_DAT #dsmom049 #alfa1#;
     |PATH_DAT #dsmom107 #alfa1#;
     || ... Activado Acceso
     |MODO_RELACION #camocab1, 0, "dsmom040", "X", "X";
     |MODO_RELACION #camocab1, 1, "dsmom040", "N", "S";

     aMonedaA = eaMoneda;
     aMonedaC = aMonedaA;
     |HAZ LeeConversor;
     |SI enConverModelo ! 0;   ||Hay diferencia de Monedas
         |SI enRedonPaYaModelo ! 0;
             aMonedaC = "E";
         |SINO;
             aMonedaC = "P";
         |FINSI;
     |FINSI;

     |ABRE #dsmom107;
     |DDEFECTO #dsmom107;
     |LEE 041#dsmom107.p;
     |CIERRA #dsmom107;

     aMas  = aPModelo + "def/dsmom041";
     |CARGA_DEF aMas, espejo@;
     |SI FSalida ! 0;
         |MENAV "    Error Cargado Fichero de Modelos. Proceso Interrumpido";
         aMas = "";
         |PTEC 807;
     |SINO;
         |PATH_DAT #espejo@#alfa1#;
     |FINSI;
 |FINSI;
|FPRC;

|| *************************************************************
|| .... Calculos de los campos por pantalla.
|CALCULO cuenta; |TIPO 6;
     eaCuenta = #camocab1#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #camocab1#Campo# = eaCuenta;
     |PINTA #camocab1#Campo#;

     nume1 = Campo + 1;
     eaCuenta = #camocab1#Campo#; |HAZ SacaNivel;
     #camocab1#nume1# = enNivel;
|FCAL;

|CALCULO refresca; |TIPO 0;
   |SI #camocab1#Campo# ! doce;
      |SI #cacuenta#3 = "N";
         |MENAV "    Esta Cuenta NO tiene Pase Directo ";
         |ERROR;
         |ACABA;
      |FINSI;
   |FINSI;
|FCAL;

|CALCULO comp;
   |ABRE #6;
   aAlfa1 = #camocab1#31; |QBF aAlfa1;
   aAlfa1 = ("00" + aAlfa1) % -102;
   #camoauxc#6 = aAlfa1;
   #camoauxc#0 = #camocab1#3;
   #camoauxc#1 = #camocab1#4;
   |LEE 001#6=;
   |SI FSalida = 0;
      |MENAV "0000Esta Cuenta YA existe en el Desglose";
      |ERROR;
   |FINSI;
   |CIERRA #6;
|FCAL;

|CALCULO tipamo7; |TIPO 7;
 |SI swModulo = 1;
     #camocab1#55 = 1; |PINTA #camocab1#55;
     |C_M #camocab1#16, 1, "N";
     |C_M #camocab1#17, 1, "N"; #camocab1#17 = #camocab1#34; |PINTA #camocab1#17;
     |C_M #camocab1#20, 1, "N"; #camocab1#20 = 0; |PINTA #camocab1#20;
 |SINO;
     |C_M #camocab1#16, 1, "S";
     |C_M #camocab1#17, 1, "S";
     |C_M #camocab1#20, 1, "S";
 |FINSI;
|FCAL;

|CALCULO tipamo; |TIPO 0;
|FCAL;

|CALCULO ElsAnys07; |TIPO 7;
 nume1 = Campo - 4;
 |SI #camocab1#nume1# = "R";
     |MENSA "0000Introduzca los a¤os que restan de vida util ";
 |SINO;
     |MENSA "0000Introduzca los a¤os";
 |FINSI;
|FCAL;

|CALCULO ElsAnys; |TIPO 0;
 |BLIN 4;
 |SI FSalida = 2; |ACABA; |FINSI;
 |C_M #camocab1#Campo#,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |SI #camocab1#Campo# = 0;
     |MENAV "    Introduzca el datos de los A¤os ";
     |ERROR;
 |SINO;
     nume1 = Campo - 4;
     |SI #camocab1#nume1# ! "R";
         #camocab1#Campo# = #camocab1#Campo# ! 0;
         |PINTA #camocab1#Campo#;
     |FINSI;
 |FINSI;
|FCAL;

**************************************************************************
|PROCESO CalTipoBien;
       nCampo55  = 0;
       eaCuenta  = #camocab1#3;
       aAlfa = eaCuenta % 103;
       |SI aAlfa = "210";                      nCampo55 = 11; |FINSI;
       |SI aAlfa = "211"; |O #camocab1#32 = 1; nCampo55 = 12; |FINSI;
       |SI aAlfa = "213";                      nCampo55 = 21; |FINSI;
       |SI aAlfa = "218"; |O #camocab1#32 = 3; nCampo55 = 22; |FINSI;
       |SI aAlfa = "217";                      nCampo55 = 23; |FINSI;
       |SI aAlfa = "216";                      nCampo55 = 24; |FINSI;
       |SI aAlfa = "212"; |O aAlfa = "215";    nCampo55 = 25; |FINSI;
       |SI aAlfa = "214";                      nCampo55 = 28; |FINSI;
       |SI aAlfa = "219"; |O #camocab1#32 = 2; nCampo55 = 29; |FINSI;
       |SI aAlfa = "203"; |O aAlfa = "204";    nCampo55 = 31; |FINSI;
       |SI aAlfa = "205";                      nCampo55 = 32; |FINSI;
       |SI aAlfa = "206";                      nCampo55 = 33; |FINSI;
       |SI aAlfa = "200"; |O aAlfa = "201";
        |O aAlfa = "202"; |O #camocab1#32 = 4; nCampo55 = 39; |FINSI;
       |SI #camocab1#32 = 5;                   nCampo55 = 41; |FINSI;
       |SI #camocab1#32 = 6;                   nCampo55 = 42; |FINSI;
       |SI #camocab1#32 = 7;                   nCampo55 = 43; |FINSI;
       |SI #camocab1#32 = 8;                   nCampo55 = 44; |FINSI;
|FPRC;

|PROCESO CalBienModulo;
       nOk = 0;
       nCampo55  = #camocab1#53;
       |SI #camocab1#32 = 1;
           |SI nCampo55 = 12; nOk = 1; |FINSI;
           nCampo55 = 12;
       |FINSI;
       |SI #camocab1#32 = 2;
           |SI nCampo55 = 23; nOk = 1; |FINSI;
           |SI nCampo55 = 28; nOk = 1; |FINSI;
           nCampo55 = 28;
       |FINSI;
       |SI #camocab1#32 = 3;
           |SI nCampo55 = 11; nOk = 1; |FINSI;
           |SI nCampo55 = 21; nOk = 1; |FINSI;
           |SI nCampo55 = 22; nOk = 1; |FINSI;
           |SI nCampo55 = 24; nOk = 1; |FINSI;
           |SI nCampo55 = 25; nOk = 1; |FINSI;
           |SI nCampo55 = 26; nOk = 1; |FINSI;
           |SI nCampo55 = 27; nOk = 1; |FINSI;
           |SI nCampo55 = 29; nOk = 1; |FINSI;
           nCampo55 = 29;
       |FINSI;
       |SI #camocab1#32 = 4;
           |SI nCampo55 ] 31; |Y nCampo55 [ 39; nOk = 1; |FINSI;
           nCampo55 = 39;
       |FINSI;
       |SI #camocab1#32 = 5;
           |SI nCampo55 = 41; nOk = 1; |FINSI;
           nCampo55 = 41;
       |FINSI;
       |SI #camocab1#32 = 6;
           |SI nCampo55 = 42; nOk = 1; |FINSI;
           nCampo55 = 42;
       |FINSI;
       |SI #camocab1#32 = 7;
           |SI nCampo55 = 43; nOk = 1; |FINSI;
           nCampo55 = 43;
       |FINSI;
       |SI #camocab1#32 = 8;
           |SI nCampo55 = 44; nOk = 1; |FINSI;
           nCampo55 = 44;
       |FINSI;

       |SI nOk = 0;
           |CONFI "0000SNo corresponde Tipo Bien y Tipo Modulo, continuar";
           |SI FSalida ! 0;
               #camocab1#53 = nCampo55;
               |PINTA #camocab1#53;
               |ERROR;
           |FINSI;
       |FINSI;
|FPRC;

|PROCESO CalModuloBien;
       nCampo55  = #camocab1#53;
       |SI nCampo55 = 12;                   #camocab1#32 = 1; |FINSI;
       |SI nCampo55 = 23; |O nCampo55 = 28; #camocab1#32 = 2; |FINSI;
       |SI nCampo55 = 11; |O nCampo55 = 21;
        |O nCampo55 = 22; |O nCampo55 = 24;
        |O nCampo55 = 25; |O nCampo55 = 26;
        |O nCampo55 = 27; |O nCampo55 = 29; #camocab1#32 = 3; |FINSI;
       |SI nCampo55 ] 31; |Y nCampo55 [ 39; #camocab1#32 = 4; |FINSI;
       |SI nCampo55 = 41; #camocab1#32 = 5; |FINSI;
       |SI nCampo55 = 42; #camocab1#32 = 6; |FINSI;
       |SI nCampo55 = 43; #camocab1#32 = 7; |FINSI;
       |SI nCampo55 = 44; #camocab1#32 = 8; |FINSI;
       |PINTA #camocab1#32;
|FPRC;

|CALCULO Tipo7C53; |TIPO 7;
   |SI #camocab1#53 = 0;
       #camocab1#53 = 29;
       |HAZ CalTipoBien;
       |SI nCampo55 ! 0;
           #camocab1#53 = nCampo55;
       |FINSI;
       |PINTA #camocab1#53;
   |FINSI;
|FCAL;

|CALCULO Tipo66C53; |TIPO 66;
     aAlfa = "|C055WID";
     aID   = #camocab1#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 20;
     aPopup3  = "11. Terrenos dedicados exclusivamente a excombreras";
     aPopup4  = "12. Edificaciones y Construcciones";
     aPopup5  = "21. Maquinaria";
     aPopup6  = "22. Elementos de Transportes";
     aPopup7  = "23. Ordenadores y otros equipos informáticos";
     aPopup8  = "24. Mobiliario";
     aPopup9  = "25. Instalaciones";
     aPopup10 = "26. Barcos y Aeronaves";
     aPopup11 = "27. Batea";
     aPopup12 = "28. Utiles y Herramientas";
     aPopup13 = "29. Otro Inmovilizado Material";
     aPopup14 = "31. Patentes y Marcas";
     aPopup15 = "32. Derechos de Traspaso";
     aPopup16 = "33. Aplicaciones Informáticas";
     aPopup17 = "39. Otro Inmovilizado Intangible";
     aPopup18 = "41. Ganado vacuno, porcino, ovino y caprino";
     aPopup19 = "42. Ganado equino y frutales no cítricos";
     aPopup20 = "43. Frutales cítricos y vi¤edos";
     aPopup21 = "44. Olivar";
     aPopup22 = "49. Otros Bienes Semovientes y Agrícolas";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #camocab1#53 = aAlfa;
         aAlfa = aPopup % 580;
     |FINSI;

     |PINTA #camocab1#53;
|FCAL;

|CALCULO Tipo0C53; |TIPO 0;
     nOk = 0;

     |SI #camocab1#53 = 11; nOk = 1; |FINSI;
     |SI #camocab1#53 = 12; nOk = 1; |FINSI;
     |SI #camocab1#53 = 21; nOk = 1; |FINSI;
     |SI #camocab1#53 = 22; nOk = 1; |FINSI;
     |SI #camocab1#53 = 23; nOk = 1; |FINSI;
     |SI #camocab1#53 = 24; nOk = 1; |FINSI;
     |SI #camocab1#53 = 25; nOk = 1; |FINSI;
     |SI #camocab1#53 = 26; nOk = 1; |FINSI;
     |SI #camocab1#53 = 27; nOk = 1; |FINSI;
     |SI #camocab1#53 = 28; nOk = 1; |FINSI;
     |SI #camocab1#53 = 29; nOk = 1; |FINSI;
     |SI #camocab1#53 = 31; nOk = 1; |FINSI;
     |SI #camocab1#53 = 32; nOk = 1; |FINSI;
     |SI #camocab1#53 = 33; nOk = 1; |FINSI;
     |SI #camocab1#53 = 39; nOk = 1; |FINSI;
     |SI #camocab1#53 = 41; nOk = 1; |FINSI;
     |SI #camocab1#53 = 42; nOk = 1; |FINSI;
     |SI #camocab1#53 = 43; nOk = 1; |FINSI;
     |SI #camocab1#53 = 44; nOk = 1; |FINSI;
     |SI #camocab1#53 = 49; nOk = 1; |FINSI;

     |SI nOk = 0;
         |MENAV "0000 Tipo de Bien incorrecto";
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ CalTipoBien;
     |SI nCampo55 ! 0;
         |SI #camocab1#53 ! nCampo55; |Y swModulo = 0;
             |CONFI "0000SNo corresponde Tipo Bien y Cuenta Contable, continuar";
             |SI FSalida ! 0;
                 #camocab1#53 = nCampo55;
                 |PINTA #camocab1#53;
                 |ERROR;
             |FINSI;
         |FINSI;
         |SI swModulo ! 0;
             |SI #camocab1#32 ! 0;
                 |HAZ CalBienModulo;
             |SINO;
                 |HAZ CalModuloBien;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #camocab1#53 = 12;
         #camocab1#45 = "S";
         |HAZ esinmueble;
     |FINSI;
|FCAL;

|CALCULO Tipo7C54; |TIPO 7;
  aAlfa1 = "S";
  |SI #camocab1#53 ! 11; |Y #camocab1#53 ! 12; |Y #camocab1#53 ! 22;
      aAlfa1 = "N";
      #camocab1#54 = "";
      |PINTA #camocab1#54;
  |FINSI;

  |C_M #camocab1#54, 1, aAlfa1;
  |SI aAlfa1 = "S";
      aAlfa = "0000Introduzca la Referencia Catastral";
      |SI #camocab1#53 = 22;
          aAlfa = "0000Introduzca la Matrícula del vehículo";
      |FINSI;
      |MENSA aAlfa;
  |FINSI;
|FCAL;

|CALCULO Tipo0C54; |TIPO 0;
  |BLIN 4;
|FCAL;

|CALCULO Tipo66C55; |TIPO 66;
     aAlfa = "|C057WID";
     aID   = #camocab1#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 11;
     aPopup3  = "01. Amortización lineal según tablas (cálculo automático)";
     aPopup4  = "02. Amor. según porcentaje constante sobre el imp. pendiente de amor. (cálculo automático)";
     aPopup5  = "03. Amortización según números dígitos - creciente (cálculo automático)";
     aPopup6  = "04. Planes de amortización (cálculo automático)";
     aPopup7  = "05. Depreciación efectiva probada fehacientemente (cálculo manual)";
     aPopup8  = "06. Libertad de Amortización (cálculo manual)";
     aPopup9  = "07. Amortización Acelerada (cálculo automático)";
     aPopup10 = "08. Amortización de Elementos Adquiridos Usados (cálculo automático)";
     aPopup11 = "09. Amortización de Elementos Patrimoniales Objeto de Reinversión - DT 28º LIS (cálculo manual)";
     aPopup12 = "10. Amortización de Activos Nuevos Adquiridos en 2003 y 2004 - DT 13º LIS (cálculo manual)";
     aPopup13 = "80. Amortización según valor residual a 2015 (cálculo automático)";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #camocab1#55= aAlfa;
     |FINSI;

     |PINTA #camocab1#55;
|FCAL;

|CALCULO Tipo0C55; |TIPO 0;
   |BLIN 4;

   nOk = 0;
   |SI #camocab1#55 ] 1; |Y #camocab1#55 [ 10; nOk = 1; |FINSI;
   |SI #camocab1#55 = 80;                      nOk = 1; |FINSI;
   |SI nOk = 0;
       |MENAV "0000 Tipo de Amortización incorrecto";
       |ERROR;
       |ACABA;
   |FINSI;

   |SI #camocab1#8 = "U"; |Y #camocab1#55 ! 1; |Y #camocab1#55 ! 80;
      |MENAV "     En un Bien Usado NO se admite este tipo de Amortizacion";
      |ERROR;
      |ACABA;
   |FINSI;

   |SI #camocab1#55 = 80;
       |SI #camocab1#6 ] "01.01.2015";
           |MENAV "     Fecha de Compra igual o superior a 01.01.2015, Tipo amortizacion Incorrecto";
           |ERROR;
           |ACABA;
       |FINSI;
       |SI swModulo ! 0;
           |MENAV "     Actividad de Modulos, Tipo amortizacion Incorrecto";
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   nume1 = Campo + 4;
   |SI #camocab1#55 = 1;
       #camocab1#14 = 0;
       #camocab1#20 = 0;
       |CAMPO_MODIFICA #camocab1#14, 1, "N";
       |CAMPO_MODIFICA #camocab1#20, 1, "N";
       |PINTA #camocab1#14;
       |PINTA #camocab1#20;
   |SINO;
       |CAMPO_MODIFICA #camocab1#14, 1, "S";
       |CAMPO_MODIFICA #camocab1#20, 1, "S";
   |FINSI;

   |SI swModulo = 2; |Y Campo = 10;
       #camocab1#16 = #camocab1#10; |PINTA #camocab1#16;
       #camocab1#17 = #camocab1#11; |PINTA #camocab1#17;
       #camocab1#20 = #camocab1#14; |PINTA #camocab1#20;
   |FINSI;
   aAlfa = "M";
   |SI #camocab1#55 = 1; aAlfa = "N"; |FINSI;
   |SI #camocab1#55 = 2; aAlfa = "D"; |FINSI;
   |SI #camocab1#55 = 3; aAlfa = "A"; |FINSI;
   |SI #camocab1#55 = 80; aAlfa = "R"; |FINSI;
   |SI #camocab1#55 = 7; aAlfa = "N"; |FINSI;
   |SI #camocab1#55 = 8; aAlfa = "N"; |FINSI;
   #camocab1#10 = aAlfa; #camocab1#16 = aAlfa;

   |C_M #camocab1#11, 1, "S";
   |C_M #camocab1#14, 1, "S";
   |C_M #camocab1#17, 1, "S";
   |C_M #camocab1#20, 1, "S";
   |SI #camocab1#10 = "F";
       #camocab1#11 = 0; |PINTA #camocab1#11;
       #camocab1#14 = 0; |PINTA #camocab1#14;
       #camocab1#17 = 0; |PINTA #camocab1#17;
       |C_M #camocab1#11, 1, "N";
       |C_M #camocab1#14, 1, "N";
       |C_M #camocab1#17, 1, "N";
   |FINSI;
   |SI #camocab1#10 = "N";
       #camocab1#14 = 0; |PINTA #camocab1#14;
       #camocab1#20 = 0; |PINTA #camocab1#20;
       |C_M #camocab1#14, 1, "N";
       |C_M #camocab1#20, 1, "N";
   |FINSI;
   |SI #camocab1#10 = "M";
       #camocab1#11 = 0; |PINTA #camocab1#11;
       #camocab1#14 = 0; |PINTA #camocab1#14;
       #camocab1#17 = 0; |PINTA #camocab1#17;
       #camocab1#20 = 0; |PINTA #camocab1#20;
       |C_M #camocab1#11, 1, "N";
       |C_M #camocab1#14, 1, "N";
       |C_M #camocab1#17, 1, "N";
       |C_M #camocab1#20, 1, "N";
   |FINSI;
|FCAL;

|CALCULO numamo; |TIPO 6;
   x_entra = entrada;
   x_alfa1 = #camocab1#Campo#;
   |HAZ x_punto;
   #camocab1#Campo# = x_alfa1;
   |PINTA #camocab1#Campo#;
|FCAL;

|RUTINA infer41;
   #dsmom041#0 = enEmpresa;
   #dsmom041#2 = "        ";
   #dsmom041#3 = 00;
|FRUT;

|RUTINA super41;
   #dsmom041#0 = enEmpresa;
   #dsmom041#2 = "zzzzzzzz";
   #dsmom041#3 = 99;
|FRUT;

|CALCULO LaConsulta; |TIPO 0;
 |SI FSalida = 10;
     |ABRE #dsmom041;
     |CONSULTA_F_CLAVE #1#dsmom041, infer41,super41;
     #camocab1#0 = #dsmom041#2; |PINTA #camocab1#0;
     |ERROR;
     |CIERRA #dsmom041;
 |FINSI;
|FCAL;

|PROCESO BuscaIgual;
     nUltimo = #espejo@#3;
     nSw = 0;
     |SI #espejo@#26 > "01.01.1900";          nSw = 1; |FINSI;
     |SI #espejo@#15 ! 0; |O #espejo@#21 ! 0; nSw = 1; |FINSI;
     |SI #espejo@#40 = "I";                   nSw = 1; |FINSI;
     |SI nSw = 0; |Y #espejo@#27 = fec_am;
         nPosible = #espejo@#3;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaIgual;
   #espejo@#1003;
   ;
   enEmpresa, #camocab1#0, 00;
   enEmpresa, #camocab1#0, 99;
   e;
   NULL, BuscaIgual;
|FIN;

|CALCULO tracodi; |TIPO 0;
  |CAMPO_MODIFICA #camocab1#1, 1, "S";

  alfa1 = #camocab1#0; |QBF alfa1;
  |SI alfa1 = ""; |ERROR; |ACABA; |FINSI;

  #dsmom041#0 = enEmpresa;
  #dsmom041#2 = #camocab1#0;
  #dsmom041#3 = 00;
  |LEE 011#dsmom041.=;
  |SI FSalida ! 0;
      |CAMPO_MODIFICA #camocab1#1, 1, "N";
      #camocab1#1 = 0;
  |SINO;
      nUltimo  = -1;
      nPosible = -1;
      |BUCLE BuscaIgual;
      |SI nPosible = -1;
          #camocab1#1 =  nUltimo + 1;
      |SINO;
          #camocab1#1 =  nPosible;
      |FINSI;
  |FINSI;
  |PINTA #camocab1#1;
|FCAL;

|CALCULO noimporte;
   |SI #camocab1#Campo# = 0;
      |MENAV "      El importe debe ser diferente de CERO.";
      |ERROR;
      |ACABA;
   |FINSI;
|FCAL;

|CALCULO EnCurso0; |TIPO 0;
   |C_M #camocab1#38,1,"S";
   |SI #camocab1#40 = "S";
       #camocab1#38 = "01.01.0000"; |PINTA #camocab1#38;
       |C_M #camocab1#38,1,"N";
   |FINSI;
|FCAL;

|CALCULO FInicio7;  |TIPO 7;
     |SI #camocab1#Campo# [ "01.01.1900"; |Y #camocab1#40 = "N";
         #camocab1#Campo# = #camocab1#6;
         |PINTA #camocab1#Campo#;
     |FINSI;
|FCAL;

|CALCULO FInicio0;  |TIPO 0;
     |SI #camocab1#38 < #camocab1#6; |Y #camocab1#40 = "N";
         |C_M #camocab1#38,1,"S";
         |MENAV "    La Fecha Inicio debe ser igual o mayor a la de Compra";
         |ERROR;
     |FINSI;
|FCAL;

|CALCULO NuevoUsado;
 nFactor = 1;
 |SI #camocab1#Campo# = "U";  nFactor = 2;  |FINSI;

 |SI swModulo = 1;
     |SI #camocab1#33 = 0;
            |SI #camocab1#32 = 0;  #camocab1#33 = 100;           |FINSI;
            |SI #camocab1#32 = 1;  #camocab1#33 = 5  * nFactor;  |FINSI;
            |SI #camocab1#32 = 2;  #camocab1#33 = 40 * nFactor;  |FINSI;
            |SI #camocab1#32 = 3;  #camocab1#33 = 25 * nFactor;  |FINSI;
            |SI #camocab1#32 = 4;  #camocab1#33 = 15 * nFactor;  |FINSI;
            |SI #camocab1#32 = 5;  #camocab1#33 = 22 * nFactor;  |FINSI;
            |SI #camocab1#32 = 6;  #camocab1#33 = 10 * nFactor;  |FINSI;
            |SI #camocab1#32 = 7;  #camocab1#33 = 5  * nFactor;  |FINSI;
            |SI #camocab1#32 = 8;  #camocab1#33 = 3  * nFactor;  |FINSI;
        |FINSI;

        |SI #camocab1#34 = 0;
            |SI #camocab1#32 = 0;  #camocab1#34 = 100;           |FINSI;
            |SI #camocab1#32 = 1;  #camocab1#34 =  2.5  * nFactor;  |FINSI;
            |SI #camocab1#32 = 2;  #camocab1#34 = 20    * nFactor;  |FINSI;
            |SI #camocab1#32 = 3;  #camocab1#34 = 12.5  * nFactor;  |FINSI;
            |SI #camocab1#32 = 4;  #camocab1#34 = 10    * nFactor;  |FINSI;
            |SI #camocab1#32 = 5;  #camocab1#34 = 12.5  * nFactor;  |FINSI;
            |SI #camocab1#32 = 6;  #camocab1#34 =  5.88 * nFactor;  |FINSI;
            |SI #camocab1#32 = 7;  #camocab1#34 =  2.22 * nFactor;  |FINSI;
            |SI #camocab1#32 = 8;  #camocab1#34 =  1.25 * nFactor;  |FINSI;
       |FINSI;

       |SI #camocab1#35 = 0; #camocab1#35 = #camocab1#34;  |FINSI;

       |PINTA #camocab1#33;
       |PINTA #camocab1#34;
  |FINSI;
|FCAL;

|CALCULO LeeGrupo; |TIPO 6;

  |ABRE #dsmom040;
  #dsmom040#0 = enEmpresa;
  #dsmom040#2 = #camocab1#15;
  |LEE 000#dsmom040.=;
  nEstado = FSalida;
  |CIERRA #dsmom040;

  |SI nEstado ! 0;
      |ERROR;
      |CONFI "    SError.! No existe Grupo de Amortizacion. Desea darlo de alta ";
      |SI FSalida = 0;
          enGrupo = #camocab1#15;
          |SUB_EJECUTA_NP "camocab3";
          #camocab1#15 = enGrupo; |PINTA #camocab1#15;
      |FINSI;
  |SINO;
      aAlfa1 = #camocab1#39; |QBF aAlfa1;
      |SI aAlfa1 = "";
          #camocab1#39 = #dsmom040#9;
          |SI enSwAna = 1;  |PINTA #camocab1#39; |FINSI;
      |FINSI;
  |FINSI;
  #dsmom041#0 = enEmpresa;
|FCAL;

|CALCULO LeeLaActividad; |TIPO 0;
  swModulo = 0;
  || Lee Actividad
  |ABRE #agicen14;
  #agicen14#0 = enEmpresa;
  #agicen14#1 = #camocab1#31;
  |LEE 041#agicen14.=;
  |SI FSalida ! 0;
      |CIERRA #agicen14;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #agicen14;
  eaNombreAct = #agicen14#4;

  swModulo = 0;
  |SI #agicen14#9  = 5; |O #agicen14#9  = 10;
      swModulo = 1;
  |FINSI;
  |SI #agicen14#9 = 6; |O #agicen14#9 = 7; |O #agicen14#9 = 11; |O #agicen14#9 = 12;
      swModulo = 1;   ||Agricolas  (Paco 30.05.2001)
      |SI #agicen14#7 = 9; |Y #agicen14#9 = 7;
          swModulo = 2;
      |FINSI;
  |FINSI;
|FCAL;

|CALCULO TModulo7; |TIPO 7;
  |SI swModulo = 0;
      |C_M #camocab1#32,1,"N"; #camocab1#32 = 0; |PINTA #camocab1#32;
      |C_M #camocab1#33,1,"N"; #camocab1#33 = 0; |PINTA #camocab1#33;
      |C_M #camocab1#34,1,"N"; #camocab1#34 = 0; |PINTA #camocab1#34;
  |SINO;
      |C_M #camocab1#32,1,"S";
      |C_M #camocab1#33,1,"S";
      |C_M #camocab1#34,1,"S";

      |PUSHV 0523 1680;
      |ATRI R;
      |PINTA 0523, " 0 Inmovilizado material nuevos 100% mismo a. y <100.001 ";
      |PINTA 0623, " 1 Edificios y otras construcciones ( 2,5%  al  5%) 40 a ";
      |PINTA 0723, " 2 Utiles, herramientas, equipos.   (20  %  al 40%)  5 a ";
      |PINTA 0823, " 3 Elementos de transportes y resto (12,5%  al 25%)  8 a ";
      |PINTA 0923, " 4 Inmovilizado inmaterial          (10  %  al 15%) 10 a ";
      |PINTA 1023, " ------------------------------------------------------- ";
      |PINTA 1123, " 5 Vacuno, porcino, ovino y caprino (12,5%  al 22%)  8 a ";
      |PINTA 1223, " 6 Equino y frutales no citricos    ( 5,88% al 10%) 17 a ";
      |PINTA 1323, " 7 Frutales citricos y vi¤edos      ( 2,22% al  5%) 45 a ";
      |PINTA 1423, " 8 Olivar                           ( 1,25% al  3%) 80 a " ;

      |ATRI r;
  |FINSI;
|FCAL;

|CALCULO TModulo0;  |TIPO 0;
    |POPV;
    nContenido = Contenido;
    |SI nContenido ! #camocab1#Campo#;
        #camocab1#33 = 0;
        #camocab1#34  = 0;
        |HAZ NuevoUsado;
         |SI #camocab1#Campo# ! 0;
             |HAZ CalBienModulo;
         |FINSI;
    |FINSI;

    |SI #camocab1#Campo# = 5;
        |C_M #camocab1#33, 1, "N";
        |C_M #camocab1#34, 1, "N";
    |FINSI;
|FCAL;

|CALCULO FiltroPorce;  |TIPO 0;
     |C_M #camocab1#Campo#,0,alfa1;
     |SI alfa1 = "N"; |ACABA; |FINSI;

     |SI #camocab1#8 = "N"; nFactor = 1;  |FINSI;
     |SI #camocab1#8 = "U"; nFactor = 2;  |FINSI;
     |SI #camocab1#32 = 0;
           nPorceMin = 100;
           nPorceMax = 100;
     |FINSI;
     |SI #camocab1#32 = 1;
           nPorceMin = 2.5 * nFactor;
           nPorceMax = 5   * nFactor;
     |FINSI;
     |SI #camocab1#32 = 2;
           nPorceMin = 20  * nFactor;
           nPorceMax = 40  * nFactor;
     |FINSI;
     |SI #camocab1#32 = 3;
           nPorceMin = 12.5 * nFactor;
           nPorceMax = 25   * nFactor;
     |FINSI;
     |SI #camocab1#32 = 4;
           nPorceMin = 10   * nFactor;
           nPorceMax = 15   * nFactor;
     |FINSI;
     |SI #camocab1#32 = 5;
           nPorceMin = 12.5 * nFactor;
           nPorceMax = 22   * nFactor;
     |FINSI;
     |SI #camocab1#32 = 6;
           nPorceMin = 5.88  * nFactor;
           nPorceMax = 10    * nFactor;
     |FINSI;
     |SI #camocab1#32 = 7;
           nPorceMin = 2.22 * nFactor;
           nPorceMax = 5    * nFactor;
     |FINSI;
     |SI #camocab1#32 = 8;
           nPorceMin = 1.25 * nFactor;
           nPorceMax = 3    * nFactor;
     |FINSI;
     |SI #camocab1#Campo# < nPorceMin;  |O #camocab1#Campo# > nPorceMax;
         |MENAV "        Porcentaje fuera de limites.";
         |ERROR;
     |FINSI;
|FCAL;

|CALCULO Para340;
 aAlfa1 = #camocab1#Campo#;
 |C_M #camocab1#45, 1, aAlfa1;
|FCAL;

|CALCULO esinmueble;
  |SI #camocab1#45 = "S"; #camocab1#46 = 9; |FINSI;
  |SI #camocab1#45 = "N"; #camocab1#46 = 4; |FINSI;
  |PINTA #camocab1#46;
|FCAL;

|| ----- Cuentas analiticas
|CALCULO anactaG; |TIPO 0;
  nInkey = FSalida;
  |SI enSwAna = 0; |ACABA; |FINSI;

    salidas = FSalida; |HAZ FPuntosAna;
    eOpAna = 0; || 1 = Consulta pantalla
    |SI nInkey = 10; eOpAna = 1;  |FINSI;
    eaCtaAna = #camocab1#39;
    |HAZ LeeCtaAna;
    |SI eswLect = 1;
        |MENAV "    Error.! No Existe Cuenta Analitica";
        |ERROR;
    |SINO;
        #camocab1#39 = eaCtaAna;
        |PINTA #camocab1#39;
   |FINSI;
|FCAL;

|| ======================================================================
||   Calculos de las Lineas de Amortizacion
|CALCULO Ptec816; |TIPO 7;
  alfa1 = #camocab1#Campo#; |QBT alfa1;
  |SI alfa1 = ""; #camocab1#Campo# = c_am; |PINTA #camocab1#Campo#; |FINSI;
  |SI eaSobreEs ! "S";
      |PTEC 816;
  |FINSI;
|FCAL;

|| ======================================================================
|PROCESO descarga;
   |SI aMas ! ""; |DESCARGA_DEF #espejo@; |FINSI;
|FPRC;

|PROGRAMA;
   |HAZ Elinicio;
   |SI enModAmor = 2;
       |HAZ BuscoFactura;
       |SI nSwEncuentro = 2;
           |PINPA #0#camocab1;
           #camocab1#0 = #dsmom041#2; |PINTA #camocab1#0;
           #camocab1#1 = #dsmom041#3; |PINTA #camocab1#1;
           #camocab1#2 = #dsmom041#4; |PINTA #camocab1#2;
           |MENAV aAlfa1;
           |HAZ descarga;
           |ACABA;
       |FINSI;
   |FINSI;

   |ABRET #dsmom041;
   |DDEFECTO #dsmom041;

 |ET empieza;
    |PINPA #0#camocab1;
    |SI enSwAna = 1;
        |ATRI P; |PINTA 1046, "Cta. Analitica: "; |ATRI 0;
        |C_M #camocab1#39,1,"S";
        |C_V #camocab1#39,1,"S";
    |SINO;
        |PINTA 1046, "                        "; |ATRI 0;
        |C_M #camocab1#39,1,"N";
        |C_V #camocab1#39,1,"N";
    |FINSI;
    |SI eaSubde = "S"; |Y #107#28 = "S";
        |ATRI P; |PINTA 0670, " Act/Subd"; |ATRI 0;
        |C_V #camocab1#52,1,"S";
        |C_P #camocab1#31,1,0773;
        |C_A #camocab1#2,1,35;
    |FINSI;

    |HAZ def_campos;
    |SI sw_er = 1;
        |CIERRAT #dsmom041;
        |HAZ descarga;
        |ACABA;
    |FINSI;
    |PINDA #0#camocab1;

    |ENDATOS #1#camocab1;
    |SI FSalida = 0;
        |HAZ actualiza;
        |HAZ anacta;
    |SINO;
        |SI nSwEncuentro = 0;
            |CONFI "2400SINTRODUCCION NO CONFORME. ¨ Elegir otro codigo de Elemento? ";
            |SI FSalida = 0;
                |HAZ restaura;
                |VETE empieza;
            |FINSI;
        |FINSI;
    |FINSI;
    |CIERRAT #dsmom041;
    |HAZ descarga;
|FPRO;

||*********************************************************************

|PROCESO def_campos;

 |ET otro;
   sw_er  = 0;
   linea  = 0;
   impcom = 0;
   impiva = 0;

   |DDEFECTO #camocab1;
   #camocab1#37 = enEmpresa;

   |SI nSwEncuentro ! 0;
       #camocab1#0 = aElemento; |PINTA #camocab1#0;
       #camocab1#1 = nNumero;   |PINTA #camocab1#1;
   |SINO;
       |ENCAMPO #0#camocab1;
       |SI FSalida ! 0; sw_er = 1; |ACABA; |FINSI;
       |ENCAMPO #1#camocab1;
       |SI FSalida ! 0; sw_er = 1; |ACABA; |FINSI;
   |FINSI;

   |DDEFECTO #dsmom041;
   #dsmom041#0 = enEmpresa;
   #dsmom041#2 = #camocab1#0;
   #dsmom041#3 = #camocab1#1;
   |LEE 011#dsmom041.=;
   estado = FSalida;
   |SI estado ! 0;
       linea = 1;
       nSwEncuentro = 0;
   |SINO;
       |SI enConverModelo ! 0;
           #dsmom041#10 = (#dsmom041#10 * enConverModelo ) ! enRedonModelo;
           #dsmom041#15 = (#dsmom041#15 * enConverModelo ) ! enRedonModelo;
           #dsmom041#16 = (#dsmom041#16 * enConverModelo ) ! enRedonModelo;
           #dsmom041#21 = (#dsmom041#21 * enConverModelo ) ! enRedonModelo;
           #dsmom041#22 = (#dsmom041#22 * enConverModelo ) ! enRedonModelo;
       |FINSI;

       |HAZ tracod2;
       |SI sw_er = 1; |ACABA;     |FINSI;
       |SI sw_er = 2; |VETE otro; |FINSI;

       #camocab1#2 = #dsmom041#4;
       #camocab1#3 = #dsmom041#5;
       #camocab1#4 = #dsmom041#6;
       |PARA xx = 5; |SI xx [ 23; |HACIENDO xx = xx + 1;
             yy = xx + 3;
             #camocab1#xx# = #dsmom041#yy#;
       |SIGUE;
       #camocab1#6  = #dsmom041#27;
       #camocab1#31 = #dsmom041#1;
       #camocab1#32 = #dsmom041#28;
       #camocab1#33 = #dsmom041#29;
       #camocab1#34 = #dsmom041#30;
       #camocab1#35 = #dsmom041#31;
       #camocab1#38 = #dsmom041#9;
       #camocab1#39 = #dsmom041#34;
       #camocab1#40 = #dsmom041#35;
       #camocab1#41 = #dsmom041#40;
       #camocab1#42 = #dsmom041#41;
       #camocab1#43 = #dsmom041#42;
       #camocab1#44 = #dsmom041#43 - impcomI;
       #camocab1#45 = #dsmom041#44;
       #camocab1#46 = #dsmom041#45;
       #camocab1#47 = #dsmom041#46;
       |HAZ LeeLaActividad;
       |C_M #camocab1#6,1,"N";
       #camocab1#48 = #dsmom041#47;
       #camocab1#49 = #dsmom041#48;
       #camocab1#50 = #dsmom041#49;
       #camocab1#51 = #dsmom041#53;
       |SI eaSubde = "S"; |Y #107#28 = "S";
           #camocab1#52 = #dsmom041#54;
       |FINSI;
   |FINSI;

   |SI ct2_am ! 0;
      #camocab1#3 = ct1_am;
      #camocab1#4 = ct2_am;
      #camocab1#2 = ct3_am;
   |FINSI;
   #camocab1#5 = prv_am;
   |SI estado ! 0; #camocab1#6 = fec_am; |FINSI;
   #camocab1#7 = imp_am + impcom;
   #camocab1#13 = #camocab1#7; ||  13 + imp_am + impcom - impcomA;
   #camocab1#19 = #camocab1#7; ||  19 + imp_am + impcom - impcomA;
   #camocab1#23 = "01.01.0000";
   |SI #camocab1#40 = "N";
       #camocab1#38 = #camocab1#6;
   |FINSI;

   #camocab1#24 = linea;
   any   =  #camocab1#6 % -104; #camocab1#25 = any;
   #camocab1#26 = "C";
   #camocab1#27 = imp_am;
   #camocab1#28 = c_am;
   #camocab1#29 = fec_am;
   #camocab1#30 = "S";
   #camocab1#36 = c_conp;
   |SI estado ! 0;
       #camocab1#31 = enActividad;
       |SI eaSubde = "S"; |Y #107#28 = "S";
           #camocab1#52 = eaCodSubdep;
       |FINSI;
   |FINSI;
   #camocab1#39 = c_ctana;
   #camocab1#44 = #camocab1#44 + iva_am;
   #camocab1#47 = tiva_am;
   #camocab1#48 = dni_am;
   #camocab1#49 = clau_am;
||   |SI enEjercicio < 2017;
||       aAlfa   = (("00" + nLib_am) % -102) + "-" + (("0000000000" + nDoc_am) % -110) + " / ";
||       |SI aSer_am ! "     ";
||           aAlfa   = aAlfa + aSer_am + "-" + (("000000" + nFra_am) % -106);
||       |SINO;
||            aAlfa   = aAlfa + (("000000" + nFra_am) % -106);
||       |FINSI;
||   |SINO;
       aAlfa = ref_am;
||   |FINSI;
   #camocab1#50 = aAlfa;
   #camocab1#51 = igic_am;
   #camocab1#53 = #dsmom041#55;
   #camocab1#54 = #dsmom041#56;
   #camocab1#55 = #dsmom041#57;
   |SI #camocab1#53 = 0; #camocab1#53 = 29; |FINSI;
   |SI #camocab1#55 = 0; #camocab1#55 = 1;  |FINSI;
|FPRC;

|PROCESO actualiza;
   |DDEFECTO #dsmom041;
   aElemento = #camocab1#0;
   nNumero   = #camocab1#1;
   |SI enConverModelo ! 0;
          eaMoneda = aMonedaC; |HAZ Monedas;
          #camocab1#07 = (#camocab1#07 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab1#12 = (#camocab1#12 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab1#13 = (#camocab1#13 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab1#18 = (#camocab1#18 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab1#19 = (#camocab1#19 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab1#27 = (#camocab1#27 / enConverModelo ) ! enRedonPaYaModelo;
          #camocab1#44 = (#camocab1#44 / enConverModelo ) ! enRedonPaYaModelo;
   |FINSI;

   #dsmom041#0 = enEmpresa;
   #dsmom041#1 = #camocab1#31;
   #dsmom041#2 = #camocab1#0;
   #dsmom041#3 = #camocab1#1;
   #dsmom041#4 = #camocab1#2;
   #dsmom041#5 = #camocab1#3;
   #dsmom041#6 = #camocab1#4;

   |PARA xx = 5; |SI xx [ 23; |HACIENDO xx = xx + 1;
         yy = xx + 3;
         #dsmom041#yy# = #camocab1#xx#;
   |SIGUE;

   #dsmom041#9  = #camocab1#38;
   #dsmom041#1  = #camocab1#31;
   #dsmom041#27 = #camocab1#6;
   #dsmom041#28 = #camocab1#32;
   #dsmom041#29 = #camocab1#33;
   #dsmom041#30 = #camocab1#34;
   #dsmom041#31 = #camocab1#35;
   #dsmom041#32 = eaNombreEmp;
   #dsmom041#33 = eaNombreAct;
   #dsmom041#34 = #camocab1#39;
   #dsmom041#35 = #camocab1#40;
   #dsmom041#40 = #camocab1#41;
   #dsmom041#41 = #camocab1#42;
   #dsmom041#42 = #camocab1#43;
   #dsmom041#43 = #camocab1#44;
   #dsmom041#44 = #camocab1#45;
   #dsmom041#45 = #camocab1#46;
   #dsmom041#46 = #camocab1#47;
   #dsmom041#47 = #camocab1#48;
   #dsmom041#48 = #camocab1#49;
   #dsmom041#49 = #camocab1#50;
   #dsmom041#53 = #camocab1#51;
   #dsmom041#54 = #camocab1#52;

   #dsmom041#55 = #camocab1#53;
   #dsmom041#56 = #camocab1#54;
   #dsmom041#57 = #camocab1#55;

   #dsmom041#59 = nLib_am;
   #dsmom041#60 = nDoc_am;
   #dsmom041#61 = aSer_am;
   #dsmom041#62 = nFra_am;

   |SI estado = 0;
      |GRABA 011#dsmom041.a;
      |LIBERA #dsmom041;
   |SINO;
      |GRABA 011#dsmom041.n;
      |LIBERA #dsmom041;
   |FINSI;

   |ABRE #dsmom042;
   #dsmom042#0 = #dsmom041#0;
   #dsmom042#1 = enActividad;
   #dsmom042#2 = #dsmom041#2;
   #dsmom042#3 = #dsmom041#3;
   #dsmom042#4 = #camocab1#24;
   |LEE 000#dsmom042.=;
   estado = FSalida;
   #dsmom042#0 = #dsmom041#0;
   #dsmom042#1 = enActividad;
   #dsmom042#2 = #dsmom041#2;
   #dsmom042#3 = #dsmom041#3;
   #dsmom042#4 = #camocab1#24;

   #dsmom042#5 = #camocab1#25; #dsmom042#6 = #camocab1#26; #dsmom042#7 = #camocab1#27;
   #dsmom042#8 = #camocab1#30; #dsmom042#9 = #camocab1#29; #dsmom042#10 = #camocab1#28;
   #dsmom042#11 = #camocab1#27; #dsmom042#12 = #camocab1#36;
   #dsmom042#13 = 0;
   #dsmom042#14 = nLib_am;
   #dsmom042#15 = aSer_am;
   #dsmom042#16 = nFra_am;
   |SI eaSubde = "S"; |Y #107#28 = "S";
       #dsmom042#18 = eaCodSubdep;
   |FINSI;
   |SI estado = 0;
      |GRABA 011#dsmom042.a;
      |LIBERA #dsmom042;
   |SINO;
      |GRABA 011#dsmom042.n;
      |LIBERA #dsmom042;
   |FINSI;
   |CIERRA #dsmom042;
   eaMoneda = aMonedaA; |HAZ Monedas;

   |SI #dsmom041#41 = "S";
       |ABRE #49;
       #dsmom049#0 = #dsmom041#0;
       #dsmom049#2 = #dsmom041#2;
       #dsmom049#3 = #dsmom041#3;
       #dsmom049#4 = 1;
       |LEE 101#49=;
       estado = FSalida;
       #dsmom049#0 = #dsmom041#0;
       #dsmom049#1 = #dsmom041#1;
       #dsmom049#2 = #dsmom041#2;
       #dsmom049#3 = #dsmom041#3;
       #dsmom049#4 = 1;
       #dsmom049#5 = enEjercicio;
       #dsmom049#6 = #dsmom041#27;
       #dsmom049#7 = #camocab1#36;
       #dsmom049#8 = #camocab1#28;
       |SI estado ! 0; #dsmom049#9 = 100; |FINSI;
       #dsmom049#11 = "C";
       #dsmom049#12 = "N";

      |SI estado = 0; |GRABA 020#49a; |FINSI;
      |SI estado ! 0; |GRABA 020#49b; |FINSI;
      |LIBERA #49;
      |CIERRA #49;
   |FINSI;
   eaMoneda = aMonedaA; |HAZ Monedas;
|FPRC;

|| ************************************************************************
|PROCESO tracod2;
   |SI #dsmom041#26 > "01.01.1900"; |Y #dsmom041#58 = 2;
       |MENAV "0000El Elemento Ya existe y esta vendido. ";
       sw_er = 2;
       |ACABA;
   |FINSI;
   |SI #dsmom041#40 = "I";
      |CONFI "0000El Elemento esta Inactivo. Continuar S/N";
      |SI FSalida ! 0;
          sw_er = 2;
          |ACABA;
      |FINSI;
   |FINSI;
   |SI #dsmom041#15 = 0; |Y #dsmom041#21 = 0;
       |SI nSwEncuentro = 0;
           |SI #dsmom041#27 = fec_am;
               |CONFI "2400NEl Elemento ya existe. ¨Desea ampliarlo? ";
           |SINO;
               |MENAV "0000El Elemento ya existe con otra fecha de compra";
               FSalida = 1;
           |FINSI;
           |SI FSalida ! 0;
               sw_er = 1;
               |CONFI "2400S¨Introducir otro codigo de Elemento? ";
               |SI FSalida = 0;
                   sw_er = 2;
               |FINSI;
               |ACABA;
           |FINSI;
           |HAZ lineas;
       |SINO;
           linea = nLinea;
           impcom = #dsmom041#10 - impcomA;
       |FINSI;
   |SINO;
      |MENAV "0000El Elemento Ya existe y se esta amortizando. ";
      sw_er = 2;
      |ACABA;
   |FINSI;
|FPRC;

|PROCESO vercom1;
   |SI enConverModelo ! 0;
       #dsmom042#07 = (#dsmom042#07 * enConverModelo ) ! enRedonModelo;
       #dsmom042#11 = (#dsmom042#11 * enConverModelo ) ! enRedonModelo;
       #dsmom042#13 = (#dsmom042#13 * enConverModelo ) ! enRedonModelo;
   |FINSI;

   linea = #dsmom042#4;
   |SI #dsmom042#6 ! "C"; |ACABA; |FINSI;
   impcom = impcom + #dsmom042#7;

   |PINTA 2107, #dsmom042#4;
   |PINTA 2112, #dsmom042#5;
   |PINTA 2118, #dsmom042#9;
   |PINTA 2130, #dsmom042#6;
   |PINTA 2133, #dsmom042#12;
   |PINTA 2137, #camocab1#28;
   |PINTA 2137, #dsmom042#10;
   |PINTA 2167, #dsmom042#7;
   |PINTA 2179, #dsmom042#8;

   |LIBERA #dsmom042;
|FPRC;

|DEFBUCLE vercom;
     #dsmom042#1;
     ;
     #dsmom041#0, #dsmom041#2, #dsmom041#3, 000;
     #dsmom041#0, #dsmom041#2, #dsmom041#3, 999;
     be;
     NULL, vercom1;
|FIN;

|PROCESO lineas;
   linea = 0;
   |BUCLE  vercom;

   linea = linea + 1;
   |CAMPO_POSICION #camocab1#24,0,p; p=p+100; |CAMPO_POSICION #camocab1#24,1,p;
   |CAMPO_POSICION #camocab1#25,0,p; p=p+100; |CAMPO_POSICION #camocab1#25,1,p;
   |CAMPO_POSICION #camocab1#26,0,p; p=p+100; |CAMPO_POSICION #camocab1#26,1,p;
   |CAMPO_POSICION #camocab1#27,0,p; p=p+100; |CAMPO_POSICION #camocab1#27,1,p;
   |CAMPO_POSICION #camocab1#28,0,p; p=p+100; |CAMPO_POSICION #camocab1#28,1,p;
   |CAMPO_POSICION #camocab1#29,0,p; p=p+100; |CAMPO_POSICION #camocab1#29,1,p;
   |CAMPO_POSICION #camocab1#30,0,p; p=p+100; |CAMPO_POSICION #camocab1#30,1,p;
   |CAMPO_POSICION #camocab1#36,0,p; p=p+100; |CAMPO_POSICION #camocab1#36,1,p;
|FPRC;

|PROCESO restaura;
   |SI linea = 1; |ACABA; |FINSI;

   |CAMPO_POSICION #camocab1#24,0,p; p=p-100; |CAMPO_POSICION #camocab1#24,1,p;
   |CAMPO_POSICION #camocab1#25,0,p; p=p-100; |CAMPO_POSICION #camocab1#25,1,p;
   |CAMPO_POSICION #camocab1#26,0,p; p=p-100; |CAMPO_POSICION #camocab1#26,1,p;
   |CAMPO_POSICION #camocab1#27,0,p; p=p-100; |CAMPO_POSICION #camocab1#27,1,p;
   |CAMPO_POSICION #camocab1#28,0,p; p=p-100; |CAMPO_POSICION #camocab1#28,1,p;
   |CAMPO_POSICION #camocab1#29,0,p; p=p-100; |CAMPO_POSICION #camocab1#29,1,p;
   |CAMPO_POSICION #camocab1#30,0,p; p=p-100; |CAMPO_POSICION #camocab1#30,1,p;
   |CAMPO_POSICION #camocab1#36,0,p; p=p+100; |CAMPO_POSICION #camocab1#36,1,p;
|FPRC;
|| ****************************************************************************

|RUTINA inf2camocab1;
   #dsmom040#0 = enEmpresa;
   #dsmom040#2 = 0001;
|FRUT;

|RUTINA sup2camocab1;
   #dsmom040#0 = enEmpresa;
   #dsmom040#2 = 9999;
|FRUT;

|CALCULO ElsGrups; |TIPO 6;
   |SI FSalida = 10;
      |ABRE #dsmom040;
      |CONSULTA_F_CLAVE #1#dsmom040,inf2camocab1,sup2camocab1;
      #camocab1#15 = #dsmom040#2; |PINTA #camocab1#15;
      |ERROR;
      |CIERRA #dsmom040;
   |FINSI;
|FCAL;

|CALCULO concepto; |TIPO 0;  || desde Campos conceptos
   enFilConc = 0;
   eaCuenta   = #camocab1#3;
   enConcepto = #camocab1#36;
   |HAZ FiltroConcepto;  |SI eswLect ! 0; |ACABA; |FINSI;
   |SI #camocab1#36 ! c_conp;
       #camocab1#28 = #dsmom030#1; |PINTA #camocab1#28;
   |FINSI;
|FCAL;

|| ******************************************************
|PROCESO Encuentro;
 |SI #dsmom042#9 ] fec1; |Y #dsmom042#9 [ fec2;
     nSwEncuentro = 1;
     aElemento    = #dsmom042#2;
     nNumero      = #dsmom042#3;
     nLinea       = #dsmom042#4;
     impcomA      = #dsmom042#7;
     impcomI      = #dsmom042#7;
     |ERROR10;
 |FINSI;
|FPRC;

|DEFBUCLE BuscoFact;
 #dsmom042#1;
 6,14,15,16;
 enEmpresa, "        ", 00, 001, "C", nLib_am, aSer_am, nFra_am;
 enEmpresa, "zzzzzzzz", 99, 999, "C", nLib_am, aSer_am, nFra_am;
 e;
 NULL, Encuentro;
|FIN;

|PROCESO BuscoFactura;
 impcomI = 0;
 nSwEncuentro = 0;
 |BUCLE BuscoFact;
 |SI nSwEncuentro = 1;
     |ABRE #dsmom041;
     #dsmom041#0 = enEmpresa;
     #dsmom041#2 = aElemento;
     #dsmom041#3 = nNumero;
     |LEE 001#dsmom041.=;
     |SI FSalida ! 0;
         nSwEncuentro = 0;
         |CIERRA #dsmom041;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom041;

     |SI #dsmom041#26 > "01.01.1900";
         |SI #dsmom041#58 = 2;
             aAlfa1 = "0000El Elemento Ya esta vendido. No Puede Modificar.";
         |SINO;
             aAlfa1 = "0000El Elemento esta de baja. No Puede Modificar.";
         |FINSI;
         nSwEncuentro = 2;
     |SINO;
         |SI #dsmom041#15 ! 0; |O #dsmom041#21 ! 0;
             aAlfa1 = "0000El Elemento Ya se esta amortizando. No Puede Modificar.";
             nSwEncuentro = 2;
         |FINSI;
     |FINSI;
     impcomI = (impcomI % #dsmom041#46) ! 2;
 |FINSI;
|FPRC;

|PROCESO anacta;
    |SI enSwAna = 0; |ACABA; |FINSI;
    |SI eaGAna = "S"; |ACABA; |FINSI; ||No existe reparto especifico

    enQueAna = 1;
    nSwGrupo = 0;
    eaElemento = #camocab1#0;
    enElemeNum = #camocab1#1;
    eaElemeNom = #camocab1#2;
    enElemeCom = #camocab1#7;
    eaGrAna    = #camocab1#39;
    |PUSHV 0622 2380;
    |SUB_EJECUTA_NP "anm00014";
    |POPV;
|FPRC;
