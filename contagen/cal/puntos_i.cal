|INCLUYE dscont_i;

|FICHEROS;
     cacuentl #69,MANTE;
     caclipr2 #71;
     canempre #30;
     :/modelos/def/dsmom030 #130;

     cacuetmp #200,MANTE;
     tmpcuen@ #1200;

     ca8cumay #403;

     camandia #333;      ||Mant. Diarios
|FIN;

|VARIABLES;
     &enSwVerbose = 0;
     &enSwFiltroOK = 0;

     aMensaje = "";
     &enDiarioNivel = -1;
    aMascara = "";
    nSaca = 0;
    aSaca = "";
    aBeta = "";
    aElCam23_1 = "";
    aElCam23_2 = "";

    p_lugar = 0;
    p_cuan3 = 0;
    p_cuan4 = 0;
    p_cuan5 = 0;
    p_alfa1 = "";
    p_alfa2 = "";
    p_alfa3 = "";
    p_alfa4 = "";
    p_alfa5 = "";
    p_alfa6 = "";
    p_nume1 = 0;
    p_nume2 = 0;
    p_nume3 = 0;
    p_ceros = "";
    p_error = 0;
    p_mensa1 = "0000LONGITUD DE CUENTA FUERA DE NIVEL!";
    p_mensa2 = "0000No Existe Cuenta Contable ";
    p_mensa3 = "0000Esta Cuenta NO tiene Pase Directo.";
    desdec1 = "";
    hastac1 = "";
    varia_cod = "";
    sw_nom = 0;
    cuen11 = "";
    cuen21 = "";
    cuen31 = "";
    num_campo = 0;
    p_nifs = "";

    aLong       = "";
    aTecla      = "";
    aDesde      = "";
    aHasta      = "";
    aAlfa       = "";
    aAlfa1      = "";
    aAlfa2      = "";
    aAlfa3      = "";
    aAlfa4      = "";
    aAlfa5      = "";
    aAlfa6      = "";
    aAste       = "";
    aAsteN      = "";
    aCadena     = "";
    aDNombre    = "";
    aHNombre    = "";
    aDCuenta    = "";
    aHCuenta    = "";
    nSwCompruNom69 = 0;
    aFichero    = "";
    aNif        = "";
    aBuscar1    = "";
    aBuscar2    = "";
    aCuenta     = "";
    aLetra      = "";
    aCeros      = "";
    aPunto      = "";
    aGuarda     = "";

    nCamp1 = 0;
    nCampo = 0;
    nLong  = 0;
    nPos   = 0;
    nNume  = 0;
    nNume1 = 0;

    &eaVarDni  = "";
    &enCalcCif = 0;
    &snFiltr   = "";
    &snFiltrA  = "";

    nSwFicha   = 0;
    nSwSi      = 0;

    nModo      = 0;
    nSwLibre   = 0;
    nSw400     = 0;
    nSw410     = 0;
    nSw523     = 0;
    nSw430     = 0;
    nSw440     = 0;
    nSwPulsab  = 0;
    nNumCtas   = 0;
    nRango     = 0;
    nVent      = 0;
    nGrid200   = 0;
    nGrid1200  = 0;

    aEsc1      = "";
    aEsc2      = "";
    aRetu      = "";
    aMas       = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

    &enDesdeX  = 0;
|FIN;

|PROCESO NombreMes;
  |SI NumMes = 0;  NombreMes = "Apertura  "; |FINSI;
  |SI NumMes = 1;  NombreMes = "Enero     "; |FINSI;
  |SI NumMes = 2;  NombreMes = "Febrero   "; |FINSI;
  |SI NumMes = 3;  NombreMes = "Marzo     "; |FINSI;
  |SI NumMes = 4;  NombreMes = "Abril     "; |FINSI;
  |SI NumMes = 5;  NombreMes = "Mayo      "; |FINSI;
  |SI NumMes = 6;  NombreMes = "Junio     "; |FINSI;
  |SI NumMes = 7;  NombreMes = "Julio     "; |FINSI;
  |SI NumMes = 8;  NombreMes = "Agosto    "; |FINSI;
  |SI NumMes = 9;  NombreMes = "Septiembre"; |FINSI;
  |SI NumMes = 10; NombreMes = "Octubre   "; |FINSI;
  |SI NumMes = 11; NombreMes = "Noviembre "; |FINSI;
  |SI NumMes = 12; NombreMes = "Diciembre "; |FINSI;
  |SI NumMes = 13; NombreMes = "Cierre    "; |FINSI;
|FPRC;

|PROCESO SacaNivel;
   eswCta = 1;     ||Errores en Cuenta
   aLong = eaCuenta;
   |QBF aLong;
   aLong = aLong % 0;
   nLong = aLong;
   enNivel = 0;
   |SI nLong = dig4; |Y dig4 ! 0; eswCta = 0; enNivel = 1; |FINSI;
   |SI nLong = dig5; |Y dig5 ! 0; eswCta = 0; enNivel = 2; |FINSI;
   |SI nLong = dig6; |Y dig6 ! 0; eswCta = 0; enNivel = 3; |FINSI;
   |SI nLong = dig7; |Y dig7 ! 0; eswCta = 0; enNivel = 4; |FINSI;
   |SI nLong = dig8; |Y dig8 ! 0; eswCta = 0; enNivel = 5; |FINSI;
   |SI nLong = dig9; |Y dig9 ! 0; eswCta = 0; enNivel = 6; |FINSI;

   |SI eswCta = 1; |Y  nLong ! 0;
       |SI emCta = 1;
           |MENAV p_mensa1;
           |ERROR;
       |FINSI;
   |SINO;
       |SI nLong = 0; |ACABA; |FINSI;

       ||Miro si tiene Mascara.
       |SI enDiarioNivel ! -1;
           |ABRE #camandia;
           #camandia#0 = enDiarioNivel;
           |LEE 000#camandia.=;
           |SI FSalida = 0;
                |SI #camandia#4 = "S";
                     aMascara = #camandia#7;
                     |QBF aMascara;
                     nSaca = (100 * #camandia#5) + #camandia#6;
                     aSaca = nSaca;
                     aBeta = eaCuenta % aSaca;
                     |SI aMascara ! aBeta;
                          |SI enSwVerbose = 1;
                               aMensaje = "0000Cuenta [" + eaCuenta + "] erronea para este diario";
                               |MENAV aMensaje;
                               |ERROR;
                          |SINO;
                               aMensaje = "0000Cuenta erronea para este diario";
                               |MENAV aMensaje;
                               |ERROR;
                          |FINSI;
                          enSwFiltroOK = 0;
                     |FINSI;
                |FINSI;
           |FINSI;
           |CIERRA #camandia;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO NoBlanca;|TIPO 6;
   |SI #Fichero@#Campo# = "            ";
       |MENAV "0000Introduzca una cuenta";
       |ERROR;
       |ACABA;
   |FINSI;
|FPRC;

|PROCESO FiltraCtaIG;
  eswLect = 0;
  |ABRE #dsmom030;
  |DDEFECTO #dsmom030;
  #dsmom030#0 = enConcepto;
  |LEE 000#dsmom030.=;
  |CIERRA #dsmom030;

  eswLect = 1;
  |SI #dsmom030#16 = "N"; |Y #dsmom030#17 = "N"; || No hay seleccion cuentas
      eswLect = 0;
  |FINSI;
  |SI #dsmom030#16 = "S";
      p_alfa4 = "COMPRAS Y GASTOS";  eswLect = 2;
      |PARA p_nume1 = 52; |SI p_nume1 [ 56; |HACIENDO p_nume1 = p_nume1 + 1;
            p_alfa2 = #dsmom030#p_nume1#; |QBT p_alfa2;
            |SI p_alfa2 ! "";
                p_alfa3 = p_alfa2 % 0;
                p_nume2 = p_alfa3; p_nume2 = 100 + p_nume2;
                p_alfa3 = p_nume2;
                p_alfa1 = eaCuenta % p_alfa3;
                |SI p_alfa1 = p_alfa2;
                    eswLect = 0;
                    |SAL;
                |FINSI;
            |FINSI;
       |SIGUE;
  |FINSI;

  |SI #dsmom030#17 = "S";
      p_alfa4 = "VENTAS E INGRESOS";  eswLect = 2;
      |PARA p_nume1 = 57; |SI p_nume1 [ 61; |HACIENDO p_nume1 = p_nume1 + 1;
            p_alfa2 = #dsmom030#p_nume1#; |QBT p_alfa2;
            |SI p_alfa2 ! "";
                p_alfa3 = p_alfa2 % 0;
                p_nume2 = p_alfa3; p_nume2 = 100 + p_nume2;
                p_alfa3 = p_nume2;
                p_alfa1 = eaCuenta % p_alfa3;
                |SI p_alfa1 = p_alfa2;
                    eswLect = 0;
                    |SAL;
                |FINSI;
            |FINSI;
       |SIGUE;
  |FINSI;

  |SI eswLect ! 0;
      p_alfa1 = "    ERROR. NO ESTA INTRODUCIENDO UNA CUENTA DE " + p_alfa4;
      |SI snFiltr ! "X";
          |MENAV p_alfa1;
      |FINSI;
      |SI snFiltr = "S";
          |ERROR;
      |SINO;
          eswLect = 0;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO FiltraCtaCP;
  eswLect = 0;
  |ABRE #dsmom030;
  |DDEFECTO #dsmom030;
  #dsmom030#0 = enConcepto;
  |LEE 000#dsmom030.=;
  |CIERRA #dsmom030;


  eswLect = 1;
  |SI #dsmom030#18 = "N"; |Y #dsmom030#19 = "N"; || No hay seleccion cuentas
      eswLect = 0;
  |FINSI;
  |SI #dsmom030#18 = "S";
      p_alfa4 = "PROVEEDORES";  eswLect = 2;
      |PARA p_nume1 = 62; |SI p_nume1 [ 66; |HACIENDO p_nume1 = p_nume1 + 1;
            p_alfa2 = #dsmom030#p_nume1#; |QBT p_alfa2;
            |SI p_alfa2 ! "";
                p_alfa3 = p_alfa2 % 0;
                p_nume2 = p_alfa3; p_nume2 = 100 + p_nume2;
                p_alfa3 = p_nume2;
                p_alfa1 = eaCuenta % p_alfa3;
                |SI p_alfa1 = p_alfa2;
                    eswLect = 0;
                    |SAL;
                |FINSI;
            |FINSI;
       |SIGUE;
  |FINSI;

  |SI #dsmom030#19 = "S";
      p_alfa4 = "CLIENTES";  eswLect = 2;
      |PARA p_nume1 = 67; |SI p_nume1 [ 71; |HACIENDO p_nume1 = p_nume1 + 1;
            p_alfa2 = #dsmom030#p_nume1#; |QBT p_alfa2;
            |SI p_alfa2 ! "";
                p_alfa3 = p_alfa2 % 0;
                p_nume2 = p_alfa3; p_nume2 = 100 + p_nume2;
                p_alfa3 = p_nume2;
                p_alfa1 = eaCuenta % p_alfa3;
                |SI p_alfa1 = p_alfa2;
                    eswLect = 0;
                    |SAL;
                |FINSI;
            |FINSI;
       |SIGUE;
  |FINSI;
  |SI eswLect ! 0;
      p_alfa1 = "    ERROR. NO ESTA INTRODUCIENDO UNA CUENTA DE " + p_alfa4;
      |SI snFiltr ! "X";
          |MENAV p_alfa1;
      |FINSI;
      |SI snFiltr = "S";
          |ERROR;
      |SINO;
          eswLect = 0;
      |FINSI;
  |FINSI;
|FPRC;


|| อออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ
|| RUTINAS DE LAS UTILIDADES DE LAS CUENTAS
|| อออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ

|PROCESO PintaUtilidades;
         |PUSHV 0501 2380;

         |BLANCO 0830 2380;
         |CUADRO 0830 2380;
         |ATRI R;
         |PINTA 0931, "           UTILIDADES EN LAS CUENTAS            ";
         |ATRI r;

         |ATRI I;
         |PINTA 1031, "XXX.a --> Alta Cuenta del grupo introducido + 1 ";
         |PINTA 1131, "XXX.u --> Presenta la ultima cuenta del grupo.  ";
         |PINTA 1231, "XXX.b --> Consulta de las cuentas del grupo     ";
         |PINTA 1331, "N*    --> Busqueda por Nombre como empieza.     ";
         |PINTA 1431, "T*    --> Busqueda por Nombre en cualquier sitio";
         |PINTA 1531, "          de la cadena.                         ";
         |PINTA 1631, "C*    --> Busqueda de Clientes por Nombre       ";
         |PINTA 1731, "P*    --> Busqueda de Proveedores por Nombre    ";
         |PINTA 1831, "F*    --> Busqueda de Clientes o Proveedores por";
         |PINTA 1931, "          NIF o CIF.                            ";
         |PINTA 2031, "F11   --> Consulta Directa en las Cuentas.      ";
         |ATRI i;

         |ATRI S;
         |PINTA 2231, "Nota XXX seria la cuenta del grupo ejemplo 430.b";
         |ATRI i;

         |LEETECLA aTecla;
         |POPV;
|FPRC;

|PROCESO PintaUtilidadesX;
     |VENTANA 0501, 1760, -1, 16, "Utilidades de las cuentas";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{13}}XXX.a", 0602, 0610, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Alta Cuenta del grupo introducido + 1", 0615, 0659, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}XXX.u", 0702, 0710, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Presenta la ultima cuenta del grupo", 0715, 0759, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}XXX.b", 0802, 0810, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Consulta de las cuentas del grupo", 0815, 0859, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}N*", 0902, 0910, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Busqueda por Nombre como empieza", 0915, 0959, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}T*", 1002, 1010, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Busqueda por Nombre en cualquier sitio de la cadena", 1015, 1059, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}C*", 1102, 1110, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Busqueda de Clientes por Nombre", 1115, 1159, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}P*", 1202, 1210, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Busqueda de Proveedores por Nombre", 1215, 1259, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}F*", 1302, 1310, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Busqueda de Clientes o Proveedores por NIF o CIF", 1315, 1359, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{13}}F11", 1402, 1410, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}Consulta Directa en las Cuentas", 1415, 1459, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{13}}Nota XXX seria la cuenta del grupo ejemplo 430.b", 1602, 1659, NULL;

     |LEETECLA aTecla;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|RUTINA ClaveBaja69C;
    #69#3 = "S";
    #69#0 = aDesde;
|FRUT;

|RUTINA ClaveAlta69C;
    #69#3 = "S";
    #69#0 = aHasta;
|FRUT;

|RUTINA ClaveBaja69N;
    #69#3 = "S";
    #69#2 = aDNombre;
    #69#0 = aDCuenta;
|FRUT;

|RUTINA ClaveAlta69N;
    #69#3 = "S";
    #69#2 = aHNombre;
    #69#0 = aHCuenta;
|FRUT;

|PROCESO ClaveBaja200N;
    #200#0 = "            ";
    #200#1 = " " * 36;
|FPRC;

|PROCESO ClaveAlta200N;
    #200#0 = "zzzzzzzzzzzz";
    #200#1 = "z" * 36;
|FPRC;

|PROCESO ClaveBaja200F;
    #200#0 = "            ";
    #200#2 = " " * 12;
|FPRC;

|PROCESO ClaveAlta200F;
    #200#0 = "zzzzzzzzzzzz";
    #200#2 = "z" * 12;
|FPRC;

|PROCESO CompruNom69;
     |SI aBuscar1 ! "";
          aAlfa6 = #69#2 - aBuscar1;
          |SI aAlfa6 ! #69#2;
               nSwCompruNom69 = 1;
               |ERROR10;
          |FINSI;
     |SINO;                        || si viene vacio cualquier registro vale
          nSwCompruNom69 = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CompruNom69;
 #69#7;
 ;
 "S", aDNombre, aDCuenta;
 "S", aHNombre, aHCuenta;
 ;
 NULL, CompruNom69;
|FIN;

|PROCESO z200Tipo5;  |TIPO 5;
       |LEE 040#200p;
       #200#4 = " ";
       |LINEAS_BI_ATRI #200#4, N, S, -1;
       |SI aAsteN = "+";
           |ATRI R;
           |PINTA 666, "E";
           |ATRI 0;
       |FINSI;
|FPRC;

|PROCESO Tipo7cuetmp; |TIPO 7;
  |SI nSwLibre = 1;
      nModo = (FEntrada / 100) ! 0;
      |SI nModo = 1; |Y nSwPulsab = 0;
          #200#0 = ""; |PINTA #200#0;
      |FINSI;
  |FINSI;
  nSwPulsab = 0;
|FPRC;

|PROCESO PulsaIntro;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 1; |Y nSwLibre = 1; |Y Campo = 0;
         nSwPulsab = 0;
         aAlfa1    = #200#0 - "*";
         |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
         aAlfa2    = #200#0 > " ";
         aAlfa1    = aAlfa2 - "B";
         |SI FSalida ! 0; nSwPulsab = 1; |FINSI;
         aAlfa1    = aAlfa2 - "U";
         |SI FSalida ! 0; nSwPulsab = 1; |FINSI;

         aAlfa2    = "";
         eaElCam23 = "P";
         aAlfa1    = #200#0 % 102;
         |SI aAlfa1= "43"; |O aAlfa1 = "44"; eaElCam23 = "C"; |FINSI;
         eaCuenta = #200#0; |HAZ PorPuntos1;

         #200#0 = eaCuenta; |PINTA #200#0;
         |SI nSwPulsab = 1;
             |ERROR;
         |SINO;
              nSwSi = 1;
              |ERROR;
              |PTEC 807;
         |FINSI;

     |SINO;

         nSwSi = 1;
         |ERROR;
         |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO ConsultaPorCodigo;
     aDesde = aAlfa2;  |QBF aDesde;
     aDesde = (aDesde + "            ") % 112;

     aHasta = aAlfa2;  |QBF aHasta;
     aHasta = (aHasta + "zzzzzzzzzzzz") % 112;

     |PUSHV 0501 2380;
     |ENTLINEAL #6#69, -2, 4, 22, 1, ClaveBaja69C, ClaveAlta69C;
     |POPV;
|FPRC;

|PROCESO ConsultaPorCodigoX;
     aDesde = aAlfa2;  |QBF aDesde;
     aDesde = (aDesde + "            ") % 112;

     aHasta = aAlfa2;  |QBF aHasta;
     aHasta = (aHasta + "zzzzzzzzzzzz") % 112;

     |ABRE #69;
     |CONSULTA_F_CLAVE #6#69, ClaveBaja69C, ClaveAlta69C;
     |CIERRA #69;
|FPRC;

|PROCESO PidePatron;
     |PUSHV 0501 2380;
     |BLANCO 1530 1980;
     |CUADRO 1530 1980;
     |ATRI R;
     |PINTA 1631, "  INTRODUZCA LA CADENA A BUSCAR (EN BLANCO TODO) ";
     |ATRI r;

     E_inf    = "";
     E_sup    = "40";
     aBuscar1 = "      <Patron con el que buscar>        ";
     aBuscar1 = 1838 ? 1;

     |SI aBuscar1 = "      <Patron con el que buscar>        ";
         aBuscar1 = "";
     |FINSI;

     |POPV;

     |QBF aBuscar1;
|FPRC;

|PROCESO PidePatronX;
     |VENTANA 0501, 0542, -1, 16, "Introduzca el patrขn con el que buscar";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     E_inf    = "";
     E_sup    = "40";
     aBuscar1 = "      <Patron con el que buscar>        ";
     aBuscar1 = 0502 ? 1;

     |SI aBuscar1 = "      <Patron con el que buscar>        ";
         aBuscar1 = "";
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |QBF aBuscar1;
|FPRC;

|PROCESO PidePatronF;
     |SI aAsteN = "+";
         aBuscar2 = eaCodNif;
         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     |BLANCO 1530 1980;
     |CUADRO 1530 1980;
     |ATRI R;
     |MENSA "0000 Pulse <F2> Calculo la Letra del NIF o Comprobacion del CIF";
     |PINTA 1631, "  INTRODUZCA EL NIF/CIF A BUSCAR (EN BLANCO TODO)";
     |ATRI r;

     E_inf    = "";
     E_sup    = "12";
     aBuscar2 = "   <Patron> ";
     |PARA; |SI; |HACIENDO;
            aBuscar2 = 1848 ? 1;
            |SI FSalida = 10;
                eaVarDni  = aBuscar2;
                enCalcCif = 1;
                |HAZ CalculoDNI;
                aBuscar2  = eaVarDni;
            |SINO;
                |SAL;
            |FINSI;
     |SIGUE;

     |SI aBuscar2 = "   <Patron> ";
         aBuscar2 = "";
     |FINSI;

     |MENSA "0000                                                           ";
     |POPV;

     |QBF aBuscar2;
     aBuscar2 = aBuscar2 > " ";
|FPRC;

|PROCESO PidePatronFX;
     |SI aAsteN = "+";
         aBuscar2 = eaCodNif;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0755, -1, 16, "Introduzca el NIF/CIF a buscar (En blanco todo)";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{11}} Pulse <F2> Calculo la Letra del NIF o Comprobacion del CIF", 0502, 0554, NULL;

     E_inf    = "";
     E_sup    = "12";
     aBuscar2 = "   <Patron> ";
     |PARA; |SI; |HACIENDO;
            aBuscar2 = 0720 ? 1;
            |SI FSalida = 10;
                eaVarDni  = aBuscar2;
                enCalcCif = 1;
                |HAZ CalculoDNI;
                aBuscar2  = eaVarDni;
            |SINO;
                |SAL;
            |FINSI;
     |SIGUE;

     |SI aBuscar2 = "   <Patron> ";
         aBuscar2 = "";
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |QBF aBuscar2;
     aBuscar2 = aBuscar2 > " ";
|FPRC;

|PROCESO ConsultaPorNombre;
     aDNombre = aBuscar1;
     aHNombre = aBuscar1;
     aHNombre = aHNombre + "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     aHNombre = aHNombre % 0136;
     aDCuenta = "1           ";
     aHCuenta = "999999999999";

     |PUSHV 0501 2380;
     nSwCompruNom69 = 0;
     |BUCLE CompruNom69;
     |SI nSwCompruNom69 = 0;
          |SI aBuscar1 ! "";
               |AVISO;
               |CONFI "0000SNo se encuentran coincidencias. Mostrar todo? ";
               |SI FSalida = 0;
                    aDNombre = "";
                    aHNombre = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz" % 0136;
                    ||ENTLINEAL #7#69, -2, 4, 22, 1, ClaveBaja69N, ClaveAlta69N;
                    |ABRE #69; |CONSULTA_F_CLAVE #7#69, ClaveBaja69N, ClaveAlta69N; |CIERRA #69;
               |FINSI;
          |SINO;
               |MENAV "0000No se encuentran cuentas.";
          |FINSI;
     |SINO;
          ||ENTLINEAL #7#69, -2, 4, 22, 1, ClaveBaja69N, ClaveAlta69N;
          |ABRE #69; |CONSULTA_F_CLAVE #7#69, ClaveBaja69N, ClaveAlta69N; |CIERRA #69;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO LeeNif;
     eaElCam23 = "";
     aNif      = "";
     nSwFicha  = 0;

     aElCam23_1 = "P";
     aElCam23_2 = "C";
     |SI aAlfa1 ! "400"; |Y aAlfa1 ! "410"; |Y aAlfa1 ! "523";
         aElCam23_1 = "C";
         aElCam23_2 = "P";
     |FINSI;

     |ABRE #71;
     #71#23 = aElCam23_1;
     #71#10 = #69#0;
     #71#11 = #69#1;
     |LEE 040#71=;
     |SI FSalida = 0;
         aNif      =  #71#9;
         nSwFicha  = 1;
         eaElCam23 = #71#23;
     |SINO;
         #71#23 = aElCam23_2;
         #71#10 = #69#0;
         #71#11 = #69#1;
         |LEE 040#71=;
         |SI FSalida = 0;
             aNif      = #71#9;
             nSwFicha  = 1;
             eaElCam23 = #71#23;
         |FINSI;
     |FINSI;
     |CIERRA #71;
|FPRC;

|PROCESO GrabaTrabajo;
     |SI #69#3 ! "S";                             |ACABA;  |FINSI;
     |SI #69#0 < aDCuenta;  |O #69#0 > aHCuenta;  |ACABA;  |FINSI;

     aAlfa1 = #69#0 % 103;
     |SI aAste = "P*";
          |SI aAlfa1 ! "400"; |Y aAlfa1 ! "410"; |Y aAlfa1 ! "523";
              |ACABA;
          |FINSI;
     |FINSI;

     |HAZ LeeNif;

     |SI aAste = "F*";  |Y aBuscar2 ! "";
         aLong  = aBuscar2 % 0;
         nLong  = aLong;
         nPos   = 100 + nLong;
         aAlfa1 = aNif % nPos;
         |SI aAlfa1 ! aBuscar2;  |ACABA;  |FINSI;
     |FINSI;

     |SI aAste ="F*"; |Y nSwFicha = 0;
         |ACABA;                          || No tengo ficha Cliente/Proveedor
     |FINSI;

     |DDEFECTO #200;
     #200#0 = #69#0;
     #200#1 = #69#2;
     #200#2 = aNif;
     #200#3 = eaElCam23;
     #200#4 = "";
     |GRABA 040#200n;
     |LIBERA #200;
     nNumCtas = nNumCtas + 1;

     aAlfa1 = #200#0 % 103;
     |SI aAlfa1 = "400"; nSw400 = 1; |FINSI;
     |SI aAlfa1 = "410"; nSw410 = 1; |FINSI;
     |SI aAlfa1 = "430"; nSw430 = 1; |FINSI;
     |SI aAlfa1 = "440"; nSw440 = 1; |FINSI;
     |SI aAlfa1 = "523"; nSw523 = 1; |FINSI;
|FPRC;

|DEFBUCLE cacuentlT;
     #69#2;
     ;
     INICIO;
     FINAL;
     f;
     NULL, GrabaTrabajo;
|FIN;

|DEFBUCLE cacuentl;
     #69#7;
     ;
     "S", aDNombre, aDCuenta;
     "S", aHNombre, aHCuenta;
     ;
     NULL, GrabaTrabajo;
|FIN;

|PROCESO PorPuntos1;
     aPunto = eaCuenta - ".";
     |HAZ PorPuntos;
     |SI nSwPulsab = 0;
         |DDEFECTO #200;
         #200#0 = eaCuenta;
         #200#1 = eaNomCta;
         #200#2 = aBuscar2;
         #200#3 = eaElCam23;
         #200#4 = "N";
         |GRABA 040#200n;
         |LIBERA #200;
         nNumCtas = nNumCtas + 1;
     |FINSI;
|FPRC;

|PROCESO Alta200Varios;
     |SI aTipoIVA ! "R";
         eaElCam23 = "P";
         |SI nSw400 = 1; |O nSw410 = 1; |O nSw523 = 1;
             |ACABA;
         |FINSI;
         |SI nSw400 = 0; eaCuenta = "4000.a      "; |HAZ PorPuntos1; |FINSI;
         |SI nSw410 = 0; eaCuenta = "4100.a      "; |HAZ PorPuntos1; |FINSI;
         |SI nSw523 = 0; eaCuenta = "5230.a      "; |HAZ PorPuntos1; |FINSI;
     |FINSI;
     |SI aTipoIVA ! "S";
         eaElCam23 = "C";
         |SI nSw430 = 1; |O nSw440 = 1;
             |ACABA;
         |FINSI;
         |SI nSw430 = 0; eaCuenta = "4300.a      "; |HAZ PorPuntos1; |FINSI;
         |SI nSw440 = 0; eaCuenta = "4400.a      "; |HAZ PorPuntos1; |FINSI;
     |FINSI;
|FPRC;

|PROCESO HazTrabajo;
     aFichero = ("2c" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #200 aFichero;
     |ABRE #200;  |CIERRA #200;  |DELINDEX #200;

     |SI aAste = "T*";
         aAsteN = "";
         |HAZ PidePatron;
         aDCuenta = "            ";
         aHCuenta = "zzzzzzzzzzzz";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     |SI aAste = "C*";
         aAsteN = "";
         |HAZ PidePatron;
         aDCuenta = "4300        ";
         aHCuenta = "449999999999";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     |SI aAste = "P*";
         aAsteN = "";
         |HAZ PidePatron;
         aDCuenta = "4000        ";
         aHCuenta = "523999999999";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     |SI aAste = "F*";
         |HAZ PidePatronF;
         aDCuenta = "            ";
         aHCuenta = "zzzzzzzzzzzz";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     nSw400 = 0;
     nSw410 = 0;
     nSw430 = 0;
     nSw440 = 0;
     nSw523 = 0;
     nNumCtas = 0;
     nSwLibre = 0;
     |ABRE #200;
     |SI aBuscar1 ! "";
         FSalida = aBuscar1;
         |BUCLE cacuentlT;
     |SINO;
         |BUCLE cacuentl;
     |FINSI;
     |SI aAsteN = "+";
         |HAZ Alta200Varios;
         nSwLibre = 1;
     |FINSI;
     |CIERRA #200;

     |SI nNumCtas = 1; |Y aAsteN = "+";
         nSwSi = 1;
         |DELINDEX #200;
         |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     nSwSi = 0;
     |SI aAste ! "F*"; |O aAsteN = "+";
         |SI aAsteN = "+";
             |C_V #200#4, 1, "S";
             |C_A #200#1, 1, 34;
             nSwPulsab = 0;
             |ENTLINEAL #2#200, -1, 2, 22, 1, ClaveBaja200N, ClaveAlta200N; ||aqui
         |SINO;
             |C_V #200#4, 1, "N";
             |C_A #200#1, 1, 80;
             |ENTLINEAL #2#200, -1, 4, 22, 1, ClaveBaja200N, ClaveAlta200N;
         |FINSI;
     |SINO;
         |ENTLINEAL #3#200, -1, 4, 22, 1, ClaveBaja200F, ClaveAlta200F;
     |FINSI;
     |POPV;

     |DELINDEX #200;
|FPRC;

|PROCESO AltaUltima;
     |ABRE #69;
     nNume   = aAlfa2;
     nNume   = nNume + 1;
     aCuenta = nNume;
     #69#0 = aCuenta;
     #69#1 = "0";
     |LEE 041#69];
     |SI FSalida ! 0;
         |LEE 041#69u;
     |SINO;
         |LEE 041#69a;
         |SI FSalida ! 0;
             |LEE 041#69p;
         |SINO;
             |PARA; |SI #69#3 = "N"; |HACIENDO;
                    |LEE 041#69a;
                    |SI FSalida ! 0; |LEE 041#69p; |SAL; |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     aLong  = aAlfa2 % 0;
     nLong  = aLong;
     nPos   = nLong + 100;
     aAlfa1 = #69#0 % nPos;
     |SI aAlfa1 = aAlfa2;
         nNume = #69#0;
         |SI aLetra = "A";
              nNume = nNume + 1;
         |FINSI;
         aAlfa5 = nNume;
     |SINO;
         aCeros = "0" * nLong;
         aAlfa5 = aAlfa2 + aAlfa4 + "1";
     |FINSI;

     |DDEFECTO #69;
|FPRC;

|PROCESO PorPuntos;
     nNume1 = FSalida;
     nPos   = 100 + (((nNume1 / 100) ! 0) -1);
     aAlfa2 = eaCuenta % nPos;   |QBF aAlfa2;
     nPos   = (((nNume1 / 100) ! 0) * 100) + 199;
     aAlfa3 = eaCuenta % nPos;   |QBF aAlfa3;

     FSalida = nNume1;
     |PARA; |SI FSalida ! 0; |HACIENDO;
           aAlfa3 = aAlfa3 - "."; || limpiar mas puntos (los ignoramos)
     |SIGUE;

     nPos   = MaximoDigitos - ( (A \ aAlfa2 % 0) + (A \ aAlfa3 % 0));
     aAlfa4 = (A\ "0" * nPos);

     aLetra = (aAlfa3 % 101) > " ";
     |SI aLetra = "U";  |O aLetra = "A";
         |HAZ AltaUltima;
         eaCuenta = aAlfa5;
     |SINO;
         |SI aLetra = "B";
             nCampo   = Campo;
             |HAZ ConsultaPorCodigo;
             Campo    = nCampo;
             eaCuenta = #69#0;
             |SI nSwPulsab = 0;
                 |ERROR;
             |FINSI;
         |SINO;
             eaCuenta  = (A\ aAlfa2 + aAlfa4 + aAlfa3);
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO FiltraPuntos; |TIPO 6;
     |SI salidas = 20;
         |HAZ PintaUtilidades;
         salidas = 0;
         |ERROR;
         |ACABA;
     |FINSI;

     nSwLibre = 0;
     aGuarda = FSalida;
     |SI eaCuenta = "            "; |ACABA; |FINSI;

     aBuscar1 = "";
     aBuscar2 = "";
     aAste    = (eaCuenta % 102) > " ";

     aAsteN   = eaCuenta % 301;           ||permite Alta en NIF
     |SI eaCodNif = ""; aAsteN   = ""; |FINSI;

     |SI aAste = "N*";
         aAsteN = "";
         nCampo   = Campo;
         |HAZ PidePatron;
         |HAZ ConsultaPorNombre;
         Campo    = nCampo;
         eaCuenta = #69#0;
         FSalida  = aGuarda;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI aAste = "T*";  |O aAste = "C*";  |O aAste = "P*";  |O aAste = "F*";
         nCampo   = Campo;
         |HAZ HazTrabajo;
         Campo     = nCampo;
         eaCuenta  = #200#0;
         eaNomCta  = #200#1;
         eaElCam23 = #200#3;
         FSalida  = aGuarda;
         |SI nSwSi = 0;
             eaCuenta = "";
         |FINSI;
         |ERROR;
         |ACABA;
     |FINSI;

     aPunto = eaCuenta - ".";
     |SI FSalida ! 0;
         |HAZ PorPuntos;
     |FINSI;

     FSalida = aGuarda;
|FPRC;

|PROCESO Evento200;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#200=;
     |FINSI;

     |SI FSalida = 4;
         nSwSi = 1;
         |PTEC 806;
     |FINSI;
|FPRC;


|PROCESO HazTrabajoX;
     aFichero = ("2c" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #200 aFichero;
     |ABRE #200;  |CIERRA #200;  |DELINDEX #200;

     |SI aAste = "T*";
         aAsteN = "";
         |HAZ PidePatronX;
         aDCuenta = "            ";
         aHCuenta = "zzzzzzzzzzzz";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     |SI aAste = "C*";
         aAsteN = "";
         |HAZ PidePatronX;
         aDCuenta = "4300        ";
         aHCuenta = "449999999999";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     |SI aAste = "P*";
         aAsteN = "";
         |HAZ PidePatronX;
         aDCuenta = "4000        ";
         aHCuenta = "523999999999";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     |SI aAste = "F*";
         |HAZ PidePatronFX;
         aDCuenta = "            ";
         aHCuenta = "zzzzzzzzzzzz";
         aDNombre = " " * 36;
         aHNombre = "z" * 36;
     |FINSI;

     nSw400 = 0;
     nSw410 = 0;
     nSw430 = 0;
     nSw440 = 0;
     nSw523 = 0;
     nSwLibre = 0;
     nNumCtas = 0;
     |ABRE #200;
     |SI aBuscar1 ! "";
         FSalida = aBuscar1;
         |BUCLE cacuentlT;
     |SINO;
         |BUCLE cacuentl;
     |FINSI;
     |SI aAsteN = "+";
         |HAZ Alta200Varios;
         nSwLibre = 1;
     |FINSI;
     |CIERRA #200;

      |SI nNumCtas = 1; |Y aAsteN = "+";
         nSwSi = 1;
         |DELINDEX #200;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2699, -1, 16, "Cuentas. Doble click en la cuenta para seleccionarla.";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #200;
     nRango = 4 + 8 + 16 + 32 + 128;

     nSwSi = 0;
     |SI aAste ! "F*"; |O aAsteN = "+";
         |SI aAsteN = "+";
             nSwPulsab = 0;
             |C_V #200#4, 1, "S";
             |C_A #200#1, 1, 34;
             nRango = 1 + 4 + 8 + 16 + 32 + 128;
         |SINO;
             |C_V #200#4, 1, "N";
             |C_A #200#1, 1, 80;
             nRango = 4 + 8 + 16 + 32 + 128;
         |FINSI;

         |LINEAL_SIMPLE #2#200, nRango, 0502, 2498, ClaveBaja200N, ClaveAlta200N, Evento200;
     |SINO;
         |LINEAL_SIMPLE #3#200, nRango, 0502, 2498, ClaveBaja200F, ClaveAlta200F, Evento200;
     |FINSI;

     nGrid200 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{002}}Cancelar," + nGrid200;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #200;  |DELINDEX #200;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO PorPuntosX;
     nNume1 = FSalida;
     nPos   = 100 + (((nNume1 / 100) ! 0) -1);
     aAlfa2 = eaCuenta % nPos;   |QBF aAlfa2;
     nPos   = (((nNume1 / 100) ! 0) * 100) + 199;
     aAlfa3 = eaCuenta % nPos;   |QBF aAlfa3;

     FSalida = nNume1;
     |PARA; |SI FSalida ! 0; |HACIENDO;
           aAlfa3 = aAlfa3 - "."; || limpiar mas puntos (los ignoramos)
     |SIGUE;

     nPos   = MaximoDigitos - ( (A \ aAlfa2 % 0) + (A \ aAlfa3 % 0));
     aAlfa4 = (A\ "0" * nPos);

     aLetra = (aAlfa3 % 101) > " ";
     |SI aLetra = "U";  |O aLetra = "A";
         |HAZ AltaUltima;
         eaCuenta = aAlfa5;
     |SINO;
         |SI aLetra = "B";
             nCampo   = Campo;
             |HAZ ConsultaPorCodigoX;
             Campo    = nCampo;
             eaCuenta = #69#0;
             |SI nSwPulsab = 0;
                 |ERROR;
             |FINSI;
         |SINO;
             eaCuenta  = (A\ aAlfa2 + aAlfa4 + aAlfa3);
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO Evento1200;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#1200=;
     |FINSI;

     |SI FSalida = 4;
         nSwSi = 1;
         |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO OtraCuenta;
     |VENTANA 0501, 0755, -1, 16, "Introduzca la cuenta que quiere aคadir al lineal";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{11}}  Ctrl-F2 Utilidades de la cuenta", 0502, 0554, NULL;

     E_inf    = "";
     E_sup    = "12";
     eaCuenta = "   <Patron> ";
     salidas  = 0;
     |PARA; |SI; |HACIENDO;
            eaCuenta = 0720 ? 1;
            |SI FSalida = 20;
                salidas = FSalida;
                |HAZ FiltraPuntosX;
            |SINO;
                |HAZ FiltraPuntosX;
                |SAL;
            |FINSI;
     |SIGUE;

     |QBF eaCuenta;
     |SI eaCuenta ! "";
         #1200#0 = eaCuenta;
         |LEE 000#1200=;
         |SI FSalida ! 0;
             |SI aTipoIVA ! "R";  eaElCam23 = "P";  |FINSI;
             |SI aTipoIVA ! "S";  eaElCam23 = "C";  |FINSI;

             |DDEFECTO #1200;
             #1200#0 = eaCuenta;
             #1200#1 = eaNomCta;
             #1200#2 = eaCodNif;
             #1200#3 = eaElCam23;
             #1200#4 = "N";

             |ABRE #69;
             #69#0 = eaCuenta;
             |LEE 000#69=;
             |SI FSalida = 0;
                 #1200#4 = "S";
             |FINSI;
             |CIERRA #69;

             |GRABA 020#1200n;
             |LIBERA #1200;

             |REFRESCACONTROL nGrid1200;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO cacuentlX;
     |SI #69#3 ! "S";                             |ACABA;  |FINSI;
     |SI #69#0 < aDCuenta;  |O #69#0 > aHCuenta;  |ACABA;  |FINSI;

     |SI aAste = "P*";
          aAlfa1 = #69#0 % 103;
          |SI aAlfa1 ! "400"; |Y aAlfa1 ! "410"; |Y aAlfa1 ! "523";
              |ACABA;
          |FINSI;
     |FINSI;

     |HAZ LeeNif;

     |SI aAste = "F*";  |Y aBuscar2 ! "";
         aLong  = aBuscar2 % 0;
         nLong  = aLong;
         nPos   = 100 + nLong;
         aAlfa1 = aNif % nPos;
         |SI aAlfa1 ! aBuscar2;  |ACABA;  |FINSI;
     |FINSI;

     |SI aAste ="F*"; |Y nSwFicha = 0;
         |ACABA;                          || No tengo ficha Cliente/Proveedor
     |FINSI;

     |DDEFECTO #1200;
     #1200#0 = #69#0;
     #1200#1 = #69#2;
     #1200#2 = aNif;
     #1200#3 = eaElCam23;
     #1200#4 = "";
     |GRABA 020#1200n;
     |LIBERA #200;
     nNumCtas = nNumCtas + 1;

     aAlfa1 = #1200#0 % 103;
     |SI aAlfa1 = "400"; nSw400 = 1; |FINSI;
     |SI aAlfa1 = "410"; nSw410 = 1; |FINSI;
     |SI aAlfa1 = "430"; nSw430 = 1; |FINSI;
     |SI aAlfa1 = "440"; nSw440 = 1; |FINSI;
     |SI aAlfa1 = "523"; nSw523 = 1; |FINSI;
|FPRC;

|DEFBUCLE cacuentlX;
     #69#7;
     ;
     "S", aDNombre, aDCuenta;
     "S", aHNombre, aHCuenta;
     ;
     NULL, cacuentlX;
|FIN;

|PROCESO PorPuntos1200;
     aPunto = eaCuenta - ".";
     |HAZ PorPuntos;
     |SI nSwPulsab = 0;
         |DDEFECTO #1200;
         #1200#0 = eaCuenta;
         #1200#1 = eaNomCta;
         #1200#2 = aBuscar2;
         #1200#3 = eaElCam23;
         #1200#4 = "N";
         |GRABA 020#1200n;
         |LIBERA #1200;
         nNumCtas = nNumCtas + 1;
    |FINSI;
|FPRC;

|PROCESO Alta1200Varios;
     |SI aTipoIVA ! "R";
         eaElCam23 = "P";
         |SI nSw400 = 1; |O nSw410 = 1; |O nSw523 = 1;
             |ACABA;
         |FINSI;
         |SI nSw400 = 0; eaCuenta = "4000.a      "; |HAZ PorPuntos1200; |FINSI;
         |SI nSw410 = 0; eaCuenta = "4100.a      "; |HAZ PorPuntos1200; |FINSI;
         |SI nSw523 = 0; eaCuenta = "5230.a      "; |HAZ PorPuntos1200; |FINSI;
     |FINSI;
     |SI aTipoIVA ! "S";
         eaElCam23 = "C";
         |SI nSw430 = 1; |O nSw440 = 1;
             |ACABA;
         |FINSI;
         |SI nSw430 = 0; eaCuenta = "4300.a      "; |HAZ PorPuntos1200; |FINSI;
         |SI nSw440 = 0; eaCuenta = "4400.a      "; |HAZ PorPuntos1200; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaTempoX;
     aBuscar2 = eaCodNif;
     aDCuenta = "            ";
     aHCuenta = "zzzzzzzzzzzz";
     aDNombre = " " * 36;
     aHNombre = "z" * 36;

     nSw400 = 0;
     nSw410 = 0;
     nSw430 = 0;
     nSw440 = 0;
     nSw523 = 0;

     nNumCtas = 0;
     |BUCLE cacuentlX;
     |HAZ Alta1200Varios;

     |SI nNumCtas = 1; |Y aAsteN = "+";
         nSwSi = 1;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2699, -1, 16, "Cuentas. Doble click en la cuenta para seleccionarla.";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     nRango = 4 + 8 + 16 + 32 + 128;
     nSwSi  = 0;
     |C_V #1200#4, 1, "S";
     |C_A #1200#1, 1, 34;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Otra cuenta", 2602, 2615, OtraCuenta;

     |LINEAL_SIMPLE #2#1200, nRango, 0502, 2498, NULL, NULL, Evento1200;
     nGrid1200 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{002}}Cancelar," + nGrid1200;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO TipoAnyadir;
     |DDEF aMas;  |QBF aMas;
     aMas = aMas + "cacuetmp.mas";
     |CARGA_DEF aMas, tmpcuen@;

     aFichero = ("2d" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #1200 aFichero;
     |ABRE #1200;  |CIERRA #1200;  |DELINDEX #1200;

     |ABRE #1200;
     nCampo   = Campo;
     |HAZ CreaTempoX;
     Campo     = nCampo;
     eaCuenta  = #1200#0;
     eaNomCta  = #1200#1;
     eaElCam23 = #1200#3;
     FSalida  = aGuarda;
     |SI nSwSi = 0;
         eaCuenta = "";
     |FINSI;

     |CIERRA #1200;
     |DELINDEX #1200;
     |DESCARGA_DEF #tmpcuen@;

     |ERROR;
     |ACABA;
|FPRC;

|PROCESO FiltraPuntosX; |TIPO 6;
     |SI salidas = 20;
         |HAZ PintaUtilidadesX;
         salidas = 0;
         |ERROR;
         |ACABA;
     |FINSI;

     nSwLibre = 0;
     aGuarda = FSalida;
     |SI eaCuenta = "            "; |ACABA; |FINSI;

     aBuscar1 = "";
     aBuscar2 = "";
     aAste    = (eaCuenta % 102) > " ";

     aAsteN   = eaCuenta % 301;           ||permite Alta en NIF
     |SI eaCodNif = ""; aAsteN   = ""; |FINSI;

     |SI aAste = "F*";  |Y aAsteN = "+";
         |HAZ TipoAnyadir;
         |ACABA;
     |FINSI;

     |SI aAste = "N*";
         aAsteN = "";
         nCampo   = Campo;
         |HAZ PidePatronX;
         |HAZ ConsultaPorNombre;
         Campo    = nCampo;
         eaCuenta = #69#0;
         FSalida  = aGuarda;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI aAste = "T*";  |O aAste = "C*";  |O aAste = "P*";  |O aAste = "F*";
         nCampo   = Campo;
         |HAZ HazTrabajoX;
         Campo     = nCampo;
         eaCuenta  = #200#0;
         eaNomCta  = #200#1;
         eaElCam23 = #200#3;
         FSalida  = aGuarda;
         |SI nSwSi = 0;
             eaCuenta = "";
         |FINSI;
         |ERROR;
         |ACABA;
     |FINSI;

     aPunto = eaCuenta - ".";
     |SI FSalida ! 0;
         |HAZ PorPuntosX;
     |FINSI;

     FSalida = aGuarda;
|FPRC;

|PROCESO LeeCtaSup;
   eaNomCtaSup = "";
   aAlfa1 = eaCuenta % 103;
   |SI aAlfa1 = "400"; |O aAlfa1 = "410"; |O aAlfa1 = "430"; |O aAlfa1 = "440";
       |ACABA;
   |FINSI;

   nNume1 = enNivel - 1;
   |SI nNume1 = 1; nNume = dig4; |FINSI;
   |SI nNume1 = 2; nNume = dig5; |FINSI;
   |SI nNume1 = 3; nNume = dig6; |FINSI;
   |SI nNume1 = 4; nNume = dig7; |FINSI;
   |SI nNume1 = 5; nNume = dig8; |FINSI;
   aAlfa1 = nNume;
   aAlfa1 = ("00" + aAlfa1) % -102;
   aAlfa1 = "1" + aAlfa1;
   aCuenta = eaCuenta % aAlfa1;

   |ABRE #69;
   #69#0 = aCuenta;
   |LEE 001#69=;
   |SI FSalida = 0;
       eaNomCtaSup = #69#2;
   |FINSI;
   |CIERRA #69;
|FPRC;

|PROCESO eLeeCtaMayor;
   eaNomCtaSup = "";
   aAlfa1 = eaCuenta % 105;
   |ABRE #403;
   #403#12 = enEjerBal;
   #403#10 = eNum2008;
   #403#0  = aAlfa1;
   |LEE 040#403=;
   |SI FSalida = 0;
       eaNomCtaSup = #403#9;
   |FINSI;
   |CIERRA #403;
|FPRC;
