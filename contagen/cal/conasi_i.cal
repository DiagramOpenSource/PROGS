|FICHEROS;
   caconasi #20;
   co2asie  #2;
   caconimp #808;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE dscont_i;

|RUTINA ajustaregistro;

   || No se bloquea la cabecera de asientos, sin embargo como para cualquier incremento
   || del contador de registros (cualquier nuevo asiento) ha de pasar por aqui y el contador
   || esta bloqueado, ya impide coincidencias.

   |ABRE #co2asie;

   |SELECT #4#co2asie;          ||N§ de registro es la clave 4.
   #co2asie#12 = #caconasi#2;
   |LEE 010#co2asie.=;
   |SI FSalida = 0;
      |LEE 010#co2asie.u;
      |SI FSalida ! 0;
          #caconasi#2 = 1;
      |SINO;
          #caconasi#2 = #co2asie#12 + 1;
      |FINSI;
   |SINO;
      |SI #caconasi#2 = 0;
          #caconasi#2 = 1;
      |FINSI;
   |FINSI;

   |SELECT #1#co2asie;
   |CIERRA #co2asie;
|FRUT;

|RUTINA ajustadocumento;
   |ABRE #co2asie;
   |SELECT #3#co2asie;

   #co2asie#2 = #caconasi#1;
   |LEE 010#co2asie.=;
   |SI FSalida = 0;
      |LEE 010#co2asie.u;
      |SI FSalida ! 0;
          #caconasi#1 = 1;
      |SINO;
          #caconasi#1 = #co2asie#2 + 1;
      |FINSI;
   |SINO;
      |SI #caconasi#1 = 0;
          #caconasi#1 = 1;
      |FINSI;
   |FINSI;

   |SELECT #1#co2asie;
   |CIERRA #co2asie;
|FRUT;

|PROCESO contador;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustadocumento;
   |HAZ ajustaregistro;

   |SI #caconasi#1 > 999999;
       |MENAV "    Atencion. El Numero de Documento es superior a 999.999, Revise la Contabilidad";
       #caconasi#1 = 1;
   |FINSI;
   nREGISTRO   = #caconasi#2;
   nDOCUMENTO  = #caconasi#1;
   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;

|PROCESO NuevoRegistro; || igual que contador pero no toca el numero de documento
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustaregistro;
   nREGISTRO   = #caconasi#2;
   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;


|PROCESO NuevoDoc;
   |SI dirfich0 ! "";
       |PATH_DAT #20  dirfich0;
       |PATH_DAT #2   dirfich0;
   |FINSI;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustadocumento;
   |SI #caconasi#1 > 999999;
       |MENAV "    Atencion. El Numero de Documento es superior a 999.999, Revise la Contabilidad";
       #caconasi#1 = 1;
   |FINSI;
   nDOCUMENTO  = #caconasi#1;
   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;

|PROCESO ActContador;  ||actualizacion exterior
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   #caconasi#2 = nREGISTRO;
   #caconasi#1 = nDOCUMENTO;
   |SI #caconasi#1 > 999999;
       |MENAV "    Atencion. El Numero de Documento es superior a 999.999, Revise la Contabilidad";
       #caconasi#1 = 1;
   |FINSI;

   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;

|PROCESO Multi_contador;
   |PATH_DAT #20  dirfich0;
   |PATH_DAT #2   dirfich0;
   |ABRE #20;
   |LEE 101#20p;
   |SI FSalida ! 0;
      |DDEFECTO #20;
      |GRABA 020#20n;
      |LEE 101#20p;
   |FINSI;
   |HAZ ajustadocumento;
   |HAZ ajustaregistro;

   |SI #caconasi#1 > 999999;
       |MENAV "    Atencion. El Numero de Documento es superior a 999.999, Revise la Contabilidad";
       #caconasi#1 = 1;
   |FINSI;
   nREGISTRO   = #caconasi#2;
   nDOCUMENTO  = #caconasi#1;

   |GRABA 020#20a;
   |LIBERA #20;
   |CIERRA #20;
|FPRC;

|PROCESO ActTesteo;
   |SI dirfich0 ! "";
       |PATH_DAT #808 dirfich0;
   |FINSI;

   |ABRE #808;
   |DDEFECTO #808;
   #808#0 = 1;
   |LEE 101#808=;
   |SI FSalida ! 0;
      |DDEFECTO #808;
      #808#0 = 1;
      |GRABA 020#808b;
   |FINSI;
   #caconimp#3 = "N";
   |GRABA  020#808a;
   |LIBERA #808;
   |CIERRA #808;
|FPRC;

|PROCESO NoTesteo;  ||para empresas de Analiticas Evitando el Recalculo
   |SI dirfich0 ! "";
       |PATH_DAT #808 dirfich0;
   |FINSI;

   |ABRE #808;
   #808#0 = 1;
   |LEE 101#808=;
   |SI FSalida ! 0;
       |DDEFECTO #808;
       #808#0 = 1;
       |GRABA 020#808b;
   |FINSI;
   #caconimp#2 = "N";
   #caconimp#3 = "S";
   |GRABA 020#808a;
   |LIBERA #808;
   |CIERRA #808;
|FPRC;
