|FICHEROS;
     cacoplis #0;   || Este
     canempre #1000;
|FIN;


|VARIABLES;
     aAlfa = "";
     Tecla = 0;

     org     = "";
     alfa1   = "";
     alfa2   = "";
     alfa3   = "";
     alfa4   = "";
     nume1   = 0;
     nume2   = 0;
     para1   = 0;

     dir       = "";
     dir_fich  = "";
     list      = "";
     empresa_o = "";
     empresa_d = "";
     swlistados = 0;
     nomlistado = "";
     field      = "";
     fichero1   = "";
     fichero2   = "";
|FIN;

|PROCESO mayus;
 alfa1 = #0Campo > " ";
 #0Campo = alfa1;
 |PINTA #0Campo;
|FPRC;

|PROCESO inicio; |TIPO 3;

 |SI #0#2 ! "SI"; |ACABA; |FINSI;

|| ........ Leer Directorios empresa_o y empresa_d;

  |DFICE empresa_o;
  |DBASE dir_fich;
  dir_fich = dir_fich + "fich/";
  dir = #0#0;  dir = "00000" + dir;  dir = dir % -105; dir = dir + #0#1;
  empresa_d = dir_fich + dir + "/";

  list  = "*.dir";
  |HAZ leecopia;
  list  = "lis*.*";
  |HAZ leecopia;
|FPRC;

|PROCESO leecopia;
  alfa4 = empresa_o + list;
  |_PDIR alfa4;
  |PARA; |SI FSalida = 0; |HACIENDO;
       alfa1 = alfa4 % 0;   nume1 = alfa1;
       |PARA para1 = nume1; |SI para1 ] 1; |HACIENDO para1 = para1 - 1;
             nume1 = (para1 * 100) + 1;
             alfa1 = alfa4 % nume1;
             |SI alfa1 = "/";
                 nume2 = para1 + 1;
                 |SAL;
             |FINSI;
       |SIGUE;
       nomlistado = alfa4 % nume2;
       |HAZ copiando;
       FSalida = 0;
   |_SDIR alfa4;
   |SIGUE;
|FPRC;

|PROCESO copiando;

 alfa3 = "2400Copiando " + nomlistado;
 |ATRI P;
 |MENSA alfa3;
 |ATRI 0;

 fichero1 = empresa_o + nomlistado;
 fichero2 = empresa_d + nomlistado;
 |COPIA_FICHERO fichero1, fichero2;
 |SI FSalida ! 0;
     alfa3 = "    Error [" + FSalida + "] en copia de ficheros ...";
     |MENAV alfa3;
 |FINSI;

 |ATRI N;
 |BLIN 24;
 |ATRI 0;
|FPRC;

|PROCESO MiraEmpresa;
   Tecla = FSalida;
   |SI Tecla = 2; |ACABA; |FINSI;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "fich/";
   |PATH_DAT #1000 aAlfa;
   |ABRE #canempre;
   |SI Tecla = 10;
      |CONSULTA_CLAVE #1#canempre;
      |SI FSalida = 0;
         #0#0 = #canempre#2; |PINTA #0#0;
         #0#1 = #canempre#3; |PINTA #0#1;
         |ERROR;
      |FINSI;
   |FINSI;

   #canempre#2 = #0#0;
   #canempre#3 = #0#1;
   |LEE 000#canempre.=;
   |SI FSalida ! 0;
      |MENAV "0000Empresa inexistente";
      |ERROR;
   |SINO;
       #0#3 = #canempre#1; |PINTA 1916, #0#3;
       |DBASE dir_fich; |QBF dir_fich;
       dir_fich = dir_fich + "fich/";
       dir = #0#0;  dir = "00000" + dir;  dir = dir % -105; dir = dir + #0#1;
       empresa_d = dir_fich + dir + "/";

       |MKDIR empresa_d;
       |SI FSalida = 0;
           |MENAV "    No existe directorio de la Empresa ";
           |RMDIR empresa_d;
           |ERROR;
       |FINSI;
   |FINSI;
   |CIERRA #canempre;
|FPRC;
