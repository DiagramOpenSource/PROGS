|| TENED EN CUENTA QUE SI SE MODIFICAN CAMPOS EN EL 'casieaca.def'
|| O EN EL 'casieali.def' HAY QUE HACER LO MISMO EN 'predecab.def'
|| Y EN 'predelin.def' RESPECTIVAMENTE

|FICHEROS;
   casieaca #0;     || predef. cabs.
   casieali #1;     || predef. lins.
   casieaax #2;     || consulta formato asiento (F1)
   cacuenta #4;     || cuentas
   calibros #10;    || libros
   cactrlal #11;    || control de altas otras empresas
   casieaaz #50,MANTE;  || copia de predefinidos (F2)
   canempre #30;

   :/modelos/def/dsmom030 #130;
|FIN;

|VARIABLES;
   &entrada = 1;
   modo = 0;
   nume1 = 0;
   cta         = 0;
   long        = "  ";
   cont        = 0;
   sw          = 0;
   contador    = 0;
   conta       = 0;
   x           = 0;
   digito      = 0;
   aster       = "";
   aster1      = "";
   cuenta      = "";

   &linea      = 0;
   &errorlin   = 0;
   &tipo       = "";
   &iva        = "";

   &numerica1  = 0;  &numerica2  = 0;  &numerica3  = 0;  &numerica4  = 0;
   &numerica5  = 0;  &numerica6  = 0;  &numerica7  = 0;  &numerica8  = 0;
   &numerica9  = 0;  &numerica10 = 0;  &numerica11 = 0;  &numerica12 = 0;
   &numerica13 = 0;  &numerica14 = 0;  &numerica15 = 0;  &numerica16 = 0;
   &numerica17 = 0;  &numerica18 = 0;  &numerica19 = 0;  &numerica20 = 0;
   &numerica21 = 0;  &numerica22 = 0;  &numerica23 = 0;  &numerica24 = 0;
   &numerica25 = 0;  &numerica26 = 0;

   &alfanume1  = ""; &alfanume2  = ""; &alfanume3  = ""; &alfanume4  = "";
   &alfanume5  = ""; &alfanume6  = ""; &alfanume7  = ""; &alfanume8  = "";
   &alfanume9  = ""; &alfanume10 = ""; &alfanume11 = ""; &alfanume12 = "";
   &alfanume13 = ""; &alfanume14 = ""; &alfanume15 = ""; &alfanume16 = "";
   &alfanume17 = ""; &alfanume18 = ""; &alfanume19 = ""; &alfanume20 = "";
   &alfanume21 = ""; &alfanume22 = ""; &alfanume23 = ""; &alfanume24 = "";
   &alfanume25 = ""; &alfanume26 = ""; &alfanume27 = "";

   &tipoiva = "";
   &tipocta = "";
   &tipoacu = "";
   seleccio = 0;
   &sw_oper1 = 0;
   &sw_oper2 = 0;
   &sw_acumu = 0;
   &sw_ivali = 0;

   posic = 0;
   mas = 0;
   lin_con = 0;
   alfa1 = "";

    aAlfa1 = "";
    &snFiltr     = "";
    &raf_empresa = 0;
    &raf_periodo = 0;
    &raf_ejercic = 0;
    &enOpAlta    = 1;
    &enPrAlta    = 0;
    &eaPrAlta    = "";
    nSwAlta      = 0;
    nModoEntrada = 0;

    &enLinFactu  = 0;
    &TipoIva     = "";
    nSwCopiar    = 0;
    &enNPred     = 0;
    nInkey       = 0;

    aAlfa        = "";
    aID          = "";
    nID          = 0;
 {40}aPopup      = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE cla340_i;

|PROCESO Tipo8; |TIPO 8;
 |HAZ inicio;
 |HAZ Analitica;
 |SI enSwAna = 0;
     |C_M #1#63,1,"N";
     |C_V #1#63,1,"N";
     |C_A #1#6,1,30;
 |FINSI;
|FPRC;

|PROCESO otro7; |TIPO 13;
 |SI enSwAna = 0;
     alfa1 = &205;
     |PINTA 1547, alfa1;
     |ATRI R; |PINTA 1646, "         ";|ATRI 0;
     |PINTA 2347, alfa1;
 |FINSI;
|FPRC;

|CALCULO LaCopia; |TIPO 7;
 |HAZ Sele_alta;
 |SI nSwAlta = 0;
     |MENSA "    Pulse <F2> para copiar Asiento Predefinido a otras Empresa";
 |SINO;
     |MENSA "    Este Asiento se copiara a otras Empresas segun Ctrl de Altas";
 |FINSI;
|FCAL;

|CALCULO ParaCopiar; |TIPO 0;
 nInkey = FSalida;
 |SI nInkey = 10; |Y nSwAlta = 0;
     nSwCopiar = 1;
     |ATRI P; |PINTA 0574, "COPIAR"; |ATRI 0;
 |FINSI;
|FCAL;

|PROCESO cuadro; |TIPO 7;
   |PUSHV 0901 2380;
   |CUADRO 0915 1580;
   |ATRI R;
   |PINTA 1016, " --- AL TERMINAR LA CONFECCION DEL ASIENTO NOS SITUAMOS EN ---  ";
   |PINTA 1116, " (0) N§ Predefinido; para seguir con el MISMO Documento         ";
   |PINTA 1216, " (1) Linea Apunte; incorporar apuntes sin salir del ASIENTO     ";
   |PINTA 1316, " (2) N§ Predefinido; SIGUIENTE Documento, mismo Diario  y Fecha ";
   |PINTA 1416, " (3) Diario; otro Asiento modificando Diario, Fecha y Documento ";
   |ATRI r;
|FPRC;

|PROCESO repon; |TIPO 0;
   |POPV;
|FPRC;

|PROCESO cheq_libro; |TIPO 0;

   |C_M #0Campo,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |ABRE #10;
   #calibros#0 = #casieaca#Campo#;
   |LEE 001#10=;
   |SI FSalida ! 0;  |DDEFECTO #10;  |FINSI;
   |CIERRA #10;
   |SI #calibros#2 ! "S"; |Y #casieaca#3 = "S"; |Y #casieaca#2 = "S";
      |MENAV "    ATENCION!!! Libro de I.V.A. Repercutido ...";
      |ERROR;
      |ACABA;
   |FINSI;
   |SI #calibros#2 ! "R"; |Y #casieaca#3 = "R"; |Y #casieaca#2 = "S";
      |MENAV "    ATENCION!!! Libro de I.V.A. Soportado ...";
      |ERROR;
      |ACABA;
   |FINSI;
   |SI #calibros#2 = "R"; |O #calibros#2 = "S";
       |C_M #0#18,1,"S";
       |SI #calibros#6 ! " ";
           #0#18 = #calibros#6; |PINTA #0#18;
           |C_M #0#18,1,"N";
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO modifi; |TIPO 0;

   |CAMPO_MODIFICA #casieaca#03, 1, "S";     || soportado/repercutido
   |CAMPO_MODIFICA #casieaca#04, 1, "S";     || libro iva
   |CAMPO_MODIFICA #casieaca#05, 1, "S";     || linea cuenta iva
   |CAMPO_MODIFICA #casieaca#06, 1, "S";     || cobros/pagos
   |CAMPO_MODIFICA #casieaca#09, 1, "S";     || signo
   |CAMPO_MODIFICA #casieaca#10, 1, "S";     || periodo
   |CAMPO_MODIFICA #casieaca#11, 1, "S";     || deducible
   |CAMPO_MODIFICA #casieaca#12, 1, "S";     || inversiones
   |CAMPO_MODIFICA #casieaca#16, 1, "S";     || Serie
   |CAMPO_MODIFICA #casieaca#18, 1, "S";     || Clave 340

   |SI #casieaca#2 = "N";
      |CAMPO_MODIFICA #casieaca#03, 1, "N";     || soportado/repercutido
      |CAMPO_MODIFICA #casieaca#04, 1, "N";     || libro iva
      |CAMPO_MODIFICA #casieaca#05, 1, "N";     || linea cuenta iva
      |CAMPO_MODIFICA #casieaca#06, 1, "N";     || cobros/pagos
      |CAMPO_MODIFICA #casieaca#09, 1, "N";     || signo
      |CAMPO_MODIFICA #casieaca#10, 1, "N";     || periodo
      |CAMPO_MODIFICA #casieaca#11, 1, "N";     || deducible
      |CAMPO_MODIFICA #casieaca#12, 1, "N";     || inversiones
      |CAMPO_MODIFICA #casieaca#16, 1, "N";     || Serie
      |CAMPO_MODIFICA #casieaca#18, 1, "N";     || Clave 340
      #casieaca#03 = "S";
      #casieaca#04 = 1;
      #casieaca#05 = 0;
      #casieaca#06 = "N";
      #casieaca#09 = 0;
      #casieaca#10 = "T";
      #casieaca#11 = "S";
      #casieaca#12 = "N";
      #casieaca#16 = "     ";
      #casieaca#18 = " ";
      |PINDA #0#0;
   |SINO;
      |SI #casieaca#15 < 2; #casieaca#15 = 3; |PINTA #casieaca#15; |FINSI;
   |FINSI;
|FPRC;

|PROCESO contra; |TIPO 0;
   |SI #casieaca#8 = "            "; |ACABA; |FINSI;
   cta  = #casieaca#8;
   long = cta % "0";
   cont = 0;
   sw   = 0;
   |SI long = dig4; sw = 1; #casieaca#9 = 1; |FINSI;
   |SI long = dig5; sw = 1; #casieaca#9 = 2; |FINSI;
   |SI long = dig6; sw = 1; #casieaca#9 = 3; |FINSI;
   |SI long = dig7; sw = 1; #casieaca#9 = 4; |FINSI;
   |SI long = dig8; sw = 1; #casieaca#9 = 5; |FINSI;
   |SI long = dig9; sw = 1; #casieaca#9 = 6; |FINSI;
   |SI sw = 0; #casieaca#9 = 9; |FINSI;

   |ABRE #4;
   #cacuenta#0 = #casieaca#8;
   #cacuenta#1 = #casieaca#9;
   |LEE 001#4=;
   |SI FSalida ! 0; |O #cacuenta#3 = "N";
      |MENAV "     Cuenta INEXISTENTE o NO tiene pase Directo";
      |ERROR;
   |FINSI;
   |CIERRA #4;
|FPRC;

|PROCESO verparti;
   |C_M #casieali#15,0,alfa1;
   |SI alfa1 = "N"; |ACABA; |FINSI;
   |SI #casieali#15 = #casieali#1;
      |MENAV "    ERROR.! Linea Contrapartida Incorrecta.";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO ayuda; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   linea   = #casieali#1;
   tipo    = #casieali#7;
   iva     = #casieaca#2;
   TipoIva = #casieaca#3;
   |HAZ carga;
   |SUB_EJECUTA_NP "casieaay";
   |SI errorlin = 0;
      |HAZ descarga;
   |SINO;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO descarga;
   #casieali#08 = numerica1;
   #casieali#09 = numerica2;
   #casieali#10 = numerica3;
   #casieali#11 = numerica4;
   #casieali#12 = numerica5;
   #casieali#13 = numerica6;
   #casieali#14 = numerica7;
   || #1#15 = numerica8;

   #casieali#16 = alfanume1;
   #casieali#17 = alfanume2;
   #casieali#18 = alfanume3;
   #casieali#19 = alfanume4;
   #casieali#20 = alfanume5;
   #casieali#21 = alfanume6;
   #casieali#22 = alfanume7;
   #casieali#23 = alfanume8;

   #casieali#24 = alfanume9;
   #casieali#25 = alfanume10;
   #casieali#26 = alfanume11;
   #casieali#27 = alfanume12;
   #casieali#28 = alfanume13;
   #casieali#29 = alfanume14;
   #casieali#30 = alfanume15;
   #casieali#31 = alfanume16;

   #casieali#32 = numerica9;
   #casieali#33 = numerica10;
   #casieali#34 = numerica11;
   #casieali#35 = numerica12;
   #casieali#36 = numerica13;
   #casieali#37 = numerica14;
   #casieali#38 = numerica15;
   #casieali#39 = numerica16;

   #casieali#40 = alfanume17;
   #casieali#41 = alfanume18;
   #casieali#42 = alfanume19;
   #casieali#43 = alfanume20;
   #casieali#44 = alfanume21;
   #casieali#45 = alfanume22;
   #casieali#46 = alfanume23;
   #casieali#47 = alfanume24;
   #casieali#56 = alfanume25;
   #casieali#59 = alfanume26;
   #casieali#64 = alfanume27;

   #casieali#48 = numerica17;
   #casieali#49 = numerica18;
   #casieali#50 = numerica19;
   #casieali#51 = numerica20;
   #casieali#52 = numerica21;
   #casieali#53 = numerica22;
   #casieali#54 = numerica23;
   #casieali#55 = numerica24;
   #casieali#57 = numerica25;

   #casieali#60 = numerica26;
|FPRC;


|PROCESO carga;
   enLinFactu = 0;
   |SI #casieaca#5 = #casieali#1; |Y #casieaca#2 = "S";
       enLinFactu = 1;
   |FINSI;
   numerica1  = #casieali#08;
   numerica2  = #casieali#09;
   numerica3  = #casieali#10;
   numerica4  = #casieali#11;
   numerica5  = #casieali#12;
   numerica6  = #casieali#13;
   numerica7  = #casieali#14;
   ||   numerica8  = #1#15;

   alfanume1  = #casieali#16;
   alfanume2  = #casieali#17;
   alfanume3  = #casieali#18;
   alfanume4  = #casieali#19;
   alfanume5  = #casieali#20;
   alfanume6  = #casieali#21;
   alfanume7  = #casieali#22;
   alfanume8  = #casieali#23;

   alfanume9  = #casieali#24;
   alfanume10 = #casieali#25;
   alfanume11 = #casieali#26;
   alfanume12 = #casieali#27;
   alfanume13 = #casieali#28;
   alfanume14 = #casieali#29;
   alfanume15 = #casieali#30;
   alfanume16 = #casieali#31;

   numerica9  = #casieali#32;
   numerica10 = #casieali#33;
   numerica11 = #casieali#34;
   numerica12 = #casieali#35;
   numerica13 = #casieali#36;
   numerica14 = #casieali#37;
   numerica15 = #casieali#38;
   numerica16 = #casieali#39;

   alfanume17 = #casieali#40;
   alfanume18 = #casieali#41;
   alfanume19 = #casieali#42;
   alfanume20 = #casieali#43;
   alfanume21 = #casieali#44;
   alfanume22 = #casieali#45;
   alfanume23 = #casieali#46;
   alfanume24 = #casieali#47;
   alfanume25 = #casieali#56;
   alfanume26 = #casieali#59;
   alfanume27 = #casieali#64;

   numerica17 = #casieali#48;
   numerica18 = #casieali#49;
   numerica19 = #casieali#50;
   numerica20 = #casieali#51;
   numerica21 = #casieali#52;
   numerica22 = #casieali#53;
   numerica23 = #casieali#54;
   numerica24 = #casieali#55;
   numerica25 = #casieali#57;

   numerica26 = #casieali#60;
|FPRC;

|PROCESO Ctali7; |TIPO 7;
 |SI #casieali#2 = "N";
     |MENSA "    Cuenta Contable Completa o en Blanco";
 |SINO;
     |MENSA "    <CON>-<CON*> contrapartida cl./pr. Final con '*' pregunta resto. (=) repite";
 |FINSI;
|FPRC;

|PROCESO cuentali; |TIPO 0;
   |CAMPO_MODIFICA #casieali#4, 1, "N";

   |SI #casieali#3 = "            "; |ACABA; |FINSI;

   |SI #casieali#2 = "N";
       cuenta = #casieali#3; |QBF cuenta;
       aster1 = cuenta % -101;
       |SI aster1 = "*";
           |MENAV "    Error.! Introduzca Cuenta completa o en Blanco";
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   contador = 0;
   cuenta = #casieali#3;
   |QBF cuenta;
   aster1 = cuenta % -101;
   |SI aster1 = "*";
      |HAZ contador2;
      |CAMPO_MODIFICA #casieali#4, 1, "S";
      |ACABA;
   |FINSI;

|FPRC;

|PROCESO contador2;
   contador = 0;
   conta = 0;
   cuenta = #casieali#3;
   |PARA x = 1; |SI x [ 12; |HACIENDO x = x + 1;
      conta = (x * 100) + 1;
      aster = cuenta % conta;
      |SI aster = "*"; contador = x; |FINSI;
   |SIGUE;
   conta = 100 + (contador - 1);
   cuenta = cuenta % conta;
   long = cuenta % 0;
|FPRC;

|PROCESO nodepar; |TIPO 7;
   |CAMPO_MODIFICA #casieali#58, 1, eaDepar;
|FPRC;

|PROCESO nosubde; |TIPO 7;
   |CAMPO_MODIFICA #casieali#62, 1, eaSubde;
|FPRC;

|PROCESO situate;
   |LEE 001#0=;
   |PINDA #0#0;
   |CAMPO_POSICION #casieaax#0,1,0847;
   |CAMPO_POSICION #casieaax#1,1,0860;
|FPRC;

|PROCESO correte;
   |CAMPO_POSICION #casieaax#0,0,posic; posic=posic+mas; |CAMPO_POSICION #casieaax#0,1,posic;
   |CAMPO_POSICION #casieaax#1,0,posic; posic=posic+mas; |CAMPO_POSICION #casieaax#1,1,posic;
|FPRC;

|PROCESO consulta2;
   lin_con = lin_con + 1;
   |SI #casieali#2 = "D";  #casieaax#0 = #casieali#3;  #casieaax#1 = "     --     ";  |FINSI;
   |SI #casieali#2 = "H";  #casieaax#0 = "     --     ";  #casieaax#1 = #casieali#3;  |FINSI;
   |PINDA #0#2;
   |SI lin_con < 12;
      mas = 100;
   |SINO;
      mas = -1100;
      lin_con = 0;
      |PAUSA;
      |PINPA #0#2;
   |FINSI;
   |HAZ correte;
|FPRC;

|PROCESO consulta; |TIPO 0;
   |SI FSalida = 9;
      |HAZ situate;
      |PUSHV 05451974;
      |PUSHV 19292374;
      lin_con = 0;
      |DDEFECTO #2;
      |PINPA #0#2;
      |PINPA #1#2;
      |SI #casieaca#2 = "S";
         |SI #casieaca#3 = "R";  #casieaax#2 = "IVA REPERCUTIDO";  |FINSI;
         |SI #casieaca#3 = "S";  #casieaax#2 = "IVA SOPORTADO  ";  |FINSI;
         |SI #casieaca#3 = "R";|Y #casieaca#6 = "S";  #casieaax#3 = "/COBROS";  |FINSI;
         |SI #casieaca#3 = "S";|Y #casieaca#6 = "S";  #casieaax#3 = "/PAGOS ";  |FINSI;
      |FINSI;
      |PINDA #1#2;
      |BUCLELIN 2consulta2#0;
      |SI lin_con = 0;
         |MENAV "    ATENCION!!! Cabecera sin lineas ...";
      |SINO;
         |PAUSA;
      |FINSI;
      |POPV;
      |POPV;
   |SINO;
      |SI FSalida = 10;
         |PUSHV 0501 2380;
         |PINPA #0#50;
         #casieaaz#0 = #casieaca#0;
         |PINDA #0#50;
         |ENDATOS #1#50;
         |SI FSalida = 0;
            |SI #casieaaz#0 ! #casieaaz#1;
                #casieaca#0 = #casieaaz#0;
                |LEE 000#0=;
                |SI FSalida = 0;
                    #casieaca#0 = #casieaaz#1;
                    |LEE 101#0=;
                    |SI FSalida = 0;
                        |AVISO;
                        |CONFI "    NRegrabar asiento predefinido destino YA EXISTENTE (S/N): ";
                        |SI FSalida = 0;
                           |BORRA 020#0a;
                           |BUCLELIN 1NULL#0;
                           |LIBERA #0;
                           |HAZ CopiaAsiento;
                        |SINO;
                           |MENAV "    Copia cancelada ...";
                        |FINSI;
                     |SINO;
                         |HAZ CopiaAsiento;
                     |FINSI;
               |SINO;
                  |MENAV "    Asiento predefinido origen inexistente ...";
               |FINSI;
            |SINO;
               |MENAV "    Error de entrada ...";
            |FINSI;
         |FINSI;
         |POPV;
         |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO CopiaAsientoL;
   #casieali#0 = #casieaaz#1;
   |GRABA 020#1n;
|FPRC;

|PROCESO CopiaAsiento;
   #casieaca#0 = #casieaaz#0;
   |LEE 020#0=;
   |BUCLELIN 2CopiaAsientoL#0;
   #casieaca#0 = #casieaaz#1;
   |GRABA 020#0n;
|FPRC;

|PROCESO altas2; |TIPO 7;
   modo = (FEntrada / 100) ! 0;
   |SI modo = 1;
      |DDEFECTO #0;
      |LEE 001#0u;
      nume1 = #casieaca#0;
      |DDEFECTO #0;
      #casieaca#0 = nume1 + 1;
      |PINTA #casieaca#0;
   |FINSI;
|FPRC;

|PROCESO detalle;
   tipoiva = "<SIN IVA>";
   tipocta = "";
   |SI #casieaca#2 = "S";
      |SI #casieaca#3 = "S";  tipoiva = "SOPORTADO  ";  tipocta = "Proveedor"; |FINSI;
      |SI #casieaca#3 = "R";  tipoiva = "REPERCUTIDO";  tipocta = "Cliente ."; |FINSI;
   |FINSI;
|FPRC;

|PROCESO impresion2;
   seleccio = 1;
   tipoacu = "";
   sw_oper1 = 0;
   sw_oper2 = 0;
   sw_acumu = 0;
   sw_ivali = 0;
   |SI #casieali#56 = "B"; tipoacu = "Base Imponible";  |FINSI;
   |SI #casieali#56 = "I"; tipoacu = "Cuota I.V.A.  ";  |FINSI;
   |SI #casieali#56 = "R"; tipoacu = "Cuota Recargo ";  |FINSI;
   |SI #casieali#56 = "P"; tipoacu = "Retencion     ";  |FINSI;
   |SI #casieali#56 = "D"; tipoacu = "Descuento     ";  |FINSI;
   |SI #casieali#24 ! " "; |O #casieali#25 ! " "; |O #casieali#26 ! " "; |O #casieali#27 ! " ";
      sw_oper1 = 1;
   |FINSI;
   |SI #casieali#28 ! " "; |O #casieali#29 ! " "; |O #casieali#30 ! " "; |O #casieali#31 ! " ";
      sw_oper2 = 1;
   |FINSI;
   sw_acumu = #casieali#8+#casieali#9+#casieali#10+#casieali#11+#casieali#12+#casieali#13+#casieali#14;
   |SI #casieaca#2 = "S";|Y #casieali#57 ! 0;
      sw_ivali = 1;
   |FINSI;
   |PRINT;
|FPRC;

|PROCESO impresion; |TIPO 4;
   seleccio = 0;
   |IMPRE 0;
   |SI FSalida = 0;
      |HAZ detalle;
      |INFOR "casieaca";
      |BUCLELIN 2impresion2#0;
      |SI seleccio = 1;
         |PIEINF;
      |SINO;
         |MENAV "    ATENCION!!! Lectura Erronea ...";
      |FINSI;
      |FININF;
   |SINO;
      |MENAV "    Proceso Abortado ...";
   |FINSI;
   |FINIMP;
|FPRC;

|PROCESO tipon; |TIPO 0;
   |SI #casieali#2 = "N";
    ||    #casieali#3 = "<SIN APUNTE>";
    ||    |PINTA #casieali#3;
       |CAMPO_MODIFICA #casieali#3, 1, "S";
       |CAMPO_MODIFICA #casieali#5, 1, "S";
       |CAMPO_MODIFICA #casieali#6, 1, "S";
       |CAMPO_MODIFICA #casieali#15, 1, "N";
       #casieali#15 = 0;
   |SINO;
      |CAMPO_MODIFICA #casieali#3, 1, "S";
      |CAMPO_MODIFICA #casieali#5, 1, "S";
      |CAMPO_MODIFICA #casieali#6, 1, "S";
      |CAMPO_MODIFICA #casieali#15, 1, "S";
   |FINSI;
|FPRC;

|PROCESO deduci; |TIPO 0;
   |SI #casieaca#2 = "S";
       |SI #casieaca#3 = "R";
           #casieaca#11 = "S";
           |PINTA #casieaca#11;
           |CAMPO_MODIFICA #casieaca#11, 1, "N";
       |SINO;
           |CAMPO_MODIFICA #casieaca#11, 1, "S";
       |FINSI;
       |SI #casieaca#3 = " "; |ERROR; |FINSI;
   |FINSI;
|FPRC;

|CALCULO LaInversion; |TIPO 0;
 |SI #casieaca#12 = "X"; |Y #casieaca#3 ! "S";
     |ERROR;
 |FINSI;
|FCAL;

|| ================ Procesos nuevos para altas en otras empresas
|| =============================================================

|CALCULO altas_emp; |TIPO 30;

 |HAZ Sele_alta;

 |SI nSwAlta = 0;
     |SI nSwCopiar = 1;
         |PUSHV 0501 1180;
         enNPred = #0#0;
         |SUB_EJECUTA_NP "caut0006";
    |FINSI;
 |FINSI;

 nSwCopiar = 0;
 |PINTA 0574,"ÄÄÄÄÄÄ¿";

 |SI nSwAlta = 0;  |ACABA; |FINSI;

 nModoEntrada = (FEntrada / 100) ! 0;
 |SI #11#51 = "M"; |Y nModoEntrada = 1;
     |ACABA;                          ||Solo Modificacion
 |FINSI;

 |SI #11#59 = "S";
     |AVISO;
     |SI nModoEntrada = 1;
         aAlfa1  = "2400S¨ Dar de Alta el Predefinido en Otras Empresas ? ";
     |SINO;
         aAlfa1  = "2400S¨ Modificar el Predefinido en Otras Empresas ? ";
     |FINSI;

     |CONFI aAlfa1;
     |SI FSalida ! 0;  |ACABA; |FINSI;
 |FINSI;

 raf_empresa = #30#2;
 raf_periodo = #30#3;
 raf_ejercic = #30#26;
 enOpAlta    = 1;
 enPrAlta    = #0#0;
 eaPrAlta    = #0#1;

 |CIERRAT #0;
 |CIERRAT #1;
 |SUB_EJECUTA_NP "caltacta";
 |ABRET #0;
 |ABRET #1;

|FCAL;

|PROCESO Sele_alta;
 nSwAlta = 0;
 |ABRE #11;
 |LEE 001#11p;
 |SI FSalida ! 0;
     |CIERRA #11;
     |ACABA;                          ||No existe Control
 |FINSI;
 |CIERRA #11;

 |SI #11#51 = "N"; |ACABA; |FINSI;    ||No opera con Predefinidos.

|| ---- Seleccion del Predefinido

 |SI #0#0  < #11#52; |O #0#0  > #11#53; |ACABA;  |FINSI;  || ..Codigo
 |SI #0#13 < #11#54; |O #0#13 > #11#55; |ACABA;  |FINSI;  || ..Grupo
 |SI #0#14 < #11#56; |O #0#14 > #11#57; |ACABA;  |FINSI;  || ..subgrupo

 nSwAlta = 1;
|FPRC;

|PROCESO sopor; |TIPO 7;
|PUSHV 05431677;
|ATRI I;
|CUADRO 05 43 16 77;
|ATRI R;
||            123456789012345678901234567890;
|PINTA 0644 , " ----- CASILLAS SOPORTADO  ----  ";
|PINTA 0744 , " (01) Op. Interiores Corrientes  ";
|PINTA 0844 , " (02) Importaciones              ";
|PINTA 0944 , " (03) Ad. Intracomunitarias      ";
|PINTA 1044 , " (04) Regimen A., G. y P.        ";
|PINTA 1144 , " (05) Regularizacion Inversiones ";
|PINTA 1244 , " (06) Op. Interiores Inversiones ";
|PINTA 1344 , " (07) Importaciones Inversiones  ";
|PINTA 1444 , " (08) Entrega Intracomunitaria   ";
|PINTA 1544 , " (09) Base no Deducible          ";
|ATRI 0;
|FPRC;

|PROCESO Tipo7C18sieaca;  |TIPO 7;
   |SI enEjercicio > 2011;
       aAlfa1 = "<*> No se pasa al 340.";
   |SINO;
       aAlfa1 = "<X> No se pasa al 340.";
   |FINSI;
   aAlfa1 = "    <F11> para consultar Tipo Operaciones Mod. 340." + aAlfa1;
   |MENSA aAlfa1;
|FPRC;

|PROCESO Tipo66C18sieaca;  |TIPO 66;
     |SI #0#3 ! "S"; |Y #0#3 ! "R"; |ACABA; |FINSI;

     aAlfa = "|C018WID";
     aID   = #0#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     |SI #0#3 = "S";
         |SI enEjercicio [ 2011;
             aPopup2  = 14;
         |SINO;
             aPopup2  = 18;
             |SI enEjercicio ] 2014;
                 aPopup2  = 27;
             |FINSI;
         |FINSI;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "F Adquisiciones realizadas por las agencias de viajes directamente en interés del viajero ";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "L Adquisiciones a comerciantes minoristas del IGIC";
         aPopup15 = "P Adquisiciones intracomunitarias de bienes.";
         aPopup16 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         |SI enEjercicio > 2011;
             aPopup17 = "R Operación de arrendamiento de local de negocio.";
             aPopup18 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
             aPopup19 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
             aPopup20 = "X Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo";
             |SI enEjercicio ] 2014;
                 aPopup21 = "Z Operaciones en Régimen especial de criterio de caja";
                 aPopup22 = "1 IVA criterio de caja. Asiento resumen de facturas";
                 aPopup23 = "2 IVA criterio de caja. Factura con varios asientos";
                 aPopup24 = "3 IVA criterio de caja. Factura rectificativa";
                 aPopup25 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
                 aPopup26 = "5 IVA criterio de caja. Factura simplificada";
                 aPopup27 = "6 IVA criterio de caja. Rectificación de errores registrales";
                 aPopup28 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
                 aPopup29 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
             |FINSI;
         |FINSI;
     |SINO;
         aPopup1  = nID;  || Si fuera -1 en la posicion
         |SI enEjercicio [ 2011;
             aPopup2  = 15;
         |SINO;
             aPopup2  = 21;
             |SI enEjercicio ] 2014;
                 aPopup2  = 30;
             |FINSI;
         |FINSI;
         aPopup3  = "  Operación habitual";
         aPopup4  = "A Asiento resumen de facturas";
         aPopup5  = "B Asiento resumen de tiques";
         aPopup6  = "C Factura con varios asientos (varios tipo impositivos)";
         aPopup7  = "D Factura rectificativa";
         aPopup8  = "E IVA devengado pendiente de emitir factura";
         aPopup9  = "G Régimen especial de grupo de entidades en IVA o IGIC";
         aPopup10 = "H Régimen especial de oro de inversión";
         aPopup11 = "I Inversión del Sujeto pasivo (ISP)";
         aPopup12 = "J Tiques";
         aPopup13 = "K Rectificación anotaciones registrales";
         aPopup14 = "M IVA facturado pendiente de devengar (emitida factura)";
         aPopup15 = "N Facturación de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena";
         aPopup16 = "O Factura emitida en sustitución de tiques facturados y declarados.";
         aPopup17 = "Q Operaciones a las que se aplique el régimen especial de bienes usados, ...";
         |SI enEjercicio > 2011;
             aPopup18 = "R Operación de arrendamiento de local de negocio.";
             aPopup19 = "S Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas.";
             aPopup20 = "T Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ...";
             aPopup21 = "U Operación de seguros.";
             aPopup22 = "V Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ...";
             aPopup23 = "W Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla.";
             |SI enEjercicio ] 2014;
                 aPopup24 = "Z Operaciones en Régimen especial de criterio de caja";
                 aPopup25 = "1 IVA criterio de caja. Asiento resumen de facturas";
                 aPopup26 = "2 IVA criterio de caja. Factura con varios asientos";
                 aPopup27 = "3 IVA criterio de caja. Factura rectificativa";
                 aPopup28 = "4 IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes en interés del viajero";
                 aPopup29 = "5 IVA criterio de caja. Factura simplificada";
                 aPopup30 = "6 IVA criterio de caja. Rectificación de errores registrales";
                 aPopup31 = "7 IVA criterio de caja. Facturación de las prestaciones de servicios de agencias de viajes";
                 aPopup32 = "8 IVA criterio de caja. Operación de arrendamiento de local de negocio";
             |FINSI;
         |FINSI;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #0#18 = aAlfa;
     |FINSI;

     |PINTA #0#18;
|FPRC;

|PROCESO Tipo0C18sieaca;  |TIPO 0;
      |BLIN 4;
     aAlfa = "";
     |SI #0#3 ! "R"; |Y #0#3 ! "S"; |ACABA; |FINSI;

     |SI #0#18 = " "; aAlfa = "Operaci¢n habitual"; |FINSI;
     |SI #0#18 = "A"; aAlfa = "Asiento resumen de facturas"; |FINSI;
     |SI #0#18 = "B"; aAlfa = "Asiento resumen de tiques"; |FINSI;
     |SI #0#18 = "X"; aAlfa = "No pasa al 340"; |FINSI;
     |SI #0#3 = "R";
         |SI #0#18 = "C"; aAlfa = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #0#18 = "D"; aAlfa = "Factura rectificativa"; |FINSI;
         |SI #0#18 = "E"; aAlfa = "IVA devengado pendiente de emitir factura"; |FINSI;
         |SI #0#18 = "G"; aAlfa = "Rgimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #0#18 = "H"; aAlfa = "Rgimen especial de oro de inversi¢n"; |FINSI;
         |SI #0#18 = "I"; aAlfa = "Inversi¢n del Sujeto pasivo (ISP)";|FINSI;
         |SI #0#18 = "J"; aAlfa = "Tiques"; |FINSI;
         |SI #0#18 = "K"; aAlfa = "Rectificación anotaciones registrales"; |FINSI;
         |SI #0#18 = "M"; aAlfa = "IVA facturado pendiente de devengar (emitida factura)"; |FINSI;
         |SI #0#18 = "N"; aAlfa = "Facturaci¢n de las prestaciones de servicios de agencias de viaje que actúan como mediadoras en nombre y por cuenta ajena"; |FINSI;
         |SI #0#18 = "O"; aAlfa = "Factura emitida en sustituci¢n de tiques facturados y declarados."; |FINSI;
         |SI #0#18 = "Q"; aAlfa = "Operaciones a las que se aplique el rgimen especial de bienes usados, ..."; |FINSI;
         |SI enEjercicio > 2011;
             |SI #0#18 = "R"; aAlfa = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
             |SI #0#18 = "S"; aAlfa = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
             |SI #0#18 = "T"; aAlfa = "Cobros por cuenta de terceros de honorarios profesionales o de derechos derivados ..."; |FINSI;
             |SI #0#18 = "U"; aAlfa = "Operación de seguros."; |FINSI;
             |SI #0#18 = "V"; aAlfa = "Compras de Agencias viajes: operaciones de prestación de servicios de mediación en nombre y por cuenta ajena relativos ..."; |FINSI;
             |SI #0#18 = "W"; aAlfa = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
             |SI enEjercicio ] 2014;
                 |SI #0#18 = "Z"; aAlfa = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
                 |SI #0#18 = "1"; aAlfa = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
                 |SI #0#18 = "2"; aAlfa = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
                 |SI #0#18 = "3"; aAlfa = "IVA criterio de caja. Factura rectificativa"; |FINSI;
                 |SI #0#18 = "4"; aAlfa = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
                 |SI #0#18 = "5"; aAlfa = "IVA criterio de caja. Factura simplificada"; |FINSI;
                 |SI #0#18 = "6"; aAlfa = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
                 |SI #0#18 = "7"; aAlfa = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
                 |SI #0#18 = "8"; aAlfa = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI #0#18 = "C"; aAlfa = "Factura con varios asientos (varios tipo impositivos)"; |FINSI;
         |SI #0#18 = "D"; aAlfa = "Factura rectificativa";|FINSI;
         |SI #0#18 = "F"; aAlfa = "Adquisiciones realizadas por las agencias de viajes directamente en inters del viajero";|FINSI;
         |SI #0#18 = "G"; aAlfa = "Rgimen especial de grupo de entidades en IVA o IGIC"; |FINSI;
         |SI #0#18 = "H"; aAlfa = "Rgimen especial de oro de inversi¢n"; |FINSI;
         |SI #0#18 = "I"; aAlfa = "Inversi¢n del Sujeto pasivo (ISP)"; |FINSI;
         |SI #0#18 = "J"; aAlfa = "Tiques"; |FINSI;
         |SI #0#18 = "K"; aAlfa = "Rectificación anotaciones registrales"; |FINSI;
         |SI #0#18 = "L"; aAlfa = "Adquisiciones a comerciantes minoristas del IGIC"; |FINSI;
         |SI #0#18 = "P"; aAlfa = "Adquisiciones intracomunitarias de bienes."; |FINSI;
         |SI #0#18 = "Q"; aAlfa = "Operaciones a las que se aplique el rgimen especial de bienes usados, ..."; |FINSI;
         |SI enEjercicio > 2011;
             |SI #0#18 = "R"; aAlfa = "Operaci¢n de arrendamiento de local de negocio."; |FINSI;
             |SI #0#18 = "S"; aAlfa = "Subvenciones, auxilios o ayudas satisfechas o recibidas, tanto por parte de Administraciones públicas o entidades privadas."; |FINSI;
             |SI #0#18 = "W"; aAlfa = "Operaciones sujetas al Impuesto sobre la Producción, los Servicios y la Importación en las Ciudades de Ceuta y Melilla."; |FINSI;
             |SI #0#18 = "X"; aAlfa = "Operaciones por las que los empresarios o profesionales que satisfagan compensaciones agrícolas hayan expedido el recibo"; |FINSI;
             |SI enEjercicio ] 2014;
                 |SI #0#18 = "Z"; aAlfa = "Operaciones en Régimen especial de criterio de caja"; |FINSI;
                 |SI #0#18 = "1"; aAlfa = "IVA criterio de caja. Asiento resumen de facturas"; |FINSI;
                 |SI #0#18 = "2"; aAlfa = "IVA criterio de caja. Factura con varios asientos"; |FINSI;
                 |SI #0#18 = "3"; aAlfa = "IVA criterio de caja. Factura rectificativa"; |FINSI;
                 |SI #0#18 = "4"; aAlfa = "IVA criterio de caja. Adqusiciones realizadas por las agencias de viajes"; |FINSI;
                 |SI #0#18 = "5"; aAlfa = "IVA criterio de caja. Factura simplificada"; |FINSI;
                 |SI #0#18 = "6"; aAlfa = "IVA criterio de caja. Rectificaci¢n de errores registrales"; |FINSI;
                 |SI #0#18 = "7"; aAlfa = "IVA criterio de caja. Facturaci¢n de las prestaciones servicios agencias viajes"; |FINSI;
                 |SI #0#18 = "8"; aAlfa = "IVA criterio de caja. Operaci¢n de arrendamiento de local de negocio"; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI enEjercicio [ 2011;
         |SI #0#18 = "X"; aAlfa = "No pasa al 340"; |FINSI;
     |SINO;
         |SI #0#18 = "*"; aAlfa = "No pasa al 340"; |FINSI;
     |FINSI;

     |SI aAlfa = "";
         |MENAV "0000 Clave de operaci¢n incorrecta";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|CALCULO TrasConcepto;  |TIPO 0;
   |C_M #1Campo, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI #0#18 = "D"; |Y #0#2 = "S";
       aTipoIVA   = #0#3;
       enConcepto = #1Campo;
       |HAZ VeoRecti;
       |SI nSwRecti = 1;
           |ERROR;
       |FINSI;
    |FINSI;
|FCAL;
