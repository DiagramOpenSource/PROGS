|FICHEROS;
     caconimp #8;
     casoplib #0;
     cauxinva #2;

     casoplim #11,MANTE;
     casoplil #12,MANTE;
     casoplic #14;
     casoplih #13;

     :/basica/def/agim0019 #500;     || registro sociedades
     :/basica/def/agim0026 #502;     || cargos sociedades
     :/basica/def/agim0024 #504;     || Representantes
     :/basica/def/agicen15 #515;     || Representante
     :/basica/def/agim0056 #516;     || Registro Mercatil
     :/basica/def/agifigen #118;

     :/integral/def/dsam0005 #205;   || Domicilios

     caselem1 #998;
     fichero@ #900;
     &poblaci@  #703;
     &regisnif@ #709;
|FIN;

|VARIABLES;
     aPath       = "";
     nInkey      = 0;
     aReser      = "";
     aPathContas = "";
     nSalir      = 0;
     aSistema    = "";
     aOrigen     = "";
     aDestino    = "";
     EstadoAnt   = "";
     Comodin     = "";
     Comodin1    = "";
     Comodin2    = "";
     Comodin3    = "";
     NombreTotal = "";
     Nombre      = "";
     aApell1     = "";
     aApell2     = "";
     aLong       = "";
     Directorio  = "";
     Dia         = "";
     anyo        = "";
     Cuenta      = "";
     aDia        = "";
     aMes        = "";
     aAnyo       = "";
     ComFecha    = "";
     Caracter    = "";
     aNumer      = "";
     aAlfa       = "";
     aImpre      = "";
     aApertura   = "";
     aSaldoCero  = "";
     aBorro      = "";
     aBorroS     = "";
     aVerDatos   = "";

     Local       = 0;
     ModoEntrada = 0;
     nLong       = 0;
     nParte1     = 0;
     nParte2     = 0;
     Handle      = 0;
     Calc        = 0;
     Linea       = 1;
     Cuentador   = 0;
     nCont       = 0;
     NumFecha    = 0;
     Ejercicio   = 0;
     Numeracion  = 0;
     Empre1      = 0;

     Fecha       = @;

     nDejaSI = 0;
     nClau1 = 0;
     nClau2 = 0;
     aAlfa0 = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aAlfa6 = "";

     &eaAlfa     = "";
     nNume1      = 0;
     nNume2      = 0;
     nNume3      = 0;
     nNume4      = 0;
     nSecretario = 0;
     nSociedad   = 0;
     nDSocial    = 0;

     nNoborro = 0;
     nVerDat  = 0;

     aEstado      = "";
     nNumLibros   = 0;
     nError       = 0;
     &eaDirGuarda = "";
     &eaOrigen    = "";
     &eaDestino   = "";
     aDef         = "";
     nErrorSec    = 0;
     nBueno       = 0;
     nSw15        = 0;
     nSwBal       = 0;

     aAbre        = "";
     nHandle      = 0;
     nBaffer      = 0;
     nOpcion      = 0;
     nTotalLinea  = 0;
     nConta       = 0;
     nCogeOpcion  = 0;

     aFichero     = "";
     nSwOpe       = 0;
     nSwOp1       = 0;

  {30}aPopup        = "";
     nID            = 0;
     aID            = "";

   nSal    = 0;
   nModo   = 0;
   nNumeT1 = 0;
   nNumeT2 = 0;
   nNumeT3 = 0;
   nNumeT4 = 0;
   nNumeT5 = 0;
   nNumeT6 = 0;
   nNumeT7 = 0;
   nNumeT8 = 0;
   nPrimero = 0;

   aNombre    = "";
   aOrden     = "";
   aExtension = "";
   &eaVarDni  = "";
   &enCalcCif = 0;
   aAnterior  = "";

   aCampo18 = "";
   aCampo19 = "";
   aCampo20 = "";
   aCampo21 = "";
   aCampo22 = "";
   aCampo23 = "";
   aCampo24 = "";
   aCampo25 = "";
   aCampo26 = "";
   aCampo27 = "";
   aCampo28 = "";
   aCampo29 = "";
   nCampo30 = "";
   nCampo31 = "";
   nPara1   = 0;
   nPara2   = 0;
   nEstado  = 0;
   aCasilla = "";
   nExiste  = 0;
   nExt     = 0;
   nSw      = 0;
   &eaExtension = "";
   swHist   = 0;
   nDesde   = 0;
   nHasta   = 0;
   nAny     = 0;
   nOpHis   = 0;
   nEstHist = 0;
   fFecha1  = @;
   fFecha2  = @;
   fFecha3  = @;
   nRegis   = 0;
   aDAlfa   = "";
   aHAlfa   = "";
   nOpLeg   = 0;
   nDTipoL  = 0;
   nHTipoL  = 0;
   nCampo2  = 0;
   nCampo7  = 0;
   aElUsu   = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE dslegv_i;

|PROCESO BorroSoplih;
  nNume1    = 8 + (#13#3 * 2);
  nNume2    = nNume1 + 1;
  |SI #14nNume1 > #13#6; |O #14nNume1 = 0; #14nNume1 = #13#6; |FINSI;
  #14nNume2 = #14nNume2 - 1; |SI #14nNume2 < 0; #14nNume2 = 0; |FINSI;

  |BORRA 020#13a;
  |LIBERA #13;

 |SI #13#11 = "N";
     #12#1 = #13#3;
     #12#6 = #13#6;
     |LEE 141#12=;
     |SI FSalida = 0;
         |BORRA 020#12a;
     |FINSI;
     |LIBERA #12;
 |FINSI;
|FPRC;

|DEFBUCLE BorroSoplih;
  #13#1;
  11;
  #caselem1#1, #caselem1#7, #caselem1#2, 01, 01, aDAlfa;
  #caselem1#1, #caselem1#7, #caselem1#2, 20, 99, aHAlfa;
  be;
  NULL, BorroSoplih;
|FIN;

|PROCESO BorroSoplih0;
  dirfich0 = #caselem1#3; |QBF dirfich0;
  |CIERRA #12;  |PATH_DAT #12 dirfich0;
  |ABRE #12;
  |SELECT #2#12;
  |BUCLE BorroSoplih;
  |SELECT #1#12;
  |CIERRA #12;
|FPRC;

|PROCESO PasaSoplih;
   |SI nOpLeg = 0;
       Comodin3 = ("000" + #13#6) % -103;
       aNumer   = ("000" + Numeracion) % -103;
       Numeracion = Numeracion + 1;
       aAlfa1   = #13#5;
       Comodin2 = Handle + " " + aNumer + "01" + aAlfa1 + &13 + &10; |FGRABA Comodin2;
       Comodin2 = Handle + " " + aNumer + "02" + Comodin3 + &13 + &10; |FGRABA Comodin2;

       ComFecha = #13#7;
       ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
       Comodin2 = Handle + " " + aNumer + "03" + ComFecha + &13 + &10; |FGRABA Comodin2;

       ComFecha = #13#8;
       |SI Fecha > #agifigen#94; |Y #agifigen#94 > "01.01.1000"; ComFecha = #agifigen#94; |FINSI;
       ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
       Comodin2 = Handle + " " + aNumer + "04" + ComFecha + &13 + &10; |FGRABA Comodin2;

       ComFecha = #13#9;
       ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
       |SI #13#6 = 1; ComFecha = "      "; |FINSI;
       Comodin2 = Handle + " " + aNumer + "05" + ComFecha + &13 + &10; |FGRABA Comodin2;

       #13#11 = "S";
       |GRABA 020#13a;

       dirfich0 = #caselem1#3; |QBF dirfich0;
       |CIERRA #12;  |PATH_DAT #12 dirfich0;
       |ABRE #12;
       |SELECT #2#12;
       #12#1 = #13#3;
       #12#6 = #13#6;
       |LEE 141#12=;
       |SI FSalida = 0;
           #12#9 = "L";
           |GRABA 020#12a;
       |FINSI;
       |LIBERA #12;
       |SELECT #1#12;
       |CIERRA #12;
   |FINSI;

   |SI nOpLeg = 1;
       Nombre = #13#10; |QBF Nombre;
       Nombre = Nombre > " ";
       Nombre = Handle + " " + Nombre + &13 + &10; |FGRABA Nombre;
       Nombre = "";
   |FINSI;

   |SI nOpLeg = 2;
       nNumLibros = nNumLibros + 1;
   |FINSI;

   |SI nOpLeg = 3;
       |SI enNumeLeg [ #13#6;
           enNumeLeg = #13#6 + 1;
       |FINSI;
       efFecha3 = #13#8;
   |FINSI;

   |LIBERA #13;
|FPRC;

|DEFBUCLE PasaSoplih;
  #13#1;
  ;
  #caselem1#1, #caselem1#7, #caselem1#2, nDTipoL, 01;
  #caselem1#1, #caselem1#7, #caselem1#2, nHTipoL, 99;
  be;
  NULL, PasaSoplih;
|FIN;

|PROCESO LeoCabHistorico;
   nDesde = 01;
   nHasta = 10;
   swHist = 0;

   |ABRE #14;
   |DDEFECTO #14;
   #14#0 = #caselem1#1;
   #14#1 = #caselem1#7;
   #14#2 = #caselem1#2;
   |LEE 041#14=;
   nEstHist = FSalida;

   |SI nOpHis = 4;
       |SI nEstHist = 0;
           |SI #14#9 = "S"; swHist = 1; |FINSI;
       |FINSI;
   |FINSI;

   |SI nOpHis = 0;    || ... Borro la Carpeta de Legalia
       |SI nEstHist = 0;
           |SI #14#9 = "S"; swHist = 1; |FINSI;
           nDesde = 99; nHasta = 0;
           |PARA nCont = 10; |SI nCont [ 48; |HACIENDO nCont = nCont + 2;
                |SI #14nCont < nDesde; |Y #14nCont ! 0; nDesde = #14nCont; |FINSI;
                nNume2 = nCont + 1; nNume2 = #14nCont + #14nNume2 - 1;
                |SI nNume2 > nHasta; nHasta = nNume2; |FINSI;
           |SIGUE;
           |SI nDesde = 99; |Y nHasta = 0; nDesde = 1; nHasta = 10; |FINSI;
           |SI #14#9 ! "S";
               #14#50 = "01.01.0000";
               aDAlfa = "S"; aHAlfa = "S"; |HAZ BorroSoplih0;
               |GRABA 020#14a;
           |FINSI;
       |FINSI;
   |FINSI;

   |SI nOpHis = 1; |Y #caselem1#7 ] 2015;
       |HAZ LasFechasDef;
       |SI nEstHist ! 0;
           |DDEFECTO #14;
           #14#0 = #caselem1#1;
           #14#1 = #caselem1#7;
           #14#2 = #caselem1#2;
           #14#3 = aPath;
           #14#4 = aMasNombre;
           #14#5 = #48#1;
           |GRABA 020#14b;
      |FINSI;
      |SI #14#9 = "S"; swHist = 1; |FINSI;
      |SI swHist = 0;
          |SI #14#6 [ "01.01.0000"; #14#6 = fFecha1; |FINSI;
          |SI #14#7 [ "01.01.0000"; #14#7 = fFecha2; |FINSI;
          |SI #14#8 [ "01.01.0000"; #14#8 = fFecha3; |FINSI;

           Fecha = ~;
           #14#50 = Fecha;
           |SI #14#9 = "N"; |Y aArchLeg = "S";
               #14#51 = Fecha;
           |FINSI;
           #14#9 = aArchLeg;
           |SI #14#9 = "N"; #14#51 = "01.01.0000"; |FINSI;
           |GRABA 020#14a;
      |FINSI;
   |FINSI;

   |SI nOpHis = 2;

       efFecha3  = "01.01.0000";
       enNumeLeg = 0;
       nNume1    = 8 + (nTipoL * 2);
       nNume2    = nNume1 + 1;
       |SI nEstHist = 0;
           |SI #14#9 = "S"; swHist = 1; |FINSI;
           enNumeLeg = #14nNume1 + #14nNume2;
           efFecha3  = #14#8;
           |SI efFecha3 [ "01.01.0000";
               |HAZ LasFechasDef;
               efFecha3 = fFecha3;
           |FINSI;

           nDTipoL = nTipoL;
           nHTipoL = nTipoL;
           nOpLeg = 3;
           |BUCLE PasaSoplih;
       |FINSI;

       |SI enNumeLeg = 0;
           nAny = #caselem1#7 - 1;
           |PARA nPara1 = nAny; |SI nPara1 ] 2014; |HACIENDO nPara1 = nPara1 - 1;
                 nAny = nPara1;
                 |DDEFECTO #14;
                 #14#0 = #caselem1#1;
                 #14#1 = nAny;
                 #14#2 = 10;
                 |LEE 041#14];
                 |SI FSalida ! 0;
                     |LEE 041#14u;
                 |SINO;
                     |LEE 041#14a;
                 |FINSI;
                 |SI FSalida = 0; |Y #14#0 = #caselem1#1; |Y #14#1 = nAny;
                     enNumeLeg = #14nNume1 + #14nNume2;
                     efFecha3  = #14#7;
                     nCampo7 = #caselem1#7; #caselem1#7 = nAny;
                     nCampo2 = #caselem1#2; #caselem1#2 = #14#2;
                     nDTipoL = nTipoL;
                     nHTipoL = nTipoL;
                     nOpLeg  = 3;
                     |BUCLE PasaSoplih;
                     #caselem1#7 = nCampo7;
                     #caselem1#2 = nCampo2;
                |FINSI;
                |SI enNumeLeg ! 0;
                    |SAL;
                |FINSI;
           |SIGUE;
       |FINSI;
       |SI enNumeLeg = 0; enNumeLeg = 1; |FINSI;
   |FINSI;

   |SI nOpHis = 3;  || ... Borro la carpeta temporal PresLib
       |SI nEstHist = 0;
           swHist = 1;
           |SI #14#9 = "N";
               swHist = 0;
               aDAlfa = "N";
               aHAlfa = "N"; |HAZ BorroSoplih0;
               #14#51 = "01.01.0000";
               |GRABA 020#14a;
           |FINSI;
       |FINSI;
   |FINSI;

   |LIBERA #14;
   |CIERRA #14;
|FPRC;

|PROCESO eVerRegMer;
     nSw = 0;
     |ABRE #agim0056;
     |LEE 040#agim0056.p;
     |SI FSalida ! 0;
         nSw = 1;
     |SINO;
         #agim0056#0 = "02010";
         |LEE 041#agim0056.=;
         |SI FSalida ! 0;
             nSw = 1;
         |SINO;
             aAlfa = #agim0056#1; |QBF aAlfa;
             |SI aAlfa ! "ALBACETE";
                 nSw = 1;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #agim0056;

     |SI nSw = 1;
         eaPrograma  = "agim0056";
         eaExtension = "bas";
         |SUB_EJECUTA_NP ":basica/dspatron";
     |FINSI;
|FPRC;

|| ................. Nuevos documentos
|PROCESO casoplil;
  |SI nSwOp1 = 0;
      |SI #12#9 ! "L";  |BORRA 020#12a;  |FINSI;
  |FINSI;
  |SI nSwOp1 = 4;
      |SI #12#9 = "L";
          #12#9 = " ";
          |GRABA 020#12a;
      |FINSI;
  |FINSI;

  |SI nSwOp1 = 1;
      |SI #12#1 = 1; |Y #12#6 > nNumeT1; nNumeT1 = #12#6; |FINSI;
      |SI #12#1 = 2; |Y #12#6 > nNumeT2; nNumeT2 = #12#6; |FINSI;
      |SI #12#1 = 3; |Y #12#6 > nNumeT3; nNumeT3 = #12#6; |FINSI;
      |SI #12#1 = 4; |Y #12#6 > nNumeT4; nNumeT4 = #12#6; |FINSI;
      |SI #12#1 = 5; |Y #12#6 > nNumeT5; nNumeT5 = #12#6; |FINSI;
      |SI #12#1 = 6; |Y #12#6 > nNumeT6; nNumeT6 = #12#6; |FINSI;
      |SI #12#1 = 7; |Y #12#6 > nNumeT7; nNumeT7 = #12#6; |FINSI;
      |SI #12#1 = 8; |Y #12#6 > nNumeT8; nNumeT8 = #12#6; |FINSI;
  |FINSI;

  |SI nSwOp1 = 2; |Y #12#9 = " ";
      eaOrigen = #12#2; |QBF eaOrigen;
      |SI eaOrigen ! "";
          eaDestino = #12#3; |QBF eaDestino;
          |SI eaDestino ! "";
              eaDestino = Comodin1 + eaDestino;

              aAlfa = "";
              |IP_REMOTO aAlfa; |QBF aAlfa;
              |SI aAlfa ! "";
                  |RECIBE_FICHERO eaOrigen, eaDestino;
              |SINO;
                  |COPIA_FICHERO eaOrigen, eaDestino;
              |FINSI;

              |SI #caselem1#7 ] 2015;
                  nTipoL   = #12#1;
                  nNumer   = #12#6;
                  aNomFLeg = #12#3;
                  efFecha1 = #12#4;
                  efFecha2 = #12#5;
                  efFecha3 = #12#8;
                  enRegisLeg = #12#10;
                  |HAZ eGrabaHistLegal;

                  #12#9 = "S";
                  #12#10 = enRegisLeg;
                  |GRABA 020#12a;
              |FINSI;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI nSwOp1 = 3;
       nNumeT1 = nNumeT1 + 1;
  |FINSI;

  |LIBERA #12;
|FPRC;

|DEFBUCLE casoplil;
  #12#1;
  ;
  001;
  999;
  be;
  NULL, casoplil;
|FIN;

|PROCESO CopiaNuevos;

  eaLegEmp = ("00000" + #caselem1#1) % -105;
  eaLegPer = #caselem1#2;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

  nSwOp1 = 2; |BUCLE casoplil;

  |PULSATECLA;
|FPRC;

|PROCESO BorraAnterior;

  eaLegEmp = ("00000" + #caselem1#1) % -105;
  eaLegPer = #caselem1#2;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

  aFichero = Comodin1 + aFichero;
  |FBORRA aFichero;

   nTipoL     = #12#1;
   enRegisLeg = #12#10;
   |HAZ eBorraHistLegal;

  |PULSATECLA;
|FPRC;

|PROCESO Tipo3C0;  |TIPO 3;
   aAlfa1 = #12#2; |QBF aAlfa1;
   |SI aAlfa1 = "";
       |MENAV "0000Error. No puede dejar el fichero origen en blanco";
       |ERROR;
   |SINO;
       aAlfa1 = #12#3; |QBF aAlfa1;
       |SI aAlfa1 = "";
           |MENAV "0000Error. No puede dejar el fichero destino en blanco";
           |ERROR;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo0C0;  |TIPO 0;
      nPrimero = #12#1;
      nModo  = (FEntrada / 100) ! 0;
      aAlfa = "S";
      |SI nModo = 1;
          #12#4 = #998#4;
          #12#5 = #998#5;
      |SINO;
          |SI #12#9 ! " ";  aAlfa = "N";  |FINSI;
      |FINSI;

      |C_M #12#1, 1, aAlfa;
      |C_M #12#6, 1, aAlfa;
|FPRC;

|PROCESO Tipo2lil;  |TIPO 2;
      nModo = (FEntrada / 100) ! 0;
      |SI nModo = 2; |O nModo = 3;
          nNume1 = 0 +.1;
          |SI nNume1 < 0;
              |SI #12#9 = "L";
                  aAlfa = "Baja"; |SI nModo = 2; aAlfa = "Modificacion"; |FINSI;
                  aAlfa = "0000" + aAlfa + " no permitida, Libro pasado a la Carpeta de Legalia";
                  |MENAV aAlfa;
                  |ERROR;
                  |ACABA;
              |SINO;
                  |SI nModo = 3;
                      aFichero = #12#3;
                      |HAZ BorraAnterior;
                  |FINSI;
              |FINSI;
          |SINO;
              |SI nModo = 2; #12#9 = " "; |FINSI;
          |FINSI;
      |FINSI;

      |SI #12#1 = 1; nNumeT1 = nNumeT1 +. 1; |FINSI;
      |SI #12#1 = 2; nNumeT2 = nNumeT2 +. 1; |FINSI;
      |SI #12#1 = 3; nNumeT3 = nNumeT3 +. 1; |FINSI;
      |SI #12#1 = 4; nNumeT4 = nNumeT4 +. 1; |FINSI;
      |SI #12#1 = 5; nNumeT5 = nNumeT5 +. 1; |FINSI;
      |SI #12#1 = 6; nNumeT6 = nNumeT6 +. 1; |FINSI;
      |SI #12#1 = 7; nNumeT7 = nNumeT7 +. 1; |FINSI;
      |SI #12#1 = 8; nNumeT8 = nNumeT8 +. 1; |FINSI;
|FPRC;

|PROCESO BuscaFichero;
   |SI FSalida = 10;
       aAlfa = #12#2; |QBF aAlfa;
       |SI aAlfa = ""; aAlfa = "*"; |FINSI;
       aAlfa = "F" + aAlfa;
       |BROWSE aAlfa;
       aAlfa = aAlfa - "F";
       #12#2 = aAlfa;
       |ERROR;
   |FINSI;

   aAlfa = #12#2; |QBF aAlfa;
   |SI aAlfa = "";
       |MENAV "0000Error. No puede dejar el fichero origen en blanco";
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO DestinoBueno;
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI #caselem1#7 < 2015;
       |SI #12#1 = 1; aAlfa = "ACTASCON"; |FINSI;
       |SI #12#1 = 2; aAlfa = "ACTASDET"; |FINSI;
       |SI #12#1 = 3; aAlfa = "ACTALCON"; |FINSI;
       |SI #12#1 = 4; aAlfa = "ACTACODE"; |FINSI;
       |SI #12#1 = 5; aAlfa = "ACCIONES"; |FINSI;
       |SI #12#1 = 6; aAlfa = "SOCIOS";   |FINSI;
       |SI #12#1 = 7; aAlfa = "SOCUNICO"; |FINSI;
       |SI #12#1 = 8; aAlfa = "OTROS";    |FINSI;
   |SINO;
       nTipoL = #12#1;
       |HAZ NomLibros;
       aAlfa = aNombre2; |QBF aAlfa;
       aAlfa = aAlfa - "_";
   |FINSI;

   nError = 0;
   aAlfa1 = #12#3 - aAlfa;
   |SI FSalida = 0;
       nError = 1;
   |SINO;
       aAlfa1 = aAlfa1 - "_";
       |SI FSalida = 0;
           nError = 1;
       |SINO;
           aAlfa2 = aAlfa1 % 103;
           |SI aAlfa2 < "001"; |O aAlfa2 > "999";
               nError = 1;
           |SINO;
               aAlfa1 = aAlfa1 % 410;
               aAlfa1 = aAlfa1 - ".";
               |SI FSalida = 0;
                   nError = 1;
               |SINO;
                   |QBF aAlfa1; aAlfa1 = aAlfa1 > " ";
                   |SI aAlfa1 ! "XLS"; |Y aAlfa1 ! "XLSX";
                      |Y aAlfa1 ! "DOC"; |Y aAlfa1 ! "DOCX";
                          |Y aAlfa1 ! "PDF";
                         nError = 1;
                    |FINSI;
                |FINSI;
            |FINSI;
       |FINSI;
   |FINSI;
   |SI nError = 1; |Y #caselem1#7 < 2015;
       |MENAV "0000Nombre del Fichero destino NO valido";
   |FINSI;
|FPRC;

|PROCESO Tipo66C01; |TIPO 66;

     aAlfa = "|C001WID";
     aID   = #casoplil#aAlfa#;
     nID   = aID;

     |SI #caselem1#7 < 2015;
         aPopup1  = nID;  || Si fuera -1 en la posicion
         aPopup2  = 8;
         aPopup3  = "1  Libro de Actas";
         aPopup4  = "2  Libro de Detalle de Actas";
         aPopup5  = "3  Libro de Actas del Consejo";
         aPopup6  = "4  Libro de Detalle de Actas del Consejo";
         aPopup7  = "5  Registro de Acciones Nominativas";
         aPopup8  = "6  Registro de Socios";
         aPopup9  = "7  Libro-Registro de Contratos del Socio Unico ";
         aPopup10 = "8  Otros";
     |SINO;
         aPopup1  = nID;  || Si fuera -1 en la posicion
         aPopup2  = 20;
         aPopup3  = "1  Diario";
         aPopup4  = "2  Inventario y Cuentas Anuales";
         aPopup5  = "3  Balance de comprobacion (sumas y saldos)";
         aPopup6  = "4  Inventario";
         aPopup7  = "5  Balances";
         aPopup8  = "6  Memoria";
         aPopup9  = "7  Mayor";
         aPopup10 = "8  Libro de Perdidas y Ganancias";
         aPopup11 = "9  IVA";
         aPopup12 = "10 Facturas Emitidas";
         aPopup13 = "11 Facturas Recibidas";
         aPopup14 = "12 Detalle del Diario";
         aPopup15 = "13 Registro de Acciones Nominativas";
         aPopup16 = "14 Registro de Socios";
         aPopup17 = "15 Libro de Actas";
         aPopup18 = "16 Libro de Detalle de Actas";
         aPopup19 = "17 Libro de Actas del Consejo";
         aPopup20 = "18 Libro de Detalle de Actas del Consejo";
         aPopup21 = "19 Libro-registro de Contratos del Socio Unico con la Sociedad Unipersonal";
         aPopup22 = "20 Otros";
     |FINSI;
     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #12#1 = aAlfa;
     |FINSI;

     |PINTA #12#1;
|FPRC;

|PROCESO VerNumAuxiliar;
  |SI #12#0 ! #900#0;
      |SI enNumeLeg [ #900#6;
          enNumeLeg = #900#6 + 1;
      |FINSI;
      efFecha3  = #900#5;
  |FINSI;
|FPRC;

|DEFBUCLE VerNumAuxiliar;
  #900#2002;
  ;
  #12#1, 001;
  #12#1, 999;
  ;
  NULL, VerNumAuxiliar;
|FIN;

|PROCESO Tipo0C01; |TIPO 0;
     aAlfa  = Contenido;
     nNume1 = aAlfa;
     nModo  = (FEntrada / 100) ! 0;

     |SI nNume1 ! #12#1; |O nModo = 1;
         |SI #caselem1#7 < 2015;
             |SI #12#1 = 1; #12#6 = nNumeT1 + 1; |FINSI;
             |SI #12#1 = 2; #12#6 = nNumeT2 + 1; |FINSI;
             |SI #12#1 = 3; #12#6 = nNumeT3 + 1; |FINSI;
             |SI #12#1 = 4; #12#6 = nNumeT4 + 1; |FINSI;
             |SI #12#1 = 5; #12#6 = nNumeT5 + 1; |FINSI;
             |SI #12#1 = 6; #12#6 = nNumeT6 + 1; |FINSI;
             |SI #12#1 = 7; #12#6 = nNumeT7 + 1; |FINSI;
             |SI #12#1 = 8; #12#6 = nNumeT8 + 1; |FINSI;
          |SINO;
             nTipoL = #12#1;
             nOpHis   = 2;
             |HAZ LeoCabHistorico;
             |BUCLE VerNumAuxiliar;
             #12#8 = efFecha3;   |PINTA #12#8;
             #12#6 = enNumeLeg;  |PINTA #12#6;
          |FINSI;
          |PINTA #12#6;
     |FINSI;

     |SI #caselem1#7 < 2015;
         |SI #12#1 = 1; #12#7 = "Libro de Actas "; |FINSI;
         |SI #12#1 = 2; #12#7 = "L.Detalle Actas"; |FINSI;
         |SI #12#1 = 3; #12#7 = "L.Actas Consejo"; |FINSI;
         |SI #12#1 = 4; #12#7 = "L.Det.Acta Con."; |FINSI;
         |SI #12#1 = 5; #12#7 = "Reg.Acc.Nomina."; |FINSI;
         |SI #12#1 = 6; #12#7 = "Registro Socios"; |FINSI;
         |SI #12#1 = 7; #12#7 = "L.-R.Cont. S.U."; |FINSI;
         |SI #12#1 = 8; #12#7 = "Otros";           |FINSI;
     |SINO;
         nTipoL = #12#1;
         |HAZ NomLibros;
         #12#7 = aNombre1;
     |FINSI;
     |PINTA #12#7;

     |SI #12#1 = 14;
         |SI enEjercicio ] 2015;
             |MENAV "0000Recuerde: Ahora tiene la Posibilidad de Obtenerlo por Menu";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonExtension;
         aOrden = ("000" + #12#6) % -103;
         nExt   = 0;
         aAlfa      = #12#2; |QBF aAlfa;
         aAlfa1     = aAlfa % 0;
         nNume1     = aAlfa1;
         aExtension = "";
         |PARA nNume2 = nNume1; |SI nNume2 > 0; |HACIENDO nNume2 = nNume2 - 1;
               nNume3 = 100 * nNume2 + 1;
               aAlfa2 = nNume3;
               aAlfa3 = aAlfa % aAlfa2;
               |SI aAlfa3 = ".";
                   nExt = 1;
                   |SAL;
               |SINO;
                   aExtension = aAlfa3 + aExtension;
               |FINSI;
         |SIGUE;
         |SI nExt = 1;
             aExtension = aExtension < "";
         |SINO;
             |MENAV "0000Error el Nombre del documento no tiene Extencion";
         |FINSI;
|FPRC;

|PROCESO PonerDestino; |TIPO 0;

     aAlfa = Contenido;
     |SI #12#6 > 9; |Y #caselem1#7 < 2015;
         |MENAV "0000El numero debe ser inferior a 10";
         |ERROR;
         |ACABA;
     |FINSI;
     |SI FSalida = 2; |ACABA; |FINSI;

     nModo  = (FEntrada / 100) ! 0;

     |SI #12#6 ! aAlfa;
         nTipoL = #12#1;
         nOpHis   = 2;
         |HAZ LeoCabHistorico;
         |BUCLE VerNumAuxiliar;
         |SI #12#6 < enNumeLeg;
             |MENAV "0000Numero incorrecto, inferior al numero actual";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa1 = #12#3; |QBF aAlfa1;

     |SI nPrimero ! #12#1; |O nModo = 1; |O aAlfa1 = "";
         |SI #caselem1#7 ] 2015;
             nTipoL = #12#1;
             |HAZ NomLibros;
             aNombre = aNombre2;
         |SINO;
             |SI #12#1 = 1; aNombre = "ACTASCON_"; |FINSI;
             |SI #12#1 = 2; aNombre = "ACTASDET_"; |FINSI;
             |SI #12#1 = 3; aNombre = "ACTALCON_"; |FINSI;
             |SI #12#1 = 4; aNombre = "ACTACODE_"; |FINSI;
             |SI #12#1 = 5; aNombre = "ACCIONES_"; |FINSI;
             |SI #12#1 = 6; aNombre = "SOCIOS_";   |FINSI;
             |SI #12#1 = 7; aNombre = "SOCUNICO_"; |FINSI;
             |SI #12#1 = 8; aNombre = "OTROS_";    |FINSI;
          |FINSI;
          |HAZ PonExtension;
          |SI nExt = 1;
              aAlfa1 = aNombre + aOrden + "." + aExtension;

               #12#3 = aAlfa1; |PINTA #12#3;

              aAlfa2 = #12#3;
              aAlfa1 = aNombre + aOrden + ".";
              |HAZ VerSiExiste;
          |SINO;
              |ERROR;
          |FINSI;
    |FINSI;
|FPRC;

|PROCESO VerSi;
   |SI #12#0 ! #900#0;
       nExiste = 1;
   |FINSI;
|FPRC;

|DEFBUCLE VerSi;
  #900#1001;
  1,6;
  001, #12#1, #12#6;
  999, #12#1, #12#6;
  ;
  NULL, VerSi;
|FIN;

|PROCESO VerSiExiste;
         nExiste = 0;
         |DBASE Comodin; |QBF Comodin;
         Comodin  = Comodin + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
         Comodin1 = Comodin + aAlfa1 + "*";
         |_PDIR Comodin1;
         |PARA; |SI FSalida = 0; |HACIENDO;
                nExiste = 1;
                |_SDIR Comodin1;
                aAlfa = Comodin1 - Comodin;
                |SI aAlfa ! aAlfa2;
                    nExiste = 2;
                |FINSI;
         |SIGUE;

         |SI nExiste = 0;
             |BUCLE VerSi;
         |FINSI;

         |SI nExiste = 1;
             |CONFI "0000NYa existe el Fichero. Desea Regrabarlo";
             |SI FSalida ! 0;
                 |ERROR;
             |FINSI;
         |FINSI;
         |SI nExiste = 2;
             |MENAV "0000Existe un fichero igual pero con distinta extension. Modifique numero";
             |ERROR;
         |FINSI;
|FPRC;

|PROCESO ClauA12;
     #12#0 = 1;
|FPRC;

|PROCESO ClauB12;
     #12#0 = 999;
|FPRC;

|PROCESO OtrosLibros;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;

     |SI #48#26 > 80;
         enEjercicio = #48#26 + 1900;
     |SINO;
         enEjercicio = #48#26 + 2000;
     |FINSI;
     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enLegEje = #caselem1#7;;

     nOpHis = 4; |HAZ LeoCabHistorico;
     |SI  swHist = 1; |ACABA; |FINSI;

     dirfich0 = #caselem1#3; |QBF dirfich0;
     |CIERRA #12;  |PATH_DAT #12 dirfich0;
     |CIERRA #900; |PATH_DAT #900 dirfich0;

     nNumeT1 = 0;  nNumeT2 = 0;  nNumeT3 = 0;
     nNumeT4 = 0;  nNumeT5 = 0;  nNumeT6 = 0;
     nNumeT7 = 0;  nNumeT8 = 0;
     nSwOp1 = 1; |BUCLE casoplil;

     |PINPA #0#12;
     |ENTLINEAL #1#12, -1, 7, 22, 0, ClauA12, ClauB12;

     |PINTA 1513, #caselem1#1;
     |PINTA 1519, #caselem1#2;
     |PINTA 1521, #48#1;
     |PINTA 1470, #caselem1#4;
     |PINTA 1570, #caselem1#5;

     nSal = 0;
     |PARA; |SI nSal = 0; |HACIENDO;
            |ENTLINEAL #1#12, -1, 2, 22, 0, ClauA12, ClauB12;
            |CONFI "0000SSon los Ficheros Correctos";
            |SI FSalida = 0;
                |HAZ CopiaNuevos;
                nSal = 1;
            |FINSI;
     |SIGUE;
     enRegisLeg = 0;
|FPRC;

|DEFBUCLE OtrosLibros;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, OtrosLibros;
|FIN;

|PROCESO Proceso17;
    |DDEF aDef;
    aDef = aDef + "casoplil";
    |CARGA_DEF aDef, fichero@;
    |SI FSalida ! 0;
         |MENAV "    Error al Carga fichero de Otros Libros";
         |ACABA;
    |FINSI;

    |PUSHV 1301 2380;
    |ABRE #48;
    |BUCLE OtrosLibros;
    |CIERRA #48;
    |HAZ ReponBotones;
    |POPV;
    |DESCARGA_DEF #900;
|FPRC;

|| ____________________ DIARIO

|PROCESO Diario;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;

     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;
     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enLegEje = #caselem1#7;;

     nOpHis   = 2;
     nTipoL   = 1;
     |HAZ LeoCabHistorico;
     |SI swHist = 0;
         |SUB_EJECUTA_NP "cadiario.tab;LEGALIA";
     |FINSI;
|FPRC;

|DEFBUCLE Diario;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Diario;
|FIN;

|PROCESO Proceso01;
     |ABRE #13;
     |ABRE #48;
     |BUCLE Diario;
     |CIERRA #48;
     |CIERRA #13;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ INVENTARIO

|PROCESO CopiaLaMemoria;
  eaDirGuarda  = aPContas + "emisiones";
  eaDirGuarda  = eaDirGuarda + "/" + eaLegEmp;
  aAlfa        = enEjercicio;
  eaDirGuarda  = eaDirGuarda + "/" + aAlfa;
  eaDirGuarda  = eaDirGuarda + "/";
  eaOrigen     = eaDirGuarda + "wmemori.doc";   ||recojo la Memoria

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
   Comodin1 = Comodin1 + "MEMORIA_*.doc";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = enNumeLeg;
   |FINSI;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1  = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
  Comodin1  = Comodin1 + "MEMORIA_" + (("000" + Numeracion) % -103) + ".doc";
  eaDestino = Comodin1;

  |COPIA_FICHERO eaOrigen, eaDestino;
   nTipoL   = 6;
   nNumer   = Numeracion;
   aNomFLeg  = "MEMORIA_" + (("000" + Numeracion) % -103) + ".doc";
   efFecha1 = fec1;
   efFecha2 = fec2;
   enRegisLeg = 0;
   |HAZ eGrabaHistLegal;
|FPRC;

|PROCESO CopiaGestion;
  eaDirGuarda  = aPContas + "emisiones";
  eaDirGuarda  = eaDirGuarda + "/" + eaLegEmp;
  aAlfa        = enEjercicio;
  eaDirGuarda  = eaDirGuarda + "/" + aAlfa;
  eaDirGuarda  = eaDirGuarda + "/";
  eaOrigen     = eaDirGuarda + "wgestio.doc";   ||recojo la Memoria

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
   Comodin1 = Comodin1 + "GESTION_*.doc";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = enNumeLeg;
   |FINSI;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1  = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
  Comodin1  = Comodin1 + "GESTION_" + (("000" + Numeracion) % -103) + ".doc";
  eaDestino = Comodin1;

  |COPIA_FICHERO eaOrigen, eaDestino;

   nTipoL   = 6;
   aNomFLeg = "GESTION_" + (("000" + Numeracion) % -103) + ".doc";
   nNumer   = Numeracion;
   efFecha1 = fec1;
   efFecha2 = fec2;
   enRegisLeg = 0;
   |HAZ eGrabaHistLegal;
|FPRC;

|PROCESO MemoriaNueva;
    |SI HaySociedad = 0;  |ACABA; |FINSI;

    aDef = aPContas + "def/zregdocu";
    |CARGA_DEF aDef, fichero@;
    |SI FSalida ! 0;
         |MENAV "    Error al Carga fichero de Registro Documentos";
         |ACABA;
    |FINSI;

    aPathContas = aPContas + "fich/";
    |PATH_DAT #900 aPathContas;

    nNume4 = enNumeLeg;
    nOpHis   = 2;
    nTipoL   = 6;
    |HAZ LeoCabHistorico;

    |ABRE #900;
    #900#0 = eaLegEmp;
    #900#1 = enEjercicio;
    |LEE 001#900=;
    |SI FSalida ! 0;
        |MENAV "    No existe Registro de Documentos de la Empresa";
    |SINO;
        |SI #900#4 = "N";
            |MENAV "    No esta creada la Memoria de la Empresa";
        |SINO;
            |HAZ CopiaLaMemoria;
        |FINSI;
        |SI enEjercicio ] 2010;
            |SI #900#8 = "N";
                |MENAV "    No esta creado el Informe de Gestion";
            |SINO;
                |HAZ CopiaGestion;
            |FINSI;
        |FINSI;
    |FINSI;
    |CIERRA #900;
    |DESCARGA_DEF #900;
    enNumeLeg = nNume4;
|FPRC;

|PROCESO ComInventario;
  nSwBal = 0;
  |DFICB Comodin; |QBF Comodin;
  Comodin = Comodin  + ((("00000" + #caselem1#1) % -105) + #caselem1#2) + "/";
  |PATH_DAT #2 Comodin;
  |ABRE #2;
  |LEE 041#2p;
  |SI FSalida = 0;
      nSwBal = 1;
  |FINSI;
  |CIERRA #2;
|FPRC;

|PROCESO Inventario;
    #48#2 = #caselem1#1;
    #48#3 = #caselem1#2;
    |LEE 000#48=;

    |SI #48#26 > 80;
        enEjercicio = #48#26 + 1900;
    |SINO;
        enEjercicio = #48#26 + 2000;
    |FINSI;
    eaLegEmp = ("00000" + #caselem1#1) % -105;
    eaLegPer = #caselem1#2;
    enLegEje = #caselem1#7;;

    Comodin = "Procesando " + #48#1;
    |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     nOpHis   = 2;
     nTipoL   = 2;
     |HAZ LeoCabHistorico;

 |SI swHist = 0;
    |SI eaFormato = "S";

        |HAZ InvNuevo;

    |SINO;
         |HAZ CopiaNuevo;

         eaLegEmp = ("00000" + #caselem1#1) % -105;
         eaLegPer = #caselem1#2;

         |HAZ ComInventario;
         |SI nSwBal = 0;
             |SUB_EJECUTA_NP "cainvaux.tab;LEGALIA";
         |SINO;
             |SUB_EJECUTA_NP "cauxinva.tab;LEGALIA";
         |FINSI;

         |SI aMemoria = "S";
             |SI enEjercicio < 2008;
                 aReser = eaMoneda;
                 |SI aReser = "E";
                     eaMoneda = "EUROS  ";
                 |SINO;
                     eaMoneda = "PESETAS";
                 |FINSI;
                 Comodin = ":contasoc/memoria1.tab;" + #caselem1#1; |SUB_EJECUTA_NP Comodin;
                 eaMoneda = aReser;
             |SINO;
                 |HAZ MemoriaNueva;
             |FINSI;
         |FINSI;

         |SI enEjercicio < 2008;
             |SUB_EJECUTA_NP "cabatodo.tab;0,12,C";   |PULSATECLA;
             |SUB_EJECUTA_NP "cabatodo.tab;0,12";     |PULSATECLA;
         |SINO;
             |SI enEjercicio > 2008;
                 |SUB_EJECUTA_NP "ca8yf001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yc001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yp001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ye001.tab;0,12,C";     |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ys001.tab;0,12,C";     |PULSATECLA;
             |SINO;
                 |SUB_EJECUTA_NP "ca8yf001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yc001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8yp001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ye001.tab;0,12";       |PULSATECLA;
                 |SUB_EJECUTA_NP "ca8ys001.tab;0,12";       |PULSATECLA;
             |FINSI;
         |FINSI;

         |SI aApertura = "N";
             Comodin = "caycosy0.tab;1,12," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;1,9," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;1,6," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;1,3," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
         |SINO;
             Comodin = "caycosy0.tab;0,12," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;0,9," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;0,6," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
             Comodin = "caycosy0.tab;0,3," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
         |FINSI;
         Comodin = "caycosy0.tab;0,0," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;

         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "PresLibr/" + eaLegEmp + eaLegPer + "/";
         Comodin1 = Comodin1 + "INV_CUEN_*.xls";

         Numeracion = enNumeLeg;;
         |_PDIR Comodin1;
         |PARA; |SI FSalida = 0; |HACIENDO;
                Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
                Numeracion = Comodin; Numeracion = Numeracion + 1;
                |_SDIR Comodin1;
         |SIGUE;

         Comodin = eaUnidadBTmp + "/tmp1.xls";
         |XCIERRA Handle;
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "PresLibr/";
         |MKDIR Comodin1;
         Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
          |MKDIR Comodin1;
          Comodin1 = Comodin1 + "INV_CUEN_" + (("000" + Numeracion) % -103) + ".xls";
          aAlfa = "";
          |IP_REMOTO aAlfa; |QBF aAlfa;
          |SI aAlfa ! "";
               |RECIBE_FICHERO Comodin, Comodin1;
          |SINO;
               |COPIA_FICHERO Comodin, Comodin1;
          |FINSI;
          aNomFLeg  = "INV_CUEN_" + (("000" + Numeracion) % -103) + ".xls";
          nTipoL    = 2;
          nNumer    = Numeracion;
          efFecha1  = fec1;
          efFecha2  = fec2;
          enRegisLeg = 0;
          |HAZ eGrabaHistLegal;
    |FINSI;
  |FINSI;
|FPRC;

|PROCESO InvNuevo;
    eaLegEmp = ("00000" + #caselem1#1) % -105;
    eaLegPer = #caselem1#2;
    enLegEje = #caselem1#7;
    |SI aApertura = "N";
        Comodin = "ca8ytodo.tab;1,12,C," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
    |SINO;
        Comodin = "ca8ytodo.tab;0,12,C," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
    |FINSI;
|FPRC;

|DEFBUCLE Inventario;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Inventario;
|FIN;

|PROCESO Proceso02;
     |ABRE #48;
     |BUCLE Inventario;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ********************************************************************
|| ____________________ MAYOR

|PROCESO Mayor;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enLegEje = #caselem1#7;

     nOpHis   = 2;
     nTipoL   = 1;
     |HAZ LeoCabHistorico;
     |SI swHist = 0;
         |SUB_EJECUTA_NP "camaydia.tab;LEGALIA";
     |FINSI;
|FPRC;

|DEFBUCLE Mayor;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Mayor;
|FIN;

|PROCESO Proceso07;
     |ABRE #48;
     |BUCLE Mayor;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ Facturas Emitidas
|PROCESO Emitidas;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;
     enLegEje = #caselem1#7;

     nOpHis   = 2;
     nTipoL   = 10;
     |HAZ LeoCabHistorico;
     |SI swHist = 0;
         |SUB_EJECUTA_NP ":modelos/dsmoy008;LEGALIA";
     |FINSI;
|FPRC;

|DEFBUCLE Emitidas;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Emitidas;
|FIN;

|PROCESO Proceso10;
     |ABRE #48;
     |BUCLE Emitidas;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;


|| ____________________ Facturas Emitidas

|PROCESO Recibidas;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;
     enLegEje = #caselem1#7;

     nOpHis   = 2;
     nTipoL   = 11;
     |HAZ LeoCabHistorico;
     |SI swHist = 0;
         |SUB_EJECUTA_NP ":modelos/dsmoy009;LEGALIA";
     |FINSI;
|FPRC;

|DEFBUCLE Recibidas;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Recibidas;
|FIN;

|PROCESO Proceso11;
     |ABRE #48;
     |BUCLE Recibidas;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ Registro de Socios
|PROCESO Socios;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;
     enLegEje = #caselem1#7;

     nOpHis   = 2;
     nTipoL   = 14;
     |HAZ LeoCabHistorico;
     |SI swHist = 0;
         |SUB_EJECUTA_NP ":modelos/dsmoy033;LEGALIA";
     |FINSI;
|FPRC;

|DEFBUCLE Socios;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Socios;
|FIN;

|PROCESO Proceso13;
     |ABRE #48;
     |BUCLE Socios;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ Bienes de Inversion Emitidas
|PROCESO Bienes;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;

     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;
     enEjercicio = #48#26;
     |SI #48#26 < 80;
         enEjercicio = enEjercicio + 2000;
     |SINO;
         enEjercicio = enEjercicio + 1900;
     |FINSI;
     enLegEje = #caselem1#7;

     nOpHis   = 2;
     nTipoL   = 20;
     |HAZ LeoCabHistorico;
     |SI swHist = 0;
         |SUB_EJECUTA_NP ":modelos/dsmoy066;LEGALIA";
     |FINSI;
|FPRC;

|DEFBUCLE Bienes;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Bienes;
|FIN;

|PROCESO Proceso12;
     |ABRE #48;
     |BUCLE Bienes;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|| ____________________ Historico Legalizacion Libros
|PROCESO Proceso09;
     |SUB_EJECUTA_NP "casopliz;LEGALIA";
|FPRC;

|| ____________________ CREACION DE FICHEROS
|PROCESO PongoNombre;
 #48#2 = #caselem1#1;
 #48#3 = #caselem1#2;
 |LEE 000#48=;
 eaAlfa = #48#1; |QBF eaAlfa;
 |HAZ QuitaRaros_D;
|FPRC;

|PROCESO PasaFicheros;
     eaLegEmp = ("00000" + #caselem1#1) % -105;
     eaLegPer = #caselem1#2;

     |DBASE Comodin1; |QBF Comodin1;
     Comodin1 = Comodin1 + "/PresLibr/";
     |MKDIR Comodin1;
     Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
     |MKDIR Comodin1;

     |DBASE aOrigen; |QBF aOrigen;
     aOrigen = aOrigen + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/*.*";
     Comodin = aOrigen - "*.*";
     |_PDIR aOrigen;
     |PARA; |SI FSalida = 0; |HACIENDO;

            |SI aMasNombre ! "S";
                aDestino = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2) + "/";
            |SINO;
                aDestino = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2);
                |HAZ PongoNombre;
                aDestino = aDestino + eaAlfa + "/";
            |FINSI;

            |RMKDIR aDestino;
            aDestino = aDestino + (aOrigen - Comodin);
            |SI Local = 0;
                |ENVIA_FICHERO aOrigen, aDestino;
            |SINO;
                |COPIA_FICHERO aOrigen, aDestino;
            |FINSI;
            |FBORRA aOrigen;
            |_SDIR aOrigen;
     |SIGUE;
     |RMDIR Comodin;
|FPRC;

|DEFBUCLE PasaFicheros;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PasaFicheros;
|FIN;

|PROCESO LasFechasDef;
     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = #caselem1#1;
     |LEE 041#agifigen.=;
     |CIERRA #agifigen;
     aDia = "01"; aMes = "Primero"; aAnyo = #caselem1#7; aAnyo = aAnyo % -102;
     |HAZ Fecha;
     |SI Fecha < #agifigen#93; ComFecha = #agifigen#93; |FINSI;
     fFecha1 = ComFecha;

     aDia = "Ultimo"; aMes = "Ultimo"; aAnyo = #caselem1#7; aAnyo = aAnyo % -102;
     |HAZ Fecha;
     |SI Fecha > #agifigen#94; |Y #agifigen#94 > "01.01.1000"; ComFecha = #agifigen#94; |FINSI;
     fFecha2 = ComFecha;

     aDia = "01"; aMes = "Primero"; aAnyo = #caselem1#7; aAnyo = aAnyo % -102;
     |HAZ Fecha;
     Fecha = ComFecha; NumFecha = Fecha; NumFecha = NumFecha - 1; Fecha = NumFecha; ComFecha = Fecha;
     fFecha3 = ComFecha;
|FPRC;

|PROCESO Fecha;
     |SI aMes = "Ultimo"; |O aMes = "Tercero"; |O aMes = "Sexto";|O aMes = "Noveno";
          |SI #48#12 ! 12;
               Calc = aAnyo; Calc = Calc + 1; aAnyo = ("00" + Calc) % -102;
          |FINSI;
     |FINSI;
     |SI aAnyo ] "80";
          aAnyo = "19" + aAnyo;
     |SINO;
          aAnyo = "20" + aAnyo;
     |FINSI;
     |SI aMes = "Primero"; aMes = ("00" + #48#11) % -102; |FINSI;
     |SI aMes = "Tercero"; aMes = ("00" + (#48#11+3)) % -102; |FINSI;
     |SI aMes = "Sexto";   aMes = ("00" + (#48#11+6)) % -102; |FINSI;
     |SI aMes = "Noveno";  aMes = ("00" + (#48#11+9)) % -102; |FINSI;
     |SI aMes = "Ultimo";  aMes = ("00" + #48#12) % -102; |FINSI;
     |SI aDia = "Primero"; aDia = "01"; |FINSI;
     |SI aDia = "Ultimo";
          |SI aMes = "02";
               |SI aAnyo = "80"; |O aAnyo = "84"; |O aAnyo = "88"; |O aAnyo = "92";
                |O aAnyo = "96"; |O aAnyo = "04"; |O aAnyo = "08"; |O aAnyo = "12";
                |O aAnyo = "16"; |O aAnyo = "20"; |O aAnyo = "24"; |O aAnyo = "28";
                    aDia = "29";
               |SINO;
                    aDia = "28";
               |FINSI;
          |SINO;
               |SI aMes = "01"; |O aMes = "03"; |O aMes = "05"; |O aMes = "07";
                |O aMes = "08"; |O aMes = "10"; |O aMes = "12";
                    aDia = "31";
               |SINO;
                    aDia = "30";
               |FINSI;
          |FINSI;
     |FINSI;
     ComFecha = aDia + "." + aMes + "." + aAnyo;
     Fecha    = ComFecha;
|FPRC;

|PROCESO SeparaNombre;
     Comodin = NombreTotal; |QBF Comodin;

     Nombre = ""; aApell1 = ""; aApell2 = "";
     Comodin = Comodin - " ";
     |SI FSalida ! 0;
          nParte1 = FSalida;
          Comodin = Comodin - ",";
          |SI FSalida ! 0;
               nParte2 = FSalida + 98;
               Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
               nParte1 = nParte1 + 98;
               aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
               aApell1 = Comodin;
          |SINO;
               Comodin = Comodin - " ";
               |SI FSalida ! 0;
                    nParte2 = FSalida + 98;
                    Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
                    nParte1 = nParte1 + 98;
                    aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
                    aApell1 = Comodin;
               |FINSI;
          |FINSI;
     |FINSI;

     |QBF Nombre; |QBF aApell1; |QBF aApell2;

     |SI Nombre ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = Nombre % 0101;
               |SI Comodin = " "; Nombre = Nombre - " "; |FINSI;
          |SIGUE;
     |FINSI;

     |SI aApell1 ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = aApell1 % 0101;
               |SI Comodin = " "; aApell1 = aApell1 - " "; |FINSI;
          |SIGUE;
     |FINSI;

     |SI aApell2 ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = aApell2 % 0101;
               |SI Comodin = " "; aApell2 = aApell2 - " "; |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO VerBueno;
        nBueno = 0;
        |SI nNumeT1 = 0;
            aAlfa1 = Comodin1 % -103; aAlfa1 = aAlfa1 < " ";
            |SI eaFormato ! "S";
                |SI aAlfa1 = "xls"; |O aAlfa1 = "doc";
                    nBueno = 1;
                |FINSI;
            |SINO;
                |SI aAlfa1 =  "pdf";
                    nBueno = 1;
                |FINSI;
            |FINSI;
        |SINO;
            aAlfa1 = Comodin1 % -103; aAlfa1 = aAlfa1 < " ";
            |SI aAlfa1 = "xls"; |O aAlfa1 = "doc"; |O aAlfa1 = "pdf";
                nBueno = 1;
            |SINO;
               aAlfa1 = Comodin1 % -104; aAlfa1 = aAlfa1 < " ";
               |SI aAlfa1 =  "xlsx";  |O aAlfa1 = "docx";
                   nBueno = 2;
               |FINSI;
            |FINSI;
        |FINSI;
|FPRC;

|PROCESO CuentaLibros;

     dirfich0 = #caselem1#3; |QBF dirfich0;
     |CIERRA #12; |PATH_DAT #12 dirfich0;
     nNumeT1 = 0;
     nSwOp1 = 3; |BUCLE casoplil;

     nNumLibros = 0;
     |SI enEjercicio ] 2015;
         nDTipoL = 1; nHTipoL = 20; nOpLeg = 2; |BUCLE PasaSoplih;
     |SINO;
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
         Comodin1 = Comodin1 + "*.*";
         |_PDIR Comodin1;
         |PARA; |SI FSalida = 0; |HACIENDO;
                |HAZ VerBueno;
                |SI nBueno ! 0;
                   nNumLibros = nNumLibros + 1;
                |FINSI;
                |_SDIR Comodin1;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO GrabaLinea;
   aAlfa = Comodin; |QBF aAlfa;
   |SI aAlfa ! "";
       Comodin = Handle + " " + aCasilla + Comodin + &13 + &10;
       |FGRABA Comodin;
   |FINSI;
|FPRC;

|PROCESO CreaSecuenciales;

     |DBASE Directorio; |QBF Directorio;
     Directorio = Directorio + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";

     Comodin = "wb  " + Directorio + "desc.txt";
     |FABRE Comodin;
     |SI FSalida ] 0;
        Handle = FSalida;

        Comodin = Handle + " " + #casoplib#2 + &13 + &10;  |FGRABA Comodin;

        Comodin = #0#1;
        Comodin = Handle + " " + " Ejercicio=" + Comodin + &13 + &10;  |FGRABA Comodin;

        |SI nSociedad ! 0;
            Comodin = Handle + " TipoPersona=J" + &0;  |FGRABA Comodin;
        |SINO;
            Comodin = Handle + " TipoPersona=F" + &0;  |FGRABA Comodin;
        |FINSI;
        FSalida = Handle; |FCIERRA FSalida;
     |FINSI;

     Comodin = "wb  " + Directorio + "nombres.txt";
     |FABRE Comodin;
     |SI FSalida ] 0;
         Handle = FSalida;
         |SI enEjercicio ] 2015;
             nDTipoL= 1; nHTipoL = 20; nOpLeg = 1; |BUCLE PasaSoplih;
         |SINO;
             Handle = FSalida; Nombre = "";
             |DBASE Comodin1; |QBF Comodin1;
             Comodin1 = Comodin1 + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
             Comodin1 = Comodin1 + "*.*";
             |_PDIR Comodin1;
             |PARA; |SI FSalida = 0; |HACIENDO;
                    aLong = Comodin1 % 0; nLong = aLong;

                    |HAZ VerBueno;
                    |SI nBueno ! 0;
                        |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                              Calc = -((nCont * 100) + 1);
                              Caracter = Comodin1 % Calc;
                              |SI Caracter = "/";
                                  |SAL;
                              |SINO;
                                  Nombre = Caracter + Nombre;
                              |FINSI;
                        |SIGUE;
                        Nombre = Nombre > " ";
                        Nombre = Handle + " " + Nombre + &13 + &10; |FGRABA Nombre;
                        Nombre = "";
                    |FINSI;

                    |_SDIR Comodin1;
               |SIGUE;
         |FINSI;
         FSalida = Handle;
         |FCIERRA FSalida;
     |SINO;

          aAlfa1 = "0000[" + (Comodin % 5) "] inaccesible.";
          |MENAV aAlfa1;
          nErrorSec = 1;
          |ACABA;

     |FINSI;

     Comodin = "wb  " + Directorio + "datos.txt";
     |FABRE Comodin;
     |SI FSalida ] 0;
          Handle = FSalida;

          aCasilla = "100"; Comodin = #casoplib#10;
          |QBF Comodin;
          |HAZ GrabaLinea; || Provincia Presentacion
          Comodin = #casoplib#30; |QBF Comodin;
          Comodin = Comodin - "."; Comodin = Comodin - ".";
          aCasilla = "101";                         |HAZ GrabaLinea; || Fecha solicitud
          aCasilla = "102"; Comodin = #casoplib#4;  |HAZ GrabaLinea; || Nombre Empresario
          aCasilla = "103"; Comodin = #casoplib#5;  |HAZ GrabaLinea; || 1 Apellido Empresario
          aCasilla = "104"; Comodin = #casoplib#6;  |HAZ GrabaLinea; || 2 Apellido Empresario
          aCasilla = "105"; Comodin = #casoplib#3;  |HAZ GrabaLinea; || NIF Empresario
          aCasilla = "106"; Comodin = #casoplib#7;  |HAZ GrabaLinea; || Direccion Empresario
          aCasilla = "107"; Comodin = #casoplib#9;  |HAZ GrabaLinea; || Localidad Empresario
          aCasilla = "108"; Comodin = #casoplib#8;  |HAZ GrabaLinea; || C.P. Empresario
          aCasilla = "109"; Comodin = (#casoplib#8 % 0102); |HAZ GrabaLinea; || Cod.Provincia Empresario
          aCasilla = "110"; Comodin = #casoplib#12; |HAZ GrabaLinea; || Fax Empresario
          aCasilla = "111"; Comodin = #casoplib#11; |HAZ GrabaLinea; || Telefono Empresario

          aCasilla = "112"; Comodin = "";
          |SI #casoplib#37 ! 0;
              Comodin = ("00000" + #casoplib#37) % -105;
          |FINSI;
          |HAZ GrabaLinea; || Codigo de Registro

          aCasilla = "201"; Comodin = #casoplib#23; |HAZ GrabaLinea; || N Tomo Registro
          aCasilla = "202"; Comodin = #casoplib#24; |HAZ GrabaLinea; || N Libro Registro
          aCasilla = "203"; Comodin = #casoplib#25; |HAZ GrabaLinea; || N Seccion Registro
          aCasilla = "204"; Comodin = #casoplib#26; |HAZ GrabaLinea; || N Folio Registro
          aCasilla = "205"; Comodin = "REGISTRO MERCANTIL"; |HAZ GrabaLinea; || Tipo Registro Publico
          || ...  aCasilla = "205"; Comodin = #casoplib#27; |HAZ GrabaLinea; || Tipo Registro Publico
          aCasilla = "206"; Comodin = #casoplib#31; |HAZ GrabaLinea; || N Hoja Registro
          aCasilla = "207"; Comodin = #casoplib#38; |HAZ GrabaLinea; || Otros (Datos Registrables)

          aCasilla = "301"; Comodin = #casoplib#14; |HAZ GrabaLinea; || Nombre Representante
          aCasilla = "302"; Comodin = #casoplib#15; |HAZ GrabaLinea; || 1 Apellido Representante
          aCasilla = "303"; Comodin = #casoplib#16; |HAZ GrabaLinea; || 2 Apellido Representante
          aCasilla = "304"; Comodin = #casoplib#13; |HAZ GrabaLinea; || DNI Representante
          aCasilla = "305"; Comodin = #casoplib#17; |HAZ GrabaLinea; || Direccion Representante
          aCasilla = "306"; Comodin = #casoplib#19; |HAZ GrabaLinea; || Localidad Representante
          aCasilla = "307"; Comodin = #casoplib#18; |HAZ GrabaLinea; || C.P. Representante
          aCasilla = "308"; Comodin = #casoplib#20; |HAZ GrabaLinea; || Provincia Representante
          aCasilla = "309"; Comodin = #casoplib#22; |HAZ GrabaLinea; || Fax Representante
          aCasilla = "310"; Comodin = #casoplib#21; |HAZ GrabaLinea; || Telefono Representante
          aCasilla = "311"; Comodin = #casoplib#39; |HAZ GrabaLinea; || Correo Electronico Representante

          aCasilla = "401"; Comodin = #casoplib#29; |HAZ GrabaLinea; || Solicita Retencion

          aCasilla = "501";
          Comodin = ("000" + #casoplib#28) % -103;  |HAZ GrabaLinea; || Numero libros presentados

          Numeracion = 1;
          |SI enEjercicio ] 2015;

              nDTipoL = 1; nHTipoL = 20; nOpLeg = 0; |BUCLE PasaSoplih;

          |SINO;
              |DBASE Comodin1; |QBF Comodin1;
              Comodin1 = Comodin1 + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/";
              Comodin1 = Comodin1 + "*.*";
              |_PDIR Comodin1;
              |PARA; |SI FSalida = 0; |HACIENDO;
                    aLong = Comodin1 % 0; nLong = aLong;

                    |HAZ VerBueno;
                    |SI nBueno ! 0;
                        |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                             Calc = -((nCont * 100) + 1);
                             Caracter = Comodin1 % Calc;
                             |SI Caracter = "/";
                                  |SAL;
                             |SINO;
                                  Nombre = Caracter + Nombre;
                             |FINSI;
                        |SIGUE;
                        |SI nBueno = 1;
                            Comodin3 = Nombre % -107; Nombre = Nombre - Comodin3; Nombre = Nombre > "";
                        |SINO;
                            Comodin3 = Nombre % -108; Nombre = Nombre - Comodin3; Nombre = Nombre > "";
                        |FINSI;
                        Comodin3 = Comodin3 % 0103;
                        aNumer = ("000" + Numeracion) % -103;
                        Numeracion = Numeracion + 1;
                        |SI Nombre = "DIARIO_";
                            Comodin2 = Handle + " " + aNumer + "01Diario                          " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "INV_CUEN_";
                            Comodin2 = Handle + " " + aNumer + "01Inventario y cuentas anuales    " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "BAL_SUMS_";
                            Comodin2 = Handle + " " + aNumer + "01Balance comprob.sumas y saldos  " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "FAC_EMIT_";
                            Comodin2 = Handle + " " + aNumer + "01Libro de facturas emitidas      " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "FAC_RECI_";
                            Comodin2 = Handle + " " + aNumer + "01Libro de facturas recibidas     " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "MEMORIA_";
                            Comodin2 = Handle + " " + aNumer + "01Memoria                         " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "GESTION_";
                            Comodin2 = Handle + " " + aNumer + "01Informe de Gestion              " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "ACCIONES_";
                            Comodin2 = Handle + " " + aNumer + "01Registro de Acciones Nominativas" + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "SOCIOS_";
                            Comodin2 = Handle + " " + aNumer + "01Registro de Socios              " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "ACTASCON_";
                            Comodin2 = Handle + " " + aNumer + "01Libro de Actas                  " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "ACTASDET_";
                            Comodin2 = Handle + " " + aNumer + "01Libro de Detalle de Actas       " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "ACTALCON_";
                            Comodin2 = Handle + " " + aNumer + "01Libro de Actas del Consejo      " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "ACTACODE_";
                            Comodin2 = Handle + " " + aNumer + "01Libro de Detalle de Actas del Consejo " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "SOCUNICO_";
                            Comodin2 = Handle + " " + aNumer + "01Libro-registro de Contratos del Socio Unico con la Sociedad Unipersonal" + &13 + &10; |FGRABA Comodin2;
                        |FINSI;
                        |SI Nombre = "OTROS_";
                            Comodin2 = Handle + " " + aNumer + "01Otros                           " + &13 + &10; |FGRABA Comodin2;
                        |FINSI;

                       Comodin2 = Handle + " " + aNumer + "02" + Comodin3 + &13 + &10; |FGRABA Comodin2;

                       aNombre = Nombre;
                       nNumer  = Comodin3;
                       aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
                       |HAZ Fecha;
                       |SI Fecha < #agifigen#93; ComFecha = #agifigen#93; |FINSI;
                       fFecha1 = ComFecha;
                       ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                       Comodin2 = Handle + " " + aNumer + "03" + ComFecha + &13 + &10; |FGRABA Comodin2;

                       aDia = "Ultimo"; aMes = "Ultimo"; aAnyo = (("00" + #48#26) % -102);
                       |HAZ Fecha;
                       |SI Fecha > #agifigen#94; |Y #agifigen#94 > "01.01.1000"; ComFecha = #agifigen#94; |FINSI;
                       fFecha2 = ComFecha;
                       ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                       Comodin2 = Handle + " " + aNumer + "04" + ComFecha + &13 + &10; |FGRABA Comodin2;

                       aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
                       |HAZ Fecha;
                       Fecha = ComFecha; NumFecha = Fecha; NumFecha = NumFecha - 1; Fecha = NumFecha; ComFecha = Fecha;
                       fFecha3 = ComFecha;
                       ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                       Comodin2 = Handle + " " + aNumer + "05" + ComFecha + &13 + &10; |FGRABA Comodin2;
                       Nombre = "";

                    |FINSI;
                    |_SDIR Comodin1;
              |SIGUE;
         |FINSI;
         FSalida = Handle;
         |FCIERRA FSalida;
     |SINO;
          aAlfa1 = "0000[" + (Comodin % 5) "] inaccesible.";
          |MENAV aAlfa1;
          nErrorSec = 1;
     |FINSI;
|FPRC;

|PROCESO LeeSecre;
  nSecretario = 1;
  nClau1 = #agim0026#1;
  nClau2 = #agim0026#2;
|FPRC;

|DEFBUCLE LeeSecretario;
 #agim0026#1;
 16;
 enEmpresa, 01, 01, 03;
 enEmpresa, 99, 99, 03;
 e;
 NULL, LeeSecre;
|FIN;

|PROCESO LeeRepre;
  |SI #agim0024#15 ! "A";
      nSecretario = 1;
      nClau1 = #agim0024#1;
      nClau2 = #agim0024#2;
      |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE LeeRepresentante;
 #agim0024#1;
 ;
 enEmpresa, nSociedad, 01;
 enEmpresa, nSociedad, 99;
 e;
 NULL, LeeRepre;
|FIN;

|PROCESO MiraCabecera;

     enEmpresa = #48#2;
     enPeriodo = #48#3;
     enEjercicio = #48#26 + 2000;

     nSociedad = 0;
     |DDEFECTO #agim0019;
     |ABRE #agim0019;
     #agim0019#0 = enEmpresa;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
          |LEE 000#agim0019.a;
     |SINO;
          |LEE 000#agim0019.u;
     |FINSI;
     |SI FSalida ! 0;|O #agim0019#0 ! enEmpresa;
          |DDEFECTO #agim0019;
          nSociedad = 0;
     |SINO;
          nSociedad = #agim0019#1;
     |FINSI;
     |CIERRA #agim0019;

     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = enEmpresa;
     |LEE 041#agifigen.=;
     |CIERRA #agifigen;

     nSw15 = 0;
     |ABRE #agicen15;
     |DDEFECTO #agicen15;
     #agicen15#0 = enEmpresa;
     |LEE 041#agicen15.=;
     |SI FSalida = 0; nSw15 = 1; |FINSI;
     |CIERRA #agicen15;

     nDSocial = 0;
     |SI HayAcceso = 1;
         |ABRE #205;
         #205#0 = enEmpresa;
         #205#1 = 97;
         |LEE 041#205=;
         |SI FSalida = 0;
             nDSocial = 1;
         |FINSI;
         |CIERRA #205;
    |FINSI;

     nSecretario = 0;           || Tique 2422_801 / 3725_510
     |BUCLE LeeRepresentante;
     |SI nSecretario = 0;
         |DDEFECTO #agim0024;
         #agim0024#4 = "<representante_no_informado>";
     |SINO;
         |ABRE #agim0024;
         #agim0024#0 = enEmpresa;
         #agim0024#1 = nClau1;
         #agim0024#2 = nClau2;
         |LEE 041#agim0024.=;
         |CIERRA #agim0024;
     |FINSI;

     |DDEFECTO #0;
     #0#0 = enEmpresa;
     #0#1 = enEjercicio;
     |LEE 141#0=;
     nEstado = FSalida;

     #casoplib#28 = ("000" + nNumLibros) % -103;
     #casoplib#0 = enEmpresa;      || codigo
     #casoplib#1 = enEjercicio;    || ejercicio

     #casoplib#2 = #agifigen#1;          || nombre
     #casoplib#3 = #agifigen#13;         || cif

     NombreTotal = #agifigen#2;
     |HAZ SeparaNombre;
     aAlfa = #casoplib#3; |QBF aAlfa; aAlfa = aAlfa % 0101;
     |SI aAlfa = "A"; |O aAlfa = "B"; |O aAlfa = "E";
        aApell1 = ""; aApell2 = "";
     |FINSI;
     |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
          #casoplib#4 = Nombre;
          #casoplib#5 = aApell1;
          #casoplib#6 = aApell2;
     |SINO;
          #casoplib#4 = NombreTotal;
          #casoplib#5 = "";
          #casoplib#6 = "";
     |FINSI;

     |SI nDSocial = 0;
         aAlfa0 = #agifigen#3; |QBF aAlfa0;
         |SI aAlfa0 ! ""; aAlfa0 = aAlfa0 + " "; |FINSI;
         aAlfa1 = #agifigen#4; |QBF aAlfa1;
         aAlfa2 = #agifigen#5; |QBF aAlfa2;
         |SI aAlfa2 ! "";  aAlfa2 = ", " + aAlfa2; |FINSI;
         aAlfa3 = #agifigen#6; |QBF aAlfa3;
         aAlfa4 = #agifigen#7; |QBF aAlfa4;
         aAlfa5 = #agifigen#8; |QBF aAlfa5;
         aAlfa6 = aAlfa0 + aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4 + aAlfa5;
         #casoplib#7  = aAlfa6;

         aAlfa1 = #agifigen#9;  |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
         aAlfa2 = #agifigen#10; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#8  = aAlfa3;

         #casoplib#9  = #agifigen#11;
         #casoplib#10 = #agifigen#12;
     |SINO;
         aAlfa0 = #dsam0005#3; |QBF aAlfa0;
         |SI aAlfa0 ! ""; aAlfa0 = aAlfa0 + " "; |FINSI;
         aAlfa1 = #dsam0005#4; |QBF aAlfa1;
         aAlfa2 = #dsam0005#5; |QBF aAlfa2;
         |SI aAlfa2 ! "";  aAlfa2 = ", " + aAlfa2; |FINSI;
         aAlfa3 = #dsam0005#6; |QBF aAlfa3;
         aAlfa4 = #dsam0005#7; |QBF aAlfa4;
         aAlfa5 = #dsam0005#8; |QBF aAlfa5;
         aAlfa6 = aAlfa0 + aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4 + aAlfa5;
         #casoplib#7  = aAlfa6;

         aAlfa1 = #dsam0005#9;  |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
         aAlfa2 = #dsam0005#10; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa3 = aAlfa1 + aAlfa2;
         #casoplib#8  = aAlfa3;

         #casoplib#9  = #dsam0005#11;
         #casoplib#10 = #dsam0005#12;
     |FINSI;
     #casoplib#11 = #agifigen#14;
     #casoplib#12 = #agifigen#15;


     |SI #11#18 = "N";
         |SI nSociedad ! 0;
             #casoplib#13 = #agim0024#3;
             NombreTotal  = #agim0024#4;
             |HAZ SeparaNombre;
             |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
                  #casoplib#14 = Nombre;
                  #casoplib#15 = aApell1;
                  #casoplib#16 = aApell2;
             |SINO;
                  #casoplib#14 = NombreTotal;
                  #casoplib#15 = "";
                  #casoplib#16 = "";
             |FINSI;
             aAlfa1 = #agim0024#7;  |QBF aAlfa1;
             aAlfa2 = #agim0024#8;  |QBF aAlfa2;
             |SI aAlfa2 ! ""; aAlfa2 = ", " + aAlfa2; |FINSI;
             aAlfa3 = aAlfa1 + aAlfa2;
             #casoplib#17  = aAlfa3;

             aAlfa1 = #agim0024#9;  |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
             aAlfa2 = #agim0024#10; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
             aAlfa3 = aAlfa1 + aAlfa2;
             #casoplib#18  = aAlfa3;

             #casoplib#19 = #agim0024#11;
             #casoplib#20 = #agim0024#12;
             #casoplib#21 = #agim0024#13;

             #casoplib#23 = #agim0019#29;
             #casoplib#24 = #agim0019#30;
             #casoplib#25 = #agim0019#31;
             #casoplib#26 = #agim0019#32;
             #casoplib#27 = #agim0019#25;
             #casoplib#31 = #agim0019#33;
         |SINO;
             #casoplib#13 = #casoplib#3;
             #casoplib#14 = #casoplib#4;
             #casoplib#15 = #casoplib#5;
             #casoplib#16 = #casoplib#6;
             #casoplib#17 = #casoplib#7;
             #casoplib#18 = #casoplib#8;
             #casoplib#19 = #casoplib#9;
             #casoplib#20 = #casoplib#10;
             #casoplib#21 = #casoplib#11;
             #casoplib#22 = #casoplib#12;
         |FINSI;
         |SI nSecretario = 0; |Y nSw15 = 1;
             #casoplib#13 = #agicen15#4;
             NombreTotal  = #agicen15#5;
             |HAZ SeparaNombre;
             |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
                 #casoplib#14 = Nombre;
                 #casoplib#15 = aApell1;
                 #casoplib#16 = aApell2;
            |SINO;
                 #casoplib#14 = NombreTotal;
                 #casoplib#15 = "";
                 #casoplib#16 = "";
            |FINSI;
            aAlfa1 = #agicen15#8;  |QBF aAlfa1;
            aAlfa2 = #agicen15#9;  |QBF aAlfa2;
            |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + " "; |FINSI;
            aAlfa1 = aAlfa1 + aAlfa2;
            aAlfa2 = #agicen15#10; |QBF aAlfa2;
            |SI aAlfa2 ! ""; aAlfa2 = ", " + aAlfa2; |FINSI;
            aAlfa3 = aAlfa1 + aAlfa2;
            #casoplib#17  = aAlfa3;

            aAlfa1 = #agicen15#15; |QBF aAlfa1; aAlfa1 = ("00"  + aAlfa1) % -102;
            aAlfa2 = #agicen15#16; |QBF aAlfa1; aAlfa2 = ("000" + aAlfa2) % -103;
            aAlfa3 = aAlfa1 + aAlfa2;
            #casoplib#18  = aAlfa3;

            #casoplib#19 = #agicen15#17;
            #casoplib#20 = #agicen15#18;
            #casoplib#21 = #agicen15#14;
         |FINSI;
    |SINO;
         |PARA nPara1 = 13; |SI nPara1 [ 22; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 6;
               #casoplib#nPara1# = #11nPara2;
         |SIGUE;
         #casoplib#39 = #11#29;
    |FINSI;

    |SI nSociedad ! 0;
        #casoplib#37 = #agim0019#91;
        #casoplib#23 = #agim0019#29;
        #casoplib#24 = #agim0019#30;
        #casoplib#25 = #agim0019#31;
        #casoplib#26 = #agim0019#32;
        #casoplib#27 = #agim0019#25;
        #casoplib#31 = #agim0019#33;
    |SINO;
        |ABRE #agim0056;
        |SELECT #2#agim0056;
        #agim0056#3 = #casoplib#10;
        |LEE 041#agim0056.=;
        |SI FSalida = 0;
            #casoplib#37 = #agim0056#0;
        |FINSI;
        |SELECT #1#agim0056;
        |CIERRA #agim0056;
    |FINSI;

    |PULSATECLA;
|FPRC;

|PROCESO Libros;
     nNume1 = #casoplib#28;
     #casoplib#28 = ("000" + nNume1) % -103;
     |PINTA #casoplib#28;
|FPRC;

|PROCESO Secuenciales;
     |SI #caselem1#7 ] 2015; |Y nAny = 0;
         nAny = 1;
         |CONFI "0000SDesea dejar la Legalizacion como Archivada";
         |SI FSalida = 0;
             aArchLeg = "S";
         |FINSI;
     |FINSI;
     |SI #caselem1#7 ] 2015;
         nOpHis = 1; |HAZ LeoCabHistorico;
         |SI swHist = 1; |ACABA; |FINSI;
     |FINSI;

     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 000#48=;
     |SI FSalida = 0;

          Comodin = "Procesando " + #48#1;
          |ATRI I; |PINTA 2110, Comodin; |ATRI N;
          |HAZ CuentaLibros;
          |HAZ MiraCabecera;

          |SI nVerDat = 1;
              |PUSHV 0501 2380;
              |PINPA #0#casoplib;
              |PINDA #0#casoplib;
              nSalir = 1;
              |PARA; |SI nSalir ! 0; |HACIENDO;
                     |ENDATOS #1#casoplib;
                     nSalir = FSalida;
              |SIGUE;
              |SI nEstado = 0; |GRABA 020#casoplib.a; |FINSI;
              |SI nEstado ! 0; |GRABA 020#casoplib.n; |FINSI;
              |LIBERA #casoplib;
              |POPV;
          |FINSI;
          |SI #casoplib#28 ! "000";
              |HAZ CreaSecuenciales;
          |FINSI;
     |FINSI;

|FPRC;

|DEFBUCLE Secuenciales;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Secuenciales;
|FIN;

|PROCESO Proceso14;
     aArchLeg = "N";
     nAny      = 0;
     |ABRE #48;
     |ABRE #0;
     |BUCLE Secuenciales;
     |CIERRA #0;
     |CIERRA #48;

     |BUCLE PasaFicheros;
     |HAZ ReponBotones;

     |PULSATECLA;
|FPRC;

|| ____________________ SALIR

|PROCESO Proceso15;
     Calc = 1;
     |PULSATECLA;
     |PTEC 801;
|FPRC;

|| ____________________ ETIQUETAS

|PROCESO Etiquetas;
     #48#2 = #caselem1#1;
     #48#3 = #caselem1#2;
     |LEE 041#48=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;

     nNume1 = #48#26 + 2000;
     #casoplib#32  = "LIBROS OFICIALES";
     #casoplib#33  = "EJERCICIO " + nNume1;
     #casoplib#34  = #48#2 + "/" + #48#3;
     #casoplib#35  = #48#1;
     #casoplib#36  = #48#8;

     |INFOR "casoplib";
     |SI FSalida = 0;
          |PRINT;
          |PIEINF;
     |SINO;
          |MENAV "0000Informe [casoplib] inaccesible";
     |FINSI;
     |FININF;
|FPRC;

|DEFBUCLE Etiquetas;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Etiquetas;
|FIN;

|PROCESO Proceso16;
     |SI eaFormato ! "S";
         |HAZ QuitaExcel;
     |FINSI;
     Impresora = "Pantalla Estandard";
     |IMPRE 0;
     |SI FSalida = 0;
         |ABRE #48;
         |BUCLE Etiquetas;
         |CIERRA #48;
     |FINSI;
     |FINIMP;
     |SI eaFormato ! "S";
         |HAZ PonExcel;
     |FINSI;
     |HAZ ReponBotones;
|FPRC;

|| /////////////////////////////////////////////

|PROCESO ReponBotones;
   |MENAV "0000Proceso terminado.";
   |BLIN 21;
|FPRC;

|PROCESO Borrado;
        |SI aBorro = "S";

            nOpHis = 0; |HAZ LeoCabHistorico;

            |SI swHist = 0;

                dirfich0 = #998#3; |QBF dirfich0;
                |CIERRA #12;|PATH_DAT #12 dirfich0;
                nSwOp1 = 4; |BUCLE casoplil;

                |SI aMasNombre ! "S";
                    Comodin = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2) + "/";
                |SINO;
                    Comodin = aPath + ((("00000" + #caselem1#1) % -105) + #caselem1#2);
                    |HAZ PongoNombre;
                    Comodin = Comodin + eaAlfa + "/";
                |FINSI;

                Comodin1 = Comodin + "datos.txt";   |RFBORRA Comodin1;
                Comodin1 = Comodin + "desc.txt";    |RFBORRA Comodin1;
                Comodin1 = Comodin + "nombres.txt"; |RFBORRA Comodin1;

                |PARA nCont = nDesde; |SI nCont [ nHasta; |HACIENDO nCont = nCont + 1;

                      Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xls";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xlsx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;

                      Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".doc";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".docx";
                      |RFBORRA Comodin1;


                      Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;
                      Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".pdf";
                      |RFBORRA Comodin1;

                 |SIGUE;
                 |RRMDIR Comodin;
            |FINSI;
        |FINSI;

        |SI aBorroS = "S";
            |DBASE aOrigen; |QBF aOrigen;
            aOrigen = aOrigen + "PresLibr/" + (("00000" + #caselem1#1) % -105) + #caselem1#2 + "/*.*";
            Comodin = aOrigen - "*.*";
            |_PDIR aOrigen;
            |PARA; |SI FSalida = 0; |HACIENDO;
                   |FBORRA aOrigen;
                   |_SDIR aOrigen;
            |SIGUE;

            nOpHis = 3; |HAZ LeoCabHistorico;

            dirfich0 = #998#3; |QBF dirfich0;
            |CIERRA #12;|PATH_DAT #12 dirfich0;
            nSwOp1 = 0; |BUCLE casoplil;
        |FINSI;
|FPRC;

|DEFBUCLE Borrado;
     #caselem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Borrado;
|FIN;

||...................................................................
|PROCESO QuitaExcel;
     || ... Impresora = "";
     |SI enBasImp ! 0;  |ACABA; |FINSI;

     Comodin = "0,9," + aImpre;
     |MENUITEM 0,Comodin;
|FPRC;

|PROCESO PonExcel;
     || .... Impresora = "Excel";

     Comodin = "0,9,1";
     |MENUITEM 0,Comodin; EstadoAnt = FSalida;
     aEstado = FSalida;
     |SI FSalida = "UNCHECKED";
          Comodin = "0,9,0";
          |MENUITEM 0,Comodin;
          aImpre = "0";
     |SINO;
          aImpre = "1";
     |FINSI;

     |SI aEstado = "CHECKED";  |O aEstado = "UNCHECKED";
         enBasImp = 0;  || .... BASICO 9
         eaNomImp = "";
     |SINO;
         enBasImp = 1;  || .... BASICO 9 - 10
         eaNomImp = "ExcelEstandard";
     |FINSI;
|FPRC;

|PROCESO ConRayas;
     |SI nDejaSI = 1;
          |ABRE #8;
          |DDEFECTO #8;
          #8#0 = 1;
          |LEE 101#8=;
          |SI FSalida ! 0;
              |DDEFECTO #8;
              #8#0 = 1;
              |GRABA 020#8b;
          |FINSI;
          #caconimp#4 = "S";
          |GRABA 020#8a;
          |LIBERA #8;
          |CIERRA #8;
     |FINSI;
|FPRC;

|PROCESO SinRayas;
     nDejaSI = 0;
     |ABRE #8;
     |DDEFECTO #8;
     #8#0 = 1;
     |LEE 101#8=;
     |SI FSalida ! 0;
          |DDEFECTO #8;
          #8#0 = 1;
          |GRABA 020#8b;
     |FINSI;
     |SI #8#4 = "S";
          nDejaSI = 1;
     |FINSI;
     #8#4 = "N";
     |GRABA 020#8a;
     |LIBERA #8;
     |CIERRA #8;
|FPRC;

|| ...................................................................
|PROCESO CargaArbol;
     aAlfa = aAlfa + &13 + &10;

     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO LosBotones;
     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "/tmp";  |MKDIR aAlfa;

     |DFICE aAlfa;
     aAbre = aAlfa + "men" + Usuario + ".txt";
     |XABRE "WB", aAbre, nHandle;

     aAlfa = "Datos Legalizacion de Libros";             |HAZ CargaArbol;
     aAlfa = "Diario Ampliado";                          |HAZ CargaArbol;
     aAlfa = "Inventario y cuentas anuales";             |HAZ CargaArbol;
     aAlfa = "Incorporar Otros Libros: Actas y otros";   |HAZ CargaArbol;
     aAlfa = "Registro de Socios";                       |HAZ CargaArbol;
     aAlfa = "Facturas Emitidas";                        |HAZ CargaArbol;
     aAlfa = "Facturas Recibidas";                       |HAZ CargaArbol;
     aAlfa = "Bienes Inversion Reg.Prorrata";            |HAZ CargaArbol;
     aAlfa = "Diario Resumido";                          |HAZ CargaArbol;
     aAlfa = "Generar ficheros";                         |HAZ CargaArbol;
||     aAlfa = "Imprimir Etiquetas";                       |HAZ CargaArbol;
||     aAlfa = "Salir";                                    |HAZ CargaArbol;

     |XCIERRA nHandle;

     nOpcion     = 1;
     nTotalLinea = 0;
     nConta      = -1;
     nBaffer     = 0;

     |LEESECUENCIAL aAbre, nBaffer, nTotalLinea, 0, 0;

     nOpcion = 1;
     |PARA; |SI;  |HACIENDO;
          |ATRI P; |PINTA 2118, "<Esc>Salir"; |ATRI 0;
          |BMENUG nBaffer, 0, 1, nTotalLinea, 22, nOpcion;
          nOpcion     = FSalida;
          nCogeOpcion = nOpcion - 1;
          |SI FSalida [ nTotalLinea; |Y FSalida ] 1;
              |DEL_BUF nBaffer, nCogeOpcion, aDestino;

              |SI nOpcion = 1;  |HAZ Proceso09;  |FINSI;
              |SI nOpcion = 2;  |HAZ Proceso01;  |FINSI;
              |SI nOpcion = 3;  |HAZ Proceso02;  |FINSI;
              |SI nOpcion = 4;  |HAZ Proceso17;  |FINSI;
              |SI nOpcion = 5;  |HAZ Proceso13;  |FINSI;
              |SI nOpcion = 6;  |HAZ Proceso10;  |FINSI;
              |SI nOpcion = 7;  |HAZ Proceso11;  |FINSI;
              |SI nOpcion = 8;  |HAZ Proceso12;  |FINSI;
              |SI nOpcion = 9;  |HAZ Proceso07;  |FINSI;
              |SI nOpcion = 10; |HAZ Proceso14;  |FINSI;

         ||     |SI nOpcion = 11; |HAZ Proceso16;  |FINSI;
         ||     |SI nOpcion = nTotalLinea;  |SAL;  |FINSI;
         |SINO;
             |SI FSalida [ 0;
                 |CONFI "0000SSalir de la Legalizacion";
                 |SI FSalida = 0;
                     |SAL;
                 |FINSI;
            |FINSI;
         |FINSI;
     |SIGUE;

     |FBORRA aAbre;
|FPRC;

|| ////////////////////////////////////////////////////////////
|PROCESO Letra_0;  |TIPO 6;
   nInkey = FSalida;
   |SI nInkey = 10;
      enCalcCif = 1;
      eaVarDni  = #11Campo;
      |HAZ CalculoDNI;
      #11Campo = eaVarDni;
      |PINTA #11Campo;
      |ERROR;
      |ACABA;
   |FINSI;

    eaVarDni  = #11Campo;
    enCalcCif = 0;
    |HAZ CalculoDNI;
    eaVarDni = (eaVarDni + "                ") % 115;
    |SI #11Campo ! eaVarDni;
        |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
        |SI FSalida = 0;
            #11Campo = eaVarDni;  |PINTA #11Campo;
            |ERROR;
            |ACABA;
        |FINSI;
    |FINSI;

    |SI Haybasica = 0; |Y HayAcceso = 0; |ACABA; |FINSI;
    eaCodNif = #11#19;
    |HAZ LeeNifs;
    |SI #11#19 ! aAnterior;

        NombreTotal  = #709#1;
        |HAZ SeparaNombre;
        |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
              #11#20 = Nombre;
              #11#21 = aApell1;
              #11#22 = aApell2;
         |SINO;
              #11#20 = NombreTotal;
              #11#21 = "";
              #11#22 = "";
         |FINSI;
         |PINTA #11#20;
         |PINTA #11#21;
         |PINTA #11#22;

         aAlfa  = #709#9;  |QBF aAlfa;
         |SI aAlfa = "";
             #11#23 = #709#2;
         |SINO;
             #11#23 = aAlfa + " " + #709#2;
         |FINSI;
         aAlfa  = #11#23; |QBF aAlfa;
         #11#23 = aAlfa + ", " + #709#3;
         aAlfa  = #11#23; |QBF aAlfa;
         #11#23 = aAlfa + " " + #709#10;
         aAlfa  = #11#23; |QBF aAlfa;
         #11#23 = aAlfa + " " + #709#11;

         |PINTA #11#23;

         #11#30 = #709#4;  |PINTA #11#30;
         #11#31 = #709#5;  |PINTA #11#31;
         #11#25 = #709#6;  |PINTA #11#25;
         #11#26 = #709#7;  |PINTA #11#26;
         #11#27 = #709#8;  |PINTA #11#27;
         #11#28 = #709#17; |PINTA #11#28;
         |HAZ CPPresentador;
         aAnterior = #11#19;
    |FINSI;
|FPRC;

|CALCULO ClLocalidad; |TIPO 0;
 enCodProv = #11#30;
 enCodPobl = #11#31;
 |HAZ LeeLocalidad;
 #11#25 = eaPoblacion; |PINTA #11#25;
 #11#26 = eaProvincia; |PINTA #11#26;
 |HAZ CPPresentador;
|FCAL;

|CALCULO CPPresentador;
   aAlfa1 = ("00"  + #11#30) % -102;
   aAlfa2 = ("000" + #11#31) % -103;
   #11#24 = aAlfa1 + aAlfa2;
|FCAL;

|PROCESO CampoPath;
    nInkey = FSalida;
    |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        |SI aAlfa1 = ""; |ACABA; |FINSI;
        aAlfa1 = aAlfa1 % 280;
        #11#1 = aAlfa1;
        |PINTA #11#1;
    |FINSI;
    aAlfa1 = #11#1;
    |QBF aAlfa1;
    aAlfa2 = aAlfa1 % -101;
    |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
         #11#1 = aAlfa1 + "\";
         |PINTA #11#1;
    |FINSI;
|FPRC;

|PROCESO aMemoria;
  |SI #11#2 = "S";
      |ATRI P; |PINTA 1708 ," Incluir Datos Socios Memorias Anteriores a 2008   S/N  "; |ATRI N;
      |C_V #11#5, 1, "S"; |C_M #11#5, 1, "S";
      |PINTA #11#5;
  |SINO;
      |PINTA 1708 ,"                                                        ";
      |C_V #11#5, 1, "N"; |C_M #11#5, 1, "N";
  |FINSI;
|FPRC;

|PROCESO nivel_leg; |TIPO 7;
 aAlfa1 = #11#13;
 |C_M #11#14, 1,aAlfa1;
 |SI aAlfa1 = "N";
     #11#14  = 0; |PINTA #11#14;
 |FINSI;
|FPRC;

|PROCESO DePresentador;
     aAlfa = #11#18;
     |C_M #11#19, 1, aAlfa;
     |C_M #11#20, 1, aAlfa;
     |C_M #11#21, 1, aAlfa;
     |C_M #11#22, 1, aAlfa;
     |C_M #11#23, 1, aAlfa;
     |C_M #11#24, 1, aAlfa;
     |C_M #11#25, 1, aAlfa;
     |C_M #11#26, 1, aAlfa;
     |C_M #11#27, 1, aAlfa;
     |C_M #11#28, 1, aAlfa;
     |C_M #11#29, 1, aAlfa;
     |C_M #11#30, 1, aAlfa;
     |C_M #11#31, 1, aAlfa;
|FPRC;

|PROCESO Datos; |TIPO 12;
|FPRC;

|PROCESO PideVarios;

     aPath = "C:/Progra~1/Adhoc/Legalia/Legalia.exe";
     |XABRE "C", aPath, Handle;
     |SI FSalida < 0;
          aPath = "C:/Archiv~1/Adhoc/Legalia/Legalia.exe";
          |XABRE "C", aPath, Handle;
          |SI FSalida < 0;
               aPath = "C:/Archiv~1/Legalia/Legalia.exe";
               |XABRE "C", aPath, Handle;
               |SI FSalida < 0;
                    aPath = "C:/Adhoc/Legalia/Legalia.exe";
                    |XABRE "C", aPath, Handle;
                    |SI FSalida < 0;
                         aPath = "C:/Legalia/Legalia.exe";
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     aPath = aPath - "Legalia.exe"; aPath = aPath + "Data/";

     aElUsu = Usuario % 108;
     |ABRE #11;
     |DDEFECTO #11;
     #11#0 = aElUsu;
     |LEE 141#11=;
     |SI FSalida ! 0;
         |DDEFECTO #11;
         #11#0 = "A";
         |LEE 141#11=;

         #11#0 = aElUsu;
         |GRABA 020#11n;
     |FINSI;
     |CIERRA #11;

     aAnterior = #11#19;
     |PUSHV 0501 2380;
     |PINPA #0#11;

     aAlfa1 = #11#2;
     |C_V #11#5,1,aAlfa1; |C_M #11#5,1,aAlfa1;
     |HAZ aMemoria;
     |PINDA #0#11;
     |ENDATOS #1#11;
     |SI FSalida ! 0;

         nError = 1;

     |SINO;

         Local   = 0;
         Comodin = "";
         |IP_REMOTO Comodin;
         |QBF Comodin;
         |SI Comodin = "";
              Local = 1;
         |FINSI;

         aPath      = #11#1; |QBF aPath;
         aMemoria   = #11#2;
         aSaldoCero = #11#3;
         aApertura  = #11#4;
         eaMemSoc   = #11#5;
         aBorro     = #11#6;
         aBorroS    = #11#15;
         aVerDatos  = #11#7;
         eaUltNiv   = #11#8;
         aMasNombre = #11#9;
         eaFormato  = #11#10;
         eaECPN     = #11#33;
         efFecLeg   = #11#11;
         eaDatLeg   = #11#12;
         eaPathLeg  = #11#1;
         eaCtasLeg  = #11#13;
         enCtasLeg  = #11#14;
         nVerDat = 0; |SI aVerDatos = "S"; nVerDat = 1; |FINSI;
         enOrdRep   = #11#16;
         enOrdSop   = #11#17;
         aCampo18   = #11#18;
         aCampo19   = #11#19;
         aCampo20   = #11#20;
         aCampo21   = #11#21;
         aCampo22   = #11#22;
         aCampo23   = #11#23;
         aCampo24   = #11#24;
         aCampo25   = #11#25;
         aCampo26   = #11#26;
         aCampo27   = #11#27;
         aCampo28   = #11#28;
         aCampo29   = #11#29;
         nCampo30   = #11#30;
         nCampo31   = #11#31;
         enDcarLeg  = #11#32;
         |ABRE #11;
         #11#0 = aElUsu;
         |LEE 141#11=;
         nEstado = FSalida;
         #11#0  = aElUsu;
         #11#1  = aPath;
         #11#2  = aMemoria;
         #11#3  = aSaldoCero;
         #11#4  = aApertura;
         #11#5  = eaMemSoc;
         #11#6  = aBorro;
         #11#15 = aBorroS;
         #11#7  = aVerDatos;
         #11#8  = eaUltNiv;
         #11#9  = aMasNombre;
         #11#10 = eaFormato;
         #11#33 = eaECPN;
         #11#11 = efFecLeg;
         #11#12 = eaDatLeg;
         #11#13 = eaCtasLeg;
         #11#14 = enCtasLeg;
         #11#16 = enOrdRep;
         #11#17 = enOrdSop;
         #11#18 = aCampo18;
         #11#19 = aCampo19;
         #11#20 = aCampo20;
         #11#21 = aCampo21;
         #11#22 = aCampo22;
         #11#23 = aCampo23;
         #11#24 = aCampo24;
         #11#25 = aCampo25;
         #11#26 = aCampo26;
         #11#27 = aCampo27;
         #11#28 = aCampo28;
         #11#29 = aCampo29;
         #11#30 = nCampo30;
         #11#31 = nCampo31;
         #11#32 = enDcarLeg;
         |SI nEstado = 0; |GRABA 020#11a; |FINSI;
         |SI nEstado ! 0; |GRABA 020#11b; |FINSI;
         |LIBERA #11;
         |CIERRA #11;
     |FINSI;

     |POPV;

     nNoborro = 1;
     |SI aBorro = "S"; |O aBorroS = "S";
         nNoborro = 0;
     |FINSI;
|FPRC;

|| ///////////////////////////////////////////////////////////////////////

|PROGRAMA;
     |CLS;
     |CABEZA "Emision LEGALIA";

     |SUB_EJECUTA_NP "caselemp";
     |NOME_DAT #998 eaFichsel;

      enEmpresa = #48#2;
      enPeriodo = #48#3;
      enEjercicio = #48#26 + 2000;

     |ABRE #caselem1;
     |LEE 000#caselem1.p;
     |SI FSalida ! 0; |CIERRA #caselem1; |ACABA; |FINSI;
     |CIERRA #caselem1;

     |HAZ DirAplicSt;
     |HAZ eVerRegMer;

     nError = 0;
     |HAZ PideVarios;
     |SI nError = 1;
         |DELINDEX #998;
         |ACABA;
     |FINSI;

     |HAZ SinRayas;

     |SI nNoborro = 0;
         |ABRE #48;
         |BUCLE Borrado;
         |CIERRA #48;
     |FINSI;

     |HAZ LeeUnidadBasico;
     enBasImp = 1;
     eaNomImp = "CrystalReport";
     |SI eaFormato ! "S";
         |HAZ PonExcel;
     |FINSI;

     Comodin = "Carpeta LEGALIA: " + aPath;
     |ATRI I; |PINTA 2310, Comodin; |ATRI N;

     |HAZ LosBotones;

     |HAZ ConRayas;

     |SI eaFormato ! "S";
         |HAZ QuitaExcel;
     |FINSI;
     |DELINDEX #998;
|FPRO;
