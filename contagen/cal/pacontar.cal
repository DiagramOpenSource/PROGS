|FICHEROS;
    pacontar #0;

    camaasic #2;    || apuntes cabs.
    camaasil #3;    || apuntes lins.
    cacuenta #4;    || plan contable

    camandia #10;

    cacuebal #15;   || cuentas de balance
    caclipro #16;   || clientes/proveedores

    pacontmp #17;   || Temporal Libros Iva.

    camaniva #18;   || IVA Cabeceras
    caivalin #19;   || Iva Lineas
    calibros #20;   || Libros IVA.
    caivases #21;   || Series IVA
    pacontm1 #22;   || Temporal Lineas secuencial compat.9
    caivaasi #200;  || Control

    :/modelos/def/dsmom030 #330;        || conceptos

    ca8cumay #410;
    ca8m0002 #422;
|FIN;

|VARIABLES;
    &eaOrigen  = "";
    &eaDestino = "";
    &enErrPas  = 0;
    nCopio    = 0;
    nEste     = 0;
    aFichero  = "";
    aTipo     = "";
    conte     = "";
    aTIva     = "";
    aSerie    = "";
    nRegistro = 0;
    nNumDoc   = 0;
    nLinBase  = 0;
    nEstLin   = 0;

    fFecha    = @;
    fFechaAct = @;
    fFechaUlt = @;

    nImporte1 = 0;
    nImporte2 = 0;
    nSwIvaEx  = 0;

    aCuentaTF = "";
    aConcepto = "";
    aAlfa    = "";
    aAlfa1   = "";
    nApunte  = 0;
    nDoc     = 0;
    nDocumto = 0;
    nSw      = 0;
    nSwAp    = 0;

    esAbono  = "";
    fiche    = "";
    handle   = 0;
    varalfa  = "";
    varalfa0 = "";
    varalfa2 = "";
    varalfa3 = "";
    varalfa4 = "";
    varalfa5 = "";
    varalfa6 = "";
    varalfa7 = "";
    varalfa8 = "";
    nvariable = 0;

    trabajo = "";
    trabaj1 = "";
    traba   = "";
    alfa1   = "";
    alfa2   = "";
    alfa3   = "";
    alfa4   = "";
    nume1   = 0;
    nume2   = 0;
    nume3   = 0;
    nume4   = 0;

    sw      = 0;
    nCalc   = 0;
    nCalc1  = 0;
    nCalcD  = 0;
    nCalcH  = 0;
    nNume1  = 0;
    nNume2  = 0;
    ult_apunt = 0;
    docum   = 0;
    nRegi   = 0;
    FEstado = 0;
    para1   = 0;
    para2   = 0;
    para3   = 0;
    para4   = 0;

    nada    = "";
    fichero = "";
    top     = 0;
    resto   = 0;
    fecha   = @;
    descr   = "";
    signe   = "";
    impor   = 0;
    impoi   = 0;
    iva     = 0;
    rec     = 0;
    cotra   = "";
    queiv   = "";
    ivcon   = "";
    sumar   = 0;
    nConta  = 0;
    nPepe1  = 0;
    nPepe2  = 0;
    nPepe3  = 0;
    nPepe4  = 0;
    nPepe5  = 0;
    aCual   = "";
    trim1   = "";
    trim2   = "";
    trim3   = "";
    swVic   = 0;
    nGrup   = 0;
    qConta  = 0;
    nIs1    = 0;
    nIs2    = 0;
    nIs3    = 0;
    nIs4    = 0;
    nIs5    = 0;
    nIr1    = 0;
    nIr2    = 0;
    nIr3    = 0;
    nIr4    = 0;
    nIr5    = 0;
    nSwMalo   = 0;
    nDocumAnt = 0;

     nLeeUno = 0;
     nLeeCuantos = 0;
     nLeeNume = 0;
     aLeeAlfa = "";
     aLeeTodo = "";
     nLeeSalida = 0;

     nNuevo = 0;
     aContra = "";
     nCtrCon = 0;
     nDocu   = 0;
     nD      = 0;
     sw1     = 0;

     Ulqueiv = "";
     Ulcotra = "";
     impob   = 0;
     impoiva = 0;
     nAqui   = 0;
     aAnAbono = "";
     Uliva   = 0;
     Ulivcon = "";
     Ulrec   = 0;
     nConce  = 0;
     aCtaIva = "";
     aCtaRec = "";
     nCuotaIva = 0;
     nCuotaIva1 = 0;
     nHandle   = 0;

     &libro = 0;
     &orden = 0;
     &serie = "";
     &pesetas = 0;
     &cuenta = "";
     &digito = 0;
     &emision = "";
     &enAux   = 0;

    &eaFicBase =  "";   || Fichero DBASE para lee
    &enLongR    = 0;    || Longitud Registro
    &enCap      = 0;    || Longitud Cabecera
    &enCamps    = 0;    || Numero de Campos
    &enRegistre = 0;    || Total Registros
    &eswError   = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE defec1_i;
____________________________________/ CALCULOS DESDE PANTALLA
|CALCULO Alprincio; |TIPO 8;
   |HAZ inicio;
   |ABRE #200;
   |DDEFECTO #200;
   |LEE 000#200p;
   |CIERRA #200;
   eaPaCTA1 = #caivaasi#135;  ||permitir alta no estructuras 2008
   eaPaCTA2 = #caivaasi#136;  ||Aviso 1990
   eaPaNif1 = #caivaasi#152;
   eaPaNif2 = #caivaasi#153;
   eaABanco = #caivaasi#161;
   eaObClPr = #caivaasi#186;
   |SI eaPaCTA2 = "N"; nMensa9 = 1; |FINSI;
|FCAL;

|CALCULO ElDefecto; |TIPO 7;
 #0#7 = #200#3;   |PINTA #0#7;
 #0#8 = #200#29;  |PINTA #0#8;

 #0#11 = #200#5;  |PINTA #0#11;
 #0#12 = #200#31; |PINTA #0#12;
|FCAL;

|PROCESO MiraBarra;
   aAlfa = #pacontar#1; |QBF aAlfa;
   aAlfa1 = aAlfa % -101;
   |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
      aAlfa = aAlfa + "/"; #pacontar#1 = aAlfa; |PINTA #pacontar#1;
   |FINSI;
|FPRC;

|CALCULO Solo8; |TIPO 7;
     |SI #0#5 = 8;
          |C_M #0#9, 1, "S";
          |C_M #0#10, 1, "S";
     |SINO;
          |C_M #0#9, 1, "N";
          |C_M #0#10, 1, "N";
     |FINSI;
|FCAL;

|CALCULO libros; |TIPO 0;
     |SI #0#6 = "N";
          |C_M #0#7 , 1 , "N";
          |C_M #0#8 , 1 , "N";
          |C_M #0#11 , 1 , "N";
          |C_M #0#12 , 1 , "N";
          |C_M #0#13 , 1 , "N";
     |SINO;
          |C_M #0#7 , 1 , "S";
          |C_M #0#8 , 1 , "S";
          |C_M #0#11 , 1 , "S";
          |C_M #0#12 , 1 , "S";
          |C_M #0#13 , 1 , "S";
     |FINSI;

     |SI #0#5 = 9;
         #0#13 = "S";
     |SINO;
         #0#13 = "N";
     |FINSI;

     |PINTA #0#13;
|FCAL;

|PROCESO Cuadro10; |TIPO 7;
  |PUSHV 0839 2079;
  |CUADRO 0839 2079;
  |ATRI R;
  |PINTA 0940, "(8)---- Cuentas --- ³ --- Asientos ----";
  |PINTA 1040, "T.Cabecera Registro ³ Cabecera Registro";
  |ATRI 0;
  |ATRI P;
  |PINTA 1140, "1-   4131     2093  ³   1061      298  ";
  |PINTA 1240, "2-   4099     2092  ³   1061      298  ";
  |PINTA 1340, "3-    419      162  ³   1058      298  ";
  |PINTA 1440, "4-   4099     2092  ³   1058      298  ";
  |PINTA 1540, "5-   4131     2093  ³   1258      348  ";
  |PINTA 1640, "6-   4131     2093  ³   1058      298  ";
  |PINTA 1740, "7-    418      162  ³   1282      349  ";
  |PINTA 1840, "8-   4131     2093  ³   1282      349  ";
  |PINTA 1940, "9-   Otros          ³   Otros          ";
  |ATRI 0;
  |ATRI I;
  |PINTA 1140, "1-";
  |PINTA 1240, "2-";
  |PINTA 1340, "3-";
  |PINTA 1440, "4-";
  |PINTA 1540, "5-";
  |PINTA 1640, "6-";
  |PINTA 1740, "7-";
  |PINTA 1840, "8-";
  |PINTA 1940, "9-";
  |ATRI 0;
|FPRC;

|PROCESO Cuadro5; |TIPO 7;
|FPRC;

|PROCESO NoCuadro; |TIPO 0;
 |POPV;
|FPRC;

|| /////////////////////////////////////////////////////////////////////
|| /////////////////////////////////////////////////////////////////////

|PROCESO principio;  || lee posiciones que ha de saltar.
     Pos = -1;
     |PARA para1 = top;  |SI para1 > 0;  |HACIENDO para1 = para1 - 250;
           |SI para1 ] 250;
               |XLEE handle, 250, varalfa;
           |SINO;
               |XLEE handle, para1, varalfa;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO nombre;  || nombre del fichero
    Pos   = -1;
    alfa1 = #0#1;
    |QBF alfa1;

    |SI #0#5 ! 9;
        alfa1 = alfa1 + fichero;
        |QBF alfa1;
        traba = trabaj1;
        |QBF traba;
        alfa1 = alfa1 + traba + ".dbf";
        |QBF alfa1;
        aFichero = fichero + traba + ".dbf";
    |SINO;
        fichero = "x" + fichero;
        alfa1 = alfa1 + fichero;
        |QBF alfa1;
        alfa1 = alfa1 + ".txt";
        aFichero = fichero + ".txt";
    |FINSI;
    fiche = alfa1;

    nCopio = 0;
    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
        |SI FSalida = 0; nCopio = 1; |FINSI;
    |FINSI;
    |XCIERRA handle;

|SI nCopio = 1;
    |MENSA "    Subiendo fichero de importacion al servidor, espere por favor";
    |DFICE aBase;
    eaOrigen  = fiche;
    eaDestino = aBase + aFichero;
    |HAZ eReciboFich;
    |SI enErrPas = 0; fiche = eaDestino; |FINSI;
    |BLIN 4;
|FINSI;

    |SI #0#5 = 8; |Y #0#10 = 9;
        eaFicBase = fiche;
        |HAZ CalculDBF;
        |SI eswError = 1; fiche = ""; |ACABA; |FINSI;
    |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////

|PROCESO IvaRepSop;
     |DDEFECTO #18;

     #18#0  = qConta;
     #18#1  = nNumDoc;
     |LEE 001#18=;
     FEstado = FSalida;

     alfa2 = #18#12; |QBF alfa2;
     |SI alfa2 = "";
         #18#2 = #17#15; || Serie.
         #18#3 = #17#16; || Registro.
         #18#4 = #17#7;  || Fecha

         alfa1 = #17#7; alfa1 = alfa1 % 0402; nume1 = alfa1;
         #18#5 = nume1;
         |SI #200#46 = "T"; |Y enEjercicio [ 2009;
             #18#5 = 1;
             |SI nume1 > 3; #18#5 = 2; |FINSI;
             |SI nume1 > 6; #18#5 = 3; |FINSI;
             |SI nume1 > 9; #18#5 = 4; |FINSI;
         |FINSI;

         #18#7 = 1;               || diario
         #18#8 = #17#7;           || fecha
         #18#9 = #17#1;           || Documento

         #18#12 = #17#3;          || Cuenta
         #16#23 = aTipo;
         #16#10 = #18#12;
         |LEE 000#16=;
         |SI FSalida = 0;
             #18#13 = #16#1;
             #18#14 = #16#9;
         |FINSI;

         |SI aTIva = "R";
             #18#27 = #200#5;
             #18#29 = #200#13;
         |SINO;
             #18#27 = #200#31;
             #18#29 = #200#57;
         |FINSI;
         #18#27  = nConce;
         #18#28  = #17#6;  || Descrip. Concepto
         #18#29  = nConce;
         #18#30  = #17#6;  || Descrip. Concepto

         #18#36  = aTIva;
    |FINSI;

    nLinBase = nLinBase + 1;
    |DDEFECTO #19;
    #19#0 = #18#0;
    #19#1 = #18#1;
    #19#2 = nLinBase;
    |LEE 001#19=;
    nEstLin = FSalida;

    #19#0 = #18#0;
    #19#1 = #18#1;
    #19#2 = nLinBase;
    #19#3 = #18#27;
    #19#4 = #18#28;

    #19#6 = #17#4;  ||Base
    #19#7 = #17#5;  ||% iva
    #19#9 = #17#8;  ||% rec

    #19#8  = ((#19#6  * #19#7) /100) ! EURODB;  ||Cuota Iva
    #19#10 = ((#19#6  * #19#9) /100) ! EURODB;  ||Cuota Rec

    |SI #17#9 = "S";
        nCalc = -1;
    |SINO;
        nCalc = 1;
    |FINSI;

    |SI #17#9 = "S";
       |SI #19#06 > 0; #19#06 = #19#06 * -1; |FINSI;
       |SI #19#08 > 0; #19#08 = #19#08 * -1; |FINSI;
       |SI #19#10 > 0; #19#10 = #19#10 * -1; |FINSI;
    |FINSI;

    efFechaIVA = #camaniva#4; enLineaIVA = 0;
    enPorcIVA = #caivalin#7; enPorcREC = #caivalin#9;
    eaCtaIVA = #caivalin#13; eaCtaREC = #caivalin#14;
    |HAZ BuscaTipoIVA;
    #19#16 = enLineaIVA;

    alfa1 = #17#10; |QBF alfa1;
    |SI alfa1 ! "";
       #19#12 = alfa1;
    |SINO;
       |QBF aContra;
       |SI aContra ! "";
          #19#12 = aContra;
       |FINSI;
    |FINSI;
    alfa1 = #17#11; |QBF alfa1;
    |SI alfa1 ! ""; #19#13 = alfa1; |FINSI;
    alfa1 = #17#12; |QBF alfa1;
    |SI alfa1 ! ""; #19#14 = alfa1; |FINSI;

    #18#19 = #18#19 + #19#6;
    #18#15 = #18#15 + #19#6;
    #18#17 = #18#15 % #18#16;
    #18#20 = #18#20 + #19#22;
    || #18#23 = #18#23 + (#19#8 + #19#10);
    nCuotaIva = (nCuotaIva + (#19#8 + #19#10) ) ! EURODB;
    #18#23 = #18#23 + #17#14;
    #18#26 = #18#26 + #19#11;
    #18#21 = #18#19 + #18#23 - #18#26 - #18#20;

    |SI FEstado = 0; |GRABA 020#18a; |FINSI;
    |SI FEstado ! 0; |GRABA 020#18b; |FINSI;
    |LIBERA #18;

    |SI nEstLin = 0; |GRABA 020#19a; |FINSI;
    |SI nEstLin ! 0; |GRABA 020#19b; |FINSI;
    |LIBERA #19;
|FPRC;

|PROCESO BuscaCtrap;
   |SI #17#10 ! "            "; aContra = #17#10; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE BuscaCtrap;
#17#1;
;
aAlfa, nCalc, 0000;
aAlfa, nCalc, 9999;
;
NULL, BuscaCtrap;
|FIN;

|PROCESO pacontmp;
     |SI swVic = 0;
          swVic = 1;
          nGrup = #17#1;
          aCual = #17#0;
          |SI #17#0 = "472";
               aTIva = "S"; aTipo = "P";
               qConta = #0#8;
               nConce = #0#12;
               |HAZ LeeConta;
          |FINSI;
          |SI #17#0 = "477";
               aTIva = "R"; aTipo = "C";
               qConta = #0#7;
               nConce = #0#11;
               |HAZ LeeConta;
          |FINSI;
     |FINSI;
     |SI nGrup ! #17#1; |O aCual ! #17#0;
          |HAZ ElAnterior;
          nGrup = #17#1;
          aCual = #17#0;
          |SI #17#0 = "472";
               aTIva = "S"; aTipo = "P";
               qConta = #0#8;
               nConce = #0#12;
               |HAZ LeeConta;
          |FINSI;
          |SI #17#0 = "477";
               aTIva = "R"; aTipo = "C";
               qConta = #0#7;
               nConce = #0#11;
               |HAZ LeeConta;
          |FINSI;
     |FINSI;

     aAlfa = #17#0; nCalc = #17#1;
     |SALVA_FICHA #17; |BUCLE BuscaCtrap; |REPON_FICHA #17;

     |HAZ IvaRepSop;

     |SI #0#13 = "S";

         nDocumto = #pacontmp#1; nSw = 0;
         |SALVA_FICHA #pacontmp;
         |LEE 000#pacontmp.s;
         |SI FSalida ! 0; |O nDocumto ! #pacontmp#1; nSw = 1; |FINSI;
         |REPON_FICHA #pacontmp;
         |SI nSw = 1;
            libro   = #camaniva#0;
            serie   = #camaniva#2;
            orden   = #camaniva#3;
            emision = #camaniva#4;
            pesetas = #camaniva#21;
            cuenta  = #camaniva#12;
            enAux   = 2;

            eaCuenta = #camaniva#12; |HAZ SacaNivel;
            digito   = enNivel;

            |SUB_EJECUTA "calincob";
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE pacontmp;
     #17#1;
     ;
     "   ",000001,1;
     "zzz",999999,9999;
     ;
     NULL,pacontmp;
|FIN;


|PROCESO GrabaIva;
   |SI sw1 = 1; |Y nCtrCon = 1;  || Por si se escapa el ultimo
       queiv  = Ulqueiv;
       cotra  = Ulcotra;
       nD     = docum;
       docum  = nDocu;
       impoi  = impob;      ||Importe.
       iva    = Uliva;
       rec    = Ulrec;
       ivcon  = Ulivcon;
       impoiva = 0;
       nAqui = 1;
       |ABRE #17;
       |HAZ RegIva;
       |CIERRA #17;
       nAqui = 0;
    |FINSI;

     swVic = 0;
     |ABRE #16;
     |ABRE #18;
     |ABRE #19;
     |ABRE #20;
     |BUCLE pacontmp;
     |HAZ ElAnterior;

     |CIERRA #16;
     |CIERRA #18;
     |CIERRA #19;
     |CIERRA #20;
|FPRC;

|PROCESO LasLineas;
 alfa1 = #3#4;
 alfa1 = alfa1 % 103;

 #3#6  = #18#27;
 #3#12 = #18#36;
 #3#13 = #18#0;
 #3#14 = #18#3;
 #3#15 = #18#2;

 #3#19 = "F";
 alfa1 = #3#4;alfa1 = alfa1 % 103;
 |SI alfa1 = "477"; |O alfa1 = "472";
     #3#19 = "I";
     nNume2 = nNume2 + 1
     #3#20 = nNume2;
     |SI nLinBase > 1; |Y #3#9 = #18#23;
         #3#20 = 0;
     |FINSI;
 |FINSI;
 alfa1 = #3#4;alfa1 = alfa1 % 101;
 |SI alfa1 = "6"; |O alfa1 = "7";
     #3#19 = "B";
     nNume1 = nNume1 + 1;
     #3#20 = nNume1;
 |FINSI;
 #3#21 = eaDfDepC;
 #3#28 = eaDfSubC;
 |GRABA 020#3a;
 |LIBERA #3;
|FPRC;

|DEFBUCLE LasLineas;
 #3#1;
 ;
 #2#0, #2#1, #2#2, 0001;
 #2#0, #2#1, #2#2, 9999;
 be;
 NULL, LasLineas;
|FIN;

|PROCESO ElAnterior;
 |SI #18#23 ! nCuotaIva;
     nNume1 = #18#23 - nCuotaIva;
     #19#0 = #18#0;
     #19#1 = #18#1;
     #19#2 = nLinBase;
     |LEE 141#19=;
     |SI FSalida = 0;
         #19#8 = #19#8 + nNume1;
         |SI #19#8 = 0;
             #19#7 = 0;
         |FINSI;
         |GRABA 020#19a;
     |FINSI;
     |LIBERA #19;
 |FINSI;

 |ABRE #2;
 #2#0 = #18#7;
 #2#1 = #18#8;
 #2#2 = #18#9;
 |LEE 001#2=;
 |SI FSalida = 0;
     |SI #18#36 = "R"; #2#13 = 1; |FINSI;
     |SI #18#36 = "S"; #2#13 = 2; |FINSI;
     |GRABA 020#2a;
     nNume1 = 0;
     nNume2 = 0;
     |BUCLE LasLineas;
 |FINSI;
 |CIERRA #2;
|FPRC;

|PROCESO LeeConta;

     #18#0 = qConta;
     #18#1 = 9999999999;
     |LEE 010#18];
     |SI FSalida = 0;
         |LEE 040#18a;
     |SINO;
         |LEE 040#18u;
     |FINSI;

     nNumDoc = 1;
     |SI FSalida = 0; |Y #18#0 = qConta;
         nNumDoc = #18#1 + 1;
     |FINSI;

     |SI #200#44 = "N";
         |ABRE #20;
         #20#0 = qConta;
         |LEE 110#20=;
         |SI FSalida = 0;
              nConta = #20#4;
              #20#4 = #20#4 + #20#3;
              |GRABA 020#20a;
              |LIBERA #20;
          |FINSI;
          |CIERRA #20;
      |SINO;
          |ABRE #21;
          #21#0 = "";
          #21#1 = aTIva;
          |LEE 110#21=;
          |SI FSalida = 0;
              nConta= #21#3;
              #21#3 = #21#3 + #21#4;
              |GRABA 020#21a;
              |LIBERA #21;
          |FINSI;
          |CIERRA #21;
       |FINSI;

     |DDEFECTO #18;
     #18#0  = qConta;
     #18#1  = nNumDoc;
     |GRABA 020#18b;
     nLinBase  = 0;
     nCuotaIva = 0;
|FPRC;

|PROCESO RegIva;

  |SI queiv [ "   "; |ACABA; |FINSI;
  esAbono = "N";
  nEste = 0;
  #17#0 = queiv;
  #17#1 = docum;      ||N§Documento.
  #17#2 = 1;
  |LEE 000#17];
  |PARA; |SI FSalida = 0; |Y #17#0 = queiv; |Y #17#1 = docum; |HACIENDO;
         |SI #17#10 [ "            "; |Y #17#5 = iva; nEste = #17#2; |FINSI;
         |SI #17#9 = "S"; esAbono = "S"; |FINSI;
         |LEE 000#17s;
  |SIGUE;
  |SI nEste ! 0;
      #17#0 = queiv;
      #17#1 = docum;
      #17#2 = nEste;
      |LEE 001#17=;
  |SINO;
      |DDEFECTO #17;
      sumar = sumar + 1;
      #17#0 = queiv;      ||Que Iva 477 Repercutido 472 Soportado.
      #17#1 = docum;      ||N§Documento.
      #17#2 = sumar;      ||Sumador Registros.
  |FINSI;
  #17#3 = cotra;      ||Cuenta.
  #17#4 = #17#4 + impoi;      ||Importe.
  #17#5 = iva;        ||Porcentaje Iva.
  #17#6 = ivcon;      ||Concepto.
  #17#7 = fecha;      ||Fecha.
  #17#8 = rec;        ||Porcentaje Rec.

  |SI esAbono = "N";
     |SI #17#0 = "477";
         alfa1 = varalfa % 3916;  nCalc = alfa1;
         |SI nCalc = 0;
             #17#9 = "N";        || Abono S/N
        |SINO;
             #17#9 = "S";        || Abono S/N
        |FINSI;
     |FINSI;

     |SI #17#0 = "472";
         alfa1 = varalfa % 8016;  nCalc = alfa1;
         |SI nCalc = 0;
             #17#9 = "N";        || Abono S/N
         |SINO;
             #17#9 = "S";        || Abono S/N
         |FINSI;
     |FINSI;
     |SI nAqui = 1;
         #17#9 = aAnAbono;
     |FINSI;
  |SINO;
      #17#9 = "S";
  |FINSI;

  #17#10 = aContra;
  #17#13 = impob;
  #17#14 = impoiva;
  #17#11 = aCtaIva;
  #17#12 = aCtaRec;
  #17#15 = aSerie;
  #17#16 = nRegistro;

  nCtrCon = 0;

  Ulqueiv = queiv;     ||El ultimo
  Ulcotra = cotra;     ||Cuenta.
  aAnAbono = #17#9;
  Uliva    = iva;        ||Porcentaje Iva.
  Ulivcon  = ivcon;      ||Concepto.
  Ulrec    = rec;        ||Porcentaje Rec.

  |SI nEste = 0;
      |GRABA 020#17n;
  |SINO;
      |GRABA 020#17a;
  |FINSI;
  |LIBERA #17;
|FPRC;

|PROCESO GraboBaseIva;
       fFechaAct = fecha;
       |SI fFechaUlt ! "00.00.0000"; fecha  = fFechaUlt; |FINSI;
       queiv  = Ulqueiv;
       cotra  = Ulcotra;
       nD     = docum;
       docum  = nDocu;
       || impoi  = impob;      ||Importe.
       iva    = Uliva;
       rec    = Ulrec;
       ivcon  = Ulivcon;
       ||impoiva = 0;
       nAqui = 1;
       |HAZ RegIva;
       nAqui = 0;
       docum = nD;
       nDocu = docum;
       fecha = fFechaAct;
|FPRC;
|| ..................................................................
|PROCESO ultimo;

   |SI sw1 = 0
       nDocu     = docum;
       sw1       = 1;
       nCtrCon   = 0;
       aContra   = "";
       Ulqueiv   = "";
       Ulcotra   = "";
       Uliva     = 0;
       Ulivcon   = "";
       Ulrec     = 0;
       aAnAbono  = "N";
       aCuentaTF = "";
       aConcepto = "";
   |FINSI;

   |SI nDocu ! docum; |Y nCtrCon = 1;
          |SI nSwIvaEx  = 1;
             Ulqueiv = "477";
             impoiva = 0;
             impoi   = impob;
             Ulcotra = aCuentaTF;
             Ulivcon = aConcepto;
          |FINSI;

          |HAZ GraboBaseIva;
          Ulqueiv = "";
          Ulcotra = "";
          nCtrCon = 0;
          aAnAbono = "N";
          Uliva   = 0;
          Ulivcon = "";
          Ulrec   = 0;
          aContra   = "";
          aCuentaTF = "";
          aConcepto = "";
   |FINSI;

    #3#3 = 9999;
    |LEE 000#3];
    |SI FSalida = 0;
        |LEE 000#3a;
    |SINO;
        |LEE 000#3u;
    |FINSI;
    |SI FSalida = 0;|Y #3#0 = 1;|Y #3#1 = fecha;|Y #3#2 = docum;
        ult_apunt = #3#3 + 2;
    |SINO;
        ult_apunt = 1;
        aContra = "";
        nCtrCon = 0;
        Ulqueiv = "";
        Ulcotra = "";
        Uliva   = 0;
        Ulrec   = 0;
        aCtaIva = "";
        aCtaRec = "";
    |FINSI;

    |DDEFECTO #3;
    #3#0 = 1;
    #3#1 = fecha;
    #3#2 = docum;
    nDocu = docum;
|FPRC;

|PROCESO cabecera;

    |DDEFECTO #2;
    #2#0 = #3#0;
    #2#1 = #3#1;
    #2#2 = #3#2;
    |LEE 101#2=;
    FEstado = FSalida;
    #2#0 = #3#0;         || diario
    #2#1 = #3#1;         || fecha
    #2#2 = #3#2;         || documento
    #2#3 = #2#2;         || asiento
    |SI #3#8 = "D";
        #2#4 = #2#4 + #3#9;
        |SI #2#09 = 0; #2#08 = #3#4; #2#09 = #3#5; |FINSI;      || contrp.HABER
    |FINSI;
    |SI #3#8 = "H";
        #2#5 = #2#5 + #3#9;
       |SI #2#11 = 0; #2#10 = #3#4; #2#11 = #3#5; |FINSI;      || contrp.DEBE
    |FINSI;
    #2#6 = #2#4 - #2#5;
    #2#12 = #3#24;
    |SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
    |SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
    |LIBERA #2;
|FPRC;

|PROCESO Actualiza;
     |ATRI I;
     |PINTA 2221, #3#1;
     |PINTA 2234, #3#4;
     |ATRI 0;

     |HAZ cabecera;

      MasMenos     = #3#9;
      DebeHaber    = #3#8;
      aCUENTA      = #3#4;
      nREGISTRO    = #3#24;
      nDIARIO      = #3#0;
      aFECHA       = #3#1;
      nDOCUMENTO   = #3#2;
      nNIVELCUENTA = #3#5;

      |HAZ ActDiario;          || diario
      |HAZ ActCuenta;          || cuenta
      |HAZ ActTesteo;          || cuenta
|FPRC;
||**********************************************************************
||**********************************************************************

|PROCESO apuntes_9;
     nSwAp    = 9;
     conte = varalfa % 1512;   |QBF conte;

     |SI conte = ""; |ACABA; |FINSI;

     alfa1 = varalfa % 708;
     alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
     fecha = alfa1;

     alfa1 = varalfa % 0106;
     nCalc = alfa1;

     |SI nDocumAnt = 0;  |O nCalc ! nDocumAnt;
         nSwMalo = 0;
         #2#0    = 1;
         #2#1    = fecha;
         #2#2    = nCalc;
         |LEE 000#2=;
         |SI FSalida = 0;  nSwMalo = 1;  |FINSI;

         |HAZ contador; docum = nDOCUMENTO;
         nDocumAnt = nCalc;
     |FINSI;

     |SI nSwMalo = 1;  |ACABA;  |FINSI;

     |DDEFECTO #3;
     #3#00 = 1;          || diario
     #3#01 = fecha;      || fecha
     #3#02 = docum;      || documento

     |HAZ ultimo;
     |SI aCuentaTF = "";
        aCuentaTF = conte;
        aConcepto = varalfa % 5525;
        nSwIvaEx = 1;
        fFechaUlt = fecha;
     |FINSI;
     #3#03 = ult_apunt;  || apunte

     eaCuenta = conte;
     |HAZ nuSacaNivel;

     conte = eaCuenta;
     #3#04 = conte;      || cuenta
     #3#05 = enNivel;    || digito cuenta
     #3#06 = 001;        || concepto
     alfa1 = varalfa % 5525;
     #3#07 = alfa1;      || descripcion

     alfa1 = (varalfa % 23911) + (varalfa2 % 105);        || DEBE euros
     nume1 = alfa1;
     alfa1 = varalfa2 % 0616;        || HABER euros
     nume2 = alfa1;

     signe = "";
     impor = 0;

     aSerie = "";
     aAlfa = varalfa % 0106; nRegistro = aAlfa;
     alfa1 = varalfa2 % 2216;   ||Base Imponible en EUROS
     impoi = alfa1;
     |SI impoi ! 0;
         alfa1 = varalfa % 12005; ||% Iva.
         iva   = alfa1;
         alfa1 = varalfa % 12505; ||% Rec.
         rec   = alfa1;
         cotra = varalfa % 2712;  ||Contrapartida.
         queiv = conte % 103;     ||Para Saber que Tipo Iva.
         impob = impoi;
     |FINSI;

     |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
     |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;

     #3#08 = signe;      || signo
     #3#09 = impor;      || importe
     |SI #3#08 = "D";
         #3#16 = #3#4;
         #3#17 = #3#5;
     |SINO;
         #3#10 = #3#4;
         #3#11 = #3#5;
     |FINSI;

     #3#12 = "";           || cobros/pagos
     #3#13 = 0;            || libro
     #3#14 = 0;            || orden
     #3#15 = "";           || serie
     #3#22 = 0;            || nro.recibo
     #3#19 = "";           || tipo acumulador
     #3#20 = 0;            || numero acumulador
     #3#21 = "";           || departamento

     alfa1 = #3#4;
     alfa1 = alfa1 % 101;
     |SI alfa1 = "6"; |O alfa1 = "7";
         |SI nCtrCon = 1;
             |HAZ GraboBaseIva;
         |FINSI;
         aContra = #3#4;
         nCtrCon = 1;
         impob   = #3#9;
     |FINSI;

     ivcon = #3#07;
     alfa1 = #3#4;
     alfa1 = alfa1 % 103;
     |SI alfa1 = "477"; |O alfa1 = "472";
         aCtaIva = #3#4;
         impoiva = #3#9;
     |FINSI;

     |SI impor ! 0;
         |GRABA 020#3n;
         |SI FSalida = 0;
             |HAZ Actualiza;
             |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
                 nSwIvaEx = 0;
                 |HAZ RegIva;
             |FINSI;
         |FINSI;
     |SINO;
         |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
             nSwIvaEx = 0;
             |HAZ RegIva;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO apuntes_5;
    nSwIvaEx = 0;
    nSwAp    = 5;
    varalfa = varalfa % 2;    || primera posicion

    conte = varalfa % 1512;   |QBF conte;

    |SI conte ! "";

        |DDEFECTO #3;

        fFechaUlt = fecha;
        #3#00 = 1;          || diario
        alfa1 = varalfa % 708;
        alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
        fecha = alfa1;
        #3#01 = fecha;      || fecha

        alfa1 = varalfa % 0106;
        nCalc = alfa1;
        |SI nDocumAnt = 0; |O nCalc ! nDocumAnt;
           |HAZ contador; docum = nDOCUMENTO;
           nDocumAnt = nCalc;
        |FINSI;

        #3#02 = docum;      || documento
        |HAZ ultimo;
        #3#03 = ult_apunt;  || apunte

        eaCuenta = conte;
        |HAZ nuSacaNivel;
        conte = eaCuenta;
        #3#04 = conte;      || cuenta
        #3#05 = enNivel;    || digito cuenta
        #3#06 = 001;        || concepto
        alfa1 = varalfa % 5525;
        #3#07 = alfa1;      || descripcion

        aAlfa = (varalfa % 13008); aAlfa1 = (varalfa % 21201); |QBF aAlfa1;
        |SI aAlfa1 ! "";
           aAlfa = aAlfa - aAlfa1;
           nRegistro = aAlfa; aSerie = aAlfa1;
        |FINSI;

        alfa1 = (varalfa % 23911) + (varalfa2 % 105);        || DEBE euros
        nume1 = alfa1;
        alfa1 = varalfa2 % 0616;        || HABER euros
        nume2 = alfa1;

        signe = "";
        impor = 0;
        alfa1 = varalfa2 % 2216;   ||Base Imponible en EUROS
        impoi = alfa1;
        |SI impoi ! 0;
            alfa1 = varalfa % 12005; ||% Iva.
            iva   = alfa1;
            alfa1 = varalfa2 % 0616;
            nCalc1 = alfa1;
            |SI iva = 0; |Y nCalc1 ! 0;
               nCalc1 = ((nCalc1 / impoi) * 100) ! 0;
               iva = nCalc1;
            |FINSI;
            alfa1 = varalfa % 12505; ||% Rec.
            rec   = alfa1;
            cotra = varalfa % 2712;  ||Contrapartida.
            queiv = conte % 103;     ||Para Saber que Tipo Iva.
            impob = impoi;
        |FINSI;
        |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
        |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;
        #3#08 = signe;      || signo
        #3#09 = impor;      || importe
        |SI #3#08 = "D";
            #3#16 = #3#4;
            #3#17 = #3#5;
        |SINO;
            #3#10 = #3#4;
            #3#11 = #3#5;
        |FINSI;
        #3#12 = "";           || cobros/pagos
        #3#13 = 0;            || libro
        #3#14 = 0;            || orden
        #3#15 = "";           || serie
        #3#22 = 0;            || nro.recibo
        #3#19 = "";           || tipo acumulador
        #3#20 = 0;            || numero acumulador
        #3#21 = "";           || departamento

        alfa1 = #3#4;
        alfa1 = alfa1 % 101;
        |SI alfa1 = "6"; |O alfa1 = "7";
            |SI nCtrCon = 1;
                |HAZ GraboBaseIva;
            |FINSI;
            aContra = #3#4;
            nCtrCon = 1;
            impob   = #3#9;
        |FINSI;
        alfa1 = #3#4;
        ivcon = #3#07;
        alfa1 = alfa1 % 103;
        |SI alfa1 = "477"; |O alfa1 = "472";
            aCtaIva = #3#4;
            impoiva = #3#9;
        |FINSI;

        |SI impor ! 0;
            |GRABA 020#3n;
            |SI FSalida = 0;
                |HAZ Actualiza;
                |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
                    |HAZ RegIva;
                |FINSI;
            |FINSI;
        |SINO;
            |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
                |HAZ RegIva;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO apuntes_04;
   conte = varalfa % 1512;   |QBF conte;
   |SI conte = "";
       conte = varalfa % 2712;   |QBF conte;     || contrapartida
   |FINSI;

   |SI conte ! "";
       |DDEFECTO #3;
       #3#00 = 1;          || diario
       alfa1 = varalfa % 708;
       alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
       fecha = alfa1;
       #3#01 = fecha;      || fecha
       #3#02 = docum;      || documento
       |HAZ ultimo;
       #3#03 = ult_apunt;  || apunte

       eaCuenta = conte;
       |HAZ nuSacaNivel;
       conte = eaCuenta;
       #3#04 = conte;      || cuenta
       #3#05 = enNivel;    || digito cuenta
       #3#06 = 001;        || concepto
       alfa1 = varalfa % 4925;
       #3#07 = alfa1;      || descripcion
       alfa1 = varalfa % 3910;   nume1 = alfa1;
       alfa1 = varalfa % 7410;   nume2 = alfa1;
       signe = "";
       impor = 0;
       |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
       |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;
       #3#08 = signe;      || signo
       #3#09 = impor;      || importe
       |SI #3#08 = "D";
           #3#16 = #3#4;
           #3#17 = #3#5;
       |SINO;
           #3#10 = #3#4;
           #3#11 = #3#5;
       |FINSI;
       #3#24 = nRegi;
       #3#12 = "";           || cobros/pagos
       #3#13 = 0;            || libro
       #3#14 = 0;            || orden
       #3#15 = "";           || serie
       #3#19 = "";           || tipo acumulador
       #3#20 = 0;            || numero acumulador
       #3#21 = eaDfDepC;     || departamento
       #3#22 = 0;            || nro.recibo

        |SI impor ! 0;
            |GRABA 020#3n;
            |SI FSalida = 0;
                |HAZ Actualiza;
            |FINSI;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO apuntes;
   conte = varalfa % 1612;   |QBF conte;
   |SI conte = "";
       conte = varalfa % 2812;   |QBF conte;     || contrapartida
   |FINSI;

   |SI conte ! "";

       |DDEFECTO #3;

       #3#00 = 1;          || diario
       alfa1 = varalfa % 808;
       alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
       fecha = alfa1;
       #3#01 = fecha;      || fecha
       #3#02 = docum;      || documento
       |HAZ ultimo;

        #3#03 = ult_apunt;  || apunte
        eaCuenta = conte;
        |HAZ nuSacaNivel;
        conte = eaCuenta;
        #3#04 = conte;      || cuenta
        #3#05 = enNivel;    || digito cuenta
        #3#06 = 001;        || concepto
        alfa1 = varalfa % 5225;
        #3#07 = alfa1;      || descripcion
        alfa1 = varalfa % 4210;   nume1 = alfa1;
        alfa1 = varalfa % 7910;   nume2 = alfa1;
        signe = "";
        impor = 0;
        |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
        |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;
        #3#08 = signe;      || signo
        #3#09 = impor;      || importe
        |SI #3#08 = "D";
            #3#16 = #3#4;
            #3#17 = #3#5;
        |SINO;
            #3#10 = #3#4;
            #3#11 = #3#5;
        |FINSI;
        #3#24 = nRegi;
        #3#12 = "";           || cobros/pagos
        #3#13 = 0;            || libro
        #3#14 = 0;            || orden
        #3#15 = "";           || serie
        #3#19 = "";           || tipo acumulador
        #3#20 = 0;            || numero acumulador
        #3#21 = "";           || departamento
        #3#22 = 0;            || nro.recibo

        |SI impor ! 0;
            |GRABA 020#3n;
            |SI FSalida = 0;
                |HAZ Actualiza;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;


||__________________________________________________________________________

|PROCESO LeeUnoaUno;
     aLeeTodo = "";
     nLeeSalida = 0;
     |PARA nLeeUno = 1; |SI nLeeUno [ nLeeCuantos; |HACIENDO nLeeUno = nLeeUno + 1;
          |XLEE handle, 1, aLeeAlfa;
          |SI FSalida = 1;
               nLeeNume = &aLeeAlfa;
               |SI nLeeNume < 32;
                    aLeeTodo = aLeeTodo + " ";
               |SINO;
                    aLeeTodo = aLeeTodo + aLeeAlfa;
               |FINSI;
               nLeeSalida = nLeeSalida + 1;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO diario_Ult;
    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

   |SI FSalida ] 0;
        top = enCap;
        |HAZ principio;

        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw        = 1;
               nume1     = 0;
               nvariable = 0;
               |PARA para1 = enLongR;  |SI para1 > 0;  |HACIENDO para1 = para1 - 250;
                     |SI para1 ] 250;
                         |XLEE handle, 250, varalfa0;
                     |SINO;
                         |XLEE handle, para1, varalfa0;
                     |FINSI;
                     nume1 = nume1 + FSalida;
                     |SI nvariable = 0; varalfa  = varalfa0; |FINSI;
                     |SI nvariable = 1; varalfa2 = varalfa0; |FINSI;
                     |SI nvariable = 2; varalfa3 = varalfa0; |FINSI;
                     |SI nvariable = 3; varalfa4 = varalfa0; |FINSI;
                     |SI nvariable = 4; varalfa5 = varalfa0; |FINSI;
                     |SI nvariable = 5; varalfa6 = varalfa0; |FINSI;
                     |SI nvariable = 6; varalfa7 = varalfa0; |FINSI;
                     |SI nvariable = 7; varalfa8 = varalfa0; |FINSI;
                     |SI nvariable ] 8; varalfa8 = varalfa0; |FINSI;
                     nvariable = nvariable + 1;
               |SIGUE;
               |SI nume1 = enLongR;
                   sw = 0;
                   alfa1 = varalfa % 101;
                   |SI alfa1 ! "*";             || registros borrados
                        |HAZ apuntes_5;
                   |FINSI;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;
||/////////////////////////////////////////////////////////////////////////////
|PROCESO Temporal;
   varalfa  = #pacontm1#5;
   varalfa2 = #pacontm1#6;

   |HAZ apuntes_9;
|FPRC;

|DEFBUCLE Temporal;
#pacontm1#1;
;
INICIO;
FINAL;
;
NULL, Temporal;
|FIN;

|PROCESO diario_t09;
    |DELINDEX #17; |ABRE #17;
    |DELINDEX #22; |ABRE #22;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    nDocumAnt = 0;
    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 249, varalfa;
               |SI FSalida = 249;
                   |XLEE handle, 50, varalfa2;
                   |SI FSalida = 50;
                       alfa1 = varalfa % 101;
                       |SI alfa1 ! "*";             || registros borrados
                          |DDEFECTO #pacontm1;
                          #pacontm1#0 = 1;
                          aAlfa = varalfa % 0708;
                          aAlfa = (aAlfa % -102) + "." + (aAlfa % 0502) + "." + (aAlfa % 0104);
                          fFecha = aAlfa; nApunte = 1;
                          #pacontm1#1 = fFecha;
                          aAlfa = varalfa % 0106; nDoc = aAlfa;
                          #pacontm1#2 = nDoc;
                          |LEE 000#pacontm1.];
                          |PARA; |SI FSalida = 0; |Y #pacontm1#0 = 1; |Y #pacontm1#1 = fFecha; |Y #pacontm1#2 = nDoc; |HACIENDO;
                             |SI #pacontm1#3 ] nApunte;
                                nApunte = #pacontm1#3 + 1;
                             |FINSI;
                             |LEE 000#pacontm1.s;
                          |SIGUE;
                          |DDEFECTO #pacontm1;
                          #pacontm1#0 = 1;
                          #pacontm1#1 = fFecha;
                          #pacontm1#2 = nDoc;
                          #pacontm1#3 = nApunte;
                          aAlfa = varalfa % 1512; |QBF aAlfa;
                          aAlfa = aAlfa % 0104;
                          #pacontm1#4 = aAlfa;
                          #pacontm1#5 = varalfa;
                          #pacontm1#6 = varalfa2;
                          |GRABA 020#pacontm1.n;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;

        |BUCLE Temporal;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;

|PROCESO diario_08;

    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;
    |SI fiche = ""; |ACABA; |FINSI;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

   |SI FSalida ] 0;

        top = 1058;  |SI #0#10 ! 3; |Y #0#10 ! 4; top = top + 3; |FINSI;
        |SI #0#10 = 5; top = 1250; |FINSI;
        |SI #0#10 = 7; top = 1282; |FINSI;

        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |SI #0#9 = "F";
                   nLeeCuantos = 250;     |HAZ LeeUnoaUno;    varalfa = aLeeTodo;
                   FSalida = nLeeSalida;
               |SINO;
                   |XLEE handle, 250, varalfa;
               |FINSI;
               |SI FSalida = 250;
                   |SI #0#9 = "F";
                       nLeeCuantos = 48;  |HAZ LeeUnoaUno;    varalfa2 = aLeeTodo;
                       FSalida = nLeeSalida;
                   |SINO;
                       |XLEE handle, 48, varalfa2;
                   |FINSI;
                   |SI FSalida = 48;
                       |SI #0#10 = 5;
                           |SI #0#9 = "F";
                               nLeeCuantos = 50;  |HAZ LeeUnoaUno;    varalfa3 = aLeeTodo;
                               FSalida = nLeeSalida;
                           |SINO;
                              |XLEE handle, 50, varalfa3;
                           |FINSI;
                           |SI FSalida ! 50;
                               sw = 1;
                               |SAL;
                           |FINSI;
                       |FINSI;
                       |SI #0#10 = 7;
                           |SI #0#9 = "F";
                               nLeeCuantos = 51;  |HAZ LeeUnoaUno;    varalfa3 = aLeeTodo;
                               FSalida = nLeeSalida;
                           |SINO;
                              |XLEE handle, 51, varalfa3;
                           |FINSI;
                           |SI FSalida ! 51;
                               sw = 1;
                               |SAL;
                           |FINSI;
                       |FINSI;
                       alfa1 = varalfa % 101;
                       |SI alfa1 ! "*";             || registros borrados
                           |HAZ apuntes_5;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;

|PROCESO diario_07;

    |DELINDEX #17;
    |ABRE #17;

    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

    |SI FSalida ] 0;
        top = 1026;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 250, varalfa;
               |SI FSalida = 250;
                   |XLEE handle, 38, varalfa2;
                   |SI FSalida = 38;
                       alfa1 = varalfa % 101;
                       |SI alfa1 ! "*";             || registros borrados
                           |HAZ apuntes_5;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;


|PROCESO diario_06;

    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 738;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 197, varalfa;
               |SI FSalida = 197;
                   |HAZ apuntes;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
|FPRC;

|PROCESO diario_05;

    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 1026;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 250, varalfa;
               |SI FSalida = 250;
                   |XLEE handle, 34, varalfa2;
                   |SI FSalida = 34;
                       alfa1 = varalfa % 101;
                       |SI alfa1 ! "*";             || registros borrados
                           |HAZ apuntes_5;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;


|PROCESO diario_04;

    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;
    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 483;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 119, varalfa;
               |SI FSalida = 119;
                   |HAZ apuntes_04;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
|FPRC;


|PROCESO diario_03;

    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 610;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 145, varalfa;
               |SI FSalida = 145;
                   |HAZ apuntes;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
|FPRC;


|PROCESO diario_02;

    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;
    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 578;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 139, varalfa;
               |SI FSalida = 139;
                   |HAZ apuntes;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
|FPRC;


|PROCESO diario_01;

    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 483;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 119, varalfa;
               |SI FSalida = 119;
                   |HAZ apuntes;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
|FPRC;

||/////////////////////////////////////////////////////////////////////////////

|| ************************************************************************
|| .... Proceso de la alta de cuentas
|| ************************************************************************

____________________________________/ CALCULOS DEL PASE DE CUENTAS
|PROCESO cli_prov_07;
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 5835;    || direccion
  #16#6 = varalfa % 9325;    || poblacion
  #16#9 = varalfa % 4315;    || cif
|FPRC;

|PROCESO cli_prov_02;
  #16#1 = #4#2;               || nombre
  #16#2 = varalfa %  6835;    || direccion
  #16#6 = varalfa % 10325;    || poblacion
  #16#9 = varalfa %  5315;    || cif
|FPRC;

|PROCESO cli_prov_01;
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 5340;    || direccion
  #16#6 = varalfa % 9325;    || poblacion
  #16#9 = varalfa % 4310;    || cif
|FPRC;

|PROCESO cli_prov_09;
  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#9 = varalfa % 5315;    || cif
  #16#2 = varalfa % 6835;    || direccion
  #16#6 = varalfa % 10325;   || poblacion
  #16#5 = varalfa % 12825;   || provincia

  alfa1 = varalfa % 14802;   || cp 1
  #16#3 = alfa1;
  alfa1 = varalfa % 15003;   || cp 2
  #16#4 = alfa1;
  #16#25 = varalfa % 14805;
|FPRC;

|PROCESO Cli_Prov;

   alfa1 = #4#0 % 103;
   |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
       |ACABA;
   |FINSI;

   |DDEFECTO #16;
   aTipo = "P";
   |SI alfa1 = "430";|O alfa1 = "440";
       aTipo =  "C";
   |FINSI;
   #16#23 = aTipo;
   #16#10 = #4#0;             || cuenta contable
   #16#11 = #4#1;             || digito
   |LEE 101#16=;
   FEstado = FSalida;

   #16#23 = aTipo;
   #16#10 = #4#0;
   #16#11 = #4#1;

   |SI #0#5 = 1;              |HAZ cli_prov_01;   |FINSI;
   |SI #0#5 ] 2;|Y #0#5 [ 6;  |HAZ cli_prov_02;   |FINSI;
   |SI #0#5 = 7;              |HAZ cli_prov_07;   |FINSI;
   |SI #0#5 = 8;|Y #0#10 = 3; |HAZ cli_prov_09;   |FINSI;
   |SI #0#5 = 8;|Y #0#10 = 9; |HAZ cli_prov_09;   |FINSI;
   |SI #0#5 = 9;              |HAZ cli_prov_09;   |FINSI;

   |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
   |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
   |LIBERA #16;
|FPRC;


|PROCESO cuentas;
    alfa1 = varalfa % 101;
    |SI #0#5 = 8; |Y #0#10 = 9;
        |SI alfa1 = "*"; |O alfa1 = " ";
            varalfa = varalfa % 2;    || primera posicion
        |FINSI;
    |FINSI;
    |DDEFECTO #4;
    #4#0     = varalfa % 112;     || cuenta
    eaCuenta = #4#0;
    |HAZ nuSacaNivel;
    #4#0 = eaCuenta;
    |SI enNivel ! 0;

        #4#1 = enNivel;           || digito
        #4#2 = varalfa % 1330;    || Titulo
        |SI #0#5 = 8; |Y #0#10 = 3;
            #4#2 = varalfa % 1340;    || Titulo
        |FINSI;
        |SI #0#5 = 9;
            #4#2 = varalfa % 1340;    || Titulo
        |FINSI;
        #4#3 = "S";               || pase directo

        |ATRI I;
        |PINTA 2221, #4#0;
        |PINTA 2234, #4#2;
        |ATRI 0;

        mascara = #4#0;
        |QBF mascara;
        mascara = mascara +"zzzzzzzzzzzz";
        mascara = mascara % 112;

        #4#54 = mascara;
        #4#55 = #4#1;

        |HAZ defect1;

        |GRABA 000#4n;
        |SI FSalida = 0;
            |HAZ Cli_Prov;
        |FINSI;
   |SINO;
        |MENAV "    No corresponden los Niveles; proceso interrumpido ...";
        sw = 1;
   |FINSI;
|FPRC;

|PROCESO subcta_Ult;

    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;
    |SI eswError ! 0; |ACABA; |FINSI;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

    |SI FSalida ] 0;
        top = enCap;
        |HAZ principio;
        sw = 0;

        |PARA; |SI sw = 0; |HACIENDO;
               sw        = 1;
               nume1     = 0;
               nvariable = 0;
               |PARA para1 = enLongR;  |SI para1 > 0;  |HACIENDO para1 = para1 - 250;
                     |SI para1 ] 250;
                         |XLEE handle, 250, varalfa0;
                     |SINO;
                         |XLEE handle, para1, varalfa0;
                     |FINSI;
                     nume1 = nume1 + FSalida;
                     |SI nvariable = 0; varalfa  = varalfa0; |FINSI;
                     |SI nvariable = 1; varalfa2 = varalfa0; |FINSI;
                     |SI nvariable = 2; varalfa3 = varalfa0; |FINSI;
                     |SI nvariable = 3; varalfa4 = varalfa0; |FINSI;
                     |SI nvariable = 4; varalfa5 = varalfa0; |FINSI;
                     |SI nvariable = 5; varalfa6 = varalfa0; |FINSI;
                     |SI nvariable = 6; varalfa7 = varalfa0; |FINSI;
                     |SI nvariable = 7; varalfa8 = varalfa0; |FINSI;
                     |SI nvariable ] 8; varalfa8 = varalfa0; |FINSI;
                     nvariable = nvariable + 1;
               |SIGUE;
               |SI nume1 = enLongR;
                   sw = 0;
                   |HAZ cuentas;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;

|PROCESO subcta_t09;  ||Nuevo
    |ABRET #4;
    |ABRET #16;

    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 163, varalfa;
               |SI FSalida = 163;
                   |HAZ cuentas;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
     |FINSI;
     Pos = -1;
     |CIERRAT #4;
     |CIERRAT #16;
|FPRC;

|PROCESO subcta_09;
    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 419;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 162, varalfa;
               |SI FSalida = 162;
                   |HAZ cuentas;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
     |FINSI;
     Pos = -1;
     |CIERRAT #4;
     |CIERRAT #16;
|FPRC;

|PROCESO subcta10;
    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = enCap;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw = 1;
               |XLEE handle, 110, varalfa;
               |SI FSalida = 110;
                   |XLEE handle, 250, varalfa2;
                   |SI FSalida = 250;
                       varalfa2 = handle + " 250";
                       |XLEE handle, 250, varalfa2;
                       |SI FSalida = 250;
                           |XLEE handle, 250, varalfa2;
                           |SI FSalida = 250;
                               |XLEE handle, 250, varalfa3;
                               |SI FSalida = 250;
                                   |XLEE handle, 250, varalfa4;
                                   |SI FSalida = 250;
                                       |XLEE handle, 250, varalfa5;
                                       |SI FSalida = 250;               ||
                                           |XLEE handle, 250, varalfa6;
                                           |SI FSalida = 250;
                                               |SI #0#10 = 1; |O #0#10 = 5;
                                                   varalfa7 = handle + " 233";nNume1 = 233;
                                                   |XLEE handle, 233, varalfa7;
                                               |FINSI;
                                               |SI #0#10 = 2; |O #0#10 = 4;
                                                   varalfa7 = handle + " 232";nNume1 = 232;
                                                   |XLEE handle, 232, varalfa7;
                                               |FINSI; ||8
                                               |SI FSalida = nNume1;
                                                   sw = 0;
                                                   |HAZ cuentas;
                                               |FINSI;
                                           |FINSI;
                                       |FINSI;
                                   |FINSI;
                               |FINSI;
                           |FINSI;
                       |FINSI;
                   |FINSI;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;

|PROCESO subcta_08;

    |SI #0#10 = 3; |HAZ subcta_09; |ACABA; |FINSI;  || nuevo 50052

    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;
    |SI eswError = 1;
        |MENAV "    No puedo leer Fichero de Cuentas. ";
        |ACABA;
    |FINSI;
    |SI #0#10 = 9; |HAZ subcta10; |ACABA; |FINSI;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;

        top = 4099; |SI #0#10 = 1; |O #0#10 = 5; top = top + 32; |FINSI;
        |HAZ principio;

        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw = 1;
               |XLEE handle, 110, varalfa;
               |SI FSalida = 110;
                   |XLEE handle, 250, varalfa2;
                   |SI FSalida = 250;
                       varalfa2 = handle + " 250";
                       |XLEE handle, 250, varalfa2;
                       |SI FSalida = 250;                                  ||
                           |XLEE handle, 250, varalfa2;
                           |SI FSalida = 250;                             ||
                               |XLEE handle, 250, varalfa3;
                               |SI FSalida = 250;
                                   |XLEE handle, 250, varalfa4;
                                   |SI FSalida = 250;
                                       |XLEE handle, 250, varalfa5;
                                       |SI FSalida = 250;               ||
                                           |XLEE handle, 250, varalfa6;
                                           |SI FSalida = 250;
                                               |SI #0#10 = 1; |O #0#10 = 5;
                                                   varalfa7 = handle + " 233";nNume1 = 233;
                                                   |XLEE handle, 233, varalfa7;
                                               |FINSI;
                                               |SI #0#10 = 2; |O #0#10 = 4;
                                                   varalfa7 = handle + " 232";nNume1 = 232;
                                                   |XLEE handle, 232, varalfa7;
                                               |FINSI; ||8
                                               |SI FSalida = nNume1;
                                                   sw = 0;
                                                   |HAZ cuentas;
                                               |FINSI;
                                           |FINSI;
                                       |FINSI;
                                   |FINSI;
                               |FINSI;
                           |FINSI;
                       |FINSI;
                   |FINSI;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;


|PROCESO subcta_04;
    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 2307;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw = 1;
               |XLEE handle, 110, varalfa;
               |SI FSalida = 110;
                   |XLEE handle, 250, varalfa2;
                   |SI FSalida = 250;
                       |XLEE handle, 250, varalfa3;
                       |SI FSalida = 250;
                           |XLEE handle, 250, varalfa4;
                           |SI FSalida = 250;
                                sw = 0;
                                |HAZ cuentas;
                           |FINSI;
                       |FINSI;
                   |FINSI;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;

|PROCESO subcta_03;
    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 3971;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw = 1;
               |XLEE handle, 212, varalfa;
               |SI FSalida = 212;
                   |XLEE handle, 250, varalfa2;
                   |SI FSalida = 250;
                       |XLEE handle, 250, varalfa2;
                       |SI FSalida = 250;
                           |XLEE handle, 250, varalfa2;
                           |SI FSalida = 250;
                               |XLEE handle, 250, varalfa2;
                               |SI FSalida = 250;
                                   |XLEE handle, 250, varalfa2;
                                   |SI FSalida = 250;
                                       |XLEE handle, 250, varalfa2;
                                       |SI FSalida = 250;
                                           |XLEE handle, 200, varalfa2;
                                           |SI FSalida = 200;
                                               sw = 0;
                                               |HAZ cuentas;
                                           |FINSI;
                                       |FINSI;
                                   |FINSI;
                               |FINSI;
                            |FINSI;
                       |FINSI;
                   |FINSI;
               |FINSI;
         |SIGUE;
         |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;


|PROCESO subcta_02;
    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 2115;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw = 1;
               |XLEE handle, 214, varalfa;
               |SI FSalida = 214;
                   |XLEE handle, 200, varalfa2;
                   |SI FSalida = 200;
                       |XLEE handle, 200, varalfa2;
                       |SI FSalida = 200;
                           |XLEE handle, 200, varalfa2;
                           |SI FSalida = 200;
                               sw = 0;
                               |HAZ cuentas;
                           |FINSI;
                       |FINSI;
                   |FINSI;
               |FINSI;
        |SIGUE;
        FSalida = handle;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;

|PROCESO subcta_01;

    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        top = 547;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 211, varalfa;
               |SI FSalida = 211;
                   |HAZ cuentas;
               |SINO;
                    sw = 1;
               |FINSI;
        |SIGUE;
        FSalida = handle;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;

____________________________________/ CALCULO PRINCIPAL
|PROCESO pasa;  |TIPO 3;
    aFichero = "p" + Usuario; |NOME_DAT #17 aFichero;
    aFichero = "t" + Usuario; |NOME_DAT #22 aFichero;
    |DELINDEX #17; |DELINDEX #22;

    fFechaUlt = "00.00.0000";

    nNuevo = #0#10;
    |SI #0#0 = "S";

        |SI #0#3 = "S";
            |SI nNuevo = 6; #0#10 = 1; |FINSI;
            |SI nNuevo = 7; #0#10 = 3; |FINSI;
            |SI nNuevo = 8; #0#10 = 1; |FINSI;

            |SI #0#5 = 1;|O #0#5 = 4;
                 |HAZ subcta_01;
            |FINSI;
            |SI #0#5 = 2;|O #0#5 = 3;
                 |HAZ subcta_02;
            |FINSI;
            |SI #0#5 = 5;|O #0#5 = 7;
                 |HAZ subcta_03;
            |FINSI;
            |SI #0#5 = 6;
                 |HAZ subcta_04;
            |FINSI;
            |SI #0#5 = 8;
                 |SI #0#10 ! 9; |HAZ subcta_08;  |FINSI;
                 |SI #0#10 = 9; |HAZ subcta_Ult; |FINSI;
            |FINSI;
            |SI #0#5 = 9;         || Nuevo Txt
                 |HAZ subcta_t09;
            |FINSI;
            #0#10 = nNuevo;
        |FINSI;

        |PINTA 2221, "                                                  ";
        |SI #0#4 = "S";
            nDocumAnt = 0;
            |HAZ contador;
            docum = nDOCUMENTO;
            nRegi = nREGISTRO;
            sw1   = 0;
            |ABRE #2;
            |ABRE #3;

            |SI nNuevo = 6; #0#10 = 3; |FINSI;
            |SI nNuevo = 8; #0#10 = 7; |FINSI;
            |SI #0#5 = 1;    |HAZ diario_01;     |FINSI;
            |SI #0#5 = 2;    |HAZ diario_02;     |FINSI;
            |SI #0#5 = 3;    |HAZ diario_03;     |FINSI;
            |SI #0#5 = 4;    |HAZ diario_04;     |FINSI;
            |SI #0#5 = 5;    |HAZ diario_05;     |FINSI;
            |SI #0#5 = 6;    |HAZ diario_06;     |FINSI;
            |SI #0#5 = 7;    |HAZ diario_07;     |FINSI;
            |SI #0#5 = 8;
                |SI #0#10 ! 9; |HAZ diario_08;  |FINSI;
                |SI #0#10 = 9; |HAZ diario_Ult; |FINSI;
            |FINSI;
            |SI #0#5 = 9;    |HAZ diario_t09;     |FINSI;
            #0#10 = nNuevo;

            |CIERRA #3;
            |CIERRA #2;
            nDOCUMENTO = docum;
            nREGISTRO  = nRegi;
            |HAZ ActContador;
        |FINSI;
        |SI sumar ! 0;
            |HAZ GrabaIva;
        |FINSI;

        |DELINDEX #17; |DELINDEX #22;
    |FINSI;
|FPRC;

|PROCESO nuSacaNivel;

 |QBF eaCuenta;
 alfa1 = eaCuenta % 0;
 nNume1 = alfa1;
 |SI nNume1 < MaximoDigitos;
     nNume2 = MaximoDigitos - nNume1;
     alfa4 = "0" * nNume2;

     alfa1 = eaCuenta % 104;
     alfa2 = eaCuenta % 505;
     alfa3 = alfa1 + alfa4 + alfa2;
     eaCuenta = alfa3;
 |FINSI;

 |HAZ SacaNivel;
|FPRC;

|PROGRAMA;
 |CLS;
 |CABEZA "Pase Contaplus Completa";
 |HAZ Alprincio;

 |PINPA #0#0;

 |ABRE #0;
 |LEE 101#0p;
 |SI FSalida ! 0;
     |DDEFECTO #0;
     |GRABA 020#0b;
 |FINSI;

 #0#0 = "N";
 |PINDA #0#0;

 |ENDATOS #1#0;
 |SI FSalida = 0;
     |GRABA 020#0a;
 |FINSI;
 |CIERRA #0;
|FPRO;
