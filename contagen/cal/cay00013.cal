|FICHEROS;
   cay00013 #0;

   camaasil #1;
   camaasic #2;
   cacuenta #3;
   caclipro #5;
   calicont #31;

   caconimp #8;
   canempre #30;
   caselem1 #998;

   imagen@  #900;
|FIN;

|VARIABLES;
   &entrada  = 1;

   sw_pagina  = 0;
   &pagina    = 0;
   &nPagDup   = 0;
   &nSwPagDup = 0;
   &sw_cab    = 0;

   nNume1     = 0;
   nNume2     = 0;
   aAlfa1     = "";
   digito     = 0;

   fFecAnt    = @;
   &enNumDias = 0;
   informe    = "cay00013";

   mensa1     = "0000ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
   swCliPro   = 0;
   nCampo     = 0;

   sw_con     = 0;  || 1 = EL CONCEPTO ES BUENO
   x          = 0;
   sw_prim    = 0;  || 0 = PRIMERA VEZ
   sw_print   = 0;  || 1 = NO DEBO ESCRIBIR
   swtotal    = 0;

   &cuenta   = "";
   &swant    = 0;
   &s_debe   = 0;
   &s_haber  = 0;
   &s_saldo  = 0;
   &debe     = 0;
   &haber    = 0;
   &direc    = "";
   &codpos   = "";
   &pobla    = "";
   &provi    = "";
   &cif      = "";
   &telef    = "";
   &contra   = "";
   &contra_t = "";

   contra_td = "";
   contra_th = "";
   contra_d  = "";
   contra_h  = "";
   swex_con  = 0;
   nConcepto = 0;
   aPathBase = "";
   aMas      = "";
   nBueno    = 0;
|FIN;

|INCLUYE dscont_i;
|| *********************************************************************
||                             COMIENZO
|| *********************************************************************
|PROCESO &c_pagina;
   |SI sw_pagina = 0;
      pagina = #0#38;
      sw_pagina = 1;

      nPagDup = #0#38;
      nSwPagDup = 1;
   |SINO;
      pagina = pagina + 1;

      |HAZ PDuplex;
   |FINSI;
   sw_cab = 1;
|FPRC;

|PROCESO seleccio; |TIPO 0;
   |SI #0#4 = "N";
      |C_M #0#05, 1, "S"; |C_M #0#06, 1, "S";
      |C_M #0#07, 1, "S"; |C_M #0#08, 1, "S";
      |C_M #0#09, 1, "S"; |C_M #0#10, 1, "S";
      |C_M #0#11, 1, "S"; |C_M #0#12, 1, "S";
      |C_M #0#13, 1, "S"; |C_M #0#14, 1, "S";
      |C_M #0#15, 1, "S"; |C_M #0#16, 1, "S";
      |C_M #0#17, 1, "S"; |C_M #0#18, 1, "S";
      |C_M #0#19, 1, "S"; |C_M #0#20, 1, "S";
      |C_M #0#21, 1, "S"; |C_M #0#22, 1, "S";
      |C_M #0#23, 1, "S"; |C_M #0#24, 1, "S";
      |C_M #0#25, 1, "S"; |C_M #0#26, 1, "S";
      |C_M #0#27, 1, "S"; |C_M #0#28, 1, "S";
      |C_M #0#33, 1, "N"; |C_M #0#34, 1, "N";
      #0#33 = 1;       |PINTA #0#33;
      #0#34 = 999;     |PINTA #0#34;
   |SINO;
      |C_M #0#05, 1, "N"; |C_M #0#06, 1, "N";
      |C_M #0#07, 1, "N"; |C_M #0#08, 1, "N";
      |C_M #0#09, 1, "N"; |C_M #0#10, 1, "N";
      |C_M #0#11, 1, "N"; |C_M #0#12, 1, "N";
      |C_M #0#13, 1, "N"; |C_M #0#14, 1, "N";
      |C_M #0#15, 1, "N"; |C_M #0#16, 1, "N";
      |C_M #0#17, 1, "N"; |C_M #0#18, 1, "N";
      |C_M #0#19, 1, "N"; |C_M #0#20, 1, "N";
      |C_M #0#21, 1, "N"; |C_M #0#22, 1, "N";
      |C_M #0#23, 1, "N"; |C_M #0#24, 1, "N";
      |C_M #0#25, 1, "N"; |C_M #0#26, 1, "N";
      |C_M #0#27, 1, "N"; |C_M #0#28, 1, "N";
      |C_M #0#33, 1, "S"; |C_M #0#34, 1, "S";
   |FINSI;
|FPRC;

|PROCESO seleccio2; |TIPO 0;
   |SI #0#41 = "N";
      |C_M #0#42, 1, "S"; |C_M #0#43, 1, "S";
      |C_M #0#44, 1, "S"; |C_M #0#45, 1, "S";
      |C_M #0#46, 1, "S"; |C_M #0#47, 1, "S";
      |C_M #0#48, 1, "S"; |C_M #0#49, 1, "S";
      |C_M #0#50, 1, "S"; |C_M #0#51, 1, "S";
      |C_M #0#52, 1, "S"; |C_M #0#53, 1, "S";
      |C_M #0#54, 1, "S"; |C_M #0#55, 1, "S";
      |C_M #0#56, 1, "S";
      |C_M #0#0,  1, "N"; |C_M #0#1,  1, "N";
      #0#0 = "            "; #0#31 = 0; |PINTA #0#0;
      #0#1 = "            "; #0#32 = 9; |PINTA #0#1;
   |SINO;
      |C_M #0#0,  1, "S"; |C_M #0#1,  1, "S";
      |C_M #0#42, 1, "N"; |C_M #0#43, 1, "N";
      |C_M #0#44, 1, "N"; |C_M #0#45, 1, "N";
      |C_M #0#46, 1, "N"; |C_M #0#47, 1, "N";
      |C_M #0#48, 1, "N"; |C_M #0#49, 1, "N";
      |C_M #0#50, 1, "N"; |C_M #0#51, 1, "N";
      |C_M #0#52, 1, "N"; |C_M #0#53, 1, "N";
      |C_M #0#54, 1, "N"; |C_M #0#55, 1, "N";
      |C_M #0#56, 1, "N";
   |FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 6;
   eaCuenta = #0Campo;
   salidas  = FSalida;
   |HAZ FiltraPuntos;
   #0Campo = eaCuenta;
   |PINTA #0Campo;
   |SI #0Campo = "            "; |ACABA; |FINSI;

   digito = Campo + 15;
   |SI Campo [ 1;  digito = Campo + 31; |FINSI;

   |HAZ SacaNivel;
   #0digito = enNivel;
|FPRC;

|PROCESO fechas;
  |SI #0Campo < fec1; |O #0Campo > fec2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
  |FINSI;
  |SI Campo = 3; |Y #0#3 < #0#2;
      |MENAV mensa1;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO no_dep; |TIPO 7;
   |C_M #0#36, 1, eaDepar;
   |C_M #0#37, 1, eaDepar;
|FPRC;

|PROCESO nosubde; |TIPO 7;
   |C_M #0#72, 1, eaSubde;
   |C_M #0#73, 1, eaSubde;
|FPRC;

|| **********************************************************************
|PROCESO Siguiente;

   nBueno = 0;
   |SI #900#0 = #1#0; |Y #900#1 = #1#1; |Y #900#2 = #1#2; |Y #900#3 = #1#3;
       |ACABA;
   |FINSI;
   |SI #900#0 < #0#39; |O #900#0 > #0#40;
       |ACABA;
   |FINSI;
   |SI #900#6 < #0#33; |O #900#6 > #0#34;
       |ACABA;
   |FINSI;
   |SI #900#21 < #0#36; |O #900#21 > #0#37;
       |ACABA;
   |FINSI;
   |SI #900#28 < #0#72; |O #900#28 > #0#73;
       |ACABA;
   |FINSI;

   sw_con = 1;
   |SI #0#4 = "N";
       nConcepto = #900#6;
       |HAZ concepto;
   |SINO;
       |SI #900#6 < #0#33; |O #900#6 > #0#34;
           sw_con = 0;
       |FINSI;
   |FINSI;
   |SI sw_con = 0; |ACABA;  |FINSI;

   nBueno = 1;
   fFecAnt = #900#1;
|FPRC;

|PROCESO VerFecPos;

  #900#4 = #1#4;
  #900#1 = #1#1;
  #900#2 = #1#2;
  #900#3 = #1#3;
  |LEE 040#900=;
  |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |Y #900#4 = #1#4; |HACIENDO;
         |HAZ Siguiente;
         |SI nBueno = 1;
             |SAL;
         |SINO;
             |LEE 040#900s;
         |FINSI;
      |SIGUE;
  |FINSI;
  |SI nBueno = 0; fFecAnt = #0#3; |FINSI;
|FPRC;

|PROCESO leecuen;

   |DDEFECTO #3;
   #3#0 = #1#4;
   #3#1 = #1#5;
   |LEE 040#3=;

   sw_print = 0;
   fFecAnt = "01.01.0000";

   direc  = "";
   codpos = "";
   pobla  = "";
   provi  = "";
   cif    = "";
   telef  = "";

   swCliPro = 0;
   |DDEFECTO #5;
   #5#23 = "C";
   #5#10 = #1#4;
   #5#11 = #1#5;
   |LEE 040#5=;
   |SI FSalida = 0;
       swCliPro = 1;
   |SINO;
       #5#23 = "P";
       #5#10 = #1#4;
       #5#11 = #1#5;
       |LEE 040#5=;
       |SI FSalida = 0;
          swCliPro = 1;
       |FINSI;
   |FINSI;

   |SI swCliPro = 1;
       direc  = #5#2;
       codpos = (("00" + #5#3) % -102) + (("000" + #5#4) % -103);
       pobla  = #5#6;
       provi  = #5#5;
       cif    = #5#9;
       telef  = #5#7;
   |FINSI;
|FPRC;

|PROCESO concepto;
   sw_con = 0;
   |PARA x = 5; |SI x [ 28; |HACIENDO x = x + 1;
      |SI #0x  = nConcepto;
         sw_con = 1;
         |SAL;
      |FINSI;
   |SIGUE;
|FPRC;

|PROCESO leocontra;
    contra = "";
    contra_t = "";
    contra_td = "";
    contra_th = "";

    contra_d = #2#10;
    |SALVA_DATOS #3;  |DDEFECTO #3;  #3#0 = #2#10;  #3#1 = #2#11;  |LEE 000#3=;
    contra_td = #3#2;
    |REPON_DATOS #3;

    contra_h = #2#8;
    |SALVA_DATOS #3;  |DDEFECTO #3;  #3#0 = #2#8;   #3#1 = #2#9;   |LEE 000#3=;
    contra_th = #3#2;
    |REPON_DATOS #3;

    swex_con = 0;
    #31#0 = #1#0;
    #31#1 = #1#1;
    #31#2 = #1#2;
    #31#3 = #1#3;
    |LEE 001#31=;
    |SI FSalida = 0;
        swex_con = 1;
        contra_h = #31#4;
        contra_d = #31#4;
        |SALVA_DATOS #3;
        |DDEFECTO #3;
        #3#0 = #31#4;
        #3#1 = #31#5;
        |LEE 000#3=;
        contra_td = #3#2;
        contra_th = #3#2;
        |REPON_DATOS #3;
    |FINSI;
|FPRC;

|PROCESO cabecera;
   |DDEFECTO #2;
   #2#0 = #1#0;
   #2#1 = #1#1;
   #2#2 = #1#2;
   |LEE 040#2=;
|FPRC;

|PROCESO buclepan;
   nConcepto = #1#6;
   sw_con = 1;
   |SI #0#4 = "N"; |HAZ concepto;  |FINSI;
   |SI sw_con = 0; |ACABA;  |FINSI;

   |SI sw_prim = 0;
       cuenta   = #1#4;
       sw_prim  = 1;
       |HAZ leecuen;
   |FINSI;
   |SI cuenta ! #1#4;
       |SI sw_print = 1;
           |PIEINF;
       |FINSI;
       |HAZ borrar;
       cuenta = #1#4;
       |HAZ leecuen;
   |FINSI;

   |SI #1#8 = "D";
       debe = #1#9;
       haber = 0;
   |SINO;
       debe = 0;
       haber = #1#9;
   |FINSI;

   |HAZ cabecera;
   |HAZ leocontra;

   |SI #1#8 = "D";  contra = contra_d; contra_t = contra_td; |FINSI;
   |SI #1#8 = "H";  contra = contra_h; contra_t = contra_th; |FINSI;

   enNumDias = 0;
   fFecAnt   = #1#1;
   |HAZ VerFecPos;
   nNume1    = #1#1;
   nNume2    = fFecAnt;
   enNumDias = nNume2 - nNume1;

   |PRINT;
   swtotal  = 1;
   sw_print = 1;
   swant    = 1;
|FPRC;

|DEFBUCLE cay00013;
   #1#3;
   0, 6, 21, 28;
   #0#0,  #0#2, 000000, 0000, #0#39, #0#33, #0#36, #0#72;
   #0#1,  #0#3, 999999, 9999, #0#40, #0#34, #0#37, #0#73;
   e;
   NULL, buclepan;
|FIN;

|PROCESO HazTodo;
   |HAZ borrar;
   sw_pagina = 0;
   sw_prim   = 0;
   sw_print  = 0;
   swtotal   = 0;

   |ABRE #900;
   |SELECT #3#900;
   |ABRE #2;
   |ABRE #3;
   |ABRE #5;
   |ABRE #31;
   |SI #0#41 = "N";
       swtotal = 0;
       |PARA nCampo = 42; |SI nCampo [ 56; |HACIENDO nCampo = nCampo + 1;
             aAlfa1 = #0nCampo; |QBF aAlfa1;
             |SI aAlfa1 ! "";
                 #0#0 = #0nCampo;
                 #0#1 = #0nCampo;
                 |BUCLE cay00013;
             |FINSI;
       |SIGUE;
   |SINO;
       swtotal = 0;
       |BUCLE cay00013;
   |FINSI;
   |CIERRA #31;
   |CIERRA #5;
   |CIERRA #3;
   |CIERRA #2;
   |SELECT #1#900;
   |CIERRA #900;
   |SI sw_print = 1;
       |PIEINF;
   |FINSI;
|FPRC;

|PROCESO borrar;
   s_debe = 0;
   s_haber = 0;
   s_saldo = 0;
   swant = 0;
|FPRC;
||////////////////////////////////////////////////////////////////////////

|PROCESO Tipo3;

    Impresora = "CrystalReport";
    |IMPRE -1;
    |SI FSalida ! 0;
        |MENAV "0000Error en Impresora. ";
        |ACABA;
    |FINSI;

    |INFOR informe;
    |SI FSalida ! 0;
        |MENAV "     Error en informe.";
        |FINIMP;
        |ACABA;
    |FINSI;

    |DBASE aPathBase;
    aMas  = aPathBase + "def/camaasil";
    |CARGA_DEF aMas, imagen@;
    |SI FSalida ! 0;
        |MENAV "    Error Cargado Fichero de Contabilidad. Proceso Interrumpido";
        |ACABA;
    |FINSI;

    |SI #48#27 = "S";
        |HAZ MultiEmpresa;
    |SINO;
        |DFICE dirfich0; |QBF dirfich0;
        |HAZ HazTodo;
    |FINSI;

    |DESCARGA_DEF #900;

    |FININF;
    |FINIMP;
|FPRC;

|PROGRAMA;
   |HAZ inicio;

   |CLS;
   |CABEZA "Calculo Int.financieros";

   |ABRE #0;
   |DDEFECTO #0;
   |LEE 041#0=;
   |SI FSalida ! 0;
       #0#2 = fec1;
       #0#3 = fec2;
       |GRABA 020#0c;
   |FINSI;

   |PDEFECTO #0, 30, 31;

   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #2#0;
   |SI FSalida = 0;
       |HAZ Tipo3;

       |SI #0#41 = "N"
           |PDEFECTO #0, 0,2;
       |FINSI;
       |GRABA 020#0a;
   |FINSI;
   |CIERRA #0;
|FPRO;

|| **********************************************************************
|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;
   |SI fec1 > #0#3; |O fec2 < #0#2; |ACABA; |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #1   dirfich0;
   |PATH_DAT #900 dirfich0;
   |PATH_DAT #2   dirfich0;
   |PATH_DAT #3   dirfich0;
   |PATH_DAT #5   dirfich0;
   |PATH_DAT #8   dirfich0;
   |PATH_DAT #31  dirfich0;

   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
   #caselem1#1;
   ;
   000001;
   999999;
   ;
   NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
