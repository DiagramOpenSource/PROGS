|FICHEROS;
   catbam02;
   catbam03,MANTE;
   catbam04,MANTE;
   catbam05;

   catbam01;
   catbaw02;
|FIN;

|VARIABLES;
   &entrada = 1;

   nInkey   = 0;
   aAlfa1   = "";
   aAlfa2   = "";
   nNume1   = 0;
   aFichero = "";
   nModoEntrada = 0;
   sw_movim = 0;

   &fecapu   = @;
   &fecant   = @;
   &coant    = 1;
   &dpant    = "";
   &sdant    = "";
   &snFiltrA = "";
   &eftbaz3  = @;
   &entbaz4  = 0;
   &entbaz5  = 0;
   &entbaz6  = 0;
   &enOk     = 0;
   &enDias   = 0;
|FIN;

|INCLUYE dscont_i;

|PROCESO Completbaw02;
   #catbaw02#0 = #catbam03#20;
   #catbaw02#1 = #catbam03#21;
   #catbaw02#2 = #catbam03#22;
   #catbaw02#3 = #catbam03#23;
   |LEE 041#catbaw02.=;
   |SI FSalida ! 0;
       #catbaw02#0 = #catbam03#20;
       #catbaw02#1 = #catbam03#21;
       #catbaw02#2 = #catbam03#22;
       #catbaw02#3 = #catbam03#23;
       |GRABA 020#catbaw02.c;
   |FINSI;
   #catbaw02#4 = #catbam03#0;
   #catbaw02#5 = #catbam03#2;
   #catbaw02#6 = 0;

   |GRABA 020#catbaw02.a;
|FPRC;

|DEFBUCLE Completbaw02;
   #catbam03#1;
   19;
   "            ", 00001, "X";
   "zzzzzzzzzzzz", 99999, "X";
   e;
   NULL, Completbaw02;
|FIN;

|PROCESO Todosw02;
   |ABRE #catbaw02;
   |BUCLE Completbaw02;
   |CIERRA #catbaw02;
|FPRC;

|CALCULO T8m2;  |TIPO 8;
   |HAZ inicio;
   |HAZ DirAplicSt;

   fecapu = ~;
   nNume1 = fecapu;
   nNume1 = nNume1 - 1;
   fecant = nNume1;
   enFilConc = 1;          || Conceptos sin IVA
   |HAZ CreaConcepto;

   dpant = eaDfDepC;
   sdant = eaDfSubC;
   |HAZ eLeeParametro;

   aFichero = "catbaw02" + Usuario;  |NOME_DAT #catbaw02#aFichero#;
   |DELINDEX #catbaw02;
   |HAZ Todosw02;
|FCAL;
|| /////////////////////////////////////////////////////////////

|PROCESO LeoLasLineas;
 enOk = 0;
 |ABRE #catbam03;
 #catbam03#0 = #catbam02#0;
 #catbam03#2 = 1;
 |LEE 041#catbam03.];
 |SI FSalida = 0; |Y #catbam03#0 = #catbam02#0;
     enOk = 1;
 |FINSI;
 |CIERRA #catbam03;
|FPRC;

|PROCESO LaCarga;
  eaCuenta = #catbam02#0;
  eaNomCta = #catbam02#2;
  eftbaz3  = #catbam02#3;
  entbaz4  = #catbam02#4;
  entbaz5  = 0;
  entbaz6  = 0;
  |SUB_EJECUTA_NP "catbaz02;recoge";
  |HAZ LeoLasLineas;
  #catbam02#3 = eftbaz3;
  #catbam02#4 = entbaz4;
  #catbam02#5 = entbaz5;
  #catbam02#6 = entbaz6;
  #catbam02#7 = #catbam02#4 + #catbam02#5 - #catbam02#6;

  |PINTA #catbam02#3;
  |PINTA #catbam02#4;
  |PINTA #catbam02#5;
  |PINTA #catbam02#6;
  |PINTA #catbam02#7;
|FPRC;

|| /////////////////////////////////////////////////////////////
|RUTINA Uno1;
   #catbam02#0 = "            ";
|FRUT;

|RUTINA Dos1;
   #catbam02#0 = "zzzzzzzzzzzz";
|FRUT;

|CALCULO Tipo6C0m2;  |TIPO 6;
   nInkey = FSalida;

   |ABRE #catbam01;
   #catbam01#0 = "            ";
   |LEE 040#catbam01.=;
   |SI FSalida ! 0;
       |DDEFECTO #catbam01;
       |GRABA 020#catbam01.n;
   |FINSI;
   |CIERRA #catbam01;

   |SI nInkey ! 10; |Y nInkey ! 11;
       nModoEntrada = (FEntrada / 100) ! 0;
       |SI nModoEntrada = 1;
           eaCuenta = #catbam02#0; |QBF eaCuenta;
           |SI eaCuenta = "";
               |MENAV "    Cuenta Erronea ";
               |ERROR;
           |FINSI;
       |FINSI;
   |FINSI;

   |SI nInkey = 11;
       |PUSHV 0501 2380;
       |CONSULTA_F_CLAVE #1#catbam02, Uno1, Dos1;
       |POPV;
       |PINTA #catbam02#0;
       |ERROR;
       |ACABA;
   |FINSI;

   eaCuenta = #catbam02#Campo#;
   salidas  = nInkey;
   |HAZ FiltraPuntos;
   #catbam02#Campo# = eaCuenta;
   |PINTA #catbam02#Campo#;
   coant = 0;
|FCAL;

|PROCESO BorraTbam03;
   |BORRA 020#catbam03.a;
   |LIBERA #catbam03;
|FPRC;

|DEFBUCLE BorraTbam03;
   #catbam03#1;
   ;
   #catbam02#0, 00001;
   #catbam02#0, 99999;
   be;
   NULL, BorraTbam03;
|FIN;

|PROCESO BorraTbaw02;
   |BORRA 020#catbaw02.a;
   |LIBERA #catbaw02;
|FPRC;

|DEFBUCLE BorraTbaw02;
   #catbaw02#2;
   ;
   #catbam02#0, 00001;
   #catbam02#0, 99999;
   be;
   NULL, BorraTbaw02;
|FIN;

|PROCESO BorraTbam05;
   |BORRA 020#catbam05.a;
   |LIBERA #catbam05;
|FPRC;

|DEFBUCLE BorraTbam05;
   #catbam05#2;
   ;
   #catbam02#0, 00001, 00000;
   #catbam02#0, 99999, 99999;
   be;
   NULL, BorraTbam05;
|FIN;

|PROCESO T1m2; |TIPO 1;
   nModoEntrada = (FEntrada / 100) ! 0;
   |SI nModoEntrada = 3;
       |CONFI "0000NDesea borrar todos los datos";
       |SI FSalida ! 0;
           |ERROR;
           |ACABA;
       |FINSI;

       |BUCLE BorraTbam03;
       |BUCLE BorraTbaw02;
       |BUCLE BorraTbam05;

       |ABRE #catbam01;
       #catbam01#0 = #catbam02#0;
       |LEE 040#catbam01.=;
       |SI FSalida = 0;
           #catbam01#2 = #catbam01#28;
           #catbam01#3 = #catbam01#29;
           |GRABA 020#catbam01.a;
       |FINSI;
       |CIERRA #catbam01;
   |FINSI;
|FPRC;

|CALCULO Altam03;
   #catbam03#0 = #catbam02#0;
   #catbam03#2 = 00001;
|FCAL;

|CALCULO Bajam03;
   #catbam03#0 = #catbam02#0;
   #catbam03#2 = 99999;
|FCAL;

|PROCESO Tipo7C0m02; |TIPO 13;
   |C_V #catbam03#8,  1, "N";
   |C_V #catbam03#24, 1, "S";
   |ENTLINEAL #1#catbam03, -2, 7, 19, 0, Altam03, Bajam03;
   |BLANCO 2102 2337;
   |BLANCO 2139 2351;
   |BLANCO 2153 2365;
   |BLANCO 2167 2379;
   |BLANCO 2202 2379;
|FPRC;

|CALCULO Tipo0C0m2;  |TIPO 0;
   emCta    = 1;
   eaCuenta = #catbam02#0;
   |HAZ SacaNivel;
   |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
   #catbam02#1= enNivel;

   |HAZ LeeCuenta;
   |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea

   enOk = 1;
   nModoEntrada = (FEntrada / 100) ! 0;
   |SI nModoEntrada = 1; |O nModoEntrada = 2;
       |HAZ LeoLasLineas;
       |SI enOk = 0;
           |MENAV "0000No existe ningun movimiento introducido";
           |CONFI "0000SRealizar la carga de un nuevo fichero";
           |SI FSalida = 0;
               |HAZ LaCarga;
           |FINSI;
           |SI enOk = 0;
               |ERROR;
               |PTEC 807;
           |FINSI;
       |FINSI;
    |FINSI;
|FCAL;

|PROCESO Tipo12m2; |TIPO 12;

   |ABRE #catbam01;
   |DDEFECTO #catbam01;
   #catbam01#0 = #catbam02#0;
   |LEE 040#catbam01.=;
   |CIERRA #catbam01;

   enDias = #catbam01#9;
   aAlfa1 = #catbam01#8; aAlfa2 = #catbam01#8;
   |SI eaDepar  = "N"; aAlfa1 = "N"; |FINSI;
   |SI eaSubde  = "N"; aAlfa2 = "N"; |FINSI;
   |C_M #catbam03#12, 1, aAlfa1;
   |C_M #catbam03#13, 1, aAlfa2;

   |C_V #catbam03#8,  1, "N";
   |C_V #catbam03#24, 1, "S";
   |ENTLINEAL #1#catbam03, -2, 4, 19, 0, Altam03, Bajam03;
   sw_movim = 1;
|FPRC;

|PROCESO salir; |TIPO 9;
 |SI sw_movim = 0; |ACABA; |FINSI;
 |AVISO;
 |CONFI "2400SDesea actualizar la Introduccion Realizada S/N : ";
 |SI FSalida =  0;
     |SUB_EJECUTA_NP "catbaz03";
 |FINSI;
|FPRC;
