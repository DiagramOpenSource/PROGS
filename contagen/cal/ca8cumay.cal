|FICHEROS;
   ca8cumay #0,MANTE;    || cuentas
   ca8comay #1;
   ca8z0000 #10;

   ca8m0002 #5;    ||
   ca8agmay #8;    || agrupaciones
   cacuebal #9;

   &ca8cuma@ #100;
|FIN;

|VARIABLES;
   &entrada = 1;
   nModo    = 0;
   cinco    = "     ";
   cta      = "     ";
   ctanum   = 0;
   ctaalf   = "";
   longalf  = "";
   longnum  = "";
   uno      = "";
   dos      = "";
   nada     = "";
   mascara  = "";
   aAlfa1   = "";
   aAlfa2   = "";

   nInkey   = 0;
   nLong    = 0;
   nNume1   = 0;
   nNoBal8  = 0;
|FIN;

|INCLUYE dscont_i;

||  ***************************************
|PROCESO nivel_m; |TIPO 0;

   nModo = (FEntrada / 100) ! 0;
   |SI #0#0 = cinco;
       |SI nModo = 4; |ACABA; |FINSI;
   |FINSI;

   cta = #0#0; |QBF cta;
   nada = cta % A101;
   |SI nada ! "0";
       ctanum = cta;
       ctaalf = ctanum;
       longnum = ctaalf % A0;
   |SINO;
       ctanum = 1;
       ctaalf = cta;
       longnum = ctaalf % A0;
   |FINSI;
   longalf = cta    % A0;
   |SI longnum ! longalf;|O ctanum = 0;
       |MENAV "    CUENTA ERRONEA!!!";
       |PINTA #0#0;
       |ERROR;
       |ACABA;
   |FINSI;

   || la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
   mascara = #0#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 105;
   #0#7    = mascara;
   #0#8    = longnum;

   |SI nModo = 1; |HAZ defect_m; |FINSI;
|FPRC;

|PROCESO DuplicoDesc; |TIPO 0;
   nInkey = FSalida;
   cta = #0#0;
   |SI nInkey = 15; |HAZ BuscaAntes; |FINSI;
|FPRC;

|PROCESO filtro_cta; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #0#3 = "D"; |O #0#3 = "H"; #0#2 = 1; |FINSI;
   |SI #0#3 = "A"; |O #0#3 = "P"; #0#2 = 0; |FINSI;
   |SI #0#3 = "I"; |O #0#3 = "G"; #0#2 = 6; |FINSI;

   #0#4 = "";
   |SI #0#3 = "A"; #0#4 = "ACTIVO";  aAlfa1 = "+"; |FINSI;
   |SI #0#3 = "P"; #0#4 = "PASIVO";  aAlfa1 = "-"; |FINSI;
   |SI #0#3 = "D"; #0#4 = "DEBE";    aAlfa1 = "+"; |FINSI;
   |SI #0#3 = "H"; #0#4 = "HABER";   aAlfa1 = "-"; |FINSI;
   |SI #0#3 = "I"; #0#4 = "INGRESO"; aAlfa1 = "-"; |FINSI;
   |SI #0#3 = "G"; #0#4 = "GASTO";   aAlfa1 = "+"; |FINSI;
   |PINTA #0#4;

   |SI nModo = 1; #0#11 = aAlfa1; |PINTA #0#11; |FINSI;
|FPRC;

|PROCESO LeeAgrupa; |TIPO 6;
   |ABRE #8;
   #ca8agmay#3 = #0#10;   || Numero Plan
   #ca8agmay#0 = #0#3;    || tipo
   #ca8agmay#1 = #0#5;    || agrupacion
   |LEE 001#8=;
   |SI FSalida ! 0;  |DDEFECTO #8;  |FINSI;
   #0#6 = #ca8agmay#2; |PINTA #0#6;
   |CIERRA #8;
|FPRC;

|PROCESO Antesdes2; |TIPO 7;
 aAlfa1 = #0#9; |QBF aAlfa1;
 |SI aAlfa1 = "";
     #0#9 = #0#1;
     |PINTA #0#9;
 |FINSI;
|FPRC;

|| **************************************************************************
|PROCESO Busco1990;
 uno     = #0#0; |QBF uno;
 |SI uno = ""; |ACABA; |FINSI;
 uno = uno % 101;
 |SI uno = "6"; #0#3 = "D"; |FINSI;
 |SI uno = "7"; #0#3 = "H"; |FINSI;
 |SI uno = "8"; #0#3 = "G"; |FINSI;
 |SI uno = "9"; #0#3 = "I"; |FINSI;

 |ABRE #cacuebal;
 uno = #0#0; |QBF uno;
 dos = uno + "000000000000";

 uno = dos % A105;
 #cacuebal#0 = uno;
 |LEE 040#cacuebal.=;
 |SI FSalida = 0; #0#3 = #cacuebal#2; |ACABA; |FINSI;

 uno = dos % A104;
 #cacuebal#0 = uno;
 |LEE 040#cacuebal.=;
 |SI FSalida = 0; #0#3 = #cacuebal#2; |ACABA; |FINSI;

 uno = dos % A103;
 #cacuebal#0 = uno;
 |LEE 040#cacuebal.=;
 |SI FSalida = 0; #0#3 = #cacuebal#2; |ACABA; |FINSI;

 uno = dos % A102;
 #cacuebal#0 = uno;
 |LEE 040#cacuebal.=;
 |SI FSalida = 0; #0#3 = #cacuebal#2; |ACABA; |FINSI;

 uno = dos % A101;
 #cacuebal#0 = uno;
 |LEE 040#cacuebal.=;
 |SI FSalida = 0; #0#3 = #cacuebal#2; |FINSI;
|FPRC;

|PROCESO saca_2008_0;
   #0#2 = #ca8m0002#2;
   #0#3 = #ca8m0002#3;
   #0#5 = #ca8m0002#4;
   nNoBal8 = 0;
|FPRC;

|DEFBUCLE saca_2008_0;
 #ca8m0002#2;
 ;
 #10#2, #10#0, 0, uno;
 #10#2, #10#0, 9, uno;
 ;
 NULL, saca_2008_0;
|FIN;

|PROCESO leodefect0;
     |SI nNoBal8 = 1;
         uno = (uno + "     " ) % 105;
         |BUCLE saca_2008_0;
     |FINSI;
|FPRC;

|PROCESO defect_m;

   mascara = #0#0;
   |QBF mascara;
   mascara = mascara +"zzzzzzzzzzzz";
   mascara = mascara % 105;
   #0#7    = mascara;
   #0#8    = longnum;

   nNoBal8 = 1;
   uno = #0#0; |QBF uno;
   dos = uno + "000000000000";

   uno = dos % A105;
   |HAZ leodefect0;
   |SI nNoBal8 = 0; |VETE Fin; |FINSI;

   uno = dos % A104;
   |HAZ leodefect0;
   |SI nNoBal8 = 0; |VETE Fin; |FINSI;

   uno = dos % A103;
   |HAZ leodefect0;
   |SI nNoBal8 = 0; |VETE Fin; |FINSI;

   uno = dos % A102;
   |HAZ leodefect0;
   |SI nNoBal8 = 0; |VETE Fin; |FINSI;

   uno = dos % A101;
   |HAZ leodefect0;
   |SI nNoBal8 = 1;
      |MENAV "     No esta definida esta cuenta en Cuentas de Balance";
   |FINSI;

 |ET Fin;
   |SI #0#3 = "R"; |O #0#3 = "E";
       |HAZ Busco1990;
   |FINSI;
|FPRC;

|PROCESO BuscaAntes;
   aAlfa1   = cta; |QBF aAlfa1;
   aAlfa1   = aAlfa1 % 0;
   nLong    = aAlfa1;
   nNume1   = nLong - 1;
   |SI nNume1 ! 0;
       aAlfa1 = nNume1;
       aAlfa1 = ("00" + aAlfa1) % -102;
       aAlfa1 = "1" + aAlfa1;
       aAlfa2 = cta % aAlfa1;

       |ABRE #100;
       #100#12 = #10#2;
       #100#0  = aAlfa2;
       #100#10 = #0#10;
       |LEE 001#100=;
       |SI FSalida = 0;
           #0#1 = #100#1; |PINTA #0#1;
           #0#2 = #100#2; |PINTA #0#2;
           #0#3 = #100#3; |PINTA #0#3;
           #0#4 = #100#4; |PINTA #0#4;
           #0#5 = #100#5; |PINTA #0#5;
           #0#6 = #100#6; |PINTA #0#6;
           #0#9 = #100#9; |PINTA #0#9;
           #0#11= #100#11; |PINTA #0#11;
       |FINSI;
       |CIERRA #100;
  |FINSI;
|FPRC;
|| **************************************************************************
