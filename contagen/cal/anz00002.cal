|FICHEROS;

  anz00002 #0;
  anm00008 #1;  || Empresas Analiticas
  anm00009 #2;  || Lineas
  camaasil #3;
  anw00001 #4;  || Lineal de Empresas Analiticas
  cacuebal #5;
  cacuenta #6;

  anm00003 #7;   || Grupos Analitica
  anm00013 #13;  || Grupos Analitica Apuntes

  :/modelos/def/dsmom035 #35;
  :/modelos/def/dsmom036 #8;    || cacongru #8; Grupos conceptos

  cacuepre #9;
  caagrupr #10;

  anm00017 #117;
  anm00018 #118;

    cacuen01 #29;     ||LOS FICHEROS cacuenta para repondatos
    cacuen02 #22;     ||LOS FICHEROS cacuenta para repondatos
    cacuen03 #23;     ||LOS FICHEROS cacuenta para repondatos
    cacuen04 #24;     ||LOS FICHEROS cacuenta para repondatos
    cacuen05 #25;     ||LOS FICHEROS cacuenta para repondatos
    cacuen06 #26;     ||LOS FICHEROS cacuenta para repondatos

  canempre #30;
  catmpcu@ #99; || Temporal Cuentas Resumidas
  anm0003@ #907;

  ca8m0002 #422;
  ca8cumay #410;
|FIN;

|VARIABLES;

  aAlfa1 = "";
  aAlfa2 = "";
  aAlfa3 = "";
  nNume1 = 0;
  VAlfa0 = "";
  VAlfa1 = "";
  VAlfa2 = "";
  VAlfa3 = "";
  VAlfa4 = "";

  juan = 0;
  mensa = "";
  lon = 0;
  prim = 0;
  mensa1 = "     No puedo bloquear los ficheros";
  a = 0;
  b = 0;
  c = 0;
  mesac = 0;
  mesfec = 0;
  mes = "";
  fecalf = "";
  ini = 0;
  errant = "aaaaaaaaaaaa";
  cuant = "";
  iniemp = 0;

    num = 0;
    cuant1 = "";
    cuant2 = "";
    cuant3 = "";
    cuant4 = "";
    cuant5 = "";
    cuant6 = "";
    lon1 = 0;
    lon2 = 0;
    lon3 = 0;
    lon4 = 0;
    lon5 = 0;
    lon6 = 0;
    aa = 0;
    aar = "";
    traba2 = "";
    traba3 = "";
    traba4 = "";
    traba5 = "";
    traba6 = "";
    mensaa = "";
    conforme = "";
    d_diari = 0;
    d_opera = "";
    d_impor = 0;
    diant = 0;
    primera = 0;

  r_emp  = 0;
  r_per  = 0;
  sw_con = 0;
  swsel  = 0;
  swalta = 0;
  x = 0;
  y = 0;
  contador  = 0;
  noCALCULO = 0;
  edn_desde = 0;
  edn_hasta = 0;
  edn_nume1 = 0;
  edn_error = 0;
  edn_trozo = "";
  edn_masca = "";
  edn_aAlfa1 = "";
  edn_cuent = "";

  aFichero   = "";
  swNoSigas  = 0;
  aDirInicio = "";
  aMas       = "";

     nSwGApte  = 0;
     nImporte  = 0;
     nImpGrupo = 0;
     nTp100    = 0;
     nTp100_G2 = 0;
     nSwOp     = 0;
     nSwSubgr  = 0;
     aCta2Gru  = "";
     edn_error2 = 0;
     nEjerActual = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE copian_i;
|INCLUYE dscoan_i;
|INCLUYE defec1_i;

|| ******************************************************************
|| ************ CALCULO Campos en Pantalla
|CALCULO InicioAnz2; |TIPO 8;
 |HAZ InicioAna;
 |SI  enSwAna = 0; |ACABA;  |FINSI;

  aMonedaC = eaMoneda;
  |DBASE dir_fich;
  dir_fich = dir_fich + "fich/";
  aAlfa1 = ("000000" + #30#0) % -106;
  fich_copi = dir_fich + aAlfa1 + "/";

  |HAZ DirAplicSt;
  |SI Haymodelo = 0; |ACABA; |FINSI;
  aAlfa1 = aPModelo + "/fich/";
  |PATH_DAT #35 aAlfa1;
|FCAL;

|CALCULO consulta; |TIPO 0;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SUB_EJECUTA "caconemp";
  |SI r_emp ! 0;
      |ERROR;
      nNume1   = Campo + 2;
      #0Campo  = r_emp; |PINTA #0Campo;
      #0nNume1 = r_per; |PINTA #0nNume1;
      |PTEC 802;
  |SINO;
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO recoge; |TIPO 7;
  #0#2 = fec1; |PINTA #0#2;
  #0#3 = fec2; |PINTA #0#3;
  #0#20 = enPeriodo; |PINTA #0#20;
  #0#21 = enPeriodo; |PINTA #0#21;
  |PINTA 0725, #30#2;  || |PINTA 0730, enEmpresa;
  |PINTA 0732, #30#1;  || |PINTA 0737, eaNombreEmp;
|FCAL;

|CALCULO fechas; |TIPO 0;
  |SI #0Campo > fec2;|O #0Campo < fec1;
      |MENAV "     FECHA ERRONEA ...";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI Campo = 3; |Y #0#2 > #0#3;
      |MENAV "     FECHA ERRONEA ...";
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO selecci2; |TIPO 0;
   |SI #0#10 = "N";
       |CAMPO_MODIFICA #0#06, 1, "S";
       |CAMPO_MODIFICA #0#07, 1, "S";

       |CAMPO_MODIFICA #0#11, 1, "N";
       |CAMPO_MODIFICA #0#12, 1, "N";
       |CAMPO_MODIFICA #0#13, 1, "N";
       |CAMPO_MODIFICA #0#14, 1, "N";
           #0#11 = 0;      |PINTA #0#11;
           #0#12 = 0;      |PINTA #0#12;
           #0#13 = 0;      |PINTA #0#13;
           #0#14 = 0;      |PINTA #0#14;
   |SINO;
       |CAMPO_MODIFICA #0#06, 1, "N";
       |CAMPO_MODIFICA #0#07, 1, "N";
        #0#06 = 1;      |PINTA #0#06;
        #0#07 = 999;    |PINTA #0#07;

       |CAMPO_MODIFICA #0#11, 1, "S";
       |CAMPO_MODIFICA #0#12, 1, "S";
       |CAMPO_MODIFICA #0#13, 1, "S";
       |CAMPO_MODIFICA #0#14, 1, "S";
   |FINSI;
|FCAL;

|CALCULO leegrupo; |TIPO 6;
 |SI FSalida = 2; |ACABA; |FINSI;
 |SI #0Campo = 0; |ACABA; |FINSI;
 |ABRE #35;
 #35#0 = #0Campo;
 |LEE 001#35=;
 |SI FSalida ! 0;
     |MENAV "     NO existe el Grupo de Conceptos";
     |ERROR;
 |FINSI;
 |CIERRA #35;
|FCAL;


|| ******************************************************************
|| ******************************************************************
|| ******************************************************************

|| ******* Procesos de Creacion Plan Contable
|CALCULO acumulados;
  |PDEFECTO #6,9,54;
  |GRABA 020#6a;
  |LIBERA #6;
|FCAL;

|DEFBUCLE cacreane0;     || acera las cuentas
 #6#1;
 ;
 "            ";
 "zzzzzzzzzzzz";
 be;
 NULL, acumulados;
|FIN;

|| ------------------------------------------------------------
|CALCULO edig_ana1;
    edn_desde = #2#3;                  || a partir de ...
    edn_hasta = #2#4;                  || nro. digitos
    edn_masca = #2#5;  |QBF edn_masca; || mascara
    edn_nume1 = (edn_desde * 100) + edn_hasta;
    edn_trozo = edn_nume1;
    edn_error = 0;
    edn_aAlfa1 = edn_cuent % edn_trozo;  || mascara
    |SI edn_aAlfa1 ! edn_masca;|Y edn_desde ! 0;|Y edn_hasta ! 0;
        edn_error = 1;                  || no es valida la cuenta
        |ERROR10;
    |FINSI;
|FCAL;

|DEFBUCLE edig_ana;
 #2#1;
 ;
 #4#1, #4#2, 000;
 #4#1, #4#2, 999;
 e;
 NULL, edig_ana1;
|FIN;

|CALCULO ver_grupo2;
 edn_cuent = #907#2;
 |BUCLE edig_ana;
 |SI edn_error = 0;
     nTp100_G2  = nTp100_G2 + #907#4;
     edn_error2 = 0;
 |FINSI;
|FCAL;

|DEFBUCLE selegrupo2;
 #907#1002;
 ;
 aCta2Gru, 000;
 aCta2Gru, 999;
 e;
 NULL, ver_grupo2;
|FIN;

|PROCESO ver_grupo_apte;
 nSwGApte = 1;
 edn_cuent = #13#6;
 |BUCLE edig_ana;
 |SI edn_error = 0;
     swsel = 1;
     nImporte = nImporte + #13#9;
 |SINO;
     aAlfa1 = #13#6 % 103;
     |SI aAlfa1 = "GRU";
          edn_error2 = 1;
          aCta2Gru   = #13#6;
          nImpGrupo  = #13#9;
          nTp100_G2  = 0;
          |BUCLE selegrupo2;
          |SI edn_error2 = 0;
              swsel = 1;
              |SI nTp100_G2 ! 0;
                  nImpGrupo = (nImpGrupo % nTp100_G2) ! EURODB;
                  nImporte  = nImporte + nImpGrupo;
              |FINSI;
          |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE selgruApte;
 #13#1;
 ;
 #3#0, #3#1, #3#2, #3#3, #3#29, 000;
 #3#0, #3#1, #3#2, #3#3, #3#29, 999;
 e;
 NULL, ver_grupo_apte;
|FIN;

|CALCULO ver_grupo;
 edn_cuent = #7#2;
 |BUCLE edig_ana;
 |SI nSwOp = 0;
     |SI edn_error = 0;
         swsel = 1;
         nTp100 = nTp100 + #7#4;
     |SINO;
         aAlfa1 = #7#2 % 103;
         |SI aAlfa1 = "GRU";
             nSwSubgr = 1;
         |FINSI;
     |FINSI;
 |SINO;
     |SI edn_error ! 0;
         aAlfa1 = #7#2 % 103;
         |SI aAlfa1 = "GRU";
             edn_error2 = 1;
             aCta2Gru   = #7#2;
             nImpGrupo  = (#3#9 % #7#4) ! EURODB;
             nTp100_G2  = 0;
             |BUCLE selegrupo2;
             |SI edn_error2 = 0;
                 swsel = 1;
                 |SI nTp100_G2 ! 0;
                     nImpGrupo = (nImpGrupo % nTp100_G2) ! EURODB;
                     nImporte  = nImporte + nImpGrupo;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
 |FINSI;
|FCAL;

|DEFBUCLE selegrupo;
 #7#1;
 ;
 #3#29, 000;
 #3#29, 999;
 e;
 NULL, ver_grupo;
|FIN;

|CALCULO cuenta_ana;
 swsel = 0;
 edn_error = 0;

 edn_cuent = #3#29;
 |BUCLE edig_ana;
 |SI edn_error = 0;
     swsel = 1;
 |SINO;
    aAlfa3 = #3#29 % 103;
    |SI aAlfa3 = "GRU";
        nSwGApte = 0;
        nTp100   = 100;
        nImporte = 0;
        |BUCLE selgruApte;
        |SI nSwGApte = 0;
            nSwSubgr = 0;
            nSwOp    = 0;
            nImporte = #3#9;
            nTp100   = 0;
            |BUCLE selegrupo;
            |SI nSwSubgr = 1;  ||existe algun subgrupo, vuelvo a calcular importe
                nSwOp    = 1;
                nImporte = 0;
                |SI nTp100 ! 0;
                    nImporte = (#3#9 % nTp100) ! EURODB;
                |FINSI;
                nTp100   = 100;
                |BUCLE selegrupo;
            |FINSI;
        |FINSI;
    |FINSI;
 |FINSI;
|FCAL;


|CALCULO conceptos;
  |SI #0#10 = "N"; |ACABA; |FINSI;
  sw_con = 0;
  |PARA y = 11; |SI y [ 14; |HACIENDO y = y + 1;
        |SI #0y ! 0;
            #8#0 = #0y;
            #8#1 = #3#6;
            |LEE 001#8=;
            |SI FSalida = 0;  sw_con = 1; |FINSI;
        |FINSI;
        |SI sw_con = 1; |SAL; |FINSI;
  |SIGUE;
|FCAL;

|CALCULO leecuenta;
  |LIBERA #6;
  |LEE 101#6=;
  |SI FSalida ! 0;
      |LIBERA #6;
      |DDEFECTO #6;
      #99#0 = cuant;
      |LEE 001#99=;
      |SI FSalida = 0;
          #6#0 = #99#0;    #6#1 = #99#1;
          eaCuenta = #6#0; |HAZ SacaNivel; #6#1 = enNivel;
          #6#2 = #99#2;    #6#3 = #99#3;
          #6#4 = #99#4;    #6#5 = #99#5;
          #6#6 = #99#6;    #6#7 = #99#7;
          #6#8 = #99#8;    #6#54 = #99#54;
          #6#55 = #99#55;  #6#56 = #99#56;
          #6#57 = #99#57;
      |SINO;
          |HAZ pidealta;
      |FINSI;
      |GRABA 020#6b;
  |FINSI;
|FCAL;

|CALCULO pidealta;
      #6#0 = cuant;
      #6#1 = juan;
      |HAZ defect1;
      |PUSHV 0501 1980;
      |PINPA #0#6;
      |PINDA #0#6;
      |ENDATOS #1#6;
      |SI FSalida ! 0;
          |DDEFECTO #6;
          #6#0 = cuant;
          #6#1 = juan;
      |FINSI;
      |POPV;
|FCAL;

|CALCULO actuali;

  sw_con = 1;
  |HAZ conceptos;
  |SI sw_con = 0; |ACABA; |FINSI;

  nImpGrupo = 0;
  nImporte = #3#9;
  nTp100   = 100;
  |HAZ cuenta_ana;
  |SI swsel = 0; |ACABA; |FINSI;

  |SI nTp100 ! 100;
      nImporte = (nImporte % nTp100) ! EURODB;
  |FINSI;

  aar = lon1;  traba1 = #3#4 % aar;            || coge cuenta1
  aar = lon2;  traba2 = #3#4 % aar;            || coge cuenta2
  aar = lon3;  traba3 = #3#4 % aar;            || coge cuenta3
  aar = lon4;  traba4 = #3#4 % aar;            || coge cuenta4
  aar = lon5;  traba5 = #3#4 % aar;            || coge cuenta5
  aar = lon6;  traba6 = #3#4 % aar;            || coge cuenta6
  |SI lon1 = 100;  traba1 = "";  cuant1 = "";  |FINSI;
  |SI lon2 = 100;  traba2 = "";  cuant2 = "";  |FINSI;
  |SI lon3 = 100;  traba3 = "";  cuant3 = "";  |FINSI;
  |SI lon4 = 100;  traba4 = "";  cuant4 = "";  |FINSI;
  |SI lon5 = 100;  traba5 = "";  cuant5 = "";  |FINSI;
  |SI lon6 = 100;  traba6 = "";  cuant6 = "";  |FINSI;
  |SI prim = 0;
      |DDEFECTO #29;
      |DDEFECTO #22;
      |DDEFECTO #23;
      |DDEFECTO #24;
      |DDEFECTO #25;
      |DDEFECTO #26;
      |SI lon1 ! 100;  |Y #3#5 ] 1;
          cuant1 = traba1;
          #6#0 = cuant1;  #6#1 = 1;
          cuant = #6#0;   juan = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #29;
      |FINSI;
      |SI lon2 ! 100;  |Y #3#5 ] 2;
          cuant2 = traba2;
          #6#0 = cuant2;  #6#1 = 2;
          cuant = #6#0;   juan = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #22;
      |FINSI;
      |SI lon3 ! 100;  |Y #3#5 ] 3;
          cuant3 = traba3;
          #6#0 = cuant3;  #6#1 = 3;
          cuant = #6#0;   juan = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #23;
      |FINSI;
      |SI lon4 ! 100;  |Y #3#5 ] 4;
          cuant4 = traba4;
          #6#0 = cuant4;  #6#1 = 4;
          cuant = #6#0;   juan = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #24;
      |FINSI;
      |SI lon5 ! 100;  |Y #3#5 ] 5;
          cuant5 = traba5;
          #6#0 = cuant5;  #6#1 = 5;
          cuant = #6#0;   juan = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #25;
      |FINSI;
      |SI lon6 ! 100;  |Y #3#5 ] 6;
          cuant6 = traba6;
          #6#0 = cuant6;  #6#1 = 6;
          cuant = #6#0;   juan = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #26;
      |FINSI;
      prim = 1;
  |FINSI;
  |SI cuant6 ! traba6;
      #6#0 = #26#0;  #6#1 = #26#1;
      |LEE 101#6=;
      |SALVA_DATOS #26;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant6 = traba6;
      #6#0 = cuant6;  #6#1 = 6;
      cuant = #6#0;   juan = #6#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 6;  |O #6#3 = "S";
              mensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,mensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #26;
      |SINO;
          |DDEFECTO #26;
      |FINSI;
  |FINSI;
  |SI cuant5 ! traba5;
      #6#0 = #25#0;  #6#1 = #25#1;
      |LEE 101#6=;
      |SALVA_DATOS #25;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant5 = traba5;
      #6#0 = cuant5;  #6#1 = 5;
      cuant = #6#0;   juan = #6#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 5;  |O #6#3 = "S";
              mensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,mensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #25;
      |SINO;
          |DDEFECTO #25;
      |FINSI;
  |FINSI;
  |SI cuant4 ! traba4;
      #6#0 = #24#0;  #6#1 = #24#1;
      |LEE 101#6=;
      |SALVA_DATOS #24;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant4 = traba4;
      #6#0 = cuant4;  #6#1 = 4;
      cuant = #6#0;   juan = #6#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 4;  |O #6#3 = "S";
              mensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,mensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #24;
      |SINO;
          |DDEFECTO #24;
      |FINSI;
  |FINSI;
  |SI cuant3 ! traba3;
      #6#0 = #23#0;  #6#1 = #23#1;
      |LEE 101#6=;
      |SALVA_DATOS #23;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant3 = traba3;
      #6#0 = cuant3;  #6#1 = 3;
      cuant = #6#0;   juan = #6#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 3;  |O #6#3 = "S";
              mensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,mensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #23;
      |SINO;
          |DDEFECTO #23;
      |FINSI;
  |FINSI;
  |SI cuant2 ! traba2;
      #6#0 = #22#0;  #6#1 = #22#1;
      |LEE 101#6=;
      |SALVA_DATOS #22;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant2 = traba2;
      #6#0 = cuant2;  #6#1 = 2;
      cuant = #6#0;   juan = #6#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 2;  |O #6#3 = "S";
              mensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,mensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #22;
      |SINO;
          |DDEFECTO #22;
      |FINSI;
  |FINSI;
  |SI cuant1 ! traba1;
      #6#0 = #29#0;  #6#1 = #29#1;
      |LEE 101#6=;
      |SALVA_DATOS #29;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant1 = traba1;
      #6#0 = cuant1;  #6#1 = 1;
      cuant = #6#0;   juan = #6#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 1;  |O #6#3 = "S";
              mensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,mensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #29;
      |SINO;
          |DDEFECTO #29;
      |FINSI;
  |FINSI;

  impMoneda = nImporte; |HAZ ElCambioMoneda; nImporte = impMoneda;

  |HAZ suma;
  |SI #3#8 = "D";
      #6#51  = #6#51  + nImporte;
      #29#51 = #29#51 + nImporte;
      #22#51 = #22#51 + nImporte;
      #23#51 = #23#51 + nImporte;
      #24#51 = #24#51 + nImporte;
      #25#51 = #25#51 + nImporte;
      #26#51 = #26#51 + nImporte;
  |SINO;
      #6#52  = #6#52  + nImporte;
      #29#52 = #29#52 + nImporte;
      #22#52 = #22#52 + nImporte;
      #23#52 = #23#52 + nImporte;
      #24#52 = #24#52 + nImporte;
      #25#52 = #25#52 + nImporte;
      #26#52 = #26#52 + nImporte;
  |FINSI;
  #6#53  = #6#51  - #6#52;
  #29#53 = #29#51 - #29#52;
  #22#53 = #22#51 - #22#52;
  #23#53 = #23#51 - #23#52;
  #24#53 = #24#51 - #24#52;
  #25#53 = #25#51 - #25#52;
  #26#53 = #26#51 - #26#52;
|FCAL;

|DEFBUCLE cacreane1;
 #3#3;
 0,6,26;
 "            ", #0#2, #0#4, 0001, #0#0, #0#6, #0#15;
 "zzzzzzzzzzzz", #0#3, #0#5, 9999, #0#1, #0#7, #0#16;
 be;
 NULL, actuali;
|FIN;

|| ...........Esto sera por cada una de las Empresas Seleccionadas
|CALCULO creafichero;
   diant = -1;
   primera = 0;
   |SI swalta = 0; |Y #0#8 = "S";
       |PINTA 2210," PONIENDO A CERO PLAN CONTABLE ................";
       |BUCLE cacreane0;
       |PINTA 2210,"                                               ";
   |FINSI;
   |BLIN 24;

   |ABRE #6;
   |ABRE #8;
   |ABRE #99;

   prim = 0;
   lon1 = 100;  lon2 = 100;  lon3 = 100;
   lon4 = 100;  lon5 = 100;  lon6 = 100;
   |SI #30#13 ] 1; lon1 = 100 + #30#14; |FINSI;
   |SI #30#13 ] 2; lon2 = 100 + #30#15; |FINSI;
   |SI #30#13 ] 3; lon3 = 100 + #30#16; |FINSI;
   |SI #30#13 ] 4; lon4 = 100 + #30#17; |FINSI;
   |SI #30#13 ] 5; lon5 = 100 + #30#18; |FINSI;
   |SI #30#13 ] 6; lon6 = 100 + #30#19; |FINSI;
   prim = 0;
   |BUCLE cacreane1;
   |SI lon6 ! 100;
        #6#0 = #26#0;  #6#1 = #26#1;
        |LEE 101#6=;
        |SALVA_DATOS #26;
        |REPON_DATOS #6;
        |GRABA 101#6a;
    |FINSI;
    |SI lon5 ! 100;
        #6#0 = #25#0;  #6#1 = #25#1;
        |LEE 101#6=;
        |SALVA_DATOS #25;
        |REPON_DATOS #6;
        |GRABA 101#6a;
    |FINSI;
    |SI lon4 ! 100;
        #6#0 = #24#0;  #6#1 = #24#1;
        |LEE 101#6=;
        |SALVA_DATOS #24;
        |REPON_DATOS #6;
        |GRABA 101#6a;
    |FINSI;
    |SI lon3 ! 100;
        #6#0 = #23#0;  #6#1 = #23#1;
        |LEE 101#6=;
        |SALVA_DATOS #23;
        |REPON_DATOS #6;
        |GRABA 101#6a;
    |FINSI;
    |SI lon2 ! 100;
        #6#0 = #22#0;  #6#1 = #22#1;
        |LEE 101#6=;
        |SALVA_DATOS #22;
        |REPON_DATOS #6;
        |GRABA 101#6a;
    |FINSI;
    |SI lon1 ! 100;
        #6#0 = #29#0;  #6#1 = #29#1;
        |LEE 101#6=;
        |SALVA_DATOS #29;
        |REPON_DATOS #6;
        |GRABA 101#6a;
    |FINSI;
    |CIERRA #6;
    |CIERRA #8;
    |CIERRA #99;
|FCAL;

|CALCULO suma;
  |SI #3#1 > #6#58;   #6#58  = #3#1;  |FINSI;
  |SI #3#1 > #29#58;  #29#58 = #3#1;  |FINSI;
  |SI #3#1 > #22#58;  #22#58 = #3#1;  |FINSI;
  |SI #3#1 > #23#58;  #23#58 = #3#1;  |FINSI;
  |SI #3#1 > #24#58;  #24#58 = #3#1;  |FINSI;
  |SI #3#1 > #25#58;  #25#58 = #3#1;  |FINSI;
  |SI #3#1 > #26#58;  #26#58 = #3#1;  |FINSI;
  |SI #3#0 ! 0;|Y #3#0 ! 99;
      ini = #30#11;
      fecalf = #3#1;
      mes = fecalf % 402;
      mesfec = mes;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
      a = (mesac * 3) + 9;
      b = a + 1;
      c = a + 2;
      |SI #3#8 = "D";
          #6a    = #6a    + nImporte;
          #6c    = #6a    - #6b;
          #29a   = #29a   + nImporte;
          #29c   = #29a   - #29b;
          #22a   = #22a   + nImporte;
          #22c   = #22a   - #22b;
          #23a   = #23a   + nImporte;
          #23c   = #23a   - #23b;
          #24a   = #24a   + nImporte;
          #24c   = #24a   - #24b;
          #25a   = #25a   + nImporte;
          #25c   = #25a   - #25b;
          #26a   = #26a   + nImporte;
          #26c   = #26a   - #26b;
          |ACABA;
      |FINSI;
      #6b    = #6b    + nImporte;
      #6c    = #6a    - #6b;
      #29b   = #29b   + nImporte;
      #29c   = #29a   - #29b;
      #22b   = #22b   + nImporte;
      #22c   = #22a   - #22b;
      #23b   = #23b   + nImporte;
      #23c   = #23a   - #23b;
      #24b   = #24b   + nImporte;
      #24c   = #24a   - #24b;
      #25b   = #25b   + nImporte;
      #25c   = #25a   - #25b;
      #26b   = #26b   + nImporte;
      #26c   = #26a   - #26b;
      |ACABA;
  |FINSI;
  |SI #3#0 = 0;
      |SI #3#8 = "D";
          #6#9   = #6#9   + nImporte;
          #6#11  = #6#9   - #6#10;
          #29#9  = #29#9  + nImporte;
          #29#11 = #29#9  - #29#10;
          #22#9  = #22#9  + nImporte;
          #22#11 = #22#9  - #22#10;
          #23#9  = #23#9  + nImporte;
          #23#11 = #23#9  - #23#10;
          #24#9  = #24#9  + nImporte;
          #24#11 = #24#9  - #24#10;
          #25#9  = #25#9  + nImporte;
          #25#11 = #25#9  - #25#10;
          #26#9  = #26#9  + nImporte;
          #26#11 = #26#9  - #26#10;
          |ACABA;
      |FINSI;
      #6#10  = #6#10  + nImporte;
      #6#11  = #6#9   - #6#10;
      #29#10 = #29#10 + nImporte;
      #29#11 = #29#9  - #29#10;
      #22#10 = #22#10 + nImporte;
      #22#11 = #22#9  - #22#10;
      #23#10 = #23#10 + nImporte;
      #23#11 = #23#9  - #23#10;
      #24#10 = #24#10 + nImporte;
      #24#11 = #24#9  - #24#10;
      #25#10 = #25#10 + nImporte;
      #25#11 = #25#9  - #25#10;
      #26#10 = #26#10 + nImporte;
      #26#11 = #26#9  - #26#10;
      |ACABA;
  |FINSI;
  |SI #3#8 = "D";
      #6#48 = #6#48 + nImporte;
      #6#50 = #6#48 - #6#49;
      #29#48 = #29#48 + nImporte;
      #29#50 = #29#48 - #29#49;
      #22#48 = #22#48 + nImporte;
      #22#50 = #22#48 - #22#49;
      #23#48 = #23#48 + nImporte;
      #23#50 = #23#48 - #23#49;
      #24#48 = #24#48 + nImporte;
      #24#50 = #24#48 - #24#49;
      #25#48 = #25#48 + nImporte;
      #25#50 = #25#48 - #25#49;
      #26#48 = #26#48 + nImporte;
      #26#50 = #26#48 - #26#49;
      |ACABA;
  |FINSI;
  #6#49  = #6#49  + nImporte;
  #6#50  = #6#48  - #6#49;
  #29#49 = #29#49 + nImporte;
  #29#50 = #29#48 - #29#49;
  #22#49 = #22#49 + nImporte;
  #22#50 = #22#48 - #22#49;
  #23#49 = #23#49 + nImporte;
  #23#50 = #23#48 - #23#49;
  #24#49 = #24#49 + nImporte;
  #24#50 = #24#48 - #24#49;
  #25#49 = #25#49 + nImporte;
  #25#50 = #25#48 - #25#49;
  #26#49 = #26#49 + nImporte;
  #26#50 = #26#48 - #26#49;
|FCAL;

|| **********************************************************************
|CALCULO borralaA;
 |BORRA 020#118a;
 |LIBERA #118;
|FCAL;

|DEFBUCLE borrapresuA;
 #118#1;
 ;
 #4#8, "            ", "       ";
 #4#8, "zzzzzzzzzzzz", "zzzzzzz";
 be;
 NULL, borralaA;
|FIN;

|CALCULO crealaA;
 |PARA nPara1 = 4; |SI nPara1 [ 16; |HACIENDO nPara1 = nPara1 + 1;
       impMoneda = #118nPara1; |HAZ ElCambioMoneda; #118nPara1 = impMoneda;
 |SIGUE;

 |GRABAENDEF VAlfa1, VAlfa2, 0,#118#0, 1,#118#1, 20, #118#20,  2, #118#2,  3, #118#3,  4, #118#4,  5, #118#5,  6, #118#6,  7, #118#7,  8, #118#8,  9, #118#9, 10,#118#10, 19,#118#19;
 |GRABAENDEF VAlfa1, VAlfa2, 0,#118#0, 1,#118#1, 20, #118#20, 11,#118#11, 12,#118#12, 13,#118#13, 14,#118#14, 15,#118#15, 16,#118#16, 17,#118#17, 18,#118#18, 19,#118#19;
 |PINTA 2248, #118#19;
 |PINTA 2251, #118#0;

|FCAL;

|DEFBUCLE creapresuA;
 #118#1;
 ;
 #4#8,"            ", "       ";
 #4#8,"zzzzzzzzzzzz", "zzzzzzz";
 e;
 NULL, crealaA;
|FIN;

|CALCULO borrala;
 |BORRA 020#9a;
 |LIBERA #9;
|FCAL;

|DEFBUCLE borrapresu;
 #9#1;
 ;
 #4#8, "            ",0;
 #4#8, "zzzzzzzzzzzz",9;
 be;
 NULL, borrala;
|FIN;

|CALCULO creala;
 |PARA nPara1 = 4; |SI nPara1 [ 16; |HACIENDO nPara1 = nPara1 + 1;
       impMoneda = #9nPara1; |HAZ ElCambioMoneda; #9nPara1 = impMoneda;
 |SIGUE;

 |GRABAENDEF VAlfa1, VAlfa2, 0,#9#0, 1,#9#1, 2,#9#2, 3,#9#3, 4,#9#4, 5,#9#5, 6,#9#6, 7,#9#7, 8,#9#8, 9,#9#9, 10,#9#10, 19,#9#19;
 |GRABAENDEF VAlfa1, VAlfa2, 0,#9#0, 1,#9#1, 11,#9#11, 12,#9#12, 13,#9#13, 14,#9#14, 15,#9#15, 16,#9#16, 17,#9#17, 18,#9#18, 19,#9#19;
 |PINTA 2248, #9#19;
 |PINTA 2251, #9#0;

|FCAL;

|DEFBUCLE creapresu;
 #9#1;
 ;
 #4#8,"            ",0;
 #4#8,"zzzzzzzzzzzz",9;
 e;
 NULL, creala;
|FIN;

|CALCULO pasapresu;

 |PINTA  2210, " Borrando Fichas Cuentas Presupuestos ...                      ";
 |PATH_DAT #9 fich_alta;
 |BUCLE borrapresu;

 |PATH_DAT #9 fich_copi;
 |PINTA  2210, " Pasando Fichas Cuentas Presupuestos:                          ";

 |DDEF VAlfa0; |QBF VAlfa0;
 VAlfa1 = VAlfa0 + "cacuepre";
 VAlfa2 = fich_alta + "cacuepre";
 VAlfa3 = VAlfa0 + "caagrupr";
 VAlfa4 = fich_alta + "caagrupr";

 |ABRE #10;
 |DDEFECTO #10;
 #10#0 = #4#8;
 |LEE 001#10=;
 |GRABAENDEF VAlfa3, VAlfa4, 0,#10#0, 1,#10#1;
 |CIERRA #10;

 |BUCLE creapresu;


 |PINTA  2210, " Borrando Fichas Cuentas Analiticas Presupuestos ...           ";
 |PATH_DAT #118 fich_alta;
 |BUCLE borrapresuA;

 |PATH_DAT #118 fich_copi;
 |PINTA  2210, " Pasando Fichas Ctas Analiticas Presupuestos:                  ";

 |DDEF VAlfa0; |QBF VAlfa0;
 VAlfa1 = VAlfa0 + "anm00018";
 VAlfa2 = fich_alta + "anm00018";
 VAlfa3 = VAlfa0 + "anm00017";
 VAlfa4 = fich_alta + "anm00017";

 |ABRE #117;
 |DDEFECTO #117;
 #117#0 = #4#8;
 |LEE 001#117=;
 |GRABAENDEF VAlfa3, VAlfa4, 0,#117#0, 1,#117#1, 2,#117#2, 3,#117#3;
 |CIERRA #117;

 |BUCLE creapresuA;
|FCAL;

|| **********************************************************************
|CALCULO haztodo;
 swprogra = 1;
 |PINTA  2110, " Empresa:                                                      ";
 |PINTA  2210, "                                                               ";

 |PINTA 2120, #4#1;
 |PINTA 2126, #4#2;
 |PINTA 2128, #4#5;

 swalta = 0;
 |DBASE dir_fich;
 dir_fich = dir_fich + "fich/";
 aAlfa1 = #4#1; aAlfa1 = ("000000" + aAlfa1) % -105;
 aAlfa2 = #4#2; aAlfa2 =      ("0" + aAlfa2) % -101;
 fich_alta = dir_fich + aAlfa1 + aAlfa2 + "/";
 || ................ Solo en alta

 |SALVA_DATOS #30;
 |ABRE #30;
 |DDEFECTO #30;
 #30#2 = #4#1;
 #30#3 = #4#2;
 |LEE 001#30=;
 |SI FSalida ! 0;
     swalta = 1;
 |FINSI;
 |CIERRA #30;
 |REPON_DATOS #30;
 |SI swalta = 1; |HAZ altaEmp; |FINSI;

 aMonedaA = #canempre#28;

 |PINTA  2210, "                                                               ";
 |DBASE dir_fich;
 dir_fich = dir_fich + "fich/";

 aAlfa1 = #4#1; aAlfa1 = ("000000" + aAlfa1) % -105;
 aAlfa2 = #4#2; aAlfa2 =      ("0" + aAlfa2) % -101;
 aAlfa3 = dir_fich + aAlfa1 + aAlfa2 + "/";

 |PATH_DAT #5 aAlfa3;
 |PATH_DAT #6 aAlfa3;

 |HAZ creafichero;

 |SI #0#23 = "S"; |Y #4#8 ! 0; |HAZ pasapresu; |FINSI;
 |ABRE #1;
 #1#0 = #4#1;
 #1#1 = #4#2;
 |LEE 001#1=;
 |SI FSalida = 0;
     #1#5 = #0#17;
     #1#6 = "S";
     |GRABA 020#1a;
 |FINSI;
 |CIERRA #1;
|FCAL;

|DEFBUCLE creaEmpresa;
 #4#1;
 7;
 001,      "S";
 contador, "S";
 e;
 NULL, haztodo;
|FIN;

|| **************************************************************************
|| ************* Crea el Lineal para seleccion de Empresas
|CALCULO pasalo;
 contador = contador + 1;
 #4#0 = contador;
 #4#1 = #1#0;
 #4#2 = #1#1;
 #4#3 = #1#2;
 #4#4 = #1#3;
 #4#5 = #1#4;
 #4#6 = #1#5;
 #4#7 = #0#22;
 #4#8 = #1#7;
 |GRABA 040#4n;
|FCAL;

|DEFBUCLE createmp;
 #1#1;
 ;
 #0#18, #0#20;
 #0#19, #0#21;
 e;
 NULL, pasalo;
|FIN;

|| *********** CALCULO dentro del Entlineal
|CALCULO pidetecla; |TIPO 11;
 |SI FSalida ! 10; |ACABA; |FINSI;
 |LIBERA #4;
 |LEE 110#4=;
 |SI #4#7 = "S";
     #4#7 = "N";
 |SINO;
     #4#7 = "S";
 |FINSI;
 |PINTA #4#7;
 |GRABA 020#4a;
 |PTEC  809;
|FCAL;

|RUTINA inferior;
#4#0 = 1;
|FRUT;

|RUTINA superior;
#4#0 = contador;
|FRUT;

|CALCULO linealEmp;
 noCALCULO = 0;
 |PINPA #0#4;
 |ENTLINEAL #1#4, -1, 4, 21, 0, inferior, superior;
 |SI FSalida ! 0; noCALCULO = 1; |ACABA; |FINSI;

 |CONFI "2400SDesea ejecutar el CALCULO : ";
 |SI FSalida ! 0; noCALCULO = 1; |FINSI;
|FCAL;
|| ***********************************************************************

|CALCULO pase; |TIPO 3;
 contador = 0;
 aFichero = ("zm" + Usuario) % 108;
 |NOME_DAT #4 aFichero;

 |ABRE #4;  |CIERRA #4;  |DELINDEX #4;

 |ABRE #4;
 |BUCLE createmp;
 |CIERRA #4;
 |SI contador  ! 0;
     |PUSHV 0501 2380;
     |HAZ linealEmp;
     |POPV;
     |SI noCALCULO = 0;

        |DBASS aDirInicio;
        aMas  = aDirInicio + "contagen/def/cacuenta";
        |CARGA_DEF aMas, catmpcu@;
        |SI FSalida ! 0;
            |MENAV "    Error Cargado Fichero de Cuentas. Proceso Interrumpido";
            |ACABA;
        |FINSI;
        aMas  = aDirInicio + "contagen/def/anm00003";
        |CARGA_DEF aMas, anm0003@;
        |SI FSalida ! 0;
            |MENAV "    Error Cargado Fichero de Grupos Analiticos. Proceso Interrumpido";
            |DESCARGA_DEF #catmpcu@;
            |ACABA;
        |FINSI;

        |D_CUADRO 2009, 2373;
        |BUCLE creaEmpresa;
        |DESCARGA_DEF #907;
        |DESCARGA_DEF #99;
     |FINSI;
 |SINO;
    |MENAV "      No hay Empresas Analitica Definidas ";
 |FINSI;
 |DELINDEX #4;
|FCAL;

|| ***********************************************************************
|| ........... Calculos Alta Empresa
|CALCULO altaEmp;
 |SI swalta = 0; |ACABA; |FINSI;
 |SALVA_DATOS #30;
 |ABRE #30;
 |PUSHV 2301 2380;
 #30#1  = #4#4;
 #30#2  = #4#1;
 #30#3  = #4#2;
 #30#26 = #4#3;
 nEjerActual = #30#26;
 || .................. clave
 nNume1 = ((#30#2*10) + #30#3);
 aAlfa1 = nNume1;
 aAlfa1 = ( "0000000" + aAlfa1 ) % -106;
 #30#0 = aAlfa1;

 #1#0 = #4#1; #1#1 = #4#2;
 #1#2 = #4#3; #1#3 = #4#4; #1#4 = #4#5;
 |HAZ CambiaNombre;

 |GRABA 020#30n;
 enEmpresa = #30#2;
 enPeriodo = #30#3;
 swOperacion = 3;
 eaMoneda = aMonedaC;
 |SUB_EJECUTA "camoneda";

|| .................................... mkdirector;

 |DBASE dir_fich;
 dir_fich = dir_fich + "fich/";
 aAlfa1 = ("000000" + #30#0) % -106;
 aAlfa3 = dir_fich + aAlfa1;
 |MKDIR aAlfa3;
 fich_alta = aAlfa3 + "/";
 dirfich0 = fich_alta;

 |CIERRA #30;
 eaCopiar = "M";
 |HAZ copia_maes;
 |HAZ acerar4;
 |HAZ pone0_maes;
 |HAZ ActDefecto;
 |HAZ NoTesteo;
 |HAZ AnaAltaEmp;
 |POPV;

 |REPON_DATOS #30;
|FCAL;
