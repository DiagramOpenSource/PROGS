|FICHEROS;
   catbam02;
   catbam03,MANTE;
   catbam04,MANTE;

   catbam05;

   catbaw02;
   cacuenta;
   catbam01;
   :/modelos/def/dsmom030;
|FIN;

|VARIABLES;
   &entrada = 1;

   nInkey = 0;
   nTecla = 0;
   nModo  = 0;
   aAlfa1 = "";
   SwBoton4 = 0;

   &aModi1   = "";
   &aModi2   = "";
   &snFiltrA = "";
   &coant    = 1;
   &deant    = "";
   &total    = 0;
   &sumal    = 0;
   &difer    = 0;
   &SwAlgun  = 0;

   &enDiario    = 0;
   &efFecha     = @;
   &enDocumento = 0;
   &enApunte    = 0;
   &eaContra    = "";
   &SwContra    = 0;
   &enDesde     = 0;
   &enLinea     = 0;

   &enDImporte  = 0;
   &enHImporte  = 0;
   &enImporte   = 0;
   &eaSigno     = "";
   &efDFecha    = @;
   &efHFecha    = @;
|FIN;

|INCLUYE dscont_i;

|PROCESO BorraM05;
   |ABRE #catbam05;
   |SELECT #2#catbam05;
   #catbam05#4 = #catbam03#0;
   #catbam05#5 = #catbam03#2;
   #catbam05#6 = enLinea;
   |LEE 141#catbam05.=;
   |SI FSalida = 0
       |BORRA 020#catbam05.a;
   |FINSI;
   |LIBERA #catbam05;
   |SELECT #1#catbam05;
   |CIERRA #catbam05;
|FPRC;

|PROCESO GrabaM05;

   |SI enDiario = 0; |Y enDocumento = 0;
       |SI enDesde = 3;
           #catbam03#14 = " ";
           #catbam03#15 = 0;
           #catbam03#16 = "01.01.0000";
           #catbam03#17 = 0;
           #catbam03#18 = 0;
       |FINSI;
       |SI enDesde = 4;
           #catbam04#9  = " ";
           #catbam04#10 = 0;
           #catbam04#11 = "01.01.0000";
           #catbam04#12 = 0;
           #catbam04#13 = 0;
       |FINSI;
       |ACABA;
   |FINSI;

   |ABRE #catbam05;
   |SELECT #1#catbam05;
   #catbam05#0 = enDiario;
   #catbam05#1 = efFecha;
   #catbam05#2 = enDocumento;
   #catbam05#3 = enApunte;
   |LEE 141#catbam05.=;
   |SI FSalida ! 0;
       |DDEFECTO #catbam05;
       #catbam05#0 = enDiario;
       #catbam05#1 = efFecha;
       #catbam05#2 = enDocumento;
       #catbam05#3 = enApunte;
       |GRABA 020#catbam05.b;
   |FINSI;
   #catbam05#4 = #catbam03#0;
   #catbam05#5 = #catbam03#2;
   #catbam05#6 = enLinea;
   |GRABA 020#catbam05.a;
   |LIBERA #catbam05;
   |CIERRA #catbam05;

   |SI enDesde = 3;
       #catbam03#14 = "X";
       #catbam03#15 = enDiario;
       #catbam03#16 = efFecha;
       #catbam03#17 = enDocumento;
       #catbam03#18 = enApunte;
   |FINSI;
   |SI enDesde = 4;
       #catbam04#9  = "X";
       #catbam04#10 = enDiario;
       #catbam04#11 = efFecha;
       #catbam04#12 = enDocumento;
       #catbam04#13 = enApunte;
   |FINSI;
|FPRC;

|PROCESO BuscoContra;
   SwContra = 0;
   |SI enDesde = 3;
       enDiario    = #catbam03#15;
       efFecha     = #catbam03#16;
       enDocumento = #catbam03#17;
       enApunte    = #catbam03#18;
       enLinea     = 0;
       enDImporte  = #catbam03#7;
       enHImporte  = #catbam03#7;
       eaContra    = #catbam03#8;
   |SINO;
       enDiario    = #catbam04#10;
       efFecha     = #catbam04#11;
       enDocumento = #catbam04#12;
       enApunte    = #catbam04#13;
       enLinea     = #catbam04#3;
       eaContra    = #catbam04#4;
       enDImporte  = #catbam04#8;
       enHImporte  = #catbam04#8;

||       |SI #catbam04#8 ! #catbam03#7;
||           enDImporte  = 0;
||           enHImporte  = difer;
||       |FINSI;
   |FINSI;
   |HAZ BorraM05;
   enImporte = #catbam03#7;
   eaSigno   = #catbam03#6;
   efDFecha = fec1;
   efHFecha = #catbam03#3;

   |HAZ BuscaPunteo;
   |HAZ GrabaM05;
|FPRC;

|RUTINA pintaimportes;
   |PINTA 1166, #catbam03#7;
   |PINTA 1124,"             ";
   |PINTA 1149,"             ";
   |ATRI I;
   |PINTA 1124, sumal;
   |PINTA 1149, difer;
   |ATRI 0;
|FRUT;

|PROCESO elimporte; |TIPO 0;
   |SI FSalida = 11;
       #catbam04#8 = total - sumal;
       |PINTA #catbam04#8;
   |FINSI;

   |SI #catbam04#8 = 0;
       |MENAV  "     Debe Introducir un Importe";
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO eldigito;  |TIPO 6;
   nTecla = FSalida;

   eaCuenta = #catbam04#4;
   salidas  = FSalida;
   |HAZ FiltraPuntos;
   #catbam04#4 = eaCuenta;
   |PINTA #catbam04#4;

   eaCuenta = #catbam04#4;
   |QBF eaCuenta;
   |SI eaCuenta = ""; |ACABA; |FINSI;

   emCta = 1;
   |HAZ SacaNivel;
   emCta = 0;
   |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea
   #catbam04#5 = enNivel;
|FPRC;

|PROCESO sacacuenta; |TIPO 0;

     |SI nTecla = 11;
         enDesde  = 4;
         SwContra = 0;
         |HAZ BuscoContra;
         #catbam04#4 = eaContra;
         |PINTA #catbam04#4;
     |FINSI;

     eaCuenta = #catbam04#4;
     |QBF eaCuenta;
     |SI eaCuenta = "";  |ACABA; |FINSI;

     |HAZ entrando;
     |SI #cacuenta#3 ! "S";
         |MENAV "     LA CUENTA NO ES DE PASE DIRECTO";
         |ERROR;
     |FINSI;
|FPRC;

|CALCULO Desdecon; |TIPO 0;  || desde Campos conceptos
   |C_M #catbam04#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   enFilConc = 1;
   eaCuenta   = #catbam04#4;
   enConcepto = #catbam04#6;
   |HAZ FiltroConcepto;  |SI eswLect ! 0; |ACABA; |FINSI;

  |SI #catbam04#6 ! coant;
      #catbam04#7  = #dsmom030#1;
      |PINTA #catbam04#7;
  |FINSI;
|FCAL;

|PROCESO Elptec; |TIPO 7;
   |C_M #catbam04#Campo#, 0, aAlfa1;

   |SI aAlfa1 = "S"; |Y eaSobreEs ! "S";
       |PTEC 816;
   |FINSI;
|FPRC;

|PROCESO duplica; |TIPO 0;
   |SI FSalida = 10;
       #catbam04#7 = deant;
       |PINTA #catbam04#7;
   |FINSI;
|FPRC;

|PROCESO tipo0c3;
  |BLIN 4;
  nModo = (FEntrada / 100) ! 0;
  |SI nModo = 1;
      #catbam04#6 = coant; |PINTA #catbam04#6;
      #catbam04#7 = deant; |PINTA #catbam04#7;
  |FINSI;
  |C_M #catbam04#6, 1, aModi1;
  |C_M #catbam04#7, 1, aModi2;
|FPRC;

|CALCULO laslineas;  |TIPO 2;
   sumal = sumal +. #catbam04#8;
   difer = total - sumal;
   |HAZ pintaimportes;
   SwAlgun = SwAlgun +. 1;
|FCAL;

|CALCULO entrando; |TIPO 7;
   |ABRE #cacuenta;
   |DDEFECTO #cacuenta;
   #cacuenta#0 = #catbam04#4;
   |LEE 001#cacuenta.=;
   |CIERRA #cacuenta;

   |ATRI I;
   |PINTA 2203, #cacuenta#2;
   |PINTA 2240, #cacuenta#51;
   |PINTA 2254, #cacuenta#52;
   |PINTA 2268, #cacuenta#53;
   |ATRI 0;

   |HAZ pintaimportes;

   SwBoton4 = 0;
   |SI #catbam04#9 = "X";
        SwBoton4 = 1;
        aAlfa1 = "0000<F4> Asto Punteado";
        |MENSA aAlfa1;
   |FINSI;
|FCAL;

|PROCESO tipo3;  |TIPO 3;
   |SI #catbam04#8 = 0;
      |MENAV "     ATENCION!  El importe NO puede ser CERO";
      |ERROR;
   |SINO;
       coant = #catbam04#6;
       deant = #catbam04#7;
   |FINSI;
|FPRC;

|PROCESO VerEnDiario_4;
    enDiario    = #catbam04#10;
    efFecha     = #catbam04#11;
    enDocumento = #catbam04#12;
    enApunte    = #catbam04#13;
    |HAZ ConsultaAsto;
|FPRC;

|PROCESO tipo11;  |TIPO 11;
   |BLIN 4;
   nInkey = FSalida;
   |SI nInkey = 12; |Y SwBoton4 = 1;
       |HAZ VerEnDiario_4;
       |ERROR;
   |FINSI;
|FPRC;
