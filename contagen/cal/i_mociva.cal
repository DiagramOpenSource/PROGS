|VARIABLES;
     nSwAcum     = 0;
     nDesde      = 0;
     nHasta      = 0;
     nContador   = 0;
     nResult     = 0;
     nSwGraba    = 0;
     nAnyo       = 0;
     nPer        = 0;
     nTipo       = 0;
     nPeriodo    = 0;
     nDepar      = 0;
     nEjer       = 0;
     nModAnter   = 0;
     nIVA        = 0;
     nIVA7           = 0;
     nIVA10          = 0;
     nIVA13          = 0;
     nIVA16          = 0;
     nIVA19          = 0;
     nIVA22          = 0;
     nIVA25          = 0;
     nIVA28          = 0;
     nIVA31          = 0;
     nSubeIVA        = 0;

     aAlfa       = "";

     &aFitxer300 = "";
     &aFitxer301 = "";
     &aFitxer87  = "";
     &enPregunta = 0;

     nCuotaMas   = 0;
     nBaseMas    = 0;
     &enProAct   = 0;
     &enProCom   = 0;
|FIN;

|PROCESO GrabaDevengado303;
     |SI #300nCampo3 = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     nIVA     = #300nCampo2;

     |SI nSubeIVA = 1;
         |SI nIVA = 16;  nIVA = 18;  |FINSI;
         |SI nIVA = 7;   nIVA = 8;   |FINSI;
     |FINSI;

     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #303nCampo22 = nIVA;
               #303nCampo11 = #303nCampo11 + #300nCampo1;
               #303nCampo33 = #303nCampo33 + #300nCampo3;
               nSwAcum = 1;

               |SI nIVA ! #300nCampo2;
                   |SI nCampo22 = 7;   nIVA7  = 1;  |FINSI;
                   |SI nCampo22 = 10;  nIVA10 = 1;  |FINSI;
                   |SI nCampo22 = 13;  nIVA13 = 1;  |FINSI;
                   |SI nCampo22 = 16;  nIVA16 = 1;  |FINSI;
                   |SI nCampo22 = 19;  nIVA19 = 1;  |FINSI;
                   |SI nCampo22 = 22;  nIVA22 = 1;  |FINSI;
                   |SI nCampo22 = 25;  nIVA25 = 1;  |FINSI;
                   |SI nCampo22 = 28;  nIVA28 = 1;  |FINSI;
                   |SI nCampo22 = 31;  nIVA31 = 1;  |FINSI;
               |FINSI;

               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #303nCampo22 = 0;
                   #303nCampo11 = #300nCampo1;
                   #303nCampo22 = nIVA;
                   #303nCampo33 = #300nCampo3;

                   |SI nIVA ! #300nCampo2;
                       |SI nCampo22 = 7;   nIVA7  = 1;  |FINSI;
                       |SI nCampo22 = 10;  nIVA10 = 1;  |FINSI;
                       |SI nCampo22 = 13;  nIVA13 = 1;  |FINSI;
                       |SI nCampo22 = 16;  nIVA16 = 1;  |FINSI;
                       |SI nCampo22 = 19;  nIVA19 = 1;  |FINSI;
                       |SI nCampo22 = 22;  nIVA22 = 1;  |FINSI;
                       |SI nCampo22 = 25;  nIVA25 = 1;  |FINSI;
                       |SI nCampo22 = 28;  nIVA28 = 1;  |FINSI;
                       |SI nCampo22 = 31;  nIVA31 = 1;  |FINSI;
                   |FINSI;

                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #303nCampo11 = #303nCampo11 + #300nCampo1;
         #303nCampo22 = -1;
         #303nCampo33 = #303nCampo33 + #300nCampo3;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible303;
     |SI nDesde = 34; |Y nHasta = -2;   ||inversion
         nHasta = nDesde + 1;
         #303nDesde = #303nDesde - (#300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32);
         #303nHasta = #303nHasta - (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
         |ACABA;
     |FINSI;

     |SI nHasta ! -1;
         nHasta = nDesde + 1;
     |FINSI;

     |SI nDesde ! 42;  |Y nDesde ! 44;
         |SI nHasta ! -1;
             #303nDesde = #303nDesde + (#300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32);
             #303nHasta = #303nHasta + (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
         |SINO;
             #303nDesde = #303nDesde + (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
         |FINSI;
     |SINO;
         #303nDesde = #303nDesde + (#300#14 + #300#17 + #300#20 + #300#23 + #300#26 + #300#29 + #300#32);
         #303nHasta = #303nHasta + (#300#16 + #300#19 + #300#22 + #300#25 + #300#28 + #300#31 + #300#34);
     |FINSI;
|FPRC;

|PROCESO GrabaModelo;
     |SI #300#6 = 5;  |Y #300#7 = 6;  |Y #300#12 ! 0;
         nEjerAnt = #300#12;
     |FINSI;

     |SI #300#6  = 2; |Y #300#7 = 12; |ACABA; |FINSI;
     |SI #300#12 = 0; |Y #300#13 = 0; |ACABA; |FINSI;

     nDesde = 0;
     nHasta = 0;

     |SI #300#6 = 1;  |Y #300#7 [ 4;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 6;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 7;   nDesde =  8;  nHasta = 14;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 8;   nDesde =  8;  nHasta = 14;  |FINSI;

     |SI #300#6 = 1;  |Y #300#7 = 5;   nDesde = 26;  nHasta = 32;  |FINSI;

     |SI #300#6 = 1;  |Y #300#7 = 10;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 11;  nDesde = 17;  nHasta = 23;  |FINSI;
     |SI #300#6 = 1;  |Y #300#7 = 12;  nDesde = 17;  nHasta = 23;  |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 32;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #300nCampo1 ! 0;  |O #300nCampo2 ! 0;  |O #300nCampo3 ! 0;
                   |HAZ GrabaDevengado303;
               |FINSI;
         |SIGUE;

         |SI #300#6 = 1;  |Y #300#7 = 6;
             |PARA nCampo1 = 35;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   |SI #300nCampo1 ! 0;  |O #300nCampo2 ! 0;  |O #300nCampo3 ! 0;
                       |HAZ GrabaDevengado303;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 7;  |SI nCampo1 [ 31;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #303nCampo1 = -1;  #303nCampo1 = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #300#6 = 2;  |Y #300#7 = 1;   nDesde = 34;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 2;   nDesde = 36;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 3;   nDesde = 38;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 4;   nDesde = 40;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 5;   nDesde = 42;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 6;   nDesde = 44;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 7;   nDesde = 46;  nHasta = -1;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 9;   nDesde = 47;  nHasta = -1;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 11;  nDesde = 34;  nHasta = -2;  |FINSI;
     |SI #300#6 = 2;  |Y #300#7 = 10;  nDesde = 48;  nHasta = -1;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible303;
     |FINSI;

     |SI #300#6 = 3;  |Y #300#7 = 9;
         #303#54 = #303#54 + #300#12;
     |FINSI;

     |SI #300#6 = 5;  |Y #300#7 = 1;
         #303#51   = #303#51 + #300#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #300#6 = 5;  |Y #300#7 = 2;
         #303#57 = #303#57 + #300#12;
     |FINSI;

     |SI #300#6 = 3;  |Y #300#7 = 10;
         #303#55 = #303#55 + #300#12;
     |FINSI;

     |SI #300#1 [ 2009;
         |SI #300#6 = 3;  |Y #300#7 = 11;
             #303#56 = #303#56 + #300#12;
         |FINSI;
     |SINO;
         |SI #300#6 = 3;  |Y #300#7 = 4;
             #303#56 = #303#56 + #300#12;
         |FINSI;
     |FINSI;

     nSwGraba = 1;
|FPRC;

|DEFBUCLE dsmociva;
     #300#1;
     ;
     enEmpresa, enEjer, nPeriodo, nModelo, nComplem, 01, 0,  0;
     enEmpresa, enEjer, nPeriodo, nModelo, nComplem, 99, 9, 99;
     e;
     NULL, GrabaModelo;
|FIN;

|PROCESO Registro0;
    |DDEFECTO #303;
    #303#0 = enEmpresa;
    #303#1 = enEjercicio;
    #303#2 = nPeriodo;
    #303#3 = nModelo;
    #303#4 = nComplem;
    #303#5 = 0;

    |HAZ RecogeAnter;
    #303#53 = nEjerAnt;
    #303#51 = 0;
    nEjerAnt  = #303#53;
    nContador = 0;
    nSwGraba  = 0;
    nIVA7     = 0;
    nIVA10    = 0;
    nIVA13    = 0;
    nIVA16    = 0;
    nIVA19    = 0;
    nIVA22    = 0;
    nIVA25    = 0;
    nIVA28    = 0;
    nIVA31    = 0;
    nSubeIVA  = 0;

    |SI #303#1 = 2010; |Y #303#2 ] 7;
         nSubeIVA = 1;
    |FINSI;

    |SI #303#1 ] 2011;
        nSubeIVA = 1;
    |FINSI;

    |BUCLE dsmociva;

    |SI nSwGraba = 1;
       |SI nIVA7  = 1;  #303#7  = (#303#8  / #303#6)  * 100;   |FINSI;
       |SI nIVA10 = 1;  #303#10 = (#303#11 / #303#9)  * 100;   |FINSI;
       |SI nIVA13 = 1;  #303#13 = (#303#14 / #303#12) * 100;   |FINSI;
       |SI nIVA16 = 1;  #303#16 = (#303#17 / #303#15) * 100;   |FINSI;
       |SI nIVA19 = 1;  #303#19 = (#303#20 / #303#18) * 100;   |FINSI;
       |SI nIVA22 = 1;  #303#22 = (#303#23 / #303#21) * 100;   |FINSI;
       |SI nIVA25 = 1;  #303#25 = (#303#26 / #303#24) * 100;   |FINSI;
       |SI nIVA28 = 1;  #303#28 = (#303#29 / #303#27) * 100;   |FINSI;
       |SI nIVA31 = 1;  #303#31 = (#303#32 / #303#20) * 100;   |FINSI;

       #303#53 = nEjerAnt;
       #303#33 = #303#8  + #303#11 + #303#14 + #303#17 + #303#20 + #303#23
       #303#33 = #303#33 + #303#26 + #303#29 + #303#32;

       #303#49 = #303#35 + #303#37 + #303#39 + #303#41 + #303#43 + #303#45;
       #303#49 = #303#49 + #303#46 + #303#47 + #303#48;

       #303#50 = #303#33 - #303#49;
       #303#51 = #303#51 / nContador;
       #303#52 = #303#50 % #303#51;

       #303#58 = #303#52 - #303#53 + #303#57;
       #303#60 = #303#58 - #303#59;

       |SI #303#60 > 0;
           #303#63 = #303#60;
           #303#61 = 0;
           #303#62 = 0;
       |SINO;
           #303#61 = -#303#60;
           #303#62 = 0;
           #303#63 = 0;
       |FINSI;


       |PRINT;
    |FINSI;
|FPRC;
