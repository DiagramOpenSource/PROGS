|FICHEROS;
  caz00010 #0;
  cam00001 #1;
  cam00002 #2,MANTE;
  cam00003 #3;
  cam00004 #4;
  cam00005 #5;
  caz00027 #27;

  :/modelos/def/dsmom030 #330;
  cacuenta #10;
  canempre #30;
|FIN;

|VARIABLES;
 &entrada =1;
 &enPor   = 0;
 nEstado  = 0;
 &nMaxDes = 0;
 &eaDirDestino = "";
 &eaDirOrigen  = "";
 nPara1 = 0;
|FIN;

|INCLUYE dscont_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|| ******************************************** Calculos Pantalla
|CALCULO cuenta_27; |TIPO 6;
     eaCuenta = #27Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #27Campo = eaCuenta;
     |PINTA #27Campo;
|FCAL;

|CALCULO cuefin_27; |TIPO 0;
   |SI #27Campo = doce;
       |ERROR;
       |ACABA;
   |FINSI;

   emCta    = 1;
   eaCuenta = #27Campo;
   |HAZ SacaNivel;
   |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea

   |HAZ LeeCuenta;
   |SI eswCta ! 0;  |ACABA; |FINSI;  ||Cuenta erronea

   #27#12 = #cacuenta#2; |PINTA #27#12;
|FCAL;

|CALCULO concepto; |TIPO 0;
   enFilConc = 0;
   eaCuenta   = "";
   enConcepto = #27#14;
   |HAZ FiltroConcepto;  |SI eswLect ! 0; |ACABA; |FINSI;

   #27#15 = #dsmom030#1; |PINTA #27#15;
|FCAL;

|CALCULO c_descrip; |TIPO 7;
     |PTEC 816;
|FCAL;


|PROCESO elTexto;
 #27#9 = "";
 |SI #27#5 = 1; #27#9 = "Acumulados Plan Contable "; |FINSI;
 |SI #27#5 = 2; #27#9 = "Asientos Contables       "; |FINSI;
 |SI #27#5 = 3; #27#9 = "Registros de IVA/IRPF    "; |FINSI;
 |SI #27#5 = 4; #27#9 = "Todos los Datos          "; |FINSI;
|FPRC;

|CALCULO verDif; |TIPO 0;
 |SI #27Campo > nMaxDes;
     |MENAV "    Error. Posicion no valida ";
     |ERROR;
 |FINSI;
|FCAL;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|RUTINA ClaveBajaC;
 #2#0 = enEmpresa;
 #2#1 = 1;
|FRUT;

|RUTINA ClaveAltaC;
 #2#0 = enEmpresa;
 #2#1 = 99999;
|FRUT;

|CALCULO wTipo3; |TIPO 12;
 || **************************************************  Tipo3;

 |PARA nPara1 = 0; |SI nPara1 [ 10; |HACIENDO nPara1 = nPara1 + 1;
       #0nPara1 = #27nPara1;
 |SIGUE;

 |ENTLINEAL #1#2, -2, 2, 22, 0, ClaveBajaC, ClaveAltaC;

 |SI FSalida = 0;
     |HAZ LaConsolidacion;
 |FINSI;
|FCAL;


|PROGRAMA;
 |HAZ inicio;
 |ABRE #1;
 #1#0 = enEmpresa;
 |LEE 101#1=;
 |SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = enEmpresa;
     #1#1 = eaNombreEmp;
     |GRABA 020#1n;
 |FINSI;
 |LIBERA #1;
 |CIERRA #1;

 |SI #1#2 ! 1;
     |CONFI "    NAtencion !!!. El tipo de Fusion es distinto a <1>, Continuar ?";
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;
 |FINSI;

 |DFICE eaDirDestino;

 #27#0  = #1#0;
 #27#1  = enPeriodo;
 #27#2  = #1#1;
 #27#3  = enEjercicio;
 #27#10 = #30#26;
 #27#4  = eaMoneda;
 #27#5  = 1;
 #27#6  = #1#3;
 #27#7  = 00;
 #27#8  = "N";
 #27#11 = #1#6;
 #27#13 = #1#7;
 #27#14 = #1#8;
 #27#15 = #1#9;
 |HAZ elTexto;
 nMaxDes = MaximoDigitos;
 emCta    = 0;
 eaCuenta = #27#11;
 |HAZ LeeCuenta;
 #27#12 = eaNomCta;

 enPor = 1;
 |CLS;
 |CABEZA "Consolidar Empresas por porcentajes";
 |PINPA #0#27;
 |PINDA #0#27;

 |C_P #2#1,1,1303; |C_P #2#19,1,1440;
 |C_P #2#2,1,1218; |C_P #2#3,1,1540;
 |C_P #2#4,1,1454; |C_P #2#5,1,1464;
 |C_P #2#6,1,1475; |C_P #2#7,1,1569;

 |C_M #2#8,1,"N";  |C_V #2#8,1,"N";
 |C_M #2#9,1,"N";  |C_V #2#9,1,"N";
 |C_M #2#10,1,"N"; |C_V #2#10,1,"N";
 |C_M #2#11,1,"N"; |C_V #2#11,1,"N";
 |C_M #2#20,1,"N"; |C_V #2#20,1,"N";

 |C_P #2#12,1,1732; |C_P #2#13,1,2030;
 |C_P #2#14,1,2037; |C_P #2#15,1,2240;

 |C_M #2#17,1,"N"; |C_V #2#17,1,"N";

 |C_V #2#18,1,"S"; |C_M #2#18, 1, "S";


 |C_P #3#2, 1, 1846; |C_P #3#3,1, 1852;
 |C_P #3#4, 1, 1875; |C_P #3#5,1, 1858;
 |C_P #3#6, 1, 1863; |C_P #3#7,1, 1867;


 |ENTLINEAL #1#2, -2, 7, 22, 0, ClaveBajaC, ClaveAltaC;

 |HAZ Avisa; |SI nEstado ! 0; |ACABA; |FINSI;

 |ENDATOS #1#27;
|FPRO;

|| ********************************************************************
|PROCESO Borral30;
 |BORRA 020#3a;
 |LIBERA #3;
|FPRC;

|DEFBUCLE Borral3;
 #3#1;
 ;
 #27#0, 00001, 00;
 #27#0, 99999, 99;
 be;
 NULL, Borral30;
|FIN;

|PROCESO Borral40;
 |BORRA 020#4a;
 |LIBERA #4;
|FPRC;

|DEFBUCLE Borral4;
 #4#1;
 ;
 #27#0, 00001, 00;
 #27#0, 99999, 99;
 be;
 NULL, Borral40;
|FIN;


|PROCESO LaConsolidacion;

     |ABRE #1;
     #1#0 = #27#0;
     |LEE 101#1=;
     nEstado = FSalida;
     #1#0 = #27#0;  #1#1 = #27#2;
     #1#2 = #27#5;  #1#3 = #27#6;
     #1#4 = #27#7;  #1#5 = #27#8;
     #1#6 = #27#11; #1#7 = #27#13;
     #1#8 = #27#14; #1#9 = #27#15;
     |SI nEstado = 0; |GRABA 020#1a; |FINSI;
     |SI nEstado ! 0; |GRABA 020#1n; |FINSI;
     |LIBERA #1;
     |CIERRA #1;

     |SI #27#5 = 3;
         |BUCLE Borral3;
     |FINSI;
     |SI #27#5 < 3;
         |BUCLE Borral4;
     |FINSI;

     |CONFI "    SDesea Consolidar Empresas Ahora S/N ";
     |SI FSalida = 0;
         |SUB_EJECUTA_NP "caz00011";
     |FINSI;
|FPRC;

|PROCESO Avisa;
   |PUSHV 05201160;
   |CUADRO 05201160;
   |ATRI I;
   |PINTA 0621, "             ญญ ATENCION !!            ";
   |PINTA 0721, " Esta opcion destruira todos los datos ";
   |PINTA 0821, " de esta empresa para prepararla con el";
   |PINTA 0921, " fin de englobar todos los datos de las";
   |PINTA 1021, " empresas indicadas.                   ";
   |CONFI "    Nจ Desea continuar ?";
   nEstado = FSalida;
   |POPV;
|FPRC;
