|FICHEROS;

 camansde #0;
 camandep #20;

 caentasl #1;
 cajainli #2;
 cajasald #3;
 camaasil #4;
 camaniva #5;
 camautol #6;
 casieali #7;
 cavengca #8;
 cientasl #9;

 canempre #30;
 :/basica/def/agicen14 #114;
|FIN;

|VARIABLES;

 aDirFich = "";

 aAlfa1 = "";
 aAlfa2 = "";
 nNume1 = 0;
 nNume2 = 0;
 nPara1 = 0;
 nPara2 = 0;

 SwCambia = 0;
 aElDepar = "";
 aElSubde = "";
|FIN;

|INCLUYE dscont_i;

|| **********************************************************************
|PROCESO LeeSub;
 #0#0 = enEmpresa;
 #0#1 = aElDepar;
 #0#2 = aElSubde;
 |LEE 001#0=;
 |SI FSalida ! 0;
     |DDEFECTO #0;
     #0#0 = enEmpresa;
     #0#1 = aElDepar;
     #0#2 = aElSubde;
     |GRABA 020#0n;
 |FINSI;
 eaNomSubdep = #0#3;
 eaNo1Subdep = #0#4;
|FPRC;
|| **********************************************************************

|PROCESO caentasl0;
 #1#23 = #1#17;
 #1#17 = aElDepar;

 aElSubde = #1#23;
 |HAZ LeeSub;

 |GRABA 020#1a;
 |LIBERA #1;
|FPRC;

|DEFBUCLE caentasl;
 #1#1;
 ;
 "        ", 00001;
 "zzzzzzzz", 99999;
 be;
 NULL, caentasl0;
|FIN;

|PROCESO cajainli0;
 #2#18 = #2#12;
 #2#12 = aElDepar;

 aElSubde = #2#18;
 |HAZ LeeSub;

 |GRABA 020#2a;
 |LIBERA #2;
|FPRC;

|DEFBUCLE cajainli;
 #2#1;
 ;
 "01.01.0000", 0001;
 "31.12.2999", 9999;
 be;
 NULL, cajainli0;
|FIN;

|PROCESO cajasald;
 |ABRE #3;
 |LEE 101#3p;
 |SI FSalida = 0;
     #3#8 = #3#6;
     #3#6 = aElDepar;

     aElSubde = #3#6;
     |HAZ LeeSub;

     |GRABA 020#3a;
 |FINSI;
 |LIBERA #3;
 |CIERRA #3;
|FPRC;

|PROCESO camaasil0;
 #4#28 = #4#21;
 #4#21 = aElDepar;

 aElSubde = #4#28;
 |HAZ LeeSub;

 |GRABA 020#4a;
 |LIBERA #4;
|FPRC;

|DEFBUCLE camaasil;
 #4#1;
 ;
 00, "01.01.0000", 000001, 0001;
 99, "31.12.2999", 999999, 9999;
 be;
 NULL, camaasil0;
|FIN;

|PROCESO camaniva0;
 #5#11 = #5#10;
 #5#10 = aElDepar;
 #5#24 = eaNombreAct;

 aElSubde = #5#11;
 |HAZ LeeSub;
 #5#25 = eaNomSubdep;

 |GRABA 020#5a;
 |LIBERA #5;
|FPRC;

|DEFBUCLE camaniva;
 #5#1;
 ;
 00, 0000000001;
 99, 9999999999;
 be;
 NULL, camaniva0;
|FIN;

|PROCESO camautol0;
 #6#9  = #6#6;
 #6#6  = aElDepar;

 aElSubde = #6#9;
 |HAZ LeeSub;

 |GRABA 020#6a;
 |LIBERA #6;
|FPRC;

|DEFBUCLE camautol;
 #6#1;
 ;
 00001, 0001;
 99999, 9999;
 be;
 NULL, camautol0;
|FIN;

|PROCESO casieali0;
 #7#62  = #7#61;
 #7#61  = aElDepar;

 aElSubde = #7#62;
 |HAZ LeeSub;

 |GRABA 020#7a;
 |LIBERA #7;
|FPRC;

|DEFBUCLE casieali;
 #7#1;
 ;
 0001, 01;
 9999, 99;
 be;
 NULL, casieali0;
|FIN;

|PROCESO cavengca0;
 #8#20  = #8#10;
 #8#10  = aElDepar;
 #8#21  = eaNombreAct;

 aElSubde = #8#20;
 |HAZ LeeSub;
 #8#22  = eaNomSubdep;

 |GRABA 020#8a;
 |LIBERA #8;
|FPRC;

|DEFBUCLE cavengca;
 #8#1;
 ;
 "01.01.0000";
 "31.12.2999";
 be;
 NULL, cavengca0;
|FIN;

|PROCESO cientasl0;
 #9#13  = #9#12;
 #9#12  = aElDepar;

 aElSubde = #9#13;
 |HAZ LeeSub;

 |GRABA 020#9a;
 |LIBERA #9;
|FPRC;

|DEFBUCLE cientasl;
 #9#1;
 ;
 "            ", 00001;
 "zzzzzzzzzzzz", 99999;
 be;
 NULL, cientasl0;
|FIN;

|| **************************************************************************
|PROGRAMA;

   |DBASE aDirFich; |QBF aDirFich;
   aAlfa1 = ("00000" + enEmpresa) % -105;
   aAlfa2 = ("0" + enPeriodo)     % -101;

   aDirFich = aDirFich + "fich/"+ aAlfa1 + aAlfa2 + "/";

   |PATH_DAT #1  aDirFich;
   |PATH_DAT #2  aDirFich;
   |PATH_DAT #3  aDirFich;
   |PATH_DAT #4  aDirFich;
   |PATH_DAT #5  aDirFich;
   |PATH_DAT #6  aDirFich;
   |PATH_DAT #7  aDirFich;
   |PATH_DAT #8  aDirFich;
   |PATH_DAT #9  aDirFich;

   |ABRE #canempre;
   #canempre#2 = enEmpresa;
   #canempre#3 = enPeriodo;
   |LEE 101#canempre.=;
   |SI FSalida ! 0;
       |CIERRA #canempre;
       |ACABA;                  || Si no existe no puedo seguir
   |FINSI;

   #canempre#22 = "O";
   |GRABA 020#canempre.a;
   |LIBERA #canempre;
   |CIERRA #canempre;

   aElDepar    = "01";
   eaNombreAct = "";
   |HAZ DirAplicSt;
   |SI Haybasica = 1;
       |ABRE #agicen14;
       || Lee Actividad
       |ABRE #agicen14;
       #agicen14#0 = enEmpresa;
       #agicen14#1 = 00;
       |LEE 041#agicen14.];
       |SI FSalida = 0; |Y #agicen14#0 = enEmpresa;
           aAlfa1 = #agicen14#1; |QBF aAlfa1;
           aAlfa1 = ("00" + aAlfa1) % -102;
           aElDepar = aAlfa1;
           eaNombreAct  = #agicen14#4;
       |FINSI;
       |CIERRA #agicen14;
   |SINO;
       |ABRE #20;
       #20#0 = enEmpresa;
       #20#1 = aElDepar;
       |LEE 001#20=;
       |SI FSalida ! 0;
           #20#0 = enEmpresa;
           #20#1 = aElDepar;
           #20#2 = "";
           |GRABA 020#20n;
       |FINSI;
       eaNombreAct = #20#2;
       |CIERRA #20;
   |FINSI;

   || ... Procesos para los ficheros que tiene el campo de Departamento
   ||     .............................................. y subdepartamento.

   |ABRE #0;

   |BUCLE caentasl;  ||Entrada rapida apuntes

   |BUCLE cajainli;

   |HAZ cajasald;

   |BUCLE camaasil;  || Lineas de Apuntes

   |BUCLE camaniva;

   |BUCLE camautol;

   |BUCLE casieali;

   |BUCLE cavengca;

   |BUCLE cientasl;

   |CIERRA #0;
|FPRO;
