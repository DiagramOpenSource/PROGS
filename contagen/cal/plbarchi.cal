|FICHEROS;
    :dsarchi/dsarm005;
    :dsarchi/dpntm102;
    :dsarchi/dpntm103;
    :dsarchi/dsarm034;

    camaniva;

    tempo@;
|FIN;

|VARIABLES;
     nReg          = 0;
     nCampo        = 0;
     nCampo1       = 0;
     nHandle       = 0;
     nEmpresa      = 0;
     nPeriodo      = 0;
     nLibro        = 0;
     nDocu         = 0;

     aAlfa         = "";
     aPathDESPANET = "";
     aPathDSARCHI  = "";

     &enDiaGAD     = 0;
     &efFecGAD     = @;
     &enDocGAD     = 0;
     &enLibGAD     = 0;
     &enRegGAD     = 0;
     &eaExiGAD     = "";
|FIN;

|PROCESO Tipo15Fm5;
|FPRC;

|PROCESO Tipo16Fm5;
|FPRC;

|PROCESO Tipo17Fm5;
|FPRC;

|PROCESO dsarm005;
     #dsarm005#67 = 0;
     #dsarm005#68 = 0;
     #dsarm005#69 = 0;
     #dsarm005#70 = "01.01.0000";
     #dsarm005#71 = 0;
     #dsarm005#72 = 0;
     #dsarm005#73 = 0;
     #dsarm005#74 = "";

     |GRABA 020#dsarm005.a;
     |LIBERA #dsarm005;

     #dsarm034#16 = #dsarm005#0;
     |LEE 101#dsarm034.=;
     |SI FSalida = 0;
         #dsarm034#22 = "N";
         #dsarm034#9  = "S";
         #dsarm034#10 = "N";
         #dsarm034#11 = "01.01.0000";
         #dsarm034#12 = "";
         #dsarm034#13 = "";
         #dsarm034#14 = 0;
         #dsarm034#15 = "18,28,245;255,255,255";
         |GRABA 020#dsarm034.a;
         |LIBERA #dsarm034;
     |FINSI;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005#11;
     ;
     nEmpresa, nPeriodo, nLibro, nDocu;
     nEmpresa, nPeriodo, nLibro, nDocu;
     be;
     NULL, dsarm005;
|FIN;

|PROCESO dpntm102;
     nLibro = #camaniva#0;
     nDocu  = #camaniva#1;

     |ABRE #dsarm034;
     |SELECT #2#dsarm034;
     |BUCLE dsarm005;
     |CIERRA #dsarm034;

     |BORRA 020#dpntm102.a;
     |LIBERA #dpntm102;
|FPRC;

|DEFBUCLE dpntm102;
     #dpntm102#1;
     29, 30;
     000001, #camaniva#0, #camaniva#1;
     999999, #camaniva#0, #camaniva#1;
     be;
     NULL, dpntm102;
|FIN;

|PROCESO DesactualizaVentas;
     aAlfa = aPathDESPANET + "dpntm102.dat";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PATH_DAT #dpntm102#aPathDESPANET#;

     |BUCLE dpntm102;
|FPRC;

|PROCESO dpntm103;
     nLibro = #camaniva#0;
     nDocu  = #camaniva#1;

     |ABRE #dsarm034;
     |SELECT #2#dsarm034;
     |BUCLE dsarm005;
     |CIERRA #dsarm034;

     |BORRA 020#dpntm103.a;
     |LIBERA #dpntm103;
|FPRC;

|DEFBUCLE dpntm103;
     #dpntm103#1;
     29, 30;
     000001, #camaniva#0, #camaniva#1;
     999999, #camaniva#0, #camaniva#1;
     be;
     NULL, dpntm103;
|FIN;

|PROCESO DesactualizaCompras;
     aAlfa = aPathDESPANET + "dpntm103.dat";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PATH_DAT #dpntm103#aPathDESPANET#;

     |BUCLE dpntm103;
|FPRC;

|PROCESO DesactualizaDSarchi;
     |DBASS aAlfa;
     aAlfa = aAlfa + "dsarchi/def/dsarm001.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     nEmpresa = #48#2;
     nPeriodo = #48#3;

     |DBASS aPathDESPANET;   |QBF aPathDESPANET;
     aPathDESPANET = aPathDESPANET + "despanet/" + (("00000" + nEmpresa) % -105) + "/fich/";

     |DBASS aPathDSARCHI;   |QBF aPathDSARCHI;
     aPathDSARCHI = aPathDSARCHI + "dsarchi/fich/";

     |PATH_DAT #dsarm005#aPathDSARCHI#;
     |PATH_DAT #dsarm034#aPathDSARCHI#;

     |SI #camaniva#36 = "R";  |HAZ DesactualizaVentas;   |FINSI;
     |SI #camaniva#36 = "S";  |HAZ DesactualizaCompras;  |FINSI;
|FPRC;

|PROCESO EnGadDiario;
     eaExiGAD = "   ";
     |DBASS aPathDSARCHI;   |QBF aPathDSARCHI;
     aPathDSARCHI = aPathDSARCHI + "dsarchi/fich/";
     |PATH_DAT #dsarm005#aPathDSARCHI#;

     aAlfa = aPathDSARCHI + "dsarm005.ddx";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |ABRE #dsarm005;
     |SELECT #10#dsarm005;

     #dsarm005#67 = #48#2;
     #dsarm005#68 = #48#3;
     #dsarm005#69 = enDiaGAD;
     #dsarm005#70 = efFecGAD;
     #dsarm005#71 = enDocGAD;
     #dsarm005#0  = 1;
     |LEE 000#dsarm005.];
     |SI FSalida = 0;
         |SI #dsarm005#67 = #48#2;     |Y #dsarm005#68 = #48#3;
          |Y #dsarm005#69 = enDiaGAD;  |Y #dsarm005#70 = efFecGAD;
          |Y #dsarm005#71 = enDocGAD;
              eaExiGAD = "GAD";
         |FINSI;
     |FINSI;
     |CIERRA #dsarm005;
|FPRC;

|PROCESO EnGadFactura;
     eaExiGAD = "   ";
     |DBASS aPathDSARCHI;   |QBF aPathDSARCHI;
     aPathDSARCHI = aPathDSARCHI + "dsarchi/fich/";
     |PATH_DAT #dsarm005#aPathDSARCHI#;

     aAlfa = aPathDSARCHI + "dsarm005.ddx";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |ABRE #dsarm005;
     |SELECT #11#dsarm005;

     #dsarm005#67 = #48#2;
     #dsarm005#68 = #48#3;
     #dsarm005#72 = enLibGAD;
     #dsarm005#73 = enRegGAD;
     |LEE 000#dsarm005.=;
     |SI FSalida = 0;
          eaExiGAD = "GAD";
     |FINSI;
     |CIERRA #dsarm005;
|FPRC;
