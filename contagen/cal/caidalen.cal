|FICHEROS;
  caidalen #3;

  cacalend #0;
  calendar #1;

  canempre #30;
  caselem1 #998;
|FIN;

|VARIABLES;
    &enCalen = 0;
|FIN;

|INCLUYE dscont_i;

|| ******************* Calculos de Pantalla
|| ****************************************
|CALCULO defectos; |TIPO 7;
  #3#1 = enEjercicio; |PINTA #3#1;
  #3#5 = enEjercicio; |PINTA #3#5;
|FCAL;

|CALCULO ModAny; |TIPO 0;
  |SI #3#0 = "N";
      |C_M #3#1,1,"N";
      |C_M #3#2,1,"N";
      |C_M #3#3,1,"N";
  |SINO;
      |C_M #3#1,1,"S";
      |C_M #3#2,1,"S";
      |C_M #3#3,1,"S";
  |FINSI;
  #3#1 = enEjercicio; |PINTA #3#1;
|FCAL;

|CALCULO DupAny; |TIPO 0;
  |SI #3#4 = "N";
      |C_M #3#5,1,"N";
      |C_M #3#6,1,"N";
      |C_M #3#7,1,"N";
  |SINO;
      |C_M #3#5,1,"S";
      |C_M #3#6,1,"S";
      |C_M #3#7,1,"S";
  |FINSI;
  #3#5 = enEjercicio; |PINTA #3#5;
|FCAL;

|CALCULO Existe; |TIPO 0;
 |SI #3#4 = "N"; |ACABA; |FINSI;

 |ABRE #0;
 #0#0 = #3Campo;
 |LEE 001#0=;
 |SI FSalida ! 0; |Y Campo = 6;
     |MENAV "    Error. No existe Calendario ";
     |ERROR;
 |FINSI;
 |SI FSalida = 0; |Y Campo = 7;
     |CONFI "    SError. Ya existe Calendario. Continuar S/N ? ";
     |SI FSalida ! 0;
         |ERROR;
     |FINSI;
 |FINSI;
 |CIERRA #0;
|FCAL;

|| ========================================================================
|PROCESO ModiAny0;
  #0#1 = #3#1;
  |GRABA 020#0a;
  |LIBERA #0;

  enCalen     = #0#0;
  enEjercicio = #0#1;
  |HAZ CreaCalend;
|FPRC;

|DEFBUCLE ModiAny;
 #0#1;
 ;
 #3#2;
 #3#3;
 be;
 NULL, ModiAny0;
|FIN;

|| ***************************************
|PROCESO HazTodo;

  |SI #3#0 = "S";
      |BUCLE ModiAny;
  |FINSI;

  |SI #3#4 = "S";

      |ABRE #0;
      #0#0 = #3#6;
      |LEE 101#0=;
      |SI FSalida ! 0;
          |MENAV "    Proceso Abortado. No existe Calendario Origen ";
          |CIERRA #0;
          |ACABA;
      |FINSI;

      |SALVA_DATOS #0;
      #0#0 = #3#7;
      |LEE 101#0=;
      |SI FSalida = 0;
          |BORRA 020#0a;
      |FINSI;
      |REPON_DATOS #0;
      #0#0 = #3#7;
      #0#1 = #3#5;
      |GRABA 020#0n;
      |LIBERA #0;
      |CIERRA #0;
      enCalen     = #0#0;
      enEjercicio = #0#1;
      |HAZ CreaCalend;
  |FINSI;

|FPRC;
|| ========================================================================

|CALCULO ElTipo3; |TIPO 3;
   |SI #48#27 = "S";
       |HAZ MultiEmpresa;
   |SINO;
       |DFICE dirfich0; |QBF dirfich0;
       |HAZ HazTodo;
   |FINSI;
|FCAL;

|| ========================================================================
|| ...............................
|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #0 dirfich0;
   |PATH_DAT #1 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
