|FICHEROS;
   ca8z0013;

   ca8cumay;
   ca8comay;
   ca8m0000;
   ca8m0001;
   ca8m0021;
   ca8m0022;

   ca8accaa;
   canempre;
   ca8ctrle;
|FIN;

|VARIABLES;
   aParam       = "";
   aAlfa        = "";
   aAlfa1       = "";

   nPara1       = 0;
   nNume0       = 0;
   nNume1       = 0;
   nNume2       = 0;
   nNume3       = 0;
   nNume4       = 0;
   nDesde       = 0;
   nHasta       = 0;
   nOrigen      = 0;
   &nBalNum     = 0;
   &enPlan      = 0;
   &wPatOfi     = 0;
   &wTipoPat    = 0;
   &eaExtension = "";
   nCanal       = 0;
   aPassword    = "";
   nPassword    = 0;
   nHayPlan     = 0;
   nDEjer       = 0;
   nHEjer       = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE lospat_i;

|CALCULO QueEjer; |TIPO 0;
  |SI #ca8z0013#1 ! "S";
      |C_M #ca8z0013#2, 1, "N";
      #ca8z0013#2 = 0;
      aAlfa1 = "NO COPIAR  ";
      |SI #ca8z0013#1 = "T";
          aAlfa1 = "POSTERIORES";
      |FINSI;
      |ATRI P; |PINTA 0667, aAlfa1; |ATRI 0;
  |SINO;
      |C_M #ca8z0013#2, 1, "S";
      |PINTA 0667, "           ";
      |SI #ca8z0013#2 = 0;
          #ca8z0013#2 = #ca8z0013#0 + 1;
      |FINSI;
      |PINTA #ca8z0013#2;
  |FINSI;
|FCAL

|CALCULO NoMas; |TIPO 0;

  nDesde = Campo;
  nHasta = 19;
  |SI Campo > 23; nHasta = 39; |FINSI;

  aAlfa = "S";
  |SI #ca8z0013#Campo# = -1; aAlfa = "N"; |FINSI;

  |PARA nPara1 = nDesde; |SI nPara1 [ nHasta; |HACIENDO nPara1 = nPara1 + 5;
        nNume0 = nPara1;
        nNume1 = nPara1 + 1;
        nNume2 = nPara1 + 2;
        nNume3 = nPara1 + 3;
        nNume4 = nPara1 + 4;
        |SI nPara1 ! nDesde;
            |C_M #ca8z0013#nPara1#,1,aAlfa;
        |FINSI;
        |C_M #ca8z0013#nNume2#,1,aAlfa;
        |C_M #ca8z0013#nNume3#,1,aAlfa;
        |C_M #ca8z0013#nNume4#,1,aAlfa;
        |SI aAlfa = "N";
            #ca8z0013#nPara1# = -1; |PINTA #ca8z0013#nPara1#;
            #ca8z0013#nNume1# = ""; |PINTA #ca8z0013#nNume1#;
            #ca8z0013#nNume2# = 00; |PINTA #ca8z0013#nNume2#;
            #ca8z0013#nNume3# = ""; |PINTA #ca8z0013#nNume3#;
            #ca8z0013#nNume4# = ""; |PINTA #ca8z0013#nNume4#;
        |FINSI;
  |SIGUE;
|FCAL;

|CALCULO LeeDefinicion;

 |C_M #ca8z0013#Campo#, 0, aAlfa;
 |SI aAlfa = "N"; |ACABA; |FINSI;

 |SI FSalida = 2; |ACABA; |FINSI;
 |SI Campo = 4; |O Campo = 9; |O Campo = 14; |O Campo = 19;
     nOrigen = 0;
     nNume0 = Campo;
 |SINO;
     nOrigen = 1;
     nNume0 = Campo - 2;
 |FINSI;
 |SI nOrigen = 0; |Y #ca8z0013#Campo# = -1; |ACABA; |FINSI;

 nNume1 = nNume0 + 1;
 nNume2 = nNume0 + 2;
 nNume3 = nNume0 + 3;
 nNume4 = nNume0 + 4;

 |SI nOrigen = 1; |Y #ca8z0013#nNume0# = #ca8z0013#nNume2#;
     |MENAV "    Error, origen y destino igual";
     |ERROR;
     |ACABA;
 |FINSI;

 |SI nOrigen = 1;
     enDPlan  = #ca8z0013#0;
     nBalNum  = #ca8z0013#nNume2#;
     wTipoPat = 1;
     |HAZ eVerEsPatron;
     |SI wPatOfi = 1;
         |CONFI "    NCodigo de Patron Oficial. Continuar S/N";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
 |FINSI;

 |ABRE #ca8m0000;
 #ca8m0000#0 = #ca8z0013#Campo#;
 |LEE 101#ca8m0000.=;
 |SI FSalida = 0;
     |SI nOrigen = 0;
         #ca8z0013#nNume1# = #ca8m0000#1;
         |PINTA #ca8z0013#nNume1#;
     |FINSI;
     |SI nOrigen = 1;
         #ca8z0013#nNume3# = #ca8m0000#1;
         |PINTA #ca8z0013#nNume3#;
         |CONFI "    NYa existe Definicion, Continuar ";
         |SI FSalida ! 0;
             |ERROR;
             |LIBERA #ca8m0000;
             |CIERRA #ca8m0000;
             |ACABA;
         |FINSI;
     |FINSI;
 |SINO;
     |SI nOrigen = 1;
         #ca8z0013#nNume3# = #ca8z0013#nNume1#;
         |PINTA #ca8z0013#nNume3#;
     |FINSI;
     |SI nOrigen = 0;
         |MENAV "    No existe definicion Origen ";
         |ERROR;
         |LIBERA #ca8m0000;
         |CIERRA #ca8m0000;
         |ACABA;
     |FINSI;
 |FINSI;
 |LIBERA #ca8m0000;
 |CIERRA #ca8m0000;

 |ABRE #ca8m0001;
 |SI nOrigen = 0;
     #ca8m0001#14 = #ca8z0013#0;
     #ca8m0001#0  = #ca8z0013#nNume0#;
     #ca8m0001#1  = 0;
     |LEE 001#ca8m0001.];
     |SI FSalida ! 0; |O #ca8m0001#0 ! #ca8z0013#nNume0#; |O #ca8m0001#14 ! #ca8z0013#0;
         |MENAV "0000No existe Cuentas de Mayor Origen ...";
         |ERROR;
     |FINSI;
 |FINSI;

 |SI nOrigen = 1;
     #ca8m0001#14 = #ca8z0013#0;
     #ca8m0001#10 = #ca8z0013#nNume2#;
     #ca8m0001#0  = "     ";
     |LEE 101#ca8m0001.];
     |SI FSalida = 0; |Y #ca8m0001#10 = #ca8z0013#nNume2#; |Y #ca8m0001#14 = #ca8z0013#0;
         |AVISO;
         |CONFI "    NRegrabar Cuentas de Mayor Destino YA EXISTENTE (S/N): ";
         |SI FSalida ! 0;
              |ERROR;
         |FINSI;
     |FINSI;
 |FINSI;
 |CIERRA #ca8m0001;
|FCAL;

|CALCULO LeePlan; |TIPO 0;

 |C_M #ca8z0013#Campo#, 0, aAlfa;
 |SI aAlfa = "N"; |ACABA; |FINSI;

 |SI FSalida = 2; |ACABA; |FINSI;
 |SI Campo = 24; |O Campo = 29; |O Campo = 34; |O Campo = 39;
     nOrigen = 0;
     nNume0 = Campo;
 |SINO;
     nOrigen = 1;
     nNume0 = Campo - 2;
 |FINSI;
 |SI nOrigen = 0; |Y #ca8z0013#Campo# = -1; |ACABA; |FINSI;

 nNume1 = nNume0 + 1;
 nNume2 = nNume0 + 2;
 nNume3 = nNume0 + 3;
 nNume4 = nNume0 + 4;

 |SI nOrigen = 1; |Y #ca8z0013#nNume0# = #ca8z0013#nNume2#;
     |MENAV "    Error, origen y destino igual";
     |ERROR;
     |ACABA;
 |FINSI;

 |SI nOrigen = 1;
     enDPlan  = #ca8z0013#0;
     nBalNum  = #ca8z0013#nNume2#;
     wTipoPat = 0;
     |HAZ eVerEsPatron;
     |SI wPatOfi = 1;
         |CONFI "    NCodigo de Patron Oficial. Continuar S/N";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
 |FINSI;

 |ABRE #ca8comay;
 #ca8comay#0 = #ca8z0013#Campo#;
 |LEE 101#ca8comay.=;
 |SI FSalida = 0;
     |SI nOrigen = 0;
         #ca8z0013#nNume1# = #ca8comay#1;
         |PINTA #ca8z0013#nNume1#;
     |FINSI;
     |SI nOrigen = 1;
         #ca8z0013#nNume3# = #ca8comay#1;
         |PINTA #ca8z0013#nNume3#;
         |CONFI "    NYa existe Definicion, Continuar ";
         |SI FSalida ! 0;
             |ERROR;
             |LIBERA #ca8comay;
             |CIERRA #ca8comay;
             |ACABA;
         |FINSI;
     |FINSI;
 |SINO;
     |SI nOrigen = 1;
         #ca8z0013#nNume3# = #ca8z0013#nNume1#;
         |PINTA #ca8z0013#nNume3#;
     |FINSI;
     |SI nOrigen = 0;
         |MENAV "    No existe definicion Origen ";
         |ERROR;
         |LIBERA #ca8comay;
         |CIERRA #ca8comay;
         |ACABA;
     |FINSI;
 |FINSI;
 |LIBERA #ca8comay;
 |CIERRA #ca8comay;


 |ABRE #ca8cumay;
 |SI nOrigen = 0;
     #ca8cumay#12 = #ca8z0013#0;
     #ca8cumay#10 = #ca8z0013#nNume0#;
     #ca8cumay#0  = "     ";
     |LEE 001#ca8cumay.];
     |SI FSalida ! 0; |O #ca8cumay#10 ! #ca8z0013#nNume0#; |O #ca8cumay#12 ! #ca8z0013#0;
         |MENAV "0000No existe Cuentas de Mayor Origen ...";
         |ERROR;
     |FINSI;
 |FINSI;

 |SI nOrigen = 1;
     #ca8cumay#12 = #ca8z0013#0;
     #ca8cumay#10 = #ca8z0013#nNume2#;
     #ca8cumay#0  = "     ";
     |LEE 101#ca8cumay.];
     |SI FSalida = 0; |Y #ca8cumay#10 = #ca8z0013#nNume2#; |Y #ca8cumay#12 = #ca8z0013#0;
         |AVISO;
         |CONFI "    NRegrabar Cuentas de Mayor Destino YA EXISTENTE (S/N): ";
         |SI FSalida ! 0;
              |ERROR;
         |FINSI;
     |FINSI;
 |FINSI;
 |CIERRA #ca8cumay;
|FCAL;

|CALCULO Tipo7CSN; |TIPO 7;

  |C_M #ca8z0013#Campo#, 0, aAlfa;
  |SI aAlfa = "N"; |ACABA; |FINSI;

  |SI #ca8z0013#Campo# = " ";
      #ca8z0013#Campo# = "N";
  |FINSI;

  aAlfa = "S";
  nNume0 = Campo - 4;
  enDPlan  = #ca8z0013#0;
  nBalNum  = #ca8z0013#nNume0#;
  wTipoPat = 0;
  |SI Campo < 24;  wTipoPat = 1;  |FINSI;
  |HAZ eVerEsPatron;
  |SI wPatOfi = 1;
      #ca8z0013#Campo# = "N";
      aAlfa = "N";
  |FINSI;
  |PINTA #ca8z0013#Campo#;
  |C_M #ca8z0013#Campo#, 1, aAlfa;
|FCAL;

|CALCULO Tipo0CSN; |TIPO 0;

  |C_M #ca8z0013#Campo#, 0, aAlfa;
  |SI aAlfa = "N"; |ACABA; |FINSI;

  |SI #ca8z0013#Campo# = " ";
      |ERROR;
      #ca8z0013#Campo# = "N";
      |PINTA #ca8z0013#Campo#;
  |FINSI;
|FCAL;

|CALCULO Tipo7C44; |TIPO 7;
  aAlfa = "N";
  |PARA nPara1 = 24; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 5;
        |SI #ca8z0013#nPara1# ! -1;
            aAlfa = "S";
            |SAL;
        |FINSI;
  |SIGUE;
  |SI aAlfa ="N";
      #ca8z0013#44 = "N";
      |PINTA #ca8z0013#44;
  |FINSI;
  |C_M #ca8z0013#44, 1, aAlfa;
|FCAL;

|| //////////////////////////////////////////////////////////////////
|PROCESO LeoEmpresas;
   #ca8ctrle#0 = #canempre#2;
   #ca8ctrle#1 = #canempre#3;
   |LEE 141#ca8ctrle.=;
   |SI FSalida = 0;

       |PARA nPara1 = 24; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 5;
             |SI #ca8z0013#nPara1# ! -1;
                 nNume0 = nPara1;
                 nNume2 = nPara1 + 2;

                 |SI #ca8ctrle#2 = #ca8z0013#nNume0#;
                     #ca8ctrle#2 = #ca8z0013#nNume2#;
                     |GRABA 020#ca8ctrle.a;
                     |SAL;
                 |FINSI;
             |FINSI;
       |SIGUE;
   |FINSI;
   |LIBERA #ca8ctrle;
|FPRC;

|DEFBUCLE LeoEmpresas;
   #canempre#4;
   ;
   00001, nDEjer;
   99999, nHEjer;
   e;
   NULL, LeoEmpresas;
|FIN;

|PROCESO CambioEmpresas;
  aAlfa = "Cambiando el Codigo Plan Ctble en las Empresas   ";
  |PINTA 2213, aAlfa;

  aAlfa  = #ca8z0013#0;
  aAlfa  = aAlfa % -102;
  nDEjer = aAlfa;
  nHEjer = aAlfa;
  |SI #ca8z0013#1 = "T"; nHEjer = 79; |FINSI;

  |ABRE #ca8ctrle;
  |BUCLE LeoEmpresas;
  |SI #ca8z0013#1 = "S";
      aAlfa  = #ca8z0013#2;
      aAlfa  = aAlfa % -102;
      nDEjer = aAlfa;
      nHEjer = aAlfa;
      |BUCLE LeoEmpresas;
  |FINSI;
  |CIERRA #ca8ctrle;
|FPRC;

|| .........................................
|PROCESO AltaM0000;
  |ABRE #ca8m0000;
  #ca8m0000#0 = #ca8z0013#nNume2#;
  |LEE 101#ca8m0000.=;
  |SI FSalida ! 0;
      #ca8m0000#1 = #ca8z0013#nNume3#;
      |GRABA 020#ca8m0000.n;
  |SINO;
      #ca8m0000#1 = #ca8z0013#nNume3#;
      |GRABA 020#ca8m0000.a;
  |FINSI;
  |LIBERA #ca8m0000;
  |CIERRA #ca8m0000;
|FPRC;

|| .........................................
|PROCESO AltaComay;
  |ABRE #ca8comay;
  #ca8comay#0 = #ca8z0013#nNume2#;
  |LEE 101#ca8comay.=;
  |SI FSalida ! 0;
      #ca8comay#1 = #ca8z0013#nNume3#;
      |GRABA 020#ca8comay.n;
  |SINO;
      #ca8comay#1 = #ca8z0013#nNume3#;
      |GRABA 020#ca8comay.a;
  |FINSI;
  |LIBERA #ca8comay;
  |CIERRA #ca8comay;
|FPRC;

|| .........................................
|PROCESO AltaAccaa;

  enDPlan = #ca8accaa#0;
  aAlfa = "Pasando Estr.CCAA y Plan Ctble al Ejercicio " + enDPlan;
  |PINTA 2213, aAlfa;
  |SUB_EJECUTA_NP ":contagen/caz00101;primero";
  |SI enDPlan = 2008; |O enDPlan = 2015; |O enDPlan = 2016;
     |O enDPlan = 2018;
      nPassword = 1;
      aAlfa = "Instalando Ficheros Oficiales del Ejercicio " + enDPlan;
      |PINTA 2213, aAlfa;

      nActual = 0;
      enPlan  = enDPlan;
      |HAZ InstaloFich0;
      |BLIN 16;
  |FINSI;
|FPRC;

|DEFBUCLE LeeAccaa;
  #ca8accaa#1;
  ;
  nNume0;
  9999;
  ;
  NULL, AltaAccaa;
|FIN;
|| .........................................

|CALCULO Tipo3z13; |TIPO 3;
   nHayPlan = 0;
   |BLANCO 22012361;
   enDPlan = #ca8z0013#0;
   |PARA nPara1 = 4; |SI nPara1 [ 19; |HACIENDO nPara1 = nPara1 + 5;
         |SI #ca8z0013#nPara1# ! -1;
             nNume0 = nPara1;
             nNume1 = nPara1 + 1;
             nNume2 = nPara1 + 2;
             nNume3 = nPara1 + 3;
             nNume4 = nPara1 + 4;

      aAlfa = "Copiando Estructura CCAA " + ("00" + #ca8z0013#nNume0#) % -102;
      aAlfa = aAlfa + " al Codigo " +  ("00" + #ca8z0013#nNume2#) % -102 + "        ";
      |PINTA 2213, aAlfa;

             |HAZ AltaM0000;
             enOp101 = 1;
             enONume = #ca8z0013#nNume0#;
             enDNume = #ca8z0013#nNume2#;
             |SUB_EJECUTA_NP ":contagen/caz00101;copiar";

             |SI #ca8z0013#nNume4# = "S";
                  enOp101 = 1;
                  enONume = #ca8z0013#nNume0#;
                  enDNume = #ca8z0013#nNume0#;
                  |SUB_EJECUTA_NP ":contagen/caz00101;borrar";
             |FINSI;

         |FINSI;
   |SIGUE;

   |PARA nPara1 = 24; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 5;
         |SI #ca8z0013#nPara1# ! -1;
             nNume0 = nPara1;
             nNume1 = nPara1 + 1;
             nNume2 = nPara1 + 2;
             nNume3 = nPara1 + 3;
             nNume4 = nPara1 + 4;

      aAlfa = "Copiando Plan Contable " + ("00" + #ca8z0013#nNume0#) % -102;
      aAlfa = aAlfa + " al Codigo " +  ("00" + #ca8z0013#nNume2#) % -102 + "          ";
      |PINTA 2213, aAlfa;

             |HAZ AltaComay;
             enOp101 = 2;
             enONume = #ca8z0013#nNume0#;
             enDNume = #ca8z0013#nNume2#;
             |SUB_EJECUTA_NP ":contagen/caz00101;copiar";
             nHayPlan = 1;

             |SI #ca8z0013#nNume4# = "S";
                  enOp101 = 2;
                  enONume = #ca8z0013#nNume0#;
                  enDNume = #ca8z0013#nNume0#;
                  |SUB_EJECUTA_NP ":contagen/caz00101;borrar";
             |FINSI;
         |FINSI;
   |SIGUE;

   enOp101 = 3;
   enOPlan = #ca8z0013#0;
   |SI #ca8z0013#1 = "S";
       #ca8accaa#0 = #ca8z0013#2;
       |HAZ AltaAccaa;
   |FINSI;
   |SI #ca8z0013#1 = "T";
       nNume0 = #ca8z0013#0 + 1;
       |BUCLE LeeAccaa;
   |FINSI;

   |SI nHayPlan = 1; |Y #ca8z0013#44 = "S";
       |HAZ CambioEmpresas;
   |FINSI;
|FCAL;

|PROCESO DirContasoc;
  |DBASS aBase; |QBT aBase;
  aLosDefs = aBase + "contasoc/def/";
  aElProgr = aLosDefs + "isacceso.mas";
  |XABRE "E", aElProgr, nCanal;
  |SI FSalida ] 0;
      HaySociedad = 1;
  |SINO;
      HaySociedad = 0;
  |FINSI;
  |XCIERRA nCanal;
  aPContas = aBase + "contasoc/";
|FPRC;

|PROGRAMA;
     |HAZ inicio;
     |HAZ DirContasoc;

     |CLS;
     |PINPA #0#ca8z0013;
     |PINDA #0#ca8z0013;
     aPassword = "";
     |BLANCO 1801 2379;
     |CUADRO 2013 2263;
     |PINTA 2115, "Introduzca Password : ";
     E_inf = "";
     E_sup = "20";
     aPassword = 2137 ? -1;
     |SI aPassword ! "<MYPASWD>     ";
         |MENAV "     Permiso denegado.";
         |ACABA;
     |FINSI;

     |PINPA #0#ca8z0013;
     |PINDA #0#ca8z0013;
     |ENDATOS #1#ca8z0013;
     |SI FSalida = 0; |Y #ca8z0013#3 = "SI";
         |HAZ Tipo3z13;
     |FINSI;
|FPRO;
