|FICHEROS;
  casoplih #0,MANTE;

  casoplic #1,MANTE;
  casopliz #10;

  casoplil;
  casoplim #11;
  canempre #30;
  caselem1 #998;

  casopliw #920,MANTE;

  fichero@;
|FIN;

|VARIABLES;
  aParam   = "";
  nEjer    = 0;
  aFichero = "";
  nInkey   = 0;
  &aPrograma = "";
  &enDEmpresa = 0;
  &enHEmpresa = 0;
  &enDEjer    = 0;
  &enHEjer    = 0;
  aPath       = "";
  nNume1      = 0;
  nNume2      = 0;
  nNume4      = 0;
  aAlfa       = "";
  aAlfa1      = "";
  aAlfa2      = "";
  aAny        = "";
  aDia        = "";
  aMes        = "";
  nAny        = 0;
  fFecha      = @;
  fFecha1     = @;
  fFecha2     = @;
  fFecha3     = @;
  aDestino    = "";

  aOrigen     = "";
  &eaOrigen   = "";
  &eaDestino  = "";
  &enErrPas   = 0;
  &eaAlfa     = "";
  fiche       = "";
  aDirectorio = "";
  nHandle     = 0;
  nSw         = 0;
  varalfa     = "";
  aTexto      = "";
  aC13        = "";
  aC10        = "";
  aCampo1     = "";
  aCampo2     = "";
  aCampo3     = "";
  aDescrip    = "";
  aNumero     = "";
  aFechaA     = "";
  aFechaF     = "";
  aFechaU     = "";
  nHay        = 0;
  aTecla      = "";
  nModo       = 0;
  nCampo      = 0;
  nSwE        = 0;
  nOpera      = 0;

  Comodin     = "";
  Comodin1    = "";
  nDesde      = 0;
  nHasta      = 0;
  nCont       = 0;
  aDef        = "";
|FIN;

|INCLUYE dscont_i;
|INCLUYE dslegv_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|PROCESO Actualiza;
    #0#0 = #1#0;
    #0#1 = #1#1;
    #0#2 = #1#2;
|FPRC;

|PROCESO ProcTexto;
   aAlfa1 = aTexto % 101;

   |SI aAlfa1 ! "0"; |Y aAlfa1 ! "1"; nHay = 1; |ACABA; |FINSI;
   |SI aAlfa1 = "1"; |Y nHay = 0; |ACABA; |FINSI;

   aAlfa1 = aTexto % 103;
   |SI aCampo1 ! aAlfa1;
       |SI aCampo1 ! ""; |HAZ Actualiza; |FINSI;
       aCampo1 = aAlfa1;
       aCampo2 = aTexto % 0402;
       aCampo3 = aTexto % 0699;
       |SI aCampo2 = "01"; aDescrip = aCampo3; |FINSI;
       |SI aCampo2 = "02"; aNumero  = aCampo3; |FINSI;
       |SI aCampo2 = "03"; aFechaA  = aCampo3; |FINSI;
       |SI aCampo2 = "04"; aFechaF  = aCampo3; |FINSI;
       |SI aCampo2 = "05"; aFechaU  = aCampo3; |FINSI;
  |FINSI;
|FPRC;

|PROCESO ActualizarLibros;
    |SI aMasNombre ! "S";
        aOrigen = aPath + ((("00000" + enEmpresa) % -105) + enPeriodo) + "/";
    |SINO;
        aOrigen = aPath + ((("00000" + enEmpresa) % -105) + enPeriodo);
        eaAlfa  = #1#5; |QBF eaAlfa;
        |HAZ QuitaRaros_D;
        aOrigen = aOrigen + eaAlfa + "/";
    |FINSI;

    |DBASE aBase; |QBF aBase;
    aAlfa1 = aBase + "/tmp"; |MKDIR aAlfa1;
    aAlfa1 = aAlfa1 + "/" + (("00000" + enEmpresa) % -105) + enPeriodo; |MKDIR aAlfa1;
    aDirectorio = aAlfa1 + "/";

|ET Direc;
    fiche     = "datos.txt";
    eaOrigen  = aOrigen + fiche;
    eaDestino = aDirectorio + fiche;
    |HAZ eReciboFich;
    |SI enErrPas ! 0;
        |MENAV  "0000No Existen datos en el Directorio";
        |CONFI "0000Desea Buscar otro Directorio";
        |SI FSalida = 0;
            |HAZ Pedir;
            aOrigen = aAlfa1;
            |VETE Direc;
        |FINSI;
        |ACABA;
    |FINSI;

    |ABRE #0;
    aC13 = &13;
    aC10 = &10;
    |XABRE "UB", eaDestino, nHandle;
    |SI FSalida < 0;
        |XABRE "CUB", eaDestino, nHandle;
    |FINSI;
    |SI FSalida ] 0;
        nSw = 0; aTexto = ""; nHay = 0; aCampo1 = "";
        |PARA; |SI nSw = 0; |HACIENDO;
               |XLEE nHandle, 1, varalfa;
               |SI FSalida = 1;
                   |SI varalfa = aC13; |O varalfa = aC10;
                       |SI aTexto ! "";
                           |HAZ ProcTexto;
                       |FINSI;
                       aTexto = "";
                   |SINO;
                       aTexto = aTexto + varalfa;
                   |FINSI;
               |SINO;
                   nSw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA nHandle;
     |FINSI;
     Pos = -1;
     |CIERRA #0;
     |HAZ Tipo7w;
|FPRC;

|PROCESO BuscoDirectorio;
        |MENAV "0000Introduzca la Ruta completa de la Carpeta de Legalia";
        |HAZ Pedir;
        aPath = aAlfa1;
|FPRC;

|PROCESO Pedir;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        |SI aAlfa1 = ""; |ACABA; |FINSI;
        aAlfa1 = aAlfa1 % 280;
        |QBF aAlfa1;
        aAlfa2 = aAlfa1 % -101;
        |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
            aAlfa1  = aAlfa1 + "\";
        |FINSI;
|FPRC;

|| **********************************************************************
|PROCESO EjerAnterior;
   nSwE   = 0;
   |PARA nCampo = 10;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 2;
         nNume4 = nCampo + 1;
         |SI #920nCampo = 0;
             #920nCampo = #fichero@#nCampo# + #fichero@#nNume4#;
         |FINSI;
         |SI #920nCampo = 0;
             nSwE       = 1;
         |FINSI;
   |SIGUE;
   |SI nSwE = 0;
       |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE EjerAnterior;
   #fichero@#2003;
   ;
   #casoplic#0, nAny, 0;
   #casoplic#0, 2014, 9;
   e;
   NULL, EjerAnterior;
|FIN;

|PROCESO Leecasoplih;
     nSwE = 1;

     |SI nOpera = 2;

         nNume1 = 9 + (#casoplih#3 * 2);
         #920nNume1 = #920nNume1 + 1;

     |SINO;

         |SI nOpera = 0;
             |SI #casoplih#11 = "N";  nSwE = 2;  |FINSI;
         |FINSI;
         |SI nOpera = 1;
             |SI #casoplih#11 = "S";  nSwE = 2;  |FINSI;
         |FINSI;
         |SI nSwE = 2; |ERROR10; |FINSI;

     |FINSI;
|FPRC;

|DEFBUCLE Leecasoplih;
     #casoplih#1;
     ;
     #1#0, #1#1, #1#2, 01, 01;
     #1#0, #1#1, #1#2, 20, 99;
     e;
     NULL, Leecasoplih;
|FIN;

|PROCESO LoRecalculo;
   #920#8 = "01.01.0000";
   |PARA nCampo = 11;  |SI nCampo [ 49;  |HACIENDO nCampo = nCampo + 2;
         #920nCampo = 0;
   |SIGUE;

   nOpera = 2;
   nSwE   = 0;
   |BUCLE Leecasoplih;

   nSwE   = 0;
   |PARA nCampo = 10;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 2;
         nNume4 = nCampo + 1;
         aAlfa  = "N";
         |SI #920nNume4 = 0;
             aAlfa      = "S";
             #920nCampo = 0;
             nSwE       = 1;
         |FINSI;
         |C_M #920nCampo,1,aAlfa;
   |SIGUE;
   |SI nSwE = 1;
       |DDEF aDef;
       aDef = aDef + "casoplic";
       |CARGA_DEF aDef, fichero@;
       |SI FSalida ! 0;
           |MENAV "    Error al Carga fichero de Otros Libros";
           |ACABA;
       |FINSI;
       nAny = #casoplic#1 - 1;
       |BUCLE EjerAnterior;
       |DESCARGA_DEF #fichero@;
   |FINSI;
   |PINDA #0#920;
|FPRC;

|PROCESO LoRecalculo0;
   |PARA nCampo = 10;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 2;
         nNume4 = nCampo + 1;
         |SI #920nNume4 = 0;
             #920nCampo = 0; |PINTA #920nCampo;
         |FINSI;
   |SIGUE;
|FPRC;

|PROCESO Tipo12W; |TIPO 12;
|FPRC;

|PROCESO PulsaF2;
  |C_M #920Campo,0,aAlfa;
  |SI aAlfa = "N"; |ACABA; |FINSI;

  |SI FSalida = 10;
      |CONFI "0000SRecoger Primer Numero de Libro segun Ejercicios Anteriores";
      |SI FSalida = 0;
          |HAZ LoRecalculo;
      |FINSI;
      |ERROR;
  |FINSI;
  |SI FSalida = 11;
      |CONFI "0000SDejar a 000 el Primer Numero de Libro para calculo automatico en Emision";
      |SI FSalida = 0;
          |HAZ LoRecalculo0;
      |FINSI;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO LosContadores;
    |LEE 141#1=;

    |SI #1#9 = "S";
        |SI nModo = 2; |MENAV "0000Solo Consulta. Legalizacion Archivada"; |FINSI;
        nModo = 4;
    |FINSI;

    |SI nModo = 2;
        |ABRE #0;
        #0#0 = #1#0;
        #0#1 = #1#1;
        #0#2 = #1#2;
        #0#3 = 20;
        #0#4 = 99;
        |LEE 041#0];
        |SI FSalida ! 0;
            |LEE 041#0u;
        |SINO;
            |LEE 041#0a;
        |FINSI;
        |SI FSalida = 0; |Y #0#0 = #1#0; |Y #0#1 = #1#1; |Y #0#2 = #1#2;
            |CONFI "0000NYa existe Libros Legalizados, desea Continuar";
            |SI FSalida ! 0;
                |LIBERA #1;
                |CIERRA #0;
                |ACABA;
            |FINSI;
        |FINSI;
        |CIERRA #0;
   |FINSI;

   |PUSHV 0501 2380;
   |PINPA #0#920;
   |SI nModo ! 2;
       |PINTA 2305,"                                                                           ";
   |FINSI;

   |PARA nCampo = 0;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
          #920nCampo = #1nCampo;
   |SIGUE;
   |PARA nCampo = 10;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 2;
         nNume4 = nCampo + 1;
         aAlfa1 = "N";
         |SI #920nNume4 = 0; aAlfa1 = "S"; |FINSI;
         |C_M #920nCampo, 1, aAlfa1;
   |SIGUE;

   |PINDA #0#920;
   |SI nModo ! 4;
       |ENDATOS #1#920;
       |SI FSalida = 0;
           |PARA nCampo = 6;  |SI nCampo [ 49;  |HACIENDO nCampo = nCampo + 1;
                 #1nCampo = #920nCampo;
           |SIGUE;
           |GRABA 020#1a;
       |FINSI;
    |SINO;
       |LEETECLA aTecla;
    |FINSI;
   |POPV;

   |LIBERA #1;
|FPRC;

|| **********************************************************************
|PROCESO borra_soplil;
  |BORRA 020#casoplil.a;
  |LIBERA #casoplil;
|FPRC;

|DEFBUCLE borra_soplil;
  #casoplil#1;
  ;
  001;
  999;
  be;
  NULL, borra_soplil;
|FIN;

|PROCESO borra_soplih;
  |BORRA 020#casoplih.a;
  |LIBERA #casoplih;
|FPRC;

|DEFBUCLE borra_soplih;
  #casoplih#1;
  ;
  #casoplic#0, #casoplic#1, #casoplic#2, 00, 00;
  #casoplic#0, #casoplic#1, #casoplic#2, 20, 99;
  be;
  NULL, borra_soplih;
|FIN;

|PROCESO BorraTodo;

     nDesde = 99; nHasta = 0;
     |PARA nCont = 10; |SI nCont [ 48; |HACIENDO nCont = nCont + 2;
           |SI #casoplic#nCont# < nDesde; |Y #casoplic#nCont# ! 0;
               nDesde = #casoplic#nCont#;
           |FINSI;
           nNume2 = nCont + 1;
           nNume2 = #casoplic#nCont# + #casoplic#nNume2# - 1;
           |SI nNume2 > nHasta;
               nHasta = nNume2;
           |FINSI;
     |SIGUE;
     |SI nDesde = 99; |Y nHasta = 0; nDesde = 1; nHasta = 10; |FINSI;

     aPath = #casoplic#3; |QBF aPath;
     |SI #casoplic#4 ! "S";
          Comodin = aPath + ((("00000" + #casoplic#0) % -105) + #casoplic#2) + "/";
      |SINO;
          Comodin = aPath + ((("00000" + #casoplic#0) % -105) + #casoplic#2);
          eaAlfa = #casoplic#5; |QBF eaAlfa;
          |HAZ QuitaRaros_D;
          Comodin = Comodin + eaAlfa + "/";
      |FINSI;

      Comodin1 = Comodin + "datos.txt";   |RFBORRA Comodin1;
      Comodin1 = Comodin + "desc.txt";    |RFBORRA Comodin1;
      Comodin1 = Comodin + "nombres.txt"; |RFBORRA Comodin1;

      |PARA nCont = nDesde; |SI nCont [ nHasta; |HACIENDO nCont = nCont + 1;

            Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xls";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xlsx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;

            Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".doc";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".docx";
            |RFBORRA Comodin1;


            Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;
            Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".pdf";
            |RFBORRA Comodin1;

      |SIGUE;
      |RRMDIR Comodin;

      |DBASE aOrigen; |QBF aOrigen;
      aOrigen = aOrigen + "PresLibr/" + (("00000" + #casoplic#0) % -105) + #casoplic#2 + "/*.*";
      Comodin = aOrigen - "*.*";
      |_PDIR aOrigen;
      |PARA; |SI FSalida = 0; |HACIENDO;
             |FBORRA aOrigen;
             |_SDIR aOrigen;
      |SIGUE;

      |BUCLE borra_soplih;

      Comodin = ((("00000" + #casoplic#0) % -105) + #casoplic#2);
      |DFICB aAlfa1; |QBF aAlfa1;
      aAlfa1 = aAlfa1 + Comodin + "/";
      |CIERRA #casoplil;  |PATH_DAT #casoplil#aAlfa1#;
      |BUCLE borra_soplil;

      |PDEFECTO #casoplic, 8, 52;
      |GRABA 020#casoplic.a;
      |LIBERA  #casoplic;
|FPRC;
|| **********************************************************************
|RUTINA ClaveBajaH;
     #0#0 = #1#0;
     #0#1 = #1#1;
     #0#2 = #1#2;
     #0#3 = 1;
     #0#4 = 1;
|FRUT;

|RUTINA ClaveAltaH;
     #0#0 = #1#0;
     #0#1 = #1#1;
     #0#2 = #1#2;
     #0#3 = 20;
     #0#4 = 99;
|FRUT;


|PROCESO Tipo7w;  |TIPO 7;
     aAlfa1 = "0000Pulse <F2> Entrar a Ejercicios, <F3> Consulta Empresas";
     |SI aParam ! "";
         aAlfa1 = "0000Pulse <F2> Entrar a Ejercicios";
     |FINSI;
     |MENSA aAlfa1;

     enEmpresa   = #1#0;
     enEjercicio = #1#1;
     enPeriodo   = #1#2;
     |ENTLINEAL #1#0, -4, 7, 22, 0, ClaveBajaH, ClaveAltaH;
|FPRC;


|PROCESO Tipo11w;  |TIPO 11;
   nInkey = FSalida;

   |SI nInkey =  10;
       enEmpresa   = #1#0;
       enEjercicio = #1#1;
       enPeriodo   = #1#2;
       |ENTLINEAL #1#0, -4, 4, 22, 0, ClaveBajaH, ClaveAltaH;
       |ERROR;
   |FINSI;

/*
   |SI nInkey = 11;         || F2
       enEmpresa   = #1#0;
       enEjercicio = #1#1;
       enPeriodo   = #1#2;
       |HAZ ActualizarLibros;
   |FINSI;
*/

   |SI nInkey = 11; |O nInkey = 12;
       |SI nInkey = 11; nModo = 2; |FINSI;
       |SI nInkey = 12; nModo = 4; |FINSI;
       |HAZ LosContadores
       |ERROR;
   |FINSI;

   |SI nInkey = 13;
       |LEE 141#1=;
       |SI #1#9 = "S";
           |CONFI "0000NEsta seguro de Desarchivar la Legalizacion";
           |SI FSalida = 0;
               #1#9  = "N";
               #1#51 = "01.01.0000";
               |GRABA 020#1a;
           |FINSI;
       |SINO;
           |SI #1#50 ! "01.01.0000";
               nOpera = 0;
               nSwE   = 0;
               |BUCLE Leecasoplih;
               |SI nSwE = 1;
                   |CONFI "0000SArchivar la Legalizacion";
                   |SI FSalida = 0;
                        #1#9   = "S";
                        fFecha = ~;
                        #1#51  = fFecha;
                        |GRABA 020#1a;
                   |FINSI;
               |SINO;
                   |MENAV "0000Existe Libros Sin pasar a la Carperta de Legalia. No puede Archivar";
               |FINSI;
           |FINSI;
       |FINSI;
       |LIBERA #1;
       |PINTA #1#9;
       |PINTA #1#51;
       |ERROR;
   |FINSI;

   |SI nInkey = 14;
       |SI #1#9 = "S";
           |MENAV "0000Legalizacion Archivada, no puede borrarla";
           |ACABA;
       |FINSI;
       nOpera = 1;
       nSwE   = 0;
       |BUCLE Leecasoplih;
       |SI nSwE = 2;
           aAlfa = "0000NExisten Libros pasados a la Carpeta de Legalia. Desea continuar con el borrado";
       |SINO;
           aAlfa = "0000SDesea borrar este registro";
       |FINSI;
       |CONFI aAlfa;
       |SI FSalida ! 0;  |ACABA; |FINSI;

       |HAZ BorraTodo;
       |PONCONTROL 23, "SI";
       |ERROR;
   |FINSI;
|FPRC;

|RUTINA ClaveBajaW;
     #1#0 = #10#0;
     #1#1 = #10#2;
     #1#2 = 0;
|FRUT;

|RUTINA ClaveAltaW;
     #1#0 = #10#0;
     #1#1 = #10#3;
     #1#2 = 9;
|FRUT;

|PROCESO Tipo7z;  |TIPO 7;
     |ABRE #1;
     #1#0 = #10#0;
     #1#1 = #10#2;
     #1#2 = 0;
     |LEE 001#1];

     |PINDA #0#1;
     |HAZ Tipo7w;
     |CIERRA #1;

     |ENTLINEAL #1#1, -2, 7, 22, 0, ClaveBajaW, ClaveAltaW;
|FPRC;

|PROCESO Tipo11z;  |TIPO 11;
   nInkey = FSalida;
   |SI nInkey =  10;
       enEmpresa   = #10#0;
       |ENTLINEAL #1#1, -2, 4, 22, 0, ClaveBajaW, ClaveAltaW;
   |FINSI;

   |SI nInkey = 11; |Y aParam = "";       || F3
       |ERROR;
       FSalida = 10;
       aPrograma = "casopliz";
       |HAZ ConsuCliente;
       aPrograma = "";
       |PTEC 802;
   |FINSI;

    |SI nInkey = 12;
      ||  |HAZ LosContaMasivos;
    |FINSI;
|FPRC;

|| ********************************************
|PROCESO GrabaAuxiliares;
      nEjer = #30#26 + 2000;
      |SI #30#26 ] 80; nEjer = #30#26 + 1900; |FINSI;
      |SI nEjer < 2015; |ACABA; |FINSI;

      #10#0 = #30#2;
      |LEE 041#10=;
      |SI FSalida ! 0;
          |DDEFECTO #10;
          #10#0 = #30#2;
          #10#1 = #30#1;
          #10#4 = #30#9;
          #10#2 = nEjer;
          #10#3 = nEjer;
          |GRABA 040#10n;
      |FINSI;
      |SI #10#2 > nEjer; #10#2 = nEjer; |FINSI;
      |SI #10#3 < nEjer; #10#3 = nEjer; |FINSI;
      |GRABA 040#10a;

      #1#0  = #30#2;
      #1#1  = nEjer;
      #1#2  = #30#3;
      |LEE 141#1=;
      |SI FSalida ! 0;
          |SI aParam = "LEGALIA";
              |DDEFECTO #1;
              #1#0  = #30#2;
              #1#1  = nEjer;
              #1#2  = #30#3;
              #1#3  = aPath;
              #1#4  = aMasNombre;
              #1#5  = #30#1;
              |HAZ CalFechas;
              #1#6  = fFecha1;
              #1#7  = fFecha2;
              #1#8  = fFecha3;
              |GRABA 040#1n;
          |FINSI;
          |ACABA;
      |FINSI;
      |SI aParam = "LEGALIA"; |Y #30#3 = #998#2;
          #1#3  = aPath;
          #1#4  = aMasNombre;
      |FINSI;
      |GRABA 040#1a;
|FPRC;

|DEFBUCLE LeoCanempre;
  #30#1;
  26;
  enDEmpresa, 0, enDEjer;
  enHEmpresa, 9, enHEjer;
  ;
  NULL, GrabaAuxiliares;
|FIN;

|PROCESO LeoSeleccion;
  enDEmpresa = #998#1; enDEjer = 15;
  enHEmpresa = #998#1; enHEjer = 79;

  |BUCLE LeoCanempre;
|FPRC;

|DEFBUCLE LeoSeleccion;
  #998#1;
  ;
  000001;
  999999;
  ;
  NULL, LeoSeleccion;
|FIN;

|| ////////////////////////////////////////////////////////////////

|PROCESO CalFechas;
   aMes   = ("00" + #30#11) % -102;
   aAny   = nEjer;
   aAlfa1 = "01." + aMes + "." + aAny; fFecha1 = aAlfa1;

   aMes  = ("00" + #30#12) % -102;
   |SI #30#11 > #30#12;
       nNume1 = nEjer + 1;
       aAny   = nNume1;
   |FINSI;
   aDia = "31";
   |SI #30#12 = 4; |O #30#12 = 6; |O #30#12 = 9; |O #30#12 = 11;
       aDia = "30";
   |FINSI;
   |SI #30#12 = 2;
       aDia = "28";
       |SI aAny = 2000; |O aAny = 2004; |O aAny = 2008;
          |O aAny = 2012; |O aAny = 2016; |O aAny = 2020;
            |O aAny = 2024; |O aAny = 2028; |O aAny = 2032;
          aDia = "29";
      |FINSI;
   |FINSI;
   aAlfa1 = aDia + "." + aMes + "." + aAny; fFecha2 = aAlfa1;
   nNume1  = fFecha1;
   nNume1 = nNume1 - 1;
   fFecha3 = nNume1;
|FPRC;
|| ////////////////////////////////////////////////////////////////

|RUTINA ClaveBajaZ;
 #10#0 = 00001;
|FRUT;

|RUTINA ClaveAltaZ;
 #10#0 = 99999;
|FRUT;

|PROGRAMA;

  aParam = PARAMETRO; |QBF aParam;

  aFichero = ("1z" + Usuario) % 108; |NOME_DAT #10 aFichero; |DELINDEX #10;

  |ABRE #11;
  |DDEFECTO #11;
  |LEE 141#11p;
  |CIERRA #11;
  aPath      = #11#1; |QBF aPath;
  aMasNombre = #11#9;
  |SI aPath = "";
      |HAZ BuscoDirectorio;
  |FINSI;

 |ABRE #1;
 |ABRE #10;
 |SI aParam = "";
     enDEmpresa = 00001; enDEjer = 15;
     enHEmpresa = 99999; enHEjer = 79;
     |BUCLE LeoCanempre;
 |SINO;
     |SI aParam = "CONTA";
         |HAZ inicio;
         enDEmpresa = enEmpresa; enDEjer = 15;
         enHEmpresa = enEmpresa; enHEjer = 79;
         |BUCLE LeoCanempre;
     |SINO;
         |NOME_DAT #998 eaFichsel;
         |BUCLE LeoSeleccion;
     |FINSI;
 |FINSI;
 |CIERRA #10;
 |CIERRA #1;

 |CLS;
 |CABEZA "Historico Legalizacion";
 |PINPA #0#10;

 |SI aParam = "CONTA";

     |BLIN 5;
     |BLIN 6;
     |ATRI R; |PINTA 0602, "Datos Legalizacion de Libros"; |ATRI 0;
     aAlfa1 = "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커";
     |PINTA 0701, aAlfa1;
     |ATRI I; |PINTA 0902, "Empresa:"; |ATRI 0;
              |PINTA 0959, "Nif:";
     |C_P #10#0, 1, 0911;
     |C_P #10#1, 1, 0917;
     |C_P #10#4, 1, 0964;
     |ABRE #10;
     |LEE 041#10p;
     |PINDA #0#10;
     |HAZ Tipo7z;
     enEmpresa   = #10#0;
     |ENTLINEAL #1#1, -2, 4, 22, 0, ClaveBajaW, ClaveAltaW;
     |CIERRA #10;
 |SINO;
     |ENTLINEAL #1#casopliz, -1, 4, 10, 0, ClaveBajaZ, ClaveAltaZ;
 |FINSI;

 |DELINDEX #10;
|FPRO;
