/*
|PROCESO VentImporta;
     |VENTANA 0501, 0540, -1, 16, "Procesando datos, espere por favor";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |HAZ Importacion;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO Ubica;
     nFSalida = FSalida;

     aRuta    = "F*.csv";
     |BROWSE aRuta;

     aAlfa  = aRuta;   |QBF aAlfa;
     aRuta = "";
     aLong  = aAlfa % 0;
     nLong  = aLong;
     |PARA nCarac = 2;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos  = (nCarac * 100) + 1;
           aRuta = aRuta + (aAlfa % nPos);
     |SIGUE;

     |SI aRuta = "";
         |ACABA;
     |FINSI;

     aAlfa = (aRuta % -103) < "";
     |SI aAlfa ! "csv";
         |MENAV "0000Fichero no v lido. Debe tener extensi¢n CSV";
         |ACABA;
     |FINSI;

     |SI nFSalida = nBtnCar1;
         #dscsvw01#0 = aRuta;  |PINTA #dscsvw01#0;
     |FINSI;

     |SI nFSalida = nBtnCar2;
         #dscsvw01#1 = aRuta;  |PINTA #dscsvw01#1;
     |FINSI;
|FPRC;

|PROCESO Importar;
     |VENTANA 0501, 3799, -1, 16, "Introduzca la ubicaci¢n de los CSV";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dscsvw01;

     |PINPA #0#dscsvw01;  nPanta = FSalida;
     |PINDA #0#dscsvw01;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}",  785,  787, Ubica; nBtnCar1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 1085, 1087, Ubica; nBtnCar2 = FSalida;

     FSalida = "::{{230}}Continuar";
     |LEETECLA aTecla;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     aAlfa = #dscsvw01#0 + #dscsvw01#1;  |QBF aAlfa;
     |SI aAlfa ! "";
         |CONFI "0000SVamos a proceder a la importaci¢n de los datos. Est  seguro";
         |SI FSalida = 0;
             |HAZ VentImporta;
         |SINO;
             |MENAV "0000Proceso cancelado.";
         |FINSI;
     |SINO;
         |MENAV "0000Proceso cancelado.";
     |FINSI;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO GrabaCampo;
     |DDEFECTO #dscsvm02;
     #dscsvm02#0 = #dscsvm01#0;
     #dscsvm02#1 = aTabla;
     #dscsvm02#2 = nCampo;
     #dscsvm02#3 = aDescri;
     #dscsvm02#4 = "";

     |GRABA 020#dscsvm02.n;
     |LIBERA #dscsvm02;
|FPRC;

|PROCESO CogeCacuenta;
     aTabla = "cacuenta";

     nCampo  = 0; aDescri = "Cuenta contable";  |HAZ GrabaCampo;
     nCampo  = 2; aDescri = "Descripci¢n";      |HAZ GrabaCampo;
|FPRC;

|PROCESO CogeCamaasil;
     aTabla = "camaasil";

     nCampo  = 0;  aDescri = "Diario";                                    |HAZ GrabaCampo;
     nCampo  = 1;  aDescri = "Fecha";                                     |HAZ GrabaCampo;
     nCampo  = 2;  aDescri = "Documento";                                 |HAZ GrabaCampo;
     nCampo  = 3;  aDescri = "Apunte";                                    |HAZ GrabaCampo;
     nCampo  = 4;  aDescri = "Cuenta apunte";                             |HAZ GrabaCampo;
     nCampo  = 6;  aDescri = "Concepto";                                  |HAZ GrabaCampo;
     nCampo  = 7;  aDescri = "Descripci¢n concepto";                      |HAZ GrabaCampo;
     nCampo  = 8;  aDescri = "Signo Debe/Haber";                          |HAZ GrabaCampo;
     nCampo  = 9;  aDescri = "Importe";                                   |HAZ GrabaCampo;
     nCampo  = 12; aDescri = "Soportado/Repercutido/Cobro/Pago";          |HAZ GrabaCampo;
     nCampo  = 13; aDescri = "Libro";                                     |HAZ GrabaCampo;
     nCampo  = 14; aDescri = "N£mero de factura o N£mero de orden";       |HAZ GrabaCampo;
     nCampo  = 15; aDescri = "Serie";                                     |HAZ GrabaCampo;
     nCampo  = 19; aDescri = "Tipo acumulador: F/B/I/R/P/D";              |HAZ GrabaCampo;
     nCampo  = 20; aDescri = "N£mero acumulador IVA";                     |HAZ GrabaCampo;
     nCampo  = 21; aDescri = "Departamento/Actividad";                    |HAZ GrabaCampo;
     nCampo  = 22; aDescri = "N£mero de recibo";                          |HAZ GrabaCampo;
     nCampo  = 23; aDescri = "Exportado";                                 |HAZ GrabaCampo;
     nCampo  = 24; aDescri = "Registro";                                  |HAZ GrabaCampo;
     nCampo  = 25; aDescri = "Borrador";                                  |HAZ GrabaCampo;
     nCampo  = 26; aDescri = "Referencia";                                |HAZ GrabaCampo;
     nCampo  = 28; aDescri = "Subdepartamento";                           |HAZ GrabaCampo;
     nCampo  = 29; aDescri = "Cuenta anal¡tica";                          |HAZ GrabaCampo;
     nCampo  = 30; aDescri = "Fecha l¡nea";                               |HAZ GrabaCampo;
|FPRC;

|PROCESO AltaCampos;
     |HAZ CogeCacuenta;
     |HAZ CogeCamaasil;
|FPRC;

|PROCESO PideDescri;
     |VENTANA 0501, 0763, -1, 16, "Introduzca la descripci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     E_inf = "";
     E_sup = "60";
     aDescri = 0602 ? 1;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO Evnt1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dscsvm01.=;

         |ESTADO_CONTROL nBtnBor, "ENABLE";

         |REFRESCACONTROL nGrid2;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#dscsvm01.=;
         |SI FSalida = 0;
             aDescri = #dscsvm01#1;
             |HAZ PideDescri;

             #dscsvm01#1 = aDescri;
             |GRABA 020#dscsvm01.a;
             |LIBERA #dscsvm01;

             |REFRESCACONTROL nGrid1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EvntTree;
     |SI FEntrada ! 0;  |ACABA;  |FINSI;

     aAlfa = Contenido;  |QBF aAlfa;
     aAlfa = aAlfa % -101;
     |SI aAlfa = ":";  |ACABA;  |FINSI;

     aTablaTree = Contenido % -108;

     |SI aTablaTree = "        ";  |O aTablaTree = "";
         |ACABA;
     |FINSI;

     |REFRESCACONTROL nGrid2;
|FPRC;

|PROCESO SacaNumero;
     nColum = 0;
     |QBF aDescri;

     |SI aDescri = ""; |ACABA;  |FINSI;

     aDescri = aDescri > "";
     aLong   = aDescri % 0;
     nLong   = aLong;

     aCadena = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
     |SI nLong = 1;
         aAlfa  = aCadena - aDescri;
         aAlfa  = FSalida - "01";
         nColum = aAlfa;
     |FINSI;

     |SI nLong = 2;
         aAlfa  = aDescri % 101;
         aAlfa  = aCadena - aAlfa;
         aAlfa  = FSalida - "01";
         nNume1 = aAlfa;

         aAlfa  = aDescri % 201;
         aAlfa  = aCadena - aAlfa;
         aAlfa  = FSalida - "01";
         nNume2 = aAlfa;

         nColum = (nNume1 * 26) + nNume2;
     |FINSI;

     |SI nColum > 254;
         |MENAV "0000Fuera de rango. V lido hasta el IT";
         aDescri = "";
         nColum  = 0;
     |FINSI;
|FPRC;

|PROCESO PideColumna;
     |VENTANA 0501, 0725, -1, 16, "Introduzca la columna en el CSV";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     E_inf = "";
     E_sup = "2";
     aDescri = 0612 ? 1;

     |HAZ SacaNumero;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO Evnt2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dscsvm02.=;

         |ESTADO_CONTROL nBtnImp, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#dscsvm02.=;
         |SI FSalida = 0;
             aDescri = #dscsvm02#4;
             |HAZ PideColumna;

             #dscsvm02#4 = aDescri;
             #dscsvm02#5 = nColum;
             |GRABA 020#dscsvm02.a;
             |LIBERA #dscsvm02;

             |REFRESCACONTROL nGrid2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BtnNue;
     aDescri = "";
     |HAZ PideDescri;
     |SI aDescri = "";
         |FOCOTECLADO nGrid1;
         |ACABA;
     |FINSI;

     nIde = 1;
     |LEE 000#dscsvm01.u;
     |SI FSalida = 0;
         nIde = #dscsvm01#0 + 1;
     |FINSI;

     #dscsvm01#0 = nIde;
     #dscsvm01#1 = aDescri;
     |GRABA 020#dscsvm01.n;
     |LIBERA #dscsvm01;

     |HAZ AltaCampos;

     |REFRESCACONTROL nGrid1;
     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO dscsvm02Bor;
     |BORRA 020#dscsvm02.a;
     |LIBERA #dscsvm02;
|FPRC;

|DEFBUCLE dscsvm02Bor;
     #dscsvm02#1;
     ;
     #dscsvm01#0, "        ", 000;
     #dscsvm01#0, "zzzzzzzz", 999;
     be;
     NULL, dscsvm02Bor;
|FIN;

|PROCESO BtnBor;
     |LEE 000#dscsvm01.=;
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid1;
         |ACABA;
     |FINSI;

     |CONFI "0000NSeguro que quiere borrar la importaci¢n seleccionada";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid1;
         |ACABA;
     |FINSI;

     |LEE 101#dscsvm01.=;

     |BUCLE dscsvm02Bor;

     |BORRA 020#dscsvm01.a;
     |LIBERA #dscsvm01;

     |ESTADO_CONTROL nBtnBor, "DISABLE";
     |ESTADO_CONTROL nBtnImp, "DISABLE";
     |REFRESCACONTROL nGrid2;

     |REFRESCACONTROL nGrid1;
     |FOCOTECLADO nGrid1;
|FPRC;


|PROGRAMA;
     |VENTANA 0501, 3799, -1, 16, "Importaci¢n de datos ficheros CSV";
     n0Vent = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Importaciones", 0502, 0520, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}(Doble click cambia descripci¢n)", 0522, 0550, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Tablas", 1902, 1920, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}Campos", 1934, 1942, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{11}}(Doble click introduce columna)", 1944, 1970, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Nueva importaci¢n", 1780, 1798, BtnNue;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Borrar importaci¢n", 1760, 1778, BtnBor;
     nBtnBor = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{230}}Importar", 3580, 3598, Importar;
     nBtnImp = FSalida;

     |ESTADO_CONTROL nBtnBor, "DISABLE";
     |ESTADO_CONTROL nBtnImp, "DISABLE";

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dscsvm01, nRango, 0602, 1698, NULL, NULL, Evnt1;
     nGrid1 = FSalida;

     aAbre = aPathLocal + aFicTree;
     aAlfa = "TREECTRL,Tablas {{" + aAbre + "}}";
     |CONTROL_SIMPLE 0, aAlfa, 2002, 3430, EvntTree;
     nTree = FSalida;

     sT_nID   = nTree;
     sT_nOper = 2;
     sT_aData = "1:";
     |ESPECIFICA "COMMANDCONTROL", sTree;

     |LINEAL_SIMPLE #1#dscsvm02, nRango, 2034, 3498, Baja3, Alta3, Evnt3;
     nGrid2 = FSalida;


     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid1;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FINVENTANA n0Vent;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRO;

|PROCESO CargaArbol;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GrabaArbol;
     |HAZ LeeUnidadBasico;

     |DBASE aBase;  |QBF aBase;
     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\tmp";              |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\";

     aFicTree = "dscsvz0101" + Usuario + ".txt";

     aAbre = aPathLocal + aFicTree;
     |XABRE "WBC", aAbre, nHandle;

     aAlfa   = "1:Cuentas contables {{cacuenta}}";      |HAZ CargaArbol;
     aAlfa   = "2:Movimientos contables {{camaasil}}";  |HAZ CargaArbol;

     |XCIERRA nHandle;
|FPRC;
*/
