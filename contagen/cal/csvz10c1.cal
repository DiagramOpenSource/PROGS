|FICHEROS;
|FIN;

|VARIABLES;
     nErrorTrae      = 0;
     nErrorCopia     = 0;

     aAlfa           = "";
     aPath           = "";
     aPathPDF        = "";
     aPathLocal      = "";
     aDocumentoPDF   = "";
     aOrigen         = "";
     aDestino        = "";
     aMensaje        = "";
     aAbreExte       = "";
     aEjecuta        = "";
     aPathPlugins    = "";
     aBinario        = "";

     {1}aConte       = "";
     aVer1           = "";
     aVer2           = "";


     &eaBinarioConve = "";
     &eaUnidadBasico = "";
     &eaNombrePDF    = "";
     &eaIP           = "";
     &eaNombreDatos  = "";
     &eaFicheroDatos = "";
|FIN;

|PROCESO MuestraPDF;
     eaBinarioConve = "dsabreextension.exe";
     |HAZ TraeteBinario;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\contagen\";        |RMKDIR aPathLocal;

     |DBASE aPath;
     |QBF aPath;

     aPathPDF = aPath + "pdfs/";
     aDocumentoPDF = aPathPDF + eaNombrePDF + ".pdf";

     aOrigen = aDocumentoPDF;
     aDestino = aPathLocal + eaNombrePDF + ".pdf";

     |HAZ EnviaConMD5;

     |SI nErrorTrae = 1;
          aMensaje = "0000No encuentro el pdf con las instrucciones <" + eaNombrePDF + ".pdf>";
          |MENAV aMensaje;;
          |ACABA;
     |FINSI;

     aAbreExte = "cmd " + &34 + "/c START /WAIT " + aPathLocal + eaBinarioConve + " " + aDestino + &34;

     aEjecuta = aAbreExte;
     |RSYSTEM aEjecuta;
|FPRC;

|PROCESO EnviaConMD5;
     nErrorTrae = 0;

     aVer1   = "";
     aVer2   = "";
     aConte  = aOrigen;
     |ESPECIFICA "MD5", aConte;
     aVer1 = FSalida;

     aConte  = aDestino;
     |ESPECIFICA "REMOTOMD5", aConte;
     aVer2 = FSalida;

     |SI aVer1 ! aVer2;
         |SI eaIP = "";
             |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
             |ENVIA_FICHERO aOrigen, aDestino;
         |FINSI;

         aAlfa = aDestino;
         |XABRE "EC", aAlfa, 0;
         |SI FSalida < 0;
              nErrorTrae = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorraFicheroDestino;
     |QBF eaNombreDatos;
     |SI eaNombreDatos ! "";
          aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
          aPathLocal = aPathLocal + "\contagen\";        |RMKDIR aPathLocal;

          aDestino = aPathLocal + eaNombreDatos;
          |FBORRA aDestino;
     |FINSI;
|FPRC;

|PROCESO CopiaFicheroDatos;
     |QBF eaFicheroDatos;
     |SI eaFicheroDatos = "";
          aMensaje = "0000Error en el proceso CopiaFicheroDatos";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\contagen\";        |RMKDIR aPathLocal;

     aOrigen = eaFicheroDatos;
     aDestino = aPathLocal + eaNombreDatos;

     nErrorCopia = 0;

     |RCOPIA_FICHERO aOrigen, aDestino;

     aAlfa = aDestino;
     |XABRE "EC", aAlfa, 0;
     |SI FSalida < 0;
          nErrorCopia = 1;
     |FINSI;

     |SI nErrorCopia = 1;
          aMensaje = "0000Error al trasferir " + eaFicheroDatos;
          |MENAV aMensaje;;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO TraeteBinario;
     |QBF eaBinarioConve;
     |SI eaBinarioConve = "";
          aMensaje = "0000Error en el proceso TraeteBinario";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     aPathLocal = eaUnidadBasico + "\documentos";   |RMKDIR aPathLocal;
     aPathLocal = aPathLocal + "\contagen\";        |RMKDIR aPathLocal;

     |DBASE aPath;
     |QBF aPath;

     aPathPlugins = aPath + "plugin/";
     aBinario = aPathPlugins + eaBinarioConve;

     aOrigen = aBinario;
     aDestino = aPathLocal + eaBinarioConve;

     |HAZ EnviaConMD5;

     |SI nErrorTrae = 1;
          aMensaje = "0000Error al trasferir el fichero <" + eaBinarioConve + ">";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;
|FPRC;
