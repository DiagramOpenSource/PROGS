|FICHEROS;
   cacreano #0;
   cacuenta #1;

   camaasic #2;
   camaasil #3;
   camaniva #4;
   cacuebal #5;

   cacreanf #23;  ||ficheros de la seleccion

   :/modelos/def/dsmom035 #6;
   :/modelos/def/dsmom036 #7;
   canempre #30;
   ca8m0002 #422;
   ca8cumay #410;
|FIN;

|VARIABLES;
   aParam    = "";
   aAlfa1    = "";
   aAlfa2    = "";
   fich      = "";
   temporal1 = "";
   temporal2 = "";
   juan = 0;
   mensa = "";
   lon = 0;
   prim = 0;
   a = 0;
   b = 0;
   c = 0;
   mesac = 0;
   mesfec = 0;
   mes = "";
   fecalf = "";
   ini = 0;
   errant = "aaaaaaaaaaaa";
   cuant = "";
   iniemp = 0;
   traba = "";
   aar = "";
   aa = 0;
   sw_con = 0;
   x = 0;
   y = 0;
   fFecha = @;

   &eaFicbal = "";
   &enDSel1  = 0;  || Diario
   &enHSel1  = 0;
   &efDSel2  = @;  || fecha
   &efHSel2  = @;
   &enDSel3  = 0;  || documento
   &enHSel3  = 0;
   &enDSel4  = 0;  || asiento
   &enHSel4  = 0;
   &eaDSel5  = ""; || cuenta
   &eaHSel5  = "";
   &enDSel6  = 0;  || concepto
   &enHSel6  = 0;
   &eaDSel7  = ""; || departamento
   &eaHSel7  = "";
   &eaDSel8  = ""; || subdepartamento
   &eaHSel8  = "";
   &enDSel9  = 0;  || libro
   &enHSel9  = 0;
   &eaDSel10 = "     "; || serie
   &eaHSel10 = "     ";
   &enDSel11 = 0;  || periodo
   &enHSel11 = 0;
   &efDSel12 = @;  || fecha factura
   &efHSel12 = @;
   &enNRatio = 0;

   aDCuenta  = "";
   aHCuenta  = "";
   fFecFra   = @;
   nPerIVA   = 0;
   nTecla    = 0;
   nExiste   = 0;
   nCambio   = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE defec1_i;

|| ----------------------------------------------
|PROCESO alentrar;
   |HAZ inicio;
   |HAZ Analitica;
   |SI  enSwAna = 1;
        |SUB_EJECUTA_NP "anz00006";
        |PTEC 807;
   |FINSI;
   |HAZ DirAplicSt;
|FPRC;

|| -------------- Seleccion Pantalla
|PROCESO Tecla; |TIPO 0;
     nTecla = FSalida;
     |SI nTecla = 0;
          |ABRE #23;
          |DDEFECTO #23;
          #23#50 = #0#50;
          |LEE 000#23=;
          nExiste = FSalida;
          |SI nExiste ! 0;
              #23#2 = fec1;
              #23#3 = fec2;
          |FINSI;
          |PARA x = 0; |SI x [ 51; |HACIENDO x = x + 1;
               #0x = #23x;
               |PINTA #0x;
          |SIGUE;

          |CIERRA #23;
     |FINSI;

     |SI nTecla = 13; |O nTecla = 14;
          |ABRE #23;
          #23#50 = #0#50;
          |LEE 000#23];
          |CONSULTA_CLAVE #1#23;
          |SI FSalida = 0;
               ||SI nTecla = 13;
                    |PARA x = 0; |SI x [ 51; |HACIENDO x = x + 1;
                         #0x = #23x;
                         |PINTA #0x;
                    |SIGUE;
               ||FINSI;

               |SI nTecla = 14;
                    |CONFI "0000NBorrar Seleccion Fichero:";
                    |SI FSalida = 0;
                         |BORRA 020#23c;
                    |FINSI;
                    |ERROR;
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

|PROCESO Tipo66; |TIPO 66;
     FSalida = 13;
     |HAZ Tecla;
|FPRC;

|PROCESO fechas;
   |SI #0Campo > fec2;|O #0Campo < fec1;
      |MENAV "    Fecha fuera de Periodo ...";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO no_dep; |TIPO 7;
   |C_M #0#8, 1, eaDepar;
   |C_M #0#9, 1, eaDepar;

   |C_M #0#28, 1, eaDepar;
   |C_M #0#29, 1, eaDepar;
   |C_M #0#30, 1, eaDepar;
   |C_M #0#31, 1, eaDepar;
   |C_M #0#32, 1, eaDepar;
   |C_M #0#33, 1, eaDepar;
   |C_M #0#34, 1, eaDepar;
   |C_M #0#35, 1, eaDepar;
   |C_M #0#36, 1, eaDepar;
   |C_M #0#37, 1, eaDepar;
   |C_M #0#38, 1, eaDepar;
|FPRC;

|CALCULO AntesDepar; |TIPO 7;
   |C_M #0Campo, 0, aAlfa1;

   |SI aAlfa1 = "S"
      |SI Haybasica = 1;
          |MENSA "    <F2> Consultar Actividades";
      |SINO;
          |MENSA "    <F2> Consultar Departamentos";
      |FINSI;
   |FINSI;
|FCAL;

|PROCESO QueDepar; |TIPO 0;
  |C_M #0#28,0, aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  aAlfa1 = "S"; aAlfa2 = "N"; |SI #0#28 = "D"; aAlfa1 = "N"; aAlfa2 = "S"; |FINSI;

  |C_M #0#8,  1, aAlfa2; |C_M #0#9,  1, aAlfa2;
  |C_M #0#29, 1, aAlfa1; |C_M #0#30, 1, aAlfa1;
  |C_M #0#31, 1, aAlfa1; |C_M #0#32, 1, aAlfa1;
  |C_M #0#33, 1, aAlfa1; |C_M #0#34, 1, aAlfa1;
  |C_M #0#35, 1, aAlfa1; |C_M #0#36, 1, aAlfa1;
  |C_M #0#37, 1, aAlfa1; |C_M #0#38, 1, aAlfa1;
  |SI aAlfa1 = "S";
      #0#8 = "  "; |PINTA #0#8;
      #0#9 = "zz"; |PINTA #0#9;
  |SINO;
      |PDEFECTO #0, 29, 39;
      |PINTA #0#29; |PINTA #0#30;
      |PINTA #0#31; |PINTA #0#32;
      |PINTA #0#33; |PINTA #0#34;
      |PINTA #0#35; |PINTA #0#36;
      |PINTA #0#37; |PINTA #0#38;
  |FINSI;
|FPRC;

|CALCULO TrasDepar; |TIPO 0;
   |C_M #0Campo, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   eOpDep = 0;         ||  1 = Consulta pantalla
   |SI FSalida = 10;
       eOpDep = 1;
       enActividad = #0Campo;
       eaCodDep    = #0Campo;
       |HAZ Actividad;
   |FINSI;
|FCAL;

|PROCESO nosubde; |TIPO 7;
   |C_M #0#15, 1, eaSubde;
   |C_M #0#16, 1, eaSubde;

   |C_M #0#39, 1, eaSubde;
   |C_M #0#40, 1, eaSubde;
   |C_M #0#41, 1, eaSubde;
   |C_M #0#42, 1, eaSubde;
   |C_M #0#43, 1, eaSubde;
   |C_M #0#44, 1, eaSubde;
   |C_M #0#45, 1, eaSubde;
   |C_M #0#46, 1, eaSubde;
   |C_M #0#47, 1, eaSubde;
   |C_M #0#48, 1, eaSubde;
   |C_M #0#49, 1, eaSubde;
|FPRC;

|CALCULO AntesSubde; |TIPO 7;
|FCAL;

|PROCESO QueSubdepar; |TIPO 0;
  |C_M #0#39,0, aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  aAlfa1 = "S"; aAlfa2 = "N"; |SI #0#39 = "D"; aAlfa1 = "N"; aAlfa2 = "S"; |FINSI;

  |C_M #0#15, 1, aAlfa2; |C_M #0#16, 1, aAlfa2;
  |C_M #0#40, 1, aAlfa1; |C_M #0#41, 1, aAlfa1;
  |C_M #0#42, 1, aAlfa1; |C_M #0#43, 1, aAlfa1;
  |C_M #0#44, 1, aAlfa1; |C_M #0#45, 1, aAlfa1;
  |C_M #0#46, 1, aAlfa1; |C_M #0#47, 1, aAlfa1;
  |C_M #0#48, 1, aAlfa1; |C_M #0#49, 1, aAlfa1;
  |SI aAlfa1 = "S";
      #0#15 = "   "; |PINTA #0#15;
      #0#16 = "zzz"; |PINTA #0#16;
  |SINO;
      |PDEFECTO #0, 40, 50;
      |PINTA #0#40; |PINTA #0#41;
      |PINTA #0#42; |PINTA #0#43;
      |PINTA #0#44; |PINTA #0#45;
      |PINTA #0#46; |PINTA #0#47;
      |PINTA #0#48; |PINTA #0#49;
  |FINSI;
|FPRC;

|CALCULO TrasSubde; |TIPO 0;
   |C_M #0Campo, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10;
       eOpSub = 1;
       enActividad = #0#8; |SI #0#28 = "P"; enActividad = #0#29; |FINSI;
       enConcepto  = 600;
       eaCodSubdep = #0Campo;
       enQue = 2;
       |HAZ SubActividad;
       enQue = 0;
  |FINSI;
|FCAL;

|PROCESO selecci2; |TIPO 0;
   |C_M #0#06, 1, "N"; |C_M #0#07, 1, "N";

   |C_M #0#11, 1, "N"; |C_M #0#12, 1, "N";
   |C_M #0#13, 1, "N"; |C_M #0#14, 1, "N";

   |C_M #0#18, 1, "N"; |C_M #0#19, 1, "N";
   |C_M #0#20, 1, "N"; |C_M #0#21, 1, "N";
   |C_M #0#22, 1, "N"; |C_M #0#23, 1, "N";
   |C_M #0#24, 1, "N"; |C_M #0#25, 1, "N";
   |C_M #0#26, 1, "N"; |C_M #0#27, 1, "N";

   |SI #0#10 = "G";
       #0#6  = 1;   |PINTA #0#6;
       #0#7  = 999; |PINTA #0#7;
       #0#18 = 0;   |PINTA #0#18;
       #0#19 = 0;   |PINTA #0#19;
       #0#20 = 0;   |PINTA #0#20;
       #0#21 = 0;   |PINTA #0#21;
       #0#22 = 0;   |PINTA #0#22;
       #0#23 = 0;   |PINTA #0#23;
       #0#24 = 0;   |PINTA #0#24;
       #0#25 = 0;   |PINTA #0#25;
       #0#26 = 0;   |PINTA #0#26;
       #0#27 = 0;   |PINTA #0#27;

       |C_M #0#11, 1, "S";
       |C_M #0#12, 1, "S";
       |C_M #0#13, 1, "S";
       |C_M #0#14, 1, "S";
   |FINSI;

   |SI #0#10 = "D";
       #0#11 = 0;   |PINTA #0#11;
       #0#12 = 0;   |PINTA #0#12;
       #0#13 = 0;   |PINTA #0#13;
       #0#14 = 0;   |PINTA #0#14;

       #0#18 = 0;   |PINTA #0#18;
       #0#19 = 0;   |PINTA #0#19;
       #0#20 = 0;   |PINTA #0#20;
       #0#21 = 0;   |PINTA #0#21;
       #0#22 = 0;   |PINTA #0#22;
       #0#23 = 0;   |PINTA #0#23;
       #0#24 = 0;   |PINTA #0#24;
       #0#25 = 0;   |PINTA #0#25;
       #0#26 = 0;   |PINTA #0#26;
       #0#27 = 0;   |PINTA #0#27;

       |C_M #0#06, 1, "S";
       |C_M #0#07, 1, "S";
   |FINSI;

   |SI #0#10 = "P";
       #0#6  = 1;   |PINTA #0#6;
       #0#7  = 999; |PINTA #0#7;

       #0#11 = 0;   |PINTA #0#11;
       #0#12 = 0;   |PINTA #0#12;
       #0#13 = 0;   |PINTA #0#13;
       #0#14 = 0;   |PINTA #0#14;

       |C_M #0#18, 1, "S";
       |C_M #0#19, 1, "S";
       |C_M #0#20, 1, "S";
       |C_M #0#21, 1, "S";
       |C_M #0#22, 1, "S";
       |C_M #0#23, 1, "S";
       |C_M #0#24, 1, "S";
       |C_M #0#25, 1, "S";
       |C_M #0#26, 1, "S";
       |C_M #0#27, 1, "S";
   |FINSI;
|FPRC;

|PROCESO leegrupo; |TIPO 0;
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI FSalida = 10;
       |ABRE #6;
       #6#0 = #0Campo;
       |CONSULTA_CLAVE #1#6;
       |CIERRA #6;
       #0Campo = #6#0; |PINTA #0Campo;
   |FINSI;

   |SI #0Campo = 0; |ACABA; |FINSI;

   |ABRE #6;
   #6#0 = #0Campo;
   |LEE 001#6=;
   |SI FSalida ! 0;
      |MENAV "    NO existe el Grupo de Conceptos";
      |ERROR;
   |FINSI;
   |CIERRA #6;
|FPRC;

|| ////////////////////////////////////////////////////////////////////////
|| ////////////////////////////////////////////////////////////////////////

|PROCESO acumulados;
   |PDEFECTO #1,9,54;
   |GRABA 020#1a;
   |LIBERA #1;
|FPRC;

|DEFBUCLE cacreano0;     || acera las cuentas
   #1#1;
   ;
   "            ";
   "999999999999";
   be;
   NULL, acumulados;
|FIN;
|| ////////////////////////////////////////////////////////////////////////

|PROCESO conceptos;

   |SI #0#10 = "D"; |ACABA; |FINSI;
   sw_con = 0;
   |SI #0#10 = "G";    ||Grupos
      |PARA y = 11; |SI y [ 14; |HACIENDO y = y + 1;
         |SI #0y ! 0;
             #dsmom036#0 = #0y;
             #dsmom036#1 = #3#6;
             |LEE 001#7=;
             |SI FSalida = 0;
                 sw_con = 1;
             |FINSI;
         |FINSI;
         |SI sw_con = 1; |SAL; |FINSI;
      |SIGUE;
   |FINSI;

   |SI #0#10 = "P";    || Parrilla de conceptos
      |PARA y = 18; |SI y [ 27; |HACIENDO y = y + 1;
           |SI #0y ! 0; |Y #0y = #3#6;
               sw_con = 1;
              |SAL;
           |FINSI;
      |SIGUE;
   |FINSI;
|FPRC;

|PROCESO Departamentos;
   |SI #0#28 = "D"; |ACABA; |FINSI;
   sw_con = 0;
   |PARA y = 29; |SI y [ 38; |HACIENDO y = y + 1;
         |SI #0y ! "  "; |Y #0y = #3#21;
             sw_con = 1;
             |SAL;
         |FINSI;
   |SIGUE;
|FPRC;

|PROCESO Subdepartamentos;
   |SI #0#39 = "D"; |ACABA; |FINSI;
   sw_con = 0;
   |PARA y = 40; |SI y [ 49; |HACIENDO y = y + 1;
         |SI #0y ! "   "; |Y #0y = #3#28;
             sw_con = 1;
             |SAL;
         |FINSI;
   |SIGUE;
|FPRC;

|| //////////////////////////////////////
|PROCESO OtraSeleccion; || Seleccion Cuadro de Mandos
      sw_con = 1;

      |ABRE #2;
      |DDEFECTO #2;
      #2#0 = #3#0;
      #2#1 = #3#1;
      #2#2 = #3#2;
      |LEE 001#2=;
      |CIERRA #2;

      |SI #2#3 < enDSel4; |O #2#3 > enHSel4;
          sw_con = 0;
          |ACABA;
      |FINSI;

      |SI #3#13 < enDSel9; |O #3#13 > enHSel9;
          sw_con = 0;
          |ACABA;
      |FINSI;

      |SI #3#15 < eaDSel10; |O #3#15 > eaHSel10;
          sw_con = 0;
          |ACABA;
      |FINSI;

      |SI #3#13 ! 0;
          fFecFra = "01.01.0000";
          nPerIVA = 0;
          |ABRE #4;
          |SELECT #3#4;
          #4#0 = #3#13;
          #4#2 = #3#15;
          #4#3 = #3#14;
          |LEE 001#4=;
          |SI FSalida = 0;
              fFecFra = #4#4;
              nPerIVA = #4#5;
          |FINSI;
          |SELECT #1#4;
          |CIERRA #4;
          |SI nPerIVA < enDSel11; |O nPerIVA > enHSel11;
              sw_con = 0;
              |ACABA;
          |FINSI;
          |SI fFecFra > "01.01.0000";
              |SI fFecFra < efDSel12; |O fFecFra > efHSel12;
                  sw_con = 0;
                  |ACABA;
              |FINSI;
          |FINSI;
      |FINSI;
|FPRC;
|| ////////////////////////////////////////////////////////////////////////

|PROCESO actuali;
   sw_con = 1;
   |HAZ conceptos;
   |SI sw_con = 0; |ACABA; |FINSI;

   sw_con = 1;
   |HAZ Departamentos;
   |SI sw_con = 0; |ACABA; |FINSI;

   sw_con = 1;
   |HAZ Subdepartamentos;
   |SI sw_con = 0; |ACABA; |FINSI;

   |SI aParam ! "";
       |HAZ OtraSeleccion;
       |SI sw_con = 0; |ACABA; |FINSI;
   |FINSI;

   aa = 100 + lon;
   aar = aa;
   traba = #camaasil#4 % aar;            || coge cuenta
   iniemp = 0;
   |PARA; |SI iniemp = 0; |HACIENDO;
      iniemp = 1;
      |SI prim = 0;
         cuant = traba;
         prim = 1;
         #cacuenta#0 = cuant;
         #cacuenta#1 = juan;
         |SI #cacuenta#0 = errant;
            prim = 0;
            |ACABA;
         |FINSI;
         |LIBERA #1;
         |LEE 101#1=;
         |SI FSalida ! 0;
            |LIBERA #1;
            |DDEFECTO #1;
            #cacuenta#0 = cuant;
            #cacuenta#1 = juan;
            |HAZ defect1;
            |PUSHV 0501 1980;
            |PINPA #0#1;
            |PINDA #0#1;
            |ENDATOS #1#1;
            |SI FSalida ! 0;
               |POPV;
               mensa = "Recuperando nivel: " + juan + "               ";
               |SI aParam = ""; |PINTA 2410,mensa; |FINSI;
               errant = #cacuenta#0;
               prim = 0;
               |ACABA;
            |FINSI;
            |GRABA 020#1b;
            |POPV;
            mensa = "Recuperando nivel: " + juan + "               ";
            |SI aParam = ""; |PINTA 2410,mensa; |FINSI;
         |FINSI;
      |FINSI;
      |SI cuant ! traba;
         |GRABA 020#1a;
         prim = 0;
         iniemp = 0;
      |FINSI;
   |SIGUE;
   |HAZ suma;

   |LIBERA #3;
|FPRC;

|DEFBUCLE cacreano1;
   #3#3;
   0,6,21,28,5;
   aDCuenta, #0#2, #0#4, 0001, #0#0, #0#6, #0#8, #0#15, juan;
   aHCuenta, #0#3, #0#5, 9999, #0#1, #0#7, #0#9, #0#16,    9;
   e;
   NULL, actuali;
|FIN;

|PROCESO copiando;
   |DFICE fich;
   temporal1 = fich + "cacuenta.ixx";
   temporal2 = fich + eaFicbal + ".ixx";
   |COPIA_FICHERO temporal1,temporal2;
   |SI FSalida ! 0;  |ACABA;  |FINSI;
   temporal1 = fich + "cacuenta.dat";
   temporal2 = fich + eaFicbal + ".dat";
   |COPIA_FICHERO temporal1,temporal2;
   |SI FSalida ! 0;
      temporal2 = fich + eaFicbal + ".ixx";
      |FBORRA temporal2;
      |ACABA;
   |FINSI;
   temporal1 = fich + "cacuenta.ddx";
   temporal2 = fich + eaFicbal + ".ddx";
   |COPIA_FICHERO temporal1,temporal2;
|FPRC;

|PROCESO suma;
   |SI #camaasil#1 > #cacuenta#58;
      #cacuenta#58 = #camaasil#1;
   |FINSI;
   |SI #camaasil#0 ! 0;|Y #camaasil#0 ! 99;
      ini = dig1;
      fecalf = #camaasil#1;
      mes = fecalf % 402;
      mesfec = mes;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
         mesac = (13 - ini) + mesfec;
      |FINSI;
      a = (mesac * 3) + 9;
      b = a + 1;
      c = a + 2;
      |SI #camaasil#8 = "D";
         #cacuenta#a# = #cacuenta#a# + #camaasil#9;
         #cacuenta#51 = #cacuenta#51 + #camaasil#9;
         #cacuenta#c# = #cacuenta#a# - #cacuenta#b#;
         #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
         |ACABA;
      |FINSI;
      #cacuenta#b# = #cacuenta#b# + #camaasil#9;
      #cacuenta#52 = #cacuenta#52 + #camaasil#9;
      #cacuenta#c# = #cacuenta#a# - #cacuenta#b#;
      #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
      |ACABA;
   |FINSI;
   |SI #camaasil#0 = 0;
      |SI #camaasil#8 = "D";
         #cacuenta#9 = #cacuenta#9 + #camaasil#9;
         #cacuenta#51 = #cacuenta#51 + #camaasil#9;
         #cacuenta#11 = #cacuenta#9 - #cacuenta#10;
         #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
         |ACABA;
      |FINSI;
      #cacuenta#10 = #cacuenta#10 + #camaasil#9;
      #cacuenta#52 = #cacuenta#52 + #camaasil#9;
      #cacuenta#11 = #cacuenta#9 - #cacuenta#10;
      #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
      |ACABA;
   |FINSI;
   |SI #camaasil#8 = "D";
      #cacuenta#48 = #cacuenta#48 + #camaasil#9;
      #cacuenta#51 = #cacuenta#51 + #camaasil#9;
      #cacuenta#50 = #cacuenta#48 - #cacuenta#49;
      #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
      |ACABA;
   |FINSI;
   #cacuenta#49 = #cacuenta#49 + #camaasil#9;
   #cacuenta#52 = #cacuenta#52 + #camaasil#9;
   #cacuenta#50 = #cacuenta#48 - #cacuenta#49;
   #cacuenta#53 = #cacuenta#51 - #cacuenta#52;
|FPRC;
|| ////////////////////////////////////////////////////////////////////

|PROCESO alsalir;  |TIPO 3;

   |HAZ copiando;
   |NOME_DAT #1 eaFicbal;

   |SI aParam = ""; |PINTA 2410,"Poniendo a cero el Plan Contable"; |FINSI;
   |BUCLE cacreano0;

   aDCuenta = "            "; aHCuenta = "zzzzzzzzzzzz";
   |SI aParam ! "";
       aDCuenta = eaDSel5; aHCuenta = eaHSel5;
   |FINSI;

   |ABRE #1;
   |ABRE #2;
   |ABRE #7;
   |PARA juan = 1; |SI juan [ dig3; |HACIENDO juan = juan + 1;
         prim = 0;
         |SI juan = 1; lon = dig4; |FINSI;
         |SI juan = 2; lon = dig5; |FINSI;
         |SI juan = 3; lon = dig6; |FINSI;
         |SI juan = 4; lon = dig7; |FINSI;
         |SI juan = 5; lon = dig8; |FINSI;
         |SI juan = 6; lon = dig9; |FINSI;
         mensa = "Recuperando nivel: " + juan + "              ";
         |SI aParam = ""; |PINTA 2410,mensa; |FINSI;
         prim = 0;
         |BUCLE cacreano1;
         |SI prim = 1;
             |GRABA 020#1a;
         |FINSI;
   |SIGUE;
   |CIERRA #1;
   |CIERRA #2;
   |CIERRA #7;

   |SI aParam = "";
|| ... Proceso nuevo para grabar las selecciones de pantalla
     |ABRE #23;
     #23#50 = #0#50;
     |LEE 101#23=;
     nExiste = FSalida;
     |PARA x = 0; |SI x [ 51; |HACIENDO x = x + 1;
          |SI #23x ! #0x;
              nCambio = 1;
          |FINSI;
          #23x = #0x;
     |SIGUE;
     aAlfa1 = Usuario % 108;
     |SI #23#52 ! aAlfa1; nCambio = 1; |FINSI;
     fFecha = ~; #23#53 = fFecha;
     #23#54 = eaFicbal;

     |SI nCambio = 1;
         |CONFI "0000SGrabar Seleccion del Fichero:";
         |SI FSalida = 0;
              |SI nExiste = 0; |GRABA 020#23a; |FINSI;
              |SI nExiste ! 0; |GRABA 020#23n; |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #23;
  |FINSI;
|FPRC;

||*************************************************************************
|PROGRAMA;
 aParam = PARAMETRO; |QBF aParam;

 eaFicbal = "cabalano";
 |SI aParam = "";
     |HAZ alentrar;

     |CLS;
     |CABEZA "Creacion Bal. a Fechas";
     |ABRE #0;
     |LEE 041#0p;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#2 = fec1;
         #0#3 = fec2;
         |GRABA 020#0c;
     |SINO;
         |SI #0#10 = "S"; #0#10 = "G"; |FINSI;
         |SI #0#10 = "N"; #0#10 = "D"; |FINSI;
     |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
 |SINO;
      aAlfa1 = enNRatio; |QBF aAlfa1;
      aAlfa1 = ("0000" + aAlfa1) % -104;
      eaFicbal = "cacr" + aAlfa1;
      |DDEFECTO #0;
      #0#0 = enDSel1;
      #0#1 = enHSel1;
      #0#2 = efDSel2;
      #0#3 = efHSel2;
      #0#4 = enDSel3;
      #0#5 = enHSel3;
      #0#6 = enDSel6;
      #0#7 = enHSel6;
      #0#8 = eaDSel7;
      #0#9 = eaHSel7;
      #0#10 = "D";
      #0#11 = 0;
      #0#12 = 0;
      #0#13 = 0;
      #0#14 = 0;
      #0#15 = eaDSel8;
      #0#16 = eaHSel8;
      #0#28 = "D";
      #0#39 = "D";

      |HAZ alsalir;
  |FINSI;
|FPRO;
