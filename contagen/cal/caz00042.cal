|FICHEROS;
   caz00042 #0;

   canempre #30;
   caportad #12;
   :/basica/def/agicen14  #114;
|FIN;

|VARIABLES;
   nPara1   = 0;
   nNume    = 0;
   nNume1   = 0;
   nNume2   = 0;
   nNume3   = 0;
   nNume4   = 0;
   nPer     = 0;
   nEmp     = 0;
   nCampo   = 0;
   nInkey   = 0;
   aAlfa    = "";
   aAlfa1   = "";
   aAlfa2   = "";
   aAlfa3   = "";
   aMensa   = "";

   nSelError  = 0;
   nLaEmpresa = 0;
   traba      = "";
  &enEmpresaPINET = 0;
  &enErrorPINET   = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE datpor_i;
|| *******************************************************************
|PROCESO Antes; |TIPO 7;
   |HAZ DirAplicSt;
   |SI HayAcceso ! 1;
       |C_V #0#37, 1, "N";
       |C_M #0#37, 1, "N";
       #0#37 = "N";
       |PINTA 1801, "                                ";
   |FINSI;
|FPRC;


|PROCESO Select; |TIPO 0;
  |SI #0#0 = "S";
      |C_M #0#1,1,"S"; |C_M #0#2,1,"S";
      |C_M #0#3,1,"S"; |C_M #0#4,1,"S";
      |PARA nPara1 = 5; |SI nPara1 [ 32; |HACIENDO nPara1 = nPara1 + 3;
            nNume1 = nPara1 + 1;
            nNume2 = nPara1 + 2;
            |C_M #0nPara1,1,"N"; #0nPara1 = 0;  |PINTA #0nPara1;
            |C_M #0nNume1,1,"N"; #0nNume1 = 0;  |PINTA #0nNume1;
                                 #0nNume2 = ""; |PINTA #0nNume2;
      |SIGUE;
   |SINO;
      |C_M #0#1,1,"N"; #0#1 = 1; |PINTA #0#1;
      |C_M #0#2,1,"N"; #0#2 = 0; |PINTA #0#2;
      |C_M #0#3,1,"N"; #0#3 = 99999; |PINTA #0#3;
      |C_M #0#4,1,"N"; #0#4 = 9;     |PINTA #0#4;
      |PARA nPara1 = 5; |SI nPara1 [ 32; |HACIENDO nPara1 = nPara1 + 3;
            nNume1 = nPara1 + 1;
            |C_M #0nPara1,1,"S";
            |C_M #0nNume1,1,"S";
      |SIGUE;
   |FINSI;
|FPRC;

|CALCULO MiraEmpresa; |TIPO 0;
   nInkey = FSalida;
   |SI nInkey = 2; |ACABA; |FINSI;

   nCampo = Campo - 1;
   |SI #0nCampo = 0; |Y #0Campo = 0; |ACABA; |FINSI;

   |SI #0#0 = "N";
       nEmp = #0nCampo;
       nPer = #0Campo;
       |HAZ SeldeEmpresa;
       |SI nSelError ! 0;
           |MENAV aMensa;
           |ERROR;
           |ACABA;
       |FINSI;
       nCampo = Campo + 1;
       #0nCampo = #30#1;  |PINTA #0nCampo;
   |FINSI;
|FCAL;

|CALCULO NoMasEmp; |TIPO 0;
     |SI #0Campo = 0;
         nNume1   = Campo + 1;
         #0nNume1 = 0;  |C_M #0nNume1, 1, "N";
         |PARA nCampo = Campo + 3;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 3;
               nNume1 = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
               #0nNume1 = 0;  |C_M #0nNume1, 1, "N";
         |SIGUE;
     |SINO;
         nNume1   = Campo + 1;
         |C_M #0nNume1, 1, "S";
         |PARA nCampo = Campo + 3;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 3;
               nNume1 = nCampo + 1;
               |C_M #0nCampo, 1, "S";
               |C_M #0nNume1, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|PROCESO SeldeEmpresa;
   |ABRE #30;
   aMensa    = "";
   nSelError = 0;
   #30#2 = nEmp;
   #30#3 = nPer;
   |LEE 010#30=;
   |SI FSalida = 0;
       |SI #0#35 ! "T";
           |SI #30#21 ! #0#35;
               |SI #30#21 = "I";
                   aMensa = "    Empresa Inactiva";
               |SINO;
                   aMensa = "    Empresa Activa";
               |FINSI;
               nSelError = 1;
               |VETE Cierra;
           |FINSI;
       |FINSI;
   |SINO;
       nSelError  = 1;
       aMensa = "    No Existe Empresa ";
   |FINSI;

|ET Cierra;
   |CIERRA #30;
|FPRC;

|| ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
|PROCESO CreaPortada;
   |ABRE #caportad;
   |DDEFECTO #caportad;
   #caportad#0  = #30#2;             || Empresa
   #caportad#1  = #30#26;            || Ejercicio
   |LEE 101#caportad.=;
   |SI FSalida ! 0;
      |DDEFECTO #caportad;
      #caportad#0  = #30#2;             || Empresa
      #caportad#1  = #30#26;            || Ejercicio
      |GRABA 020#caportad.b;
   |FINSI;

  |SI HayAcceso = 0; |Y Haybasica = 0; ||No existe ni acceso ni basica
      |HAZ desdecontab;                ||Lee de Canempre
  |SINO;
      enCodCli = #caportad#0;
      |HAZ LeePersona;
      |SI ewClien = 0;
          |HAZ desdebasica;
      |SINO;
          |HAZ desdecontab;
      |FINSI;
      |HAZ AltaNif;
  |FINSI;
  |GRABA 020#caportad.a;
  |LIBERA #caportad;
  |CIERRA #caportad;
|FPRC;

|PROCESO PonTitulo;
     |SI Haybasica = 0;
         |SI #30#26 ] 80;
             nNume = 1900 + #30#26;
         |SINO;
             nNume = 2000 + #30#26;
         |FINSI;

         aAlfa1 = #30#1;     |QBF aAlfa1;
         aAlfa =  "[" + (("00000" + #30#2) % -105) + "/" + nNume + "] " + aAlfa1;;

     |SINO;

         |ABRE #114;
         #114#0 = #30#2;
         #114#1 = 1;
         |LEE 040#114];
         |SI FSalida ! 0;  |O #114#0 ! #30#2;
             |DDEFECTO #114;
         |FINSI;
         |CIERRA #114;

         |SI #30#26 ] 80;
             nNume = 1900 + #30#26;
         |SINO;
             nNume = 2000 + #30#26;
         |FINSI;

         aAlfa1 = #30#1;    |QBF aAlfa1;
         aAlfa2 = #114#8;   |QBF aAlfa2;
         aAlfa3 = #114#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #30#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;

     |FINSI;
     #30#29 = aAlfa;
|FPRC;

|PROCESO LasBorro0;

    enEmpresaPINET = #30#2;
    |HAZ RestriccionPINET;
    |SI enErrorPINET = 1;  |ACABA;  |FINSI;

   |SI #0#35 ! "T";
       |SI #30#21 ! #0#35;
           |ACABA;
       |FINSI;
   |FINSI;

   |ATRI P;
   |PINTA 2203, "Regrando Datos de ... ";
   |ATRI 0;

   |PINTA 2312, #30#2;
   |PINTA 2319, #30#3;
   |PINTA 2322, #30#1;
   |PINTA 2375, #30#26;

   |HAZ PonTitulo;
   |GRABA 020#30a;
   |LIBERA #30;

   |SI #0#37 = "S";
       |HAZ CreaPortada;
   |FINSI;
|FPRC;

|DEFBUCLE LasBorro;
   #30#1;
   ;
   #0#1, #0#2;
   #0#3, #0#4;
   be;
   NULL, LasBorro0;
|FIN;

|| ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

|CALCULO VoyaRegrabar; |TIPO 3;
  |SI #0#36 = "NO";
      |ACABA;
  |FINSI;

  |HAZ DirAplicSt;

  |BLIN 21;
  |BLIN 22;
  |BLIN 23;
  |CUADRO 2101 2480;
  |ATRI P;
  |PINTA 2303, "Empresa: ";
  |PINTA 2364, "Ejercicio: ";
  |ATRI 0;

  |SI #0#0 = "S";
      |BUCLE LasBorro;
  |SINO;
      |ABRE #30;
      |PARA nPara1 = 5; |SI nPara1 [ 32; |HACIENDO nPara1 = nPara1 + 3;
            nNume1 = nPara1 + 1;
            |SI #0nPara1 ! 0;
                #30#2 = #0nPara1;
                #30#3 = #0nNume1;
                |LEE 101#30=;
                |SI FSalida = 0;
                    |HAZ LasBorro0;
                |FINSI;
            |FINSI;
      |SIGUE;
      |CIERRA #30;
   |FINSI;
|FCAL;
||*********************************************************************
