|FICHEROS;
     caclipro;
     exclipro;

     caforpag;
     cafantas;
     caivaasi;
     canempre;

     &provinc@;
     &poblaci@;
     &regisnif@;
     &clientes@;
     &sgpaises@;

     Referenc@;
     dscam104@;

     agifa024@;
     dsm00003@;
     agifa112@;
|FIN;

|VARIABLES;
     nTipIVA  = 0;
     esclipro = "";
     cuenta = 0;
     digito = 0;
     cta = "";
     long1 = "";
     long = 0;
     sw = 0;
     num = 0;
     men2  = "     Longitud de Cuenta Fuera de Nivel !";
     aAlfa = "";
     aCuenta = "";

     nInkey = 0;
     alfa1 = "";
     alfa2 = "";
     final = "";
     x = "";
     pos1 = "";
     pos2 = "";
     pos3 = "";
     pos4 = "";
     nume1 = 0;
     nume2 = 0;
     cont = 0;
     lugar = 0;
     nifnum = 0;
     resto = 0;

     esalta = 0;
     directo = "";
     direct1 = "";
     traba = "";
     salida = 0;
     antes = 0;
     men6      = "    SConfirma el Alta en Fichero General (S/N): ";
     aCliPro   = "";
     nSwErr = 0;

     nSwC       = 0;

     nNume1     = 0;
     aAlfa1     = "";
     aAlfa2     = "";
     aAlfa4     = "";
     aAlfa5     = "";
     aDirec     = "";
     aCampo1    = "";
     aCampo2    = "";
     aCampo9    = "";
     nCampo3    = "";
     nOk        = 0;
     nCmp       = 0;

     nModo      = 0;
     nCalc      = 0;
     nHayIntegrada = 0;
     nAltaSbctr = 0;
     nConsulta  = 0;
     nSw        = 0;
     aMas       = "";
     aCod       = "";
     aFic       = "";

     &entrada = 1;
     &deCuenta = 0;
     &eaVarDni  = "";
     &enCalcCif = 0;
     &eaDi0_n   = "";
     &eaDi1_n   = "";
     &eaDi2_n   = "";
     &eaNom_n   = "";
     &enCP1_n   = 0;
     &enCP2_n   = 0;
     &eaPob_n   = "";
     &eaPro_n   = "";
     &eaTel_n   = "";
     &eaFax_n   = "";
     &eaNomPais = "";
     &eaCta     = "";
     &eaPais    = "";
     &eaIBAN    = "";
     &eaIBANant = "";
|FIN;

|INCLUYE dscont_i;

|PROCESO ClLocalidad; |TIPO 0;
     nume1 = Campo - 1;
     enCodPobl = #caclipro#Campo#;
     enCodProv = #caclipro#nume1#;
     |HAZ LeeLocalidad;
     |SI nume1 = 3;
         #caclipro#5 = eaProvincia; |PINTA #caclipro#5;
         #caclipro#6 = eaPoblacion; |PINTA #caclipro#6;
     |SINO;
         |SI nume1 = 15;
             #caclipro#19 = eaPoblacion; |PINTA #caclipro#19;
         |SINO;
             #caclipro#47 = eaProvincia; |PINTA #caclipro#47;
             #caclipro#48 = eaPoblacion; |PINTA #caclipro#48;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO primentra;  |TIPO 8;
     |HAZ inicio;
     esclipro = "C";
     |HAZ eLeeParametro;
|FPRC;

|PROCESO creacod1; |TIPO 0;
     pos1 = #caclipro#3;
     pos2 = "000" + pos1;
     traba = pos2 % -102;
     pos1 = #caclipro#4;
     pos2 = "0000" + pos1;
     pos1 = pos2 % -103;
     #caclipro#25 = traba + pos1;
|FPRC;

|PROCESO creacod2; |TIPO 0;
     pos1 = #caclipro#15;
     pos2 = "000" + pos1;
     traba = pos2 % -102;
     pos1 = #caclipro#16;
     pos2 = "0000" + pos1;
     pos1 = pos2 % -103;
     #caclipro#26 = traba + pos1;
|FPRC;

|PROCESO creacod3; |TIPO 0;
     pos1 = #caclipro#45;
     pos2 = "000" + pos1;
     traba = pos2 % -102;
     pos1 = #caclipro#46;
     pos2 = "0000" + pos1;
     pos1 = pos2 % -103;
     #caclipro#50 = traba + pos1;
|FPRC;

|PROCESO antesde;  |TIPO 7;
     #caclipro#23 = esclipro;
|FPRC;

|PROCESO cuenta; |TIPO 6;
     entrada = 1;
     digito  = Campo + 1;

     eaCuenta = #caclipro#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #caclipro#Campo# = eaCuenta;
     |PINTA #caclipro#Campo#;

     |HAZ SacaNivel;
     #caclipro#digito# = enNivel;
     |SI eswCta = 1;
         |SI Campo = 21;
             #caclipro#digito# = 1;
             |ACABA;
         |SINO;
             |MENAV men2;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO modifica; |TIPO 7;
     |SI #canempre#21 = "N";
        |CAMPO_MODIFICA #caclipro#10, 1, "N";
     |SINO;
        |CAMPO_MODIFICA #caclipro#10, 1, "S";
     |FINSI;
|FPRC;

|PROCESO nocero; |TIPO 6;
     |SI #caclipro#20 ! 0;  |ACABA;  |FINSI;
     |ABRE #caforpag;
     #caforpag#0 = #caclipro#20;
     |LEE 001#caforpag.=;              || graba el codigo cero para que no
     |SI FSalida ! 0;          ||/salga la pantalla
         |DDEFECTO #caforpag;
         #caforpag#0 = #caclipro#20;
         #caforpag#2 = 1;

         |GRABA 020#caforpag.n;
     |FINSI;
     |CIERRA #caforpag;
|FPRC;

|PROCESO AltaCertificados;
     aAlfa = "    N" + &191 + " Alta certificado subcontratista ? ";
     |CONFI aAlfa;
     |SI FSalida = 0;
         aAlfa = "|:basica/tadz0001.tab;" + (("00000" + #48#2) % -105) + "," + #48#8; |QBF aAlfa;
         aAlfa = aAlfa + "," + #48#1; |QBF aAlfa;
         aAlfa1 = #caclipro#9; |QBT aAlfa1;
         aAlfa = aAlfa + "@NUEVO" + aAlfa1 + "," + #caclipro#1; |QBF aAlfa;
         |SUB_EJECUTA aAlfa;
     |FINSI;
|FPRC;

|PROCESO ConsultaCertific;
     aAlfa = "|:basica/tadz0001.tab;" + (("00000" + #48#2) % -105) + "," + #48#8; |QBF aAlfa;
     aAlfa = aAlfa + "," + #48#1; |QBF aAlfa;
     aAlfa = aAlfa + "|" + #caclipro#9; |QBF aAlfa;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO VerCertificados;
     nConsulta = 0;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "basica/def/tadm0001.mas";
     |CARGA_DEF aAlfa, Referenc@;
     |SI FSalida = 0;
         nConsulta = 1;
         |DBASS aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "basica/fich/";
         |PATH_DAT #Referenc@#aAlfa#;
         |ABRE #Referenc@;
         #Referenc@#0 = enEmpresa;
         #Referenc@#1 = #caclipro#9;
         |LEE 000#Referenc@.=;
         |SI FSalida = 0;
             nConsulta = 4;
         |FINSI;
         |CIERRA #Referenc@;
         |DESCARGA_DEF #Referenc@;
      |FINSI;

      |SI nConsulta ! 0;
          |SI nConsulta = 1;
              |HAZ AltaCertificados;
          |SINO;
              |HAZ ConsultaCertific;
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO AntesNif; |TIPO 7;
    |ABRE #caivaasi;
    |DDEFECTO #caivaasi;
    |LEE 001#caivaasi.p;
    |CIERRA #caivaasi;
    aAlfa = "    <F2> Calcular letra del NIF o Comprobacion CIF."
    |SI #caivaasi#163 = "S";
        aAlfa = "    F2-Calcular letra NIF o Comprobar CIF. F3-Consulta Certificados Contrat."
    |FINSI;
    |MENSA aAlfa;
|FPRC;

|PROCESO letra_0;  |TIPO 6;
     nInkey = FSalida;
     |BLIN 4;

     |SI nInkey = 10;
        enCalcCif = 1;
        eaVarDni  =  #caclipro#Campo#;
        |HAZ CalculoDNI;
        #caclipro#Campo# = eaVarDni;
        |PINTA #caclipro#Campo#;
        |ERROR;
        |ACABA;
     |FINSI;

     eaVarDni  = #caclipro#Campo#;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "                ") % 115;
     |SI #caclipro#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #caclipro#Campo# = eaVarDni;  |PINTA #caclipro#Campo#;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

    nModo = (FEntrada / 100) ! 0;
    |SI nInkey = 11; |Y #caivaasi#163 = "S"; |Y nModo ! 1;
        |HAZ VerCertificados;
        |ERROR;
        |ACABA;
    |FINSI;

    eaCodNif = #caclipro#9; |QBF eaCodNif;
                     |QBF eaNifEmp;
    |SI eaCodNif = eaNifEmp;
        |CONFI "    NIntroducido NIF de la Empresa Actual. Continuar";
        |SI FSalida ! 0;
            |ERROR;
            |ACABA;
        |FINSI;
    |FINSI;

    |SI Haybasica = 0; |Y HayAcceso = 0; |ACABA; |FINSI;
    eaCodNif = #caclipro#9;
    |HAZ LeeNifs;
    |SI ewNif = 1;
        eaNom_n = #caclipro#1;       || Nombre y Apellidos
        aDirec  = #caclipro#2;
        |HAZ LaDivision;
        enCP1_n = #caclipro#3;       || Codigo Provincia
        enCP2_n = #caclipro#4;       || Codigo Poblacion
        eaPob_n = #caclipro#6;       || Poblacion
        eaPro_n = #caclipro#5;       || Provincia
        eaTel_n = #caclipro#7;       || Telefono
        eaFax_n = #caclipro#8;       || Fax
        |SI #caclipro#24 = "   "; #caclipro#24 = "ES "; |FINSI;
        eaCodPais = #caclipro#24;
        |HAZ LeePais;
        eaNomPais = #sgpaises@#1;     || Nombre Pais
    |FINSI;
|FPRC;

|PROCESO LaDivision;
     eaDi0_n = "";
     eaDi1_n = aDirec;
     eaDi2_n = "";

     nSw    = 0;
     aAlfa1 = aDirec % 103;
     |SI aAlfa1 = "CL ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "AV ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "PA ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "PZ ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "PL ";  nSw = 1; |FINSI;
     |SI aAlfa1 = "CR ";  nSw = 1; |FINSI;
     |SI nSw = 1;
         eaDi0_n = aAlfa1;
         eaDi1_n = aDirec % 440;
     |FINSI;
|FPRC;

|PROCESO defcodi;  |TIPO 7;
     esalta = (FEntrada /100) !0;
     |SI esalta = 1;
         #caclipro#0 = #caclipro#10;
         |PINTA #caclipro#0;
     |FINSI;
|FPRC;

|PROCESO quetecla;
     |SI deCuenta = 1;
         deCuenta = 0;
         FSalida = 9;
     |FINSI;
     |SI FSalida ! 9;  |ACABA;  |FINSI;
     |ENCAMPO #9#caclipro;
|FPRC;

|PROCESO ControlaCliente;
     aMas =  aBase + "dscomer9/def/agifa024.mas";
     |CARGA_DEF aMas, agifa024@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa024@#aFic#;

     |ABRE #agifa024@;

     |SELECT #4#agifa024@;
     #agifa024@#15 = #caclipro#9;
     |LEE 000#agifa024@.=;
     |SI FSalida = 0;
         |MENAV "0000El NIF del cliente ya existe en la gestion comercial.";

         aAlfa = "0000" + "Codigo: " + #agifa024@#0 + " Cuenta contable: " + #agifa024@#16;
         |MENAV aAlfa;
     |FINSI;

     |CIERRA #agifa024@;  |DESCARGA_DEF #agifa024@;
|FPRC;

|PROCESO ControlaProveedor;
     aMas =  aBase + "dscomer9/def/agifa112.mas";
     |CARGA_DEF aMas, agifa112@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa112@#aFic#;

     |ABRE #agifa112@;
     |SELECT #6#agifa112@;

     #agifa112@#9 = #caclipro#9;
     |LEE 000#agifa112@.=;
     |SI FSalida = 0;
         |MENAV "0000El NIF del proveedor ya existe en la gestion comercial.";

         aAlfa = "0000" + "Codigo: " + #agifa112@#0 + " Cuenta contable: " + #agifa112@#10;
         |MENAV aAlfa;
     |FINSI;
     |CIERRA #agifa112@;
     |DESCARGA_DEF #agifa112@;
|FPRC;

|PROCESO ControlaDSCOMER9;
     |DBASS aBase;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0; |DDEFECTO #caivaasi; |FINSI;
     |CIERRA #caivaasi;

     |SI #caivaasi#191 = "N";
         |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;
         |ACABA;
     |FINSI;

     |SI #caclipro#23 = "C";
         |HAZ ControlaCliente;
     |FINSI;

     |SI #caclipro#23 = "P";
         |HAZ ControlaProveedor;
     |FINSI;
|FPRC;

|PROCESO clienprov;
     traba = #caclipro#9;
     |QBF traba;

     |SI traba = "";
         |SI eaPaNif2 ! "S";
             aAlfa1 = "NIF en Blanco";
             |SI eaPaNif2 = "N";
                 aAlfa1 = "    Error. " + aAlfa1;
                 |MENAV aAlfa1;
             |FINSI;
             |SI eaPaNif2 = "X";
                 aAlfa1 = "    NError. " + aAlfa1 + ". Continuar";
                 |CONFI aAlfa1;
             |FINSI;
             |SI FSalida ! 0; |O eaPaNif2 = "N";
                 |ERROR;
             |FINSI;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI Haybasica = 0; |Y HayAcceso = 0; |ACABA; |FINSI;

     nSwErr   = 0;
     aCliPro  = #caclipro#23; aCuenta  = #caclipro#10;
     eaCodNif = #caclipro#9;
     |HAZ LeeNifs;
     |SI ewNif = 0;
         nSwErr = 0;
         |SALVA_FICHA #caclipro;
         |SELECT #4#caclipro;
         #caclipro#9 = eaCodNif;
         |LEE 000#caclipro.];
         |PARA; |SI FSalida = 0; |Y #caclipro#9 = eaCodNif; |HACIENDO;
            |SI aCliPro = #caclipro#23; |Y aCuenta ! #caclipro#10; |SAL; |FINSI;
            |LEE 000#caclipro.s;
         |SIGUE;

         |SI aCliPro = #caclipro#23; |Y aCuenta ! #caclipro#10; |Y #caclipro#9 = eaCodNif;
             |SI eaPaNif1 ! "X";
                 aAlfa = "    El NIF ya existe en la cuenta " + #caclipro#10;
                 |MENAV aAlfa;
                 |SI eaPaNif1 = "N"; |ERROR; nSwErr = 1; |FINSI;
             |SINO;
                 aAlfa = "    NEl NIF ya existe en la cuenta " + #caclipro#10;
                 aAlfa = aAlfa + ". Continuar";
                 |CONFI aAlfa;
                 |SI FSalida ! 0; |ERROR; nSwErr = 1; |FINSI;
             |FINSI;
         |FINSI;
         |SELECT #1#caclipro; |REPON_FICHA #caclipro;

         |SI nSwErr = 0; |HAZ igualdad; |FINSI;
     |FINSI;

     |HAZ ControlaDSCOMER9;
|FPRC;

|PROCESO igualdad;
     #caclipro#9 = #regisnif@#0;
     #caclipro#1 = #regisnif@#1;

     traba = #regisnif@#9;
     |QBF traba;
     |SI traba = "";
         #caclipro#2 = #regisnif@#2;
     |SINO;
         #caclipro#2 = traba + " " + #regisnif@#2;
     |FINSI;
     traba = #caclipro#2; |QBF traba;
     #caclipro#2 = traba + ", " + #regisnif@#3;
     traba = #caclipro#2; |QBF traba;
     #caclipro#2 = traba + " " + #regisnif@#10;
     traba = #caclipro#2; |QBF traba;
     #caclipro#2 = traba + " " + #regisnif@#11;

     #caclipro#3 = #regisnif@#4;
     #caclipro#4 = #regisnif@#5;
     #caclipro#5 = #regisnif@#7;
     #caclipro#6 = #regisnif@#6;
     #caclipro#7 = #regisnif@#8;
     #caclipro#8 = #regisnif@#17;
     #caclipro#24 = #regisnif@#12;

     |PINTA #caclipro#1; |PINTA #caclipro#2; |PINTA #caclipro#3;
     |PINTA #caclipro#4; |PINTA #caclipro#5; |PINTA #caclipro#6;
     |PINTA #caclipro#7; |PINTA #caclipro#9; |PINTA #caclipro#24;
     |PINTA #caclipro#8;

     |HAZ Envio7;
|FPRC;

|PROCESO Envio7; |TIPO 7;
     esalta = (FEntrada /100) !0;
     |SI esalta = 1; |HAZ IgualEnvio; |FINSI;
|FPRC;

|PROCESO Envio0; |TIPO 0;
     nInkey = FSalida;
     |SI nInkey = 10; |HAZ IgualEnvio; |FINSI;
|FPRC;

|PROCESO IgualEnvio;
     #caclipro#44 = #caclipro#2;  |PINTA #caclipro#44;
     #caclipro#45 = #caclipro#3;  |PINTA #caclipro#45;
     #caclipro#46 = #caclipro#4;  |PINTA #caclipro#46;
     #caclipro#47 = #caclipro#5;  |PINTA #caclipro#47;
     #caclipro#48 = #caclipro#6;  |PINTA #caclipro#48;
     #caclipro#49 = #caclipro#27; |PINTA #caclipro#49;
     #caclipro#50 = #caclipro#25;
|FPRC;

|PROCESO cuapais;
     |PUSHV 1102 1850;
     |D_CUADRO 1102, 1850;
     |ATRI R;
     |PINTA 1203 , " ------------ PAISES COMUNITARIOS -------------";
     |ATRI N;
     |PINTA 1303 , " ES Espa¤a      FR Francia       IT Italia     ";
     |PINTA 1403 , " DE Alemania    EL Grecia        IE Irlanda    ";
     |PINTA 1503 , " BE Belgica     GB Gran Breta¤a  LU Luxemburgo ";
     |PINTA 1603 , " DK Dinamarca   NL Holanda       PT Portugal   ";
     |PINTA 1703 , " FI Finlandia   SE Suecia        AT Austria    ";
     |ATRI I;
     |PINTA 1304 , "ES"; |PINTA 1319 , "FR"; |PINTA 1336 , "IT";
     |PINTA 1404 , "DE"; |PINTA 1419 , "EL"; |PINTA 1436 , "IE";
     |PINTA 1504 , "BE"; |PINTA 1519 , "GB"; |PINTA 1536 , "LU";
     |PINTA 1604 , "DK"; |PINTA 1619 , "NL"; |PINTA 1636 , "PT";
     |PINTA 1704 , "FI"; |PINTA 1719 , "SE"; |PINTA 1736 , "AT";
     |ATRI 0;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO filtro; |TIPO 0;
     |SI FSalida = 9;
        |HAZ cuapais;
        |ERROR;
        |ACABA;
     |FINSI;
     alfa1 = #caclipro#Campo# > " ";
     #caclipro#Campo# = alfa1;
     |PINTA #caclipro#Campo#;
|FPRC;

|PROCESO ElPais; |TIPO 0;
     alfa1 = "N"; alfa2 = "S";
     |SI #caclipro#24 ! "ES "; |Y #caclipro#24 ! "   ";
         #caclipro#3 = "99";  |PINTA #caclipro#3;
         #caclipro#4 = "999"; |PINTA #caclipro#4;
         alfa1 = "S"; alfa2 = "N";
     |FINSI;
     |C_M #caclipro#3, 1, alfa2;
     |C_M #caclipro#4, 1, alfa2;
     |C_M #caclipro#53,1, alfa1;
|FPRC;

|PROCESO AntesConf; |TIPO 7;
     |SI #caclipro#23 = "P";
        |C_M #caclipro#Campo#,1,"S";
     |SINO;
        |C_M #caclipro#Campo#,1,"N";
     |FINSI;
|FPRC;

|PROCESO ElBanco7; |TIPO 7;
     |SI #caclipro#23 =  "C"; eaVC = "V"; |FINSI;
     |SI #caclipro#23 =  "P"; eaVC = "C"; |FINSI;
     enSwLoLeo = 0;
     |HAZ LeeBanco;
     |SI enElBanco = 1;
         |C_M #caclipro#Campo#,1,"N";
         #caclipro#Campo# = 999; |PINTA #caclipro#Campo#;
     |SINO;
         |C_M #caclipro#Campo#,1,"S";
     |FINSI;
|FPRC;

|PROCESO ElBanco0; |TIPO 0;
     nInkey = FSalida;
     |C_M #caclipro#Campo#,0,alfa1;
     |SI alfa1 = "N"; |ACABA; |FINSI;

     |SI #caclipro#Campo# = 999;
         #cafantas#8 = "BANCO STANDAR";
         |PINTA 1724, #cafantas#8;
         |ACABA;
     |FINSI;
     eOpBan = 0; || 1 = Consulta pantalla
     |SI nInkey = 10; eOpBan = 1;  |FINSI;

     enSwLoLeo = 1;
     enBanco = #caclipro#Campo#;
     |HAZ LeeBanco;
     |SI eswLect = 0;
         #caclipro#Campo# = enBanco; |PINTA #caclipro#Campo#;
         #cafantas#8    = eaNomBanco;
     |SINO;
         #cafantas#8    = "NO EXISTE CODIGO DE BANCO PROPIO";
     |FINSI;
     |PINTA 1724, #cafantas#8;
|FPRC;

|PROCESO T13clipro; |TIPO 13;
     |PARA nCmp = 0;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           #exclipro#nCmp# = #caclipro#nCmp#;
     |SIGUE;

     |SI #caclipro#28 = 999;
         #cafantas#8 = "BANCO STANDAR";
         |PINTA 1724, #cafantas#8;
         |ACABA;
     |FINSI;
     enSwLoLeo = 1;
     enBanco = #caclipro#28; eaVC = "V";
     |HAZ LeeBanco;
     |SI eswLect = 0;
         #caclipro#28 = enBanco; |PINTA #caclipro#28;
         #cafantas#8    = eaNomBanco;
     |SINO;
         #cafantas#8    = "NO EXISTE CODIGO DE BANCO PROPIO";
     |FINSI;
     |PINTA 1724, #cafantas#8;
|FPRC;

|PROCESO NoBlanco; |TIPO 0;
     |SI Campo = 1; aAlfa1 = "Nombre en Blanco"; |FINSI;
     |SI Campo = 2; aAlfa1 = "Direccion en Blanco"; |FINSI;
     |SI Campo = 3; aAlfa1 = "Cod.Provincia en Blanco"; |FINSI;
     traba = #caclipro#Campo#;
     |SI Campo = 3; |Y #caclipro#Campo# = 0; traba = ""; |FINSI;

     |QBF traba;
     |SI traba = ""; |Y eaPaNif2 ! "S";
         |SI eaPaNif2 = "N";
             aAlfa1 = "    Error. " + aAlfa1;
             |MENAV aAlfa1;
         |FINSI;
         |SI eaPaNif2 = "X";
             aAlfa1 = "    NError. " + aAlfa1 + ". Continuar";
             |CONFI aAlfa1;
         |FINSI;
         |SI FSalida ! 0; |O eaPaNif2 = "N";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TrasConClPr;  |TIPO 0;     ||Concepto IRPF
     |C_M #caclipro#Campo#,0,alfa1;
     |SI alfa1 = "N"; |ACABA; |FINSI;

     |SI FSalida = 2; |ACABA; |FINSI;

     |SI #caclipro#Campo# ! 0;
         aAlfa1 = aTipoIVA;
         aTipoIVA  = "";
         enFilConc = 3;        || Concepto de IRPF
         enConcepto = #caclipro#Campo#;
         |HAZ FiltroConcepto;
         aTipoIVA = aAlfa1;
     |FINSI;
|FPRC;

|PROCESO VerSwC; |TIPO 0;
     aAlfa = Contenido;
     |SI aAlfa ! #caclipro#Campo#;
         nSwC = 1;
     |FINSI;
|FPRC;

|PROCESO Tipo7IBAN_Clp;  |TIPO 7;
     aAlfa = #caclipro#40;   |QBF aAlfa;

     |SI aAlfa ! "";  |Y nSwC = 0; |ACABA;  |FINSI;

     |SI nSwC = 1; |Y aAlfa ! "";
         |CONFI "0000SSe han modificado los datos de la Cuenta Corriente. Recalcular el IBAN?";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     eaIBANant = "";
     eaCta     = #caclipro#29 + #caclipro#30 + #caclipro#31 + #caclipro#32;
     eaPais    = #caclipro#24;
     |HAZ CalcuIBAN;

     #caclipro#40 = eaIBAN;
     |PINTA #caclipro#40;
     nSwC = 0;
|FPRC;

|PROCESO Tipo0IBAN_Clp;  |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     eaCta     = #caclipro#29 + #caclipro#30 + #caclipro#31 + #caclipro#32;
     eaPais    = #caclipro#24;
     eaIBANant = #caclipro#40;
     |HAZ CheqIBAN;

     aAlfa = eaIBANant; |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |SI aAlfa = "";
             #caclipro#40 = eaIBAN;
             |PINTA #caclipro#40;
         |SINO;
             |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
             |SI FSalida = 0;
                 #caclipro#40 = eaIBAN;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaDsm00003;
     |ABRE #dsm00003@;
     #dsm00003@#0  = #agifa024@#0;
     #dsm00003@#1  = 1;
     |LEE 101#dsm00003@.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm00003@;
         #dsm00003@#0  = #agifa024@#0;
         #dsm00003@#1  = 1;
         |GRABA 020#dsm00003@.b;
     |FINSI;

     #dsm00003@#2  = #agifa024@#5;
     #dsm00003@#3  = #agifa024@#6;
     #dsm00003@#4  = #agifa024@#178;
     #dsm00003@#5  = #agifa024@#179;
     #dsm00003@#6  = #agifa024@#180;
     #dsm00003@#7  = #agifa024@#7;
     #dsm00003@#8  = #agifa024@#14;
     #dsm00003@#10 = #agifa024@#2;
     #dsm00003@#11 = #agifa024@#3;
     #dsm00003@#13 = #agifa024@#17;
     #dsm00003@#14 = #agifa024@#25;
     #dsm00003@#16 = #agifa024@#189;
     #dsm00003@#19 = #agifa024@#205;
     #dsm00003@#20 = #agifa024@#196;
     #dsm00003@#21 = #agifa024@#18;
     #dsm00003@#22 = #agifa024@#36;
     #dsm00003@#23 = #agifa024@#211;
     #dsm00003@#24 = #agifa024@#197;

     |GRABA 020#dsm00003@.a;
     |CIERRA #dsm00003@;
|FPRC;

|PROCESO CarVars24;
     |SI nCmp =  7;  #agifa024@#17  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  8;  #agifa024@#18  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  9;  #agifa024@#15  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 10;  #agifa024@#16  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 13;  #agifa024@#29  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 14;  #agifa024@#34  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 17;  #agifa024@#30  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 19;  #agifa024@#162 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 20;  #agifa024@#20  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 20;  #agifa024@#20  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 25;  #agifa024@#183 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 24;  #agifa024@#205 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 28;  #agifa024@#203 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 29;  #agifa024@#32  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 30;  #agifa024@#33  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 31;  #agifa024@#31  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 32;  #agifa024@#30  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 33;  #agifa024@#3   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 34;  #agifa024@#22  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 35;  #agifa024@#23  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 36;  #agifa024@#24  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 40;  #agifa024@#215 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 41;  #agifa024@#216 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 44;  #agifa024@#11  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 45;  #agifa024@#184 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 46;  #agifa024@#185 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 47;  #agifa024@#13  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 48;  #agifa024@#12  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 49;  #agifa024@#27  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 50;  #agifa024@#186 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp = 51;  #agifa024@#197 = #caclipro#nCmp#;  |FINSI;

     |SI nCmp = 2;
         |SI #agifa024@#8   = #agifa024@#5;
             #agifa024@#5   = #caclipro#nCmp#;
         |FINSI;

         |SI #agifa024@#8   = #agifa024@#11;
             #agifa024@#11  = #caclipro#nCmp#;
         |FINSI;

         #agifa024@#8   = #caclipro#nCmp#;
     |FINSI;

     |SI nCmp = 3;
         |SI #agifa024@#181 = #agifa024@#178;
             #agifa024@#178 = #caclipro#nCmp#;
         |FINSI;

         |SI #agifa024@#181 = #agifa024@#184;
             #agifa024@#184 = #caclipro#nCmp#;
         |FINSI;

         #agifa024@#181 = #caclipro#nCmp#;
     |FINSI;

     |SI nCmp = 4;
         |SI #agifa024@#182 = #agifa024@#179;
             #agifa024@#179 = #caclipro#nCmp#;
         |FINSI;

         |SI #agifa024@#182 = #agifa024@#185;
             #agifa024@#185 = #caclipro#nCmp#;
         |FINSI;

         #agifa024@#182 = #caclipro#nCmp#;
     |FINSI;

     |SI nCmp = 5;
         |SI #agifa024@#10  = #agifa024@#7;
             #agifa024@#7   = #caclipro#nCmp#;
         |FINSI;

         |SI #agifa024@#10  = #agifa024@#13;
             #agifa024@#13  = #caclipro#nCmp#;
         |FINSI;

         #agifa024@#10  = #caclipro#nCmp#;
     |FINSI;

     |SI nCmp = 6;
         |SI #agifa024@#9   = #agifa024@#6;
             #agifa024@#6   = #caclipro#nCmp#;
         |FINSI;

         |SI #agifa024@#9   = #agifa024@#12;
             #agifa024@#12  = #caclipro#nCmp#;
         |FINSI;

         #agifa024@#9   = #caclipro#nCmp#;
     |FINSI;

     aAlfa = (("00" + #agifa024@#178) % -102);
     aAlfa = aAlfa + (("000" + #agifa024@#179) % -103);
     #agifa024@#180 = aAlfa;

     aAlfa = (("00" + #agifa024@#181) % -102);
     aAlfa = aAlfa + (("000" + #agifa024@#182) % -103);
     #agifa024@#183 = aAlfa;

     aAlfa = (("00" + #agifa024@#184) % -102);
     aAlfa = aAlfa + (("000" + #agifa024@#185) % -103);
     #agifa024@#186 = aAlfa;
|FPRC;

|PROCESO GrabaAgifa024;
     aMas =  aBase + "dscomer9/def/agifa024.mas";
     |CARGA_DEF aMas, agifa024@;

     aMas =  aBase + "dscomer9/def/dsm00003.mas";
     |CARGA_DEF aMas, dsm00003@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa024@#aFic#;
     |PATH_DAT #dsm00003@#aFic#;

     |ABRE #agifa024@;
     |SELECT #1#agifa024@;

     aCod = #caclipro#10 % -106;
     #agifa024@#0 = aCod;
     |LEE 101#agifa024@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agifa024@;
         #agifa024@#0   = aCod;
         #agifa024@#1   = #caclipro#1;
         #agifa024@#2   = #caclipro#1;

         #agifa024@#17  = #caclipro#7;
         #agifa024@#18  = #caclipro#8;
         #agifa024@#15  = #caclipro#9;
         #agifa024@#16  = #caclipro#10;
         #agifa024@#29  = #caclipro#13;
         #agifa024@#34  = #caclipro#14;
         #agifa024@#30  = #caclipro#17;
         #agifa024@#162 = #caclipro#19;
         #agifa024@#20  = #caclipro#20;
         #agifa024@#183 = #caclipro#25;
         #agifa024@#205 = #caclipro#24;
         #agifa024@#203 = #caclipro#28;
         #agifa024@#32  = #caclipro#29;
         #agifa024@#33  = #caclipro#30;
         #agifa024@#31  = #caclipro#31;
         #agifa024@#30  = #caclipro#32;
         #agifa024@#3   = #caclipro#33;
         #agifa024@#22  = #caclipro#34;
         #agifa024@#23  = #caclipro#35;
         #agifa024@#24  = #caclipro#36;
         #agifa024@#215 = #caclipro#40;
         #agifa024@#216 = #caclipro#41;
         #agifa024@#11  = #caclipro#44;
         #agifa024@#184 = #caclipro#45;
         #agifa024@#185 = #caclipro#46;
         #agifa024@#13  = #caclipro#47;
         #agifa024@#12  = #caclipro#48;
         #agifa024@#27  = #caclipro#49;
         #agifa024@#186 = #caclipro#50;
         #agifa024@#197 = #caclipro#51;

         #agifa024@#8   = #caclipro#2;
         #agifa024@#181 = #caclipro#3;
         #agifa024@#182 = #caclipro#4;
         #agifa024@#10  = #caclipro#5;
         #agifa024@#9   = #caclipro#6;

         aAlfa = #agifa024@#5;  |QBF aAlfa;
         |SI aAlfa = "";
             #agifa024@#5   = #agifa024@#8;
             #agifa024@#178 = #agifa024@#181;
             #agifa024@#179 = #agifa024@#182;
             #agifa024@#7   = #agifa024@#10;
             #agifa024@#6   = #agifa024@#9;
         |FINSI;

         aAlfa = #agifa024@#11;  |QBF aAlfa;
         |SI aAlfa = "";
             #agifa024@#11  = #agifa024@#8;
             #agifa024@#184 = #agifa024@#181;
             #agifa024@#185 = #agifa024@#182;
             #agifa024@#13  = #agifa024@#10;
             #agifa024@#12  = #agifa024@#9;
         |FINSI;

         aAlfa = (("00" + #agifa024@#178) % -102);
         aAlfa = aAlfa + (("000" + #agifa024@#179) % -103);
         #agifa024@#180 = aAlfa;

         aAlfa = (("00" + #agifa024@#181) % -102);
         aAlfa = aAlfa + (("000" + #agifa024@#182) % -103);
         #agifa024@#183 = aAlfa;

         aAlfa = (("00" + #agifa024@#184) % -102);
         aAlfa = aAlfa + (("000" + #agifa024@#185) % -103);
         #agifa024@#186 = aAlfa;

         |GRABA 020#agifa024@.n;
         |LIBERA #agifa024@;

         |HAZ CargaDsm00003;

         |ACABA;
     |FINSI;

     nOk = 0;
     |PARA nCmp = 0;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           |SI #caclipro#nCmp# ! #exclipro#nCmp#;
               nOk = 1;
               |HAZ CarVars24;
           |FINSI;
     |SIGUE;

     |SI nOk = 1;
         |GRABA 020#agifa024@.a;
         |LIBERA #agifa024@;

         |HAZ CargaDsm00003;
     |FINSI;

     |CIERRA #dsm00003@;  |DESCARGA_DEF #dsm00003@;
     |CIERRA #agifa024@;  |DESCARGA_DEF #agifa024@;
|FPRC;

|PROCESO CarVars112;
     |SI nCmp =  10;  #agifa112@#10  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   1;  #agifa112@#1   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   1;  #agifa112@#2   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   2;  #agifa112@#3   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   3;  #agifa112@#74  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   4;  #agifa112@#75  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  25;  #agifa112@#76  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  24;  #agifa112@#89  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   5;  #agifa112@#5   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   6;  #agifa112@#4   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   7;  #agifa112@#6   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   8;  #agifa112@#7   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =   9;  #agifa112@#9   = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  13;  #agifa112@#11  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  14;  #agifa112@#16  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  17;  #agifa112@#12  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  19;  #agifa112@#57  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  20;  #agifa112@#17  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  28;  #agifa112@#98  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  29;  #agifa112@#14  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  30;  #agifa112@#15  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  31;  #agifa112@#13  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  32;  #agifa112@#12  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  33;  #agifa112@#92  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  34;  #agifa112@#19  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  35;  #agifa112@#20  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  36;  #agifa112@#21  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  37;  #agifa112@#99  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  38;  #agifa112@#94  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  39;  #agifa112@#95  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  40;  #agifa112@#96  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  41;  #agifa112@#97  = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  44;  #agifa112@#101 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  45;  #agifa112@#102 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  46;  #agifa112@#103 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  47;  #agifa112@#104 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  48;  #agifa112@#105 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  49;  #agifa112@#106 = #caclipro#nCmp#;  |FINSI;
     |SI nCmp =  50;  #agifa112@#107 = #caclipro#nCmp#;  |FINSI;
|FPRC;

|PROCESO GrabaAgifa112;
     aMas =  aBase + "dscomer9/def/agifa112.mas";
     |CARGA_DEF aMas, agifa112@;

     aFic =  aBase + "dscomer9/fich/" + (("00000" + #48#2) % -105) + "/";
     |PATH_DAT #agifa112@#aFic#;

     |ABRE #agifa112@;
     |SELECT #1#agifa112@;

     aCod = #caclipro#10 % -106;
     #agifa112@#0 = aCod;
     |LEE 101#agifa112@.=;
     |SI FSalida ! 0;
         |DDEFECTO #agifa112@;
         #agifa112@#0   = aCod;
         #agifa112@#10  = #caclipro#10;
         #agifa112@#1   = #caclipro#1;
         #agifa112@#2   = #caclipro#1;
         #agifa112@#3   = #caclipro#2;
         #agifa112@#74  = #caclipro#3;
         #agifa112@#75  = #caclipro#4;
         #agifa112@#76  = #caclipro#25;
         #agifa112@#89  = #caclipro#24;
         #agifa112@#5   = #caclipro#5;
         #agifa112@#4   = #caclipro#6;
         #agifa112@#6   = #caclipro#7;
         #agifa112@#7   = #caclipro#8;
         #agifa112@#9   = #caclipro#9;
         #agifa112@#11  = #caclipro#13;
         #agifa112@#16  = #caclipro#14;
         #agifa112@#12  = #caclipro#17;
         #agifa112@#57  = #caclipro#19;
         #agifa112@#17  = #caclipro#20;
         #agifa112@#98  = #caclipro#28;
         #agifa112@#14  = #caclipro#29;
         #agifa112@#15  = #caclipro#30;
         #agifa112@#13  = #caclipro#31;
         #agifa112@#12  = #caclipro#32;
         #agifa112@#92  = #caclipro#33;
         #agifa112@#19  = #caclipro#34;
         #agifa112@#20  = #caclipro#35;
         #agifa112@#21  = #caclipro#36;
         #agifa112@#99  = #caclipro#37;
         #agifa112@#94  = #caclipro#38;
         #agifa112@#95  = #caclipro#39;
         #agifa112@#96  = #caclipro#40;
         #agifa112@#97  = #caclipro#41;
         #agifa112@#101 = #caclipro#44;
         #agifa112@#102 = #caclipro#45;
         #agifa112@#103 = #caclipro#46;
         #agifa112@#104 = #caclipro#47;
         #agifa112@#105 = #caclipro#48;
         #agifa112@#106 = #caclipro#49;
         #agifa112@#107 = #caclipro#50;

         |GRABA 020#agifa112@.n;
         |LIBERA #agifa112@;

         |ACABA;
     |FINSI;

     nOk = 0;
     |PARA nCmp = 0;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           |SI #caclipro#nCmp# ! #exclipro#nCmp#;
               nOk = 1;
               |HAZ CarVars112;
           |FINSI;
     |SIGUE;

     |SI nOk = 1;
         |GRABA 020#agifa112@.a;
         |LIBERA #agifa112@;
     |FINSI;

     |CIERRA #agifa112@;
     |DESCARGA_DEF #agifa112@;
|FPRC;

|PROCESO CtrlDSCOMER9;
     |SI #caivaasi#191 = "N";
         |ACABA;
     |FINSI;

     |DBASS aBase;

     |SI #caclipro#23 = "C";  |HAZ GrabaAgifa024;   |FINSI;
     |SI #caclipro#23 = "P";  |HAZ GrabaAgifa112;  |FINSI;
|FPRC;

|PROCESO T12clipro; |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     |CONFI "0000SEs correcto";
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     eaCta     = #caclipro#29 + #caclipro#30 + #caclipro#31 + #caclipro#32;
     eaPais    = #caclipro#24;
     eaIBANant = #caclipro#40;
     |HAZ CheqIBAN;

     aAlfa = #caclipro#40;  |QBF aAlfa;
     |SI aAlfa ! eaIBAN; |Y aAlfa ! "";
         |MENAV "0000El codigo IBAN puede ser erroneo.";
     |SINO;
         |SI aAlfa = "";
           ||  |MENAV "0000No esa informado el codigo IBAN";
         |FINSI;
     |FINSI;

     nSwC = 0;

     |SI eaPaNif2 ! "S";
         aCampo1 = #caclipro#1; |QBF aCampo1;
         aCampo9 = #caclipro#9; |QBF aCampo9;
         aCampo2 = #caclipro#2; |QBF aCampo2;
         nCampo3 = #caclipro#3;
         aAlfa1 = ""; nNume1 = 0;
         |SI aCampo1 = ""; aAlfa1 = "Nombre en Blanco";    nNume1 = nNume1 + 1; |FINSI;
         |SI aCampo2 = ""; aAlfa1 = "Direccion en Blanco"; nNume1 = nNume1 + 1; |FINSI;
         |SI aCampo9 = ""; aAlfa1 = "NIF en Blanco";       nNume1 = nNume1 + 1; |FINSI;
         |SI nCampo3 = 0;  aAlfa1 = "Codigo Provincia";    nNume1 = nNume1 + 1; |FINSI;

         |SI nNume1 > 1;
             aAlfa4 = "";
             |SI aCampo1 = "";  aAlfa4 = "Nombre";  |FINSI;
             |SI aCampo2 = "";
                 aAlfa5 = " y ";
                 |SI aCampo9 = ""; |O nCampo3 = 0; aAlfa5 = ", "; |FINSI;
                 |SI aAlfa4  = "";                 aAlfa5 = "";   |FINSI;
                 aAlfa4 = aAlfa4 + aAlfa5 + "Direccion";
             |FINSI;
             |SI aCampo9 = "";
                 aAlfa5 = " y ";
                 |SI nCampo3 = 0;  aAlfa5 = ", "; |FINSI;
                 |SI aAlfa4 = "";  aAlfa5 = "";   |FINSI;
                 aAlfa4 = aAlfa4 + aAlfa5 + "DNI";
             |FINSI;
             |SI nCampo3 = 0;
                 aAlfa5 = " y ";
                 |SI aAlfa4 = "";  aAlfa5 = "";   |FINSI;
                 aAlfa4 = aAlfa4 + aAlfa5 + "Cod.Provincia";
             |FINSI;
             aAlfa1 = aAlfa4 + " en Blanco";
         |FINSI;

         |SI aAlfa1 ! "";
             |SI eaPaNif2 = "N";
                 aAlfa1 = "    Error. " + aAlfa1;
                 |MENAV aAlfa1;
             |FINSI;
             |SI eaPaNif2 = "X";
                 aAlfa1 = "    NError. " + aAlfa1 + ". Continuar";
                 |CONFI aAlfa1;
             |FINSI;
             |SI FSalida ! 0; |O eaPaNif2 = "N";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nModo = 3;
         |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
        |SI #caivaasi#163 = "S";
            |HAZ AltaCertificados;
        |FINSI;
     |FINSI;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0; |DDEFECTO #caivaasi; |FINSI;
     |CIERRA #caivaasi;

     |HAZ CtrlDSCOMER9;
|FPRC;

||----------------------------------------------------
|PROCESO TrasIVACl; |TIPO 0;
     nInkey = FSalida;
     |SI #caclipro#23 = "C";
         aTipoIVA = "R";
     |SINO;
         aTipoIVA = "S";
     |FINSI;

     nTipIVA = #caclipro#Campo#;
     |SI nInkey = 10;
        efFechaIVA = ~; enLineaIVA = 0; enIvaTot = 1; |HAZ SelecTipoIVA; enIvaTot = 0;
        #caclipro#Campo# = enLineaIVA; |PINTA #caclipro#Campo#;
        |ERROR;
     |FINSI;
     nTipIVA = #caclipro#Campo#;

     |SI #caclipro#Campo# ! 0;
        efFechaIVA = "31.12.2999";
        enLineaIVA = #caclipro#Campo#;
        |HAZ SacaIVA;
        |SI enLineaIVA < 0;
           |MENAV "    Control de Tipo de IVA no definido";
           enLineaIVA = 0;
        |FINSI;
     |FINSI;
|FPRC;
