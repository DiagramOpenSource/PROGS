|FICHEROS;
  caz00013 #10;
  camoauxc #0,MANTE;
  camoauxl #1,MANTE;

  :/basica/def/agicen14 #114;
|FIN;

|VARIABLES;
 nInkey   = 0;
 nSwSal   = 0;
 aFichero = "";
 aAlfUlt  = "";
 aAlfa1   = "";
 nModoEntrada = 0;

 &swNOAmor = 0;
 &aFModelo = "";
 &swUno    = 0;
 &r_emp    = 0;
 &r_per    = 0;
 &aEstru   = "";
|FIN;

|INCLUYE dscont_i;

|| /////////////////////// PROCESOS DE TRABAJO \\\\\\\\\\\\\\\\\\\\
|| ******************************************** Calculos Pantalla
|CALCULO wTipo12; |TIPO 12;
|FCAL;

|RUTINA ClaveBajaAxC;
 #0#6 = #10#1;
 #0#0 = "            ";
|FRUT;

|RUTINA ClaveAltaAxC;
 #0#6 = #10#1;
 #0#0 = "zzzzzzzzzzzz";
|FRUT;

|PROCESO wTipo3; |TIPO 11;
 nInkey = FSalida;
 |SI nInkey = 10;
     nSwSal = 0;
     |ENTLINEAL #1#0, -2, 2, 10, 0, ClaveBajaAxC, ClaveAltaAxC;
 |FINSI;
 |SI nInkey = 11;
     |HAZ Copiar;
     |ERROR;
 |FINSI;
|FPRC

|CALCULO PresentaLinea;  |TIPO 7;
 |ENTLINEAL #1#0, -2, 7, 10, 0, ClaveBajaAxC, ClaveAltaAxC;
|FCAL;

|CALCULO wTipo0; |TIPO 0;
  |SI #10#4 > "01.01.1900";
      aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
      |CONFI aAlfa1;
      |SI FSalida ! 0;
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
  |SI #10#5 = "S";
      |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Movimientos ? ";
      |SI FSalida ! 0;
         |ERROR;
         |ACABA;
      |FINSI;
  |FINSI;
|FCAL;

|PROCESO Borrolin;
 |BORRA 020#1a;
 |LIBERA #1;
|FPRC;

|DEFBUCLE borrarLineas;
 #1#1;
 ;
 #0#6,#0#0,001;
 #0#6,#0#0,999;
 be;
 NULL, Borrolin;
|FIN;

|PROCESO BorraElemento;
 |BUCLE borrarLineas;
 |BORRA 020#0a;
 |LIBERA #0;
|FPRC;

|DEFBUCLE borrarElementos;
 #0#1;
 ;
 #10#1,"            ";
 #10#1,"zzzzzzzzzzzz";
 be;
 NULL, BorraElemento;
|FIN;

|CALCULO wTipo1; |TIPO 1;
 nModoEntrada = (FEntrada / 100) ! 0;
 |SI nModoEntrada = 2;
    |ERROR;
    |PTEC 824;
 |FINSI;
 |SI nModoEntrada = 3;
     |CONFI "    NEsta Seguro de Borrar todas los Cuentas de Desglose de esta Actividad ?";
     |SI FSalida ! 0;
         |ERROR;
         |ACABA;
     |FINSI;
     |BUCLE borrarElementos;
 |FINSI;
|FCAL;

|| -----------------------------------------------------------------------
|PROCESO CreaAuxi;
  #10#0 = #114#0;  ||Empresa
  aAlfa1 = #114#1; |QBF aAlfa1;
  aAlfa1 = ("00" + aAlfa1) % -102;
  #10#1 = aAlfa1;  ||Actividad
  #10#2 = #114#4;  ||Descripcion
  #10#3 = #114#5;  ||Fecha Alta
  #10#4 = #114#6;  ||Fecha Baja
  #10#5 = #114#14; ||Comunero
  |GRABA 020#10n;

  aAlfUlt = aAlfa1;
|FPRC;

|DEFBUCLE caz00013;
 #114#1;
 ;
 enEmpresa, 01;
 enEmpresa, 99;
 e;
 NULL, CreaAuxi;
|FIN;

|| ************************************************************************
|RUTINA ClaveBaja10;
 #10#0 = enEmpresa;
 #10#1 = "  ";
|FRUT;

|RUTINA ClaveAlta10;
 #10#0 = enEmpresa;
 #10#1 = aAlfUlt;
|FRUT;

|PROGRAMA;
 |HAZ inicio;
 swNOAmor = 0;
 |HAZ DirAplicSt;
 |SI Haymodelo ! 0;
     aFModelo = aPModelo + "fich/";
     swNOAmor = 1;
 |FINSI;

 |CLS;
 |CABEZA "Desglose Cuentas Inventario";

 aFichero = ("z13" + Usuario) % 108;
 |NOME_DAT #10 aFichero;

 |ABRE #10;  |CIERRA #10;  |DELINDEX #10;

 |ABRE #10;

/*
 ||Crea siempre el 00

        #10#0 = enEmpresa;  ||Empresa
        #10#1 = "00";    ||Actividad Total
        #10#2 = "INVENTARIO GENERAL ";  ||Descripcion
        |GRABA 020#10n;
 || ...............................
*/

 |BUCLE caz00013;
 |CIERRA #10;


 |PINPA #0#10;
 |ENTLINEAL #1#10, -2, 2, 09, 0, ClaveBaja10, ClaveAlta10;
 |DELINDEX #10;
|FPRO;

|PROCESO Copiar;
 |SI nInkey = 11; swUno  = 1; |FINSI;
 r_emp = enEmpresa;
 r_per = enPeriodo;
 aEstru = #10#1;
 |SUB_EJECUTA_NP "camoauxz";
 #0#1 = aEstru;
 |PINTA #10#1;
 |HAZ PresentaLinea;
|FPRC;
