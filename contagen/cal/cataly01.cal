|FICHEROS;
    cataly01 #0;
    catalm01 #1;
    cacuenta #3;

    canempre #30;
    caselem1 #998;
|FIN;

|VARIABLES;
   &entrada  = 1;
   informe   = "cataly01";
   sw        = 0;
   talon     = 0;
   &cnomprov = "";
   &cnombanc = "";
   alfa1     = "";
   sw_act    = 0;
   &total    = 0;
|FIN;

|INCLUYE dscont_i;

|CALCULO cuenta; |TIPO 0;
     eaCuenta = #0Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
|FCAL;

|CALCULO juntos; |TIPO 0;
 |SI sw_act = 0;
     #0#10 = #0#13;
     |PINTA #0#10;
 |FINSI;
|FCAL;

|CALCULO nodepar; |TIPO 7;
   |C_M #0#16, 1, eaDepar;
   |C_M #0#17, 1, eaDepar;
|FCAL;
|| ***************************************************************
|PROCESO cuentas;
  cnombanc = "<CUENTA SIN DEFINIR>";
  cnomprov = #1#14;
  #3#0 = #1#3;
  #3#1 = #1#4;
  |LEE 001#3=;
  |SI FSalida = 0;  cnombanc = #3#2;  |FINSI;
|FPRC;

|PROCESO impresion;

  |SI #0#10 ! "A";
      |SI #0#10 ! #1#10;  |ACABA;  |FINSI;  || impresa carta
  |FINSI;
  |SI #0#13 ! "A";
      |SI #0#13 ! #1#12;  |ACABA;  |FINSI;  || impreso talon
  |FINSI;
  |SI #0#11 ! "A";
      |SI #0#11 ! #1#07;  |ACABA;  |FINSI;  || emision
  |FINSI;
  |SI #0#12 ! "A";
      |SI #0#12 ! #1#08;  |ACABA;  |FINSI;  || vencimiento
  |FINSI;

  sw = 1;
  |HAZ cuentas;

  talon = #1#0;
  |PRINT;
  total = total + #1#9;
|FPRC;


|DEFBUCLE Leetalones;
 #1#1;
 5, 6, 1, 3, 16, 20;
 enEmpresa, #0#0, #0#2, #0#4, #0#6, #0#8, #0#14, #0#16;
 enEmpresa, #0#1, #0#3, #0#5, #0#7, #0#9, #0#15, #0#17;
 e;
 NULL, impresion;
|FIN;

|PROCESO HazTodo;
  |INFOR informe;
  |SI FSalida !  0; |ACABA; |FINSI;

  sw = 0;
  |ABRE #3;
  |BUCLE Leetalones;
  |CIERRA #3;
  |SI sw = 1;
      |PIEINF;
  |FINSI;

  |FININF;
|FPRC;


|CALCULO impre; |TIPO 3;

  |HAZ DirAplicSt;
  |SI Haybasica = 1; |Y #0#17 = "zz"; #0#17 = "99"; |FINSI;

  |IMPRE 0;
  |SI FSalida < 0; |ACABA; |FINSI;

   |SI #48#27 = "S";
       |HAZ MultiEmpresa;
   |SINO;
       |DFICE dirfich0; |QBF dirfich0;
       |HAZ HazTodo;
   |FINSI;
   |FINIMP;
|FCAL;
|| *****************************

|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #3 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
