|FICHEROS;
     gadm0000 #0;        ||Este Def
     caivases #2;
     calibros;

     :/modelos/def/dsmom030 #30;
|FIN;

|VARIABLES;
     nPorUno = 0;
     nPorDos = 0;
     nSalida = 0;
     &efFechaIVA = @;
     &enLineaIVA = 0;
     &enEjercicio = 0;
     &aTipoIVA = "";
     &enPorcIVA = 0;

     aFechaIVA = "";

     nAnyo = 0;
     aMensaje = "";
     nBoton = 0;
     nVent2 = 0;

     nRango = 0;
     nGrid  = 0;
     nVent  = 0;
     nHandle= 0;

     aEsc1  = "";
     aEsc2  = "";
     aRetu  = "";
     aTecla = "";
     aAlfa  = "";

     {-1}aVent     = "";
         aVent1    = 0;
         aVent2    = 0;
         aVent3    = 0;
         aVent4    = 0;
         aVent5    = "";
|FIN;

|PROCESO Tipo66C3;  |TIPO 66;
     |ABRE #30;
     |CONSULTA_CLAVE #1#30;
     |SI FSalida = 0;
         #0#3 = #30#0;    |PINTA #0#3;
         #0#4 = #30#1;    |PINTA #0#4;
     |FINSI;
     |CIERRA #30;
|FPRC;

|PROCESO Tipo7C1;  |TIPO 7;
     |ABRE #calibros;
     #calibros#0 = #0#0;
     |LEE 000#calibros.=;
     |SI FSalida ! 0;  |DDEFECTO #calibros;  |FINSI;
     |CIERRA #calibros;

     #0#1 = #calibros#1;    |PINTA #0#1;
     #0#5 = #calibros#2;
|FPRC;

|PROCESO Tipo0C3;  |TIPO 0;
     |ABRE #30;
     #30#0 = #0#3;
     |LEE 000#30=;
     |SI FSalida = 0;
         #0#3 = #30#0;    |PINTA #0#3;
         #0#4 = #30#1;    |PINTA #0#4;
     |SINO;
         |MENAV "0000El concepto no existe.";
         |ERROR;
     |FINSI;
     |CIERRA #30;
|FPRC;

|PROCESO Tipo66C2;  |TIPO 66;
     |ABRE #2;
     |CONSULTA_CLAVE #1#2;
     |SI FSalida = 0;
         #0#2 = #2#0;    |PINTA #0#2;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Tipo0C2;  |TIPO 0;
     |ABRET #2;
     #2#0 = #0#2;
     #2#1 = #0#5;
     |LEE 000#2=;
     |SI FSalida = 0;
         #0#2 = #2#0;    |PINTA #0#2;
     |SINO;
         |MENAV "0000La serie no existe.";
         |ERROR;
     |FINSI;
     |CIERRAT #2;
|FPRC;

|PROCESO SelTipoIVA1;  |TIPO 0;
     nSalida = FSalida;

     ||ARA39

     |ABRE #calibros;
     |DDEFECTO #calibros;
     #calibros#0 = #0#0;
     |LEE 000#calibros.=;
     aTipoIVA = #calibros#2;
     |CIERRA #calibros;
     |SI aTipoIVA = "N"; |ACABA; |FINSI;

     nAnyo = 2000 + #48#26;
     enEjercicio = nAnyo;
     aFechaIVA = "01.01." + nAnyo;
     efFechaIVA = aFechaIVA;

     |SI nSalida = 10;        ||F2;
          |HAZ SelecTipoIVA;
          #gadm0000#6 = enLineaIVA;
          |PINTA #gadm0000#6;
          |ERROR;
     |SINO;
          enLineaIVA = #gadm0000#6;
          |SI enLineaIVA ! 0;
               |HAZ SacaIVA;
               nPorUno = enPorcIVA;
          |SINO;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI enLineaIVA < 0;
          |MENAV "    Control de cuentas no definido";
          #gadm0000#6 = 0;
          |PINTA #gadm0000#6;
          |ERROR;
     |SINO;
          ||No deben de coincidir los % para tipos distintos

          |SI #gadm0000#7 = 0; |ACABA; |FINSI;

          |SI #gadm0000#6 = #gadm0000#7;
               |MENAV "0000No es posible indicar el mismo tipo de IVA";
               #gadm0000#6 = 0;
               |PINTA #gadm0000#6;
               |ERROR;
          |SINO;
               enLineaIVA = #gadm0000#7;
               |HAZ SacaIVA;
               nPorDos = enPorcIVA;
               |SI nPorUno = nPorDos;
                    aMensaje = "0000Ambos tipos de IVA tiene el mismo porcentaje : " + nPorUno + "%";
                    |MENAV aMensaje;
                    #gadm0000#6 = 0;
                    |PINTA #gadm0000#6;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO SelTipoIVA2;  |TIPO 0;
     nSalida = FSalida;

     ||ARA39

     |ABRE #calibros;
     |DDEFECTO #calibros;
     #calibros#0 = #0#0;
     |LEE 000#calibros.=;
     aTipoIVA = #calibros#2;
     |CIERRA #calibros;
     |SI aTipoIVA = "N"; |ACABA; |FINSI;

     nAnyo = 2000 + #48#26;
     enEjercicio = nAnyo;
     aFechaIVA = "01.01." + nAnyo;
     efFechaIVA = aFechaIVA;

     |SI nSalida = 10;        ||F2;
          |HAZ SelecTipoIVA;
          #gadm0000#7 = enLineaIVA;
          |PINTA #gadm0000#7;
          |ERROR;
     |SINO;
          enLineaIVA = #gadm0000#7;
          |SI enLineaIVA ! 0;
               |HAZ SacaIVA;
               nPorUno = enPorcIVA;
          |SINO;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI enLineaIVA < 0;
          |MENAV "    Control de cuentas no definido";
          #gadm0000#7 = 0;
          |PINTA #gadm0000#7;
          |ERROR;
     |SINO;
          ||No deben de coincidir los % para tipos distintos

          |SI #gadm0000#6 = 0; |ACABA; |FINSI;

          |SI #gadm0000#6 = #gadm0000#7;
               |MENAV "0000No es posible indicar el mismo tipo de IVA";
               #gadm0000#7 = 0;
               |PINTA #gadm0000#7;
               |ERROR;
          |SINO;
               enLineaIVA = #gadm0000#6;
               |HAZ SacaIVA;
               nPorDos = enPorcIVA;
               |SI nPorUno = nPorDos;
                    aMensaje = "0000Ambos tipos de IVA tiene el mismo porcentaje : " + nPorUno + "%";
                    |MENAV aMensaje;
                    #gadm0000#7 = 0;
                    |PINTA #gadm0000#7;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton;
     |VENTANA 0501, 2399, -1, 16, "Concepto IRPF por defecto";
     nVent2 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent2;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SUB_EJECUTA_NP "gadm0004";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent2;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent2;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
|FPRC;

|PROGRAMA;
     |DBASS aAlfa;  |QBF aAlfa;
     aAlfa = aAlfa + "dsarchi/def/dsarm001.mas";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;
         |MENAV "0000No tiene instalada la gesti¢n documental";
         |ACABA;
     |FINSI;

     |ABRE #0;

     |VENTANA 0501, 2399, -1, 16, "Parametrizacion Libros / Series";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     nRango = 1 + 4 + 8 + 16 + 32;

     |LINEAL_SIMPLE #1#0, nRango, 0502, 2198, NULL, NULL, NULL;
     nGrid = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,IRPF defecto", 2302, 2315, Boton;
     nBoton = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #0;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRO;
