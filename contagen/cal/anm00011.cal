|FICHEROS;
 anm00011 #0;

 anm00008 #1;  || Empresas Analiticas
 anm00009 #2;  || Lineas

 camaasil #3;
 anm00001 #4;

 cacuebal #5;
 cacuenta #6;

 anm00003 #7;  || Grupos Analitica
 anm00013 #13; || Grupos Analitica Apuntes

 :/modelos/def/dsmom035 #35;
 :/modelos/def/dsmom036 #8;

  cacuen01 #29;     ||LOS FICHEROS cacuenta para repondatos
  cacuen02 #22;     ||LOS FICHEROS cacuenta para repondatos
  cacuen03 #23;     ||LOS FICHEROS cacuenta para repondatos
  cacuen04 #24;     ||LOS FICHEROS cacuenta para repondatos
  cacuen05 #25;     ||LOS FICHEROS cacuenta para repondatos
  cacuen06 #26;     ||LOS FICHEROS cacuenta para repondatos

  canempre #30;
  catmpcu@ #99; || Cuentas de ahora

  anm0003@ #107;
  ca8m0002 #422;
  ca8cumay #410;
|FIN;

|VARIABLES;

  nSwError = 0;
  aAlfa1 = "";
  aAlfa2 = "";
  aAlfa3 = "";
  nNume1 = 0;
  nNume2 = 0;
  nPara1 = 0;
  nCampo = 0;

  nEmpAna   = 0;
  nPerAna   = 0;
  nDEmpresa = 0;
  nHEmpresa = 0;
  nDPeriodo = 0;
  nHPeriodo = 0;
  nInkey    = 0;
  nNumEm    = 0;
  nNumPe    = 0;

  nModo     = 0;

  aFich_or   = "";
  aFichero   = "";
  aDirInicio = "";
  aMas       = "";

  nSwCon     = 0;
  aMensa     = "";
  aMensa2    = "     No esta definida esta cuenta en Cuentas de Balance";

  nSwSel     = 0;
  nElNivel   = 0;

    lon1 = 0;
    lon2 = 0;
    lon3 = 0;
    lon4 = 0;
    lon5 = 0;
    lon6 = 0;
    aa = 0;
    aar = "";
    traba1 = "";
    traba2 = "";
    traba3 = "";
    traba4 = "";
    traba5 = "";
    traba6 = "";

  edn_desde = 0;
  edn_hasta = 0;
  edn_nume1 = 0;
  edn_error = 0;
  edn_trozo = "";
  edn_masca = "";
  edn_aAlfa1 = "";
  edn_cuent = "";

  lon = 0;
  prim = 0;
  a = 0;
  b = 0;
  c = 0;
  mesac = 0;
  mesfec = 0;
  mes = "";
  fecalf = "";
  ini = 0;
  errant = "aaaaaaaaaaaa";
  cuant = "";
  iniemp = 0;

    num = 0;
    cuant1 = "";
    cuant2 = "";
    cuant3 = "";
    cuant4 = "";
    cuant5 = "";
    cuant6 = "";
    mensaa = "";
    conforme = "";
    d_diari = 0;
    d_opera = "";
    d_impor = 0;

     x = 0;
     y = 0;

     fich = "";
     temporal1 = "";
     temporal2 = "";

     nSwGApte  = 0;
     nImporte  = 0;
     nImpGrupo = 0;
     nTp100    = 0;
     nTp100_G2 = 0;
     nSwOp     = 0;
     nSwSubgr  = 0;
     aCta2Gru  = "";
     edn_error2 = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoan_i;
|INCLUYE defec1_i;

|| ******************************************************************
|| ************ CALCULO Campos en Pantalla
|| ******************************************************************
|CALCULO QueSelec; |TIPO 0;
 |SI #0#1 = "S";
     aAlfa1 = "S";
     aAlfa2 = "N";
     |PDEFECTO #0, 37, 60;
 |SINO;
     aAlfa1 = "N";
     aAlfa2 = "S";
     |PDEFECTO #0,  2, 37;
     || ... #0#60 = "S"; |PINTA #0#60;
 |FINSI;
 |PARA nPara1 = 2; |SI nPara1 [ 36; |HACIENDO nPara1 = nPara1 + 1;
       |SI aAlfa1 = "N"; |PINTA #0nPara1; |FINSI;
       |SI nPara1 < 27; |C_M #0nPara1,1,aAlfa1; |FINSI;
 |SIGUE;
 || ... |C_M #0#60,1,aAlfa1;
 |PARA nPara1 = 37; |SI nPara1 [ 59; |HACIENDO nPara1 = nPara1 + 1;
       |SI nPara1 < 50; |C_M #0nPara1,1,aAlfa2; |FINSI;
       |SI aAlfa2 = "N"; |PINTA #0nPara1; |FINSI;
 |SIGUE;
|FCAL;

|CALCULO DesHasEm;  |TIPO 0;
 |C_M #0#2,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 |SI #0#2 = "N";
     #0#3 = 00001; |PINTA #0#3;
     #0#4 = 0;     |PINTA #0#4;
     #0#5 = 99999; |PINTA #0#5;
     #0#6 = 9;     |PINTA #0#6;
     aAlfa1 = "N";
     aAlfa2 = "S";
 |SINO;
     aAlfa1 = "S";
     aAlfa2 = "N";
     |PDEFECTO #0, 7, 37;
 |FINSI;
 |C_M #0#3,1,aAlfa1; |C_M #0#4,1,aAlfa1;
 |C_M #0#5,1,aAlfa1; |C_M #0#6,1,aAlfa1;
 |PARA nPara1 = 7; |SI nPara1 [ 36; |HACIENDO nPara1 = nPara1 + 1;
       |SI nPara1 < 27; |C_M #0nPara1,1,aAlfa2; |FINSI;
       |SI aAlfa2 = "N"; |PINTA #0nPara1; |FINSI;
 |SIGUE;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #0Campo = 0;
         nNume1   = Campo + 10;
         #0nNume1 = 0;  |C_M #0nNume1, 1, "N"; |PINTA #0nNume1;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               nNume1 = nCampo + 10;
               nNume2 = nCampo + 20;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N"; |PINTA #0nCampo;
               #0nNume1 = 0;  |C_M #0nNume1, 1, "N"; |PINTA #0nNume1;
               #0nNume2 = "";                        |PINTA #0nNume2;
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
               nNume1 = nCampo + 10;
               |C_M #0nCampo, 1, "S";
               |C_M #0nNume1, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|RUTINA nInf1;
 |SI FSalida = "POSICION";
     #1#0 = nEmpAna;
     #1#1 = nPerAna;
 |SINO;
     #1#0 = nDEmpresa;
     #1#1 = nDPeriodo;
 |FINSI;
|FRUT;

|RUTINA nSup1;
 #1#0 = nHEmpresa;
 #1#1 = nHPeriodo;
|FRUT;

|CALCULO LeeEmpAna; |TIPO 0;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;
     |SI #0Campo = 0; |ACABA; |FINSI;

     nInkey = FSalida;
     |SI Campo < 17; nNumEm = Campo;      nNumPe = Campo + 10; |FINSI;
     |SI Campo ] 17; nNumEm = Campo - 10; nNumPe = Campo;      |FINSI;
     nEmpAna = #0nNumEm;
     nPerAna = #0nNumPe;
     |SI #0nNumEm = 0; |Y nNumEm ! 7; |Y nInkey = 10;
         |ACABA;
     |FINSI;

     |ABRE #1;
     |SI nInkey = 10;
         nDEmpresa = 00001; nHEmpresa = 99999;
         nDPeriodo = 0;     nHPeriodo = 9;
         |SI Campo = nNumPe;
             nDEmpresa = nEmpAna; nHEmpresa = nEmpAna;
         |FINSI;
         |CONSULTA_F_CLAVE #1#1, nInf1, nSup1;
         #0nNumEm = #1#0; |PINTA #0nNumEm;
         #0nNumPe = #1#1; |PINTA #0nNumPe;
         |SI Campo = nNumPe;
             |ERROR;
         |FINSI;
     |FINSI;

     #1#0 = #0nNumEm;
     #1#1 = #0nNumPe;
     |SI Campo = nNumEm;
         |LEE 001#1];
     |SINO;
         |LEE 001#1=;
     |FINSI;
     |SI FSalida ! 0; |O #1#0 ! #0nNumEm;
         |MENAV "    Error. No Existe la Empresa Analitica";
         |ERROR;
     |SINO;
         nNume2 = nNumEm + 20;
         #0nNume2 = #1#4; |PINTA #0nNume2;
     |FINSI;
     |CIERRA #1;
|FCAL;

|| /////////////////////////////////////

|CALCULO DesHasCta;  |TIPO 0;
 |C_M #0#37,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |SI #0#37 = "N";
     #0#38 = "       "; |PINTA #0#38;
     #0#39 = "zzzzzzz"; |PINTA #0#39;
     aAlfa1 = "N";
     aAlfa2 = "S";
 |SINO;
     aAlfa1 = "S";
     aAlfa2 = "N";
     |PDEFECTO #0, 40, 60;
 |FINSI;
 |C_M #0#38,1,aAlfa1; |C_M #0#39,1,aAlfa1;
 |PARA nPara1 = 40; |SI nPara1 [ 59; |HACIENDO nPara1 = nPara1 + 1;
       |SI nPara1 < 50; |C_M #0nPara1,1,aAlfa2; |FINSI;
       |SI aAlfa2 = "N"; |PINTA #0nPara1; |FINSI;
 |SIGUE;
|FCAL;

|CALCULO NoMasCtas; |TIPO 0;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #0Campo = "       ";
         |PARA nCampo = Campo + 1;  |SI nCampo [ 49;  |HACIENDO nCampo = nCampo + 1;
               nNume1 = nCampo + 10;
               #0nCampo = ""; |C_M #0nCampo, 1, "N"; |PINTA #0nCampo;
               #0nNume1 = "";                        |PINTA #0nNume1;
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 49;  |HACIENDO nCampo = nCampo + 1;
               nNume1 = nCampo + 10;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|RUTINA nInf4;
 |SI FSalida = "POSICION";
     #4#0 = #0Campo;
 |SINO;
     #4#0 = "       ";
 |FINSI;
|FRUT;

|RUTINA nSup4;
 #4#0 = "zzzzzzz";
|FRUT;

|CALCULO LeeAna; |TIPO 0;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     nInkey = FSalida;
     salidas = FSalida;
     |HAZ FPuntosAna;

     |SI #0Campo = "       "; |Y Campo ! 40; |Y nInkey ! 10;
         |ACABA;
     |FINSI;

     |ABRE #4;
     |SI nInkey = 10;
         |CONSULTA_F_CLAVE #1#4, nInf4, nSup4;
         #0Campo = #4#0; |PINTA #0Campo;
     |FINSI;

     #4#0 = #0Campo;
     |LEE 001#4=;
     |SI FSalida ! 0;
         |MENAV "    Error. No Existe la Cuenta Analitica";
         |ERROR;
     |SINO;
         nNume2 = Campo + 10;
         #0nNume2 = #4#1; |PINTA #0nNume2;
     |FINSI;
     |CIERRA #4;
|FCAL;
|| //////////////////////////////////////////////////

|CALCULO LosDefectos; |TIPO 7;
 |SI nModo = 1;
     #0#65 = fec1; |PINTA #0#65;
     #0#66 = fec2; |PINTA #0#66;
 |FINSI;
|FCAL;

|CALCULO SelApte;
 aAlfa1 = #0Campo;
 |PARA nPara1 = 63; |SI nPara1 [ 81; |HACIENDO nPara1 = nPara1 + 1;
       |C_M #0nPara1,1,aAlfa1;
 |SIGUE;
 |SI aAlfa1 = "S";
    |C_M #0#69, 1, eaDepar;
    |C_M #0#70, 1, eaDepar;
    |C_M #0#71, 1, eaSubde;
    |C_M #0#72, 1, eaSubde;
    |C_M #0#73, 1, eaRefer;
    |C_M #0#74, 1, eaRefer;
 |FINSI;
 |SI aAlfa1 = "N";
     |PDEFECTO #0,63,82;
 |FINSI;
|FCAL;

|CALCULO Fecha; |TIPO 0;
   |C_M #0Campo,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI #0Campo > fec2;|O #0Campo < fec1;
      |MENAV "    Fecha fuera de Periodo ...";
      |ERROR;
   |SINO;
      |SI Campo = 66; |Y #0#65 > #0#66;
          |MENAV "    Fecha Erronea ... ";
          |ERROR;
      |FINSI;
   |FINSI;
|FCAL;

|CALCULO SelConcp; |TIPO 0;
   |C_M #0Campo,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI #0#77 = "N";
       |C_M #0#75, 1, "S"; |C_M #0#76, 1, "S";

       |C_M #0#78, 1, "N"; |C_M #0#79, 1, "N";
       |C_M #0#80, 1, "N"; |C_M #0#81, 1, "N";
       #0#78 = 0; |PINTA #0#78;
       #0#79 = 0; |PINTA #0#79;
       #0#80 = 0; |PINTA #0#80;
       #0#81 = 0; |PINTA #0#81;
   |SINO;
       |C_M #0#75, 1, "N"; |C_M #0#76, 1, "N";
       #0#75 = 1;   |PINTA #0#75;
       #0#76 = 999; |PINTA #0#76;

       |C_M #0#78, 1, "S"; |C_M #0#79, 1, "S";
       |C_M #0#80, 1, "S"; |C_M #0#81, 1, "S";
   |FINSI;
|FCAL;

|RUTINA nInf35;
 #35#0 = 00;
|FRUT;

|RUTINA nSup35;
 #35#0 = 99;
|FRUT;

|CALCULO LeeGrupo; |TIPO 0;
 |C_M #0Campo,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 nInkey = FSalida;

 |SI FSalida = 2; |ACABA; |FINSI;
 |SI #0Campo = 0; |ACABA; |FINSI;

 |ABRE #35;
 |SI nInkey = 10;
     |CONSULTA_F_CLAVE #1#35, nInf35, nSup35;
     #0Campo = #35#0; |PINTA #0Campo;
 |FINSI;

 #35#0 = #0Campo;
 |LEE 001#35=;
 |SI FSalida ! 0;
     |MENAV "     NO existe el Grupo de Conceptos";
     |ERROR;
 |FINSI;
 |CIERRA #35;
|FCAL;

|| ******************************************************************
|| ******************************************************************
|| ******************************************************************
|| ------------------------------------------------------------
|CALCULO edig_ana2;
    edn_desde = #2#3;                  || a partir de ...
    edn_hasta = #2#4;                  || nro. digitos
    edn_masca = #2#5;  |QBF edn_masca; || mascara
    edn_nume1 = (edn_desde * 100) + edn_hasta;
    edn_trozo = edn_nume1;
    edn_error = 0;
    edn_aAlfa1 = edn_cuent % edn_trozo;  || mascara
    |SI edn_aAlfa1 ! edn_masca;|Y edn_desde ! 0;|Y edn_hasta ! 0;
        edn_error = 1;                  || no es valida la cuenta
        |ERROR10;
    |FINSI;
|FCAL;

|DEFBUCLE edig_ana1;
 #2#1;
 ;
 #1#0, #1#1, 000;
 #1#0, #1#1, 999;
 e;
 NULL, edig_ana2;
|FIN;

|PROCESO LasEmpAna1;
 || ... Tengo una empresa Seleccionada
 edn_error = 1;
 |BUCLE edig_ana1;
 |SI edn_error = 0;
     |ERROR10;       || Pertenece a esta empresa
 |FINSI;
|FPRC;

|DEFBUCLE LasEmpAna;
 #1#1;
 ;
 nDEmpresa, nDPeriodo;
 nHEmpresa, nHPeriodo;
 e;
 NULL, LasEmpAna1;
|FIN;

|PROCESO edig_ana;  ||Seleccion de la Cuenta analitica

 |SI #0#1 = "N";    ||Seleccion desde Hasta Cuenta analitica
     edn_error = 0;
     |SI #0#37 = "S";
         |SI #0#38 > edn_cuent;  |O #0#39 < edn_cuent;
             edn_error = 1;
         |FINSI;
     |SINO;
         edn_error = 1;
         |PARA nPara1 = 40; |SI nPara1 [ 49; |HACIENDO nPara1 = nPara1 + 1;
               |SI #0nPara1 ! "       ";
                   |SI #0nPara1 = edn_cuent;
                       edn_error = 0;
                   |FINSI;
               |FINSI;
         |SIGUE;
     |FINSI;
 |SINO;
     |SI #0#2 = "S";
         edn_error = 1;
         nDEmpresa = #0#3; nDPeriodo = #0#4;
         nHEmpresa = #0#5; nHPeriodo = #0#6;
         |BUCLE LasEmpAna;
     |SINO;
         |PARA nPara1 = 7; |SI nPara1 [ 16; |HACIENDO nPara1 = nPara1 + 1;
               |SI #0nPara1 ! 0;
                   edn_error = 1;
                   nNume2 = nPara1 + 10;
                   nDEmpresa = #0nPara1; nDPeriodo = #0nNume2;
                   nHEmpresa = #0nPara1; nHPeriodo = #0nNume2;
                   |BUCLE LasEmpAna;
                   |SI edn_error = 0;  |SAL;  |FINSI;
               |FINSI;
         |SIGUE;
     |FINSI;
 |FINSI;

|FPRC;

|| ... Segundo nivel de grupos
|CALCULO ver_grupo2;
 edn_cuent = #107#2;
 |HAZ edig_ana;
 |SI edn_error = 0;
     nTp100_G2  = nTp100_G2 + #107#4;
     edn_error2 = 0;
 |FINSI;
|FCAL;

|DEFBUCLE selegrupo2;
 #107#1002;
 ;
 aCta2Gru, 000;
 aCta2Gru, 999;
 e;
 NULL, ver_grupo2;
|FIN;
|| ...................................

|PROCESO ver_grupo_apte;
 nSwGApte  = 1;

 edn_cuent = #13#6;
 |HAZ edig_ana;
 |SI edn_error = 0;
     nSwSel = 1;
     nImporte = nImporte + #13#9;
 |SINO;
     aAlfa1 = #13#6 % 103;
     |SI aAlfa1 = "GRU";
          edn_error2 = 1;
          aCta2Gru   = #13#6;
          nImpGrupo  = #13#9;
          nTp100_G2  = 0;
          |BUCLE selegrupo2;
          |SI edn_error2 = 0;
              nSwSel = 1;
              |SI nTp100_G2 ! 0;
                  nImpGrupo = (nImpGrupo % nTp100_G2) ! EURODB;
                  nImporte  = nImporte + nImpGrupo;
              |FINSI;
          |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE selgruApte;
 #13#1;
 ;
 #3#0, #3#1, #3#2, #3#3, #3#29, 000;
 #3#0, #3#1, #3#2, #3#3, #3#29, 999;
 e;
 NULL, ver_grupo_apte;
|FIN;

|CALCULO ver_grupo;

 edn_cuent = #7#2;
 |HAZ edig_ana;

 |SI nSwOp = 0;
     |SI edn_error = 0;
         nSwSel = 1;
         nTp100 = nTp100 + #7#4;
     |SINO;
         aAlfa1 = #7#2 % 103;
         |SI aAlfa1 = "GRU";
             nSwSubgr = 1;
         |FINSI;
      |FINSI;
 |SINO;
     |SI edn_error ! 0;
         aAlfa1 = #7#2 % 103;
         |SI aAlfa1 = "GRU";
             edn_error2 = 1;
             aCta2Gru   = #7#2;
             nImpGrupo  = (#3#9 % #7#4) ! EURODB;
             nTp100_G2  = 0;
             |BUCLE selegrupo2;
             |SI edn_error2 = 0;
                 nSwSel = 1;
                 |SI nTp100_G2 ! 0;
                     nImpGrupo = (nImpGrupo % nTp100_G2) ! EURODB;
                     nImporte  = nImporte + nImpGrupo;
                 |FINSI;
             |FINSI;
         |FINSI;
    |FINSI;

  |FINSI;
|FCAL;

|DEFBUCLE selegrupo;
 #7#1;
 ;
 #3#29, 000;
 #3#29, 999;
 e;
 NULL, ver_grupo;
|FIN;

|PROCESO cuenta_ana;
 nSwSel    = 0;
 edn_error = 0;

 edn_cuent = #3#29;
 |HAZ edig_ana;
 |SI edn_error = 0;
     nSwSel = 1;
 |SINO;
     aAlfa3 = #3#29 % 103;    || Miro si es un grupo, puede ser una cta int.
     |SI aAlfa3 = "GRU";
         nSwGApte = 0;
         nTp100   = 100;
         nImporte = 0;
         |BUCLE selgruApte;
         |SI nSwGApte = 0;      || no existe reparto del grupo en apuntes
             nSwSubgr = 0;
             nSwOp    = 0;
             nImporte = #3#9;
             nTp100   = 0;
             |BUCLE selegrupo;
             |SI nSwSubgr = 1;  ||existe algun subgrupo, vuelvo a calcular importe
                 nSwOp    = 1;
                 nImporte = 0;
                 |SI nTp100 ! 0;
                     nImporte = (#3#9 % nTp100) ! EURODB;
                 |FINSI;
                 nTp100   = 100;
                 |BUCLE selegrupo;
             |FINSI;
         |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO conceptos;
  |SI #0#77 = "N"; |ACABA; |FINSI;
  nSwCon = 0;
  |ABRE #8;
  |PARA y = 78; |SI y [ 81; |HACIENDO y = y + 1;
        |SI #0y ! 0;
            #8#0 = #0y;
            #8#1 = #3#6;
            |LEE 001#8=;
            |SI FSalida = 0;  nSwCon = 1; |FINSI;
        |FINSI;
        |SI nSwCon = 1; |SAL; |FINSI;
  |SIGUE;
  |CIERRA #8;
|FPRC;

|PROCESO actuali;

  aAlfa1 = #3#29; |QBF aAlfa1;
  |SI aAlfa1 = ""; |ACABA; |FINSI;  || si no hay cuenta analitica, sale

  |SI #0#62 = "S";
       |SI Haybasica = 0
           |SI #3#21 < #0#69; |O #3#21 > #0#70;
               |ACABA;
           |FINSI;
       |SINO;
           nDepar = #3#21; |SI nDepar = 0;  nDepar = 1;   |FINSI;
           |SI nDepar < #0#69; |O nDepar > #0#70;  ||desde/hasta actividad
               |ACABA;
           |FINSI;
       |FINSI;
       |SI #3#28 < #0#71; |O #3#28 > #0#72; |ACABA; |FINSI;
  |FINSI;

  nSwCon = 1;
  |HAZ conceptos;
  |SI nSwCon = 0; |ACABA; |FINSI;

  nImpGrupo = 0;
  nImporte = #3#9;
  nTp100   = 100;
  |HAZ cuenta_ana;
  |SI nSwSel = 0; |ACABA; |FINSI;

  |SI nTp100 ! 100;
      nImporte = (nImporte % nTp100) ! EURODB;
  |FINSI;

  aar = lon1;  traba1 = #3#4 % aar;            || coge cuenta1
  aar = lon2;  traba2 = #3#4 % aar;            || coge cuenta2
  aar = lon3;  traba3 = #3#4 % aar;            || coge cuenta3
  aar = lon4;  traba4 = #3#4 % aar;            || coge cuenta4
  aar = lon5;  traba5 = #3#4 % aar;            || coge cuenta5
  aar = lon6;  traba6 = #3#4 % aar;            || coge cuenta6
  |SI lon1 = 100;  traba1 = "";  cuant1 = "";  |FINSI;
  |SI lon2 = 100;  traba2 = "";  cuant2 = "";  |FINSI;
  |SI lon3 = 100;  traba3 = "";  cuant3 = "";  |FINSI;
  |SI lon4 = 100;  traba4 = "";  cuant4 = "";  |FINSI;
  |SI lon5 = 100;  traba5 = "";  cuant5 = "";  |FINSI;
  |SI lon6 = 100;  traba6 = "";  cuant6 = "";  |FINSI;
  |SI prim = 0;
      |DDEFECTO #29;
      |DDEFECTO #22;
      |DDEFECTO #23;
      |DDEFECTO #24;
      |DDEFECTO #25;
      |DDEFECTO #26;
      |SI lon1 ! 100;  |Y #3#5 ] 1;
          cuant1 = traba1;
          #6#0 = cuant1;  #6#1 = 1;
          cuant = #6#0;   nElNivel = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #29;
      |FINSI;
      |SI lon2 ! 100;  |Y #3#5 ] 2;
          cuant2 = traba2;
          #6#0 = cuant2;  #6#1 = 2;
          cuant = #6#0;   nElNivel = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #22;
      |FINSI;
      |SI lon3 ! 100;  |Y #3#5 ] 3;
          cuant3 = traba3;
          #6#0 = cuant3;  #6#1 = 3;
          cuant = #6#0;   nElNivel = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #23;
      |FINSI;
      |SI lon4 ! 100;  |Y #3#5 ] 4;
          cuant4 = traba4;
          #6#0 = cuant4;  #6#1 = 4;
          cuant = #6#0;   nElNivel = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #24;
      |FINSI;
      |SI lon5 ! 100;  |Y #3#5 ] 5;
          cuant5 = traba5;
          #6#0 = cuant5;  #6#1 = 5;
          cuant = #6#0;   nElNivel = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #25;
      |FINSI;
      |SI lon6 ! 100;  |Y #3#5 ] 6;
          cuant6 = traba6;
          #6#0 = cuant6;  #6#1 = 6;
          cuant = #6#0;   nElNivel = #6#1;
          |HAZ leecuenta;
          |SALVA_DATOS #6;
          |REPON_DATOS #26;
      |FINSI;
      prim = 1;
  |FINSI;
  |SI cuant6 ! traba6;
      #6#0 = #26#0;  #6#1 = #26#1;
      |LEE 101#6=;
      |SALVA_DATOS #26;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant6 = traba6;
      #6#0 = cuant6;  #6#1 = 6;
      cuant = #6#0;   nElNivel = #6#1;
      |SI nElNivel [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 6;  |O #6#3 = "S";
              aMensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,aMensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #26;
      |SINO;
          |DDEFECTO #26;
      |FINSI;
  |FINSI;
  |SI cuant5 ! traba5;
      #6#0 = #25#0;  #6#1 = #25#1;
      |LEE 101#6=;
      |SALVA_DATOS #25;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant5 = traba5;
      #6#0 = cuant5;  #6#1 = 5;
      cuant = #6#0;   nElNivel = #6#1;
      |SI nElNivel [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 5;  |O #6#3 = "S";
              aMensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,aMensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #25;
      |SINO;
          |DDEFECTO #25;
      |FINSI;
  |FINSI;
  |SI cuant4 ! traba4;
      #6#0 = #24#0;  #6#1 = #24#1;
      |LEE 101#6=;
      |SALVA_DATOS #24;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant4 = traba4;
      #6#0 = cuant4;  #6#1 = 4;
      cuant = #6#0;   nElNivel = #6#1;
      |SI nElNivel [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 4;  |O #6#3 = "S";
              aMensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,aMensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #24;
      |SINO;
          |DDEFECTO #24;
      |FINSI;
  |FINSI;
  |SI cuant3 ! traba3;
      #6#0 = #23#0;  #6#1 = #23#1;
      |LEE 101#6=;
      |SALVA_DATOS #23;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant3 = traba3;
      #6#0 = cuant3;  #6#1 = 3;
      cuant = #6#0;   nElNivel = #6#1;
      |SI nElNivel [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 3;  |O #6#3 = "S";
              aMensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,aMensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #23;
      |SINO;
          |DDEFECTO #23;
      |FINSI;
  |FINSI;
  |SI cuant2 ! traba2;
      #6#0 = #22#0;  #6#1 = #22#1;
      |LEE 101#6=;
      |SALVA_DATOS #22;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant2 = traba2;
      #6#0 = cuant2;  #6#1 = 2;
      cuant = #6#0;   nElNivel = #6#1;
      |SI nElNivel [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 2;  |O #6#3 = "S";
              aMensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,aMensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #22;
      |SINO;
          |DDEFECTO #22;
      |FINSI;
  |FINSI;
  |SI cuant1 ! traba1;
      #6#0 = #29#0;  #6#1 = #29#1;
      |LEE 101#6=;
      |SALVA_DATOS #29;
      |REPON_DATOS #6;
      |GRABA 101#6a;
      cuant1 = traba1;
      #6#0 = cuant1;  #6#1 = 1;
      cuant = #6#0;   nElNivel = #6#1;
      |SI nElNivel [ #3#5;
          |HAZ leecuenta;
          |SI #30#13 = 1;  |O #6#3 = "S";
              aMensa = " Recuperando Cuenta: " + #6#0 + "      ";
              |PINTA 2210,aMensa;
          |FINSI;
          |SALVA_DATOS #6;
          |REPON_DATOS #29;
      |SINO;
          |DDEFECTO #29;
      |FINSI;
  |FINSI;

  |HAZ suma;
  |SI #3#8 = "D";
      #6#51  = #6#51  + nImporte;
      #29#51 = #29#51 + nImporte;
      #22#51 = #22#51 + nImporte;
      #23#51 = #23#51 + nImporte;
      #24#51 = #24#51 + nImporte;
      #25#51 = #25#51 + nImporte;
      #26#51 = #26#51 + nImporte;
  |SINO;
      #6#52  = #6#52  + nImporte;
      #29#52 = #29#52 + nImporte;
      #22#52 = #22#52 + nImporte;
      #23#52 = #23#52 + nImporte;
      #24#52 = #24#52 + nImporte;
      #25#52 = #25#52 + nImporte;
      #26#52 = #26#52 + nImporte;
  |FINSI;
  #6#53  = #6#51  - #6#52;
  #29#53 = #29#51 - #29#52;
  #22#53 = #22#51 - #22#52;
  #23#53 = #23#51 - #23#52;
  #24#53 = #24#51 - #24#52;
  #25#53 = #25#51 - #25#52;
  #26#53 = #26#51 - #26#52;
|FPRC;

|DEFBUCLE cacreane1;
 #3#3;
 0,6,26;
 "            ", #0#65, #0#67, 0001, #0#63, #0#75, #0#73;
 "zzzzzzzzzzzz", #0#66, #0#68, 9999, #0#64, #0#76, #0#74;
 be;
 NULL, actuali;
|FIN;

|PROCESO HazTodo;
  |PINTA 2410,"Creando acumulados ... ";

  |NOME_DAT #6  aFichero;
  |NOME_DAT #29 aFichero;
  |NOME_DAT #22 aFichero;
  |NOME_DAT #23 aFichero;
  |NOME_DAT #24 aFichero;
  |NOME_DAT #25 aFichero;
  |NOME_DAT #26 aFichero;

  |ABRE #6;
  |ABRE #99;

  prim = 0;
  lon1 = 100;  lon2 = 100;  lon3 = 100;
  lon4 = 100;  lon5 = 100;  lon6 = 100;
  |SI #30#13 ] 1; lon1 = 100 + #30#14; |FINSI;
  |SI #30#13 ] 2; lon2 = 100 + #30#15; |FINSI;
  |SI #30#13 ] 3; lon3 = 100 + #30#16; |FINSI;
  |SI #30#13 ] 4; lon4 = 100 + #30#17; |FINSI;
  |SI #30#13 ] 5; lon5 = 100 + #30#18; |FINSI;
  |SI #30#13 ] 6; lon6 = 100 + #30#19; |FINSI;
  prim = 0;
  |BUCLE cacreane1;
  |SI lon6 ! 100;
       #6#0 = #26#0;  #6#1 = #26#1;
       |LEE 101#6=;
       |SALVA_DATOS #26;
       |REPON_DATOS #6;
       |GRABA 101#6a;
   |FINSI;
   |SI lon5 ! 100;
       #6#0 = #25#0;  #6#1 = #25#1;
       |LEE 101#6=;
       |SALVA_DATOS #25;
       |REPON_DATOS #6;
       |GRABA 101#6a;
   |FINSI;
   |SI lon4 ! 100;
       #6#0 = #24#0;  #6#1 = #24#1;
       |LEE 101#6=;
       |SALVA_DATOS #24;
       |REPON_DATOS #6;
       |GRABA 101#6a;
   |FINSI;
   |SI lon3 ! 100;
       #6#0 = #23#0;  #6#1 = #23#1;
       |LEE 101#6=;
       |SALVA_DATOS #23;
       |REPON_DATOS #6;
       |GRABA 101#6a;
   |FINSI;
   |SI lon2 ! 100;
       #6#0 = #22#0;  #6#1 = #22#1;
       |LEE 101#6=;
       |SALVA_DATOS #22;
       |REPON_DATOS #6;
       |GRABA 101#6a;
   |FINSI;
   |SI lon1 ! 100;
       #6#0 = #29#0;  #6#1 = #29#1;
       |LEE 101#6=;
       |SALVA_DATOS #29;
       |REPON_DATOS #6;
       |GRABA 101#6a;
   |FINSI;
   |CIERRA #6;
   |CIERRA #99;
|FPRC;

|| -------------------------
|PROCESO acumulados;
   |PDEFECTO #6,9,54;
   |GRABA 020#6a;
   |LIBERA #6;
|FPRC;

|DEFBUCLE cacreano0;     || acera las cuentas
   #6#1;
   ;
   "            ";
   "999999999999";
   be;
   NULL, acumulados;
|FIN;
||  --------------------------------------------

|CALCULO ElPase; |TIPO 3;

 |SI Haybasica = 1;
     |SI #0#70 = "zz"; #0#70 = "99"; |FINSI;
 |FINSI;

 |DBASS aDirInicio;
 aMas  = aDirInicio + "contagen/def/cacuenta";
 |CARGA_DEF aMas, catmpcu@;
 |SI FSalida ! 0;
     |MENAV "    Error Cargado Fichero de Cuentas. Proceso Interrumpido";
     nSwError = 1;
     |ACABA;
 |FINSI;

 aMas  = aDirInicio + "contagen/def/anm00003";
 |CARGA_DEF aMas, anm0003@;
 |SI FSalida ! 0;
     |MENAV "    Error Cargado Fichero de Grupos Analiticos. Proceso Interrumpido";
     nSwError = 1;
     |DESCARGA_DEF #catmpcu@;
     |ACABA;
 |FINSI;

 aFichero = eaUsuAna;
 aFich_or = "cacuenta";

 |HAZ copiando;
 |NOME_DAT #6 aFichero;
 |PINTA 2410,"Poniendo a cero el Plan Contable";
 |BUCLE cacreano0;

 |HAZ HazTodo;
 |DESCARGA_DEF #107;
 |DESCARGA_DEF #99;
|FCAL;

|| *************************************************************************

|PROGRAMA;

  eaParAna = PARAMETRO; |QBF eaParAna;

  |CLS;
  |CABEZA "Balances de Analitica";
  |HAZ inicio;
  |HAZ Analitica;
  |SI  enSwAna = 0;
       aAlfa1 = "    CONTABILIDAD NO ANALITICA ";
       |SI eaAnNiv = "E";
           aAlfa1 = "    EMPRESA NO ANALITICA ";
       |FINSI;
       |MENAV aAlfa1;
       |ACABA;
  |FINSI;
  |HAZ DirAplicSt;

  nModo = 0;
  aAlfa1 = Usuario % 807;
  eaUsuAna = ("n" + aAlfa1 + "zzzzzzzz") % 108;
  |ABRE #0;
  #0#0 = eaUsuAna;
  |LEE 101#0=;
  |SI FSalida = 0;
      aAlfa2 = #0#82;
      aAlfa1 = "    NYa Existe un Fichero de Este Usuario, con fecha: ";
      aAlfa1 = aAlfa1 + aAlfa2;
      aAlfa1 = aAlfa1 + ". Desea volver a Crearlo S/N ";
      |CONFI aAlfa1;
      |SI FSalida ! 0;
          |LIBERA #0;
          |CIERRA #0;
          |VETE AlPrograma;
      |FINSI;
  |SINO;
      |DDEFECTO #0;
      #0#0 = eaUsuAna;
      |GRABA 020#0b;
      nModo = 1;
  |FINSI;
  |PINPA #0#0;
  |PINDA #0#0;

  |ENDATOS #1#0;
  |SI FSalida = 0; |Y nSwError = 0;
      #0#82 = ~;
      |GRABA 020#0a;
  |SINO;
      nSwError = 1;
  |FINSI;
  |LIBERA #0;
  |CIERRA #0;

  |ET AlPrograma;
  |SI eaParAna ! ""; |Y nSwError = 0;
      eaNomAna = #0#61; |QBF eaNomAna;
      aAlfa1 = eaParAna + ";Analitica";
      |SUB_EJECUTA aAlfa1;
  |FINSI;
|FPRO;

|| ***********************************************************************

|PROCESO copiando;
   |DFICE fich;
   temporal1 = fich + aFich_or + ".ixx";
   temporal2 = fich + aFichero + ".ixx";
   |COPIA_FICHERO temporal1,temporal2;
   |SI FSalida ! 0;  |ACABA;  |FINSI;
   temporal1 = fich + aFich_or + ".dat";
   temporal2 = fich + aFichero + ".dat";
   |COPIA_FICHERO temporal1,temporal2;
   |SI FSalida ! 0;
      temporal2 = fich + aFichero + ".ixx";
      |FBORRA temporal2;
      |ACABA;
   |FINSI;
   temporal1 = fich + aFich_or + ".ddx";
   temporal2 = fich + aFichero + ".ddx";
   |COPIA_FICHERO temporal1,temporal2;
|FPRC;


|CALCULO leecuenta;
  |LIBERA #6;
  |LEE 101#6=;
  |SI FSalida ! 0;
      |LIBERA #6;
      |DDEFECTO #6;
      #99#0 = cuant;
      |LEE 001#99=;
      |SI FSalida = 0;
          #6#0 = #99#0;    #6#1 = #99#1;
          eaCuenta = #6#0; |HAZ SacaNivel; #6#1 = enNivel;
          #6#2 = #99#2;    #6#3 = #99#3;
          #6#4 = #99#4;    #6#5 = #99#5;
          #6#6 = #99#6;    #6#7 = #99#7;
          #6#8 = #99#8;    #6#54 = #99#54;
          #6#55 = #99#55;  #6#56 = #99#56;
          #6#57 = #99#57;
      |SINO;
          |HAZ pidealta;
      |FINSI;
      |GRABA 020#6b;
  |FINSI;
|FCAL;

|CALCULO pidealta;
      #6#0 = cuant;
      #6#1 = nElNivel;
      |HAZ defect1;
      |PUSHV 0501 1980;
      |PINPA #0#6;
      |PINDA #0#6;
      |ENDATOS #1#6;
      |SI FSalida ! 0;
          |DDEFECTO #6;
          #6#0 = cuant;
          #6#1 = nElNivel;
      |FINSI;
      |POPV;
|FCAL;


|CALCULO suma;
  |SI #3#1 > #6#58;   #6#58  = #3#1;  |FINSI;
  |SI #3#1 > #29#58;  #29#58 = #3#1;  |FINSI;
  |SI #3#1 > #22#58;  #22#58 = #3#1;  |FINSI;
  |SI #3#1 > #23#58;  #23#58 = #3#1;  |FINSI;
  |SI #3#1 > #24#58;  #24#58 = #3#1;  |FINSI;
  |SI #3#1 > #25#58;  #25#58 = #3#1;  |FINSI;
  |SI #3#1 > #26#58;  #26#58 = #3#1;  |FINSI;
  |SI #3#0 ! 0;|Y #3#0 ! 99;
      ini = #30#11;
      fecalf = #3#1;
      mes = fecalf % 402;
      mesfec = mes;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
      a = (mesac * 3) + 9;
      b = a + 1;
      c = a + 2;
      |SI #3#8 = "D";
          #6a    = #6a    + nImporte;
          #6c    = #6a    - #6b;
          #29a   = #29a   + nImporte;
          #29c   = #29a   - #29b;
          #22a   = #22a   + nImporte;
          #22c   = #22a   - #22b;
          #23a   = #23a   + nImporte;
          #23c   = #23a   - #23b;
          #24a   = #24a   + nImporte;
          #24c   = #24a   - #24b;
          #25a   = #25a   + nImporte;
          #25c   = #25a   - #25b;
          #26a   = #26a   + nImporte;
          #26c   = #26a   - #26b;
          |ACABA;
      |FINSI;
      #6b    = #6b    + nImporte;
      #6c    = #6a    - #6b;
      #29b   = #29b   + nImporte;
      #29c   = #29a   - #29b;
      #22b   = #22b   + nImporte;
      #22c   = #22a   - #22b;
      #23b   = #23b   + nImporte;
      #23c   = #23a   - #23b;
      #24b   = #24b   + nImporte;
      #24c   = #24a   - #24b;
      #25b   = #25b   + nImporte;
      #25c   = #25a   - #25b;
      #26b   = #26b   + nImporte;
      #26c   = #26a   - #26b;
      |ACABA;
  |FINSI;
  |SI #3#0 = 0;
      |SI #3#8 = "D";
          #6#9   = #6#9   + nImporte;
          #6#11  = #6#9   - #6#10;
          #29#9  = #29#9  + nImporte;
          #29#11 = #29#9  - #29#10;
          #22#9  = #22#9  + nImporte;
          #22#11 = #22#9  - #22#10;
          #23#9  = #23#9  + nImporte;
          #23#11 = #23#9  - #23#10;
          #24#9  = #24#9  + nImporte;
          #24#11 = #24#9  - #24#10;
          #25#9  = #25#9  + nImporte;
          #25#11 = #25#9  - #25#10;
          #26#9  = #26#9  + nImporte;
          #26#11 = #26#9  - #26#10;
          |ACABA;
      |FINSI;
      #6#10  = #6#10  + nImporte;
      #6#11  = #6#9   - #6#10;
      #29#10 = #29#10 + nImporte;
      #29#11 = #29#9  - #29#10;
      #22#10 = #22#10 + nImporte;
      #22#11 = #22#9  - #22#10;
      #23#10 = #23#10 + nImporte;
      #23#11 = #23#9  - #23#10;
      #24#10 = #24#10 + nImporte;
      #24#11 = #24#9  - #24#10;
      #25#10 = #25#10 + nImporte;
      #25#11 = #25#9  - #25#10;
      #26#10 = #26#10 + nImporte;
      #26#11 = #26#9  - #26#10;
      |ACABA;
  |FINSI;
  |SI #3#8 = "D";
      #6#48 = #6#48 + nImporte;
      #6#50 = #6#48 - #6#49;
      #29#48 = #29#48 + nImporte;
      #29#50 = #29#48 - #29#49;
      #22#48 = #22#48 + nImporte;
      #22#50 = #22#48 - #22#49;
      #23#48 = #23#48 + nImporte;
      #23#50 = #23#48 - #23#49;
      #24#48 = #24#48 + nImporte;
      #24#50 = #24#48 - #24#49;
      #25#48 = #25#48 + nImporte;
      #25#50 = #25#48 - #25#49;
      #26#48 = #26#48 + nImporte;
      #26#50 = #26#48 - #26#49;
      |ACABA;
  |FINSI;
  #6#49  = #6#49  + nImporte;
  #6#50  = #6#48  - #6#49;
  #29#49 = #29#49 + nImporte;
  #29#50 = #29#48 - #29#49;
  #22#49 = #22#49 + nImporte;
  #22#50 = #22#48 - #22#49;
  #23#49 = #23#49 + nImporte;
  #23#50 = #23#48 - #23#49;
  #24#49 = #24#49 + nImporte;
  #24#50 = #24#48 - #24#49;
  #25#49 = #25#49 + nImporte;
  #25#50 = #25#48 - #25#49;
  #26#49 = #26#49 + nImporte;
  #26#50 = #26#48 - #26#49;
|FCAL;
