|FICHEROS;
     gadz0002;

     gadm0001;
     gadm0002;
     gadm0003;

     gadw0001;
     gadw0002;
     gadw0003;

     cainliva;

     :dsarchi/dpntm100;
     :dsarchi/dpntm101;
     :dsarchi/dpntm102;
     :dsarchi/dpntm103;
     :dsarchi/dsarm005;
     :dsarchi/dsarm034;
     :basica/agicen14;

     agifa134@;
     agifa084@;
     agifa079@;

     &facturas@;
|FIN;

|VARIABLES;
     nEmp48              = 0;
     nRegistro           = 0;
     nAux                = 0;
     nCampo              = 0;
     nCampo1             = 0;
     nFichero            = 0;
     nPanta              = 0;
     nSubPan             = 0;
     n1Vent              = 0;
     n2Vent              = 0;
     nRango              = 0;
     nVent               = -1;
     nReg                = 0;
     nGrid1              = 0;
     nGrid2              = 0;
     nGrid3              = 0;
     nGrid4              = 0;
     nGrid5              = 0;
     nBoton1             = -1;
     nBoton2             = -1;
     nBoton3             = -1;
     nBoton4             = -1;
     nBoton5             = -1;
     nBoton6             = -1;
     nBoton7             = -1;
     nBoton8             = -1;
     nBoton9             = -1;
     nBoton10            = -1;
     nBoton11            = -1;
     nBoton12            = -1;
     nBoton13            = -1;
     nBoton14            = -1;
     nBotonMod           = -1;
     nQueBoton           = -1;
     nBotonSalir         = -1;
     nIdSalir            = -1;
     nDocu               = 0;
     nNoHagasNa          = 0;

     nLabel1             = -1;
     nLabel2             = -1;
     nLabel3             = -1;
     nHandle             = 0;
     nHandle1            = 0;
     nHandle2            = 0;
     nCorreo             = 0;
     nLong               = 0;
     nPos                = 0;
     nPosi               = 0;
     nLLave              = 0;
     nRegilla            = 0;
     nTipoEntrada        = 0;
     nDsCorreo           = 0;
     nEndatos            = 0;
     nTree               = 0;
     nOpcion             = 0;

     aAlfa               = "";
     aAlfa1              = "";
     aPara               = "";
     aAsunto             = "";
     aFicheroAdjunto     = "";
     aEjecuta            = "";
     aNombre             = "";
     aBasePla            = "";
     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aBase               = "";
     aDirLocal           = "";
     aFotoOrigen         = "";
     aFotoDestino        = "";
     aExt                = "";
     aNLogo              = "";
     aDocRemoto          = "";
     aDocServidor        = "";
     aIPRemoto           = "";
     aLong               = "";
     aTo                 = "";
     aFrase              = "";
     aDirec              = "";
     aCarac              = "";
     aConten             = "";
     aMas                = "";
     aDef                = "";
     aReg                = "";
     aBaseMensaje        = "";
     aCarac10            = "";
     aAbre               = "";
     aFichero            = "";
     aIP                 = "";
     aSalida             = "";
     aFrom               = "";
     aMensaje            = "";
     aAutenti            = "";
     aAbreHTMO           = "";
     aAbreHTMD           = "";
     aAbreTXT            = "";
     aAbreTXTO           = "";
     aAbreTXTD           = "";
     aAbreFIN            = "";
     aPathDSARCHI        = "";
     aContenido          = "";
     aOpcion             = "";
     aPathLocal          = "";

     {1}aContiene        = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     {-1}sTree           = 0;
         sT_nID          = 0;
         sT_nOper        = 0;
         sT_aData        = "";

     {2}nNivel           = 0;

     {5}aPopup           = "";

     &eaPathNet          = "";
     &eaPathComer        = "";
     &eaPathDPNTM        = "";
     &eaUsuario          = "";
     &eaAlfa             = "";
     &eaUnidadBasico     = "";
     &eaPrograma         = "";
     &enAprobacion       = "";
     &eaTitulo           = "";
     &enError            = 0;
     &enMasivo           = 0;
     &eaFichIVA          = "";
     &eaFichIRPF         = "";
     &enFilConc          = 0
     &enLibIVA           = 0
     &eaFiCon            = "";
     &aTipoIVA           = "";
     &eaAuto             = "";
     &enDesdeX           = 0;
     &enActual           = 0;
     &eaTipoCtb          = "";
     &enE001             = 0;
     &enE002             = 0;
     &enNumRegistro      = 0;
     &enLibroFac         = 0;
|FIN;

|PROCESO DestruyeControles;
     |SI nBoton1  ! -1;  |FIN_CONTROL_WINDOWS nBoton1;   |FINSI;
     |SI nBoton2  ! -1;  |FIN_CONTROL_WINDOWS nBoton2;   |FINSI;
     |SI nBoton3  ! -1;  |FIN_CONTROL_WINDOWS nBoton3;   |FINSI;
     |SI nBoton4  ! -1;  |FIN_CONTROL_WINDOWS nBoton4;   |FINSI;
     |SI nBoton6  ! -1;  |FIN_CONTROL_WINDOWS nBoton6;   |FINSI;
     |SI nBoton7  ! -1;  |FIN_CONTROL_WINDOWS nBoton7;   |FINSI;
     |SI nBoton8  ! -1;  |FIN_CONTROL_WINDOWS nBoton8;   |FINSI;
     |SI nBoton9  ! -1;  |FIN_CONTROL_WINDOWS nBoton9;   |FINSI;
     |SI nBoton10 ! -1;  |FIN_CONTROL_WINDOWS nBoton10;  |FINSI;

     |SI nLabel1 ! -1;  |FIN_CONTROL_WINDOWS nLabel1;  |FINSI;
     |SI nLabel2 ! -1;  |FIN_CONTROL_WINDOWS nLabel2;  |FINSI;

     |SI nGrid1 ! -1;  |DESTRUYECONTROL nGrid1;  |FINSI;
     |SI nGrid2 ! -1;  |DESTRUYECONTROL nGrid2;  |FINSI;
     |SI nGrid3 ! -1;  |DESTRUYECONTROL nGrid3;  |FINSI;
     |SI nGrid4 ! -1;  |DESTRUYECONTROL nGrid4;  |FINSI;
     |SI nGrid5 ! -1;  |DESTRUYECONTROL nGrid5;  |FINSI;

     nLabel1    = -1;
     nLabel2    = -1;
     nBoton1    = -1;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton6    = -1;
     nBoton7    = -1;
     nBoton8    = -1;
     nBoton9    = -1;
     nBoton10   = -1;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO VerDoc;
     |VENTANA 0501, 0540, -1, 16, "Visualizando documento";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SI aTipoIVA = "R";  aAlfa = ":dsarchi/dsarz049;VERDOC" + nDocu;  |FINSI;
     |SI aTipoIVA = "S";  aAlfa = ":dsarchi/dsarz038;VERDOC" + nDocu;  |FINSI;

     |SUB_EJECUTA_NP aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO AContabilizar;
     |SI enE001 = 1;  |O enE002 = 1;
         |SELECT #3#facturas@;
         #facturas@#44 = "S";
         #facturas@#0  = 1;
         |LEE 000#facturas@.];
         |SI FSalida = 0;  |Y #facturas@#44 = "S";
             |MENAV "0000Hay facturas pendientes de contabilizar. Termine de pasarlas todas";
             |ACABA;
         |FINSI;
     |FINSI;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |SI eaPathDPNTM ! "";
         aPopup1  = nBoton11;
         aPopup2  = "3";
         aPopup3  = "Dejar los registros pendientes de actualizar.";
         aPopup4  = "Actualizar";
         aPopup5  = "No hacer nada";

         IaPopup  = aPopup1  <-;
         |ESPECIFICA "TRACKPOPUP", aPopup;

         enActual = -1;
         |SI FSalida = 1;  enActual = 0;  |FINSI;
         |SI FSalida = 2;  enActual = 1;  |FINSI;

         |SI enActual = -1;  |ACABA;  |FINSI;

         |SI enActual = 0;
             |ABRE #cainliva;
             #cainliva#0 = enLibIVA;
             #cainliva#1 = 1;
             |LEE 000#cainliva.p;
             |SI FSalida = 0;
                 |MENAV "0000Hay facturas pendientes de actualizar. Termine de actualizarlas";
                 |CIERRA #cainliva;
                 |ACABA;
             |FINSI;
             |CIERRA #cainliva;
         |FINSI;
     |FINSI;

     |HAZ DestruyeControles;

     |SI nBoton5  ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  |FINSI;
     |SI nBoton11 ! -1;  |FIN_CONTROL_WINDOWS nBoton11; |FINSI;
     |SI nBoton12 ! -1;  |FIN_CONTROL_WINDOWS nBoton12; |FINSI;
     |SI nBoton13 ! -1;  |FIN_CONTROL_WINDOWS nBoton13; |FINSI;
     |SI nBoton14 ! -1;  |FIN_CONTROL_WINDOWS nBoton14; |FINSI;

     nBoton5  = -1;
     nBoton11 = -1;
     nBoton12 = -1;
     nBoton13 = -1;
     nBoton14 = -1;

     |PULSATECLA;
     |PULSATECLA;

     |VENTANA 0501, 0540, -1, 16, "Actualizando facturas ...";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SI eaPathDPNTM = "";
         |HAZ PasaFacturasGAD;
     |FINSI;

     |SI eaPathDPNTM ! "";
         |HAZ PasaFacturasCOMER;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |SI eaPathDPNTM ! "";
         |SI enActual = 0;
             |MENAV "0000Los registros se encuentran en la introduci¢n de facturas para su revisi¢n y actualizaci¢n";
         |FINSI;
     |FINSI;

     |PTEC 806;
|FPRC;

|PROCESO gadm0003_borra;
     |BORRA 020#gadm0003.a;
|FPRC;

|DEFBUCLE gadm0003_borra;
     #gadm0003#1;
     ;
     nEmp48, nRegistro, 01;
     nEmp48, nRegistro, 99;
     be;
     NULL, gadm0003_borra;
|FIN;

|PROCESO APreparar;
     |LEE 101#facturas@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI eaPathDPNTM = "";
         nEmp48    = #48#2;
         nRegistro = #facturas@#0;
         |BUCLE gadm0003_borra;
     |FINSI;

     |ABRE #gadm0001;
     |HAZ CargaFichero_gadm0002;
     |CIERRA #gadm0001;

     |SI enError = 1;
         |LIBERA #facturas@;
         |ACABA;
     |FINSI;

     |BORRA 020#facturas@.a;
     |LIBERA #facturas@;

     |SI enMasivo = 1;  |ACABA;  |FINSI;

     |REFRESCACONTROL nGrid5;

     |SI nFichero = 1;  |REFRESCACONTROL nGrid1;  |FINSI;
     |SI nFichero = 2;  |REFRESCACONTROL nGrid2;  |FINSI;
|FPRC;

|PROCESO ADesPreparar;
     |LEE 101#gadm0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#gadm0002.a;
     |LIBERA #gadm0002;

     |SI eaPathDPNTM = "";
         nEmp48    = #48#2;
         nRegistro = #gadm0002#69;
         |BUCLE gadm0003_borra;
     |FINSI;

     |SI nFichero = 1;
         #dpntm100#0 = #gadm0002#69;
         |LEE 000#dpntm100.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PARA nCampo = 0;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
               #facturas@#nCampo# = #dpntm100#nCampo#;
         |SIGUE;

         #facturas@#56 = #dpntm100#56;
         #facturas@#76 = #dpntm100#76;
         #facturas@#77 = #dpntm100#77;
         #facturas@#78 = #dpntm100#78;
         #facturas@#79 = #dpntm100#79;
         #facturas@#80 = #dpntm100#80;

         |GRABA 020#facturas@.n;
         |LIBERA #facturas@;

         nNoHagasNa = 1;
         |REFRESCACONTROL nGrid1;
         nNoHagasNa = 0;
     |FINSI;

     |SI nFichero = 2;
         #dpntm101#0 = #gadm0002#69;
         |LEE 000#dpntm101.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PARA nCampo = 0;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #facturas@#nCampo# = #dpntm101#nCampo#;
         |SIGUE;

         |GRABA 020#facturas@.n;
         |LIBERA #facturas@;

         nNoHagasNa = 1;
         |REFRESCACONTROL nGrid2;
         nNoHagasNa = 0;
     |FINSI;

     |REFRESCACONTROL nGrid5;
     |FOCOTECLADO nGrid5;
|FPRC;

|PROCESO Borra100;
     |BORRA 020#dpntm100.a;
     |LIBERA #dpntm100;
|FPRC;

|PROCESO dpntm100;
     |SI #dpntm100#44 = "N";  |ACABA;  |FINSI;

     |SI eaPathDPNTM = "";
         #dsarm005#0 = #dpntm100#50;
         |LEE 000#dsarm005.=;
         |SI FSalida ! 0;
             |HAZ Borra100;
             |ACABA;
         |FINSI;

         |SI #dsarm005#71 ! 0;
             |HAZ Borra100;
             |ACABA;
         |FINSI;

         #dsarm034#16 = #dsarm005#0;
         |LEE 000#dsarm034.=;
         |SI FSalida ! 0;  |DDEFECTO #dsarm034;  |FINSI;

         |SI #dsarm034#9 = "N";
             |HAZ Borra100;
             |ACABA;
         |FINSI;

         |SI #dsarm034#10 = "N";
             |HAZ Borra100;
             |ACABA;
         |FINSI;

         |SI #dsarm034#18 ! #48#2;  |O #dsarm034#19 ! #48#3;
             |HAZ Borra100;
             |ACABA;
         |FINSI;

         |SI #dpntm100#50 = 0;
             |HAZ Borra100;
             |ACABA;
         |FINSI;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
           #facturas@#nCampo# = #dpntm100#nCampo#;
     |SIGUE;

     #facturas@#56 = #dpntm100#56;
     #facturas@#76 = #dpntm100#76;
     #facturas@#77 = #dpntm100#77;
     #facturas@#78 = #dpntm100#78;
     #facturas@#79 = #dpntm100#79;
     #facturas@#80 = #dpntm100#80;

     |GRABA 020#facturas@.n;
     |LIBERA #facturas@;
     |LIBERA #dpntm100;

     enMasivo = 1;
     |HAZ APreparar;
     enMasivo = 0;
|FPRC;

|DEFBUCLE dpntm100;
     #dpntm100#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dpntm100;
|FIN;

|PROCESO Borra101;
     |BORRA 020#dpntm101.a;
     |LIBERA #dpntm101;
|FPRC;

|PROCESO dpntm101;
     |SI #dpntm101#44 = "N";  |ACABA;  |FINSI;

     |SI eaPathDPNTM = "";
         #dsarm005#0 = #dpntm101#50;
         |LEE 000#dsarm005.=;
         |SI FSalida ! 0;
             |HAZ Borra101;
             |ACABA;
         |FINSI;

         |SI #dpntm101#50 = 0;
             |HAZ Borra101;
             |ACABA;
         |FINSI;

         |SI #dsarm005#71 ! 0;
             |HAZ Borra101;
             |ACABA;
         |FINSI;

         #dsarm034#16 = #dsarm005#0;
         |LEE 000#dsarm034.=;
         |SI FSalida ! 0;  |DDEFECTO #dsarm034;  |FINSI;

         |SI #dsarm034#9 = "N";
             |HAZ Borra101;
             |ACABA;
         |FINSI;

         |SI #dsarm034#10 = "N";
             |HAZ Borra101;
             |ACABA;
         |FINSI;

         |SI #dsarm034#18 ! #48#2;  |O #dsarm034#19 ! #48#3;
             |HAZ Borra101;
             |ACABA;
         |FINSI;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 80;  |HACIENDO nCampo = nCampo + 1;
           #facturas@#nCampo# = #dpntm101#nCampo#;
     |SIGUE;

     #facturas@#76 = #dpntm101#76;
     #facturas@#77 = #dpntm101#77;
     #facturas@#78 = #dpntm101#78;
     #facturas@#79 = #dpntm101#79;

     |GRABA 020#facturas@.n;
     |LIBERA #facturas@;
     |LIBERA #dpntm101;

     enMasivo = 1;
     |HAZ APreparar;
     enMasivo = 0;
|FPRC;

|DEFBUCLE dpntm101;
     #dpntm101#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dpntm101;
|FIN;

|PROCESO DesdeGAD;
     eaUsuario = ("00000" + #48#2) % -105;

     |DBASS aBase;  |QBF aBase;

     nCorreo   = 0;
     eaPathNet = aBase + "despanet";            |MKDIR eaPathNet;
     eaPathNet = eaPathNet + "/" + eaUsuario;   |MKDIR eaPathNet;
     eaPathNet = eaPathNet + "/fich";           |MKDIR eaPathNet;
     eaPathNet = eaPathNet + "/";

     |SI aTipoIVA = "R";
         aMas = aBase + "dsarchi/def/dpntm100.mas";

         |PATH_DAT #dpntm100#eaPathNet#;
         |PATH_DAT #dpntm102#eaPathNet#;

         |ABRET #dpntm100;
         |ABRET #dpntm102;
     |FINSI;

     |SI aTipoIVA = "S";
         aMas = aBase + "dsarchi/def/dpntm101.mas";

         |PATH_DAT #dpntm101#eaPathNet#;
         |PATH_DAT #dpntm103#eaPathNet#;

         |ABRET #dpntm101;
         |ABRET #dpntm103;
     |FINSI;

     |CARGA_DEF aMas, facturas@;

     aFichero = "dpntmxxx" + Usuario;  |NOME_DAT #facturas@#aFichero#;
     aFichero = "gadm0002" + Usuario;  |NOME_DAT #gadm0002#aFichero#;

     |ABRE #facturas@;  |CIERRA #facturas@;  |DELINDEX #facturas@;
     |ABRE #gadm0002;   |CIERRA #gadm0002;   |DELINDEX #gadm0002;

     |ABRET #gadm0002;
     |ABRET #facturas@;

     |DBASS aPathDSARCHI;
     aPathDSARCHI = aPathDSARCHI + "dsarchi/fich/";
     |PATH_DAT #dsarm005#aPathDSARCHI#;
     |PATH_DAT #dsarm034#aPathDSARCHI#;

     |ABRE #dsarm005;  |SELECT #1#dsarm005;
     |ABRE #dsarm034;  |SELECT #2#dsarm034;
     |SI aTipoIVA = "R";  |BUCLE dpntm100;  |FINSI;
     |SI aTipoIVA = "S";  |BUCLE dpntm101;  |FINSI;
     |CIERRA #dsarm034;
     |CIERRA #dsarm005;
|FPRC;

|PROCESO DesdeCOMER;
     eaUsuario = ("00000" + #48#2) % -105;

     |DBASS aBase;  |QBF aBase;

     nCorreo   = 0;

     |SI aTipoIVA = "R";
         aMas = aBase + "dsarchi/def/dpntm100.mas";

         |PATH_DAT #dpntm100#eaPathDPNTM#;
         |PATH_DAT #dpntm102#eaPathDPNTM#;

         |ABRET #dpntm100;
         |ABRET #dpntm102;
     |FINSI;

     |SI aTipoIVA = "S";
         aMas = aBase + "dsarchi/def/dpntm101.mas";

         |PATH_DAT #dpntm101#eaPathDPNTM#;
         |PATH_DAT #dpntm103#eaPathDPNTM#;

         |ABRET #dpntm101;
         |ABRET #dpntm103;
     |FINSI;

     |CARGA_DEF aMas, facturas@;

     aFichero = "dpntmxxx" + Usuario;  |NOME_DAT #facturas@#aFichero#;
     aFichero = "gadm0002" + Usuario;  |NOME_DAT #gadm0002#aFichero#;

     |ABRE #facturas@;  |CIERRA #facturas@;  |DELINDEX #facturas@;
     |ABRE #gadm0002;   |CIERRA #gadm0002;   |DELINDEX #gadm0002;

     |ABRET #gadm0002;
     |ABRET #facturas@;

     |SI aTipoIVA = "R";  |BUCLE dpntm100;  |FINSI;
     |SI aTipoIVA = "S";  |BUCLE dpntm101;  |FINSI;
|FPRC;

|PROCESO CreaFicheros;
     |SI eaPathDPNTM ! "";
         |HAZ DesdeCOMER;
     |FINSI;

     |SI eaPathDPNTM = "";
         |HAZ DesdeGAD;
     |FINSI;
|FPRC;

|PROCESO CamposAyudaFw100;
     |SI nTipoEntrada = 2;  |O nTipoEntrada = 4;
         |ACABA;
     |FINSI;

     |HAZ Tipo0C1Fw100;
     |HAZ Tipo7C5Fw100;
     |HAZ Tipo0C5Fw100;
     |HAZ Tipo0C6Fw100;
     |HAZ Tipo0C8Fw100;
|FPRC;

|PROCESO Evento1;
     |SI nNoHagasNa = 1;  |ACABA;  |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |BORRA_HIJOS_PAN #0#gadz0002;

         |SUB_PINPA #0#gadw0002, nPanta;
         nSubPan =  FSalida;

         |LEE 000#facturas@.=;
         |SI FSalida ! 0;  |DDEFECTO #facturas@;  |FINSI;

         aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #facturas@#0) % -105) + ")";
         |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

         |PULSATECLA;

         |DDEFECTO #gadw0002;
         |PARA nCampo = 0;  |SI nCampo [ 49;  |HACIENDO nCampo = nCampo + 1;
               #gadw0002#nCampo# = #facturas@#nCampo#;

               |C_V #gadw0002#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0002#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw100;

         |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "DISABLE";  |FINSI;
         |SI nBoton9  ! -1;  |ESTADO_CONTROL nBoton9,  "DISABLE";  |FINSI;
         |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "DISABLE";  |FINSI;
         |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "DISABLE";  |FINSI;
         |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "DISABLE";  |FINSI;

         |FOCOTECLADO nGrid1;
     |FINSI;
|FPRC;

|PROCESO CamposAyudaFw101;
     |SI nTipoEntrada = 2;  |O nTipoEntrada = 4;
         |ACABA;
     |FINSI;

     |HAZ Tipo0C1Fw101;
     |HAZ Tipo7C5Fw101;
     |HAZ Tipo0C5Fw101;
     |HAZ Tipo0C6Fw101;
     |HAZ Tipo0C8Fw101;
|FPRC;

|PROCESO Evento2;
     |SI FSalida = 1;  |O FSalida = 2;
         |BORRA_HIJOS_PAN #0#gadz0002;

         |SUB_PINPA #0#gadw0003, nPanta;
         nSubPan =  FSalida;

         |LEE 000#facturas@.=;
         |SI FSalida ! 0;  |DDEFECTO #facturas@;  |FINSI;

         aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #facturas@#0) % -105) + ")";
         |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

         |PULSATECLA;

         |DDEFECTO #gadw0003;
         |PARA nCampo = 0;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
               #gadw0003#nCampo# = #facturas@#nCampo#;

               |C_V #gadw0003#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0003#nCampo#;  |FINSI;
         |SIGUE;
         |PARA nCampo = 51;  |SI nCampo [ 69;  |HACIENDO nCampo = nCampo + 1;
               nAux = nCampo + 6;
               #gadw0003#nCampo# = #facturas@#nAux#;

               |C_V #gadw0003#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0003#nCampo#;  |FINSI;
         |SIGUE;

         |SI aTipoIVA = "R";  |HAZ CamposAyudaFw100;  |FINSI;
         |SI aTipoIVA = "S";  |HAZ CamposAyudaFw101;  |FINSI;

         |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "DISABLE";  |FINSI;
         |SI nBoton9  ! -1;  |ESTADO_CONTROL nBoton9,  "DISABLE";  |FINSI;
         |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "DISABLE";  |FINSI;
         |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "DISABLE";  |FINSI;
     |FINSI;

     nDocu = #facturas@#50;

     |SI nBoton13 ! -1;
         |SI nDocu ! 0;
             |ESTADO_CONTROL nBoton13, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton13, "DISABLE";
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO Evento3;
     |SI FSalida = 1;  |O FSalida = 2;
         |BORRA_HIJOS_PAN #0#gadz0002;

         |SUB_PINPA #0#gadw0002, nPanta;
         nSubPan =  FSalida;

         |LEE 000#dpntm102.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm102;  |FINSI;

         aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #dpntm102#0) % -105) + ")";
         |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

         |PULSATECLA;

         |DDEFECTO #gadw0002;
         |PARA nCampo = 0;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               #gadw0002#nCampo# = #dpntm102#nCampo#;

               |C_V #gadw0002#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0002#nCampo#;  |FINSI;
         |SIGUE;

         |PARA nCampo = 30;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
               nCampo1    = nCampo + 1;
               #gadw0002#nCampo# = #dpntm102#nCampo1#;

               |C_V #gadw0002#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0002#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw100;

         |FOCOTECLADO nGrid3;
     |FINSI;
|FPRC;

|PROCESO Evento4;
     |SI FSalida = 1;  |O FSalida = 2;
         |BORRA_HIJOS_PAN #0#gadz0002;

         |SUB_PINPA #0#gadw0003, nPanta;
         nSubPan =  FSalida;

         |LEE 000#dpntm103.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm103;  |FINSI;

         aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #dpntm103#0) % -105) + ")";
         |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

         |PULSATECLA;

         |DDEFECTO #gadw0003;
         |PARA nCampo = 0;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               #gadw0003#nCampo# = #dpntm103#nCampo#;

               |C_V #gadw0003#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0003#nCampo#;  |FINSI;
         |SIGUE;

         |PARA nCampo = 30;  |SI nCampo [ 43;  |HACIENDO nCampo = nCampo + 1;
               nCampo1    = nCampo + 1;
               #gadw0003#nCampo# = #dpntm103#nCampo1#;

               |C_V #gadw0003#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0003#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw101;

         |SI nBoton13 ! -1;
             |ESTADO_CONTROL nBoton13, "DISABLE";
         |FINSI;

         |FOCOTECLADO nGrid4;
     |FINSI;
|FPRC;

|PROCESO Evento5;
     |SI nNoHagasNa = 1;  |ACABA;  |FINSI;

     |SI FSalida = 1;  |O FSalida = 2;
         |SI nQueBoton = 0;
             |HAZ Boton9;
         |SINO;
             |HAZ Boton8;
         |FINSI;

         |ESTADO_CONTROL nBoton14, "ENABLE";
     |FINSI;

     |SI aTipoIVA = "R";
         #dpntm100#0 = #gadm0002#69;
         |LEE 000#dpntm100.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm100;  |FINSI;

         nDocu = #dpntm100#50;
     |FINSI;

     |SI aTipoIVA = "S";
         #dpntm101#0 = #gadm0002#69;
         |LEE 000#dpntm101.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm101;  |FINSI;

         nDocu = #dpntm101#50;
     |FINSI;

     |SI nBoton13 ! -1;
         |SI nDocu ! 0;
             |ESTADO_CONTROL nBoton13, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton13, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Baja700_3;
     #facturas@#44 = "S";
     #facturas@#0  = 1;
|FPRC;

|PROCESO Alta700_3;
     #facturas@#44 = "S";
     #facturas@#0  = 999999;
|FPRC;

|PROCESO Baja701_3;
     #facturas@#44 = "S";
     #facturas@#0  = 1;
|FPRC;

|PROCESO Alta701_3;
     #facturas@#44 = "S";
     #facturas@#0  = 999999;
|FPRC;

|PROCESO BotonesPanta;
     |CONTROL_SIMPLE nPanta, "LABEL,{{13}}Registro", 0647, 0654, NULL;
     nLabel1 = FSalida;

     |CONTROL_SIMPLE nPanta, "LABEL,{{15}}Facturas preparadas", 0555, 0598, NULL;
     nLabel2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{202}}", 0747, 0854, APreparar;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{201}}", 1047, 1154, ADesPreparar;
     nBoton7 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Datos factura", 1255, 1265, Boton8;
     nBoton8 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Datos contabilidad", 1267, 1281, Boton9;
     nBoton9 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Modificar", 1288, 1298, Boton10;
     nBoton10 = FSalida;

     |ESTADO_CONTROL nBoton8,  "DISABLE";
     |ESTADO_CONTROL nBoton9,  "DISABLE";
     |ESTADO_CONTROL nBoton10, "DISABLE";
     |ESTADO_CONTROL nBoton12, "DISABLE";

     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "DISABLE";  |FINSI;
|FPRC;

|PROCESO PintaPantalla;
     |SI nBoton5 ! -1;
         |HAZ DestruyeControles;
     |FINSI;

     |SI aTipoIVA = "R";  |Y eaPathDPNTM = "";
         |CONTROL_SIMPLE nPanta, "BOTON,Facturas expedidas", 0502, 0520, Boton1;
         nBoton1      = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,Facturas expedidas revisadas", 0523, 0545, Boton3;
         nBoton3      = FSalida;

         |ESTADO_CONTROL nBoton1, "DISABLE";
     |FINSI;

     |SI aTipoIVA = "S";  |Y eaPathDPNTM = "";
         |CONTROL_SIMPLE nPanta, "BOTON,Facturas recibidas", 0502, 0520, Boton2;
         nBoton2      = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,Facturas recibidas revisadas", 0523, 0545, Boton4;
         nBoton4      = FSalida;

         |ESTADO_CONTROL nBoton2, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |HAZ PintaPantalla;

     nRango = 4 + 8 + 16 + 32 + 128;

     nNoHagasNa = 1;
     |LINEAL_SIMPLE #1#gadm0002, nRango, 0655, 1198, NULL, NULL, Evento5;
     nGrid5 = FSalida;

     |LINEAL_SIMPLE #3#facturas@, nRango, 0602, 1245, Baja700_3, Alta700_3, Evento1;
     nGrid1 = FSalida;

     nNoHagasNa = 0;

     |SI nBoton1  ! -1;  |ESTADO_CONTROL nBoton1,  "DISABLE";  |FINSI;
     |SI nBoton2  ! -1;  |ESTADO_CONTROL nBoton2,  "ENABLE";   |FINSI;
     |SI nBoton3  ! -1;  |ESTADO_CONTROL nBoton3,  "ENABLE";   |FINSI;
     |SI nBoton4  ! -1;  |ESTADO_CONTROL nBoton4,  "ENABLE";   |FINSI;
     |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "DISABLE";  |FINSI;
     |SI nBoton9  ! -1;  |ESTADO_CONTROL nBoton9,  "DISABLE";  |FINSI;
     |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "DISABLE";  |FINSI;
     |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "DISABLE";  |FINSI;
     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "DISABLE";  |FINSI;

     nFichero = 1;

     |HAZ BotonesPanta;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO Boton2;
     |HAZ PintaPantalla;

     nRango = 4 + 8 + 16 + 32 + 128;

     nNoHagasNa = 1;

     |LINEAL_SIMPLE #1#gadm0002, nRango, 0655, 1198, NULL, NULL, Evento5;
     nGrid5 = FSalida;

     |LINEAL_SIMPLE #3#facturas@, nRango, 0602, 1245, Baja701_3, Alta701_3, Evento2;
     nGrid2 = FSalida;

     nNoHagasNa = 0;

     |SI nBoton2  ! -1;  |ESTADO_CONTROL nBoton2, "DISABLE";  |FINSI;
     |SI nBoton1  ! -1;  |ESTADO_CONTROL nBoton1, "ENABLE";   |FINSI;
     |SI nBoton3  ! -1;  |ESTADO_CONTROL nBoton3, "ENABLE";   |FINSI;
     |SI nBoton4  ! -1;  |ESTADO_CONTROL nBoton4, "ENABLE";   |FINSI;
     |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "DISABLE";  |FINSI;
     |SI nBoton9  ! -1;  |ESTADO_CONTROL nBoton9,  "DISABLE";  |FINSI;
     |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "DISABLE";  |FINSI;
     |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "DISABLE";  |FINSI;
     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "ENABLE";   |FINSI;

     nFichero = 2;

     |HAZ BotonesPanta;

     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO Boton3;
     |HAZ PintaPantalla;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dpntm102, nRango, 0602, 1298, NULL, NULL, Evento3;
     nGrid3 = FSalida;

     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "DISABLE";  |FINSI;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "ENABLE";   |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "ENABLE";   |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "ENABLE";   |FINSI;

     nFichero = 3;  |FOCOTECLADO nGrid3;
|FPRC;

|PROCESO Boton4;
     |HAZ PintaPantalla;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dpntm103, nRango, 0602, 1298, NULL, NULL, Evento4;
     nGrid4 = FSalida;

     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "DISABLE";  |FINSI;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "ENABLE";   |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "ENABLE";   |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "ENABLE";   |FINSI;

     nFichero = 4;  |FOCOTECLADO nGrid4;
|FPRC;

|PROCESO EvntoTree;
     |SI FEntrada = 0;
         |ACABA;
     |FINSI;

     aContenido = Contenido % 105;

     |VENTANA 0501, 0502, -1, -1, "";
     n2Vent = FSalida;
     |PTEC 802;  |PAUSA;

     |SI aContenido = "OPC01";
         |SUB_EJECUTA "gadm0000";
     |FINSI;

     |SI aContenido = "OPC02";
         |SUB_EJECUTA "gadm0005";
     |FINSI;

     |FINVENTANA n2Vent;

     |PULSATECLA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO CargaArbol;
     aOpcion = aOpcion + &13 + &10;
     |XGRABA nHandle, aOpcion;
|FPRC;

|PROCESO Boton5;
     |VENTANA 0501, 1040, -1, 16, "Configuraci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "tmp";      |MKDIR aAlfa;

     sT_nID   = nTree;
     sT_nOper = 0;

     aAbre = aPathLocal + "tree" + Usuario + ".txt";
     |XABRE "WBC", aAbre, nHandle;

     nOpcion = 0;

     nOpcion  = nOpcion + 1;
     aOpcion  = nOpcion + ":Series / Libros {{OPC01}}";
     |HAZ CargaArbol;

     nEmp48 = #48#2;

     |ABRE #agicen14;
     #agicen14#0 = nEmp48;
     #agicen14#1 = 1;
     |LEE 000#agicen14.];
     |SI FSalida = 0; |Y #agicen14#0 = nEmp48;
         nOpcion  = nOpcion + 1;
         aOpcion  = nOpcion + ":Configuracion por departamentos {{OPC02}}";
         |HAZ CargaArbol;
     |FINSI;
     |CIERRA #agicen14;

     |XCIERRA nHandle;

     aAlfa = "TREECTRL, Tabla de contenidos {{" + aAbre + "}}";
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0838, EvntoTree;
     nTree = FSalida;

     |RFBORRA aAbre;

     sT_nID   = nTree;
     sT_nOper = 2;
     sT_aData = "1:";

     |ESPECIFICA "COMMANDCONTROL", sTree;

     |PULSATECLA;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nTree;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA n1Vent;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO Boton12;
     enNumRegistro = #gadm0002#69;
     enLibroFac    = #gadm0002#0;
     |HAZ DesgloseBase;
|FPRC;

|PROCESO Boton8;
     nQueBoton = 1;

     |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "DISABLE";  |FINSI;
     |SI nBoton9  ! -1;  |ESTADO_CONTROL nBoton9,  "ENABLE";   |FINSI;
     |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "DISABLE";  |FINSI;
     |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "ENABLE";   |FINSI;
     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "ENABLE";   |FINSI;

     |SI nFichero = 1;
         |SUB_PINPA #0#gadw0002, nPanta;
         nSubPan =  FSalida;

         #dpntm100#0 = #gadm0002#69;
         |LEE 000#dpntm100.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm100;  |FINSI;

         aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #dpntm100#0) % -105) + ")";
         |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

         |PULSATECLA;

         |DDEFECTO #gadw0002;
         |PARA nCampo = 0;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
               #gadw0002#nCampo# = #dpntm100#nCampo#;

               |C_V #gadw0002#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0002#nCampo#;  |FINSI;
         |SIGUE;

         #gadw0002#1  = #gadm0002#45;
         #gadw0002#46 = #gadm0002#46;

         |HAZ CamposAyudaFw100;
     |FINSI;

     |SI nFichero = 2;
         |SUB_PINPA #0#gadw0003, nPanta;
         nSubPan =  FSalida;

         #dpntm101#0 = #gadm0002#69;
         |LEE 000#dpntm101.=;
         |SI FSalida ! 0;  |DDEFECTO #dpntm101;  |FINSI;

         aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #dpntm101#0) % -105) + ")";
         |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

         |PULSATECLA;

         |DDEFECTO #gadw0003;
         |PARA nCampo = 0;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
               #gadw0003#nCampo# = #dpntm101#nCampo#;

               |C_V #gadw0003#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0003#nCampo#;  |FINSI;
         |SIGUE;
         |PARA nCampo = 51;  |SI nCampo [ 69;  |HACIENDO nCampo = nCampo + 1;
               nAux = nCampo + 6;
               #gadw0003#nCampo# = #dpntm101#nAux#;

               |C_V #gadw0003#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #gadw0003#nCampo#;  |FINSI;
         |SIGUE;

         #gadw0003#1  = #gadm0002#45;
         #gadw0003#46 = #gadm0002#46;

         |HAZ CamposAyudaFw101;
     |FINSI;

     |FOCOTECLADO nGrid5;
|FPRC;

|PROCESO Boton9;
     nQueBoton = 0;

     |SI nBoton9  ! -1;  |ESTADO_CONTROL nBoton9,  "DISABLE";  |FINSI;
     |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "ENABLE";   |FINSI;
     |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "ENABLE";   |FINSI;
     |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "ENABLE";   |FINSI;
     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "ENABLE";   |FINSI;

     |BORRA_HIJOS_PAN #0#gadz0002;

     |SUB_PINPA #0#gadw0001, nPanta;
     nSubPan =  FSalida;

     aAlfa = "LABEL,{{15}} (" + "Registro: " + (("00000" + #gadm0002#69) % -105) + ")";
     |CONTROL_SIMPLE nSubPan, aAlfa, 1331, 1350, NULL;

     |C_V #gadw0001#72, 1, "N";
     |C_M #gadw0001#72, 1, "N";

     |HAZ EsComersan;
     |SI FSalida = 0;
         |C_V #gadw0001#72, 1, "S";
         |C_M #gadw0001#72, 1, "S";
         |CONTROL_SIMPLE nSubPan, "LABEL,{{7}}N§.factura proveedor", 3178, 3198, NULL;
     |FINSI;

     |ABRE #gadm0001;

     |SI nFichero = 1;  #gadm0001#0 = "C";  |FINSI;
     |SI nFichero = 2;  #gadm0001#0 = "P";  |FINSI;

     #gadm0001#1 = #gadm0002#5;
     |LEE 000#gadm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #gadm0001;  |FINSI;
     |CIERRA #gadm0001;

     aAlfa  = "LABEL,{{10}}Contabilizaci¢n manual";
     |SI #gadm0001#2 = "S";
         aAlfa  = "LABEL,{{10}}Contabilizaci¢n autom tica";
     |FINSI;
     |CONTROL_SIMPLE nSubPan, aAlfa, 3370, 3398, NULL;
     nLabel3 = FSalida;

     |CONTROL_SIMPLE nSubPan, "BOTON,Predeterminar contabilizaci¢n", 3470, 3498, Predeterminar;
     nBotonMod = FSalida;

     |PULSATECLA;

     |DDEFECTO #gadw0001;
     |PARA nCampo = 0;  |SI nCampo [ 75;  |HACIENDO nCampo = nCampo + 1;
           #gadw0001#nCampo# = #gadm0002#nCampo#;
     |SIGUE;

     |PINDA #0#gadw0001;

     |FOCOTECLADO nGrid5;
|FPRC;

|PROCESO QuitaBotonSalir;
     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO PonBotonSalir;
     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO Predeterminar;
     |HAZ GrabaPredeterminado;

     |SI nLabel3 ! -1;  |FIN_CONTROL_WINDOWS nLabel3;  |FINSI;

     aAlfa  = "LABEL,{{10}}Contabilizaci¢n manual";
     |SI #gadm0001#2 = "S";
         aAlfa  = "LABEL,{{10}}Contabilizaci¢n autom tica";
     |FINSI;
     |CONTROL_SIMPLE nSubPan, aAlfa, 3370, 3398, NULL;
     nLabel3 = FSalida;

     |SI nEndatos = 0;
         |SI #gadm0001#2 = "S";
             |HAZ LeeFacturas;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE facturas;
     #facturas@#1001;
     ;
          1;
     999999;
     ;
     NULL, APreparar;
|FIN;

|PROCESO LeeFacturas;
     |VENTANA 0501, 0540, -1, 16, "Leyendo facturas ...";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     enMasivo = 1;
     |BUCLE facturas;
     enMasivo = 0;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid5;

     |SI nFichero = 1;  |REFRESCACONTROL nGrid1;  |FINSI;
     |SI nFichero = 2;  |REFRESCACONTROL nGrid2;  |FINSI;
|FPRC;

|PROCESO Boton10;
     |SI nGrid1 ! -1;  |ESTADO_CONTROL nGrid1, "DISABLE";  |FINSI;
     |SI nGrid2 ! -1;  |ESTADO_CONTROL nGrid2, "DISABLE";  |FINSI;
     |SI nGrid5 ! -1;  |ESTADO_CONTROL nGrid5, "DISABLE";  |FINSI;

     |SI nBoton4  ! -1;  |ESTADO_CONTROL nBoton4,  "DISABLE";  |FINSI;
     |SI nBoton5  ! -1;  |ESTADO_CONTROL nBoton5,  "HIDE";     |FINSI;
     |SI nBoton6  ! -1;  |ESTADO_CONTROL nBoton6,  "DISABLE";  |FINSI;
     |SI nBoton7  ! -1;  |ESTADO_CONTROL nBoton7,  "DISABLE";  |FINSI;
     |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "DISABLE";  |FINSI;
     |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "DISABLE";  |FINSI;
     |SI nBoton11 ! -1;  |ESTADO_CONTROL nBoton11, "HIDE";     |FINSI;
     |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "HIDE";     |FINSI;
     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "HIDE";     |FINSI;
     |SI nBoton14 ! -1;  |ESTADO_CONTROL nBoton14, "HIDE";     |FINSI;

     |HAZ QuitaBotonSalir;

     |HAZ ModLosDefectos;

     nEndatos = 1;
     |ENDATOS #1#gadw0001;
     |SI FSalida = 0;
         |LEE 101#gadm0002.=;
         |SI FSalida = 0;
             |PARA nCampo = 0;  |SI nCampo [ 75;  |HACIENDO nCampo = nCampo + 1;
                   #gadm0002#nCampo# = #gadw0001#nCampo#;
             |SIGUE;
             |GRABA 020#gadm0002.a;
             |LIBERA #gadm0002;
         |FINSI;

         |SI aTipoIVA = "R";
             #dpntm100#0 = #gadm0002#69;
             |LEE 101#dpntm100.=;
             |SI FSalida = 0;
                 #dpntm100#15 = #gadm0002#4;
                 |GRABA 020#dpntm100.a;
                 |LIBERA #dpntm100;
             |FINSI;
         |FINSI;

         |SI aTipoIVA = "S";
             #dpntm101#0 = #gadm0002#69;
             |LEE 101#dpntm101.=;
             |SI FSalida = 0;
                 #dpntm101#15 = #gadm0002#4;
                 |GRABA 020#dpntm101.a;
                 |LIBERA #dpntm101;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI eaAuto = "S";
         |HAZ LeeFacturas;
         eaAuto = "";
     |FINSI;

     nEndatos = 0;
     |REFRESCACONTROL nGrid5;

     |FIN_CONTROL_WINDOWS nBotonMod;

     |HAZ PonBotonSalir;

     |SI nGrid1 ! -1;  |ESTADO_CONTROL nGrid1, "ENABLE";  |FINSI;
     |SI nGrid2 ! -1;  |ESTADO_CONTROL nGrid2, "ENABLE";  |FINSI;
     |SI nGrid5 ! -1;  |ESTADO_CONTROL nGrid5, "ENABLE";  |FINSI;

     |SI nBoton4  ! -1;  |ESTADO_CONTROL nBoton4,  "ENABLE";  |FINSI;
     |SI nBoton5  ! -1;  |ESTADO_CONTROL nBoton5,  "SHOW";    |FINSI;
     |SI nBoton6  ! -1;  |ESTADO_CONTROL nBoton6,  "ENABLE";  |FINSI;
     |SI nBoton7  ! -1;  |ESTADO_CONTROL nBoton7,  "ENABLE";  |FINSI;
     |SI nBoton8  ! -1;  |ESTADO_CONTROL nBoton8,  "ENABLE";  |FINSI;
     |SI nBoton10 ! -1;  |ESTADO_CONTROL nBoton10, "ENABLE";  |FINSI;
     |SI nBoton11 ! -1;  |ESTADO_CONTROL nBoton11, "SHOW";    |FINSI;
     |SI nBoton12 ! -1;  |ESTADO_CONTROL nBoton12, "SHOW";    |FINSI;
     |SI nBoton13 ! -1;  |ESTADO_CONTROL nBoton13, "SHOW";    |FINSI;
     |SI nBoton14 ! -1;  |ESTADO_CONTROL nBoton14, "SHOW";    |FINSI;

     |FOCOTECLADO nGrid5;
|FPRC;

|PROCESO CambioFecha;
     |HAZ ProcesoCambio;

     |REFRESCACONTROL nGrid5;
|FPRC;

|PROGRAMA;
     aAlfa = "Contabilizaci¢n de facturas. " + eaTitulo;
     |VENTANA 0501, 3799, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#gadz0002;
     nPanta = FSalida;

     |PTEC 802;  |PAUSA;

     |HAZ PintaPantalla;

     |CONTROL_SIMPLE 0, "BOTON,Configuraci¢n", 3702, 3715, Boton5;
     nBoton5      = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{230}}Contabilizar las preparadas", 3758, 3780, AContabilizar;
     nBoton11     = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Cambio fecha factura", 3732, 3753, CambioFecha;
     nBoton14     = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Desglose Bases", 3583, 3598, Boton12;
     nBoton12    = FSalida;

     |SI eaPathDPNTM = "";
         |CONTROL_SIMPLE 0, "BOTON,{{197}}Ver documento", 3565, 3580, VerDoc;
         nBoton13     = FSalida;

         |ESTADO_CONTROL nBoton13, "DISABLE";
     |FINSI;

     |ESTADO_CONTROL nBoton12, "DISABLE";
     |ESTADO_CONTROL nBoton14, "DISABLE";

     |SI aTipoIVA = "R";  |HAZ Boton1;  |FINSI;
     |SI aTipoIVA = "S";  |HAZ Boton2;  |FINSI;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid1;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |SI nBoton5  ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  |FINSI;
     |SI nBoton11 ! -1;  |FIN_CONTROL_WINDOWS nBoton11; |FINSI;
     |SI nBoton12 ! -1;  |FIN_CONTROL_WINDOWS nBoton12; |FINSI;
     |SI nBoton13 ! -1;  |FIN_CONTROL_WINDOWS nBoton13; |FINSI;
     |SI nBoton14 ! -1;  |FIN_CONTROL_WINDOWS nBoton14; |FINSI;

     |HAZ DestruyeControles;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ inicio;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |HAZ CuentoActiv;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     aTipoIVA  = PARAMETRO % 101;

     |SI aTipoIVA = "R";  enLibIVA = 1;  |FINSI;
     |SI aTipoIVA = "S";  enLibIVA = 2;  |FINSI;

     enFilConc  = 2;  |HAZ CreaConcepto;  eaFichIVA  = eaFiCon;
     enFilConc  = 3;  |HAZ CreaConcepto;  eaFichIRPF = eaFiCon;

     enDesdeX   =  1;
     nLabel1    = -1;
     nLabel2    = -1;
     nBoton1    = -1;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton5    = -1;
     nBoton6    = -1;
     nBoton7    = -1;
     nBoton8    = -1;
     nBoton9    = -1;
     nBoton10   = -1;
     nBoton11   = -1;
     nBoton12   = -1;
     nBoton13   = -1;
     nPanta     = 0;
     nQueBoton  = 0;

     |HAZ CreaFicheros;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |LEE 000#gadm0002.p;
     |SI FSalida = 0;
         |MENAV "0000Hay facturas pendientes de contabilizar.";
     |FINSI;

     |CIERRAT #gadm0002;   |DELINDEX #gadm0002;
     |CIERRAT #facturas@;  |DELINDEX #facturas@;

     |CIERRAT #dpntm100;
     |CIERRAT #dpntm101;
     |CIERRAT #dpntm102;
     |CIERRAT #dpntm103;

     |DESCARGA_DEF #facturas@;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;
