|FICHEROS;
  ca8z0008 #0;
  canempre #30;
  ca8ctrle #400;  ||Control Empresa
  ca8m0003 #403;  ||Tabla de Esta Empresa
|FIN;

|VARIABLES;
  nCampo    = 0;
  nDEmpresa = 0;
  nHEmpresa = 0;
  Linea     = 0;

  &enLongN  = 0;
  &enLongA  = 0;
  &eaRevis  = "";

  alfa1     = "";
  alfa2     = "";
  nSwNoDir  = 0;
  aAlfa1    = "";
  {-1}punt1 = 0;
|FIN;

|INCLUYE dscont_i;

|| ************ Procesos pantalla
|CALCULO Parrilla; |TIPO 0;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|| *************************************************************************
|PROCESO CalDirectorio;
  |DBASS dir_fich; |QBF dir_fich;
  dir_fich = dir_fich + "contagen/fich/";
  alfa1 = #30#2; |QBF alfa1;
  alfa2 = #30#3; |QBF alfa2;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"     + alfa2;   alfa2 = alfa2 % -101;
  dirfich0 = dir_fich + alfa1 + alfa2 + "/";

  nSwNoDir = 0;
  |MKDIR dirfich0;
  |SI FSalida = 0;
       nSwNoDir = 1;
       |RMDIR dirfich0;
       |ACABA;
  |FINSI;
|FPRC;

|PROCESO Rellena;

   |HAZ VarEmpresa;
   |HAZ CalDirectorio;
   |SI nSwNoDir = 0;

       |PATH_DAT #403 dirfich0;
       |ABRE #403;
       #403#0 = "";
       |LEE 040#403];
       |SI FSalida ! 0;
           |CIERRA #403;
           |ACABA;
       |FINSI;
       |CIERRA #403;
       aAlfa1  = #403#0; |QBF aAlfa1;
       aAlfa1  = aAlfa1 % 0;
       enLongA = aAlfa1;    ||Longitud anterior 2007
       aAlfa1  = #403#2; |QBF aAlfa1;
       aAlfa1  = aAlfa1 % 0;
       enLongN = aAlfa1;    ||Longitud anterior 2008

       |SI enLongN < MaximoDigitos;
           fich_alta = dirfich0;
           eaRevis   = #0#15;
           |SUB_EJECUTA_NP "ca8z0006;todos";
           Linea = 1;
       |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Rellena;
 #30#1;
 26;
 nDEmpresa, 0, 08;
 nHEmpresa, 9, 08;
 e;
 NULL, Rellena;
|FIN;

|| *************************************************************************

|PROCESO ElProceso; |TIPO 3;

   |SI #0#16 ! "SI"; |ACABA; |FINSI;
   Linea = 0;
   |SI #0#0 ! 0;
        nDEmpresa = #0#0;
        nHEmpresa = #0#1;
        |BUCLE Rellena;
   |SINO;
        |PARA nCampo = 2; |SI nCampo [ 13; |HACIENDO nCampo = nCampo + 1;
              |SI #0nCampo ! 0;
                  nDEmpresa = #0#0;
                  nHEmpresa = #0#1;
                  |BUCLE Rellena;
              |FINSI;
        |SIGUE;
   |FINSI;

   |SI Linea = 0;
       |MENAV "    Seleccion Vacia";
   |FINSI;
|FPRC;

|PROCESO VarEmpresa;
   dig1 = #canempre#11;
   dig3 = #canempre#13;
   dig4 = #canempre#14;
   dig5 = #canempre#15;
   dig6 = #canempre#16;
   dig7 = #canempre#17;
   dig8 = #canempre#18;
   dig9 = #canempre#19;

   enEjercicio = 2008;
   enEmpresa   = #30#2;
   enPeriodo   = #30#3;
   eaNombreEmp = #30#1;
   eaNifEmp    = #30#8;
   eaDepar     = #30#24;
   eaSubde     = #30#22;
   enSubde     = 0; |SI eaSubde = "O"; eaSubde = "S"; enSubde = 1; |FINSI;
   eaDfDepC    = #30#30;
   eaDfSubC    = #30#31;
   eaDfDepN    = #30#32;
   eaDfSubN    = #30#33;
   eaMoneda    = #30#28;

  || Recoger informacion sobre los niveles ...
  Ipunt1 = dig3<-;
  Ipunt1 = Ipunt1 + dig3;
  MaximoDigitos = punt1;

|FPRC;
