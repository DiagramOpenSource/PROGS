|FICHEROS;
   catplz03 #0;

   catplw01 #101;
   catplw02 #102;
   catplw03 #103;
   catplw04 #104;
|FIN;

|VARIABLES;
   aAlfa     = "";
   aAlfa1    = "";
   aAlfa2    = "";
   aAlfa3    = "";
   aAlfa4    = "";
   nNume1    = 0;
   nNume2    = 0;
   nNume3    = 0;
   nNume4    = 0;
   nPara1    = 0;
   nModo     = 0;
   aParam    = "";
   aLong     = "";
   nLong     = 0;

   &eaUnidadBasico = "";
   &eaOrigen  = "";
   &eaDestino = "";
   &Local     = 0;

   Comodin    = "";

   &aHoja     = "";
   &enTFich   = 0;
   &eaPathExc = "";
   &eaFichero = "";
   &eaNomOri  = "";

   nSw      = 0;
   nSal     = 0;
   nHay     = 0;
   nSwHay   = 0;
   nLinea   = 0;
   aCol     = "";
   aExcel   = "";
   nXls     = 0;
   aExt     = "";

   aFichero = "";
   &efFecha  = @;
   aQueQuiero = "";
   aNumCampos = "";
   nNumCampos = 0;
   aIDCampo   = "";
   nSwAlgun   = 0;
   &eSwErrorExcel = 0;
|FIN;

|INCLUYE dscont_i;

|| //////////////////////////////////////////////////////
|| ********************************************************************
|PROCESO GrabaAuxiliar;
     nLinea = nLinea + 1;
     |SI enTFich = 1; #101#0 = nLinea; |GRABA 020#101n; |FINSI;
     |SI enTFich = 2; #102#0 = nLinea; |GRABA 020#102n; |FINSI;
     |SI enTFich = 3; #103#0 = nLinea; |GRABA 020#103n; |FINSI;
     |SI enTFich = 4; #104#0 = nLinea; |GRABA 020#104n; |FINSI;
     nSwHay = 1;
|FPRC;

|PROCESO Una;
     ||| aCol contiene la columna, "A", "B" y nXls la fila

     aAlfa1 = aCol + nXls;
     aAlfa  = aCol + nXls;
     |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
     |SI FSalida ! 0;
         nSal = 1;
    |SINO;
         |QBF aAlfa;
         |SI aAlfa ! ""; |Y aAlfa ! aAlfa1; nHay = 1; |FINSI;
    |FINSI;

|FPRC;

|PROCESO Estructura1;
     |DDEFECTO #101;
     |PARA nPara1 = 1; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           aAlfa1 = ("000" + nPara1) % -103;
           aQueQuiero = "|C" + aAlfa1 + "IDCAMPO";
           aIDCampo = #101#aQueQuiero#;
           |QBF aIDCampo;
           aCol = aIDCampo;
           |HAZ Una;
           #101nPara1 = aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Estructura2;
     |DDEFECTO #102;
     |PARA nPara1 = 1; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           aAlfa1 = ("000" + nPara1) % -103;
           aQueQuiero = "|C" + aAlfa1 + "IDCAMPO";
           aIDCampo = #102#aQueQuiero#;
           |QBF aIDCampo;
           aCol = aIDCampo;
           |HAZ Una;
           #102nPara1 = aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Estructura3;
     |DDEFECTO #103;
     |PARA nPara1 = 1; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           aAlfa1 = ("000" + nPara1) % -103;
           aQueQuiero = "|C" + aAlfa1 + "IDCAMPO";
           aIDCampo = #103#aQueQuiero#;
           |QBF aIDCampo;
           aCol = aIDCampo;
           |HAZ Una;
           #103nPara1 = aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Estructura4;
     |DDEFECTO #104;
     |PARA nPara1 = 1; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           aAlfa1 = ("000" + nPara1) % -103;
           aQueQuiero = "|C" + aAlfa1 + "IDCAMPO";
           aIDCampo = #104#aQueQuiero#;
           |QBF aIDCampo;
           aCol = aIDCampo;
           |HAZ Una;
           #104nPara1 = aAlfa;
     |SIGUE;
|FPRC;

|PROCESO CargaHoja;
     nLinea = 0;

     |PARA nXls = 2; |SI nXls < 65536; |HACIENDO nXls = nXls + 1;
           nSal = 0;
           nHay = 0;
           |SI enTFich = 1;  |HAZ Estructura1;  |FINSI;
           |SI enTFich = 2;  |HAZ Estructura2;  |FINSI;
           |SI enTFich = 3;  |HAZ Estructura3;  |FINSI;
           |SI enTFich = 4;  |HAZ Estructura4;  |FINSI;

           |SI nSal = 1; |O nHay = 0;
               |SAL;
           |SINO;
               |HAZ GrabaAuxiliar;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO excelHoja;

     |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aHoja;
     |SI FSalida = 0;

         aQueQuiero = "|NC";
         |SI enTFich = 1;  aNumCampos = #101#aQueQuiero#;  |FINSI;
         |SI enTFich = 2;  aNumCampos = #102#aQueQuiero#;  |FINSI;
         |SI enTFich = 3;  aNumCampos = #103#aQueQuiero#;  |FINSI;
         |SI enTFich = 4;  aNumCampos = #104#aQueQuiero#;  |FINSI;
         nNumCampos = aNumCampos;
         nNumCampos = nNumCampos - 1;
         |SI enTFich = 2; nNumCampos = nNumCampos  - 1; |FINSI;

         |ABRE #101;
         |ABRE #102;
         |ABRE #103;
         |ABRE #104;
         |HAZ CargaHoja;
         |CIERRA #104;
         |CIERRA #103;
         |CIERRA #102;
         |CIERRA #101;

     |FINSI;
     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
|FPRC;

|PROGRAMA;

   eSwErrorExcel = 0;
   aFichero = ("1h" + Usuario) % 108;
   |NOME_DAT #101 aFichero;
   aFichero = ("2h" + Usuario) % 108;
   |NOME_DAT #102 aFichero;
   aFichero = ("3h" + Usuario) % 108;
   |NOME_DAT #103 aFichero;
   aFichero = ("4h" + Usuario) % 108;
   |NOME_DAT #104 aFichero;

    |CARGADLL "agixl97.dll";
    |SI FSalida < 0;
        |MENAV "0000No se puede usar agixl97.dll";
        eSwErrorExcel = 1;
    |SINO;
        aExcel = eaFichero;

        |XABRE "CE", aExcel, 0;
        |SI FSalida < 0;
            aAlfa = "0000No existe " + aExcel;
            |MENAV aAlfa;
            eSwErrorExcel = 1;
            |ACABA;
        |FINSI;

        aAlfa = "Pasando datos de la Hoja Excel ";
        |PINTA 2205, aAlfa;
        aAlfa = eaNomOri + " hoja " + aHoja;
        |PINTA 2305, aAlfa;
        |HAZ excelHoja;
        |DESCARGADLL "agixl97.dll";
    |FINSI;
    |SI nSwHay = 0;
         eSwErrorExcel = 1;
    |FINSI;
|FPRO;
