|FICHEROS;
     cacieinf #10;
     cacieex7 #0;
     cacieex6 #11;

     cacuenta #1;
     caconimp #8;
     catw0011 #900;
     catw0012 #901;
     catw0013 #902;
     catw0014 #903;
     catw0015 #904

     canempre #30;
     caselem1 #998;
     &regisnif@ #709;
     cawdatos #1900;
|FIN;

|VARIABLES;
   &eaVarDni  = "";
   &enCalcCif = 0;
   &aTexto    = "";
   &enLinea   = 0;
   &nImpCampo = 0;
   inform1    = "";
   inform1_14 = "cacieex6";
   inform1_15 = "cacieexa";
   inform2    = "cacieex7";
   inform3    = "catw0015";
   nCampos    = 0;
   nDocum     = 0;
   aAlfa1     = "";
   nEstado904 = 0;
   nivel      = 0;
   nLongT     = 0;
   &eaCtasLeg = "";
   &enCtasLeg = 0;
|FIN;

|INCLUYE dscont_i;

|CALCULO Defecto; |TIPO 7;
   #10#0 = enEjercicio;
   |PINTA #10#0;
   |HAZ DatosEmp;
|FCAL;

|PROCESO DatosEmp; |TIPO 7;
   |ABRE #8;
   |DDEFECTO #8;
   #8#0 = 1;
   |LEE 011#8=;
   |CIERRA #8;
   #10#5  = #8#7; |PINTA #10#5;
   aAlfa1 = #8#8; |C_M #10#5,1,aAlfa1;
|FPRC;

|CALCULO elDNI; |TIPO 6;
    |SI FSalida = 10;
        enCalcCif = 1;
        eaVarDni  = #11#22;
        |HAZ CalculoDNI;
        #10Campo = eaVarDni;
        |PINTA #10Campo;
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO SiBalance;
    aAlfa1 = #10#7;
    |C_M #10#8, 1, aAlfa1;
    |C_M #10#9, 1, aAlfa1;
    |SI aAlfa1 = "N";
        #10#8 = "N"; |PINTA #10#8;
        #10#9 = 4;   |PINTA #10#9;
    |FINSI;
|FCAL;

|CALCULO nivel; |TIPO 0;
    aAlfa1 = #10#8;
    |C_M #10#9, 1,aAlfa1;
    |SI aAlfa1 = "N";
        #10#9  = MaximoDigitos; |PINTA #10#9;
    |FINSI;
|FCAL;

|PROCESO miraniv; |TIPO 0;
    |C_M #10Campo, 0, aAlfa1;
    |SI aAlfa1 = "N"; |ACABA; |FINSI;

    nLongT = #10#9;
    |SI nLongT > 4;
        nivel = 0;
        |SI nLongT = dig4; nivel = 1;  |FINSI;
        |SI nLongT = dig5; nivel = 2;  |FINSI;
        |SI nLongT = dig6; nivel = 3;  |FINSI;
        |SI nLongT = dig7; nivel = 4;  |FINSI;
        |SI nLongT = dig8; nivel = 5;  |FINSI;
        |SI nLongT = dig9; nivel = 6;  |FINSI;
        |SI nivel = 0;
            |MENAV "    Error. Longitud incorrecta";
            |ERROR;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO Imp902;
 |PRINT;
 enLinea = 9;
|FPRC;

|DEFBUCLE Imp902;
 #902#1;
 ;
 #11#22, nCampos, "        ", 00, 000;
 #11#22, nCampos, "zzzzzzzz", 99, 999;
 ;
 NULL, Imp902;
|FIN;


|PROCESO Imp903;
 nImpCampo = nCampos;
 |SI nCampos = 8; aTexto = "ACTIVOS TEMPORALES"; |FINSI;
 |SI nCampos = 9; aTexto = "PASIVOS TEMPORALES"; |FINSI;
 |PRINT;
 |SI #903#6 = 0;
     enLinea = 8;
     |BUCLE Imp902;
 |FINSI;
 enLinea = 5;
|FPRC;

|DEFBUCLE Imp903;
 #903#1;
 ;
 #11#22, nCampos, 0, "            ";
 #11#22, nCampos, 1, "zzzzzzzzzzzz";
 ;
 NULL, Imp903;
|FIN;

|PROCESO Imp901;
 nImpCampo = nCampos;
 |SI nCampos = 10; aTexto = "PERDIDAS EJERCICIOS ANTERIORES"; |FINSI;
 |SI nCampos = 35; aTexto = "PROVISIONES DETERIORO CDTOS COMERCIALES"; |FINSI;
 |SI nCampos = 44; aTexto = "AJUSTES RESERVA CAPITALIZACION"; |FINSI;
 |SI nCampos = 48; aTexto = "AJUSTES RESERVA NIVELACION"; |FINSI;
 |PRINT;
 enLinea = 7;
|FPRC;

|DEFBUCLE Imp901;
 #901#1;
 ;
 #11#22, nCampos, "            ";
 #11#22, nCampos, "zzzzzzzzzzzz";
 ;
 NULL, Imp901;
|FIN;

|PROCESO Imp900;
 nImpCampo = nCampos;
 |SI nCampos = 7;  aTexto = "DIFERENCIAS PERMANENTES"; |FINSI;
 |SI nCampos = 33; aTexto = "DIFERENCIAS PERMANENTES POR DETERIORO"; |FINSI;
 |SI nCampos = 13; aTexto = "BONIFICACIONES Y DEDUCCIONES"; |FINSI;
 |SI nCampos = 14; aTexto = "RETENCIONES"; |FINSI;
 |PRINT;
 enLinea = 3;
|FPRC;

|DEFBUCLE Imp900;
 #900#1;
 ;
 #11#22, nCampos, "            ";
 #11#22, nCampos, "zzzzzzzzzzzz";
 ;
 NULL, Imp900;
|FIN;


|PROCESO ImpCierre7;
 |SI nDocum = -1; |O nDocum ! #0#12;
     enLinea = 0;
     nDocum = #0#12;
 |FINSI;

 |DDEFECTO #1;
 #1#0 = #0#2;
 |LEE 001#1=;

 |PRINT;
 enLinea = 1;
|FPRC;

|DEFBUCLE ImpCierre7;
 #0#1;
 ;
 #11#22, 001;
 #11#22, 999;
 ;
 NULL, ImpCierre7;
|FIN;

|PROCESO Imprimir;
  #1900#1  = #11#22;  || nif
  #1900#2  = #11#23;  || Nombre
  #1900#12 = #11#26;  || Ejercicio

  |SI #11#26 ! #10#0; |ACABA; |FINSI; || no ese el mismo ejercicio

  |SI #11#27 = "S"; |Y #10#3 = "N";
      |ACABA;
  |FINSI;

  |SI #11#27 = "N"; |Y #10#3 = "S";
      |ACABA;
  |FINSI;

 |INFOR inform1;
 |SI FSalida ! 0;
     |MENAV "    Error en el Informe";
     |ACABA;
 |FINSI;

 |DDEFECTO #904;
 #904#22 = #11#22;
 |LEE 001#904=;
 nEstado904 = FSalida;

 enLinea = 0;
 |PRINT;

 enLinea = 2; nCampos = 7;  |BUCLE Imp900;
 enLinea = 2; nCampos = 33; |BUCLE Imp900;
 enLinea = 4; nCampos = 8;  |BUCLE Imp903;
 enLinea = 4; nCampos = 9;  |BUCLE Imp903;
 enLinea = 6; nCampos = 35; |BUCLE Imp901;
 enLinea = 6; nCampos = 44; |BUCLE Imp901;
 enLinea = 6; nCampos = 10; |BUCLE Imp901;
 enLinea = 6; nCampos = 48; |BUCLE Imp901;
 enLinea = 2; nCampos = 13; |BUCLE Imp900;
 enLinea = 2; nCampos = 14; |BUCLE Imp900;

 |PIEINF;
 |FININF;

 |INFOR inform2;
 |SI FSalida ! 0;
     |MENAV "    Error en el Informe";
     |ACABA;
 |FINSI;

 nDocum = -1;
 |ABRE #1;
 |BUCLE ImpCierre7;
 |CIERRA #1;
 |PIEINF;
 |FININF;

 |SI #10#4 = "S";
     |SI nEstado904 = 0;
         |INFOR inform3;
         |SI FSalida ! 0;
             |MENAV "    Error en el Informe";
             |ACABA;
         |FINSI;
         |PRINT;
         |PIEINF;
         |FININF;
     |FINSI;
 |FINSI;

 |SI #10#6 = "S";
     |SUB_EJECUTA_NP "cabaresu;Impuesto";
 |FINSI;

 |SI #10#7 = "S";
     eaCtasLeg = #10#8;
     enCtasLeg = #10#9;

     |SUB_EJECUTA_NP "ca8ys001;Impuesto";
     |SUB_EJECUTA_NP "ca8ye001;Impuesto";
 |FINSI;
|FPRC;

|DEFBUCLE cacieex6;
    #11#1;
    ;
    #10#1;
    #10#2;
    e;
    NULL, Imprimir;
|FIN;

|PROCESO HazTodo;
    eaIa = #canempre#21;
    enM1 = #canempre#11;
    enM2 = #canempre#12;
    |HAZ LeeDatosEmpresa;

    |ABRE #904;
    |BUCLE cacieex6;
    |CIERRA #904;
|FPRC;
|| *************************************************************************

|CALCULO Tipo3; |TIPO 3;

   enDatos = 0; |SI #10#5 = "S"; enDatos = 1; |FINSI;
   |SI #10#0 ] 2015;
       inform1 = inform1_15;
   |SINO;
       inform1 = inform1_14;
   |FINSI;

   |IMPRE 0;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |SI #48#27 = "S";
       |HAZ MultiEmpresa;
   |SINO;
       |DFICE dirfich0;
       |HAZ HazTodo;
   |FINSI;

   |FINIMP;
|FCAL;

|| *************************************************************************
|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #0   dirfich0;
   |PATH_DAT #1   dirfich0;
   |PATH_DAT #11  dirfich0;
   |PATH_DAT #900 dirfich0;
   |PATH_DAT #901 dirfich0;
   |PATH_DAT #902 dirfich0;
   |PATH_DAT #903 dirfich0;
   |PATH_DAT #904 dirfich0;

   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
  #caselem1#1;
  ;
  000001;
  999999;
  ;
  NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;
