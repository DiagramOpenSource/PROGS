|FICHEROS;
     :dsarchi/dpntm100;
     :dsarchi/dpntm101;
     :dsarchi/dsarw114;
|FIN;

|INCLUYE z0100var;

|PROCESO RestoBases100;
     |SI #dsarw114#30 ! 0;
         |LEE 000#dpntm100.u;
         |SI FSalida ! 0;  #dpntm100#0 = 0;  |FINSI;
         enReg = #dpntm100#0 + 1;

         |DDEFECTO #dpntm100;
         #dpntm100#0  = enReg;
         |GRABA 020#dpntm100.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm100#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         |SI #dpntm100#1 = 0;  #dpntm100#1 = 1;  |FINSI;

         #dpntm100#0  = enReg;
         #dpntm100#44 = "N";
         #dpntm100#45 = enRegPrimerIVA;
         #dpntm100#21 = #dsarw114#30;
         #dpntm100#22 = #dsarw114#31;
         #dpntm100#23 = #dsarw114#32;
         #dpntm100#24 = #dsarw114#33;
         #dpntm100#25 = #dsarw114#34;
         #dpntm100#26 = #dsarw114#35;
         #dpntm100#27 = #dsarw114#36;
         #dpntm100#71 = #dsarw114#72;
         #dpntm100#30 = #dsarw114#21;
         #dpntm100#31 = #dsarw114#22;
         #dpntm100#32 = #dsarw114#23;
         #dpntm100#33 = #dsarw114#24;
         #dpntm100#34 = #dsarw114#25;
         #dpntm100#35 = #dsarw114#26;
         #dpntm100#36 = #dsarw114#27;
         #dpntm100#72 = #dsarw114#71;

         |GRABA 020#dpntm100.a;
         |LIBERA #dpntm100;
     |FINSI;

     |SI #dsarw114#37 ! 0;
         |LEE 000#dpntm100.u;
         |SI FSalida ! 0;  #dpntm100#0 = 0;  |FINSI;

         enReg = #dpntm100#0 + 1;
         |DDEFECTO #dpntm100;
         #dpntm100#0  = enReg;
         |GRABA 020#dpntm100.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm100#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         #dpntm100#0  = enReg;
         #dpntm100#44 = "N";
         #dpntm100#45 = enRegPrimerIVA;
         #dpntm100#21 = #dsarw114#37;
         #dpntm100#22 = #dsarw114#38;
         #dpntm100#23 = #dsarw114#39;
         #dpntm100#24 = #dsarw114#40;
         #dpntm100#25 = #dsarw114#41;
         #dpntm100#26 = #dsarw114#42;
         #dpntm100#27 = #dsarw114#43;
         #dpntm100#71 = #dsarw114#73;
         #dpntm100#37 = #dsarw114#21;
         #dpntm100#38 = #dsarw114#22;
         #dpntm100#39 = #dsarw114#23;
         #dpntm100#40 = #dsarw114#24;
         #dpntm100#41 = #dsarw114#25;
         #dpntm100#42 = #dsarw114#26;
         #dpntm100#43 = #dsarw114#27;
         #dpntm100#73 = #dsarw114#71;

         |GRABA 020#dpntm100.a;
         |LIBERA #dpntm100;
     |FINSI;

     |SI #dsarw114#57 ! 0;
         |LEE 000#dpntm100.u;
         |SI FSalida ! 0;  #dpntm100#0 = 0;  |FINSI;

         enReg = #dpntm100#0 + 1;
         |DDEFECTO #dpntm100;
         #dpntm100#0  = enReg;
         |GRABA 020#dpntm100.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm100#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         #dpntm100#0  = enReg;
         #dpntm100#44 = "N";
         #dpntm100#45 = enRegPrimerIVA;
         #dpntm100#21 = #dsarw114#57;
         #dpntm100#22 = #dsarw114#58;
         #dpntm100#23 = #dsarw114#59;
         #dpntm100#24 = #dsarw114#60;
         #dpntm100#25 = #dsarw114#61;
         #dpntm100#26 = #dsarw114#62;
         #dpntm100#27 = #dsarw114#63;
         #dpntm100#71 = #dsarw114#74;
         #dpntm100#57 = #dsarw114#21;
         #dpntm100#58 = #dsarw114#22;
         #dpntm100#59 = #dsarw114#23;
         #dpntm100#60 = #dsarw114#24;
         #dpntm100#61 = #dsarw114#25;
         #dpntm100#62 = #dsarw114#26;
         #dpntm100#63 = #dsarw114#27;
         #dpntm100#74 = #dsarw114#71;

         |GRABA 020#dpntm100.a;
         |LIBERA #dpntm100;
     |FINSI;

     |SI #dsarw114#64 ! 0;
         |LEE 000#dpntm100.u;
         |SI FSalida ! 0;  #dpntm100#0 = 0;  |FINSI;

         enReg = #dpntm100#0 + 1;
         |DDEFECTO #dpntm100;
         #dpntm100#0  = enReg;
         |GRABA 020#dpntm100.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm100#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         #dpntm100#0  = enReg;
         #dpntm100#44 = "N";
         #dpntm100#45 = enRegPrimerIVA;
         #dpntm100#21 = #dsarw114#64;
         #dpntm100#22 = #dsarw114#65;
         #dpntm100#23 = #dsarw114#66;
         #dpntm100#24 = #dsarw114#67;
         #dpntm100#25 = #dsarw114#68;
         #dpntm100#26 = #dsarw114#69;
         #dpntm100#27 = #dsarw114#70;
         #dpntm100#71 = #dsarw114#75;
         #dpntm100#64 = #dsarw114#21;
         #dpntm100#65 = #dsarw114#22;
         #dpntm100#66 = #dsarw114#23;
         #dpntm100#67 = #dsarw114#24;
         #dpntm100#68 = #dsarw114#25;
         #dpntm100#69 = #dsarw114#26;
         #dpntm100#70 = #dsarw114#27;
         #dpntm100#75 = #dsarw114#71;

         |GRABA 020#dpntm100.a;
         |LIBERA #dpntm100;
     |FINSI;
|FPRC;

|PROCESO GrabaBloque100;
     enContIva = enContIva + 1;

     |SI enCuI = 0;  enIva = 0;  |FINSI;
     |SI enCuR = 0;  enRec = 0;  |FINSI;

     enCuT     = 0;

     |SI enTRet ! 0;
         |SI eaSobre = "B";
             enCuT = (enBas * enTRet) / enTBas;
         |SINO;
             enCuT = ((enBas + enCuI + enCuR) * enTRet) / (enTBas + enTCuI + enTCuR);
         |FINSI;
     |FINSI;

     |SI enContIva = 1;
         #dpntm100#21 = enBas;
         #dpntm100#22 = enIva;
         #dpntm100#23 = enCuI;
         #dpntm100#24 = enRec;
         #dpntm100#25 = enCuR;
         #dpntm100#26 = enRet;
         #dpntm100#27 = enCuT;
         enLin1       = enTIVA;
     |FINSI;

     |SI enContIva = 2;
         #dpntm100#30 = enBas;
         #dpntm100#31 = enIva;
         #dpntm100#32 = enCuI;
         #dpntm100#33 = enRec;
         #dpntm100#34 = enCuR;
         #dpntm100#35 = enRet;
         #dpntm100#36 = enCuT;
         enLin2       = enTIVA;
     |FINSI;

     |SI enContIva = 3;
         #dpntm100#37 = enBas;
         #dpntm100#38 = enIva;
         #dpntm100#39 = enCuI;
         #dpntm100#40 = enRec;
         #dpntm100#41 = enCuR;
         #dpntm100#42 = enRet;
         #dpntm100#43 = enCuT;
         enLin3       = enTIVA;
     |FINSI;

     |SI enContIva = 4;
         #dpntm100#57 = enBas;
         #dpntm100#58 = enIva;
         #dpntm100#59 = enCuI;
         #dpntm100#60 = enRec;
         #dpntm100#61 = enCuR;
         #dpntm100#62 = enRet;
         #dpntm100#63 = enCuT;
         enLin4       = enTIVA;
     |FINSI;

     |SI enContIva = 5;
         #dpntm100#64 = enBas;
         #dpntm100#65 = enIva;
         #dpntm100#66 = enCuI;
         #dpntm100#67 = enRec;
         #dpntm100#68 = enCuR;
         #dpntm100#69 = enRet;
         #dpntm100#70 = enCuT;
         enLin5       = enTIVA;
     |FINSI;

     enDRet = enDRet + enCuT;
|FPRC;

|PROCESO RestoBases101;
     |SI #dsarw114#30 ! 0;
         |LEE 000#dpntm101.u;
         |SI FSalida ! 0;  #dpntm101#0 = 0;  |FINSI;
         enReg = #dpntm101#0 + 1;

         |DDEFECTO #dpntm101;
         #dpntm101#0  = enReg;
         |GRABA 020#dpntm101.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm101#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         |SI #dpntm101#1 = 0;  #dpntm101#1 = 1;  |FINSI;

         #dpntm101#0  = enReg;
         #dpntm101#1  = #48#30;
         #dpntm101#44 = "N";
         #dpntm101#45 = enRegPrimerIVA;
         #dpntm101#21 = #dsarw114#30;
         #dpntm101#22 = #dsarw114#31;
         #dpntm101#23 = #dsarw114#32;
         #dpntm101#24 = #dsarw114#33;
         #dpntm101#25 = #dsarw114#34;
         #dpntm101#26 = #dsarw114#35;
         #dpntm101#27 = #dsarw114#36;
         #dpntm101#71 = #dsarw114#72;
         #dpntm101#30 = #dsarw114#21;
         #dpntm101#31 = #dsarw114#22;
         #dpntm101#32 = #dsarw114#23;
         #dpntm101#33 = #dsarw114#24;
         #dpntm101#34 = #dsarw114#25;
         #dpntm101#35 = #dsarw114#26;
         #dpntm101#36 = #dsarw114#27;
         #dpntm101#72 = #dsarw114#71;

         |GRABA 020#dpntm101.a;
         |LIBERA #dpntm101;
     |FINSI;

     |SI #dsarw114#37 ! 0;
         |LEE 000#dpntm101.u;
         |SI FSalida ! 0;  #dpntm101#0 = 0;  |FINSI;

         enReg = #dpntm101#0 + 1;
         |DDEFECTO #dpntm101;
         #dpntm101#0  = enReg;
         |GRABA 020#dpntm101.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm101#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         #dpntm101#0  = enReg;
         #dpntm101#44 = "N";
         #dpntm101#45 = enRegPrimerIVA;
         #dpntm101#21 = #dsarw114#37;
         #dpntm101#22 = #dsarw114#38;
         #dpntm101#23 = #dsarw114#39;
         #dpntm101#24 = #dsarw114#40;
         #dpntm101#25 = #dsarw114#41;
         #dpntm101#26 = #dsarw114#42;
         #dpntm101#27 = #dsarw114#43;
         #dpntm101#71 = #dsarw114#73;
         #dpntm101#37 = #dsarw114#21;
         #dpntm101#38 = #dsarw114#22;
         #dpntm101#39 = #dsarw114#23;
         #dpntm101#40 = #dsarw114#24;
         #dpntm101#41 = #dsarw114#25;
         #dpntm101#42 = #dsarw114#26;
         #dpntm101#43 = #dsarw114#27;
         #dpntm101#73 = #dsarw114#71;

         |GRABA 020#dpntm101.a;
         |LIBERA #dpntm101;
     |FINSI;

     |SI #dsarw114#57 ! 0;
         |LEE 000#dpntm101.u;
         |SI FSalida ! 0;  #dpntm101#0 = 0;  |FINSI;

         enReg = #dpntm101#0 + 1;
         |DDEFECTO #dpntm101;
         #dpntm101#0  = enReg;
         |GRABA 020#dpntm101.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm101#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         #dpntm101#0  = enReg;
         #dpntm101#44 = "N";
         #dpntm101#45 = enRegPrimerIVA;
         #dpntm101#21 = #dsarw114#57;
         #dpntm101#22 = #dsarw114#58;
         #dpntm101#23 = #dsarw114#59;
         #dpntm101#24 = #dsarw114#60;
         #dpntm101#25 = #dsarw114#61;
         #dpntm101#26 = #dsarw114#62;
         #dpntm101#27 = #dsarw114#63;
         #dpntm101#71 = #dsarw114#74;
         #dpntm101#57 = #dsarw114#21;
         #dpntm101#58 = #dsarw114#22;
         #dpntm101#59 = #dsarw114#23;
         #dpntm101#60 = #dsarw114#24;
         #dpntm101#61 = #dsarw114#25;
         #dpntm101#62 = #dsarw114#26;
         #dpntm101#63 = #dsarw114#27;
         #dpntm101#74 = #dsarw114#71;

         |GRABA 020#dpntm101.a;
         |LIBERA #dpntm101;
     |FINSI;

     |SI #dsarw114#64 ! 0;
         |LEE 000#dpntm101.u;
         |SI FSalida ! 0;  #dpntm101#0 = 0;  |FINSI;

         enReg = #dpntm101#0 + 1;
         |DDEFECTO #dpntm101;
         #dpntm101#0  = enReg;
         |GRABA 020#dpntm101.b;

         |PARA nCampo = 1;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
               #dpntm101#nCampo# = #dsarw114#nCampo#;
         |SIGUE;

         #dpntm101#0  = enReg;
         #dpntm101#44 = "N";
         #dpntm101#45 = enRegPrimerIVA;
         #dpntm101#21 = #dsarw114#64;
         #dpntm101#22 = #dsarw114#65;
         #dpntm101#23 = #dsarw114#66;
         #dpntm101#24 = #dsarw114#67;
         #dpntm101#25 = #dsarw114#68;
         #dpntm101#26 = #dsarw114#69;
         #dpntm101#27 = #dsarw114#70;
         #dpntm101#71 = #dsarw114#75;
         #dpntm101#64 = #dsarw114#21;
         #dpntm101#65 = #dsarw114#22;
         #dpntm101#66 = #dsarw114#23;
         #dpntm101#67 = #dsarw114#24;
         #dpntm101#68 = #dsarw114#25;
         #dpntm101#69 = #dsarw114#26;
         #dpntm101#70 = #dsarw114#27;
         #dpntm101#75 = #dsarw114#71;

         |GRABA 020#dpntm101.a;
         |LIBERA #dpntm101;
     |FINSI;
|FPRC;

|PROCESO GrabaBloque101;
     enContIva = enContIva + 1;

     |SI enCuI = 0;  enIva = 0;  |FINSI;
     |SI enCuR = 0;  enRec = 0;  |FINSI;

     enCuT     = 0;

     |SI enTRet ! 0;
         |SI eaSobre = "B";
             enCuT = (enBas * enTRet) / enTBas;
         |SINO;
             enCuT = ((enBas + enCuI + enCuR) * enTRet) / (enTBas + enTCuI + enTCuR);
         |FINSI;
     |FINSI;

     |SI enContIva = 1;
         #dpntm101#21 = enBas;
         #dpntm101#22 = enIva;
         #dpntm101#23 = enCuI;
         #dpntm101#24 = enRec;
         #dpntm101#25 = enCuR;
         #dpntm101#26 = enRet;
         #dpntm101#27 = enCuT;
         enLin1       = enTIVA;
     |FINSI;

     |SI enContIva = 2;
         #dpntm101#30 = enBas;
         #dpntm101#31 = enIva;
         #dpntm101#32 = enCuI;
         #dpntm101#33 = enRec;
         #dpntm101#34 = enCuR;
         #dpntm101#35 = enRet;
         #dpntm101#36 = enCuT;
         enLin2       = enTIVA;
     |FINSI;

     |SI enContIva = 3;
         #dpntm101#37 = enBas;
         #dpntm101#38 = enIva;
         #dpntm101#39 = enCuI;
         #dpntm101#40 = enRec;
         #dpntm101#41 = enCuR;
         #dpntm101#42 = enRet;
         #dpntm101#43 = enCuT;
         enLin3       = enTIVA;
     |FINSI;

     |SI enContIva = 4;
         #dpntm101#57 = enBas;
         #dpntm101#58 = enIva;
         #dpntm101#59 = enCuI;
         #dpntm101#60 = enRec;
         #dpntm101#61 = enCuR;
         #dpntm101#62 = enRet;
         #dpntm101#63 = enCuT;
         enLin4       = enTIVA;
     |FINSI;

     |SI enContIva = 5;
         #dpntm101#64 = enBas;
         #dpntm101#65 = enIva;
         #dpntm101#66 = enCuI;
         #dpntm101#67 = enRec;
         #dpntm101#68 = enCuR;
         #dpntm101#69 = enRet;
         #dpntm101#70 = enCuT;
         enLin5       = enTIVA;
     |FINSI;

     enDRet = enDRet + enCuT;
|FPRC;
