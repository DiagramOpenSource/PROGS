|FICHEROS;
   catqm001 #0;

   cacuenta #2;
   :/modelos/def/dsmom030 #330;

   caivaasi #200;
|FIN;

|VARIABLES;
  nInkey    = 0;

  aAlfa1    = "";
  aAlfa2    = "";
  nNume1    = 0;
  nPara1    = 0;
  ConcepAnt = 0;
  nModo     = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscoiv_i;

|PROCESO Tipo8; |TIPO 8;
  |HAZ inicio;
  |HAZ DirAplicSt;

  |HAZ eLeeParametro;
|FPRC;

|PROCESO AntesNumero; |TIPO 7;

  nModo = (FEntrada/ 100) ! 0;
  |SI nModo = 1;
     |SALVA_DATOS #0;

     #0#0 = 99;
     |LEE 010#0];
     |SI FSalida = 0;
         |LEE 040#0a;
     |SINO;
         |LEE 040#0u;
     |FINSI;
     nNume1 = 1;
     |SI FSalida = 0;  nNume1 = #0#0 + 1;  |FINSI;

     |REPON_DATOS #0;
     #0#0 = nNume1; |PINTA #0#0;
  |FINSI;
|FPRC;

|PROCESO TrasNumero; |TIPO 0;
    |SI nModo = 1;
        #0#25 = eaDfDepC; |PINTA #0#25;
        #0#26 = eaDfSubC; |PINTA #0#26;
    |FINSI;
|FPRC;

|CALCULO PonBarra; |TIPO 0;
     nInkey = FSalida;

     |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        aAlfa1 = aAlfa1 % 280;
        #0Campo = aAlfa1;
        |PINTA #0Campo
     |FINSI;

     |SI nInkey = 11; |Y Campo ! 22;
         #0Campo = #0#22;
         |PINTA #0Campo;
     |FINSI;

     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     aAlfa2 = aAlfa1 % -101;
     |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
          #0Campo = aAlfa1 + "/";
          |PINTA #0Campo;
     |FINSI;
|FCAL;

|CALCULO AntesDepar; |TIPO 7;
   |C_M #0Campo,1,eaDepar;
   |SI eaDepar = "N"; |ACABA; |FINSI;
   |SI Haybasica = 1;
       |MENSA "    <F2> Consultar Actividades";
   |SINO;
       |MENSA "    <F2> Consultar Departamentos";
   |FINSI;
|FCAL;

|CALCULO TrasDepar; |TIPO 0;
   |SI eaDepar = "N"; |ACABA; |FINSI;

   nInkey = FSalida;

   |BLIN 4;
   eOpDep = 0; || 1 = Consulta pantalla
   |SI nInkey = 10; eOpDep = 1;  |FINSI;
   enActividad = #0#25;
   eaCodDep    = #0#25;
   |HAZ Actividad;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Actividad / Departamento";
       |ERROR;
   |SINO;
       #0#25 = eaCodDep;    |PINTA #0#25;
       |SI efActFin > "01.01.1900"; |Y snFilBa = "S";
           aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
           |CONFI aAlfa1;
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
       |SI eaEsCom = "S";
           |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Movimientos ? ";
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;
|FCAL;

|CALCULO AntesSub; |TIPO 7;
   |C_M #0Campo,1,eaSubde;
   |SI eaSubde = "N"; |ACABA; |FINSI;

   |SI Haybasica = 1;
       |SI enArrend = 1;
           |MENSA "    Subdepartamento. <F2> Consultar Referencias Catastrales";
       |SINO;
           |MENSA "    Subdepartamento. <F2> Consultar Cultivos";
       |FINSI;
   |FINSI;
|FCAL;

|CALCULO TrasSub; |TIPO 0;
   |SI eaSubde = "N"; |ACABA; |FINSI;

   nInkey = FSalida;
   |BLIN 4;
   eOpSub = 0; || 1 = Consulta pantalla
   |SI nInkey = 10; eOpSub = 1;  |FINSI;

   eaCodSubdep = #0#26;
   enQue = 1;
   |HAZ SubActividad;
   enQue = 0;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe SubDepartamento";
       |ERROR;
   |SINO;
       #0#26 = eaCodSubdep; |PINTA #0#26;
   |FINSI;
|FCAL;

|CALCULO cuenta; |TIPO 6;
   emCta = 1;        || Dar mensajes de error

   eaCuenta = #0Campo;
   salidas  = FSalida;
   |HAZ FiltraPuntos;
   #0Campo = eaCuenta;
   |PINTA #0Campo;

   |HAZ SacaNivel;
   FSalida = salidas;
|FCAL;

|CALCULO cuenfin; |TIPO 0;
   emCta = 1;        || Dar mensajes de error
   eaCuenta = #0Campo;
   |HAZ LeeCuenta;
   |SI eswCta = 0;
       nNume1   = Campo + 7;
       |SI Campo = 32; nNume1 = 33; |FINSI;
       #0nNume1 = #cacuenta#2; |PINTA #0nNume1;
   |FINSI;
|FCAL;

|CALCULO TrasConcepto;  |TIPO 6;
  ConcepAnt = Contenido;

  |ABRE #dsmom030;
  #dsmom030#0 = #0Campo;
  |LEE 021#dsmom030.=;
  |SI FSalida ! 0;
      |DDEFECTO #dsmom030;
      |MENAV "    No existe Concepto.";
      |ERROR;
  |FINSI;
  |CIERRA #dsmom030;
|FCAL;

|CALCULO recoge; |TIPO 7;

   nNume1 = Campo - 1;
   |SI #0nNume1 ! ConcepAnt;
       |ABRE #dsmom030;
       #dsmom030#0 = #0nNume1;
       |LEE 021#dsmom030.=;
       |SI FSalida ! 0;  |DDEFECTO #dsmom030;  |FINSI;
       #0Campo = #dsmom030#1;
       |PINTA #0Campo;
       |CIERRA #dsmom030;
       |PTEC 816;
   |FINSI;
|FCAL;
