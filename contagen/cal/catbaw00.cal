|FICHEROS;
   cacuenta;
   caextrp4;
   camaasil;
   camaasic;

   catbam05;
   caw00056,MANTE;

   cafantas;
|FIN;

|VARIABLES;
   seleccio  = 0;
   lalinea   = 0;
   totallin  = 0;
   nOk       = 0;
   nConNum   = 0;

   nTecla    = 0;
   aFichero  = "";
   aAlfa     = "";
   nEstado   = 0;

   &enDiario    = 0;
   &efFecha     = @;
   &enDocumento = 0;
   &enApunte    = 0;

   &eaContra    = "";
   &SwContra    = 0;
   &enDesde     = 0;
   &enLinea     = 0;
   &enImporte   = 0;
   &enDImporte  = 0;
   &enHImporte  = 0;
   &eaSigno     = "";
   &efDFecha    = @;
   &efHFecha    = @;
|FIN;

|INCLUYE dscont_i;

|PROCESO ModiPan_2;
   aAlfa = "N";
   |SI #camaasic#7 ! 0;
       aAlfa = "S";
       |ATRI R; |PINTA 0861, "Asto Predef.: "; |ATRI 0;
   |FINSI;
   |C_V #caextrp4#17, 1, aAlfa;

   |SI eaSubde = "N";
        |C_A #caextrp4#6, 1, 29;
        |C_P #caextrp4#7, 1, 1266;
        |C_V #caextrp4#16,1, "N";
        |PINTA 0961, "ÄÄÄÄÂÄÄ";
        |PINTA 1061, "    ³  ";
        |PINTA 1161, "ÄÄÄÄÅÄÄ";
        |PINTA 1261, "    ³  ";
        |PINTA 1361, "    ³  ";
        |PINTA 1461, "    ³  ";
        |PINTA 1561, "    ³  ";
        |PINTA 1661, "    ³  ";
        |PINTA 1761, "    ³  ";
        |PINTA 1861, "    ³  ";
        |PINTA 1961, "    ³  ";
        |ATRI R; |PINTA 1061, "    "; |PINTA 1066, "Dp"; |ATRI 0;
   |SINO;
        |SI enSubde = 1; |Y eaDepar = "N";
            |C_A #caextrp4#6, 1, 28;
            |C_V #caextrp4#7, 1, "N";
            |PINTA 0961, "Ä";
            |ATRI R; |PINTA 1061, "   "; |ATRI 0;
            |PINTA 1161, " ";
            |PINTA 1261, " ";
            |PINTA 1361, " ";
            |PINTA 1461, " ";
            |PINTA 1561, " ";
            |PINTA 1661, " ";
            |PINTA 1761, " ";
            |PINTA 1861, " ";
            |PINTA 1961, " ";
            |PINTA 2061, " ";
        |FINSI;
   |FINSI;
|FPRC;

|PROCESO lee_asiento1;             || CARGA LA PANTALLA DEL ASIENTO COMPLETO
   seleccio = 1;
   |HAZ cuenta;
   |DDEFECTO #caextrp4;
   #caextrp4#00 = #camaasil#3;   || apunte
   #caextrp4#01 = #camaasil#16;  || cuenta DEBE
   #caextrp4#02 = #camaasil#17;  || digito DEBE
   #caextrp4#03 = #camaasil#10;  || cuenta HABER
   #caextrp4#04 = #camaasil#11;  || digito HABER
   #caextrp4#05 = #camaasil#6;   || concepto
   #caextrp4#06 = #camaasil#7;   || descripcion
   #caextrp4#07 = #camaasil#21;  || departamento
   #caextrp4#08 = #camaasil#9;   || importe
   #caextrp4#09 = #cacuenta#2;   || descripcion
   #caextrp4#10 = #cacuenta#51;  || debe
   #caextrp4#11 = #cacuenta#52;  || haber
   #caextrp4#12 = #cacuenta#53;  || saldo
   #caextrp4#13 = #camaasil#0;   || diario
   #caextrp4#14 = #camaasil#1;   || fecha
   #caextrp4#15 = #camaasil#2;   || documento
   #caextrp4#16 = #camaasil#28;  || Subdepartamento
   #caextrp4#17 = #camaasic#7;   || Asto Predefinido
   |SI #caextrp4#0 = enApunte;
       lalinea = #caextrp4#0;
   |FINSI;
   |GRABA 020#caextrp4.n;
   totallin = totallin + 1;
|FPRC;

|DEFBUCLE lee_asiento;
   #camaasil#1;
   ;
   enDiario, efFecha, enDocumento, 0001;
   enDiario, efFecha, enDocumento, 9999;
   e;
   NULL, lee_asiento1;
|FIN;

|PROCESO mini;
   |SI FSalida = "POSICION";  |Y totallin > 8;
       #caextrp4#0 = lalinea;
   |SINO;
      #caextrp4#0 = 1;
   |FINSI;
|FPRC;

|PROCESO maxi;
   #caextrp4#0 = 9999;
|FPRC;

|PROCESO ConsultaAsto;

   aFichero = ("q" + Usuario);
   aFichero = (aFichero + "zzzzzzzz") % 108;
   |NOME_DAT #caextrp4#aFichero#;
   |DELINDEX #caextrp4;

   seleccio = 0;

   |ABRE #camaasic;
   |DDEFECTO #camaasic;
   #camaasic#0 = enDiario;
   #camaasic#1 = efFecha;
   #camaasic#2 = enDocumento;
   |LEE 001#camaasic.=;
   |CIERRA #camaasic;

   |ABRE #caextrp4;
   lalinea = 1;
   totallin = 0;
   |BUCLE lee_asiento;
   |CIERRA #caextrp4;

   |SI seleccio ! 0;
      |PUSHV 07012380;
      |PINPA #0#caextrp4;
      |HAZ ModiPan_2;
      |ENTLINEAL #1#caextrp4, -1, 4, 20, 0, mini, maxi;
      |POPV;
   |SINO;
      |MENAV "    Error. Asiento no encontrado";
   |FINSI;
   |DELINDEX #caextrp4;
|FPRC;

|PROCESO cuenta;
   |ABRE #cacuenta;
   #cacuenta#0 = #camaasil#4;
   |LEE 001#cacuenta.=;
   |SI FSalida ! 0;
       |DDEFECTO #cacuenta;
       #cacuenta#2 = "<CUENTA INEXISTENTE>";
   |FINSI;
   |CIERRA #cacuenta;
|FPRC;

|PROCESO LeoCamaasil;
  nOk = 1;
  #catbam05#0 = #camaasil#0;
  #catbam05#1 = #camaasil#1;
  #catbam05#2 = #camaasil#2;
  #catbam05#3 = #camaasil#3;
  |LEE 041#catbam05.=;
  |SI FSalida ! 0; nOk = 0; |FINSI;

  |SI nOk = 1; |ACABA; |FINSI;

  |HAZ cuenta;
  nConNum = nConNum + 1;
  #caw00056#0  = #camaasil#0;
  #caw00056#1  = #camaasil#1;
  #caw00056#2  = #camaasil#2;
  #caw00056#3  = #camaasil#3;
  #caw00056#4  = #camaasil#4;
  #caw00056#5  = #camaasil#5;
  #caw00056#6  = #camaasil#6;
  #caw00056#7  = #camaasil#7;
  #caw00056#8  = #camaasil#8;
  #caw00056#9  = #camaasil#9;
  #caw00056#10 = #camaasil#21;
  #caw00056#11 = #camaasil#28;
  #caw00056#12 = #camaasil#1;
  #caw00056#13 = #cacuenta#2;
  #caw00056#14 = enImporte;
  |GRABA 020#caw00056.n;
|FPRC;

|DEFBUCLE LeoCamaasil;
  #camaasil#1;
  8,9,18;
  01, efDFecha, 000001, 0001, eaSigno, enDImporte, " ";
  98, efHFecha, 999999, 9999, eaSigno, enHImporte, " ";
  ;
  NULL, LeoCamaasil;
|FIN;

|PROCESO Tipo0w56; |TIPO 0;
      enDiario    = #caw00056#0;
      efFecha     = #caw00056#1;
      enDocumento = #caw00056#2;
      enApunte    = #caw00056#3;
      eaContra    = #caw00056#4;
      SwContra    = 1;
      |PTEC 806;
|FPRC;

|PROCESO Tipo11w56; |TIPO 11;
  nTecla = FSalida;

  |SI nTecla = 12;
      enDiario    = #caw00056#0;
      efFecha     = #caw00056#1;
      enDocumento = #caw00056#2;
      enApunte    = #caw00056#3;
      |HAZ ConsultaAsto;
  |FINSI;

|FPRC;

|PROCESO Alta42;
   #caw00056#0 = 00;
   #caw00056#1 = fec1;
   #caw00056#2 = 000001;
   #caw00056#3 = 0001;
|FPRC;

|PROCESO Baja42;
   #caw00056#0 = 98;
   #caw00056#1 = fec2;
   #caw00056#2 = 999999;
   #caw00056#3 = 9999;
|FPRC;

|PROCESO BuscaPunteo;
       SwContra = 0;
       |PUSHV 0501 2180;
       aFichero = "4x" + Usuario;
       |NOME_DAT #caw00056#aFichero#;
       |DELINDEX #caw00056;

       |ABRE #caw00056;
       |ABRE #catbam05;
       |SELECT #1#catbam05;
       |BUCLE LeoCamaasil;
       |CIERRA #catbam05;
       |CIERRA #caw00056;

       nEstado = 0;
       |SI nConNum = 0;
           |MENAV "    No Existe Apuntes para puntear";
           nEstado = -1;
       |SINO;
           |PINPA #0#caw00056;
           |ENTLINEAL #1#caw00056, -1, 4, 22, 0, Alta42, Baja42;
       |FINSI;

       |SI enDiario ! 0; |Y enDocumento ! 0; |Y nEstado = -1;
           |CONFI "0000Borrar el punteo actual";
           |SI FSalida = 0;
               enDiario   = 0;
               enDocumento = 0;
           |FINSI;
       |FINSI;
       |POPV;
|FPRC;
