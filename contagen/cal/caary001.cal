|FICHEROS;
    caary001;

    canempre;

    :/basica/def/agifigen;
    :/modelos/def/dsmom030;

    :/integral/def/dsam0000;

    caarm001;
    caarm002;

    cawdatos;
|FIN;

|VARIABLES;
     &entrada    = 1;
     &eNoLeo     = 0;
     x           = 0;
     nCampo      = 0;
     nSwTipo     = 0;
     nPin1       = 0;
     nHay        = 0;
     aFichero    = "";
     nDEmpresa   = 0;
     nHEmpresa   = 0;
     fDFecha     = @;
     fHFecha     = @;
     aEstado     = "";
     &enSwLinea = 0;

     nConcepto   = "";
     fFecUlt     = @;
     nUltLin     = 0;

     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     fFecha      = @;
     nPara1      = 0;
     nPara2      = 0;
     nNume1      = 0;
     nNume2      = 0;
     nNume3      = 0;

     nEjer       = 0;
     aPath       = "";
     nSwConta    = 0;
     nSwOp       = 0;
     nSwOpL      = 0;
     &nEmpresa   = 0;

     nSw         = 0;
     nSwL        = 0;
     swImpresora = 0;
     aParam      = "";

     aDCampo41   = "";
     aHCampo41   = "";
     aDCampo42   = "";
     aHCampo42   = "";

     &eaTituloL  = "";
     &men        = "";
     informe     = "";
     inform1     = "caary001";
     inform2     = "caaryf01";
     inform3     = "caaryl01";

     nAlgun      = 0;
     f1          = @;
     f2          = @;
     &aAgente    = "";
     &aAgenteNom = "";

  CodigoEmpresa  = 0;
  PeriodoEmpresa = 0;
 &enEmpresaPINET = 0;
 &enErrorPINET   = 0;
|FIN;

|INCLUYE dscont_i;

|| *************************************************************************
||                        CALCULOS DE PANTALLA
|| *************************************************************************
|PROCESO Mayor;
     |C_M #caary001#Campo#, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #caary001#Campo# = "N";
         |PARA x = 5;  |SI x [ 24;  |HACIENDO x = x + 1;
               |C_M #caary001#x#,1,"S";
         |SIGUE;
         |C_M #caary001#3,1,"N"; #caary001#3 = 0; |PINTA #caary001#3;
         |C_M #caary001#4,1,"N"; #caary001#4 = 0; |PINTA #caary001#4;
     |SINO;
         |PARA x = 5;  |SI x [ 24;  |HACIENDO x = x + 1;
               |C_M #caary001#x#,1,"N"; #caary001#x# = 0; |PINTA #caary001#x#;
         |SIGUE;
         |C_M #caary001#3,1,"S";
         |C_M #caary001#4,1,"S";
     |FINSI;
|FPRC;

|CALCULO SelTipo0;
     |C_M #caary001#Campo#, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #caary001#38 = "N";
         #caary001#26 = 0;   |PINTA #caary001#26;  |C_M #caary001#26, 1, "N";
         #caary001#27 = 99;  |PINTA #caary001#27;  |C_M #caary001#27, 1, "N";
         |PARA nCampo = 28;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               |C_M #caary001#nCampo#, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #caary001#26, 1, "S";
         |C_M #caary001#27, 1, "S";
         |PARA nCampo = 28;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               |C_M #caary001#nCampo#, 1, "N";
               #caary001#nCampo# = 0;  |PINTA #caary001#nCampo#;
         |SIGUE;
     |FINSI;
|FCAL;

|CALCULO SelTipo1;
     |SI #caary001#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               #caary001#Campo# = 0;  |C_M #caary001#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
               |C_M #caary001#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;

|PROCESO DesHas;
     |SI #caary001#4 < #caary001#3;
         |MENAV "      Error en Introduccion";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO SiModi; |TIPO 7;
     |PARA x = Campo + 1;  |SI x [ 24;  |HACIENDO x = x + 1;
           |C_M #caary001#x#,1,"S";
     |SIGUE;
|FPRC;

|PROCESO NoModi;
     |PARA x = Campo + 1;  |SI x [ 24;  |HACIENDO x = x + 1;
           |C_M #caary001#x#,1,"N"; #caary001#x# = 0; |PINTA #caary001#x#;
     |SIGUE;
|FPRC;

|PROCESO EsBuena; || desde campo de empresas seleccion
     |SI FSalida = 2; |ACABA; |FINSI;
     |SI #caary001#Campo# = 0; |HAZ NoModi;  |ACABA;  |FINSI;

     |ABRE #canempre;
     #canempre#2 = #caary001#Campo#;
     #canempre#3 = 0;
     |LEE 011#canempre.];
     |SI FSalida ! 0;  |O #canempre#2 ! #caary001#Campo#;
         |MENAV "     NO Existe la Empresa Contable";
         |ERROR;
     |FINSI;
     |CIERRA #canempre;
|FPRC;

|RUTINA inffinact2;
     #caarm001#0 = enEmpresa;
     #caarm001#1 = 00001;
|FRUT;

|RUTINA supfinact2;
     #caarm001#0 = enEmpresa;
     #caarm001#1 = 99999;
|FRUT;

|CALCULO laOpera; |TIPO 0;
   |SI FSalida = 10;
      |ABRE #caarm001;
      |CONSULTA_F_CLAVE #1#caarm001,inffinact2,supfinact2;
      #caary001#Campo# = #caarm001#1; |PINTA #caary001#Campo#;
      |CIERRA #caarm001;
      |ERROR;
   |FINSI;
|FCAL;

|CALCULO fechah; |TIPO 0;
   |C_M #caary001#Campo#,0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   nNume1 = Campo - 1;
   |SI #caary001#Campo# < #caary001#nNume1#;
       |MENAV "0000Error Fecha hasta inferior a fecha desde";
       |ERROR;
   |FINSI;
|FCAL;

|CALCULO ParaFinal;
   aAlfa1 = #caary001#Campo#;
   |C_M #caary001#55, 1, aAlfa1;
   |C_M #caary001#56, 1, aAlfa1;
   |SI aAlfa1 = "N";
       #caary001#55 = "01.01.2000"; |PINTA #caary001#55;
       #caary001#56 = "31.12.2099"; |PINTA #caary001#56;
   |FINSI;
|FCAL;

|CALCULO ParaInicio;
   aAlfa1 = #caary001#Campo#;
   |C_M #caary001#43, 1, aAlfa1;
   |C_M #caary001#44, 1, aAlfa1;
   |SI aAlfa1 = "N";
       #caary001#43 = "01.01.2000"; |PINTA #caary001#43;
       #caary001#44 = "31.12.2099"; |PINTA #caary001#44;
   |FINSI;
|FCAL;

|CALCULO ParaRecibo;
   aAlfa1 = #caary001#Campo#;
   |C_M #caary001#59, 1, aAlfa1;
   |C_M #caary001#60, 1, aAlfa1;
   |SI aAlfa1 = "N";
       #caary001#59 = "01.01.2000"; |PINTA #caary001#59;
       #caary001#60 = "31.12.2099"; |PINTA #caary001#60;
   |FINSI;
|FCAL;

|| **********************************************************************
|PROCESO LeoConcep;
   |DDEFECTO #dsmom030;
   #dsmom030#0 = nConcepto;
   |LEE 041#dsmom030.=;
|FPRC;

|PROCESO ContratosLineas;
   nSwL = 1;
   |PRINT;
   enSwLinea = 1;
   nHay = 1;
   |LIBERA #caarm002;
|FPRC;

|DEFBUCLE ContratosLineas;
   #caarm002#2;
   ;
   #caarm001#0, #caarm001#1, fDFecha, 001;
   #caarm001#0, #caarm001#1, fHFecha, 999;
   e;
   NULL, ContratosLineas;
|FIN;

|PROCESO ContratosCab;
   |SI #caary001#54 = "S";
       |SI #caary001#55 ! "01.01.0000"; |Y #caarm001#7 ! "01.01.0000";
           |SI #caarm001#7 < #caary001#55; |ACABA; |FINSI;
       |FINSI;
       |SI #caary001#56 ! "01.01.0000"; |Y #caarm001#7 ! "01.01.0000";
           |SI #caarm001#7 > #caary001#56; |ACABA; |FINSI;
       |FINSI;
       |SI #caarm001#7 = "01.01.0000";
           |SI #caary001#55 ! "01.01.0000"; |O #caary001#56 ! "01.01.0000";
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;

   |SI #caary001#57 = "S";
       |SI #caary001#43 ! "01.01.0000"; |Y #caarm001#5 ! "01.01.0000";
           |SI #caarm001#5 < #caary001#43; |ACABA; |FINSI;
       |FINSI;
       |SI #caary001#44 ! "01.01.0000"; |Y #caarm001#5 ! "01.01.0000";
           |SI #caarm001#5 > #caary001#44; |ACABA; |FINSI;
       |FINSI;
   |FINSI;

   |SI #caary001#49 = "D";
       enActividad = #caarm001#11;
       |HAZ LeeDatosActividad;
   |FINSI;
   |SI #caary001#49 = "R";
       |SI nSw = 0;
           nSw = 1;
           enActividad = #caarm001#11;
           |HAZ LeeDatosActividad;
       |FINSI;
       |SI enActividad ! #caarm001#11;
           |SI #caary001#53 = "S";
               |PIEINF;
           |FINSI;
           enActividad = #caarm001#11;
           |HAZ LeeDatosActividad;
       |FINSI;
   |FINSI;

   enSwLinea = 0;

   |SI #caary001#49 = "D";
       |BUCLE ContratosLineas;
       |SI enSwLinea ! 0;
           |PIEINF;
           nSw = 1;
           nHay = 1;
       |FINSI;
   |SINO;
       |PRINT;
       nSw = 1;
       nHay = 1;
   |FINSI;

   |LIBERA #caarm001;
|FPRC;

|DEFBUCLE ContratosCab;
   #caarm001#1;
   4, 8, 11, 12;
   nEmpresa, #caary001#39, aDCampo41, aDCampo42, #caary001#45, #caary001#47;
   nEmpresa, #caary001#40, aHCampo41, aHCampo42, #caary001#46, #caary001#48;
   e;
   NULL, ContratosCab;
|FIN;

|DEFBUCLE ContratosCabAc;
   #caarm001#4;
   8;
   nEmpresa, aDCampo41, #caary001#45, #caary001#47, #caary001#39, aDCampo42;
   nEmpresa, aHCampo41, #caary001#46, #caary001#48, #caary001#40, aHCampo42;
   e;
   NULL, ContratosCab;
|FIN;
|| ///////////////////////////////////////////////////////////

|PROCESO LaEmpresa;

    nSwTipo = 1;
    nPin1 = #agifigen#87;
    |SI #caary001#38 = "S";
        |SI nPin1 ] #caary001#26; |Y nPin1 [ #caary001#27;
            nSwTipo = 0;
        |FINSI;
    |SINO;
        |SI nPin1 = #caary001#28;
            nSwTipo = 0;
        |SINO;
            |PARA nCampo = 29;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
                  |SI nPin1 = #caary001#nCampo#; |Y nPin1 ! 0;
                      nSwTipo = 0;
                      |SAL;
                  |FINSI;
            |SIGUE;
        |FINSI;
    |FINSI;
    |SI nSwTipo = 1; |ACABA; |FINSI;

    aEstado = "A";
    |SI #agifigen#94 > "01.01.0000"; |Y #agifigen#94 [ #caary001#39;
        aEstado = "I";
    |FINSI;
    |SI aEstado ! #caary001#25; |Y #caary001#25 ! "T";
        |ACABA;
    |FINSI;

    aAgente    = "";
    aAgenteNom = "";
    |SI HayAcceso = 1;
        |DDEFECTO #dsam0000;
        #dsam0000#0 = #agifigen#0;
        |LEE 041#dsam0000.=;
        |SI #dsam0000#72 < #caary001#61; |O #dsam0000#72 > #caary001#62;
            |ACABA;
        |FINSI;
        aAgente    = "Agente: " + (("00" + #dsam0000#72) % -102);
        aAgenteNom = #dsam0000#52;
    |FINSI;
|| ===============================================================
    enEmpresa = #agifigen#0;
    eaIa = aEstado;
    enM1 = 01;
    enM2 = 12;
    eNoLeo = 1;
    |HAZ LeeDatosEmpresa;
    eNoLeo = 0;

    nSw = 0;
    nEmpresa = #agifigen#0;
    |SI #caary001#53 = "N";
        |BUCLE ContratosCab;
    |SINO;
        |BUCLE ContratosCabAc;
    |FINSI;
    |SI nSw = 1;
        |SI #caary001#49 = "R"; |PIEINF; |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     nDEmpresa;
     nHEmpresa;
     e;
     NULL, LaEmpresa;
|FIN;

|PROCESO Tipo3; |TIPO 3;

     aDCampo41 = " "; aHCampo41 = "X";
     |SI #caary001#41 ! "X";
         aDCampo41 = #caary001#41;
         aHCampo41 = #caary001#41;
     |FINSI;
     aDCampo42 = " "; aHCampo42 = "X";
     |SI #caary001#42 ! "X";
         aDCampo42 = #caary001#42;
         aHCampo42 = #caary001#42;
     |FINSI;
     fDFecha = "01.01.0000";
     fHFecha = "31.12.2999";
     |SI #caary001#58 = "S";
         fDFecha = #caary001#59;
         fHFecha = #caary001#60;
     |FINSI;

     |IMPRE 0;
     |SI FSalida ! 0;
         |MENAV "    Error en la Impresora";
          |ACABA;
     |FINSI;

     informe = inform1;
     |SI #caary001#49 = "D"; informe = inform2; |FINSI;
     |SI #caary001#49 = "L"; informe = inform3; |FINSI;
     |INFOR informe;
     |SI FSalida ! 0;
          |MENAV "     Error en el Informe";
          |FINIMP;
          |ACABA;
     |FINSI;

     nHay = 0;
     |SI HayAcceso = 1;
         |ABRE #dsam0000;
     |FINSI;
     |SI #caary001#2 = "S";
         nDEmpresa = #caary001#3;
         nHEmpresa = #caary001#4;
         |BUCLE agifigen;
     |SINO;
         |PARA nPara1 = 5; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
               |SI #caary001#nPara1# ! 0;
                   nDEmpresa = #caary001#nPara1#;
                   nHEmpresa = #caary001#nPara1#;
                   |BUCLE agifigen;
               |FINSI;
         |SIGUE;
     |FINSI;
     |SI HayAcceso = 1;
         |CIERRA #dsam0000;
     |FINSI;

     |SI nHay = 0;
         |MENAV "    Seleccion vacia";
     |SINO;
        |SI #caary001#49 = "L"; |PIEINF; |FINSI;
     |FINSI;

     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Agentes;
     |SI HayAcceso = 1;         || Existe Acceso;
         || ... Activado Acceso
         |MODO_RELACION #caary001, 0, "dsam0105", "X", "X";
         |MODO_RELACION #caary001, 1, "dsam0105", "N", "N";
     |SINO;
         || No existe Acceso
         || ... Desactivado  Acceso
         |MODO_RELACION #caary001, 1, "dsam0105", "N", "N";
         |MODO_RELACION #caary001, 1, "dsam0105", "X", "X";
         |C_V #caary001#61, 1, "N";
         |C_V #caary001#62, 1, "N";
         |PINTA 2202, "藩様様様様様様様様様様様様様夕";
         |PINTA 2302, "                              ";
     |FINSI;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;

     |SI aParam = "";
         |HAZ inicio;
         |HAZ DirAplicSt;
     |FINSI;

     CodigoEmpresa  = enEmpresa;
     PeriodoEmpresa = enPeriodo;

     fFecha   = ~;
     aAlfa1   = fFecha;
     aAlfa1   = aAlfa1 % -104;
     nEjer    = aAlfa1;
     aAlfa1   = "01.01." + nEjer; f1 = aAlfa1;
     aAlfa2   = "31.12." + nEjer; f2 = aAlfa2;

     |CLS;
     |ABRE #caary001;
     #caary001#0 = 0;
     |LEE 141#caary001.=;
     |SI FSalida ! 0;
         |DDEFECTO #caary001;
         #caary001#0 = 0;
         #caary001#1 = nEjer;
         |SI nEmpresa ! 0;
             #caary001#3 = nEmpresa;
             #caary001#4 = nEmpresa;
         |FINSI;
         #caary001#43 = f1;
         #caary001#44 = f2;
         |GRABA 020#caary001.b;
     |FINSI;

     |PINPA #0#caary001;
     |HAZ Agentes;

     |PINDA #0#caary001;
     |ENDATOS #1#caary001;
     |SI FSalida = 0;
         |GRABA 020#caary001.a;
     |FINSI;
     |LIBERA #caary001;
     |CIERRA #caary001;
|FPRO;
