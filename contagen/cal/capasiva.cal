|FICHEROS;
   capasiva #0;

   caivare@ #2;
   caivaso@ #3;
   caivarc@ #111;
   caivarf@ #112;
   caivasf@ #113;
   camacc1@ #121;
   camacc2@ #122;

   camaasic #4;
   camaasil #5;

   camaniva #6;
   caivalin #7;

   casiim01;
   casiim02;

   camacc01 #501;
   camacc02 #502;
   camacc03 #503;

   cacuivc@ #8;
   cacuivl@ #9;
   cacoivc@ #10;
   cacoivl@ #11;

   cacuiv2c #12;
   cacuiv2l #13;

   cacon30@ #14;

   :/modelos/def/dsmom030 #30;
   canempre #31;

   caotrof@ #103;

   caivaasi #200;

   cainliva #21;
   caintiva #22;
   aiivrec@ #221;
   aiivrel@ #222;
   aiivsoc@ #223;
   aiivsol@ #224;
   aivaasi@ #1200;
   casiim1@;
   casiim2@;


|FIN;

|VARIABLES;
   &enEmpresaV  = 0;
   &enPeriodoV  = 0;
   nUno         = 0;
   Documento    = 0;
   LibroAnt     = 0;
   Primero      = 0;
   retencion    = 0;
   Comodin      = "";
   Comodin1     = "";
   Comodin2     = "";
   Base         = 0;
   Calc         = 0;
   Ctrl         = "";
   LineasIva    = 0;
   LineasCtrp   = 0;
   LineasDto    = 0;
   CuentaIva    = "";
   CuentaRec    = "";
   CuentaIRPF   = "";
   CuentaCtrp   = "";
   CuentaDto    = "";
   nFicNueRC    = 0;
   nFicNueR     = 0;
   nFicNueS     = 0;
   nClinica     = 0;
   nSwExCli     = 0;
   aElCero      = "";
   &eaPreg22_7  = "";
   nConcepto    = 0;
   nEstado      = 0;
   aClave       = "";
   nPara1       = 0;
   nPara2       = 0;
   nPer         = 0;
   nPer1        = 0;
   nPer2        = 0;
   nPer3        = 0;
   fFec         = @;
   aAlfa1       = "";
   nParaBase    = 0;
   nCambioPara  = 0;
   nSwCaja      = 0;
   nLibroCaja   = 0;
   aSerieCaja   = "";
   nRegisCaja   = 0;

   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;

   aD60 = "";
   aH60 = "";
   &eaSiiPro = "";
   &enSiiLib = 0;
   &eaSiiDoc = "";
   &enImpExp = 0;
|FIN;

|INCLUYE dscont_i;

|PROCESO CambioPeriodo;
  |SI #caivaasi#46 = "M"; |ACABA; |FINSI;

  |SI nPer1 ! 0;
      |SI #caivaasi#46 = "A";
          nPer1 = 99;
      |SINO;
          |SI nPer1 = 4; nPer1 = 12; |FINSI;
          |SI nPer1 = 3; nPer1 = 9;  |FINSI;
          |SI nPer1 = 2; nPer1 = 6;  |FINSI;
          |SI nPer1 = 1; nPer1 = 3;  |FINSI;
     |FINSI;
  |FINSI;

  aAlfa1 = fFec;
  aAlfa1 = aAlfa1 % 402;
  nPer2 = aAlfa1;
  nPer3 = aAlfa1;

  |SI #caivaasi#46 = "T";
      |SI nPer2 = 1; |O nPer2 = 2; |O nPer2 = 3;
          |SI nPer ! 1;
              |SI nPer = 2; nPer3 = 4;  |FINSI;
              |SI nPer = 3; nPer3 = 7;  |FINSI;
              |SI nPer = 4; nPer3 = 10; |FINSI;
          |FINSI;
      |FINSI;
      |SI nPer2 = 4; |O nPer2 = 5; |O nPer2 = 6;
          |SI nPer ! 2;
              |SI nPer = 1; nPer3 = 3;  |FINSI;
              |SI nPer = 3; nPer3 = 7;  |FINSI;
              |SI nPer = 4; nPer3 = 10; |FINSI;
          |FINSI;
      |FINSI;
      |SI nPer2 = 7; |O nPer2 = 8; |O nPer2 = 9;
          |SI nPer ! 3;
              |SI nPer = 1; nPer3 = 3;  |FINSI;
              |SI nPer = 2; nPer3 = 6;  |FINSI;
              |SI nPer = 4; nPer3 = 10; |FINSI;
          |FINSI;
      |FINSI;
      |SI nPer2 = 10; |O nPer2 = 11; |O nPer2 = 12;
          |SI nPer ! 4;
              |SI nPer = 1; nPer3 = 3;  |FINSI;
              |SI nPer = 2; nPer3 = 6;  |FINSI;
              |SI nPer = 3; nPer3 = 9;  |FINSI;
          |FINSI;
      |FINSI;
  |FINSI;
  nPer = nPer3;
|FPRC;

|PROCESO BuscaCuentas;
   |SI #camaasil#16 = "            ";  |Y  #camaasil#10 = "            ";
    |Y  #camaasil#9  = 0;
       |BORRA 020#camaasil.a;
       |LIBERA #camaasil;
       |ACABA;
   |FINSI;

   |SI #camaasil#19 = "B";
      |SI #camaasil#20 = 0;
         #caivalin#12 = #camaasil#4;
      |SINO;
         |SI #camaasil#20 = Base; #caivalin#12 = #camaasil#4; |FINSI;
      |FINSI;
   |FINSI;
   |SI #camaasil#19 = "I";
      |SI #camaasil#20 = 0;
         #caivalin#13 = #camaasil#4;
      |SINO;
         |SI #camaasil#20 = Base; #caivalin#13 = #camaasil#4; |FINSI;
      |FINSI;
   |FINSI;
   |SI #camaasil#19 = "R";
      |SI #camaasil#20 = 0;
         #caivalin#14 = #camaasil#4;
      |SINO;
         |SI #camaasil#20 = Base; #caivalin#14 = #camaasil#4; |FINSI;
      |FINSI;
   |FINSI;
   |SI #camaasil#19 = " "; |O #camaasil#19 = "P"; |O #camaasil#19 = "p";
       |SI #camaasil#9 = #caivalin#22; |Y Base = 1; |Y retencion = 1;
           #caivalin#23 = #camaasil#4;
       |FINSI;
       |SI #camaasil#9 = #caivalin#22; |Y Base = 1; |Y nClinica = 1;
           #caivalin#23 = #camaasil#4;
           #caivalin#18 = #camaasil#6;
           #caivalin#19 = #camaasil#7;
       |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE BuscaCuentas;
#camaasil#5;
;
#camaniva#0,#camaniva#2,#camaniva#3;
#camaniva#0,#camaniva#2,#camaniva#3;
be;
NULL,BuscaCuentas;
|FIN;

|PROCESO LeeClinica;
 nSwExCli = 0;
 |ABRE #103;
 |DDEFECTO #103;
 #103#0 = #caivaso@#0;
 #103#1 = #caivaso@#27;
 #103#2 = #caivaso@#2;
 |LEE 040#103=;
 |SI FSalida = 0;
     nSwExCli = 1;
 |FINSI;
 |CIERRA #103;
|FPRC;

|PROCESO LeeFSopor;
 |ABRE #113;
 |DDEFECTO #113;
 #113#0 = #caivaso@#0;
 #113#1 = #caivaso@#27;
 #113#2 = #caivaso@#2;
 |LEE 040#113=;
 |CIERRA #113;
|FPRC;

|PROCESO LeeFReper;
 |SI nFicNueR = 1;
     |ABRE #112;
     |DDEFECTO #112;
     #112#0 = #caivare@#0;
     #112#1 = #caivare@#27;
     #112#2 = #caivare@#2;
     |LEE 040#112=;
     |CIERRA #112;
 |FINSI;

 |SI nFicNueRC = 1;
     |ABRE #111;
     |DDEFECTO #111;
     #111#0 = #caivare@#0;
     #111#1 = #caivare@#27;
     #111#2 = #caivare@#2;
     |LEE 040#111=;
     |CIERRA #111;
 |FINSI;
|FPRC;

|PROCESO MiraConcepto;
 aClave = "";
 #cacon30@#0 = nConcepto;
 |LEE 041#cacon30@.=;
 |SI FSalida = 0;
     |SI #camaniva#36 = "R";
         aClave = #cacon30@#5;
         #camaniva#42 = #cacon30@#5;
     |SINO;
         aClave = #cacon30@#6;
         #camaniva#42 = #cacon30@#6;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO PasaCajaZ;
   nSwCaja = 0;
   #camacc1@#17 = 0;
   #camacc1@#13 = aTipoIVA;
   #camacc1@#0  = nLibroCaja;
   #camacc1@#14 = aSerieCaja;
   #camacc1@#15 = nRegisCaja;
   |LEE 141#camacc1@.=;
   |SI FSalida = 0;
       nSwCaja = 1;
   |FINSI;
   |LIBERA #camacc1@;

   |SI nSwCaja = 1;
       #501#17 = 0;
       #501#0  = #camaniva#0;
       #501#1  = #camaniva#1;
       |LEE 141#501=;
       |SI FSalida ! 0;
           |DDEFECTO #501;
           #501#17 = 0;
           #501#0  = #camaniva#0;
           #501#1  = #camaniva#1;
           |GRABA 020#501b;
       |FINSI;
       #501#2 = #camaniva#7;
       #501#3 = #camaniva#8;
       #501#4 = #camaniva#9;
       #501#5 = #camacc1@#5;
       #501#6 = #camacc1@#6;
       #501#7 = #camacc1@#7;
       #501#8 = #camacc1@#8;
       #501#9 = #camacc1@#9;
       #501#10 = #camacc1@#10;
       #501#11 = #camacc1@#11;
       #501#12 = #camacc1@#12;
       #501#13 = #camacc1@#13;
       #501#14 = #camaniva#2;
       #501#15 = #camaniva#3;
       #501#16 = #camacc1@#16;
       #501#17 = #camacc1@#17;
       #501#18 = #camacc1@#18;
       |GRABA 020#501a;
       |LIBERA #501;
   |FINSI;

|FPRC;

|PROCESO LeoCamcc2;
   #502#17 = #501#17;
   #502#0  = #501#0;
   #502#1  = #501#1;
   #502#2  = #camacc2@#4; ||Linea de Cobro.
   |LEE 141#502=;
   |SI FSalida ! 0;
       |DDEFECTO #502;
       #502#17 = #501#17;
       #502#0  = #501#0;
       #502#1  = #501#1;
       #502#2  = #camacc2@#4;
       #502#16 = #camacc2@#31;
       #502#18 = #camacc2@#33;
       |GRABA 020#502b;
   |FINSI;
   #502#4  = #camacc2@#5;
   #502#7  = #camacc2@#7;
   #502#8  = #camacc2@#8;
   #502#9  = #camacc2@#9;
   #502#10 = #camacc2@#10;
   #502#11 = #camacc2@#11;
   #502#12 = #camacc2@#12;
   #502#13 = #camacc2@#13;
   #502#14 = #camacc2@#14;
   #502#15 = #camacc2@#15;
   |GRABA 020#502a;
   |LIBERA #502;

   Base = 0;
   |PARA nNume1 = 16; |SI nNume1 [ 30; |HACIENDO nNume1 = nNume1 + 3;
         Base = Base + 1;
         nNume2 = nNume1 + 1;
         nNume3 = nNume1 + 2;
         |SI #camacc2@#nNume1# ! 0; |O #camacc2@#nNume2# ! 0; |O #camacc2@#nNume3# ! 0;
             #503#7 = #502#17;
             #503#0 = #502#0;
             #503#1 = #502#1;
             #503#2 = #502#2;
             #503#3 = Base;
             |LEE 141#503=;
             |SI FSalida ! 0;
                 |DDEFECTO #503;
                 #503#7 = #502#17;
                 #503#0 = #502#0;
                 #503#1 = #502#1;
                 #503#2 = #502#2;
                 #503#3 = Base;
                 |GRABA 020#503b;
             |FINSI;
             #503#4 = #camacc2@#nNume1#;
             #503#5 = #camacc2@#nNume2#;
             #503#6 = #camacc2@#nNume3#;
             |GRABA 020#503a;
             |LIBERA #503;
         |FINSI;
   |SIGUE;
|FPRC;

|DEFBUCLE LeoCamacc2;
   #camacc2@#1006;
   ;
   aTipoIVA, 0000, nLibroCaja, aSerieCaja, nRegisCaja, 01;
   aTipoIVA, 0000, nLibroCaja, aSerieCaja, nRegisCaja, 99;
   e;
   NULL, LeoCamcc2;
|FIN;

|PROCESO PasaCajaZLinea;
   |ABRE #502;
   |ABRE #503;
   |BUCLE LeoCamacc2;
   |CIERRA #503;
   |CIERRA #502;
|FPRC;

|PROCESO TbCasiim02;
   #casiim02#0 = #casiim01#0;
   #casiim02#1 = #casiim01#1;
   #casiim02#2 = #casiim01#2;
   #casiim02#3 = #casiim2@#3;
   |LEE 141#casiim02.=;
   |SI FSalida ! 0;
       #casiim02#0 = #casiim01#0;
       #casiim02#1 = #casiim01#1;
       #casiim02#2 = #casiim01#2;
       #casiim02#3 = #casiim2@#3;
       |GRABA 020#casiim02.b;
   |FINSI;
   #casiim02#4 = #casiim2@#4;
   |GRABA 020#casiim02.a;
   |LIBERA #casiim02;
|FPRC;

|DEFBUCLE TbCasiim02;
   #casiim2@#1004;
   ;
   #casiim1@#0, #casiim1@#1, #casiim1@#2, aD60;
   #casiim1@#0, #casiim1@#1, #casiim1@#2, aH60;
   e;
   NULL, TbCasiim02;
|FIN;

|PROCESO Elcasiim01;
     #casiim1@#0 = eaSiiPro;
     #casiim1@#1 = enSiiLib;
     #casiim1@#2 = eaSiiDoc;
     |LEE 041#casiim1@.=;
     |SI FSalida = 0;
         |ABRE #casiim01;
         #casiim01#0 = "camaniva";
         #casiim01#1 = #camaniva#0;
         #casiim01#2 = #camaniva#1;
         |LEE 141#casiim01.=;
         |SI FSalida ! 0;
             |DDEFECTO #casiim01;
             #casiim01#0 = "camaniva";
             #casiim01#1 = #camaniva#0;
             #casiim01#2 = #camaniva#1;
             |GRABA 020#casiim01.b;
         |FINSI;

         |PARA nPara1 = 3; |SI nPara1 [ 72; |HACIENDO nPara1 = nPara1 + 1;
               #casiim01#nPara1# = #casiim1@#nPara1#;
         |SIGUE;
         #camaniva#22 = #casiim1@#66;

         |BUCLE TbCasiim02;

         |GRABA 020#casiim01.a;
         |LIBERA #casiim01;
         |CIERRA #casiim01;

         |GRABA 020#camaniva.a;
     |FINSI;
|FPRC;

|PROCESO PaseRegistro1Sop;

    |SI nClinica = 1;
        |HAZ LeeClinica;
    |FINSI;
    |SI nFicNueS = 1; |HAZ LeeFSopor; |FINSI;

    |SI LibroAnt ! #caivaso@#0;
       |SI Primero = 1;
          Documento = 1;
       |SINO;
          Primero = 1;
       |FINSI;
       LibroAnt = #caivaso@#0;
    |FINSI;

    |DDEFECTO #camaniva;
    #camaniva#0  = #caivaso@#0;                      || Libro
    #camaniva#1  = Documento;                        || N§ Registro
    #camaniva#2  = #caivaso@#27;                     || Serie
    #camaniva#3  = #caivaso@#2;                      || Factura/Registro
    #camaniva#4  = #caivaso@#3;                      || Fecha Registro
    #camaniva#5  = #caivaso@#44;                     || Periodo
    #camaniva#6  = #caivaso@#28;                     || Liquidada
    #camaniva#7  = #caivaso@#45;                     || Diario
    #camaniva#8  = #caivaso@#46;                     || Fecha contable
    #camaniva#9  = #caivaso@#47;                     || Documento contable
    #camaniva#10 = #caivaso@#49;                     || Departamento

    #camaniva#12 = #caivaso@#4;                      || Cuenta Cli/Pro
    #camaniva#13 = #caivaso@#50;                     || Nombre Cli/Pro
    #camaniva#14 = #caivaso@#51;                     || CIF Cli/Pro

    #camaniva#19 = #caivaso@#8 + #caivaso@#9 + #caivaso@#10 + #caivaso@#52 + #caivaso@#53;

    |SI retencion = 1;
        #camaniva#20 = #caivaso@#63;                  || Total IRPF
    |SINO;
       #camaniva#20 = 0;
    |FINSI;
    |SI nClinica = 1; |Y nSwExCli = 1;
        #camaniva#20 = #caotrof@#8;
    |FINSI;
    #camaniva#21 = #caivaso@#26;                     || Total Factura
    |SI retencion = 2;
        #camaniva#22 = #caivaso@#63;                 || N§ Factura Proveedor
    |SINO;
        #camaniva#22 = "";                           || N§ Factura Proveedor
    |FINSI;

    #camaniva#23 = #caivaso@#14 + #caivaso@#15 + #caivaso@#16 + #caivaso@#56 + #caivaso@#57;
    #camaniva#23 = #camaniva#23 + #caivaso@#20 + #caivaso@#21 + #caivaso@#22 + #caivaso@#60 + #caivaso@#61;

    #camaniva#24 = "";                               || Descripcion Departamento
    #camaniva#25 = "";                               || Descripcion SubDepartamento
    #camaniva#26 = 0;                                || Total Descuentos

    #camaniva#27 = #caivaso@#6;                      || Concepto Cli/Pro
    #camaniva#28 = #caivaso@#7;                      || Descripcion Cli/Pro
    #camaniva#29 = #caivaso@#6;                      || Concepto IVA
    #camaniva#30 = #caivaso@#7;                      || Descripcion IVA
    #camaniva#31 = "N";                              || Desglose IVA
    #camaniva#32 = "N";                              || Desglose Contrapartidas
    #camaniva#33 = "N";                              || Desglose IRPF
    #camaniva#34 = "N";                              || Desglose Descuento
    |SI #caivaso@#48 = "S";
        #camaniva#35 = "I";                           || Inversion S/N
    |SINO;
       #camaniva#35 = "N";                           || Inversion S/N
    |FINSI;
    #camaniva#36 = "S";                              || Soportado/Repercutido
    |SI #camaniva#6 = "S";
        #camaniva#40 = #camaniva#5;                     || Periodo
    |FINSI;
    |SI enEjercicio ] 2009;
        nConcepto = #camaniva#27;
        |HAZ MiraConcepto;
    |FINSI;
    |SI nFicNueS = 1;
        #camaniva#41 = #caivasf@#3;
    |FINSI;

    |SI enEjercicio > 2009;
        nPer  = #camaniva#5;
        nPer1 = #camaniva#40;
        fFec  = #camaniva#4;
        |HAZ CambioPeriodo;
        #camaniva#5  = nPer;
        #camaniva#40 = nPer1;
    |FINSI;

    |SI #camaniva#21 = 0; |Y aElCero = "N"; |ACABA; |FINSI;

    |GRABA 020#camaniva.n;
    |LEE 141#camaniva.=;

    nSwCaja = 0;
    |SI enEjercicio ] 2014;
        aTipoIVA    = "S";
        nLibroCaja = #caivaso@#0;
        nRegisCaja = #caivaso@#2;
        aSerieCaja = #caivaso@#27;
        |HAZ PasaCajaZ;
    |FINSI;

       nUno = 0;

       |PARA Base = 1; |SI Base [ 5; |HACIENDO Base = Base + 1;
          |DDEFECTO #caivalin;
          #caivalin#0 = #camaniva#0;                       || Libro
          #caivalin#1 = #camaniva#1;                       || N§ registro
          #caivalin#2 = Base;                              || Linea de base
          #caivalin#3 = #caivaso@#6;                       || Concepto linea
          #caivalin#4 = #caivaso@#7;                       || Descripcion linea
          #caivalin#5 = #caivaso@#23;                      || Deducible S/N

          |SI Base = 1;                                    || Base imponible
             #caivalin#6  = #caivaso@#8;
             #caivalin#7  = #caivaso@#11;
             #caivalin#8  = #caivaso@#14;
             #caivalin#9  = #caivaso@#17;
             #caivalin#10 = #caivaso@#20;
             |SI retencion = 1;
                #caivalin#18 = 1;
                |ABRE #dsmom030;
                #dsmom030#0 = #caivalin#18;
                |LEE 000#dsmom030.=;
                |SI FSalida = 0; #caivalin#19 = #dsmom030#1; |FINSI;
                |CIERRA #dsmom030;
                #caivalin#20 = #caivaso@#65;
                #caivalin#21 = #caivaso@#62;
                #caivalin#22 = #caivaso@#63;
             |SINO;
                #caivalin#18 = 0;
                #caivalin#19 = "";
                #caivalin#20 = 0;
                #caivalin#21 = 0;
                #caivalin#22 = 0;
                #caivalin#23 = "";
             |FINSI;
             |SI nClinica = 1; |Y nSwExCli = 1;
                #caivalin#18 = 1;
                |ABRE #dsmom030;
                #dsmom030#0 = #caivalin#18;
                |LEE 000#dsmom030.=;
                |SI FSalida = 0; #caivalin#19 = #dsmom030#1; |FINSI;
                |CIERRA #dsmom030;
                #caivalin#20 = #caotrof@#6;
                #caivalin#21 = #caotrof@#7;
                #caivalin#22 = #caotrof@#8;
             |FINSI;
          |FINSI;
          |SI Base = 2;
             #caivalin#6  = #caivaso@#9;
             #caivalin#7  = #caivaso@#12;
             #caivalin#8  = #caivaso@#15;
             #caivalin#9  = #caivaso@#18;
             #caivalin#10 = #caivaso@#21;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          |SI Base = 3;
             #caivalin#6  = #caivaso@#10;
             #caivalin#7  = #caivaso@#13;
             #caivalin#8  = #caivaso@#16;
             #caivalin#9  = #caivaso@#19;
             #caivalin#10 = #caivaso@#22;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          |SI Base = 4;
             #caivalin#6  = #caivaso@#52;
             #caivalin#7  = #caivaso@#54;
             #caivalin#8  = #caivaso@#56;
             #caivalin#9  = #caivaso@#58;
             #caivalin#10 = #caivaso@#60;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          |SI Base = 5;
             #caivalin#6  = #caivaso@#53;
             #caivalin#7  = #caivaso@#55;
             #caivalin#8  = #caivaso@#57;
             #caivalin#9  = #caivaso@#59;
             #caivalin#10 = #caivaso@#61;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          #caivalin#11 = 0;
          #caivalin#15 = "";
          #caivalin#17 = #caivaso@#48;

          |BUCLE BuscaCuentas;

          efFechaIVA = #camaniva#4; enLineaIVA = 0;
          enPorcIVA = #caivalin#7; enPorcREC = #caivalin#9;
          eaCtaIVA  = #caivalin#13; eaCtaREC = #caivalin#14;
          |HAZ BuscaTipoIVA;
          #caivalin#16 = enLineaIVA;

          |SI retencion = 2;
              |SI #caivalin#6 ! 0;
                  #caivalin#28 = #caivare@#64;  || Cuenta Analitica
              |FINSI;
          |FINSI;
          |SI #caivalin#6 ! 0; |O #caivalin#8 ! 0; |O #caivalin#11 ! 0;  |O #caivalin#20 ! 0;  |O #caivalin#22 ! 0;
              |GRABA 020#caivalin.n;
              nUno = 1;
          |SINO;
              |SI aElCero = "S"; |Y nUno = 0; |Y #camaniva#21 = 0;
                  |GRABA 020#caivalin.n;
                  nUno = 1;
              |FINSI;
          |FINSI;
       |SIGUE;
       |SI nSwCaja = 1; |Y nUno = 1; |HAZ PasaCajaZLinea; |FINSI;
       Documento = Documento + 1;

     eaSiiPro = "caivasop";
     enSiiLib = #caivaso@#0;
     eaSiiDoc = #caivaso@#27 + (("000000" + #caivaso@#2) % -106);
     |HAZ Elcasiim01;
     |LIBERA #camaniva;
|FPRC;

|PROCESO PaseRegistro1Rep;

    |SI nFicNueR = 1; |O nFicNueRC = 1; |HAZ LeeFReper; |FINSI;

    |SI LibroAnt ! #caivare@#0;
       |SI Primero = 1;
          Documento = 1;
       |SINO;
          Primero = 1;
       |FINSI;
       LibroAnt = #caivare@#0;
    |FINSI;

    |DDEFECTO #camaniva;
    #camaniva#0  = #caivare@#0;                      || Libro
    #camaniva#1  = Documento;                        || N§ Registro
    #camaniva#2  = #caivare@#27;                     || Serie
    #camaniva#3  = #caivare@#2;                      || Factura/Registro
    #camaniva#4  = #caivare@#3;                      || Fecha Registro
    #camaniva#5  = #caivare@#44;                     || Periodo
    #camaniva#6  = #caivare@#28;                     || Liquidada
    #camaniva#7  = #caivare@#45;                     || Diario
    #camaniva#8  = #caivare@#46;                     || Fecha contable
    #camaniva#9  = #caivare@#47;                     || Documento contable
    #camaniva#10 = #caivare@#49;                     || Departamento

    #camaniva#12 = #caivare@#4;                      || Cuenta Cli/Pro
    #camaniva#13 = #caivare@#50;                     || Nombre Cli/Pro
    #camaniva#14 = #caivare@#51;                     || CIF Cli/Pro

    #camaniva#19 = #caivare@#8 + #caivare@#9 + #caivare@#10 + #caivare@#52 + #caivare@#53;

    |SI retencion = 1;
       #camaniva#20 = #caivare@#63;                  || Total IRPF
    |SINO;
       #camaniva#20 = 0;
    |FINSI;
    #camaniva#21 = #caivare@#26;                     || Total Factura
    |SI retencion = 2;
        #camaniva#22 = #caivare@#63;                 || N§ Factura Proveedor
    |SINO;
        #camaniva#22 = "";                           || N§ Factura Proveedor
    |FINSI;
    #camaniva#23 = #caivare@#14 + #caivare@#15 + #caivare@#16 + #caivare@#56 + #caivare@#57;
    #camaniva#23 = #camaniva#23 + #caivare@#20 + #caivare@#21 + #caivare@#22 + #caivare@#60 + #caivare@#61;

    #camaniva#24 = "";                               || Descripcion Departamento
    #camaniva#25 = "";                               || Descripcion SubDepartamento
    #camaniva#26 = 0;                                || Total Descuentos

    #camaniva#27 = #caivare@#6;                      || Concepto Cli/Pro
    #camaniva#28 = #caivare@#7;                      || Descripcion Cli/Pro
    #camaniva#29 = #caivare@#6;                      || Concepto IVA
    #camaniva#30 = #caivare@#7;                      || Descripcion IVA
    #camaniva#31 = "N";                              || Desglose IVA
    #camaniva#32 = "N";                              || Desglose Contrapartidas
    #camaniva#33 = "N";                              || Desglose IRPF
    #camaniva#34 = "N";                              || Desglose Descuento
    |SI #caivare@#48 = "S";
       #camaniva#35 = "I";                           || Inversion S/N
    |SINO;
       #camaniva#35 = "N";                           || Inversion S/N
    |FINSI;
    #camaniva#36 = "R";                              || Soportado/Repercutido
    #camaniva#38 = #caivare@#62;
    |SI #camaniva#6 = "S";
        #camaniva#40 = #caivare@#44;                     || Periodo
    |FINSI;

    |SI enEjercicio ] 2009;
        nConcepto = #camaniva#27;
        |HAZ MiraConcepto;
    |FINSI;
    |SI nFicNueR = 1; #camaniva#41 = #caivarf@#3; |FINSI;
    |SI nFicNueRC= 1; #camaniva#45 = #caivarc@#3; |FINSI;

    |SI enEjercicio > 2009;
        nPer  = #camaniva#5;
        nPer1 = #camaniva#40;
        fFec  = #camaniva#4;
        |HAZ CambioPeriodo;
        #camaniva#5  = nPer;
        #camaniva#40 = nPer1;
    |FINSI;

    |SI #camaniva#21 = 0; |Y aElCero = "N"; |ACABA; |FINSI;

       |GRABA 020#camaniva.n;
       |LEE 141#camaniva.=;

    nSwCaja = 0;
    |SI enEjercicio ] 2014;
        aTipoIVA    = "R";
        nLibroCaja = #caivare@#0;
        nRegisCaja = #caivare@#2;
        aSerieCaja = #caivare@#27;
        |HAZ PasaCajaZ;
    |FINSI;

       nUno = 0;

       |PARA Base = 1; |SI Base [ 5; |HACIENDO Base = Base + 1;
          #caivalin#0 = #camaniva#0;                       || Libro
          #caivalin#1 = #camaniva#1;                       || N§ registro
          #caivalin#2 = Base;                              || Linea de base
          #caivalin#3 = #caivare@#6;                       || Concepto linea
          #caivalin#4 = #caivare@#7;                       || Descripcion linea
          #caivalin#5 = #caivare@#23;                      || Deducible S/N

          |SI Base = 1;                                    || Base imponible
             #caivalin#6  = #caivare@#8;
             #caivalin#7  = #caivare@#11;
             #caivalin#8  = #caivare@#14;
             #caivalin#9  = #caivare@#17;
             #caivalin#10 = #caivare@#20;
             |SI retencion = 1;
                #caivalin#18 = 1;
                |ABRE #dsmom030;
                #dsmom030#0 = #caivalin#8;
                |LEE 000#dsmom030.=;
                |SI FSalida = 0; #caivalin#19 = #dsmom030#1; |FINSI;
                |CIERRA #dsmom030;
                #caivalin#20 = #caivare@#65;
                #caivalin#21 = #caivare@#64;
                #caivalin#22 = #caivare@#63;
             |FINSI;
          |FINSI;
          |SI Base = 2;
             #caivalin#6  = #caivare@#9;
             #caivalin#7  = #caivare@#12;
             #caivalin#8  = #caivare@#15;
             #caivalin#9  = #caivare@#18;
             #caivalin#10 = #caivare@#21;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          |SI Base = 3;
             #caivalin#6  = #caivare@#10;
             #caivalin#7  = #caivare@#13;
             #caivalin#8  = #caivare@#16;
             #caivalin#9  = #caivare@#19;
             #caivalin#10 = #caivare@#22;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          |SI Base = 4;
             #caivalin#6  = #caivare@#52;
             #caivalin#7  = #caivare@#54;
             #caivalin#8  = #caivare@#56;
             #caivalin#9  = #caivare@#58;
             #caivalin#10 = #caivare@#60;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          |SI Base = 5;
             #caivalin#6  = #caivare@#53;
             #caivalin#7  = #caivare@#55;
             #caivalin#8  = #caivare@#57;
             #caivalin#9  = #caivare@#59;
             #caivalin#10 = #caivare@#61;
             #caivalin#18 = 0;
             #caivalin#19 = "";
             #caivalin#20 = 0;
             #caivalin#21 = 0;
             #caivalin#22 = 0;
             #caivalin#23 = "";
          |FINSI;
          #caivalin#11 = 0;
          #caivalin#15 = "";
          #caivalin#17 = #caivare@#48;

          |BUCLE BuscaCuentas;
          efFechaIVA = #camaniva#4; enLineaIVA = 0;
          enPorcIVA = #caivalin#7; enPorcREC = #caivalin#9;
          eaCtaIVA  = #caivalin#13; eaCtaREC = #caivalin#14;
          |HAZ BuscaTipoIVA;
          #caivalin#16 = enLineaIVA;

          |SI retencion = 2;
              |SI #caivalin#6 ! 0;
                  #caivalin#28 = #caivare@#64;  || Cuenta Analitica
              |FINSI;
          |FINSI;

          |SI #caivalin#6 ! 0; |O #caivalin#8 ! 0; |O #caivalin#11 ! 0;  |O #caivalin#20 ! 0;  |O #caivalin#22 ! 0;
              |GRABA 020#caivalin.n;
              nUno = 1;
          |SINO;
              |SI aElCero = "S"; |Y nUno = 0; |Y #camaniva#21 = 0;
                  |GRABA 020#caivalin.n;
                  nUno = 1;
              |FINSI;
          |FINSI;
       |SIGUE;
       |SI nSwCaja = 1; |Y nUno = 1; |HAZ PasaCajaZLinea; |FINSI;

       Documento = Documento + 1;

     eaSiiPro = "caivarep";
     enSiiLib = #caivare@#0;
     eaSiiDoc = #caivare@#27 + (("000000" + #caivare@#2) % -106);
     |HAZ Elcasiim01;
     |LIBERA #camaniva;
|FPRC;

|DEFBUCLE PaseReperc1;
    #caivare@#1003;
    ;
    00,000001,"  ";
    99,999999,"zz";
    ;
    NULL,PaseRegistro1Rep;
|FIN;

|DEFBUCLE PaseSoport1;
    #caivaso@#1003;
    ;
    00,000001,"  ";
    99,999999,"zz";
    ;
    NULL,PaseRegistro1Sop;
|FIN;

|DEFBUCLE PaseReperc2;
    #caivare@#1003;
    ;
    00,"  ",000001;
    99,"zz",999999;
    ;
    NULL,PaseRegistro1Rep;
|FIN;

|DEFBUCLE PaseSoport2;
    #caivaso@#1003;
    ;
    00,"  ",000001;
    99,"zz",999999;
    ;
    NULL,PaseRegistro1Sop;
|FIN;

|DEFBUCLE PaseSoport3;
    #caivaso@#1002;
    ;
    00,000001;
    99,999999;
    ;
    NULL,PaseRegistro1Sop;
|FIN;

|PROCESO LineasIva;
    #cacoivl@#0 = #cacuivl@#0;
    #cacoivl@#1 = #cacuivl@#1;
    |LEE 000#cacoivl@.=;

    |DDEFECTO #cacuiv2l;

    #cacuiv2l#12 = enEjercicio;
    #cacuiv2l#13 = "01.01.2000";
    #cacuiv2l#0  = #cacuivl@#0;
    #cacuiv2l#1  = #cacuivl@#1;
    |LEE 101#cacuiv2l.=;
    |SI FSalida ! 0;
       |DDEFECTO #cacuiv2l;
       #cacuiv2l#12 = enEjercicio;
       #cacuiv2l#13 = "01.01.2000";
       #cacuiv2l#0  = #cacuivl@#0;
       #cacuiv2l#1  = #cacuivl@#1;
        #cacuiv2l#2  = #cacuivl@#2;
        |SI #cacuiv2c#2  = "S"; #cacuiv2l#3  = #cacuivl@#3; |FINSI;
        #cacuiv2l#4  = #cacuivl@#5;
        |SI #cacuiv2c#2  = "S"; #cacuiv2l#5  = #cacuivl@#6; |FINSI;
        #cacuiv2l#5  = #cacuivl@#6;
       |SI #cacuiv2c#4  = "S"; #cacuiv2l#6  = #cacoivl@#2; |FINSI;
       |SI #cacuiv2c#17 = "S"; #cacuiv2l#7  = #cacoivl@#11; |FINSI;
       #cacuiv2l#8  = #cacuivl@#8;
       |SI retencion ! 2;
           #cacuiv2l#9  = #cacuivl@#9;
           #cacuiv2l#10 = #cacuivl@#10;
       |FINSI;
       |GRABA 020#cacuiv2l.n;
    |FINSI;
    |LIBERA #cacuiv2l;
|FPRC;

|DEFBUCLE LineasIva;
    #cacuivl@#1002;
    ;
    #cacuivc@#0,01;
    #cacuivc@#0,99;
    ;
    NULL,LineasIva;
|FIN;

|PROCESO ControlCuentas;
   |DDEFECTO #cacuiv2c; |DDEFECTO #cacuiv2l;

   #cacuivc@#0 = Ctrl;
   |LEE 101#cacuivc@.=;
   |SI FSalida = 0;

      #cacuivl@#0 = #cacuivc@#0;
      #cacuivl@#1 = 1;
      |LEE 000#cacuivl@.=;
      |PARA; |SI FSalida = 0; |Y #cacuivl@#0 = #cacuivc@#0; |HACIENDO;
         LineasIva = #cacuivl@#1;
         CuentaIva = #cacuivl@#3; CuentaRec = #cacuivl@#6;
         || CuentaIRPF = #cacuivl@#12;
         CuentaIRPF = "";
         |LEE 000#cacuivl@.s;
      |SIGUE;

      #cacoivl@#0 = #cacuivc@#0;
      #cacoivl@#1 = 1;
      |LEE 000#cacoivl@.=;
      |PARA; |SI FSalida = 0; |Y #cacoivl@#0 = #cacuivc@#0; |HACIENDO;
         Comodin = #cacoivl@#2; |QBF Comodin;
         |SI Comodin ! "";
            CuentaCtrp = #cacoivl@#2;
            LineasCtrp = #cacoivl@#1;
         |FINSI;
         Comodin = #cacoivl@#11; |QBF Comodin;
         |SI Comodin ! "";
            CuentaDto  = #cacoivl@#11;
            LineasDto = #cacoivl@#1;
         |FINSI;
         |LEE 000#cacuivl@.s;
      |SIGUE;

      #cacoivc@#0 = #cacuivc@#0; |LEE 101#cacoivc@.=;

      #cacuiv2c#20 = enEjercicio;
      #cacuiv2c#21 = "01.01.2000";
      #cacuiv2c#0 = #cacuivc@#0;
      |LEE 101#cacuiv2c.=;
      |SI FSalida ! 0;
         |DDEFECTO #cacuiv2c;
         #cacuiv2c#20 = enEjercicio;
         #cacuiv2c#21 = "01.01.2000";
         #cacuiv2c#0 = #cacuivc@#0;
          #cacuiv2c#1 = #cacuivc@#1;
          |SI LineasIva > 1;
             #cacuiv2c#2 = "S"; #cacuiv2c#6 = ""; #cacuiv2c#7 = "";
          |SINO;
             |SI LineasIva = 1;
                #cacuiv2c#2 = "N";
                #cacuiv2c#6 = CuentaIva;
                #cacuiv2c#7 = CuentaRec;
                #cacuiv2c#3 = CuentaIRPF;
             |FINSI;
          |FINSI;

          |SI LineasCtrp > 1;
             #cacuiv2c#4 = "S"; #cacuiv2c#5 = "";
          |SINO;
             |SI LineasCtrp = 1;
                #cacuiv2c#4 = "N";
                #cacuiv2c#5 = CuentaCtrp;
             |FINSI;
          |FINSI;

          |SI LineasDto > 1;
             #cacuiv2c#17 = "S"; #cacuiv2c#18 = "";
          |SINO;
             |SI LineasDto = 1;
                #cacuiv2c#17 = "N";
                #cacuiv2c#18 = CuentaDto;
             |FINSI;
          |FINSI;
          |GRABA 020#cacuiv2c.n;
      |FINSI;
      |LIBERA #cacuiv2c;

      |BUCLE LineasIva;
   |FINSI;
|FPRC;

|PROCESO LasLineas;
  |SI #camaasil#19 = "F";
      nParaBase = 1;
  |FINSI;
  |SI #camaasil#19 = " ";
      |SI nParaBase = 0;
          |SI #camaasil#8 = "D"; |Y #camaasic#13 = 1;
              nParaBase = 1;
              #camaasil#19 = "F";
          |FINSI;
          |SI #camaasil#8 = "H"; |Y #camaasic#13 = 2;
              nParaBase = 1;
              #camaasil#19 = "F";
          |FINSI;
      |SINO;
          #camaasil#19 = "X";
          #camaasil#20 = 0;
          nCambioPara  = 1;
      |FINSI;
      |GRABA 020#camaasil.a;
  |FINSI;
  |LIBERA #camaasil;
|FPRC;

|DEFBUCLE LasLineas;
  #camaasil#1;
  ;
  #camaasic#0, #camaasic#1, #camaasic#2, 0001;
  #camaasic#0, #camaasic#1, #camaasic#2, 9999;
  be;
  NULL, LasLineas;
|FIN;

|PROCESO TipoAsientos;
 #camaasic#0 = #camaniva#7;
 #camaasic#1 = #camaniva#8;
 #camaasic#2 = #camaniva#9;
 |LEE 101#camaasic.=;
 |SI FSalida = 0;
    |SI #camaniva#36 = "R"; #camaasic#13 = 1; |FINSI;
    |SI #camaniva#36 = "S"; #camaasic#13 = 2; |FINSI;
    |GRABA 020#camaasic.a;
    nParaBase = 0;
    |BUCLE LasLineas;
 |FINSI;
 |LIBERA #camaasic;
|FPRC;

|DEFBUCLE TipoAsientos;
 #camaniva#1;
 ;
 00, 0000000000;
 99, 9999999999;
 e;
 NULL, TipoAsientos;
|FIN;

|PROCESO TemporalRep;
  |DDEFECTO #21;

  #21#0 = #222#0;
  #21#1 = #222#1;
  |LEE 041#21=;
  nEstado = FSalida;

  |PARA nPara1 = 0; |SI nPara1 [ 31; |HACIENDO nPara1 = nPara1 + 1;
      #21nPara1  = #222nPara1;
  |SIGUE;

  |SI Calc = 33;
      #21#53 = #222#32;   || Referencia
  |FINSI;

  |SI Calc > 33;
      #21#32  = #222#32;   || Inversion
      #21#33  = #222#33;   || Intracomunitario
      #21#68  = #222#35;   || Iden.
      #21#61  = #222#36;   || Fecha Operacion
      #21#54  = #222#33;   || Intracomunitario
  |FINSI;

  #21#38 = "R";
  #21#50 = "R";
  |SI enEjercicio ] 2009;
      nConcepto = #21#7;
      |HAZ MiraConcepto;
      #21#62 = aClave;
  |FINSI;
  #21#65 = #21#5;
  #21#66 = #21#17;
  #21#67 = #21#29;

  aTipoIVA = #cainliva#38;
  efFechaIVA = #cainliva#4; enLineaIVA = 0;
  enPorcIVA = #cainliva#13; enPorcREC = #cainliva#15;
  eaCtaIVA  = #cainliva#20; eaCtaREC = #cainliva#22;
  |HAZ BuscaTipoIVA;
  #cainliva#10 = enLineaIVA;

  |SI enEjercicio > 2009;
      nPer  = #21#31;
      nPer1 = 0;
      fFec  = #21#4;
      |HAZ CambioPeriodo;
      #21#21  = nPer;
 |FINSI;

  |SI nEstado = 0; |GRABA 020#21a; |FINSI;
  |SI nEstado ! 0; |GRABA 020#21n; |FINSI;
  |LIBERA #21;

  #22#0 = #21#0;
  |LEE 001#22=;
  |SI FSalida ! 0;
      #221#0= #222#0;
      |LEE 001#221=;
      #22#0 = #21#0;
      #22#1 = #221#1;
      |GRABA 020#22n;
  |FINSI;
|FPRC;

|DEFBUCLE TemporalRep;
 #222#1002;
 ;
 00, 001;
 99, 999;
 e;
 NULL, TemporalRep;
|FIN;

|PROCESO TemporalSop;
  |DDEFECTO #21;

  #21#0 = #224#0;
  #21#1 = #224#1;
  |LEE 041#21=;
  nEstado = FSalida;

  |PARA nPara1 = 0; |SI nPara1 [ 25; |HACIENDO nPara1 = nPara1 + 1;
      #21nPara1  = #224nPara1;
  |SIGUE;
  #21#26 = #224#30;  || Serie
  #21#27 = #224#26;
  #21#28 = #224#27;
  #21#29 = #224#28;
  #21#30 = #224#29;
  #21#31 = #224#31;

  |SI Calc = 33;
      #21#53 = #224#32;   || Referencia
  |FINSI;

  |SI Calc > 33;
      #21#32  = #224#32;   || Inversion
      #21#33  = #224#33;   || Intracomunitario
      #21#68  = #224#35;   || Iden.
      #21#61  = #224#36;   || Fecha Operacion
      #21#54  = #224#33;   || Intracomunitario
  |FINSI;

  #21#38 = "S";
  #21#50 = "S";
  |SI enEjercicio ] 2009;
      nConcepto = #21#7;
      |HAZ MiraConcepto;
      #21#62 = aClave;
  |FINSI;
  #21#65 = #21#5;
  #21#66 = #21#17;
  #21#67 = #21#29;

  |SI enEjercicio > 2009;
      nPer  = #21#31;
      nPer1 = 0;
      fFec  = #21#4;
      |HAZ CambioPeriodo;
      #21#21  = nPer;
 |FINSI;

  aTipoIVA = #cainliva#38;
  efFechaIVA = #cainliva#4; enLineaIVA = 0;
  enPorcIVA = #cainliva#13; enPorcREC = #cainliva#15;
  eaCtaIVA  = #cainliva#20; eaCtaREC = #cainliva#22;
  |HAZ BuscaTipoIVA;
  #cainliva#10 = enLineaIVA;

  |SI nEstado = 0; |GRABA 020#21a; |FINSI;
  |SI nEstado ! 0; |GRABA 020#21n; |FINSI;
  |LIBERA #21;

  #22#0 = #21#0;
  |LEE 001#22=;
  |SI FSalida ! 0;
      #223#0= #222#0;
      |LEE 001#223=;
      #22#0 = #21#0;
      #22#1 = #223#1;
      |GRABA 020#22n;
  |FINSI;
|FPRC;

|DEFBUCLE TemporalSop;
 #224#1002;
 ;
 00, 001;
 99, 999;
 e;
 NULL, TemporalSop;
|FIN;

|PROCESO LosTemporales;  ||Nuevo proceso para pasar temporal IVA

         |ABRE #21;
         |ABRE #22;

         Comodin = "|NC";
         Calc = #aiivrel@#Comodin#;
         |ABRE #221;
         |BUCLE TemporalRep;
         |CIERRA #221;

         Comodin = "|NC";
         Calc = #aiivsol@#Comodin#;
         |ABRE #223;
         |BUCLE TemporalSop;
         |CIERRA #223;
|FPRC;

|PROGRAMA;

     |HAZ Monedas;
     Comodin = PARAMETRO; |QBF Comodin;
     |SI Comodin ! "";
         Comodin1 = Comodin % -101;
         |SI Comodin1 ! "/";
             Comodin = Comodin + "/agicont/";
         |SINO;
             Comodin = Comodin + "agicont/";
         |FINSI;
         #capasiva#1 = enEmpresa;
         #capasiva#2 = enPeriodo;

         |DBASE Comodin2; |QBF Comodin2;
         Comodin1 = (("00000" + #capasiva#1) % -105) + #capasiva#2;
         Comodin1 = Comodin2 + "fich/" + Comodin1 + "/";
         |PATH_DAT #4  Comodin1;
         |PATH_DAT #5  Comodin1;
         |PATH_DAT #6  Comodin1;
         |PATH_DAT #7  Comodin1;
         |PATH_DAT #21  Comodin1;
         |PATH_DAT #22  Comodin1;
         |PATH_DAT #501 Comodin1;
         |PATH_DAT #502 Comodin1;
         |PATH_DAT #200 Comodin1;
         |PATH_DAT #casiim01#Comodin1#;
         |PATH_DAT #casiim02#Comodin1#;
     |SINO;
         |CLS;
         |DBASS Comodin; |QBF Comodin;
         Comodin = Comodin + "agicont/";
         #capasiva#0 = Comodin;
         #capasiva#1 = #48#2;
         #capasiva#2 = #48#3;

         |PINPA #0#0; |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida ! 0; |ACABA; |FINSI;

         Comodin = #capasiva#0; |QBF Comodin;
         Comodin1 = Comodin % -101;
         |SI Comodin1 ! "/";
             Comodin = Comodin + "/";
         |FINSI;
     |FINSI;

     enImpExp = 1;
     |ABRE #canempre;
     #canempre#2 = #capasiva#1;
     #canempre#3 = #capasiva#2;
     |LEE 001#canempre.=;
     |SI FSalida ! 0;
         |DDEFECTO #canempre;
     |FINSI;
     |CIERRA #canempre;
     |SI enEmpresaV = 0;
         enEmpresaV = #capasiva#1;
         enPeriodoV = #capasiva#2;
     |FINSI;

     |SI #canempre#26 < 80;
         enEjercicio = 2000 + #canempre#26;
     |SINO;
         enEjercicio = 1900 + #canempre#26;
     |FINSI;

     Comodin1 = Comodin + "def/caivarep.mas";
     |CARGA_DEF Comodin1, caivare@;
     |SI FSalida = 0;
         Comodin1 = Comodin + "def/caivasop.mas";
         |CARGA_DEF Comodin1, caivaso@;

         Comodin1 = Comodin + "def/camacc01.mas";
         |CARGA_DEF Comodin1, camacc1@;
         Comodin1 = Comodin + "def/camacc02.mas";
         |CARGA_DEF Comodin1, camacc2@;

         Comodin1 = Comodin + "def/casiim01.mas";
         |CARGA_DEF Comodin1, casiim1@;
         Comodin1 = Comodin + "def/casiim02.mas";
         |CARGA_DEF Comodin1, casiim2@;

         Comodin1 = Comodin + "def/cacuivca.mas";
         |CARGA_DEF Comodin1, cacuivc@;
         Comodin1 = Comodin + "def/cacuivli.mas";
         |CARGA_DEF Comodin1, cacuivl@;
         Comodin1 = Comodin + "def/cacoivca.mas";
         |CARGA_DEF Comodin1, cacoivc@;
         Comodin1 = Comodin + "def/cacoivli.mas";
         |CARGA_DEF Comodin1, cacoivl@;
         Comodin1 = Comodin + "def/cacon300.mas";
         |CARGA_DEF Comodin1, cacon30@;

         Comodin1 = Comodin + "def/caiivrec.mas";
         |CARGA_DEF Comodin1, aiivrec@;
         Comodin1 = Comodin + "def/caiivrel.mas";
         |CARGA_DEF Comodin1, aiivrel@;
         Comodin1 = Comodin + "def/caiivsoc.mas";
         |CARGA_DEF Comodin1, aiivsoc@;
         Comodin1 = Comodin + "def/caiivsol.mas";
         |CARGA_DEF Comodin1, aiivsol@;
         Comodin1 = Comodin + "def/caivaasi.mas";
         |CARGA_DEF Comodin1, aivaasi@;

         nClinica = 0;
         Comodin1 = Comodin + "def/clinic07.mas";
         |CARGA_DEF Comodin1, caotrof@;
         |SI FSalida = 0;
             nClinica = 1;
         |FINSI;

         nFicNueRC = 0;
         Comodin1 = Comodin + "def/caivarec.mas";
         |CARGA_DEF Comodin1, caivarc@;
         |SI FSalida = 0; nFicNueRC = 1; |FINSI;
         nFicNueR = 0;
         Comodin1 = Comodin + "def/caivaref.mas";
         |CARGA_DEF Comodin1, caivarf@;
         |SI FSalida = 0; nFicNueR = 1; |FINSI;

         nFicNueS = 0;
         Comodin1 = Comodin + "def/caivasof.mas";
         |CARGA_DEF Comodin1, caivasf@;
         |SI FSalida = 0; nFicNueS = 1; |FINSI;

         Comodin1 = (("00000" + enEmpresaV) % -105) + enPeriodoV;
         Comodin1 = Comodin + "fich/" + Comodin1 + "/";
         |PATH_DAT #2 Comodin1;
         |PATH_DAT #3 Comodin1;
         |PATH_DAT #121 Comodin1;
         |PATH_DAT #122 Comodin1;

         |PATH_DAT #8 Comodin1;
         |PATH_DAT #9 Comodin1;
         |PATH_DAT #10 Comodin1;
         |PATH_DAT #11 Comodin1;
         |PATH_DAT #14 Comodin1;
         |PATH_DAT #221 Comodin1;
         |PATH_DAT #222 Comodin1;
         |PATH_DAT #223 Comodin1;
         |PATH_DAT #224 Comodin1;
         |PATH_DAT #1200 Comodin1;
         |PATH_DAT #casiim1@#Comodin1#;
         |PATH_DAT #casiim2@#Comodin1#;

         |SI nClinica = 1; |PATH_DAT #103 Comodin1; |FINSI;
         |SI nFicNueRC= 1; |PATH_DAT #111 Comodin1; |FINSI;
         |SI nFicNueR = 1; |PATH_DAT #112 Comodin1; |FINSI;
         |SI nFicNueS = 1; |PATH_DAT #113 Comodin1; |FINSI;

         |MENSA "    Reconstruyendo IVAS";
         |DELINDEX #casiim01;
         |DELINDEX #casiim02;
         |DELINDEX #camaniva;
         |DELINDEX #caivalin;
         |DELINDEX #camacc01;
         |DELINDEX #camacc02;
         |DELINDEX #camacc03;

         |SI eaPreg22_7 = ""; eaPreg22_7 = "N"; |FINSI;

         |ABRE #200;
         |DDEFECTO #200;
         |LEE 101#200p;
         |SI FSalida ! 0;
             |GRABA 020#200b;
         |FINSI;
         #200#115 = eaPreg22_7;

         |ABRE #1200;
         |DDEFECTO #1200;
         |LEE 041#1200=;
         |SI FSalida = 0;
             #200#46  = #1200#46;
             #200#149 = #1200#46;
         |FINSI;
         |CIERRA #1200;

         |GRABA 020#200a;
         |LIBERA #200;
         |CIERRA #200;
         aElCero = #200#115;

         aD60 = " " * 60;
         aH60 = "z" * 60;

         |ABRE #camacc01;
         |ABRE #camaniva; |ABRE #caivalin;
         |ABRE #camaasil;
         |ABRE #casiim02;
         |ABRE #casiim1@;
         |ABRE #cacuivc@; |ABRE #cacuivl@;
         |ABRE #cacoivc@; |ABRE #cacoivl@;
         |ABRE #cacuiv2c; |ABRE #cacuiv2l;
         |ABRE #caivare@; |ABRE #caivaso@;
         |ABRE #cacon30@; |ABRE #camacc1@;
         Documento = 1;
         Comodin = "|NC";
         Calc = #caivare@#Comodin#;

         |SI Calc = 66;
             retencion = 1;
             |BUCLE PaseReperc1;
             |BUCLE PaseSoport1;
         |FINSI;

         |SI Calc = 63;
             retencion = 0;
             |BUCLE PaseReperc2;
             |BUCLE PaseSoport2;
         |FINSI;

         |SI Calc = 65;
             retencion = 2;
             |BUCLE PaseReperc1;
             |BUCLE PaseSoport3;
         |FINSI;

         Ctrl = "R"; |HAZ ControlCuentas;
         Ctrl = "S"; |HAZ ControlCuentas;

         |CIERRA #cacuiv2l; |CIERRA #cacuiv2c;
         |CIERRA #camaasil; |CIERRA #caivalin;
         |CIERRA #camaniva; |CIERRA #camacc01;
         |CIERRA #casiim02; |CIERRA #casiim1@;

         |HAZ LosTemporales;

         |ABRE #camaasic;
         |BUCLE TipoAsientos;
         |CIERRA #camaasic;

         |SI nCambioPara = 1;
             |ABRE #200;
             |DDEFECTO #200;
             |LEE 041#200p;
             |SI FSalida ! 0;
                 |GRABA 020#200b;
             |FINSI;
             #200#92 = "S";
             |GRABA 020#200a;
             |CIERRA #200;
         |FINSI;

         |SI nFicNueS = 1; |DESCARGA_DEF #caivasf@; |FINSI;
         |SI nFicNueR = 1; |DESCARGA_DEF #caivarf@; |FINSI;
         |SI nFicNueRC= 1; |DESCARGA_DEF #caivarc@; |FINSI;
         |SI nClinica = 1; |DESCARGA_DEF #caotrof@; |FINSI;


         |DESCARGA_DEF #aivaasi@;
         |DESCARGA_DEF #aiivsol@;
         |DESCARGA_DEF #aiivsoc@;
         |DESCARGA_DEF #aiivrel@;
         |DESCARGA_DEF #aiivrec@;
         |DESCARGA_DEF #camacc2@;

         |CIERRA #camacc1@; |DESCARGA_DEF #camacc1@;
         |CIERRA #cacon30@; |DESCARGA_DEF #cacon30@;
         |CIERRA #cacoivl@; |DESCARGA_DEF #cacoivl@;
         |CIERRA #cacoivc@; |DESCARGA_DEF #cacoivc@;
         |CIERRA #cacuivl@; |DESCARGA_DEF #cacuivl@;
         |CIERRA #cacuivc@; |DESCARGA_DEF #cacuivc@;
         |CIERRA #caivaso@; |DESCARGA_DEF #caivaso@;
         |CIERRA #caivare@; |DESCARGA_DEF #caivare@;

     |FINSI;
     enImpExp = 0;
|FPRO;
