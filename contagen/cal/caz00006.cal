|FICHEROS;
   caz00006 #0;
   caexistc #1;
   caexistl #2;

   canempre #30;
|FIN;

|VARIABLES;
  aParam     = "";
  &aElDepar  = "";
  &efFechaAA = @;
  &efFechaBA = @;
  &enDeAct   = 0;
  &enOpAct   = 0;

  aCampo2 = "";
  nCampo3 = 0;
  nPara1  = 0;
  swSi    = 0;
  swNo    = 0;
  aAlfa1  = "";
  aAlfa2  = "";
  aAlfa3  = "";
  nNume1  = 0;
  nNume2  = 0;

  nEjercicio = 0;
  nMes       = 0;
  aLaFecha1  = "";
  aLaFecha2  = "";
  fFechaI    = @;
  fFechaF    = @;
|FIN;

|INCLUYE dscont_i;

|PROCESO LeeEstructura;
   swNo = 0;
   |ABRE #1;
   #1#0 = #0#0;
   |LEE 040#1=;
   |SI FSalida ! 0;
      swNo = 1;
   |SINO;
      #0#1    = #1#1;
      aCampo2 = #1#2;
      nCampo3 = #1#3;
   |FINSI;
   |CIERRA #1;
|FPRC;

|PROCESO lineapla;
   #2#0 = nPara1;
   |PDEFECTO #2, 11, 25;
   |GRABA 040#2n;
   |LIBERA #2;
|FPRC;

|PROCESO LosBorro1;
 |BORRA 020#2a;
 |LIBERA #2;
|FPRC;

|DEFBUCLE LosBorro;
 #2#1;
 ;
 nPara1, 01;
 nPara1, 99;
 e;
 NULL, LosBorro1;
|FIN;

|PROCESO locreo;
   #1#0 = nPara1;
   |LEE 101#1=;
   |SI FSalida ! 0;
       #1#0 = nPara1;
       #1#1 = eaNombreAct;
       #1#2 = aCampo2;
       #1#3 = nCampo3;
       |GRABA 040#1b;
   |SINO;
       #1#1 = eaNombreAct;
       |GRABA 040#1a;
       |SI aParam ! "";   ||no lo regraba si viene de fuera
           |LIBERA #1;
           |ACABA;
       |FINSI;
   |FINSI;
   |LIBERA #1;

   |BUCLE LosBorro;

   #1#0 = #0#0;
   |LEE 040#1=;
   |SI FSalida = 0;
      |BUCLELIN 0lineapla#1;
   |FINSI;
|FPRC;

|PROCESO loborro;
   |SI aParam = ""; |ACABA; |FINSI;
   #1#0 = nPara1;
   |LEE 101#1=;
   |SI FSalida = 0;
       |BUCLE LosBorro;
       |BORRA 040#1a;
   |FINSI;
   |LIBERA #1;
|FPRC;

|PROCESO Seleccion;
  |SI nPara1 = #0#0; |ACABA; |FINSI;
  |SI eaDepar = "N";
      swSi = 1;
      eaNombreAct = #0#1;
  |SINO;
      eOpDep = 0;
      eSwNoalta = 1;
      enActividad = nPara1;
      eaCodDep    = nPara1;
      |HAZ Actividad;
      |SI eswLect = 0; swSi = 1; |FINSI;
  |FINSI;
|FPRC;

|PROCESO LoqueHacia;
 |PATH_DAT #1 fich_alta;
 |PATH_DAT #2 fich_alta;

 #0#0 = 0;
 |HAZ LeeEstructura;
 |SI swNo = 1;
     |SI aElDepar ! "";
         #0#0 = aElDepar;
     |SINO;
         #0#0 = 1;
     |FINSI;
     |HAZ LeeEstructura;
     |SI swNo = 1; |Y aParam = ""; |ACABA; |FINSI;
 |FINSI;

 #0#2 = 1;
 #0#3 = 99; |SI eaDepar ! "S"; #0#3 = 1; |FINSI;
 |SI aParam ! "";
     #0#2 = enDeAct;
     #0#3 = enDeAct;
 |FINSI;
 |ABRE #1;
 |PARA nPara1 = #0#2; |SI nPara1 [ #0#3; |HACIENDO nPara1 = nPara1 + 1;
       |SI aParam = "";
           swSi = 0;
           |HAZ Seleccion;
           |SI swSi = 1; |HAZ locreo; |FINSI;
       |SINO;
           |SI enOpAct = 1; |HAZ locreo; |FINSI;
           |SI enOpAct = 3; |HAZ loborro; |FINSI;
       |FINSI;
 |SIGUE;
 |CIERRA #1;
|FPRC;

|PROCESO NuevoProc;

 |SI #30#26 [ 80;
     nEjercicio = #30#26 + 2000;
 |SINO;
     nEjercicio = #30#26 + 1900;
 |FINSI;
 nMes   = #30#11;
 |HAZ LaFecha;
 fFechaI = aLaFecha1;

 |SI #30#11 > 1;
     nEjercicio = nEjercicio + 1;
 |FINSI;
 nMes  = #30#12;
 |HAZ LaFecha;
 fFechaF = aLaFecha2;

 aAlfa1 = #30#2; aAlfa1 = ("00000" + aAlfa1) % -105;
 aAlfa2 = #30#3; aAlfa2 = ("0"     + aAlfa2) % -101;
 |DBASS aAlfa3;
 fich_alta = aAlfa3 + "contagen/fich/" + aAlfa1 + aAlfa2 + "/";

 |SI enOpAct = 1; |Y efFechaAA > "01.01.0000";
     |SI fFechaF < efFechaAA; |ACABA; |FINSI;
 |FINSI;
 |HAZ LoqueHacia;
|FPRC;

|DEFBUCLE LeoEmpresa;
 #30#1;
 ;
 enEmpresa, 0;
 enEmpresa, 9;
 ;
 NULL, NuevoProc;
|FIN;

|PROGRAMA;
 aParam = PARAMETRO; |QBF aParam;
 |HAZ DirAplicSt;

 |SI aParam = "";
     fFechaI = fec1;
     fFechaF = fec2;
     |HAZ LoqueHacia;
 |SINO;
     |BUCLE LeoEmpresa;
 |FINSI;
|FPRO;

|PROCESO LaFecha;
  aAlfa1 = nMes; |QBF aAlfa1;
  aAlfa1 = ("00" + aAlfa1) % -102;
  aAlfa2 = nEjercicio;

  aLaFecha1 = "01." + aAlfa1 + "." + aAlfa2;

  aAlfa3 = "31.";
  |SI nMes = 4; |O nMes = 6; |O nMes = 9; |O nMes = 11;
      aAlfa3 = "30.";
  |SINO;
      |SI nMes = 2;
          aAlfa3 = "28.";
          nNume1 = nEjercicio / 4; nNume2 = (nEjercicio / 4) ! 0;
          |SI nNume1 = nNume2;
              aAlfa3 = "29.";
          |FINSI;
      |FINSI;
  |FINSI;
  aLaFecha2 = aAlfa3 + aAlfa1 + "." + aAlfa2;
|FPRC;
