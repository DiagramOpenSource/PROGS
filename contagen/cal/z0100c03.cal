|FICHEROS;
     gadz0100;
     gadm0003;

     cacuenta;
     caclipro;
     dscsvw08;
     dscsvw10;

     :dsarchi/dpntm100;
     :dsarchi/dpntm101;
     :dsarchi/dsarw114;

     &regisnif@;
     &sgpaises@;
|FIN;

|INCLUYE z0100var;

|PROCESO MiraNIF;
     |QBF eaVarDni;

     |PARA;  |SI;  |HACIENDO;
          eaVarDni = eaVarDni - "-";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |PARA;  |SI;  |HACIENDO;
          eaVarDni = eaVarDni - ".";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |PARA;  |SI;  |HACIENDO;
          eaVarDni = eaVarDni - " ";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     eaCodPais = eaVarDni % 102;
     |SI eaCodPais ! "  ";
         |HAZ LeePais;
         |SI #sgpaises@#0 ! "   ";
             eaVarDni = eaVarDni - eaCodPais;

             |ACABA;
         |FINSI;
     |FINSI;

     eaCodPais = "";

     aLongVar = eaVarDni % 0;
     nLongVar = aLongVar;
     |SI nLongVar > 9;  |ACABA;  |FINSI;

     enMNif    = 1;
     |HAZ CalculoDNI;
|FPRC;

|PROCESO CalculaCuenta;
     |QBF eaCuenta;
     |SI eaCuenta = "";  |ACABA;  |FINSI;

     aLongVar = eaCuenta % 0;
     nLongVar = aLongVar;

     |SI nLongVar ! MaximoDigitos;
         nDife = MaximoDigitos - nLongVar;
         |SI nDife < 0;  |ACABA;  |FINSI;

         nDesdeCar = 4;

         nPos1     = 100 + nDesdeCar;
         nPos2     = (100 * (nDesdeCar + 1)) + 99;
         aAlfa     = (eaCuenta % nPos1) + ("0" * nDife) + (eaCuenta % nPos2);
         eaCuenta  = aAlfa;
     |FINSI;

     |HAZ SacaNivel;
|FPRC;

|PROCESO CargaCamposCli;
     |SI #dscsvw10#0 = 2;  #dscsvw08#1  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 3;  #dscsvw08#2  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 4;  #dscsvw08#3  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 8;  #dscsvw08#6  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 7;  #dscsvw08#7  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 10; #dscsvw08#8  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 12; #dscsvw08#9  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 13; #dscsvw08#10 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 17; #dscsvw08#25 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 6;  #dscsvw08#26 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 24; #dscsvw08#52 = #dscsvw10#1;  |FINSI;
|FPRC;

|PROCESO CargaCamposPro;
     |SI #dscsvw10#0 = 2;  #dscsvw08#1  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 3;  #dscsvw08#2  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 4;  #dscsvw08#3  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 8;  #dscsvw08#6  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 7;  #dscsvw08#7  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 10; #dscsvw08#8  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 12; #dscsvw08#9  = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 13; #dscsvw08#10 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 19; #dscsvw08#25 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 6;  #dscsvw08#26 = #dscsvw10#1;  |FINSI;
|FPRC;

|PROCESO CargaCampos100;
     |SI #dscsvw10#0 = 3;
         #dpntm100#4 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 4;
         aFac = #dscsvw10#1;  |QBF aFac;
     |FINSI;

     |SI #dscsvw10#0 = 5;
         |SI aFac = "";
             aFac = #dscsvw10#1;  |QBF aFac;
         |SINO;
             aAlfa = #dscsvw10#1;  |QBF aAlfa;
             aFac = aFac + " / " + aAlfa;  |QBF aFac;
         |FINSI;
     |FINSI;

     |SI #dscsvw10#0 = 7;
         aAlfa = #dscsvw10#1 % 102;
         aAlfa = aAlfa + "." + #dscsvw10#1 % 402;
         aAlfa = aAlfa + ".20" + #dscsvw10#1 % 702;

         #dpntm100#15 = aAlfa;
     |FINSI;

     |SI #dscsvw10#0 = 13;
         #dpntm100#20 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 24;
         eaVarDni = #dscsvw10#1;
         |HAZ MiraNIF;
         #dpntm100#2 = eaVarDni;
     |FINSI;

     |SI #dscsvw10#0 = 30;
         nBas1 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 31;
         nCuI1 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 32;
         nBas2 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 33;
         nCuI2 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 9;
         nCuT = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 21;
         nRET = #dscsvw10#1;
     |FINSI;
|FPRC;

|PROCESO CargaCampos101;
     |SI #dscsvw10#0 = 4;
         #dpntm101#4 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 7;
         aFac = #dscsvw10#1;  |QBF aFac;
     |FINSI;

     |SI #dscsvw10#0 = 8;
         |SI aFac = "";
             aFac = #dscsvw10#1;  |QBF aFac;
         |SINO;
             aAlfa = #dscsvw10#1;  |QBF aAlfa;
             aFac = aFac + " / " + aAlfa;  |QBF aFac;
         |FINSI;
     |FINSI;

     |SI #dscsvw10#0 = 6;
         aAlfa = #dscsvw10#1 % 102;
         aAlfa = aAlfa + "." + #dscsvw10#1 % 402;
         aAlfa = aAlfa + ".20" + #dscsvw10#1 % 702;

         #dpntm101#15 = aAlfa;
     |FINSI;

     |SI #dscsvw10#0 = 43;
         #dpntm101#20 = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 29;
         eaVarDni = #dscsvw10#1;
         |HAZ MiraNIF;
         #dpntm101#2 = eaVarDni;
     |FINSI;

     |SI #dscsvw10#0 = 10;  nBas1 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 11;  nIVA1 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 12;  nCuI1 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 13;  nBas2 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 14;  nIVA2 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 15;  nCuI2 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 20;  nBas3 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 21;  nIVA3 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 22;  nCuI3 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 23;  nBas4 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 24;  nIVA4 = #dscsvw10#1;  |FINSI;
     |SI #dscsvw10#0 = 25;  nCuI4 = #dscsvw10#1;  |FINSI;

     |SI #dscsvw10#0 = 27;
         nCuT = #dscsvw10#1;
     |FINSI;

     |SI #dscsvw10#0 = 26;
         nRET = #dscsvw10#1;
     |FINSI;
|FPRC;

|PROCESO dscsvw10Carga;
     |SI enCmp = 7;   |HAZ CargaCamposCli;  |FINSI;
     |SI enCmp = 8;   |HAZ CargaCamposPro;  |FINSI;
     |SI enCmp = 9;   |HAZ CargaCampos100;  |FINSI;
     |SI enCmp = 10;  |HAZ CargaCampos101;  |FINSI;
|FPRC;

|DEFBUCLE dscsvw10Carga;
     #dscsvw10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw10Carga;
|FIN;

|PROCESO CargaCli;
     |DDEFECTO #dscsvw08;

     #dscsvw08#0  = nReg - 1;
     #dscsvw08#24 = "C";

     |BUCLE dscsvw10Carga;

     eaVarDni = #dscsvw08#10;
     |HAZ MiraNIF;
     #dscsvw08#10 = eaVarDni;

     |SI #dscsvw08#25 = "   ";  |Y eaCodPais ! "";
         #dscsvw08#25 = eaCodPais;
     |FINSI;

     eaCuenta = "4300" + #dscsvw08#1;
     |HAZ CalculaCuenta;

     #dscsvw08#1  = eaCuenta;
     #dscsvw08#11 = eaCuenta;
     #dscsvw08#12 = dig3;

     aAlfa = #dscsvw08#26 % 102;  #dscsvw08#4 = aAlfa;
     aAlfa = #dscsvw08#26 % 303;  #dscsvw08#5 = aAlfa;

     |GRABA 020#dscsvw08.n;
     |LIBERA #dscsvw08;
|FPRC;

|PROCESO CargaPro;
     |DDEFECTO #dscsvw08;

     #dscsvw08#0  = nReg - 1;
     #dscsvw08#24 = "P";

     |BUCLE dscsvw10Carga;

     eaVarDni = #dscsvw08#10;
     |HAZ MiraNIF;
     #dscsvw08#10 = eaVarDni;

     |SI #dscsvw08#25 = "   ";  |Y eaCodPais ! "";
         #dscsvw08#25 = eaCodPais;
     |FINSI;

     eaCuenta = "4000" + #dscsvw08#1;
     |HAZ CalculaCuenta;

     #dscsvw08#1  = eaCuenta;
     #dscsvw08#11 = eaCuenta;
     #dscsvw08#12 = dig3;

     aAlfa = #dscsvw08#26 % 102;  #dscsvw08#4 = aAlfa;
     aAlfa = #dscsvw08#26 % 303;  #dscsvw08#5 = aAlfa;

     |GRABA 020#dscsvw08.n;
     |LIBERA #dscsvw08;
|FPRC;

|PROCESO Carga100;
     |LEE 000#dpntm100.u;
     |SI FSalida ! 0;  #dpntm100#0 = 0;  |FINSI;
     enReg = #dpntm100#0 + 1;

     |DDEFECTO #dpntm100;
     #dpntm100#0  = enReg;
     #dpntm100#1  = #48#30;
     #dpntm100#3  = "N";
     #dpntm100#6  = "1";
     #dpntm100#7  = "NIF";
     #dpntm100#8  = "";
     #dpntm100#49 = "Operaci¢n habitual";
     #dpntm100#9  = 1;
     #dpntm100#10 = 0;
     #dpntm100#11 = "";
     #dpntm100#12 = "";
     aFac         = "";
     nBas1        = 0;
     nBas2        = 0;
     nBas3        = 0;
     nBas4        = 0;
     nBas5        = 0;
     nIVA1        = 0;
     nIVA2        = 0;
     nIVA3        = 0;
     nIVA4        = 0;
     nIVA5        = 0;
     nCuI1        = 0;
     nCuI2        = 0;
     nCuI3        = 0;
     nCuI4        = 0;
     nCuI5        = 0;
     nCuT         = 0;
     nRET         = 0;

     |BUCLE dscsvw10Carga;

     enContIva = 0;
     enTBas    = nBas1 + nBas2 + nBas3;
     enTCuI    = nCuI1 + nCuI2 + nCuI3;
     enTCuR    = nCuR1 + nCuR2 + nCuR3;

     enTRet    = 0;
     enRet     = 0;
     enDRet    = 0;
     enLin1    = 0;
     enLin2    = 0;
     enLin3    = 0;
     enLin4    = 0;
     enLin5    = 0;

     |SI nCuT ! 0;
         enTRet = nCuT;
         enRet  = (enTRet * 100) / enTBas;
         eaSobre   = "B";
     |FINSI;

     |SI nBas1 ! 0;
         enBas  = nBas1;
         enIva  = (nCuI1 * 100) / nBas1;
         enCuI  = nCuI1;
         enRec  = 0;
         enCuR  = 0;
         enTIVA = 1;

         |HAZ GrabaBloque100;
     |FINSI;

     |SI nBas2 ! 0;
         enBas  = nBas2;
         enIva  = (nCuI2 * 100) / nBas2;
         enCuI  = nCuI2;
         enRec  = 0;
         enCuR  = 0;
         enTIVA = 2;
         |HAZ GrabaBloque100;
     |FINSI;

     nDif = enDRet - enTRet;
     |SI nDif ! 0;
         #dpntm100#27 = #dpntm100#27 + nDif;
     |FINSI;

     #dpntm100#28 = enTBas + enTCuI + enTCuR - enTRet;

     |ABRE #regisnif@;
     #regisnif@#0 = #dpntm100#2;
     |LEE 000#regisnif@.=;
     |SI FSalida ! 0;  |DDEFECTO #regisnif@;  |FINSI;
     |CIERRA #regisnif@;

     #dpntm100#51 = #regisnif@#2;
     #dpntm100#52 = (("00" + #regisnif@#4) % -102) + (("000" + #regisnif@#5) % -103);
     #dpntm100#53 = #regisnif@#6;
     #dpntm100#54 = #regisnif@#8;
     #dpntm100#55 = #regisnif@#17;

     #dpntm100#44 = "S";
     #dpntm100#76 = #gadz0100#1;
     #dpntm100#77 = #gadz0100#1;
     #dpntm100#78 = "";
     #dpntm100#79 = 0;

     |SI enTBas ] 0;
         #dpntm100#13 = aFac;
     |FINSI;

     |SI enTBas < 0;
         #dpntm100#14 = aFac;
     |FINSI;

     |GRABA 020#dpntm100.n;
     |LIBERA #dpntm100;

     |PARA nCampo = 0;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
           #dsarw114#nCampo# = #dpntm100#nCampo#;
     |SIGUE;

     |SI #dpntm100#30 ! 0;  |O #dpntm100#37 ! 0; |O #dpntm100#57 ! 0; |O #dpntm100#64 ! 0;
         enRegPrimerIVA = #dpntm100#0;
         |HAZ RestoBases100;
     |FINSI;
|FPRC;

|PROCESO Carga101;
     |LEE 000#dpntm101.u;
     |SI FSalida ! 0;  #dpntm101#0 = 0;  |FINSI;
     enReg = #dpntm101#0 + 1;

     |DDEFECTO #dpntm101;

     #dpntm101#0  = enReg;
     #dpntm101#1  = #48#30;
     #dpntm101#3  = "N";
     #dpntm101#6  = "1";
     #dpntm101#7  = "NIF";
     #dpntm101#8  = "";
     #dpntm101#49 = "Operaci¢n habitual";
     #dpntm101#9  = 1;
     #dpntm101#10 = 0;
     #dpntm101#11 = "";
     #dpntm101#12 = "";
     aFac         = "";
     nBas1        = 0;
     nBas2        = 0;
     nBas3        = 0;
     nBas4        = 0;
     nBas5        = 0;
     nIVA1        = 0;
     nIVA2        = 0;
     nIVA3        = 0;
     nIVA4        = 0;
     nIVA5        = 0;
     nCuI1        = 0;
     nCuI2        = 0;
     nCuI3        = 0;
     nCuI4        = 0;
     nCuI5        = 0;
     nCuT         = 0;
     nRET         = 0;

     |BUCLE dscsvw10Carga;

     enContIva = 0;
     enTBas    = nBas1 + nBas2 + nBas3;
     enTCuI    = nCuI1 + nCuI2 + nCuI3;
     enTCuR    = nCuR1 + nCuR2 + nCuR3;

     enTRet    = 0;
     enRet     = 0;
     enDRet    = 0;
     enLin1    = 0;
     enLin2    = 0;
     enLin3    = 0;
     enLin4    = 0;
     enLin5    = 0;

     |SI nCuT ! 0;
         enTRet = nCuT;
         enRet  = (enTRet * 100) / enTBas;
         eaSobre   = "B";
     |FINSI;

     |SI nBas1 ! 0;
         enBas  = nBas1;
         enIva  = (nCuI1 * 100) / nBas1;
         enCuI  = nCuI1;
         enRec  = 0;
         enCuR  = 0;
         enTIVA = 1;

         |HAZ GrabaBloque101;
     |FINSI;

     |SI nBas2 ! 0;
         enBas  = nBas2;
         enIva  = (nCuI2 * 100) / nBas2;
         enCuI  = nCuI2;
         enRec  = 0;
         enCuR  = 0;
         enTIVA = 2;
         |HAZ GrabaBloque101;
     |FINSI;

     nDif = enDRet - enTRet;
     |SI nDif ! 0;
         #dpntm101#27 = #dpntm100#27 + nDif;
     |FINSI;

     #dpntm101#28 = enTBas + enTCuI + enTCuR - enTRet;

     |ABRE #regisnif@;
     #regisnif@#0 = #dpntm100#2;
     |LEE 000#regisnif@.=;
     |SI FSalida ! 0;  |DDEFECTO #regisnif@;  |FINSI;
     |CIERRA #regisnif@;

     #dpntm100#51 = #regisnif@#2;
     #dpntm100#52 = (("00" + #regisnif@#4) % -102) + (("000" + #regisnif@#5) % -103);
     #dpntm100#53 = #regisnif@#6;
     #dpntm100#54 = #regisnif@#8;
     #dpntm100#55 = #regisnif@#17;

     #dpntm101#44 = "S";
     #dpntm101#76 = #gadz0100#1;
     #dpntm101#77 = #gadz0100#1;
     #dpntm101#78 = "";
     #dpntm101#79 = 0;

     |SI enTBas ] 0;
         #dpntm101#13 = aFac;
     |FINSI;

     |SI enTBas < 0;
         #dpntm101#14 = aFac;
     |FINSI;

     |GRABA 020#dpntm101.n;
     |LIBERA #dpntm101;

     |PARA nCampo = 0;  |SI nCampo [ 79;  |HACIENDO nCampo = nCampo + 1;
           #dsarw114#nCampo# = #dpntm101#nCampo#;
     |SIGUE;

     |SI #dpntm101#30 ! 0;  |O #dpntm101#37 ! 0; |O #dpntm101#57 ! 0; |O #dpntm101#64 ! 0;
         enRegPrimerIVA = #dpntm101#0;
         |HAZ RestoBases101;
     |FINSI;
|FPRC;

|PROCESO GrabaDatos;
     |CIERRA #dscsvw10;

     nReg   = nReg + 1;
     |SI nReg = 1;
         |DELINDEX #dscsvw10;
         |ABRE #dscsvw10;

         |ACABA;
     |FINSI;

     |SI enCmp = 7;   |HAZ CargaCli;  |FINSI;
     |SI enCmp = 8;   |HAZ CargaPro;  |FINSI;
     |SI enCmp = 9;   |HAZ Carga100;  |FINSI;
     |SI enCmp = 10;  |HAZ Carga101;  |FINSI;

     |DELINDEX #dscsvw10;
     |ABRE #dscsvw10;

     |PULSATECLA;
|FPRC;

|PROCESO Grabaw10;
     #dscsvw10#0 = nCmp;
     #dscsvw10#1 = aVar;
     |GRABA 020#dscsvw10.n;
     |LIBERA #dscsvw10;
|FPRC;

|PROCESO SacaDatos;
     aLong  = aLee % 0;
     nLong  = aLong;
     aC10   = &10;
     aC13   = &13;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac = aLee % nPos;

           |SI aCarac = aC13;
               aCarac = ";";
           |FINSI;

           |SI aCarac = ";";
               nCmp   = nCmp + 1;

               |HAZ Grabaw10;

               aVar   = "";
               aCarac = "";
           |FINSI;

           |SI aCarac = aC10;
               aCarac = "";
           |FINSI;

           |SI nCmp = nTotCmp;  |Y nCmp ! 0;
               |HAZ GrabaDatos;

               nCmp = 0;
           |FINSI;

           aVar = aVar + aCarac;
      |SIGUE;
|FPRC;

|PROCESO LeeCSV;
     aAlfa = "Procesando registros del fichero " + #gadz0100#enCmp#;  |QBF aAlfa;
     |VENTANA 0502, 0598, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
     |PTEC 802;  |PAUSA;
     |PULSATECLA;

     |ABRE #dscsvw10;

     |SI enCmp = 7;
         aFicTmp = "w8cli" + Usuario;
         |NOME_DAT #dscsvw08#aFicTmp#;
         |ABRE #dscsvw08;  |CIERRA #dscsvw08;  |DELINDEX #dscsvw08;

         |ABRE #dscsvw08;
     |FINSI;

     |SI enCmp = 8;
         aFicTmp = "w8pro" + Usuario;
         |NOME_DAT #dscsvw08#aFicTmp#;
         |ABRE #dscsvw08;  |CIERRA #dscsvw08;  |DELINDEX #dscsvw08;

         |ABRE #dscsvw08;
     |FINSI;

     |SI enCmp = 9;
         |DFICE eaPathDPNTM;
         |PATH_DAT #dpntm100#eaPathDPNTM#;
         |ABRE #dpntm100;  |CIERRA #dpntm100;  |DELINDEX #dpntm100;
         |ABRE #gadm0003;  |CIERRA #gadm0003;  |DELINDEX #gadm0003;

         |ABRE #dpntm100;
     |FINSI;

     |SI enCmp = 10;
         |DFICE eaPathDPNTM;
         |PATH_DAT #dpntm101#eaPathDPNTM#;
         |ABRE #dpntm101;  |CIERRA #dpntm101;  |DELINDEX #dpntm101;
         |ABRE #gadm0003;  |CIERRA #gadm0003;  |DELINDEX #gadm0003;

         |ABRE #dpntm101;
     |FINSI;

     nCmp       = 0;
     nReg       = 0;

     |XABRE "B", aFicCSV, nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 255, aLee;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          |HAZ SacaDatos;
     |SIGUE;
     |XCIERRA nHandle;

     |LEE 000#dscsvw10.p;
     |SI FSalida = 0;
         nCmp   = nCmp + 1;
         |HAZ Grabaw10;
         |HAZ GrabaDatos;
         |CIERRA #dscsvw10;
     |FINSI;

     |SI enCmp = 7;   |CIERRA #dscsvw08;   |FINSI;
     |SI enCmp = 8;   |CIERRA #dscsvw08;   |FINSI;
     |SI enCmp = 9;   |CIERRA #dpntm100;   |FINSI;
     |SI enCmp = 10;  |CIERRA #dpntm101;   |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |ABRE #dscsvw10; |CIERRA #dscsvw10; |DELINDEX #dscsvw10;
|FPRC;

|PROCESO RecogeTransporte;
     aFicCSV = #gadz0100#enCmp#;  |QBF aFicCSV;
     |SI aFicCSV = "";  |ACABA;  |FINSI;

     |SI enCmp = 9;  |Y enLeeIVA100 = 1;
         |ACABA;
     |FINSI;

     |SI enCmp = 10;  |Y enLeeIVA101 = 1;
         |ACABA;
     |FINSI;

     |SI enCmp = 7;   nTotCmp = 40;  |FINSI;
     |SI enCmp = 8;   nTotCmp = 22;  |FINSI;
     |SI enCmp = 9;   nTotCmp = 49;  |FINSI;
     |SI enCmp = 10;  nTotCmp = 48;  |FINSI;

     nReg = 0;
     |HAZ LeeCSV;
     nReg = nReg - 1;
     |SI nReg < 0;  nReg = 0;  |FINSI;

     |SI enCmp = 7;   enNumCli = nReg;  |FINSI;
     |SI enCmp = 8;   enNumPro = nReg;  |FINSI;
     |SI enCmp = 9;   enNumEmi = nReg;  |FINSI;
     |SI enCmp = 10;  enNumRec = nReg;  |FINSI;
|FPRC;

|PROCESO dscsvw08;
     nHay  = 0;
     aAlfa = #dscsvw08#10;  |QBF aAlfa;
     |SI aAlfa ! "";
         |SELECT #4#caclipro;
         #caclipro#9 = #dscsvw08#10;
         |LEE 000#caclipro.];
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #caclipro#9 ! #dscsvw08#10;
                  |SAL;
              |FINSI;

              |SI #caclipro#23 = #dscsvw08#24;
                  nHay = 1;
                  |SAL;
              |FINSI;

              |LEE 000#caclipro.s;
         |SIGUE;
     |FINSI;

     |SELECT #1#caclipro;
     |SI nHay = 1;  |ACABA;  |FINSI;

     #caclipro#23 = #dscsvw08#24;
     #caclipro#10 = #dscsvw08#11;
     |LEE 000#caclipro.=;
     |SI FSalida = 0;
         |SI #caclipro#9 = #dscsvw08#10;
             |ACABA;
         |FINSI;

         #caclipro#23 = #dscsvw08#24;
         #caclipro#10 = aRaiz + "99999999";
         |LEE 000#caclipro.];
         |SI FSalida = 0;
             |LEE 000#caclipro.a;
         |SINO;
             |LEE 000#caclipro.u;
         |FINSI;

         eaCuenta = aRaiz + "1";
         |SI FSalida = 0;  |Y #caclipro#23 = #dscsvw08#24;
             aAlfa    = #caclipro#10 % 512;
             nNume    = aAlfa;
             nNume    = nNume + 1;
             eaCuenta = aRaiz + nNume;
         |FINSI;

         |HAZ CalculaCuenta;

         #dscsvw08#1  = eaCuenta;
         #dscsvw08#11 = eaCuenta;
         #dscsvw08#12 = dig3;
     |FINSI;

     |SELECT #1#caclipro;

     |PARA nCampo = 1;  |SI nCampo [ 54;  |HACIENDO nCampo = nCampo + 1;
           nDCampo = nCampo - 1;
           #caclipro#nDCampo# = #dscsvw08#nCampo#
     |SIGUE;

     |GRABA 020#caclipro.n;
     |LIBERA #caclipro;

     #cacuenta#0 = #caclipro#10;
     |LEE 000#cacuenta.=;
     |SI FSalida ! 0;
         |DDEFECTO #cacuenta;
         #cacuenta#0 = #caclipro#10;
         #cacuenta#1 = #caclipro#11;
         #cacuenta#2 = #caclipro#1;
         #cacuenta#3 = "S";

         |GRABA 020#cacuenta.n;
         |LIBERA #cacuenta;
     |FINSI;

     eaCodNif = #caclipro#9;
     |HAZ LeeNifs;
     |SI ewNif = 0; |ACABA;  |FINSI;

     |ABRE #regisnif@;
     |DDEFECTO #regisnif@;

     #regisnif@#0  = #caclipro#9;
     #regisnif@#1  = #caclipro#1;
     #regisnif@#2  = #caclipro#2;
     #regisnif@#4  = #caclipro#3;
     #regisnif@#5  = #caclipro#4;
     #regisnif@#7  = #caclipro#5;
     #regisnif@#6  = #caclipro#6;
     #regisnif@#8  = #caclipro#7;
     #regisnif@#17 = #caclipro#8;
     #regisnif@#12 = #caclipro#24;

     |GRABA 020#regisnif@.n;
     |LIBERA #regisnif@;
     |CIERRA #regisnif@;
|FPRC;

|DEFBUCLE dscsvw08;
     #dscsvw08#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dscsvw08;
|FIN;

|PROCESO GrabaClientes;
     aFicTmp = "w8cli" + Usuario;
     |NOME_DAT #dscsvw08#aFicTmp#;

     aRaiz = "4300";
     |ABRE #cacuenta;
     |ABRE #caclipro;
     |BUCLE dscsvw08;
     |CIERRA #cacuenta;
     |CIERRA #caclipro;
|FPRC;

|PROCESO GrabaProveedores;
     aFicTmp = "w8pro" + Usuario;
     |NOME_DAT #dscsvw08#aFicTmp#;

     aRaiz = "4000";
     |ABRE #cacuenta;
     |ABRE #caclipro;
     |BUCLE dscsvw08;
     |CIERRA #cacuenta;
     |CIERRA #caclipro;
|FPRC;
