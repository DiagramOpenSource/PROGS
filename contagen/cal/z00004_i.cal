|FICHEROS;
     casoplih #13;
     casoplic #14;

     :/basica/def/agifigen #118;
|FIN;

|VARIABLES;
     nRegis = 0;
     nNume1 = 0;
     nNume2 = 0;
     fFecha = @;
     fFecha1= @;
     fFecha2= @;
     fFecha3= @;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dslegv_i;

|PROCESO eGrabaHistLegal;

   |SI enLegEje  < 2015; |ACABA; |FINSI;
   |HAZ NomLibros;

   |ABRE #14;
   |DDEFECTO #14;
   #14#0 = eaLegEmp;
   #14#1 = enLegEje;
   #14#2 = eaLegPer;
   |LEE 141#14=;
   |SI FSalida ! 0;
       |HAZ CalFecLeg;
       |DDEFECTO #14;
       #14#0 = eaLegEmp;
       #14#1 = enLegEje;
       #14#2 = eaLegPer;
       #14#3 = eaPathLeg;
       #14#4 = aMasNombre;
       #14#5 = eaNombreEmp;
       #14#6 = fFecha1;
       #14#7 = fFecha2;
       #14#8 = fFecha3;
       |GRABA 020#14b;
   |FINSI;

   nNume1    = 8 + (nTipoL * 2);
   nNume2    = nNume1 + 1;
   |SI #14nNume1 > nNumer; |O #14nNume1 = 0; #14nNume1 = nNumer; |FINSI;
   |SI enRegisLeg = 0;
       #14nNume2 = #14nNume2 + 1;
   |FINSI;
   fFecha = ~;
   #14#50 = fFecha;

   #14#9 = "N";
   #14#51 = "01.01.0000";
   |GRABA 020#14a;
   |LIBERA #14;
   |CIERRA #14;

   |SI #14#6 > efFecha1; efFecha1 = #14#6; |FINSI;
   |SI #14#7 < efFecha2; efFecha2 = #14#7; |FINSI;

   |ABRE #13;
   #13#0 = eaLegEmp;
   #13#1 = enLegEje;
   #13#2 = eaLegPer;
   #13#3 = nTipoL;
   #13#4 = 99;
   |LEE 041#13];
   |SI FSalida ! 0;
       |LEE 041#13u;
   |SINO;
       |LEE 041#13a;
   |FINSI;
   nRegis = 1;
   |SI FSalida = 0; |Y #13#0 = eaLegEmp; |Y #13#1 = enLegEje;
       |Y #13#2 = eaLegPer; |Y #13#3 = nTipoL;
          nRegis = #13#4 + 1;
   |FINSI;

   |SI enRegisLeg ! 0;
       nRegis = enRegisLeg;
   |FINSI;
   |DDEFECTO #13;
   #13#0 = eaLegEmp;
   #13#1 = enLegEje;
   #13#2 = eaLegPer;
   #13#3 = nTipoL;
   #13#4 = nRegis;
   |LEE 141#13=;
   |SI FSalida ! 0;
       |DDEFECTO #13;
       #13#0 = eaLegEmp;
       #13#1 = enLegEje;
       #13#2 = eaLegPer;
       #13#3 = nTipoL;
       #13#4 = nRegis;
       |GRABA 020#13b;
   |FINSI;
   #13#5 = aNombre1;
   #13#6 = nNumer;
   #13#7 = efFecha1;
   #13#8 = efFecha2;
   #13#9 = efFecha3;
   #13#10 = aNomFLeg;
   #13#11 = "N";
   |GRABA 040#13a;
   |CIERRA #13;
   enRegisLeg = nRegis;
|FPRC;

|PROCESO eBorraHistLegal;

   |SI enLegEje  < 2015; |ACABA; |FINSI;

   |SI enRegisLeg = 0; |ACABA; |FINSI;

   |ABRE #14;
   |DDEFECTO #14;
   #14#0 = eaLegEmp;
   #14#1 = enLegEje;
   #14#2 = eaLegPer;
   |LEE 141#14=;
   |SI FSalida ! 0;
       |HAZ CalFecLeg;
       |DDEFECTO #14;
       #14#0 = eaLegEmp;
       #14#1 = enLegEje;
       #14#2 = eaLegPer;
       #14#3 = eaPathLeg;
       #14#4 = aMasNombre;
       #14#5 = eaNombreEmp;
       #14#6 = fFecha1;
       #14#7 = fFecha2;
       #14#8 = fFecha3;
       |GRABA 020#14b;
   |FINSI;

   nNume1    = 8 + (nTipoL * 2);
   nNume2    = nNume1 + 1;
   #14nNume2 = #14nNume2 - 1;
   |SI #14nNume2 < 0; #14nNume2 = 0; |FINSI;
   |GRABA 020#14a;

   |LIBERA #14;
   |CIERRA #14;

   |ABRE #13;
   #13#0 = eaLegEmp;
   #13#1 = enLegEje;
   #13#2 = eaLegPer;
   #13#3 = nTipoL;
   #13#4 = enRegisLeg;
   |LEE 041#13=;
   |SI FSalida = 0;
       |BORRA 020#13a;
   |FINSI;
   |LIBERA #13;
   |CIERRA #13;
|FPRC;

|| ... Procesos Nombres de los Libros
|PROCESO NomLibros;
     aNombre1 = ""; aNombre2 = "";

     |SI nTipoL = 1;  aNombre1 = "Diario                                  "; aNombre2 = "DIARIO_";   |FINSI;
     |SI nTipoL = 2;  aNombre1 = "Inventario y Cuentas Anuales            "; aNombre2 = "INV_CUEN_"; |FINSI;
     |SI nTipoL = 3;  aNombre1 = "Balance de comprobacion (sumas y saldos)"; aNombre2 = "BAL_SUMS_"; |FINSI;
     |SI nTipoL = 4;  aNombre1 = "Inventario                              "; aNombre2 = "INVENTAR_"; |FINSI;
     |SI nTipoL = 5;  aNombre1 = "Balances                                "; aNombre2 = "BALANCES_"; |FINSI;
     |SI nTipoL = 6;  aNombre1 = "Memoria                                 "; aNombre2 = "MEMORIA_";  |FINSI;
     |SI nTipoL = 7;  aNombre1 = "Mayor                                   "; aNombre2 = "MAYOR_";    |FINSI;
     |SI nTipoL = 8;  aNombre1 = "Libro de Perdidas y Ganancias           "; aNombre2 = "PER_GAN_";  |FINSI;
     |SI nTipoL = 9;  aNombre1 = "IVA                                     "; aNombre2 = "IVA_";      |FINSI;
     |SI nTipoL = 10; aNombre1 = "Facturas Emitidas                       "; aNombre2 = "FAC_EMIT_"; |FINSI;
     |SI nTipoL = 11; aNombre1 = "Facturas Recibidas                      "; aNombre2 = "FAC_RECI_"; |FINSI;
     |SI nTipoL = 12; aNombre1 = "Detalle del Diario                      "; aNombre2 = "DET_DIA_";  |FINSI;
     |SI nTipoL = 13; aNombre1 = "Registro de Acciones Nominativas        "; aNombre2 = "ACCIONES_"; |FINSI;
     |SI nTipoL = 14; aNombre1 = "Registro de Socios                      "; aNombre2 = "SOCIOS_";   |FINSI;
     |SI nTipoL = 15; aNombre1 = "Libro de Actas                          "; aNombre2 = "ACTASCON_"; |FINSI;
     |SI nTipoL = 16; aNombre1 = "Libro de Detalle de Actas               "; aNombre2 = "ACTASDET_"; |FINSI;
     |SI nTipoL = 17; aNombre1 = "Libro de Actas del Consejo              "; aNombre2 = "ACTALCON_"; |FINSI;
     |SI nTipoL = 18; aNombre1 = "Libro de Detalle de Actas del Consejo   "; aNombre2 = "ACTACODE_"; |FINSI;
     |SI nTipoL = 19; aNombre1 = "Libro-registro de Contratos del Socio Unico con la Sociedad Unipersonal"; aNombre2 = "SOCUNICO_"; |FINSI;
     |SI nTipoL = 20; aNombre1 = "Otros                                   "; aNombre2 = "OTROS_";    |FINSI;
|FPRC;

|PROCESO LibrosNom;
     |QBF aNombre1;
     nTipoL = 0; aNombre2 = "";

     |SI aNombre1 = "Diario";                                   nTipoL = 1;  aNombre2 = "DIARIO_";   |FINSI;
     |SI aNombre1 = "Inventario y Cuentas Anuales";             nTipoL = 2;  aNombre2 = "INV_CUEN_"; |FINSI;
     |SI aNombre1 = "Balance de comprobacion (sumas y saldos)"; nTipoL = 3;  aNombre2 = "BAL_SUMS_"; |FINSI;
     |SI aNombre1 = "Inventario";                               nTipoL = 4;  aNombre2 = "INVENTAR_"; |FINSI;
     |SI aNombre1 = "Balances";                                 nTipoL = 5;  aNombre2 = "BALANCES_"; |FINSI;
     |SI aNombre1 = "Memoria";                                  nTipoL = 6;  aNombre2 = "MEMORIA_";  |FINSI;
     |SI aNombre1 = "Mayor";                                    nTipoL = 7;  aNombre2 = "MAYOR_";    |FINSI;
     |SI aNombre1 = "Libro de Perdidas y Ganancias";            nTipoL = 8;  aNombre2 = "PER_GAN_";  |FINSI;
     |SI aNombre1 = "IVA";                                      nTipoL = 9;  aNombre2 = "IVA_";      |FINSI;
     |SI aNombre1 = "Facturas Emitidas";                        nTipoL = 10; aNombre2 = "FAC_EMIT_"; |FINSI;
     |SI aNombre1 = "Facturas Recibidas";                       nTipoL = 11; aNombre2 = "FAC_RECI_"; |FINSI;
     |SI aNombre1 = "Detalle del Diario";                       nTipoL = 12; aNombre2 = "DET_DIA_";  |FINSI;
     |SI aNombre1 = "Registro de Acciones Nominativas";         nTipoL = 13; aNombre2 = "ACCIONES_"; |FINSI;
     |SI aNombre1 = "Registro de Socios";                       nTipoL = 14; aNombre2 = "SOCIOS_";   |FINSI;
     |SI aNombre1 = "Libro de Actas";                           nTipoL = 15; aNombre2 = "ACTASCON_"; |FINSI;
     |SI aNombre1 = "Libro de Detalle de Actas";                nTipoL = 16; aNombre2 = "ACTASDET_"; |FINSI;
     |SI aNombre1 = "Libro de Actas del Consejo";               nTipoL = 17; aNombre2 = "ACTALCON_"; |FINSI;
     |SI aNombre1 = "Libro de Detalle Acta del Consejo";        nTipoL = 18; aNombre2 = "ACTACODE_"; |FINSI;
     |SI aNombre1 = "Libro-registro de Contratos del Socio Unico con la Sociedad Unipersonal"; nTipoL = 19; aNombre2 = "SOCUNICO_"; |FINSI;
     |SI aNombre1 = "Otros";                                    nTipoL = 20; aNombre2 = "OTROS_";    |FINSI;
|FPRC;

|PROCESO FicLibrosNom;

     |QBF aNombre2;
     nTipoL = 0; aNombre1 = "";

     |SI aNombre2 = "DIARIO_";   aNombre1 = "Diario";                                     nTipoL = 1;  |FINSI;
     |SI aNombre2 = "INV_CUEN_"; aNombre1 = "Inventario y Cuentas Anuales";               nTipoL = 2;  |FINSI;
     |SI aNombre2 = "BAL_SUMS_"; aNombre1 = "Balance de comprobacion (sumas y saldos)";   nTipoL = 3;  |FINSI;
     |SI aNombre2 = "INVENTAR_"; aNombre1 = "Inventario";                                 nTipoL = 4;  |FINSI;
     |SI aNombre2 = "BALANCES_"; aNombre1 = "Balances";                                   nTipoL = 5;  |FINSI;
     |SI aNombre2 = "MEMORIA_";  aNombre1 = "Memoria";                                    nTipoL = 6;  |FINSI;
     |SI aNombre2 = "MAYOR_";    aNombre1 = "Mayor";                                      nTipoL = 7;  |FINSI;
     |SI aNombre2 = "PER_GAN_";  aNombre1 = "Libro de Perdidas y Ganancias";              nTipoL = 8;  |FINSI;
     |SI aNombre2 = "IVA_";      aNombre1 = "IVA";                                        nTipoL = 9;  |FINSI;
     |SI aNombre2 = "FAC_EMIT_"; aNombre1 = "Facturas Emitidas";                          nTipoL = 10; |FINSI;
     |SI aNombre2 = "FAC_RECI_"; aNombre1 = "Facturas Recibidas";                         nTipoL = 11; |FINSI;
     |SI aNombre2 = "DET_DIA_";  aNombre1 = "Detalle del Diario";                         nTipoL = 12; |FINSI;
     |SI aNombre2 = "ACCIONES_"; aNombre1 = "Registro de Acciones Nominativas";           nTipoL = 13; |FINSI;
     |SI aNombre2 = "SOCIOS_";   aNombre1 = "Registro de Socios";                         nTipoL = 14; |FINSI;
     |SI aNombre2 = "ACTASCON_"; aNombre1 = "Libro de Actas";                             nTipoL = 15; |FINSI;
     |SI aNombre2 = "ACTASDET_"; aNombre1 = "Libro de Detalle de Actas";                  nTipoL = 16; |FINSI;
     |SI aNombre2 = "ACTALCON_"; aNombre1 = "Libro de Actas del Consejo";                 nTipoL = 17; |FINSI;
     |SI aNombre2 = "ACTACODE_"; aNombre1 = "Libro de Detalle Acta del Consejo";          nTipoL = 18; |FINSI;
     |SI aNombre2 = "SOCUNICO_"; aNombre1 = "Libro-registro de Contratos del Socio Unico con la Sociedad Unipersonal"; nTipoL = 19; |FINSI;
     |SI aNombre2 = "OTROS_";    aNombre1 = "Otros";                                      nTipoL = 20; |FINSI;
|FPRC;

|PROCESO CalFecLeg;
     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = eaLegEmp;
     |LEE 041#agifigen.=;
     |CIERRA #agifigen;

     fFecha1 = fec1;
     |SI fFecha1 < #agifigen#93; fFecha1 = #agifigen#93; |FINSI;

     fFecha2 = fec2;
     |SI fFecha2 > #agifigen#94; |Y #agifigen#94 > "01.01.1000"; fFecha2 = #agifigen#94; |FINSI;

     nNume1  = fFecha1;
     nNume1  = nNume1 - 1;
     fFecha3 = nNume1;
|FPRC;
