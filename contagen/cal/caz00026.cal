|FICHEROS;
 caz00026 #0;
 camw0005 #5;

 canempre #30;
 :/modelos/def/dsmom040 #40;
 :/modelos/def/dsmom041 #41;
 :/modelos/def/dsmom042 #42;
 :/modelos/def/dsmom043 #43;
 :/modelos/def/dsmom044 #44;
 :/modelos/def/dsmom045 #45;
 :/modelos/def/dsmom046 #46;
 :/modelos/def/dsmom049 #49;

 camancen #10;
 camandep #11;
 camansde #12;
 catalm01 #13;
 anm00014 #14;
 anm00015 #15;
 cafinanc #16;
 cafinanl #17;
 caclipro #18;
 caarm001 #19;
 caarm002 #20;
 carbum01 #21;

 &regisnif@ #709;
 :/basica/def/agim0003  #710;
 :/integral/def/dsam0103 #711;

 referel@ #998;
 referen@ #999;
|FIN;

|VARIABLES;
     aAlfa             = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aAlfa3            = "";
     nPara1            = 0;

     nInkey            = 0;
     nDEmp             = 0;
     nHEmp             = 0;
     nSw               = 0;
     nSinDatos         = 0;
     aPath             = "";
     aFich             = "";
     aOrigen           = "";
     aDestino          = "";
     aFichero          = "";
     aIPRemoto         = "";
     aPathUn           = "";
     aPathQunO         = "";
     aPathQunD         = "";
     aPathEmp          = "";
     aPathE00          = "";
     aMas              = "";
     aNomDef           = "";
     aNomDefL          = "";
     aDef              = "";

     aDef998           = "";
     aDef999           = "";

     nSwError          = 0;
     nEstado           = 0;
     nEstLin           = 0;
     nSwAlgun          = 0;
     nSwOp             = 0;
     nSwBOr            = 0;

     &enEmpresaV       = 0;
     &enPeriodoV       = 0;
     aQueQuiero        = "";
     aNumCampos        = "";
     nNumCampos        = 0;
     nNumCampoL        = 0;
     aDirTempo         = "";
     aUsuario          = "";
     aParam            = "";
     &enEmpArch        = 0;
     &enPerArch        = 0;
     &eaPathArc        = "";
     &eaUsuaArc        = "";
     &eaNomArch        = "";
     &enAnyArch        = 0;
     &eaNifArch        = "";
     &eaNomArchivo     = "";
     &efFecArch        = @;

     Existe = 0;
     nCanal = 0;
|FIN;

|INCLUYE dscont_i;

|| ********************************************************************
|| **** DATOS PANTALLA
|| ********************************************************************
|CALCULO PonBarra; |TIPO 0;

    nInkey = FSalida;
    |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        aAlfa1 = aAlfa1 % 280;
        #0Campo = aAlfa1;
        |PINTA #0Campo
    |FINSI;

     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     aAlfa2 = aAlfa1 % -101;
     |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
          #0Campo = aAlfa1 + "/";
          |PINTA #0Campo;
     |FINSI;

     Existe = 0;
     aAlfa1 = #0Campo; |QBF aAlfa1;
     aAlfa1 = aAlfa1 + "zexporcon.tgz";

    |XABRE "UB", aAlfa1, nCanal;
    |SI FSalida < 0;
        |XABRE "CUB", aAlfa1, nCanal;
    |FINSI;
    |SI FSalida ] 0; Existe = 1; |FINSI;
     |XCIERRA nCanal;
     |SI Existe = 1;
         |CONFI "    NExiste ya una Exportacion Anterior. Continuar S/N";
         |SI FSalida ! 0;
             |ERROR;
         |FINSI;
     |FINSI;
|FCAL;

|CALCULO defectos; |TIPO 7;
   #0#5  = enEmpresa;    |PINTA #0#5;
   #0#6  = enPeriodo;    |PINTA #0#6;
   #0#7  = eaNombreEmp;  |PINTA #0#7;
   #0#8  = enAny;        |PINTA #0#8;
   #0#23 = eaNifEmp;     |PINTA #0#23;
|FCAL;

|RUTINA infA2;
   #30#2 = nDEmp;
   #30#3 = 0;
|FRUT;

|RUTINA supA2;
   #30#2 = nHEmp;
   #30#3 = 9;
|FRUT;


|CALCULO LeeEmpresa; |TIPO 0;
  nInkey = FSalida;

  |SI nInkey = 10;
     nDEmp = 0;
     nHEmp = 99999;
     |ABRE #30;
     #30#2 = #0#5;
     |CONSULTA_F_CLAVE #1#30,infA2,supA2;
     #0#5 = #30#2; |PINTA #0#5;
     #0#6 = #30#3; |PINTA #0#6;
     |CIERRA #30;
     |PTEC 802;
     |ACABA;
  |FINSI;

  |ABRE #30;
  #30#2 = #0#5;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0#5;
      |MENAV "     NO Existe la empresa Contable";
      |ERROR;
  |SINO;
      #0#7  = #30#1;  |PINTA #0#7;
      #0#23 = #30#8;  |PINTA #0#23;
  |FINSI;
  |CIERRA #30;
|FCAL;

|CALCULO LeeEmpresaP; |TIPO 0;
  nInkey = FSalida;
  |SI nInkey = 2; |ACABA; |FINSI;

  |SI nInkey = 10;
     nDEmp = #0#5; nHEmp = #0#5;
     |ABRE #30;
     |CONSULTA_F_CLAVE #1#30,infA2,supA2;
     #0#6 = #30#3; |PINTA #0#6;
     |CIERRA #30;
  |FINSI;

  |ABRE #30;
  #30#2 = #0#5;
  #30#3 = #0#6;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la Empresa Contable";
      |ERROR;
  |SINO;
      #0#7   = #30#1;  |PINTA #0#7;
      #0#8   = #30#26; |PINTA #0#8;
      #0#23  = #30#8;  |PINTA #0#23;
  |FINSI;
  |CIERRA #30;
|FCAL;


|| ********************************************************************

|PROCESO CargoRefer;
     aDef998 = "";
     aDef999 = "";
     nSwError = 0;

     aMas   = aDef + aNomDef; aDef999 = aMas;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
          aDef999  = "";
          nSwError = 1;
          |ACABA;
     |FINSI;
     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |PATH_DAT #999 aPath;

     |SI aNomDefL ! "";
         aMas   = aDef + aNomDefL; aDef998 = aMas;
         |CARGA_DEF aMas, referel@;
         |SI FSalida ! 0;
             aDef998 = "";
             |HAZ DescargoRefer;
             nSwError = 1;
             |ACABA;
         |FINSI;
         aQueQuiero = "|NC";
         aNumCampos = #referel@#aQueQuiero#;
         nNumCampoL = aNumCampos;
         nNumCampoL = nNumCampoL - 1;
         |PATH_DAT #998 aPath;
     |FINSI;
|FPRC;

|PROCESO DescargoRefer;
     |SI aDef998 ! ""; |DESCARGA_DEF #998; aDef998 = "";|FINSI;
     |SI aDef999 ! ""; |DESCARGA_DEF #999; aDef999 = "";|FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////////
|| ... Cliente / Proveedores NIFS
|PROCESO LeeCliPro;
  eaCodNif = #18#9; |QBF eaCodNif;
  |SI eaCodNif = ""; |ACABA; |FINSI;

  |ABRE #709;
  #709#0 = eaCodNif;
  |LEE 041#709=;
  |SI FSalida ! 0;
      |CIERRA #709;
      |ACABA;
  |FINSI;
  |CIERRA #709;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #709nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE LeeCliPro;
 #18#1;
 ;
 " ", "            ";
 "z", "zzzzzzzzzzzz";
 ;
 NULL, LeeCliPro;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Contratos de Arrendamiento
|PROCESO LeeArm002;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #998nPara1 = #20nPara1;
 |SIGUE;
 |GRABA 000#998n;
|FPRC;

|DEFBUCLE LeeArm002;
 #20#1;
 ;
 #19#0, #19#1, 001;
 #19#0, #19#1, 999;
 ;
 NULL, LeeArm002;
|FIN;

|PROCESO LeeArm001;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #19nPara1;
 |SIGUE;
 |GRABA 000#999n;

 |ABRE #998;
 |BUCLE LeeArm002;
 |CIERRA #998;
|FPRC;

|DEFBUCLE LeeArm001;
 #19#1;
 ;
 enEmpresa, 00001;
 enEmpresa, 99999;
 ;
 NULL, LeeArm001;
|FIN;

|| ///////////////////////////////////////////////////

|| ... Financieras
|PROCESO LeeFinanl;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #998nPara1 = #17nPara1;
 |SIGUE;
 |GRABA 000#998n;
|FPRC;

|DEFBUCLE LeeFinanl;
 #17#1;
 ;
 #16#0, #16#1, 001;
 #16#0, #16#1, 999;
 ;
 NULL, LeeFinanl;
|FIN;

|PROCESO LeeFinanc;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #16nPara1;
 |SIGUE;
 |GRABA 000#999n;

 |ABRE #998;
 |BUCLE LeeFinanl;
 |CIERRA #998;
|FPRC;

|DEFBUCLE LeeFinanc;
 #16#1;
 ;
 enEmpresa, 00001;
 enEmpresa, 99999;
 ;
 NULL, LeeFinanc;
|FIN;


|| ... Reparto contable de Elementos
|PROCESO Leeanm015;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #998nPara1 = #15nPara1;
 |SIGUE;
 |GRABA 000#998n;
|FPRC;

|DEFBUCLE Leeanm015;
 #15#1;
 ;
 #14#0, #14#1, #14#2, 001;
 #14#0, #14#1, #14#2, 999;
 ;
 NULL, Leeanm015;
|FIN;

|PROCESO  Leeanm14;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #14nPara1;
 |SIGUE;
 |GRABA 000#999n;

 |ABRE #998;
 |BUCLE Leeanm015;
 |CIERRA #998;
|FPRC;

|DEFBUCLE  Leeanm14;
 #14#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 ;
 NULL,  Leeanm14;
|FIN;

|| ... Talones
|PROCESO LeeTalm01;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #13nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE LeeTalm01;
 #13#1;
 ;
 enEmpresa, 000001;
 enEmpresa, 999999;
 ;
 NULL, LeeTalm01;
|FIN;

|| ... Rebu
|PROCESO LeeRbum01;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #21nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE LeeRbum01;
 #21#1;
 ;
 enEmpresa, 000001;
 enEmpresa, 999999;
 ;
 NULL, LeeRbum01;
|FIN;

|| ///////////////////////////////////////////////////

|| ... Subdepartamentos
|PROCESO LeeMansde;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #12nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE LeeMansde;
 #12#1;
 ;
 enEmpresa, "  ", "   ";
 enEmpresa, "zz", "zzz";
 ;
 NULL, LeeMansde;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Departamentos
|PROCESO LeeMandep;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #11nPara1;
 |SIGUE;
 |GRABA 000#11n;
|FPRC;

|DEFBUCLE LeeMandep;
 #11#1;
 ;
 enEmpresa, "  ";
 enEmpresa, "zz";
 ;
 NULL, LeeMandep;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Centros de Trabajo
|PROCESO LeeMancen;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #10nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE LeeMancen;
 #10#1;
 ;
 enEmpresa, 00;
 enEmpresa, 99;
 ;
 NULL, LeeMancen;
|FIN;
|| ///////////////////////////////////////////////////

|PROCESO LosFich000000;
  |PATH_DAT #10 aPathE00;
  |PATH_DAT #11 aPathE00;
  |PATH_DAT #12 aPathE00;
  |PATH_DAT #13 aPathE00;
  |PATH_DAT #14 aPathE00;
  |PATH_DAT #15 aPathE00;
  |PATH_DAT #16 aPathE00;
  |PATH_DAT #17 aPathE00;
  |PATH_DAT #18 aPathEmp;  || datos de clientes / proveedores
  |PATH_DAT #19 aPathE00;
  |PATH_DAT #20 aPathE00;
  |PATH_DAT #21 aPathE00;

  |DBASE aBase;
  aDef = aBase + "def/";

  aNomDefL = "";
  aNomDef  = "camancen";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeMancen;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "camandep";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeMandep;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "camansde";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeMansde;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "catalm01";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeTalm01;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "anm00015";
  aNomDef  = "anm00014";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE Leeanm14;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "cafinanl";
  aNomDef  = "cafinanc";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeFinanc;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "caarm002";
  aNomDef  = "caarm001";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeArm001;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "carbum01";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #999;
      |BUCLE LeeRbum01;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

  || ... Proceso de los Nif
  aDef     = "";
  aNomDefL = "";
  aNomDef  = "";
  |SI HayAcceso = 1;
      enSwDeDonde = 1;
      |REFERENCIA_DEF regisnif@, #711;
      aDef =  aPAcceso + "def/"; aNomDef = "dsam0103";
  |SINO;
      |SI Haybasica = 1;
          enSwDeDonde = 0;
          |REFERENCIA_DEF regisnif@, #710;
          aDef =  aPGenral + "def/"; aNomDef = "agim0003";
      |FINSI;
  |FINSI;
  |SI aDef = ""; |ACABA; |FINSI; ||no hay ni integrada ni basica
  |HAZ CargoRefer;
  |SI nSwError = 0;
      aAlfa1 = "datonifs";
      |NOME_DAT #999 aAlfa1;
      |ABRE #999;
      |BUCLE LeeCliPro;
      |CIERRA #999;
      |HAZ DescargoRefer;
  |FINSI;

|FPRC;

|PROCESO DatosContagen;

  aAlfa1 = enEmpresa; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
  aAlfa2 = enPeriodo; |QBF aAlfa2; aAlfa2 = ("0" + aAlfa2) % -101;

  |DFICB aBase;
  aPathEmp = aBase + aAlfa1 + aAlfa2 + "/";
  aPathE00 = aBase + "000000/";

  aPathQunO = aPathEmp;
  aPathQunD = aPathUn;
  nSwBOr    = 0;
  |HAZ QuitaUnico;
  |HAZ CopiaLis;

  aFich    = "zlcontagen"
  aFichero  = aPath + aFich + ".tar .";

  aOrigen = aPathUn;
  |ATAR aFichero, aOrigen;

  aFichero  = aPath + aFich + ".tar";
  |COMPRIME aFichero;

  |FBORRA aFichero;

  |HAZ LosFich000000;
  |SI aParam ! "ARCHIVAR";
      |MENAV "    PASADOS FICHEROS DE CONTABILIDAD";
  |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////////
|| ************************* Amortizaciones

|| ... Linea de Regularizacion por Prorrata
|PROCESO Leedsmom049;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #49nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE Leedsmom049;
 #49#1;
 ;
 enEmpresa, "        ", 00, 01;
 enEmpresa, "zzzzzzzz", 99, 99;
 ;
 NULL, Leedsmom049;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Historico Fin Leasing
|PROCESO Leedsmom046;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #46nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE Leedsmom046;
 #46#1;
 ;
 enEmpresa, "        ", 00, 00, "   ";
 enEmpresa, "zzzzzzzz", 99, 99, "zzz";
 ;
 NULL, Leedsmom046;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Historico Fin Leasing
|PROCESO Leedsmom045;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #45nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE Leedsmom045;
 #45#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 ;
 NULL, Leedsmom045;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Historico Activar Elementos
|PROCESO Leedsmom044;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #44nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE Leedsmom044;
 #44#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 ;
 NULL, Leedsmom044;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Ventas
|PROCESO Leedsmom043;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #43nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE Leedsmom043;
 #43#1;
 ;
 enEmpresa, "        ", 00, 0001;
 enEmpresa, "zzzzzzzz", 99, 9999;
 ;
 NULL, Leedsmom043;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Elementos
|PROCESO Leedsmom042;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #998nPara1 = #42nPara1;
 |SIGUE;
 |GRABA 000#998n;
|FPRC;

|DEFBUCLE Leedsmom042;
 #42#1;
 ;
 #41#0, #41#2, #41#3, 001;
 #41#0, #41#2, #41#3, 999;
 ;
 NULL, Leedsmom042;
|FIN;

|PROCESO Leedsmom041;

  |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
        #999nPara1 = #41nPara1;
  |SIGUE;
  |GRABA 000#999n;

  |ABRE #998;
  |BUCLE Leedsmom042;
  |CIERRA #998;
|FPRC;

|DEFBUCLE Leedsmom041;
 #41#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 ;
 NULL, Leedsmom041;
|FIN;

|| ... Grupos
|PROCESO Leedsmom040;
 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #999nPara1 = #40nPara1;
 |SIGUE;
 |GRABA 000#999n;
|FPRC;

|DEFBUCLE Leedsmom040;
 #40#1;
 ;
 enEmpresa, 0001;
 enEmpresa, 9999;
 ;
 NULL, Leedsmom040;
|FIN;

|| ----------------------------------------------------------------


|PROCESO DatosAmortiza;

     |SI Haymodelo = 0;
         |MENAV "    Error.! No Existe Aplicacion MODELOS. No pasa Amortizaciones";
         |ACABA;
     |FINSI;

     aAlfa1 = aPModelo + "fich/";
     |PATH_DAT #40 aAlfa1;
     |PATH_DAT #41 aAlfa1;
     |PATH_DAT #42 aAlfa1;
     |PATH_DAT #43 aAlfa1;
     |PATH_DAT #44 aAlfa1;
     |PATH_DAT #45 aAlfa1;
     |PATH_DAT #46 aAlfa1;
     |PATH_DAT #49 aAlfa1;

     aDef = aPModelo + "def/";

|| ... Paso grupos por si ha creado alguno.
     aNomDefL = "";
     aNomDef  = "dsmom040";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #999;
         |BUCLE Leedsmom040;
         |CIERRA #999;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Elementos Amortizables

     aNomDef  = "dsmom041";
     aNomDefL = "dsmom042";
     |HAZ CargoRefer;
     |SI nSwError ! 0;
          |MENAV "    Error Cargado Fichero de Elementos de Amortizaciones. Proceso Interrumpido";
          |ACABA;
     |FINSI;

     |ABRE #999;
     |BUCLE Leedsmom041;
     |CIERRA #999;
     |HAZ DescargoRefer;

|| ... Paso Ventas elementos
     aNomDefL = "";
     aNomDef  = "dsmom043";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #999;
         |BUCLE Leedsmom043;
         |CIERRA #999;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Historico activar
     aNomDefL = "";
     aNomDef  = "dsmom044";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #999;
         |BUCLE Leedsmom044;
         |CIERRA #999;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Historico activar
     aNomDefL = "";
     aNomDef  = "dsmom045";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #999;
         |BUCLE Leedsmom045;
         |CIERRA #999;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Reparto Elemento Actividad
     aNomDefL = "";
     aNomDef  = "dsmom046";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #999;
         |BUCLE Leedsmom046;
         |CIERRA #999;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Lineas de Regularizacion por Prorrata
     aNomDefL = "";
     aNomDef  = "dsmom049";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #999;
         |BUCLE Leedsmom049;
         |CIERRA #999;
         |HAZ DescargoRefer;
     |FINSI;

     |MENAV "    PASADOS FICHEROS DE AMORTIZACIONES";
|FPRC;

|| ***********************************************************************

|PROCESO PaseE12;  |TIPO 12;
  |SI #0#11 = "NO"; |ACABA; |FINSI;

  |QBF aUsuario;

  cod1 = #0#5;
  cod2 = #0#6;
  emEmp = 1;  || Sin mensaje
  |HAZ leelo;
  |SI swerror ! 0;
      |MENAV "    NO EXISTEN DATOS DE LA EMPRESA ELEGIDA. Proceso interrumpido";
      |ACABA;
  |FINSI;

  |HAZ PreparaDir;

  |HAZ DirAplicSt;
  |SI #0#9 ! "A";
      |HAZ DatosContagen;
  |FINSI;
  |SI #0#9 ! "D";
      |HAZ DatosAmortiza;
  |FINSI;

  |HAZ GraboAux5;

  aPathQunO = aPath;  || Para quitar los dat
  aPathQunD = aPath;
  nSwBOr    = 1;
  |HAZ QuitaUnico;

  |SI aParam ! "ARCHIVAR";
      aAlfa1 = "zexporcon";
  |SINO;
      aAlfa1 = eaNomArchivo;
  |FINSI;

  |DFICB aBase;
  aFich     = aAlfa1;
  aFichero  = aBase + aFich + ".tar .";

  aOrigen = aPath;
  |ATAR aFichero, aOrigen;

  aFichero  = aBase + aFich + ".tar";
  |COMPRIME aFichero;
  |FBORRA aFichero;

  aDestino = #0#12;  |QBF aDestino;
  aDestino = aDestino + aFich + ".tgz";
  aOrigen  = aBase + aFich + ".tgz";

  |SI aParam ! "ARCHIVAR";
      aIPRemoto = "";
      |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
      |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
      |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
      |FINSI;
  |SINO;
      |COPIA_FICHERO aOrigen, aDestino;
  |FINSI;
  |FBORRA aOrigen;

  |HAZ PreparaDir;  || Para borrar y liberar el espacio
|FPRC;

|PROCESO PreparaDir;  || Borra directorio recdatos y quidatos

  |DBASE aBase;
  aPath = aBase + "recdatos/" + aUsuario;

  |MKDIR aPath;
  aPath  = aPath + "/";
  aDirTempo  = aPath + "*";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

         |FBORRA aDirTempo;
         |_SDIR aDirTempo;
  |SIGUE;

  |DBASE aBase;
  aPathUn = aBase + "quidatos/" + aUsuario;
  |MKDIR aPathUn;
  aPathUn    = aPathUn + "/";
  aDirTempo  = aPathUn + "*";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

         |FBORRA aDirTempo;
         |_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|PROCESO QuitaUnico;  || copia los dat a ddd, ddx a xxx y ixx a iii (Fichero Unico)

  aDirTempo  = aPathQunO + "*.dat";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

             aFichero  = aDirTempo - aPathQunO;
             aFichero  = aFichero - ".dat";

             aOrigen  = aPathQunO + aFichero + ".dat";
             aDestino = aPathQunD + aFichero + ".ddd";
             |COPIA_FICHERO aOrigen, aDestino;
             |SI nSwBOr = 1;  |FBORRA aOrigen; |FINSI;

             aOrigen  = aPathQunO + aFichero + ".ixx";
             aDestino = aPathQunD  + aFichero + ".iii";
             |COPIA_FICHERO aOrigen, aDestino;
             |SI nSwBOr = 1;  |FBORRA aOrigen; |FINSI;

             aOrigen  = aPathQunO + aFichero + ".ddx";
             aDestino = aPathQunD + aFichero + ".xxx";
             |COPIA_FICHERO aOrigen, aDestino;
             |SI nSwBOr = 1;  |FBORRA aOrigen; |FINSI;

          |_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|PROCESO CopiaLis;
  aDirTempo  = aPathEmp + "lis*.*";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;
          aFichero  = aDirTempo - aPathEmp;
          aOrigen  = aDirTempo;
          aDestino = aPathUn  + aFichero;
          |COPIA_FICHERO aOrigen, aDestino;
          |_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|PROCESO GraboAux5;
  |PATH_DAT #5 aPath;
  |ABRE #5;
  #5#12 = "E";
  |LEE 001#5=;
  |SI FSalida ! 0;
      |DDEFECTO #5;
      #5#12 = "E";
      |GRABA 020#5c;
  |FINSI;
  #5#0  = #0#5;
  #5#1  = #0#6;
  #5#2  = #0#7;
  #5#3  = #0#8;
  #5#4  = #0#20;
  #5#5  = dig3;
  #5#6  = dig4;
  #5#7  = dig5;
  #5#8  = dig6;
  #5#9  = dig7;
  #5#10 = dig8;
  #5#11 = dig9;
  #5#12 = "E";
  #5#13 = "zlcontagen";
  #5#14 = #0#23;
  #5#15 = #0#22;
  #5#16 = fec3;
  |GRABA 020#5a;
  |CIERRA #5;

  |SI #0#22 = "S";
      |ABRE #30;
      #30#2 = #0#5;
      #30#3 = #0#6;
      |LEE 101#30=;
      |SI FSalida = 0;
          #30#34 = fec2;
          |GRABA 020#30a;
      |FINSI;
      |LIBERA #30;
      |CIERRA #30;
  |FINSI;
|FPRC;


|PROGRAMA;
   aParam = PARAMETRO; |QBF aParam;

   |SI aParam = "ARCHIVAR";
       aUsuario = eaUsuaArc;
       |DDEFECTO #0;
       #0#5  = enEmpArch;
       #0#6  = enPerArch;
       #0#7  = eaNomArch;
       #0#8  = enAnyArch;
       #0#23 = eaNifArch;
       #0#9  = "D";
       #0#11 = "SI";
       #0#12 = eaPathArc;
       #0#20 = efFecArch;
       |HAZ PaseE12;
   |SINO;
       aUsuario = Usuario % 108;
       |MANTE #0;
   |FINSI;
|FPRO;
