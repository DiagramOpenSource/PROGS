|FICHEROS;
    cataly03 #0;
    catalm01 #1;
    catalw01 #4;

    canempre #30;
    caselem1 #998;
|FIN;

|VARIABLES;
    &entrada = 1;
    informe = "cataly03";

    nNume1  = 0;
    nNume2  = 0;
    nModo   = 0;
    nSw     = 0;
    banco   = "";
    dbanc   = 0;
    sw      = 0;

 {-1}elegir = "";
    elegir1 = "2400";
    elegir2 = "1";
    elegir3 = " Elija opcion: ";
    elegir4 = "IP";
    elegir5 = " Impresora ";
    elegir6 = " Pantalla ";
    posic   = 0;
    mas     = 0;
    lin_pan = 0;
    alfa1   = "";
    &vto1   = @;
    &vto2   = @;
    &vto3   = @;
    &vto4   = @;
    &imp1   = 0;
    &imp2   = 0;
    &imp3   = 0;
    &imp4   = 0;
    &imp5   = 0;
    &tot1   = 0;
    &tot2   = 0;
    &tot3   = 0;
    &tot4   = 0;
    &tot5   = 0;
    &nomb   = "";
    &ctab   = "";

    cc      = 0;
    tbanco  = 0;
    vto     = @;
    swfin   = 0;
    sw_act  = 0;
|FIN;

|INCLUYE dscont_i;

|| ************************* calculos pantalla ******************************

|PROCESO fechas;
   cc = Campo - 1;
   |SI #0Campo < #0cc;
       |MENAV " Error en la introduccion ";
       |ERROR;
       |ACABA;
   |FINSI;
|FPRC;

|PROCESO juntos; |TIPO 0;
 |SI sw_act = 0;
     #0#10 = #0Campo;
     |PINTA #0#10;
 |FINSI;
|FPRC;

|CALCULO cuenta; |TIPO 0;
     eaCuenta = #0Campo;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #0Campo = eaCuenta;
     |PINTA #0Campo;
|FCAL;

|CALCULO nodepar; |TIPO 7;
   |C_M #0#20, 1, eaDepar;
   |C_M #0#21, 1, eaDepar;
|FCAL;

|| *************************************************************************

|PROCESO detalles;       || lee el banco y la cuenta
    ctab = banco;
    nomb = "";
    imp1 = 0;
    imp2 = 0;
    imp3 = 0;
    imp4 = 0;
    imp5 = 0;
    nomb = #1#22;
|FPRC;

|PROCESO impre1;
  |SI #0#10 ! "A";
      |SI #0#10 ! #1#10;  |ACABA;  |FINSI;  || impresa carta
  |FINSI;
  |SI #0#17 ! "A";
      |SI #0#17 ! #1#12;  |ACABA;  |FINSI;  || impreso talon
  |FINSI;
  |SI #0#11 ! "A";
      |SI #0#11 ! #1#07;  |ACABA;  |FINSI;  || emision
  |FINSI;
  |SI #0#12 ! "A";
      |SI #0#12 ! #1#08;  |ACABA;  |FINSI;  || vencimiento
  |FINSI;

|SI sw = 0;
        banco = #1#3;
        dbanc = #1#4;
        |HAZ detalles;
        sw = 1;
|FINSI;
|SI banco ! #1#3;
    |PRINT;                   || imprime total banco anterior
    tot1 = tot1 + imp1;
    tot2 = tot2 + imp2;
    tot3 = tot3 + imp3;
    tot4 = tot4 + imp4;
    tot5 = tot5 + imp5;
        banco = #1#3;
        dbanc = #1#4;
        |HAZ detalles;
|FINSI;

|| ============ Calculo del importe a columna correcta

|SI #1#6 [ vto1;
    imp1 = imp1 + #1#9;
    |VETE sumado;
|FINSI;

|SI #1#6 > vto1;|Y #1#6 [ vto2;
    imp2 = imp2 + #1#9;
    |VETE sumado;
|FINSI;

|SI #1#6 > vto2;|Y #1#6 [ vto3;
    imp3 = imp3 + #1#9;
    |VETE sumado;
|FINSI;

|SI #1#6 > vto3;|Y #1#6 [ vto4;
    imp4 = imp4 + #1#9;
    |VETE sumado;
|FINSI;

    imp5 = imp5 + #1#9;

|ET sumado;
|FPRC;

|DEFBUCLE impre;
 #1#2;
 1, 5, 16, 20; || ..... ordenado por banco+vto, selec. prov y emision, tipo rec
 enEmpresa, #0#2, #0#4, #0#0, #0#6, #0#8, #0#18, #0#20;
 enEmpresa, #0#3, #0#5, #0#1, #0#7, #0#9, #0#19, #0#21;
 e;
 NULL, impre1;
|FIN;

|PROCESO impresora;
    |INFOR informe;

    |BUCLE impre;
    |SI sw = 1;
        |PRINT;
        tot1 = tot1 + imp1;
        tot2 = tot2 + imp2;
        tot3 = tot3 + imp3;
        tot4 = tot4 + imp4;
        tot5 = tot5 + imp5;
    |FINSI;
    |PIEINF;
    |FININF;
|FPRC;


|| ********************** PANTALLA

|PROCESO pcorrete;
  |C_P #4#0, 1,0902;
  |C_P #4#1, 1,0915;
  |C_P #4#16,1,0933;
  |C_P #4#17,1,0945;
  |C_P #4#18,1,0957;
  |C_P #4#19,1,0969;
|FPRC;

|PROCESO correte;
  |C_P #4#0,0,posic; posic=posic+mas;   |C_P #4#0,1,posic;
  |C_P #4#1,0,posic; posic=posic+mas;   |C_P #4#1,1,posic;
  |C_P #4#16,0,posic; posic=posic+mas;   |C_P #4#16,1,posic;
  |C_P #4#17,0,posic; posic=posic+mas;   |C_P #4#17,1,posic;
  |C_P #4#18,0,posic; posic=posic+mas;   |C_P #4#18,1,posic;
  |C_P #4#19,0,posic; posic=posic+mas;   |C_P #4#19,1,posic;
  |C_P #4#20,0,posic; posic=posic+mas;   |C_P #4#20,1,posic;
|FPRC;

|PROCESO pant4;
  |PINPA #1#4;
      #4#12  = vto1;    || 1§ vto
      #4#13  = vto2;    || 2§ vto
      #4#14  = vto3;    || 3§ vto
      #4#15  = vto4;    || 4§ vto
  |PINTA #4#12;
  |PINTA #4#13;
  |PINTA #4#14;
  |PINTA #4#15;
|FPRC;

|PROCESO empieza;
  |HAZ pant4;
  mas = lin_pan * -100;
  lin_pan = 0;
  |HAZ pcorrete;
|FPRC;


|PROCESO panta1;

  |SI #0#10 ! "A";
      |SI #0#10 ! #1#10;  |ACABA;  |FINSI;  || impresa
  |FINSI;
  |SI #0#17 ! "A";
      |SI #0#17 ! #1#12;  |ACABA;  |FINSI;  || impreso talon
  |FINSI;
  |SI #0#11 ! "A";
      |SI #0#11 ! #1#07;  |ACABA;  |FINSI;  || emision
  |FINSI;
  |SI #0#12 ! "A";
      |SI #0#12 ! #1#08;  |ACABA;  |FINSI;  || vencimiento
  |FINSI;

|SI sw = 0;
        banco = #1#3;
        dbanc = #1#4;
        |HAZ detalles;
        sw = 1;
|FINSI;
|SI banco ! #1#3;
    tot1 = tot1 + imp1;
    tot2 = tot2 + imp2;
    tot3 = tot3 + imp3;
    tot4 = tot4 + imp4;
    tot5 = tot5 + imp5;
    |HAZ imppan;                   || imprime total banco anterior
        banco = #1#3;
        dbanc = #1#4;
        |HAZ detalles;
|FINSI;

|| ============ Calculo del importe a la linea correcta

|SI #1#6 [ vto1;
    imp1 = imp1 + #1#9;
    |VETE sumad1;
|FINSI;

|SI #1#6 > vto1;|Y #1#6 [ vto2;
    imp2 = imp2 + #1#9;
    |VETE sumad1;
|FINSI;

|SI #1#6 > vto2;|Y #1#6 [ vto3;
    imp3 = imp3 + #1#9;
    |VETE sumad1;
|FINSI;

|SI #1#6 > vto3;|Y #1#6 [ vto4;
    imp4 = imp4 + #1#9;
    |VETE sumad1;
|FINSI;

    imp5 = imp5 + #1#9;

|ET sumad1;

|FPRC;

|PROCESO imppan;

    lin_pan = lin_pan + 1;
    #4#0   = ctab;    || cuenta banco
    #4#1   = nomb;    || nombre banco
    #4#12  = vto1;    || 1§ vto
    #4#13  = vto2;    || 2§ vto
    #4#14  = vto3;    || 3§ vto
    #4#15  = vto4;    || 4§ vto
    #4#16  = imp1;    || importe 1
    #4#17  = imp2;    || importe 2
    #4#18  = imp3;    || importe 3
    #4#19  = imp4;    || importe 4
    #4#20  = imp5;    || importe posterior
    #4#21  = tot1;    || total 1
    #4#22  = tot2;    || total 2
    #4#23  = tot3;    || total 3
    #4#24  = tot4;    || total 4
    #4#25 = tot5;    || total posterior

    |PINDA #1#4;
    |C_P #4#0,0,nNume1; |C_P #4#1,0,nNume2;
    |PINTA nNume1, #4#0; |PINTA nNume2, #4#1;

    |SI swfin = 0;
        |SI lin_pan < 11;
            mas = 100;
        |SINO;
            mas = -1000;
            lin_pan = 0;
            |PAUSA;
            |HAZ pant4; || PINPA #0#4;
        |FINSI;
        |HAZ correte;
    |FINSI;
|FPRC;

|DEFBUCLE panta;
 #1#2;
 1, 5, 16,20; || ..... ordenado por banco+vto, selec. prov y emision
 enEmpresa, #0#2, #0#4, #0#0, #0#6, #0#8, #0#18, #0#20;
 enEmpresa, #0#3, #0#5, #0#1, #0#7, #0#9, #0#19, #0#21;
 e;
 NULL, panta1;
|FIN;

|PROCESO pantalla;
 |SI nSw = 1;
     |HAZ empieza;
 |SINO;
     |HAZ pant4;
     nSw = 1;
 |FINSI;

 |BUCLE panta;
 |SI sw = 1;
     swfin = 1
     tot1 = tot1 + imp1;
     tot2 = tot2 + imp2;
     tot3 = tot3 + imp3;
     tot4 = tot4 + imp4;
     tot5 = tot5 + imp5;
     |HAZ imppan;
     |PAUSA;
 |FINSI;
|FPRC;

|| -------------------------------------------------------------------------

|PROCESO HazTodo;
   #4#26 = enEmpresa;
   #4#27 = eaNombreEmp;
   #4#28 = "Informe Agenda Vtos. por Cuenta de Abono";
   #4#29 = "Cuenta Abono";

   |HAZ Borrar;
   |SI nModo = 1; |HAZ impresora; |FINSI;
   |SI nModo = 2; |HAZ pantalla; |FINSI;
|FPRC;

|PROCESO impre; |TIPO 3;

   vto1 = #0#13;
   vto2 = #0#14;
   vto3 = #0#15;
   vto4 = #0#16;

  |C_P #4#0,1,0902; |C_P #4#1,1,0915; |C_A #4#1,1,17;

  |HAZ DirAplicSt;
  |SI Haybasica = 1; |Y #0#21 = "zz"; #0#21 = "99"; |FINSI;

  |MENU elegir;
  nModo = FSalida;
  |SI nModo > 0;
      |SI nModo = 1;
          |IMPRE 0;
          |SI FSalida < 0; |ACABA; |FINSI;
      |FINSI;
      |SI #48#27 = "S";
          |HAZ MultiEmpresa;
      |SINO;
          |DFICE dirfich0; |QBF dirfich0;
          |HAZ HazTodo;
      |FINSI;
      |SI nModo = 1; |FINIMP; |FINSI;
  |FINSI;
|FPRC;
|| **********************************************************

|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
   |SUB_EJECUTA "caselemp";
   |NOME_DAT #998 eaFichsel;
   nSw = 0;
   |BUCLE MultiEmp0;
   |DELINDEX #998;
|FPRC;

|PROCESO Borrar;

    banco    = "";
    sw       = 0;
    tbanco   = 0;
    tot1     = 0;
    tot2     = 0;
    tot3     = 0;
    tot4     = 0;
    tot5     = 0;
    imp1     = 0;
    imp2     = 0;
    imp3     = 0;
    imp4     = 0;
    imp5     = 0;
    nomb     = "";
    ctab     = "";
|FPRC;
