|FICHEROS;
   caextrp7 #4;         || display extractos
   cacuenta #5;         || cuentas
   caextrp4 #6;         || display asientos completo
   camaasil #7;         || apuntes lins.
   caextras #8;         || fichero anot.extracontables
   caextral #9;         || anot.extracontables Lineas
   caexttip #10;        || Tipos anot.extracontables

   camaasic #11;
   calicont #31;
   imagen@  #999;
|FIN;

|VARIABLES;
   &enBEjer = 0;
   aFichero = "";
   aAlfa = "";
   alfa1 = "";
   alfa2 = "";
   alfa3 = "";
   alfa4 = "";
   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   fech1 = @;
   fech2 = @;
   fech3 = @;
   fech4 = @;
   FEstado = 0;
   inkey = 0;
   seleccio = 0;

   &d_abajo = 0;
   &h_abajo = 0;
   &s_abajo = 0;
   totallin = 0;
   lalinea = 0;
   nDebe   = 0;
   nHaber  = 0;
   nApunte = 0;
   aCuenta = "";
   informe = "caextrp7";

   &enDiario          = 0;
   &efFecha           = @;
   &enDocumento       = 0;
   &enDiarioDentro    = 0;
   &efFechaDentro     = @;
   &enDocumentoDentro = 0;
   &aFitxer = "";
   aMas = "";
   &enDi = 0;
   &efFe = @;
   &enDo = 0;
   &enAp = 0;
   &eaDes = "";
   &eaD = "";
   &eaS = "";
   &enDeb = 0;
   &enHar = 0;
   &enSal = 0;
   &enTD  = 0;
   &enTH  = 0;
   &enTS  = 0;
   &eaRef = "";
   nPrim  = 0;

   &enDnDIARIO   = 0;
   &enHnDIARIO   = 0;
   &efDFechas    = @;
   &efHFechas    = @;
   &enDDocume    = 0;
   &enHDocume    = 0;
   &enBorraAu    = 0;

   &swVarios     = 0;
   &eaMonOrg     = "";
   aBlancs       = "";
   &eaFEmp       = "";
   &enDesAna     = 0;

   nSwAper = 0;
   aCta08  = "";
   aCta90  = "";
   aCtaSe  = "";

   &enNumero  = 0;
   &eaEldef   = "";

   nSwF4  = 0;
   nSwF5  = 0;

     &enDiaGAD     = 0;
     &efFecGAD     = @;
     &enDocGAD     = 0;
     &enLibGAD     = 0;
     &enRegGAD     = 0;
     &eaExiGAD     = "";
   &eaEspTabla = "";
   &enInkey    = 0;
   &nQuantHay  = 0;
   &enEste     = 0;
   nSwPus      = 0;

   &efCamp8   = @;
   &enCamp18  = 0;
   &enCamp9   = 0;
   &enCamp19  = 0;
   &enCamp23  = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dscopi_i;

|PROCESO pinta1131; |TIPO 13;
   |C_V #4#23,0,alfa4;
   |SI alfa4 = "S";
       |ATRI P; |PINTA 0908, "Ej:"; |ATRI 0;
       |ATRI I; |PINTA 0970, "Emp.:"; |ATRI 0;
   |FINSI;
   |HAZ totales11;
   |HAZ MasDatos51;
|FPRC;

|PROCESO Tipo7Cp7; |TIPO 7;
     enDiaGAD     = #caextrp7#18;
     efFecGAD     = #caextrp7#8;
     enDocGAD     = #caextrp7#9;
     |HAZ EnGadDiario;

     |ATRI P;
     |PINTA 0902, eaExiGAD;
     |ATRI 0;

     nSwF4 = 0; nSwF5 = 0;
     alfa1 = "    F2-Consulta;F3-Informe;F4-Modificar;F5-Baja;F6-Anotaciones;F7-Buscar Apte.";
     |SI enModoPINET2 = 1;
         alfa1 = alfa1 - "F4-Modificar;";
         nSwF4 = 1;
     |FINSI;
     |SI enModoPINET3 = 1;
         alfa1 = alfa1 - "F5-Baja;";
         nSwF5 = 1;
     |FINSI;
     |MENSA alfa1;
|FPRC;

|PROCESO pintando11; |TIPO 11;
   inkey = FSalida;
   |BLIN 4;

   nSwPus = 0;
   |SI inkey ] 10; |Y inkey [ 15;
       nSwPus = 1;
       |PUSHV 2401 2479;
       |BLIN 24;
   |FINSI;
   |SI swVarios = 1; |HAZ Situafich11; |FINSI;
   |SI inkey = 10;  |HAZ asient11;       |FINSI;
   |SI inkey = 11;  |HAZ ElInform11;     |FINSI;
   |SI inkey = 12; |Y nSwF4 = 0;  |HAZ VeteAsiento51;  |FINSI;
   |SI inkey = 13; |Y nSwF5 = 0;  |HAZ VeteAsiento31;  |FINSI;
   |SI inkey = 14;  |HAZ extraco11;      |FINSI;
   |SI inkey = 15;  |HAZ LaBusqueda7;    |FINSI;

   |SI inkey = 181;  |Y eaEspTabla = "S";
       |SI enEste > 1;
           enInkey = inkey;
           |PTEC 806;
       |FINSI;
       |SI enEste = 1;
           |MENAV "0000Primera Cuenta Seleccionada";
       |FINSI;
   |FINSI;
   |SI inkey = 179;  |Y eaEspTabla = "S";
       |SI enEste = nQuantHay;
           |MENAV "0000Ultima Cuenta Seleccionada";
       |FINSI;
       |SI enEste < nQuantHay;
           enInkey = inkey;
           |PTEC 806;
       |FINSI;
   |FINSI;
   |SI nSwPus = 1;
       nSwPus = 0;
       |POPV;
   |FINSI;
|FPRC;
_____________________________________________________________________________
|PROCESO totales11;                  || PINTA LOS TOTALES DEL EXTRACTO
   #4#14 = d_abajo;
   #4#15 = h_abajo;
   #4#16 = s_abajo;
   |PINTA #4#14;
   |PINTA #4#15;
   |PINTA #4#16;
|FPRC;
_____________________________________________________________________________
|PROCESO lee_asient111;             || CARGA LA PANTALLA DEL ASIENTO COMPLETO
   seleccio = 1;
   |HAZ cuenta1;
   |SI eaMonOrg ! eaMoneda;  |HAZ LoCambio;  |FINSI;

   |DDEFECTO #6;
   #caextrp4#00 = #7#3;        || apunte
   #caextrp4#01 = #7#16;       || cuenta DEBE
   #caextrp4#02 = #7#17;       || digito DEBE
   #caextrp4#03 = #7#10;       || cuenta HABER
   #caextrp4#04 = #7#11;       || digito HABER
   #caextrp4#05 = #7#6;        || concepto
   #caextrp4#06 = #7#7;        || descripcion
   #caextrp4#07 = #7#21;       || departamento
   #caextrp4#08 = #7#9;        || importe
   #caextrp4#09 = #cacuenta#2;        || descripcion
   #caextrp4#10 = #cacuenta#51;       || debe
   #caextrp4#11 = #cacuenta#52;       || haber
   #caextrp4#12 = #cacuenta#53;       || saldo
   #caextrp4#13 = #7#0;        || diario
   #caextrp4#14 = #7#1;        || fecha
   #caextrp4#15 = #7#2;        || documento
   #caextrp4#16 = #7#28;       || subdepartamento
   |SI #caextrp4#0 = #4#19;
      lalinea = #caextrp4#0;
   |FINSI;
   |GRABA 020#6n;
   totallin = totallin + 1;
|FPRC;

|DEFBUCLE lee_asient11;
   #7#1;
   ;
   #4#18, #4#8, #4#9,    1;
   #4#18, #4#8, #4#9, 9999;
   e;
   NULL, lee_asient111;
|FIN;

|PROCESO asient11;
   aFichero = ("s" + Usuario);
   aFichero = (aFichero + "zzzzzzzz") % 108;
   |NOME_DAT #6 aFichero;
   |DELINDEX #6;

   seleccio = 0;

   |ABRE #6;
   lalinea = 1;
   totallin = 0;
   |BUCLE lee_asient11;
   |CIERRA #6;
   |SI seleccio ! 0;
      |PUSHV 07012380;
      |ENTLINEAL #1#6, -1, 4, 20, 1, mini11, maxi11;
      |POPV;
   |SINO;
      |MENAV "    Seleccion vacia ...";
   |FINSI;

   |DELINDEX #6;

|FPRC;

|PROCESO mini11;
   |SI FSalida = "POSICION";  |Y totallin > 8;
      #caextrp4#0 = lalinea;
   |SINO;
      #caextrp4#0 = 1;
   |FINSI;
|FPRC;

|PROCESO maxi11;
   #caextrp4#0 = 9999;
|FPRC;

|PROCESO cuenta11;
   |ABRE #5;
   |SELECT #1#5;
   #cacuenta#0 = #7#4;         || cuenta
   #cacuenta#1 = #7#5;         || digito
   |LEE 001#5=;
   |SI FSalida ! 0;
      |DDEFECTO #5;
      #cacuenta#2 = "<CUENTA INEXISTENTE>";
   |FINSI;
   |CIERRA #5;
|FPRC;
_____________________________________________________________________________
|PROCESO extraco11;            || CARGA LA PANTALLA DE LA ANOT.EXTRACONTABLE
/*
   |ABRE #8;
   #caextras#0 = #4#18;        || diario
   #caextras#1 = #4#8;         || fecha
   #caextras#2 = #4#9;         || documento
   |LEE 001#8=;
   |SI FSalida = 0;
      |PUSHV 08092067;
      |PINPA #1#4;
      |ATRI I; |PINTA 0927, #caextras#0;
      |PINTA 0937, #caextras#1;
      |PINTA 0959, #caextras#2;
      |PINTA 1128, #caextras#3;
      |ATRI 0;
      |HAZ mod_campos11;
      |ENTLINEAL #1#9, -4, 4, 18, 0, minA11, maxA11;
      |POPV;
   |SINO;
      |MENAV "    Asiento sin Anotaciones Extracontables ...";
   |FINSI;
   |CIERRA #8;
*/
    enDiarioEx = #4#18;
    efFechaEx  = #4#8;
    enDocumEx  = #4#9;
    eaLaCtaEx  = #4#1;
    eaCtaDeEx  = #4#2;
    enConNuEx  = #4#30;
    eaConDeEx  = #4#10;
    enEmpresa  = #4#23;
    enPerEx    = #4#24;
    aAlfa = #4#22; |QBF aAlfa;
    |SI aAlfa ! "";
        dirfich0 = aAlfa;
    |SINO;
        |DFICE dirfich0;
    |FINSI;
    enTipoEx = 0;
    |SUB_EJECUTA_NP "caextmz1;extracto";
|FPRC;

|RUTINA minA11;
   #caextral#0 = #caextras#0;
   #caextral#1 = #caextras#1;
   #caextral#2 = #caextras#2;
   #caextral#3 = 1;
|FRUT;

|RUTINA maxA11;
   #caextral#0 = #caextras#0;
   #caextral#1 = #caextras#1;
   #caextral#2 = #caextras#2;
   #caextral#3 = 9999;
|FRUT;

|PROCESO mod_campos11;
   |C_M #caextral#4,1,"N";
   |C_P #caextral#3, 1, 1311;
   |C_P #caextral#4, 1, 1316;
   |ABRE #10;
   #caexttip#0 = #caextras#3;
   |LEE 001#10=;
   |SI FSalida = 0;
      |PINTA 1131, #caexttip#1;
   |FINSI;
   |CIERRA #10;
|FPRC;
_____________________________________________________________________________
|PROCESO LaBusqueda7;

       |ERROR;
       eaEldef = "caextrp7";
       |SUB_EJECUTA_NP "caw00044";

       |SI enNumero ! 0;
           #4#0  = enNumero;
           #4#8  = efCamp8;
           #4#18 = enCamp18;
           #4#9  = enCamp9;
           #4#19 = enCamp19;
           #4#23 = enCamp23;
           |PTEC 802;
           |PONCONTROL 23, "SI";
       |FINSI;

|FPRC;
_____________________________________________________________________________

|PROCESO LaContra7;
    #4#48 = "";
    #4#49 = "";

    |ABRE #31;
    #31#0 = #4#18;
    #31#1 = #4#8;
    #31#2 = #4#9;
    #31#3 = #4#19;
    |LEE 001#31=;
    |SI FSalida = 0;
        #4#48 = #31#4;
    |SINO;
        |ABRE #11;
        #11#0 = #4#18;
        #11#1 = #4#8;
        #11#2 = #4#9;
        |LEE 001#11=;
        |SI FSalida = 0;
            |SI #4#11 = "D"; #4#48 = #11#10; |FINSI;
            |SI #4#11 = "H"; #4#48 = #11#8;  |FINSI;
        |FINSI;
        |CIERRA #11;
   |FINSI;
   |CIERRA #31;
   |ABRE #5;
   #5#0 = #4#48;
   |LEE 001#5=;
   |SI FSalida = 0;
       #4#49 = #5#2;
   |FINSI;
   |CIERRA #5;
|FPRC;

|PROCESO CalculaTotales51;
     |SI swVarios = 1;
         dirfich0 = #4#22; |QBF dirfich0;
         eaMoneda = #4#25;
         |PATH_DAT #5  dirfich0;
         |PATH_DAT #7  dirfich0;
         |PATH_DAT #11 dirfich0;
         |PATH_DAT #31 dirfich0;
     |FINSI;

     |ABRE #7;
     #7#0 = #4#18;
     #7#1 = #4#8;
     #7#2 = #4#9;
     #7#3 = #4#19;
     |LEE 040#7=;
     |SI FSalida ! 0;
         |BORRA 020#4a;
     |SINO;
        nSwAper = #4#52;   || tipo asiento
        aCta08  = #4#50;
        aCta90  = #4#51;
        aCtaSe  = aCta08;
        |SI #7#1 < "01.01.2008"; aCtaSe = aCta90; |FINSI;
        |SI aCtaSe ! #7#4;
             |BORRA 020#4a;
         |SINO;
             |SI eaMonOrg ! eaMoneda;  |HAZ LoCambio;  |FINSI;
             |SI nSwAper = 0;
                 #4#11 = #7#8;
             |SINO;
                 |SI nSwAper = 1; |O nSwAper = 3;
                     #4#11 = #7#8;
                 |SINO;
                     |SI #7#8 = "D"; #4#11 = "H"; |FINSI;
                     |SI #7#8 = "H"; #4#11 = "D"; |FINSI;
                 |FINSI;
             |FINSI;
             #4#12 = #7#9;
             |SI #4#11 = "D";
                 nDebe  = nDebe  + #4#12;
             |SINO;
                 nHaber = nHaber + #4#12;
             |FINSI;

             #4#5  = nDebe;
             #4#6  = nHaber;
             #4#13 = #4#5 - #4#6;
             #4#7  = #4#5 - #4#6;

             |SI nSwAper [ 1;
                 #4#10 = #7#7;
                 #4#30 = #7#6;
             |FINSI;
             #4#20 = #7#21;
             #4#21 = #7#28;
             #4#31 = #7#12;
             #4#32 = #7#13;
             #4#33 = #7#14;
             #4#34 = #7#15;
             #4#35 = #7#19;
             #4#36 = #7#20;
             #4#37 = #7#22;
             #4#38 = #7#23;
             #4#39 = #7#24;
             #4#40 = #7#25;
             #4#41 = #7#26;
             #4#42 = #7#27;
             #4#43 = #7#29;
             #4#44 = #7#1;
             #4#45 = #7#18;
             |HAZ LaContra7;

             |GRABA 020#4a;
         |FINSI;
     |FINSI;
     |LIBERA #4;
     |CIERRA #7;
|FPRC;

|DEFBUCLE caextrp7;
     #4#1;
     ;
     000000;
     999999;
     e;
     NULL, CalculaTotales51;
|FIN;

|PROCESO VeteAsiento51;

   |SI #4#8 [ #4#46;
       |MENAV "    ERROR FECHA INFERIOR O IGUAL AL BLOQUEO DE DATOS";
       |ACABA;
   |FINSI;

   aCuenta     = #4#1;
   enDiario    = #4#18;        || diario
   efFecha     = #4#8;         || fecha
   enDocumento = #4#9;         || documento

   |SI enDiarioDentro = enDiario;  |Y efFechaDentro = efFecha;
    |Y enDocumentoDentro = enDocumento;
       |MENAV "      Registro Bloqueado, usted a llamado al extracto desde este asiento.";
       |ERROR;
       |ACABA;
   |FINSI;

   |LEE 001#4=;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   #4#12 = 0;
   #4#13 = 0;

   |SI enDesAna = 1;
       |SUB_EJECUTA_NP "anz00010;NOMEQUITESQUETECORTOLOSGUEVOS";
   |SINO;
       |SUB_EJECUTA_NP "camaasic;NOMEQUITESQUETECORTOLOSGUEVOS";
   |FINSI;

   |ABRE #7;
   #7#0 = #4#18;        || diario
   #7#1 = #4#8;         || fecha
   #7#2 = #4#9;         || documento
   #7#3 = #4#19;        || linea apunte
   |LEE 040#7=;
   |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
   |CIERRA #7;

   |SI eaMonOrg ! eaMoneda;
       |HAZ LoCambio;
   |FINSI;
   #4#11 = #7#8;                    || signo (no en pantalla!!!)
   #4#12 = #7#9;                    || importe debe

   |GRABA 020#4a;
   |LIBERA #4;

   nApunte = #4#0;
   nDebe   = 0;
   nHaber  = 0;

   |BUCLE caextrp7;

   d_abajo = nDebe;
   h_abajo = nHaber;
   s_abajo = d_abajo - h_abajo;

   #4#0 = nApunte;
   |LEE 040#4=;

   |PONCONTROL 23, "SI";
   |PTEC 809;
|FPRC;

|PROCESO VeteAsiento31;

   |SI #4#8 [ #4#46;
       |MENAV "    ERROR FECHA INFERIOR O IGUAL AL BLOQUEO DE DATOS";
       |ACABA;
   |FINSI;

   aCuenta     = #4#1;
   enDiario    = #4#18;        || diario
   efFecha     = #4#8;         || fecha
   enDocumento = #4#9;         || documento

   |SI enDiarioDentro = enDiario;  |Y efFechaDentro = efFecha;
    |Y enDocumentoDentro = enDocumento;
       |MENAV "      Registro Bloqueado, usted a llamado al extracto desde este asiento.";
       |ERROR;
       |ACABA;
   |FINSI;

   |LEE 001#4=;
   |SI FSalida ! 0;  |ACABA;  |FINSI;

   aFichero = ("s" + Usuario);
   aFichero = (aFichero + "zzzzzzzz") % 108;
   |NOME_DAT #6 aFichero;
   |DELINDEX #6;

   seleccio = 0;

   |ABRE #6;
   lalinea = 1;
   totallin = 0;
   |BUCLE lee_asient11;
   |CIERRA #6;

   |SI seleccio ! 0;
      |PUSHV 07012380;

      |PINPA #0#6;
      |PINTA #6#13; |PINTA #6#14; |PINTA #6#15;
      |ATRI P; |PINTA 0861, "BAJA ASIENTO"; |ATRI 0;

      |ENTLINEAL #1#6, -1, 7, 20, 0, mini, maxi;
      |CONFI "    NBorrar Asiento S/N";
      |SI FSalida = 0;
          |HAZ BorroAsient51;
      |FINSI;
      |POPV;
   |FINSI;

   |DELINDEX #6;

|FPRC;

|PROCESO BorroAsient51;
   enDnDIARIO = enDiario;            || diario
   enHnDIARIO = enDiario;
   efDFechas  = efFecha;             || fecha
   efHFechas  = efFecha;             || fecha
   enDDocume  = enDocumento;         || documento
   enHDocume  = enDocumento;         || documento
   enBorraAu  = 2;

   |SUB_EJECUTA_NP "caborasi;NOMEQUITESQUETECORTOLOSGUEVOS";

   eaMoneda = eaMonOrg;
   |HAZ Monedas;

   nApunte = #4#0;
   nDebe   = 0;
   nHaber  = 0;

   |BUCLE caextrp7;

   d_abajo = nDebe;
   h_abajo = nHaber;
   s_abajo = d_abajo - h_abajo;

   #4#0 = nApunte;
   |LEE 040#4=;

   |PONCONTROL 23, "SI";
   |PTEC 809;
|FPRC;

|| --------------------------------------------------------------------
|PROCESO LeeAuxilia11;
 enDi  = #999#18;
 efFe  = #999#8;
 enDo  = #999#9;
 enAp  = #999#19;
 eaDes = #999#10;
 eaD   = #999#20;
 eaS   = #999#21;
 eaRef = #999#41;
 |SI #999#11 = "D";
     enDeb = #999#12;
     enHar = 0;
 |SINO;
     enHar = #999#12;
     enDeb = 0;
 |FINSI;
 enSal = #999#13;
 |SI nPrim = 0;
     nPrim = 1;
     enTD = #999#5 - enDeb;
     enTH = #999#6 - enHar;
 |FINSI;

 |PRINT;
 enTD = enTD + enDeb;
 enTH = enTH + enHar;
 enTS = enTD - enTH;
|FPRC;

|DEFBUCLE LeeAuxilia11;
 #999#2006;
 ;
 "01.01.0000", 00, 000000, 0000, 00001, 000001;
 "31.12.2999", 99, 999999, 9999, 99999, 999999;
 ;
 NULL, LeeAuxilia11;
|FIN;

|PROCESO ElInform11;
 |PATH_DAT #5 eaFEmp;
 |ABRE #5;
 |DDEFECTO #5;
 #5#0 = #4#1;
 |LEE 001#5=;
 |CIERRA #5;

 |DBASE alfa1;
 aMas  = alfa1 + "def/caextrp7.mas";

 |CARGA_DEF aMas, imagen@;
 |SI FSalida = 0;

     |IMPRE 0;
     |SI FSalida ! 0;
         |PATH_DAT #5 dirfich0;
         |DESCARGA_DEF #imagen@;
         |ACABA;
     |FINSI;

     |INFOR informe;
     |SI FSalida ! 0;
         |PATH_DAT #5 dirfich0;
         |DESCARGA_DEF #imagen@;
         |FINIMP;
         |ACABA;
     |FINSI;

     |NOME_DAT #999 aFitxer;
     enTD = 0;
     enTH = 0;
     enTS = 0;
     nPrim = 0;
     enEjercicio = enBEjer;

     |BUCLE LeeAuxilia11;
     |PIEINF;

     |FININF;
     |FINIMP;
     |DESCARGA_DEF #imagen@;
 |FINSI;
 |PATH_DAT #5 dirfich0;
|FPRC;

|PROCESO Situafich11;
   enEmpresa = #4#23;
   enPeriodo = #4#24;
   dirfich0 = #4#22; |QBF dirfich0;
   eaMoneda = #4#25;
   |PATH_DAT #5 dirfich0;
   |PATH_DAT #7 dirfich0;
   |PATH_DAT #8 dirfich0;
   |PATH_DAT #9 dirfich0;
   |PATH_DAT #10 dirfich0;
   |PATH_DAT #11 dirfich0;
   |PATH_DAT #31 dirfich0;

   enEmpresaPINET = enEmpresa;
   |HAZ RestriccionPINET;
|FPRC;

|PROCESO MasDatos51;
  aBlancs = " " * 78;
  |PINTA 2202, aBlancs; |PINTA 2302, aBlancs;

  |SI #4#28 = "S";
       eOpDep = 0;
       enActividad = #4#20;
       eaCodDep    = #4#20;
       |HAZ Actividad;
       |HAZ pDepartamento;
   |FINSI;
   |SI #4#29 = "S";
       eOpSub = 0;
       enActividad = #4#20;
       eaCodDep    = #4#20;
       enConcepto  = #4#30;
       eaCodSubdep = #4#21;
       |HAZ SubActividad;
       |HAZ pSubdepar;
   |FINSI;
|FPRC;
