|FICHEROS;
   camaysel #0;    || def de ejecuccion

   camaycab #1;    || mayor cabs.
   camaylin #2;    || mayor lins.
   camaasic #3;    || apuntes cabs.
   camaasil #4;    || apuntes lins.

   :/modelos/def/dsmom030 #7;    || conceptos

   canempre #30;
   caselem1 #998;
|FIN;

|VARIABLES;

   &entrada = 1;
   traba1 = "";
   traba2 = "";
   trame = "";
   trames = 0;
   tranyo = 0;
   tranyos = "";
   men1  = "     NO EXISTE EMPRESA !";
   men2  = "     Longitud de Cuenta Fuera de Nivel !";
   fecalf = "";
   mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
   prim = 0;
   desde = "            ";
   hasta = "zzzzzzzzzzzz";
   ante = "";
   parte = "";
   cien = 0;
   ciento = "";
   cuenta = "";
   feini = @;
   fefin = @;
   doini = 1;
   dofin = 999999;
   u = 0;
   v = 0;
   w = 0;
   x = 0;
   y = 0;
   z = 0;
   alfa1 = "";
   pp = 0;
   Empresa = 0;
   Periodo = 0;
   CodigoEmpresa  = 0;
   EjercicioEmpresa = 0;
   NombreEmpresa  = "";
   Comodin = "";
   Comodin1 = "";

   nAsiento = 0;
   aAlfa1 = "";
   aMes   = "";
   nmes   = 0;
   aParam = "";
   &enErMayor = 0;
|FIN;

|INCLUYE dscont_i;
|INCLUYE dslegv_i;

____________________________________/ CALCULOS DE PANTALLA
|PROCESO nomodifi;
   alfa1 = #camaysel#23 > " ";
   #camaysel#23 = alfa1;
   |PINTA #camaysel#23;
   |PARA x = 2;  |SI x [ 22;  |HACIENDO x = x + 1;
      |SI #camaysel#23 = "N";
         |CAMPO_MODIFICA #camaysel#x#,1,"N";
      |SINO;
         |CAMPO_MODIFICA #camaysel#x#,1,"S";
      |FINSI;
   |SIGUE;
   |PARA x = 109;  |SI x [ 115;  |HACIENDO x = x + 1;
      |SI #camaysel#23 = "N";
         |CAMPO_MODIFICA #camaysel#x#,1,"N";
      |SINO;
         |CAMPO_MODIFICA #camaysel#x#,1,"S";
      |FINSI;
   |SIGUE;
   |SI #camaysel#23 = "N";
      |CAMPO_MODIFICA #camaysel#108,1,"S";
      |CAMPO_MODIFICA #camaysel#105,1,"S";
   |SINO;
      #camaysel#105 = "";
      |PINTA #camaysel#105;
      |CAMPO_MODIFICA #camaysel#108,1,"N";
      |CAMPO_MODIFICA #camaysel#105,1,"N";
   |FINSI;
|FPRC;

|PROCESO comprueb; |TIPO 0;
   |SI #camaysel#24 > dig3;  |ERROR;  |ACABA;  |FINSI;
   |SI #camaysel#24 = 1; cien = 100 + dig4;  |FINSI;
   |SI #camaysel#24 = 2; cien = 100 + dig5;  |FINSI;
   |SI #camaysel#24 = 3; cien = 100 + dig6;  |FINSI;
   |SI #camaysel#24 = 4; cien = 100 + dig7;  |FINSI;
   |SI #camaysel#24 = 5; cien = 100 + dig8;  |FINSI;
   |SI #camaysel#24 = 6; cien = 100 + dig9;  |FINSI;
   ciento = cien;
|FPRC;

|PROCESO concepto; |TIPO 0;        || desde campo 'concepto'
   |ABRE #7;
   #dsmom030#0 = #0Campo;
   |LEE 001#7=;
   |SI FSalida ! 0;
      |MENAV men2;
      |DDEFECTO #7;
      |CIERRA #7;
      |ERROR;
      |ACABA;
   |FINSI;
   |SI Campo = 106; |O Campo = 107; pp = Campo - 106; |FINSI;
   |SI Campo = 108; pp = 105; |FINSI;
   |SI Campo = 109; pp =   4; |FINSI;
   |SI Campo = 110; pp =   7; |FINSI;
   |SI Campo = 111; pp =  10; |FINSI;
   |SI Campo = 112; pp =  13; |FINSI;
   |SI Campo = 113; pp =  16; |FINSI;
   |SI Campo = 114; pp =  19; |FINSI;
   |SI Campo = 115; pp =  22; |FINSI;
   |SI #dsmom030#1 > "                              ";
      #camaysel#pp# = #dsmom030#1;
      |PINTA #0pp;
   |FINSI;
   |CIERRA #7;
|FPRC;

|PROCESO SiPongo;
  |SI #0#117 = "N";
      #0#1 = "MOV. DEL MES S/DIARIO AUXILIAR  ";
  |SINO;
      #0#1 = "MOV. DEL MES ";
  |FINSI;
  |PINTA #0#1;
|FPRC;
|| ********************************************************************

____________________________________/ GRABACION DE MAYOR CABS.
|PROCESO actualiza1;
   #camaycab#0 = #camaylin#0;
   #camaycab#1 = #camaylin#1;
   #camaycab#2 = #camaylin#2;
   |LEE 101#1=;
   |SI FSalida ! 0;
      #camaycab#0 = #camaylin#0;
      #camaycab#1 = #camaylin#1;
      #camaycab#2 = #camaylin#2;
      nAsiento    = nAsiento + 1;
      #camaycab#3 = nAsiento;
      #camaycab#3 = #camaylin#2;
      #camaycab#4 = 0;
      #camaycab#5 = 0;
      |LIBERA #1;
      |GRABA 020#1c;
      |LEE 101#1=;
   |FINSI;
   |SI #camaylin#8 = "D";
      #camaycab#4 = #camaycab#4 + #camaylin#9;
   |SINO;
      #camaycab#5 = #camaycab#5 + #camaylin#9;
   |FINSI;
   |GRABA 020#1a;
   |LIBERA #1;
|FPRC;

|DEFBUCLE actualiza;
   #2#1;
   ;
   0, feini, doini,    1;
   99, fefin, dofin, 9999;
   ;
   NULL, actualiza1;
|FIN;
____________________________________/ GRABACION DE MAYOR LINS.
|PROCESO Litmes;
   |SI x = 45;  |ACABA; |FINSI;
   |SI x ] 57; |Y #camaysel#23 = "S";
       |ACABA;
   |FINSI;
   |SI x = 58;  |Y #camaysel#23 = "N";
       |ACABA;
   |FINSI;

   aAlfa1 = #camaylin#1;
   aAlfa1 = aAlfa1 % 0402;
   nmes = aAlfa1;
   |SI nmes =  1; aMes = "ENERO"; |FINSI;
   |SI nmes =  2; aMes = "FEBRERO"; |FINSI;
   |SI nmes =  3; aMes = "MARZO"; |FINSI;
   |SI nmes =  4; aMes = "ABRIL"; |FINSI;
   |SI nmes =  5; aMes = "MAYO"; |FINSI;
   |SI nmes =  6; aMes = "JUNIO"; |FINSI;
   |SI nmes =  7; aMes = "JULIO"; |FINSI;
   |SI nmes =  8; aMes = "AGOSTO"; |FINSI;
   |SI nmes =  9; aMes = "SEPTIEMBRE"; |FINSI;
   |SI nmes = 10; aMes = "OCTUBRE"; |FINSI;
   |SI nmes = 11; aMes = "NOVIEMBRE"; |FINSI;
   |SI nmes = 12; aMes = "DICIEMBRE"; |FINSI;

   aAlfa1 = #camaysel#1; |QBF aAlfa1;
   aAlfa1 = aAlfa1 + " " + aMes;
   #camaylin#7 = aAlfa1;
|FPRC;

|PROCESO grabacion;

   |PARA x = 45;  |SI x [ 64;  |HACIENDO x = x + 1

      y = x + 20;
      z = x + 40
      w = x - 20;
      #camaylin#0 = 1;
      #camaylin#4 = ante;
      #camaylin#5 = #camaysel#24;
      #camaylin#6 = #camaysel#107;
      #camaylin#7 = #camaysel#1;

      |SI x = 45;  #camaylin#0 = 0;  #camaylin#6 = #camaysel#106; #camaylin#7 = #camaysel#0;  |FINSI;
      |SI x ] 57; |Y #camaysel#23 = "S";
          v = ((x - 57) * 3) + 4;
          u = (x + 52);
          #camaylin#6 = #camaysel#u#;
          #camaylin#7 = #camaysel#v#;
      |FINSI;
      |SI x = 58;  |Y #camaysel#23 = "N";
          #camaylin#0 = 99;
          #camaylin#6 = #camaysel#108;
          #camaylin#7 = #camaysel#105;
      |FINSI;
      |SI #camaysel#x# ! 0;
          #camaylin#1 = #camaysel#z#;
          #camaylin#2 = x - 44;
          #camaysel#w# = #camaysel#w# + 1;
          #camaylin#3 = #camaysel#w#;
          #camaylin#8 = "D";
          #camaylin#9 = #camaysel#x#;
          |SI #0#117 = "S"; |HAZ Litmes; |FINSI;
          |GRABA 040#2n;
      |FINSI;
      |SI #camaysel#y# ! 0;
         #camaylin#1 = #camaysel#z#;
         #camaylin#2 = x - 44;
         #camaysel#w# = #camaysel#w# + 1;
         #camaylin#3 = #camaysel#w#;
         #camaylin#8 = "H";
         #camaylin#9 = #camaysel#y#;
         |SI #0#117 = "S"; |HAZ Litmes; |FINSI;
         |GRABA 040#2n;
      |FINSI;
   |SIGUE;
   |HAZ acerando;
|FPRC;

|PROCESO lee_apuntes1;
   |SI prim = 0;
      prim = 1;
      ante = #camaasil#4 % ciento;
   |FINSI;
   cuenta = #camaasil#4 % ciento;

   |SI ante ! cuenta;
      |HAZ grabacion;
      ante = #camaasil#4 % ciento;
   |FINSI;
   |SI #camaasil#0 = 0;
      |SI #camaasil#8 = "D";
         #camaysel#45 = #camaysel#45 + #camaasil#9;
      |SINO;
         #camaysel#65 = #camaysel#65 + #camaasil#9;
      |FINSI;
      |ACABA;
   |FINSI;
   |SI #camaasil#0 = 99; |Y #camaysel#23 = "N";
      |SI #camaasil#8 = "D";
         #camaysel#58 = #camaysel#58 + #camaasil#9;
      |SINO;
         #camaysel#78 = #camaysel#78 + #camaasil#9;
      |FINSI;
      |ACABA;
   |FINSI;

   |PARA x = 86;  |SI x [ 104;   |HACIENDO x = x + 1;
      y = x - 40;
      z = x - 20;
      |SI x < 98;  |Y #camaysel#23 = "N";
         |SI #camaasil#1 [ #camaysel#x#;  |SAL;  |FINSI;
      |FINSI;
      |SI x < 97;
         |SI #camaasil#1 [ #camaysel#x#;  |SAL;  |FINSI;
      |SINO;
         #camaasic#0 = #camaasil#0;
         #camaasic#1 = #camaasil#1;
         #camaasic#2 = #camaasil#2;
         |LEE 000#3=;
         |SI #camaasic#3 ] #camaysel#2;  |Y #camaasic#3 [ #camaysel#3;   |SAL;  |FINSI;
         |SI #camaasic#3 ] #camaysel#5;  |Y #camaasic#3 [ #camaysel#6;   y=y+1; z=z+1; |SAL;  |FINSI;
         |SI #camaasic#3 ] #camaysel#8;  |Y #camaasic#3 [ #camaysel#9;   y=y+2; z=z+2; |SAL;  |FINSI;
         |SI #camaasic#3 ] #camaysel#11; |Y #camaasic#3 [ #camaysel#12;  y=y+3; z=z+3; |SAL;  |FINSI;
         |SI #camaasic#3 ] #camaysel#14; |Y #camaasic#3 [ #camaysel#15;  y=y+4; z=z+4; |SAL;  |FINSI;
         |SI #camaasic#3 ] #camaysel#17; |Y #camaasic#3 [ #camaysel#18;  y=y+5; z=z+5; |SAL;  |FINSI;
         |SI #camaasic#3 ] #camaysel#20; |Y #camaasic#3 [ #camaysel#21;  y=y+6; z=z+6; |SAL;  |FINSI;
      |FINSI;
   |SIGUE;

   |SI #camaasil#8 = "D";
      #camaysel#y# = #camaysel#y# + #camaasil#9;
   |SINO;
      #camaysel#z# = #camaysel#z# + #camaasil#9;
   |FINSI;
|FPRC;

|DEFBUCLE lee_apuntes;
   #4#3;
   ;
   desde, fec1,        1, 0001;
   hasta, #0#104, 999999, 9999;
   ;
   NULL, lee_apuntes1;
|FIN;


|| ...aqui

|PROCESO HazTodo;

   |HAZ FecApeCie;
   |PDEFECTO #0, 85, 105;

   trame   = fec1 % 402;
   trames  = trame;
   tranyos = fec1 % -104;
   tranyo  = tranyos;
   |HAZ calfecha;
   tra1 = 10000 + tranyo;
   traba1 = tra1 % -104;
   traba1 = dia1 + "." + trame + "." + traba1;
   #camaysel#85 = efAper;
   |PARA x = 86;  |SI x [ 97;  |HACIENDO x = x + 1;
      #camaysel#x# = traba1;
      |SI x [ 96; |HAZ cosas; |FINSI;
   |SIGUE;
   #0#98  = efCier; #0#99  = efCier;
   #0#100 = efCier; #0#101 = efCier;
   #0#102 = efCier; #0#103 = efCier;
   #0#104 = efCier;

   |ABRE #2; |CIERRA #2; |DELINDEX #2;

   |ABRE #2;
   |ABRE #3;
   |HAZ acerando;
   prim = 0;
   |BUCLE lee_apuntes;
   |HAZ grabacion;
   |CIERRA #2;
   |CIERRA #3;

   |PINTA 2410,"Recuperando Saldos de Cabeceras";

   |ABRE #1;
   |CIERRA #1;
   |DELINDEX #1;
   |ABRE #1;
   feini = "01.01.0000";
   fefin = "31.12.9999";
   nAsiento = 0;
   |BUCLE actualiza;
   |CIERRA #1;
|FPRC;

|PROCESO acerando;
   |PDEFECTO #0,45,85;
|FPRC;

|CALCULO impres; |TIPO 3;
   |SI #48#27 = "S";
       |HAZ MultiEmpresa;
   |SINO;
       |DFICE dirfich0; |QBF dirfich0;
       |HAZ HazTodo;
   |FINSI;
|FCAL;

|PROCESO MultiEmp1;
   cod1 = #caselem1#1;
   cod2 = #caselem1#2;
   emEmp = 1;  || Sin mensaje
   |HAZ leelo;
   |SI swerror ! 0;  |ACABA;   |FINSI;

   dirfich0 = #caselem1#3;
   |QBF dirfich0;

   |PATH_DAT #1 dirfich0;
   |PATH_DAT #2 dirfich0;
   |PATH_DAT #3 dirfich0;
   |PATH_DAT #4 dirfich0;

   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #caselem1#1;
 ;
 001;
 999;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEmpresa;
  |SUB_EJECUTA "caselemp";
  |NOME_DAT #998 eaFichsel;
  |BUCLE MultiEmp0;
  |DELINDEX #998;
|FPRC;

|PROCESO calfecha;
   dia1 = "31";
   |SI trames = 4; |O trames = 6; |O trames = 9; |O trames = 11;
      dia1 = "30";
   |FINSI;
   |SI trames = 2;
      dia1 = "28";
      |SI tranyo = 1988; |O tranyo = 1992; |O tranyo = 1996; |O tranyo = 2000; |O tranyo = 2004;
          |O tranyo = 2008; |O tranyo = 2012; |O tranyo = 2016; |O tranyo = 2020; |O tranyo = 2024;
         dia1 = "29" ;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO cosas;
   trames = trames + 1;
   |SI trames > 12;
      trames = 1;
      tranyo = tranyo + 1;
   |FINSI;
   |HAZ calfecha;
   tra1 = 10000 + tranyo;
   traba2 = tra1 % -104;
   tra1 = 100 + trames;
   traba1 = tra1 % -102;
   traba1 = dia1 + "." + traba1 + "." + traba2;
|FPRC;

|PROGRAMA;
  aParam = PARAMETRO;
  |QBF aParam;

  |SI aParam = "";
      |MANTE #0;
  |SINO;
      |HAZ Legalia;
  |FINSI;
|FPRO;

|PROCESO Legalia;
     ||... Legalia

     |DBASE Comodin; |QBF Comodin;
     Comodin = Comodin + "fich/" + eaLegEmp + eaLegPer + "/";

     |PATH_DAT #1 Comodin;
     |PATH_DAT #2 Comodin;
     |PATH_DAT #3 Comodin;
     |PATH_DAT #4 Comodin;

     dirfich0 = Comodin;
     |DDEFECTO #0;
     |SI eaUltNiv = "S";
         #0#24 = dig3;
     |SINO;
         #0#24 = dig3 -1;
     |FINSI;
     |HAZ comprueb;
     |HAZ HazTodo;
|FPRC;
/*
|SI nUno = 0;
      |SI #camaysel#x# ! 0;
          #camaylin#1 = #camaysel#z#;
          #camaylin#2 = x - 44;
          #camaysel#w# = #camaysel#w# + 1;
          #camaylin#3 = #camaysel#w#;
          #camaylin#8 = "D";
          #camaylin#9 = #camaysel#x#;
          |SI #0#117 = "S"; |HAZ Litmes; |FINSI;
          |GRABA 040#2n;
      |FINSI;
      |SI #camaysel#y# ! 0;
         #camaylin#1 = #camaysel#z#;
         #camaylin#2 = x - 44;
         #camaysel#w# = #camaysel#w# + 1;
         #camaylin#3 = #camaysel#w#;
         #camaylin#8 = "H";
         #camaylin#9 = #camaysel#y#;
         |SI #0#117 = "S"; |HAZ Litmes; |FINSI;
         |GRABA 040#2n;
      |FINSI;
|SINO;
      nImporte = (#camaysel#x# - #camaysel#y#) ! 2;
      |SI nImporte ! 0;
          #camaylin#1 = #camaysel#z#;
          #camaylin#2 = x - 44;
          #camaysel#w# = #camaysel#w# + 1;
          #camaylin#3 = #camaysel#w#;
          |SI nImporte > 0;
              #camaylin#8 = "D";
              #camaylin#9 = nImporte;
          |SINO;
              #camaylin#8 = "H";
              #camaylin#9 =  - nImporte;
          |FINSI;
          |SI #0#117 = "S"; |HAZ Litmes; |FINSI;
          |GRABA 040#2n;
      |FINSI;
|FINSI;
*/
