|FICHEROS;
     dscam042@ #642;     || Control C
     dscam043@ #643;     || Control L

     dscam003@ #603;     || Recibos Venta
     dscam004@ #604;     || Movimientos Recibos Venta
     dscam008@ #608;     || Recibos Compra
     dscam009@ #609;     || Movimientos Recibos Compra

     camaniva  #1;
     caivaasi  #200;
|FIN;

|VARIABLES;
     aAlfa1         = "";
     aPath          = "";
     aPathFic       = "";
     aPathFicE      = "";
     aPathDef       = "";
     nErr           = 0;

     aDirec         = "";
     aFiche         = "";

     nAnyo          = 0;
     DEjer          = "";
     HEjer          = "";
     aMensa         = "";
     aDef42         = "";
     aDef43         = "";
     aDef03         = "";
     aDef04         = "";
     aDef08         = "";
     aDef09         = "";
     nLibro         = 0;
     aSer           = "";
     nNum           = 0;
     aEmpre         = "";
     aTipo          = "";

     nCobra         = 0;
     nBase          = 0;
     nEuro          = 0;
     Comodin        = "";
     aNumEmp        = "";
     nNumEmp        = 0;
     nKK            = 0;

{50}&enTipoRec      = 0;
     nContador      = 0;
|FIN;

|INCLUYE dscont_i;

|| *************************************************************************

|PROCESO DescargaDef;
     |SI aDef09 ! ""; |DESCARGA_DEF #dscam009@; |FINSI;
     |SI aDef08 ! ""; |DESCARGA_DEF #dscam008@; |FINSI;
     |SI aDef04 ! ""; |DESCARGA_DEF #dscam004@; |FINSI;
     |SI aDef03 ! ""; |DESCARGA_DEF #dscam003@; |FINSI;
     |SI aDef43 ! ""; |DESCARGA_DEF #dscam043@; |FINSI;
     |SI aDef42 ! ""; |DESCARGA_DEF #dscam042@; |FINSI;
|FPRC;

|PROCESO CargaDef;
     nErr = 1;

     aPathDef = aPath + "def/";
     aPathFic = aPath + "fich/";

     aDef42 = aPathDef + "dscam042";
     |CARGA_DEF aDef42, dscam042@;
     |SI FSalida ! 0;
||
||        ***SIN ERRORES*** (la cartera puede que no este instalada=
||
||          aMensa = "0000Error al cargar:" + aDef42;
||          |MENAV aMensa;

          aDef42 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef43 = aPathDef + "dscam043";
     |CARGA_DEF aDef43, dscam043@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef43;
          |MENAV aMensa;
          aDef43 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef03 = aPathDef + "dscam003";
     |CARGA_DEF aDef03, dscam003@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef03;
          |MENAV aMensa;
          aDef03 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef04 = aPathDef + "dscam004";
     |CARGA_DEF aDef04, dscam004@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef04;
          |MENAV aMensa;
          aDef04 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef08 = aPathDef + "dscam008";
     |CARGA_DEF aDef08, dscam008@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef08;
          |MENAV aMensa;
          aDef08 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef09 = aPathDef + "dscam009";
     |CARGA_DEF aDef09, dscam009@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef09;
          |MENAV aMensa;
          aDef09 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     |PATH_DAT #642 aPathFic;
     |PATH_DAT #643 aPathFic;

     nErr = 0;
|FPRC;
|| *************************************************************************
|| \\\\\\\\\\\\\\\\\\\\\\\\\ Recibos de Ventas
|PROCESO dscam004;
   nCobra = 3;
|FPRC;

|DEFBUCLE dscam004;
 #dscam004@#1002;
 ;
 #dscam003@#40,001;
 #dscam003@#40,999;
 ;
 NULL,dscam004;
|FIN;

|PROCESO dscam003;
     nKK = #dscam003@#23;
     |SI nKK > 0;             nCobra = 1; |ERROR10; |FINSI;
     |SI #dscam003@#14 ! "P"; nCobra = 2; |ERROR10; |FINSI;
     |BUCLE dscam004;
     |SI nCobra ! 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE dscam003;
     #dscam003@#6006;
     69,4, 44, 45;
     nLibro, aSer, nNum, 001, " ", 000000001, " ",DEjer, enEmpresa, enPeriodo;
     nLibro, aSer, nNum, 999, "z", 999999999, " ",HEjer, enEmpresa, enPeriodo;
     ;
     NULL, dscam003;
|FIN;
|| ////////////////////////////////////////////////////////////////

|| \\\\\\\\\\\\\\\\\\\\\\\\\ Recibos de Compras
|PROCESO dscam009;
   nCobra = 3;
|FPRC;

|DEFBUCLE dscam009;
 #dscam009@#1002;
 ;
 #dscam008@#40,001;
 #dscam008@#40,999;
 ;
 NULL,dscam009;
|FIN;

|PROCESO dscam008;
     aDirec  = ""; aFiche  = "";
     |DDEF aDirec; |QBF aDirec;
     aFiche = aDirec + "comz0001.mas";
     |XABRE "E", aFiche, 0;
     |SI FSalida = 0;
        aFiche = aDirec + "salud001.mas";
        |XABRE "E", aFiche, 0;
        |SI FSalida = 0;
           nKK =  #dscam008@#57;
           |SI nKK > 0;
              nCobra = 1;
              |ERROR10;
           |SINO;
              |SI #dscam008@#14 ! "P";
                 nCobra = 2;
                 |ERROR10;
              |SINO;
                 |BUCLE dscam009;
                 |SI nCobra ! 0; |ERROR10; |FINSI;
              |FINSI;
           |FINSI;
        |SINO;
           IenTipoRec = enTipoRec1<-;
           IenTipoRec = IenTipoRec + nContador; nContador = nContador + 1;
           enTipoRec = #dscam008@#12;

           |SI nCobra ! 0; |ACABA; |FINSI;

           nKK =  #dscam008@#57;
           |SI nKK > 0;
              nCobra = 1;
           |SINO;
              |SI #dscam008@#14 ! "P";
                  nCobra = 2;
              |SINO;
                  |BUCLE dscam009;
              |FINSI;
           |FINSI;
        |FINSI;
     |SINO;
        nKK =  #dscam008@#57;
        |SI nKK > 0;
           nCobra = 1;
           |ERROR10;
        |SINO;
           |SI #dscam008@#14 ! "P";
              nCobra = 2;
              |ERROR10;
           |SINO;
              |BUCLE dscam009;
              |SI nCobra ! 0; |ERROR10; |FINSI;
           |FINSI;
        |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dscam008;
     #dscam008@#2004;
     4, 44, 45;
     nLibro, aSer, nNum, 001, DEjer, enEmpresa, enPeriodo;
     nLibro, aSer, nNum, 999, HEjer, enEmpresa, enPeriodo;
     ;
     NULL, dscam008;
|FIN;


||/////////////////////////////////////////////////////////////////

|PROCESO dscam043;

   |SI aTipo = "V";
       |SI nLibro ] #dscam043@#5; |Y nLibro [ #dscam043@#6;
           |Y aSer ] #dscam043@#7; |Y aSer [ #dscam043@#8;

               aEmpre    = ("00000" + #dscam043@#9) % -105;
               aPathFicE = aPathFic + aEmpre + "/";

               |PATH_DAT #603 aPathFicE;
               |PATH_DAT #604 aPathFicE;

               nCobra = 0; nContador = 0;
               |BUCLE dscam003;
               |SI nCobra ! 0; |ERROR10; |FINSI;

       |FINSI;
   |FINSI;

   |SI aTipo = "C";
       |SI nLibro ] #dscam043@#5; |Y nLibro [ #dscam043@#6;
           |Y aSer ] #dscam043@#7; |Y aSer [ #dscam043@#8;

               aEmpre    = ("00000" + #dscam043@#9) % -105;
               aPathFicE = aPathFic + aEmpre + "/";

               |PATH_DAT #608 aPathFicE;
               |PATH_DAT #609 aPathFicE;

               nCobra = 0;
               |BUCLE dscam008;
               |SI nCobra ! 0; |ERROR10; |FINSI;
       |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE dscam043;
     #dscam043@#1003;
     3;
     enEmpresa, enPeriodo, 001, aTipo;
     enEmpresa, enPeriodo, 999, aTipo;
     ;
     NULL, dscam043;
|FIN;

|| ************************************************************************
|PROCESO MiraRecibos;
   enErrCarte = 0;
   |ABRE #200;
   |LEE 000#200p;
   |SI FSalida ! 0;
      |DDEFECTO #200;
      |GRABA 020#200b;
   |FINSI;
   aPath = #200#56; |QBF aPath;
   |CIERRA #200;
   |SI aPath = "";
       |ACABA;    || No existe Cartera, seguir proceso
  |FINSI;

  |HAZ CargaDef;
  |SI nErr ! 0; |ACABA; |FINSI;     || Error al Cargar cartera.

  nLibro = #camaniva#0;  || Libro IVA
  aSer   = #camaniva#2;  aSer = (aSer + "     ") % 105;
  nNum   = #camaniva#3;
  aAlfa1 = #camaniva#4; |QBF aAlfa1; aAlfa1 = aAlfa1 % -104; nAnyo = aAlfa1;
  aAlfa1 = #camaniva#4;
  |SI eaVC = "R"; eaVC = "V"; |FINSI;
  |SI eaVC = "S"; eaVC = "C"; |FINSI;
  aTipo = eaVC;
  DEjer = "01.01." + nAnyo;
  HEjer = "31.12." + nAnyo;

  |BUCLE dscam043;
   enErrCarte = nCobra;

  |HAZ DescargaDef;
|FPRC;
