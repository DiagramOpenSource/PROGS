|FICHEROS;
   cacompca #0;

   catmpc01 #10;
   camaniva #11;
   caclipro #12;
   calibros #13;

   dscam003@ #1000;
   dscam008@ #1001;
   dscam043@ #1002;
|FIN;

|VARIABLES;
   aCuenta = "";
   aAlfa   = "";
   aDirCartera = "";

   nNivel  = 0;
   nLinea  = 0;
|FIN;

|PROCESO SacaNivel;
   aCuenta = aCuenta % 0; nNivel = aCuenta;
   |SI nNivel ] #48#14; nNivel = 1; |FINSI;
   |SI nNivel ] #48#15; nNivel = 2; |FINSI;
   |SI nNivel ] #48#16; nNivel = 3; |FINSI;
   |SI nNivel ] #48#17; nNivel = 4; |FINSI;
   |SI nNivel ] #48#18; nNivel = 5; |FINSI;
   |SI nNivel ] #48#19; nNivel = 6; |FINSI;
|FPRC;

|PROCESO TempoConta;
   #calibros#0 = #camaniva#0;
   |LEE 000#calibros.=;
   |SI FSalida ! 0; |DDEFECTO #calibros; |FINSI;

   |SI #calibros#2 = "R"; #caclipro#23 = "C"; |FINSI;
   |SI #calibros#2 = "S"; #caclipro#23 = "P"; |FINSI;
   #caclipro#10 = #camaniva#12;
   aCuenta = #camaniva#12; nNivel = 0; |HAZ SacaNivel;
   #caclipro#11 = nNivel;
   |LEE 000#caclipro.=;
   |SI FSalida ! 0; |DDEFECTO #caclipro; |FINSI;

   |LEE 000#catmpc01.u;
   nLinea = #catmpc01#0 + 1;
   |DDEFECTO #catmpc01;
   #catmpc01#0  = nLinea;
   #catmpc01#1  = #camaniva#0;
   #catmpc01#2  = #camaniva#2;
   #catmpc01#3  = #camaniva#3;
   #catmpc01#4  = #camaniva#4;
   #catmpc01#5  = #camaniva#12;
   #catmpc01#6  = #camaniva#13;
   #catmpc01#7  = #camaniva#21;
   #catmpc01#15 = #caclipro#20;
   |SI #calibros#2 = "R"; #catmpc01#16 = "V"; |FINSI;
   |SI #calibros#2 = "S"; #catmpc01#16 = "C"; |FINSI;
   |GRABA 020#catmpc01.n;
|FPRC;

|DEFBUCLE TempoConta;
#camaniva#1;
;
INICIO;
FINAL;
;
NULL, TempoConta;
|FIN;

|PROCESO TmpVentas;
   |DDEFECTO #dscam003@;
   |SELECT #2#catmpc01;
   #catmpc01#16 = "V";
   #catmpc01#0  = #dscam003@#27;
   #catmpc01#1  = #dscam003@#0;
   #catmpc01#2  = #dscam003@#1;
   |LEE 000#catmpc01.=;
   |SI FSalida ! 0;
      |LEE 000#catmpc01.u;
      nLinea = #catmpc01#0 + 1;
      |DDEFECTO #catmpc01;
      #catmpc01#0  = nLinea;
      #catmpc01#8  = #dscam003@#27;
      #catmpc01#9  = #dscam003@#0;
      #catmpc01#10 = #dscam003@#1;
      #catmpc01#11 = #dscam003@#4;
      #catmpc01#12 = #dscam003@#5;
      #catmpc01#13 = #dscam003@#6;
      |GRABA 020#catmpc01.n;
   |FINSI;
   #catmpc01#14 = #catmpc01#14 + #dscam003@#30;
   |GRABA 020#catmpc01.a;
|FPRC;

|DEFBUCLE TmpVentas;
#dscam003@#1001;
44, 45;
000000001, #48#2, #48#3;
999999999, #48#2, #48#3;
;
NULL,TmpVentas;
|FIN;

|PROCESO TmpCompras;
   |DDEFECTO #dscam008@;
   |SELECT #2#catmpc01;
   #catmpc01#16 = "C";
   #catmpc01#0  = #dscam008@#27;
   #catmpc01#1  = #dscam008@#0;
   #catmpc01#2  = #dscam008@#1;
   |LEE 000#catmpc01.=;
   |SI FSalida ! 0;
      |LEE 000#catmpc01.u;
      nLinea = #catmpc01#0 + 1;
      |DDEFECTO #catmpc01;
      #catmpc01#0  = nLinea;
      #catmpc01#8  = #dscam008@#27;
      #catmpc01#9  = #dscam008@#0;
      #catmpc01#10 = #dscam008@#1;
      #catmpc01#11 = #dscam008@#4;
      #catmpc01#12 = #dscam008@#5;
      #catmpc01#13 = #dscam008@#6;
      |GRABA 020#catmpc01.n;
   |FINSI;
   #catmpc01#14 = #catmpc01#14 + #dscam008@#25;
   |GRABA 020#catmpc01.a;
|FPRC;

|DEFBUCLE TmpCompras;
#dscam008@#1001;
44, 45;
000000001, #48#2, #48#3;
999999999, #48#2, #48#3;
;
NULL,TmpCompras;
|FIN;

|PROCESO TempoCarte;
   aAlfa = aDirCartera + "def/dscam043.mas";
   |CARGA_DEF aAlfa, dscam043@;
   |SI FSalida = 0;
      aAlfa = aDirCartera + "def/dscam003.mas";
      |CARGA_DEF aAlfa, dscam003@;
      |SI FSalida = 0;
         aAlfa = aDirCartera + "def/dscam008.mas";
         |CARGA_DEF aAlfa, dscam008@;
         |SI FSalida = 0;
            aAlfa = aDirCartera + "fich/"; |QBF aAlfa;
            |PATH_DAT #dscam043@#aAlfa#; |ABRE #dscam043@;
            #dscam043@#0 = #48#2;
            #dscam043@#1 = #48#3;
            #dscam043@#2 = 1;
            |LEE 000#dscam043@.];
            |PARA; |SI FSalida = 0; |Y #dscam043@#0 = #48#2; |Y #dscam043@#1 = #48#3; |HACIENDO;
               aAlfa = aDirCartera + "fich/" + (("000000" + #dscam043@#9) % -106) + "/"; |QBF aAlfa;
               |SI #dscam043@#3 = "V";
                  |PATH_DAT #dscam003@#aAlfa#; |ABRE #dscam003@;
                  |BUCLE TmpVentas;
                  |CIERRA #dscam003@;
               |FINSI;
               |SI #dscam043@#3 = "C";
                  |PATH_DAT #dscam008@#aAlfa#; |ABRE #dscam008@;
                  |BUCLE TmpCompras;
                  |CIERRA #dscam008@;
               |FINSI;
            |SIGUE;
            |DESCARGA_DEF #dscam008@;
         |FINSI;
         |DESCARGA_DEF #dscam003@;
      |FINSI;
      |CIERRA #dscam043@; |DESCARGA_DEF #dscam043@;
   |FINSI;
|FPRC;

|PROCESO Impresion;
   |PRINT;
|FPRC;

|DEFBUCLE Impresion;
   #catmpc01#1;
   ;
   INICIO;
   FINAL;
   ;
   NULL,Impresion;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Informe comprobacion contabilidad/cartera";
   |PINTA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      aAlfa = "t1" + Usuario; |NOME_DAT #catmpc01#aAlfa#;
      |DELINDEX #catmpc01; |ABRE #catmpc01;
      |ABRE #caclipro; |ABRE #calibros; |ABRE #caivaasi;

      |LEE 000#caivaasi.p;
      |SI FSalida ! 0; |DDEFECTO #caivaasi; |FINSI;
      aDirCartera = #caivaasi#56; |QBF aDirCartera;

      |BUCLE TempoConta; |HAZ TempoCarte;

      |IMPRE 0;
      |SI FSalida ! 0;
         |INFOR "cacompca";
         |SI FSalida ! 0;
            |BUCLE Impresion;
            |PIEINF; |FININF;
         |FINSI;
         |FINIMP;
      |FINSI;

      |CIERRA #caclipro; |CIERRA #calibros; |CIERRA #caivaasi;
      |CIERRA #catmpc01;
   |FINSI;
|FPRO;
