|FICHEROS;
 caz00025 #0;
 camw0005 #5;

 canempre #30;
 :/modelos/def/dsmom040 #40;
 :/modelos/def/dsmom041 #41;
 :/modelos/def/dsmom042 #42;
 :/modelos/def/dsmom043 #43;
 :/modelos/def/dsmom044 #44;
 :/modelos/def/dsmom045 #45;
 :/modelos/def/dsmom046 #46;
 :/modelos/def/dsmom049 #49;

 camancen #10;
 camandep #11;
 camansde #12;
 catalm01 #13;
 anm00014 #14;
 anm00015 #15;
 cafinanc #16;
 cafinanl #17;
 caarm001 #19;
 caarm002 #20;
 carbum01 #21;

 &regisnif@ #709;
 :/basica/def/agim0003  #710;
 :/integral/def/dsam0103 #711;

 referel@ #998;
 referen@ #999;
|FIN;

|VARIABLES;
     aAlfa             = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aAlfa3            = "";
     nPara1            = 0;

     nInkey            = 0;
     nDEmp             = 0;
     nHEmp             = 0;
     nSw               = 0;
     nSinDatos         = 0;
     aPath             = "";
     aFich             = "";
     aOrigen           = "";
     aDestino          = "";
     aFichero          = "";
     aIPRemoto         = "";
     aPathEmp          = "";
     aPathE00          = "";
     aMas              = "";
     aNomDef           = "";
     aNomDefL          = "";
     aDef              = "";

     aDef998           = "";
     aDef999           = "";

     nSwError          = 0;
     nEstado           = 0;
     nEstLin           = 0;
     nSwAlgun          = 0;
     nSwOp             = 0;
     nSwOp41           = 0;

     &enEmpresaV       = 0;
     &enPeriodoV       = 0;
     aQueQuiero        = "";
     aNumCampos        = "";
     nNumCampos        = 0;
     nNumCampoL        = 0;

     aUsuario          = "";
     aParam            = "";

     &enEmpArch = 0;
     &enPerArch = 0;
     &eaPathArc = "";
     &eaNomArch = "";
     &enAnyArch = 0;
     &eaNifArch = "";
     &enEmpNuev = 0;
     &enPerNuev = 0;
     &eaNomArchivo = "";
     &efFecArch    = @;

        sw         = 0;
        cfecha     = @;
        importe    = 0;
        afiscal    = 0;
        acontab    = 0;
        vfecha     = @;
        ultFechaA  = @;
        aDirTempo  = "";
        aPathQunO  = "";
        aPathQunD  = "";
        nSwBOr     = 0;
|FIN;

|INCLUYE dscont_i;

|| ********************************************************************
|| **** DATOS PANTALLA
|| ********************************************************************
|CALCULO PonBarra; |TIPO 0;
    nInkey = FSalida;
    |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        aAlfa1 = aAlfa1 % 280;
        #0Campo = aAlfa1;
        |PINTA #0Campo
    |FINSI;

     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     aAlfa2 = aAlfa1 % -101;
     |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
          #0Campo = aAlfa1 + "/";
          |PINTA #0Campo;
     |FINSI;
|FCAL;

|PROCESO PreparaDir;
  aDirTempo  = aPath + "*";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

         |FBORRA aDirTempo;
         |_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|CALCULO PreparaFich;
  aUsuario = Usuario % 108;
  |QBF aUsuario;

  |DBASE aBase;
  aPath = aBase + "pasdatos/" + aUsuario;
  |MKDIR aPath;
  aPath    = aPath + "/";
  |HAZ PreparaDir;

  |SI aParam ! "ARCHIVAR";
      aFich    = "zexporcon";
  |SINO;
      aFich    = eaNomArchivo;
  |FINSI;
  aOrigen  = #0#12;  |QBF aOrigen;
  aOrigen  = aOrigen + aFich + ".tgz";
  aDestino = aBase + "fich/" + aFich + ".tgz";

  |SI aParam ! "ARCHIVAR";
      aIPRemoto = "";
      |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
      |SI aIPRemoto ! "";
          |RECIBE_FICHERO aOrigen, aDestino;
      |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
      |FINSI;
  |SINO;
      |COPIA_FICHERO aOrigen, aDestino;
  |FINSI;

  |SI FSalida ! 0;
      |MENAV "    ERROR NO EXISTEN DATOS";
      swerror = 1;
      |ERROR;
      |ACABA;
  |FINSI;

  aFichero   = aDestino;
  |DESCOMPRIME aFichero;

  |SI FSalida = 0;
      aFichero   = aBase + "fich/" + aFich + ".tar";
      |DETAR aFichero, aPath;
      |FBORRA aFichero;

      aFichero   = aBase + "fich/" + aFich + ".tgz";
      |FBORRA aFichero;
  |SINO;
      |MENAV "ERROR NO EXISTE DATOS ";
      swerror = 1;
      |ERROR;
      |ACABA;
  |FINSI;

  aPathQunO = aPath;
  aPathQunD = aPath;
  nSwBOr    = 1;
  |HAZ PongoUnico;

  nSinDatos = 0;
  |PATH_DAT #5 aPath;
  |ABRE #5;
  #5#12 = "E";
  |LEE 001#5=;
  |SI FSalida ! 0;
      nSinDatos = 1;
      #5#13 = "zLContagen";
  |FINSI;
  |CIERRA #5;

  |SI aParam ! "ARCHIVAR";
      |SI nSinDatos = 0;
          #0#1 = #5#0;
          #0#2 = #5#1;
          #0#3 = #5#2;
          #0#4 = #5#3;
          #0#20 = #5#4;
          #0#13 = #5#5;
          #0#14 = #5#6;
          #0#15 = #5#7;
          #0#16 = #5#8;
          #0#17 = #5#9;
          #0#18 = #5#10;
          #0#19 = #5#11;
          #0#22 = #5#14;
          |PINDA #0#0;
      |SINO;
          |ATRI R; |PINTA 1024, "Sin datos de la Empresa Origen                    "; |ATRI 0;
      |FINSI;
  |FINSI;
|FCAL;

|CALCULO defectos; |TIPO 7;
    |SI nSinDatos = 0;
        #0#5 = #0#1;  |PINTA #0#5;
        #0#6 = #0#2;  |PINTA #0#6;
        #0#7 = #0#3;  |PINTA #0#7;
        #0#8 = #0#4;  |PINTA #0#8;
        #0#23 = #0#22; |PINTA #0#23;
    |FINSI;
|FCAL;

|RUTINA infA2;
   #30#2 = nDEmp;
   #30#3 = 0;
|FRUT;

|RUTINA supA2;
   #30#2 = nHEmp;
   #30#3 = 9;
|FRUT;


|CALCULO LeeEmpresa; |TIPO 0;
  nInkey = FSalida;

  |SI nInkey = 10;
     nDEmp = 0;
     nHEmp = 99999;
     |ABRE #30;
     #30#2 = #0#5;
     |CONSULTA_F_CLAVE #1#30,infA2,supA2;
     #0#5 = #30#2; |PINTA #0#5;
     #0#6 = #30#3; |PINTA #0#6;
     |CIERRA #30;
     |PTEC 802;
     |ACABA;
  |FINSI;

  |ABRE #30;
  #30#2 = #0#5;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0#5;
      |MENAV "     NO Existe la empresa Contable";
      |ERROR;
  |SINO;
      #0#7  = #30#1; |PINTA #0#7;
      #0#23 = #30#8; |PINTA #0#23;
  |FINSI;
  |CIERRA #30;
|FCAL;

|CALCULO LeeEmpresaP; |TIPO 0;
  nInkey = FSalida;
  |SI nInkey = 2; |ACABA; |FINSI;

  |SI nInkey = 10;
     nDEmp = #0#5; nHEmp = #0#5;
     |ABRE #30;
     |CONSULTA_F_CLAVE #1#30,infA2,supA2;
     #0#6 = #30#3; |PINTA #0#6;
     |CIERRA #30;
  |FINSI;

  |ABRE #30;
  #30#2 = #0#5;
  #30#3 = #0#6;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la Empresa Contable";
      |ERROR;
  |SINO;
      #0#7   = #30#1;  |PINTA #0#7;
      #0#8   = #30#26; |PINTA #0#8;
      #0#23  = #30#8; |PINTA #0#23;

      |SI nSinDatos = 0;
            nSw = 0;
            |SI #30#26 ! #0#4; nSw = 1; |FINSI;
            |SI #30#13 ! #0#13; nSw = 2; |FINSI;
            |SI #30#14 ! #0#14; nSw = 2; |FINSI;
            |SI #30#15 ! #0#15; nSw = 2; |FINSI;
            |SI #30#16 ! #0#16; nSw = 2; |FINSI;
            |SI #30#17 ! #0#17; nSw = 2; |FINSI;
            |SI #30#18 ! #0#18; nSw = 2; |FINSI;
            |SI #30#19 ! #0#19; nSw = 2; |FINSI;
            |SI #30#8  ! #0#22; nSw = 3; |FINSI;
            |SI nSw ! 0;
                |SI nSw = 1; aAlfa1 = "    Error. No es el mismo Ejercicio de la Empresa Origen"; |FINSI;
                |SI nSw = 2; aAlfa1 = "    Error. No tiene la misma estructura de Cuentas de la Empresa Origen"; |FINSI;
                |SI nSw = 3; aAlfa1 = "    NEl NIF de la Empresa Destino no es el mismo de la Empresa Origen. Continuar S/N"; |FINSI;
                |SI nSw = 3;
                    |CONFI aAlfa1;
                    |SI FSalida ! 0;
                        |ERROR;
                    |FINSI;
                |SINO;
                    |MENAV aAlfa1;
                    |ERROR;
                |FINSI;
            |FINSI;
      |FINSI;
  |FINSI;
  |CIERRA #30;
|FCAL;

|CALCULO QueCojo;
  |C_M #0#10,1,"S";
  |C_M #0#21,1,"S";
  |SI #0#9 = "D";
      |C_M #0#10,1,"N"; #0#10 = "S"; |PINTA #0#10;
  |FINSI;
  |SI #0#9 = "A";
      |C_M #0#21,1,"N"; #0#21 = "S"; |PINTA #0#21;
  |FINSI;
|FCAL;
|| ********************************************************************
|PROCESO CargoRefer;
     aDef998 = "";
     aDef999 = "";
     nSwError = 0;

     aMas   = aDef + aNomDef; aDef999 = aMas;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
          aDef999  = "";
          nSwError = 1;
          |ACABA;
     |FINSI;
     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |PATH_DAT #999 aPath;

     |SI aNomDefL ! "";
         aMas   = aDef + aNomDefL; aDef998 = aMas;
         |CARGA_DEF aMas, referel@;
         |SI FSalida ! 0;
             aDef998 = "";
             |HAZ DescargoRefer;
             nSwError = 1;
             |ACABA;
         |FINSI;
         aQueQuiero = "|NC";
         aNumCampos = #referel@#aQueQuiero#;
         nNumCampoL = aNumCampos;
         nNumCampoL = nNumCampoL - 1;
         |PATH_DAT #998 aPath;
     |FINSI;
|FPRC;

|PROCESO DescargoRefer;
     |SI aDef998 ! ""; |DESCARGA_DEF #998; aDef998 = "";|FINSI;
     |SI aDef999 ! ""; |DESCARGA_DEF #999; aDef999 = "";|FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////////
|| ... Cliente / Proveedores NIFS
|PROCESO LeeDatNifs;
  #709#0 = #999#0;
  |LEE 141#709=;
  |SI FSalida ! 0;
      |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
            #709nPara1 = #999nPara1;
      |SIGUE;
      |GRABA 020#709n;
  |FINSI;
  |LIBERA #709;
|FPRC;

|DEFBUCLE LeeDatNifs;
 #999#1001;
 ;
 "            ";
 "zzzzzzzzzzzz";
 ;
 NULL, LeeDatNifs;
|FIN;

|| ... Rebu
|PROCESO LeeRbum01;
 #21#0 = enEmpresa;
 #21#1 = #999#1;
 |LEE 101#21=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #21;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #21nPara1 = #999nPara1;
 |SIGUE;
 #21#0 = enEmpresa;
 |SI nEstado = 0; |GRABA 020#21a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#21n; |FINSI;
 |LIBERA #21;
|FPRC;

|DEFBUCLE LeeRbum01;
 #999#1002;
 ;
 enEmpresaV, 000001;
 enEmpresaV, 999999;
 ;
 NULL, LeeRbum01;
|FIN;

|| ... Contratos Arrendamiento
|PROCESO LeeArm002;

 #20#0 = enEmpresa;
 #20#1 = #998#1;
 #20#2 = #998#2;
 |LEE 101#20=;
 nEstLin = FSalida;

 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #20;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #20nPara1 = #998nPara1;
 |SIGUE;
 #20#0 = enEmpresa;
 nSwAlgun = 1;
 |SI nEstLin = 0; |GRABA 020#20a; |FINSI;
 |SI nEstLin ! 0; |GRABA 020#20n; |FINSI;
 |LIBERA #20;
|FPRC;

|DEFBUCLE LeeArm002;
 #998#1003;
 ;
 #999#0, #999#1, 001;
 #999#0, #999#1, 999;
 ;
 NULL, LeeArm002;
|FIN;

|PROCESO LasLinm020;
  |SI nSwOp = 1;
      |BORRA 020#20a;
  |FINSI;
  |LIBERA #20;
|FPRC;

|DEFBUCLE LasLinm020;
 #20#1;
 ;
 #19#0, #19#1, 001;
 #19#0, #19#1, 999;
 be;
 NULL, LasLinm020;
|FIN;

|PROCESO LeeArm001;

 #19#0 = enEmpresa;
 #19#1 = #999#1;
 |LEE 101#19=;
 nEstado = FSalida;

 |SI nEstado = 0; |Y #0#21 = "S";
     nSwOp = 1; || borrar
     |BUCLE LasLinm020;
 |FINSI;

 |SI nEstado ! 0; |O #0#21 = "S";
     |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           #19nPara1 = #999nPara1;
     |SIGUE;
 |FINSI;
 #19#0 = enEmpresa;

 |ABRE #20;
 |BUCLE LeeArm002;
 |CIERRA #20;

 |SI nEstado = 0; |GRABA 020#19a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#19n; |FINSI;
 |LIBERA #19;
|FPRC;

|DEFBUCLE LeeArm001;
 #999#1002;
 ;
 enEmpresaV, 00001;
 enEmpresaV, 99999;
 ;
 NULL, LeeArm001;
|FIN;

|| ... Financieras
|PROCESO LeeFinanl;

 #17#0 = enEmpresa;
 #17#1 = #998#1;
 #17#2 = #998#2;
 |LEE 101#17=;
 nEstLin = FSalida;

 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #17;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #17nPara1 = #998nPara1;
 |SIGUE;
 #17#0 = enEmpresa;
 nSwAlgun = 1;
 |SI nEstLin = 0; |GRABA 020#17a; |FINSI;
 |SI nEstLin ! 0; |GRABA 020#17n; |FINSI;
 |LIBERA #17;
|FPRC;

|DEFBUCLE LeeFinanl;
 #998#1003;
 ;
 #999#0, #999#1, 001;
 #999#0, #999#1, 999;
 ;
 NULL, LeeFinanl;
|FIN;

|PROCESO LasLinm017;
  |SI nSwOp = 1;
      |BORRA 020#17a;
  |FINSI;
  |LIBERA #17;
|FPRC;

|DEFBUCLE LasLinm017;
 #17#1;
 ;
 #16#0, #16#1, 001;
 #16#0, #16#1, 999;
 be;
 NULL, LasLinm017;
|FIN;

|PROCESO LeeFinanc;

 #16#0 = enEmpresa;
 #16#1 = #999#1;
 |LEE 101#16=;
 nEstado = FSalida;

 |SI nEstado = 0; |Y #0#21 = "S";
     nSwOp = 1; || borrar
     |BUCLE LasLinm017;
 |FINSI;

 |SI nEstado ! 0; |O #0#21 = "S";
     |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           #16nPara1 = #999nPara1;
     |SIGUE;
 |SINO;
     #16#44 = #999#44;
     #16#45 = #999#45;
     #16#46 = #999#46;
     #16#54 = #999#54;
     #16#55 = #999#55;
 |FINSI;
 #16#0 = enEmpresa;

 |ABRE #17;
 |BUCLE LeeFinanl;
 |CIERRA #17;

 |SI nEstado = 0; |GRABA 020#16a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#16n; |FINSI;
 |LIBERA #16;
|FPRC;

|DEFBUCLE LeeFinanc;
 #999#1002;
 ;
 enEmpresaV, 00001;
 enEmpresaV, 99999;
 ;
 NULL, LeeFinanc;
|FIN;

|| ... Reparto contable de Elementos
|PROCESO Leeanm015;

 #15#0 = enEmpresa;
 #15#1 = #998#1;
 #15#2 = #998#2;
 #15#3 = #998#3;
 |LEE 101#15=;
 nEstLin = FSalida;

 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #15;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #15nPara1 = #998nPara1;
 |SIGUE;
 #15#0 = enEmpresa;
 nSwAlgun = 1;
 |SI nEstLin = 0; |GRABA 020#15a; |FINSI;
 |SI nEstLin ! 0; |GRABA 020#15n; |FINSI;
 |LIBERA #15;
|FPRC;

|DEFBUCLE Leeanm015;
 #998#1004;
 ;
 #999#0, #999#1, #999#2, 001;
 #999#0, #999#1, #999#2, 999;
 ;
 NULL, Leeanm015;
|FIN;

|PROCESO LasLinm015;
  |SI nSwOp = 1;
      |BORRA 020#15a;
  |FINSI;
  |LIBERA #15;
|FPRC;

|DEFBUCLE LasLinm015;
 #15#1;
 ;
 #14#0, #14#1, #14#2, 001;
 #14#0, #14#1, #14#2, 999;
 be;
 NULL, LasLinm015;
|FIN;

|PROCESO  Leeanm14;

 #14#0 = enEmpresa;
 #14#1 = #999#1;
 #14#2 = #999#2;
 |LEE 101#14=;
 nEstado = FSalida;

 |SI nEstado = 0;
     |SI #0#21 = "S";
         nSwOp = 1; || borrar
         |BUCLE LasLinm015;
     |FINSI;
     |SI #0#21 = "A";
         |LIBERA #14;
         |ACABA;
     |FINSI;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #14nPara1 = #999nPara1;
 |SIGUE;
 #14#0 = enEmpresa;

 |ABRE #15;
 |BUCLE Leeanm015;
 |CIERRA #15;

 |SI nEstado = 0; |GRABA 020#14a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#14n; |FINSI;
 |LIBERA #14;
|FPRC;

|DEFBUCLE  Leeanm14;
 #999#1003;
 ;
 enEmpresaV, "        ", 00;
 enEmpresaV, "zzzzzzzz", 99;
 ;
 NULL,  Leeanm14;
|FIN;

|| ... Talones
|PROCESO LeeTalm01;
 #13#18 = enEmpresa;
 #13#0 = #999#0;
 |LEE 101#13=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #13;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #13nPara1 = #999nPara1;
 |SIGUE;
 #13#18 = enEmpresa;
 |SI nEstado = 0; |GRABA 020#13a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#13n; |FINSI;
 |LIBERA #13;
|FPRC;

|DEFBUCLE LeeTalm01;
 #999#1002;
 ;
 enEmpresaV, 000001;
 enEmpresaV, 999999;
 ;
 NULL, LeeTalm01;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Subdepartamentos
|PROCESO LeeMansde;
 #12#0 = enEmpresa;
 #12#1 = #999#1;
 #12#2 = #999#2;
 |LEE 101#12=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #12;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #12nPara1 = #999nPara1;
 |SIGUE;
 #12#0  = enEmpresa;
 |SI nEstado = 0; |GRABA 020#12a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#12n; |FINSI;
 |LIBERA #12;
|FPRC;

|DEFBUCLE LeeMansde;
 #999#1003;
 ;
 enEmpresaV, "  ", "   ";
 enEmpresaV, "zz", "zzz";
 ;
 NULL, LeeMansde;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Departamentos
|PROCESO LeeMandep;
 #11#0 = enEmpresa;
 #11#1 = #999#1;
 |LEE 101#11=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #11;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #11nPara1 = #999nPara1;
 |SIGUE;
 #11#0  = enEmpresa;
 |SI nEstado = 0; |GRABA 020#11a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#11n; |FINSI;
 |LIBERA #11;
|FPRC;

|DEFBUCLE LeeMandep;
 #999#1002;
 ;
 enEmpresaV, "  ";
 enEmpresaV, "zz";
 ;
 NULL, LeeMandep;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Centros de Trabajo
|PROCESO LeeMancen;
 #10#0 = enEmpresa;
 #10#1 = #999#1;
 |LEE 101#10=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#21 = "A";
     |LIBERA #10;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #10nPara1 = #999nPara1;
 |SIGUE;
 #10#0  = enEmpresa;
 |SI nEstado = 0; |GRABA 020#10a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#10n; |FINSI;
 |LIBERA #10;
|FPRC;

|DEFBUCLE LeeMancen;
 #999#1002;
 ;
 enEmpresaV, 00;
 enEmpresaV, 99;
 ;
 NULL, LeeMancen;
|FIN;
|| ///////////////////////////////////////////////////
|PROCESO Borr21;
 |BORRA 020#21a;
 |LIBERA #21;
|FPRC;

|DEFBUCLE Borr21;
 #21#1;
 ;
 enEmpresa, 000001;
 enEmpresa, 999999;
 be;
 NULL, Borr21;
|FIN;

|PROCESO Borr20;
 |BORRA 020#20a;
 |LIBERA #20;
|FPRC;

|DEFBUCLE Borr20;
 #20#1;
 ;
 enEmpresa, 00001, 001;
 enEmpresa, 99999, 999;
 be;
 NULL, Borr20;
|FIN;

|PROCESO Borr19;
 |BORRA 020#19a;
 |LIBERA #19;
|FPRC;

|DEFBUCLE Borr19;
 #19#1;
 ;
 enEmpresa, 00001;
 enEmpresa, 99999;
 be;
 NULL, Borr19;
|FIN;

|PROCESO Borr17;
 |BORRA 020#17a;
 |LIBERA #17;
|FPRC;

|DEFBUCLE Borr17;
 #17#1;
 ;
 enEmpresa, 00001, 001;
 enEmpresa, 99999, 999;
 be;
 NULL, Borr17;
|FIN;

|PROCESO Borr16;
 |BORRA 020#16a;
 |LIBERA #16;
|FPRC;

|DEFBUCLE Borr16;
 #16#1;
 ;
 enEmpresa, 00001;
 enEmpresa, 99999;
 be;
 NULL, Borr16;
|FIN;

|PROCESO Borr15;
 |BORRA 020#15a;
 |LIBERA #15;
|FPRC;

|DEFBUCLE Borr15;
 #15#1;
 ;
 enEmpresa, "        ", 00, 001;
 enEmpresa, "zzzzzzzz", 99, 999;
 be;
 NULL, Borr15;
|FIN;

|PROCESO Borr14;
 |BORRA 020#14a;
 |LIBERA #14;
|FPRC;

|DEFBUCLE Borr14;
 #14#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 be;
 NULL, Borr14;
|FIN;

|PROCESO Borr13;
 |BORRA 020#13a;
 |LIBERA #13;
|FPRC;

|DEFBUCLE Borr13;
 #13#1;
 ;
 enEmpresa, 000001;
 enEmpresa, 999999;
 be;
 NULL, Borr13;
|FIN;

|PROCESO Borr12;
 |BORRA 020#12a;
 |LIBERA #12;
|FPRC;

|DEFBUCLE Borr12;
 #12#1;
 ;
 enEmpresa, "  ", "   ";
 enEmpresa, "zz", "zzz";
 be;
 NULL, Borr12;
|FIN;

|PROCESO Borr11;
 |BORRA 020#11a;
 |LIBERA #11;
|FPRC;

|DEFBUCLE Borr11;
 #11#1;
 ;
 enEmpresa, "  ";
 enEmpresa, "zz";
 be;
 NULL, Borr11;
|FIN;

|PROCESO Borr10;
 |BORRA 020#10a;
 |LIBERA #10;
|FPRC;

|DEFBUCLE Borr10;
 #10#1;
 ;
 enEmpresa, 00;
 enEmpresa, 99;
 be;
 NULL, Borr10;
|FIN;

|PROCESO LosFich000000;
  |PATH_DAT #10 aPathE00;
  |PATH_DAT #11 aPathE00;
  |PATH_DAT #12 aPathE00;
  |PATH_DAT #13 aPathE00;
  |PATH_DAT #14 aPathE00;
  |PATH_DAT #15 aPathE00;
  |PATH_DAT #16 aPathE00;
  |PATH_DAT #17 aPathE00;
  |PATH_DAT #19 aPathE00;
  |PATH_DAT #20 aPathE00;
  |PATH_DAT #21 aPathE00;

  |SI #0#21 = "S";
      |BUCLE Borr10;
      |BUCLE Borr11;
      |BUCLE Borr12;
      |BUCLE Borr13;
      |BUCLE Borr14;
      |BUCLE Borr15;
      |BUCLE Borr16;
      |BUCLE Borr17;
      |BUCLE Borr19;
      |BUCLE Borr20;
      |BUCLE Borr21;
  |FINSI;

  |DBASE aBase;
  aDef = aBase + "def/";

  aNomDefL = "";
  aNomDef  = "camancen";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #10;
      |BUCLE LeeMancen;
      |CIERRA #10;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "camandep";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #11;
      |BUCLE LeeMandep;
      |CIERRA #11;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "camansde";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #12;
      |BUCLE LeeMansde;
      |CIERRA #12;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "catalm01";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #13;
      |BUCLE LeeTalm01;
      |CIERRA #13;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "anm00015";
  aNomDef  = "anm00014";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #14;
      |BUCLE Leeanm14;
      |CIERRA #14;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "cafinanl";
  aNomDef  = "cafinanc";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #16;
      |BUCLE LeeFinanc;
      |CIERRA #16;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "caarm002";
  aNomDef  = "caarm001";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #19;
      |BUCLE LeeArm001;
      |CIERRA #19;
      |HAZ DescargoRefer;
  |FINSI;

  aNomDefL = "";
  aNomDef  = "carbum01";
  |HAZ CargoRefer;
  |SI nSwError = 0;
      |ABRE #21;
      |BUCLE LeeRbum01;
      |CIERRA #21;
      |HAZ DescargoRefer;
  |FINSI;

  || ... Proceso de los Nif
  aDef     = "";
  aNomDefL = "";
  aNomDef  = "";
  |SI HayAcceso = 1;
      enSwDeDonde = 1;
      |REFERENCIA_DEF regisnif@, #711;
      aDef =  aPAcceso + "def/"; aNomDef = "dsam0103";
  |SINO;
      |SI Haybasica = 1;
          enSwDeDonde = 0;
          |REFERENCIA_DEF regisnif@, #710;
          aDef =  aPGenral + "def/"; aNomDef = "agim0003";
      |FINSI;
  |FINSI;
  |SI aDef = ""; |ACABA; |FINSI; ||no hay ni integrada ni basica
  |HAZ CargoRefer;
  |SI nSwError = 0;
      aAlfa1 = "datonifs";
      |NOME_DAT #999 aAlfa1;
      |ABRE #709;
      |BUCLE LeeDatNifs;
      |CIERRA #709;
      |HAZ DescargoRefer;
  |FINSI;
|FPRC;

|PROCESO PongoUnico;  || copia los ddd a dat, xxx a ddx y iii a ixx (Fichero Unico)

  aDirTempo  = aPathQunO + "*.ddd";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

             aFichero  = aDirTempo - aPathQunO;
             aFichero  = aFichero - ".ddd";

             aOrigen  = aPathQunO + aFichero + ".ddd";
             aDestino = aPathQunD + aFichero + ".dat";
             |COPIA_FICHERO aOrigen, aDestino;
             |SI nSwBOr = 1;  |FBORRA aOrigen; |FINSI;

             aOrigen  = aPathQunO + aFichero + ".iii";
             aDestino = aPathQunD  + aFichero + ".ixx";
             |COPIA_FICHERO aOrigen, aDestino;
             |SI nSwBOr = 1;  |FBORRA aOrigen; |FINSI;

             aOrigen  = aPathQunO + aFichero + ".xxx";
             aDestino = aPathQunD + aFichero + ".ddx";
             |COPIA_FICHERO aOrigen, aDestino;
             |SI nSwBOr = 1;  |FBORRA aOrigen; |FINSI;

          |_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|PROCESO DatosContagen;
  aAlfa1 = enEmpresa; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
  aAlfa2 = enPeriodo; |QBF aAlfa2; aAlfa2 = ("0" + aAlfa2) % -101;

  |DFICB aBase;
  aPathEmp = aBase + aAlfa1 + aAlfa2 + "/";
  aPathE00 = aBase + "000000/";

  aFich    = #5#13; |QBF aFich;  || ... "zLContagen"
  aFichero  = aPath + aFich + ".tgz";
  |DESCOMPRIME aFichero;

  |SI FSalida = 0;
      aFichero   = aPath + aFich + ".tar";
      |DETAR aFichero, aPathEmp;
      |FBORRA aFichero;

      aPathQunO = aPathEmp;
      aPathQunD = aPathEmp;
      nSwBOr    = 1;
      |HAZ PongoUnico;

      |HAZ LosFich000000;

      |SI aParam ! "ARCHIVAR";
          |MENAV "    RECOGIDOS FICHEROS DE CONTABILIDAD";
      |FINSI;
  |SINO;
      |SI aParam ! "ARCHIVAR";
          |MENAV "   ERROR NO EXISTEN DATOS DE CONTABILIDAD";
      |FINSI;
  |FINSI;

|FPRC;
|| //////////////////////////////////////////////////////////////////////////
|| ************************* Amortizaciones
|| ... Linea por Regularizacion de Prorrata
|PROCESO Leedsmom049;
 #49#0 = enEmpresa;
 #49#2 = #999#2;
 #49#3 = #999#3;
 #49#4 = #999#4;
 |LEE 101#49=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #49;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #49nPara1 = #999nPara1;
 |SIGUE;
 #49#0  = enEmpresa;
 |SI nEstado = 0; |GRABA 020#49a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#49n; |FINSI;
 |LIBERA #49;
|FPRC;

|DEFBUCLE Leedsmom049;
 #999#1004;
 ;
 enEmpresaV, "        ", 00, 00;
 enEmpresaV, "zzzzzzzz", 99, 99;
 ;
 NULL, Leedsmom049;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Historico Fin Leasing
|PROCESO Leedsmom046;
 #46#0 = enEmpresa;
 #46#2 = #999#2;
 #46#3 = #999#3;
 #46#1 = #999#1;
 #46#6 = #999#6;
 |LEE 101#46=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #46;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #46nPara1 = #999nPara1;
 |SIGUE;
 #46#0  = enEmpresa;
 |SI nEstado = 0; |GRABA 020#46a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#46n; |FINSI;
 |LIBERA #46;
|FPRC;

|DEFBUCLE Leedsmom046;
 #999#1005;
 ;
 enEmpresaV, "        ", 00, 00, "   ";
 enEmpresaV, "zzzzzzzz", 99, 99, "zzz";
 ;
 NULL, Leedsmom046;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Historico Fin Leasing
|PROCESO Leedsmom045;
 #45#0 = enEmpresa;
 #45#2 = #999#2;
 #45#3 = #999#3;
 |LEE 101#45=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #45;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #45nPara1 = #999nPara1;
 |SIGUE;
 #45#0  = enEmpresa;
 #45#15 = enPeriodo;
 |SI nEstado = 0; |GRABA 020#45a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#45n; |FINSI;
 |LIBERA #45;
|FPRC;

|DEFBUCLE Leedsmom045;
 #999#1003;
 ;
 enEmpresaV, "        ", 00;
 enEmpresaV, "zzzzzzzz", 99;
 ;
 NULL, Leedsmom045;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Historico Activar Elementos
|PROCESO Leedsmom044;
 #44#0 = enEmpresa;
 #44#2 = #999#2;
 #44#3 = #999#3;
 |LEE 101#44=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #44;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #44nPara1 = #999nPara1;
 |SIGUE;
 #44#0  = enEmpresa;
 #44#15 = enPeriodo;
 |SI nEstado = 0; |GRABA 020#44a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#44n; |FINSI;
 |LIBERA #44;
|FPRC;

|DEFBUCLE Leedsmom044;
 #999#1003;
 ;
 enEmpresaV, "        ", 00;
 enEmpresaV, "zzzzzzzz", 99;
 ;
 NULL, Leedsmom044;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Ventas
|PROCESO Leedsmom043;
 #43#0 = enEmpresa;
 #43#2 = #999#2;
 #43#3 = #999#3;
 #43#14 = #999#14;
 |LEE 101#43=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #43;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #43nPara1 = #999nPara1;
 |SIGUE;
 #43#0 = enEmpresa;
 |SI nEstado = 0; |GRABA 020#43a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#43n; |FINSI;
 |LIBERA #43;
|FPRC;

|DEFBUCLE Leedsmom043;
 #999#1004;
 ;
 enEmpresaV, "        ", 00, 0001;
 enEmpresaV, "zzzzzzzz", 99, 9999;
 ;
 NULL, Leedsmom043;
|FIN;
|| ///////////////////////////////////////////////////

|| ... Elementos
|PROCESO Leedsmom042;

 #42#0 = enEmpresa;
 #42#2 = #998#2;
 #42#3 = #998#3;
 #42#4 = #998#4;
 |LEE 101#42=;
 nEstLin = FSalida;

 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #42;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampoL; |HACIENDO nPara1 = nPara1 + 1;
       #42nPara1 = #998nPara1;
 |SIGUE;
 #42#0 = enEmpresa;
 nSwAlgun = 1;
 |SI nEstLin = 0; |GRABA 020#42a; |FINSI;
 |SI nEstLin ! 0; |GRABA 020#42n; |FINSI;
 |LIBERA #42;
|FPRC;

|DEFBUCLE Leedsmom042;
 #998#1004;
 ;
 #999#0, #999#2, #999#3, 001;
 #999#0, #999#2, #999#3, 999;
 ;
 NULL, Leedsmom042;
|FIN;

|PROCESO LasLinm042;
  |SI nSwOp = 1;
      |BORRA 020#42a;
  |FINSI;

  |SI nSwOp = 2;
      #42#1 = #41#1;
      |SI #42#6 = "C";
          importe = importe + #42#7;
          #42#11 = #42#7;
          |SI sw = 0;
              cfecha = #42#9;
              sw = 1;
          |FINSI;
      |FINSI;
      |SI #42#6 = "A";
          afiscal = afiscal + #42#7;
          acontab = acontab + #42#11;
          |SI ultFechaA < #42#9; ultFechaA = #42#9; |FINSI;
      |FINSI;
      |SI #42#6 = "V";
          vfecha = #42#9;
      |FINSI;
      #42#13 = #42#11 -  #42#7;
      |GRABA 020#42a;
  |FINSI;
  |LIBERA #42;
|FPRC;

|DEFBUCLE LasLinm042;
 #42#1;
 ;
 #41#0, #41#2, #41#3, 001;
 #41#0, #41#2, #41#3, 999;
 be;
 NULL, LasLinm042;
|FIN;

|PROCESO Leedsmom041;

 |SI nSwOp41 = 1;
     nSwAlgun = 1;
     |ERROR10;
     |ACABA;
 |FINSI;

 #41#0 = enEmpresa;
 #41#2 = #999#2;
 #41#3 = #999#3;
 |LEE 101#41=;
 nEstado = FSalida;

 |SI nEstado = 0; |Y #0#10 = "S";
     nSwOp = 1; || borrar
     |BUCLE LasLinm042;
 |FINSI;

 |SI nEstado ! 0; |O #0#10 = "S";
     |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           #41nPara1 = #999nPara1;
     |SIGUE;
 |SINO;
     #41#1 = #999#1;
     #41#9 = #999#9;
     |PARA nPara1 = 35; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
           #41nPara1 = #999nPara1;
     |SIGUE;
 |FINSI;
 #41#0 = enEmpresa;
 nSwAlgun = 0;
 |ABRE #42;
 |BUCLE Leedsmom042;
 |CIERRA #42;

 |SI nEstado = 0; |Y #0#10 = "A";
     |SI nSwAlgun = 1;
         nSwOp = 2; || Recalcular
         sw        = 0;
         cfecha    = "01.01.0000";
         importe   = 0;
         afiscal   = 0;
         acontab   = 0;
         vfecha    = "01.01.0000";
         ultFechaA = "01.01.0000";
         |BUCLE LasLinm042;
         |SI sw = 1;
             #41#27 = cfecha;
             |SI #41#35 = "S";
                 #41#9 = "01.01.0000";
             |SINO;
                |SI #41#9 < #41#27; #41#9 = #41#27; |FINSI;
             |FINSI;
             #41#26 = vfecha;
             #41#10 = importe;
             #41#15 = afiscal;
             #41#16 = importe - afiscal;
             #41#21 = acontab;
             #41#22 = importe - acontab;
             |SI #41#16 < 0; #41#16 = 0; |FINSI;
             |SI #41#22 < 0; #41#22 = 0; |FINSI;
             |SI vfecha > "01.01.1900";
                 |SI ultFechaA ] vfecha;
                     #41#16 = 0;
                     #41#22 = 0;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |LIBERA #41;
         |ACABA;
     |FINSI;
 |FINSI;

 |SI nEstado = 0; |GRABA 020#41a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#41n; |FINSI;
 |LIBERA #41;
|FPRC;

|DEFBUCLE Leedsmom041;
 #999#1003;
 ;
 enEmpresaV, "        ", 00;
 enEmpresaV, "zzzzzzzz", 99;
 ;
 NULL, Leedsmom041;
|FIN;

|| ... Grupos
|PROCESO Leedsmom040;
 #40#0 = enEmpresa;
 #40#2 = #999#2;
 |LEE 101#40=;
 nEstado = FSalida;
 |SI nEstado = 0; |Y #0#10 = "A";
     |LIBERA #40;
     |ACABA;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ nNumCampos; |HACIENDO nPara1 = nPara1 + 1;
       #40nPara1 = #999nPara1;
 |SIGUE;
 #40#0 = enEmpresa;
 |SI nEstado = 0; |GRABA 020#40a; |FINSI;
 |SI nEstado ! 0; |GRABA 020#40n; |FINSI;
 |LIBERA #40;
|FPRC;

|DEFBUCLE Leedsmom040;
 #999#1002;
 ;
 enEmpresaV, 0001;
 enEmpresaV, 9999;
 ;
 NULL, Leedsmom040;
|FIN;

|| ----------------------------------------------------------------
|PROCESO Borrm040;
 |BORRA 020#40a;
 |LIBERA #40;
|FPRC;

|DEFBUCLE Borrm040;
 #40#1;
 ;
 enEmpresa, 0001;
 enEmpresa, 9999;
 be;
 NULL, Borrm040;
|FIN;

|PROCESO Borrm041;
 |BORRA 020#41a;
 |LIBERA #41;
|FPRC;

|DEFBUCLE Borrm041;
 #41#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 be;
 NULL, Borrm041;
|FIN;

|PROCESO Borrm042;
 |BORRA 020#42a;
 |LIBERA #42;
|FPRC;

|DEFBUCLE Borrm042;
 #42#1;
 ;
 enEmpresa, "        ", 00, 001;
 enEmpresa, "zzzzzzzz", 99, 999;
 be;
 NULL, Borrm042;
|FIN;

|PROCESO Borrm043;
 |BORRA 020#43a;
 |LIBERA #43;
|FPRC;

|DEFBUCLE Borrm043;
 #43#1;
 ;
 enEmpresa, "        ", 00, 0001;
 enEmpresa, "zzzzzzzz", 99, 9999;
 be;
 NULL, Borrm043;
|FIN;

|PROCESO Borrm044;
 |BORRA 020#44a;
 |LIBERA #44;
|FPRC;

|DEFBUCLE Borrm044;
 #44#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 be;
 NULL, Borrm044;
|FIN;

|PROCESO Borrm045;
 |BORRA 020#45a;
 |LIBERA #45;
|FPRC;

|DEFBUCLE Borrm045;
 #45#1;
 ;
 enEmpresa, "        ", 00;
 enEmpresa, "zzzzzzzz", 99;
 be;
 NULL, Borrm045;
|FIN;

|PROCESO Borrm046;
 |BORRA 020#46a;
 |LIBERA #46;
|FPRC;

|DEFBUCLE Borrm046;
 #46#1;
 ;
 enEmpresa, "        ", 00, 00, "   ";
 enEmpresa, "zzzzzzzz", 99, 99, "zzz";
 be;
 NULL, Borrm046;
|FIN;

|PROCESO Borrm049;
 |BORRA 020#49a;
 |LIBERA #49;
|FPRC;

|DEFBUCLE Borrm049;
 #49#1;
 ;
 enEmpresa, "        ", 00, 00;
 enEmpresa, "zzzzzzzz", 99, 99;
 be;
 NULL, Borrm049;
|FIN;

|| ----------------------------------------------------------------
|PROCESO DatosAmortiza;

     |SI Haymodelo = 0;
         |MENAV "    Error.! No Existe Aplicacion MODELOS. No pasa Amortizaciones";
         |ACABA;
     |FINSI;

     aAlfa1 = aPModelo + "fich/";
     |PATH_DAT #40 aAlfa1;
     |PATH_DAT #41 aAlfa1;
     |PATH_DAT #42 aAlfa1;
     |PATH_DAT #43 aAlfa1;
     |PATH_DAT #44 aAlfa1;
     |PATH_DAT #45 aAlfa1;
     |PATH_DAT #46 aAlfa1;
     |PATH_DAT #49 aAlfa1;

     aDef = aPModelo + "def/";

|| ... Paso Elementos Amortizables

     aNomDef  = "dsmom041";
     aNomDefL = "dsmom042";
     |HAZ CargoRefer;
     |SI nSwError ! 0;
          |MENAV "    Error Cargado Fichero de Elementos de Amortizaciones. Proceso Interrumpido";
          |ACABA;
     |FINSI;

     |SI #0#10 = "S";  || primero borrara si hay datos
         nSwOp41  = 1;
         nSwAlgun = 0;
         |BUCLE Leedsmom041;
         |SI nSwAlgun = 1;
             |BUCLE Borrm040;
             |BUCLE Borrm041;
             |BUCLE Borrm042;
             |BUCLE Borrm043;
             |BUCLE Borrm044;
             |BUCLE Borrm045;
             |BUCLE Borrm046;
             |BUCLE Borrm049;
         |FINSI;
     |FINSI;

     |ABRE #41;
     nSwOp41 = 0;
     |BUCLE Leedsmom041;
     |CIERRA #41;
     |HAZ DescargoRefer;

|| ... Paso grupos por si ha creado alguno.
     aNomDefL = "";
     aNomDef  = "dsmom040";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #40;
         |BUCLE Leedsmom040;
         |CIERRA #40;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Ventas elementos
     aNomDefL = "";
     aNomDef  = "dsmom043";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #43;
         |BUCLE Leedsmom043;
         |CIERRA #43;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Historico activar
     aNomDefL = "";
     aNomDef  = "dsmom044";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #44;
         |BUCLE Leedsmom044;
         |CIERRA #44;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Historico activar
     aNomDefL = "";
     aNomDef  = "dsmom045";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #45;
         |BUCLE Leedsmom045;
         |CIERRA #45;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Reparto Elemento Actividad
     aNomDefL = "";
     aNomDef  = "dsmom046";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #46;
         |BUCLE Leedsmom046;
         |CIERRA #46;
         |HAZ DescargoRefer;
     |FINSI;

|| ... Paso Lineas de Regularizacion por Prorrata
     aNomDefL = "";
     aNomDef  = "dsmom049";
     |HAZ CargoRefer;
     |SI nSwError = 0;
         |ABRE #49;
         |BUCLE Leedsmom049;
         |CIERRA #49;
         |HAZ DescargoRefer;
     |FINSI;

     |MENAV "    RECOGIDOS FICHEROS DE AMORTIZACIONES";
|FPRC;

|| ***********************************************************************

|PROCESO Pase12;  |TIPO 12;
 |SI #0#11 = "NO"; |ACABA; |FINSI;

 enEmpresa  = #0#5;
 enPeriodo  = #0#6;
 enEmpresaV = #0#1;
 enPeriodoV = #0#2;
 |SI nSinDatos = 1;
     enEmpresaV = enEmpresa;
     enPeriodoV = enPeriodo;
 |FINSI;

 |HAZ DirAplicSt;
 |SI #0#9 ! "A";
     |HAZ DatosContagen;
 |FINSI;
 |SI #0#9 ! "D";
     |HAZ DatosAmortiza;
 |FINSI;

 |SI nSinDatos = 0;
    |SI #5#16 = "S";
        |ABRE #30;
        #30#2 = #0#5;
        #30#3 = #0#6;
        |LEE 101#30=;
        |SI FSalida = 0;
            #30#34 = #5#15;
            |GRABA 020#30a;
        |FINSI;
        |LIBERA #30;
        |CIERRA #30;
    |FINSI;
 |FINSI;
 |HAZ PreparaDir;
|FPRC;

|PROGRAMA;
   aParam = PARAMETRO; |QBF aParam;

   |SI aParam = "ARCHIVAR";
       |DDEFECTO #0;
       #0#1  = enEmpArch;
       #0#2  = enPerArch;
       #0#3  = eaNomArch;
       #0#4  = enAnyArch;
       #0#22 = eaNifArch;

       #0#5  = enEmpNuev;
       #0#6  = enPerNuev;
       #0#7  = eaNomArch;
       #0#8  = enAnyArch;
       #0#21 = "A";
       #0#23 = eaNifArch;
       #0#20 = efFecArch;
       #0#9  = "D";
       #0#11 = "SI";
       #0#12 = eaPathArc;
       |HAZ PreparaFich;
       |HAZ Pase12;
   |SINO;
       |MANTE #0;
   |FINSI;
|FPRO;
