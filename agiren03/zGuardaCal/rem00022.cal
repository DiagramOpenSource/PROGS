|FICHEROS;
     reparame #1;
     rem00022 #20;
     rem00043 #43,MANTE;
     rem00038 #38;
     rem00041 #41;
     rem99999 #666;
     espejo@ #99;
|FIN;

|VARIABLES;
     aAlfa         = "";
     aAlfa1        = "";
     aAlfa2        = "";
     aAlfa3        = "";
     aLong         = "";
     aQueQuiero    = "";
     aNumCampos    = "";
     aNumPanta     = "";
     aPathRenta    = "";
     aDef          = "";
     aDescri       = "";

     nLong         = 0;
     nCaracter     = 0;
     nPosi         = 0;
     nPanta        = 0;
     nNumCampos    = 0;
     nNumPanta     = 0;
     nCampo        = 0;
     nModo         = 0;
     nEntrada      = 0;
     nPtas         = 0;
     nRetencion    = 0;
     nCampo15      = 0;
     nCampo16      = 0;
     nCampo17      = 0;
     nCampo20      = 0;
     nCampo27      = 0;
     nValor        = 0;
     nDias         = 0;
     nAnyoVenta    = 0;
     nAnyoCompra   = 0;
     nDiferencia   = 0;
     nCoefi        = 0;
     nLinea        = 0;
     nImputable    = 0;
     nContenido    = 0;

     fFechaAdq     = @;
     fFechaTra     = @;
     fFecha1       = @;
     fFecha2       = @;

     &enEmpresa    = 0;
     &enModo       = 0;
     &eaDeclarante = "";
     &enComunes    = 0;
     &enMinusvalia = 0;
     &eaMinuAyuda  = "";
     &eaFallece    = "";
     &eaSwVarios   = "";
     &eaVarDni     = "";
     &enSwLiquida  = 0;
     &enSwRetorno  = 0;
     &eaPrograma   = "";
     &eaPunto      = "";

     &eaLetra      = "";
     &eaDeDonde    = "";
     &eaLinDonde   = "";
     &eaAnyoUsu    = "";
     &eaEdadDec    = "";
     &eaPatr06     = "";
     &eaPatr07     = "";
     &eaPatr08     = "";
     &eaPatr09     = "";
     &eaPatr10     = "";
     &eaPatr11     = "";
     &eaPatr12     = "";
     &eaPatr13     = "";
     &eaPatr14     = "";
     &eaPatr15     = "";
     &eaPatr16     = "";
     &eaPatr17     = "";
     &eaPatr18     = "";
     &eaPatr19     = "";
     &eaPatr20     = "";
     &eaPatr21     = "";
|FIN;

|| ************************************************************************
|| PROCESOS DE CONSULTA DE PANTALLAS NORMALES
|| ************************************************************************

|PROCESO FechaTope;
     |SI #43#6 > #43#2;
         |MENAV "      Fecha Compra es Superior a la Fecha Operacion.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Operacion;
     |C_M #43#6,  1, "S";
     |C_M #43#7,  1, "S";
     |C_M #43#10, 1, "S";

     |SI #43#4 = "C";
         |C_M #43#6,  1, "N";
         |C_M #43#10, 1, "N";  #43#10 = 0;
         |C_M #43#11, 1, "N";  #43#11 = 0;

         #43#9 = "01.01.0000";
         #43#6 = #43#2;
     |FINSI;

     |SI #43#4 = "V";
         #43#9 = #43#2;
         |SI #43#9 < "01.01.2003";  |O #43#9 > "31.12.2003";
             |MENAV "    No puede ser una Venta. La Fecha no corresponde al Ejercicio";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |PINTA #43#6;
     |PINTA #43#9;
     |PINTA #43#10;
     |PINTA #43#11;
|FPRC;

|PROCESO Totalm043;
     #43#8  = #43#5 * #43#7;
     #43#11 = #43#5 * #43#10;

     |PINTA #43#8;
     |PINTA #43#11;
|FPRC;

|RUTINA ClaveBaja43;
     #43#0 = #20#0;
     #43#1 = #20#1;
     #43#2 = "01.01.1900";
     #43#3 = 1;
|FRUT;

|RUTINA ClaveAlta43;
     #43#0 = #20#0;
     #43#1 = #20#1;
     #43#2 = "31.12.2003";
     #43#3 = 99;
|FRUT;

|PROCESO Tipo7m20;  |TIPO 7;
     |ENTLINEAL #1#43, 3, 7, 22, 0, ClaveBaja43, ClaveAlta43;
|FPRC;

|PROCESO Lineal; |TIPO 0;
     |SI FSalida = 2;  |ACABA;  |FINSI;

     |ENTLINEAL #1#43, -3, 2, 22, 0, ClaveBaja43, ClaveAlta43;

     |HAZ Tipo7m20;
|FPRC;

|PROCESO Usufructuario;
     |C_M #20#14, 1, "S";
     |SI #20#13 ! "N";
         |C_M #20#14, 1, "N";  #20#14 = 0;  |PINTA #20#14;
     |FINSI;
|FPRC;

|PROCESO nContenido;
     nContenido = Contenido;
     |SI #20Campo ! nContenido;
         #20#21 = #20#19 % #20#20;   |PINTA #20#21;
         #20#24 = #20#19 % #20#23;   |PINTA #20#24;
     |FINSI;
|FPRC;

|PROCESO Incremento;
     |SI #20#20 ! 40;  |Y #20#20 ! 25;  |Y #20#20 ! 0;
         |MENAV  "     Porcentaje incremento incoherente, el 25% o 40%";
         |ERROR;
         |ACABA;
     |FINSI;

     nContenido = Contenido;
     |SI #20Campo ! nContenido; |O #20#21 = 0;
         #20#21 = #20#19 % #20#20;
     |FINSI;

     |ABRE #1;
     |LEE 040#1p;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |SI #1#18 = "S";
         #20#25 = #20#20;           |PINTA #20#25;
         #20#26 = #20#19 % #20#25;  |PINTA #20#26;
     |FINSI;
|FPRC;

|PROCESO Retencion;
     nContenido = Contenido;
     |SI #20Campo = nContenido;  |Y #20#24 ! 0;  |ACABA;  |FINSI;

     #20#24 = #20#19 % #20#23;
|FPRC;

|PROCESO DobleImposicion;
     |SI #20#25 = 0;  #20#26 = 0;  |ACABA;  |FINSI;

     |SI #20#20 = 40;
         |SI #20#25 ! 40;
             |MENAV "     La Doble Imposicion debe ser 40%";
             #20#25 = 40;
         |FINSI;
     |FINSI;

     |SI #20#20 = 25;
         |SI #20#25 ! 25;
             |MENAV "     La Dobre Imposicion debe ser 25%";
             #20#25 = 25;
         |FINSI;
     |FINSI;

     |SI #20#20 = 0;
         |SI #20#25 ! 10;  |Y #20#25 ! 5;
             |MENAV "     La Dobre Imposicion debe ser 5% O 10%";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     nContenido = Contenido;
     |SI #20Campo = nContenido;  |Y #20#26 ! 0;  |ACABA;  |FINSI;

     #20#26 = #20#19 % #20#25;
|FPRC;

|PROCESO Totalm020;
     #20#22 = #20#19 + #20#21;

     |PINTA #20#21;
     |PINTA #20#22;
     |PINTA #20#24;
     |PINTA #20#25;
     |PINTA #20#26;
|FPRC;


|PROCESO Varios;  |TIPO 7;
     |C_M #20#5,  1, "N";
     |C_M #20#6,  1, "N";
     |C_M #20#7,  1, "N";
     |C_M #20#8,  1, "N";
     |C_M #20#9,  1, "N";
     |C_M #20#10, 1, "N";

     aAlfa = eaSwVarios;
     aLong = aAlfa % 0;
     nLong = aLong;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPosi = (100 * nCaracter) + 1;
           aAlfa1 = aAlfa % nPosi;
           |SI aAlfa1 = "T";  |C_M #20#5,  1, "S";  |FINSI;
           |SI aAlfa1 = "C";  |C_M #20#6,  1, "S";  |FINSI;
           |SI aAlfa1 = "1";  |C_M #20#7,  1, "S";  |FINSI;
           |SI aAlfa1 = "2";  |C_M #20#8,  1, "S";  |FINSI;
           |SI aAlfa1 = "3";  |C_M #20#9,  1, "S";  |FINSI;
           |SI aAlfa1 = "4";  |C_M #20#10, 1, "S";  |FINSI;
     |SIGUE;

     |SI #20#2 ! "VARIOS    ";
         |C_M #20#5,  1, "N";  #20#5  = 0;  |PINTA #20#5;
         |C_M #20#6,  1, "N";  #20#6  = 0;  |PINTA #20#6;
         |C_M #20#7,  1, "N";  #20#7  = 0;  |PINTA #20#7;
         |C_M #20#8,  1, "N";  #20#8  = 0;  |PINTA #20#8;
         |C_M #20#9,  1, "N";  #20#9  = 0;  |PINTA #20#9;
         |C_M #20#10, 1, "N";  #20#10 = 0;  |PINTA #20#10;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja20;
     #20#0 = enEmpresa;
     #20#1 = 1;
|FRUT;

|RUTINA ClaveAlta20;
     #20#0 = enEmpresa;
     #20#1 = 99;
|FRUT;

|PROCESO PonDeclarante;  |TIPO 7;
     eaDeclarante = #20#2;
     enComunes    = 1;
     |HAZ SacaDeclarantes;
     #20#2 = eaDeclarante;
     |PINTA #20#2;
|FPRC;

|PROCESO Fallece;  |TIPO 7;
     |SI eaFallece = "S";
         |C_M #20#4, 1, "S";
     |SINO;
         |C_M #20#4, 1, "N";  #20#4 = 0;  |PINTA #20#4;
     |FINSI;
|FPRC;

|PROCESO Total38;
     nValor = #38#15 - #38#16;
     |SI nValor < 0;
         #38#17 = -nValor;
         #38#18 = -nImputable;
         |SI #38#18 = 0;  #38#18 = #38#17;  |FINSI;
     |SINO;
         #38#19 = nValor;
         #38#21 = #38#19 - #38#20;
         #38#22 = nImputable;
         |SI #38#20 > #38#19;
             #38#20 = #38#19;
             #38#21 = 0;
             #38#22 = 0;
         |FINSI;

         |SI #38#22 = 0;  #38#22 = #38#21;  |FINSI;
      |FINSI;
|FPRC;

|PROCESO El38;
     #38#0 = #20#0;
     #38#1 = 99;
     |LEE 040#38];
     |SI FSalida = 0;
         |LEE 040#38a;
     |SINO;
         |LEE 040#38u;
     |FINSI;

     |SI FSalida = 0; |Y #38#0 = #20#0;
         nLinea = #38#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |DDEFECTO #38;
     #38#0  = #20#0;
     #38#1  = nLinea;
     |PARA nCampo = 2;  |SI nCampo [ 10;  |HACIENDO nCampo = nCampo + 1;
           #38nCampo = #20nCampo;
     |SIGUE;
     #38#3  = "R";
     |SI #20#3 = "X";  #38#3 = "X";  |FINSI;
     #38#11 = aDescri;
     #38#12 = "N";
     #38#13 = fFechaAdq;
     #38#14 = fFechaTra;
     #38#15 = nCampo15;
     #38#16 = nCampo16;

     |HAZ Total38;

     #38#27 = "C1";
     #38#28 = #20#1;
     |GRABA 020#38n;
     |LIBERA #38;

     eaPrograma   = "rem00038";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO Total41;
     aAlfa1      = #41#14 % -104;
     aAlfa3      = #41#14 % 0105;
     aAlfa2      = #41#15 % -104;
     nAnyoCompra = aAlfa1;
     nAnyoVenta  = aAlfa2;
     nDiferencia = nAnyoVenta - nAnyoCompra;

     |SI aAlfa3 = "31.12";  nAnyoCompra = nAnyoCompra + 1;  |FINSI;

     #41#18 = 1;
     #41#19 = #41#17 * #41#18;
     #41#21 = #41#19 - #41#20;

     nValor = #41#16 - #41#21;
     |SI nValor < 0;
         #41#22 = -nValor;
         #41#23 = -nImputable;
         |SI #41#23 = 0;  #41#23 = #41#22;  |FINSI;
     |SINO;
         #41#24 = nValor;

         #41#25 = (1996 - nAnyoCompra) + 1;
         nCoefi = 0;
         |SI #41#25 ] 3;
             nCoefi = (#41#25 - 2) * 25;
         |FINSI;
         |SI nCoefi > 99; nCoefi = 100; |FINSI;
         |SI nCoefi [ 100;
             #41#26 = #41#24 % (100 - nCoefi);
         |FINSI;

         #41#28 = #41#26 - #41#27;
         #41#29 = nImputable;
         |SI #41#29 = 0;  #41#29 = #41#28;  |FINSI;

         |SI #41#27 > #41#26;
             #41#27 = #41#26;
             #41#28 = 0;
             #41#29 = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO El41;
     #41#0 = #20#0;
     #41#1 = 99;
     |LEE 040#41];
     |SI FSalida = 0;
         |LEE 040#41a;
     |SINO;
         |LEE 040#41u;
     |FINSI;

     |SI FSalida = 0; |Y #41#0 = #20#0;
         nLinea = #41#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |DDEFECTO #41;
     #41#0  = #20#0;
     #41#1  = nLinea;
     |PARA nCampo = 2;  |SI nCampo [ 10;  |HACIENDO nCampo = nCampo + 1;
           #41nCampo = #20nCampo;
     |SIGUE;
     #41#3  = "R";
     |SI #20#3 = "X";  #41#3 = "X";  |FINSI;
     #41#11 = aDescri;
     #41#12 = "N";
     #41#13 = "A";
     #41#14 = fFechaAdq;
     #41#15 = fFechaTra;
     #41#16 = nCampo15;
     #41#17 = nCampo16;

     |HAZ Total41;

     #41#34 = "C1";
     #41#35 = #20#1;
     |GRABA 020#41n;
     |LIBERA #41;

     eaPrograma   = "rem00041";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|PROCESO PuntosG;
     |SI #43#11 = 0;  |ACABA;  |FINSI;

     ||nDias      = (#43#9 - #43#6) + 1;
     nDias      = #43#9 - #43#6;
     aDescri    = #20#17;
     fFechaAdq  = #43#6;
     fFechaTra  = #43#9;
     nCampo15   = #43#11 - #43#13;
     nCampo16   = #43#8  + #43#12;
     nImputable = 0;
     |SI nDias [ 365;  |HAZ El38;  |FINSI;
     |SI nDias > 365;  |HAZ El41;  |FINSI;
|FPRC;

|DEFBUCLE rem00043;
     #43#1;
     4;
     #20#0, #20#1, "01.01.1900", 01, "V";
     #20#0, #20#1, "31.12.2999", 99, "V";
     be;
     NULL, PuntosG;
|FIN;

|PROCESO Borra38;
     |BORRA 020#38a;
     |LIBERA #38;

     eaPrograma   = "rem00038";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|DEFBUCLE rem00038;
     #38#1;
     27, 28;
     #20#0, 01, "C1", #20#1;
     #20#0, 99, "C1", #20#1;
     be;
     NULL, Borra38;
|FIN;

|PROCESO Borra41;
     |BORRA 020#41a;
     |LIBERA #41;

     eaPrograma   = "rem00041";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRC;

|DEFBUCLE rem00041;
     #41#1;
     34, 35;
     #20#0, 01, "C1", #20#1;
     #20#0, 99, "C1", #20#1;
     be;
     NULL, Borra41;
|FIN;

|PROCESO Borra43;
     |BORRA 020#43a;
     |LIBERA #43;
|FPRC;

|DEFBUCLE rem00043B;
     #43#1;
     ;
     #20#0, #20#1, "01.01.1900", 01;
     #20#0, #20#1, "31.12.2999", 99;
     be;
     NULL, Borra43;
|FIN;

|PROCESO Patrimonio;
     |SI #20#3  = "R";           |ACABA;  |FINSI;
     |SI #20#3  = "X";           |ACABA;  |FINSI;
     |SI #20#2  = "1 FAMILIAR";  |ACABA;  |FINSI;
     |SI #20#2  = "2 FAMILIAR";  |ACABA;  |FINSI;
     |SI #20#2  = "3 FAMILIAR";  |ACABA;  |FINSI;
     |SI #20#2  = "4 FAMILIAR";  |ACABA;  |FINSI;
     |SI #20#15 = 0;             |ACABA;  |FINSI;

     |HAZ LimpiaPatrim;

     eaLetra    = #20#11;
     eaDeDonde  = "C0";
     eaLinDonde = #20#1;
     eaAnyoUsu  = #20#14;
     eaPatr06   = #20#17;
     eaPatr16   = #20#13;
     eaPatr10   = #20#15;
     |SI #20#11 = "E1";  eaPatr13 = #20#18;  |FINSI;
     eaPatr20   = #20#5;
     eaPatr21   = #20#6;

     |HAZ GrabaPatrimonio;
|FPRC;

|PROCESO Tipo2m20;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;

     nEntrada = 0 +. 1;
     |SI nEntrada ! 1;
         |BUCLE rem00038;
         |BUCLE rem00041;

         eaDeDonde  = "C0";
         eaLinDonde = #20#1;
         eaLetra    = #20#11;
         |HAZ BorraPatrimonio;
     |FINSI;

     |SI nModo = 1;  |O nModo = 3;
         |SI nModo = 3;
             |BUCLE rem00043B;
             enSwRetorno  = 1;
             |ACABA;
         |FINSI;
         enSwRetorno  = 1;
     |FINSI;

     |SI nEntrada ! 1;
         |PARA nCampo = 0;  |SI nCampo [ nNumCampos;  |HACIENDO nCampo = nCampo + 1;
               #99nCampo = #20nCampo;
         |SIGUE;
     |SINO;
         |PARA nCampo = 0;  |SI nCampo [ nNumCampos;  |HACIENDO nCampo = nCampo + 1;
               |SI #99nCampo ! #20nCampo;
                   enSwRetorno  = 1;
               |FINSI;
         |SIGUE;

         |ABRE #38;
         |ABRE #41;
         |BUCLE rem00043;
         |CIERRA #38;
         |CIERRA #41;

         |HAZ Patrimonio;
     |FINSI;
|FPRC;

|PROCESO Tipo11m20;  |TIPO 11;
     |SI FSalida = 10;
         |SUB_EJECUTA_NP "rew00551";
         |ERROR;
     |FINSI;
|FPRC;

|PROGRAMA;
     aQueQuiero = "|NP";
     aNumPanta  = #20#aQueQuiero#;
     nNumPanta  = aNumPanta;
     nNumPanta  = nNumPanta - 1;

     aQueQuiero = "|NC";
     aNumCampos = #20#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |DBASE aPathRenta;  |QBT aPathRenta;
     aDef = aPathRenta + "def/rem00022.mas";
     |CARGA_DEF aDef, espejo@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def rem00022.mas";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     |ENTLINEAL #1#20, -2, enModo, 22, 1, ClaveBaja20, ClaveAlta20;

     |DESCARGA_DEF #espejo@;

     eaPrograma   = "rem00022";
     eaPunto      = "  ";
     |HAZ ProgramaActivo;
|FPRO;
