|FICHEROS;
     reaccdev #0;
     reparame #1;
     rem00100 #2;
     rem00101 #3;

     &clientes@ #715;
     :/integral/def/dsam0004 #790;
     :/integral/def/dsam0000 #791;
|FIN;

|VARIABLES;
     &enEmpresa   = 0;
     &eaNombre    = "";
     &eaNif       = "";
     &enModo      = 0;
     &eaVarDni    = "";
     &enSwHojas   = 0;
     &enCodCli    = 0;
     &enSwDeDonde = 0;

     basica    = "";
     agi       = "";
     agi1      = "";
     agi2      = "";
     aste      = "";
     longi     = "";
     num       = 0;
     nCampo    = 0;

     {-1}mGeneral = "";
     mGeneral1    = "1425";
     mGeneral2    = "1";
     mGeneral3    = "6";
     mGeneral4    = "Datos Personales (Modelo 104)  ";
     mGeneral5    = "Importes Rentas  (Opcional)    ";
     mGeneral6    = "Modelo 104                     ";
     mGeneral7    = "Modelo 105                     ";
     mGeneral8    = "Emision Modelos Hojas Sueltas  ";
     mGeneral9    = "Emision Modelos Hojas Continuo ";

     {-1}mDRenta  = "";
     mDRenta1     = "1850";
     mDRenta2     = "1";
     mDRenta3     = "2";
     mDRenta4     = "Importes Rentas                ";
     mDRenta5     = "Conclusiones                   ";
|FIN;

|INCLUYE i_sepnom;

|PROCESO Tipo8; |TIPO 8;
     |HAZ QueVersion;
|FPRC;

|PROCESO Separa;
     Cadena = #2#5;
     |SI Cadena ! "";
         |HAZ SeparaNombre;
         #2#2 = Cadena1;
         #2#3 = Cadena2;
         #2#4 = Cadena3;
     |FINSI;
|FPRC;

|PROCESO CogeAgifigen;
     #2#0  = #0#0;
     |LEE 101#2=;
     |SI FSalida = 0;  |LIBERA #2;  |ACABA;  |FINSI;

     |DDEFECTO #2;
     #2#0  = #0#0;
     #2#5  = #715#2;  |HAZ Separa;
     #2#1  = #715#13;
     #2#14 = #715#3;
     #2#15 = #715#4;
     #2#16 = #715#5;
     #2#17 = #715#6;
     #2#18 = #715#7;
     #2#19 = #715#8;
     #2#20 = #715#9;
     #2#21 = #715#10;
     #2#22 = #715#11;
     #2#23 =  (("00" + #2#20) % -102) +  (("000" + #2#21) % -103);
     #2#12 = #715#14;
     #2#69 = #715#63;
     #2#70 = #715#64;
     #2#24 = #715#51;
     #2#25 = #715#52;
     #2#26 = #715#53;
     #2#27 = #715#54;
     #2#28 = #715#55;
     #2#29 = #715#56;
     #2#30 = #715#57;
     #2#31 = #715#58;
     #2#32 = #715#59;
     #2#33 =  (("00" + #2#31) % -102) +  (("000" + #2#32) % -103);

     |GRABA 020#2n;
     |LIBERA #2;
|FPRC;

|PROCESO MiraAgifigen;
     |ABRE #2;
     |ABRE #715;
     #715#0 = #0#0;
     |LIBERA #715;
     |LEE 101#715=;
     |SI FSalida = 0;                || Recoge variables del basica
         #715#22 = "S";
         |GRABA 020#715a;                 || Graba el basica

         |HAZ CogeAgifigen;

         #0#1  = #715#2;     |PINTA #0#1;
         #0#2  = #715#13;    |PINTA #0#2;
    |SINO;
         |CONFI "2400S Confirma el alta en Clientes General : ";
         |SI FSalida = 0;
             |PUSHV 0501 2380;
             |PINPA #0#715;
             |DDEFECTO #715;
             |PINDA #0#715;
             #715#0 = #0#0; |PINTA #715#0;
             |ENDATOS #1#715;
             |SI FSalida = 0;
                 #715#22 = "S";
                 |GRABA 121#715n;                 || Graba el basica

                 |HAZ CogeAgifigen;

                 #0#1  = #715#2;     |PINTA #0#1;
                 #0#2  = #715#13;    |PINTA #0#2;
             |FINSI;
             |POPV;
        |FINSI;
     |FINSI;

     |CIERRA #2;
     |CIERRA #715;
|FPRC;

|PROCESO GrabaFamiliar;
     |PARA nCampo = 0;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
           #3nCampo = #790nCampo;
     |SIGUE;
     |GRABA 020#3n;
     |LIBERA #3;
|FPRC;

|DEFBUCLE dsam0004;
     #790#1;
     ;
     #0#0, 00;
     #0#0, 99;
     ;
     NULL, GrabaFamiliar;
|FIN;

|PROCESO MiraIntegrada;
     |ABRE #2;
     #2#0 = #0#0;
     |LEE 101#2=;
     |SI FSalida = 0;  |CIERRA #2;  |ACABA;  |FINSI;

     |ABRE #715;
     #715#0 = #0#0;
     |LIBERA #715;
     |LEE 040#715=;
     |SI FSalida ! 0;
         |MENAV "     No Existe Cliente ";
         |CIERRA #715;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #715;

     |PARA nCampo = 0;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
           #2nCampo = #715nCampo;
     |SIGUE;

     #2#88 = #715#61;
     #2#89 = #715#62;
     #2#93 = #715#63;
     #2#94 = #715#64;
     #2#95 = #715#65;

     |GRABA 020#2n;
     |LIBERA #2;

     |BUCLE dsam0004;

     |ABRE #791;
     #791#0 = #715#0;
     |LEE 101#791=;
     |SI FSalida = 0;
         #791#68 = "S";
         |GRABA 020#791a;
         |LIBERA #791;
     |FINSI;
     |CIERRA #791;

     #0#1  = #715#5;     |PINTA #0#1;
     #0#2  = #715#1;     |PINTA #0#2;
|FPRC;

|PROCESO Altacli;
     enModo = (FEntrada / 100) ! 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     enCodCli = #0#0;
     |HAZ LeePersona;
     |SI enSwDeDonde = 1;
         |ABRE #3;
         |HAZ MiraIntegrada;
         |CIERRA #3;
     |SINO;
         |HAZ MiraAgifigen;
     |FINSI;
|FPRC;

|PROCESO Modicli;
     enCodCli = #0#0;
     |HAZ LeePersona;

     |SI enSwDeDonde = 1;
         |SI #0#2 ! #715#1;
            |MENAV "     D.N.I. del Cliente es distinto al D.N.I. del Cliente General";
         |FINSI;
     |SINO;
         |SI #0#2 ! #715#13;
            |MENAV "     D.N.I. del Cliente es distinto al D.N.I. del Cliente General";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO mDRenta;
     |PUSHV 0501 2380;
     |PARA; |SI; |HACIENDO;
            |MENUG mDRenta;
            mDRenta2 = FSalida;
            |SI mDRenta2 < "1";  |O mDRenta2 > "2";  |SAL;  |FINSI;

            |SI mDRenta2 = "1";   |HAZ ImportesRentas;  |FINSI;
            |SI mDRenta2 = "2";   |HAZ Conclusiones;    |FINSI;
     |SIGUE;
     |POPV;
|FPRC;

|PROCESO Pantalla;
     enEmpresa    = #0#0;
     eaNombre     = #0#1;
     eaNif        = #0#2;
     |PARA; |SI; |HACIENDO;
            |MENUG mGeneral;
            mGeneral2 = FSalida;
            |SI mGeneral2 < "1";  |O mGeneral2 > "6";  |SAL;  |FINSI;
            |SI mGeneral2 = "1";
                |SUB_EJECUTA "rem00100";
                #0#1 = eaNombre;  |PINTA #0#1;
            |FINSI;
            |SI mGeneral2 = "2";  |HAZ mDRenta;      |FINSI;
            |SI mGeneral2 = "3";  |HAZ Modelo104;    |FINSI;
            |SI mGeneral2 = "4";  |HAZ Modelo105;    |FINSI;
            |SI mGeneral2 = "5"; enSwHojas = 0; |HAZ EmiteModelos; |FINSI;
            |SI mGeneral2 = "6"; enSwHojas = 1; |HAZ EmiteModelos; |FINSI;
     |SIGUE;
     |PINPA #0#0;
|FPRC;

|PROCESO LetraNif;  |TIPO 6;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     eaVarDni = #0Campo;
     |HAZ CalculoDNI;
     #0Campo = eaVarDni;
     |PINTA #0Campo;
     |ERROR;
|FPRC;

|PROCESO Contador; |TIPO 7;
     enModo = (FEntrada / 100) ! 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     |ABRE #1;
     |LEE 101#1p;
     |SI FSalida ! 0; |DDEFECTO #1; #1#9 = 1; |GRABA 020#1b; |FINSI;
     |LIBERA #1;
     |CIERRA #1;

     |SI #1#8 = "A"; #0#0 = #1#9; |PINTA #0#0; |FINSI;
|FPRC;

|PROCESO Acceso;  |TIPO 3;
     enModo = (FEntrada / 100) ! 0;

     |SI enModo = 2; |HAZ Modicli; |FINSI;
     |SI enModo = 1; |O enModo = 2;
         |HAZ Pantalla;
     |FINSI;

     |SI enModo = 1;
         |ABRE #1;
         |LEE 101#1p;
         |SI #1#8 = "A";
             #1#9 = #0#0 + 1;
             |GRABA 020#1a;
         |FINSI;
         |LIBERA #1;
         |CIERRA #1;
     |FINSI;
|FPRC;

|PROCESO Consulta; |TIPO 13;
     |SI #0#0 = 0;  |ACABA;  |FINSI;

     enModo = (FEntrada / 100) ! 0;
     |SI enModo ! 4;  |ACABA;  |FINSI;
     |PINTA #0#0;
     |PINTA #0#1;
     |PINTA #0#2;
     |HAZ Pantalla;
|FPRC;

|PROCESO Borrado; |TIPO 2;
     enEmpresa = #0#0;
     eaNombre  = #0#1;
     enModo = (FEntrada / 100) ! 0;
     |SI enModo ! 3;  |ACABA;  |FINSI;

     |PINTA 2430,"Borrando Registros ....";

     |SUB_EJECUTA "reborra1";

     |PINTA 2430,"                       ";
|FPRC;
