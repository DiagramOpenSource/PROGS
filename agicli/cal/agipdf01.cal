|FICHEROS;
     agiapl00;
     agiapl01;
     agifigen;
     agiapl25;
     agipdf01;

     pdfimtmp;
|FIN;

|VARIABLES;
    aFechaBon = "";
    aDia  = "";
    aMes  = "";
    aAny  = "";

    vari1   = "";
    vari2   = "";
    xxx     = 0;
    zzz     = 0;
    nCampo  = 0;
    nSal    = 0;

    nTope1  = 0;
    nTope2  = 0;
    &EURODB = 0;
    &aM     = "";
    &enTope = 0;

    &aArchivo = "";  ||Campos PDF
    &aID      = "";
    nSwNum    = 0;

    aAlfa     = "";
    aAlfa1    = "";
    aAlfa2    = "";
    aAlfa3    = "";
    aAlfa4    = "";
    aLong     = "";
    nLong     = 0;
    nLong1    = 0;
    nLong2    = 0;
    nNume1    = 0;
    nNume2    = 0;
    nNume3    = 0;
    nNume4    = 0;
    nPara1    = 0;

    aValor    = "";
    swCarga   = 0;
    aCampo    = "";
    nTipo     = 0;

    aLongitud    = "";
    nLongitud    = "";
    aCaracter    = "";
    aCaracterSal = "";
    aCadena      = "";
    aCadenaSal   = "";
    nPos         = 0;
    nBusca       = 0;
    nAscii       = 0;
    nLinea       = 0;
    aBase        = "";
    aPath        = "";

    fFecha       = @;

    nConta       = 0;

    &eaPrograma  = "";
    &eaExtension = "";
    &eaCta       = "";
    &eaPais      = "";
    &eaIBAN      = "";
|FIN;

|PROCESO LaFecha;
     aFechaBon = "";
     aDia  = #agipdf01#30 % 102;
     aMes  = #agipdf01#30 % 402;
     aAny  = #agipdf01#30 % -104;

     |SI aMes = "01"; aMes = "Enero";      |FINSI;
     |SI aMes = "02"; aMes = "Febrero";    |FINSI;
     |SI aMes = "03"; aMes = "Marzo";      |FINSI;
     |SI aMes = "04"; aMes = "Abril";      |FINSI;
     |SI aMes = "05"; aMes = "Mayo";       |FINSI;
     |SI aMes = "06"; aMes = "Junio";      |FINSI;
     |SI aMes = "07"; aMes = "Julio";      |FINSI;
     |SI aMes = "08"; aMes = "Agosto";     |FINSI;
     |SI aMes = "09"; aMes = "Septiembre"; |FINSI;
     |SI aMes = "10"; aMes = "Octubre";    |FINSI;
     |SI aMes = "11"; aMes = "Noviembre";  |FINSI;
     |SI aMes = "12"; aMes = "Diciembre";  |FINSI;

     aAlfa1 = #agipdf01#26; |QBF aAlfa1;
     |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + ", "; |FINSI;
     aFechaBon = aAlfa1 + aDia + " de " + aMes + " de " + aAny;
|FPRC;

|PROCESO Defectos; |TIPO 7;
     |ABRE #agiapl25;
     |LEE 040#agiapl25.p;
     |SI FSalida = 0;
         #agipdf01#24 = #agiapl25#11;
         #agipdf01#25 = #agiapl25#12;
         #agipdf01#27 = #agiapl25#14;
         #agipdf01#28 = #agiapl25#15;
         #agipdf01#29 = #agiapl25#16;
     |FINSI;
     |CIERRA #agiapl25;

     |PINDA #0#agipdf01;
|FPRC;

|PROCESO Parrilla; |TIPO 0;
     vari1 = #agipdf01#0;
     vari2 = "N";
     |SI #agipdf01#0 = "N"; vari2 = "S"; |FINSI;

     #agipdf01#1 = 1;
     #agipdf01#2 = 999999;

     |CAMPO_MODIFICA #agipdf01#1, 1, vari2;
     |CAMPO_MODIFICA #agipdf01#2, 1, vari2;

     |PARA xxx = 3; |SI xxx [ 23; |HACIENDO xxx = xxx + 1;
           #agipdf01#xxx# = 0;
           |CAMPO_MODIFICA #agipdf01#xxx#, 1, vari1;
     |SIGUE;

     |PINDA #0#agipdf01;
|FPRC;

|PROCESO NoMasAplaza; |TIPO 0;
     |SI #agiapl00#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               #agiapl00#nCampo# = 0;  |C_M #agiapl00#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
               |C_M #agiapl00#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

||-------------------------------------------------------

|PROCESO impre_01;
     nLinea = nLinea + 1;
     |SI nLinea > 7;
         |MENAV "    Error, este aplazamiento tiene mas de 7 lineas";
         |ERROR10;
     |SINO;
         nNume1 = nLinea + 30 + ((nLinea - 1) * 5);  #agipdf01#nNume1# = #agiapl01#2;
         nNume1 = nNume1 + 1;   #agipdf01#nNume1# = #agiapl01#3;
         nNume1 = nNume1 + 1;   #agipdf01#nNume1# = #agiapl01#4;
         nNume1 = nNume1 + 1;   #agipdf01#nNume1# = #agiapl01#5;
         nNume1 = nNume1 + 1;   #agipdf01#nNume1# = #agiapl01#6;
         nNume1 = nNume1 + 1;   #agipdf01#nNume1# = #agiapl01#7;
     |FINSI;
|FPRC;

|DEFBUCLE agiapl01;
     #agiapl01#1;
     ;
     #agiapl00#0, 00;
     #agiapl00#0, 99;
     ;
     NULL, impre_01;
|FIN;

|PROCESO GrabaTmp;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO GrabaTmpNum;
     |SI aValor = "0";  |ACABA;  |FINSI;

     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO GrabaTmpFec;
     fFecha = aValor;
     |SI fFecha [ "01.01.1900";  |ACABA;  |FINSI;

     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO CalcuValor;
     nSal = 0

     |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     aLong  = aValor % 0;  nLong1 = aLong;
     |SI nLong1 ] 220;  nSal = 1;  |ACABA;  |FINSI;

     aLong  = aAlfa  % 0;  nLong2 = aLong;
     nLong  = nLong1 + nLong2;
     |SI nLong [ 220;
         aValor = aValor  + aAlfa + "\r";
     |SINO;
         nLong = 100 + (220 - nLong1);
         aValor = aValor  + (aAlfa % nLong) +  "\r";
         nSal   = 1;
     |FINSI;
|FPRC;

|PROCESO GrabaCampos;
     nTipo  = 0;

     aCampo = "dato.1";       aValor = #agipdf01#25;   |HAZ GrabaTmp;
     aCampo = "dato.2";       aValor = #agifigen#1;    |HAZ GrabaTmp;
     aCampo = "dato.nif.2";   aValor = #agifigen#13;   |HAZ GrabaTmp;
     aCampo = "dato.4";       aValor = #agifigen#3;    |HAZ GrabaTmp;
     aCampo = "dato.13";      aValor = #agifigen#3;    |HAZ GrabaTmp;
     aCampo = "dato.5";       aValor = #agifigen#4;    |HAZ GrabaTmp;
     aCampo = "dato.14";      aValor = #agifigen#4;    |HAZ GrabaTmp;
     aCampo = "dato.6";       aValor = #agifigen#5;    |HAZ GrabaTmp;
     aCampo = "dato.15";      aValor = #agifigen#5;    |HAZ GrabaTmp;
     aCampo = "dato.7";       aValor = #agifigen#6;    |HAZ GrabaTmp;
     aCampo = "dato.16";      aValor = #agifigen#6;    |HAZ GrabaTmp;
     aCampo = "dato.8";       aValor = #agifigen#7;    |HAZ GrabaTmp;
     aCampo = "dato.17";      aValor = #agifigen#7;    |HAZ GrabaTmp;
     aCampo = "dato.9";       aValor = #agifigen#8;    |HAZ GrabaTmp;
     aCampo = "dato.18";      aValor = #agifigen#8;    |HAZ GrabaTmp;
                              aValor = (("00" + #agifigen#9) % -102) + (("000" + #agifigen#10) % -103);
     aCampo = "dato.10";                               |HAZ GrabaTmp;
     aCampo = "dato.19";                               |HAZ GrabaTmp;
     aCampo = "dato.11";      aValor = #agifigen#11;   |HAZ GrabaTmp;
     aCampo = "dato.20";      aValor = #agifigen#11;   |HAZ GrabaTmp;
     aCampo = "dato.12";      aValor = #agifigen#12;   |HAZ GrabaTmp;
     aCampo = "dato.21";      aValor = #agifigen#12;   |HAZ GrabaTmp;

     nConta = 0;
     |PARA nNume1 = 24;  |SI nNume1 [ 29;  |HACIENDO nNume1 = nNume1 + 1;
           nNume2 = nNume1 + 7;
           nConta = nConta + 1;
           nSwNum = 0;

           |SI nConta  = 1;
               aAlfa1 = #agipdf01#nNume2#; |QBF aAlfa1;
               |SI aAlfa1 = "";  nSwNum = 1; |FINSI;
           |FINSI;

           |SI nConta  = 2;
               aAlfa1 = #agipdf01#nNume2#; |QBF aAlfa1;
               |SI aAlfa1 = "";  nSwNum = 1; |FINSI;
           |FINSI;

           |SI nConta  = 3;
               |SI #agipdf01#nNume2# [ "01.01.1900";
                    nSwNum = 1;
               |FINSI;
           |FINSI;

           |SI nConta  ] 4;
               |SI #agipdf01#nNume2# = 0;  nSwNum = 1; |FINSI;
           |FINSI;

           |SI nSwNum = 0;
               aCampo = "dato." + nNume1;
               aValor = #agipdf01#nNume2#;
               |HAZ GrabaTmp;
           |FINSI;
     |SIGUE;

     nConta = 0;
     |PARA nNume1 = 38;  |SI nNume1 [ 73;  |HACIENDO nNume1 = nNume1 + 1;
           nSwNum = 0;
           nNume2 = nNume1 - 1;
           nConta = nConta + 1;
           |SI nConta > 6;  nConta = 1;  |FINSI;

           |SI nConta  = 1;
               aAlfa1 = #agipdf01#nNume2#; |QBF aAlfa1;
               |SI aAlfa1 = "";  nSwNum = 1; |FINSI;
           |FINSI;

           |SI nConta  = 2;
               aAlfa1 = #agipdf01#nNume2#; |QBF aAlfa1;
               |SI aAlfa1 = "";  nSwNum = 1; |FINSI;
           |FINSI;

           |SI nConta  = 3;
               |SI #agipdf01#nNume2# [ "01.01.1900";
                    nSwNum = 1;
               |FINSI;
           |FINSI;

           |SI nConta  ] 4;
               |SI #agipdf01#nNume2# = 0;  nSwNum = 1; |FINSI;
           |FINSI;

           |SI nSwNum = 0;
               aCampo = "dato." + nNume1;
               aValor = #agipdf01#nNume2#;
               |HAZ GrabaTmp;
           |FINSI;
     |SIGUE;

     aCampo = "dato.74";      aValor = #agiapl00#6;   |HAZ GrabaTmpNum;
     aCampo = "dato.75";      aValor = #agiapl00#7;   |HAZ GrabaTmpNum;
     aCampo = "dato.76";      aValor = #agiapl00#8;   |HAZ GrabaTmpNum;
     aCampo = "dato.77";      aValor = #agiapl00#9;   |HAZ GrabaTmpNum;
     aCampo = "dato.78";      aValor = #agiapl00#10;  |HAZ GrabaTmpNum;
     aCampo = "dato.79";      aValor = #agiapl00#11;  |HAZ GrabaTmpNum;
     aCampo = "dato.80";      aValor = #agiapl00#12;  |HAZ GrabaTmpNum;
     aCampo = "dato.81";      aValor = #agiapl00#13;  |HAZ GrabaTmpNum;
     aCampo = "dato.82";      aValor = #agiapl00#14;  |HAZ GrabaTmpNum;

     aValor = " ";  |SI #agiapl00#132 = 1; aValor = "S¡";   |FINSI;
     aCampo = "dato.30";                              |HAZ GrabaTmp;
     aCampo = "dato.31";      aValor = #agiapl00#134; |HAZ GrabaTmp;

     |SI #agiapl00#132 = 1;
         eaCta  = #agiapl00#133 + #agiapl00#135 + #agiapl00#136 + #agiapl00#142;
         eaPais = "ES";
         |HAZ CalcuIBAN;

         aCampo = "dato.32";  aValor = eaIBAN % 302;   |HAZ GrabaTmp;
         aCampo = "dato.33";  aValor = eaIBAN % 504;   |HAZ GrabaTmp;
         aCampo = "dato.34";  aValor = eaIBAN % 904;   |HAZ GrabaTmp;
         aCampo = "dato.35";  aValor = eaIBAN % 1304;  |HAZ GrabaTmp;
         aCampo = "dato.36";  aValor = eaIBAN % 1704;  |HAZ GrabaTmp;
         aCampo = "dato.37";  aValor = eaIBAN % 2104;  |HAZ GrabaTmp;
     |FINSI;

     aValor = "";
     |PARA nPara1 = 15; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
           aAlfa = #agiapl00#nPara1#; |QBF aAlfa;

           |HAZ CalcuValor;
     |SIGUE;

     |SI aValor ! "";
         aCampo = "dato.83";
         |HAZ GrabaTmp;
     |FINSI;

     aValor = "";
     |PARA nPara1 = 25; |SI nPara1 [ 34; |HACIENDO nPara1 = nPara1 + 1;
           nNume2 = nPara1 + 10;
           aAlfa  = #agiapl00#nPara1#; |QBF aAlfa;
           |SI aAlfa ! "";
                aAlfa  = "Plazo y vto " + aAlfa;
           |FINSI;

           |SI #agiapl00#nNume2# ! 0;
               aAlfa = aAlfa + " importe:" + #agiapl00#nNume2#;
           |FINSI;

           |HAZ CalcuValor;
           |SI nSal = 1;  |SAL;  |FINSI;
     |SIGUE;

     |SI aValor ! "";
         aCampo = "dato.84";
         |HAZ GrabaTmp;
     |FINSI;

     aValor = "";
     |PARA nPara1 = 45; |SI nPara1 [ 54; |HACIENDO nPara1 = nPara1 + 1;
           aAlfa = #agiapl00#nPara1#; |QBF aAlfa;

           |HAZ CalcuValor;
     |SIGUE;

     |SI aValor ! "";
         aCampo = "dato.85";
         |HAZ GrabaTmp;
     |FINSI;

     aCampo = "dato.86";      aValor = #agiapl00#66;  |HAZ GrabaTmp;
     aCampo = "dato.87";      aValor = #agiapl00#72;  |HAZ GrabaTmpNum;
     aCampo = "dato.88";      aValor = #agiapl00#67;  |HAZ GrabaTmp;
     aCampo = "dato.89";      aValor = #agiapl00#73;  |HAZ GrabaTmpNum;
     aCampo = "dato.90";      aValor = #agiapl00#68;  |HAZ GrabaTmp;
     aCampo = "dato.91";      aValor = #agiapl00#74;  |HAZ GrabaTmpNum;
     aCampo = "dato.92";      aValor = #agiapl00#69;  |HAZ GrabaTmp;
     aCampo = "dato.93";      aValor = #agiapl00#75;  |HAZ GrabaTmpNum;
     aCampo = "dato.94";      aValor = #agiapl00#78;  |HAZ GrabaTmp;
     aCampo = "dato.95";      aValor = #agiapl00#84;  |HAZ GrabaTmpNum;
     aCampo = "dato.96";      aValor = #agiapl00#79;  |HAZ GrabaTmp;
     aCampo = "dato.97";      aValor = #agiapl00#85;  |HAZ GrabaTmpNum;
     aCampo = "dato.98";      aValor = #agiapl00#80;  |HAZ GrabaTmp;
     aCampo = "dato.99";      aValor = #agiapl00#86;  |HAZ GrabaTmpNum;
     aCampo = "dato.100";     aValor = #agiapl00#81;  |HAZ GrabaTmp;
     aCampo = "dato.101";     aValor = #agiapl00#87;  |HAZ GrabaTmpNum;
     aCampo = "dato.102";     aValor = #agiapl00#90;  |HAZ GrabaTmp;
     aCampo = "dato.103";     aValor = #agiapl00#96;  |HAZ GrabaTmpNum;
     aCampo = "dato.104";     aValor = #agiapl00#91;  |HAZ GrabaTmp;
     aCampo = "dato.105";     aValor = #agiapl00#97;  |HAZ GrabaTmpNum;
     aCampo = "dato.106";     aValor = #agiapl00#92;  |HAZ GrabaTmp;
     aCampo = "dato.107";     aValor = #agiapl00#98;  |HAZ GrabaTmpNum;
     aCampo = "dato.108";     aValor = #agiapl00#93;  |HAZ GrabaTmp;
     aCampo = "dato.109";     aValor = #agiapl00#99;  |HAZ GrabaTmpNum;

     aCampo = "dato.110";     aValor = #agiapl00#102; |HAZ GrabaTmp;
     aCampo = "dato.111";     aValor = #agiapl00#108; |HAZ GrabaTmpFec;
     aCampo = "dato.112";     aValor = #agiapl00#114; |HAZ GrabaTmpNum;
     aCampo = "dato.113";     aValor = #agiapl00#103; |HAZ GrabaTmp;
     aCampo = "dato.114";     aValor = #agiapl00#109; |HAZ GrabaTmpFec;
     aCampo = "dato.115";     aValor = #agiapl00#115; |HAZ GrabaTmpNum;
     aCampo = "dato.116";     aValor = #agiapl00#104; |HAZ GrabaTmp;
     aCampo = "dato.117";     aValor = #agiapl00#110; |HAZ GrabaTmpFec;
     aCampo = "dato.118";     aValor = #agiapl00#116; |HAZ GrabaTmpNum;
     aCampo = "dato.119";     aValor = #agiapl00#105; |HAZ GrabaTmp;
     aCampo = "dato.120";     aValor = #agiapl00#111; |HAZ GrabaTmpFec;
     aCampo = "dato.121";     aValor = #agiapl00#117; |HAZ GrabaTmpNum;
     aCampo = "dato.122";     aValor = #agiapl00#120; |HAZ GrabaTmp;
     aCampo = "dato.123";     aValor = #agiapl00#126; |HAZ GrabaTmpNum;
     aCampo = "dato.124";     aValor = #agiapl00#121; |HAZ GrabaTmp;
     aCampo = "dato.125";     aValor = #agiapl00#127; |HAZ GrabaTmpNum;
     aCampo = "dato.126";     aValor = #agiapl00#122; |HAZ GrabaTmp;
     aCampo = "dato.127";     aValor = #agiapl00#128; |HAZ GrabaTmpNum;
     aCampo = "dato.128";     aValor = #agiapl00#123; |HAZ GrabaTmp;
     aCampo = "dato.129";     aValor = #agiapl00#129; |HAZ GrabaTmpNum;
     aCampo = "dato.130";     aValor = #agiapl00#143; |HAZ GrabaTmp;
     aCampo = "dato.133";     aValor = #agiapl00#144; |HAZ GrabaTmpFec;
     aCampo = "dato.134";     aValor = #agiapl00#145; |HAZ GrabaTmp;
     aCampo = "dato.135";     aValor = aFechaBon;     |HAZ GrabaTmp;
|FPRC;

|PROCESO ImpresionPDF;
     aAlfa1 = Usuario; |QBT aAlfa1;
     aAlfa1 = ("c" + aAlfa1) % 108;
     |NOME_DAT #pdfimtmp#aAlfa1#;
     |DELINDEX #pdfimtmp;

     |ABRE #pdfimtmp;

     aArchivo = "aplazah8.pdf";
     swCarga = 0;
     |HAZ GrabaCampos;

     |CIERRA #pdfimtmp;

     |SI swCarga = 0;
         |SUB_EJECUTA_NP "pdfimpre";
     |FINSI;

     |DELINDEX #pdfimtmp;
|FPRC;

|PROCESO Los18000;
     nLinea = 0;

     |PDEFECTO #agipdf01, 31, 73;
     |BUCLE agiapl01;

     |HAZ ImpresionPDF;
     |SI swCarga = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|PROCESO imprimelo;
     |ABRE #agifigen;
     |DDEFECTO #agifigen;
     #agifigen#0 = #agiapl00#1;    ||Empresa
     |LEE  001#agifigen.=;
     |SI FSalida ! 0;
         aAlfa1 = "    Error. No existe Empresa del Aplazamiento n§ " + #agiapl00#0;
         |MENAV aAlfa1;
         |CIERRA #agifigen;
         |ACABA;
     |FINSI;
     |CIERRA #agifigen;

     nTope1 = 18000.00;
     nTope2 = 18000.01;

     aM = "euros";
     |SI EURODB = 0;
         nTope1 = (nTope1 * 166.386) ! EURODB;
         nTope2 = (nTope2 * 166.386) ! EURODB;
         aM = "ptas";
     |FINSI;

     |HAZ Los18000;
|FPRC;

|DEFBUCLE agiapl00;
     #agiapl00#1;
     ;
     #agipdf01#1;
     #agipdf01#2;
     ;
     NULL, imprimelo;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |HAZ LaFecha;

     |SI #agipdf01#0 = "N";
         |BUCLE agiapl00;
     |SINO;
         |ABRE #agiapl00;
         |PARA xxx = 3; |SI xxx [ 23; |HACIENDO xxx = xxx + 1;
               #agiapl00#0 = #agipdf01#xxx#;
               |LEE 040#agiapl00.=;
               |SI FSalida = 0; |HAZ imprimelo; |FINSI;
         |SIGUE;
         |CIERRA #agiapl00;
     |FINSI;
|FPRC;
