|FICHEROS;
    agipaimf #99;  || Este Def -- #0 (agipaimp)

     maacceso #0;   || Acceso al Impuesto
     maempr10 #1;   || Datos Empresas
     maempr02 #2;   || Relacion de Socios
     maempr03 #3;   || Relacion de Administradores
     maempr04 #4;   || Relacion de Representantes
     maempr05 #5;   || Transparencia Fiscal
     maempr06 #6;   || Participaciones otras empresas
     maempr11 #9;   || Caracteres declaracion
     maempr12 #10;  || Transparencia Fiscal Internacional Cabecera
     maempr13 #11;  || Transparencia Fiscal Internacional Lineas
     maempr09 #14;  || CNAE

    agicontr #33;  || Control
    agifigen #44;  || Ficha de Clientes
    agicen01 #45;  || Actividades
    agim0003 #55;  || NIFS represententes
    agim0030 #56;  || Tipo Sociedades

    agim0028 #28;  || Ficha de Sociedades Cabeceras
    agim0019 #19;  || Ficha de Sociedades Lineas
    agim0020 #20;  || Caracteres de la Declaracion

     agim0021 #21;  || Socios Transparencia Fiscal
     agim0022 #22;  || Internacional C Transparencia Fiscal
     agim0023 #23;  || Internacional L Transparencia Fiscal
     agim0024 #24;  || Representantes/Administradores
     agim0025 #25;  || Socios
     agim0026 #26;  || Cargos
     agim0027 #27;  || Participaciones otras empresas
|FIN;

|VARIABLES;
     XCampos         = 0;
     XCampos1        = 0;
     DEmpre          = 0;
     HEmpre          = 0;
     aste            = "";
     nSwGrabar       = 0;
     nValor          = 0;
     nTotal          = 0;

     PathCliente     = "";
     PathSociedad    = "";
     PathPanSociedad = "";

     nCampo75        = 0;
     nCampo76        = 0;
     nCampo85        = 0;
     nCampo86        = 0;
     nCampo87        = 0;
     nCampo88        = 0;
     nCampo89        = 0;
     nNume           = 0;

     aCampo84        = "";
     aAlfa           = "";

     &aplica  = "";
     &codigo  = 0;
     &nombre1 = "";
     &nombre2 = "";
     &cif1    = "";
     &cif2    = "";
     contador = 0;
     sw       = 0;
     codi1    = "";
     codi2    = "";

     &enEmpresa      = 0;
     &enAnyo         = 0;
     &EURODB         = 0;
     nEstado44       = 0;
     nEstado28       = 0;
     nSwSeguir       = 0;
     aSeguir         = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aCif            = "";
     nNumReg         = 0;
     nNumLin         = 0;
     nUlti           = 0;
     aC15            = "";
     fFecha          = @;
|FIN;

|| ****************************** Pantalla
|CALCULO Antes; |TIPO 7;
 fFecha = ~;
 aAlfa  = fFecha;
 aAlfa  = aAlfa % -104;
 #99#26 = aAlfa;
 #99#26 = #99#26 - 1;
 |PINTA #99#26;
|FCAL;

|CALCULO Seleccion; |TIPO 0;
  |SI FSalida = 2;
      |PARA XCampos = 1;  |SI XCampos [ 23;  |HACIENDO XCampos = XCampos + 1;
            |SI #99XCampos = 0;  |C_M #99XCampos, 1, "N";  |FINSI;
      |SIGUE;

      |ACABA;
  |FINSI;

  |C_M #99#24, 1, "N";
  |C_M #99#25, 1, "N";

  |SI #99#0 = 0;
      |C_M #99#24, 1, "S";
      |C_M #99#25, 1, "S";

      |PARA XCampos = 1;  |SI XCampos [ 23;  |HACIENDO XCampos = XCampos + 1;
            |C_M #99XCampos, 1, "N";
            #99XCampos = 0;  |PINTA #99XCampos;
      |SIGUE;

      |ACABA;
  |FINSI;

  XCampos1 = Campo + 1;
  |SI XCampos1 > 23;  XCampos1 = 23;  |FINSI;
  |PARA XCampos = 1;  |SI XCampos [ XCampos1;  |HACIENDO XCampos = XCampos + 1;
        |C_M #99XCampos, 1, "S";
  |SIGUE;

  XCampos1 = Campo + 2;
  |SI #99Campo = 0;  XCampos1 = Campo + 1;  |FINSI;

  |PARA XCampos = XCampos1;  |SI XCampos [ 23;  |HACIENDO XCampos = XCampos + 1;
        |SI #99XCampos = 0;
            |C_M #99XCampos, 1, "N";
        |FINSI;
  |SIGUE;
|FCAL;

|| ********************************************************************
|| ********************************************************************

|PROCESO PasaEl20;
  #20#0 = #9#0;
  #20#1 = #9#2;
  |LEE 001#20=;
  |SI FSalida ! 0;
      #20#0 = #9#0;
      #20#1 = #9#2;
      #20#2 = #9#3;
      #20#3 = #9#4;
      #20#4 = #9#5;
      |GRABA 140#20n;
  |FINSI;
|FPRC;

|DEFBUCLE maempr11;
  #9#1;
  ;
  #1#0, #99#26, 000;
  #1#0, #99#26, 999;
  ;
  NULL, PasaEl20;
|FIN;
|| ///////////////////////
|PROCESO LeeRep;
     |ABRE #55;
     |DDEFECTO #55;
     #55#0 = aCif;
     |LEE 001#55=;
     |CIERRA #55;
|FPRC;

|PROCESO PasaEl25;
     nValor = #2#7;
     |SI EURODB = 0;  |Y #19#51 = "E";
         nValor = (nValor * 166.386) ! EURODB;
     |FINSI;

     |SI EURODB ! 0;  |Y #19#51 = "P";
         nValor = (nValor / 166.386) ! EURODB;
     |FINSI;
     nTotal = nTotal  + nValor;

     aCif = #2#3; |HAZ LeeRep;

     #25#0  = #1#0;
     #25#1  = nNumReg;
     #25#2  = #2#2;
     #25#3  = #2#3;
     #25#4  = #2#5;
     #25#5  = #55#2;
     #25#6  = #55#3;
     #25#7  = #2#6;
     #25#8  = #55#5;
     #25#9  = #55#6;
     #25#10 = #55#7;
     #25#11 = #55#8;
     #25#12 = #2#4;
     #25#13 = #2#8;
     #25#14 = 1;
     #25#15 = "";
     #25#16 = "";
     #25#17 = #2#9;

     |GRABA 140#25n;
     |LIBERA #25;
|FPRC;

|DEFBUCLE maempr02;
  #2#1;
  ;
  #1#0, #99#26, 00;
  #1#0, #99#26, 99;
  ;
  NULL, PasaEl25;
|FIN;
||////////////////////////////////////

|PROCESO PasaEl24;

  |DDEFECTO #24;
  #24#0 = #0#0;
  #24#1 = nNumReg;
  #24#2 = nUlti;
  |SI aC15 = "A";
      aCif = #3#3;
  |SINO;
      aCif = #4#4;
  |FINSI;
  |HAZ LeeRep;
  #24#3  = aCif;
  #24#7  = #55#2;
  #24#8  = #55#3;
  #24#9  = #55#4;
  #24#10 = #55#5;
  #24#11 = #55#6;
  #24#12 = #55#7;
  #24#13 = #55#8;
  |SI aC15 = "A";
      #24#14 = #3#4;
      #24#4  = #3#5;
      #24#12 = #3#6;
      #24#9  = #3#7;
  |SINO;
      #24#4 = #4#3;
      #24#5 = #4#5;
      #24#6 = #4#6;
  |FINSI;
  #24#15 = aC15;
  |GRABA 140#24n;
  |LIBERA #24;
  nUlti = nUlti + 1;
|FPRC;

|DEFBUCLE maempr03;
  #3#1;
  ;
  #0#0, #99#26, 00;
  #0#0, #99#26, 99;
  ;
  NULL, PasaEl24;
|FIN;

|DEFBUCLE maempr04;
  #4#1;
  ;
  #0#0, #99#26, 00;
  #0#0, #99#26, 99;
  ;
  NULL, PasaEl24;
|FIN;
|| ///////////////////////////
|PROCESO CreaSecre;
  || ... Crea Secretario
  |ABRE #26;
  #26#0 = #0#0;
  #26#1 = nNumReg;
  #26#2 = 99;
  |LEE 040#26];
  |SI FSalida = 0;
      |LEE 040#26a;
  |SINO;
      |LEE 040#26u;
  |FINSI;
  nNumLin = 1;
  |SI FSalida = 0; |Y #26#0 = #0#0; |Y #26#1 = nNumReg;
      nNumLin = #26#2 + 1;
  |FINSI;
  |DDEFECTO #26;
  #26#0 = #0#0;
  #26#1 = nNumReg;
  #26#2 = nNumLin;

  aCif  = #1#78;
  |HAZ LeeRep;
  #26#3 = aCif;
  #26#4 = #1#77;
  #26#5 = #1#79;
  #26#6 = #1#80;
  #26#7 = #55#4;
  #26#8 = #55#5;
  #26#9 = #1#81;
  #26#10 = #55#7;
  #26#11 = #55#8;
  #26#16 = 3;
  #26#17 = #1#82;
  |GRABA 020#26n;
  |CIERRA #26;
|FPRC;
|| //////////////////////////////////

|PROCESO PasaEl21;
  #21#0 = #0#0;
  #21#1 = nNumReg;
  #21#2 = #5#2;
  #21#3 = #5#3;
  #21#4 = #5#4;
  #21#5 = #5#5;
  #21#6 = #5#6;
  #21#7 = ("00" + #5#7) % -102;
  #21#8 = #5#8;
  #21#9 = #5#9;
  #21#10 = #5#10;

  |GRABA 140#21n;
  |LIBERA #21;
|FPRC;

|DEFBUCLE maempr05;
  #5#1;
  ;
  #0#0, #99#26, 00;
  #0#0, #99#26, 99;
  ;
  NULL, PasaEl21;
|FIN;
|| ///////////////////////////////////
|PROCESO PasaEl22;
  #22#0 = #0#0;
  #22#1 = nNumReg;
  #22#2 = #10#2;
  #22#3 = #10#3;
  #22#4 = #10#4;
  #22#5 = #10#5;
  #22#6 = #10#6;
  |GRABA 140#22n;
  |LIBERA #22;
|FPRC;

|DEFBUCLE maempr12;
  #10#1;
  ;
  #0#0, #99#26, 00;
  #0#0, #99#26, 99;
  ;
  NULL, PasaEl22;
|FIN;
|| /////////////////////

|PROCESO PasaEl23;
  #23#0 = #0#0;
  #23#1 = nNumReg;
  #23#2 = #11#2;
  #23#3 = #11#3;
  #23#4 = #11#4;
  #23#5 = #11#5;
  #23#6 = #11#6;
  #23#7 = #11#7;
  |GRABA 140#23n;
  |LIBERA #23;
|FPRC;

|DEFBUCLE maempr13;
  #11#1;
  ;
  #0#0, #99#26, 00, 00;
  #0#0, #99#26, 99, 99;
  ;
  NULL, PasaEl23;
|FIN;

|| /////////////////////
|PROCESO PasaEl27;
  #27#0 = #0#0;
  #27#1 = nNumReg;
  #27#2 = #6#2;
  #27#3 = #6#3;
  #27#4 = #6#4;
  #27#5 = #6#5;
  #27#6 = #6#6;
  #27#7 = #6#7;
  #27#8 = #6#8;
  #27#9 = #6#9;
  #27#10= #6#10;
  #27#11= #6#11;
  #27#12= #6#12;
  #27#13= #6#13;
  #27#14= #6#14;
  #27#15= #6#15;
  #27#16= #6#16;
  #27#17= #6#17;
  #27#18= #6#18;
  #27#19= #6#19;
  |GRABA 140#27n;
  |LIBERA #27;
|FPRC;

|DEFBUCLE maempr06;
  #6#1;
  ;
  #0#0, #99#26, 00;
  #0#0, #99#26, 99;
  ;
  NULL, PasaEl27;
|FIN;

|| ////////////////////////////////////////////////////////////////
|| Lecturas datos del Impuesto
|PROCESO LecImpuesto;
  |ABRE #1;
  |DDEFECTO #1;
  #1#0  = #0#0;                    || Empresa
  #1#1  = #0#1;                    || A¤o
  |LEE 040#1=;
  |CIERRA #1;

  |ABRE #14;
  |DDEFECTO #14;
  #14#0 = #1#17;
  |LIBERA #14;
  |LEE 140#14=;
  |CIERRA #14;
|FPRC;

|| ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
|PROCESO LeeTSoci;
     |ABRE #56;
     |DDEFECTO #56;
     #56#0 = #19#4;
     |LEE 001#56=;
     |CIERRA #56;
|FPRC;

|PROCESO Recoge;

 || Lee Primera Actividad
  #45#0 = #0#0;
  #45#1 = 00;
  |LEE 041#45];
  |SI FSalida ! 0; |O #45#0 ! #0#0;
      |DDEFECTO #45;
  |FINSI;

  |ABRE #28;
  #28#0 = #44#0;
  |LEE 140#28=;
  nEstado28 = FSalida;

  |SI nEstado28 ! 0; |O #99#27 = "S";
      |DDEFECTO #28;
      #28#0 = #44#0;
      #28#1 = #44#1;
      #28#2 = #44#2;
      #28#3 = #44#13;
      #28#4 = #44#62;
      #28#5 = #44#14;
      |SI nEstado28 = 0; |GRABA 121#28a; |FINSI;
      |SI nEstado28 ! 0; |GRABA 121#28n; |FINSI;
  |FINSI;
  |LIBERA #28;
  |CIERRA #28;

  nSwGrabar = 1;

  |ABRE #19;
  #19#0 = #28#0;
  #19#1 = 99;
  |LEE 040#19];
  |SI FSalida = 0;
      |LEE 040#19a;
  |SINO;
      |LEE 040#19u;
  |FINSI;
  nNumReg = 1;
  |SI FSalida = 0; |Y #19#0 = #28#0;
      nNumReg = #19#1 + 1;
  |FINSI;

  |DDEFECTO #19;
  #19#0 = #28#0;
  #19#1 = nNumReg;
  |GRABA 020#19b;

|| ... Pase ficheros auxiliares
  |ABRE #20; |BUCLE maempr11;  |CIERRA #20;
  nTotal = 0;
  |ABRE #25; |BUCLE maempr02;  |CIERRA #25;

  |ABRE #24;
  nUlti = 1;
  aC15  = "A"; |BUCLE maempr03;
  aC15  = "R"; |BUCLE maempr04;
  |CIERRA #24;

  |HAZ CreaSecre;

  |ABRE #21;              |BUCLE maempr05;  |CIERRA #21;
  |ABRE #22;              |BUCLE maempr12;  |CIERRA #22;
  |ABRE #23;              |BUCLE maempr13;  |CIERRA #23;
  |ABRE #27;              |BUCLE maempr06;  |CIERRA #27;

  #19#2  = "";
  #19#3  = #1#31; || Desde Fecha
  #19#4  = 01;
  |HAZ LeeTSoci;
  #19#5  = #56#1;

  #19#6  = "ACTIVA";
  |SI #45#14 > "01.01.1900"; #19#6 = "INACTIVA"; |FINSI;
  #19#7  = #45#5;  ||Fecha inicio primera actividad

  #19#14 = nTotal;
  #19#40 = #1#17;                   || CNAE
  #19#41 = #14#1;                   || Descripcion CNAE
  #19#46 = #1#24 % 101;
  #19#47 = #1#24 % -103;           || Epigrafe Principal
  #19#48 = #1#19;                   || Actividad Principal

  #19#87 = #1#101;
  #19#88 = #1#102;

  |GRABA 020#19a;
  |LIBERA #19;
  |CIERRA #19;
|FPRC;

|PROCESO PasaFich;

  nSwSeguir = 0;

  |HAZ LecImpuesto;
  |DDEFECTO #44;

  #44#0 = #0#0;
  |LEE 040#44=;
  nEstado44 = FSalida;
  |SI nEstado44 = 0;
      cif1 = #44#13;  |QBF cif1;
      cif2 = #0#3;    |QBF cif2;
      |SI cif1 ! cif2;
          nombre1 = #44#1;
          nombre2 = #0#2;
          codigo  = #44#0;
          aplica  = "sociedad";
          |HAZ ElMensaje;
          |SI nSwSeguir = 1;
              sw = 1;
              |PRINT;
          |FINSI;
      |SINO;
          |SI #99#27 = "S";
              |HAZ ClienteNuevo;
          |FINSI;
      |FINSI;
  |SINO;
       |HAZ ClienteNuevo;
  |FINSI;

  |SI nSwSeguir = 0;
      |HAZ Recoge;
  |FINSI;

  #44#20 = "S";
  |GRABA 140#44a;
  |LIBERA #44;
|FPRC;

|DEFBUCLE ClieSocie;
  #0#1;
  ;
  DEmpre, #99#26;
  HEmpre, #99#26;
  be;
  NULL, PasaFich;
|FIN;

|CALCULO ElPase;  |TIPO 3;
  |DBASS PathCliente;  |QBF PathCliente;
  |PATH_DAT #33PathCliente;

  |ABRE #33;
  |LEE 040#33p;
  |SI FSalida ! 0; aste = "*"; |CIERRA #33; |ACABA; |FINSI;
  |CIERRA #33;

  PathSociedad    = #33#4; |QBF PathSociedad; |SI PathSociedad = "*";  |ACABA;  |FINSI;
  PathPanSociedad = PathSociedad - "fich/" + "pan/";

  |PATH_DAT #0  PathSociedad;
  |PATH_DAT #1  PathSociedad;
  |PATH_DAT #2  PathSociedad;
  |PATH_DAT #3  PathSociedad;
  |PATH_DAT #4  PathSociedad;
  |PATH_DAT #5  PathSociedad;
  |PATH_DAT #6  PathSociedad;
  |PATH_DAT #9  PathSociedad;
  |PATH_DAT #10 PathSociedad;
  |PATH_DAT #11 PathSociedad;
  |PATH_DAT #14 PathSociedad;

  contador = 0;
  sw = 0;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |INFOR "paserror";
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

  |ABRE #44;
  |ABRE #45;
  |SI #99#0 = 0;
      DEmpre = #99#24;
      HEmpre = #99#25;
      |BUCLE ClieSocie;
  |SINO;
      |PARA XCampos = 0;  |SI XCampos [ 23;  |HACIENDO XCampos = XCampos + 1;
            |SI #99XCampos ! 0;
                DEmpre = #99XCampos;
                HEmpre = #99XCampos;
                |BUCLE ClieSocie;
            |FINSI;
      |SIGUE;
  |FINSI;
  |CIERRA #45;
  |CIERRA #44;

  |SI sw = 1; |PIEINF; |FINSI;
  |FININF;
  |FINIMP;
|FCAL;

||**************************************************************************
|PROCESO ClienteNuevo;
  contador = contador + 1;
  #44#0  = #1#0;
  #44#1  = #1#2;
  #44#2  = #1#2;
  #44#3  = #1#4;
  #44#4  = #1#5;
  #44#5  = #1#6;
  #44#6  = #1#7;
  #44#7  = #1#8;
  #44#8  = #1#9;
  #44#9  = #1#10;
  #44#10 = #1#11;
  #44#11 = #1#13;
  #44#12 = #1#14;
  #44#13 = #1#3;
  #44#14 = #1#15;
  codi1 = #44#9;
  codi1 = "00"  + codi1;
  codi1 = codi1 % -102;
  codi2 = #44#10;
  codi2 = "000"  + codi2;
  codi2 = codi2 % -103;
  #44#16 = codi1 + codi2;
  #44#20 = "S";

  #44#41 = #44#3;
  #44#42 = #44#4;
  #44#43 = #44#5;
  #44#44 = #44#6;
  #44#45 = #44#7;
  #44#46 = #44#8;
  #44#47 = #44#9;
  #44#48 = #44#10;
  #44#49 = #44#11;
  #44#50 = #44#12;

  #44#51 = #44#3;
  #44#52 = #44#4;
  #44#53 = #44#5;
  #44#54 = #44#6;
  #44#55 = #44#7;
  #44#56 = #44#8;
  #44#57 = #44#9;
  #44#58 = #44#10;
  #44#59 = #44#11;
  #44#60 = #44#12;

  |SI nEstado44 ! 0;
      |GRABA 121#44b;
  |FINSI;
  |PINTA 1963, contador;
|FPRC;

|PROCESO ElMensaje;
 |PUSHV 1114 1968;
 |PINTA 1215, "                                                      ";
 |PINTA 1315, "                                                      ";
 |PINTA 1415, "                                                      ";
 |PINTA 1515, "                                                      ";
 |PINTA 1615, "                                                      ";
 |PINTA 1715, "                                                      ";
 |PINTA 1815, "                                                      ";
 |PINTA 1915, "                                                      ";
 |CUADRO 1114 2068;
 |ATRI I;
 |PINTA 1215, " Error en los datos del Cliente: "; |ATRI 0;
 |PINTA 1248, #44#0; |ATRI P;
 |PINTA 1315, " Ficha Cliente "; |ATRI 0;
 |PINTA 1415, " N.I.F. : ";
 |PINTA 1425, #44#13;
 |PINTA 1515, " Nombre : ";
 |PINTA 1525, #44#1; |ATRI P;
 |PINTA 1615, " Impuesto Sociedades "; |ATRI 0;
 |PINTA 1715, " N.I.F. : ";
 |PINTA 1725, #1#3;
 |PINTA 1815, " Nombre: ";
 |PINTA 1825, #1#2; |ATRI S;
 |PINTA 1915, " Actualizar los datos en Ficha Cliente S/N "; |ATRI 0;

  E_sup  = 1;
  E_inf  = "SNsn";
  aSeguir = "N";
  aSeguir = 1958 ? 0; aSeguir = aSeguir > " ";
  |POPV;
  |SI aSeguir = "S";
      |HAZ ClienteNuevo;
  |SINO;
       nSwSeguir = 1;
  |FINSI;
|FPRC;
