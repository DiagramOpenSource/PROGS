|FICHEROS;
    agicen09 #9;
    agicen10 #10;
    agiw0004 #99;
|FIN;

|VARIABLES;
   &c_empre     = 0;
   &c_activ     = 0;
   &c_tipo      = 0;
   &n_empre     = "";
   &n_activ     = "";
   &NumeEpigr   = "";
   &FechaAlta   = @;
   &FechaBaja   = @;

   fecha_sys    = @;
   alfa         = "";
   coef1        = 0;
   coef2        = 0;
   xxx          = 0;
   yyy          = 0;
   sw_graba     = 0;
   tipo_pon     = 0;
   campo1       = 0;
   campo2       = 0;
   campo3       = 0;
|FIN;

|PROGRAMA;
|ABRE #9;
|PINPA #0#9;
#9#0 = c_empre;
#9#1 = c_activ;
|LIBERA #9;
|LEE 140#9=;
|SI FSalida = 0;
    |PINDA #0#9;
    |ENDATOS #2#9;
    |SI FSalida = 0;
        |HAZ fichero_10;
        |GRABA 140#9a;
        |PINPA #1#9;
        |PINDA #1#9;
        |PAUSA;
    |FINSI;
|SINO;
    |DDEFECTO #9;
    #9#0 = c_empre;
    #9#1 = c_activ;
    #9#2 = n_empre;
    #9#3 = n_activ;
    #9#10 = NumeEpigr;
    #9#16 = FechaBaja;
    #9#17 = FechaAlta;
    |PINDA #0#9;
    |ENDATOS #1#9;
    |SI FSalida = 0;
        |HAZ fichero_10;
        |GRABA 140#9n;
        |PINPA #1#9;
        |PINDA #1#9;
        |PAUSA;
    |FINSI;
|FINSI;
|CIERRA #9;
|FPRO;

|PROCESO anyo; |TIPO 7;
|SI #9#4 ! 0; |ACABA; |FINSI;

fecha_sys = ~;
alfa      = fecha_sys % -104;
#9#4      = alfa;
|PINTA #9#4;
|FPRC;

|PROCESO cuadro1; |TIPO 7;
|PUSHV 1044 2079;
|CUADRO 1044 2079;
|ATRI R;
|PINTA 1145, " Declaracion de :                 ";
|PINTA 1245, "    Alta ...................... 1 ";
|PINTA 1345, "    Baja ...................... 2 ";
|PINTA 1445, "                                  ";
|PINTA 1545, " Variacion                        ";
|PINTA 1645, "    Cambio opcion Alta ........ 3 ";
|PINTA 1745, "    Cambio opcion Baja ........ 4 ";
|PINTA 1845, "    Elementos tributarios ..... 5 ";
|PINTA 1945, "    Otras causas .............. 6 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro2; |TIPO 7;
|PUSHV 1417 1852;
|CUADRO 1417 1852;
|ATRI R;
|PINTA 1518, " Regla(s) que son de aplicacion   ";
|PINTA 1618, "    Regla 4¦ 2F) .............. 1 ";
|PINTA 1718, "    Regla 7¦. ................. 2 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro3; |TIPO 7;
|PUSHV 1432 1867;
|CUADRO 1432 1867;
|ATRI R;
|PINTA 1533, " Exencion que solicita :          ";
|PINTA 1633, "    Articulo 83.1.d) .......... 1 ";
|PINTA 1733, "    Articulo 83.1.e) .......... 2 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro4; |TIPO 7;
|PUSHV 0941 1476;
|CUADRO 0941 1476;
|ATRI R;
|PINTA 1042, " Darse de Alta ................ 1 ";
|PINTA 1142, " Darse de Baja ................ 2 ";
|PINTA 1242, " Declarar Variaciones ......... 3 ";
|PINTA 1342, " Rectificar (Complementaria) .. 4 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro5; |TIPO 7;
|PUSHV 1049 1370;
|CUADRO 1049 1370;
|ATRI R;
|PINTA 1150, " Nacional ....... 1 ";
|PINTA 1250, " Provincial...... 2 ";
|ATRI 0;
|FPRC;

|PROCESO reponer; |TIPO 0;
|POPV;
|PINTA #9Campo;
|FPRC;

|PROCESO declarar; |TIPO 0;
|SI #9#47 = 1; |CAMPO_MODIFICA #9#5, 1, "N"; #9#5 = 1; |FINSI;
|SI #9#47 = 2; |CAMPO_MODIFICA #9#5, 1, "N"; #9#5 = 2; |FINSI;
|SI #9#47 = 3; |CAMPO_MODIFICA #9#5, 1, "S";
    |SI #9#5 < 3; #9#5 = 3; |FINSI;
|FINSI;
|SI #9#47 = 4; |CAMPO_MODIFICA #9#5, 1, "S";           |FINSI;

|PINTA #9#5;
|FPRC;

|PROCESO tipo_m; |TIPO 0;
|SI #9#47 = 3;
    |SI #9#5 < 3;
        |HAZ cuadro1;
        |MENAV "    Valor superior a 2.";
        |ERROR;
        |ACABA;
    |FINSI;
|FINSI;

|CAMPO_MODIFICA #9#007, 1, "S";  |CAMPO_MODIFICA #9#008, 1, "S";
|CAMPO_MODIFICA #9#009, 1, "S";  |CAMPO_MODIFICA #9#010, 1, "S";
|CAMPO_MODIFICA #9#011, 1, "S";  |CAMPO_MODIFICA #9#012, 1, "S";
|CAMPO_MODIFICA #9#013, 1, "S";  |CAMPO_MODIFICA #9#014, 1, "S";
|CAMPO_MODIFICA #9#015, 1, "S";  |CAMPO_MODIFICA #9#016, 1, "S";
|CAMPO_MODIFICA #9#017, 1, "S";  |CAMPO_MODIFICA #9#018, 1, "S";
|CAMPO_MODIFICA #9#019, 1, "S";  |CAMPO_MODIFICA #9#020, 1, "S";
|CAMPO_MODIFICA #9#021, 1, "S";  |CAMPO_MODIFICA #9#022, 1, "S";
|CAMPO_MODIFICA #9#023, 1, "S";  |CAMPO_MODIFICA #9#024, 1, "S";
|CAMPO_MODIFICA #9#025, 1, "S";  |CAMPO_MODIFICA #9#026, 1, "S";
|CAMPO_MODIFICA #9#027, 1, "S";  |CAMPO_MODIFICA #9#034, 1, "S";
|CAMPO_MODIFICA #9#036, 1, "S";  |CAMPO_MODIFICA #9#037, 1, "S";
|CAMPO_MODIFICA #9#038, 1, "S";  |CAMPO_MODIFICA #9#039, 1, "S";
|CAMPO_MODIFICA #9#041, 1, "S";  |CAMPO_MODIFICA #9#042, 1, "S";

|| Tipo 1  Alta
|| Tipo 2  Baja
|| Tipo 3  Alta en variacion


|SI #9#47  = 1; |HAZ tipo_1; |FINSI;
|SI #9#47  = 2; |HAZ tipo_2; |FINSI;
|SI #9#47  = 3;
    |SI #9#5 = 4;
        |HAZ tipo_2;
    |SINO;
        |HAZ tipo_3;
    |FINSI;
|FINSI;

|SI #9#47 = 4;
    |SI #9#5 = 1; |HAZ tipo_1; |FINSI;
    |SI #9#5 = 2; |HAZ tipo_2; |FINSI;
    |SI #9#5 = 3; |HAZ tipo_3; |FINSI;
    |SI #9#5 = 4; |HAZ tipo_2; |FINSI;
    |SI #9#5 = 5; |HAZ tipo_3; |FINSI;
    |SI #9#5 = 6; |HAZ tipo_3; |FINSI;
|FINSI;
|FPRC;

|PROCESO tipo_1;  || Alta sin locales afectos
|CAMPO_MODIFICA #9#18, 1, "N";  #9#18 = ""; |PINTA #9#18;

|SI #9#47 ! 4;
    |CAMPO_MODIFICA #9#19, 1, "N";
    #9#19 = ""; |PINTA #9#19;
|FINSI;
|FPRC;

|PROCESO tipo_2;  || Baja sin locales afectos

|CAMPO_MODIFICA #9#007, 1, "N";  |CAMPO_MODIFICA #9#008, 1, "N";
|CAMPO_MODIFICA #9#009, 1, "N";  |CAMPO_MODIFICA #9#010, 1, "N";
|CAMPO_MODIFICA #9#011, 1, "N";  |CAMPO_MODIFICA #9#012, 1, "N";
|CAMPO_MODIFICA #9#013, 1, "N";  |CAMPO_MODIFICA #9#014, 1, "N";
|CAMPO_MODIFICA #9#015, 1, "N";  |CAMPO_MODIFICA #9#016, 1, "N";
|CAMPO_MODIFICA #9#020, 1, "N";  |CAMPO_MODIFICA #9#022, 1, "N";
|CAMPO_MODIFICA #9#023, 1, "N";  |CAMPO_MODIFICA #9#024, 1, "N";
|CAMPO_MODIFICA #9#025, 1, "N";  |CAMPO_MODIFICA #9#026, 1, "N";
|CAMPO_MODIFICA #9#027, 1, "N";  |CAMPO_MODIFICA #9#028, 1, "N";
|CAMPO_MODIFICA #9#029, 1, "N";  |CAMPO_MODIFICA #9#030, 1, "N";
|CAMPO_MODIFICA #9#031, 1, "N";  |CAMPO_MODIFICA #9#032, 1, "N";
|CAMPO_MODIFICA #9#033, 1, "N";  |CAMPO_MODIFICA #9#034, 1, "N";
|CAMPO_MODIFICA #9#035, 1, "N";  |CAMPO_MODIFICA #9#036, 1, "N";
|CAMPO_MODIFICA #9#037, 1, "N";  |CAMPO_MODIFICA #9#038, 1, "N";
|CAMPO_MODIFICA #9#039, 1, "N";  |CAMPO_MODIFICA #9#040, 1, "N";
|CAMPO_MODIFICA #9#041, 1, "N";  |CAMPO_MODIFICA #9#042, 1, "N";

|SI #9#47 ! 4;
    |CAMPO_MODIFICA #9#19, 1, "N";
    #9#19 = ""; |PINTA #9#19;
|FINSI;

#9#007 = "";
#9#008 = "";
#9#009 = "";
#9#010 = "";
#9#011 = "";
#9#012 = 0;
#9#013 = 0;
#9#014 = "";
#9#015 = 0;
#9#016 = "01.01.0000";
#9#020 = "";
#9#022 = 0;
#9#023 = 0;
#9#024 = 0;
#9#025 = 0;
#9#026 = 0;
#9#027 = 0;
#9#028 = "";
#9#029 = "";
#9#030 = "";
#9#031 = "";
#9#032 = "";
#9#033 = "";
#9#034 = 0;
#9#035 = 0;
#9#036 = 0;
#9#037 = 0;
#9#038 = 0;
#9#039 = 0;
#9#040 = 0;
#9#041 = 0;
#9#042 = 0;
#9#043 = 0;
#9#044 = 0;
#9#045 = 0;
#9#046 = 0;

|PINDA #0#9;
|FPRC;

|PROCESO tipo_3;  || Variacion sin locales afectos
|SI #9#47 ! 4;
    |CAMPO_MODIFICA #9#19, 1, "N";
    #9#19 = ""; |PINTA #9#19;
|FINSI;
|FPRC;

|PROCESO provin; |TIPO 0;
|SI #9#6 = 1;
    |CAMPO_MODIFICA #9#48, 1, "N";
    #9#48  = 0;  |PINTA #9#48;
    #9#49 = "";  |PINTA #9#49;
|SINO;
    |CAMPO_MODIFICA #9#48, 1, "S";
|FINSI;
|FPRC;

|PROCESO fichero_10;
|SI #9#47  = 2;              |HAZ tipo_b; |ACABA; |FINSI;
|SI #9#47  = 3; |Y #9#5 = 4; |HAZ tipo_b; |ACABA; |FINSI;
|SI #9#47  = 4; |Y #9#5 = 2; |HAZ tipo_b; |ACABA; |FINSI;
|SI #9#47  = 4; |Y #9#5 = 4; |HAZ tipo_b; |ACABA; |FINSI;

|HAZ tipo_a;
|HAZ calculo;
|FPRC;

|PROCESO graba_10;
|SI sw_graba = 1;
    #10#41 = tipo_pon;
    |GRABA 140#10a;
    |LIBERA #10;
|SINO;
    #9#43 = #9#43 + 1;
    #9#44 = #9#44 + #10#22;
    #9#45 = #9#45 + #10#31;
    #9#46 = #9#46 + #10#40;
|FINSI;
|FPRC;

|DEFBUCLE agicen10;
#10#1;
;
#9#0, #9#1, 00;
#9#0, #9#1, 99;
be;
NULL, graba_10;
|FIN;

|RUTINA infer;
#10#0 = #9#0;
#10#1 = #9#1;
#10#2 = 01;
|FRUT;

|RUTINA super;
#10#0 = #9#0;
#10#1 = #9#1;
#10#2 = 99;
|FRUT;

|PROCESO tipo_a;
tipo_pon = 1;
sw_graba = 1;
|BUCLE agicen10;

|PINPA #0#10;
|ENTLINEAL #1#10, 3, 1, 21, 0, infer, super;
|FPRC;

|PROCESO tipo_b;
#9#43 = 0; |PINTA #9#43;
#9#44 = 0; |PINTA #9#44;
#9#45 = 0; |PINTA #9#45;
#9#46 = 0; |PINTA #9#46;

tipo_pon = 2;

sw_graba = 1;
|BUCLE agicen10;

|FPRC;

|PROCESO calculo;
sw_graba = 0;

#9#43 = 0;
#9#44 = 0;
#9#45 = 0;
#9#46 = 0;

|BUCLE agicen10;

|PINTA #9#43;
|PINTA #9#44;
|PINTA #9#45;
|PINTA #9#46;

|FPRC;

|PROCESO panta_adjun;
|SI FSalida = 0;
    |PARA xxx = 10; |SI xxx [ 40; |HACIENDO xxx = xxx + 1;
          yyy = xxx - 10;
          #99yyy = #10xxx;
    |SIGUE;
|FINSI;

|PUSHV 0501 2380;

|PINPA #0#99;
|PINDA #0#99;

|ENDATOS #1#99;
|SI FSalida = 0;
    |PARA xxx = 10; |SI xxx [ 40; |HACIENDO xxx = xxx + 1;
          yyy = xxx - 10;
          #10xxx = #99yyy;
    |SIGUE;
|FINSI;

|POPV;

|PINTA #10#22;
|PINTA #10#31;
|PINTA #10#40;
|FPRC;

|PROCESO totales_adj; |TIPO 0;
  campo2 = Campo + 9;
  campo3 = campo2 + 9;
  coef2 = .95;
  |SI Campo = 4;  coef1 = 1;   |FINSI;
  |SI Campo = 5;  coef1 = 1;   coef2 = .60; |FINSI;
  |SI Campo = 6;  coef1 = .20; |FINSI;
  |SI Campo = 7;  coef1 = .40; |FINSI;
  |SI Campo = 8;  coef1 = .50; |FINSI;
  |SI Campo = 9;  coef1 = .50; |FINSI;
  |SI Campo = 10; coef1 = .55; |FINSI;
  |SI Campo = 11; coef1 = .55; |FINSI;

  #99campo2 = #99Campo * coef1;
  #99campo3 = #99campo2 * coef2;

  |PINTA #99Campo;
  |PINTA #99campo2;
  |PINTA #99campo3;

  #99#12 = 0;  #99#21 = 0;  #99#30 = 0;
  |PARA campo1 = 4; |SI campo1 [ 11; |HACIENDO campo1 = campo1 + 1;
        campo2 = campo1 + 9;
        campo3 = campo2 + 9;
        #99#12 = #99#12 + #99campo1;
        #99#21 = #99#21 + #99campo2;
        #99#30 = #99#30 + #99campo3;
  |SIGUE;
  |PINTA #99#12;
  |PINTA #99#21;
  |PINTA #99#30;
|FPRC;
