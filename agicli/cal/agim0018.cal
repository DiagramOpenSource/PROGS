|FICHEROS;
     agim0018 #0;
|FIN;

|VARIABLES;
     &Cliente      = 0;
     &VarImpre1    = "";
     &VarImpre2    = "";

     TeclaAntes1   = "";
     TeclaAntes2   = "";
     TeclaAntes3   = "";
     TeclaAntes4   = "";
     TeclaAntes5   = "";
     TeclaAntes6   = "";
     TeclaAntes7   = "";
     TeclaAntes8   = "";
     TeclaAntes9   = "";
     TeclaAntes10  = "";

     TeclaAhora1   = "";
     TeclaAhora2   = "";
     TeclaAhora3   = "";
     TeclaAhora4   = "";
     TeclaAhora5   = "";
     TeclaAhora6   = "";
     TeclaAhora7   = "";
     TeclaAhora8   = "";
     TeclaAhora9   = "";
     TeclaAhora10  = "";

     FechaSys      = @;
     PosiFecha     = 0;
     PosiFechaI    = 0;
     PosiFechaF    = 0;
     PonFecha      = 0;
     XPara         = 0;
     XPara1        = 0;
     XCoge         = 0;
     XCopias       = 0;
     Llave         = "";
     Caracter      = "";
     Variable      = "";
     Variable1     = "";
     Variable2     = "";
     Variable3     = "";
     FIfa          = "";
     FicheroFabre  = "";
     SwPrint       = 0;

     Varalfa1      = "";
     Varalfa2      = "";
     Forma         = 0;
     Modo          = 0;
     Pinta         = "";
     Directorio    = "";
     BafferEdita   = 0;

     Vn1           = 0;
     Vn2           = 0;
     Vn3           = 0;
     Vn4           = 0;
     Vn5           = 0;
     Vn6           = 0;
     Vn7           = 0;
     Vn8           = 0;
     Vn9           = 0;

     Valfa1        = "";
     Valfa2        = "";
     TotLin        = 0;
     Cadena        = "";
     xxx           = 0;
     Lineas        = 0;

     {-1} Menu     = "";
     Menu1         = "2400";
     Menu2         = "1";
     Menu3         = "Elija Opcion : ";
     Menu4         = "EI";
     Menu5         = "  Editar  ";
     Menu7         = "  Imprimir  ";
|FIN;

|RUTINA ClaveBaja0;
  #0#0 = Cliente;
  #0#1 = 1;
|FRUT;

|RUTINA ClaveAlta0;
  #0#0 = Cliente;
  #0#1 = 999;
|FRUT;

|PROGRAMA;
  Directorio = "";
  |DBASE Directorio;

  Directorio = Directorio + "cartas";
  |MKDIR Directorio;
  Directorio = Directorio + "/";

  TeclaAhora1  = "|:agicli/agiw0022";
  TeclaAhora2  = "@218&";
  TeclaAhora3  = "@217&";
  TeclaAhora4  = "@192&";
  TeclaAhora5  = "@191&";
  TeclaAhora6  = "@179&";
  TeclaAhora7  = "@196&";
  TeclaAhora8  = "@195&";
  TeclaAhora9  = "@197&";
  TeclaAhora10 = "@180&";

  |TECLA_FUNCION 10, 1, TeclaAntes1;
  |TECLA_FUNCION 11, 1, TeclaAntes2;
  |TECLA_FUNCION 12, 1, TeclaAntes3;
  |TECLA_FUNCION 13, 1, TeclaAntes4;
  |TECLA_FUNCION 14, 1, TeclaAntes5;
  |TECLA_FUNCION 15, 1, TeclaAntes6;
  |TECLA_FUNCION 16, 1, TeclaAntes7;
  |TECLA_FUNCION 17, 1, TeclaAntes8;
  |TECLA_FUNCION 18, 1, TeclaAntes9;
  |TECLA_FUNCION 19, 1, TeclaAntes10;

  |TECLA_FUNCION 10, 0, TeclaAhora1;
  |TECLA_FUNCION 11, 0, TeclaAhora2;
  |TECLA_FUNCION 12, 0, TeclaAhora3;
  |TECLA_FUNCION 13, 0, TeclaAhora4;
  |TECLA_FUNCION 14, 0, TeclaAhora5;
  |TECLA_FUNCION 15, 0, TeclaAhora6;
  |TECLA_FUNCION 16, 0, TeclaAhora7;
  |TECLA_FUNCION 17, 0, TeclaAhora8;
  |TECLA_FUNCION 18, 0, TeclaAhora9;
  |TECLA_FUNCION 19, 0, TeclaAhora10;

  |ENTLINEAL #1#0, 2, 1, 20, 1, ClaveBaja0, ClaveAlta0;

  |TECLA_FUNCION 10, 0, TeclaAntes1;
  |TECLA_FUNCION 11, 0, TeclaAntes2;
  |TECLA_FUNCION 12, 0, TeclaAntes3;
  |TECLA_FUNCION 13, 0, TeclaAntes4;
  |TECLA_FUNCION 14, 0, TeclaAntes5;
  |TECLA_FUNCION 15, 0, TeclaAntes6;
  |TECLA_FUNCION 16, 0, TeclaAntes7;
  |TECLA_FUNCION 17, 0, TeclaAntes8;
  |TECLA_FUNCION 18, 0, TeclaAntes9;
  |TECLA_FUNCION 19, 0, TeclaAntes10;
|FPRO;

|PROCESO PintaTipo;  |TIPO 0;
  #0#3 = #0#3 > #0#3;  |PINTA #0#3;

  |SI #0#3 = "C";  #0#4 = "CARTA  ";  |PINTA #0#4;  |FINSI;
  |SI #0#3 = "I";  #0#4 = "INFORME";  |PINTA #0#4;  |FINSI;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
  Varalfa1 = #0#0;  Varalfa1 = ("00000" + Varalfa1) % -105;
  Varalfa2 = #0#1;  Varalfa2 = ("00"    + Varalfa2) % -102;
  Valfa1   = #0#3 + Varalfa1 + Varalfa2;
  Valfa1   = Directorio + Valfa1 + ".txt";

  |C_M #0#3, 1, "S";
  |C_M #0#6, 1, "S";

  Modo = (FEntrada / 100) ! 0;
  |SI Modo = 3;
      |FBORRA Valfa1;
      |C_M #0#3, 1, "S";
      |C_M #0#6, 1, "S";
      |ACABA;
  |FINSI;

  Forma = 0 +. 1;
  |SI Forma ! 1;
      |C_M #0#3, 1, "N";
      |C_M #0#6, 1, "N";
      |ACABA;
  |SINO;
      |C_M #0#3, 1, "S";
      |C_M #0#6, 1, "S";
  |FINSI;

  |PUSHV 0501 2380;

  |MENU Menu;
  Menu2 = FSalida;
  |SI Menu2 = 1;  |HAZ Edita;     |FINSI;
  |SI Menu2 = 2;  |HAZ Imprimir;  |FINSI;
  |POPV;
|FPRC;

|PROCESO Edita;
  Pos         = -1;
  BafferEdita = 0;
  TotLin      = 0;
  Vn4         = 72;
  |LEESECUENCIAL Valfa1, BafferEdita, TotLin, 0, Vn4;
  |SI TotLin [ 0;
      |AL_BUF BafferEdita, 0, "";
      |AL_BUF BafferEdita, 1, "";
      |GRABASECUENCIAL Valfa1, BafferEdita, 0, 1;
      |LEESECUENCIAL Valfa1, BafferEdita, TotLin, 0, Vn4;
  |FINSI;

  TotLin = TotLin + 72;

  Valfa2 = "EDICION DEL TEXTO : " + Valfa1;
  Vn2    = 0;
  Vn4    = 0701;
  Vn5    = 2380;
  Vn6    = 0;
  Vn7    = 132;
  Vn8    = 0;
  Vn9    = 0;
  Pinta  = "                         Control - F1 = Ayuda                         ";
  |ATRI I; |PINTA 2501, Pinta;
  |EDITA BafferEdita, Vn2, TotLin, Vn4, Vn5, Vn6, Valfa2, Vn7, Vn8, Vn9;
  |SI FSalida ! 0;
      |FINDIM BafferEdita;
      |ACABA;
  |FINSI;

  Lineas = 0;
  |PARA xxx = 0; |SI xxx [ TotLin; |HACIENDO xxx = xxx + 1;
        |DEL_BUF BafferEdita, xxx, Cadena;
        |QBF Cadena;
        |SI Cadena ! ""; Lineas = xxx; |FINSI;
  |SIGUE;

  |SI Lineas ! 0;
      TotLin = Lineas + 1;
      |GRABASECUENCIAL Valfa1, BafferEdita, 0, TotLin;
  |SINO;
      |FBORRA Valfa1;
  |FINSI;

  |FINDIM BafferEdita;
|FPRC;

|PROCESO BuscaFecha;
|ET Arriba;

  PonFecha  = 0;
  Llave     = "";
  Caracter  = "";
  PosiFecha = 0;
  |PARA XPara = 1; |SI XPara [ 80; |HACIENDO XPara = XPara + 1;
        XCoge = (XPara * 100) + 1;
        Caracter  = Variable % XCoge;
        |SI Caracter = "{";
            Llave     = Llave + Caracter;
            PosiFecha = XPara;
        |SINO;
            Llave = Llave + Caracter;
            |SI Llave = "{{F";
                PonFecha = 1;
                |SAL;
            |SINO;
                Llave     = "";
                PosiFecha = 0;
            |FINSI;
        |FINSI;
  |SIGUE;

  |SI PonFecha = 1;
      PosiFechaI = 100 + (PosiFecha - 2);
      PosiFechaF = ((PosiFecha + 4) * 100) + 80;
      Variable1  = Variable % PosiFechaI;
      Variable2  = FechaSys;
      Variable3  = Variable % PosiFechaF;
      Variable   = Variable1 + Variable2 + Variable3;
      |VETE Arriba;
  |FINSI;
|FPRC;

|PROCESO Imprimir;
  |D_CUADRO 1623, 1955;
  |PINTA 1724, " Numero de Copias :            ";
  |PINTA 1824, " Fecha Comunicado :            ";

  XCopias  = 1;
  E_inf    = 1;
  E_sup    = 999;
  XCopias  = 1744 ? 1;

  FechaSys = ~;
  FechaSys = 1844 ? 1;
  |CONFI "2400SConforme con lo seleccionado : ";
  |SI FSalida ! 0; |POPV; |ACABA; |FINSI;

  |IMPRE 0;
  |SI FSalida ! 0; |ACABA; |FINSI;

  |INFOR "agiz0010";
  |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

  |PARA XPara1 = 1; |SI XPara1 [ XCopias; |HACIENDO XPara1 = XPara1 + 1;
        FicheroFabre  = "rt  " + Valfa1;
        Pos           = -1;
        |FABRE FicheroFabre;
        |SI FSalida < 0; |FININF; |ACABA; |FINSI;

        FIfa    = FSalida;
        SwPrint = 0;
        |PARA; |SI; |HACIENDO;
               Variable = FIfa + " 250";
               |FLEE Variable;
               |SI FSalida < 0; |SAL; |FINSI;

               |HAZ BuscaFecha;

               VarImpre1 = "";
               VarImpre2 = "";
               Variable  = (Variable + (" " * 80)) % 180;
               VarImpre1 = Variable % 140;
               VarImpre2 = Variable % -140;

               SwPrint = 1;
               |PRINT;
        |SIGUE;

        FSalida = Variable;
        |FCIERRA FSalida;

        |PIEINF;
  |SIGUE;

  |FININF;
  |FINIMP;
|FPRC;
