|FICHEROS;
    agiseg05 #0;
    caman130 #2;
    caman300 #3;
    canempre #10;

    agicontr #90;
|FIN;

|VARIABLES;
    fecha   = @;
    anyo_a  = "";
    d_clien = 0;
    h_clien = 0;
    periodo = 0;
    anyo    = 0;
    xxx     = 0;
    yyy     = 0;
    zzz     = 0;

    &codigo = 0;
    &nombre = "";
    &Ejercicio = 0;
    dbase = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    nume1 = 0;
    FEstado = 0;
    sw_fuera = 0;
|FIN;
____________________________________/ CALCULO
|PROCESO el_130;
#0#26 = #0#26 + (#2#8  + #2#11);
#0#27 = #0#27 + (#2#14 + #2#17);
#0#28 = #0#28 +  #2#18;
#0#29 = #0#29 +  #2#19;
#0#30 = #0#30 +  #2#21;
#0#31 = #0#31 +  #2#26;
#0#32 = #0#32 +  #2#27;
#0#33 = #0#33 +  #2#28;
#0#34 = #0#34 +  #2#25;
#0#35 = #0#35 +  #2#30;
#0#36 = #0#36 +  #2#31;
#0#37 = #0#37 +  #2#36;
#0#38 = #0#38 +  #2#29;
|FPRC;

|DEFBUCLE caman130;
 #2#1;
 ;
 #0#0, 0, #0#2, #0#3;
 #0#0, 9, #0#2, #0#3;
 ;
 NULL, el_130;
|FIN;

|PROCESO el_300;
#0#39 = #0#39 + #3#20;
#0#40 = #0#40 + #3#25;
#0#41 = #0#41 + #3#26;
#0#42 = #0#42 + (#3#33 - (#3#32 + #3#31));

|PARA xxx = 6; |SI xxx [ 12; |HACIENDO xxx = xxx + 3;
    yyy = xxx - 1;
    zzz = xxx + 1;

    |SI #3xxx = #0#63; |O #3xxx = #0#64; |O #3xxx = #0#65;
        |SI #3xxx = #0#63;
            #0#69 = #0#69 + #3yyy;
            #0#76 = #0#76 + #3zzz;
        |FINSI;

        |SI #3xxx = #0#64;
            #0#70 = #0#70 + #3yyy;
            #0#77 = #0#77 + #3zzz;
        |FINSI;

        |SI #3xxx = #0#63;
            #0#69 = #0#69 + #3yyy;
            #0#76 = #0#76 + #3zzz;
        |FINSI;
    |SINO;
        |SI #0#63 = 0;
            #0#63 = #3xxx;
            #0#69 = #3yyy;
            #0#76 = #3zzz;
        |SINO;
            |SI #0#64 = 0;
                #0#64 = #3xxx;
                #0#70 = #3yyy;
                #0#77 = #3zzz;
            |SINO;
                |SI #0#65 = 0;
                    #0#65 = #3xxx;
                    #0#71 = #3yyy;
                    #0#78 = #3zzz;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|SIGUE;

|PARA xxx = 15; |SI xxx [ 21; |HACIENDO xxx = xxx + 3;
    |SI xxx = 21; xxx = 47; |FINSI;
    yyy = xxx - 1;
    zzz = xxx + 1;

    |SI #3xxx = #0#66; |O #3xxx = #0#67; |O #3xxx = #0#68;
        |SI #3xxx = #0#66;
            #0#72 = #0#72 + #3yyy;
            #0#79 = #0#79 + #3zzz;
        |FINSI;

        |SI #3xxx = #0#67;
            #0#73 = #0#73 + #3yyy;
            #0#80 = #0#80 + #3zzz;
        |FINSI;

        |SI #3xxx = #0#68;
            #0#74 = #0#74 + #3yyy;
            #0#81 = #0#81 + #3zzz;
        |FINSI;
    |SINO;
        |SI #0#66 = 0;
            #0#66 = #3xxx;
            #0#72 = #3yyy;
            #0#79 = #3zzz;
        |SINO;
            |SI #0#67 = 0;
                #0#67 = #3xxx;
                #0#73 = #3yyy;
                #0#80 = #3zzz;
            |SINO;
                |SI #0#68 = 0;
                    #0#68 = #3xxx;
                    #0#74 = #3yyy;
                    #0#81 = #3zzz;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|SIGUE;

#0#75 = #0#75 + #3#49;   || Adquisiciones intracomunitarias.
#0#82 = #0#82 + #3#50;   || Adquisiciones intracomunitarias.
#0#83 = #0#83 + #3#29;
|FPRC;

|DEFBUCLE caman300;
 #3#1;
 ;
 " ", #0#2, #0#3;
 "z", #0#2, #0#3;
 ;
 NULL, el_300;
|FIN;

|PROCESO tipo_3;
|BUCLE caman130;
|BUCLE caman300;

#0#61 = #0#42 + #0#60;
#0#62 = 0;
|SI #0#25 > 0; #0#62 = #0#62 + #0#25; |FINSI;
|SI #0#38 > 0; #0#62 = #0#62 + #0#38; |FINSI;
|SI #0#61 > 0; #0#62 = #0#62 + #0#61; |FINSI;
|FPRC;

|PROCESO lee_canempre; |TIPO 0;
|DDEFECTO #10;
|ABRE #10;
    #10#2 = codigo;      || empresa
    #10#3 = #0#84;       || periodo
|LEE 000#10=;
|SI FSalida ! 0;
    |MENAV "    Empresa inexistente en AGICONT ...";
    |ERROR;
|SINO;
     |SI #10#26 ! #0#3;
         |MENAV "      No coincide el a¤o de la contabilidad con el de la Tributacion";
         |ERROR;
     |FINSI;

        alfa1 = #90#7;  |QBF alfa1;    || directorio
        alfa2 = #10#2;  alfa2 = ("00000" + alfa2) % -105;
        alfa3 = alfa1 + alfa2 + #10#3 + "/";
    |PATH_DAT #2 alfa3;
    |PATH_DAT #3 alfa3;
|FINSI;
|CIERRA #10;
|FPRC;

|PROCESO para_agicli;
    dbase = "";
|DIRECTORIO dbase;
|PATH_DAT #90 dbase;
|ABRE #90;
|LEE 020#90p;            || tiene que existir, viene comprobado
|SI FSalida = 0;
        alfa1 = #90#7;   |QBF alfa1;
    |PATH_DAT #10 alfa1;
|FINSI;
|CIERRA #90;
|FPRC;

|PROCESO pantalla;
  |PDEFECTO #0, 4, 83;
  #0#1 = nombre;

  |HAZ tipo_3;
  |SI FEstado = 0; |GRABA 020#0a; |FINSI;
  |SI FEstado ! 0; |GRABA 020#0n; |FINSI;

  |PINDA #0#0;
  |PAUSA;

  |CONFI "2400SOtro Periodo (S/N): ";
  |SI FSalida = 0; sw_fuera = 0; |FINSI;
|FPRC;

|PROGRAMA;
|CLS;
|CABEZA "Tributacion AGICONT";
    sw_fuera = 0;
|PARA; |SI sw_fuera = 0; |HACIENDO;
    sw_fuera = 1;

    |HAZ para_agicli;        || lee control de AGIFIGEN para poner el path

    |ABRE #0;
    |PINPA #0#0;
    |DDEFECTO #0;

    #0#0 = codigo;
    #0#3 = Ejercicio;
    |PINDA #0#0;
    |ENCAMPO #2#0;
    |LEE 101#0=;
    FEstado = FSalida;
    |SI FEstado ! 0;
        |ENCAMPO #84#0;
    |FINSI;

    |HAZ pantalla;
    |LIBERA #0;
    |CIERRA #0;
|SIGUE;
|FPRO;
