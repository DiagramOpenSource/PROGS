|FICHEROS;
     may00001 #0;
     agim0033 #1;
     agim0034 #2;
     agifigen #3;
|FIN;

|VARIABLES;
     Fecsys    = @;
     VAlfa     = "";
     VNume     = 0;
     Contador  = 0;
     DEmpresa  = 0;
     HEmpresa  = 0;
     Ultima    = 0;

     &Dia      = "";
     &Mes      = "";
     &Ejer     = "";
|FIN;

|PROCESO Seleccion; |TIPO 0;
  |SI #0#1 = "N";
      |C_M #0#2, 1, "S";
      |C_M #0#3, 1, "S";

      |PARA Contador = 4; |SI Contador [ 23; |HACIENDO Contador = Contador + 1;
            |C_M #0Contador, 1, "N";
            #0Contador = 0; |PINTA #0Contador;
      |SIGUE;
  |SINO;
      |C_M #0#2, 1, "N";  #0#2 = 1;      |PINTA #0#2;
      |C_M #0#3, 1, "N";  #0#3 = 99999;  |PINTA #0#3;

      |PARA Contador = 4; |SI Contador [ 23; |HACIENDO Contador = Contador + 1;
            |C_M #0Contador, 1, "S";
      |SIGUE;
  |FINSI;
|FPRC;

|PROCESO Mayor; |TIPO 0;
  #0Campo = #0Campo > #0Campo;
|FPRC;

|PROCESO Defectos; |TIPO 7;
  Fecsys  = ~;
  VAlfa   = Fecsys;
  VAlfa   = VAlfa % -104;
  VNume   = VAlfa;
  #0#0    = VNume - 1;   |PINTA #0#0;
|FPRC;

|PROCESO agim0034;
  |PRINT;
  |PIEINF;
|FPRC;

|PROCESO Lineas;
  #3#0 = #1#0;
  |LEE 040#3=;
  |SI FSalida ! 0; |DDEFECTO #3;  |FINSI;

  |BUCLELIN 0agim0034#1;
|FPRC;

|DEFBUCLE agim0033;
  #1#1;
  ;
  DEmpresa, #0#0;
  HEmpresa, #0#0;
  ;
  NULL, Lineas;
|FIN;

|PROCESO Tipo3; |TIPO 3;
  |HAZ Fecha;

  |IMPRE 0;
  |SI FSalida ! 0; |ACABA; |FINSI;

  |INFOR "agiy0028";
  |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

  |ABRE #3;
  |SI #0#1 = "N";
      DEmpresa = #0#2;
      HEmpresa = #0#3;
      |BUCLE agim0033;
  |SINO;
      |PARA Contador = 4; |SI Contador [ 23; |HACIENDO Contador = Contador + 1;
            |SI #0Contador ! 0;
                 DEmpresa = #0Contador;
                 HEmpresa = #0Contador;
                 |BUCLE agim0033;
            |FINSI;
      |SIGUE;
  |FINSI;

  |CIERRA #3;
  |FINIMP;
|FPRC;

|PROCESO Fecha;
  Dia  = #0#24 % 102;
  Mes  = #0#24 % 402;
  Ejer = #0#24 % 704;

  |SI Mes = "01"; Mes = "Enero     "; |FINSI;
  |SI Mes = "02"; Mes = "Febrero   "; |FINSI;
  |SI Mes = "03"; Mes = "Marzo     "; |FINSI;
  |SI Mes = "04"; Mes = "Abril     "; |FINSI;
  |SI Mes = "05"; Mes = "Mayo      "; |FINSI;
  |SI Mes = "06"; Mes = "Junio     "; |FINSI;
  |SI Mes = "07"; Mes = "Julio     "; |FINSI;
  |SI Mes = "08"; Mes = "Agosto    "; |FINSI;
  |SI Mes = "09"; Mes = "Septiembre"; |FINSI;
  |SI Mes = "10"; Mes = "Octubre   "; |FINSI;
  |SI Mes = "11"; Mes = "Noviembre "; |FINSI;
  |SI Mes = "12"; Mes = "Diciembre "; |FINSI;
|FPRC;
