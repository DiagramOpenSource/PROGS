|FICHEROS;
     agiw0075 #0;
     agiw0076 #1,MANTE;
     agiw0074 #3,MANTE;
     referen@ #100;
|FIN;

|VARIABLES;
     aAnterior = "";
     nModo = 0;
     alfa1 = "";
     aAlfa = "";
     aPath = "";
     aApli = "";
     aDef = "";
     nCampos = 0;
     i = 0;
     &swElijo = 0;
     nPosicion = 0;
     aTipo = "";
     nNume = 0;
     aCampo1 = "";
     aCampo2 = "";
     aCampo3 = "";
     nSuma = 0;
|FIN;

|PROCESO LeeCampos;
     |DBASE aPath; |QBF aPath;
     aDef = #0#2; |QBF aDef;
     aDef = aPath + "def/" + aDef;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef;
          |MENAV aAlfa;
     |SINO;
          aAlfa = "|NC";
          aAlfa = #referen@#aAlfa#;
          nCampos = aAlfa;

          |ABRE #3;
          |PARA i = 0 ;|SI i < nCampos; |HACIENDO i = i + 1;
               |DDEFECTO #3;
               #3#0 = #0#2;
               #3#1 = i;
               |LEE 101#3=;
               |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
               aAlfa = "|C" + (("000" + i) % -103) + "NOMBRE";
               aAlfa = #referen@#aAlfa#;
               #3#2 = aAlfa;
               |GRABA 020#3a;
               |LIBERA #3;
          |SIGUE;
          |DESCARGA_DEF #referen@;
          |CIERRA #3;
     |FINSI;
|FPRC;

|PROCESO inferior;
     #3#0 = #0#2;
     #3#1 = 0;
     |SI FSalida = "POSICION";
          #3#1 = nPosicion;
     |FINSI;
|FPRC;

|PROCESO superior;
     #3#0 = #0#2;
     #3#1 = 255;
|FPRC;

|PROCESO LeeUltimo; |TIPO 7;
     swElijo = 0;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |SALVA_FICHA #1;
          #1#1 = #1#1 - 1;
          |LEE 000#1=;
          |SI FSalida ! 0;
               |LEE 000#1u;
          |FINSI;
          aTipo = #1#2;
          nPosicion = #1#3 + 1;
          aCampo1 = #1#4;
          |QBF aCampo1;
          aCampo2 = #1#5;
          |QBF aCampo2;
          aCampo3 = #1#6;
          |QBF aCampo3;
          |REPON_FICHA #1;
     |SINO;
          nPosicion = #1#3;
     |FINSI;

     |SI aTipo = "1";
          nSuma = 3;
     |FINSI;
     |SI aTipo = "2"; |O aTipo = " ";
          nSuma = 1;
     |FINSI;
     |SI aTipo = "3";
          nSuma = 2;
     |FINSI;
     |SI aTipo = "4";
          nSuma = 2;
     |FINSI;

     |SI nModo = 1;
          #1#2 = aTipo;
          |PINTA #1#2;

          |SI aCampo3 ! "";
               nNume = aCampo3;
               nNume = nNume + nSuma;
               aAlfa = nNume;
               #1#6 = aAlfa;
          |SINO;
               #1#6 = "";
          |FINSI;
          |PINTA #1#6;

          |SI aCampo2 ! "";
               |SI aCampo3 ! "";
                    #1#5 = aCampo2;
               |SINO;
                    nNume = aCampo2;
                    nNume = nNume + nSuma;
                    aAlfa = nNume;
                    #1#5 = aAlfa;
               |FINSI;
          |SINO;
               #1#5 = "";
          |FINSI;
          |PINTA #1#5;

          |SI aCampo1 ! "";
               |SI aCampo2 ! "";
                    #1#4 = aCampo1;
               |SINO;
                    nNume = aCampo1;
                    nNume = nNume + nSuma;
                    aAlfa = nNume;
                    #1#4 = aAlfa;
               |FINSI;
          |SINO;
               #1#4 = "";
          |FINSI;
          |PINTA #1#4;
     |FINSI;
|FPRC;

|PROCESO Campos; |TIPO 7;
     |PUSHV 05012380;
     |HAZ LeeCampos;

     |ENTLINEAL #1#3, -2, 4, 22, 1, inferior, superior;
     |POPV;

     |SI swElijo ! 0;
          #1#3 = swElijo;
          |PINTA #1#3;
          |PTEC 802;
     |FINSI;
|FPRC;
