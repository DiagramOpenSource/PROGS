|FICHEROS;
     catradia #1;
     cacuenta #2;
     cacuebal #5;
|FIN;

|VARIABLES;
     &entrada = 1;
     juan = 0;
     errant = 0;
     &dig1 = 0;
     &dig3 = 0;
     &dig4 = 0;
     &dig5 = 0;
     &dig6 = 0;
     &dig7 = 0;
     &dig8 = 0;
     &dig9 = 0;
     &codcon = 0;
     &modcon = 0;
     cuini = "            ";
     cifin = "999999999998";
     diini = 0;
     difin = 9;
     fecini = "01.01.0000";
     fecfin = "31.12.8999";
     tiini = "D";
     tifin = "H";
     diain = 0;
     diafi = 99;
     prim = 0;
     cuant = "";
     lon = 0;
     aa = 0;
     ini = 0;
     fecalf = "";
     mes = "";
     mesfec = 0;
     mesac = 0;
     a = 0;
     b = 0;
     c = 0;
     mensa = "";
     aar = "";
     traba = "";
     errcuent = "aaaaaaaaaaaa";
     mensa2   = "     No esta definida esta cuenta en Cuentas de Balance";
     uno = "";
     dos = "";
     mascara = "";
     nivel = 0;
     &path = "";
     &path1 = "";
|FIN;



|CALCULO actuali;
  |SI #1#2 [ juan; |O #1#2 = 9;
      |SI prim = 1;
           |GRABA 101#2a;
      |FINSI;
      prim = 0;
      |VETE acaba;
  |FINSI;
  aa = 100 + lon;
  aar = aa;
  traba = #1#1 % aar;
|ET iniemp;
  |SI prim = 0;
      cuant = traba;
      prim = 1;
      #2#0 = cuant;
      #2#1 = juan;
      |SI #2#0 = errcuent;
          prim = 0;
          |VETE acaba;
      |FINSI;
      |LIBERA #2;
      |LEE 101#2=;
      |SI FSalida ! 0;
          |LIBERA #2;
          |DDEFECTO #2;
          #2#0 = cuant;
          #2#1 = juan;
          |HAZ defect1;
          |PUSHV 501 1980;
          |PINPA #0#2;
          |PINDA #0#2;
          |ENDATOS #1#2;
          |SI FSalida ! 0;
              |POPV;
              mensa = "Actualizando nivel: " + juan + "        ";
              |PINTA 2410,mensa;
              errant = #2#0;
              prim = 0;
              |VETE acaba;
          |FINSI;
          |GRABA 101#2b;
          |POPV;
          mensa = "Actualizando nivel: " + juan + "        ";
          |PINTA 2410,mensa;
      |FINSI;
  |FINSI;
  |SI cuant ! traba;
      |GRABA 101#2a;
      prim = 0;
      |VETE iniemp;
  |FINSI;
  |HAZ suma;
|ET acaba;
|FCAL;

|CALCULO borrando;
  |BORRA 040#1a;
|FCAL;

|DEFBUCLE camaapua0;
 #1#1;
 ;
 codcon,cuini,diini,fecini,tiini,diain;
 codcon,cifin,difin,fecfin,tifin,diafi;
 be;
 NULL,actuali;
|FIN;

|DEFBUCLE camaapua1;
 #1#1;
 ;
 codcon,cuini,diini,fecini,tiini,diain;
 codcon,cifin,difin,fecfin,tifin,diafi;
 be;
 NULL,borrando;
|FIN;

|PROGRAMA;
     |PATH_DAT #2 path;
     |PATH_DAT #5 path;
     |PATH_PAN #2 path1;
  |PINTA 2410,"Estoy Actualizando las Cuentas";
  |ABRE #2;
  |PARA juan = dig3 - 1; |SI juan ] 1; |HACIENDO juan = juan - 1;
        prim = 0;
        |SI juan = 1; lon = dig4; |FINSI;
        |SI juan = 2; lon = dig5; |FINSI;
        |SI juan = 3; lon = dig6; |FINSI;
        |SI juan = 4; lon = dig7; |FINSI;
        |SI juan = 5; lon = dig8; |FINSI;
        |BUCLE camaapua0;
        |SI prim = 1;
            |GRABA 101#2a;
        |FINSI;
  |SIGUE;
  |CIERRA #2;
  |BUCLE camaapua1;
  |ABRET #1;
  |LEE 101#1u;
  |SI FSalida ! 0;
       |CIERRAT #1;
       |DELINDEX #1;
  |SINO;
       |CIERRAT #1;
  |FINSI;
|FPRO;

|CALCULO suma;
  |SI #1#6 = 0;
      |SI #1#4 = "D";
          #2#9 = #2#9 + #1#5;
          #2#51 = #2#51 + #1#5;
      |SINO;
          #2#10 = #2#10 + #1#5;
          #2#52 = #2#52 + #1#5;
      |FINSI;
      #2#11 = #2#9 - #2#10;
      #2#53 = #2#51 - #2#52;
  |SINO;
      |SI #1#6 = 99;
          |SI #1#4 = "D";
              #2#48 = #2#48 + #1#5;
              #2#51 = #2#51 + #1#5;
          |SINO;
              #2#49 = #2#49 + #1#5;
              #2#52 = #2#52 + #1#5;
          |FINSI;
          #2#50 = #2#48 - #2#49;
          #2#53 = #2#51 - #2#52;
      |SINO;
          |HAZ actualiza;
      |FINSI;
  |FINSI;
|FCAL;

|CALCULO actualiza;
  ini = dig1;
  fecalf = #1#3;
  mes = fecalf % 402;
  mesfec = mes;
  |SI ini = 1;
      mesac = mesfec;
  |SINO;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
  |FINSI;
  a = (mesac * 3) + 9;
  b = a + 1;
  c = a + 2;
  |SI #1#4 = "D";
      #2a = #2a + #1#5;
      #2#51 = #2#51 + #1#5;
  |SINO;
      #2b = #2b + #1#5;
      #2#52 = #2#52 + #1#5;
  |FINSI;
  #2c = #2a - #2b;
  #2#53 = #2#51 - #2#52;
|FCAL;

|CALCULO defect1;
  |ABRE #5;
  uno = #2#0;
  |QBF uno;
  dos = uno + "000000000000";
  uno = dos % A101;
  #5#0 = uno;
  |LEE 040#5=;
  |SI FSalida = 0;
      |HAZ saca1;
      |VETE findefe;
  |FINSI;
  uno = dos % A102;
  #5#0 = uno;
  |LEE 040#5=;
  |SI FSalida = 0;
      |HAZ saca1;
      |VETE findefe;
  |FINSI;
  uno = dos % A103;
  #5#0 = uno;
  |LEE 040#5=;
  |SI FSalida = 0;
      |HAZ saca1;
      |VETE findefe;
  |FINSI;
  uno = dos % A104;
  #5#0 = uno;
  |LEE 040#5=;
  |SI FSalida = 0;
      |HAZ saca1;
      |VETE findefe;
  |SINO;
      |MENAV mensa2;
  |FINSI;
|ET findefe;
  nivel = #2#1;
|| la 3a clave esta formada por la cta + zzzz y el campo fantasma del nivel;
  mascara = #2#0;
  |QBF mascara;
  mascara = mascara +"zzzzzzzzzzzz";
  mascara = mascara % 112;
  #2#54    = mascara;
  #2#55    = nivel;
  |CIERRA #5;
|FCAL;

|CALCULO saca1;
  #2#4 = #5#1;
  #2#5 = #5#2;
  #2#6 = #5#3;
  #2#7 = #5#4;
  #2#8 = #5#5;
|FCAL;
