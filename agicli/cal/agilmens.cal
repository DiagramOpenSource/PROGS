|FICHEROS;
    agilmens #0;
    agiagenl #1;
    agihenvi #2;
    agiw0012 #3;
    agiusuar #4;
|FIN;

|VARIABLES;
    sw      = 0;
    seccion = 0;
    usur_p  = "";
    clave   = "";
    usuario = "";
    &vacio1 = "                                        ";
    &vacio2 = "                                                  ";
    d_usu   = "";
    h_usu   = "";
    hora_real = "";
    alfa      = "";
    refer     = 0;

    {-1} menu = "";
         menu1 = "2400";
         menu2 = "1";
         menu3 = "Elija Opcion : ";
         menu4 = "PI";
         menu5 = "  Pantalla  ";
         menu6 = "  Impresora ";
|FIN;

|INCLUYE i_ficher;
|INCLUYE i_usuari;

|PROCESO hora; |TIPO 7;
|HORA hora_real;

alfa = hora_real % 102;
#0#7 = alfa; |PINTA #0#7;
alfa = hora_real % 402;
#0#8 = alfa; |PINTA #0#8;
|FPRC;

|PROCESO imprimir;
|SI #1#11 = "S"; |Y #0#3 = "N"; |ACABA; |FINSI;
|SI #1#11 = "N"; |Y #0#3 = "S"; |ACABA; |FINSI;
|SI #1#12 = "S"; |Y #0#4 = "N"; |ACABA; |FINSI;
|SI #1#12 = "N"; |Y #0#4 = "S"; |ACABA; |FINSI;
|SI #1#13 = "S"; |Y #0#5 = "N"; |ACABA; |FINSI;
|SI #1#13 = "N"; |Y #0#5 = "S"; |ACABA; |FINSI;

#2#14 = #1#14;
|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

#4#0 = #1#2;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;

|SI menu2 = 1;
    refer = refer + 1;
    #3#0  = refer;
    #3#1  = #1#0;
    #3#2  = #1#3;
    #3#3  = #1#4;
    #3#4  = #1#14;
    #3#5  = #1#5;
    #3#6  = #2#15;
    #3#7  = #2#16;
    #3#8  = #4#1;
    #3#9  = #1#6;
    #3#10 = #2#18;
    |GRABA 040#3n;
    |ACABA;
|FINSI;

|SI sw = 0;
    usur_p = #1#2;
    sw     = 1;
|FINSI;

|SI usur_p ! #1#2;
    usur_p = #1#2;
    |PIEINF;
|FINSI;



|PRINT;
|FPRC;

|DEFBUCLE agiagenl;
#1#1;
;
#0#0, d_usu, 00, 00, 00000;
#0#1, h_usu, 23, 59, 99999;
e;
NULL, imprimir;
|FIN;

|PROCESO impre; |TIPO 3;
|HAZ RecogeUsuario;

usuario = Usr;
d_usu   = usuario;
h_usu   = usuario;

|CONFI "2400NDesea pedir Usuario : ";
|SI FSalida = 0;
    |CUADRO 1963 2277;
    |ATRI R;
    |PINTA 2064, "    CLAVE    ";
    |ATRI r;
    |PINTA 2164, "             ";

    E_sup = 13;

    clave = "";
    clave = 2164 ? -1;

    |HAZ RecogeUsuario;

    usuario = Usr;
    usuario = "agi" + usuario;
    |QBF usuario;
    |QBF clave;

    |SI usuario ! clave;
        |MENAV "      Clave incorrecta.";
        |ACABA;
    |FINSI;

    E_sup = 10;

    |CUADRO 1963 2277;
    |ATRI R;
    |PINTA 2064, "   USUARIO   ";
    |ATRI r;
    |PINTA 2164, "             ";

    |MENSA "     Usuario en blanco todos los usuarios";
    usuario  = "";
    usuario  = 2166 ? 1;
    d_usu    = usuario;
    h_usu    = usuario;
    |SI usuario = "          ";
        d_usu   = "          ";
        h_usu   = "いいいいい";
    |FINSI;
    |BLIN 04;
|FINSI;

|MENU menu;
menu2 = FSalida;
|SI FSalida = 2; |HAZ impresora; |FINSI;
|SI FSalida = 1; |HAZ pantalla;  |FINSI;
|FPRC;

|RUTINA superior;
#3#0 = refer;
|FRUT;

|RUTINA inferior;
#3#0 = 1;
|FRUT;


|PROCESO pantalla;
comienza = "12";
|HAZ fichero;
|NOME_DAT #3 fichero;
|ABRE #3; |CIERRA #3; |DELINDEX #3;

|ABRE #2;
|ABRE #3;
|ABRE #4;
|BUCLE agiagenl;
|CIERRA #2;
|CIERRA #3;
|CIERRA #4;

|SI refer ! 0;
    |PINPA #0#3;
    |ENTLINEAL #1#3, 1, 4, 20, 0, inferior, superior;
|FINSI;
|FPRC;

|PROCESO impresora;
|IMPRE 0;
|SI FSalida ! 0; |ACABA; |FINSI;

|INFOR "agilmens";
|SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

|HAZ RecogeUsuario;

usuario = Usr;
|ABRE #2;
|ABRE #4;
|BUCLE agiagenl;
|CIERRA #2;
|CIERRA #4;
|SI sw = 1; |PIEINF; |FINSI;
|FININF;
|FINIMP;
|FPRC;

|PROCESO tecla_f1; |TIPO 11;
|SI FSalida ! 9; |ACABA; |FINSI;

|ABRE #2;
#2#14 = #3#4;
|LEE 040#2=;
|SI FSalida = 0;
    |PUSHV 0501 2380;
    |PINPA #0#2;
    |PINDA #0#2;
    |PAUSA;
    |POPV;
|FINSI;
|CIERRA #2;
|FPRC;
