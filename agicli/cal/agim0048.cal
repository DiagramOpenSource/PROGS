|FICHEROS;
     agim0048 #0;   ||Recibos Mostrador.
     agifigen #1;   ||Cliente
     agim0049 #2;   ||Historico de Recibos
|FIN;

|VARIABLES;
     aMensaje = "";
     nExiste = 0;
     aCP = "";
     aCP1 = "";
     aCP2 = "";
     nRecibo = 0;
     aInforme = "";
     &eaDia = "";
     &eaMes = "";
     &eaAny = "";
     aFecha = "";
     fFecha = @;
     fMes = @;
     aParametro = "";
     &enRecibo = 0;
|FIN;

|PROGRAMA;
     |CLS;
     aParametro = PARAMETRO;
     |SI aParametro = "H";    ||Impresion desde historico;
          |ABRE #agim0048;
          |ABRE #agim0049;
          #agim0049#8 = enRecibo;
          |LEE 000#agim0049.=;
          |SI FSalida = 0;
               |DDEFECTO #agim0048;
               |LEE 000#agim0048.p;
               #agim0048#0 = #agim0049#0;
               #agim0048#1 = #agim0049#1;
               #agim0048#2 = #agim0049#2;
               #agim0048#3 = #agim0049#3;
               #agim0048#4 = #agim0049#4;
               #agim0048#5 = #agim0049#5;
               #agim0048#6 = #agim0049#6;
               #agim0048#7 = #agim0049#7;
               #agim0048#8 = #agim0049#8;
               #agim0048#9 = #agim0049#9;
               #agim0048#10 = #agim0049#10;
               #agim0048#11 = #agim0049#11;
               #agim0048#12 = #agim0049#12;
               #agim0048#13 = #agim0049#13;
               #agim0048#14 = #agim0049#14;
               #agim0048#15 = #agim0049#15;
               #agim0048#17 = #agim0049#17;
               #agim0048#18 = #agim0049#18;
               #agim0048#19 = #agim0049#19;
               #agim0048#20 = #agim0049#20;
               #agim0048#21 = #agim0049#21;
               #agim0048#22 = #agim0049#22;
               |HAZ Impresion;
          |FINSI;
          |CIERRA #agim0048;
          |CIERRA #agim0049;
     |SINO;                   ||Tal como esta
          |ABRE #0;
          |DDEFECTO #0;
          |LEE 101#0p;
          nExiste=FSalida;
          |PDEFECTO #0, 7, 8;
          |PDEFECTO #0, 15, 16;
          |PDEFECTO #0, 21, 23;
          |PINPA #0#0;
          |PINDA #0#0;
          |ABRE #agim0049;
          |HAZ NumRecibo;
          |ENDATOS #1#0;
          |SI FSalida=0;
               |SI nExiste=0;
                    |GRABA 020#0a;
               |SINO;
                    |GRABA 020#0n;
               |FINSI;
               |HAZ Impresion;
               |HAZ Historico;
          |FINSI;
          |LIBERA #0;
          |CIERRA #0;
          |CIERRA #agim0049;
     |FINSI;
|FPRO;


|PROCESO Tipo0; |TIPO 0;
     |ABRE #agifigen;
     #agifigen#0 = #agim0048#1;
     |LEE 000#agifigen.=;
     |SI FSalida = 0;
          #agim0048#2 = #agifigen#1;
          #agim0048#3 = #agifigen#4;
          #agim0048#4 = #agifigen#11;
          aCP1 = ("00" + #agifigen#9) % -102;
          aCP2 = ("000" + #agifigen#10) % -103;
          aCP = aCP1 + aCP2;
          #agim0048#5 = aCP;
          #agim0048#6 = #agifigen#13;
          #agim0048#17 = #agifigen#5;
          #agim0048#18 = #agifigen#6;
          #agim0048#19 = #agifigen#7;
          #agim0048#20 = #agifigen#8;
     |SINO;
          #agim0048#2 = "";
          #agim0048#3 = "";
          #agim0048#4 = "";
          #agim0048#5 = "";
          #agim0048#6 = "";
          #agim0048#17 = "";
          #agim0048#18 = "";
          #agim0048#19 = "";
          #agim0048#20 = "";
     |FINSI;
     |PINTA #agim0048#2;
     |PINTA #agim0048#3;
     |PINTA #agim0048#4;
     |PINTA #agim0048#5;
     |PINTA #agim0048#6;
     |PINTA #agim0048#17;
     |PINTA #agim0048#18;
     |PINTA #agim0048#19;
     |PINTA #agim0048#20;
     |CIERRA #agifigen;
|FPRC;

|PROCESO NumRecibo;
     ||Calcula el ultimo numero de recibo del Historico
     #agim0049#8 = 999999;
     |LEE 000#agim0049.];
     |SI FSalida = 0;
           |LEE 000#agim0049.a;
     |SINO;
           |LEE 000#agim0049.u;
     |FINSI;
     |SI FSalida = 0;
          nRecibo = #agim0049#8 + 1;
     |SINO;
          nRecibo = 1;
     |FINSI;
     #agim0048#8 = nRecibo;
     |PINTA #agim0048#8;
|FPRC;

|PROCESO Impresion;
     |IMPRE 0;
     |SI FSalida = 0;
          aInforme = #agim0048#16;
          |QBF aInforme;
          |INFOR aInforme;
          |SI FSalida = 0;
               |HAZ Fecha;
               |PRINT;
               |PIEINF;
          |SINO;
               aMensaje = "0000Informe " + aInforme + " inaccesible!";
               |MENAV aMensaje;
          |FINSI;
          |FININF;
      |FINSI;
      |FINIMP;
|FPRC;

|PROCESO Historico;
     |DDEFECTO #agim0049;
     #agim0049#8 = #agim0048#8;
     |LEE 101#agim0049.=;
     |SI FSalida ! 0; |GRABA 020#agim0049.b; |FINSI;
     #agim0049#0 = #agim0048#0;
     #agim0049#1 = #agim0048#1;
     #agim0049#2 = #agim0048#2;
     #agim0049#3 = #agim0048#3;
     #agim0049#4 = #agim0048#4;
     #agim0049#5 = #agim0048#5;
     #agim0049#6 = #agim0048#6;
     #agim0049#7 = #agim0048#7;
     #agim0049#8 = #agim0048#8;
     #agim0049#9 = #agim0048#9;
     #agim0049#10 = #agim0048#10;
     #agim0049#11 = #agim0048#11;
     #agim0049#12 = #agim0048#12;
     #agim0049#13 = #agim0048#13;
     #agim0049#14 = #agim0048#14;
     #agim0049#15 = #agim0048#15;
     #agim0049#17 = #agim0048#17;
     #agim0049#18 = #agim0048#18;
     #agim0049#19 = #agim0048#19;
     #agim0049#20 = #agim0048#20;
     #agim0049#21 = #agim0048#21;
     #agim0049#22 = #agim0048#22;
     |GRABA 020#agim0049.a;
     |LIBERA #agim0049;
|FPRC;

|PROCESO Fecha;
     fFecha = #agim0048#15;
     aFecha = #agim0048#15;
     eaDia = aFecha % 102;
     eaDia = ("00" + eaDia) % -102;
     eaAny = aFecha % -104;

     fMes = fFecha % 0;  ||Para pasar el mes a letra
     eaMes = fMes % 11;
     |QBF eaMes;
|FPRC;
