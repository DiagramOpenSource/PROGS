|FICHEROS;
    agicen08 #8;
    agifigen #99;   || FICHA GENERAL DE CLIENTES.
|FIN;

|VARIABLES;
   modo         = 0;
   &c_empre     = 0;
   &c_activ     = 0;
   &c_tipo      = 0;
   &n_empre     = "";
   &n_activ     = "";
   &l_epig      = "";
   &NumeEpigr   = "";
   &FechaAlta   = @;
   &FechaBaja   = @;

   fecha_sys    = @;
   alfa         = "";
   campo1       = 0;
   campo2       = 0;
   campo3       = 0;
   coef1        = 0;
   coef2        = 0;
   xxx          = 0;
|FIN;

|PROGRAMA;
|ABRE #8;
|PINPA #0#8;
#8#0 = c_empre;
#8#1 = c_activ;
|LIBERA #8;
|LEE 140#8=;
|SI FSalida = 0;
    |PINDA #0#8;
    |ENDATOS #2#8;
    |SI FSalida = 0; |GRABA 140#8a; |FINSI;
|SINO;
    |DDEFECTO #8;
    #8#0  = c_empre;
    #8#1  = c_activ;
    #8#2  = n_empre;
    #8#3  = n_activ;
    #8#23 = NumeEpigr;
    #8#29 = FechaBaja;
    #8#30 = FechaAlta;
    |HAZ lee_ficha;      ||--------------------- lee la ficha de clientes.
    |PINDA #0#8;
    |ENDATOS #1#8;
    |SI FSalida = 0; |GRABA 140#8n; |FINSI;
|FINSI;
|CIERRA #8;
|FPRO;

|PROCESO anyo; |TIPO 7;
|SI #8#4 ! 0; |ACABA; |FINSI;

fecha_sys = ~;
alfa      = fecha_sys % -104;
#8#4      = alfa;
|PINTA #8#4;
|FPRC;

|PROCESO cuadro1; |TIPO 7;
|PUSHV 0944 1979;
|CUADRO 0944 1979;
|ATRI R;
|PINTA 1045, " Declaracion de :                 ";
|PINTA 1145, "    Alta ...................... 1 ";
|PINTA 1245, "    Baja ...................... 2 ";
|PINTA 1345, "                                  ";
|PINTA 1445, " Variacion                        ";
|PINTA 1545, "    Cambio opcion Alta ........ 3 ";
|PINTA 1645, "    Cambio opcion Baja ........ 4 ";
|PINTA 1745, "    Elementos tributarios ..... 5 ";
|PINTA 1845, "    Otras causas .............. 6 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro2; |TIPO 7;
|PUSHV 1617 2052;
|CUADRO 1617 2052;
|ATRI R;
|PINTA 1718, " Regla(s) que son de aplicacion   ";
|PINTA 1818, "    Regla 4¦ 2F) .............. 1 ";
|PINTA 1918, "    Regla 7¦. ................. 2 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro3; |TIPO 7;
|PUSHV 1632 2067;
|CUADRO 1632 2067;
|ATRI R;
|PINTA 1733, " Exencion que solicita :          ";
|PINTA 1833, "    Articulo 83.1.d) .......... 1 ";
|PINTA 1933, "    Articulo 83.1.e) .......... 2 ";
|ATRI 0;
|FPRC;

|PROCESO cuadro4; |TIPO 7;
|PUSHV 1344 2074;
|CUADRO 1344 2074;
|ATRI R;
|PINTA 1445, " AL - Almacen                ";
|PINTA 1545, " DP - Depositos              ";
|PINTA 1645, " CD - Centro de Direccion    ";
|PINTA 1745, " OF - Oficina Administrativa ";
|PINTA 1845, " CC - Centro de Calculo      ";
|PINTA 1945, " OT - Otros                  ";
|ATRI 0;
|FPRC;

|PROCESO cuadro5; |TIPO 7;
|PUSHV 0941 1776;
|CUADRO 0941 1776;
|ATRI R;
|PINTA 1042, " Darse de Alta ................ 1 ";
|PINTA 1142, " Darse de Baja ................ 2 ";
|PINTA 1242, " Declarar Variaciones ......... 3 ";
|PINTA 1342, " Alta local indirec.afecto .... 4 ";
|PINTA 1442, " Baja local indirec.afecto .... 5 ";
|PINTA 1542, " Var. local indirec.afecto .... 6 ";
|PINTA 1642, " Rectificar (Complementaria) .. 7 ";
|ATRI 0;
|FPRC;

|PROCESO reponer; |TIPO 0;
|POPV;
|PINTA #8Campo;
|FPRC;

|PROCESO declarar; |TIPO 0;
|SI l_epig ! "P";
    |CAMPO_MODIFICA #8#33, 1, "N";
|SINO;
    |CAMPO_MODIFICA #8#33, 1, "S";
|FINSI;

|CAMPO_MODIFICA #8#6, 1, "N";

|SI #8#113 = 1; |O #8#113 = 4;
    |CAMPO_MODIFICA #8#5, 1, "N";
    #8#5 = 1;   |PINTA #8#5;
|FINSI;

|SI #8#113 = 2; |O #8#113 = 5;
    |CAMPO_MODIFICA #8#5, 1, "N";
    #8#5 = 2;   |PINTA #8#5;
|FINSI;

|SI #8#113 = 3; |O #8#113 = 6;
    |CAMPO_MODIFICA #8#5, 1, "S";
    |SI #8#5 < 3; #8#5 = 3; |PINTA #8#5; |FINSI;
|FINSI;

|SI #8#113 = 7;
    |CAMPO_MODIFICA #8#5, 1, "S";
    |CAMPO_MODIFICA #8#6, 1, "S";
|FINSI;

|SI #8#113 = 4; |O #8#113 = 5; |O #8#113 = 6;
    #8#6 = "X";
|SINO;
    |SI #8#113 ! 7; #8#6 = " "; |FINSI;
|FINSI;
|PINTA #8#6;
|FPRC;

|PROCESO tipo_m; |TIPO 0;
|SI #8#113 = 3; |O #8#113 = 6;
    |SI #8#5 < 3;
        |HAZ cuadro1;
        |MENAV "    Valor superior a 2.";
        |ERROR;
        |ACABA;
    |FINSI;
|FINSI;

|PARA xxx = 20; |SI xxx [ 87; |HACIENDO xxx = xxx + 1;
      |SI xxx ! 33;
          |SI xxx [ 57; |CAMPO_MODIFICA #8xxx, 1, "S"; |FINSI;
          |SI xxx ] 67; |CAMPO_MODIFICA #8xxx, 1, "S"; |FINSI;
      |FINSI;
|SIGUE;

|CAMPO_MODIFICA #8#40, 1, "N";

|| Tipo 1  Alta sin locales afectos
|| Tipo 2  Baja sin locales afectos
|| Tipo 3  Alta en variacion
|| Tipo 4  Alta con locales afectos
|| Tipo 5  Baja con locales afectos


|SI #8#113 = 1; |HAZ tipo_1; |FINSI;
|SI #8#113 = 2; |HAZ tipo_2; |FINSI;
|SI #8#113 = 3;
    |SI #8#5 = 4;
        |HAZ tipo_2;
    |SINO;
        |HAZ tipo_3;
    |FINSI;
|FINSI;
|SI #8#113 = 4; |HAZ tipo_4; |FINSI;
|SI #8#113 = 5; |HAZ tipo_5; |FINSI;
|SI #8#113 = 6;
    |SI #8#5 = 4; |HAZ tipo_5; |FINSI;
|FINSI;

|SI #8#113 = 7;
    |SI #8#6 = " ";
        |SI #8#5 = 1; |HAZ tipo_1; |FINSI;
        |SI #8#5 = 2; |HAZ tipo_2; |FINSI;
        |SI #8#5 = 3; |HAZ tipo_3; |FINSI;
        |SI #8#5 = 4; |HAZ tipo_2; |FINSI;
        |SI #8#5 = 5; |HAZ tipo_3; |FINSI;
        |SI #8#5 = 6; |HAZ tipo_3; |FINSI;
    |SINO;
        |SI #8#5 = 1; |HAZ tipo_4; |FINSI;
        |SI #8#5 = 2; |HAZ tipo_5; |FINSI;
        |SI #8#5 = 4; |HAZ tipo_5; |FINSI;
    |FINSI;
|FINSI;

|FPRC;

|PROCESO tipo_1;  || Alta sin locales afectos

|SI #8#113 ! 7; |CAMPO_MODIFICA #8#32, 1, "N"; #8#32 = ""; |FINSI;
|||SI #8#113 ! 7; |CAMPO_MODIFICA #8#35, 1, "N"; #8#35 = ""; |FINSI;
||  esta linea anterior la comento para poder modificar el numero de
||  referencia en el alta
|CAMPO_MODIFICA #8#31, 1, "N";

|PARA xxx = 36; |SI xxx [ 49; |HACIENDO xxx = xxx + 1;
      |CAMPO_MODIFICA #8xxx, 1, "N";
|SIGUE;

#8#31 = ""; |PINTA #8#31;   #8#36 = ""; |PINTA #8#36;
#8#37 = 0;  |PINTA #8#37;   #8#38 = 0;  |PINTA #8#38;
#8#39 = ""; |PINTA #8#39;   #8#40 = ""; |PINTA #8#40;
#8#41 = ""; |PINTA #8#41;   #8#42 = ""; |PINTA #8#42;
#8#43 = ""; |PINTA #8#43;   #8#44 = ""; |PINTA #8#44;
#8#45 = ""; |PINTA #8#45;   #8#46 = ""; |PINTA #8#46;
#8#47 = ""; |PINTA #8#47;   #8#48 = ""; |PINTA #8#48;
#8#49 = ""; |PINTA #8#49;
|PINTA #8#32;
|PINTA #8#35;

|FPRC;

|PROCESO tipo_2;  || Baja sin locales afectos

|PARA xxx = 20; |SI xxx [ 87; |HACIENDO xxx = xxx + 1;
      |CAMPO_MODIFICA #8xxx, 1, "N";
|SIGUE;

|CAMPO_MODIFICA #8#30, 1, "S";
|CAMPO_MODIFICA #8#31, 1, "S";
|CAMPO_MODIFICA #8#35, 1, "S";

|SI #8#113 = 7;
    |CAMPO_MODIFICA #8#32, 1, "S";
|SINO;
    #8#32 = "";
    |PINTA #8#32;
|FINSI;

#8#020 = "";             |PINTA #8#020;
#8#021 = "";             |PINTA #8#021;
#8#022 = "";             |PINTA #8#022;
#8#023 = "";             |PINTA #8#023;
#8#024 = "";             |PINTA #8#024;
#8#025 = 0;              |PINTA #8#025;
#8#026 = 0;              |PINTA #8#026;
#8#027 = "";             |PINTA #8#027;
#8#028 = 0;              |PINTA #8#028;
#8#029 = "01.01.0000";   |PINTA #8#029;
#8#033 = 0;              |PINTA #8#033;
#8#034 = "";             |PINTA #8#034;
#8#036 = "";             |PINTA #8#036;
#8#037 = 0;              |PINTA #8#037;
#8#038 = 0;              |PINTA #8#038;
#8#039 = "";             |PINTA #8#039;
#8#040 = "";             |PINTA #8#040;
#8#041 = "";             |PINTA #8#041;
#8#042 = "";             |PINTA #8#042;
#8#043 = "";             |PINTA #8#043;
#8#044 = "";             |PINTA #8#044;
#8#045 = "";             |PINTA #8#045;
#8#046 = "";             |PINTA #8#046;
#8#047 = "";             |PINTA #8#047;
#8#048 = "";             |PINTA #8#048;
#8#049 = "";             |PINTA #8#049;

|PARA xxx = 50; |SI xxx [ 57; |HACIENDO xxx = xxx + 1;
      #8xxx = 0; |PINTA #8xxx;
|SIGUE;

|PARA xxx = 58; |SI xxx [ 65; |HACIENDO xxx = xxx + 1;
      #8xxx = ""; |PINTA #8xxx;
|SIGUE;

|PARA xxx = 66; |SI xxx [ 112; |HACIENDO xxx = xxx + 1;
      #8xxx = 0; |PINTA #8xxx;
|SIGUE;

|FPRC;

|PROCESO tipo_3;  || Variacion sin locales afectos

|SI #8#113 ! 7; |CAMPO_MODIFICA #8#32, 1, "N"; #8#32 = ""; |FINSI;

|PARA xxx = 36; |SI xxx [ 49; |HACIENDO xxx = xxx + 1;
      |CAMPO_MODIFICA #8xxx, 1, "N";
|SIGUE;

#8#036 = "";             |PINTA #8#036;
#8#037 = 0;              |PINTA #8#037;
#8#038 = 0;              |PINTA #8#038;
#8#039 = "";             |PINTA #8#039;
#8#040 = "";             |PINTA #8#040;
#8#041 = "";             |PINTA #8#041;
#8#042 = "";             |PINTA #8#042;
#8#043 = "";             |PINTA #8#043;
#8#044 = "";             |PINTA #8#044;
#8#045 = "";             |PINTA #8#045;
#8#046 = "";             |PINTA #8#046;
#8#047 = "";             |PINTA #8#047;
#8#048 = "";             |PINTA #8#048;
#8#049 = "";             |PINTA #8#049;
|FPRC;

|PROCESO tipo_4;  || Alta con locales afectos

|SI #8#113 ! 7; |CAMPO_MODIFICA #8#32, 1, "N"; #8#32 = ""; |FINSI;
|CAMPO_MODIFICA #8#31, 1, "N";

#8#31 = ""; |PINTA #8#31;
|FPRC;

|PROCESO tipo_5;  || Baja con locales afectos
|SI #8#113 ! 7; |CAMPO_MODIFICA #8#32, 1, "N"; #8#32 = ""; |FINSI;

|PARA xxx = 20; |SI xxx [ 29; |HACIENDO xxx = xxx + 1;
      |CAMPO_MODIFICA #8xxx, 1, "N";
|SIGUE;


|CAMPO_MODIFICA #8#033, 1, "N";
|CAMPO_MODIFICA #8#034, 1, "N";

|PARA xxx = 50; |SI xxx [ 57; |HACIENDO xxx = xxx + 1;
      |CAMPO_MODIFICA #8xxx, 1, "N";
|SIGUE;

|PARA xxx = 66; |SI xxx [ 87; |HACIENDO xxx = xxx + 1;
      |CAMPO_MODIFICA #8xxx, 1, "N";
|SIGUE;

#8#020 = "";             |PINTA #8#020;
#8#021 = "";             |PINTA #8#021;
#8#022 = "";             |PINTA #8#022;
#8#023 = "";             |PINTA #8#023;
#8#024 = "";             |PINTA #8#024;
#8#025 = 0;              |PINTA #8#025;
#8#026 = 0;              |PINTA #8#026;
#8#027 = "";             |PINTA #8#027;
#8#028 = 0;              |PINTA #8#028;
#8#029 = "01.01.0000";   |PINTA #8#029;
#8#033 = 0;              |PINTA #8#033;
#8#034 = "";             |PINTA #8#034;

|PARA xxx = 50; |SI xxx [ 57; |HACIENDO xxx = xxx + 1;
      #8xxx = 0; |PINTA #8xxx;
|SIGUE;

|PARA xxx = 58; |SI xxx [ 65; |HACIENDO xxx = xxx + 1;
      #8xxx = ""; |PINTA #8xxx;
|SIGUE;

|PARA xxx = 66; |SI xxx [ 112; |HACIENDO xxx = xxx + 1;
      #8xxx = 0; |PINTA #8xxx;
|SIGUE;
|FPRC;

|PROCESO panta_3; |TIPO 0;
  campo2 = Campo + 12;
  campo3 = campo2 + 12;
  #8#88 = #8#88 - #8Campo;
  #8#100 = #8#100 - #8campo2;
  #8#112 = #8#112 - #8campo3;
  coef2 = .95;
  |SI Campo = 77; coef1 = 1; |FINSI;
  |SI Campo = 78; coef1 = 1;  coef2 = .60; |FINSI;
  |SI Campo = 79; coef1 = .20; |FINSI;
  |SI Campo = 80; coef1 = .05; |FINSI;
  |SI Campo = 81; coef1 = .20; |FINSI;
  |SI Campo = 82; coef1 = .40; |FINSI;
  |SI Campo = 83; coef1 = .10; |FINSI;
  |SI Campo = 84; coef1 = .50; |FINSI;
  |SI Campo = 85; coef1 = .50; |FINSI;
  |SI Campo = 86; coef1 = .55; |FINSI;
  |SI Campo = 87; coef1 = .55; |FINSI;

  #8campo2 = #8Campo * coef1;
  #8campo3 = #8campo2 * coef2;

  #8#88 = 0;  #8#100 = 0;  #8#112 = 0;

  |PINTA #8Campo;
  |PINTA #8campo2;
  |PINTA #8campo3;

  |PARA campo1 = 77;  |SI campo1 [ 87;  |HACIENDO campo1 = campo1 + 1;
        campo2 = campo1 + 12;
        campo3 = campo2 + 12;
        #8#88  = #8#88  + #8campo1;
        #8#100 = #8#100 + #8campo2;
        #8#112 = #8#112 + #8campo3;
  |SIGUE;

  |PINTA #8#88;
  |PINTA #8#100;
  |PINTA #8#112;
|FPRC;

||--------------------------------------------------------------------------

|PROCESO lee_ficha;
     |ABRE #99;
     #99#0 = #8#0;  || CODIGO EMPRESA.
     |LEE 000#99=;
     |SI FSalida = 0;
          #8#9  = #99#41;     || CALLE.
          #8#10 = #99#42;     || DOMICILIO.
          #8#11 = #99#47;     || CP.
          #8#12 = #99#48;     || CP.
          #8#13 = #99#43;     || NUMERO.
          #8#14 = "";         || KILOMETRO.
          #8#15 = "";         || PTO.
          #8#16 = #99#44;     || ESCALERA.
          #8#17 = #99#45;     || PISO.
          #8#18 = #99#46;     || PUERTA.
          #8#19 = #99#14;     || TELEFONO.
          #8#7  = #99#49;     || POBLACION.
          #8#8  = #99#50;     || PROVINCIA.
     |FINSI;
     |CIERRA #99;
|FPRC;
