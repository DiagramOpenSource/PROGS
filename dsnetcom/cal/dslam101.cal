|FICHEROS;
     dsnetm00 #0;
     dslam101 #101;
     dsnetm07 #7;
     dslaw003 #201;
     dslam004 #4;
     dslam005 #5;
     dslam006 #6;
     dslamx01 #99;
     dslaw005 #205,MANTE;

     labtraba@ #900;
     labpadre@ #901;
     labcentr@ #902;
     dsam0103@ #903;
     agidanif@ #904;
     nomtraca@ #905;
     nomtrali@ #906;
     labempre@ #907;
|FIN;

|VARIABLES;
     sw = 0;
     aObser = ""; ||Variable para la recogida de observaciones
     nCampo         = 0;
     nCampo1        = 0;
     nCampo2        = 0;
     nCampo3        = 0;
     nCampo4        = 0;
     nCampo5        = 0;
     nCampo6        = 0;
     nCampo7        = 0;
     nCampo8        = 0;
     nRegis         = 0;
     nAscci         = 0;
     nHandle        = 0;
     nError         = 0;
     nLinea         = 0;

     aParametro     = "";
     aCampo         = "";
     aCaracter      = "";
     aWeb           = "";
     aAbre          = "";
     aAbreSmf       = "";
     aAlfa          = "";
     aBase          = "";
     aMas           = "";
     aFichLab       = "";
     aFichInt       = "";
     aFichBas       = "";
     aTecla         = "";
     &nSinPI        = 0;
     aCopialo1      = "";
     aCopialo2      = "";
     &aFlag         = "";
     &aTitulo       = "";

     &nEmp = 0;
     &nTra = 0;
     &aCons = "";
     &aImp = "";
     aAlfa1 = "";
     aAlfa2 = "";
     swCopia = 0;
     nExiste = 0;
|FIN;

|| Recogida de la Web ------------------------------------------------------

|PROCESO CargaCampos;
     #101nCampo = aCampo > " ";
     |SI nCampo = 3;
          aAlfa = (aCampo % 102) + "."+ (aCampo % 402) + "." + (aCampo % -104)
          #101nCampo = aAlfa;
     |FINSI;
     |SI nCampo = 209;
          aObser = aCampo > " ";
          #101#209 = aObser % 150;
          #101#216 = aObser % 5150;
          #101#217 = aObser % 10150;
     |FINSI;
|FPRC;

|PROCESO GrabaRegistros;
     #101#0 = "N";

     #7#1 = "LABORAL";
     #7#2 = #101#5;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;

     #5#0 = #101#199;
     |LEE 040#5=;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;

     #902#0 = #101#5;
     #902#1 = #101#200;
     |LEE 040#902=;
     |SI FSalida ! 0;  |DDEFECTO #902;  |FINSI;

     #4#0 = #101#201;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;

     #6#0 = #101#201;
     #6#1 = #101#202;
     |LEE 040#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;

     #101#210 = #7#3;
     #101#211 = #5#1;
     #101#212 = #902#2;
     #101#213 = #4#1;
     #101#214 = #6#2;
     #101#215 = 0;

     nExiste = 0;
     |SALVA_FICHA #101;
     #101#0 = "B";  |LEE 000#101=; |SI FSalida = 0;    nExiste = 1;   |FINSI;
     #101#0 = "S";  |LEE 000#101=; |SI FSalida = 0;    nExiste = 1;   |FINSI;
     |REPON_FICHA #101;

     |SI nExiste = 0;
          |GRABA 000#101n;
          |SI FSalida = 0; nRegis = nRegis + 1; |FINSI;
     |FINSI;

     nCampo   = 1;
     aCampo   = "";
     |DDEFECTO #101;
|FPRC;

|PROCESO LeeRegistros;
     aCampo        = "";
     nCampo        = 1;
     nRegis        = 0;

     |PARA;  |SI  FSalida ] 0;  |HACIENDO;
             |XLEE nHandle, 1, aCaracter;
             |SI FSalida [ 0;  |SAL;  |FINSI;

             nAscci = &aCaracter;


             |SI nCampo = 210;  |Y nAscci = 10;
                 |HAZ CargaCampos;

                 ||nRegis = nRegis + 1;
                 |HAZ GrabaRegistros;
             |FINSI;

             |SI aCaracter = "|";
                 |HAZ CargaCampos;

                 nCampo = nCampo + 1;
                 aCampo = "";
             |FINSI;

             |SI nAscci ! 10;  |Y nAscci ! 13;  |Y aCaracter ! "|";
                 aCampo = aCampo + aCaracter;
             |FINSI;
     |SIGUE;
|FPRC;

|PROCESO RecogerDatos;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;  |CIERRA #0;  |ACABA;  |FINSI;
     |CIERRA #0;

     aWeb = #0#7;  |QBF aWeb;
     |SI aWeb = "";  |ACABA;  |FINSI;

     aAbreSmf = aWeb + "altas.smf";
     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aAbreSmf, nHandle;
          |SI FSalida < 0;  |SAL;  |FINSI;
          |SLEEP 1;
          |PULSATECLA;
     |SIGUE;

     |XABRE "W", aAbreSmf, nHandle;
     |SI FSalida ] 0;
         aAlfa = "Grabando";
         |XGRABA nHandle, aAlfa;
     |FINSI;
     |XCIERRA nHandle;

     |ABRE #101;
     |ABRE #4;
     |ABRE #5;
     |ABRE #6;
     |ABRE #7;
     |ABRE #900;
     |ABRE #902;
     |SELECT #2#7;

     aCopialo1 = aWeb + "altas.txt";
     aCopialo2 = aWeb + "altastra.txt";
     |COPIA_FICHERO aCopialo1, aCopialo2;

     aAbre = aWeb + "altastra.txt";
     |XABRE "AB", aAbre, nHandle;
     |SI FSalida ] 0;
         |HAZ LeeRegistros;
     |FINSI;
     |XCIERRA nHandle;

     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #6;
     |CIERRA #7;
     |CIERRA #101;
     |CIERRA #900;
     |CIERRA #902;

     ||FBORRA aCopialo1;
     |FBORRA aCopialo2;
     |FBORRA aAbreSmf;
|FPRC;

|| Actualizar Datos ------------------------------------------------------

|PROCESO GrabaDatos;
     |DDEFECTO #900;
     #900#0  = #101#5;
     #900#1  = #101#215;
     aAlfa   = #101#7;                |QBF aAlfa;
     aAlfa   = aAlfa + " " + #101#8;  |QBF aAlfa;
     aAlfa   = aAlfa + "," + #101#6;  |QBF aAlfa;
     #900#2  = aAlfa;
     #900#3  = #101#17;
     #900#6  = #101#19;
     aAlfa   = #101#9;                |QBF aAlfa;
     aAlfa   = aAlfa + #101#10;
     #900#7  = aAlfa;
     aAlfa   = #101#18 % 102;
     #900#8  = aAlfa;
     aAlfa   = #101#18 % 303;
     #900#9  = aAlfa;
     #900#10 = #101#20;
     aAlfa   = (("00" + #101#13) % -102) + "." + (("00" + #101#14) % -102) + "." + #101#15;
     #900#11 = aAlfa;
     #900#17 = #101#202;
     #900#18 = #101#214;
     aAlfa   = (("00" + #101#193) % -102) + "." + (("00" + #101#194) % -102) + "." + #101#195;
     #900#34 = aAlfa;
     #900#36 = aAlfa;
     #900#38 = aAlfa;
     aAlfa   = (("00" + #101#196) % -102) + "." + (("00" + #101#197) % -102) + "." + #101#198;
     #900#37 = aAlfa;
     #900#45 = #101#199;
     #900#75 = #101#11;
     #900#76 = #101#16;
     #900#77 = #101#200;
     #900#87 = #101#201;
     #900#25 = #101#213;
     |GRABA 020#900n;
     |LIBERA #900;

     |DDEFECTO #901;
     #901#0 = #900#0;
     #901#1 = #900#1;
     |SI #101#26 ! "            ";  #901#4 = "C";  |FINSI;

     |SI #101#12 = "H";  #901#5 = "V";  |FINSI;
     |SI #101#12 = "M";  #901#5 = "M";  |FINSI;
     |GRABA 020#901n;
     |LIBERA #901;

     |SI nSinPI = 0;
          #903#0 = #900#7;
          |LEE 101#903=;
          |SI FSalida ! 0;
              |DDEFECTO #903;
              #903#0  = #900#7;
              #903#1  = #900#2;
              #903#2  = #900#3;
              #903#4  = #900#8;
              #903#5  = #900#9;
              #903#6  = #900#6;
              #903#7  = #900#10;
              #903#13 = #101#21;
              |GRABA 020#903n;
          |FINSI;
          |LIBERA #903;

          |SI #101#26 ! "            ";
              aAlfa   = #101#26;                |QBF aAlfa;
              aAlfa   = aAlfa + #101#27;
              #903#0  = aAlfa;
              |LEE 101#903=;
              |SI FSalida ! 0;
                  |DDEFECTO #903;
                  #903#0  = aAlfa;
                  aAlfa   = #101#28;               |QBF aAlfa;
                  aAlfa   = aAlfa + " " + #101#29; |QBF aAlfa;
                  aAlfa   = aAlfa + "," + #101#30; |QBF aAlfa;
                  #903#1  = aAlfa;
                  #903#2  = #900#3;
                  #903#4  = #900#8;
                  #903#5  = #900#9;
                  #903#6  = #900#6;
                  #903#7  = #900#10;
                  #903#13 = #101#21;
                  |GRABA 020#903n;
              |FINSI;
             |LIBERA #903;
         |FINSI;
     |FINSI;

     |SI #0#1 = "S";
         #904#0 = #900#7;
         #904#1 = 1;
         |LEE 101#904=;
         |SI FSalida ! 0;
             |DDEFECTO #904;
             #904#0  = #900#7;
             #904#1  = 1;
             #904#2  = "TITULAR";
             #904#8  = #900#7;
             #904#9  = #101#7;
             #904#10 = #101#8;
             #904#11 = #101#6;
             #904#12 = #900#2;
             #904#13 = #900#11;
             #904#13 = #900#11;
             |SI #101#26 ! "            ";  #904#14 = "C";  |FINSI;
             #904#15 = #101#25;
             |SI #101#23 = 1;    #904#17 = 33;   |FINSI;
             |SI #101#23 = 2;    #904#17 = 65;   |FINSI;
             |SI #101#24 = "SI"; #904#18 = "S";  |FINSI;
             #904#25 = #101#17;
             #904#30 = #900#8;
             #904#31 = #900#9;
             #904#32 = #900#6;
             #904#33 = #900#10;
             |SI #101#35 = "SI"; #904#38 = "S";  |FINSI;
             |SI #101#36 = "SI"; #904#39 = "S";  |FINSI;
             aAlfa   = (("00" + #101#37) % -102) + "." + (("00" + #101#38) % -102) + "." + #101#39;
             #904#40 = aAlfa;
             |GRABA 020#904n;
         |FINSI;
         |LIBERA #904;

         |SI #101#26 ! "            ";
             #904#0 = #900#7;
             #904#1 = 2;
             |LEE 101#904=;
             |SI FSalida ! 0;
                 |DDEFECTO #904;
                 #904#0  = #900#7;
                 #904#1  = 2;
                 #904#2  = "CONYUGE";
                 aAlfa   = #101#26;                |QBF aAlfa;
                 aAlfa   = aAlfa + #101#27;
                 #904#8  = aAlfa;
                 #904#9  = #101#29;
                 #904#10 = #101#30;
                 #904#11 = #101#28;
                 aAlfa   = #101#28;               |QBF aAlfa;
                 aAlfa   = aAlfa + " " + #101#29; |QBF aAlfa;
                 aAlfa   = aAlfa + "," + #101#30; |QBF aAlfa;
                 #904#12 = aAlfa;
                 aAlfa   = (("00" + #101#31) % -102) + "." + (("00" + #101#32) % -102) + "." + #101#33;
                 #904#13 = aAlfa;
                 #904#14 = "C";
                 #904#25 = #900#3;
                 #904#30 = #900#8;
                 #904#31 = #900#9;
                 #904#32 = #900#6;
                 #904#33 = #900#10;
                 |GRABA 020#904n;
             |FINSI;
             |LIBERA #904;
         |FINSI;

         nLinea = 3;
         |PARA nCampo1 = 113;  |SI nCampo1 [ 185;  |HACIENDO nCampo1 = nCampo1 + 8;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               nCampo4 = nCampo1 + 3;
               nCampo5 = nCampo1 + 4;
               nCampo6 = nCampo1 + 5;
               nCampo7 = nCampo1 + 6;
               nCampo8 = nCampo1 + 7;

               |SI #101nCampo1 ! "                    ";
                   #904#0 = #900#7;
                   #904#1 = nLinea;
                   |LEE 101#904=;
                   |SI FSalida ! 0;
                       #904#0  = #900#7;
                       #904#1  = nLinea;
                       #904#2  = "DESCENDIENTE";
                       #904#9  = #101nCampo2;
                       #904#10 = #101nCampo3;
                       #904#11 = #101nCampo1;
                       aAlfa   = #904#9;                |QBF aAlfa;
                       aAlfa   = aAlfa + " " + #904#10; |QBF aAlfa;
                       aAlfa   = aAlfa + "," + #904#11; |QBF aAlfa;
                       #904#12 = aAlfa;
                       aAlfa   = "01.01." + #101nCampo4;
                       #904#13 = aAlfa;
                       |SI #101nCampo7 = 1;    #904#17 = 33;   |FINSI;
                       |SI #101nCampo7 = 2;    #904#17 = 65;   |FINSI;
                       |SI #101nCampo8 = "SI"; #904#18 = "S";  |FINSI;

                       #904#25 = #101#17;
                       #904#30 = #900#8;
                       #904#31 = #900#9;
                       #904#32 = #900#6;
                       #904#33 = #900#10;
                       #904#41 = #101nCampo5;

                       |GRABA 020#904n;
                   |FINSI;
                   |LIBERA #904;

                   nLinea = nLinea + 1;
               |FINSI;
         |SIGUE;

         |PARA nCampo1 = 42;  |SI nCampo1 [ 105;  |HACIENDO nCampo1 = nCampo1 + 7;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               nCampo4 = nCampo1 + 3;
               nCampo5 = nCampo1 + 4;
               nCampo6 = nCampo1 + 5;
               nCampo7 = nCampo1 + 6;

               |SI #101nCampo1 ! "                    ";
                   #904#0 = #900#7;
                   #904#1 = nLinea;
                   |LEE 101#904=;
                   |SI FSalida ! 0;
                       #904#0  = #900#7;
                       #904#1  = nLinea;
                       #904#2  = "ASCENDIENTE";
                       #904#5  = #101nCampo5;
                       #904#9  = #101nCampo2;
                       #904#10 = #101nCampo3;
                       #904#11 = #101nCampo1;
                       aAlfa   = #904#9;                |QBF aAlfa;
                       aAlfa   = aAlfa + " " + #904#10; |QBF aAlfa;
                       aAlfa   = aAlfa + "," + #904#11; |QBF aAlfa;
                       #904#12 = aAlfa;
                       aAlfa   = "01.01." + #101nCampo4;
                       #904#13 = aAlfa;
                       |SI #101nCampo6 = 1;    #904#17 = 33;   |FINSI;
                       |SI #101nCampo6 = 2;    #904#17 = 65;   |FINSI;
                       |SI #101nCampo7 = "SI"; #904#18 = "S";  |FINSI;

                       #904#25 = #101#17;
                       #904#30 = #900#8;
                       #904#31 = #900#9;
                       #904#32 = #900#6;
                       #904#33 = #900#10;

                       |GRABA 020#904n;
                   |FINSI;
                   |LIBERA #904;

                   nLinea = nLinea + 1;
               |FINSI;
         |SIGUE;
     |FINSI;

     |BORRA 020#101a;
     |LIBERA #101;

     #101#0 = "S";
     |GRABA 020#101n;
     |LIBERA #101;

     |PONCONTROL 23, "SI";
     |PTEC 808;
|FPRC;

|PROCESO CopiaNomtrali2;
     #906#0 = nEmp;
     #906#1 = #101#215;
     |GRABA 020#906n;
     |SI FSalida ! 0;
          aAlfa1 = #906#0;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
          aAlfa2 = #906#1;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
          aAlfa = "    Ya estan definidos Importes por Trabajador";
          aAlfa = aAlfa + " para el trabajador destino " + aAlfa1 + "." + aAlfa2;
          |MENAV aAlfa;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CopiaNomtrali;
     #906#1003;
     ;
     nEmp, nTra, 001;
     nEmp, nTra, 999;
     ;
     NULL, CopiaNomtrali2;
|FIN;

|PROCESO CopiaNomtrali;
     |SI aImp = "S"; |Y swCopia = 1;
          |ABRE #905;
          |DDEFECTO #905;
          #905#0 = nEmp;
          #905#1 = #101#215;
          |LEE 000#905=;
          |SI FSalida ! 0;    || si no existe grabo cabecera
               #905#0 = #101#5;
               #905#1 = #101#215;
               #905#3 = 0;

               |ABRE #907;         || constante de la empresa
               #907#0 = nEmp;
               |LEE 000#907=;
               |SI FSalida = 0;
                    #905#3 = #907#32;
               |FINSI;
               |CIERRA #907;

               |GRABA 020#905.n;
          |FINSI;
          |BUCLE CopiaNomtrali;
     |FINSI;
|FPRC;

|PROCESO CopiaNomtraca;
     |ABRE #905;
     |DDEFECTO #905;
     #905#0 = nEmp;
     #905#1 = #101#215;
     |LEE 000#905=;
     |SI FSalida ! 0;
          |SI aCons = "S";
               #905#0 = nEmp;
               #905#1 = nTra;
               |LEE 000#905=;
               |SI FSalida = 0;
                    #905#0 = #101#5;
                    #905#1 = #101#215;
                    |GRABA 020#905.n;
               |SINO;
                    aAlfa1 = nEmp;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
                    aAlfa2 = nTra;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
                    aAlfa = "    NO se pueden copiar Importes por Trabajador.";
                    aAlfa = aAlfa + " NO existen en trabajador origen " + aAlfa1 + "." + aAlfa2;
                    |MENAV aAlfa;
                    swCopia = 0;
               |FINSI;
          |FINSI;
     |SINO;
          aAlfa1 = #905#0;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
          aAlfa2 = #905#1;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
          aAlfa = "    Ya estan definidos Importes por Trabajador";
          aAlfa = aAlfa + " para el trabajador destino " + aAlfa1 + "." + aAlfa2;
          |MENAV aAlfa;
          swCopia = 0;
     |FINSI;
     |CIERRA #905;
|FPRC;

|PROCESO CopiaTrab;
     swCopia = 0;
     aAlfa = "     Copiar Constante/Importes por Trabajador ";
     aAlfa = aAlfa + "desde otro trabajador?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          nEmp = #101#5;
          |PUSHV 0501 2380;
          |PINPA #0#205;
          |PINDA #0#205;
          |ENDATOS #1#205;
          |POPV;
          |SI FSalida = 0;
               swCopia = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Actualiza;
     |CONFI "0000SSeguro de Actualizar el Registro";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#101=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #900;
     #900#0 = #101#5;
     #900#1 = 99999;
     |LEE 040#900];
     |SI FSalida = 0;
         |LEE 040#900a;
     |SINO;
         |LEE 040#900u;
     |FINSI;

     #101#215 = 1;
     |SI FSalida = 0;  |Y #900#0 = #101#5;
         #101#215 = #900#1 + 1;
     |FINSI;

     |MENAV "0000 Introduzca el Codigo de Trabajador, la maquina coge el ultimo Trabajador + 1";
     |PARA;  |SI;  |HACIENDO;
          |ENCAMPO #215#101;
          #900#0 = #101#5;
          #900#1 = #101#215;
          |LEE 040#900=;
          |SI FSalida ! 0;  |SAL;  |FINSI;
          |MENAV "0000 El Trabajador ya existe.";
     |SIGUE;

     |HAZ CopiaTrab;

     |ABRE #901;
     |ABRE #902;
     |SI nSinPI = 0;     |ABRE #903;    |FINSI;
     |SI #0#1   = "S";   |ABRE #904;    |FINSI;
     |HAZ GrabaDatos;
     |SI swCopia = 1;
          |HAZ CopiaNomtraca;
          |HAZ CopiaNomtrali;
     |FINSI;
     |CIERRA #900;
     |CIERRA #901;
     |CIERRA #902;
     |SI nSinPI = 0;     |CIERRA #903;  |FINSI;
     |SI #0#1   = "S";   |CIERRA #904;  |FINSI;
|FPRC;

|| Impresion de datos ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

|PROCESO ImWeb;
     |SI #101#26 = "            ";
          aFlag = "0";
     |SINO;
          aFlag = "1";
     |FINSI;
     |SI #101#0 = aParametro;
          |SI aParametro = "N";
               aTitulo = "Informe de altas pendientes de actualizar ";
          |SINO;
               aTitulo = "    Informe del hist¢rico web de altas    ";
          |FINSI;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE ImpreWeb;
     #101#1;
     ;
     "0",#99#0,"000000000",#99#2,"00000000";
     "z",#99#1,"zzzzzzzzz",#99#3,"zzzzzzzz";
     ;
     NULL,ImWeb;
|FIN;

|PROCESO Imprimir; ||proceso de impresion de los datos
     |AVISO;
     |CONFI "0000NDesea imprimir informe de la recogida de datos de la web?"
     |SI FSalida = 0;
     |PUSHV 0501 2380;
     |CLS;
     |CABEZA "Recogida de la Web";
     |PINPA #0#99;       || ------ Pintamos pantalla auxiliar de acotacion
     |PINDA #0#99;
     |ABRE #99;
     |ENDATOS #1#99;
     |SI FSalida = 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "dslam101";
               |SI FSalida = 0;
                    |BUCLE ImpreWeb;
                    sw = 1;
                    |PTEC 807;
                    |PIEINF;
                    |FININF;
               |SINO;
                    |MENAV "0000 El infomre no esta disponible.";
               |FINSI;
          |SINO;
               |MENAV "0000 La impresora selecionada no esta disponible.";
          |FINSI;
          |FINIMP;
          |CIERRA #99;
     |FINSI;
|FINSI;
|POPV;
|FPRC;

|| Datos Pantalla --------------------------------------------------------

|PROCESO Mensa;  |TIPO 7;
     |SI #101#0 = "N";
         |MENSA "0000 <F2> Ver Datos. <F3> Actualizar Alta. <F4> Borrar Registro. <F5> Imprimir";
     |SINO;
         |MENSA "0000 <F2> Pantalla todos los Datos. <F5> Imprimir";
     |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         |PARA nCampo = 0;  |SI nCampo [ 214;  |HACIENDO nCampo = nCampo + 1;
               #201nCampo = #101nCampo;
         |SIGUE;

         #201#219 = #101#216; ||Observaciones 2
         #201#220 = #101#217; ||Observaciones 3

         |PUSHV 0501 2380;
         |PINPA #0#201;
         |PINDA #0#201;
         |ENDATOS #4#201;
         |POPV;

         |ERROR;
     |FINSI;

     |SI FSalida = 11;  |Y #101#0 = "N";
         |HAZ Actualiza;
     |FINSI;

     |SI FSalida = 12;  |Y #101#0 = "N";
         |CONFI "0000NSeguro de Borrar el Registro ";
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;

         |LEE 101#101=;
         |BORRA 020#101a;
         |LIBERA #101;

         #101#0 = "B";
         |GRABA 020#101n;

         |PONCONTROL 23, "SI";
         |PTEC 808;
     |FINSI;

     |SI FSalida = 13;
          |HAZ Imprimir;
     |FINSI;
|FPRC;


|| Comienzo Programa -----------------------------------------------------

|RUTINA ClaveBaja101;
     #101#0 = aParametro;
     #101#1 = "";
     #101#2 = "";
     #101#3 = "01.01.0000";
     #101#4 = "";
|FRUT;

|RUTINA ClaveAlta101;
     #101#0 = aParametro;
     #101#1 = "zzzzzzzzzz";
     #101#2 = "zzzzzzzzzz";
     #101#3 = "31.12.9999";
     #101#4 = "zzzzzzzz";
|FRUT;

|PROGRAMA;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
     |CIERRA #0;

     |DBASS aBase;  |QBF aBase;

     |SI #0#1 = "S";
         aFichLab = aBase + "laboral/fich/";
         aFichInt = aBase + "integral/fich/";
         aFichBas = aBase + "basica/fich/";
     |SINO;
         aFichLab = aBase + "aginom/fich/";
         aFichBas = aBase + "agicli/fich/";
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labtraba.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labtraba.mas";
     |FINSI;

     |CARGA_DEF aMas, labtraba@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labpadre.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labpadre.mas";
     |FINSI;

     |CARGA_DEF aMas, labpadre@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labtraba@;

         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labcentr.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labcentr.mas";
     |FINSI;

     |CARGA_DEF aMas, labcentr@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;

         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/nomtraca.mas";
     |SINO;
         aMas  = aBase + "aginom/def/nomtraca.mas";
     |FINSI;

     |CARGA_DEF aMas, nomtraca@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;

         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/nomtrali.mas";
     |SINO;
         aMas  = aBase + "aginom/def/nomtrali.mas";
     |FINSI;

     |CARGA_DEF aMas, nomtrali@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #nomtraca@;

         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labempre.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labempre.mas";
     |FINSI;

     |CARGA_DEF aMas, labempre@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #nomtraca@;
         |DESCARGA_DEF #nomtrali@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "integral/def/dsam0103.mas";
     |CARGA_DEF aMas, dsam0103@;
     |SI FSalida ! 0;
          nSinPI = 1;         || no tiene PI
     |SINO;
          nSinPI = 0;         || si tiene PI
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "basica/def/agidanif.mas";

         |CARGA_DEF aMas, agidanif@;
         |SI FSalida ! 0;
             aAlfa = "0000 No puedo cargar el Def " + aMas;
             |MENAV aAlfa;

             |SI nSinPI = 0;     |DESCARGA_DEF #dsam0103@;     |FINSI;

             |DESCARGA_DEF #labcentr@;
             |DESCARGA_DEF #labpadre@;
             |DESCARGA_DEF #labtraba@;
             |DESCARGA_DEF #nomtraca@;
             |DESCARGA_DEF #nomtrali@;
             |DESCARGA_DEF #labempre@;
             |ACABA;
         |FINSI;
     |FINSI;

     |PATH_DAT #900 aFichLab;
     |PATH_DAT #901 aFichLab;
     |PATH_DAT #902 aFichLab;
     |PATH_DAT #905 aFichLab;
     |PATH_DAT #906 aFichLab;
     |PATH_DAT #907 aFichLab;
     |SI nSinPI = 0;     |PATH_DAT #903 aFichInt; |FINSI;
     |SI #0#1 = "S";     |PATH_DAT #904 aFichBas; |FINSI;

     |CLS;
     |CABEZA "Altas";

     |PINPA #0#101;
     |MENSA "0000 Recogiendo Datos de la Web.";

     aParametro = PARAMETRO;  |QBF aParametro;

     |SI aParametro = "N";
         |HAZ RecogerDatos;

         aAlfa = "0000 Registros Recogidos " + nRegis;
         |MENAV aAlfa;

         |MENSA "0000                            ";
     |FINSI;

     sw = 1;
     |PARA; |SI sw ! 0; |HACIENDO;
          sw = 0;
          |ENTLINEAL #1#101, -2, 4, 22, 1, ClaveBaja101, ClaveAlta101;
     |SIGUE;

     |SI #0#1 = "S";     |DESCARGA_DEF #agidanif@;     |FINSI;
     |SI nSinPI = 0;     |DESCARGA_DEF #dsam0103@;     |FINSI;
     |DESCARGA_DEF #labcentr@;
     |DESCARGA_DEF #labpadre@;
     |DESCARGA_DEF #labtraba@;
     |DESCARGA_DEF #nomtraca@;
     |DESCARGA_DEF #nomtrali@;
     |DESCARGA_DEF #labempre@;
|FPRO;
