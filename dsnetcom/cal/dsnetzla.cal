|FICHEROS;
     dsnetm00 #0;
     dsnetm02 #2;
     dsnetm07 #7;

     dslam001 #51;    || labempre
     dslam002 #52;    || labcentr
     dslam003 #53;    || labtraba
     dslam004 #54;    || nomconca
     dslam005 #55;    || labcon00
     dslam006 #56;    || nomcateg
     dslam007 #57;    || nomvarca
     dslam008 #58;    || dslam008
     dslam011 #59;    || labregis
     dslam012 #60;    || nomhicca
     dslam013 #61;    || dsm190li

     labempre@ #100;
     labcentr@ #101;
     labtraba@ #102;
     nomconca@ #103;
     labcon00@ #104;
     nomcateg@ #105;
     nomvarca@ #106;
     nomhicca@ #107;
     labregis@ #108;
     labhisto@ #109;
     dsm190li@ #110;
     eosm0034@ #111;
|FIN;

|VARIABLES;
     aAginomSN = "";
     nEjer       = 0;
     nEjercicio  = 0;
     nMes        = 0;
     nAnyoD      = 0;
     nAnyoH      = 0;
     nAnyo       = 0;
     nSwHay      = 0;
     nHandle     = 0;

     aAlfa       = "";
     aBase       = "";
     aMas        = "";
     aFich       = "";
     aFichMod    = "";
     aFichAgi    = "";
     fFecha      = @;
     nNume       = 0;
     nEmpreAnt = 0;
     aAntNIF = "";
     aAntEmpre = "";
     aAntAnyo = "";
|FIN;

|PROCESO dslam012;
     #60#0 = #107#0;
     #60#1 = #107#1;
     #60#2 = #107#66;
     #60#3 = #107#2;
     #60#4 = #107#3;
     |GRABA 020#60n;
     |LIBERA #60;
|FPRC;

|DEFBUCLE nomhicca2;
     #107#1005;
     ;
     #7#2, 00001, nAnyoD, 00, 0;
     #7#2, 99999, nAnyoH, 99, 9;
     ;
     NULL, dslam012;
|FIN;

|PROCESO dslam013;
     #61#0 = #110#0;
     #61#1 = #110#1;
     #61#2 = #110#6;
     #61#3 = "N";
     |SI #110#6 = aAntNIF; |Y #110#1 = aAntAnyo; |Y #110#0 = aAntEmpre;
          |ACABA;
     |SINO;
          aAntEmpre = #110#0;
          aAntAnyo = #110#1;
          aAntNIF = #110#6;
          |GRABA 000#61n;
          |LIBERA #61;
     |FINSI;
|FPRC;

|DEFBUCLE dsm190li;
     #110#3006;
     3;
     #7#2,nAnyoD, " ","  ", "            ", 00,190;
     #7#2,nAnyoH, "z","zz", "zzzzzzzzzzzz", 99,190;
     ;
     NULL, dslam013;
|FIN;

|PROCESO dslam013wAgi;
     #61#0 = #111#0;
     #61#1 = #111#1;
     #61#2 = #111#2;
     #61#3 = "S";
     |SI #111#2 = aAntNIF; |Y #111#1 = aAntAnyo; |Y #111#0 = aAntEmpre;
          |ACABA;
     |SINO;
          aAntEmpre = #111#0;
          aAntAnyo = #111#1;
          aAntNIF = #111#6;
          |GRABA 000#61n;
          |LIBERA #61;
     |FINSI;
|FPRC;

|DEFBUCLE eosm0034;
     #111#1007;
     ;
     #7#2,nAnyoD, "            ", 0, " ", "  ",0;
     #7#2,nAnyoH, "zzzzzzzzzzzz", 9999, "z", "zz", 9;
     ;
     NULL, dslam013wAgi;
|FIN;

|PROCESO dslam004;
     #54#0 = #103#0;
     #54#1 = #103#1;
     |GRABA 020#54n;
     |LIBERA #54;
     nSwHay = 2;
|FPRC;

|DEFBUCLE nomconca;
     #103#1001;
     ;
     000;
     999;
     ;
     NULL, dslam004;
|FIN;

|PROCESO dslam005;
     #55#0 = #104#0;
     #55#1 = #104#1;
     #55#2 = #104#2;
     |GRABA 020#55n;
     |LIBERA #55;

     nSwHay = 2;
|FPRC;

|DEFBUCLE labcon00;
     #104#1001;
     ;
     "   ";
     "zzz";
     ;
     NULL, dslam005;
|FIN;

|PROCESO dslam006;
     #56#0 = #105#0;
     #56#1 = #105#1;
     #56#2 = #105#2;
     |GRABA 020#56n;
     |LIBERA #56;
     nSwHay = 2;
|FPRC;

|DEFBUCLE nomcateg;
     #105#1002;
     ;
       0,  0;
     999, 99;
     ;
     NULL, dslam006;
|FIN;

|PROCESO CreaSinEmpresas;
     |ABRE #54;  |BUCLE nomconca;  |CIERRA #54;
     |ABRE #55;  |BUCLE labcon00;  |CIERRA #55;
     |ABRE #56;  |BUCLE nomcateg;  |CIERRA #56;
|FPRC;

|PROCESO BuscaPeriodo;
     |SI #107#66 ] 80;
         nEjer = 1900 + #107#66;
     |SINO;
         nEjer = 2000 + #107#66;
     |FINSI;

     |SI nEjercicio < nEjer;
         nEjercicio = nEjer;
         nMes       = #107#2;
     |FINSI;

     |SI nEjercicio = nEjer;  |Y nMes < #107#2;
         nMes       = #107#2;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #107#1005;
     ;
     #7#2, 00001, nAnyoD, 00, 0;
     #7#2, 99999, nAnyoH, 99, 9;
     ;
     NULL, BuscaPeriodo;
|FIN;

|PROCESO dslam011;
     #102#0 = #108#1;
     #102#1 = #108#2;
     |LEE 000#102=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;

     |PARA nNume = 0; |SI nNume [ #108#15; |HACIENDO nNume = nNume + 1;
          #109#100 = #108#0;
          |SI nNume ! 0;
               aAlfa = nNume;
          |SINO;
               aAlfa = "  ";
          |FINSI;
          #109#103 = aAlfa;
          |LEE 000#109=;
          |SI FSalida = 0;
               |SAL;
          |FINSI;
     |SIGUE;

     |SI FSalida ! 0;    |ACABA;   |FINSI;

     #59#0 = #7#0;
     #59#1 = #108#0;
     #59#2 = #108#1;
     #59#3 = #108#2;
     #59#4 = #102#77;
     #59#5 = #102#2;
     #59#6 = #102#7;
     #59#7 = #108#4;
     |GRABA 020#59n;
     |LIBERA #59;

     |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
|FPRC;

|DEFBUCLE labregis;
     #108#2002;
     ;
     #7#2, 00000;
     #7#2, 99999;
     ;
     NULL, dslam011;
|FIN;

|PROCESO dslam002;
     #52#0 = #7#0;
     #52#1 = #101#0;
     #52#2 = #101#1;
     #52#3 = #101#2;
     #52#4 = #101#6;
     #52#5 = #101#10;
     |GRABA 020#52n;
     |LIBERA #52;

     |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
|FPRC;

|DEFBUCLE labcentr;
     #101#1002;
     ;
     #7#2, 00;
     #7#2, 99;
     ;
     NULL, dslam002;
|FIN;

|PROCESO dslam003;
     #53#0 = #7#0;
     #53#1 = #102#0;
     #53#2 = #102#1;
     #53#3 = #102#77;
     #53#4 = #102#2;
     #53#5 = #102#7;
     #53#6 = #102#44;
     #53#7 = #102#87;
     #53#8 = #102#17;
     #53#9 = #102#244;
     |GRABA 020#53n;
     |LIBERA #53;

     |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #102#1002;
     ;
     #7#2, 00000;
     #7#2, 99999;
     ;
     NULL, dslam003;
|FIN;

|PROCESO dslam007;
     |SI #106#12 ! " ";
         #57#0 = #7#0;
         #57#1 = #106#0;
         #57#2 = #106#1;
         #57#3 = nEjercicio;
         #57#4 = nMes;
         #57#5 = #106#12;
         #57#6 = #106#4;
         #57#7 = #106#8;
         |GRABA 020#57n;
         |LIBERA #57;

         |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
     |FINSI;

     |SI #106#13 ! " ";
         #57#0 = #7#0;
         #57#1 = #106#0;
         #57#2 = #106#1;
         #57#3 = nEjercicio;
         #57#4 = nMes;
         #57#5 = #106#13;
         #57#6 = #106#5;
         #57#7 = #106#9;
         |GRABA 020#57n;
         |LIBERA #57;

         |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
     |FINSI;

     |SI #106#14 ! " ";
         #57#0 = #7#0;
         #57#1 = #106#0;
         #57#2 = #106#1;
         #57#3 = nEjercicio;
         #57#4 = nMes;
         #57#5 = #106#14;
         #57#6 = #106#6;
         #57#7 = #106#10;
         |GRABA 020#57n;
         |LIBERA #57;

         |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
     |FINSI;

     |SI #106#15 ! " ";
         #57#0 = #7#0;
         #57#1 = #106#0;
         #57#2 = #106#1;
         #57#3 = nEjercicio;
         #57#4 = nMes;
         #57#5 = #106#15;
         #57#6 = #106#7;
         #57#7 = #106#11;
         |GRABA 020#57n;
         |LIBERA #57;

         |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomvarca;
     #106#1004;
     ;
     #7#2, 00000, nMes, 0;
     #7#2, 99999, nMes, 0;
     ;
     NULL, dslam007;
|FIN;

|PROCESO CreaConEmpresas;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     nAnyo  = aAlfa;
     nAnyo  = nAnyo - 1;
     aAlfa  = nAnyo;
     aAlfa  = aAlfa % -102;
     nAnyo  = aAlfa;
     |SI nAnyo ] 80;
         nAnyoD = 00;
         nAnyoH = nAnyo;
     |SINO;
         nAnyoD = nAnyo;
         nAnyoH = 79;
     |FINSI;

     nEjercicio = 0;
     nMes       = 0;
     |BUCLE nomhicca;

     |ABRE #51;
     |ABRE #100;
     #100#0 = #7#2;
     |LEE 040#100=;
     |SI FSalida = 0;
         #51#0 = #7#0;
         #51#1 = #7#2;
         #51#2 = #100#2;
         #51#3 = #100#10;
         #51#4 = #100#1;
         #51#5 = #100#13;
         #51#6 = nEjercicio;
         #51#7 = nMes;
         |GRABA 020#51n;
         |LIBERA #51;

         |SI nSwHay = 0;  nSwHay = 1;  |FINSI;
     |FINSI;
     |CIERRA #51;
     |CIERRA #100;

     |ABRE #52;  |BUCLE labcentr;  |CIERRA #52;
     |ABRE #53;  |BUCLE labtraba;  |CIERRA #53;

/*
     |ABRE #57;  |BUCLE nomvarca;  |CIERRA #57;
*/
     |ABRE #109;
     |ABRE #102;
     |ABRE #59;
     |BUCLE labregis;
     |CIERRA #59;
     |CIERRA #102;
     |CIERRA #109;
|FPRC;

|DEFBUCLE dsnetm07;
     #7#1;
     ;
     #2#0, "LABORAL   ", 00001;
     #2#0, "LABORAL   ", 99999;
     ;
     NULL, CreaConEmpresas;
|FIN;

|PROCESO UsuariosLab;
     |BUCLE dsnetm07;
     |SI nSwHay = 1;
         |HAZ CreaSinEmpresas;
     |FINSI;
|FPRC;

|DEFBUCLE dsnetm02_la;
     #2#1;
     ;
     "        ";
     "zzzzzzzz";
     ;
     NULL, UsuariosLab;
|FIN;

|PROCESO Empresas;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     nAnyo  = aAlfa;
     aAlfa  = aAlfa % -102;
     nAnyoH = aAlfa;
     nAnyoD  = nAnyo - 5;
     aAlfa = nAnyoD;
     aAlfa = aAlfa % -102;
     nAnyoD = aAlfa;
     |SI nEmpreAnt = #7#2;
          |ACABA;
     |SINO;
          nEmpreAnt = #7#2;
          |ABRE #60; |BUCLE nomhicca2; |CIERRA #60;
     |FINSI;
     nAnyoD = nAnyoD + 2000;
     nAnyoH = nAnyoH + 2000;

     |ABRE #61;
     |BUCLE dsm190li;
     |SI aAginomSN = "S";
          |BUCLE eosm0034;
     |FINSI;
     |CIERRA #61;
|FPRC;

|DEFBUCLE dsnetm07_Apli;
     #7#3;
     ;
     00001;
     99999;
     ;
     NULL, Empresas;
|FIN;

|PROCESO Laboral;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
     |CIERRA #0;

     |DBASS aBase;  |QBF aBase;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labempre.mas";
         aFich = aBase + "laboral/fich/";
     |SINO;
         aMas  = aBase + "aginom/def/labempre.mas";
         aFich = aBase + "aginom/fich/";
     |FINSI;

     |XABRE "E", aMas, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labempre.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labempre.mas";
     |FINSI;

     |CARGA_DEF aMas, labempre@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labcentr.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labcentr.mas";
     |FINSI;

     |CARGA_DEF aMas, labcentr@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labtraba.mas";
     |SINO;
         aMas  = aBase + "aginom/def/labtraba.mas";
     |FINSI;

     |CARGA_DEF aMas, labtraba@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/nomconca.mas";
     |SINO;
         aMas  = aBase + "aginom/def/nomconca.mas";
     |FINSI;

     |CARGA_DEF aMas, nomconca@
     |SI FSalida ! 0;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/nomcateg.mas";
     |SINO;
         aMas  = aBase + "aginom/def/nomcateg.mas";
     |FINSI;

     |CARGA_DEF aMas, nomcateg@
     |SI FSalida ! 0;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/nomvarca.mas";
     |SINO;
         aMas  = aBase + "aginom/def/nomvarca.mas";
     |FINSI;

     |CARGA_DEF aMas, nomvarca@
     |SI FSalida ! 0;
         |DESCARGA_DEF #nomcateg@;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/nomhicca.mas";
     |SINO;
         aMas  = aBase + "aginom/def/nomhicca.mas";
     |FINSI;

     |CARGA_DEF aMas, nomhicca@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #nomvarca@;
         |DESCARGA_DEF #nomcateg@;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labcon00.mas";
     |SINO;
         || aMas  = aBase + "agilab/def/labcon00.mas";
         aMas  = aBase + "aginom/def/labcon00.mas";
     |FINSI;

     |CARGA_DEF aMas, labcon00@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #nomhicca@;
         |DESCARGA_DEF #nomvarca@;
         |DESCARGA_DEF #nomcateg@;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labregis.mas";
     |SINO;
         || aMas  = aBase + "agilab/def/labregis.mas";
         aMas  = aBase + "aginom/def/labregis.mas";
     |FINSI;

     |CARGA_DEF aMas, labregis@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #labcon00@;
         |DESCARGA_DEF #nomhicca@;
         |DESCARGA_DEF #nomvarca@;
         |DESCARGA_DEF #nomcateg@;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |ACABA;
     |FINSI;

     |SI #0#1 = "S";
         aMas  = aBase + "laboral/def/labhisto.mas";
     |SINO;
         || aMas  = aBase + "agilab/def/labregis.mas";
         aMas  = aBase + "aginom/def/labhisto.mas";
     |FINSI;

     |CARGA_DEF aMas, labhisto@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #labcon00@;
         |DESCARGA_DEF #nomhicca@;
         |DESCARGA_DEF #nomvarca@;
         |DESCARGA_DEF #nomcateg@;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |DESCARGA_DEF #labregis@;
         |ACABA;
     |FINSI;

     aMas  = aBase + "modelos/def/dsm190li.mas";
     aFichMod = aBase + "modelos/fich/";

     |CARGA_DEF aMas, dsm190li@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #labcon00@;
         |DESCARGA_DEF #nomhicca@;
         |DESCARGA_DEF #nomvarca@;
         |DESCARGA_DEF #nomcateg@;
         |DESCARGA_DEF #nomconca@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #labempre@;
         |DESCARGA_DEF #labregis@;
         |DESCARGA_DEF #dsm190li@;
         |ACABA;
     |FINSI;
     aMas  = aBase + "aginom/def/eosm0034.mas";
     aFichAgi = aBase + "aginom/fich/";

     |CARGA_DEF aMas, eosm0034@;
     aAginomSN = "S";
     |SI FSalida ! 0;
         ||DESCARGA_DEF #eosm0034@;
         aAginomSN = "N";
     |FINSI;

     |PATH_DAT #100 aFich;
     |PATH_DAT #101 aFich;
     |PATH_DAT #102 aFich;
     |PATH_DAT #103 aFich;
     |PATH_DAT #104 aFich;
     |PATH_DAT #105 aFich;
     |PATH_DAT #106 aFich;
     |PATH_DAT #107 aFich;
     |PATH_DAT #108 aFich;
     |PATH_DAT #109 aFich;
     |PATH_DAT #110 aFichMod;
     |SI aAginomSN = "S";
          |PATH_DAT #111 aFichAgi;
     |FINSI;

     |ABRE #51;  |CIERRA #51;  |DELINDEX #51;
     |ABRE #52;  |CIERRA #52;  |DELINDEX #52;
     |ABRE #53;  |CIERRA #53;  |DELINDEX #53;
     |ABRE #54;  |CIERRA #54;  |DELINDEX #54;
     |ABRE #55;  |CIERRA #55;  |DELINDEX #55;
     |ABRE #56;  |CIERRA #56;  |DELINDEX #56;
     |ABRE #57;  |CIERRA #57;  |DELINDEX #57;
     |ABRE #59;  |CIERRA #59;  |DELINDEX #59;
     |ABRE #60;  |CIERRA #60;  |DELINDEX #60;
     |ABRE #61;  |CIERRA #61;  |DELINDEX #61;

     nSwHay = 0;
     |BUCLE dsnetm02_la;

     |BUCLE dsnetm07_Apli;

     |SI aAginomSN = "S";
          |DESCARGA_DEF #eosm0034@;
     |FINSI;
     |DESCARGA_DEF #dsm190li@;
     |DESCARGA_DEF #labhisto@;
     |DESCARGA_DEF #labregis@;
     |DESCARGA_DEF #labcon00@;
     |DESCARGA_DEF #nomhicca@;
     |DESCARGA_DEF #nomvarca@;
     |DESCARGA_DEF #nomcateg@;
     |DESCARGA_DEF #nomconca@;
     |DESCARGA_DEF #labtraba@;
     |DESCARGA_DEF #labcentr@;
     |DESCARGA_DEF #labempre@;
|FPRC;
