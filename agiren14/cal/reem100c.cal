|FICHEROS;
     reemi100;
     reemipat;

     rem01001;
     rew00001;
     rew02001;

     zregubic;
|FIN;

|VARIABLES;
      nCont           = 0;
      nCalc           = 0;
      nCalc1          = 0;
      nCalc2          = 0;
      nHandle         = 0;
      nHandle1        = 0;
      nHandle2        = 0;
      nHandleErr      = 0;
      SwEstar         = 0;
      DEmpre          = 0;
      HEmpre          = 0;
      XCampos         = 0;
      nRegsPorEmitir  = 0;
      nRango          = 0;
      nPos            = 0;
      nPos1           = 0;
      nPos2           = 0;
      FEstado         = 0;
      nCopia          = 0;
      nCanal          = 0;
      nSwCopia        = 0;
      nSwPresenta     = 0;
      nLongitud       = 0;
      nValida         = 0;
      nVent           = 0;
      nVentErr        = 0;
      nPant           = 0;
      nPantErr        = 0;
      nBotonCont      = 0;
      nBotonSal       = 0;
      nBotonErr       = 0;
      nBotonSalirErr  = 0;
      nBotonUnidad    = 0;
      nBotonOk        = 0;
      nBotonCancel    = 0;
      nBotonExplor    = 0;
      nBotonReader    = 0;
      nBotonImpre     = 0;
      nBotonValida    = 0;
      nBotonSalir     = 0;
      nBotonPrevis    = 0;
      nGrid1          = 0;
      nGrid2          = 0;
      nGrid3          = 0;
      nHandleEjec     = 0;
      nCaracter       = 0;

      aSwError        = "";
      aLongitud       = "";
      aCaracter       = "";
      aMarca          = "";
      aParte1         = "";
      aParte2         = "";
      eaJusti         = "";
      aAlfa           = "";
      aAlfa1          = "";
      aAlfa2          = "";
      aAlfa3          = "";
      aAbre           = "";
      aParam          = "";
      aTipo           = "";
      aIdioma         = "";
      aFichero        = "";
      aFicheroP       = "";
      aTecla          = "";
      aRetu           = "";
      aEsc1           = "";
      aEsc2           = "";
      aOrigen         = "";
      aDestino        = "";
      aIPRemoto       = "";
      aImpre          = "";
      DReimp          = "";
      HReimp          = "";
      Comodin         = "";
      aNombre         = "";
      aDirOrigen      = "";
      aDirectorio     = "";
      aPathRenta      = "";
      aPathLocal      = "";
      aVersionBasico  = "";
      aVersionJava    = "";
      aEjecutaJava    = "";
      aUnidadSistema  = "";
      aProgFiles      = "";
      aPathPdf        = "";
      aDocRemoto      = "";
      aDocServidor    = "";
      aPathExplorador = "";
      aForzExplorador = "";
      aPathServidor   = "";
      aForzAcrobat    = "";
      areemision      = "";
      aDirDest        = "";

    {5}aPopup       = "";
    {1}version      = "";
    {1}aContiene    = "";

   {-1}aVent        = "";
       aVent1       = 0;
       aVent2       = 0;
       aVent3       = 0;
       aVent4       = 0;
       aVent5       = "";

      &eaModelo       = "";
      &enEmpresa      = 0;
      &eaTipo         = "";
      &eaNif          = "";
      &efFechaPatrim  = @;
      &eaFOrigen      = "";
      &eaFDestino     = "";
      &eaPathLanza    = "";
      &eaDirJava      = "";
      &eaUnidadBasico = "";
      &eaPathAcrobat  = "";
      &eaModoImpre    = "";
      &eaTipoP        = "";
      &eaTipoR        = "";
      &eaTipoV        = "";
      &eaTipoE        = "";
      &eaTipoC        = "";
      &eaTipoA        = "";
      &eaTipoL        = "";
      &eaTipoF        = "";
      &enBasico       = 0;
      &enError        = 0;
      &enHandle       = 0;
      &enSwFalle      = 0;

      &eaFichero      = "";
      &eaFicheroTxt   = "";
      &eaFicheroSin   = "";
      &eaFicheroPtl   = "";
      &eaDirServidor  = "";
      &eaDirLanza     = "";
      &eaOrigen       = "";
      &eaDestino      = "";
      &eaRojo         = "";
      &eaVerde        = "";
      &enSwErrores    = 0;
|FIN;

|PROCESO TraeWait;
     aPathLocal  = eaPathLanza;

     |DBASE aPathPdf;  |QBT aPathPdf;
     aPathPdf = aPathPdf + "hacienda";                    |MKDIR aPathPdf;
     aOrigen  = aPathPdf   + "/wait.exe";
     aDestino = aPathLocal + "wait.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TraeBasico;
     |HAZ LeeUnidadBasico;

     aPathLocal = eaUnidadBasico + "\AEAT";            |RMKDIR aPathLocal;
     aPathLocal = eaUnidadBasico + "\AEAT\" + eaModelo; |RMKDIR aPathLocal;
     aPathLocal = eaUnidadBasico + "\AEAT\" + eaModelo + "\2014";   |RMKDIR aPathLocal;
     aPathLocal = eaUnidadBasico + "\AEAT\" + eaModelo + "\2014\";

     |DBASE aPathServidor;   |QBF aPathServidor;
     aPathServidor = aPathServidor + "hacienda/";

     aOrigen    = aPathServidor + "modren14.tgz";
     aDestino   = aPathLocal + "modren14.tgz";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     nCopia    = 0;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
         nCopia = 1;
     |FINSI;

     enBasico = 0;
     |XABRE "EC", aDestino, nHandleEjec;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI nCopia = 1;
         |RDESCOMPRIME aDestino;

         aDestino = (aDestino - ".tgz") + ".tar";
         |RDETAR aDestino, aPathLocal;

         |RFBORRA aDestino;
     |FINSI;

     enBasico = 1;
|FPRC;

|PROCESO CopiaSecuencial;
     aOrigen  = eaPathLanza + eaFicheroTxt;

     |SI eaModelo = 100;
        aDestino = #reemi100#40; |QBF aDestino;
     |SINO;
        aDestino = #reemipat#40; |QBF aDestino;
     |FINSI;
     aAlfa1 = aDestino % -101;
     |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
        aDestino = aDestino + "\";
     |FINSI;
     aDestino = aDestino + eaFicheroTxt;
     |RCOPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO LineaShellJava;
     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "CBW", aAbre, enHandle;

     aAlfa = "CD \" + &13 + &10;                |XGRABA enHandle, aAlfa;
     aAlfa = "CD AEAT" + &13 + &10;             |XGRABA enHandle, aAlfa;
     aAlfa = "CD " + eaModelo + &13 + &10;      |XGRABA enHandle, aAlfa;
     aAlfa = "CD 2014" + &13 + &10;             |XGRABA enHandle, aAlfa;
     aAlfa = "CD " + Usuario + &13 + &10;       |XGRABA enHandle, aAlfa;

     aAlfa = "DEL " + eaPathLanza + eaTipoR + &13 + &10;
     |XGRABA enHandle, aAlfa;

     aAlfa = aAlfa + &13 + &10;
     |XGRABA enHandle, aAlfa;

     aAlfa = "CD \" + &13 + &10;                |XGRABA enHandle, aAlfa;
     aAlfa = "CD AEAT" + &13 + &10;             |XGRABA enHandle, aAlfa;
     aAlfa = "CD 100" + &13 + &10;              |XGRABA enHandle, aAlfa;
     aAlfa = "CD 2014" + &13 + &10;             |XGRABA enHandle, aAlfa;

     aAlfa = &13 + &10;
     |XGRABA enHandle, aAlfa;

     |HAZ TraeWait;

     aAlfa = eaPathLanza + "wait ";
     aAlfa = aAlfa + "java -Xmx256m -classpath .\r14pdf.jar es.aeat.pare.re14.AEAT100j ";
     aAlfa = aAlfa + "/E:" + eaPathLanza + eaTipoE + " ";
     aAlfa = aAlfa + "/R:" + eaPathLanza + eaTipoR + " ";
     aAlfa = aAlfa + "/P:" + eaPathLanza + eaTipoP + " ";
     aAlfa = aAlfa + "/L:" + #reemi100#35;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA enHandle, aAlfa;

     |XCIERRA enHandle;

     |HAZ TraeBasico;

     |SI enBasico = 0;  |ACABA;  |FINSI;

     aAlfa = eaPathLanza + "imprime.bat";
     |RSYSTEM aAlfa;
     |PULSATECLA;

     enSwErrores = 0;
     aAlfa      = eaPathLanza + eaTipoR;
     aDestino   = "";
     |XABRE "ECB", aAlfa, nHandleErr;
     |SI FSalida ] 0;   || Hay errores
         enSwErrores = 1;
     |SINO;
        |HAZ CopiaSecuencial;
     |FINSI;

     |DDEFECTO #rew02001;
     #rew02001#0 = #rew00001#0;
     #rew02001#1 = #rew00001#3;
     #rew02001#2 = #rew00001#2;
     #rew02001#3 = "Validado";
     #rew02001#4 = aDestino;
     #rew02001#5 = eaPathLanza + eaFicheroPtl;
     #rew02001#6 = eaVerde;

     |SI enSwErrores = 1;
         #rew02001#4 = eaPathLanza + eaTipoR;
         #rew02001#3 = "Errores";
         #rew02001#6 = eaRojo;

         eaOrigen  = #rew02001#4; |QBF eaOrigen;
         |DBASE eaDestino; |QBF eaDestino;
         eaDestino = eaDestino + "tmp/" + Usuario + "/"; |MKDIR eaDestino;
         eaDestino = eaDestino + eaTipoR;
         |HAZ RecibeFichero;
     |FINSI;
     |GRABA 020#rew02001.n;
     |LIBERA #rew02001;
|FPRC;

|PROCESO ValidaJava;
     eaOrigen  = eaDirServidor + eaFicheroTxt;
     eaDestino = eaDirLanza + eaFicheroTxt;
     |HAZ CopiaFichero;

     |HAZ LineaShellJava;
|FPRC;
