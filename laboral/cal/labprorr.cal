|FICHEROS;
    labprorr #0;
    labempre #1;
    labtraba #2;
    labcentr #3;
    labregis #4;
    labclaus #5;
    nomregim #6;
    labmunic #8;
    labcontr #10;
    labpanta #11;
    labproco #12;
    labacuer #87;
    labacue1 #227;
    labacue2 #229,MANTE;
    labdicoc #89;
    labdicol #90;
    labhisto #500;
    nomcenes #13;   || centros especiales
    nomcalca;       || manteniemiento de calculos: acutualiza fecha de baja
    nomvarca;       || variaciones mes: acutualiza fecha de baja

    pdfdocca;
    pdfdocli;
    pdfimtmp #100;
    labclafi;

    labpadre #1000;
    labcotmp #1001;
    labenvcc #1002;
    labenvcl #1003;
     labadmma;
     nomcenes;
     labclau1@;
|FIN;

|VARIABLES;
     nAcuerdo = 0;
     &nTipoImpre  = 0;
     &nNroCopias  = 0;
     &nTipoSalida = 0;
     aTmp = "";
     nclaus = 0;
     aParaI = "";
     ParaI = 0;
     &nContador = 0;
     &nVoypor = 0;
     nNCA = 0;
     aEmp = "";
     aTra = "";
     aCon = "";
     registro = "";
     aProcedencia = "";
     nCuantos = 0;
     nLimiteClau = 0;
     &swAnexoClaus = 0;
     &topeclaus = 0;
     nNume = 0;
     nNume1 = 0;
     nNume2 = 0;
     aNume = "";
     nLimReal = 0;
     nCampo = 0;
     aPaisEmpresa = "";
     &nPaisEmpresa = 0;
     aPaisCentro = "";
     &nPaisCentro = 0;
     aPaisTrabaja = "";
     aPED1 = "";
     aPED2 = "";
     aPED3 = "";
     aPCD1 = "";
     aPCD2 = "";
     aPCD3 = "";
     aPTD1 = "";
     aPTD2 = "";
     aPTD3 = "";
     aProvincia = "";
     &aCodCCC = "";
     aCPRD1 = "";
     aCPRD2 = "";
     aDigControl = "";
     aDC1 = "";
     aDC2 = "";

     aCodPostal1 = "";
     aCodPostal2 = "";
     aAlfa2 = "";
     aMuni  = "";
     nContMuni = 0;
     &nMensajeF5 = 0;
     &aCodigoMunicipio = "";
     aCodMuni = "";
     &aCodPos = "";
     aCPED1 = "";
     aCPED2= "";
     aCPED3= "";
     aCPED4= "";
     aCPED5= "";
     aCodMuniE = "";
     aCodMuniT = "";
     aCodMuniC = "";
     aRegimen = "";

    &nLabHisto = 0;
    &enNumRegis = 0;
    &eaNumProrr = "";
    &enWeb = 0;
    nOpcion = 0;
    nCalc   = 0;
    nCont   = 0;
    nCont1  = 0;

    aCodigoC1 = "";
    aCodigoC2 = "";
    aCodigoC3 = "";

    teclado = 0;
    mod = 0;
    diasfin = 0;
    verrfec = "0000ATENCION Fecha erronea";
    vdia1 = "";
    vme1 = "";
    vany1 = "";
    vdia = 0;
    vme = 0;
    vany = 0;
    vtope = 0;
    vsw = 0;
    vfec = "";
    vblanco = "          ";
    vpuntos = "..........";
    mensa1 = "    No existe empresa";
    mensa2 = "    No existe trabajador";
    mensa3 = "    No existe centro trabajo";
    mensa4 = "    AVISO !!! No existe contrato inicial !!!";
    mensa6 = "    AVISO !!! Periodo acumulado superior a 48 meses o datos erroneos ...";
    mensa7 = "    ATENCION !! Prorroga no efectiva sobre contrato tipo 57";
    mensa8 = "    No existe clausula";
    mensaA = "    ATENCION! Dato erroneo, centro de trabajo distinto al del trabajador ...";
    &contador = 0;
    nume1 = 0;
    nume2 = 0;
    fecinic = @;
    fecreal = @;
    fecnume = 0;
    fecalfa = "";
    fectope = "";
    diaalfa = "";
    mesalfa = "";
    anyalfa = "";
    dianume = 0;
    mesnume = 0;
    anynume = 0;
    topemes = 0;
    diashas = 0;
    diastop = 0;
    diaprimer = 0;
    mesprimer = 0;
    duracio = 0;
    nada = "";
    z = 0;
    &coma = ",";
    &dia = "";             || fecha presentacion desglosada
    &mes = "";
    &anyo = "";
    dia1 = "";            || variables trabajo fecha
    any1 = "";
    fec1 = "";
    fec2 = 0;
    &prorro = " ";
    &duracion = " ";
    &contra = " ";
    and = " y ";
    c = "";
    &dura = "";
    direcc = "";
    numero = "";
    piso = "";
    cod1 = "";
    cod2 = "";
    locali = "";
    &domemp = "";
    &domtra = "";
    &domcen = "";
    linepunt = "";
    punt = ".";
    barra = "  /";
    compactado = "";
    check = 0;
    menos = 0;
    mensaB = "    No existen parametros de control !!! Usando defectos ...";
    mensaC = "    A IMPRIMIR PLAN DE FORMACION (HOJA 1) ...";
    mensaD = "    A IMPRIMIR PLAN DE FORMACION (HOJA 2) ...";
    mensaE = "    A IMPRIMIR PLAN DE FORMACION (HOJA 3) ...";
    mensaF = "    No existe Plan de Formacion !!!";
    aponer = "";
    fiac = "";
    relleno = "                                                 ";
    sistema = @;
    hojaplan = 0;
    &edadalum = 0;
    diasini = 0;
    diasven = 0;
    diasdur = 0;
    razon = 0;
    nacitra = 0;
    actutra = 0;
    edadtra = 0;
    anyotra = 0;
    fechtra = "";
    aAlfa   = "";
    &x1 = "";
    &x2 = "";
    &x3 = "";
    &x4 = "";
    alfa1 = "";
    &sconvenio = "";
    FEstado = 0;
    &infor_pro = "";
    inkey = 0;
    &des87 = @;
    &has87 = @;
    &tipo87 = "";
    &ctacot="";
    &nPaisTrabaja = 0;

    nNumero = 0;
    nLin    = 0;
    nHandle = 0;

{-1}histo = "";
    histo1 = "2312";
    histo2 = "1";
    histo3 = "";
    /*
    histo4 = "VIGE";
    histo5 = " Vista Previa ";
    histo6 = " Imprimir     ";
    histo7 = " Guardar      ";
    histo8 = " Enviar Online ";
    */

    histo4 = "EGOS";
    histo5 = "   Emitir   ";
    histo6 = "  Guardar   ";
    histo7 = "Enviar Online";
    histo8 = "    Salir   ";  || no imprimo, no veo, no guardo

     aRSSD1 = "";
     aRSSD2 = "";
     aRSSD3 = "";
     aRSSD4 = "";

     aNom   = "";
     aApel1 = "";
     aApel2 = "";
     nInd   = 1;  aLong = "";  nLong = 0;
     SwSalir = 0;

     nAscii = 0;
     aCaracter = "";
     aCaracterSal = "";
     aCadenaSal = "";
     &aCadena = "";
     nValor = 0;
     swCarga = 0;
     &swCopia = 0;
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     nBusca = 0;
     aAlfa1 = "";
     aValor = "";
     aCampo = "";
     nTipo = 0;
     &aArchivo = "";
     aID = "";
     &aListaFich = "";
     &aListaFichNor = "";
     &aListaFichCop = "";
     &aListaImpares = "";
     nLon = 0;
     aLon = "";
     nLon2 = 0;
     aLon2 = "";
     swError = 0;
     fech1 = @;
     fech2 = @;
     alfa2 = "";

     &enEmpresa = 0;
     &enTrabajador = 0;
     &eaFechaIni = "";
     &eaFechaFin = "";
     &enMeses = 0;
     &enDias = 0;
     &nLabornet = 0;
     &nRegistro = 0;
     &nNroProrr = 0;

     &swNetContrata = 0;
     &enExtRegis = 0;
     &eaExtProrr = "";
     &eaExtDef = "";
     &enExtEmp = 0;
     &enExtTra = 0;

     aMensa = "";
     &enEmp = 0;
     &enTra = 0;
     &eaNif = "";
     &enRegistro = 0;
     &eaIdContrato = "";
     &swStopProrr = 0;
     &eaFechaAlta = "";
     &eaVengoDe = "contrato";
     swExisteAnexo = 0;
     swOpcionesForm = 0;

     fFechaAlta = @;
     fFechaAltaOri = @;
     aNif = "";
     nOtroTra = 0;
     swVariosAdm = 0;
     &enSwSoloArchivo = 0;

     &eaIdioma = "";
     swOtroIdioma = 0;
     aOrigen = "";
     nCanalIdi = 0;
     swExiste = 0;

     &eaQueEs            = "";
|FIN;

|INCLUYE pastil_i;

|PROCESO CompNroINEM;      || compruebo que sea numerico

|| a partir de lo del NetContrat@ parece ser que el nro. de identificador
|| del Contrat@ tiene una E delante de las 13 cifras, con lo que puede no
|| ser numerico

/*
     swError = 0;
     aAlfa = #0Campo;
     |QBF aAlfa;
     aLon = aAlfa % 0;
     nLon = aLon;
     nNume = #0Campo;
     |SI nNume = 0; |Y aLon ! 0;
          swError = 1;
     |FINSI;

     aAlfa = nNume;
     aAlfa2 = #0Campo;
     |PARA; |SI; |HACIENDO;
          alfa1 = aAlfa2 % 101;
          |SI alfa1 = "0";
               aAlfa = "0" + aAlfa;
               aAlfa2 = aAlfa2 - "0";
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     aLon2 = aAlfa % 0;
     nLon2 = aLon2;
     |SI nLon ! nLon2; |Y nNume ! 0;
          swError = 1;
     |FINSI;

     |SI swError = 1;
          |MENAV "    ATENCION: Nro. de Contrato NO valido. Ha de ser un valor numerico";
          |ERROR;
     |FINSI;
*/
|FPRC;

|PROCESO varios1;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #0#0;
     #3#1 = #0#2;
     |LEE 000#3=;
     |SI FSalida ! 0;
         |MENAV "    Centro de Trabajo inexistente ...";
     |FINSI;
     |CIERRA #3;
     aCodCCC = #3#10;
     |SI #0#14 = "087"; |O #0#14 = "064"; |O #0#14 = "085"; |O #0#14 = "065";
     |O #0#14 = "421";
         |ABRE #13;
         |DDEFECTO #13;
             #13#0 = #2#0;         || empresa
             #13#13 = #2#77;       || centro
         |SI #0#14 = "085"; #13#1 = "87"; |FINSI;
         |SI #0#14 = "064"; #13#1 = "64"; |FINSI;
         |SI #0#14 = "065"; #13#1 = "64"; |FINSI;
         |SI #0#14 = "421"; #13#1 = "87"; |FINSI;
         |LEE 000#13=;
         |SI FSalida ! 0;
                 alfa1 = "    Centro Especial de Contratacion [" + #13#1 + "] inexistente ...";
             |MENAV alfa1;
         |FINSI;
         |CIERRA #13;
         aCodCCC = #13#10;
     |FINSI;
|FPRC;


|PROCESO tipo8; |TIPO 8;
                    || si 'infor_pro' viene cargada prevalece
                    ||/sobre el PARAMETRO
                    || en D.O.S. y con SUB_EJECUTA (agiett) el PARAMETRO
                    ||/no funciona
|SI infor_pro = "";
        alfa1 = PARAMETRO;
    |QBF alfa1;
    |SI alfa1 = ""; |O alfa1 = "CONTRAT@";
            infor_pro = "labprorr";
    |SINO;
            infor_pro = alfa1;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO CuentaMunicipio;
     nContMuni = nContMuni + 1;
     aCodMuni = #labmunic#1;
|FPRC;

|DEFBUCLE CuentaMunicipio;
     #8#1;
     ;
     aCodPos, "00000";
     aCodPos, "99999";
     ;
     NULL,CuentaMunicipio;
|FIN;

|PROCESO BuscaMunicipio;
     aAlfa2 = #8#3;            || aAlfa2 = municipio de labmunic
     |QBT aAlfa2;
     aMuni = #labempre#6;   || aMuniEmp = municipio de labempre
     aMuni = aMuni > "";
     |QBT aMuni;

     aAlfa = aMuni - aAlfa2;
     |SI aAlfa ! aMuni;
          ||aAlfa2 esta en aMuni
          aCodMuni = #8#1;
          nContMuni = nContMuni + 1;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaMunicipio;
     #8#1;
     ;
     aCodPos, "00000";
     aCodPos, "99999";
     ;
     NULL,BuscaMunicipio;
|FIN;

|PROCESO CodigoMuni;
     nContMuni = 0;
     |BUCLE CuentaMunicipio;

     |SI nContMuni > 1;
          nContMuni = 0;
          |BUCLE BuscaMunicipio;
          |SI nContMuni > 1;
               nMensajeF5 = 1;
               aCodigoMunicipio = "";
               |SUB_EJECUTA "labmunic";
               |SI aCodigoMunicipio ! "";
                    aCodMuni = aCodigoMunicipio;
                    nContMuni = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nContMuni = 0;
          nMensajeF5 = 1;
          aCodigoMunicipio = "";
          |SUB_EJECUTA "labmunic";
          |SI aCodigoMunicipio ! "";
               aCodMuni = aCodigoMunicipio;
               nContMuni = 1;
          |FINSI;
     |FINSI;
     ||ahora se supone que en aCodMuni tenemos el codigo del municipio
|FPRC;

|PROCESO CodigosMunicipio;
     aCodPos = aCPED1 + aCPED2 + aCPED3 + aCPED4 + aCPED5;
     |HAZ CodigoMuni;
     |SI nContMuni = 0;
          |MENAV "0000Codigo de municipio de la empresa inaccesible.";
          aCodMuniE = "00000";
     |SINO;
          aCodMuniE = aCodMuni;
     |FINSI;

     aAlfa1 = #labtraba#8;    aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa = #labtraba#9;     aAlfa = ("000" + aAlfa) % -103;
     aCodPos = aAlfa1 + aAlfa;
     |HAZ CodigoMuni;
     |SI nContMuni = 0;
          |MENAV "0000Codigo de municipio del trabajador inaccesible.";
          aCodMuniT = "00000";
     |SINO;
          aCodMuniT = aCodMuni;
     |FINSI;

     aAlfa1 = #labcentr#7;    aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa = #labcentr#8;     aAlfa = ("000" + aAlfa) % -103;
     aCodPos = aAlfa1 + aAlfa;
     |HAZ CodigoMuni;
     |SI nContMuni = 0;
          |MENAV "0000Codigo de municipio del centro inaccesible.";
          aCodMuniC = "00000";
     |SINO;
          aCodMuniC = aCodMuni;
     |FINSI;
|FPRC;

|PROCESO leeempre;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #1;                    || DE LA RELACION CON EL FICHERO DE
        #1#0 = #0#0;          || EMPRESAS
|LEE 040#1=;
|SI FSalida = 0;
    |PINTA 0725,#1#2;
|SINO;
    |MENAV mensa1;
        #0#0 = 0;
    |ERROR;
|FINSI;
|CIERRAT #1;
|FPRC;

|PROCESO leetraba;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #2;                    || EN LA RELACION CON EL FICHERO DE
    #2#0 = #0#0;              || TRABAJADORES
    #2#1 = #0#1;
|LEE 000#2=;
|SI FSalida = 0;
    |PINTA 0825,#2#2;
    |HAZ carga_comentario;
|SINO;
    |MENAV mensa2;
        #0#1 = 0;
    |ERROR;
|FINSI;
|CIERRAT #2;
|FPRC;

|PROCESO dispo; |TIPO 6;
    inkey = FSalida;
|SI inkey = 18;
    |DDEFECTO #2;
    |ABRE #2;
        #2#0 = #0#0;
        #2#1 = #0#1;
    |LEE 000#2=;
    |SI FSalida = 0;
        aAlfa = #labtraba#7; aAlfa = aAlfa % 0101;
        |SI aAlfa = "X"; |O aAlfa = "Y"; |O aAlfa = "Z";
           aAlfa = #labtraba#76; aAlfa = aAlfa % 0103;
           nPaisTrabaja = aAlfa;
        |SINO;
           nPaisTrabaja = 724;
        |FINSI;
    |FINSI;
    |CIERRA #2;
    |HAZ disposicion;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO carga_comentario;
|ABRE #12;
    #12#0 = #2#87;
|LEE 000#12=;
|SI FSalida = 0;
        #0#32 = #12#1;
        #0#33 = #12#2;
        #0#34 = #12#3;
        #0#35 = #12#4;
        #0#36 = #12#5;
        #0#37 = #12#6;
        #0#38 = #12#7;
        #0#39 = #12#8;
        #0#40 = #12#9;
|FINSI;
|CIERRA #12;
|FPRC;

|PROCESO leecentr;|TIPO 0;     || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #3;                     || EN LA RELACION CON EL FICHERO DE
    #3#0 = #0#0;               || CENTROS DE TRABAJO
    #3#1 = #0#2;
|LEE 040#3=;
|SI FSalida = 0;
    |PINTA 0928,#3#2;
|SINO;
    |MENAV mensa3;
        #0#2 = 0;
    |ERROR;
|FINSI;
|CIERRAT #3;
|SI #0#2 ! #2#77;
    |MENAV mensaA;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO leecontr; |TIPO 7;
|ABRE #10;
|LEE 040#10p;
|SI FSalida ! 0;
    |MENAV mensaB;
|SINO;
    #0#20 = #10#26; |PINTA #0#20;  || nro de copias
    #0#21 = #10#27; |PINTA #0#21;  || localidad firma
|FINSI;
|CIERRA #10;

|SI nLabHisto = 1;
   aAlfa = "|NC";
   nCalc = #0#aAlfa#;
   |ABRE #labhisto;
   #labhisto#100 = enNumRegis;
   #labhisto#103 = eaNumProrr;
   |LEE 000#labhisto.=;
   |PARA nCont = 0; |SI nCont < nCalc; |HACIENDO nCont = nCont + 1;
      |SI nCont [ 99;
         #0#nCont# = #labhisto#nCont#;
      |SINO;
         nCont1 = nCont + 20;
         #0#nCont# = #labhisto#nCont1#;
      |FINSI;
   |SIGUE;
   #labhisto#102 = "S"; |GRABA 020#labhisto.a;
   |LIBERA #labhisto;
   |CIERRA #labhisto;
   |PINDA #0#0; |HAZ leeempre; |HAZ leetraba; |HAZ leecentr;
   aCodigoC3 = #0#0; |QBF aCodigoC3;
   aCodigoC1 = aCodigoC3 % 0101;
   aCodigoC2 = aCodigoC3 % 0201;
   aCodigoC3 = aCodigoC3 % 0301;
   |HAZ actual99; |PTEC 807;
|FINSI;
|FPRC;

|PROCESO lee_regimen;
|DDEFECTO #6;
|ABRE #6;
    #6#0 = #2#247;
|LEE 000#6=;
|SI FSalida ! 0;
        alfa1 = "    Regimen de Cotizacion [" + #6#0 + "] inexistente ...";
    |MENAV alfa1;
|FINSI;
|CIERRA #6;
aAlfa = #6#0;
|FPRC;

|PROCESO leeregis; |TIPO 0;
|ABRET #4;
|SELECT #2#4;
    #4#1 = #0#0;
    #4#2 = #0#1;
|LEE 040#4=;
|SI FSalida = 0;
            contador = #4#0;
            #0#3 = #4#12;        || oficina empleo
            #0#4 = #4#15 + 1;    || nro de prorroga
            #0#9 = #4#7;         || fecha inicio 1er contrato
            #0#10 = #4#9;        || meses duracion
            #0#11 = #4#10;       || dias duracion
            #0#12 = #4#5;        || definicion decreto
            #0#13 = #4#6;        || real decreto
            #0#14 = #4#4;        || codigo contrato
            #0#15 = #4#12;       || oficina de empleo
            #0#16 = #4#11;       || presentacion 1er contrato
            #0#17 = #4#14;       || nro de inem
            #0#18 = #4#18;       || acumulado meses
            #0#21 = #4#13;       || localidad 1er contrato
            #0#22 = #4#22;       || acumulado dias
        |PINDA #0#0;
            diaprimer = #4#22;   || valor inicial acumulador
            mesprimer = #4#18;
|SINO;
    |MENAV mensa4;   || no existe contrato inicial
    |PTEC 807;
|FINSI;
|CIERRAT #4;
|FPRC;

|PROCESO fechas; |TIPO 0;
     teclado = FSalida;
     |DDEFECTO #4;
     |ABRET #4;
     |SELECT #2#4;
     #4#1 = #0#0;
     #4#2 = #0#1;
     |LEE 040#4=;
     |SI #4#15 = 0;                   || seleccion fecha inicio contrato/prorroga
          fecinic = #4#7;
          fecreal = #4#8;
     |SINO;
          fecinic = #4#19;
          fecreal = #4#20;
     |FINSI;
     |SI fecreal ! vpuntos;|Y fecreal ! vblanco;
          fecreal = fecreal + 1;  || fecha inicio es la siguiente a la de fin
          #0#7 = fecreal;
          |PINTA #0#7;
     |FINSI;

     #0#8 = vpuntos;
     check = #0#5 + #0#6;         || chequea valores por si son nulos
     |SI check ! 0; |Y fecreal ! vpuntos; |Y fecreal ! vblanco;
          nume1 = #0#5 / 1000;            || meses a sumar en formato suma
          nume2 = (#0#6 - 1) + nume1;     || fecha a sumar en formato suma
          fecreal = #0#7;
          fecreal = fecreal + nume2;
          #0#8 = fecreal;
          |PINTA #0#8;
          nume2 = (-1) + (4 / 1000000);  || suma 4 a¤os para saber el tope
          fecreal = #4#7;
          fecreal = fecreal + nume2;
          nume1 = fecreal;   || dias hasta (tope)
          fecreal = #0#8;
          nume2 = fecreal;   || dias hasta
          |SI nume2 > nume1;|Y teclado ! 2;  || evita el segundo mensaje
               ||MENAV mensa6;      || chequea los 4 a¤os (INHIBIDO!!!!!)
          |FINSI;
     |FINSI;
     |HAZ litedura;
     |PINDA #0#0;
     |CIERRAT #4;
|FPRC;

|PROCESO lit_segun; |TIPO 0;
|SI #0#41 = "S";
        sconvenio = "seg£n convenio";
|SINO;
        sconvenio = "..............";
|FINSI;
|FPRC;

|PROCESO litedura;
     mesprimer = #0#10;
     diaprimer = #0#11;

     |SI nLabHisto ! 1;            || si vengo del historico esto ya esta
          #0#18 = #4#18;           || calculado, no tengo por que volverlo a
          #0#22 = #4#22;           || cargar, no salia bien

          #0#18 = #0#18 + #0#5;
          #0#22 = #0#22 + #0#6;
     |FINSI;

     |SI #0#22 ] 30;
          || excepcion, probar primer contrato 11.07.2011 4 meses y 10 dias y
          || despues prorroga 7 meses y 20 dias tiquet 000055.02534

          |SI #0#6 [ 14;
               nNume1 = 1;
               nNume2 = 30 - #0#6;
          |SINO;
               nNume1 = (#0#6 / 30) ! 0;
               nNume2 = #0#6 $ 30;
          |FINSI;
          #0#18 = #0#18 + nNume1;
          #0#22 = #0#22 - (nNume1 * 30);
     |FINSI;
     duracion = "";
     |SI #0#5 ! 0;
          duracion = #0#5;
          duracion = duracion + " mes";
          |SI #0#5 > 1;
               |SI #labtraba#136 = "CAT";
                    duracion = duracion + "os";
               |SINO;
                    duracion = duracion + "es";
               |FINSI;
          |FINSI;
     |SINO;
          duracion = "";
     |FINSI;
     |SI #0#6 ! 0;
          |SI #0#5 ! 0;
               duracion = duracion + and;
          |FINSI;
          duracion = duracion + #0#6;
          |SI #labtraba#136 = "CAT";
               |SI #0#6 > 1;
                    duracion = duracion + " dies";
               |SINO;
                    duracion = duracion + " dia";
               |FINSI;
          |SINO;
               |SI #0#6 > 1;
                    duracion = duracion + " dias";
               |SINO;
                    duracion = duracion + " dia";
               |FINSI;
          |FINSI;
     |SINO;
          duracion = duracion + "";
     |FINSI;
|FPRC;

|PROCESO CentroEspecial;
     |DDEFECTO #13;
     |ABRE #13;
     #13#0  = #2#0;   || empresa
     #13#13 = #2#77;  || centro
     |SI #2#45 = "097";|O #2#45 = "085"; |O #2#45 = "421";
          #13#1 = "87";
     |SINO;
          |SI #2#45 = "065";
               #13#1  = "64";
          |SINO;
               #13#1  = #2#45 % 2;
          |FINSI;
     |FINSI;
     |LEE 000#13=;
     |SI FSalida ! 0;
          |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
           |O #0#14 = "421";|O #2#45 = "064";|O #2#45 = "065";
               |MENAV "    AVISO! Centro Especial de trabajo INEXISTENTE ...";
          |FINSI;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Centro;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #2#0;
     #3#1 = #2#77;
     |LEE 000#3=;
     |SI FSalida ! 0;|Y #2#45 ! "064";|Y #2#45 ! "065";
      |O #0#14 = "421"; |Y #2#45 ! "087";|Y #2#45 ! "097";|Y #2#45 ! "085";
          |MENAV "    AVISO! Centro de trabajo INEXISTENTE ...";
     |FINSI;
     |CIERRA #3;
|FPRC;


|PROCESO CuentaCotizacion;
     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
      |O #0#14 = "421";|O #2#45 = "064";|O #2#45 = "065";
          ctacot = #13#10;
     |SINO;
          ctacot = #3#10;
     |FINSI;
|FPRC;

|PROCESO fechabaja2;
     fech1 = #nomvarca#16;
     fech2 = #4#20;
     |SI fech1 ! fech2;
          #nomvarca#16 = #4#20;
          alfa1 = #nomvarca#2;
          alfa2 = "    ATENCION: Se ha actualizado la fecha de baja de las variaciones ";
          alfa2 = alfa2 + "del mes " + alfa1 + " para este trabajador.";
          |MENAV alfa2;
          |GRABA 020#nomvarca.a;
          |LIBERA #nomvarca;
     |FINSI;
|FPRC;

|DEFBUCLE nomvarca;
     #nomvarca#1;
     ;
     #2#0, #2#1,  1, 0;
     #2#0, #2#1, 12, 9;
     e;
     NULL, fechabaja2;
|FIN;

|PROCESO fechabaja;
     #nomcalca#5 = #4#20;
     |GRABA 020#nomcalca.a;
     |LIBERA #nomcalca;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #2#0, #2#1,  1, 0;
     #2#0, #2#1, 12, 9;
     e;
     NULL, fechabaja;
|FIN;

|PROCESO sustituye2;
     nAscii = & aCaracter;
     aCaracterSal = aCaracter;
     |SI nAscii = 160;             || el caracter  
          aCaracterSal = "\341";
     |FINSI;
     |SI nAscii = 130;             || el caracter ‚
          aCaracterSal = "\351";
     |FINSI;
     |SI nAscii = 161;             || el caracter ¡
          aCaracterSal = "\355";
     |FINSI;
     |SI nAscii = 162; |O nAscii = 243;            || el caracter ¢
          aCaracterSal = "\363";
     |FINSI;
     |SI nAscii = 163;             || el caracter £
          aCaracterSal = "\372";
     |FINSI;
     |SI nAscii = 164;             || el caracter ¤
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 241;             || el caracter ¤ (otro codigo ¨?)
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 165;             || el caracter ¥
          aCaracterSal = "\321";
     |FINSI;
     |SI nAscii = 129;
          aCaracterSal = "\374";   || el caracter u con dieresis
     |FINSI;
     |SI nAscii = 154;
          aCaracterSal = "\334";   || el caracter U (mayuscula) con dieresis
     |FINSI;
     |SI nAscii = 167;
          aCaracterSal = "\272";   || el caracter §
     |FINSI;
     |SI nAscii = 166;
          aCaracterSal = "\252";   || el caracter ¦
     |FINSI;
     |SI aCaracter = "(";
          aCaracterSal = "\(";
     |FINSI;
     |SI aCaracter = ")";
          aCaracterSal = "\)";
     |FINSI;
|FPRC;

|PROCESO sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca = (nPos * 100) + 1;
          aCaracter = aCadena % nBusca;
          |HAZ sustituye2;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;


|PROCESO GrabaTemporal;
     aAlfa1 = aValor % 101;
     |SI aAlfa1 = ".";
          aValor = "";
     |FINSI;
     |QBF aValor;
     aCadena = aValor;
     |HAZ sustituye;
     aValor = aCadenaSal;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;
     |GRABA 020#pdfimtmp.n;
     |LIBERA #pdfimtmp;
|FPRC;

|PROCESO labtraba;
     || con este bucle lo que pretendo es quedarme con el trabajador que
     || tenga la fecha de alta mayor con este DNI, siempre mayor que la del
     || trabajador inicial

     aAlfa = #labtraba#36;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          fFechaAlta = aAlfa;

          |SI fFechaAlta > fFechaAltaOri;
               nOtroTra = #labtraba#1;
               fFechaAltaOri = fFechaAlta;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#7;
     ;
     aNif, #0#0, 00001;
     aNif, #0#0, 99999;
     ;
     NULL, labtraba;
|FIN;

|PROCESO BuscaTrabajador;
    || esto es para comprobar que si el trabajador al que se le hizo el contrato
    || original ha cambiado de ficha, la fecha de baja se le actualice al que
    || este en activo

     nOtroTra = 0;
     |BUCLE labtraba;
     |SI nOtroTra ! 0;
          #labtraba#0 = #0#0;
          #labtraba#1 = nOtroTra;
     |SINO;
          #labtraba#0 = #0#0;
          #labtraba#1 = #0#1;
     |FINSI;
     |LEE 101#labtraba.=;
|FPRC;

|PROCESO Guarda;
     |SI nLabHisto ! 1;
          |ABRE #labhisto;
          #labhisto#100 = contador;
          #labhisto#103 = #0#4;
          |LEE 101#labhisto.=;
          |SI FSalida = 0;
               |BORRA 020#labhisto.a; |LIBERA #labhisto;
          |FINSI;
          |CIERRA #labhisto;

          |ABRE #4;
          |SELECT #1#4;
          #4#0 = contador;
          |LEE 101#4=;
          #4#15 = #0#4;          || nro. prorroga
          #4#16 = #0#5;          || duracion prorroga meses
          #4#17 = #0#6;          || duracion prorroga dias
          #4#18 = #0#18;         || acumulado meses
          #4#22 = #0#22;         || acumulado dias
          #4#19 = #0#7;          || fecha inicio prorroga
          #4#20 = #0#8;          || fecha fin prorroga
          #4#21 = ~;             || fecha alta registro
          #4#11 = #0#16;         || fecha presentacion contrato
          #4#14 = #0#17;         || nro. inem
          |HAZ recarga;
          |GRABA 020#4a;
          |LIBERA #4;
          |SI nOpcion = 2;
               aAlfa = contador; |QBF aAlfa; aAlfa = ("000000" + aAlfa) % -106;
               aAlfa = "    Se ha guardado la prórroga en el registro " + aAlfa;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;

     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#0;
          #2#1 = #0#1;
          |LEE 101#2=;
          |SI FSalida = 0;
               aNif = #labtraba#7;
               aAlfa = #labtraba#36;
               fFechaAltaOri = aAlfa;
               |HAZ BuscaTrabajador;
               |SI #4#20 ! "          "; |Y #4#20 ! "..........";
                     |SI #10#3 = 1;
                          #2#37 = #4#20;      || actualiza fecha de baja
                          |GRABA 020#2a;

                          |ABRE #nomcalca;
                          |BUCLE nomcalca;  || actualiza fecha baja nomcalca
                          |LIBERA #nomcalca;
                          |CIERRA #nomcalca;

                          |BUCLE nomvarca;  || actualiza fecha baja nomvarca
                     |FINSI;
                     |SI #10#56 = "1";
                          #2#177 = #4#20;     || fecha vencimiento
                          |GRABA 020#2a;
                     |FINSI;
               |FINSI;
          |FINSI;
          |LIBERA #2;
          |CIERRA #2;
     |FINSI;

     |ABRE #labhisto;
     #labhisto#100 = contador;
     #labhisto#103 = #0#4;           || N§ de prorroga
     |LEE 000#labhisto.=;
     |SI FSalida ! 0;
          |DDEFECTO #labhisto;
          #labhisto#100 = contador;
          |SI #0#4 = 0;
               #labhisto#103 = "";
          |SINO;
               #labhisto#103 = #0#4;           || N§ de prorroga
          |FINSI;
          |MODULO aAlfa;
          #labhisto#101 = aAlfa;
          |SI nOpcion = 2;
               #labhisto#102 = "N";
          |SINO;
               #labhisto#102 = "S";
          |FINSI;
          aAlfa = "|NC";
          nCalc = #0#aAlfa#; nCalc = nCalc - 1;
          |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
             |SI nCont [ 99;
                 #labhisto#nCont# = #0#nCont#;
             |SINO;
                 nCont1 = nCont + 20;
                 #labhisto#nCont1# = #0#nCont#;
             |FINSI;
          |SIGUE;
          nRegistro = #labhisto#100;
          nNroProrr = #labhisto#103;
          |GRABA 020#labhisto.n;
          |LIBERA #labhisto;
     |FINSI;
     |CIERRA #labhisto;
|FPRC;

|PROCESO CargaCampos;
     nTipo = 5;
     aCampo = "clausadici";
     aAlfa = aCampo;
     nLimiteClau = 5;
     |PARA nNume = 1; |SI nNume [ nTipo; |HACIENDO nNume = nNume + 1;
          nCampo = nNume + 24;
          aValor = #0#nCampo#;
          |QBF aValor;
          |SI aValor = "";
               nNume = nNume - 1;
               |SI nNume > nLimiteClau;
                    swAnexoClaus = 1;
               |FINSI;
               |SAL;
          |FINSI;
          |SI nCampo = 29;
               |SI aValor ! ""
                    swAnexoClaus = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI swAnexoClaus = 0;
          nLimReal = nNume;
          |PARA nNume = 1; |SI nNume [ nTipo; |HACIENDO nNume = nNume + 1;
               aNume = nNume;  aNume = "00" + aNume; aNume = aNume % -102;
               aCampo = aAlfa + aNume;
               nCampo = nNume + 24;
               aValor = #0#nCampo#;
               |QBF aValor;
               |HAZ GrabaTemporal;
          |SIGUE;
     |SINO;                    ||PONEMOS EL MENSAJE DE VER EN HOJA ADJUNTA Y TODAS LAS CLAUSULAS EN BLANCO->""
          nLimReal = nNume;
          |PARA nNume = 1; |SI nNume [ nTipo; |HACIENDO nNume = nNume + 1;
               aNume = nNume;  aNume = "00" + aNume; aNume = aNume % -102;
               aCampo = aAlfa + aNume;
               nCampo = nNume + 24;
               |SI nNume = 1;
                    aValor = "                                 .- Ver en hoja adjunta.";
               |SINO;
                    aValor = "";
                    |QBF aValor;
               |FINSI;
               |HAZ GrabaTemporal;
          |SIGUE;
     |FINSI;


     nTipo = 0;
     |HAZ varios1;
     || PROVINCIA CTA. COTIZACION.

     aProvincia = aCodCCC;
     |QBF aProvincia;
     aProvincia = aProvincia % 102;
     aProvincia = "00" + aProvincia;
     aProvincia = aProvincia % -102;
     aCPRD1 = aProvincia % 101;
     aCPRD2 = aProvincia % 201;

     || DIGITO CONTROL CTA.COTIZACION

     aDigControl = aCodCCC;
     |QBF aDigControl;
     aDigControl = aDigControl % 1002;
     aDigControl = "00" + aDigControl;
     aDigControl = aDigControl % -102;
     aDC1 = aDigControl % 101;
     aDC2 = aDigControl % 201;

     aCampo = "Identificador";
     aAlfa = #0#17;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "comentarios1";
     aAlfa = #0#32;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "comentarios2";
     aAlfa = #0#33;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios3";
     aAlfa = #0#34;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios4";
     aAlfa = #0#35;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios5";
     aAlfa = #0#36;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios6";
     aAlfa = #0#37;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios7";
     aAlfa = #0#38;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios8";
     aAlfa = #0#39;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "comentarios9";
     aAlfa = #0#40;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aAlfa;
          |HAZ GrabaTemporal;
     |FINSI;


     aCampo = "provniss1";
     aValor = aCPRD1;
     |HAZ GrabaTemporal;

     aCampo = "provniss2";
     aValor = aCPRD2;
     |HAZ GrabaTemporal;

     aCampo = "digcon1";
     aValor = aDC1;
     |HAZ GrabaTemporal;

     aCampo = "digcon2";
     aValor = aDC2;
     |HAZ GrabaTemporal;

     aCampo = "numniss";
     aValor = aCodCCC % 307;
     |HAZ GrabaTemporal;

     || Codigo de Pais de Empresa, Centro y Trabajador

     aPaisEmpresa = nPaisEmpresa;
     || aPaisEmpresa = "000" + aPaisEmpresa;
     aPaisEmpresa = "724";
     aPaisEmpresa = aPaisEmpresa % -103;

     aPaisCentro = nPaisCentro;
     || aPaisCentro = "000" + aPaisCentro;
     aPaisCentro = "724";
     aPaisCentro = aPaisCentro % -103;

     aAlfa = #labtraba#7; aAlfa = aAlfa % 0101;
     |SI aAlfa = "X"; |O aAlfa = "Y"; |O aAlfa = "Z";
           aAlfa = #labtraba#76; aAlfa = aAlfa % 0103;
           nPaisTrabaja = aAlfa;
     |SINO;
           nPaisTrabaja = 724;
     |FINSI;

     aPaisTrabaja = nPaisTrabaja;
     || aPaisTrabaja = "000" + aPaisTrabaja;
     aPaisTrabaja = "724" + aPaisTrabaja;
     aPaisTrabaja = aPaisTrabaja % -103;

     aPED1 = aPaisEmpresa % 101;   || pais empresa digito 1
     aPED2 = aPaisEmpresa % 201;   || pais empresa digito 2
     aPED3 = aPaisEmpresa % 301;   || pais empresa digito 3
     aPCD1 = aPaisCentro % 101;    || pais centro digito 1
     aPCD2 = aPaisCentro % 201;    || pais centro digito 2
     aPCD3 = aPaisCentro % 301;    || pais centro digito 3
     aPTD1 = aPaisTrabaja % 101;    || pais trabajador digito 1
     aPTD2 = aPaisTrabaja % 201;    || pais trabajador digito 2
     aPTD3 = aPaisTrabaja % 301;    || pais trabajador digito 3

     aCampo = "codpaisem1";
     aValor = aPED1;
     |HAZ GrabaTemporal;

     aCampo = "codpaisem2";
     aValor = aPED2;
     |HAZ GrabaTemporal;

     aCampo = "codpaisem3";
     aValor = aPED3;
     |HAZ GrabaTemporal;

     aCampo = "codpaisct1";
     aValor = aPCD1;
     |HAZ GrabaTemporal;

     aCampo = "codpaisct2";
     aValor = aPCD2;
     |HAZ GrabaTemporal;

     aCampo = "codpaisct3";
     aValor = aPCD3;
     |HAZ GrabaTemporal;

     aCampo = "codnactra1";
     aValor = aPTD1;
     |HAZ GrabaTemporal;

     aCampo = "codnactra2";
     aValor = aPTD2;
     |HAZ GrabaTemporal;

     aCampo = "codnactra3";
     aValor = aPTD3;
     |HAZ GrabaTemporal;

     aCampo = "codpaisdomtr1";
     aValor = "7";
     |HAZ GrabaTemporal;

     aCampo = "codpaisdomtra2";
     aValor = "2";
     |HAZ GrabaTemporal;

     aCampo = "codpaisdomtr3";
     aValor = "4";
     |HAZ GrabaTemporal;

     |SI nLabHisto = 1;
          |HAZ litedura;
     |FINSI;
     aCampo = "mesesdurapro";
     aValor = duracion;
     |HAZ GrabaTemporal;

     aCampo = "munifirma";
     aValor = #0#21;
     |HAZ GrabaTemporal;

     aCampo = "registro";
     aAlfa1 = #0#0;
     aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa = aAlfa1 + " / ";
     aAlfa1 = #0#1;
     aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa = aAlfa + aAlfa1 + " / ";
     aAlfa1 = contador;
     aAlfa1 = ("000000" + aAlfa1) % -106;
     aAlfa = aAlfa + aAlfa1;
     aValor = aAlfa;
     |HAZ GrabaTemporal;

     aCampo = "modelocont";
     aValor = #0#12;
     |HAZ GrabaTemporal;

     aCampo = "rdcont";
     aValor = #0#13;
     |HAZ GrabaTemporal;

     aCampo = "nombsepe";
     aValor = #0#3;
     |HAZ GrabaTemporal;

     aCampo = "fechainipro";
     aValor = #0#7;
     |HAZ GrabaTemporal;

     aCampo = "fechaterpro";
     aValor = #0#8;
     |HAZ GrabaTemporal;

     aCampo = "fechainicont";
     aValor = #0#9;
     |HAZ GrabaTemporal;

     aCampo = "oecomcont";
     aValor = #0#15;
     |HAZ GrabaTemporal;

     aCampo = "fecharegcont";
     aValor = #0#16;
     |HAZ GrabaTemporal;

     aCampo = "idcontconv";
     aValor = #0#17;
     |HAZ GrabaTemporal;

    |SI nLabHisto ! 1;
       |ABRE #labhisto;
       #labhisto#100 = contador;
       #labhisto#103 = #0#4;
       |LEE 101#labhisto.=;
       |SI FSalida = 0;
          |BORRA 020#labhisto.a; |LIBERA #labhisto;
       |FINSI;
       |CIERRA #labhisto;

       |ABRE #4;
       |SELECT #1#4;
           #4#0 = contador;
       |LEE 101#4=;
           #4#15 = #0#4;          || nro. prorroga
           #4#16 = #0#5;          || duracion prorroga meses
           #4#17 = #0#6;          || duracion prorroga dias
           #4#18 = #0#18;         || acumulado meses
           #4#22 = #0#22;         || acumulado dias
           #4#19 = #0#7;          || fecha inicio prorroga
           #4#20 = #0#8;          || fecha fin prorroga
           #4#21 = ~;             || fecha alta registro
           #4#11 = #0#16;         || fecha presentacion contrato
           #4#14 = #0#17;         || nro. inem
       |HAZ recarga;
       |GRABA 020#4a;
          |LIBERA #4;
    |FINSI;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#0;
          #2#1 = #0#1;
          |LEE 101#2=;
          |SI FSalida = 0;
               aNif = #labtraba#7;
               aAlfa = #labtraba#36;
               fFechaAltaOri = aAlfa;
               |HAZ BuscaTrabajador;

               |ABRE #nomcalca;
               |SI #4#20 ! "          "; |Y #4#20 ! ".........."; |Y nLabHisto ! 1;
                    |SI #10#3 = 1;
                         #2#37 = #4#20;    || actualiza fecha de baja
                         |BUCLE nomcalca;  || actualiza fecha baja nomcalca
                         |BUCLE nomvarca;  || actualiza fecha baja nomvarca
                         |GRABA 020#2a;
                    |FINSI;
                    |SI #10#56 = "1";
                         #2#177 = #4#20;     || fecha vencimiento
                         |GRABA 020#2a;
                    |FINSI;
                    |LIBERA #2;
               |FINSI;


            aCampo = "nomtrab";
            aValor = #2#2;
            |HAZ GrabaTemporal;

            aCampo = "codnivaca1";
            aValor = #2#73; |QBF aValor; aValor = "00" + aValor;
            aValor = aValor % -201;
            |HAZ GrabaTemporal;

            aCampo = "codnivaca2";
            aValor = #2#73; |QBF aValor; aValor = "00" + aValor;
            aValor = aValor % -101;
            |HAZ GrabaTemporal;

            aCampo = "nombdtosempresa";
            aValor = #2#20;
            |HAZ GrabaTemporal;

            aCampo = "nifempresa";
            aValor = #2#22;
            |HAZ GrabaTemporal;

            aCampo = "repre empresa";
            aValor = #2#23;
            |HAZ GrabaTemporal;

            aCampo = "trabajador";
            aValor = #2#2;
            |HAZ GrabaTemporal;

            aCampo = "repre_legal";
            aValor = #2#20;
            |HAZ GrabaTemporal;

            aCampo = "dnitra";
            aValor = #2#7;
            |HAZ GrabaTemporal;

            aCampo = "fechanac";
            aValor = #2#11;
            |HAZ GrabaTemporal;

            aCampo = "numafinss";
            aValor = #2#75;
            |HAZ GrabaTemporal;

            aCampo = "litnivaca";
            aValor = #2#12;
            |HAZ GrabaTemporal;


        |FINSI;
        |LIBERA #2;
        |CIERRA #2;
        |LIBERA #nomcalca;
        |CIERRA #nomcalca;
    |FINSI;
    |LIBERA #4;
    |CIERRA #4;

    |HAZ Centro;        || conocer la cuenta cotizacion, esto es el cambio
    |HAZ CentroEspecial;
    |HAZ CuentaCotizacion;

    |HAZ domicili;
    |HAZ decodifi;
    |HAZ diasmese;
    |HAZ lee_regimen;

     aRegimen = aAlfa;
     aRegimen = "00" + aRegimen;
     aRegimen = aRegimen % -104;

     aCampo = "regimen1";
     aAlfa = aRegimen % 101;
     aValor = aAlfa;
     |HAZ GrabaTemporal;

     aCampo = "regimen2";
     aAlfa = aRegimen % 201;
     aValor = aAlfa;
     |HAZ GrabaTemporal;

     aCampo = "regimen3";
     aAlfa = aRegimen % 301;
     aValor = aAlfa;
     |HAZ GrabaTemporal;

     aCampo = "regimen4";
     aAlfa = aRegimen % 401;
     aValor = aAlfa;
     |HAZ GrabaTemporal;

        p_imp = #0#7;
    |HAZ pastilla;
    |SI p_cen = 0;
        |PARA z = 1; |SI z [ #0#20; |HACIENDO z = z + 1;
            ||INFOR infor_pro;
            |SI FSalida = 0;
                ||PRINT;
                ||PIEINF;
                ||FININF;
            |SINO;
                    alfa1 = "    Informe [" + infor_pro + "] inaccesible ...";
                |MENAV alfa1;
            |FINSI;
        |SIGUE;
        |HAZ el_acuerdo;
    |FINSI;
        alfa1 = #3#12;
    |QBF alfa1;
    |SI alfa1 ! "NO EXISTE"; |Y alfa1 ! "";
        |PINPA #2#11;
        |AVISO;
        |PAUSA;
    |FINSI;
    |SI nOpcion ] 1; |O nOpcion [ 3; |Y nLabHisto ! 1;
      |ABRE #labhisto;
      #labhisto#100 = contador;
      #labhisto#103 = #0#4;           || N§ de prorroga
      |LEE 000#labhisto.=;
      |SI FSalida ! 0;
         |DDEFECTO #labhisto;
         #labhisto#100 = contador;
         |SI #0#4 = 0;
            #labhisto#103 = "";
         |SINO;
            #labhisto#103 = #0#4;           || N§ de prorroga
         |FINSI;
         |MODULO aAlfa;
         #labhisto#101 = aAlfa;
         |SI nOpcion = 2;
            #labhisto#102 = "N";
         |SINO;
            #labhisto#102 = "S";
         |FINSI;
         aAlfa = "|NC";
         nCalc = #0#aAlfa#; nCalc = nCalc - 1;
         |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
            |SI nCont [ 99;
               #labhisto#nCont# = #0#nCont#;
            |SINO;
                nCont1 = nCont + 20;
                #labhisto#nCont1# = #0#nCont#;
            |FINSI;
         |SIGUE;
         |GRABA 020#labhisto.n;
          nRegistro = #labhisto#100;
          nNroProrr = #labhisto#103;
          |LIBERA #labhisto;
      |FINSI;
      |CIERRA #labhisto;
   |FINSI;
|HAZ CodigosMunicipio;
aCampo = "codmuniem1";
aValor = aCodMuniE % 101;
|HAZ GrabaTemporal;

aCampo = "codmuniem2";
aValor = aCodMuniE % 201;
|HAZ GrabaTemporal;

aCampo = "codmuniem3";
aValor = aCodMuniE % 301;
|HAZ GrabaTemporal;


aCampo = "codmuniem4";
aValor = aCodMuniE % 401;
|HAZ GrabaTemporal;

aCampo = "codmuniem5";
aValor = aCodMuniE % 501;
|HAZ GrabaTemporal;

aCampo = "codmunitra1";
aValor = aCodMuniT % 101;
|HAZ GrabaTemporal;

aCampo = "codmunitra2";
aValor = aCodMuniT % 201;
|HAZ GrabaTemporal;

aCampo = "codmunitra3";
aValor = aCodMuniT % 301;
|HAZ GrabaTemporal;

aCampo = "codmunitra4";
aValor = aCodMuniT % 401;
|HAZ GrabaTemporal;

aCampo = "codmunitra5";
aValor = aCodMuniT % 501;
|HAZ GrabaTemporal;

aCampo = "codmunict1";
aValor = aCodMuniC % 101;
|HAZ GrabaTemporal;

aCampo = "codmunict2";
aValor = aCodMuniC % 201;
|HAZ GrabaTemporal;

aCampo = "codmunict3";
aValor = aCodMuniC % 301;
|HAZ GrabaTemporal;

aCampo = "codmunict4";
aValor = aCodMuniC % 401;
|HAZ GrabaTemporal;

aCampo = "codmunict5";
aValor = aCodMuniC % 501;
|HAZ GrabaTemporal;

     |HAZ LiteralesFirma;

|FPRC;

|PROCESO LiteralesFirma;
          aCampo = "firma1";
          aValor = "El/la trabajador/a";
          |SI swOtroIdioma = 1;
               |SI eaIdioma = "cat";
                     aValor = "El/la treballador/a";
               |FINSI;
               |SI eaIdioma = "gal";
                     aValor = "O/a traballador/a";
               |FINSI;
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "firma2";
          aValor = "El/la representante de la empresa";
          |SI swOtroIdioma = 1;
               |SI eaIdioma = "cat";
                    aValor = "El/la representant de l'empresa";
               |FINSI;
               |SI eaIdioma = "gal";
                    aValor = "O/a representante da empresa";
               |FINSI;
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "firma3";
          aValor = "El/la representante legal del/de la  menor, si procede";
          |SI swOtroIdioma = 1;
               |SI eaIdioma = "cat";
                    aValor = "El/la representant legal del/de la menor, si escau";
               |FINSI;
               |SI eaIdioma = "gal";
                    aValor = "O/a representante legal do/a menor, se procede";
               |FINSI;
          |FINSI;
          |HAZ GrabaTemporal;
|FPRC;

|PROCESO AnexoClaus;
     |SI #0#31 ! 0;
          |ABRE #5;
          #5#1 = #0#31;
          |LEE 000#5=;
          |SI FSalida = 0;
               nTipo = 0;
               |PARA ParaI = 1; |SI ParaI [ 18; |HACIENDO ParaI = ParaI + 1;
                    aParaI = ParaI;
                    aParaI = "00" + aParaI;
                    aAlfa = aParaI % -102;
                    aCampo = "clausula" + aAlfa;
                    aAlfa = aCampo % 108;
                    |SI aAlfa = "clausula";
                         aAlfa = aCampo % -102;
                         nNume = aAlfa;
                         |SI nNume [ 18; |Y nVoypor = 1;    || pa que coja las 1as. 18
                              |SI nNume [ 5;
                                   nCampo = nNume + 24;
                                   aValor = #0#nCampo#;   || clausulas del def
                              |SINO;
                                   nCampo = nNume + 2;
                                   aValor = #5#nCampo#;   || clausulas del def
                              |FINSI;
                              |SI aValor = "";
                                   aValor = "......";
                              |FINSI;
                              |HAZ GrabaTemporal;           || por si algo cambia
                         |SINO;
                              #labclafi#0 = nNume + (40 * (nVoypor - 1));
                              |LEE 000#labclafi.=;
                              |SI FSalida = 0;
                                   aValor = #labclafi#1;
                                   |HAZ GrabaTemporal;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SIGUE;
          |FINSI;
          |CIERRA #5;
     |FINSI;


     aCampo = "localidad";  || Localidad firma
          aValor = #0#21;
          |HAZ GrabaTemporal;
      aCampo = "dia";  || DIA FIRMA
          aValor = dia;
          |HAZ GrabaTemporal;
      aCampo = "mes";  || MES FIRMA
          aValor = mes ;
          |HAZ GrabaTemporal;
      aCampo = "anyo";  || ANYO FIRMA
          aValor = anyo ;
          |HAZ GrabaTemporal;
      aCampo = "pagina";  || PAGINA
          aAlfa1 = nVoypor;
          aAlfa2 = nNCA;
          aValor = "P\341gina " + aAlfa1 + " de " + aAlfa2;
          |HAZ GrabaTemporal;
      aCampo = "registro";
          aEmp = #0#0; aEmp = "00000" + aEmp; aEmp = aEmp % -105;
          aTra = #0#1; aTra = "00000" + aTra; aTra = aTra % -105;
          aCon = contador; aCon = "000000" + aCon; aCon = aCon % -105;
          aValor = aEmp + " / " + aTra + " / " + aCon;
          |HAZ GrabaTemporal;
      swCopia = 1;
           aCampo = "trabajador";  || NOMBRE DEL TRABAJADOR TRABAJADOR
               aValor = #labtraba#2;
               |HAZ GrabaTemporal;
           aCampo = "repre_legal";  || NOMBRE REPRESENTANTE LEGAL DEL MENOR SI PROCEDE
               aValor = #labtraba#20;
               |HAZ GrabaTemporal;

          ||AML
           aCampo = "repre_emp";  || NOMBRE REPRESENTANTE EMPRESA
               aValor = #labempre#15;
               |HAZ GrabaTemporal;
          ||FIN AML

          aCampo = "copiabasica";
               aValor = "";
               |HAZ GrabaTemporal;

           |HAZ LiteralesFirma;
|FPRC;

|PROCESO anexoformacion227;
     nTipo = 0;

     |DDEFECTO #labacue1;
     #labacue1#14 = #0#3;   || oficina empleo contrato
     #labacue1#15 = #0#21;  || localidad contrato

     |ABRE #labacue1;
     #labacue1#0 = #0#0;
     #labacue1#1 = #0#1;
     |LEE 101#labacue1.=;
     |SI FSalida = 0;
          aCampo = "nombrerepempresa";
          aValor = #labacue1#45;
          |HAZ GrabaTemporal;

          aCampo = "nifrepempresa";
          aValor = #labacue1#46;
          |HAZ GrabaTemporal;
           ;
          aCampo = "cargorepempresa";
          aValor = #labacue1#47;
          |HAZ GrabaTemporal;

          aCampo = "razonsocialempresa";
          aValor = #labempre#2;
          |HAZ GrabaTemporal;

          aCampo = "nombre trab";
          aValor = #labtraba#2;
          |HAZ GrabaTemporal;

          aCampo = "DNI trab";
          aValor = #labtraba#7;
          |HAZ GrabaTemporal;

          aCampo = "celebran";
          |SI #labacue1#48 = "X";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "hancelebrado";
          |SI #labacue1#49 = "X";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "idcontrato";
          |SI #labacue1#49 = "X";
               aAlfa1 = "";
               aAlfa = #labacue1#28; |QBF aAlfa; aAlfa1 = aAlfa + "-";
               aAlfa = #labacue1#29; |QBF aAlfa; aAlfa1 = aAlfa1 + aAlfa + "-";
               aAlfa = #labacue1#31; |QBF aAlfa; aAlfa1 = aAlfa1 + aAlfa + "-";
               aAlfa = #labacue1#32; |QBF aAlfa; aAlfa1 = aAlfa1 + aAlfa;
               aAlfa = #labacue1#33; |QBF aAlfa;
               |SI aAlfa ! "";
                    aAlfa1 = aAlfa1 + "-" + aAlfa;
               |FINSI;
               aValor = aAlfa1;
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "fechacontrato";
          |SI #labacue1#49 = "X";
               aValor = #labacue1#50;
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "nombrerepcentro";
          aValor = #labacue1#6;
          |HAZ GrabaTemporal;

          aCampo = "nifrepcentro";
          aValor = #labacue1#8;
          |HAZ GrabaTemporal;

          aCampo = "cargorepcentro";
          aValor = #labacue1#51;
          |HAZ GrabaTemporal;

          aCampo = "nombre centro";
          aValor = #labacue1#2;
          |HAZ GrabaTemporal;

          aCampo = "CIF centro";
          aValor = #labacue1#3;
          |HAZ GrabaTemporal;

          aCampo = "Direccion centro";
          aValor = #labacue1#4;
          |HAZ GrabaTemporal;

          aCampo = "CP centro";
          aAlfa1 = #labacue1#19; |QBF aAlfa1;
          aAlfa2 = #labacue1#20; |QBF aAlfa2;
          aValor = aAlfa1 + aAlfa2; |QBF aValor;
          aCodPos = aValor;
          |HAZ GrabaTemporal;

          aCampo = "localidad centro";
          aValor = #labacue1#21;
          |HAZ GrabaTemporal;

     || mando aCodPos
          aCampo = "codmuni centro";
          |HAZ CodigoMuni;
          |SI nContMuni = 0;
               |MENAV "0000Codigo de municipio del trabajador inaccesible.";
               aValor = "00000";
          |SINO;
               aValor = aCodMuni;
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "certprof";
          |SI #labacue1#52 = "X";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "titfp";
          |SI #labacue1#53 = "X";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "eso";
          |SI #labacue1#54 = "X";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "denom certprof"; |Y #labacue1#52 = "X";
          aValor = #labacue1#55;
          |HAZ GrabaTemporal;

          aCampo = "codigo certprof"; |Y #labacue1#52 = "X";
          aValor = #labacue1#56;
          |HAZ GrabaTemporal;

          aCampo = "RD certprof"; |Y #labacue1#52 = "X";
          aValor = #labacue1#57;
          |HAZ GrabaTemporal;

          aCampo = "horas certprof"; |Y #labacue1#52 = "X";
          aValor = #labacue1#58;
          |HAZ GrabaTemporal;

          aCampo = "denom titfp"; |Y #labacue1#53 = "X";
          aValor = #labacue1#59;
          |HAZ GrabaTemporal;

          aCampo = "RD titfp"; |Y #labacue1#53 = "X";
          aValor = #labacue1#60;
          |HAZ GrabaTemporal;

          aCampo = "horas titfp"; |Y #labacue1#53 = "X";
          aValor = #labacue1#61;
          |HAZ GrabaTemporal;

          aCampo = "presencial";
          |SI #labacue1#18 = "P";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "a distancia";
          |SI #labacue1#18 = "D";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "mixta";
          |SI #labacue1#18 = "M";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "calendario1";
          aValor = #labacue1#11;
          |HAZ GrabaTemporal;

          aCampo = "calendario2";
          aValor = #labacue1#12;
          |HAZ GrabaTemporal;

          aCampo = "localidad";
          aValor = #labacue1#62;
          |HAZ GrabaTemporal;

          aCampo = "dia";
          aValor = #labacue1#63;
          |QBF aValor;
          |SI aValor = 0; aValor = ""; |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "mes";
          aValor = #labacue1#64;
          |HAZ GrabaTemporal;

          aCampo = "a\361o";
          aValor = #labacue1#65;
          |QBF aValor;
          |SI aValor = 0; aValor = ""; |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "registro acuerdo";
          aEmp = #0#0; aEmp = "00000" + aEmp; aEmp = aEmp % -105;
          aTra = #0#1; aTra = "00000" + aTra; aTra = aTra % -105;
          aCon = contador; aCon = "000000" + aCon; aCon = aCon % -105;
          aValor = aEmp + " / " + aTra + " / " + aCon;
          |HAZ GrabaTemporal;
     |FINSI;
     |CIERRA #labacue1;
|FPRC;

|PROCESO AnexoFormacion2;
     aCampo = "representante";
     aValor = #labempre#15;
     |HAZ GrabaTemporal;

     aCampo = "dni representante";
     aValor = #labempre#17;
     |HAZ GrabaTemporal;

     aCampo = "CIFUSUARIO";
     aValor = #labcontr#69;
     |HAZ GrabaTemporal;

     aCampo = "NOMBREUSUARIO";
     aValor = #labcontr#68;
     |HAZ GrabaTemporal;

     aCampo = "IDCONTRATO";
     aValor = #labacuer#29 + "-" + #labacuer#30 + "-" + #labacuer#31 + "-";
     aValor = aValor + #labacuer#34 + "-" + #labacuer#33;
     |HAZ GrabaTemporal;

     aCampo = "provincia";
     aValor = #labacuer#15;
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO AnexoFormacion1;
     || campos especiales acuerdo formacion edutedis CON GRADUADO ESCOLAR

     aCampo = "Prov";
     aValor = #labacuer#29;
     |HAZ GrabaTemporal;

     aCampo = "Codigo OE";
     aValor = #labacuer#30;
     |HAZ GrabaTemporal;

     aCampo = "Anyo Reg Contrato";
     aValor = #labacuer#31;
     |HAZ GrabaTemporal;

     aCampo = "Num Reg Contrato";
     aValor = #labacuer#34;
     |HAZ GrabaTemporal;

     aCampo = "Prorr";
     aValor = #labacuer#33;
     |HAZ GrabaTemporal;

     aCampo = "codigo ocupacion";
     aValor = #labacuer#27;
     |HAZ GrabaTemporal;

     aCampo = "ENTIDADRow1";
     aValor = #labacuer#38;
     |QBF aValor;
     aValor = ("0000" + aValor) % -104;
     |HAZ GrabaTemporal;

     aCampo = "OFICINARow1";
     aValor = #labacuer#39;
     |QBF aValor;
     aValor = ("0000" + aValor) % -104;
     |HAZ GrabaTemporal;

     aCampo = "DCRow1_2";
     aValor = #labacuer#40;
     |QBF aValor;
     aValor = ("00" + aValor) % -102;
     |HAZ GrabaTemporal;

     aCampo = "N CUENTARow1";
     aValor = #labacuer#41;
     |QBF aValor;
     aValor = ("0000000000" + aValor) % -110;
     |HAZ GrabaTemporal;

     aCampo = "Desde Fecha";
     aValor = #labprorr#7;
     |HAZ GrabaTemporal;

     aCampo = "Hasta Fecha";
     aValor = #labprorr#8;
     |HAZ GrabaTemporal;

     aCampo = "Fdo";
     aValor = #labacuer#42;
     |HAZ GrabaTemporal;

     |SI aArchivo = "anexoformacion2.pdf";
          |HAZ AnexoFormacion2;
     |FINSI;
|FPRC;

|PROCESO AnexoFormacion0;
     || el de toda la vida;
          || Identificador del contrato

          aCampo = "identif contrato1";
          aValor = #labacuer#28;
          aValor = aValor % 101;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato2";
          aValor = #labacuer#29;
          aValor = aValor % 101;
          |HAZ GrabaTemporal;

          aCampo = "identifcontrato3";
          aValor = #labacuer#29;
          aValor = aValor % 201;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato4";
          aValor = #labacuer#31;
          aValor = aValor % 101;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato5";
          aValor = #labacuer#31;
          aValor = aValor % 201;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato6";
          aValor = #labacuer#31;
          aValor = aValor % 301;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato7";
          aValor = #labacuer#31;
          aValor = aValor % 401;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato8";
          aValor = #labacuer#34;
          aValor = aValor % 101;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato9";
          aValor = #labacuer#34;
          aValor = aValor % 201;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato10";
          aValor = #labacuer#34;
          aValor = aValor % 301;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato11";
          aValor = #labacuer#34;
          aValor = aValor % 401;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato12";
          aValor = #labacuer#34;
          aValor = aValor % 501;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato13";
          aValor = #labacuer#34;
          aValor = aValor % 601;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato14";
          aValor = #labacuer#34;
          aValor = aValor % 701;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato15";
          aValor = #labacuer#33;
          aValor = aValor % 101;
          |HAZ GrabaTemporal;

          aCampo = "identif contrato16";
          aValor = #labacuer#33;
          aValor = aValor % 201;
          |HAZ GrabaTemporal;


          || codigo ocupacion y fechas desde y hasta de duracion de la formacion
          || y casilla de formacion presencial o a distancia

          aCampo = "codig oaupac1";
          aValor = #labacuer#27 % 101;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac2";
          aValor = #labacuer#27 % 201;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac3";
          aValor = #labacuer#27 % 301;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac4";
          aValor = #labacuer#27 % 401;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac5";
          aValor = #labacuer#27 % 501;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac6";
          aValor = #labacuer#27 % 601;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac7";
          aValor = #labacuer#27 % 701;
          |HAZ GrabaTemporal;

          aCampo = "codig oaupac8";
          aValor = #labacuer#27 % 801;
          |HAZ GrabaTemporal;

          aCampo = "fechacomienzo";
          aAlfa = #labprorr#7;
          aValor = aAlfa % 102;
          |HAZ GrabaTemporal;

          aCampo = "fechacomienzo1";
          aAlfa = #labprorr#7;
          aValor = aAlfa % 402;
          |HAZ GrabaTemporal;

          aCampo = "fechacomienzo2";
          aAlfa = #labprorr#7;
          aValor = aAlfa % -104;
          |HAZ GrabaTemporal;

          aCampo = "fechafin";
          aAlfa = #labprorr#8;
          aValor = aAlfa % 102;
          |HAZ GrabaTemporal;

          aCampo = "fechafin1";
          aAlfa = #labprorr#8;
          aValor = aAlfa % 402;
          |HAZ GrabaTemporal;

          aCampo = "fechafin2";
          aAlfa = #labprorr#8;
          aValor = aAlfa % -104;
          |HAZ GrabaTemporal;

          aCampo = "presencial";
          |SI #labacuer#18 = "P";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;

          aCampo = "a distancia";
          |SI #labacuer#18 = "D";
               aValor = "Si";
          |FINSI;
          |HAZ GrabaTemporal;


          || datos del centro

          aCampo = "nombre centro";
          aValor = #labacuer#2;
          |HAZ GrabaTemporal;

          aCampo = "identif centro1";
          aValor = #labacuer#23 % 101;
          |HAZ GrabaTemporal;

          aCampo = "identif centro2";
          aValor = #labacuer#23 % 201;
          |HAZ GrabaTemporal;

          aCampo = "identif centro3";
          aValor = #labacuer#23 % 301;
          |HAZ GrabaTemporal;

          aCampo = "identif centro4";
          aValor = #labacuer#23 % 401;
          |HAZ GrabaTemporal;

          aCampo = "identif centro5";
          aValor = #labacuer#23 % 501;
          |HAZ GrabaTemporal;

          aCampo = "identif centro6";
          aValor = #labacuer#23 % 601;
          |HAZ GrabaTemporal;

          aCampo = "identif centro7";
          aValor = #labacuer#23 % 701;
          |HAZ GrabaTemporal;

          aCampo = "razon social centro";
          aValor = #labacuer#22;
          |HAZ GrabaTemporal;

          aCampo = "CIF centro";
          aValor = #labacuer#3;
          |HAZ GrabaTemporal;

          aCampo = "Direccion centro";
          aValor = #labacuer#4;
          |HAZ GrabaTemporal;

          aCampo = "localidad centro";
          aValor = #labacuer#21;
          |HAZ GrabaTemporal;

          aCampo = "CP centro";
          aAlfa1 = #labacuer#19; aAlfa1 = "00000"+ aAlfa1; aAlfa1 = aAlfa1 % -102;
          aAlfa2 = #labacuer#20; aAlfa2 = "00000"+ aAlfa2; aAlfa2 = aAlfa2 % -103;

          aAlfa = aAlfa1 + aAlfa2;
          aValor = aAlfa;
          |HAZ GrabaTemporal;

          aCampo = "provincia centro";
          aValor = #labacuer#24;
          |HAZ GrabaTemporal;

          aCampo = "persona contacto centro";
          aValor = #labacuer#6;
          |HAZ GrabaTemporal;

          aCampo = "telefono centro";
          aValor = #labacuer#5;
          |HAZ GrabaTemporal;

          aCampo = "fax centro";
          aValor = #labacuer#25;
          |HAZ GrabaTemporal;

          aCampo = "e-mail centro";
          aValor = #labacuer#26;
          |HAZ GrabaTemporal;
|FPRC;

|PROCESO DatosPago;
     aCampo = "CIFUSUARIO";
     aValor = #labcontr#69;
     |HAZ GrabaTemporal;

     aCampo = "NOMBREUSUARIO";
     aValor = #labcontr#68;
     |HAZ GrabaTemporal;

     aCampo = "direccion empresa";
     aValor = #labempre#3;
     |QBF aValor;
     aAlfa = #labempre#4;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aValor + ", " + aAlfa;
     |FINSI;
     aAlfa = #labempre#5;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aValor + " - " + aAlfa;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "localidad empresa";
     aValor = #labempre#6;
     |HAZ GrabaTemporal;

     aCampo = "provincia empresa";
     aValor = #labempre#9;
     |HAZ GrabaTemporal;

     aCampo = "ENTIDADRow1";
     aValor = #labacue2#38;
     |QBF aValor;
     aValor = ("0000" + aValor) % -104;
     |HAZ GrabaTemporal;

     aCampo = "OFICINARow1";
     aValor = #labacue2#39;
     |QBF aValor;
     aValor = ("0000" + aValor) % -104;
     |HAZ GrabaTemporal;

     aCampo = "DCRow1_2";
     aValor = #labacue2#40;
     |QBF aValor;
     aValor = ("00" + aValor) % -102;
     |HAZ GrabaTemporal;

     aCampo = "N CUENTARow1";
     aValor = #labacue2#41;
     |QBF aValor;
     aValor = ("0000000000" + aValor) % -110;
     |HAZ GrabaTemporal;

     aCampo = "Fdo";
     aValor = #labacue2#42;
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO pe230;     || nuevo anexo de formacion mar/2012  ANEXO I
     aCampo = "nrocentro1";
     aValor = #labacue2#23;
     |HAZ GrabaTemporal;

     aCampo = "certsi";
     |SI #labacue2#52 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "certno";
     |SI #labacue2#52 = " ";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "titfpsi";
     |SI #labacue2#53 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "titfpno";
     |SI #labacue2#53 = " ";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "centrosi";
     |SI #labacue2#80 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "centrono";
     |SI #labacue2#80 = " ";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;
|FPRC;

|PROCESO pe229;     || nuevo anexo de formacion mar/2012  ANEXO II
     aCampo = "grado medio";
     |SI #labacue2#81 = "M";
           aValor = "Si";
           |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "grado superior";
     |SI #labacue2#81 = "S";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "acrepar";
     |SI #labacue2#80 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "forcomp";
     |SI #labacue2#79 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "centro1";
     |SI #labacue2#67 = 1;
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "nrocentro1";
     |SI #labacue2#67 = 1;
          aValor = #labacue2#23;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "centro2";
     |SI #labacue2#67 = 2;
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "nrocentro2";
     |SI #labacue2#67 = 2;
          aValor = #labacue2#23;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "centro3";
     |SI #labacue2#67 = 3;
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "nrocentro3";
     |SI #labacue2#67 = 3;
          aValor = #labacue2#23;
          |HAZ GrabaTemporal;
     |FINSI;
|FPRC;

|PROCESO Comunes229_230;     || nuevo anexo de formacion mar/2012
     aCampo = "tel centro"; aValor = #labacue2#5; |HAZ GrabaTemporal;
     aCampo = "provincia centro"; aValor = #labacue2#24; |HAZ GrabaTemporal;
     aCampo = "fechainifor"; aValor = #labacue2#68; |HAZ GrabaTemporal;
     aCampo = "fechafinfor"; aValor = #labacue2#69; |HAZ GrabaTemporal;
     aCampo = "horariofor"; aValor = #labacue2#70; |HAZ GrabaTemporal;
     aCampo = "comunidad"; aValor = #labacue2#71; |HAZ GrabaTemporal;
     aCampo = "horas11"; aValor = #labacue2#72; |HAZ GrabaTemporal;
     aCampo = "horas12"; aValor = #labacue2#73; |HAZ GrabaTemporal;
     aCampo = "horas21"; aValor = #labacue2#74; |HAZ GrabaTemporal;
     aCampo = "horas22"; aValor = #labacue2#75; |HAZ GrabaTemporal;
     aCampo = "email centro"; aValor = #labacue2#26; |HAZ GrabaTemporal;
     aCampo = "cifempresa"; aValor = #labempre#10; |HAZ GrabaTemporal;
     aCampo = "telempresa"; aValor = #labempre#111; |HAZ GrabaTemporal;
     aCampo = "emailempresa"; aValor = #labempre#130; |HAZ GrabaTemporal;
     aCampo = "fechafincontrato"; aValor = #labacue2#66; |HAZ GrabaTemporal;

     aCampo = "puesto";
     |SI #labcontr#67 = "S";
          aValor = #labacue2#13;
     |SINO;
          aValor = #labtraba#19;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "CNO";
     |SI #labcontr#67 = "S";
          aValor = #labacue2#27;
     |SINO;
          aValor = #labtraba#185;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "nombrerepempresa"; aValor = #labacue2#45; |HAZ GrabaTemporal;
     aCampo = "nifrepempresa"; aValor = #labacue2#46; |HAZ GrabaTemporal;
     aCampo = "cargorepempresa"; aValor = #labacue2#47; |HAZ GrabaTemporal;
     aCampo = "razonsocialempresa"; aValor = #labempre#2; |HAZ GrabaTemporal;
     aCampo = "nombre trab"; aValor = #labtraba#2; |HAZ GrabaTemporal;
     aCampo = "DNI trab"; aValor = #labtraba#7; |HAZ GrabaTemporal;

     aCampo = "idcontrato";
     aAlfa1 = "";
     aAlfa = #labacue2#28; |QBF aAlfa; aAlfa1 = aAlfa;
     aAlfa = #labacue2#29; |QBF aAlfa; aAlfa1 = aAlfa1 + aAlfa;
     aAlfa = #labacue2#31; |QBF aAlfa; aAlfa1 = aAlfa1 + aAlfa;
     aAlfa = #labacue2#32; |QBF aAlfa; aAlfa1 = aAlfa1 + aAlfa;
     aAlfa = #labacue2#33; |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa1 = aAlfa1 + aAlfa;
     |FINSI;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

     aCampo = "fechacontrato"; aValor = #labacue2#50; |HAZ GrabaTemporal;
     aCampo = "nombrerepcentro"; aValor = #labacue2#6; |HAZ GrabaTemporal;
     aCampo = "nifrepcentro"; aValor = #labacue2#8; |HAZ GrabaTemporal;
     aCampo = "cargorepcentro"; aValor = #labacue2#51; |HAZ GrabaTemporal;
     aCampo = "nombre centro"; aValor = #labacue2#2; |HAZ GrabaTemporal;
     aCampo = "CIF centro"; aValor = #labacue2#3; |HAZ GrabaTemporal;
     aCampo = "Direccion centro"; aValor = #labacue2#4; |HAZ GrabaTemporal;
     aCampo = "CP centro";

     aAlfa1 = #labacue2#19; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #labacue2#20; |QBF aAlfa2; aAlfa2 = ("000" + aAlfa2) % -103;
     aValor = aAlfa1 + aAlfa2; |QBF aValor;
     aCodPos = aValor;
     |HAZ GrabaTemporal;

     aCampo = "localidad centro"; aValor = #labacue2#21; |HAZ GrabaTemporal;

     || mando aCodPos
     aCampo = "codmuni centro";
     |HAZ CodigoMuni;
     |SI nContMuni = 0;
          |MENAV "0000Codigo de municipio del trabajador inaccesible.";
          aValor = "00000";
     |SINO;
          aValor = aCodMuni;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "certprof";
     |SI #labacue2#52 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "titfp";
     |SI #labacue2#53 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "eso";
     |SI #labacue2#54 = "X";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "denom certprof";
     |SI #labacue2#52 = "X";
          aValor = #labacue2#55;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "codigo certprof";
     |SI #labacue2#52 = "X";
          aValor = #labacue2#56;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "RD certprof";
     |SI #labacue2#52 = "X";
          aValor = #labacue2#57;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "horas certprof";
     |SI #labacue2#52 = "X";
          aValor = #labacue2#58;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "denom titfp";
     |SI #labacue2#53 = "X";
          aValor = #labacue2#59;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "RD titfp";
     |SI #labacue2#53 = "X";
          aValor = #labacue2#60;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "horas titfp";
     |SI #labacue2#53 = "X";
          aValor = #labacue2#61;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "presencial";
     |SI #labacue2#18 = "P";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "a distancia";
     |SI #labacue2#18 = "D";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "mixta";
     |SI #labacue2#18 = "M";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "teleformacion";
     |SI #labacue2#18 = "T";
          aValor = "Si";
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "localidad"; aValor = #labacue2#62; |HAZ GrabaTemporal;

     aCampo = "dia";
     aValor = #labacue2#63;
     |QBF aValor;
     |SI aValor = "0"; aValor = ""; |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "mes"; aValor = #labacue2#64; |HAZ GrabaTemporal;

     aCampo = "a\361o";
     aValor = #labacue2#65;
     |QBF aValor;
     |SI aValor = "0"; aValor = ""; |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "registro acuerdo";
     aEmp = #labacue2#0; aEmp = "00000" + aEmp; aEmp = aEmp % -105;
     aTra = #labacue2#1; aTra = "00000" + aTra; aTra = aTra % -105;
     aCon = contador; aCon = "000000" + aCon; aCon = aCon % -105;
     aValor = aEmp + " / " + aTra + " / " + aCon;
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO anexoformacion;
     nTipo = 0;

     |SI aArchivo = "pe-229.pdf"; |O aArchivo = "pe-229cb.pdf";
     |O aArchivo = "pe-230.pdf"; |O aArchivo = "pe-230cb.pdf";
     |O aArchivo = "AnexoEdutedis12.pdf"; |O aArchivo = "AnexoEdutedis12cb.pdf";
          |HAZ Comunes229_230;
     |FINSI;
     |SI aArchivo = "pe-229.pdf"; |O aArchivo = "pe-229cb.pdf";
          |HAZ pe229;
     |FINSI;
     |SI aArchivo = "pe-230.pdf"; |O aArchivo = "pe-230cb.pdf";
          |HAZ pe230;
     |FINSI;
     |SI aArchivo = "AnexoEdutedis12.pdf"; |O aArchivo = "AnexoEdutedis12cb.pdf";
          |HAZ pe230;
          |HAZ DatosPago;
     |FINSI;

     |CIERRA #87;
|FPRC;

|PROCESO ImpresionAnx;
          aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
          |NOME_DAT #100 aAlfa1;
          |DELINDEX #pdfimtmp;
          |ABRE #pdfimtmp;
          |ABRE #pdfdocca;
          |ABRE #pdfdocli;
          |ABRE #labclafi;

          aArchivo = "anexoclaus.pdf";

          |HAZ AnexoClaus;

          |CIERRA #labclafi;
          |CIERRA #pdfimtmp;
          |CIERRA #pdfdocca;
          |CIERRA #pdfdocli;

          |SI PARAMETRO ! "CONTRAT@";
               |SI swOpcionesForm = 0; |O swOpcionesForm = 1; |O swOpcionesForm = 2;
                    |SUB_EJECUTA "pdfgraba";
               |FINSI;
          |SINO;
             |HAZ Contrata;
          |FINSI;
|FPRC;


|PROCESO Formacion;
     |PUSHV 11152170;
     |PINTA 1118, "                                              ";
     |ATRI R;
               ||    2         3         4         5         6
               ||  8901234567890123456789012345678901234567890123
     |PINTA 1218, " Opciones impresi¢n: pr¢rrogas cont.formaci¢n";
     |ATRI 0;
     |PINTA 1263, " ";
     |PINTA 1418, "   - Elija una de las siguientes opciones -   ";
     |PINTA 1318, "                                              ";
     |PINTA 1518, " (1) Imprimir pr¢rroga y acuerdo de formaci¢n ";
     |PINTA 1618, " (2) Imprimir solo la pr¢rroga                ";
     |PINTA 1718, " (3) Imprimir solo el acuerdo de formaci¢n    ";
     |PINTA 1818, "                                              ";
     |PINTA 1918, "                  Opci¢n:                     ";
     |PINTA 2018, "                                              ";
     |ATRI R;
     |PINTA 1519, "(1)";
     |PINTA 1619, "(2)";
     |PINTA 1719, "(3)";
     |ATRI 0;
     |CUADRO 11182163;

     E_sup = 1;
     E_inf = "";
     aAlfa = "1";
     aAlfa = 1944 ? 1;
     |QBF aAlfa;

     swOpcionesForm = aAlfa;

     |POPV;
|FPRC;

|PROCESO Idioma;
     swOtroIdioma = 0;
     eaIdioma = #labtraba#136;
     |SI eaIdioma ! "CAS";
          |SI eaIdioma = "CAT";
               eaIdioma = "cat";
          |FINSI;
          |SI eaIdioma = "VAL";
               eaIdioma = "val";
          |FINSI;
          |SI eaIdioma = "GAL";
               eaIdioma = "gal";
          |FINSI;
     |FINSI;
     |SI eaIdioma ! "CAS";
          |DBASE aOrigen;
          |QBF aOrigen;
          aOrigen = aOrigen + "pdf/" + aArchivo;
          aOrigen = aOrigen - ".pdf";
          aOrigen = aOrigen + "_" + eaIdioma + ".pdf";

          |XABRE "", aOrigen, nCanalIdi;
          |SI FSalida = 0;
               swOtroIdioma = 1;
          |FINSI;
          |XCIERRA nCanalIdi;
     |FINSI;
|FPRC;

|PROCESO ImprePDF;
          |ABRE #labacue2;
          #labacue2#0 = #0#0;
          #labacue2#1 = #0#1;
          |LEE 101#labacue2.=;
          |SI FSalida = 0;
               || tengo acuerdo de formacion, pregunto antes de sacar
               || la prorroga si quiero sacar prorroga, acuerdo o las
               || dos cosas

               |SI PARAMETRO ! "CONTRAT@";
                    |HAZ Formacion;
               |FINSI;
          |FINSI;
          |CIERRA #labacue2;


     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #pdfimtmp;
     |ABRE #pdfimtmp;
     |ABRE #pdfdocca;
     |ABRE #pdfdocli;

     swCopia = 1;
     aArchivo="pe-191.pdf"
     |HAZ Idioma;
     |HAZ CargaCampos;

     |CIERRA #pdfimtmp;
     |CIERRA #pdfdocca;
     |CIERRA #pdfdocli;

     |SI PARAMETRO ! "CONTRAT@";
          |SI swOpcionesForm = 0; |O swOpcionesForm = 1; |O swOpcionesForm = 2;
               |SUB_EJECUTA "pdfgraba";
          |FINSI;
     |SINO;
          |HAZ Contrata;
          |ACABA;
     |FINSI;

     nTipo = 5;
     aCampo = "clausadici";
     aAlfa = aCampo;
     nLimiteClau = 5;
     |PARA nNume = 1; |SI nNume [ nTipo; |HACIENDO nNume = nNume + 1;
          nCampo = nNume + 24;
          aValor = #0#nCampo#;
          |QBF aValor;
          |SI aValor = "";
               nNume = nNume - 1;
               |SI nNume > nLimiteClau;
                    swAnexoClaus = 1;
               |FINSI;
               |SAL;
          |FINSI;
          |SI nCampo = 29;
               |SI aValor ! ""
                    swAnexoClaus = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI swAnexoClaus = 0;
          nLimReal = nNume;
          |PARA nNume = 1; |SI nNume [ nTipo; |HACIENDO nNume = nNume + 1;
               aNume = nNume;  aNume = "00" + aNume; aNume = aNume % -102;
               aCampo = aAlfa + aNume;
               nCampo = nNume + 24;
               aValor = #0#nCampo#;
               |QBF aValor;
          |SIGUE;
     |SINO;                    ||PONEMOS EL MENSAJE DE VER EN HOJA ADJUNTA Y TODAS LAS CLAUSULAS EN BLANCO->""
          nLimReal = nNume;
          |PARA nNume = 1; |SI nNume [ nTipo; |HACIENDO nNume = nNume + 1;
               aNume = nNume;  aNume = "00" + aNume; aNume = aNume % -102;
               aCampo = aAlfa + aNume;
               nCampo = nNume + 24;
               |SI nNume = 1;
                    aValor = "                                 .- Ver en hoja adjunta.";
               |SINO;
                    aValor = "";
                    |QBF aValor;
               |FINSI;
          |SIGUE;
     |FINSI;
     |SI swAnexoClaus = 1;
          nNCA = nclaus / 40;       || registro:nro total claus,40=max/pag.
          nNCA = nNCA + 0.5;          || Numero de paginas de clausulas adic.
          nNCA = nNCA ! 0;            || que tengo que sacar (trunco)
          |PARA nVoypor = 1; |SI nVoypor [ nNCA; |HACIENDO nVoypor = nVoypor + 1;
               aProcedencia = "AnexoClaus";
               |HAZ ImpresionAnx;  || Anexo Clausulas
               nCuantos = nCuantos + 2;
          |SIGUE;
     |FINSI;

     |SI nAcuerdo = 1;
          aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
          |NOME_DAT #100 aAlfa1;
          |DELINDEX #pdfimtmp;
          |ABRE #pdfimtmp;
          |ABRE #pdfdocca;
          |ABRE #pdfdocli;
          |ABRE #labhisto;              || busco el contrato original
          |SI nLabHisto = 1;
               #labhisto#100 = enNumRegis;   || para saber si es con o sin
          |SINO;                             || graduado escolar
               #labhisto#100 = #labhisto#100;
          |FINSI;
          #labhisto#103 = "";
          |LEE 000#labhisto.=;
          FEstado = FSalida;
          |CIERRA #labhisto;

|| xxxxxxxxxxxxxxxxxxxxxxxxx
          |DDEFECTO #labacue2;
          #labacue2#14 = #0#3;   || oficina empleo contrato
          #labacue2#15 = #0#21;  || localidad contrato

          |ABRE #labacue2;
          #labacue2#0 = #0#0;
          #labacue2#1 = #0#1;
          |LEE 101#labacue2.=;
          |SI FSalida = 0;
               |SI #labcontr#67 = "N";
                    |SI #labacue2#82 = "S";
                         aArchivo = "pe-229.pdf";
                    |SINO;
                         aArchivo = "pe-230.pdf";
                    |FINSI;
               |SINO;
                    aArchivo = "AnexoEdutedis12.pdf";
               |FINSI;
               |HAZ anexoformacion;
          |FINSI;

          |CIERRA #pdfimtmp;
          |CIERRA #pdfdocca;
          |CIERRA #pdfdocli;


          |SI PARAMETRO ! "CONTRAT@";
               |SI swOpcionesForm = 1; |O swOpcionesForm = 3;
                    |SUB_EJECUTA "pdfgraba";
               |FINSI;
          |SINO;
               |HAZ Contrata;
          |FINSI;
     |FINSI;

     enEmp = #0#0;
     enTra = #0#1;
     nNroProrr = #0#4;
     eaFechaAlta = #labprorr#7;
     eaVengoDe = "contrato";

     |SI PARAMETRO ! "CONTRAT@"; |SUB_EJECUTA "pdfimpre"; |FINSI;
|FPRC;

|PROCESO fechacon; |TIPO 0;
        vfec = #0Campo; vsw = 0;
|SI vfec ! vblanco; |Y vfec ! vpuntos; |Y vfec ! Aindefinido;
  vdia1 = vfec % A102;
  vme1 = vfec % A402;
  vany1 = vfec % A704;
  vdia = vdia1; vme = vme1; vany = vany1;
  |SI vdia ! 0; |Y vme ! 0; |Y vany ! 0;
     |SI vme [ 12; |Y vme ] 1;
       |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7; |O vme = 8; |O vme = 10; |O vme = 12;
           vtope = 31;
       |SINO;
           |SI vme = 2;
               mod = vany $ 4;
               |SI mod = 0;
                   vtope = 29;
               |SINO;
                   vtope = 28;
               |FINSI;
            |SINO;
               vtope = 30;
            |FINSI;
        |FINSI;
        |SI vdia [ vtope;
            vsw = 1;
        |FINSI;
     |FINSI;
  |FINSI;
|SINO;
  vsw = 1;
|FINSI;
|SI vsw = 0;
    |MENAV verrfec;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO CuentaClaus;
     |PARA ParaI = 3; |SI ParaI [ 20; |HACIENDO ParaI = ParaI + 1;
          aTmp = #5#ParaI#;
          |QBF aTmp;
          |SI aTmp ! "";
               nclaus = nclaus + 1;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO CopiaClaus1;
     |PARA nCampo = 3; |SI nCampo [ 20; |HACIENDO nCampo = nCampo + 1;
          #labclaus#nCampo# = #labclau1@#nCampo#;
     |SIGUE;
|FPRC;

|PROCESO ExisteClaus;
     swExiste = 0;

     #5#1 = #0#31;
     |LEE 040#5=;
     |SI FSalida = 0;
          swExiste = 1;
     |FINSI;

     |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/labclau1.mas";
     |CARGA_DEF aAlfa, labclau1@;
     |SI FSalida = 0;
          |ABRE #labclau1@;
          #labclau1@#21 = #0#0;
          #labclau1@#22 = #0#2;
          #labclau1@#1 = #0#31;
          |LEE 000#labclau1@.=;
          |SI FSalida = 0;
               swExiste = 1;
               |HAZ CopiaClaus1;
          |SINO;
               #labclau1@#21 = #0#0;
               #labclau1@#22 = 000;
               #labclau1@#1 = #0#31;
               |LEE 000#labclau1@.=;
               |SI FSalida = 0;
                    swExiste = 1;
                    |HAZ CopiaClaus1;
               |FINSI;
               |CIERRA #labclau1@;
          |FINSI;
          |DESCARGA_DEF #labclau1@;
     |FINSI;
|FPRC;

|PROCESO siexiste; |TIPO 0;
     |SI #0#31 ! 0;
          |ABRET #5;
          |HAZ ExisteClaus;
          |SI swExiste = 1;
               nclaus = 0;
               |HAZ CuentaClaus;
               #0#25 = #5#3;
               #0#26 = #5#4;
               #0#27 = #5#5;
               #0#28 = #5#6;
               #0#29 = #5#7;
               |PINTA #0#25;
               |PINTA #0#26;
               |PINTA #0#27;
               |PINTA #0#28;
               |PINTA #0#29;
          |SINO;
               #0#25 = "";
               #0#26 = "";
               #0#27 = "";
               #0#28 = "";
               #0#29 = "";
               nclaus = 0;
               |PINTA #0#25;
               |PINTA #0#26;
               |PINTA #0#27;
               |PINTA #0#28;
               |PINTA #0#29;
               |MENAV mensa8;
               |ERROR;
          |FINSI;
          |CIERRA #5;
     |SINO;
          #0#25 = "";
          #0#26 = "";
          #0#27 = "";
          #0#28 = "";
          #0#29 = "";
          |PINTA #0#25;
          |PINTA #0#26;
          |PINTA #0#27;
          |PINTA #0#28;
          |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO dias_sem;
     |SI fec2 = 1;   mes = "Enero     ";   |FINSI;
     |SI fec2 = 2;   mes = "Febrero   ";   |FINSI;
     |SI fec2 = 3;   mes = "Marzo     ";   |FINSI;
     |SI fec2 = 4;   mes = "Abril     ";   |FINSI;
     |SI fec2 = 5;   mes = "Mayo      ";   |FINSI;
     |SI fec2 = 6;   mes = "Junio     ";   |FINSI;
     |SI fec2 = 7;   mes = "Julio     ";   |FINSI;
     |SI fec2 = 8;   mes = "Agosto    ";   |FINSI;
     |SI fec2 = 9;   mes = "Septiembre";   |FINSI;
     |SI fec2 = 10;  mes = "Octubre   ";   |FINSI;
     |SI fec2 = 11;  mes = "Noviembre ";   |FINSI;
     |SI fec2 = 12;  mes = "Diciembre ";   |FINSI;
|FPRC;

|PROCESO dias_sem_cat;
     |SI fec2 = 1;   mes = "Gener     ";   |FINSI;
     |SI fec2 = 2;   mes = "Febrer    ";   |FINSI;
     |SI fec2 = 3;   mes = "Març      ";   |FINSI;
     |SI fec2 = 4;   mes = "Abril     ";   |FINSI;
     |SI fec2 = 5;   mes = "Maig      ";   |FINSI;
     |SI fec2 = 6;   mes = "Juny      ";   |FINSI;
     |SI fec2 = 7;   mes = "Juliol    ";   |FINSI;
     |SI fec2 = 8;   mes = "Agost     ";   |FINSI;
     |SI fec2 = 9;   mes = "Setembre  ";   |FINSI;
     |SI fec2 = 10;  mes = "Octubre   ";   |FINSI;
     |SI fec2 = 11;  mes = "Novembre  ";   |FINSI;
     |SI fec2 = 12;  mes = "Decembre  ";   |FINSI;
|FPRC;

|PROCESO numpror_cat;
     |SI #0#4 = 1;   prorro = "primera";   |FINSI;
     |SI #0#4 = 2;   prorro = "segona";    |FINSI;
     |SI #0#4 = 3;   prorro = "tercera";   |FINSI;
     |SI #0#4 = 4;   prorro = "quarta";    |FINSI;
     |SI #0#4 = 5;   prorro = "cinquena";  |FINSI;
     |SI #0#4 = 6;   prorro = "sisena";    |FINSI;
     |SI #0#4 = 7;   prorro = "setena";    |FINSI;
     |SI #0#4 = 8;   prorro = "vuitena";   |FINSI;
     |SI #0#4 = 9;   prorro = "novena";    |FINSI;
     |SI #0#4 = 10;  prorro = "desena";    |FINSI;
     |SI #0#4 = 11;  prorro = "onzena";    |FINSI;
     |SI #0#4 = 12;  prorro = "dotzena";   |FINSI;
|FPRC;

|PROCESO numpror;
     |SI #0#4 = 1;   prorro = "primera";   |FINSI;
     |SI #0#4 = 2;   prorro = "segunda";   |FINSI;
     |SI #0#4 = 3;   prorro = "tercera";   |FINSI;
     |SI #0#4 = 4;   prorro = "cuarta";    |FINSI;
     |SI #0#4 = 5;   prorro = "quinta";    |FINSI;
     |SI #0#4 = 6;   prorro = "sexta";     |FINSI;
     |SI #0#4 = 7;   prorro = "s‚ptima";   |FINSI;
     |SI #0#4 = 8;   prorro = "octava";    |FINSI;
     |SI #0#4 = 9;   prorro = "novena";    |FINSI;
     |SI #0#4 = 10;  prorro = "d‚cima";    |FINSI;
     |SI #0#4 = 11;  prorro = "und‚cima";  |FINSI;
     |SI #0#4 = 12;  prorro = "duod‚cima"; |FINSI;
|FPRC;

|PROCESO decodifi;             || RUTINA DE DEGLOSE FECHA PRESENTACION
     |SI #0#19 ! vpuntos; |Y #0#19 ! vblanco;
          fec1 = #0#19;
          dia1 = fec1 % 102;
          dia  = dia1;
          any1 = fec1 % 704;
          anyo = any1;
          fec1 = fec1 % 402;
          fec2 = fec1;
          |SI #labtraba#136 = "CAT";
               |HAZ dias_sem_cat;
          |SINO;
               |HAZ dias_sem;
          |FINSI;
     |SINO;
          dia = "..";
          mes = vpuntos;
          anyo = "....";
     |FINSI;

     aCampo = "diafirma";
     aValor = dia;
     |HAZ GrabaTemporal;

     aCampo = "mesfirma";
     aValor = mes;
     |HAZ GrabaTemporal;

     aCampo = "anyofirma";
     aValor = anyo % -102;
     |HAZ GrabaTemporal;

     |SI #labtraba#136 = "CAT";
          |HAZ numpror_cat;
     |SINO;
          |HAZ numpror;
     |FINSI;

     aCampo = "numproga";
     aValor = prorro;
     |HAZ GrabaTemporal;

         contra = "";
     |SI #0#10 ! 0;
             contra = #0#10;
             contra = contra + " mes";
         |SI #0#10 > 1;
             contra = contra + "es";
         |FINSI;
     |FINSI;
     |SI #0#11 ! 0;
         |SI #0#10 ! 0;
                 contra = contra + and;
         |FINSI;
             contra = contra + #0#11;
             contra = contra + " dia";
         |SI #0#11 > 1;
                 contra = contra + "s";
         |FINSI;
     |FINSI;
     aCampo = "mesesduracont";
     aValor = contra;
     |HAZ GrabaTemporal;

|FPRC;

|PROCESO diasmese;              || RUTINA PARA MONTAR ALFANUMERICO
    dura = "";                  || DE DURACION
    |SI #0#18 ! 0;
        dura = #0#18;
        dura = dura + " mes";
        |SI #0#18 > 1;
            dura = dura + "es";
        |FINSI;
    |FINSI;
    |SI #0#22 ! 0;
        |SI #0#18 ! 0;
            dura = dura + and;
        |FINSI;
        dura = dura + #0#22;
        dura = dura + " dia";
        |SI #0#22 > 1;
                dura = dura + "s";
        |FINSI;
    |FINSI;
    aCampo = "totaldura";
    aValor = dura;
    |HAZ GrabaTemporal;
|FPRC;

|PROCESO domicili;                    || RUTINA DEL CALCULO actualiz
    direcc = #1#3;                    || PARA CONSTRUCCION DOMICILIOS
    numero = #1#4;
    piso   = #1#5;
    cod1   = #1#7;
    cod2   = #1#8;
    locali = #1#6;
|HAZ compac;
    domemp = compactado;              || domicilio empresa
    aCampo = "domsocialem";
    aValor = domemp;
    |HAZ GrabaTemporal;

     aCodPostal1 = #labempre#7;
     aCodPostal1 = "00" + aCodPostal1;
     aCodPostal1 = aCodPostal1 % -102;
     aCodPostal2 = #labempre#8;
     aCodPostal2 = "00" + aCodPostal2;
     aCodPostal2 = aCodPostal2 % -103;
     aCPED1 = aCodPostal1 % 101;
     aCPED2 = aCodPostal1 % 201;
     aCPED3 = aCodPostal2 % 101;
     aCPED4 = aCodPostal2 % 201;
     aCPED5 = aCodPostal2 % 301;

     aCampo = "codpostem1";
     aValor = aCPED1;
     |HAZ GrabaTemporal;

     aCampo = "codpostem2";
     aValor = aCPED2;
     |HAZ GrabaTemporal;

     aCampo = "codpostem3";
     aValor = aCPED3;
     |HAZ GrabaTemporal;

     aCampo = "codpostem4";
     aValor = aCPED4;
     |HAZ GrabaTemporal;

     aCampo = "codpostem5";
     aValor = aCPED5;
     |HAZ GrabaTemporal;

    aCampo = "codacteco1";
    aAlfa = #1#11;
    aValor = aAlfa % -201;
    |HAZ GrabaTemporal;

    aCampo = "codacteco2";
    aAlfa = #1#11;
    aValor = aAlfa % -101;
    |HAZ GrabaTemporal;

    aCampo = "cif";
    aValor = #1#10;
    |HAZ GrabaTemporal;

     swVariosAdm = 0;
     |ABRE #labadmma;
     #labadmma#0 = #labempre#0;
     |LEE 000#labadmma.=;
     |SI FSalida = 0;
          swVariosAdm = 1;
     |FINSI;
     |CIERRA #labadmma;

     |SI swVariosAdm = 0;
          aValor = #labempre#15;
     |SINO;
          aAlfa1 = #labadmma#2; |QBF aAlfa1;
          aAlfa2 = #labadmma#4; |QBF aAlfa2;
          |SI aAlfa2 ! "";
               aValor = aAlfa1 + " - " + aAlfa2;
          |SINO;
               aValor = aAlfa1;
          |FINSI;
     |FINSI;

    aCampo = "nomrepr";
    aValor = aValor;
    |HAZ GrabaTemporal;

    aCampo = "repre_emp";
    aValor = aValor;
    |HAZ GrabaTemporal;

     aCampo = "dnirep";
     |SI swVariosAdm = 0;
          aValor = #labempre#17;
     |SINO;
          aAlfa1 = #labadmma#3; |QBF aAlfa1;
          aAlfa2 = #labadmma#5; |QBF aAlfa2;
          |SI aAlfa2 ! "";
               aValor = aAlfa1 + " - " + aAlfa2;
          |SINO;
               aValor = aAlfa1;
          |FINSI;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "cargorep";
     |SI swVariosAdm = 0;
          aValor = #labempre#18;
     |SINO;
          aValor = #labadmma#1;
     |FINSI;
     |HAZ GrabaTemporal;

    aCampo = "razsoc";
    aValor = #1#2;
    |HAZ GrabaTemporal;

    aCampo = "litacteco";
    aValor = #1#12;
    |HAZ GrabaTemporal;

    direcc = #2#3;
    numero = #2#4;
    piso   = #2#5;
    cod1   = #2#8;
    cod2   = #2#9;
    locali = #2#6;
|HAZ compac;
    domtra = compactado;              || domicilio trabajador

    direcc = #3#3;
    numero = #3#4;
    piso   = #3#5;
    cod1   = #3#7;
    cod2   = #3#8;
    locali = #3#6;
|HAZ compac;
    domcen = compactado;              || domicilio centro trabajo
    locali = #0#21;
    |QBF locali;
    locali = "                         " + locali;
    locali = locali % -125;
    #0#21 = locali;

     aCampo = "pais_emp"; aValor = "ESPA¥A"; |HAZ GrabaTemporal;
     aCampo = "pais_tra"; aValor = "ESPA¥A"; |HAZ GrabaTemporal;
     aCampo = "pais_cen"; aValor = "ESPA¥A"; |HAZ GrabaTemporal;

     aCampo = "municipio_emp";
     aValor = #labempre#6;
     |HAZ GrabaTemporal;

     aCampo = "municipio_cen";   || municipio centro
     aValor = #labcentr#6;
     |SI #labtraba#45 = "421"; |O #labtraba#45 = "422";
          |ABRE #nomcenes;
          #nomcenes#0 = #labtraba#0;
          #nomcenes#13 = #labtraba#77;
          #nomcenes#1 = 87;
          |LEE 000#nomcenes.=;
          |SI FSalida = 0;
               aAlfa = #nomcenes#6;
               |QBF aAlfa;
               |SI aAlfa ! "";
                    aValor = aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #nomcenes;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "municipio_tra";   || municipio trabajador
     aValor = #labtraba#6;
     |HAZ GrabaTemporal;

     aCampo = "nacionalidad";    || nacionalidad
     aValor = "ESPA¥A";
     |SI nPaisTrabaja ! 724;
          aAlfa1 = #labtraba#76;
          aAlfa2 = nPaisTrabaja;
          aAlfa2 = aAlfa2 + " ";
          aValor = aAlfa1 - aAlfa2;
     |FINSI;
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO compac;                      || SUBRUTINA DE RUTINA domicili
    compactado = "";                  || DE COMPACTACION DE CAMPOS
    |QBF direcc;                      || USADA TAMBIEN EN CONT. 05 Y 25
    |QBF numero;
    |QBF piso;
    |QBF cod1; cod1 = "00" + cod1; cod1 = cod1 % -102;
    |QBF cod2; cod2 = "000" + cod2; cod2 = cod2 % -103;
    |QBF locali;
    compactado = direcc + coma;
    compactado = compactado + numero;
    compactado = compactado + "  ";
    compactado = compactado + piso;
    ||compactado = compactado + " (";
    ||compactado = compactado + cod1;
    ||compactado = compactado + cod2;
    ||compactado = compactado + ") ";
    ||compactado = compactado + locali;
    punt = " ";
    linepunt = punt * 70;
    compactado = compactado + linepunt;
    compactado = compactado % 170;
|FPRC;

|PROCESO nomodif2; |TIPO 7;     || CONVIERTE A NO MODIFICABLES CAMPOS DE
|SI #0#31 = 0;                  || LAS CLAUSULAS ADICIONALES
    |HAZ nopasa;
|FINSI;
|FPRC;

|PROCESO nopasa;                   || SUBRUTINA PARA HACER <no modificable>
    aponer = Anono;                || LLAMADA EN EL <nomodif>
    fiac = Control % A1001;
    Control = Control + fiac;
    Control = Control + relleno;
    Control = Control % A120;
    Control = Control + aponer;
|FPRC;

|PROCESO edadanyo;              || CALCULA EDAD EN BASE A UNA FECHA
|SI fechtra ! vblanco; |Y fechtra ! vpuntos;
    sistema = fechtra;
    nacitra = sistema;
    sistema = ~;
    actutra = sistema;
    edadtra = actutra - nacitra;
    anyotra = edadtra $ 365;
    edadtra = edadtra - anyotra;
    anyotra = edadtra / 365;
|SINO;
    anyotra = 0;
|FINSI;
|FPRC;

|PROCESO recarga;
|SI #4#07 ! vpuntos;|Y #4#07 ! vblanco;
        #4#23 = #4#07;
|SINO;
        #4#23 = "00.00.0000";
|FINSI;
|SI #4#08 ! vpuntos;|Y #4#08 ! vblanco;
        #4#24 = #4#08;
|SINO;
        #4#24 = "00.00.0000";
|FINSI;
|SI #4#19 ! vpuntos;|Y #4#19 ! vblanco;
        #4#25 = #4#19;
|SINO;
        #4#25 = "00.00.0000";
|FINSI;
|SI #4#20 ! vpuntos;|Y #4#20 ! vblanco;
        #4#26 = #4#20;
|SINO;
        #4#26 = "00.00.0000";
|FINSI;
|FPRC;

|PROCESO acuerdo; |TIPO 0;
     |SI FSalida = 0;|O FSalida = 3;
          |SI #0#14 = "087";|O #0#14 = "097";|O #0#14 = "085";|O #0#14 = "421";
               |ABRE #4;
               |SELECT #2#4;
               #4#1 = #0#0;
               #4#2 = #0#1;
               |LEE 040#4=;
               |CIERRA #4;

               |ABRE #labhisto;              || busco el contrato original
               #labhisto#100 = #4#0;
               #labhisto#103 = "";
               |LEE 000#labhisto.=;
               FEstado = FSalida;
               |CIERRA #labhisto;

               aAlfa = #labhisto#101;
               |QBF aAlfa;
               |SI aAlfa = "labcon85";
                    |PUSHV 0501 2380;
                    |PINPA #0#87;
                    |DDEFECTO #87;
                    |ABRE #87;
                    #87#0 = #0#0;
                    #87#1 = #0#1;
                    |LEE 101#87=;
                    FEstado = FSalida;

                    |CAMPO_MODIFICA #87#16, 1, "S";
                    |CAMPO_MODIFICA #87#17, 1, "S";

                    |PINDA #0#87;
                    |ENDATOS #1#87;
                    |SI FSalida = 0;
                         |SI FEstado = 0;    |GRABA 020#87a;     |FINSI;
                         |SI FEstado ! 0;    |GRABA 020#87n;     |FINSI;
                    |FINSI;
                    |LIBERA #87;
                    |CIERRA #87;
                    |POPV;
                    |ABRE #2;
                    #2#0 = #0#0;
                    #2#1 = #0#1;
                    |LEE 020#2=;          || vuelve a leer el trabajador contratado
                    |CIERRA #2;
               |FINSI;
               /*
               |SI aAlfa = "labcon86";
                    |PUSHV 0501 2380;
                    |PINPA #0#227;
                    |DDEFECTO #227;
                    |ABRE #227;
                    #227#0 = #0#0;
                    #227#1 = #0#1;
                    |LEE 101#227=;
                    FEstado = FSalida;

                    |PINDA #0#227;
                    |ENDATOS #1#227;
                    |SI FSalida = 0;
                         |SI FEstado = 0;    |GRABA 020#227a;     |FINSI;
                         |SI FEstado ! 0;    |GRABA 020#227n;     |FINSI;
                    |FINSI;
                    |LIBERA #227;
                    |CIERRA #227;
                    |POPV;

                    |ABRE #2;
                    #2#0 = #0#0;
                    #2#1 = #0#1;
                    |LEE 020#2=;          || vuelve a leer el trabajador contratado
                    |CIERRA #2;
               |FINSI;
               */
               |SI aAlfa = "labcon86";
                    |PUSHV 0501 2380;
                    |PINPA #0#labacue2;
                    |DDEFECTO #labacue2;
                    |ABRE #labacue2;
                    #labacue2#0 = #0#0;
                    #labacue2#1 = #0#1;
                    |LEE 101#labacue2.=;
                    FEstado = FSalida;

                    |PINDA #0#labacue2;
                    |ENDATOS #1#labacue2;
                    |SI FSalida = 0;
                         |SI FEstado = 0;    |GRABA 020#labacue2.a;     |FINSI;
                         |SI FEstado ! 0;    |GRABA 020#labacue2.n;     |FINSI;
                    |FINSI;
                    |LIBERA #labacue2;
                    |CIERRA #labacue2;
                    |POPV;

                    |ABRE #2;
                    #2#0 = #0#0;
                    #2#1 = #0#1;
                    |LEE 020#2=;          || vuelve a leer el trabajador contratado
                    |CIERRA #2;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO el_acuerdo;
|SI #0#14 = "087";|O #0#14 = "097";|O #0#14 = "085";|O #0#14 = "421";
     nAcuerdo = 1;
    |DDEFECTO #87;
        #87#14 = #0#3;   || oficina empleo contrato
        #87#15 = #0#21;  || localidad contrato

    |ABRE #87;
        #87#0 = #0#0;
        #87#1 = #0#1;
    |LEE 101#87=;
    |SI FSalida = 0;
            #87#14 = #0#3;    || oficina empleo contrato
            #87#15 = #0#21;   || localidad contrato
        |GRABA 020#87a;
    |FINSI;
    |LIBERA #87;
    |CIERRA #87;
        des87 = #0#7;
        has87 = #0#8;
    |SI #0#4 = 1;
             tipo87 = 2;
    |SINO;
             tipo87 = 3;
    |FINSI;
/*    |PARA z = 1; |SI z [ #0#20; |HACIENDO z = z + 1;
        |INFOR "labacuer";
        |PRINT;
        |PIEINF;
        |FININF;
    |SIGUE; */
|FINSI;
|FPRC;
_______________________________/ CALCULOS ESPECIFICOS DEL CUADRE 'lod20007'
|PROCESO &pide_ett;
|PUSHV 0501 2380;
|PINPA #3#11;
|DDEFECTO #1;
|ABRE #1;
    nume1 = 00001;
|PARA; |SI; |HACIENDO;
        E_inf = 00001;
        E_sup = 99999;
        nume1 = 1427 ? 1;
    |SI FSalida = 0;
            #1#0 = nume1;
        |LEE 000#1=;
        |SI FSalida ! 0;
            |MENAV "    Empresa inexistente ...";
        |SINO;
            |ATRI I;
            |PINTA 1519, #1#2;
            |ATRI 0;
            |CONFI "2455SEs correcto (S/N)      ";
            |SI FSalida = 0;
                |SAL;
            |FINSI;
        |FINSI;
    |SINO;
        |SAL;
    |FINSI;
|SIGUE;
|CIERRA #1;
|POPV;
|HAZ domicili;
|FPRC;

|PROCESO &repon_ett;
|HAZ leeempre;
|HAZ domicili;
|FPRC;

|PROCESO min90;
    #90#0 = #89#0;
    #90#1 = 1;
|FPRC;

|PROCESO max90;
    #90#0 = #89#0;
    #90#1 = 999;
|FPRC;

|PROCESO disposicion;
|ABRE #89;
    #89#0 = #2#87;
|LEE 101#89=;
|SI FSalida ! 0;    |GRABA 020#89n;     |FINSI;

|PUSHV 0501 2380;
|PINPA #0#89;
|PINDA #0#89;
|ENTLINEAL #1#90, 2, 3, 22, 0, min90, max90;
|POPV;

|LIBERA #89;
|CIERRA #89;
|FPRC;

|| **************************************************************************
|| *****     PROCESOS PARA LA EMISION DE CONTRATOS EN FICHEROS XML      *****
|| **************************************************************************

|PROCESO Contrata;
     |ABRE #labpadre; |ABRE #labcotmp;
     |ABRE #labenvcc; |ABRE #labenvcl;
     #labpadre#0 = #labtraba#0;
     #labpadre#1 = #labtraba#1;
     |LEE 000#labpadre.=;
     |SI FSalida ! 0; |DDEFECTO #labpadre; |FINSI;

     |ABRE #labregis;
     #labregis#0 = enNumRegis;
     |LEE 000#labregis.=;
     |SI FSalida ! 0; |DDEFECTO #labregis; |FINSI;
     |CIERRA #labregis;

     |SI swNetContrata = 0;
          nNumero = 1;
          |LEE 000#labenvcc.p;
          |PARA; |SI FSalida = 0; |HACIENDO;
             |SI #labenvcc#3 = "          ";
                |SI #labenvcc#5 = "P"; |SAL; |FINSI;
             |FINSI;
             |LEE 000#labenvcc.s;
             |SI #labenvcc#6 = #labtraba#0; nNumero = #labenvcc#0 + 1; |FINSI;
          |SIGUE;

          aAlfa = "P";

          |SI #labenvcc#5 = " "; |O #labenvcc#5 ! aAlfa; |O #labenvcc#3 ! "          "; |O #labenvcc#6 ! #labtraba#0;
             |DDEFECTO #labenvcc;
             #labenvcc#0 = nNumero;
             #labenvcc#5 = aAlfa;
             #labenvcc#6 = #labtraba#0;
             |GRABA 020#labenvcc.c;
          |FINSI;

          |DDEFECTO #labenvcl;
          #labenvcl#0 = #labenvcc#0;
          #labenvcl#1 = 99;
          #labenvcl#2 = #labtraba#0;
          |LEE 000#labenvcl.];
          |SI FSalida = 0;
             |SI #labenvcl#0 ! #labenvcc#0; |O #labenvcl#2 ! #labtraba#0;
                |LEE 000#labenvcl.a;
                |SI FSalida = 0;
                   |SI #labenvcl#0 ! #labenvcc#0; |O #labenvcl#2 ! #labtraba#0;
                      nLin = 1;
                   |SINO;
                      nLin = #labenvcl#1 + 1;
                   |FINSI;
                |SINO;
                   nLin = 1;
                |FINSI;
             |FINSI;
          |SINO;
             |LEE 000#labenvcl.u;
             |SI FSalida = 0;
                |SI #labenvcl#0 ! #labenvcc#0; |O #labenvcl#2 ! #labtraba#0;
                   nLin = 1;
                |SINO;
                   nLin = #labenvcl#1 + 1;
                |FINSI;
             |SINO;
                nLin = 1;
             |FINSI;
          |FINSI;

          |DDEFECTO #labenvcl;
          #labenvcl#0 = #labenvcc#0;
          #labenvcl#1 = nLin;
          #labenvcl#2 = #labregis#1;
          #labenvcl#3 = #labregis#2;
          #labenvcl#4 = #labregis#4;
          #labenvcl#5 = #labregis#21;
          #labenvcl#6 = #labempre#2;
          #labenvcl#7 = #labtraba#2;
          #labenvcl#8 = "E" + (("00" + #labtraba#8) % -102) + "0" + (("000000" + #labregis#0) % -106);
          #labenvcl#9 = #labregis#0;
          || #labenvcl#10 = #labregis#0;
          #labenvcl#10 = eaNumProrr;
          #labenvcl#11 = "P";
          |GRABA 020#labenvcl.n;
          |LIBERA #labenvcl;
     |FINSI;

     |HAZ Prorroga;

     |CIERRA #labpadre; |CIERRA #labcotmp;
     |CIERRA #labenvcc; |CIERRA #labenvcl;
|FPRC;

|PROCESO BuscaID;
     || aun no tengo ID, voy a buscarlo a NetContrata

     aMensa = "    El contrato al que se le va a realizar ";
     aMensa = aMensa + "la prórroga no tiene número de identificación. ";
     |MENAV aMensa;

     aMensa = "    A continuación se realizará la conexión con el SEPE ";
     aMensa = aMensa + "para recuperarlo.";
     |MENAV aMensa;

     enEmp = #labtraba#0;
     enTra = #labtraba#1;
     eaNif = #labtraba#7;     |QBF eaNif;
     eaFechaAlta = #labtraba#36;      |QBF eaFechaAlta;
     |SI eaFechaAlta ! "";
          eaFechaAlta = (eaFechaAlta % 102) + "/" + (eaFechaAlta % 402) + "/" + (eaFechaAlta % -104);
     |FINSI;
     enRegistro = #labregis#0;

     eaQueEs = "P";
     |SUB_EJECUTA "labnct09";
     |QBF eaIdContrato;
     |SI eaIdContrato ! "";
          aMensa = "    Se ha recuperado correctamente el identificador ";
          aMensa = aMensa + "del contrato. Se va a continuar con el envío de la prórroga.";
          |MENAV aMensa;
     |FINSI;
|FPRC;

|PROCESO Prorroga;
     || Esto en primer lugar para buscar el Id del contrato si no existe

     aAlfa = #labprorr#17; |QBF aAlfa;
     |SI aAlfa = "";
          aAlfa = #labregis#14; |QBF aAlfa;
     |FINSI;

     |SI aAlfa = "";
          |HAZ BuscaID;
          aAlfa = eaIdContrato;
          |QBF aAlfa;
          |SI aAlfa = "";
               aMensa = "    No ha sido posible obtener identificador ";
               aMensa = aMensa + "del contrato. Se cancelará el envío de la prórroga.";
               |MENAV aMensa;
               |XCIERRA nHandle;
               swStopProrr = 1;    || para el labimpre
          |SINO;
               #labregis#14 = aAlfa;
          |FINSI;
     |FINSI;

     || continuamos con la generacion del XML

     aAlfa = "C:/DOCUMENTOS/Contrat@/"; |RMKDIR aAlfa;
     aAlfa = eaNumProrr; |QBF aAlfa;
     aAlfa = "C:/DOCUMENTOS/Contrat@/pr" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa) % -102) + ".txt";
     |XABRE "CBW", aAlfa, nHandle;
     |SI FSalida ] 0;
          aAlfa = &09 + &09 + "<PRORROGA_TIPO>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = &09 + &09 + &09 + "<DATOS_EMPRESA>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = &09 + &09 + &09 + "<CIF_NIF_EMPRESA>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = #labempre#10; |QBF aAlfa;
          aAlfa = &09 + &09 + &09 + &09 + "<CIF_NIF>" + aAlfa + "</CIF_NIF>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = &09 + &09 + &09 + "</CIF_NIF_EMPRESA>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = ("0000" + #labtraba#247) % -104;
          aAlfa = aAlfa + aCodCCC; |QBF aAlfa;
          aAlfa = &09 + &09 + &09 + &09 + "<CCC>" + aAlfa + "</CCC>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = &09 + &09 + &09 + "</DATOS_EMPRESA>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + &09 + "<DATOS_CONTRATO>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = #labprorr#17; |QBF aAlfa;
          |SI aAlfa = "";
               aAlfa = #labregis#14; |QBF aAlfa;
          |FINSI;

          |SI aAlfa ! "";
               eaIdContrato = aAlfa;
              || Uso identificador de contrato

             aAlfa = aAlfa - "-"; aAlfa = aAlfa - "-"; aAlfa = aAlfa - "-";
             aAlfa = aAlfa % 114;
             aAlfa = &09 + &09 + &09 + "<CLAVE_CONTRATO>" + aAlfa + "</CLAVE_CONTRATO>" + &13 + &10;
             aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |SINO;
             || Uso identificador persona fisica mas fecha inicio contrato
             aAlfa = #labtraba#7; |QBF aAlfa;
             aAlfa1 = aAlfa % 0101;
             |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9";
                aAlfa = "D" + aAlfa;
             |SINO;
                |SI aAlfa1 = "X"; |O aAlfa1 = "Y"; |O aAlfa1 = "Z";
                   aAlfa = "E" + aAlfa;
                |SINO;
                   aAlfa1 = #labtraba#76; |QBF aAlfa1;
                   aAlfa2 = aAlfa1 % 0599; aAlfa1 = aAlfa1 % 0103;
                   |SI aAlfa1 = "ESP"; |O aAlfa1 = "724"; |O aAlfa1 = "250";
                    |O aAlfa1 = "276"; |O aAlfa1 = "056"; |O aAlfa1 = "442";
                    |O aAlfa1 = "380"; |O aAlfa1 = "208"; |O aAlfa1 = "372";
                    |O aAlfa1 = "826"; |O aAlfa1 = "300"; |O aAlfa1 = "620";
                    |O aAlfa1 = "040"; |O aAlfa1 = "246"; |O aAlfa1 = "752";
                    |O aAlfa1 = "233"; |O aAlfa1 = "428"; |O aAlfa1 = "440";
                    |O aAlfa1 = "616"; |O aAlfa1 = "203"; |O aAlfa1 = "703";
                    |O aAlfa1 = "705"; |O aAlfa1 = "348"; |O aAlfa1 = "470";
                    |O aAlfa1 = "196"; |O aAlfa2 = "HOLANDA";
                      aAlfa = "U" + aAlfa;
                   |SINO;
                      aAlfa = "W" + aAlfa;
                   |FINSI;
                |FINSI;
          |FINSI;
          aAlfa = &09 + &09 + &09 + "<IDENTIFICADORPFISICA>" + aAlfa + "</IDENTIFICADORPFISICA>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          aAlfa = #labtraba#36; |QBF aAlfa; aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
          aAlfa = &09 + &09 + &09 + "<FECHA_INICIO_CTO>" + aAlfa + "</FECHA_INICIO_CTO>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
        aAlfa = &09 + &09 + &09 + "</DATOS_CONTRATO>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

        aAlfa = &09 + &09 + &09 + "<DATOS_GENERALES_PRORROGA>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
        aAlfa = #0#7; |QBF aAlfa; aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
        aAlfa = &09 + &09 + &09 + &09 + "<FECHA_INICIO>" + aAlfa + "</FECHA_INICIO>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
        aAlfa = #0#8; |QBF aAlfa; aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
        aAlfa = &09 + &09 + &09 + &09 + "<FECHA_FIN>" + aAlfa + "</FECHA_FIN>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
        |SI #labregis#4 = 402; |O #labregis#4 = 502; |O #labregis#4 = 421;
           aAlfa = &09 + &09 + &09 + &09 + "<INDICADOR_CONV_COL>";
           aAlfa = aAlfa + #labprorr#41; |QBF aAlfa;
           aAlfa = aAlfa + "</INDICADOR_CONV_COL>" + &13 + &10;
           aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
        |FINSI;
        aAlfa = &09 + &09 + &09 + "</DATOS_GENERALES_PRORROGA>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
  /*
        aAlfa = &09 + &09 + &09 + "<DATOS_ADICIONALES_PRORROGA>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
        aAlfa = &09 + &09 + &09 + "</DATOS_ADICIONALES_PRORROGA>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
  */
        |SI swNetContrata = 1;
             aAlfa = #labprorr#4;
             |QBF aAlfa;
             aAlfa = ("00" + aAlfa) % -102;
             aAlfa = &09 + &09 + &09 + "<NUMPRORROGA>" + aAlfa + "</NUMPRORROGA>" + &13 + &10;
             aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
        |FINSI;

        aAlfa = &09 + &09 + "</PRORROGA_TIPO>" + &13 + &10;
        aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
     |XCIERRA nHandle;
|FPRC;

|PROCESO EnvioOnline;
     enExtRegis = #labhisto#100;
     eaExtProrr = #labhisto#103;
     eaExtDef = #labhisto#101;
     enExtEmp = #labhisto#1;
     enExtTra = #labhisto#2;
     |SUB_EJECUTA "labimpre;ENLACECONT";
|FPRC;

|PROCESO actual99;
     |SI nLabHisto ! 1;
          nOpcion = 1;
          enSwSoloArchivo = 0;
          |PARA; |SI nOpcion ] 1; |Y nOpcion [ 3; |HACIENDO;
               |MENU histo;
               nOpcion = FSalida;
               swNetContrata = 0;

               |SI nOpcion = 1;
                    |HAZ ImprePDF;
               |FINSI;

               |SI nOpcion = 2;
                    |HAZ Guarda;
                    enSwSoloArchivo = 1;
                    |HAZ ImprePDF;
               |FINSI;

               |SI nOpcion = 3;
                    |HAZ Guarda;
                    enSwSoloArchivo = 1;
                    |HAZ ImprePDF;

                    swNetContrata = 1;
                    |HAZ EnvioOnline;
               |FINSI;

               |SI nOpcion = 4;
                    |SAL;
               |FINSI;

               |SI nOpcion < 1; |O nOpcion > 3; |ERROR; |ACABA; |FINSI;
          |SIGUE;
     |SINO;
          nOpcion = 1;
          |HAZ ImprePDF;
     |FINSI;
|FPRC;

|PROGRAMA;
     nRegistro = 0;
     nNroProrr = 0;
     |SI nLabornet = 1;
          #0#0 = enEmpresa;
          #0#1 = enTrabajador;
          #0#9 = eaFechaIni;
          #0#10 = eaFechaFin;
          #0#5 = enMeses;
          #0#6 = enDias;

          |CAMPO_MODIFICA #0#0, 1, "N";
          |CAMPO_MODIFICA #0#1, 1, "N";

          |HAZ fechas;
     |FINSI;

     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ actual99;
     |FINSI;
|FPRO;
