|FICHEROS;
     refer00@ #0;

     labcontr #50;

     labcotmp #100;
     labtabla #101;
     labvaltb #102;
     labprovi #103;
     || nompmail #104;

     Referen@ #500;
     Refere1@ #500;
|FIN;

|VARIABLES;
     &eaDatoExt   = "";
     &aCadena     = "";

     aPrograma    = "";
     aDef         = "";
     aQueQuiero   = "";
     aNombreCampo = "";
     aFichero     = "";
     aIPDsCorreo  = "";

     aAlfaRar     = "";
     aAlfaRar1    = "";
     aAlfaRar2    = "";
     aLongRar     = "";

     CalcRar      = 0;
     nContRar     = 0;
     nContRar1    = 0;
     CalcRar1     = 0;
     nLongRar     = 0;
     nTecla       = 0;

     nCalc1       = 0;
     nPosic       = 0;
     nCampo       = 0;
     nCampo1      = 0;
     nTCampo      = 0;
     nSwHay       = 0;
     nSalida      = 0;
     nSwNuevo     = 0;
     nConta       = 0;

     &eaMoneda    = "";
     &enCanti     = 0;
     &enSwTrata   = 0;

     &EURODB      = 0;

     {-1}aMoneda   = "";
         aMoneda1  = "LEER";
         aMoneda2  = "";

     nHandle   = 0;
     nNumCmps  = 0;
     nAbierto  = 0;
     nCalc     = 0;
     nPos1     = 0;
     nPos2     = 0;
     nModo     = 0;
     nCmp      = 0;
     nCont     = 0;
     nSwLectura = 0;
     nLong     = 0;
     nLong1    = 0;
     nLong2    = 0;

     aCR       = "";
     aLF       = "";
     aComillas = "";
     aMod      = "";
     aTabla    = "";
     aTitulo   = "";
     aLong     = "";

     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";

     nNume     = 0;
     {1}aContiene = "";
     &aMonedaRec = "";
     &eaVengoDe = "";
     swNoVale = 0;
     swAcaba = 0;
     swActividad = 0;
     swPintado = 0;
     aDes = "";
     swSigue = 0;
     aCar = "";
     aOrigen = "";
     aDestino = "";
     aDocRemoto = "";
     aDocServidor = "";
     aIPRemoto = "";
     aAbre = "";
     aEjecuta = "";
     nPausa = 0;
     aBase           = "";

     &eaDSMAC        = "";
     &eaUnidadBasico = "";
     &swQuitaTildes  = 0;
     &enEmpresa      = 0;
     &eaBloqueo      = "";
|FIN;

/*
|PROCESO PintaMoneda;  |TIPO 7;
     aPrograma = Control;  |QBF aPrograma;

     |DBASE aDef;  |QBF aDef;
     aDef   = aDef + "def/" + aPrograma + ".mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aFichero   = #0#aQueQuiero#;
     nTCampo    = aFichero;
     nTCampo    = nTCampo - 1;
     nSwHay     = 0;
     |PARA nCampo = 0;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aQueQuiero   = "|C" + (("000" + nCampo) % -103) + "NOMBRE";
           aNombreCampo = (#0#aQueQuiero# + (" " * 20)) % 120;
           |QBF aNombreCampo;
           |SI aNombreCampo = "***MONEDA***";
               nSwHay = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwHay = 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     IaMoneda = aMoneda1<-;
     |ESPECIFICA "MODO_VER_EURO", aMoneda;

     |SI EURODB ! 0;
         |SI aMoneda2 = "0";
             #0nCampo = "EUROS";
         |SINO;
             #0nCampo = "PESETAS";
         |FINSI;
     |SINO;
         |SI aMoneda2 = "0";
             #0nCampo = "PESETAS";
         |SINO;
             #0nCampo = "EUROS";
         |FINSI;
     |FINSI;

     |PINTA #0nCampo;
     eaMoneda = #0nCampo;

     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO ConverMoneda;
     enCanti = enCanti ! EURODB;
     |SI EURODB ! 0;
         |SI eaMoneda = "PESETAS";
             enCanti = ((enCanti * 166.386) ! 0);
         |SINO;
             |SI enSwTrata = 0;  enCanti = enCanti * 100;  |FINSI;
         |FINSI;
     |SINO;
         |SI eaMoneda = "EUROS  ";
             enCanti = ((enCanti / 166.386) ! 2) * 100;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ConverMoneda2;
     |SI EURODB ! 0;
         |SI eaMoneda = "PESETAS";
             aMonedaRec = "EUROS  ";
         |ACABA;
         |FINSI;
         |SI eaMoneda = "EUROS  ";
             aMonedaRec = "PTAS.";
             enCanti = ((enCanti * 166.386) ! 0);
         |FINSI;
     |SINO;
         |SI eaMoneda = "PESETAS";
             aMonedaRec = "EUROS  ";
             enCanti = ((enCanti / 166.386) ! 2);
         |ACABA;
         |FINSI;
         |SI eaMoneda = "EUROS  ";
             aMonedaRec = "PTAS.";
         |FINSI;
     |FINSI;
|FPRC;
*/

|PROCESO QuitaRaros;
   aLongRar = aCadena % 0; nLongRar = aLongRar; aAlfaRar2 = "";
   |PARA nContRar1 = 1; |SI nContRar1 [ nLongRar; |HACIENDO nContRar1 = nContRar1 + 1;
      CalcRar1 = (nContRar1 * 100) + 1; aAlfaRar1  = aCadena % CalcRar1;
      |SI aAlfaRar1 = " ";                     |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 ] "A"; |Y aAlfaRar1 [ "Z"; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 ] "a"; |Y aAlfaRar1 [ "z"; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 ] "0"; |Y aAlfaRar1 [ "9"; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "."; |O aAlfaRar1 = ","; |O aAlfaRar1 = ";"; |O aAlfaRar1 = ":";
       |O aAlfaRar1 = "_"; |O aAlfaRar1 = "'"; |O aAlfaRar1 = "-";
          |VETE Sigue1;
      |FINSI;
      |SI swQuitaTildes = 1;
           |SI aAlfaRar1 = " ";  aAlfaRar1 = "a";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "‚";  aAlfaRar1 = "e";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "¡";  aAlfaRar1 = "i";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "¢";  aAlfaRar1 = "o";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "£";  aAlfaRar1 = "u";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "¥";  aAlfaRar1 = "N";   |VETE Sigue1;|FINSI;

           |SI aAlfaRar1 = "Á";  aAlfaRar1 = "A";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "É";  aAlfaRar1 = "E";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "Í";  aAlfaRar1 = "I";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "Ó";  aAlfaRar1 = "O";   |VETE Sigue1;|FINSI;
           |SI aAlfaRar1 = "Ú";  aAlfaRar1 = "U";   |VETE Sigue1;|FINSI;
      |FINSI;

      |SI aAlfaRar1 = "¥"; aAlfaRar1 = &"0209"; |VETE Sigue1; |FINSI;
      ||SI aAlfaRar1 = "¤"; |O aAlfaRar1 = "ñ"; aAlfaRar1 = &0241; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "¤"; |O aAlfaRar1 = "ñ"; aAlfaRar1 = &0164; |VETE Sigue1; |FINSI;
      ||SI aAlfaRar1 = " "; |O aAlfaRar1 = "á"; aAlfaRar1 = &0225; |VETE Sigue1; |FINSI;
      ||SI aAlfaRar1 = "‚"; |O aAlfaRar1 = "é"; aAlfaRar1 = &0233; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = " "; |O aAlfaRar1 = "á"; aAlfaRar1 = &0160; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "‚"; |O aAlfaRar1 = "é"; aAlfaRar1 = &0130; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "¡"; aAlfaRar1 = &0237; |VETE Sigue1;|FINSI;
      |SI aAlfaRar1 = "¢"; aAlfaRar1 = &0243; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "£"; aAlfaRar1 = &0250; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "§"; aAlfaRar1 = &0176; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "¦"; aAlfaRar1 = &0170; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "¨"; aAlfaRar1 = &0191; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "€"; aAlfaRar1 = &0199; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "‡"; aAlfaRar1 = &0231; |VETE Sigue1; |FINSI;
      |SI aAlfaRar1 = "&"; aAlfaRar1 = " ";   |VETE Sigue1; |FINSI;


      aAlfaRar = " ";
      |ET Sigue1;
      aAlfaRar2 = aAlfaRar2 + aAlfaRar1;
   |SIGUE;
   aCadena = aAlfaRar2;
|FPRC;

|PROCESO PintaAyuda; |TIPO 7;
   |ABRE #labcontr;
   |LEE 000#labcontr.p;
   |SI FSalida ! 0; |DDEFECTO #labcontr; |FINSI;
   |CIERRA #labcontr;

   |MODULO aMod; |QBF aMod; nCampo = Campo;
   |SI eaVengoDe ! "";
          aMod = eaVengoDe;
   |FINSI;
     |SI aMod = "agidanif";
        aMod = "labtraba";
     |FINSI;
   |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
      |SI #labcontr#55 = "S";
         |SI nCampo = 6;  aAlfa = "    <F3> Seleccione poblacion";        |FINSI;
         |SI nCampo = 12; aAlfa = "    <F3> Seleccione titulacion";       |FINSI;
         |SI nCampo = 33; aAlfa = "    <F3> Seleccione grupo cotizacion"; |FINSI;
         |SI nCampo = 73; aAlfa = "    <F3> Seleccione nivel formacion";  |FINSI;
         |SI nCampo = 76; aAlfa = "    <F3> Seleccione pais nacimiento. (Solo extranjeros)";  |FINSI;
      |SINO;
         |SI nCampo = 6;  aAlfa = "    Localidad.";          |FINSI;
         |SI nCampo = 12; aAlfa = "    Nivel de estudios.";   |FINSI;
         |SI nCampo = 33; aAlfa = "    Grupo de cotizacion."; |FINSI;
         |SI nCampo = 73; aAlfa = "    Codigo de nivel de estudios (0-9).";  |FINSI;
         |SI nCampo = 76; aAlfa = "    <F3> Seleccione pais nacimiento. (Solo extranjeros)"; |FINSI;
      |FINSI;
   |FINSI;
   |SI aMod = "labempre"; |O aMod = "nomw0002";
      |SI nCampo = 2;  aAlfa = "    <F3> Seleccione actividad";        |FINSI;
      |SI nCampo = 12;  aAlfa = "    <F3> Seleccione actividad";        |FINSI;
      |SI #labcontr#55 = "S";
         |SI nCampo = 22;  aAlfa = "    <F3> Seleccione Administracion";   |FINSI;
      |SINO;
         || SI nCampo = 2;  aAlfa = "    <F3> Seleccione actividad";        |FINSI;
         || SI nCampo = 12;  aAlfa = "    Clave actividad.";                 |FINSI;
         |SI nCampo = 22;  aAlfa = "    Administracion hacienda publica."; |FINSI;
      |FINSI;
   |FINSI;
   |SI aMod = "labcentr"; |O aMod = "nomw0007";
      |SI nCampo = 18;  aAlfa = "    <F3> Seleccione Actividad";        |FINSI;
      |SI #labcontr#55 = "S";
         |SI nCampo = 6;  aAlfa = "    <F3> Seleccione poblacion";        |FINSI;
      |SINO;
         |SI nCampo = 6;  aAlfa = "    Localidad.";          |FINSI;
      |FINSI;
   |FINSI;
   |MENSA aAlfa;
|FPRC;

|PROCESO SacaVentana;
   swPintado = 0;
   swActividad = 0;
   nTecla = FSalida;

   |ABRE #labcontr;
   |LEE 000#labcontr.p;
   |SI FSalida ! 0; |DDEFECTO #labcontr; |FINSI;
   |CIERRA #labcontr;

   |MODULO aMod; |QBF aMod; nCampo = Campo;

   aAlfa = aMod % 106;
   |SI aMod = "agidanif"; |O aAlfa = "labcon";
        aMod = "labtraba";
   |FINSI;

   |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
       |SI nCampo = 76; |O nCampo = 19; |O nCampo = 12; |O nCampo = 73;
          |VETE pasadelcontrol;
       |FINSI;
   |FINSI;

   |SI aMod = "labempre"; |Y nCampo = 12;
          |VETE pasadelcontrol2;
   |FINSI;

   |SI aMod = "labacu14"; |Y nCampo = 33;
          |VETE pasadelcontrol2;
   |FINSI;

   |SI aMod = "nomw0002"; |Y nCampo = 2;
          |VETE pasadelcontrol2;
   |FINSI;

   |SI aMod = "labcentr"; |O aMod = "nomw0007";
          |SI nCampo = 18;
               |VETE pasadelcontrol;
          |FINSI;
   |FINSI;

     |SI aMod = "laborn11"; |O aMod = "laborn01";
          |SI aMod = "laborn11";
               nModo = 2;          || para que cargue la tabla desde labornet
          |FINSI;
          |SI aMod = "laborn01";
               nModo = 1;          || desde labornet cuando se accede a la
          |FINSI;                  || pantalla del trab. venia cargado a 60
          |VETE pasadelcontrol2;
     |FINSI;

   |SI #labcontr#55 = "N"; |ACABA; |FINSI;

   |ET pasadelcontrol;

   |BLIN 4;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 2; |Y nTecla ! 11; |ACABA; |FINSI;

   |ET pasadelcontrol2;

   |MODULO aMod; |QBF aMod; nCampo = Campo;
   aAlfa = aMod % 106;
   |SI aMod = "agidanif"; |O aAlfa = "labcon";
        aMod = "labtraba";
   |FINSI;
   aTabla = ""; nNumCmps = 0;
   |SI aMod = "nomcalcu"; aMod = "labcerti"; |FINSI;        || labornet
     |SI eaVengoDe ! "";
          aMod = eaVengoDe;
     |FINSI;
   |SI aMod = "labcentr"; |O aMod = "nomw0007";
      |SI nCampo = 6;
         aTabla = "tdpmunic.txt"; nNumCmps = 2;
         nPos1  = 1414; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione la poblacion ";
      |FINSI;
      |SI nCampo = 18;
         aTabla = "sacecotc.txt"; nNumCmps = 2;
         nPos1  = 1524; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione la actividad ";
      |FINSI;
   |FINSI;
   |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
      |SI nCampo = 6;
         aTabla = "tdpmunic.txt"; nNumCmps = 2;
         nPos1  = 1414; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione la poblacion ";
      |FINSI;
      |SI nCampo = 12;
         || aTabla = "stiacatc.txt"; nNumCmps = 2;
         aTabla = "thitiaca.txt"; nNumCmps = 2;
         nPos1  = 1714; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione la titulacion ";
      |FINSI;
      |SI nCampo = 19;
         || aTabla = "socupatc.txt"; nNumCmps = 2;
         aTabla = "taiclaoc.txt"; nNumCmps = 2;
         nPos1  = 1714; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione la profesion ";
      |FINSI;
      |SI nCampo = 33;
         aTabla = "tfggrcot.txt"; nNumCmps = 4;
         nPos1  = 1646; nPos2 = 2380; nCmp = 0;
         aTitulo = " Seleccione el grupo de cotizacion ";
      |FINSI;
      |SI nCampo = 73;
         aTabla = "tbonvfor.txt"; nNumCmps = 2;
         nPos1  = 1244; nPos2 = 2380; nCmp = 0;
         aTitulo = " Seleccione el nivel de formacion   ";
      |FINSI;
      |SI nCampo = 76;
         aAlfa = #Fichero@#nCampo#; |QBF aAlfa;
         aAlfa = aAlfa % 0101;
         |SI nTecla ! 11;
            |SI aAlfa < "0"; |O aAlfa > "9"; |ACABA; |FINSI;
         |FINSI;
         aTabla = "spaisxtc.txt"; nNumCmps = 2;
         nPos1  = 1614; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione el pais de nacimiento";
      |FINSI;
   |FINSI;
   |SI aMod = "labempre"; |O aMod = "nomw0002";
      |SI nCampo = 2;
         aTabla = "sacecotc.txt"; nNumCmps = 2;
         nPos1  = 1524; nPos2 = 2380; nCmp = 0;
         aTitulo = " Seleccione la actividad ";
      |FINSI;
      |SI nCampo = 12;
         aTabla = "sacecotc.txt"; nNumCmps = 2;
         nPos1  = 1524; nPos2 = 2380; nCmp = 0;
         aTitulo = " Seleccione la actividad ";
      |FINSI;
      |SI nCampo = 22;
         aTabla = "tdpmunic.txt"; nNumCmps = 2;
         nPos1  = 1824; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione la Administracion de hacienda publica";
      |FINSI;
      |SI nCampo =  1; |C_M #Fichero@#nCampo#, 1, "N"; |ACABA; |FINSI;
      |SI nCampo = 11; |C_M #Fichero@#nCampo#, 1, "N"; |ACABA; |FINSI;
      |SI nCampo = 21; |C_M #Fichero@#nCampo#, 1, "N"; |ACABA; |FINSI;
      |SI nCampo = 24; |C_M #Fichero@#nCampo#, 1, "N"; |ACABA; |FINSI;
   |FINSI;
   |SI aMod = "labacu14";
      |SI nCampo = 33;
         aTabla = "sacecotc.txt"; nNumCmps = 2;
         nPos1  = 1524; nPos2 = 2380; nCmp = 0;
         aTitulo = " Seleccione la actividad ";
      |FINSI;
   |FINSI;
   |SI aMod = "laborn11"; |O aMod = "laborn01";
      |SI nCampo = 21; |O nCampo = 16;
         aAlfa = #Fichero@#nCampo#; |QBF aAlfa;
         aAlfa = aAlfa % 0101;
         /*
         |SI nTecla ! 18;
            |SI aAlfa < "0"; |O aAlfa > "9"; |ACABA; |FINSI;
         |FINSI;
         */
         aTabla = "spaisxtc.txt"; nNumCmps = 2;
         nPos1  = 1614; nPos2 = 2380; nCmp = 1;
         aTitulo = " Seleccione el pais de nacimiento";
      |FINSI;
   |FINSI;

   |SI nNumCmps ! 0;
      nSwLectura = 0;
      |ABRE #labcotmp; |ABRE #labtabla;
      #labtabla#0 = aTabla;
      |LEE 000#labtabla.=;
      |SI FSalida ! 0;
         nSwLectura = 1;
         |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla;
         aContiene1 = aAlfa; |ESPECIFICA "MD5", aContiene;
         |DDEFECTO #labtabla;
         aAlfa = FSalida;     |QBF aAlfa;
         #labtabla#0 = aTabla;
         #labtabla#1 = aAlfa;
         |GRABA 020#labtabla.c;
      |SINO;
         |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla;
         aContiene1 = aAlfa; |ESPECIFICA "MD5", aContiene;
         aAlfa1 = FSalida;     |QBF aAlfa1;
         aAlfa2 = #labtabla#1; |QBF aAlfa2;
         |SI aAlfa1 ! aAlfa2; nSwLectura = 1; |FINSI;
      |FINSI;

      nSwNuevo = 0;
/*
      aAlfa1 = aTabla; |QBF aAlfa1; aAlfa1 = aAlfa1 - ".txt";
      |DBASE aAlfa; aAlfa = aAlfa + "def/" + aAlfa1 + ".mas";
      |XABRE "E", aAlfa, nHandle;
      |SI FSalida < 0;
         aAlfa = "SELECT * FROM labcotmp INTO " + aAlfa1 + ".def WHERE"; |SQL aAlfa;
         nSwNuevo = 1;
      |SINO;
         nSwNuevo = 0;
      |FINSI;
*/
      aAlfa1 = aTabla; |QBF aAlfa1; aAlfa1 = aAlfa1 - ".txt";
      |DBASE aAlfa; aAlfa = aAlfa + "def/" + aAlfa1 + ".mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |SI nSwNuevo = 1; |O nSwLectura = 1; |DELINDEX #Referen@; |FINSI;
         |ABRE #Referen@;
         |LEE 000#Referen@.p;
         |SI nSwLectura = 1; |O FSalida ! 0;
            aLF = &13; aComillas = &34; aCR = &10;
            |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla;
            aAlfa = "rb  " + aAlfa;
            |FABRE aAlfa;
            |SI FSalida ] 0;
               nHandle = FSalida;
               |HAZ Lectura;
            |FINSI;
            FSalida = nHandle; |FCIERRA FSalida;
         |FINSI;

         |DFICE aAlfa; |PATH_DAT #500 aAlfa;
         |ABRE #labvaltb;
         aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
         |QBF aAlfa; aAlfa = aAlfa % -108;
         |DDEFECTO #labvaltb;
         #labvaltb#0 = aAlfa;
         #labvaltb#1 = nCampo;
         aAlfa = "|K000"; nCont = 5; aAlfa = #Fichero@#aAlfa#;
         aAlfa = aAlfa % 0499;
         |PARA; |SI aAlfa ! ""; |HACIENDO;
            aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc1 = aAlfa1;
            #labvaltb#nCont# = #Fichero@#nCalc1#;
            nCont = nCont + 1;
         |SIGUE;
         |LEE 101#labvaltb.=;
         |SI FSalida = 0;
            |SI nCmp = 0; |SELECT #1#Referen@; |FINSI;
            |SI nCmp = 1; |SELECT #2#Referen@; |FINSI;
            #Referen@#nCmp# = #labvaltb#4;
            |SI nModo = 1; |Y nTecla ! 11;
               aAlfa = #labvaltb#4; |QBF aAlfa;
               aLong = aAlfa % 0; nLong1 = aLong; nLong1 = nLong1 + 100;
               aAlfa = #Fichero@#nCampo#; |QBF aAlfa;
               aLong = aAlfa % 0; nLong2 = aLong; nLong2 = nLong2 + 100;
               |SI nLong1 ] nLong2;
                  nLong = nLong2;
               |SINO;
                  nLong = nLong1;
               |FINSI;
               aAlfa = #labvaltb#4;       |QBF aAlfa; aAlfa1 = aAlfa % nLong;
               aAlfa = #Fichero@#nCampo#; |QBF aAlfa; aAlfa2 = aAlfa % nLong;
               |SI aAlfa1 ! aAlfa2; |O nLong = 100; #Referen@#nCmp# = #labvaltb#4; |FINSI;
            |FINSI;
         |SINO;
            |SI nCmp = 0; |SELECT #1#Referen@; |FINSI;
            |SI nCmp = 1; |SELECT #2#Referen@; |FINSI;
            #Referen@#nCmp# = #Fichero@#nCampo#;
            |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
               |SI nCampo = 76;
                  aAlfa = #Fichero@#nCampo#;
                  aAlfa = aAlfa % 0599;
                  #Referen@#nCmp# = aAlfa;
               |FINSI;
               |SI nCampo = 33;
                  aAlfa = #Fichero@#nCampo#;
                  aAlfa = ("00" + aAlfa) % -102;
                  #Referen@#nCmp# = aAlfa;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI aMod = "labempre"; |O aMod = "nomw0002";
            |SI nCampo = 12;
                  aAlfa = #Fichero@#128#;
            |FINSI;
            |SI nCampo = 2;
                  aAlfa = #Fichero@#96#;
            |FINSI;
             aAlfa = aAlfa % 102;
             #Referen@#nCmp# = aAlfa;
             swActividad = 1;
         |FINSI;

         |SI nModo = 1;
            |SI nTecla = 11; |O swActividad = 1;
               |LEE 000#Referen@.];
            |SINO;
               |LEE 000#Referen@.=;
               |SI FSalida ! 0;
                  |MENAV "    Valor erroneo";
                  |LEE 000#Referen@.];
               |SINO;
                  |CIERRA #labvaltb;
                  |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
                  |ACABA;
               |FINSI;
            |FINSI;
         |SINO;
            |SI nTecla = 11; |O swActividad = 1;
               |LEE 000#Referen@.];
            |FINSI;
         |FINSI;

         |SI swActividad = 1;
              nCmp = 1;
         |FINSI;

         nCalc = (nPos1 * 10000) + nPos2;
         ||PUSHV nCalc;
         nModo = 4 + 8 + 16 + 32;
         |CONSULTA_CLAVE #1#Referen@;
         nSalida = FSalida;
         |SI nSalida = 0;
            aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
            |QBF aAlfa; aAlfa = aAlfa % -108;
            #labvaltb#0 = aAlfa;
            #labvaltb#1 = nCampo;
            aAlfa = "|K000"; aAlfa = #Fichero@#aAlfa#; nCont = 5;
            aAlfa = aAlfa % 0499;
            |PARA; |SI aAlfa ! ""; |HACIENDO;
               aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc1 = aAlfa1;
               #labvaltb#nCont# = #Fichero@#nCalc1#;
               nCont = nCont + 1;
            |SIGUE;
            |LEE 101#labvaltb.=;
            |SI FSalida ! 0;
               |DDEFECTO #labvaltb;
               aAlfa = "|DEF"; aAlfa = #Fichero@#aAlfa#;
               |QBF aAlfa; aAlfa = aAlfa % -108;
               #labvaltb#0 = aAlfa;
               #labvaltb#1 = nCampo;
               aAlfa = "|K000"; nCont = 5; aAlfa = #Fichero@#aAlfa#;
               aAlfa = aAlfa % 0499;
               |PARA; |SI aAlfa ! ""; |HACIENDO;
                  aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc1 = aAlfa1;
                  #labvaltb#nCont# = #Fichero@#nCalc1#;
                  nCont = nCont + 1;
               |SIGUE;
               |GRABA 020#labvaltb.b;
            |FINSI;
            aAlfa = "|C" + (("000" + nCampo) % -103) + "TIPO";     aAlfa = #Fichero@#aAlfa#;
            #labvaltb#2 = aAlfa;
            aAlfa = "|C" + (("000" + nCampo) % -103) + "LONGITUD"; aAlfa = #Fichero@#aAlfa#;
            #labvaltb#3 = aAlfa;
            |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
               |SI nCampo = 9;
                  aAlfa = #Referen@#nCmp#; |QBF aAlfa;
                  aAlfa = aAlfa % -103;
                  #labvaltb#4 = aAlfa;
               |SINO;
                  #labvaltb#4 = #Referen@#nCmp#;
               |FINSI;
            |SINO;
               #labvaltb#4 = #Referen@#nCmp#;
            |FINSI;

            |GRABA 020#labvaltb.a; |LIBERA #labvaltb;
            aCadena = #Referen@#nCmp#; |HAZ QuitaRaros; #Referen@#nCmp# = aCadena;
            #Fichero@#Campo# = #Referen@#nCmp#; |PINTA #Fichero@#Campo#;

            |SI aMod = "labempre"; |O aMod = "nomw0002";
               |SI nCampo = 2;
                  aAlfa = #Referen@#0;
                  aAlfa = aAlfa % 102;
                  #Fichero@#1  = aAlfa; |PINTA #Fichero@#1;

                  aAlfa1 = #Referen@#0; |QBF aAlfa1;
                  aAlfa2 = #Referen@#nCmp#; |QBF aAlfa2;
                  aAlfa = aAlfa1 + ". " + aAlfa2;
                  #Fichero@#Campo# = aAlfa;
                  |PINTA #Fichero@#Campo#;
               |FINSI;
               |SI nCampo = 12;
                  aAlfa = #Referen@#0;
                  aAlfa = aAlfa % 102;
                  #Fichero@#11 = aAlfa; |PINTA #Fichero@#11;

                  aAlfa1 = #Referen@#0; |QBF aAlfa1;
                  aAlfa2 = #Referen@#nCmp#; |QBF aAlfa2;
                  aAlfa = aAlfa1 + ". " + aAlfa2;
                  #Fichero@#Campo# = aAlfa;
                  |PINTA #Fichero@#Campo#;
               |FINSI;
               |SI nCampo = 22;
                  #Fichero@#21 = #Referen@#0; |PINTA #Fichero@#21;
                  |ABRE #labprovi;
                  aAlfa = #Referen@#0; |QBF aAlfa;
                  aAlfa = ("00000" + aAlfa) % -105; aAlfa = aAlfa % 0102;
                  #labprovi#0 = aAlfa;
                  |LEE 000#labprovi.=;
                  |SI FSalida ! 0; |DDEFECTO #labprovi; |FINSI;
                  #Fichero@#24 = #labprovi#1; |PINTA #Fichero@#24;
                  |CIERRA #labprovi;
               |FINSI;
            |FINSI;
            |SI aMod = "labacu14";
               |SI nCampo = 33;
                  aAlfa = #Referen@#0;
                  #Fichero@#33 = aAlfa; |PINTA #Fichero@#33;

                  aAlfa2 = #Referen@#1; |QBF aAlfa2;
                  aAlfa = aAlfa2;
                  #Fichero@#34 = aAlfa;
                  |PINTA #Fichero@#34;
               |FINSI;
            |FINSI;
            |SI aMod = "labcentr"; |O aMod = "nomw0007";
               |SI nCampo = 18;
                  #Fichero@#18  = #Referen@#1; |PINTA #Fichero@#18;
                  #Fichero@#17 = #Referen@#0; |PINTA #Fichero@#17;
               |FINSI;
            |FINSI;
            |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
               |SI nCampo = 76;
                  aAlfa = #Referen@#nCmp#; |QBF aAlfa;
                  |SI aAlfa ! "ESPAÑA";
                     aAlfa1 = #Referen@#0; |QBF aAlfa1;
                     aAlfa = (("000" + aAlfa1) % -103) + " " + aAlfa;
                     #Fichero@#nCampo# = aAlfa; |PINTA #Fichero@#nCampo#;
                  |SINO;
                     #Fichero@#nCampo# = "ESPA¥A"; |PINTA #Fichero@#nCampo#;
                  |FINSI;
               |FINSI;
               |SI nCampo = 19;
                     aAlfa1 = #Referen@#0; |QBF aAlfa1;
                     #Fichero@#185# = aAlfa1; |PINTA #Fichero@#185#;
               |FINSI;
               |SI nCampo = 12;
                     aAlfa1 = #Referen@#0; |QBF aAlfa1;
                     aAlfa1 = aAlfa1 % 102;
                     #Fichero@#73# = aAlfa1;
                     |PINTA #Fichero@#73#;
               |FINSI;
            |FINSI;
            |SI aMod = "laborn11"; |O aMod = "laborn01";
               |SI nCampo = 21; |O nCampo = 16;
                  aAlfa = #Referen@#nCmp#; |QBF aAlfa;
                  |SI aAlfa ! "ESPAÑA";
                     aAlfa1 = #Referen@#0; |QBF aAlfa1;
                     aAlfa = (("000" + aAlfa1) % -103) + " " + aAlfa;
                     #Fichero@#nCampo# = aAlfa; |PINTA #Fichero@#nCampo#;
                  |SINO;
                     #Fichero@#nCampo# = "ESPA¥A"; |PINTA #Fichero@#nCampo#;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |ERROR;
         |FINSI;
         |CIERRA #labvaltb;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO Lectura;
   |MENSA "    Rellenando tabla .....";
   nCampo1 = 0; nAbierto = 0; nPosic = 0;
   |DDEFECTO #Referen@;
   aAlfa = nHandle + " 250"; |FLEE aAlfa;
   |PARA; |SI FSalida > 0; |HACIENDO;
      aAlfa1 = aAlfa - aLF;
      |PARA; |SI FSalida ! 0; |HACIENDO;
         nCalc = ((FSalida / 100) ! 0) - 1; nPosic = nPosic + nCalc;
         |SI nCalc > 99;
            nCalc1 = 199; aAlfa1 = aAlfa % nCalc1; aAlfa = aAlfa - aAlfa1;
            nCalc = nCalc - 99;
         |SINO;
            aAlfa1 = "";
         |FINSI;
         nCalc = nCalc + 100; aAlfa2 = (aAlfa % nCalc);
         aAlfa1 = aAlfa1 + aAlfa2; aAlfa = aAlfa - aAlfa2;
         aAlfa2 = aLF + aCR;     aAlfa = aAlfa - aAlfa2; nPosic = nPosic + 2;
         nCampo1 = 0;
         aAlfa2 = aAlfa1 - ";";
         |PARA; |SI FSalida ! 0; |HACIENDO;
            nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2 = aAlfa1 % nCalc;
            aLong = aAlfa1 % 0; nLong = aLong;
            |SI nLong > 99;
               nCalc1 = ((((FSalida / 100) ! 0) + 1) * 100) + 99; aAlfa3 = aAlfa1 % nCalc1;
               aAlfa1 = aAlfa1 - aAlfa3;                    aAlfa1 = aAlfa1 % nCalc1;
               aAlfa1 = aAlfa3 + aAlfa1;
            |SINO;
               nCalc = FSalida + 198;                       aAlfa1 = aAlfa1 % nCalc;
            |FINSI;
            aAlfa2 = aAlfa2 - aComillas;
            |PARA; |SI FSalida ! 0; |HACIENDO;
               aAlfa2 = aAlfa2 - aComillas;
            |SIGUE;
            /*
            || esto lo quito porque se carga la tabla de actividades desde
            || el nomw0002 y no se que co¤o hace aqui
            |SI nCampo = 2; |O nCampo = 3;
               aAlfa2 = (aAlfa2 % 0702) + "." + (aAlfa2 % 0502) + "." (aAlfa2 % 0104);
            |FINSI;
            */
            #Referen@#nCampo1# = aAlfa2;
            nCampo1 = nCampo1 + 1;
            aAlfa2 = aAlfa1 - ";";
         |SIGUE;
         aAlfa1 = aAlfa1 - aComillas;
         |PARA; |SI FSalida ! 0; |HACIENDO;
            aAlfa1 = aAlfa1 - aComillas;
         |SIGUE;
         /*
         || esto lo quito porque se carga la tabla de actividades desde
         || el nomw0002 y no se que co¤o hace aqui
         |SI nCampo = 2; |O nCampo = 3;
            aAlfa1 = (aAlfa1 % 0702) + "." + (aAlfa1 % 0502) + "." (aAlfa1 % 0104);
         |FINSI;
         */
         aCadena = aAlfa1; |HAZ QuitaRaros; aAlfa1 = aCadena;
         #Referen@#nCampo1# = aAlfa1;
         |SI aMod ! "labparta"; |Y aMod ! "labta611"; |Y aMod ! "labparac";
         |Y aMod ! "nomvarca"; |Y aMod ! "labcerti"; |Y aMod ! "labcerag";
         |Y aMod ! "labacuer"; |Y aMod ! "labcon85"; |Y aMod ! "labcon86";
         |Y aMod ! "labacue2"; |Y aMod ! "labprorr";
              #Referen@#4 = aTabla;
         |FINSI;
         |GRABA 020#Referen@.n; |DDEFECTO #Referen@;
         aAlfa1 = aAlfa - aLF;
         |SI aAlfa1 = ""; FSalida = 0; |FINSI;
      |SIGUE;
      Pos = nPosic;
      aAlfa = nHandle + " 250"; |FLEE aAlfa;
   |SIGUE;
   |BLIN 4;
|FPRC;

|PROCESO CompDesBaja;
     || respeto lo que haya en la descripcion que haya podido cambiar
     || el usuario

     aDes = #Fichero@#nCampo#;
     aDes = aDes - aAlfa;
     |PARA; |SI; |HACIENDO;
          aCar = aDes % 101;
          |SI aCar = " "; |O aCar = "-";
               aDes = aDes - aCar;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     |QBF aDes;
     |SI aDes ! "";
          swSigue = 0;
     |FINSI;
|FPRC;

|PROCESO SacaVentana2;
     swPintado = 0;
     swNoVale = 0;
     nTecla = FSalida;

     |BLIN 4;

     |MODULO aMod; |QBF aMod; nCampo = Campo;
     aAlfa = aMod % 106;
     |SI aMod = "agidanif"; |O aAlfa = "labcon";
        aMod = "labtraba";
     |FINSI;
     |SI aMod = "labnct07"; |O aMod = "labacuer"; |O aMod = "labcon85";
     |O aMod = "labcon86"; |O aMod = "labacue2"; |O aMod = "labprorr";
          eaVengoDe = "";
     |FINSI;
     aTabla = ""; nNumCmps = 0;
     |SI eaVengoDe = "agidanif";   || para que si metemos datos personales
          eaVengoDe = "";          || no la liemos y coja el origen de
     |FINSI;                       || donde venga
     |SI eaVengoDe ! "";
          aMod = eaVengoDe;
     |FINSI;
     |SI aMod = "nomcalcu"; aMod = "labcerti"; |FINSI;        || labornet
     |SI aMod = "labparta"; |O aMod = "labta611";
     |O aMod = "laborn02"; |O aMod = "laborn12";
          |SI nCampo = 99;
               aTabla = "causaexc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el motivo de exclusion del censo (00 - incluido)";
          |FINSI;
     |FINSI;
     |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
          |SI nCampo = 73;
               aTabla = "tbonvfor.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
          |FINSI;
          |SI nCampo = 139;
               aTabla = "thitiaca.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
          |FINSI;
          |SI nCampo = 185;
               aTabla = "taiclaoc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
          |FINSI;
     |FINSI;
     |SI aMod = "labparac";
          |SI nCampo = 43;
               aTabla = "sacecotc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de actividad";
          |FINSI;
          |SI nCampo = 74;
               aTabla = "labpar01.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de lugar del accidente";
          |FINSI;
          |SI nCampo = 76;
               aTabla = "labpar02.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de proceso";
          |FINSI;
          |SI nCampo = 78;
               aTabla = "labpar03.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de actividad";
          |FINSI;
          |SI nCampo = 80; |O nCampo = 84; |O nCampo = 88;
               aTabla = "labpar08.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de agente";
          |FINSI;
          |SI nCampo = 82;
               aTabla = "labpar04.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de desviacion";
          |FINSI;
          |SI nCampo = 86;
               aTabla = "labpar05.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de forma de contacto";
          |FINSI;
          |SI nCampo = 27;
               aTabla = "labpar07.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de descripcion de la lesion";
          |FINSI;
          |SI nCampo = 28;
               aTabla = "labpar06.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de la parte del cuerpo lesionada";
          |FINSI;
          |SI nCampo = 48;
               aTabla = "spaisxtc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de pais";
          |FINSI;
          |SI nCampo = 71;
               aTabla = "sacecotc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de actividad economica";
          |FINSI;
          |SI nCampo = 96;
               aTabla = "taiclaoc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el codigo de ocupacion";
          |FINSI;
     |FINSI;
     |SI aMod = "labcerti"; |O aMod = "labcerag";
          |SI nCampo = 104; |O nCampo = 123;
               aTabla = "taiclaoc.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
          |FINSI;
          |SI nCampo = 78; |O nCampo = 98;
               aTabla = "motibaj2.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Indique el motivo de la baja ";
          |FINSI;
     |FINSI;

     |SI aMod = "labacuer"; |O aMod = "labcon85"; |O aMod = "labcon86";
     |O aMod = "labacue2"; |O aMod = "labprorr";
          |SI #labcontr#67 ! "S";
               |ACABA;
          |FINSI;
          |SI nCampo = 27;
               aTabla = "ocupaedu.txt"; nNumCmps = 2;
               nPos1  = 1414; nPos2 = 2380; nCmp = 1;
               aTitulo = " Tabla de ocupaciones";
          |FINSI;
     |FINSI;

     |SI aMod = "laborn11"; |O aMod = "laborn01";
          |SI nCampo = 230; |O nCampo = 232;
               |SI nCampo = 230;
                    aTabla = "tbonvfor.txt"; nNumCmps = 2;
                    nPos1  = 1244; nPos2 = 2380; nCmp = 0;
                    aTitulo = " Seleccione el nivel de formacion   ";
               |FINSI;
               |SI nCampo = 232;
                    aTabla = "taiclaoc.txt"; nNumCmps = 2;
                    nPos1  = 1714; nPos2 = 2380; nCmp = 0;
                    aTitulo = " Seleccione la profesion ";
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nNumCmps ! 0;
          nSwLectura = 0;
          |ABRE #labcotmp; |ABRE #labtabla;
          #labtabla#0 = aTabla;
          |LEE 000#labtabla.=;
          |SI FSalida ! 0;
               nSwLectura = 1;
               |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla;
               aContiene1 = aAlfa; |ESPECIFICA "MD5", aContiene;
               |DDEFECTO #labtabla;
               aAlfa = FSalida;     |QBF aAlfa;
               #labtabla#0 = aTabla;
               #labtabla#1 = aAlfa;
               |GRABA 020#labtabla.c;
          |SINO;
               |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla;
               aContiene1 = aAlfa; |ESPECIFICA "MD5", aContiene;
               aAlfa1 = FSalida;     |QBF aAlfa1;
               aAlfa2 = #labtabla#1; |QBF aAlfa2;
               |SI aAlfa1 ! aAlfa2;
                    nSwLectura = 1;
                    #labtabla#0 = aTabla;
                    #labtabla#1 = aAlfa1;
                    |GRABA 020#labtabla.a;
               |FINSI;
          |FINSI;

          nSwNuevo = 0;

          aAlfa1 = aTabla; |QBF aAlfa1; aAlfa1 = aAlfa1 - ".txt";
          |DBASE aAlfa; aAlfa = aAlfa + "def/" + aAlfa1 + ".mas";
          |CARGA_DEF aAlfa, Referen@;
          |SI FSalida = 0;
               |SI nSwNuevo = 1; |O nSwLectura = 1; |DELINDEX #Referen@; |FINSI;
               |ABRE #Referen@;
               |LEE 000#Referen@.p;
               |SI nSwLectura = 1; |O FSalida ! 0;
                    aLF = &13; aComillas = &34; aCR = &10;
                    |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla;
                    aAlfa = "rb  " + aAlfa;
                    |FABRE aAlfa;
                    |SI FSalida ] 0;
                         nHandle = FSalida;
                         |HAZ Lectura;
                    |FINSI;
                    FSalida = nHandle; |FCIERRA FSalida;
               |FINSI;

               nCalc = (nPos1 * 10000) + nPos2;
               ||PUSHV nCalc;
               ||ATRI R; |PINTA nPos1, aTitulo; |ATRI N; nPos1 = nPos1 + 100;
               nModo = 4 + 8 + 16 + 32;

               ||LINEAL_SIMPLE #1#Referen@, nModo, nPos1, nPos2, NULL, NULL, NULL;
               ||aTitulo = "    " + aTitulo; |MENSA aTitulo;

               #Referen@#0 = #Fichero@#nCampo#;
               |SI aMod = "labparac";
                    |SI nCampo = 43;
                         aAlfa = #Fichero@#nCampo#;
                         aAlfa = aAlfa % 103;
                         #Referen@#0 = aAlfa;
                    |FINSI;
                    |SI nCampo = 76; |O nCampo = 78; |O nCampo = 82;
                    |O nCampo = 86;  |O nCampo = 28;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
                         #Referen@#0 = aAlfa;
                    |FINSI;
                    |SI nCampo = 74; |O nCampo = 27; |O nCampo = 48;
                    |O nCampo = 71;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "000" + aAlfa; aAlfa = aAlfa % -103;
                         #Referen@#0 = aAlfa;
                    |FINSI;
                    |SI nCampo = 80; |O nCampo = 84; |O nCampo = 88;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "00000000" + aAlfa; aAlfa = aAlfa % -108;
                         #Referen@#0 = aAlfa;
                    |FINSI;
               |FINSI;
               |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
                    |SI nCampo = 184;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = aAlfa % 102;
                         #Referen@#0 = aAlfa;
                    |FINSI;
               |FINSI;
               |SI aMod = "labcerti"; |O aMod = "labcerag";
                    |SI nCampo = 78; |O nCampo = 98;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
                         #Referen@#0 = aAlfa;
                    |FINSI;
                    |SI nCampo = 104; |O nCampo = 123;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
                         #Referen@#0 = aAlfa;
                    |FINSI;
               |FINSI;
               |SI aMod = "laborn12"; |O aMod = "laborn02";
                    |SI nCampo = 9;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
                         #Referen@#0 = aAlfa;
                    |FINSI;
               |FINSI;
               |SI aMod = "laborn11"; |O aMod = "laborn01";
                    |SI nCampo = 230;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
                         #Referen@#0 = aAlfa;
                    |FINSI;
                    |SI nCampo = 232;
                         aAlfa = #Fichero@#nCampo#;
                         |QBF aAlfa;
                         aAlfa = "0000" + aAlfa; aAlfa = aAlfa % -104;
                         #Referen@#0 = aAlfa;
                    |FINSI;
               |FINSI;
               |SI aMod = "labnct07";
                    aAlfa = #Fichero@#nCampo#;
                    |QBF aAlfa;
                    aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
                    #Referen@#0 = aAlfa;
               |FINSI;
               |LEE 000#Referen@.=;
               |SI FSalida ! 0;
                    swNoVale = 1;
               |FINSI;
               |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
                    |SI nCampo ! 185
                         swNoVale = 0;
                    |FINSI;
               |FINSI;
               |SI nCampo = 104; |O nCampo = 123;
               |O aMod = "laborn11"; |O aMod = "laborn01";
               |O aMod = "laborn12"; |O aMod = "laborn02";
                    swNoVale = 0;  || dejo poner lo que quieran, no obligo
               |FINSI;

               |SI swNoVale = 1; |O nTecla = 11;
                    |CONSULTA_CLAVE #1#Referen@;
                    nSalida = FSalida;
                    ||POPV; |BLIN 4;
               |FINSI;

               |SI FSalida = 0;
                    |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
                         |SI nCampo = 184;        || motivo de baja
                              swSigue = 1;
                              |HAZ CompDesBaja;
                              |SI swSigue = 0;
                                   |ACABA;
                              |FINSI;

                              aAlfa1 = #Referen@#0; |QBF aAlfa1;
                              aAlfa2 = #Referen@#1; |QBF aAlfa2;
                              aAlfa = aAlfa1 + " - " + aAlfa2;
                              #Fichero@#nCampo# = aAlfa;
                              |PINTA #Fichero@#nCampo#;
                              swPintado = 1;
                         |FINSI;
                    |FINSI;
                    |SI aMod = "labtraba"; |O aMod = "nomw0003"; |O aMod = "nomw0004";
                         |SI nCampo = 73;         || nivel formativo
                              aAlfa = #Referen@#0;
                              #Fichero@#73 = aAlfa;
                              aAlfa = #Referen@#1;
                              #Fichero@#140 = aAlfa;
                              |PINTA #Fichero@#73;
                              |PINTA #Fichero@#140;
                         |FINSI;
                         |SI nCampo = 139;         || titulacion academica
                              aAlfa = #Referen@#0;
                              #Fichero@#139 = aAlfa;
                              aAlfa = #Referen@#1;
                              #Fichero@#12 = aAlfa;
                              |PINTA #Fichero@#139;
                              |PINTA #Fichero@#12;
                         |FINSI;
                         |SI nCampo = 185;         || profesion
                              aAlfa = #Referen@#0;
                              #Fichero@#185 = aAlfa;
                              aAlfa = #Referen@#1;
                              #Fichero@#19 = aAlfa;
                              |PINTA #Fichero@#185;
                              |PINTA #Fichero@#19;
                         |FINSI;
                    |FINSI;
                    |SI aMod = "labparta"; |O aMod = "labta611";
                         aAlfa = #Referen@#1;
                         #Fichero@#5 = aAlfa;
                         |PINTA #Fichero@#5;
                    |FINSI;
                    |SI aMod = "labparac";
                         aAlfa = #Referen@#0;
                         nNume = #Referen@#0;
                         |SI nCampo = 74; |O nCampo = 76; |O nCampo = 78;
                         |O nCampo = 80;  |O nCampo = 82; |O nCampo = 84;
                         |O nCampo = 86;  |O nCampo = 88; |O nCampo = 48;
                         |O nCampo = 71;  |O nCampo = 96; |O nCampo = 43;
                              |SI nCampo = 71; |O nCampo = 43;
                                   aAlfa = aAlfa % 103;
                              |FINSI;
                              nCampo1 = nCampo + 1;
                              |SI nCampo = 80; |O nCampo = 84;  |O nCampo = 88;
                              |O nCampo = 71; |O nCampo = 43;
                                   #Fichero@#nCampo# = aAlfa;
                              |SINO;
                                   #Fichero@#nCampo# = nNume;
                              |FINSI;
                              |PINTA #Fichero@#nCampo#;
                              #Fichero@#nCampo1#  = #Referen@#1;
                              |PINTA #Fichero@#nCampo1#;
                              swPintado = 1;
                         |FINSI;
                         |SI nCampo = 27; |O nCampo = 28;
                              nCampo1 = nCampo + 64;
                              #Fichero@#nCampo# = nNume;
                              |PINTA #Fichero@#nCampo#;
                              #Fichero@#nCampo1# = #Referen@#1;
                              |PINTA #Fichero@#nCampo1#;
                              swPintado = 1;
                         |FINSI;
                    |FINSI;
                    |SI aMod = "laborn11"; |O aMod = "laborn01";
                         |SI nCampo = 230; |O nCampo = 232;
                              aAlfa1 = #Referen@#0; |QBF aAlfa1;
                              aAlfa2 = #Referen@#1; |QBF aAlfa2;
                              #Fichero@#nCampo# = aAlfa1;
                              |PINTA #Fichero@#nCampo#;
                              nCampo1 = nCampo + 1;
                              #Fichero@#nCampo1# = aAlfa2;
                              |PINTA #Fichero@#nCampo1#;
                              swPintado = 1;
                         |FINSI;
                    |FINSI;
                    |SI aMod = "laborn12"; |O aMod = "laborn02";
                         aAlfa1 = #Referen@#0; |QBF aAlfa1;
                         aAlfa2 = #Referen@#1; |QBF aAlfa2;
                         aAlfa = aAlfa1 + " - " + aAlfa2;
                         #Fichero@#nCampo# = aAlfa;
                         |PINTA #Fichero@#nCampo#;
                         swPintado = 1;
                    |FINSI;
                    |SI aMod = "labnct07";
                         aAlfa = #Referen@#0;
                         #Fichero@#3 = aAlfa;
                         |PINTA #Fichero@#3;
                    |FINSI;
                    |SI swPintado = 0;
                         #Fichero@#nCampo# = #Referen@#0;
                         |PINTA #Fichero@#nCampo#;
                         swPintado = 1;
                    |FINSI;
                    |SI aMod = "labcerti"; |O aMod = "labcerag";
                         |SI nCampo = 78; |O nCampo = 98;
                              |SI aMod = "labcerti";
                                   nCampo1 = 9;
                              |FINSI;
                              |SI aMod = "labcerag";
                                   nCampo1 = 5;
                              |FINSI;
                              aAlfa = #Referen@#0;
                              |QBF aAlfa;
                              nNume = aAlfa;
                              #Fichero@#nCampo# = nNume;
                              |PINTA #Fichero@#nCampo#;
                              #Fichero@#nCampo1# = #Referen@#1;
                              |PINTA #Fichero@#nCampo1#;
                         |FINSI;
                         |SI nCampo = 104; |O nCampo = 123;
                              |SI aMod = "labcerti";
                                   nCampo = 103;
                                   nCampo1 = 104;
                              |FINSI;
                              |SI aMod = "labcerag";
                                   nCampo = 122;
                                   nCampo1 = 123;
                              |FINSI;

                              aAlfa = #Referen@#0;
                              |QBF aAlfa;
                              #Fichero@#nCampo# = aAlfa;
                              |PINTA #Fichero@#nCampo#;
                              #Fichero@#nCampo1# = #Referen@#1;
                              |PINTA #Fichero@#nCampo1#;
                         |FINSI;
                    |FINSI;
                    |SI aMod = "labacuer"; |O aMod = "labcon85"; |O aMod = "labcon86";
                    |O aMod = "labacue2"; |O aMod = "labprorr";
                         aAlfa = #Referen@#0;
                         #Fichero@#27 = aAlfa;
                         aAlfa = #Referen@#1;
                         #Fichero@#13 = aAlfa;
                         |PINTA #Fichero@#27;
                         |PINTA #Fichero@#13;
                    |FINSI;
               |SINO;
                    |SI aMod ! "labtraba"; |Y aMod ! "nomw0003"; |Y aMod ! "nomw0004";
                    |Y nCampo ! 104; |Y nCampo ! 123;
                    |Y aMod ! "laborn11"; |Y aMod ! "laborn01";
                    |Y aMod ! "laborn12"; |Y aMod ! "laborn02";
                         |ERROR;
                    |FINSI;
               |FINSI;

               |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeUnidadBasico;
     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     eaUnidadBasico = (aContiene1 % 102) > "";

     aAlfa = eaUnidadBasico % -101;
     |SI aAlfa ! ":";
         eaUnidadBasico = "";
     |FINSI;
|FPRC;

|PROCESO CogeMac;
     |SI eaDSMAC ! "";  |ACABA;  |FINSI;

     |HAZ LeeUnidadBasico;

     aAlfa = eaUnidadBasico + "\DOCUMENTOS"; |RMKDIR aAlfa;
     aAlfa = aAlfa + "\DSMAC";               |RMKDIR aAlfa;

     |DBASE aAlfa;   |QBF aAlfa;
     aAlfa      = aAlfa + "ejecutables/";
     aOrigen   = aAlfa + "dsmac.exe";

     aDestino  = eaUnidadBasico + "\DOCUMENTOS\DSMAC\DSMAC.EXE";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aDocRemoto ! aDocServidor;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     |XABRE "EC", aDestino, nHandle;
     |SI FSalida < 0;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aAbre = eaUnidadBasico + "\DOCUMENTOS\DSMAC\DSMAC.TXT";  |RFBORRA aAbre;

     aEjecuta = "cmd " + &34 + "/c START /WAIT " + aDestino + " ";
     aEjecuta = aEjecuta +  eaUnidadBasico + "\DOCUMENTOS\DSMAC\DSMAC.TXT" + &34;
     |RSYSTEM aEjecuta;

     nConta = 0;
     |PARA;  |SI;  |HACIENDO;
             |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;

             |XABRE "EC", aAbre, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             nConta = nConta + 1;
             |SI nConta > 100;
                 |SAL;
             |FINSI;

             |PULSATECLA;
     |SIGUE;

     aAbre    = eaUnidadBasico + "\DOCUMENTOS\DSMAC\DSMAC.TXT";
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aEjecuta = "START "+ aDestino + " ";
         aEjecuta = aEjecuta +  eaUnidadBasico + "\DOCUMENTOS\DSMAC\DSMAC.TXT" + &34;
         |RSYSTEM aEjecuta;

         nConta = 0;
         |PARA;  |SI;  |HACIENDO;
                 |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
                 |SIGUE;

                 |XABRE "EC", aAbre, nHandle;
                 |SI FSalida ] 0;
                     |SAL;
                 |FINSI;

                 nConta = nConta + 1;
                 |SI nConta > 100;
                     |SAL;
                 |FINSI;

                 |PULSATECLA;
         |SIGUE;
     |FINSI;

     eaDSMAC   = "";
     aAbre    = eaUnidadBasico + "\DOCUMENTOS\DSMAC\DSMAC.TXT";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;   |ACABA;  |FINSI;

     |XLEE nHandle, 250, eaDSMAC;
     |SI FSalida < 0
         eaDSMAC   = "";
     |FINSI;
     |XCIERRA nHandle;

     |QBF eaDSMAC;
|FPRC;

|PROCESO MiraBloqueo;
     |DBASS aBase;
     aAbre = aBase + "integral/def/dsam0021.mas";
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         aAlfa = ":integral/dsam0021;" + (("00000" + enEmpresa) % -105);
         aAlfa = aAlfa + "CHEQUEO";
         |SUB_EJECUTA aAlfa;

         |SI eaBloqueo ! "1";
             aAlfa = "|:integral/dsam0021;" + (("00000" + enEmpresa) % -105);
             aAlfa = aAlfa + "PANTALLA";
             |SUB_EJECUTA aAlfa;
         |FINSI;
     |FINSI;
|FPRC;
