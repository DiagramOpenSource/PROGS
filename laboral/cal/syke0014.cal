|FICHEROS;
     syke0013 #0;
     syke0014 #1;
     labcentr;
|FIN;

|VARIABLES;
     Flag = 0;
     Calc = 0;
     UltLinea = 0;
     LineaAct = 0;
     ModoEntrada = 0;
     bisiesto = 0;
     topemes = 0;
     numer = 0;
     mesnum = 0;
     nTotalDias = 0;
     nDiaDe = 0;
     nDiaHa = 0;
     nSolape = 0;
|FIN;

|PROCESO MinCentr;
     #labcentr#0 = #0#0;
     #labcentr#1 = 1;
|FPRC;

|PROCESO MaxCentr;
     #labcentr#0 = #0#0;
     #labcentr#1 = 99;
|FPRC;

|PROCESO Tipo66w5;  |TIPO 66;
    |ABRE #labcentr;
    |CONSULTA_F_CLAVE #1#labcentr, MinCentr, MaxCentr;
    |SI FSalida = 0;
          #1#5 = #labcentr#1;
          #1#6 = #labcentr#2;
    |FINSI;
    |PINTA #1#5;
    |PINTA #1#6;
    |CIERRA #labcentr;
|FPRC;

|PROCESO RecalcProrrata;
     UltLinea = #syke0014#4;
     #syke0014#11 = #syke0014#12 / #syke0013#5;
     #syke0013#6 = #syke0013#6 + #syke0014#11;
     |GRABA 020#syke0014.a;
     nTotalDias = nTotalDias + #syke0014#12;
|FPRC;

|DEFBUCLE RecalcProrrata;
     #syke0014#1;
     ;
     #syke0013#0, #syke0013#1, #syke0013#2, #syke0013#3, 001;
     #syke0013#0, #syke0013#1, #syke0013#2, #syke0013#3, 999;
     ;
     NULL,RecalcProrrata;
|FIN;

|PROCESO Avisosk14;
     |SI nTotalDias > topemes;
          |COLOR 7,4;
          |ATRI I;
          |PINTA 0772, "ATENCION";
          |COLOR 7,1;
          |PINTA 0872, "Excedido";
          |PINTA 0972, " limite ";
          |PINTA 1072, "dias mes";
          |COLOR 7,0;
          |ATRI 0;
     |FINSI;

     |SI nSolape = 1;
          |COLOR 7,4;
          |ATRI I;
          |PINTA 0772, "ATENCION";
          |COLOR 7,1;
          |PINTA 0872, " Se han ";
          |PINTA 0972, "solapado";
          |PINTA 1072, "los dias";
          |COLOR 7,0;
          |ATRI 0;
     |FINSI;


     |SI nTotalDias [ topemes; |Y nSolape = 0;
          |PINTA 0772, "        ";
          |PINTA 0872, "        ";
          |PINTA 0972, "        ";
          |PINTA 1072, "        ";
     |FINSI;
|FPRC;

|PROCESO MiraLimites;
     |SI #syke0014#4 = LineaAct;   |ACABA;   |FINSI;

     |SI #syke0014#13 [ nDiaDe; |Y nDiaDe [ #syke0014#14;
          nSolape = 1;
     |FINSI;

     |SI #syke0014#13 [ nDiaHa; |Y nDiaHa [ #syke0014#14;
          nSolape = 1;
     |FINSI;
|FPRC;

|DEFBUCLE MiraLimites;
     #syke0014#1;
     ;
     #syke0013#0, #syke0013#1, #syke0013#2, #syke0013#3, 001;
     #syke0013#0, #syke0013#1, #syke0013#2, #syke0013#3, 999;
     ;
     NULL,MiraLimites;
|FIN;

|PROCESO Acumula; |TIPO 2;
     ModoEntrada = (FEntrada / 100) ! 0;
     Flag = 0+.1;
     #syke0013#5 = #syke0013#5 +. #syke0014#12;
     |SI Flag > 0;
          #syke0013#6 = 0;
          |SI ModoEntrada = 1;
               |GRABA 020#syke0014.b;
          |SINO;
               |GRABA 020#syke0014.a;
          |FINSI;
          LineaAct = #syke0014#4;
          nSolape = 0;
          nDiaDe = #syke0014#13;
          nDiaHa = #syke0014#14;
          |SALVA_DATOS #syke0014;
          |BUCLE MiraLimites;
          |REPON_DATOS #syke0014;

          |SI nSolape = 0;
               LineaAct = #syke0014#4;
               nTotalDias = 0;
               |SALVA_DATOS #syke0014;
               |BUCLE RecalcProrrata;
               |REPON_DATOS #syke0014;
               |SI #syke0013#6 < 1;
                    Calc = 1 - #syke0013#6;
                    #syke0014#0 = #syke0013#0;
                    #syke0014#1 = #syke0013#1;
                    #syke0014#2 = #syke0013#2;
                    #syke0014#3 = #syke0013#3;
                    #syke0014#4 = UltLinea;
                    |LEE 000#syke0014.=;
                    |SI FSalida = 0;
                         #syke0014#11 = #syke0014#11 + Calc; |GRABA 020#syke0014.a;
                         #syke0013#6 = 1;
                    |FINSI;
               |FINSI;
          |FINSI;

          #syke0014#0 = #syke0013#0;
          #syke0014#1 = #syke0013#1;
          #syke0014#2 = #syke0013#2;
          #syke0014#3 = #syke0013#3;
          #syke0014#4 = LineaAct;
          |LEE 000#syke0014.=;
          |PONCONTROL 23,"si"; |PTEC 815;
     |SINO;
          #syke0013#6 = #syke0013#6 +. #syke0014#11;
     |FINSI;
     |PINTA #syke0013#6;
     #syke0013#4 = #syke0013#6;
     |PINTA #syke0013#4;

     |HAZ UltimoDia;
     |HAZ Avisosk14;
|FPRC;

|PROCESO Calcula;
     |SI #1#13 ! 0; |Y #1#14 ! 0;
          #1#12 = #1#14 - #1#13 + 1;
     |FINSI;
   |SI #1#12 ! 0;
      |C_M #1#11,1,"N";
      #syke0014#11 = #syke0014#12 / #syke0013#5;
      |PINTA #1#11;
   |SINO;
      #1#11 = 1 - #0#4; |PINTA #1#11;
      |C_M #1#11,1,"S";
   |FINSI;
|FPRC;

|PROCESO UltimoDia;
     bisiesto = 0;
     numer = #1#2 $ 4;
     |SI numer = 0;
          bisiesto = 1;
     |FINSI;
     topemes = 31;
     mesnum = #1#3;
     |SI mesnum= 2;
          topemes = 28 + bisiesto;
     |FINSI;
     |SI mesnum= 4;|O mesnum= 6;|O mesnum= 9;|O mesnum=11;
          topemes = 30;
     |FINSI;

     |SI mesnum = 99;
          topemes = 31;
     |FINSI;
|FPRC;

|PROCESO Verifica1;
     |HAZ UltimoDia;
     |SI #1Campo > topemes;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Verifica2;
     |SI #1#14 < #1#13;
          |MENAV "    ATENCION: Dia Hasta no puede ser menor que Dia Desde";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO DiaCero;
     |SI #1#13 = 0;
          #1#14 = 0;
          |PINTA #1#14;
          |CAMPO_MODIFICA #1#14, 1, "N";
          |CAMPO_MODIFICA #1#12, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #1#14, 1, "S";
          |CAMPO_MODIFICA #1#12, 1, "N";
     |FINSI;
|FPRC;
