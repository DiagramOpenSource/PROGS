|FICHEROS;
    labcerti #0;
    labempre #1;         || empresas
    labtraba #2;         || trabajadores
    labcentr #3;         || centros
    labcon00 #4;         || decretos
    labregis #5;         || registro contratos
    labbasec #6;         || bases cabs.
    labbastm #7;         || bases lins. tmp.
    nomcalca #8;         || calculos cabs.
    nomvarca #9;         || variaciones cabs.
    labpadre #10;        || datos aux.
    labbasel #11;        || bases lins.
    silcon06 #30;        || datos AGIRED
    nomcalli;            || calculos lins.
    nomcontr;            || control aginom1
    nomhicca;            || historico calculos cabs.
    nomhicli;            || historico calculos lins.

    ||adrian: impresion pdf
     contrato;
     nomregim;
     labacuer;
     labconre;
     labaux01;

     pdfdocca;
     pdfdocli;
     pdfimtmp #100;

     labcon00 #66;
     labcertm #199;
     labvaltb;
     taiclaoc;

     labhisce #1000;
     labcontr;
     labnct10;
     nomcenes;
     gomdetjr;
     nomtrcal;

     nomcot02;
     nomcot03;
|FIN;

|VARIABLES;
    mod = 0;
    xmesnume = 0;
    xtopemes = 0;
    xmod = 0;
    xanynume = 0;
    swactua = 0;
    swcabec = 0;
    lineades = 0;
    mas = 0;
    dm = 0;
    mesq = 0;
    hm = 0;
    mesbaja = 0;
    diabaja = 0;
    diaq = 0;
    gg = 0;
    borrar1 = 0;
    fm = 0;
    stop = 0;
    em = 0;
    borrar2 = 0;
    dias = 0;
    lineahas = 0;
    contador = 0;
    puntero = 0;
    anyq = 0;
    nume1 = 0;
    nume2 = 0;
    verrfec = "0000ATENCION !! Fecha erronea o formato incorrecto ";
    vdia1 = "";
    vme1 = "";
    vany1 = "";
    vdia = 0;
    vme = 0;
    vany = 0;
    vtope = 0;
    vsw = 0;
    vfec = "";
    vblanco = "          ";
    vpuntos = "..........";
    v = 0;
    informe = "labcerti";
    mensa1 = "0000ATENCION !! No existe empresa ...";
    mensa2 = "0000ATENCION !! No existe trabajador ...";
    mensa3 = "0000ATENCION !! No existe centro de trabajo ...";
    meslet = "";
    ||&dia = "";
    ||&mes = "";
    &any = "";
    dia1 = "";
    mes1 = "";
    any1 = "";
    fec1 = "";
    fec2 = 0;
    &estado = "";
    compactado = "";
    &domemp = "";
    &domtra = "";
    &domcen = "";
    &coma = ",";
    barra = " / ";
    direcc = "";
    numero = "";
    piso   = "";
    locali = "";
    dd = 0;
    cd = 0;
    cc = 0;
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    vcampo = 0;
    inicio = 0;
    ciudad = "";
    alfa = "";
    alfa1 = "";
    fecalf = "";
    fecsys = @;
    dias_alta = 0;
    dias_coti = 0;
    linea = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;

    enSwError = 0;

    &silcon1 = "";
    &silcon2 = "";
    &silcon3 = "";
    &silcon4 = "";
    &silcon5 = "";
    fFecha_Alta = @;
    fFecha_Baja = @;
    nFecha_Alta = 0;
    nFecha_Baja = 0;
    nDias_Alta  = 0;
    nDias_Vac   = 0;
    sw_finiq = 0;
    sw_dto = 0;
    nMes = 0;
    &aAnyo = "";
    &aMes = "";
    nAnyo = 0;
    &nBaseCC_Fin = 0;
    &nBaseCP_Fin = 0;
    &EURODB = 0;

    nNumero = 0;
    aRes    = "";
    nNumCmp = 0;

    nCalc  = 0;
    nCalc1 = 0;
    nCont  = 0;

     || adrian: variables para impresion pdf
     nSuma = 0;
     &aProcedencia = "";
     &aArchivo = "";
     swCarga = 0;
     aValor = "";
     aCampo = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     &aID = "";

     &des = "";
     &has = "";
     &tiporet = ""; || Tipo Retribucion
     &dia = "";     || dia firma
     &mes = "";     || mes firma
     &anyo = "";    || a¤o firma

     nAscii = 0;
     aCaracter = "";
     aCaracterSal = "";
     aCadena = "";
     aCadenaSal = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     nBusca = 0;

     &dura = "";
     nCampo = 0;
     nCampo1 = 0;
     nCampo2 = 0;

     &hora2 = 0;
     &swCopia = 0;
     nNume = 0;
     aNume = "";
     nNume1 = 0;
     nLimiteClau = 0;
     &swAnexoClaus = 0;
     &swDondeEstoy = 0;
     &aListaFich = "";
     nLimReal = 0;
     &swAnexoHoras = 0;  || flag  si 1 -> se hace anexo de horas complementarias para el cto. indef. a T/P sobre pacto de horas compl.
     &swAnexoRelevo = 0; || flag  si 1 -> se hace anexo del contrato de relevo
     &swCopiaBasica = 2; || flag  si 1 -> no se hace copia basica;  si 2 -> se hace copia basica
     &aTipoContr = "";   || tipo de contrato del anexo de relevo
     &nTipo = 0;
     &topeclaus = 0;
     nDesd = 0;
     nHast = 0;
     swAnyoAnt = 0;
     nDesd_ant = 0;
     nHast_ant = 0;

     &nAnyo1 = 0;
     &nAnyo2 = 0;
     &nAnyo3 = 0;
     &nAnyo4 = 0;
     &nAnyo5 = 0;
     &nAnyo6 = 0;
     &nAnyo7 = 0;

     &aMes1 = "";
     &aMes2 = "";
     &aMes3 = "";
     &aMes4 = "";
     &aMes5 = "";
     &aMes6 = "";
     &aMes7 = "";

     nMes1 = 0;
     nMes2 = 0;
     nMes3 = 0;
     nMes4 = 0;
     nMes5 = 0;
     nMes6 = 0;
     nMes7 = 0;

     &nDiasCot1 = 0;
     &nDiasCot2 = 0;
     &nDiasCot3 = 0;
     &nDiasCot4 = 0;
     &nDiasCot5 = 0;
     &nDiasCot6 = 0;
     &nDiasCot7 = 0;

     &nBaseCotCC1 = 0;
     &nBaseCotCC2 = 0;
     &nBaseCotCC3 = 0;
     &nBaseCotCC4 = 0;
     &nBaseCotCC5 = 0;
     &nBaseCotCC6 = 0;
     &nBaseCotCC7 = 0;

     &nBaseCotDes1 = 0;
     &nBaseCotDes2 = 0;
     &nBaseCotDes3 = 0;
     &nBaseCotDes4 = 0;
     &nBaseCotDes5 = 0;
     &nBaseCotDes6 = 0;
     &nBaseCotDes7 = 0;

     aObservacion = "";
     aObservacion1 = "";
     aObservacion2 = "";
     aObservacion3 = "";
     aObservacion4 = "";
     aObservacion5 = "";
     aObservacion6 = "";
     aObservacion7 = "";

     ||LINEA VACACIONES
     nBaseCotCC8 = 0;
     nBaseCotDes8 = 0;
     nDiasCot8 = 0;

     nTotalCot = 0;
     nTotalCotCC = 0;
     nTotalCotDes = 0;

     nanyo = 0;
     nanyo_ant = 0;
     nmes = 0;
     nMess = 0;
     nCamp = 0;

     cont = 0;
     || ________________________fin adrian: variables para impresion pdf

     ||citric_c = 1.33;
     ||citric_f = 1.61;
     citric_c = 1;
     citric_f = 1;
     fFecha1 = @;
     fFecha2 = @;

     aDia = "";
     aAny = "";
     nAny = 0;
     ultimo = 0;
     nMesBus = 0;
     nAnyBus = 0;
     i = 0;
     nDiaDesem = 0;
     aDiaDesem = "";
     nMesDesem = 0;
     aMesDesem = "";
     nAnyDesem = 0;
     aAnyDesem = "";
     nMesRealDesem = 0;
     nAnyRealDesem = 0;
     nDiasDesem = 0;
     nDiasRealesDesem = 0;
     nDiasRealesAlta = 0;
     nDiasDesemTP = 0;
     nBaseDesem = 0;
     swDesem = "";
     nDesde = 0;
     nHasta = 0;
     nFalta = 0;
     aFecha = "";
     nDia = 0;
     fFecha = @;

     nEmp = 0;
     nTra = 0;
     aNif = "";
     swYaExiste = 0;
     aMesNuevo = "";
     aAnyNuevo = "";
     aMesExiste = "";
     aAnyExiste = "";
     fFecAltaLim = @;
     fFecAltaTra = @;
     fFecAntig = @;
     nOtraEmp = 0;
     nOtroTra = 0;
     nOtraLin = 0;
     nBorraTra1 = 0;
     nBorraTra2 = 0;
     nBorraTra3 = 0;

     nExceso = 0;

     aDuracion = "";
     aDiaAlta = "";
     aMesAlta = "";
     aAnyAlta = "";
     aDiaBaja = "";
     aMesBaja = "";
     aAnyBaja = "";

     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     nDiaBaja = 0;
     nMesBaja = 0;
     nAnyBaja = 0;

     nAnys = 0;
     nMeses = 0;
     nDias = 0;
     aDias = "";
     aMeses = "";
     aAnys = "";
     aFechaBaja = "";
     swGraba1 = 0;
     swGraba2 = 0;
     aRegul = "";
     aParam = "";
     aParam1 = "";
     FEstado = 0;
     aHora = "";

     &aRegimen = "";
     aEmision = "";
     &enEmp = 0;
     &enTra = 0;
     &enSwHisto = 0;
     &eaFichero = 0;
     &enCanal = 0;
     nOpcion = 0;
     aMensa = "";
     &aPath = "";
     &swNetContrata = 0;
     &aAntCCC = "";
     swSigue = 0;
     aUsuario = "";
     aFechaRef = "";
     swMarca = 0;
     fFechaSuspension = @;

     &eaVengoDe       = "";
     &enArchivar      = 0;
     &nArchi          = 0;
     &enMes           = 0;
     &enAny           = 0;

     &enEmpGAD        = 0;
     &enTraGAD        = 0;
     &enTipGAD        = 0;
     &enMesGAD        = 0;
     &enAnyGAD        = 0;
     &enModGAD        = 0;
     &enImpGAD        = 0;
     &enExiGAD        = 0;
     &eaFicGAD        = "";

     nActivoNuevo     = 0;
     nError           = 0;
     nValor = 0;

     swTA2 = 0;
     &nEmpExt = 0;
     &nTraExt = 0;
     &fFechaBaja = @;
     &nCausaBaja = 0;
     &aCausaBaja = "";

     numer = 0;
     anynum = 0;
     mesnum = 0;
     bisiesto = 0;
     hmes = 0;
     hany = 0;
     aFecha1 = "";
     aFecha2 = "";
     aFechaAlta = "";
     fFechaAlta = @;
     nFecha1 = 0;
     nFecha2 = 0;
     nDiasAlta = 0;
     swsibaja3 = 0;

     nEmpReal = 0;
     nTraReal = 0;
     nCenReal = 0;

     topemes = 0;
     aCalendario = "";
     nCampoDia = 0;
     nAnyJor = 0;
     nMesJor = 0;
     swMensual = 0;
     &eaIdioma = "";

     nDias2 = 0;
     nDias2Reales = 0;
     nBaseCC1 = 0;
     nBaseCP1 = 0;
     nBaseCC2 = 0;
     nBaseCP2 = 0;

     nMesHis = 0;
     nAnyHis = 0;
     nBase = 0;
     fFechaCertif = @;
|FIN;

/********** PROCESOS PARA BUSQUEDA DE FECHAS EN REGULACION DE EMPLEO ********/

|PROCESO ultimodia;
     |SI nMes = 1; |O nMes = 3; |O nMes = 5; |O nMes = 7; |O nMes = 8;
     |O nMes = 10; |O nMes = 12;
           ultimo = 31;
     |SINO;
          |SI nMes = 2;
               mod = nAny $ 4;
               |SI mod = 0;
                    ultimo = 29;
               |SINO;
                    ultimo = 28;
               |FINSI;
          |SINO;
               ultimo = 30;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaAnteriores;
     |PARA i = 1; |SI i [ 12; |HACIENDO i = i + 1;
          nMesBus = nMes - i;
          |SI nMesBus [ 0;
               nMesBus = nMesBus + 12;
               nAnyBus = nAny - 1;
          |SINO;
               nAnyBus = nAny;
          |FINSI;
          #nomhicca#0 = #0#0;
          #nomhicca#1 = #0#1;
          #nomhicca#2 = nMesBus;
          #nomhicca#3 = 0;
          #nomhicca#66 = nAnyBus;
          |LEE 000#nomhicca.=
          |HAZ BuscaLaDHisto;
          |SI nDiaDesem ! 0;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO BuscaLaDHisto;
     |PARA nDesde = 19; |SI nDesde [ 22; |HACIENDO nDesde = nDesde + 1;
          nHasta = nDesde + 4;
          nFalta = nDesde + 8;
          |SI #nomhicca#nFalta# = "D";
               |SI #nomhicca#nDesde# = 0;
                    #nomhicca#nDesde# = 0;
               |FINSI;
               |SI #nomhicca#nHasta# = 0;
                    |HAZ ultimodia;
                    #nomhicca#nHasta# = ultimo;
               |FINSI;
               nDiaDesem = #nomhicca#nDesde#;
               nDiasDesem = #nomhicca#119;
               nDiasRealesDesem = #nomhicca#119;
               nBaseDesem = #labtraba#242;
               swDesem = "H";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO BuscaLaDMensual;
     |PARA nDesde = 19; |SI nDesde [ 22; |HACIENDO nDesde = nDesde + 1;
          nHasta = nDesde + 4;
          nFalta = nDesde + 8;
          |SI #nomcalca#nFalta# = "D";
               |SI #nomcalca#nDesde# = 0;
                    #nomcalca#nDesde# = 0;
               |FINSI;
               |SI #nomcalca#nHasta# = 0;
                    |HAZ ultimodia;
                    #nomcalca#nHasta# = ultimo;
               |FINSI;
               nDiaDesem = #nomcalca#nDesde#;
               nDiasDesem = #nomcalca#78;
               nBaseDesem = #labtraba#242;
               swDesem = "M";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO BuscaRegula;
     swMarca = 0;
     nDiaDesem = 0;
     nDiasDesem = 0;
     nBaseDesem = 0;
     swDesem = "";
/*
     |SI #0#78 ! 16; |Y #0#78 ! 17; |Y #0#78 ! 18;
          |ACABA;
     |FINSI;
*/

     aFecha = #0#8;
     |QBF aFecha;
     |SI aFecha = ""; |O aFecha = "..........";
          fFecha = ~;
          aFecha = fFecha;
     |FINSI;
     aDia = aFecha % 102;
     aMes = aFecha % 402;
     aAny = aFecha % -104;
     nDia = aDia;
     nMes = aMes;
     nAny = aAny;

     |ABRE #nomcalca;
     |ABRE #nomhicca;

     #nomcalca#0 = #0#0;
     #nomcalca#1 = #0#1;
     #nomcalca#2 = nMes;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          |HAZ BuscaLaDMensual;
     |SINO;
          #nomhicca#0 = #0#0;
          #nomhicca#1 = #0#1;
          #nomhicca#2 = nMes;
          #nomhicca#3 = 0;
          #nomhicca#66 = nAny - 2000;
          |LEE 000#nomhicca.=
          |SI FSalida = 0;
               |HAZ BuscaLaDHisto;
          |FINSI;
     |FINSI;

     |SI nDiaDesem ! 0;
          nDiaDesem = nDiaDesem - 1;
          nMesDesem = nMes;
          nMesRealDesem = nMes;
          nAnyDesem = nAny;
          nAnyRealDesem = nAny;
          |SI nDiaDesem = 0;
               nMesDesem = nMesDesem - 1;
               |SI nMesDesem ! 0;
                    nMes = nMesDesem;
                    |HAZ ultimodia;
                    nDiaDesem = ultimo;
                    nAnyDesem = nAny;
               |SINO;
                    nDiaDesem = 31;
                    nMesDesem = 12;
                    nAnyDesem = nAnyDesem -1 ;
               |FINSI;
          |FINSI;

          aDiaDesem = nDiaDesem;
          aMesDesem = nMesDesem;
          aAnyDesem = nAnyDesem;

          aDiaDesem = "00" + aDiaDesem;
          aDiaDesem = aDiaDesem % -102;
          aMesDesem = "00" + aMesDesem;
          aMesDesem = aMesDesem % -102;

          aFecha = aDiaDesem + "." + aMesDesem + "." + aAnyDesem;

          ||SI aFecha ! #0#8;
               aAlfa = "    ATENCION: El trabajador tiene Expediente de Regulacion ";
               aAlfa = aAlfa + "de Empleo.";
               ||MENAV aAlfa;
               aAlfa = "     ¿Desea incluir los días en ERE en las bases del ";
               aAlfa = aAlfa + "certificado?";
               ||CONFI aAlfa;
          /*
          |SINO;
               FSalida = 0;
          |FINSI;
          */
          FSalida = 1;        || fuerzo
          |SI FSalida ! 0;
               aRegul = "N";
               |SI #0#8 = aFecha;
                    || esto querria decir que quiero que el certificado incluya
                    || solo hasta el ultimo dia trabajado antes de que empiece el
                    || ERE, pase lo que pase despues, es decir aunque despues
                    || haya dias en ERE y dias sin ERE

                    #0#8 = aFecha;
                    |PINTA #0#8;

                    || esto es lo nuevo que pongo para que si tengo ERE y digo que la
                    || fecha fin de contrato es el dia 16 (por ejemplo) no me tenga
                    || en cuenta mas alla del dia 16 si le digo que NO me incluya los
                    || dias de ERE en el certificado
                    |SI #0#78 = 16; |O #0#78 = 17; |O #0#78 = 18;
                         aAlfa = #0#8;
                         aAlfa = aAlfa % 102;
                         nDiaDesem = aAlfa;
                         nDiaDesem = nDiaDesem + 1;
                         xmesnume = nMes;
                         xanynume = nAny;
                         |HAZ diaanter;
                         nDiasDesem = xtopemes - nDiaDesem;
                    |FINSI;
               |SINO;
                    swMarca = 1;
                    || asi lo que hago es simplemente quitar los dias de
                    || desempleo y ya esta, otra combinacion
               |FINSI;
          |SINO;
               aRegul = "S";
          |FINSI;
     |FINSI;

     |CIERRA #nomcalca;
     |CIERRA #nomhicca;
|FPRC;

/***********************************************************************/

|PROCESO CompTra;

     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
          aAlfa = "    ATENCION. El trabajador pertenece al Régimen Agrario.";
          |MENAV aAlfa;
          aAlfa = "    Utilice la opción 'Certificado Empresa Régimen Agrario'.";
          |MENAV aAlfa;
          |PTEC 807;
     |SINO;
          |HAZ Recupera;
     |FINSI;

|FPRC;

____________________________________/ CALCULOS DE PANTALLA

|PROCESO Sindical; |TIPO 7;
     |PUSHV 16422279;
     |ATRI R;
     ||            4       5         6         7
     ||            23456789012345678901234567890123456789
     |PINTA 1642, " Elija una opción si procede:         ";
     |PINTA 1742, " 1 - Alto cargo de la Administración  ";
     |PINTA 1842, " General del Estado                   ";
     |PINTA 1942, " 2 - Cargo representante de sindicato ";
     |PINTA 2042, " al amparo de la Ley 11/1985          ";
     |PINTA 2142, " 3 - Miembro de la corporación local  ";
     |PINTA 2242, " y resto de cargos sindicales         ";
     |ATRI 0;
|FPRC;

|PROCESO RestauraC;
     |POPV;
|FPRC;

|PROCESO Sindical2; |TIPO 7;
     |SI #0#82 = " ";
          #0#83 = 0;
          |PINTA #0#83;
          |CAMPO_MODIFICA #0#83, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0#83, 1, "S";
     |FINSI;
|FPRC;

|PROCESO SinBaseFin; |TIPO 7;
     |SI #0#70 = 0;
          #0Campo = 0;
          |PINTA #0Campo;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "S";
     |FINSI;
|FPRC;

|PROCESO variacion; |TIPO 7;
     |SI #0#8 ! "          ";
          |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = #0#0;
     #2#1 = #0#1;
     |LEE 000#2=;

     fecsys = ~;
     fecalf = fecsys;
     alfa1 = fecalf % 402;
     aMes = alfa1;
     nMes = aMes;

     nMes = nMes + 1;
     |SI nMes = 13;
          nMes = 01;
     |FINSI;
     xmesnume = nMes - 5;
     |SI xmesnume < 1;
          xmesnume = 1;
     |FINSI;
     |ABRE #9;
     #9#0 = #0#0;    || empresa
     #9#1 = #0#1;    || trabajador
     #9#3 = 0;       || tipo

     aFechaBaja = "";
     |PARA nMes = nMes; |SI nMes ] xmesnume; |HACIENDO nMes = nMes - 1;
          #9#2 = nMes;   || mes
          |LEE 000#9=;
          |SI FSalida = 0;
               |SI #9#16 ! ".........."; |Y #9#16 ! "          ";
                    aFechaBaja = #9#16;
                    |SAL;
               |FINSI;
          |FINSI;
          |SI nMes = 1; |Y xmesnume = 1;     || si no en diciembre va mal
               nMes = 13;                    || me voy a diciembre
               xmesnume = 10;                || y miro un par de meses
          |FINSI;                            || mas atras
     |SIGUE;
     |CIERRA #9;

     |SI aFechaBaja = "";
          |SI #2#37 ! ".........."; |Y #2#37 ! "          ";
               aFechaBaja = #2#37;
          |FINSI;
     |FINSI;
     #0#8 = aFechaBaja;

     |PINTA #0#8;
     |CIERRA #2;
|FPRC;

|PROCESO lamisma; |TIPO 7;
    #0#10 = #0#8;
|PINTA #0#10;
|FPRC;

|PROCESO leeempre;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #1;                    || DE LA RELACION CON EL FICHERO DE
        #1#0 = #0#0;          || EMPRESAS
|LEE 000#1=;
|SI FSalida = 0;
     |SI aEmision ! "XML"; |Y aEmision ! "IMP";
           |PINTA 0731,#1#2;
     |FINSI;
        ciudad = #1#6;
    |QBF ciudad;
        ciudad = "                              " + ciudad;
        ciudad = ciudad % -130;
        #1#6 = ciudad;
|SINO;
    |MENAV mensa1;
        #0#0 = 0;
    |ERROR;
|FINSI;
|CIERRAT #1;
|FPRC;

|PROCESO leetraba;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #2;                    || EN LA RELACION CON EL FICHERO DE
    #2#0 = #0#0;              || TRABAJADORES
    #2#1 = #0#1;
|LEE 000#2=;
|SI FSalida = 0;
     |SI aEmision ! "XML"; |Y aEmision ! "IMP";
         |PINTA 0831, #2#2;
     |FINSI;
|SINO;
    |MENAV mensa2;
        #0#1 = 0;
    |ERROR;
|FINSI;
|CIERRAT #2;

     nEmpReal = #0#0;
     nTraReal = #0#1;
     nCenReal = #0#2;

|FPRC;

|PROCESO leecentr;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #3;                    || DE LA RELACION CON EL FICHERO DE
        #3#0 = #0#0;          || CENTROS DE TRABAJO
        #3#1 = #0#2;
|LEE 000#3=;
|SI FSalida = 0;
     |SI aEmision ! "XML"; |Y aEmision ! "IMP";
          |PINTA 0931,#3#2;
     |FINSI;
|SINO;
    |MENAV mensa3;
        #0#2 = 0;
    |ERROR;
|FINSI;
|CIERRAT #3;
|FPRC;

|PROCESO fechacon1; |TIPO 0;
        vfec = #0Campo; vsw = 0;
|SI vfec ! vblanco; |Y vfec ! vpuntos;
  vdia1 = vfec % A102;
  vme1 = vfec % A402;
  vany1 = vfec % A704;
  vdia = vdia1; vme = vme1; vany = vany1;
  |SI vdia ! 0; |Y vme ! 0; |Y vany > 1900;
     |SI vme [ 12; |Y vme ] 1;
       |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7; |O vme = 8; |O vme = 10; |O vme = 12;
           vtope = 31;
       |SINO;
           |SI vme = 2;
               mod = vany $ 4;
               |SI mod = 0;
                   vtope = 29;
               |SINO;
                   vtope = 28;
               |FINSI;
            |SINO;
               vtope = 30;
            |FINSI;
        |FINSI;
        |SI vdia [ vtope;
            vsw = 1;
        |FINSI;
     |FINSI;
  |FINSI;
|SINO;
  vsw = 1;
|FINSI;
|SI vsw = 0;
    |MENAV verrfec;
    |ERROR;
|FINSI;
|FPRC;

/************************** PROCESOS LABORNET *******************************/

|PROCESO RellenaCampos;
     |ABRE #2;                    || EN LA RELACION CON EL FICHERO DE
     #2#0 = #0#0;              || TRABAJADORES
     #2#1 = #0#1;
     |LEE 000#2=;
     |SI FSalida = 0;
          aAlfa = #labtraba#184;
          aAlfa1 = aAlfa % 104;
          aAlfa2 = aAlfa - aAlfa1;
          #0#78 = aAlfa1; |PINTA #0#78;
          #0#9 = aAlfa2; |PINTA #0#9;
     |FINSI;
     |CIERRA #2;
|FPRC;

/****************************************************************************/

|PROCESO imporant; |TIPO 7;
    #0#11 = #0#4 * #0#5;
|FPRC;

|PROCESO impornue; |TIPO 7;
    #0#12 = #0#6 * #0#7;
|FPRC;
____________________________________/
|PROCESO BuscaOtro;
     aMesNuevo = #11#3 % 402;
     aAnyNuevo = #11#3 % -104;
     aMesExiste = #7#3 % 402;
     aAnyExiste = #7#3 % -104;

     |SI aMesNuevo = aMesExiste; |Y aAnyNuevo = aAnyExiste;
          swYaExiste = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaOtro;
     #7#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BuscaOtro;
|FIN;

|PROCESO Dias;
     nDias = 0;

     aMes = hmes;
     |QBF aMes;
     aMes = ("00" + aMes) % -102;
     anynum = hany + 2000;
     aAny = anynum;
     aFecha1 = "01." + aMes + "." + aAny;
     fFecha1 = aFecha1;

     mesnum = hmes;
     xmesnume = mesnum;
     xanynume = anynum;
     |HAZ diaanter;
     aDia = xtopemes;
     aFecha2 = aDia + "." + aMes + "." + aAny;
     fFecha2 = aFecha2;

     |SI swsibaja3 = 1;
          aFechaAlta = #labtraba#36;
          aFechaBaja = #0#8;
     |SINO;
          aFechaAlta = #199#0;
          |SI #labtraba#1 = #199#2;
               aFechaBaja = #0#8;
          |SINO;
               aFechaBaja = #199#3;
          |FINSI;
     |FINSI;

     |QBF aFechaBaja;
     |SI aFechaBaja = ""; |O aFechaBaja = "..........";
          aFechaBaja = "31.12.2099";
     |FINSI;

     fFechaAlta = aFechaAlta;
     fFechaBaja = aFechaBaja;

     |SI fFechaAlta > fFecha1;
          fFecha1 = fFechaAlta;
     |FINSI;
     |SI fFechaBaja < fFecha2;
          fFecha2 = fFechaBaja;
     |FINSI;

     nFecha1 = fFecha1;
     nFecha2 = fFecha2;
     nDias = fFecha2 - fFecha1 + 1;
|FPRC;

|PROCESO nomcot02_bases;
     |SI #nomcot02#8 [ fFechaCertif;
          || adelante;
     |SINO;
          |ACABA;
     |FINSI;

     |PARA nCampo = 0; |SI nCampo [ 7; |HACIENDO nCampo = nCampo + 1;
          #nomcot03#nCampo# = #nomcot02#nCampo#;
     |SIGUE;
     #nomcot03#10# = 601;
     |LEE 000#nomcot03.=;
     |SI FSalida = 0;
          nBase = nBase + #nomcot03#12;
     |FINSI;
     #nomcot03#10# = 603;
     |LEE 000#nomcot03.=;
     |SI FSalida = 0;
          nBase = nBase + #nomcot03#12;
     |FINSI;
     #nomcot03#10# = 636;
     |LEE 000#nomcot03.=;
     |SI FSalida = 0;
          nBase = nBase + #nomcot03#12;
     |FINSI;

     |SI nBase ! 0;
          nDias = nDias + #nomcot02#22;
     |FINSI;
|FPRC;

|DEFBUCLE nomcot02_bases;
     #nomcot02#1;
     ;
     #11#0, nAnyHis, nMesHis, 0, "               ", "            ", 01, #11#1;
     #11#0, nAnyHis, nMesHis, 0, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzz", 99, #11#1;
     ;
     NULL, nomcot02_bases;
|FIN;

|PROCESO BasesNomcot02;
     nBase = 0;
     nDias = 0;

     aAlfa = #0#8;
     fFechaCertif = aAlfa;

     |ABRE #nomcot03;

     |BUCLE nomcot02_bases;

     |CIERRA #nomcot03;
|FPRC;

|PROCESO BasesSegunLineas;
     || multiples problemas de bases en ERE

     || vamos a coger las bases del mes segun las lineas, si estas existen
     || llamaremos a este proceso cuando sea necesario, y deberia ser siempre

     || por ejemplo el problema de los trabajadores que tienen la base y los
     || dias mal actualizados por los EREs

     swSigue = 0;

     || bueno esto me da igual, voy a coger las lineas del nomcot02
     || con lo que me da igual de donde venga

     |SI aEmision = "XML"; |O aEmision = "IMP";
          |SI #0#78 = 16; |O #0#78 = 17; |O #0#78 = 18;

               || cuando se actualizan las nominas al historico, las bases que
               || pasan al labbasel incluyen la base en ERE, esto hace que si
               || tenemos que sacar un certificado de empresa para el ERE, si
               || lo lanzamos por la pantalla bien, pero si lo lanzamos desde
               || el historico o hacemos un XML desde el historico, como vuelve
               || a hacer el certificado completo, NO QUITA la parte en ERE
               || la quito aqui yo

               swSigue = 1;

          |FINSI;
     |FINSI;

     swSigue = 0;

     || si existe ERE, segun la fecha del certificado

     swSigue = 1;
     /*
     |SI #11#4 = 30.50;
          swSigue = 1;
     |FINSI;
     |SI #0#78 = 16; |O #0#78 = 17; |O #0#78 = 18;
          swSigue = 1;
     |FINSI;
     */

     |SI swSigue = 1;
          || primero mensual

          |ABRE #nomcalca;

          #nomcalca#0 = #11#0;
          #nomcalca#1 = #11#1;
          #nomcalca#2 = nMesHis;
          #nomcalca#3 = 0;
          |LEE 000#nomcalca.=
          |SI FSalida = 0; |Y #nomcalca#184 = nAnyHis;
               |SI #nomcalca#27 = "D"; |O #nomcalca#28 = "D";
               |O #nomcalca#29 = "D"; |O #nomcalca#30 = "D";
                    |HAZ BasesNomcot02;
                    #11#4 = nDias;
                    #11#7 = nBase;
                    #11#8 = nBase;
               |FINSI;
          |FINSI;

          |CIERRA #nomcalca;

          || si no, historico

          |ABRE #nomhicca;

          #nomhicca#0 = #11#0;
          #nomhicca#1 = #11#1;
          #nomhicca#2 = nMesHis;
          #nomhicca#3 = 0;
          #nomhicca#66 = nAnyHis - 2000;
          |LEE 000#nomhicca.=
          |SI FSalida = 0;
               |SI #nomhicca#27 = "D"; |O #nomhicca#28 = "D";
               |O #nomhicca#29 = "D"; |O #nomhicca#30 = "D";
                    |HAZ BasesNomcot02;
                    #11#4 = nDias;
                    #11#7 = nBase;
                    #11#8 = nBase;
               |FINSI;
          |FINSI;

          |CIERRA #nomhicca;
     |FINSI;
|FPRC;

|PROCESO nomcot02;
     |SI #nomcot02#27 ! "ETP";
          |PARA nCampo = 0; |SI nCampo [ 7; |HACIENDO nCampo = nCampo + 1;
               #nomcot03#nCampo# = #nomcot02#nCampo#;
          |SIGUE;
          #nomcot03#10# = 500;
          |LEE 000#nomcot03.=;
          |SI FSalida = 0;
               nBase = nBase + #nomcot03#12;
               nDias = nDias + #nomcot02#22;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomcot02;
     #nomcot02#1;
     ;
     #11#0, nAnyHis, nMesHis, 0, "               ", "            ", 01, #11#1;
     #11#0, nAnyHis, nMesHis, 0, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzz", 99, #11#1;
     ;
     NULL, nomcot02;
|FIN;

|PROCESO MesERETP;
     nBase = 0;
     nDias = 0;

     |ABRE #nomcot03;

     |BUCLE nomcot02;

     |CIERRA #nomcot03;
|FPRC;

|PROCESO BasesERE;
     || multiples problemas de bases en ERE

     || primero hay que ver el problema de los trabajadores que estan
     || mal actualizados, que son muchos

     swSigue = 0;
     |SI aEmision = "XML"; |O aEmision = "IMP";
          |SI #0#78 = 16; |O #0#78 = 17; |O #0#78 = 18;

               || cuando se actualizan las nominas al historico, las bases que
               || pasan al labbasel incluyen la base en ERE, esto hace que si
               || tenemos que sacar un certificado de empresa para el ERE, si
               || lo lanzamos por la pantalla bien, pero si lo lanzamos desde
               || el historico o hacemos un XML desde el historico, como vuelve
               || a hacer el certificado completo, NO QUITA la parte en ERE
               || la quito aqui yo

               swSigue = 1;

          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          aAlfa = #labbasel#3 % 402;
          nMesHis = aAlfa;
          aAlfa = #labbasel#3 % -104;
          nAnyHis = aAlfa;

          |ABRE #nomhicca;

          #nomhicca#0 = #11#0;
          #nomhicca#1 = #11#1;
          #nomhicca#2 = nMesHis;
          #nomhicca#3 = 0;
          #nomhicca#66 = nAnyHis - 2000;
          |LEE 000#nomhicca.=
          |SI FSalida = 0;
               |SI #nomhicca#27 = "D"; |O #nomhicca#28 = "D";
               |O #nomhicca#29 = "D"; |O #nomhicca#30 = "D";
                    |SI #nomhicca#161 ! 100; |O #nomhicca#162 ! 100;
                    |O #nomhicca#163 ! 100; |O #nomhicca#164 ! 100;
                         || ERE A TP
                         |HAZ MesERETP;
                         #11#4 = nDias;
                         #11#7 = nBase;
                         #11#8 = nBase;
                    |SINO;
                         || ERE normal
                         #11#4 = #nomhicca#8;
                         #11#7 = #nomhicca#39;
                         #11#8 = #nomhicca#40;
                    |FINSI;
               |FINSI;
          |FINSI;

          |CIERRA #nomhicca;
     |FINSI;
|FPRC;

|PROCESO lee_lineas1;
     || no me grabes
     || si vienes de un traspaso manual y tienes las bases a cero
     aAlfa = #11#9; |QBF aAlfa;
     |SI aAlfa = "TRASPASO MANUAL"; |Y #11#7 = 0; |Y #11#8 = 0;
          |ACABA;
     |FINSI;

     swYaExiste = 0;
     aAlfa = #11#9; |QBF aAlfa;
     |SI #0#8 ! "          "; |Y #0#8 ! "..........";
          fech2 = #199#0;
          fech3 = #0#8;
          |SI fech2 > fech3;
               |ACABA;
          |FINSI;
     |FINSI;
     |BUCLE BuscaOtro;
     |SI swYaExiste = 0;
          aAlfa = #11#3;
          aAlfa = "01" + (aAlfa % 308);
          fFecha = aAlfa;
          fFechaSuspension = #0#8;
          |SI fFecha > fFechaSuspension;
               |ACABA;
          |FINSI;

          linea = linea + 1;
          |DDEFECTO #7;
          #7#0 = #11#0;
          #7#1 = #11#1;
          #7#2 = linea;
          #7#3 = #11#3;

          || esto ya NO haria falta hacerlo, fue un primer intento
          ||HAZ BasesERE;

          aAlfa = #labbasel#3 % 402;
          nMesHis = aAlfa;
          aAlfa = #labbasel#3 % -104;
          nAnyHis = aAlfa;
          nDias = 0;
          nBase = 0;
          |HAZ BasesSegunLineas;
          |SI nDias ! 0; |Y nBase ! 0;
               #11#4 = nDias;
               #11#7 = nBase;
               #11#8 = nBase;
          |FINSI;

          || esto es por si por algun motivo (como no, a Dany le ha pasado)
          || los dia actualizados no fueran los correctos (los mismos que en el
          || calendario)

          |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
               |HAZ citricos;
               |SI nDias ! 0;
                    #7#4 = nDias;
               |SINO;
                    nDias = #11#4;
               |FINSI;
          |SINO;
               #7#4 = #11#4;
          |FINSI;

          #7#5 = #11#5;
          #7#6 = #11#6;
          #7#7 = #11#7;
          #7#8 = #11#8;
          #7#9 = #11#9;
          #7#10 = aNif;
          aAlfa = #7#9; |QBF aAlfa;
          |GRABA 020#7n;
     |SINO;
          |LEE 101#7=;

          || esto ya NO haria falta hacerlo, fue un primer intento
          ||HAZ BasesERE;

          aAlfa = #labbasel#3 % 402;
          nMesHis = aAlfa;
          aAlfa = #labbasel#3 % -104;
          nAnyHis = aAlfa;
          nDias = 0;
          nBase = 0;
          |HAZ BasesSegunLineas;
          |SI nDias ! 0; |Y nBase ! 0;
               #11#4 = nDias;
               #11#7 = nBase;
               #11#8 = nBase;
          |FINSI;

          || esto es por si por algun motivo (como no, a Dany le ha pasado)
          || los dia actualizados no fueran los correctos (los mismos que en el
          || calendario)

          |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
               |HAZ citricos;
               |SI nDias ! 0;
                    #7#4 = #7#4 + nDias;
               |SINO;
                    #7#4 = #7#4 + #11#4;
               |FINSI;
          |SINO;
               #7#4 = #7#4 + #11#4;
          |FINSI;

          |SI swYaExiste = 1; |Y #7#4 > 31;  || bueno una forma cutre de
                                             || comprobar que no nos pasamos
                                             || de los dias (para fichas dobles)
                #7#4 = #7#4 - #11#4;
          |FINSI;

          #7#5 = #7#5 + #11#5;
          #7#7 = #7#7 + #11#7;
          #7#8 = #7#8 + #11#8;
          #7#10 = aNif;

          #7#11 = #11#1;
          #7#12 = #11#4;
          #7#13 = #11#7;
          #7#14 = #11#8;
          |GRABA 020#7a;
          |LIBERA #7;
     |FINSI;
|FPRC;

|PROCESO ordena;
    fech1 = #11#3;
|FPRC;

|DEFBUCLE lee_lineas;
     #11#1;
     ;
     nEmp, nTra,   1;
     nEmp, nTra, 999;
     ;
     NULL, ordena, NULL, NULL, NULL, lee_lineas1;
     #11#0, #11#1, fech1, #11#2;
|FIN;

|PROCESO PorNIF;
     fFecAltaTra = #199#0;
     |SI #0#77 = "S";
          |SI fFecAltaTra [ fFecAltaLim;
               |SI #0#60 = "S"; |Y dias_alta = 0;
                    fecsys = #199#0;
                    dias_alta = fecsys;
               |FINSI;
               nEmp = #199#1;
               nTra = #199#2;
               |BUCLE lee_lineas;
          |FINSI;
     |SINO;
          |SI fFecAltaTra = fFecAltaLim;
               |SI #0#60 = "S"; |Y dias_alta = 0;
                    fecsys = #199#0;
                    dias_alta = fecsys;
               |FINSI;
               nEmp = #199#1;
               nTra = #199#2;
               |BUCLE lee_lineas;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE PorNIF;
     #199#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PorNIF;
|FIN;

|PROCESO GrabaTMP;
     |SI #0#77 = "N";
          |SI nEmpReal ! #labtraba#0; |O nTraReal ! #labtraba#1;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI nCenReal ! #labtraba#77;
          |ACABA;
     |FINSI;

     #199#0 = #labtraba#36;        || fecha de alta
     #199#1 = #labtraba#0;         || codigo empresa
     #199#2 = #labtraba#1;         || codigo trabajador
     #199#3 = #labtraba#37;        || fecha de baja
     |GRABA 020#199n;
|FPRC;

|DEFBUCLE GrabaTMP;
     #labtraba#1;
     7;
     #0#0, 00001, aNif;
     #0#0, 99999, aNif;
     ;
     NULL, GrabaTMP;
|FIN;

|PROCESO GrabaPorNIF;
     |NOME_DAT #199 alfa1;
     |DELINDEX #199;
     |ABRE #199;
     |BUCLE GrabaTMP;
     |CIERRA #199;
|FPRC;

|PROCESO BuscaTrab;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     aNif = #labtraba#7;

     aAlfa = #labtraba#34;
     fFecAntig = aAlfa;
     aAlfa = #labtraba#36;
     fFecAltaLim = aAlfa;
     |CIERRA #labtraba;
|FPRC;

|PROCESO temporal;
     |SI aEmision ! "XML";
          |ATRI P;
          |MENSA "    Preparando Temporal ...";
          |ATRI 0;
     |FINSI;

     alfa1 = Usuario;     alfa1 = (alfa1 + "zzzzzzzz") % 108;
     |NOME_DAT #7 alfa1;
     |DELINDEX #7;
     |ABRE #7;

     nEmpReal = #0#0;
     nTraReal = #0#1;
     nCenReal = #0#2;

     |HAZ BuscaTrab;          || una vez para buscar la fecha de alta
     aNif = #labtraba#7;

     alfa1 = Usuario;     alfa1 = (alfa1 + "eeeeeeee") % 108;

     |HAZ GrabaPorNIF;
     |HAZ BuscaTrab;          || otra vez para lee el trabajador que me interesa
                              || si no se pueden provocar errores
     |BUCLE PorNIF;
     |CIERRA #7;

     |SI aEmision ! "XML";
          |ATRI R;
          |BLIN 4;
          |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO control;
     |ABRE #labcontr;
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;
|FPRC;

|PROCESO imprime; |TIPO 3;
     |SI aParam = "";
          |HAZ GrabaLabtraba;
     |FINSI;
     |HAZ control;
     |HAZ temporal;
     |ABRE #6;
     |ABRE #nomcalli;
     |HAZ fechafir;
     |HAZ estados;
     |HAZ domicili;
     |HAZ decret;
     |HAZ sibaja;
     |HAZ lee_silcon;
     |HAZ cotiza;

     |HAZ nobaja;
     |CIERRA #6;
     |CIERRA #nomcalli;
     |DELINDEX #7;

     |SI aEmision ! "XML";
          |SI aEmision = "IMP";    || vengo del labimpce
               |HAZ Impresion;
          |SINO;
               nOpcion = 99;
               |PARA; |SI nOpcion ! 5; |Y nOpcion ! 0; |Y nOpcion ! -1; |HACIENDO;
                    |HAZ Impresion;
               |SIGUE;
          |FINSI;
     |SINO;
          || vengo del labimpce
          enSwHisto = 1;
          aRegimen = "G";
          enEmp = #0#0;
          enTra = #0#1;
          |HAZ GeneraXML;
     |FINSI;
|FPRC;

|PROCESO fechafir;                         || DESGLOSE DE FECHA DE FIRMA
     |SI #0#10 ! vpuntos; |Y #0#10 ! vblanco;
          fec1 = #0#10;
          aAlfa = #0#10 % 402;
          nMess = aAlfa
          |HAZ PasaAletras;
          dia1 = fec1 % 102;
          any1 = fec1 % 704;
          dia = dia1;
          mes = aAlfa1;
          any = any1;
     |FINSI;
|FPRC;

|PROCESO meseslet;               || RUTINA GENERAL DE TRANSFORMACION
     dia1 = fec1 % 102;           || DE FECHAS A LETRAS
     any1 = fec1 % 704;
     fec1 = fec1 % 402;
     fec2 = fec1;
     |SI fec2 = 1;  meslet = "ENE";   |FINSI;
     |SI fec2 = 2;  meslet = "FEB";   |FINSI;
     |SI fec2 = 3;  meslet = "MAR";   |FINSI;
     |SI fec2 = 4;  meslet = "ABR";   |FINSI;
     |SI fec2 = 5;  meslet = "MAY";   |FINSI;
     |SI fec2 = 6;  meslet = "JUN";   |FINSI;
     |SI fec2 = 7;  meslet = "JUL";   |FINSI;
     |SI fec2 = 8;  meslet = "AGO";   |FINSI;
     |SI fec2 = 9;  meslet = "SEP";   |FINSI;
     |SI fec2 = 10; meslet = "OCT";   |FINSI;
     |SI fec2 = 11; meslet = "NOV";   |FINSI;
     |SI fec2 = 12; meslet = "DIC";   |FINSI;
|FPRC;

|PROCESO estados;             || DECODIFICA ESTADO CIVIL
|ABRE #10;
    #10#0 = #2#0;
    #10#1 = #2#1;
|LEE 000#10=;
|SI FSalida ! 0;
    |SI #2#29 < 2; estado = "soltero/a"; |FINSI;
    |SI #2#29 > 1; estado = "casado/a";  |FINSI;
|SINO;
    |SI #10#4 = "S";     estado = "soltero/a"; |FINSI;
    |SI #10#4 = "C";     estado = "casado/a";  |FINSI;
|FINSI;
|CIERRA #10;
|FPRC;

|PROCESO diaanter;                          || RUTINA DEL CALCULO duracion
|SI xmesnume = 1;
        xtopemes = 31;
|FINSI;
|SI xmesnume = 2;
        xmod = xanynume $ 4;
    |SI xmod = 0;
            xtopemes = 29;
    |SINO;
            xtopemes = 28;
    |FINSI;
|FINSI;
|SI xmesnume = 3;   xtopemes = 31; |FINSI;
|SI xmesnume = 4;   xtopemes = 30; |FINSI;
|SI xmesnume = 5;   xtopemes = 31; |FINSI;
|SI xmesnume = 6;   xtopemes = 30; |FINSI;
|SI xmesnume = 7;   xtopemes = 31; |FINSI;
|SI xmesnume = 8;   xtopemes = 31; |FINSI;
|SI xmesnume = 9;   xtopemes = 30; |FINSI;
|SI xmesnume = 10;  xtopemes = 31; |FINSI;
|SI xmesnume = 11;  xtopemes = 30; |FINSI;
|SI xmesnume = 12;  xtopemes = 31; |FINSI;
|FPRC;

|PROCESO domicili;                    || RUTINA DEL CALCULO actualiz
     direcc = #1#3;                    || PARA CONSTRUCCION DOMICILIOS
     numero = #1#4;
     piso = #1#5;
     locali = "";
     |HAZ compac;
     domemp = compactado;              || domicilio empresa

     direcc = #2#3;
     numero = #2#4;
     piso = #2#5;
     locali = "";
     |HAZ compac;
     domtra = compactado;              || domicilio trabajador

     |SI #1#3 ! #3#3; |O #1#4 ! #3#4; |O #1#5 ! #3#5;
          direcc = #3#3;
          numero = #3#4;
          piso = #3#5 + " " + barra + " ";
          locali = #3#6;
          |HAZ compac;
          domcen = compactado;              || domicilio centro trabajo
     |FINSI;
|FPRC;

|PROCESO compac;                      || SUBRUTINA DE RUTINA domicili
    compactado = "";                  || DE COMPACTACION DE CAMPOS
|QBF direcc;
|QBF numero;
|QBF piso;
|QBF locali;
    compactado = direcc + coma + " ";
    compactado = compactado + numero;
    compactado = compactado + " - ";
    compactado = compactado + piso;
    compactado = compactado + " " + locali;
|FPRC;

|PROCESO lee_silcon;
    silcon1 = "";
    silcon2 = "";
    silcon3 = "";
    silcon4 = "";
    silcon5 = "";
|DDEFECTO #30;
|ABRE #30;
    #30#0 = #0#0;
|LEE 000#30=;
|SI FSalida = 0;
        silcon1 = "(NO ACOMPA¥A TC2" + &59;
        silcon2 = "Aut.TGSS";
        silcon3 = "del";
        silcon4 = #30#5;                || nro.autorizacion SILCON
        silcon5 = #30#6 + ")";          || fecha autorizacion SILCON
        || cargo ya observaciones para PDF
        aObservacion = "NO ACOMPA¥A TC2 NI TA2/S";
        aObservacion1 = "Autorizacion TGSS";
        aObservacion2 = "Numero " + silcon4;
        aObservacion3 = "Fecha: " + silcon5;
        aObservacion3 = aObservacion3 - ")";
|FINSI;
|CIERRA #30;
|FPRC;

|PROCESO decret;
|ABRET #4;
    #4#0 = #2#45;
|LEE 000#4=;
|CIERRAT #4;
|FPRC;

|PROCESO paramfiniq;
     sw_finiq = 0;
     nBaseCC_Fin = 0;
     nBaseCP_Fin = 0;
     |ABRE #nomcontr;
     #nomcontr#0 = 1;
     |LEE 000#nomcontr.=;
     |SI FSalida = 0;
          |SI #nomcontr#1 = "S";     ||vacaciones cotizables (125)
               sw_finiq = 1;
          |FINSI;
     |FINSI;
     |SI sw_finiq = 1;             || si vacaciones cotizables
          |SI #labempre#39 = 1;    || finiquito con recibo mes
               sw_finiq = 1;
          |SINO;                   || finiquito separado
               sw_finiq = 2;
          |FINSI;
     |FINSI;
     |CIERRA #nomcontr;
|FPRC;

|PROCESO finiquito3;
          ||SI nTipo = 2;          || recibo separado
                                   || siempre, por si el parametro cambia
               |ABRE #nomcalca;
               |ABRE #nomhicca;
               #nomcalca#0 = nEmp;
               #nomcalca#1 = nTra;
               #nomcalca#2 = nMes;
               #nomcalca#3 = 2;
               |LEE 000#nomcalca.=;
               |SI FSalida = 0;
                    #0#71 = #0#71 + #nomcalca#39;
                    #0#72 = #0#72 + #nomcalca#40;
               |SINO;
                    #nomhicca#0 = nEmp;
                    #nomhicca#1 = nTra;
                    #nomhicca#66 = nAnyo;
                    #nomhicca#2 = nMes;
                    #nomhicca#3 = 2;
                    |LEE 000#nomhicca.=;
                    |SI FSalida = 0;
                         #0#71 = #0#71 + #nomhicca#39;
                         #0#72 = #0#72 + #nomhicca#40;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalca;
               |CIERRA #nomhicca;
          ||FINSI;

          |PARA nTipo = 0; |SI nTipo [ 2; |HACIENDO nTipo = nTipo + 2;
               |ABRE #nomcalli;
               |ABRE #nomhicli;
               #nomcalli#0 = nEmp;
               #nomcalli#1 = nTra;
               #nomcalli#2 = nMes;
               #nomcalli#3 = nTipo;
               #nomcalli#4 = 125;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    #0#70 = #0#70 + (#nomcalli#11 + 0.49) ! 0;
                    |SI nTipo = 0;
                         #0#71 = #0#71 + ((#nomcalli#10 * #nomcalli#11) ! EURODB);
                         #0#72 = #0#71;
                    |FINSI;
               |SINO;
                    #nomhicli#0 = nEmp;
                    #nomhicli#1 = nTra;
                    #nomhicli#12 = nAnyo;
                    #nomhicli#2 = nMes;
                    #nomhicli#3 = nTipo;
                    #nomhicli#4 = 125;
                    |LEE 000#nomhicli.=;
                    |SI FSalida = 0;
                         #0#70 = #0#70 + (#nomhicli#11 + 0.49) ! 0;
                         |SI nTipo = 0;
                              #0#71 = #0#71 + ((#nomhicli#10 * #nomhicli#11) ! EURODB);
                              #0#72 = #0#71;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalli;
               |CIERRA #nomhicli;

               |ABRE #nomcalli;
               |ABRE #nomhicli;
               #nomcalli#0 = nEmp;
               #nomcalli#1 = nTra;
               #nomcalli#2 = nMes;
               #nomcalli#3 = nTipo;
               #nomcalli#4 = 421;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    #0#70 = #0#70 + (#nomcalli#11 + 0.49) ! 0;
                    |SI nTipo = 0;
                         #0#71 = #0#71 + ((#nomcalli#10 * #nomcalli#11) ! EURODB);
                         #0#72 = #0#71;
                    |FINSI;
               |SINO;
                    #nomhicli#0 = nEmp;
                    #nomhicli#1 = nTra;
                    #nomhicli#12 = nAnyo;
                    #nomhicli#2 = nMes;
                    #nomhicli#3 = nTipo;
                    #nomhicli#4 = 421;
                    |LEE 000#nomhicli.=;
                    |SI FSalida = 0;
                         #0#70 = #0#70 + (#nomhicli#11 + 0.49) ! 0;
                         |SI nTipo = 0;
                              #0#71 = #0#71 + ((#nomhicli#10 * #nomhicli#11) ! EURODB);
                              #0#72 = #0#71;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalli;
               |CIERRA #nomhicli;
          |SIGUE;
|FPRC;

|PROCESO PorNIF3;
     fFecAltaTra = #199#0;
     |SI #0#77 = "S";
          |SI fFecAltaTra [ fFecAltaLim;
               nEmp = #199#1;
               nTra = #199#2;
               |HAZ finiquito3;
          |FINSI;
     |SINO;
          |SI fFecAltaTra = fFecAltaLim;
               nEmp = #199#1;
               nTra = #199#2;
               |HAZ finiquito3;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE PorNIF3;
     #199#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PorNIF3;
|FIN;

|PROCESO finiquito; |TIPO 0;
     |SI #0Campo = Contenido;
          |ACABA;
     |FINSI;

     #0#70 = 0;
     #0#71 = 0;
     #0#72 = 0;

     fecalf = #0#8;
     |HAZ desglosa;
     nMes = mesq;
     nAnyo = anyq;
     |SI nAnyo ] 2000;            || a¤o para buscar en el historico
          nAnyo = nAnyo - 2000;
     |SINO;
          nAnyo = nAnyo - 1900;
     |FINSI;

     |HAZ paramfiniq;

     |SI sw_finiq ! 0;
          |SI sw_finiq = 1;             || recibo junto
               nTipo = 0;
          |SINO;
               nTipo = 2;
          |FINSI;
          aNif = #labtraba#7;
          |HAZ BuscaTrab;

          alfa1 = Usuario;     alfa1 = (alfa1 + "oooooooo") % 108;
          |HAZ GrabaPorNIF;
          |HAZ BuscaTrab;

          |BUCLE PorNIF3;
     |FINSI;

     |PINTA #0#70;
     |PINTA #0#71;
     |PINTA #0#72;
|FPRC;

|PROCESO BuscaOtro2;
     nNume = #8#2;
     aMesNuevo = nNume;
     aMesNuevo = ("00" + aMesNuevo) % -102;
     aMesExiste = #7#3 % 402;

     |SI aMesNuevo = aMesExiste;
          swYaExiste = 1;
          nOtraEmp = #7#0;
          nOtroTra = #7#1;
          nOtraLin = #7#2;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaOtro2;
     #7#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BuscaOtro2;
|FIN;

|PROCESO GuardaTra;           || esto es una chapuza necesaria para que
     |SI nBorraTra1 = 0;      || luego se borren las cabeceras del labbasec
          nBorraTra1 = nTra;  || que he tenido que ir grabando
          |ACABA;             || con una sobraria, permito tres
     |FINSI;
     |SI nBorraTra2 = 0;
          nBorraTra2 = nTra;
          |ACABA;
     |FINSI;
     |SI nBorraTra3 = 0;
          nBorraTra3 = nTra;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO ulti_dia_cer;  || halla el ultimo dia del mes
    numer = anynum $ 4;
|SI numer = 0;
        bisiesto = 1;
|SINO;
        bisiesto = 0;
|FINSI;
|SI mesnum =  1;  topemes = 31;            |FINSI;
|SI mesnum =  2;  topemes = 28 + bisiesto; |FINSI;
|SI mesnum =  3;  topemes = 31;            |FINSI;
|SI mesnum =  4;  topemes = 30;            |FINSI;
|SI mesnum =  5;  topemes = 31;            |FINSI;
|SI mesnum =  6;  topemes = 30;            |FINSI;
|SI mesnum =  7;  topemes = 31;            |FINSI;
|SI mesnum =  8;  topemes = 31;            |FINSI;
|SI mesnum =  9;  topemes = 30;            |FINSI;
|SI mesnum = 10;  topemes = 31;            |FINSI;
|SI mesnum = 11;  topemes = 30;            |FINSI;
|SI mesnum = 12;  topemes = 31;            |FINSI;
|FPRC;

|PROCESO PorCalendario;
     nDias = 0;

     |ABRE #nomtrcal;
     aAnyo = #gomdetjr#2;
     #nomtrcal#0 = #labtraba#156;       || defecto calendario laboral
     #nomtrcal#13 = aAnyo;
     |LEE 000#nomtrcal.=;
     nMes = #gomdetjr#3;
     aCalendario = #nomtrcal#nMes#;
     |CIERRA #nomtrcal;

     anynum = #gomdetjr#2;
     mesnum = #gomdetjr#3;
     |HAZ ulti_dia_cer;
     |PARA nDia = 1; |SI nDia [ topemes; |HACIENDO nDia = nDia + 1;
          nCampoDia = nDia + 3;
          |SI #gomdetjr#nCampoDia# = "X";
               nDias = nDias + 1;
          |FINSI;
          |SI #gomdetjr#nCampoDia# = "I";
               nCampo = nDia + 3;
               nNume1 = (nDia * 100) + 1;
               aAlfa1 = aCalendario % nNume1;
               |SI aAlfa1 = 1;
                    || era un dia de fiesta
               |SINO;
                    nDias = nDias + 1;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO DiasActividad;
     nDias = 0;

     |ABRE #gomdetjr;
     #gomdetjr#0 = #7#0;
     #gomdetjr#1 = #7#1;
     #gomdetjr#2 = nAnyJor;
     #gomdetjr#3 = nMesJor;
     |LEE 000#gomdetjr.=;
     |SI FSalida = 0;
          |SI #gomdetjr#35 ! 0;
               nDias = #gomdetjr#35;
          |SINO;
               |HAZ PorCalendario;
               nDias = nDias;
          |FINSI;
     |FINSI;
     |CIERRA #gomdetjr;
|FPRC;

|PROCESO citricos;
     nDias = 0;
     |SI swMensual = 1;
          nAnyJor = #nomcalca#184;
          nMesJor = #nomcalca#2;
     |SINO;
          aAlfa = #11#3 % -104;
          nAnyJor = aAlfa;
          aAlfa = #11#3 % 402;
          nMesJor = aAlfa;
     |FINSI;

     |HAZ DiasActividad;
     || nDias = 0;

     ||SI nDias = 0;
          || si por lo que sea, no encontraran dias en el calendario
          || sistema anterior

     || 07/03/2019
     || lo dejamos ahora de manera que haga caso al parametro
     || en teoria, esto NO es asi, porque al parecer, teniamos claro que
     || tenian que ir los dias reales trabajados en el certificado, pero
     || aunque segun lo que sabemos hasta ahora, segun una carta que nos
     || llego del SEPE y segun todo, hay que indicar en el certificado
     || LAS JORNADAS, pero Dany insiste en que no, que las jornadas son
     || para el ADT, pero realmente hay que poner los DIAS COTIZADOS en el
     || certificado.

     || lo que dice l tiene m s sentido, pero lo que nos han dicho siempre
     || es lo contrario, de hecho lo entendimos por fin aclarado en el
     || BNR 8/2016 y 2/2018, pero este tema vuelve conel tiquet 2884.4530

     || a partir de ahora en citricos pillar los d¡as del mensual y del
     || hist¢rico cotizados y punto, aunque en el fichero de bases seguir
     || cogiendo las jornadas, que es lo que actualizo del hist¢rico

     |SI swMensual = 1;
          |SI #nomcontr#76 = "2";
               || me quedo con el nDias calculado
/*
               || dias cotizados citricos JORNADAS

               nNume = 0;
               nDias = #nomcalca#10;
               |SI #labtraba#42 = "C";
                    nNume = (#nomcalca#56 / 1.61) ! 0;
               |FINSI;
               |SI #labtraba#42 = "F";
                    nNume = (#nomcalca#56 / 1.33) ! 0;
               |FINSI;
               nDias = nDias + nNume;
*/
          |SINO;
               nDias = #nomcalca#8;      || dias cotizados citricos DIAS
          |FINSI;
     |SINO;
          |ABRE #nomhicca;
          #nomhicca#0 = #0#0;
          #nomhicca#1 = #0#1;
          #nomhicca#2 = nMesJor;
          #nomhicca#3 = 0;
          #nomhicca#66 = nAnyJor - 2000;
          |LEE 000#nomhicca.=
          |SI FSalida = 0;
               |SI #nomcontr#76 = "2";
                    || me quedo con el nDias calculado

/*
                    || dias cotizados citricos JORNADAS

                    nNume = 0;
                    nDias = #nomhicca#10;
                    |SI #labtraba#42 = "C";
                         nNume = (#nomhicca#56 / 1.61) ! 0;
                    |FINSI;
                    |SI #labtraba#42 = "F";
                         nNume = (#nomhicca#56 / 1.33) ! 0;
                    |FINSI;
                    nDias = nDias + nNume;
*/
               |SINO;
                    nDias = #nomhicca#8;      || dias cotizados citricos DIAS
               |FINSI;
          |FINSI;
          |CIERRA #nomhicca;
     |FINSI;
     ||FINSI;
|FPRC;

|PROCESO sibaja3;
     #8#0 = #labtraba#0;   || empresa
     #8#1 = #labtraba#1;   || trabajador
     #8#2 = em;     || mes
     #8#3 = 0;      || tipo
     |LEE 000#8=;
     |SI FSalida = 0;
          |SI swYaExiste = 0;
               || fm = fm + mas;   esta asi, lo quito porque no salia en algun caso
               fm = fm + 1;        || siempre sumo una linea, es lo normal si no existia
          |FINSI;
          #7#0 = nEmp;          || empresa
          #7#1 = nTra;          || trabajador
          #7#2 = fm;            || linea

          |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
               swMensual = 1;
               || solo cuando vengo del mensual, desde historico, ya se coge
               || del lineal de bases y este ya lo tiene que tener bien actua-
               || lizado (o no, ya veremos)
               |HAZ citricos;
               swMensual = 0;
               |SI nDias ! 0;
                    #7#4 = #7#4 + nDias;
               |FINSI;
          |SINO;
               #7#4 = #7#4 + #8#8;      || dias cotizados
          |FINSI;
          |SI swYaExiste = 1; |Y #7#4 > 31;  || bueno una forma cutre de
               #7#4 = #7#4 - #8#8;           || comprobar que no nos pasamos
          |FINSI;                            || de los dias (para fichas dobles)
          #7#7 = #7#7 + #8#39;     || base contin. comunes

          aAlfa = #0#8 % -104;
          nNume = aAlfa;
          swSigue = 0;
          |SI nNume [ 2012; swSigue = 1; |FINSI;
          |SI nNume = 2013; |Y #8#2 [ 10; swSigue = 1; |FINSI;
          |SI swSigue = 1;
               |SI #8#9 = 87; |O #8#9 = 421;
                    #8#40 = #8#40 / 0.75;
               |FINSI;
          |FINSI;
          #7#8 = #7#8 + #8#40;     || base desempleo
          |SI #labtraba#42 ! "X"; |Y #labtraba#42 ! "T";
          |Y #labtraba#42 ! "I"; |Y #labtraba#42 ! "P";
               #7#8 = #7#8 - #8#41 - #8#42;     || menos horas extras 2685.761
          |FINSI;

          |HAZ fecha;
          #7#3 = fecalf;        || fecha
          #7#5 = #8#11;         || horas contrato
          #7#6 = #8#9;          || tipo contrato
          |SI #8#65 ! 0; |O #8#131 ! 0;
               nume1 = #8#117 + #8#130 + #8#132;
               |SI nume1 = 0;
                    #7#7 = #7#7 + (#8#35 * #8#65);  || maternidad
                    #7#8 = #7#8 + (#8#35 * #8#65);
                    #7#7 = #7#7 + (#8#35 * #8#131);  || control IT
                    #7#8 = #7#8 + (#8#35 * #8#131);
               |SINO;
                    #7#7 = #7#7 + nume1;    || maternidad
                    #7#8 = #7#8 + nume1;    || control IT
               |FINSI;
          |FINSI;
          |SI #8#31 ! 0;
               |SI #labtraba#241 = "N"; |Y #labtraba#138 = "N";
                    #7#7 = #7#7 + #8#79;
                    #7#8 = #7#8 + #8#80;
               |FINSI;
          |FINSI;
          |SI #labtraba#241 = "N";
          |Y #8#132 = 0; || porque si hay algo aqui en Ctrol. IT y ademas
                         || tiene prestaciones "N" lo sumaria dos veces
               #7#7 = #7#7 + #8#62;     || base desempleo
               #7#8 = #7#8 + #8#62;     || base desempleo
          |FINSI;
          #7#9 = "";            || observaciones
          #7#10 = aNif;
/*
          || otra cosa que sobra ya
          |SI swDesem ! "M"; |O aRegul ! "S";
               || tengo ERE a TP y le digo que NO incluya los dias y las bases
               || para que salgan los dias completos y solo la base trabajada
               || a¤ado los dias de ERE 3923.243
               |PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;
                    nume2 = nume1 + 92;
                    |SI #nomcalca#nume2# ! 100;
                         nDiasDesemTP = #nomcalca#78;
                    |FINSI;
               |SIGUE;
               || #7#4 = #7#4 + nDiasDesemTP;          || dias
               || esto no tiene sentido, ya que si lo hago asi, no funciona
               || bien, le estoy sumando los dias de desempleo a TP y despues
               || en (*) estoy haciendo una operacion que me fastidia el calculo
          |FINSI;
*/
||DEBUG;
          ||SI #0#78 = 16; |O #0#78 = 17; |O #0#78 = 18;
               swSigue = 0;
               ||SI #nomcalca#27 = "D"; |Y #nomcalca#119 ! 100; swSigue = 1; |FINSI;
               ||SI #nomcalca#28 = "D"; |Y #nomcalca#120 ! 100; swSigue = 1; |FINSI;
               ||SI #nomcalca#29 = "D"; |Y #nomcalca#121 ! 100; swSigue = 1; |FINSI;
               ||SI #nomcalca#30 = "D"; |Y #nomcalca#122 ! 100; swSigue = 1; |FINSI;
               |SI #nomcalca#27 = "D";
               |O #nomcalca#28 = "D";
               |O #nomcalca#29 = "D";
               |O #nomcalca#30 = "D";
                    swSigue = 1;
               |FINSI;

               |SI swSigue = 1;
                    nMesHis = #8#2;
                    nAnyHis = #8#184;
                    ||HAZ MesERETP;
                    || #7#4 = #7#4 - #8#8; || quito los dias de alta que tenia la linea
                    || #7#4 = #7#4 + nDias;

                    |HAZ BasesSegunLineas;
                    #7#4 = nDias;

                    #7#7 = nBase;   || CC
                    #7#8 = nBase;   || CP
               |FINSI;
          ||FINSI;

          || tengo ERE y no quiero incluir los dias en ERE
          || solo quiero que tenga en cuenta hasta el dia que he puesto de baja
          || como es lo normal

/*
          |SI #0#78 = 16; |O #0#78 = 17; |O #0#78 = 18;
               || entiendo que esto era de la epoca en la que se guardaba
               || la base y los dias de ERE junto a los dias de alta y la base
               || en alta, ahora ya no tiene que hacer falta
               ||SI swDesem = "M";
               |SI aRegul = "N"; |Y swMarca = 0;
                    aAlfa = #0#8;
                    aAlfa = aAlfa % 102;
                    nNume = aAlfa;      || dias de alta

                   |SI swDesem = "M";
                         || (*)
                         #7#4 = #7#4 - #8#8; || quito los dias de alta que tenia la linea
                         #7#4 = #7#4 + nNume; || solo hasta el dia que empieza el ERE

                         #7#7 = ((#8#39 * nNume) / #8#8) ! EURODB;   || CC
                         #7#8 = ((#8#40 * nNume) / #8#8) ! EURODB;   || CP
                    |FINSI;
               |FINSI;
          |FINSI;
*/
          |SI swYaExiste = 0;
               |GRABA 020#7b;
               swYaExiste = 1;
          |SINO;
               |GRABA 020#7a;
          |FINSI;
          swactua = 1;    || para saber si hay que borrar o no
          #8#3 = 2;       || tipo (finiquitos)
          |LEE 000#8=;
          |SI FSalida = 0;
               #7#7 = #7#7 + #8#39;  || base contin. comunes
               #7#8 = #7#8 + #8#40;  || base desempleo
               |SI #8#65 ! 0;|Y #8#9 ! 87;|Y #8#9 ! 97;|Y #8#9 ! 85;
                    #7#7 = #7#7 + (#8#35 * #8#65);  || maternidad
                    #7#8 = #7#8 + (#8#35 * #8#65);
               |FINSI;
               |GRABA 020#7a;
          |FINSI;
          |LIBERA #7;
     |FINSI;
|FPRC;

|PROCESO PorNIF2;
     |SI #0#77 = "N";
          |SI nEmpReal ! #labtraba#0; |O nTraReal ! #labtraba#1;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI nCenReal ! #labtraba#77;
          |ACABA;
     |FINSI;
     aAlfa = #labtraba#36;
     fFecAltaTra = aAlfa;
     |SI #0#77 = "S";
          |SI fFecAltaTra [ fFecAltaLim;
               || nEmp = #labtraba#0;
               || nTra = #labtraba#1;
               |HAZ sibaja3;
          |FINSI;
     |SINO;
          |SI fFecAltaTra = fFecAltaLim;
               || nEmp = #labtraba#0;
               || nTra = #labtraba#1;
               |HAZ sibaja3;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE PorNIF2;
     #labtraba#7;
     ;
     aNif, #0#0, 00001;
     aNif, #0#0, 99999;
     ;
     NULL, PorNIF2;
|FIN;

|PROCESO sibaja2;
     |HAZ BuscaTrab;          || una vez para buscar la fecha de alta
     aNif = #labtraba#7;
     |BUCLE PorNIF2;
     |HAZ BuscaTrab;          || otra vez para lee el trabajador que me interesa
                              || si no se pueden provocar errores
|FPRC;

|PROCESO sibaja;  || actualiza el mes que esta calculado
     swactua = 0;
     swcabec = 0;
     |SI #0#8 ! ".........."; |Y #0#8 ! "          "; |Y #0#8 ! "";
          #6#0 = nEmp;
          #6#1 = nTra;
          |LEE 000#6=;
          |SI FSalida ! 0;
               |HAZ ultimo;  || aqui tambien hace falta
               #6#0 = nEmp;
               #6#1 = nTra;
               |GRABA 020#6n;

               |HAZ GuardaTra;

               #7#3 = #2#36;  || carga la fecha de alta
               swcabec = 1;
               mas = 0;
          |SINO;
               |HAZ ultimo;
               mas = 1;
          |FINSI;
          fecalf=#7#3; |HAZ desglosa; dm=mesq;
          fecalf=#0#8; |HAZ desglosa; hm=mesq; mesbaja=mesq; diabaja=diaq;
          |SI dm ! hm;|O swcabec = 1;
               |SI hm < dm; gg = hm; hm = 999; |FINSI;
               |ABRE #7;
               |ABRE #8;
               |SI borrar1 = 0;
                    borrar1 = lineades + 1;   || lo guarda para borrarlo despues
               |FINSI;
               fm = lineades;            || contador de lineas
               stop = 0;
               |PARA em = dm + mas; |SI stop = 0; |HACIENDO em = em + 1;
                    |SI em = 13; em = 1; hm = gg; |FINSI;
                    |SI em [ hm;
                         #7#4 = 0;     || dias cotizados
                         #7#7 = 0;     || base contin. comunes
                         #7#8 = 0;     || base desempleo
                         swYaExiste = 0;
                         |HAZ sibaja2;
                         mas = 1;       || a ver, esto lo pongo aqui por un
                         || caso que me vino en que un trabajador que era
                         || alta en un mes y baja al mes siguiente y no tenia
                         || ninguna ficha actualizada daba error 100 al grabar
                         || porque grababa la misma linea dos veces, con esto
                         || se soluciona, espero que sin efectos secundarios
                         || ticket 3076.631 11.06.2007
                    |SINO;
                         stop = 1;
                    |FINSI;
               |SIGUE;
               |SI swcabec = 1;|Y swactua = 0;
                    #6#0 = #0#0;
                    #6#1 = #0#1;
                    |BORRA 020#6c;
               |FINSI;
               borrar2 = fm;   || para borrarlo despues
               |CIERRA #7;
               |CIERRA #8;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO finiq;
     aAnyo = #0#62;
     aMes = meslet;
     nume1 = puntero + 1;
     swSigue = 0;
     |SI nMes = fec2; |Y sw_dto = 0;
          swSigue = 1;
     |FINSI;
     |SI mesq = fec2;
          |SI aEmision = "IMP"; |O aEmision = "XML";
               swSigue = 1;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          #0#65 = #0#65 - #0#71;
          #0#66 = #0#66 - #0#72;
          sw_dto = 1;
     |FINSI;
|FPRC;

|PROCESO AplicaDes;
||DEBUG;
    |SI nMesRealDesem = fec2; |Y nAnyRealDesem = #0#62;
          |SI swDesem = "M"; |Y aRegul = "S";
               #0#64 = #0#64 + nDiasDesem;          || dias
               #0#65 = #0#65 + (nDiasDesem * nBaseDesem);          || base C.C.
               #0#66 = #0#66 + (nDiasDesem * nBaseDesem);          || base C.P.
          |FINSI;
          |SI swDesem = "H"; |Y aRegul = "N";
               || trato distinto para cuando es el mes completo que para
               || cuando es una fecha determinada (hasta el primer dia
               || antes de que comience el ERE)
               |SI swMarca = 0;
                    nDiasRealesAlta = #0#64 - nDiasRealesDesem;
                    #0#64 = #0#64 - nDiasDesem;          || dias
                    #0#65 = #0#65 - (nDiasRealesDesem * nBaseDesem);          || base C.C.
                    #0#66 = #0#66 - (nDiasRealesDesem * nBaseDesem);          || base C.P.

                    #0#65 = ((#0#65 * #0#64) / nDiasRealesAlta) ! EURODB;   || CC
                    #0#66 = ((#0#66 * #0#64) / nDiasRealesAlta) ! EURODB;   || CC
               |SINO;
                    #0#64 = #0#64 - nDiasDesem;          || dias
                    #0#65 = #0#65 - (nDiasDesem * nBaseDesem);          || base C.C.
                    #0#66 = #0#66 - (nDiasDesem * nBaseDesem);          || base C.P.
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cotiza;
     #6#0 = nEmp;
     #6#1 = nTra;
     |LEE 000#6=;
     |SI FSalida = 0;
          |HAZ ultimo;

          ||INFOR "labcerti";
          |ABRE #7;
          |HAZ hasta;

          ||_________ADRIAN:
          cont = 0; ||guarda el n§ de linea
          |PARA vcampo = lineahas; |SI vcampo [ lineades; |HACIENDO vcampo = vcampo + 1;
               #7#10 = aNif;
               #7#2 = vcampo;
               |LEE 000#7=;

               cont = cont + 1;   ||guarda el n§ de linea

               alfa1 = #7#3 % -104;
               #0#62 = alfa1;         || a¤o
               fec1 = #7#3; |HAZ meseslet;

               #0#63 = meslet;        || mes (en letra)
               #0#64 = #7#4;          || dias
               #0#65 = #7#7;          || base C.C.
               #0#66 = #7#8;          || base C.P.
               #0#67 = #7#9;          || observaciones
               alfa1 = #0#67;
               alfa1 = alfa1 % 104;
               |SI alfa1 = "Fini"; #0#67 = ""; |FINSI;
               sw_dto = 0;
               |HAZ finiq;

               || nunca mas
               ||HAZ AplicaDes;
               |SI cont = 1;
                    #0#64 = #0#64 - nExceso; || dias
                    #0#65 = ((#0#65 * #0#64) / #7#4) ! EURODB;   || CC
                    #0#66 = ((#0#66 * #0#64) / #7#4) ! EURODB;   || CP

                    || ESTO para los casos en que el primer mes (el ultimo que
                    || se lee mirando hacia detras), tenga DOS fichas, para que
                    || salga la base correcta, me he guardado antes el traba-
                    || jador, los dias y las bases
                    |SI #7#11 ! #7#1;   || no deberia ser de otra manera
                    |Y #7#11 ! 00000;
                         || cambiamos el calculo
                         || en #0#64 estan los dias que han de salir este mes
                         |SI #0#64 [ #7#12;
                              || todos en el "segundo" trabajador
                              #0#65 = ((#7#13 * #0#64) / #7#12) ! EURODB;   || CC
                              #0#66 = ((#7#14 * #0#64) / #7#12) ! EURODB;   || CP
                         |SINO;
                              || todos los del segundo trabajador y algunos del
                              || primero
                              nBaseCC1 = #7#13;
                              nBaseCP1 = #7#14;
                              nBaseCC2 = #7#7 - #7#13;
                              nBaseCP2 = #7#8 - #7#14;
                              nDias2 = #0#64 - #7#12;
                              nDias2Reales = #7#4 - #7#12;
                              nBaseCC2 = ((nBaseCC2 * nDias2) / nDias2Reales) ! 2;
                              nBaseCP2 = ((nBaseCP2 * nDias2) / nDias2Reales) ! 2;
                              #0#65 = nBaseCC1 + nBaseCC2;
                              #0#66 = nBaseCP1 + nBaseCP2;
                         |FINSI;
                    |FINSI;

                    |SI #0#64 < 0;      || si en la linea 1 no tengo dias
                         nExceso = nExceso - #7#4; || guardo exceso
                         cont = 0;      || y no pinta nada
                    |FINSI;
               |FINSI;

              || aqui HACEMOS PARA LAS LINEAS DE LA 1 A LA 7
              |SI cont = 1;   ||primera linea;
              |Y #0#64 ! 0;
                   nAnyo1 = #0#62;
                   aMes1 = #0#63;
                   nDiasCot1 = #0#64 ! 0;
                   nBaseCotCC1 = #0#65;
                   nBaseCotDes1 = #0#66;
                   || aObservacion1 = #0#67;
              |FINSI;
              |SI cont = 2;   ||segunda linea;
              |Y #0#64 ! 0;
                   nAnyo2 = #0#62;
                   aMes2 = #0#63;
                   nDiasCot2 = #0#64 ! 0;
                   nBaseCotCC2 = #0#65;
                   nBaseCotDes2 = #0#66;
                   || aObservacion2 = #0#67;
              |FINSI;
              |SI cont = 3;   ||tercera linea;
              |Y #0#64 ! 0;
                   nAnyo3 = #0#62;
                   aMes3 = #0#63;
                   nDiasCot3 = #0#64 ! 0;
                   nBaseCotCC3 = #0#65;
                   nBaseCotDes3 = #0#66;
                   || aObservacion3 = #0#67;
              |FINSI;
              |SI cont = 4;   ||cuarta linea;
              |Y #0#64 ! 0;
                   nAnyo4 = #0#62;
                   aMes4 = #0#63;
                   nDiasCot4 = #0#64 ! 0;
                   nBaseCotCC4 = #0#65;
                   nBaseCotDes4 = #0#66;
                   || aObservacion4 = #0#67;
              |FINSI;
              |SI cont = 5;   ||quinta linea;
              |Y #0#64 ! 0;
                   nAnyo5 = #0#62;
                   aMes5 = #0#63;
                   nDiasCot5 = #0#64 ! 0;
                   nBaseCotCC5 = #0#65;
                   nBaseCotDes5 = #0#66;
                   || aObservacion5 = #0#67;
              |FINSI;
              |SI cont = 6;   ||sexta linea;
              |Y #0#64 ! 0;
                   nAnyo6 = #0#62;
                   aMes6 = #0#63;
                   nDiasCot6 = #0#64 ! 0;
                   nBaseCotCC6 = #0#65;
                   nBaseCotDes6 = #0#66;
                   || aObservacion6 = #0#67;
              |FINSI;
              |SI cont = 7;   ||septima linea;
              |Y #0#64 ! 0;
                   nAnyo7 = #0#62;
                   aMes7 = #0#63;
                   nDiasCot7 = #0#64 ! 0;
                   nBaseCotCC7 = #0#65;
                   nBaseCotDes7 = #0#66;
                   || aObservacion7 = #0#67;
              |FINSI;
              |SI sw_dto = 1; |Y cont > 0;  || aqui para la 8
                   nDiasCot8 = #0#70 ! 0;
                   nBaseCotCC8 = #0#71;
                   nBaseCotDes8 = #0#72;
              |FINSI;
              |SI aEmision = "IMP"; |O aEmision = "MAN";
              || si estoy imprimiendo desde historico debe sacar siempre
              || que hay la cotizacion por vacaciones, si no pongo esto
              || no sale por problemas con la variable sw_dto, lo dejo asi
                   nDiasCot8 = #0#70 ! 0;
                   nBaseCotCC8 = #0#71;
                   nBaseCotDes8 = #0#72;
              |FINSI;
               |SI cont > 0;
                    #0#56 = #0#56 + #0#64;      || total dias
                    #0#57 = #0#57 + #0#65;      || total bases C.C.
                    #0#58 = #0#58 + #0#66;      || total bases C.P.
                    puntero = puntero + 1;
               |FINSI;
               |SI puntero = #0#61;  |SAL;     |FINSI;
          |SIGUE;
     |FINSI;

     #0#56 = #0#56 + #0#70;      || total dias
     #0#57 = #0#57 + #0#71;      || total bases C.C.
     #0#58 = #0#58 + #0#72;      || total bases C.P.
     |CIERRA #7;
|FPRC;

|PROCESO cierra_informe;
|PARA para1 = puntero + 1; |SI para1 [ #0#61; |HACIENDO para1 = para1 + 1;
    |PDEFECTO #0, 62, 68;
    |PRINT;
|SIGUE;
|PIEINF;
|FININF;
    #0#56 = 0;
    #0#57 = 0;
    #0#58 = 0;
    puntero = 0;
|FPRC;

|PROCESO borrado_parche;
     #6#0 = #7#0;
     #6#1 = nBorraTra1;
     |LEE 101#6=;
     |SI FSalida = 0;    || la borro
          |BORRA 020#6a;
     |FINSI;

     #6#0 = #7#0;
     #6#1 = nBorraTra2;
     |LEE 101#6=;
     |SI FSalida = 0;    || la borro
          |BORRA 020#6a;
     |FINSI;

     #6#0 = #7#0;
     #6#1 = nBorraTra3;
     |LEE 101#6=;
     |SI FSalida = 0;    || la borro
          |BORRA 020#6a;
     |FINSI;
|FPRC;

|PROCESO borra;
     |BORRA 020#7a;
     |ABRE #11;
     #11#0 = #7#0;
     #11#1 = #7#1;
     #11#2 = 1;
     |LEE 101#11=;
     |SI FSalida ! 0;    || es una cabecera en el labbasec sin lineas
          #6#0 = #7#0;
          #6#1 = #7#1;
          |LEE 101#6=;
          |SI FSalida = 0;    || la borro
               |BORRA 020#6a;
          |FINSI;
     |FINSI;
     |CIERRA #11;
|FPRC;

|DEFBUCLE borra;
     #7#2;
     ;
     aNif, borrar1;
     aNif, borrar2;
     be;
     NULL, borra;
|FIN;

|PROCESO nobaja;   || borra la(S) actualizacion(ES) pendiente(S)
     |SI swactua = 1;
          |BUCLE borra;
          |HAZ borrado_parche;
     |FINSI;
|FPRC;

*****************************************************************************
    SUBRUTINAS
*****************************************************************************

|PROCESO cuenta1;
    lineades = #7#2;
|FPRC;

|DEFBUCLE cuenta;
 #7#1;
 ;
 #6#0, #6#1,   1;
 #6#0, #6#1, 999;
 ;
 NULL, cuenta1;
|FIN;

|PROCESO ultimo;     || RUTINA PARA SABER DE DONDE EMPEZAR A LEER (POR DETRAS)
     lineades = 0;

     |DDEFECTO #7;
     |ABRE #7;
     |SELECT #2#7;
     |LEE 000#7u;             || con el temporal ya no hace falta leer con -BUCLE
     lineades = #7#2;
     |CIERRA #7;

     |SI #0#69 < lineades;
          lineades = #0#69;
     |FINSI;
|FPRC;

|PROCESO AplicaDes2;
     |SI swDesem = "M"; |Y aRegul = "S";
          dd = dd + nDiasDesem;
     |FINSI;
     |SI swDesem = "H"; |Y aRegul = "N";
          |SI swMarca = 0;
               || realmente no se por que pero desde el historico me llevaba
               || un dia menos para este caso, se lo pongo aqui
               nDiasDesem = nDiasDesem + 1;
          |FINSI;
          || dd = dd - nDiasDesem;
     |FINSI;
|FPRC;

|PROCESO hasta;      || RUTINA PARA SABER HASTA DONDE LEER SEGUN >180 o EOF
     ||SI #0#60 = "S";  fecsys = #2#36;   dias_alta = fecsys;    |FINSI;
     |SI #0#60 = "N";                    dias_alta = 0;         |FINSI;
     cc = 0;
     dd = 0;
     |HAZ AplicaDes2;
     lineahas = 0;

     || #7#0 = #6#0;
     || #7#1 = #6#1;
     || #7#2 = lineades;
     #7#10 = aNif;
     #7#2 = lineades;
     |SELECT #2#7;
     |LEE 000#7=;
     fecsys = #7#3;   dias_coti = fecsys;
     |PARA; |SI FSalida = 0; |Y dd < #0#68;
                             |Y cc < #0#61;
                             |Y #7#2 ] #0#59;
                             |Y dias_coti ] dias_alta; |HACIENDO;

          cc = cc + 1;
          dd = dd + #7#4;
          #7#2 = #7#2 - 1;

          |LEE 000#7=;
          fecsys = #7#3;   dias_coti = fecsys;
     |SIGUE;

     lineahas = #7#2 + 1;

     nNume = dd + #0#70;
     |SI nNume > #0#68;
          nExceso = dd - #0#68 + #0#70;
     |FINSI;
|FPRC;

|PROCESO desglosa;
    alfa1 = fecalf % 102;  diaq = alfa1;
    alfa1 = fecalf % 402;  mesq = alfa1;
    alfa1 = fecalf % 704;  anyq = alfa1;
|SI alfa1 = "....";
        diaq = 0;
        mesq = 0;
        anyq = 0;
|FINSI;
|FPRC;

|PROCESO fecha;
|SI mesbaja ! #8#2;
    alfa1=#8#7;
|SINO;
    alfa1=diabaja;
|FINSI;
                alfa1="00"+alfa1; alfa1=alfa1%-102;  fecalf=alfa1+".";
    alfa1=#8#2; alfa1="00"+alfa1; alfa1=alfa1%-102;  fecalf=fecalf+alfa1+".";
    alfa1=#0#8%-104;
    nume1=alfa1;
|SI mesbaja ! #8#2; |Y em > mesbaja;
        nume1=nume1-1;
|FINSI;
    alfa1=nume1;                                     fecalf=fecalf+alfa1;
|FPRC;

|PROCESO vacac;
     fFecha_Alta = #2#36;
     fFecha_Baja = #0#8;
     nFecha_Alta = fFecha_Alta;
     nFecha_Baja = fFecha_Baja;
     nDias_Alta = nFecha_Baja - nFecha_Alta;

     nDias_Vac = (nDias_Alta / 365) * 30;
     nDias_Vac = nDias_Vac ! 0;
     nDias_Vac = nDias_Vac - #2#173;
     |SI nDias_Vac < 0;     nDias_Vac = 0;     |FINSI;

     #0#70 = nDias_Vac;
     |PINTA #0#70;
|FPRC;

||________PROCESO PARA LA IMPRESION DEL PDF

|PROCESO sustituye2;
     nAscii = & aCaracter;
     aCaracterSal = aCaracter;
     |SI nAscii = 160;             || el caracter  
          aCaracterSal = "\341";
     |FINSI;
     |SI nAscii = 130;             || el caracter 
          aCaracterSal = "\351";
     |FINSI;
     |SI nAscii = 161;             || el caracter ¡
          aCaracterSal = "\355";
     |FINSI;
     |SI nAscii = 162; |O nAscii = 243;            || el caracter ¢
          aCaracterSal = "\363";
     |FINSI;
     |SI nAscii = 163;             || el caracter £
          aCaracterSal = "\372";
     |FINSI;
     |SI nAscii = 164;             || el caracter ¤
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 241;             || el caracter ¤ (otro codigo ¨?)
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 165;             || el caracter ¥
          aCaracterSal = "\321";
     |FINSI;
     |SI nAscii = 129;
          aCaracterSal = "\374";   || el caracter u con dieresis
     |FINSI;
     |SI nAscii = 154;
          aCaracterSal = "\334";   || el caracter U (mayuscula) con dieresis
     |FINSI;
     |SI nAscii = 167;
          aCaracterSal = "\272";   || el caracter §
     |FINSI;
     |SI nAscii = 166;
          aCaracterSal = "\252";   || el caracter ¦
     |FINSI;
     |SI aCaracter = "(";
          aCaracterSal = "\(";
     |FINSI;
     |SI aCaracter = ")";
          aCaracterSal = "\)";
     |FINSI;
|FPRC;

|PROCESO sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca = (nPos * 100) + 1;
          aCaracter = aCadena % nBusca;
          |HAZ sustituye2;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO GrabaTemporal;
     aAlfa1 = aValor % 101;
     |SI aAlfa1 = ".";
          aValor = "";
     |FINSI;
     |QBF aValor;
     aCadena = aValor;
     |HAZ sustituye;
     aValor = aCadenaSal;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO CargaCampos;
     aValor = "";
     nTipo = 0;

     aCampo = "Texto1";               ||NOMBRE Y APELLIDOS PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#15;
     |HAZ GrabaTemporal;

     aCampo = "Texto2";              ||DNI O PASAPORTE DE LA PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#17;
     |QBF aValor;
     aValor = "con DNI o NIE: " + aValor;
     |HAZ GrabaTemporal;

     aCampo = "Texto3";            ||CARGO EN LA EMPRESA DE LA PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#18;
     |HAZ GrabaTemporal;

     aCampo = "Texto4";                ||NOMBRE EMPRESA
     aValor = #labempre#2;
     |HAZ GrabaTemporal;

     aCampo = "1";                || COD. CTA. COTIZACION
     aAlfa1 = #labcentr#10;
     |SI #labtraba#45 = "087"; |O #labtraba#45 = "421";
          |ABRE #nomcenes;
          #nomcenes#0 = #labtraba#0;
          #nomcenes#13 = #0#2;
          #nomcenes#1 = 87;
          |LEE 000#nomcenes.=;
          |SI FSalida = 0;
               aAlfa1 = #nomcenes#10;
          |FINSI;
          |CIERRA #nomcenes;
     |FINSI;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

/*
     aCampo = "1";                ||PRIMEROS DOS DIGITOS DE COD. CTA. COTIZACION
     aAlfa1 = #labcentr#10;
     aValor = aAlfa1 % 102;
     |HAZ GrabaTemporal;

     aCampo = "1'";               ||LOS 8 DIGITOS DE ENMEDIO DE COD. CTA. COTIZACION
     aAlfa1 = #labcentr#10;
     aValor = aAlfa1 % 307;
     |HAZ GrabaTemporal;

     aCampo = "1''";              ||LOS ULTIMOS DOS DIGITOS DE COD. CTA. COTIZACION
     aAlfa1 = #labcentr#10;
     |QBF aAlfa1;
     aValor = aAlfa1 % -102;
     |HAZ GrabaTemporal;
*/
     aCampo = "j";                ||DOMICILIO SOCIAL DE LA EMPRESA
     aValor = domemp;
     |HAZ GrabaTemporal;

     aCampo = "f";                ||LOCALIDAD EMPRESA
     aValor = #labempre#6;
     |HAZ GrabaTemporal;

     aCampo = "6";                ||CODIGO POSTAL DE LA EMPRESA
     aAlfa1 = #labempre#7; aAlfa1 = "00" + #labempre#7; aAlfa1 = aAlfa1 % -102;
     aAlfa2 = #labempre#8; aAlfa2 = "000" + #labempre#8; aAlfa2 = aAlfa2 % -103;
     aValor = aAlfa1 + aAlfa2;
     |HAZ GrabaTemporal;

     aCampo = "g";                ||PROVINCIA DE LA EMPRESA
     aValor = #labempre#9;
     |HAZ GrabaTemporal;

     aCampo = "h";                ||ACTIVIDAD ECONOMICA EMPRESA
     aAlfa1 = #labempre#128;       || CNAE empresa
     aAlfa2 = #labcentr#22;        || CNAE centro
     |QBF aAlfa1;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2; |Y aAlfa2 ! "";
          aValor = #labcentr#23;
          |QBF aValor;
          aValor = aAlfa2 + ". " + aValor;
     |SINO;
          aValor = #labempre#12;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "i";                ||NOMBRE Y APELLIDOS DEL TRABAJADOR
     aValor = #labtraba#2;
     |HAZ GrabaTemporal;

     || aCampo = "Texto5";               ||DNI O PASAPORTE DEL TRABAJADOR
     aCampo = "Texto5b";               ||DNI O PASAPORTE DEL TRABAJADOR
     aValor = #labtraba#7;
     |HAZ GrabaTemporal;

     aCampo = "1a";               ||PRIMEROS DOS DIGITOS DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

/*
     aCampo = "1a";               ||PRIMEROS DOS DIGITOS DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     aValor = aAlfa1 % 102;
     |HAZ GrabaTemporal;

     aCampo = "1C";               ||LOS 8 DIGITOS DE EN MEDIO DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     aValor = aAlfa1 % 308;
     |HAZ GrabaTemporal;

     aCampo = "1aa";              ||LOS DOS ULTIMOS DIGITOS DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     |QBF aAlfa1;
     aAlfa1 = aAlfa1 % -102;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;
*/

     aCampo = "9";                ||GRUPO COTIZACION
     aValor = #labtraba#33;
     |HAZ GrabaTemporal;

     aCampo = "l2";                ||DOMICILIO CTRO TRABAJO TRABAJADOR
     aValor = domcen;
     |HAZ GrabaTemporal;

     aCampo = "m";                ||TIPO DE CONTRATO
     aValor = #labtraba#45;
     aAlfa = #labcon00#1;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aValor = aValor + " - " + aAlfa;
     |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "\361";                ||PROFESION TRABAJADOR
     aValor = #labtraba#19;
     |HAZ GrabaTemporal;

     aCampo = "n";
     aValor = #labtraba#18;      ||CATEGORIA
     |HAZ GrabaTemporal;

     aCampo = "f1";               ||FECHA DE ALTA EN LA EMPRESA
     |SI fFecAltaLim ! fFecAntig;
          aAlfa1 = fFecAltaLim;
          aAlfa2 = fFecAntig;
          |SI aAlfa1 ! aAlfa2; |Y aParam = "";
               aAlfa = "    ATENCION: La fecha de alta (" + aAlfa1 + ") no coincide ";
               aAlfa = aAlfa + "con la fecha de antigüedad (" + aAlfa2 + ")";
               |MENAV aAlfa;
               aAlfa = "    SDesea imprimir la fecha de antiguedad en lugar de la de alta?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    fFecAltaLim = fFecAntig;
                    aFechaRef = fFecAltaLim;
                    |HAZ CalculaDuracion;
               |FINSI;
          |FINSI;
     |FINSI;
     aValor = fFecAltaLim;
     |HAZ GrabaTemporal;

     aCampo = "Texto11";                || DURACION DE CONTRATO
     aValor = aDuracion;
     |HAZ GrabaTemporal;

     || aCampo = "Texto8";               ||FECHA EXTINCION
     aCampo = "Texto19";               ||FECHA EXTINCION
     aValor = #labcerti#8;
     |HAZ GrabaTemporal;

     || aCampo = "Texto13";                ||CAUSA SITUACION LEGAL DE DESEMPLEO
     aCampo = "Texto18";                ||CAUSA SITUACION LEGAL DE DESEMPLEO
     aValor = #labcerti#9;
     |HAZ GrabaTemporal;

     aCampo = "Texto14";                || CARGO PUBLICO O SINDICAL
     aValor = #labcerti#82;
     |HAZ GrabaTemporal;

     aCampo = "Texto15";                || % DEDICACION CARGO PUBLICO O SINDICAL
     aValor = #labcerti#83;
     |HAZ GrabaTemporal;
/*
     aCampo = "VAC";              ||N§ DIAS DE VACACIONES RETRI. Y NO DISFRUTADAS
     aValor = #labcerti#70;
     |HAZ GrabaTemporal;
*/
     aCampo = "10'";              ||SALARIOS DE TRAMITACION PERIODO DE
     |SI #labcerti#76 ! 0;
          aValor = #labcerti#74;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "10''";             ||SALARIOS DE TRAMITACION A
     |SI #labcerti#76 ! 0;
          aValor = #labcerti#75;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "DIAS";             ||SALARIOS DE TRAMITACION NUMERO DE DIAS
     aValor = #labcerti#76;
     |HAZ GrabaTemporal;

     ||DATOS PIE DEL PDF

     aCampo = "CIUDAD";               ||LOCALIDAD EMPRESA
     aValor = #labempre#6;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "DIA";               ||DIA FIRMA
     aValor = dia;
     |HAZ GrabaTemporal;

     aCampo = "MES";               ||MES FIRMA
     aValor = mes;
     |HAZ GrabaTemporal;

     aCampo = "ANY";               ||A¤O FIRMA
     aValor = any;
     |HAZ GrabaTemporal;

     ||aCampo = "Texto9";      || fecha fin de suspension
     aCampo = "Texto20";      || fecha fin de suspension
     aValor = #0#80;
     |QBF aValor;
     |HAZ GrabaTemporal;

     || aCampo = "Texto10";       || nro ERE
     aCampo = "Texto21";       || nro ERE
     aValor = #0#81;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "Texto16";
     nNume= #0#78;
     aValor = nNume;
     |QBF aValor;
     aValor = ("00" + aValor) % -102;
     |HAZ GrabaTemporal;

     aCampo = "Texto17";
     aValor = #0#9;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aAlfa1 = #labempre#128;       || CNAE empresa
     aAlfa2 = #labcentr#22;        || CNAE centro
     |QBF aAlfa1;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2; |Y aAlfa2 ! "";
          aValor = aAlfa2;
     |SINO;
          aValor = aAlfa1;
     |FINSI;

     aCampo = "Texto7";       || codigo CNAE
     |HAZ GrabaTemporal;

     aAlfa1 = #labempre#128;       || CNAE empresa
     aAlfa2 = #labcentr#22;        || CNAE centro
     |QBF aAlfa1;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2; |Y aAlfa2 ! "";
          aValor = #labcentr#23;
     |SINO;
          aValor = #labempre#129;
     |FINSI;
     |QBF aValor;

     aCampo = "Texto8";       || literal CNAE
     aAlfa = aValor - "(";
     |SI FSalida ! 0;
          nNume = FSalida;
          nNume = (nNume - 1) / 100;
          nNume = nNume - 1;
          nNume = nNume + 100;
          aValor = aValor % nNume;
     |FINSI;
     |HAZ GrabaTemporal;

     |PARA nCampo = 87; |SI nCampo [ 99; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto9";
          |SI nCampo = 87; aCampo = aCampo; |FINSI;
          |SI nCampo = 91; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 95; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 99; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |HAZ GrabaTemporal;
     |SIGUE;

     |PARA nCampo = 88; |SI nCampo [ 100; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto10";
          |SI nCampo = 88; aCampo = aCampo; |FINSI;
          |SI nCampo = 92; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 96; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 100; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |QBF aValor;
          |SI aValor = "0";
               aValor = "";
          |FINSI;
          |HAZ GrabaTemporal;
     |SIGUE;

     |PARA nCampo = 89; |SI nCampo [ 101; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto12";
          |SI nCampo = 89; aCampo = aCampo; |FINSI;
          |SI nCampo = 93; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 97; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 101; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |HAZ GrabaTemporal;
     |SIGUE;

     |PARA nCampo = 90; |SI nCampo [ 102; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto13";
          |SI nCampo = 90; aCampo = aCampo; |FINSI;
          |SI nCampo = 94; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 98; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 102; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |HAZ GrabaTemporal;
     |SIGUE;

     aValor = #0#104;    || la descripcion de la profesion
     aCampo = "¤";
     |HAZ GrabaTemporal;

     aValor = #0#103;    || el codigo de la profesion
     aCampo = "Texto14b";
     |HAZ GrabaTemporal;

     aCampo = "Texto22";
     aValor = #0#85;    || % reduccion ERE
     |HAZ GrabaTemporal;

     aCampo = "Texto23";
     aValor = #0#86;    || % reduccion cuidado familiares
     |HAZ GrabaTemporal;

     aCampo = "Texto5";
     aValor = #labtraba#247;
     |HAZ GrabaTemporal;

     aCampo = "Texto6";
     |ABRE #nomregim;
     #nomregim#0 = #labtraba#247;
     |LEE 000#nomregim.=;
     aValor = #nomregim#1;
     |CIERRA #nomregim;
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO Carga_cuadro;
     |SI nAnyo1 ! 0;
          aCampo = "90";       ||ASIGNAMOS EL 1§ A¤O
          aValor = nAnyo1;
          |HAZ GrabaTemporal;

          aCampo = "80";       ||ASIGNAMOS EL 1§ MES
          aValor = aMes1;
          |HAZ GrabaTemporal;

          aCampo = "70";       ||ASIGNAMOS EL 1§ NUM. DIAS COTIZADOS
          aValor = nDiasCot1;
          |HAZ GrabaTemporal;

          aCampo = "60";       ||ASIGNAMOS EL 1§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC1;
          |HAZ GrabaTemporal;

          aCampo = "50";       ||ASIGNAMOS EL 1§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes1;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI nAnyo2 ! 0;
          aCampo = "91";       ||ASIGNAMOS EL 2§ A¤O
          aValor = nAnyo2;
          |HAZ GrabaTemporal;

          aCampo = "81";       ||ASIGNAMOS EL 2§ MES
          aValor = aMes2;
          |HAZ GrabaTemporal;

          aCampo = "71";       ||ASIGNAMOS EL 2§ NUM. DIAS COTIZADOS
          aValor = nDiasCot2;
          |HAZ GrabaTemporal;

          aCampo = "61";       ||ASIGNAMOS EL 2§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC2;
          |HAZ GrabaTemporal;

          aCampo = "51";       ||ASIGNAMOS EL 2§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes2;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI nAnyo3 ! 0;
          aCampo = "92";       ||ASIGNAMOS EL 3§ A¤O
          aValor = nAnyo3;
          |HAZ GrabaTemporal;

          aCampo = "82";       ||ASIGNAMOS EL 3§ MES
          aValor = aMes3;
          |HAZ GrabaTemporal;

          aCampo = "72";       ||ASIGNAMOS EL 3§ NUM. DIAS COTIZADOS
          aValor = nDiasCot3;
          |HAZ GrabaTemporal;

          aCampo = "62";       ||ASIGNAMOS EL 3§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC3;
          |HAZ GrabaTemporal;

          aCampo = "52";       ||ASIGNAMOS EL 3§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes3;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI nAnyo4 ! 0;
          aCampo = "93";       ||ASIGNAMOS EL 4§ A¤O
          aValor = nAnyo4;
          |HAZ GrabaTemporal;

          aCampo = "83";       ||ASIGNAMOS EL 4§ MES
          aValor = aMes4;
          |HAZ GrabaTemporal;

          aCampo = "73";       ||ASIGNAMOS EL 4§ NUM. DIAS COTIZADOS
          aValor = nDiasCot4;
          |HAZ GrabaTemporal;

          aCampo = "63";       ||ASIGNAMOS EL 4§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC4;
          |HAZ GrabaTemporal;

          aCampo = "53";       ||ASIGNAMOS EL 4§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes4;
          |HAZ GrabaTemporal;

          aCampo = "a4";       ||ASIGNAMOS LA 4§ OBSERVACION
          aValor = aObservacion4;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI nAnyo5 ! 0;
          aCampo = "94";       ||ASIGNAMOS EL 5§ A¤O
          aValor = nAnyo5;
          |HAZ GrabaTemporal;

          aCampo = "84";       ||ASIGNAMOS EL 5§ MES
          aValor = aMes5;
          |HAZ GrabaTemporal;

          aCampo = "74";       ||ASIGNAMOS EL 5§ NUM. DIAS COTIZADOS
          aValor = nDiasCot5;
          |HAZ GrabaTemporal;

          aCampo = "64";       ||ASIGNAMOS EL 5§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC5;
          |HAZ GrabaTemporal;

          aCampo = "54";       ||ASIGNAMOS EL 5§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes5;
          |HAZ GrabaTemporal;

          aCampo = "a5";       ||ASIGNAMOS LA 5§ OBSERVACION
          aValor = aObservacion5;
          |HAZ GrabaTemporal;
     |FINSI;
     |SI nAnyo6 ! 0;
          aCampo = "95";       ||ASIGNAMOS EL 6§ A¤O
          aValor = nAnyo6;
          |HAZ GrabaTemporal;

          aCampo = "85";       ||ASIGNAMOS EL 6§ MES
          aValor = aMes6;
          |HAZ GrabaTemporal;

          aCampo = "75";       ||ASIGNAMOS EL 6§ NUM. DIAS COTIZADOS
          aValor = nDiasCot6;
          |HAZ GrabaTemporal;

          aCampo = "65";       ||ASIGNAMOS EL 6§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC6;
          |HAZ GrabaTemporal;

          aCampo = "55";       ||ASIGNAMOS EL 6§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes6;
          |HAZ GrabaTemporal;

          aCampo = "a6";       ||ASIGNAMOS LA 6§ OBSERVACION
          aValor = aObservacion6;
          |HAZ GrabaTemporal;
     |FINSI;

     |SI nAnyo7 ! 0;
          aCampo = "96";       ||ASIGNAMOS EL 7§ A¤O
          aValor = nAnyo7;
          |HAZ GrabaTemporal;

          aCampo = "86";       ||ASIGNAMOS EL 7§ MES
          aValor = aMes7;
          |HAZ GrabaTemporal;

          aCampo = "76";       ||ASIGNAMOS EL 7§ NUM. DIAS COTIZADOS
          aValor = nDiasCot7;
          |HAZ GrabaTemporal;

          aCampo = "66";       ||ASIGNAMOS EL 7§ BASE COT. CONTING. COMUNES
          aValor = nBaseCotCC7;
          |HAZ GrabaTemporal;

          aCampo = "56";       ||ASIGNAMOS EL 7§ BASE COT. DESEMPLEO
          aValor = nBaseCotDes7;
          |HAZ GrabaTemporal;

          aCampo = "a7";       ||ASIGNAMOS LA 7§ OBSERVACION
          aValor = aObservacion7;
          |HAZ GrabaTemporal;
     |FINSI;

     ||LINEA VACACIONES
     ||SI nDiasCot8 ! 0;
          aCampo = "78";       ||ASIGNAMOS EL 7§ NUM. DIAS COTIZADOS
          aValor = nDiasCot8;
          |HAZ GrabaTemporal;
     ||FINSI;

     ||SI nBaseCotCC8 ! 0;
          aCampo = "68";       ||ASIGNAMOS LA BASE COT. DE C.C. DE LA LINEA VACACIONES
          aValor = nBaseCotCC8;
          |HAZ GrabaTemporal;
     ||FINSI;

     ||SI nBaseCotDes8 ! 0;
          aCampo = "58";       ||ASIGNAMOS LA BASE COT. DESEMPLEO DE LA LINEA VACACIONES
          aValor = nBaseCotDes8;
          |HAZ GrabaTemporal;
     ||FINSI;

     aCampo = "y";
     nValor = nDiasCot1 + nDiasCot2 + nDiasCot3 + nDiasCot4;
     nValor = nValor + nDiasCot5 + nDiasCot6 + nDiasCot7 + nDiasCot8;
     aValor = nValor;
     |HAZ GrabaTemporal;

     aCampo = "x";
     nValor = nBaseCotCC1 + nBaseCotCC2 + nBaseCotCC3 + nBaseCotCC4;
     nValor = nValor + nBaseCotCC5 + nBaseCotCC6 + nBaseCotCC7 + nBaseCotCC8;
     aValor = nValor;
     |HAZ GrabaTemporal;

     aCampo = "w";
     nValor = nBaseCotDes1 + nBaseCotDes2 + nBaseCotDes3 + nBaseCotDes4;
     nValor = nValor + nBaseCotDes5 + nBaseCotDes6 + nBaseCotDes7 + nBaseCotDes8;
     aValor = nValor;
     |HAZ GrabaTemporal;

     || OBSERVACIONES

     |SI aObservacion1 ! "";
          aCampo = "acompanya";    ||"NO ACOMPA¤A TC2/8"
          aValor = aObservacion;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "a1";       ||ASIGNAMOS LA 1§ OBSERVACION
     aValor = aObservacion1;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "a2";       ||ASIGNAMOS LA 2§ OBSERVACION
     aValor = aObservacion2;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "a3";       ||ASIGNAMOS LA 2§ OBSERVACION
     aValor = aObservacion3;
     |QBF aValor;
     |HAZ GrabaTemporal;
|FPRC;


|PROCESO PasaAletras;
     |SI nMess = 1;
          aAlfa1 = "Enero";
     |FINSI;
     |SI nMess = 2;
          aAlfa1 = "Febrero";
     |FINSI;
     |SI nMess = 3;
          aAlfa1 = "Marzo";
     |FINSI;
     |SI nMess = 4;
          aAlfa1 = "Abril";
     |FINSI;
     |SI nMess = 5;
          aAlfa1 = "Mayo";
     |FINSI;
     |SI nMess = 6;
          aAlfa1 = "Junio";
     |FINSI;
     |SI nMess = 7;
          aAlfa1 = "Julio";
     |FINSI;
     |SI nMess = 8;
          aAlfa1 = "Agosto";
     |FINSI;
     |SI nMess = 9;
          aAlfa1 = "Septiembre";
     |FINSI;
     |SI nMess = 10;
          aAlfa1 = "Octubre";
     |FINSI;
     |SI nMess = 11;
          aAlfa1 = "Noviembre";
     |FINSI;
     |SI nMess = 12;
          aAlfa1 = "Diciembre";
     |FINSI;
|FPRC;

|PROCESO CargaTemporal;
     #pdfdocca#0 = aArchivo;
     |LEE 000#pdfdocca.=;
     |SI FSalida ! 0;
          aAlfa1 = "    Archivo " + aArchivo + " no encontrado en el Mantenimiento ";
          aAlfa1 = aAlfa1 + "de ficheros PDF.";
          |MENAV aAlfa1;
          |ACABA;
          swCarga = 0;
     |SINO;
          aID = #pdfdocca#2;
     |FINSI;
|FPRC;

|PROCESO BuscaArchivo;
     aArchivo = "cert_emp_general.pdf";
|FPRC;

|PROCESO Registro;
     |ABRE #labnct10;

     #labnct10#0 = #labtraba#0;
     #labnct10#1 = #labtraba#1;
     ||#labnct10#11 = #labtraba#77;
     #labnct10#11 = #0#2;
     #labnct10#2 = 201;
     #labnct10#3 = "Certificado de Empresa";

     fFecha = ~;
     aFecha = fFecha;
     #labnct10#4 = fFecha;         || fecha

     |HORA aHora;
     |QBF aHora;
     #labnct10#5 = aHora;          || hora

     aUsuario = Usuario % 810;
     |QBF aUsuario;
     #labnct10#6 = aUsuario;       || usuario
     #labnct10#7 = "labcerti";

     #labnct10#8 = #labtraba#45;             || tipo de contrato
     #labnct10#9 = #labtraba#36;             || fecha de alta
     #labnct10#10 = #labtraba#37;            || fecha de baja

     |GRABA 020#labnct10.n;
     |LIBERA #labnct10;
|FPRC;

      /************      MENU DE IMPRESION PARA PDF  ***************/

|VARIABLES;
{-1}menu = "";
    menu1 = "2310";
    menu2 = "1";
    menu3 = "";
    menu4 = "VIGES";
    menu5 = " Vista Previa ";
    menu6 = "  Imprimir  ";
    menu7 = " Generar XML ";
    menu8 = " Enviar Online ";
    || menu7 = "    Grabar    ";
    menu9 = "  Salir  ";  || no imprimo, no veo, no guardo

    &nTipoSalida = 0;
    &nTipoImpre = 0;
    &nNroCopias = 0;
|FIN;

|PROCESO TA2;
     |SI #labcontr#83 = "N";
          |ACABA;
     |FINSI;

     nEmpExt = #labtraba#0;
     nTraExt = #labtraba#1;
     fFechaBaja = #labcerti#8;
     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T"; |O #labtraba#42 = "P";
          aTipoContr = "P";
     |SINO;
          aTipoContr = "C";
     |FINSI;

     aAlfa = #labtraba#184;
     aAlfa = aAlfa % 102;
     nNume = aAlfa;
     |SI nNume ! 0;
          nCausaBaja = nNume;
     |SINO;
          |ABRE #nomvarca;
          #nomvarca#0 = #labtraba#0;
          #nomvarca#1 = #labtraba#1;
          aAlfa = #labcerti#8;
          aAlfa = aAlfa % 402;
          nNume = aAlfa;
          #nomvarca#2 = aAlfa;
          #nomvarca#3 = 0;
          |LEE 000#nomvarca.=;
          |SI FSalida = 0;
               nCausaBaja = #nomvarca#46;
          |FINSI;
          |CIERRA #nomvarca;
     |FINSI;

     |SI #labcontr#83 = "P";
          |CONFI "    S¿Desea realizar el parte TA2 de BAJA?"
     |FINSI;
     |SI FSalida = 0; |O #labcontr#83 = "S";
          |SUB_EJECUTA "labparta;BAJA";
     |FINSI;
|FPRC;

|PROCESO ElMenu;
     nOpcion = 0;
     swNetContrata = 0;
     |SI aParam ! ""; |Y aEmision ! "MAN";
          nTipoSalida = 0;
          nOpcion = 1;
          FSalida = nOpcion;
          |ACABA;
     |FINSI;

     menu6 = "  Imprimir  ";
     |SI nActivoNuevo = 1;
         menu6 = "  Archivar  ";
     |FINSI;

     |SI swTA2 = 0;
          swTA2 = 1;
          |HAZ TA2;
     |FINSI;

     |PINTA 0731,#1#2;
     |PINTA 0831,#2#2;
     |PINTA 0931,#3#2;
     |PINDA #0#0;
     |MENSA "    Elija una opcion del menu";
     |MENU menu;
     |BLIN 4;
     nOpcion = FSalida;
     |SI nOpcion = 0;    |ACABA;   |FINSI;

     |SI nOpcion = 1;
          |HAZ GrabaAcot;
          nTipoSalida = 0;
     |FINSI;

     |SI nOpcion = 2;         || nTipoImpre: 0=Predeterminada, 1=Presentar Cuadro
         |SI nActivoNuevo = 1;
             eaVengoDe  = "labcerti";
             nArchi     = 0;
             |HAZ MiraSiArchiva;
             |SI nArchi = 1;
                 |HAZ GrabaAcot;
                 nTipoSalida = 0;
             |SINO;
                 aAlfa = "    Es necesario tener instalada la Gestión del Archivo ";
                 aAlfa = aAlfa + "Documental (GAD) para acceder a sus funciones.";
                 |MENAV aAlfa;
                 nError = 1;
             |FINSI;
         |FINSI;

         |SI nActivoNuevo = 0;
             |SI #labcontr#65 = 1;
                   aAlfa = "    ATENCION. Con el parámetro 'Tipo ejecución Acrobat' ";
                   aAlfa = aAlfa + "igual a 1 no se puede imprimir directamente.";
                   |MENAV aAlfa;
                   aAlfa = "    Es necesario usar la vista previa e imprimir ";
                   aAlfa = aAlfa + "desde el Acrobat.";
                   |MENAV aAlfa;
                   nTipoSalida = 0;
                   |ACABA;
              |FINSI;

              |HAZ GrabaAcot;
              nTipoSalida = 1;    || nNroCopias: = numero de copias ...
              nTipoImpre = 1;     || de momento por defecto Presentamos cuadro de impresion
              |CONFI "     Impresora Predeterminada?";
              |SI FSalida = 0;
                   nTipoImpre = 0;
                   |PUSHV 1425 1954;
                   |BLANCO 1425 1954;
                   |CUADRO 1425 1954;
                   |ATRI R; |PINTA 1630 , " Nro de Copias: "; |ATRI N;
                   E_sup  = 99;
                   E_inf  = 1;
                   nNroCopias = #labcerti#13;
                   nNroCopias = 1649 ? 1;
                   |POPV;
              |FINSI;
          |FINSI;
     |FINSI;

     |SI nOpcion = 3; |O nOpcion = 4;         || XML o Netcontrata
          |SI nOpcion = 4;
               swNetContrata = 1;
          |FINSI;

          |HAZ GrabaAcot;

          aAlfa1 = ("00000" + #labhisce#1) % -105;
          aAlfa2 = ("00000" + #labhisce#2) % -105;
          aAlfa = aAlfa1 + "." + aAlfa2;
          aMensa = "    Creando certificado en xml. Trabajador " + aAlfa;
          |MENSA aMensa;

          aRegimen = "G";
          enEmp = #0#0;
          enTra = #0#1;
          aAntCCC = "";
          |HAZ GeneraXML;

          |SI swNetContrata = 1;
               |HAZ EnvioNetContrata;
               |HAZ Registro;
          |FINSI;

          |BLIN 4;
     |FINSI;

     |SI nOpcion = 5;
          || salida;
     |FINSI;

     FSalida = nOpcion;
|FPRC;

|PROCESO DatosAdicLabhisce;
     #labhisce#30 = #labtraba#7;   || NIF TRABAJADOR
     aAlfa = #labtraba#247;                  || CCC empresa o centro
     |QBF aAlfa;
     aAlfa = ("0000" + aAlfa) % -104;

     |ABRE #labcentr;
     #labcentr#0 = #labtraba#0;
     || #labcentr#1 = #labtraba#77;
     #labcentr#1 = #0#2;
     |LEE 000#labcentr.=;
     |CIERRA #labcentr;

     aAlfa1 = #labcentr#10; |QBF aAlfa1;
     aAlfa = aAlfa + aAlfa1;
     |QBF aAlfa;
     #labhisce#31 = aAlfa;   || NIF TRABAJADOR
|FPRC;

|PROCESO GrabaAcot;
     |ABRE #labhisce;

     #labhisce#0 = "G";
     #labhisce#1 = #labcerti#0;
     #labhisce#2 = #labcerti#1;
     || #labhisce#3 = 1;
     |LEE 101#labhisce.=;
     FEstado = FSalida;

/*
     |LEE 000#labhisce.];
     |SI FSalida ! 0; |O #labhisce#0 ! "G"; |O #labhisce#1 ! #labcerti#0; |O #labhisce#2 ! #labcerti#1;
        nNumero = 1;
     |SINO;
        |PARA; |SI FSalida = 0; |Y #labhisce#0 = "G"; |Y #labhisce#1 = #labcerti#0; |Y #labhisce#2 = #labcerti#1; |HACIENDO;
           nNumero = #labhisce#3 + 1;
           |LEE 000#labhisce.s;
        |SIGUE;
     |FINSI;
*/

     ||DDEFECTO #labhisce;
     #labhisce#0 = "G";
     #labhisce#1 = #labcerti#0;
     #labhisce#2 = #labcerti#1;
     ||#labhisce#3 = nNumero;
     #labhisce#3 = 001;       || esto antes era la linea pero lo quito de
                              || aqui y grabo siempre 001, ya no es campo clave
     aAlfa = "|NC"; aAlfa = #labcerti#aAlfa#;
     nCalc = aAlfa; aRes = ""; nNumCmp = 4;

     |PARA nCont = 0; |SI nCont < nCalc; |HACIENDO nCont = nCont + 1;
        aAlfa  = "|C" + (("000" + nCont) % -103) + "TIPO";     aAlfa  = #labcerti#aAlfa#;
        aAlfa1 = "|C" + (("000" + nCont) % -103) + "LONGITUD"; aAlfa1 = #labcerti#aAlfa1#;
        ||aAlfa = "{{" + aAlfa + "|" + aAlfa1 + "|";
        aAlfa1 = #labcerti#nCont#; |QBF aAlfa1;
        ||aAlfa = aAlfa + aAlfa1 + "}}";
        aAlfa = "{{" + aAlfa1 + "}}";

        aAlfa1 = aRes + aAlfa;
        aAlfa1 = aAlfa1 % 0; nCalc1 = aAlfa1;
        |SI nCalc1 > 230;
           #labhisce#nNumCmp# = aRes; aRes = aAlfa;
           nNumCmp = nNumCmp + 1;
        |SINO;
           aRes = aRes + aAlfa; |QBF aRes;
        |FINSI;
     |SIGUE;

     |SI aRes ! ""; #labhisce#nNumCmp# = aRes; |FINSI;

     fFecha = ~;

     |HORA aHora;

     |SI nOpcion = 1; |O nOpcion = 2;   || emision pantalla o impresora
          #labhisce#20 = fFecha;
          #labhisce#28 = aHora;
     |FINSI;
/*
     |SI nOpcion = 3;                   || solo grabado
          #labhisce#20 = fFecha;
          #labhisce#28 = aHora;
     |FINSI;
*/
     |SI nOpcion = 3; |O nOpcion = 4;           || xml
          |SI FEstado ! 0;       || si no existia
               #labhisce#20 = fFecha;
               #labhisce#28 = aHora;
          |FINSI;
     |FINSI;

     |SI aEmision = "EDI"; |O aEmision = "MAN";
          #labhisce#20 = fFecha;
          #labhisce#28 = aHora;

          #labhisce#27 = fFecha;
          #labhisce#29 = aHora;
     |FINSI;

     |HAZ DatosAdicLabhisce;

     |SI swNetContrata = 1;
          #labhisce#32 = "S";
     |FINSI;

     |SI FEstado = 0;
          |GRABA 020#labhisce.a;
     |SINO;
          |GRABA 020#labhisce.n;
     |FINSI;

     |LIBERA #labhisce;

     |CIERRA #labhisce;
|FPRC;

|PROCESO CreaPDF;
     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #pdfimtmp;
     |ABRE #pdfimtmp;
     |ABRE #pdfdocca;
     |ABRE #pdfdocli;

     swCopia = 1;

     |HAZ BuscaArchivo;     ||asigna a aArchivo el nombre del pdf
     |HAZ CargaTemporal;    ||mira a ver si esta el pdf en el mantenimiento
     |HAZ CargaCampos;

     |HAZ Carga_cuadro;

     |CIERRA #pdfimtmp;
     |CIERRA #pdfdocca;
     |CIERRA #pdfdocli;

     eaIdioma = #labtraba#136;
     |SUB_EJECUTA "pdfgraba";

     |SI nActivoNuevo = 1;
         enEmp      = #0#0;
         enTra      = #0#1;
         aAlfa      = #0#8 % 402;   enMes = aAlfa;
         aAlfa      = #0#8 % -104;  enAny = aAlfa;

         eaVengoDe  = "labcerti";
         |SI nOpcion = 1;  enArchivar = 0;  |FINSI;
         |SI nOpcion = 2;  enArchivar = 1;  |FINSI;
     |FINSI;

     |SUB_EJECUTA "pdfimpre";
|FPRC;

|PROCESO Impresion;
     nError = 0;
     |HAZ ElMenu;
     nOpcion = FSalida;

     |SI nError = 1;  |ACABA;  |FINSI;

     |SI nOpcion = 1; |O nOpcion = 2;
         |HAZ CreaPDF;
     |FINSI;
|FPRC;


||_________FIN DE PROCESOS PARA LA IMPRESION DEL PDF

|PROCESO CalculaDuracion;
     aDuracion = "";

     aDiaAlta = (aFechaRef % 102);
     aMesAlta = (aFechaRef % 402);
     aAnyAlta = (aFechaRef % -104);
     aDiaBaja = (#0#8 % 102);
     aMesBaja = (#0#8 % 402);
     aAnyBaja = (#0#8 % -104);

     nDiaAlta = aDiaAlta;
     nMesAlta = aMesAlta;
     nAnyAlta = aAnyAlta;
     nDiaBaja = aDiaBaja;
     nMesBaja = aMesBaja;
     nAnyBaja = aAnyBaja;

     nAnys = nAnyBaja - nAnyAlta;

     nMeses = nMesBaja - nMesAlta;
     |SI nMeses [ 0;
          |SI nAnys ! 0;
               nAnys = nAnys - 1;
               nMeses = 12 + nMeses;
          |FINSI;
     |FINSI;

     nDias = nDiaBaja - nDiaAlta + 1;
     nume1 = nDiaAlta - 1;
     xmesnume = nMesBaja;
     xanynume = nAnyBaja;
     |HAZ diaanter;
     |SI nDiaBaja = nume1;
          || nMeses = nMeses + 1;
          nDias = 0;
     |SINO;
          |SI nDiaAlta = 1; |Y nDiaBaja = xtopemes;
               nMeses = nMeses + 1;
               nDias = 0;
          |FINSI;
     |FINSI;
     |SI nDias < 0;
          xmesnume = nMesAlta;
          xanynume = nAnyAlta;
          |HAZ diaanter;
          nDias = xtopemes - nDiaAlta + 1;
          nDias = nDias + nDiaBaja;
          nMeses = nMeses - 1;
     |FINSI;
     |SI nMeses = 12;
          nAnys = nAnys + 1;
          nMeses = 0;
     |FINSI;

     aAnys = nAnys;
     aMeses = nMeses;
     aDias = nDias;

     |SI nAnys > 0;
          aDuracion = aAnys + " a¤o";
          |SI nAnys > 1;
               aDuracion = aDuracion + "s";
          |FINSI;
     |FINSI;
     |SI nMeses > 0;
          |SI aDuracion ! "";
               aDuracion = aDuracion + ", ";
          |FINSI;
          aDuracion = aDuracion + aMeses + " mes";
          |SI nMeses > 1;
               aDuracion = aDuracion + "es";
          |FINSI;
     |FINSI;
     |SI nDias > 0;
          |SI aDuracion ! "";
               aDuracion = aDuracion + ", ";
          |FINSI;
          aDuracion = aDuracion + aDias + " dia";
          |SI nDias > 1;
               aDuracion = aDuracion + "s";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Duracion; |TIPO 7;
     alfa1 = #0#8;
     |QBF alfa1;
     |SI alfa1 = "";
          #0#8 = "";
          |PINTA #0#8;
          |ACABA;
     |FINSI;

     aFechaRef = #labtraba#36;
     fech1 = aFechaRef;
     fech2 = #0#8;
     |SI fech1 > fech2;
          |MENAV "    ATENCION: La fecha fin de contrato es inferior a la fecha de alta";
          |ACABA;
     |FINSI;

     |HAZ CalculaDuracion;

     #0#84 = aDuracion;
     |PINTA #0#84;
|FPRC;

|PROCESO CodigoProCer; |TIPO 7;
|| no desde el historico
     swGraba1 = 0;
     swGraba2 = 0;
     aAlfa = #labtraba#19;
     |QBF aAlfa;
     |SI aAlfa = "";

     |SINO;
          #0#104 = aAlfa;
     |FINSI;

     aAlfa = #labtraba#185;
     |QBF aAlfa;
     |SI aAlfa = "";
          |ABRE #labvaltb;
          #labvaltb#0 = "labtraba";
          #labvaltb#1 = 19;
          #labvaltb#5 = #0#0;
          #labvaltb#6 = #0#1;
          |LEE 000#labvaltb.=;
          |SI FSalida = 0;
               aAlfa = #labvaltb#4;
               |ABRE #taiclaoc;
               |SELECT #2#taiclaoc;
               #taiclaoc#1 = aAlfa;
               |LEE 000#taiclaoc.=;
               |SI FSalida = 0;
                    #0#103 = #taiclaoc#0;
               |FINSI;
               |CIERRA #taiclaoc;

               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 101#labtraba.=;
               |SI FSalida = 0;
                    #labtraba#185 = #0#103;
                    |GRABA 020#labtraba.a;
               |FINSI;
               |CIERRA #labtraba;
          |FINSI;
          |CIERRA #labvaltb;
     |SINO;
          #0#103 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO GrabaLabtraba;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 101#labtraba.=;
     |SI FSalida = 0;
          #labtraba#19 = #0#104;
          #labtraba#185 = #0#103;
          |GRABA 020#labtraba.a;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO CompPro;
     aAlfa = #0#104;
     |QBF aAlfa;
     |SI aAlfa = "";
          swGraba1 = 1;
          aAlfa = "    ATENCION: la profesión del trabajador está en blanco. ";
          |MENAV aAlfa;
          aAlfa = "    Es necesario incluir este dato en el certificado. ";
          aAlfa = aAlfa + "Pulse F3 para elegir de la lista CNO.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;

     aAlfa = #0#103;
     |QBF aAlfa;
     |SI aAlfa = "";
          swGraba2 = 1;
          aAlfa = "    ATENCION: el código de la profesión del trabajador está en blanco. ";
          |MENAV aAlfa;
          aAlfa = "    Es necesario incluir este dato en el certificado. ";
          aAlfa = aAlfa + "Pulse F3 para elegir de la lista CNO.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CompTP;
     |SI #labtraba#42 = "I"; |O #labtraba#42 = "P"; |O #labtraba#42 = "T"; |O #labtraba#42 = "X";
          aAlfa1 = "";
          |PARA nCampo = 87; |SI nCampo [ 102; |HACIENDO nCampo = nCampo + 1;
               aAlfa = #0nCampo;
               |QBF aAlfa;
               aAlfa1 = aAlfa1 + aAlfa;
          |SIGUE;
          |SI aAlfa1 = "0000";
               |SI #labtraba#42 = "T"; |O #labtraba#42 = "X";
                    aAlfa1 = "a tiempo parcial";
               |SINO;
                    aAlfa1 = "irregular";
               |FINSI;
               aAlfa1 = "    ATENCION: el trabajador tiene contrato " + aAlfa1 + ".";
               |MENAV aAlfa1;
               aAlfa1 = "    Los campos de distribución de jornadas deberían estar rellenos.";
               |MENAV aAlfa1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO RecuperaHis;
             enSwError = 0;
             nNumCmp = 0;
             |PARA nCont = 4; |SI nCont [ 8; |HACIENDO nCont = nCont + 1;
                aAlfa = #labhisce#nCont#; |QBF aAlfa;
                |PARA; |SI aAlfa ! ""; |HACIENDO;
                   aAlfa1 = aAlfa - "}}";
                   nCalc = FSalida;
                   |SI nCalc > 9999;
                        nCalc = (((nCalc / 100) ! 0) + 1) + 1000;
                        nCalc1 = nCalc - 1099;
                        nCalc = nCalc - nCalc1;

                        nCalc1 = nCalc1 + 10000;
                        nCalc = nCalc - 900;
                        aAlfa1 = (aAlfa % nCalc)
                        aAlfa2 = (aAlfa % nCalc1);
                        aAlfa = aAlfa - aAlfa1;
                        aAlfa = aAlfa - aAlfa2;
                        aAlfa1 = aAlfa1 + aAlfa2;
                        aAlfa1 = aAlfa1 - "{{"; aAlfa1 = aAlfa1 - "}}";
                   |SINO;
                        nCalc = (((nCalc / 100) ! 0) + 1) + 100;
                        aAlfa1 = aAlfa % nCalc; aAlfa = aAlfa - aAlfa1; |QBF aAlfa;
                        aAlfa1 = aAlfa1 - "{{"; aAlfa1 = aAlfa1 - "}}";
                   |FINSI;
                   |SI nNumCmp > 105
                         || aqui ha habido un problema al traerme el certificado
                         || del historico, o no se grabo bien o los campos no
                         || estan como deben, ME SALGO QUE YA NO HAY MAS CAMPOS

                         |SAL;
                   |FINSI;
                   #labcerti#nNumCmp# = aAlfa1; nNumCmp = nNumCmp + 1;
                |SIGUE;
             |SIGUE;
|FPRC;

|PROCESO Recupera;
     |SI aParam = "";         || desde punto del menu
          |ABRE #labhisce;
          #labhisce#0 = "G";
          #labhisce#1 = #0#0;
          #labhisce#2 = #0#1;
          |LEE 000#labhisce.=;
          |SI FSalida = 0;
               aAlfa = "    ATENCION: El trabajador seleccionado ya tiene ";
               aAlfa = aAlfa + "un certificado guardado en el histórico.";
               |MENAV aAlfa;
               aAlfa = "    S¿Desea crear el certificado de nuevo?";
               |CONFI aAlfa;
               |SI FSalida ! 0;
                    ||HAZ RecuperaHis;
                    ||PINDA #0#0;
                    |CIERRA #labhisce;
                    |PTEC 807;
               |FINSI;
          |FINSI;
          |CIERRA #labhisce;
     |FINSI;
|FPRC;

|PROCESO PresentaPdfGAD;
     eaVengoDe  = "labcerti";
     nArchi     = 0;
     |HAZ MiraSiArchiva;
     |SI nArchi ! 1;  |ACABA;  |FINSI;

     enEmpGAD = #labhisce#1;
     enTraGAD = #labhisce#2;
     enTipGAD = 1;
     aAlfa    = #labcerti#8 % 402;   enMesGAD = aAlfa;
     aAlfa    = #labcerti#8 % -104;  enAnyGAD = aAlfa;
     enModGAD = 993;
     enImpGAD = 1;
     enExiGAD = 0;
     aAlfa1   = enEmpGAD; |QBF aAlfa1;
     aAlfa1   = ("00000" + aAlfa1) % -105;
     aAlfa2   = enTraGAD; |QBF aAlfa2;
     aAlfa2   = ("00000" + aAlfa2) % -105;
     eaFicGAD = "certificado_" + aAlfa1 + "_" + aAlfa2 + ".pdf";

     |HAZ BuscaDocuGAD;
|FPRC;

|PROCESO GrabaPdfGAD;
     |SI nActivoNuevo = 0;  |ACABA;  |FINSI;

     eaVengoDe  = "labcerti";
     nArchi     = 0;
     |HAZ MiraSiArchiva;
     |SI nArchi ! 1;  |ACABA;  |FINSI;

     enEmpGAD = #labhisce#1;
     enTraGAD = #labhisce#2;
     enTipGAD = 1;
     aAlfa    = #labcerti#8 % 402;   enMesGAD = aAlfa;
     aAlfa    = #labcerti#8 % -104;  enAnyGAD = aAlfa;
     enModGAD = 993;
     enImpGAD = 0;
     enExiGAD = 0;
     aAlfa1   = enEmpGAD; |QBF aAlfa1;
     aAlfa1   = ("00000" + aAlfa1) % -105;
     aAlfa2   = enTraGAD; |QBF aAlfa2;
     aAlfa2   = ("00000" + aAlfa2) % -105;
     eaFicGAD = "certificado_" + aAlfa1 + "_" + aAlfa2 + ".pdf";

     |HAZ BuscaDocuGAD;
     |SI enExiGAD = 1;
         nOpcion = 2;
         |HAZ CreaPDF;
     |FINSI;
|FPRC;

|PROGRAMA;
     nActivoNuevo = 1;

     aParam = PARAMETRO;
     |QBF aParam;
     aParam1 = aParam % 108;
     |SI aParam1 = "netcontr";
          aParam = aParam - aParam1;
          swNetContrata = 1;
     |FINSI;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI aParam = ""; |O aParam1 = "labornet";
          aEmision = "MAN";   || es decir desde el mantenimiento y que salga
                              || el menu
          |CLS;
          |SI aParam1 = "labornet";
               aAlfa = aParam % 905;
               #0#0 = aAlfa;
               aAlfa = aParam % 1405;
               #0#1 = aAlfa;
          |FINSI;

          |PINPA #0#0;
          |PINDA #0#0;

          |SI aParam1 = "labornet";
               |CAMPO_MODIFICA #0#0, 1, "N";
               |CAMPO_MODIFICA #0#1, 1, "N";
               |HAZ leeempre;
               |HAZ leetraba;
               |HAZ decret;
               |HAZ RellenaCampos;
               |HAZ variacion;
               |HAZ Duracion;

               nEmp = #0#0;
               nTra = #0#1;
               aAlfa = #0#8;
               aAlfa = aAlfa % 402;
               nMes = aAlfa;
               nTipo = 2;
               |HAZ finiquito3;
               |PINTA #0#70;
               |PINTA #0#71;
               |PINTA #0#72;
          |FINSI;

          |ENDATOS #1#0;

          |SI FSalida = 0;
               |HAZ GrabaAcot;
               |HAZ imprime;
          |FINSI;
     |SINO;
          aAlfa = aParam; |QBF aAlfa;
          aEmision = aAlfa % -103;

          |ABRE #labhisce;
          #labhisce#0 = "G";
          aAlfa1 = aAlfa % 0105; #labhisce#1 = aAlfa1;
          aAlfa1 = aAlfa % 0605; #labhisce#2 = aAlfa1;

          |LEE 000#labhisce.=;
          |SI FSalida ! 0;
              |CIERRA #labhisce;
              enSwError = -1;
              |ACABA;
          |FINSI;
          || recupera lo guardado en el historico
          |HAZ RecuperaHis;
          |SI aEmision ! "XML";
              |HAZ leeempre; |HAZ leetraba;  |HAZ leecentr;
          |FINSI;
          |HAZ decret;
          aAlfa = #labcerti#84; |HAZ Duracion; #labcerti#84 = aAlfa;

          |SI nActivoNuevo = 1;
              |SI aEmision = "IMP";         || Emision desde el GAD si existe
                  |HAZ PresentaPdfGAD;
                  |SI enExiGAD = 1;
                      |CIERRA #labhisce;
                      |ACABA;
                  |FINSI;
              |FINSI;
          |FINSI;

          |SI aEmision ! "EDI";
              |HAZ imprime;
          |SINO;
              || edicion de certificado ya grabado proveniente del historico

              |CLS;
              |PINPA #0#0;
              |PINDA #0#0;
              |CAMPO_MODIFICA #0#0, 1, "N";
              |CAMPO_MODIFICA #0#1, 1, "N";
              |CAMPO_MODIFICA #0#2, 1, "N";
              |HAZ leeempre;
              |HAZ leetraba;
              |HAZ leecentr;
              |HAZ decret;
              |ENDATOS #1#0;
              |SI FSalida = 0;
                  |HAZ GrabaAcot;

                  |HAZ GrabaPdfGAD;
              |FINSI;
          |FINSI;

          |CIERRA #labhisce;
     |FINSI;
|FPRO;
