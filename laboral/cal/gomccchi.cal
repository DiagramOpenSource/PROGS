|FICHEROS;
     gomccchi #0;

     labempre;
     labcentr;
|FIN;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;

     corta = 0;
     jg = 0;
     sitio = 0;

     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";

     FEstado = 0;
|FIN;

|PROCESO trunca1;
     corta = 0;
     alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
     |PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
          sitio = (jg * 100) + 1;
          alfa2 = alfa1 % sitio;
          |SI alfa2 = ".";  corta = jg;  |FINSI;
     |SIGUE;
     |SI corta ! 0;
          sitio = 100 + corta - 1;
          alfa1 = alfa1 % sitio;
     |FINSI;
     nume3 = alfa1;
     nume1 = nume1 - (nume3 * 97);
|FPRC;

|PROCESO control1_1; |TIPO 0;
     |SI FSalida = 9;
          alfa1 = #0Campo;
          |QBF alfa1;
          alfa2 = alfa1 % 102; alfa3 = alfa1 % -107;
          alfa4 = alfa3 % 101;
          |SI alfa4 = "0";
               alfa3 = alfa3 % 206;
               alfa1 = alfa2 + alfa3;
          |FINSI;
          nume1 = alfa1;
          nume2 = nume1 / 97;
          |HAZ trunca1;
          |SI nume1 ] 0; |Y nume1 [ 99;
               alfa1 = #0Campo;
               |QBF alfa1;
               alfa2 = nume1;
               alfa2 = "00" + alfa2;
               alfa2 = alfa2 % -102;
               alfa1 = alfa1 + alfa2;
               #0Campo = alfa1;
               |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO RelacionCen;
     |SI #0#1 ! 00;
          |ABRE #labcentr;
          #labcentr#0 = #0#0;
          #labcentr#1 = #0#1;
          |LEE 000#labcentr.=;
          |SI FSalida = 0;
               |ATRI I;
               |PINTA 0930, #labcentr#2;
               |ATRI I;
          |SINO;
               aAlfa1 = #0#0;
               aAlfa1 = ("00000" + aAlfa1) % -105;
               aAlfa2 = #0#1;
               aAlfa2 = ("00" + aAlfa2) % -102;
               aAlfa = "    El centro " + aAlfa2 + " no existe ";
               aAlfa = aAlfa + "en la empresa " + aAlfa1;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
          |CIERRA #labcentr;
     |SINO;

     |FINSI;
|FPRC;

|PROCESO min;
     #labcentr#0 = #0#0;
     #labcentr#1 = 01;
|FPRC;

|PROCESO max;
     #labcentr#0 = #0#0;
     #labcentr#1 = 99;
|FPRC;

|PROCESO ConsultaCen; |TIPO 66;
     |ABRE #labcentr;
     |CONSULTA_F_CLAVE #1#labcentr, min, max;
     |SI FSalida = 0;
          #0#1 = #labcentr#1;
          |PINTA #0#1;
          |ATRI I;
          |PINTA 0930, #labcentr#2;
          |ATRI I;
     |FINSI;
     |CIERRA #labcentr;
|FPRC;

|PROCESO LeeCCC; |TIPO 7;
     aAlfa = #0#2;
     |QBF aAlfa;
     |SI aAlfa = "";
          |SI #0#1 = "00";
               |ABRE #labempre;
               #labempre#0 = #0#0;
               |LEE 101#labempre.=;
               |SI FSalida = 0;
                    #0#2 = #labempre#13;
                    |PINTA #0#2;
               |FINSI;
               |CIERRA #labempre;
          |SINO;
               |ABRE #labcentr;
               #labcentr#0 = #0#0;
               #labcentr#1 = #0#1;
               |LEE 101#labcentr.=;
               |SI FSalida = 0;
                    #0#2 = #labcentr#10;
                    |PINTA #0#2;
               |FINSI;
               |CIERRA #labcentr;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO PintaCosas;
     |ABRE #labempre;
     |CIERRA #labempre;
|FPRC;

|PROCESO GrabaCentros;
     |SI #labcentr#10 = #0#2; |Y #labcentr#10 ! #0#3;
          #labcentr#10 = #0#3;
          |GRABA 020#labcentr.a;
          |LIBERA #labcentr;

          aAlfa1 = #labcentr#0;
          |QBF aAlfa1;
          aAlfa1 = ("00000" + aAlfa1) % -105;
          aAlfa2 = #labcentr#1;
          |QBF aAlfa2;
          aAlfa2 = ("00" + aAlfa2) % -102;
          aAlfa = "    Se ha grabado el nuevo CCC en el centro " + aAlfa2;
          aAlfa = aAlfa + " de la empresa " + aAlfa1;
          |MENAV aAlfa;

          |ABRE #0;
          #0#0 = #labcentr#0;
          #0#1 = #labcentr#1;
          |LEE 101#0=;
          FEstado = FSalida;

          #0#2 = #0#2;
          #0#3 = #0#3;
          |SI FEstado = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
          |LIBERA #0;
          |CIERRA #0;
     |FINSI;
|FPRC;

|DEFBUCLE GrabaCentros;
     #labcentr#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, GrabaCentros;
|FIN;

|PROCESO GrabaCCC;
     |SI #0#1 = 00;
          |ABRE #labempre;
          #labempre#0 = #0#0;
          |LEE 101#labempre.=;
          |SI FSalida = 0;
               |SI #labempre#13 ! #0#3;
                    #labempre#13 = #0#3;
                    |GRABA 020#labempre.a;
                    |LIBERA #labempre;

                    aAlfa1 = #0#0;
                    aAlfa1 = ("00000" + aAlfa1) % -105;
                    aAlfa = "    Se ha grabado el nuevo CCC en la empresa " + aAlfa1;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #labempre;
/*
          |SALVA_DATOS #0;
          |BUCLE GrabaCentros;
          |REPON_DATOS #0;
*/
     |SINO;
          |ABRE #labcentr;
          #labcentr#0 = #0#0;
          |LEE 101#labcentr.=;
          |SI FSalida = 0;
               |SI #labcentr#10 ! #0#3;
                    #labcentr#10 = #0#3;
                    |GRABA 020#labcentr.a;
                    |LIBERA #labcentr;

                    aAlfa1 = #0#0;
                    aAlfa1 = ("00000" + aAlfa1) % -105;
                    aAlfa2 = #0#1;
                    aAlfa2 = ("00" + aAlfa2) % -102;
                    aAlfa = "    Se ha grabado el nuevo CCC en el centro " + aAlfa2;
                    aAlfa = aAlfa + " de la empresa " + aAlfa1;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #labcentr;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     aAlfa = #0#3;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = "    S¿Desea cambiar el CCC ";
          |SI #0#1 = 00;
               aAlfa = aAlfa + "de la empresa?";
          |SINO;
               aAlfa = aAlfa + "del centro?";
          |FINSI;
          |CONFI aAlfa;
          |SI FSalida = 0;
               |GRABA 000#0a;
               |HAZ GrabaCCC;
          |FINSI;
     |FINSI;
|FPRC;
