|FICHEROS;
     cargodef@;

     labtraba;
|FIN;

|VARIABLES;
     nFSalida     = 0;
     nHandle      = 0;
     nNumCampo    = 0;
     nOk          = 0;
     nMod         = 0;

     aBase        = "";
     aMas         = "";
     aFic         = "";
     aHora        = "";
     aQueQuiero   = "";
     aAlfa        = "";
     aEmail       = "";
     aVerde       = "0,185,0;255,255,255";
     aRojo        = "255,80,80;255,255,255";

     fFecha       = @;

     &enEmpresa   = 0;
     &enAnyo      = 0;
     &enEjercicio = 0;
     &enPeriodo   = 0;

     &eaAccAUD    = "";
     &eaProAUD    = "";
     &eaPrgAUD    = "";
     &eaDacAUD    = "";
     &eaDesAUD    = "";
     &eaIdeAUD    = "";
     &enModAUD    = 0;
     &enCliAUD    = 0;
     &enEjrAUD    = 0;
     &enPerAUD    = 0;
|FIN;

|PROCESO AccesoGAD;
     |DBASS aBase;
     aFic = aBase + "dsarchi/fich/";
     aMas = aBase + "dsarchi/def/dpntm001.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, cargodef@;

     |PATH_DAT #cargodef@#aFic#;

     |ABRE #cargodef@;
     #cargodef@#0 = #labtraba#0;
     |LEE 000#cargodef@.=;
     nFSalida = FSalida;
     |CIERRA #cargodef@;
     |DESCARGA_DEF #cargodef@;

     |SI nFSalida ! 0;  |ACABA;  |FINSI;

     aMas = aBase + "dsarchi/def/dpntm004.mas";
     |CARGA_DEF aMas, cargodef@;
     |PATH_DAT #cargodef@#aFic#;

     |ABRE #cargodef@;
     #cargodef@#0 = #labtraba#0;
     #cargodef@#1 = #labtraba#7;
     |LEE 000#cargodef@.=;
     |SI FSalida ! 0;
         |SI nMod = 17;
            |CIERRA #cargodef@;
            |DESCARGA_DEF #cargodef@;
            |ACABA;
         |FINSI;

         |DDEFECTO #cargodef@;
         #cargodef@#0  = #labtraba#0;
         #cargodef@#1  = #labtraba#7;
         #cargodef@#2  = #labtraba#1;
         #cargodef@#3  = #labtraba#2;
         #cargodef@#4  = #labtraba#127;

         |SI #labtraba#36 ! "          ";
             #cargodef@#11 = #labtraba#36;
         |FINSI;

         |GRABA 020#cargodef@.b;
     |FINSI;

     fFecha = #labtraba#36;
     |SI #cargodef@#2 ! #labtraba#1;
         |SI fFecha < #cargodef@#11;
             |CIERRA #cargodef@;
             |DESCARGA_DEF #cargodef@;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI nMod = 17;
         |BORRA 020#cargodef@.a;
         |LIBERA #cargodef@;

         |CIERRA #cargodef@;
         |DESCARGA_DEF #cargodef@;
         |ACABA;
     |FINSI;

     #cargodef@#2  = #labtraba#1;
     #cargodef@#11 = fFecha;
     #cargodef@#4  = #labtraba#127;

     aEmail = #cargodef@#4;  |QBF aEmail;

                               nOk = 1;
     |SI #labtraba#44  ! "A";  nOk = 0;  |FINSI;
     |SI #labtraba#142 ! "S";  nOk = 0;  |FINSI;
     |SI aEmail        =  "";  nOk = 0;  |FINSI;

     #cargodef@#6  = "N";
     |SI nOk = 1;
         #cargodef@#6  = "S";
     |FINSI;

     #cargodef@#5 = "";
     #cargodef@#9 = "";

     |SI aEmail = "";
         #cargodef@#9 = aRojo;
     |FINSI;

     |SI #labtraba#44 ! "A";
         #cargodef@#9 = aRojo;
     |FINSI;

     |SI #cargodef@#6  = "S";
         #cargodef@#9 = aVerde;
     |FINSI;

     |GRABA 020#cargodef@.a;
     |LIBERA #cargodef@;

     |CIERRA #cargodef@;
     |DESCARGA_DEF #cargodef@;
|FPRC;

|PROCESO Prog0501;
     |DBASS aBase;
     aAlfa = aBase + "integral/bin/audtrz01.tab";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "integral/def/dsam0001.mas";
     |XABRE "E", aMas, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, cargodef@;

     aQueQuiero = "|NC";
     aAlfa      = #cargodef@#aQueQuiero#;
     nNumCampo  = aAlfa;
     nNumCampo  = nNumCampo - 1;

     |ABRE #cargodef@;
     |LEE 000#cargodef@.p;
     |SI FSalida ! 0;  |DDEFECTO #cargodef@;  |FINSI;
     |CIERRA #cargodef@;

     aAlfa = #cargodef@#12;

     |DESCARGA_DEF #cargodef@;

     |SI aAlfa = "N";     |ACABA;  |FINSI;
     |SI nNumCampo [ 11;  |ACABA;  |FINSI;

     |SUB_EJECUTA ":integral/audtrz01";
|FPRC;

|PROCESO &Labtraba_15;  |TIPO 15;
     nMod = 15;
     |HAZ AccesoGAD;

     eaAccAUD = "1";
     eaDacAUD = "Alta";
     eaProAUD = "0501";
     eaDesAUD = "Fichas trabajadores";
     eaPrgAUD = "labtraba";
     enModAUD = 0;
     enEjrAUD = 0;
     enPerAUD = 0;
     enCliAUD = #labtraba#0;
     eaIdeAUD = "#" + (("00000" + #labtraba#0) % -105);
     eaIdeAUD = eaIdeAUD + "#" + (("00000" + #labtraba#1) % -105) + "#";

     |HAZ Prog0501;
|FPRC;

|PROCESO &Labtraba_16;  |TIPO 16;
     nMod = 16;
     |HAZ AccesoGAD;

     eaAccAUD = "2";
     eaDacAUD = "Modificaci¢n";
     eaProAUD = "0501";
     eaDesAUD = "Fichas trabajadores";
     eaPrgAUD = "labtraba";
     enModAUD = 0;
     enEjrAUD = 0;
     enPerAUD = 0;
     enCliAUD = #labtraba#0;
     eaIdeAUD = "#" + (("00000" + #labtraba#0) % -105);
     eaIdeAUD = eaIdeAUD + "#" + (("00000" + #labtraba#1) % -105) + "#";

     |HAZ Prog0501;
|FPRC;

|PROCESO &Labtraba_17;  |TIPO 17;
     nMod = 17;
     |HAZ AccesoGAD;

     eaAccAUD = "3";
     eaDacAUD = "Baja";
     eaProAUD = "0501";
     eaDesAUD = "Fichas trabajadores";
     eaPrgAUD = "labtraba";
     enModAUD = 0;
     enEjrAUD = 0;
     enPerAUD = 0;
     enCliAUD = #labtraba#0;
     eaIdeAUD = "#" + (("00000" + #labtraba#0) % -105);
     eaIdeAUD = eaIdeAUD + "#" + (("00000" + #labtraba#1) % -105) + "#";

     |HAZ Prog0501;
|FPRC;
