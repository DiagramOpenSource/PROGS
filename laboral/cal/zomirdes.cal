|FICHEROS;
     zomirdes #0;
     labempre;
     labtraba;
     nomconca;
     nomir009;
     nomcalca;
     nomhicca;
|FIN;

|VARIABLES;
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     nCampo4 = 0;
     nCampo5 = 0;
     nPaga = 0;
     nEmpresaAnt = 0;
     &swCabecera = 0;
     aAlfa = "";
     fFechaBaja = @;
     fFechaAlta = @;
     fFechaHoy = @;
     swImprime = 0;
     &nIRPF1 = 0;
     &nIRPF2 = 0;
     &nDiferencia = 0;
     &swCalculado = 0;
     &nDifCuota = 0;
     &nTotalEmpresa = 0;
     &nTotal = 0;
     &nTrab = 0;
     &swPie = 0;
     nNume = 0;
|FIN;

|PROCESO labtraba;
     fFechaHoy = "01.12.2008";
     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          fFechaBaja = aAlfa;
          |SI fFechaBaja < fFechaHoy;
               |ACABA;
          |FINSI;
     |FINSI;
     fFechaHoy = "01.01.2008";
     aAlfa = #labtraba#36;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          fFechaAlta = aAlfa;
          |SI fFechaAlta ] fFechaHoy;
               |ACABA;
          |FINSI;
     |SINO;
          |ACABA;
     |FINSI;

     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |SI FSalida = 0;
          |PARA nPaga = 1; |SI nPaga [ 8; |HACIENDO nPaga = nPaga + 1;
               nCampo1 = nPaga + 3;     || desde mes prorrata
               nCampo2 = nPaga + 11;    || hasta mes prorrata
               nCampo3 = nPaga + 19;    || mes pago
               nCampo4 = nPaga + 107;   || desde dia prorrata
               nCampo5 = nPaga + 115;   || hasta dia prorrata
               swImprime = 0;
               |SI #nomconca#nCampo1# ] #nomconca#nCampo2#;
               |Y #nomconca#nCampo3# ! 99; |Y #nomconca#nCampo3# ! 0;
                    |SI #nomconca#nCampo1# > #nomconca#nCampo2#;
                         swImprime = 1;
                    |FINSI;
                    |SI #nomconca#nCampo1# = #nomconca#nCampo2#;
                         |SI #nomconca#nCampo4# ] #nomconca#nCampo5#;
                              swImprime = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI #nomconca#nCampo2# > #nomconca#nCampo3#;
                    swImprime = 1;
               |FINSI;
               |SI swImprime = 1;
                    nDifCuota = 0;
                    #nomcalca#0 = #labtraba#0;
                    #nomcalca#1 = #labtraba#1;
                    #nomcalca#2 = 12;
                    #nomcalca#3 = 0;
                    |LEE 000#nomcalca.=;
                    |SI FSalida ! 0;
                         swCalculado = 0;
                    |SINO;
                         swCalculado = 1;

                         #nomhicca#0 = #labtraba#0;
                         #nomhicca#1 = #labtraba#1;
                         #nomhicca#66 = 8;
                         #nomhicca#2 = 11;
                         #nomhicca#3 = 0;
                         |LEE 000#nomhicca.=;

                         nDiferencia = #labtraba#30 - #nomhicca#13;
                         |SI nDiferencia ] #0#6;
                              nIRPF1 = #nomhicca#13;
                              nIRPF2 = #labtraba#30;
                              |SI #labtraba#30 = #nomcalca#13;
                                   || ya han regularizado
                                   nDifCuota = (#nomcalca#15 + #nomcalca#17 + #nomcalca#71 + #nomcalca#72);
                                   nDifCuota = nDifCuota - ((#nomcalca#14 + #nomcalca#16 + #nomcalca#69 + #nomcalca#70) % nIRPF1);
                              |SINO;
                                   nDifCuota = (#nomcalca#14 + #nomcalca#16 + #nomcalca#69 + #nomcalca#70) % nDiferencia;
                              |FINSI;
                         |SINO;
                              swImprime = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;

               |SI swImprime = 1;
                    |SI nEmpresaAnt ! #labtraba#0; |Y nTrab ! 0;
                         swCabecera = 0;
                         nNume = swCalculado;
                         swCalculado = -1;
                         swPie = 1;
                         |PRINT;
                         swCalculado = nNume;
                         swPie = 0;
                         nTotalEmpresa = 0;
                    |FINSI;


                    |SI nEmpresaAnt ! #labtraba#0;
                         #labempre#0 = #labtraba#0;
                         |LEE 000#labempre.=;
                         swCabecera = 1;
                    |SINO;
                         swCabecera = 0;
                    |FINSI;

                    |PRINT;
                    nTotal = nTotal + nDifCuota;
                    nTotalEmpresa = nTotalEmpresa + nDifCuota;
                    nTrab = nTrab + 1;

                    nEmpresaAnt = #labtraba#0;
                    |ACABA;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     44, 87;
     #nomir009#0, #0#2, "A", #0#4;
     #nomir009#0, #0#3, "A", #0#5;
     ;
     NULL, labtraba;
|FIN;

|PROCESO nomir009;
     |SI #nomir009#17 ! 1;
          |BUCLE labtraba;
     |FINSI;
|FPRC;

|DEFBUCLE nomir009;
     #nomir009#1;
     ;
     #0#0;
     #0#1;
     ;
     NULL, nomir009;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "zomirdes";
               |ABRE #labempre;
               |ABRE #nomconca;
               |ABRE #nomcalca;
               |ABRE #nomhicca;
               |BUCLE nomir009;
               |CIERRA #nomhicca;
               |CIERRA #nomcalca;
               |CIERRA #nomconca;
               |CIERRA #labempre;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRO;
