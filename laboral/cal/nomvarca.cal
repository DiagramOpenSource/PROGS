|FICHEROS;
     nomvarca #0;
     labtraba #1;
     labempre #2;
     nomhicca #3;
     nomcontr;
     nommauto;
     nomcalca;
     nomhisit;
     nomvarli;
     nomconli;
     nomvarcb,MANTE;
     motibaja;
     nom900de;
     nom900dt;
     nomdesam;
|FIN;

|VARIABLES;
    p_mes = "";
    mod = 0;
    varnum1 = 0;
    varnum2 = 0;
    varnum3 = 0;
    swporsi = 0;
    campo = 0;
    hasta = 0;
    desde = 0;
    baja = 0;
    mesbaja = 0;
    tipo = 0;
    mensaje0 = "0000ATENCION !!! Error de entrada ...";
    mensaje1 = "0000ATENCION !!! Primer dia erroneo ...";
    mensaje2 = "0000ATENCION !!! Tipo de enfermedad erroneo en ficha de trabajadores ...";
    mensaje3 = "0000ATENCION !!! Fecha fuera de periodo de alta ...";
    mensaje4 = "0000ATENCION !!! Fecha fuera del mes actual ...";
    men1 = "0000ATENCION !!! Fecha erronea ...";
    dia1 = "";
    mes1 = "";
    any1 = "";
    dia = 0;
    mes = 0;
    any = 0;
    tope = 0;
    sw = 0;
    fec = "";
    blanco = "          ";
    puntos = "..........";
    varnum = 0;
    desnum = 0;
    hasnum = 0;
    fecsys = @;
    alfa1 = "";
    alfa2 = "";

    fecalf = "";
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    fech5 = @;
    fech6 = @;
    hbase = 0;
    henfe = 0;
    hdias = 0;
    hhor1 = 0;
    hhor2 = 0;
    hmes = 0;
    hany = 0;
    hnat = 0;
    nModo = 0;

     anynum = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     numer = 0;
     mesnum = 0;
     nDiasAlta = 0;
     bisiesto = 0;
     topemes = 0;
     nCarencia = 180;
     fFechaHoy = @;
     aFechaHoy = "";
     aNif = "";
     nDesde = 0;
     nHasta = 0;
     nDiasBaja = 0;
     nCampo = 0;
     nCampoD = 0;
     nCampoT = 0;
     nCampoF = 0;
     nCampoDB = 0;
     nCampoH = 0;
     nCampoHB = 0;
     nCampoTB = 0;
     nCampoFB = 0;
     nCampoFR = 0;
     nCampoR = 0;
     nCampoRSN = 0;
     aDia = "";
     nDia = 0;
     aMes = "";
     &nMes = 0;
     aAny = "";
     &nAny = 0;
     nFecha = 0;
     fFecha = @;
     aFecha = "";
     aMensaje = "";
     swBajaInicial = 0;
     swMiraPromE = 0;
     swMiraPromA = 0;
     swMiraProm = 0;
     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nMesAUTO = 0;
     &nAnyAUTO = 0;
     &promE_AUTO = 0;
     &promA_AUTO = 0;
     &nEmpExt = 0;
     &nTraExt = 0;
     &fFecExt = @;
     &aAccExt = "";
     &aTipExt = "";
     &aRecExt = "";
     swHayIT = 0;
     swImpDatIT = 0;
     swImpDatAcc = 0;
     &aFecRecExt = "";
     nume4 = 0;
     nume5 = 0;
     nume6 = 0;
     nume7 = 0;
     swStop = 0;
     nMesB = 0;
     nAnyB = 0;
     nDiasAcum = 0;

     dia2 = "";
     mes2 = "";
     nParte = 0;
     &fFecExtAlta = @;
     aFechaFin = "";
     fFechaIni = @;
     fFechaFin = @;
     &nDiasCotExt = 0;

     &nEnEmpresa = 0;
     &swModulo = 0;
     nDiaD = 0;
     nDiaH = 0;
     nDiaBusca = 0;
     nAnyBus = 0;

     swPreguntitas = 0;
     aTipoBaja = "";
     swSigue = 0;
     nIT = 0;
     aHosp = "";
     nCampoHosp = 0;
     nPos = 0;
     &enEmpresa = 0;
     &enTrabajador = 0;
     aAlfa4 = "";
     aAlfa5 = "";
     aAlfa6 = "";
     aFechaIniBaja = "";
     aFechaArrBaja = "";

     nDesde1 = 0; nHasta1 = 0; aTipo1 = "";
     aHospi1 = " "; aReca1 = " "; aFechaReca1 = " "; nPorcIT1 = 0;
     nDesde2 = 0; nHasta2 = 0; aTipo2 = "";
     aHospi2 = " "; aReca2 = " "; aFechaReca2 = " "; nPorcIT2 = 0;
     nume11 = 0;
     nume12 = 0;
     nume13 = 0;
     nume14 = 0;
     nume15 = 0;
     nume16 = 0;
     nume17 = 0;
     swAvisoAcc = 0;
     aMesHoy = "";
     nMesHoy = 0;
     nCampoRecSiNo = 0;
     nCampoFechaRec = 0;
     nNume = 0;
     swBajaEnCurso = 0;
     nDiaRecaida = 0;
     nMesRecaida = 0;
     nAnyRecaida = 0;
     nMesDesde = 0;
     nMesHasta = 0;
     nAnyDesde = 0;
     nAnyHasta = 0;
     nModoCab = 0;
     sw999 = 0;
     nConvenio = 0;

     &eaBloqueo = "";
     aMatPat = "";
     swAccDia1 = 0;
     nNume1 = 0;
     nNume2 = 0;
     nDiasInd = 0;
     sw902 = 0;

     aTipo = "";
     aTipoLetra = "";

     nDiasNatAlta = 0;
     &nTopemes = 0;
     nAnyXX = 0;
     nBaseCotCC = 0;
     nBaseCotCP = 0;
     nDiasCot = 0;
     nBuscaMeses = 0;
     i = 0;
     nBase = 0;
     nMesActual = 0;
|FIN;

|PROCESO borracero;
     |BORRA 020#nomvarca.a;
|FPRC;

|DEFBUCLE borracero;
     #nomvarca#1;
     ;
     00001, 00001, 00, 0
     99999, 99999, 00, 0
     be;
     NULL, borracero;
|FIN;

|PROCESO verifec1; |TIPO 0;
     |SI sw ! 2;
        fec = #0Campo;
     |FINSI;
     sw = 0;
|SI fec ! blanco; |Y fec ! puntos;
  dia1 = fec % A102;
  mes1 = fec % A402;
  any1 = fec % A704;
  dia = dia1; mes = mes1; any = any1;
  |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
     |SI mes [ 12; |Y mes ] 1;
       |SI mes = 1; |O mes = 3; |O mes = 5; |O mes = 7; |O mes = 8; |O mes = 10; |O mes = 12;
           tope = 31;
       |SINO;
           |SI mes = 2;
               mod = any $ 4;
               |SI mod = 0;
                   tope = 29;
               |SINO;
                   tope = 28;
               |FINSI;
            |SINO;
               tope = 30;
            |FINSI;
        |FINSI;
        |SI dia [ tope;
            sw = 1;
        |FINSI;
     |FINSI;
  |FINSI;
|SINO;
  sw = 1;
|FINSI;
|SI sw = 0;
    |MENAV men1;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO checfech; |TIPO 0;  || chequea que la fecha sea mayor o nula
     |SI #0Campo ! 0;
          hasnum = #0Campo;
          varnum = Campo - 4;
          desnum = #0varnum;
          |SI desnum > hasnum;
               |MENAV mensaje0;
               |ERROR;
          |FINSI;

          fecsys = ~;
          alfa1 = fecsys;
          alfa1 = alfa1 % -104;
          anynum = alfa1;
          mesnum = #0#2;
          |HAZ ulti_dia;
          |SI #0Campo > topemes;
               alfa1 = topemes;
               alfa1 = "    ATENCION: el mes tiene " + alfa1 + " días.";
               |MENAV alfa1;
               #0Campo = topemes;
               |PINTA #0Campo;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO chec1; |TIPO 0;  ||chequea que dias actual sea ! 0, cuando lo deba de ser
     varnum1 = Campo - 8;
     varnum2 = Campo - 4;
     varnum3 = Campo + 35;
     |SI #0Campo ! "F"; |Y #0Campo ! "H"; |Y #0Campo ! "V";
          |SI #0Campo ! " ";
               |SI #0varnum1 = 0;
                    |ABRE #1;
                    #1#0 = #0#0;
                    #1#1 = #0#1;
                    |LEE 000#1=;
                    |SI FSalida = 0;
                         |SI #0Campo ! "A";                || si el tipo no es correcto
                              |SI #1#60 ! #0Campo;
                                   |MENAV mensaje2;
                                   |ERROR;
                                   #0Campo = "";   || (asi no entra en los siguientes)
                              |FINSI;
                         |FINSI;
                         |SI #0Campo="E"; |O #0Campo="M"; |O #0Campo = "C";
                              || si dias actual enfer.=0
                              |SI #1#89 = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                         |SI #0Campo = "A";                || si dias actual accid.=0
                              |SI #1#92 = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |CIERRA #1;
               |SINO;
                    |SI #0Campo = "E"; |O #0Campo = "M"; |O #0Campo = "C";  || si dias actual ! 0
                         |SI #1#89 ! 0;                     || y desde dia ! 0
                              swporsi = 0;               || (enfermedad)
                              |PARA campo=Campo-1;|SI campo]12;|HACIENDO campo=campo-1;
                                   hasta = campo - 4;
                                   desde = Campo - 8;
                                   |SI #0desde > #0hasta;
                                        swporsi = 1;
                                   |FINSI;
                              |SIGUE;
                              |SI swporsi = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |SI #0Campo = "A";                     || si dias actual ! 0
                         |SI #1#92 ! 0;                     || tambien accidente
                              swporsi = 0;               || (accidente)
                              |PARA campo=Campo-1;|SI campo]12;|HACIENDO campo=campo-1;
                                   hasta = campo - 4;
                                   desde = Campo - 8;
                                   |SI #0campo = #0Campo; |Y #0desde > #0hasta;
                                        swporsi = 1;
                                   |FINSI;
                              |SIGUE;
                              |SI swporsi = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               #0varnum1 = 0;    || si el tipo es nada limpia el desde y
               #0varnum2 = 0;    || el hasta
               #0varnum3 = 100;    || el hasta
               |PINTA #0varnum1;
               |PINTA #0varnum2;
               |PINTA #0varnum3;
          |FINSI;
     |FINSI;
     |SI #0Campo ! "D";
          #0varnum3 = 100;
          |PINTA #0varnum3;
     |FINSI;
|FPRC;

|PROCESO desglosa; |TIPO 0;  || saca el dia de baja y comprueba que
    alfa1 = #0Campo % 102;   || este en el mes actual
    alfa2 = #0Campo % 402;
    baja = alfa1;
    mesbaja = alfa2;
|SI mesbaja ! #0#2; |Y mesbaja ! 0;
    |MENAV mensaje4;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO antbaja1; |TIPO 0;  || comprueba que dias no pasen de baja (DESDE)
    tipo = Campo + 8;
|SI baja ! 0; |Y #0tipo ! " ";
    |SI #0Campo > baja; |Y #0Campo ! 0;
        |MENAV mensaje3;
        |ERROR;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO antbaja2; |TIPO 0;  || comprueba que dias no pasen de baja (HASTA)
    tipo = Campo + 4;
|SI baja ! 0; |Y #0tipo ! " ";
    |SI #0Campo > baja; |O #0Campo = 0;
        |MENAV mensaje3;
        |ERROR;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO mirames; |TIPO 7; ||CALCULA EL MES POR DEFECTO SEGUN FECHA SISTEMA
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO nombremes;
     |SI nMes =  1;  p_mes = "ENERO     ";  |FINSI;
     |SI nMes =  2;  p_mes = "FEBRERO   ";  |FINSI;
     |SI nMes =  3;  p_mes = "MARZO     ";  |FINSI;
     |SI nMes =  4;  p_mes = "ABRIL     ";  |FINSI;
     |SI nMes =  5;  p_mes = "MAYO      ";  |FINSI;
     |SI nMes =  6;  p_mes = "JUNIO     ";  |FINSI;
     |SI nMes =  7;  p_mes = "JULIO     ";  |FINSI;
     |SI nMes =  8;  p_mes = "AGOSTO    ";  |FINSI;
     |SI nMes =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
     |SI nMes = 10;  p_mes = "OCTUBRE   ";  |FINSI;
     |SI nMes = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
     |SI nMes = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|FPRC;

|PROCESO pintames; |TIPO 0;      || PINTA EL MES LITERAL
     nMes = #0#2;
     |HAZ nombremes;
     |ATRI I;
     |PINTA 0718, p_mes;
     |ATRI 0;
|FPRC;

|PROCESO DesacDese;
     |CAMPO_MODIFICA #0#27, 1, "N";
     |CAMPO_VISUAL #0#27, 1, "N";
     |PINTA 1404, "                   ³";
|FPRC;

|PROCESO Borra949;
     |ABRE #nom900de;
     #nom900de#0 = 20;
     |LEE 101#nom900de.=;
     |SI FSalida = 0;    || existe concepto 949, en el numero de orden 20
                         || solo quiero que lo vea ADADE
          |HAZ BuscaModulo;
          |SI swModulo ! 2884; |Y swModulo ! 1;
               |BORRA 020#nom900de.a;
               |LIBERA #nom900de;
          |FINSI;
     |FINSI;
     |CIERRA #nom900de;
|FPRC;

|PROCESO tipo88_nomvarca; |TIPO 88;
     |HAZ Borra949;
     |BUCLE borracero;
     |HAZ Tipo88;
|FPRC;

|PROCESO tipo13; |TIPO 13;
     |HAZ pintames;
     |HAZ dese;
     |HAZ Activa51;
|FPRC;

|PROCESO huel1; |TIPO 7;
/*
|SI #0#12 = "H";|O #0#13 = "H";|O #0#14 = "H";|O #0#15 = "H";
    |CAMPO_MODIFICA #0#22, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#22, 1, "N";
        #0#22 = 0;  |PINTA #0#22;
|FINSI;
*/
|FPRC;

|PROCESO huel2; |TIPO 7;
/*
|SI #0#22 ! 0;
    |CAMPO_MODIFICA #0#25, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#25, 1, "N";
        #0#25 = "N";|PINTA #0#25;
|FINSI;
*/
|FPRC;

|PROCESO abse1; |TIPO 7;
/*
|SI #0#12 = "F";|O #0#13 = "F";|O #0#14 = "F";|O #0#15 = "F";
    |CAMPO_MODIFICA #0#23, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#23, 1, "N";
        #0#23 = 0;  |PINTA #0#23;
|FINSI;
*/
|FPRC;

|PROCESO abse2; |TIPO 7;
/*
|SI #0#23 ! 0;
    |CAMPO_MODIFICA #0#26, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#26, 1, "N";
        #0#26 = "N";|PINTA #0#26;
|FINSI;
*/
|FPRC;

|PROCESO vaca; |TIPO 7;
|SI #0#12 = "V";|O #0#13 = "V";|O #0#14 = "V";|O #0#15 = "V";
    |CAMPO_MODIFICA #0#24, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#24, 1, "N";
        #0#24 = 0;  |PINTA #0#24;
|FINSI;
|FPRC;

|PROCESO ayuda1; |TIPO 7;
     nEnEmpresa = #0#0;
     |HAZ BuscaModulo;

     |SI FSalida = 4;|O FSalida = 5;    |ACABA;   |FINSI;

     |PUSHV 05381579;
     |CUADRO 05 38 15 79;
     |ATRI R;
     ||            1234567890123456789012345678901234567890
     |PINTA 0639, " ----- RELACION DE CLAVES DE I.T. ----- ";
     |PINTA 0739, " (E) Enfermedad Comun.                  ";
     |PINTA 0839, " (A) Accidente de Trabajo.              ";
     |PINTA 0939, " (M) Maternidad.                        ";
     |PINTA 1039, " (P) Paternidad.                        ";
     |PINTA 1139, " (R) Riesgo durante el embarazo         ";
     |PINTA 1239, " (D) Expediente de Regulacion de Empleo.";
     |PINTA 1339, " (C) Control Pago IT S.S. (Agotamiento) ";
     |PINTA 1439, " (S) Alta Sin Retribuci¢n.              ";
     |ATRI 0;
|FPRC;

|PROCESO ayuda2; |TIPO 0;
|POPV;
|FPRC;

|PROCESO nobaja; |TIPO 0;
|SI #1#44 = "B";
    |MENAV "    Trabajador con situacion BAJA ...";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO dese; |TIPO 7;
/*
     |SI #0#12 = "D";|O #0#13 = "D";|O #0#14 = "D";|O #0#15 = "D";
          |CAMPO_VISUAL #0#27, 1, "S";
          |CAMPO_MODIFICA #0#27, 1, "S";
          |PINTA 1404, "Parte Dec. Des:";
          |PINTA #0#27;
     |SINO;
          |CAMPO_MODIFICA #0#27, 1, "N";
          |CAMPO_VISUAL #0#27, 1, "N";
          |PINTA 1404, "                   ³";
     |FINSI;
*/
|FPRC;

|PROCESO AvisoRec;
     |SI #0#35 = "S";|O #0#36 = "S";|O #0#37 = "S";|O #0#38 = "S";
          |SI #0#43 = 0;
               aAlfa = "    ATENCION. Es necesario introducir los días ";
               aAlfa = aAlfa + "acumulados de la IT inicial en las recaídas.";
               |MENAV aAlfa;
               aAlfa = "    Si no se introducen, la nómina calculada será incorrecta.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO reca_antes; |TIPO 7;
     |SI #0#35 = "S";|O #0#36 = "S";|O #0#37 = "S";|O #0#38 = "S";
          |CAMPO_MODIFICA #0#43, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#43, 1, "N";
     |FINSI;
|FPRC;

|PROCESO reca_despues;
     |SI #0#35 = "S";|O #0#36 = "S";|O #0#37 = "S";|O #0#38 = "S";
          |SI #0#43 = 0;
               |SI FSalida ! 2;
                    aAlfa = "    ATENCION. Es necesario introducir los días ";
                    aAlfa = aAlfa + "acumulados de la IT inicial en las recaídas.";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO activa; |TIPO 0;
     enEmpresa = #nomvarca#0;
     |HAZ MiraBloqueo;
     |SI eaBloqueo = "3";
         |ERROR;
         |PTEC 807;
     |FINSI;

nModo = (FEntrada /100) ! 0;
|SI nModo = 1;
     |ABRE #2;
     #2#0 = #0#0;
     |LEE 000#2=;
     |SI #2#50 = "S";
          |MENAV "    Empresa no activa.";
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FINSI;
|FPRC;

|PROCESO Hospital; |TIPO 7;
     nume1 = Campo - 19;
     |SI #0nume1 ! "E"; |Y #0nume1 ! "A"; |Y #0nume1 ! "C";
          #0Campo = "N";
          |PINTA #0Campo;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "S";
     |FINSI;
|FPRC;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
     bisiesto = 0;
     numer = anynum $ 4;
     |SI numer = 0;
          bisiesto = 1;
     |FINSI;
     topemes = 31;
     |SI mesnum= 2;
          topemes = 28 + bisiesto;
     |FINSI;
     |SI mesnum= 4;|O mesnum= 6;|O mesnum= 9;|O mesnum=11;
          topemes = 30;
     |FINSI;
|FPRC;

|PROCESO buscarencia;
     fech1 = #labtraba#36;
     fech2 = #labtraba#37;
     alfa1 = #labtraba#37;
     |QBF alfa1;
     |SI alfa1 = "";
          fFechaHoy = ~;
          aAlfa = fFechaHoy;
          aAlfa = aAlfa % -104;
          anynum = aAlfa;

          mesnum = #nomvarca#2;
          |HAZ ulti_dia;
          alfa1 = topemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
          alfa2 = mesnum;  alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
          alfa3 = anynum;
          alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
          fech2 = alfa4;
     |FINSI;

     nume1 = fech1;
     nume2 = fech2;
     nume3 = nume2 - nume1;
     nDiasAlta = nDiasAlta + nume3;
|FPRC;

|DEFBUCLE buscarencia;
     #labtraba#2;
     44;
     aNif, "B";
     aNif, "B";
     ;
     NULL, buscarencia;
     #labtraba#36;
|FIN;

|PROCESO carencia; |TIPO 7;
     ||SI #labtraba#247 = 138; |ACABA; |FINSI;
     swPreguntitas = 1;
     nDiasBaja = 0;
     mesnum = #nomvarca#2;
     fFechaHoy = ~;
     aAlfa = fFechaHoy;
     aAlfa = aAlfa % -104;
     anynum = aAlfa;
     |HAZ ulti_dia;

     |PARA nume1 = 4; |SI nume1 [ 8; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 + 4;
          nume3 = nume1 + 8;
          |SI #0nume3 = "E";
               |SI #0nume1 = 0;
                    nDesde = 1;
               |SINO;
                    nDesde = #0nume1;
               |FINSI;
               |SI #0nume2 = 0;
                    nHasta = topemes;
               |SINO;
                    nHasta = #0nume2;
               |FINSI;
               nDiasBaja = nDiasBaja + (nHasta - nDesde) + 1;
          |FINSI;
     |SIGUE;

     |SI nDiasBaja ! 0;
          aNif = #labtraba#7;
          nDiasAlta = 0;
          |SALVA_FICHA #labtraba;
          |BUCLE buscarencia;
          |REPON_FICHA #labtraba;
          fech1 = #labtraba#36;

          mesnum = #nomvarca#2;
          |HAZ ulti_dia;
          ||alfa1 = topemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
          alfa1 = "01";
          alfa2 = mesnum;  alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
          alfa3 = fFechaHoy; alfa3 = alfa3 % -104;
          alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
          fech2 = alfa4;

          || fech2 = fFechaHoy;
          nume1 = fech1;
          nume2 = fech2;
          nume3 = nume2 - nume1;
          nDiasAlta = nDiasAlta + nume3;

          |SI nDiasAlta < nCarencia; |Y #labtraba#60 ! "E"; |Y #labtraba#89 = 0;
          || si arrastro enfermedad del mes anterior y he tengo Prestaciones "S"
          || no tengo por que preguntar otra vez (segun Dany)
               |SI #labtraba#241 = "S";
                    alfa1 = nDiasAlta;
                    alfa2 = nCarencia;
                    aAlfa = "    ATENCION. El trabajador NO cumple el periodo de ";
                    aAlfa = aAlfa + " carencia y NO deberia cobrar prestacion por IT.";
                    |MENAV aAlfa;
                    aAlfa = "    NDesea cambiar el campo en la ficha del trabajador";
                    aAlfa = aAlfa + " a Prestaciones IT -> 'N'?";
                    |CONFI aAlfa;
                    |SI FSalida = 0;
                         #labtraba#241 = "N";
                         |ABRE #labtraba;
                         #labtraba#0 = #0#0;
                         #labtraba#1 = #0#1;
                         |LEE 101#labtraba.=;
                         #labtraba#241 = "N";
                         |GRABA 020#labtraba.a;
                         |LIBERA #labtraba;
                         |CIERRA #labtraba;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Recaida1; |TIPO 7;
     nume1 = Campo - 23;
     |SI #0nume1 ! "E"; |Y #0nume1 ! "A";
          #0Campo = "N";
          |PINTA #0Campo;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "S";
     |FINSI;
|FPRC;

|PROCESO FechaRec; |TIPO 7;
     nCampo = Campo - 4;
     |SI #0nCampo = "S";
          |CAMPO_MODIFICA #0Campo, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO CuantosDias;
     mesnum = nMes;
     anynum = nAny + 2000;
     |HAZ ulti_dia;
     |SI nDesde = 0;
          nDesde = 1;
     |FINSI;
     |SI nHasta = 0;
          nHasta = topemes;
     |FINSI;
|FPRC;

|PROCESO BuscaReca;
     aFecha = #0Campo;
     |QBF aFecha;
     |SI aFecha = "";
          |ACABA;
     |FINSI;

     |ABRE #nomhicca;
     aDia = #0Campo % 102;
     nDiaRecaida = aDia;
     aMes = #0Campo % 402;
     nMesRecaida = aMes;
     aAny = #0Campo % -104;
     nAnyRecaida = aAny;
     nAnyB = 0;
     nMesB = 0;
     swBajaEnCurso = 0;

     fFechaHoy = ~;
     aAlfa = fFechaHoy;
     aAlfa = aAlfa % -104;

     nMesDesde = 0;
     nMesHasta = 0;
     nAnyHasta = aAlfa;

     |PARA nAny = nAnyRecaida; |SI nAny [ nAnyHasta; |HACIENDO nAny = nAny + 1;
          |SI nAny < nAnyHasta;       || una IT del a¤o anterior
               |SI nAny = nAnyRecaida;
                    nMesDesde = nMesRecaida;
                    nMesHasta = 12;
               |SINO;
                    nMesDesde = 1;
                    nMesHasta = 12;
               |FINSI;
          |SINO;
               |SI nAnyRecaida = nAnyHasta;
                    nMesDesde = nMesRecaida;
                    nMesHasta = #0#2;
               |SINO;
                    nMesDesde = 1;
                    nMesHasta = #0#2;
               |FINSI;
          |FINSI;

          |PARA nMes = nMesDesde; |SI nMes [ nMesHasta; |HACIENDO nMes = nMes + 1;
               #nomhicca#0 = #0#0;
               #nomhicca#1 = #labtraba#1;
               #nomhicca#2 = nMes;
               #nomhicca#3 = 0;
               #nomhicca#66 = nAny - 2000;
               |LEE 000#nomhicca.=;
               |SI FSalida = 0;
                    |PARA nCampoT = 27; |SI nCampoT [ 30; |HACIENDO nCampoT = nCampoT + 1;
                         |SI #nomhicca#nCampoT# = #nomvarca#nCampo#;
                              || es el mismo tipo de IT

                              nCampoD = nCampoT - 8;
                              nCampoH = nCampoT - 4;
                              nCampoRecSiNo = nCampoT + 107;
                              nCampoFechaRec = nCampoT + 112;
                              |SI nDiaRecaida = #nomhicca#nCampoD#;
                              |Y nMesRecaida = #nomhicca#2;
                                   || esta es la IT INICIAL
                                   || a ver cuantos dias fueron
                                   nDesde = #nomhicca#nCampoD#;
                                   nHasta = #nomhicca#nCampoH#;
                                   |HAZ CuantosDias;
                                   nDiasAcum = nDiasAcum + (nHasta - nDesde + 1);

                                   aTipoBaja = #nomhicca#nCampoT#;

                                   |SI #nomhicca#nCampoH# = 0;
                                        swBajaEnCurso = 1;
                                   |SINO;
                                        swBajaEnCurso = 0;
                                   |FINSI;

                                   || busca cuanto dura la baja
                                   ||HAZ BuscaFinIT;
                              |SINO;
                                   || compruebo todas la IT que hayan sido
                                   || recaida con la misma fecha inicial
                                   |SI #nomhicca#nCampoRecSiNo# = "S";
                                   |Y #nomhicca#nCampoFechaRec# = aFecha;
                                        nDesde = #nomhicca#nCampoD#;
                                        nHasta = #nomhicca#nCampoH#;
                                        nNume = nMes + 1;
                                        |SI nNume = 13;
                                             nNume = 1;
                                        |FINSI;
                                        |SI nHasta = 0; |Y nNume = #0#2;
                                             || no me lo acumules, ya que es la IT
                                             || del mes anterior que continua en
                                             || este, los dias ya me vienen en
                                             || el campo acumulado del labtraba
                                        |SINO;
                                             |HAZ CuantosDias;
                                             nDiasAcum = nDiasAcum + (nHasta - nDesde + 1);
                                        |FINSI;
                                   |SINO;
                                        |SI #nomhicca#nCampoD# = 0; |Y swBajaEnCurso = 1;
                                             nDesde = #nomhicca#nCampoD#;
                                             nHasta = #nomhicca#nCampoH#;
                                             |HAZ CuantosDias;
                                             nDiasAcum = nDiasAcum + (nHasta - nDesde + 1);
                                             |SI #nomhicca#nCampoH# = 0;
                                                  swBajaEnCurso = 1;
                                             |SINO;
                                                  swBajaEnCurso = 0;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |SIGUE;
               |FINSI;
          |SIGUE;
     |SIGUE;
     |CIERRA #nomhicca;
|FPRC;

|DEFBUCLE BuscaReca;
     #labtraba#7;
     ;
     aNif, #0#0, 00001;
     aNif, #0#0, 99999;
     ;
     NULL, BuscaReca;
|FIN;

|PROCESO PromReca;
     nCampo = Campo;
     nCampo = nCampo - 4;
     |SI #0nCampo = "S";
          |ABRE #labtraba;
          #labtraba#0 = #nomvarca#0;
          #labtraba#1 = #nomvarca#1;
          |LEE 000#labtraba.=;
          |SI FSalida = 0;
               aAlfa = #0Campo;
               aAlfa = aAlfa % 402;
               nMesRecaida = aAlfa;

               |SI nMesRecaida = #0#2;
                    || parece ser una recaida de una enfermedad que ha empezado
                    || este mismo mes

                    aAlfa = #0Campo;
                    aAlfa = aAlfa % 102;
                    nDiaRecaida = aAlfa;

                    |PARA nume1 = 4; |SI nume1 [ 8; |HACIENDO nume1 = nume1 + 1;
                         nume2 = nume1 + 4;
                         nume3 = nume1 + 8;
                         |SI nDiaRecaida = #0nume1;
                              || esta es la IT inicial de este mes
                              nDiasAcum = #0nume2 - #0nume1 + 1;
                         |FINSI;
                    |SIGUE;
               |SINO;
                    swBajaInicial = 0;
                    nDiasAcum = 0;
                    aNif = #labtraba#7;
                    nCampo = nCampo - 23;
                    |BUCLE BuscaReca;
               |FINSI;

               |SI nDiasAcum > 0;
                    swBajaInicial = 1;
                    aMensaje = "    Se tendrán en cuenta";
                    aMensaje = aMensaje + " los días acumulados del proceso inicial";
                    aMensaje = aMensaje + " de baja";
                    |MENAV aMensaje;

                    #0#43 = nDiasAcum;
                    |PINTA #0#43;
               |SINO;
                    aMensaje = "    ATENCION: No se ha encontrado en el Historico ";
                    aMensaje = aMensaje + "el proceso inicial de baja en la fecha indicada";
                    |MENAV aMensaje;
                    #0#17 = 0;
                    #0#18 = 0;
                    #0#43 = 0;
                    |PINTA #0#17;
                    |PINTA #0#18;
                    |PINTA #0#43;
               |FINSI;
          |FINSI;
          |CIERRA #labtraba;
     |FINSI;
|FPRC;

|PROCESO BuscaJor;
     #nomvarli#0 = #nomvarli#0;
     #nomvarli#1 = #nomvarli#1;
     #nomvarli#2 = #nomvarli#2;
     #nomvarli#3 = #nomvarli#3;
     |SI #nomvarli#4 = 903;
          #nomvarli#4 = 922;
     |SINO;
          #nomvarli#4 = 903;
     |FINSI;
     |LEE 000#nomvarli.=;
     |SI FSalida = 0;
          nume1 = #nomvarli#5;
     |FINSI;
|FPRC;

|PROCESO LimiteJor;
     |SI #nomvarli#4 ! 903; |Y #nomvarli#4 ! 922;
          |ACABA;
     |FINSI;

     |SI #labtraba#247 ! 613; || solo agrarios, citricos por ejemplo NO
          |ACABA;
     |FINSI;

     fFechaHoy = ~;
     aAlfa = fFechaHoy;
     aAlfa = aAlfa % -104;
     anynum = aAlfa;

     nume1 = 0;

     |SALVA_FICHA #nomvarli;
     |HAZ BuscaJor;
     |REPON_FICHA #nomvarli;

     nume1 = nume1 + #nomvarli#5;
     alfa1 = #labtraba#0; alfa1 = "00000" + alfa1; alfa1 = alfa1 % -105;
     alfa2 = #labtraba#1; alfa2 = "00000" + alfa2; alfa2 = alfa2 % -105;
     /*
     |SI anynum = 2009;
          alfa3 = "2009";
          alfa4 = "24";
          |SI nume1 > 24;
               aAlfa = "    ATENCION: el trabajador " + alfa1 + "." + alfa2;
               aAlfa = aAlfa + " supera el límite máximo de " + alfa4  + " jornadas cotizables para ";
               aAlfa = aAlfa + alfa3;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
     */
     |SI anynum ] 2010;
          || en los convenios con conceptos 101 que sean D1 o M1 no tienen
          || que limitar las jornadas a 23 en la introduccion ya que se cobra
          || segun las jornadas introducidas y se puede cobrar lo que se quiera
          || siempre que luego la nomina limite a 23

          |ABRE #nomconli;
          #nomconli#0 = #labtraba#87;
          #nomconli#2 = 101;
          |LEE 000#nomconli.=;
          |SI FSalida = 0;
               |SI #nomconli#3 = "D"; |O #nomconli#3 = "M";
                    |SI #nomconli#4 = 1;
                         |CIERRA #nomconli;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #nomconli;

          alfa3 = anynum;
          alfa4 = "23";
          |SI nume1 > 23;
               aAlfa = "    ATENCION: el trabajador " + alfa1 + "." + alfa2;
               aAlfa = aAlfa + " supera el límite máximo de " + alfa4  + " jornadas cotizables para ";
               aAlfa = aAlfa + alfa3;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CompReca; |TIPO 0;
     |SI #0#35 = "N"; |Y #0#36 = "N"; |Y #0#37 = "N"; |Y #0#38 = "N";
          #0#43 = 0;
     |FINSI;
|FPRC;

|PROCESO ComentAnt; |TIPO 7;
     |SI Campo = 4;
         enEmpresa = #nomvarca#0;
         |HAZ MiraBloqueo;
         |SI eaBloqueo = "3";
             |ERROR;
             |PTEC 807;
             |ACABA;
         |FINSI;
     |FINSI;

     nModo = (FEntrada /100) ! 0;
     |SI nModo = 1;
/*
          |ABRE #labempre;
          #labempre#0 = #nomvarca#0;
          |LEE 000#labempre.=;
*/
          || comentario Anticipos - 1 -
          aAlfa = #labempre#61;
          |QBT aAlfa;
          |SI aAlfa = ""; |O aAlfa = "nticipos";
               #nomvarca#28 = "Anticipos";
          |SINO;
               #nomvarca#28 = #labempre#61;
          |FINSI;
          |PINTA #nomvarca#28;

          || comentario Anticipos - 2 -
          aAlfa = #labempre#62;
          |QBT aAlfa;
          |SI aAlfa = ""; |O aAlfa = "nticipos";
               #nomvarca#29 = "Anticipos";
          |SINO;
               #nomvarca#29 = #labempre#62;
          |FINSI;
          |PINTA #nomvarca#29;

          || comentario Anticipos - 3 -
          aAlfa = #labempre#63;
          |QBT aAlfa;
          |SI aAlfa = ""; |O aAlfa = "nticipos";
               #nomvarca#45 = "Anticipos";
          |SINO;
               #nomvarca#45 = #labempre#63;
          |FINSI;
          |PINTA #nomvarca#45;

          ||CIERRA #labempre;
     |FINSI;
|FPRC;

|PROCESO promcomp;
     || nueva rutina esta vez para comprobar que si no tenemos la nomina
     || del mes anterior en el historico y la tenemos en el mensual y ha
     || sucedido algo en el mes que hace que me cambie el promedio, el
     || programa lo recoja correctamente

     |SI #labtraba#95 ! 0;
          |SI swHayIT = 1;
               |ABRE #nomhicca;
               |ABRE #nomcalca;
               nMes = #0#2 - 1;
               fFechaHoy = ~;
               aFechaHoy = fFechaHoy;
               aAny = aFechaHoy % -104;
               nAny = aAny;
               nAny = nAny - 2000;
               |SI nMes = 0;
                    nMes = 12;
                    nAny = nAny - 1;
               |FINSI;

               #nomhicca#0 = #0#0;
               #nomhicca#1 = #0#1;
               #nomhicca#2 = nMes;
               #nomhicca#3 = 0;
               #nomhicca#66 = nAny;
               |LEE 000#nomhicca.=;
               |SI FSalida ! 0;    || ojo, que no tenemos nomina calculada
                                   || del mes anterior, a ver el mensual

                    #nomcalca#0 = #0#0;
                    #nomcalca#1 = #0#1;
                    #nomcalca#2 = nMes;
                    #nomcalca#3 = 0;
                    |LEE 000#nomcalca.=;
                    |SI FSalida = 0;
                         promE_AUTO = #nomcalca#39 / #nomcalca#8;
                         promA_AUTO = (#nomcalca#39 - (#nomcalca#41 + #nomcalca#42)) / #nomcalca#8;
                         promE_AUTO = promE_AUTO ! 2;
                         promA_AUTO = promA_AUTO ! 2;
                         |SI promE_AUTO ! #labtraba#95; |O promA_AUTO ! #labtraba#96;
                              aAlfa = "    ATENCION. El promedio segun la ultima ";
                              aAlfa = aAlfa + " nomina en el Mant. Mensual es distinto al del Trabajador.";
                              |MENAV aAlfa;
                              aMes = nMes; aMes = ("00" + aMes) % -102;
                              aAlfa = "    Se usara el nuevo promedio calculado. Para evitar esto ";
                              aAlfa = aAlfa + " actualice al historico el mes " + aMes;
                              |MENAV aAlfa;
                              #0#17 = promE_AUTO;
                              #0#18 = promA_AUTO;
                              |PINTA #0#17;
                              |PINTA #0#18;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalca;
               |CIERRA #nomhicca;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EstimaPromedio;
    nEmpAUTO = #0#0;
    nTraAUTO = #0#1;
    nMesAUTO = #0#2;
    fFechaHoy = ~;
    aAlfa = fFechaHoy;
    aAlfa = aAlfa % -104;
    anynum = aAlfa;
    nAnyAUTO = anynum;

    aAlfa1 = fFechaHoy;
    aAlfa1 = aAlfa1 % 402;
    nNume = aAlfa1;
    |SI nNume = 1; |O nNume = 2;
         |SI nMesAUTO = 12;
              || a ver, el mes de diciembre, y la fecha del sistema
              || es enero (hasta febrero), es el caso de estar
              || introduciendo una variacion de diciembre en enero
              || del a¤o siguiente, con lo que el a¤o del que tengo que
              || simular la nomina no es el de la fecha del sistema
              || sino el anterior
              nAnyAUTO = nAnyAUTO - 1;
         |FINSI;
    |FINSI;
    |SUB_EJECUTA "nomcalcu;NOMVARCA";
    promE_AUTO = promE_AUTO ! 2;
    promA_AUTO = promA_AUTO ! 2;

    |SI promE_AUTO ! #0#17; |O promA_AUTO ! #0#18;
         |SI #0#17 = 0; |Y #0#18 = 0;
              #0#17 = promE_AUTO;
              #0#18 = promA_AUTO;
         |SINO;
              aAlfa = "    ATENCION: El promedio calculado en base a los ";
              aAlfa = aAlfa + "datos del trabajador ha cambiado."
              |MENAV aAlfa;
              aAlfa = "    Si ha comunicado la IT a la TGSS la base ";
              aAlfa = aAlfa + "de cotizacion no deberia variar. "
              |MENAV aAlfa;
              aAlfa = "    SDesea conservar el promedio actual?"
              |CONFI aAlfa;
              |SI FSalida ! 0;
                   #0#17 = promE_AUTO;
                   #0#18 = promA_AUTO;
              |SINO;
                   promE_AUTO = #0#17;
                   promA_AUTO = #0#18;
              |FINSI;
         |FINSI;
    |FINSI;

    |PINTA #0#17;
    |PINTA #0#18;
|FPRC;

|PROCESO PromAccDia1;
     || ojo, si es accidente y empieza el dia uno del mes, el promedio
     || tiene que ser con el que se calculara la nomina del mes anterior
     || ya que el accidente comenz¢ el £ltimo d¡a del mes anterior

     nNume1 = 0;
     nNume2 = 0;

     |ABRE #nomhicca;
     |ABRE #nomcalca;
     nMes = #0#2 - 1;
     fFechaHoy = ~;
     aFechaHoy = fFechaHoy;
     aAny = aFechaHoy % -104;
     nAny = aAny;
     nAny = nAny - 2000;
     |SI nMes = 0;
          nMes = 12;
          nAny = nAny - 1;
     |FINSI;

     #nomhicca#0 = #0#0;
     #nomhicca#1 = #0#1;
     #nomhicca#2 = nMes;
     #nomhicca#3 = 0;
     #nomhicca#66 = nAny;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          nNume1 = #nomhicca#35;
          nNume2 = #nomhicca#36;
     |SINO;
     || no tenemos nomina calculada del mes anterior en hco., a ver el mensual
          #nomcalca#0 = #0#0;
          #nomcalca#1 = #0#1;
          #nomcalca#2 = nMes;
          #nomcalca#3 = 0;
          |LEE 000#nomcalca.=;
          |SI FSalida = 0;
               nNume1 = #nomhicca#35;
               nNume2 = #nomhicca#36;
          |FINSI;
     |FINSI;
     |SI nNume1 ! 0;
          |SI nNume1 ! #labtraba#95; |O nNume2 ! #labtraba#96;
               aAlfa = "    ATENCION. Se tendrá en cuenta el promedio segun la ";
               aAlfa = aAlfa + " Base de Cot. de ";
               nMes = nMes - 1;
               |SI nMes = 0;
                    nMes = 12;
               |FINSI;
               |HAZ nombremes;
               |QBF p_mes;
               aAlfa = aAlfa + " " + p_mes + " (Acc. día 1)";
               |MENAV aAlfa;
               #0#17 = nNume1;
               #0#18 = nNume2;
               |PINTA #0#17;
               |PINTA #0#18;
          |FINSI;
     |FINSI;
     |CIERRA #nomcalca;
     |CIERRA #nomhicca;
|FPRC;

     || el promedio no es el de la nomina del mes anterior, sino el de la otra
|FPRC;

|PROCESO promedio; |TIPO 7;
     swPreguntitas = 1;

     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 101#labtraba.=;
     |CIERRA #labtraba;

     |SI #labtraba#247 = 613;
          |ACABA;
     |FINSI;

     swMiraPromE = 0;
     swMiraPromA = 0;
     swMiraProm = 0;
     swAccDia1 = 0;

     |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
          |SI #0nume1 = "E";
               swMiraPromE = 1;
          |FINSI;
          |SI #0nume1 = "M";
               swMiraPromE = 2;
          |FINSI;
          |SI #0nume1 = "P";
               swMiraPromE = 3;
          |FINSI;
          |SI #0nume1 = "A";
               swMiraPromA = 1;
               nume2 = nume1 - 8;
               |SI #0nume2 = 1;
                    swAccDia1 = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI swMiraPromE ! 0; |O swMiraPromA ! 0;
          swHayIT = 1;
     |SINO;
          swHayIT = 0;
     |FINSI;
     |SI swMiraPromE ! 0;|Y #labtraba#95 = 0;
          |SI swMiraPromE = 1;
               aAlfa = "Enfermedad";
          |FINSI;
          |SI swMiraPromE = 2;
               aAlfa = "Maternidad";
          |FINSI;
          |SI swMiraPromE = 3;
               aAlfa = "Paternidad";
          |FINSI;
          aAlfa = "    AVISO: El trabajador es baja por " + aAlfa + " sin tener calculado ";
          aAlfa = aAlfa + " promedio. Se procederá al cálculo";
          |MENAV aAlfa;
     |SINO;
          swMiraPromE = 0;
     |FINSI;
     |SI swMiraPromA = 1; |Y #labtraba#96 = 0;
          aAlfa = "    AVISO: El trabajador es baja por Accidente sin tener calculado ";
          aAlfa = aAlfa + " promedio. Se procederá al cálculo";
          |MENAV aAlfa;
          swMiraPromA = 1;
     |SINO;
          swMiraPromA = 0;
     |FINSI;
     swMiraProm = swMiraPromE + swMiraPromA;

     |SI swMiraProm > 0;
          |HAZ EstimaPromedio;
     |SINO;
          |SI swHayIT = 1;
               |HAZ promcomp;
          |FINSI;
     |FINSI;

     |SI swAccDia1 = 1;
          |HAZ PromAccDia1;
     |FINSI;

          || ahora calulo los dias de alta para poder llevarme la base de
          || cotizacion para mi informe de IT

          fFecha = #labtraba#36;   || la fecha de Alta
          aFecha = fFecha;
          aFechaHoy = fFechaHoy;
          alfa1 = aFecha % 407;
          alfa2 = #nomvarca#2;     || mes de la baja
          alfa2 = "00" + alfa2;
          alfa2 = alfa2 % -102;
          alfa2 = alfa2 + (aFechaHoy % -105);

          mesnum = #nomvarca#2;
          |HAZ ulti_dia;

          |SI alfa1 ! alfa2;       || no es alta este mes, cotiza mes completo
               |SI #2#42 ! "D"; |Y #2#42 ! "T";   || cotiz. mensual
                    nDiasCotExt = 30;
               |SINO;
                    nDiasCotExt = topemes;
               |FINSI;
          |SINO;                   || es alta este mes
               aDia = topemes;
               aDia = ("00" + aDia) % -102;
               aFechaFin = aDia + "." + alfa2;
               fFechaFin = aFechaFin;   || ultimo dia de mes
               fFecha = #labtraba#36;   || la fecha de Alta
               nDiasCotExt = fFechaFin - fFecha;
               nDiasCotExt = nDiasCotExt + 1;
          |FINSI;
|FPRC;

|PROCESO BajaInicial;
     |SI aAccExt = "X";  || no hay fecha fin de baja, no tengo que seguir
          |ACABA;
     |FINSI;
     |ABRE #nomhicca;
     swStop = 0;
     nMes = #0#2 - 1;
     fFechaHoy = ~;
     aFechaHoy = fFechaHoy;
     aAny = aFechaHoy % -104;
     nAny = aAny;
     nAny = nAny - 2000;
     nAnyBus = nAny - 3; || no voy a busar mas alla de 3 a¤os atras, dare error
     |PARA; |SI swStop = 0; |HACIENDO nMes = nMes - 1;
          |SI nMes = 0;
               nMes = 12;
               nAny = nAny - 1;
          |FINSI;
          #nomhicca#0 = #0#0;
          #nomhicca#1 = #0#1;
          #nomhicca#2 = nMes;
          #nomhicca#3 = 0;
          #nomhicca#66 = nAny;
          |LEE 000#nomhicca.=;
          |SI FSalida = 0;
               |PARA nCampoTB = 27; |SI nCampoTB [ 30; |HACIENDO nCampoTB = nCampoTB + 1;
                    |SI #nomhicca#nCampoTB# = #0nume1;
                         nCampoDB = nCampoTB - 8;
                         nCampoHB = nCampoTB - 4;
                         |SI #nomhicca#nCampoDB# ! 0; |Y #nomhicca#nCampoHB# = 0;
                              swStop = 1;
                              |SAL;
                         |FINSI;
                    |FINSI;
               |SIGUE;
          |FINSI;
          |SI nAny = nAnyBus;
               swStop = 2; || demasiado buscar y nada encontrar
               |MENAV "    ATENCION: No se ha encontrado la fecha de la baja inicial";
               dia1 = 1; mes1 = #0#2; nAnyBus = nAnyBus + 2000 + 3; any1 = nAnyBus;
          |FINSI;
     |SIGUE;
     |SI swStop = 1;
          dia1 = #nomhicca#nCampoDB#;
          mes1 = #nomhicca#2;
          nAny = nAny + 2000;
          any1 = nAny;
     |FINSI;
     |CIERRA #nomhicca;
|FPRC;

/*
|| no sirve para nada, lo dejo aqui por si acaso.

|PROCESO AltaPat;
     |SI #0Campo = "P";
          mesnum = #0#2;
          |HAZ ulti_dia;

          nCampo = Campo - 8;

          nNume = #0nCampo + 13;

          |SI nNume [ topemes;
               nCampo = nCampo + 4;
               #0nCampo = nNume;
               |PINTA #0nCampo;
          |FINSI;
     |FINSI;
|FPRC;
*/

|PROCESO BorraPats;
     |SI #nommauto#4 ! fFechaIni; |O #nommauto#6 ! aMatPat;
          |BORRA 101#nommauto.a;
     |FINSI;
|FPRC;

|DEFBUCLE BorraPats;
     #nommauto#1;
     ;
     #labtraba#0, #labtraba#1, "01.01.1900", "M";
     #labtraba#0, #labtraba#1, "31.12.2999", "P";
     be;
     NULL, BorraPats;
|FIN;

|PROCESO ControlPat; |TIPO 7;
     swPreguntitas = 1;
     |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 - 8;
          nume3 = nume1 - 4;
          |SI #0nume1 = "P"; |Y #0nume2 ! 0; |Y #0nume3 = 0;
               || busco fecha inicio paternidad
               aDia = #0nume2; aDia = ("00" + aDia) % -102;
               nMes = #0#2;
               aMes = nMes; aMes = ("00" + aMes) % -102;

               fFechaHoy = ~;
               aFechaHoy = fFechaHoy;
               aAny = aFechaHoy % -104;

               aMesHoy = aFechaHoy % 402;
               nMesHoy = aMesHoy;
               aAny = aFechaHoy % -104;
               |SI nMesHoy = 01; |O nMesHoy = 02;
                    |SI nMes = 11; |O nMes = 12;
                         nAny = aAny;
                         nAny = nAny - 1;
                         aAny = nAny;
                    |FINSI;
               |FINSI;

               aFecha = aDia + "." + aMes + "." + aAny;
               fFechaIni = aFecha;

               |ABRE #nommauto;

               #nommauto#0 = #0#0;
               #nommauto#2 = #0#1;
               #nommauto#4 = fFechaIni;
               #nommauto#6 = "P";
               |LEE 101#nommauto.=;
               |SI FSalida = 0;
                    |CIERRA #nommauto;
                    |ACABA;
               |FINSI;

               |PUSHV 11201760;
               |COLOR 7,1;
               |ATRI I;
               ||            2     3         4         5
               ||            456789012345678901234567890123456
               |PINTA 1124, " - Aviso fecha fin  paternidad - ";
               |PINTA 1224, " ¨Desea activar la variacion au- ";
               |PINTA 1324, " tom tica de la fecha de fin del ";
               |PINTA 1424, " periodo de paternidad? (S/N):   ";
               |PINTA 1524, "                                 ";
               E_sup = 1;
               E_inf = "";
               aAlfa = "S";
               aAlfa = 1454 ? 1;
               |QBF aAlfa;
               |SI aAlfa = "S";
                    |COLOR 7,1;
                    |ATRI I;
                    ||            2     3         4         5
                    ||            456789012345678901234567890123456
                    |PINTA 1524, "  Fecha fin paternidad prevista  ";
                    |PINTA 1624, "                                 ";

                    || le sumo los 13 dias que dura la paternidad
                    || para proponer fecha nueva

                    nFecha = fFechaIni;

                   |SI fFechaIni ] "01.01.2020";
                       nFecha = nFecha + 83;    || 12 semanas
                   |SINO;
                       |SI fFechaIni ] "01.04.2019";
                             nFecha = nFecha + 55;    || 8 semanas
                        |SINO;
                             nFecha = nFecha + 34;    || 5 semanas
                        |FINSI;
                   |FINSI;
                    fFechaFin = nFecha;

                    E_sup = 10;
                    E_inf = "";
                    fFechaFin = 1636 ? 2;
                    |ATRI 0;

                    #nommauto#0 = #0#0;
                    #nommauto#2 = #0#1;
                    #nommauto#4 = fFechaIni;
                    #nommauto#6 = "P";
                    |LEE 101#nommauto.=;
                    |SI FSalida = 0;
                         aAlfa = "    ATENCION: Ya existe una baja por paternidad ";
                         aAlfa = aAlfa + "para este trabajador en esta fecha";
                         |MENAV aAlfa;
                    |SINO;
                         #nommauto#1 = #labempre#2;
                         #nommauto#3 = #labtraba#2;
                         #nommauto#5 = fFechaFin;
                         |GRABA 020#nommauto.n;
                         |LIBERA #nommauto;

                         aAlfa1 = fFechaIni;
                         aAlfa2 = fFechaFin;
                         aAlfa1 = aAlfa1 % 402;
                         aAlfa2 = aAlfa2 % 402;
                         |SI aAlfa1 = aAlfa2;     || mes alta = mes inicio Pater
                              aAlfa2 = fFechaFin;
                              aAlfa2 = aAlfa2 % 102;
                              nume4 = aAlfa2;
                              #0nume3 = nume4;
                              |PINTA #0nume3;
                         |FINSI;
                         aMatPat = "P";
                         |BUCLE BorraPats;
                    |FINSI;
               |FINSI;
               |POPV;
               |CIERRA #nommauto;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ControlMat; |TIPO 7;
     swPreguntitas = 1;
     |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 - 8;
          nume3 = nume1 - 4;
          |SI #0nume1 = "M"; |Y #0nume2 ! 0; |Y #0nume3 = 0;
               || busco fecha inicio maternidad
               aDia = #0nume2; aDia = ("00" + aDia) % -102;
               nMes = #0#2;
               aMes = nMes; aMes = ("00" + aMes) % -102;
               fFechaHoy = ~;
               aFechaHoy = fFechaHoy;
               aAny = aFechaHoy % -104;

               aMesHoy = aFechaHoy % 402;
               nMesHoy = aMesHoy;
               aAny = aFechaHoy % -104;
               |SI nMesHoy = 01; |O nMesHoy = 02;
                    |SI nMes = 11; |O nMes = 12;
                         nAny = aAny;
                         nAny = nAny - 1;
                         aAny = nAny;
                    |FINSI;
               |FINSI;

               aFecha = aDia + "." + aMes + "." + aAny;
               fFechaIni = aFecha;

               |ABRE #nommauto;

               #nommauto#0 = #0#0;
               #nommauto#2 = #0#1;
               #nommauto#4 = fFechaIni;
               #nommauto#6 = "M";
               |LEE 101#nommauto.=;
               |SI FSalida = 0;
                    |CIERRA #nommauto;
                    |ACABA;
               |FINSI;

               |PUSHV 11201760;
               |COLOR 7,1;
               |ATRI I;
               ||            2     3         4         5
               ||            456789012345678901234567890123456
               |PINTA 1124, " - Aviso fecha fin  maternidad - ";
               |PINTA 1224, " ¨Desea activar la variacion au- ";
               |PINTA 1324, " tom tica de la fecha de fin del ";
               |PINTA 1424, " periodo de maternidad? (S/N):   ";
               |PINTA 1524, "                                 ";
               E_sup = 1;
               E_inf = "";
               aAlfa = "S";
               aAlfa = 1454 ? 1;
               |QBF aAlfa;
               |SI aAlfa = "S";
                    |COLOR 7,1;
                    |ATRI I;
                    ||            2     3         4         5
                    ||            456789012345678901234567890123456
                    |PINTA 1524, "  Fecha fin maternidad prevista  ";
                    |PINTA 1624, "                                 ";

                    || le sumo los 111 dias que dura la maternidad
                    || para proponer fecha nueva

                    nFecha = fFechaIni;
                    nFecha = nFecha + 111;
                    fFechaFin = nFecha;

                    E_sup = 10;
                    E_inf = "";
                    fFechaFin = 1636 ? 2;
                    |ATRI 0;

                    #nommauto#0 = #0#0;
                    #nommauto#2 = #0#1;
                    #nommauto#4 = fFechaIni;
                    #nommauto#6 = "M";
                    |LEE 101#nommauto.=;
                    |SI FSalida = 0;
                         aAlfa = "    ATENCION: Ya existe una baja por maternidad ";
                         aAlfa = aAlfa + "para este trabajador en esta fecha";
                         |MENAV aAlfa;
                    |SINO;
                         #nommauto#1 = #labempre#2;
                         #nommauto#3 = #labtraba#2;
                         #nommauto#5 = fFechaFin;
                         |GRABA 020#nommauto.n;
                         |LIBERA #nommauto;

                         aMatPat = "M";
                         |BUCLE BorraPats;
                    |FINSI;
               |FINSI;
               |POPV;
               |CIERRA #nommauto;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO IniPreg;
     |SI Contenido ! #0Campo;
          swPreguntitas = 0;
     |FINSI;
|FPRC;

|PROCESO min1;
     #nomvarli#0 = #nomvarca#0;
     #nomvarli#1 = #nomvarca#1;
     #nomvarli#2 = #nomvarca#2;
     #nomvarli#3 = #nomvarca#3;
     #nomvarli#4 = 101;
|FPRC;

|PROCESO max1;
     #nomvarli#0 = #nomvarca#0;
     #nomvarli#1 = #nomvarca#1;
     #nomvarli#2 = #nomvarca#2;
     #nomvarli#3 = #nomvarca#3;
     #nomvarli#4 = 999;
|FPRC;

|PROCESO Linea902;
     |SI Contenido = #0Campo;
          |ACABA;
     |FINSI;

     || creacion automatica de la linea 902 en variaciones
     sw902 = 0;
     nDiasInd = 0;
     |SI #nomvarca#46 ! 0;
     |Y #nomvarca#46 ! 93;
          |ABRE #motibaja;
          #motibaja#0 = #nomvarca#46;
          |LEE 000#motibaja.=;
          |SI FSalida = 0;
               nDiasInd = #motibaja#2;
          |FINSI;

          |SI nDiasInd ! 0;
               aAlfa = "    Este motivo de baja tiene asociada una indemnización de ";
               aAlfa1 = nDiasInd; |QBF aAlfa1;
               |SI #nomvarca#46 = 98;
                    aAlfa4 = #labtraba#34;
                    fFecha = aAlfa4;
                    |SI fFecha < "12.02.2012";
                         aAlfa1 = "45 ó 33";
                    |SINO;
                         aAlfa1 = "33";
                         nDiasInd = 33;
                    |FINSI;
                    aAlfa = aAlfa + aAlfa1 + " días por año trab. ";
               |SINO;
                    aAlfa = aAlfa + aAlfa1 + " días por año trabajado ";
               |FINSI;
               aAlfa2 = #motibaja#3; |QBF aAlfa2;
               aAlfa1 = "(máx. " + aAlfa2 + " meses)";
               |SI #nomvarca#46 = 93;
                    aAlfa1 = "";
               |FINSI;
               |SI #nomvarca#46 = 98;
                    aAlfa4 = #labtraba#34;
                    fFecha = aAlfa4;
                    |SI fFecha < "12.02.2012";
                         aAlfa1 = "(máx. 42 ó 24 meses)";
                    |SINO;
                         aAlfa1 = "(máx. 24 meses)";
                    |FINSI;
               |FINSI;
               aAlfa = aAlfa + aAlfa1;
               |MENAV aAlfa;
               aAlfa = "    Se creará la línea con el concepto 902 correspondiente";
               |MENAV aAlfa;

               |ABRE #nomvarli;
               #nomvarli#0 = #nomvarca#0;
               #nomvarli#1 = #nomvarca#1;
               #nomvarli#2 = #nomvarca#2;
               #nomvarli#3 = #nomvarca#3;
               #nomvarli#4 = 902;
               |LEE 101#nomvarli.=;
               |SI FSalida = 0;
                    || si ya existia borro el 902 que hubiera
                    |BORRA 020#nomvarli.a;
               |FINSI;
               aAlfa = nDiasInd; |QBF aAlfa;
               |QBF aAlfa;
               aAlfa = ("          " + aAlfa) % -110;

               #nomvarli#5 = aAlfa;
               #nomvarli#6 = "Indemniz.A¤o";
               |GRABA 020#nomvarli.n;
               |LIBERA #nomvarli;

               |ENTLINEAL #1#nomvarli, -1, 7, 22, 0, min1, max1

               |CIERRA #nomvarli;
               sw902 = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO enlaces; |TIPO 7;
     |SI swAvisoAcc = 1;
          |POPV;
     |FINSI;

     swPreguntitas = 1;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;

     |SI #nomcontr#41 = "N";
          |ACABA;
     |FINSI;

     swHayIT = 0;
     |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
          |SI #0nume1 = "E"; |O #0nume1 = "M"; |O #0nume1 = "P"; |O #0nume1 = "R";
               swHayIT = 1;
          |FINSI;
          |SI #0nume1 = "A";
               swHayIT = 1;
          |FINSI;
     |SIGUE;
     |SI swHayIT = 0;
          |ACABA;
     |FINSI;
     swImpDatIT = 0;
     aAlfa = "    S¿Desea consultar / rellenar / enviar los datos del parte de IT?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          swImpDatIT = 1;
     |FINSI;
     |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 - 8;       || desde
          nume5 = nume1 - 4;       || hasta
          nume3 = nume1 + 23;
          nume4 = nume1 + 27;
          |SI #0nume1 = "E"; |O #0nume1 = "A"; |O #0nume1 = "M";
          |O #0nume1 = "P"; |O #0nume1 = "R";
          ||SI #0nume1 = "E"; |O #0nume1 = "A";
               nEmpExt = #0#0;
               nTraExt = #0#1;
               |PARA nParte = 1; |SI nParte [ 2; |HACIENDO nParte = nParte + 1;
                    aAccExt = "X";
                    |SI nParte = 1;          || primero parte de baja
                         |SI #0nume2 ! 0;    || tengo que hacer parte de baja
                              aAccExt = "B";
                         |SINO;
                              aAccExt = "X"; || si no hay fecha desde no
                         |FINSI;             || hay parte de baja
                         dia1 = #0nume2;
                    |FINSI;
                    |SI nParte = 2;          || despues el parte de alta
                         |SI #0nume5 ! 0;
                              aAccExt = "A";
                         |SINO;
                              aAccExt = "X"; || si no hay fecha hasta no
                         |FINSI;             || hay parte de baja
                         dia2 = #0nume5;
                         mes2 = #0#2;

                         || ahora tengo que buscar la fecha de la baja inicial

                         |SI #0nume2 ! 0;         || si es baja el mismo mes
                              dia1 = #0nume2;     || que es alta
                              mes1 = #0#2;
                              fFechaHoy = ~;
                              any1 = fFechaHoy;
                              any1 = any1 % -104;
                         |SINO;
                              |HAZ BajaInicial;   || sino a buscarla por el
                                                  || nomhicca;
                         |FINSI;

                         || ya tengo fecha de baja inicial dia1/mes1 y
                         || fecha de alta dia2/mes2
                    |FINSI;

                    aTipExt = #0nume1;

                    || comentado ya que no hay que coger la base del mes
                    || anterior a la baja inicial sino la base del mes
                    || anterior a la fecha de inicio de la IT aunque sea
                    || recaida

                    || aRecExt = #0nume3;
                    || aFecRecExt = #0nume4;

/*
                    |SI #0nume2 = 0;
                         dia1 = "01";
                    |SINO;
                         dia1 = #0nume2;
                    |FINSI;
*/

                    |SI nParte = 1;
                         dia1 = "00" + dia1; dia1 = dia1 % -102;
                         mes1 = #0#2;
                         mes1 = "00" + mes1; mes1 = mes1 % -102;
                         fFechaHoy = ~;
                         aAlfa = fFechaHoy;
                         aAlfa = aAlfa % -104;
                         aAlfa = dia1 + "." + mes1 + "." + aAlfa;
                         fFecExt = aAlfa;
                    |FINSI;

                    |SI nParte = 2;
                         dia1 = "00" + dia1; dia1 = dia1 % -102;
                         mes1 = "00" + mes1; mes1 = mes1 % -102;
                         aAlfa = dia1 + "." + mes1 + "." + any1;
                         fFecExt = aAlfa;
                         dia2 = "00" + dia2; dia2 = dia2 % -102;
                         mes2 = "00" + mes2; mes2 = mes2 % -102;
                         fFechaHoy = ~;
                         aAlfa = fFechaHoy;
                         aAlfa = aAlfa % -104;
                         aAlfa = dia2 + "." + mes2 + "." + aAlfa;
                         fFecExtAlta = aAlfa;
                    |FINSI;
                    |SI swImpDatIT = 1; |Y aAccExt ! "X";
                         |SUB_EJECUTA "silcon17;NOMVARCA";
                    |FINSI;
               |SIGUE;
               |SI aTipExt = "A";
                    swImpDatAcc = 0;
                    aAlfa = "     Desea imprimir los datos del parte de Accidente?";
                    |CONFI aAlfa;
                    |SI FSalida = 0;
                         swImpDatAcc = 1;
                    |FINSI;
                    |SI swImpDatAcc = 1;
                         |SUB_EJECUTA "labparac;IMPRESION";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ActivaSN; |TIPO 7;
     |SI Campo ] 47; |Y Campo [ 50;
          nCampo = Campo;
          nCampoT = Campo - 35;         || tipo
          |SI #0nCampoT = "D";
               |CAMPO_MODIFICA #0nCampo, 1, "S";
               |PINTA #0nCampo;
          |SINO;
               |CAMPO_MODIFICA #0nCampo, 1, "N";
          |FINSI;
     |FINSI;
     |SI Campo = 46;
          aAlfa = #0#16;
          |QBF aAlfa;
          |SI aAlfa = ""; |O aAlfa = "..........";
               |CAMPO_MODIFICA #0#46, 1, "N";
               #0#46 = 0;
               |PINTA #0#46;
          |SINO;
               |CAMPO_MODIFICA #0#46, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MotivoBaja;
     aAlfa = #0#16;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          |ABRE #motibaja;
          #motibaja#0 = #0Campo;
          |LEE 000#motibaja.=;
          |SI FSalida ! 0;
               aAlfa = "    ATENCION. Es obligatorio informar una causa de baja. ";
               aAlfa = aAlfa + "Pulse F11 para consultar las opciones.";
               |AVISO;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
          |CIERRA #motibaja;
     |FINSI;
|FPRC;

|PROCESO ControlRec;
     || vengo de recaida, voy a buscarla:
     nMes = #0#2;
     |SI nMes ! 1;
          nMes = nMes - 1;
     |SINO;
          nMes = 12;
     |FINSI;

     fFechaHoy = ~;
     aAlfa = fFechaHoy;
     aAlfa = aAlfa % -104;
     anynum = aAlfa;
     |SI nMes = 12;
         anynum = anynum - 1;
     |FINSI;

     mesnum = nMes;
     |HAZ ulti_dia;
     aDia = topemes; aDia = ("00" + aDia) % -102;
     aMes = nMes; aMes = ("00" + aMes) % -102;
     aAny = anynum;
     aFecha = aDia + "." + aMes + "." + aAny;
     fFecha = aFecha;
     nFecha = fFecha;
     nFecha = nFecha - #labtraba#89 + 1;
     fFecha = nFecha;

     aFecha = fFecha;
     aDia = aFecha % 102;
     nDia = aDia;

     |ABRE #nomhicca;
     #nomhicca#0 = #nomvarca#0;
     #nomhicca#1 = #nomvarca#1;
     #nomhicca#66 = anynum - 2000;
     #nomhicca#2 = nMes;
     #nomhicca#3 = 0;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          |PARA nCampoT = 27; |SI nCampoT [ 30; |HACIENDO nCampoT = nCampoT + 1;
               |SI #nomhicca#nCampoT# = "E"; |O #nomhicca#nCampoT# = "A";
                    nCampoD = nCampoT - 8;
                    nCampoH = nCampoT - 4;
                    nCampoFR = nCampoT + 112;
                    nDiaD = nDia - 1;   || esto lo hago por tener algun margen
                    nDiaH = nDia + 1;   || al buscar el dia inicial por lo de
                                        || mens/diarios y demas
                    |PARA nDiaBusca = nDiaD; |SI nDiaBusca [ nDiaH;
                    |HACIENDO nDiaBusca = nDiaBusca + 1;
                         aAlfa = #nomhicca#nCampoFR#; |QBT aAlfa;
                         |SI aAlfa = ".."; aAlfa = ""; |FINSI;
                         |SI nDiaBusca = #nomhicca#nCampoD#; |Y aAlfa ! "";
                              #0nCampoRSN = "S";
                              #0nCampoR = #nomhicca#nCampoFR#;
                              |PINTA #0nCampoRSN;
                              |PINTA #0nCampoR;
                              |MENAV "     Localizada recaida segun periodo anterior";
                              |SAL;
                         |FINSI;
                    |SIGUE;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #nomhicca;
|FPRC;

|PROCESO HistoricoIT;
     nDiasAcum = 0;
     nCampo = Campo;
     aTipoBaja = #0Campo;
     |SI aTipoBaja = "E";
          nDiasAcum = #labtraba#89;
     |FINSI;
     |SI aTipoBaja = "A";
          nDiasAcum = #labtraba#92;
     |FINSI;
     |SI nDiasAcum ! 0;
          fech1 = ~;
          aAlfa = fech1;
          alfa1 = aAlfa % -104;    || a¤o del sistema
          alfa2 = #0#2; alfa2 = ("00" + alfa2) % -102;     || mes IT
          aFecha = "01." + alfa2 + "." + alfa1;
          fFecha = aFecha;
          nFecha = fFecha;
          nFecha = fFecha - nDiasAcum - 1;
          fFecha = nFecha;
          aAlfa = fFecha;
          alfa1 = aAlfa % 402;     || mes inicio IT
          alfa2 = aAlfa % -104;    || a¤o inicio IT
          nMes = alfa1;
          nAny = alfa2;

          |ABRE #nomhisit;
          #nomhisit#0 = #0#0;
          #nomhisit#1 = #0#1;
          #nomhisit#2 = nAny;
          #nomhisit#3 = nMes;
          |PARA nIT = 1; |SI nIT [ 4; |HACIENDO nIT = nIT + 1;
               #nomhisit#8 = nIT;
               |LEE 000#nomhisit.=;
               |SI FSalida = 0;
                    anynum = nAny;
                    mesnum = nMes;
                    |HAZ ulti_dia;
                    |SI #nomhisit#5 = topemes; |Y #nomhisit#6 = aTipoBaja;
                         aHosp = #nomhisit#71;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |CIERRA #nomhisit;
     |FINSI;
|FPRC;

|PROCESO DatosITIni;     || busca datos de la IT inicial
     aHosp = "N";
     swSigue = 0;
     nCampo = Campo;
     nCampoD = nCampo - 8;
     nCampoH = nCampo - 4;
     nCampoR = nCampo + 27;
     nCampoRSN = nCampo + 23;
     nCampoHosp = nCampo + 19;
     |SI #0nCampo = "E"; |Y #0nCampoD = 0; |Y #labtraba#89 ! 0;
          swSigue = 1;
     |FINSI;
     |SI #0nCampo = "A"; |Y #0nCampoD = 0; |Y #labtraba#92 ! 0;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 1;
          |SI #labtraba#123 = "S";
               |HAZ ControlRec;
          |FINSI;
          |HAZ HistoricoIT;
     |FINSI;
     /*
     #0nCampoHosp = aHosp;
     |PINTA #0nCampoHosp;
     */
|FPRC;

|PROCESO Preguntitas; |TIPO 7;
     |SI swPreguntitas = 0;
          |HAZ promedio;
          |HAZ ControlMat;
          |HAZ ControlPat;
          |HAZ enlaces;
          |HAZ carencia;
          |HAZ AvisoRec;
     |FINSI;

     || para que si se ha creado el 902 automaticamente, al pasar a las
     || lineas no empiece en la "linea 100" que salia en modo alta
     |SI nModoCab = 1; |Y sw902 = 1;
          #nomvarli#4 = 999;
     |FINSI;
     sw902 = 0;
|FPRC;

|PROCESO Puntos; |TIPO 7;
     sw902 = 0;     || lo inicio, por ejemplo aqui
     |PARA nume1 = 39; |SI nume1 [ 42; |HACIENDO nume1 = nume1 + 1;
          |SI #0nume1 = "  .  .    "; |O #0nume1 = "01.01.0000";
               #0nume1 = "          ";
               |PINTA #0nume1;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO EnAlta;
     |SI FSalida = 18;
          |SI Campo = 0;
               enEmpresa = 0;
          |SINO;
               enEmpresa = #0#0;
          |FINSI;
          enTrabajador = #0#1;
          |HAZ EnAlta_plb;
          |SI enTrabajador ! 0;
               #0#0 = enEmpresa;
               #0#1 = enTrabajador;
               |PINTA #0#0;
               |PINTA #0#1;

               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 000#labtraba.=;
               |ATRI I;
               |PINTA 0638, #labtraba#2;
               |ATRI 0;
               |CIERRA #labtraba;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CeroNo;
     nCampo = Campo - 4;
     |SI #0Campo = "D"; |Y FSalida ! 2;
          |SI #0nCampo = 0;
               aAlfa = "    Es necesario indicar el día que acaba la situación ";
               aAlfa = aAlfa + "de ERE. No se permite el valor 0 en 'hasta día'";
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #0Campo = "S"; |Y FSalida ! 2;
          |SI #0nCampo = 0;
               aAlfa = "    Es necesario indicar el día que acaba el Alta Sin ";
               aAlfa = aAlfa + "Retribución. No se permite el valor 0 en 'hasta día'";
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nomvarcb;
     swSigue = 1;
|FPRC;

|DEFBUCLE nomvarcb;
     #nomvarcb#1;
     ;
     #nomvarca#0, #nomvarca#1, #nomvarca#2, #nomvarca#3, 0000, 00;
     #nomvarca#0, #nomvarca#1, #nomvarca#2, #nomvarca#3, nAnyXX, 31;
     ;
     NULL, nomvarcb;
|FIN;

|PROCESO inferior;
     #nomvarcb#0 = #nomvarca#0;
     #nomvarcb#1 = #nomvarca#1;
     #nomvarcb#2 = #nomvarca#2;
     #nomvarcb#3 = #nomvarca#3;
     #nomvarcb#4 = 0000;      || el a¤o, en principio 0000
     #nomvarcb#5 = 00;
|FPRC;

|PROCESO superior;
     #nomvarcb#0 = #nomvarca#0;
     #nomvarcb#1 = #nomvarca#1;
     #nomvarcb#2 = #nomvarca#2;
     #nomvarcb#3 = #nomvarca#3;
     #nomvarcb#4 = nAnyXX;
     #nomvarcb#5 = 31;
|FPRC;

|PROCESO EREMasDe4;
     swSigue = 0;
     |SI FSalida = 18;
          swSigue = 1;
     |FINSI;

     fFecha = ~;
     aFecha = fFecha;
     aAny = aFecha % -104;
     nAnyXX = aAny;

     |SI swSigue = 0; |Y Campo = 50;
          |BUCLE nomvarcb;
     |FINSI;
     |SI swSigue = 1;
          |PUSHV 14012341;
          |ENTLINEAL #1#nomvarcb, 6, 2, 22, 1, inferior, superior;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO OrdenaIT2;
     |PARA nume11 = nume1 + 1; |SI nume11 [ 7; |HACIENDO nume11 = nume11 + 1;
          nume12 = nume11 + 4;
          nume13 = nume11 + 8;
          nume14 = nume11 + 27;
          nume15 = nume11 + 31;
          nume16 = nume11 + 35;
          nume17 = nume11 + 43;

          |SI #0nume1 = 0; |Y #0nume2 = 0; |Y #0nume3 = " ";
               #0nume1 = 99;
          |FINSI;

          nDesde1 = #0nume1;
          nHasta1 = #0nume2;
          aTipo1 = #0nume3;
          aHospi1 = #0nume4;
          aReca1 = #0nume5;
          aFechaReca1 = #0nume6;
          nPorcIT1 = #0nume7;

          |SI #0nume11 = 0; |Y #0nume12 = 0; |Y #0nume13 = " ";
               #0nume11 = 99;
          |FINSI;

          nDesde2 = #0nume11;
          nHasta2 = #0nume12;
          aTipo2 = #0nume13;
          aHospi2 = #0nume14;
          aReca2 = #0nume15;
          aFechaReca2 = #0nume16;
          nPorcIT2 = #0nume17;

         |SI nDesde1 > nDesde2;
               #0nume1 = nDesde2;
               #0nume2 = nHasta2;
               #0nume3 = aTipo2;
               #0nume4 = aHospi2;
               #0nume5 = aReca2;
               #0nume6 = aFechaReca2;
               #0nume7 = nPorcIT2;

               #0nume11 = nDesde1;
               #0nume12 = nHasta1;
               #0nume13 = aTipo1;
               #0nume14 = aHospi1;
               #0nume15 = aReca1;
               #0nume16 = aFechaReca1;
               #0nume17 = nPorcIT1;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO OrdenaIT; |TIPO 7;
     |PARA nume1 = 4; |SI nume1 [ 7; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 + 4;
          nume3 = nume1 + 8;
          nume4 = nume1 + 27;
          nume5 = nume1 + 31;
          nume6 = nume1 + 35;
          nume7 = nume1 + 43;
          |HAZ OrdenaIT2;
     |SIGUE;
     |PARA nume1 = 4; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
          |SI #0nume1 = 99;
               #0nume1 = 0;
          |FINSI;
          |PINTA #0nume1;
     |SIGUE;
     |PARA nume1 = 31; |SI nume1 [ 42; |HACIENDO nume1 = nume1 + 1;
          |PINTA #0nume1;
     |SIGUE;
     |PARA nume1 = 47; |SI nume1 [ 50; |HACIENDO nume1 = nume1 + 1;
          |PINTA #0nume1;
     |SIGUE;
|FPRC;

|PROCESO OtraBase;
     swSigue = 0;
     |SI #0#4 = 0;
          swSigue = 1;
     |FINSI;
     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
          || maternidad a tiempo parcial, las bases pueden ser distintas
          |SI #0#12 = "E"; |Y #0#13 = "M"; swSigue = 1; |FINSI;
          |SI #0#13 = "E"; |Y #0#14 = "M"; swSigue = 1; |FINSI;
          |SI #0#14 = "E"; |Y #0#15 = "M"; swSigue = 1; |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |SI #0Campo = "E"; |O #0Campo = "A";
          |O #0Campo = "M"; |O #0Campo = "P"; |O #0Campo = "R";
               |SI #0#12 = "E"; |O #0#12 = "A";
               |O #0#12 = "M"; |O #0#12 = "P"; |O #0#12 = "R";
                    |SI Campo = 13; aAlfa1 = "la 2da."; |FINSI;
                    |SI Campo = 14; aAlfa1 = "la 3ra."; |FINSI;
                    |SI Campo = 15; aAlfa1 = "la 4ta."; |FINSI;
                    aAlfa = "    ATENCION. Compruebe que la base reguladora ";
                    aAlfa = aAlfa + " de " + aAlfa1 + " contingencia es igual a la de la 1ra. IT ";
                    aAlfa = aAlfa + "introducida.";
                    |MENAV aAlfa;
                    aAlfa = "    Si la base diaria es distinta es necesario introducirla ";
                    aAlfa = aAlfa + " mediante el concepto 927";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AvisoERE;
     |SI #0Campo = "D";
          |ABRE 000#labtraba;
          |LEE 000#labtraba.=;
          |CIERRA 000#labtraba;
          |SI #labtraba#242 = 0;
               aAlfa = "    ATENCION: no está informado el promedio diario de ";
               aAlfa = aAlfa + "Desempleo en la ficha del trabajador.";
               |MENAV aAlfa;
               aAlfa = "    Es obligatorio informarlo en la cuarta pantalla ";
               aAlfa = aAlfa + "de su ficha para cotizar en situación de ERE";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AvisoAcc;
     |SI Campo = 16;
          |ACABA;
     |FINSI;
     |SI Campo = 4; |O Campo = 8; |O Campo = 12; |O Campo = 31; |O Campo = 39;
          nCampoD = 4; nCampoT = 12;
     |FINSI;
     |SI Campo = 5; |O Campo = 9; |O Campo = 13; |O Campo = 32; |O Campo = 40;
          nCampoD = 5; nCampoT = 13;
     |FINSI;
     |SI Campo = 6; |O Campo = 10;|O Campo = 14; |O Campo = 33; |O Campo = 41;
          nCampoD = 6; nCampoT = 14;
     |FINSI;
     |SI Campo = 7; |O Campo = 11;|O Campo = 15; |O Campo = 34; |O Campo = 42;
          nCampoD = 7; nCampoT = 15;
     |FINSI;
     |SI #0nCampoD ! 0; |Y #0nCampoT = "A";
          |PUSHV 08421580;
          |CUADRO 08421580;
          |ATRI 0;
          ||            4       5         6         7        8
          ||            34567890123456789012345678901234567890
          |PINTA 0943, "ATENCION. La prestación por accidente";
          |PINTA 1043, "se abonará desde el día indicado (día";
          || PINTA 1142," XX inclusive).                       ";
          |PINTA 1243, "Por tanto recuerde que el 'día desde'";
          |PINTA 1343, "siempre ha de ser el día siguiente al";
          |PINTA 1443, "de la fecha de baja por accidente.   ";
          aAlfa = #0nCampoD; |QBF aAlfa;
          |ATRI R;
          |PINTA 0943, "ATENCION:";
          |ATRI S;
          |PINTA 1076, "(día";
          aAlfa = aAlfa + " inclusive)                         ";
          |PINTA 1143, aAlfa;
          |PINTA 1343, "siempre ha de ser el día siguiente ";
          |ATRI 0;
          swAvisoAcc = 1;
     |FINSI;
|FPRC;

|PROCESO AvisoAccAntes; |TIPO 7;
     |SI swAvisoAcc = 1;
          |POPV;
     |FINSI;


     |HAZ AvisoAcc;
|FPRC;

|PROCESO Activa51; |TIPO 7;
     swSigue = 0;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI #nomcontr#62 = "S";
          |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
               |SI #nomvarca#nume1# = "C";
                    swSigue = 1;
                    |SI #labtraba#60 = "C";
                         #nomvarca#51 = #labtraba#133;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |SINO;
          swSigue = 0;
     |FINSI;
     |SI swSigue = 1;
          |CAMPO_MODIFICA #0#51, 1, "S";
          |CAMPO_VISUAL #0#51, 1, "S";
          |ATRI 0;
          |PINTA 1401, "³Origen Ctrl.IT:    ³";
          |ATRI I;
          |CAMPO_POSICION #0#51, 1, 1418;
          |PINTA #0#51;
          |ATRI I;
     |SINO;
          |CAMPO_MODIFICA #0#51, 1, "N";
          |CAMPO_VISUAL #0#51, 1, "N";
          |ATRI 0;
          |PINTA 1401, "³                   ³";
     |FINSI;
|FPRC;

|PROCESO Valida51; |TIPO 0;
     swSigue = 0;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI #nomcontr#62 = "S";
          |PARA nume1 = 12; |SI nume1 [ 15; |HACIENDO nume1 = nume1 + 1;
               |SI #0nume1 = "C";
                    swSigue = 1;
               |FINSI;
          |SIGUE;
     |FINSI;
     aAlfa = #0#51;
     |QBF aAlfa;
     |SI swSigue = 1; |Y aAlfa = "";
          aAlfa = "    ATENCION. Es necesario indicar el tipo de IT inicial ";
          aAlfa = aAlfa + "para calcular el complemento en Control de IT";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO ModoCab; |TIPO 7;
     nModoCab = (FEntrada / 100) ! 0;
     sw999 = 0;
|FPRC;

|PROCESO Linea999; |TIPO 7;
     || creacion automatica de la linea 999 en variaciones al dar de alta
     || solo en la primera linea del alta y condicionado al parametro

     |SI nModoCab = 1; |Y sw999 = 0; |Y #nomcontr#74 = "S";
          #nomvarli#0 = #nomvarca#0;
          #nomvarli#1 = #nomvarca#1;
          #nomvarli#2 = #nomvarca#2;
          #nomvarli#3 = #nomvarca#3;
          #nomvarli#4 = 999;
          |LEE 101#nomvarli.=;
          |SI FSalida ! 0;
               |GRABA 020#nomvarli.n;
          |FINSI;
          |LIBERA #nomvarli;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
          sw999 = 1;
     |FINSI;
|FPRC;

|PROCESO nomconli_900;
     |DDEFECTO #nom900dt;
     #nom900dt#0 = #nomconli#2 - 920;
     #nom900dt#1 = #nomconli#2;

     #nomdesam#0 = #nomconli#0;
     #nomdesam#1 = #nomconli#2;
     |LEE 000#nomdesam.=;
     |SI FSalida = 0;
          #nom900dt#2 = #nomdesam#2;
     |FINSI;

     #nom900dt#3 = #nomconli#6;

     |GRABA 020#nom900dt.n;
|FPRC;

|DEFBUCLE nomconli_900;
     #nomconli#1;
     ;
     nConvenio, 951;
     nConvenio, 960;
     ;
     NULL, nomconli_900;
|FIN;

|PROCESO nom900de;
     #nom900dt#0 = #nom900de#0;
     #nom900dt#1 = #nom900de#1;
     #nom900dt#2 = #nom900de#2;
     #nom900dt#3 = #nom900de#3;
     |GRABA 020#nom900dt.n;
|FPRC;

|DEFBUCLE nom900de;
     #nom900de#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nom900de;
|FIN;

|PROCESO Carga900;
     aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_nom900dt_" + aAlfa;
     |NOME_DAT #nom900dt#aAlfa#;
     |DELINDEX #nom900dt;
     |ABRE #nom900dt;
     |ABRE #nomdesam;

     nConvenio = #labtraba#87;
     |BUCLE nom900de;
     |BUCLE nomconli_900;

     |CIERRA #nomdesam;
     |CIERRA #nom900dt;
|FPRC;

|PROCESO TipoIT;
     |SI aTipo = "E"; aTipo = "Enfermedad"; |FINSI;
     |SI aTipo = "A"; aTipo = "Accidente "; |FINSI;
     |SI aTipo = "C"; aTipo = "Control IT"; |FINSI;
     |SI aTipo = "M"; aTipo = "Maternidad"; |FINSI;
     |SI aTipo = "P"; aTipo = "Paternidad"; |FINSI;
     |SI aTipo = "R"; aTipo = "Riesgo Emb"; |FINSI;
|FPRC;

|PROCESO Estado_1;
     aTipo = "";
     aFecha = "";

     aAlfa = #nomvarca#16;
     |QBF aAlfa;
     |SI aAlfa ! "";
          |SI #labtraba#89 ! 0; |O #labtraba#92 ! 0;
               |SI #labtraba#89 ! 0;
                    aTipoLetra = #labtraba#60;
                    aTipo = #labtraba#60;
                    |HAZ TipoIT;
                    aFecha = #labtraba#125;
               |FINSI;
               |SI #labtraba#92 ! 0;
                    aTipo = "Accidente";
                    aTipoLetra = "A";
                    aFecha = #labtraba#125;
               |FINSI;

               || tenemos una IT del mes anterior, a ver si antes de la fecha
               || de baja, la IT se termina

               swSigue = 1;
               aAlfa = #nomvarca#16; aAlfa = aAlfa % 102; nDia = aAlfa;
               aAlfa = #nomvarca#16; aAlfa = aAlfa % 402; nMes = aAlfa;
               aMes = aAlfa;
               aAlfa = #nomvarca#16; aAlfa = aAlfa % -104; nAny = aAlfa;
               |PARA nCampo = 12; |SI nCampo [ 15; |HACIENDO nCampo = nCampo + 1;
                    nCampoD = nCampo - 8;
                    nCampoH = nCampo - 4;
                    |SI #nomvarca#nCampo# ! " "; |Y #nomvarca#nCampoD# = 0;
                         nDesde = #nomvarca#nCampoD#;
                         |SI nDesde = 0;
                              nDesde = 1;
                         |FINSI;
                         nHasta = #nomvarca#nCampoH#;
                         |SI nHasta = 0;
                              mesnum = nMes;
                              anynum = nAny;
                              |HAZ ulti_dia;
                              nHasta = topemes;
                         |FINSI;
                         |SI nDia > nHasta;
                              swSigue = 0;
                         |FINSI;
                    |FINSI;
               |SIGUE;
               |SI swSigue = 1;
                    aAlfa = "    ATENCION. Fecha de baja del trabajador durante un proceso de IT. ";
                    aAlfa = aAlfa + aTipo + " desde el " + aFecha;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Estado_2;
     aAlfa = #nomvarca#16;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = #nomvarca#16; aAlfa = aAlfa % 102; nDia = aAlfa;
          aAlfa = #nomvarca#16; aAlfa = aAlfa % 402; nMes = aAlfa;
          aMes = aAlfa;
          aAlfa = #nomvarca#16; aAlfa = aAlfa % -104; nAny = aAlfa;
          |PARA nCampo = 12; |SI nCampo [ 15; |HACIENDO nCampo = nCampo + 1;
               |SI #nomvarca#nCampo# ! " ";
                    nCampoD = nCampo - 8;
                    nCampoH = nCampo - 4;
                    nDesde = #nomvarca#nCampoD#;
                    |SI nDesde = 0;
                         nDesde = 1;
                    |FINSI;
                    nHasta = #nomvarca#nCampoH#;
                    |SI nHasta = 0;
                         mesnum = nMes;
                         anynum = nAny;
                         |HAZ ulti_dia;
                         nHasta = topemes;
                    |FINSI;
                    |SI nDesde [ nDia; |Y nDia [ nHasta;
                         aTipo = #nomvarca#nCampo#;
                         |HAZ TipoIT;
                         aAlfa = "    ATENCION. Fecha de baja del trabajador durante ";
                         aAlfa = aAlfa + "el proceso de IT introducido";
                         |MENAV aAlfa;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Estado;
     |SI #nomvarca#46 ] 08; |Y #nomvarca#46 [ 12;
          || nada
     |SINO;
          |HAZ Estado_1;
          |HAZ Estado_2;
     |FINSI;
|FPRC;


|PROCESO DiasNatAlta;
     nDiasNatAlta = 0;

     alfa1 = "01";
     alfa2 = #nomhicca#2; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     nume3 = #nomhicca#66 + 2000;
     alfa3 = nume3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech1 = alfa4;      || PRIMER DIA DEL MES

     nMes = #nomhicca#2;
     nAny = #nomhicca#66 + 2000;
     |HAZ topemes_plb;

     alfa1 = nTopemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
     alfa2 = #nomhicca#2; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     nume3 = #nomhicca#66 + 2000;
     alfa3 = nume3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech2 = alfa4;      || ULTIMO DIA DEL MES

     alfa1 = #nomhicca#4;
     fech3 = alfa1;      || DIA ALTA TRABAJADOR

     alfa1 = #nomhicca#5;
     |QBF alfa1;
     |SI alfa1 ! ""; |Y alfa1 ! "..........";
          fech4 = alfa1;      || DIA BAJA TRABAJADOR
     |SINO;
          fech4 = fech2;
     |FINSI;

     |SI fech3 ] fech1;
          fech5 = fech3;
     |SINO;
          fech5 = fech1;
     |FINSI;

     |SI fech4 [ fech2;
          fech6 = fech4;
     |SINO;
          fech6 = fech2;
     |FINSI;

     nume1 = fech5;
     nume2 = fech6;

     nDiasNatAlta = nume2 - nume1 + 1;
|FPRC;

|PROCESO labtraba;
     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = nAnyXX;     || a¤o
     #nomhicca#2 = nMes;     || mes
     #nomhicca#3 = 0;         || tipo
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          nBaseCotCC = nBaseCotCC + #nomhicca#39;
          nBaseCotCP = nBaseCotCP + #nomhicca#40;
          nNume = #nomhicca#159 + #nomhicca#170 + #nomhicca#172;
          nNume = nNume + #nomhicca#174 + #nomhicca#239;
          nBaseCotCC = nBaseCotCC + nNume;
          nBaseCotCP = nBaseCotCP + nNume;
          |SI #labtraba#42 = "X";
               |HAZ DiasNatAlta;
               nDiasCot = nDiasCot + nDiasNatAlta;
          |SINO;
               nDiasCot = nDiasCot + #nomhicca#8;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#5;
     ;
     #0#0, aNif;
     #0#0, aNif;
     ;
     NULL, labtraba;
|FIN;

|PROCESO BaseReg;
     aNif = #labtraba#7;
     fFecha = ~;
     aFecha = fFecha;

     aAny = aFecha % -102;
     nAnyXX = aAny;

     aMes = aFecha % 402;
     nMesActual = aMes;
     nMes = #0#2;
     |SI nMes = 11; |O nMes = 12;
          |SI nMesActual = 01; |O nMesActual = 02;
               nAnyXX = nAnyXX - 1;
          |FINSI;
     |FINSI;
     nBuscaMeses = 12;

     |SALVA_FICHA #labtraba;

     nBaseCotCC = 0;
     nBaseCotCP = 0;
     nDiasCot = 0;
     |ABRE #nomhicca;
     |PARA i = 1; |SI i [ nBuscaMeses; |HACIENDO i = i + 1;
          nMes = nMes - 1;
          |SI nMes = 0;
               nMes = 12;
               nAnyXX = nAnyXX - 1;
          |FINSI;

          |BUCLE labtraba;
     |SIGUE;
     |CIERRA #nomhicca;

     |REPON_FICHA #labtraba;

     aAlfa = "    Se calculará el promedio según la base reguladora de los ";
     aAlfa = aAlfa + "12 meses anteriores al inicio de la maternidad.";
     |MENAV aAlfa;

     nBase = nBaseCotCC / nDiasCot;
     #0#17 = nBase;
     nBase = nBaseCotCP / nDiasCot;
     #0#18 = nBase;
     |PINTA #0#17;
     |PINTA #0#18;

|FPRC;

|PROCESO BaseMatTP;
     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
          nCampo = Campo - 8;
          |SI #0Campo = "M"; |Y #0nCampo ! 0;
               |HAZ BaseReg;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AnyNomvarcb;
     fFecha = ~;
     aAlfa = fFecha;
     aAlfa = aAlfa % -104;
     nNume = aAlfa;
     #nomvarcb#4 = nNume;
|FPRC;
