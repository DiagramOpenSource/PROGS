|FICHEROS;
     aocargao #0;
     aomcoste #1;
     aontraem #2;
     labtraba #3;
     aocarga1 #10; ||Tmp Impresion Errores
     aomparam #100;
     gotrabaj@;
     gocatcon@;
     gotrabal@;
     gomantho@;
|FIN;

|VARIABLES;
     &enError = 0;

     aD = "";
     aH = "";
     nConta = 0;
     nHay = 0;
     nErr = 0;
     aAlfa = "";
     aPath = "";
     aFic = "";
     aDef = "";
     aEmp = "";

     nCate = 0;
     nTraba = 0;
     nTraAnt = 0;
     nEmpAnt = 0;
     aSer = "";
|FIN;

|PROCESO GrabaTraba;
     #gotrabaj@#1 = #3#2;
     #gotrabaj@#3 = #3#17;
     #gotrabaj@#25 = #3#18;
     #gotrabaj@#2 = #3#87;
     #gotrabaj@#4 = #3#3;
     #gotrabaj@#5 = #3#4;
     #gotrabaj@#6 = #3#5;
     #gotrabaj@#7 = #3#6;
     #gotrabaj@#8 = #3#8;
     #gotrabaj@#9 = #3#9;
     #gotrabaj@#10 = #3#76;
     #gotrabaj@#11 = #3#11;
     #gotrabaj@#12 = #3#7;
     #gotrabaj@#13 = #3#75;
     #gotrabaj@#14 = #3#19;
     #gotrabaj@#15 = #3#238;
     #gotrabaj@#16 = #3#244;
     #gotrabaj@#28 = "S";

     #gotrabal@#0 = #gotrabaj@#0;
     #gotrabal@#1 = 1;
     |LEE 101#gotrabal@.=;
     |SI FSalida ! 0;
          |GRABA 020#gotrabal@.b=;
          #gotrabal@#2 = #3#36;
          #gotrabal@#3 = #3#37;
          |GRABA 020#gotrabal@.a;
     |SINO;
          |SI #0#12 = "S";
               #gotrabal@#2 = #3#36;
               #gotrabal@#3 = #3#37;
               |GRABA 020#gotrabal@.a;
          |FINSI;
     |FINSI;
     |LIBERA #gotrabal@;

     |GRABA 020#gotrabaj@.a;
|FPRC;

|PROCESO aomcoste1;
     #10#0 = #1#0;
     #10#1 = #1#1;
     #10#2 = #1#2;
     #10#3 = #1#14;
     #10#4 = #1#3;
     #10#5 = #1#4;

     aSer = ("00000" + #1#2) % -105;
     #gomantho@#0 = aSer;
     #gomantho@#1 = #1#14;
     |LEE 000#gomantho@.=;
     |SI FSalida ! 0;
          #gomantho@#1 = 1;
          |LEE 000#gomantho@.];
          |SI FSalida = 0; |Y #gomantho@#0 = aSer
               #10#6 = "CODIGO SUBOBRA ERRONEO, ADJUDICADO A SU OBRA";
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               nHay = 1;
          |SINO;
               #10#6 = "ERROR NO EXISTE EXPEDIENTE";
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               nHay = 1;
               enError = 1;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #gomantho@#9 ! "C";
          #10#6 = "ERROR LA OBRA NO ESTA EN CURSO";
          nConta = nConta + 1;
          #10#7 = nConta;
          |GRABA 020#10n;
          nHay = 1;
          ||enError = 1;      de momento lo dejamos continuar
          |||ACABA;           solo avisa.......!!!!
     |FINSI;

     |SI nEmpAnt = #1#3; |Y nTraAnt = #1#4;
          |ACABA;
     |FINSI;
     nEmpAnt = #1#3;
     nTraAnt = #1#4;

     |DDEFECTO #3;
     #3#0 = #1#3; ||Emp
     #3#1 = #1#4; ||Tra
     |LEE 020#3=;

     nCate = #3#17;
     nTraba = #1#4 + #2#2;

     |DDEFECTO #gotrabaj@;
     #gotrabaj@#0 = nTraba;
     |LEE 101#gotrabaj@.=;


     |SI FSalida = 0;
          |SI #0#12 = "S";
               |HAZ GrabaTraba;
               |SI FSalida = 0;
                    #10#6 = "ACTUALIZADO TRABAJADOR";
               |SINO;
                    #10#6 = "ERROR AL ACTUALIZAR TRABAJADOR";
                    enError = 1;
               |FINSI;
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               nHay = 1;
          |SINO;
               |SI #gotrabaj@#3 ! nCate;
                    #10#6 = "ERROR CATEGORIA INCORRECTA";
                    nConta = nConta + 1;
                    #10#7 = nConta;
                    |GRABA 020#10n;
                    enError = 1;
                    nHay = 1;
               |FINSI;
               |SI #gotrabaj@#2 ! #3#87;
                    #10#6 = "ERROR CONVENIO INCORRECTO";
                    nConta = nConta + 1;
                    #10#7 = nConta;
                    |GRABA 020#10n;
                    enError = 1;
                    nHay = 1;
               |FINSI;
          |FINSI;
     |SINO;
          |SI #0#12 = "S";
               |GRABA 020#gotrabaj@.b;
               |HAZ GrabaTraba;
               |SI FSalida = 0;
                    #10#6 = "CREADO TRABAJADOR";
               |SINO;
                    #10#6 = "ERROR AL CREAR TRABAJADOR";
                    enError = 1;
               |FINSI;
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               nHay = 1;
          |SINO;
               #10#6 = "NO EXISTE TRABAJADOR";
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               enError = 1;
               nHay = 1;
          |FINSI;
     |FINSI;
     |LIBERA #gotrabaj@;

     |DDEFECTO #gocatcon@;
     #gocatcon@#0 = nCate;
     #gocatcon@#1 = #gotrabaj@#2;
     |LEE 000#gocatcon@.=;
     |SI FSalida ! 0;
          #10#6 = "NO EXISTE CATEGORIA";
          nConta = nConta + 1;
          #10#7 = nConta;
          |GRABA 020#10n;
          enError = 1;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE aomcoste1;
     #1#1;
     19;
     #0#10, #0#2, #0#0, #0#1, "     ", 000001, aD, aD, #2#0, #0#4, "N";
     #0#11, #0#7, #0#5, #0#6, "zzzzz", 999999, aH, aH, #2#0, #0#9, "N";
     ;
     NULL, NULL, NULL, NULL, NULL, aomcoste1;
     #1#3, #1#4;
|FIN;

|PROCESO aontraem1;
     aD = " " * 20;
     aH = "z" * 20;
     |BUCLE aomcoste1;
|FPRC;

|DEFBUCLE aontraem1;
     #2#1;
     ;
     #0#3;
     #0#8;
     ;
     NULL, aontraem1;
|FIN;

|PROCESO ExisteEmpresa1;
     nErr = 1;
     |DBASS aAlfa;
     aPath = #100#1; |QBF aPath;
     aPath = aAlfa + aPath;
     aFic = aPath + "/fich/";
     aDef = aPath + "/def/agifa041";
     |CARGA_DEF aDef, gocatcon@;
     |SI FSalida = 0;
          aEmp = ("00000" + #100#2) % -105;
          |PATH_DAT #gocatcon@#aFic#;
          |ABRE #gocatcon@;
          #gocatcon@#0 = aEmp;
          |LEE 000#gocatcon@.=;
          nErr = FSalida;
          |CIERRA #gocatcon@;
          |DESCARGA_DEF #gocatcon@;
     |FINSI;
     FSalida = nErr;
|FPRC;

|PROCESO Tmp;
     |DDEFECTO #3;
     #3#0 = #10#4; ||Emp
     #3#1 = #10#5; ||Tra
     |LEE 020#3=;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Trabajador;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |HAZ ExisteEmpresa1;
     |SI FSalida ! 0;
          |MENAV "0000ERROR en configuracion empresa gestion...";
          enError = 1;
          |ACABA;
     |FINSI;
     aAlfa = Usuario;
     |NOME_DAT #10 aAlfa;
     |DELINDEX #10;

     aDef = aPath + "/def/gotrabaj";
     |CARGA_DEF aDef, gotrabaj@;
     aDef = aPath + "/def/gocatcon";
     |CARGA_DEF aDef, gocatcon@;
     aDef = aPath + "/def/gotrabal";
     |CARGA_DEF aDef, gotrabal@;
     aDef = aPath + "/def/gomantho";
     |CARGA_DEF aDef, gomantho@;

     aFic = aPath + "/fich/" + aEmp + "/";
     |PATH_DAT #gotrabaj@#aFic#;
     |PATH_DAT #gocatcon@#aFic#;
     |PATH_DAT #gotrabal@#aFic#;
     |PATH_DAT #gomantho@#aFic#;

     |ABRE #gotrabaj@;
     |ABRE #gocatcon@;
     |ABRE #gotrabal@;
     |ABRE #gomantho@;
     |ABRE #3;
     |ABRE #10;
     |BUCLE aontraem1;
     |CIERRA #10;
     |CIERRA #3;
     |CIERRA #gomantho@;
     |CIERRA #gotrabal@;
     |CIERRA #gocatcon@;
     |CIERRA #gotrabaj@;

     |DESCARGA_DEF #gomantho@;
     |DESCARGA_DEF #gotrabal@;
     |DESCARGA_DEF #gocatcon@;
     |DESCARGA_DEF #gotrabaj@;

     |SI nHay ! 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "aocargao";
               |SI FSalida = 0;
                    |ABRE #3;
                    |BUCLE Tmp;
                    |CIERRA #3;
                    |PIEINF;
                    |FININF;
               |SINO;
                    |MENAV "0000No existe informe 'aocargao'";
               |FINSI;
               |FINIMP;
          |FINSI;
     |FINSI;
     |DELINDEX #10;
|FPRC;
