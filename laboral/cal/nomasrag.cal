|FICHEROS;
   nomasrag #0;

   nomtmp04 #10,MANTE;
   labtraba #100;
|FIN;

|VARIABLES;
   aAlfa  = "";
   aAlfa1 = "";
   nCambiados = 0;
   aMarca = "";
   nCalc  = 0;
   nOpcion = 0;
   nNumTrab = 0;

{-1}Menu  = "";
    Menu1 = "2400";
    Menu2 = "1";
    Menu3 = "";
    Menu4 = "RAC";
    Menu5 = " Revisar ";
    Menu6 = " Actualizar ";
    Menu7 = " Cancelar ";
|FIN;

|PROCESO Marcalo; |TIPO 0;
   |SI #nomtmp04#5 = "S";
      #nomtmp04#5 = "N";
    |SINO;
      #nomtmp04#5 = "S";
   |FINSI;

   |PINTA #nomtmp04#5; |GRABA 020#nomtmp04.a;
   |ERROR;
|FPRC;

|PROCESO MarcaDesmarca;
   #nomtmp04#5 = aMarca; |GRABA 020#nomtmp04.a;
|FPRC;

|DEFBUCLE MarcaDesmarca;
#nomtmp04#1;
;
INICIO;
FINAL;
;
NULL, MarcaDesmarca;
|FIN;

|PROCESO MiraMarca; |TIPO 11;
   |SI FSalida = 12; || Desmarca todo
      |SALVA_FICHA #nomtmp04;
      aMarca = "N"; |BUCLE MarcaDesmarca;
      |REPON_FICHA #nomtmp04;
      |PTEC 808; |PONCONTROL 23, "si";
   |FINSI;

   |SI FSalida = 13; || Marca todo
      |SALVA_FICHA #nomtmp04;
      aMarca = "S"; |BUCLE MarcaDesmarca;
      |REPON_FICHA #nomtmp04;
      |PTEC 808; |PONCONTROL 23, "si";
   |FINSI;
|FPRC;

|RUTINA inf04;
   #nomtmp04#0 = 00000;
   #nomtmp04#1 = 00000;
|FRUT;

|RUTINA sup04;
   #nomtmp04#0 = 99999;
   #nomtmp04#1 = 99999;
|FRUT;

|PROCESO Trabajadores;
   nNumTrab = nNumTrab + 1;

   |DDEFECTO #nomtmp04;
   #nomtmp04#0 = #labtraba#0;
   #nomtmp04#1 = #labtraba#1;
   #nomtmp04#2 = #labtraba#2;
   #nomtmp04#3 = #labtraba#45;
   #nomtmp04#4 = #labtraba#42;
   #nomtmp04#5 = #labtraba#187;
   |GRABA 020#nomtmp04.n;
|FPRC;

|DEFBUCLE Trabajadores;
#labtraba#1;
44,247,42;
#nomasrag#0, #nomasrag#2, "A", 613, "E";
#nomasrag#1, #nomasrag#3, "A", 613, "E";
;
NULL, Trabajadores;
|FIN;

|PROCESO Actualiza;
     #labtraba#0 = #nomtmp04#0;
     #labtraba#1 = #nomtmp04#1;
     |LEE 101#labtraba.=;
     |SI FSalida = 0;
          |SI #labtraba#187 ! #nomtmp04#5;
               #labtraba#187 = #nomtmp04#5;
               |GRABA 020#labtraba.a;
               nCambiados = nCambiados + 1;
          |FINSI;
          |LIBERA #labtraba;
     |FINSI;
|FPRC;

|DEFBUCLE Actualiza;
     #nomtmp04#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Actualiza;
|FIN;

|PROCESO Actualizar;
     |ABRE #labtraba;
     |BUCLE Actualiza;
     |CIERRA #labtraba;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA " ";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      aAlfa = "04" + Usuario; |NOME_DAT #nomtmp04#aAlfa#;
      |DELINDEX #nomtmp04; |ABRE #nomtmp04;
      nNumTrab = 0; |BUCLE Trabajadores;

|ET OtraVez;
      |ENTLINEAL #1#nomtmp04, -2, 4, 21, 1, inf04, sup04;
      |SI nNumTrab = 0;
         |CIERRA #nomtmp04;   |DELINDEX #nomtmp04;
         |ACABA;
      |FINSI;

|ET OtroMenu;
      |MENU Menu;
      nOpcion = FSalida;
      |SI nOpcion = 1; |VETE OtraVez;   |FINSI;
      |SI nOpcion = 2;
          nCambiados = 0;
          |HAZ Actualizar;
          |SI nCambiados > 0;
               aAlfa1 = nCambiados;
               aAlfa = "    Se ha cambiado el campo para la reducción por jornadas ";
               aAlfa = aAlfa + "en " + aAlfa1 + " trabajadores.";
               |MENAV aAlfa;
          |FINSI;
      |FINSI;
      |SI nOpcion = 3;
         aAlfa = "    N" + &191 + " Está seguro de salir sin aplicar los cambios ?";
         |CONFI aAlfa;
         |SI FSalida ! 0; |VETE OtraVez; |FINSI;
      |FINSI;
      |SI nOpcion < 1; |VETE OtroMenu; |FINSI;
      |CIERRA #nomtmp04;   |DELINDEX #nomtmp04;
   |FINSI;
|FPRO;
