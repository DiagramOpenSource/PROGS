|FICHEROS;
     nomcalca #0;
     nomcalac #100;
     nompagli;
     nom400eu;
     nomvarcc;
     nomcontr;

     labtraba;

     nomcot01;
     nomcot02;
     nomcot03;
     nomcot04;
|FIN;

|VARIABLES;
    mod = 0;
    fecsys = @;
    alfa1 = "";
    xxxxfiac = "  ";
    xxaponer = "  ";
    xrelleno = "                              ";
    men1 = "0000ATENCION !!! Fecha erronea ...";
    dia1 = "";
    mes1 = "";
    any1 = "";
    dia = 0;
    mes = 0;
    any = 0;
    tope = 0;
    sw = 0;
    fec = "";
    blanco = "          ";
    puntos = "..........";
     nModo = 0;
     nBonif = 0;
     swSigue = 0;

     enBoton = 0;
     nOpcion = 0;
     swBotonSiNo = 0;
     aAlfa = "";
     aParametro = "";
     aNaf = "";
     enBotonCal = 0;
     swBotonCalSiNo = 0;

     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nAnyAUTO = 0;
     &nMesAUTO = 0;
     &nTipAUTO = 0;
|FIN;

|INCLUYE i_manca;

|PROCESO nomcot04_borra;
     |BORRA 020#nomcot04.a;
     |LIBERA #nomcot04;
|FPRC;

|DEFBUCLE nomcot04_borra;
     #nomcot04#1;
     7;
     #0#0, #0#184, #0#2, 0, "               ", "             ", 01, 001, #0#1;
     #0#0, #0#184, #0#2, 0, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzzz", 99, 999, #0#1;
     be;
     NULL, nomcot04_borra;
|FIN;

|PROCESO nomcot03_borra;
     |BORRA 020#nomcot03.a;
     |LIBERA #nomcot03;
|FPRC;

|DEFBUCLE nomcot03_borra;
     #nomcot03#1;
     ;
     #0#0, #0#184, #0#2, 0, "               ", "             ", 01, #0#1, 001;
     #0#0, #0#184, #0#2, 0, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzzz", 99, #0#1, 999;
     be;
     NULL, nomcot03_borra;
|FIN;

|PROCESO nomcot02_borra;
     |BORRA 020#nomcot02.a;
     |LIBERA #nomcot02;
|FPRC;

|DEFBUCLE nomcot02_borra;
     #nomcot02#1;
     ;
     #0#0, #0#184, #0#2, 0, "               ", "             ", 01, #0#1;
     #0#0, #0#184, #0#2, 0, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzzz", 99, #0#1;
     be;
     NULL, nomcot02_borra;
|FIN;

|PROCESO nomcot01_borra;
     |BORRA 020#nomcot01.a;
     |LIBERA #nomcot01;
|FPRC;

|DEFBUCLE nomcot01_borra;
     #nomcot01#1;
     7;
     #0#0, #0#184, #0#2, 0, "               ", "             ", 01, #0#1;
     #0#0, #0#184, #0#2, 0, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzzz", 99, #0#1;
     be;
     NULL, nomcot01_borra;
|FIN;

|PROCESO BorraTramos;
     |BUCLE nomcot01_borra;
     |BUCLE nomcot02_borra;
     |BUCLE nomcot03_borra;
     |BUCLE nomcot04_borra;
|FPRC;

|PROCESO tipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          fecsys = ~;
          any1 = fecsys;
          any1 = fecsys % -104;
          any = any1;
          |ABRE #nompagli;
          #nompagli#0 = #0#0;
          #nompagli#1 = any;
          #nompagli#2 = #0#2;
          #nompagli#3 = #0#3;
          #nompagli#4 = "N";
          #nompagli#5 = #0#1;
          |LEE 101#nompagli.=;
          |SI FSalida = 0;
               |BORRA 020#nompagli.a;
          |FINSI;

          #nompagli#4 = "N";
          |LEE 101#nompagli.=;
          |SI FSalida = 0;
               |BORRA 020#nompagli.a;
          |FINSI;

          |CIERRA #nompagli;

          |SI #0#2 = 6;
               |ABRE #nom400eu;
               #nom400eu#0 = #nomcalca#0;
               #nom400eu#1 = #nomcalca#1;
               #nom400eu#2 = 2008;
               #nom400eu#3 = 6;
               |LEE 101#nom400eu.=;
               |SI FSalida = 0;
                    |BORRA 020#nom400eu.a;
                    |LIBERA #nom400eu;
               |FINSI;
               |CIERRA #nom400eu;
          |FINSI;

          |HAZ BorraTramos;
     |FINSI;
|FPRC;

|PROCESO fechaok; |TIPO 0;
    fec = #0Campo; sw = 0;
|SI fec ! blanco; |Y fec ! puntos;
        dia1 = fec % A102;
        mes1 = fec % A402;
        any1 = fec % A704;
        dia = dia1; mes = mes1; any = any1;
    |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
        |SI mes [ 12; |Y mes ] 1;
            |SI mes=1;|O mes=3;|O mes=5;|O mes=7;|O mes=8;|O mes=10;|O mes=12;
                    tope = 31;
            |SINO;
                |SI mes = 2;
                        mod = any $ 4;
                    |SI mod = 0;
                            tope = 29;
                    |SINO;
                            tope = 28;
                    |FINSI;
                |SINO;
                        tope = 30;
                |FINSI;
            |FINSI;
            |SI dia [ tope;
                    sw = 1;
            |FINSI;
        |FINSI;
    |FINSI;
|SINO;
        sw = 1;
|FINSI;
|SI sw = 0;
    |MENAV men1;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO mirames; |TIPO 7;    || mes de fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
    |PINTA #0Campo;
|FPRC;

|PROCESO nomvarcc;
     swSigue = 1;
|FPRC;

|DEFBUCLE nomvarcc;
     #nomvarcc#1;
     ;
     #0#0, #0#1, #0#2, #0#3, 0000, 00;
     #0#0, #0#1, #0#2, #0#3, 0000, 31;
     ;
     NULL, nomvarcc;
|FIN;

|PROCESO inferior;
     #nomvarcc#0 = #0#0;
     #nomvarcc#1 = #0#1;
     #nomvarcc#2 = #0#2;
     #nomvarcc#3 = #0#3;
     #nomvarcc#4 = 0000;      || el a¤o, en principio 0000
     #nomvarcc#5 = 00;
|FPRC;

|PROCESO superior;
     #nomvarcc#0 = #0#0;
     #nomvarcc#1 = #0#1;
     #nomvarcc#2 = #0#2;
     #nomvarcc#3 = #0#3;
     #nomvarcc#4 = 0000;      || el a¤o, en principio 0000
     #nomvarcc#5 = 31;
|FPRC;

|PROCESO EREMasDe4;
     swSigue = 0;
     |SI FSalida = 18;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 0;
          |BUCLE nomvarcc;
     |FINSI;
     |SI swSigue = 1;
          |PUSHV 12392356;
          |ENTLINEAL #1#nomvarcc, 6, 2, 22, 1, inferior, superior;
          |POPV;
     |FINSI;
|FPRC;

/************************* BOTON DE BLOQUEO *********************************/

|PROCESO MensajeBloqueo; |TIPO 14;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI #nomcontr#58 ! "S"; |ACABA; |FINSI;
     |SI #nomcalca#145 = "S";
          |ATRI R;
          |PINTA 0560, "NOMINA BLOQUEADA";
          |ATRI I;
     |SINO;
          |ATRI 0;
          |PINTA 0560, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO Bloquear;
     |SI #nomcalca#145 = "S";
          #nomcalca#145 = "N";
          |GRABA 000#nomcalca.a;
          |SI FSalida ! 0;
               aAlfa = "    ATENCION. Debe entrar por consulta o modificación ";
               aAlfa = aAlfa + "a algún registro para bloquear o desbloquear";
               |MENAV aAlfa;
          |SINO;
               |HAZ MensajeBloqueo;
          |FINSI;
     |SINO;
          #nomcalca#145 = "S";
          |GRABA 000#nomcalca.a;
          |SI FSalida ! 0;
               aAlfa = "    ATENCION. Debe entrar por consulta o modificación ";
               aAlfa = aAlfa + "a algún registro para bloquear o desbloquear";
               |MENAV aAlfa;
          |SINO;
               |HAZ MensajeBloqueo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonBloqueo;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI #nomcontr#58 = "S";
          |CONTROL_SIMPLE 0, "BOTON,Bloquear/Desbloquear", 0862, 0879, Bloquear;
          enBoton = FSalida;
          |ESTADO_CONTROL enBoton, "ENABLE";
          swBotonSiNo = 1;
     |FINSI;
|FPRC;

|PROCESO BotonCalculos;
     swSigue = 0;
     |HAZ BuscaCalculos;
     |SI swSigue = 1;
          |CONTROL_SIMPLE 0, "BOTON,C lculos", 0803, 0813, Calculos;
          enBotonCal = FSalida;

          |ESTADO_CONTROL enBotonCal, "ENABLE";
          swBotonCalSiNo = 1;
     |FINSI;
|FPRC;

|PROCESO Botones; |TIPO 8;
     |HAZ BotonBloqueo;
     |HAZ BotonCalculos;
|FPRC;

|PROCESO FinBotonBloqueo;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI #nomcontr#58 = "S";
          |FIN_CONTROL_WINDOWS enBoton;
          |PULSATECLA;
          swBotonSiNo = 0;
     |FINSI;
|FPRC;

|PROCESO FinBotonCalculos;
     swSigue = 0;
     |HAZ BuscaCalculos;
     |SI swSigue = 1;
          |FIN_CONTROL_WINDOWS enBotonCal;
          |PULSATECLA;
          swBotonCalSiNo = 0;
     |FINSI;
|FPRC;

|PROCESO FinBotones; |TIPO 9;
     |HAZ FinBotonBloqueo;
     |HAZ FinBotonCalculos;
|FPRC;

|PROCESO PonBotones; |TIPO 14;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |SI #nomcontr#58 = "S";
          |SI swBotonSiNo = 0;
               |HAZ BotonBloqueo;
          |FINSI;
     |FINSI;

     swSigue = 0;
     |HAZ BuscaCalculos;
     |SI swSigue = 1;
          |SI swBotonCalSiNo = 0;
               |HAZ BotonCalculos;
          |FINSI;
     |SINO;
          |FIN_CONTROL_WINDOWS enBotonCal;
          |PULSATECLA;
          swBotonCalSiNo = 0;
     |FINSI;
|FPRC;

|PROCESO QuitaBotones; |TIPO 14;
     |SI swBotonSiNo = 1;
          |HAZ FinBotonBloqueo;
     |FINSI;

     |SI swBotonCalSiNo = 1;
          |HAZ FinBotonCalculos;
     |FINSI;
|FPRC;

/************************ BOTON DE CALCULOS *********************************/

|PROCESO nomcot03;
     swSigue = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE nomcot03;
     #nomcot03#1;
     ;
     #0#0, #0#184, #0#2, 0, "               ", aNaf, 01, 00001, 001;
     #0#0, #0#184, #0#2, 0, "zzzzzzzzzzzzzzz", aNaf, 99, 99999, 999;
     ;
     NULL, nomcot03;
|FIN;

|PROCESO BuscaCalculos;
     |DBASS aAlfa; |QBF aAlfa;

     |SI aAlfa = "/u/dsprofes/"; |O aAlfa = "/u/dsasesor/";
     ||O aAlfa = "/u/ccprofes/"; |O aAlfa = "/u/ccasesor/";
          || adelante
     |SINO;
          |SI #0#184 [ 2017;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #0#3 ! 0;
          |ACABA;
     |FINSI;

     |ABRE #labtraba;
     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     aNaf = #labtraba#75;
     |QBF aNaf;
     |BUCLE nomcot03;
/*
     |ABRE #nomcot08;
     #nomcot08#0 = #0#0;
     #nomcot08#1 = #0#1;
     #nomcot08#2 = #0#2;
     #nomcot08#3 = #0#3;
     |LEE 000#nomcot08.=;
     |SI FSalida = 0; |Y #nomcot08#184 = #0#184;
          swSigue = 1;
     |FINSI;
     |CIERRA #nomcot08;
*/
|FPRC;

|PROCESO Calculos;
     |ABRE #labtraba;
     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     aNaf = #labtraba#75;
     |QBF aNaf;

     aAlfa = #0#0; |QBF aAlfa; aAlfa = ("00000" + aAlfa) % -105;
     aParametro = aAlfa;
     aAlfa = #0#184;
     aParametro = aParametro + aAlfa;
     aAlfa = #0#2; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
     aParametro = aParametro + aAlfa;
     aAlfa = #0#3; |QBF aAlfa;
     aParametro = aParametro + aAlfa;
     aNaf = #labtraba#75;
     |QBF aNaf;
     aParametro = aParametro + aNaf;
     aAlfa = "|nomcot36;" + aParametro;

     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = " Imprimir ";
     |SINO;
          nEmpAUTO = #0#0;
          nTraAUTO = #0#1;
          nAnyAUTO = #0#184;
          nMesAUTO = #0#2;
          nTipAUTO = #0#3;
          |SUB_EJECUTA_NP "nomrecib;AUTO";
     |FINSI;
|FPRC;
