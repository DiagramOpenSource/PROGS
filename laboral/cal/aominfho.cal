|FICHEROS;
     aominfho #0;
     labtraba #1;
     aomentra #2;
     aomcalec #3;
     aominfh1 #10; ||Tmp
|FIN;

|VARIABLES;
     &eaDia = "";
     &enDia = 0;
     &enMes = 0;
     &enHora = 0;
     &enCalen = 0;
     nGraba = 0;
     fAlfa = @;
     fFecha = @;
     aAlfa = "";
     aAno = "";
     aMes = "";
     aDia = "";
     nCalAnt = 0;
     nAnoAnt = 0;
     nHorasCal = 0;
     nHoras = 0;
     nHay = 0;
     nDesde = 0;
     nHasta = 0;
     nHora = 0;
     nDMes = 0;
     nHMes = 0;
     nDDia = 0;
     nHDia = 0;
     nMes = 0;
     nDia = 0;
     i = 0;
     mes = "";
|FIN;

|PROCESO Tmp;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Mes;
     |SI mes = "01"; mes = "Enero     "; |FINSI;
     |SI mes = "02"; mes = "Febrero   "; |FINSI;
     |SI mes = "03"; mes = "Marzo     "; |FINSI;
     |SI mes = "04"; mes = "Abril     "; |FINSI;
     |SI mes = "05"; mes = "Mayo      "; |FINSI;
     |SI mes = "06"; mes = "Junio     "; |FINSI;
     |SI mes = "07"; mes = "Julio     "; |FINSI;
     |SI mes = "08"; mes = "Agosto    "; |FINSI;
     |SI mes = "09"; mes = "Septiembre"; |FINSI;
     |SI mes = "10"; mes = "Octubre   "; |FINSI;
     |SI mes = "11"; mes = "Noviembre "; |FINSI;
     |SI mes = "12"; mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO HorasCal;
     |PARA i = 99; |SI i [ 157; |HACIENDO i = i + 2;
          nDia = (A\(#3i % 102));
          nMes = (A\(#3i % 302));
          |SI nMes = aMes; |Y nDia = aDia;
               nHorasCal = i + 1;
               nHorasCal = #3nHorasCal;
               |SAL;
          |FINSI;
     |SIGUE;
     |PARA i = 9; |SI i [ 96; |HACIENDO i = i + 3;
          nDesde = i;
          nHasta = i + 1;
          nDDia = (A\(#3nDesde % 102));
          nDMes = (A\(#3nDesde % 302));
          nHDia = (A\(#3nHasta % 102));
          nHMes = (A\(#3nHasta % 302));
          |SI aMes ] nDMes; |Y aMes [ nHMes;
               |SI aDia ] nDDia; |Y aDia [ nHDia;
                    nHorasCal = i + 2;
                    nHorasCal = #3nHorasCal;
                    |SAL;
               |FINSI;
          |FINSI;
     |SIGUE;
     aAlfa = fAlfa % 1102;
     aAlfa = aAlfa > "";
     |SI aAlfa = "LU"; nHorasCal = #3#2; |FINSI;
     |SI aAlfa = "MA"; nHorasCal = #3#3; |FINSI;
     |SI aAlfa = "MI"; nHorasCal = #3#4; |FINSI;
     |SI aAlfa = "JU"; nHorasCal = #3#5; |FINSI;
     |SI aAlfa = "VI"; nHorasCal = #3#6; |FINSI;
     |SI aAlfa = "SA"; nHorasCal = #3#7; |FINSI;
     |SI aAlfa = "DO"; nHorasCal = #3#8; |FINSI;
|FPRC;

|PROCESO Horas;
     nHoras = nHoras + #2#5;
|FPRC;

|DEFBUCLE Horas;
     #2#1;
     ;
     fFecha, #1#0, #1#1, 00001, 000000, 01;
     fFecha, #1#0, #1#1, 99999, 999999, 99;
     ;
     NULL, Horas;
|FIN;

|PROCESO Trabajador;
     |PARA fFecha = #0#4; |SI fFecha [ #0#5; |HACIENDO fFecha = fFecha + 1;
          aAlfa = fFecha;
          aDia = aAlfa % 102;
          aMes = aAlfa % 402;
          aAno = aAlfa % 704;
          fAlfa = fFecha % A1;

          #3#0 = #1#156;
          #3#1 = aAno;
          |LEE 000#3=;
          |SI FSalida ! 0;
               |SI #3#0 ! nCalAnt; |O #3#1 ! nAnoAnt;
                    aAlfa = "0000No existe Calendario: "+#3#0+"/"+#3#1+&13+"Empresa/Trabajador: " + #1#0 + "/" + #1#1;
                    |MENAV aAlfa;
               |FINSI;
               nCalAnt = #3#0;
               nAnoAnt = #3#1;
               nHorasCal = 0;
          |SINO;
               |HAZ HorasCal;
          |FINSI;
          nHoras = 0;
          |BUCLE Horas;

          nGraba = 0;
          |SI #0#6 = "S"; |Y nHoras = nHorasCal;
               nGraba = 1;
          |FINSI;
          |SI nGraba = 0;
               |DDEFECTO #10;
               #10#0 = #1#1;
               #10#8 = fFecha;
               |LEE 101#10=;
               |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
               #10#1 = #1#2;
               aAlfa = fAlfa % 11; #10#2 = aAlfa;
               aAlfa = fFecha % 102; #10#3 = aAlfa;
               aAlfa = fFecha % 402; #10#4 = aAlfa;
               #10#5 = #10#5 + nHoras;
               #10#6 = nHorasCal;
               #10#7 = #10#5 - #10#6;
               mes = aMes; |HAZ Mes;
               #10#9 = mes;
               |GRABA 020#10a;
               |LIBERA #10;
               nHay = 1;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE Trabajador;
     #1#1;
     ;
     #0#0, #0#2;
     #0#1, #0#3;
     ;
     NULL, Trabajador;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     aAlfa = Usuario;
     |NOME_DAT #10 aAlfa;
     |DELINDEX #10;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "aominfho";
          |SI FSalida ! 0;
               |MENAV "0000No existe informe  'aominfho'...";
          |SINO;
               |ABRE #3;
               |ABRE #10;
               |BUCLE Trabajador;
               |CIERRA #10;
               |CIERRA #3;
               |SI nHay ! 0;
                    |BUCLE Tmp;
                    |PIEINF;
               |SINO;
                    |MENAV "0000Seleccion vacia...";
               |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
     |DELINDEX #10;
|FPRC;
