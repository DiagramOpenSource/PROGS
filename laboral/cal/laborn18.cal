|FICHEROS;
     laborn18;
     laborn08;
     labort10;
     labtraba;

     labempre;
     laborn90;
     labcontr;
     nompmail;
|FIN;

|VARIABLES;
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;

     &eaDirDest  = "";
     &eaAsunto   = "";
     &eaTexto    = "";
     &eaFichero  = "";

     nContrato = 0;
     aAlfa = "";
     &nEmpExt = 0;
     &nTraExt = 0;
     &nTipoVar = 0;
     &nNuevoVal = 0;
     &aNuevoTra = "";
     &nNuevoAFI = 0;
     &nAntigVal = 0;
     &aNuevoVal1 = "";
     &nNuevoVal2 = 0;
     &nNuevoVal3 = 0;
     &nNuevoVal4 = 0;
     &nNuevaCat = 0;
     &aNombreCat = "";
     &nHorasTC2 = 0;
     &aClaveSal1 = "";
     &aClaveSal2 = "";
     &aAntigOcu = "";
     &aNuevaOcu = "";
     &aNuevaDesOcu = "";

     aAlfa1 = "";
     aAlfa2 = "";
     aParam = "";
     &eaUsuario = "";
     &eaFecha = "";
     &efFecha = @;
     &eaHora = "";
     nCampo = 0;
     aHora = "";
     nEmp = 0;
     &eaEmpresa = "";
     &eaTrabajador = "";
     &eaAccion = "";

     nNume = 0;
     nHoras = 0;
     &enEmpresa = 0;
     &enBoton8 = 0;
     &swBoton8 = 0;

     nCampo1 = 0;
     nEmpresas = 0;
     nCodEmp = 0;
     aNomEmp = "";
     &nLabornet = 0;
     &eaOperacion = "";

     aEstadoOri = "";
     aUsuarioOri = "";
     fFechaOri = @;
     aHoraOri = "";
     aSiEsX   = "";

     &eaEstado = "";
     &eaParam = "";
     &enFSalida = 0;
     &eaQueEs            = "";
|FIN;

|PROCESO Consulta;
     eaParam = "HISTOUSU";
     |SI #laborn18#10 = "A"; aAlfa = "laborn01;" + eaParam; |FINSI;
     |SI #laborn18#10 = "B"; aAlfa = "laborn02;" + eaParam; |FINSI;
     |SI #laborn18#10 = "V"; aAlfa = "laborn03;" + eaParam; |FINSI;
     |SI #laborn18#10 = "I"; aAlfa = "laborn04;" + eaParam; |FINSI;
     |SI #laborn18#10 = "P"; aAlfa = "laborn05;" + eaParam; |FINSI;
     |SI #laborn18#10 = "C"; aAlfa = "laborn08;" + eaParam; |FINSI;

     aEstadoOri = eaEstado;
     aUsuarioOri = eaUsuario;
     fFechaOri = efFecha;
     aHoraOri = eaHora;

     eaEstado = "A";
     eaUsuario = #laborn18#14;
     efFecha = #laborn18#12;
     eaHora = #laborn18#13;
     enFSalida = 10;

     |SUB_EJECUTA aAlfa;

     eaEstado = aEstadoOri;
     eaUsuario = aUsuarioOri;
     efFecha = fFechaOri;
     eaHora = aHoraOri;
|FPRC;

|PROCESO Boton8;
     |SI swBoton8 = 0;
          |CONTROL_SIMPLE 0, "BOTON,Consulta Operaci¢n Origen", 1203, 1231, Consulta;
          enBoton8 = FSalida;
          |ESTADO_CONTROL enBoton8, "ENABLE";
          swBoton8 = 1;
     |FINSI;
|FPRC;

|PROCESO ActivaBoton;
     |ESTADO_CONTROL enBoton8, "ENABLE";
|FPRC;

|PROCESO Proceso;
     |CLS;

     aAlfa = "labort10" + Usuario;
     |NOME_DAT #labort10#aAlfa#;
     |ABRE #labort10;
     #labort10#0 = eaOperacion;
     #labort10#2 = eaUsuario;
     #labort10#9 = efFecha;
     #labort10#10 = eaHora;
     |LEE 000#labort10.=;

     #laborn18#5 = #labort10#3;
     #laborn18#6 = #labort10#6;
     #laborn18#7 = #labort10#8;
     #laborn18#8 = #labort10#4;
     #laborn18#9 = #labort10#7;
     #laborn18#10 = #labort10#0;
     #laborn18#11 = #labort10#1;
     #laborn18#12 = #labort10#9;
     #laborn18#13 = #labort10#10;
     #laborn18#14 = #labort10#2;
     #laborn18#15 = #labort10#13;
     #laborn18#16 = #labort10#14;
     #laborn18#17 = #labort10#12;
     #laborn18#26 = #labort10#16;

     |CIERRA #labort10;

     |PINPA #0#laborn18;
     |PINDA #0#laborn18;

     |ENDATOS #1#laborn18;
|FPRC;


|PROCESO Email;
     aAlfa = #laborn18#5; |QBF aAlfa;
     eaEmpresa = ("00000" + aAlfa) % -105;
     eaEmpresa = eaEmpresa + " - " + #labempre#2;

     aAlfa = #laborn18#6; |QBF aAlfa;
     eaTrabajador = ("00000" + aAlfa) % -105;
     eaTrabajador = eaTrabajador + " - " + #labtraba#2;

     eaAccion = "correción";

     |HAZ ConsEmail;
|FPRC;

|PROCESO labempre;
     nEmpresas = nEmpresas + 1;
     nCodEmp = #labempre#0;
     aNomEmp = #labempre#2;
|FPRC;

|DEFBUCLE labempre;
     #labempre#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, labempre;
|FIN;

|PROCESO Empresas; |TIPO 7;
     |ABRE #labempre;
     |BUCLE labempre;
     |CIERRA #labempre;

     |SI nEmpresas = 1;
          || tengo una unica empresa que elegir

          #laborn18#5 = nCodEmp;
          |CAMPO_MODIFICA #laborn18#5, 1, "N";
          |PINTA #laborn18#5;
     |FINSI;
|FPRC;

|PROCESO Impresion;
     |ABRE #labcontr; |LEE 000#labcontr.p; |CIERRA #labcontr;
     |SI #labcontr#84 ! "S";
          |ACABA;
     |FINSI;

     eaQueEs = "C";

     aAlfa = "*laborn10;X";
     aAlfa = aAlfa + "18";
     aAlfa = aAlfa + #laborn08#0;
     aAlfa = aAlfa + #laborn08#1;
     aAlfa1 = #laborn08#3;
     aAlfa = aAlfa + aAlfa1;
     aAlfa = aAlfa + #laborn08#4;
     aAlfa = aAlfa + "IMPRE";

     |MENSA "    Imprimiendo solicitud de corrección";
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO Contador;
     |ABRE #laborn90;

     #laborn90#0 = #laborn08#5;
     #laborn90#1 = 99999;

     |LEE 000#laborn90.];
     |SI FSalida = 0;
          |SI #laborn90#0 ! #laborn08#5;
               |LEE 000#laborn90.a;
          |FINSI;
     |SINO;
          |LEE 000#laborn90.u;
     |FINSI;

     |SI FSalida = 0;
     |Y #laborn90#0 = #laborn08#5;
          nNume = #laborn90#1;

          |DDEFECTO #laborn90;
          #laborn90#0 = #laborn08#5;
          #laborn90#1 = nNume + 1;

     |SINO;
          || es el primero de esta empresa !!!
          |DDEFECTO #laborn90;
          #laborn90#0 = #laborn08#5;
          #laborn90#1 = 1;
     |FINSI;

     #laborn90#2 = "A";
     #laborn90#3 = "Alta";
     #laborn90#4 = #laborn08#1;
     #laborn90#5 = #laborn08#2;
     #laborn90#6 = #laborn08#3;
     #laborn90#7 = #laborn08#4;

     |GRABA 020#laborn90.n;

     #laborn08#29 = #laborn90#1;

     |LIBERA #laborn90;
     |CIERRA #laborn90;
|FPRC;

|PROGRAMA;
     |CLS;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #labempre#aAlfa1#;
     |FINSI;

     |SI aParam = "MODIF"; |O aParam = "CONSUL";
          |ABRE #laborn08;
          |SI aParam = "MODIF";
               #laborn08#0 = "P";         || estado: pendiente, consulta/modificacion
          |FINSI;
          |SI aParam = "CONSUL";
               #laborn08#0 = "A";         || estado: actualizado, solo consulta
          |FINSI;
          #laborn08#1 = eaUsuario;
          #laborn08#2 = "";
          #laborn08#3 = eaFecha;
          #laborn08#4 = eaHora;
          |LEE 101#laborn08.=;

          |PARA nCampo = 0; |SI nCampo [ 25; |HACIENDO nCampo = nCampo + 1;
               #laborn18#nCampo# = #laborn08#nCampo#;
          |SIGUE;
          #laborn18#26 = #laborn08#29;
          |PINPA #0#laborn18;
          |PINDA #0#laborn18;
          |HAZ Boton8;

          |ABRE #labtraba;
          #labtraba#0 = #laborn18#5;
          #labtraba#1 = #laborn18#6;
          |LEE 000#labtraba.=;
          |CIERRA #labtraba;

          |SI aParam = "MODIF";
               |ENDATOS #1#laborn18;
          |FINSI;
          |SI aParam = "CONSUL";
               |PARA nCampo = 0; |SI nCampo [ 25; |HACIENDO nCampo = nCampo + 1;
                    #laborn18#nCampo# = #laborn08#nCampo#;
               |SIGUE;
               #laborn18#26 = #laborn08#29;
               |PINDA #0#laborn18;
               |PAUSA;
          |FINSI;

          |FIN_CONTROL_WINDOWS enBoton8;
          swBoton8 = 0;
     |SINO;
          |HAZ Boton8;

          |HAZ Proceso;

          |FIN_CONTROL_WINDOWS enBoton8;
          swBoton8 = 0;
     |FINSI;

     |SI FSalida = 0; |Y aParam ! "CONSUL";
          |SI aParam = "MODIF";
               |PARA nCampo = 0; |SI nCampo [ 25; |HACIENDO nCampo = nCampo + 1;
                    #laborn08#nCampo# = #laborn18#nCampo#;
               |SIGUE;
               |GRABA 020#laborn08.a;
          |SINO;
               |ABRE #laborn08;
               #laborn08#0 = "P";    || Estado: Pendiente
               #laborn08#1 = Usuario % 0810;     || Usuario
               #laborn08#2 = "";     || Perfiles, en principio no lo uso
               #laborn08#3 = ~;      || Fecha
               |HORA aHora;
               #laborn08#4 = aHora;  || Hora
               |PARA nCampo = 5; |SI nCampo [ 25; |HACIENDO nCampo = nCampo + 1;
                    #laborn08#nCampo# = #laborn18#nCampo#;
               |SIGUE;
               |HAZ Contador;
               |GRABA 020#laborn08.n;

               |SI FSalida = 0;
                    |MENAV "    Se ha grabado correctamente la solicitud de corrección";
               |FINSI;
               |HAZ Impresion;
               |CIERRA #laborn08;

               |ABRE #nompmail; |LEE 000#nompmail.p; |CIERRA #nompmail;
               |SI #nompmail#11 = "S";
                    |HAZ Email;
               |FINSI;
          |FINSI;

          |CIERRA #laborn08;
     |FINSI;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #labempre#aAlfa2#;
     |FINSI;
|FPRO;

|PROCESO Tipo80n18;  |TIPO 80;
     aSiEsX = PARAMETRO % 101;
     |SI aSiEsX = "X";
         eaOperacion = PARAMETRO % 201;
         eaEstado    = PARAMETRO % 301;
         eaUsuario   = PARAMETRO % 410;
         aAlfa       = PARAMETRO % 1410;  efFecha = aAlfa;
         eaHora      = PARAMETRO % 2408;
         eaParam     = PARAMETRO % 3210;  |QBF eaParam;
         aParam      = eaParam;
     |SINO;
         aParam = PARAMETRO;
     |FINSI;
|FPRC;
