|FICHEROS;
     aomcalec #0;
|FIN;

|VARIABLES;
 dianum = 0;
 mesnum = 0;
 swbien = 0;
 topemes = 0;
 nume1 = 0;
 diades = 0;
 mesdes = 0;
 diahas = 0;
 meshas = 0;
 resto = 0;
 bisiesto = 0;
 swentra = 0;
 semana1 = 0;
 campo = 0;
 desde = 0;
 hasta = 0;
 pesos = 0;
 mesact = 0;
 topemes1 = 0;
 topemes2 = 0;
 mid = 0;
 diafij = 0;
 mesfij = 0;
 mid_1 = 0;
 mid_2 = 0;
    errorfec1 = "     ATENCION !!! Fecha erronea / Formato (DDMM) ...";
    errorfec2 = "     ATENCION !!! Error de entrada ...";
    fecha  = @;
    alfa1  = "";
    alfa2  = "";
    alfa3  = "";
    mesalf = "";   || calculo lib_0
    clave  = "";
|FIN;

|| *************************************************************************
|| ****** calculos desde el mantenimiento **********************************
|| *************************************************************************

|PROCESO fechbien; |TIPO 0;   || chequea la fecha
    alfa1 = #0Campo % 102;
    alfa2 = #0Campo % 302;
    dianum = alfa1;
    mesnum = alfa2;
    |SI dianum = 0; |Y mesnum = 0; |ACABA; |FINSI;
    swbien = 0;
    |SI mesnum ] 1; |Y mesnum [ 12;
        |HAZ lib_0;
        |SI dianum [ topemes; |Y dianum > 0;
                swbien = 1;
        |FINSI;
    |FINSI;
    |SI swbien = 0;
        |MENAV errorfec1;
        |ERROR;
    |FINSI;
|FPRC;

|PROCESO desdefec; |TIPO 0;   || chequea si el desde es mayor al hasta
    |SI FSalida = 2; |ACABA; |FINSI;

    nume1 = Campo - 1;
    alfa1 = #0nume1 % 102;    || separa el desde
    alfa2 = #0nume1 % 302;
    diades = alfa1;
    mesdes = alfa2;
    alfa1 = #0Campo % 102;    || separa el hasta
    alfa2 = #0Campo % 302;
    diahas = alfa1;
    meshas = alfa2;
    swbien = 0;
|SI mesdes < meshas;
        swbien = 1;
|FINSI;
|SI mesdes = meshas; |Y diades [ diahas;
        swbien = 1;
|FINSI;
|SI swbien = 0;
    |MENAV errorfec2;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO anyo; |TIPO 0;       || chequea si el a¤o es bisiesto
    nume1 = #0Campo;
|SI nume1 ! 0;|Y nume1 > 1980;
        resto = nume1 $ 4;
    |SI resto = 0;
            bisiesto = 1;
    |SINO;
            bisiesto = 0;
    |FINSI;
|SINO;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO graba; |TIPO 3;      || construye calendario en fichero de trabajo
|FPRC;

|PROCESO borra; |TIPO 2;  || borra registro en el calendario de trabajo
|FPRC;

||****************************************************************************
||******* rutinas ************************************************************
||****************************************************************************

|PROCESO lib_0;        || convierte a literal mes en numero y halla ultimo dia
|SI mesnum =  1;  topemes = 31;             |FINSI;
|SI mesnum =  2;  topemes = 28 + bisiesto;  |FINSI;
|SI mesnum =  3;  topemes = 31;             |FINSI;
|SI mesnum =  4;  topemes = 30;             |FINSI;
|SI mesnum =  5;  topemes = 31;             |FINSI;
|SI mesnum =  6;  topemes = 30;             |FINSI;
|SI mesnum =  7;  topemes = 31;             |FINSI;
|SI mesnum =  8;  topemes = 31;             |FINSI;
|SI mesnum =  9;  topemes = 30;             |FINSI;
|SI mesnum = 10;  topemes = 31;             |FINSI;
|SI mesnum = 11;  topemes = 30;             |FINSI;
|SI mesnum = 12;  topemes = 31;             |FINSI;
|FPRC;

|PROCESO firstdia;           || calcula el dia de la semana del 01.01.XXXX
    alfa1 = "01.01." + #0#1;
    fecha = alfa1;
    fecha = fecha % 1;
    alfa1 = fecha % 11;
|QBF alfa1;
|SI alfa1 = "Lunes";     semana1 = 2;   |FINSI;
|SI alfa1 = "Martes";    semana1 = 3;   |FINSI;
|SI alfa1 = "Miercoles"; semana1 = 4;   |FINSI;
|SI alfa1 = "Jueves";    semana1 = 5;   |FINSI;
|SI alfa1 = "Viernes";   semana1 = 6;   |FINSI;
|SI alfa1 = "Sabado";    semana1 = 7;   |FINSI;
|SI alfa1 = "Domingo";   semana1 = 8;   |FINSI;
|FPRC;


||****************************************************************************
||******* crean el calendario en el fichero de trabajo ***********************
||****************************************************************************

|PROCESO semana;      || calcula los pesos segun dia semana
|FPRC;


|PROCESO fechas;      || calcula los pesos segun margenes de fechas
|FPRC;



|PROCESO diasfi;      || calcula los pesos segun dias fijos
|FPRC;
