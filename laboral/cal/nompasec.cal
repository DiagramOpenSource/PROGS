|FICHEROS;
     nompasec #0;
     nomconst;
     labtraba;
|FIN;

|VARIABLES;
     aMensa = "";
     aDescripcion = "";
     swExiste = 0;
     nNroTrab = 0;
     nCons = 0;
     nCampo = 0;
     nAfectados = 0;
     aAlfa = "";
     swComprueba = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     fecsys = @;
     fFecha1 = @;
     fFecha2 = @;
     nComp1 = 0; nComp2 = 0; nComp3 = 0; nComp4 = 0;
     nComp5 = 0; nComp6 = 0; nComp7 = 0; nComp8 = 0;
     &eaVengoDe = "";
|FIN;

|PROCESO MinConst;
     #nomconst#88 = #nompasec#0;
     #nomconst#79 = fFecha1;
     #nomconst#0 = 500;
|FPRC;

|PROCESO MaxConst;
     #nomconst#88 = #nompasec#0;
     #nomconst#79 = fFecha2;
     #nomconst#0 = 999;
|FPRC;

|PROCESO ConsultaConst; |TIPO 66;
     |ABRE #nomconst;
     fecsys = ~;
     aAlfa = fecsys;
     aAlfa1 = "01.01." + (aAlfa % -104);
     fFecha1 = aAlfa1;
     aAlfa2 = "31.12." + (aAlfa % -104);
     fFecha2 = aAlfa2;
     |CONSULTA_F_CLAVE #4#nomconst, MinConst, MaxConst;
     |SI FSalida = 0;
          #0#4 = #nomconst#0;
          #0#5 = #nomconst#1;
          |PINTA #0#4;
          |PINTA #0#5;
     |FINSI;
     |CIERRA #nomconst;
|FPRC;

|PROCESO CompConst;
     |ABRE #nomconst;
     |SELECT #5#nomconst;
     #nomconst#88 = #0#0;
     #nomconst#0 = #0Campo;
     |LEE 000#nomconst.=;
     |SI FSalida ! 0;
          aAlfa = "    ATENCION: La constante no existe para el Régimen especificado. ";
          |MENAV aAlfa;
          aAlfa = "    Si la constante es correcta puede continuar, pero es conveniente "
          aAlfa = aAlfa + "revisar los datos de los trabajadores.";
          |MENAV aAlfa;

          |SELECT #2#nomconst;
          #nomconst#88 = #0#0;
          |LEE 000#nomconst.=;
          |SI FSalida = 0;
               #0#5 = #nomconst#1;
               |PINTA #0#5;
          |FINSI;
     |SINO;
          #0#5 = #nomconst#1;
          |PINTA #0#5;
     |FINSI;
     |SELECT #1#nomconst;
     |CIERRA #nomconst;
|FPRC;

|PROCESO BuscaDes;
     swExiste = 1;
     aDescripcion = #nomconst#1;
     |ERROR10;
|FPRC;

|DEFBUCLE BuscaDes;
     #nomconst#2;
     ;
     nCons;
     nCons;
     ;
     NULL, BuscaDes;
|FIN;

|PROCESO Descripcion;
     aDescripcion = ""
     swExiste = 0;
     nCons = #0Campo;
     |BUCLE BuscaDes;
     |SI swExiste = 1;
          nCampo = Campo + 1;
          #0nCampo = aDescripcion;
          |PINTA #0nCampo;
     |SINO;
          |MENAV "    Constante no encontrada en Mto. Constantes";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CuentaTrab;
     nNroTrab = nNroTrab + 1;
|FPRC;

|DEFBUCLE CuentaTrab;
     #labtraba#1;
     44, 247, 248;
     00001, 00001, "A", #0#0, #0#1;
     99999, 99999, "A", #0#0, #0#1;
     ;
     NULL, CuentaTrab;
|FIN;

|PROCESO Cuenta;
     nNroTrab = 0;
     |BUCLE CuentaTrab;
     #0#3 = nNroTrab;
     |PINTA #0#3;
|FPRC;

|PROCESO inferior;
     #0#0 = 000;
     #0#1 = 001;
|FPRC;

|PROCESO superior;
     #0#0 = 999;
     #0#1 = 999;
|FPRC;

|PROCESO Busca;
     |SI nComp1 = #nomconst#6; |Y nComp2 = #nomconst#12;
     |Y nComp3 = #nomconst#14; |Y nComp4 = #nomconst#16;
     |Y nComp5 = #nomconst#7;  |Y nComp6 = #nomconst#13;
     |Y nComp7 = #nomconst#15; |Y nComp8 = #nomconst#17;
          #nompasec#4 = #nomconst#0;
          #nompasec#5 = #nomconst#1;
     |FINSI;
|FPRC;

|DEFBUCLE Busca;
     #nomconst#4;
     ;
     #nompasec#0, fFecha1, 500;
     #nompasec#0, fFecha2, 999;
     ;
     NULL, Busca;
|FIN;

|PROCESO BuscaEquiv;
     |SELECT #2#nomconst;
     #nomconst#0 = #nompasec#1;
     |LEE 000#nomconst.=;
     |SI FSalida = 0;
          nComp1 = #nomconst#6;
          nComp2 = #nomconst#12;
          nComp3 = #nomconst#14;
          nComp4 = #nomconst#16;
          nComp5 = #nomconst#7;
          nComp6 = #nomconst#13;
          nComp7 = #nomconst#15;
          nComp8 = #nomconst#17;
     |SINO;
          nComp1 = 0; nComp2 = 0; nComp3 = 0; nComp4 = 0;
          nComp5 = 0; nComp6 = 0; nComp7 = 0; nComp8 = 0;
     |FINSI;

     fecsys = ~;
     aAlfa = fecsys;
     aAlfa1 = "01.01." + (aAlfa % -104);
     fFecha1 = aAlfa1;
     aAlfa2 = "31.12." + (aAlfa % -104);
     fFecha2 = aAlfa2;
     |BUCLE Busca;
|FPRC;

|PROCESO labtraba;
     |DDEFECTO #nompasec;
     #nompasec#0 = #labtraba#247;
     #nompasec#1 = #labtraba#248;
     |LEE 101#nompasec.=
     |SI FSalida ! 0;
          aDescripcion = ""
          swExiste = 0;
          nCons = #nompasec#1;
          |BUCLE BuscaDes;
          #nompasec#2 = aDescripcion;
          #nompasec#3 = 1;

          |HAZ BuscaEquiv;
          |GRABA 020#nompasec.n;
          |LIBERA #nompasec;
     |SINO;
          #nompasec#3 = #nompasec#3 + 1;
          |GRABA 020#nompasec.a;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     44, 248;
     00001, 00001, "A", 0;
     99999, 99999, "A", 499;
     ;
     NULL, labtraba;
|FIN;

|PROCESO RegrabaTrab;
     |SI #0#4 ] 500;
          #labtraba#248 = #0#4;
          |GRABA 020#labtraba.a;
          nAfectados = nAfectados + 1;
     |FINSI;
|FPRC;

|DEFBUCLE RegrabaTrab
     #labtraba#1;
     44, 247, 248;
     00001, 00001, "A", #0#0, #0#1;
     99999, 99999, "A", #0#0, #0#1;
     be;
     NULL, RegrabaTrab;
|FIN;

|PROCESO Regraba;
     |BUCLE RegrabaTrab
|FPRC;

|DEFBUCLE Regraba;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Regraba;
|FIN;

|PROCESO Comprueba;
     swComprueba = 1;
|FPRC;

|DEFBUCLE Comprueba;
     #0#1;
     4;
     000, 001, 000;
     999, 999, 499;
     ;
     NULL, Comprueba;
|FIN;

|PROGRAMA;
     |CLS;

     eaVengoDe = "nompasec";
     |SUB_EJECUTA "nomfan02;ACTUALIZACION";

     aMensa = "    S" + &191 + "Desea que se cargue automaticamente el lineal de constantes?";
     |CONFI aMensa;
     |SI FSalida = 0;
          |ABRE #nomconst;
          |DELINDEX #nompasec;
          |ABRE #nompasec;
          |BUCLE labtraba;
          |CIERRA #nompasec;
          |CIERRA #nomconst;
     |FINSI;
     |PARA; |SI; |HACIENDO;
          |ENTLINEAL #1#nompasec, 1, 2, 17, 1, inferior, superior;
          swComprueba = 0;
          |BUCLE Comprueba;
          |SI swComprueba = 0;
               |SAL;
          |SINO;
               aMensa = "     No se cambiará ningún trabajador a una constante inferior a la 500. ";
               |MENAV aMensa;
               aMensa = "    S¿Desea repasar el lineal?";
               |CONFI aMensa;
               |SI FSalida ! 0;
                    |SAL;
               |FINSI;
          |FINSI;
     |SIGUE;

     ||            1         2         3         4         5         6         7
     ||            0123456789012345768901234567890123456789012345768901234567890
     |ATRI R;
     |PINTA 1910, " ATENCION!!!! Antes de continuar con este proceso se deberia ";
     |PINTA 2010, " haber realizado la Adaptacion del Maestro de Trab. al nuevo ";
     |PINTA 2110, " Fichero de Constantes. Si continua se procedera a  regrabar ";
     |PINTA 2210, " la constante de los trabajadores afectados. Es recomendable ";
     |PINTA 2310, "             tener una copia del fichero labtraba.           ";
     |PAUSA;
     |ATRI 0;
     |CONFI "    SEsta seguro de que desea continuar?"
     aMensa = "    La seleccion ha quedado grabada. ";
     |SI FSalida = 0;
          nAfectados = 0;
          |BUCLE Regraba;
          |SI nAfectados > 0;
               aAlfa = nAfectados;
               aMensa = aMensa + "Se ha modificado la constante en " + aAlfa + " trabajadores.";
          |SINO;
               aMensa = aMensa + "No se ha realizado ningun cambio."
          |FINSI;
     |SINO;
          aMensa = aMensa + "No se ha realizado ningun cambio."
     |FINSI;
     |MENAV aMensa;
|FPRO;
