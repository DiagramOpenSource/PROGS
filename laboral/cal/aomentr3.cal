|FICHEROS;
     aomentr3 #0;         || entrada horas II
     aomentr4 #1,MANTE;   || ventana entrada horas
     aomentrh #3,MANTE;

     labempre #10;        || empresas
     labtraba #11;        || trabajadores
     aomhoras #12;        || tipos de hora
     aomparam #13;
     aovi0001;
     aovi0011;
     aomcomen;

     agifa041@;
     gomantho@;
     gotrabaj@;
     gotrabal@;
     goptrcom@;
     temp0001@ #500;
|FIN;

|VARIABLES;
     aAlfa = "";
     aDef = "";
     aEmp = "";
     aFic = "";
     aPath = "";
     aSerExp = "";
     nNumExp = 0;
     nSw = 0;
     aEstado = "";
     nError = 0;

     &enForma = 0;
     &efFecha = @;
     &enUni = 0;
     &enHora = 0;
     &enObra = 0;
     &enSubobra = 0;
     &enTraba = 0;
     &eaSerPre = "";
     &enNumPre = 0;
     &eaNivel = "";
     &eaCapitulo = "";
     &eaPartida = "";
     &eaDesParti = "";
     &enPrecioHora = 0;
     &enEmpresa = 0;
     &enPrecioVenta = 0;

    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    fecha = @;
    mes = 0;
    any = 0;
    bisiesto = 0;
    topemes = 0;
    sw_enalta = 0;
    uno_nuevo = 0;
     aLon = "";
     nLon1 = 0;
     nLon2 = 0;
     &aTrabajador = "";
     &nUnidades = 0;
     aAlfa1 = "";
     nCate = 0;
     nTraba = 0;
     nModo = 0;
     &nLin = 0;
     nPos1 = 0;
     nPos2 = 0;
     fFecha = @;
|FIN;
____________________________________/
|PROCESO defecto;
    fech1 = ~;
    alfa1 = fech1;
    alfa2 = alfa1 % 402;     mes = alfa2;
    alfa2 = alfa1 % -104;    any = alfa2;

    nume1 = any $ 4;
|SI nume1 = 0;
        bisiesto = 1;
|SINO;
        bisiesto = 0;
|FINSI;

|SI mes =  1;  topemes = 31;             |FINSI;
|SI mes =  2;  topemes = 28 + bisiesto;  |FINSI;
|SI mes =  3;  topemes = 31;             |FINSI;
|SI mes =  4;  topemes = 30;             |FINSI;
|SI mes =  5;  topemes = 31;             |FINSI;
|SI mes =  6;  topemes = 30;             |FINSI;
|SI mes =  7;  topemes = 31;             |FINSI;
|SI mes =  8;  topemes = 31;             |FINSI;
|SI mes =  9;  topemes = 30;             |FINSI;
|SI mes = 10;  topemes = 31;             |FINSI;
|SI mes = 11;  topemes = 30;             |FINSI;
|SI mes = 12;  topemes = 31;             |FINSI;
|FPRC;

|PROCESO fechas;
|HAZ defecto;

    alfa1 = topemes; alfa1 = "00" + alfa1;   alfa1 = alfa1 % -102;
    alfa2 = mes;     alfa2 = "00" + alfa2;   alfa2 = alfa2 % -102;
    alfa3 = any;

    alfa4 = "01."       + alfa2 + "." + alfa3;  fech1 = alfa4; || desde fecha
    alfa4 = alfa1 + "." + alfa2 + "." + alfa3;  fech2 = alfa4; || hasta fecha

    #0#2 = fech1;  |PINTA #0#2;
    #0#3 = fech2;  |PINTA #0#3;
|FPRC;

|PROCESO min1;
    #1#1 = #0#0;              || obra
    #1#7 = #0#1;              || subobra
    #1#0 = #0#2;              || fecha
    #1#2 = #0#7;                 || empresa
    #1#3 = 1;                 || trabajador
    #1#4 = 0;                 || tipos de hora
|FPRC;

|PROCESO max1;
    #1#1 = #0#0;              || obra
    #1#7 = #0#1;              || subobra
    #1#0 = #0#3;              || fecha
    #1#2 = #0#7;             || empresa
    #1#3 = 99999;             || trabajador
    #1#4 = 99;                || tipos de hora
|FPRC;

|PROGRAMA;
|CLS;
|CABEZA "ENTRADA HORAS";
|DDEFECTO #0;
|PINPA #0#0;
|PINDA #0#0;
|HAZ fechas;
|ENDATOS #1#0;

|PARA; |SI FSalida = 0; |HACIENDO;
        fecha = "00.00.0000";
        sw_enalta = 0;
    |SI #0#4 = 1;   |ENTLINEAL #3#1, -3, 1, 20, 0, min1, max1;    |FINSI;
    |SI #0#4 = 2;   |ENTLINEAL #5#1, -4, 1, 20, 0, min1, max1;    |FINSI;
    |ENDATOS #1#0;
|SIGUE;
|FPRO;
____________________________________/
|PROCESO fecha7; |TIPO 7;
    modo = (FEntrada / 100) ! 0;
|SI sw_enalta = 1;
    |PTEC 802;
    |PTEC 802;
    |PTEC 802;
    |PTEC 802;
|SINO;
    |SI uno_nuevo = 1;|Y #0#4 = 1;
            uno_nuevo = 0;
        |SI modo ! 1;
            |PTEC 809;
            |PTEC 806;
            |PTEC 50;
            |PTEC 49;
            |PTEC 49;
            |PTEC 51;
        |FINSI;
    |SINO;
        |SI modo = 1;
            |SI fecha ! "00.00.0000";
                    #1#0 = fecha;
            |SINO;
                    #1#0 = #0#3;
            |FINSI;
            |PINTA #1#0;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO traba7; |TIPO 7;
    modo = (FEntrada / 100) ! 0;
|SI uno_nuevo = 1;|Y #0#4 = 2;
        uno_nuevo = 0;
    |SI modo ! 1;
        |PTEC 809;
        |PTEC 806;
        |PTEC 57;
        |PTEC 57;
        |PTEC 57;
        |PTEC 57;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO arreglo; |TIPO 7;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          sw_enalta = 1;
          #aomentr4#2 = #aomentr3#7;
     |FINSI;
|FPRC;

|PROCESO mas_arreglos; |TIPO 7;
    sw_enalta = 0;
|FPRC;

|PROCESO fecha0; |TIPO 0;
|HAZ pin_semana;
    modo = (FEntrada / 100) ! 0;
|SI FSalida = 0;|Y modo = 1;
    |SI #1#0 > #0#3;
        |MENAV "    Fecha fuera de seleccion ...";
        |ERROR;
    |SINO;
            fecha = #1#0;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO tipo13; |TIPO 13;
|HAZ pin_semana;
|HAZ pin_empre;
|HAZ pin_traba;
|HAZ pin_horas;
|FPRC;

|PROCESO pin_semana;
|PINTA 1404, "           ";
    fech1 = #1#0 % 1;
    alfa1 = fech1;
    alfa1 = alfa1 % 11;
|ATRI I;
|PINTA 1404, alfa1;
|ATRI 0;
|FPRC;

|PROCESO pin_empre; |TIPO 0;
     |DDEFECTO #10;
     |ABRE #10;
     #10#0 = #1#2;
     |LEE 000#10=;
     |CIERRA #10;

     |ATRI I;
     alfa1 = #10#2 % 131;
     |PINTA 1604, alfa1;
     |ATRI 0;
|FPRC;

|PROCESO pin_traba; |TIPO 0;
|DDEFECTO #11;
|ABRE #11;
    #11#0 = #1#2;
    #11#1 = #1#3;
|LEE 000#11=;
|CIERRA #11;
|ATRI I;  alfa1 = #11#2 % 131; |PINTA 1804, alfa1;     |ATRI 0;
aTrabajador = #11#2;
|FPRC;

|PROCESO pin_horas; |TIPO 0;
/*
|DDEFECTO #12;
|ABRE #12;
    #12#0 = #1#4;
|LEE 000#12=;
|CIERRA #12;
|ATRI I;  alfa1 = #12#2;       |PINTA 2202, alfa1;     |ATRI 0;
*/
|FPRC;

|PROCESO tipo11; |TIPO 11;
|SI FSalida = 9;
    |PTEC 77;
    |PTEC 802;           || modificacion
    |PTEC 802;
    |PTEC 802;
|FINSI;
|SI FSalida = 12;
    |PTEC 66;
    |PTEC 802;           || baja
    |PTEC 802;
    |PTEC 802;
|FINSI;
|FPRC;

|PROCESO tipo3; |TIPO 3;
    modo = (FEntrada / 100) ! 0;
|SI modo = 1;
        uno_nuevo = 1;
|FINSI;
|FPRC;

|PROCESO ActComen;
     #goptrcom@#0 = #aomcomen#0;        || ser. pre.
     #goptrcom@#1 = #aomcomen#1;        || num. pre.
     #goptrcom@#2 = #aomcomen#2;        || fecha
     #goptrcom@#3 = #aomentrh#18;        || linea parte
     #goptrcom@#4 = #aomcomen#5;        || linea comen.
     |LEE 101#goptrcom@.=;
     FEstado = FSalida;
     |SI FSalida = 0;
          #goptrcom@#5 = #aomcomen#6;
          |GRABA 101#goptrcom@.a;
     |SINO;
          #goptrcom@#0 = #aomcomen#0;
          #goptrcom@#1 = #aomcomen#1;
          #goptrcom@#2 = #aomcomen#2;
          #goptrcom@#3 = #aomentrh#18;
          #goptrcom@#4 = #aomcomen#5;
          #goptrcom@#5 = #aomcomen#6;
          |GRABA 020#goptrcom@.n;
     |FINSI;
|FPRC;

|DEFBUCLE ActComen;
     #aomcomen#1;
     ;
     #aomentrh#9, #aomentrh#10, #aomentrh#6, #aomentrh#2, #aomentrh#4, 001;
     #aomentrh#9, #aomentrh#10, #aomentrh#6, #aomentrh#2, #aomentrh#4, 999;
     be;
     NULL, ActComen;
|FIN;

|PROCESO BorraComen;
     |BORRA 020#goptrcom@.a;
|FPRC;

|DEFBUCLE BorraComen;
     #goptrcom@#1005;
     ;
     #aomentrh#9, #aomentrh#10, #aomentrh#6, #aomentrh#18, 001;
     #aomentrh#9, #aomentrh#10, #aomentrh#6, #aomentrh#18, 999;
     be;
     NULL, BorraComen;
|FIN;

|PROCESO Comentarios;
     |DBASS aAlfa;
     |QBF aAlfa;
     |SI aAlfa = "/u/dsprofes/";
          aAlfa = "/u/dsempres/";
     |FINSI;
     aPath = aAlfa + #13#1; |QBF aPath;
     aDef = aPath + "/def/goptrcom";
     |CARGA_DEF aDef, goptrcom@;
     |SI FSalida = 0;
          aEmp = #aomentr3#7;
          aEmp = "00000" + aEmp;
          aEmp = aEmp % -105;
          aFic = aPath + "/fich/" + aEmp + "/";
          |PATH_DAT #goptrcom@#aFic#;
     |FINSI;

     |ABRE #goptrcom@;
     |BUCLE BorraComen;
     |BUCLE ActComen;
     |CIERRA #goptrcom@;
     |DESCARGA_DEF #goptrcom@;
|FPRC;

|PROCESO BuscaImporte;
     || busca importe de hora de trabajo para el modulo de VIPEI
     enPrecioHora = 0;
     enPrecioVenta = 0;
     |ABRE #aovi0001;
     #aovi0001#0 = #labtraba#87;
     #aovi0001#1 = #labtraba#17;
     |LEE 000#aovi0001.=;
     |SI FSalida = 0;
          enPrecioHora = #aovi0001#101;
          enPrecioVenta = #aovi0001#122;
     |FINSI;
     |CIERRA #aovi0001;

     |ABRE #aovi0011;
     #aovi0011#0 = #labtraba#0;
     #aovi0011#1 = #labtraba#1;
     |LEE 000#aovi0011.=;
     |SI FSalida = 0;
          enPrecioHora = #aovi0011#101;
          enPrecioVenta = #aovi0011#122;
     |FINSI;
     |CIERRA #aovi0011;
|FPRC;

|PROCESO ActualizaGes;
     efFecha = #aomentrh#6;
     enUni = #aomentrh#17;
     enHora = 00;        || no se usa tipo de hora
     enObra = #aomentrh#0;
     enSubobra = #aomentrh#1;
     enTraba = #aomentrh#4;
     eaSerPre = #aomentrh#9;
     enNumPre = #aomentrh#10;
     eaNivel = #13#4;
     eaCapitulo = #aomentrh#12;
     eaPartida = #aomentrh#15;
     eaDesParti = #aomentrh#16;
     enEmpresa = #aomentr3#7;
     |HAZ BuscaImporte;
     |HAZ ActGestion;

     #aomentrh#18 = nLin;
     |GRABA 020#aomentrh.a;
     |HAZ Comentarios;
|FPRC;

|DEFBUCLE Actualizacion;
     #aomentrh#1;
     ;
     aAlfa, #aomentr4#7, #aomentr4#2, #aomentr4#3, #aomentr4#0, 001;
     aAlfa, #aomentr4#7, #aomentr4#2, #aomentr4#3, #aomentr4#0, 999;
     be;
     NULL, ActualizaGes;
|FIN;

|PROCESO Tipo2; |TIPO 2;
     #aomentr4#15 = #aomentr3#5;

     enForma = 0 +. 1;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     |HAZ CreaTraba;
     aAlfa = #aomentr4#1;

     |BUCLE Actualizacion;
|FPRC;

|PROCESO ConsultaChequeo;
     nError = 1;
     enEmpresa = #aomentr3#7;
     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     |HAZ ExisteEmpresa;
     |SI FSalida ! 0;
          |MENAV "0000ERROR en configuracion empresa gestion...";
     |SINO;
          aSerExp = (("00000" + #0#0) % -105);
          nNumExp = #0#1;
          |DBASS aAlfa;
          |QBF aAlfa;
          |SI aAlfa = "/u/dsprofes/";
               aAlfa = "/u/dsempres/";
          |FINSI;
          aPath = aAlfa + #13#1; |QBF aPath;
          || aEmp = ("00000" + #13#2) % -105;
          aEmp = ("00000" + #0#7) % -105;
          aDef = aPath + "/def/gomantho";
          |CARGA_DEF aDef, gomantho@;
          |SI FSalida = 0;
               aFic = aPath + "/fich/" + aEmp + "/";
               |PATH_DAT #gomantho@#aFic#;
               |ABRE #gomantho@;
               #gomantho@#0 = aSerExp;
               #gomantho@#1 = nNumExp;
               |SI nSw = 0;             || Chequeo
                    |LEE 000#gomantho@.=;
                    nError = FSalida;
                    aEstado = #gomantho@#9;
                    #0#5 = #gomantho@#29;
                    #0#6 = #gomantho@#3;
                    |PINTA #0#5;
                    |PINTA #0#6;
               |SINO;                   || Consulta
                    |LEE 000#gomantho@.];
                    |CONSULTA_CLAVE #1#gomantho@;
                    nError = FSalida;
                    |SI FSalida = 0;
                         #0#0 = #gomantho@#0;
                         #0#1 = #gomantho@#1;
                         aEstado = #gomantho@#9;
                         |PINTA #0#0;
                         |PINTA #0#1;
                         #0#5 = #gomantho@#29;
                         #0#6 = #gomantho@#3;
                         |PINTA #0#5;
                         |PINTA #0#6;
                    |FINSI;
               |FINSI;
               |CIERRA #gomantho@;
               |DESCARGA_DEF #gomantho@;
          |FINSI;
     |FINSI;
     FSalida = nError;
|FPRC;

|PROCESO Mensaje;
     |SI aEstado = "T";
          |MENAV "0000ERROR, Obra Terminada...";
          |ERROR;
     |SINO;
          |SI aEstado = "C";
               || OK
          |SINO;
               |SI aEstado = "E"; aEstado = "Espera"; |FINSI;
               |SI aEstado = "P"; aEstado = "Parada"; |FINSI;
               aAlfa = "0000ATENCION, Obra en estado: " + aEstado;
               |SI Campo = 1;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Consulta; |TIPO 66;
     nSw = 1;
     |HAZ ConsultaChequeo;
     |SI FSalida ! 0;
          |ERROR;
     |SINO;
          |HAZ Mensaje;
     |FINSI;
|FPRC;

|PROCESO Chequeo; |TIPO 0;
     |SI Campo = 0; |Y FSalida = 1;
          |ERROR;                 || Tecla ESC
          |ACABA;
     |FINSI;

     nSw = 0;
     |HAZ ConsultaChequeo;
     |SI FSalida ! 0;
          |MENAV "0000ERROR, No existe Expediente (Obra)";
          |ERROR;
     |SINO;
          |HAZ Mensaje;
     |FINSI;
|FPRC;

|PROCESO Produccion;     || por si estamos en produccion hago el cambiazo
     aLon = aAlfa % 0;
     nLon1 = aLon;
     aAlfa1 = aAlfa - "dsprofes/";
     aLon = aAlfa1 % 0;
     nLon2 = aLon;
     |SI nLon1 ! nLon2;
          aAlfa = aAlfa1 + "dsempres/";
     |FINSI;
|FPRC;

|PROCESO ConsultaEmpresa;
     |SI nSw = 2; |ACABA; |FINSI;
     nError = 1;
     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     ||HAZ ExisteEmpresa;
     ||SI FSalida ! 0;
     ||     |MENAV "0000ERROR en configuracion empresa gestion...";
     ||SINO;
          aSerExp = (("00000" + #0#0) % -105);
          nNumExp = #0#1;
          |DBASS aAlfa;
          |HAZ Produccion;

          aPath = aAlfa + #13#1; |QBF aPath;
          || aEmp = ("00000" + #13#2) % -105;
          aDef = aPath + "/def/agifa041";
          |CARGA_DEF aDef, agifa041@;
          |SI FSalida = 0;
               || aFic = aPath + "/fich/" + aEmp + "/";
               aFic = aPath + "/fich/"
               |PATH_DAT #agifa041@#aFic#;
               |ABRE #agifa041@;
               #agifa041@#0 = #0#7;
               || #gomantho@#1 = nNumExp;
               |SI nSw = 0;             || Chequeo
                    |LEE 000#agifa041@.=;
                    nError = FSalida;
                    || aEstado = #agifa041@#8;
                    |SI nError = 0;
                         #0#8 = #agifa041@#1;
                         |PINTA #0#8;
                    |FINSI;
               |SINO;                   || Consulta
                    |LEE 000#agifa041@.];
                    |CONSULTA_CLAVE #1#agifa041@;
                    nError = FSalida;
                    |SI FSalida = 0;
                         #0#7 = #agifa041@#0;
                         #0#8 = #agifa041@#1;
                         || aEstado = #gomantho@#9;
                         |PINTA #0#7;
                         |PINTA #0#8;
                         || #0#5 = #gomantho@#29;
                         || #0#6 = #gomantho@#3;
                         || PINTA #0#5;
                         || PINTA #0#6;
                    |FINSI;
               |FINSI;
               |CIERRA #agifa041@;
               |DESCARGA_DEF #agifa041@;
          |FINSI;
     ||FINSI;
     FSalida = nError;
     |SI FSalida ! 0;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Empresa; |TIPO 66;
     nSw = 1; || vengo la consulta
     |HAZ ConsultaEmpresa;
     |SI FSalida ! 0;
          |ERROR;
     |FINSI;
     nSw = 2; || para que no vuelva a entrar
|FPRC;

|PROCESO Inicia; |TIPO 7;
     nSw = 0;
     nError = 0;
|FPRC;

|PROCESO GrabaTraba;
     #gotrabaj@#1 = #11#2;
     #gotrabaj@#3 = #11#17;
     #gotrabaj@#25 = #11#18;
     #gotrabaj@#2 = #11#87;
     #gotrabaj@#4 = #11#3;
     #gotrabaj@#5 = #11#4;
     #gotrabaj@#6 = #11#5;
     #gotrabaj@#7 = #11#6;
     #gotrabaj@#8 = #11#8;
     #gotrabaj@#9 = #11#9;
     #gotrabaj@#10 = #11#76;
     #gotrabaj@#11 = #11#11;
     #gotrabaj@#12 = #11#7;
     #gotrabaj@#13 = #11#75;
     #gotrabaj@#14 = #11#19;
     #gotrabaj@#15 = #11#238;
     #gotrabaj@#16 = #11#244;
     #gotrabaj@#28 = "S";

     #gotrabal@#0 = #gotrabaj@#0;
     #gotrabal@#1 = 1;
     |LEE 101#gotrabal@.=;
     |SI FSalida ! 0;
          |GRABA 020#gotrabal@.b=;
          #gotrabal@#2 = #11#36;
          #gotrabal@#3 = #11#37;
          |GRABA 020#gotrabal@.a;
/*
     |SINO;
          |SI #0#12 = "S";
               #gotrabal@#2 = #11#36;
               #gotrabal@#3 = #11#37;
               |GRABA 020#gotrabal@.a;
          |FINSI;
*/
     |FINSI;
     |LIBERA #gotrabal@;

     |GRABA 020#gotrabaj@.a;
|FPRC;

|PROCESO CreaTraba;
     |ABRE #11;
     |DDEFECTO #11;
     #11#0 = #aomentr4#2; ||Emp
     #11#1 = #aomentr4#3; ||Tra
     |LEE 020#11=;

     nCate = #11#17;
     nTraba = #11#1;

     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     |DBASS aAlfa;
     |HAZ Produccion;

     aPath = aAlfa + #13#1; |QBF aPath;
     aDef = aPath + "/def/gotrabaj";
     |CARGA_DEF aDef, gotrabaj@;
     |SI FSalida = 0;
          aEmp = #aomentr3#7;
          aEmp = "00000" + aEmp;
          aEmp = aEmp % -105;
          aFic = aPath + "/fich/" + aEmp + "/";
          |PATH_DAT #gotrabaj@#aFic#;
     |FINSI;

     aPath = aAlfa + #13#1; |QBF aPath;
     aDef = aPath + "/def/gotrabal";
     |CARGA_DEF aDef, gotrabal@;
     |SI FSalida = 0;
          aEmp = #aomentr3#7;
          aEmp = "00000" + aEmp;
          aEmp = aEmp % -105;
          aFic = aPath + "/fich/" + aEmp + "/";
          |PATH_DAT #gotrabal@#aFic#;
     |FINSI;

     |DDEFECTO #gotrabaj@;
     |ABRE #gotrabaj@;

     |DDEFECTO #gotrabal@;
     |ABRE #gotrabal@;

     #gotrabaj@#0 = nTraba;
     |LEE 101#gotrabaj@.=;

     |SI FSalida ! 0;
     /*
          |SI #0#12 = "S";
               |HAZ GrabaTraba;
               |SI FSalida = 0;
                    #10#6 = "ACTUALIZADO TRABAJADOR";
               |SINO;
                    #10#6 = "ERROR AL ACTUALIZAR TRABAJADOR";
                    enError = 1;
               |FINSI;
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               nHay = 1;
          |SINO;
               |SI #gotrabaj@#3 ! nCate;
                    #10#6 = "ERROR CATEGORIA INCORRECTA";
                    nConta = nConta + 1;
                    #10#7 = nConta;
                    |GRABA 020#10n;
                    enError = 1;
                    nHay = 1;
               |FINSI;
               |SI #gotrabaj@#2 ! #11#87;
                    #10#6 = "ERROR CONVENIO INCORRECTO";
                    nConta = nConta + 1;
                    #10#7 = nConta;
                    |GRABA 020#10n;
                    enError = 1;
                    nHay = 1;
               |FINSI;
          |FINSI;
     |SINO;
          |SI #0#12 = "S";
     */
               |GRABA 020#gotrabaj@.b;
               |HAZ GrabaTraba;
               |SI FSalida = 0;
                    |MENSA "    CREADO TRABAJADOR";
               |SINO;
                    |MENSA "    ERROR AL CREAR TRABAJADOR";
                    || enError = 1;
               |FINSI;
               || nConta = nConta + 1;
               || #10#7 = nConta;
               || GRABA 020#10n;
               || nHay = 1;
          /*
          |SINO;
               #10#6 = "NO EXISTE TRABAJADOR";
               nConta = nConta + 1;
               #10#7 = nConta;
               |GRABA 020#10n;
               enError = 1;
               nHay = 1;
          |FINSI;
     |FINSI;
     */
     |FINSI;
     |LIBERA #gotrabaj@;
     |CIERRA #11;

     |DESCARGA_DEF #gotrabal@;
     |DESCARGA_DEF #gotrabaj@;
|FPRC;

|PROCESO ConsultaTra; |TIPO 66;
     aAlfa = "SELECT labtraba.1,labtraba.2 FROM labtraba INTO tm" + Usuario;
     aAlfa = aAlfa + ".def WHERE 0 == " + #aomentr4#2 + " AND 44 == A";
     |SQL aAlfa;
          |SI FSalida ! 0;
               |MENAV "    No hay trabajadores en alta en la empresa";
               |ERROR;
               |ACABA;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
          |CARGA_DEF aAlfa , temp0001@;
          |SI FSalida = 0;
               aAlfa = "tm" + Usuario; |NOME_DAT #500 aAlfa;
               |ABRE #temp0001@;
               nModo = 2 + 4 + 8 + 16;
               nPos1 = 1203; nPos2 = 2338;
               |C_V #temp0001@#0, 1, "S";
               |C_V #temp0001@#1, 1, "S";
               |LINEAL_SIMPLE #1#temp0001@,nModo, nPos1, nPos2, NULL, NULL, NULL;
               |SI FSalida = 0;
                    #aomentr4#3 = #temp0001@#0;
                    |PINTA #aomentr4#3;
               |FINSI;
               |ERROR;
               |CIERRA #temp0001@;
               |DELINDEX #temp0001@;
               |DESCARGA_DEF #temp0001@;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
          |FBORRA aAlfa;
          |ACABA;
|FPRC;

|PROCESO CompTra;
     |ABRE #labtraba;
     #labtraba#0 = #aomentr4#2;
     #labtraba#1 = #aomentr4#3;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          |SI #labtraba#44 = "B";
               fFecha = #labtraba#37;
               |SI fFecha < #aomentr4#0;
                    |MENAV "    ATENCION: Trabajador en situación de BAJA";
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;
