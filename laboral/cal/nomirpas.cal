|FICHEROS;
    nomirpas #0;
    nomhicca #1;
    labtraba #2;
    labempre #3;
    nomauxi1 #4;    || areas (grupos)
    nomauxi2 #5;    || secciones (subgrupos)
    nomauxc3 #6;    || prorrata cabs.
    nomauxl3 #7;    || prorrata lins.
    nomauxtp #8;    || temporal prorrata

    nomcalca #9;
    nomcalcu #40;    || calculo mensual
|FIN;

|VARIABLES;
    seleccio = 0;
    centro = 0;
    sw = 0;
    empresa = 0;
     aAlfa = "";

    ginf_enf = 0;
    ginf_sub = 0;
    ginf_bru = 0;
    ginf_dto = 0;
    ginf_tan = 0;
    ginf_ded = 0;
    ginf_dse = 0;
    ginf_liq = 0;
    ginf_sss = 0;
    ginf_exe = 0;

    sinf_enf = 0;
    sinf_sub = 0;
    sinf_bru = 0;
    sinf_dto = 0;
    sinf_tan = 0;
    sinf_ded = 0;
    sinf_dse = 0;
    sinf_liq = 0;
    sinf_sss = 0;
    sinf_exe = 0;

    cinf_enf = 0;
    cinf_sub = 0;
    cinf_bru = 0;
    cinf_dto = 0;
    cinf_tan = 0;
    cinf_ded = 0;
    cinf_dse = 0;
    cinf_liq = 0;
    cinf_sss = 0;
    cinf_exe = 0;
    tinf_tan = 0;
    nume1 = 0;
    nume2 = 0;
    fecsys = @;
    alfa1 = "";
    error0       = "     Proceso ABORTADO !!! ";
    informe = "nomirenm";
    &p_mes = " ";
    &swlin = 0;
    &varinf1 = "";
    &varinf2 = "";

    &inf_enf = 0;
    &inf_sub = 0;
    &inf_bru = 0;
    &inf_dto = 0;
    &inf_tan = 0;
    &inf_ded = 0;
    &inf_dse = 0;
    &inf_liq = 0;
    &inf_sss = 0;
    &inf_exe = 0;
    &inf_ant3 = 0;

    &pinf_enf = 0;
    &pinf_sub = 0;
    &pinf_bru = 0;
    &pinf_dto = 0;
    &pinf_ded = 0;
    &pinf_dse = 0;
    &pinf_liq = 0;
    &pinf_sss = 0;
    &pinf_exe = 0;

    &tinf_tc1 = 0;
    &tinf_enf = 0;
    &tinf_sub = 0;
    &tinf_bru = 0;
    &tinf_dto = 0;
    &tinf_ded = 0;
    &tinf_dse = 0;
    &tinf_liq = 0;
    &tinf_sss = 0;
    &tinf_exe = 0;

    &fecha = @;
    &cabeza = "";
    grupo = "";
    subgr = "";
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    campo7 = 0;
    campo8 = 0;
    campo9 = 0;
    campoa = 0;
    campoe = 0;
    ultimo = 0;
    &area = "";
    &secc = "";
    &eacodarea = "";
    &eacodsecc = "";
    coef = 0;

    cabeza_tit = "";

     fech1 = @;
     &aCabProrr = "";
     &aCabProrr2 = "";
     &enCuadre = 0;
     &eaFuente = "";
     &enTipoInf = 0;
     &enOrdenTra = 0;
     &nUnoTipo2 = 0;
     &month = 0;
     &aNomPag = "";
     nAnyTmp = 0;

 {-1}aMenu  = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Archivo documental activado. Elija opci¢n: ";
     aMenu4 = "IA";
     aMenu5 = "Imprimir";
     aMenu6 = "Archivar";
     || aMenu7 = "Ambos";
     &nOpcion = 0;
     &nArchi = 0;
     &eaVengoDe = "";
     &enSwDesde9 = 1;
     &enSwMeteGrupoSubTipo = 0;
     &swErrorDSArchi = 0;
     &eaInforme = "";
     swSigue = 0;
     aEmp = "";
     aCen = "";
     aTra = "";
     aNomEmp = "";
     &enDesdeMes = 0;
     &enAny = 0;
     nEmpresa = 0;
     &enSwFiniq = 0;
     swHayDatos = 0;
     nNume = 0;
|FIN;

|PROCESO CuadrePagas; |TIPO 0;
     |SI #0#9 = 2;
          |SI #0#0 ! #0#1; |Y FSalida ! 2;
               aAlfa = "    ATENCION: en el informe en EXCEL sólo se puede imprimir ";
               aAlfa = aAlfa + " una empresa. Corrija la selección."
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PParametro; |TIPO 7;
     |SI PARAMETRO="M"; |O PARAMETRO="H";
          |CAMPO_MODIFICA #0#8,1,"N";
          #0#8=PARAMETRO;
          |PINTA #0#8;
     |FINSI;
|FPRC;


|PROCESO parrilla; |TIPO 0;
     |SI #0#8="M";
          |ABRE #40;
          |LEE 001#40p;
          |SI FSalida ! 0;  |DDEFECTO #40;  |FINSI;
              #0#0 = #40#0;        || desde empresa
              #0#1 = #40#1;        || hasta empresa
          |CIERRA #40;
     |FINSI;
     |SI #0#8="H";
          #0#0=1;
          #0#1=99999;
     |FINSI;
     |PINDA #0#0;
|FPRC;

____________________________________/
|PROCESO defecto; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % -102;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO FuenteDatos;|TIPO 0;
     |SI #0#8="M";
          alfa1="MENSUAL  ";
          ||CAMPO_MODIFICA #0#4,1,"N";
     |SINO;
          alfa1="HISTORICO";
          |CAMPO_MODIFICA #0#4,1,"S";
     |FINSI;

     |PINTA 0941,alfa1;
     |PINTA #0#8;
|FPRC;



*****************************************************************************
    LLAMADAS DESDE CAMPOS
*****************************************************************************

|PROCESO mirames; |TIPO 7; ||CALCULA EL MES POR DEFECTO SEGUN FECHA SISTEMA
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO pintames; |TIPO 0;      || PINTA EL MES LITERAL
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|ATRI I;
|PINTA 1547, p_mes;
|ATRI 0;
|FPRC;

*****************************************************************************
    LECTURA E IMPRESION
*****************************************************************************

|PROCESO imprimir;
     |SI swHayDatos = 0;
          swHayDatos = 1;
          |ERROR10;
     |FINSI;
|ABRE #3;
    #3#0 = #8#0;
|LEE 020#3=;
|SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
|CIERRA #3;
    #2#0 = #8#0;
    #2#1 = #8#1;
|LEE 001#2=;
|SI FSalida = 0;
    eacodarea = #8#2;                             || Cod Area
    eacodsecc = #8#3;                             || Cod Seccion
        |SI sw = 0;
                seleccio = 1;
                empresa = #2#0;
                grupo = #8#2;
                subgr = #8#3;
                sw = 1;
        |FINSI;
        |SI empresa ! #2#0;                            || ruptura por empresa
                tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;
                swlin = 2;
            |HAZ puesubgrs;  |PRINT;
            |HAZ puegrupos;  |PRINT;
                swlin = 9;
                FSalida = "PAGINA";
            |PRINT;
            |HAZ limptotal;
            |HAZ limparcial;
            |HAZ limpgrupos;
            |HAZ limpsubgrs;
                empresa = #2#0;
                grupo = #8#2;
                subgr = #8#3;
                swlin = 0;
        |SINO;
            |SI grupo ! #8#2;          || ruptura por grupos
                    swlin = 2;
                |HAZ puesubgrs;  |PRINT;  |HAZ limpsubgrs;
                |HAZ puegrupos;  |PRINT;  |HAZ limpgrupos;
                    grupo = #8#2;
                    subgr = #8#3;
                    swlin = 9;
                    FSalida = "PAGINA";
                |PRINT;
                    swlin = 0;

            |SINO;
                |SI subgr ! #8#3;          || ruptura por subgrupos
                        swlin = 2;
                    |HAZ puesubgrs;  |PRINT;  |HAZ limpsubgrs;
                        subgr = #8#3;
                        swlin = 0;
                |FINSI;
            |FINSI;
        |FINSI;
        |HAZ detalle_tmp;
        |PRINT;
        |HAZ grupos;
        |HAZ subgr;
        |HAZ totales;
|FINSI;
|FPRC;

|DEFBUCLE lee_temporal;
 #8#1;
 ;
 nEmpresa, "    ", "    ",     1, 1999, 00, 0;
 nEmpresa, "zzzz", "zzzz", 99999, 2999, 12, 9;
 e;
 NULL, imprimir;
|FIN;

****************************************************************************
               GRABACION DEL TEMPORAL
****************************************************************************

|PROCESO limpieza;
|DDEFECTO #7;
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    campo7 = 0;
    campo8 = 0;
    campo9 = 0;
    campoa = 0;
    campoe = 0;
    ultimo = 0;
|FPRC;

|PROCESO ultimo;
    ultimo = #7#2;
|FPRC;

|PROCESO graba;
     |SI inf_bru = 0;
          |ACABA;
     |FINSI;
     |SI #0#8 = "M";
          #8#00 = #9#0;        || empresa
          #8#01 = #9#1;        || trabajador
     |FINSI;
     |SI #0#8 = "H";
          #8#00 = #1#0;        || empresa
          #8#01 = #1#1;        || trabajador
     |FINSI;
     #8#02 = area;        || area
     #8#03 = secc;        || seccion
     #8#04 = coef;        || coeficiente
     |SI #7#2 ! ultimo;
          #8#05 = inf_enf*#8#4;     || campo  1
          #8#06 = inf_sub*#8#4;     || campo  2
          #8#07 = inf_bru*#8#4;     || campo  3
          #8#08 = inf_dto*#8#4;     || campo  4
          #8#09 = inf_tan;          || campo  5
          #8#10 = inf_ded * #8#4;     || campo  6
          #8#11 = inf_dse * #8#4;     || campo  7
          #8#12 = inf_liq * #8#4;     || campo  8
          #8#13 = inf_sss * #8#4;     || campo  9
          #8#14 = inf_exe * #8#4;     || campo 10
          #8#19 = inf_ant3 * #8#4;     || campo 19
          campo1 = campo1 + #8#05;
          campo2 = campo2 + #8#06;
          campo3 = campo3 + #8#07;
          campo4 = campo4 + #8#08;
          || campo5 = campo5 + #8#09;
          campo6 = campo6 + #8#10;
          campo7 = campo7 + #8#11;
          campo8 = campo8 + #8#12;
          campo9 = campo9 + #8#13;
          campoa = campoa + #8#14;
          campoe = campoe + #8#19;
     |SINO;
          #8#05 = inf_enf - campo1;   || campo  1
          #8#06 = inf_sub - campo2;   || campo  2
          #8#07 = inf_bru - campo3;   || campo  3
          #8#08 = inf_dto - campo4;   || campo  4
          #8#09 = inf_tan;          || campo  5
          #8#10 = inf_ded - campo6;   || campo  6
          #8#11 = inf_dse - campo7;   || campo  7
          #8#12 = inf_liq - campo8;   || campo  8
          #8#13 = inf_sss - campo9;   || campo  9
          #8#14 = inf_exe - campoa;   || campo 10
          #8#19 = inf_ant3 - campoe;   || campo 14
     |FINSI;
     #8#15 = 0;
     #8#20 = #labempre#2;
     #8#21 = #labtraba#2;
     #8#24 = #labtraba#7;

     #4#0 = area;
     |LEE 000#4=;

     #5#0 = area;
     #5#1 = secc;
     |LEE 000#5=;

     #8#22 = #4#1;
     #8#23 = #5#2;

     #8#25 = #0#2;
     #8#28 = nAnyTmp;

     |GRABA 020#8n;
|FPRC;

|PROCESO prorrata;
     area = #7#3;
     secc = #7#4;
     coef = #7#7;
     |HAZ graba;
|FPRC;

|PROCESO temporalH;
     |ABRE #3;
     #3#0 = #2#0;
     |LEE 020#3=;
     |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
     |CIERRA #3;
     |SI #3#36 ! "N";   || si el switch de emision no es "N"
          #1#0 = #2#0;   || Empresa
          #1#1 = #2#1;   || Trabajador
          #1#2 = #0#2;   || Mes
          #1#3 = #0#5;   || Tipo
          #1#66 = #0#4;  || a¤o historico
          |LEE 001#1=;
          |SI FSalida = 0;
               |HAZ limpieza;
               |HAZ detalleH;

               |ABRE #6;
               swSigue = 0;
               #6#0 = #1#0;
               #6#1 = #1#1;
               #6#3 = #0#4 + 2000;
               #6#4 = #0#2;
               |LEE 001#6=;
               |SI FSalida = 0;
                    swSigue = 1;
               |SINO;
                    #6#0 = #1#0;
                    #6#1 = #1#1;
                    #6#3 = 0000;
                    #6#4 = 00;
                    |LEE 001#6=;
                    |SI FSalida = 0;
                         swSigue = 1;
                    |FINSI;
               |FINSI;
               |SI swSigue = 1;
                    |BUCLELIN 2ultimo#6;
                    |BUCLELIN 2prorrata#6;
               |SINO;
                    area = #2#62;
                    secc = #2#63;
                    coef = 1;
                    |HAZ graba;
               |FINSI;
               |CIERRA #6;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO temporalM;
     |ABRE #3;
     #3#0 = #2#0;
     |LEE 020#3=;
     |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
     |CIERRA #3;
     |SI #3#36 ! "N";   || si el switch de emision no es "N"
          #9#0 = #2#0;   || Empresa
          #9#1 = #2#1;   || Trabajador
          #9#2 = #0#2;   || Mes
          #9#3 = #0#5;   || Tipo
          |LEE 001#9=;
          |SI FSalida = 0;
               |HAZ limpieza;
               |HAZ detalleM;
               |ABRE #6;
               swSigue = 0;
               #6#0 = #9#0;
               #6#1 = #9#1;
               #6#3 = #0#4 + 2000;
               #6#4 = #0#2;
               |LEE 001#6=;
               |SI FSalida = 0;
                    swSigue = 1;
               |SINO;
                    #6#0 = #9#0;
                    #6#1 = #9#1;
                    #6#3 = 0000;
                    #6#4 = 00;
                    |LEE 001#6=;
                    |SI FSalida = 0;
                         swSigue = 1;
                    |FINSI;
               |FINSI;
               |SI swSigue = 1;
                    |BUCLELIN 2ultimo#6;
                    |BUCLELIN 2prorrata#6;
               |SINO;
                    area = #2#62;
                    secc = #2#63;
                    coef = 1;
                    |HAZ graba;
               |FINSI;
               |CIERRA #6;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE gra_temporalH;
 #2#1;
 77;
 #0#0,     1, #0#6;
 #0#1, 99999, #0#7;
 ;
 NULL, temporalH;
|FIN;

|DEFBUCLE gra_temporalM;
 #2#1;
 77;
 #0#0,     1, #0#6;
 #0#1, 99999, #0#7;
 ;
 NULL, temporalM;
|FIN;


|PROCESO PHistorico;
     |HAZ ElIMPRE;
     |SI FSalida = 0;
          fecha = #0#3;
          cabeza = cabeza_tit + p_mes;
          |HAZ centra;
          |DELINDEX #8;
          |ABRE #1;
          |SI nOpcion = 1;
               |HAZ ElINFOR;
          |FINSI;
          seleccio = 0;

          |ABRE #4;
          |ABRE #5;
          |ABRE #8;

          |BUCLE gra_temporalH;

          |CIERRA #8;
          |CIERRA #5;
          |CIERRA #4;

          |HAZ Impresion;
     |SINO;
          |MENAV error0;
     |FINSI;

     |SI nOpcion = 1;
          |SI enCuadre ! 02;
               |FINIMP;
          |FINSI;
     |FINSI;

     |CIERRA #1;
|FPRC;

******************************************************************************
    CARGA DE VARIABLES
******************************************************************************

|PROCESO detalleH;
     inf_bru = #1#16;                              || Importe bruto
     inf_tan = #1#129; inf_tan = inf_tan ! 2;      || Porcentaje
     inf_ded = #1#17;                              || Deduccion
     inf_dto = #1#128;                             || Deduccion
     inf_ant3 = 0;
     |SI #1#146 ! 0;
          |SI #1#47 ! 0;
               inf_ant3 = inf_ant3 + (#1#146 - ((#1#146 * (#1#46 / (#1#46 + #1#47))) ! 2));
          |FINSI;
     |FINSI;
     inf_liq = inf_bru - inf_ded - inf_dto - inf_ant3; || Liquido (- Antic. P.E.)
     nAnyTmp = #1#66 + 2000;
|FPRC;

|PROCESO detalleM;
     inf_bru = #9#16;                              || Importe bruto
     inf_tan = #9#87; inf_tan = inf_tan ! 2;       || Porcentaje
     inf_ded = #9#17;                              || Deduccion
     inf_dto = #9#86;                              || Deduccion
     inf_ant3 = 0;
     |SI #9#104 ! 0;                    || embargos
          |SI #9#47 ! 0;
               inf_ant3 = inf_ant3 + (#9#104 - ((#9#104 * (#9#46 / (#9#46 + #9#47))) ! 2));
          |FINSI;
     |FINSI;
     inf_liq = inf_bru - inf_ded - inf_dto - inf_ant3; || Liquido (- Antic. P.E.)
     nAnyTmp = #0#4 + 2000;
|FPRC;


|PROCESO detalle_tmp;
    inf_bru = #8#07;                              || Importe bruto
    inf_dto = #8#08;                              || Descuentos
    inf_tan = #8#09;                              || Porcentaje
    inf_ded = #8#10;                              || Deduccion
    inf_liq = #8#12;                              || Liquido
    inf_ant3 = #8#19;                             || embargos
|FPRC;

|PROCESO grupos;
    ginf_bru = ginf_bru + inf_bru;       || Importe bruto
    ginf_tan = ginf_tan ! 2;             || Porcentaje
    ginf_ded = ginf_ded + inf_ded;       || Deduccion
    ginf_dto = ginf_dto + inf_dto;       || Deduccion
    ginf_liq = ginf_liq + inf_liq;       || Liquido
|FPRC;

|PROCESO subgr;
    sinf_bru = sinf_bru + inf_bru;       || Importe bruto
    sinf_tan = sinf_tan ! 2;             || Porcentaje
    sinf_ded = sinf_ded + inf_ded;       || Deduccion
    sinf_dto = sinf_dto + inf_dto;       || Deduccion
    sinf_liq = sinf_liq + inf_liq;       || Liquido
|FPRC;

|PROCESO centros;
    cinf_bru = cinf_bru + inf_bru;       || Importe bruto
    cinf_tan = cinf_tan ! 2;             || Porcentaje
    cinf_ded = cinf_ded + inf_ded;       || Deduccion
    cinf_dto = cinf_dto + inf_dto;       || Deduccion
    cinf_liq = cinf_liq + inf_liq;       || Liquido
|FPRC;

|PROCESO totales;
    tinf_bru = tinf_bru + inf_bru;       || Importe bruto
    tinf_tan = tinf_tan ! 2;             || Porcentaje
    tinf_ded = tinf_ded + inf_ded;       || Deduccion
    tinf_dto = tinf_dto + inf_dto;       || Deduccion
    tinf_liq = tinf_liq + inf_liq;       || Liquido
|FPRC;

******************************************************************************
    PASE DE VARIABLES
******************************************************************************

|PROCESO puecentro;
    pinf_bru = cinf_bru;
    pinf_ded = cinf_ded;
    pinf_dto = cinf_dto;
    pinf_liq = cinf_liq;
|FPRC;

|PROCESO puegrupos;
|ABRE #4;
    #4#0 = grupo;
|LEE 001#4=;
|SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
|CIERRA #4;
    varinf1 = #4#1;
|QBF varinf1;
    varinf1 = varinf1 + "******************************";
    varinf1 = varinf1 % 133;
    pinf_bru = ginf_bru;
    pinf_ded = ginf_ded;
    pinf_dto = ginf_dto;
    pinf_liq = ginf_liq;
|FPRC;

|PROCESO puesubgrs;
|ABRE #5;
    #5#0 = grupo;
    #5#1 = subgr;
|LEE 001#5=;
|SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
|CIERRA #5;
    varinf1 = #5#2;
|QBF varinf1;
    varinf1 = varinf1 + "ùùùùùùùùùùùùùùùùùùùùùùùùùùùùùù";
    varinf1 = varinf1 % 133;
    pinf_bru = sinf_bru;
    pinf_ded = sinf_ded;
    pinf_dto = sinf_dto;
    pinf_liq = sinf_liq;
|FPRC;

******************************************************************************
    LIMPIEZA DE VARIABLES
******************************************************************************

|PROCESO limpgrupos;
    ginf_bru = 0;
    ginf_ded = 0;
    ginf_dto = 0;
    ginf_liq = 0;
|FPRC;

|PROCESO limpsubgrs;
    sinf_bru = 0;
    sinf_ded = 0;
    sinf_dto = 0;
    sinf_liq = 0;
|FPRC;

|PROCESO limparcial;
    cinf_bru = 0;
    cinf_ded = 0;
    cinf_dto = 0;
    cinf_liq = 0;
|FPRC;

|PROCESO limptotal;
    tinf_bru = 0;
    tinf_ded = 0;
    tinf_dto = 0;
    tinf_liq = 0;
|FPRC;

******************************************************************************
   RUTINAS
******************************************************************************

|PROCESO centra;         || CENTRA TITULO DEL INFORME
    alfa1 = cabeza % 0;
    nume1 = alfa1;
    nume2 = ((79 - nume1) / 2) - 0.5;
    nume2 = nume2 ! 0;
    alfa1 = " " * nume2;
    cabeza = alfa1 + cabeza;
|FPRC;

|PROCESO ElINFOR;
     |SI enCuadre = 02;  || a EXCEL
          |ACABA;
     |SINO;
          |INFOR informe;
     |FINSI;
|FPRC;

|PROCESO Mensaje;
     aEmp = "                                             ";
     aCen = "                                             ";
     aTra = "                                             ";

     aAlfa = #labempre#0;
     |QBF aAlfa;
     aAlfa = ("00000" + aAlfa) % -105;
     aNomEmp = #labempre#2;
     aNomEmp = aNomEmp % 126;
     aEmp = "Empresa: " + aAlfa + " - " + aNomEmp;
     aEmp = " " + aEmp + " ";

     aCen = " Archivando resumen ... ";
     aCen = aCen + "                            ";
     aCen = aCen % 145;

     aTra = "";

               ||  1 2        3         4         5          6
               ||  890123456789012345678901234567890123456789012
     |ATRI R;
     |PINTA 1318, "     - Procesando archivo de resúmenes -     ";
     |PINTA 1418, aEmp;
     |PINTA 1518, aCen;
     |PINTA 1618, aTra;
     |ATRI 0;
|FPRC;

|PROCESO ValidaArchi;
|| no hay validacion aqui de momento
     swSigue = 1;
|FPRC;

|PROCESO ElIMPRE;
     |SI enCuadre = 02;  || a EXCEL
          FSalida = 0;
          |ACABA;
     |SINO;
          || aqui preguntamos si DsArchi si o no
          eaVengoDe = "nomirpas";

          nArchi = 0;
          |HAZ MiraSiArchiva;

          |SI nArchi ! 1;
               || no tengo dsarchi, sigo como siempre
               nOpcion = 1;
          |SINO;
               || tengo dsarchi, presento menu
               |MENU aMenu;
               nOpcion = FSalida;
               |SI FSalida = 0;
                    FSalida = -1;
                    |ACABA;
               |FINSI;
          |FINSI;

          swSigue = 1;
          |SI nOpcion ! 1;
               |HAZ ValidaArchi;
          |FINSI;
          |SI nOpcion ! 1; |Y swSigue = 0;
               |ACABA;
          |FINSI;

          |SI nOpcion = 1;
               |IMPRE 0;
          |FINSI;
          |SI nOpcion = 2;
               Impresora = "CrystalReport";
               FSalida = 0;
          |FINSI;

          |SI FSalida = 0;
               |SI Impresora = "CrystalReport";
                    informe = "nomirenm";
               |SINO;
                    informe = "nomweb02";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Impresion;
     |SI enCuadre = 02;
          |HAZ EnExcel;       || impresion en EXCEL
     |SINO;
          |PARA nEmpresa = #0#0; |SI nEmpresa [ #0#1; |HACIENDO nEmpresa = nEmpresa + 1;
               swHayDatos = 0;
               |BUCLE lee_temporal;
               |SI swHayDatos = 1;
                    |SI nOpcion = 2;
                         eaInforme = informe;
                         enDesdeMes = #0#2;
                         enAny = #0#4 + 2000;
                         |HAZ IMPREArchi;
                    |FINSI;

                    |ABRE #2;
                    |BUCLE lee_temporal;
                    |CIERRA #2;
|| xxxxxxxxxxxx
                    |SI Impresora ! "CrystalReport"; |Y nOpcion = 1;
                         eacodarea = #8#2;        || Cod Area
                         eacodsecc = #8#3;        || Cod Seccion
                         swlin = 2;
                         |HAZ puesubgrs;  |PRINT;
                         |HAZ puegrupos;  |PRINT;
                         tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;
                         |PIEINF;
                    |FINSI;
                    |SI nOpcion = 1;
                         |PIEINF;
                    |FINSI;
                    |SI nOpcion = 2;
                         |PIEINF;
                         |FININF;
                         |HAZ Mensaje;           || mensaje de envio al dsarchi
                         |HAZ Archivando;
                    |FINSI;
               |FINSI;
          |SIGUE;

          |SI nOpcion = 2;
               aAlfa = ":dsarchi/dpntz001;CLI";
               |SUB_EJECUTA aAlfa;
          |FINSI;

          |SI nOpcion = 1;
               eacodarea = #8#2;                             || Cod Area
               eacodsecc = #8#3;                             || Cod Seccion
               swlin = 2;
               |HAZ puesubgrs;  |PRINT;
               |HAZ puegrupos;  |PRINT;
               tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;
               |PIEINF;
               |FININF;
               |DELINDEX #8;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PMensual;
     |HAZ ElIMPRE;
     |SI FSalida = 0;
          fecha = #0#3;
          cabeza = cabeza_tit + p_mes;
          |HAZ centra;
          |SI enCuadre ! 02;
               |SI nOpcion = 1;
                    |HAZ ElINFOR;
               |FINSI;
          |FINSI;
          seleccio = 0;

          |DELINDEX #8;
          |ABRE #9;

          |ABRE #4;
          |ABRE #5;
          |ABRE #8;

          |BUCLE gra_temporalM;

          |CIERRA #8;
          |CIERRA #5;
          |CIERRA #4;

          |HAZ Impresion;

          |CIERRA #9;
     |SINO;
          |MENAV error0;
     |FINSI;
     |SI nOpcion = 1;
          |SI enCuadre ! 02;
               |FINIMP;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO imprime; |TIPO 3;
     aNomPag = "P";
     eaFuente = #0#8;
     enCuadre = #0#9;
     enOrdenTra = 1;
     month = #0#2;
     enTipoInf = 1;

     aCabProrr =  "   DTOS.";
     aCabProrr2 = "  VARIOS";
     |SI #0#8="H";
          cabeza_tit = "RESUMEN PAGAS MENSUAL HISTORICO - ";
          |HAZ PHistorico;
     |SINO;
          cabeza_tit = "RESUMEN PAGAS MENSUAL - ";
          |HAZ PMensual;
     |FINSI;
|FPRC;
