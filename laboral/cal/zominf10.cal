|FICHEROS;
     zominf10 #0;
     nomcalca #1;
     nomhicca;
     labtraba #2;
     labempre #3;
     labcentr #4;
|FIN;

|VARIABLES;
     fFecha = @;
     aFecha = "";
     &nMes = 0;
     &nTipo = 0;
     &nAnyHis = 0;
     aMes = "";
     nAny = 0;
     aAny = "";
     fFechaRef = @;
     &aMesLetra = "";

     nDiferencia = 0;
     topemes = 0;
     fFechaAlta = @;
     fFechaBaja = @;
     aAlfa = "";
     fIniMes = @;
     fFinMes = @;
     fFechaIniMes = @;
     fFechaFinMes = @;
     &aFechaIniMes = "";
     &aFechaFinMes = "";
     nNume1 = 0;
     nNume1_R = 0;
     nNume2 = 0;
     &nDias = 0;
     swSigue = 0;

     &aMenHis = "";
     &nTeoricoC = 0;
     &nTeoricoP = 0;
     &nComunes = 0;
     &nProf = 0;

     &grupo = 0;
     coti_0 = 0;
     nume1 = 0;
     &nHoras = 0;
     swHayAlgo = 0;
|FIN;

|PROCESO nom_mes;
|SI nMes = 1;  aMesLetra = "ENERO"; |FINSI;
|SI nMes = 2;  aMesLetra = "FEBRERO"; |FINSI;
|SI nMes = 3;  aMesLetra = "MARZO"; |FINSI;
|SI nMes = 4;  aMesLetra = "ABRIL"; |FINSI;
|SI nMes = 5;  aMesLetra = "MAYO"; |FINSI;
|SI nMes = 6;  aMesLetra = "JUNIO"; |FINSI;
|SI nMes = 7;  aMesLetra = "JULIO"; |FINSI;
|SI nMes = 8;  aMesLetra = "AGOSTO"; |FINSI;
|SI nMes = 9;  aMesLetra = "SEPTIEMBRE"; |FINSI;
|SI nMes = 10; aMesLetra = "OCTUBRE"; |FINSI;
|SI nMes = 11; aMesLetra = "NOVIEMBRE "; |FINSI;
|SI nMes = 12; aMesLetra = "DICIEMBRE "; |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;
     fFecha = ~;
     aFecha = fFecha;
     aMes = aFecha % 402;
     aAny = aFecha % -104;
     nAny = aAny;
     nMes = aMes;
     |HAZ nom_mes;
     #0#2 = nMes;
     #0#3 = nAny;
     |PINTA #0#2;
     |PINTA #0#3;
|FPRC;

|PROCESO MesLetra;
     nMes = #0#2;
     |HAZ nom_mes;
|FPRC;

|PROCESO ultidia;
     topemes = 31;
     |SI nMes = 4; |O  nMes = 6; |O  nMes = 9; |O  nMes = 11;
          topemes = 30;
     |FINSI;
     |SI nMes = 2;
          topemes = 28;
     |FINSI;
|FPRC;

|PROCESO Datos;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
|FPRC;

|PROCESO nomhicca;
     |HAZ Datos;
     nMes = #nomhicca#2;
     nTipo = #nomhicca#3;
     nAnyHis = #nomhicca#66 + 2000;
     |PRINT;
     swHayAlgo = 1;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     232;
     #labtraba#0, #labtraba#1, 16, 01, 0, "13.38.021   ";
     #labtraba#0, #labtraba#1, 17, 12, 2, "13.38.023   ";
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomcalca;
     |HAZ Datos;
     nMes = #nomcalca#2;
     nTipo = #nomcalca#3;
     nAnyHis = 0;
     |PRINT;
     swHayAlgo = 1;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     190;
     #labtraba#0, #labtraba#1, 01, 0, "13.38.021   ";
     #labtraba#0, #labtraba#1, 12, 2, "13.38.023   ";
     ;
     NULL, nomcalca;
|FIN;

|PROCESO labtraba;
     aMenHis = "MENS.";
     |BUCLE nomcalca;
     aMenHis = "HIST.";
     |BUCLE nomhicca;

/*
     swSigue = 0;
     aMenHis = "";

     nMes = #0#2;
     aMes = nMes;
     aMes = ("00" + aMes) % -102;
     aAny = #0#3;

     aFecha = "01" + "." + aMes + "." + aAny;
     fIniMes = aFecha;

     |HAZ ultidia;
     aFecha = topemes;
     aFecha = ("00" + aFecha) % -102;
     aFecha = aFecha + "." + aMes + "." + aAny;
     fFinMes = aFecha;

     grupo = #labtraba#33;
     swSigue = 0;

     #nomcalca#0 = #labtraba#0;
     #nomcalca#1 = #labtraba#1;
     #nomcalca#2 = #0#2;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          aMenHis = "MENS.";

          nComunes = #nomcalca#39 + #nomcalca#117;
          nProf = #nomcalca#40 + #nomcalca#117;

          |SI nComunes = 0;
               |ACABA;
          |FINSI;

          nume1 = (#labtraba#47 * #nomcalca#8);
          |SI 0 < nume1; |Y nume1 < 0.5;
               nume1 = 1;
          |SINO;
               nume1 = nume1 ! 0;
          |FINSI;

          |SI grupo = 01; coti_0 = 6.33 * nume1; |FINSI;
          |SI grupo = 02; coti_0 = 5.25 * nume1; |FINSI;
          |SI grupo = 03; coti_0 = 4.57 * nume1; |FINSI;
          |SI grupo ] 04; coti_0 = 4.54 * nume1; |FINSI;

          coti_0 = coti_0 ! 2;
          nTeoricoC = coti_0;
          |SI nComunes < coti_0;
               swSigue = 1;
          |FINSI;

          coti_0 = 4.54 * nume1;
          coti_0 = coti_0 ! 2;
          nTeoricoP = coti_0;

          |SI nProf < coti_0;
               swSigue = 1;
          |FINSI;
     |SINO;
          #nomhicca#0 = #labtraba#0;
          #nomhicca#1 = #labtraba#1;
          #nomhicca#66 = nAny;
          #nomhicca#2 = #0#2;
          #nomhicca#3 = 0;
          |LEE 000#nomhicca.=;
          |SI FSalida = 0;
               aMenHis = "HIST.";

               nComunes = #nomhicca#39 + #nomhicca#159;
               nProf = #nomhicca#40 + #nomhicca#159;

               |SI nComunes = 0;
                    |ACABA;
               |FINSI;

               nume1 = (#labtraba#47 * #nomhicca#8);
               |SI 0 < nume1; |Y nume1 < 0.5;
                    nume1 = 1;
               |SINO;
                    nume1 = nume1 ! 0;
               |FINSI;

               |SI grupo = 01; coti_0 = 6.33 * nume1; |FINSI;
               |SI grupo = 02; coti_0 = 5.25 * nume1; |FINSI;
               |SI grupo = 03; coti_0 = 4.57 * nume1; |FINSI;
               |SI grupo ] 04; coti_0 = 4.54 * nume1; |FINSI;

               coti_0 = coti_0 ! 2;
               nTeoricoC = coti_0;
               |SI nComunes < coti_0;
                    swSigue = 1;
               |FINSI;

               coti_0 = 4.54 * nume1;
               coti_0 = coti_0 ! 2;

               nTeoricoP = coti_0;
               |SI nProf < coti_0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          |HAZ Datos;
          |PRINT;
          swHayAlgo = 1;
     |FINSI;
*/
|FPRC;

|DEFBUCLE labtraba4;
     #labtraba#1;
     42;
     #0#0, 00001, "I";
     #0#1, 99999, "I";
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba3;
     #labtraba#1;
     42;
     #0#0, 00001, "P";
     #0#1, 99999, "P";
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba2;
     #labtraba#1;
     42;
     #0#0, 00001, "X";
     #0#1, 99999, "X";
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba1;
     #labtraba#1;
     42;
     #0#0, 00001, "T";
     #0#1, 99999, "T";
     ;
     NULL, labtraba;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     ||ENDATOS #1#0;
     |SI FSalida = 0;
          Impresora = "CrystalReport";
          |IMPRE -1;
          |INFOR "zominf10";

          nMes = #0#2;
          nAny = #0#3 - 2000;

          swHayAlgo = 0;

          |ABRE #nomcalca;
          |ABRE #nomhicca;
          |ABRE #labempre;
          |ABRE #labcentr;
          |BUCLE labtraba1;
          |BUCLE labtraba2;
          |BUCLE labtraba3;
          ||BUCLE labtraba4;  || irregulares por dias no son a TP ¨no?
          |CIERRA #labcentr;
          |CIERRA #labempre;
          |CIERRA #nomhicca;
          |CIERRA #nomcalca;

          |SI swHayAlgo = 0;
               |MENAV "    No se han encontrado trabajadores afectados ";
          |FINSI;

          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
|FPRO;
