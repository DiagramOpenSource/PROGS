|FICHEROS;
     nomatcar #0;
     nomlicoc;
     nomlicol;
     nomhicca;
     labtraba;
     nomcarli;
|FIN;

|VARIABLES;
     nConvenio = 0;
     nCategoria = 0;
     nBaseReal = 0;
     nBaseCot = 0;
     nAny = 0;
     nDiferencia = 0;
     aMensaje = "";
     swMensaje = 0;
     FEstado = 0;
|FIN;

|PROCESO GeneraAtraso;
     #nomlicoc#0 = #nomhicca#0;
     #nomlicoc#1 = #nomhicca#66 + 2000;
     #nomlicoc#2 = #nomhicca#2;
     |LEE 101#nomlicoc.=;
     |SI FSalida ! 0;
          |GRABA 020#nomlicoc.n;
     |FINSI;

     #nomlicol#0 = #nomhicca#0;
     #nomlicol#1 = #nomhicca#66 + 2000;
     #nomlicol#2 = #nomhicca#2;
     #nomlicol#3 = #nomhicca#1;
     |LEE 101#nomlicol.=;
     FEstado = FSalida;

     |SI FEstado = 0; |Y swMensaje = 0;
          aMensaje = "    ATENCION: se han encontrado datos de atrasos en el mantenimiento. ";
          aMensaje = aMensaje + "Si continua, se sobreescribiran.";
          |MENAV aMensaje;
          aMensaje = "    SDesea continuar?";
          |CONFI aMensaje;
          |SI FSalida = 0;
               swMensaje = 1;
          |SINO;
               swMensaje = 2;
          |FINSI;
     |FINSI;

     |SI swMensaje = 0; |O swMensaje = 1;
          #nomlicol#4 = #labtraba#2;
          #nomlicol#5 = #nomhicca#8;    || dias cotizados
          #nomlicol#10 = #nomhicca#55;  || dias efectivos
          #nomlicol#11 = #nomhicca#132; || dias laborables IT
          #nomlicol#6 = nDiferencia;    || base diaria que cotiza (diferencia)
          #nomlicol#8 = #nomlicol#5 * #nomlicol#6;     || total cotizacion mes
          #nomlicol#12 = 1; || tipo 1 (atrasos regimen del carbon)
          |SI FEstado = 0;
               |GRABA 020#nomlicol.a;
          |SINO;
               |GRABA 020#nomlicol.n;
          |FINSI;
          |LIBERA #nomlicol;
     |FINSI;
|FPRC;

|PROCESO nomhicca;
     nBaseCot = #nomhicca#56;
     nDiferencia = nBaseReal - nBaseCot;
     |SI nDiferencia ! 0;
          |HAZ GeneraAtraso;
     |FINSI;
     |SI swMensaje = 2;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #labtraba#0, #labtraba#1, nAny, #0#5, 0;
     #labtraba#0, #labtraba#1, nAny, #0#6, 0;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO labtraba;
     nConvenio = #labtraba#87;
     nCategoria = #labtraba#17;

     #nomcarli#0 = nConvenio;
     #nomcarli#1 = nCategoria;
     |LEE 000#nomcarli.=;
     |SI FSalida = 0;
          nBaseReal = #nomcarli#3;
          nAny = #0#4 - 2000;
          |BUCLE nomhicca;
     |FINSI;
     |SI swMensaje = 2;
          |MENAV "    Proceso Cancelado";
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     247;
     #0#0, #0#2, 911;
     #0#1, #0#3, 911;
     ;
     NULL, labtraba;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;

     swMensaje = 0;
     |ABRE #nomcarli;
     |ABRE #nomlicoc;
     |ABRE #nomlicol;
     |BUCLE labtraba;
     |CIERRA #nomlicol;
     |CIERRA #nomlicoc;
     |CIERRA #nomcarli;
|FPRO;
