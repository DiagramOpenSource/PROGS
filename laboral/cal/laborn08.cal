|FICHEROS;
     laborn08;           || este def el del lineal
     nomvarca;
     nomvarli;
     nomcontr;

     labtraba;
     nompmail;
     labornx8;
|FIN;

|VARIABLES;
     &eaDirDest  = "";
     &eaAsunto   = "";
     &eaTexto    = "";
     &eaFichero  = "";

     &aParam = "";
     &eaUsuario = "";
     &eaFecha = "";
     &efFecha = @;
     &eaHora = "";
     aTipo = "";
     sw = 0;
     aAlfa  = "";
     aAlfa1 = "";
     aAlfa2 = "";
     FEstado = 0;
     nMes = 0;
     aUsuarioD = "";
     aUsuarioH = "";
     &nEmpExt = 0;
     &nTraExt = 0;
     &eaVengoDe = "laborn08";
     &eaEmpresa = "";
     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nMesAUTO = 0;
     &nAnyAUTO = 0;
     &nTipAUTO = 0;
     &aFechaBaja = "";
     &fFechaBaja = @;
     &nCausaBaja = 0;
     &aCausaBaja = "";
     &aTipoContr = "";
     nNume = 0;
     aSiEsX = "";

     &eaParam       = "";
     &enFSalida     = 0;
     &enBorrado     = 0;
     &eaEstado      = "";
     &eaMotiv       = "";
     &enActualizado = 0;

     &enEmpresa = 0;
     &enTrabajador = 0;
     &enDiasVac = 0;
     nCampo = 0;
|FIN;

|PROCESO nomvarca;
     aAlfa = #laborn08#8;
     aAlfa = aAlfa % 402;
     nMes = aAlfa;

     |ABRE #nomvarca;
     #nomvarca#0 = #laborn08#5;
     #nomvarca#1 = #laborn08#6;
     #nomvarca#2 = nMes;
     #nomvarca#3 = 0;
     |LEE 101#nomvarca.=;
     FEstado = FSalida;

     #nomvarca#16 = #laborn08#8;
     #nomvarca#46 = #laborn08#9;

     |SI FEstado ! 0;
          |GRABA 020#nomvarca.n;
     |SINO;
          |GRABA 020#nomvarca.a;
     |FINSI;
     |LIBERA #nomvarca;
     |CIERRA #nomvarca;
|FPRC;

|PROCESO nomvarli;
     aAlfa = #laborn08#8;
     aAlfa = aAlfa % 402;
     nMes = aAlfa;

     |ABRE #nomcontr;
     |LEE 000#nomcontr.p;
     |CIERRA #nomcontr;

     |ABRE #nomvarli;

     |SI #laborn08#13 ! 0;
          #nomvarli#0 = #laborn08#5;
          #nomvarli#1 = #laborn08#6;
          #nomvarli#2 = nMes;
          #nomvarli#3 = 0;
          #nomvarli#4 = 125;
          |LEE 000#nomvarli.=;
          FEstado = FSalida;

          aAlfa = #laborn08#13;
          aAlfa = ("          " + aAlfa) % -110;
          #nomvarli#5 = aAlfa;
          |SI FEstado ! 0;
               |GRABA 020#nomvarli.n;
          |SINO;
               |GRABA 020#nomvarli.a;
          |FINSI;
          |LIBERA #nomvarli;
     |FINSI;

     |SI #laborn08#14 ! 0;
          #nomvarli#0 = #laborn08#5;
          #nomvarli#1 = #laborn08#6;
          #nomvarli#2 = nMes;
          #nomvarli#3 = 0;
          |SI #nomcontr#13 = "S";
               #nomvarli#4 = 410;
          |SINO;
               #nomvarli#4 = 415;
          |FINSI;
          |LEE 000#nomvarli.=;
          FEstado = FSalida;

          #nomvarli#5 = "         1";
          aAlfa = #laborn08#14;
          aAlfa = ("            " + aAlfa) % -112;
          #nomvarli#6 = aAlfa;
          |SI FEstado ! 0;
               |GRABA 020#nomvarli.n;
          |SINO;
               |GRABA 020#nomvarli.a;
          |FINSI;
          |LIBERA #nomvarli;
     |FINSI;

     |SI #laborn08#17 ! 0;
          #nomvarli#0 = #laborn08#5;
          #nomvarli#1 = #laborn08#6;
          #nomvarli#2 = nMes;
          #nomvarli#3 = 0;
          #nomvarli#4 = 903;
          |LEE 000#nomvarli.=;
          FEstado = FSalida;

          aAlfa = #laborn08#17;
          aAlfa = ("          " + aAlfa) % -110;
          #nomvarli#5 = aAlfa;
          #nomvarli#6 = "Jornadas";
          |SI FEstado ! 0;
               |GRABA 020#nomvarli.n;
          |SINO;
               |GRABA 020#nomvarli.a;
          |FINSI;
          |LIBERA #nomvarli;
     |FINSI;

     |SI #laborn08#18 ! 0;
          #nomvarli#0 = #laborn08#5;
          #nomvarli#1 = #laborn08#6;
          #nomvarli#2 = nMes;
          #nomvarli#3 = 0;
          #nomvarli#4 = 922;
          |LEE 000#nomvarli.=;
          FEstado = FSalida;

          aAlfa = #laborn08#18;
          aAlfa = ("          " + aAlfa) % -110;
          #nomvarli#5 = aAlfa;
          #nomvarli#6 = "Jornadas IT";
          |SI FEstado ! 0;
               |GRABA 020#nomvarli.n;
          |SINO;
               |GRABA 020#nomvarli.a;
          |FINSI;
          |LIBERA #nomvarli;
     |FINSI;

     |CIERRA #nomvarli;
|FPRC;

|PROCESO Email;
     || Emite correo electronico al usuario de que la baja del trabajador
     ||    se ha hecho efectiva
     aAlfa = ("00000" + #laborn08#6) % -105;
     eaTexto = &13 + &10 + "El administrador ha hecho efectiva la correcci¢n del trabajador (" + aAlfa + ") " + #laborn08#9; |QBF eaTexto;
     aAlfa = ("00000" + #laborn08#5) % -106;
     eaTexto = eaTexto + " de la empresa (" + aAlfa + ") " + #laborn08#8; |QBF eaTexto;

     eaTexto = eaTexto + &13 + &10 + &13 + &10;
     eaTexto = eaTexto + " Actualizacion con fecha " + #laborn08#3 + " a las " + #laborn08#4 + &13 + &10;

     aAlfa  = ("00000" + #laborn08#5) % -106;
     aAlfa1 = ("00000" + #laborn08#6) % -105;
     eaAsunto  = "Efectivo correcci¢n trabajador (" + aAlfa + "/" + aAlfa1 + ") " + #laborn08#9; |QBF eaAsunto;
     eaFichero = "";
     eaDirDest = "";

     aAlfa = #laborn08#5; |QBF aAlfa;
     eaEmpresa = ("00000" + aAlfa) % -105;
     |HAZ ConsEmail2;
|FPRC;

|PROCESO Actualiza;
     aAlfa = "    ATENCION: se marcará la correción seleccionada como ACTUALIZADA";
     |MENAV aAlfa;
     aAlfa = "    S¿Desea continuar?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          || primero me paso todos los campos del registro que voy a borrar
          || a un temporal, ya que ha habido varios fallos en los que al
          || borrar el registro pierde la clave, asi me aseguro

          |DDEFECTO #labornx8;
          |PARA nCampo = 0; |SI nCampo [ 29; |HACIENDO nCampo = nCampo + 1;
               #labornx8#nCampo# = #laborn08#nCampo#;
          |SIGUE;

          |BORRA 020#laborn08.a;

          |PARA nCampo = 0; |SI nCampo [ 29; |HACIENDO nCampo = nCampo + 1;
               #laborn08#nCampo# = #labornx8#nCampo#;
          |SIGUE;

          #laborn08#0 = "A";
          #laborn08#26 = Usuario % 0810;
          #laborn08#27 = ~;
          |HORA aAlfa;
          #laborn08#28 = aAlfa;
          |GRABA 020#laborn08.n;

          ||aAlfa = "    Se han realizado los procesos asociados a la baja.";
          || MENAV aAlfa;

          enEmpresa = #labtraba#0;
          enTrabajador = #labtraba#1;
          |HAZ ActualizaLabornet;

          enActualizado = 1;

          |ABRE #nompmail; |LEE 000#nompmail.p; |CIERRA #nompmail;
          |SI #nompmail#11 = "S";
               |HAZ Email;
          |FINSI;
     |FINSI;
     |PONCONTROL 23, "SI";
     |PTEC 808;
|FPRC;

|PROCESO Consulta;
     eaUsuario = #laborn08#1;      || permito modificar
     eaFecha = #laborn08#3;
     eaHora = #laborn08#4;
     |SUB_EJECUTA "laborn18;CONSUL";
     |ACABA;
|FPRC;

|PROCESO Modificacion;
     eaUsuario = #laborn08#1;      || permito modificar
     eaFecha = #laborn08#3;
     eaHora = #laborn08#4;
     |SUB_EJECUTA "laborn18;MODIF";
     |ACABA;
|FPRC;

|PROCESO Opciones; |TIPO 0;
     |SI enFSalida ! 0;
          FSalida = enFSalida;
     |FINSI;

     || consulta de datos introducidos
     |SI FSalida = 10;
          |SI aParam = "USUARIO"; |O aParam = "ADMIN";  || consulta el usuario los datos que
               |HAZ Modificacion;
          |FINSI;
          |SI aParam = "HISTO"; |O aParam = "HISTOUSU";
               |HAZ Consulta;           || consulta de datos introducidos
          |FINSI;                       || o ya actualizados, solo visualizar
          |ACABA;
     |FINSI;

     |SI FSalida = 11;  |Y #laborn08#0 = "P"; |Y aParam = "ADMIN";
          |HAZ Modificacion;
          |LEE 000#laborn08.=;
          |HAZ Actualiza;
          |ACABA;
     |FINSI;

     |SI FSalida = 12;  |Y #laborn08#0 = "P";
          enBorrado = 1;
          |CONFI "0000N¿Está seguro de que desea rechazar esta solicitud?";
          |SI FSalida ! 0;
               enBorrado = 0;
               |ERROR;
               |ACABA;
          |FINSI;

          |LEE 101#laborn08.=;
          |BORRA 020#laborn08.a;
          |LIBERA #laborn08;

          #laborn08#0  = "R";
          #laborn08#30 = eaMotiv;

          |GRABA 020#laborn08.n;
          |LIBERA #laborn08;
     |FINSI;
|FPRC;

|PROCESO RecogeCampos;
     #laborn08#1 = eaUsuario;
     #laborn08#3 = efFecha;
     #laborn08#4 = eaHora;
     #laborn08#0 = eaEstado;
|FPRC;

|PROGRAMA;
     |SI enFSalida ! 12;
          |CLS;
     |FINSI;
     |CABEZA "Correccion";

     aAlfa = Usuario % 0810;

     |ABRE #laborn08;
     |SI aParam = "ADMIN"; |O aParam = "USUARIO";
          aTipo = "P";   || los pendientes de actualizar
          |HAZ RecogeCampos;
          |HAZ Opciones;
     |FINSI;
     |SI aParam = "HISTO"; |O aParam = "HISTOUSU";
          aTipo = "A";   || consulta del historico, los ya actualizados
          |HAZ RecogeCampos;
          |LEE 000#laborn08.=;
          |HAZ Opciones;
     |FINSI;
     |CIERRA #laborn08;
|FPRO;

|PROCESO Tipo80n08;  |TIPO 80;
     |SI PARAMETRO = "";  |ACABA;  |FINSI;

     aSiEsX = PARAMETRO % 101;
     |SI aSiEsX = "X";
         aAlfa     = PARAMETRO % 202;   enFSalida = aAlfa;
         eaEstado  = PARAMETRO % 401;
         eaUsuario = PARAMETRO % 510;
         aAlfa     = PARAMETRO % 1510;  efFecha = aAlfa;
         eaHora    = PARAMETRO % 2508;
         eaParam   = PARAMETRO % 3310;  |QBF eaParam;
         aParam    = eaParam;
     |SINO;
          aParam = PARAMETRO;  |QBF aParam;
          |SI eaParam ! "";
              eaParam = aParam;
          |FINSI;
     |FINSI;
|FPRC;
