|FICHEROS;
     sempretr #0;
     labempre #1;        || empresas
     labtraba #2;        || trabajadores
     semcalcb #3;        || calculos semanal cabs.
     semcalcl #4;        || calculos semanal lins.
     semconce #5;        || control conceptos
     semequiv #7;        || equivalencia
     nomcalca #8;        || calculos cabs.
     nomficmo #9;        || desglose moneda
     semtraba #10;       || datos semana
     semetiqu #11;       || impresion etiquetas
     semempre #12;       || control empresas
     semtrati #13;       || titulos transferencias
     nomhicca #14;       || historico calculos cabs.
     nomrevca #100;
     nomrevli #101;
     nomgrubl #102;
     semcntcu;
     labtracu;
|FIN;

|VARIABLES;
     informe = "";

     sdia = 0;
     smas = 0;
     sdife = 0;
     srest = 0;

     alfa1 = "";
     alfa2 = "";
     fech1 = @;
     fech2 = @;
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;

     &Fech11 = "";
     &Fech12 = "";
     &Fech21 = "";
     &Fech22 = "";
     aGuardaFech11 = "";
     aGuardaFech12 = "";
     aGuardaFech21 = "";
     aGuardaFech22 = "";
     &Cod = "";
     &Nom = "";

     Semana = 0;
     Mes  = 0;
     Mes1 = 0;
     Mes2 = 0;
     MesAlfa = "";
     Year = 0;
     Comodin = "";
     Cont = 0;
     DTipo = 0;
     HTipo = 0;

     SwError = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nPara1 = 0;
     nPara2 = 0;
     nPara3 = 0;
     nSwNoVale = 0;
     nSeleccio = 0;
     nLiquidoMes = 0;
     &enEmpre = 0;
     &enTraba = 0;
     &enAnyo = 0;
     &enSemana = 0;
     &enTipo = 0;
     &enSBa = 0;
     &enEsp = 0;

          || acumuladores para la comprobacion
     &nC06 = 0;
     &nC08 = 0;
     &nC10 = 0;
     &nC11 = 0;
     &nC12 = 0;
     &nC13 = 0;
     &nC14 = 0;
     &nC15 = 0;
     &nC16 = 0;
     &nC17 = 0;
     &nC18 = 0;
     &nC19 = 0;
     &nV06 = 0;
     &nV08 = 0;
     &nV10 = 0;
     &nV11 = 0;
     &nV12 = 0;
     &nV13 = 0;
     &nV14 = 0;
     &nV15 = 0;
     &nV16 = 0;
     &nV17 = 0;
     &nV18 = 0;
     &nV19 = 0;

          || acumuladores para desglose de efectivos
     &nM01 = 0;
     &nM02 = 0;
     &nM03 = 0;
     &nM04 = 0;
     &nM05 = 0;
     &nM06 = 0;
     &nM07 = 0;
     &nM08 = 0;
     &nM09 = 0;
     &nM10 = 0;
     &nM11 = 0;
     &nM12 = 0;
     &nM13 = 0;
     &nM14 = 0;
     &nM15 = 0;
     &nM16 = 0;
     &nM17 = 0;
     &nM18 = 0;
     &nM19 = 0;
     &nM20 = 0;
     &nT01 = 0;
     &nT02 = 0;
     &nT03 = 0;
     &nT04 = 0;
     &nT05 = 0;
     &nT06 = 0;
     &nT07 = 0;
     &nT08 = 0;
     &nT09 = 0;
     &nT10 = 0;
     &nT11 = 0;
     &nT12 = 0;
     &nT13 = 0;
     &nT14 = 0;
     &nT15 = 0;
     &nT16 = 0;
     &nT17 = 0;
     &nT18 = 0;
     &nT19 = 0;
     &nT20 = 0;

          || acumuladores para resumen
     &nTA = 0;
     &nTB = 0;
     &nTC = 0;
     &nTD = 0;
     &nTE = 0;
     &nTF = 0;
     &nTG = 0;
     &nTH = 0;
     &nTX = 0;
     &nTI = 0;
     &nTS = 0;
     &nPA = 0;
     &nPB = 0;
     &nPC = 0;
     &nPD = 0;
     &nPE = 0;
     &nPF = 0;
     &nPG = 0;
     &nPH = 0;
     &nPX = 0;
     nSwMismaSemana = 0;
     nViernes = 0;
     fFech1 = @;
     fFech2 = @;
     fFech3 = @;
     fFech4 = @;
     nFinMes = 0;
     nLiquido = 0;
     Linea = 0;
     nCuantos = 0;
     nEsta = 0;
|FIN;
____________________________________/
|PROCESO sel_banco; |TIPO 0;
|SI #0#85 = "G";
    |CAMPO_MODIFICA #0#83, 1, "N";
    |CAMPO_MODIFICA #0#84, 1, "N";
    |CAMPO_MODIFICA #0#86, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#83, 1, "S";
    |CAMPO_MODIFICA #0#84, 1, "S";
    |CAMPO_MODIFICA #0#86, 1, "N";
|FINSI;
|FPRC;
____________________________________/
|PROCESO LiquidoHistorico;
     |ABRE #nomhicca;
     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = #0#0 $ 100;
     #nomhicca#2 = Mes1;
     #nomhicca#3 = 0;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          nLiquidoMes = #nomhicca#46 - (#nomhicca#48 + #nomhicca#49 + #nomhicca#50 + #nomhicca#51 + #nomhicca#52 + #nomhicca#53 + #nomhicca#54 + #nomhicca#114);
     |SINO;
          #sempretr#55 = 0;
          aAlfa1 = "0000[" + #nomhicca#0 + "." + #nomhicca#1 + "] sin mes [" + #nomhicca#2 + "] calculado.";
          |MENAV aAlfa1;
     |FINSI;
     |CIERRA #nomhicca;
|FPRC;

|PROCESO LiquidoMes;
     nLiquidoMes = 0;

     |SI #semequiv#4 = "M";
          |ACABA;
     |FINSI;

     |ABRE #nomcalca;
     #nomcalca#0 = #labtraba#0;
     #nomcalca#1 = #labtraba#1;
     #nomcalca#2 = Mes1;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          nLiquidoMes = #nomcalca#46 - (#nomcalca#48 + #nomcalca#49 + #nomcalca#50 + #nomcalca#51 + #nomcalca#52 + #nomcalca#53 + #nomcalca#54 + #nomcalca#75);
     |SINO;
          |HAZ LiquidoHistorico;
     |FINSI;
     |CIERRA #nomcalca;
|FPRC;

|PROCESO CalculoLin_D;
     #semconce#0 = #semcalcl#6;
     |LEE 000#semconce.=;
     |SI FSalida = 0;
          SwError = 1;

          |SI #semconce#5 = 2;|Y #sempretr#7 = 0; #sempretr#7 = #semcalcl#9; |FINSI;
          |SI #semconce#5 = 3;|Y #sempretr#9 = 0; #sempretr#9 = #semcalcl#9; |FINSI;

          |SI #semequiv#4 = "M";|Y Semana = 2;
               nSwMismaSemana = 1;      || en los mensuales no se parten
               Semana = 1;              ||/los importes
          |FINSI;

          |SI Semana = 1;
               |SI #semconce#5 = 1;     #sempretr#6  = #sempretr#6  + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 2;     #sempretr#8  = #sempretr#8  + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 3;     #sempretr#10 = #sempretr#10 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 4;     #sempretr#11 = #sempretr#11 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 5;     #sempretr#12 = #sempretr#12 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 6;     #sempretr#13 = #sempretr#13 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 7;     #sempretr#14 = #sempretr#14 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 8;     #sempretr#15 = #sempretr#15 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 9;     #sempretr#16 = #sempretr#16 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 10;    #sempretr#17 = #sempretr#17 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 11;    #sempretr#18 = #sempretr#18 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 12;    #sempretr#19 = #sempretr#19 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI Semana = 2;
               |SI #semconce#5 = 1;     #sempretr#25 = #sempretr#25 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 2;     #sempretr#26 = #sempretr#26 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 3;     #sempretr#27 = #sempretr#27 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 4;     #sempretr#28 = #sempretr#28 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 5;     #sempretr#29 = #sempretr#29 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 6;     #sempretr#30 = #sempretr#30 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 7;     #sempretr#31 = #sempretr#31 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 8;     #sempretr#32 = #sempretr#32 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 9;     #sempretr#33 = #sempretr#33 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 10;    #sempretr#34 = #sempretr#34 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 11;    #sempretr#35 = #sempretr#35 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 12;    #sempretr#36 = #sempretr#36 + #semcalcl#11; |FINSI;
          |FINSI;

          |SI nSwMismaSemana = 1;
               nSwMismaSemana = 0;
               Semana = 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalculoLin;
     |HAZ CalculoLin_D;       || como el RESUMEN
|FPRC;

|PROCESO Calculos;
     |SI #semcalcb#10 = 0;    |ACABA;   |FINSI;

     |SI nSwNoVale = 1;       || tipo X
          |SI #semcalcb#5 = 0;          || blanco
               |SI nFinMes = 0;         || cambio mes
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |BUCLELIN 2CalculoLin#semcalcb;

     |SI #semequiv#4 = "M";|Y Semana = 2;
          nSwMismaSemana = 1;      || en los mensuales no se parten
          Semana = 1;              ||/los importes en recibos
     |FINSI;

     |SI Semana = 1;
          #sempretr#20 = #sempretr#6  + #sempretr#8  + #sempretr#10 + #sempretr#11;
          #sempretr#20 = #sempretr#20 + #sempretr#12 + #sempretr#13 + #sempretr#14;
          #sempretr#20 = #sempretr#20 + #sempretr#15 + #sempretr#16 + #sempretr#17;
          #sempretr#20 = #sempretr#20 + #sempretr#18 + #sempretr#19;
          || total devengado

          #sempretr#21 = #semcalcb#7;       || cuota s.s.
          #sempretr#22 = #labtraba#30;      || (%)irpf
          #sempretr#23 = #semcalcb#8;       || cuota irpf
          #sempretr#44 = #semcalcb#20;      || anticipos
          #sempretr#24 = #sempretr#21 + #sempretr#23 + #sempretr#44;  || total deducciones

          |SI nSwMismaSemana = 1;
               nNume1 = nPA * -1;
               nTA = nTA + nNume1;
               nTB = nTB - nPB;
               nTC = nTC - nPC;
               nTD = nTD - nPD;
               nTE = nTE - nPE;
               nTF = nTF - nPF;
               nTG = nTG - nPG;
               nTH = nTH - nPH;
               nTX = nTX - nPX;
          |FINSI;

          nTA = nTA + #sempretr#6 + #sempretr#8 + #sempretr#10;  || sb.+ant.+ben.
          nTB = nTB + #sempretr#11;                              || noct.
          nTC = nTC + #sempretr#12;                              || reten.
          nTD = nTD + #sempretr#13;                              || incen.
          nTE = nTE + #sempretr#14;                              || p.conv.
          nTF = nTF + #sempretr#15;                              || h.1
          nTG = nTG + #sempretr#16;                              || h.2
          nTH = nTH + #sempretr#17 + #sempretr#18 + #sempretr#19;|| espec.
          nTX = nTX + #sempretr#20;   || total devengado
          nTS = nTS + #sempretr#21;   || total seg.social
          nTI = nTI + #sempretr#23;   || total irpf
     |FINSI;

     |SI Semana = 2;
          #sempretr#37 = #sempretr#25 + #sempretr#26 + #sempretr#27 + #sempretr#28;
          #sempretr#37 = #sempretr#37 + #sempretr#29 + #sempretr#30 + #sempretr#31;
          #sempretr#37 = #sempretr#37 + #sempretr#32 + #sempretr#33 + #sempretr#34;
          #sempretr#37 = #sempretr#37 + #sempretr#35 + #sempretr#36;
          || total devengado

          #sempretr#38 = #semcalcb#7;       || cuota s.s.
          #sempretr#39 = #semcalcb#8;       || cuota irpf
          #sempretr#40 = #sempretr#38 + #sempretr#39;      || total deducciones

          nTA = nTA + #sempretr#25 + #sempretr#26 + #sempretr#27;|| sb.+ant.+ben.
          nTB = nTB + #sempretr#28;                              || noct.
          nTC = nTC + #sempretr#29;                              || reten.
          nTD = nTD + #sempretr#30;                              || incen.
          nTE = nTE + #sempretr#31;                              || p.conv.
          nTF = nTF + #sempretr#32;                              || h.1
          nTG = nTG + #sempretr#33;                              || h.2
          nTH = nTH + #sempretr#34 + #sempretr#35 + #sempretr#36;|| espec.
          nTX = nTX + #sempretr#37;   || total devengado
          nTS = nTS + #sempretr#38;   || total seg.social
          nTI = nTI + #sempretr#39;   || total irpf
     |FINSI;

     |SI nSwMismaSemana = 1;
          nSwMismaSemana = 0;
          Semana = 2;
     |FINSI;

     nPA = #sempretr#6 + #sempretr#8 + #sempretr#10 + #sempretr#25 + #sempretr#26 + #sempretr#27;   || sb.+ant.+ben.
     nPB = #sempretr#11 + #sempretr#28;                     || noct.
     nPC = #sempretr#12 + #sempretr#29;                     || reten.
     nPD = #sempretr#13 + #sempretr#30;                     || incen.
     nPE = #sempretr#14 + #sempretr#31;                     || p.conv.
     nPF = #sempretr#15 + #sempretr#32;                     || h.1
     nPG = #sempretr#16 + #sempretr#33;                     || h.2
     nPH = #sempretr#17 + #sempretr#18 + #sempretr#19 + #sempretr#34 + #sempretr#35 + #sempretr#36; || espec.
     nPX = #sempretr#20 + #sempretr#37;                     || total devengado

     || liquido
     #sempretr#41 = (#sempretr#20 - #sempretr#24) + (#sempretr#37 - #sempretr#40);

     |SI #semcalcb#5 ! 1;     || en los de negro no hay proceso fin de mes
          |SI nFinMes = 1;                        || fin de mes con dos semanas
               |SI Semana = 1;
                    #sempretr#45 = #semcalcb#21;
                    #sempretr#46 = #semcalcb#22;
                    #sempretr#47 = #semcalcb#23;
                    #sempretr#48 = #semcalcb#24;
                    #sempretr#49 = #semcalcb#25;
                    #sempretr#50 = #semcalcb#11;
                    #sempretr#51 = #semcalcb#12;
                    #sempretr#52 = #semcalcb#13;
                    #sempretr#53 = #semcalcb#14;
                    #sempretr#54 = #semcalcb#15;
                    #sempretr#55 = #sempretr#50 + #sempretr#51 + #sempretr#52 + #sempretr#53 + #sempretr#54 + (#sempretr#20 - #sempretr#24);
               |FINSI;
               |SI Semana = 2;
                    |SI #semequiv#4 = "M";
                         || en los mensuales la semana2 partida forma parte de la primera
                         #sempretr#55 = #sempretr#50 + #sempretr#51 + #sempretr#52 + #sempretr#53 + #sempretr#54 + (#sempretr#20 - #sempretr#24);
                    |FINSI;
                    |HAZ LiquidoMes;
                    #sempretr#56 = nLiquidoMes;
                    |SI Mes1 = 1;  #sempretr#57 = "ENERO.....";  |FINSI;
                    |SI Mes1 = 2;  #sempretr#57 = "FEBRERO...";  |FINSI;
                    |SI Mes1 = 3;  #sempretr#57 = "MARZO.....";  |FINSI;
                    |SI Mes1 = 4;  #sempretr#57 = "ABRIL.....";  |FINSI;
                    |SI Mes1 = 5;  #sempretr#57 = "MAYO......";  |FINSI;
                    |SI Mes1 = 6;  #sempretr#57 = "JUNIO.....";  |FINSI;
                    |SI Mes1 = 7;  #sempretr#57 = "JULIO.....";  |FINSI;
                    |SI Mes1 = 8;  #sempretr#57 = "AGOSTO....";  |FINSI;
                    |SI Mes1 = 9;  #sempretr#57 = "SEPTIEMBRE";  |FINSI;
                    |SI Mes1 =10;  #sempretr#57 = "OCTUBRE...";  |FINSI;
                    |SI Mes1 =11;  #sempretr#57 = "NOVIEMBRE.";  |FINSI;
                    |SI Mes1 =12;  #sempretr#57 = "DICIEMBRE.";  |FINSI;
                    #sempretr#58 = #sempretr#41 - (#sempretr#55 - #sempretr#56);
               |FINSI;
          |FINSI;

          |SI nFinMes = 2;              || fin de mes con una semana
               |SI Semana = 1;
                    #sempretr#45 = #semcalcb#21;
                    #sempretr#46 = #semcalcb#22;
                    #sempretr#47 = #semcalcb#23;
                    #sempretr#48 = #semcalcb#24;
                    #sempretr#49 = #semcalcb#25;
                    #sempretr#50 = #semcalcb#11;
                    #sempretr#51 = #semcalcb#12;
                    #sempretr#52 = #semcalcb#13;
                    #sempretr#53 = #semcalcb#14;
                    #sempretr#54 = #semcalcb#15;
                    #sempretr#55 = #sempretr#50 + #sempretr#51 + #sempretr#52 + #sempretr#53 + #sempretr#54 + (#sempretr#20 - #sempretr#24);

                    |SI #semequiv#4 = "M";
                         || en los mensuales la semana2 partida forma parte de la primera
                         #sempretr#55 = #sempretr#50 + #sempretr#51 + #sempretr#52 + #sempretr#53 + #sempretr#54 + (#sempretr#20 - #sempretr#24);
                    |FINSI;
                    |HAZ LiquidoMes;
                    #sempretr#56 = nLiquidoMes;
                    |SI Mes1 = 1;  #sempretr#57 = "ENERO.....";  |FINSI;
                    |SI Mes1 = 2;  #sempretr#57 = "FEBRERO...";  |FINSI;
                    |SI Mes1 = 3;  #sempretr#57 = "MARZO.....";  |FINSI;
                    |SI Mes1 = 4;  #sempretr#57 = "ABRIL.....";  |FINSI;
                    |SI Mes1 = 5;  #sempretr#57 = "MAYO......";  |FINSI;
                    |SI Mes1 = 6;  #sempretr#57 = "JUNIO.....";  |FINSI;
                    |SI Mes1 = 7;  #sempretr#57 = "JULIO.....";  |FINSI;
                    |SI Mes1 = 8;  #sempretr#57 = "AGOSTO....";  |FINSI;
                    |SI Mes1 = 9;  #sempretr#57 = "SEPTIEMBRE";  |FINSI;
                    |SI Mes1 =10;  #sempretr#57 = "OCTUBRE...";  |FINSI;
                    |SI Mes1 =11;  #sempretr#57 = "NOVIEMBRE.";  |FINSI;
                    |SI Mes1 =12;  #sempretr#57 = "DICIEMBRE.";  |FINSI;
                    #sempretr#58 = #sempretr#41 - (#sempretr#55 - #sempretr#56);
               |FINSI;
          |FINSI;

          |SI #semequiv#4 = "X";|Y nFinMes ! 0;
               nNume1 = (#sempretr#6 + #sempretr#8 + #sempretr#10) * -1;
               nTA = nTA + nNume1;                                    || sb.+ant.+ben.
               nTB = nTB - #sempretr#11;                              || noct.
               nTC = nTC - #sempretr#12;                              || reten.
               nTD = nTD - #sempretr#13;                              || incen.
               nTE = nTE - #sempretr#14;                              || p.conv.
               nTF = nTF - #sempretr#15;                              || h.1
               nTG = nTG - #sempretr#16;                              || h.2
               nTH = nTH - (#sempretr#17 + #sempretr#18 + #sempretr#19);|| espec.
               nTX = nTX - #sempretr#20;   || total devengado
               nTS = nTS - #sempretr#21;   || total seg.social
               nTI = nTI - #sempretr#23;   || total irpf

               nNume1 = (#sempretr#25 + #sempretr#26 + #sempretr#27) * -1;
               nTA = nTA + nNume1;                                    || sb.+ant.+ben.
               nTB = nTB - #sempretr#28;                              || noct.
               nTC = nTC - #sempretr#29;                              || reten.
               nTD = nTD - #sempretr#30;                              || incen.
               nTE = nTE - #sempretr#31;                              || p.conv.
               nTF = nTF - #sempretr#32;                              || h.1
               nTG = nTG - #sempretr#33;                              || h.2
               nTH = nTH - (#sempretr#34 + #sempretr#35 + #sempretr#36);|| espec.
               nTX = nTX - #sempretr#37;   || total devengado
               nTS = nTS - #sempretr#38;   || total seg.social
               nTI = nTI - #sempretr#39;   || total irpf

               |PDEFECTO #sempretr, 6, 42;
               |PDEFECTO #sempretr, 44, 56;
               #sempretr#58 = #sempretr#56;
               nPA = 0;
               nPB = 0;
               nPC = 0;
               nPD = 0;
               nPE = 0;
               nPF = 0;
               nPG = 0;
               nPH = 0;
               nPX = #sempretr#58;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Calculos;
     #semcalcb#1;
     ;
     #sempretr#0, #sempretr#1, Mes, #labtraba#0, #labtraba#1, DTipo;
     #sempretr#0, #sempretr#1, Mes, #labtraba#0, #labtraba#1, HTipo;
     ;
     NULL,Calculos;
|FIN;

|PROCESO Inicializa;
     |PDEFECTO #sempretr, 6, 42;
     SwError = 0;
     nC06 = 0;
     nC08 = 0;
     nC10 = 0;
     nC11 = 0;
     nC12 = 0;
     nC13 = 0;
     nC14 = 0;
     nC15 = 0;
     nC16 = 0;
     nC17 = 0;
     nC18 = 0;
     nC19 = 0;
     nV06 = 0;
     nV08 = 0;
     nV10 = 0;
     nV11 = 0;
     nV12 = 0;
     nV13 = 0;
     nV14 = 0;
     nV15 = 0;
     nV16 = 0;
     nV17 = 0;
     nV18 = 0;
     nV19 = 0;
     Fech11 = aGuardaFech11;
     Fech12 = aGuardaFech12;
     Fech21 = aGuardaFech21;
     Fech22 = aGuardaFech22;
     |SI #semequiv#4 = "M";
          Fech21 = "";
          Fech22 = "";
     |FINSI;
     |SI #semequiv#4 = "X";
          Fech11 = "";
          Fech12 = "";
          Fech21 = "";
          Fech22 = "";
     |FINSI;
|FPRC;

|PROCESO CodigoEquivalente;
     nSwNoVale = 0;

     |DDEFECTO #semequiv;
     #semequiv#1 = #labtraba#0;
     #semequiv#2 = #labtraba#1;
     |LEE 000#semequiv.=;
     |SI FSalida ! 0;
          nSwNoVale = -1;     || no existe (no se imprime)
     |FINSI;

     |SI #semequiv#4 = "X";   nSwNoVale = 1; |FINSI;
     |SI #semequiv#4 = "M";   nSwNoVale = 2; |FINSI;
|FPRC;

|PROCESO GrupoBancos_1;
     nEsta = 1;
|FPRC;

|DEFBUCLE GrupoBancos;
     #nomgrubl#1;
     ;
     #0#86, #labtraba#71;
     #0#86, #labtraba#71;
     ;
     NULL, GrupoBancos_1;
|FIN;

|PROCESO Trabajadores;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;

     nEsta = 0;
     |SI #0#85 = "S";
          |SI #labtraba#71 ] #0#83;|Y #labtraba#71 [ #0#84;
               nEsta = 1;
          |FINSI;
     |SINO;
          |BUCLE GrupoBancos;
     |FINSI;
     |SI nEsta = 0;
          |ACABA;
     |FINSI;

     #semempre#0 = #labtraba#0;
     |LEE 000#semempre.=;
     |SI FSalida ! 0;|O #semempre#2 = "N";
          |ACABA;
     |FINSI;

     |HAZ CodigoEquivalente;
     |SI nSwNoVale = -1; |ACABA;   |FINSI;   || si no existe no imprime nada

     nSeleccio = 1;

     #semtraba#3 = #sempretr#0;
     #semtraba#4 = #sempretr#1;
     #semtraba#0 = #labtraba#0;
     #semtraba#1 = #labtraba#1;
     |LEE 000#semtraba.=;
     |SI FSalida = 0;|Y #semtraba#6 ! "01.01.0001";
          fech1 = #semtraba#6;          || datos de carga completa
          fech2 = #semtraba#7;
          |HAZ IniSemana;
     |SINO;
          |HAZ deshas;                  || recalcula fechas
     |FINSI;

     Cod = ("00000" + #labtraba#1) % -105;
     Nom = #labtraba#2;

     |SI #labtraba#36 ! "          ";|Y #labtraba#36 ! "..........";
          fFech3 = #labtraba#36;
          fFech4 = aGuardaFech12;
          |SI fFech3 > fFech4;
               |ACABA;             || aun no es alta
          |FINSI;
     |FINSI;

     |SI #labtraba#37 ! "          ";|Y #labtraba#37 ! "..........";
          fFech3 = #labtraba#37;
          fFech4 = aGuardaFech11;
          |SI fFech3 < fFech4;
               aAlfa1 = "0000N[" + #labtraba#0 + "." + #labtraba#1 + "] esta de baja. Es finiquito: ";
               |AVISO;
               |CONFI aAlfa1;
               |SI FSalida ! 0;
                    |ACABA;             || ya es baja
               |FINSI;
          |FINSI;
     |FINSI;

     DTipo = #sempretr#42;
     HTipo = #sempretr#42;
     |SI #sempretr#42 = 2;
          DTipo = 0;
          HTipo = 1;
     |FINSI;
     |HAZ Inicializa;
     Mes = Mes1;
     Semana = 1;
     |BUCLE Calculos;
     |SI nFinMes = 1;
          Mes = Mes2;
          Semana = 2;
          |BUCLE Calculos;
     |FINSI;
     |SI SwError = 1;
          |HAZ Transferencia;
     |FINSI;
|FPRC;

|PROCESO Ordena4;
     |DDEFECTO #semequiv;
     #semequiv#1 = #labtraba#0;
     #semequiv#2 = #labtraba#1;
     |LEE 000#semequiv.=;
|FPRC;

|DEFBUCLE Trabajadores4;
     #labtraba#1;
     ;
     #sempretr#2,#sempretr#4;
     #sempretr#3,#sempretr#5;
     ;
     NULL,Ordena4,NULL,NULL,NULL,Trabajadores;
     #semequiv#5, #labtraba#0, #labtraba#1;
|FIN;

|DEFBUCLE Trabajadores3;
     #labtraba#1;
     ;
     #sempretr#2,#sempretr#4;
     #sempretr#3,#sempretr#5;
     ;
     NULL,NULL,NULL,NULL,NULL,Trabajadores;
     #labtraba#75, #labtraba#0, #labtraba#1;
|FIN;

|DEFBUCLE Trabajadores2;
     #labtraba#3;
     0, 1;
     "                                        ", #sempretr#2,#sempretr#4;
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", #sempretr#3,#sempretr#5;
     ;
     NULL,Trabajadores;
|FIN;

|DEFBUCLE Trabajadores1;
     #labtraba#1;
     ;
     #sempretr#2,#sempretr#4;
     #sempretr#3,#sempretr#5;
     ;
     NULL,Trabajadores;
|FIN;

|PROCESO Empresas;
     |SI #0#60 = 0;
          |SI #0#43 = 1; |BUCLE Trabajadores1;    |FINSI;   || por codigo
          |SI #0#43 = 2; |BUCLE Trabajadores2;    |FINSI;   || por nombre
          |SI #0#43 = 3; |BUCLE Trabajadores3;    |FINSI;   || por NAFSS
          |SI #0#43 = 4; |BUCLE Trabajadores4;    |FINSI;   || por nro.orden
     |SINO;
          |ABRE #labtraba;
          |PARA nPara1 = 60; |SI nPara1 [ 69; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 10;
               #labtraba#0 = #sempretr#nPara1#;
               #labtraba#1 = #sempretr#nPara2#;
               |LEE 000#labtraba.=;
               |SI FSalida = 0;|Y #labtraba#0 ! 0;|Y #labtraba#1 ! 0;
                    |HAZ Trabajadores;
               |FINSI;
          |SIGUE;
          |CIERRA #labtraba;
     |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO mirasem; |TIPO 7;
    alfa1 = #0#0;
    alfa1 = "01.01." + alfa1;
    fech1 = alfa1;            || primero saca el dia de la semana
    fech2 = fech1 % 1;        ||/que fue el uno de enero
    alfa1 = fech2 % 11;

|SI alfa1 = "Lunes";     sdia=1; smas=1; |FINSI;
|SI alfa1 = "Martes";    sdia=7; smas=1; |FINSI;
|SI alfa1 = "Miercoles"; sdia=6; smas=1; |FINSI;
|SI alfa1 = "Jueves";    sdia=5; smas=1; |FINSI; ||saca el dia del mes que fue
|SI alfa1 = "Viernes";   sdia=4; smas=1; |FINSI; ||el primer lunes del a¤o
|SI alfa1 = "Sabado";    sdia=3; smas=1; |FINSI;
|SI alfa1 = "Domingo";   sdia=2; smas=1; |FINSI;

    alfa1 = ("00" + sdia) % -102;  || construye el primer lunes del a¤o
    fech1 = ~;                     ||/como fecha inicial de calculo
    alfa2 = fech1 % -104;
    alfa1 = alfa1 + ".01." + alfa2;
    fech1 = alfa1;
    nume1 = fech1;                 || calcula dias hasta primer lunes a¤o

    fech1 = ~;                     || calcula dias hasta fecha actual
    nume2 = fech1;

    sdife = nume2 - nume1;         || calcula la diferencia desde el primer
    |SI sdife ] 0;
        srest = sdife $ 7;           || lunes hasta la fecha actual,la redondea,
        sdife = sdife + (7 - srest); || la divide por 7 y le suma 1 por la
        #0Campo = (sdife / 7) + smas;|| primera semana (en su caso !!!)
    |SINO;
        #0Campo = 1;
    |FINSI;

    |ABRE #semcntcu;     |LEE 000#semcntcu.p;     |CIERRA #semcntcu;

    #0Campo = #0Campo - #semcntcu#3;
    |SI #0Campo = 0; #0Campo = 52; |FINSI;

    |PINTA #0Campo;
|FPRC;

|PROCESO UltimoViernes;
     nViernes = 0;
     |PARA fFech1 = fech1; |SI fFech1 [ fech2; |HACIENDO fFech1 = fFech1 + 1;
          fFech2 = fFech1 % 1;
          alfa1 = fFech2 % 11;
          |QBF alfa1;
          |SI alfa1 = "Viernes";
               alfa1 = fFech1 % 402;
               nume1 = fFech1;
               nume1 = nume1 + 7;
               fFech2 = nume1;
               alfa2 = fFech2 % 402;
               |SI alfa2 ! alfa1;
                    nViernes = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO IniSemana;
     |HAZ UltimoViernes;

     MesAlfa = fech1 % 0402;
     Mes1 = MesAlfa;
     MesAlfa = fech2 % 0402;
     Mes2 = MesAlfa;
     Comodin = fech1 % -104;
     Year = Comodin;

     Comodin = fech1 % -108;
     |SI Mes1 = 1;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 2;
          |SI Year = 2000; |O Year = 2004; |O Year = 2008; |O Year = 2012;
           |O Year = 2016;  |O Year = 2020; |O Year = 2024; |O Year = 2028;
           |O Year = 2032;  |O Year = 2036; |O Year = 2040; |O Year = 2044;
               Comodin = "29" + Comodin;
          |SINO;
               Comodin = "28" + Comodin;
          |FINSI;
     |FINSI;
     |SI Mes1 = 3;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 4;  Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 5;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 6;  Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 7;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 8;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 9;  Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 10; Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 11; Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 12; Comodin = "31" + Comodin; |FINSI;

     nFinMes = 0;
     |SI Mes1 ! Mes2;
          nFinMes = 1;                  || fin de mes con cambio de mes
          Fech11  = fech1;
          Fech12  = Comodin;
          Comodin = fech2 % -108; Comodin = "01" + Comodin;
          Fech21  = Comodin;
          Fech22 = fech2;
     |SINO;
          |SI fech2 = Comodin;          || fin de mes sin cambio de mes
               nFinMes = 2;
          |FINSI;
          Fech11 = fech1;
          Fech12 = fech2;
          Fech21 = "";
          Fech22 = "";
     |FINSI;

     aGuardaFech11 = Fech11;   || en los M y en los X se altera
     aGuardaFech12 = Fech12;
     aGuardaFech21 = Fech21;
     aGuardaFech22 = Fech22;

|FPRC;

|PROCESO deshas;              || calcula segun semana, desde dia hasta dia
     |ABRE #semcntcu;     |LEE 000#semcntcu.p;     |CIERRA #semcntcu;

     nume2 = (#0#1 + #semcntcu#3) - smas;
     nume2 = (nume2 * 7) + (sdia - 1);   || dias hasta
     nume1 = nume2 - 6;                  || dias desde

     nume3 = #0#0;
     nume3 = nume3 - 1;
     alfa1 = "31.12." + nume3;    || saca los dias que hay hasta el 31.12
     fech1 = alfa1;
     nume3 = fech1;

     nume1 = nume1 + nume3;
     fech1 = nume1;         || fecha desde

     nume2 = nume2 + nume3;
     fech2 = nume2;         || fecha hasta

     |HAZ IniSemana;
|FPRC;

|PROCESO Parrilla7; |TIPO 7;
     |C_M #0#60, 1, "S";
|FPRC;

|PROCESO Parrilla0; |TIPO 0;
     |SI #0#60 = 0;
          |PDEFECTO #0, 60, 80;
          |PINDA #0#0;
          aAlfa1 = "N";
          aAlfa2 = "S";
     |SINO;
          aAlfa1 = "S";
          aAlfa2 = "N";
     |FINSI;
     |C_M #0#60, 1, aAlfa1;
     |C_M #0#61, 1, aAlfa1;
     |C_M #0#62, 1, aAlfa1;
     |C_M #0#63, 1, aAlfa1;
     |C_M #0#64, 1, aAlfa1;
     |C_M #0#65, 1, aAlfa1;
     |C_M #0#66, 1, aAlfa1;
     |C_M #0#67, 1, aAlfa1;
     |C_M #0#68, 1, aAlfa1;
     |C_M #0#69, 1, aAlfa1;
     |C_M #0#70, 1, aAlfa1;
     |C_M #0#71, 1, aAlfa1;
     |C_M #0#72, 1, aAlfa1;
     |C_M #0#73, 1, aAlfa1;
     |C_M #0#74, 1, aAlfa1;
     |C_M #0#75, 1, aAlfa1;
     |C_M #0#76, 1, aAlfa1;
     |C_M #0#77, 1, aAlfa1;
     |C_M #0#78, 1, aAlfa1;
     |C_M #0#79, 1, aAlfa1;

     |C_M #0#43, 1, aAlfa2;
     |C_M #0#2, 1, aAlfa2;
     |C_M #0#3, 1, aAlfa2;
     |C_M #0#4, 1, aAlfa2;
     |C_M #0#5, 1, aAlfa2;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Preparacion Transf.";
     |PINPA #0#0;
     |ABRE #sempretr;
     |LEE 101#sempretr.=;
     |SI FSalida ! 0;    |GRABA 020#sempretr.b;   |FINSI;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida < 0; |ACABA; |FINSI;
     |GRABA 020#sempretr.a;
     |LIBERA #sempretr;
     |CIERRA #sempretr;

     |ABRE #semconce;
     |ABRE #semcalcb;
     |ABRE #semequiv;
     |ABRE #semtraba;
     |ABRE #semempre;
     |ABRE #labempre;
     |ABRE #nomrevca;
     |ABRE #nomrevli;
     |SELECT #2#semequiv;

     |DDEFECTO #nomrevca;
     #nomrevca#0 = #sempretr#80;
     #nomrevca#1 = #sempretr#81;
     |LEE 101#nomrevca.=;
     |SI FSalida ! 0;  |GRABA 020#nomrevca.b;   |FINSI;

     |HAZ Empresas;

     |GRABA 020#nomrevca.a;
     |LIBERA #nomrevca;

     |CIERRA #nomrevca;
     |CIERRA #nomrevli;
     |CIERRA #labempre;
     |CIERRA #semempre;
     |CIERRA #semequiv;
     |CIERRA #semcalcb;
     |CIERRA #semconce;
     |CIERRA #semtraba;

     |SI nCuantos = 0;
          |MENAV "0000Seleccion vacia ...";
     |SINO;
          aAlfa1 = "0000Creadas [" + nCuantos + "] transferencias.";
          |MENAV aAlfa1;

          |DDEFECTO #semtrati;
          |ABRE #semtrati;
          #semtrati#0 = #0#80;
          #semtrati#1 = #0#81;
          |LEE 101#semtrati.=;
          |SI FSalida ! 0;
               |GRABA 020#semtrati.b;
          |FINSI;
          #semtrati#2 = #0#82;
          |GRABA 020#semtrati.a;
          |LIBERA #semtrati;
          |CIERRA #semtrati;
     |FINSI;
|FPRO;

_________________________ TRANSFERENCIAS
|PROCESO UltReg; |TIPO 7;
     |ABRE #nomrevca;
     #nomrevca#0 = #sempretr#80;
     #nomrevca#1 = 999999;
     |LEE 000#nomrevca.];
     |SI FSalida = 0;
          |LEE 000#nomrevca.a;
     |SINO;
          |LEE 000#nomrevca.u;
     |FINSI;
     |SI FSalida = 0;|Y #nomrevca#0 = #sempretr#80;
          #sempretr#81 = #nomrevca#1 + 1;
     |SINO;
          #sempretr#81 = 1;
     |FINSI;
     |CIERRA #nomrevca;
     |PINTA #sempretr#81;
|FPRC;

|PROCESO Linea;
     #nomrevli#0 = #nomrevca#0;
     #nomrevli#1 = #nomrevca#1;
     #nomrevli#2 = 99999;
     |LEE 000#nomrevli.];
     |SI FSalida = 0;
          |LEE 000#nomrevli.a;
     |SINO;
          |LEE 000#nomrevli.u;
     |FINSI;
     |SI FSalida = 0;|Y #nomrevli#0 = #nomrevca#0;|Y #nomrevli#1 = #nomrevca#1;
          Linea = #nomrevli#2 + 1;
     |SINO;
          Linea = 1;
     |FINSI;

     |SELECT #2#nomrevli;
     #nomrevli#1 = #nomrevca#1;
     #nomrevli#0 = #nomrevca#0;
     #nomrevli#3 = #labtraba#1;
     |LEE 000#nomrevli.=;
     |SI FSalida = 0;
          Linea = #nomrevli#2;
     |FINSI;
     |SELECT #1#nomrevli;
|FPRC;

|PROCESO Transferencia;
     |SI #sempretr#58 ! 0;
          nLiquido = #sempretr#58; || fin de mes
     |SINO;
          nLiquido = #sempretr#41;
     |FINSI;
     |SI nLiquido ! 0;
          |HAZ Linea;

          |DDEFECTO #nomrevli;
          #nomrevli#0 = #nomrevca#0;
          #nomrevli#1 = #nomrevca#1;
          #nomrevli#2 = Linea;
          |LEE 101#nomrevli.=;
          |SI FSalida ! 0;
               |GRABA 020#nomrevli.b;
          |SINO;
               #nomrevca#2 = #nomrevca#2 - #nomrevli#6;
               #nomrevca#3 = #nomrevca#3 - 1;
          |FINSI;

          #nomrevli#3  = #labtraba#1;
          #nomrevli#4  = #labtraba#7;
          #nomrevli#6  = nLiquido;
          #nomrevli#7  = "NOMINA";
          #nomrevli#8  = #labtraba#2;
          #nomrevli#11 = 0;
          #nomrevli#12 = "N";

          |ABRE #labtracu;
          #labtracu#0 = #labtraba#0;
          #labtracu#1 = #labtraba#1;
          #labtracu#2 = 1;
          |LEE 000#labtracu.=;
          |SI FSalida = 0;
              #nomrevli#5  = #labtracu#5 + #labtracu#6 + #labtracu#8 + #labtracu#7;
              #nomrevli#9  = #labtracu#12;
              #nomrevli#10 = #labtracu#13;
          |SINO;
              #nomrevli#5  = #labtraba#72;
              #nomrevli#9  = #labtraba#154;
              #nomrevli#10 = #labtraba#155;
          |FINSI;
          |CIERRA #labtracu;

          |GRABA 020#nomrevli.a;
          |SI FSalida = 0;
               nCuantos = nCuantos + 1;
          |FINSI;
          |LIBERA #nomrevli;

          #nomrevca#2 = #nomrevca#2 + nLiquido;
          #nomrevca#3 = #nomrevca#3 + 1;
     |FINSI;
|FPRC;
