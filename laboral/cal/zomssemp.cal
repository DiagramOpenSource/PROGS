|FICHEROS;
     zomssemp #0;
     labempre #1;
     labtraba #2;
     nomhicca #3;

     nomconst #15;
     nombonif #16;
     nomepigr #17;
|FIN;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     para1 = 0;
     para2 = 0;
     para3 = 0;
     para4 = 0;
     fech1 = @;
     fech2 = @;
     fech3 = @;
     fech4 = @;
     FEstado = 0;

     tope = 0;
     bisiesto = 0;
     fecha = @;
     linea = 0;

     &nEpigConv = 0;
     es_aprendi = 0;
     nBase = 0;
     base_8 = 0;
     base_9 = 0;
     por2_cont = 0;
     por2_dfpg = 0;
     epig_ilt = 0;
     epig_ims = 0;
     base_E = 0;
     &nCConst = 0;
     por1_cont = 0;                             || (%) contigen.(tra.)
     por1_hor1 = 0;                             || (%) contigen.(tra.)
     por1_hor2 = 0;                             || (%) contigen.(tra.)
     por1_dfpg = 0;                             || (%) contigen.(tra.)
     por2_hor1 = 0;                             || (%) contigen.(tra.)
     por2_hor2 = 0;                             || (%) contigen.(tra.)
     &fCFecha = @;
     &aCError = "";
     nAny = 0;
     &nElAny = 0;
     nEl36 = 0;
|FIN;

|PROCESO calssemp;    || CALCULA S.S. A CGO. EMPRESA (18/93 y resto)
/*
    |SI sw_mater = 1; |Y #2#42 ! "H";
          |SI swAjuste3 ! 0;
               coba_4 = coba_4 - (swAjuste3 * prom_enf);
               cobb_4 = cobb_4 - (swAjuste3 * prom_enf);
          |FINSI;
          base_6 = base_6 + coba_4;
          base_7 = base_7 + cobb_4;
     |FINSI;
     base_10 = dries_2 * prom_enf;
     base_11 = dcont_2 * prom_enf;
     |SI nDesem ! 0; |Y #2#42 ! "H";
          base_5 = base_5 + nDesem;
          bon_5 = bon_5 + nDesem;
          base_6 = base_6 + nDesem;
          base_7 = base_7 + nDesem;
     |FINSI;

     base_5 = base_5 ! 2;
     base_6 = base_6 ! 2;
     base_7 = base_7 ! 2;

     base_A = 0;   base_B = 0;   base_C = 0;   base_F = 0;
     base_D = 0;   base_E = 0;   base_G = 0;   base_M = 0; base_N = 0
     base_AB = 0;  base_MN = 0;
     zbase_A = 0;  zbase_B = 0;  zbase_C = 0;  zbase_F = 0;
     zbase_M = 0;  zbase_N = 0;
     zbase_AB = 0; zbase_MN = 0;

     base_8 = (dacum_30 % por2_hor1)+(dacum_31 % por2_hor2); || h.ext.
     |SI #2#39 ! 0; |Y dboni_1 ! 0; |Y #16#11 = "S";
          base_D = horasex * #16#12;      || cuota (2) bonif. horas formacion
     |FINSI;
*/

     |SI es_aprendi = 0; |Y #labtraba#42 ! "H";

/*
          |SI #2#45 ! "064";|Y #2#45 ! "065";|Y #16#9 = "N";
               || deduc.volunt.(122): todos menos los 64/65 y los coef.reductores
               base_G = (base_6 % (por1_cont + por2_cont) ) ! EURODB;
               base_G = (base_G % #15#75) ! EURODB;
          |FINSI;

          base_8 = base_8 + (base_6 % por2_cont); || cc
          |SI notaria > 0;
               nNume1 = (base_6 % (por1_cont + por2_cont));
               nNume1 = nNume1 % notaria;
               base_8 = base_8 - nNume1;          || ded.notarias
          |FINSI;
          |SI nRecAy > 0;
               base_8 = base_8 + (base_6 % nRecAy); || cc
          |FINSI;

          base_8 = base_8 + (base_7 % por2_dfpg);             || cp
          base_8 = base_8 + ((((base_6 % por2_cont) ! EURODB) % nEl36) ! EURODB);
          base_8 = base_8 ! EURODB;                           || 36% ctos.<7dias

          |SI #2#42 = "L";     base_5 = guarda_l;  |FINSI;
          |SI #0#9 [ 2009;
               base_9 = (base_7 - base_5) % (epig_ilt + epig_ims);      || epig.normal
               |SI #0#9 [ 2006;
                    base_9 = base_9 + (base_5 % (#15#3 + #15#4));            || epig.enf.
               |SINO;
                    |HAZ lee904;
                    base_9 = base_9 + (base_5 % (#nomepigr#1 + #nomepigr#2));            || epig.enf.
               |FINSI;
          |SINO;
               base_9 = ((base_7 - base_5) % epig_ilt) ! 2;      || epig.normal
               base_9 = base_9 + (((base_7 - base_5) % epig_ims) ! 2);      || epig.normal
               base_9 = base_9 + ((base_5 % epig_ilt) ! 2);      || epig.normal
               base_9 = base_9 + ((base_5 % epig_ims) ! 2);      || epig.normal
          |FINSI;
          base_9 = base_9 ! EURODB;
          |SI #2#42 = "L";     base_5 = 0;         |FINSI;

          bon_0 = bon_0 ! 2;
          bon_3 = bon_3 ! 2;
          bon_5 = bon_5 ! 2;
          zbon_0 = zbon_0 ! 2;
          zbon_3 = zbon_3 ! 2;
          zbon_5 = zbon_5 ! 2;
          |SI #2#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0;
               base_A = (bon_0 % #16#4) % nPorBon1; || cuota bonif. linea 1
               base_B = (bon_3 % #16#5) % nPorBon1; || cuota bonif. linea 2
               |HAZ LimiteBonif;
               base_AB = (base_A + base_B) ! EURODB; || redondea juntas para q no haya problemas
               base_M = (bon_0 % #16#6) % nPorBon1; || cuota bonif. linea 1
               base_N = (bon_3 % #16#7) % nPorBon1; || cuota bonif. linea 2
               base_MN = (base_M + base_N) ! EURODB; || redondea juntas para q no haya problemas
               |SI #16#08 = "S";
                    |SI #0#9 [ 2009;
                         zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
                         zbase_9 = zbase_9 ! EURODB;
                         |SI #0#9 [ 2006;
                              zbase_9 = zbase_9 + (bon_5 % (#15#3 + #15#4));            || epig.enf.
                         |SINO;
                              |HAZ lee904;
                              zbase_9 = zbase_9 + (bon_5 % (#nomepigr#1 + #nomepigr#2));            || epig.enf.
                         |FINSI;
                    |SINO;
                         zbase_9 = ((bon_3 - bon_5) % epig_ilt) ! 2;
                         zbase_9 = zbase_9 + (((bon_3 - bon_5) % epig_ims) ! 2);
                         zbase_9 = zbase_9 + ((bon_5 % epig_ilt) ! 2);
                         zbase_9 = zbase_9 + ((bon_5 % epig_ims) ! 2);
                    |FINSI;
                    zbase_9 = zbase_9 ! EURODB;
                    base_C = zbase_9 % nPorBon1;      || cuota bonificada accidentes
                    base_C = base_C ! EURODB;
               |FINSI;
          |FINSI;

          |SI #2#39 ! 0; |Y dboni_2 ! 0; |Y nPorBon2 ! 0;
               zbase_A = (zbon_0 % #16#4) % nPorBon2; || cuota bonif. linea 1
               zbase_B = (zbon_3 % #16#5) % nPorBon2; || cuota bonif. linea 2
               zbase_AB = (zbase_A + zbase_B) ! EURODB;   || redondea juntas para q no haya problemas
               zbase_M = (zbon_0 % #16#6) % nPorBon1; || cuota bonif. linea 1
               zbase_N = (zbon_3 % #16#7) % nPorBon1; || cuota bonif. linea 2
               zbase_MN = (zbase_M + zbase_N) ! EURODB; || redondea juntas para q no haya problemas
               |SI #16#08 = "S";
                    |SI #0#9 [ 2009;
                         zbase_9 = (zbon_3 - zbon_5) % (epig_ilt + epig_ims);
                         zbase_9 = zbase_9 ! EURODB;
                         |SI #0#9 [ 2006;
                              zbase_9 = zbase_9 + (zbon_5 % (#15#3 + #15#4));            || epig.enf.
                         |SINO;
                              |HAZ lee904;
                              zbase_9 = zbase_9 + (zbon_5 % (#nomepigr#1 + #nomepigr#2));            || epig.enf.
                         |FINSI;
                    |SINO;
                         zbase_9 = ((zbon_3 - zbon_5) % epig_ilt) ! 2;
                         zbase_9 = zbase_9 + (((zbon_3 - zbon_5) % epig_ims) ! 2);
                         zbase_9 = zbase_9 + ((zbon_5 % epig_ilt) ! 2);
                         zbase_9 = zbase_9 + ((zbon_5 % epig_ims) ! 2);
                    |FINSI;
                    zbase_9 = zbase_9 ! EURODB;
                    zbase_C = zbase_9 % nPorBon2;     || cuota bonificada accidentes
                    zbase_C = zbase_C ! EURODB;
               |FINSI;
          |FINSI;
*/
          nBase = #nomhicca#39;
          nBase = nBase + #nomhicca#159;     || maternidad
          nBase = nBase + #nomhicca#170;     || ERE
          nBase = nBase + #nomhicca#172;     || riesgo
          nBase = nBase + #nomhicca#174;     || control IT

          base_8 = base_8 + (nBase % por2_cont); || cc
          base_8 = base_8 + ((((nBase % por2_cont) ! 2) % nEl36) ! 2);
/*
          |SI notaria > 0;
               nNume1 = (base_6 % (por1_cont + por2_cont));
               nNume1 = nNume1 % notaria;
               base_8 = base_8 - nNume1;          || ded.notarias
          |FINSI;
          |SI nRecAy > 0;
               base_8 = base_8 + (base_6 % nRecAy); || cc
          |FINSI;
*/
          base_8 = base_8 + (nBase % por2_dfpg);             || cp
          || base_8 = base_8 + ((((base_6 % por2_cont) ! EURODB) % nEl36) ! EURODB);
          base_8 = base_8 ! 2;

          base_9 = base_9 + ((nBase % epig_ilt) ! 2);  || Cuota ATEP
          base_9 = base_9 + ((nBase % epig_ims) ! 2);

          base_E = base_8 + base_9;
          base_E = base_E - #nomhicca#63;    || bonif 1
          base_E = base_E - #nomhicca#64;    || horas formacion
          base_E = base_E - #nomhicca#123;   || bonif 2
          base_E = base_E - #nomhicca#148;   || bonif mayores 59
          base_E = base_E - #nomhicca#138;   || bonif fom. emp. 1
          base_E = base_E - #nomhicca#175;   || bonif fom. emp. 2
          base_E = base_E - #nomhicca#144;   || bonif fom. emp. sec. inc.
          base_E = base_E - #nomhicca#160;   || bonif fom. emp. agr.
          base_E = base_E - #nomhicca#167;   || bonif ERE

          #nomhicca#45 = base_E;

/*
          |SI #2#211 ! 0;
               nDiferencia = base_E - bon_60 - bon_55 - bon_59;
               nDiferencia = nDiferencia * (-1);
               |SI bon_60 > 0; |Y nDiferencia > 0;
                    bon_60 = bon_60 - nDiferencia;
                    |SI bon_60 < 0;
                         nDiferencia = bon_60 * (-1);
                         bon_60 = 0;
                    |SINO;
                         nDiferencia = 0;
                    |FINSI;
               |FINSI;
               |SI bon_59 > 0; |Y nDiferencia > 0;
                    bon_59 = bon_59 - nDiferencia;
                    |SI bon_59 < 0;
                         nDiferencia = bon_59 * (-1);
                         bon_59 = 0;
                    |SINO;
                         nDiferencia = 0;
                    |FINSI;
               |FINSI;
               |SI bon_55 > 0; |Y nDiferencia > 0;
                    bon_55 = bon_55 - nDiferencia;
                    |SI bon_55 < 0;
                         nDiferencia = bon_55 * (-1);
                         bon_55 = 0;
                    |SINO;
                         nDiferencia = 0;
                    |FINSI;
               |FINSI;
               base_E = base_E - bon_60 - bon_55 - bon_59;        || bonif. mayores 60 a¤os
          |FINSI;
          |SI nBonifFCI1 > 0; |O nBonifFCI2 > 0; |O nBonifTex1 > 0; |O nBonifTex2 > 0;
               base_E = base_E - nBonifFCI1 - nBonifFCI2 - nBonifTex1 - nBonifTex2;
               |SI base_E < 0;
                    nume2 = base_E;
                    base_E = 0;
                    |SI nBonifTex1 > 0;
                         nBonifTex1 = nBonifTex1 + nume2;
                         |SI nBonifTex1 < 0;
                              nume2 = nBonifTex1;
                              nBonifTex1 = 0;
                         |SINO;
                              nume2 = 0;
                         |FINSI;
                    |FINSI;
                    |SI nBonifFCI2 > 0; |Y nume2 ! 0;
                         nBonifFCI2 = nBonifFCI2 + nume2;
                         |SI nBonifFCI2 < 0;
                              nume2 = nBonifFCI2;
                              nBonifFCI2 = 0;
                         |SINO;
                              nume2 = 0;
                         |FINSI;
                    |FINSI;
                    |SI nBonifFCI1 > 0; |Y nume2 ! 0;
                         nBonifFCI1 = nBonifFCI1 + nume2;
                         |SI nBonifFCI1 < 0;
                              nume2 = nBonifFCI1;
                              nBonifFCI1 = 0;
                         |SINO;
                              nume2 = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nBonifERE > 0;
               base_E = base_E - nBonifERE;
               |SI base_E < 0;
                    nBonifERE = nBonifERE + base_E;
                    base_E = 0;
               |FINSI;
          |FINSI;
          |HAZ ss_ayunt;
     |SINO;
          |SI #2#45 = "087"; base_E = #35#9  + #35#10 + #35#11 + #35#12; |FINSI;
          |SI #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
               base_E = #nomconst#82 + #nomconst#84 + #nomconst#86 + #nomconst#87;
               |SI #2#45 = "422";
                    base_E = #nomconst#82 + #nomconst#86 + #nomconst#87;
               |FINSI;
               |SI #labtraba#190 = "S";
                    base_E = base_E + #nomconst#90;
               |FINSI;
               base_E = base_E - nBonifFormEmp;
               |SI nBonifERE > 0;
                    base_E = base_E - nBonifERE;
               |FINSI;
               |SI nBonifFormTra ! 0;
                    dto_con = 0;
                    dto_dfp = 0;
                    dto_des = 0;
               |FINSI;
               swForm = 2;
               |HAZ BuscaOtroForm;
          |FINSI;
          |SI #2#45 = "097";
               fech1 = #2#36;
               |SI fech1 < "17.05.1997";
                    base_E = #35#9 + #35#10 + #35#11 + #35#12;
               |SINO;
                    base_E = #35#15 + #35#16 + #35#17 + #35#18;
               |FINSI;
               nume1 = (base_E % nPorBon1) ! EURODB;
               base_E = base_E - nume1;         || SS empresa
               base_AB = nume1;                 || cuota (1) bonif.
          |FINSI;
          base_E = base_E + base_8 - base_D;   || mas las horas extras, si hubieran
     |FINSI;

     |SI base_E < 0; |Y base_D = 0; base_E = 0; |FINSI;
                                           || menos la subvencion horas
     base_F = base_AB + base_C + base_MN;         || cuota (1) bonif.
     zbase_F = zbase_AB + zbase_C + zbase_MN;     || cuota (2) bonif.
     |SI sw_mater = 1; |Y #2#42 ! "H";
          base_6 = base_6 - coba_4;
          base_7 = base_7 - cobb_4;
     |FINSI;
     |SI nDesem ! 0; |Y #2#42 ! "H";
          base_5 = base_5 - nDesem;
          base_6 = base_6 - nDesem;
          base_7 = base_7 - nDesem;
*/
     |GRABA 020#nomhicca.a;
     |LIBERA #nomhicca;
     |FINSI;
|FPRC;

|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#4;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#6;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
|FPRC;

|PROCESO Cotizacion;
     nCConst = #labtraba#248;
     |HAZ constante;
     |HAZ ATEP;

     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
          es_aprendi = 1;
     |FINSI;

     || nRecAy = #15#74;
     || SI #36#5 = "N";    nRecAy = 0;    |FINSI;
     |SI #0#6 [ 2018;
          nEl36 = 36;
     |SINO;
          nEl36 = 40;
     |FINSI;
     |SI #2#112 ! "S";   nEl36 = 0;     |FINSI;
     || topesmi = (#15#76 % 20) ! EURODB;
     por1_cont = #15#07;                             || (%) contigen.(tra.)
     |SI #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
          por1_hor1 = #15#09;                             || (%) horas 1  (tra.)
          por1_hor2 = #15#11;                             || (%) horas 2  (tra.)
     |SINO;
          por1_hor1 = 0;                             || (%) horas 1  (tra.)
          por1_hor2 = 0;                             || (%) horas 2  (tra.)
     |FINSI;

     por1_dfpg = #15#13 + #15#15 + #15#17 + #15#19;  || (%) d+f+p+g  (tra.)
     || por2_cont = #15#06 + nRecAy;                   || (%) contigen.(emp.)
     por2_cont = #15#06;                            || (%) contigen.(emp.)
     |SI #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
          por2_hor1 = #15#08;                             || (%) horas 1  (emp.)
          por2_hor2 = #15#10;                             || (%) horas 2  (emp.)
     |SINO;
          por2_hor1 = 0;                                  || (%) horas 1  (emp.)
          por2_hor2 = 0;                                  || (%) horas 2  (emp.)
     |FINSI;
     por2_dfpg = #15#12 + #15#14 + #15#16 + #15#18;  || (%) d+f+p+g  (emp.)

     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
          por1_hor1 = por1_hor1 + por1_dfpg;         || (%) horas 1 (aprend)
          por1_hor2 = por1_hor2 + por1_dfpg;         || (%) horas 2 (aprend)
     |FINSI;

     por1_cont = por1_cont ! 2;
     por2_cont = por2_cont ! 2;
|FPRC;

|PROCESO ATEP;
     |SI #0#6 ] 2007;
          |HAZ VerifCNAE;
     |FINSI;

     |ABRE #17;
     |DDEFECTO #17;
     #17#0  = nEpigConv;
     |LEE 000#17=;            || lee epigrafe
     epig_ilt = #17#1;
     epig_ims = #17#2;
     |CIERRA #17;
|FPRC;

|PROCESO PonACero;
     nEpigConv = 0;
     es_aprendi = 0;
     nBase = 0;
     base_8 = 0;
     base_9 = 0;
     por2_cont = 0;
     por2_dfpg = 0;
     epig_ilt = 0;
     epig_ims = 0;
     base_E = 0;
     nCConst = 0;
     por1_cont = 0;                             || (%) contigen.(tra.)
     por1_hor1 = 0;                             || (%) contigen.(tra.)
     por1_hor2 = 0;                             || (%) contigen.(tra.)
     por1_dfpg = 0;                             || (%) contigen.(tra.)
     por2_hor2 = 0;                             || (%) contigen.(tra.)
|FPRC;

|PROCESO nomhicca;
     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;

     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;

     |SI #0#7 [ #labtraba#77 ; |Y #labtraba#77 [ #0#8;
          |HAZ PonACero;
          |HAZ Cotizacion;

          |HAZ calssemp;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #3#1;
     ;
     #0#0, #0#2, nAny, #0#4, 0;
     #0#1, #0#3, nAny, #0#4, 0;
     be;
     NULL, nomhicca;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |SI FSalida = 0;
          nElAny = #0#6;

          |HAZ ValoresITIMS;

          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #nomhicca;

          nAny = #0#6 - 2000;
          |BUCLE nomhicca;

          |CIERRA #nomhicca;
          |CIERRA #labtraba;
          |CIERRA #labempre;
     |FINSI;
|FPRO;
