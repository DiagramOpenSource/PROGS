|FICHEROS;
     zominf07;
     nomcalca;
     nomhicca;
     labempre;
     labtraba;
     nomhisit;
|FIN;

|VARIABLES;
     nDetectados = 0;
     nEmp = 0;
     nTra = 0;
     nLinea = 0;
     swSigue = 0;
     swSigue2 = 0;
     nTotalDias = 0;
     nBaseTotal = 0;
     &nCompNomina = 0;
     &nCompReal = 0;
     nTotalPrestMasIT = 0;
     nDiferencia = 0;
|FIN;

|PROCESO ElPRINT;
     |SI nDetectados = 0;
          |IMPRE 0;
          |INFOR "zominf07";
          |PRINT;
     |SINO;
          |PRINT;
     |FINSI;
     nDetectados = nDetectados + 1;
|FPRC;

|PROCESO complementos;
     #labempre#0 = nEmp;
     |LEE 000#labempre.=;

     #labtraba#0 = nEmp;
     #labtraba#1 = nTra;
     |LEE 000#labtraba.=;

     #nomhisit#0 = nEmp;
     #nomhisit#1 = nTra;
     #nomhisit#2 = 2015;
     #nomhisit#3 = 01;
     |PARA nLinea = 1; |SI nLinea [ 4; |HACIENDO nLinea = nLinea + 1;
          #nomhisit#8 = nLinea;
          |LEE 000#nomhisit.=;
          |SI FSalida = 0;
               swSigue2 = 0;
               |SI #nomhisit#42 = "P"; |Y #nomhisit#45 ! 0; swSigue2 = 1; |FINSI;
               |SI #nomhisit#49 = "P"; |Y #nomhisit#52 ! 0; swSigue2 = 1; |FINSI;
               |SI #nomhisit#56 = "P"; |Y #nomhisit#59 ! 0; swSigue2 = 1; |FINSI;
               |SI #nomhisit#63 = "P"; |Y #nomhisit#66 ! 0; swSigue2 = 1; |FINSI;

               |SI swSigue2 = 1;
                    nCompNomina = #nomhisit#45 + #nomhisit#52 + #nomhisit#59 + #nomhisit#66;
                    nCompNomina = nCompNomina + #nomhisit#72;

                    nTotalDias = #nomhisit#7;
                    nBaseTotal = nTotalDias * #nomhisit#12;
                    nTotalPrestMasIT = #nomhisit#69 + #nomhisit#70;
                    |SI nTotalPrestMasIT ! nBaseTotal;
                    |Y nCompReal < nCompNomina;
                         nDiferencia = nCompNomina - nCompReal;
                         |SI -1 [ nDiferencia; |Y nDiferencia [ 1;
                              || no imprimo, diferencia no suficiente
                         |SINO;
                              nCompReal = nCompReal;
                              nCompNomina = nCompNomina;
                              |HAZ ElPRINT;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO nomhicca;
     swSigue = 0;

     nEmp = #nomhicca#0;
     nTra = #nomhicca#1;

     |SI #nomhicca#27 = "E"; |O #nomhicca#28 = "E";
     |O #nomhicca#29 = "E"; |O #nomhicca#30 = "E";
          |SI #nomhicca#59 > 0;
               nCompReal = #nomhicca#59;
               swSigue = 1;
          |FINSI;
     |FINSI;

     |SI #nomhicca#27 = "A"; |O #nomhicca#28 = "A";
     |O #nomhicca#29 = "A"; |O #nomhicca#30 = "A";
          |SI #nomhicca#60 > 0;
               nCompReal = #nomhicca#60;
               swSigue = 2;
          |FINSI;
     |FINSI;

     |SI swSigue ! 0;
          |HAZ complementos;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     00001, 00001, 15, 01, 0;
     99999, 99999, 15, 01, 0;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO nomcalca;
     swSigue = 0;

     nEmp = #nomcalca#0;
     nTra = #nomcalca#1;

     |SI #nomcalca#27 = "E"; |O #nomcalca#28 = "E";
     |O #nomcalca#29 = "E"; |O #nomcalca#30 = "E";
          |SI #nomcalca#59 > 0;
               nCompReal = #nomcalca#59;
               swSigue = 1;
          |FINSI;
     |FINSI;

     |SI #nomcalca#27 = "A"; |O #nomcalca#28 = "A";
     |O #nomcalca#29 = "A"; |O #nomcalca#30 = "A";
          |SI #nomcalca#60 > 0;
               nCompReal = #nomcalca#60;
               swSigue = 2;
          |FINSI;
     |FINSI;

     |SI swSigue ! 0;
          |HAZ complementos;
     |FINSI;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     00001, 00001, 01, 0;
     99999, 99999, 01, 0;
     ;
     NULL, nomcalca;
|FIN;

|PROGRAMA;
     |CLS;

     |ABRE #labempre;
     |ABRE #labtraba;
     |ABRE #nomhisit;

     |BUCLE nomcalca;
     |BUCLE nomhicca;

     |SI nDetectados ! 0;
          |PIEINF;
          |FININF;
          |FINIMP;
     |SINO;
          |MENAV "    No se ha detectado ningún trabajador con diferencias";
     |FINSI;

     |CIERRA #nomhisit;
     |CIERRA #labtraba;
     |CIERRA #labempre;
|FPRO;
