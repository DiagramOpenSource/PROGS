|FICHEROS;
     hotm0031 #0;
     hotm0030 #1;        || dias libres lins.
     hotm0032 #4;        || temporal
     hotm0024 #5;        || detalle ocupacion
     hotm0010 #6;        || planilla mensual lins.
     hotm0012 #7;        || planilla generica cabs.
     hotm0013 #8;        || planilla generica lins.
     hotm0021 #9;        || centros ocupacion
     hotm0022 #10;       || areas ocupacion
     hotm0028 #11;       || conceptos definidos

     labtraba #20;       || trabajadores
     nomtrali #21;       || importes por trabajador lins.
     nomcatli #22;       || importes por categoria lins.
     nomcalca #23;       || calculos mensuales cabs.
     nomcalli #24;       || calculos mensuales lins.
     nomhicca #25;       || calculos historico cabs.
     nomhicli #26;       || calculos historico lins.
|FIN;

|VARIABLES;
     &SwCentro = 0;
     &SwArea = 0;
     &SwSeccion = 0;
     &SwBlanco = 0;
     &PalTotal = "";
     &DesvPerso  = 0;
     &DesvBruto   = 0;
     &DiferPerso = 0;
     &DiferBruto  = 0;
     &SwTotArea  = -1;
     &SwTotCentro = -1;

     &TEPArea = 0;
     &TEBArea = 0;
     &TRPArea = 0;
     &TRBArea = 0;
     &TDPArea = 0;
     &TDBArea = 0;
     &TdPArea = 0;
     &TdBArea = 0;
     &TEPCentro = 0;
     &TEBCentro = 0;
     &TRPCentro = 0;
     &TRBCentro = 0;
     &TDPCentro = 0;
     &TDBCentro = 0;
     &TdPCentro = 0;
     &TdBCentro = 0;

     CentroAnt  = 0;
     areaAnt    = "";
     SeccionAnt = "";

     nCentro    = 0;
     aArea      = "";
     aSeccion   = "";

     nMes       = 0;
     nAnyo      = 0;
     nCoefic    = 0;
     nCoefic1   = 0;
     nCoefic2   = 0;
     nDias      = 0;
     nTotalLineas = 0;
     nLineas = 0;
     nNaturDesde = 0;
     CalcDesde   = 0;
     CalcHasta   = 0;
     Calc        = 0;
     nCalc1      = 0;
     Calc2       = 0;
     NumDias     = 0;

     nSwError    = 0;
     Comodin = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nNume4 = 0;
     fFech1 = @;
     fFech2 = @;
     fFech3 = @;
     fFech4 = @;
|FIN;

|| __________________ pantalla
|PROCESO FechaBien; |TIPO 0;
     |SI #hotm0031#2 > #hotm0031#3;
          |MENAV "0000Error de entrada.";
          |ERROR;
     |FINSI;
|FPRC;

|| __________________ impresion del temporal
|PROCESO ImpreCompara;
     PalTotal = "TOTAL AREA";
     |SI #hotm0031#5 = "N";
          SwSeccion = 0;
          PalTotal = "";
     |FINSI;

     #hotm0032#0 = #hotm0024#0;
     #hotm0032#1 = #hotm0024#1;
     #hotm0032#2 = #hotm0024#2;
     |LEE 000#hotm0032.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI CentroAnt ! #hotm0024#0;
          SwCentro = 0;
          SwArea = 0;
          SwSeccion = 0;
          |SI SwTotCentro ] 0;
               |SI #hotm0031#5 = "S";
                    SwBlanco = 1;
               |FINSI;
               SwTotCentro = 1;
               SwTotArea = 1;
               |PRINT;
               SwTotArea = 0;
               SwTotCentro = 0;
               SwBlanco = 0;
          |SINO;
               SwTotCentro = 0;
               SwTotArea   = 0;
          |FINSI;
          TEPArea = 0; TEBArea = 0; TRPArea = 0; TRBArea = 0;
          TDPArea = 0; TDBArea = 0; TdPArea = 0; TdBArea = 0;
          TEPCentro = 0; TEBCentro = 0; TRPCentro = 0; TRBCentro = 0;
          TDPCentro = 0; TDBCentro = 0; TdPCentro = 0; TdBCentro = 0;
          CentroAnt = #hotm0024#0;
          areaAnt = #hotm0024#1;
          SwCentro  = 1;
          |SI #hotm0031#5 = "S";
               SwArea = 1;
               SwSeccion = 1;
          |FINSI;
     |SINO;
          SwCentro = 0;
          |SI areaAnt ! #hotm0024#1;
               SwArea = 0;
               SwSeccion = 0;
               |SI SwTotArea ] 0;
                    |SI #hotm0031#5 = "S";
                         SwBlanco = 1;
                    |FINSI;
                    SwTotArea = 1;
                    |PRINT;
                    SwTotArea = 0;
                    SwBlanco = 0;
               |SINO;
                    SwTotArea = 0;
               |FINSI;
               TEPArea = 0; TEBArea = 0; TRPArea = 0; TRBArea = 0;
               TDPArea = 0; TDBArea = 0; TdPArea = 0; TdBArea = 0;
               areaAnt = #hotm0024#1;
               |SI #hotm0031#5 = "S";
                    SwArea = 1;
                    SwSeccion = 1;
               |FINSI;
          |SINO;
               SwArea = 0;
          |FINSI;
     |FINSI;

     #hotm0021#0 = #hotm0024#0;
     |LEE 000#hotm0021.=;

     #hotm0022#0 = #hotm0024#0;
     #hotm0022#1 = #hotm0024#1;
     |LEE 000#hotm0022.=;

     #hotm0024#4 = #hotm0024#4 * nCoefic1;
     #hotm0024#5 = #hotm0024#5 * nCoefic1;

     DiferPerso = #hotm0032#3 - #hotm0024#4;
     DesvPerso = (DiferPerso * 100)/#hotm0024#4;
     DiferBruto = #hotm0032#4 - #hotm0024#5;
     DesvBruto = (DiferBruto * 100)/#hotm0024#5;

     |PRINT;

     TEPCentro = TEPCentro + #hotm0024#4;
     TEBCentro = TEBCentro + #hotm0024#5;

     TRPCentro = TRPCentro + #hotm0032#3;
     TRBCentro = TRBCentro + #hotm0032#4;

     TDPCentro = TRPCentro - TEPCentro;
     TdPCentro = (TDPCentro * 100) / TEPCentro;

     TDBCentro = TRBCentro - TEBCentro;
     TdBCentro = (TDBCentro * 100) / TEBCentro;

     TEPArea = TEPArea + #hotm0024#4;
     TEBArea = TEBArea + #hotm0024#5;

     TRPArea = TRPArea + #hotm0032#3;
     TRBArea = TRBArea + #hotm0032#4;

     TDPArea = TRPArea - TEPArea;
     TdPArea = (TDPArea * 100) / TEPArea;

     TDBArea = TRBArea - TEBArea;
     TdBArea = (TDBArea * 100) / TEBArea;
|FPRC;

|DEFBUCLE ImpreCompara;
     #hotm0024#1;
     ;
     #hotm0031#0, "  ", "  ", #hotm0031#4;
     #hotm0031#1, "zz", "zz", #hotm0031#4;
     ;
     NULL, ImpreCompara;
|FIN;

|| __________________ creacion del temporal
|PROCESO GrabaDatos;
     |DDEFECTO #hotm0032;
     #hotm0032#0 = nCentro;
     #hotm0032#1 = aArea;
     #hotm0032#2 = aSeccion;
     |LEE 101#hotm0032.=;
     |SI FSalida ! 0;
          |GRABA 020#hotm0032.b;
     |FINSI;
     #hotm0032#3 = #hotm0032#3 + (nCoefic2 ! 2);
     #hotm0032#4 = #hotm0032#4 + ((nTotalLineas * nCoefic) * nCoefic2);
     |GRABA 020#hotm0032.a;
     |LIBERA #hotm0032;
|FPRC;

|PROCESO TotalLinea;
     |SI #hotm0031#6 = #hotm0031#7;     || mes desde y hasta iguales
          nNume1 = nLineas * (#hotm0031#11 - #hotm0031#10);
     |SINO;
          |SI nMes = #hotm0031#6;       || mes desde
               nNume1 = nLineas * (nNaturDesde - #hotm0031#10);
          |FINSI;
          |SI nMes = #hotm0031#7;       || mes hasta
               nNume1 = nLineas * #hotm0031#11;
          |FINSI;
     |FINSI;
     nTotalLineas = nTotalLineas + nNume1;
|FPRC;

|PROCESO nomhicli;
     #hotm0028#0 = #labtraba#87;
     #hotm0028#1 = #nomhicli#4;
     |LEE 000#hotm0028.=;
     |SI FSalida = 0;
          nLineas = (#nomhicli#11 * #nomhicli#10);
          ||HAZ TotalLinea;
          nTotalLineas = nTotalLineas + nLineas;
     |FINSI;
|FPRC;

|PROCESO nomcalli;
     #hotm0028#0 = #labtraba#87;
     #hotm0028#1 = #nomcalli#4;
     |LEE 000#hotm0028.=;
     |SI FSalida = 0;
          nLineas = (#nomcalli#11 * #nomcalli#10);
          ||HAZ TotalLinea;
          nTotalLineas = nTotalLineas + nLineas;
     |FINSI;
|FPRC;

|PROCESO DiasInc;
   |SI #hotm0030#3 [ #hotm0031#2;
      CalcDesde = #hotm0031#2;
   |SINO;
      CalcDesde = #hotm0030#3;
   |FINSI;
   |SI #hotm0030#4 ] #hotm0031#3;
      CalcHasta = #hotm0031#3;
   |SINO;
      CalcHasta = #hotm0030#4;
   |FINSI;
   NumDias = NumDias + (CalcHasta - CalcDesde + 1);
|FPRC;

|DEFBUCLE DiasInc;
   #hotm0030#1;
   ;
   #hotm0012#0, #hotm0012#1, 001;
   #hotm0012#0, #hotm0012#1, 999;
   ;
   NULL,DiasInc;
|FIN;

|PROCESO TomaDatos;
     nSwError = 0;

     |BUCLE DiasInc;
/*
     #hotm0030#0 = #hotm0012#0;
     #hotm0030#1 = #hotm0012#1;
     #hotm0030#2 = 1;
     |LEE 000#hotm0030.];
     |PARA; |SI FSalida = 0; |Y #hotm0030#0 = #hotm0012#0; |Y #hotm0030#1 = #hotm0012#1;
     |HACIENDO;
          |SI #hotm0031#2 ] #hotm0030#3;|Y #hotm0031#2 [ #hotm0030#4;
               || si el "desde" entra en el tramo de indicencia
               nSwError = 1;
               |SAL;
          |FINSI;
          |SI #hotm0031#3 ] #hotm0030#3;|Y #hotm0031#3 [ #hotm0030#4;
               || si el "hasta" entra en el tramo de indicencia
               nSwError = 1;
               |SAL;
          |FINSI;
          |LEE 000#hotm0030.s;
     |SIGUE;
     |SI nSwError = 1;   |ACABA;   |FINSI;
*/
     #labtraba#0 = #hotm0012#0;
     #labtraba#1 = #hotm0012#1;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          fFech1 = #labtraba#36;
          |SI fFech1 ] #hotm0031#2;
               || si el "alta" entra en el tramo seleccionado
               nSwError = 1;
          |FINSI;
          |SI #labtraba#37 ! "          ";|Y #labtraba#37 ! "          ";
               fFech1 = #labtraba#37;
               |SI fFech1 [ #hotm0031#3;
                    || si la "baja" entra en el tramo seleccionado
                    nSwError = 1;
               |FINSI;
          |FINSI;
     |SINO;
          nSwError = 1;
     |FINSI;
     |SI nSwError = 1;   |ACABA;   |FINSI;

     nTotalLineas = 0;
     #nomcalca#0 = #hotm0012#0;
     #nomcalca#1 = #hotm0012#1;
     #nomcalca#2 = nMes;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          nCoefic1 = nCalc1 / 30;
          nCoefic2 = (nCalc1 - NumDias) / #nomcalca#8;
          Calc = nCalc1 - NumDias;
          |SI Calc > #nomcalca#8;  nCoefic2 = 1;  |FINSI;
          |BUCLELIN 2nomcalli#nomcalca;
     |SINO;
          #nomhicca#0 = #hotm0012#0;
          #nomhicca#1 = #hotm0012#1;
          #nomhicca#66 = nAnyo $ 100;        || es de 2 digitos
          #nomhicca#2 = nMes;
          #nomhicca#3 = 0;
          |LEE 000#nomhicca.=;
          |SI FSalida = 0;
               nCoefic1 = nCalc1 / 30;
               nCoefic2 = (nCalc1 - NumDias) / #nomhicca#8;
               Calc = nCalc1 - NumDias;
               |SI Calc > #nomcalca#8;  nCoefic2 = 1;  |FINSI;
               |BUCLELIN 2nomhicli#nomhicca;
          |SINO;
               nSwError = 1;
          |FINSI;
     |FINSI;
     |SI nSwError = 1;   |ACABA;   |FINSI;

     #hotm0010#0 = #hotm0012#0;
     #hotm0010#1 = #hotm0012#1;
     #hotm0010#2 = nAnyo;
     #hotm0010#3 = nMes;
     #hotm0010#4 = 1;
     |LEE 000#hotm0010.];
     |SI FSalida = 0;|Y #hotm0010#0 = #hotm0012#0;|Y #hotm0010#1 = #hotm0012#1;
                     |Y #hotm0010#2 = nAnyo;      |Y #hotm0010#3 = nMes;
          |PARA; |SI FSalida = 0; |Y #hotm0010#0 = #hotm0012#0; |Y #hotm0010#1 = #hotm0012#1;
                                  |Y #hotm0010#2 = nAnyo; |Y #hotm0010#3 = nMes;
          |HACIENDO;
               nCentro  = #hotm0010#5;
               aArea    = #hotm0010#7;
               aSeccion = #hotm0010#9;
               nCoefic  = #hotm0010#11;
               nDias    = #hotm0010#12;
               |SI nCentro ] #hotm0031#0; |O nCentro [ #hotm0031#1;
                    |HAZ GrabaDatos;
               |FINSI;
               |LEE 000#hotm0010.s;
          |SIGUE;
     |SINO;
          #hotm0013#0 = #hotm0012#0;
          #hotm0013#1 = #hotm0012#1;
          #hotm0013#2 = 1;
          |LEE 000#hotm0013.];
          |PARA; |SI FSalida = 0; |Y #hotm0013#0 = #hotm0012#0; |Y #hotm0013#1 = #hotm0012#1;
          |HACIENDO;
               nCentro  = #hotm0013#3;
               aArea    = #hotm0013#5;
               aSeccion = #hotm0013#7;
               nCoefic  = #hotm0013#9;
               nDias    = #hotm0013#10;
               |SI nCentro ] #hotm0031#0; |O nCentro [ #hotm0031#1;
                    |HAZ GrabaDatos;
               |FINSI;
               |LEE 000#hotm0013.s;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO CreaTempReal;
     NumDias = 0;
     |PARA nAnyo = #hotm0031#8; |SI nAnyo [ #hotm0031#9; |HACIENDO nAnyo = nAnyo + 1;
          |PARA nMes = #hotm0031#6; |SI nMes [ #hotm0031#7; |HACIENDO nMes = nMes + 1;
               |HAZ TomaDatos;
          |SIGUE;
     |SIGUE;
|FPRC;

|DEFBUCLE CreaTempReal;
     #hotm0012#1;
     ;
         1,     1;
     99999, 99999;
     ;
     NULL, CreaTempReal;
|FIN;

|PROCESO Informe;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |INFOR "hotm0031";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     aAlfa1 = Usuario;
     |QBF aAlfa1;
     |NOME_DAT #hotm0032#aAlfa1#;
     |DELINDEX #hotm0032;
     |ABRE #hotm0032;
     |ABRE #hotm0030;
     |ABRE #hotm0028;
     |ABRE #labtraba;
     |ABRE #hotm0021;
     |ABRE #hotm0022;
     |ABRE #nomcalca;
     |ABRE #nomhicca;
     |ABRE #nomhicli;
     |ABRE #hotm0010;
     |ABRE #hotm0013;
     |BUCLE CreaTempReal;
     |CIERRA #hotm0013;
     |CIERRA #hotm0010;
     |CIERRA #hotm0028;
     |BUCLE ImpreCompara;
     SwCentro = 0;
     SwArea = 0;
     SwSeccion = 0;
     |SI #hotm0031#5 = "S"; SwBlanco = 1; |FINSI;
     SwTotCentro = 1;
     SwTotArea = 1;
     |PRINT;
     SwTotArea = 0;
     SwTotCentro = 0;
     |PIEINF;
     |FININF;
     |FINIMP;

     |CIERRA #nomhicli;
     |CIERRA #nomhicca;
     |CIERRA #nomcalca;
     |CIERRA #hotm0022;
     |CIERRA #hotm0021;
     |CIERRA #hotm0030;
     |CIERRA #labtraba;
     |CIERRA #hotm0032;
     |DELINDEX #hotm0032;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Informe de situacion";

     |PINPA #0#hotm0031;
     |PINDA #0#hotm0031;
     |ENDATOS #1#hotm0031;
     |SI FSalida = 0;

          || carga el desde de a¤o-mes
          aAlfa1 = #hotm0031#2; aAlfa1 = aAlfa1 % 102;  #hotm0031#10 = aAlfa1;
          aAlfa1 = #hotm0031#2; aAlfa1 = aAlfa1 % 402;  #hotm0031#6 = aAlfa1;
          aAlfa1 = #hotm0031#2; aAlfa1 = aAlfa1 % -104; #hotm0031#8 = aAlfa1;

          || carga el hasta de a¤o-mes
          aAlfa1 = #hotm0031#3; aAlfa1 = aAlfa1 % 102;  #hotm0031#11 = aAlfa1;
          aAlfa1 = #hotm0031#3; aAlfa1 = aAlfa1 % 402;  #hotm0031#7 = aAlfa1;
          aAlfa1 = #hotm0031#3; aAlfa1 = aAlfa1 % -104; #hotm0031#9 = aAlfa1;

          || carga el ratio de numero de personas, se entiende 1 persona 30 dias
          nNume1 = #hotm0031#2;
          nNume2 = #hotm0031#3;
          nCalc1 = nNume2 - nNume1 + 1;
          NumDias = 0;

          |SI #hotm0031#6 = 1;     nNaturDesde = 31;   |FINSI;
          |SI #hotm0031#6 = 2;     nNaturDesde = 28;   |FINSI;
          |SI #hotm0031#6 = 3;     nNaturDesde = 31;   |FINSI;
          |SI #hotm0031#6 = 4;     nNaturDesde = 30;   |FINSI;
          |SI #hotm0031#6 = 5;     nNaturDesde = 31;   |FINSI;
          |SI #hotm0031#6 = 6;     nNaturDesde = 30;   |FINSI;
          |SI #hotm0031#6 = 7;     nNaturDesde = 31;   |FINSI;
          |SI #hotm0031#6 = 8;     nNaturDesde = 31;   |FINSI;
          |SI #hotm0031#6 = 9;     nNaturDesde = 30;   |FINSI;
          |SI #hotm0031#6 = 10;    nNaturDesde = 31;   |FINSI;
          |SI #hotm0031#6 = 11;    nNaturDesde = 30;   |FINSI;
          |SI #hotm0031#6 = 12;    nNaturDesde = 31;   |FINSI;

          |HAZ Informe;
     |FINSI;
|FPRO;
