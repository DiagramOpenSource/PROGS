|FICHEROS;
     gomcamco #0;

     nomtmp05 #10,MANTE;
     labtraba #2;
     labpadre;
     silcon06 #20;
     silcon13 #21;
|FIN;

|VARIABLES;
   aAlfa  = "";
   aAlfa1  = "";
   aMarca = "";
   nCalc  = 0;
   nOpcion = 0;
   nNumTrab = 0;

{-1}Menu  = "";
    Menu1 = "2400";
    Menu2 = "1";
    Menu3 = "";
    Menu4 = "RAC";
    Menu5 = " Revisar ";
    Menu6 = " Preparar remesa";
    Menu7 = " Cancelar ";

     aFechaBaja = "";
     fFechaBaja = @;
     nFechaBaja = 0;

     aFechaLim = "";
     fFechaLim = @;
     nFechaLim = 0;
     swSigue = 0;
     red_ultimo = 0;
|FIN;

|PROCESO Marcalo; |TIPO 0;
     |SI #nomtmp05#5 = "*";
          #nomtmp05#5 = " ";
     |SINO;
          #nomtmp05#5 = "*";
     |FINSI;

     |PINTA #nomtmp05#5; |GRABA 020#nomtmp05.a;
     |ERROR;
|FPRC;

|PROCESO MarcaDesmarca;
     #nomtmp05#5 = aMarca; |GRABA 020#nomtmp05.a;
|FPRC;

|DEFBUCLE MarcaDesmarca;
     #nomtmp05#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, MarcaDesmarca;
|FIN;

|PROCESO MiraMarca; |TIPO 11;
     |SI FSalida = 12; || Desmarca todo
          |SALVA_FICHA #nomtmp05;
          aMarca = " "; |BUCLE MarcaDesmarca;
          |REPON_FICHA #nomtmp05;
          |PTEC 808; |PONCONTROL 23, "si";
     |FINSI;

     |SI FSalida = 13; || Marca todo
          |SALVA_FICHA #nomtmp05;
          aMarca = "*"; |BUCLE MarcaDesmarca;
          |REPON_FICHA #nomtmp05;
          |PTEC 808; |PONCONTROL 23, "si";
     |FINSI;
|FPRC;

|RUTINA inf04;
   #nomtmp05#0 = 00001
   #nomtmp05#1 = 00001
|FRUT;

|RUTINA sup04;
   #nomtmp05#0 = 99999;
   #nomtmp05#1 = 99999;
|FRUT;

|PROCESO borralo1;
     |BORRA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE borralo;
     #21#2;
     14;
     #2#0, #2#1, 0;
     #2#0, #2#1, 0;
     be;
     NULL, borralo1;
|FIN;

|PROCESO el_red;
          #labtraba#0 = #nomtmp05#0;
          #labtraba#1 = #nomtmp05#1;

          |LEE 000#labtraba.=;
/*
          |DDEFECTO #labpadre;
          |ABRE #labpadre;
          #labpadre#0 = #labtraba#0;
          #labpadre#1 = #labtraba#1;
          |LEE 000#labpadre.=;
          |CIERRA #labpadre;
*/
          |ABRE #21;
          |LEE 000#21u;
          |SI FSalida ! 0;
               red_ultimo = 1;
          |SINO;
               red_ultimo = #21#0 + 1;
          |FINSI;
          |CIERRA #21;

          |BUCLE borralo;

          |ABRE #21;
          |DDEFECTO #21;
          #21#0 = red_ultimo;
          |GRABA 020#21b;

          #21#1 = #nomtmp05#0;          || empresa
          #21#2 = #nomtmp05#1;          || trabajador
          #21#3 = "AMC";                || Comunicacion modalidad cotizacion


          #21#5 = "";           || mod.duracion 2104/84
          |SI #2#45 ] "014";|Y #2#45 [ "017";   #21#5 = #2#45; |FINSI;
          #21#6 = " ";         || calif. per. horas
          #21#7 = 0;      || nro. horas contrato (A)
          #21#8 = 0;      || nro. horas empresa/convenio (B)
          #21#12 = 0;
          #21#13 = "";     || fecha incidencia
          #21#14 = 0;         || nro. de lote
          #21#15 = 0;   || nro. minutos contrato (A)
          #21#16 = 0;   || nro. minutos empresa/convenio (B)
          || #21#17 = #labpadre#2;    || nombre padre
          || #21#18 = #labpadre#3;    || nombre madre
          #21#17 = #labtraba#249;     || nombre padre
          #21#18 = #labtraba#250;     || nombre madre
          #21#19 = #labtraba#244;  || telefono
          #21#20 = "0";                           || desempleado: no inscrito
          #21#21 = "N";
          #21#22 = "N";
          #21#23 = "N";
          #21#24 = 0;                        || grado minusvalia
          #21#25 = "0";
          #21#30 = "N";
          #21#31 = "N";
          #21#37 = " ";
          #21#38 = "0";
          #21#40 = 0;     || A¤o Jornadas Reales
          #21#41 = 0;     || Mes Jornadas Reales
          #21#42 = " ";
          #21#12 = 0;                  || Coef. T.P. no admisible en agrarios
          #21#54 = 0;
          |SI #labtraba#42 = "A"; |O #labtraba#42 = "e";
               #21#54 = 1;
          |FINSI;
          |SI #labtraba#42 = "E";
               #21#54 = 2;
          |FINSI;
          |GRABA 020#21a;
          |LIBERA #21;
          |CIERRA #21;

          nNumTrab = nNumTrab + 1;
|FPRC;

|DEFBUCLE el_red;
     #nomtmp05#1;
     5;
     00001, 00001, "*";
     99999, 99999, "*";
     ;
     NULL, el_red;
|FIN;

|PROCESO Lote;
     |ABRE #labtraba;

     |BUCLE el_red;

     |CIERRA #labtraba;

     |SI nNumTrab > 0;
          aAlfa1 = nNumTrab;
          aAlfa = "    Se ha preparado la remesa de comunicación de modalidad ";
          aAlfa = aAlfa + "de cotización para " + aAlfa1 + " trabajadores."
          |MENAV aAlfa;

          aAlfa = "    Puede crear el lote desde la opción - Creación Lote ";
          aAlfa = aAlfa + "AFI - para el Sistema RED";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Trabajadores;
/*
     aFechaBaja = #labtraba#37;
     fFechaBaja = aFechaBaja;
     nFechaBaja = fFechaBaja;
     |QBF aFechaBaja;

     aFechaLim = "01.01.2009";
     fFechaLim = aFechaLim;
     nFechaLim = fFechaLim;

     swSigue = 1;
     |SI aFechaBaja ! ""; |Y aFechaBaja ! "..........";
          |SI nFechaBaja [ nFechaLim;
               swSigue = 0;
          |SINO;
               swSigue = 1;
          |FINSI;
     |FINSI;
*/

     swSigue = 1;

     |SI #labtraba#42 ! "A"; |Y #labtraba#42 ! "E"; |Y #labtraba#42 ! "e";
          swSigue = 0;
     |FINSI;

     #20#0 = #labtraba#0;
     |LEE 000#20=;
     |SI FSalida ! 0;
          swSigue = 0;
     |FINSI;

     |SI swSigue = 1;
          |DDEFECTO #nomtmp05;
          #nomtmp05#0 = #labtraba#0;
          #nomtmp05#1 = #labtraba#1;
          #nomtmp05#2 = #labtraba#2;
          #nomtmp05#3 = #labtraba#45;
          #nomtmp05#4 = #labtraba#42;
          #nomtmp05#5 = " ";
          #nomtmp05#6 = #labtraba#36;
          |GRABA 020#nomtmp05.n;
          nNumTrab = nNumTrab + 1;
     |FINSI;
|FPRC;

|DEFBUCLE Trabajadores;
     #labtraba#1;
     247;
     #gomcamco#0, #gomcamco#2, 613;
     #gomcamco#1, #gomcamco#3, 613;
     ;
     NULL, Trabajadores;
|FIN;


|PROGRAMA;
     |CLS;
     |CABEZA " ";

     |PINPA #0#0; |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          aAlfa = "05" + Usuario; |NOME_DAT #nomtmp05#aAlfa#;
          |DELINDEX #nomtmp05;
          |ABRE #nomtmp05;
          nNumTrab = 0;
          |ABRE #20;
          |BUCLE Trabajadores;
          |ET OtraVez;
          |ENTLINEAL #1#nomtmp05, -2, 4, 21, 1, inf04, sup04;
          |SI nNumTrab = 0;
              |CIERRA #20;
              |CIERRA #nomtmp05;
              |DELINDEX #nomtmp05;
              |ACABA;
          |FINSI;

      |ET OtroMenu;
      |MENU Menu;
      nOpcion = FSalida;
      |SI nOpcion = 1; |VETE OtraVez;   |FINSI;
      |SI nOpcion = 2;
           nNumTrab = 0;
           |HAZ Lote;
      |FINSI;
      |SI nOpcion = 3;
         aAlfa = "    N" + &191 + " Está seguro de salir sin aplicar los cambios ?";
         |CONFI aAlfa;
         |SI FSalida ! 0; |VETE OtraVez; |FINSI;
      |FINSI;
      |SI nOpcion < 1; |VETE OtroMenu; |FINSI;
      |CIERRA #nomtmp05;   |DELINDEX #nomtmp05;
      |CIERRA #20;
     |FINSI;
|FPRO;
