|FICHEROS;
     aomasitc #0;
     aomasitl #1;
     labtraba #2;
     aomparam #10;

     agifa041@;
     gomantho@;
     gomantl1@;
     gopre001@;
     gosubcoc@;
     agifa112@;
     referen@;
|FIN;

|VARIABLES;
     aAlfa = "";
     aPath = "";
     aFich = "";
     aDef = "";
     nSal = 0;
     aProve = "";
     nModo = 0;
     aSerPre = "";
     nNumPre = 0;
     aEstado = "";
|FIN;

|PROCESO Tipo8; |TIPO 8;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     |DBASS aPath;
     aPath = aPath + #10#1; |QBF aPath;
     aDef = aPath + "def/";
     aFich = aPath + "fich/";
|FPRC;

|PROCESO Consulta;
     |CONSULTA_CLAVE #1#0;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |HAZ Empresa;
     |HAZ Expediente;
     |HAZ Presupuesto;
     |HAZ Proveedor;
     |HAZ Subcontrata;
|FPRC;

|PROCESO Empresa66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |HAZ Consulta; |ACABA; |FINSI;

     aAlfa = aDef + "agifa041";
     |CARGA_DEF aAlfa, agifa041@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/";
          |PATH_DAT #agifa041@#aAlfa#;
          |ABRE #agifa041@;
          #agifa041@#0 = #0#0;
          |LEE 000#agifa041@.];
          |CONSULTA_CLAVE #1#agifa041@;
          |SI FSalida = 0;
               #0#0 = #agifa041@#0; |PINTA #0#0;
               |ERROR;
               |PTEC 802;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #agifa041@;
          |DESCARGA_DEF #agifa041@;
     |FINSI;
|FPRC;

|PROCESO Expedientes;
     |SI #gomantho@#9 ! "T";
          |SALVA_DATOS #gomantho@;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE Expedientes;
     #gomantho@#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     ;
     NULL, Expedientes;
|FIN;

|PROCESO Expediente66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |HAZ Consulta; |ACABA; |FINSI;

     aAlfa = aDef + "gomantho";
     |CARGA_DEF aAlfa, gomantho@;
     |SI FSalida = 0;
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               aAlfa = aPath + "fich/";
               aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
               |PATH_DAT #gomantho@#aAlfa#;
               aAlfa = Usuario;
               |NOME_DAT #referen@#aAlfa#;
               |DELINDEX #referen@;
               |ABRE #referen@;
               |BUCLE Expedientes;
               #referen@#0 = #0#1;
               #referen@#1 = #0#2;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#1 = #referen@#0; |PINTA #0#1;
                    #0#2 = #referen@#1; |PINTA #0#2;
                    |ERROR;
                    |PTEC 802;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |DESCARGA_DEF #gomantho@;
     |FINSI;
|FPRC;

|PROCESO LinExpe;
     |SI #gomantl1@#10 ! "T";
          #gopre001@#0 = #gomantl1@#3;
          #gopre001@#1 = #gomantl1@#4;
          |LEE 000#gopre001@.=;
          |SI FSalida = 0;
               |SALVA_DATOS #gopre001@;
               |REPON_DATOS #referen@;
               |GRABA 020#referen@.n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE LinExpe;
     #gomantl1@#1003;
     ;
     #0#1, #0#2, 001;
     #0#1, #0#2, 999;
     ;
     NULL, LinExpe;
|FIN;

|PROCESO Presupuesto66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |HAZ Consulta; |ACABA; |FINSI;

     aAlfa = aDef + "gopre001";
     |CARGA_DEF aAlfa, gopre001@;
     |SI FSalida = 0;
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               aAlfa = aDef + "gomantl1";
               |CARGA_DEF aAlfa, gomantl1@;
               |SI FSalida = 0;
                    aAlfa = aPath + "fich/";
                    aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
                    |PATH_DAT #gomantl1@#aAlfa#;
                    |PATH_DAT #gopre001@#aAlfa#;
                    aAlfa = Usuario;
                    |NOME_DAT #referen@#aAlfa#;
                    |DELINDEX #referen@;
                    |ABRE #gopre001@;
                    |ABRE #referen@;
                    |BUCLE LinExpe;
                    |CIERRA #gopre001@;
                    #referen@#0 = #0#3;
                    #referen@#0 = #0#4;
                    |LEE 000#referen@.];
                    |CONSULTA_CLAVE #1#referen@;
                    |SI FSalida = 0;
                         #0#3 = #referen@#0; |PINTA #0#3;
                         #0#4 = #referen@#1; |PINTA #0#4;
                         |ERROR;
                         |PTEC 802;
                    |SINO;
                         |ERROR;
                    |FINSI;
                    |CIERRA #referen@;
                    |DELINDEX #referen@;
                    |DESCARGA_DEF #gomantl1@;
               |FINSI;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |DESCARGA_DEF #gopre001@;
     |FINSI;
|FPRC;

|PROCESO SubConPrv;
     #agifa112@#0 = #gosubcoc@#2;
     |LEE 000#agifa112@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #agifa112@;
          |REPON_DATOS #referen@;
          |GRABA 000#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE SubConPrv;
     #gosubcoc@#3002;
     20;
     #0#3, #0#4, "N";
     #0#3, #0#4, "N";
     ;
     NULL, SubConPrv;
|FIN;

|PROCESO Proveedor66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |HAZ Consulta; |ACABA; |FINSI;

     aAlfa = aDef + "gosubcoc";
     |CARGA_DEF aAlfa, gosubcoc@;
     |SI FSalida = 0;
          aAlfa = aDef + "agifa112";
          |CARGA_DEF aAlfa, agifa112@;
          |SI FSalida = 0;
               aAlfa = aDef + "agifa112";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    aAlfa = aPath + "fich/";
                    aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
                    |PATH_DAT #gosubcoc@#aAlfa#;
                    |PATH_DAT #agifa112@#aAlfa#;
                    aAlfa = Usuario;
                    |NOME_DAT #referen@#aAlfa#;
                    |DELINDEX #referen@;
                    |ABRE #agifa112@;
                    |ABRE #referen@;
                    |BUCLE SubConPrv;
                    |CIERRA #agifa112@;
                    #referen@#0 = #0#5;
                    |LEE 000#referen@.];
                    |CONSULTA_CLAVE #1#referen@;
                    |SI FSalida = 0;
                         #0#5 = #referen@#0; |PINTA #0#5;
                         |ERROR;
                         |PTEC 802;
                    |SINO;
                         |ERROR;
                    |FINSI;
                    |CIERRA #referen@;
                    |DELINDEX #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
               |DESCARGA_DEF #agifa112@;
          |FINSI;
          |DESCARGA_DEF #gosubcoc@;
     |FINSI;
|FPRC;

|PROCESO Subcontra;
     |SALVA_DATOS #gosubcoc@;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE Subcontra;
     #gosubcoc@#3002;
     20, 2;
     #0#3, #0#4, "N", #0#5;
     #0#3, #0#4, "N", #0#5;
     ;
     NULL, Subcontra;
|FIN;

|PROCESO Subcontrata66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |HAZ Consulta; |ACABA; |FINSI;

     aAlfa = aDef + "gosubcoc";
     |CARGA_DEF aAlfa, gosubcoc@;
     |SI FSalida = 0;
          aAlfa = aDef + "gosubcoc";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               aAlfa = aPath + "fich/";
               aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
               |PATH_DAT #gosubcoc@#aAlfa#;
               aAlfa = Usuario;
               |NOME_DAT #referen@#aAlfa#;
               |DELINDEX #referen@;
               |ABRE #referen@;
               |BUCLE Subcontra;
               #referen@#0 = #0#6;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#6 = #referen@#0; |PINTA #0#6;
                    |ERROR;
                    |PTEC 802;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |DESCARGA_DEF #gosubcoc@;
     |FINSI;
|FPRC;

|PROCESO Empresa;
     aAlfa = aDef + "agifa041";
     |CARGA_DEF aAlfa, agifa041@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/";
          |PATH_DAT #agifa041@#aAlfa#;
          |DDEFECTO #agifa041@;
          |ABRE #agifa041@;
          #agifa041@#0 = #0#0;
          |LEE 000#agifa041@.=;
          nSal = FSalida;
          |PINTA 735, #agifa041@#1;
          |CIERRA #agifa041@;
          |DESCARGA_DEF #agifa041@;
     |FINSI;
|FPRC;

|PROCESO Expediente;
     aAlfa = aDef + "gomantho";
     |CARGA_DEF aAlfa, gomantho@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/";
          aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
          |PATH_DAT #gomantho@#aAlfa#;
          |DDEFECTO #gomantho@;
          |ABRE #gomantho@;
          #gomantho@#0 = #0#1;
          #gomantho@#1 = #0#2;
          |LEE 000#gomantho@.=;
          nSal = FSalida;
          aEstado = #gomantho@#9;
          |PINTA 835, #gomantho@#29;
          |CIERRA #gomantho@;
          |DESCARGA_DEF #gomantho@;
     |FINSI;
|FPRC;

|PROCESO Presupuesto;
     aAlfa = aDef + "gopre001";
     |CARGA_DEF aAlfa, gopre001@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/";
          aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
          |PATH_DAT #gopre001@#aAlfa#;
          |DDEFECTO #gopre001@;
          |ABRE #gopre001@;
          #gopre001@#0 = #0#3;
          #gopre001@#1 = #0#4;
          |LEE 000#gopre001@.=;
          nSal = FSalida;
          |C_A #gopre001@#8, 1, 43;
          |PINTA 935, #gopre001@#8;
          |CIERRA #gopre001@;
          |DESCARGA_DEF #gopre001@;
     |FINSI;
|FPRC;

|PROCESO Proveedor;
     aAlfa = aDef + "agifa112";
     |CARGA_DEF aAlfa, agifa112@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/";
          aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
          |PATH_DAT #agifa112@#aAlfa#;
          |DDEFECTO #agifa112@;
          |ABRE #agifa112@;
          #agifa112@#0 = #0#5;
          |LEE 000#agifa112@.=;
          |PINTA 1035, #agifa112@#1;
          nSal = FSalida;
          |CIERRA #agifa112@;
          |DESCARGA_DEF #agifa112@;
     |FINSI;
|FPRC;

|PROCESO Subcontrata;
     aAlfa = aDef + "gosubcoc";
     |CARGA_DEF aAlfa, gosubcoc@;
     |SI FSalida = 0;
          aAlfa = aPath + "fich/";
          aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
          |PATH_DAT #gosubcoc@#aAlfa#;
          |DDEFECTO #gosubcoc@;
          |ABRE #gosubcoc@;
          #gosubcoc@#0 = #0#6;
          |LEE 000#gosubcoc@.=;
          nSal = FSalida;
          aSerPre = #gosubcoc@#4;
          nNumPre = #gosubcoc@#5;
          aProve = #gosubcoc@#2;
          aEstado = #gosubcoc@#20;
          |CIERRA #gosubcoc@;
          |DESCARGA_DEF #gosubcoc@;
     |FINSI;
|FPRC;

|PROCESO Empresa0; |TIPO 0;
     |HAZ Empresa;
     |SI nSal ! 0;
          |MENAV "0000No existe Empresa...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Expediente0; |TIPO 0;
     |HAZ Expediente;
     |SI nSal ! 0;
          |MENAV "0000No existe Expediente...";
          |ERROR;
     |SINO;
          |SI aEstado = "T";
               |MENAV "0000Expediente terminado...";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Presupuesto0; |TIPO 0;
     |HAZ Presupuesto;
     |SI nSal ! 0;
          |MENAV "0000No existe Presupuesto...";
          |ERROR;
     |SINO;
          aAlfa = aDef + "gomantl1";
          |CARGA_DEF aAlfa, gomantl1@;
          |SI FSalida = 0;
               aAlfa = aPath + "fich/";
               aAlfa = aAlfa + (("00000" + #0#0) % -105) + "/";
               |PATH_DAT #gomantl1@#aAlfa#;
               |ABRE #gomantl1@;
               |SELECT #3#gomantl1@;
               #gomantl1@#3 = #0#3;
               #gomantl1@#4 = #0#4;
               |LEE 000#gomantl1@.=;
               |SI FSalida ! 0; |O #gomantl1@#3 ! #0#3; |O #gomantl1@#4 ! #0#4;
                    aAlfa = "0000Presupuesto no asignado al expediente...";
                    |MENAV aAlfa;
                    |ERROR;
               |SINO;
                    |SI FSalida = 0; |Y  #gomantl1@#10 = "T";
                         |MENAV "0000Presupuesto terminado...";
                         |ERROR;
                    |FINSI;
               |FINSI;
               |CIERRA #gomantl1@;
               |DESCARGA_DEF #gomantl1@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Proveedor0; |TIPO 0;
     |HAZ Proveedor;
     |SI nSal ! 0;
          |MENAV "0000No existe Proveedor...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Subcontrata0; |TIPO 0;
     |HAZ Subcontrata;
     |SI nSal ! 0;
          |MENAV "0000No existe Subcontrata...";
          |ERROR;
     |SINO;
          |SI aSerPre ! #0#3; |O nNumPre ! #0#4;
               aAlfa = "0000Subcontrata del presupuesto:" + aSerPre + "/" + (("000000" + nNumPre)% -106);
               |MENAV aAlfa;
               |ERROR;
          |SINO;
               |SI aProve ! #0#5;
                    aAlfa = "0000Subcontrata con proveedor:" + aProve;
                    |MENAV aAlfa;
                    |ERROR;
               |SINO;
                    |SI aEstado = "S";
                         |MENAV "0000Subcontrata finalizada...";
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Min2;
     #2#0 = #1#0;
     #2#1 = 1;
|FPRC;

|PROCESO Max2;
     #2#0 = #1#0;
     #2#1 = 99999;
|FPRC;

|PROCESO Trabajador; |TIPO 66;
     |ABRE #2;
     #2#0 = #1#0;
     #2#1 = #1#8;
     |LEE 000#2];
     |CONSULTA_F_CLAVE #1#2, Min2, Max2;
     |SI FSalida = 0;
          #1#8 = #2#1; |PINTA #1#8;
          #1#9 = #2#2; |PINTA #1#9;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;
