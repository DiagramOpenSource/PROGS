|FICHEROS;
     nomvenc1 #0;
     labtraba;
     nomcateg;
|FIN;

|VARIABLES;
     nCategoria = 0;
     nLimEdad = 0;
     nLimPerm = 0;
     fFecha = "";

     fFechaRef = @;
     nFechaRef = 0;
     aFechaRef = "";
     nDiaRef = 0;
     nMesRef = 0;
     nAnyRef = 0;
     aDiaRef = "";
     aMesRef = "";
     aAnyRef = "";

     fFechaNac = @;
     nFechaNac = 0;
     aFechaNac = "";
     nDiaNac = 0;
     nMesNac = 0;
     nAnyNac = 0;
     aDiaNac = "";
     aMesNac = "";
     aAnyNac = "";

     fFechaNacLim = @;
     nFechaNacLim = 0;
     &aFechaNacLim = "";
     nDiaNacLim = 0;
     nMesNacLim = 0;
     nAnyNacLim = 0;
     aDiaNacLim = "";
     aMesNacLim = "";
     aAnyNacLim = "";

     fFechaAlta = @;
     nFechaAlta = 0;
     aFechaAlta = "";
     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     aDiaAlta = "";
     aMesAlta = "";
     aAnyAlta = "";

     fFechaAltaLim = @;
     nFechaAltaLim = 0;
     &aFechaAltaLim = "";
     nDiaAltaLim = 0;
     nMesAltaLim = 0;
     nAnyAltaLim = 0;
     aDiaAltaLim = "";
     aMesAltaLim = "";
     aAnyAltaLim = "";

     aFecha1 = "";
     aFecha2 = "";
     fFecha1 = @;
     fFecha2 = @;

     aFecha1Dia = "";
     aFecha1Mes = "";
     aFecha1Any = "";
     nFecha1Dia = 0;
     nFecha1Mes = 0;
     nFecha1Any = 0;

     aFecha2Dia = "";
     aFecha2Mes = "";
     aFecha2Any = "";
     nFecha2Dia = 0;
     nFecha2Mes = 0;
     nFecha2Any = 0;

     nDiasDif = 0;
     nMesesDif = 0;
     nAnyosDif = 0;
     aDias1Dif = "";
     aMeses1Dif = "";
     aAnyos1Dif = "";
     &aDif1 = "";
     aDias2Dif = "";
     aMeses2Dif = "";
     aAnyos2Dif = "";
     &aDif2 = "";

     bisiesto = 0;
     numer = 0;
     anynum = 0;
     mesnum = 0;
     topemes = 0;

     &aAle1 = "";
     &aAle2 = "";
     aAlfa = "";
     swHayAlgo = 0;
|FIN;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
     bisiesto = 0;
     numer = anynum $ 4;
     |SI numer = 0;
          bisiesto = 1;
     |FINSI;
     topemes = 31;
     |SI mesnum= 2;
          topemes = 28 + bisiesto;
     |FINSI;
     |SI mesnum= 4;|O mesnum= 6;|O mesnum= 9;|O mesnum=11;
          topemes = 30;
     |FINSI;
|FPRC;

|PROCESO diffechas;
     aFecha1 = fFecha1;
     aFecha2 = fFecha2;

     aFecha1Dia = aFecha1 % 102;
     aFecha1Mes = aFecha1 % 402;
     aFecha1Any = aFecha1 % -104;
     nFecha1Dia = aFecha1Dia;
     nFecha1Mes = aFecha1Mes;
     nFecha1Any = aFecha1Any;

     aFecha2Dia = aFecha2 % 102;
     aFecha2Mes = aFecha2 % 402;
     aFecha2Any = aFecha2 % -104;
     nFecha2Dia = aFecha2Dia;
     nFecha2Mes = aFecha2Mes;
     nFecha2Any = aFecha2Any;

     nAnyosDif = aFecha2Any - nFecha1Any;
     nMesesDif = aFecha2Mes - nFecha1Mes;
     |SI nMesesDif < 0;
          nAnyosDif = nAnyosDif -1;
          nMesesDif = (12 - aFecha1Mes) + aFecha2Mes;
     |FINSI;
     nDiasDif = aFecha2Dia - nFecha1Dia;
     |SI nDiasDif < 0;
          nMesesDif = nMesesDif - 1;
          mesnum = nFecha1Mes;
          anynum = nFecha1Any;
          |HAZ ulti_dia;
          nDiasDif = (topemes - aFecha1Dia) + aFecha2Dia;
     |FINSI;
     |SI nMesesDif < 0;  nMesesDif = 0; |FINSI;
     |SI nDiasDif < 0;  nDiasDif = 0; |FINSI;
|FPRC;


|PROCESO labtraba;
     fFechaRef = #0#6;
     fFechaNac = #labtraba#11;
     fFechaAlta = #labtraba#36;

     aAle1 = "";
     aAle2 = "";

     nCategoria = #labtraba#17;
     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = #labtraba#17;
     |LEE 000#nomcateg.=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;
     nLimEdad = #nomcateg#6;
     nLimPerm = #nomcateg#7;

     aFechaNacLim = "----------";
     aFechaAltaLim = "----------";

     |SI nLimEdad ! 0;
          aFechaNac = fFechaNac;
          aAnyNac = aFechaNac % -104;
          nAnyNac = aAnyNac;
          nAnyNacLim = aAnyNac + nLimEdad;
          aAnyNacLim = nAnyNacLim;
          aFechaNacLim = (aFechaNac % 106) + aAnyNacLim;
          fFechaNacLim = aFechaNacLim;
          fFecha = fFechaNacLim - fFechaRef;

          fFecha1 = fFechaRef;
          fFecha2 = aFechaNacLim;
          |SI fFecha1 ] fFecha2;
               aDif1 = "Limite  excedido";
               aAle1 = "EXC"
          |SINO;
               |HAZ diffechas;
               aDias1Dif = nDiasDif; aDias1Dif = "  " + aDias1Dif; aDias1Dif = aDias1Dif % -102;
               aMeses1Dif = nMesesDif; aMeses1Dif = "  " + aMeses1Dif; aMeses1Dif = aMeses1Dif % -102;
               aAnyos1Dif = nAnyosDif; aAnyos1Dif = "  " + aAnyos1Dif; aAnyos1Dif = aAnyos1Dif % -102;
               aDif1 = aDias1Dif + " d, " + aMeses1Dif + " m, " + aAnyos1Dif + " a";

               |SI nMesesDif = 0; |Y nAnyosDif = 0; aAle1 = "***";   |FINSI;
               |SI nMesesDif = 1; |Y nAnyosDif = 0;  aAle1 = "**";   |FINSI;
               |SI nMesesDif = 2; |Y nAnyosDif = 0;  aAle1 = "*";   |FINSI;
          |FINSI;
     |SINO;
          aDif1 = "-- SIN LIMITE --";
     |FINSI;

     |SI nLimPerm ! 0;
          aFechaAlta = fFechaAlta;
          aAnyAlta = aFechaAlta % -104;
          nAnyAlta = aAnyAlta;
          nAnyAltaLim = aAnyAlta + nLimPerm;
          aAnyAltaLim = nAnyAltaLim;
          aFechaAltaLim = (aFechaAlta % 106) + aAnyAltaLim;
          fFechaAltaLim = aFechaAltaLim;
          fFecha = fFechaAltaLim - fFechaRef;
          fFecha1 = fFechaRef;
          fFecha2 = aFechaAltaLim;
          |SI fFecha1 ] fFecha2;
               aDif2 = "Limite  excedido";
               aAle2 = "EXC"
          |SINO;
               |HAZ diffechas;
               aDias2Dif = nDiasDif; aDias2Dif = "  " + aDias2Dif; aDias2Dif = aDias2Dif % -102;
               aMeses2Dif = nMesesDif; aMeses2Dif = "  " + aMeses2Dif; aMeses2Dif = aMeses2Dif % -102;
               aAnyos2Dif = nAnyosDif; aAnyos2Dif = "  " + aAnyos2Dif; aAnyos2Dif = aAnyos2Dif % -102;
               aDif2 = aDias2Dif + " d, " + aMeses2Dif + " m, " + aAnyos2Dif + " a";

               |SI nMesesDif = 0;  |Y nAnyosDif = 0; aAle2 = "***";   |FINSI;
               |SI nMesesDif = 1;  |Y nAnyosDif = 0; aAle2 = "**";   |FINSI;
               |SI nMesesDif = 2;  |Y nAnyosDif = 0; aAle2 = "*";   |FINSI;
          |FINSI;
     |SINO;
          aDif2 = "-- SIN LIMITE --";
     |FINSI;

     |SI nLimEdad ! 0; |O nLimPerm ! 0;
          swHayAlgo = 1;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     87, 44;
     #0#0, #0#2, #0#4, "A";
     #0#1, #0#3, #0#5, "A";
     ;
     NULL, labtraba;
|FIN;

|PROCESO PonFecha; |TIPO 7;
     fFechaRef = ~;
     aFechaRef = fFechaRef;
     aMesRef = aFechaRef % 402;
     aAnyRef = aFechaRef % -104;
     mesnum = aMesRef;
     anynum = aAnyRef;
     |HAZ ulti_dia;
     aDiaRef = topemes;
     aFechaRef = aFechaRef % -107;
     aFechaRef = aDiaRef + "." + aFechaRef;
     #0#6 = aFechaRef;
     |PINTA #0#6;
|FPRC;

|PROCESO tipo3; |TIPO 3;
     |SI FSalida = 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "nomvenc1";
               |ABRE #nomcateg;
               |BUCLE labtraba;
               |CIERRA #nomcateg;
               |PIEINF;
               |FININF;
               |SI swHayAlgo = 0;
                    aAlfa = "    ATENCION: No existen trabajadores de alta ";
                    aAlfa = aAlfa + "en categorias con vencimientos";
                    |MENAV aAlfa;
               |FINSI;
               |FINIMP;
          |FINSI;
     |FINSI;
|FPRC;
