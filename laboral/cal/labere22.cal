|FICHEROS;
     labere22 #0;
     labere23;
     labempre;
     labtraba;
     labcentr;
     nomcenes;

     nomcalca;
     nomhicca;
|FIN;

|VARIABLES;
     swSigue = 0;
     nNumTrab = 0;
     alfa1 = "";
     fecalf = "";
     dia = 0;
     mes = 0;
     any = 0;
     swfuera = 0;
     nAny = 0;
     nMes = 0;
     aAlfa = "";
     aAlfa1 = "";
     swAlguno = 0;
     nModo = 0;

     &enEmpresa = 0;
     &enAny = 0;
     &enMes = 0;
     &enNroERE = 0;

     &eaCta = "";
     &eaPais = "";
     &eaIBAN = "";

     {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "";
     aMenu4 = "CSP";
     aMenu5 = "Comunicaci¢n";
     aMenu6 = "Solicitud Prestaciones";
     aMenu7 = "Plantilla Baja ERTE";

     {-1}aMenuExcel = "";
     aMenuExcel1 = "2400";
     aMenuExcel2 = "2";
     aMenuExcel3 = "Formato: ";
     aMenuExcel4 = "SX";
     aMenuExcel5 = "XLS (Excel 2007 y anteriores)";
     aMenuExcel6 = "XLSX (Excel 2010 y posteriores)";

     &nOpcion = 0;
     nOpcionExcel = 0;

     aMarca = "";
     nEmp = 0;
     nERE = 0;
     nTra = 0;

     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     nDia = 0;
     swIT = 0;
     swAltaCompleta = 0;

     aCampo2 = "";
     aCampo3 = "";
     aCampo4 = "";
     aCampo5 = "";
     aCampo6 = "";
     aCampo7 = "";
     aCampo8 = "";
     aCampo9 = "";
     aCampo10 = "";
     aCampo11 = "";
     &eaFormato = "";
|FIN;

/****************************************************************************/
/******************** PROCESOS CABECERA PANTALLA ****************************/
/****************************************************************************/

|PROCESO defecto7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          aAlfa = #0#10;
          |QBF aAlfa;
          |SI aAlfa = "000000";
               #0#10 = ".........................";
               |HAZ defecto;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO defecto; |TIPO 14;
     |SI #0#10 = ".........................";
          |ATRI I;
          aAlfa = #0#1;
          |QBF aAlfa;
          aAlfa = ("000000" + aAlfa) % -106;
          #0#10 = aAlfa;
          |PINTA #0#10;
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO Restaura;
     |POPV;
|FPRC;

|PROCESO ayuda10; |TIPO 7;
     |PUSHV 09131279;
     ||            2     3         4         5         6         7
     ||            45678901234567890123456789012345678901234567890123456789
     |ATRI R;
     |PINTA 0913, " Si no se dispone de  n£mero de expediente, este  campo ";
     |PINTA 1013, " se podr  dejar vac¡o, o bien rellenar con el n£mero de ";
     |PINTA 1113, " entrada de la comunicaci¢n  a la Autoridad Laboral se- ";
     |PINTA 1213, " guido de 2020, o bien indicar '0000/2020'              ";
     |ATRI 0;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
     |CAMPO_ANCHO #labempre#2, 1, 36;
|FPRC;

|PROCESO Ambito;
     |SI #0#6 = 1; #0#7 = "Nacional"; |FINSI;
     |SI #0#6 = 2; #0#7 = "Auton¢mico"; |FINSI;
     |SI #0#6 = 3; #0#7 = "Provincial"; |FINSI;
     |PINTA #0#7;
|FPRC;

|PROCESO Causa;
     |SI #0#5 = 1; #0#2 = "Fuerza Mayor"; |FINSI;
     |SI #0#5 = 2; #0#2 = "Causas t‚cnicas,econ¢mica u organizativas"; |FINSI;
     |SI #0#5 = 3; #0#2 = "Otra causa"; |FINSI;
     |PINTA #0#2;
|FPRC;

|PROCESO CambiaFecha;
     aAlfa = #labere23#22;
     |QBF aAlfa;

     |SI #labere23#7 = "**"; |Y aAlfa = "";
          #labere23#22 = #labere22#11;
          |GRABA 020#labere23.a;
          |LIBERA #labere23;
          ||PINTA #labere23#22;
     |FINSI;
|FPRC;

|DEFBUCLE CambiaFecha;
     #labere23#1;
     ;
     #labere22#0, #labere22#1, 00001;
     #labere22#0, #labere22#1, 99999;
     ;
     NULL, CambiaFecha;
|FIN;

|PROCESO BajaPrest;
     |SI #0Campo ! Contenido; |O FSalida = 13;
          aAlfa = "    S¿Usar esta fecha como fecha de baja ";
          aAlfa = aAlfa + "de prestaciones para los tra- bajadores incluidos en el ERTE?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               |ABRE #labere23;
               |BUCLE CambiaFecha;
               ||PONCONTROL 23, "SI";
               |CIERRA #labere23;
          |FINSI;
     |FINSI;
|FPRC;

/****************************************************************************/
/******************** PROCESOS DESDE EL LINEAL ******************************/
/****************************************************************************/

|PROCESO AvisaIT; |TIPO 7;
     |SI #labere23#21 = "S";
          |ATRI S;
          aAlfa = " TRAB. EN IT EL DIA " + #0#3 + " ";
          |PINTA 2239, aAlfa;
          |ATRI 0;
     |SINO;
          |PINTA 2232, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
     |FINSI;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     #labere23#7 = "  ";
     |LINEAS_BI_ATRI #labere23#7, S, I, -1;
     |SI Campo = 8;
          |PONCONTROL 23, "si";
          |PTEC 808;
     |FINSI;
|FPRC;

|PROCESO MarcaDesmarca;
     #labere23#7 = aMarca; |GRABA 020#labere23.a;
|FPRC;

|DEFBUCLE MarcaDesmarca;
     #labere23#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, MarcaDesmarca;
|FIN;

|PROCESO Marcalo; |TIPO 11
     |SI FSalida = 13;
          |SI #labere23#7 = "**";
               #labere23#7 = "  ";
          |SINO;
               #labere23#7 = "**";
          |FINSI;

          |PINTA #labere23#7;
          |GRABA 020#labere23.a;
          |ERROR;
     |FINSI;
     |SI FSalida = 14; || Marca todo
          nEmp = #labere23#0;
          nERE = #labere23#1;
          nTra = #labere23#2;

          aMarca = "**"; |BUCLE MarcaDesmarca;

          #labere23#0 = nEmp;
          #labere23#1 = nERE;
          #labere23#2 = nTra;
          |LEE 000#labere23.=;

          |PONCONTROL 23, "si";
          |ERROR;
          |PTEC 809;
     |FINSI;

     |SI FSalida = 15; || Desmarca todo
          nEmp = #labere23#0;
          nERE = #labere23#1;
          nTra = #labere23#2;

          aMarca = "  "; |BUCLE MarcaDesmarca;

          #labere23#0 = nEmp;
          #labere23#1 = nERE;
          #labere23#2 = nTra;
          |LEE 000#labere23.=;

          |PONCONTROL 23, "si";
          |ERROR;
          |PTEC 809;
     |FINSI;
|FPRC;

|PROCESO Activa17; |TIPO 7;
     |SI #labere23#13 = "S";
          |CAMPO_MODIFICA #labere23#17, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #labere23#17, 1, "S";
     |FINSI;
|FPRC;

|PROCESO CCC;
     |SI #labtraba#45 = 421; |O #labtraba#45 = 422;
          #nomcenes#0 = #labtraba#0;
          #nomcenes#13 = 87;
          #nomcenes#1 = #labtraba#77;
          |LEE 000#nomcenes.=;
          |SI FSalida = 0;
               aAlfa = #nomcenes#10;
               |QBF aAlfa;
               |SI aAlfa ! "";
                    #labcentr#10 = #nomcenes#10;
               |FINSI;

               aAlfa = #nomcenes#2;
               |QBF aAlfa;
               |SI aAlfa ! "";
                    #labcentr#2 = #nomcenes#2;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa = #labcentr#10;
     |QBF aAlfa;
     |SI aAlfa = "";
          #labcentr#10 = #labempre#13;
     |FINSI;
|FPRC;

|PROCESO CompIBAN;
     aAlfa = #labere23#19;
     |QBF aAlfa;
     |SI aAlfa = ""; |O aAlfa = "ES";
          |MENAV "    El campo IBAN es obligatorio";
     |SINO;
          eaCta = #labere23#19 % 520;
          eaPais = #labere23#19 % 102;
          |HAZ CheqIBAN;
          aAlfa = #labere23#19;
          |SI aAlfa ! eaIBAN;
               |MENAV "    El IBAN introducido es incorrecto. Compruebe los datos";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaLineas;
     swSigue = 1;

     |SI swSigue = 1;
          |DDEFECTO #labere23;
          #labere23#0 = #labere22#0;
          #labere23#1 = #labere22#1;
          #labere23#2 = #labtraba#1;
          #labere23#3 = #labtraba#2;
          #labere23#4 = #labtraba#45;
          #labere23#5 = #labtraba#33;
          #labere23#6 = #labtraba#7;    || DNI
          #labere23#7 = "**";
          |SI swIT = 1;
               #labere23#7 = "  ";
               #labere23#21 = "S";
          |FINSI;
          #labere23#8 = #labtraba#77;
          #labere23#9 = #labcentr#2;
          #labere23#10 = #labtraba#36;
          #labere23#11 = #labtraba#37;
          #labere23#14 = #labere22#3;
          #labere23#15 = #labere22#4;
          #labere23#16 = #labempre#2;
          #labere23#22 = #labere22#11;
          aAlfa = #labtraba#154;
          |QBF aAlfa;
          |SI aAlfa ! "";
               #labere23#19 = aAlfa;
          |FINSI;
          |HAZ CCC;
          aAlfa = #labtraba#247; |QBF aAlfa; aAlfa = ("0000" + aAlfa) % -104;
          aAlfa1 = #labcentr#10; |QBF aAlfa1;
          aAlfa = aAlfa + aAlfa1;
          #labere23#20 = aAlfa;
          #labere23#23 = aAlfa % 502;

          |GRABA 020#labere23.n;

          nNumTrab = nNumTrab + 1;

          |LIBERA #labere23;
     |FINSI;
|FPRC;

|PROCESO desglosa;
     alfa1 = fecalf %  102;   dia = alfa1;
     alfa1 = fecalf %  402;   mes = alfa1;
     alfa1 = fecalf % -104;   any = alfa1;
     |SI alfa1 = "....";
          dia = 0;
          mes = 0;
          any = 0;
     |FINSI;
|FPRC;

|PROCESO CompruebaIT;
     |ABRE #nomcalca;
     #nomcalca#0 = #labtraba#0;
     #nomcalca#1 = #labtraba#1;
     #nomcalca#2 = nMes;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0; |Y #nomcalca#184 = nAny;
          |PARA nCampo1 = 19; |SI nCampo1 [ 22; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 4;
               nCampo3 = nCampo1 + 8;
               |SI #nomcalca#nCampo3# = "E";
               |O #nomcalca#nCampo3# = "A";
               |O #nomcalca#nCampo3# = "M";
               |O #nomcalca#nCampo3# = "P";
               |O #nomcalca#nCampo3# = "R";
                    |SI #nomcalca#nCampo1# = 0;
                         #nomcalca#nCampo1# = 1;
                    |FINSI;
                    |SI #nomcalca#nCampo2# = 0;
                         #nomcalca#nCampo2# = 31;
                    |FINSI;
                    |SI #nomcalca#nCampo1# [ nDia; |Y nDia [ #nomcalca#nCampo2#;
                         swIT = 1;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #nomcalca;

     |ABRE #nomhicca;
     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#2 = nMes;
     #nomhicca#3 = 0;
     #nomhicca#66 = nAny - 2000;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          |PARA nCampo1 = 19; |SI nCampo1 [ 22; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 4;
               nCampo3 = nCampo1 + 8;
               |SI #nomhicca#nCampo3# = "E";
               |O #nomhicca#nCampo3# = "A";
               |O #nomhicca#nCampo3# = "M";
               |O #nomhicca#nCampo3# = "P";
               |O #nomhicca#nCampo3# = "R";
                    |SI #nomhicca#nCampo1# = 0;
                         #nomhicca#nCampo1# = 1;
                    |FINSI;
                    |SI #nomhicca#nCampo2# = 0;
                         #nomhicca#nCampo2# = 31;
                    |FINSI;
                    |SI #nomhicca#nCampo1# [ nDia; |Y nDia [ #nomhicca#nCampo2#;
                         swIT = 1;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #nomhicca;
|FPRC;

|PROCESO Trabajadores;
     |SI #labtraba#42 = "H";
          |ACABA;
     |FINSI;

     swfuera = 0;

     fecalf = #labtraba#36;                           || fecha de alta
     |HAZ desglosa;
     |SI any > nAny;|O any = 0;
          swfuera = 1;
     |SINO;
          |SI mes > nMes; |Y any = nAny;
               swfuera = 1;
          |SINO;
               |SI dia > nDia; |Y mes = nMes; |Y any = nAny;
                    swfuera = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swfuera = 0;
          fecalf = #labtraba#37;                       || fecha de baja
          |HAZ desglosa;
          |SI any < nAny; |Y any ! 0;
               swfuera = 1;
          |SINO;
               |SI mes < nMes; |Y any = nAny; |Y mes ! 0;
                    swfuera = 1;
               |SINO;
                    |SI dia < nDia; |Y mes = nMes; |Y any = nAny; |Y dia ! 0;
                         swfuera = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;

     swIT = 0;
     |HAZ CompruebaIT;

     |SI swfuera = 0;    |HAZ GrabaLineas; |FINSI;
|FPRC;

|DEFBUCLE Trabajadores;
     #labtraba#1;
     ;
     #labere22#0, 00001;
     #labere22#0, 99999;
     ;
     NULL, Trabajadores;
|FIN;

|PROCESO Carga;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;
          swAltaCompleta = 0;
          |ACABA;
     |FINSI;

     |ABRE #labempre;
     |ABRE #labtraba;
     |ABRE #labcentr;
     |ABRE #labere23;

     nNumTrab = 0;
     aAlfa = #0#3 % 102;
     nDia = aAlfa;
     aAlfa = #0#3 % 402;
     nMes = aAlfa;
     aAlfa = #0#3 % -104;
     nAny = aAlfa;
     |SI nDia = 1;
          nMes = nMes - 1;
          |SI nMes = 0;
               nMes = 12;
               nAny = nAny + 1;
          |FINSI;
     |FINSI;

     aCampo2 = #0#2;
     aCampo3 = #0#3;
     aCampo4 = #0#4;
     aCampo5 = #0#5;
     aCampo6 = #0#6;
     aCampo7 = #0#7;
     aCampo8 = #0#8;
     aCampo9 = #0#9;
     aCampo10 = #0#10;
     aCampo11 = #0#11;

     |BUCLE Trabajadores;
     enEmpresa = #0#0;
     enAny = nAny;
     enMes = nMes;
     enNroERE = #0#1;
     |SUB_EJECUTA "nominfba;labere22";

     swAltaCompleta = 1;

     |CIERRA #labere23;
     |CIERRA #labcentr;
     |CIERRA #labtraba;
     |CIERRA #labempre;
|FPRC;

|PROCESO inf;
     #labere23#0 = #labere22#0;
     #labere23#1 = #labere22#1;
     #labere23#2 = 1;
|FPRC;

|PROCESO sup;
     #labere23#0 = #labere22#0;
     #labere23#1 = #labere22#1;
     #labere23#2 = 99999;
|FPRC;

|PROCESO Salida; |TIPO 7;
     |SI FSalida = 7; |O FSalida = "Informes";
          swAltaCompleta = 0;
     |FINSI;
     |SI swAltaCompleta = 1;
          swAltaCompleta = 0;
          |PTEC 806;
          #0#0 = enEmpresa; |PINTA #0#0;
          #0#1 = enNroERE; |PINTA #0#1;
          #0#2 = aCampo2; |PINTA #0#2;
          #0#3 = aCampo3; |PINTA #0#3;
          #0#4 = aCampo4; |PINTA #0#4;
          #0#5 = aCampo5; |PINTA #0#5;
          #0#6 = aCampo6; |PINTA #0#6;
          #0#7 = aCampo7; |PINTA #0#7;
          #0#8 = aCampo8; |PINTA #0#8;
          #0#9 = aCampo9; |PINTA #0#9;
          #0#10 = aCampo10; |PINTA #0#10;
          #0#11 = aCampo11; |PINTA #0#11;

          |ABRE #labempre;
          #labempre#0 = enEmpresa;
          |LEE 000#labempre.=;
          |CIERRA #labempre;

          |ATRI I;
          |PINTA 0719, #labempre#2;
          |ATRI 0;

          |ENTLINEAL #1#labere23, -3, 7, 21, 0, inf, sup;
     |FINSI;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
     aAlfa = FSalida;
     |SI FSalida = "OPCION";
          FSalida = "Informes";
     |SINO;
          |MENU aMenu;
          nOpcion = FSalida;

          enEmpresa = #0#0;
          enNroERE = #0#1;

          |SI nOpcion = 1;
               |HAZ Seleccion1;
          |FINSI;
          |SI nOpcion = 2; |O nOpcion = 3;
               |MENU aMenuExcel;
               nOpcionExcel = FSalida;
               |SI nOpcionExcel = 1;
                    eaFormato = ".xls";
                    aAlfa = "    Se generará un fichero XLS que será necesario convertir ";
                    aAlfa = aAlfa + "a XLSX antes de enviarlo";
                    ||MENAV aAlfa;
                    |HAZ Seleccion2;
               |FINSI;
               |SI nOpcionExcel = 2;
                    eaFormato = ".xlsx";
                    |HAZ Seleccion2;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
