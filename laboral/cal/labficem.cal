|FICHEROS;
    labficem #0;
    labempre #1;
    labcentr #2;
    nomconca;
    :integral/dsam0000;
    :integral/dsam0005;
    :integral/dsam0107;
|FIN;

|VARIABLES;
     sw = 0;
     dia = 0;
     mes = 0;
     any = 0;
     tope = 0;
     mod = 0;
     men1 = "0000ATENCION !!! Fecha erronea ...";
     dia1 = "";
     mes1 = "";
     any1 = "";
     fec = "";
     blanco = "          ";
     puntos = "..........";

     swSerna = 0;
     aAlfa = "";
|FIN;

|PROCESO fechacon; |TIPO 0;      || chequea una fecha alfanumerica de 10 pos.
    fec = #0Campo; sw = 0;
|SI fec ! blanco; |Y fec ! puntos;
        dia1 = fec % A102;
        mes1 = fec % A402;
        any1 = fec % A704;
        dia = dia1;
        mes = mes1;
        any = any1;
    |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
        |SI mes [ 12; |Y mes ] 1;
            |SI mes=1;|O mes=3;|O mes=5;|O mes=7;|O mes=8;|O mes=10;|O mes=12;
                    tope = 31;
            |SINO;
                |SI mes = 2;
                         mod = any $ 4;
                    |SI mod = 0;
                            tope = 29;
                    |SINO;
                            tope = 28;
                    |FINSI;
                |SINO;
                        tope = 30;
                |FINSI;
            |FINSI;
            |SI dia [ tope;
                    sw = 1;
            |FINSI;
        |FINSI;
    |FINSI;
|SINO;
        sw = 1;
|FINSI;
|SI sw = 0;
    |MENAV men1;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO tipoirpf; |TIPO 0;
|SI #1#28 = 0;   #0#30 = "(SIN IRPF)";  |FINSI;
|SI #1#28 = 1;   #0#30 = "ANUAL     ";  |FINSI;
|SI #1#28 = 2;   #0#30 = "SEMESTRAL ";  |FINSI;
|SI #1#28 = 3;   #0#30 = "TRIMESTRAL";  |FINSI;
|SI #1#28 = 4;   #0#30 = "MENSUAL   ";  |FINSI;
|PINTA #0#30;
|FPRC;

|PROCESO Datos;
     swSerna = 0;
     |ABRE #labempre;
     #labempre#0 = 14;
     |LEE 000#labempre.=;
     |SI FSalida = 0;
          aAlfa = #labempre#2;
          aAlfa = aAlfa % 113;
          |SI aAlfa = "SOCER Y SERNA";
               swSerna = 1;
          |FINSI;
     |FINSI;
     |CIERRA #labempre;

     |ABRE #dsam0000;
     #dsam0000#0 = #0#0;
     |LEE 000#dsam0000.=;
     |SI FSalida = 0;
          #0#32 = #dsam0000#52;
          |PINTA #0#32;
     |FINSI;
     |CIERRA #dsam0000;

     |SI swSerna = 1;              || para que le salga a Anto¤ito el numero
          |ABRE #dsam0107;         || de fax, que pone en la linea 3 del listin
          #dsam0107#0 = #0#1;
          #dsam0107#1 = 03;
          |LEE 000#dsam0107.=;
          |SI FSalida = 0;
               #0#38 = #dsam0107#4;
          |FINSI;
          |CIERRA #dsam0107;
     |FINSI;

     |ABRE #labempre;
     #labempre#0 = #0#0;
     |LEE 000#labempre.=;
     |SI FSalida = 0;
          |ABRE #nomconca;
          #nomconca#0 = #labempre#1;
          |LEE 000#nomconca.=;
          |SI FSalida = 0;
               #0#19 = #nomconca#1;
               |PINTA #0#19;
          |FINSI;
          |CIERRA #nomconca;

          #0#34 = #labempre#25;
          #0#35 = #labempre#39;
          #0#36 = #labempre#128;
          #0#37 = #labempre#129;
     |FINSI;
     |CIERRA #labempre;

     |ABRE #labcentr;
     #labcentr#0 = #labempre#0;
     #labcentr#1 = 01;
     |LEE 000#labcentr.=;
     |SI FSalida = 0;
          #0#3 = #labcentr#3;
          #0#4 = #labcentr#4;
          #0#5 = #labcentr#5;
          #0#6 = #labcentr#6;
          #0#7 = #labcentr#7;
          #0#8 = #labcentr#8;
     |FINSI;
     |CIERRA #labcentr;

     |ABRE #dsam0005;
     #dsam0005#0 = #0#0;
     #dsam0005#1 = 98;
     |LEE 000#dsam0005.=;
     |SI FSalida = 0;
          #0#9 = #dsam0005#3 + " " + #dsam0005#4;
          #0#10 = #dsam0005#5;
          #0#11 = #dsam0005#7;
          #0#12 = #dsam0005#11;
          #0#13 = #dsam0005#9;
          #0#14 = #dsam0005#10;
     |FINSI;
     |CIERRA #dsam0005;

     |PINDA #0#0;
|FPRC;

|PROCESO emite; |TIPO 3;
Impresora = "Crystal Reports";
|IMPRE 0;
|SI FSalida = 0;
     |SI Impresora = "CrystalReport";
          |INFOR "labempcr";
     |SINO;
          |INFOR "labficem";
     |FINSI;
    |PRINT;
    |PIEINF;
    |FININF;
|FINSI;
|FINIMP;
|FPRC;
