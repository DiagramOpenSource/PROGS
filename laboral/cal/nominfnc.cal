|FICHEROS;
     nominfnc #0;
     nomcalca #1;
     nomhicca;
     labtraba #2;
     labempre #3;
|FIN;

|VARIABLES;
     fFecha = @;
     aFecha = "";
     nMes = 0;
     aMes = "";
     nAny = 0;
     aAny = "";
     fFechaAlta = @;
     fFechaRef = @;
     topemes = 0;
     fFechaBaja = @;
     aFechaBaja = "";
|FIN;

|PROCESO Defecto; |TIPO 7;
     fFecha = ~;
     aFecha = fFecha;
     aMes = aFecha % 402;
     aAny = aFecha % -104;
     nAny = aAny;
     nMes = aMes;
     #0#2 = nMes;
     #0#3 = nAny;
     |PINTA #0#2;
     |PINTA #0#3;
|FPRC;

|PROCESO ultidia;
     topemes = 31;
     |SI nMes = 4; |O  nMes = 6; |O  nMes = 9; |O  nMes = 11;
          topemes = 30;
     |FINSI;
     |SI nMes = 2;
          topemes = 28;
     |FINSI;
|FPRC;

|PROCESO labempre;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;
|FPRC;

|PROCESO labtraba;
     nAny = #0#3;
     aAny = nAny;

     nMes = #0#2;
     aMes = nMes;
     aMes = ("00" + aMes) % -102;
     |HAZ ultidia;
     aFecha = topemes;
     aFecha = ("00" + aFecha) % -102;
     aFecha = aFecha + "." + aMes + "." + aAny;
     fFechaRef = aFecha;
     fFechaAlta = #labtraba#36;
     |SI fFechaAlta > fFechaRef;
          |ACABA;
     |FINSI;
     aFechaBaja = #labtraba#37;
     |QBF aFechaBaja;
     |SI aFechaBaja ! ""; |Y aFechaBaja ! "..........";
          fFechaBaja = aFechaBaja;
          aFecha = "01" + "." + aMes + "." + aAny;
          fFechaRef = aFecha;
          |SI fFechaBaja < fFechaRef;
               |ACABA;
          |FINSI;
     |FINSI;

     #nomcalca#0 = #labtraba#0;
     #nomcalca#1 = #labtraba#1;
     #nomcalca#2 = #0#2;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida ! 0;
          #nomhicca#0 = #labtraba#0;
          #nomhicca#1 = #labtraba#1;
          #nomhicca#66 = nAny - 2000;
          #nomhicca#2 = #0#2;
          #nomhicca#3 = 0;
          |LEE 000#nomhicca.=;
          |SI FSalida ! 0;
               |HAZ labempre;
               |SI #labempre#50 = "S";
                    |ACABA;
               |FINSI;
               |PRINT;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     44;
     #0#0, 00001, "A";
     #0#1, 99999, "A";
     ;
     NULL, labtraba;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          Impresora = "CrystalReport";
          |IMPRE -1;
          |INFOR "nominfnc";
          |ABRE #nomcalca;
          |ABRE #nomhicca;
          |ABRE #labempre;
          |BUCLE labtraba;
          |CIERRA #labempre;
          |CIERRA #nomhicca;
          |CIERRA #nomcalca;
          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
|FPRO;
