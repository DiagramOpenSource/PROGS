|FICHEROS;
     zominf02 #0;
     nomcalca #1;
     nomhicca;
     labtraba #2;
     labempre #3;
     nombotra;
|FIN;

|VARIABLES;
     &aDesde = "";
     &nBase1 = 0;
     &nBonif1 = 0;
     &nImporteTot1 = 0;
     &nEsperado1 = 0;
     &nDiferencia = 0;
     nNume = 0;
     aAlfa = "";
     swHayAlguno = 0;
|FIN;

|PROCESO imprime;
     nBase1 = 0;
     nBonif1 = 0;
     nImporteTot1 = 0;
     nEsperado1 = 0;
     nDiferencia = 0;
     |SI aDesde = "M";
          #labtraba#0 = #nomcalca#0;
          #labtraba#1 = #nomcalca#1;
          |LEE 000#labtraba.=;

          |SI #nomcalca#96 > 0; |Y #nomcalca#33 > 0;
               nBase1 = #nomcalca#96;
               nBonif1 = #nomcalca#135;

               #nombotra#0 = #nomcalca#0;
               #nombotra#1 = #nomcalca#1;
               #nombotra#2 = nBonif1;
               |LEE 000#nombotra.=;
               |SI FSalida = 0;
                    nImporteTot1 = #nombotra#7;
               |FINSI;

               nEsperado1 = #nomcalca#8 * ((nImporteTot1 / 30) ! 2);

               nDiferencia = nEsperado1 - nBase1;
               nNume = nDiferencia ! 0;
               aAlfa = nNume; |QBF aAlfa;
               |SI aAlfa ! "0"; |Y aAlfa ! "-0";
                    |PRINT;
                    swHayAlguno = 1;
               |FINSI;
          |FINSI;
          |SI #nomcalca#96 < 0; |Y #nomcalca#33 > 0;
               nBase1 = #nomcalca#96;
               nDiferencia = 0 - #nomcalca#96;
               |PRINT;
               swHayAlguno = 1;
          |FINSI;
     |FINSI;

     |SI aDesde = "H";
          #labtraba#0 = #nomhicca#0;
          #labtraba#1 = #nomhicca#1;
          |LEE 000#labtraba.=;

          |SI #nomhicca#138 > 0; |Y #nomhicca#33 > 0;
               nBase1 = #nomhicca#138;
               nBonif1 = #nomhicca#177;

               #nombotra#0 = #nomhicca#0;
               #nombotra#1 = #nomhicca#1;
               #nombotra#2 = nBonif1;
               |LEE 000#nombotra.=;
               |SI FSalida = 0;
                    nImporteTot1 = #nombotra#7;
               |FINSI;

               nEsperado1 = #nomhicca#8 * ((nImporteTot1 / 30) ! 2);

               nDiferencia = nEsperado1 - nBase1;
               nNume = nDiferencia ! 0;
               aAlfa = nNume; |QBF aAlfa;
               |SI aAlfa ! "0"; |Y aAlfa ! "-0";
                    |PRINT;
                    swHayAlguno = 1;
               |FINSI;
          |FINSI;

          |SI #nomhicca#138 < 0; |Y #nomhicca#33 > 0;
               nBase1 = #nomhicca#138;
               nDiferencia = 0 - #nomhicca#138;
               |PRINT;
               swHayAlguno = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #0#0, #0#2, 12, 03, 0;
     #0#1, #0#3, 12, 03, 0;
     ;
     NULL, imprime;
|FIN;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #0#0, #0#2, 03, 0;
     #0#1, #0#3, 03, 0;
     ;
     NULL, imprime;
|FIN;

|PROCESO Busca;
     aDesde = "M";
     |BUCLE nomcalca;

     aDesde = "H";
     |BUCLE nomhicca;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "zominf02";
               |ABRE #nomcalca;
               |ABRE #nomhicca;
               |ABRE #labtraba;
               |ABRE #nombotra;
               swHayAlguno = 0;
               |HAZ Busca;
               |CIERRA #nombotra;
               |CIERRA #labtraba;
               |CIERRA #nomhicca;
               |CIERRA #nomcalca;
               |SI swHayAlguno = 0;
                    |MENAV "    No se han encontrado trabajadores afectados";
               |FINSI;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRO;
