|FICHEROS;
    silcon12 #0;    || emision TC2/1
    labempre #1;    || empresas
    labempax #2;    || aux. empresas
    nomtrt22 #4;    || temporal 1
    labtraba #5;    || trabajadores
    tsilcon1 #6;    || calculos cabs. (nomcalca)
    nomtrt21 #7;    || temporal 2
    nombonif #8;    || bonificaciones
    nomepigr #9;    || epigrafes
    labcentr #10;   || centros de trabajo
    nomconst #11;   || constantes
    nomepitr #12;   || epigrafes/trabajador
    nomcenes #13;   || centros especiales 18/94-10/94
    nomcones #15;   || constantes especiales 18/94-10/94
    nomhicca #19;   || calculos cabs. (proceso historico)
    nomcalac #21;   || calculos cabs. (proceso atrasos)
    nomcontr #36;   || control aplicacion
    nomtraca #55;        || importes trab.cabs. (bonif.exp.reg.emp.)
    nomcones #56;        || constante especial (bonif.exp.reg.emp.)
    nomepigr #57;        || epigrafes (bonif.exp.reg.emp.)
    nomepitr #58;        || epigrafes trabajador (bonif.exp.reg.emp.)
    || nomret03 #100;
    nombofli;
     nomcalca;
     nomcalli;
     nomhicli;
|FIN;

|VARIABLES;
    FEstado = 0;
    sgdonum = 0;
    haentrat = 0;
    antempre = 0;
    antcentr = 0;
    antbonif = 0;
    anttipo  = 0;
    sibonif = 0;
    endo = 0;
    menos = 0;
    estado = 0;
    informe1 = "nomtc21p";
    informe2 = "nomtc21s";
    postal1 = "";   || Codigo postal1 alfa
    postal2 = "";   || Codigo postal2 alfa
    domi    = "";   || Variable para quitar espacios al domicilio
    afili   = "";   || Variable para quitar espacios al nro. de afiliacion
    sgdoalf = "";   || Variable para quitar espacios al nro. de afiliacion
    fecsys = @;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    p_mes = "";
    bot1 = "  ";         || topes para el DEFBUCLE 1
    top1 = "zz";         || del fichero temporal
    bot2 = "         ";
    top2 = "zzzzzzzzz";
    lite_mes = "";
    epi_tra = 0;
    epi_bas = 0;
    epig_ilt = 0;
    epig_ims = 0;
    anyonum = 0;
                        || Variables informes
    &t_bonif1 = 0;
    &t_bonif2 = 0;
    &t_porboni1 = 0;
    &t_porboni2 = 0;
    &t_cuotboni = 0;
    &t_reduccio = 0;
    &tablaepi1  = 0;
    &tablaepi2  = 0;
    &tablaepi3  = 0;
    &tablaepi4  = 0;
    &tablaepi5  = 0;
    &porcepig1  = 0;
    &porcepig2  = 0;
    &porcepig3  = 0;
    &porcepig4  = 0;
    &porcepig5  = 0;
    &basepigr1  = 0;
    &basepigr2  = 0;
    &basepigr3  = 0;
    &basepigr4  = 0;
    &basepigr5  = 0;
    &t_porcepi1 = 0;
    &t_porcepi2 = 0;
    &t_porcepi3 = 0;
    &t_porcepi4 = 0;
    &t_porcepi5 = 0;
    &t_porcepig = 0;
    &t_epigrafe = 0;
    &t_dfp      = 0;
    &t_porcdfp  = 0;
    &t_total    = 0;
    &t_cbonif   = 0;
    siono_cen = "";
    runnom = "";

    tip = 0;
    sw_mater = 0;
    f_mes = "";
    m_dias = 0;
    m_des = 0;
    m_has = 0;
    m_fec = "";
    m_top = "";
    dtipo = 0;
    htipo = 0;
    dia_2 = 0;
    dia_3 = 0;
    dia_4 = 0;
    topemes = 0;

    &s_emp = 0;
    &s_any = 0;
    &s_mes = 0;
    &s_has = 0;
    &s_tip = "";
    &s_tipd = "";
    &s_cen = "";
    &s_pas = 0;
    &s_nom = "";
    &s_ori = "";
    &s_tat = 0;
    sw_red = 0;

    &temp1 = "";
    &temp2 = "";
    &temp3 = "";
    &temp4 = "";
    &temp5 = "";
    &esAtrasos = 0;

    antporce = 0;
    antbase = 0;
    desem = 0;
    cuot2 = 0;
    porc1 = 0;
    porc2 = 0;
    bacc2 = 0;
    bacp2 = 0;
    bilt1 = 0;
    bilt2 = 0;

    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    qbonifi = 0;
    qreducc = 0;
    qsubven = 0;
    qsub85pre = 0;
    qsub85dis = 0;
    qtotal = 0;
    &any_hist = 0;
    sw_abierto = 0;
    sw_ini = 0;
    nCuota = 0;
    nSubve = 0;
    nEsDoble = 0;
    bon_0 = 0;
    bon_3 = 0;
    bon_5 = 0;
    base_A = 0;
    base_B = 0;
    base_C = 0;
    base_F = 0;
    CodigoCons = 0;
    nPorBon = 0;
    por1_cont = 0;
    por1_dfpg = 0;
    zbase_9 = 0;
    t_retro1 = 0;
    t_retro2 = 0;
    &aParam = "";
    &EURODB = 0;
    meses_bon = 0;
    swBonif = 0;
    anyocal = 0;
    mescal = 0;
    anyofin = 0;
    mesfin = 0;
    fecha1 = @;

    nume5 = 0;
    nume6 = 0;
    nume7 = 0;
    nume8 = 0;
    alfa5 = "";
    alfa6 = "";
    alfa7 = "";
    alfa8 = "";
    bon_60 = 0;
    por_bon_60 = 0;
    por_bon_16 = 0;
    fecha_bon_16 = "";

    &fCFecha = @;
    &aCError = "";
    &nCConst = 0;
    aAlfa = "";
    &eaTipoLi = "";
    aFechaRef = "";
    swBoniExp = 0;
    nBonifFPCont = 0;
    swBonifFPCont = 0;
    &ctipo = 0;
     &eaVengoDe = "";
    t_totalAB = 0;
    t_boniftra = 0;
    t_base = 0;

     &nAny = 0;
     &nMes = 0;
     &nCodigoBon = 0;
     &nEpigConv = 0;
     &s_anyl = 0;
     &s_ele = "";
     &aTempEpig = "";

     &eaFuente = "";
     nDiasVac = 0;
     nDiasAlta = 0;
     nDiasBT = 0;
     nImporte = 0;
     nDias_nat_alta = 0;
     aFechaAlta = "";
     aFechaBaja = "";
     fech5 = @;
     fech6 = @;
     swSigue = 0;
     fFechaAlta = @;
     fFechaRef = @;
     nDesdeCen = 0;
     nHastaCen = 0;
     nDesdeTipo = 0;
     nHastaTipo = 0;
     nNume = 0;
|FIN;

|| ***************************************************************************
|| ****** calculos de carga de fichero temporal ******************************
|| ***************************************************************************

|PROCESO arreglo;
          ||  si emitimos desde el historico y el campo porcentaje esta vacio
          || /lo rellenamos para evitar que tengan que recalcular
     |SI #7#14 = 0;|Y #6#63 ! 0;
          #7#14 = #8#3;
     |FINSI;
|FPRC;

|PROCESO tmp_2;
|SI #8#11 = "S";
    |DDEFECTO #4;
    |ABRE #4;
        #4#0 = #1#0;                    || Codigo empresa
        #4#1 = #6#12;                   || Codigo Bonificacion
        #4#2 = #6#1;                    || Codigo trabajador
    |SI tip = 0; |O tip = 2;
        |SI #1#45 = "N";   afili = #01#13;  |FINSI;
        |SI #1#45 = "S";   afili = #10#10;  |FINSI;
    |SINO;
            afili = #13#10;
    |FINSI;
    |QBF afili;
        sgdoalf = afili % 0;
        sgdonum = sgdoalf;
        sgdonum = sgdonum - 4;
        sgdonum = sgdonum + 300;        || para coger 2do. digito
        #4#3 = afili % 102;             || Primer digito S.S.
        #4#4 = afili % sgdonum;         || Segundo digito S.S.
        #4#5 = afili % -102;            || Tercer digito S.S.
        #4#6 = lite_mes;                || Mes literal
        #4#7 = #0#3;                    || A¤o
        #4#8 = #1#2;                    || Nombre empresa
    |SI tip = 0; |O tip = 2;
        |SI #1#45 = "S";
                domi = #10#3;
            |QBF domi;
                #4#9 = domi+" "+#10#4+" "+#10#5;  || domicilio
                #4#10 = #10#6;                    || localidad
                #4#11 = #10#9;                    || provincia
        |SINO;
                domi = #1#3;
            |QBF domi;
                #4#9 = domi+" "+#1#4+" "+#1#5;
                #4#10 = #1#6;
                #4#11 = #1#9;
        |FINSI;
    |SINO;
            domi = #13#3;
        |QBF domi;
            #4#9 = domi+" "+#13#4+" "+#13#5;
            #4#10 = #13#6;
            #4#11 = #13#9;
    |FINSI;
        afili = #5#75;
    |QBF afili;
        sgdoalf = afili % 0;
        sgdonum = sgdoalf;
        sgdonum = sgdonum - 4;
        sgdonum = sgdonum + 300;        || para coger 2do. digito
        #4#12 = "SUBV.FORMAC. TEORICA"; || Concepto o modalidad
        #4#13 = "RD 1618/90";           || Disposicion
        #4#14 = 0;                      || Porcentaje
        #4#15 = afili % 102;            || Primer digito S.S.
        #4#16 = afili % sgdonum;        || Segundo digito S.S.
        #4#17 = afili % -102;           || Tercer digito S.S.
        #4#18 = #5#2;                   || Nombre Trabajador
        #4#19 = #5#40;                  || Fecha alta bonificacion
        #4#20 = #6#64;                  || Cuota bonificacion 2
        #4#21 = #5#7;                   || DNI trabajador
    |SI tip = 0; |O tip = 2;
        |SI #1#45 = "N";  #4#22 = #01#13;  |FINSI;
        |SI #1#45 = "S";  #4#22 = #10#10;  |FINSI;
    |SINO;
            #4#22 = #13#10;
    |FINSI;
        #4#23 = "";                     || vacio
        #4#24 = "";                     || literal fijo
        |HAZ lee_centr;
        |SI #10#21 = 0;
             #4#25 = #5#77;                  || centro trabajo
        |SINO;
             #4#25 = #10#21;                  || centro trabajo
        |FINSI;
        #4#26 = "";
        #4#27 = tip;                    || tipo
        #4#28 = ~;                      || fecha impresion
    |SI #6#64 ! 0;
        |GRABA 020#4n;
    |FINSI;
    |CIERRA #4;
|FINSI;
|FPRC;

|PROCESO tmp_12;
|DDEFECTO #7;
|ABRE #7;
    #7#0 = #1#0;         || empresa
    #7#1 = #6#12;        || bonificacion
    #7#2 = #6#1;         || trabajador
    #7#27 = tip;         || tipo
|LEE 101#7=;
|SI FSalida = 0;
        #7#20 = #7#20 + #6#43;     || Base bonificacion 1 (acumula finiquito)
        #7#21 = #7#21 + #6#44;     || Base bonificacion 2 (acumula finiquito)
        #7#32 = #7#32 + #6#63;
        #7#33 = #7#33 + #6#81;
    |GRABA 020#7a;
|FINSI;
|LIBERA #7;
|CIERRA #7;
|FPRC;

|PROCESO tmp_1;
     |DDEFECTO #7;
     |ABRE #7;
     #7#0 = #1#0;        || empresa
     #7#1 = #6#12;       || bonificacion
     #7#2 = #6#1;        || trabajador
     |SI tip = 0; |O tip = 2;
          |SI #1#45 = "N";   afili = #01#13;  |FINSI;
          |SI #1#45 = "S";   afili = #10#10;  |FINSI;
     |SINO;
          |HAZ cen_esp;
          afili = #13#10;
     |FINSI;

     |HAZ bonif;
     |QBF afili;
     sgdoalf = afili % 0;
     sgdonum = sgdoalf;
     sgdonum = sgdonum - 4;
     sgdonum = sgdonum + 300;        || para coger 2do. digito
     #7#3 = afili % 102;             || Primer digito S.S.
     #7#4 = afili % sgdonum;         || Segundo digito S.S.
     #7#5 = afili % -102;            || Tercer digito S.S.
     #7#6 = lite_mes;                || Mes literal
     #7#7 = anyonum;                 || A¤o
     #7#8 = #1#2;                    || Nombre empresa
     |SI tip = 0; |O tip = 2;
          |SI #1#45 = "S";
               domi = #10#3;
               |QBF domi;
               #7#9 = domi+" "+#10#4+" "+#10#5; || domicilio
               #7#10 = #10#6;                   || localidad
               #7#11 = #10#9;                   || provincia
          |SINO;
               domi = #1#3;
               |QBF domi;
               #7#9 = domi+" "+#1#4+" "+#1#5;
               #7#10 = #1#6;
               #7#11 = #1#9;
          |FINSI;
     |SINO;
          domi = #13#3;
          |QBF domi;               || domicilio empresa
          #7#9 = domi+" "+#13#4+" "+#13#5;
          #7#10 = #13#6;
          #7#11 = #13#9;
     |FINSI;
     afili = #5#75;
     |QBF afili;
     sgdoalf = afili % 0;
     sgdonum = sgdoalf;
     sgdonum = sgdonum - 4;
     sgdonum = sgdonum + 300;      || para coger 2do. digito
     #7#12 = #8#1;                 || Concepto o modalidad
     #7#13 = #8#2;                 || Disposicion
     #7#14 = #6porc1;              || Porcentaje
     |HAZ arreglo;
     #7#15 = afili % 102;          || Primer digito S.S.
     #7#16 = afili % sgdonum;      || Segundo digito S.S.
     #7#17 = afili % -102;         || Tercer digito S.S.
     #7#18 = #5#2;                 || Nombre Trabajador
     #7#19 = #5#40;                || Fecha alta bonificacion
     #7#20 = #6#43;                || Base bonificacion 1
     #7#21 = #6#44;                || Base bonificacion 2
     #7#22 = #5#7;                 || DNI trabajador
     |SI tip = 0; |O tip = 2;
          |SI #1#45 = "N";  #7#23 = #01#13;  |FINSI;
          |SI #1#45 = "S";  #7#23 = #10#10;  |FINSI;
     |SINO;
          #7#23 = #13#10;
     |FINSI;
     #7#24 = "";                   || Literal fijo
     |HAZ lee_centr;
     |SI #10#21 = 0;
          #7#25 = #5#77;                || centro trabajo
     |SINO;
          #7#25 = #10#21;                || centro trabajo
     |FINSI;
     #7#26 = #6bilt1;              || base ILT
     #7#27 = tip;                  || tipo
     #7#28 = ~;                    || fecha impresion
     #7#29 = #1#45;                || por centros S/N
     |SI #7#1 = 516;          || RDL 16/2001
          #7#14 = 100;
          #7#20 = #6#92 + #6#95;
     |SINO;
          #7#32 = #6#63;
          #7#33 = #6#81;
     |FINSI;

     |SI #6#63 ! 0;|O #6#64 ! 0;|O #6#92 ! 0; |O #6#95 ! 0; |O t_retro1 ! 0; |O t_retro2 ! 0;
     |O #6#81 ! 0;
          |GRABA 020#7n;
          t_retro1 = 0;        || pongo otra vez a cero las variables de retroactivas
          t_retro2 = 0;        || solo ha sido para grabar la ficha, luego las
     |FINSI;                  || calculare de verdad

     |CIERRA #7;
|FPRC;

|PROCESO cen_esp;
|ABRE #13;
|DDEFECTO #13;
    #13#0 = #5#0;        || empresa
    #13#13 = #5#77;      || centro
|SI tip = 8;   #13#1 = 87;    |FINSI;
|SI tip = 9;   #13#1 = 64;    |FINSI;
|LEE 000#13=;
|CIERRA #13;
|FPRC;

|PROCESO ini_auxil;
     sw_ini = 0;
|SI s_ori = "M";|O s_ori = "H";
     |SI s_pas = 1;|Y #2#2 = 0;  sw_ini = 1; |FINSI;
     |SI s_pas = 4;|Y #2#2 = 10; sw_ini = 1; |FINSI;
     |SI s_pas = 2;|Y #2#2 = 8;  sw_ini = 1; |FINSI;
     |SI s_pas = 5;|Y #2#2 = 18; sw_ini = 1; |FINSI;
     |SI s_pas = 3;|Y #2#2 = 9;  sw_ini = 1; |FINSI;
     |SI s_pas = 6;|Y #2#2 = 19; sw_ini = 1; |FINSI;
|FINSI;
|SI s_ori = "A";|O s_ori = "T";
     |SI s_pas = 1;|Y #2#2 = 5;  sw_ini = 1; |FINSI;
     |SI s_pas = 4;|Y #2#2 = 15; sw_ini = 1; |FINSI;
     |SI s_pas = 2;|Y #2#2 = 6;  sw_ini = 1; |FINSI;
     |SI s_pas = 5;|Y #2#2 = 16; sw_ini = 1; |FINSI;
     |SI s_pas = 3;|Y #2#2 = 7;  sw_ini = 1; |FINSI;
     |SI s_pas = 6;|Y #2#2 = 17; sw_ini = 1; |FINSI;
|FINSI;

|SI sw_ini = 1;
        #2#11 = 0;      || compensaciones/reducciones
        #2#12 = 0;      || bonificaciones/subvenciones
        #2#21 = 0;      || compensaciones maternidad
        #2#17 = 0;      || clave de TC2/1
        #2#20 = 0;      || importe a pagar TC1
        #2#95 = 0;      || compensaciones/reducciones
    |GRABA 020#2a;
    |LIBERA #2;
|FINSI;
|FPRC;

|PROCESO lee_centr;
|DDEFECTO #10;
|ABRE #10;
    #10#0 = #1#0;
    #10#1 = #5#77;          || lee el centro de trabajo
|LEE 000#10=;
|CIERRA #10;
|FPRC;

|PROCESO lee_traba;
|ABRE #5;
    #5#0 = #1#0;
    #5#1 = #6#1;
|LEE 000#5=;                || lee el trabajador
    FEstado = FSalida;
|CIERRA #5;
|FPRC;

|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#2;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores

     |HAZ LeeCons;

     |SI aCError ! "";
          alfa1 = #labtraba#0; alfa1 = "00000" + #labtraba#0; alfa1 = alfa1 % -105;
          alfa2 = #labtraba#1; alfa2 = "00000" + #labtraba#1; alfa2 = alfa2 % -105;
          aAlfa = "0000ATENCION: Trabajador: " + alfa1 + "." + alfa2;
          aAlfa = aAlfa + " La constante del trabajador no esta definida.";
     |FINSI;

/*
     |ABRE #55;
     #55#0 = #1#0;
     #55#1 = #6#1;
     |LEE 000#55=;
     |SI FSalida = 0;|Y #55#3 ! 0;
          CodigoCons = #55#3;
     |SINO;
          CodigoCons = #1#32;
     |FINSI;
     |CIERRA #55;
     |ABRE #11;
     #11#0 = CodigoCons;
     |LEE 020#11=;                   || lee la constante
     FEstado = FSalida;
     |CIERRA #11;

     |DDEFECTO #15;
     |ABRE #15;
     #15#0 = #1#32;
     |LEE 000#15=;                   || lee la constante especial
     |CIERRA #15;
*/
|FPRC;

|PROCESO lee_empre;
|ABRE #1;
    #1#0 = #6#0;
|LEE 000#1=;                       || lee la empresa
    FEstado = FSalida;
|CIERRA #1;
|SI eaVengoDe = "nomtc210";
     #1#45 = "S";
|FINSI;
|SI #1#45 ! "S";|Y #1#45 ! "N";    #1#45 = "N";   |FINSI;
|FPRC;

|PROCESO el_tipo;
    tip = 0;                                                || resto
|SI #6#9 = 87;|O #6#9 = 97;|O #6#9 = 85;  |O #6#9 = 421; tip = 8; |FINSI;  || aprend.
|SI #6#9 = 64;|O #6#9 = 65;               tip = 9; |FINSI;  || t.parcial
|FPRC;

|PROCESO temporal;
     |HAZ lee_empre;     |SI FEstado ! 0;    |ACABA;   |FINSI;   || empresa
     |HAZ lee_traba;     |SI FEstado ! 0;    |ACABA;   |FINSI;   || trabajador

     nCConst = #labtraba#248;
     |HAZ constante;      |SI FEstado ! 0;    |ACABA;   |FINSI;   || constantes

     swBoniExp = 0;
     |SI #5#45 ! "087";|Y #5#45 ! "097";|Y #5#45 ! "085"; |Y #5#45 ! "421";
     |Y #5#45 ! "064";|Y #5#45 ! "065";
          |SI s_pas ! 1;|Y s_pas ! 4;    |ACABA;   |FINSI;   || resto
     |FINSI;
     |SI #5#45 = "087";|O #5#45 = "097";|O #5#45 = "085"; |O #5#45 = "421";
          |SI s_pas ! 2;|Y s_pas ! 5;    |ACABA;   |FINSI;   || aprendices
     |FINSI;
     |SI #5#45 = "064";|O #5#45 = "065";
          |SI s_pas ! 3;|Y s_pas ! 6;    |ACABA;   |FINSI;   || t.parcial
     |FINSI;

     |SI #5#45 = "087";|O #5#45 = "097";|O #5#45 = "085";|O #5#45 = "421";
          |SI esAtrasos = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI #5#42 = "H";    |ACABA;   |FINSI;                  || autonomos

     |SI #5#42 = "A";|O #5#42 = "B";|O #5#42 = "E";         || agrarios
          |ACABA;
     |FINSI;

     |HAZ la_mama;            || si tiene maternidad

     |DDEFECTO #8;
     #8#0 = #6#12;
     |LEE 000#8=;
     |SI FSalida ! 0;
          #8#0 = 0;
     |SINO;
          nMes = #0#2;
          nAny = #0#3;
          nCodigoBon = #8#0;
          |HAZ VerifBonif;
     |FINSI;
     |SI #labtraba#248 = 516; |O #labtraba#248 = 518; |O #labtraba#248 = 520;
          |SI #labtraba#45 = "421";
               ||SI #8#0 = 0;
                    #8#0 = 525;
                    #8#10 = 2;
                    #6#12 = 525;
               ||FINSI;
          |FINSI;
     |FINSI;

     |SI #6#9 = 97;
          |HAZ bonif_97;
     |FINSI;

     |SI #8#0 ! 0;
         |HAZ el_tipo;
         |HAZ lee_centr;
         |SI #6#3 = 0;        || tipo nomina normal/finiquitos
             |HAZ tmp_1;           || TC2/1 normal
         |SINO;
             |SI aParam ! "TC2";
                 |HAZ tmp_1;      || TC2/1 normal (finiquitos separados)
             |SINO;
                 |SI eaTipoLi = "F";
                      |HAZ tmp_1;     || en finiquitos que pase por aqui
                 |SINO;               || si no que haga lo de siempre
                      |HAZ tmp_12;    || TC2/1 normal (finiquito junto al mes)
                 |FINSI;              || si no lo pongo asi no salen las bonif.
             |FINSI;
         |FINSI;
         |HAZ tmp_2;               || TC2/1 subvencion de horas
     |FINSI;

     swSigue = 0;
     |SI #6#92 ! 0; |O #6#95 ! 0;                      || RDL 16/2001
          swSigue = 1;
     |FINSI;
     |SI #labtraba#211 ! 0; |Y #labtraba#242 ! 0;      || expedientes de
          swSigue = 1;                                 || regulacion de empleo
     |FINSI;
     |SI swSigue = 1;
         |HAZ bonif_16;
         |HAZ tmp_1;           || TC2/1 normal
     |FINSI;
|FPRC;

|PROCESO la_mama;
    sw_mater = 0;
|SI #6#65 ! 0;|Y anyonum ] 1995;        || bonificacion maternidad 1995

        m_dias = #6#65;
    |SI runnom = "nomyytc2";|Y #5#60 = "M"; m_dias = m_dias + #5#89; |FINSI;
    |SI runnom = "nomwwtc2";|Y #6#90 = "M"; m_dias = m_dias + #6#91; |FINSI;

        nume1 = 0;
    |SI #6#27 = "M";     nume1 = #6#23; |FINSI;
    |SI #6#28 = "M";     nume1 = #6#24; |FINSI;
    |SI #6#29 = "M";     nume1 = #6#25; |FINSI;
    |SI #6#30 = "M";     nume1 = #6#26; |FINSI;
    |SI nume1 = 0;       nume1 = #6#7;  |FINSI;

        alfa1 = nume1;       alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
        alfa2 = #6#2;        alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
        alfa3 = alfa1 + "." + alfa2 + "." + anyonum;
        fech1 = alfa3;            nume1 = fech1;
        fech2 = "01.01.1995";     nume2 = fech2;
        nume3 = nume1 - nume2 + 1;

    |SI m_dias [ nume3; sw_mater = 1;  |FINSI;
    |SI #6#2 ] 6;                  sw_mater = 1;  |FINSI;
|FINSI;
|FPRC;

|PROCESO bonif_mater;
     || 100 -> maternidad sobre contratos normales
     || 101 -> maternidad sobre contratos 64
     || 104 -> maternidad sobre contratos 87
     || 105 -> maternidad sobre contratos 85
     || 106 -> maternidad sobre contratos 65
|DDEFECTO #8;
|SI tip ! 9;|Y tip ! 8;
        #8#0  = 100;                             || codigo bonificacion
        #8#6  = #11#7;                           || linea 1 trabajador
        #8#1  = "SITUACION MATERNIDAD";          || descripcion
|SINO;
        #8#1  = "SIT.MATERNIDAD /" + #6#9;       || descripcion especial
|FINSI;
|SI tip = 8;
    |SI #6#9 = 87;  #8#0 = 104;    |FINSI;
    |SI #6#9 = 85;  |O #6#9 = 421; #8#0 = 105;    |FINSI;
|FINSI;
|SI tip = 9;
    ||SI #6#9 = 64;  #8#0 = 101;    #8#6 = #11#7 * #15#21;   |FINSI;
    ||SI #6#9 = 65;  #8#0 = 106;    #8#6 = #11#7 * #15#22;   |FINSI;
|FINSI;

    #8#3  = 100;                             || % bonificacion
||    #8#7  = #11#13+#11#15+#11#17+#11#19;     || linea 2 trabajador
    #8#7  = 0;      || YA NO EXISTE REDUCCION!!! 2002
    #8#8  = "N";                             || accidentes NO
    #8#10 = 3;                               || situacion TC1
|FPRC;

|PROCESO bonif;                    || vemos si tiene realmente bonif.
     swBonif = 0;                  || en exp. reg. empleo segun la fechas de
     anyocal = #0#3;               || alta y baja de la bonif
     mescal = #0#2;
     alfa1 = #labtraba#41 % -104;        || a¤o baja bonif.
     alfa2 = #labtraba#41 % 402;         || mes baja bonif.
     anyofin = alfa1;
     mesfin = alfa1;
     |SI anyofin ! 0;
          |SI anyofin ] anyocal;
               |SI anyofin = anyocal;
                    |SI mesfin ] mescal;
                         swBonif = 1;
                    |FINSI;
               |SINO;
                    swBonif = 1;
               |FINSI;
          |FINSI;
     |SINO;
          meses_bon = #nombonif#14 + #nombonif#15 + #nombonif#16;
          |SI meses_bon ] 999;
               swBonif = 1;
          |SINO;
               meses_bon = meses_bon / 1000;
               fecha1 = #labtraba#40;        || fecha alta bonif.
               fecha1 = fecha1 + meses_bon;
               alfa1 = fecha1;
               alfa2 = alfa1 % -104;
               alfa3 = alfa1 % 402;
               anyofin = alfa2;
               mesfin = alfa3;
               |SI anyofin ] anyocal;
                    |SI anyofin = anyocal;
                         |SI mesfin ] mescal;
                              swBonif = 1;
                         |FINSI;
                    |SINO;
                         swBonif = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     ||SI #labtraba#211 ! 0; |Y s_pas = 4;
     |SI #labtraba#211 ! 0;
          swBonif = 1;
     |FINSI;
/*
     |SI s_pas ! 4;
          swBonif = 0;
     |FINSI;
*/
|FPRC;

|PROCESO por_bon_16;
     alfa1 = #labtraba#11 % -104;        || anyo nacimiento
     alfa2 = #labtraba#11 % -602;        || mes nacimiento
     alfa5 = #labtraba#11 % 102;         || dia nacimiento
     alfa3 = aFechaRef % -104;        || anyo Fecha Referencia
     alfa4 = aFechaRef % -602;        || mes Fecha Referencia
     alfa6 = aFechaRef % 102;         || dia Fecha Referencia
     nume1 = alfa1;
     nume1 = alfa1 + 60;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + 5;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad

     |SI nume1 > nume3;            || cuando cumple 60 a¤os
          |SI nume1 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 a¤os
               |SI nume1 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 a¤os
                    |SI nume1 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume6 < nume5;            || cuando cumple antiguedad
                    |SI nume3 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
     |FINSI;

alfa7 = fecha_bon_16 % 402;
nume7 = alfa7;
alfa7 = fecha_bon_16 % -104;
nume8 = alfa7;
|SI #0#2 = nume7; |Y #0#3 = nume8;      || si estoy calculando el mes q entra
     alfa7 = fecha_bon_16 % 102;        || en vigor la bonif. calcula el % correspondiente
     nume7 = alfa7;                     || segun la fecha inicio de bonif.
     nume7 = topemes - nume7 + 1;        || "guarda" se trae los dias del mes
|SINO;
     nume7 = topemes;                    || si es un mes posterior calcula el
|FINSI;                                 || 100% ya que entra entera.
por_bon_16 = (nume7 / topemes) * 100;

|FPRC;

|PROCESO calboni60;      || BONIFICACION MAYORES 60 A¤OS RDL. 16/2001
     nume1 = #0#3;       || EN EXPEDIENTES DE REGULACION DE EMPLEO
/*
     |SI nume1 > 2002;
           por_bon_60 = 22.18;
     |SINO;
           por_bon_60 = 22.30;
     |FINSI;
     bon_60 = 0;
     aFechaRef = "";
     |SI #labtraba#212 = 2;
          aFechaRef = #labtraba#36;       || fecha de referencia: fecha de Alta
     |SINO;
          aFechaRef = #labtraba#34;       || fecha de referencia: fecha de Antiguedad
     |FINSI;
     alfa1 = #labtraba#11; |QBF alfa1;    || compruebo que exista fecha nacimiento
     alfa2 = aFechaRef; |QBF alfa2;    || compruebo que exista fecha de refer.
     |SI alfa1 = ""; |O alfa2 = ""; |O alfa1 = ".........."; |O alfa2 = "..........";
          |ACABA;
     |FINSI;
     |SI #labtraba#211 ! 0;
          |HAZ por_bon_16;
          bon_60 = (bon_0  % por_bon_60) % #labtraba#211;
          bon_60 = (bon_60 % por_bon_16) ! EURODB;
     |FINSI;
*/

|| todo lo otro son chorradas, ya lo tengo calculado
     |SI #6#92 ! 0;
          bon_60 = #6#92;
     |FINSI;
|FPRC;

|PROCESO BoniExpediente;
|SI #tsilcon1#27 ! "D"; |Y #tsilcon1#28 ! "D"; |Y #tsilcon1#29 ! "D"; |Y #tsilcon1#30 ! "D";
     |ACABA;
|FINSI;
     |SI swBoniExp ! 0;
          |ACABA;
     |FINSI;
     swBoniExp = 1;
     nPorBon = #tsilcon1#82;
     |SI #tsilcon1#81 ! 0;     nPorBon = #tsilcon1#83;   |FINSI;

     |DDEFECTO #nomepigr;
     |ABRE #nomepigr;
|| migue
     |SI s_anyl [ 2009;
          |SI s_anyl [ 2006;
               #nomepigr#0 = 126;
          |SINO;
               #nomepigr#0 = 904;
          |FINSI;
     |SINO;
          |HAZ VerifCNAE;
          #nomepigr#0 = nEpigConv;
     |FINSI;
     |LEE 000#nomepigr.=;
     epig_ilt = #nomepigr#1;
     epig_ims = #nomepigr#2;
     |CIERRA #nomepigr;

     |SI s_anyl [ 2006;
          nEpigConv = #labtraba#32;
     |SINO;
          |HAZ VerifCNAE;
     |FINSI;
     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = nEpigConv;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0; |Y s_anyl [ 2006;
          epig_ilt = #nomepitr#3;
          epig_ims = #nomepitr#4;
     |FINSI;
     |CIERRA #nomepitr;

/*     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;

     |DDEFECTO #nomcones;
     |ABRE #nomcones;
     #nomcones#0 = #labempre#32;
     |LEE 000#nomcones.=;
     |CIERRA #nomcones;
*/

     nCConst = #labtraba#248;
     |HAZ constante;

     por1_cont = #nomconst#7;
     por1_dfpg = #nomconst#13 + #nomconst#15 + #nomconst#17 + #nomconst#19;
     |SI #tsilcon1#9 = 64;    por1_cont = por1_cont * #nomcones#21;   |FINSI;
     |SI #tsilcon1#9 = 65;    por1_cont = por1_cont * #nomcones#22;   |FINSI;
     por1_cont = por1_cont ! 2;

     bon_0 = #tsilcon1#78 * #labtraba#242;        || base CC
     bon_3 = #tsilcon1#78 * #labtraba#242;        || base CP
     bon_5 = 0;

     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;
     bon_60 = 0;
     por_bon_60 = 0;
     por_bon_16 = 0;

     base_A = (bon_0 % #nombonif#4) % nPorBon;
     base_A = base_A ! EURODB;
     base_B = (bon_3 % #nombonif#5) % nPorBon;
     base_B = base_B ! EURODB;
     |SI #nombonif#8 = "S";
          zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
          zbase_9 = zbase_9 ! EURODB;
          zbase_9 = zbase_9 + (bon_5 % (#nomconst#3 + #nomconst#4));
          zbase_9 = zbase_9 ! EURODB;
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;
     |FINSI;
     base_F = base_A + base_B + base_C;

     || se calcula en nomina no hace falta aqui a¤adirle la parte de
     || regulacion de empleo
     base_F = 0;
     |HAZ calboni60;
     base_F = base_F + bon_60;

     || #tsilcon1#43 = #tsilcon1#43 + bon_0;
     || #tsilcon1#44 = #tsilcon1#44 + bon_3;

     #tsilcon1#63 = #tsilcon1#63 + base_F;
     || #tsilcon1#81 = 0;
     #tsilcon1#92 = 0;
     #tsilcon1#92 = #tsilcon1#92 + bon_60;
|FPRC;

|PROCESO liquidados;
|SI s_ori = "A";|O s_ori = "T";
        dia_2 = 30 * (s_has - s_mes + 1);    || dias que tiene el mes
        dia_3 = 30 * (s_has - s_mes + 1);    || dias cotizacion 'mensual'
    |SI #5#42 = "D";|O #5#42 = "T";
            dia_3 = 30 * (s_has - s_mes + 1);|| dias cotizacion 'diario'
    |FINSI;
        dia_4 = dia_3;
|SINO;
        dia_2 = topemes;     || dias que tiene el mes
        dia_3 = 30;          || dias cotizacion 'mensual'
    |SI #5#42 = "D";|O #5#42 = "T";
            dia_3 = topemes; || dias cotizacion 'diario'
    |FINSI;
        dia_4 = dia_3;
|FINSI;

|SI nume1 > dia_4;  nume1 = dia_4;  |FINSI;
|SI nume1 = dia_2; |Y nume1<dia_4;  nume1 = dia_4;  |FINSI;
|FPRC;

|PROCESO calcu_mater;
    #6#12 = #8#0;             || codigo bonificacion
    nume1 = #6#65;
|HAZ liquidados;
    #6#43 = #6#35 * nume1;    || c.c.
    #6#44 = #6#36 * nume1;    || c.p.

    #6porc1 = #8#3;           || para que imprima el TC2/1
    #6#63 = 1;                || para que grabe el temporal
|FPRC;

|PROCESO bonif_97;
     || 102 -> bonificacion sobre contratos 97 antes del 17.05.1997
     || 103 -> bonificacion sobre contratos 97 despues del 17.05.1997

    fech1 = #6#4;
|SI fech1 < "17.05.1997";
      #8#0 = 200 + #8#0;      || en 'ruptura2' se necesita el cod.de bonif.
|SINO;
      #8#0 = 300 + #8#0;
|FINSI;

    #6#12 = #8#0;
|FPRC;

|PROCESO bonif_16;       || RDL 16/2001 (campo 211 del labtraba)
     || 516 -> bonificacion segun RDL 16/2001

     #8#0 = 516;     || en 'ruptura2' se necesita el cod.de bonif.
     #6#12 = #8#0;
|FPRC;

|PROCESO traba_mater;
|SI #6#27 = "M"; m_des = #6#19;    m_has = #6#23; |FINSI;
|SI #6#28 = "M"; m_des = #6#20;    m_has = #6#24; |FINSI;
|SI #6#29 = "M"; m_des = #6#21;    m_has = #6#25; |FINSI;
|SI #6#30 = "M"; m_des = #6#22;    m_has = #6#26; |FINSI;

|SI m_des ! 0;
        alfa1 = m_des;   alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
        alfa2 = #6#2;    alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
        m_fec = alfa1 + "." + alfa2 + "." + anyonum;
|SINO;
    |SI m_has ! 0;
            alfa1 = m_has;   alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
            alfa2 = #6#2;    alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
            m_top = alfa1 + "." + alfa2 + "." + anyonum;
    |SINO;
            m_top = f_mes + anyonum;
    |FINSI;
        fech1 = m_top;   nume1 = fech1;
        nume1 = nume1 - m_dias + 1;
        fech1 = nume1;
        m_fec = fech1;
|FINSI;

    #5#40 = m_fec;      || fecha inicio maternidad
|FPRC;

|PROCESO meslite;
|SI #0#2 = 1;  lite_mes = "Enero     "; f_mes = "31.01."; |FINSI;
|SI #0#2 = 2;  lite_mes = "Febrero   "; f_mes = "28.02."; |FINSI;
|SI #0#2 = 3;  lite_mes = "Marzo     "; f_mes = "31.03."; |FINSI;
|SI #0#2 = 4;  lite_mes = "Abril     "; f_mes = "30.04."; |FINSI;
|SI #0#2 = 5;  lite_mes = "Mayo      "; f_mes = "31.05."; |FINSI;
|SI #0#2 = 6;  lite_mes = "Junio     "; f_mes = "30.06."; |FINSI;
|SI #0#2 = 7;  lite_mes = "Julio     "; f_mes = "31.07."; |FINSI;
|SI #0#2 = 8;  lite_mes = "Agosto    "; f_mes = "31.08."; |FINSI;
|SI #0#2 = 9;  lite_mes = "Septiembre"; f_mes = "30.09."; |FINSI;
|SI #0#2 = 10; lite_mes = "Octubre   "; f_mes = "31.10."; |FINSI;
|SI #0#2 = 11; lite_mes = "Noviembre "; f_mes = "30.11."; |FINSI;
|SI #0#2 = 12; lite_mes = "Diciembre "; f_mes = "31.12."; |FINSI;
|FPRC;

|| ***************************************************************************
|| ****** calculos de lectura e impresion ************************************
|| ***************************************************************************

|PROCESO impresion1;
    t_cbonif = t_cbonif + #4#20;
||PRINT;
|FPRC;

|DEFBUCLE nomytc212;   || NOTA: lee segun lo seleccionado en el fichero 7
 #4#1;                 || CLAVE: empresa,bonificacion,trabajador
 ;
 antempre, antbonif,     1;
 antempre, antbonif, 99999;
 ;
 NULL, impresion1;
|FIN;

|DEFBUCLE centros;     || NOTA: lee segun lo seleccionado en el fichero 7
 #4#2;                 || CLAVE: empresa,centro,bonificacion,trabajador
 ;
 antempre, antcentr, antbonif,     1;
 antempre, antcentr, antbonif, 99999;
 ;
 NULL, impresion1;
|FIN;

|PROCESO segundo_tc;
     swSigue = 0;
     |SI #8#11 = "S";|Y dtipo = 0;      || si hay subvenciones por horas
          swSigue = 1;
     |FINSI;
     |SI #8#0 = 525;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 1;
          |SI siono_cen = "N";   |BUCLE nomytc212;   |FINSI;
          |SI siono_cen = "S";   |BUCLE centros;     |FINSI;
          |HAZ auxiliar1;      || graba en el auxiliar de empresas
     |FINSI;
|FPRC;

|PROCESO ruptura1;
     |HAZ pie;                || calculo pie de informe
     |HAZ auxiliar;           || graba en el auxiliar de empresas
     |HAZ segundo_tc;
     |HAZ limpieza;           || inicializa variables acumuladoras
|FPRC;

|PROCESO abreviado;      || LEE AUX. DE EMPRESAS PARA SABER SI ES ABREVIADO
    #2#00 = antempre;                                  || codigo empresa
    #2#01 = #0#2;                                      || mes
    #2#02 = anttipo + dtipo;                           || tipo
|SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)
|SI siono_cen = "S";  #2#18 = antcentr;  |FINSI;       || centro trabajo
|SI siono_cen = "N";  #2#18 =       99;  |FINSI;
|LEE 000#2=;
|SI FSalida = 0;|Y #2#22 = "S";
        sw_abierto = 1;
|SINO;
        sw_abierto = 0;
|FINSI;
|FPRC;

|PROCESO ruptura2;
     antempre = #7#0;
     antcentr = #7#25;
     antbonif = #7#1;
     anttipo  = #7#27 - dtipo;
     antporce = #7#14;
     antbase = #7#20;    || me quedo que despues me hara falta
     |HAZ abreviado;
     nEsDoble = 0;
     |DDEFECTO #8;
     |SI #7#1 ! 516; |Y #7#1 ! 525;
          |SI #7#1 > 400; |Y #7#1 < 501; || cuando es doble bonificacion
               #7#1 = #7#1 - 400;
               #8#0 = #7#1;
               nEsDoble = 1;
          |FINSI;
          |SI #7#1 < 200; |O #7#1 > 500;
               #8#0 = #7#1;
          |SINO;
               |SI #7#1 < 300;
                    #8#0 = #7#1 - 200;     || contratos 97 antes de 17.05.1997
                    #7#1 = 102;
               |SINO;
                    #8#0 = #7#1 - 300;     || contratos 97 despues de 17.05.1997
                    #7#1 = 103;
               |FINSI;
          |FINSI;
          |LEE 000#8=;
          |SI FSalida = 0;
               nMes = #0#2;
               nAny = #0#3;
               nCodigoBon = #8#0;
               |HAZ VerifBonif;
          |FINSI;
          |SI #7#1 > 99;
               |ABRE #1;  #1#0 = #7#0;   |LEE 020#1=;   |CIERRA #1;
               |SI eaVengoDe = "nomtc210";
                    #1#45 = "S";
               |FINSI;

               nCConst = #labtraba#248;
               |HAZ constante;

               |SI #7#1 = 100;|O #7#1 = 101;|O #7#1 = 104;|O #7#1 = 105;|O #7#1 = 106;
                    tip = #7#27;
                    #6#9 = #7#30;     || cod.contrato
                    |HAZ bonif_mater;
               |FINSI;
               |SI #7#1 = 102;|O #7#1 = 103;
                    #8#0 = #7#1;
               |FINSI;
          |FINSI;
     |SINO;
          |DDEFECTO #8;
          #8#0 = #7#1;        || RDL 16/2001 o 525
          #8#10 = 2;          || situacion TC1: bonificacion
     |FINSI;
|FPRC;

|PROCESO impresion;
    haentrat = 1;
|SI antempre = -1;  |HAZ ruptura2;  |FINSI;
|SI antempre ! #7#0;                         || ruptura por empresa
    |HAZ ruptura1;
    |HAZ ruptura2;
|SINO;
    |SI antcentr ! #7#25;|Y siono_cen = "S";      || ruptura por centro
        |HAZ ruptura1;
        |HAZ ruptura2;
    |SINO;
        |SI antbonif ! #7#1;                 || ruptura por bonificacion
            |HAZ ruptura1;
            |HAZ ruptura2;
        |SINO;
            |SI antporce ! #7#14;
                |HAZ ruptura1;
                |HAZ ruptura2;
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
    t_bonif1 = t_bonif1 + #7#20;   || Acumulado contingencias comunes
    t_bonif2 = t_bonif2 + #7#21;   || Acumulado A.T y E.P

     |HAZ piecito;

||HAZ retroactivas;

|SI #7#20 = 0;|Y #7#21 = 0;
        sibonif = 111;
|SINO;
        sibonif = 0;
|FINSI;

|SI #8#8 = "S";                || Si la bonificacion tiene accidentes
                               || ******* Tablas de epigrafes **********
    |ABRE #5;
    |ABRE #9;
    |ABRE #12;
        #5#0 = #7#0;
        #5#1 = #7#2;
    |LEE 000#5=;
          |SI FSalida = 0;
               |SI s_anyl [ 2006;
                    epi_tra = #5#32;
                    epi_bas = #7#21 - #7#26;
               |SINO;
                    |HAZ VerifCNAE;
                    epi_tra = nEpigConv;
                    epi_bas = #7#21 - #7#26;
               |FINSI;
               |HAZ calc_epig;
               |SI #7#26 ! 0;        || si tiene base por ILT genera epig.enfer.
                    epi_tra = #11#2;
                    epi_bas = #7#26;
                    |HAZ calc_epig;
               |FINSI;
          |FINSI;
    |CIERRA #5;
    |CIERRA #9;
    |CIERRA #12;
|FINSI;

||SI sibonif = 0; |Y #8#0 ! 0; |Y #7#14 ! 0; |Y #7#1 ! 516;
|| Atencion, antes estaba como arriba y no entraba si era la 516 (Bonif.
|| para mayores de 60 a¤os) en atrasos, bueno, lo quito (06.04.2005)
|SI sibonif = 0; |Y #8#0 ! 0; |Y #7#14 ! 0;
        endo = endo + 1;

    |SI #8#0 = 100;|O #8#0 = 101;|O #8#0 = 104;|O #8#0 = 105;|O #8#0 = 106;
            #8#3 = 0;    #7#14 = 0;     #7#31 = "";    || no en maternidad
    |FINSI;
    ||PRINT;
    |SI #8#0 = 100;|O #8#0 = 101;|O #8#0 = 104;|O #8#0 = 105;|O #8#0 = 106;
            #8#3 = 100;  #7#14 = 100;   #7#31 = #8#0;  || lo repone
    |FINSI;
    |HAZ AtrasosDobles;
|FINSI;
|FPRC;

|PROCESO calc_epig;
|SI epi_tra ! #11#2;
    |DDEFECTO #9;
        #9#0 = epi_tra;
    |LEE 020#9=;
        epig_ilt = #9#1;           || porcentajes del epigrafe normal
        epig_ims = #9#2;
|SINO;
        epig_ilt = #11#3;          || porcentajes del epig.enf.
        epig_ims = #11#4;
|FINSI;

    #12#0 = #5#0;
    #12#1 = #5#1;
    #12#2 = epi_tra;
|LEE 000#12=;
|SI FSalida = 0;
        epig_ilt = #12#3;          || porcentajes del epigrafe/trabajador
        epig_ims = #12#4;
|FINSI;

|SI tablaepi1  = 0; |O tablaepi1 = epi_tra;
        tablaepi1  = epi_tra;
        porcepig1  = epig_ilt + epig_ims;
        basepigr1  = basepigr1 + epi_bas;
|SINO;
    |SI tablaepi2 = 0; |O tablaepi2 = epi_tra;
            tablaepi2 = epi_tra;
            porcepig2 = epig_ilt + epig_ims;
            basepigr2 = basepigr2 + epi_bas;
    |SINO;
        |SI tablaepi3 = 0; |O tablaepi3 = epi_tra;
                tablaepi3 = epi_tra;
                porcepig3 = epig_ilt + epig_ims;
                basepigr3 = basepigr3 + epi_bas;
        |SINO;
            |SI tablaepi4 = 0; |O tablaepi4 = epi_tra;
                    tablaepi4 = epi_tra;
                    porcepig4 = epig_ilt + epig_ims;
                    basepigr4 = basepigr4 + epi_bas;
            |SINO;
                    tablaepi5 = epi_tra;
                    porcepig5  = epig_ilt + epig_ims;
                    basepigr5  = basepigr5 + epi_bas;
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE por_empresa;   || NOTA: lee todo el fichero
 #7#1;                   || CLAVE: empresa,bonificacion,trabajador,tipo
 ;
 "N",     0,   0,    0,     1, dtipo;
 "N", 99999, 999, 9999, 99999, htipo;
 ;
 NULL, impresion;
|FIN;

|DEFBUCLE por_centros;   || NOTA: lee todo el fichero
 #7#2;                   || CLAVE: empresa,centro,bonificacion,trabajador,tipo
 ;
 "S",     0,   0,   0,    0,     1, dtipo;
 "S", 99999, 999, 999, 9999, 99999, htipo;
 ;
 NULL, impresion;
|FIN;

|| ***************************************************************************
|| ****** calculos desde el mantenimiento ************************************
|| ***************************************************************************

|PROCESO el_bucle;
    dtipo = 0;   htipo = 9;
|PARA; |SI; |HACIENDO;
        sw_red = 0;
    |SI dtipo = 0; |Y s_pas [ 3;                  sw_red = 1;    |FINSI;
    |SI dtipo = 10;|Y s_pas ] 4;|Y s_tipd ! "N";  sw_red = 1;    |FINSI;
    |SI sw_red = 1;
            antempre = -1;
            antcentr = -1;
            antbonif = -1;     || inicializa variables para rupturas
            antporce = -1;
            antbase = -1;
            haentrat = 0;      || switch para saber si lee
        |SI siono_cen = "N";  |BUCLE por_empresa; |FINSI;
        |SI siono_cen = "S";  |BUCLE por_centros; |FINSI;
        |SI haentrat = 1;      || si ha impreso cierra el informe, totalizando
            |HAZ ruptura1;
        |FINSI;

    |FINSI;
    |SI dtipo = 0;
            dtipo = 10;   htipo = 19;
    |SINO;
        |SAL;
    |FINSI;
|SIGUE;
|FPRC;

|PROCESO busca_SisGarJuv;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 0;       || tipo el 0, ni atrasos ni finiquitos ni historias
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;

     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
                                   || atencion, tengo que poner esto que si no
          |ACABA;                  || me graba tambien las bonif de los agrarios
     |FINSI;                       || en el lote

     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     #2#98 = #2#98 + #6#122;      || bonif./subven. 601

     |SI estado ! 0;
          |GRABA 020#2n;
     |SINO;
          |GRABA 020#2a;
     |FINSI;

     |LIBERA #2;
|FPRC;

|DEFBUCLE busca_SisGarJuv;         || busco posibles bonificaciones del
     #6#1;                         || Sistema de Garantia Juvenil
     122;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 2, 9999.99;
     ;
     NULL, busca_SisGarJuv;
|FIN;

|PROCESO acum_May59;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 0;       || tipo el 0, ni atrasos ni finiquitos ni historias
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;

     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
                                   || atencion, tengo que poner esto que si no
          |ACABA;                  || me graba tambien las bonif de los agrarios
     |FINSI;                       || en el lote

     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     #2#11 = #2#11 + #6#99;      || bonif./subven. 601

     |SI estado ! 0;
          |GRABA 020#2n;
     |SINO;
          |GRABA 020#2a;
     |FINSI;

     |LIBERA #2;
|FPRC;

|DEFBUCLE busca_May59;               || busco posibles bonificaciones del
     #6#1;                         || programa de fomento de empleo
     99;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 2, 9999.99;
     ;
     NULL, acum_May59;
|FIN;

|PROCESO Dias_nat_alta;
     nDias_nat_alta = 0;

     alfa1 = "01";
     alfa2 = #0#2; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech1 = alfa4;      || PRIMER DIA DEL MES

     alfa1 = topemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
     alfa2 = #0#2; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech2 = alfa4;      || ULTIMO DIA DEL MES

     alfa1 = aFechaAlta;
     fech3 = alfa1;      || DIA ALTA TRABAJADOR

     alfa1 = aFechaBaja;
     fech4 = alfa1;      || DIA BAJA TRABAJADOR

     |SI fech3 ] fech1;
          fech5 = fech3;
     |SINO;
          fech5 = fech1;
     |FINSI;

     |SI fech4 [ fech2;
          fech6 = fech4;
     |SINO;
          fech6 = fech2;
     |FINSI;

     nume1 = fech5;
     nume2 = fech6;

     nDias_nat_alta = nume2 - nume1 + 1;
|FPRC;

|PROCESO Parche_Fini;
     nDiasVac = 0;
     nDiasAlta = 0;
     nDiasBT = 0;
     nImporte = 0;
     |SI s_tat ! 2; |ACABA; |FINSI;
     |SI #labtraba#42 = "M"; |Y topemes = 31;
          |SI eaFuente = "M";
               |ABRE #nomcalca;
               #nomcalca#0 = #6#0;
               #nomcalca#1 = #6#1;
               #nomcalca#2 = #0#2;
               #nomcalca#3 = 0;
               |LEE 000#nomcalca.=;
               |SI FSalida = 0;
                    aFechaAlta = #nomcalca#4;
                    aFechaBaja = #nomcalca#5;
                    |HAZ Dias_nat_alta;
                    nDiasAlta = nDias_nat_alta;
               |FINSI;
               nImporte = #nomcalca#96 + #nomcalca#102;
               |CIERRA #nomcalca;

               |ABRE #nomcalli;
               #nomcalli#0 = #6#0;
               #nomcalli#1 = #6#1;
               #nomcalli#2 = #0#2;
               #nomcalli#3 = 2;
               #nomcalli#4 = 125;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    nDiasVac = #nomcalli#11;
               |FINSI;
               |CIERRA #nomcalli;
          |FINSI;
          |SI eaFuente = "H";
               |ABRE #nomhicca;
               #nomhicca#0 = #6#0;
               #nomhicca#1 = #6#1;
               #nomhicca#66 = #0#3 - 2000;
               #nomhicca#2 = #0#2;
               #nomhicca#3 = 0;
               |LEE 000#nomhicca.=;
               |SI FSalida = 0;
                    aFechaAlta = #nomhicca#4;
                    aFechaBaja = #nomhicca#5;
                    |HAZ Dias_nat_alta;
                    nDiasAlta = nDias_nat_alta;
               |FINSI;
               nImporte = #nomhicca#138 + #nomhicca#144;
               |CIERRA #nomhicca;

               |ABRE #nomhicli;
               #nomhicli#0 = #6#0;
               #nomhicli#1 = #6#1;
               #nomhicli#12 = #0#3 - 2000;
               #nomhicli#2 = #0#2;
               #nomhicli#3 = 2;
               #nomhicli#4 = 125;
               |LEE 000#nomhicli.=;
               |SI FSalida = 0;
                    nDiasVac = #nomhicli#11;
               |FINSI;
               |CIERRA #nomhicli;
          |FINSI;

          nDiasVac = (nDiasVac + 0.49) ! 0;
          nDiasBT = nDiasAlta + nDiasVac;
          |SI nDiasBT > 31; |Y nDiasAlta ! 31;
               nImporte = (nImporte / nDiasAlta) ! 2;
               #2#12 = #2#12 - nImporte;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO bonif_form;
     |DDEFECTO #2;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 8;       || tipo el 8: es un centro de formacion siempre
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;
     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
          |SI #labtraba#45 = "421"; |O #labtraba#45 = "422";
               || existen agrarios en formacion, estas bonificaciones si que hay
               || que tenerlas en cuenta 766.1472 23/09/2015
          |SINO;
                                        || atencion, tengo que poner esto que si no
               |ACABA;                  || me graba tambien las bonif de los agrarios
          |FINSI;                       || en el lote
     |FINSI;

     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     fFechaAlta = #labtraba#36;
     fFechaRef = "31.08.2011";
     swSigue = 1;
     |SI #6#37 ! 0; |O s_tat ! 2;
          || continua
     |SINO;
           swSigue = 0;  || parate
     |FINSI;
     |SI s_tat = 2;
          |SI #6#9 = 421; |O #6#9 = 422;
               |SI #6#160 = 0;
                    || finiquitos de contratos de formacion, si no hay dias
                    || para el mes siguiente, no hay tipo 2, no puede haber
                    || ni bonificaciones ni leches
                    swSigue = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          || bonificacion de formacion solo si hay base de cotizacion
          || si no es que estoy en un finiquito que no cotiza (con indemnizacion)
          || donde tambien se queda grabada la bonificacion

          |SI fFechaAlta ] fFechaRef;
               |SI #6#9 = 422;
                    #2#12 = #2#12 + #6#120;  || miguebecarios desde 8/2014
               |SINO;
                    #2#11 = #2#11 + #6#120;  || reduccion a partir del RDL 10/2011
               |FINSI;
          |SINO;
               #2#12 = #2#12 + #6#120;       || bonif./subven. 601
          |FINSI;

          |HAZ Parche_Fini;

          |SI estado ! 0;
               |GRABA 020#2n;
          |SINO;
               |GRABA 020#2a;
          |FINSI;
          |LIBERA #2;
     |SINO;
          |LIBERA #2;
     |FINSI;
|FPRC;

|DEFBUCLE bonif_form;              || busco posibles bonificaciones de los
     #6#1;                         || contratos de formacion
     120;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 2, 9999.99;
     ;
     NULL, bonif_form;
|FIN;

|PROCESO bonif_tut;
     |DDEFECTO #2;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 8;       || tipo el 8: es un centro de formacion siempre
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;
     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
          |SI #labtraba#45 = "421"; |O #labtraba#45 = "422";
               || existen agrarios en formacion, estas bonificaciones si que hay
               || que tenerlas en cuenta 766.1472 23/09/2015
          |SINO;
                                        || atencion, tengo que poner esto que si no
               |ACABA;                  || me graba tambien las bonif de los agrarios
          |FINSI;                       || en el lote
     |FINSI;

     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     fFechaAlta = #labtraba#36;
     fFechaRef = "31.08.2011";
     swSigue = 1;
     |SI #6#37 ! 0; |O s_tat ! 2;
          || continua
     |SINO;
           swSigue = 0;  || parate
     |FINSI;
     |SI swSigue = 1;
          || bonificacion de formacion solo si hay base de cotizacion
          || si no es que estoy en un finiquito que no cotiza (con indemnizacion)
          || donde tambien se queda grabada la bonificacion

          #2#12 = #2#12 + #6#163;       || bonif./subven. 601

          |SI estado ! 0;
               |GRABA 020#2n;
          |SINO;
               |GRABA 020#2a;
          |FINSI;
          |LIBERA #2;
     |SINO;
          |LIBERA #2;
     |FINSI;
|FPRC;

|DEFBUCLE bonif_tut;               || busco posibles bonificaciones de los
     #6#1;                         || contratos de formacion TUTORIAS
     163;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 0, 9999.99;
     ;
     NULL, bonif_tut;
|FIN;

|PROCESO acum_TEX;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 0;       || tipo el 0, ni atrasos ni finiquitos ni historias
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;

     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
                                   || atencion, tengo que poner esto que si no
          |ACABA;                  || me graba tambien las bonif de los agrarios
     |FINSI;                       || en el lote

     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     #2#12 = #2#12 + #6#96 + #6#113;      || bonif./subven. 601

     |HAZ Parche_Fini;

     |SI estado ! 0;
          |GRABA 020#2n;
     |SINO;
          |GRABA 020#2a;
     |FINSI;

     |LIBERA #2;
|FPRC;

|DEFBUCLE busca_TEX;               || busco posibles bonificaciones del
     #6#1;                         || programa de fomento de empleo
     96;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 2, 9999.99;
     ;
     NULL, acum_TEX;
|FIN;

|PROCESO acum_PFE;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 0;       || tipo el 0, ni atrasos ni finiquitos ni historias
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;

     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
                                   || atencion, tengo que poner esto que si no
          |ACABA;                  || me graba tambien las bonif de los agrarios
     |FINSI;                       || en el lote

     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     |SI #6#114 ! 157; |Y #6#114 ! 158;
          #2#12 = #2#12 + #6#94;        || bonif./subven. 601
     |SINO;
          #2#11 = #2#11 + #6#94;        || reduccion
     |FINSI;

     |SI #6#115 ! 157; |Y #6#115 ! 158;
          #2#12 = #2#12 + #6#112;      || bonif./subven. 601
     |SINO;
          #2#12 = #2#11 + #6#112;      || reduccion
     |FINSI;

     |HAZ Parche_Fini;

     |SI estado ! 0;
          |GRABA 020#2n;
     |SINO;
          |GRABA 020#2a;
     |FINSI;

     |LIBERA #2;
|FPRC;
|| migue

|DEFBUCLE busca_PFE;               || busco posibles bonificaciones del
     #6#1;                         || programa de fomento de empleo
     94;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 2, 9999.99;
     ;
     NULL, acum_PFE;
|FIN;

|PROCESO FormCont99;
     #2#12 = #2#12 + nBonifFPCont;      || bonif./subven. 601
     #2#95 = #2#95 + nBonifFPCont;
     #2#35 = "X";
     |GRABA 020#2a;
     |ERROR10;
|FPRC;

|DEFBUCLE FormCont99;
     #2#1;
     ;
     #0#0,   0, #0#2, 0;
     #0#0, 999, #0#2, 9;
     be;
     NULL, FormCont99;
|FIN;

|PROCESO nombofli99;
     nBonifFPCont = nBonifFPCont + #nombofli#3;
     swBonifFPCont = 1;
|FPRC;

|DEFBUCLE nombofli99;
     #nombofli#1;
     ;
     #0#0, #0#3, #0#2, 001, " ", "B";
     #0#0, #0#3, #0#2, 999, "F", "P";
     ;
     NULL, nombofli99;
|FIN;

|PROCESO FormContCen;
     #2#12 = #2#12 + nBonifFPCont;      || bonif./subven. 601
     #2#35 = "X";
     #2#95 = #2#95 + nBonifFPCont;
     |GRABA 020#2a;
     |ERROR10;
|FPRC;

|DEFBUCLE FormContCen;
     #2#1;
     ;
     #0#0, nDesdeCen, #0#2, nDesdeTipo;
     #0#0, nHastaCen, #0#2, nHastaTipo;
     be;
     NULL, FormContCen;
|FIN;

|PROCESO nombofliCen;
     nBonifFPCont = #nombofli#3;
     swBonifFPCont = 1;
     |SI #nombofli#4 = 99;
          nDesdeCen = 0;
          nHastaCen = 99;
          nDesdeTipo = 0;
          nHastaTipo = 9;
          |BUCLE FormContCen;
     |SINO;
          nDesdeCen = #nombofli#4;
          nHastaCen = #nombofli#4;
          |SI #nombofli#6 = "F";
               nDesdeTipo = 8;
               nHastaTipo = 8;
          |SINO;
               nDesdeTipo = 0;
               nHastaTipo = 9;
          |FINSI;
          |BUCLE FormContCen;
     |FINSI;
|FPRC;

|DEFBUCLE nombofliCen;
     #nombofli#1;
     ;
     #0#0, #0#3, #0#2, 001, " ", "B";
     #0#0, #0#3, #0#2, 999, "F", "P";
     ;
     NULL, nombofliCen;
|FIN;

|PROCESO busca_FormCont;
     |SI #labempre#127 = 0; || si hay recargo de mora no se bonifica
          |SI #labempre#45 = "N"; |O #labempre#45 = " ";
               || por centros NO, todo al 99
               |BUCLE nombofli99;
               |BUCLE FormCont99;
          |SINO;
               |BUCLE nombofliCen;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO acum_ERE;
     #2#0 = #6#0;    || codigo empresa
     #2#1 = #6#2;    || mes
     #2#2 = 0;       || tipo el 0, ni atrasos ni finiquitos ni historias
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)

     #labtraba#0 = #6#0;
     #labtraba#1 = #6#1;
     |LEE 000#labtraba.=;

     |SI #labtraba#247 = 613; |O #labtraba#247 = 163;
                                   || atencion, tengo que poner esto que si no
          |ACABA;                  || me graba tambien las bonif de los agrarios
     |FINSI;                       || en el lote

     |SI #labtraba#45 = "421";     || bonificacion ERE en formacion
          #2#2 = 8;
     |FINSI;
     |SI siono_cen = "S";
          #2#18 = #labtraba#77;
          |HAZ lee_centr;
          |SI #10#21 ! 0;
               #2#18 = #10#21;
          |FINSI;
     |FINSI;
     |SI siono_cen = "N";
          #2#18 = 99;
     |FINSI;

     |LEE 101#2=;
     estado = FSalida;

     #2#12 = #2#12 + #6#106;      || bonif./subven. 601

     |SI estado ! 0;
          |GRABA 020#2n;
     |SINO;
          |GRABA 020#2a;
     |FINSI;

     |LIBERA #2;
|FPRC;

|DEFBUCLE busca_ERE;               || busco posibles bonificaciones del 50%
     #6#1;                         || de las CC en ERE
     106;
     #0#0,     0, #0#2, 0, 0.01;
     #0#1, 99999, #0#2, 2, 9999.99;
     ;
     NULL, acum_ERE;
|FIN;

|PROCESO impre;
            desem = 78;
            cuot2 = 81;
            porc1 = 82;
            porc2 = 83;
            bacc2 = 79;
            bacp2 = 80;
            bilt1 = 84;
            bilt2 = 85;

            alfa1 = Usuario;  |QBT alfa1;    alfa1 = "4" + alfa1;
        |NOME_DAT #4 alfa1;
        |DELINDEX #4;
            alfa1 = Usuario;  |QBT alfa1;    alfa1 = "5" + alfa1;
        |NOME_DAT #7 alfa1;
        |DELINDEX #7;
        |ABRET #2;       || aux. empresas
        |ABRE #8;        || bonificaciones
        |HAZ temporal0;  || carga temporal
        |HAZ el_bucle;
        |ABRE #labtraba;
        |BUCLE busca_PFE;
        |BUCLE busca_TEX;
        |BUCLE busca_May59;
        |BUCLE busca_ERE;
        |BUCLE bonif_form;
        |BUCLE bonif_tut;
        |BUCLE busca_SisGarJuv;
        |SI  s_ori ! "A"; |Y s_ori ! "T"; |Y s_tat = 0; |Y s_ele = "L00";
             |HAZ busca_FormCont;  || bonif. formacion continua
        |FINSI;
        |CIERRA #labtraba;

        |CIERRAT #2;
        |CIERRA #8;
        |DELINDEX #4;
        |DELINDEX #7;
|FPRC;

|| ***************************************************************************
|| ****** calculos complementarios de trabajo en IMPRESION *******************
|| ***************************************************************************

|PROCESO limpieza;  || INICIALIZA ACUMULADORES
    t_bonif1 = 0;   t_bonif2 = 0;
    t_porboni1 = 0; t_porboni2 = 0;
    t_cuotboni = 0; t_reduccio = 0;
    tablaepi1 = 0;  tablaepi2 = 0;
    tablaepi3 = 0;  tablaepi4 = 0;
    tablaepi5 = 0;  porcepig1 = 0;
    porcepig2 = 0;  porcepig3 = 0;
    porcepig4 = 0;  porcepig5 = 0;
    basepigr1 = 0;  basepigr2 = 0;
    basepigr3 = 0;  basepigr4 = 0;
    basepigr5 = 0;  t_porcepi1 = 0;
    t_porcepi2 = 0; t_porcepi3 = 0;
    t_porcepi4 = 0; t_porcepi5 = 0;
    t_porcepig = 0; t_epigrafe = 0;
    t_dfp = 0;      t_porcdfp = 0;
    t_total = 0;    t_cbonif = 0;
    endo = 0;

    qbonifi = 0;
    qreducc = 0;
    qsubven = 0;
    qsub85pre = 0;
    qsub85dis = 0;
    qtotal = 0;
    bon_60 = 0;

    t_retro1 = 0;
    t_retro2 = 0;
     t_totalAB = 0;
    t_base = 0;
|FPRC;

|PROCESO auxiliar;      || ACTUALIZA FICHERO AUXILIAR DE EMPRESAS
         #2#00 = antempre;                                  || codigo empresa
         #2#01 = #0#2;                                      || mes
         #2#02 = anttipo + dtipo + ctipo;                   || tipo
     |SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)
     |SI siono_cen = "S";  #2#18 = antcentr;  |FINSI;       || centro trabajo
     |SI siono_cen = "N";  #2#18 =       99;  |FINSI;
     |LEE 101#2=;
         estado = FSalida;
     |SI #8#10 = 1; |O #8#0 = 501; |O #8#0 = 502;
         |SI s_ori = "A";|O s_ori = "T";
                 #2#11 = #2#11 + qreducc;                   || reducciones 209
                 #2#12 = #2#12 + qbonifi;                   || bonificaciones 601
         |SINO;
                 #2#11 = #2#11 + t_reduccio;                || reducciones 209
                 || #2#12 = #2#12 + t_epigrafe + t_porcdfp;    || bonificaciones 601
         |FINSI;
     |FINSI;
     |SI #8#10 = 2; |O #8#10 = 5; |O #8#10 = 6;
         |SI s_ori = "A";|O s_ori = "T";
                 #2#12 = #2#12 + qtotal;                    || bonificaciones 601
         |SINO;
            |SI #8#0 ! 501; |Y #8#0 ! 502;
                 #2#12 = #2#12 + t_total;                   || bonificaciones 601
            |FINSI;
         |FINSI;
     |FINSI;
     |SI #8#10 = 3;
          |SI #8#0 ! 102;|Y #8#0 ! 103;
               #2#21 = #2#21 + t_total;    || reducciones(matern.) 201
          |SINO;
               |SI s_ori = "A";|O s_ori = "T";
                    #2#11 = #2#11 + qtotal;      || reducciones(aprend.) 209
               |SINO;
                    #2#11 = #2#11 + t_total;     || reducciones(aprend.) 209
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #8#10 = 4;
          |SI s_ori = "A";|O s_ori = "T";
               #2#11 = #2#11 + qreducc;                   || reducciones 209
          |SINO;
               #2#11 = #2#11 + t_reduccio;                || reducciones 209
          |FINSI;
     |FINSI;

     || miguepracticas
     |SI #8#10 = 7;
          |SI s_ori = "A";|O s_ori = "T";
               #2#11 = #2#11 + qbonifi;
               #2#12 = #2#12 + qreducc;
          |SINO;
               nNume = (t_base % 23.60);
               nNume = ((nNume % #8#3) / 2) ! 2;
               || ojo, lo tenia igual pero el #2#11 estaba donde el #2#12 y
               || viceversa, y estaba asi porque juraria que antes lo tenia
               || como lo he dejado ahora y lo tuve que cambiar
               || si esto volviera a dar problemas, consultar el ultimo
               || tiquet que es el 668.1534, empresa 7016
               #2#11 = #2#11 + nNume;
               #2#12 = #2#12 + (t_total - nNume);
         |FINSI;
     |FINSI;

     |SI #8#0 = 100;|O #8#0 = 101;|O #8#0 = 104;|O #8#0 = 105;|O #8#0 = 106;
          #2#17 = 6;                  || clave maternidad
     |FINSI;

     |SI estado ! 0;
         |GRABA 020#2n;
     |SINO;
         |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
|FPRC;

|PROCESO auxiliar1;      || ACTUALIZA FICHERO AUXILIAR DE EMPRESAS
    #2#00 = antempre;    || codigo empresa
    #2#01 = #0#2;        || mes
    #2#02 = anttipo + dtipo + ctipo;  || tipo
|SI runnom = "nomwtc21";      #2#16 = #0#3;  |FINSI;   || a¤o (historico)
|SI siono_cen = "S";  #2#18 = antcentr;  |FINSI;
|SI siono_cen = "N";  #2#18 =       99;  |FINSI;
|LEE 101#2=;
    estado = FSalida;

    #2#12 = #2#12 + t_cbonif;      || bonif./subven. 601

|SI estado ! 0;
    |GRABA 020#2n;
|SINO;
    |GRABA 020#2a;
|FINSI;
|LIBERA #2;
|FPRC;

|PROCESO pie;
|SI #8#0 = 516;
     t_total = t_bonif1 + t_retro1;
     |ACABA;
|FINSI;

|SI anttipo ! 8;
     t_porboni1 = #8#4 + #8#6;            || Porcentaje contingencias
     t_porboni2 = #8#5 + #8#7;            || Porcentaje D-F-P
     t_cuotboni = (t_bonif1 % t_porboni1);              || cuota conting.
||     t_reduccio = (t_cuotboni % antporce) ! EURODB;     || bonif./reduccion
     |SI #6#92 ! 0; |O #6#95 ! 0;
          nume1 = (t_cuotboni ! 2) - (t_cuotboni % antporce) - #6#92 - #6#95;
          |SI nume1 < 0;
               |SI #6#92 ! 0;
                    #6#92 = #6#92 + nume1;
               |SINO;
                    |SI #6#95 ! 0;
                         #6#95 = #6#95 + nume1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #8#8 = "S";         || Si la bonificacion tiene accidentes
          t_porcepi1 = (basepigr1 % porcepig1) ! EURODB;
          t_porcepi2 = (basepigr2 % porcepig2) ! EURODB;
          t_porcepi3 = (basepigr3 % porcepig3) ! EURODB;
          t_porcepi4 = (basepigr4 % porcepig4) ! EURODB;
          t_porcepi5 = (basepigr5 % porcepig5) ! EURODB;
     |FINSI;
                                                      || total bases epigrafes
     || t_porcepig = t_porcepi1 + t_porcepi2 + t_porcepi3;
     || t_porcepig = t_porcepig + t_porcepi4 + t_porcepi5;
     || t_epigrafe = (t_porcepig % antporce);         || total % epigrafes
     || 17.06.2004 comento para coincidir con la nomina para redondeos
     || t_dfp      = (t_bonif2 % t_porboni2) ! EURODB;     || cuota DFP (comentado para matern)
     || 27.01.2005 atencion, lo quito y sumo arriba
     || t_dfp      = (t_bonif2 % t_porboni2);     || cuota DFP (comentado para matern)
     || t_porcdfp  = (t_dfp % antporce);              || reduccion DFP
|SINO;
     |SI #8#0 = 102;      || aprendices antes del 17.05.1997
          t_cuotboni = #11#82 * endo;           || cuota con.comunes
          t_reduccio = (t_cuotboni % antporce) ! EURODB; || reduccion con.comunes
          t_dfp      = #11#84 * endo;           || cuota DFP
          t_porcdfp  = (t_dfp % antporce) ! EURODB;      || reduccion DFP
          t_porcepig = (#11#86 + #11#87) * endo; || cuota epigrafes
          t_epigrafe = (t_porcepig % antporce);     || reduccion epigrafes
     |FINSI;
     |SI #8#0 = 103;      || aprendices despues del 17.05.1997
          t_cuotboni = #11#82 * endo;           || cuota con.comunes
          t_reduccio = (t_cuotboni % antporce) ! EURODB; || reduccion con.comunes
          t_dfp      = #11#84 * endo;           || cuota DFP
          t_porcdfp  = (t_dfp % antporce) ! EURODB;      || reduccion DFP
          t_porcepig = (#11#86 + #11#87) * endo;|| cuota epigrafes
          t_epigrafe = (t_porcepig % antporce);     || reduccion epigrafes
          #8#10 = 3;     || la situacion de la bonificacion
          t_boniftra = t_boniftra + t_reduccio + t_porcdfp + t_epigrafe;
          t_totalAB = t_totalAB + t_boniftra;
     |FINSI;
     |SI #8#0 = 104;      || maternidad para los 87
          t_cuotboni = #11#83 * endo;           || cuota con.comunes
          t_reduccio = (t_cuotboni % 100) ! EURODB;  || reduccion con.comunes
          t_dfp      = #11#85 * endo;            || cuota DFP
          t_porcdfp  = (t_dfp % antporce) ! EURODB;      || reduccion DFP
          t_porcepig = 0;                       || cuota epigrafes
          t_epigrafe = 0;                       || reduccion epigrafes
     |FINSI;
     |SI #8#0 = 105;      || maternidad para los 85
          t_cuotboni = #11#83 * endo;           || cuota con.comunes
          t_reduccio = (t_cuotboni % 100) ! EURODB;  || reduccion con.comunes
          t_dfp      = #11#85 * endo;           || cuota DFP
          t_porcdfp  = (t_dfp % 100) ! EURODB;       || reduccion DFP
          t_porcepig = 0;                       || cuota epigrafes
          t_epigrafe = 0;                       || reduccion epigrafes
     |FINSI;
     t_porboni1 = (t_cuotboni * 100) / t_bonif1;
     t_porboni2 = (t_dfp      * 100) / t_bonif2;
|FINSI;
t_total = t_totalAB;
|FPRC;

|PROCESO piecito;
     |SI #7#1 = 516;
          t_total = t_bonif1 + t_retro1;
          |ACABA;
     |FINSI;
     |SI anttipo ! 8;
          t_porboni1 = #8#4 + #8#6;            || Porcentaje contingencias
          t_porboni2 = #8#5 + #8#7;            || Porcentaje D-F-P
          t_cuotboni = (t_bonif1 % t_porboni1);              || cuota conting.

          || t_reduccio = t_reduccio + ((#7#20 % t_porboni1) % #7#14);
          t_porcdfp = t_porcdfp + ((#7#21 % t_porboni2) % #7#14);

          t_boniftra = 0;
          t_boniftra = (#7#20 % t_porboni1) % #7#14;
          t_boniftra = (t_boniftra + ((#7#21 % t_porboni2) % #7#14)) ! EURODB;

          basepigr1 = 0;
          basepigr2 = 0;
          basepigr3 = 0;
          basepigr4 = 0;
          basepigr5 = 0;

          |SI #8#8 = "S";                || Si la bonificacion tiene accidentes
                                         || ******* Tablas de epigrafes **********
               |ABRE #5;
               |ABRE #9;
               |ABRE #12;

               #5#0 = #7#0;
               #5#1 = #7#2;
               |LEE 000#5=;
               |SI FSalida = 0;
                    |SI s_anyl [ 2006;
                         epi_tra = #5#32;
                         epi_bas = #7#21 - #7#26;
                    |SINO;
                         |HAZ VerifCNAE;
                         epi_tra = nEpigConv;
                         epi_bas = #7#21 - #7#26;
                    |FINSI;
                    |HAZ calc_epig;
|| migue
                    |SI #7#26 ! 0;        || si tiene base por ILT genera epig.enfer.
                         |SI s_anyl [ 2009;
                              |SI s_anyl [ 2006;
                                   epi_tra = #11#2;
                                   epi_bas = #7#26;
                              |SINO;
                                   epi_tra = 904;
                                   epi_bas = #7#26;
                              |FINSI;
                         |SINO;
                              |HAZ VerifCNAE;
                              epi_tra = nEpigConv;
                              epi_bas = #7#26;
                         |FINSI;
                         |HAZ calc_epig;
                    |FINSI;
              |FINSI;
              |CIERRA #5;
              |CIERRA #9;
              |CIERRA #12;
          |FINSI;

          |SI #6#92 ! 0; |O #6#95 ! 0;
               nume1 = (t_cuotboni ! 2) - (t_cuotboni % antporce) - #6#92 - #6#95;
               |SI nume1 < 0;
                    |SI #6#92 ! 0;
                         #6#92 = #6#92 + nume1;
                    |SINO;
                         |SI #6#95 ! 0;
                              #6#95 = #6#95 + nume1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #8#8 = "S";         || Si la bonificacion tiene accidentes
               t_porcepi1 = (basepigr1 % porcepig1) ! EURODB;
               t_porcepi2 = (basepigr2 % porcepig2) ! EURODB;
               t_porcepi3 = (basepigr3 % porcepig3) ! EURODB;
               t_porcepi4 = (basepigr4 % porcepig4) ! EURODB;
               t_porcepi5 = (basepigr5 % porcepig5) ! EURODB;
          |FINSI;
                                                           || total bases epigrafes
          t_porcepig = 0;
          t_porcepig = t_porcepi1 + t_porcepi2 + t_porcepi3;
          t_porcepig = t_porcepig + t_porcepi4 + t_porcepi5;
          t_epigrafe = t_epigrafe + ((t_porcepig % antporce) ! EURODB);
          t_boniftra = t_boniftra + ((t_porcepig % antporce) ! EURODB);
          || t_totalAB = t_totalAB + t_boniftra;

          t_totalAB = t_totalAB + #7#32 + #7#33;
          t_reduccio = t_reduccio + #7#32 + #7#33;
          |SI #8#10 = 7;
               t_base = t_base + #7#20; || lo voy a usar para las tipo "7"
          |FINSI;

          || 17.06.2004 comento para coincidir con la nomina para redondeos
          || t_dfp      = (t_bonif2 % t_porboni2) ! EURODB;     || cuota DFP (comentado para matern)
          || 27.01.2005 atencion, lo quito y sumo arriba
          || t_dfp      = (t_bonif2 % t_porboni2);     || cuota DFP (comentado para matern)
          || t_porcdfp  = (t_dfp % antporce);              || reduccion DFP
     |SINO;
          |SI #8#0 = 102;      || aprendices antes del 17.05.1997
               t_cuotboni = #11#82 * endo;           || cuota con.comunes
               || t_reduccio = (t_cuotboni % antporce) ! EURODB; || reduccion con.comunes
               t_dfp      = #11#84 * endo;           || cuota DFP
               t_porcdfp  = (t_dfp % antporce) ! EURODB;      || reduccion DFP
               t_porcepig = (#11#86 + #11#87) * endo; || cuota epigrafes
               t_epigrafe = (t_porcepig % antporce);     || reduccion epigrafes
          |FINSI;
          |SI #8#0 = 103;      || aprendices despues del 17.05.1997
               endo = 1;
               t_cuotboni = #11#82 * endo;           || cuota con.comunes
               t_reduccio = (t_cuotboni % antporce); || reduccion con.comunes
               t_dfp      = #11#84 * endo;           || cuota DFP
               t_porcdfp  = (t_dfp % antporce);      || reduccion DFP
               t_porcepig = (#11#86 + #11#87) * endo;|| cuota epigrafes
               t_epigrafe = (t_porcepig % antporce);     || reduccion epigrafes
               #8#10 = 3;     || la situacion de la bonificacion
               t_boniftra = t_boniftra + ((t_reduccio + t_porcdfp + t_epigrafe) ! EURODB);
               t_totalAB = t_totalAB + t_boniftra;
           endo = 0;
          |FINSI;
          |SI #8#0 = 104;      || maternidad para los 87
               t_cuotboni = #11#83 * endo;           || cuota con.comunes
               || t_reduccio = (t_cuotboni % 100) ! EURODB;  || reduccion con.comunes
               t_dfp      = #11#85 * endo;            || cuota DFP
               t_porcdfp  = (t_dfp % antporce) ! EURODB;      || reduccion DFP
               t_porcepig = 0;                       || cuota epigrafes
               t_epigrafe = 0;                       || reduccion epigrafes
          |FINSI;
          |SI #8#0 = 105;      || maternidad para los 85
               t_cuotboni = #11#83 * endo;           || cuota con.comunes
               || t_reduccio = (t_cuotboni % 100) ! EURODB;  || reduccion con.comunes
               t_dfp      = #11#85 * endo;           || cuota DFP
               t_porcdfp  = (t_dfp % 100) ! EURODB;       || reduccion DFP
               t_porcepig = 0;                       || cuota epigrafes
               t_epigrafe = 0;                       || reduccion epigrafes
          |FINSI;
          t_porboni1 = (t_cuotboni * 100) / t_bonif1;
          t_porboni2 = (t_dfp      * 100) / t_bonif2;
          |SI #8#0 = 525;
               t_totalAB = t_totalAB + #7#32 + #7#33;
               t_reduccio = t_reduccio + #7#32 + #7#33;
          |FINSI;
     |FINSI;
     || t_reduccio = t_reduccio + t_retro1;
     || t_porcdfp = t_porcdfp + t_retro2;
     || t_total = (((t_reduccio + t_porcdfp) ! EURODB) + t_epigrafe) ! EURODB; || total reducc.
     || t_total = ((t_reduccio + t_porcdfp) ! EURODB) + (t_epigrafe ! EURODB); || total reducc.
     || 27.01.2005 cambio para dejarlo igual que en nomina
|FPRC;
____________________________________/ CALCULO PRINCIPAL Y LECTURA CALCULOS
|PROCESO temporal1;
|HAZ temporal;
|FPRC;

|PROCESO meslite1;
|HAZ meslite;
|FPRC;

|DEFBUCLE gra_tempo;
 #6#1;
 ;
 #0#0,     0, #0#2, 0;
 #0#1, 99999, #0#2, 2;
 ;
 meslite1, temporal1;
|FIN;

|DEFBUCLE ini_auxiliar;
 #2#1;
 50;
 #0#0, 000, #0#2,  0, "G";
 #0#0, 999, #0#2, 19, "G";
 be;
 NULL, ini_auxil;
|FIN;

|PROCESO temporal0;
|BUCLE ini_auxiliar;
|BUCLE gra_tempo;
|FPRC;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
    nume2 = 0;
    nume1 = #0#3 $ 4;
|SI nume1 = 0;|Y #36#9 = "S";
        nume2 = 1;
|FINSI;

    topemes = 31;
|SI #0#2 = 2;
        topemes = 28 + nume2;
|FINSI;
|SI #0#2 = 4;|O #0#2 = 6;|O #0#2 = 9;|O #0#2 = 11;
        topemes = 30;
|FINSI;
|FPRC;

|PROCESO control;
|DDEFECTO #36;
|ABRE #36;
|LEE 000#36p;
|SI FSalida ! 0;
    |MENAV "    No existe control, usando defectos ...";
|FINSI;
|CIERRA #36;
|FPRC;

|PROGRAMA;
    |HAZ LeeEURODB;

    #0#0 = s_emp;
    #0#1 = s_emp;
    #0#2 = s_mes;
    #0#3 = s_any;
    runnom = s_nom;
    anyonum = #0#3;
    siono_cen = s_cen;
    any_hist = #0#3 $ 100;

   |NOME_DAT #9 aTempEpig;
|NOME_DAT #2 temp4;      || aux.empresas
|NOME_DAT #6 temp3;      || calculos cabs.

|HAZ control;
|HAZ ulti_dia;
|HAZ impre;
|FPRO;



____________________________________/ TRATAMIENTO BONIFICACIONES DOBLES
                                      EN ATRASOS
|PROCESO acumula;
    qbonifi = qbonifi + (bonifi + bon_60);
    qreducc = qreducc + reducc;
    qsubven = qsubven + subven;
    qsub85pre = qsub85pre + sub85pre;
    qsub85dis = qsub85dis + sub85dis;

    qtotal = qtotal + (bonifi + reducc + subven + sub85pre + sub85dis + bon_60);
|FPRC;

|PROCESO BoniExpediente_T;
     |DDEFECTO #labempre;
     |ABRE #labempre;
     #labempre#0 = #7#0;
     |LEE 000#labempre.=;
     |CIERRA #labempre;

     |DDEFECTO #labtraba;
     |ABRE #labtraba;
     #labtraba#0 = #7#0;
     #labtraba#1 = #7#2;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |SI s_anyl [ 2006;
          nEpigConv = #labtraba#32;
     |SINO;
          |HAZ VerifCNAE;
     |FINSI;
     |DDEFECTO #nomepigr;
     |ABRE #nomepigr;
     #nomepigr#0 = nEpigConv;
     |LEE 000#nomepigr.=;
     epig_ilt = #nomepigr#1;
     epig_ims = #nomepigr#2;
     |CIERRA #nomepigr;

     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = #labtraba#32;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0; |Y s_anyl [ 2006;
          epig_ilt = #nomepitr#3;
          epig_ims = #nomepitr#4;
     |FINSI;
     |CIERRA #nomepitr;
/*
     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;

     |DDEFECTO #nomcones;
     |ABRE #nomcones;
     #nomcones#0 = #labempre#32;
     |LEE 000#nomcones.=;
     |CIERRA #nomcones;
*/

     nCConst = #labtraba#248;
     |HAZ constante;

     por1_cont = #nomconst#7;
     por1_dfpg = #nomconst#13 + #nomconst#15 + #nomconst#17 + #nomconst#19;
     |SI #19#9 = 64;    por1_cont = por1_cont * #nomcones#21;   |FINSI;
     |SI #19#9 = 65;    por1_cont = por1_cont * #nomcones#22;   |FINSI;
     por1_cont = por1_cont ! 2;

     bon_0 = #19#119 * #labtraba#242;        || base CC
     bon_3 = #19#119 * #labtraba#242;        || base CP
     bon_5 = 0;

     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;

     base_A = ((bon_0 % #nombonif#4) ! EURODB) % nPorBon;
     base_A = base_A ! EURODB;
     base_B = ((bon_3 % #nombonif#5) ! EURODB) % nPorBon;
     base_B = base_B ! EURODB;
     |SI #nombonif#8 = "S";
          zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
          zbase_9 = zbase_9 ! EURODB;
          zbase_9 = zbase_9 + (bon_5 % (#nomconst#3 + #nomconst#4));
          zbase_9 = zbase_9 ! EURODB;
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;
     |FINSI;
     base_F = base_A + base_B + base_C;

     nCuota = base_F;
|FPRC;

|PROCESO boni_T_meses_1;
    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    bon_60= 0;

|SI dtipo = 0;
        nCuota = #19#63;
        nSubve = #19#64;
    |SI nEsDoble = 1;
            nCuota = #19#123;
            nSubve = 0;
    |FINSI;

    |SI #7#1 ! 516;      || no puede entrar aqui con la 516 hombre
                         || si no acumula dos veces
         |SI nCuota ! 0;|O nSubve ! 0;
             |SI #8#10 = 1;  reducc = nCuota;    |FINSI;
             |SI #8#10 = 2;  bonifi = nCuota;    |FINSI;
             |SI #8#10 = 5;  bonifi = nCuota;    |FINSI;
             |SI #8#10 = 6;  bonifi = nCuota;    |FINSI;
             |SI #8#10 = 3;  reducc = nCuota;    |FINSI;
             |SI #8#10 = 4;  reducc = nCuota;    |FINSI;
             |SI #8#10 = 7;
                        bonifi = (nCuota / 2) ! 2;
                        reducc = nCuota - bonifi;
             |FINSI;
             |SI #19#9 = 85;|O #19#9 = 97;  || formacion teorica
                 |SI #8#12 > 400;           || precio hora
                         sub85pre = nSubve;
                 |SINO;
                         sub85dis = nSubve;
                 |FINSI;
             |SINO;
                     subven = nSubve;
             |FINSI;
         |FINSI;
     |FINSI;
|SINO;
        nPorBon = #19#124;
    |SI nEsDoble = 1;
            nPorBon = #19#125;
    |FINSI;

    |SI nPorBon ! 0;
            nCuota = 0;
        |HAZ BoniExpediente_T;     || recalcula bonificacion s/expediente
        |SI #8#10 = 1;  reducc = nCuota;     |FINSI;
        |SI #8#10 = 2;  bonifi = nCuota;     |FINSI;
        |SI #8#10 = 3;  reducc = nCuota;     |FINSI;
        |SI #8#10 = 4;  reducc = nCuota;     |FINSI;
        |SI #8#10 = 5;  bonifi = nCuota;     |FINSI;
        |SI #8#10 = 6;  bonifi = nCuota;     |FINSI;
    |FINSI;
|FINSI;
        |SI #19#130 ! 0; |Y #7#1 = 516;            || bonif. mayores 60 a¤os, RDL 16/2001
             bon_60 = #19#130;
             reducc = 0;      || si es la bonif. del 50% de RDL 16/2001
             bonifi = 0;      || no debe acumular posibles cuotas de otras
        |FINSI;               || bonificaciones
|HAZ acumula;
|FPRC;

|DEFBUCLE boni_T_meses;
 #19#1;
 ;
 #7#0, #7#2, any_hist, s_mes, s_tat;
 #7#0, #7#2, any_hist, s_has, s_tat;
 ;
 NULL, boni_T_meses_1;
|FIN;

|PROCESO BoniExpediente_A;
     |DDEFECTO #labempre;
     |ABRE #labempre;
     #labempre#0 = #7#0;
     |LEE 000#labempre.=;
     |CIERRA #labempre;

     |DDEFECTO #labtraba;
     |ABRE #labtraba;
     #labtraba#0 = #7#0;
     #labtraba#1 = #7#2;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |DDEFECTO #nomepigr;
     |ABRE #nomepigr;
     #nomepigr#0 = #labtraba#32;
     |LEE 000#nomepigr.=;
     epig_ilt = #nomepigr#1;
     epig_ims = #nomepigr#2;
     |CIERRA #nomepigr;

     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = #labtraba#32;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0;
          epig_ilt = #nomepitr#3;
          epig_ims = #nomepitr#4;
     |FINSI;
     |CIERRA #nomepitr;
/*
     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;

     |DDEFECTO #nomcones;
     |ABRE #nomcones;
     #nomcones#0 = #labempre#32;
     |LEE 000#nomcones.=;
     |CIERRA #nomcones;
*/
     nCConst = #labtraba#248;
     |HAZ constante;

     por1_cont = #nomconst#7;
     por1_dfpg = #nomconst#13 + #nomconst#15 + #nomconst#17 + #nomconst#19;
     |SI #21#9 = 64;    por1_cont = por1_cont * #nomcones#21;   |FINSI;
     |SI #21#9 = 65;    por1_cont = por1_cont * #nomcones#22;   |FINSI;
     por1_cont = por1_cont ! 2;

     bon_0 = #21#78 * #labtraba#242;         || base CC
     bon_3 = #21#78 * #labtraba#242;         || base CP
     bon_5 = 0;

     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;

     base_A = ((bon_0 % #nombonif#4) ! EURODB) % nPorBon;
     base_A = base_A ! EURODB;
     base_B = ((bon_3 % #nombonif#5) ! EURODB) % nPorBon;
     base_B = base_B ! EURODB;
     |SI #nombonif#8 = "S";
          zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
          zbase_9 = zbase_9 ! EURODB;
          zbase_9 = zbase_9 + (bon_5 % (#nomconst#3 + #nomconst#4));
          zbase_9 = zbase_9 ! EURODB;
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;
     |FINSI;
     base_F = base_A + base_B + base_C;

     nCuota = base_F;
|FPRC;

|PROCESO boni_A_meses_1;
    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    bon_60 = 0;

|SI dtipo = 0;
        nCuota = #21#63;
        nSubve = #21#64;
    |SI nEsDoble = 1;
            nCuota = #21#81;
            nSubve = 0;
    |FINSI;

    |SI #7#1 ! 516;      || no puede entrar aqui con la 516 hombre
                         || si no acumula dos veces
         |SI nCuota ! 0;|O nSubve ! 0;
             |SI #8#10 = 1;  reducc = nCuota;    |FINSI;
             |SI #8#10 = 2;  bonifi = nCuota;    |FINSI;
             |SI #8#10 = 3;  reducc = nCuota;    |FINSI;
             |SI #8#10 = 4;  reducc = nCuota;    |FINSI;
             |SI #8#10 = 5;  bonifi = nCuota;    |FINSI;
             |SI #8#10 = 6;  bonifi = nCuota;    |FINSI;
             |SI #21#9 = 85;|O #21#9 = 97;  || formacion teorica
                 |SI #8#12 > 400;           || precio hora
                         sub85pre = nSubve;
                 |SINO;
                         sub85dis = nSubve;
                 |FINSI;
             |SINO;
                     subven = nSubve;
             |FINSI;
         |FINSI;
     |FINSI;
        |SI #21#88 ! 0; |Y #7#1 = 516;            || bonif. mayores 60 a¤os, RDL 16/2001
             bon_60 = #21#88;
             reducc = 0;      || si es la bonif. del 50% de RDL 16/2001
             bonifi = 0;      || no debe acumular posibles cuotas de otras
        |FINSI;               || bonificaciones
|SINO;
        nPorBon = #21#82;
    |SI nEsDoble = 1;
            nPorBon = #21#83;
    |FINSI;

    |SI nPorBon ! 0;
            nCuota = 0;
        |HAZ BoniExpediente_A;     || recalcula bonificacion s/expediente
        |SI #8#10 = 1;  reducc = nCuota;     |FINSI;
        |SI #8#10 = 2;  bonifi = nCuota;     |FINSI;
        |SI #8#10 = 3;  reducc = nCuota;     |FINSI;
        |SI #8#10 = 5;  bonifi = nCuota;     |FINSI;
        |SI #8#10 = 6;  bonifi = nCuota;     |FINSI;
    |FINSI;
|FINSI;
|HAZ acumula;
|FPRC;

|DEFBUCLE boni_A_meses;
 #21#1;
 ;
 #7#0, #7#2, s_mes, 5;
 #7#0, #7#2, s_has, 5;
 ;
 NULL, boni_A_meses_1;
|FIN;

|PROCESO AtrasosDobles;
|SI s_ori = "A";    |BUCLE boni_A_meses;     |FINSI;
|SI s_ori = "T";    |BUCLE boni_T_meses;     |FINSI;
|FPRC;
