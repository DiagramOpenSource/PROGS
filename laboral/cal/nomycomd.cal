|FICHEROS;
     nomycomd #0;
     labempre #1;
     labtraba #2;
     nomir003 #3;
     labcentr #4;
|FIN;

|VARIABLES;
    aAlfa1 = "";
    aAlfa2 = "";
    aAlfa3 = "";
    aAlfa4 = "";
    nNume1 = 0;
    nNume2 = 0;
    nNume3 = 0;
    nNume4 = 0;
    nPara1 = 0;
    nPara2 = 0;
    nPara3 = 0;
    nPara4 = 0;
    fFech1 = @;
    fFech2 = @;
    fFech3 = @;
    fFech4 = @;
    nElsw1 = 0;
    nElsw2 = 0;
    nElsw3 = 0;
    nElsw4 = 0;
    nFEstado = 0;
    nSeleccio = 0;
    nModo = 0;
    nSwRup = 0;

    nValido = 0;
    &aEjemplar = "";
    aFecha = "";
    &p_mes = "";
    &aDia = "";
    &aAnyo = "";

    aAlfa    = "";
    aLong    = "";

    nInd     = 0;
    nLong    = 0;
    nCalc    = 0;
    nHayComa = 0;
    nPos     = 0;
    SwSalir  = 0;
    &aDatosSN = "";

    &enDEmpresa = 0;
    &enHEmpresa = 0;
    &enDelEjerc = 0;
    &enDTrabaja = 0;
    &enHTrabaja = 0;

     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &aCadena = "";
|FIN;
____________________________________/
|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO Fecha;
     aFecha = #0#13;
     aAlfa1 = aFecha % 102;
     aAlfa2 = aFecha % 402;
     nNume2 = aAlfa2;
     aAlfa3 = aFecha % 704;
     |SI nNume2 =  1;  p_mes = "ENERO     ";  |FINSI;
     |SI nNume2 =  2;  p_mes = "FEBRERO   ";  |FINSI;
     |SI nNume2 =  3;  p_mes = "MARZO     ";  |FINSI;
     |SI nNume2 =  4;  p_mes = "ABRIL     ";  |FINSI;
     |SI nNume2 =  5;  p_mes = "MAYO      ";  |FINSI;
     |SI nNume2 =  6;  p_mes = "JUNIO     ";  |FINSI;
     |SI nNume2 =  7;  p_mes = "JULIO     ";  |FINSI;
     |SI nNume2 =  8;  p_mes = "AGOSTO    ";  |FINSI;
     |SI nNume2 =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
     |SI nNume2 = 10;  p_mes = "OCTUBRE   ";  |FINSI;
     |SI nNume2 = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
     |SI nNume2 = 12;  p_mes = "DICIEMBRE ";  |FINSI;
     aDia  = aAlfa1;
     aAnyo = aAlfa3;
|FPRC;
____________________________________/
|PROCESO Imprime;
     |DDEFECTO #1;
     #1#0 = #2#0;
     #1#1 = #2#1;
     |LEE 000#1=;

     |DDEFECTO #labcentr;
     #labcentr#0 = #2#0;
     #labcentr#1 = #2#77;
     |LEE 000#labcentr.=;

     |DDEFECTO #3;
     #3#0 = #2#7;
     #3#40 = #0#11;
     #3#41 = #2#0;
     |LEE 000#3=;

     |SI #0#12 = "N";
          |DDEFECTO #3;
          #3#3 = "";
     |FINSI;

     aCadena = #labtraba#2;
     |QBF aCadena;
     aAlfa = aCadena - ",";
     |SI aAlfa ! aCadena;
          || hay coma
          |HAZ SeparaNom_plb;
     |SINO;
          || si no hay coma, no separo
          |HAZ SeparaNom_plb;
          eaNom = #labtraba#2;
          eaApel1 = "";
          eaApel2 = "";
     |FINSI;

     aDatosSN = #0#12;
     |HAZ Fecha;
     |SI #0#10 = "S";
          |PARA nPara1 = 1; |SI nPara1 [ 3; |HACIENDO nPara1 = nPara1 + 1;
               |SI nPara1 = 1;  aEjemplar = "Ejemplar para el perceptor"; |FINSI;
               |SI nPara1 = 2;  aEjemplar = "Ejemplar para la empresa o entidad pagadora"; |FINSI;
               |SI nPara1 = 3;  aEjemplar = "Ejemplar para la asesor¡a"; |FINSI;
               ||INFOR "nomycomd";
               |INFOR "nomycom1";
               |PRINT;
               |PIEINF;
          |SIGUE;
     |SINO;
          aEjemplar = "";
          ||INFOR "nomycomd";
          |INFOR "nomycom1";
          |PRINT;
          |PIEINF;
     |FINSI;
|FPRC;

|PROCESO labtraba1;
    nValido = 0;

|PARA nPara1 = 4; |SI nPara1 [ 8; |HACIENDO nPara1 = nPara1 + 1;
    |SI #0nPara1 ! " ";
        |SI #2#99 = #0nPara1;|O #2#100 = #0nPara1;|O #2#101 = #0nPara1;
                nValido = 1;
            |SAL;
        |FINSI;
    |FINSI;
|SIGUE;

|SI nValido = 1;
    |SI #2#44 = "A";|Y #0#9 ! "A";|Y #0#9 ! "T";
            nValido = 0;
    |FINSI;
    |SI #2#44 = "B";|Y #0#9 ! "B";|Y #0#9 ! "T";
            nValido = 0;
    |FINSI;
|FINSI;

|SI nValido = 1;
        nSeleccio = 1;
    |HAZ Imprime;
|FINSI;
|FPRC;

|DEFBUCLE labtraba;
 #2#1;
 ;
 #0#0, #0#2;
 #0#1, #0#3;
 ;
 NULL, labtraba1;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |ABRE #1;
          |ABRE #3;
          |ABRE #labcentr;

          |BUCLE labtraba;

          |FININF;
          |FINIMP;

          |CIERRA #labcentr;
          |CIERRA #3;
          |CIERRA #1;
          |SI nSeleccio = 0;
               |MENAV "    Seleccion vacia ...";
          |SINO;
               enDEmpresa = #0#0;
               enHEmpresa = #0#1;
               enDTrabaja = #0#2;
               enHTrabaja = #0#3;
               enDelEjerc = #0#11;
               |SUB_EJECUTA "nomcompe;M145";
          |FINSI;
     |SINO;
          |MENAV "    Error en la Impresora";
     |FINSI;
|FPRC;
