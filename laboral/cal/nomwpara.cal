|FICHEROS;
    nomwpara #00;
    nomhicca #04;
    nomhicli #05;
    nomparca #30;
    nomparli #31;
    nomxpara #32;
    nomauxi1 #33;
    nomauxi2 #34;
|FIN;

|VARIABLES;
    runnom = "nomwpara";
    punt_campo = 0;
    punt_tempr = 0;
    punt_tcent = 0;
    punt_tarea = 0;
    punt_tsecc = 0;
    punt_subra = 0;
    punt_titul = 0;
    punt_refer = 0;
    punt_signo = 0;
    calcu = "";
    laeme = "";
    refer = "";
    recogido = 0;
    multiplica = 0;
    memoria = 0;
    ant_empre = -1;
    ant_centr = -1;
    ant_area  = "";
    ant_secc  = "";
    ant_traba = -1;
    &sw_nombre = 0;
    &linea = 0;
    sw_ruptura = 0;
    rupturas = "";
    &dmes = 0;
    &hmes = 0;
    &peri = 0;
     &swPDFMasivo = 0;
     &aProcedencia = "";

     swExcel = 0;
     &enColumnas = 0;
     &enInforme = 0;
|FIN;

|INCLUYE i_sreci;

|PROCESO Tipo88_nomwpara; |TIPO 88;
     |HAZ LeeEURODB;
|FPRC;

|PROCESO PRINT_Linea;
     |SI swExcel = 0;
          |PRINT;
     |SINO;
          |HAZ Linea_Excel;
     |FINSI;
|FPRC;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|DEFBUCLE lee_calculos1;      || 'SNN'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#77, #2#1;
|FIN;

|DEFBUCLE lee_calculos2;      || 'SSN'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#77, #2#62, #2#1;
|FIN;

|DEFBUCLE lee_calculos3;      || 'SSS'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#77, #2#62, #2#63, #2#1;
|FIN;

|DEFBUCLE lee_calculos4;      || 'NSS'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#62, #2#63, #2#1;
|FIN;

|DEFBUCLE lee_calculos5;      || 'NNS'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#63, #2#1;
|FIN;

|DEFBUCLE lee_calculos6;      || 'NNN'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#1;
|FIN;

|DEFBUCLE lee_calculos7;      || 'NSN'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#62, #2#1;
|FIN;

|DEFBUCLE lee_calculos8;      || 'SNS'
 #4#1;
 ;
 #0#0, #0#2, #0#4, #0#5, #0#10;
 #0#1, #0#3, #0#4, #0#6, #0#10;
 e;
 NULL, ordena, NULL, NULL, NULL, proceso;
 #2#0, #2#77, #2#63, #2#1;
|FIN;

|PROCESO lee_totales;
|DDEFECTO #30;
|ABRE #30;
    #30#0 = #0#7;
|LEE 020#30=;
|CIERRA #30;
    rupturas = #30#3 + #30#4 + #30#5;
|FPRC;


|PROCESO comple_6;    || carga e imprime
     |SI #0#8 = 2;
          #2#00 = guarda_emp;
          #2#77 = guarda_cen;   || el defbucle al leer otro calculo lee
          #2#62 = guarda_are;   ||/automaticamente otro trabajador,
          #2#63 = guarda_sec;   ||/por eso se guarda las claves
     |FINSI;
     |HAZ parametriza;
     |SI sw_ruptura = 0;
          |HAZ Cabecera_Emp;

          ant_empre = #2#0;
          ant_centr = #2#77;
          ant_area  = #2#62;
          ant_secc  = #2#63;
          sw_ruptura = 1;
     |FINSI;
     |SI ant_empre ! #2#0;              || ruptura por empresa
          |HAZ linea_4;
          |HAZ linea_3;
          |HAZ linea_2;
          |HAZ linea_1;

          |HAZ Cabecera_Emp;
     |SINO;
          |SI ant_centr ! #2#77;|Y #30#3 = "S";         || ruptura por centro
               |HAZ linea_4;
               |HAZ linea_3;
               |HAZ linea_2;
          |SINO;
               |SI ant_area ! #2#62;|Y #30#4 = "S";      || ruptura por area
                    |HAZ linea_4;
                    |HAZ linea_3;
               |SINO;
                    |SI ant_secc ! #2#63;|Y #30#5 = "S";  || ruptura por seccion
                         |HAZ linea_4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     linea = 0;
     |SI #0#11 = "D";    |HAZ PRINT_Linea;   |FINSI;
     |HAZ totales;
     |DDEFECTO #10;
     el_a00 = 0;
     el_a31 = 0;
     el_a32 = 0;
     el_a33 = 0;
     el_a34 = 0;
     el_a35 = 0;
     el_a37 = 0;
|FPRC;

|PROCESO lee_campos;
     enColumnas = enColumnas + 1;

    punt_campo = punt_campo + 1;
    punt_subra = punt_subra + 1;
    punt_titul = punt_titul + 1;
|PARA punt_refer=3; |SI punt_refer[14; |HACIENDO punt_refer=punt_refer+1;
                                                 punt_signo=punt_refer+12;
        calcu = #31punt_refer;
        laeme = calcu % 101;
        refer = calcu % -102;

    |SI calcu ! " 00";
        |SI #31punt_signo = "+"; multiplica=1; |SINO; multiplica=-1; |FINSI;

        |SI laeme = "M";
                memoria = refer;  memoria = memoria + 5;
                #32punt_campo = #32punt_campo + (#32memoria * multiplica);
        |SINO;
            |HAZ recoge;
                #32punt_campo = #32punt_campo + (recogido * multiplica);
        |FINSI;
    |FINSI;
|SIGUE;
    #32punt_subra = "=============";
    #32punt_titul = #31#2;
|FPRC;

|PROCESO parametriza;
    punt_campo = 5;
    punt_subra = 125;
    punt_titul = 155;
|HAZ limpia;
     #32#0 = #10#1;       || codigo empresa
     #32#1 = #10#3;       || nombre empresa
     #32#2 = #10#2;       || codigo trabajador
     #32#3 = #10#6;       || nombre trabajador
     #32#217 = #10#12;    || dni
     #32#218 = #10#13;    || nafss
     #32#219 = #10#7;     || categoria
     #32#220 = #10#10;    || antiguedad
|SI #0#8 = 1;
    |HAZ mes;
        #32#4 = mesnum;  || mes
|SINO;
        #32#4 = "--";    || englobado
|FINSI;
    #32#5 = #2#47;       || horas
|ABRE #30;
    #30#0 = #0#7;
|LEE 021#30=;
|SI FSalida = 0;
        #32#216 = #30#2;      || titulo informe
        enColumnas = 0;
    |BUCLELIN 2lee_campos#30;
|FINSI;
|CIERRA #30;
|FPRC;

|PROCESO recoge;
    recogido = 0;
|SI calcu = " 01";  recogido = #10#023;  |ACABA;  |FINSI;
|SI calcu = " 02";  recogido = #10#024;  |ACABA;  |FINSI;
|SI calcu = " 03";  recogido = #10#025;  |ACABA;  |FINSI;
|SI calcu = " 04";  recogido = #10#026;  |ACABA;  |FINSI;
|SI calcu = " 05";  recogido = #10#027;  |ACABA;  |FINSI;
|SI calcu = " 06";  recogido = #10#028;  |ACABA;  |FINSI;
|SI calcu = " 07";  recogido = #10#029;  |ACABA;  |FINSI;
|SI calcu = " 08";  recogido = #10#030;  |ACABA;  |FINSI;
|SI calcu = " 09";  recogido = #10#031;  |ACABA;  |FINSI;
|SI calcu = " 10";  recogido = #10#032;  |ACABA;  |FINSI;
|SI calcu = " 11";  recogido = #10#033;  |ACABA;  |FINSI;
|SI calcu = " 12";  recogido = #10#034;  |ACABA;  |FINSI;
|SI calcu = " 13";  recogido = #10#035;  |ACABA;  |FINSI;
|SI calcu = " 14";  recogido = #10#036;  |ACABA;  |FINSI;
|SI calcu = " 15";  recogido = #10#037;  |ACABA;  |FINSI;
|SI calcu = " 16";  recogido = #10#038;  |ACABA;  |FINSI;
|SI calcu = " 17";  recogido = #10#039;  |ACABA;  |FINSI;
|SI calcu = " 18";  recogido = #10#040;  |ACABA;  |FINSI;
|SI calcu = " 19";  recogido = #10#041;  |ACABA;  |FINSI;
|SI calcu = " 20";  recogido = #10#042;  |ACABA;  |FINSI;
|SI calcu = " 21";  recogido = #10#043;  |ACABA;  |FINSI;
|SI calcu = " 22";  recogido = #10#044;  |ACABA;  |FINSI;
|SI calcu = " 23";  recogido = #10#045;  |ACABA;  |FINSI;
|SI calcu = " 24";  recogido = #10#046;  |ACABA;  |FINSI;
|SI calcu = " 25";  recogido = #10#047;  |ACABA;  |FINSI;
|SI calcu = " 26";  recogido = #10#048;  |ACABA;  |FINSI;
|SI calcu = " 27";  recogido = #10#049;  |ACABA;  |FINSI;
|SI calcu = " 28";  recogido = #10#050;  |ACABA;  |FINSI;
|SI calcu = " 29";  recogido = #10#051;  |ACABA;  |FINSI;
|SI calcu = " 30";  recogido = #10#052;  |ACABA;  |FINSI;
|SI calcu = " 31";  recogido = #10#053;  |ACABA;  |FINSI;
|SI calcu = " 32";  recogido = #10#054;  |ACABA;  |FINSI;
|SI calcu = " 33";  recogido = #10#055;  |ACABA;  |FINSI;
|SI calcu = " 34";  recogido = #10#056;  |ACABA;  |FINSI;
|SI calcu = " 35";  recogido = #10#057;  |ACABA;  |FINSI;
|SI calcu = " 36";  recogido = #10#058;  |ACABA;  |FINSI;
|SI calcu = " 37";  recogido = #10#059;  |ACABA;  |FINSI;
|SI calcu = " 38";  recogido = #10#060;  |ACABA;  |FINSI;
|SI calcu = " 39";  recogido = #10#061;  |ACABA;  |FINSI;
|SI calcu = "A00";  recogido = el_a00;   |ACABA;  |FINSI;
|SI calcu = "A01";  recogido = #10#101;  |ACABA;  |FINSI;
|SI calcu = "A02";  recogido = #10#102;  |ACABA;  |FINSI;
|SI calcu = "A03";  recogido = #10#103;  |ACABA;  |FINSI;
|SI calcu = "A04";  recogido = #10#104;  |ACABA;  |FINSI;
|SI calcu = "A05";  recogido = #10#119;  |ACABA;  |FINSI;
|SI calcu = "A06";  recogido = #10#120;  |ACABA;  |FINSI;
|SI calcu = "A07";  recogido = #10#121;  |ACABA;  |FINSI;
|SI calcu = "A08";  recogido = #10#122;  |ACABA;  |FINSI;
|SI calcu = "A09";  recogido = #10#123;  |ACABA;  |FINSI;
|SI calcu = "A10";  recogido = #10#127;  |ACABA;  |FINSI;
|SI calcu = "A11";  recogido = #10#131;  |ACABA;  |FINSI;
|SI calcu = "A12";  recogido = #10#124;  |ACABA;  |FINSI;
|SI calcu = "A13";  recogido = #10#128;  |ACABA;  |FINSI;
|SI calcu = "A14";  recogido = #10#132;  |ACABA;  |FINSI;
|SI calcu = "A15";  recogido = #10#125;  |ACABA;  |FINSI;
|SI calcu = "A16";  recogido = #10#129;  |ACABA;  |FINSI;
|SI calcu = "A17";  recogido = #10#133;  |ACABA;  |FINSI;
|SI calcu = "A18";  recogido = #10#126;  |ACABA;  |FINSI;
|SI calcu = "A19";  recogido = #10#130;  |ACABA;  |FINSI;
|SI calcu = "A20";  recogido = #10#134;  |ACABA;  |FINSI;
|SI calcu = "A21";  recogido = #10#135;  |ACABA;  |FINSI;
|SI calcu = "A22";  recogido = #10#153;  |ACABA;  |FINSI;
|SI calcu = "A23";  recogido = #10#154;  |ACABA;  |FINSI;
|SI calcu = "A24";  recogido = #10#155;  |ACABA;  |FINSI;
|SI calcu = "A25";  recogido = #10#138;  |ACABA;  |FINSI;
|SI calcu = "A26";  recogido = #10#139;  |ACABA;  |FINSI;
|SI calcu = "A27";  recogido = #10#140;  |ACABA;  |FINSI;
|SI calcu = "A28";  recogido = #10#141;  |ACABA;  |FINSI;
|SI calcu = "A29";  recogido = #10#142;  |ACABA;  |FINSI;
|SI calcu = "A30";  recogido = #10#118;  |ACABA;  |FINSI;
|SI calcu = "A31";  recogido = el_a31;   |ACABA;  |FINSI;
|SI calcu = "A32";  recogido = el_a32;   |ACABA;  |FINSI;
|SI calcu = "A33";  recogido = el_a33;   |ACABA;  |FINSI;
|SI calcu = "A34";  recogido = el_a34;   |ACABA;  |FINSI;
|SI calcu = "A35";  recogido = el_a35;   |ACABA;  |FINSI;
|SI calcu = "A37";  recogido = el_a37;   |ACABA;  |FINSI;
|FPRC;

|PROCESO mes;
|SI #10#15 = "ENERO     ";  mesnum =  1;  |FINSI;
|SI #10#15 = "FEBRERO   ";  mesnum =  2;  |FINSI;
|SI #10#15 = "MARZO     ";  mesnum =  3;  |FINSI;
|SI #10#15 = "ABRIL     ";  mesnum =  4;  |FINSI;
|SI #10#15 = "MAYO      ";  mesnum =  5;  |FINSI;
|SI #10#15 = "JUNIO     ";  mesnum =  6;  |FINSI;
|SI #10#15 = "JULIO     ";  mesnum =  7;  |FINSI;
|SI #10#15 = "AGOSTO    ";  mesnum =  8;  |FINSI;
|SI #10#15 = "SEPTIEMBRE";  mesnum =  9;  |FINSI;
|SI #10#15 = "OCTUBRE   ";  mesnum = 10;  |FINSI;
|SI #10#15 = "NOVIEMBRE ";  mesnum = 11;  |FINSI;
|SI #10#15 = "DICIEMBRE ";  mesnum = 12;  |FINSI;
|FPRC;

|PROCESO totales;
|PARA nume1 = 6; |SI nume1 [ 35; |HACIENDO nume1 = nume1 + 1;
        punt_tempr = nume1 + 30;
        punt_tcent = nume1 + 60;
        punt_tarea = nume1 + 90;
        punt_tsecc = nume1 + 180;
        #32punt_tempr = #32punt_tempr + #32nume1;
        #32punt_tcent = #32punt_tcent + #32nume1;
        #32punt_tarea = #32punt_tarea + #32nume1;
        #32punt_tsecc = #32punt_tsecc + #32nume1;
|SIGUE;
|FPRC;

|PROCESO linea_1;        || ruptura por empresa
     linea = 1;
     |HAZ PRINT_Linea;
     |SI swExcel = 0;
          |PIEINF;
     |FINSI;
     ant_empre = #2#0;
     |PARA nume1 = 36; |SI nume1 [ 65; |HACIENDO nume1 = nume1 + 1;
          #32nume1 = 0;
     |SIGUE;
|FPRC;

|PROCESO linea_2;        || ruptura por centro
|SI #30#3 = "S";
    |HAZ lee_ant_centr;
        linea = 2;
    |HAZ PRINT_Linea;
        ant_centr = #2#77;
    |PARA nume1 = 66; |SI nume1 [ 95; |HACIENDO nume1 = nume1 + 1;
            #32nume1 = 0;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO linea_3;        || ruptura por area
|SI #30#4 = "S";
    |ABRE #33;
        #33#0 = ant_area;
    |LEE 001#33=;
    |SI FSalida ! 0;  |DDEFECTO #33;   |FINSI;
        alfa1 = #33#1;
    |QBF alfa1;
        alfa1 = alfa1 + ".................................";
        alfa1 = alfa1 % 133;
        #33#1 = alfa1;
    |CIERRA #33;
        linea = 3;
    |HAZ PRINT_Linea;
        ant_area  = #2#62;
    |PARA nume1 = 96; |SI nume1 [ 125; |HACIENDO nume1 = nume1 + 1;
            #32nume1 = 0;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO linea_4;        || ruptura por seccion
|SI #30#5 = "S";
    |ABRE #34;
        #34#0 = ant_area;
        #34#1 = ant_secc;
    |LEE 001#34=;
    |SI FSalida ! 0;  |DDEFECTO #34;   |FINSI;
        alfa1 = #34#2;
    |QBF alfa1;
        alfa1 = alfa1 + ".................................";
        alfa1 = alfa1 % 133;
        #34#2 = alfa1;
    |CIERRA #34;
        linea = 4;
    |HAZ PRINT_Linea;
        ant_secc  = #2#63;
    |PARA nume1 = 186; |SI nume1 [ 215; |HACIENDO nume1 = nume1 + 1;
            #32nume1 = 0;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO limpia;         || no se puede hacer un DDEFECTO por los totales
    #32#00 = 0;
    #32#01 = "";
    #32#02 = 0;
    #32#03 = "";
    #32#04 = "";
    #32#05 = 0;
    #32#06 = 0;
    #32#07 = 0;
    #32#08 = 0;
    #32#09 = 0;
    #32#10 = 0;
    #32#11 = 0;
    #32#12 = 0;
    #32#13 = 0;
    #32#14 = 0;
    #32#15 = 0;
    #32#16 = 0;
    #32#17 = 0;
    #32#18 = 0;
    #32#19 = 0;
    #32#20 = 0;
    #32#21 = 0;
    #32#21 = 0;
    #32#22 = 0;
    #32#23 = 0;
    #32#24 = 0;
    #32#25 = 0;
    #32#26 = 0;
    #32#27 = 0;
    #32#28 = 0;
    #32#29 = 0;
    #32#30 = 0;
    #32#31 = 0;
    #32#32 = 0;
    #32#33 = 0;
    #32#34 = 0;
    #32#35 = 0;
|FPRC;

|PROCESO lee_ant_centr;
    #6#0 = ant_empre;
    #6#1 = ant_centr;
|LEE 001#6=;
|SI FSalida ! 0;
    |DDEFECTO #6;
|FINSI;
|FPRC;

/****************************************************************************/
/*    PROCESOS QUE NO VALEN DE NADA, POR COMPATIBILIDAD CON EL i_sreci      */
/****************************************************************************/

|PROCESO PreparaPDF;
|FPRC;

/****************************************************************************/
/*                         PROCESO PRINCIPAL                                */
/****************************************************************************/

|PROCESO impre;
     |SI #0#9 = 00;
          swExcel = 0;
     |SINO;
          swExcel = 1;
     |FINSI;
     enInforme = #0#7;
     dmes = #0#5;     hmes = #0#6;   peri = #0#4;

     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #6;
     |ABRE #100;
     |SI swExcel = 0;
          |IMPRE 0;
     |SINO;
          |HAZ Excel_Inicio;
          FSalida = 0;
     |FINSI;
     |SI FSalida = 0;
          seleccio = 0;
          |SI swExcel = 0;
               |INFOR "nomypara";
          |FINSI;
          |HAZ lee_totales;
          |SI rupturas = "SNN";  |BUCLE lee_calculos1;  |FINSI;
          |SI rupturas = "SSN";  |BUCLE lee_calculos2;  |FINSI;
          |SI rupturas = "SSS";  |BUCLE lee_calculos3;  |FINSI;
          |SI rupturas = "NSS";  |BUCLE lee_calculos4;  |FINSI;
          |SI rupturas = "NNS";  |BUCLE lee_calculos5;  |FINSI;
          |SI rupturas = "NNN";  |BUCLE lee_calculos6;  |FINSI;
          |SI rupturas = "NSN";  |BUCLE lee_calculos7;  |FINSI;
          |SI rupturas = "SNS";  |BUCLE lee_calculos8;  |FINSI;
          |SI seleccio = 0;
               |MENAV "    Seleccion vacia ...";
          |SINO;
               |SI #0#8 = 2;
                    |SI lineas = 1;
                         |HAZ comple_6;
                    |FINSI;
               |FINSI;
               |HAZ linea_4;
               |HAZ linea_3;
               |HAZ linea_2;
               |HAZ linea_1;
          |FINSI;
          |SI swExcel = 0;
               |FININF;
          |FINSI;
     |SINO;
         |MENAV "    Proceso ABORTADO !!!";
     |FINSI;
     |SI swExcel = 0;
          |FINIMP;
     |SINO;
          |HAZ Excel_Fin;
     |FINSI;
     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #6;
     |CIERRA #100;
|FPRC;

|PROGRAMA;
|CLS;
|PINPA #0#0;
|CABEZA "Informes Parametrizados";
|ABRE #0;
|DDEFECTO #0;
|LEE 101#0p;
|SI FSalida ! 0;
    |GRABA 020#0b;
|FINSI;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0;
    |GRABA 020#0a;
    |HAZ impre;
|FINSI;
|LIBERA #0;
|CIERRA #0;
|FPRO;
