|FICHEROS;
     silcon09 #0;
     tsilcon0 #3;
     nomtrtc2 #11;
     nombonif #13;
     nomcalca #18;
     nomcalli #59;
     nomhicca #19;
     nomhicli #60;
     nomcalac #21;
     nomcalal #61;
     nombotra;
     labtraba #12;
     tsilcon1 #20;
     nombonif;
     silcon04 #4;
     silcon03 #5;
     silcon02 #2;
     nomconst #22;
     nomequiv;
     nomir003;
     labempre;
     siltmpco;
     labcentr;
     nomredco;
     nomcontr;
     tsilcon4 #14;
     tsilcon5 #15,MANTE;
     tsilcon6 #23,MANTE;
     tsilco13,MANTE;
     nompluba;
     nompluri;
     nomconca;
     silcon06;
|FIN;

|VARIABLES;
     &prom_mat = 0;

     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     alfa5 = "";
     alfa6 = "";

     &nume1 = 0;
     &nume2 = 0;
     &nume3 = 0;
     &nume4 = 0;

     fech2 = @;
     fech3 = @;
     fech4 = @;
     fech5 = @;
     fech6 = @;

     &topemes = 0;

     &nDias = 0;
     &nProp55 = 0;
     &nProp60 = 0;
     &nDiasProp55 = 0;
     &nDiasProp60 = 0;
     &bon_55 = 0;
     &bon_60 = 0;

     &nVez = 0;
     &nGuardaPropAlta = 0;
     &nGuardaPropBaja = 0;
     &nGuardaPropMat = 0;
     &swParcheBonMat = 0;
     &nDias_nat_alta = 0;

     aFechaIniBon = "";
     aFechaFinBon = "";
     nMesesBon = 0;
     nDiasBon = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aAlfa6 = "";
     nNume = 0;
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     fFecha = @;
     fFechaAlta = @;
     fFechaRef = @;
     nFecha = 0;
     &nDiasIT = 0;
     &nDiasProp55_A = 0;
     &nDiasProp55_IT = 0;
     &nDiasProp60_A = 0;
     &nDiasProp60_IT = 0;
     &nProp55_A = 0;
     &nProp55_IT = 0;
     &nProp60_A = 0;
     &nProp60_IT = 0;
     &nVeces = 0;

     ajuste1 = "";
     ajuste2 = "";
     ajuste3 = "";
     alfa = "";
     error = 0;
     ind = 0;
     long = 0;
     posi = 0;
     digito = "";
     texto = "";
     mascara = "";
     i = 0;
     j = 0;
     &nCampo = 0;
     &nTipo = 0;

     &swbon_20 = 0;
     &swbon_25 = 0;
     &swbon_31 = 0;
     &swbon_34 = 0;
     &linea = 0;
     &nlinea = 0;
     &clave = "";
     &sw_auxil = 0;
     &cadena = "";
     &for_hora = "";
     &for_fecha = "";
     &fech1 = @;
     &eldat = 0;
     &aEpiTc2 = "";

     &nBase = 0;
     &bonifi = 0;
     &reducc = 0;
     &swBonEpig = 0;
     &base_C = 0;
     &bonifi_Alta = 0;
     &bonjuv_Alta = 0;
     &bonifi25_Alta = 0;
     &bonifi25_Baja = 0;
     &nPropAlta = 0;
     &nPropBaja = 0;
     &nPropMat = 0;
     &base_Ca = 0;
     &bonifi_Baja = 0;
     &bonjuv_Baja = 0;
     &aSigno = "";
     &aParam = "";
     &tot_ba_06 = 0;
     &tot_cd_06 = 0;
     &tot_cd_20 = 0;
     &tot_cd_25 = 0;
     &tot_cd_28 = 0;
     &tot_cd_31 = 0;
     &tot_cd_32 = 0;
     &tot_cd_33 = 0;
     &tot_cd_34 = 0;
     &sw5560sim = 0; || bonificaciones textil > 55 y para > 60 a la vez
     &sw5960sim = 0; || bonificaciones > 59 y para > 60 a la vez
     &swredbonsim = 0; || bonificaciones > 45 a¤os y > 59 a¤os a la vez
     &swCumple = 0;
     &primer_mes = "";
     &ultimo_mes = "";
     &dat_mes = "";
     nume5 = 0;
     nume6 = 0;
     nume7 = 0;
     nume8 = 0;
     &aContrato = "";

     &nEuros = 0;
     &nPesetas = 0;
     &nCambioeuro = 166.386;
     &EURODB = 0;
     swSigue = 0;
     fFecha1 = @;
     fFecha2 = @;
     &swProduccion = 0;
     nBaseCC1 = 0;
     nBaseCC2 = 0;
     nBaseCC3 = 0;
     nBaseCC4 = 0;
     &nEpigConv = 0;
     &tot_ba_09 = 0;
     &tot_hor_com = 0;
     &tot_ba_11 = 0;
     &nBonif = 0;
     &s_ori = "";
     &nTope = 0;
     &fCFecha = @;            || primer dia de mes de calculo
     &nCConst = 0;
     &aCError = "";           || inicializo errores
     &swMaterTP = 0;
     &swExiste = 0;
     aNif = "";
     &nElMes = 0;
     &swAjusteD = 0;
     &d_alta = 0;
     &bisiesto = 0;
     &nDiasMate = 0;
     para1 = 0;
     &swRepite = 0;
     elsw1 = 0;
     &descom = "";
     &entero = "";
     &decima = "";
     nDiasVacac = 0;
     &nDiasExtra = 0;
     &nBaseExtra = 0;

     &s_tat = 0;
     &s_ele = "";
     &s_any = 0;
     &s_mes = 0;
     &s_has = 0;
     &s_anyl = 0;
     &s_sel = "";
     &s_lotecra = 0;
     &s_fichcra = "";
     &enLote = 0;
     &eaFich = "";
     &eaExt = "";
     nBaseTotal = 0;
     nProporcion = 0;
     nComunesOri = 0;
     nATEPOri = 0;
     &dias_enteros = 0;
     &nBaseCC = 0;
     nProp = 0;
     &swFiniqRaro2 = 0;
     &swSegundoLote = 0;
     &nMes = 0;
     &nAny = 0;
     &nTopemes = 0;
     aFich = "";
     nCoefTP = 0;
     nHorasSem = 0;
     &swAjuste3 = 0;
     &bonifi_25 = 0;
     &nPosicion = 0;
     &nHorasComp = 0;
     aFuenteHoras = 0;
|FIN;

|PROCESO euro;
     |SI EURODB = 0;          ||  Estamos en pesetas, pasa todo a euros
          nEuros = 0;
          nEuros = nPesetas / nCambioeuro;
          nEuros = (nEuros ! 2) * 100;
          nPesetas = 0;
     |FINSI;
     |SI EURODB = 2;          || Estamos en Euros, simplemente pasa a centimos
          nEuros = 0;
          nEuros = nPesetas * 100;
          nPesetas = 0;
     |FINSI;
|FPRC;

|PROCESO BuscaDisca;
     |ABRE #nomir003;
     #nomir003#0 = #labtraba#7;         || nif
     #nomir003#40 = #0#0;               || ejercicio
     #nomir003#41 = #labtraba#0;        || empresa
     |LEE 000#nomir003.=;
     |SI FSalida = 0;
          |SI #nomir003#6 = "S";
               #3#25  = "D";                   || Indicadores de discapacidad
          |FINSI;
     |FINSI;
     |CIERRA #nomir003;
|FPRC;

____________________________________/ TRANSFORMACION CONTRATOS
|PROCESO CodigosNuevos;
     |QBF aContrato;
     aContrato = ("000" + aContrato) % -103;
     |ABRE #nomequiv;
     #nomequiv#0 = aContrato;
     |LEE 000#nomequiv.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
               aContrato = #nomequiv#2;      || tiempo parcial
          |SINO;
               aContrato = #nomequiv#1;      || tiempo completo
          |FINSI;
     |FINSI;
     |CIERRA #nomequiv;
|FPRC;

|PROCESO GuardaMeses;
     nume5 = primer_mes;
     nume6 = ultimo_mes;
     nume8 = dat_mes
     |SI nume8 < nume5; |O nume5 = 0;
          primer_mes = nume8;
     |FINSI;
     |SI nume8 > nume6; |O nume6 = 0;
          ultimo_mes = nume8;
     |FINSI;
|FPRC;

|PROCESO prom_mat_men;
     |ABRE #59;
     #59#0 = #18#0;          || empresa
     #59#1 = #18#1;          || trabajador
     #59#2 = #18#2;          || mes
     #59#3 = 0;              || tipo (= 0)
     #59#4 = 927;            || concepto (el 125)
     |LEE 000#59=;
     |SI FSalida = 0;
          prom_mat = #59#10;
     |FINSI;
     |CIERRA #59;
|FPRC;

|PROCESO prom_mat_his;
     |ABRE #60;
     #60#0 = #19#0;           || empresa
     #60#1 = #19#1;          || trabajador
     #60#12 = #19#66;           || a¤o
     #60#2 = #19#2;           || mes
     #60#3 = 0;               || tipo (= 0)
     #60#4 = 927;             || concepto (el 125)
     |LEE 000#60=;
     |SI FSalida = 0;
          prom_mat = #60#10 > 0;
     |FINSI;
     |CIERRA #60;
|FPRC;

|PROCESO prom_mat_atr;
     |ABRE #61;
     #61#0 = #21#0;          || empresa
     #61#1 = #21#1;         || trabajador
     #61#2 = #21#2;          || mes
     #61#3 = 5;              || tipo (= 5, atrasos)
     #61#4 = 927;            || concepto (el 125)
     |LEE 000#61=;
     |SI FSalida = 0;
          prom_mat = #61#10;
     |FINSI;
     |CIERRA #61;
|FPRC;

|PROCESO Los59;     || comprueba si este mes cumple 59 a¤os
     fech1 = #labtraba#11;        || ahora compruebo que tengo 2 bonif.
     aAlfa = fech1;
     aAlfa1 = aAlfa % 402;
     aAlfa2 = aAlfa % -104;
     nume1 = aAlfa1;     || mes
     nume2 = aAlfa2;     || a¤o
     nume3 = #0#0 - nume2;
     |SI #0#1 = nume1; |Y nume3 = 59;
          swCumple = 59;
     |FINSI;
|FPRC;

|PROCESO prop5560;
     || uso este proceso para proporcionar la parte que se va al dat de una
     || bonificacion y al dat de la otra, aunque uso las mismas variables
     nProp55 = 0;
     nProp60 = 0;
     nDiasProp55 = 0;
     nDiasProp60 = 0;
     nDiasProp55_A = 0;
     nDiasProp55_IT = 0;
     nDiasProp60_A = 0;
     nDiasProp60_IT = 0;
     nProp55_A = 0;
     nProp55_IT = 0;
     nProp60_A = 0;
     nProp60_IT = 0;
     |SI swredbonsim = 1; |O sw5960sim = 1;
          || nProp55 = reducc / (reducc + bonifi);
          || nProp60 = 1 - nProp55;

          aAlfa = #labtraba#11;
          aAlfa1 = aAlfa % 102;
          nume1 = aAlfa1;
          nDiasProp55 = nume1 - 1;
          nDiasProp60 = #11#20 - nDiasProp55;

          nProp55 = nDiasProp55 / (nDiasProp55 + nDiasProp60);
          nProp60 = 1 - nProp55;
     |FINSI;
     |SI sw5560sim = 1;
          nProp55 = bon_55 / (bon_55 + bon_60);
          nProp60 = 1 - nProp55;
          nDiasProp55 = (nProp55 * #11#20) ! 0;
          nDiasProp60 = (nProp60 * #11#20) ! 0;
     |FINSI;

     nDiasIT = #11#43 + #11#44;         || no cuento maternidad

     |SI nDiasProp55 > nDiasIT;
          nDiasProp55_A = nDiasProp55 - nDiasIT;
          nDiasProp55_IT = nDiasIT;
          nDiasProp60_A = nDiasProp60;
          nDiasProp60_IT = 0;
     |SINO;
          nDiasProp55_A = 0;
          nDiasProp55_IT = nDiasProp55;
          nDiasProp60_A = nDiasProp60 + nDiasProp55 - nDiasIT;
          nDiasProp60_IT = nDiasProp60 - nDiasProp60_A;
     |FINSI;

     nProp55_A = nDiasProp55_A / nDiasProp55;
     nProp55_IT = 1 - nProp55_A;
     nProp60_A = nDiasProp60_A / nDiasProp60;
     nProp60_IT = 1 - nProp60_A;
|FPRC;

|PROCESO ParcheBonifMat_1;
     swParcheBonMat = 0;
     nGuardaPropAlta = 0;
     nGuardaPropBaja = 0;
     nGuardaPropMat = 0;
     |ABRE #nombotra;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
      || migue
     #nombotra#2 = 111;       || es la 111
     |LEE 000#nombotra.=;
     |SI FSalida = 0;
          |SI #labtraba#39 ! 0; |Y #labtraba#41 ! "          "; |Y #labtraba#41 ! "..........";
               fech1 = #labtraba#41;        || ahora compruebo que tengo 2 bonif.
               nume1 = fech1;              || y la otra es una que acaba justo
               nume1 = nume1 + 1;          || cuando la maternidad termina
               fech1 = nume1;              || en ese caso solo la tengo que pintar
               |SI #nombotra#4 = fech1;     || en el periodo de alta
                    aAlfa = fech1;
                    aAlfa1 = aAlfa % 402;
                    aAlfa2 = aAlfa % -104;
                    nume1 = aAlfa1;
                    nume2 = aAlfa2;
                    |SI #0#0 = nume2; |Y #0#1 = nume1;
                         swParcheBonMat = 1;
                         nGuardaPropAlta = nPropAlta;
                         nGuardaPropBaja = nPropBaja;
                         nGuardaPropMat = nPropMat;
                         nPropAlta = 0;
                         nPropBaja = 1;
                         nPropMat = 0;
                         swBonEpig = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #nombotra;
|FPRC;

|PROCESO ParcheBonifMat_2;
     |SI swParcheBonMat = 1;
          nPropAlta = nGuardaPropAlta;
          nGuardaPropAlta = 0;
          nPropBaja = nGuardaPropBaja;
          nGuardaPropBaja = 0;
          nPropMat = nGuardaPropMat;
          nGuardaPropMat = 0;
          swParcheBonMat = 0;
     |FINSI;
|FPRC;

|PROCESO Dias_nat_alta;
     nDias_nat_alta = 0;

     alfa1 = "01";
     alfa2 = #0#1; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech1 = alfa4;      || PRIMER DIA DEL MES

     alfa1 = topemes; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
     alfa2 = #0#1; alfa2 = "00" + alfa2; alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fech2 = alfa4;      || ULTIMO DIA DEL MES

     alfa1 = #20#4;
     fech3 = alfa1;      || DIA ALTA TRABAJADOR

     alfa1 = #20#5
     fech4 = alfa1;      || DIA BAJA TRABAJADOR

     |SI fech3 ] fech1;
          fech5 = fech3;
     |SINO;
          fech5 = fech1;
     |FINSI;

     |SI fech4 [ fech2;
          fech6 = fech4;
     |SINO;
          fech6 = fech2;
     |FINSI;

     nume1 = fech5;
     nume2 = fech6;

     nDias_nat_alta = nume2 - nume1 + 1;
|FPRC;

|PROCESO fechas_bonif;
     aFechaIniBon = "        ";
     aFechaFinBon = "";
     nMesesBon = 0;
     nDiasBon = 0;

     |SI eldat = 1;
          nDiasBon = (#11#20 ! 0) - (#11#43 + #11#44 + #11#49); || dias alta
     |SINO;
          nDiasBon = (#11#43 + #11#44 + #11#49);   || dias baja
     |FINSI;

     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";

     aAlfa = #labtraba#40;         || fecha inicio bonificacion
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          aFechaIniBon = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          aAlfa1 = aAlfa % 402;    || mes inicio bonif.
          aAlfa2 = aAlfa % -104;   || a¤o inicio bonif.
          aAlfa3 = aAlfa % 102;    || dia inicio bonif.
     |FINSI;

     nNume1 = aAlfa1;
     nNume2 = aAlfa2;
     nNume3 = aAlfa3;
     |SI #0#1 = nNume1; |Y #0#0 = nNume2; |Y #labtraba#36 ! #labtraba#40;
          || la bonificacion comienza este mes;
          |SI eldat = 1;
               nDiasBon = nDiasBon - nNume3 + 1;
               |SI nDiasBon < 0;   || lo dejo como estaba
                    nDiasBon = nDiasBon + nNume3 - 1;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";

     aAlfa = #labtraba#41;         || fecha fin bonificacion
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          aFechaFinBon = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          aAlfa1 = aAlfa % 402;    || mes fin bonif.
          aAlfa2 = aAlfa % -104;   || a¤o fin bonif.
          aAlfa3 = aAlfa % 102;    || dia fin bonif.
     |FINSI;

     nNume1 = aAlfa1;
     nNume2 = aAlfa2;
     nNume3 = aAlfa3;
     |SI #0#1 = nNume1; |Y #0#0 = nNume2;
          || la bonificacion termina este mes;
          |SI eldat = 1;
               nDiasBon = nNume3 - (#11#43 + #11#44 + #11#49);   || dias baja
          |FINSI;
     |FINSI;

     |SI nNume2 [ #0#0;       || para que si la bonificacion ya ha
                              || acabado segun las fechas de la ficha del
                              || trabajador no me la pinte
          |SI nNume2 < #0#0;
               aFechaIniBon = "        ";
               aFechaFinBon = "        ";
          |FINSI;
          |SI nNume2 = #0#0;
               |SI nNume1 < #0#1;
                    aFechaIniBon = "        ";
                    aFechaFinBon = "        ";
               |FINSI;
          |FINSI;
     |FINSI;

     |SI aFechaIniBon ! "        "; |Y aFechaFinBon = "";
          |ABRE #nombonif;
          #nombonif#0 = #labtraba#39;
          |LEE 000#nombonif.=;
          |CIERRA #nombonif;

          |PARA nCampo = 14; |SI nCampo [ 19; |HACIENDO nCampo = nCampo + 1;
               |SI #nombonif#nCampo# ! 999;
                    nMesesBon = nMesesBon + #nombonif#nCampo#;
               |SINO;
                    aFechaFinBon = "        ";
               |FINSI;
          |SIGUE;

          |SI aFechaFinBon ! "        ";
               fFecha = #labtraba#40;
               nMesesBon = (nMesesBon/1000);
               fFecha = fFecha + nMesesBon;
               nFecha = fFecha;
               nFecha = nFecha - 1;
               fFecha = nFecha;

               aAlfa = fFecha;
               aFechaFinBon = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          |FINSI;
     |FINSI;

     |SI aFechaFinBon = "";
          aFechaFinBon = "        ";
     |FINSI;

     aAlfa1 = #3#1; |QBF aAlfa1;
     |SI aAlfa1 ! "10"; |Y aAlfa1 ! "11"; |Y sw5560sim ! 0; |Y sw5960sim ! 0;
     |Y swredbonsim ! 0;
          #3#2 = nDiasBon;
     |FINSI;
     #3#7 = aFechaIniBon;
     #3#8 = aFechaFinBon;
|FPRC;

|PROCESO bon_cd25;
     |SI #13#10 = 2;
          aAlfa1 = #13#13;
          |QBF aAlfa1;
          aAlfa1 = ("000" + aAlfa1) % -103;
          |SI aAlfa1 = "025";
               swbon_25 = 1;
               |SI #13#4 ! 0;
                    reducc = #20#43 % #13#4;
                    bonifi = bonifi - reducc;
               |FINSI;
          |FINSI;
          |SI #13#0 = 525;
               swbon_25 = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ini_linea;
     |DDEFECTO #5;
     linea = linea + 2;        || linea del fichero
     |SI linea > 99999;
          |MENAV "0000Numero de lineas excedido. Lote demasiado extenso.";
          |MENAV "0000Debera repetir el lote seleccionando menos empresas.";
     |FINSI;
     nlinea = nlinea + 1;      || numero de registros

     #5#0 = #2#0;
     #5#1 = linea;
     #5#2 = "F";
     #5#3 = clave;
     |GRABA 020#5b;

     sw_auxil = 0;
     #4#0 = #5#2;
     #4#1 = #5#3;
     |LEE 000#4=;
     |SI FSalida ! 0;
          alfa1 = "    Descripcion [" + #4#0 + "-" + #4#1 + "] sin definir ...";
          |MENAV alfa1;
          sw_auxil = 1;
     |FINSI;
|FPRC;

|PROCESO fin_linea;
     #5#4 = cadena;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO fin_linea2;
     linea = linea - 2;
     nlinea = nlinea - 1;
     |BORRA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO fecha;
     for_fecha = fech1;
     aAlfa = for_fecha % -104;
     nNume = aAlfa;
     nNume = nNume $ 4;
     |SI nNume ! 0;      || no es bisiesto
          aAlfa = for_fecha % 105;
          |SI aAlfa = "29.02";
               for_fecha = "28.02" + (for_fecha % -105);
          |FINSI;
     |FINSI;
     for_fecha = (for_fecha % -104) + (for_fecha % 402) + (for_fecha % 102);
|FPRC;

|PROCESO fechaTC2;
     for_fecha = fech1;
     for_fecha = (for_fecha % 102) + (for_fecha % 402) + (for_fecha % -102);
|FPRC;

|PROCESO hora;
     |HORA for_hora;
     for_hora = (for_hora % 102) + (for_hora % 402);
|FPRC;

|PROCESO lee_bonif;
     |DDEFECTO #13;
     |ABRE #13;
     || #13#0 = #12#39;
     || cogemos el del mantenimiento de calculos, mucho mejor
     #13#0 = #20#12;
     |SI s_ori = "A"; |O s_ori = "T";   || en atrasos no estoy guardando bonif
          #13#0 = #12#39;
     |FINSI;
     |LEE 000#13=;
     |CIERRA #13;
     |SI #labtraba#248 = 516; |O #labtraba#248 = 518; |O #labtraba#248 = 520;
          |SI #labtraba#45 = "421";
               #13#0 = 525;
               #13#10 = 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CD_2006_Epi;
     |SI eldat = 1;
          |SI #0#18 [ 2006;
               aEpiTc2 = #11#26;
          |SINO;
               |SI #11#26 > 900;
                    aEpiTc2 = #labtraba#204;
               |SINO;
                    aEpiTc2 = "";
               |FINSI;
          |FINSI;
     |SINO;
          |SI #0#18 [ 2009;
               |SI #0#18 [ 2006;
                    aEpiTc2 = #22#2;
               |SINO;
                    aEpiTc2 = 904;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

____________________________________/ FORMATEO DE DATOS
|PROCESO errores;
    alfa1 = "    " + i + "." + clave;
|SI error = 1;
        alfa1 = alfa1 + ": VALOR DE CAMPO NUMERICO INCORRECTO";
|FINSI;
|SI error = 2;
        alfa1 = alfa1 + ": CAMPO OBLIGADO SIN RELLENO";
|FINSI;
     alfa1 = alfa1 + " EN LINEA " + linea;
|MENAV alfa1;
|FPRC;

|PROCESO comp1;               || COMPRUEBA SI ES NUMERICO.
     |SI ajuste1 = "1";
          error = 0;
          |PARA ind = 1; |SI ind [ long; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito ! " ";|Y digito ! ".";|Y digito ! "-";
                    |SI digito < "0"; |O digito > "9";
                         error = 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp2;               || COMPRUEBA SI TIENE QUE ESTAR RELLENO.
     |SI ajuste3 = "3";
          error = 0;
          FSalida = 0;
          |QBF alfa;
          |PARA ind = 1; |SI FSalida = 0; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito = "";
                    error = 2;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp3;               || AJUSTA I, o D. Y RELLENA DE 0 o BLANCOS.
     |SI ajuste3 = "1";       || RELLENA BLANCOS.
          mascara = "                                                                    ";
     |FINSI;
     |SI ajuste3 = "2";       || RELLENA CEROS.
          mascara = "00000000000000000000000000000000000000000000000000000000000000000000";
     |FINSI;
     |SI ajuste2 = "1";       || AJUSTA DERECHA.
          posi = 100 + long;
          posi = posi * -1;
          |QBF texto;
          texto = mascara + texto;
          texto = texto % posi;
     |FINSI;
     |SI ajuste2 = "2";
          posi = 100 + long;
          |QBF texto;
          texto = texto + mascara;
          texto = texto % posi;
     |FINSI;
|FPRC;

|PROCESO monta;
     texto = "";
     cadena = "";
     |PARA i = 0; |SI i < 30; |HACIENDO i = i + 1;
          nCampo = i;
          texto = #3nCampo;
          nTipo = i * 6 + 2;                 || MODIFICABLE.
          alfa  = #4nTipo;
          nTipo = i * 6 + 2;                 || VISUAL.
          alfa1 = #4nTipo;
          |SI alfa = "S"; |O alfa1 = "S";
               nTipo = i * 6 + 6;            || Longitud.
               long  = #4nTipo;
               nTipo = i * 6 + 7;            || AJUSTE.
               alfa  = #4nTipo;
               ajuste1 = alfa % 101;
               ajuste2 = alfa % 201;
               ajuste3 = alfa % 301;
               |HAZ comp1;
               |SI error = 1; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp2;
               |SI error = 2; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp3;
               cadena = cadena + texto;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO descompone;
     entero = "";
     decima = "";
     elsw1 = 0;
     alfa1 = descom % 0;   long = alfa1;
     |PARA para1 = 1; |SI para1 [ long; |HACIENDO para1 = para1 + 1;
          nume1 = (para1 * 100) + 1;
          alfa1 = descom % nume1;
          |SI alfa1 = ".";
               elsw1 = 1;
          |SINO;
               |SI elsw1 = 0;   entero = entero + alfa1; |FINSI;
               |SI elsw1 = 1;   decima = decima + alfa1; |FINSI;
          |FINSI;
     |SIGUE;

     |SI entero = "";    entero = "0";  |FINSI;
     |SI decima = "";    decima = "0";  |FINSI;
|FPRC;

|PROCESO edt_CA_13;                || otros conceptos
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#169 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "13";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = #14#168;           || base
          #3#4  = "";                || indicador de factor o tipo
          descom = 0;
          |HAZ descompone;
          #3#5  = entero;            || parte entera de tipo
          #3#6  = decima;            || parte decimal de factor o tipo
          #3#7  = #14#169;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CA_53;      || Cuota proteccion por cese de actividad regimen
     clave = "EDT";      || del mar
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#166 ! 0;
          nNume = #14#166 + #14#88;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "53";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";           || base
          #3#4  = "";               || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = nNume;             || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CA_51;      || Cuota proteccion por cese de actividad regimen
     clave = "EDT";      || del mar
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#166 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "51";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = #14#164;           || base
          #3#4  = "T";               || indicador de factor o tipo
          descom = #14#165;
          |HAZ descompone;
          #3#5  = entero;                || parte entera de tipo
          #3#6  = decima;                || parte decimal de factor o tipo
          #3#7  = #14#166;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_06;
     |SI #labtraba#247 ! 112; |Y #labtraba#247 ! 121;
          || solo ARTISTAS Y REPRESENTANTES DE COMERCIO
          |ACABA;
     |FINSI;

     |ABRE #20;
     #20#0 = #11#0;
     #20#1 = #11#39;
     #20#2 = #0#1;
     #20#3 = #11#48;
     |LEE 000#20=;                 || lee calculos cabs.
     |CIERRA #20;

     nPesetas = #20#46;  |HAZ euro;     #20#46 = nEuros;

     clave = "EDL";
     |HAZ ini_linea;
     swSigue = 0;

     nBaseCC1 = #11#25 - #11#37;    || base en alta
     nBaseCC2 = #11#37 - #11#61;    || base en IT
     nBaseCC3 = #11#61;             || base en maternidad
     nBaseCC4 = #11#67;             || base en ERE

     |SI sw_auxil = 0; |Y #20#46 ! 0;
          |SI eldat = 1;
               |SI nBaseCC1 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI eldat = 2; |Y nBaseCC1 [ 0;
               |SI nBaseCC2 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI eldat = 3; |Y nBaseCC1 [ 0; |Y nBaseCC2 [ 0;
               |SI nBaseCC3 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI eldat = 4; |Y nBaseCC1 [ 0; |Y nBaseCC2 [ 0; |Y nBaseCC3 [ 0;
               |SI nBaseCC4 > 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "06";              || clave bases percepciones reg.ARTISTAS
          #3#2  = "000";             || elemento
          #3#3  = #20#46;            || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha concesion horas)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_06 = tot_ba_06 + #20#46;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

/****************************************************************************/

/*

ESTA ES LA BONIFICACION PARA MAYORES DE 65 A¤OS QUE YA NO SE USA DESDE HACE
MUCHO TIEMPO PORQUE LA QUITARON, LO DEJO AQUI TODO COMENTADO

|PROCESO fecha_bon_16;
     alfa1 = #12#11 % -104;        || anyo nacimiento
     alfa2 = #12#11 % -602;        || mes nacimiento
     alfa5 = #12#11 % 102;         || dia nacimiento
     alfa3 = #12#34 % -104;        || anyo antiguedad
     alfa4 = #12#34 % -602;        || mes antiguedad
     alfa6 = #12#34 % 102;         || dia antiguedad
     nume1 = alfa1;
     nume1 = alfa1 + nEdadParaBon;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + 5;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad

     |SI nume1 > nume3;            || cuando cumple 55 o 60 a¤os
          |SI nume1 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 a¤os
               |SI nume1 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 a¤os
                    |SI nume1 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume6 < nume5;            || cuando cumple antiguedad
                    |SI nume3 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
     |FINSI;

     dias_bon_16 = 0;
     fecha_fin_16 = "";
     |SI bon_55 > 0;
          alfa7 = (#12#11 % -104);
          nume7 = alfa7;
          nume7 = nume7 + 60;
          alfa7 = nume7;
          fecha_fin_16 = alfa5 + "." + alfa2 + "." + alfa7;
     |FINSI;
     |SI swbon_65 ! 0;
          alfa7 = #labtraba#40;
          |QBF alfa7;
          |SI alfa7 ! ""; |Y alfa7 ! "..........";
               alfa7 = #labtraba#40 % 402;
               alfa8 = #labtraba#40 % -104;
               nume7 = alfa7;
               nume8 = alfa8;
               |SI nume7 = #0#1; |Y nume8 = #0#0;
                    alfa7 = #labtraba#40 % 102;
                    nume7 = alfa7;
                    dias_bon_16 = nume7 - 1;

                    fFecha = #labtraba#40;
                    nFecha = fFecha;
                    nFecha = nFecha - 1;
                    fFecha = nFecha;
                    fecha_fin_16 = fFecha;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO edl_CD_16;
     |SI nVeces = 2; |Y nVez = 1; |ACABA; |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = bon_60;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          bon_60_Alta = nBase * nPropAlta;
          bon_60_Alta = (bon_60_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bon_60_Alta;
     |SINO;
          nBase = bon_60 - bon_60_Alta;
          nBase = nBase ! 0;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0; |Y nBase ! 0;
          nEdadParaBon = 60;
          |HAZ fecha_bon_16;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "16";              || clave compensacion reducciones
          nume1 = d_alta;
          #3#2  = nume1;             || elemento
          |SI dias_bon_16 ! 0;
               #3#2 = dias_bon_16;
          |FINSI;
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |SI fecha_fin_16 ! "";
               |SI aParam = "TC2";
                    fech1 = fecha_fin_16;
                    |HAZ fechaTC2;
                    #3#8 = for_fecha;
               |SINO;
                    fech1 = fecha_fin_16;
                    |HAZ fecha;
                    #3#8 = for_fecha;
               |FINSI;
          |FINSI;
          #3#9  = "R.D.Ley 16/2001"; || referencia asociada
          |SI aParam = "TC2";
               fech1 = fecha_bon_16;        || se guarda la fecha para el TC2
               |HAZ fechaTC2;
               #3#7 = for_fecha;
          |SINO;
               fech1 = fecha_bon_16;  || fecha resolucion (subvencion)
               |HAZ fecha;
               #3#7  = for_fecha;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_cd_16 = tot_cd_16 + nBase;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;
*/

/****************************************************************************/

|PROCESO edl_CD_32;      || bonificaciones SISTEMA GARANTIA JUVENIL
     clave = "EDL";
     |SI #20#122 = 0; |ACABA;  |FINSI;
     |HAZ ini_linea;
     nBase = #20#122;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          bonjuv_Alta = nBase * nPropAlta;
          bonjuv_Alta = (bonjuv_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonjuv_Alta;

          |SI nPropAlta ! 1;
               || esto me da problemas si tengo dos bonif, entres las dos supero
               || la SS empresa, como quito de esta lo que sobra, despues no
               || reparte bien, lo comento y lo hago somo siempre lo he hecho
               || al menos de momento (4413.67)
          /*
               || ASI:
               |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                    nume1 = dias_enteros;
                    nProp = #12#234 / 40;
                    |SI 0.50 [ nProp; |Y nProp < 0.75;
                         nume2 = 5;
                    |FINSI;
                    |SI nProp ] 0.75;
                         nume2 = 7.5;
                    |FINSI;
               |SINO;
                    nume1 = d_alta;
                    nume2 = 10;
               |FINSI;
               bonjuv_Alta = nume1 * nume2;
               bonjuv_Alta = bonjuv_Alta * 100;
               nBase = bonjuv_Alta;
          */
          |FINSI;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    bonjuv_Baja = nBase * nPropBaja;
                    bonjuv_Baja = (bonjuv_Baja * 100) ! 0;   || vuelvo en centimos
                    nBase = bonjuv_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = #20#122 - bonjuv_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = #20#122 - bonjuv_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "32";
          |SI dias_enteros ! 0;
               nume1 = dias_enteros;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_32 = tot_cd_32 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_32;      || TOTAL bonificaciones SISTEMA GARANTIA JUVENIL
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_32 = tot_cd_32 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_32 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "32";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_32;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CA_81;      || TOTAL bonificaciones SISTEMA GARANTIA JUVENIL
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#170 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "81";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = #14#170;           || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO CoefTP;
     nCoefTP = 0;

     |ABRE #nomconca;
     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |SI FSalida = 0;
          nHorasSem = #nomconca#162;
     |FINSI;
     |SI nHorasSem = 0;
          nHorasSem = 40;
     |FINSI;
     nCoefTP = (#labtraba#234 / nHorasSem) ! 3;
     |CIERRA #nomconca;
|FPRC;

|PROCESO edl_CD_34;                || reduccion exencion 500 euros
     clave = "EDL";
     |SI swbon_34 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = reducc;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          bonifi_Alta = nBase * nPropAlta;
          bonifi_Alta = (bonifi_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi_Alta;
          |SI nPropAlta ! 1;
               || ASI:
               |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                    nume1 = dias_enteros;
                    |HAZ CoefTP;
                    nume2 = (((500 * nCoefTP) % 23.60) / 30) ! 2;
               |SINO;
                    nume1 = d_alta;
                    nume2 = 3.93;
               |FINSI;
               nume3 = #11#43 + #11#44 + #11#49 - swAjuste3;
               || el ajuste lo hago en la parte que haya mas dias
               || si no, nos da error
               |SI nume3 > nume1;
                    || mas dias de IT que de alta
                    bonifi_Alta = (nume1 * nume2) ! 2;
               |SINO;
                    bonifi_Alta = (reducc / 100) - (nume3 * nume2) ! 2;
               |FINSI;
               bonifi_Alta = bonifi_Alta * 100;
               nBase = bonifi_Alta;
          |FINSI;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                         nume1 = dias_enteros;
                         |HAZ CoefTP;
                         nume2 = (((500 * nCoefTP) % 23.60) / 30) ! 2;
                    |SINO;
                         nume1 = d_alta;
                         nume2 = 3.93;
                    |FINSI;
                    bonifi_Baja = (nume1 * nume2) ! 2;
                    bonifi_Baja = bonifi_Baja * 100;
                    nBase = bonifi_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = reducc - bonifi_Baja;
               |FINSI;
          |SINO;              || como siempre
               |SI eldat = 2;
                    |SI nDiasMate = 0;
                         nBase = reducc - bonifi_Alta;
                         nBase = nBase ! 0;
                    |SINO;
                         || habra enf y mat
                         |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                              nume1 = dias_enteros;
                              |HAZ CoefTP;
                              nume2 = (((500 * nCoefTP) % 23.60) / 30) ! 2;
                         |SINO;
                              nume1 = d_alta;
                              nume2 = 3.93;
                         |FINSI;
                         |SI dias_enteros ! 0;
                              || si tengo dias reales en el dat = 2
                              bonifi_Baja = reducc - bonifi_Alta;
                              nBase = bonifi_Baja;
                         |SINO;
                              nBase = 0;
                         |FINSI;
                         || bonifi_Baja = (nume1 * nume2) ! 2;
                         || bonifi_Baja = bonifi_Baja * 100;
                         || nBase = bonifi_Baja;
                    |FINSI;
               |SINO;
                    nBase = reducc - bonifi_Alta - bonifi_Baja;
                    nBase = nBase ! 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y reducc ! 0; |Y swbon_34 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "34";
          || nume1 = #11#20 ! 0;
          |SI dias_enteros ! 0;
               nume1 = dias_enteros;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_34 = tot_cd_34 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_34;                || reduccion exencion 500 euros
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_34 = tot_cd_34 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_34 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "34";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_34;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_33;                || bonificacion tutorias
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_33 = tot_cd_33 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_33 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "33";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_33;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_31;                || bonificaciones TARIFA PLANA
     clave = "EDL";
     |SI swbon_31 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = reducc;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          bonifi_Alta = nBase * nPropAlta;
          |SI swBonEpig = 1;
               bonifi_Alta = bonifi_Alta + base_Ca;
          |FINSI;
          bonifi_Alta = (bonifi_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi_Alta;
          |SI nPropAlta ! 1; |Y swbon_31 = 1;
               || ASI:
               |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                    nume1 = dias_enteros;
                    nProp = #12#234 / 40;
                    |SI 0.50 [ nProp; |Y nProp < 0.75;
                         nume2 = 1.67;
                    |FINSI;
                    |SI nProp ] 0.75;
                         nume2 = 2.5;
                    |FINSI;
               |SINO;
                    nume1 = d_alta;
                    nume2 = 3.33;
               |FINSI;
               bonifi_Alta = (((nBaseCC / 100) % 23.60) ! 2) - (nume1 * nume2);
               bonifi_Alta = bonifi_Alta * 100;
               nBase = bonifi_Alta;
          |FINSI;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    |SI swbon_31 = 1;
                         |SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
                              nume1 = dias_enteros;
                              nProp = #12#234 / 40;
                              |SI 0.50 [ nProp; |Y nProp < 0.75;
                                   nume2 = 1.67;
                              |FINSI;
                              |SI nProp ] 0.75;
                                   nume2 = 2.5;
                              |FINSI;
                         |SINO;
                              nume1 = d_alta;
                              nume2 = 3.33;
                         |FINSI;
                         bonifi_Baja = (((nBaseCC / 100) % 23.60) ! 2) - (nume1 * nume2);
                         bonifi_Baja = bonifi_Baja * 100;
                         nBase = bonifi_Baja;
                    |SINO;
                         bonifi_Baja = nBase * nPropBaja;
                         bonifi_Baja = (bonifi_Baja * 100) ! 0;   || vuelvo en centimos
                         nBase = bonifi_Baja;
                    |FINSI;
               |FINSI;
               |SI eldat = 3;
                    nBase = reducc - bonifi_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = reducc - bonifi_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y reducc ! 0; |Y swbon_31 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "31";
          |SI swbon_31 = 2;
               #3#1  = "06";
          |FINSI;
          || nume1 = #11#20 ! 0;
          |SI dias_enteros ! 0;
               nume1 = dias_enteros;
          |SINO;
               nume1 = d_alta;
          |FINSI;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #21#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          |SI swbon_31 = 1;
               tot_cd_31 = tot_cd_31 + nBase;
          |FINSI;
          |SI swbon_31 = 2;
               tot_cd_06 = tot_cd_06 + nBase;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_31;
     clave = "EDT";
     |HAZ ini_linea;
     tot_cd_31 = tot_cd_31 ! 2;
     |SI sw_auxil = 0;|Y tot_cd_31 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "31";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = tot_cd_31;         || importe o cuota
          #3#8  = aSigno;            || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_20;                || bonificaciones trabajadores Ceuta/Melilla
     clave = "EDL";
     |SI swbon_20 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = bonifi;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          bonifi_Alta = nBase * nPropAlta;
          |SI swBonEpig = 1;
               bonifi_Alta = bonifi_Alta + base_Ca;
          |FINSI;
          bonifi_Alta = (bonifi_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi_Alta;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    bonifi_Baja = nBase * nPropBaja;
                    bonifi_Baja = (bonifi_Baja * 100) ! 0;   || vuelvo en centimos
                    nBase = bonifi_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = bonifi - bonifi_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = bonifi - bonifi_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y bonifi ! 0; |Y swbon_20 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "20";
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_20 = tot_cd_20 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_20;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_20 = tot_cd_20 ! 2;
|SI sw_auxil = 0;|Y tot_cd_20 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "20";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_20;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_CD_25;
     clave = "EDL";
     |SI bonifi_25 ! 0;
          swbon_25 = 1;
     |FINSI;
     |SI swbon_25 = 0; |ACABA; |FINSI;
     |HAZ ini_linea;
     nBase = bonifi;
     |SI bonifi_25 ! 0;
          nBase = bonifi_25;
     |FINSI;
     |SI eldat = 1;
          nBase = nBase / 100;   || vuelvo a 2 decimales
          |SI swBonEpig = 1;
               nBase = nBase - base_C;  || no porporciono bonif epig
          |FINSI;
          bonifi25_Alta = nBase * nPropAlta;
          |SI swBonEpig = 1;
               bonifi25_Alta = bonifi25_Alta + base_Ca;
          |FINSI;
          bonifi25_Alta = (bonifi25_Alta * 100) ! 0;   || vuelvo en centimos
          nBase = bonifi25_Alta;
     |SINO;
          |SI nPropMat ! 0;   || ojo, es un mes entero de baja, con dias
                              || en maternidad
               nBase = nBase / 100;   || vuelvo a 2 decimales
               |SI eldat = 2;
                    bonifi25_Baja = nBase * nPropBaja;
                    bonifi25_Baja = (bonifi25_Baja * 100) ! 0;   || vuelvo en centimos
                    nBase = bonifi25_Baja;
               |FINSI;
               |SI eldat = 3;
                    nBase = bonifi_25 - bonifi25_Baja;
               |FINSI;
          |SINO;              || como siempre
               nBase = bonifi_25 - bonifi25_Alta;
               nBase = nBase ! 0;
          |FINSI;
     |FINSI;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y bonifi ! 0; |Y swbon_25 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "25";
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          |HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_25 = tot_cd_25 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
     |SI bonifi_25 ! 0;
          swbon_25 = 0;
     |FINSI;
|FPRC;

|PROCESO edt_CD_25;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_25 = tot_cd_25 ! 2;
|SI sw_auxil = 0;|Y tot_cd_25 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "25";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_25;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_28;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_28 = tot_cd_28 ! 2;
|SI sw_auxil = 0;|Y tot_cd_28 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "28";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_28;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edl_CD_28;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = #11#88;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "28";
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          ||HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #20#12 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |HAZ CD_2006_Epi;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_28 = tot_cd_28 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_11;
     clave = "EDL";
     |HAZ ini_linea;
     swSigue = 0;
     |SI sw_auxil = 0;
          |SI #11#29 ! 0; |O #11#103 ! 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "11";              || clave bases horas no estructurales
          #3#2  = "000";             || elemento
          #3#3  = #11#29;            || importe
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               #3#1  = "09";            || clave bases horas no estructurales
               #3#2  = nHorasComp;      || numero de horas complementarias
               #3#3  = #11#103;            || importe
          |FINSI;
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               tot_ba_09 = tot_ba_09 + #11#103;
               tot_hor_com = tot_hor_com + nHorasComp;
          |SINO;
               tot_ba_11 = tot_ba_11 + #11#29;
          |FINSI;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO PFETP;
     |SI #12#129 = "G";  || en guarda legal, aunque este a TP la bonificacion
          |ACABA;        || se cobra completa, con lo que ESTO no hay que
     |FINSI;             || hacerlo, el indicador ha de quedarse a CERO

     |ABRE #nombotra;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     |SI #11#73 > 0;
          #nombotra#2 = #20#114;
          |SI #20#114 = 0;
               #nombotra#2 = nBonif;
          |FINSI;
     |FINSI;
     |SI #11#75 > 0;
          #nombotra#2 = #20#116;
          |SI #20#116 = 0;
               #nombotra#2 = nBonif;
          |FINSI;
     |FINSI;
     |LEE 000#nombotra.=;
     |CIERRA #nombotra;

     swSigue = 0;
     || aAlfa1 = #labtraba#36;
     aAlfa1 = #nombotra#4;
     aAlfa2 = "08.03.2009";
     fFecha1 = aAlfa1;
     fFecha2 = aAlfa2;
     |SI fFecha1 < fFecha2;
          swSigue = 1;
     |SINO;
          |SI #0#0 = 2009; |Y #0#1 = 4;
               swSigue = 1;   || todavia no estaba esto en vigor
          |SINO;
               swSigue = 0;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               |SI #labtraba#234 > 0; |Y #labtraba#234 < 10;
                    #3#16 = "3";
               |FINSI;
               |SI #labtraba#234 ] 10; |Y #labtraba#234 < 20;
                    #3#16 = "2";
               |FINSI;
               |SI #labtraba#234 ] 20; |Y #labtraba#234 < 30;
                    #3#16 = "1";
               |FINSI;
               |SI #labtraba#234 ] 30;
                    #3#16 = "4";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PropTP;
          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               |SI #labtraba#234 ] 20; |Y #labtraba#234 < 30;
                    #3#16 = "5";
               |FINSI;
               |SI #labtraba#234 ] 30;
                    #3#16 = "6";
               |FINSI;
          |FINSI;
|FPRC;

|PROCESO BonifCero;
          #20#12 = 0;
          #20#43 = 0;
          #20#44 = 0;
          #20#82 = 0;
          #20#63 = 0;
          #20#79 = 0;
          #20#83 = 0;
          #20#81 = 0;
          #20#64 = 0;
          #20#92 = 0;
          #20#94 = 0;
          #20#95 = 0;
          #20#96 = 0;
          #20#97 = "";
          #20#99 = 0;
          #20#100 = 0;
          #20#101 = 0;
          #20#106 = 0;
|FPRC;

|PROCESO PrestaCero;
          #20#57 = 0;
          #20#58 = 0;
|FPRC;

|PROCESO RecargoMora;
     |SI #0#14 = "L04";
          |ACABA;
     |FINSI;
     |SI #0#14 = "L09"; |O #0#14 = "TP2";
          |ABRE #tsilco13; |LEE 000#tsilco13.p; |CIERRA #tsilco13;
          |SI #tsilco13#0 ! 1;
               #labempre#127 = #tsilco13#5;
               #labempre#64 = "N";
          |FINSI;
          |SI #tsilco13#0 = 2;
               |HAZ BonifCero;
               |HAZ PrestaCero;
          |FINSI;
     |FINSI;
     |SI #labempre#127 > 0;
          |HAZ BonifCero;
     |FINSI;
     |SI #labempre#127 > 0; |Y #labempre#64 = "N";
          |HAZ PrestaCero;
     |FINSI;
|FPRC;

|PROCESO Produccion;
     swProduccion = 0;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa % -109;
     |SI aAlfa = "dsprofes/";       || estoy en produccion, sin duda
          swProduccion = 1;
     |FINSI;
|FPRC;

     || Bueno, estos procesos son para cubrir el siguiente caso: un trabajador
     || enfermo todo el mes que cotiza por el minimo en comunes y en profe-
     || sionales, porque su base IT era inferior al minimo, eso provoca que
     || la diferencia entre lo cotizado por CP y la base IT sea > 0. Eso
     || putea y bien, debido a que esa diferencia la intenta poner como base
     || de prof. en alta y eso no esta bien, lo soluciono sumandosela a la
     || parte en baja, con ello consigo volver a tener la cantidad correcta

|PROCESO tope_parche22;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     |SI #11#33 = topemes;     || todo el mes de baja
          |SI #11#27 > 0;     || con una base el alta (no es correcto)
               nume1 = nume1 + #11#27; || le sumo la parte en alta
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tope_parche21;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     |SI #11#33 = topemes;     || todo el mes de baja
          |SI #11#27 > 0;     || con una base en alta (no es correcto)
               nume1 = 0;     || le anulo esta parte en alta
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO constante2;
     || este proceso es exactamente el mismo que el PROCESO constante pero
     || como no quiero dejar solo uno para todo slos silcones lo meto aqui

     alfa1 = "01";
     alfa2 = #0#1;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores

     |HAZ LeeCons;

     |SI aCError ! "";
          alfa1 = #labtraba#0; alfa1 = "00000" + #labtraba#0; alfa1 = alfa1 % -105;
          alfa2 = #labtraba#1; alfa2 = "00000" + #labtraba#1; alfa2 = alfa2 % -105;
          aAlfa = "0000ATENCION: Trabajador: " + alfa1 + "." + alfa2;
          aAlfa = aAlfa + " La constante del trabajador no esta definida.";
     |FINSI;
|FPRC;

|PROCESO tope_parche;
     |SI s_ori = "A"; |O s_ori = "T"; |ACABA; |FINSI;  || EN ATRASOS NO

     nCConst = #labtraba#248;
     |HAZ constante2;
     || en el caso de que tengamos un trabajador que sea:
     || 1. Diario
     || 2. Que cotize al maximo (88.40 euros al dia)
     || 3. Que este todo el mes de baja
     || no sale bien el seguro social porque al hacer la base en baja, al
     || estar el maximo ha de coger para comunes el maximo de 31 dias y para
     || profesionales el maximo de 30, eso en alta no tiene problema, pero
     || en baja me guardo una sola base, asi que este proceso topea las
     || profesionales comprobando que no pase del maximo, pero solo ESE caso
     || es decir, controla solo que la base de profesionales en baja no sea
     || mayor que el tope de Profesionales que dice la Seg. Social: 2652 euros
     || esto es un arreglo cutre para Asecor, 25.11.2003

     nTope = #nomconst#20 * 30;
     nTope = nTope * 100;
     |SI nume1 > nTope;
          nume1 = nTope;
     |FINSI;
|FPRC;

|PROCESO labtraba;
     |SI #labtraba#44 = "A";
          |SI #labtraba#129 = "T"; |O #labtraba#129 = "R";
               swMaterTP = 1;
               swExiste = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#2;
     ;
     aNif;
     aNif;
     ;
     NULL, labtraba;
|FIN;

|PROCESO MaterTP;
     |SI #0#17 = 2;      || claro, solo en tipo 0
          |ACABA;
     |FINSI;

     |SALVA_FICHA #labtraba;

     aNif = #labtraba#7;
     |BUCLE labtraba;

     |REPON_FICHA #labtraba;
|FPRC;

|PROCESO siltmpco;
     #siltmpco#0 = #0#2;
     #siltmpco#1 = #labcentr#10;
     #siltmpco#2 = #labtraba#45;
     |LEE 101#siltmpco.=;
     |SI FSalida = 0;
          #siltmpco#3 = #siltmpco#3 + (nume1 / 100);
          |GRABA 020#siltmpco.a;
     |SINO;
          #siltmpco#3 = nume1 / 100;
          |GRABA 020#siltmpco.n;
     |FINSI;
     |LIBERA #siltmpco;
|FPRC;

|PROCESO IndicadorERE;
     nNume1 = (#11#67 - #11#25 - #11#37 - #11#61);
     |SI #silcon09#12 ! "A"; |Y #silcon09#12 ! "T";  || en atrasos NO
          |SI #nomredco#1 = "7.3.0";
               |SI nNume1 = #11#67;  || ERE Total
                    |SI eldat = 4; |Y #11#68 ! 0;   || Exp.Reg.Empleo Total
                         #3#7 = "T";                 || parte en baja (todo)
                    |FINSI;
               |SINO;
                    |SI eldat = 1; |O eldat = 2; |O eldat = 3;
                         |SI #11#68 ! 0;               || Exp.Reg.Empleo Parcial
                              #3#7 = "R";              || parte en alta o baja sin ERE
                         |FINSI;
                    |FINSI;
                    |SI eldat = 4; |Y #11#68 ! 0;    || Exp.Reg.Empleo Parcial
                          #3#7 = "P";                  || parte en baja
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #11#67 ! 0; |Y eldat = 4;
                    #3#7 = "T";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AjusteDes;
     nume1 = #11#43 + #11#44 + #11#49;
     nume2 = #11#42;
     |SI nume2 = 0; nume2 = topemes; |FINSI;
     |SI #11#41 [ 1; |Y nume2 ] topemes; |Y #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
     |Y #11#69 ! 0;
     |Y d_alta < 30; || cuando d_alta viene con 30 es porque he estado el mes completo
          |SI nElMes = 1; |O nElMes = 2; |O nElMes = 3; |O nElMes = 5; |O nElMes = 7;
          |O nElMes = 8; |O nElMes = 10; |O nElMes = 12;
               |SI nElMes = 2;
                    swAjusteD = 2;
/*
               |SINO;
                    swAjusteD = -1;
*/
               |FINSI;
          |FINSI;
     |FINSI;
     d_alta = d_alta + swAjusteD;
|FPRC;

|PROCESO Activa20; |TIPO 7;
     |SI #0#14 = "L00";
          |SI #0#9 = "T";          || liquidacion (total en plazo)
               #0#20 = 0;
               |CAMPO_MODIFICA #0#20, 1, "S";
          |FINSI;
          |SI #0#9 = "O";          || liquidacion (obrera en plazo)
               #0#20 = 1;
               |CAMPO_MODIFICA #0#20, 1, "N";
          |FINSI;
          |SI #0#9 = "P";          || liquidacion (patronal en plazo)
               #0#20 = 2;
               |CAMPO_MODIFICA #0#20, 1, "N";
          |FINSI;
     |SINO;
          #0#20 = 0;
          |CAMPO_MODIFICA #0#20, 1, "N";
     |FINSI;
     |PINTA #0#20;
|FPRC;

|PROCESO Busca111;
     || la bonificacion va solo en el segmento de alta en el caso de que comience
     || este mes, si venia de otra maternidad anterior tendra que ir en los dos
     |SI #nombotra#2 = 111;
          aAlfa = #nombotra#4;
          aAlfa1 = aAlfa % 402;
          aAlfa2 = aAlfa % -104;
          nume1 = aAlfa1;
          nume2 = aAlfa2;

          |PARA para1 = 27; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
               |SI #20para1 = "M"; |Y #0#0 = nume2; |Y #0#1 = nume1;
                    nDiasMate = 0;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Ayuda15; |TIPO 7;
     |PUSHV 10552380;
     |ATRI R;
     ||            5    6         7         8
     ||            56789012345678901234567890
     |PINTA 1055, "       - Opciones -       ";
     |PINTA 1155, "L00-Normal                ";
     |PINTA 1255, "L02-Salarios de tramita-  ";
     |PINTA 1355, "    ci¢n                  ";
     |PINTA 1455, "L03-Atrasos               ";
     |PINTA 1555, "L04-Devoluci¢n prestacio- ";
     |PINTA 1655, "    nes o bonificaciones  ";
     |PINTA 1755, "    indebidas             ";
     |PINTA 1855, "L09-Complementarias       ";
     |PINTA 1955, "L13-Finiquitos            ";
     |PINTA 2055, "TP2-Pluriempleo. Liquida- ";
     |PINTA 2155, "    ci¢n  por  protecci¢n ";
     |PINTA 2255, "    no com£n              ";
     |ATRI 0;
|FPRC;

|PROCESO Restaura_silcon09;
     |POPV;
|FPRC;

|PROCESO no_vacio; |TIPO 0;
     alfa1 = #0Campo;
     |QBT alfa1;
     |SI alfa1 = "";
          |MENAV "    ATENCION. Es necesario indicar un nombre para el fichero FAN.";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO TipoID;
     alfa1 = #12#7 % 101;
     alfa2 = #12#7;
     |QBF alfa2;
     alfa2 = alfa2 % -101;

     |SI alfa1 ] "A"; |Y alfa1 [ "z";
          |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
               |SI alfa2 ] "A"; |Y alfa2 [ "z";
                    #3#2 = "6";                  || tipo identif.(EXTRANJERO)
                    #3#3 = "   ";                || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |SINO;
                    #3#2 = "2";                  || tipo identif.(PASAPORTE)
                    #3#3 = #12#76 % 103;         || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |FINSI;
          |SINO;
               #3#2 = "2";                  || tipo identif.(PASAPORTE)
               #3#3 = #12#76 % 103;         || pais emisor
               #3#7 = #12#76 % 103;         || nacionalidad
          |FINSI;
     |FINSI;
     |SI #nomcontr#40 = 2;
          |SI #3#2 = "6";
               aAlfa = #12#7;
               |QBF aAlfa;
               aAlfa1 = aAlfa % 101;
               aAlfa = aAlfa - aAlfa1;
               alfa6 = aAlfa % 0;
               long = alfa6;
               |SI long ! 9;
                    aAlfa = aAlfa1 + "0" + aAlfa;
               |SINO;
                    aAlfa = aAlfa1 + aAlfa;
               |FINSI;
               #12#7 = aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Repetir;
     swRepite = 0;
     |SI #0#12 = "R";
          |LEE 000#0p;
          |SI FSalida = 0;
               swRepite = 1;
               #0#2 = #0#2 + 1;
               #0#3 = #0#2;

               #0#22 = #0#2 + 1;
               #0#23 = #0#3;
               |PINDA #0#0;
               alfa1 = Usuario; |QBT alfa1;    alfa1 = ("t" + alfa1) % 108;
               alfa2 = Usuario; |QBT alfa2;    alfa2 = ("u" + alfa2) % 108;
               |NOME_DAT #15 alfa1;
               |NOME_DAT #23 alfa2;
               ||PTEC 806;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FiniqMen;
     |SALVA_FICHA #nomcalca;

     #nomcalca#3 = 2;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          |SI #nomcalca#171 = 0; |Y #nomcalca#172 = 0;
               |ABRE #nomcalli;
               #nomcalli#0 = #nomcalca#0;
               #nomcalli#1 = #nomcalca#1;
               #nomcalli#2 = #nomcalca#2;
               #nomcalli#3 = #nomcalca#3;
               #nomcalli#4 = 125;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    |SI #nomcalli#11 > 0; |Y #nomcalli#10 > 0;
                         nAny = #0#0;
                         nMes = #0#1;
                         |HAZ topemes_plb;

                         nDiasVacac = (#nomcalli#11 + 0.49) ! 0;
                         nNume1 = nTopemes - #nomcalca#8;     || dias disponibles
                         |SI nDiasVacac [ nNume1;
                              #20#159 = nDiasVacac;
                              #20#160 = 0;
                         |SINO;
                              #20#159 = nNume1;
                              #20#160 = nDiasVacac - nNume1;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalli;
          |SINO;
               #20#159 = #nomcalca#171;
               #20#160 = #nomcalca#172;
          |FINSI;
     |FINSI;
     |REPON_FICHA #nomcalca;
|FPRC;

|PROCESO CamposDiasFiniqMen;
     |SI #0#17 = 2; |Y #20#159 = 0; |Y #20#160 = 0;
          || finiquito sin dias de vacaciones cotizables guardados
          || compruebo si es que no se han calculado

          |HAZ FiniqMen;

          |SI #labtraba#45 = "421"; |O #labtraba#45 = "422"
               |SI #20#160 = 0;
                    || si calculo el L13 de formacion, y no hay dias para
                    || sacar L13, NO PUEDE HABER BONIFICACION
                    || que se esta grabando por algun motivo en el finiquito
                    #20#120 = 0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FiniqFormacionMen;
     |SI #labtraba#45 = "421"; |O #labtraba#45 = "422"
          |SI #0#17 = 0;
               |HAZ FiniqMen;

               |SI #20#159 ! 0;
                    nBase = #nomconst#33;

                    #20#8 = #20#8 + #20#159;
                    |SI #20#8 > 30;
                         |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                              #20#8 = #20#8 - 1;
                         |FINSI;
                         #20#159 = #20#159 - 1;
                    |FINSI;
                    #20#39 = #20#39 + (#20#159 * nBase);
                    #20#40 = #20#40 + (#20#159 * nBase);
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FiniqHis;
     |SALVA_FICHA #nomhicca;

     #nomhicca#3 = 2;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;         || tengo finiquito
          |SI #nomhicca#213 = 0; |Y #nomhicca#214 = 0;
               |ABRE #nomhicli;
               #nomhicli#0 = #nomhicca#0;
               #nomhicli#1 = #nomhicca#1;
               #nomhicli#2 = #nomhicca#2;
               #nomhicli#12 = #nomhicca#66;
               #nomhicli#3 = #nomhicca#3;
               #nomhicli#4 = 125;
               |LEE 000#nomhicli.=;
               |SI FSalida = 0;
                    |SI #nomhicli#11 > 0; |Y #nomhicli#10 > 0;
                         nAny = #0#0;
                         nMes = #0#1;
                         |HAZ topemes_plb;

                         nDiasVacac = (#nomhicli#11 + 0.49) ! 0;
                         nNume1 = nTopemes - #nomhicca#8;     || dias disponibles
                         |SI nDiasVacac [ nNume1;
                              #20#159 = nDiasVacac;
                              #20#160 = 0;
                         |SINO;
                              #20#159 = nNume1;
                              #20#160 = nDiasVacac - nNume1;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #nomhicli;
          |SINO;
               #20#159 = #nomhicca#213;
               #20#160 = #nomhicca#214;
          |FINSI;
     |FINSI;

     |REPON_FICHA #nomhicca;
|FPRC;

|PROCESO CamposDiasFiniqHis;
     |SI #0#17 = 2; |Y #20#159 = 0; |Y #20#160 = 0;
          || finiquito sin dias de vacaciones cotizables guardados
          || compruebo si es que no se han calculado

          |HAZ FiniqHis;

          |SI #labtraba#45 = "421"; |O #labtraba#45 = "422"
               |SI #20#160 = 0;
                    || si calculo el L13 de formacion, y no hay dias para
                    || sacar L13, NO PUEDE HABER BONIFICACION
                    || que se esta grabando por algun motivo en el finiquito
                    #20#120 = 0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FiniqFormacionHis;
     |SI #labtraba#45 = "421"; |O #labtraba#45 = "422"
          |SI #0#17 = 0;
               |HAZ FiniqHis;

               |SI #20#159 ! 0;
                    nBase = #nomconst#33;

                    #20#8 = #20#8 + #20#159;
                    |SI #20#8 > 30;
                         |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                              #20#8 = #20#8 - 1;
                         |FINSI;
                         #20#159 = #20#159 - 1;
                    |FINSI;
                    #20#39 = #20#39 + (#20#159 * nBase);
                    #20#40 = #20#40 + (#20#159 * nBase);
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CamposCRA;
     |SI #0#21 = "S";
          |CAMPO_MODIFICA #0#22, 1, "S";
          |CAMPO_MODIFICA #0#23, 1, "S";
          #0#22 = #0#2 + 1;
          #0#23 = #0#3;
          |PINTA #0#22;
          |PINTA #0#23;
     |SINO;
          |CAMPO_MODIFICA #0#22, 1, "N";
          |CAMPO_MODIFICA #0#23, 1, "N";
          #0#22 = 00000;
          #0#23 = "        ";
          |PINTA #0#22;
          |PINTA #0#23;
     |FINSI;
|FPRC;

|PROCESO LanzaCRA;
     s_sel = #0#11;
     s_lotecra = #0#22;
     s_fichcra = #0#23;
     |SI swFiniqRaro2 = 1; |O swSegundoLote = 1;
          s_any = s_any - 1;
          s_mes = 12;
          s_has = 12;
          s_anyl = s_anyl - 1;
     |FINSI;
     |SUB_EJECUTA "silcon20;silcon09";
|FPRC;

|PROCESO GrabaLote;
     aAlfa1 = #0#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#3; |QBF aAlfa2;
     aAlfa3 = #0#4; |QBF aAlfa3;
     aAlfa = "    S¿Desea grabar el fichero " + aAlfa2 + "." + aAlfa3 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          enLote = #0#2;
          eaFich = #0#3; |QBF eaFich;
          eaExt = #0#4; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";
     |FINSI;
|FPRC;

|PROCESO GrabaLotes;
     aAlfa1 = #0#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#3; |QBF aAlfa2;
     aAlfa3 = #0#4; |QBF aAlfa3;

     aAlfa4 = #0#22; |QBF aAlfa4; aAlfa4 = ("00000" + aAlfa4) % -105;
     aAlfa5 = #0#23; |QBF aAlfa5;
     aAlfa6 = "cra"; |QBF aAlfa6;

     aAlfa = "    S¿Desea grabar los ficheros " + aAlfa2 + "." + aAlfa3 + " y ";
     aAlfa = aAlfa + aAlfa5 + "." + aAlfa6 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          enLote = #0#2;
          eaFich = #0#3; |QBF eaFich;
          eaExt = #0#4; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";

          enLote = #0#22;
          eaFich = #0#23; |QBF eaFich;
          eaExt = "cra"; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";
     |FINSI;
|FPRC;

|PROCESO Complementarias;
     |SI #0#14 = "L09"; |O #0#14 = "TP2";
          |PUSHV 05012380;

          |ABRE #tsilco13;
          |LEE 101#tsilco13.p;
          |SI FSalida ! 0;
               |DDEFECTO #tsilco13;
               |GRABA 020#tsilco13.n;
          |FINSI;
          |LEE 101#tsilco13.=;

          |PINPA #0#tsilco13;
          |PINDA #0#tsilco13;

          |ENDATOS #1#tsilco13;

          |SI FSalida = 0;
               |GRABA 020#tsilco13.a;
          |FINSI;
          |LIBERA #tsilco13;
          |CIERRA #tsilco13;

          |POPV;
     |FINSI;
|FPRC;

|PROCESO TP2_Pluriempleo;
     |ABRE #nompluba;
     #nompluba#0 = #20#0;
     #nompluba#1 = #20#1;
     #nompluba#2 = #0#0;
     #nompluba#3 = #20#2;
     #nompluba#4 = #20#3;
     |LEE 000#nompluba.=;
     |SI FSalida = 0;
          |ABRE #nompluri;
          #nompluri#0 = #20#0;
          #nompluri#1 = #20#1;
          |LEE 000#nompluri.=;
          |SI FSalida = 0;
               || contingencias comunes

               nComunesOri = #20#39;
               #20#39 = #nompluba#5 - #20#39;

               || contingencias profesionales

               nNume = #20#40;
               |SI #nompluba#6 > #20#40;
                    nNume = #nompluba#6;
               |SINO;
                    |SI #nompluba#7 > #20#40;
                         nNume = #nompluba#7;
                    |SINO;
                         |SI #nompluba#8 > #20#40;
                              nNume = #nompluba#8;
                         |FINSI;
                    |FINSI;
               |FINSI;

               nATEPOri = #20#40;
               #20#40 = nNume - #20#40;

               |SI #20#62 ! 0;     || tengo IT
                    nNume = #20#39;
                    nNume = nNume ! 0;
                    |SI nNume ! 0;
                         #20#39 = (#20#37 + #20#38) - (nComunesOri - #20#62);
                    |FINSI;

                    nNume = #20#40;
                    nNume = nNume ! 0;
                    |SI nNume ! 0;
                         #20#40 = (#20#37 + #20#38) - (nATEPOri - #20#62);
                    |FINSI;

                    || ya tengo la base en alta, ahora tengo que ver la base en IT
                    || por la que he dejado de cotizar en la nomina "normal"

                    || primero busco mes anterior
                    || ¨en que periodo comenzo la IT?
                    aAlfa = #labtraba#125;
                    |QBF aAlfa;
                    |SI aAlfa = "";     || se ve que ha empezado este mes
                         |LEE 000#nompluba.a;
                    |SINO;
                         aAlfa1 = aAlfa % 402;
                         nNume1 = aAlfa1;
                         aAlfa2 = aAlfa % -104;
                         nNume2 = aAlfa2;

                         #nompluba#2 = nNume2;
                         #nompluba#3 = nNume1 - 1;
                         #nompluba#4 = 0;
                         |LEE 000#nompluba.=;
                    |FINSI;
                    |SI FSalida = 0;
                         |SI #nompluri#3 ] 99.99; nBaseTotal = #nompluba#5; |FINSI;
                         |SI #nompluri#4 ] 99.99; nBaseTotal = #nompluba#6; |FINSI;
                         |SI #nompluri#5 ] 99.99; nBaseTotal = #nompluba#7; |FINSI;
                         |SI #nompluri#6 ] 99.99; nBaseTotal = #nompluba#8; |FINSI;
                    |FINSI;

                    || promedio si no hubiera estado en pluriempleo
                    nNume1 = nBaseTotal / 30; || por ejemplo, todos mensuales
                    nNume1 = nNume1 ! 2;      || salgo del paso de momento

                    || promedio utilizado en la nomina
                    nNume2 = #20#35;

                    || dias cotizables de IT
                    nNume3 = #20#62 / #20#35;

                    || base IT
                    #20#62 = nNume3 * (nNume1 - nNume2);

                    || la a¤ado a la base en alta, como la nomina
                    || si habia diferencias entre base y base pluriempleo CC
                    |SI #nompluba#5 > nComunesOri;
                         #20#39 = #20#39 + #20#62;
                    |FINSI;

                    || lo mismo
                    || si habia diferencias entre base y base pluriempleo ATEP
                    |SI #nompluba#6 > nATEPOri; |O #nompluba#7 > nATEPOri;
                    |O #nompluba#8 > nATEPOri;
                         #20#40 = #20#40 + #20#62;
                         |SI #20#39 = 0;
                              || si no no sale si esta todo el mes de IT
                              #20#39 = #20#39 + #20#62;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #nompluri;
     |FINSI;
     |CIERRA #nompluba;
|FPRC;

|PROCESO bon_rdl012015_men;
     || transformo bonif. 507 o 508 en fomento empleo, para que acumulen
     || en el CA22
     |SI #18#12 = 507; |O #18#12 = 508;
          |SI #18#63 ! 0;
               |SI #18#96 = 0;
                    #18#96 = #18#63;    || importe bonif
                    #18#135 = #18#12;   || codigo bonif
               |SINO;
                    #18#133 = #18#63;   || importe bonif
                    #18#136 = #18#12;   || codigo bonif
               |FINSI;
               #18#12 = 0;
               #18#63 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO bon_rdl012015_his;
     || transformo bonif. 507 o 508 en fomento empleo, para que acumulen
     || en el CA22
     |SI #19#12 = 507; |O #19#12 = 508;
          |SI #19#63 ! 0;
               |SI #19#138 = 0;
                    #19#138 = #19#63;    || importe bonif
                    #19#177 = #19#12;   || codigo bonif
               |SINO;
                    #19#175 = #19#63;   || importe bonif
                    #19#178 = #19#12;   || codigo bonif
               |FINSI;
               #19#12 = 0;
               #19#63 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Borrador;
     |_PDIR aAlfa;
     |SI FSalida = 0;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa1 = aAlfa;
               |FBORRA aAlfa1;
               |_SDIR aAlfa;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO BorraTemporales;
     || esto es para evitar el error ese de la estructura del temporal
     || que no es valida que pasa en algunos clientes algunas veces y que
     || no sabemos de donde sale, no me complico la vida y borro los
     || temporales t(0-9)*.* a mano y ya esta

     |DBASS aAlfa;
     |QBF aAlfa;
     |SI aAlfa ! "/u/dsprofes/"; |Y aAlfa ! "/u/dsasesor/";
          || solo en clientes
          |DFICE aFich;
          aAlfa = aFich + "t1*"; |HAZ Borrador;
          aAlfa = aFich + "t2*"; |HAZ Borrador;
          aAlfa = aFich + "t3*"; |HAZ Borrador;
          aAlfa = aFich + "t4*"; |HAZ Borrador;
          aAlfa = aFich + "t5*"; |HAZ Borrador;
          aAlfa = aFich + "t6*"; |HAZ Borrador;
          aAlfa = aFich + "t7*"; |HAZ Borrador;
          aAlfa = aFich + "t8*"; |HAZ Borrador;
          aAlfa = aFich + "t9*"; |HAZ Borrador;
          aAlfa = aFich + "t0*"; |HAZ Borrador;
     |FINSI;
|FPRC;

|PROCESO ITEmp;
     |SI #20#111 ! 0; |Y #labtraba#241 = "N";
          nNume1 = #20#31 + #20#32;
          |SI nNume1 ! 0;
               #20#110 = nNume1;
               #20#31 = 0;
               #20#32 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cambia_autoriz;
     #silcon03#0 = #silcon03#0;
     #silcon03#1 = 0002;
     |LEE 101#silcon03.=;
     |SI FSalida = 0;
          nNume1 = nPosicion;
          nNume1 = 100 + nNume1;
          aAlfa1 = #silcon03#4 % nNume1;
          nNume2 = nPosicion + 9;
          nNume2 = (nNume2 * 100) + 99;
          aAlfa2 = #silcon03#4 % nNume2;
          #silcon03#4 = aAlfa1 + #silcon06#5 + aAlfa2;
          |GRABA 020#silcon03.a;
     |FINSI;
|FPRC;

|PROCESO acumhoras;
     |SI s_tat = "M"; |Y #nomcalli#11 > 0;
          nHorasComp = nHorasComp + #nomcalli#11;
     |FINSI;
     |SI s_tat = "H"; |Y #nomhicli#11 > 0;
          nHorasComp = nHorasComp + #nomhicli#11;
     |FINSI;
|FPRC;

|DEFBUCLE HorasHis;
     #nomhicli#1
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 301;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 399;
     ;
     NULL, acumhoras;
|FIN;

|DEFBUCLE HorasMen;
     #nomcalli#1
     ;
     #nomcalca#0, #nomcalca#1, #nomcalca#2, #nomcalca#3, 301;
     #nomcalca#0, #nomcalca#1, #nomcalca#2, #nomcalca#3, 399;
     ;
     NULL, acumhoras;
|FIN;

|PROCESO HorasComp;
     nHorasComp = 0;
     |SI #0#12 = "M";
          |BUCLE HorasMen;
     |FINSI;
     |SI #0#12 = "H";
          |BUCLE HorasHis;
     |FINSI;
|FPRC;
