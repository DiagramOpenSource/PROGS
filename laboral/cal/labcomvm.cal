|FICHEROS;
    labcomvm #0;
    labempre #1;
    labcontr #2;
    labcontr #100;
|FIN;

|VARIABLES;
 v = 0;
 sw = 0;
 any = 0;
 tope = 0;
 mod = 0;
    men1 = "0000ATENCION !!! Fecha erronea ...";
    mes1 = "";
    fec = "";
    blanco = "          ";
    puntos = "..........";
    vblanco = "          ";
    vpuntos = "..........";
    informe = "labcomvm";
    mensa1 = "    No existe empresa";
    mensa2 = "    ATENCION !!! Fichero de parametros de Control inexistentes ...";
    &coma = ",";
    &dia = "";             || fecha presentacion desglosada
    &mes = "";
    &anyo = "";
    dia1 = "";            || variables trabajo fecha
    any1 = "";
    fec1 = "";
    fec2 = 0;
    fiac = "  ";
    aponer = "  ";
    relleno = "                              ";
    &domi = "";
    &localida = "";
    trabajo = "";
    &local = "";
    alfa1 = "";
|FIN;

|INCLUYE i_comun;

|PROCESO leeempre;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #1;                    || DE LA RELACION CON EL FICHERO DE
        #1#0 = #0#0;          || EMPRESAS
|LEE 040#1=;
|SI FSalida ! 0;
    |MENAV mensa1;
        #0#0 = 0;
    |ERROR;
    domi = "";
|SINO;
    |PINTA 0804,#1#2;
    domi = #1#3;
    |QBF domi;
    domi = domi + ",";
    domi = domi + #1#4;
    domi = domi + "-";
    domi = domi + #1#5;
    trabajo = #1#6;
    localida = #1#6;
    |QBF localida;
    localida = "                         " + localida;
    localida = localida % -125;
    #1#6 = localida;
    localida = trabajo;
|FINSI;
|CIERRAT #1;
|FPRC;

|PROCESO leecontr; |TIPO 7;
|ABRE #2;
|LEE 040#2p;
|SI FSalida ! 0;
    |MENAV mensa2;
    #2#38 = "";
|FINSI;
|CIERRA #2;
    alfa1 = #2#33;
|QBF alfa1;
    local = alfa1;
    alfa1 = " " * 30;
    local = alfa1 + local;
    local = local % -130;
|FPRC;

|PROCESO imprime; |TIPO 3;
|HAZ r_regis0;   r_emp = #0#0;  |HAZ r_regis1;

|ABRE #100; |LEE 000#100p; |CIERRA #100;
#100#60 = "N";
|SI #100#60 = "S";
     Impresora = "CrystalReport";
     |IMPRE -1;
|SINO;
     |IMPRE 0;
|FINSI;
|SI Impresora = "CrystalReport";
     |MENAV "    ATENCION: Informe no disponible en formato Crystal Reports";
     |ACABA;
|FINSI;

|SI FSalida = 0;
    |HAZ decodifi;
    |PARA v = 1; |SI v [ #0#14; |HACIENDO v = v + 1;
        |INFOR informe;
        |PRINT;
        |PIEINF;
        |FININF;
    |SIGUE;
|SINO;
    |MENAV "    ATENCION!!! Proceso Abortado ...";
|FINSI;
|FINIMP;
|FPRC;

|PROCESO decodifi;             || RUTINA DE DEGLOSE FECHA PRESENTACION
|SI #0#13 ! vpuntos; |Y #0#13 ! vblanco;
        fec1 = #0#13;
        dia1 = fec1 % 102;
        dia  = dia1;
        any1 = fec1 % 704;
        anyo = any1;
        fec1 = fec1 % 402;
        fec2 = fec1;
    |SI fec2 = 1;
        mes = "Enero ....";
    |FINSI;
    |SI fec2 = 2;
        mes = "Febrero ..";
    |FINSI;
    |SI fec2 = 3;
        mes = "Marzo ....";
    |FINSI;
    |SI fec2 = 4;
        mes = "Abril ....";
    |FINSI;
    |SI fec2 = 5;
        mes = "Mayo .....";
    |FINSI;
    |SI fec2 = 6;
        mes = "Junio ....";
    |FINSI;
    |SI fec2 = 7;
        mes = "Julio ....";
    |FINSI;
    |SI fec2 = 8;
        mes = "Agosto ...";
    |FINSI;
    |SI fec2 = 9;
        mes = "Septiembre";
    |FINSI;
    |SI fec2 = 10;
        mes = "Octubre ..";
    |FINSI;
    |SI fec2 = 11;
        mes = "Noviembre ";
    |FINSI;
    |SI fec2 = 12;
        mes = "Diciembre ";
    |FINSI;
|SINO;
    dia = "..";
    mes = "..........";
    anyo = "....";
|FINSI;
|FPRC;

|PROCESO verifech; |TIPO 0;      || chequea una fecha alfanumerica de 10 pos.
                                 || PARAMETROS ENTRADA:  '#0Campo'
                                 || PARAMETROS SALIDA:   ERROR !!!
                                 || VARIABLES: D_
    fec = #0Campo; sw = 0;
|SI fec ! blanco; |Y fec ! puntos;
        dia1 = fec % A102;
        mes1 = fec % A402;
        any1 = fec % A704;
        dia = dia1;
        mes = mes1;
        any = any1;
    |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
        |SI mes [ 12; |Y mes ] 1;
            |SI mes=1;|O mes=3;|O mes=5;|O mes=7;|O mes=8;|O mes=10;|O mes=12;
                    tope = 31;
            |SINO;
                |SI mes = 2;
                         mod = any $ 4;
                    |SI mod = 0;
                            tope = 29;
                    |SINO;
                            tope = 28;
                    |FINSI;
                |SINO;
                        tope = 30;
                |FINSI;
            |FINSI;
            |SI dia [ tope;
                    sw = 1;
            |FINSI;
        |FINSI;
    |FINSI;
|SINO;
        sw = 1;
|FINSI;
|SI sw = 0;
    |MENAV men1;
    |ERROR;
|FINSI;
|FPRC;
