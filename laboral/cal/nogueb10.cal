|FICHEROS;
     labcentr;
     nomauxi1;
     nomauxi2;
     nogue001 #30;
     nomxpara #32;
     nogue016 #16;
|FIN;

|VARIABLES;
     nCampo1 = 0;
     aRaizMacro = "";
     aNombreMacro = "";
     nLinea = 0;
     aValor = "";
     aHojaExcel = "";
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";
     aPath = "";
     {1}aVersion = "";
     aLongitud = "";
     nLongitud = 0;
     aPos = "";
     nPos = 0;
     nCaracter = 0;
     aCaracter = "";
     nCampo = 0;
     aHoja = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     nNume = 0;
     fFecha = @;
     nCol = 0;
     &enColumnas = 0;
     &enInforme = 0;
     &dmes = 0;
     &hmes = 0;
     &peri = 0;
     &linea = 0;
     aResultado = "";
     LETRAS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
     aLetra = "";
     nCold = 0;
     nResto = 0;
     nLetras = 0;
     i = 0;
|FIN;


|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO Lineas_Macro;
     aAlfa = "A" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "B" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "C" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "D" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "E" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
|FPRC;

|PROCESO TotalesSUBRAYADO;
     || Subrayado

     aRaizMacro = "Módulo1.";
     aNombreMacro = "Subrayado";

     |HAZ Lineas_Macro;
|FPRC;

|PROCESO TotalesNEG;
     || totales en Negrita, las lineas del total

     aRaizMacro = "Módulo1.";
     aNombreMacro = "Negrita";

     |HAZ Lineas_Macro;
|FPRC;

|PROCESO TotalesGRISNEG;
     || totales en Gris y negrita, las lineas del total

     aRaizMacro = "Módulo1.";
     aNombreMacro = "Gris_Negrita";

     |HAZ Lineas_Macro;
|FPRC;

|PROCESO Cabecera;
|FPRC;

|PROCESO Cabecera_Emp;
     nLinea = 1;
     |HAZ TotalesSUBRAYADO;

     nLinea = 1;
     aValor = "40 Cargo 50 Abono";
     aAlfa = "A" + nLinea + ","  + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aValor = "Ctas. Contables";
     aAlfa = "B" + nLinea + ","  + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aValor = "Importes";
     aAlfa = "D" + nLinea + ","  + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aValor = "Centros de Coste";
     aAlfa = "C" + nLinea + ","  + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

||     aValor = "Descripción concepto";
||     aAlfa = "E" + nLinea + ","  + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
|FPRC;

|PROCESO Linea_Excel;
     nLinea = nLinea + 1;
     aAlfa = "A" + nLinea + "," + #16#0; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "B" + nLinea + "," + #16#1; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + #16#2; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + #16#4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
|FPRC;

|PROCESO Excel_Inicio;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;

     aHojaExcel = "exportacion_sap.xls";

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "documentos/" + aHojaExcel;
     aDestinoTrab = "C:\DOCUMENTOS";         |RMKDIR aDestinoTrab;
     aDestino = aDestinoTrab + "\trabajo.xls";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDestino;

     aHoja = "Hoja1";
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aHoja;

     |HAZ Cabecera;
|FPRC;

|PROCESO Excel_Fin;
     aAlfa   = aDestinoTrab + "\" + aHojaExcel;
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;
     aResultado = aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
     |DESCARGADLL "agixl97.dll";

     aDestino   = aDestinoTrab + "\trabajo.xls";
     |RFBORRA aDestino;
         aVersion1 = "Excel.Sheet";
         |ESPECIFICA "VERSION_PROGRAMA", aVersion;
         |HAZ ExtraePath;
         |SI aPath = "NO LOCALIZADO";
             |MENAV "    ATENCION. No se ha encontrado la hoja Excel.";
             |ACABA;
         |FINSI;

         |QBF aPath;

     ||aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aResultado + &34;
     |RSYSTEM aAlfa;
|FPRC;
