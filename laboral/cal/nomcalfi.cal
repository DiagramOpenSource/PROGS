|FICHEROS;
    nomcalfi #0;       || def calculo
    labempre #1;       || empresas
    labtraba #2;       || trabajadores
    nomconli #10;      || convenios lins.
    nomcalca #11;      || tmp. calculos cabs.
    nomcalli #12;      || tmp. calculos lins.
    nomconst #15;      || constantes
    nombonif #16;      || bonificaciones
    nomcalca #30;      || destino calculos cabs.
    nomcalli #31;      || destino calculos lins.
    nomcontr #32;      || control aplicacion
    nomcones #35;      || cotizacion especial R.D.-Ley 18/93
    nomnotay #36;      || centros notarias/ayuntamientos
    nomtraca #101;  || trabajadores cabs.
     nombotra;
     nomboni3;
     nomvarca;
     nomvarli;
     nomhicca;
     nompanta;
     nomcalcc;
     &copiadef@ #500;
     nomconca;
     motibaja;
|FIN;

|VARIABLES;
    &dcoti_0 = 0;
    &bon_1 = 0;
    &bon_2 = 0;
    &seleccio = 0;
    &grupo = 0;
    &hcobr_0 = 0;
    &hcoti_0 = 0;
    &tp = 0;
    &propo = 0;
    &es_aprendi = 0;
    &es_parcial = 0;
    &es_irregul = 0;
    &sw_mater = 0;
    &epig_ilt = 0;
    &epig_ims = 0;
    &dboni_1 = 0;
    &dboni_2 = 0;
    &dmate_2 = 0;
    &prom_enf = 0;
    &prom_acc = 0;
    &swfuera = 0;
    &topesmi = 0;

    fecsys = @;
    alfa1 = "";
    nume0 = 0;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    &concepto = 0;
    &bon_0 = 0;
    &zbon_0 = 0;
    bon_3 = 0;
    &zbon_3 = 0;
    bon_5 = 0;
    zbon_5 = 0;
    acum_10 = 0;
    dvalo_pro = 0;
    exce_smi = 0;
    &coba_1 = 0;
    &coba_2 = 0;
    &coba_3 = 0;
    &coba_4 = 0;
    &cobb_1 = 0;
    &cobb_2 = 0;
    &cobb_3 = 0;
    &cobb_4 = 0;
    &base_5 = 0;
    &base_6 = 0;
    &base_7 = 0;
    mensaje0 = "    Seleccion vacia ...";
    dacum_30 = 0;
    dacum_31 = 0;
    acum_30 = 0;
    acum_31 = 0;
    swajuen = 0;
    swajuac = 0;
    campomax = 0;
    campomin = 0;
    coti_0 = 0;
    coti_1 = 0;
    coti_2 = 0;
    horastp = 0;
    convenio = 0;
    fijo_1 = 0;
    unidades = 0;
    gua_i = 0;
    tpz = 0;
    por1_cont = 0;
    por1_dfpg = 0;
    por1_hor1 = 0;
    por1_hor2 = 0;
    por2_cont = 0;
    por2_dfpg = 0;
    por2_hor1 = 0;
    por2_hor2 = 0;
    base_8 = 0;
    base_9 = 0;
    zbase_9 = 0;
    &base_A = 0;
    &zbase_A = 0;
    base_B = 0;
    zbase_B = 0;
    base_C = 0;
    zbase_C = 0;
    base_D = 0;
    &base_E = 0;
    &base_F = 0;
    &zbase_F = 0;
    base_G = 0;
    notaria = 0;
    lin_1 = 0;
    lin_2 = 0;
    CodigoCons = 0;
    &nPorBon1 = 0;
    &nPorBon2 = 0;
    nRecAy = 0;
    nEl36 = 0;
    &EURODB = 0;

    &base_AB = 0;
    base_M = 0;
    base_N = 0;
    base_MN = 0;
    &zbase_AB = 0;
    zbase_M = 0;
    zbase_N = 0;
    zbase_MN = 0;
    bon_60 = 0;
    por_bon_60 = 0;
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    alfa5 = "";
    alfa6 = "";
    alfa7 = "";
    nume6 = 0;
    nume7 = 0;
    por_bon_16 = 0;
    fecha_bon_16 = "";
    &guarda = 0;
    &dias_vac = 0;

     &nMes = 0;
     nDiasBonBaja = 0;
     nAltaBonif = 0;
     nBajaBonif = 0;
     nDia = 0;
     nBaja = 0;
     nInicioBaja = 0;
     nFinBaja = 0;
     nDiasBaja = 0;
     aFechaRef = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";

     &nElMes = 0;         || para el calculo de finiquitos
     &nElAny = 0;         || para el calculo de finiquitos
     &nElMesIRPF = 0;         || para 'nomir008'
     &nElAnyIRPF = 0;         || para 'nomir008'

     &nDiferencias = 0;   || para 'nomir008'
     &swFiniq = 0;
     &nEmp = 0;
     &nTra = 0;
     &eaVengoDe = "nomcalcu";
     &nConcepFV = 0;
     &aDescripFV = "";
     &nUnidFV = 0;
     &nImporFV = 0;
     &fCFecha = @;
     &nCConst = 0;
     &aCError = "";

     tp1 = 0;
     tp2 = 0;
     tp3 = 0;
     tpx = 0;
     &nTip = 0;

     nBonifFCI = 0;
     nBonifTex = 0;
     &nAny = 0;
     fFechaIniBon = @;
     fFechaFinBon = @;
     fFecha = @;
     nFecha = 0;
     nDiasBon = 0;
     aParam = "";
     &aFechaFIN = "";
     &nVacac = 0;
     &nSSVacac = 0;
     &nPaga1 = 0;
     &nPaga2 = 0;
     &nIndem = 0;
     &nDiasVacac = 0;

     nEdadParaBon = 0;
     nAnysParaAnt = 0;
     any_ini_bon = 0;
     fecha_ini_bon = @;
     nume8 = 0;
     nume9 = 0;
     nume16 = 0;
     aEPBon = "";
     bon_59 = 0;
     nMesesBon16 = 0;
     nAnyosBon16 = 0;
     nPB16Calc = 0;
     bon_55 = 0;
     &nRetEstAnu = 0;
     aDatos = "";
     &enEmpresa = 0;
     &enTrabajador = 0;
     nBonif = 0;
     swSinAct = 0;
     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nMesAUTO = 0;
     &nAnyAUTO = 0;
     nBonCC = 0;
     swNoSigas = 0;
     swSigue = 0;
     &nConceptoInd = 0;
     swCambiaInd = 0;
     nUniInd = 0;
     nValInd = 0;
     nImpInd = 0;
     nBase = 0;
     nUltimoDia = 0;
     aFechaBaja = "";
     fFechaBaja = @;
     nNume = 0;
     dto_con = 0;
     dto_dfp = 0;
     base_E_formacion = 0;
     nBonifForEmp = 0;
     nBonifForTra = 0;
     &swAgosto2012 = 0;
     nEdad = 0;
     FEstado = 0;

     dto_sol_emp = 0;
     dto_sol_tra = 0;
     nPorcFormacion = 0;
     &nAnysIndem = 0;
     fFecha1 = @;
     fFecha2 = @;
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     &nTopemes = 0;
     &nLabornet = 0;
     &nCon1_Labornet = 0;
     &nCon2_Labornet = 0;
     &nCon3_Labornet = 0;
     &nVal1_Labornet = 0;
     &nVal2_Labornet = 0;
     &nVal3_Labornet = 0;
     &nPreavisoAbo = 0;
     &nPreavisoDto = 0;
     nConcepto = 0;
     nValor = 0;
     nCampoCon = 0;
     &nValorPreaviso = 0;
     swIntro = 0;
     nHoras = 0;

     nPaga = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     nCampo4 = 0;
     nDias = 0;
     nSubeDiaVac = 0;
     swCalVaca = 0;
     nDiasCot = 0;

     nDiasCuenta = 0;
     nMesBusca = 0;
     nMesesPaga = 0;
     nDesdeMesPaga = 0;
     nHastaMesPaga = 0;
     nDiasPagaComp = 0;
     aDescripcion = "";
     &nLiquidoNom = 0;
     &swFiniquito = 0;
     &nEmpEmb = 0;
     &nTraEmb = 0;
     &nEmbargo = 0;
     &nIRPF = 0;
     &nInd410 = 0;  || con IRPF
     &nInd415 = 0;  || sin IRPF
     &nNroErrores = 0;             || log
|FIN;

|INCLUYE i_finiq;
||INCLUYE i_verif;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO mirames; |TIPO 7;
|SI de_vuelta = 1;  |ACABA;  |FINSI;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO defecto; |TIPO 7;
|SI de_vuelta = 1;  |ACABA;  |FINSI;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO sientra; |TIPO 0;
|SI de_vuelta = 1;  |ACABA;  |FINSI;
|SI #1#39 = "1";|O #1#39 = " ";
    |MENAV "    ATENCION !!! Empresa definida con clave finiquito '1' ...";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO checkcon; |TIPO 0;
     aDescripcion = "";
     |SI #0Campo ! 0;
          swSigue = 0;
          |SI #0Campo < 401; |O #0Campo > 430;
               |SI #0Campo ! 965;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI nLabornet = 1;
               swSigue = 0;
          |FINSI;
          |SI #0Campo = 965;
               || nValorPreaviso = 0;
               || HAZ RestosPreaviso;
               aDescripcion = "PREAVISO";
               |SI nValorPreaviso ! 0;
                    swIntro = 1;
                    nConcepto = 965;
                    nValor = nValorPreaviso;
                    |HAZ ConcLab;
               |FINSI;
          |FINSI;
          |SI swSigue = 1;
               |MENAV "    ATENCION !!! Concepto fuera de rango (401-430) ...";
               |ERROR;
          |SINO;
               |SI Campo = 77;
                    |CAMPO_MODIFICA #0#34, 1, "S";
                    |CAMPO_MODIFICA #0#47, 1, "S";
                    #0#21 = aDescripcion; |PINTA #0#21;
               |FINSI;
               |SI Campo = 78;
                    |CAMPO_MODIFICA #0#35, 1, "S";
                    |CAMPO_MODIFICA #0#48, 1, "S";
                    #0#22 = aDescripcion; |PINTA #0#22;
               |FINSI;
               |SI Campo = 79;
                    |CAMPO_MODIFICA #0#36, 1, "S";
                    |CAMPO_MODIFICA #0#49, 1, "S";
                    #0#23 = aDescripcion; |PINTA #0#23;
               |FINSI;
               |SI Campo = 94;
                    |CAMPO_MODIFICA #0#97, 1, "S";
                    |CAMPO_MODIFICA #0#98, 1, "S";
                    #0#95 = aDescripcion; |PINTA #0#95;
               |FINSI;
               |SI Campo = 100;
                    |CAMPO_MODIFICA #0#103, 1, "S";
                    |CAMPO_MODIFICA #0#104, 1, "S";
                    #0#101 = aDescripcion; |PINTA #0#101;
               |FINSI;
          |FINSI;
     |SINO;
          |SI Campo = 77;
               |SI #0#90=0;  #0#63=#0#63-#0#60;                      |FINSI;
               |SI #0#90=1;  #0#64=#0#64-#0#60;  #0#70=#0#64%#0#67;  |FINSI;
               |SI #0#90=2;  #0#65=#0#65-#0#60;  #0#71=#0#65%#0#68;  |FINSI;
               |SI #0#90=3;  #0#66=#0#66-#0#60;  #0#72=#0#66%#0#69;  |FINSI;
               #0#21 = ""; #0#34 = 0; #0#47 = 0; #0#60 = 0; #0#90 = 1;
               |CAMPO_MODIFICA #0#34, 1, "N";
               |CAMPO_MODIFICA #0#47, 1, "N";
          |FINSI;
          |SI Campo = 78;
               |SI #0#91=0;  #0#63=#0#63-#0#61;                      |FINSI;
               |SI #0#91=1;  #0#64=#0#64-#0#61;  #0#70=#0#64%#0#67;  |FINSI;
               |SI #0#91=2;  #0#65=#0#65-#0#61;  #0#71=#0#65%#0#68;  |FINSI;
               |SI #0#91=3;  #0#66=#0#66-#0#61;  #0#72=#0#66%#0#69;  |FINSI;
               #0#22 = ""; #0#35 = 0; #0#48 = 0; #0#61 = 0; #0#91 = 1;
               |CAMPO_MODIFICA #0#35, 1, "N";
               |CAMPO_MODIFICA #0#48, 1, "N";
          |FINSI;
          |SI Campo = 79;
               |SI #0#92=0;  #0#63=#0#63-#0#62;                      |FINSI;
               |SI #0#92=1;  #0#64=#0#64-#0#62;  #0#70=#0#64%#0#67;  |FINSI;
               |SI #0#92=2;  #0#65=#0#65-#0#62;  #0#71=#0#65%#0#68;  |FINSI;
               |SI #0#92=3;  #0#66=#0#66-#0#62;  #0#72=#0#66%#0#69;  |FINSI;
               #0#23 = ""; #0#36 = 0; #0#49 = 0; #0#62 = 0; #0#92 = 1;
               |CAMPO_MODIFICA #0#36, 1, "N";
               |CAMPO_MODIFICA #0#49, 1, "N";
          |FINSI;
          |SI Campo = 94;
               |SI #0#96=0;  #0#63=#0#63-#0#99;                      |FINSI;
               |SI #0#96=1;  #0#64=#0#64-#0#99;  #0#70=#0#64%#0#67;  |FINSI;
               |SI #0#96=2;  #0#65=#0#65-#0#99;  #0#71=#0#65%#0#68;  |FINSI;
               |SI #0#96=3;  #0#66=#0#66-#0#99;  #0#72=#0#66%#0#69;  |FINSI;
               #0#95 = ""; #0#97 = 0; #0#98 = 0; #0#99 = 0; #0#96 = 1;
               |CAMPO_MODIFICA #0#97, 1, "N";
               |CAMPO_MODIFICA #0#98, 1, "N";
          |FINSI;
          |SI Campo = 100;
               |SI #0#102=0;  #0#63=#0#63-#0#105;                      |FINSI;
               |SI #0#102=1;  #0#64=#0#64-#0#105;  #0#70=#0#64%#0#67;  |FINSI;
               |SI #0#102=2;  #0#65=#0#65-#0#105;  #0#71=#0#65%#0#68;  |FINSI;
               |SI #0#102=3;  #0#66=#0#66-#0#105;  #0#72=#0#66%#0#69;  |FINSI;
               #0#101 = ""; #0#103 = 0; #0#104 = 0; #0#105 = 0; #0#102 = 1;
               |CAMPO_MODIFICA #0#103, 1, "N";
               |CAMPO_MODIFICA #0#104, 1, "N";
          |FINSI;
          #0#73 = (#0#63+#0#64+#0#65+#0#66) - (#0#70+#0#71+#0#72+#0#76-nValorPreaviso); ||liquido
          |SI #0#73 < 0; #0#73 = 0; |FINSI;
          |SI aParam = ""; |O aDatos = "CPAN";
               |PINDA #0#0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO despu_uni_nue; |TIPO 0;
     |SI ant_uni ! #0Campo; |O swCambiaInd = 1;
          nume1 = Campo + 1;   || puntero valor
          nume2 = Campo + 2;   || puntero importe
          nume3 = Campo - 1;   || puntero tipo
          #0nume2 = #0nume2 * (-1);
          |HAZ actual;
          #0nume2 = #0Campo * #0nume1;
          |HAZ actual;
          |SI aParam = ""; |O aDatos = "CPAN";
               |PINDA #0#0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO despu_val_nue; |TIPO 0;
     |SI ant_val ! #0Campo; |O swCambiaInd = 1;
          nume1 = Campo - 1;   || puntero unidades
          nume2 = Campo + 1;   || puntero importe
          nume3 = Campo - 2;   || puntero tipo
          #0nume2 = #0nume2 * (-1);
          |HAZ actual;
          #0nume2 = (#0Campo * #0nume1);
          |HAZ actual;
          |SI aParam = ""; |O aDatos = "CPAN";
              |PINDA #0#0;
          |FINSI;
     |FINSI;
|FPRC;

/*
|| este proceso ya no es necesario, ya que en el finiquito, el valor del
|| preaviso es el resto que no se haya podido pagar en la nomina de finiquito

|PROCESO ValorPreaviso;
     |PARA nCampoCon = 77; |SI nCampoCon [ 79; |HACIENDO nCampoCon = nCampoCon + 1;
          |SI #0nCampoCon = 965;
               nume4 = nCampoCon - 43;
               nume5 = nCampoCon - 30;
               nume6 = nCampoCon - 17;

               #0nume5 = #12#10;
               #0nume6 = #0nume4 * #12#10;

               |PINTA #0nume5;
               |PINTA #0nume6;

               Campo = nume4;
               nume1 = Campo + 13;   || puntero valor
               nume2 = Campo + 26;   || puntero importe
               nume3 = Campo + 56;   || puntero tipo
               #0nume2 = #0Campo * #0nume1;
               |HAZ actual;
          |FINSI;
     |SIGUE;
     |PARA nCampoCon = 94; |SI nCampoCon [ 100; |HACIENDO nCampoCon = nCampoCon + 6;
          |SI #0nCampoCon = 965;
               nume4 = nCampoCon + 3;
               nume5 = nCampoCon + 4;
               nume6 = nCampoCon + 5;

               #0nume5 = #12#10;
               #0nume6 = #0nume4 * #12#10;

               |PINTA #0nume5;
               |PINTA #0nume6;

               Campo = nume4;
               nume1 = Campo + 1;   || puntero valor
               nume2 = Campo + 2;   || puntero importe
               nume3 = Campo - 1;   || puntero tipo
               #0nume2 = #0Campo * #0nume1;
               |HAZ actual;
          |FINSI;
     |SIGUE;
|FPRC;
*/
|PROCESO LineaConcepto;
     #0nume1 = nConcepto;
     |DDEFECTO #10;
     #10#0 = #2#87;
     #10#2 = nConcepto;
     |LEE 000#10=;
     #0nume2 = #10#6;
     |SI nConcepto = 965; #0nume2 = "PREAVISO"; |FINSI;
     #0nume3 = #10#8;
     |SI nConcepto = 965; #0nume3 = 0; |FINSI;
     #0nume4 = 1;
     |SI nConcepto = 965; #0nume4 = -1; |FINSI;
     #0nume5 = nValor;
     #0nume6 = #0nume4 * nValor;
|FPRC;

|PROCESO ConcLab;
     |PARA nume1 = 77; |SI nume1 [ 79; |HACIENDO nume1 = nume1 + 1;
          |SI #0nume1 = 0; |O swIntro = 1;
               nume1 = nume1;
               nume2 = nume1 - 56;
               nume3 = nume1 + 13;
               nume4 = nume1 - 43;
               nume5 = nume1 - 30;
               nume6 = nume1 - 17;

               |HAZ LineaConcepto;

               Campo = nume4;
               nume1 = Campo + 13;   || puntero valor
               nume2 = Campo + 26;   || puntero importe
               nume3 = Campo + 56;   || puntero tipo
               nume16 = Campo;       || puntero unidades
               #0nume2 = #0Campo * #0nume1;
               |HAZ actual;

               |ACABA;
          |FINSI;
     |SIGUE;
     |PARA nume1 = 94; |SI nume1 [ 100; |HACIENDO nume1 = nume1 + 6;
          |SI #0nume1 = 0; |O swIntro = 1;
               nume1 = nume1;
               nume2 = nume1 + 1;
               nume3 = nume1 + 2;
               nume4 = nume1 + 3;
               nume5 = nume1 + 4;
               nume6 = nume1 + 5;

               |HAZ LineaConcepto;

               Campo = nume4;
               nume1 = Campo + 1;   || puntero valor
               nume2 = Campo + 2;   || puntero importe
               nume3 = Campo - 1;   || puntero tipo
               #0nume2 = #0Campo * #0nume1;
               |HAZ actual;

               |ACABA;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO RestosPreaviso;
/*
     nValorPreaviso = 0;

     |ABRE #30;
     #30#0 = #0#0;
     #30#1 = #0#1;             || lee origen
     #30#2 = #0#8;
     #30#3 = 0;
     |LEE 000#30=;
     |SI FSalida = 0;
          |SI #30#199 ! 0; |Y #30#113 = 0;
               || preaviso y liquido a cero
               |ABRE #31;
               #31#0 = #0#0;
               #31#1 = #0#1;
               #31#2 = #0#8;
               #31#3 = 0;
               #31#4 = 965;
               |LEE 000#31=;
               |SI FSalida = 0;
                    nNume = #31#10 * #31#11;
                    |SI #30#199 ! nNume;
                         nValorPreaviso = #30#199 - nNume;
                    |FINSI;
               |FINSI;
               |CIERRA #31;
          |FINSI;
     |FINSI;
     |CIERRA #30;
*/
|FPRC;

|PROCESO ConceptosLabornet;
     swIntro = 0;
     |SI nCon1_Labornet ! 0;
          nConcepto = nCon1_Labornet;
          nValor = nVal1_Labornet;
          |HAZ ConcLab;
     |FINSI;
     |SI nCon2_Labornet ! 0;
          nConcepto = nCon2_Labornet;
          nValor = nVal2_Labornet;
          |HAZ ConcLab;
     |FINSI;
     |SI nCon3_Labornet ! 0;
          nConcepto = nCon3_Labornet;
          nValor = nVal3_Labornet;
          |HAZ ConcLab;
     |FINSI;
     Campo = 24;
     |PINDA #0#0;
|FPRC;

|PROCESO muestra; |TIPO 0;
     |SI de_vuelta = 1;  |ACABA;  |FINSI;
     |SI #2#48 ! "N";
          |SI #2#44 ! "B";
               |HAZ otros1;
               |HAZ otros2;
               |ABRE #10;
               |PARA nume1 = 11; |SI nume1 [ 18; |HACIENDO nume1 = nume1 + 1;
                    nume2 = nume1 + 190;
                    nume3 = nume1 + 69;
                    |HAZ leelin;
               |SIGUE;
               |SI #32#1 = "S";  vac = 125;  |FINSI;     || vacaciones cotiz.
               |SI #32#1 = "N";  vac = 409;  |FINSI;     || vacaciones no cotiz.
               |PINTA 1603, vac;

               |ABRE #nomvarca;
               #nomvarca#0 = #labtraba#0;
               #nomvarca#1 = #labtraba#1;
               #nomvarca#2 = #0#8;
               #nomvarca#3 = 0;
               |LEE 000#nomvarca.=
               |SI FSalida = 0;
                    |SI #nomvarca#46 = 93;
                         ind = 410;
                    |SINO;
                         ind = 415;
                    |FINSI;
               |SINO;
                    ind = 415;
               |FINSI;
               |CIERRA #nomvarca;

               ||SI #32#13 = "S"; ind = 410;  |FINSI;     || indem. con IRPF
               ||SI #32#13 = "N"; ind = 415;  |FINSI;     || indem. sin IRPF

               |PINTA 1703, ind;
               nume1 = 19; nume2 = vac; nume3 = 88; |HAZ leelin; || vacaciones
               nume1 = 20; nume2 = ind; nume3 = 89; |HAZ leelin; || indemnizacion
               |SI #32#59 = "S"; || preguntamos antes
                    aAlfa = "   ";
                    |PINTA 1703, aAlfa;
                    #0#20 = ""; |PINTA #0#20;
               |FINSI;
               |SI nLabornet = 1;
                    |HAZ ConceptosLabornet;
               |FINSI;
               || nValorPreaviso = 0;
               || HAZ RestosPreaviso;
               |CIERRA #10;
          |SINO;
               |MENAV "    ATENCION!!! Trabajador en situacion BAJA ...";
               |ERROR;
          |FINSI;
     |SINO;
          |MENAV "    ATENCION!!! Trabajador sin finiquito ...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO leelin;
|SI nume2 = nConcepFV;
     |ACABA;
|FINSI;
    #10#0 = #2#87;
    #10#2 = nume2;
|LEE 001#10=;
|SI FSalida ! 0;
        #0nume1 = "--------";
        #0nume3 = 1;
|SINO;
        #0nume1 = #10#6;
        #0nume3 = #10#8;
|FINSI;
|SI #10#2 ] 411;|Y #10#2 [ 420;
        #0nume3 = 0;
|FINSI;
|PINTA #0nume1;
|PINTA #0nume3;
|FPRC;

|PROCESO leeconv; |TIPO 0;
|SI #0Campo ] 401;|Y #0Campo [ 420;
    |ABRE #10;
        nume1 = Campo - 56;
        nume2 = #0Campo;
        nume3 = Campo + 13;
    |HAZ leelin;
    |CIERRA #10;
|FINSI;
|FPRC;

|PROCESO antes_uni; |TIPO 7;
    ant_uni = #0Campo;
|FPRC;

|PROCESO antes_val; |TIPO 7;
    ant_val = #0Campo;
|FPRC;

|PROCESO despu_uni; |TIPO 0;
     |SI ant_uni ! #0Campo; |O swCambiaInd = 1;
          nume16 = Campo;       || puntero unidades
          nume1 = Campo + 13;   || puntero valor
          nume2 = Campo + 26;   || puntero importe
          nume3 = Campo + 56;   || puntero tipo
          #0nume2 = #0nume2 * (-1);
          |HAZ actual;
          #0nume2 = #0Campo * #0nume1;
          |HAZ actual;
          |SI aParam = ""; |O aDatos = "CPAN";
               |PINDA #0#0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO despu_val; |TIPO 0;
|SI ant_val ! #0Campo; |O swCambiaInd = 1;
        nume1 = Campo - 13;   || puntero unidades
        nume2 = Campo + 13;   || puntero importe
        nume3 = Campo + 43;   || puntero tipo
        #0nume2 = #0nume2 * (-1);
    |HAZ actual;
        #0nume2 = (#0Campo * #0nume1);
    |HAZ actual;
    |SI aParam = ""; |O aDatos = "CPAN";
        |PINDA #0#0;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO t_parcial;                || proporcion tiempo parcial
     tp1 = 40;
     tp2 = 40;
     tpx = -1;

     |ABRE #nomconca;
     #nomconca#0 = #labtraba#87;
     |SI FSalida = 0;
          |SI #nomconca#162 ! 0;
               tp2 = #nomconca#162;
          |FINSI;
     |FINSI;
     |CIERRA #nomconca;

     es_parcial = 0;
     |SI #2#42 = "X";|O #2#42 = "T";|O #2#42 = "P";
          es_parcial = 1;
          |SI #2#234 ! 0;  tp1 = #2#234;  |FINSI;
          concepto = 910; |HAZ t_parcial2; |SI tp3 ! -1; tp1 = tp3; |FINSI;
          concepto = 912; |HAZ t_parcial2; |SI tp3 ! -1; tp1 = tp3; |FINSI;

          concepto = 909; |HAZ t_parcial2; |SI tp3 ! -1; tp2 = tp3; |FINSI;
          concepto = 911; |HAZ t_parcial2; |SI tp3 ! -1; tp2 = tp3; |FINSI;
          tp = (tp1 / tp2) ! 3;
     |FINSI;

     es_irregul = 0;
     |SI #2#42 = "I";|O #2#42 = "P";
          tp = (tp1 / tp2) ! 3;
          concepto = 914; |HAZ t_parcial2; |SI tp3 ! -1; tpx = tp3; |FINSI;
          es_irregul = 1;
          |SI tpx ! -1;  tpz = tpx;  |SINO;  tpz = #2#46;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO t_parcial2;
     tp3 = -1;
/*
     |ABRE #4;
     #4#0 = #2#87; #4#1 = #2#17; #4#2 = concepto;
     |LEE 000#4=;
     |SI FSalida = 0; tp3 = #4#3; |FINSI;
     |CIERRA #4;

     |ABRE #6;
     #6#0 = #2#0;  #6#1 = #2#1;  #6#2 = concepto;
     |LEE 000#6=;
     |SI FSalida = 0; tp3 = #6#3; |FINSI;
     |CIERRA #6;

     |ABRE #8;
     #8#0 = #2#0;  #8#1 = #2#1;  #8#2 = #0#8;  #8#3 = 0;  #8#4 = concepto;
     |LEE 000#8=;
     |SI FSalida = 0; tp3 = #8#5; |FINSI;
     |CIERRA #8;
*/
|FPRC;

|PROCESO topes_antes;
     |SI #labtraba#45 = "421";
          |ACABA;
     |FINSI;

     || topes_cc;

     |SI #32#1 = "N"; |ACABA; |FINSI;

     |SI #0#75 [ 0; |O #0#93 [ 0;
          dias_vac = 0;
          |ACABA;
     |FINSI;

     grupo = #labtraba#33;
     |SI #0#77 = 421;
          dias_vac = #0#34;
     |SINO;
          dias_vac = #0#32;
     |FINSI;
     dias_vac = (dias_vac + 0.49) ! 0;
     campomax = grupo + 35;  coti_1 = #15campomax * dias_vac; ||maximo C.C.
     campomin = grupo + 23;  coti_0 = #15campomin * dias_vac; ||minimo C.C.

     tp = 1;

     |HAZ t_parcial;

     |SI es_parcial = 1;
          coti_0 = (coti_0 * tp) ! 2;
     |FINSI;

     coti_0 = coti_0 ! EURODB; || maximo C.C.
     coti_1 = coti_1 ! EURODB; || maximo C.C.

     |SI coti_0 ] #0#75;
          #0#75 = coti_0;
     |FINSI;

     |SI coti_1 [ #0#75;  #0#75 = coti_1;  swajuen = 1;  |FINSI;

     || topes_cp;

     |SI #32#1 = "N"; |ACABA; |FINSI;

     coti_0 = #15#20 * dias_vac;                         || maximo A.T.
     |SI grupo = 12; coti_1 = #15#22 * dias_vac;  |FINSI;    || minimo A.T.
     |SI grupo = 11; coti_1 = #15#21 * dias_vac;  |FINSI;
     |SI grupo < 11; coti_1 = #15#23 * dias_vac;  |FINSI;
     |SI nElMes = 1;
          || para controlar posible movida en febrero
          aAlfa = #nomcalca#5 % 102;
          nNume1 = aAlfa;
          nNume1 = 31 - nNume1;         || dias vac en enero
          nNume1 = dias_vac - nNume1;   || dias vac que saldran en febrero
          |SI nNume1 ] 28
               || ojo, en febrero todos los dias van a ir a la liquidacion
               || de vacaciones, eso quiere decir que el tope de cp tiene que
               || ir por 30 dias, cudado con esto, lo ajusto asi
               || para el minimo solamente

               coti_1 = coti_1 + (#15#23 * 2);
          |FINSI;
     |FINSI;

     |SI es_parcial = 1;
          coti_1 = (coti_1 * tp) ! 2;
     |FINSI;

     coti_0 = coti_0 ! EURODB; || maximo C.P.
     coti_1 = coti_1 ! EURODB; || maximo C.P.
     |SI #0#93 ] coti_0;   #0#93 = coti_0;   swajuac = 1;  |FINSI;

     |SI #0#93 [ coti_1;           || en los irregulares "I" la base minima
          #0#93 = coti_1;       ||/se normaliza despues de comparar
          |SI #2#42 ! "I";      swajuac = 1;   |FINSI;
     |FINSI;
|FPRC;

|PROCESO Formacion;
     nBonifForEmp = 0;
     nBonifForTra = 0;
     base_E_formacion = 0;    || inicializo var. de ss cargo empresa

     |SI grupo = 10; nBase = #15#33;    |FINSI;
     |SI grupo = 11; nBase = #15#34;    |FINSI;

     nDiasVacac = (#0#32 + 0.49) ! 0;

     nPorcFormacion = 75;
     |SI nElAny = 2013; |Y nElMes ] 11; nPorcFormacion = 100; |FINSI;
     |SI nElAny ] 2014; nPorcFormacion = 100; |FINSI;

     nBase = (nBase % nPorcFormacion) * nDiasVacac;
     #0#75 = nBase;
     #0#93 = nBase;

     |HAZ fechabaja;

     |SI #labtraba#42 = "D"; |O #labtraba#42 = "T";
          nUltimoDia = 31;
     |SINO;
          nUltimoDia = 30;
     |FINSI;

     aAlfa = aFechaBaja % 102;
     nNume = aAlfa;
     nNume = nNume + nDiasVacac;

     |SI nNume > nUltimoDia;  || hay que aplicar la cuota de los
                              || trabajadores de formacion

          || parte del trabajador

          #0#76 = #nomconst#83 + #nomconst#85;
          dto_con = #nomconst#83;
          dto_dfp = #nomconst#85;
          |SI #labtraba#190 = "S";
               #0#76 = #0#76 + #nomconst#91;
               dto_dfp = dto_dfp + #nomconst#91;
          |FINSI;
          |SI #labtraba#191 = "S";
               #0#76 = 0;
               dto_con = 0;
               dto_dfp = 0;
          |FINSI;

          || parte de la empresa

          base_E_formacion = #nomconst#82 + #nomconst#84;   || cc, fogasa, fp
          base_E_formacion = base_E_formacion + #nomconst#86 + #nomconst#87;

          |SI #labtraba#190 = "S";
               base_E_formacion = base_E_formacion + #nomconst#90;
          |FINSI;
          |SI #labtraba#191 = "S";
               base_E_formacion = 0;
               nBonifForEmp = #nomconst#82 + #nomconst#84 + #nomconst#90;
               nBonifForEmp = nBonifForEmp + #nomconst#86 + #nomconst#87;

               nBonifForTra = #nomconst#83 + #nomconst#85 + #nomconst#91;
          |FINSI;
          |SI nBase = 0;
               nBonifForEmp = 0;
               nBonifForTra = 0;
               || a ver, si es un finiquito de un trabajador en formacion
               || al que no le voy a pagar vacaciones, solo indemnizacion
               || en verdad no va a cotizar, por lo que no debe tener
               || bonificacion. Si la tiene grabada en el mantenimiento
               || hay un problema despues al hacer el lote y si se lanzan
               || "todas las empresas" sale esta, cuando no tendria por que
          |FINSI;
     |SINO;
          #0#76 = 0;
          dto_con = 0;
          dto_dfp = 0;
          base_E_formacion = 0;

          |SI #labtraba#191 = "S"; |Y nBase ! 0;
               base_E_formacion = 0;
               nBonifForEmp = #nomconst#82 + #nomconst#84 + #nomconst#90;
               nBonifForEmp = nBonifForEmp + #nomconst#86 + #nomconst#87;

               nBonifForTra = #nomconst#83 + #nomconst#85 + #nomconst#91;
          |FINSI;
     |FINSI;
     |PINTA #0#76;
|FPRC;

|PROCESO actual;
     |SI nume2 ] 50;|Y nume2 [ 57;  concepto = nume2 + 151;  |FINSI;
     |SI nume2 = 58;                concepto = vac;          |FINSI;
     |SI nume2 = 59;                concepto = ind;          |FINSI;
     |SI nume2 ] 60;|Y nume2 [ 62;
          nume4 = nume2 + 17;
          concepto = #0nume4;
     |FINSI;
     |SI nume2 = 99;|O nume2 = 105;
          nume4 = nume2 - 5;
          concepto = #0nume4;
     |FINSI;
     |SI concepto = 965;
          |SI #0nume16 < 0;
               || para que no vaya a IRPF si es negativo, que descuente al final
               #0nume3 = 0;
          |SINO;
               #0nume3 = 1;
          |FINSI;
     |FINSI;
     |SI concepto ] 411;|Y concepto [ 420;
          #0#63 = #0#63 + #0nume2;
     |SINO;
          |SI #0nume3=1;  #0#64=#0#64+#0nume2;  #0#70=#0#64%#0#67;  |FINSI;
          |SI #0nume3=2;  #0#65=#0#65+#0nume2;  #0#71=#0#65%#0#68;  |FINSI;
          |SI #0nume3=3;  #0#66=#0#66+#0nume2;  #0#72=#0#66%#0#69;  |FINSI;
     |FINSI;
     |SI concepto = 965;
          nValorPreaviso = #0nume2;
     |FINSI;
     |SI #32#1 = "S"; |Y #2#42 ! "H";
          #0#75 = #0#58;   || recalcula bases de cotizacion
          #0#93 = #0#58;
     |SINO;
          #0#75 = 0;
          #0#93 = 0;
     |FINSI;

     |SI #labtraba#45 = "421";
          |HAZ Formacion;
     |SINO;
          |SI #0#77 = 421;
               #0#75 = #0#60;
               #0#93 = #0#60;
          |FINSI;
          |HAZ topes_antes;
          #0#76 = (#0#75 % bon_1) + (#0#93 % bon_2);    || cuota cotizacion
     |FINSI;
     #0#73 = (#0#63+#0#64+#0#65+#0#66) - (#0#70+#0#71+#0#72+#0#76-nValorPreaviso);  ||liquido
     |SI #0#73 < 0; #0#73 = 0; |FINSI;
|FPRC;

|PROCESO activasino; |TIPO 0;
     |ABRE #1;
     #1#0 = #0#0;
     |LEE 000#1=;
     |SI #1#50 = "S";
          |MENAV "    Empresa no activa.";
          |ERROR;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO Aviso;
     aAlfa = "    ATENCION: Si tras calcular el finiquito cambia el tipo de IRPF, ";
     aAlfa = aAlfa + "es necesario volver a calcular la nómina del mes";
     |MENAV aAlfa;
     aAlfa = "    Si no se vuelve a calcular la nómina del mes, la retención aplicada podría ser ";
     aAlfa = aAlfa + "incorrecta.";
     |MENAV aAlfa;
     aAlfa = "    Además, si cambia el tipo de IRPF, debe volver a calcular el finiquito para ";
     aAlfa = aAlfa + "aplicar la retención correcta.";
     |MENAV aAlfa;
|FPRC;

|PROCESO BuscaFV;
     |SI nConcepFV ! 0;
          #0#77 = nConcepFV;
          #0#21 = aDescripFV;
          #0#90 = 1;
          #0#34 = nUnidFV;
          #0#47 = nImporFV;
          #0#60 = #0#34 * #0#47;

          #0#64=#0#64+#0#60;
          #0#70=#0#64%#0#67;

          #0#75 = #0#75 + #0#60;
          #0#93 = #0#93 + #0#60;
          #0#76 = (#0#75 % bon_1) + (#0#93 % bon_2);    || cuota cotizacion

          #0#73 = (#0#63+#0#64+#0#65+#0#66) - (#0#70+#0#71+#0#72+#0#76-nValorPreaviso); ||liquido
          |SI #0#73 < 0; #0#73 = 0; |FINSI;
    |SI aParam = ""; |O aDatos = "CPAN";
        |PINDA #0#0;
    |FINSI;
     |FINSI;
|FPRC;

|PROCESO Actualiza;
     swNoSigas = 0;
     |ABRE #nomhicca;
     #nomhicca#0 = #0#0;
     #nomhicca#1 = #0#1;
     #nomhicca#2 = #0#8 - 1;
     #nomhicca#3 = 0;
     #nomhicca#66 = #0#9 - 2000;
     |SI #0#8 = 1;
          #nomhicca#2 = 12;
          #nomhicca#66 = #0#9 - 2000 - 1;
     |FINSI;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          aAlfa = "    ATENCION. La nómina del mes anterior del trabajador ";
          aAlfa = aAlfa + " ya está actualizada en el histórico.";
          |MENAV aAlfa;
          aAlfa = "    Utilice la opción 'Finiquitos Mes Corriente' para calcular ";
          aAlfa = aAlfa + "el finiquito de este trabajador.";
          |MENAV aAlfa;
          swNoSigas = 1;
          |CIERRA #nomhicca
          |ACABA;
     |FINSI;
     |CIERRA #nomhicca;

     nEmpAUTO = #0#0;
     nTraAUTO = #0#1;
     nMesAUTO = #0#8 - 1;
     nAnyAUTO = #0#9;
     |SI nMesAUTO = 0;
          nMesAUTO = 12;
          nAnyAUTO = #0#9 - 1;
     |FINSI;
     |SUB_EJECUTA "nomactca;AUTO";

     |CIERRA #nomhicca;
|FPRC;

|PROCESO Desactualiza;
     nEmpAUTO = #0#0;
     nTraAUTO = #0#1;
     nMesAUTO = #0#8 - 1;
     nAnyAUTO = #0#9;
     |SI nMesAUTO = 0;
          nMesAUTO = 12;
          nAnyAUTO = #0#9 - 1;
     |FINSI;
     |SUB_EJECUTA "nomdesac;AUTO";
|FPRC;

|PROCESO LeeTipoCero;
     nValorPreaviso = 0;

     |ABRE #nomcalca;
     #nomcalca#0 = #0#0;
     #nomcalca#1 = #0#1;             || lee origen
     #nomcalca#2 = #0#8;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          |SI #nomcalca#199 ! 0; |Y #nomcalca#113 = 0;
               || preaviso y liquido a cero
               |ABRE #nomcalli;
               #nomcalli#0 = #0#0;
               #nomcalli#1 = #0#1;
               #nomcalli#2 = #0#8;
               #nomcalli#3 = 0;
               #nomcalli#4 = 965;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    nNume = #nomcalli#10 * #nomcalli#11;
                    |SI #nomcalca#199 ! nNume;
                         nValorPreaviso = #nomcalca#199 - nNume;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalli;
          |FINSI;
     |FINSI;
     |CIERRA #nomcalca;
|FPRC;

____________________________________/ CALCULO PRINCIPAL
|PROGRAMA;
     |HAZ LeeEURODB;
     aParam = PARAMETRO;
     |QBF aParam;
     |SI aParam ! "";
          |SI aParam = "SINACT";   || calculo de finiquito sin actualizar
               aParam = "";        || el mes
               swSinAct = 1;
          |FINSI;
     |FINSI;
     |SI aParam ! "";
          aAlfa = aParam % 105;    || empresa
          #0#0 = aAlfa;
          aAlfa = aParam % 605;    || trabajador
          #0#1 = aAlfa;
          aAlfa = aParam % 1102;   || mes
          #0#8 = aAlfa;
          aAlfa = aParam % 1304;   || a¤o
          #0#9 = aAlfa;
          aDatos = aParam % 1704;  || Pide Datos o no
     |FINSI;
     |SI de_vuelta = 0;
          |SI aParam = ""; |O aDatos = "CPAN";
               |DELINDEX #0;
               |CLS;
               |CABEZA "Calculo Finiquitos";
               |SI aDatos ! "CPAN";     || los datos me vienen de fuera
                    |DDEFECTO #0;       || del laborn02 y no quiero inicializar
               |FINSI;

               |PINPA #0#0;
               |PINDA #0#0;
               |SI aDatos ! "CPAN";     || los datos me vienen de fuera
                    |ET elcero;
                    |ENCAMPO #0#0;
                    |SI FSalida ! 1;|Y FSalida ! 7;

                         |ET eluno;
                         |ENCAMPO #1#0;
                         |SI FSalida = 2;|O FSalida = 4; |VETE elcero; |FINSI;
                         |SI FSalida ! 1;|Y FSalida ! 7;

                              |ET elocho;
                              |ENCAMPO #8#0;
                              |SI FSalida = 2;|O FSalida = 4; |VETE eluno; |FINSI;
                              |SI FSalida ! 1;|Y FSalida ! 7;
                                   |ENCAMPO #9#0;
                                   |SI FSalida = 2;|O FSalida = 4; |VETE elocho; |FINSI;
                                   |SI FSalida ! 1;|Y FSalida ! 7;
                                        |HAZ lectura1;
                                        de_vuelta = 1;
                                        nElMes = #0#8;
                                        nElAny = #0#9;
                                        |HAZ ValoresITIMS;
                                        |SI swSinAct = 1;
                                             |HAZ Actualiza;
                                             |SI swNoSigas = 1;
                                                  |ACABA;
                                             |FINSI;
                                        |FINSI;
                                        |HAZ LeeTipoCero;
                                        runnom = "nomcalfi";
                                        |SUB_EJECUTA ":laboral/nomcalfj";
                                        |SI swSinAct = 1;
                                             |HAZ Desactualiza;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |HAZ LeeTipoCero;
                    |HAZ muestra;
                    |HAZ lectura1;
                    de_vuelta = 1;
                    nElMes = #0#8;
                    nElAny = #0#9;
                    |HAZ ValoresITIMS;
                    runnom = "nomcalfi";
                    |SUB_EJECUTA ":laboral/nomcalfj";
               |FINSI;
          |SINO;
               |DELINDEX #0;
               |HAZ otros2;
               |SI #32#1 = "S";  vac = 125;  |FINSI;     || vacaciones cotiz.
               |SI #32#1 = "N";  vac = 409;  |FINSI;     || vacaciones no cotiz.
               ||SI #32#13 = "S"; ind = 410;  |FINSI;     || indem. con IRPF
               ||SI #32#13 = "N"; ind = 415;  |FINSI;     || indem. sin IRPF
               ||SI #32#59 = "S";
               ||     ind = nConceptoInd;
               ||FINSI;   || preguntamos antes

               |SI nConceptoInd ! 0;
                    ind = nConceptoInd;
               |SINO;
                    |ABRE #nomvarca;
                    #nomvarca#0 = #labtraba#0;
                    #nomvarca#1 = #labtraba#1;
                    #nomvarca#2 = #0#8;
                    #nomvarca#3 = 0;
                    |LEE 000#nomvarca.=
                    |SI FSalida = 0;
                         |SI #nomvarca#46 = 93;
                              ind = 410;
                         |SINO;
                              ind = 415;
                         |FINSI;
                    |SINO;
                         ind = 415;
                    |FINSI;
                    |CIERRA #nomvarca;
               |FINSI;

               |HAZ lectura1;
               de_vuelta = 1;
               fq_emp = #0#0;
               fq_tra = #0#1;
               fq_mes = #0#8;        || variables puente por el subejecuta
               fq_any = #0#9;
               nElMes = #0#8;
               nElAny = #0#9;
               |HAZ ValoresITIMS;
               runnom = "nomcalfi";
               |CORRE ":laboral/nomcalfj";
          |FINSI;
     |SINO;
          |SI swfuera = 0;
               |HAZ lectura2;
               |CAMPO_MODIFICA #0#0, 1, "N";
               |CAMPO_MODIFICA #0#1, 1, "N";
               |CAMPO_MODIFICA #0#8, 1, "N";
               |CAMPO_MODIFICA #0#9, 1, "N";
               |HAZ BuscaFV;

              || nValorPreaviso = 0;
               || HAZ RestosPreaviso;
               |SI nValorPreaviso ! 0;
                    swIntro = 0;
                    nConcepto = 965;
                    nValor = nValorPreaviso;
                    |HAZ ConcLab;
                    |PINDA #0#0;
               |FINSI;

               |SI aParam = ""; |O aDatos = "CPAN";
                    |ENDATOS #1#0;
               |SINO;
                    nPaga1 = #0#50;
                    nPaga2 = #0#51;
                    nVacac = #0#58;
                    nDiasVacac = #0#32;
                    nIndem = #0#59;
                    |HAZ graba1;
                    nSSVacac = base_E;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRO;

|PROCESO DiasCotizables;
     nMes = #0#8;
     nAny = #0#9;
     |HAZ topemes_plb;

     || nTopemes es el numero de dias del mes
     || en #30#8 tengo los dias de alta en la nomina normal del mes de baja

     aAlfa = #30#5;
     aAlfa = aAlfa % 102;
     nNume = aAlfa;

     nNume1 = nTopemes - nNume;     || dias disponibles

     |SI #0#77 = 421;
          dias_vac = #0#34;
     |SINO;
          dias_vac = #0#32;
     |FINSI;

     dias_vac = (dias_vac + 0.49) ! 0;

     |SI dias_vac [ nNume1;
          #30#171 = dias_vac;
          #30#172 = 0;
     |SINO;
          #30#171 = nNume1;
           #30#172 = dias_vac - nNume1;
     |FINSI;

     || esto por si le da a alguien por borrar en lugar de los dias de vacaciones
     || el importe, que los dias no pasen despues al mantenimiento
     |SI #0#58 = 0; |Y #0#60 = 0;
          #30#171 = 0;
          #30#172 = 0;
     |FINSI;
|FPRC;

____________________________________/ GRABACION DEL REGISTRO

|PROCESO graba2;
     |NOME_DAT #31 nomcalli;
     |ABRET #31;
     |PARA nume0 = 201; |SI nume0 [ 210; |HACIENDO nume0 = nume0 + 1;   || FIJOS
          nume1 = nume0;
          |SI nume0 = 209;  nume1 = vac;  |FINSI;  || vacaciones
          |SI nume0 = 210;  nume1 = ind;  |FINSI;  || indemnizacion
          nume2 = nume0 - 151;
          |SI #0nume2 ! 0;
               nume3 = nume0 - 164;     || puntero valor
               nume4 = nume0 - 177;     || puntero unidades
               nume5 = nume0 - 190;     || puntero descripcion
               concepto = nume1;
               |HAZ convenio_Fin;
               #31#00 = #11#00;
               #31#01 = #11#01;
               #31#02 = #11#02;
               #31#03 =      2;
               #31#04 =  nume1;
               #31#05 = #10#03;
               #31#06 = #10#04;
               #31#07 = #10#05;
               #31#08 = #0nume5;
               |SI nume1 ] 201;|Y nume1 [ 208;
                    #31#09 = 0;
               |SINO;
                    #31#09 = #0nume4;
               |FINSI;
               #31#10 = #0nume3;
               #31#11 = #0nume4;
               |GRABA 020#31n;
          |FINSI;
     |SIGUE;
     |PARA nume1 = 77; |SI nume1 [ 79; |HACIENDO nume1 = nume1 + 1;   || LIBRES
             nume2 = nume1 - 17;          || puntero importe
         |SI #0nume2 ! 0;
               nume3 = nume1 - 30;      || puntero valor
               nume4 = nume1 - 43;      || puntero unidades
               nume5 = nume1 - 56;      || puntero descripcion
               concepto = #0nume1;
               #31#00 = #11#00;
               #31#01 = #11#01;
               #31#02 = #11#02;
               #31#03 =      2;
               #31#04 = #0nume1;
               |SI concepto = 965; |O concepto = 966;
                    #31#05 = "V";
                    #31#06 = 0;
                    #31#07 = 20; || por ejemplo
               |SINO;
                    |HAZ convenio_Fin;
                    #31#05 = #10#03;
                    #31#06 = #10#04;
                    #31#07 = #10#05;
               |FINSI;
               #31#08 = #0nume5;
               #31#09 = #0nume4;
               #31#10 = #0nume3;
               #31#11 = #0nume4;
               |GRABA 020#31n;
          |FINSI;
     |SIGUE;
     |PARA nume1 = 94; |SI nume1 [ 100; |HACIENDO nume1 = nume1 + 6;   || LIBRES
          nume2 = nume1 + 5;          || puntero importe
          |SI #0nume2 ! 0;
               nume3 = nume1 + 4;      || puntero valor
               nume4 = nume1 + 3;      || puntero unidades
               nume5 = nume1 + 1;      || puntero descripcion
               concepto = #0nume1;
               #31#00 = #11#00;
               #31#01 = #11#01;
               #31#02 = #11#02;
               #31#03 =      2;
               #31#04 = #0nume1;
               |SI concepto = 965; |O concepto = 966;
                    #31#05 = "V";
                    #31#06 = 0;
                    #31#07 = 20; || por ejemplo
               |SINO;
                    |HAZ convenio_Fin;
                    #31#05 = #10#03;
                    #31#06 = #10#04;
                    #31#07 = #10#05;
               |FINSI;
               #31#08 = #0nume5;
               #31#09 = #0nume4;
               #31#10 = #0nume3;
               #31#11 = #0nume4;
               |GRABA 020#31n;
          |FINSI;
     |SIGUE;
     |CIERRAT #31;
|FPRC;

|PROCESO graba1; |TIPO 3;
     |HAZ ini_log;

     |NOME_DAT #30 nomcalca;
     |ABRET #30;
     #30#0 = #11#0;  || empresa
     #30#1 = #11#1;  || trabajador
     #30#2 = #0#8;   || mes
     #30#3 = 0;      || tipo de calculo (lee la base de cotizacion del mes)
     |LEE 001#30=;
     |SI FSalida ! 0;
          base_mes1 = 0;        || no hace el DDEFECTO para no cargarse el #11
          base_mes2 = 0;
     |SINO;
          base_mes1 = #30#39;             || recoge la bases del mes
          base_mes2 = #30#40;
     |FINSI;
     acum_10   = #0#75;    || solo finiquito 2/2003
     acum_30   = #30#41;
     acum_31   = #30#42;
     dvalo_pro = #30#38;            || prorrata mes
|| SI #2#45!"087";|Y #2#45!"097";|Y #2#45!"085";|Y #2#45!"421";|Y #2#42!"H";

    |HAZ ActualizaCons;

|SI #2#42 ! "H";
    |HAZ calcotiz;
        || base_6 = base_6 - base_mes1;  || comunes           ya no
        || base_7 = base_7 - base_mes2;  || profesionales
    base_6 = base_6 ! EURODB;
    base_7 = base_7 ! EURODB;

    |SI base_6 ! #0#75;|O base_7 ! #0#75;    || TODO COMENTADO: TOPEAMOS SIEMPRE
        ||AVISO;                             || 03.12.2003
        ||CONFI "    SExceso de bases de cotizacion. Limitar a tope maximo (S/N): ";
        ||SI FSalida ! 0;
                || base_6 = #0#75;
                || base_7 = #0#75;
        ||FINSI;
    |FINSI;
    |HAZ calboni1;       || calcula bases bonificacion y cuotas
    |HAZ calboni11;      || segunda parte
    ||HAZ calboni60; || bonif mayores 60 a¤os, RDL 16/2001
    nEmp = #labtraba#0;
    nTra = #labtraba#1;
    nMes = #0#8;
    nAny = #0#9;
    nBonifFCI = 0;
    nBonifTex = 0;
    |HAZ calboniFCI_Fin; || bonif comento contratacion indefinida RDL 5/2006
    |SI #labtraba#42 = "A"; |O #labtraba#42 = "E";
         |HAZ calssemp12_1;
         |HAZ calssemp12_2;
    |SINO;
         |HAZ calssemp;
    |FINSI;
|SINO;
        base_6 = 0;
        base_7 = 0;
        base_mes1 = 0;
        base_mes2 = 0;
|FINSI;
|CIERRAT #30;

|SI aParam ! "";
     |ACABA;
|FINSI;
|NOME_DAT #30 nomcalca;
|NOME_DAT #31 nomcalli;
|ABRET #30;
    #30#00 = #11#0;  || empresa
    #30#01 = #11#1;  || trabajador                || borra destino
    #30#02 = #0#8;   || mes
    #30#03 = 2;      || tipo de calculo
|LEE 001#30=;
|SI FSalida = 0;  |BORRA 020#30a;  |BUCLELIN 1NULL#30;  |FINSI;
|CIERRAT #30;

     alfa1 = Usuario;
     |QBF alfa1;
     nomtmpca = "c3" + alfa1;

|NOME_DAT #11 nomtmpca;
|ABRET #11;
    #11#0 = #0#0;
    #11#1 = #0#1;             || lee origen
    #11#2 = #0#8;
    #11#3 =    0;
|LEE 021#11=;
|CIERRAT #11;

|ABRE #10;
|NOME_DAT #30 nomcalca;
|NOME_DAT #31 nomcalli;
|ABRET #30;
    #30#00 = #11#00; || empresa
    #30#01 = #11#01; || trabajador
    #30#02 = #00#08; || mes
    #30#03 = 2;      || tipo de calculo
    #30#04 = #11#04; || fecha alta
    #30#05 = #11#05; || fecha baja
    #30#06 = #11#06; || fecha antiguedad
    #30#07 = #11#07; || dias periodo
    #30#08 = #11#08; || dias alta
    #30#09 = #11#09; || tipo contrato
    #30#10 = #11#10; || dias contrato
    #30#11 = #11#11; || horas contrato
     |SI #labtraba#42 = "E";
          || #30#11 = (#0#32 + 0.49) ! 0;;
          #30#11 = #11#8;
     |FINSI;
    #30#12 = #11#12; || codigo bonificacion
    #30#13 = #11#13; || (%) retencion 1
    #30#14 = #00#64; || base IRPF 1
    #30#15 = #00#70; || retencion IRPF 1
    #30#16 = 0;
    #30#17 = 0;
    #30#18 = #00#63; || base IRPF exenta
     |PARA nume0 = 19; |SI nume0 [ 26; |HACIENDO nume0 = nume0 + 1;
             #30nume0 = 0;
     |SIGUE;
     |PARA nume0 = 27; |SI nume0 [ 30; |HACIENDO nume0 = nume0 + 1;
             #30nume0 = "";
     |SIGUE;
     |PARA nume0 = 31; |SI nume0 [ 36; |HACIENDO nume0 = nume0 + 1;
             #30nume0 = 0;
     |SIGUE;
    #30#131 = 0;
    #30#37 = #0#58;           || total remuneracion
    #30#38 = 0;
    #30#39 = base_6;          || comunes
    #30#40 = base_7;          || profesionales
    #30#41 = 0;
    #30#42 = 0;
    #30#43 = bon_0;           || base 1 bonif.
    #30#44 = bon_3;           || base 2 bonif.
    #30#45 = base_E;          || s.s.cgo.empresa
    #30#46 = (#0#63+#0#64+#0#65+#0#66); || bruto recibo
    #30#47 = 0;               || bruto paga
    |SI #labtraba#45 = "421";
         #30#48 = dto_con;         || cuota comunes
         #30#49 = dto_dfp;         || cuota profesionales
    |SINO;
         #30#48 = #30#39 % bon_1;  || cuota comunes
         #30#49 = #30#40 % bon_2;  || cuota profesionales
    |FINSI;
|PARA nume0 = 50; |SI nume0 [ 60; |HACIENDO nume0 = nume0 + 1;
        #30nume0 = 0;
|SIGUE;
     #30#73 = 0;
     |PARA nume0 = 50; |SI nume0 [ 60; |HACIENDO nume0 = nume0 + 1;
          #30nume0 = 0;
     |SIGUE;
     #30#73 = 0;
     |PARA nume0 = 90; |SI nume0 [ 95; |HACIENDO nume0 = nume0 + 1;
          #30nume0 = 0;
     |SIGUE;
     |PARA nume0 = 97; |SI nume0 [ 113; |HACIENDO nume0 = nume0 + 1;
          #30nume0 = 0;
     |SIGUE;
     #30#117 = 0;
     #30#119 = 0; #30#120 = 0; #30#121 = 0; #30#122 = 0;
     #30#139 = 0; #30#141 = 0; #30#142 = 0;
     |PARA nume0 = 126; |SI nume0 [ 132; |HACIENDO nume0 = nume0 + 1;
          #30nume0 = 0;
     |SIGUE;

    |SI es_aprendi = 0;
         #30#61 = bon_1;           || (%) con.comunes
    |FINSI;
    #30#62 = 0;               || base cotiz. ilt
    #30#63 = base_F;          || cuota bonif. 1
    #30#64 = base_D;          || cuota bonif. 2
    #30#65 = 0;               || total dias matern.
    #30#66 = 0;               || total dias vacac.
    #30#67 = #11#67; || (%) retencion 2
    #30#68 = #11#68; || (%) retencion 3
    #30#69 = #00#65; || base IRPF 2
    #30#70 = #00#66; || base IRPF 3
    #30#71 = #00#71; || retencion IRPF 2
    #30#72 = #00#72; || retencion IRPF 3
    #30#74 = (#0#64+#0#65+#0#66);        || total IRPF
    #30#75 = (#0#70+#0#71+#0#72);        || total retenciones
    #30#79 = zbon_0;   || base bonificada CC (2)
    #30#80 = zbon_3;   || base bonificada CP (2)
    #30#81 = zbase_F;  || cuota bonif. (1)
    #30#82 = nPorBon1; || (%) bonif. (1), para el TC2/1
    #30#83 = nPorBon2; || (%) bonif. (2), para el TC2/1
    #30#84 = bon_5;    || base ILT bonificada (1), para el TC2/1
    #30#85 = zbon_5;   || base ILT bonificada (2), para el TC2/1
    #30#88 = bon_60;   || importe bonificacion mayores 60 a¤os RDL 16/2001
    #30#96 = nBonifFCI;   || importe boni. fomento cont. indef. RDL 5/2006
    #30#102 = nBonifTex;   || importe boni. fomento cont. indef. exced. textil
    #30#101 = bon_55;
    #30#106 = bon_59;
    #30#89 = 0;          || Anticipos 4
     #30#108 = #30#46 + #30#45;      || coste total trabajador
     #30#109 = #30#46 - #30#75 - #30#48 - #30#49 - ((-1) * nValorPreaviso);   || liquido nomina

     swFiniquito = 1;
     nEmpEmb = #0#0;
     nTraEmb = #0#1;
     nLiquidoNom = #30#109;
     nIRPF = #11#13; || (%) retencion 1
     |SI #0#59 ! 0;
          |SI ind = 410
               nInd410 = #0#59;
          |FINSI;
          |SI ind = 415
               nInd415 = #0#59;
          |FINSI;
     |FINSI;

     |HAZ embargos_plb;
     |SI nEmbargo ! 0;
          #30#109 = nLiquidoNom;
          #30#104 = nEmbargo;
     |FINSI;

     |SI #30#109 < 0;
          |SI nValorPreaviso ! 0;
               nValorPreaviso = nValorPreaviso - #30#109;
               #30#109 = 0;
          |FINSI;
     |FINSI;
     #30#112 = #30#108;       || total coste
     #30#113 = #30#109;       || total liquido
     #30#143 = nBonifForEmp;
     #30#144 = nBonifForTra;
     #30#164 = dto_sol_emp;
     #30#165 = dto_sol_tra;
     |HAZ DiasCotizables;
     |SI #labtraba#42 = "A"; |O #labtraba#42 = "E";
          |HAZ GrabaCotiz;
          #30#148 = #nomcalcc#42;       || reduccion CC Alta
          #30#149 = #nomcalcc#15;       || % reduccion (en finiq)
     |FINSI;
     #30#191 = zbon_0;
     #30#191 = zbon_3;
     |HAZ SS_Empresa_Fin;
     #30#199 = nValorPreaviso;
     |GRABA 020#30n;
     nTip = 2;
     |HAZ GrabaNompag;
|CIERRAT #30;

     |HAZ graba2;

     swFiniq = 1;
     nEmp = #0#0;
     nTra = #0#1;
     |HAZ Aviso;

     |CIERRA #10;

     alfa1 = Usuario;
     |QBF alfa1;
     nomtmpca = "c3" + alfa1;
     nomtmpli = "c4" + alfa1;
     |NOME_DAT #11 nomtmpca;
     |NOME_DAT #12 nomtmpli;
     |DELINDEX #11;
     |DELINDEX #12;

     |HAZ fin_log;

     |SI nNroErrores > 0;
          |HAZ CargaLog;
     |FINSI;

     nElMesIRPF = #0#8;
     nElAnyIRPF = #0#9;
     |SUB_EJECUTA "nomir008";

     nElMesIRPF = #0#8;
     nElAnyIRPF = #0#9;
     |SUB_EJECUTA "nom400ca";
|FPRC;
____________________________________/ CALCULO DE LA NOMINA
|PROCESO lectura1;
     |ABRE #0;
     |GRABA 020#0n;
     |CIERRA #0;
     |SI aParam = ""; |O aDatos = "CPAN";
          |PUSHV 12251442;
          |ATRI R;
          |CUADRO 12 25 14 42;
          |ATRI 0;
          |ATRI P;
          |PINTA 1326, " Calculando ... ";
          |ATRI 0;
     |FINSI;
     fq_emp = #0#0;
     fq_tra = #0#1;
     fq_mes = #0#8;        || variables puente por el subejecuta
     fq_any = #0#9;
     ||fq_mod = #0#10;
|FPRC;

|PROCESO CompAgosto2012_Fin;
     swAgosto2012 = 0;

     |SI nElAny ] 2012;
          |SI nElAny > 2012; |O nElMes ] 8;
                swAgosto2012 = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ActualizaCons;
     |ABRE #nomconst;

     |SI #0#9 = 2016;
          #nomconst#0 = #nomconst#0;    || si la igualo a la 500 me cargo la
          #nomconst#79 = "01.01.2016";  || cte. del trabajador
          |LEE 000#nomconst.=;
          |SI FSalida ! 0;
               |SUB_EJECUTA "nomfan02;ACTUALIZACION";

               aAlfa = "    Se han actualizado las constantes con los tipos de cotización";
               aAlfa = aAlfa + " PROVISIONALES para 2016";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;

     |CIERRA #nomconst;
|FPRC;

|PROCESO lectura2;
|POPV;
|SI seleccio = 0;
    |ATRI P;
    |MENAV mensaje0;
    |ATRI 0;
|SINO;
     alfa1 = Usuario;
     |QBF alfa1;

     nomtmpca = "c3" + alfa1;
     nomtmpli = "c4" + alfa1;
    |NOME_DAT #11 nomtmpca;
    |NOME_DAT #12 nomtmpli;
    |ABRET #10;
    |ABRET #11;
     |HAZ CompAgosto2012_Fin;

    |HAZ calleer;
    |HAZ iguala1;
    |CIERRAT #10;
    |CIERRAT #11;
|FINSI;
|FPRC;

|PROCESO otros1;
     |SI aDatos = "CPAN";
          |ABRE #labtraba;
          #labtraba#0 = #0#0;
          #labtraba#1 = #0#1;
          |LEE 000#labtraba.=;
          |CIERRA #labtraba;

          #0#74 = #labtraba#2;
          #0#67 = #labtraba#30;
          #0#68 = #labtraba#174;
          #0#69 = #labtraba#175;
          |PINDA #0#0;
          |ACABA;
     |FINSI;

     nume0 = #0#00;
     nume1 = #0#01;
     nume5 = #0#8;
     nume2 = #0#67;
     nume3 = #0#68;
     nume4 = #0#69;
     alfa1 = #0#74;

     |DDEFECTO #0;

     #0#00 = nume0;
     #0#01 = nume1;
     #0#67 = nume2;
     #0#68 = nume3;
     #0#69 = nume4;
     #0#74 = alfa1;
     #0#8 = nume5;
     |SI aParam = "";
          |PINDA #0#0;
     |FINSI;
|FPRC;

|PROCESO otros2;         || lee el control de la aplicacion
|ABRE #32;
|LEE 001#32p;
|SI FSalida ! 0;
    |DDEFECTO #32;
|FINSI;
|CIERRA #32;
|FPRC;

|PROCESO iguala1;
    #11#0 = #0#0;
    #11#1 = #0#1;
    #11#2 = #0#8;
    #11#3 =    0;
|LEE 021#11=;
|SI FSalida = 0;
    swCalVaca = 0;
    |BUCLELIN 2iguala2#11;
    swCalVaca = 1;
    |HAZ Vacaciones;
    swCalVaca = 0;
|FINSI;
    #0#70 = #0#64 % #0#67;  || retencion 1
    #0#71 = #0#65 % #0#68;  || retencion 2
    #0#72 = #0#66 % #0#69;  || retencion 3
     |SI #labtraba#45 = "421";
          || nada
     |SINO;
          |HAZ topes_antes;
          #0#76 = (#0#75 % bon_1) + (#0#93 % bon_2);    || cuota cotizacion
     |FINSI;

    #0#73 = (#0#63+#0#64+#0#65+#0#66) - (#0#70+#0#71+#0#72+#0#76-nValorPreaviso); ||liquido
          |SI #0#73 < 0; #0#73 = 0; |FINSI;
    |SI aParam = ""; |O aDatos = "CPAN";
        |PINDA #0#0;
    |FINSI;
|FPRC;

|PROCESO otrotope;
     |SI #labtraba#42 = "D"; |O #labtraba#42 = "T";
          nDiasCuenta = 31;
          |SI nMesBusca = 4; |O nMesBusca = 6; |O nMesBusca = 9; |O nMesBusca = 11;
               nDiasCuenta = 30;
          |FINSI;
          |SI nMesBusca = 2;
               nNume = #0#9 $ 4;
               |SI nNume = 0;
                    nDiasCuenta = 29;
               |SINO;
                    nDiasCuenta = 28;
               |FINSI;
          |FINSI;
     |SINO;
          nDiasCuenta = 30;
     |FINSI;
|FPRC;

|PROCESO DiasPaga;
     nMesesPaga = nHastaMesPaga - nHastaMesPaga + 1;
     |SI nDesdeMesPaga [ nHastaMesPaga;
          |SI nDesdeMesPaga [ nElMes; |Y nElMes [ nHastaMesPaga;
          || solo si el mes en que se paga el finiquito est  comprendido
          || en el periodo de devengo de la paga
               |PARA nMesBusca = nDesdeMesPaga;
               |SI nMesBusca [ nHastaMesPaga;
               |HACIENDO nMesBusca = nMesBusca + 1;
                    |HAZ otrotope;
                    nDiasPagaComp = nDiasPagaComp + nDiasCuenta;
               |SIGUE;
          |FINSI;
     |SINO;
          || se supone que estas son todas anuales (tipo del 01/04 al 31/03)
          || y entraran siempre

          |PARA nMesBusca = nDesdeMesPaga;
          |SI nMesBusca [ 12;
          |HACIENDO nMesBusca = nMesBusca + 1;
               |HAZ otrotope;
               nDiasPagaComp = nDiasPagaComp + nDiasCuenta;
          |SIGUE;

          |PARA nMesBusca = 1;
          |SI nMesBusca [ nHastaMesPaga;
          |HACIENDO nMesBusca = nMesBusca + 1;
               |HAZ otrotope;
               nDiasPagaComp = nDiasPagaComp + nDiasCot;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO IncluyePaga;
     |ABRE #nomconca;
     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;

     |ABRE #nomconli;
     |PARA nPaga = 1; |SI nPaga [ 8; |HACIENDO nPaga = nPaga + 1;
          #nomconli#0 = #labtraba#87;
          #nomconli#2 = nPaga + 200;
          |LEE 000#nomconli.=;
          |SI FSalida = 0;
               |SI #nomconli#7 = "S";
                    || entra en vacaciones la paga
                    nCampo1 = nPaga + 36;        || campo del nomcalfi
                    |SI #0nCampo1 ! 0;
                         |SI #labtraba#42 = "D"; |O #labtraba#42 = "T";
                              nDiasCot = nTopemes;
                         |SINO;
                              nDiasCot = 30;
                         |FINSI;

                         nCampo2 = nPaga + 35; || dias paga nomconca
                         nCampo3 = nPaga + 3;
                         nCampo4 = nPaga + 11;
                         nDesdeMesPaga = #nomconca#nCampo3#;
                         nHastaMesPaga = #nomconca#nCampo4#;
                         nDiasPagaComp = 0;
                         |HAZ DiasPaga;

                         nNume = (#nomconca#nCampo2# / nDiasPagaComp) * nDiasCot;
                         nNume = nNume / nDiasCot;
                         nNume = #0nCampo1 * nNume;
                         nSubeDiaVac = nSubeDiaVac + nNume;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
     |CIERRA #nomconli;
     |CIERRA #nomconca;
|FPRC;

|PROCESO Vacaciones;
     |ABRE #12;
     #12#0 = #11#0;
     #12#1 = #11#1;
     #12#2 = #11#2;
     #12#3 = #11#3;
     #12#4 = vac;
     |LEE 000#12=;
     |SI FSalida = 0;
          |HAZ iguala2;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO iguala2;
     concepto = #12#4;
     |HAZ convenio_Fin;
     |SI #12#4 ] 201;|Y #12#4 [ 208;              || pagas
          nume1 = #12#4 - 177;   || unidades
          nume2 = #12#4 - 164;   || valor
          nume3 = #12#4 - 151;   || importes
          #0nume1 = #12#11;
          #0nume2 = #12#10;
          #0nume3 = #12#11 * #12#10;
          |SI #10#8=1;  #0#64=#0#64+#0nume3;  #0#70=#0#64%#0#67;  |FINSI;
          |SI #10#8=2;  #0#65=#0#65+#0nume3;  #0#71=#0#65%#0#68;  |FINSI;
          |SI #10#8=3;  #0#66=#0#66+#0nume3;  #0#72=#0#66%#0#69;  |FINSI;
     |FINSI;
     |SI #12#4 = vac;                             || vacaciones
          |SI swCalVaca = 0;
               |ACABA;        || el importe de las vacaciones las calculo
          |FINSI;             || despues del importe de las pagas

          |SI #0#32 < 0; #0#32 = 0; |FINSI;
          #0#32 = #12#11;
          #0#45 = #12#10;
          |SI #0#45 ! 0;
               nSubeDiaVac = 0;
               |HAZ IncluyePaga;
          |FINSI;
          #12#10 = #12#10 + nSubeDiaVac;
          #0#45 = #0#45 + nSubeDiaVac;
          #0#58 = #12#11 * #12#10;
          |SI #10#8=1;   #0#64=#0#64+#0#58;  #0#70=#0#64%#0#67;  |FINSI;
          |SI #10#8=2;   #0#65=#0#65+#0#58;  #0#71=#0#65%#0#68;  |FINSI;
          |SI #10#8=3;   #0#66=#0#66+#0#58;  #0#72=#0#66%#0#69;  |FINSI;
          ||SI #32#1="S";|Y #2#45!"087";|Y #2#45!"097";|Y #2#45!"085";|Y #2#45!"421";|Y #2#42!"H";
          |SI #32#1 = "S"; |Y #2#42 ! "H";
               |SI #labtraba#45 = "421";
                    |HAZ Formacion;
               |SINO;
                    #0#75 = #0#75 + #0#58;      || cotizaciones
                    #0#93 = #0#93 + #0#58;
               |FINSI;
          |FINSI;
          ||HAZ ValorPreaviso;
     |FINSI;

     ||SI #32#59 = "S"; |Y nConceptoInd ! 0;
     |SI nConceptoInd ! 0;
          ind = nConceptoInd;
     |FINSI;     || preguntamos antes
     |PINTA 1703, ind;
     nume1 = 20; nume2 = ind; nume3 = 89; |HAZ leelin; || indemnizacion
     |SI #12#4 = ind;                             || indemnizacion
          #0#33 = #12#11;
          #0#46 = #12#10;
          #0#59 = #12#11 * #12#10;
          swSigue = 0;
          ||SI #32#13 = "S";
          |SI ind = 410; |O nConceptoInd = 410;
               swSigue = 1;
          |FINSI;
          /*
          |SI #32#59 = "S";
               |SI nConceptoInd = 410;
                    swSigue = 1;
               |SINO;
                    swSigue = 0;
               |FINSI;
          |FINSI;
          */
          |SI swSigue = 1;
               |SI #10#8=1;   #0#64=#0#64+#0#59;  #0#70=#0#64%#0#67;  |FINSI;
               |SI #10#8=2;   #0#65=#0#65+#0#59;  #0#71=#0#65%#0#68;  |FINSI;
               |SI #10#8=3;   #0#66=#0#66+#0#59;  #0#72=#0#66%#0#69;  |FINSI;
          |SINO;
               #0#63 = #0#59;
          |FINSI;
     |FINSI;
|FPRC;
____________________________________/ CALCULOS DEL 'nomcal_2' (iguales)
____________________________________/ LOS NECESITA PARA GESTION PANTALLA
|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#8;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#9;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
|FPRC;

|PROCESO calleer;
|HAZ otros2;                  || lee control de la aplicacion

|ABRE #0;
|DDEFECTO #0;                 || lee la pantalla de datos
|LEE 020#0p;
|CIERRA #0;

|ABRE #1;
|DDEFECTO #1;                 || lee la empresa
    #1#0 = #0#0;
|LEE 020#1=;
|CIERRA #1;

|ABRE #2;
|DDEFECTO #2;                 || lee el trabajador
    #2#0 = #0#0;
    #2#1 = #0#1;
|LEE 020#2=;
|CIERRA #2;

nCConst = #labtraba#248;
|HAZ constante;

|DDEFECTO #36;
|ABRE #36;
    #36#0 = #2#0;
    #36#1 = #2#77;
|LEE 000#36=;            || deducciones de notarias
|CIERRA #36;

    nRecAy = #15#74;
|SI #36#5 = "N";    nRecAy = 0;    |FINSI;
     |SI #0#9 [ 2018;
          nEl36 = 36;
     |SINO;
          nEl36 = 40;
     |FINSI;
|SI #2#112 ! "S";   nEl36 = 0;     |FINSI;

    |SI nElAny = 2017; |Y nElMes [ 6; #15#76 = 532.51; |FINSI;
    topesmi = (#15#76 % 20) ! EURODB;
    por1_cont = #15#07;                             || (%) contigen.(tra.)
    por1_hor1 = #15#09;                             || (%) horas 1  (tra.)
    por1_hor2 = #15#11;                             || (%) horas 2  (tra.)
    por1_dfpg = #15#13 + #15#15 + #15#17 + #15#19;  || (%) d+f+p+g  (tra.)
    por2_cont = #15#06 + nRecAy;                    || (%) contigen.(emp.)
    por2_hor1 = #15#08;                             || (%) horas 1  (emp.)
    por2_hor2 = #15#10;                             || (%) horas 2  (emp.)
    por2_dfpg = #15#12 + #15#14 + #15#16 + #15#18;  || (%) d+f+p+g  (emp.)

|SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";|O #2#45 = "421";
        por1_hor1 = por1_hor1 + por1_dfpg;         || (%) horas 1 (aprend)
        por1_hor2 = por1_hor2 + por1_dfpg;         || (%) horas 2 (aprend)
|FINSI;
|SI #2#45 = "064";       || temporales
        por1_cont = por1_cont * #35#21;      || (%) contigen.(tra.)
        por2_cont = por2_cont * #35#21;      || (%) contigen.(emp.)
|FINSI;
|SI #2#45 = "065";       || indefinidos
        por1_cont = por1_cont * #35#22;      || (%) contigen.(tra.)
        por2_cont = por2_cont * #35#22;      || (%) contigen.(emp.)
|FINSI;
    por1_cont = por1_cont ! 2;
    por2_cont = por2_cont ! 2;

    notaria = #36#2;
|SI #2#42 = "L";
        por1_cont = por1_cont - #36#4;
        notaria = 0;
|FINSI;
|ABRE #16;
|DDEFECTO #16;
    #16#0 = #2#39;            || lee la bonificacion
|LEE 000#16=;
     |SI #16#5 ! 0; |Y #16#5 ! por2_dfpg;
          #16#5 = por2_dfpg;
          || si bonifico desempleo+fog+fp lo bonifico todo
          || para maternidad y similares, para no tener que hacer una para
          || los indefinidos y otra para los de dur. determinada
     |FINSI;
|SI swAgosto2012 = 1; |Y #nombonif#27 = "N";
     |DDEFECTO #16;
|FINSI;
|CIERRA #16;
     |SI #16#10 = 4;
             por1_dfpg = 0;  || (%) d+f+p+g  (tra.)
             por2_dfpg = 0;  || (%) d+f+p+g  (emp.)
     |FINSI;
|FPRC;

|PROCESO calcotiz;       || BASES COTIZACION
     dacum_30 = acum_30;
     dacum_31 = acum_31;       || bases horas extraordinarias
     |SI es_aprendi = 0;
          gua_i = hcoti_0;           || lo guarda por si varia

          |SI es_irregul = 1;|Y tpz ! 0;    hcoti_0 = tpz; |FINSI;   || irregulares

          base_5 = 0;      || aqui la base ILT no cuenta!!!
          nume1 = acum_10;   || solo finiquito mes 2/2003
          nume2 = dacum_30 + dacum_31;              || horas extras

          base_6 = nume1;           || CC
          || base_7 = nume1;            || AT
          base_7 = #0#93;            || AT

          swajuen = 0;     || puede volver (en ajustes)
          |HAZ topes_cc;
          nume1 = acum_10;   || solo finiquito mes 2/2003
          |HAZ topes_cc;

          coti_1 = #15campomax * dias_vac;                     || maximo C.C.
          |SI grupo ] 1;|Y grupo [ 7;|Y coti_1 [ base_6;
               base_6 = coti_1;
          |FINSI;

          swajuac = 0;     || puede volver (en ajustes)
          |HAZ topes_cp;
          || nume1 = acum_10;   || solo finiquito mes 2/2003
          nume1 = #0#93;   || solo finiquito mes 2/2003
          |HAZ topes_cp;

          coti_0 = #15#20 * dias_vac;                || maximo A.T.
          |SI grupo ] 1;|Y grupo [ 7;|Y coti_0 [ base_7;
               base_7 = coti_0;
          |FINSI;

          hcoti_0 = gua_i;      || lo repone por si ha variado
     |SINO;
          base_5 = 0;
          base_6 = #0#75;
          base_7 = #0#93;
     |FINSI;
     dto_sol_emp = base_6 % #nomconst#92; dto_sol_emp = dto_sol_emp ! EURODB; || cot.solidaridad
     dto_sol_tra = base_6 % #nomconst#93; dto_sol_tra = dto_sol_tra ! EURODB; || cot.solidaridad
     |SI dto_sol_emp < 0;
           dto_sol_emp = 0;
           dto_sol_tra = 0;
     |FINSI;
|FPRC;

|PROCESO topes_cc;
||SI #2#42 = "C";|O #2#42 = "F";    || en los citricos no topea la ILT
||        base_6 = base_6 - base_5;
||FINSI;
    || campomax = grupo + 35;  coti_1 = #15campomax * hcoti_0; ||maximo C.C.
    || campomin = grupo + 23;  coti_0 = #15campomin * hcoti_0; ||minimo C.C.
    |SI #32#1 = "N"; |ACABA; |FINSI;
     |SI #0#75 [ 0;
          dias_vac = 0;
          |ACABA;
     |FINSI;
     |SI #0#77 = 421;
          dias_vac = #0#34;
     |SINO;
          dias_vac = #0#32;
     |FINSI;
    dias_vac = (dias_vac + 0.49) ! 0;
    campomax = grupo + 35;  coti_1 = #15campomax * dias_vac; ||maximo C.C.
    campomin = grupo + 23;  coti_0 = #15campomin * dias_vac; ||minimo C.C.
|SI #32#20 = "S";
        coti_0 = coti_0 * tp;      || proporcion tiempos parciales
|FINSI;

|SI horastp ! 0;|Y es_irregul = 1;
    |SI #2#42 = "P"; campomin = 58; |SINO; campomin = 47;  |FINSI;
        campomin = campomin + grupo;
        coti_0 = #15campomin * horastp;
|FINSI;

||SI sw_mater = 0; ¨por que? 04.01.2019
        coti_0 = (coti_0 % propo) ! EURODB; || minimo C.C.
        coti_1 = (coti_1 % propo) ! EURODB; || maximo C.C.

    || no topeamos minimos desde 28.05.2018, T8506
    || volvemos a topearlo, regulado en BNR 2018/4 de agosto de 2018
    |SI coti_0 ] base_6;       || en los irregulares "I" la base minima
            base_6 = coti_0;   ||/se normaliza despues de comparar
        |SI #2#42 ! "I";      swajuen = 1;   |FINSI;
    |FINSI;

    |SI coti_1 [ base_6;  base_6 = coti_1;  swajuen = 1;  |FINSI;
||FINSI;

||SI #2#42 = "C";|O #2#42 = "F";    || en los citricos no topea
||        base_6 = base_6 + base_5;
||FINSI;

|FPRC;

|PROCESO topes_cp;
||SI #2#42 = "C";|O #2#42 = "F";    || en los citricos no topea la ILT
||        base_7 = base_7 - base_5;
||FINSI;
/*
|SI hcoti_0 [ 30;
        coti_0 = #15#20 * hcoti_0;                         || maximo A.T.
    |SI grupo = 12; coti_1 = #15#22 * hcoti_0;  |FINSI;    || minimo A.T.
    |SI grupo = 11; coti_1 = #15#21 * hcoti_0;  |FINSI;
    |SI grupo < 11; coti_1 = #15#23 * hcoti_0;  |FINSI;
|SINO;
        coti_0 = #15#20 * 30;                              || maximo A.T.
    |SI grupo = 12; coti_1 = #15#22 * 30;       |FINSI;    || minimo A.T.
    |SI grupo = 11; coti_1 = #15#21 * 30;       |FINSI;
    |SI grupo < 11; coti_1 = #15#23 * 30;       |FINSI;
|FINSI;
*/
    |SI #32#1 = "N"; |ACABA; |FINSI;
     |SI #0#93 [ 0;
          |ACABA;
     |FINSI;
        coti_0 = #15#20 * dias_vac;                         || maximo A.T.
    |SI grupo = 12; coti_1 = #15#22 * dias_vac;  |FINSI;    || minimo A.T.
    |SI grupo = 11; coti_1 = #15#21 * dias_vac;  |FINSI;
    |SI grupo < 11; coti_1 = #15#23 * dias_vac;  |FINSI;

|SI #32#20 = "S";
        coti_1 = coti_1 * tp;      || proporcion tiempos parciales
|FINSI;

|SI horastp ! 0;|Y es_irregul = 1;
    |SI grupo ] 11;
        |SI #2#42 = "P"; campomin = 73; |SINO; campomin = 71; |FINSI;
    |SINO;
        |SI #2#42 = "P"; campomin = 72; |SINO; campomin = 70; |FINSI;
    |FINSI;
        coti_1 = #15campomin * horastp;
|FINSI;

||SI sw_mater = 0; ¨por que? 04.01.2019
        coti_0 = (coti_0 % propo) ! EURODB; || maximo A.T.
        coti_1 = (coti_1 % propo) ! EURODB; || minimo A.T.
    |SI base_7 ] coti_0;   base_7 = coti_0;   swajuac = 1;  |FINSI;

    || no topeamos minimos desde 28.05.2018, T8506
    || volvemos a topearlo, regulado en BNR 2018/4 de agosto de 2018
    |SI base_7 [ coti_1;           || en los irregulares "I" la base minima
            base_7 = coti_1;       ||/se normaliza despues de comparar
        |SI #2#42 ! "I";      swajuac = 1;   |FINSI;
    |FINSI;
||FINSI;

||SI #2#42 = "C";|O #2#42 = "F";    || en los citricos no topea
||        base_7 = base_7 + base_5;
||FINSI;
|FPRC;

|PROCESO nombotra;
     nBonif = #nombotra#2;
     |ERROR10;
|FPRC;

|DEFBUCLE nombotra;
     #nombotra#1;
     ;
     nEmp, nTra, 001;
     nEmp, nTra, 999;
     ;
     NULL, nombotra;
|FIN;

|PROCESO fechabaja;
     aFechaBaja = "";
     |ABRE #nomvarca;
          #nomvarca#0 = #labtraba#0;
          #nomvarca#1 = #labtraba#1;
          #nomvarca#2 = #0#8;
          #nomvarca#3 = 0;
          |LEE 000#nomvarca.=

          aAlfa = #nomvarca#16;
          |SI aAlfa ! "          "; |Y aAlfa ! "..........";
               fFecha = aAlfa;
          |SINO;
               aAlfa = #labtraba#37;
               |SI aAlfa ! "          "; |Y aAlfa ! "..........";
                    fFecha = aAlfa;
               |FINSI;
          |FINSI;
     aFechaBaja = fFecha;
     fFechaBaja = fFecha;
     |CIERRA #nomvarca;
|FPRC;

|PROCESO calboniFCI_Fin;
     |ABRE #nombotra;
     |ABRE #nomboni3;

     nBonif = 0;
     |BUCLE nombotra;

     |SI nBonif ! 0;
          |SI swAgosto2012 = 1;
               #nomboni3#0 = #nombotra#2;
               |LEE 000#nomboni3.=;
               |SI FSalida = 0;
                    |SI #nomboni3#11 = "N";
                         |CIERRA #nombotra;
                         |CIERRA #nomboni3;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;

          || dia_2 son los dias naturales en alta del mes
          || topemes los dias que tiene el mes, como siempre
          fFechaIniBon = #nombotra#4;
          fFechaFinBon = #nombotra#5;

          |HAZ fechabaja;

          |SI aAlfa ! "          "; |Y aAlfa ! "..........";
               nFecha = fFecha;
               nFecha = nFecha + 1;
               fFecha = nFecha;

               |SI fFecha ] fFechaIniBon;
                    fFechaIniBon = fFecha;
               |FINSI;

               nFecha = nFecha + (#nomcalfi#32 ! 0) - 1;
               fFecha = nFecha;
               |SI fFecha [ fFechaFinBon;
                    fFechaFinBon = fFecha;
               |FINSI;
          |FINSI;

          nume1 = fFechaIniBon;
          nume2 = fFechaFinBon;
          |SI fFechaIniBon [ fFechaFinBon;
                nDiasBon = nume2 - nume1 + 1;
                nDiasBon = (#0#32 + 0.49) ! 0;
          |FINSI;
/*
          |SI #0#8 ! 4; |Y #0#8 ! 6; |Y #0#8 ! 9; |Y #0#8 ! 11; || mes de 31 0 28 dias
               |SI nDiasBon > hcoti_0;       || dias a bonificar > dias cotizables
                    nDiasBon = hcoti_0;      || provocado por no estar de alta el
               |FINSI;                       || mes completo en un mensual
               |SI #labtraba#42 = "M"; |Y #labtraba#64 = "D"; |Y dcoti_0 < hcoti_0;
                    nDiasBon = dcoti_0;  || excepcion para M-D que no estan de alta
               |FINSI;                   || el mes completo
          |FINSI;
          |SI nDiasBon [ 0;        || si por lo que sea me llegan negativos, cero
               nDiasBon = 0;
          |FINSI;
          |SI nDiasBon ] 30;       || si estoy en un mes de 31 dias y bonificado
               nDiasBon = 30;      || todo el mes, 30 ya que luego divido siempre
          |FINSI;                  || por 30
          |SI nDiasBon ] 28; |Y #0#8 = 2;
               nDiasBon = 30;      || si estoy en febrero y bonificado todo el mes,
          |FINSI;                  || 30 porque divido por 30
*/
          || asigno valor
          nBonifFCI = #nombotra#7;
          || recorto si hay tiempo parcial

          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               aAlfa1 = #nombotra#4;
               aAlfa2 = "08.03.2009";
               fFecha1 = aAlfa1;
               fFecha2 = aAlfa2;
               |SI fFecha1 < fFecha2;
                    |SI #labtraba#234 > 0; |Y #labtraba#234 < 10;
                         nBonifFCI = nBonifFCI * 0.25;
                    |FINSI;
                    |SI #labtraba#234 ] 10; |Y #labtraba#234 < 20;
                         nBonifFCI = nBonifFCI * 0.50;
                    |FINSI;
                    |SI #labtraba#234 ] 20; |Y #labtraba#234 < 30;
                         nBonifFCI = nBonifFCI * 0.75;
                    |FINSI;
                    |SI #labtraba#234 ] 30;
                         nBonifFCI = nBonifFCI * 1;
                    |FINSI;
               |SINO;
                    nNume = 0;
                    |SI #nombotra#2 = 161; |O #nombotra#2 = 164;
                    |O #nombotra#2 = 169; |O #nombotra#2 = 170;
                         nNume = tp;
                    |SINO;
                         |SI #nombotra#2 = 199;
                              |SI 0.50 [ tp; |Y tp < 0.75;
                                   nNume = 0.50;
                              |FINSI;
                              |SI 0.75 [ tp;
                                   nNume = 0.75;
                              |FINSI;
                         |SINO;
                              nNume = tp + 0.3;
                         |FINSI;
                    |FINSI;
                    |SI nNume > 1;
                         nNume = 1;
                    |SINO;
                         nNume = nNume ! 3;
                    |FINSI;
                    nBonifFCI = nBonifFCI * nNume;
               |FINSI;
          |FINSI;

          |SI nDiasBon < 30;  || si no estoy mes completo
               nBonifFCI = ((nBonifFCI / 30) ! 2) * nDiasBon;
          |FINSI;

          |SI nBonifFCI > 0; |Y #nombotra#2 ] 302; |Y #nombotra#2 [ 399;
               nBonifTex = nBonifFCI;
               nBonifFCI = 0;
          |FINSI;
     |FINSI;
     |CIERRA #nomboni3;
     |CIERRA #nombotra;
|FPRC;
/*
|PROCESO por_bon_16;
     alfa1 = #2#11 % -104;        || anyo nacimiento
     alfa2 = #2#11 % -602;        || mes nacimiento
     alfa5 = #2#11 % 102;         || dia nacimiento
     alfa3 = aFechaRef % -104;        || anyo Fecha Referencia
     alfa4 = aFechaRef % -602;        || mes Fecha Referencia
     alfa6 = aFechaRef % 102;         || dia Fecha Referencia
     nume1 = alfa1;
     nume1 = alfa1 + nEdadParaBon;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + nAnysParaAnt;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad
     |SI nEdadParaBon = 59;
          fecha_ini_bon = "01.01.2001";
          any_ini_bon = 2001;
     |SINO;
          fecha_ini_bon = "01.01.2002";
          any_ini_bon = 2002;
     |FINSI;

     |SI nume1 > nume3;            || cuando cumple 60 (o 59) (o 55) a¤os
          |SI nume1 < any_ini_bon;
               fecha_bon_16 = fecha_ini_bon;
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < any_ini_bon;
               fecha_bon_16 = fecha_ini_bon;
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 (o 55) a¤os
               |SI nume1 < any_ini_bon;
                    fecha_bon_16 = fecha_ini_bon;
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < any_ini_bon;
                    fecha_bon_16 = fecha_ini_bon;
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 (o 55) a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 (o 55) a¤os
                    |SI nume1 < any_ini_bon;
                         fecha_bon_16 = fecha_ini_bon;
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume5 < nume6;            || cuando cumple antiguedad
                    |SI nume3 < any_ini_bon;
                         fecha_bon_16 = fecha_ini_bon;
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
     |FINSI;


     alfa7 = fecha_bon_16 % 402;
     nume7 = alfa7;                || mes en que empieza a ser efectiva la bonif.
     alfa7 = fecha_bon_16 % -104;
     nume8 = alfa7;                || anyo en que empieza a ser efectiva la bonif.
     nMesesBon16 = #0#8 - nume7;
     nAnyosBon16 = #0#9 - nume7;

     |SI nAnyosBon16 > 0;
          |SI nMesesBon16 < 0;
               nMesesBon16 = 12 + nMesesBon16;
               nAnyosBon16 = nAnyosBon16 - 1;
          |FINSI;
     |FINSI;

     |SI nAnyosBon16 ] 0;
          |SI nEdadParaBon = 59;
               |SI nAnyosBon16 ! 0; |O nMesesBon16 ] 0;
                    nPB16Calc = 40 + (nAnyosBon16 * 10);
                    |SI nPB16Calc > 100;
                         nPB16Calc = 100;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nEdadParaBon = 60;
               |SI nAnyosBon16 ! 0; |O nMesesBon16 ] 0;
                    nPB16Calc = 50 + (nAnyosBon16 * 10);
                    |SI nPB16Calc > 100;
                         nPB16Calc = 100;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nEdadParaBon = 55;
               |SI nAnyosBon16 ! 0; |O nMesesBon16 ] 0;
                    nPB16Calc = 50;
               |FINSI;
          |FINSI;
     |SINO;
          |ACABA;
     |FINSI;

     |SI #0#8 = nume7; |Y #0#9 ] nume8;      || si estoy calculando el mes q entra
          alfa7 = fecha_bon_16 % 102;        || en vigor la bonif. calcula el % correspondiente
          nume7 = alfa7;                     || segun la fecha inicio de bonif.
          nume7 = guarda - nume7 + 1;        || "guarda" se trae los dias del mes
          |SI #0#9 > nume8;                  || si llevo ya mas de un a¤o de bonif
               nume9 = nElAny - nume8;         || este mes cambia el porcentaje a
          |SINO;
               nume7 = guarda;
          |FINSI;
     |SINO;
          nume7 = guarda;                         || si es un mes posterior calcula el
                                                  || 100% ya que entra entera.
     |FINSI;

     por_bon_16 = (nume7 / guarda) * 100;
     por_bon_16 = 50;              || finiqui
|FPRC;

|PROCESO calboni60;      || BONIFICACION MAYORES 60 A¤OS RDL. 16/2001
     bon_55 = 0;
     bon_59 = 0;
     bon_60 = 0;

     |SI nElAny ] 2014;
          |ACABA;
     |FINSI;

     alfa1 = #labtraba#11 % -104;        || anyo nacimiento
     alfa2 = #labtraba#11 % -602;        || mes nacimiento

     nNume = alfa1;
     nEdad = nElAny - nNume;
     nNume = alfa2;
     |SI nElMes < nNume;
          nEdad = nEdad - 1;
     |FINSI;

     |SI nElAny = 2013;
          swSigue = 0;
                                        || en diciembre de 2012 la tuvo,
          |ABRE #nomhicca;              || con lo que se la debe poder
          #nomhicca#0 = #labtraba#0;    || seguir aplicando hasta que
          #nomhicca#1 = #labtraba#1;    || acabe
          #nomhicca#66 = 12;
          #nomhicca#2 = 12;
          #nomhicca#3 = 0;
          |LEE 000#nomhicca.=;
          FEstado = FSalida;
          |SI FSalida = 0;
               |SI #nomhicca#148 ! 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;

          || inicia el derecho a la reduccion en 2013, que es cuando
          || cumplira 59 a¤os. A partir de 2013, solo se aplica a quie-
          || nes se la vinieran aplicando por haber cumplido 59 en 2012,
          || quienes cumplan en 2013 los 59, nada de nada

          || no haria falta con la condicion anterior, partiendo de swSigue = 0
          || pertampoco esta de mas

          alfa1 = #labtraba#11 % -104;    || anyo nacimiento
          nNume = alfa1;
          nNume1 = 2012 - nNume;          || edad con que acabo 2012
          |SI nNume1 = 58;
               swSigue = 0;
          |FINSI;

          || esto es por si ya sabemos que acabo el a¤o 2012 con 59 a¤os
          || pero resulta que el swSigue me venia a cero por no tener en
          || 2012 la nomina de diciembre

          |SI nNume1 = 59;
               |SI FEstado ! 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;

          |SI swSigue = 0;
               |ACABA;
          |FINSI;
     |FINSI;

     nume1 = #0#9;
     |SI nume1 > 2002;
          por_bon_60 = 22.18;
           |SI nume1 ] 2011;
                por_bon_60 = 22.14;
           |FINSI;
     |SINO;
          por_bon_60 = 22.30;
     |FINSI;
     aFechaRef = "";
     |SI #2#212 = 2;
          aFechaRef = #2#36;       || fecha de referencia: fecha de Alta
     |SINO;
          aFechaRef = #2#34;       || fecha de referencia: fecha de Antiguedad
     |FINSI;
     alfa1 = #2#11; |QBF alfa1;    || compruebo que exista fecha nacimiento
     alfa2 = aFechaRef; |QBF alfa2;    || compruebo que exista fecha de refer.
     |SI alfa1 = ""; |O alfa2 = ""; |O alfa1 = ".........."; |O alfa2 = "..........";
          |ACABA;
     |FINSI;

     nEdadParaBon = 0;

     |SI #2#212 = 0; #2#212 = 1;   |FINSI;
     |SI #2#212 = 1; |O #2#212 = 2;
          nume1 = #labtraba#45;
          |SI nume1 < 400;    || contrato indefinido
               nEdadParaBon = 59;  || a partir de los 59 a¤os
               nAnysParaAnt = 4;
          |SINO;
               nEdadParaBon = 60;  || a partir de los 60 a¤os
               nAnysParaAnt = 5;
          |FINSI;
     |SINO;
          nEdadParaBon = 55;  || bonificaciones del sector textil
          nAnysParaAnt = 5;
     |FINSI;                  || a partir de los 55 a¤os

     aEPBon = nEdadParaBon;
     |QBF aEPBon;

     |SI #2#211 ! 0;
          |HAZ por_bon_16;
          bon_60 = (base_6 % por_bon_60) % #2#211;
          ||bon_60 = (bon_60 % por_bon_16)! EURODB;  || finiquitos: siempre
                                                     || el % del labtraba
          |SI #2#211 = 40;
               bon_59 = bon_60;
               bon_60 = 0;
          |FINSI;
          |SI #2#212 = 3; |O #2#212 = 4;     || TEXTIL
               |SI bon_60 > 0;
                    bon_55 = bon_60;
                    bon_60 = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swAgosto2012 = 1;
          bon_55 = 0;
          bon_60 = 0;
     |FINSI;
|FPRC;
*/
|PROCESO el_caso_raro_Fin;
     nDiasBonBaja = 0;
                                   || dias bonif distinto a dias cotiz
                                   || o acaba o empieza bonificacion este me
     alfa1 = #2#40 % 402;          || comprueba si este mes comienza bonif
     alfa2 = #2#40 % -104;
     nume1 = alfa1;      || mes inicio bonif
     nume2 = alfa2;      || mes fin bonif
     |SI nume1 = #0#8; |Y nume2 = #0#9;
          alfa1 = #2#40 % 102;
          nAltaBonif = alfa1;
          nBajaBonif = dcoti_0;
     |FINSI;

     alfa1 = #2#41 % 402;     || si este mes NO comienza bonif. es porque
     alfa2 = #2#41 % -104;    || acaba, si no no deberia haber entrado
     nume1 = alfa1;      || mes inicio bonif
     nume2 = alfa2;      || mes fin bonif
     |SI nume1 = #0#8; |Y nume2 = #0#9;
          alfa1 = #2#41 % 102;
          nAltaBonif = 1;
          nBajaBonif = alfa1;
     |FINSI;

     |SI nAltaBonif = 0; |Y nBajaBonif = 0;
          |ACABA;        || no deberia haber entrado
     |FINSI;

     |PARA nDia = 1; |SI nDia [ dcoti_0; |HACIENDO nDia = nDia + 1;  ||
          |PARA nBaja = 27; |SI nBaja [ 30; |HACIENDO nBaja = nBaja + 1;
               |SI #nomcalca#nBaja# = "E"; |O #nomcalca#nBaja# = "A"; |O #nomcalca#nBaja# = "M";
               ||SI #nomcalca#nBaja# = "M";
                    nume1 = nBaja - 8;  || dia desde baja
                    nume2 = nBaja - 4;  || dia hasta baja
                    nInicioBaja = #nomcalca#nume1#;
                    nFinBaja = #nomcalca#nume2#;
                    |SI nInicioBaja = 0; nInicioBaja = 1; |FINSI;
                    |SI nFinBaja = 0; nFinBaja = dcoti_0; |FINSI;
                    |SI nDia ] nInicioBaja; |Y nDia [ nFinBaja;
                         |SI nDia ] nAltaBonif; |Y nDia [ nBajaBonif;
                              nDiasBonBaja = nDiasBonBaja + 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |SIGUE;
|FPRC;

|PROCESO calboni1;       || CALCULA BASES BONIFICACION
    bon_0 = 0;           || base CC bonificacion (1)
    bon_3 = 0;           || base CP bonificacion (1)
    bon_5 = 0;           || base ILT bonificacion (1)
    bon_1 = por1_cont;   || (%) cont. comunes
    bon_2 = por1_dfpg;   || (%) D+F+P
          || contratos de interinidad por sustitucion por maternidad no
          || de bonifican en finiquitos: 3923.302
          |SI #labtraba#45 = "410"; |O #labtraba#45 = "510";
               ||ACABA;
               || mira el tiquet 3079.346, un caso como este, pero resulta que
               || el CRETA si que practica la bonificacion, por lo que suponemos
               || que si que se puede deducir
          |FINSI;
/*
    || dias bonificacion igual a dias cotizacion
    || a ver en principio lo dejo asi, no tiene demasiado sentido que la bonificacion
    || acabe justo en los dias de finiquito.
    || de otro modo puede dar lugar a errores, si la fecha ini o fin de bonif
    || esta en el mes del finiquito y no es el primer o ultimo dia del mes
    || 15.06.2018 4413.305
    dboni_1 = dcoti_0;

     || esto lo puse pero esta mal, ya que si la bonif acaba antes del mes del
     || finiquito, la calcula tambien, esto es un error

     || al quitarlo, no se soluciona el problema del tiquet anterior, pero paso
     || realmente esto deberia ir por el sistema nuevo y no liar mas este
     || calculo

     || se queda pensiente que si la bonif. acaba DURANTE el finiquito, coja
     || los dias exactos que quedan de bonif, si sale otra vez, hazlo ya
     || 09/11/2018 668.1988
*/
|SI #2#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0;
        lin_1 = #16#6 % nPorBon1;
        lin_2 = #16#7 % nPorBon1;
        bon_0 = base_6;
        bon_3 = base_7;
        bon_5 = base_5;
    ||SI sw_mater = 1;                  || en maternidad no tienes nada que
    ||        bon_0 = bon_0 + coba_4;   || bonificar
    ||        bon_3 = bon_3 + cobb_4;
    ||FINSI;
        bon_1 = por1_cont - lin_1;
        bon_2 = por1_dfpg - lin_2;
    |SI #16#9 = "S";
            bon_1 = bon_1 - #15#5;
    |FINSI;
    |SI dboni_1 ! dcoti_0;    || dias bonificacion distintos a dias cotizacion
        |HAZ el_caso_raro_Fin;
        |SI nDiasBonBaja ! 0;
            bon_0 = bon_0 - bon_5;
            bon_3 = bon_3 - bon_5;
            || nDiasBaja = denfe_2 + dmate_2 + dacci_2;
            nDiasBaja = dmate_2;   || no miro enfer.y accid.porque es un jaleo
                                   || y porque no va a pasar, si pasa ya veremos
            |SI nDiasBonBaja ] nDiasBaja;
                 nume1 = (dboni_1 - nDiasBonBaja) / dboni_1;
            |SINO;
                 nume1 = (dboni_1 - nDiasBonBaja) / nDiasBaja;
            |FINSI;
            bon_0 = bon_0 * nume1;
            bon_3 = bon_3 * nume1;
            |SI nDiasBonBaja ] nDiasBaja;
                 nume2 = nDiasBonBaja / dboni_1;
            |SINO;
                 nume2 = nDiasBonBaja / nDiasBaja;
            |FINSI;
            bon_5 = bon_5 * nume2;

            bon_0 = bon_0 + bon_5;
            bon_3 = bon_3 + bon_5;

        |SINO;
            nume1 = dboni_1 / (dboni_1 + dboni_2);
            bon_0 = bon_0 * nume1;
            bon_3 = bon_3 * nume1;
            bon_5 = bon_5 * nume1;
        |FINSI;

    |FINSI;
|FINSI;
|SI #16#10 = 4;           || RDL 16/2001 2.2.1
        bon_1 = por1_cont - #16#6;
|FINSI;
|FPRC;

|PROCESO calboni11;      || CALCULA BASES BONIFICACION
    zbon_0 = 0;          || base CC bonificacion (2)
    zbon_3 = 0;          || base CP bonificacion (2)
    zbon_5 = 0;          || base ILT bonificacion (2)
    bon_1 = por1_cont;  || (%) cont. comunes
    bon_2 = por1_dfpg;  || (%) D+F+P
|SI #2#39 ! 0; |Y dboni_2 ! 0; |Y nPorBon2 ! 0;
        lin_1 = #16#6 % nPorBon2;
        lin_2 = #16#7 % nPorBon2;
        zbon_0 = base_6;
        zbon_3 = base_7;
        zbon_5 = base_5;
    |SI sw_mater = 1;
            zbon_0 = zbon_0 + coba_4;  ||(dmate_2 * prom_enf);
            zbon_3 = zbon_3 + cobb_4;  ||(dmate_2 * prom_acc);
    |FINSI;
        bon_1 = por1_cont - lin_1;
        bon_2 = por1_dfpg - lin_2;
    |SI #16#9 = "S";
            bon_1 = bon_1 - #15#5;
    |FINSI;
    |SI dboni_2 ! dcoti_0;    || dias bonificacion distintos a dias cotizacion
            nume1 = dboni_2 / (dboni_1 + dboni_2);
            zbon_0 = zbon_0 * nume1;
            zbon_3 = zbon_3 * nume1;
            zbon_5 = zbon_5 * nume1;
    |FINSI;
        nume1 = bon_0 + zbon_0;
    |SI nume1 ! base_6;  zbon_0 = zbon_0 - (nume1 - base_6);     |FINSI;
        nume1 = bon_3 + zbon_3;
    |SI nume1 ! base_7;  zbon_3 = zbon_3 - (nume1 - base_7);     |FINSI;
|FINSI;

|SI #16#10 = 4;           || RDL 16/2001 2.2.1
        bon_1 = por1_cont - #16#6;
|FINSI;

|FPRC;

|PROCESO calssemp;    || CALCULA S.S. A CGO. EMPRESA (18/93 y resto)
     base_A = 0;   base_B = 0;   base_C = 0;   base_F = 0;
     base_D = 0;   base_E = 0;   base_G = 0;   base_M = 0;  base_N = 0;
     base_AB = 0;  base_MN = 0;
     zbase_A = 0;  zbase_B = 0;  zbase_C = 0;  zbase_F = 0;
     zbase_M = 0;  zbase_N = 0;
     zbase_AB = 0; zbase_MN = 0;

     |SI es_aprendi = 0;
          |SI #2#45 ! "064";|Y #2#45 ! "065";|Y #16#9 = "N";
          || deduc.volunt.(122): todos menos los 64/65 y los coef.reductores
               base_G = (base_6 % (por1_cont + por2_cont) ) ! EURODB;
               base_G = (base_G % #15#75) ! EURODB;
          |FINSI;
          base_8 = base_8 + (base_6 % por2_cont);             || cc
          base_8 = base_8 < notaria;                          || ded.notarias
          base_8 = base_8 + (base_7 % por2_dfpg);             || cp
          base_8 = base_8 + ((((base_6 % por2_cont) ! EURODB) % nEl36) ! EURODB);
          base_8 = base_8 ! EURODB;                           || 36% ctos.<7dias
          base_9 = (base_7 - base_5) % (epig_ilt + epig_ims);      || epig.normal
          base_9 = base_9 + (base_5 % (#15#3 + #15#4));            || epig.enf.
          base_9 = base_9 ! EURODB;
          |SI #2#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0;
               base_A = (bon_0 % #16#4) % nPorBon1; || cuota bonif. linea 1
               base_B = (bon_3 % #16#5) % nPorBon1; || cuota bonif. linea 2
               base_AB = (base_A + base_B) ! EURODB;
               base_M = (bon_0 % #16#6) % nPorBon1; || cuota bonif. linea 1
               base_N = (bon_3 % #16#7) % nPorBon1; || cuota bonif. linea 2
               base_MN = (base_M + base_N) ! EURODB; || redondea juntas para q no haya problemas
               |SI #16#08 = "S";
                    zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
                    zbase_9 = zbase_9 ! EURODB;
                    zbase_9 = zbase_9 + (bon_5 % (#15#3 + #15#4));
                    zbase_9 = zbase_9 ! EURODB;
                    base_C = zbase_9 % nPorBon1;      || cuota bonificada accidentes
                    base_C = base_C ! EURODB;
               |FINSI;
          |FINSI;
          |SI #2#39 ! 0; |Y dboni_2 ! 0; |Y nPorBon2 ! 0;
               zbase_A = (zbon_0 % #16#4) % nPorBon2; || cuota bonif. linea 1
               zbase_B = (zbon_3 % #16#5) % nPorBon2; || cuota bonif. linea 2
               zbase_AB = (zbase_A + zbase_B) ! EURODB;   || redondea juntas para q no haya problemas
               zbase_M = (zbon_0 % #16#6) % nPorBon1; || cuota bonif. linea 1
               zbase_N = (zbon_3 % #16#7) % nPorBon1; || cuota bonif. linea 2
               zbase_MN = (zbase_M + zbase_N) ! EURODB; || redondea juntas para q no haya problemas
               |SI #16#08 = "S";
                    zbase_9 = (zbon_3 - zbon_5) % (epig_ilt + epig_ims);
                    zbase_9 = zbase_9 ! EURODB;
                    zbase_9 = zbase_9 + (zbon_5 % (#15#3 + #15#4));
                    zbase_9 = zbase_9 ! EURODB;
                    zbase_C = zbase_9 % nPorBon2;     || cuota bonificada accidentes
                    zbase_C = zbase_C ! EURODB;
               |FINSI;
          |FINSI;
          |SI #2#39 = 501; |O #2#39 = 502;
               |SI base_6 ! 0;
                    |HAZ calboni_taripla;
               |FINSI;
          |FINSI;
          |SI #2#39 = 505; |O #2#39 = 506; |O #2#39 = 507; |O #2#39 = 508;
               ||SI base_6 ! 0;
                    |HAZ calboni_500;
               ||FINSI;
          |FINSI;

          base_E = base_8+base_9+dto_sol_emp-(base_AB+base_C+zbase_AB+zbase_C+base_D+base_G); ||SS emp.
          base_F = base_AB + base_C + base_MN;        || cuota (1) bonif.
          zbase_F = zbase_AB + zbase_C + zbase_MN;    || cuota (2) bonif.

          |SI #2#211 ! 0;
               nBonCC = base_A + zbase_A;
               nume1 = (((base_6 % por2_cont) ! 2) - nBonCC) - bon_55 - bon_59 - bon_60;
               |SI nume1 < 0; |Y base_A > 0; || esto es para comprobar que no
                    |SI bon_55 > 0;
                         nume2 = (((base_6 % por2_cont) ! 2) - nBonCC) - bon_55;
                         bon_55 = bon_55 + nume2; || se bonifique mas de la cuota
                    |FINSI;
                    |SI bon_59 > 0;
                         nume2 = (((base_6 % por2_cont) ! 2) - nBonCC) - bon_55 - bon_59;
                         bon_59 = bon_59 + nume2; || se bonifique mas de la cuota
                    |FINSI;
                    |SI bon_60 > 0;
                         nume2 = (((base_6 % por2_cont) ! 2) - nBonCC) - bon_55 - bon_59 - bon_60;
                         bon_60 = bon_60 + nume2; || se bonifique mas de la cuota
                    |FINSI;
               |FINSI;                       || a pagar
               base_E = base_E - bon_60 - bon_55 - bon_59;        || bonif. mayores 60 a¤os
          |FINSI;

          |SI nBonifFCI > 0;
               base_E = base_E - nBonifFCI;
               |SI base_E < 0;
                    nBonifFCI = nBonifFCI + base_E;
                    base_E = 0;
               |FINSI;
               |SI nBonifTex > 0;
                    base_E = base_E - nBonifTex;
                    |SI base_E < 0;
                         nBonifTex = nBonifTex + base_E;
                         base_E = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          || base_E ya la calcule en el proceso Formacion
          base_E = base_E_formacion;
     |FINSI;
|FPRC;

|PROCESO convenio_Fin;     || comprueba si existe linea de convenio
|DDEFECTO #10;
    convenio = 1;
    #10#00 = #2#87;
    #10#02 = concepto;
|LEE 000#10=;
|SI FSalida = 0;|O concepto ] 901; || los conceptos 9xx pasan aunque no esten
        convenio = 0;
    |SI concepto ] 901;
        |SI concepto = 901;  #10#6 = "N§ HORAS";  |FINSI;
        |SI concepto = 902;  #10#6 = "INDEMNI.";  |FINSI;
        |SI concepto = 903;
                #10#6 = "CITRICOS";
                fijo_1 = unidades;       || dias cotizados citricos
        |FINSI;
        |SI concepto = 904;  #10#6 = "VACACION";  |FINSI;
        |SI concepto = 905;  #10#6 = "HORAS TP";  |FINSI;
        |SI concepto = 906;  #10#6 = "ANTIC. 1";  |FINSI;
        |SI concepto = 907;  #10#6 = "ANTIC. 2";  |FINSI;
        |SI concepto = 908;  #10#6 = "ESPECIE ";  |FINSI;
        |SI concepto = 909;  #10#6 = "H.C.SEM.";  |FINSI;
        |SI concepto = 910;  #10#6 = "H.T.SEM.";  |FINSI;
        |SI concepto = 911;  #10#6 = "H.C.MES ";  |FINSI;
        |SI concepto = 912;  #10#6 = "H.T.MES ";  |FINSI;
        |SI concepto = 913;  #10#6 = "ALTA=CTO";  |FINSI;
        |SI concepto = 914;  #10#6 = "D.ALTA  ";  |FINSI;
        |SI concepto = 915;  #10#6 = "DIAS VAC";  |FINSI;
        |SI concepto = 916;  #10#6 = "DED.S.S.";  |FINSI;
        |SI concepto = 917;  #10#6 = "DIAS TC2";  |FINSI;
        |SI concepto = 918;  #10#6 = "HORASTC2";  |FINSI;
        |SI concepto = 919;  #10#6 = "BASEIRPF";  |FINSI;
        |SI concepto = 920;  #10#6 = "P.INDEM.";  |FINSI;
        |SI concepto > 920;
                convenio = 1;         || los no contemplados no los graba
        |SINO;
            |SI FSalida ! 0;
                    #10#3 = "V";
                    #10#4 = 0;
                    #10#5 = 0;
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO EnAlta;
     |SI FSalida = 18;
          |SI Campo = 0;
               enEmpresa = 0;
          |SINO;
               enEmpresa = #0#0;
          |FINSI;
          |HAZ EnAlta_plb;
          |SI enTrabajador ! 0;
               #0#0 = enEmpresa;
               #0#1 = enTrabajador;
               |PINTA #0#0;
               |PINTA #0#1;

               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 000#labtraba.=;
               |SI FSalida = 0;
                    #0#74 = #labtraba#2;
                    |PINTA #0#74;
               |FINSI;
               |CIERRA #labtraba;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambiaInd;
     swCambiaInd = 0;
     |SI FSalida = 13;
          swCambiaInd = 1;
          |ABRE #10;
          |SI ind = 410;
               #10#0 = #2#87;
               #10#2 = 415;
               |LEE 001#10=;
               |SI FSalida = 0;
                    ind = 415;
                    aAlfa = #10#6;
                    #0#20 = aAlfa;
                    #0#89 = #10#8;
                    |PINTA 1703, ind;
                    |PINDA #0#0;
               |SINO;
                    |MENAV "    El concepto 415 no esta definido en el convenio";
                    |CIERRA #10;
                    |ACABA;
               |FINSI;
               |CIERRA #10;
               |SI #0#59 ! 0;
                    nUniInd = #0#33;
                    nValInd = #0#46;

                    ind = 410;
                    |SI Campo = 33;
                         #0#33 = 0;
                         |HAZ despu_uni;
                    |FINSI;
                    |SI Campo = 46;
                         #0#46 = 0;
                         |HAZ despu_val;
                    |FINSI;

                    ind = 415;
                    |SI Campo = 33;
                         #0#33 = nUniInd;
                         |HAZ despu_uni;
                    |FINSI;
                    |SI Campo = 46;
                         #0#46 = nValInd;
                         |HAZ despu_val;
                    |FINSI;
               |FINSI;
               |ERROR;
               swCambiaInd = 0;
               |HAZ Mensa33;
               |ACABA;
          |FINSI;
          |SI ind = 415;
               #10#0 = #2#87;
               #10#2 = 410;
               |LEE 001#10=;
               |SI FSalida = 0;
                    ind = 410;
                    aAlfa = #10#6;
                    #0#20 = aAlfa;
                    #0#89 = #10#8;
                    |PINTA 1703, ind;
                    |PINDA #0#0;
               |SINO;
                    |MENAV "    El concepto 410 no esta definido en el convenio";
                    |CIERRA #10;
                    |ACABA;
               |FINSI;
               |CIERRA #10;
               |SI #0#59 ! 0;
                    nUniInd = #0#33;
                    nValInd = #0#46;

                    ind = 415;
                    |SI Campo = 33;
                         #0#33 = 0;
                         |HAZ despu_uni;
                    |FINSI;
                    |SI Campo = 46;
                         #0#46 = 0;
                         |HAZ despu_val;
                    |FINSI;

                    ind = 410;
                    |SI Campo = 33;
                         #0#33 = nUniInd;
                         |HAZ despu_uni;
                    |FINSI;
                    |SI Campo = 46;
                         #0#46 = nValInd;
                         |HAZ despu_val;
                    |FINSI;
               |FINSI;
               swCambiaInd = 0;
               |ERROR;
               |HAZ Mensa33;
               |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Exceso;
     || esta normativa no se llego a poner en practica, asi que directamente
     || no entro en este proceso, no lo borro, que salio muy bonito y facil
     || por si hiciera falta en otra ocasion

     |ACABA;

     |SI FSalida = 14;
          |SI ind ! 415;
               |ACABA;
          |FINSI;

          |PUSHV 05011660;

          |SI nAnysIndem = 0;
               fFecha1 = #11#06;
               fFecha2 = #11#05;
               nNume1 = fFecha1;
               nNume2 = fFecha2;
               nAnysIndem = ((nNume2 - nNume1 + 1) / 365) ! 2;
          |FINSI;

          |SI #0#59 ! 0;
               |PINPA #8#nompanta;

               || ANTIGUEDAD

               aAlfa = nAnysIndem;
               |QBF aAlfa;
               aAlfa = aAlfa + " a¤os";
               |PINTA 0819, aAlfa;

               || IMPORTE ANUAL

               nNume1 = #0#59;
               nNume2 = nAnysIndem;
               nNume3 = (#0#59 / nAnysIndem) ! 2;
               alfa1 = nNume1; |QBF alfa1;
               alfa2 = nNume2; |QBF alfa2;
               alfa3 = nNume3; |QBF alfa3;
               aAlfa = alfa1 + " / " + alfa2 + " = " + alfa3;
               aAlfa = aAlfa + " euros";
               |PINTA 0919, aAlfa;

               || EXCESO DE 200 EUROS ANUALES

               nNume1 = nNume3 - 2000;
               |SI nNume1 < 0;
                    nNume1 = 0;
               |FINSI;
               aAlfa = nNume1;
               |PINTA 1047, aAlfa;

               || SUJETO A IRPF

               nNume1 = nNume3 - 2000;
               |SI nNume1 > 0;
                    nNume3 = (nNume1 * nNume2) ! 2;
                    alfa1 = nNume1; |QBF alfa1;
                    alfa2 = nNume2; |QBF alfa2;
                    alfa3 = nNume3; |QBF alfa3;
                    aAlfa = alfa1 + " x " + alfa2 + " = " + alfa3;
                    |QBF aAlfa;

                    |PINTA 1125, aAlfa;
               |SINO;
                    nNume3 = 0;
                    aAlfa = nNume3;
                    |PINTA 1125, aAlfa;
               |FINSI;

               || EXENTO DE IRPF

               nNume1 = #0#59;
               nNume2 = nNume3;
               nNume3 = nNume1 - nNume2;
               |SI nNume1 > 0;
                    alfa1 = nNume1; |QBF alfa1;
                    alfa2 = nNume2; |QBF alfa2;
                    alfa3 = nNume3; |QBF alfa3;
                    aAlfa = alfa1 + " - " + alfa2 + " = " + alfa3;
                    |QBF aAlfa;

                    |PINTA 1225, aAlfa;
               |FINSI;

               |PAUSA;

               |SI FSalida = 14; |Y nNume2 > 0;
                    #0#33 = 1;
                    |PINTA #0#33;
                    Campo = 33;
                    |HAZ despu_uni;
                    #0#46 = nNume3;
                    |PINTA #0#46;
                    Campo = 46;
                    |HAZ despu_val;

                    #0#77 = 410;
                    |PINTA #0#77;
                    #0#34 = 1;
                    |PINTA #0#34;
                    Campo = 34;
                    |HAZ despu_uni;
                    #0#47 = nNume2;
                    |PINTA #0#47;
                    Campo = 47;
                    |HAZ despu_val;
               |FINSI;

               |POPV;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Mensa33; |TIPO 7;
     || al final se queda sin efecto la normativa de junio de 2014, saco
     || siempre el mensaje de cambiar si se tributa o no

     aAlfa1 = "    < F5 > cambia si se tributa o no a IRPF, < F6 > calculo normativa junio 2014";
     aAlfa2 = "    < F5 > cambia si se tributa o no a IRPF (concepto 410 o 415)";
     |SI ind = 415;
          |MENSA aAlfa2;
     |SINO;
          |MENSA aAlfa2;
     |FINSI;
|FPRC;

|PROCESO MensaBlanco; |TIPO 7;
     aAlfa = "       ";
     |MENSA aAlfa;
|FPRC;

/****************************************************************************/
/**************  PROCESOS PARA GRABAR LA SS A CARGO DE LA EMPRESA ***********/
/****************************************************************************/

|PROCESO SS_Empresa_Fin;
     |SI #labtraba#45 = "085"; |O #labtraba#45 = "421"; |O #labtraba#45 = "422";
          |SI #0#76 ! 0; |Y #30#172 ! 0;
               #nomcalca#173 = #nomconst#82;      || Comunes
               |SI #labtraba#190 = "S";
                    #nomcalca#174 = #nomconst#90;      || Desempleo
               |FINSI;
               |SI nElAny = 2015;
                    #nomcalca#175 = 2.33;      || FOGASA
                    #nomcalca#176 = 1.13;      || FP
               |FINSI;
               |SI nElAny ] 2016;
                    #nomcalca#175 = 2.35;      || FOGASA
                    #nomcalca#176 = 1.14;      || FP
               |FINSI;
               #nomcalca#177 = #nomconst#86 + #nomconst#87;      || AT + EP
               || #nomcalca#178 = ;      || LIBRE
               || Bonificaciones
               #nomcalca#180 = nBonifForEmp;
          |FINSI;
     |SINO;
          #nomcalca#173 = base_6 % por2_cont;      || Comunes
          |SI #labtraba#112 = "S";
               |SI nElAny [ 2018;
                    #nomcalca#173 = #nomcalca#173 + (#nomcalca#173 % 36);
               |SINO;
                    #nomcalca#173 = #nomcalca#173 + (#nomcalca#173 % 40);
               |FINSI;
          |FINSI;
          #nomcalca#174 = base_7 % #nomconst#12;      || Desempleo
          #nomcalca#175 = base_7 % #nomconst#14;      || FOGASA
          #nomcalca#176 = base_7 % #nomconst#16;      || FP
          #nomcalca#177 = base_9;      || AT + EP
          |SI #labtraba#42 = "A"; |O #labtraba#42 = "E";
               #nomcalca#177 = #nomcalcc#28 + #nomcalcc#30;   || AT + EP
          |FINSI;
          || #nomcalca#178 = ;      || LIBRE
          #nomcalca#179 = 0;
          || Bonificaciones
          #nomcalca#180 = (base_AB+base_C+zbase_AB+zbase_C+base_G);
          #nomcalca#180 = #nomcalca#180 + nBonifFCI;
          #nomcalca#180 = #nomcalca#180 + #nomcalca#148;
     |FINSI;
|FPRC;
