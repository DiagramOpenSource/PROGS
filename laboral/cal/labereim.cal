|FICHEROS;
     labtraba;
     labere01;
     labere02;
     labere03,MANTE;

     grid0001@;
     grid0002@;
     grid0003@;
|FIN;

|VARIABLES;
     nVentTra         = -1;
     nVent03          = -1;
     nRango           = -1;
     nCampo           = -1;
     nGrid1           = -1;
     nGrid2           = -1;
     nGrid3           = -1;
     nOrden           = 0;

     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aAlfa            = "";
     aTipo            = "";
     aBase            = "";
     aMas             = "";
     aFichero         = "";

     fFecha           = @;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &enGrid01        = -1;
     &enGrid02        = -1;
|FIN;

|PROCESO EventoGrid1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#grid0001@.=;

         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO EventoGrid2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#grid0002@.=;

         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO EventoGrid3;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#grid0003@.=;

         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO BajaGrid2;
     #grid0002@#0 = #labere01#0;
     #grid0002@#1 = #labere01#1;
     #grid0002@#5 = "1";
     #grid0002@#6 = 00001;
|FPRC;

|PROCESO AltaGrid2;
     #grid0002@#0 = #labere01#0;
     #grid0002@#1 = #labere01#1;
     #grid0002@#5 = "1";
     #grid0002@#6 = 99999;
|FPRC;

|PROCESO BajaGrid3;
     #grid0003@#0 = #labere01#0;
     #grid0003@#1 = #labere01#1;
     #grid0003@#5 = "2";
     #grid0003@#6 = 00001;
|FPRC;

|PROCESO AltaGrid3;
     #grid0003@#0 = #labere01#0;
     #grid0003@#1 = #labere01#1;
     #grid0003@#5 = "2";
     #grid0003@#6 = 99999;
|FPRC;

|PROCESO labtraba;
     |SI #labtraba#37 ! "          ";
         fFecha = #labtraba#37;
         |SI fFecha < #labere01#1;
             |ACABA;
         |FINSI;
     |FINSI;

     #labere02#0 = #labere01#0;
     #labere02#1 = #labere01#1;
     #labere02#2 = #labtraba#1;
     |LEE 000#labere02.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 253;  |HACIENDO nCampo = nCampo + 1;
           #grid0001@#nCampo# = #labtraba#nCampo#;
     |SIGUE;

     |GRABA 020#grid0001@.n;
     |LIBERA #grid0001@;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     77;
     #labere01#0, 00001, #labere01#3;
     #labere01#0, 99999, #labere01#4;
     ;
     NULL, labtraba;
|FIN;

|PROCESO AbajoIzq;
     |LEE 000#grid0001@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#grid0001@.=;

     |SELECT #1#grid0002@;

     |SELECT #2#labere02;
     #labere02#0 = #labere01#0;
     #labere02#1 = #labere01#1;
     #labere02#5 = "1";
     #labere02#6 = 9999999999;
     |LEE 000#labere02.];
     |SI FSalida = 0;
         |LEE 000#labere02.a;
     |SINO;
         |LEE 000#labere02.u;
     |FINSI;

     nOrden = 1;
     |SI FSalida = 0;  |Y #labere02#0 = #labere01#0;  |Y #labere02#1 = #labere01#1;
                       |Y #labere02#5 = "1";
         nOrden = #labere02#6 + 1;
     |FINSI;

     #grid0002@#0 = #labere01#0;
     #grid0002@#1 = #labere01#1;
     #grid0002@#2 = #grid0001@#1;
     #grid0002@#3 = #grid0001@#7;
     #grid0002@#4 = #grid0001@#2;
     #grid0002@#5 = "1";
     #grid0002@#6 = nOrden;

     |GRABA 020#grid0002@.n;
     |LIBERA #grid0002@;

     |BORRA 020#grid0001@.a;
     |LIBERA #grid0001@;

     |SELECT #2#grid0002@;

     |LEE 000#grid0001@.];
     |LEE 000#grid0002@.=;

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO ArribaIzq;
     |LEE 000#grid0002@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #grid0002@#0 ! #labere01#0;  |ACABA;   |FINSI;
     |SI #grid0002@#1 ! #labere01#1;  |ACABA;   |FINSI;

     |LEE 101#grid0002@.=;

     |ABRE #labtraba;
     #labtraba#0 = #grid0002@#0;
     #labtraba#1 = #grid0002@#2;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |PARA nCampo = 0;  |SI nCampo [ 253;  |HACIENDO nCampo = nCampo + 1;
           #grid0001@#nCampo# = #labtraba#nCampo#;
     |SIGUE;

     |GRABA 020#grid0001@.n;
     |LIBERA #grid0001@;

     |BORRA 020#grid0002@.a;
     |LIBERA #grid0002@;

     |LEE 000#grid0001@.=;
     |LEE 000#grid0002@.];

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;

     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO grid0001;
     |SI aTipo = "1";
         |SELECT #2#labere02;
         #labere02#0 = #labere01#0;
         #labere02#1 = #labere01#1;
         #labere02#5 = "1";
         #labere02#6 = 9999999999;
         |LEE 000#labere02.];
         |SI FSalida = 0;
             |LEE 000#labere02.a;
         |SINO;
             |LEE 000#labere02.u;
         |FINSI;

         nOrden = 1;
         |SI FSalida = 0;  |Y #labere02#0 = #labere01#0;  |Y #labere02#1 = #labere01#1;
                           |Y #labere02#5 = "1";
             nOrden = #labere02#6 + 1;
         |FINSI;

         #grid0002@#0 = #labere01#0;
         #grid0002@#1 = #labere01#1;
         #grid0002@#2 = #grid0001@#1;
         #grid0002@#3 = #grid0001@#7;
         #grid0002@#4 = #grid0001@#2;
         #grid0002@#5 = aTipo;
         #grid0002@#6 = nOrden;

         |GRABA 020#grid0002@.n;
         |LIBERA #grid0002@;
     |FINSI;

     |SI aTipo = "2";
         |SELECT #2#labere02;
         #labere02#0 = #labere01#0;
         #labere02#1 = #labere01#1;
         #labere02#5 = "2";
         #labere02#6 = 9999999999;
         |LEE 000#labere02.];
         |SI FSalida = 0;
             |LEE 000#labere02.a;
         |SINO;
             |LEE 000#labere02.u;
         |FINSI;

         nOrden = 1;
         |SI FSalida = 0;  |Y #labere02#0 = #labere01#0;  |Y #labere02#1 = #labere01#1;
                           |Y #labere02#5 = "2";
             nOrden = #labere02#6 + 1;
         |FINSI;

         #grid0003@#0 = #labere01#0;
         #grid0003@#1 = #labere01#1;
         #grid0003@#2 = #grid0001@#1;
         #grid0003@#3 = #grid0001@#7;
         #grid0003@#4 = #grid0001@#2;
         #grid0003@#5 = aTipo;
         #grid0003@#6 = nOrden;

         |GRABA 020#grid0003@.n;
         |LIBERA #grid0003@;
     |FINSI;

     |BORRA 020#grid0001@.a;
     |LIBERA #grid0001@;
|FPRC;

|DEFBUCLE grid0001;
     #grid0001@#1002;
     ;
     00000, 00000;
     99999, 99999;
     be;
     NULL, grid0001;
|FIN;

|PROCESO TodosAbajoIzq;
     |SELECT #1#grid0002@;
     aTipo = "1";
     |BUCLE grid0001;

     |SELECT #2#grid0002@;

     |LEE 000#grid0001@.];
     |LEE 000#grid0002@.=;

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO grid0002;
     #labtraba#0 = #grid0002@#0;
     #labtraba#1 = #grid0002@#2;
     |LEE 000#labtraba.=;

     |PARA nCampo = 0;  |SI nCampo [ 253;  |HACIENDO nCampo = nCampo + 1;
           #grid0001@#nCampo# = #labtraba#nCampo#;
     |SIGUE;

     |GRABA 020#grid0001@.n;
     |LIBERA #grid0001@;

     |BORRA 020#grid0002@.a;
     |LIBERA #grid0002@;
|FPRC;

|DEFBUCLE grid0002;
     #grid0002@#2004;
     ;
     #labere01#0, #labere01#1, "1", 00001;
     #labere01#0, #labere01#1, "1", 99999;
     be;
     NULL, grid0002;
|FIN;

|PROCESO TodosArribaIzq;
     |SELECT #1#grid0002@;

     |ABRE #labtraba;
     |BUCLE grid0002;
     |CIERRA #labtraba;

     |SELECT #2#grid0002@;

     |LEE 000#grid0001@.=;
     |LEE 000#grid0002@.];

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO AbajoDer;
     |LEE 000#grid0001@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#grid0001@.=;

     |SELECT #2#labere02;
     #labere02#0 = #labere01#0;
     #labere02#1 = #labere01#1;
     #labere02#5 = "2";
     #labere02#6 = 9999999999;
     |LEE 000#labere02.];
     |SI FSalida = 0;
         |LEE 000#labere02.a;
     |SINO;
         |LEE 000#labere02.u;
     |FINSI;

     nOrden = 1;
     |SI FSalida = 0;  |Y #labere02#0 = #labere01#0;  |Y #labere02#1 = #labere01#1;
                       |Y #labere02#5 = "2";
         nOrden = #labere02#6 + 1;
     |FINSI;

     |SELECT #1#grid0003@;

     #grid0003@#0 = #labere01#0;
     #grid0003@#1 = #labere01#1;
     #grid0003@#2 = #grid0001@#1;
     #grid0003@#3 = #grid0001@#7;
     #grid0003@#4 = #grid0001@#2;
     #grid0003@#5 = "2";
     #grid0003@#6 = nOrden;

     |GRABA 020#grid0003@.n;
     |LIBERA #grid0003@;

     |BORRA 020#grid0001@.a;
     |LIBERA #grid0001@;

     |SELECT #2#grid0003@;

     |LEE 000#grid0001@.];
     |LEE 000#grid0003@.=;

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid3;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO ArribaDer;
     |LEE 000#grid0003@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #grid0003@#0 ! #labere01#0;  |ACABA;   |FINSI;
     |SI #grid0003@#1 ! #labere01#1;  |ACABA;   |FINSI;

     |LEE 101#grid0003@.=;

     |ABRE #labtraba;
     #labtraba#0 = #grid0003@#0;
     #labtraba#1 = #grid0003@#2;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |PARA nCampo = 0;  |SI nCampo [ 253;  |HACIENDO nCampo = nCampo + 1;
           #grid0001@#nCampo# = #labtraba#nCampo#;
     |SIGUE;

     |GRABA 020#grid0001@.n;
     |LIBERA #grid0001@;

     |BORRA 020#grid0003@.a;
     |LIBERA #grid0003@;

     |LEE 000#grid0001@.=;
     |LEE 000#grid0003@.];

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid3;

     |FOCOTECLADO nGrid3;
|FPRC;

|PROCESO TodosAbajoDer;
     |SELECT #1#grid0003@;
     aTipo = "2";
     |BUCLE grid0001;

     |SELECT #2#grid0003@;

     |LEE 000#grid0001@.];
     |LEE 000#grid0003@.=;

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid3;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO grid0003;
     #labtraba#0 = #grid0003@#0;
     #labtraba#1 = #grid0003@#2;
     |LEE 000#labtraba.=;

     |PARA nCampo = 0;  |SI nCampo [ 253;  |HACIENDO nCampo = nCampo + 1;
           #grid0001@#nCampo# = #labtraba#nCampo#;
     |SIGUE;

     |GRABA 020#grid0001@.n;
     |LIBERA #grid0001@;

     |BORRA 020#grid0003@.a;
     |LIBERA #grid0003@;
|FPRC;

|DEFBUCLE grid0003;
     #grid0003@#2004;
     ;
     #labere01#0, #labere01#1, "2", 00001;
     #labere01#0, #labere01#1, "2", 99999;
     be;
     NULL, grid0003;
|FIN;

|PROCESO TodosArribaDer;
     |SELECT #1#grid0003@;

     |ABRE #labtraba;
     |BUCLE grid0003;
     |CIERRA #labtraba;

     |SELECT #2#grid0003@;

     |LEE 000#grid0001@.=;
     |LEE 000#grid0003@.];

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid3;

     |FOCOTECLADO nGrid1;
|FPRC;

|PROCESO Centros;
     |LEE 101#labere01.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1390, -1, 16, "L¡mites de Centros";
     nVent03 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent03;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |C_M #labere03#0, 1, "N";
     |C_M #labere03#1, 1, "N";

     |DDEFECTO #labere03;
     #labere03#0 = #labere01#0;
     #labere03#1 = #labere01#1;
     #labere03#2 = #labere01#2;
     #labere03#3 = #labere01#3;
     #labere03#4 = #labere01#4;

     |PINPA #0#labere03;
     |PINDA #0#labere03;

     |ENDATOS #1#labere03;
     |SI FSalida = 0;
         #labere01#3 = #labere03#3;
         #labere01#4 = #labere03#4;
         |GRABA 020#labere01.a;
         |LIBERA #labere01;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent03;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent03;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTra;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CIERRA #grid0001@;  |DELINDEX #grid0001@;
     |ABRE #grid0001@;
     |SELECT #1#labere02;
     |BUCLE labtraba;
     |SELECT #2#labere02;

     |REFRESCACONTROL nGrid1;
|FPRC;


|PROCESO BtnImportar;
     |VENTANA 0501, 3599, -1, 16, "Importar trabajadores";
     nVentTra = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTra;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aAlfa = "LABEL,{{16}}Trabajadores de alta en la empresa antes de la fecha de la solicitud";
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0570, NULL;

     aAlfa = "LABEL,{{16}}Trabajadores afectados";
     |CONTROL_SIMPLE 0, aAlfa, 2002, 2020, NULL;

     aAlfa = "LABEL,{{16}}Trabajadores NO afectados";
     |CONTROL_SIMPLE 0, aAlfa, 2051, 2098, NULL;

     aAlfa = "LABEL,{{10}}Trabajador seleccionado";
     |CONTROL_SIMPLE 0, aAlfa, 1802, 1915, NULL;
     |CONTROL_SIMPLE 0, aAlfa, 1851, 1964, NULL;

     aAlfa = "LABEL,{{10}}Todos los trabajadores";
     |CONTROL_SIMPLE 0, aAlfa, 1825, 1938, NULL;
     |CONTROL_SIMPLE 0, aAlfa, 1874, 1987, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{232}}", 1816, 1919, AbajoIzq;
     |CONTROL_SIMPLE 0, "BOTON,{{231}}", 1821, 1924, ArribaIzq;
     |CONTROL_SIMPLE 0, "BOTON,{{235}}", 1839, 1942, TodosAbajoIzq;
     |CONTROL_SIMPLE 0, "BOTON,{{234}}", 1844, 1947, TodosArribaIzq;

     |CONTROL_SIMPLE 0, "BOTON,{{232}}", 1865, 1968, AbajoDer;
     |CONTROL_SIMPLE 0, "BOTON,{{231}}", 1870, 1973, ArribaDer;
     |CONTROL_SIMPLE 0, "BOTON,{{235}}", 1889, 1992, TodosAbajoDer;
     |CONTROL_SIMPLE 0, "BOTON,{{234}}", 1894, 1997, TodosArribaDer;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}L¡mites de centros", 0580, 0597, Centros;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/labtraba.mas";  |CARGA_DEF aMas, grid0001@;
     aMas = aBase + "def/labere02.mas";  |CARGA_DEF aMas, grid0002@;
     aMas = aBase + "def/labere02.mas";  |CARGA_DEF aMas, grid0003@;

     aFichero = ("e1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #grid0001@#aFichero#;

     |ABRE #grid0002@;
     |ABRE #grid0003@;

     |ABRE #grid0001@;  |CIERRA #grid0001@;  |DELINDEX #grid0001@;
     |ABRE #grid0001@;
     |SELECT #1#labere02;
     |BUCLE labtraba;
     |SELECT #2#labere02;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#grid0001@, nRango, 0602, 1798, NULL, NULL, EventoGrid1;
     nGrid1 = FSalida;

     |LINEAL_SIMPLE #2#grid0002@, nRango, 2102, 3449, BajaGrid2, AltaGrid2, EventoGrid2;
     nGrid2 = FSalida;

     |LINEAL_SIMPLE #2#grid0003@, nRango, 2151, 3498, BajaGrid3, AltaGrid3, EventoGrid3;
     nGrid3 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #grid0001@;
     |CIERRA #grid0002@;
     |CIERRA #grid0003@;

     |DELINDEX #grid0001@;

     |DESCARGA_DEF #grid0003@;
     |DESCARGA_DEF #grid0002@;
     |DESCARGA_DEF #grid0001@;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTra;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTra;

     |REFRESCACONTROL enGrid01;
     |REFRESCACONTROL enGrid02;
|FPRC;
