|FICHEROS;
     gomcalcu #0;
     gomcot12;
     labtraba;
     nomconli;
     nombonif;
     nomepigr;
     nombonif;
     nomconst;
     nomcalca;
     nomcalcc;
     nomvarca;
     nomvarli;
     nomhicca;
     nomcontr;
     gomdetjr;
     gomdesjr;
|FIN;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     &fCFechaCot = @;
     &aCErrorCot = "";

     aAlfa = "";
     &swMensual = 0;
     &base_5 = 0;
     &acum_10 = 0;
     &dvalo_pro = 0;
     &base_A = 0; &zbase_A = 0;
     &base_B = 0; &zbase_B = 0;
     &base_C = 0; &zbase_C = 0;
     &base_D = 0;
     &base_E = 0;
     &base_F = 0; &zbase_F = 0;
     &base_M = 0;
     &bbase_A = 0;
     &bbase_B = 0;
     &bbase_C = 0;
     &basemat_B = 0;
     &base_6 = 0;
     &base_7 = 0;
     &base_8 = 0;
     &base_77 = 0;
     &base_11 = 0;
     &dacum_30 = 0;
     &dacum_31 = 0;
     &por1_cont = 0;
     &por1_dfpg = 0;
     &por1_hor1 = 0;
     &por1_hor2 = 0;
     &por2_hor1 = 0;
     &por2_hor2 = 0;
     &dcont_2 = 0;
     &prom_enf = 0;
     &prom_acc = 0;
     &coba_1 = 0;
     &cobb_1 = 0;
     &coba_2 = 0;
     &cobb_2 = 0;
     &coba_3 = 0;
     &coba_4 = 0;
     &cobb_4 = 0;
     nTopeMaxMen = 0;
     nTopeMaxJor = 0;
     nume1 = 0;
     nume2 = 0;
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     &denfe_2 = 0;
     &dacci_2 = 0;
     &dmate_2 = 0;
     &dabse_2 = 0;
     &swAjuste3 = 0;
     &dcoti_0 = 0;
     &fijo_1 = 0;
     &fijo_1_red = 0;
     &jornadasIT = 0;
     &nReduccion = 0;
     &por2_cont = 0;
     nLimiteAltaMens = 0;
     nLimiteAltaJor = 0;
     nLimiteJor = 0;
     swTabla = 0;
     swFormula = 0;
     &swJornadas = 0;
     &nBasePorJornada = 0;
     &nBasePorJornada_red = 0;
     nGrupo = 0;
     nPar1 = 0;
     nPar2 = 0;
     nDiasCotIT = 0;
     &basemat_C = 0;

     &dboni_1 = 0;
     &horasex = 0;
     &por2_dfpg = 0;
     &sw_tope = 0;
     &nBaseATEP = 0;
     &nATEP_Alta = 0;
     &base_9 = 0;
     &epig_ilt = 0;
     &epig_ims = 0;
     &pilt_enf = 0;
     &pilt_ATEP = 0;
     &nATEP_IT = 0;
     &nPorBon1 = 0;
     &nPorBon2 = 0;
     &bon_0 = 0;
     &bon_3 = 0;
     &zbase_9 = 0;
     &jornadasEA = 0;
     &bbon_0 = 0;
     &bbon_3 = 0;
     &bbon_5 = 0;
     &dboni_2 = 0;
     &zbon_0 = 0;
     &zbon_3 = 0;
     &zbon_5 = 0;
     &bbase_F = 0;
     &cbon_3 = 0;
     &nBonifFCI = 0;
     &bon_59 = 0;
     &bon_60 = 0;
     &denfe_A = 0;
     &denfe_B = 0;
     &denfe_C = 0;
     &denfe_D = 0;
     &nDiasPagoSS = 0;
     &nBasePagoSS_CC = 0;
     &nBasePagoSS_CP = 0;
     &nJornPagoSS = 0;
     &nJornPagoSS_Mat = 0;
     &nDiasPagoSS_SinMat = 0;
     &nJornPagoSS_SinMat = 0;
     &nBasePagoSS_CC_SinMat = 0;
     &nBasePagoSS_CP_SinMat = 0;
     &guarda = 0;
     &prom_ac2 = 0;
     &nBase = 0;
     &swBaseFija = 0;
     &lin_1 = 0;
     &lin_2 = 0;
     &dto_con = 0;
     &dto_dfp = 0;
     &dto_ho1 = 0;
     &dto_ho2 = 0;
     &dilt = 0;
     &bon_1 = 0;
     &bon_2 = 0;
     &bon_5 = 0;
     nTopeMin = 0;
     nCampo = 0;
     FEstado = 0;
     aTopeadaCC = "";
     aTopeadaCP = "";
     nTipoInicialCC = 0;
     aTipoReduccion = 0;

     &nBaseAlta = 0;
     &nBaseIT = 0;
     nRedCC_Alta = 0;
     nRedCC_IT = 0;
     nRedDes_Alta = 0;
     nRedDes_IT = 0;

     &nImporteRedCC_Alta = 0;
     &nImporteRedCC_IT = 0;
     &nImporteRedDes_Alta = 0;
     &nImporteRedDes_IT = 0;

     por2_cont_alta = 0;
     por2_des_alta = 0;

     &nCuotaCC_Alta = 0;
     nCuotaCC_IT = 0;
     nCuotaDes_Alta = 0;
     nCuotaDes_IT = 0;
     nCuotaFPFog = 0;

     nTipoInicialCC_Alta = 0;
     nTipoInicialCC_IT = 0;
     nTipoInicialDes = 0;
     nBaseAltaDia = 0;
     &nDiasAlta = 0;

     dias_tope = 0;
     nMax_cp = 0;
     nMin_cp = 0;
     &grupo = 0;
     &propo = 0;
     nRed_CC = 0;

     &denfe_cot = 0;
     &dacci_cot = 0;
     &dmate_cot = 0;
     &nRedCCEnf = 0;
     &nRedDesEnf = 0;
     &nRedCCMat = 0;
     &nRedDesMat = 0;
     &nRedCCAcc = 0;
     &nRedDesAcc = 0;
     &nRedCCEnfEmp = 0;
     &nRedDesEnfEmp = 0;
     &nBaseITDiaJorCC = 0;
     &nBaseITDiaJorDes = 0;
     swPrevio = 0;
     &prom_enf_previo = 0;
     &prom_acc_previo = 0;
     &dcobr_0 = 0;
     nDiasEnfPagoDir = 0;
     nNume = 0;
     nJornadasEnf = 0;
     nJornadasAcc = 0;
     nJornadasMat = 0;
     swHay93X = 0;
     nConcepto = 0;
     nDesdeAny = 0;
     nHastaAny = 0;
     aNif = "";
     &nDesem = 0;
     &nJornadasERE = 0;
     &ddese_2 = 0;
     &nBonifERE = 0;
     nDtoCCTra = 0;
     nDtoCPTra = 0;
     aModulo = "";
     jornadasIT_red = 0;
     nBaseIT_red = 0;

     nBaseATEP_red = 0;
     nATEP_IT_red = 0;
     nDifJor = 0;

     nLimite = 0;
     &nElAny = 0;
     nDifCC = 0;
     nDifCP = 0;

     &nCuotaCCAlta = 0;
     nLimMenG1 = 0;
     nLimMenResto = 0;

     &nJorITCotEmp = 0;
     &nJorITCotEmpTra = 0;
     &n400Cot = 0;

     &dto_sol_emp = 0;
     &dto_sol_tra = 0;
     &aDesIncid = "";
     &nIncid = 0;
     &swIniLog = 0;
     nPropBon = 0;

     ddese_cot = 0;
     &aUltimaIT = "";

     nCuantas = 0;
     aTipo = "";
     nIT = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nDesde = 0;
     nHasta = 0;
     &dalta_3 = 0;
     &dbaja_3 = 0;
     nCampoDes = 0;
     nAcum = 0;
     nDias = 0;
     nJor = 0;
     nJornadas_A = 0;
     nJornadas_B = 0;
     nDia = 0;
     nDiaIT = 0;
     &nPrestacionEnf = 0;
     nCasilla = 0;
     swNoTopees = 0;

     nDtoFPTra = 0;
     nDtoDesTra = 0;

     nDtoCCEmp = 0;
     nDtoDesEmp = 0;
     nDtoFogEmp = 0;
     nDtoFPEmp = 0;
     nCuotaFP = 0;
     nCuotaFog = 0;

     &fCFecha = @;
     &aCError = "";
     &nCConst = 0;

     nTopeMinHor = 0;
     swParteIT = 0;
     nMaximoJor = 0;
     nBase6 = 0;
     nBase7 = 0;
     swLimJorComoMen = 0;
     &topemes = 0;
     &dreca_0 = 0;
     &dreca_1 = 0;
     &dreca_2 = 0;
     &dreca_3 = 0;
     &dreca_4 = 0;
     sw22oMas = 0;
|FIN;

|PROCESO DesgloseDias;
     denfe_cot = 0;
     dacci_cot = 0;
     dmate_cot = 0;
     nRedCCEnf = 0;
     nRedDesEnf = 0;
     nRedCCMat = 0;
     nRedDesMat = 0;
     nRedCCAcc = 0;
     nRedDesAcc = 0;
     nRedCCEnfEmp = 0;
     nRedDesEnfEmp = 0;
     nDiasEnfPagoDir = 0;

     |SI swMensual = 1;
          |HAZ AjusteMensuales;
     |FINSI;

     |SI swMensual = 1;
          nBaseITDiaJorCC = (nBaseIT - nDesem) / (#nomcalcc#52 - ddese_2);
          nBaseITDiaJorDes = (nATEP_IT - nDesem) / (#nomcalcc#52 - ddese_2);
     |SINO;
          nBaseITDiaJorCC = (nBaseIT - nDesem) / (#nomcalcc#52 - nJornadasERE);
          nBaseITDiaJorDes = (nATEP_IT - nDesem) / (#nomcalcc#52 - nJornadasERE);
     |FINSI;

     |SI denfe_B ! 0; |O denfe_C ! 0;
          nDiasEnfPagoDir = denfe_B + denfe_C;
          |SI aUltimaIT = "E";
               nDiasEnfPagoDir = nDiasEnfPagoDir - swAjuste3;
          |FINSI;
     |FINSI;
     |SI nDiasEnfPagoDir < 0;
          nDiasEnfPagoDir = 0;
     |FINSI;
     |SI swMensual = 1;
          nRedCCEnf = (((denfe_cot - nDiasEnfPagoDir) * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
          nRedDesEnf = (((denfe_cot - nDiasEnfPagoDir) * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
          |SI #nombonif#10 = 4;
               nNume1 = (((denfe_cot - nDiasEnfPagoDir) * nBaseITDiaJorCC) % por2_cont) ! 2;
               nNume2 = (((denfe_cot - nDiasEnfPagoDir) * nBaseITDiaJorCC) % #nombonif#4) ! 2;
               nNume3 = nNume1 - nNume2;
               nRedCCEnf = (((denfe_cot - nDiasEnfPagoDir) * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
               |SI nRedCCEnf > nNume3;
                    nRedCCEnf = nNume3;
               |FINSI;
          |FINSI;

          nRedCCMat = ((dmate_cot * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
          nRedDesMat = ((dmate_cot * nBaseITDiaJorDes) % nRedDes_IT) ! 2;

          nRedCCMat = nRedCCMat + ((nDesem % nRedCC_IT) ! 2);
          || nRedDesMat = nRedDesMat + ((nDesem % nRedDes_IT) ! 2);

          nRedCCAcc = ((dacci_cot * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
          nRedDesAcc = ((dacci_cot * nBaseITDiaJorDes) % nRedDes_IT) ! 2;

          nRedCCEnfEmp = ((nDiasEnfPagoDir * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
          nRedDesEnfEmp = ((nDiasEnfPagoDir * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
          |SI #nombonif#10 = 4;
               nNume1 = ((nDiasEnfPagoDir * nBaseITDiaJorCC) % por2_cont) ! 2;
               nNume2 = ((nDiasEnfPagoDir * nBaseITDiaJorCC) % #nombonif#4) ! 2;
               nNume3 = nNume1 - nNume2;
               nRedCCEnfEmp = ((nDiasEnfPagoDir * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
               |SI nRedCCEnfEmp > nNume3;
                    nRedCCEnfEmp = nNume3;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swJornadas = 1;
          || en caso de jornadas no desgloso, es un follon demasiado
          || grande, si nos viene algun trabajador con jornadas con
          || mas de un tipo de IT lo trataremos entonces

          denfe_cot = denfe_2;
          dacci_cot = dacci_2;
          dmate_cot = dmate_2;
          ddese_cot = ddese_2;

          |SI swHay93X ! 0;
               || nada de esto tiene validez, ya que estos conceptos los dejamos ya
               || de usar, ya que las jornadas por cada IT vendran del calendario
               nNume = nJornadasEnf - (nJornPagoSS - nJornadasAcc - nJornadasMat);
               nRedCCEnf = ((nNume * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
               nRedDesEnf = ((nNume * nBaseITDiaJorDes) % nRedDes_IT) ! 2;

               nRedCCMat = ((nJornadasMat * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
               nRedDesMat = ((nJornadasMat * nBaseITDiaJorDes) % nRedDes_IT) ! 2;

               nRedCCAcc = ((nJornadasAcc * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
               nRedDesAcc = ((nJornadasAcc * nBaseITDiaJorDes) % nRedDes_IT) ! 2;

               nNume = nJornPagoSS - nJornadasAcc - nJornadasMat;
               nRedCCEnfEmp = ((nNume * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
               nRedDesEnfEmp = ((nNume * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
          |SINO;
               nDifJor = jornadasIT - jornadasIT_red;
               |SI denfe_cot ! 0;
                    nRedCCEnf = (((jornadasIT - nJornPagoSS - nDifJor) * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
                    nRedDesEnf = (((jornadasIT - nJornPagoSS - nDifJor) * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
                    |SI nDifJor > 0; nDifJor = 0; |FINSI;
               |FINSI;
               |SI denfe_cot = 0; |Y dmate_cot ! 0;
                    nRedCCMat = (((jornadasIT - nDifJor) * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
                    nRedDesMat = (((jornadasIT - nDifJor) * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
                    |SI nDifJor > 0; nDifJor = 0; |FINSI;
               |FINSI;
               |SI nDesem ! 0;
                    nRedCCMat = nRedCCMat + ((nDesem % nRedCC_IT) ! 2);
                    || nRedDesMat = nRedDesMat + ((nDesem % nRedDes_IT) ! 2);
               |FINSI;
               |SI denfe_cot = 0; |Y dmate_cot = 0; |Y dacci_cot ! 0;
                    nRedCCAcc = (((jornadasIT - nDifJor) * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
                    nRedDesAcc = (((jornadasIT - nDifJor) * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
                    |SI nDifJor > 0; nDifJor = 0; |FINSI;
               |FINSI;
               |SI nDiasEnfPagoDir > 0;
                    nRedCCEnfEmp = (((nJornPagoSS - nDifJor) * nBaseITDiaJorCC) % nRedCC_IT) ! 2;
                    nRedDesEnfEmp = (((nJornPagoSS - nDifJor) * nBaseITDiaJorDes) % nRedDes_IT) ! 2;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaCotiz;
     |MODULO aModulo; |QBF aModulo;
     |SI aModulo = "gomcalc1";
          |ACABA;
     |FINSI;

     |ABRE #nomcalcc;
     #nomcalcc#0 = #nomcalca#0;
     #nomcalcc#1 = #nomcalca#1;
     #nomcalcc#2 = #0#9;
     #nomcalcc#3 = #0#8;
     #nomcalcc#4 = #nomcalca#3;
     |LEE 101#nomcalcc.=;
     |SI FSalida = 0;
          |BORRA 020#nomcalcc.a;
     |FINSI;
     |DDEFECTO #nomcalcc;

     #nomcalcc#0 = #nomcalca#0;
     #nomcalcc#1 = #nomcalca#1;
     #nomcalcc#2 = #0#9;
     #nomcalcc#3 = #0#8;
     #nomcalcc#4 = #nomcalca#3;
     #nomcalcc#5 = #nomcalca#37;             || remuneracion
     #nomcalcc#6 = #nomcalca#38;             || prorrata
     #nomcalcc#7 = #nomcalca#37 + #nomcalca#38;   || remun + prorr
     #nomcalcc#8 = aTopeadaCC;
     #nomcalcc#57 = aTopeadaCP;
     #nomcalcc#50 = #labtraba#42;
     |SI swMensual = 1;
          #nomcalcc#9 = #nomcalca#8;
          |SI dcoti_0 ] 30; |Y nDiasCotIT = 0;
               #nomcalcc#17 = nLimiteAltaMens;
               #nomcalcc#48 = base_6;
               #nomcalcc#49 = base_6;
          |SINO;
               #nomcalcc#17 = nLimiteAltaMens;
               #nomcalcc#48 = nBaseAltaDia;
               #nomcalcc#49 = nBaseAltaDia;
          |FINSI;
          #nomcalcc#12 = nBaseAltaDia;
          #nomcalcc#51 = nDiasAlta;
          #nomcalcc#52 = nDiasCotIT + ddese_2;
     |SINO;
          #nomcalcc#9 = fijo_1 + jornadasIT;
          #nomcalcc#12 = nBasePorJornada;
          #nomcalcc#17 = nLimiteAltaJor;
          || #nomcalcc#48 = nBasePorJornada;
          || #nomcalcc#49 = nBasePorJornada;
          #nomcalcc#48 = nBasePorJornada_red;
          #nomcalcc#49 = nBasePorJornada_red;
          #nomcalcc#51 = fijo_1_red;
          #nomcalcc#52 = jornadasIT;
     |FINSI;

     #nomcalcc#10 = #nomcalca#39;             || base cc
     #nomcalcc#11 = #nomcalca#40;            || base cp
     #nomcalcc#15 = nReduccion;
     |SI #labtraba#33 = 01;
          #nomcalcc#14 = "fija";
     |SINO;
          |SI swTabla = 1;
               #nomcalcc#14 = "tabla";
          |FINSI;
          |SI swFormula = 1;
               #nomcalcc#14 = "f¢rmula";
          |FINSI;
     |FINSI;

     #nomcalcc#18 = 2.52;
     #nomcalcc#19 = 6.15;

     #nomcalcc#16 = por2_cont;
     #nomcalcc#20 = base_6 % #nomcalcc#16;   || cuota comunes
     #nomcalcc#21 = #nomconst#12;            || % desempleo
     #nomcalcc#22 = base_7 % #nomcalcc#21;   || cuota desempleo

     #nomcalcc#23 = #nomconst#14;            || % fogasa
     #nomcalcc#24 = (nATEP_Alta + nATEP_IT) % #nomcalcc#23;   || cuota fogasa
     #nomcalcc#25 = #nomconst#16;            || % FP
     #nomcalcc#26 = (nATEP_Alta + nATEP_IT) % #nomcalcc#25;   || cuota FP

     #nomcalcc#27 = epig_ilt;
     #nomcalcc#28 = ((nATEP_Alta % epig_ilt) ! 2) + ((nATEP_IT % epig_ilt) ! 2);
     #nomcalcc#29 = epig_ims;
     #nomcalcc#30 = ((nATEP_Alta % epig_ims) ! 2) + ((nATEP_IT % epig_ims) ! 2);

     #nomcalcc#32 = nBaseAlta;
     #nomcalcc#13 = por2_cont;
     #nomcalcc#20 = nCuotaCC_Alta;
     #nomcalcc#15 = nRedCC_Alta;
     #nomcalcc#42 = nImporteRedCC_Alta;
     #nomcalcc#45 = nCuotaCC_Alta - nImporteRedCC_Alta;
     #nomcalcc#21 = por2_des_alta;
     #nomcalcc#22 = nCuotaDes_Alta;
     #nomcalcc#26 = nCuotaFP;

     #nomcalcc#33 = nBaseIT;
     #nomcalcc#34 = por2_cont;
     #nomcalcc#39 = nCuotaCC_IT;
     #nomcalcc#36 = nRedCC_IT;
     #nomcalcc#43 = nImporteRedCC_IT;
     #nomcalcc#46 = nCuotaCC_IT - nImporteRedCC_IT;
     #nomcalcc#40 = por2_des_alta;
     #nomcalcc#41 = nCuotaDes_IT;
     #nomcalcc#37 = nRedDes_IT;
     #nomcalcc#44 = nImporteRedDes_IT
     #nomcalcc#47 = nCuotaDes_IT - nImporteRedDes_IT

     |HAZ DesgloseDias;

     #nomcalcc#53 = nATEP_Alta;
     #nomcalcc#54 = nATEP_IT;

     || SS EMPRESA INICIAL:
     #nomcalcc#31 = #nomcalcc#45 + #nomcalcc#22;
     #nomcalcc#31 = #nomcalcc#31 + #nomcalcc#46 + #nomcalcc#47;
     #nomcalcc#31 = #nomcalcc#31 + #nomcalcc#24 + #nomcalcc#26;
     #nomcalcc#31 = #nomcalcc#31 + #nomcalcc#28 + #nomcalcc#30;

     || BONIFICACIONES
     #nomcalcc#55 = #nomcalca#63 + #nomcalca#81 + #nomcalca#64 + #nomcalca#101;
     #nomcalcc#55 = #nomcalcc#55 + #nomcalca#106 + #nomcalca#88 + #nomcalca#96;
     #nomcalcc#55 = #nomcalcc#55 + #nomcalca#133 + #nomcalca#102 + #nomcalca#125;

     || SS TOTAL EMP - BONIFICACIONES
     #nomcalcc#56 = #nomcalcc#31 - #nomcalcc#55;

     |GRABA 020#nomcalcc.n;

     |LIBERA #nomcalcc;
     |CIERRA #nomcalcc;
|FPRC;

|PROCESO LeeTopesReduc;       || proceso para leer los topes y reducciones de
                              || contingencias comunes

     alfa1 = "01";
     alfa2 = #0#8;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#9;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     |MODULO aModulo; |QBF aModulo;
     fCFechaCot = alfa4;         || primer dia de mes de calculo
     aCErrorCot = "";            || inicializo errores
     |HAZ LeeRedMaxAgr;
     |SI aCErrorCot ! ""; |Y aModulo ! "gomcalc1";
          |MENAV aCErrorCot;
     |FINSI;
|FPRC;

|PROCESO reducciones12;
     || reducciones al tipo de cotizacion que se aplica para hallar la
     || cuota empresarial segun normativa del 2012

     || por2_cont es el % que teniamos, aplicamos reduccion

     sw22oMas = 0;
     nReduccion = 0;
     swTabla = 0;
     swFormula = 0;
     nLimiteAltaMens = 0;
     nLimiteAltaJor = 0;
     nDiasCotIT = (denfe_2 + dacci_2 + dmate_2) - swAjuste3;
     nDiasAlta = dcoti_0 - nDiasCotIT;
     nBaseAltaDia = nBaseAlta / nDiasAlta;

     |SI #labtraba#33 = 01;
          || para el grupo 01, de momento a pelo
          por2_cont = 23.60;
          nTipoInicialCC = por2_cont;
          nReduccion = #gomcot12#1;
     |FINSI;
     |SI #labtraba#33 ] 02;
          |SI nDesem > 0;
               nBaseAlta = nBaseAlta + nDesem;
               nBaseAltaDia = nBaseAlta / (nDiasAlta + ddese_2);
          |FINSI;

          |SI swMensual = 1;
               || limite para trabajadores mensuales para saber si aplico
               || la tabla o la formula basa en la tabla tambien
               |SI dcoti_0 ] 30; |Y nDiasCotIT = 0;
                    nLimiteAltaMens = #gomcot12#12;
                    |SI nBaseAlta [ nLimiteAltaMens;
                         swTabla = 1;
                    |SINO;
                         swFormula = 1;
                    |FINSI;
               |SINO;
                    nLimiteAltaMens = #gomcot12#12 / 30;
                    |SI nBaseAltaDia [ nLimiteAltaMens;
                         swTabla = 1;
                    |SINO;
                         swFormula = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI swJornadas = 1;
               nLimiteAltaJor = #gomcot12#13;
               || SI nBasePorJornada [ nLimiteAltaJor;
               |SI nBasePorJornada_red [ nLimiteAltaJor;
                    swTabla = 1;
               |SINO;
                    swFormula = 1;
               |FINSI;

               || si aun siendo por jornadas, tenemos 22 jornadas o mas
               || la reduccion se trata como si fuera MENSUAL con 30 dias
               || de alta, es asi

               sw22oMas = 0;
               nNume1 = (fijo_1 + jornadasIT);
               |SI #0#9 ] 2019; |Y nNume1 ] 22
                    sw22oMas = 1;
                    nLimiteAltaMens = #gomcot12#12;
               |FINSI;
          |FINSI;

          nGrupo = #labtraba#33;
          |SI swTabla = 1;
               nReduccion = #gomcot12#nGrupo#;
          |FINSI;
          |SI swFormula = 1;
               |SI swMensual = 1;
                    |SI dcoti_0 ] 30; |Y nDiasCotIT = 0;
                         nPar1 = (nBaseAlta - nLimiteAltaMens) / base_6;
                    |SINO;
                         nPar1 = (nBaseAltaDia - nLimiteAltaMens) / nBaseAltaDia;
                    |FINSI;
                    nPar2 = 6.15 / #gomcot12#nGrupo#;
                    nReduccion = #gomcot12#nGrupo# * (1 + (nPar1 * 2.52 * nPar2));
                    nReduccion = nReduccion ! 2;
               |FINSI;
               |SI swJornadas = 1;
                    |SI sw22oMas = 1;
                         nPar1 = (base_6 - nLimiteAltaMens) / base_6;
                    |SINO;
                         nPar1 = (nBasePorJornada_red - nLimiteAltaJor) / nBasePorJornada_red;
                         || nPar1 = (nBasePorJornada - nLimiteAltaJor) / nBasePorJornada;
                    |FINSI;
                    nPar2 = 6.15 / #gomcot12#nGrupo#;
                    nReduccion = #gomcot12#nGrupo# * (1 + (nPar1 * 2.52 * nPar2));
                    nReduccion = nReduccion ! 2;
               |FINSI;
          |FINSI;
          |SI nDesem > 0;
               nBaseAlta = nBaseAlta - nDesem;
               || para que se guarde la correcta
          |FINSI;
     |FINSI;

     || paso a variables finales

     nRedCC_Alta = nReduccion;
     nGrupo = #labtraba#33;
     nCampo = nGrupo + 15;
     nRedCC_IT = #gomcot12#nCampo#;
     |SI nDesem > 0;
          nRedCC_IT = nReduccion;
     |FINSI;
     nRedDes_Alta = 0;
     |SI #nomconst#12 = 0; |O #nombonif#10 = 4;
          nRedDes_IT = 0;
     |SINO;
          nRedDes_IT = #gomcot12#27;
     |FINSI;
|FPRC;

|PROCESO topes_CP_2013;
     |SI nElAny = 2013;
          nLimite = 2161.50;
     |FINSI;
     |SI nElAny = 2014;
          nLimite = 2595.60;
     |FINSI;
     |SI nElAny = 2015;
          nLimite = 3063.30;
     |FINSI;
     |SI nElAny ] 2016;
          nLimite = 3642.00;
     |FINSI;
     |SI swJornadas = 1;
          |SI base_7 > nLimite;
               nDifCP = base_7 - nLimite;
               base_7 = nLimite;
               nATEP_Alta = nATEP_Alta - nDifCP;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO topes_CC_2013;
     |SI nElAny = 2013;
          nLimite = 2161.50;
     |FINSI;
     |SI nElAny = 2014;
          nLimite = 2595.60;
     |FINSI;
     |SI nElAny = 2015;
          nLimite = 3063.30;
     |FINSI;
     |SI nElAny ] 2016;
          nLimite = 3642.00;
     |FINSI;
     |SI swJornadas = 1;
          |SI base_6 > nLimite;
               nDifCC = base_6 - nLimite;
               base_6 = nLimite;
               nBaseAlta = nBaseAlta - nDifCC;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO topes_CP_2019;
     alfa1 = "01";
     alfa2 = #0#8;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#9;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     nCConst = 700;
     |HAZ LeeCons;

     nGrupo = #labtraba#33;
     nCampo = nGrupo + 35;
     nNume = #nomconst#nCampo# * 30;

     |SI nBaseATEP > nNume;
          nBaseATEP = nNume;      || topeo maximo
          nNume1 = (fijo_1 + jornadasIT);
          pilt_ATEP = (nNume / nNume1) ! 2;
          aTopeadaCP = "M";
     |FINSI;

     nGrupo = #labtraba#33;
     nCampo = nGrupo + 23;
     nNume = #nomconst#nCampo# * 30;

     nBase7 = nBaseATEP + (prom_enf * jornadasIT)
     |SI nBase7 < nNume;
          nBaseATEP = nBaseATEP + (nNume - nBase7);      || topeo minimo
          nNume1 = (fijo_1 + jornadasIT);
          pilt_ATEP = (nNume / nNume1) ! 2;
          aTopeadaCP = "m";
     |FINSI;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     nCConst = #labtraba#248;
     |HAZ LeeCons;
|FPRC;

|PROCESO topes_CP_2012;
     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     sw_tope = sw_tope + 1;        || en alta: sw_tope=1; en baja: sw_tope=2
     nDiasCotIT = (denfe_2 + dacci_2 + dmate_2) - swAjuste3;
     |SI #labtraba#129 = "T"; |ACABA; |FINSI;
     |SI nBaseATEP = 0;             || solo topeo si tengo algo en la base
          swNoTopees = 1;

          || excepciones para topear con base CERO

          |SI dcoti_0 > 0; |Y dabse_2 > 0; |Y #nomcontr#2 = "S";
               || en casos de absentismo, si tengo puesto que lo haga por la base
               || minima, si que tengo que topear, aunque la base este a cero
               || se topea por la base minima
               || esto habria que hacerlo por dias, pero es una solucion
               || provisional

               swNoTopees = 0;
          |FINSI;
          |SI swJornadas = 1;
               || base cero pero con jornadas, hay que topear al minimo
               || segun las jornadas
               |SI fijo_1 ! 0; |O jornadasIT ! 0;
                    swNoTopees = 0;
               |FINSI;
          |FINSI;
          |SI swMensual = 1;
               || lo mismo para mensuales
               |SI dcoti_0 ! 0; |O nDiasCotIT ! 0;
                    swNoTopees = 0;
               |FINSI;
          |FINSI;
          |SI swNoTopees = 1;
               |ACABA;
          |FINSI;
     |FINSI;
     grupo = #labtraba#33;
     |SI #labtraba#42 = "E";         || eventuales calculan los topes por jornadas
          |SI sw_tope = 1;    || reales, no por dias trabajados
               dias_tope = fijo_1;
          |SINO;
               dias_tope = jornadasIT;
          |FINSI;
     |SINO;
          |SI sw_tope = 1;    || fijos calculas los topes por dias trabajados
               |SI nDiasCotIT > 0;
                    dias_tope = dcoti_0 - nDiasCotIT;
               |SINO;
                    dias_tope = dcoti_0;
               |FINSI;
          |SINO;
               dias_tope = nDiasCotIT;
          |FINSI;
     |FINSI;
     |SI dias_tope > 30; dias_tope = 30; |FINSI;
     nMax_cp = #nomconst#20 * dias_tope;          || maximo CP

     nCampo = grupo + 23;                         || minimo CP
     nMin_cp = #nomconst#nCampo# * dias_tope;

     |SI #labtraba#129 = "R"; |Y #labtraba#47 ! 0;
          nMin_cp = #nomconst#72 * #labtraba#47 * dias_tope;
     |FINSI;

     |SI swJornadas = 1;
          |SI fijo_1 ! fijo_1_red;
               || esto es porque tengo mas de 23 jornadas, recalculo el
               || maximo por jornada para no pasarme
               nMin_cp = nMin_cp * fijo_1_red / fijo_1;
               nMax_cp = nMax_cp * fijo_1_red / fijo_1;
          |FINSI;
     |FINSI;

     nMin_cp = nMin_cp % propo;
     nMax_cp = nMax_cp % propo;
     |SI nMax_cp [ nBaseATEP; |Y nMax_cp > 0;
          nBaseATEP = nMax_cp;      || topeo maximo
          pilt_ATEP = #nomconst#20;
          aTopeadaCP = "M";
          || prom_acc = (nBaseATEP / dias_tope) ! 2;
     |FINSI;
     |SI nMin_cp ] nBaseATEP; |Y nMin_cp > 0;
          nBaseATEP = nMin_cp;      || topeo minimo
          pilt_ATEP = #nomconst#23;
          aTopeadaCP = "m";
          || prom_acc = (nBaseATEP / dias_tope) ! 2;
     |FINSI;
     |SI swParteIT = 0;
          |SI swJornadas = 1; |Y nBaseATEP ! 0;
               nNume1 = (fijo_1 + jornadasIT);
               |SI nElAny ] 2019; |Y nNume1 ] 22;
                    |HAZ topes_CP_2019;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swPrevio = 1;
          prom_acc_previo = (nBaseATEP / dias_tope) ! 2;
     |FINSI;
|FPRC;

|PROCESO topes_CC_2019;
     alfa1 = "01";
     alfa2 = #0#8;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#9;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     nCConst = 700;
     |HAZ LeeCons;

     nCampo = nGrupo + 35;
     nNume = #nomconst#nCampo# * 30;

     |SI base_6 > nNume;
          aTopeadaCC = "M";
          nNume1 = (fijo_1 + jornadasIT);
          nBasePorJornada = (nNume / nNume1) ! 2;
          base_6 = nNume;
     |FINSI;

     nGrupo = #labtraba#33;
     nCampo = nGrupo + 23;
     nNume = #nomconst#nCampo# * 30;

     nBase6 = base_6 + (prom_enf * jornadasIT)
     |SI nBase6 < nNume;
          aTopeadaCC = "m";
          nNume1 = (fijo_1 + jornadasIT);
          nBasePorJornada = (nNume / nNume1) ! 2;
          base_6 = base_6 + (nNume - nBase6);
     |FINSI;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     nCConst = #labtraba#248;
     |HAZ LeeCons;
|FPRC;

|PROCESO topes_CC_2012;
     nBasePorJornada_red = 0;

     nGrupo = #labtraba#33;
     nCampo = nGrupo + 23;
     nTopeMin = #nomconst#nCampo#;

     nTopeMaxMen = 0;
     nTopeMaxJor = 0;

     |SI swMensual = 1;
          nCampo = nGrupo + 35;
          nTopeMaxMen = #nomconst#nCampo# * 30;
          nCampo = nGrupo + 58;
          nTopeMinHor = #nomconst#nCampo#;
     |FINSI;
     |SI swJornadas = 1;
          nCampo = nGrupo + 35;
          nTopeMaxJor = #nomconst#nCampo#;
     |FINSI;

     nDiasCotIT = (denfe_2 + dacci_2 + dmate_2) - swAjuste3;

     || topeo la base de alta solo, la de IT no hace falta, me viene
     || por el promedio

     |SI swMensual = 1;
          nTopeMaxMen = nTopeMaxMen * ((dcoti_0 - nDiasCotIT) / 30);
          nTopeMaxMen = nTopeMaxMen % propo;
          |SI base_6 > nTopeMaxMen;
               aTopeadaCC = "M";
               base_6 = nTopeMaxMen;
          |FINSI;
          nTopeMin = nTopeMin * (dcoti_0 - nDiasCotIT);
          nTopeMin = nTopeMin % propo;
          |SI #labtraba#129 = "R"; |Y #labtraba#47 ! 0;
               nTopeMin = (dcoti_0 - nDiasCotIT) * #labtraba#47 * nTopeMinHor;
          |FINSI;
          |SI base_6 < nTopeMin;
               aTopeadaCC = "m";
               base_6 = nTopeMin;
          |FINSI;

          |SI swPrevio = 1;
               prom_enf_previo = (base_6 / (dcoti_0 - nDiasCotIT)) ! 2;
          |FINSI;
     |FINSI;

     |SI swJornadas = 1;
          nBasePorJornada = base_6 / fijo_1;
          nBasePorJornada = nBasePorJornada ! 2;

          |SI fijo_1 > fijo_1_red;
               || esto es porque tengo mas de 23 jornadas, recalculo el
               || maximo por jornada para no pasarme
               nTopeMaxJor = nTopeMaxJor * fijo_1_red / fijo_1;
          |FINSI;

          nTopeMaxJor = nTopeMaxJor % propo;

          |SI nBasePorJornada > nTopeMaxJor;
               aTopeadaCC = "M";
               nBasePorJornada = nTopeMaxJor;
               base_6 = fijo_1 * nTopeMaxJor;
          |SINO;
               || si he topeado a maximos no puedo topear tambien a
               || minimos, asi me quedo con una variable, nBasePorJornada

               |SI fijo_1 > fijo_1_red;
                    || esto es porque tengo mas de 23 jornadas, recalculo el
                    || maximo por jornada para no pasarme
                    nTopeMin = nTopeMin * fijo_1_red / fijo_1;
               |FINSI;

               nTopeMin = nTopeMin % propo;
               nNume1 = nTopeMin * fijo_1;
               || SI nBasePorJornada < nTopeMin;
               |SI base_6 < nNume1;
                    aTopeadaCC = "m";
                    nBasePorJornada = nTopeMin;
                    base_6 = fijo_1 * nTopeMin;
               |FINSI;
          |FINSI;

          nNume1 = (fijo_1 + jornadasIT);
          |SI nElAny ] 2019; |Y nNume1 ] 22; |Y base_6 ! 0;
               |HAZ topes_CC_2019;
          |FINSI;

          nNume1 = (fijo_1 + jornadasIT);
          |SI nNume1 < nMaximoJor;
               nBasePorJornada_red = base_6 / fijo_1_red;
               |SI nDesem > 0;
                    nBasePorJornada_red = (base_6 + nDesem) / (fijo_1_red + nJornadasERE);
               |FINSI;
          |SINO;
               nBasePorJornada_red = (base_6 + coba_1 + cobb_2 + coba_3 + coba_4) / nMaximoJor;
               |SI nDesem > 0;
                    nBasePorJornada_red = (base_6 + nDesem + coba_1 + cobb_2 + coba_3 + coba_4) / nMaximoJor;
               |FINSI;
          |FINSI;
          || nBasePorJornada_red = nBasePorJornada_red ! 2;

          |SI swPrevio = 1;
               prom_enf_previo = nBasePorJornada ! 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LimiteJor12;
     |MODULO aModulo; |QBF aModulo;
     |SI aModulo = "gomcalc1";
          |ACABA;
     |FINSI;

     nLimiteJor = 0;

     nume1 = fijo_1 + jornadasIT;

     |SI #0#9 ] 2012;
          |SI nume1 > 23;
               nLimiteJor = 23;         || jornadas limitadas
          |FINSI;
          nMaximoJor = 23;              || esta variable para el maximo de jornadas
     |FINSI;
     |SI #0#9 ] 2019;
          |SI nume1 ] 22;
               nLimiteJor = 22;         || jornadas limitadas
          |FINSI;
          nMaximoJor = 23;              || esta variable para el maximo de jornadas
     |FINSI;
|FPRC;

|| PROCESO PARA BUSCAR LA CANTIDAD BONIFICADA EN BONIFICACIONES PARA
|| BENEFICIARIOS DE PRESTACION DE DESEMPLEO, QUE TIENEN LIMITADO EL MAXIMO

|PROCESO BuscaBonif12;
     nNume = nNume + #nomhicca#63;
|FPRC;

|DEFBUCLE BuscaBonif12;
     #nomhicca#1;
     12;
     #labtraba#0, #labtraba#1, nDesdeAny, 01, 00, #nombonif#0;
     #labtraba#0, #labtraba#1, nHastaAny, 12, 99, #nombonif#0;
     ;
     NULL, BuscaBonif12;
|FIN;

|PROCESO BuscaBonifNIF12;
     |BUCLE BuscaBonif12;
|FPRC;

|DEFBUCLE BuscaBonifNIF12;
     #labtraba#2;
     ;
     aNif;
     aNif;
     ;
     NULL, BuscaBonifNIF12;
|FIN;

|PROCESO LimiteBonif12;
     nNume = 0;
     |SI #nombonif#26 = "S"; |Y #labtraba#217 ! 0;
          nDesdeAny = 09;
          nHastaAny = #0#9 - 2000;
          aNif = #labtraba#7;
          |SALVA_FICHA #labtraba;
          |BUCLE BuscaBonifNIF12;
          |REPON_FICHA #labtraba;
          nNume = #labtraba#217 - nNume;
          |SI nNume < 0;
               base_A = 0;
          |SINO;
               |SI nNume ] base_A;
                    base_A = base_A;
               |SINO;
                    base_A = nNume;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO calssemp12_1;    || CALCULA S.S. A CGO. EMPRESA
     base_A = 0;  base_B = 0;  base_C = 0;  base_F = 0;
     bbase_A = 0;  bbase_B = 0;  bbase_C = 0;  base_M = 0;
     basemat_B = 0;  basemat_C = 0;
     base_D = 0;  base_E = 0;
     zbase_A = 0; zbase_B = 0; zbase_C = 0; zbase_F = 0;

     || la base_77 para el 2012 sera la misma que la de profesionales
     || base_77 = base_7;

     || pues de momento, segun la SS no sera asi
     || base_77 = acum_10 + coba_3 + dvalo_pro;  || base cont.profesionales

     || me viene calculada y topeada del calcotiz en nATEP_Alta y nATEP_IT

     base_11 = 0;

     nTipoInicialCC = 0;
     aTipoReduccion = 0;

     nImporteRedCC_Alta = 0;
     nImporteRedCC_IT = 0;
     nImporteRedDes_Alta = 0;
     nImporteRedDes_IT = 0;

     base_8 = (dacum_30 % por2_hor1) + (dacum_31 % por2_hor2); || h.ext.
     base_11 = dcont_2 * prom_enf;

     |SI #labtraba#39 ! 0; |Y dboni_1 ! 0; |Y #nombonif#11 = "S";
          base_D = horasex * #nombonif#12;      || cuota (2) bonif. horas formacion
     |FINSI;

     nTipoInicialCC_Alta = por2_cont;
     nTipoInicialCC_IT = por2_cont;
     nTipoInicialDes = #nomconst#12;

     || esto me hace falta para las bonificaciones, la 135
     nNume1 = (nBaseAlta % (nDtoCCEmp + nDtoCCTra)) ! 2;
     nNume2 = (nBaseAlta % nDtoCCTra) ! 2;
     nCuotaCC_Alta = nNume1 - nNume2;

     |HAZ reducciones12;
     nImporteRedCC_Alta = (nBaseAlta % nRedCC_Alta) ! 2;
     || nImporteRedCC_IT = (nBaseIT % nRedCC_IT) ! 2;
     nImporteRedCC_IT = (nBaseIT_red % nRedCC_IT) ! 2;
     nImporteRedDes_Alta = 0;

     nImporteRedDes_IT = (nATEP_IT_red % nRedDes_IT) ! 2;
     || nImporteRedDes_IT = (nATEP_IT % nRedDes_IT) ! 2;

     por2_cont_alta = por2_cont - nRedCC_Alta;
     por2_des_alta = nTipoInicialDes;

     |SI #nombonif#10 = 4;
          por2_des_alta = 0;
          #nomconst#12 = 0;
          #nomconst#14 = 0;
          #nomconst#16 = 0;
     |FINSI;

     || esto es por el tiquet 4333.2132
     || resulta que aunque sea con cotizacion por jornadas, los limites
     || de reducciones, si se hacen mas de 23 (¨o 22?) jornadas, se toman
     || como para los mensuales. Esto no nos habia pasado antes y es por el
     || tiquet indicado

     || no lo he metido en enom, de momento

     swLimJorComoMen = 0;
     |SI swJornadas = 1;
          |SI fijo_1_red ] 23;
               |SI nDiasAlta = topemes;
                    nDiasAlta = 30;
                    dcoti_0 = 30;
                    swLimJorComoMen = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nElAny ] 2013;
          |SI nElAny = 2013;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 55.21;
               |SINO;
                    nLimMenResto = (1.84 * nDiasAlta);
               |FINSI;
          |FINSI;
          |SI nElAny = 2014;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 60.25;
               |SINO;
                    nLimMenResto = (2.01 * nDiasAlta);
               |FINSI;
          |FINSI;
          |SI nElAny = 2015;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 65.11;
               |SINO;
                    nLimMenResto = (2.17 * nDiasAlta);
               |FINSI;
          |FINSI;
          |SI nElAny = 2016;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 70.51;
               |SINO;
                    nLimMenResto = (2.35 * nDiasAlta);
               |FINSI;
          |FINSI;
          |SI nElAny = 2017;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 76.09;
               |SINO;
                    nLimMenResto = ((76.09 / 30) ! 2) * nDiasAlta;
               |FINSI;
          |FINSI;
          |SI nElAny = 2018;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 81.67;
               |SINO;
                    nLimMenResto = ((81.67 / 30) ! 2) * nDiasAlta;
               |FINSI;
          |FINSI;
          |SI nElAny ] 2019;
               nLimMenG1 = (279 * dcoti_0) / 30;
               |SI nDiasAlta ] 30;
                    nLimMenResto = 88.15;
               |SINO;
                    nLimMenResto = ((88.15 / 30) ! 2) * nDiasAlta;
               |FINSI;
          |FINSI;

          |SI grupo = 1;
               || para el grupo 01, sigue siendo a pelo
               nDtoCCEmp = 23.60;
               |SI swMensual = 1; |O swLimJorComoMen = 1;
                    nNume1 = (nBaseAlta % (nDtoCCEmp + nDtoCCTra)) ! 2;
                    nNume2 = (nBaseAlta % nDtoCCTra) ! 2;
                    nCuotaCCAlta = nNume1 - nNume2;
                    nNume = nCuotaCCAlta - nImporteRedCC_Alta;
                    |SI nNume > nLimMenG1;
                         nImporteRedCC_Alta = nImporteRedCC_Alta + (nNume - nLimMenG1);
                    |FINSI;
               |FINSI;
               |SI swJornadas = 1; |Y swLimJorComoMen = 0;
                    nNume1 = (nBaseAlta % (nDtoCCEmp + nDtoCCTra)) ! 2;
                    nNume2 = (nBaseAlta % nDtoCCTra) ! 2;
                    nCuotaCCAlta = nNume1 - nNume2;
                    nNume1 = nCuotaCCAlta - nImporteRedCC_Alta;
                    |SI nElAny ] 2019;
                         |SI fijo_1_red ] 22;
                              nNume2 = 279;
                         |SINO;
                              nNume2 = 12.68 * fijo_1_red;
                         |FINSI;
                    |SINO;
                         |SI fijo_1_red ] 23;
                              nNume2 = 279;
                         |SINO;
                              nNume2 = 12.13 * fijo_1_red;
                         |FINSI;
                    |FINSI;
                    |SI nNume1 > nNume2;
                         nImporteRedCC_Alta = nImporteRedCC_Alta + (nNume1 - nNume2);
                    |FINSI;
               |FINSI;
          |SINO;
               |SI swMensual = 1; |O swLimJorComoMen = 1;
                    nNume1 = (nBaseAlta % (nDtoCCEmp + nDtoCCTra)) ! 2;
                    nNume2 = (nBaseAlta % nDtoCCTra) ! 2;
                    nCuotaCCAlta = nNume1 - nNume2;
                    nNume = nCuotaCCAlta - nImporteRedCC_Alta;
                    |SI nNume < 0;
                         nImporteRedCC_Alta = nCuotaCCAlta;
                    |SINO;
                         |SI nNume < nLimMenResto;
                              nImporteRedCC_Alta = nImporteRedCC_Alta - (nLimMenResto - nNume);
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI swJornadas = 1; |Y swLimJorComoMen = 0;
                    nNume1 = (nBaseAlta % (nDtoCCEmp + nDtoCCTra)) ! 2;
                    nNume2 = (nBaseAlta % nDtoCCTra) ! 2;
                    nCuotaCCAlta = nNume1 - nNume2;
                    nNume1 = nCuotaCCAlta - nImporteRedCC_Alta;
                    |SI nElAny = 2013;
                         nNume2 = 2.40 * fijo_1_red;
                    |FINSI;
                    |SI nElAny = 2014;
                         nNume2 = 2.62 * fijo_1_red;
                    |FINSI;
                    |SI nElAny = 2015;
                         nNume2 = 2.83 * fijo_1_red;
                    |FINSI;
                    |SI nElAny = 2016;
                         nNume2 = 3.07 * fijo_1_red;
                    |FINSI;
                    |SI nElAny = 2017;
                         nNume2 = 3.31 * fijo_1_red;
                    |FINSI;
                    |SI nElAny = 2018;
                         nNume2 = 3.55 * fijo_1_red;
                    |FINSI;
                    |SI nElAny ] 2019;
                         nNume2 = 4.01 * fijo_1_red;
                    |FINSI;
                    |SI nNume1 < nNume2;
                         nImporteRedCC_Alta = nImporteRedCC_Alta - (nNume2 - nNume1);
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO calssemp12_2;    || CALCULA S.S. A CGO. EMPRESA
     nNume1 = (nBaseAlta % (nDtoCCEmp + nDtoCCTra)) ! 2;
     nNume2 = (nBaseAlta % nDtoCCTra) ! 2;
     nCuotaCC_Alta = nNume1 - nNume2;
     nNume1 = (nBaseIT % (nDtoCCEmp + nDtoCCTra)) ! 2;
     nNume2 = (nBaseIT % nDtoCCTra) ! 2;
     nCuotaCC_IT = nNume1 - nNume2;

     nNume1 = (nATEP_Alta % (nDtoDesEmp + nDtoDesTra)) ! 2;
     nNume2 = (nATEP_Alta % nDtoDesTra) ! 2;
     nCuotaDes_Alta = nNume1 - nNume2;
     nNume1 = (nATEP_IT % (nDtoDesEmp + nDtoDesTra)) ! 2;
     nNume2 = (nATEP_IT % nDtoDesTra) ! 2;
     nCuotaDes_IT = nNume1 - nNume2;

     nNume1 = ((nATEP_Alta + nATEP_IT) % (nDtoFPEmp + nDtoFPTra)) ! 2;
     nNume2 = ((nATEP_Alta + nATEP_IT) % nDtoFPTra) ! 2;
     nCuotaFP = nNume1 - nNume2;
     nNume1 = ((nATEP_Alta + nATEP_IT) % nDtoFogEmp) ! 2;
     nCuotaFog = nNume1;

     nCuotaFPFog = nCuotaFP + nCuotaFog;

     base_8 = (nCuotaCC_Alta - nImporteRedCC_Alta);
     base_8 = base_8 + (nCuotaCC_IT - nImporteRedCC_IT);
     base_8 = base_8 + nCuotaDes_Alta;
     base_8 = base_8 + (nCuotaDes_IT - nImporteRedDes_IT);
     base_8 = base_8 + nCuotaFPFog;

     || bueno, a ver lo de topear la base de ATEP no me cuadra aqui, se supone
     || que haremos como en el regimen general y por ATEP se cotizara por la
     || misma base que la de profesionales

     || TAMBIEN, porque en los seguros sociales lo hacemos asi, hay que
     || hacerlo igual
     base_9 = (nATEP_Alta % epig_ilt) ! 2;
     base_9 = base_9 + (nATEP_Alta % epig_ims) ! 2;

     || parte en IT
     base_9 = base_9 + ((nATEP_IT % epig_ilt) ! 2);
     base_9 = base_9 + ((nATEP_IT % epig_ims) ! 2);
               || bonificacion sobre base jornadas reales en alta
               || si es maternidad no bonifico la parte de alta
     |SI #labtraba#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0; |Y #nombonif#10 ! 4;
          |SI dmate_2 ! 0;
               nPropBon = 1;
               || si es maternidad, quito la parte en alta y bonifico solo
               || la de maternidad, a ver esto no es asi de simple, pero
               || ha salido un caso despues de a¤os, asi que de momento no
               || pierdo mas tiempo
               bon_0 = base_5;
               bon_3 = base_5;

               /*
               || lo dejo ahora para que se bonifique por los dias reales que
               || se ha de bonificar multiplicado por la base de mat/pat

               || no lo hago, no me merece la pena para un caso que ha salido
               bon_0 = (dboni_1 - swAjuste3) * prom_enf;
               bon_3 = bon_0;
               nPropBon = (dboni_1 - swAjuste3) / dboni_2;
               */

          |FINSI;
          |SI #labtraba#33 ! 01;   || porque los grupo 01 cotizan por el 23,60
                                   || que sera lo que tendran puesto en la bonif.
               |SI #nombonif#4 ! 0;
                    #nombonif#4 = #nomconst#6;
               |FINSI;
          |FINSI;
          nNume1 = (bon_0 % #nombonif#4) ! 2;
          nNume2 = (nImporteRedCC_Alta + nImporteRedCC_IT) * nPropBon;
          |SI dmate_2 ! 0;
               || en maternidad solo esta parte, asumo que la de alta no se
               || bonifica

               nNume2 = nImporteRedCC_IT;
          |FINSI;
          base_A = nNume1 - nNume2;
          base_A = base_A % nPorBon1;
          base_A = base_A ! 2;

          || si bonifico sobre todas las cont. profesionales, separo la bonif.
          || de desempleo de la de FP y FOGASA, para no reducir la base de estas
          |SI #nombonif#5 ! 0;
               #nombonif#5 = #nomconst#12 + #nomconst#14 + #nomconst#16;
               || otra cosa no tiene sentido
          |FINSI;
          |SI #nombonif#5 ! 0;
               nNume = #nomconst#12 + #nomconst#14 + #nomconst#16;
               |SI nNume = #nombonif#5;
                    base_B = (((bon_3 % #nomconst#12) ! 2) - (nImporteRedDes_IT * nPropBon)) % nPorBon1;
                    base_B = base_B + ((bon_3 % (#nomconst#14 + #nomconst#16) ! 2) % nPorBon1);
               |SINO;
                    || si no, todo junto
                    base_B = (((bon_3 % #nombonif#5) ! 2) - (nImporteRedDes_IT * nPropBon)) % nPorBon1;
               |FINSI;
          |FINSI;

          base_B = base_B ! 2;
          |HAZ LimiteBonif12;
          |SI #nombonif#08 = "S";
               || zbase_9 = (acum_10 + coba_3) % (epig_ilt + epig_ims);
               zbase_9 = bon_3 % (epig_ilt + epig_ims);
               zbase_9 = zbase_9 ! 2;
               base_C = zbase_9 % nPorBon1;      || cuota bonificada accidentes
               base_C = base_C ! 2;
          |FINSI;
     |FINSI;

     || bonificacion sobre base jornadas teoricas en baja
     jornadasEA = jornadasIT;
     || (eso aqui ya no vale, creo)

     |SI #labtraba#39 ! 0; |Y dboni_2 ! 0; |Y nPorBon2 ! 0;
          zbase_A = ((zbon_0 % #nombonif#4)!2) % nPorBon2; || cuota bonif. linea 1
          zbase_A = zbase_A ! 2;
          zbase_B = ((zbon_3 % #nombonif#5)!2) % nPorBon2; || cuota bonif. linea 2
          zbase_B = zbase_B ! 2;
          |SI #nombonif#08 = "S";
               zbase_9 = ((zbon_3 - zbon_5) % epig_ilt) ! 2;
               zbase_9 = zbase_9 + (((zbon_3 - zbon_5) % epig_ims) ! 2);
               zbase_9 = zbase_9 + ((zbon_5 % epig_ilt) ! 2);
               zbase_9 = zbase_9 + ((zbon_5 % epig_ims) ! 2);
               zbase_9 = zbase_9 ! 2;
               zbase_C = zbase_9 % nPorBon2;     || cuota bonificada accidentes
               zbase_C = zbase_C ! 2;
          |FINSI;
     |FINSI;

     |SI #nombonif#10 = 4;
          || esto la parte de ALTA

          nNume1 = #nombonif#4;

          base_A = nBaseAlta % nNume1;
          base_A = base_A ! 2;

          || nNume2 = ((bon_0 % por2_cont) ! 2);     || limite comunes
          nNume2 = ((nBaseAlta % por2_cont) ! 2);     || limite comunes
          nNume2 = nNume2 - base_A;
          |SI nImporteRedCC_Alta > nNume2;
               base_8 = base_8 + nImporteRedCC_Alta;
               nImporteRedCC_Alta = nNume2;
               base_8 = base_8 - nImporteRedCC_Alta;
          |FINSI;

          || vuelvo a poner base_A al valor que tiene la cuota total de
          || bonificacion
          base_A = bon_0 % nNume1;

          || Y LA PARTE DE BAJA:

          nNume1 = #nombonif#4;

          base_A = nBaseIT % nNume1;
          base_A = base_A ! 2;

          || nNume2 = ((bon_0 % por2_cont) ! 2);     || limite comunes
          nNume2 = ((nBaseIT % por2_cont) ! 2);     || limite comunes
          nNume2 = nNume2 - base_A;
          |SI nImporteRedCC_IT > nNume2;
               base_8 = base_8 + nImporteRedCC_IT;
               nImporteRedCC_IT = nNume2;
               base_8 = base_8 - nImporteRedCC_IT;
          |FINSI;

          || vuelvo a poner base_A al valor que tiene la cuota total de
          || bonificacion
          base_A = bon_0 % nNume1;
     |FINSI;

     || empresa las cuotas de la bonificacion de la parte de baja y maternidad

     base_F = base_A + base_B + base_C;       || cuota (1) bonif. en alta
     bbase_F = bbase_A + bbase_B + bbase_C;   || cuota (1) bonif. en baja
     base_F = base_F + bbase_F + base_M;
     zbase_F = zbase_A + zbase_B + zbase_C;   || cuota (2) bonif.

     || S.Social cargo empresa:
     base_E = base_8 + base_9 + dto_sol_emp;
     base_E = base_E - (base_A + base_B + base_C);
     base_E = base_E - (zbase_A + zbase_B + zbase_C + base_D); ||SS emp.
     base_E = base_E - (bbase_A + bbase_B + bbase_C + base_M); || quito a la SS.cgo.
     base_E = base_E + cbon_3;     || a¤ado desempleo en baja
|DEBUG;
     |SI base_E < 0;
          base_A = base_A + base_E;
          base_E = 0;     || por si acaso sale negativa
     |FINSI;

     || base_E = base_E - nRedFija;
     || |SI base_E < 0;
     ||      nRedFija = nRedFija + base_E;
     ||      base_E = 0;
     || |FINSI;
     |SI nBonifFCI > 0;
          base_E = base_E - nBonifFCI;
          |SI base_E < 0;
               nBonifFCI = nBonifFCI + base_E;
               base_E = 0;
          |FINSI;
     |FINSI;
     |SI bon_59 > 0;
          base_E = base_E - bon_59;
          |SI base_E < 0;
               bon_59 = bon_59 + base_E;
               base_E = 0;
          |FINSI;
     |FINSI;
     |SI bon_60 > 0;
          base_E = base_E - bon_60;
          |SI base_E < 0;
               bon_60 = bon_60 + base_E;
               base_E = 0;
          |FINSI;
     |FINSI;
     |SI nBonifERE > 0;
          base_E = base_E - nBonifERE;
          |SI base_E < 0;
               nBonifERE = nBonifERE + base_E;
               base_E = 0;
          |FINSI;
     |FINSI;
     |SI #nombonif#10 = 4;
          || parte bonificacion al trabajador, sumo en el campo cuota bonif
          || pero no tiene que restar de la SS a cgo. empresa, sino no saldrian
          || los resumenes luego como deben

          || nNume2 = por1_cont - ((por1_cont % 6.20) ! 2);    || bonif trabajador
          nNume1 = bon_0 - nBasePagoSS_CC;
          nNume2 = #nombonif#6;

          base_A = base_A + ((nNume1 % nNume2) ! 2);
          base_F = base_F + ((nNume1 % nNume2) ! 2);
     |FINSI;
|FPRC;

|PROCESO AjusteMensuales;
     denfe_cot = denfe_2;
     dacci_cot = dacci_2;
     dmate_cot = dmate_2;
     ddese_cot = ddese_2;

     || la ultima IT se ha hecho en el proceso modulo2

     |SI aUltimaIT = "E";
          |SI denfe_2 ! 0; denfe_cot = denfe_2 - swAjuste3; |FINSI;
     |FINSI;
     |SI aUltimaIT = "A";
          |SI dacci_2 ! 0; dacci_cot = dacci_2 - swAjuste3; |FINSI;
     |FINSI;
     |SI aUltimaIT = "M"; |O aUltimaIT = "P"; |O aUltimaIT = "R"; |O aUltimaIT = "C";
          |SI dmate_2 ! 0; dmate_cot = dmate_2 - swAjuste3; |FINSI;
     |FINSI;
     |SI aUltimaIT = "D";
          |SI ddese_2 ! 0; ddese_cot = ddese_2 - swAjuste3; |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaCalendario;
     |ABRE #gomdetjr;
     #gomdetjr#0 = #labtraba#0;
     #gomdetjr#1 = #labtraba#1;
     #gomdetjr#2 = #0#9;
     #gomdetjr#3 = #0#8;
     |LEE 000#gomdetjr.=;
     |SI FSalida ! 0;
          nIncid = 58;
          |HAZ graba_inc;
     |FINSI;
     |CIERRA #gomdetjr;
|FPRC;

|PROCESO Calendario;
     |ABRE #gomdetjr;
     #gomdetjr#0 = #labtraba#0;
     #gomdetjr#1 = #labtraba#1;
     #gomdetjr#2 = #0#9;
     #gomdetjr#3 = #0#8;
     |LEE 000#gomdetjr.=;
     || nJorITCotEmpTra cotizan emp. y trab. - columna Jor A
     || nJorITCotEmp cotiza empresa - columna Jor B

     nJorITCotEmp = 0;
     nJorITCotEmpTra = 0;

     nDiaIT = nAcum;
     |PARA nCasilla = 4; |SI nCasilla [ 34; |HACIENDO nCasilla = nCasilla + 1;
          nDia = nCasilla - 3;
          |SI nDesde [ nDia; |Y nDia [ nHasta;
               nDiaIT = nDiaIT + 1;
               |SI aTipo = "E"; |Y #gomdetjr#nCasilla# = "I";
                    |SI nDiaIT [ 15;
                         nJorITCotEmpTra = nJorITCotEmpTra + 1;
                         |SI nDiaIT ] 4;
                              nPrestacionEnf = nPrestacionEnf + (prom_enf % 60);
                         |FINSI;
                    |SINO;
                         nJorITCotEmp = nJorITCotEmp + 1;
                         nJornPagoSS = nJornPagoSS + 1;
                    |FINSI;
               |FINSI;
               |SI aTipo = "A"; |Y #gomdetjr#nCasilla# = "I";
                    nJornPagoSS = nJornPagoSS + 1;
               |FINSI;
               |SI aTipo = "M"; |O aTipo = "P"; |O aTipo = "R";
                    |SI #gomdetjr#nCasilla# = "I";
                         nJornPagoSS = nJornPagoSS + 1;
                         nJornPagoSS_Mat = nJornPagoSS_Mat + 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;

     |CIERRA #gomdetjr;
|FPRC;

|PROCESO DesglosaJorCreta;
     |ABRE #gomdesjr;
     #gomdesjr#0 = #labtraba#0;
     #gomdesjr#1 = #labtraba#1;
     #gomdesjr#2 = #0#9;
     #gomdesjr#3 = #0#8;
     #gomdesjr#4 = 0;
     |LEE 101#gomdesjr.=;
     |SI FSalida = 0;
          |BORRA 020#gomdesjr.a;
     |FINSI;

     |DDEFECTO #gomdesjr;
     #gomdesjr#0 = #labtraba#0;
     #gomdesjr#1 = #labtraba#1;
     #gomdesjr#2 = #0#9;
     #gomdesjr#3 = #0#8;
     #gomdesjr#4 = 0;
     |GRABA 020#gomdesjr.n;
     |LEE 101#gomdesjr.=;

     nPrestacionEnf = 0;
     nCuantas = 0;
     |PARA nCampo = 12; |SI nCampo [ 15; |HACIENDO nCampo = nCampo + 1;
          aTipo = #nomvarca#nCampo#;
          |QBF aTipo;
          |SI aTipo = "E";
               nIT = nCampo - 11;
               nCuantas = nCuantas + 1;
               nCampo1 = nCampo - 8;
               nCampo2 = nCampo - 4;
               nDesde = #nomvarca#nCampo1#;
               nHasta = #nomvarca#nCampo2#;
               |SI nDesde = 0; nDesde = dalta_3; |FINSI;
               |SI nHasta = 0; nHasta = dbaja_3; |FINSI;

               nCampoDes = ((nIT - 1) * 10) + 5;
               #gomdesjr#nCampoDes# = aTipo;
               nCampoDes = nCampoDes + 1;
               #gomdesjr#nCampoDes# = nDesde;
               nCampoDes = nCampoDes + 1;
               #gomdesjr#nCampoDes# = nHasta;
               nCampoDes = nCampoDes + 1;
               #gomdesjr#nCampoDes# = nHasta - nDesde + 1;
               nDias = nHasta - nDesde + 1;
               nCampoDes = nCampoDes + 1;

               nAcum = 0;
               |SI nIT = 1;
                    |SI aTipo = "E"; |Y #labtraba#60 = "E";
                         nAcum = #labtraba#89;
                    |FINSI;
                    |SI aTipo = "M"; |Y #labtraba#60 = "M";
                         nAcum = #labtraba#89;
                    |FINSI;
                    |SI aTipo = "A";
                         nAcum = #labtraba#92;
                    |FINSI;
                    nAcum = nAcum + dreca_1;
                    #gomdesjr#nCampoDes# = nAcum;
               |FINSI;
               |SI nIT = 2; nAcum = nAcum + dreca_2; |FINSI;
               |SI nIT = 3; nAcum = nAcum + dreca_3; |FINSI;
               |SI nIT = 4; nAcum = nAcum + dreca_4; |FINSI;

               |SI aTipo = "E";
                    |SI nJornadasEnf ! 0;
                         nJor = nJornadasEnf;
                    |SINO;
                         nJor = jornadasIT;
                    |FINSI;

                    |HAZ Calendario;

                    nDias = nDias + nAcum;

                    || nJor son las jornadas en IT
                    || nJorITCotEmpTra cotizan emp. y trab. - columna Jor A
                    || nJorITCotEmp cotiza empresa - columna Jor B
                    |SI nDias [ 15;
                         nCampoDes = nCampoDes + 1;
                         #gomdesjr#nCampoDes# = nJorITCotEmpTra;
                    |SINO;
                         |SI nJorITCotEmpTra ! 0; |O nJorITCotEmp ! 0;
                              nCampoDes = nCampoDes + 1;
                              #gomdesjr#nCampoDes# = nJorITCotEmpTra;
                              nCampoDes = nCampoDes + 1;
                              #gomdesjr#nCampoDes# = nJorITCotEmp;
                         |SINO;
                              |SI nAcum = 0;
                                   nNume = nDias - 15;
                                   nJornadas_A = (nJor * (15 / nDias)) ! 0;
                                   nJornadas_B = nJor - nJornadas_A;
                              |FINSI;
                              |SI 1 [ nAcum; |Y nAcum < 15;
                                   nNume = 15 - nAcum; || dias que me faltan en los 1os. 15
                                   nDias = nHasta - nDesde + 1; || dias de IT del mes
                                   |SI nDias [ nNume;      || todo en los 1os. 15 dias
                                        nJornadas_A = nJor;
                                        nJornadas_B = 0;
                                   |SINO;
                                        nJornadas_A = (nJor * (nNume / nDias)) ! 0;
                                        nJornadas_B = nJor - nJornadas_A;
                                   |FINSI;
                              |FINSI;
                              |SI nAcum ] 15;
                                   nJornadas_A = 0;
                                   nJornadas_B = nJor;
                              |FINSI;
                              nCampoDes = nCampoDes + 1;
                              #gomdesjr#nCampoDes# = nJornadas_A;
                              nCampoDes = nCampoDes + 1;
                              #gomdesjr#nCampoDes# = nJornadas_B;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI aTipo = "A"; |O aTipo = "M"; |O aTipo = "P"; |O aTipo = "T";
               || nCampoDes = nCampoDes + 2;
               || #gomdesjr#nCampoDes# = jornadasIT;
               nCampo1 = nCampo - 8;
               nCampo2 = nCampo - 4;
               nDesde = #nomvarca#nCampo1#;
               nHasta = #nomvarca#nCampo2#;
               |SI nDesde = 0; nDesde = dalta_3; |FINSI;
               |SI nHasta = 0; nHasta = dbaja_3; |FINSI;
               |HAZ Calendario;
          |FINSI;
     |SIGUE;

     aAlfa = #gomdesjr#5 + #gomdesjr#15 + #gomdesjr#25 + #gomdesjr#35;
     |QBF aAlfa;
     |SI aAlfa = "";
          |BORRA 020#gomdesjr.a;
     |SINO;
          |GRABA 020#gomdesjr.a;
     |FINSI;

     |LIBERA #gomdesjr;
     |CIERRA #gomdesjr;
|FPRC;

|PROCESO calcotiz12;      || CALCULA BASE CON.COMUNES Y BASE D+F+P (AGRARIA*)
     base_5 = 0;
     nume1 = acum_10 + dvalo_pro + n400Cot;  || ctos. 100 + prorr.
     base_6 = nume1 ! 2;           || base de cotizacion comunes
                                   || de momento solo la parte en alta
     base_7 = nume1 ! 2;           || base de cotizacion profesionales
     base_7 = base_7 + dacum_30 + dacum_31;

     aTopeadaCC = "";
     aTopeadaCP = "";
     nBaseAlta = 0;
     nBaseIT = 0;
     nBaseIT_red = 0;
     nATEP_Alta = 0;
     nATEP_IT = 0;
     swPrevio = 0;
     nBaseATEP_red = 0;
     nATEP_IT_red = 0;
     fijo_1_red = fijo_1;          || aqui me guardare, si las jornadas en
                                   || alta son mas de 23, las 23 que son el
                                   || limite para el calculo de reducciones

     |HAZ LeeTopesReduc;           || proceso para leer los topes y reducciones

     |SI swJornadas = 1;
          |HAZ LimiteJor12;

          |SI nLimiteJor ! 0;
               || he limitado las jornadas porque me pasaba del limite
               || reparto entre las jornadas en alta y las en IT
               |SI fijo_1 ] nLimiteJor;      || todas en alta, limito al maximo
                    fijo_1_red = nMaximoJor;
               |FINSI;
          |FINSI;
     |FINSI;

     || para calcular la base para el calculo de la
     || reduccion para los trabajadores por jornadas, se divide por 23
     || como maximo si hay mas de 23 jornadas en alta, pero si hay mas de 23
     || entre alta e IT, se divide (base alta + base IT) / (jorn. alta + jorn. IT)

     jornadasIT_red = jornadasIT;
     base_6 = base_6 + coba_3;
     |HAZ topes_CC_2012;
     nBaseAlta = base_6;

     || ahora a¤ado la base en IT, igual para mensual que para jornadas
     base_6 = base_6 + coba_1 + cobb_2;

     |SI nElAny ] 2013;
          nDifCC = 0;
          |HAZ topes_CC_2013;
     |FINSI;

     sw_tope = 0;
     base_7 = acum_10 + coba_3 + dvalo_pro;  || base cont.profesionales
     base_7 = base_7 + n400Cot;
     base_7 = base_7 + dacum_30 + dacum_31;
     nBaseATEP = base_7;
     |HAZ topes_CP_2012;
     base_7 = nBaseATEP;
     nATEP_Alta = base_7;

     || parte en IT
     nume2 = (denfe_2 + dacci_2 + dmate_2) - swAjuste3;
     |SI nume2 < 0; nume2 = 0; |FINSI;
     nume1 = dcoti_0 - nume2;

     pilt_ATEP = prom_acc;
     |SI #labtraba#42 ! "E";
          nBaseATEP = nume2 * pilt_ATEP;
     |SINO;
          nBaseATEP = jornadasIT * pilt_ATEP;
          nBaseATEP_red = jornadasIT_red * pilt_ATEP;
     |FINSI;

     swParteIT = 1;
     |HAZ topes_CP_2012;
     swParteIT = 0;

     nATEP_IT = nBaseATEP;
     nATEP_IT_red = nBaseATEP;
     |SI swJornadas = 1;
          nATEP_IT_red = nBaseATEP_red;
     |FINSI;

     |SI nDesem ! 0;
          nBaseATEP = nBaseATEP + nDesem;
          nBaseATEP_red = nBaseATEP - nDesem;
          nATEP_IT = nBaseATEP;
          nATEP_IT_red = nBaseATEP_red;

          |SI nJornadasERE > 0;
               jornadasIT = jornadasIT + nJornadasERE;
               jornadasIT_red = jornadasIT_red + nJornadasERE;
          |FINSI;
     |FINSI;
|| en todo caso aqui
     base_7 = nATEP_Alta + nATEP_IT - cobb_4 - nDesem;
     nBaseIT = coba_1 + cobb_2 + coba_4;

     |SI nElAny ] 2013;
          nDifCP = 0;
          |HAZ topes_CP_2013;
     |FINSI;

     nBaseIT = nBaseIT + nDesem;
     nBaseIT_red = nBaseIT;
     |SI swJornadas = 1;
          nBaseIT_red = nBaseIT_red * jornadasIT_red / jornadasIT;
     |FINSI;
     nBaseIT_red = nBaseIT_red ! 2;

     jornadasIT_red = jornadasIT;
     nNume1 = fijo_1 + jornadasIT;

     || PARA HALLAR LA PARTE A CARGO DE LA SEG. SOCIAL
     || POR LA QUE NO HAY QUE COTIZAR POR CONT. PROF.

     nBasePagoSS_CC = 0;
     nBasePagoSS_CP = 0;
     nBasePagoSS_CC_SinMat = 0;
     nBasePagoSS_CP_SinMat = 0;
     nDiasPagoSS = 0;
     nDiasPagoSS_SinMat = 0;
     nJornPagoSS = 0;
     nJornPagoSS_SinMat = 0;

     |SI swMensual = 1;
          || base fija

          || esta es la base total que paga la SS, me hara falta todo para el
          || lote despues
          |HAZ AjusteMensuales;
          nDiasPagoSS = (denfe_B + denfe_C);
          |SI aUltimaIT = "E"; |Y nDiasPagoSS > 0;
               nDiasPagoSS = nDiasPagoSS - swAjuste3;
          |FINSI;
          nDiasPagoSS = nDiasPagoSS + dacci_2;
          |SI aUltimaIT = "A";
               nDiasPagoSS = nDiasPagoSS - swAjuste3;
          |FINSI;
          nDiasPagoSS = nDiasPagoSS + dmate_2;
          |SI aUltimaIT = "M"; |O aUltimaIT = "P"; |O aUltimaIT = "R"; |O aUltimaIT = "C";
               nDiasPagoSS = nDiasPagoSS - swAjuste3;
          |FINSI;

          |SI #0#8 = 2;
               || caso raro, febrero, el swAjuste3 no tiene que intervenir,
               || ya que en este caso estoy sumando dos dias (el 29 y el 30)
               || que no debo sumar ya que los dias de enfermedad no me
               || cubren los 15 primeros dias
               || si esto molesta, hacer la prueba de febrero, 7 dias de IT
               || mensual, por ejemplo
               nNume1 = swAjuste3 * (-1);
               |SI nDiasPagoSS = nNume1;
                    nDiasPagoSS = 0;
               |FINSI;
          |FINSI;

          |SI nDiasPagoSS < 0; nDiasPagoSS = 0; |FINSI;

          nBasePagoSS_CC = nDiasPagoSS * prom_enf;
          nBasePagoSS_CP = nDiasPagoSS * prom_acc;

          || pero tambien me hace falto lo mismo quitando la parte de matern.
          || que es lo que le tengo que descontar para que el trabajador no
          || cotice por ello

          |SI aUltimaIT = "E"; |O aUltimaIT = "A";
               nDiasPagoSS_SinMat = (denfe_B + denfe_C + dacci_2 - swAjuste3); || pago SS
          |SINO;
               nDiasPagoSS_SinMat = (denfe_B + denfe_C + dacci_2); || pago SS
          |FINSI;

          |SI #0#8 = 2;
               || caso raro, febrero, el swAjuste3 no tiene que intervenir,
               || ya que en este caso estoy sumando dos dias (el 29 y el 30)
               || que no debo sumar ya que los dias de enfermedad no me
               || cubren los 15 primeros dias
               || si esto molesta, hacer la prueba de febrero, 7 dias de IT
               || mensual, por ejemplo
               nNume1 = swAjuste3 * (-1);
               |SI nDiasPagoSS_SinMat = nNume1;
                    nDiasPagoSS_SinMat = 0;
               |FINSI;
          |FINSI;

          |SI nDiasPagoSS_SinMat < 0; nDiasPagoSS_SinMat = 0; |FINSI;

          nBasePagoSS_CC_SinMat = nDiasPagoSS_SinMat * prom_enf;
          nBasePagoSS_CP_SinMat = nDiasPagoSS_SinMat * prom_acc;
     |SINO;
          || jornadas

          nume1 = (denfe_B + denfe_C + dacci_2 - swAjuste3);    || pago SS
          nume1 = nume1 + dmate_2;

          || solo maternidad o control IT SS

          swHay93X = 0;
          nJornadasEnf = 0;
          nJornadasAcc = 0;
          nJornadasMat = 0;
          nDias = 0;
          nJornPagoSS = 0;
          nJornPagoSS_Mat = 0;

          |HAZ BuscaCalendario;

          || esto ya no sirve, los 93X ya no se usan

          |SI jornadasIT ! 0;
               |HAZ DesglosaJorCreta;
          |FINSI;
/*
          |SI swHay93X = 0;
               |SI nume1 < 0; nume1 = 0; |FINSI;
               nDiasPagoSS = nume1;
               nume2 = denfe_D + denfe_A;         || pago empresario
               nume1 = jornadasIT * nume1 / (nume1 + nume2);   || parte de las jornadas en IT que
               nume1 = nume1 ! 0;                 || paga la Seg. Social
               |SI nJorITCotEmpTra ! 0; |O nJorITCotEmp ! 0;
                    || parte de las jornadas en IT por la que cotiza trabajador y
                    || y empresa, mediante el concepto 942
                    nume1 = nJorITCotEmp;
               |FINSI;
          |SINO;
               nume1 = (denfe_B + denfe_C - swAjuste3);    || pago SS
               nume2 = denfe_D + denfe_A;         || pago empresario
               nume1 = nJornadasEnf * nume1 / (nume1 + nume2);
               nume1 = nume1 + nJornadasAcc + nJornadasMat;
               nume1 = nume1 ! 0;
          |FINSI;
          nJornPagoSS = nume1;
*/

          || nJornPagoSS se calcula en el  DesglosaJorCreta en Calendario
          || todo eso no debe servir para nada 22.05.2020

          nBasePagoSS_CC = nJornPagoSS * prom_enf;   || base cotiz. CONT.COM.
          nBasePagoSS_CP = nJornPagoSS * prom_acc;   || base cotiz. CONT.PROF.

/*
          || ahora lo mismo pero sin los dias de Maternidad

          nume1 = (denfe_B + denfe_C + dacci_2 - swAjuste3);    || pago SS

          |SI swHay93X = 0;
     || nada de esto tiene validez, ya que estos conceptos los dejamos ya
     || de usar, ya que las jornadas por cada IT vendran del calendario
               |SI nume1 < 0; nume1 = 0; |FINSI;
               nDiasPagoSS_SinMat = nume1;
               nume2 = denfe_D + denfe_A;         || pago empresario
               nume1 = jornadasIT * nume1 / (nume1 + nume2);   || parte de las jornadas en IT que
               nume1 = nume1 ! 0;                 || paga la Seg. Social
               |SI nJorITCotEmpTra ! 0; |O nJorITCotEmp ! 0;
                    || parte de las jornadas en IT por la que cotiza solo la
                    || empresa, mediante el con cepto 942
                    nume1 = nJorITCotEmp;
               |FINSI;
          |SINO;
               nume1 = (denfe_B + denfe_C - swAjuste3);    || pago SS
               nume2 = denfe_D + denfe_A;         || pago empresario
               nume1 = nJornadasEnf * nume1 / (nume1 + nume2);
               nume1 = nume1 + nJornadasAcc + nJornadasMat;
               nume1 = nume1 ! 0;
          |FINSI;
          nJornPagoSS_SinMat = nume1;
*/

          nJornPagoSS_SinMat = nJornPagoSS - nJornPagoSS_Mat;

          nBasePagoSS_CC_SinMat = nJornPagoSS_SinMat * prom_enf;   || base cotiz. CONT.PROF.
          nBasePagoSS_CP_SinMat = nJornPagoSS_SinMat * prom_acc;   || base cotiz. CONT.PROF.
     |FINSI;

     || base_5 = coba_1 + cobb_2 + coba_3 + coba_4;   || base IT
     base_5 = coba_1 + cobb_2 + coba_4;   || base IT (absentismo no, hombre)

     || ¨es esto necesario para 2012?

     nume1 = denfe_2 + dmate_2 + dacci_2;
     |SI nume1 = 0; |Y #labtraba#33 = 01;
          || no tengo IT, pero se tiene que quedar grabada la base
          || del mes para el mes que viene, en los grupo 01 tambien claro
          || y no se estaba grabando por no estar cargando las variables
          || prom_enf ni prom_acc a no ser que hubiera algo del mes anterior
          || con IT

          nBase = base_6;
          |SI swBaseFija = 1;
               prom_enf = nBase / dcoti_0;
          |SINO;
               prom_enf = nBase / fijo_1;
          |FINSI;
          prom_enf = prom_enf ! 2;
          prom_acc = prom_enf;
     |FINSI;
|FPRC;

|PROCESO calboni112;       || CALCULA BASES BONIFICACION
     nPropBon = 0;
     bon_0 = 0;           || base CC bonificacion (1)
     bon_3 = 0;           || base CP bonificacion (1)
     bon_5 = 0;           || base ILT bonificacion (1)
     bon_1 = por1_cont;   || (%) cont. comunes
     bon_2 = por1_dfpg;   || (%) D+F+P
     |SI #labtraba#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0;
          lin_1 = #nombonif#6 % nPorBon1;
          lin_2 = #nombonif#7 % nPorBon1;
          bon_0 = base_6 + coba_4 + nDesem;
          bon_3 = base_7 + cobb_4 + nDesem;
          bon_5 = base_5;
          bon_1 = por1_cont - lin_1;
          bon_2 = por1_dfpg - lin_2;
          |SI #nombonif#9 = "S";
               bon_1 = bon_1 - #nomconst#5;
          |FINSI;
          |SI dboni_1 ! dcoti_0;    || dias bonificacion distintos a dias cotizacion
               nume1 = dboni_1 / (dboni_1 + dboni_2);
               nPropBon = nume1;
               bon_0 = bon_0 * nume1;
               bon_3 = bon_3 * nume1;
               bon_5 = bon_5 * nume1;
          |SINO;
               nPropBon = 1;
          |FINSI;
     |FINSI;

     dto_con = 0;                   || dto. CON.COM.  AGRARIA*
     dto_dfp = 0;                   || dto. CON.PRO.  AGRARIA*

     nDtoCCTra = #nomconst#7;
     nDtoCPTra = #nomconst#13 + #nomconst#17;
     nDtoDesTra = #nomconst#13;
     nDtoFPTra = #nomconst#17;

     nDtoCCEmp = #nomconst#6;
     nDtoDesEmp = #nomconst#12;
     nDtoFogEmp = #nomconst#14;
     nDtoFPEmp = #nomconst#16;

     |SI #nombonif#10 = 4;
          nDtoCCTra = por1_cont - #nombonif#6;
          nDtoCPTra = 0;
          bon_1 = nDtoCCTra;
     |FINSI;

     |SI swBaseFija = 1;
          nume2 = (denfe_2 + dacci_2 + dmate_2) - swAjuste3;
          |SI dcoti_0 ! 30;   || no estoy de alta el mes completo
               nume1 = (dcoti_0 - nume2); || dias trabajados
          |SINO;
               |SI dilt > 0;  || estoy de alta el mes completo pero tengo IT
                    nume1 = (dcoti_0 - nume2); || dias trabajados
               |SINO;         || mes completo sin IT
                    nume1 = 30;
               |FINSI;
          |FINSI;

          nNume = base_6 - nBasePagoSS_CC_SinMat;
          |SI nNume > 0;
               dto_con = ((base_6 - nBasePagoSS_CC_SinMat) % nDtoCCTra) ! 2;          || cuota
               dto_sol_emp = base_6 % #nomconst#92;
               dto_sol_emp = dto_sol_emp ! 2; || cot.solidaridad
               dto_sol_tra = base_6 % #nomconst#93;
               dto_sol_tra = dto_sol_tra ! 2; || cot.solidaridad
          |FINSI;

          nNume = base_7 - nBasePagoSS_CP_SinMat;
          |SI nNume > 0;
               dto_dfp = (nNume % nDtoDesTra) ! 2;
               dto_dfp = dto_dfp + ((nNume % nDtoFPTra) ! 2);
          |FINSI;
     |FINSI;

     |SI swJornadas = 1;
          nume1 = fijo_1;
          |SI #labtraba#241 = "N"; |Y #labtraba#138 = "N";
               || en carencia NO, ya esta descontado si hubiera IT
               || la parte de accidente si que se la quito
               nNume = base_6 - coba_2;
          |SINO;
               nNume = base_6 - nBasePagoSS_CC_SinMat;
          |FINSI;

          |SI nNume > 0;
               dto_con = (nNume % nDtoCCTra) ! 2;          || cuota
               dto_sol_emp = base_6 % #nomconst#92;
               dto_sol_emp = dto_sol_emp ! 2; || cot.solidaridad
               dto_sol_tra = base_6 % #nomconst#93;
               dto_sol_tra = dto_sol_tra ! 2; || cot.solidaridad
          |FINSI;

          |SI #labtraba#241 = "N"; |Y #labtraba#138 = "N";
               || en carencia NO, ya esta descontado, si hubiera IT
               || la parte de accidente
               nNume = base_7 - cobb_2;
          |SINO;
               nNume = base_7 - nBasePagoSS_CP_SinMat;
          |FINSI;
          |SI nNume > 0;
               dto_dfp = (nNume % nDtoDesTra) ! 2;
               dto_dfp = dto_dfp + ((nNume % nDtoFPTra) ! 2);
          |FINSI;
     |FINSI;

     |SI #labtraba#42 ! "A"; |Y #labtraba#42 ! "E";
          || se supone que extranjeros clave "e"
          dto_dfp = 0;
     |FINSI;

     dto_ho1 = dacum_30 % por1_hor1; dto_ho1 = dto_ho1 ! 2; || dto. horas 1
     dto_ho2 = dacum_31 % por1_hor2; dto_ho2 = dto_ho2 ! 2; || dto. horas 2
|FPRC;

/****************************************************************************/
/**************  PROCESOS PARA GRABAR LA SS A CARGO DE LA EMPRESA ***********/
/****************************************************************************/

|PROCESO SS_Empresa;
     #nomcalca#173 = nCuotaCC_Alta + nCuotaCC_IT;     || Comunes
     #nomcalca#174 = nCuotaDes_Alta + nCuotaDes_IT;   || Desempleo
     #nomcalca#175 = (nATEP_Alta + nATEP_IT) % #nomconst#14;      || FOGASA
     #nomcalca#176 = (nATEP_Alta + nATEP_IT) % #nomconst#16;      || FP
     #nomcalca#177 = base_9;      || AT + EP
     #nomcalca#179 = (dacum_30 % por2_hor1) + (dacum_31 % por2_hor2);  || Horas Extras

     || Bonificaciones
     #nomcalca#180 = base_A + base_B + base_C + zbase_A + zbase_B + zbase_C;
     #nomcalca#180 = #nomcalca#180 + nBonifFCI;
     #nomcalca#180 = #nomcalca#180 + nBonifERE;
     |SI #nombonif#10 = 4;    || mayores de 65 a¤os
          |SI #nomcalca#63 > 0;
               #nomcalca#180 = #nomcalca#180 - ((#nomcalca#43 % #nombonif#6) ! 2);
          |FINSI;
     |FINSI;

     || reducciones
     #nomcalca#180 = #nomcalca#180 + #nomcalca#148 + #nomcalca#155 + #nomcalca#156;
     |SI #nomcalca#61 = 0.27;                || Mayores 65
          #nomcalca#174 = 0;
          #nomcalca#175 = 0;
          #nomcalca#176 = 0;
     |FINSI;

     || para salir del paso de los negativos en la cuota total empresa
     || de momento
     nNume1 = #nomcalca#173 + #nomcalca#174 + #nomcalca#175 + #nomcalca#176;
     nNume1 = nNume1 + #nomcalca#177 + #nomcalca#179;
     nNume2 = #nomcalca#180;
     |SI nDesem ! 0; |Y #labtraba#188 ! "N";
          || solo estos casos
          nNume = nNume1 - nNume2;
          |SI nNume < 0;
               #nomcalca#180 = #nomcalca#180 + nNume;
          |FINSI;
     |FINSI;
|FPRC;
