|FICHEROS;
     labor008;
     laborn10;
     labort09;
     labort10;
     labort16;
     labort04;
     labort17;

     laborn01;
     laborn02;
     laborn03;
     laborn04;
     laborn05;
     laborn07;
     laborn08;
     laborb02;
     laborb03;
     laborb04;
     laborn09;
     laborn0a;

     laborn92;
     laborn99;
     laboru01;
     laborw01,MANTE;

     labempre;
     labtraba;
     labcontr;
     labregis;
     nomtrato;

     :/integral/def/dsam0103 #103;
     :/basica/def/agidanif;
|FIN;

|VARIABLES;
     aEstado           = "";
     aAlfa             = "";
     aDia              = "";
     aMes              = "";
     aAny              = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aAlfa3            = "";
     aComa             = "";
     aEsc1             = "";
     aEsc2             = "";
     aRetu             = "";
     aTecla            = "";
     aClave1           = "";
     aClave2           = "";
     aClave3           = "";
     aClave4           = "";
     aRojo             = "255,80,80;255,255,255";
     aParamOri         = "";
     aFicTmp           = "";
     aInforme          = "";
     aIP               = "";
     aDestino          = "";
     aOrigen           = "";
     swSigue           = "";
     aFichero1         = "";
     aFichHuella       = "";

     nHandle           = 0;
     nValorLog         = 0;
     nDesdeEmp         = 0;
     nHastaEmp         = 0;
     swUsuario         = 0;
     n0Vent            = 0;
     n1Vent            = 0;
     nGrid10           = 0;
     nGrid16           = 0;
     nBtnMod           = -1;
     nBtnImp           = -1;
     nBtnEli           = -1;
     nBtnCor           = -1;
     nBtnAct           = -1;
     nFecha            = 0;
     nModo             = 0;
     nPos1             = 0;
     nPos2             = 0;
     nCampo            = 0;
     nHay              = 0;
     swImpreExt        = 0;
     swHayAlgo         = 0;
     nNume             = 0;
     nCampo1           = 0;
     nError            = 0;
     nAvisos           = 0;

     fFecha            = @;
     fFechaHoy         = @;
     fFechaAlta        = @;
     fClave0           = @;

     {1}aContiene      = "";

 {-1}aAviso            = "";
     aAviso1           = "";
     aAviso2           = "";
     aAviso3           = "";
     aAviso4           = "";

     {-1}aVent         = "";
         aVent1        = 0;
         aVent2        = 0;
         aVent3        = 0;
         aVent4        = 0;
         aVent5        = "";

     &nLabornet        = 1;
     &eaOperacion      = "";
     &enBorrado        = 0;
     &enActualizado    = 0;
     &eaParam          = "";
     &enFSalida        = 0;
     &eaUsuario        = "";
     &eaMotiv          = "";
     &eaEstado         = "";
     &efFecha          = @;
     &eaHora           = "";
     &nContOrigen      = 0;
     &eaID             = "";
     &enID             = 0;
     &eaVengoDe        = "";
     &nArchi           = 0;
     &aIdContrata      = "";
     &enEmp            = 0;
     &enTra            = 0;
     &enMes            = 0;
     &enAny            = 0;
     &eaOrig           = "";
     &eaObservaciones  = "";
     &enSwErrorRecDoc  = 0;
     &eaQueEs            = "";

     swTitular = 0;
     aTipoDato = "";
|FIN;

|| -------------------------------------------------------------------------
||                            ACTUALIZACION
|| -------------------------------------------------------------------------

|PROCESO PonColor;
     |SI eaParam = "HISTO"; |O eaParam = "HISTOUSU";
          |ACABA;
     |FINSI;
     #labort10#15 = "";
     |SI #labort10#5 < fFechaHoy;
         #labort10#15 = aRojo;
     |FINSI;
|FPRC;

|PROCESO Log;
     |ABRE #laborn92;
     #laborn92#0 = #laborn01#5;
     #laborn92#1 = #laborn01#242;
     |LEE 101#laborn92.=;
     |SI FSalida = 0;
          #laborn92#2 = nValorLog;
          |GRABA 020#laborn92.a;
     |FINSI;
     |LIBERA #laborn92;
     |CIERRA #laborn92;
|FPRC;

|PROCESO GrabaTemporal;
     |SI swImpreExt = 1;
          |ACABA;
     |FINSI;

     |SI swUsuario = 0;
         #labor008#0 = #labort10#3;
         #labor008#1 = "";
         |LEE 000#labor008.];
         |SI FSalida = 0;  |Y #labor008#0 = #labort10#3;
             #labor008#0 = #labort10#3;
             #labor008#1 = Usuario % 810;
             |LEE 000#labor008.=;
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     |HAZ PonColor;

     |GRABA 020#labort10.n;
     |LIBERA #labort10;

     #labort16#0 = #labort10#3;
     |LEE 101#labort16.=;
     |SI FSalida ! 0;
         |DDEFECTO #labort16;
         #labort16#0 = #labort10#3;
         #labort16#1 = #labort10#4;
         |GRABA 020#labort16.b;
     |FINSI;

     #labort16#2 = #labort16#2 + 1;
     |GRABA 020#labort16.a;
     |LIBERA #labort16;

     swHayAlgo = 1;
|FPRC;

|PROCESO laborb02;
     #labort10#0 = "D";              || codigo operacion
     #labort10#1 = "Cambio de Datos";     || descripcion operacion
     #labort10#2 = #laborb02#27;     || usuario
     #labort10#3 = #laborb02#54;     || cod. empresa
     #labort10#6 = #laborb02#55;     || codigo trabajador

     #labempre#0 = #labort10#3;
     |LEE 000#labempre.=;

     #labtraba#0 = #labort10#3;
     #labtraba#1 = #labort10#6;
     |LEE 000#labtraba.=;

     #labort10#4 = #labempre#2;      || nombre empresa
     #labort10#7 = #laborb02#2;      || nombre trabajador

     fFecha = #laborb02#25;
     nFecha = fFecha;
     nFecha = nFecha + 1;
     fFecha = nFecha;
     #labort10#5 = fFecha;           || fecha operacion

     #labort10#8 = #laborb02#1;      || NIF trabajador

     #labort10#9 = #laborb02#25;     || fecha
     #labort10#10 = #laborb02#26;    || hora
     #labort10#11 = aEstado;         || estado

     #labort10#13 = #laborb02#28;    || fecha de solicitud
     #labort10#14 = #laborb02#29;    || hora de solicitud

     #labort10#16 = #laborb02#56;    || contador
     #labort10#17 = #laborb02#0;    || contador

     #labort10#18 = 0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborb02;
     #laborb02#2;
     ;
     aEstado, "01.01.1900", "00:00:00";
     aEstado, "31.12.2099", "23:59:59";
     ;
     NULL, laborb02;
|FIN;

|PROCESO laborb04;
     aAlfa1 = #laborb04#10;  |QBF aAlfa1;
     aAlfa2 = #laborb04#11;  |QBF aAlfa2;
     aAlfa3 = #laborb04#12;  |QBF aAlfa3;

     |SI aAlfa1 ! "";  |O aAlfa2 ! "";  |O aAlfa3 ! "";
         aComa = ",";
     |SINO;
         aComa = "";
     |FINSI;

     aAlfa        = aAlfa1 + " " + aAlfa2 + aComa + " " + aAlfa3;
     #laborb04#13 = aAlfa;

     |GRABA 020#laborb04.a;
     |LIBERA #laborb04;

     aAlfa = #laborb04#3;
     |QBF aAlfa;
     |SI aAlfa = "TITULAR"; aTipoDato = "Perceptor"; |FINSI;
     |SI aTipoDato ! "Perceptor";
          |SI aAlfa = "ASCENDIENTE"; aTipoDato = "Ascendientes"; |FINSI;
          |SI aAlfa = "DESCENDIENTE"; aTipoDato = "Descendientes"; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE laborb04;
     #laborb04#1;
     ;
     #laborb03#0, 00;
     #laborb03#0, 99;
     be;
     NULL, laborb04;
|FIN;

|PROCESO laborb03;
     aTipoDato = "";
     |BUCLE laborb04;
     |SI aTipoDato = "Perceptor";
          #labort10#0 = "F";
     |FINSI;
     |SI aTipoDato = "Descendientes";
          #labort10#0 = "G";
     |FINSI;
     |SI aTipoDato = "Ascendientes";
          #labort10#0 = "H";
     |FINSI;

     #labort10#1 = "Datos IRPF - " + aTipoDato;   || descripcion operacion
     #labort10#2 = #laborb03#7;               || usuario
     #labort10#3 = #laborb03#2;               || cod. empresa
     #labort10#6 = #laborb03#3;               || codigo trabajador

     #labempre#0 = #labort10#3;
     |LEE 000#labempre.=;

     #labtraba#0 = #labort10#3;
     #labtraba#1 = #labort10#6;
     |LEE 000#labtraba.=;

     #labort10#4 = #labempre#2;               || nombre empresa
     #labort10#7 = #labtraba#2;               || nombre trabajador

     fFecha = #laborb03#5;
     nFecha = fFecha;
     nFecha = nFecha + 1;
     fFecha = nFecha;
     #labort10#5 = fFecha;           || fecha operacion

     #labort10#8 = #laborb03#1;      || NIF trabajador

     #labort10#9  = #laborb03#5;     || fecha
     #labort10#10 = #laborb03#6;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborb03#11;    || usuario de actualizacion
     #labort10#13 = #laborb03#9;     || fecha de actualizacion
     #labort10#14 = #laborb03#10;    || hora de actualizacion

     aAlfa = #labort10#12;  |QBF aAlfa;
     |SI aAlfa = "";
         #labort10#13 = "01.01.0000";
     |FINSI;

     #labort10#16 = #laborb03#13;   || contador
     #labort10#17 = #laborb03#0;    || contador

     #labort10#18 = 0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborb03;
     #laborb03#2;
     ;
     aEstado, "01.01.1900", "00:00:00";
     aEstado, "31.12.2099", "23:59:59";
     ;
     NULL, laborb03;
|FIN;

|PROCESO laborn0a;
     #labort10#0 = "R";              || codigo operacion
     #labort10#1 = "Retenciones a Profesionales";        || descripcion operacion
     #labort10#2 = #laborn0a#1;      || usuario
     #labort10#3 = #laborn0a#5;      || cod. empresa
     #labort10#4 = #laborn0a#8;     || nombre empresa

     fFecha = #laborn0a#3;
     nFecha = fFecha;
     nFecha = nFecha + 1;
     fFecha = nFecha;
     #labort10#5 = fFecha;           || fecha operacion
     #labort10#6 = #laborn0a#6;      || codigo trabajador
     #labort10#7 = #laborn0a#9;     || nombre trabajador

     #labort10#8 = #laborn0a#7;      || NIF trabajador

     #labort10#9 = #laborn0a#3;      || fecha
     #labort10#10 = #laborn0a#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn0a#21;    || usuario que actualizo
     #labort10#13 = #laborn0a#22;    || fecha de actualizacion
     #labort10#14 = #laborn0a#23;    || hora de actualizacion

     #labort10#16 = #laborn0a#24;   || contador
     #labort10#18 = 0;

     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn0a;
     #laborn0a#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn0a;
|FIN;

|PROCESO laborn09;
     #labort10#0 = "E";              || codigo operacion
     #labort10#1 = "Embargo";        || descripcion operacion
     #labort10#2 = #laborn09#1;      || usuario
     #labort10#3 = #laborn09#5;      || cod. empresa
     #labort10#4 = #laborn09#8;     || nombre empresa

     fFecha = #laborn09#3;
     nFecha = fFecha;
     nFecha = nFecha + 1;
     fFecha = nFecha;
     #labort10#5 = fFecha;           || fecha operacion
     #labort10#6 = #laborn09#6;      || codigo trabajador
     #labort10#7 = #laborn09#9;     || nombre trabajador

     #labort10#8 = #laborn09#7;      || NIF trabajador

     #labort10#9 = #laborn09#3;      || fecha
     #labort10#10 = #laborn09#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn09#18;    || usuario que actualizo
     #labort10#13 = #laborn09#19;    || fecha de actualizacion
     #labort10#14 = #laborn09#20;    || hora de actualizacion

     #labort10#16 = #laborn09#21;   || contador
     #labort10#18 = 0;

     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn09;
     #laborn09#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn09;
|FIN;

|PROCESO laborn08;
     #labort10#0 = "C";              || codigo operacion
     #labort10#1 = "Correcci¢n";     || descripcion operacion
     #labort10#2 = #laborn08#1;      || usuario
     #labort10#3 = #laborn08#5;      || cod. empresa
     #labort10#6 = #laborn08#6;      || codigo trabajador

     #labempre#0 = #labort10#3;
     |LEE 000#labempre.=;

     #labtraba#0 = #labort10#3;
     #labtraba#1 = #labort10#6;
     |LEE 000#labtraba.=;

     #labort10#4 = #laborn08#8;      || nombre empresa
     #labort10#7 = #laborn08#9;      || nombre trabajador

     fFecha = #laborn08#3;
     nFecha = fFecha;
     nFecha = nFecha + 1;
     fFecha = nFecha;
     #labort10#5 = fFecha;           || fecha operacion

     #labort10#8 = #laborn08#7;      || NIF trabajador

     #labort10#9 = #laborn08#3;      || fecha
     #labort10#10 = #laborn08#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn08#26;    || usuario que actualizo
     #labort10#13 = #laborn08#27;    || fecha de actualizacion
     #labort10#14 = #laborn08#28;    || hora de actualizacion

     #labort10#16 = #laborn08#29;   || contador

     #labort10#18 = 0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn08;
     #laborn08#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn08;
|FIN;

|PROCESO laborn05;
     #labort10#0 = "P";              || codigo operacion
     #labort10#1 = "Pr¢rroga";       || descripcion operacion
     #labort10#2 = #laborn05#1;      || usuario
     #labort10#3 = #laborn05#5;      || cod. empresa
     #labort10#6 = #laborn05#6;      || codigo trabajador

     #labempre#0 = #labort10#3;
     |LEE 000#labempre.=;

     #labtraba#0 = #labort10#3;
     #labtraba#1 = #labort10#6;
     |LEE 000#labtraba.=;

     #labort10#4 = #labempre#2;      || nombre empresa
     #labort10#7 = #labtraba#2;      || nombre trabajador

     fFecha = #laborn05#9;
     nFecha = fFecha;
     nFecha = nFecha + 1;
     fFecha = nFecha;
     #labort10#5 = fFecha;           || fecha operacion

     #labort10#8 = #labtraba#7;      || NIF trabajador

     #labort10#9 = #laborn05#3;      || fecha
     #labort10#10 = #laborn05#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn05#19;    || usuario que actualizo
     #labort10#13 = #laborn05#20;    || fecha de actualizacion
     #labort10#14 = #laborn05#21;    || hora de actualizacion

     #labort10#16 = #laborn05#22;    || contador

     #labort10#18 = 0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn05;
     #laborn05#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn05;
|FIN;

|PROCESO laborn04;
     #labort10#0 = "I";              || codigo operacion
     #labort10#1 = "Incidencia";     || descripcion operacion
     #labort10#2 = #laborn04#1;      || usuario
     #labort10#3 = #laborn04#5;      || cod. empresa
     #labort10#6 = #laborn04#6;      || codigo trabajador

     #labempre#0 = #labort10#3;
     |LEE 000#labempre.=;

     #labtraba#0 = #labort10#3;
     #labtraba#1 = #labort10#6;
     |LEE 000#labtraba.=;

     #labort10#4 = #labempre#2;      || nombre empresa
     #labort10#7 = #labtraba#2;      || nombre trabajador

     aDia = "01";
     aMes = #laborn04#7;
     aAny = #laborn04#102;
     |QBF aDia;
     |QBF aMes;
     |QBF aAny;
     aDia = ("00" + aDia) % -102;
     aMes = ("00" + aMes) % -102;
     aAlfa = aDia + "." + aMes + "." + aAny;
     #labort10#5 = aAlfa;            || fecha operacion

     #labort10#8 = #labtraba#7;      || NIF trabajador

     #labort10#9 = #laborn04#3;      || fecha
     #labort10#10 = #laborn04#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn04#147;   || usuario que actualizo
     #labort10#13 = #laborn04#148;   || fecha de actualizacion
     #labort10#14 = #laborn04#149;   || hora de actualizacion

     #labort10#16 = #laborn04#150;   || contador

     #labort10#18 = 0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn04;
     #laborn04#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn04;
|FIN;

|PROCESO laborn03;
     #labort10#0 = "V";              || codigo operacion
     aAlfa = "Variaci¢n ";
     |SI #laborn03#7 = 1; aAlfa = aAlfa + "contrato"; |FINSI;
     |SI #laborn03#7 = 2; aAlfa = aAlfa + "categor¡a"; |FINSI;
     |SI #laborn03#7 = 3; aAlfa = aAlfa + "ocupaci¢n"; |FINSI;
     #labort10#1 = aAlfa;            || descripcion operacion
     #labort10#2 = #laborn03#1;      || usuario
     #labort10#3 = #laborn03#5;      || cod. empresa
     #labort10#6 = #laborn03#6;      || codigo trabajador

     #labempre#0 = #labort10#3;
     |LEE 000#labempre.=;

     #labtraba#0 = #labort10#3;
     #labtraba#1 = #labort10#6;
     |LEE 000#labtraba.=;

     #labort10#4 = #labempre#2;      || nombre empresa
     #labort10#7 = #labtraba#2;      || nombre trabajador

     #labort10#5 = #laborn03#30;     || fecha operacion

     #labort10#8 = #labtraba#7;      || NIF trabajador

     #labort10#9  = #laborn03#3;      || fecha
     #labort10#10 = #laborn03#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn03#34;    || usuario que actualizo
     #labort10#13 = #laborn03#35;    || fecha de actualizacion
     #labort10#14 = #laborn03#36;    || hora de actualizacion
     #labort10#16 = #laborn03#37;    || contador

     #labort10#18 = 0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn03;
     #laborn03#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn03;
|FIN;

|PROCESO laborn02;
     #labort10#0 = "B";              || codigo operacion
     #labort10#1 = "Baja";           || descripcion operacion
     #labort10#2 = #laborn02#1;      || usuario
     #labort10#3 = #laborn02#5;      || cod. empresa
     #labort10#4 = #laborn02#15;     || nombre empresa

     #labort10#5 = #laborn02#8;      || fecha operacion
     #labort10#6 = #laborn02#6;      || codigo trabajador
     #labort10#7 = #laborn02#16;     || nombre trabajador

     #labort10#8 = #laborn02#7;      || NIF trabajador

     #labort10#9 = #laborn02#3;      || fecha
     #labort10#10 = #laborn02#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn02#19;    || usuario que actualizo
     #labort10#13 = #laborn02#20;    || fecha de actualizacion
     #labort10#14 = #laborn02#21;    || hora de actualizacion

     #labort10#16 = #laborn02#23;   || contador
     #labort10#18 = 0;

     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn02;
     #laborn02#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn02;
|FIN;

|PROCESO laborn01;
     #labort10#0 = "A";              || codigo operacion

     /*
     |SI #laborn01#0 = "M";
          #labort10#0 = "M";              || codigo operacion
          #labort10#1 = "Raro";              || codigo operacion
     |FINSI;
     */

     |SI #laborn01#0 ! "A"; |Y #laborn01#0 ! "P";
          |ACABA;
     |FINSI;

     #labort10#1 = "Alta";           || descripcion operacion
     #labort10#2 = #laborn01#1;      || usuario
     #labort10#3 = #laborn01#5;      || cod. empresa
     #labort10#4 = #laborn01#210;    || nombre empresa
     aDia = #laborn01#193;
     aMes = #laborn01#194;
     aAny = #laborn01#195;
     |QBF aDia;
     |QBF aMes;
     |QBF aAny;
     aDia = ("00" + aDia) % -102;
     aMes = ("00" + aMes) % -102;
     aAlfa = aDia + "." + aMes + "." + aAny;
     #labort10#5 = aAlfa;            || fecha operacion
     #labort10#6 = #laborn01#215;    || codigo trabajador

     aAlfa = #laborn01#7; |QBF aAlfa;
     aAlfa = aAlfa + " " + #laborn01#8; |QBF aAlfa;
     aAlfa = aAlfa + ", " + #laborn01#6; |QBF aAlfa;
     #labort10#7 = aAlfa;            || nombre trabajador

     #labort10#8 = #laborn01#9;      || NIF trabajador

     #labort10#9 = #laborn01#3;      || fecha
     #labort10#10 = #laborn01#4;     || hora
     #labort10#11 = aEstado;         || estado

     #labort10#12 = #laborn01#235;   || usuario que actualizo
     #labort10#13 = #laborn01#236;   || fecha de actualizacion
     #labort10#14 = #laborn01#237;   || hora de actualizacion

     #labort10#16 = #laborn01#242;   || contador

     |ABRE #laborn92;
     #laborn92#0 = #labort10#3;
     #laborn92#1 = #labort10#16;
     |LEE 000#laborn92.=;
     |SI FSalida = 0;
          #labort10#18 = #laborn92#2;
     |SINO;
          #labort10#18 = 0;
     |FINSI;
     |CIERRA #laborn92;

     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE laborn01;
     #laborn01#2;
     ;
     aEstado, nDesdeEmp, "01.01.1900", "          ", "          ", "00:00:00";
     aEstado, nHastaEmp, "31.12.2099", "zzzzzzzzzz", "zzzzzzzzzz", "23:59:59";
     ;
     NULL, laborn01;
|FIN;

|PROCESO CargaSolicitudes;
     |SI swUsuario = 1;
          nDesdeEmp = #labort09#0;
          nHastaEmp = #labort09#0;
     |SINO;
          nDesdeEmp = 00001;
          nHastaEmp = 99999;
     |FINSI;

     |BUCLE laborn01;
     |BUCLE laborn02;
     |BUCLE laborn03;
     |BUCLE laborn04;
     |BUCLE laborn05;
     |BUCLE laborn08;
     |BUCLE laborn09;
     |BUCLE laborn0a;
     |SI swUsuario ! 1;       || solo administrador
          |BUCLE laborb02;
          |BUCLE laborb03;
     |FINSI;
|FPRC;

|DEFBUCLE CargaSolicitudes;
     #labort09#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CargaSolicitudes;
|FIN;

|PROCESO carga_empresas;
     #labort09#0 = #labempre#0;
     |LEE 101#labort09.=;
     |SI FSalida ! 0;
          |GRABA 020#labort09.n;
     |FINSI;
     |LIBERA #labort09;
|FPRC;

|DEFBUCLE carga_empresas;
     #labempre#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, carga_empresas;
|FIN;

|PROCESO BorraLineal;
     |BORRA 020#labort10.a;
     |LIBERA #labort10;

     #labort16#0 = #labort10#3;
     |LEE 101#labort16.=;
     |SI FSalida = 0;
         #labort16#2 = #labort16#2 - 1;
         |GRABA 020#labort16.a;
         |SI #labort16#2 = 0;
              |BORRA 020#labort16.a;
         |FINSI;
         |LIBERA #labort16;
     |FINSI;
|FPRC;

|DEFBUCLE BorraLineal;
     #labort10#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, BorraLineal;
|FIN;

|PROCESO RecargaLineal;
     |SALVA_DATOS #labort10;
     |SALVA_DATOS #labort16;

     fClave0 = #labort10#5;
     aClave1 = #labort10#0;
     aClave2 = #labort10#2;
     aClave3 = #labort10#9;
     aClave4 = #labort10#10;

     |BUCLE BorraLineal;

     |SI swUsuario = 1;
          || entrada de USUARIO, primero genero un temporal con las empresas
          || a las que tengo acceso, realizando la carga desde el labempre
          || que con el DFICE y DFICB tengo controlado el labempre
          |BUCLE carga_empresas;
     |FINSI;

     |SI eaParam = "HISTO"; |O eaParam = "HISTOUSU";
          aEstado = "A";
     |SINO;
          aEstado = "P";
     |FINSI;

     |SI swUsuario = 1;
          || carga solo de las empresas a las que tiene acceso
          |BUCLE CargaSolicitudes;
     |SINO;
          || ADMINISTRADOR, directamente el proceso
          |HAZ CargaSolicitudes;
     |FINSI;

     |REPON_DATOS #labort16;
     |LEE 000#labort16.=;
     |REFRESCACONTROL nGrid16;

     |REPON_DATOS #labort10;
     |SELECT #2#labort10;
     |LEE 000#labort10.=;
     |REFRESCACONTROL nGrid10;

     |FOCOTECLADO nGrid10;
|FPRC;

|| -------------------------------------------------------------------------

|PROCESO Recarga_n10;
     |PARA nCampo = 0; |SI nCampo [ 17; |HACIENDO nCampo = nCampo + 1;
          #laborn10#nCampo# = #labort10#nCampo#;
     |SIGUE;
|FPRC;

|PROCESO BtnMod;
     |HAZ Recarga_n10;

     |SI eaParam = "USUARIO";
          aAlfa1 = Usuario % 0810; |QBT aAlfa1;
          aAlfa2 = #labort10#2; |QBT aAlfa2;
          |SI aAlfa1 ! aAlfa2;
               |DFICE aAlfa1;
               aAlfa1 = aAlfa1 % -106;
               aAlfa1 = aAlfa1 - "/";
               nNume = aAlfa1;
               #laborn99#0 = nNume;
               |LEE 000#laborn99.=;
               |SI FSalida = 0;
                    aAlfa1 = Usuario % 0810; |QBT aAlfa1;
                    aAlfa2 = #laborn99#2; |QBT aAlfa2;
                    |SI aAlfa1 ! aAlfa2;
                         |MENAV "    El usuario no puede modificar una solicitud que no fue creada por ‚l mismo.";
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     enFSalida = 10;

     |SI #laborn10#0 = "A"; aAlfa = "laborn01;X"; |FINSI;
     |SI #laborn10#0 = "B"; aAlfa = "laborn02;X"; |FINSI;
     |SI #laborn10#0 = "V"; aAlfa = "laborn03;X"; |FINSI;
     |SI #laborn10#0 = "I"; aAlfa = "laborn04;X"; |FINSI;
     |SI #laborn10#0 = "P"; aAlfa = "laborn05;X"; |FINSI;
     |SI #laborn10#0 = "C"; aAlfa = "laborn08;X"; |FINSI;
     |SI #laborn10#0 = "D"; aAlfa = "laborb02;X"; |FINSI;
     |SI #laborn10#0 = "E"; aAlfa = "laborn09;X"; |FINSI;
     |SI #laborn10#0 = "R"; aAlfa = "laborn0a;X"; |FINSI;
     |SI #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          aAlfa = "laborb03;X";
     |FINSI;

     aAlfa     = "*" + aAlfa;
     aAlfa     = aAlfa + "10";
     |SI #laborn10#0 = "D";
     |O #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          eaID = #laborn10#17;
          |QBF eaID;
          eaID = ("0000000" + eaID) % -107;
          aAlfa = aAlfa + eaID;
          aAlfa = aAlfa + eaParam;
     |SINO;
          aAlfa = aAlfa + #laborn10#11;
          aAlfa = aAlfa + #laborn10#2;
          aAlfa = aAlfa + #laborn10#9;
          aAlfa = aAlfa + #laborn10#10;
          aAlfa = aAlfa + eaParam;
     |FINSI;
     |SUB_EJECUTA aAlfa;

     |HAZ RecargaLineal;

     |REPON_DATOS #labort16;
     |LEE 000#labort16.=;
     |REFRESCACONTROL nGrid16;

     |REPON_DATOS #labort10;
     |SELECT #2#labort10;
     |LEE 000#labort10.=;
     |REFRESCACONTROL nGrid10;

     |FOCOTECLADO nGrid10;
|FPRC;

|PROCESO OrigenCorrec;
     |SI #laborn08#10 = "A";
          |DDEFECTO #laborn01;
          |ABRE #laborn01;
          #laborn01#0 = "A";
          #laborn01#1 = #laborn08#14;
          #laborn01#3 = #laborn08#12;
          #laborn01#4 = #laborn08#13;
          |LEE 000#laborn01.=;
          |CIERRA #laborn01;
          nContOrigen = #laborn01#242;
     |FINSI;

     |SI #laborn01#199 = "   ";
          #laborn01#199 = "000";
     |FINSI;

     |SI #laborn08#10 = "B";
          |DDEFECTO #laborn02;
          |ABRE #laborn02;
          #laborn02#0 = "A";
          #laborn02#1 = #laborn08#14;
          #laborn02#3 = #laborn08#12;
          #laborn02#4 = #laborn08#13;
          |LEE 000#laborn02.=;
          |CIERRA #laborn02;
          nContOrigen = #laborn02#23;
     |FINSI;

     |SI #laborn08#10 = "V";
          |DDEFECTO #laborn03;
          |ABRE #laborn03;
          #laborn03#0 = "A";
          #laborn03#1 = #laborn08#14;
          #laborn03#3 = #laborn08#12;
          #laborn03#4 = #laborn08#13;
          |LEE 000#laborn03.=;
          |CIERRA #laborn03;
          nContOrigen = #laborn03#37;
     |FINSI;

     |SI #laborn08#10 = "A"; |O #laborn08#10 = "V";
          |DDEFECTO #laborn07;
          |ABRE #laborn07;
          #laborn07#0 = "A";
          #laborn07#1 = #laborn08#14;
          #laborn07#3 = #laborn08#12;
          #laborn07#4 = #laborn08#13;
          |LEE 000#laborn07.=;
          |CIERRA #laborn07;
     |FINSI;

     |SI #laborn08#10 = "I";
          |DDEFECTO #laborn04;
          |ABRE #laborn04;
          #laborn04#0 = "A";
          #laborn04#1 = #laborn08#14;
          #laborn04#3 = #laborn08#12;
          #laborn04#4 = #laborn08#13;
          |LEE 000#laborn04.=;
          |CIERRA #laborn04;
          nContOrigen = #laborn04#150;
     |FINSI;

     |SI #laborn08#10 = "P";
          |DDEFECTO #laborn05;
          |ABRE #laborn05;
          #laborn05#0 = "A";
          #laborn05#1 = #laborn08#14;
          #laborn05#3 = #laborn08#12;
          #laborn05#4 = #laborn08#13;
          |LEE 000#laborn05.=;
          |CIERRA #laborn05;
          nContOrigen = #laborn01#22;
     |FINSI;
|FPRC;

|PROCESO Calendario;
     || aFicTmp = "labort04" + Usuario;
     aFicTmp = "tm4" + Usuario; |QBF aFicTmp;
     |NOME_DAT #labort04#aFicTmp#;
     |ABRE #labort04; |CIERRA #labort04; |DELINDEX #labort04;
     |ABRE #labort04;
     #labort04#0 = #laborn10#3;
     #labort04#1 = #laborn10#6;
     |PARA nCampo = 7; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
          nCampo1 = nCampo - 5;
          #labort04#nCampo1# = #laborn07#nCampo#;
     |SIGUE;
     |GRABA 020#labort04.n;
     |CIERRA #labort04;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aDestino = aContiene1; |QBF aDestino;
     aDestino = aDestino + "crystal/" + "labort04.dbf";

     |DFICE aOrigen; |QBF aOrigen;
     aOrigen = aOrigen + aFicTmp + ".dbf";
     aIP = ""; |IP_REMOTO aIP;

     |SI aIP = "";
          |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
          |ENVIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO laborb04I;
     |SI swTitular = 1;
          |ACABA;
     |FINSI;

     |SI #laborb04#1 = 01; |Y #laborb04#3 = "TITULAR     ";
          swTitular = 1;
     |FINSI;

     |SI #laborb04#3 = "CONYUGE     ";
         |ACABA;
     |FINSI;

     |DDEFECTO #labort17;

     #labort17#40 = "";

/*
     |ABRE #agidanif;
     #agidanif#0 = #laborb04#2;
     #agidanif#1 = #laborb04#1;
     |LEE 000#agidanif.=;
     |SI FSalida ! 0;
         #labort17#40 = "A";
     |FINSI;
     |CIERRA #agidanif;

     |SI #laborb04#117 = "B";
         |SI #labort17#40 = "A";  |Y #laborb03#4 = "N";
             |ACABA;
         |FINSI;

         #labort17#40 = "B";
     |FINSI;

     |SI #labort17#40 = " ";
         #labort17#40 = "M";
     |FINSI;
*/
     #labort17#40 = #laborb04#117;

     #labort17#0  = #laborb04#3;
     #labort17#1  = #laborb04#1;
     #labort17#2  = #laborb04#14;
     #labort17#3  = #laborb04#71;

     #labort17#4  = "N";
     #labort17#5  = "N";

     |SI #laborb04#24 ! " ";  #labort17#4  = "S";  |FINSI;
     |SI #laborb04#81 ! " ";  #labort17#5  = "S";  |FINSI;

     #labort17#6  = #laborb04#18;
     #labort17#7  = #laborb04#75;
     #labort17#8  = #laborb04#19;
     #labort17#9  = #laborb04#76;
     #labort17#10 = "Situaci¢n " + #laborb04#16;
     #labort17#11 = "Situaci¢n " + #laborb04#73;

     |SI #laborb04#17 = "A";
         #labort17#14 = "Empleado o trabajador en activo";
     |FINSI;

     |SI #laborb04#17 = "P";
         #labort17#14 = "Pensionista de la Sesuridad social o clases pasivas";
     |FINSI;

     |SI #laborb04#17 = "D";
         #labort17#14 = "Desempleado";
     |FINSI;

     |SI #laborb04#17 = "O";
         #labort17#14 = "Otras situaciones";
     |FINSI;

     |SI #laborb04#74 = "A";
         #labort17#15 = "Empleado o trabajador en activo";
     |FINSI;

     |SI #laborb04#74 = "P";
         #labort17#15 = "Pensionista de la Sesuridad social o clases pasivas";
     |FINSI;

     |SI #laborb04#74 = "D";
         #labort17#15 = "Desempleado";
     |FINSI;

     |SI #laborb04#74 = "O";
         #labort17#15 = "Otras situaciones";
     |FINSI;

     |SI #laborb04#37 = 1;
         #labort17#16 = "General";
     |FINSI;

     |SI #laborb04#37 = 2;
         #labort17#16 = "Duraci¢n inferior a 1 a¤o, excepto relaciones espor dicas (peonadas o jornales diarios)";
     |FINSI;

     |SI #laborb04#37 = 3;
         #labort17#16 = "Relaciones laborales especiales de car cter dependiente (salvo penados y discapacitados)";
     |FINSI;

     |SI #laborb04#37 = 4;
         #labort17#16 = "Relaciones espor dicas propias de retribuciones por peonadas o jornales diarios";
     |FINSI;

     |SI #laborb04#94 = 1;
         #labort17#17 = "General";
     |FINSI;

     |SI #laborb04#94 = 2;
         #labort17#17 = "Duraci¢n inferior a 1 a¤o, excepto relaciones espor dicas (peonadas o jornales diarios)";
     |FINSI;

     |SI #laborb04#94 = 3;
         #labort17#17 = "Relaciones laborales especiales de car cter dependiente (salvo penados y discapacitados)";
     |FINSI;

     |SI #laborb04#94 = 4;
         #labort17#17 = "Relaciones espor dicas propias de retribuciones por peonadas o jornales diarios";
     |FINSI;

     #labort17#18 = #laborb04#40;
     #labort17#19 = #laborb04#97;

     #labort17#20 = #laborb04#9;
     #labort17#21 = #laborb04#66;

     #labort17#22 = #laborb04#13;
     #labort17#23 = #laborb04#70;

     #labort17#24 = #laborb04#6;
     #labort17#25 = #laborb04#63;

     |SI #laborb04#42 ! 0;  #labort17#26 = #laborb04#42;  |FINSI;
     |SI #laborb04#99 ! 0;  #labort17#27 = #laborb04#99;  |FINSI;

     #labort17#28 = "N";
     #labort17#29 = "N";

     |SI #laborb04#4  = "1";  #labort17#28  = "S";  |FINSI;
     |SI #laborb04#61 = "1";  #labort17#29  = "S";  |FINSI;

     #labort17#30 = #laborb04#41;
     #labort17#31 = #laborb04#98;

     #labort17#32 = #laborb04#59;
     #labort17#33 = #laborb04#116;

     #labort17#34 = #laborb04#45;
     #labort17#35 = #laborb04#102;

     #labort17#36 = #laborb04#119;
     #labort17#37 = #laborb04#121;

     #labort17#38 = #laborb04#120;
     #labort17#39 = #laborb04#122;

     |SI #laborb04#3 = "TITULAR     ";
         |SALVA_DATOS #laborb04;

         |LEE 000#laborb04.s;
         |PARA;  |SI FSalida = 0; |Y #laborb03#0 = #laborb04#0;  |HACIENDO;
              |SI #laborb04#3 = "CONYUGE     ";
                  #labort17#12 = #laborb04#9;
                  #labort17#13 = #laborb04#66;

                  |SI #laborb04#117 = "B";
                      #labort17#12 = "";
                  |FINSI;

                  |SAL;
              |FINSI;

              |LEE 000#laborb04.s;
         |SIGUE;

         |REPON_DATOS #laborb04;
         |LEE 000#laborb04.=;
     |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE laborb04I;
     #laborb04#1;
     ;
     #laborb03#0, 00;
     #laborb03#0, 99;
     ;
     NULL, laborb04I;
|FIN;

|PROCESO BtnImp;
     |SI #labort10#0 = "E";
          |MENAV "    No est  disponible la impresión de la solicitud de embargo";
          |ACABA;
     |FINSI;

     |HAZ Recarga_n10;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aInforme =  "laborn10";
     |SI #laborn10#0 = "D";  aInforme =  "laborn1x";  |FINSI;
     |SI #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          aInforme =  "laborn1a";
     |FINSI;

     |INFOR aInforme;

     |DDEFECTO #laborn01;
     |DDEFECTO #laborn02;
     |DDEFECTO #laborn03;
     |DDEFECTO #laborn04;
     |DDEFECTO #laborn05;
     |DDEFECTO #laborn08;

     |SI #laborn10#0 = "A";
         |DDEFECTO #laborn01;
         |ABRE #laborn01;
         #laborn01#0 = #laborn10#11;
         #laborn01#1 = #laborn10#2;
         #laborn01#3 = #laborn10#9;
         #laborn01#4 = #laborn10#10;
         |LEE 000#laborn01.=;
         |CIERRA #laborn01;
         |HAZ Calendario;
     |FINSI;

     |SI #laborn01#199 = "   ";
         #laborn01#199 = "000";
     |FINSI;

     |SI #laborn10#0 = "B";
         |DDEFECTO #laborn02;
         |ABRE #laborn02;
         #laborn02#0 = #laborn10#11;
         #laborn02#1 = #laborn10#2;
         #laborn02#3 = #laborn10#9;
         #laborn02#4 = #laborn10#10;
         |LEE 000#laborn02.=;
         |CIERRA #laborn02;

         |SI #laborn10#6 ! 0;
             |DDEFECTO #labtraba;
             #labtraba#0 = #laborn10#3;
             #labtraba#1 = #laborn10#6;
             |LEE 000#labtraba.=;
         |SINO;
             aAlfa = #laborn02#10;
             |QBF aAlfa;
             aAlfa1 = "Baja autom tica generada a partir de movimiento de alta n£mero ";
             aAlfa = aAlfa - aAlfa1;
             |SI FSalida ! 0;
                 |QBF aAlfa;
                 nNume = aAlfa;
             |SINO;
                 nNume = #laborn02#23 - 1;
             |FINSI;

             |ABRE #laborn01;
             |SELECT #3#laborn01;
             |DDEFECTO #laborn01;
             #laborn01#242 = nNume;
             |LEE 000#laborn01.=;
             |SI FSalida = 0; |Y #laborn01#9 = #laborn02#7;
                  #labtraba#45 = #laborn01#199;
             |FINSI;
             |SELECT #1#laborn01;
             |CIERRA #laborn01;
         |FINSI;

         |ABRE #nomtrato;
         |DDEFECTO #nomtrato;
         #nomtrato#0 = 0111;
         #nomtrato#1 = #labtraba#45;
         |LEE 000#nomtrato.=;
         |CIERRA #nomtrato;

         |HAZ Calendario;
     |FINSI;

     |SI #laborn10#0 = "V";
         |DDEFECTO #laborn03;
         |ABRE #laborn03;
         #laborn03#0 = #laborn10#11;
         #laborn03#1 = #laborn10#2;
         #laborn03#3 = #laborn10#9;
         #laborn03#4 = #laborn10#10;
         |LEE 000#laborn03.=;
         |CIERRA #laborn03;
         |HAZ Calendario;
     |FINSI;

     |SI #laborn10#0 = "A"; |O #laborn10#0 = "V";
         |DDEFECTO #laborn07;
         |ABRE #laborn07;
         #laborn07#0 = #laborn10#11;
         #laborn07#1 = #laborn10#2;
         #laborn07#3 = #laborn10#9;
         #laborn07#4 = #laborn10#10;
         |LEE 000#laborn07.=;
         |CIERRA #laborn07;

         |HAZ Calendario;
     |FINSI;

     |SI #laborn10#0 = "I";
         |DDEFECTO #laborn04;
         |ABRE #laborn04;
         #laborn04#0 = #laborn10#11;
         #laborn04#1 = #laborn10#2;
         #laborn04#3 = #laborn10#9;
         #laborn04#4 = #laborn10#10;
         |LEE 000#laborn04.=;
         |CIERRA #laborn04;
         |HAZ Calendario;
     |FINSI;

     |SI #laborn10#0 = "P";
         |DDEFECTO #laborn05;
         |ABRE #laborn05;
         #laborn05#0 = #laborn10#11;
         #laborn05#1 = #laborn10#2;
         #laborn05#3 = #laborn10#9;
         #laborn05#4 = #laborn10#10;
         |LEE 000#laborn05.=;
         |CIERRA #laborn05;
         |HAZ Calendario;
     |FINSI;

     |SI #laborn10#0 = "C";
         |DDEFECTO #laborn08;
         |ABRE #laborn08;
         #laborn08#0 = #laborn10#11;
         #laborn08#1 = #laborn10#2;
         #laborn08#3 = #laborn10#9;
         #laborn08#4 = #laborn10#10;
         |LEE 000#laborn08.=;
         |CIERRA #laborn08;
         |HAZ Calendario;

         |HAZ OrigenCorrec;
     |FINSI;

     |SI #laborn10#0 = "D";
         |DDEFECTO #laborb02;
         |ABRE #laborb02;
         #laborb02#0 = #laborn10#17;
         |LEE 000#laborb02.=;
         |CIERRA #laborb02;
     |FINSI;

     |SI #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
         |DDEFECTO #laborb03;
         |ABRE #laborb03;
         #laborb03#0 = #laborn10#17;
         |LEE 000#laborb03.=;
         |CIERRA #laborb03;

         swTitular = 0;
         |BUCLE laborb04I;
     |FINSI;

     |SI #laborn10#0 ! "F";
         |PRINT;
     |FINSI;

     |PIEINF;
     |FININF;
     |FINIMP;

     |ABRE #labort04;  |CIERRA #labort04;  |DELINDEX #labort04;

     |SI swImpreExt = 0;
         |FOCOTECLADO nGrid10;
     |FINSI;
|FPRC;

|PROCESO BtnEli;
     |HAZ Recarga_n10;

     |SI eaParam = "USUARIO";
          aAlfa1 = Usuario % 0810; |QBT aAlfa1;
          aAlfa2 = #labort10#2; |QBT aAlfa2;
          |SI aAlfa1 ! aAlfa2;
               |DFICE aAlfa1;
               aAlfa1 = aAlfa1 % -106;
               aAlfa1 = aAlfa1 - "/";
               nNume = aAlfa1;
               #laborn99#0 = nNume;
               |LEE 000#laborn99.=;
               |SI FSalida = 0;
                    aAlfa1 = Usuario % 0810; |QBT aAlfa1;
                    aAlfa2 = #laborn99#2; |QBT aAlfa2;
                    |SI aAlfa1 ! aAlfa2;
                         |MENAV "    El usuario no puede rechazar una solicitud que no fue creada por ‚l mismo.";
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |CONFI "0000N¿Est  seguro de que desea rechazar la solicitud seleccionada?";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1250, -1, 16, "Introduzca un motivo";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #laborw01;

     |PINPA #0#laborw01;
     |PINDA #0#laborw01;
     |ENDATOS #1#laborw01;
     nError = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |SI nError ! 0;
         |MENAV "0000Proceso cancelado.";
         |ACABA;
     |FINSI;

     eaMotiv   = #laborw01#0 + #laborw01#1 + #laborw01#2 + #laborw01#3 + #laborw01#4;
     enFSalida = 12;

     |SI #laborn10#0 = "A"; aAlfa = "laborn01;X"; |FINSI;
     |SI #laborn10#0 = "B"; aAlfa = "laborn02;X"; |FINSI;
     |SI #laborn10#0 = "V"; aAlfa = "laborn03;X"; |FINSI;
     |SI #laborn10#0 = "I"; aAlfa = "laborn04;X"; |FINSI;
     |SI #laborn10#0 = "P"; aAlfa = "laborn05;X"; |FINSI;
     |SI #laborn10#0 = "C"; aAlfa = "laborn08;X"; |FINSI;
     |SI #laborn10#0 = "D"; aAlfa = "laborb02;X"; |FINSI;
     |SI #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          aAlfa = "laborb03;X";
     |FINSI;
     |SI #laborn10#0 = "E"; aAlfa = "laborn09;X"; |FINSI;
     |SI #laborn10#0 = "R"; aAlfa = "laborn0a;X"; |FINSI;

||     aAlfa     = "*" + aAlfa;
     aAlfa     = aAlfa + "12";

     |SI #laborn10#0 = "D";
     |O #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          eaID = #laborn10#17;
          |QBF eaID;
          eaID = ("0000000" + eaID) % -107;
          aAlfa = aAlfa + eaID;
          aAlfa = aAlfa + eaParam;
     |SINO;
          aAlfa = aAlfa + #laborn10#11;
          aAlfa = aAlfa + #laborn10#2;
          aAlfa = aAlfa + #laborn10#9;
          aAlfa = aAlfa + #laborn10#10;
          aAlfa = aAlfa + eaParam;
     |FINSI;

     |SUB_EJECUTA aAlfa;

     |HAZ RecargaLineal;
|FPRC;

|PROCESO BtnCor;
     |HAZ Recarga_n10;

     aAlfa = "laborn18;X";
     aAlfa = aAlfa + #laborn10#0;
     aAlfa = aAlfa + #laborn10#11;
     aAlfa = aAlfa + #laborn10#2;
     aAlfa = aAlfa + #laborn10#9;
     aAlfa = aAlfa + #laborn10#10;
     aAlfa = aAlfa + "USUARIO";

     || aAlfa     = "*:laboral/" + aAlfa;
     aAlfa     = "*" + aAlfa;

     |SUB_EJECUTA aAlfa;

     |HAZ RecargaLineal;
|FPRC;

|PROCESO DSArchi;
     eaVengoDe = "labimpre";
     nArchi = 0;
     |HAZ MiraSiArchiva;

     |SI nArchi ! 1;
          |ACABA;
     |FINSI;

     aAlfa = "    SPulse SI para archivar la huella del contrato o NO para no archivar.";
     |CONFI aAlfa;
     |SI FSalida ! 0;
          nArchi = 0;
     |FINSI;

     |SI nArchi ! 1;
          |ACABA;
     |FINSI;

     swSigue = 1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aAlfa = aContiene1;
     |QBF aAlfa;
     aAlfa = aAlfa + "conectass";

     #labcontr#63 = aAlfa;

     aAlfa = #labcontr#63; |QBF aAlfa;
     aFichero1 = (aIdContrata % 101) + "-" + (aIdContrata % 202) + "-" + (aIdContrata % 404) + "-" + (aIdContrata % 807);

     |SI eaQueEs = "C";
          aFichero1 = (aIdContrata % 101) + "-" + (aIdContrata % 202) + "-" + (aIdContrata % 404) + "-" + (aIdContrata % 807) + "_CON";
     |FINSI;

     |SI eaQueEs = "P"
          aFichero1 = (aIdContrata % 101) + "-" + (aIdContrata % 202) + "-" + (aIdContrata % 404) + "-" + (aIdContrata % 807) + "_PRO";
     |FINSI;

     |SI eaQueEs = "T"
          aFichero1 = (aIdContrata % 101) + "-" + (aIdContrata % 202) + "-" + (aIdContrata % 404) + "-" + (aIdContrata % 807) + "_TRANS";
     |FINSI;

     aFichero1 = aFichero1 + ".pdf";
     aFichHuella = aFichero1;
     aAlfa = aAlfa + "\HCONTRATOS\" + aFichero1;

     |XABRE "CE", aAlfa, nHandle;
     |SI FSalida < 0;
          swSigue = 0;
     |FINSI;
     |XCIERRA nHandle;

     |SI swSigue = 0;
          aAlfa = "    No se ha encontrado la huella del contrato para archivar";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     enEmp = #labregis#1;
     enTra = #labregis#2;

     fFechaAlta = #labregis#7;

     aAlfa = fFechaAlta;
     aAlfa = aAlfa % 402;
     enMes = aAlfa;
     aAlfa = fFechaAlta;
     aAlfa = aAlfa % -104;
     enAny = aAlfa;

     || aqui le tengo que poner el nombre de los archivos para enviar uno y
     || despues el otro

     aAlfa = #labcontr#63; |QBF aAlfa;
     aAlfa = aAlfa + "\HCONTRATOS\" + aFichHuella;
     eaOrig = aAlfa;
     eaObservaciones = "Huella del contrato de trabajo";
     |HAZ Archivando;

     |SI enSwErrorRecDoc ! 1;
          aAlfa = "    Se ha archivado la huella del registro ";
          |SI eaQueEs = "C";
               aAlfa = aAlfa + "del contrato de trabajo del trabajador.";
          |FINSI;
          |SI eaQueEs = "P";
               aAlfa = aAlfa + "de la prórroga del trabajador.";
          |FINSI;
          |SI eaQueEs = "T";
               aAlfa = aAlfa + "de la transformación del trabajador.";
          |FINSI;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO ImpresionContrato;
     |DDEFECTO #laborn01;
     |ABRE #laborn01;
     #laborn01#0 = "A";
     #laborn01#1 = #laborn10#2;
     #laborn01#3 = #laborn10#9;
     #laborn01#4 = #laborn10#10;
     |LEE 000#laborn01.=;
     |CIERRA #laborn01;

     |SI #laborn01#243 ! 0;
          |CONFI "    S¿Desea imprimir el contrato del trabajador?";
          |SI FSalida = 0;
               aAlfa = #laborn01#243;
               |QBF aAlfa;
               aAlfa = "*:laboral/labimpre;" + aAlfa + "IMPLABORNET";
               |SUB_EJECUTA aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ImpresionContratoVar;
     |DDEFECTO #laborn03;
     |ABRE #laborn03;
     #laborn03#0 = "A";
     #laborn03#1 = #laborn10#2;
     #laborn03#3 = #laborn10#9;
     #laborn03#4 = #laborn10#10;
     |LEE 000#laborn03.=;
     |CIERRA #laborn03;

     |SI #laborn03#45 ! 0;
          |CONFI "    S¿Desea imprimir el contrato del trabajador?";
          |SI FSalida = 0;
               aAlfa = #laborn03#45;
               |QBF aAlfa;
               aAlfa = "*:laboral/labimpre;" + aAlfa + "IMPLABORNET";
               |SUB_EJECUTA aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BtnAct;
     |HAZ Recarga_n10;

     |SI #laborn10#0 = "B"; |Y #laborn10#6 = 00000;
          aAlfa = "    El c¢digo de trabajador es 00000. La baja se ha generado a partir de ";
          aAlfa = aAlfa + "un proceso de alta";
          |MENAV aAlfa;

          aAlfa = "    Es obligatorio actualizar primero el proceso de alta, ";
          aAlfa = aAlfa + "para tener asignado el c¢digo de trabajador";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     enFSalida = 11;

     |SI #laborn10#0 = "A"; aAlfa = "laborn01;X"; |FINSI;
     |SI #laborn10#0 = "B"; aAlfa = "laborn02;X"; |FINSI;
     |SI #laborn10#0 = "V"; aAlfa = "laborn03;X"; |FINSI;
     |SI #laborn10#0 = "I"; aAlfa = "laborn04;X"; |FINSI;
     |SI #laborn10#0 = "P"; aAlfa = "laborn05;X"; |FINSI;
     |SI #laborn10#0 = "C"; aAlfa = "laborn08;X"; |FINSI;
     |SI #laborn10#0 = "D"; aAlfa = "laborb02;X"; |FINSI;
     |SI #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          aAlfa = "laborb03;X";
     |FINSI;
     |SI #laborn10#0 = "E"; aAlfa = "laborn09;X"; |FINSI;
     |SI #laborn10#0 = "R"; aAlfa = "laborn0a;X"; |FINSI;

     aAlfa     = "*" + aAlfa;
     aAlfa     = aAlfa + "11";
     |SI #laborn10#0 = "D";
     |O #laborn10#0 = "F"; |O #laborn10#0 = "G"; |O #laborn10#0 = "H";
          eaID = #laborn10#17;
          |QBF eaID;
          eaID = ("0000000" + eaID) % -107;
          aAlfa = aAlfa + eaID;
          aAlfa = aAlfa + eaParam;
     |SINO;
          aAlfa = aAlfa + #laborn10#11;
          aAlfa = aAlfa + #laborn10#2;
          aAlfa = aAlfa + #laborn10#9;
          aAlfa = aAlfa + #laborn10#10;
          aAlfa = aAlfa + eaParam;
     |FINSI;

     |SUB_EJECUTA aAlfa;

     nValorLog = 13; |HAZ Log;
     |SI #laborn10#0 = "A";
          |DDEFECTO #laborn01;
          |ABRE #laborn01;
          #laborn01#0 = "A";
          #laborn01#1 = #laborn10#2;
          #laborn01#3 = #laborn10#9;
          #laborn01#4 = #laborn10#10;
          |LEE 000#laborn01.=;
          |CIERRA #laborn01;
          nValorLog = 14; |HAZ Log;

          |SI #laborn01#243 ! 0;
               |DDEFECTO #labregis;
               |ABRE #labregis;
               #labregis#0 = #laborn01#243;
               |LEE 000#labregis.=;
               |SI FSalida = 0;
                    aIdContrata = #labregis#14;
                    |QBF aIdContrata;
                    |SI aIdContrata ! "";
                         |HAZ DSArchi;
                    |SINO;
                         || de momento quito el mensaje, ya que le sale a todo
                         || el mundo, al que lo envia por ConectaSS y al que no
                         || si se queja Milenium habra que buscar una manera
                         || de saber si se ha intentado enviar y no se ha recogido
                         || el ID o si no se ha enviado simplemente y no tiene que salir

                         ||MENAV "    No se ha encontrato el ID del contrato registrado";
                    |FINSI;
               |SINO;
                    |MENAV "    No se ha encontrado el registro del contrato";
               |FINSI;
               |CIERRA #labregis;
          |SINO;
               |MENAV "    No se ha encontrado el registro del contrato";
          |FINSI;
     |FINSI;
     nValorLog = 15; |HAZ Log;

     |SI #laborn10#0 = "A";
          |HAZ ImpresionContrato;
     |FINSI;
     |SI #laborn10#0 = "V";
          |HAZ ImpresionContratoVar;
     |FINSI;
     nValorLog = 16; |HAZ Log;

     |HAZ RecargaLineal;
     nValorLog = 17; |HAZ Log;
|FPRC;

|PROCESO PintaCabecera;
     |PARA nCampo = 0; |SI nCampo [ 17; |HACIENDO nCampo = nCampo + 1;
          #laborn10#nCampo# = #labort10#nCampo#;
          |SI swImpreExt = 0;
               |C_V #laborn10#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";
                    |PINTA #laborn10#nCampo#;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO EvntGrid10;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#labort10.=;

          |ESTADO_CONTROL nBtnMod, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Baja10;
     #labort10#3  = #labort16#0;
     #labort10#5  = "01.01.0000";
     #labort10#0  = "";
     #labort10#2  = "";
     #labort10#9  = "01.01.0000";
     #labort10#10 = "";
|FPRC;

|PROCESO Alta10;
     #labort10#3  = #labort16#0;
     #labort10#5  = "31.12.9999";
     #labort10#0  = "z";
     #labort10#2  = "z" * 10;
     #labort10#9  = "31.12.9999";
     #labort10#10 = "z" * 8;
|FPRC;

|PROCESO EvntGrid16;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#labort16.=;

          |REFRESCACONTROL nGrid10;
     |FINSI;
|FPRC;

|PROCESO ImpresionExt;
     |ABRE #labempre;
     |ABRE #labtraba;

     aAlfa = eaParam % 202;
     |SI aAlfa = "11";     || alta;
          |ABRE #laborn01;
          #laborn01#0 = eaParam % 401;
          #laborn01#1 = eaParam % 510;
          #laborn01#2 = "";
          aAlfa = eaParam % 1510;
          fFecha = aAlfa;
          #laborn01#3 = fFecha;
          #laborn01#4 = eaParam % 2508;
          |LEE 000#laborn01.=;
          |SI FSalida = 0;
               |CIERRA #laborn01;
               aEstado = #laborn01#0;
               |HAZ laborn01;
               |HAZ PintaCabecera;
               |HAZ BtnImp;
          |FINSI;
     |FINSI;

     |SI aAlfa = "12";     || baja
          |ABRE #laborn02;
          #laborn02#0 = eaParam % 401;
          #laborn02#1 = eaParam % 510;
          #laborn02#2 = "";
          aAlfa = eaParam % 1510;
          fFecha = aAlfa;
          #laborn02#3 = fFecha;
          #laborn02#4 = eaParam % 2508;
          |LEE 000#laborn02.=;
          |SI FSalida = 0;
               |CIERRA #laborn02;
               aEstado = #laborn02#0;
               |HAZ laborn02;
               |HAZ PintaCabecera;
               |HAZ BtnImp;
          |FINSI;
     |FINSI;

     |SI aAlfa = "13";     || alta;
          |ABRE #laborn03;
          #laborn03#0 = eaParam % 401;
          #laborn03#1 = eaParam % 510;
          #laborn03#2 = "";
          aAlfa = eaParam % 1510;
          fFecha = aAlfa;
          #laborn03#3 = fFecha;
          #laborn03#4 = eaParam % 2508;
          |LEE 000#laborn03.=;
          |SI FSalida = 0;
               |CIERRA #laborn03;
               aEstado = #laborn03#0;
               |HAZ laborn03;
               |HAZ PintaCabecera;
               |HAZ BtnImp;
          |FINSI;
     |FINSI;

     |SI aAlfa = "14";     || prorroga
          |ABRE #laborn04;
          #laborn04#0 = eaParam % 401;
          #laborn04#1 = eaParam % 510;
          #laborn04#2 = "";
          aAlfa = eaParam % 1510;
          fFecha = aAlfa;
          #laborn04#3 = fFecha;
          #laborn04#4 = eaParam % 2508;
          |LEE 000#laborn04.=;
          |SI FSalida = 0;
               |CIERRA #laborn04;
               aEstado = #laborn04#0;
               |HAZ laborn04;
               |HAZ PintaCabecera;
               |HAZ BtnImp;
          |FINSI;
     |FINSI;

     |SI aAlfa = "15";     || prorroga
          |ABRE #laborn05;
          #laborn05#0 = eaParam % 401;
          #laborn05#1 = eaParam % 510;
          #laborn05#2 = "";
          aAlfa = eaParam % 1510;
          fFecha = aAlfa;
          #laborn05#3 = fFecha;
          #laborn05#4 = eaParam % 2508;
          |LEE 000#laborn05.=;
          |SI FSalida = 0;
               |CIERRA #laborn05;
               aEstado = #laborn05#0;
               |HAZ laborn05;
               |HAZ PintaCabecera;
               |HAZ BtnImp;
          |FINSI;
     |FINSI;

     |SI aAlfa = "18";     || correccion;
          |ABRE #laborn08;
          #laborn08#0 = eaParam % 401;
          #laborn08#1 = eaParam % 510;
          #laborn08#2 = "";
          aAlfa = eaParam % 1510;
          fFecha = aAlfa;
          #laborn08#3 = fFecha;
          #laborn08#4 = eaParam % 2508;
          |LEE 000#laborn08.=;
          |SI FSalida = 0;
               |CIERRA #laborn08;
               aEstado = #laborn08#0;
               |HAZ laborn08;
               |HAZ PintaCabecera;
               |HAZ BtnImp;
          |FINSI;
     |FINSI;

     |CIERRA #labtraba;
     |CIERRA #labempre;
|FPRC;

|PROGRAMA;
     |SI swImpreExt = 1;
          |HAZ ImpresionExt;
          |ACABA;
     |FINSI;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

     swUsuario = 0;
     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #labempre#aAlfa1#;
          swUsuario = 1;
     |FINSI;

     |ABRE #labempre;
     |ABRE #labtraba;
     |ABRE #laborn99;
     |ABRE #nomtrato;

     |HAZ RecargaLineal;

     |CONTROL_SIMPLE 0, "BOTON,&Consulta/Modificaci¢n", 3178, 3198, BtnMod;
     nBtnMod = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,&Impresi¢n", 3156, 3176, BtnImp;
     nBtnImp = FSalida;

     |SI eaParam ! "HISTO"; |Y eaParam ! "HISTOUSU";
          |CONTROL_SIMPLE 0, "BOTON,&Rechazar", 3134, 3154, BtnEli;
          nBtnEli = FSalida;
     |SINO;
          |SI eaParam = "HISTOUSU";
              |CONTROL_SIMPLE 0, "BOTON,&Correcci¢n Errores", 3134, 3154, BtnCor;
              nBtnCor = FSalida;
          |FINSI;
     |FINSI;

     |SI eaParam = "ADMIN";
         |CONTROL_SIMPLE 0, "BOTON,&Actualizaci¢n", 3112, 3132, BtnAct;
         nBtnAct = FSalida;
     |FINSI;

     |PINPA #0#laborn10;
     |LEE 000#labort10.p;

     |SI swHayAlgo ! 0;
          nModo = 2 + 4 + 8 + 16 + 32 + 128;
          |LINEAL_SIMPLE #1#labort16, nModo, 0502, 1298, NULL, NULL, EvntGrid16;
          nGrid16 = FSalida;

          |LINEAL_SIMPLE #2#labort10, nModo, 1402, 3398, Baja10, Alta10, EvntGrid10;
          nGrid10 = FSalida;

          aEsc1  = &255 + "806";
          aEsc2  = &255 + "807";
          aRetu  = &255 + "802";
          |PARA; |SI;  |HACIENDO;
              FSalida = "::{{001}}Salir," + nGrid16;

              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL;  |FINSI;
              |SI aTecla = aEsc2; |SAL;  |FINSI;
              |SI aTecla = aRetu; |SAL;  |FINSI;
          |SIGUE;
     |SINO;
          |MENAV "    No se han encontrado solicitudes pendientes.";
     |FINSI;

     |FIN_CONTROL_WINDOWS nBtnMod;
     |FIN_CONTROL_WINDOWS nBtnImp;

     |SI nBtnEli ! -1; |FIN_CONTROL_WINDOWS nBtnEli;  |FINSI;
     |SI nBtnCor ! -1; |FIN_CONTROL_WINDOWS nBtnCor;  |FINSI;
     |SI nBtnAct ! -1; |FIN_CONTROL_WINDOWS nBtnAct;  |FINSI;

     |CIERRA #nomtrato;
     |CIERRA #laborn99;
     |CIERRA #labtraba;
     |CIERRA #labempre;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #labempre#aAlfa2#;
     |FINSI;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     fFechaHoy = ~;
     eaParam   = PARAMETRO;  |QBF eaParam;
     nAvisos   = 0;

     |ABRE #laboru01;
     #laboru01#0 = Usuario % 810;
     |LEE 000#laboru01.=;
     |SI FSalida = 0;
         nAvisos = 1;

         |SI #laboru01#3 = "1";  |O #laboru01#3 = "3";
             aAviso1 = "1";
             aAviso2 = "1";
             aAviso3 = "Avisos LABORNET ";
             aAviso4 = "Revisando pendientes";
             |ESPECIFICA "MENSAJETRAY", aAviso;
         |FINSI;
     |FINSI;
     |CIERRA #laboru01;

     aAlfa = eaParam % -105;
     |SI aAlfa = "IMPRE";
          swImpreExt = 1;
          |ACABA;
     |FINSI;

     aFicTmp = "labort09" + Usuario;
     |NOME_DAT #labort09#aFicTmp#;
     |ABRE #labort09;  |CIERRA #labort09;  |DELINDEX #labort09;

     aFicTmp = "labort10" + Usuario;
     |NOME_DAT #labort10#aFicTmp#;
     |ABRE #labort10;  |CIERRA #labort10;  |DELINDEX #labort10;

     aFicTmp = "labort16" + Usuario;
     |NOME_DAT #labort16#aFicTmp#;
     |ABRE #labort16;  |CIERRA #labort16;  |DELINDEX #labort16;

     |ABRE #labort09;
     |ABRE #labort10;
     |ABRE #labort16;
     |ABRE #labor008;

     aAlfa = "Gesti¢n de solicitudes";
     |SI eaParam = "HISTO"; |O eaParam = "HISTOUSU";
         aAlfa =  "Hist¢rico de solicitudes";
     |FINSI;

     |VENTANA 0501, 3399, -1, 16, aAlfa;
     n0Vent = FSalida;

     FSalida = 3399;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |SI swImpreExt = 1;
          |ACABA;
     |FINSI;

     |CIERRA #labor008;
     |CIERRA #labort09;  |DELINDEX #labort09;
     |CIERRA #labort10;  |DELINDEX #labort10;
     |CIERRA #labort16;  |DELINDEX #labort16;

     |FINVENTANA n0Vent;
|FPRC;
