|FICHEROS;
     nogue003 #00;
     nogue001;
     nogue002;
     labclean;
     nomparca;
     nomparli;
|FIN;

|VARIABLES;
     aAlfa = "";
     alfa1         = "";
     alfa2         = "";
     alfa3         = "";
     p_mes         = "";
     mensaje1      = "    ATENCION !!! Error de Entrada ...";

     anyo          = 0;
     nume1         = 0;
     bisiesto      = 0;
     topemes       = 0;

     fecsys        = @;
     nCampo = 0;
     nMes = 0;
|FIN;

|PROCESO Descripcion;
     |ABRE #nogue001;
     #nogue001#0 = #0#7;
     |LEE 000#nogue001.=;
     |SI FSalida = 0;
          #0#63 = #nogue001#1;
     |SINO;
          #0#63 = "";
     |FINSI;
     |PINTA #0#63;
     |CIERRA #nogue001;
|FPRC;

|PROCESO defectos; |TIPO 7;
     |HAZ PintaMes;
|FPRC;

|PROCESO mesletra;
     |SI #0#13 = "M"; |Y Campo = 6;
          |ACABA;
     |FINSI;

     |SI Campo = 5; |O Campo = 5;
          nMes = #0Campo;
     |FINSI;

     |SI #0#4 < 80;
         anyo = #0#4 + 2000;
     |SINO;
         anyo = #0#4 + 1900;
     |FINSI;

     bisiesto = 0;
     nume1    = anyo $ 4;
     |SI nume1 = 0;
         bisiesto = 1;
     |FINSI;

     |SI nMes = 1;  p_mes = "ENERO     ";  topemes = 31;  |FINSI;
     |SI nMes = 2;  p_mes = "FEBRERO   ";  topemes = 28 + bisiesto;  |FINSI;
     |SI nMes = 3;  p_mes = "MARZO     ";  topemes = 31;  |FINSI;
     |SI nMes = 4;  p_mes = "ABRIL     ";  topemes = 30;  |FINSI;
     |SI nMes = 5;  p_mes = "MAYO      ";  topemes = 31;  |FINSI;
     |SI nMes = 6;  p_mes = "JUNIO     ";  topemes = 30;  |FINSI;
     |SI nMes = 7;  p_mes = "JULIO     ";  topemes = 31;  |FINSI;
     |SI nMes = 8;  p_mes = "AGOSTO    ";  topemes = 31;  |FINSI;
     |SI nMes = 9;  p_mes = "SEPTIEMBRE";  topemes = 30;  |FINSI;
     |SI nMes = 10;  p_mes = "OCTUBRE   ";  topemes = 31;  |FINSI;
     |SI nMes = 11;  p_mes = "NOVIEMBRE ";  topemes = 30;  |FINSI;
     |SI nMes = 12;  p_mes = "DICIEMBRE ";  topemes = 31;  |FINSI;
|FPRC;

|PROCESO PintaMes;
     |SI #0#13 = "M";
          #0#6 = #0#5;
          |CAMPO_MODIFICA #0#6, 1, "N";
          |CAMPO_VISUAL #0#6, 1, "N";
          |PINTA 1851, "       ³";
          nMes = #0#5;
          |HAZ mesletra;
          aAlfa = p_mes % 103;
          |PINTA 1847, aAlfa;
     |SINO;
          |CAMPO_MODIFICA #0#6, 1, "S";
          |CAMPO_VISUAL #0#6, 1, "S";
          |PINTA 1851, "       ³";
          |PINTA #0#6;

          nMes = #0#5;
          |HAZ mesletra;
          aAlfa = p_mes % 103;
          |PINTA 1847, aAlfa;

          nMes = #0#6;
          |HAZ mesletra;
          aAlfa = p_mes % 103;
          |PINTA 1855, aAlfa;
     |FINSI;
|FPRC;

|PROCESO finalmes; |TIPO 7;
     alfa1 = anyo;                                               || anyo
     alfa3 = #0#7;                                               || mes
     Campo = 7;
     alfa2 = topemes;                                            || dia
     Campo = 6;
     alfa3 = "0" + alfa3; alfa3 = alfa3 % -102;
     alfa1 = alfa2 + "." + alfa3 + "." + alfa1;             || fecha entera
     #0Campo = alfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO desmenor; |TIPO 0; || chequea que el hasta sea mayor que el desde
     |SI #0Campo < #0#5;
         |MENAV mensaje1;
         |ERROR;
     |FINSI;
|FPRC

|PROCESO Tipo12;
     |SI #nogue003#13 = "H"; |HAZ DesdeHistorico;  |FINSI;
     |SI #nogue003#13 = "M"; |HAZ DesdeMensual;    |FINSI;
|FPRC;

/****************************************************************************/

|PROCESO PaseNomparli;
     |PARA nCampo = 0; |SI nCampo [ 26; |HACIENDO nCampo = nCampo + 1;
          #nogue002#nCampo# = #nomparli#nCampo#;
     |SIGUE;
     |GRABA 020#nogue002.n;
|FPRC;

|DEFBUCLE PaseNomparli;
     #nomparli#1;
     ;
     01, 01;
     99, 99;
     ;
     NULL, PaseNomparli;
|FIN;

|PROCESO PaseNomparca;
     |PARA nCampo = 0; |SI nCampo [ 5; |HACIENDO nCampo = nCampo + 1;
          #nogue001#nCampo# = #nomparca#nCampo#;
     |SIGUE;
     |GRABA 020#nogue001.n;
|FPRC;

|DEFBUCLE PaseNomparca;
     #nomparca#1;
     ;
     01;
     99;
     ;
     NULL, PaseNomparca;
|FIN;

|PROCESO BorraNogue002;
     |BORRA 020#nogue002.a;
     |LIBERA #nogue002;
|FPRC;

|DEFBUCLE BorraNogue002;
     #nogue002#1;
     ;
     01, 01;
     99, 99;
     be;
     NULL, BorraNogue002;
|FIN;

|PROCESO PaseNogue002;
     #nogue002#0 = #nogue002#0 + 100;
     |GRABA 020#nogue002.n;
     |LIBERA #nogue002;
|FPRC;

|DEFBUCLE PaseNogue002;
     #nogue002#1;
     ;
     01, 01;
     99, 99;
     be;
     NULL, PaseNogue002;
|FIN;

|PROCESO BorraNogue001;
     |BORRA 020#nogue001.a;
     |LIBERA #nogue001;
|FPRC;

|DEFBUCLE BorraNogue001;
     #nogue001#1;
     ;
     01;
     99;
     be;
     NULL, BorraNogue001;
|FIN;

|PROCESO PaseNogue001;
     #nogue001#0 = #nogue001#0 + 100;
     |GRABA 020#nogue001.n;
     |LIBERA #nogue001;
|FPRC;

|DEFBUCLE PaseNogue001;
     #nogue001#1;
     ;
     01;
     99;
     be;
     NULL, PaseNogue001;
|FIN;

|PROCESO Pase;
     |ABRE #labclean;

     #labclean#0 = "nomparca";
     #labclean#1 = 0;
     |LEE 101#labclean.=;
     |SI FSalida ! 0;
          |BUCLE PaseNogue001;
          |BUCLE PaseNogue002;
          |BUCLE BorraNogue001;
          |BUCLE BorraNogue002;

          |ABRE #nogue001;
          |ABRE #nogue002;
          |BUCLE PaseNomparca;
          |BUCLE PaseNomparli;
          |CIERRA #nogue002;
          |CIERRA #nogue001;

          #labclean#0 = "nomparca";
          #labclean#1 = 0;
          #labclean#2 = "S";
          |GRABA 020#labclean.n;
          |LIBERA #labclean;
     |FINSI;

     |CIERRA #labclean;
|FPRC;

/****************************************************************************/

|PROGRAMA;
     |HAZ Pase;

     |CLS;
     |PINPA #0#0;
     |CABEZA "Informes Parametrizados";
     |ABRE #0;
     |DDEFECTO #0;

     |LEE 101#0p;
     |SI FSalida ! 0;
         |GRABA 020#0b;
     |FINSI;

     |SI #nogue003#13 ! "H";  |Y #nogue003#13 ! "M";
         #nogue003#13 = "H";
     |FINSI;

     |PINDA #0#0;
     |ENDATOS #1#0;

    ||  #0#9 = 1; || Excel
    || #0#8 = 2; || Una linea por trabajador
    || #0#11 = "D"; || detallado

     |SI FSalida = 0;
         |HAZ Tipo12;
     |FINSI;
     |GRABA 020#0a;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;

|PROCESO Tipo88_nomwpara; |TIPO 88;
     |HAZ LeeEURODB;
|FPRC;
