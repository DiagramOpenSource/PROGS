|FICHEROS;
     nomcal06 #0;
     nomcalca #1;
     nomhicca;
     labtraba #2;
     labempre #3;
     labcentr #4;
|FIN;

|VARIABLES;
     fFecha = @;
     aFecha = "";
     nMes = 0;
     aMes = "";
     nAny = 0;
     aAny = "";
     fFechaRef = @;
     &aMesLetra = "";

     topemes = 0;
     fFechaAlta = @;
     fFechaBaja = @;
     aAlfa = "";
     fIniMes = @;
     fFinMes = @;
     fFechaIniMes = @;
     fFechaFinMes = @;
     &aFechaIniMes = "";
     &aFechaFinMes = "";
     nNume1 = 0;
     nNume2 = 0;
     &nDias = 0;
     swSigue = 0;
|FIN;

|PROCESO nom_mes;
|SI nMes = 1;  aMesLetra = "ENERO"; |FINSI;
|SI nMes = 2;  aMesLetra = "FEBRERO"; |FINSI;
|SI nMes = 3;  aMesLetra = "MARZO"; |FINSI;
|SI nMes = 4;  aMesLetra = "ABRIL"; |FINSI;
|SI nMes = 5;  aMesLetra = "MAYO"; |FINSI;
|SI nMes = 6;  aMesLetra = "JUNIO"; |FINSI;
|SI nMes = 7;  aMesLetra = "JULIO"; |FINSI;
|SI nMes = 8;  aMesLetra = "AGOSTO"; |FINSI;
|SI nMes = 9;  aMesLetra = "SEPTIEMBRE"; |FINSI;
|SI nMes = 10; aMesLetra = "OCTUBRE"; |FINSI;
|SI nMes = 11; aMesLetra = "NOVIEMBRE "; |FINSI;
|SI nMes = 12; aMesLetra = "DICIEMBRE "; |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;
     fFecha = ~;
     aFecha = fFecha;
     aMes = aFecha % 402;
     aAny = aFecha % -104;
     nAny = aAny;
     nMes = aMes;
     |HAZ nom_mes;
     #0#2 = nMes;
     #0#3 = nAny;
     |PINTA #0#2;
     |PINTA #0#3;
|FPRC;

|PROCESO MesLetra;
     nMes = #0#2;
     |HAZ nom_mes;
|FPRC;

|PROCESO ultidia;
     topemes = 31;
     |SI nMes = 4; |O  nMes = 6; |O  nMes = 9; |O  nMes = 11;
          topemes = 30;
     |FINSI;
     |SI nMes = 2;
          topemes = 28;
     |FINSI;
|FPRC;

|PROCESO Datos;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
|FPRC;

|PROCESO labtraba;
     swSigue = 0;

     nMes = #0#2;
     aMes = nMes;
     aMes = ("00" + aMes) % -102;
     aAny = #0#3;

     aFecha = "01" + "." + aMes + "." + aAny;
     fIniMes = aFecha;

     |HAZ ultidia;
     aFecha = topemes;
     aFecha = ("00" + aFecha) % -102;
     aFecha = aFecha + "." + aMes + "." + aAny;
     fFinMes = aFecha;

     aAlfa = #labtraba#36;
     fFechaAlta = aAlfa;
     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa = ""; |O aAlfa = "..........";
          aAlfa = "31.12.2999";
     |FINSI;
     fFechaBaja = aAlfa;

     |SI fFechaAlta [ fFinMes; |Y fFechaBaja ] fIniMes;
          swSigue = 1;
          |SI fIniMes > fFechaAlta;
               fFechaIniMes = fIniMes;
          |SINO;
               fFechaIniMes = fFechaAlta;
          |FINSI;
          |SI fFinMes < fFechaBaja;
               fFechaFinMes = fFinMes;
          |SINO;
               fFechaFinMes = fFechaBaja;
          |FINSI;

          nNume1 = fFechaIniMes;
          nNume2 = fFechaFinMes;

          aFechaIniMes = fFechaIniMes;
          aFechaFinMes = fFechaFinMes;
          nDias = nNume2 - nNume1 + 1;
     |FINSI;

     |SI swSigue = 1;
          |HAZ Datos;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba4;
     #labtraba#1;
     42;
     #0#0, 00001, "I";
     #0#1, 99999, "I";
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba3;
     #labtraba#1;
     42;
     #0#0, 00001, "P";
     #0#1, 99999, "P";
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba2;
     #labtraba#1;
     42;
     #0#0, 00001, "X";
     #0#1, 99999, "X";
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba1;
     #labtraba#1;
     42;
     #0#0, 00001, "T";
     #0#1, 99999, "T";
     ;
     NULL, labtraba;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          Impresora = "CrystalReport";
          |IMPRE -1;
          |INFOR "nomcal06";

          nMes = #0#2;
          nAny = #0#3 - 2000;

          |ABRE #nomcalca;
          |ABRE #nomhicca;
          |ABRE #labempre;
          |ABRE #labcentr;
          |BUCLE labtraba1;
          |BUCLE labtraba2;
          |BUCLE labtraba3;
          ||BUCLE labtraba4;  || irregulares por dias no son a TP ¨no?
          |CIERRA #labcentr;
          |CIERRA #labempre;
          |CIERRA #nomhicca;
          |CIERRA #nomcalca;
          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
|FPRO;
