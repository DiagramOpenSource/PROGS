|FICHEROS;
     nomirenm #0;
     labempre;
     nomauxtp #200;
|FIN;

|VARIABLES;
     nLinea = 0;
     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;
     aRaizMacro = "";
     nMes = 0;
     aMes = "";
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";
     aValor = "";
     aMeses = "";
     fFecha = @;
     aFecha = "";
     aHora = "";
     aAlfa = "";
     {1}aVersion = "";
     aPath = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     aCaracter = "";
     nCaracter = 0;

     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
     nTotTotC15 = 0;
     nTotTotC16 = 0;
     nTotTotC17 = 0;

     nTotEmpC4 = 0;
     nTotEmpC5 = 0;
     nTotEmpC6 = 0;
     nTotEmpC7 = 0;
     nTotEmpC9 = 0;
     nTotEmpC10 = 0;
     nTotEmpC11 = 0;
     nTotEmpC12 = 0;
     nTotEmpC13 = 0;
     nTotEmpC14 = 0;
     nTotEmpC15 = 0;
     nTotEmpC16 = 0;
     nTotEmpC17 = 0;

     nAntEmp = 0;
     nAntCen = 0;
     aAntArea = "";
     aAntDesArea = "";
     aAntSecc = "";
     aAntDesSecc = "";
     nNume = 0;
     aHoja = "";
     nHoja = 0;
     aHojaExcel = "";
     &month = 0;
     aNombreMacro = "";
     swHaEntrado = 0;
     aDesdeTra = "                                        ";
     aHastaTra = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";

     &enTipoInf = 0;
     &eaFuente = "";
     &enDesdeMes = 0;
     &enHastaMes = 0;
     &enAny = 0;
     &nOrdenEmp = 0;
     &enOrdenTra = 0;
     &informe = "";
     &enCuadre = 0;
     &nPara = 0;
     &nTipoD = 0;
     &nTipoH = 0;
     swHayAlgo = 0;
     &aNomPag = "";
     swPorAqui = 0;
     nTotInf = 0;
     nTipo = 0;
     swExcelSep = 0;
     &nUnoTipo2 = 0;
     &enTipo = 0;
     &cabeza = "";
     &cabeza_tit = "";
     aResultado = "";
|FIN;

|| ORDEN POR NOMBRE DE TRABAJADOR

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO GeneraHoja;
     swHaEntrado = 1;

     |SI aAntSecc ! "ZZZZ";
          |SI aAntSecc ! #200#3;
               |HAZ TotalesSecc;
          |SINO;
               |SI aAntArea ! #200#2;   || mismo codigo de SECCION pero
                    |HAZ TotalesSecc;   || distinta AREA, tengo que poner el
               |FINSI;                  || total, claro
          |FINSI;
     |FINSI;

     |SI aAntArea ! "ZZZZ"; |Y aAntArea ! #200#2;
          |HAZ TotalesArea;
     |FINSI;

     nLinea = nLinea + 1;
     aValor = #200#1; aValor = ("00000" + aValor) % -105;
     aAlfa = "A" + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "B" + nLinea + "," + #200#21; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + #200#24; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + #200#5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + #200#6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "F" + nLinea + "," + #200#7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nNume = #200#17 + #200#18 + #200#19;
     aAlfa = "G" + nLinea + "," + nNume; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "H" + nLinea + "," + #200#9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + #200#10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + #200#14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + #200#11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + #200#12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + #200#13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + #200#16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + #200#8; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     /*
     |SI enCuadre = 04;
           aAlfa = "P" + nLinea + "," + #200#34; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
           aAlfa = "Q" + nLinea + "," + #200#35; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
     */

     nTotC4 = nTotC4 + #200#5;          || totales AREA
     nTotC5 = nTotC5 + #200#6;
     nTotC6 = nTotC6 + #200#7;
     nTotC7 = nTotC7 + #200#17 + #200#18 + #200#19;
     nTotC9 = nTotC9 + #200#10;
     nTotC10 = nTotC10 + #200#14;
     nTotC11 = nTotC11 + #200#11;
     nTotC12 = nTotC12 + #200#12;
     nTotC13 = nTotC13 + #200#13;
     nTotC14 = nTotC14 + #200#16;
     nTotC15 = nTotC15 + #200#8;
     || nTotC15 = nTotC15 + #200#32;
     || nTotC16 = nTotC16 + #200#34;
     || nTotC17 = nTotC17 + #200#35;

     nTotTotC4 = nTotTotC4 + #200#5;         || totales SECCION
     nTotTotC5 = nTotTotC5 + #200#6;
     nTotTotC6 = nTotTotC6 + #200#7;
     nTotTotC7 = nTotTotC7 + #200#17 + #200#18 + #200#19;
     nTotTotC9 = nTotTotC9 + #200#10;
     nTotTotC10 = nTotTotC10 + #200#14;
     nTotTotC11 = nTotTotC11 + #200#11;
     nTotTotC12 = nTotTotC12 + #200#12;
     nTotTotC13 = nTotTotC13 + #200#13;
     nTotTotC14 = nTotTotC14 + #200#16;
     nTotTotC15 = nTotTotC15 + #200#8;
     || nTotTotC15 = nTotTotC15 + #200#32;
     || nTotTotC16 = nTotTotC16 + #200#34;
     || nTotTotC17 = nTotTotC17 + #200#35;

     nTotEmpC4 = nTotEmpC4 + #200#5;         || totales EMPRESA
     nTotEmpC5 = nTotEmpC5 + #200#6;
     nTotEmpC6 = nTotEmpC6 + #200#7;
     nTotEmpC7 = nTotEmpC7 + #200#17 + #200#18 + #200#19;
     nTotEmpC9 = nTotEmpC9 + #200#10;
     nTotEmpC10 = nTotEmpC10 + #200#14;
     nTotEmpC11 = nTotEmpC11 + #200#11;
     nTotEmpC12 = nTotEmpC12 + #200#12;
     nTotEmpC13 = nTotEmpC13 + #200#13;
     nTotEmpC14 = nTotEmpC14 + #200#16;
     nTotEmpC15 = nTotEmpC15 + #200#8;
     || nTotEmpC15 = nTotEmpC15 + #200#32;
     || nTotEmpC16 = nTotEmpC16 + #200#34;
     || nTotEmpC17 = nTotEmpC17 + #200#35;

     aAntArea = #200#2;
     aAntDesArea = #200#22;
     aAntSecc = #200#3;
     aAntDesSecc = #200#23;
|FPRC;

|| ORDEN POR CODIGO DE TRABAJADOR

|DEFBUCLE GeneraHoja_1;
     #200#1;
     ;
     00001, "    ", "    ", 00001, 1999, month, nTipo;
     99999, "zzzz", "zzzz", 99999, 2999, month, nTipo;
     ;
     NULL, GeneraHoja;
|FIN;

|DEFBUCLE GeneraHoja_meses_1;
     #200#1;
     ;
     00001, "    ", "    ", 00001, 1999, month, nPara;
     99999, "zzzz", "zzzz", 99999, 2999, month, nPara;
     ;
     NULL, GeneraHoja;
|FIN;

|PROCESO TotalesNEG;
     aRaizMacro = "Módulo1.";
     aNombreMacro = "Gris_Negrita";

     aAlfa = "B" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "C" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "D" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "E" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "F" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "G" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "H" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "I" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "J" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "K" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "L" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "M" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "N" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "O" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
/*
     |SI enCuadre = 04;
          aAlfa = "P" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          aAlfa = "Q" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;
*/
|FPRC;

|PROCESO Totales3;
     |SI aNomPag = "P";
          |ACABA;
     |FINSI;

     |ABRE #200;
     #200#0 = nAntEmp;
     #200#2 = "    ";
     #200#3 = "    ";
     #200#1 = 1;
     |SI #0#17 = 2; |Y #0#14 = "A";     || atrasos por meses
          #200#25 = 1;         || atrasos refundidos
     |SINO;
          #200#25 = month;
     |FINSI;
     #200#15 = nTipo;
     |SI #200#15 = 2;
          #200#1 = nUnoTipo2;
     |FINSI;
     |LEE 101#200];
     |CIERRA #200;

     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA

     aRaizMacro = "Módulo1.";
     aNombreMacro = "Gris_Negrita";

     aAlfa = "B" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "B" + nLinea + ", Total TC1:"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "C" + nLinea + "," + #200#26; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nLinea = nLinea + 1;

     aAlfa = "B" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "B" + nLinea + ", Total informe:"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "C" + nLinea + "," + nTotInf; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nLinea = nLinea + 1;

     nTotInf = 0;
|FPRC;

|PROCESO TotalesEmp;
     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA
/*
     nHoja = month;
     aHoja = nHoja;
     |QBF aHoja;
     aRaizMacro = "Módulo" + aHoja + ".";
     || aRaizMacro = "informe_costes_atrasos_pormeses.xls!Módulo1.";

     |SI nHoja = 1;
          aNombreMacro = "Gris_Negrita";
     |SINO;
          aHoja = ("00" + aHoja) % -102;
          aNombreMacro = "Gris_Negrita_" + aHoja;
     |FINSI;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;
*/

     |HAZ TotalesNEG;

     aAlfa = "B" + nLinea + ", Total EMPRESA:";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + nTotEmpC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + nTotEmpC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "F" + nLinea + "," + nTotEmpC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + nTotEmpC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + nTotEmpC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + nTotEmpC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + nTotEmpC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + nTotEmpC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + nTotEmpC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + nTotEmpC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + nTotEmpC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
/*
     |SI enCuadre = 04;
          aAlfa = "P" + nLinea + "," + nTotEmpC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aAlfa = "Q" + nLinea + "," + nTotEmpC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
*/
     nTotInf = nTotEmpC13 +  nTotEmpC11 - nTotEmpC4;

     nTotEmpC4 = 0;
     nTotEmpC5 = 0;
     nTotEmpC6 = 0;
     nTotEmpC7 = 0;
     nTotEmpC9 = 0;
     nTotEmpC10 = 0;
     nTotEmpC11 = 0;
     nTotEmpC12 = 0;
     nTotEmpC13 = 0;
     nTotEmpC14 = 0;
     nTotEmpC15 = 0;
     nTotEmpC16 = 0;
     nTotEmpC17 = 0;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO TotalesSecc;
     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA
/*
     nHoja = month;
     aHoja = nHoja;
     |QBF aHoja;
     aRaizMacro = "Módulo" + aHoja + ".";
     || aRaizMacro = "informe_costes_atrasos_pormeses.xls!Módulo1.";

     |SI nHoja = 1;
          aNombreMacro = "Gris_Negrita";
     |SINO;
          aHoja = ("00" + aHoja) % -102;
          aNombreMacro = "Gris_Negrita_" + aHoja;
     |FINSI;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;
*/

     |HAZ TotalesNEG;

     aAlfa = #200#23; |QBF aAlfa;
     aAlfa = "B" + nLinea + ", Total SECCION: " + aAntSecc + " - " + aAntDesSecc;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + nTotTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + nTotTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "F" + nLinea + "," + nTotTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + nTotTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + nTotTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + nTotTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + nTotTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + nTotTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + nTotTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + nTotTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + nTotTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
/*
     |SI enCuadre = 04;
          aAlfa = "P" + nLinea + "," + nTotTotC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aAlfa = "Q" + nLinea + "," + nTotTotC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
*/
     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
     nTotTotC15 = 0;
     nTotTotC16 = 0;
     nTotTotC17 = 0;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO TotalesArea;
     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA
/*
     nHoja = month;
     aHoja = nHoja;
     |QBF aHoja;
     aRaizMacro = "Módulo" + aHoja + ".";

     |SI nHoja = 1;
          aNombreMacro = "Gris_Negrita";
     |SINO;
          aHoja = ("00" + aHoja) % -102;
          aNombreMacro = "Gris_Negrita_" + aHoja;
     |FINSI;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;
*/

     |HAZ TotalesNEG;

     aAlfa = #200#22; |QBF aAlfa;
     aAlfa = "B" + nLinea + ", Total AREA: " + aAntArea + " - " + aAntDesArea + ":";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + nTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + nTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "F" + nLinea + "," + nTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + nTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + nTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + nTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + nTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + nTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + nTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + nTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + nTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
/*
     |SI enCuadre = 04;
          aAlfa = "P" + nLinea + "," + nTotC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aAlfa = "Q" + nLinea + "," + nTotC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
*/
     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO MesLetra;
     |SI nMes = 1;  aMes = "ENERO";          |FINSI;
     |SI nMes = 2;  aMes = "FEBRERO";        |FINSI;
     |SI nMes = 3;  aMes = "MARZO";          |FINSI;
     |SI nMes = 4;  aMes = "ABRIL";          |FINSI;
     |SI nMes = 5;  aMes = "MAYO";           |FINSI;
     |SI nMes = 6;  aMes = "JUNIO";          |FINSI;
     |SI nMes = 7;  aMes = "JULIO";          |FINSI;
     |SI nMes = 8;  aMes = "AGOSTO";         |FINSI;
     |SI nMes = 9;  aMes = "SEPTIEMBRE";     |FINSI;
     |SI nMes = 10; aMes = "OCTUBRE";        |FINSI;
     |SI nMes = 11; aMes = "NOVIEMBRE";      |FINSI;
     |SI nMes = 12; aMes = "DICIEMBRE";      |FINSI;
|FPRC;

|PROCESO Cabecera;
     nHoja = month;
     aHoja = nHoja;
     aHoja = ("00" + aHoja) % -102;
     aHoja = "Mes " + aHoja;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aHoja;

     aValor = "INFORME DE COSTES";
     aAlfa = "B1, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI eaFuente = "M";
          nMes = #0#15;
          |HAZ MesLetra;
          aMeses = aMes;
     |SINO;
          |SI enDesdeMes = enHastaMes;
               nMes = enDesdeMes;
               |HAZ MesLetra;
               aMeses = aMes;
          |SINO;
               nMes = enDesdeMes;
               |HAZ MesLetra;
               aMeses = aMes;
               nMes = enHastaMes;
               |HAZ MesLetra;
               aMeses = aMeses + " - " + aMes;
          |FINSI;
     |FINSI;

     fFecha = ~;
     aFecha = fFecha;
     |HORA aHora;

     nNume = enAny + 2000;
     aValor = nNume;

     || aValor = aMeses + " " + aValor + "      " + aFecha + " " + aHora;
     aValor = cabeza - cabeza_tit;
     aAlfa = "E1, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aValor = #labempre#0; aValor = ("00000" + aValor) % -105;
     aValor = aValor + " - "  + #labempre#2;

     || aValor = #labempre#10; |QBF aValor;
     aAlfa = "B3, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nLinea = 6;
|FPRC;

|PROCESO Excel;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;

     ||SI eaFuente = "A"
     ||     aHojaExcel = "informe_costes_atrasos.xls"
     ||SINO;
          aHojaExcel = "informe_costes.xls"
     ||FINSI;

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "documentos/" + aHojaExcel;
     aDestinoTrab = "C:\DOCUMENTOS";         |RMKDIR aDestinoTrab;
     aDestino = aDestinoTrab + "\trabajo.xls";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDestino;

     |SI eaFuente = "A"
          ||PARA month = 1; |SI month [ 12; |HACIENDO month = month + 1;
               swHaEntrado = 0;
               nLinea = 0;
               |HAZ Cabecera;

               aAntArea = "ZZZZ";
               aAntSecc = "ZZZZ";

               nTipo = 0;
               month = 1;
               |BUCLE GeneraHoja_1;
/*
               |SI enOrdenTra = 1;
                    |BUCLE GeneraHoja_meses_1;
               |FINSI;
               |SI enOrdenTra = 2;
                    |BUCLE GeneraHoja_meses_2;
               |FINSI;
               |SI enOrdenTra = 3;
                    |BUCLE GeneraHoja_meses_3;
               |FINSI;
*/

               || TOTALES

               |SI swHaEntrado = 1;
                    |HAZ TotalesSecc;  || el del ultimo centro siempre
                    |HAZ TotalesArea;
                    |HAZ TotalesEmp;
                    |HAZ Totales3;
               |FINSI;
          ||SIGUE;
     |SINO;
          swHaEntrado = 0;
          nLinea = 0;
          |HAZ Cabecera;

          aAntArea = "ZZZZ";
          aAntSecc = "ZZZZ";

          |SI enOrdenTra = 1
               |BUCLE GeneraHoja_1;
          |FINSI;
/*
          |SI enOrdenTra = 2;
               |BUCLE GeneraHoja_2;
          |FINSI;
          |SI enOrdenTra = 3;
               |BUCLE GeneraHoja_3;
          |FINSI;
*/

          || TOTALES

          |SI swHaEntrado = 1;
               |HAZ TotalesSecc;  || el de la ultima area, secc y empresa
               |HAZ TotalesArea;
               |HAZ TotalesEmp;
               |HAZ Totales3;
          |FINSI;
     |FINSI;

     aAlfa   = aDestinoTrab + "\" + aHojaExcel;
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;
     aResultado = aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
     |DESCARGADLL "agixl97.dll";

     aDestino   = aDestinoTrab + "\trabajo.xls";
     |RFBORRA aDestino;
         aVersion1 = "Excel.Sheet";
         |ESPECIFICA "VERSION_PROGRAMA", aVersion;
         |HAZ ExtraePath;
         |SI aPath = "NO LOCALIZADO";
             |MENAV "0000 No puedo encontrar automaticamente la Excel";
             |ACABA;
         |FINSI;

         |QBF aPath;

     || aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
     aAlfa = "cmd " + &34 + "/c START /WAIT " + aResultado + &34;
     |RSYSTEM aAlfa;

     |CIERRA #200;
|FPRC;

|PROCESO EnExcel;
     || en principio solo los resumenes por areas y secciones que vayan en
     || excel iran por aqui

     |SI nTipoD = 0; |Y nTipoH = 2;
          swExcelSep = 1;
          nTipo = enTipo;
          ||PARA nTipo = 0; |SI nTipo [ 2; |HACIENDO nTipo = nTipo + 2;
               |HAZ Excel;
          ||SIGUE;

     |SINO;
     /*
          |SI aNomPag = "P";
               month = 1;
               nPara = 0;
          |FINSI;
     */
          |SI nPara ] 5;
               |SI #0#7 = 1;
                    nTipo = nPara;
               |SINO;
                    nTipo = nTipoD;
               |FINSI;
          |FINSI;
          |HAZ Excel;
     |FINSI;
|FPRC;
