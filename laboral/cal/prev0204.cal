|FICHEROS;
     prev0204 #0;

     prev0299 #100;

     prev0002;      || materiales/documentacion entregada
     prev0101;      || maestro de materiales/documentos
     labempre;
     labtraba;
     labcentr;
|FIN;

|VARIABLES;
     aAlfa = "";
     fFechaDesde = @;
     fFechaHasta = @;
     fFechaRec = @;
     fFechaVto = @;
     swReco = 0;
     aNif = "";
     aTrab = "";
|FIN;

|PROCESO impresion;
     |PRINT;
|FPRC;

|DEFBUCLE impresion;
     #100#0;
     ;
     INICIO;
     FINAL;
     ;
     NULL, impresion;
|FIN;

|PROCESO informe;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |INFOR "prev0204";

     |BUCLE impresion;

     |PIEINF;
     |FININF;
|FPRC;

|PROCESO grabatmp;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;

     #prev0101#0 = #prev0002#2;
     |LEE 000#prev0101.=;

     #100#0 = #labtraba#0;
     #100#1 = #labtraba#1;
     #100#2 = #labtraba#77;

     #100#3 = #labempre#2;
     aAlfa = #labtraba#2;
     |QBF aAlfa;
     |SI aTrab ! "";
           aAlfa = aAlfa + " (" + aTrab + ")";
     |FINSI;
     #100#4 = aAlfa;
     #100#5 = #labcentr#2;

     #100#6 = #prev0002#3;    || fecha de entrega material
     #100#8 = #prev0002#2;    || codigo del material entregado
     #100#9 = #prev0101#2;    || Es Documentacion o Material
     #100#10 = #prev0101#1;   || Descripcion

     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;


|PROCESO labtraba;
     |SI #labtraba#44 = "A";
          |HAZ grabatmp;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#2;
     ;
     aNif;
     aNif;
     ;
     NULL, labtraba;
|FIN;

|PROCESO prev0002;
     aTrab = "";
     #labtraba#0 = #prev0002#0;
     #labtraba#1 = #prev0002#1;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          |SI #labtraba#44 = "A";
               |HAZ grabatmp;
          |SINO;
               aTrab = #labtraba#1;
               |QBF aTrab;
               aTrab = ("00000" + aTrab) % -105;
               aNif = #labtraba#7
               |BUCLE labtraba;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE prev0002;
     #prev0002#1;
     ;
     #0#0, #0#2, 0001, fFechaDesde;
     #0#1, #0#3, 9999, fFechaHasta;
     ;
     NULL, prev0002;
|FIN;

|PROCESO proceso;
     fFechaDesde = #0#4;
     fFechaHasta = #0#5;
     |BUCLE prev0002;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;  |BORRA 020#0a;  |FINSI;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |SI FSalida = 0;
          aAlfa = Usuario;
          |QBF aAlfa;
          aAlfa = "t" +  aAlfa;
          |NOME_DAT #100 aAlfa;
          |DELINDEX #100;
          |ABRE #100;
          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #labcentr;
          |ABRE #prev0101;

          |HAZ proceso;

          |HAZ informe;

          |CIERRA #prev0101;
          |CIERRA #labcentr;
          |CIERRA #labtraba;
          |CIERRA #labempre;
          |DELINDEX #100;
          |CIERRA #100;
     |FINSI;

     |GRABA 000#0n;
     |CIERRA #0;
|FPRO;
