|FICHEROS;
     nomzauto #0;
     nomhicca;
     nomhicli;
     nomvarca;
     nomvarli;
     nomconat;
     labtraba;
|FIN;

|VARIABLES;
     nImporte = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     nTipo = 0;
     nCuotaBuena = 0;
     nDiferencia = 0;
     &aDiferencia = "";
     &aEstado = "";
|FIN;

|PROCESO nomhicli;
     #labtraba#0 = #nomhicli#0;
     #labtraba#1 = #nomhicli#1;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          |SI #0#4 [ #labtraba#87; |Y #labtraba#87 [ #0#5; |Y #labtraba#42 = "H";
               || adelante
          |SINO;
               |ACABA;
          |FINSI;
     |SINO;
          |ACABA;
     |FINSI;

     #nomconat#0 = #labtraba#87;
     #nomconat#1 = #nomhicli#4;
     |LEE 000#nomconat.=;
     |SI FSalida = 0;
          |SALVA_FICHA #nomhicli;
          nImporte = 0;
          |PARA nCampo1 = 2; |SI nCampo1 [ 5; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 15;
               nCampo3 = nCampo1 + 30;
               |SI #nomconat#nCampo1# = "+"; |Y #nomconat#nCampo2# = "I";

                    #nomhicli#0 = #labtraba#0;
                    #nomhicli#1 = #labtraba#1;
                    #nomhicli#12 = 8;
                    #nomhicli#2 = 6;
                    #nomhicli#3 = 0;
                    #nomhicli#4 = #nomconat#nCampo3#;
                    |LEE 000#nomhicli.=;
                    |SI FSalida = 0;
                         nImporte = nImporte + (#nomhicli#11 * #nomhicli#10);
                    |FINSI;
               |FINSI;
               |SI #nomconat#nCampo1# = "%"; |Y #nomconat#nCampo2# = "P";
                    |SAL;
               |FINSI;
          |SIGUE;
          |REPON_FICHA #nomhicli;
     |SINO;
          |ACABA;
     |FINSI;

     nTipo = 0;
     |SI nImporte ! 0;
          #nomhicca#0 = #labtraba#0;
          #nomhicca#1 = #labtraba#1;
          #nomhicca#66 = 8;
          #nomhicca#2 = 6;
          #nomhicca#3 = 0;
          |LEE 000#nomhicca.=;
          |SI FSalida = 0;
               nTipo = #nomhicca#106;
          |SINO;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI nTipo ! 0;
          || nCuotaBuena = (nImporte % nTipo) ! 2;
          nCuotaBuena = #nomhicca#110;
          nDiferencia = nCuotaBuena - (#nomhicli#11 * #nomhicli#10);
          nDiferencia = nDiferencia ! 2;
          |SI nDiferencia ! 0;
               #nomvarca#0 = #labtraba#0;
               #nomvarca#1 = #labtraba#1;
               #nomvarca#2 = 9;
               #nomvarca#3 = 0;
               |LEE 000#nomvarca.=;
               |SI FSalida ! 0;
                    #nomvarca#0 = #labtraba#0;
                    #nomvarca#1 = #labtraba#1;
                    #nomvarca#2 = 9;
                    #nomvarca#3 = 0;
                    |SI #0#8 = "S";
                         |GRABA 020#nomvarca.n;
                    |FINSI;
               |FINSI;

               #nomvarli#0 = #labtraba#0;
               #nomvarli#1 = #labtraba#1;
               #nomvarli#2 = 9;
               #nomvarli#3 = 0;
               #nomvarli#4 = #0#7;
               |LEE 000#nomvarli.=;
               |SI FSalida ! 0;
                    #nomvarli#0 = #labtraba#0;
                    #nomvarli#1 = #labtraba#1;
                    #nomvarli#2 = 9;
                    #nomvarli#3 = 0;
                    #nomvarli#4 = #0#7;
                    #nomvarli#5 = 1;
                    aDiferencia = nDiferencia;
                    aDiferencia = ("            " + aDiferencia) % -112;
                    #nomvarli#6 = aDiferencia;
                    |SI #0#8 = "S";
                         |GRABA 020#nomvarli.n;
                         aEstado = "CREADA";
                    |SINO;
                         aEstado = "PRUEBA (CREA)";
                    |FINSI;
               |SINO;
                    #nomvarli#5 = 1;
                    aDiferencia = nDiferencia;
                    aDiferencia = ("            " + aDiferencia) % -112;
                    |SI aDiferencia ! #nomvarli#6;
                         #nomvarli#6 = aDiferencia;
                         |SI #0#8 = "S";
                              |GRABA 020#nomvarli.a;
                              aEstado = "ACTUALIZADA";
                         |SINO;
                              aEstado = "PRUEBA (ACT.)";
                         |FINSI;
                    |SINO;
                         |SI #0#8 = "S";
                              aEstado = "SIN CAMBIOS";
                         |SINO;
                              aEstado = "PRUEBA (SIN CAMBIOS)";
                         |FINSI;
                    |FINSI;
               |FINSI;
               |PRINT;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicli;
     #nomhicli#1;
     ;
     #0#0, #0#2, 8, 6, 0, #0#6;
     #0#1, #0#3, 8, 6, 0, #0#6;
     ;
     NULL, nomhicli;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #labtraba;
          |ABRE #nomvarca;
          |ABRE #nomvarli;
          |ABRE #nomconat;
          |ABRE #nomhicca;
          |ABRE #nomhicli;

          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "nomzauto";

               |BUCLE nomhicli;

               |PIEINF;
               |FININF;
               |FINIMP;
          |FINSI;

          |CIERRA #nomhicli;
          |CIERRA #nomhicca;
          |CIERRA #nomconat;
          |CIERRA #nomvarli;
          |CIERRA #nomvarca;
          |CIERRA #labtraba;
     |FINSI;
|FPRO;
