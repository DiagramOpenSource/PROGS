|FICHEROS;
     cretam02 #2,MANTE;
     cretam03 #3,MANTE;
     cretam04 #4,MANTE;

     cretat01,MANTE;
|FIN;

|VARIABLES;
     nModo = 0;
     nNume = 0;
     aNAFSS = "";
     aNAFSSAnt = "";
     aDesdeNAFSS = "";
     aAlfa = "";
     aAlfa1 = "";
     aCadenaBus = "";
     aCadenaCom = "";
     swBusqueda = 0;

     nCodBusAnt = 0;
     aNomBusAnt = "";
     aNIFBusAnt = "";
     aNAFBusAnt = "";

     aCCC = "";
     aCCCAnt = "";
|FIN;

|PROCESO Borra_04_m02;
     |BORRA 020#4a;
|FPRC;

|DEFBUCLE Borra_04_m02;
     #4#1;
     ;
     #2#0, #2#1, #2#2, #2#3, #2#4, "            ", 01;
     #2#0, #2#1, #2#2, #2#3, #2#4, "zzzzzzzzzzzz", 99;
     ;
     NULL, Borra_04_m02;
|FIN;

|PROCESO Borra_03_m02;
     |BORRA 020#3a;
|FPRC;

|DEFBUCLE Borra_03_m02;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#3, #2#4, "            ";
     #2#0, #2#1, #2#2, #2#3, #2#4, "zzzzzzzzzzzz";
     ;
     NULL, Borra_03_m02;
|FIN;

|PROCESO Tipo2_m02;
     |BUCLE Borra_03_m02;
     |BUCLE Borra_04_m02;
|FPRC;

|PROCESO inferior_03_m02;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #2#3;
     #3#4 = #2#4;
     #3#5 = "           "
|FPRC;

|PROCESO superior_03_m02;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #2#3;
     #3#4 = #2#4;
     #3#5 = "zzzzzzzzzzz";
|FPRC;

|PROCESO Mensa4; |TIPO 7;
     ||MENSA "    Pulse ENTER para consultar trabajadores del CCC; < F9 > Cambiar Estado";
     |MENSA "    < ENTER > Consulta trab. CCC, < F9 > Cambia estado < F11 > Búsqueda trab";
|FPRC;

/*
|PROCESO Muestra_m02; |TIPO 14;
     || muestra siempre el valor de lo que se introduzca en la cabecera

     |ENTLINEAL #1#3, -6, 7, 20, 0, inferior_03_m02, superior_03_m02;
     |ATRI I;
|FPRC;
*/

/************    BUSQUEDA DE TRABAJADOR *************************************/

|PROCESO inferior_04_m02;
     #4#0 = #2#0;
     #4#1 = #2#1;
     #4#2 = #2#2;
     #4#3 = #2#3;
     #4#4 = aCCC;
     #4#5 = aNAFSS;
     #4#6 = 01;
|FPRC;

|PROCESO superior_04_m02;
     #4#0 = #2#0;
     #4#1 = #2#1;
     #4#2 = #2#2;
     #4#3 = #2#3;
     #4#4 = aCCC;
     #4#5 = aNAFSS;
     #4#6 = 99;
|FPRC;

|PROCESO Busca2_m02;
     |SI swBusqueda = 2;
          aCadenaCom = #cretam03#9;
     |FINSI;
     |SI swBusqueda = 3;
          aCadenaCom = #cretam03#10;
     |FINSI;
     |SI swBusqueda = 4;
          aCadenaCom = #cretam03#5;
     |FINSI;

     |QBF aCadenaCom;
     aAlfa = aCadenaCom - aCadenaBus;
     |SI aAlfa ! aCadenaCom;
          aCCC = #cretam03#4;
          aNAFSS = #cretam03#5;
          |QBF aNAFSS;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE Busca2_m02;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#3, "               ", aDesdeNAFSS;
     #2#0, #2#1, #2#2, #2#3, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzz";
     ;
     NULL, Busca2_m02;
|FIN;

|PROCESO PorOtraCosa_m02;
     || BUSQUEDA POR NOMBRE DE TRABAJADOR

     swBusqueda = 2;
     aCadenaBus = #cretat01#1;
     |QBF aCadenaBus;
     |SI aCadenaBus ! "";
          |BUCLE Busca2_m02;
     |FINSI;

     || BUSQUEDA POR NIF

     swBusqueda = 3;
     aCadenaBus = #cretat01#2;
     |QBF aCadenaBus;
     |SI aCadenaBus ! "";
          |BUCLE Busca2_m02;
     |FINSI;

     || BUSQUEDA POR NAFSS

     swBusqueda = 4;
     aCadenaBus = #cretat01#3;
     |QBF aCadenaBus;
     |SI aCadenaBus ! "";
          |BUCLE Busca2_m02;
     |FINSI;
|FPRC;

|PROCESO Busca1_m02;
     aNAFSS = #cretam04#5;
     |QBF aNAFSS;
     aCCC = #cretam04#4;
|FPRC;

|DEFBUCLE Busca1_m02;
     #cretam04#1;
     7;
     #2#0, #2#1, #2#2, #2#3, "               ", aDesdeNAFSS, 01, nNume;
     #2#0, #2#1, #2#2, #2#3, "zzzzzzzzzzzzzzz", "zzzzzzzzzzzz", 31, nNume;
     ;
     NULL, Busca1_m02;
|FIN;

|PROCESO PorCodigo_m02;
     || BUSQUEDA POR CODIGO TRABAJADOR

     nNume = #cretat01#0;
     |SI nNume ! 0;
          |BUCLE Busca1_m02;
     |FINSI;
|FPRC;

|PROCESO Busqueda_m02;
     aCCCAnt = #cretam02#4;   || me quedo con el CCC en que estaba
                              || por si no encuentro nada en la busqueda,
                              || situarme despues

     |PUSHV 05012380;
     |PINPA #0#cretat01;
     |PINDA #0#cretat01;
     |ENDATOS #1#cretat01;
     nNume = #cretat01#0;
     aAlfa = #cretat01#1 +  #cretat01#2 + #cretat01#3;
     |QBF aAlfa;
     |SI nNume ! 0; |O aAlfa ! "";
          |POPV;
          aNAFSS = "";

          |SI nCodBusAnt = #cretat01#0; |Y aNomBusAnt = #cretat01#1;
          |Y aNIFBusAnt = #cretat01#2; |Y aNAFBusAnt = #cretat01#3;
               aAlfa = aNAFSSAnt % -102;
               aAlfa1 = aNAFSSAnt % -102;
               nNume = aAlfa1;
               nNume = nNume + 1;
               aAlfa1 = nNume; |QBF aAlfa1;
               aAlfa1 = ("00" + aAlfa1) % -102;

               aDesdeNAFSS = (aNAFSSAnt % 110) + aAlfa1;
          |SINO;
               aDesdeNAFSS = "";
          |FINSI;

          |HAZ PorCodigo_m02;
          |HAZ PorOtraCosa_m02;

          |SI aNAFSS ! "";
               |PUSHV 05012380;
               |ABRE #cretam03;
               #cretam03#0 = #cretam02#0;
               #cretam03#1 = #cretam02#1;
               #cretam03#2 = #cretam02#2;
               #cretam03#3 = #cretam02#3;
               #cretam03#4 = aCCC;
               #cretam03#5 = aNAFSS;
               |LEE 000#cretam03.=;
               |PINPA #0#cretam03;
               |PINDA #0#cretam03;
               |CIERRA #cretam03;

               |ENTLINEAL #1#4, -7, 2, 22, 1, inferior_04_m02, superior_04_m02;
               |POPV;

               #cretam02#4 = aCCC;
               |LEE 000#cretam02.=;
               |PONCONTROL 23,"SI";

               nCodBusAnt = #cretat01#0;
               aNomBusAnt = #cretat01#1;
               aNIFBusAnt = #cretat01#2;
               aNAFBusAnt = #cretat01#3;
          |SINO;
               |SI aDesdeNAFSS = "";
                    |MENAV "    Trabajador no localizado";
                    #cretam03#5 = aNAFSSAnt;
                    |LEE 000#cretam03.=;
                    |SI FSalida = 0;
                         |PONCONTROL 23,"si";
                    |FINSI;
               |SINO;
                    aDesdeNAFSS = "";
                    |HAZ PorCodigo_m02;
                    |HAZ PorOtraCosa_m02;

                    |SI aNAFSS ! "";
                         #cretam03#5 = aNAFSS;
                         |LEE 000#cretam03.=;
                         |PONCONTROL 23,"SI";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |POPV;
     |FINSI;
|FPRC;

/****************************************************************************/

|PROCESO Tipo3_m02; |TIPO 6;
     || llama al lineal que le corresponde
     |SI FSalida = 0;
          |PUSHV 05012380;
          |ENTLINEAL #1#3, -6, 4, 22, 1, inferior_03_m02, superior_03_m02;
          |POPV;
          ||PTEC 806;
     |SINO;
          |SI FSalida = 6;
               |HAZ Busqueda_m02;
               |ACABA;
          |FINSI;
          |SI FSalida = 14;
               |HAZ Tipo2_m02;
          |FINSI;
          |SI FSalida = 17;
               |SI #cretam02#22 = "B";
                    #cretam02#22 = "C";
                    |GRABA 020#cretam02.a;
                    |PINTA #cretam02#22;
                    |LIBERA #cretam02;
                    |PONCONTROL 23, "si";
               |SINO;
                    |SI #cretam02#22 = "C";
                         #cretam02#22 = "B";
                         |GRABA 020#cretam02.a;
                         |PINTA #cretam02#22;
                         |LIBERA #cretam02;
                         |PONCONTROL 23, "si";
                    |SINO;
                         |SI #cretam02#22 = " ";
                              #cretam02#22 = "C";
                              |GRABA 020#cretam02.a;
                              |PINTA #cretam02#22;
                              |LIBERA #cretam02;
                              |PONCONTROL 23, "si";
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
