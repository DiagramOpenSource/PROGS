|FICHEROS;
     nomfiest #0;
     || :integral/dsam0114 #114;      || Autonomias
     || :integral/dsam0100 #100;      || Provincias
     || nomactiv #11;                 || Maestro Actividades
     labmunic #10;                  || Poblaciones
     labprovi #100;                 || Provincias
     labauton #114;                 || Comunidades Autonomas
     temp0001@ #500;
|FIN;

|VARIABLES;
     aAlfa = "";
     swExiste = 0;
     aCodPobla = "";
     aCodPostal = "";
     aCaracter = "";
     aTipo = "";
     aTipo1 = "";
     aTipo2 = "";
     aFecha = "";
     aDia = "";
     aMes = "";
     nDia = 0;
     nMes = 0;
     aPunto = "";
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;
     aInferior = "";
     nSuperior = 0;
     aSuperior = "";
     aNuevaFecha = "";
     nFlag = 0;
     swError = 0;
|FIN;

|PROCESO Desactiva;
     |SI Campo = 0;
          |SI #0Campo ! 0;
               |CAMPO_MODIFICA #0#4, 1, "N";
          |SINO;
               |CAMPO_MODIFICA #0#4, 1, "S";
          |FINSI;
     |FINSI;
     |SI Campo = 4;
          |SI #0Campo ! 0;
               |CAMPO_MODIFICA #0#0, 1, "N";
          |SINO;
               |CAMPO_MODIFICA #0#0, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Fecha2;
     swError = 0;
     aFecha = aNuevaFecha;
     aDia = aFecha % 102;
     aMes = aFecha % -102;
     aPunto = aFecha % 301;
     nDia = aDia;
     nMes = aMes;
     |SI nDia < 1; |O nDia > 31; |O nMes < 1; |O nMes > 12; |O aPunto ! ".";
          aAlfa = "    Formato de fecha incorrecto. Introduzca la fecha en formato DD.MM";
          |MENAV aAlfa;
          swError = 1;
     |FINSI;
|FPRC;

|PROCESO Fecha;
     swError = 0;
     |SI nFlag ] 0;
          aFecha = #0#8;
     |FINSI;
     aDia = aFecha % 102;
     aMes = aFecha % -102;
     aPunto = aFecha % 301;
     nDia = aDia;
     nMes = aMes;
     |SI nDia < 1; |O nDia > 31; |O nMes < 1; |O nMes > 12; |O aPunto ! ".";
          aAlfa = "    Formato de fecha incorrecto. Introduzca la fecha en formato DD.MM";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo; |TIPO 7;
     aTipo = "N";
     |SI #0#0 ! 0;
          aTipo = "A";
          #0#2 = 0; |PINTA #0#2;
          #0#3 = ""; |PINTA #0#3;
          #0#4 = 0; |PINTA #0#4;
          #0#5 = ""; |PINTA #0#5;
     |FINSI;
     |SI #0#2 ! 0;
          aTipo = "P";
          #0#0 = 0; |PINTA #0#0;
          #0#1 = ""; |PINTA #0#1;
          #0#4 = 0; |PINTA #0#4;
          #0#5 = ""; |PINTA #0#5;
     |FINSI;
     |SI #0#4 ! 0;
          aTipo = "L";
          #0#0 = 0; |PINTA #0#0;
          #0#1 = ""; |PINTA #0#1;
          #0#2 = 0; |PINTA #0#2;
          #0#3 = ""; |PINTA #0#3;
     |FINSI;
     |SI #0#6 ! 0;
          aTipo = aTipo + "D";
     |FINSI;

     #0#9 = aTipo;
     aTipo1 = aTipo % 101;
     |SI aTipo1 = "N";
          aCaracter = "Nacional";
     |FINSI;
     |SI aTipo1 = "A";
          aCaracter = "Autonomica";
     |FINSI;
     |SI aTipo1 = "P";
          aCaracter = "Provincial";
     |FINSI;
     |SI aTipo1 = "L";
          aCaracter = "Local";
     |FINSI;

     aTipo2 = aTipo % 201;
     |SI aTipo2 = "D";
          aCaracter = aCaracter + "/Actividad";
     |FINSI;

     #0#10 = aCaracter;
     |PINTA #0#10;
|FPRC;

|PROCESO MinMuni;
     #labmunic#4 = "00000";
     #labmunic#1 = "00000";
|FPRC;

|PROCESO MaxMuni;
     #labmunic#4 = "99999";
     #labmunic#1 = "99999";
|FPRC;

|PROCESO BuscaMuni; |TIPO 0;
     |SI #0#0 = 0;
          aAlfa = "SELECT * FROM labmunic INTO tm" + Usuario;
          aAlfa = aAlfa + " WHERE 1 = " + aInferior;
          |SQL aAlfa;
          |SI FSalida ! 0;
               |MENAV "    No hay registros"; |ERROR; |ACABA;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/labmunic.mas";
          |CARGA_DEF aAlfa , temp0001@;
          |SI FSalida = 0;
               aAlfa = "tm" + Usuario; |NOME_DAT #500 aAlfa;
               |ABRE #temp0001@;
               nModo = 2 + 4 + 8 + 16;
               nPos1 = 1723; nPos2 = 2380;
               |LINEAL_SIMPLE #1#temp0001@,nModo, nPos1, nPos2, NULL, NULL, NULL;
               |SI FSalida = 0;
                    #nomfiest#4 = #500#1;
                    #nomfiest#5 = #500#3;
                    |PINTA #nomfiest#4;
                    |PINTA #nomfiest#5;
               |FINSI;
               |CIERRA #temp0001@; |DESCARGA_DEF #temp0001@;
          |FINSI;
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

/*
|PROCESO BuscaMuni; |TIPO 7;
     |SI #0#0 = 0;
          |CONSULTA_F_CLAVE #1#labmunic, MinMuni, MaxMuni;
          #0#4 = #labmunic#1;
          |PINTA #0#4;
     |FINSI;
|FPRC;
*/

|PROCESO Modificacion;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nFlag = 0 +. 1;
     |SI nModo = 2; |Y nFlag < 0;
          |PUSHV 14621777;
          |BLANCO 14621777;
          |CUADRO 14621777;
          |ATRI R;   || 6       7
                     || 34567890123456
          |PINTA 1463, " Modificacion ";
          |ATRI 0;
          |PINTA 1563, " clave: fecha ";
          E_sup = 5; E_inf = "";

          swError = 1;
          aNuevaFecha = #0#8;
          |PARA; |SI swError ! 0; |HACIENDO;
               aNuevaFecha = 1668 ? 0;
               |QBF aNuevaFecha;
               aFecha = aNuevaFecha;
               |HAZ Fecha2;
          |SIGUE;

          |BORRA 020#0a;
          #0#8 = aNuevaFecha;
          |GRABA 020#0n;
     |POPV;
     |PONCONTROL 23, "si";
     |FINSI;
|FPRC;

|PROCESO ConsultaAut; |TIPO 66;
     |CONSULTA_CLAVE #1#114;
     |SI FSalida = 0; |Y #0#0 ! 00;
          #0#0 = #114#0;
          #0#1 = #114#1;
          |PINTA #0#0;
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO Autonomia;
/*
     #114#0 = #0#0;
     |LEE 000#114=;
     |SI FSalida = 0;
          #0#1 = #114#1;
          |PINTA #0#1;
     |SINO;
          |SI #0#0 ! 0;
               aAlfa = "    Comunidad Autonoma no encontrada en el fichero";
               aAlfa = aAlfa + " de Autonomias";
               |MENAV aAlfa;
               |ERROR;
          |SINO;
               #0#1 = "";
               |PINTA #0#1;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO Provincia;
/*
     #100#0 = #0#2;
     |LEE 000#100=;
     |SI FSalida = 0;
          #0#3 = #100#1;
          |PINTA #0#3;
     |SINO;
          |SI #0#3 ! 0;
               aAlfa = "    Provincia no encontrada en el fichero general";
               aAlfa = aAlfa + " de Provincias";
               |MENAV aAlfa;
               |ERROR;
          |SINO;
               #0#3 = "";
               |PINTA #0#3;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO BuscaPob;
     swExiste = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE BuscaPob;
     #labmunic#3;
     ;
     aCodPobla, "00000";
     aCodPobla, "99999";
     ;
     NULL, BuscaPob;
|FIN;

|PROCESO Poblacion; |TIPO 0;
     swExiste = 0;
     aCodPobla = #0#4;
     aCodPobla = "00000" + aCodPobla;
     aCodPobla = aCodPobla % -105;

     |BUCLE BuscaPob;
     |SI swExiste  = 1;
          #0#5 = #labmunic#3;
          |PINTA #0#5;
     |SINO;
          |SI #0#4 ! 0;
               aAlfa = "    Municipio no encontrado en el fichero general";
               aAlfa = aAlfa + " de Municipios. Seleccione un municipio correcto.";
               |MENAV aAlfa;

               aInferior = #0#4;
               aInferior = "00000" + aInferior;
               aInferior = aInferior % -105;
               |SI #0#4 > 999;
                    aInferior = aInferior % 102;
               |SINO;
                    aInferior = aInferior % -102;
               |FINSI;
               nSuperior = #0#4;
               nSuperior = nSuperior + 1000;
               aSuperior = nSuperior;
               aSuperior = "00000" + aSuperior;
               aSuperior = aSuperior % -105;

               |HAZ BuscaMuni;
          |SINO;
               #0#5 = "";
               |PINTA #0#5;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ActiBlanco;
/*
     |SI #0#6 = 0;
          #0#7 = "";
          |PINTA #0#7;
     |FINSI;
*/
|FPRC;

|PROCESO inferior;
     #nomfiest#0 = 00;       || Autonomia
     #nomfiest#2 = 00;       || Provincia
     #nomfiest#4 = 00000;    || Poblacion
     #nomfiest#6 = 000;      || Actividad
     #nomfiest#8 = "     ";  || Actividad
|FPRC;

|PROCESO superior;
     #nomfiest#0 = 99;       || Autonomia
     #nomfiest#2 = 99;       || Provincia
     #nomfiest#4 = 99999;    || Poblacion
     #nomfiest#6 = 999;      || Actividad
     #nomfiest#8 = "zzzzz";  || Actividad
|FPRC;

|PROGRAMA;
     |ABRE #10;
     ||ABRE #11;
     |ABRE #100;
     |ABRE #114;
     |ENTLINEAL #1#nomfiest, 1, 2, 22, 1, inferior, superior;
     |CIERRA #10;
     ||CIERRA #11;
     |CIERRA #100;
     |CIERRA #114;
|FPRO;
