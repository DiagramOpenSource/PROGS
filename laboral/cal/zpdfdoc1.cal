|FICHEROS;
     labregis #10;
     labvaltb #11;
     labempre #12;
     labtraba #13;
     labpadre #14;
     tdpmunic #15;
     nomregim #16;
     contrato #17;
     labcotmp #18;
     nomconca #19;
     labconre #20;
     labacuer #21;
     labmunic #22;
     nomequiv #23;
     stiacatc #24;
     socupatc #25;
     labcentr #26;
     taiclaoc #27;
     thitiaca #28;
     labcontr;
     labhisto;
     &regisnif@ #712;
     labco224;
     labacue2;
     || labemett;
     copiadef@ #500;          || para hacer carga_def, da error si no
|FIN;

|VARIABLES;
   &aProcedencia = "";
   &eaNumProrr = "";
   &enNumRegis = 0;
   &aCodCCC    = "";
   &aSwMinus    = "";
   &fFechaIni   = @;
   &fFechaIniCto= @;
   &fFechaFin   = @;
   &nHayCopiaBas = 0;
   &aPaisCentro = "";
   &aCodMuniC = "";
   &nLey122001 = 0;
   &aCodColDesp = "";
   &swAnexoRelevo = 0;
   &swAnexoClaus  = 0;
   &swAnexoRedCuotas = 0;

   &enRegis1   = 0;
   &enRegis2   = 0;
   &enRegis3   = 0;

   &nContMuni = 0;
   &aCodPos = "";
   &aCodMuni = "";

   aAlfa       = "";
   aAlfa1      = "";
   aAlfa2      = "";
   aAlfa3      = "";
   aNume       = "";
   aLong       = "";
   aCampo      = "";

   aExclu      = "";

   nSw         = 0;
   nSwContrato = 0;
   nAntContrato = 0;
   &nSwTrans    = 0;
   nHandle     = 0;
   nLimReal    = 0;
   nNume       = 0;
   nNume1      = 0;
   nNume2      = 0;
   nLong       = 0;
   nCampo      = 0;
   nCalc       = 0;
   nPos        = 0;
   nInd        = 0;
   nHayComa    = 0;
   SwSalir     = 0;
   nNumCar = 0;
   nTotCar = 0;
   fFecha = @;
   aFecha = "";
   aAny = "";
   swEtiIni = 0;
     &swNetContrata = 0;
     nContador = 0;
     &eaCodNif = "";
     swSigue = 0
     &swNetContEmi = 0;       || llamada a NetContrata desde la emision
                              || del contrato, no desde historico
     sw42013 = 0;
     aCabecera = "";
     aOrigen = "";
     aDestino = "";
     aIP = "";
     aCole = "";
     aValor = "";
     &swNetContrataMas = 0;

     aDato = "";
     aLinea = "";
     aEtiqueta = "";
     nNivel = 0;
     aLon = "";
     nLon = 0;
     aBase = "";
     aMas = "";
     aFich = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &aCadena = "";
|FIN;

|PROCESO Municipio;
     |ABRE #labmunic;
     |SELECT #4#labmunic;
     #labmunic#4 = aCodPos;
     |LEE 000#labmunic.];
     |SI FSalida = 0;
          aCodMuni = #labmunic#1;
     |SINO;
          |DDEFECTO #labmunic;
     |FINSI;
     |SELECT #1#labmunic;
     |CIERRA #labmunic;
|FPRC;

|PROCESO GrabaLinea;
     aCadena = aAlfa;
     |HAZ QuitaRaros;
     aAlfa = aCadena;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO NetcontrataEmp;
     |ABRE #labcontr;        || lee control aplicacion
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;
     swSigue = 0;
     |SI swNetContrata = 1; |O swNetContEmi = 1;
          |SI nSwTrans = 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          || compruebo el cod. cta. cot. del centro antes que nada, que si no
          || me viene bien me sale despues el contrato en blanco
          |QBF aCodCCC;
          aLong = aCodCCC % 0;
          nLong = aLong;
          |SI nLong ! 11;
               aAlfa = "    ATENCION. El Código de Cuenta de Cotización del ";
               aAlfa = aAlfa + "centro de trabajo no tiene el formato correcto";
               |MENAV aAlfa;
               aAlfa = "    Verifique que tiene 11 dígitos y vuelva a enviar ";
               aAlfa = aAlfa + "el contrato.";
               |MENAV aAlfa;
          |FINSI;

          || a¤ado etiquetas propias del NetContrata
          aAlfa = &9 + &9 + &9 + "<NOMBRE>" + #labempre#2;           |QBF aAlfa; aAlfa = aAlfa + "</NOMBRE>" + &13 + &10;     |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<TELEFONO>" + #labempre#111;       |QBF aAlfa; aAlfa = aAlfa + "</TELEFONO>" + &13 + &10;   |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<FAX>" + #labempre#112;            |QBF aAlfa; aAlfa = aAlfa + "</FAX>" + &13 + &10;        |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<ACTIVIDAD>" + #labempre#128;      |QBF aAlfa; aAlfa = aAlfa + "</ACTIVIDAD>" + &13 + &10;  |HAZ GrabaLinea;

          |ABRE #nomconca;
          #nomconca#0 = #labtraba#87;
          |LEE 000#nomconca.=;
          |CIERRA #nomconca;
          aAlfa = #nomconca#142; |QBF aAlfa;
          aAlfa = &9 + &9 + &9 + "<CONVENIO>" + aAlfa;       |QBF aAlfa; aAlfa = aAlfa + "</CONVENIO>" + &13 + &10;         |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<OFICINA>" + #labcontr#64;         |QBF aAlfa; aAlfa = aAlfa + "</OFICINA>" + &13 + &10;          |HAZ GrabaLinea;
/*
          || creo recordar que en algun momento se enviaban las clausulas
          || con los ficheros de Contrata, pero mirando los esquemas ahora no
          || veo que se envien, con lo que no hace falta envidentemente para
          || Netcontrata tampoco 14.09.2010

          |ABRE #labhisto;
          #labhisto#100 = enNumRegis;
          #labhisto#103 = eaNumProrr;
          |LEE 000#labhisto.=;
          |SI FSalida ! 0;
               |MENAV "    No encuentro el registro de emision del contrato";
               |ERROR;
               |ACABA;
          |FINSI;
          |CIERRA #labhisto;

          aAlfa = &9 + &9 + &9 + "<CLAUSULAS>" + &13 + &10;          |HAZ GrabaLinea;
          |PARA nContador = 9; |SI nContador [ 26; |HACIENDO nContador = nContador + 1;
               aAlfa = #labhisto#nContador#; |QBF aAlfa;
               |SI aAlfa ! "";
                    aAlfa = &9 + &9 + &9 + &9 + aAlfa + &13 + &10;   |HAZ GrabaLinea;
               |FINSI;
          |SIGUE;
          aAlfa = &9 + &9 + &9 + "</CLAUSULAS>" + &13 + &10;       |HAZ GrabaLinea;
*/

          aAlfa = &9 + &9 + &9 + "<FIRMA></FIRMA>" + &13 + &10;    |HAZ GrabaLinea;

          || Domicilio Social Empresa

          eaCodNif = #labempre#10;
          |HAZ LeeNifs;

          aAlfa = &9 + &9 + &9 + "<DOMICILIO_SOCIAL>" + &13 + &10;  |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<NUMERO>" + #712#3;          |QBF aAlfa; aAlfa = aAlfa + "</NUMERO>" + &13 + &10;      |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<ESCALERA>" + #712#16;       |QBF aAlfa; aAlfa = aAlfa + "</ESCALERA>" + &13 + &10;    |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<PUERTA>" + #712#11;         |QBF aAlfa; aAlfa = aAlfa + "</PUERTA>" + &13 + &10;      |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<TIPO_VIA>" + #712#9;        |QBF aAlfa; aAlfa = aAlfa + "</TIPO_VIA>" + &13 + &10;    |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<VIA>" + #712#2;             |QBF aAlfa; aAlfa = aAlfa + "</VIA>" + &13 + &10;         |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<CODIGO_MUNICIPIO>";
          aCodPos = (("00" + #labempre#7) % -102) + (("000" + #labempre#8) % -103);
          |HAZ CodigoMuni;
          |SI nContMuni = 0;
             aAlfa1 = "";
          |SINO;
             aAlfa1 = aCodMuni;
          |FINSI;
          aAlfa = aAlfa + aAlfa1;
          aAlfa = aAlfa + "</CODIGO_MUNICIPIO>" + &13 + &10;   |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<PISO>" + #712#10;           |QBF aAlfa; aAlfa = aAlfa + "</PISO>" + &13 + &10;     |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "</DOMICILIO_SOCIAL>" + &13 + &10; |HAZ GrabaLinea;

          || Domicilio Centro de Trabajo
          aAlfa = &9 + &9 + &9 + "<DOMICILIO_CENTRO>" + &13 + &10;  |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<NUMERO>" + #labcentr#4;     |QBF aAlfa; aAlfa = aAlfa + "</NUMERO>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<ESCALERA></ESCALERA>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<PUERTA></PUERTA>" + &13 + &10;  |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<TIPO_VIA></TIPO_VIA>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<VIA>" + #labcentr#3;        |QBF aAlfa; aAlfa = aAlfa + "</VIA>" + &13 +&10;  |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<CODIGO_MUNICIPIO>";
          aCodPos = (("00" + #labcentr#7) % -102) + (("000" + #labcentr#8) % -103);
          |HAZ CodigoMuni;
          |SI nContMuni = 0;
             aAlfa1 = "";
          |SINO;
             aAlfa1 = aCodMuni;
          |FINSI;
          aAlfa = aAlfa + aAlfa1;
          aAlfa = aAlfa + "</CODIGO_MUNICIPIO>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<PISO>" + #labcentr#5;       |QBF aAlfa; aAlfa = aAlfa + "</PISO>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "</DOMICILIO_CENTRO>" + &13 + &10; |HAZ GrabaLinea;

          || Datos representante de la empresa
          aAlfa = &9 + &9 + &9 + "<REPRESENTANTE>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<DNI>" + #labempre#17;       |QBF aAlfa; aAlfa = aAlfa + "</DNI>" + &13 + &10;      |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<NOMBRE>" + #labempre#15;    |QBF aAlfa; aAlfa = aAlfa + "</NOMBRE>" + &13 + &10;   |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<CARGO>"  + #labempre#18;    |QBF aAlfa; aAlfa = aAlfa + "</CARGO>" + &13 + &10;    |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "</REPRESENTANTE>" + &13 + &10;    |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO NetcontrataTra;
     |ABRE #labcontr;        || lee control aplicacion
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;
     swSigue = 0;
     |SI swNetContrata = 1; |O swNetContEmi = 1;
          |SI nSwTrans = 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          aCadena = #labtraba#2;
          |HAZ SeparaNom_plb;
          eaNom = eaNom % 115;
          aAlfa = &9 + &9 + &9 + "<NOMBRE>" + eaNom;                       |QBF aAlfa; aAlfa = aAlfa + "</NOMBRE>" + &13 + &10;    |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<PRIMER_APELLIDO>" + eaApel1 + "</PRIMER_APELLIDO>" + &13 + &10;                                 |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<SEGUNDO_APELLIDO>" + eaApel2 + "</SEGUNDO_APELLIDO>" + &13 + &10;                               |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<TELEFONO>" + #labtraba#244;            |QBF aAlfa; aAlfa = aAlfa + "</TELEFONO>" + &13 + &10;  |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<ESTUDIOS>" + #labtraba#73;             |QBF aAlfa; aAlfa = aAlfa + "</ESTUDIOS>" + &13 + &10;  |HAZ GrabaLinea;
          || etiqueta domicilio

          eaCodNif = #labtraba#7;
          |HAZ LeeNifs;

          aAlfa = &9 + &9 + &9 + "<DOMICILIO>" + &13 + &10;      |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<NUMERO>" + #712#3;       |QBF aAlfa; aAlfa = aAlfa + "</NUMERO>" + &13 + &10;      |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<ESCALERA>" + #712#16;    |QBF aAlfa; aAlfa = aAlfa + "</ESCALERA>" + &13 + &10;    |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<PUERTA>" + #712#11;      |QBF aAlfa; aAlfa = aAlfa + "</PUERTA>" + &13 + &10;      |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<TIPO_VIA>" + #712#9;     |QBF aAlfa; aAlfa = aAlfa + "</TIPO_VIA>" + &13 + &10;    |HAZ GrabaLinea;
          aAlfa = #712#2; |QBF aAlfa;
          aAlfa = aAlfa - #712#9;
          aAlfa = &9 + &9 + &9 + &9 + "<VIA>" + #712#2;          |QBF aAlfa; aAlfa = aAlfa + "</VIA>" + &13 + &10; |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<CODIGO_MUNICIPIO>";
          aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
          |HAZ CodigoMuni;
          |SI nContMuni = 0;
             aAlfa1 = "";
          |SINO;
             aAlfa1 = aCodMuni;
          |FINSI;
          aAlfa = aAlfa + aAlfa1;
          aAlfa = aAlfa + "</CODIGO_MUNICIPIO>" + &13 + &10;     |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + &9 + "<PISO>" + #712#10;        |QBF aAlfa; aAlfa = aAlfa + "</PISO>" + &13 + &10;   |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "</DOMICILIO>" + &13 + &10;     |HAZ GrabaLinea;
          aAlfa = &9 + &9 + &9 + "<REPRESENTANTE>" + &13 + &10;  |HAZ GrabaLinea;
          aAlfa = #labtraba#22;
          aAlfa1 = aAlfa % 103;
          |SI aAlfa1 = "...";
               aAlfa = "";
          |FINSI;
          aAlfa = &9 + &9 + &9 + &9 + "<DNI>" + aAlfa;      |QBF aAlfa; aAlfa = aAlfa + "</DNI>" + &13 + &10;    |HAZ GrabaLinea;

          aAlfa = #labtraba#20;
          aAlfa1 = aAlfa % 103;
          |SI aAlfa1 = "...";
               aAlfa = "";
          |FINSI;
          aAlfa = &9 + &9 + &9 + &9 + "<NOMBRE>" + aAlfa;   |QBF aAlfa; aAlfa = aAlfa + "</NOMBRE>" + &13 + &10;  |HAZ GrabaLinea;

          aAlfa = #labtraba#23;
          aAlfa1 = aAlfa % 103;
          |SI aAlfa1 = "...";
               aAlfa = "";
          |FINSI;
          aAlfa = &9 + &9 + &9 + &9 + "<PARENTESCO>" + aAlfa;      |QBF aAlfa; aAlfa = aAlfa + "</PARENTESCO>" + &13 + &10;  |HAZ GrabaLinea;

          aAlfa = &9 + &9 + &9 + "</REPRESENTANTE>" + &13 + &10;   |HAZ GrabaLinea;
     |FINSI;
|FPRC;

|PROCESO AnexoFormacion;
     |ABRE #labcontr;        || lee control aplicacion
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;
     swSigue = 0;
     |SI swNetContrata = 1; |O swNetContEmi = 1;
          |SI nSwTrans = 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          aAlfa = &09 + &09 + "<ANEXOFORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + &09 + "<CODIGOCENTRO>";
          aAlfa = aAlfa + #labcontr#66 + "</CODIGOCENTRO>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          |ABRE #labacue2;
          #labacue2#0 = #labtraba#0;
          #labacue2#1 = #labtraba#1;
          |LEE 000#labacue2.=;
          |SI FSalida = 0;
               aAlfa = &09 + &09 + &09 + "<OCUPACIONCENTRO>";
               aAlfa = aAlfa + #labacue2#27 + "</OCUPACIONCENTRO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa = &09 + &09 + &09 + "<HORARIOFORMACION>";
               aAlfa = aAlfa + #labacue2#70 + "</HORARIOFORMACION>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa1 = #labacue2#38; |QBF aAlfa1;
               aAlfa1 = ("0000" + aAlfa1) % -104;
               aAlfa = &09 + &09 + &09 + "<ENTIDAD>";
               aAlfa = aAlfa + aAlfa1 + "</ENTIDAD>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa1 = #labacue2#39; |QBF aAlfa1;
               aAlfa1 = ("0000" + aAlfa1) % -104;
               aAlfa = &09 + &09 + &09 + "<OFICINA_BANCARIA>";
               aAlfa = aAlfa + aAlfa1 + "</OFICINA_BANCARIA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa1 = #labacue2#40; |QBF aAlfa1;
               aAlfa1 = ("00" + aAlfa1) % -102;
               aAlfa = &09 + &09 + &09 + "<DC>";
               aAlfa = aAlfa + aAlfa1 + "</DC>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa1 = #labacue2#41; |QBF aAlfa1;
               aAlfa1 = ("0000000000" + aAlfa1) % -110;
               aAlfa = &09 + &09 + &09 + "<CUENTA>";
               aAlfa = aAlfa + aAlfa1 + "</CUENTA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
          |CIERRA #labacue2;

          aAlfa = &09 + &09 + "</ANEXOFORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
|FPRC;

|PROCESO CopiaBasica_Eti;
      |ABRE #labcontr;
      |LEE 000#labcontr.p;
      |CIERRA #labcontr;

      |SI #labcontr#37 = 0;
          |ACABA;
      |FINSI;

      aAlfa = &09 + &09 + "<DATOS_COMUNICA_COPIA_BASICA>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |SI nHayCopiaBas = 1; aAlfa = "1"; |SINO; aAlfa = "3"; |FINSI;
      aAlfa1 = #labcentr#12; |QBF aAlfa1;    || si no hay representante
      |SI aAlfa = "1";                       || sindical, el tipo de firma
           |SI aAlfa1 = ""; |O aAlfa1 = "NO EXISTE";  || es un "2" y no un "1"
               aAlfa = 2;
           |FINSI;
      |FINSI;
      |SI aAlfa ! "";
         aAlfa = &09 + &09 + &09 + "<TIPO_FIRMA>" + aAlfa + "</TIPO_FIRMA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

      |SI #labcontr#57 = "S";
         ||SI swAnexoClaus = 1;
            nLimReal = nNume;
            nTotCar = 0;
            swEtiIni = 0;
            |PARA nNume = 1; |SI nNume [ 18; |Y nTotCar [ 749; |HACIENDO nNume = nNume + 1;
                aNume = nNume;  aNume = "00" + aNume; aNume = aNume % -102;
                aCampo = aAlfa + aNume;
                nCampo = nNume + 8;
                aAlfa = #contrato#nCampo#; |QBF aAlfa;
                |SI aAlfa ! "";
                   aAlfa1 = aAlfa % 0;
                   nNumCar = aAlfa1;
                   nNumCar = nNumCar + 1;
                   nTotCar = nTotCar + nNumCar;
                   |SI nTotCar > 749;
                       nNume = nNumCar - (nTotCar - 749);
                       nNume = 100 + nNume;
                       aAlfa = aAlfa % nNume;
                   |FINSI;
                   aAlfa = aAlfa + " ";
                   |SI swEtiIni = 0;
                      aAlfa1 = &09 + &09 + &09 + "<TEXTO_COPIABASICA>";
                      aCadena = aAlfa1; |HAZ QuitaRaros; aAlfa1 = aCadena; |XGRABA nHandle, aAlfa1;
                      swEtiIni = 1
                   |FINSI;
                   aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
                |FINSI;
            |SIGUE;
         ||FINSI;
         |SI swEtiIni = 1;
            aAlfa = "</TEXTO_COPIABASICA>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |FINSI;

      aCodPos = (("00" + #labcentr#7) % -102) + (("000" + #labcentr#8) % -103);

      aAlfa = #labcentr#3; |QBF aAlfa;
      aAlfa = aAlfa + " " + #labcentr#4; |QBF aAlfa;
      aAlfa = aAlfa + ", " + #labcentr#5; |QBF aAlfa;
      aAlfa = aAlfa + " - (" + aCodPos + ")"; |QBF aAlfa;
      aAlfa = aAlfa + " " + #labcentr#6; |QBF aAlfa;
      aAlfa = aAlfa + " - " + #labcentr#9; |QBF aAlfa;
      aAlfa = &09 + &09 + &09 + "<DOMIC_CENTRO_TRABAJO>" + aAlfa + "</DOMIC_CENTRO_TRABAJO>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      aAlfa = &09 + &09 + "</DATOS_COMUNICA_COPIA_BASICA>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO HorasTPCon;
               nNume1 = (nCalc + 1) - (nCalc ! 0);
               |SI nNume1 = 0;       || horas enteras
                    nCalc = (nCalc * 100) ! 0;
                    aAlfa = nCalc;
                    aAlfa = (("000000" + aAlfa) % -106);
               |SINO;
                    nCalc = nCalc - nNume1;
                    nNume1 = (60 * nNume1) ! 0;
                    |SI nNume1 = 60;
                         nCalc = nCalc + 1;
                         nNume1 = 0;
                    |FINSI;
                    aAlfa1 = nCalc; aAlfa1 = (("0000" + aAlfa1) % -104);
                    aAlfa2 = nNume1; aAlfa2 = (("00" + aAlfa2) % -102);
                    aAlfa = aAlfa1 + aAlfa2;
               |FINSI;
|FPRC;

|PROCESO DatosContratoTP;
     swSigue = 0;
     |SI nSwContrato = 200; |O nSwContrato = 230; |O nSwContrato = 250;
     |O nSwContrato = 209; |O nSwContrato = 289;
     |O nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
     |O nSwContrato = 421; |O nSwContrato = 501; |O nSwContrato = 502;
     |O nSwContrato = 503; |O nSwContrato = 510; |O nSwContrato = 520;
     |O nSwContrato = 530; |O nSwContrato = 540; |O nSwContrato = 541;
     |O nSwContrato = 550; |O nSwContrato = 289;
     |O nSwContrato = 309; |O nSwContrato = 389;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 0;
          |ACABA;
     |FINSI;

     aAlfa = &09 + &09 + "<DATOS_CONTRATO_TIEMPO_PARCIAL>"  + &13 + &10;
     aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

     || TIPO_JORNADA
     aAlfa = #contrato#29;
     |SI nSwContrato = 421; aAlfa = #contrato#81; |FINSI;
     |SI nSwContrato = 250;
          |SI aProcedencia = "labcon95"; |O aProcedencia = "labcon9a";
               aAlfa = #contrato#31;
          |SINO;
               aAlfa = #contrato#28;
          |FINSI;
     |FINSI;
     |SI nSwContrato = 401; |O nSwContrato = 501;
     |O nSwContrato = 520; |O nSwContrato = 540; |O nSwContrato = 502;
          aAlfa = #contrato#30;
     |FINSI;
     |SI nSwContrato = 209; |O nSwContrato = 289;
          aAlfa = #contrato#28;
     |FINSI;
     |SI nSwContrato = 309; |O nSwContrato = 389;
     |O nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
          aAlfa = "A";
     |FINSI;
     |SI aProcedencia = "labcon51";
          aAlfa = #contrato#31;
     |FINSI;
     |SI aExclu ! "";       aAlfa = #contrato#31; |FINSI;

     |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = &09 + &09 + &09 + "<TIPO_JORNADA>" + aAlfa + "</TIPO_JORNADA>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;

     || HORAS TP

     swSigue = 1;
     |SI nSwContrato = 309; |O nSwContrato = 389;
          swSigue = 0;
          || en estos dos tipos depende de otro campo que no tenemos en
          || el contrato asi que de momento nada
     |FINSI;
     |SI nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
          |SI #contrato#32 = 0;  || si en estos no hay horas a TP
               swSigue = 0;      || usamos el campo ACTIVIDAD_SIN_FECHACIERTA
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          aAlfa = #contrato#32; |QBF aAlfa;
          |SI aAlfa ! "";
               nCalc = #contrato#32;
               |HAZ HorasTPCon;
               aAlfa = &09 + &09 + &09 + "<HORAS_JORNADA>" + aAlfa + "</HORAS_JORNADA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
          |SI nSwContrato = 200; |O nSwContrato = 230; |O nSwContrato = 250;
          |O nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
               |SI nSwContrato = 200;
                    aAlfa = #contrato#31; |QBF aAlfa;
               |SINO;
                    aAlfa = #contrato#29; |QBF aAlfa;
               |FINSI;
               |SI aProcedencia = "labcon51";
                    aAlfa = #contrato#30; |QBF aAlfa;
               |FINSI;
               nNume = aAlfa;
               |SI aAlfa ! "";
                    nCalc = nNume;
                    |HAZ HorasTPCon;
                    aAlfa = &09 + &09 + &09 + "<HORAS_CONVENIO>" + aAlfa + "</HORAS_CONVENIO>" + &13 + &10;
                    aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nSwContrato = 421;
          nCalc = #contrato#32 - #contrato#50;
          nCalc = (nCalc * 100) ! 0; aAlfa = nCalc;
          aAlfa = ("000000" + aAlfa) % -106;
          aAlfa = &09 + &09 + &09 + "<HORAS_FORMACION>" + aAlfa + "</HORAS_FORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
/*
          aAlfa = #contrato#87; |QBF aAlfa; |SI aAlfa = "S"; aAlfa1 = "08"; |FINSI;
          aAlfa = &09 + &09 + &09 + "<COLECTIVO_EDAD>" + aAlfa1 + "</COLECTIVO_EDAD>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
*/
     |FINSI;
     |SI nSwContrato = 540;
          |SI #contrato#53 = "X";
              nNume = #contrato#29 * 100;
              aAlfa = nNume; |QBF aAlfa;
              aAlfa = &09 + &09 + &09 + "<PORCENTAJE_JUBILACION_PARCIAL>" + aAlfa + "</PORCENTAJE_JUBILACION_PARCIAL>" + &13 + &10;
              aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
     |FINSI;
     |SI nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
          |SI #contrato#32 = 0;
               aAlfa = "S";
               aAlfa = &09 + &09 + &09 + "<ACTIVIDAD_SIN_FECHACIERTA>" + aAlfa + "</ACTIVIDAD_SIN_FECHACIERTA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
     |FINSI;
     |SI nSwContrato = 200; |O nSwContrato = 230; |O nSwContrato = 250;
     |O nSwContrato = 209; |O nSwContrato = 239; |O nSwContrato = 289;
          |SI #contrato#101 = "S";
               aAlfa = "S";
          |SINO;
               aAlfa = "N";
          |FINSI;
          aAlfa = &09 + &09 + &09 + "<FIJODISCONTINUO_PERIODICO>" + aAlfa + "</FIJODISCONTINUO_PERIODICO>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
     aAlfa = &09 + &09 + "</DATOS_CONTRATO_TIEMPO_PARCIAL>" + &13 + &10;
     aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO DatosETT;
     || DATOS_ETT

     |DBASS aBase;  |QBF aBase;
     aMas  = aBase + "laboral/def/labemett.mas";
     aFich = aBase + "laboral/fich/";
     |SI #labempre#68 = "S";
          |CARGA_DEF aMas, copiadef@;

          aAlfa = &09 + &09 + "<DATOS_ETT>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = "";
          |ABRE #500;
          #500#0 = #labcentr#0;
          #500#1 = #labcentr#1;
          |LEE 000#500=;
          |SI FSalida = 0;
               aAlfa = #500#5;
          |FINSI;
          |CIERRA #500;
          |QBF aAlfa;

          nNivel = 3;
          aEtiqueta = "IND_CTO_PLANTILLA";
          |SI aAlfa = "";
               aDato = "S";
               |HAZ Linea
          |SINO;
               nNivel = 3;
               aEtiqueta = "CIF_NIF_EMPRESA_USUARIA";
               aDato = #500#2;
               |HAZ Linea;

               nNivel = 3;
               aEtiqueta = "RAZON_SOCIAL_EMPRESA_USUARIA";
               aDato = #500#3;
               |HAZ Linea;

               aDato = #500#5;
               |QBF aDato;
               aLon = aDato % 0;
               nLon = aLon;
               |SI nLon = 11;
                    nNume = #500#4;
                    aAlfa = nNume;
                    |QBF aAlfa;
                    aAlfa = ("0000" + aAlfa) % -104;
                    aDato = aAlfa + aDato
                    aEtiqueta = "CUENTA_COTIZACION_EMPRESA_USUARIA";
                    |HAZ Linea;
               |SINO;
                    |SI nLon = 12;
                         aEtiqueta = "IND_EMPRESARIO_AUTONOMO";
                         aDato = "S";
                         |HAZ Linea;
                    |FINSI;
               |FINSI;
          |FINSI;

          aAlfa = &09 + &09 + "</DATOS_ETT>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          |DESCARGA_DEF #copiadef@;
     |FINSI;
|FPRC;

|PROCESO Cabecera_4_2013;
     aCabecera = &09 + &09 + "<DATOS_RDL_4_2013>" + &13 + &10;
     aCadena = aCabecera; |XGRABA nHandle, aCabecera;
     sw42013 = 1;
|FPRC;

|PROCESO DATOS_RDL_4_2013;
     || DATOS_RDL_4_2013
     |SI aProcedencia = "labcon52"; |O aProcedencia = "labcon53";
     |O aProcedencia = "labcon54"; |O aProcedencia = "labcon55";
     |O aProcedencia = "labcon36";
     |O nSwContrato = 100; |O nSwContrato = 200; |O nSwContrato = 300;
     |O nSwContrato = 402; |O nSwContrato = 420; |O nSwContrato = 501;
     |O nSwContrato = 502;

          sw42013 = 0;

          aAlfa = "";
          |SI aProcedencia = "labcon52"; aAlfa = "11"; |FINSI;
          |SI aProcedencia = "labcon53";
               |SI #contrato#83 = "X"; aAlfa = "12"; |FINSI;
               |SI #contrato#84 = "X"; aAlfa = "13"; |FINSI;
          |FINSI;
          |SI aProcedencia = "labcon55";
               |SI #contrato#65 = "X"; aAlfa = "08"; |FINSI;
               |SI #contrato#66 = "X"; aAlfa = "09"; |FINSI;
               |SI #contrato#67 = "X"; aAlfa = "10"; |FINSI;
          |FINSI;
          |SI aProcedencia = "labcon36";
               |SI #contrato#83 = "X"; aAlfa = "14"; |FINSI;
               |SI #contrato#84 = "X"; aAlfa = "15"; |FINSI;
          |FINSI;
          |SI aProcedencia = "labcon01";
               |SI #contrato#40 = "D";
                    |SI #contrato#69 = "S";
                         aAlfa = "19";
                    |FINSI;
               |FINSI;
          |FINSI;

          |QBF aAlfa;
          |SI aAlfa ! "";
               |SI sw42013 = 0; |HAZ Cabecera_4_2013; |FINSI;

               aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_REDUCCION>" + aAlfa + "</CODIGO_COLECTIVO_REDUCCION>";
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;

          |SI aProcedencia = "labcon55";
               |SI sw42013 = 0; |HAZ Cabecera_4_2013; |FINSI;
               aAlfa = &09 + &09 + &09 + "<DATOS_TPARC_VINC_FORM>";
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa1 = #contrato#75; |QBF aAlfa1;
               aAlfa2 = #contrato#76; |QBF aAlfa2;
               |SI aAlfa1 ! ""; aAlfa = "01"; |FINSI;
               |SI aAlfa2 ! ""; aAlfa = "02"; |FINSI;
               |SI aAlfa ! "";
                    aAlfa = &09 + &09 + &09 + "<VINCULACION_FORMATIVA>" + aAlfa + "</VINCULACION_FORMATIVA>";
                    aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;

               |SI #contrato#68 = "X";
                    aAlfa = "S";
                    aAlfa = &09 + &09 + &09 + "<FORMACION_DURANTE_EMPLEO>" + aAlfa + "</FORMACION_DURANTE_EMPLEO>";
                    aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;

               aAlfa = #contrato#91; |QBF aAlfa;
               |SI aAlfa ! "";
                    |SI aAlfa = "1"; aAlfa = "100"; |FINSI;
                    |SI aAlfa = "2"; aAlfa = "75"; |FINSI;
                    aAlfa = &09 + &09 + &09 + "<PORCENTAJE_REDUCCION>" + aAlfa + "</PORCENTAJE_REDUCCION>";
                    aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;

               aAlfa = &09 + &09 + &09 + "</DATOS_TPARC_VINC_FORM>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;

          |SI aProcedencia = "labconb7"; |Y #contrato#84 = "X";
               |SI sw42013 = 0; |HAZ Cabecera_4_2013; |FINSI;
               aAlfa = &09 + &09 + &09 + "<PRIMER_EMPLEO_JOVEN>" + "S" + "</PRIMER_EMPLEO_JOVEN>";
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;

          |SI aProcedencia = "labconb7"; |Y #contrato#84 = "X"; |Y nSwContrato = 502;
               |SI sw42013 = 0; |HAZ Cabecera_4_2013; |FINSI;
               nNume = (#contrato#32 / #contrato#31) * 1000;
               aAlfa = nNume; aAlfa = (aAlfa % 104);
               aAlfa = &09 + &09 + &09 + "<PORCENTAJE_JORNADA>" + aAlfa + "</PORCENTAJE_JORNADA>";
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;

          |SI aProcedencia = "labcon55";
               |SI #contrato#65 = "X"; |O #contrato#66 = "X"; |O #contrato#67 = "X";
                    |SI sw42013 = 0; |HAZ Cabecera_4_2013; |FINSI;
                    nNume = (#contrato#32 / #contrato#30) * 1000;
                    aAlfa = nNume; aAlfa = (aAlfa % 104);
                    aAlfa = &09 + &09 + &09 + "<PORCENTAJE_JORNADA>" + aAlfa + "</PORCENTAJE_JORNADA>";
                    aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
          |FINSI;
          |SI sw42013 = 1;
               aAlfa = &09 + &09 + "</DATOS_RDL_4_2013>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DATOS_RDL_1_2015;
     || DATOS_RDL_1_2015

     swSigue = 0;
     aCole = "";

     |SI aProcedencia = "labcon01"; |O aProcedencia = "labconb3";
          |SI #contrato#82 = "S";
               swSigue = 1;
               aCole = "20";
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          aAlfa = &09 + &09 + "<DATOS_RDL_1_2015>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_REDUCCION>" + aCole + "</CODIGO_COLECTIVO_REDUCCION>";
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + "</DATOS_RDL_1_2015>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
|FPRC;

|PROCESO DATOS_RDL_3_2014;
     || DATOS_RDL_3_2014

     swSigue = 0;
     aCole = "";

     |SI aProcedencia = "labcon01"; |Y #contrato#40 = " ";
          |SI #contrato#69 = "S";
               swSigue = 1;
               aCole = "18";
          |FINSI;
     |FINSI;

     |SI aProcedencia = "labcon01"; |Y #contrato#40 = "D";
          |SI #contrato#69 = "S";
               aCole = "19";
               swSigue = 1;
          |FINSI;
     |FINSI;

     |SI aProcedencia = "labcon51";
          |SI #contrato#69 = "S";
               swSigue = 1;
               aCole = "18";
          |FINSI;
     |FINSI;

     |SI aProcedencia = "labconb3";
          |SI #contrato#69 = "S";
               swSigue = 1;
               aCole = "18";
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          aAlfa = &09 + &09 + "<DATOS_RDL_3_2014>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_REDUCCION>" + aCole + "</CODIGO_COLECTIVO_REDUCCION>";
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + "</DATOS_RDL_3_2014>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
|FPRC;

|PROCESO DATOS_RDL_8_2014;
     || DATOS_RDL_8_2014

     swSigue = 0;

     |SI aProcedencia = "labcon01"; |Y #contrato#40 = "D";
          swSigue = 1;
     |FINSI;

     |SI aProcedencia = "labcon36"; |Y #contrato#86 = "S";
          swSigue = 1;
     |FINSI;

     |SI swSigue = 1;
          aAlfa = &09 + &09 + "<DATOS_RDL_8_2014>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + &09 + "<GARANTIA_JUVENIL>" + "S" + "</GARANTIA_JUVENIL>";
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + "</DATOS_RDL_8_2014>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;
|FPRC;

|PROCESO Linea;
     |QBF aDato;
     |SI aDato = "";
          |ACABA;
     |FINSI;

     |SI nNivel = 0; aAlfa = ""; |FINSI;
     |SI nNivel = 1; aAlfa = &09; |FINSI;
     |SI nNivel = 2; aAlfa = &09 + &09; |FINSI;
     |SI nNivel = 3; aAlfa = &09 + &09 + &09; |FINSI;
     |SI nNivel = 4; aAlfa = &09 + &09 + &09 + &09; |FINSI;
     |SI nNivel = 5; aAlfa = &09 + &09 + &09 + &09 + &09; |FINSI;

     aLinea = aAlfa + "<" + aEtiqueta + ">" + aDato + "</" + aEtiqueta + ">" + &13 + &10;
     aCadena = aLinea;
     |HAZ QuitaRaros;
     aLinea = aCadena;
     |XGRABA nHandle, aLinea;
|FPRC;

|PROCESO Contrato;
   nSwContrato = #labregis#4;

   aAlfa = ("000" + nSwContrato) % -103;
   |ABRE #nomequiv;
   #nomequiv#0 = aAlfa;
   |LEE 000#nomequiv.=;
   |SI FSalida = 0;
      nSwContrato = #nomequiv#1;
      |SI aProcedencia = "labcon01"; |O aProcedencia = "labcon36";
       |O aProcedencia = "labcon75"; |O aProcedencia = "labconb7";
       |O aProcedencia = "labconb3"; |O aProcedencia = "labcona5";
       |O aProcedencia = "labconx4"; |O aProcedencia = "labconb8";
          |SI #contrato#28 = "P";
             nSwContrato = #nomequiv#2;
          |SINO;
             nSwContrato = #nomequiv#1;
          |FINSI;
      |FINSI;
      |SI aProcedencia = "labcon95"; |O aProcedencia = "labcon39";
       |O aProcedencia = "labcon99"; |O aProcedencia = "labcon9a";
          |SI #contrato#27 = "P";
             nSwContrato = #nomequiv#2;
          |SINO;
             nSwContrato = #nomequiv#1;
          |FINSI;
      |FINSI;
      |SI aProcedencia = "labconb5"; |O aProcedencia = "labcon09";
          |SI #contrato#64 = "P";
             nSwContrato = #nomequiv#2;
          |SINO;
             nSwContrato = #nomequiv#1;
          |FINSI;
      |FINSI;
      |SI aProcedencia = "labcona6";
          |SI #contrato#76 = "P";
             nSwContrato = #nomequiv#2;
          |SINO;
             nSwContrato = #nomequiv#1;
          |FINSI;
      |FINSI;
      |SI aProcedencia = "labcon05";
          |SI #contrato#56 = "P";
             nSwContrato = #nomequiv#2;
          |SINO;
             nSwContrato = #nomequiv#1;
          |FINSI;
      |FINSI;
      |SI aProcedencia = "labconb1";
          nSwContrato = #nomequiv#1;
      |FINSI;
      |SI aProcedencia = "labconb2";
          nSwContrato = #nomequiv#2;
      |FINSI;
   |FINSI;
   |CIERRA #nomequiv;

   aExclu = "";
   |SI nSwContrato = 551; |O nSwContrato = 451;
      |SI #contrato#29 = "1";
         |SI #contrato#27 = "C"; aExclu = "401"; |FINSI;
         |SI #contrato#27 = "P"; aExclu = "501"; |FINSI;
      |FINSI;
      |SI #contrato#29 = "2";
         |SI #contrato#27 = "C"; aExclu = "402"; |FINSI;
         |SI #contrato#27 = "P"; aExclu = "502"; |FINSI;
      |FINSI;
      |SI #contrato#29 = "3";
         |SI #contrato#27 = "C"; aExclu = "410"; |FINSI;
         |SI #contrato#27 = "P"; aExclu = "510"; |FINSI;
      |FINSI;
      |SI #contrato#29 = "4";
         |SI #contrato#27 = "C"; aExclu = "420"; |FINSI;
         |SI #contrato#27 = "P"; aExclu = "520"; |FINSI;
      |FINSI;
      |SI #contrato#29 = "5"; aExclu = "421"; |FINSI;
      |SI #contrato#29 = "6"; aExclu = "990"; |FINSI;
      |SI aProcedencia = "labcon95";
         |SI nSwContrato = 451; nSwContrato = 450; |FINSI;
         |SI nSwContrato = 551; nSwContrato = 550; |FINSI;
      |FINSI;
   |FINSI;

     |DFICE aOrigen;
     aDestino = "C:/DOCUMENTOS/Contrat@/"; |RMKDIR aDestino;
     aAlfa1 = eaNumProrr; |QBF aAlfa1;
     |SI nSwTrans = 0;
          aAlfa2 = "co" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa1) % -102) + ".txt";
     |SINO;
          aAlfa2 = "tr" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa1) % -102) + ".txt";
     |FINSI;
     aOrigen = aOrigen + aAlfa2;
     aDestino = aDestino + aAlfa2;
     aAlfa = aOrigen;

/*
   aAlfa = "C:/DOCUMENTOS/Contrat@/"; |RMKDIR aAlfa;
   aAlfa = eaNumProrr; |QBF aAlfa;
   |SI nSwTrans = 0;
      aAlfa = "C:/DOCUMENTOS/Contrat@/co" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa) % -102) + ".txt";
   |SINO;
      aAlfa = "C:/DOCUMENTOS/Contrat@/tr" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa) % -102) + ".txt";
   |FINSI;
*/
   |ABRE #labvaltb;
   ||XABRE "CBW", aAlfa, nHandle;
   |XABRE "A", aAlfa, nHandle;
   |SI FSalida ] 0;
      swSigue = 0;
      |SI swNetContrata = 1;
      |Y swNetContrataMas = 0;
           swSigue = 1;
      |FINSI;
      |SI swNetContEmi = 1;
           swSigue = 1;
      |FINSI;
      |SI swSigue = 1;
          || si estoy en Netcontrata, como solo voy a grabar un contrato, voy
          || a grabar ya directamente la cabecera del contrato, para luego
          || en el labimpre, cuando crea el xml incluyendo la cabecera,
          || no tener que volver a leer el txt linea a linea y volver a
          || grabar el fichero

          || Lo del swNetContrataMas = 0 es porque ya se ha incorporado la
          || opcion de emision masiva de contratos a netcontrata
          || en ese caso no me tiene que guardar cabecera, la pondra despues
          || al unirlos

          aAlfa = "<?xml version=" + &34 + "1.0" + &34 + " encoding=" + &34 + "ISO-8859-1" + &34 + "?>" + &13 + &10;
          |XGRABA nHandle, aAlfa;
          |SI nSwTrans = 0;
               aAlfa = "<CONTRATOS>" + &13 + &10;
          |SINO;
               aAlfa = "<TRANSFORMACIONES>" + &13 + &10;
          |FINSI;
          |XGRABA nHandle, aAlfa;
      |FINSI;

      |SI nSwTrans = 0;
         |SI nSwContrato ! 451; |Y nSwContrato ! 551;
            |SI aProcedencia = "labcon39";
               |SI #labregis#4 = 431; |O #labregis#4 = 531;
                  |SI #labregis#4 = 431;
                     |SI #contrato#29 = 1; nCalc = 401; |FINSI;
                     |SI #contrato#29 = 2; nCalc = 402; |FINSI;
                     |SI #contrato#29 = 3; nCalc = 410; |FINSI;
                     |SI #contrato#29 = 4; nCalc = 430; |FINSI;
                     |SI #contrato#29 = 5; nCalc = 420; |FINSI;
                     |SI #contrato#29 = 6; nCalc = 421; |FINSI;
                     |SI #contrato#29 = 7; nCalc = 990; |FINSI;
                  |FINSI;
                  |SI #labregis#4 = 531;
                     |SI #contrato#29 = 1; nCalc = 501; |FINSI;
                     |SI #contrato#29 = 2; nCalc = 502; |FINSI;
                     |SI #contrato#29 = 3; nCalc = 510; |FINSI;
                     |SI #contrato#29 = 4; nCalc = 530; |FINSI;
                     |SI #contrato#29 = 5; nCalc = 520; |FINSI;
                     |SI #contrato#29 = 7; nCalc = 990; |FINSI;
                  |FINSI;
                  aAlfa = &09 + "<CONTRATO_" + nCalc + ">" + &13 + &10;
                  nAntContrato = nCalc;
                  nSwContrato = nCalc;
               |SINO;
                  nCalc = nSwContrato + 19;
                  aAlfa = &09 + "<CONTRATO_" + nCalc + ">" + &13 + &10;
                  nAntContrato = nCalc;
               |FINSI;
            |SINO;
               aAlfa = &09 + "<CONTRATO_" + nSwContrato + ">" + &13 + &10;
               nAntContrato = nSwContrato;
            |FINSI;
         |SINO;
            nCalc = nSwContrato - 1;
            aAlfa = &09 + "<CONTRATO_" + nCalc + ">" + &13 + &10;
            nAntContrato = nCalc;
         |FINSI;
      |SINO;
         |SI nSwContrato ! 451; |Y nSwContrato ! 551;
            aAlfa = &09 + "<TRANSFORMACION_" + nSwContrato + ">" + &13 + &10;
            nAntContrato = nSwContrato;
         |SINO;
            nCalc = nSwContrato - 1;
            aAlfa = &09 + "<TRANSFORMACION_" + nCalc + ">" + &13 + &10;
            nAntContrato = nCalc;
         |FINSI;
      |FINSI;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      |SI nSwContrato = 451; |O nSwContrato = 551; nSwContrato = aExclu; |FINSI;

      || DATOS EMPRESA

      nSw = 0;
      aAlfa = #labempre#10; |QBF aAlfa;
      |SI aAlfa ! ""; nSw = 1; |FINSI;
      aAlfa = #nomregim#0; |QBF aAlfa; aAlfa = ("0000" + aAlfa) % -104;
      aAlfa = aAlfa + aCodCCC; |QBF aAlfa;
      |SI aAlfa ! ""; nSw = 1; |FINSI;
      |SI nSw ! 0;
         aAlfa = &09 + &09 + "<DATOS_EMPRESA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = #labempre#10; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<CIF_NIF_EMPRESA>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa = #labempre#10; |QBF aAlfa;
            aAlfa = &09 + &09 + &09 + &09 + "<CIF_NIF>" + aAlfa + "</CIF_NIF>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa = &09 + &09 + &09 + "</CIF_NIF_EMPRESA>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = ("0000" + #nomregim#0) % -104; |QBF aAlfa;
         aAlfa = aAlfa + aCodCCC;               |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<CODIGO_CUENTA_COTIZACION>" + aAlfa + "</CODIGO_CUENTA_COTIZACION>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         |HAZ NetcontrataEmp;

         aAlfa = &09 + &09 + "</DATOS_EMPRESA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

      || DATOS TRABAJADOR

      |SI nSwTrans = 0;
         aAlfa = &09 + &09 + "<DATOS_TRABAJADOR>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

/*
          || si se activa, que sea solo cuando viene de crear el XML
          || para ConectaSS, no cuando se hace para Contrat@, que aun
          || hay gente que lo usa

          aAlfa1 = #labtraba#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
          aAlfa2 = #labtraba#1; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;
          aAlfa = aAlfa1 + "." + aAlfa2;
          aAlfa = &9 + &9 + &9 + "<USOLIBRE_EMPRESA>" + aAlfa;
          |QBF aAlfa;
          aAlfa = aAlfa + "</USOLIBRE_EMPRESA>" + &13 + &10;
          |XGRABA nHandle, aAlfa;
*/
         aAlfa = #labtraba#7; |QBF aAlfa;
         aAlfa1 = aAlfa % 0101;
         |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9";
            aAlfa = "D" + aAlfa;
         |SINO;
            |SI aAlfa1 = "X"; |O aAlfa1 = "Y"; |O aAlfa1 = "Z";
               aAlfa = "E" + aAlfa;
            |SINO;
               aAlfa1 = #labtraba#76; |QBF aAlfa1;
               aAlfa2 = aAlfa1 % 0599; aAlfa1 = aAlfa1 % 0103;
               |SI aAlfa1 = "ESP"; |O aAlfa1 = "724"; |O aAlfa1 = "250";
                |O aAlfa1 = "276"; |O aAlfa1 = "056"; |O aAlfa1 = "442";
                |O aAlfa1 = "380"; |O aAlfa1 = "208"; |O aAlfa1 = "372";
                |O aAlfa1 = "826"; |O aAlfa1 = "300"; |O aAlfa1 = "620";
                |O aAlfa1 = "040"; |O aAlfa1 = "246"; |O aAlfa1 = "752";
                |O aAlfa1 = "233"; |O aAlfa1 = "428"; |O aAlfa1 = "440";
                |O aAlfa1 = "616"; |O aAlfa1 = "203"; |O aAlfa1 = "703";
                |O aAlfa1 = "705"; |O aAlfa1 = "348"; |O aAlfa1 = "470";
                |O aAlfa1 = "196"; |O aAlfa2 = "HOLANDA";
                  aAlfa = "U" + aAlfa;
               |SINO;
                  aAlfa = "W" + aAlfa;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<IDENTIFICADORPFISICA>" + aAlfa + "</IDENTIFICADORPFISICA>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aCadena = #labtraba#2; |HAZ SeparaNom_plb;
         aAlfa = &09 + &09 + &09 + "<NOMBRE_APELLIDOS>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |SI eaNom ! "";
            eaNom = eaNom % 115;
            aAlfa = &09 + &09 + &09 + &09 + "<NOMBRE>" + eaNom + "</NOMBRE>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI eaApel1 ! "";
            aAlfa = &09 + &09 + &09 + &09 + "<PRIMER_APELLIDO>" + eaApel1 + "</PRIMER_APELLIDO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI eaApel2 ! "";
            aAlfa = &09 + &09 + &09 + &09 + "<SEGUNDO_APELLIDO>" + eaApel2 + "</SEGUNDO_APELLIDO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = &09 + &09 + &09 + "</NOMBRE_APELLIDOS>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = #labpadre#5; |QBF aAlfa;
         |SI aAlfa = "V"; aAlfa = "1"; |FINSI;
         |SI aAlfa = "M"; aAlfa = "2"; |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<SEXO>" + aAlfa + "</SEXO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = #labtraba#11; |QBF aAlfa; aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<FECHA_NACIMIENTO>" + aAlfa + "</FECHA_NACIMIENTO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = #labtraba#76; |QBF aAlfa;
         aAlfa1 = aAlfa % 0599; aAlfa = aAlfa % 0103;
         |SI aAlfa = "ESP";                   aAlfa = "724"; |FINSI;
         |SI aAlfa < "000"; |O aAlfa > "999"; aAlfa = "724"; |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<NACIONALIDAD>" + aAlfa + "</NACIONALIDAD>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa1 = #labtraba#8; |QBF aAlfa1;
         aAlfa1 = ("00" + aAlfa1) % -102;
         aAlfa2 = #labtraba#9;
         aAlfa2 = ("000" + aAlfa2) % -103;
         aAlfa = aAlfa1 + aAlfa2;
         aCodPos = aAlfa1 + aAlfa2;
         |HAZ CodigoMuni;
         |SI nContMuni = 0;
            aAlfa = "";
         |SINO;
            aAlfa = aCodMuni;
         |FINSI;

         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<MUNICIPIO_RESIDENCIA>" + aAlfa + "</MUNICIPIO_RESIDENCIA>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = &09 + &09 + &09 + "<PAIS_RESIDENCIA>724</PAIS_RESIDENCIA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = #labtraba#75; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<NUMERO_SEGURIDAD_SOCIAL>" + aAlfa + "</NUMERO_SEGURIDAD_SOCIAL>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         |HAZ NetcontrataTra;

         aAlfa = &09 + &09 + "</DATOS_TRABAJADOR>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

         || DATOS_GENERALES_CONTRATO

         aAlfa = &09 + &09 + "<DATOS_GENERALES_CONTRATO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

         aAlfa = fFechaIni; |QBF aAlfa;
         |SI aAlfa ! ""; |Y aAlfa ! "..........";
            aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
            aAlfa = &09 + &09 + &09 + "<FECHA_INICIO>" + aAlfa + "</FECHA_INICIO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = fFechaFin; |QBF aAlfa;
         |SI aAlfa ! "00.00.0000"; |Y aAlfa ! "31.12.9999";
            aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
            |SI aAlfa ! ""; |Y aAlfa ! ".";
               aAlfa = &09 + &09 + &09 + "<FECHA_TERMINO>" + aAlfa + "</FECHA_TERMINO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |SINO;
            |SI aAlfa = "31.12.9999";
               aAlfa = &09 + &09 + &09 + "<FECHA_TERMINO>HASTA FINAL DE LAS OBRAS</FECHA_TERMINO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;
         |SI nSwContrato = 402; |O nSwContrato = 502;
          |O nSwContrato = 421; |O nSwContrato = 521;
            |SI nSwContrato = 421;
               |SI #contrato#54 = "X";
                  aAlfa = #contrato#80; |QBF aAlfa;
               |SINO;
                  aAlfa = "";           |QBF aAlfa;
               |FINSI;
            |SINO;
               aAlfa = #nomconca#142; |QBF aAlfa;
               |SI aAlfa ! ""; aAlfa = "S"; |SINO; aAlfa = "N"; |FINSI;
            |FINSI;
            |SI aAlfa ! "";
               aAlfa = &09 + &09 + &09 + "<IND_CONVENIO_COLECTIVO>" + aAlfa + "</IND_CONVENIO_COLECTIVO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;

         |DDEFECTO #labvaltb;
         #labvaltb#0 = "labtraba";
         #labvaltb#1 = 73;
         #labvaltb#5 = #labtraba#0;
         #labvaltb#6 = #labtraba#1;
         |LEE 000#labvaltb.=;
         |SI FSalida = 0;
            aAlfa = #labvaltb#4;
         |SINO;
            aAlfa = #labtraba#73;
         |FINSI;
         |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<NIVEL_FORMATIVO>" + aAlfa + "</NIVEL_FORMATIVO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI aProcedencia = "labcon39"; aSwMinus = "C"; |FINSI;
         aAlfa = aSwMinus; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<IND_DISCAPACIDAD>" + aSwMinus + "</IND_DISCAPACIDAD>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
/*
         |DDEFECTO #labvaltb;
         #labvaltb#0 = "labtraba";
         #labvaltb#1 = 19;
         #labvaltb#5 = #labtraba#0;
         #labvaltb#6 = #labtraba#1;
         |LEE 000#labvaltb.=;
         |SI FSalida = 0;
            aAlfa = #labvaltb#4;
         |SINO;
            aAlfa = #labtraba#19;
         |FINSI;

         || primero busco en la tabla nueva, si no encuentro nada en la antigua
         |ABRE #taiclaoc; |SELECT #2#taiclaoc;
         #taiclaoc#1 = aAlfa;
         |LEE 000#taiclaoc.=;
         |SI FSalida ! 0; |DDEFECTO #taiclaoc; |FINSI;
         |SELECT #1#taiclaoc; |CIERRA #taiclaoc;
         aAlfa = #taiclaoc#0; |QBF aAlfa;
         |SI aAlfa = "";
             |ABRE #socupatc; |SELECT #2#socupatc;
             #socupatc#1 = aAlfa;
             |LEE 000#socupatc.=;
             |SI FSalida ! 0; |DDEFECTO #socupatc; |FINSI;
             |SELECT #1#socupatc; |CIERRA #socupatc;
             aAlfa = #socupatc#0; |QBF aAlfa;
         |FINSI;
*/
         aAlfa = #labtraba#185;
         aAlfa = aAlfa % 104;
         aAlfa = aAlfa + "    ";
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<CODIGO_OCUPACION>" + aAlfa + "</CODIGO_OCUPACION>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
/*
   No se incorpora al fichero este dato porque nuestro programa no se guarda
   esto en ningun sitio.

         aAlfa = ("0000" + #nomregim#0) % -104; |QBF aAlfa;
         aAlfa = aAlfa + aCodCCC;               |QBF aAlfa;
         aAlfa = &09 + &09 + &09 + "<ID_OFERTA>" + aAlfa + "</ID_OFERTA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
*/
         |SI nSwContrato = 403; |O nSwContrato = 503;
            aAlfa = #contrato#28; |QBF aAlfa;
            |SI aAlfa = "C"; aAlfa = "02"; |FINSI;
            |SI aAlfa = "O"; aAlfa = "03"; |FINSI;
            |SI aAlfa = "A"; aAlfa = "04"; |FINSI;
            |SI aAlfa = "E"; aAlfa = "05"; |FINSI;
            |SI aAlfa = "U"; aAlfa = "06"; |FINSI;
            |SI aAlfa ! "";
               aAlfa = &09 + &09 + &09 + "<CODIGOPROGRAMAEMPLEO>" + aAlfa + "</CODIGOPROGRAMAEMPLEO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;
         aAlfa = aPaisCentro;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<NACIONALIDAD_CT>" + aAlfa + "</NACIONALIDAD_CT>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         |ABRE #labcentr;
         #labcentr#0 = #labtraba#0;
         #labcentr#1 = #labtraba#77;
         |LEE 000#labcentr.=;
         |SI FSalida ! 0; |DDEFECTO #labcentr; |FINSI;
         |CIERRA #labcentr;

         aAlfa1 = #labcentr#7;    aAlfa1 = ("00" + aAlfa1) % -102;
         aAlfa = #labcentr#8;     aAlfa = ("000" + aAlfa) % -103;
         aCodPos = aAlfa1 + aAlfa;
         |HAZ CodigoMuni;
         |SI nContMuni = 0;
            aAlfa = "";
         |SINO;
            aAlfa = aCodMuni;
         |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<MUNICIPIO_CT>" + aAlfa + "</MUNICIPIO_CT>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         |SI aProcedencia = "labconx4";
            aAlfa = #contrato#51;
            aAlfa = &09 + &09 + &09 + "<TEMPORAL_MINUSV_BONIFICADO>" + aAlfa + "</TEMPORAL_MINUSV_BONIFICADO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa = "";
         |SI aProcedencia = "labcon36"; |Y #contrato#90 = "S";
            aAlfa = "S";
         |FINSI;
         |SI aProcedencia = "labcon51"; |Y #contrato#84 = "S";
            aAlfa = "S";
         |FINSI;
         |SI aAlfa = "S";
            aAlfa = &09 + &09 + &09 + "<PROGRAMA_ACTIVACION_EMPLEO>" + aAlfa + "</PROGRAMA_ACTIVACION_EMPLEO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa = &09 + &09 + "</DATOS_GENERALES_CONTRATO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |SINO;
         aAlfa = &09 + &09 + "<DATOS_CONTRATO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

         aAlfa = #contrato#56;
         |QBF aAlfa;
         |SI aAlfa = "";
              aAlfa = #labregis#14;
              |QBF aAlfa;
         |FINSI;
         |SI aAlfa ! "";
            || uso identificador de contrato
            aAlfa = aAlfa - "-"; aAlfa = aAlfa - "-"; aAlfa = aAlfa - "-";
            aAlfa = aAlfa % 114;
            aAlfa = &09 + &09 + &09 + "<CLAVE_CONTRATO>" + aAlfa + "</CLAVE_CONTRATO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |SINO;
            aAlfa = #labtraba#7; |QBF aAlfa;
            aAlfa1 = aAlfa % 0101;
            |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9";
               aAlfa = "D" + aAlfa;
            |SINO;
               |SI aAlfa1 = "X"; |O aAlfa1 = "Y"; |O aAlfa1 = "Z";
                  aAlfa = "E" + aAlfa;
               |SINO;
                  aAlfa1 = #labtraba#76; |QBF aAlfa1;
                  aAlfa2 = aAlfa1 % 0599; aAlfa1 = aAlfa1 % 0103;
                  |SI aAlfa1 = "ESP"; |O aAlfa1 = "724"; |O aAlfa1 = "250";
                   |O aAlfa1 = "276"; |O aAlfa1 = "056"; |O aAlfa1 = "442";
                   |O aAlfa1 = "380"; |O aAlfa1 = "208"; |O aAlfa1 = "372";
                   |O aAlfa1 = "826"; |O aAlfa1 = "300"; |O aAlfa1 = "620";
                   |O aAlfa1 = "040"; |O aAlfa1 = "246"; |O aAlfa1 = "752";
                   |O aAlfa1 = "233"; |O aAlfa1 = "428"; |O aAlfa1 = "440";
                   |O aAlfa1 = "616"; |O aAlfa1 = "203"; |O aAlfa1 = "703";
                   |O aAlfa1 = "705"; |O aAlfa1 = "348"; |O aAlfa1 = "470";
                   |O aAlfa1 = "196"; |O aAlfa2 = "HOLANDA";
                     aAlfa = "U" + aAlfa;
                  |SINO;
                     aAlfa = "W" + aAlfa;
                  |FINSI;
               |FINSI;
            |FINSI;
            |SI aAlfa ! "";
               aAlfa = &09 + &09 + &09 + "<IDENTIFICADORPFISICA>" + aAlfa + "</IDENTIFICADORPFISICA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
            aAlfa = fFechaIniCto; |QBF aAlfa;
            |SI aAlfa ! ""; |Y aAlfa ! "..........";
               aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
               aAlfa = &09 + &09 + &09 + "<FECHA_INICIO_CTO>" + aAlfa + "</FECHA_INICIO_CTO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;
         aAlfa = &09 + &09 + "</DATOS_CONTRATO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

         aAlfa = &09 + &09 + "<DATOS_GENERALES_TRANSFORMACION>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = fFechaIni; |QBF aAlfa;
         |SI aAlfa ! ""; |Y aAlfa ! "..........";
            aAlfa = (aAlfa % 0704) +  (aAlfa % 0402) + (aAlfa % 0102);
            aAlfa = &09 + &09 + &09 + "<FECHA_INICIO>" + aAlfa + "</FECHA_INICIO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |SINO;
            aAlfa1 = #labtraba#0; aAlfa1 = ("00000" + aAlfa1) % -105;
            aAlfa2 = #labtraba#1; aAlfa1 = ("00000" + aAlfa2) % -105;
            aAlfa = aAlfa1 + "." + aAlfa2;
            aAlfa = "    ATENCION: trabajador " + aAlfa;
            |MENAV aAlfa;
            aAlfa = "    Es necesario indicar la fecha de inicio de la transformación";
            |MENAV aAlfa;
         |FINSI;

         |DDEFECTO #labvaltb;
         #labvaltb#0 = "labtraba";
         #labvaltb#1 = 19;
         #labvaltb#5 = #labtraba#0;
         #labvaltb#6 = #labtraba#1;
         |LEE 000#labvaltb.=;
         |SI FSalida = 0;
            aAlfa = #labvaltb#4;
         |SINO;
            aAlfa = #labtraba#19;
         |FINSI;

         || primero busco en la tabla nueva, si no encuentro nada en la antigua
         |ABRE #taiclaoc; |SELECT #2#taiclaoc;
         #taiclaoc#1 = aAlfa;
         |LEE 000#taiclaoc.=;
         |SI FSalida ! 0; |DDEFECTO #taiclaoc; |FINSI;
         |SELECT #1#taiclaoc; |CIERRA #taiclaoc;
         aAlfa = #taiclaoc#0; |QBF aAlfa;
         |SI aAlfa = "";
             |ABRE #socupatc; |SELECT #2#socupatc;
             #socupatc#1 = aAlfa;
             |LEE 000#socupatc.=;
             |SI FSalida ! 0; |DDEFECTO #socupatc; |FINSI;
             |SELECT #1#socupatc; |CIERRA #socupatc;
             aAlfa = #socupatc#0; |QBF aAlfa;
         |FINSI;

         aAlfa = aAlfa % 104;
         aAlfa = aAlfa + "    ";

         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<CODIGO_OCUPACION>" + aAlfa + "</CODIGO_OCUPACION>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = &09 + &09 + &09 + "<NACIONALIDAD_CT>724</NACIONALIDAD_CT>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

         |ABRE #labcentr;
         #labcentr#0 = #labtraba#0;
         #labcentr#1 = #labtraba#77;
         |LEE 000#labcentr.=;
         |SI FSalida ! 0; |DDEFECTO #labcentr; |FINSI;
         |CIERRA #labcentr;

         aAlfa1 = #labcentr#7;    aAlfa1 = ("00" + aAlfa1) % -102;
         aAlfa = #labcentr#8;     aAlfa = ("000" + aAlfa) % -103;
         aCodPos = aAlfa1 + aAlfa;
         |HAZ CodigoMuni;
         |SI nContMuni = 0;
            aAlfa = "";
         |SINO;
            aAlfa = aCodMuni;
         |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<MUNICIPIO_CT>" + aAlfa + "</MUNICIPIO_CT>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = &09 + &09 + "</DATOS_GENERALES_TRANSFORMACION>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

     || si es un contrato 402 0 990 de menos de 28 dias, si el contrato
     || es NO ESCRITO, no hay que hacer copia basica. Hay que indicar si
     || el contrato es escrito o NO escrito

      |SI nSwContrato = 990; |O nSwContrato = 402;
         |SI fFechaFin ! "00.00.0000"; |Y fFechaIni ! "00.00.0000";
            nCalc = fFechaFin; nCalc = nCalc - fFechaIni;
            |SI nCalc [ 28;
               aValor = #contrato#87;
               aAlfa = &09 + &09 + "<DATOS_COPIA_BASICA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               aAlfa = &09 + &09 + &09 + "<IND_CONTRATO_ESCRITO>" + aValor + "</IND_CONTRATO_ESCRITO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               aAlfa = &09 + &09 + "</DATOS_COPIA_BASICA>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;
      |FINSI;

      |SI aExclu ! "";
         aAlfa = &09 + &09 + "<DATOS_EXCLUSION_SOCIAL>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = &09 + &09 + &09 + "<MODALIDAD_EXCLUSION>" + aExclu + "</MODALIDAD_EXCLUSION>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = &09 + &09 + "</DATOS_EXCLUSION_SOCIAL>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

      || DATOS_CONTRATO_TIEMPO_PARCIAL

      |HAZ DatosContratoTP;

     || DATOS_ETT

     |HAZ DatosETT;

      || DATOS_BONIFICACION

      |SI nSwTrans ! 0;
         |SI aProcedencia = "labcona5"; |O aProcedencia = "labcona5"; aAlfa = #contrato#76; |FINSI;
         |SI aProcedencia = "labcona6";
            aAlfa = "N";
            |SI #contrato#57 = "2"; aAlfa = "S"; |FINSI;
         |FINSI;
         |SI aAlfa = "S";
            aAlfa = &09 + &09 + "<DATOS_BONIFICACION>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa = &09 + &09 + &09 + "<ACOGIDO_MATERNIDAD_EXCEDENCIA>S</ACOGIDO_MATERNIDAD_EXCEDENCIA>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa = &09 + &09 + "</DATOS_BONIFICACION>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |SINO;
         swSigue = 0;
         |SI nSwContrato = 150; |O nSwContrato = 250;
         |O nSwContrato = 350; |O nSwContrato = 450; |O nSwContrato = 550;
         |O nSwContrato = 430;         || discapacidad, temporales
         |O aProcedencia = "labcon09"; || discapacidad, indefinidos
               swSigue = 1;
         |FINSI;
         |SI aProcedencia = "labcon51"; |Y #contrato#78 = "S";
               swSigue = 1;
         |FINSI;
         |SI swSigue = 1;
            aAlfa = &09 + &09 + "<DATOS_BONIFICACION>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa1 = "";
            |SI nSwContrato = 150; |O nSwContrato = 250; aAlfa = #contrato#57; aAlfa1 = #contrato#58; |FINSI;
            |SI nSwContrato = 350;
                 aAlfa = #contrato#79;
                 aAlfa2 = #contrato#57;
                 aAlfa3 = #contrato#58;
                 aAlfa1 = aAlfa2 + aAlfa3;
            |FINSI;
            |SI nSwContrato = 450;
                 aAlfa1 = #contrato#69;
            |FINSI;
            |SI aAlfa = "T"; aAlfa = "1"; |FINSI;
            |SI aAlfa = "E"; aAlfa = "2"; |FINSI;

            |SI aAlfa1 = "a"; aAlfa1 = "58"; |FINSI;
            |SI aAlfa1 = "b"; aAlfa1 = "50"; |FINSI;
            |SI aAlfa1 = "c"; aAlfa1 = "55"; |FINSI;
            |SI aAlfa1 = "d"; aAlfa1 = "56"; |FINSI;
            |SI aAlfa1 = "e"; aAlfa1 = "57"; |FINSI;
            |SI aAlfa1 = "f"; aAlfa1 = "24"; |FINSI;
            |SI nSwContrato = 450;
                 |SI aAlfa1 = "d"; aAlfa1 = "57"; |FINSI;
                 |SI aAlfa1 = "e"; aAlfa1 = "24"; |FINSI;
            |FINSI;
            |SI nSwContrato = 350;
                 |SI aAlfa1 ! "";
                    |SI aAlfa1 = "X ";  || entre 16 y 30
                       |SI #contrato#59 = "X";    || hombres
                          aAlfa1 = "153";
                       |FINSI;
                       |SI #contrato#64 = "X";    || mujeres
                          aAlfa1 = "154";
                       |FINSI;
                    |FINSI;
                    |SI aAlfa1 = " X";  || entre 45
                       |SI #contrato#59 = "X";    || hombres
                          aAlfa1 = "155";
                       |FINSI;
                       |SI #contrato#64 = "X";    || mujeres
                          aAlfa1 = "156";
                       |FINSI;
                    |FINSI;
                 |FINSI;
            |FINSI;
            |SI aProcedencia = "labcon51";
                    |SI #contrato#59 = "X";
                         aAlfa1 = 157;
                    |FINSI;
                    |SI #contrato#64 = "X";
                         aAlfa1 = 158;
                    |FINSI;
                    |SI #contrato#89 = "X";
                         aAlfa1 = 159;
                    |FINSI;
                    |SI #contrato#90 = "X";
                         aAlfa1 = 160;
                    |FINSI;
            |FINSI;

            |SI aAlfa1 ! "";
               aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_BONIF>" + aAlfa1 + "</CODIGO_COLECTIVO_BONIF>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;

            aAlfa = &09 + &09 + "</DATOS_BONIFICACION>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |FINSI;

      || DATOS_CONTRATO_PRACTICAS

      |SI nSwContrato = 420; |O nSwContrato = 520;
      |O aExclu = 420; |O aExclu = 520;
         aAlfa = &09 + &09 + "<DATOSCONTRATOPRACTICAS>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |DDEFECTO #labvaltb;
         #labvaltb#0 = "labtraba";
         #labvaltb#1 = 12;
         #labvaltb#5 = #labtraba#0;
         #labvaltb#6 = #labtraba#1;
         |LEE 000#labvaltb.=;
         |SI FSalida = 0;
            aAlfa = #labvaltb#4;
         |SINO;
            aAlfa = #labtraba#12;
         |FINSI;
         |QBF aAlfa;

/*
         |ABRE #stiacatc; |SELECT #2#stiacatc;
         #stiacatc#1 = aAlfa;
         |LEE 000#stiacatc.=;
         |SI FSalida ! 0; |DDEFECTO #stiacatc; |FINSI;
         |SELECT #1#stiacatc; |CIERRA #stiacatc;
         aAlfa = #stiacatc#0; |QBF aAlfa;
*/

         |ABRE #thitiaca; |SELECT #2#thitiaca;
         #thitiaca#1 = aAlfa;
         |LEE 000#thitiaca.=;
         |SI FSalida ! 0; |DDEFECTO #thitiaca; |FINSI;
         |SELECT #1#thitiaca; |CIERRA #thitiaca;
         aAlfa = #thitiaca#0; |QBF aAlfa;

         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<TITULACION_ACADEMICA>" + aAlfa + "</TITULACION_ACADEMICA>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa = #labtraba#73;
         nNume = aAlfa;
         |SI nNume < 33;
              aAlfa = #contrato#80; |QBF aAlfa;
              aAlfa = &09 + &09 + &09 + "<IND_CERTIF_PROFESIONALIDAD>" + aAlfa + "</IND_CERTIF_PROFESIONALIDAD>"  + &13 + &10;
              aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa = &09 + &09 + "</DATOSCONTRATOPRACTICAS>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

      || DATOS_MEDIDAS_FOMENTO

      swSigue = 0;
      |SI nSwContrato = 100; |O nSwContrato = 130; |O nSwContrato = 200;
       |O nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
       |O nSwContrato = 150; |O nSwContrato = 109; |O nSwContrato = 139;
       |O nSwContrato = 239;
         swSigue = 1;
         |SI nLey122001 ! 1;
           swSigue = 0;
         |FINSI;
      |FINSI;
      |SI swSigue = 1;
         aAlfa = &09 + &09 + "<DATOS_MEDIDAS_FOMENTO>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |SI nLey122001 = 1; aAlfa = 1; |SINO; aAlfa = 2; |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<IND_COSTE_DESPIDO>" + aAlfa + "</IND_COSTE_DESPIDO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI nLey122001 = 1; |Y nSwContrato ! 130;  |Y nSwContrato ! 230;
          |Y nSwContrato ! 330;
            |SI aProcedencia = "labcon01"; |O aProcedencia = "labcon95";
            |O  aProcedencia = "labconb3";
               aCodColDesp = #contrato#65;
            |FINSI;
            |SI aProcedencia = "labconb1";
               aCodColDesp = #contrato#62;
            |FINSI;
            |SI aProcedencia = "labcona5";
               aAlfa = #contrato#53;
               fFecha = aAlfa;
               |SI fFecha [ "28.08.2011";
                    aCodColDesp = "18";
               |SINO;
                    aCodColDesp = "19";
               |FINSI;
            |FINSI;
            aAlfa = aCodColDesp;
            |SI aProcedencia = "labcon02";
                 |SI aAlfa = 1; aAlfa = "01"; |FINSI;
                 |SI aAlfa = 2; aAlfa = "07"; |FINSI;
                 |SI aAlfa = 4; aAlfa = "08"; |FINSI;
                 |SI aAlfa = 3; aAlfa = "02"; |FINSI;
                 |SI aAlfa = 5; aAlfa = "04"; |FINSI;
            |SINO;
                 |SI aAlfa = 1; aAlfa = "06"; |FINSI;
                 |SI aAlfa = 2; aAlfa = "16"; |FINSI;
                 |SI aAlfa = 3; aAlfa = "02"; |FINSI;
                 |SI aAlfa = 4; aAlfa = "15"; |FINSI;
                 |SI aAlfa = 5; aAlfa = "04"; |FINSI;
                 |SI aAlfa = 6; aAlfa = "11"; |FINSI;
                 |SI aAlfa = 7; aAlfa = "12"; |FINSI;
                 |SI aProcedencia = "labcona5";
                      aAlfa = aCodColDesp;
                 |FINSI;
            |FINSI;
            |SI aAlfa ! "";
               aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_DESPIDO>" + aAlfa + "</CODIGO_COLECTIVO_DESPIDO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;
         aAlfa = &09 + &09 + "</DATOS_MEDIDAS_FOMENTO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

     || DATOS_CONTRATO_EMPRENDEDORES

     |SI aProcedencia = "labcon51";
          aAlfa = &09 + &09 + "<DATOS_CONTRATO_EMPRENDEDORES>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          |SI #contrato#88 = "X";
               aAlfa = "01";
               aAlfa = &09 + &09 + "<CODIGO_COLECTIVO_DEDUCCION_FISCAL>" + aAlfa;
               aAlfa = aAlfa +  "</CODIGO_COLECTIVO_DEDUCCION_FISCAL>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
          |SI #contrato#87 = "X";
               aAlfa = "02";
               aAlfa = &09 + &09 + "<CODIGO_COLECTIVO_DEDUCCION_FISCAL>" + aAlfa;
               aAlfa = aAlfa + "</CODIGO_COLECTIVO_DEDUCCION_FISCAL>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
          |SI #contrato#87 ! "X"; |Y #contrato#88 ! "X";
               aAlfa = "03";
               aAlfa = &09 + &09 + "<CODIGO_COLECTIVO_DEDUCCION_FISCAL>" + aAlfa;
               aAlfa = aAlfa + "</CODIGO_COLECTIVO_DEDUCCION_FISCAL>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;

          aAlfa = &09 + &09 + "</DATOS_CONTRATO_EMPRENDEDORES>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;

      || DATOS_ADICIONALES_TRANSFORMACION

      |SI nSwTrans = 1;
         aAlfa = aSwMinus; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + "<DATOS_ADICIONALES_TRANSFORMACION>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa = aSwMinus; |QBF aAlfa;
            |SI aAlfa ! "";
               aAlfa = &09 + &09 + &09 + "<IND_DISCAPACIDAD>" + aSwMinus + "</IND_DISCAPACIDAD>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
            aAlfa = &09 + &09 + "</DATOS_ADICIONALES_TRANSFORMACION>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |FINSI;

      || DATOS_CONTRATO_INTERINIDAD

      |SI nSwContrato = 410; |O nSwContrato = 510;
       |O aExclu = 410; |O aExclu = 510;
         aAlfa = &09 + &09 + "<DATOS_CONTRATO_INTERINIDAD>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |SI nSwContrato = 410; |O nSwContrato = 510;
            aAlfa = #contrato#50; |QBF aAlfa;
         |FINSI;
         |SI aExclu = 410; |O aExclu = 510;
            nCalc = 89;
            aAlfa = #contrato#nCalc#; |QBF aAlfa;
         |FINSI;
         |SI aProcedencia = "labconb7";
            nCalc = 83;
            aAlfa = #contrato#nCalc#; |QBF aAlfa;

            || Duracion Determinada Interinidad
            |SI aAlfa = 1; aAlfa = "A"; |FINSI;
            |SI aAlfa = 2; aAlfa = "B"; |FINSI;
            |SI aAlfa = 3; aAlfa = "L"; |FINSI;
            |SI aAlfa = 5; aAlfa = "J"; |FINSI;
            |SI aAlfa = 6; aAlfa = "K"; |FINSI;
            |SI aAlfa = 7; aAlfa = "M"; |FINSI;
            |SI aAlfa = 8; aAlfa = "M"; |FINSI;
            |SI aAlfa = 9; aAlfa = "F"; |FINSI;
         |SINO;
            || resto contratos interinidad, una campito para todas las causas
            |SI aAlfa = "1"; aAlfa = "F"; |FINSI;
            |SI aAlfa = "2"; aAlfa = "G"; |FINSI;
            |SI aAlfa = "3"; aAlfa = "H"; |FINSI;
            |SI aAlfa = "4"; aAlfa = "I"; |FINSI;
            |SI aAlfa = "5"; aAlfa = "N"; |FINSI;
            |SI aAlfa = "6"; aAlfa = "O"; |FINSI;
         |FINSI;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<CAUSA_INTERINIDAD>" + aAlfa + "</CAUSA_INTERINIDAD>"  + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = &09 + &09 + "</DATOS_CONTRATO_INTERINIDAD>"  + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

      || DATOS_ANEXO_CONTRATO_RELEVO

      |SI nSwContrato = 441; |O nSwContrato = 541; |O nSwContrato = 109;
       |O nSwContrato = 139; |O nSwContrato = 239; |O nSwContrato = 450;
       |O nSwContrato = 550;
         |SI swAnexoRelevo = 1;
            aAlfa = &09 + &09 + "<DATOS_ANEXO_CONTRATO_RELEVO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |SI nSwContrato ! 139;
               aAlfa = #labconre#0;
               |SI aAlfa = "A"; aAlfa = "1"; |FINSI;
               |SI aAlfa = "B"; aAlfa = "2"; |FINSI;
               |SI aAlfa ! "";
                  aAlfa = &09 + &09 + &09 + "<TIPO_TRABAJADOR>" + aAlfa + "</TIPO_TRABAJADOR>" + &13 + &10;
                  aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
            |FINSI;
            aAlfa = &09 + &09 + &09 + "<NOMBRE_APELLIDOS>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

            |ABRE #labconre;
            #labconre#18 = enRegis1;
            #labconre#19 = enRegis2;
            #labconre#20 = enRegis3;
            #labconre#21 = "";
            |LEE 000#labconre.=;
            |SI FSalida ! 0; |DDEFECTO #labconre; |FINSI;
            |CIERRA #labconre;

            |SALVA_FICHA #labtraba;
            |ABRE #labtraba;
            || #labtraba#0 = #labconre#4;
            || #labtraba#1 = #labconre#5;
            #labtraba#0 = #contrato#1;
            #labtraba#1 = #contrato#27;
            |LEE 000#labtraba.=;
            |SI FSalida = 0; aAlfa = #labtraba#2; |SINO; aAlfa = ""; |FINSI;
            |REPON_FICHA #labtraba;
            |CIERRA #labtraba;

            aCadena = #labtraba#2;
            |HAZ SeparaNom_plb;
            |SI eaNom ! "";
               eaNom = eaNom % 115;
               aAlfa = &09 + &09 + &09 + &09 + "<NOMBRE>" + eaNom + "</NOMBRE>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
            |SI eaApel1 ! "";
               aAlfa = &09 + &09 + &09 + &09 + "<PRIMER_APELLIDO>" + eaApel1 + "</PRIMER_APELLIDO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
            |SI eaApel2 ! "";
               aAlfa = &09 + &09 + &09 + &09 + "<SEGUNDO_APELLIDO>" + eaApel2 + "</SEGUNDO_APELLIDO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
            aAlfa = &09 + &09 + &09 + "</NOMBRE_APELLIDOS>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            aAlfa = &09 + &09 + "</DATOS_ANEXO_CONTRATO_RELEVO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |SINO;
         |SI swAnexoRelevo = 1;
            |SI nSwContrato = 100; |O nSwContrato = 130; |O nSwContrato = 150;
             |O nSwContrato = 200; |O nSwContrato = 230; |O nSwContrato = 250;
             |O nSwContrato = 300; |O nSwContrato = 330; |O nSwContrato = 350;
               aAlfa = &09 + &09 + "<DATOS_ANEXO_CONTRATO_RELEVO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               aAlfa = #labconre#0;
               |SI aAlfa = "A"; aAlfa = "1"; |FINSI;
               |SI aAlfa = "B"; aAlfa = "2"; |FINSI;
               |SI aAlfa ! "";
                  aAlfa = &09 + &09 + &09 + "<TIPO_TRABAJADOR>" + aAlfa + "</TIPO_TRABAJADOR>" + &13 + &10;
                  aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
               aAlfa = &09 + &09 + &09 + "<NOMBRE_APELLIDOS>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               |SALVA_FICHA #labtraba;
               |ABRE #labtraba;
               #labtraba#0 = #labconre#4;
               #labtraba#1 = #labconre#5;
               |LEE 000#labtraba.=;
               |SI FSalida = 0; aAlfa = #labtraba#2; |SINO; aAlfa = ""; |FINSI;
               |CIERRA #labtraba;
               |REPON_FICHA #labtraba;
               aCadena = #labtraba#2;
               |HAZ SeparaNom_plb;
               |SI eaNom ! "";
                  eaNom = eaNom % 115;
                  aAlfa = &09 + &09 + &09 + &09 + "<NOMBRE>" + eaNom + "</NOMBRE>" + &13 + &10;
                  aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
               |SI eaApel1 ! "";
                  aAlfa = &09 + &09 + &09 + &09 + "<PRIMER_APELLIDO>" + eaApel1 + "</PRIMER_APELLIDO>" + &13 + &10;
                  aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
               |SI eaApel2 ! "";
                  aAlfa = &09 + &09 + &09 + &09 + "<SEGUNDO_APELLIDO>" + eaApel2 + "</SEGUNDO_APELLIDO>" + &13 + &10;
                  aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               |FINSI;
               aAlfa = &09 + &09 + &09 + "</NOMBRE_APELLIDOS>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
               aAlfa = &09 + &09 + "</DATOS_ANEXO_CONTRATO_RELEVO>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
            |FINSI;
         |FINSI;
      |FINSI;

      || DATOS_ET_CO_TE

      |SI nSwContrato = 421;
         aAlfa = #labacuer#23; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + "<DATOS_ET_CO_TE>" + aAlfa + "</DATOS_ET_CO_TE>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |FINSI;

      |SI swAnexoRedCuotas = 1;
          |ABRE #labco224;
          #labco224#0 = #labtraba#0;
          #labco224#1 = #labtraba#1;
          |LEE 000#labco224.=;
          |SI FSalida = 0;
               aAlfa = &09 + &09 + "<DATOS_REDUCCION_RDL_1_2011>"  + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa = #labco224#4; |QBF aAlfa;
               |SI aAlfa = "3"; aAlfa = "1"; |FINSI;
               aAlfa = ("00" + aAlfa) % -102;
               aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_REDUCCION>" + aAlfa;
               aAlfa = aAlfa + "</CODIGO_COLECTIVO_REDUCCION>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               nNume = #labco224#5;
               |SI nNume = 1; aAlfa = "75"; |FINSI;
               |SI nNume = 2; aAlfa = "100"; |FINSI;
               aAlfa = &09 + &09 + &09 + "<PORCENTAJE_REDUCCION>" + aAlfa;
               aAlfa = aAlfa + "</PORCENTAJE_REDUCCION>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               nNume = #labco224#2 * 100;
               aAlfa = nNume;
               aAlfa = &09 + &09 + &09 + "<PORCENTAJE_JORNADA_REDUCCION>" + aAlfa;
               aAlfa = aAlfa + "</PORCENTAJE_JORNADA_REDUCCION>" + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

               aAlfa = &09 + &09 + "</DATOS_REDUCCION_RDL_1_2011>"  + &13 + &10;
               aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
          |FINSI;
          |CIERRA #labco224;
      |FINSI;

      |HAZ DATOS_RDL_4_2013;

      |HAZ DATOS_RDL_3_2014;

      |HAZ DATOS_RDL_1_2015;

      |HAZ DATOS_RDL_8_2014;

      |HAZ CopiaBasica_Eti;

      || DATOS_CONTRATOINSERCION

      |SI nSwContrato = 403; |O nSwContrato = 503;
         aAlfa = &09 + &09 + "<DATOS_CONTRATOINSERCION>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

         |DDEFECTO #labvaltb;
         #labvaltb#0 = "labtraba";
         #labvaltb#1 = 33;
         #labvaltb#5 = #labtraba#0;
         #labvaltb#6 = #labtraba#1;
         |LEE 000#labvaltb.=;
         |SI FSalida = 0;
            aAlfa = #labvaltb#4; |QBF aAlfa;
         |SINO;
            aAlfa = #labtraba#33;
         |FINSI;

         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<GRUPOCOTIZACIONSEGSOCIAL>" + aAlfa + "</GRUPOCOTIZACIONSEGSOCIAL>";
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa = &09 + &09 + "</DATOS_CONTRATOINSERCION>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      || PROG_EMPLEO_PUBLICO

         aAlfa = &09 + &09 + "<PROG_EMPLEO_PUBLICO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         || aAlfa = &09 + &09 + &09 + "<CORPORACION_LOCAL>" + "</CORPORACION_LOCAL>" + &13 + &10;
         ||aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         aAlfa = #contrato#69; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<ACTUACION>" + aAlfa + "</ACTUACION>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = #contrato#67; |QBF aAlfa;
         |SI aAlfa ! "";
            aAlfa = &09 + &09 + &09 + "<EJERCICIO_PRESUPUESTARIO>" + aAlfa + "</EJERCICIO_PRESUPUESTARIO>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
         aAlfa = &09 + &09 + "</PROG_EMPLEO_PUBLICO>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;


      || DATOS_REDUCION_FORMACION

     aAlfa = #contrato#82; |QBF aAlfa;
     |SI nSwContrato = 421; |Y aAlfa = "S";
          aAlfa = &09 + &09 + "<DATOS_REDUCCION_FORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + &09 + "<CODIGO_COLECTIVO_REDUCCION_FORMACION>";
          aAlfa = aAlfa + "04" + "</CODIGO_COLECTIVO_REDUCCION_FORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = #contrato#83; |QBF aAlfa;
          |SI aAlfa = "1";
               aAlfa = "100";
          |SINO;
               aAlfa = "75";
          |FINSI;
          aAlfa = &09 + &09 + &09 + "<PORCENTAJE_REDUCCION_FORMACION>" + aAlfa;
          aAlfa = aAlfa + "</PORCENTAJE_REDUCCION_FORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

          aAlfa = &09 + &09 + "</DATOS_REDUCCION_FORMACION>" + &13 + &10;
          aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
     |FINSI;

     |SI nSwContrato = 421;
          |HAZ AnexoFormacion;
     |FINSI;

      |SI nSwTrans = 0;
         aAlfa = &09 + "</CONTRATO_" + nAntContrato + ">" + &13 + &10;
      |SINO;
         aAlfa = &09 + "</TRANSFORMACION_" + nSwContrato + ">" + &13 + &10;
      |FINSI;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
   |FINSI;

     swSigue = 0;
     |SI swNetContrata = 1;
     |Y swNetContrataMas = 0;
          swSigue = 1;
     |FINSI;
     |SI swNetContEmi = 1;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 1;
          |SI nSwTrans = 0;
               aAlfa = "</CONTRATOS>" + &13 + &10;
          |SINO;
               aAlfa = "</TRANSFORMACIONES>" + &13 + &10;
          |FINSI;
          |XGRABA nHandle, aAlfa;
     |FINSI;
   |XCIERRA nHandle;

     |IP_REMOTO aIP;
     |SI aIP ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |FBORRA aOrigen;

   |CIERRA #labvaltb;
|FPRC;

|PROCESO CopiaBasica;
/*
   aAlfa = "C:/DOCUMENTOS/Contrat@/"; |RMKDIR aAlfa;
   aAlfa = eaNumProrr; |QBF aAlfa;
   aAlfa = "C:/DOCUMENTOS/Contrat@/cb" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa) % -102) + ".txt";
*/
     |DFICE aOrigen;
     aDestino = "C:/DOCUMENTOS/Contrat@/"; |RMKDIR aDestino;
     aAlfa1 = eaNumProrr; |QBF aAlfa1;
     aAlfa2 = "cb" + (("000000" + enNumRegis) % -106) + (("00" + aAlfa1) % -102) + ".txt";
     aOrigen = aOrigen + aAlfa2;
     aDestino = aDestino + aAlfa2;
     aAlfa = aOrigen;


   ||XABRE "CBW", aAlfa, nHandle;
   |XABRE "A", aAlfa, nHandle;
   |SI FSalida ] 0;
      aAlfa = &09 + &09 + "<COPIABASICA_TIPO>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      aAlfa = &09 + &09 + &09 + "<DATOS_CONTRATO>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      fFecha = ~; aFecha = fFecha; aAny = aFecha % -104;
      aAlfa = "E" + (aCodMuni % 102) + aAny + "9999999";
      aAlfa = &09 + &09 + &09 + &09 + "<CLAVE_CONTRATO>" + aAlfa + "</CLAVE_CONTRATO>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      aAlfa = #labtraba#7; |QBF aAlfa;
      aAlfa1 = aAlfa % 0101;
      |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9";
         aAlfa = "D" + aAlfa;
      |SINO;
         |SI aAlfa1 = "X"; |O aAlfa1 = "Y"; |O aAlfa1 = "Z";
            aAlfa = "E" + aAlfa;
         |SINO;
            aAlfa1 = #labtraba#76; |QBF aAlfa1;
            aAlfa2 = aAlfa1 % 0599; aAlfa1 = aAlfa1 % 0103;
            |SI aAlfa1 = "ESP"; |O aAlfa1 = "724"; |O aAlfa1 = "250";
             |O aAlfa1 = "276"; |O aAlfa1 = "056"; |O aAlfa1 = "442";
             |O aAlfa1 = "380"; |O aAlfa1 = "208"; |O aAlfa1 = "372";
             |O aAlfa1 = "826"; |O aAlfa1 = "300"; |O aAlfa1 = "620";
             |O aAlfa1 = "040"; |O aAlfa1 = "246"; |O aAlfa1 = "752";
             |O aAlfa1 = "233"; |O aAlfa1 = "428"; |O aAlfa1 = "440";
             |O aAlfa1 = "616"; |O aAlfa1 = "203"; |O aAlfa1 = "703";
             |O aAlfa1 = "705"; |O aAlfa1 = "348"; |O aAlfa1 = "470";
             |O aAlfa1 = "196"; |O aAlfa2 = "HOLANDA";
               aAlfa = "U" + aAlfa;
            |SINO;
               aAlfa = "W" + aAlfa;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI aAlfa ! "";
         aAlfa = &09 + &09 + &09 + &09 + "<ID_PFISICA>" + aAlfa + "</ID_PFISICA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;
      aAlfa = &09 + &09 + &09 + "</DATOS_CONTRATO>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;

      aAlfa = &09 + &09 + &09 + "<DATOS_COPIABASICA>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |SI nHayCopiaBas = 1; aAlfa = "1"; |SINO; aAlfa = "3"; |FINSI;
      aAlfa1 = #labcentr#12; |QBF aAlfa1;    || si no hay representante
      |SI aAlfa = "1";                       || sindical, el tipo de firma
           |SI aAlfa1 = ""; |O aAlfa1 = "NO EXISTE";  || es un "2" y no un "1"
               aAlfa = 2;
           |FINSI;
      |FINSI;
      |SI aAlfa ! "";
         aAlfa = &09 + &09 + &09 + &09 + "<TIPO_FIRMA>" + aAlfa + "</TIPO_FIRMA>" + &13 + &10;
         aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      |FINSI;

      |ABRE #labcontr;
      |LEE 000#labcontr.p;
      |SI FSalida = 0; |Y #labcontr#57 = "S";
         ||SI swAnexoClaus = 1;
            nLimReal = nNume;
            nTotCar = 0;
            swEtiIni = 0;
            |PARA nNume = 1; |SI nNume [ 18; |Y nTotCar [ 749; |HACIENDO nNume = nNume + 1;
                aNume = nNume;  aNume = "00" + aNume; aNume = aNume % -102;
                aCampo = aAlfa + aNume;
                nCampo = nNume + 8;
                aAlfa = #contrato#nCampo#; |QBF aAlfa;
                |SI aAlfa ! "";
                   aAlfa1 = aAlfa % 0;
                   nNumCar = aAlfa1;
                   nNumCar = nNumCar + 1;
                   nTotCar = nTotCar + nNumCar;
                   |SI nTotCar > 749;
                       nNume = nNumCar - (nTotCar - 749);
                       nNume = 100 + nNume;
                       aAlfa = aAlfa % nNume;
                   |FINSI;
                   aAlfa = aAlfa + " ";
                   |SI swEtiIni = 0;
                      aAlfa1 = &09 + &09 + &09 + "<TEXTO_COPIABASICA>";
                      aCadena = aAlfa1; |HAZ QuitaRaros; aAlfa1 = aCadena; |XGRABA nHandle, aAlfa1;
                      swEtiIni = 1
                   |FINSI;
                   aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
                |FINSI;
            |SIGUE;
         ||FINSI;
         |SI swEtiIni = 1;
            aAlfa = "</TEXTO_COPIABASICA>" + &13 + &10;
            aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
         |FINSI;
      |FINSI;
      |CIERRA #labcontr;

      aAlfa = &09 + &09 + &09 + "</DATOS_COPIABASICA>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
      aAlfa = &09 + &09 + "</COPIABASICA_TIPO>" + &13 + &10;
      aCadena = aAlfa; |HAZ QuitaRaros; aAlfa = aCadena; |XGRABA nHandle, aAlfa;
   |FINSI;

   |XCIERRA nHandle;

     |IP_REMOTO aIP;
     |SI aIP ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |FBORRA aOrigen;
|FPRC;
