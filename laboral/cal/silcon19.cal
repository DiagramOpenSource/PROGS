|FICHEROS;
    silcon19 #0;
    silcon01 #1;         || control directorio
    silcon02 #2;         || lotes cabs.
    tsilcon0 #3;         || pantalla campos
    silcon04 #4;         || campos auxiliares
    silcon03 #5;         || lotes lins.
    silcon06 #6;         || empresas silcon
    silcon07 #7;         || registro lotes
    labempre #10;        || empresas
    labtraba #12;        || trabajadores
    nomcenes #13;        || centros especiales
    labcentr #14;        || centros
    labpadre #15;        || datos aux. trabajador
    tsilcon7 #20,MANTE;  || movimientos AFI seleccionados (temporal)
    silcon13 #21;        || movimientos AFI
    silcon15 #25;        || gestion centros RED
    nomcontr #36;

    nomequiv #101;       || tabla equivalencias contratos nuevos
    silcon18;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    alfa5 = "";
    alfa6 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;
    p_mes = "";
    inkey = 0;

    dlote = 0;
    hlote = 0;

    ajuste1 = "";
    ajuste2 = "";
    ajuste3 = "";
    alfa = "";
    error = 0;
    ind = 0;
    long = 0;
    posi = 0;
    digito = "";
    texto = "";
    mascara = "";
    cadena = "";
    i = 0;
    nCampo = 0;
    nTipo = 0;

    fichero = "";
    extension = "";
    clave = "";
    sw_auxil = 0;
    linea = 0;
    for_fecha = "";
    for_hora = "";
    apell1 = "";
    apell2 = "";
    nombre = "";
    descom = "";
    entero = "";
    decima = "";
    tot_emp = 0;
    indica = "";
    ant_empre = 0;
    ant_ctacot = 0;
    sw_empresa = 0;
    lote = 0;
    sw_comprueba = 0;
    &incluido = "";
    &los_si = 0;
    &los_no = 0;
    &emp_com = 0;
    &sw_linea = 0;
    ctacot = 0;
    &ctacotalf = "";
    aCto = "";
    nSexo = 0;
    aContrato = "";
    nRegimen = 0;
    swNoGrabes = 0;
    swEsAgrario = 0;
    nVacios = 0;
    aValor = "";
    nValor = 0;
    nLimite = 0;
    nPara1 = 0;

     || las nuevas variables

     &eaVengoDe = "";
     nNume = 0;
     nNume1 = 0;
     nNume2 = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aLimiteInf = "";
     aLimiteSup = "";
     fFecha = @;
     &nPosicion = 0;
     aAutorizacion = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &aCadena = "";
|FIN;
____________________________________/ GESTION PANTALLA
|PROCESO no_entres; |TIPO 7;
|SI #0#5 = "R";
        #0#4 = "S";
    |PINTA #0#4;
    |C_M #0#4, 1, "N";
|SINO;
    |C_M #0#4, 1, "S";
|FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO mirames; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 1043, p_mes;
|FPRC;

|PROCESO ult_lote; |TIPO 7;
|ABRE #2;
|LEE 000#2u;
|SI FSalida = 0;
        #0#2 = #2#0 + 1;
|SINO;
        #0#2 = 1;
|FINSI;
|PINTA #0#2;
|CIERRA #2;
|FPRC;

|PROCESO si_existe; |TIPO 0;
|ABRE #2;
    #2#0 = #0#2;
|LEE 000#2=;
|SI FSalida = 0;
    |MENAV "    Numero de Lote YA existente ...";
    |ERROR;
|FINSI;
|CIERRA #2;
|FPRC;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO no_vacio; |TIPO 0;
    alfa1 = #0Campo;
|QBT alfa1;
|SI alfa1 = "";
    |MENAV "    Error de entrada ...";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO BuscaDupli;

|FPRC;

|PROCESO control;
|DDEFECTO #36;
|ABRE #36;
|LEE 000#36p;
|SI FSalida ! 0;
    |MENAV "    No existe control, usando defectos ...";
|FINSI;
|CIERRA #36;
|FPRC;

____________________________________/ FORMATEO DE DATOS
|PROCESO errores;
|SI error = 1;
        alfa1 = "    "+i+" "+clave+":VALOR DE CAMPO NUMERICO INCORRECTO";
|FINSI;
|SI error = 2;
        alfa1 = "    "+i+" "+clave+":CAMPO OBLIGADO SIN RELLENO";
|FINSI;
|MENAV alfa1;
|FPRC;

|PROCESO comp1;               || COMPRUEBA SI ES NUMERICO.
     |SI ajuste1 = "1";
          error = 0;
          |PARA ind = 1; |SI ind [ long; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito ! " ";
                    |SI digito < "0"; |O digito > "9";
                         error = 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp2;               || COMPRUEBA SI TIENE QUE ESTAR RELLENO.
     |SI ajuste3 = "3";
          error = 0;
          FSalida = 0;
          |QBF alfa;
          |PARA ind = 1; |SI FSalida = 0; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito = "";
                    error = 2;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp3;               || AJUSTA I, o D. Y RELLENA DE 0 o BLANCOS.
     |SI ajuste3 = "1";       || RELLENA BLANCOS.
          mascara = "                                                                    ";
     |FINSI;
     |SI ajuste3 = "2";       || RELLENA CEROS.
          mascara = "00000000000000000000000000000000000000000000000000000000000000000000";
     |FINSI;
     |SI ajuste2 = "1";       || AJUSTA DERECHA.
          posi = 100 + long;
          posi = posi * -1;
          |QBF texto;
          texto = mascara + texto;
          texto = texto % posi;
     |FINSI;
     |SI ajuste2 = "2";
          posi = 100 + long;
          |QBF texto;
          texto = texto + mascara;
          texto = texto % posi;
     |FINSI;
|FPRC;

|PROCESO monta;
     texto = "";
     cadena = "";
     |PARA i = 0; |SI i < 30; |HACIENDO i = i + 1;
          nCampo = i;
          texto = #3nCampo;
          nTipo = i * 6 + 2;                 || MODIFICABLE.
          alfa  = #4nTipo;
          nTipo = i * 6 + 2;                 || VISUAL.
          alfa1 = #4nTipo;
          |SI alfa = "S"; |O alfa1 = "S";
               nTipo = i * 6 + 6;            || Longitud.
               long  = #4nTipo;
               nTipo = i * 6 + 7;            || AJUSTE.
               alfa  = #4nTipo;
               ajuste1 = alfa % 101;
               ajuste2 = alfa % 201;
               ajuste3 = alfa % 301;
               |HAZ comp1;
               |SI error = 1; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp2;
               |SI error = 2; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp3;
               cadena = cadena + texto;
          |FINSI;
     |SIGUE;
|FPRC;
____________________________________/ RUTINAS DE APOYO
|PROCESO descompone;
    entero = "";
    decima = "";
    elsw1 = 0;
    alfa1 = descom % 0;   long = alfa1;
|PARA para1 = 1; |SI para1 [ long; |HACIENDO para1 = para1 + 1;
        nume1 = (para1 * 100) + 1;
        alfa1 = descom % nume1;
    |SI alfa1 = ".";
            elsw1 = 1;
    |SINO;
        |SI elsw1 = 0;   entero = entero + alfa1; |FINSI;
        |SI elsw1 = 1;   decima = decima + alfa1; |FINSI;
    |FINSI;
|SIGUE;

|SI entero = "";    entero = "0";  |FINSI;
|SI decima = "";    decima = "0";  |FINSI;
|FPRC;

|PROCESO fecha;
    for_fecha = fech1;
    for_fecha = (for_fecha % -104) + (for_fecha % 402) + (for_fecha % 102);
|FPRC;

/*
|PROCESO ini_linea;
|DDEFECTO #5;
    linea = linea + 1;

    #5#0 = #2#0;
    #5#1 = linea;
    #5#2 = "A";
    #5#3 = clave;
|GRABA 020#5b;

    sw_auxil = 0;
    #4#0 = #5#2;
    #4#1 = #5#3;
|LEE 000#4=;
|SI FSalida ! 0;
        alfa1 = "    Descripcion [" + #4#0 + "-" + #4#1 + "] sin definir ...";
    |MENAV alfa1;
        sw_auxil = 1;
|FINSI;
|FPRC;

|PROCESO fin_linea;
    #5#4 = cadena;
|GRABA 020#5a;
|LIBERA #5;
|FPRC;

|PROCESO fin_linea2;
    linea = linea - 1;
|BORRA 020#5a;
|LIBERA #5;
|FPRC;
____________________________________/ CARGA DE LOS DIFERENTES REGISTROS
|PROCESO actua_registro;
|ABRE #7;
    #7#0 = ant_empre;    || empresa
    #7#1 = #0#2;         || nro.lote
    #7#2 = #0#5;         || indicador
|LEE 101#7=;
    FEstado = FSalida;

    #7#3 = #0#0;         || a¤o
    #7#4 = #0#1;         || mes
    #7#5 = ~;            || fecha envio
    #7#6 = "01.01.1900"; || fecha comprobacion
    #7#7 = "FDI";        || tipo lote

|SI FEstado = 0;    |GRABA 020#7a; |FINSI;
|SI FEstado ! 0;    |GRABA 020#7n; |FINSI;
|LIBERA #7;
|CIERRA #7;
|FPRC;

|PROCESO comp_seg;
     nVacios = 0;
     swNoGrabes = 0;
     |SI clave = "DAM";
          nLimite = 15;
     |FINSI;
     |PARA nPara1 = 0; |SI nPara1 [ nLimite; |HACIENDO nPara1 = nPara1 + 1;
          aValor = #3nPara1;
          |QBF aValor;
          |SI aValor = ""; |O aValor = "N";
               nVacios = nVacios + 1;
          |SINO;
               nValor = aValor;
               |SI nValor = 0;
                    nVacios = nVacios + 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     nVacios = nVacios - 1;
     |SI nVacios = nLimite;
          |HAZ fin_linea2;
          swNoGrabes = 1;
     |FINSI;
|FPRC;

|PROCESO fct;
     |SI #20#3 ! "MB ";
          |ACABA;
     |FINSI;
     clave = "FCT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0 = 1;           || tipo de accion (=001)
          #3#1 = #20#50;      || fecha fin de vacaciones
          #3#2 = "";          || fecha desde (NO SE USA DE MOMENTO)
          #3#3 = "";          || fecha hasta (NO SE USA DE MOMENTO)
          #3#4 = "";          || fecha desde nueva (NO SE USA DE MOMENTO)
          #3#5 = "";          || fecha hasta nueva (NO SE USA DE MOMENTO)
          #3#6 = "";          || Reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO dra;
     |SI #20#3 ! "MJR"; |Y #20#3 ! "MFR";
          |ACABA;
     |FINSI;
     clave = "DRA";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          |SI #20#3 = "MJR";
               #3#0 = #20#40;
               #3#1 = #20#41;
               #3#2 = #20#42;
          |FINSI;
          |SI #20#3 = "MFR";
               #3#3 = #20#16;
               #3#4 = #20#39;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

____________________________________/ COMPROBACION ANTERIOR A LA CREACION
|PROCESO comprueba1;
|HAZ ordena;
|SI ant_ctacot ! ctacot;
    |HAZ lee_empresa;
        sw_linea = 1;
    |PRINT;
        ant_ctacot = ctacot;
|FINSI;

|HAZ empresa_si;
|SI sw_empresa = 0;
        incluido = "SI";
        los_si = los_si + 1;
|SINO;
        incluido = "NO";
        los_no = los_no + 1;
|FINSI;
|HAZ lee_trabajador;
    sw_linea = 0;
|PRINT;
|FPRC;

|DEFBUCLE comprueba;
 #20#2;
 26;
     1,     1, "*";
 99999, 99999, "*";
 be;
 NULL, ordena, NULL, NULL, NULL, comprueba1;
 ctacot, #20#2;
|FIN;

|PROCESO comprobacion;
|AVISO;
|CONFI "    SComprobacion impresa del contenido del lote (S/N): ";
|SI FSalida ! 0;    |ACABA;   |FINSI;

|MENSA "    <Comprobacion del contenido del Lote>";

|IMPRE 0;
|SI FSalida = 0;
    |INFOR "silcon19";
    |BUCLE comprueba;
    |PIEINF;
    |FININF;
    |FINIMP;
    |CONFI "    NContinuar con la creacion del Lote (S/N): ";
        sw_comprueba = FSalida;
|SINO;
        sw_comprueba = FSalida;
|FINSI;
|ATRI R;  |BLIN 4;  |ATRI 0;
|FPRC;

*/
/****************************************************************************/
/*************************  LOS NUEVOS PROCESOS *****************************/
/****************************************************************************/

/*************************  AYUDA CREACION LOTE  ****************************/

|PROCESO tipo8; |TIPO 8;
     |ABRE #1;
     |LEE 100#1p;
     |SI FSalida ! 0;
          |SI FSalida = 111;
               |MENAV "    Debera definir 'Maestros/Control R.E.D.'";
          |FINSI;
          |CIERRA #1;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO tipo9; |TIPO 9;
     |LIBERA #1;
     |CIERRA #1;
     |DELINDEX #20;
|FPRC;

|PROCESO actua_registro;
     |ABRE #7;
     #7#0 = ant_empre;    || empresa
     #7#1 = #0#2;         || nro.lote
     #7#2 = #0#5;         || indicador
     |LEE 101#7=;
     FEstado = FSalida;

     #7#3 = #0#0;         || a¤o
     #7#4 = #0#1;         || mes
     #7#5 = ~;            || fecha envio
     #7#6 = "01.01.1900"; || fecha comprobacion
     #7#7 = "FDI";        || tipo lote

     |SI FEstado = 0;    |GRABA 020#7a; |FINSI;
     |SI FEstado ! 0;    |GRABA 020#7n; |FINSI;
     |LIBERA #7;
     |CIERRA #7;
|FPRC;

|PROCESO ini_linea;
     |DDEFECTO #5;
     linea = linea + 1;

     #5#0 = #2#0;
     #5#1 = linea;
     #5#2 = "D";
     #5#3 = clave;
     |GRABA 020#5b;

     sw_auxil = 0;
     #4#0 = #5#2;
     #4#1 = #5#3;
     |LEE 000#4=;
     |SI FSalida ! 0;
          alfa1 = "    Descripcion [" + #4#0 + "-" + #4#1 + "] sin definir ...";
     |MENAV alfa1;
          sw_auxil = 1;
     |FINSI;
|FPRC;

|PROCESO fin_linea;
     #5#4 = cadena;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO fin_linea2;
     linea = linea - 1;
     |BORRA 020#5a;
     |LIBERA #5;
|FPRC;

/************************ FIN AYUDA CREACION LOTE  **************************/

|PROCESO separa;
     |SI nNume = 0;
          nNume1 = 0;
          nNume2 = 0;
     |SINO;
          nNume1 = nNume - 0.5;
          nNume1 = nNume1 ! 0;     || parte entera
          aAlfa = nNume1; |QBF aAlfa; |SI aAlfa = "-0"; nNume1 = 0; |FINSI;
          nNume2 = nNume - nNume1; || parte decimal
     |FINSI;
|FPRC;

|PROCESO etf;
     clave = "ETF";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "FDI3";
          #3#1  = "0";
          #3#2  = "WS55";
          #3#3  = "0";
          #3#4  = aAutorizacion;         || clave autorizacion
          #3#5  = #1#1;         || clave SILCON
          fech1 = ~;
          |HAZ fecha;
          #3#6  = for_fecha;    || fecha
          #3#7  = for_hora;     || hora
          #3#8  = fichero;      || fichero
          #3#9  = "FDI";        || sufijo
          #3#10 = "N";          || codigo prioridad
          #3#11 = indica;       || indicador
          #3#12 = tot_emp;      || total segmentos EMP
          #3#13 = linea;        || total segmentos
          #3#14 = "";           || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO odp;
     |SI #silcon18#3 ! "C";
          |ACABA;
     |FINSI;
     clave = "ODP";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          fech1 = #silcon18#26;         || fecha del parte de confirmacion
          |HAZ fecha;
          #3#0 = for_fecha;
          #3#1 = #silcon18#27;         || numero de parte de confirmacion
          #3#2 = #silcon18#29;         || Nueva entidad
          fech1 = #silcon18#28;         || fecha del cambio de entidad AT
          |HAZ fecha;
          #3#3 = for_fecha;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO dec;
     |SI #silcon18#3 = "A"; |O #silcon18#3 = "C";
          |ACABA;
     |FINSI;
     clave = "DEC";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          nNume = #silcon18#16;         || base de cotizacion
          |HAZ separa;
          #3#0 = nNume1;                || parte entera
          nNume2 = nNume2 * 100;
          #3#1 = nNume2;                || parte decimal

          nNume = #silcon18#17;         || suma bases de cotizacion
          |HAZ separa;
          #3#2 = nNume1;                || parte entera
          nNume2 = nNume2 * 100;
          #3#3 = nNume2;                || parte decimal

          nNume = #silcon18#24;         || cotizacion a¤o anterior horas extras
          |HAZ separa;
          #3#4 = nNume1;                || parte entera
          nNume2 = nNume2 * 100;
          #3#5 = nNume2;                || parte decimal

          nNume = #silcon18#25;         || cotizacion a¤o anterior otros
          |HAZ separa;
          #3#6 = nNume1;                || parte entera
          nNume2 = nNume2 * 100;
          #3#7 = nNume2;                || parte decimal

          #3#8 = "";                    || solo para FRI

          #3#9 = #silcon18#14;          || dias cotizados mes
          #3#10 = #silcon18#15;          || suma dias cotizados

          #3#11 = "";                   || Reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO dit;
     clave = "DIT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0 = "P" + #silcon18#3;
          |SI #silcon18#3 = "A";
               #3#1 = #silcon18#22;     || causa del alta, para partes de alta
          |FINSI;
          #3#2 = #silcon18#4;           || contingencia
          fech1 = #silcon18#7;
          |HAZ fecha;
          #3#3 = for_fecha;
          |SI #silcon18#3 = "A";
               fech1 = #silcon18#23;
               |HAZ fecha;
               #3#4 = for_fecha;        || fecha de alta, para partes de alta
          |FINSI;
          |SI #silcon18#3 = "B";
               |SI #silcon18#4 = "3"; |O #silcon18#4 = "4"; |O #silcon18#5 = "5";
                    fech1 = #silcon18#23;
                    |HAZ fecha;
                    #3#5 = for_fecha;               || fecha de AT/EP
               |FINSI;
          |FINSI;
          aAlfa1 = #silcon18#11; aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
          aAlfa2 = #silcon18#12; aAlfa2 = "000000" + aAlfa2; aAlfa2 = aAlfa2 % -106;
          #3#6 = aAlfa1 + aAlfa1 + aAlfa2;       || colegiado
          #3#7 = #silcon18#13;          || codigo de identif. Area Sanitaria
          |SI #silcon18#3 = "B";
               #3#8 = #silcon18#9;           || dias probables baja
               #3#9 = #silcon18#10;          || meses probables baja
          |SINO;
               #3#8 = "";
               #3#9 = "";
          |FINSI;
          aAlfa = #silcon18#8;
          #3#10 = aAlfa;                || categoria profesional (Regimen 911)
          aAlfa = #silcon18#5;          || recaida s/n
          |QBF aAlfa;
          |SI aAlfa = "C";
               #3#11 = "";          || recaida s/n
          |SINO;
               #3#11 = #silcon18#5;          || recaida s/n
          |FINSI;
          #3#12 = "";                   || Reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO TipoID;
     alfa1 = #12#7 % 101;
     alfa2 = #12#7;
     |QBF alfa2;
     alfa2 = alfa2 % -101;

     |SI alfa1 ] "A"; |Y alfa1 [ "z";
          |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
               |SI alfa2 ] "A"; |Y alfa2 [ "z";
                    #3#2 = "6";                  || tipo identif.(EXTRANJERO)
                    #3#3 = "   ";                || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |SINO;
                    #3#2 = "2";                  || tipo identif.(PASAPORTE)
                    #3#3 = #12#76 % 103;         || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |FINSI;
          |SINO;
               #3#2 = "2";                  || tipo identif.(PASAPORTE)
               #3#3 = #12#76 % 103;         || pais emisor
               #3#7 = #12#76 % 103;         || nacionalidad
          |FINSI;
     |FINSI;
     |SI #nomcontr#40 = 2;
          |SI #3#2 = "6";
               aAlfa = #12#7;
               |QBF aAlfa;
               aAlfa1 = aAlfa % 101;
               aAlfa = aAlfa - aAlfa1;
               alfa6 = aAlfa % 0;
               long = alfa6;
               |SI long ! 9;
                    aAlfa = aAlfa1 + "0" + aAlfa;
               |SINO;
                    aAlfa = aAlfa1 + aAlfa;
               |FINSI;
               #12#7 = aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tra;
     clave = "TRA";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = #12#75 % 102;                || provincia NAFSS
          #3#1  = #12#75 % 3;                  || numero NAFSS
          #3#2  = "1";                         || tipo identificador (DNI)
          |HAZ TipoID;
          #3#3  = "000";                       || pais (espa¤a)
          #3#4 = #12#7;                        || DNI
          #3#5 = "";                           || reservado respues.afiliac.
          #3#6 = "";                           || decodif., reservado recaud.
          #3#7 = #3#3;                         || nacionalidad
          #3#8 = "";                           || indicadores (futuro uso)
          #3#9 = "";                           || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO emp;
    clave = "EMP";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        tot_emp = tot_emp + 1;
        #3#0  = nRegimen;          || RRSS
        #3#1  = ctacotalf % 102;   || provincia
        #3#2  = ctacotalf % 309;   || nro.cta.cotizacion
        #3#3  = "";                || tipo de identificacion
        |SI #6#3 = 11;   #6#3 = 724; |FINSI;   || no se acepta Espa¤a=11
        #3#4  = #6#3;              || pais
        #3#5  = #10#10;            || nro.identif.empresario
        #3#6  = "";                || calif.cod.empresario
        #3#7  = #6#2;              || RRSS
        #3#8  = #10#13 % 102;      || provincia
        #3#9  = #10#13 % 309;      || nro.cta.cotizacion
        #3#10 = "";                || reservado
        #3#11 = "";                || accion
        #3#12 = "";                || situacion (sin uso)
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO lee_centros;
     |DDEFECTO #14;
     #14#0 = #12#0;
     #14#1 = #12#77;
     |LEE 000#14=;
     |SI FSalida ! 0;
          alfa1 = "    Centro:[" + #14#0 + "][" + #14#1 + "] inexistente ...";
          |MENAV alfa1;
     |FINSI;
|FPRC;

|PROCESO lee_cenespe;
     |DDEFECTO #13;
     #13#0 = #12#0;
     #13#13= #12#77;
     #13#1 = "87";
     |LEE 000#13=;            || lee el centro especial de cotizacion
     |SI FSalida ! 0;
          alfa1 = "    Centro Especial:["+#13#0+"]["+#13#13+"]["+#13#1+"] inexistente ...";
          |MENAV alfa1;
     |FINSI;
|FPRC;

|PROCESO lee_empresa;
     |DDEFECTO #10;
     #10#0 = #silcon18#0;
     |LEE 000#10=;            || lee la empresa
|FPRC;

|PROCESO lee_datos_aux;
     |DDEFECTO #15;
     #15#0 = #20#1;
     #15#1 = #20#2;
     |LEE 000#15=;            || lee el trabajador

     nSexo = 1;
     |SI #15#5 = "M";
          nSexo = 2;
     |FINSI;
|FPRC;

|PROCESO CodigosNuevos;
     |QBF aContrato;
     aContrato = ("000" + aContrato) % -103;
     |ABRE #nomequiv;
     #nomequiv#0 = aContrato;
     |LEE 000#nomequiv.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
               aContrato = #nomequiv#2;      || tiempo parcial
          |SINO;
               aContrato = #nomequiv#1;      || tiempo completo
          |FINSI;
     |FINSI;
     |CIERRA #nomequiv;
|FPRC;

|PROCESO lee_trabajador;
     |DDEFECTO #12;
     #12#0 = #silcon18#0;
     #12#1 = #silcon18#1;
     |LEE 000#12=;            || lee el trabajador

    |DDEFECTO #25;
    #25#0 = #12#0;
    #25#1 = #12#77;
    |LEE 000#25=;
    |SI FSalida = 0;
        nRegimen = #25#2;
    |SINO;
        nRegimen = #6#2;
    |FINSI;
|FPRC;

|PROCESO empresa_si;
     #6#0 = #silcon18#0;
     |LEE 000#6=;
     sw_empresa = FSalida;
|FPRC;

|PROCESO cambia_autoriz;
     #silcon03#0 = #silcon03#0;
     #silcon03#1 = 0001;
     |LEE 101#silcon03.=;
     |SI FSalida = 0;
          nNume1 = nPosicion;
          nNume1 = 100 + nNume1;
          aAlfa1 = #silcon03#4 % nNume1;
          nNume2 = nPosicion + 9;
          nNume2 = (nNume2 * 100) + 99;
          aAlfa2 = #silcon03#4 % nNume2;
          #silcon03#4 = aAlfa1 + #silcon06#5 + aAlfa2;
          |GRABA 020#silcon03.a;
     |FINSI;
|FPRC;

|PROCESO mtos_fdi1;
     |HAZ empresa_si;
     |SI sw_empresa = 0;
          |PINTA 2305, #20#1;
          |PINTA 2315, #20#2;

          |HAZ ordena;
          |SI ant_ctacot ! ctacot;
               |SI ant_ctacot ! -1;
                    |HAZ actua_registro;
               |FINSI;

               |HAZ lee_empresa;
               |SI aAutorizacion ! ""; |Y aAutorizacion ! #6#5;
                    || ya ha hecho la primera empresa
                    || si la autorizacion anterior es distinta a la de la empresa actual,
                    || le meto la general.En caso de dos distintas,la del control RED siempre

                    #6#5 = #1#0;
                    aAutorizacion = #1#0;
               |SINO;
                    aAutorizacion = #6#5;
               |FINSI;
               nPosicion = 10;
               |HAZ cambia_autoriz;
               |HAZ emp;
               ant_empre = #silcon18#0;
               ant_ctacot = ctacot;
          |FINSI;
          |HAZ lee_trabajador;
          |HAZ tra;
          |HAZ dit;
          |HAZ dec;
          |HAZ odp;

          fFecha = ~;    aAlfa = fFecha;
          #silcon18#18 = aAlfa;
          #silcon18#19 = #0#2;
          #silcon18#20 = "*";
          #silcon18#21 = " ";

          |GRABA 020#silcon18.a;
          |LIBERA #silcon18;
     |FINSI;
|FPRC;

|PROCESO ordena;
     ctacot = 0;
     |HAZ lee_trabajador;     || lee trabajador
     |SI #12#45 = "087";|O #12#45 = "097";|O #12#45 = "064";|O #12#45 = "085";
     |O #12#45 = "421";
          |HAZ lee_cenespe;         || lee centros especiales
          ctacot = #13#10;
          ctacotalf = #13#10;
     |SINO;
          |HAZ lee_centros;         || lee centros normales
          ctacot = #14#10;
          ctacotalf = #14#10;
     |FINSI;
|FPRC;

|DEFBUCLE mtos_fdi;
     #silcon18#2;
     18, 20, 21;              || fecha emision (vacia), seleccion, seleccion
     00001, 00001, "01.01.2000", "A", "          ", "-", aLimiteInf;
     99999, 99999, "31.12.2999", "C", "          ", "-", aLimiteSup;
     be;
     NULL, ordena, NULL, NULL, NULL, mtos_fdi1;
     ctacot, #silcon18#1;     || segunda ordenacion: cta.cot y trabajador
|FIN;

|PROCESO sil;
     clave = "SIL";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "";
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO eti;
     clave = "ETI";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "FDI3";
          #3#1  = "0";
          #3#2  = "WS55";
          #3#3  = "0";
          #3#4  = #1#0;         || clave autorizacion
          #3#5  = #1#1;         || clave SILCON
          fech1 = ~;
          |HAZ fecha;
          #3#6  = for_fecha;    || fecha
          #3#7  = for_hora;     || hora
          #3#8  = fichero;      || fichero
          #3#9  = "FDI";        || sufijo
          #3#10 = "N";          || codigo prioridad
          || #3#11 = indica;       || indicador
          #3#11 = "";           || indicador: solo para FAN y AFI
          #3#12 = #0#0 % -102;  || a¤o
          #3#13 = #0#1;         || mes
          #3#14 = #0#6;         || serie
          #3#15 = #0#7;         || nro. envio
          #3#16 = #0#8;         || nro. documento
          #3#17 = "";           || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO graba_lote;
     #2#1 = fichero;       || nombre salida
     #2#2 = extension;     || extension
     #2#3 = ~;             || fecha creacion
     #2#4 = ~;             || fecha grabacion
     |GRABA 020#2b;
|FPRC;

|PROCESO nombre_fichero;
     fech1 = ~;
     alfa1 = fech1;
     alfa2 = alfa1 % 102;      || dia
     alfa3 = alfa1 % 402;      || mes
     |HORA for_hora;
     for_hora = (for_hora % 102) + (for_hora % 402);
     fichero = alfa2 + alfa3 + for_hora;
     extension = "fdi";
|FPRC;

____________________________________/ PROCESO PRINCIPAL
|PROCESO CreaLote;
     |ABRE #1;
     |ABRE #2;
     |ABRE #4;
     |ABRE #5;
     |ABRE #6;
     |ABRE #10;
     |ABRE #12;
     |ABRE #13;
     |ABRE #14;
     |ABRE #15;
     |ABRE #21;
     |ABRE #25;

     |SELECT #1#21;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida = 0;
          |MENAV "    Numero de Lote YA existente ...";
     |SINO;
          ant_empre = -1;
          ant_ctacot = -1;
          |HAZ control;
          |HAZ nombre_fichero;
          |HAZ graba_lote;
          |HAZ eti;
          |HAZ sil;
          |BUCLE mtos_fdi;
          |HAZ actua_registro;
          |HAZ etf;
     |FINSI;

     |LIBERA #2;

     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #6;
     |CIERRA #10;
     |CIERRA #12;
     |CIERRA #13;
     |CIERRA #14;
     |CIERRA #15;
     |CIERRA #21;
|FPRC;

|PROCESO seleccion;
     |SI #0#4 = "S";
          eaVengoDe = "silcon19";
          |SUB_EJECUTA "silcon18;PEN";
          aLimiteInf = "*";
          aLimiteSup = "*";
     |SINO;
          aLimiteInf = " ";
          aLimiteSup = "*";
     |FINSI;
|FPRC;

|PROCESO NoSigas;
     #silcon18#18 = "";
     #silcon18#19 = "";
     #silcon18#20 = "-";
     #silcon18#21 = " ";
     |GRABA 020#silcon18.a;
|FPRC;

|DEFBUCLE NoSigas;
     #silcon18#1;
     21, 18;
     "-", 000001, "*", "          ";
     "-", 999999, "*", "          ";
     be;
     NULL, NoSigas;
|FIN;

|PROGRAMA;
     |CLS;
     |HAZ PaseAutorizacion;
     |HAZ tipo8;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ CreaLote;
     |SINO;
          || otra oportunidad de dejarlos como estaban
          |BUCLE NoSigas;
     |FINSI;
     |HAZ tipo9;
|FPRO;
