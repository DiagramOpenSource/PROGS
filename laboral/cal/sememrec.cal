|FICHEROS;
     sememrec #0;
     labempre #1;        || empresas
     labtraba #2;        || trabajadores
     semcalcb #3;        || calculos semanal cabs.
     semcalcl #4;        || calculos semanal lins.
     semconce #5;        || control conceptos
     semcntcu #6;        || control cuadres
     semequiv #7;        || equivalencia
     nomcalca #8;        || calculos cabs.
     nomficmo #9;        || desglose moneda
     semtraba #10;       || datos semana
     semetiqu #11;       || impresion etiquetas
     semempre #12;       || control empresas
     nomhicca #13;       || historico cabs.
     semcntcu;
|FIN;

|VARIABLES;
     informe = "";

     sdia = 0;
     smas = 0;
     sdife = 0;
     srest = 0;

     alfa1 = "";
     alfa2 = "";
     fech1 = @;
     fech2 = @;
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;

     &Fech11 = "";
     &Fech12 = "";
     &Fech21 = "";
     &Fech22 = "";
     aGuardaFech11 = "";
     aGuardaFech12 = "";
     aGuardaFech21 = "";
     aGuardaFech22 = "";
     &Cod = "";
     &Nom = "";

     Semana = 0;
     Mes  = 0;
     Mes1 = 0;
     Mes2 = 0;
     MesAlfa = "";
     Year = 0;
     Comodin = "";
     Cont = 0;
     DTipo = 0;
     HTipo = 0;

     SwError = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nPara1 = 0;
     nPara2 = 0;
     nPara3 = 0;
     nSwNoVale = 0;
     nSeleccio = 0;
     nLiquidoMes = 0;
     &enEmpre = 0;
     &enTraba = 0;
     &enAnyo = 0;
     &enSemana = 0;
     &enTipo = 0;
     &enSBa = 0;
     &enEsp = 0;

          || acumuladores para la comprobacion
     &nC06 = 0;
     &nC08 = 0;
     &nC10 = 0;
     &nC11 = 0;
     &nC12 = 0;
     &nC13 = 0;
     &nC14 = 0;
     &nC15 = 0;
     &nC16 = 0;
     &nC17 = 0;
     &nC18 = 0;
     &nC19 = 0;
     &nV06 = 0;
     &nV08 = 0;
     &nV10 = 0;
     &nV11 = 0;
     &nV12 = 0;
     &nV13 = 0;
     &nV14 = 0;
     &nV15 = 0;
     &nV16 = 0;
     &nV17 = 0;
     &nV18 = 0;
     &nV19 = 0;

          || acumuladores para desglose de efectivos
     &nM01 = 0;
     &nM02 = 0;
     &nM03 = 0;
     &nM04 = 0;
     &nM05 = 0;
     &nM06 = 0;
     &nM07 = 0;
     &nM08 = 0;
     &nM09 = 0;
     &nM10 = 0;
     &nM11 = 0;
     &nM12 = 0;
     &nM13 = 0;
     &nM14 = 0;
     &nM15 = 0;
     &nM16 = 0;
     &nM17 = 0;
     &nM18 = 0;
     &nM19 = 0;
     &nM20 = 0;
     &nT01 = 0;
     &nT02 = 0;
     &nT03 = 0;
     &nT04 = 0;
     &nT05 = 0;
     &nT06 = 0;
     &nT07 = 0;
     &nT08 = 0;
     &nT09 = 0;
     &nT10 = 0;
     &nT11 = 0;
     &nT12 = 0;
     &nT13 = 0;
     &nT14 = 0;
     &nT15 = 0;
     &nT16 = 0;
     &nT17 = 0;
     &nT18 = 0;
     &nT19 = 0;
     &nT20 = 0;

          || acumuladores para resumen
     &nTA = 0;
     &nTB = 0;
     &nTC = 0;
     &nTD = 0;
     &nTE = 0;
     &nTF = 0;
     &nTG = 0;
     &nTH = 0;
     &nTX = 0;
     &nTI = 0;
     &nTS = 0;
     &nPA = 0;
     &nPB = 0;
     &nPC = 0;
     &nPD = 0;
     &nPE = 0;
     &nPF = 0;
     &nPG = 0;
     &nPH = 0;
     &nPX = 0;
     &nPI = 0;
     &nPS = 0;
     nSwMismaSemana = 0;
     nViernes = 0;
     fFech1 = @;
     fFech2 = @;
     fFech3 = @;
     fFech4 = @;
     nFinMes = 0;
     nEtiq = 0;
     &nAntEmpre = 0;
     &aNomEmpre = "";
     nMoneda = 0;
     nAvisoMes = 0;
     &nLiquido2 = 0;
     &EURODB = 0;
|FIN;
____________________________________/
|PROCESO AcumulaMonedas;
     |SI nMoneda =  1;  nM01 = nM01 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  2;  nM02 = nM02 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  3;  nM03 = nM03 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  4;  nM04 = nM04 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  5;  nM05 = nM05 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  6;  nM06 = nM06 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  7;  nM07 = nM07 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  8;  nM08 = nM08 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda =  9;  nM09 = nM09 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 10;  nM10 = nM10 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 11;  nM11 = nM11 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 12;  nM12 = nM12 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 13;  nM13 = nM13 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 14;  nM14 = nM14 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 15;  nM15 = nM15 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 16;  nM16 = nM16 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 17;  nM17 = nM17 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 18;  nM18 = nM18 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 19;  nM19 = nM19 + #nomficmo#nPara2#;  |FINSI;
     |SI nMoneda = 20;  nM20 = nM20 + #nomficmo#nPara2#;  |FINSI;

     nT01 = nM01 * #nomficmo#1;
     nT02 = nM02 * #nomficmo#2;
     nT03 = nM03 * #nomficmo#3;
     nT04 = nM04 * #nomficmo#4;
     nT05 = nM05 * #nomficmo#5;
     nT06 = nM06 * #nomficmo#6;
     nT07 = nM07 * #nomficmo#7;
     nT08 = nM08 * #nomficmo#8;
     nT09 = nM09 * #nomficmo#9;
     nT10 = nM10 * #nomficmo#10;
     nT11 = nM11 * #nomficmo#11;
     nT12 = nM12 * #nomficmo#12;
     nT13 = nM13 * #nomficmo#13;
     nT14 = nM14 * #nomficmo#14;
     nT15 = nM15 * #nomficmo#15;
     nT16 = nM16 * #nomficmo#16;
     nT17 = nM17 * #nomficmo#17;
     nT18 = nM18 * #nomficmo#18;
     nT19 = nM19 * #nomficmo#19;
     nT20 = nM20 * #nomficmo#20;
|FPRC;

|PROCESO Desglose;
     nNume1 = #sememrec#41;
     |PARA nMoneda = 1; |SI nMoneda [ 20; |HACIENDO nMoneda = nMoneda + 1;
          nPara2 = nMoneda + 20;
          #nomficmo#nPara2# = 0;
          |SI #nomficmo#nMoneda# [ nNume1;
               #nomficmo#nPara2# = ((nNume1 / #nomficmo#nMoneda#) - .50);
               nNume1 = (nNume1 - (#nomficmo#nPara2# * #nomficmo#nMoneda#)) ! EURODB;
          |FINSI;
          |HAZ AcumulaMonedas;
     |SIGUE;
|FPRC;

|PROCESO LiquidoHistorico;
     |ABRE #nomhicca;
     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = #0#0 $ 100;
     #nomhicca#2 = Mes1;
     #nomhicca#3 = 0;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          nLiquidoMes = #nomhicca#46 - (#nomhicca#48 + #nomhicca#49 + #nomhicca#50 + #nomhicca#51 + #nomhicca#52 + #nomhicca#53 + #nomhicca#54 + #nomhicca#114);
     |SINO;
          #sememrec#55 = 0;
          aAlfa1 = "0000[" + #nomhicca#0 + "." + #nomhicca#1 + "] sin mes [" + #nomhicca#2 + "] calculado.";
          |SI nAvisoMes = 0;
               |MENAV aAlfa1;
               |AVISO;
               |CONFI "0000NContinuar avisando";
               nAvisoMes = FSalida;
          |SINO;
               |MENSA aAlfa1;
          |FINSI;
     |FINSI;
     |CIERRA #nomhicca;
|FPRC;

|PROCESO LiquidoMes;
     nLiquidoMes = 0;

     |SI #semequiv#4 = "M";|Y PARAMETRO ! "C";
          |ACABA;
     |FINSI;

     |ABRE #nomcalca;
     #nomcalca#0 = #labtraba#0;
     #nomcalca#1 = #labtraba#1;
     #nomcalca#2 = Mes1;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          nLiquidoMes = #nomcalca#46 - (#nomcalca#48 + #nomcalca#49 + #nomcalca#50 + #nomcalca#51 + #nomcalca#52 + #nomcalca#53 + #nomcalca#54 + #nomcalca#75);
     |SINO;
          |HAZ LiquidoHistorico;
     |FINSI;
     |CIERRA #nomcalca;
|FPRC;

|PROCESO CalculoLin_C;                       || COMPROBACION
     #semconce#0 = #semcalcl#6;    || aqui se utilizan variables para
     |LEE 000#semconce.=;          ||/poder sacar decimales
     |SI FSalida = 0;
          SwError = 1;
          |SI #semconce#5 = 1;     nC06 = nC06 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 2;     nC08 = #semcalcl#12;  |FINSI; || %antig.
          |SI #semconce#5 = 3;     nC10 = #semcalcl#12;  |FINSI; || %plus
          |SI #semconce#5 = 4;     nC11 = nC11 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 5;     nC12 = nC12 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 6;     nC13 = nC13 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 7;     nC14 = nC14 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 8;     nC15 = nC15 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 9;     nC16 = nC16 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 10;    nC17 = nC17 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 11;    nC18 = nC18 + #semcalcl#12;  |FINSI;
          |SI #semconce#5 = 12;    nC19 = nC19 + #semcalcl#12;  |FINSI;

          |SI #semconce#5 = 1;     nV06 = nV06 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 2;     nV08 = nV08 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 3;     nV10 = nV10 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 4;     nV11 = nV11 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 5;     nV12 = nV12 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 6;     nV13 = nV13 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 7;     nV14 = nV14 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 8;     nV15 = nV15 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 9;     nV16 = nV16 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 10;    nV17 = nV17 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 11;    nV18 = nV18 + #semcalcl#10;  |FINSI;
          |SI #semconce#5 = 12;    nV19 = nV19 + #semcalcl#10;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalculoLin_D;                       || RESUMEN
     #semconce#0 = #semcalcl#6;
     |LEE 000#semconce.=;
     |SI FSalida = 0;
          SwError = 1;

          |SI #semconce#5 = 2;|Y #sememrec#7 = 0; #sememrec#7 = #semcalcl#9; |FINSI;
          |SI #semconce#5 = 3;|Y #sememrec#9 = 0; #sememrec#9 = #semcalcl#9; |FINSI;

          |SI #semequiv#4 = "M";|Y Semana = 2;
               nSwMismaSemana = 1;      || en los mensuales no se parten
               Semana = 1;              ||/los importes
          |FINSI;

          |SI Semana = 1;
               |SI #semconce#5 = 1;     #sememrec#6  = #sememrec#6  + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 2;     #sememrec#8  = #sememrec#8  + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 3;     #sememrec#10 = #sememrec#10 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 4;     #sememrec#11 = #sememrec#11 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 5;     #sememrec#12 = #sememrec#12 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 6;     #sememrec#13 = #sememrec#13 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 7;     #sememrec#14 = #sememrec#14 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 8;     #sememrec#15 = #sememrec#15 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 9;     #sememrec#16 = #sememrec#16 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 10;    #sememrec#17 = #sememrec#17 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 11;    #sememrec#18 = #sememrec#18 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 12;    #sememrec#19 = #sememrec#19 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI Semana = 2;
               |SI #semconce#5 = 1;     #sememrec#25 = #sememrec#25 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 2;     #sememrec#26 = #sememrec#26 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 3;     #sememrec#27 = #sememrec#27 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 4;     #sememrec#28 = #sememrec#28 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 5;     #sememrec#29 = #sememrec#29 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 6;     #sememrec#30 = #sememrec#30 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 7;     #sememrec#31 = #sememrec#31 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 8;     #sememrec#32 = #sememrec#32 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 9;     #sememrec#33 = #sememrec#33 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 10;    #sememrec#34 = #sememrec#34 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 11;    #sememrec#35 = #sememrec#35 + #semcalcl#11; |FINSI;
               |SI #semconce#5 = 12;    #sememrec#36 = #sememrec#36 + #semcalcl#11; |FINSI;
          |FINSI;

          |SI nSwMismaSemana = 1;
               nSwMismaSemana = 0;
               Semana = 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalculoLin_R;                       || RECIBOS Y DESGLOSE MONEDA
     #semconce#0 = #semcalcl#6;
     |LEE 000#semconce.=;
     |SI FSalida = 0;
          SwError = 1;

          |SI #semequiv#4 = "M";|Y Semana = 2;
               nSwMismaSemana = 1;      || en los mensuales no se parten
               Semana = 1;              ||/los importes en recibos
          |FINSI;

          |SI #semconce#5 = 1;
               |SI Semana = 1; #sememrec#6  = #sememrec#6  + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#25 = #sememrec#25 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 2;
               |SI #sememrec#7 = 0; #sememrec#7 = #semcalcl#9; |FINSI;
               |SI Semana = 1; #sememrec#8  = #sememrec#8  + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#26 = #sememrec#26 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 3;
               |SI #sememrec#9 = 0; #sememrec#9 = #semcalcl#9; |FINSI;
               |SI Semana = 1; #sememrec#10 = #sememrec#10 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#27 = #sememrec#27 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 4;
               |SI Semana = 1; #sememrec#11 = #sememrec#11 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#28 = #sememrec#28 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 5;
               |SI Semana = 1; #sememrec#12 = #sememrec#12 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#29 = #sememrec#29 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 6;
               |SI Semana = 1; #sememrec#13 = #sememrec#13 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#30 = #sememrec#30 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 7;
               |SI Semana = 1; #sememrec#14 = #sememrec#14 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#31 = #sememrec#31 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 8;
               |SI Semana = 1; #sememrec#15 = #sememrec#15 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#32 = #sememrec#32 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 9;
               |SI Semana = 1; #sememrec#16 = #sememrec#16 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#33 = #sememrec#33 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 10;
               |SI Semana = 1; #sememrec#17 = #sememrec#17 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#34 = #sememrec#34 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 11;
               |SI Semana = 1; #sememrec#18 = #sememrec#18 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#35 = #sememrec#35 + #semcalcl#11; |FINSI;
          |FINSI;
          |SI #semconce#5 = 12;
               |SI Semana = 1; #sememrec#19 = #sememrec#19 + #semcalcl#11; |FINSI;
               |SI Semana = 2; #sememrec#36 = #sememrec#36 + #semcalcl#11; |FINSI;
          |FINSI;

          |SI nSwMismaSemana = 1;
               nSwMismaSemana = 0;
               Semana = 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalculoLin;
     |SI PARAMETRO = "";      |HAZ CalculoLin_R;  |FINSI;   || recibos
     |SI PARAMETRO = "E";     |HAZ CalculoLin_R;  |FINSI;   || etiquetas
     |SI PARAMETRO = "D";     |HAZ CalculoLin_D;  |FINSI;   || resumen
     |SI PARAMETRO = "C";     |HAZ CalculoLin_C;  |FINSI;   || comprobacion
     |SI PARAMETRO = "M";     |HAZ CalculoLin_R;  |FINSI;   || desglose
|FPRC;

|PROCESO Calculos;
     |SI #semcalcb#10 = 0;    |ACABA;   |FINSI;

     |SI nSwNoVale = 1;
               || los X solamente sale todo el moreno y la comprob. siempre
               || los X nunca sale blanco a no ser cambio de mes menos resumen
          |SI #semcalcb#5 = 0;          || blanco
               |SI nFinMes = 0;         || cambio mes
                    |SI PARAMETRO = "M";     |ACABA;   |FINSI;   || moneda
                    |SI PARAMETRO = "";      |ACABA;   |FINSI;   || recibo
               |FINSI;
               |SI PARAMETRO = "D";     |ACABA;   |FINSI;   || resumen
          |FINSI;
     |FINSI;

     |SI nSwNoVale = 2;
               || los M solamente salen los tipo 1, en la comprobacion,
               || en el recibo, y en las etiquetas
          |SI #semcalcb#5 = 0;                                   || BLANCO
               |SI PARAMETRO = "M";     |ACABA;   |FINSI;   || moneda
          |FINSI;
     |FINSI;

     |BUCLELIN 2CalculoLin#semcalcb;

     |SI #semequiv#4 = "M";|Y Semana = 2;
          nSwMismaSemana = 1;      || en los mensuales no se parten
          Semana = 1;              ||/los importes en recibos
     |FINSI;

     |SI Semana = 1;
          #sememrec#20 = #sememrec#6  + #sememrec#8  + #sememrec#10 + #sememrec#11;
          #sememrec#20 = #sememrec#20 + #sememrec#12 + #sememrec#13 + #sememrec#14;
          #sememrec#20 = #sememrec#20 + #sememrec#15 + #sememrec#16 + #sememrec#17;
          #sememrec#20 = #sememrec#20 + #sememrec#18 + #sememrec#19;
          || total devengado

          #sememrec#21 = #semcalcb#7;       || cuota s.s.
          #sememrec#22 = #labtraba#30;      || (%)irpf
          #sememrec#23 = #semcalcb#8;       || cuota irpf
          #sememrec#44 = #semcalcb#20;      || anticipos
          #sememrec#24 = #sememrec#21 + #sememrec#23 + #sememrec#44;  || total deducciones

          |SI nSwMismaSemana = 1;
               nNume1 = nPA * -1;
               nTA = nTA + nNume1;
               nTB = nTB - nPB;
               nTC = nTC - nPC;
               nTD = nTD - nPD;
               nTE = nTE - nPE;
               nTF = nTF - nPF;
               nTG = nTG - nPG;
               nTH = nTH - nPH;
               nTX = nTX - nPX;
               nTS = nTS - nPS;
               nTI = nTI - nPI;
          |FINSI;

          nTA = nTA + #sememrec#6 + #sememrec#8 + #sememrec#10;  || sb.+ant.+ben.
          nTB = nTB + #sememrec#11;                              || noct.
          nTC = nTC + #sememrec#12;                              || reten.
          nTD = nTD + #sememrec#13;                              || incen.
          nTE = nTE + #sememrec#14;                              || p.conv.
          nTF = nTF + #sememrec#15;                              || h.1
          nTG = nTG + #sememrec#16;                              || h.2
          nTH = nTH + #sememrec#17 + #sememrec#18 + #sememrec#19;|| espec.
          nTX = nTX + #sememrec#20;   || total devengado
          nTS = nTS + #sememrec#21;   || total seg.social
          nTI = nTI + #sememrec#23;   || total irpf
     |FINSI;

     |SI Semana = 2;
          #sememrec#37 = #sememrec#25 + #sememrec#26 + #sememrec#27 + #sememrec#28;
          #sememrec#37 = #sememrec#37 + #sememrec#29 + #sememrec#30 + #sememrec#31;
          #sememrec#37 = #sememrec#37 + #sememrec#32 + #sememrec#33 + #sememrec#34;
          #sememrec#37 = #sememrec#37 + #sememrec#35 + #sememrec#36;
          || total devengado

          #sememrec#38 = #semcalcb#7;       || cuota s.s.
          #sememrec#39 = #semcalcb#8;       || cuota irpf
          #sememrec#40 = #sememrec#38 + #sememrec#39;      || total deducciones

          nTA = nTA + #sememrec#25 + #sememrec#26 + #sememrec#27;|| sb.+ant.+ben.
          nTB = nTB + #sememrec#28;                              || noct.
          nTC = nTC + #sememrec#29;                              || reten.
          nTD = nTD + #sememrec#30;                              || incen.
          nTE = nTE + #sememrec#31;                              || p.conv.
          nTF = nTF + #sememrec#32;                              || h.1
          nTG = nTG + #sememrec#33;                              || h.2
          nTH = nTH + #sememrec#34 + #sememrec#35 + #sememrec#36;|| espec.
          nTX = nTX + #sememrec#37;   || total devengado
          nTS = nTS + #sememrec#38;   || total seg.social
          nTI = nTI + #sememrec#39;   || total irpf
     |FINSI;

     |SI nSwMismaSemana = 1;
          nSwMismaSemana = 0;
          Semana = 2;
     |FINSI;

     nPA = #sememrec#6 + #sememrec#8 + #sememrec#10 + #sememrec#25 + #sememrec#26 + #sememrec#27;   || sb.+ant.+ben.
     nPB = #sememrec#11 + #sememrec#28;                     || noct.
     nPC = #sememrec#12 + #sememrec#29;                     || reten.
     nPD = #sememrec#13 + #sememrec#30;                     || incen.
     nPE = #sememrec#14 + #sememrec#31;                     || p.conv.
     nPF = #sememrec#15 + #sememrec#32;                     || h.1
     nPG = #sememrec#16 + #sememrec#33;                     || h.2
     nPH = #sememrec#17 + #sememrec#18 + #sememrec#19 + #sememrec#34 + #sememrec#35 + #sememrec#36; || espec.
     nPX = #sememrec#20 + #sememrec#37;                     || total devengado
     nPS = #sememrec#21 + #sememrec#38;                     || t.s.social
     nPI = #sememrec#23 + #sememrec#39;                     || t.irpf

     || liquido
     #sememrec#41 = (#sememrec#20 - #sememrec#24) + (#sememrec#37 - #sememrec#40);

     |SI #semcalcb#5 ! 1;     || en los de negro no hay proceso fin de mes
          |SI nFinMes = 1;                        || fin de mes con dos semanas
               |SI Semana = 1;
                    #sememrec#45 = #semcalcb#21;
                    #sememrec#46 = #semcalcb#22;
                    #sememrec#47 = #semcalcb#23;
                    #sememrec#48 = #semcalcb#24;
                    #sememrec#49 = #semcalcb#25;
                    #sememrec#50 = #semcalcb#11;
                    #sememrec#51 = #semcalcb#12;
                    #sememrec#52 = #semcalcb#13;
                    #sememrec#53 = #semcalcb#14;
                    #sememrec#54 = #semcalcb#15;
                    #sememrec#55 = #sememrec#50 + #sememrec#51 + #sememrec#52 + #sememrec#53 + #sememrec#54 + (#sememrec#20 - #sememrec#24);
               |FINSI;
               |SI Semana = 2;
                    |SI #semequiv#4 = "M";
                         || en los mensuales la semana2 partida forma parte de la primera
                         #sememrec#55 = #sememrec#50 + #sememrec#51 + #sememrec#52 + #sememrec#53 + #sememrec#54 + (#sememrec#20 - #sememrec#24);
                    |FINSI;
                    |HAZ LiquidoMes;
                    #sememrec#56 = nLiquidoMes;
                    |SI Mes1 = 1;  #sememrec#57 = "ENERO.....";  |FINSI;
                    |SI Mes1 = 2;  #sememrec#57 = "FEBRERO...";  |FINSI;
                    |SI Mes1 = 3;  #sememrec#57 = "MARZO.....";  |FINSI;
                    |SI Mes1 = 4;  #sememrec#57 = "ABRIL.....";  |FINSI;
                    |SI Mes1 = 5;  #sememrec#57 = "MAYO......";  |FINSI;
                    |SI Mes1 = 6;  #sememrec#57 = "JUNIO.....";  |FINSI;
                    |SI Mes1 = 7;  #sememrec#57 = "JULIO.....";  |FINSI;
                    |SI Mes1 = 8;  #sememrec#57 = "AGOSTO....";  |FINSI;
                    |SI Mes1 = 9;  #sememrec#57 = "SEPTIEMBRE";  |FINSI;
                    |SI Mes1 =10;  #sememrec#57 = "OCTUBRE...";  |FINSI;
                    |SI Mes1 =11;  #sememrec#57 = "NOVIEMBRE.";  |FINSI;
                    |SI Mes1 =12;  #sememrec#57 = "DICIEMBRE.";  |FINSI;
                    #sememrec#58 = #sememrec#41 - (#sememrec#55 - #sememrec#56);
               |FINSI;
          |FINSI;

          |SI nFinMes = 2;              || fin de mes con una semana
               |SI Semana = 1;
                    #sememrec#45 = #semcalcb#21;
                    #sememrec#46 = #semcalcb#22;
                    #sememrec#47 = #semcalcb#23;
                    #sememrec#48 = #semcalcb#24;
                    #sememrec#49 = #semcalcb#25;
                    #sememrec#50 = #semcalcb#11;
                    #sememrec#51 = #semcalcb#12;
                    #sememrec#52 = #semcalcb#13;
                    #sememrec#53 = #semcalcb#14;
                    #sememrec#54 = #semcalcb#15;
                    #sememrec#55 = #sememrec#50 + #sememrec#51 + #sememrec#52 + #sememrec#53 + #sememrec#54 + (#sememrec#20 - #sememrec#24);

                    |SI #semequiv#4 = "M";
                         || en los mensuales la semana2 partida forma parte de la primera
                         #sememrec#55 = #sememrec#50 + #sememrec#51 + #sememrec#52 + #sememrec#53 + #sememrec#54 + (#sememrec#20 - #sememrec#24);
                    |FINSI;
                    |HAZ LiquidoMes;
                    #sememrec#56 = nLiquidoMes;
                    |SI Mes1 = 1;  #sememrec#57 = "ENERO.....";  |FINSI;
                    |SI Mes1 = 2;  #sememrec#57 = "FEBRERO...";  |FINSI;
                    |SI Mes1 = 3;  #sememrec#57 = "MARZO.....";  |FINSI;
                    |SI Mes1 = 4;  #sememrec#57 = "ABRIL.....";  |FINSI;
                    |SI Mes1 = 5;  #sememrec#57 = "MAYO......";  |FINSI;
                    |SI Mes1 = 6;  #sememrec#57 = "JUNIO.....";  |FINSI;
                    |SI Mes1 = 7;  #sememrec#57 = "JULIO.....";  |FINSI;
                    |SI Mes1 = 8;  #sememrec#57 = "AGOSTO....";  |FINSI;
                    |SI Mes1 = 9;  #sememrec#57 = "SEPTIEMBRE";  |FINSI;
                    |SI Mes1 =10;  #sememrec#57 = "OCTUBRE...";  |FINSI;
                    |SI Mes1 =11;  #sememrec#57 = "NOVIEMBRE.";  |FINSI;
                    |SI Mes1 =12;  #sememrec#57 = "DICIEMBRE.";  |FINSI;
                    #sememrec#58 = #sememrec#41 - (#sememrec#55 - #sememrec#56);
               |FINSI;
          |FINSI;

          |SI #semequiv#4 = "X";|Y nFinMes ! 0;

               nNume1 = (#sememrec#6 + #sememrec#8 + #sememrec#10) * -1;
               nTA = nTA + nNume1;                                    || sb.+ant.+ben.
               nTB = nTB - #sememrec#11;                              || noct.
               nTC = nTC - #sememrec#12;                              || reten.
               nTD = nTD - #sememrec#13;                              || incen.
               nTE = nTE - #sememrec#14;                              || p.conv.
               nTF = nTF - #sememrec#15;                              || h.1
               nTG = nTG - #sememrec#16;                              || h.2
               nTH = nTH - (#sememrec#17 + #sememrec#18 + #sememrec#19);|| espec.
               nTX = nTX - #sememrec#20;   || total devengado
               nTS = nTS - #sememrec#21;   || total seg.social
               nTI = nTI - #sememrec#23;   || total irpf

               nNume1 = (#sememrec#25 + #sememrec#26 + #sememrec#27) * -1;
               nTA = nTA + nNume1;                                    || sb.+ant.+ben.
               nTB = nTB - #sememrec#28;                              || noct.
               nTC = nTC - #sememrec#29;                              || reten.
               nTD = nTD - #sememrec#30;                              || incen.
               nTE = nTE - #sememrec#31;                              || p.conv.
               nTF = nTF - #sememrec#32;                              || h.1
               nTG = nTG - #sememrec#33;                              || h.2
               nTH = nTH - (#sememrec#34 + #sememrec#35 + #sememrec#36);|| espec.
               nTX = nTX - #sememrec#37;   || total devengado
               nTS = nTS - #sememrec#38;   || total seg.social
               nTI = nTI - #sememrec#39;   || total irpf

               |PDEFECTO #sememrec, 6, 42;
               |PDEFECTO #sememrec, 44, 56;
               #sememrec#58 = #sememrec#56;
               nPA = 0;
               nPB = 0;
               nPC = 0;
               nPD = 0;
               nPE = 0;
               nPF = 0;
               nPG = 0;
               nPH = 0;
               nPX = #sememrec#58;
               nPS = 0;
               nPI = 0;

               nTX = nTX + #sememrec#58;
          |FINSI;
     |FINSI;

     |SI PARAMETRO = "M";
          |HAZ Desglose;
     |FINSI;
|FPRC;

|DEFBUCLE Calculos;
     #semcalcb#1;
     ;
     #sememrec#0, #sememrec#1, Mes, #labtraba#0, #labtraba#1, DTipo;
     #sememrec#0, #sememrec#1, Mes, #labtraba#0, #labtraba#1, HTipo;
     ;
     NULL,Calculos;
|FIN;

|PROCESO Inicializa;
     |PDEFECTO #sememrec, 6, 42;
     SwError = 0;
     nC06 = 0;
     nC08 = 0;
     nC10 = 0;
     nC11 = 0;
     nC12 = 0;
     nC13 = 0;
     nC14 = 0;
     nC15 = 0;
     nC16 = 0;
     nC17 = 0;
     nC18 = 0;
     nC19 = 0;
     nV06 = 0;
     nV08 = 0;
     nV10 = 0;
     nV11 = 0;
     nV12 = 0;
     nV13 = 0;
     nV14 = 0;
     nV15 = 0;
     nV16 = 0;
     nV17 = 0;
     nV18 = 0;
     nV19 = 0;
     Fech11 = aGuardaFech11;
     Fech12 = aGuardaFech12;
     Fech21 = aGuardaFech21;
     Fech22 = aGuardaFech22;
     |SI #semequiv#4 = "M";
          Fech21 = "";
          Fech22 = "";
     |FINSI;
     |SI #semequiv#4 = "X";
          Fech11 = "";
          Fech12 = "";
          Fech21 = "";
          Fech22 = "";
     |FINSI;
|FPRC;

|PROCESO CodigoEquivalente;
     nSwNoVale = 0;

     |DDEFECTO #semequiv;
     #semequiv#1 = #labtraba#0;
     #semequiv#2 = #labtraba#1;
     |LEE 000#semequiv.=;
     |SI FSalida ! 0;
          nSwNoVale = -1;     || no existe (no se imprime)
     |SINO;
          |SI #0#81 = "S";    || seleccion por tipo de trabajador
               |SI #semequiv#4 ! #0#82;|Y #semequiv#4 ! #0#83;
                    nSwNoVale = -1;
               |FINSI;
          |SINO;
               |SI #semequiv#4 = "X";   nSwNoVale = 1; |FINSI;
               |SI #semequiv#4 = "M";   nSwNoVale = 2; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LasBajas;
     |SI #labtraba#37 ! "          ";|Y #labtraba#37 ! "..........";
          fFech3 = #labtraba#37;
          fFech4 = aGuardaFech11;
          |SI fFech3 < fFech4;
               aAlfa1 = "0000N[" + #labtraba#0 + "." + #labtraba#1 + "] esta de baja. Es finiquito: ";
               |AVISO;
               |CONFI aAlfa1;
               |SI FSalida ! 0;
                    SwError = 0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Trabajadores;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;

     #semempre#0 = #labtraba#0;
     |LEE 000#semempre.=;
     |SI FSalida ! 0;|O #semempre#2 = "N";
          |ACABA;
     |FINSI;

     |SI #0#43 = 1;|Y PARAMETRO = "D";
          |SI nAntEmpre = 0;
               nAntEmpre = #labtraba#0;
               aNomEmpre = #labempre#2;
          |FINSI;
          |SI nAntEmpre ! #labtraba#0;
               |PIEINF;
               |FININF;
               nTA = 0;  nTB = 0;  nTC = 0;  nTD = 0;
               nTE = 0;  nTF = 0;  nTG = 0;  nTH = 0;
               nTX = 0;  nTI = 0;  nTS = 0;
               |INFOR "semresum";
               nAntEmpre = #labtraba#0;
               aNomEmpre = #labempre#2;
          |FINSI;
     |SINO;
          nAntEmpre = 0;
          aNomEmpre = "";
     |FINSI;

     |HAZ CodigoEquivalente;
     |SI nSwNoVale = -1; |ACABA;   |FINSI;   || si no existe no imprime nada

     nSeleccio = 1;

     #semtraba#3 = #sememrec#0;
     #semtraba#4 = #sememrec#1;
     #semtraba#0 = #labtraba#0;
     #semtraba#1 = #labtraba#1;
     |LEE 000#semtraba.=;
     |SI FSalida = 0;|Y #semtraba#6 ! "01.01.0001";
          fech1 = #semtraba#6;          || datos de carga completa
          fech2 = #semtraba#7;
          |HAZ IniSemana;
     |SINO;
          |HAZ deshas;                  || recalcula fechas
     |FINSI;

     Cod = ("00000" + #labtraba#1) % -105;
     Nom = #labtraba#2;

     |SI #labtraba#36 ! "          ";|Y #labtraba#36 ! "..........";
          fFech3 = #labtraba#36;
          fFech4 = aGuardaFech12;
          |SI fFech3 > fFech4;
               |ACABA;             || aun no es alta
          |FINSI;
     |FINSI;

     DTipo = #sememrec#42;
     HTipo = #sememrec#42;
     |SI #sememrec#42 = 2;
          DTipo = 0;
          HTipo = 1;
     |FINSI;
     |HAZ Inicializa;
     Mes = Mes1;
     Semana = 1;
     |BUCLE Calculos;
     |SI PARAMETRO = "C";
          |SI SwError = 1;
               |HAZ LasBajas;
               |SI SwError = 1;
                    |PRINT;
               |FINSI;
          |FINSI;
          |HAZ Inicializa;
     |FINSI;
     |SI nFinMes = 1;
          Mes = Mes2;
          Semana = 2;
          |BUCLE Calculos;
     |FINSI;
     |SI SwError = 1;
          |HAZ LasBajas;
          |SI SwError = 1;
               |SI #sememrec#41 ! 0;|O #sememrec#58 ! 0;
                    |SI PARAMETRO ! "E";
                         nLiquido2 = #sememrec#37 - #sememrec#40; || 2da.parte semana
                         |PRINT;
                    |SINO;
                         nNume1 = ((nEtiq - 1) * 3);
                         #semetiqu#nNume1# = #semequiv#0;
                         nNume1 = ((nEtiq - 1) * 3) + 1;
                         #semetiqu#nNume1# = #labtraba#2;
                         nNume1 = ((nEtiq - 1) * 3) + 2;
                         |SI #sememrec#58 ! 0;
                              #semetiqu#nNume1# = #sememrec#58;  || fin de mes
                         |SINO;
                              #semetiqu#nNume1# = #sememrec#41;
                         |FINSI;
                         |SI nEtiq = 4;
                              |PRINT;
                              |DDEFECTO #semetiqu;
                              nEtiq = 0;
                         |FINSI;
                         nEtiq = nEtiq + 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Ordena4;
     |DDEFECTO #semequiv;
     #semequiv#1 = #labtraba#0;
     #semequiv#2 = #labtraba#1;
     |LEE 000#semequiv.=;
|FPRC;

|DEFBUCLE Trabajadores4;
     #labtraba#1;
     ;
     #sememrec#2,#sememrec#4;
     #sememrec#3,#sememrec#5;
     ;
     NULL,Ordena4,NULL,NULL,NULL,Trabajadores;
     #semequiv#5, #labtraba#0, #labtraba#1;
|FIN;

|DEFBUCLE Trabajadores3;
     #labtraba#1;
     ;
     #sememrec#2,#sememrec#4;
     #sememrec#3,#sememrec#5;
     ;
     NULL,NULL,NULL,NULL,NULL,Trabajadores;
     #labtraba#75, #labtraba#0, #labtraba#1;
|FIN;

|DEFBUCLE Trabajadores2;
     #labtraba#3;
     0, 1;
     "                                        ", #sememrec#2,#sememrec#4;
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", #sememrec#3,#sememrec#5;
     ;
     NULL,Trabajadores;
|FIN;

|DEFBUCLE Trabajadores1;
     #labtraba#1;
     ;
     #sememrec#2,#sememrec#4;
     #sememrec#3,#sememrec#5;
     ;
     NULL,Trabajadores;
|FIN;

|PROCESO Empresas;
     |SI #0#60 = 0;
          |SI #0#43 = 1; |BUCLE Trabajadores1;    |FINSI;   || por codigo
          |SI #0#43 = 2; |BUCLE Trabajadores2;    |FINSI;   || por nombre
          |SI #0#43 = 3; |BUCLE Trabajadores3;    |FINSI;   || por NAFSS
          |SI #0#43 = 4; |BUCLE Trabajadores4;    |FINSI;   || por nro.orden
     |SINO;
          |ABRE #labtraba;
          |PARA nPara1 = 60; |SI nPara1 [ 69; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 10;
               #labtraba#0 = #sememrec#nPara1#;
               #labtraba#1 = #sememrec#nPara2#;
               |LEE 000#labtraba.=;
               |SI FSalida = 0;|Y #labtraba#0 ! 0;|Y #labtraba#1 ! 0;
                    |HAZ Trabajadores;
               |FINSI;
          |SIGUE;
          |CIERRA #labtraba;
     |FINSI;
|FPRC;

|PROCESO mirasem; |TIPO 7;
    alfa1 = #0#0;
    alfa1 = "01.01." + alfa1;
    fech1 = alfa1;            || primero saca el dia de la semana
    fech2 = fech1 % 1;        ||/que fue el uno de enero
    alfa1 = fech2 % 11;

|SI alfa1 = "Lunes";     sdia=1; smas=1; |FINSI;
|SI alfa1 = "Martes";    sdia=7; smas=1; |FINSI;
|SI alfa1 = "Miercoles"; sdia=6; smas=1; |FINSI;
|SI alfa1 = "Jueves";    sdia=5; smas=1; |FINSI; ||saca el dia del mes que fue
|SI alfa1 = "Viernes";   sdia=4; smas=1; |FINSI; ||el primer lunes del a¤o
|SI alfa1 = "Sabado";    sdia=3; smas=1; |FINSI;
|SI alfa1 = "Domingo";   sdia=2; smas=1; |FINSI;

    alfa1 = ("00" + sdia) % -102;  || construye el primer lunes del a¤o
    fech1 = ~;                     ||/como fecha inicial de calculo
    alfa2 = fech1 % -104;
    alfa1 = alfa1 + ".01." + alfa2;
    fech1 = alfa1;
    nume1 = fech1;                 || calcula dias hasta primer lunes a¤o

    fech1 = ~;                     || calcula dias hasta fecha actual
    nume2 = fech1;

    sdife = nume2 - nume1;         || calcula la diferencia desde el primer
    |SI sdife ] 0;
        srest = sdife $ 7;           || lunes hasta la fecha actual,la redondea,
        sdife = sdife + (7 - srest); || la divide por 7 y le suma 1 por la
        #0Campo = (sdife / 7) + smas;|| primera semana (en su caso !!!)
    |SINO;
        #0Campo = 1;
    |FINSI;

    |ABRE #semcntcu;     |LEE 000#semcntcu.p;     |CIERRA #semcntcu;

    #0Campo = #0Campo - #semcntcu#3;
    |SI #0Campo = 0; #0Campo = 52; |FINSI;

    |PINTA #0Campo;
|FPRC;

|PROCESO UltimoViernes;
     nViernes = 0;
     |PARA fFech1 = fech1; |SI fFech1 [ fech2; |HACIENDO fFech1 = fFech1 + 1;
          fFech2 = fFech1 % 1;
          alfa1 = fFech2 % 11;
          |QBF alfa1;
          |SI alfa1 = "Viernes";
               alfa1 = fFech1 % 402;
               nume1 = fFech1;
               nume1 = nume1 + 7;
               fFech2 = nume1;
               alfa2 = fFech2 % 402;
               |SI alfa2 ! alfa1;
                    nViernes = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO IniSemana;
     |HAZ UltimoViernes;

     MesAlfa = fech1 % 0402;
     Mes1 = MesAlfa;
     MesAlfa = fech2 % 0402;
     Mes2 = MesAlfa;
     Comodin = fech1 % -104;
     Year = Comodin;

     Comodin = fech1 % -108;
     |SI Mes1 = 1;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 2;
          |SI Year = 2000; |O Year = 2004; |O Year = 2008; |O Year = 2012;
           |O Year = 2016;  |O Year = 2020; |O Year = 2024; |O Year = 2028;
           |O Year = 2032;  |O Year = 2036; |O Year = 2040; |O Year = 2044;
               Comodin = "29" + Comodin;
          |SINO;
               Comodin = "28" + Comodin;
          |FINSI;
     |FINSI;
     |SI Mes1 = 3;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 4;  Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 5;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 6;  Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 7;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 8;  Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 9;  Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 10; Comodin = "31" + Comodin; |FINSI;
     |SI Mes1 = 11; Comodin = "30" + Comodin; |FINSI;
     |SI Mes1 = 12; Comodin = "31" + Comodin; |FINSI;

     nFinMes = 0;
     |SI Mes1 ! Mes2;
          nFinMes = 1;                  || fin de mes con cambio de mes
          Fech11  = fech1;
          Fech12  = Comodin;
          Comodin = fech2 % -108; Comodin = "01" + Comodin;
          Fech21  = Comodin;
          Fech22 = fech2;
     |SINO;
          |SI fech2 = Comodin;          || fin de mes sin cambio de mes
               nFinMes = 2;
          |FINSI;
          Fech11 = fech1;
          Fech12 = fech2;
          Fech21 = "";
          Fech22 = "";
     |FINSI;

     aGuardaFech11 = Fech11;   || en los M y en los X se altera
     aGuardaFech12 = Fech12;
     aGuardaFech21 = Fech21;
     aGuardaFech22 = Fech22;

|FPRC;

|PROCESO deshas;              || calcula segun semana, desde dia hasta dia
     |ABRE #semcntcu;     |LEE 000#semcntcu.p;     |CIERRA #semcntcu;

     nume2 = (#0#1 + #semcntcu#3) - smas;
     nume2 = (nume2 * 7) + (sdia - 1);   || dias hasta
     nume1 = nume2 - 6;                  || dias desde

     nume3 = #0#0;
     nume3 = nume3 - 1;
     alfa1 = "31.12." + nume3;    || saca los dias que hay hasta el 31.12
     fech1 = alfa1;
     nume3 = fech1;

     nume1 = nume1 + nume3;
     fech1 = nume1;         || fecha desde

     nume2 = nume2 + nume3;
     fech2 = nume2;         || fecha hasta

     |HAZ IniSemana;
|FPRC;

|PROCESO VersionAnterior; |TIPO 7;
     |SI #0#81 ! "S";|Y #0#81 ! "N";
          |PDEFECTO #0, 81, 82;
          |PINTA #0#81;
     |FINSI;
|FPRC;

|PROCESO LimpiaTipos; |TIPO 0;
     |SI #0#81 = "N";
          #0#82 = "";    |PINTA #0#82;
          #0#83 = "";    |PINTA #0#83;
          |C_M #0#82, 1, "N";
          |C_M #0#83, 1, "N";
     |SINO;
          |C_M #0#82, 1, "S";
          |C_M #0#83, 1, "S";
     |FINSI;
|FPRC;

|PROCESO EnBlanco82; |TIPO 0;
     |SI #0#81 = "S";
          |SI #0#82 = " ";
               |MENAV "0000Debera introducir un tipo valido.";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnBlanco83; |TIPO 0;
     |SI #0#81 = "S";
          |SI #0#83 = " ";
               #0#83 = #0#82;
               |PINTA #0#83;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Comprobacion; |TIPO 7;
     |SI PARAMETRO = "C";
          #sememrec#43 = 4;
          |PINTA #sememrec#43;
     |FINSI;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
     |SI PARAMETRO = "M";
          #sememrec#42 = 1;
          |PINTA #sememrec#42;
     |FINSI;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
     |SI PARAMETRO = "";|O PARAMETRO = "M";|O PARAMETRO = "D";|O PARAMETRO = "E";
          |SI #sememrec#42 > 1;
               |MENAV "0000Opcion no permitida.";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Parrilla7; |TIPO 7;
     |C_M #0#60, 1, "S";
|FPRC;

|PROCESO Parrilla0; |TIPO 0;
     |SI #0#60 = 0;
          |PDEFECTO #0, 60, 80;
          |PINDA #0#0;
          aAlfa1 = "N";
          aAlfa2 = "S";
     |SINO;
          aAlfa1 = "S";
          aAlfa2 = "N";
     |FINSI;
     |C_M #0#60, 1, aAlfa1;
     |C_M #0#61, 1, aAlfa1;
     |C_M #0#62, 1, aAlfa1;
     |C_M #0#63, 1, aAlfa1;
     |C_M #0#64, 1, aAlfa1;
     |C_M #0#65, 1, aAlfa1;
     |C_M #0#66, 1, aAlfa1;
     |C_M #0#67, 1, aAlfa1;
     |C_M #0#68, 1, aAlfa1;
     |C_M #0#69, 1, aAlfa1;
     |C_M #0#70, 1, aAlfa1;
     |C_M #0#71, 1, aAlfa1;
     |C_M #0#72, 1, aAlfa1;
     |C_M #0#73, 1, aAlfa1;
     |C_M #0#74, 1, aAlfa1;
     |C_M #0#75, 1, aAlfa1;
     |C_M #0#76, 1, aAlfa1;
     |C_M #0#77, 1, aAlfa1;
     |C_M #0#78, 1, aAlfa1;
     |C_M #0#79, 1, aAlfa1;

     |C_M #0#43, 1, aAlfa2;
     |C_M #0#2, 1, aAlfa2;
     |C_M #0#3, 1, aAlfa2;
     |C_M #0#4, 1, aAlfa2;
     |C_M #0#5, 1, aAlfa2;
|FPRC;

|PROCESO Etiqueta; |TIPO 7;
     |SI PARAMETRO = "E";
          |C_M #0#80, 1, "S";
     |SINO;
          |C_M #0#80, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROGRAMA;
     |SI enEmpre ! 0;      || viene de SUB_EJECUTA
          #0#0 = enAnyo;
          #0#1 = enSemana;
          #0#2 = enEmpre;
          #0#3 = enEmpre;
          #0#4 = enTraba;
          #0#5 = enTraba;
          #0#42 = enTipo;
          |HAZ deshas;
     |SINO;
          |CLS;
          |PINPA #0#0;
          |ABRE #sememrec;
          |LEE 101#sememrec.=;
          |SI FSalida ! 0;    |GRABA 020#sememrec.b;   |FINSI;
          |PINDA #0#0;
          |SI PARAMETRO = "";
               |CABEZA "Recibos Semanal";
          |SINO;
               |SI PARAMETRO = "D";
                    |CABEZA "Resumen Semanal";
                    |ATRI R;
                    |PINTA 0604, "  LISTADO IMPORTES SEMANALES ";
                    |ATRI N;
               |SINO;
                    |SI PARAMETRO = "C";
                         |CABEZA "Comprobacion";
                         |ATRI R;
                         |PINTA 0604, "  COMPROBACION UNIDADES      ";
                         |ATRI N;
                    |SINO;
                         |SI PARAMETRO = "M";
                              |CABEZA "Desglose Moneda";
                              |ATRI R;
                              |PINTA 0604, "  DESGLOSE EN MONEDA         ";
                              |ATRI N;
                              |ABRE #nomficmo;
                              |LEE 000#nomficmo.p;
                              |CIERRA #nomficmo;
                         |SINO;
                              |SI PARAMETRO = "E";
                                   |CABEZA "Emision Etiquetas";
                                   |ATRI R;
                                   |PINTA 0604, "  EMISION DE ETIQUETAS       ";
                                   |ATRI N;
                              |SINO;
                                   |CABEZA "2da.parte semana";
                                   |ATRI R;
                                   |PINTA 0604, "  2DA. PARTE SEMANA          ";
                                   |ATRI N;
                              |FINSI;
                         |FINSI;
                    |FINSI;
              |FINSI;
          |FINSI;
          |ENDATOS #1#0;
          |SI FSalida < 0; |ACABA; |FINSI;
          |GRABA 020#sememrec.a;
          |LIBERA #sememrec;
          |CIERRA #sememrec;
     |FINSI;

     |ABRE #semcntcu;
     |LEE 000#semcntcu.p;
     |CIERRA #semcntcu;

     nEtiq = #sememrec#80;         || etiqueta inicial

     |IMPRE 0;
     |SI FSalida < 0; |ACABA; |FINSI;
     |SI PARAMETRO ! "";
          |SI PARAMETRO = "D";    |INFOR "semresum";  |FINSI;
          |SI PARAMETRO = "C";    |INFOR "semcompr";  |FINSI;
          |SI PARAMETRO = "M";    |INFOR "semmoned";  |FINSI;
          |SI PARAMETRO = "E";    |INFOR "semetiqu";  |FINSI;
          |SI PARAMETRO = "S";    |INFOR "semseman";  |FINSI;
          |SI FSalida < 0; |ACABA; |FINSI;
     |SINO;
          |SI #sememrec#42 = 0;
               informe = #semcntcu#1;
          |SINO;
               informe = #semcntcu#2;
          |FINSI;
          |INFOR informe;
          |SI FSalida < 0;
               |AVISO;
               informe= "0000Informe " + informe + ".inf inexistente";
               |MENAV informe;
               |ACABA;
         |FINSI;
     |FINSI;

     |SI PARAMETRO = "S";     || en el informe de 2da.parte de semana
          PARAMETRO = "";     ||/actual igual que con los recibos
     |FINSI;

     |ABRE #semconce;
     |ABRE #semcalcb;
     |ABRE #semequiv;
     |ABRE #semtraba;
     |ABRE #semempre;
     |ABRE #labempre;
     |SELECT #2#semequiv;
     |HAZ Empresas;
     |CIERRA #labempre;
     |CIERRA #semempre;
     |CIERRA #semequiv;
     |CIERRA #semcalcb;
     |CIERRA #semconce;
     |CIERRA #semcntcu;
     |CIERRA #semtraba;

     |SI nSeleccio = 1;
          |SI PARAMETRO = "E";
               |SI nEtiq ! 0; |PRINT;   |FINSI;
          |FINSI;
          |PIEINF;
     |SINO;
          |MENAV "0000Seleccion vacia ...";
     |FINSI;
     |FININF;
     |FINIMP;
|FPRO;
