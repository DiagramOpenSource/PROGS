|FICHEROS;
    labcerju #0;
    labempre #1;         || empresas
    labtraba #2;         || trabajadores
    labcentr #3;         || centros
    labcon00 #4;         || decretos
    labregis #5;         || registro contratos
    labbasec #6;         || bases cabs.
    labbastm #7;         || bases lins. tmp.
    nomcalca #8;         || calculos cabs.
    nomvarca #9;         || variaciones cabs.
    labpadre #10;        || datos aux.
    labbasel #11;        || bases lins.
    silcon06 #30;        || datos AGIRED
    nomcalli;            || calculos lins.
    nomcontr;            || control aginom1
    nomhicca;            || historico calculos cabs.
    nomhicli;            || historico calculos lins.
|FIN;

|VARIABLES;
    mod = 0;
    xmesnume = 0;
    xtopemes = 0;
    xmod = 0;
    xanynume = 0;
    swactua = 0;
    swcabec = 0;
    lineades = 0;
    mas = 0;
    dm = 0;
    mesq = 0;
    hm = 0;
    mesbaja = 0;
    diabaja = 0;
    diaq = 0;
    gg = 0;
    borrar1 = 0;
    fm = 0;
    stop = 0;
    em = 0;
    borrar2 = 0;
    dias = 0;
    lineahas = 0;
    &puntero = 0;
    anyq = 0;
    nume1 = 0;
    verrfec = "0000ATENCION !! Fecha erronea o formato incorrecto ";
    vdia1 = "";
    vme1 = "";
    vany1 = "";
    vdia = 0;
    vme = 0;
    vany = 0;
    vtope = 0;
    vsw = 0;
    vfec = "";
    vblanco = "          ";
    vpuntos = "..........";
    v = 0;
    informe = "labcerju";
    mensa1 = "0000ATENCION !! No existe empresa ...";
    mensa2 = "0000ATENCION !! No existe trabajador ...";
    mensa3 = "0000ATENCION !! No existe centro de trabajo ...";
    meslet = "";
    &dia = "";
    &mes = "";
    &any = "";
    dia1 = "";
    any1 = "";
    fec1 = "";
    fec2 = 0;
    compactado = "";
    &domemp = "";
    &domtra = "";
    &domcen = "";
    &coma = ",";
    barra = "  /";
    direcc = "";
    numero = "";
    piso   = "";
    locali = "";
    dd = 0;
    cd = 0;
    cc = 0;
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    vcampo = 0;
    inicio = 0;
    ciudad = "";
    alfa = "";
    alfa1 = "";
    fecalf = "";
    fecsys = @;
    dias_alta = 0;
    dias_coti = 0;
    linea = 0;
    fech1 = @;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    &silcon1 = "";
    &silcon2 = "";
    &silcon3 = "";
    &silcon4 = "";
    &silcon5 = "";
    fFecha_Alta = @;
    fFecha_Baja = @;
    nFecha_Alta = 0;
    nFecha_Baja = 0;
    nDias_Alta  = 0;
    nDias_Vac   = 0;
    sw_finiq = 0;
    sw_dto = 0;
    nMes;
    &aAnyo = "";
    &aMes = "";
    nAnyo = 0;
    &nBaseCC_Fin = 0;
    &nBaseCP_Fin = 0;
    &Per1DA = "";    &Per2DA = "";   &Per3DA = "";   &Per4DA = "";
    &Per1MA = "";    &Per2MA = "";   &Per3MA = "";   &Per4MA = "";
    &Per1AA = "";    &Per2AA = "";   &Per3AA = "";   &Per4AA = "";
    &Per1DB = "";    &Per2DB = "";   &Per3DB = "";   &Per4DB = "";
    &Per1MB = "";    &Per2MB = "";   &Per3MB = "";   &Per4MB = "";
    &Per1AB = "";    &Per2AB = "";   &Per3AB = "";   &Per4AB = "";
    &locali_emp = "";
    &EURODB = 0;
    &mes1 = "";
    &anyo1 = "";
    &dias1 = 0;
    &baseCC1 = 0;
    &baseCP1 = 0;
    &grupo1 = "";
    &mes2 = "";
    &anyo2 = "";
    &dias2 = 0;
    &baseCC2 = 0;
    &baseCP2 = 0;
    &grupo2 = "";
    contador = 0;
    &swLinea = 0;
|FIN;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO variacion; |TIPO 7;
|ABRE #2;
    #2#0 = #0#0;
    #2#1 = #0#1;
|LEE 000#2=;
|SI #2#37 = "..........";|O #2#37 = "          ";|O #2#37 = "";
        fecsys = ~;
        fecalf = fecsys;
        alfa1 = fecalf % 402;
    |ABRE #9;
        #9#0 = #0#0;    || empresa
        #9#1 = #0#1;    || trabajador
        #9#2 = alfa1;   || mes
        #9#3 = 0;       || tipo
    |LEE 000#9=;
    |SI FSalida ! 0;
            #9#2 = #9#2 + 1;      || mes siguiente si no esta el actual
        |LEE 000#9=;
        |SI FSalida ! 0;
            |DDEFECTO #9;
        |FINSI;
    |FINSI;
        #0#8 = #9#16;
    |CIERRA #9;
|SINO;
        #0#8 = #2#37;
|FINSI;
|PINTA #0#8;
|CIERRA #2;
|FPRC;

|PROCESO leeempre;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #1;                    || DE LA RELACION CON EL FICHERO DE
        #1#0 = #0#0;          || EMPRESAS
|LEE 000#1=;
|SI FSalida = 0;
    ||PINTA 0731,#1#2;
        ciudad = #1#6;
    |QBF ciudad;
        ciudad = "                              " + ciudad;
        ciudad = ciudad % -130;
        #1#6 = ciudad;
|SINO;
    |MENAV mensa1;
        #0#0 = 0;
    |ERROR;
|FINSI;
#0#2 = #1#15;            || Representante (persona que certifica)
#0#3 = #1#18;            || Cargo
|PINTA #0#2;
|PINTA #0#3;

|CIERRAT #1;
|FPRC;

|PROCESO leetraba;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #2;                    || EN LA RELACION CON EL FICHERO DE
    #2#0 = #0#0;              || TRABAJADORES
    #2#1 = #0#1;
|LEE 000#2=;
|SI FSalida = 0;
    |PINTA 0831, #2#2;
|SINO;
    |MENAV mensa2;
        #0#1 = 0;
    |ERROR;
|FINSI;
|CIERRAT #2;
|FPRC;

|PROCESO leecentr;|TIPO 0;    || CALCULO PARA ASEGURAR EFECTIVIDAD
|ABRET #3;                    || DE LA RELACION CON EL FICHERO DE
        #3#0 = #0#0;          || CENTROS DE TRABAJO
        #3#1 = #0#2;
|LEE 000#3=;
|SI FSalida = 0;
    |PINTA 0931,#3#2;
|SINO;
    |MENAV mensa3;
        #0#2 = 0;
    |ERROR;
|FINSI;
|CIERRAT #3;
|FPRC;

|PROCESO fechacon1; |TIPO 0;
        vfec = #0Campo; vsw = 0;
|SI vfec ! vblanco; |Y vfec ! vpuntos;
  vdia1 = vfec % A102;
  vme1 = vfec % A402;
  vany1 = vfec % A704;
  vdia = vdia1; vme = vme1; vany = vany1;
  |SI vdia ! 0; |Y vme ! 0; |Y vany > 1900;
     |SI vme [ 12; |Y vme ] 1;
       |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7; |O vme = 8; |O vme = 10; |O vme = 12;
           vtope = 31;
       |SINO;
           |SI vme = 2;
               mod = vany $ 4;
               |SI mod = 0;
                   vtope = 29;
               |SINO;
                   vtope = 28;
               |FINSI;
            |SINO;
               vtope = 30;
            |FINSI;
        |FINSI;
        |SI vdia [ vtope;
            vsw = 1;
        |FINSI;
     |FINSI;
  |FINSI;
|SINO;
  vsw = 1;
|FINSI;
|SI vsw = 0;
    |MENAV verrfec;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;
     fecsys = ~;
     alfa1 = fecsys;
     #0Campo = alfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO imporant; |TIPO 7;
    #0#11 = #0#4 * #0#5;
|FPRC;

|PROCESO impornue; |TIPO 7;
    #0#12 = #0#6 * #0#7;
|FPRC;
____________________________________/
|PROCESO lee_lineas1;
    linea = linea + 1;
|DDEFECTO #7;
    #7#0 = #11#0;
    #7#1 = #11#1;
    #7#2 = linea;
    #7#3 = #11#3;
    #7#4 = #11#4;
    #7#5 = #11#5;
    #7#6 = #11#6;
    #7#7 = #11#7;
    #7#8 = #11#8;
    #7#9 = #11#9;
|GRABA 020#7n;
|FPRC;

|PROCESO ordena;
    fech1 = #11#3;
|FPRC;

|DEFBUCLE lee_lineas;
 #11#1;
 ;
 #0#0, #0#1,   1;
 #0#0, #0#1, 999;
 ;
 NULL, ordena, NULL, NULL, NULL, lee_lineas1;
 #11#0, #11#1, fech1, #11#2;
|FIN;

|PROCESO temporal;
|ATRI P;
|MENSA "    Preparando Temporal ...";
|ATRI 0;

    alfa1 = Usuario;     alfa1 = (alfa1 + "zzzzzzzz") % 108;
|NOME_DAT #7 alfa1;
|DELINDEX #7;
|ABRE #7;
|BUCLE lee_lineas;
|CIERRA #7;

|ATRI R;
|BLIN 4;
|ATRI 0;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
|IMPRE 0;
|SI FSalida = 0;
    |HAZ temporal;
    |ABRE #6;
    |ABRE #nomcalli;
    |HAZ fechafir;
    |HAZ domicili;
    |HAZ periodos;
    |HAZ sibaja;
    |HAZ lee_silcon;
    |PARA v = 1; |SI v [ #0#18; |HACIENDO v = v + 1;
        |HAZ cotiza;
        ||INFOR informe;
        ||PRINT;
        ||PIEINF;
        ||FININF;
    |SIGUE;
    |HAZ nobaja;
    |CIERRA #6;
    |CIERRA #nomcalli;
    |DELINDEX #7;
|FINSI;
|FINIMP;
|FPRC;

|PROCESO fechafir;                         || DESGLOSE DE FECHA DE FIRMA
|SI #0#8 ! vpuntos; |Y #0#8 ! vblanco;
        fec1 = #0#8;
    |HAZ meseslet;
        dia = dia1;
        mes = meslet;
        any = any1;
|SINO;
        dia = "..";
        mes = "..........";
        any = "....";
|FINSI;
|FPRC;

|PROCESO meseslet;               || RUTINA GENERAL DE TRANSFORMACION
    dia1 = fec1 % 102;           || DE FECHAS A LETRAS
    any1 = fec1 % 704;
    fec1 = fec1 % 402;
    fec2 = fec1;
|SI fec2 = 1;  meslet = "Enero     ";   |FINSI;
|SI fec2 = 2;  meslet = "Febrero   ";   |FINSI;
|SI fec2 = 3;  meslet = "Marzo     ";   |FINSI;
|SI fec2 = 4;  meslet = "Abril     ";   |FINSI;
|SI fec2 = 5;  meslet = "Mayo      ";   |FINSI;
|SI fec2 = 6;  meslet = "Junio     ";   |FINSI;
|SI fec2 = 7;  meslet = "Julio     ";   |FINSI;
|SI fec2 = 8;  meslet = "Agosto    ";   |FINSI;
|SI fec2 = 9;  meslet = "Septiembre";   |FINSI;
|SI fec2 = 10; meslet = "Octubre   ";   |FINSI;
|SI fec2 = 11; meslet = "Noviembre ";   |FINSI;
|SI fec2 = 12; meslet = "Diciembre ";   |FINSI;
|FPRC;

|PROCESO diaanter;                          || RUTINA DEL CALCULO duracion
|SI xmesnume = 1;
        xtopemes = 31;
|FINSI;
|SI xmesnume = 2;
        xmod = xanynume $ 4;
    |SI xmod = 0;
            xtopemes = 29;
    |SINO;
            xtopemes = 28;
    |FINSI;
|FINSI;
|SI xmesnume = 3;   xtopemes = 31; |FINSI;
|SI xmesnume = 4;   xtopemes = 30; |FINSI;
|SI xmesnume = 5;   xtopemes = 31; |FINSI;
|SI xmesnume = 6;   xtopemes = 30; |FINSI;
|SI xmesnume = 7;   xtopemes = 31; |FINSI;
|SI xmesnume = 8;   xtopemes = 31; |FINSI;
|SI xmesnume = 9;   xtopemes = 30; |FINSI;
|SI xmesnume = 10;  xtopemes = 31; |FINSI;
|SI xmesnume = 11;  xtopemes = 30; |FINSI;
|SI xmesnume = 12;  xtopemes = 31; |FINSI;
|FPRC;

|PROCESO domicili;                    || RUTINA DEL CALCULO actualiz
    direcc = #1#3;                    || PARA CONSTRUCCION DOMICILIOS
    numero = #1#4;
    piso   = #1#5;
    locali = "";
|HAZ compac;
    domemp = compactado;              || domicilio empresa
    locali_emp = #1#6;
    |QBF locali_emp;
    locali_emp = "                              " + locali_emp;
    locali_emp = locali_emp % -130;
    direcc = #2#3;
    numero = #2#4;
    piso   = #2#5;
    locali = "";
|HAZ compac;
    domtra = compactado;              || domicilio trabajador
|FPRC;

|PROCESO compac;                      || SUBRUTINA DE RUTINA domicili
    compactado = "";                  || DE COMPACTACION DE CAMPOS
|QBF direcc;
|QBF numero;
|QBF piso;
|QBF locali;
    compactado = direcc + coma;
    compactado = compactado + numero;
    compactado = compactado + "-";
    compactado = compactado + piso;
    compactado = compactado + locali;
|FPRC;

|PROCESO lee_silcon;
    silcon1 = "";
    silcon2 = "";
    silcon3 = "";
    silcon4 = "";
    silcon5 = "";
|DDEFECTO #30;
|ABRE #30;
    #30#0 = #0#0;
|LEE 000#30=;
|SI FSalida = 0;
        silcon1 = "(NO ACOMPA¥A TC2" + &59;
        silcon2 = "Aut.TGSS";
        silcon3 = "del";
        silcon4 = #30#5;                || nro.autorizacion SILCON
        silcon5 = #30#6 + ")";          || fecha autorizacion SILCON
|FINSI;
|CIERRA #30;
|FPRC;

|PROCESO paramfiniq;
     sw_finiq = 0;
     nBaseCC_Fin = 0;
     nBaseCP_Fin = 0;
     |ABRE #nomcontr;
     #nomcontr#0 = 1;
     |LEE 000#nomcontr.=;
     |SI FSalida = 0;
          |SI #nomcontr#1 = "S";     ||vacaciones cotizables (125)
               sw_finiq = 1;
          |FINSI;
     |FINSI;
     |SI sw_finiq = 1;             || si vacaciones cotizables
          |SI #labempre#39 = 1;    || finiquito con recibo mes
               sw_finiq = 1;
          |SINO;                   || finiquito separado
               sw_finiq = 2;
          |FINSI;
     |FINSI;
     |CIERRA #nomcontr;
|FPRC;

/*
|PROCESO finiquito; |TIPO 7;
     |SI #0#70 = 0;
          #0#71 = 0;
          #0#72 = 0;
          |ACABA;
     |FINSI;

     fecalf = #0#8;
     |HAZ desglosa;
     nMes = mesq;
     nAnyo = anyq;
     |SI nAnyo ] 2000;            || a¤o para buscar en el historico
          nAnyo = nAnyo - 2000;
     |SINO;
          nAnyo = nAnyo - 1900;
     |FINSI;

     |HAZ paramfiniq;

     |SI sw_finiq ! 0;
          |SI sw_finiq = 2;             || recibo separado
              |ABRE #nomcalca;
              |ABRE #nomhicca;
               #nomcalca#0 = #0#0;
               #nomcalca#1 = #0#1;
               #nomcalca#2 = nMes;
               #nomcalca#3 = 2;
               |LEE 000#nomcalca.=;
               |SI FSalida = 0;
                    #0#71 = #nomcalca#39;
                    #0#72 = #nomcalca#40;
               |SINO;
                    #nomhicca#0 = #0#0;
                    #nomhicca#1 = #0#1;
                    #nomhicca#66 = nAnyo;
                    #nomhicca#2 = nMes;
                    #nomhicca#3 = 2;
                    |LEE 000#nomhicca.=;
                    |SI FSalida = 0;
                         #0#71 = #nomhicca#39;
                         #0#72 = #nomhicca#40;
                    |FINSI;
               |FINSI;
               |CIERRA #nomcalca;
               |CIERRA #nomhicca;
          |FINSI;
          |SI sw_finiq = 1;             || recibo junto
          |ABRE #nomcalli;
          |ABRE #nomhicli;
               #nomcalli#0 = #0#0;
               #nomcalli#1 = #0#1;
               #nomcalli#2 = nMes;
               #nomcalli#3 = 0;
               #nomcalli#4 = 125;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    #0#71 = (#nomcalli#10 * #nomcalli#11) ! EURODB;
                    #0#72 = #0#71;
               |SINO;
                    #nomhicli#0 = #0#0;
                    #nomhicli#1 = #0#1;
                    #nomhicli#12 = nAnyo;
                    #nomhicli#2 = nMes;
                    #nomhicli#3 = 0;
                    #nomhicli#4 = 125;
                    |LEE 000#nomhicli.=;
                    |SI FSalida = 0;
                         #0#71 = (#nomhicli#10 * #nomhicli#11) ! EURODB;
                         #0#72 = #0#71;
                    |FINSI;
               |FINSI;
          |CIERRA #nomcalli;
          |CIERRA #nomhicli;
          |FINSI;
     |FINSI;
     |PINTA #0#71;
     |PINTA #0#72;
|FPRC;
*/

|PROCESO sibaja;  || actualiza el mes que esta calculado
    swactua = 0;
    swcabec = 0;
|SI #0#8 ! ".........."; |Y #0#8 ! "          "; |Y #0#8 ! "";
        #6#0 = #0#0;
        #6#1 = #0#1;
    |LEE 000#6=;
    |SI FSalida ! 0;
            #6#0 = #0#0;
            #6#1 = #0#1;
        |GRABA 020#6n;
            #7#3 = #2#36;  || carga la fecha de alta
            swcabec = 1;
            mas = 0;
    |SINO;
        |HAZ ultimo;
            mas = 1;
    |FINSI;
        fecalf=#7#3; |HAZ desglosa; dm=mesq;
        fecalf=#0#8; |HAZ desglosa; hm=mesq; mesbaja=mesq; diabaja=diaq;
    |SI dm ! hm;|O swcabec = 1;
        |SI hm < dm; gg = hm; hm = 999; |FINSI;
        |ABRE #7;
        |ABRE #8;
            borrar1 = lineades + 1;   || lo guarda para borrarlo despues
            fm = lineades;            || contador de lineas
            stop = 0;
        |PARA em = dm + mas; |SI stop = 0; |HACIENDO em = em + 1;
            |SI em = 13; em = 1; hm = gg; |FINSI;
            |SI em [ hm;
                    #8#0 = #2#0;   || empresa
                    #8#1 = #2#1;   || trabajador
                    #8#2 = em;     || mes
                    #8#3 = 0;      || tipo
                |LEE 000#8=;
                |SI FSalida = 0;
                        fm = fm + 1;
                        #7#0 = #0#0;          || empresa
                        #7#1 = #0#1;          || trabajador
                        #7#2 = fm;            || linea
                    |HAZ fecha;
                        #7#3 = fecalf;        || fecha
                        #7#4 = #8#8;          || dias cotizados
                        #7#5 = #8#11;         || horas contrato
                        #7#6 = #8#9;          || tipo contrato
                        #7#7 = #8#39;         || base contin. comunes
                        #7#8 = #8#40;         || base desempleo
                    |SI #8#65 ! 0;|Y #8#9 ! 87;|Y #8#9 ! 97;|Y #8#9 ! 85;
                            #7#7 = #7#7 + (#8#35 * #8#65);  || maternidad
                            #7#8 = #7#8 + (#8#35 * #8#65);
                    |FINSI;
                    |SI #8#132 ! 0;
                            #7#7 = #7#7 + #8#132;
                            #7#8 = #7#8 + #8#132;
                    |FINSI;
                        #7#9 = "";            || observaciones

                    |GRABA 020#7b;
                        swactua = 1;    || para saber si hay que borrar o no

                        #8#3 = 2;       || tipo (finiquitos)
                    |LEE 000#8=;
                    |SI FSalida = 0;
                        #7#7 = #7#7 + #8#39;  || base contin. comunes
                        #7#8 = #7#8 + #8#40;  || base desempleo
                        |SI #8#65 ! 0;|Y #8#9 ! 87;|Y #8#9 ! 97;|Y #8#9 ! 85;
                            #7#7 = #7#7 + (#8#35 * #8#65);  || maternidad
                            #7#8 = #7#8 + (#8#35 * #8#65);
                        |FINSI;
                        |GRABA 020#7a;
                    |FINSI;
                    |LIBERA #7;

                |SINO;
                    ||ATRI P;
                    ||    alfa1 = "    ATENCION! Recibo sin calcular del mes: " + em;
                    ||MENAV alfa1;
                    ||ATRI 0;
                |FINSI;
            |SINO;
                    stop = 1;
            |FINSI;
        |SIGUE;
        |SI swcabec = 1;|Y swactua = 0;
                #6#0 = #0#0;
                #6#1 = #0#1;
            |BORRA 020#6c;
        |FINSI;
            borrar2 = fm;   || para borrarlo despues
        |CIERRA #7;
        |CIERRA #8;
    |FINSI;
|FINSI;
|FPRC;

/*|PROCESO finiq;
     ||SI #0#73 = "N";   || siempre las quitara
     ||     #0#71 = 0;
     ||     #0#72 = 0;
     ||FINSI;
     aAnyo = #0#62;
     aMes = meslet;
     nume1 = puntero + 1;
     |SI nMes = fec2; |Y sw_dto = 0;
          #0#65 = #0#65 - #0#71;
          #0#66 = #0#66 - #0#72;
          sw_dto = 1;
     |FINSI;
|FPRC;
*/

|PROCESO inicializa;
    mes1 = "";
    anyo1 = "";
    dias1 = 0;
    baseCC1 = 0;
    baseCP1 = 0;
    grupo1 = "";
    mes2 = "";
    anyo2 = "";
    dias2 = 0;
    baseCC2 = 0;
    baseCP2 = 0;
    grupo2 = "";
    contador = 0;
|FPRC;

|PROCESO cotiza;
    #6#0 = #0#0;
    #6#1 = #0#1;
|LEE 000#6=;
|SI FSalida = 0;
    |HAZ ultimo;
    |INFOR "labcerju";
    |ABRE #7;
    |HAZ hasta;
    swLinea = #0#25;
    |PARA vcampo = lineahas; |SI vcampo [ lineades; |HACIENDO vcampo = vcampo + 1;
            #7#0 = #6#0;
            #7#1 = #6#1;
            #7#2 = vcampo;
        |LEE 000#7=;
            contador = contador + 1;
            alfa1 = #7#3 % -104;
            #0#19 = alfa1;         || a¤o
            fec1 = #7#3; |HAZ meseslet;
            #0#20 = fec2;          || mes
            |SI fec2 = "";
                |SI contador = 1;
                    |PRINT;
                |FINSI;
                |HAZ cierra_informe;
                |ACABA;
            |FINSI;
            #0#21 = #7#4;          || dias
            #0#22 = #7#7;          || base C.C.
            #0#23 = #7#8;          || base C.P.
            #0#24 = #2#33;         || grupo de cotizacion

            |SI contador = 1;
                mes1 = fec1;
                anyo1 = alfa1;
                dias1 = #7#4;
                baseCC1 = #7#7;
                baseCP1 = #7#8;
                grupo1 = #2#33;
            |FINSI;
            |SI contador = 2;
                mes2 = fec1;
                anyo2 = alfa1;
                dias2 = #7#4;
                baseCC2 = #7#7;
                baseCP2 = #7#8;
                grupo2 = #2#33;
                |PRINT;
                |HAZ inicializa;
            |FINSI;

            puntero = puntero + 1;
            |SI puntero = #0#17;  |SAL;     |FINSI;

    |SIGUE;
    |CIERRA #7;
|FINSI;
|HAZ cierra_informe;
|FPRC;

|PROCESO cierra_informe;
||PARA para1 = puntero + 1; |SI para1 [ #0#17; |HACIENDO para1 = para1 + 1;
    ||PDEFECTO #0, 62, 68;
    ||PRINT;
||SIGUE;

|SI contador = 1; |PRINT; |FINSI;  || para que imprima la ultima linea, si
|PIEINF;                           || hace falta
|FININF;
puntero = 0;
|FPRC;

|PROCESO nobaja;   || borra la(S) actualizacion(ES) pendiente(S)
|SI swactua = 1;
    |ABRE #7;
    |PARA #7#2 = borrar1; |SI #7#2 [ borrar2; |HACIENDO #7#2 = #7#2 + 1;
            #7#0 = #0#0;          || empresa
            #7#1 = #0#1;          || trabajador
        |LEE 020#7=;
        |SI FSalida = 0;
            |BORRA 020#7a;
            |SI #7#2 = 1;
                    #6#0 = #7#0;
                    #6#1 = #7#1;
                |BORRA 020#6a;
            |FINSI;
        |FINSI;
    |SIGUE;
    |CIERRA #7;
|FINSI;
|FPRC;

*****************************************************************************
    SUBRUTINAS
*****************************************************************************

|PROCESO cuenta1;
    lineades = #7#2;
|FPRC;

|DEFBUCLE cuenta;
 #7#1;
 ;
 #6#0, #6#1,   1;
 #6#0, #6#1, 999;
 ;
 NULL, cuenta1;
|FIN;

|PROCESO ultimo;     || RUTINA PARA SABER DE DONDE EMPEZAR A LEER (POR DETRAS)
    lineades = 0;

|DDEFECTO #7;
|ABRE #7;
|LEE 000#7u;             || con el temporal ya no hace falta leer con -BUCLE
    lineades = #7#2;
|CIERRA #7;

/*|SI #0#69 < lineades;
     lineades = #0#69;
|FINSI;
*/
|SI 999 < lineades;
     lineades = 999;
|FINSI;

||BUCLE cuenta;
|FPRC;

|PROCESO hasta;      || RUTINA PARA SABER HASTA DONDE LEER SEGUN >180 o EOF
    fecsys = #2#36;   dias_alta = fecsys;

    cc = 0;
    dd = 0;
    lineahas = 0;

    #7#0 = #6#0;
    #7#1 = #6#1;
    #7#2 = lineades;
|LEE 000#7=;
    fecsys = #7#3;   dias_coti = fecsys;

     |PARA;
     |SI FSalida = 0; |Y cc < #0#17; |Y dias_coti ] dias_alta;
     |HACIENDO;

        cc = cc + 1;
        dd = dd + #7#4;
        #7#2 = #7#2 - 1;

    |LEE 000#7=;
        fecsys = #7#3;   dias_coti = fecsys;
|SIGUE;

    lineahas = #7#2 + 1;
|FPRC;

|PROCESO desglosa;
    alfa1 = fecalf % 102;  diaq = alfa1;
    alfa1 = fecalf % 402;  mesq = alfa1;
    alfa1 = fecalf % 704;  anyq = alfa1;
|SI alfa1 = "....";
        diaq = 0;
        mesq = 0;
        anyq = 0;
|FINSI;
|FPRC;

|PROCESO periodos;
                              || PERIODO 1
     |SI #0#9 ! vpuntos; |Y #0#9 ! vblanco;
          fec1 = #0#9;             || PerXDA = Periodo X Dia Alta
          |HAZ meseslet;           || PerXMA = Periodo X Mes Alta (en letra)
          Per1DA = dia1;           || PerXAA = Periodo X A¤o Alta
          Per1MA = meslet;         || PerXDB = Periodo X Dia Baja
          Per1AA = any1;           || PerXMB = Periodo X Mes Baja (en letra)
          fec1 = #0#10;            || PerXAB = Periodo X A¤o Baja
          |HAZ meseslet;
          Per1DB = dia1;
          Per1MB = meslet;
          Per1AB = any1;
     |FINSI;
                              || PERIODO 2
     |SI #0#11 ! vpuntos; |Y #0#11 ! vblanco;
          fec1 = #0#11;
          |HAZ meseslet;
          Per2DA = dia1;
          Per2MA = meslet;
          Per2AA = any1;
          fec1 = #0#12;
          |HAZ meseslet;
          Per2DB = dia1;
          Per2MB = meslet;
          Per2AB = any1;
     |FINSI;
                              || PERIODO 3
     |SI #0#13 ! vpuntos; |Y #0#13 ! vblanco;
          fec1 = #0#13;
          |HAZ meseslet;
          Per3DA = dia1;
          Per3MA = meslet;
          Per3AA = any1;
          fec1 = #0#14;
          |HAZ meseslet;
          Per3DB = dia1;
          Per3MB = meslet;
          Per3AB = any1;
     |FINSI;
                              || PERIODO 4
     |SI #0#15 ! vpuntos; |Y #0#15 ! vblanco;
          fec1 = #0#15;
          |HAZ meseslet;
          Per4DA = dia1;
          Per4MA = meslet;
          Per4AA = any1;
          fec1 = #0#16;
          |HAZ meseslet;
          Per4DB = dia1;
          Per4MB = meslet;
          Per4AB = any1;
     |FINSI;
|FPRC;

|PROCESO fecha;
|SI mesbaja ! #8#2;
    alfa1=#8#7;
|SINO;
    alfa1=diabaja;
|FINSI;
                alfa1="00"+alfa1; alfa1=alfa1%-102;  fecalf=alfa1+".";
    alfa1=#8#2; alfa1="00"+alfa1; alfa1=alfa1%-102;  fecalf=fecalf+alfa1+".";
    alfa1=#0#8%-104;
    nume1=alfa1;
|SI mesbaja ! #8#2; |Y em > mesbaja;
        nume1=nume1-1;
|FINSI;
    alfa1=nume1;                                     fecalf=fecalf+alfa1;
|FPRC;
