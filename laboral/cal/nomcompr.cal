|FICHEROS;
    nomcompr #0;
    nomcomtm #1;    || tmp. conceptos
    nomconli #2;    || lineas de conceptos
    nomcatca #3;    || categ. cabs.
    nomcatli #4;    || categ. lins.
    nomtraca #5;    || traba. cabs.
    nomtrali #6;    || traba. lins.
    nomvarca #7;    || varia. cabs.
    nomvarli #8;    || varia. lins.
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    fecsys = @;
    p_mes = "";
    convenio = 0;
|FIN;

|INCLUYE i_tempo;

|PROCESO lee_convenio;
|DDEFECTO #2;
    convenio = 0;
    #2#0 = #0#2;
    #2#2 = #1#1;
|LEE 001#2=;
|SI FSalida ! 0;|Y #2#2 < 900;
        convenio = 1;
|SINO;
        #1#2 = #2#3;         || calculo alfa
        #1#3 = #2#4;         || calculo nume
        #1#4 = #2#5;         || situacion
        #1#5 = #2#6;         || descripcion
|FINSI;
|FPRC;

|PROCESO lin_categ;
    #1#1 = #4#2;             || concepto
|HAZ lee_convenio;
|SI convenio = 0;
        #1#0 = #1#0 + 1;     || linea
        #1#6 = #4#3;         || unidades
        #1#7 = #4#4;         || valor
        #1#8 = "  Categoria";|| fuente
    |GRABA 020#1n;
|FINSI;
|FPRC;

|PROCESO lee_categ;
|ABRE #3;
    #3#0 = #0#2;
    #3#1 = #0#3;
|LEE 001#3=;
|SI FSalida = 0;
    |BUCLELIN 2lin_categ#3;
|FINSI;
|CIERRA #3;
|FPRC;

|PROCESO lin_traba;
    #1#1 = #6#2;             || concepto
|HAZ lee_convenio;
|SI convenio = 0;
        #1#0 = #1#0 + 1;     || linea
        #1#6 = #6#3;         || unidades
        #1#7 = #6#4;         || valor
        #1#8 = " Trabajador";|| fuente
    |GRABA 020#1n;
|FINSI;
|FPRC;

|PROCESO lee_traba;
|ABRE #5;
    #5#0 = #0#0;
    #5#1 = #0#1;
|LEE 001#5=;
|SI FSalida = 0;
    |BUCLELIN 2lin_traba#5;
|FINSI;
|CIERRA #5;
|FPRC;

|PROCESO lin_varia;
    #1#1 = #8#4;             || concepto
|HAZ lee_convenio;
|SI convenio = 0;
        #1#0 = #1#0 + 1;     || linea
        #1#6 = #8#5;         || unidades
        #1#7 = #8#6;         || valor
        #1#8 = "Variaciones";|| fuente
    |GRABA 020#1n;
|FINSI;
|FPRC;

|PROCESO lee_varia;
|ABRE #7;
    #7#0 = #0#0;
    #7#1 = #0#1;
    #7#2 = #0#4;
    #7#3 = 0;
|LEE 001#7=;
|SI FSalida = 0;
    |BUCLELIN 2lin_varia#7;
|FINSI;
|CIERRA #7;
|FPRC;

|PROCESO min;
    #1#1 = 101;
|FPRC;

|PROCESO max;
    #1#1 = 999;
|FPRC;

----------------------------------------------------------------------------
                        CALCULOS DESDE CAMPOS
----------------------------------------------------------------------------

|PROCESO ensenya; |TIPO 3;
|HAZ nom_usu;
    alfa1 = nom_tmp;
|NOME_DAT #1 alfa1;
|DELINDEX #1;
|ABRE #1;
|ABRE #2;
    #1#0 = 0;  || campo linea
|HAZ lee_categ;
|HAZ lee_traba;
|HAZ lee_varia;
|CIERRA #1;
|CIERRA #2;
|SI #1#0 = 0;
    |MENAV "    ATENCION!!! Trabajador sin conceptos definidos ...";
|SINO;
    |ENTLINEAL #2#1, 1, 4, 22, 0, min, max;
|FINSI;
|DELINDEX #1;
|FPRC;

|PROCESO mirames; |TIPO 7;   || CALCULA EL MES POR DEFECTO SEGUN FECHA SISTEMA
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO pintames; |TIPO 0;      || PINTA EL MES LITERAL
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|ATRI I;
|PINTA 1067, p_mes;
|ATRI 0;
|FPRC;
