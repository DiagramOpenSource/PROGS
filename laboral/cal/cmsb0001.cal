|FICHEROS;
     cmsb0001 #00;       || def de impresion modulo
     nomrecib;           || def de impresion estandar

     nomgruec;           || grupos de empresas Cabs.
     nomgruel;           || grupos de Empresas Lins.
     nomcontr;
     labtraba;
     nomcalcu #40;
     nomcalat #41;
|FIN;

|VARIABLES;
     nDesdeFuera=0;
     i=0;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     anyo = 0;
     bisiesto = 0;
     fecsys = @;
     nume1 = 0;
     nume2 = 0;
     p_mes = "";
     topemes = 0;

     &acum = 1;
     &runnom = "nomyreci";
     aCadena1="";
     aFuente="";
     aTipoRecibo="";
     aTipoImpresion="";

     aDirDes = "";
     aRutaDes = "";
     aRuta = "";
     aRutaDatos = "";
     nCanal = 0;
     aArchivo = "";
     aCabecera = "";
     aTipoResumen = "";
     aTipoNomina = "";
     aEmpresa = "";
     aAnyDesde = "";
     aAnyHasta = "";
     aMesDesde = "";
     aMesHasta = "";
     aOrdenacion = "";
     aAny = "";
     aDireccion = "";
     aTrabajadorDesde = "";
     aTrabajadorHasta = "";
     nEmpresa = 0;
     nAny = 0;
     nMesDesde = 0;
     nMesHasta = 0;
     nOrdenacion = 0;
     nDireccion = 0;
     nTrabajadorDesde = 0;
     nTrabajadorHasta = 0;

     cParam         = "";
     cParte         = "";
     &cOrigen        = "";
     &cDestino       = "";
     cDirBase       = "";
     cUsuario       = "";
     cIp            = "";
     cDirUsu        = "";
     cNumUsu        = "";
     aAlfa = "";
     aTabla = "";
     aDir = "";
     &nErrorInf = 0;
     aSystem = "";
     aBaseBin = "";
     aDirOri = "";

     nLongitud = 0;
     aLongitud = "";
     &swDesdeWeb = 0;
     &aParametro = "";
     salte_1 = 0;
     salte_2 = 0;
     para1 = 0;

     nAscii = 0;
     aCaracter = "";
     aCaracterSal = "";
     aCadena = "";
     aCadenaSal = "";
     nPos = 0;
     nBusca = 0;
     aValor = "";
     aCampo = "";
     nTipo = 0;
     &swCopia = 0;
     &aID = "";
     &enWeb = 0;
     &eaWebDirPDF = "";
     &eaWebArchivo = "";
     &eaWebDirDes = "";
     aTipoEmiAt = "";
     nSwNumer = 0;
     nNume = 0;
     &aListaFich = "";
     &swPDFMasivo = 0;
     &aParam1 = "";
     &aParam2 = "";
     &aProcedencia = "";
     &nNroCopias = 0;
     &enCodBanco = 0;
     &swComercio = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     swCarga = 0;

     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nAnyAUTO = 0;
     &nMesAUTO = 0;
     &nTipAUTO = 0;
     &aParam = "";
     aTipoAtrasos = "";
     aRutaPDFWeb = "";
     &nArchi = 0;
     FEstado = 0;

     &nEmpDesdeAUTO = 0;
     &nEmpHastaAUTO = 0;
     &nTraDesdeAUTO = 0;
     &nTraHastaAUTO = 0;
     &eaMeses = "";

     nMes = 0;
     nCampoMes = 0;
|FIN;

|INCLUYE nomcal_4;

*************************************************************************
      RECOGE LA PARRILLA DEL CALCULO Y GESTIONA EL TIPO DE SELECCION
*************************************************************************

|PROCESO ConsEmp; |TIPO 66;
     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #1 aAlfa1;
     |FINSI;

     |ABRE #labempre;
     |LEE 000#labempre.p;
     |CONSULTA_CLAVE #1#labempre;
     |SI FSalida = 0;
          #0Campo = #labempre#0;
          |PINTA #0Campo;
     |FINSI;
     |CIERRA #labempre;
|FPRC;

|PROCESO MinTra;
     #labtraba#0 = #0nCampo;
     #labtraba#1 = 00001;
|FPRC;

|PROCESO MaxTra;
     #labtraba#0 = #0nCampo;
     #labtraba#1 = 99999;
|FPRC;

|PROCESO ConsTra; |TIPO 66;
     |ABRE #labtraba;
     nCampo = Campo - 2;
     |CONSULTA_F_CLAVE #1#labtraba, MinTra, MaxTra;
     |SI FSalida = 0;
          #0Campo = #labtraba#1;
          |PINTA #0Campo;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO Parrillas; |TIPO 7;
     |SI #0#67="M"; |O #0#67="H";
          |HAZ parrillaMH;
     |SINO;
          |HAZ parrillaA;
     |FINSI;
     #0#9 = #nomcontr#52;
     |PINTA #0#9;
|FPRC;

|PROCESO parrillaA;
     |ABRE #41;
     |LEE 001#41p;
     |SI FSalida ! 0;  |DDEFECTO #41;  |FINSI;
     |PARA nume1 = 21; |SI nume1 [ 41; |HACIENDO nume1 = nume1 + 1;
             nume2 = nume1 + 21;
             #0nume1 = #41nume1;
             #0nume2 = #41nume2;
     |SIGUE;
         #0#4 = #41#9 $ 100;  || a¤o
         #0#5 = #41#8;        || desde mes
         #0#7 = #41#10;       || hasta mes
     |CIERRA #41;
     |PINDA #0#0;
|FPRC;

|PROCESO parrillaMH;
     aAlfa = Usuario;         |QBF aAlfa;
     aAlfa = "n" +  aAlfa;
     |NOME_DAT #40 aAlfa;

     |ABRE #40;
     |LEE 001#40p;
     |SI FSalida ! 0;  |DDEFECTO #40;  |FINSI;
     |PARA nume1 = 21; |SI nume1 [ 41; |HACIENDO nume1 = nume1 + 1;
             nume2 = nume1 + 21;
             #0nume1 = #40nume1;
             #0nume2 = #40nume2;
     |SIGUE;
         #0#0 = #40#0;
         #0#1 = #40#1;        || desde/hasta empresa/trabajador
         #0#2 = #40#2;
         #0#3 = #40#3;
         #0#4 = #40#9 $ 100;  || a¤o
         #0#5 = #40#8;        || mes
     |CIERRA #40;
     |PINDA #0#0;
|FPRC;

|PROCESO Seleccion; |TIPO 0;
     |SI #0#21 = 0;
         |CAMPO_MODIFICA #0#0, 1, "S";
         |CAMPO_MODIFICA #0#1, 1, "S";
         |CAMPO_MODIFICA #0#2, 1, "S";
         |CAMPO_MODIFICA #0#3, 1, "S";
         |CAMPO_MODIFICA #0#63, 1, "S";
         |CAMPO_MODIFICA #0#22, 1, "N";
         |CAMPO_MODIFICA #0#23, 1, "N";
         |CAMPO_MODIFICA #0#24, 1, "N";
         |CAMPO_MODIFICA #0#25, 1, "N";
         |CAMPO_MODIFICA #0#26, 1, "N";
         |CAMPO_MODIFICA #0#27, 1, "N";
         |CAMPO_MODIFICA #0#28, 1, "N";
         |CAMPO_MODIFICA #0#29, 1, "N";
         |CAMPO_MODIFICA #0#30, 1, "N";
         |CAMPO_MODIFICA #0#31, 1, "N";
         |CAMPO_MODIFICA #0#32, 1, "N";
         |CAMPO_MODIFICA #0#33, 1, "N";
         |CAMPO_MODIFICA #0#34, 1, "N";
         |CAMPO_MODIFICA #0#35, 1, "N";
         |CAMPO_MODIFICA #0#36, 1, "N";
         |CAMPO_MODIFICA #0#37, 1, "N";
         |CAMPO_MODIFICA #0#38, 1, "N";
         |CAMPO_MODIFICA #0#39, 1, "N";
         |CAMPO_MODIFICA #0#40, 1, "N";
         |CAMPO_MODIFICA #0#41, 1, "N";
         |CAMPO_MODIFICA #0#42, 1, "N";
         |CAMPO_MODIFICA #0#43, 1, "N";
         |CAMPO_MODIFICA #0#44, 1, "N";
         |CAMPO_MODIFICA #0#45, 1, "N";
         |CAMPO_MODIFICA #0#46, 1, "N";
         |CAMPO_MODIFICA #0#47, 1, "N";
         |CAMPO_MODIFICA #0#48, 1, "N";
         |CAMPO_MODIFICA #0#49, 1, "N";
         |CAMPO_MODIFICA #0#50, 1, "N";
         |CAMPO_MODIFICA #0#51, 1, "N";
         |CAMPO_MODIFICA #0#52, 1, "N";
         |CAMPO_MODIFICA #0#53, 1, "N";
         |CAMPO_MODIFICA #0#54, 1, "N";
         |CAMPO_MODIFICA #0#55, 1, "N";
         |CAMPO_MODIFICA #0#56, 1, "N";
         |CAMPO_MODIFICA #0#57, 1, "N";
         |CAMPO_MODIFICA #0#58, 1, "N";
         |CAMPO_MODIFICA #0#59, 1, "N";
         |CAMPO_MODIFICA #0#60, 1, "N";
         |CAMPO_MODIFICA #0#61, 1, "N";
         |CAMPO_MODIFICA #0#62, 1, "N";
         |PARA nume1 = 21; |SI nume1 [ 62; |HACIENDO nume1 = nume1 + 1;
             #0nume1 = 0;
         |SIGUE;
         |PINDA #0#0;
     |SINO;
         |CAMPO_MODIFICA #0#0, 1, "N";
         |CAMPO_MODIFICA #0#1, 1, "N";
         |CAMPO_MODIFICA #0#2, 1, "N";
         |CAMPO_MODIFICA #0#3, 1, "N";
         |CAMPO_MODIFICA #0#63, 1, "N";
         |CAMPO_MODIFICA #0#22, 1, "S";
         |CAMPO_MODIFICA #0#23, 1, "S";
         |CAMPO_MODIFICA #0#24, 1, "S";
         |CAMPO_MODIFICA #0#25, 1, "S";
         |CAMPO_MODIFICA #0#26, 1, "S";
         |CAMPO_MODIFICA #0#27, 1, "S";
         |CAMPO_MODIFICA #0#28, 1, "S";
         |CAMPO_MODIFICA #0#29, 1, "S";
         |CAMPO_MODIFICA #0#30, 1, "S";
         |CAMPO_MODIFICA #0#31, 1, "S";
         |CAMPO_MODIFICA #0#32, 1, "S";
         |CAMPO_MODIFICA #0#33, 1, "S";
         |CAMPO_MODIFICA #0#34, 1, "S";
         |CAMPO_MODIFICA #0#35, 1, "S";
         |CAMPO_MODIFICA #0#36, 1, "S";
         |CAMPO_MODIFICA #0#37, 1, "S";
         |CAMPO_MODIFICA #0#38, 1, "S";
         |CAMPO_MODIFICA #0#39, 1, "S";
         |CAMPO_MODIFICA #0#40, 1, "S";
         |CAMPO_MODIFICA #0#41, 1, "S";
         |CAMPO_MODIFICA #0#42, 1, "S";
         |CAMPO_MODIFICA #0#43, 1, "S";
         |CAMPO_MODIFICA #0#44, 1, "S";
         |CAMPO_MODIFICA #0#45, 1, "S";
         |CAMPO_MODIFICA #0#46, 1, "S";
         |CAMPO_MODIFICA #0#47, 1, "S";
         |CAMPO_MODIFICA #0#48, 1, "S";
         |CAMPO_MODIFICA #0#49, 1, "S";
         |CAMPO_MODIFICA #0#50, 1, "S";
         |CAMPO_MODIFICA #0#51, 1, "S";
         |CAMPO_MODIFICA #0#52, 1, "S";
         |CAMPO_MODIFICA #0#53, 1, "S";
         |CAMPO_MODIFICA #0#54, 1, "S";
         |CAMPO_MODIFICA #0#55, 1, "S";
         |CAMPO_MODIFICA #0#56, 1, "S";
         |CAMPO_MODIFICA #0#57, 1, "S";
         |CAMPO_MODIFICA #0#58, 1, "S";
         |CAMPO_MODIFICA #0#59, 1, "S";
         |CAMPO_MODIFICA #0#60, 1, "S";
         |CAMPO_MODIFICA #0#61, 1, "S";
         |CAMPO_MODIFICA #0#62, 1, "S";
     |FINSI;
|FPRC;

|PROCESO DesdeFuera;
     |SI nDesdeFuera=0;
          |SI aFuente!"";
               |CAMPO_MODIFICA #0#67,1,"N";
          |FINSI;

          |SI aTipoRecibo!"";
               |CAMPO_MODIFICA #0#68,1,"N";
          |FINSI;

          |SI aTipoImpresion!"";
               |CAMPO_MODIFICA #0#69,1,"N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PParametro; |TIPO 7;
     |SI #0#69 = "F";
          aParam1 = "PDF";
          aParam2 = PARAMETRO;
          aCadena1 = aParam2;
          aTipoImpresion = "I";
     |SINO;
          aCadena1 = PARAMETRO;
     |FINSI;
     |QBF aCadena1;
     |SI aCadena1="";
          nDesdeFuera=1;
     |HAZ DesdeFuera;
     |SINO;
          nDesdeFuera=0;

          aFuente=aCadena1 % 101;
          |SI aFuente!"M"; |Y aFuente!"H"; |Y aFuente!"A"; |Y aFuente!"T"; aFuente=""; |FINSI;

          aTipoRecibo=aCadena1 % 201;
          |SI aTipoRecibo!"N";|Y aTipoRecibo!"F";|Y aTipoRecibo!"P"; aTipoRecibo=""; |FINSI;

          aTipoImpresion=aCadena1 % 301;
          |SI aTipoImpresion!"I"; |Y aTipoImpresion!"P";|Y aTipoImpresion!"A"; aTipoImpresion=""; |FINSI;

          |SI aFuente="M"; |O aFuente="H"; |O aFuente="A"; |O aFuente = "T";
               #0#67=aFuente;
          |FINSI;
          |SI aTipoRecibo="N"; |O aTipoRecibo="F"; |O aTipoRecibo="P";
               #0#68=aTipoRecibo;
          |FINSI;
          |SI aTipoImpresion="I"; |O aTipoImpresion="P"; |O aTipoImpresion="A";
               #0#69=aTipoImpresion;
          |FINSI;

          |PINTA #0#67;
          |PINTA #0#68;
          |PINTA #0#69;

          |HAZ FuenteDatos;
          |HAZ TipoRecibo;
          |HAZ TipoImpresion;
          |HAZ DesdeFuera;
     |FINSI;
|FPRC;

|PROCESO FuenteDatos; |TIPO 0;
     |SI #0#67 = "M";
          aCadena1 = "MENSUAL  ";
          |CAMPO_MODIFICA #0#68,1,"S";
          |CAMPO_VISUAL #0#7,1,"N";

          |CAMPO_MODIFICA #0#10, 1, "S";
          |PINTA 1258, "Tipo 0/2.:";
          #0#10 = 0;
          |PINTA #0#10;
     |FINSI;

     |SI #0#67 = "H";
          aCadena1 = "HISTORICO";
          |CAMPO_MODIFICA #0#68, 1, "S";
          |CAMPO_VISUAL #0#7, 1, "N";

          |CAMPO_MODIFICA #0#10, 1, "S";
          |PINTA 1258, "Tipo 0/2.:";
          #0#10 = 0;
          |PINTA #0#10;
     |FINSI;

     |SI #0#67="A";
          aCadena1="ATRASOS  ";
          |CAMPO_MODIFICA #0#68,1,"N";
          |CAMPO_VISUAL #0#7,1,"S";

          #0#68="N";
          |PINTA #0#68;

          #0#10 = 1;
          |CAMPO_MODIFICA #0#10, 1, "N";
          |PINTA 1258, "               ";
/*
          || de momento solo permito recibos separados

          |PINTA 1258, "Tipo 1/2.:";
          #0#10 = 1;
          |PINTA #0#10;
*/
     |FINSI;

     |SI #0#67 = "T";
          aCadena1 = "ATRA.HIS.";
          |CAMPO_MODIFICA #0#68, 1, "N";
          |CAMPO_VISUAL #0#7, 1, "S";

          #0#68 = "N";
          |PINTA #0#68;

          |CAMPO_MODIFICA #0#10, 1, "S";
          |PINTA 1258, "Tipo 5-9.:";
          |SI #0#10 < 5;
               #0#10 = 5;
          |FINSI;
          |PINTA #0#10;
     |FINSI;

     |ATRI I;
     |PINTA 0629,aCadena1;
     |ATRI 0;

     |HAZ TipoRecibo;
     |HAZ DesdeFuera;
|FPRC;

|PROCESO TipoRecibo; |TIPO 0;
     |SI #0#68="N";
          aCadena1="NOMINA   ";

          |CAMPO_MODIFICA #0#69, 1, "S";
          |CAMPO_POSICION #0#13, 1, 0971;
          |CAMPO_POSICION #0#14, 1, 0972;
          |SI #0#67 = "A";
               |CAMPO_VISUAL #0#10, 1, "N";
               |PINTA 1268, "   ";
          |SINO;
               |CAMPO_VISUAL #0#10, 1, "S";
               |PINTA #0#10;
          |FINSI;
          |CAMPO_VISUAL #0#13, 1, "N";
          |CAMPO_VISUAL #0#14, 1, "N";

          |PINTA 1458, "                     ";
     |FINSI;
     |SI #0#68="F";
          aCadena1="FINIQUITO";
          |PINTA 1458, "Prop/Fin.:";
          |CAMPO_MODIFICA #0#69, 1, "N";
          |CAMPO_POSICION #0#13, 1, 1469;
          |CAMPO_POSICION #0#14, 1, 0972;
          |CAMPO_VISUAL #0#10, 1, "N";
          |CAMPO_VISUAL #0#13, 1, "S";
          |CAMPO_VISUAL #0#14, 1, "N";
          |PINTA #0#13;

          #0#69="I";
          |PINTA #0#69;
     |FINSI;

     |SI #0#68="P";
          aCadena1="PAGA     ";

          |PINTA 1458, "Desglosar:";
          |CAMPO_MODIFICA #0#69, 1, "S";
          |CAMPO_POSICION #0#13, 1, 0971;
          |CAMPO_POSICION #0#14, 1, 1469;
          |CAMPO_VISUAL #0#10,1,"N";
          |CAMPO_VISUAL #0#13,1,"N";
          |CAMPO_VISUAL #0#14,1,"S";
          |PINTA #0#14;
     |FINSI;

     |ATRI I;
     |PINTA 0729,aCadena1;
     |ATRI 0;

     |HAZ DesdeFuera;
|FPRC;

|PROCESO TipoImpresion;|TIPO 0;
     |SI #0#69="I"; |O #0#69="A"; |O #0#69 = "F"; |O #0#69 = "E";
          |SI #0#69="I";
               |SI #nomcontr#37 = "N";
                    aCadena1="IMPRESORA";
               |SINO;
                    aCadena1=" - PDF - ";
               |FINSI;
          |FINSI;
          |SI #0#69 = "E";
               aCadena1="EMAIL    ";
          |FINSI;
          |SI #0#69 = "A";
               aCadena1="ABIERTA  ";
          |FINSI;
          |CAMPO_VISUAL #0#0,0,alfa1;
          |SI alfa1="N";
               |PINTA 1302,"ÚÄ Seleccion salteada  ÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ¿";
               |PINTA 1402,"³     /     ³     /     ³     /     ³     /     ³     /     ³     /     ³";
               |PINTA 1502,"³     /     ³     /     ³     /     ³     /     ³     /     ³     /     ³";
               |PINTA 1602,"³     /     ³     /     ³     /     ³     /     ³     /     ³     /     ³";
               |PINTA 1702,"ÀÄÄÄÄÂÄ Seleccion desde/hasta ÄÄÄÄÄÄÁÄÄÄÄ¿ÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÙ";
                    |PINTA 1807,"ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄ´";
                    |PINTA 1907,"³         ³Empresa³Trabajador³Centro³";
                    |PINTA 2007,"³Desde ..:³       ³          ³      ³";
                    |PINTA 2107,"³Hasta ..:³       ³          ³      ³";
                    |PINTA 2207,"³Orden ..:                          ³";
                    |PINTA 2307,"ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";

               |ATRI R;
               |PINTA 1304," Seleccion salteada  ";
               |PINTA 1709," Seleccion desde/hasta ";
               |PINTA 1918,"Empresa";
               |PINTA 1926,"Trabajador";
               |PINTA 1937,"Centro";
               |ATRI 0;

               |PARA i=21;|SI i[62;|HACIENDO i=i+1;
                    |SI i!41;|Y i!62; |Y i!27; |Y i!48;|Y i!34; |Y i!55;
                         |CAMPO_VISUAL #0i,1,"S";
                         |PINTA #0i;
                    |FINSI;
               |SIGUE;

               |CAMPO_VISUAL #0#0,1,"S";
               |CAMPO_VISUAL #0#1,1,"S";
               |CAMPO_VISUAL #0#2,1,"S";
               |CAMPO_VISUAL #0#3,1,"S";
               |CAMPO_VISUAL #0#65,1,"S";
               |CAMPO_VISUAL #0#66,1,"S";
               |CAMPO_VISUAL #0#63,1,"S";

               |CAMPO_VISUAL #0#11,1,"N";
               |CAMPO_VISUAL #0#12,1,"N";

               |PINTA #0#0;
               |PINTA #0#1;
               |PINTA #0#2;
               |PINTA #0#3;
               |PINTA #0#65;
               |PINTA #0#66;
               |PINTA #0#63;
          |FINSI;
     |FINSI;
     |SI #0#69="P";
          aCadena1="PANTALLA ";
                    |PARA i=11;|SI i[23;|HACIENDO i=i+1;
                         |BLIN i;
                    |SIGUE;
                    |PARA i=21;|SI i[61;|HACIENDO i=i+1;
                         |CAMPO_VISUAL #0i,1,"N";
                    |SIGUE;
                    |PARA i=70;|SI i[77;|HACIENDO i=i+1;
                         |CAMPO_VISUAL #0i,1,"N";
                    |SIGUE;
                    |CAMPO_VISUAL #0#0,1,"N";
                    |CAMPO_VISUAL #0#1,1,"N";
                    |CAMPO_VISUAL #0#2,1,"N";
                    |CAMPO_VISUAL #0#3,1,"N";
                    |CAMPO_VISUAL #0#65,1,"N";
                    |CAMPO_VISUAL #0#66,1,"N";
                    |CAMPO_VISUAL #0#63,1,"N";
                    |CAMPO_MODIFICA #0#15,1,"N";
                    |CAMPO_VISUAL #0#15,1,"N";


                    |PINTA 1144,"ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ"
                    |PINTA 1230,"ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿";
                    |PINTA 1330,"³ Empresa ....:       ³";
                    |PINTA 1430,"³ Trabajador .:       ³";
                    |PINTA 1530,"ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";

                    |ATRI R;
                    |PINTA 1236," Seleccion ";
                    |ATRI 0;

                    #0#11=1;
                    #0#12=1;
                    |CAMPO_VISUAL #0#11,1,"S";
                    |CAMPO_VISUAL #0#12,1,"S";
                    |PINTA #0#11;
                    |PINTA #0#12;
     |FINSI;

     |ATRI I;
     |PINTA 0829, aCadena1;
     |ATRI 0;
|FPRC;

|PROCESO MensajeTipoRec; |TIPO 7;
     |SI #0#67 = "M";
           |MENSA "0000Entre: (0) nomina mensual; (2) nomina finiquito";
     |FINSI;
     |SI #0#67 = "H";
           |MENSA "0000Entre: (0) nómina mensual; (2) nómina finiquito";
           ||MENSA "0000Entre: (0) mensual; (2) finiquito; (5 + n) atrasos";
     |FINSI;
     |SI #0#67 = "A";
           |MENSA "0000Entre: (1) recibos separados por meses; (2) recibos refundidos en uno";
     |FINSI;
     |SI #0#67 = "T";
           |MENSA "0000Introduzca el tipo de atrasos a emitir (5 + n) ";
     |FINSI;
|FPRC;

|PROCESO MiraTipoRec;|TIPO 0;
     |SI #0#67="M";
          |SI #0#10!0; |Y #0#10!2;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI #0#67="H";
          |SI #0#10 = 1; |O #0#10 ] 5;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI #0#67="A";
          |SI #0#10!1; |Y #0#10!2;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI #0#67="T";
          |SI #0#10 < 5;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AnyoDefecto; |TIPO 7; ||calcula el periodo por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -102;
    #0Campo = alfa1;
    |PINTA #0Campo;
|FPRC;

|PROCESO MiraTopeMes; |TIPO 0;
         nume1 = anyo $ 4;
     |SI nume1 = 0;
             bisiesto = 1;
     |SINO;
             bisiesto = 0;
     |FINSI;

     |SI #0#5 =  1;  p_mes = "ENERO     ";  topemes = 31;  |FINSI;
     |SI #0#5 =  2;  p_mes = "FEBRERO   ";  topemes = 28 + bisiesto;  |FINSI;
     |SI #0#5 =  3;  p_mes = "MARZO     ";  topemes = 31;  |FINSI;
     |SI #0#5 =  4;  p_mes = "ABRIL     ";  topemes = 30;  |FINSI;
     |SI #0#5 =  5;  p_mes = "MAYO      ";  topemes = 31;  |FINSI;
     |SI #0#5 =  6;  p_mes = "JUNIO     ";  topemes = 30;  |FINSI;
     |SI #0#5 =  7;  p_mes = "JULIO     ";  topemes = 31;  |FINSI;
     |SI #0#5 =  8;  p_mes = "AGOSTO    ";  topemes = 31;  |FINSI;
     |SI #0#5 =  9;  p_mes = "SEPTIEMBRE";  topemes = 30;  |FINSI;
     |SI #0#5 = 10;  p_mes = "OCTUBRE   ";  topemes = 31;  |FINSI;
     |SI #0#5 = 11;  p_mes = "NOVIEMBRE ";  topemes = 30;  |FINSI;
     |SI #0#5 = 12;  p_mes = "DICIEMBRE ";  topemes = 31;  |FINSI;
|FPRC;

|PROCESO Mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
     |SI #0#67!"A";
         fecsys = ~;
         alfa1 = fecsys;
         alfa1 = alfa1 % 402;
         #0Campo = alfa1;
         |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO Finalmes; |TIPO 7;
    |SI #0#4 < 80;
             anyo = #0#4 + 2000;
    |SINO;
             anyo = #0#4 + 1900;
    |FINSI;

    alfa1 = anyo;                                               || anyo
    |HAZ MiraTopeMes;
    alfa2 = topemes;                                            || dia

    alfa3 = #0#5;  alfa3 = "00" + alfa3;  alfa3 = alfa3 % -102; || mes

    alfa1 = alfa2 + "." + alfa3 + "." + alfa1;                  || fecha entera
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO Marca;
/*
     |SI #0Campo ! Contenido;
          |ACABA;
     |FINSI;
     |SI FSalida = 0;
          |SI #0Campo = " ";
               #0Campo = "X";
          |SINO;
               |SI #0Campo = "X";
                    #0Campo = " ";
               |FINSI;
          |FINSI;
          |PINTA #0Campo;
     |FINSI;
*/
|FPRC;

/*****************************************************************/
/*  PROCESO PRINCIPAL                                            */
/*****************************************************************/

|PROCESO CrearRecibo;
     |SI #nomcontr#37 = "S"; |Y #0#69 = "I";
          aParam1 = "PDF";
          aParam2 = PARAMETRO;
          aCadena1 = aParam2;
          aTipoImpresion = "I";
          #0#69 = "I";
          aProcedencia = "nomrecib";
          |HAZ ImpresionPDF;
     |SINO;
          |SUB_EJECUTA "nomrecib;CMSB";
     |FINSI;
|FPRC;

|PROCESO FechaRecibi;
     |SI #0#4 < 80;
          anyo = #0#4 + 2000;
     |SINO;
          anyo = #0#4 + 1900;
     |FINSI;

     alfa1 = anyo;            || anyo
     |HAZ MiraTopeMes;
     alfa2 = topemes;         || dia

     alfa3 = #0#5;
     alfa3 = "00" + alfa3;
     alfa3 = alfa3 % -102;    || mes

     alfa1 = alfa2 + "." + alfa3 + "." + alfa1;      || fecha entera
     #0#6  = alfa1;
|FPRC;

|PROCESO proceso;

|FPRC;

|PROGRAMA;
     |CLS;

     |PARA; |SI; |HACIENDO;
          |ABRE #0;
          |DDEFECTO #0;
          |LEE 000#0p;
          |SI FSalida = 0;  |BORRA 020#0a;  |FINSI;

          |CABEZA "EMISION DE RECIBOS DE NOMINA";
          |PINPA #0#0;
          |PINDA #0#0;
          swDesdeWeb = 0;

          |HAZ FuenteDatos;
          |HAZ TipoRecibo;
          |HAZ TipoImpresion;

          |ENDATOS #1#0;
          FEstado = FSalida;

          |GRABA 000#0n;

          |CIERRA #0;

          |SI FEstado = 0;
               |HAZ CrearRecibo;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRO;
