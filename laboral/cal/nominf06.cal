|FICHEROS;
     nominf06 #0;
     nomcalca #1;
     nomhicca;
     labtraba #2;
     labempre #3;
|FIN;

|VARIABLES;
     &aDesde = "";
     &nBase1 = 0;
     &nBase2 = 0;
     &nBase3 = 0;
     &nTipo1 = 0;
     &nTipo2 = 0;
     &nTipo3 = 0;
     &nTipo = 0;

     nDesdeMes = 0;
     nHastaMes = 0;
     nDesdeAny = 0;
     nHastaAny = 0;

     &nAny = 0;
     &nMes = 0;
     &nDiasERE = 0;
     &nDiasEREBon = 0;
     &nBonifERE = 0;

     nNume = 0;
     swCuenta = 0;
     nCasos = 0;
     aAlfa = "";
     nMes1212 = 0;
|FIN;

|PROCESO Busca1212;
     nMes1212 = 0;
     |SI aDesde = "M";
          #nomhicca#0 = #nomcalca#0;
          #nomhicca#1 = #nomcalca#1;
     |FINSI;
     |SI aDesde = "H";
          #nomhicca#0 = #nomhicca#0;
          #nomhicca#1 = #nomhicca#1;
     |FINSI;

     #nomhicca#66 = 12;
     #nomhicca#2 = 12;
     #nomhicca#3 = 0;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          nMes1212 = #nomhicca#148;
     |FINSI;
|FPRC;

|PROCESO imprime;
     |SI aDesde = "M";
          |HAZ Busca1212;
          |SI #nomcalca#106 ! 0; |Y nMes1212 = 0;
               #labempre#0 = #nomcalca#0;
               |LEE 000#labempre.=;

               #labtraba#0 = #nomcalca#0;
               #labtraba#1 = #nomcalca#1;
               |LEE 000#labtraba.=;
               |SI swCuenta = 1;
                    nCasos = nCasos + 1;
               |SINO;
                    |PRINT;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI aDesde = "H";
          |SALVA_FICHA #nomhicca;
          |HAZ Busca1212;
          |REPON_FICHA #nomhicca;
          |SI #nomhicca#148 ! 0; |Y nMes1212 = 0;
               #labempre#0 = #nomhicca#0;
               |LEE 000#labempre.=;

               #labtraba#0 = #nomhicca#0;
               #labtraba#1 = #nomhicca#1;
               |LEE 000#labtraba.=;

               |SI swCuenta = 1;
                    nCasos = nCasos + 1;
               |SINO;
                    |PRINT;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #0#0, #0#2, nDesdeAny, nDesdeMes, 0;
     #0#1, #0#3, nHastaAny, nHastaMes, 2;
     ;
     NULL, imprime;
|FIN;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #0#0, #0#2, #0#4, 0;
     #0#1, #0#3, #0#5, 2;
     ;
     NULL, imprime;
|FIN;

|PROCESO Busca;
     aDesde = "M";
     |BUCLE nomcalca;

     aDesde = "H";

     |SI #0#6 ! #0#7;
          nDesdeAny = #0#6 - 2000;
          nHastaAny = #0#6 - 2000;
          nDesdeMes = #0#4;
          nHastaMes = 12;
          |BUCLE nomhicca;

          nNume = #0#7 - #0#6;
          |SI nNume ! 1;
               nDesdeAny = #0#6 - 2000 + 1;
               nHastaAny = #0#7 - 2000 - 1;
               nDesdeMes = 01;
               nHastaMes = 12;
               |BUCLE nomhicca;
          |FINSI;

          nDesdeAny = #0#7 - 2000;
          nHastaAny = #0#7 - 2000;
          nDesdeMes = 01;
          nHastaMes = #0#5;
          |BUCLE nomhicca;
     |SINO;
          nDesdeAny = #0#6 - 2000;
          nHastaAny = #0#7 - 2000;
          nDesdeMes = #0#4;
          nHastaMes = #0#5;
          |BUCLE nomhicca;
     |FINSI;
|FPRC;

|PROCESO Cuenta;
     swCuenta = 1;
     nCasos = 0;
     |HAZ Busca;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #nomcalca;
          |ABRE #nomhicca;
          |ABRE #labempre;
          |ABRE #labtraba;

          nCasos = 0;
          |HAZ Cuenta;

          |SI nCasos ! 0;
               Impresora = "CrystalReport";
               |IMPRE -1;
               |SI FSalida = 0;
                    |INFOR "nominf06";

                    swCuenta = 0;
                    |HAZ Busca;
                    |PIEINF;
                    |FININF;
                    |FINIMP;
               |FINSI;
          |FINSI;

          |CIERRA #labtraba;
          |CIERRA #labempre;
          |CIERRA #nomhicca;
          |CIERRA #nomcalca;

          |SI nCasos ! 0;
               aAlfa = "    ATENCION. Recuerde que es obligatorio volver a calcular las ";
               aAlfa = aAlfa + "nóminas que se indican en el informe.";
               |MENAV aAlfa;

               aAlfa = "    De lo contrario, se habrán aplicado una bonif. ";
               aAlfa = aAlfa + "NO VIGENTE, provocando error en los Seg. Sociales";
               |MENAV aAlfa;
          |SINO;
               aAlfa = "    No se han encontrado trabajadores con la bonificación ";
               aAlfa = aAlfa + "calculada.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRO;
