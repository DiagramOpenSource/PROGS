|FICHEROS;
     cretai10 #0;

     cretat10;

     cretam01;
     cretam02;
     cretam03;
     cretam04;
     cretam36;

     labempre;
     labtraba;
     labcentr;
     nomcenes;

     nomcalca;
     nomhicca;
     nomcalac;
|FIN;

|VARIABLES;
     swCentroFormacion = 0;
     aCCC = "";

     aFuente = "";
     aAlfa = "";
     aCentroNom = "";

     nEmp = 0;
     nTra = 0;
     nTipo = 0;
     nNume = 0;

     nAny = 0;
     nCampo = 0;
     FEstado = 0;
     nRegistros = 0;
     aTipo = "";
     nTotal = 0;
     aModalidad = "";
|FIN;

|PROCESO cta_cotizacion;
     swCentroFormacion = 0;
     aCCC = #labempre#13;          || cta.cot. de la empresa
     |SI #labtraba#45 = "085"; |O #labtraba#45 = "087"; |O #labtraba#45 = "097";
     |O #labtraba#45 = "421"; |O #labtraba#45 = "422";
          |DDEFECTO #nomcenes;
          |ABRE #nomcenes;
          #nomcenes#0 = #labtraba#0;
          #nomcenes#13 = #labtraba#77;
          #nomcenes#1 = 87;
          |LEE 000#nomcenes.=;
          |SI FSalida = 0;
               aAlfa = #nomcenes#10;      || cta.cto. del centro de trabajo especial
               |QBF aAlfa;
               |SI aAlfa ! "";
                    aCCC = aAlfa;         || cta.cto. del centro de trabajo especial
               |FINSI;
               aCentroNom = #nomcenes#2;
               swCentroFormacion = 1;
          |FINSI;
          |CIERRA #nomcenes;
     |SINO;
          |DDEFECTO #labcentr;
          |ABRE #labcentr;
          #labcentr#0 = #labtraba#0;
          #labcentr#1 = #labtraba#77;
          |LEE 000#labcentr.=;
          |SI FSalida = 0;
               aAlfa = #labcentr#10;      || cta.cot. centro de trabajo
               |QBF aAlfa;
               |SI aAlfa ! "";
                    aCCC = aAlfa;
               |FINSI;
               aCentroNom = #labcentr#2;
          |FINSI;
          |CIERRA #labcentr;
     |FINSI;
     |QBF aCCC;
     |SI aCCC ! "";
          aCCC = ("00000000000" + aCCC) % -111;
     |FINSI;
     aAlfa = #labtraba#247;
     |QBF aAlfa;
     aAlfa = ("0000" + aAlfa) % -104;
     |SI aCCC ! "";
          aCCC = aAlfa + aCCC;
     |FINSI;
|FPRC;

|PROCESO cretam02_atrasos;
     |SI #cretai10#5 = "A"; |Y #cretam02#16 ] 0;
          |ACABA;
     |FINSI;

     #cretat10#0 = #cretam02#0;
     #cretat10#1 = #cretam02#21;
     #cretat10#2 = #cretam02#20;
     #cretat10#3 = #cretam02#3;
     #cretat10#4 = #cretam02#4;
     |LEE 101#cretat10.=;
     |SI FSalida ! 0;
          #cretat10#0 = #cretam02#0;
          #cretat10#1 = #cretam02#21;
          #cretat10#2 = #cretam02#20;
          #cretat10#3 = #cretam02#3;
          #cretat10#4 = #cretam02#4;

          |PARA nCampo = 5; |SI nCampo [ 22; |HACIENDO nCampo = nCampo + 1;
               #cretat10#nCampo# = #cretam02#nCampo#;
          |SIGUE;

          #labempre#0 = #cretat10#0;
          |LEE 000#labempre.=;
          #cretat10#23 = #labempre#2;

          aModalidad = "";
          |HAZ BuscaRLC;
          #cretat10#25 = aModalidad;

          |QBF aModalidad;
          aAlfa = aModalidad % 104;

          |SI #0#5 = "C"; |Y aAlfa ! "Carg"; |ACABA; |FINSI;
          |SI #0#5 = "P"; |Y aAlfa ! "Pago"; |ACABA; |FINSI;
          |SI #0#5 = "A"; |Y aAlfa ! "Sald"; |ACABA; |FINSI;

          |GRABA 020#cretat10.n;
          |LIBERA #cretat10;
     |FINSI;
|FPRC;

|DEFBUCLE cretam02_atrasos;
     #cretam02#3;
     ;
     #0#0, #0#2, #0#3, 05, "           ";
     #0#1, #0#2, #0#3, 20, "zzzzzzzzzzz";
     ;
     NULL, cretam02_atrasos;
|FIN;

|PROCESO BuscaRLC;
     #cretam36#0 = #cretam02#0;
     #cretam36#1 = #cretam02#1;
     #cretam36#2 = #cretam02#2;
     #cretam36#3 = #cretam02#3;
     #cretam36#4 = #cretam02#4;

     |SI #cretam02#3 ] 5; |Y #cretam02#3 [ 20;
          #cretam36#1 = #cretam02#21;
          #cretam36#2 = #cretam02#20;
          #cretam36#58 = #cretam02#19;
     |FINSI;
     |LEE 000#cretam36.=;
     |SI FSalida = 0;
          aModalidad = #cretam36#31;
     |FINSI;
|FPRC;

|PROCESO cretam02;
     |SI #cretai10#5 = "A"; |Y #cretam02#16 ] 0;
          |ACABA;
     |FINSI;

     |PARA nCampo = 0; |SI nCampo [ 22; |HACIENDO nCampo = nCampo + 1;
          #cretat10#nCampo# = #cretam02#nCampo#;
     |SIGUE;

     #labempre#0 = #cretat10#0;
     |LEE 000#labempre.=;
     #cretat10#23 = #labempre#2;

     aModalidad = "";
     |HAZ BuscaRLC;
     #cretat10#25 = aModalidad;

     |QBF aModalidad;
     aAlfa = aModalidad % 104;

     |SI #0#5 = "C"; |Y aAlfa ! "Carg"; |ACABA; |FINSI;
     |SI #0#5 = "P"; |Y aAlfa ! "Pago"; |ACABA; |FINSI;
     |SI #0#5 = "A"; |Y aAlfa ! "Sald"; |ACABA; |FINSI;

     |GRABA 020#cretat10.n;
     |LIBERA #cretat10;
|FPRC;

|DEFBUCLE cretam02;
     #cretam02#1;
     ;
     #0#0, #0#2, #0#3, 00, "           ";
     #0#1, #0#2, #0#3, 02, "zzzzzzzzzzz";
     ;
     NULL, cretam02;
|FIN;

|PROCESO imprime;
     |SI nRegistros = 0;
          Impresora = "CrystalReport";
          |IMPRE -1;
          |INFOR "cretai10";
     |FINSI;
     |PRINT;
     nRegistros = nRegistros + 1;
|FPRC;

|DEFBUCLE cretat10;
     #cretat10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, imprime;
|FIN;

|PROCESO Impresion;
     |BUCLE cretat10;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |BORRA 020#0a;
     |FINSI;

     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida = 0;
          aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_cretat10_" + aAlfa;
          |NOME_DAT #cretat10#aAlfa#;
          |DELINDEX #cretat10;
          |ABRE #cretat10;

          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #cretam36;

          aTipo = "N";
          |BUCLE cretam02;

          aTipo = "A";
          |BUCLE cretam02_atrasos;

          nAny = #0#2 - 2000;

          |HAZ Impresion;
          |SI nRegistros ! 0;
               |PIEINF;
               |FININF;
               |FINIMP;
          |FINSI;

          |CIERRA #cretam36;
          |CIERRA #labtraba;
          |CIERRA #labempre;
          |CIERRA #cretat10;

          |DELINDEX #cretat10;
     |FINSI;

     |GRABA 000#0n;
     |CIERRA #0;
|FPRO;
