|FICHEROS;
     znom0006 #0;

     labempre;
     labtraba;

     nomcalca;
     nomhicca;
     nomtrato;
     nomir003;

     nomtmp07 #100;
|FIN;

|VARIABLES;
     nCasos = 0;
     nPromedio = 0;
     nNuevoPromedio = 0;
     hmes = 0;
     hany = 0;
     henfe = 0;
     hbase = 0;
     hdias = 0;
     swSigue = 0;
     nCampo = 0;
     nCampoD = 0;
     nCampoH = 0;
     nAnyBucle = 0;
     &nAny = 0;
     &nMes = 0;
     &nTopemes = 0;
     alfa1 = "";
     aAlfa = "";
     aDesde = "";
     fFecha1 = @;
     fFecha2 = @;
     fFechaAlta = @;
     fFechaBaja = @;
     aFechaAlta = "";
     aFechaBaja = "";
     nEmp = 0;
     nTra = 0;
     aNif = "";
     aDia = "";
     aMes = "";
     aAny = "";
     aFecha1 = "";
     aFecha2 = "";
     nFecha1 = 0;
     nFecha2 = 0;
     &nMesCalculo = 0;
     nBaseOct = 0;
     nBaseNov = 0;
     nBaseDic = 0;
     nBaseEne = 0;
     nDiasOct1 = 0;
     nDiasNov1 = 0;
     nDiasDic1 = 0;
     nDiasEne1 = 0;
     nDiasOct2 = 0;
     nDiasNov2 = 0;
     nDiasDic2 = 0;
     nDiasEne2 = 0;

     aAlfa1 = "";
     aAlfa2 = "";
     aFuente = "";
     nNume = 0;
     aITCot = "";

     FEstado = 0;
     nDiferencia = 0;
|FIN;

|PROCESO Impresion;
     |PRINT;
|FPRC;

|DEFBUCLE Impresion;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impresion;
|FIN;

|PROCESO Graba;
     nCasos = nCasos + 1;
     |DDEFECTO #100;
     #100#0 = #labempre#0;
     #100#1 = #labtraba#1;
     #100#2 = #0#5;
     #100#3 = nMesCalculo;
     |LEE 101#100=;
     FEstado = FSalida;

     #100#4 = #labempre#2;
     #100#5 = #labtraba#2;

     #100#6 = nPromedio;
     #100#7 = nNuevoPromedio;
     |SI aDesde = "M";
          #100#8 = "Mensual";
     |FINSI;
     |SI aDesde = "H";
          #100#8 = "Historico";
     |FINSI;

     #100#12 = #labtraba#45;
     |SI aFuente = "M";
          #100#13 = #nomcalca#163;
     |FINSI;
     |SI aFuente = "H";
          #100#13 = #nomhicca#205;
     |FINSI;
     #100#14 = #nomtrato#3;

     #nomir003#0 = #labtraba#7;
     #nomir003#40 = #0#5;
     #nomir003#41 = #labtraba#0;
     |LEE 000#nomir003.=;
     |SI FSalida = 0;
          #100#16 = #nomir003#6;
     |FINSI;
     #100#17 = aITCot;
     |SI aITCot = "S";
          |SI aFuente = "M";
               #100#15 = #nomcalca#37;
          |FINSI;
          |SI aFuente = "H";
               #100#15 = #nomhicca#37;
          |FINSI;
     |FINSI;

     |SI FEstado = 0;
          |GRABA 020#100a;
     |SINO;
          |GRABA 020#100n;
     |FINSI;

     |LIBERA #100;
|FPRC;

|PROCESO nomhicca;
     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;

     |SELECT #1#labtraba;
     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;


     #nomtrato#0 = #labtraba#247;
     #nomtrato#1 = #labtraba#45;
     |LEE 000#nomtrato.=;
     |SI FSalida = 0;
          |SI #nomhicca#205 ! #nomtrato#3;
               |HAZ Graba;
          |FINSI;
     |FINSI;

     aITCot = "N";
     swSigue = 0;
     nNume = #nomhicca#31 + #nomhicca#32 + #nomhicca#65;
     |SI nNume ] #nomhicca#8;
          swSigue = 1;
     |FINSI;
     |SI #labtraba#42 = "M";
          |SI nNume = #nomhicca#8; |Y nNume = 30;
               |SI #0#4 = 2; |O #0#4 = 4; |O #0#4 = 6;
               |O #0#4 = 9; |O #0#4 = 11; |O #0#4 = 2;
                    swSigue = 0;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          |SI #nomhicca#37 ! 0;
               aITCot = "S";
               |HAZ Graba;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #0#0, #0#2, nAnyBucle, #0#4, 0;
     #0#1, #0#3, nAnyBucle, #0#4, 0;
     ;
     NULL, nomhicca;
|FINSI;

|PROCESO nomcalca;
     #labempre#0 = #nomcalca#0;
     |LEE 000#labempre.=;

     |SELECT #1#labtraba;
     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 000#labtraba.=;

     #nomtrato#0 = #labtraba#247;
     #nomtrato#1 = #labtraba#45;
     |LEE 000#nomtrato.=;
     |SI FSalida = 0;
          |SI #nomcalca#163 ! #nomtrato#3;
               |HAZ Graba;
          |FINSI;
     |FINSI;

     aITCot = "N";
     swSigue = 0;
     nNume = #nomcalca#31 + #nomcalca#32 + #nomcalca#65;
     |SI nNume ] #nomcalca#8;
          swSigue = 1;
     |FINSI;
     |SI #labtraba#42 = "M";
          |SI nNume = #nomcalca#8; |Y nNume = 30;
               |SI #0#4 = 2; |O #0#4 = 4; |O #0#4 = 6;
               |O #0#4 = 9; |O #0#4 = 11; |O #0#4 = 2;
                    swSigue = 0;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          |SI #nomcalca#37 ! 0;
               aITCot = "S";
               |HAZ Graba;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #0#0, #0#2, #0#4, 0;
     #0#1, #0#3, #0#4, 0;
     ;
     NULL, nomcalca;
|FINSI;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #nomcalca;
          |ABRE #nomhicca;
          |ABRE #nomtrato;
          |ABRE #nomir003;

          alfa1 = Usuario; |QBF alfa1;  alfa1 = "tmp_nomtmp07_" + alfa1;
          |NOME_DAT #100 alfa1;
          |DELINDEX #100;
          |ABRE #100;

          |CUADRO 17202160;
          |PINTA 1830, "Examinando Mensual";

          aFuente = "M";
          |BUCLE nomcalca;

          nAnyBucle = #0#5 - 2000;
          |PINTA 1830, "Examinando Hist¢rico";
          aFuente = "H";
          |BUCLE nomhicca;

          |SI nCasos ! 0;
               |CONSULTA_CLAVE #1#100;
/*
               Impresora = "CrystalReport";
               |IMPRE -1;
               |INFOR "znom0006";

               |BUCLE Impresion;

               |PIEINF;
               |FININF;
               |FINIMP;
*/
          |SINO;
               aAlfa = "    No se han detectado trabajadores afectados.";
               |MENAV aAlfa;
          |FINSI;

          |CIERRA #100;
          |DELINDEX #100;

          |CIERRA #nomir003;
          |CIERRA #nomtrato;
          |CIERRA #nomhicca;
          |CIERRA #nomcalca;
          |CIERRA #labtraba;
          |CIERRA #labempre;
     |FINSI;
|FPRO;
