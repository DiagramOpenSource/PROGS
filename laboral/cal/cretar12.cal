|FICHEROS;
     cretae02;
     cretae03;

     cretam02;
     cretam03;
|FIN;

|VARIABLES;
     &eaReferencia = "";
     &nEmp = 0;
     &aAnyLiq = "";
     &aMesLiq = "";
     &aCCC = "";
     &aNaf = "";
     &nErrores = 0;
     &swCCCCorrecto = 0;
     &aSoloFichero = "";
     &aTipoRespuesta = "";
     &nTipoFichero = 0;
     aHora = "";
     fFecha = @;
     aFecha = "";
     &nTipo = 0;
     &nMesDesde = 0;
     &nMesHasta = 0;
     nMesClave = 0;
     &aMesControl = "";
     &aAnyControl = "";
     swSigue = 0;
     FEstado = 0;
|FIN;

|PROCESO ActualizaEstado;
     |SI #cretae03#8 ! "E";
          #cretae03#8 = "C";
          #cretae03#14 = aSoloFichero;
          fFecha = ~;
          #cretae03#15 = fFecha;
          |HORA aHora;
          #cretae03#16 = (aHora % 105);

          |GRABA 020#cretae03.a;
          |LIBERA #cretae03;

          || lo hago con un PARA, porque para atrasos es necesario, para L00 o L13
          || solo entrara una vez

          |PARA nMesClave = nMesDesde; |SI nMesClave [ nMesHasta; |HACIENDO nMesClave = nMesClave + 1;
               #cretam03#0 = #cretae03#0;
               #cretam03#1 = aAnyLiq;
               #cretam03#2 = nMesClave;
               #cretam03#3 = #cretae03#3;
               #cretam03#4 = #cretae03#4;
               #cretam03#5 = #cretae03#5;
               swSigue = 0;

               |LEE 101#cretam03.=;
               |SI FSalida = 0;
                    swSigue = 1;
               |SINO;
                    |SI nTipo ] 5; |Y nTipo [ 20;
                         #cretam03#1 = aAnyControl;
                         |LEE 101#cretam03.=;
                         |SI FSalida = 0;
                              swSigue = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI swSigue = 1;
                    #cretam03#13 = "C";
                    #cretam03#14 = eaReferencia;

                    |GRABA 020#cretam03.a;
                    |LIBERA #cretam03;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|DEFBUCLE ActualizaEstado;
     #cretae03#1;
     ;
     #cretae02#0, #cretae02#1, #cretae02#2, #cretae02#3, #cretae02#4, "            ", eaReferencia;
     #cretae02#0, #cretae02#1, #cretae02#2, #cretae02#3, #cretae02#4, "zzzzzzzzzzzz", eaReferencia;
     be;
     NULL, ActualizaEstado;
|FIN;

|PROCESO RegistroCCC;
     |DDEFECTO #cretae02;
     |ABRE #cretae02;
     #cretae02#0 = nEmp;
     #cretae02#1 = aAnyLiq;
     #cretae02#2 = aMesLiq;
     #cretae02#3 = nTipo;
     #cretae02#4 = aCCC;
     #cretae02#6 = eaReferencia;
     swSigue = 0;

     |LEE 101#cretae02.=;
     |SI FSalida = 0;
          swSigue = 1;
     |SINO;
          |SI nTipo ] 5; |Y nTipo [ 20;
               #cretae02#1 = aAnyControl;
               |LEE 101#cretae02.=;
               |SI FSalida = 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          |SI aTipoRespuesta = "B";
               || respuesta al fichero de Bases
               |SI nErrores = 0; |Y swCCCCorrecto = 1;
                    #cretae02#8 = "C";
               |SINO;
                    #cretae02#8 = "E";
               |FINSI;
          |FINSI;
          |SI nTipoFichero = 2;
               #cretae02#8 = "C";
          |FINSI;
          #cretae02#14 = aSoloFichero;
          fFecha = ~;
          #cretae02#15 = fFecha;
          |HORA aHora;
          #cretae02#16 = (aHora % 105);

          |GRABA 020#cretae02.a;
     |FINSI;

     |DDEFECTO #cretam02;

     |ABRE #cretam02;

     || lo hago con un PARA, porque para atrasos es necesario, para L00 o L13
     || solo entrara una vez

     |PARA nMesClave = nMesDesde; |SI nMesClave [ nMesHasta; |HACIENDO nMesClave = nMesClave + 1;
          #cretam02#0 = nEmp;
          #cretam02#1 = aAnyLiq;
          #cretam02#2 = nMesClave;
          #cretam02#3 = nTipo;
          #cretam02#4 = aCCC;

          swSigue = 0;
          |LEE 101#cretam02.=;
          |SI FSalida = 0;
               swSigue = 1;
          |SINO;
               |SI nTipo ] 5; |Y nTipo [ 20;
                    #cretam02#1 = aAnyControl;
                    |LEE 101#cretam02.=;
                    |SI FSalida = 0;
                         swSigue = 1;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI swSigue = 1;
               |SI aTipoRespuesta = "B";
                    swSigue = 0;
                    |SI nErrores = 0;
                         |SI swCCCCorrecto = 1; |O swCCCCorrecto = 2;
                         |O swCCCCorrecto = 3;
                              swSigue = 1;
                         |FINSI;
                    |FINSI;
                    |SI swSigue = 1;
                         |SI swCCCCorrecto = 1;
                              #cretam02#7 = "C";
                         |FINSI;
                         |SI swCCCCorrecto = 2;
                              || liquidacion previamente confirmada
                              #cretam02#7 = "F";
                         |FINSI;
                         |SI swCCCCorrecto = 3;
                              || liquidacion confirmada de oficio
                              #cretam02#7 = "O";
                         |FINSI;
                    |SINO;
                         #cretam02#7 = "E";
                    |FINSI;
                    #cretam02#8 = eaReferencia;
               |FINSI;
               |SI aTipoRespuesta = "R";
                    |SI nErrores = 0; |Y swCCCCorrecto = 1;
                         #cretam02#12 = "C";
                    |SINO;
                         #cretam02#12 = "E";
                    |FINSI;
                    #cretam02#13 = eaReferencia;
               |FINSI;
               |SI nTipoFichero = 2;
                    #cretam02#9 = "C";
                    #cretam02#10 = eaReferencia;
               |FINSI;
               |GRABA 020#cretam02.a;
               |LIBERA #cretam02;
          |FINSI;
     |SIGUE;

     |SI aTipoRespuesta = "B";
          |ABRE #cretam03;

          |BUCLE ActualizaEstado;

          |CIERRA #cretam03;
     |FINSI;

     |CIERRA #cretam02;

     |CIERRA #cretae02;
     |LIBERA #cretae02;
|FPRC;

|PROCESO RegistroNAFSS;
     |DDEFECTO #cretae03;
     |ABRE #cretae03;
     #cretae03#0 = nEmp;
     #cretae03#1 = aAnyLiq;
     #cretae03#2 = aMesLiq;
     |SI nTipo ] 5; |Y nTipo [ 20;
          #cretae03#1 = aAnyControl;
          #cretae03#2 = aMesControl;
     |FINSI;
     #cretae03#3 = nTipo;
     #cretae03#4 = aCCC;
     #cretae03#5 = aNaf;
     #cretae03#6 = eaReferencia;
     |LEE 101#cretae03.=;
     FEstado = FSalida;

     #cretae03#8 = "E";
     #cretae03#14 = aSoloFichero;
     fFecha = ~;
     #cretae03#15 = fFecha;
     |HORA aHora;
     #cretae03#16 = (aHora % 105);
     |SI FEstado = 0;
          |GRABA 020#cretae03.a;
     |SINO;
          || el trabajador es 00000 porque es un caso de error de trabajador
          || que no se ha incluido en el envio y me estan dado un aviso
          #cretae03#10 = 00000;
          |GRABA 020#cretae03.n;
     |FINSI;

     |LIBERA #cretae03;
     |CIERRA #cretae03;

     |ABRE #cretam03;
     #cretam03#0 = nEmp;
     #cretam03#1 = aAnyLiq;
     #cretam03#2 = aMesLiq;
     #cretam03#3 = nTipo;
     #cretam03#4 = aCCC;
     #cretam03#5 = aNaf;
     swSigue = 0;

     |LEE 101#cretam03.=;
     |SI FSalida = 0;
          swSigue = 1;
     |SINO;
          |SI nTipo ] 5; |Y nTipo [ 20;
               #cretam03#1 = aAnyControl;
               |LEE 101#cretam03.=;
               |SI FSalida = 0;
                    swSigue = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          #cretam03#13 = "E";
          #cretam03#14 = eaReferencia;
          |GRABA 020#cretam03.a;
     |FINSI;

     |LIBERA #cretam03;
     |CIERRA #cretam03;
|FPRC;
