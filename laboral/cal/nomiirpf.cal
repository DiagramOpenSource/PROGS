|FICHEROS;
     nomiirpf #0;
     nomiitmp #100;
     labtraba;
     nomir003;
     nomcalca;
     nomhicca;
|FIN;

|VARIABLES;
     fFechaAlta = @;
     swPrueba1 = 0;
     aDNI = "";
     aDNIAnt = "";
     aAlfa = "";
     nEmpAnt = 0;
     nTrabAnt = 0;
|FIN;

|PROCESO MiraEnero;
     swPrueba1 = 0;
     #nomhicca#0 = #nomir003#41;   || empresa
     #nomhicca#1 = nTrabAnt;    || trabajador
     #nomhicca#66 = #nomiirpf#6 - 2000;      || a¤o
     #nomhicca#2 = 1;              || mes (Enero)
     #nomhicca#3 = 0;              || tipo (el 0)
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          swPrueba1 = 1;           || en enero se calculo la nomina: imprime
     |SINO;
          #nomcalca#0 = #nomir003#41;   || empresa
          #nomcalca#1 = nTrabAnt;       || trabajador
          #nomcalca#2 = 1;              || mes (Enero)
          #nomcalca#3 = 0;              || tipo (el 0)
          |LEE 000#nomcalca.=;     || otra oportunidad: a ver si en el nomcalca
          |SI FSalida = 0;
               swPrueba1 = 1;           || prueba superada: imprime
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nomir003;
     #nomir003#0  = aDNIAnt;   ||  NIF
     #nomir003#40 = #0#6; ||  Ejercicio
     #nomir003#41 = nEmpAnt;  ||  Empresa
     |LEE 000#nomir003.=
     |SI FSalida = 0;
          ||HAZ MiraEnero;
          swPrueba1 = 1;
          |SI swPrueba1 = 1;
               #labtraba#0 = nEmpAnt;
               #labtraba#1 = nTrabAnt;
               |LEE 000#labtraba.=;
               |PRINT;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ElUltimo;
     aDNIAnt  = aDNI;
     nEmpAnt  = #nomiitmp#1;
     nTrabAnt = #nomiitmp#2;
     |HAZ nomir003;
|FPRC;

|PROCESO nomiitmp;
     aDNI = #nomiitmp#0;
     |QBF aDNI;
     |QBF aDNIAnt;
     |SI aDNI ! aDNIAnt; |Y aDNIAnt ! "";
          |HAZ nomir003;
     |FINSI;
     aDNIAnt = aDNI;
     nEmpAnt = #nomiitmp#1;
     nTrabAnt = #nomiitmp#2;
|FPRC;

|DEFBUCLE nomiitmp;
     #nomiitmp#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomiitmp;
|FIN;

|PROCESO GrabaTmp;
     #nomiitmp#0 = #labtraba#7;    || DNI
     #nomiitmp#1 = #labtraba#0;    || Empresa
     #nomiitmp#2 = #labtraba#1;    || Trabajador
     fFechaAlta = #labtraba#36;
     #nomiitmp#3 = fFechaAlta;     || Fecha Alta
     |GRABA 020#nomiitmp.n;
|FPRC;

|PROCESO labtraba;
     fFechaAlta = #labtraba#36;
     |SI #0#4  [ fFechaAlta; |Y fFechaAlta [ #0#5;
          |HAZ GrabaTmp;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     ;
     #0#0, #0#2;
     #0#1, #0#3;
     ;
     NULL, labtraba;
|FIN;

|PROCESO impresion; |TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "nomiirpf";
          aAlfa = Usuario; |QBT aAlfa; aAlfa = ("t" + aAlfa) % 108;
          |NOME_DAT #100 aAlfa;
          |DELINDEX #nomiitmp;
          |ABRE #nomiitmp;
          |ABRE #nomir003;
          |ABRE #nomcalca;
          |ABRE #nomhicca;
          |ABRE #labtraba;
          |BUCLE labtraba;
          |BUCLE nomiitmp;
          |HAZ ElUltimo;
          |CIERRA #labtraba;
          |CIERRA #nomhicca;
          |CIERRA #nomcalca;
          |CIERRA #nomir003;
          |CIERRA #nomiitmp;
          |PIEINF;
          |FININF;
          |FINIMP;
     |SINO;
          |MENAV "     Proceso Abortado ...";
     |FINSI;
|FPRC;
