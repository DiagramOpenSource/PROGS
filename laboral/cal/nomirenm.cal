|FICHEROS;
     nomirenm #0;
     nomcalca #1;
     labtraba #2;
     labempre #3;
     nomauxi1 #4;   || areas (grupos)
     nomauxi2 #5;   || secciones (subgrupos)
     nomauxc3 #6;   || prorrata cabs.
     nomauxl3 #7;   || prorrata lins.
     nomauxtp #8;   || temporal prorrata
     nomhicca #9;   || historico
     labempax #10;
     labemphi #11;
     nomcalac #12;  || atrasos
     nomcalcu #40;  || calculo mensual
     nomtraca;
     nomconst;
     nomepigr;
     nombofli;
     nomyrtmp #201;

     nomcalli;
     nomhicli;
     nomcalal;
     nomconca;
     nomcont3;
     nomcontr;

     cretam00;
     cretam02;
     cretam35;      || conceptos DCL
     cretam37;      || comceptos RLC
|FIN;

|VARIABLES;
     &swModulo = 0;
     &nTipoD = 0;
     &nTipoH = 0;
     &nPara = 0;
     &enTipo = 0;

     &enEmpIni = 0;
     &enEmpFin = 0;
     &enTrabIni = 0;
     &enTrabFin = 0;
     &enMes = 0;
     &eaAnyo = "";

     nBaseERE = 0;
     nCuotaERE = 0;
     nConstante = 0;
    desde = 0;
    hasta = 0;
    si_hay=0;
    &month = 0;
    mesos = 0;
    seleccio = 0;
    centro = 0;
    sw = 0;
    empresa = 0;

    ginf_enf = 0;
    ginf_sub = 0;
    ginf_bru = 0;
    ginf_dto = 0;
    ginf_tan = 0;
    ginf_ded = 0;
    ginf_dse = 0;
    ginf_liq = 0;
    ginf_sss = 0;
    ginf_bon = 0;
    ginf_exe = 0;

    sinf_enf = 0;
    sinf_sub = 0;
    sinf_bru = 0;
    sinf_dto = 0;
    sinf_tan = 0;
    sinf_ded = 0;
    sinf_dse = 0;
    sinf_liq = 0;
    sinf_sss = 0;
    sinf_bon = 0;
    sinf_exe = 0;

    cinf_enf = 0;
    cinf_sub = 0;
    cinf_bru = 0;
    cinf_dto = 0;
    cinf_tan = 0;
    cinf_ded = 0;
    cinf_dse = 0;
    cinf_liq = 0;
    cinf_sss = 0;
    cinf_bon = 0;
    cinf_exe = 0;
    tinf_tan = 0;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fecsys = @;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    error0       = "     Proceso ABORTADO !!! ";
    informe = "nomirenm";
    &p_mes = " ";
    &swlin = 0;
    &varinf1 = "";
    &varinf2 = "";

    &inf_enf = 0;
    &inf_sub = 0;
    &inf_bru = 0;
    &inf_dto = 0;
    &inf_tan = 0;
    &inf_ded = 0;
    &inf_dse = 0;
    &inf_liq = 0;
    &inf_sss = 0;
    &inf_bon = 0;
    &inf_exe = 0;

    &pinf_enf = 0;
    &pinf_sub = 0;
    &pinf_bru = 0;
    &pinf_dto = 0;
    &pinf_ded = 0;
    &pinf_dse = 0;
    &pinf_liq = 0;
    &pinf_sss = 0;
    &pinf_bon = 0;
    &pinf_exe = 0;

    &tinf_tc1 = 0;
    &tinf_tc1re = 0;
    &tinf_enf = 0;
    &tinf_sub = 0;
    &tinf_bru = 0;
    &tinf_dto = 0;
    &tinf_ded = 0;
    &tinf_dse = 0;
    &tinf_liq = 0;
    &tinf_sss = 0;
    &tinf_bon = 0;
    &tinf_exe = 0;

    &fecha = @;
    &cabeza = "";
    grupo = "";
    subgr = "";
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    campo7 = 0;
    campo8 = 0;
    campo9 = 0;
    campoa = 0;
    campob = 0;
    campoc = 0;
    campod = 0;
    campoe = 0;
    ultimo = 0;
    &area = "";
    &secc = "";
    &eacodarea = "";
    &eacodsecc = "";
    coef = 0;

    dia = 0;
    mes = 0;
    any = 0;
    swbaja = 0;
    fecalf = "";
    campo_irpf = 0;
    &cabeza_tit = "";
    &resumen = "";
    &aAunno = "";
    &inf_ant = 0;
    &inf_ant1 = 0;
    &inf_ant2 = 0;
    &inf_ant3 = 0;
     &aCabProrr = "";
     &aCabProrr2 = "";
     &fCFecha = @;
     &nCConst = 0;
     &aCError = "";
     nTipo = 0;
     &enCuadre = 0;
     &eaFuente = "";
     &enTipoInf = 0;
     &enOrdenTra = 0;
     &nUnoTipo2 = 0;
     &aNomPag = "";
     nMes = 0;
     aAlfa = "";
     aAlfa1 = "";
     FEstado = 0;
     nNume = 0;
     &swPagasSN = 0;
     nAnyTmp = 0;
     swHayDatos = 0;
     &nBonForCon = 0;

 {-1}aMenu  = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Archivo documental activado. Elija opci¢n: ";
     aMenu4 = "IA";
     aMenu5 = "Imprimir";
     aMenu6 = "Archivar";
     || aMenu7 = "Ambos";
     &nOpcion = 0;
     &nArchi = 0;
     &eaVengoDe = "";
     &enSwDesde9 = 1;
     &enSwMeteGrupoSubTipo = 0;
     &swErrorDSArchi = 0;
     &eaInforme = "";
     swSigue = 0;
     aEmp = "";
     aCen = "";
     aTra = "";
     aNomEmp = "";
     &enDesdeMes = 0;
     &enAny = 0;
     &enSwFiniq = 0;
     nEmpresa = 0;

     nAnyCretaDesde = 0;
     nAnyCretaHasta = 0;
     nMesCretaDesde = 0;
     nMesCretaHasta = 0;

     nAnyAux = 0;
     nMesAux = 0;

     import = 0;
     concep = 0;
     numer = 0;
     numerl = 0;
     nTipoMen = 0;
     nDesdeTipoMen = 0;
     nHastaTipoMen = 0;
     swJunto = 0;

     &aFuenteTotal = "";
     nTipoAnt = 0;
     nImporteTC1 = 0;
     swHayCreta = 0;
     swCretaLeido = 0;
     hay_algo_tc1H = 0;
     swLiqCreta = 0;
     swMora = 0;
     nDesdeTipo = 0;
     nHastaTipo = 0;
|FIN;

|PROCESO Cuadre; |TIPO 0;
     |SI #0#17 = 2;
          |SI #0#0 ! #0#1; |Y FSalida ! 2;
               aAlfa = "    ATENCION: en el informe en EXCEL sólo se puede imprimir ";
               aAlfa = aAlfa + " una empresa. Corrija la selección."
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO parrilla; |TIPO 0;
|ACABA;
|| esto pa que?
     |SI #0#11="M";
          |ABRE #40;
          |LEE 001#40p;
          |SI FSalida ! 0;  |DDEFECTO #40;  |FINSI;
              #0#0 = #40#0;        || desde empresa
              #0#1 = #40#1;        || hasta empresa
          |CIERRA #40;
     |FINSI;
/*
     |SI #0#11="H"; |O #0#11="A";
          #0#0=1;
          #0#1=99999;
     |FINSI;
*/
     |PINDA #0#0;
|FPRC;

|PROCESO PParametro; |TIPO 7;
     |SI PARAMETRO="M"; |O PARAMETRO="H"; |O PARAMETRO="A";
          |CAMPO_MODIFICA #0#11,1,"N";
          #0#11=PARAMETRO;
     |FINSI;
|FPRC;


|PROCESO RegDefecto;|TIPO 7;
     |SI #0#11="M";
          #0Campo=0;
     |FINSI;
     |SI #0#11="A";
          #0Campo=5;
     |FINSI;

|FPRC;

|PROCESO TipoResumen; |TIPO 0;
     |SI #0#11="M";
          |SI #0Campo!0; |Y #0Campo!2;
               |MENAV "0000Tipo de Resumen no Valido";
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #0#11="A";
          |SI #0Campo<5;
               |MENAV "0000Tipo de Resumen no Valido";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FuenteDatos; |TIPO 0;
     |SI #0#11="M";
          |SI #0#11="M";
               alfa1="MENSUAL  ";
          |FINSI;

          |CAMPO_VISUAL #0#12,1,"N";
          |CAMPO_VISUAL #0#13,1,"N";
          |CAMPO_VISUAL #0#2,1,"S";
          |CAMPO_VISUAL #0#18,1,"N";
          |CAMPO_VISUAL #0#19,1,"N";
          |CAMPO_MODIFICA #0#18,1,"N";
          |CAMPO_MODIFICA #0#19,1,"N";

          |PINTA 1219,"ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ´";
          |PINTA 1319,"³ Mes .................:                  ³";
          |PINTA 1419,"³ A¤o .................:                  ³";
          |PINTA #0#2;
          |PINTA 1521,"Tipo de Resumen (0/2):";
     |FINSI;

     |SI #0#11 = "H";
          |SI #0#11="H";
               alfa1="HISTORICO";
          |FINSI;


          |CAMPO_VISUAL #0#12,1,"N";
          |CAMPO_VISUAL #0#13,1,"N";
          |CAMPO_VISUAL #0#2,1,"S";

          |PINTA 1219,"ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ´";
          |PINTA 1319,"³ Mes .................:    -             ³";
          |PINTA #0#2;
          |PINTA 1521,"Tipo de Resumen (0/2):";
     |FINSI;

     |SI #0#11="A";
          alfa1="ATRASOS  ";
          |CAMPO_VISUAL #0#12,1,"S";
          |CAMPO_VISUAL #0#13,1,"S";
          |CAMPO_VISUAL #0#2,1,"N";
          |CAMPO_VISUAL #0#18,1,"N";
          |CAMPO_VISUAL #0#19,1,"N";
          |CAMPO_MODIFICA #0#18,1,"N";
          |CAMPO_MODIFICA #0#19,1,"N";

          |PINTA 1219,"³ Mes .........:³            ³            ³";
          |PINTA 1319,"ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ´";
          |PINTA 1419,"³ A¤o .................:                  ³";

          |PINTA #0#12;
          |PINTA #0#13;

          |PINTA 1521,"Tipo de Resumen (5/9):";
     |FINSI;

     |PINTA 0743,alfa1;
     |PINTA #0#11;

     |PINDA #0#0;
|FPRC;

|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#2;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     nume3 = 2000 + #0#4;
     alfa3 = nume3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
|FPRC;

|PROCESO ERE;
     |MODULO alfa1;
     |QBF alfa1;
     |SI #0#11 = "M";
          nume1 = #nomcalca#78;
     |FINSI;
     |SI #0#11 = "H";
          nume1 = #nomhicca#119;
     |FINSI;
     nBaseERE = 0;
     nCuotaERE = 0;
     |SI nume1 > 0;
          |ABRE #nomtraca;
          |ABRE #nomepigr;
          |ABRE #nomconst;

          nCConst = #labtraba#248;
          |HAZ constante;

          #nomepigr#0 = 126;
          |LEE 000#nomepigr.=;

          nBaseERE = (nume1 * #labtraba#242) ! 2;
          nCuotaERE = (nBaseERE % #nomconst#6) ! 2;
          nCuotaERE = nCuotaERE + ((nBaseERE % #nomconst#12) ! 2);
          nCuotaERE = nCuotaERE + ((nBaseERE % #nomconst#14) ! 2);
          nCuotaERE = nCuotaERE + ((nBaseERE % #nomconst#16) ! 2);
          nCuotaERE = nCuotaERE + ((nBaseERE % (#nomepigr#1 + #nomepigr#2)) ! 2);

          |CIERRA #nomconst;
          |CIERRA #nomepigr;
          |CIERRA #nomtraca;
     |FINSI;
|FPRC;

*****************************************************************************
    LLAMADAS DESDE CAMPOS
*****************************************************************************

|PROCESO mirames; |TIPO 7; ||CALCULA EL MES POR DEFECTO SEGUN FECHA SISTEMA
/*
     fecsys = ~;
     alfa1 = fecsys;
     alfa1 = alfa1 % 402;
     #0Campo = alfa1;
     |PINTA #0Campo;

     |SI #0#11 = "H";
          #0#18 = alfa1;
          |PINTA #0#18;
     |FINSI;
*/
|FPRC;

|PROCESO mesletra;
     |SI nMes =  1;  p_mes = "ENERO     ";  |FINSI;
     |SI nMes =  2;  p_mes = "FEBRERO   ";  |FINSI;
     |SI nMes =  3;  p_mes = "MARZO     ";  |FINSI;
     |SI nMes =  4;  p_mes = "ABRIL     ";  |FINSI;
     |SI nMes =  5;  p_mes = "MAYO      ";  |FINSI;
     |SI nMes =  6;  p_mes = "JUNIO     ";  |FINSI;
     |SI nMes =  7;  p_mes = "JULIO     ";  |FINSI;
     |SI nMes =  8;  p_mes = "AGOSTO    ";  |FINSI;
     |SI nMes =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
     |SI nMes = 10;  p_mes = "OCTUBRE   ";  |FINSI;
     |SI nMes = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
     |SI nMes = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|FPRC;

|PROCESO pintames; |TIPO 0;      || PINTA EL MES LITERAL
     |SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
     |SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
     |SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
     |SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
     |SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
     |SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
     |SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
     |SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
     |SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
     |SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
     |SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
     |SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;

     |SI #0#11 = "M";
          |ATRI I;
          |PINTA 1348, p_mes;
          |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO Activa7; |TIPO 7;
     |SI #0#5 = #0#15;
          |CAMPO_VISUAL #0#7, 1, "N";
          |CAMPO_MODIFICA #0#7, 1, "N";
          #0#7 = "1";
          |PINTA 1621, "                           ";
     |SINO;
          |CAMPO_VISUAL #0#7, 1, "S";
          |CAMPO_MODIFICA #0#7, 1, "S";
          |PINTA 1621, "Tipo de emisi¢n .....:     ";
          |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
/*
     fech1 = ~;
     alfa1 = fech1;
     alfa1 = alfa1 % -102;
     #0Campo = alfa1;
     |PINTA #0Campo;
     |SI #0#11 = "H";
          #0#19 = alfa1;
          |PINTA #0#19;
     |FINSI;
*/
|FPRC;

/****************************************************************************/
/************* PAGAS PRORRATEADAS EN REMUNERACION Y NO EN PRORRATA **********/
/****************************************************************************/

|PROCESO PagasProrr;
     import = 0;
     |SI #0#11 = "M";
          concep = #nomcalli#4;
          import = (#nomcalli#9 * #nomcalli#10) ! 2;
     |FINSI;
     |SI #0#11 = "H";
          concep = #nomhicli#4;
          import = (#nomhicli#9 * #nomhicli#10) ! 2;
     |FINSI;
     |SI #0#11 = "A";
          concep = #nomcalal#4;
          import = (#nomcalal#9 * #nomcalal#10) ! 2;
     |FINSI;
     |SI concep ] 201; |Y concep [ 208;
          |ABRE #nomconca;
          #nomconca#0 = #labtraba#87;
          #nomconca#2 = concep;
          |LEE 000#nomconca.=;
          |SI FSalida ! 0;
               |CIERRA #nomconca;
               |ACABA;
          |FINSI;

          numer = concep - 200 + 19;
          numerl = concep - 88;
          |SI #labtraba#numerl# = "S"; |O #nomconca#numer# = 99;
               inf_dto = inf_dto - import;
          |FINSI;
          |CIERRA #nomconca;
     |FINSI;
|FPRC;

|DEFBUCLE PagasProrrAtr;
     #nomcalal#1;
     ;
     #nomcalal#0, #nomcalal#1, #nomcalal#2, #nomcalal#3, 101;
     #nomcalal#0, #nomcalal#1, #nomcalal#2, #nomcalal#3, 999;
     ;
     NULL, PagasProrr;
|FIN;

|DEFBUCLE PagasProrrHis;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 101;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 999;
     ;
     NULL, PagasProrr;
|FIN;

|DEFBUCLE PagasProrrMen;
     #nomcalli#1;
     ;
     #nomcalca#0, #nomcalca#1, #nomcalca#2, #nomcalca#3, 201;
     #nomcalca#0, #nomcalca#1, #nomcalca#2, #nomcalca#3, 208;
     ;
     NULL, PagasProrr;
|FIN;

/****************************************************************************/

/****************************************************************************/
    LECTURA E IMPRESION
/****************************************************************************/

|VARIABLES;
    hay_algo = 0;
    desde_mes = 0;
    hasta_mes = 0;
    x_tipo = 0;
    x_centro = 0;
    y_centro = 0;
|FIN;

|PROCESO FormacionContinua2;
     nBonForCon = nBonForCon + #nombofli#3;
     |GRABA 020#8a;
     |LIBERA #8;
|FPRC;

|DEFBUCLE FormacionContinua2;
     #nombofli#1;
     ;
     #8#0, nume1, #0#2,  001, " ", "B";
     #8#0, nume2, #0#18, 999, "F", "P";
     ;
     NULL, FormacionContinua2;
|FIN;

|PROCESO FormacionContinua;
     nBonForCon = nBonForCon + #nombofli#3;
     |GRABA 020#8a;
     |LIBERA #8;
|FPRC;

|DEFBUCLE FormacionContinua;
     #nombofli#1;
     ;
     #8#0, nume1, #0#2, 001, " ", "B";
     #8#0, nume1, #0#2, 999, "F", "P";
     ;
     NULL, FormacionContinua;
|FIN;

|PROCESO grabatot;
     ||SI nTipo = 1; |ACABA; |FINSI;

     |ABRE #8;
     alfa1 = Usuario; |QBF alfa1;
     |NOME_DAT #8 alfa1;

     #8#0 = empresa;   || codigo empresa
     #8#2 = "    ";    || codigo area
     #8#3 = "    ";    || codigo seccion
     #8#1 = 1;         || codigo trabajador
     |SI #0#11 = "A"; |Y #0#17 = 2;
          #8#25 = #0#12;
          #8#15 = 0;
     |SINO;
          #8#25 = month;
          #8#15 = nTipo;
     |FINSI;
     |SI #8#23 = 2;
          #8#1 = nUnoTipo2;
     |FINSI;
     |LEE 101#8];
     |SI FSalida = 0;
          #8#26 = tinf_tc1re;
          #8#27 = tinf_tc1;
          |GRABA 020#8.a;
          |LIBERA #8;
          |SI nTipo = 0;
               |SI #0#11 = "M";
                    nume1 = #0#4 + 2000;
                    |HAZ FormacionContinua;
               |FINSI;
               |SI #0#11 = "H";
                    nume1 = #0#4 + 2000;
                    nume2 = #0#19 + 2000;
                    |BUCLE FormacionContinua2;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #8#15 = 2; |Y enCuadre ! 02;
          nUnoTipo2 = 0;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO RecargoRLC;
     |ABRE #cretam37;
     #cretam37#0 = #cretam02#0;
     #cretam37#1 = #cretam02#1;
     #cretam37#2 = #cretam02#2;
     #cretam37#3 = #cretam02#3;
     #cretam37#4 = #cretam02#4;
     #cretam37#5 = 000;
     |LEE 000#cretam37.=;
     |SI FSalida = 0;
          aAlfa = #cretam37#6;
          |QBF aAlfa;
          aAlfa = aAlfa % 107;
          |SI aAlfa = "RECARGO"; |Y #cretam37#8 ! 0;
               swMora = 1;
          |FINSI;
     |FINSI;
     |CIERRA #cretam37;
|FPRC;

|PROCESO RecargoDCL;
     |ABRE #cretam35;
     #cretam35#0 = #cretam02#0;
     #cretam35#1 = #cretam02#1;
     #cretam35#2 = #cretam02#2;
     #cretam35#3 = #cretam02#3;
     #cretam35#4 = #cretam02#4;
     #cretam35#5 = 000;
     |LEE 000#cretam35.=;
     |SI FSalida = 0;
          aAlfa = #cretam35#6;
          |QBF aAlfa;
          aAlfa = aAlfa % 107;
          |SI aAlfa = "RECARGO"; |Y #cretam35#8 ! 0;
               swMora = 1;
          |FINSI;
     |FINSI;
     |CIERRA #cretam35;
|FPRC;

|PROCESO leyendo_creta;
     swMora = 0;

     nMesAux = #cretam02#2;
     nAnyAux = #cretam02#1;
     |SI nAnyAux [ #cretam00#10;
          |SI nAnyAux < #cretam00#10;
               |ACABA;
          |SINO;
               |SI nMesAux < #cretam00#9;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     swCretaLeido = 1;

     hay_algo = 1;
     tinf_tc1re = tinf_tc1re + #cretam02#16;
     swHayCreta = 1;
     |SI #cretam02#22 = "B";
          aFuenteTotal = "(Borrador)";
          |HAZ RecargoDCL;
     |FINSI;
     |SI #cretam02#22 = "C";
          aFuenteTotal = "(Consolidado)";
          |HAZ RecargoRLC;
     |FINSI;
|FPRC;

|DEFBUCLE lee_creta;
     #cretam02#1;
     ;
     empresa, nAnyCretaDesde, nMesCretaDesde, nDesdeTipo, "               ";
     empresa, nAnyCretaHasta, nMesCretaHasta, nHastaTipo, "zzzzzzzzzzzzzzz";
     ;
     NULL, leyendo_creta;
|FIN;

|PROCESO BuscaLiqCreta;
     nMesAux = #cretam02#2;
     nAnyAux = #cretam02#1;
     |SI nAnyAux [ #cretam00#10;
          |SI nAnyAux < #cretam00#10;
               |ACABA;
          |SINO;
               |SI nMesAux < #cretam00#9;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     swLiqCreta = 1;
|FPRC;

|DEFBUCLE BuscaLiqCreta;
     #cretam02#1;
     ;
     #11#0, nAnyCretaDesde, nMesCretaDesde, nTipo, "               ";
     #11#0, nAnyCretaHasta, nMesCretaHasta, nTipo, "zzzzzzzzzzzzzzz";
     ;
     NULL, BuscaLiqCreta;
|FIN;

|PROCESO leyendo_tc1M;
     |SI x_tipo = 5; |Y #10#2 ! 5;  |ACABA;  |FINSI;
     |SI x_tipo = 0; |Y #10#2 = 5;  |ACABA;  |FINSI;
     hay_algo = 1;
     tinf_tc1re = tinf_tc1re + #10#20;
     nImporteTC1 = #10#20;
|FPRC;

|DEFBUCLE lee_tc1M;
 #10#1;
 ;
 empresa, x_centro, desde_mes, nTipo;
 empresa, y_centro, hasta_mes, nTipo;
 ;
 NULL, leyendo_tc1M;
|FIN;

|PROCESO Aux_tc1M;
     nImporteTC1 = 0;

     |BUCLE lee_tc1M;

     |SI #cretam00#8 = "R"; |Y #labempre#67 = "S";
          nAnyCretaDesde = #0#16;
          nAnyCretaHasta = #0#16;
          nMesCretaDesde = #0#15;
          nMesCretaHasta = #0#15;
          swHayCreta = 0;
          |SI nTipoD ! nTipoH; |Y #0#7 = 2;
               nDesdeTipo = nTipoD;
               nHastaTipo = nTipoH;
          |SINO;
               nDesdeTipo = nTipo;
               nHastaTipo = nTipo;
          |FINSI;
          |BUCLE lee_creta;
          |SI swHayCreta = 1;
               tinf_tc1re = tinf_tc1re - nImporteTC1;  || por si hubiera importe en
                                                       || el auxiliar
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tc1M;
     swMora = 0;
     tinf_tc1 = 0;
     tinf_tc1re = 0;
     nBonForCon = 0;
     hay_algo = 0;
     resumen = #0#6;
     x_tipo = 0;
     desde_mes = #0#2;
     hasta_mes = #0#2;

     tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;    || aproximado
     aAunno = "";
||SINO;
     x_centro = 99;
     y_centro = 99;
     nTipo = #0#5;

     |SI #0#17 = 02;     || en Excel
          empresa = #0#0;          || solo una empresa por emision
     |FINSI;
     |HAZ Aux_tc1M;
     |SI hay_algo = 0;
          x_centro =  1;
          y_centro = 98;
          nTipo = #0#5;
          |HAZ Aux_tc1M;
          |SI hay_algo = 0;
               ||tinf_tc1=(tinf_sss+tinf_dse)-tinf_enf;
               tinf_tc1re = tinf_tc1;
               aAunno = "- TC1 no calculado";
          |SINO;
               aAunno = "";
          |FINSI;
     |SINO;
          aAunno = "";  || TC1 calculado, importe real el del labempax
     |FINSI;

     |SALVA_FICHA #8;
     |HAZ grabatot;
     |REPON_FICHA #8;
|FPRC;

|PROCESO imprimir;
     |SI swHayDatos = 0;
          swHayDatos = 1;
          |ERROR10;
     |FINSI;

     |ABRE #3;
     #3#0 = #8#0;
     |LEE 020#3=;
     |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
     |CIERRA #3;
     #2#0 = #8#0;
     #2#1 = #8#1;
     |LEE 001#2=;
     |SI FSalida = 0;
          |SI sw = 0;
               seleccio = 1;
               empresa = #2#0;
               grupo = #8#2;
               subgr = #8#3;
               sw = 1;
          |FINSI;
          |SI empresa ! #2#0;                            || ruptura por empresa
               ||HAZ tc1M;
               swlin = 2;
               |HAZ puesubgrs;  |PRINT;
               |HAZ puegrupos;  |PRINT;
               swlin = 9;
               |PIEINF;
               |HAZ totales;
               |HAZ limptotal;
               |HAZ limparcial;
               |HAZ limpgrupos;
               |HAZ limpsubgrs;
               empresa = #2#0;
               grupo = #8#2;
               subgr = #8#3;
               swlin = 0;
          |SINO;
               |SI grupo ! #8#2;          || ruptura por grupos
                    swlin = 2;
                    |HAZ puesubgrs;  |PRINT;  |HAZ limpsubgrs;
                    |HAZ puegrupos;  |PRINT;  |HAZ limpgrupos;
                    grupo = #8#2;
                    subgr = #8#3;
                    swlin = 9;
                    FSalida = "PAGINA";
                    |PRINT;
                    swlin = 0;
               |SINO;
                    |SI subgr ! #8#3;          || ruptura por subgrupos
                         swlin = 2;
                         |HAZ puesubgrs;  |PRINT;  |HAZ limpsubgrs;
                         subgr = #8#3;
                         swlin = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ detalle_tmp;
          |PRINT;
          |HAZ grupos;
          |HAZ subgr;
          |HAZ totales;
     |FINSI;
|FPRC;

|DEFBUCLE lee_temporal;
     #8#1;
     ;
     nEmpresa, "    ", "    ",     1, 1999, 01, 0;
     nEmpresa, "zzzz", "zzzz", 99999, 2999, 12, 9;
     e;
     NULL, imprimir;
|FIN;


****************************************************************************
               GRABACION DEL TEMPORAL
****************************************************************************

|PROCESO limpieza;
|DDEFECTO #7;
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    campo7 = 0;
    campo8 = 0;
    campo9 = 0;
    campoa = 0;
    campob = 0;
    campoc = 0;
    campod = 0;
    campoe = 0;
    ultimo = 0;
|FPRC;

|PROCESO ultimo;
    ultimo = #7#2;
|FPRC;

|PROCESO grabaHistorico;
     |SI #0#7 = 2;
          nTipo = 0;
     |FINSI;

     |DDEFECTO #8;
     #8#00 = #9#0;       || empresa
     #8#02 = area;       || area
     #8#03 = secc;       || seccion
     #8#01 = #9#1;       || trabajador

     |SI #0#11 ! "A";
          #8#25 = #0#2;       || mes
     |SINO;
          #8#25 = #0#12;
     |FINSI;

     |SI nPara ] 5;
          #8#15 = nPara;      || tipo
     |SINO;
          #8#15 = nTipo;      || tipo
     |FINSI;

     #8#28 = nAnyTmp;
     |LEE 101#8=;
     FEstado = FSalida;

     #8#04 = coef;        || coeficiente

     |SI #7#2 ! ultimo;
          #8#05 = #8#05 + (inf_enf * #8#4);      || campo  1
          #8#06 = #8#06 + (inf_sub * #8#4);      || campo  2
          #8#07 = #8#07 + (inf_bru * #8#4);      || campo  3
          #8#08 = #8#08 + (inf_dto * #8#4);      || campo  4
          |SI #0#2 = #0#18;
               #8#09 = inf_tan;           || campo  5
          |FINSI;
          #8#10 = #8#10 + (inf_ded * #8#4);      || campo  6
          #8#11 = #8#11 + (inf_dse * #8#4);      || campo  7
          #8#12 = #8#12 + (inf_liq * #8#4);      || campo  8
          #8#13 = #8#13 + (inf_sss * #8#4);      || campo  9
          #8#14 = #8#14 + (inf_exe * #8#4);      || campo 10
          #8#16 = #8#16 + (inf_bon * #8#4);      || campo 11
          #8#17 = #8#17 + (inf_ant1 * #8#4);     || campo  12
          #8#18 = #8#18 + (inf_ant2 * #8#4);     || campo  13
          #8#19 = #8#19 + (inf_ant3 * #8#4);     || campo  14

          campo1 = campo1 + (inf_enf * #8#4);
          campo2 = campo2 + (inf_sub * #8#4);
          campo3 = campo3 + (inf_bru * #8#4);
          campo4 = campo4 + (inf_dto * #8#4);
          || campo5 = campo5 + #8#09;
          campo6 = campo6 + (inf_ded * #8#4);
          campo7 = campo7 + (inf_dse * #8#4);
          campo8 = campo8 + (inf_liq * #8#4);
          campo9 = campo9 + (inf_sss * #8#4);
          campoa = campoa + (inf_exe * #8#4);
          campob = campob + (inf_bon * #8#4);
          campoc = campoc + (inf_ant1 * #8#4);
          campod = campod + (inf_ant2 * #8#4);
          campoe = campoe + (inf_ant3 * #8#4);
     |SINO;
          #8#05 = #8#05 + inf_enf - campo1;   || campo  1
          #8#06 = #8#06 + inf_sub - campo2;   || campo  2
          #8#07 = #8#07 + inf_bru - campo3;   || campo  3
          #8#08 = #8#08 + inf_dto - campo4;   || campo  4
          #8#09 = inf_tan;          || campo  5
          #8#10 = #8#10 + inf_ded - campo6;   || campo  6
          #8#11 = #8#11 + inf_dse - campo7;   || campo  7
          #8#12 = #8#12 + inf_liq - campo8;   || campo  8
          #8#13 = #8#13 + inf_sss - campo9;   || campo  9
          #8#14 = #8#14 + inf_exe - campoa;   || campo 10
          #8#16 = #8#16 + inf_bon - campob;   || campo 11
          #8#17 = #8#17 + inf_ant1 - campoc;   || campo 12
          #8#18 = #8#18 + inf_ant2 - campod;   || campo 13
          #8#19 = #8#19 + inf_ant3 - campoe;   || campo 14
     |FINSI;
     #8#20 = #labempre#2;
     #8#21 = #labtraba#2;
     #8#24 = #labtraba#7;

     #4#0 = area;
     |LEE 000#4=;

     #5#0 = area;
     #5#1 = secc;
     |LEE 000#5=;

     #8#22 = #4#1;
     #8#23 = #5#2;
     #8#28 = nAnyTmp;

     |SI #8#15 = 2;                || me lo guardo para luego
          nUnoTipo2 = #8#1;        || saber donde meter los totales
     |FINSI;                       || si es finiquito

     |SI FEstado ! 0;
          |GRABA 020#8n;
     |SINO;
          |GRABA 020#8a;
     |FINSI;

     |LIBERA #8;
|FPRC;

|PROCESO graba;
     |DDEFECTO #8;
     |SI #0#11 = "M";
          #8#00 = #1#0;        || empresa
          #8#01 = #1#1;        || trabajador
          nTipo = #1#3;
     |FINSI;
     |SI #0#11 = "H";
          #8#00 = #9#0;        || empresa
          #8#01 = #9#1;        || trabajador
          nTipo = #9#3;
     |FINSI;
     |SI #0#11 = "A";
          #8#00 = #2#0;        || empresa
          #8#01 = #2#1;        || trabajador
          nTipo = #2#3;
     |FINSI;

     #8#02 = area;        || area
     #8#03 = secc;        || seccion
     #8#04 = coef;        || coeficiente
     #8#28 = nAnyTmp;
     |SI #0#11 ! "A";         || el mes
          #8#25 = #0#2;
     |SINO;
          #8#25 = #12#2;
     |FINSI;

     |SI #0#7 = 2;
          nTipo = 0;
     |FINSI;
     #8#15 = nTipo;
     |LEE 101#8=;
     FEstado = FSalida;

     |SI #7#2 ! ultimo;
          #8#05 = #8#5 + (inf_enf * #8#4);      || campo  1
          #8#06 = #8#6 + (inf_sub * #8#4);      || campo  2
          #8#07 = #8#7 + (inf_bru * #8#4);      || campo  3
          #8#08 = #8#8 + (inf_dto * #8#4);      || campo  4
          #8#09 = inf_tan;           || campo  5
          #8#10 = #8#10 + (inf_ded * #8#4);      || campo  6
          #8#11 = #8#11 + (inf_dse * #8#4);      || campo  7
          #8#12 = #8#12 + (inf_liq * #8#4);      || campo  8
          #8#13 = #8#13 + (inf_sss * #8#4);      || campo  9
          #8#14 = #8#14 + (inf_exe * #8#4);      || campo 10
          #8#16 = #8#16 + (inf_bon * #8#4);      || campo 11
          |SI #0#11 = "M"; |O #0#11 = "H";
               #8#17 = #8#17 + (inf_ant1 * #8#4);     || campo  12
               #8#18 = #8#18 + (inf_ant2 * #8#4);     || campo  13
               #8#19 = #8#19 + (inf_ant3 * #8#4);     || campo  14
          |FINSI;
          campo1 = campo1 + #8#05;
          campo2 = campo2 + #8#06;
          campo3 = campo3 + #8#07;
          campo4 = campo4 + #8#08;
          || campo5 = campo5 + #8#09;
          campo6 = campo6 + #8#10;
          campo7 = campo7 + #8#11;
          campo8 = campo8 + #8#12;
          campo9 = campo9 + #8#13;
          campoa = campoa + #8#14;
          campob = campob + #8#16;
          |SI #0#11 = "M"; |O #0#11 = "H";
               campoc = campoc + #8#17;
               campod = campod + #8#18;
               campoe = campoe + #8#19;
          |FINSI;
     |SINO;
          #8#05 = #8#5 + (inf_enf - campo1);   || campo  1
          #8#06 = #8#6 + (inf_sub - campo2);   || campo  2
          #8#07 = #8#7 + (inf_bru - campo3);   || campo  3
          #8#08 = #8#8 + (inf_dto - campo4);   || campo  4
          #8#09 = inf_tan;          || campo  5
          #8#10 = #8#10 + (inf_ded - campo6);   || campo  6
          #8#11 = #8#11 + (inf_dse - campo7);   || campo  7
          #8#12 = #8#12 + (inf_liq - campo8);   || campo  8
          #8#13 = #8#13 + (inf_sss - campo9);   || campo  9
          #8#14 = #8#14 + (inf_exe - campoa);   || campo 10
          #8#16 = #8#16 + (inf_bon - campob);   || campo 11
          |SI #0#11 = "M"; |O #0#11 = "H";
               #8#17 = #8#17 + (inf_ant1 - campoc);   || campo 12
               #8#18 = #8#18 + (inf_ant2 - campod);   || campo 13
               #8#19 = #8#19 + (inf_ant3 - campoe);   || campo 14
          |FINSI;
     |FINSI;
     #8#20 = #labempre#2;
     #8#21 = #labtraba#2;
     #8#24 = #labtraba#7;

     #4#0 = area;
     |LEE 000#4=;

     #5#0 = area;
     #5#1 = secc;
     |LEE 000#5=;

     #8#22 = #4#1;
     #8#23 = #5#2;
     |SI #0#11 ! "A";         || el mes
          #8#25 = #0#2;
     |SINO;
          #8#25 = #12#2;
     |FINSI;

     #8#15 = nTipo;

     |SI #8#15 = 2;                || me lo guardo para luego
          nUnoTipo2 = #8#1;        || saber donde meter los totales
     |FINSI;                       || si es finiquito
     #8#28 = nAnyTmp;

     |SI FEstado ! 0;
          |GRABA 020#8n;
     |SINO;
          |GRABA 020#8a;
     |FINSI;
     || |GRABA 020#8n;
     |LIBERA #8;
|FPRC;

|PROCESO prorrataM;
    area = #7#3;
    secc = #7#4;
    coef = #7#7;
|HAZ graba;
|FPRC;

|PROCESO prorrataH;
    area = #7#3;
    secc = #7#4;
    coef = #7#7;
|HAZ grabaHistorico;
|FPRC;


|PROCESO leetrabaM;
    swbaja = 0;
    fecalf = #1#5;

    alfa1 = fecalf %  102;   dia = alfa1;
    alfa1 = fecalf %  402;   mes = alfa1;
    alfa1 = fecalf % -102;   any = alfa1;
|SI alfa1 = "....";
        dia = 0;
        mes = 0;
        any = 0;
|FINSI;

|SI mes = #0#2; |Y any = #0#4;     swbaja = 1;    |FINSI;
|FPRC;

|PROCESO leetrabaH;
     swbaja = 0;
     fecalf = #9#5;

     alfa1 = fecalf %  102;   dia = alfa1;
     alfa1 = fecalf %  402;   mes = alfa1;
     alfa1 = fecalf % -102;   any = alfa1;
     |SI alfa1 = "....";
          dia = 0;
          mes = 0;
          any = 0;
     |FINSI;

     |SI mes = #0#2; |Y any = #0#4;     swbaja = 1;    |FINSI;
|FPRC;

|PROCESO temporalM;
     |ABRE #3;
     |DDEFECTO #3;
     #3#0 = #2#0;
     |LEE 020#3=;
     |CIERRA #3;

     |SI #3#36 ! "N";   || si el switch de emision no es "N"
          |SI #0#7 = 1;
               nDesdeTipoMen = #0#5;
               nHastaTipoMen = #0#5;
          |FINSI;
          |SI #0#7 = 2;
               nDesdeTipoMen = #0#5;
               nHastaTipoMen = #0#15;
          |FINSI;

          |PARA nTipoMen = nDesdeTipoMen;
          |SI nTipoMen [ nHastaTipoMen;
          |HACIENDO nTipoMen = nTipoMen + 2;
               #1#0 = #2#0;   || Empresa
               #1#1 = #2#1;   || Trabajador
               #1#2 = #0#2;   || Mes
               #1#3 = nTipoMen;   || Tipo
               |LEE 000#1=;
               |SI FSalida = 0;
                    nTipo = #0#5;
                    |HAZ leetrabaM;
                    |SI #0#10 ! "T";
                         |SI #0#10 = "A";|Y swbaja = 1;   |ACABA;   |FINSI;
                         |SI #0#10 = "B";|Y swbaja = 0;   |ACABA;   |FINSI;
                    |FINSI;
                    |HAZ limpieza;
                    |HAZ detalleM;
                    |ABRE #6;
                    swSigue = 0;
                    #6#0 = #1#0;
                    #6#1 = #1#1;
                    #6#3 = #0#4 + 2000;
                    #6#4 = #0#2;
                    |LEE 001#6=;
                    |SI FSalida = 0;
                         swSigue = 1
                    |SINO;
                         #6#0 = #1#0;
                         #6#1 = #1#1;
                         #6#3 = 0000;
                         #6#4 = 00;
                         |LEE 001#6=;
                         |SI FSalida = 0;
                              swSigue = 1
                         |FINSI;
                    |FINSI;
                    |SI swSigue = 1;
                         |BUCLELIN 2ultimo#6;
                         |BUCLELIN 2prorrataM#6;
                    |SINO;
                         area = #2#62;
                         secc = #2#63;
                         coef = 1;
                         |HAZ graba;
                    |FINSI;
                    |CIERRA #6;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|DEFBUCLE gra_temporalM;
 #2#1;
 77;
 #0#0,     1, #0#8;
 #0#1, 99999, #0#9;
 ;
 NULL, temporalM;
|FIN;

|PROCESO lee_historico;
     |DDEFECTO #3;
     #3#0 = #9#0;
     |LEE 020#3=;
     |SI #3#36 = "N";   || si el switch de emision no es "N"
          |ACABA;
     |FINSI;

     |SI #0#4 = #9#66;
          |SI #9#2 < #0#2;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #0#19 = #9#66;
          |SI #9#2 > #0#18;
               |ACABA;
          |FINSI;
     |FINSI;

     |HAZ leetrabaH;

     |SI #0#10 ! "T";
          |SI #0#10 = "A";|Y swbaja = 1;   |ACABA;   |FINSI;
          |SI #0#10 = "B";|Y swbaja = 0;   |ACABA;   |FINSI;
     |FINSI;

     #2#0 = #9#0;
     #2#1 = #9#1;
     |LEE 000#2=;
     |SI #2#77 < #0#8; |O #2#77 > #0#9;
          |ACABA;
     |FINSI;

     |HAZ limpieza;
     |HAZ detalleH;

     |ABRE #6;
     swSigue = 0;
     #6#0 = #9#0;
     #6#1 = #9#1;
     #6#3 = #0#4 + 2000;
     #6#4 = #0#2;
     |LEE 001#6=;
     |SI FSalida = 0;
          swSigue = 1;
     |SINO;
          #6#0 = #9#0;
          #6#1 = #9#1;
          #6#3 = 0000;
          #6#4 = 00;
          |LEE 001#6=;
          |SI FSalida = 0;
               swSigue = 1;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          |BUCLELIN 2ultimo#6;
          |BUCLELIN 2prorrataH#6;
     |SINO;
          area = #2#62;
          secc = #2#63;
          coef = 1;
          |HAZ grabaHistorico;
     |FINSI;
     |CIERRA #6;
|FPRC;
/*
|DEFBUCLE lee_historico;
     #9#1;
     ;
     #2#0, #2#1, #0#4, 01, #0#5;
     #2#0, #2#1, #0#19, 12, #0#5;
     ;
     NULL, lee_historico;
|FIN;

|DEFBUCLE lee_historico_junto;
     #9#1;
     ;
     #2#0, #2#1, #0#4, 01, #0#5;
     #2#0, #2#1, #0#19, 12, #0#15;
     ;
     NULL, lee_historico;
|FIN;
*/

|DEFBUCLE lee_historico;
     #9#1;
     ;
     #0#0, 00001, #0#4, 01, #0#5;
     #0#1, 99999, #0#19, 12, #0#5;
     ;
     NULL, lee_historico;
|FIN;

|DEFBUCLE lee_historico_junto;
     #9#1;
     ;
     #0#0, 00001, #0#4, 01, #0#5;
     #0#1, 99999, #0#19, 12, #0#15;
     ;
     NULL, lee_historico;
|FIN;

|PROCESO temporalH;
     |ABRE #3;           || empresa

     |SI #0#7 = "1";
          |BUCLE lee_historico;
     |SINO;
          |BUCLE lee_historico_junto;
     |FINSI;

     |CIERRA #3;
|FPRC;

|DEFBUCLE gra_temporalH;
 #2#1;
 77;
 #0#0,     1, #0#8;
 #0#1, 99999, #0#9;
 ;
 NULL, temporalH;
|FIN;

|PROCESO TotalesInf;
     |SI #0#11 = "M";
          |HAZ tc1M;
     |FINSI;
     |SI #0#11 = "H";
          |HAZ tc1H;
     |FINSI;
     |SI #0#11 = "A";
          |HAZ tc1A;
     |FINSI;
|FPRC;

|PROCESO ResumenEmpresa;
     nEmpresa = #201#0;
     swHayDatos = 0;

     |BUCLE lee_temporal;
     |SI swHayDatos = 1;
          |SI nOpcion = 2;
               eaInforme = informe;
               enDesdeMes = #0#2;
               enAny = #0#4 + 2000;
               |HAZ IMPREArchi;
          |FINSI;
          |SI nOpcion = 1;
               |HAZ ElINFOR;
          |FINSI;

          |HAZ limptotal;
          |HAZ limparcial;
          |HAZ limpgrupos;
          |HAZ limpsubgrs;

          sw = 0;
          swlin = 0;
          empresa = nEmpresa;
          |HAZ TotalesInf;
          |ABRE #2;
          |BUCLE lee_temporal;
          |CIERRA #2;

          |SI nOpcion = 2;
               |SI nTipo = 0;
                    enSwFiniq = 0;
               |FINSI;
               |SI nTipo = 2;
                    enSwFiniq = 1;
               |FINSI;
               |PIEINF;
               |FININF;
               |HAZ Mensaje;           || mensaje de envio al dsarchi
               |HAZ Archivando;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ResumenEmpresa;
     #201#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ResumenEmpresa;
|FIN;

|PROCESO carga_tmp;
     #201#0 = #8#0;
     |LEE 000#201=;
     |SI FSalida ! 0;
          |GRABA 020#201.n;
          |LIBERA #201;
     |FINSI;
|FPRC;

|DEFBUCLE carga_tmp;
     #8#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, carga_tmp;
|FIN;

|PROCESO Impresion;
     |SI enCuadre = 02;
          empresa = #8#0;
          |HAZ TotalesInf;
          |HAZ EnExcel;
          || impresion a EXCEL
     |SINO;

          || temporal para guardar las empresa de las que hay datos para resumenes

          alfa1 = Usuario;  |QBF alfa1;  alfa1 = "t" + alfa1;
          |NOME_DAT #201 alfa1;
          |DELINDEX #201;
          |ABRE #201;

          |BUCLE carga_tmp;

          |BUCLE ResumenEmpresa;

          |SI nOpcion = 2;
               aAlfa = ":dsarchi/dpntz001;CLI";
               |SUB_EJECUTA aAlfa;
          |FINSI;

          |SI nOpcion = 1;
               swlin = 2;
               |HAZ puesubgrs;  |PRINT;
               |HAZ puegrupos;  |PRINT;
               |PIEINF;
               |FININF;
          |FINSI;

          |CIERRA #201;
          |DELINDEX #201;
     |FINSI;
     |DELINDEX #8;
|FPRC;

|PROCESO ElINFOR;
     |SI enCuadre = 02;  || a EXCEL
          |ACABA;
     |SINO;
          |INFOR informe;
     |FINSI;
|FPRC;

|PROCESO ElIMPRE;
     |SI enCuadre = 02;  || a EXCEL
          FSalida = 0;
          |ACABA;
     |FINSI;
     |SI #0#5 = nTipoD; |O nTipoD = nTipoH;
          || aqui preguntamos si DsArchi si o no
          eaVengoDe = "nomirenm";

          nArchi = 0;
          |HAZ MiraSiArchiva;

          |SI #0#11 = "A";    || atrasos de momento no a DSArchi
               nArchi = 0;
          |FINSI;

          |SI nArchi ! 1;
               || no tengo dsarchi, sigo como siempre
               nOpcion = 1;
          |SINO;
               || tengo dsarchi, presento menu
               |MENU aMenu;
               nOpcion = FSalida;
               |SI FSalida = 0;
                    |ACABA;
               |FINSI;
          |FINSI;

          swSigue = 1;
          |SI nOpcion ! 1;
               |HAZ ValidaArchi;
          |FINSI;
          |SI nOpcion ! 1; |Y swSigue = 0;
               |ACABA;
          |FINSI;

          |SI nOpcion = 1;
               |IMPRE 0;
          |FINSI;
          |SI nOpcion = 2;
               Impresora = "CrystalReport";
               FSalida = 0;
          |FINSI;

          |SI FSalida = 0;
               |SI Impresora = "CrystalReport";
                    informe = "nomirenm";
               |SINO;
                    informe = "nomweb02";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Mensual;
          fecha = #0#3;
          |SI cabeza_tit = "";
               cabeza_tit = "RESUMEN ";
          |FINSI;
          cabeza = cabeza_tit + p_mes;
          |QBF cabeza;
          nume1 = #0#4 + 2000;
          alfa1 = nume1;
          cabeza = cabeza + " " + alfa1;
          |SI swPagasSN = 2;
               cabeza = cabeza + " (inc. pagas)";
          |FINSI;
          |HAZ centra;

          alfa1 = Usuario; |QBF alfa1;
          |NOME_DAT #8 alfa1;
          |DELINDEX #8;

          |ABRE #1;
          seleccio = 0;

          |ABRE #4;
          |ABRE #5;
          |ABRE #8;

          |BUCLE gra_temporalM;

          |CIERRA #8;
          |CIERRA #5;
          |CIERRA #4;

          |HAZ Impresion;     || lee temporal e imprime o bien manda a EXCEL

          |CIERRA #1;
|FPRC;

******************************************************************************
    CARGA DE VARIABLES
******************************************************************************

|PROCESO PagasM;
     |SI swPagasSN = 2;
          inf_bru = inf_bru + #1#47;         || Importe bruto Pagas
          |SI inf_tan ! #1#87;               || % irpf solo lo pinto si es igual
               inf_tan = 0;                  || que el de la nomina
          |FINSI;
          inf_ded = inf_ded + #1#17;         || retencion pagas
          inf_dto = inf_dto + #1#86;         || anticipo pagas extras
          inf_sub = inf_sub + #1#47;
          |SI #1#104 ! 0;                    || embargos
               |SI #1#47 ! 0;
                    inf_dto = inf_dto + (#1#104 - ((#1#104 * (#1#46 / (#1#46 + #1#47))) ! 2));
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO detalleM;
     ||HAZ ERE;
    inf_enf = #1#57 + #1#58;                      || prestaciones
    inf_sub = #1#46 - inf_enf + #1#45 + nCuotaERE;|| coste trabajad.
    inf_bru = #1#46;                              || Importe bruto
    inf_dto = #1#38;                              || Importe prorrata
     |SI #nomcont3#2 = "S";
          |BUCLE PagasProrrMen;
     |FINSI;
    inf_tan = #1#13; inf_tan = inf_tan ! 2;       || Porcentaje
    inf_ded = #1campo_irpf;                       || Deduccion
    |HAZ PagasM;
    inf_dse = #1#48 + #1#49 + #1#50 + #1#51 + #1#165;      || Deduccion S.S
    inf_ant1 = #1#52;                             || anticipo 1
    inf_ant2 = #1#53 + #1#54 + #1#89;             || resto anticipos
    inf_ant3 = 0;
     |SI #1#104 ! 0;                    || embargos
          |SI #1#47 ! 0;
               inf_ant3 = inf_ant3 + ((#1#104 * (#1#46 / (#1#46 + #1#47))) ! 2);
          |SINO;
               inf_ant3 = inf_ant3 + #1#104;
          |FINSI;
     |FINSI;

    inf_ant = inf_ant1 + inf_ant2 + inf_ant3;
    inf_liq = inf_bru -inf_ded -inf_dse -inf_ant; || Liquido
    inf_sss = #1#45 + nCuotaERE;                  || S.S CGO
    inf_bon = #1#63 + #1#81 + #1#88 + #1#64 + #1#96; || bonificaciones
    inf_bon = inf_bon + #1#101 + #1#102 + #1#106 + #1#125 + #1#133;
    inf_bon = inf_bon + #1#143 + #1#144 + #1#170;
    inf_exe = #1#18;                              || Base IRPF exenta
     nAnyTmp = #0#4 + 2000;
|FPRC;

|PROCESO PagasH;
     |SI swPagasSN = 2;
          inf_bru = inf_bru + #9#47;              || Importe bruto
          |SI inf_tan ! #9#129;
               inf_tan = 0;                       || Porcentaje
          |FINSI;
          inf_dto = inf_dto + #9#128;                             || Anticipos P.E.
          || embargos
          |SI #9#146 ! 0;
               |SI #9#47 ! 0;
                    inf_dto = inf_dto + (#9#146 - ((#9#146 * (#9#46 / (#9#46 + #9#47))) ! 2));
               |FINSI;
          |FINSI;
          inf_sub = inf_sub + #9#47;              || Importe bruto paga
          inf_ded = inf_ded + #9#17;                              || Deduccion
     |FINSI;
|FPRC;

|PROCESO detalleH;
     ||HAZ ERE;
    inf_enf = #9#57 + #9#58;                      || prestaciones
    inf_sub = #9#46 - inf_enf + #9#45 + nCuotaERE;|| coste trabajad.
    inf_bru = #9#46;                              || Importe bruto
    inf_dto = #9#38;                              || Importe prorrata
    |SI #nomcont3#2 = "S";
          |BUCLE PagasProrrHis;
    |FINSI;
    inf_tan = #9#13; inf_tan = inf_tan ! 2;       || Porcentaje
    inf_ded = #9campo_irpf;                       || Deduccion
    |HAZ PagasH;
    inf_dse = #9#48 + #9#49 + #9#50 + #9#51 + #9#207;      || Deduccion S.S
    inf_ant1 = #9#52;                             || anticipo 1
    inf_ant2 = #9#53 + #9#54 + #9#131;            || resto anticipos
    inf_ant3 = 0;
     |SI #9#146 ! 0;
          |SI #9#47 ! 0;
               inf_ant3 = inf_ant3 + ((#9#146 * (#9#46 / (#9#46 + #9#47))) ! 2);
          |SINO;
               inf_ant3 = inf_ant3 + #9#146;
          |FINSI;
     |FINSI;
    inf_ant = inf_ant1 + inf_ant2 + inf_ant3;
    inf_liq = inf_bru -inf_ded -inf_dse - inf_ant;          || Liquido
    inf_bon = #9#63 + #9#64 + #9#123 + #9#130 + #9#138; || bonif
    inf_bon = inf_bon + #9#143 + #9#144 + #9#148 + #9#167 + #9#175 + #9#176;
    inf_bon = inf_bon + #9#185 + #9#186 + #9#212;
    inf_sss = #9#45 + nCuotaERE;                  || S.S CGO
    inf_exe = #9#18;                              || Base IRPF exenta
    nAnyTmp = #0#4 + 2000;
|FPRC;

|PROCESO detalle_tmp;
    inf_enf = #8#05;                              || prestaciones
    inf_sub = #8#06;                              || coste trabajad.
    inf_bru = #8#07;                              || Importe bruto
    inf_dto = #8#08;                              || Importe prorrata
    inf_tan = #8#09;                              || Porcentaje
    inf_ded = #8#10;                              || Deduccion
    inf_dse = #8#11;                              || Deduccion S.S
    inf_liq = #8#12;                              || Liquido
    inf_sss = #8#13;                              || S.S CGO
    inf_exe = #8#14;                              || Base IRPF exenta
    inf_bon = #8#16;                              || bonificaciones
    eacodarea = #8#2;                             || Cod Area
    eacodsecc = #8#3;                             || Cod Seccion
    inf_ant1 = #8#17;                             || anticipos 1
    inf_ant2 = #8#18;                             || anticipos 2 y 3
    inf_ant3 = #8#19;                             || embargos
|FPRC;

|PROCESO grupos;
    ginf_enf = ginf_enf + inf_enf;       || Enfermedad
    ginf_sub = ginf_sub + inf_sub;       || Subnormalidad
    ginf_bru = ginf_bru + inf_bru;       || Importe bruto
    ginf_dto = ginf_dto + inf_dto;       || Importe prorrata
    ginf_tan = ginf_tan ! 2;             || Porcentaje
    ginf_ded = ginf_ded + inf_ded;       || Deduccion
    ginf_dse = ginf_dse + inf_dse;       || Deduccion S.S
    ginf_liq = ginf_liq + inf_liq;       || Liquido
    ginf_sss = ginf_sss + inf_sss;       || S.S CGO
    ginf_bon = ginf_bon + inf_bon;       || S.S CGO
    ginf_exe = ginf_exe + inf_exe;       || Base IRPF exenta
|FPRC;

|PROCESO subgr;
    sinf_enf = sinf_enf + inf_enf;       || Enfermedad
    sinf_sub = sinf_sub + inf_sub;       || Subnormalidad
    sinf_bru = sinf_bru + inf_bru;       || Importe bruto
    sinf_dto = sinf_dto + inf_dto;       || Importe prorrata
    sinf_tan = sinf_tan ! 2;             || Porcentaje
    sinf_ded = sinf_ded + inf_ded;       || Deduccion
    sinf_dse = sinf_dse + inf_dse;       || Deduccion S.S
    sinf_liq = sinf_liq + inf_liq;       || Liquido
    sinf_sss = sinf_sss + inf_sss;       || S.S CGO
    sinf_bon = sinf_bon + inf_bon;       || S.S CGO
    sinf_exe = sinf_exe + inf_exe;       || Base IRPF exenta
|FPRC;

|PROCESO centros;
    cinf_enf = cinf_enf + inf_enf;       || Enfermedad
    cinf_sub = cinf_sub + inf_sub;       || Subnormalidad
    cinf_bru = cinf_bru + inf_bru;       || Importe bruto
    cinf_dto = cinf_dto + inf_dto;       || Importe prorrata
    cinf_tan = cinf_tan ! 2;             || Porcentaje
    cinf_ded = cinf_ded + inf_ded;       || Deduccion
    cinf_dse = cinf_dse + inf_dse;       || Deduccion S.S
    cinf_liq = cinf_liq + inf_liq;       || Liquido
    cinf_sss = cinf_sss + inf_sss;       || S.S CGO
    cinf_bon = cinf_bon + inf_bon;       || S.S CGO
    cinf_exe = cinf_exe + inf_exe;       || Base IRPF exenta
|FPRC;

|PROCESO totales;
    tinf_enf = tinf_enf + inf_enf;       || Enfermedad
    tinf_sub = tinf_sub + inf_sub;       || Subnormalidad
    tinf_bru = tinf_bru + inf_bru;       || Importe bruto
    tinf_dto = tinf_dto + inf_dto;       || Importe prorrata
    tinf_tan = tinf_tan ! 2;             || Porcentaje
    tinf_ded = tinf_ded + inf_ded;       || Deduccion
    tinf_dse = tinf_dse + inf_dse;       || Deduccion S.S
    tinf_liq = tinf_liq + inf_liq;       || Liquido
    tinf_sss = tinf_sss + inf_sss;       || S.S CGO
    tinf_bon = tinf_bon + inf_bon;       || S.S CGO
    tinf_exe = tinf_exe + inf_exe;       || Base IRPF exenta
|FPRC;

******************************************************************************
    PASE DE VARIABLES
******************************************************************************

|PROCESO puecentro;
    pinf_enf = cinf_enf;
    pinf_sub = cinf_sub;
    pinf_bru = cinf_bru;
    pinf_dto = cinf_dto;
    pinf_ded = cinf_ded;
    pinf_dse = cinf_dse;
    pinf_liq = cinf_liq;
    pinf_sss = cinf_sss;
    pinf_bon = cinf_bon;
    pinf_exe = cinf_exe;
|FPRC;

|PROCESO puegrupos;
|ABRE #4;
    #4#0 = grupo;
|LEE 001#4=;
|SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
|CIERRA #4;
    varinf1 = #4#1;
|QBF varinf1;
    varinf1 = varinf1 + "******************************";
    varinf1 = varinf1 % 133;
    pinf_enf = ginf_enf;
    pinf_sub = ginf_sub;
    pinf_bru = ginf_bru;
    pinf_dto = ginf_dto;
    pinf_ded = ginf_ded;
    pinf_dse = ginf_dse;
    pinf_liq = ginf_liq;
    pinf_sss = ginf_sss;
    pinf_bon = ginf_bon;
    pinf_exe = ginf_exe;
|FPRC;

|PROCESO puesubgrs;
|ABRE #5;
    #5#0 = grupo;
    #5#1 = subgr;
|LEE 001#5=;
|SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
|CIERRA #5;
    varinf1 = #5#2;
|QBF varinf1;
    varinf1 = varinf1 + "ùùùùùùùùùùùùùùùùùùùùùùùùùùùùùù";
    varinf1 = varinf1 % 133;
    pinf_enf = sinf_enf;
    pinf_sub = sinf_sub;
    pinf_bru = sinf_bru;
    pinf_dto = sinf_dto;
    pinf_ded = sinf_ded;
    pinf_dse = sinf_dse;
    pinf_liq = sinf_liq;
    pinf_sss = sinf_sss;
    pinf_bon = sinf_bon;
    pinf_exe = sinf_exe;
|FPRC;

******************************************************************************
    LIMPIEZA DE VARIABLES
******************************************************************************

|PROCESO limpgrupos;
    ginf_enf = 0;
    ginf_sub = 0;
    ginf_bru = 0;
    ginf_dto = 0;
    ginf_ded = 0;
    ginf_dse = 0;
    ginf_liq = 0;
    ginf_sss = 0;
    ginf_bon = 0;
    ginf_exe = 0;
|FPRC;

|PROCESO limpsubgrs;
    sinf_enf = 0;
    sinf_sub = 0;
    sinf_bru = 0;
    sinf_dto = 0;
    sinf_ded = 0;
    sinf_dse = 0;
    sinf_liq = 0;
    sinf_sss = 0;
    sinf_bon = 0;
    sinf_exe = 0;
|FPRC;

|PROCESO limparcial;
    cinf_enf = 0;
    cinf_sub = 0;
    cinf_bru = 0;
    cinf_dto = 0;
    cinf_ded = 0;
    cinf_dse = 0;
    cinf_liq = 0;
    cinf_sss = 0;
    cinf_bon = 0;
    cinf_exe = 0;
|FPRC;

|PROCESO limptotal;
    tinf_enf = 0;
    tinf_sub = 0;
    tinf_bru = 0;
    tinf_dto = 0;
    tinf_ded = 0;
    tinf_dse = 0;
    tinf_liq = 0;
    tinf_sss = 0;
    tinf_bon = 0;
    tinf_exe = 0;
    tinf_tc1 = 0;
    tinf_tc1re = 0;
    nBonForCon = 0;
|FPRC;

******************************************************************************
   RUTINAS
******************************************************************************

|PROCESO centra;         || CENTRA TITULO DEL INFORME
    alfa1 = cabeza % 0;
    nume1 = alfa1;
    nume2 = ((79 - nume1) / 2) - 0.5;
    nume2 = nume2 ! 0;
    alfa1 = " " * nume2;
    cabeza = alfa1 + cabeza;
|FPRC;

|PROCESO leyendo_tc1H;
     swLiqCreta = 0;
     nAnyCretaDesde = #11#16 + 2000;
     nAnyCretaHasta = #11#16 + 2000;
     nMesCretaDesde = #11#1;
     nMesCretaHasta = #11#1;
     nTipo = #11#2;
     |SI nTipo = 8; |O nTipo = 9;
          nTipo = 0;
     |FINSI;

     |BUCLE BuscaLiqCreta;

     |SI swLiqCreta = 1;
          |ACABA;
     |FINSI;

     |SI #0#5 = 0;|O #0#5 = 2;
          |SI #11#2 =  0;|O #11#2 =  8;|O #11#2 =  9;
          |O #11#2 = 10;|O #11#2 = 18;|O #11#2 = 19;
          |O #11#2 = 2;
               hay_algo = 1;
               hay_algo_tc1H = 1;
               tinf_tc1re = tinf_tc1re + #11#20;
               nImporteTC1 = #11#20;
          |FINSI;
     |FINSI;
     |SI #0#5 = 5;
          |SI #11#2 =  5;|O #11#2 =  6;|O #11#2 =  7;
          |O #11#2 = 15;|O #11#2 = 16;|O #11#2 = 17;
               hay_algo = 1;
               hay_algo_tc1H = 1;
               tinf_tc1re = tinf_tc1re + #11#20;
               nImporteTC1 = #11#20;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_tc1H;
 #11#1;
 ;
 empresa,   1, #0#4, #0#2, nTipo;
 empresa, 999, #0#19, #0#18, nTipo;
 ;
 NULL, leyendo_tc1H;
|FIN;

|PROCESO Aux_tc1H;
     |BUCLE lee_tc1H;

     |SI #cretam00#8 = "R"; |Y #labempre#67 = "S";
     |Y swCretaLeido = 0;
          nAnyCretaDesde = #0#4 + 2000;
          nAnyCretaHasta = #0#19 + 2000;
          nMesCretaDesde = #0#2;
          nMesCretaHasta = #0#18;
          |SI nTipo ] 05; |Y #nomhicca#213 = 1;
               nTipoAnt = nTipo;
               nTipo = 90;
          |FINSI;
          |SI nTipoD ! nTipoH; |Y #0#7 = 2;
               nDesdeTipo = nTipoD;
               nHastaTipo = nTipoH;
          |SINO;
               nDesdeTipo = nTipo;
               nHastaTipo = nTipo;
          |FINSI;
          |BUCLE lee_creta;
          |SI nTipo = 90;
               nTipo = nTipoAnt;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tc1H;
     swMora = 0;
     resumen = #0#6;
     ||SI nTipoD ! nTipoH;
          ||resumen = "N";
     ||FINSI;

     tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;    || aproximado
     aAunno = "";

     hay_algo = 0;
     hay_algo_tc1H = 0;
     nTipo = #0#5;
     swCretaLeido = 0;
     tinf_tc1re = 0;
     |HAZ Aux_tc1H;
     |SI hay_algo = 0;
          tinf_tc1=(tinf_sss+tinf_dse)-tinf_enf;
          tinf_tc1re = tinf_tc1;
          aAunno = "- TC1 no calculado";
     |SINO;
          aAunno = "";
     |FINSI;

     |SALVA_FICHA #8;
     |HAZ grabatot;
     |REPON_FICHA #8;
|FPRC;

|PROCESO Historico;
     fecha = #0#3;
     |SI cabeza_tit = "";
          cabeza_tit = "RESUMEN ";
     |FINSI;
     |SI #0#2 = #0#18;
          cabeza = cabeza_tit + p_mes;
          nNume = #0#4 + 2000;
          aAlfa = nNume;
          |QBF cabeza;
          cabeza = cabeza + " " + aAlfa;
     |SINO;
          nMes = #0#2; |HAZ mesletra;
          aAlfa = p_mes; |QBF aAlfa;
          |SI #0#4 ! #0#19;
               nNume = #0#4 + 2000;
               aAlfa1 = nNume;
               aAlfa = aAlfa + " " + aAlfa1;
          |FINSI;

          aAlfa = aAlfa + " - ";

          nMes = #0#18; |HAZ mesletra;
          aAlfa = aAlfa + p_mes; |QBF aAlfa;

          nNume = #0#19 + 2000;
          aAlfa1 = nNume;
          aAlfa = aAlfa + " " + aAlfa1;

          cabeza = cabeza_tit + aAlfa;
     |FINSI;

     |SI swPagasSN = 2;
          |SI nPara ] 2; |Y #0#7 = "1";
               || finiquitos y atrasos por separado no tiene que salir lo
               || de (inc. pagas)
          |SINO;
               cabeza = cabeza + " (inc. pagas)";
          |FINSI;
     |FINSI;

     |HAZ centra;

     alfa1 = Usuario; |QBF alfa1;
     |NOME_DAT #8 alfa1;
     |DELINDEX #8;

     |ABRE #9;
     seleccio = 0;

     |ABRE #2;
     |ABRE #4;
     |ABRE #5;
     |ABRE #8;

     |HAZ temporalH;

     |CIERRA #8;
     |CIERRA #5;
     |CIERRA #4;
     |CIERRA #2;

     |HAZ Impresion;     || lee temporal e imprime o bien manda a EXCEL

     |CIERRA #9;
|FPRC;

|PROCESO detalleA;
    si_hay = 1;
    inf_enf = inf_enf + (#12#57 + #12#58);                 || prestaciones
    inf_sub = inf_sub + (#12#46 + #12#45 - #12#57 - #12#58);  || coste trabajad.
    inf_bru = inf_bru + #12#46;                            || Importe bruto
    inf_dto = inf_dto + #12#38;                            || Importe prorrata
    |SI #nomcont3#2 = "S";
          |BUCLE PagasProrrAtr;
    |FINSI;
    inf_tan = #12#13; inf_tan = inf_tan ! 2;               || Porcentaje
    inf_ded = inf_ded + #12#75;                            || Deduccion
    inf_dse = inf_dse + (#12#48 + #12#49 + #12#50 + #12#51);  || Deduccion S.S
    inf_liq = inf_bru - inf_ded - inf_dse;                 || Liquido
    inf_sss = inf_sss + #12#45;                            || S.S CGO
    inf_bon = inf_bon + #12#63 + #12#81 + #12#88 + #12#64;    || bonif
    inf_exe = inf_exe + #12#18;                            || Base IRPF exenta
     nAnyTmp = #0#4 + 2000;
|FPRC;

|DEFBUCLE atrasos1;
 #12#1;
 ;
 #2#0, #2#1, #0#12, #0#5;
 #2#0, #2#1, #0#13, #0#5;
 e;
 NULL, detalleA;
|FIN;

|PROCESO limpiezaA;
|DDEFECTO #7;
    campo1 = 0;
    campo2 = 0;
    campo3 = 0;
    campo4 = 0;
    campo5 = 0;
    campo6 = 0;
    campo7 = 0;
    campo8 = 0;
    campo9 = 0;
    campoa = 0;
    campob = 0;
    ultimo = 0;
    inf_enf = 0;
    inf_sub = 0;
    inf_bru = 0;
    inf_dto = 0;
    inf_tan = 0;
    inf_ded = 0;
    inf_dse = 0;
    inf_liq = 0;
    inf_sss = 0;
    inf_bon = 0;
    inf_exe = 0;
|FPRC;

|PROCESO leetrabaA;
    swbaja = 0;
    fecalf = #2#37;

    alfa1 = fecalf %  102;   dia = alfa1;
    alfa1 = fecalf %  402;   mes = alfa1;
    alfa1 = fecalf % -102;   any = alfa1;
|SI alfa1 = "....";
        dia = 0;
        mes = 0;
        any = 0;
|FINSI;

|SI any = #0#4;
    |SI mes ] #0#12; |Y mes [ #0#13;      swbaja = 1;    |FINSI;
|FINSI;
|FPRC;

|PROCESO prorrataA;
    area = #7#3;
    secc = #7#4;
    coef = #7#7;
|HAZ graba;
|FPRC;

|PROCESO temporalA;
     |ABRE #3;
     |DDEFECTO #3;
     #3#0 = #2#0;
     |LEE 020#3=;
     |CIERRA #3;
     |SI #3#36 ! "N";   || si el switch de emision no es "N"
          |HAZ leetrabaA;
          |SI #0#10 ! "T";
               |SI #0#10 = "A";|Y swbaja = 1;   |ACABA;   |FINSI;
               |SI #0#10 = "B";|Y swbaja = 0;   |ACABA;   |FINSI;
          |FINSI;

          |HAZ limpiezaA;
          si_hay = 0;
          |BUCLE atrasos1;
          |SI si_hay = 1;
               |ABRE #6;
               #6#0 = #2#0;  || EN ATRASOS no busco por meses la prorrata
               #6#1 = #2#1;  || al menos hasta que no lo pidan
               #6#3 = 0000;
               #6#4 = 00;
               |LEE 001#6=;
               |SI FSalida = 0;
                    |BUCLELIN 2ultimo#6;
                    |BUCLELIN 2prorrataA#6;
               |SINO;
                    area = #2#62;
                    secc = #2#63;
                    coef = 1;
                    |HAZ graba;
               |FINSI;
               |CIERRA #6;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE gra_temporalA;
#2#1;
77;
#0#0, desde, #0#8;
#0#1, hasta, #0#9;
e;
NULL, temporalA;
|FIN;

|PROCESO leyendo_tc1A;
|SI x_tipo = 5; |Y #10#2 ! 5;  |ACABA;  |FINSI;
|SI x_tipo = 0; |Y #10#2 = 5;  |ACABA;  |FINSI;
    hay_algo = 1;
    tinf_tc1re = tinf_tc1re + #10#20;
|FPRC;

|DEFBUCLE lee_tc1A;
 #10#1;
 ;
 empresa, x_centro, desde_mes, nTipo;
 empresa, y_centro, hasta_mes, nTipo;
 ;
 NULL, leyendo_tc1A;
|FIN;

|PROCESO tc1A;
    tinf_tc1 = 0;
    tinf_tc1re = 0;
    hay_algo = 0;

        resumen = #0#6;
        x_tipo = 5;
            desde_mes = #0#12;
            hasta_mes = #0#13;
||SI resumen = "N";
        tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;    || aproximado
        aAunno = "";
||SINO;
        x_centro = 99;
        y_centro = 99;
    nTipo = #0#5;
    |BUCLE lee_tc1A;
    |SI hay_algo = 0;
            x_centro =  1;
            y_centro = 98;
        nTipo = #0#5;
        |BUCLE lee_tc1A;
        |SI hay_algo = 0;
            ||tinf_tc1=(tinf_sss+tinf_dse)-tinf_enf;
            tinf_tc1re = tinf_tc1;
        |SINO;
            aAunno = "";
        |FINSI;
    |SINO;
        tinf_tc1re = tinf_tc1;
    |FINSI;
||FINSI;
     |SALVA_FICHA #8;
     |HAZ grabatot;
     |REPON_FICHA #8;
|FPRC;

|PROCESO Atrasos;
     fecha = #0#3;
     |SI #0#12 ! #0#13;
          nMes = #0#12; |HAZ mesletra;
          aAlfa = p_mes; |QBF aAlfa;
          nMes = #0#13; |HAZ mesletra;
          aAlfa = aAlfa + " - " + p_mes; |QBF aAlfa;
     |SINO;
          nMes = #0#12; |HAZ mesletra;
          aAlfa = p_mes; |QBF aAlfa;
     |FINSI;
     cabeza = "RESUMEN NOMINAS ATRASOS - " + aAlfa;
     |HAZ centra;

     alfa1 = Usuario; |QBF alfa1;
     |NOME_DAT #8 alfa1;
     |DELINDEX #8;

     |ABRE #1;
     seleccio = 0;

     |ABRE #4;
     |ABRE #5;
     |ABRE #8;
     desde = 1;
     hasta = 99999;
     |BUCLE gra_temporalA;
     |CIERRA #8;
     |CIERRA #5;
     |CIERRA #4;
     |HAZ Impresion;     || lee temporal e imprime o bien manda a EXCEL
     |CIERRA #1;
|FPRC;

|PROCESO TodoJunto;
     |SI #0#11 = "M";
          campo_irpf = 75;
          |HAZ Mensual;
     |FINSI;
     |SI #0#11 = "H";
          campo_irpf = 114;
          |HAZ Historico;
     |FINSI;
|FPRC;

|PROCESO PorSeparado;
     |PARA nPara = nTipoD; |SI nPara [ nTipoH; |HACIENDO nPara = nPara + 1;
          #0#5 = nPara;
          |SI #0#11 = "M"; |O #0#11 = "A";
               |SI 0 [ nPara; |Y nPara [ 2;
                    campo_irpf = 75;
                    |SI nPara = 0;
                         cabeza_tit = "RESUMEN NOMINAS MENSUAL ";
                    |FINSI;
                    |SI nPara = 2;
                         cabeza_tit = "RESUMEN FINIQUITOS MENSUAL ";
                    |FINSI;
                    enTipo = nPara;
                    |SI nPara ! 1;
                         |HAZ Mensual;
                    |FINSI;
               |FINSI;

               |SI 5 [ nPara; |Y nPara [ 20;
                    |HAZ Atrasos;
               |FINSI;
          |FINSI;
          |SI #0#11 = "H";
               |SI 0 [ nPara; |Y nPara [ 20;
                    campo_irpf = 114;
                    |SI nPara = 0;
                         cabeza_tit = "RESUMEN NOMINAS HISTORICO ";
                    |FINSI;
                    |SI nPara = 2;
                         cabeza_tit = "RESUMEN FINIQUITOS HISTORICO ";
                    |FINSI;
                    |SI nPara ] 5;
                         cabeza_tit = "RESUMEN ATRASOS HISTORICO ";
                    |FINSI;
                    |SI nPara ! 1;
                         |HAZ Historico;
                    |FINSI;

                    || por algun motivo que no entiendo, atrasos desde el
                    || historico no salen si los pides desde tipo 0 al 5
                    || por ejemplo, asi lo dejare hasta que lo reclamen,
                    || "asi ha estado siempre"
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Mensaje;
     aEmp = "                                             ";
     aCen = "                                             ";
     aTra = "                                             ";

     aAlfa = #labempre#0;
     |QBF aAlfa;
     aAlfa = ("00000" + aAlfa) % -105;
     aNomEmp = #labempre#2;
     aNomEmp = aNomEmp % 126;
     aEmp = "Empresa: " + aAlfa + " - " + aNomEmp;
     aEmp = " " + aEmp + " ";

     aCen = " Archivando resumen ... ";
     aCen = aCen + "                            ";
     aCen = aCen % 145;

     aTra = "";

               ||  1 2        3         4         5          6
               ||  890123456789012345678901234567890123456789012
     |ATRI R;
     |PINTA 1318, "     - Procesando archivo de resúmenes -     ";
     |PINTA 1418, aEmp;
     |PINTA 1518, aCen;
     |PINTA 1618, aTra;
     |ATRI 0;
|FPRC;

|PROCESO ValidaArchi;
     swSigue = 1;
     |SI #0#11 = "H";
          |SI #0#2 ! #0#18; |O #0#4 ! #0#19;
               aAlfa = "    ATENCION. Para archivar el resumen ";
               aAlfa = aAlfa + "el mes/año desde tiene que ser igual que el mes/año hasta";
               |MENAV aAlfa;
               swSigue = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO imprime; |TIPO 3;
     |HAZ BuscaModulo;
     |SI swModulo = 3462;
          enEmpIni = #0#0;
          enEmpFin = #0#1;
          enTrabIni = 00000;
          enTrabFin = 99999;
          enMes = #0#2;
          nume1 = 2000 + #0#4;
          eaAnyo = nume1;
          |HAZ syke0013wplb;
     |FINSI;

     aCabProrr = "IMPORTE";
     aCabProrr2 = "PRORRATA";
     nTipoD = #0#5;
     nTipoH = #0#15;
     month = #0#2;
     eaFuente = #0#11;
     enCuadre = #0#17;
     enTipoInf = 1;
     enOrdenTra = 1;
     aNomPag = "N";
     |SI #0#5 = 2; |Y #0#15 = 2;
          enSwFiniq = 1;
     |FINSI;

     |HAZ ElIMPRE;
     |SI FSalida = 0;
          |SI nTipoD ! nTipoH;          || desde tipo - hasta tipo distintos
               swJunto = 0;
               |SI #0#7 = 2;
                    |SI #0#11 = "M"; |O #0#11 = "H";
                         swJunto = 1;
                    |FINSI;
               |FINSI;

               |SI swJunto = 1;
                    || todo junto, nuevo Noguera 06/2011
                    || solo para historico
                    |HAZ TodoJunto;
               |SINO;
                    || como siempre, por separado
                    || mensual y atrasos e historico tipo de emision "1"
                    |HAZ PorSeparado;
               |FINSI;
          |SINO;                        || desde tipo - hasta tipo iguales
                                        || una sola emision
               |SI #0#11 = "M";
                    campo_irpf = 75;
                    |SI nTipoD = 0;
                         cabeza_tit = "RESUMEN NOMINAS MENSUAL ";
                    |FINSI;
                    |SI nTipoD = 2;
                         cabeza_tit = "RESUMEN FINIQUITOS MENSUAL ";
                    |FINSI;
                    |HAZ Mensual;
               |FINSI;
               |SI #0#11 = "H";
                    sw = 0;
                    campo_irpf = 114;
                    |SI nTipoD = 0;
                         cabeza_tit = "RESUMEN NOMINAS HISTORICO ";
                    |FINSI;
                    |SI nTipoD = 2;
                         cabeza_tit = "RESUMEN FINIQUITOS HISTORICO ";
                    |FINSI;
                    |HAZ Historico;
               |FINSI;
               |SI #0#11 = "A";
                    |HAZ Atrasos;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV error0;
     |FINSI;
     |SI nOpcion = 1;
          |SI enCuadre = 00;
               |FINIMP;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     aAlfa = PARAMETRO;
     |QBF aAlfa;
     aAlfa = aAlfa % -103;
     |SI aAlfa = "N+P";
          swPagasSN = 2;      || nomina y paga todo junto
          PARAMETRO = PARAMETRO - "N+P";
     |SINO;
          swPagasSN = 1;      || lo de siempre, solo nomina
     |FINSI;

     |CLS;
     |CABEZA "INFORME RESUMEN DE NOMINAS POR AREAS Y SECCIONES";
     |PINPA #0#0;

     |SI swPagasSN = 2;
          |ATRI R;
          |PINTA 0504, " RESUMEN NOMINAS POR AREAS Y SECCIONES PRORRATEANDO IMPORTES (PAGAS INC.) "
          |ATRI 0;
     |FINSI;

     |ABRE #cretam00; |DDEFECTO #cretam00; |LEE 000#cretam00.p; |CIERRA #cretam00;
     |ABRE #nomcontr; |DDEFECTO #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     |ABRE #nomcont3; |DDEFECTO #nomcont3; |LEE 000#nomcont3.p; |CIERRA #nomcont3;

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |BORRA 020#0a;
     |FINSI;
     |CIERRA #0;
     |PINDA #0#0;
     |HAZ Activa7;
     |ENDATOS #1#0;
     #0#5 = nTipoD;
     #0#15 = nTipoH;
     |ABRE #0; |GRABA 000#0n; |CIERRA #0;
|FPRO;
