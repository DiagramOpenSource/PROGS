|FICHEROS;
     gomdetj1 #0;
     gomentr1;
     nomtrcal;
     labtraba;
|FIN;

|VARIABLES;
     aAnyo = "";
     aMes = "";
     aFecha = "";
     fFecha = @;
     aDiaLet = "";
     fDiaLet = @;
     nDiaSem = 0;
     nDiaMes = 0;
     nFilNum = 0;
     nColNum = 0;
     nColCam = 0;
     nColIni = 0;
     nPos = 0;
     nPaso = 0;
     nCampo = 0;
     nCampoDia = 0;
     nCampo2 = 0;
     a = 0;
     nModo = 0;
     numer = 0;
     bisiesto = 0;
     mesnum = 0;
     anynum = 0;
     topemes = 0;
     aAlfa1 = "";
     i = 0;
     menos = 0;
     p_mes = "";
     fecsys = @;
     alfa1 = "";

     nAlta = 0;
     nIT = 0;
     nInac = 0;
     aAlfa = "";
     aAlfa2 = "";
     nDias = 0;

     nMes = 0;
     nDia = 0;
     aCalendario = "";
     nNume1 = 0;
|FIN;

|PROCESO DiasActividad;
     nDias = 0;

     |ABRE #nomtrcal;
     aAnyo = #gomdetj1#2;
     #nomtrcal#0 = #labtraba#156;       || defecto calendario laboral
     #nomtrcal#13 = aAnyo;
     |LEE 000#nomtrcal.=;
     nMes = #gomdetj1#3;
     aCalendario = #nomtrcal#nMes#;
     |CIERRA #nomtrcal;

     anynum = #gomdetj1#2;
     |HAZ ulti_dia;
     |PARA nDia = 1; |SI nDia [ topemes; |HACIENDO nDia = nDia + 1;
          nCampoDia = nDia + 3;
          |SI #gomdetj1#nCampoDia# = "X";
               nDias = nDias + 1;
          |FINSI;
          |SI #gomdetj1#nCampoDia# = "I";
               |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
                    nCampo = nDia + 3;
                    nNume1 = (nDia * 100) + 1;
                    aAlfa1 = aCalendario % nNume1;
                    |SI aAlfa1 = 1;
                         || era un dia de fiesta
                    |SINO;
                         nDias = nDias + 1;
                    |FINSI;
               |SINO;
                    nDias = nDias + 1;
               |FINSI;
          |FINSI;
     |SIGUE;

     #gomdetj1#35 = nDias;
     |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
          |PINTA #gomdetj1#35;
     |FINSI;
|FPRC;

|PROCESO Previo; |TIPO 7;
     |HAZ DiasActividad;
|FPRC;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
    numer = anynum $ 4;
|SI numer = 0;
        bisiesto = 1;
|SINO;
        bisiesto = 0;
|FINSI;
|SI mesnum =  1;  topemes = 31;            |FINSI;
|SI mesnum =  2;  topemes = 28 + bisiesto; |FINSI;
|SI mesnum =  3;  topemes = 31;            |FINSI;
|SI mesnum =  4;  topemes = 30;            |FINSI;
|SI mesnum =  5;  topemes = 31;            |FINSI;
|SI mesnum =  6;  topemes = 30;            |FINSI;
|SI mesnum =  7;  topemes = 31;            |FINSI;
|SI mesnum =  8;  topemes = 31;            |FINSI;
|SI mesnum =  9;  topemes = 30;            |FINSI;
|SI mesnum = 10;  topemes = 31;            |FINSI;
|SI mesnum = 11;  topemes = 30;            |FINSI;
|SI mesnum = 12;  topemes = 31;            |FINSI;
|FPRC;

____________________________________/ CALCULOS DE PANTALLA
|PROCESO defecto; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
    #0Campo = #0Campo - menos;
|PINTA #0Campo;
|FPRC;

|PROCESO mirames2; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
    #0Campo = #0Campo - 1;
    menos = 0;
|SI #0Campo = 0;
        #0Campo = 12;
        menos = 1;
|FINSI;
|PINTA #0Campo;
|FPRC;

|PROCESO dias;
     aAnyo = #gomdetj1#2;
     aMes  = #gomdetj1#3;
     aMes = "00" + aMes;
     aMes = aMes % -102;
     aFecha = "01" + "." + aMes + "." + aAnyo;
     fFecha = aFecha;
     fDiaLet = fFecha % 1;
     aDiaLet = fDiaLet;
     aDiaLet = aDiaLet % 1103;
     |SI aDiaLet = "Lun"; nDiaSem = 1; |FINSI;
     |SI aDiaLet = "Mar"; nDiaSem = 2; |FINSI;
     |SI aDiaLet = "Mie"; nDiaSem = 3; |FINSI;
     |SI aDiaLet = "Jue"; nDiaSem = 4; |FINSI;
     |SI aDiaLet = "Vie"; nDiaSem = 5; |FINSI;
     |SI aDiaLet = "Sab"; nDiaSem = 6; |FINSI;
     |SI aDiaLet = "Dom"; nDiaSem = 7; |FINSI;
     mesnum = #gomdetj1#3;
     anynum = #gomdetj1#2;
     |HAZ ulti_dia;
     |HAZ calendario;
|FPRC;

|PROCESO cabecera;
|FPRC;

|PROCESO Repinta; |TIPO 13;
     nModo = (FEntrada / 100) ! 0;
     |HAZ dias;
     |SI #gomentr1#3 = "EVEN";
          |PINTA 2242, "                        ";
          |PINTA 2342, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
     |FINSI;
|FPRC;

|PROCESO Inicializa;
     |PARA i = 4; |SI i [ 34; |HACIENDO i = i + 1;
          |CAMPO_MODIFICA #0i, 1, "S";
     |SIGUE;
|FPRC;

|PROCESO calendario;
     nDiaMes = 1;
     nFilNum = 1400;
     nColIni = 32;
     nColCam = 38;
     nPaso = 5;
     nCampo = 4;
     |HAZ cabecera;
     |HAZ Inicializa;
     |BLANCO 1437 1863;
     |PARA nFilNum = nFilNum; |SI nDiaMes [ topemes; |HACIENDO nFilNum = nFilNum + 100;
     |PARA nDiaSem = nDiaSem; |SI nDiaSem [ 7;  |HACIENDO nDiaSem = nDiaSem + 1;
          nColNum = nColIni + (nDiaSem * nPaso);
          nPos = nFilNum + nColNum;
          |SI nDiaMes < 10;
               nPos = nPos + 1;
               a = 1;
          |SINO;
               a = 0;
          |FINSI;
          |PINTA nPos, nDiaMes;
          nColCam = nPos + 3 - a;
          |CAMPO_VISUAL   #0nCampo, 1, "S";
          |CAMPO_POSICION #0nCampo, 1, nColCam;
          |PINTA #0nCampo;
          |SI nDiaMes < 10;
               nPos = nPos - 1;
          |FINSI;
          nDiaMes = nDiaMes + 1;
          |SI nDiaMes > topemes; |SAL; |FINSI;
          nCampo = nCampo + 1;
     |SIGUE;
     nDiaSem = 1;
     |SIGUE;

     topemes = topemes + 4
     |PARA nCampo = topemes; |SI nCampo [ 34; |HACIENDO nCampo = nCampo + 1;
          |CAMPO_MODIFICA #0nCampo, 1, "N";
          |CAMPO_VISUAL #0nCampo, 1, "N";
     |SIGUE;

     |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
          |CAMPO_MODIFICA #0#35, 1, "S";
          |CAMPO_VISUAL #0#35, 1, "S";
          |PINTA 1957, "              ³";
          |ATRI R;
          |PINTA 1957, "D¡as SEPE:";
          |ATRI I;
          |PINTA #0#35;
     |SINO;
          |CAMPO_MODIFICA #0#35, 1, "N";
          |CAMPO_VISUAL #0#35, 1, "N";
          |PINTA 1957, "              ³";
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     nAlta = 0;
     nIT = 0;
     nInac = 0;
     |PARA nCampo = 4; |SI nCampo [ 34; |HACIENDO nCampo = nCampo + 1;
          |SI #gomdetj1#nCampo# = "X";
               nAlta = nAlta + 1;
          |FINSI;
          |SI #gomdetj1#nCampo# = "I";
               nIT = nIT + 1;
          |FINSI;
          |SI #gomdetj1#nCampo# = "D";
               nInac = nInac + 1;
          |FINSI;
     |SIGUE;
     |SI #gomentr1#4 ! nAlta;
          aAlfa1 = #gomentr1#4; |QBF aAlfa1;
          aAlfa2 = nAlta;
          aAlfa = "    Se introdujeron " + aAlfa1 + " jornadas en alta y ";
          aAlfa = aAlfa + "se han marcado " + aAlfa2 + " días con X";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
     |SI #gomentr1#13 ! nIT;
          aAlfa1 = #gomentr1#13; |QBF aAlfa1;
          aAlfa2 = nIT;
          aAlfa = "    Se introdujeron " + aAlfa1 + " jornadas en IT y ";
          aAlfa = aAlfa + "se han marcado " + aAlfa2 + " días con I";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;

     |SI nInac ! 0;
          #gomentr1#14 = "S";
     |SINO;
          #gomentr1#14 = "N";
     |FINSI;
     #gomentr1#15 = #gomdetj1#35;
|FPRC;

|PROCESO ValidaDia;
     |SI #gomentr1#3 = "EVEN"; |Y #0Campo = "D";
          #0Campo = " ";
          |PINTA #0Campo;
          |ERROR;
     |FINSI;
|FPRC;
