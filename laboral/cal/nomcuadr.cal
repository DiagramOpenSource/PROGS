|FICHEROS;
     nomcuadr #0;
|FIN;

|VARIABLES;
     FEstado = 0;
     impreso = 0;
     nombre1 = "";
     nombre2 = "";
     numero = "";
     path = "";
     alfa1 = "";
     alfa2 = "";
     l = "";
     fichero1 = "";
     fichero2 = "";
     path1 = "";
     path2 = "";
     aExtension = "";
     &swModulo = 0;

     aBase = "";
     aPlantillas = "";
     aFichero = "";
     aOrigen = "";
     aDestino = "";
     aIP = "";
     nCanal = 0;
|FIN;

|PROGRAMA;
     |CLS;
     |CABEZA "CONFIG.CUADRES";
     |ABRE #0;
     |DDEFECTO #0;
     |LEE 040#0p;
     FEstado = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ configu;
          |SI FEstado = 0;
               |BORRA 020#0c;
          |FINSI;
          |GRABA 020#0n;
     |FINSI;
     |CIERRA #0;
|FPRO;

|PROCESO lanominaabierta;
     |HAZ BuscaModulo;
     |SI swModulo = 3145; |O swModulo = 1;
          |DBASE path1;
          path1 = path1 + "plantillas/";

          l = "r"; nombre1 = "nomyabie."; nombre2 = "";
          aExtension = "rpt";
          |HAZ LaCopia;
     |FINSI;
|FPRC;

|PROCESO lanomina;
     || primero copio el .inf
     path1 = path2;
     aExtension = "inf";
     |SI impreso=4; l="d"; nombre1="nomyreci."; nombre2=         ""; |FINSI;
     |HAZ LaCopia;

     |SI impreso=4; l="d"; nombre1="nomycrys."; nombre2=         ""; |FINSI;
     |HAZ LaCopia;

     || despues el pdf y el rpt, que los cojo de el directorio "plantillas"

     |DBASE path1;
     path1 = path1 + "plantillas/";
/*
     l = "p"; nombre1 = "nomina."; nombre2 = "";
     aExtension = "pdf";
     |HAZ LaCopia;
*/
     l = "r"; nombre1 = "nomycrys."; nombre2 = "";
     aExtension = "rpt";
     |HAZ LaCopia;
|FPRC;

|PROCESO LaCopia;
     alfa1 = "Copiando " + path1 + nombre1 + l + numero + "  ";
     alfa1 = alfa1 + path2 + nombre1 + aExtension;
     |PINTA 2301, alfa1;
     fichero1 = path1 + nombre1 + l + numero;
     fichero2 = path2 + nombre1 + aExtension;
     |COPIA_FICHERO fichero1, fichero2;
     |SI FSalida ! 0; |Y l ! "r";
          fichero1 = fichero1 < fichero1;
          fichero2 = fichero2 < fichero2;
          |COPIA_FICHERO fichero1, fichero2;
          |SI FSalida ! 0;
               || alfa1 = "    Error [" + FSalida + "] en copia de ficheros ...";
               || MENAV alfa1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ActualizaWord;
     |DBASE aBase;
     aPlantillas = aBase + "plantillas/";
     numero = #0impreso;
     numero= "00" + numero;
     numero = numero % -102;

     aFichero = "recibos." + "p" + numero;
     aOrigen = aPlantillas + aFichero;
     |XABRE "", aOrigen, nCanal;
     |SI FSalida ] 0;
          |RMKDIR "C:\recinom\recibos";

          aDestino = "C:\recinom\recibos\RECIBOS.DOC";
          |IP_REMOTO aIP;

          |SI aIP ! "";
               |ENVIA_FICHERO aOrigen, aDestino;
          |SINO;
               |COPIA_FICHERO aOrigen, aDestino;
          |FINSI;

          aFichero = "agi." + "p" + numero;
          aOrigen = aPlantillas + aFichero;
          aDestino = "C:\recinom\recibos\AGI.DAT";
          |IP_REMOTO aIP;

          |SI aIP ! "";
               |ENVIA_FICHERO aOrigen, aDestino;
          |SINO;
               |COPIA_FICHERO aOrigen, aDestino;
          |FINSI;
     |FINSI;
     |XCIERRA nCanal;
|FPRC;

|PROCESO configu; |TIPO 3;
     |DDEF path2;
     |PARA impreso = 1; |SI impreso [ 10; |HACIENDO impreso = impreso + 1;
          |SI #0impreso ! -1;|Y impreso ! 6;|Y impreso ! 7;
               |SI impreso=1; l="A"; nombre1="nomtc200."; nombre2=         ""; |FINSI;
               ||SI impreso=2; l="B"; nombre1="nomtc21p."; nombre2="nomtc21s."; |FINSI;
               |SI impreso=2; l="D"; nombre1="nomycalf."; nombre2=         ""; |FINSI;
               |SI impreso=3; l="C"; nombre1="nomyytc1."; nombre2=         ""; |FINSI;
               ||SI impreso=5; l="E"; nombre1="nomyabie."; nombre2=         ""; |FINSI;
               |SI impreso=5; l="e"; nombre1="nomyabie."; nombre2=         ""; |FINSI;
               |SI impreso=8; l="F"; nombre1="nomtalon."; nombre2=         ""; |FINSI;
               |SI impreso=9; l="";  nombre1="gomyytc2."; nombre2=         ""; |FINSI;
               |SI impreso=10;l="";  nombre1="gomyytc1."; nombre2=         ""; |FINSI;

               numero=#0impreso;  numero="00"+numero;  numero=numero % -102;

               |SI impreso = 4;
                    |HAZ lanomina;
                    |HAZ ActualizaWord;
               |FINSI;


               |SI impreso = 22;
                    path1 = path2;
                    aExtension = "inf";
                    alfa1 ="Copiando " + path1 + nombre2 + l + numero + "  ";
                    alfa1 = alfa1 + path2 + nombre2 + aExtension;
                    |PINTA 2301, alfa1;
                    fichero1 = path1 + nombre2 + l + numero;
                    fichero2 = path2 + nombre2 + "inf";
                    |COPIA_FICHERO fichero1, fichero2;
                    |SI FSalida ! 0;
                         fichero1 = fichero1 < fichero1;
                         fichero2 = fichero2 < fichero2;
                         |COPIA_FICHERO fichero1, fichero2;
                         |SI FSalida ! 0;
                              || alfa1 = "    Error [" + FSalida + "] en copia de ficheros ...";
                              || MENAV alfa1;
                         |FINSI;
                    |FINSI;
               |FINSI;

               ||SI impreso ! 2; |Y impreso ! 4;
               |SI impreso ! 4;
                    path1 = path2;
                    aExtension = "inf";
                    |HAZ LaCopia;
               |FINSI;

               |SI impreso = 5;
                    |HAZ lanominaabierta;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;
