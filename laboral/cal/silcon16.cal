|FICHEROS;
    silcon16 #0;
    silcon01 #1;         || control directorio
    silcon02 #2;         || lotes cabs.
    tsilcon0 #3;         || def ayuda carga lineas
    silcon04 #4;         || campos auxiliares
    silcon03 #5;         || lotes lins.
    silcon06 #6;         || empresas silcon
    silcon07 #7;         || registro lotes
    labempre #10;        || empresas
    nomtrtc2 #11;        || tmp. TC2
    labtraba #12;        || trabajadores
    nombonif #13;        || bonificaciones
    tsilcon4 #14;        || tmp. TC1
    tsilcon5 #15,MANTE;  || tmp. parrilla empresas
    labcentr #16;        || centros de trabajo
    nomcenes #17;        || centros de trabajo especiales
    nomcalca #18;        || calculos cabs. (proceso mensual)
    nomhicca #19;        || calculos cabs. (proceso historico)
    tsilcon1 #20;        || calculos cabs. (fuente calculos)
    nomcalac #21;        || calculos cabs. (proceso atrasos)
    nomconst #22;        || constantes
    tsilcon6 #23,MANTE;  || tmp. parrilla trabajadores
    nomtstc2 #24;        || tmp. tc1 sin tc2
    silcon15 #25;        || regimenes centros
    nomcontr #36;        || control aplicacion
    nomtraca #55;        || importes trab.cabs. (bonif.exp.reg.emp.)
    nomcones #56;        || constante especial (bonif.exp.reg.emp.)
    nomepigr #57;        || epigrafes (bonif.exp.reg.emp.)
    nomepitr #58;        || epigrafes trabajador (bonif.exp.reg.emp.)

    labempax #50;        || aux.empresas (para nome_dat y para TC2)
    nomtepig #51;        || aux.epigrafes (para nome_dat y para TC2)
    labemphi #52;        || aux.empresas hist. (para TC2)
    nomwepig #53;        || aux.epigrafes hist. (para TC2)
    nombofli;

    ||nomret03 #100;       || bonificaciones retroactivas
    nomequiv #101;       || tabla equivalencias contratos nuevos
     nomir003;
     nombotra;
     gomccchi;
     tsilcon9,MANTE;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    alfa5 = "";
    alfa6 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    nume6 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;
    p_mes = "";
    inkey = 0;

    ajuste1 = "";
    ajuste2 = "";
    ajuste3 = "";
    alfa = "";
    error = 0;
    ind = 0;
    long = 0;
    posi = 0;
    digito = "";
    texto = "";
    mascara = "";
    cadena = "";
    i = 0;
    nCampo = 0;
    nTipo = 0;

    fichero = "";
    extension = "";

    clave = "";
    sw_auxil = 0;
    linea = 0;
    nlinea = 0;
    for_fecha = "";
    for_hora = "";
    apell1 = "";
    apell2 = "";
    nombre = "";
    nro_trab = 0;

    tot_ba_01 = 0;
    tot_ba_02 = 0;
    tot_ba_21 = 0;
    tot_ba_22 = 0;
    tot_ba_41 = 0;
    tot_ba_42 = 0;
    tot_ba_23 = 0;
    tot_ba_34 = 0;
    tot_ba_36 = 0;
    tot_ba_37 = 0;
    tot_ba_38 = 0;
    tot_ba_30 = 0;
    tot_ba_32 = 0;

    tot_cd_06 = 0;
    tot_cd_07 = 0;
    tot_cd_10 = 0;
    tot_cd_11 = 0;
    tot_cd_13 = 0;
    tot_cd_16 = 0;
    tot_cd_17 = 0;
    tot_cd_22 = 0;
    tot_cd_26 = 0;
    tot_cd_27 = 0;
    tot_cd_28 = 0;

    tot_ca_86 = 0;

    tot_ca_01 = 0;
    tot_ca_02 = 0;
    tot_ca_22 = 0;
    tot_ca_30 = 0;
    tot_ca_50 = 0;
    tot_ca_51 = 0;
    tot_ca_52 = 0;

    descom = "";
    entero = "";
    decima = "";
    tot_emp = 0;
    &s_emp = 0;
    &s_any = 0;
    &s_mes = 0;
    &s_has = 0;
    &s_tip = "";
    &s_tipd = "";
    &s_cen = "";
    &s_pas = 0;
    &s_nom = "";
    &s_ori = "";
    &s_tat = 0;
    &s_ele = "";
    s_res = 0;
    indica = "";
    dto_mat = 0;
    cc_mat = 0;
    cp_mat = 0;
    eldat = 0;
    d_alta = 0;
    sw_dat1 = 0;
    sw_dat2 = 0;
    sw_dat3 = 0;
    corta = 0;
    nBaseCC = 0;

    sw_parrilla = 0;
    sw_bueno = 0;
    ant_centro = 0;
    cta_co = "";
    descto = "";
    ind_cot = " ";
    &any_hist = 0;
    traba = 0;

    bonifi = 0;
    bonifib = 0;
    reducc = 0;
    reduccb = 0;
    reducce = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    reduc0502 = 0;
    reduc0502b = 0;
    nContrato = 0;
    aClaveTGSS = "";

    nEuros = 0;
    nPesetas = 0;
    nCambioeuro = 166.386;
    nSwitchEuro1 = 0;
    nSwitchEuro2 = 0;

    &temp1 = "";
    &temp2 = "";
    &temp3 = "";
    &temp4 = "";
    &temp5 = "";
    &temp6 = "";

    bcomun = 0;
    bprofe = 0;
    dia_2 = 0;
    dia_3 = 0;
    dia_4 = 0;
    topemes = 0;
    &esAtrasos = 0;
    dat_mes = 0;
    ult11 = 0;
    fecha_bon_16 = "";

     aAbreviado = "";
     &eaFuente = "";
     &enTipoAt = 0;
     &enDesEmp = 0;
     &enHasEmp = 0;
     &enDesCen = 0;
     &enHasCen = 0;
     &enDesMes = 0;
     &enHasMes = 0;
     &enAny = 0;
     &eaTempo1 = "";
     &eaTempo2 = "";
     &eaTipoLi = "";
     &eaParame = "";
     &aParam = "";
     &nEmpresa = 0;
     aLibre = "";
     aReser = "";
     aEpiTc2 = "";
     nSwPrimera = 0;
     aPromed = "";
     &enSwBorrados = 0;
     bon_0 = 0;
     bon_3 = 0;
     bon_5 = 0;
     bon_60 = 0;
     swbon_65 = 0;
     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;
     CodigoCons = 0;
     epig_ilt = 0;
     epig_ims = 0;
     nPorBon = 0;
     por1_cont = 0;
     por1_dfpg = 0;
     zbase_9 = 0;
     nMarcarE = 0;
     nMarcarT = 0;
     nPEnf = 0;
     nPAcc = 0;
     nBIlt = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aAlfa6 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nVeces = 0;
     aRegimen = "";
     aContrato = "";
     &nAnyo = 0;
     aAnyo = "";
     &EURODB = 0;
     prov_ad = "";
     aClaveTC2 = "";
     &nMes = 0;
     nBaseCC_vac = 0;
     nBaseCP_vac = 0;
     nBaseCC_acu = 0;
     nBaseCP_acu = 0;
     tipo_bot = 0;
     tipo_top = 0;
     aAviso = "";
     m = 0;
     dias_finiq = 0;
     total_dias = 0;
     desde_mes = 0;
     nMes2 = 0;
     nSwDiasCero = 0;
     nReducc_vac = 0;
     nReducc_acu = 0;
     nBonifi_vac = 0;
     nBonifi_acu = 0;
     nSubven_vac = 0;
     nSubven_acu = 0;
     nSub85pre_vac = 0;
     nSub85pre_acu = 0;
     nSub85dis_vac = 0;
     nSub85dis_acu = 0;
     nBon_60_vac = 0;
     nBon_60_acu = 0;
     primer_mes = "";
     ultimo_mes = "";
     linea_EMP = 0;
     meses_bon = 0;
     swBonif = 0;
     &anyocal = 0;
     &mescal = 0;
     anyofin = 0;
     mesfin = 0;
     fecha1 = @;
     dias_enfmat = 0;
     &nTrabaj = 0;
     &nDesdeTipo = 0;
     &nHastaTipo = 0;
     &eaVengode = "";
     &swSelEmp = 0;
     &swSelTra = 0;
     &aLiq = "";
     nFijos = 0;
     nEven = 0;
     nREA = 0;
     nJorAlta = 0;
     aPorCentros = "";

     &aCError = "";
     &nCConst = 0;
     &fCFecha = @;
     aAlfa = "";

     nAnyoBase = 0;
     aAnyoBase = "";
     nEmp_Act = 0;
     aNAFSS_Act = "";
     aSSCen2_Act = "";
     nEmp_Ant = 0;
     aNAFSS_Ant = "";
     aSSCen2_Ant = "";
     &nDesdeMes = 0;
     &nHastaMes = 0;

     aSigno = "";
     nBonifFPCont = 0;
     swBonifFPCont = 0;
     nEmpresaAnt = 0;

     nDiasMes = 0;
     nDiasAlta = 0;
     nDiasIT = 0;
     nDiasMate = 0;
     nDiasExp = 0;
     nAjustePFE = 0;
     tottracd22 = 0;
     nDias = 0;
     nBase = 0;
     &nEpigConv = 0;
     &s_anyl = 0;
     &nElAny = 0;
     &nElMes = 0;
     nDiasIT_2 = 0;
     nEquivDias = 0;
     nRedFijaCC = 0;         || reduccion fija de 21 euros
     nRedFijaATEP = 0;       || reduccion fija de 21 euros
     nRedJorCC = 0;          || reduccion fija de 0.70 euros
     nRedJorATEP = 0;        || reduccion fija de 0.70 euros
     nRedFijaMes = 0;
     swSigue = 0;
     fFecha1 = @;
     fFecha2 = @;
     nBonif = 0;

     swAjuste3 = 0;
     swNoAjuste3 = 0;
     desde = 0;
     hasta = 0;
     bisiesto = 0;
     sw_eldat1 = 0;
     sw_eldat2 = 0;
     sw_eldat4 = 0;
     nDiferencia = 0;
     nTotal = 0;
     nRegimen = 0;

     swStop = 0;
     nEmp = 0; nTra = 0;
     aCuentaCentro = "";
     &s_num = 0;
     &s_sel = "";
     &s_lotecra = 0;
     &s_fichcra = "";
     &s_fich = "";
     &enLote = 0;
     &eaFich = "";
     &eaExt = "";
     aNumero = "";
     aFich = "";
     nNume = 0;
     &nPosicion = 0;
     aAutorizacion = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &aCadena = "";
|FIN;

____________________________________/ GESTION PANTALLA
|PROCESO tipo8;
|ABRE #1;
|LEE 100#1p;
|SI FSalida ! 0;|Y aParam ! "TC2";
    |SI FSalida = 111;
        |MENAV "    Debera definir 'Maestros/Control R.E.D.'";
    |FINSI;
    |CIERRA #1;
    |PTEC 807;
|SINO;
        alfa1 = Usuario; |QBF alfa1;    alfa1 = "1" + alfa1;
    ||NOME_DAT #14 alfa1;
|FINSI;
|FPRC;

|PROCESO tipo9;
|LIBERA #1;
|CIERRA #1;
|FPRC;

|PROCESO defecto; |TIPO 7;
     fech1 = ~;
     alfa1 = fech1;
     alfa1 = alfa1 % 402;
     nume1 = alfa1;
     alfa2 = fech1;
     alfa2 = alfa2 % -104;
     nume2 = alfa2;

     |SI nume1 = 1;
         #0Campo = nume2 - 1;
     |SINO;
         #0Campo = nume2;
     |FINSI;
     |PINTA #0Campo;
|FPRC;

|PROCESO mirames; |TIPO 7;
     |SI #0#12 ! "A";|Y #0#12 ! "T"; |Y #0#12 ! "C";
          fech1 = ~;
          alfa1 = fech1;
          alfa1 = alfa1 % 402;
          nume1 = alfa1;
          alfa2 = fech1;
          alfa2 = alfa2 % -104;
          nume2 = alfa2;

          |SI nume1 = 1;
              #0Campo = 12;
          |SINO;
              #0Campo = nume1 - 1;
          |FINSI;

          |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 0843, p_mes;
|FPRC;

|PROCESO ult_lote; |TIPO 7;
|ABRE #2;
|LEE 000#2u;
|SI FSalida = 0;
        #0#2 = #2#0 + 1;
|SINO;
        #0#2 = 1;
|FINSI;
|PINTA #0#2;
|CIERRA #2;
|FPRC;

|PROCESO si_existe; |TIPO 0;
     |ABRE #2;
     #2#0 = #0Campo;
     |LEE 000#2=;
     |SI FSalida = 0; |Y #0Campo ! 00000;
          |MENAV "    Numero de Lote YA existente ...";
          |ERROR;
     |FINSI;
     |CIERRA #2;

     |SI Campo = 2; |Y #0Campo = #0#2; |Y #0#21 = "S";
          aAlfa = "    El número de lote FAN debe ser distinto al del lote CRA.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;

     |SI Campo = 22; |Y #0Campo = #0#2; |Y #0#21 = "S";
          aAlfa = "    El número de lote CRA debe ser distinto al del lote FAN.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO iniswitch;          || Solo para inicializar las variables
     nSwitchEuro1 = 0;       || del paso a euros
     nSwitchEuro2 = 0;
|FPRC;

|PROCESO no_vacio; |TIPO 0;
    alfa1 = #0Campo;
|QBT alfa1;
|SI alfa1 = "";
    |MENAV "    Campo Obligatorio. Indique un nombre de fichero segun su criterio.";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO fecha_bon_16;
     alfa1 = #12#11 % -104;        || anyo nacimiento
     alfa2 = #12#11 % -602;        || mes nacimiento
     alfa5 = #12#11 % 102;         || dia nacimiento
     alfa3 = #12#34 % -104;        || anyo antiguedad
     alfa4 = #12#34 % -602;        || mes antiguedad
     alfa6 = #12#34 % 102;         || dia antiguedad
     nume1 = alfa1;
     nume1 = alfa1 + 60;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + 5;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad


     nAnyoBase = #nomcontr#38;
     |SI nAnyoBase = 0;
          nAnyoBase = 2003;
     |FINSI;
     aAnyoBase = nAnyoBase;

     |SI nume1 > nume3;            || cuando cumple 60 a¤os
          |SI nume1 < nAnyoBase;
               fecha_bon_16 = "01.01." + aAnyoBase;
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < nAnyoBase;
               fecha_bon_16 = "01.01." + aAnyoBase;
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 a¤os
               |SI nume1 < nAnyoBase;
                    fecha_bon_16 = "01.01." + aAnyoBase;
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < nAnyoBase;
                    fecha_bon_16 = "01.01." + aAnyoBase;
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 a¤os
                    |SI nume1 < nAnyoBase;
                         fecha_bon_16 = "01.01." + aAnyoBase;
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume6 < nume5;            || cuando cumple antiguedad
                    |SI nume3 < nAnyoBase;
                         fecha_bon_16 = "01.01." + aAnyoBase;
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    |SI nume3 [ nAnyoBase;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + aAnyoBase;
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO borra_tra1;
|BORRA 020#23a;
|LIBERA #23;
|FPRC;

|DEFBUCLE borra_tra;
 #23#2;
 ;
 #15#0,     1;
 #15#0, 99999;
 be;
 NULL, borra_tra1;
|FIN;

|PROCESO parrilla_tra1;
     #23#1 = #12#0;
     #23#2 = #12#1;
     |LEE 000#23=;
     |SI FSalida ! 0;
          #tsilcon9#0 = #labtraba#0;
          #tsilcon9#1 = #labtraba#77;
          |LEE 000#tsilcon9.=;
          |SI FSalida = 0;
               |SI #tsilcon9#3 ! "*";
                    |ACABA;
               |FINSI;
          |FINSI;

          traba = traba + 1;
          |DDEFECTO #23;
          #23#0 = traba;       || linea
          #23#1 = #12#0;       || empresa
          #23#2 = #12#1;       || trabajador
          #23#3 = #12#2;       || nombre
          #23#4 = #12#45;      || contrato
          #23#5 = #12#77;      || centro trabajo
          #23#6 = #12#39;      || bonificacion
          |SI nMarcarT = 0;     #23#7 = "*";   |FINSI;   || marcado SI
          |SI nMarcarT ! 0;     #23#7 = " ";   |FINSI;   || marcado NO
          |GRABA 020#23n;
     |SINO;
          #tsilcon9#0 = #labtraba#0;
          #tsilcon9#1 = #labtraba#77;
          |LEE 000#tsilcon9.=;
          |SI FSalida = 0;
               |SI #tsilcon9#3 ! "*";
                    |BORRA 020#23a;;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE parrilla_tra;
 #12#1;
 ;
 #15#0,     1;
 #15#0, 99999;
 ;
 NULL, parrilla_tra1;
|FIN;

|PROCESO parrilla_emp1;
     |SI #15#2 = "*";|O sw_parrilla = 0;
          |SELECT #2#23;
          |AVISO;
          alfa1 = "0000SMarcar todos los trabajadores de la empresa [" + #15#0 + "]:";
          |CONFI alfa1;
          nMarcarT = FSalida;

          |BUCLE parrilla_tra;

          |SELECT #1#23;
     |SINO;
          |CIERRAT #23;
          |BUCLE borra_tra;
          |ABRET #23;
     |FINSI;
|FPRC;

|DEFBUCLE parrilla_emp;
 #15#1;
 ;
     1;
 99999;
 ;
 NULL, parrilla_emp1;
|FIN;

|PROCESO parrilla2;
     |ABRET #23;
     |ABRE #tsilcon9;
     |LEE 000#23u;  |SI FSalida = 0; traba = #23#0; |SINO; traba = 0; |FINSI;
     |BUCLE parrilla_emp;
     |LEE 000#23u;  |SI FSalida = 0; traba = #23#0; |SINO; traba = 0; |FINSI;
     |CIERRA #tsilcon9;
     |CIERRAT #23;
|FPRC;

|PROCESO reenvio_cen;
     #10#0 = #silcon15#0;
     |LEE 000#10=;
     |SI FSalida = 0;
          |DDEFECTO #15;
          #15#0 = #10#0;
          #15#1 = #10#2;
          |LEE 000#15=;
          |SI FSalida ! 0;
               |SI nMarcarE = 0;    #15#2 = "*";   |FINSI;
               |SI nMarcarE ! 0;    #15#2 = " ";   |FINSI;
               |GRABA 020#15n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE reenvio_cen;
 #silcon15#1;
 2;
     1, 001, nRegimen;
 99999, 999, nRegimen;
 ;
 NULL, reenvio_cen;
|FIN;

|PROCESO reenvio_emp;
     #10#0 = #6#0;
     |LEE 000#10=;
     |SI FSalida = 0;
          |DDEFECTO #15;
          #15#0 = #6#0;
          #15#1 = #10#2;
          |LEE 000#15=;
          |SI FSalida ! 0;
               |SI nMarcarE = 0;    #15#2 = "*";   |FINSI;
               |SI nMarcarE ! 0;    #15#2 = " ";   |FINSI;
               |GRABA 020#15n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE reenvio_emp;
 #6#1;
 2;
     1, nRegimen;
 99999, nRegimen;
 ;
 NULL, reenvio_emp;
|FIN;

|PROCESO min23;
    #23#0 = 1;
|FPRC;

|PROCESO max23;
    #23#0 = 999999;
|FPRC;

|PROCESO min15;
    #15#0 = 1;
|FPRC;

|PROCESO max15;
    #15#0 = 99999;
|FPRC;

|PROCESO parrilla; |TIPO 0;
|SI FSalida = 0;|Y #0#11 = "S";
    |SI sw_parrilla = 0;
        |ATRI P;   |MENSA "    Cargando seleccion ...";    |ATRI 0;
            alfa1 = Usuario; |QBT alfa1;    alfa1 = ("t" + alfa1) % 108;
            alfa2 = Usuario; |QBT alfa2;    alfa2 = ("u" + alfa2) % 108;
            alfa3 = Usuario; |QBT alfa3;    alfa3 = ("v" + alfa3) % 108;
        |NOME_DAT #15 alfa1;
        |NOME_DAT #23 alfa2;
        |NOME_DAT #tsilcon9#alfa3#;
        |DELINDEX #15;
        |DELINDEX #23;
        |DELINDEX #tsilcon9;
        |AVISO;
        |CONFI "0000NMarcar todas las empresas: ";
        nMarcarE = FSalida;
        |ABRE #10;
        |ABRE #15;
        |ABRE #tsilcon9;
        nRegimen = 613;
        |BUCLE reenvio_emp;
        nRegimen = 163;
        |BUCLE reenvio_emp;
        nRegimen = 613;
        |BUCLE reenvio_cen;
        nRegimen = 163;
        |BUCLE reenvio_cen;
        |CIERRA #tsilcon9;
        |CIERRA #10;
        |CIERRA #15;
        |ATRI R;   |BLIN 4;                                |ATRI 0;
            sw_parrilla = 1;
    |FINSI;

    |PUSHV 0501 2380;
    |ENTLINEAL #1#15, 1, 4, 22, 1, min15, max15;
    |CONFI "    NSeleccion de Trabajadores (S/N): ";
    |SI FSalida = 0;
        swSelTra = 1;
        |HAZ parrilla2;
        |SI traba ! 0;
            |PUSHV 0501 2380;
            |ENTLINEAL #1#23, 1, 4, 22, 1, min23, max23;
            |POPV;
        |SINO;
            swSelTra = 0;
            |MENAV "    No hay empresas seleccionadas ...";
        |FINSI;
    |SINO;
        swSelTra = 0;
    |FINSI;
    |POPV;
|FINSI;
|FPRC;

|PROCESO CargaAuto; |TIPO 0;
     |SI FSalida = 0;|Y #0#11 = "N";
          |ATRI P;   |MENSA "    Cargando seleccion ...";    |ATRI 0;
          alfa1 = Usuario; |QBT alfa1;    alfa1 = ("t" + alfa1) % 108;
          alfa2 = Usuario; |QBT alfa2;    alfa2 = ("u" + alfa2) % 108;
          alfa3 = Usuario; |QBT alfa3;    alfa3 = ("v" + alfa3) % 108;
          |NOME_DAT #15 alfa1;
          |NOME_DAT #23 alfa2;
          |NOME_DAT #tsilcon9#alfa3#;
          |DELINDEX #15;
          |DELINDEX #23;
          |DELINDEX #tsilcon9;
          nMarcarE = 0;
          |ABRE #10;
          |ABRE #15;
          |ABRE #tsilcon9;
          nRegimen = 613
          |BUCLE reenvio_emp;
          nRegimen = 163
          |BUCLE reenvio_emp;
          nRegimen = 613
          |BUCLE reenvio_cen;
          nRegimen = 163
          |BUCLE reenvio_cen;
          |CIERRA #10;
          |CIERRA #15;
          |CIERRA #tsilcon9;
     |FINSI;
|FPRC;

|PROCESO mes_atrasos; |TIPO 7;
|SI #0#12 ! "A";|Y #0#12 ! "T";
    |CAMPO_MODIFICA #0#13, 1, "N";
        #0#13 = #0#1;
    |PINTA #0#13;
|SINO;
    |CAMPO_MODIFICA #0#13, 1, "S";
|FINSI;
|FPRC;

|PROCESO def_calif; |TIPO 7;
|SI #0#12 = "M";|O #0#12 = "H";                    #0#14 = "L00"; |FINSI;
|SI #0#12 = "A";|O #0#12 = "T"; |O #0#17 = 2;      #0#14 = "L03"; |FINSI;
|SI #0#17 = 2;                                     #0#14 = "L13"; |FINSI;
|PINTA #0#14;
|FPRC;

|PROCESO calif_liq; |TIPO 0;
    inkey = FSalida;
    elsw1 = 0;
|SI #0#14 = "L00";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L01";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L02";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L03";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L04";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L07";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L08";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L09";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L10";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L11";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L12";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L13";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L15";  elsw1 = 1;     |FINSI;
|SI #0#14 = "L80";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A70";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A71";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A72";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A73";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A74";  elsw1 = 1;     |FINSI;
|SI #0#14 = "A75";  elsw1 = 1;     |FINSI;
|SI elsw1 = 0;
    |MENAV "    Calificador no reconocido ...";
    |ERROR;
|SINO;
    |SI inkey ! 2;
        |SI #0#12 = "A";|O #0#12 = "T";
            |SI #0#14 ! "L03"; |Y #0#14 ! "L09";
                |MENAV "    Las liquidaciones por Atrasos deben calificarse con L03 o bien L09 para Liquidaciones Complementarias.";
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO no_fecha; |TIPO 7;
|SI #0#14 = "L03";
        alfa1 = "S";
|SINO;
        alfa1 = "N";
|FINSI;
|C_M #0#10, 1, alfa1;
|FPRC;

|PROCESO notipo; |TIPO 7;
     |SI #0#12 ! "A";
          |C_M #0#17, 1, "S";
          |SI #0#12 = "M";|O #0#12 = "H";    #0#17 = 0;     |FINSI;
          |SI #0#12 = "T";                   #0#17 = 5;     |FINSI;
          |PINTA #0#17;
          #0#14 = "L00";
          |PINTA #0#14;
     |SINO;
          #0#17 = 5;
          |PINTA #0#17;
          |C_M #0#17, 1, "N";
          #0#14 = "L03";
          |PINTA #0#14;
     |FINSI;
|FPRC;

|PROCESO cheq_tipo; |TIPO 0;
     |SI #0#12 = "M"; |O #0#12 = "H";
          |SI #0Campo ! 0; |Y #0Campo ! 2;
               aAviso = "0000En Procesos Mensual o Historico solo se admiten "
               aAviso = aAviso + "los tipos 0 y 2";
               |MENAV aAviso;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #0#12 = "T";
          |SI #0Campo < 5;
               aAviso = "0000En Proceso Atrasos desde Historico solo se admiten "
               aAviso = aAviso + "los tipos del 5 al 9";
               |MENAV aAviso;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AnyoLote; |TIPO 7;
     #0#18 = #0#0;
     |PINTA #0#18;
     |SI #0#12 = "M";|O #0#12 = "A";
          |C_M #0#18, 1, "N";
     |SINO;
          |C_M #0#18, 1, "S";
     |FINSI;
|FPRC;
____________________________________/ FORMATEO DE DATOS
|PROCESO errores;
    alfa1 = "    " + i + "." + clave;
|SI error = 1;
        alfa1 = alfa1 + ": VALOR DE CAMPO NUMERICO INCORRECTO";
|FINSI;
|SI error = 2;
        alfa1 = alfa1 + ": CAMPO OBLIGADO SIN RELLENO";
|FINSI;
     alfa1 = alfa1 + " EN LINEA " + linea;
|MENAV alfa1;
|FPRC;

|PROCESO comp1;               || COMPRUEBA SI ES NUMERICO.
     |SI ajuste1 = "1";
          error = 0;
          |PARA ind = 1; |SI ind [ long; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito ! " ";|Y digito ! ".";|Y digito ! "-";
                    |SI digito < "0"; |O digito > "9";
                         error = 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp2;               || COMPRUEBA SI TIENE QUE ESTAR RELLENO.
     |SI ajuste3 = "3";
          error = 0;
          FSalida = 0;
          |QBF alfa;
          |PARA ind = 1; |SI FSalida = 0; |HACIENDO ind = ind + 1;
               posi = 100 * ind + 1;
               digito = texto % posi;
               |SI digito = "";
                    error = 2;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO comp3;               || AJUSTA I, o D. Y RELLENA DE 0 o BLANCOS.
     |SI ajuste3 = "1";       || RELLENA BLANCOS.
          mascara = "                                                                    ";
     |FINSI;
     |SI ajuste3 = "2";       || RELLENA CEROS.
          mascara = "00000000000000000000000000000000000000000000000000000000000000000000";
     |FINSI;
     |SI ajuste2 = "1";       || AJUSTA DERECHA.
          posi = 100 + long;
          posi = posi * -1;
          |QBF texto;
          texto = mascara + texto;
          texto = texto % posi;
     |FINSI;
     |SI ajuste2 = "2";
          posi = 100 + long;
          |QBF texto;
          texto = texto + mascara;
          texto = texto % posi;
     |FINSI;
|FPRC;

|PROCESO monta;
     texto = "";
     cadena = "";
     |PARA i = 0; |SI i < 30; |HACIENDO i = i + 1;
          nCampo = i;
          texto = #3nCampo;
          nTipo = i * 6 + 2;                 || MODIFICABLE.
          alfa  = #4nTipo;
          nTipo = i * 6 + 2;                 || VISUAL.
          alfa1 = #4nTipo;
          |SI alfa = "S"; |O alfa1 = "S";
               nTipo = i * 6 + 6;            || Longitud.
               long  = #4nTipo;
               nTipo = i * 6 + 7;            || AJUSTE.
               alfa  = #4nTipo;
               ajuste1 = alfa % 101;
               ajuste2 = alfa % 201;
               ajuste3 = alfa % 301;
               |HAZ comp1;
               |SI error = 1; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp2;
               |SI error = 2; |HAZ errores; |ACABA; |FINSI;
               |HAZ comp3;
               cadena = cadena + texto;
          |FINSI;
     |SIGUE;
|FPRC;
____________________________________/ RUTINAS DE APOYO
|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#1;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#0;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
     |SI aCError ! "";
          |SI nCConst = 700;
               aAlfa = "0000No se ha encontrado la Constante Comun del ";
               aAlfa = aAlfa + " Regimen Agrario (700)";
               |MENAV aAlfa;
          |SINO;
               alfa1 = #labtraba#0; alfa1 = "00000" + #labtraba#0; alfa1 = alfa1 % -105;
               alfa2 = #labtraba#1; alfa2 = "00000" + #labtraba#1; alfa2 = alfa2 % -105;
               aAlfa = "0000ATENCION: Trabajador: " + alfa1 + "." + alfa2;
               aAlfa = aAlfa + " La constante del trabajador no esta definida.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO descompone;
    entero = "";
    decima = "";
    elsw1 = 0;
    alfa1 = descom % 0;   long = alfa1;
|PARA para1 = 1; |SI para1 [ long; |HACIENDO para1 = para1 + 1;
        nume1 = (para1 * 100) + 1;
        alfa1 = descom % nume1;
    |SI alfa1 = ".";
            elsw1 = 1;
    |SINO;
        |SI elsw1 = 0;   entero = entero + alfa1; |FINSI;
        |SI elsw1 = 1;   decima = decima + alfa1; |FINSI;
    |FINSI;
|SIGUE;

|SI entero = "";    entero = "0";  |FINSI;
|SI decima = "";    decima = "0";  |FINSI;
|FPRC;

|PROCESO bonif;                    || vemos si tiene realmente bonif.
     swBonif = 0;                  || en exp. reg. empleo segun la fechas de
     anyocal = #0#0;               || alta y baja de la bonif
     mescal = #0#13;
     alfa1 = #12#41 % -104;        || a¤o baja bonif.
     alfa2 = #12#41 % 402;         || mes baja bonif.
     anyofin = alfa1;
     mesfin = alfa1;
     |SI anyofin ! 0;
          |SI anyofin ] anyocal;
               |SI anyofin = anyocal;
                    |SI mesfin ] mescal;
                         swBonif = 1;
                    |FINSI;
               |SINO;
                    swBonif = 1;
               |FINSI;
          |FINSI;
     |SINO;
          meses_bon = #13#14 + #13#15 + #13#16;
          |SI meses_bon ] 999;
               swBonif = 1;
          |SINO;
               meses_bon = meses_bon / 1000;
               fecha1 = #12#40;        || fecha alta bonif.
               fecha1 = fecha1 + meses_bon;
               alfa1 = fecha1;
               alfa2 = alfa1 % -104;
               alfa3 = alfa1 % 402;
               anyofin = alfa2;
               mesfin = alfa3;
               |SI anyofin ] anyocal;
                    |SI anyofin = anyocal;
                         |SI mesfin ] mescal;
                              swBonif = 1;
                         |FINSI;
                    |SINO;
                         swBonif = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BoniExpediente;
     nPorBon = #20#82;
     |SI #tsilcon1#81 ! 0;     nPorBon = #20#83;   |FINSI;

     |DDEFECTO #nomepigr;
     |ABRE #nomepigr;
     #nomepigr#0 = #labtraba#32;
     |LEE 000#nomepigr.=;
     epig_ilt = #nomepigr#1;
     epig_ims = #nomepigr#2;
     |CIERRA #nomepigr;

     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = #labtraba#32;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0;
          epig_ilt = #nomepitr#3;
          epig_ims = #nomepitr#4;
     |FINSI;
     |CIERRA #nomepitr;

     nCConst = #labtraba#248;
     |HAZ constante;
/*
     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;

     |DDEFECTO #nomcones;
     |ABRE #nomcones;
     #nomcones#0 = #labempre#32;
     |LEE 000#nomcones.=;
     |CIERRA #nomcones;
*/
     por1_cont = #nomconst#7;
     por1_dfpg = #nomconst#13 + #nomconst#15 + #nomconst#17 + #nomconst#19;
     ||SI #tsilcon1#9 = 64;    por1_cont = por1_cont * #nomcones#21;   |FINSI;
     ||SI #tsilcon1#9 = 65;    por1_cont = por1_cont * #nomcones#22;   |FINSI;
     por1_cont = por1_cont ! 2;

     bon_0 = #tsilcon1#78 * #labtraba#242;        || base CC
     bon_3 = #tsilcon1#78 * #labtraba#242;        || base CP
     bon_5 = 0;

     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;

     base_A = (bon_0 % #nombonif#4) % nPorBon;
     base_A = base_A ! EURODB;
     base_B = (bon_3 % #nombonif#5) % nPorBon;
     base_B = base_B ! EURODB;
     |SI #nombonif#8 = "S";
          zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
          zbase_9 = zbase_9 ! EURODB;
          zbase_9 = zbase_9 + (bon_5 % (#nomconst#3 + #nomconst#4));
          zbase_9 = zbase_9 ! EURODB;
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;
     |FINSI;
     base_F = base_A + base_B + base_C;

     #tsilcon1#63 = base_F;
     #tsilcon1#81 = 0;
|FPRC;

|PROCESO separa_nom;
    ||alfa1 = #11#19; |QBF alfa1;
    alfa1 = #labtraba#2; |QBF alfa1;
    alfa2 = alfa1 % 0;   para2 = alfa2;
    elsw4 = 0;
    apell1 = "";
    apell2 = "";
    nombre = "";
|PARA para1 = 1; |SI para1 [ para2; |HACIENDO para1 = para1 + 1;
        nume2 = (para1 * 100) + 1;
        alfa3 = alfa1 % nume2;
    |SI alfa3 = " ";|O alfa3 = ",";
        |SI apell1 ! "";
                elsw4 = elsw4 + 1;
        |FINSI;
        |SI elsw4 ] 2;|Y nombre ! "";
                nombre = nombre + alfa3;
        |FINSI;
    |SINO;
        |SI elsw4 = 0;  apell1 = apell1 + alfa3; |FINSI;
        |SI elsw4 = 1;  apell2 = apell2 + alfa3; |FINSI;
        |SI elsw4 ] 2;  nombre = nombre + alfa3; |FINSI;
    |FINSI;
|SIGUE;
    aAbreviado = (apell1 % 102) + (apell2 % 102) + (nombre % 101);
    aAbreviado = aAbreviado > aAbreviado;
|FPRC;

|PROCESO fecha;
    for_fecha = fech1;
    for_fecha = (for_fecha % -104) + (for_fecha % 402) + (for_fecha % 102);
|FPRC;

|PROCESO fechaTC2;
    for_fecha = fech1;
    for_fecha = (for_fecha % 102) + (for_fecha % 402) + (for_fecha % -102);
|FPRC;

|PROCESO hora;
|HORA for_hora;
    for_hora = (for_hora % 102) + (for_hora % 402);
|FPRC;

|PROCESO ini_linea;
|DDEFECTO #5;
    linea = linea + 2;        || linea del fichero
|SI linea > 99999;
     |MENAV "0000Numero de lineas excedido. Lote demasiado extenso.";
     |MENAV "0000Debera repetir el lote seleccionando menos empresas.";
|FINSI;
    nlinea = nlinea + 1;      || numero de registros

    #5#0 = #2#0;
    #5#1 = linea;
    #5#2 = "F";
    #5#3 = clave;
|GRABA 020#5b;

    sw_auxil = 0;
    #4#0 = #5#2;
    #4#1 = #5#3;
|LEE 000#4=;
|SI FSalida ! 0;
        alfa1 = "    Descripcion [" + #4#0 + "-" + #4#1 + "] sin definir ...";
    |MENAV alfa1;
        sw_auxil = 1;
|FINSI;
|FPRC;

|PROCESO fin_linea;
    #5#4 = cadena;
|GRABA 020#5a;
|LIBERA #5;
|FPRC;

|PROCESO fin_linea2;
    linea = linea - 2;
    nlinea = nlinea - 1;
|BORRA 020#5a;
|LIBERA #5;
|FPRC;

|PROCESO euro;
     |SI EURODB = 0;          ||  Estamos en pesetas, pasa todo a euros
          nEuros = 0;
          nEuros = nPesetas / nCambioeuro;
          nEuros = (nEuros ! 2) * 100;
          nPesetas = 0;
     |FINSI;
     |SI EURODB = 2;          || Estamos en Euros, simplemente pasa a centimos
          nEuros = 0;
          nEuros = nPesetas * 100;
          nPesetas = 0;
     |FINSI;
|FPRC;

|PROCESO pasaaeuros_edl;
     |SI nSwitchEuro1 = 1;
          |ACABA;
     |FINSI;
     nPesetas = sub85dis;   |HAZ euro;    sub85dis = nEuros;
     nPesetas = sub85pre;   |HAZ euro;    sub85pre = nEuros;
     nPesetas = subven;     |HAZ euro;    subven = nEuros;
     nPesetas = bonifi;     |HAZ euro;    bonifi = nEuros;
     nPesetas = bonifib;    |HAZ euro;    bonifib = nEuros;
     nPesetas = reducc;     |HAZ euro;    reducc = nEuros;
     nPesetas = reduccb;    |HAZ euro;    reduccb = nEuros;
     nPesetas = reducce;    |HAZ euro;    reducce = nEuros;
     nPesetas = reduc0502;  |HAZ euro;    reduc0502 = nEuros;
     nPesetas = reduc0502b; |HAZ euro;    reduc0502b = nEuros;
     nPesetas = bon_60;     |HAZ euro;    bon_60 = nEuros;
     nPesetas = #11#34;     |HAZ euro;    #11#34 = nEuros;
     nPesetas = #11#46;     |HAZ euro;    #11#46 = nEuros;
     nPesetas = #11#32;     |HAZ euro;    #11#32 = nEuros;
     nPesetas = #11#29;     |HAZ euro;    #11#29 = nEuros;
     nPesetas = #11#28;     |HAZ euro;    #11#28 = nEuros;
     nPesetas = #11#27;     |HAZ euro;    #11#27 = nEuros;
     nPesetas = #11#37;     |HAZ euro;    #11#37 = nEuros;
     nPesetas = #11#25;     |HAZ euro;    #11#25 = nEuros;
     nPesetas = #11#61;     |HAZ euro;    #11#61 = nEuros;
     nPesetas = #11#62;     |HAZ euro;    #11#62 = nEuros;
     nPesetas = #11#64;     |HAZ euro;    #11#64 = nEuros;
     nPesetas = #11#66;     |HAZ euro;    #11#66 = nEuros;
     nPesetas = #11#70;     |HAZ euro;    #11#70 = nEuros;
     nPesetas = #11#71;     |HAZ euro;    #11#71 = nEuros;
     nPesetas = #11#73;     |HAZ euro;    #11#73 = nEuros;
     nPesetas = #11#30;     |HAZ euro;    #11#30 = nEuros;
     nPesetas = #11#82;     |HAZ euro;    #11#82 = nEuros;
     nPesetas = #11#83;     |HAZ euro;    #11#83 = nEuros;
     nPesetas = #11#84;     |HAZ euro;    #11#84 = nEuros;

     nPesetas = #11#90;     |HAZ euro;    #11#90 = nEuros;
     nPesetas = #11#91;     |HAZ euro;    #11#91 = nEuros;
     nPesetas = #11#92;     |HAZ euro;    #11#92 = nEuros;
     nPesetas = #11#93;     |HAZ euro;    #11#93 = nEuros;
     nPesetas = #11#94;     |HAZ euro;    #11#94 = nEuros;
     nPesetas = #11#95;     |HAZ euro;    #11#95 = nEuros;
     nPesetas = #11#96;     |HAZ euro;    #11#96 = nEuros;
     nPesetas = #11#97;     |HAZ euro;    #11#97 = nEuros;
     nPesetas = #11#98;     |HAZ euro;    #11#98 = nEuros;
     nPesetas = #11#31;     |HAZ euro;    #11#31 = nEuros;
     nPesetas = #11#99;     |HAZ euro;    #11#99 = nEuros;
     nPesetas = #11#67;     |HAZ euro;    #11#67 = nEuros;
     nPesetas = #11#68;     |HAZ euro;    #11#68 = nEuros;
     nPesetas = #11#88;     |HAZ euro;    #11#88 = nEuros;
     nPesetas = #11#101;    |HAZ euro;    #11#101 = nEuros;

     nSwitchEuro1 = 1;
|FPRC;

|PROCESO pasaaeuros_edt;
     |SI nSwitchEuro2 = 1;
          |ACABA;
     |FINSI;
     nPesetas = #14#99; |HAZ euro; #14#99 = nEuros;
     nPesetas = #14#98; |HAZ euro; #14#98 = nEuros;
     nPesetas = #14#92; |HAZ euro; #14#92 = nEuros;
     nPesetas = #14#85; |HAZ euro; #14#85 = nEuros;
     nPesetas = #14#32; |HAZ euro; #14#32 = nEuros;
     nPesetas = #14#93; |HAZ euro; #14#93 = nEuros;
     nPesetas = #14#97; |HAZ euro; #14#97 = nEuros;
     nPesetas = tot_ca_86; |HAZ euro; tot_ca_86 = nEuros;
     nPesetas = #14#80; |HAZ euro; #14#80 = nEuros;
     nPesetas = #14#87; |HAZ euro; #14#87 = nEuros;
     nPesetas = #14#88; |HAZ euro; #14#88 = nEuros;
     nPesetas = #14#82; |HAZ euro; #14#82 = nEuros;
     nPesetas = #14#81; |HAZ euro; #14#81 = nEuros;
     nPesetas = #14#119; |HAZ euro; #14#119 = nEuros;
     nPesetas = #14#121; |HAZ euro; #14#121 = nEuros;
     nPesetas = #14#16; |HAZ euro; #14#16 = nEuros;
     nPesetas = #14#111; |HAZ euro; #14#111 = nEuros;
     nPesetas = #14#112; |HAZ euro; #14#112 = nEuros;
     nPesetas = #14#113; |HAZ euro; #14#113 = nEuros;
     nPesetas = #14#14; |HAZ euro; #14#14 = nEuros;
     nPesetas = #14#23; |HAZ euro; #14#23 = nEuros;
     nPesetas = #14#25; |HAZ euro; #14#25 = nEuros;
     nPesetas = #14#27; |HAZ euro; #14#27 = nEuros;
     nPesetas = #14#148; |HAZ euro; #14#148 = nEuros;
     nPesetas = #14#150; |HAZ euro; #14#150 = nEuros;
     nPesetas = #14#28; |HAZ euro; #14#28 = nEuros;
     nPesetas = #14#83; |HAZ euro; #14#83 = nEuros;
     nPesetas = #14#147; |HAZ euro; #14#147 = nEuros;
     nPesetas = #14#31; |HAZ euro; #14#31 = nEuros;
     nPesetas = #14#89; |HAZ euro; #14#89 = nEuros;
     nPesetas = nBonifFPCont; |HAZ euro; nBonifFPCont = nEuros;
     nPesetas = #14#159; |HAZ euro; #14#159 = nEuros;
     nPesetas = #14#160; |HAZ euro; #14#160 = nEuros;
     nPesetas = #14#161; |HAZ euro; #14#161 = nEuros;
     nPesetas = #14#162; |HAZ euro; #14#162 = nEuros;
     nPesetas = #14#168; |HAZ euro; #14#168 = nEuros;
     nPesetas = #14#169; |HAZ euro; #14#169 = nEuros;
     nSwitchEuro2 = 1;
|FPRC;
____________________________________/ CARGA DE LOS DIFERENTES REGISTROS
|PROCESO actua_registro;
|ABRE #7;
    #7#0 = #6#0;         || empresa
    #7#1 = #0#2;         || nro.lote
    #7#2 = #0#5;         || indicador
|LEE 101#7=;
    FEstado = FSalida;

    #7#3 = #0#18;        || a¤o lote
    #7#4 = #0#1;         || mes
    #7#5 = ~;            || fecha envio
    #7#6 = "01.01.1900"; || fecha comprobacion
    #7#7 = "FAN";        || tipo lote

|SI FEstado = 0;    |GRABA 020#7a; |FINSI;
|SI FEstado ! 0;    |GRABA 020#7n; |FINSI;
|LIBERA #7;
|CIERRA #7;
|FPRC;

|PROCESO etf;
    clave = "ETF";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TC22";
        #3#1  = "0";
        #3#2  = "VIP2";
        #3#3  = "1";
        #3#4  = aAutorizacion;         || clave autorizacion
        #3#5  = #1#1;         || clave SILCON
        fech1 = ~;
    |HAZ fecha;
        #3#6  = for_fecha;    || fecha
    ||HAZ hora;
        #3#7  = for_hora;     || hora
        #3#8  = fichero;      || fichero
        #3#9  = extension;    || sufijo
        #3#10 = "N";          || codigo prioridad
        #3#11 = indica;       || indicador
        #3#12 = tot_emp;      || total segmentos EMP
        #3#13 = nlinea;       || total segmentos
        #3#14 = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO tfi;
|FPRC;

|PROCESO ett;
|FPRC;

|PROCESO ttt;
|FPRC;

|PROCESO tyf;
    clave = "TYF";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = #10#15;       || persona de contacto (representante empresa)
        #3#1  = #10#111;      || telefono (telefono 1)
        #3#2  = #10#112;      || fax (telefono 2)
        #3#3  = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

/*
|PROCESO dba;
    clave = "DBA";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #0#14 = "L00";
    |SI #14#99 ! 0;|O #6#7 = "S";  || si es negativo o es adeudo en cuenta
        |DDEFECTO #3;
        |SI #14#99 = 0;|Y #6#7 = "S";
                #3#0  = "C";       || solicitud adeudo en cuenta
        |SINO;
                #3#0  = " ";       || solicitud saldo acreedor
        |FINSI;
            #3#1  = #10#113;      || cuenta cliente cargo
            alfa1 = #10#10 % 101; || tipo identificador titular
        |SI alfa1 ] "0";|Y alfa1 [ "9";
                #3#2 = "1";            || tipo identificacion DNI
        |SINO;
            |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
                    #3#2 = "6";        || tipo identificacion EXTRANJERO
            |SINO;
                |SI alfa1 ] "a";|Y alfa1 [ "z";
                        #3#2 = "2";    || tipo identificacion PASAPORTE
                |SINO;
                        #3#2 = "9";    || tipo identificacion CIF
                |FINSI;
            |FINSI;
        |FINSI;
            #3#3  = #10#10;       || identificador titular (CIF EMPRESA)
            #3#4  = #10#2;        || nombre del titular (NOMBRE EMPRESA)
        |HAZ monta;
        |HAZ fin_linea;
    |SINO;
        |HAZ fin_linea2;
    |FINSI;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;
*/

|PROCESO dba;
fech1 = ~;
fech2 = "01.06.2005";
nume1 = fech1;
nume2 = fech2;
|SI nume1 ] nume2;     |ACABA;   |FINSI;     || tendria que hacer el MPG
    clave = "DBA";
|HAZ ini_linea;
||SI sw_auxil = 0;|Y #0#14 = "L00";
|SI sw_auxil = 0;
    |SI #14#99 ! 0;|O #6#7 ! "N";  || si es negativo o es adeudo en cuenta
        |DDEFECTO #3;
        #6#7 = "C";   || hasta que solo sirva el mpg
        |SI #14#99 = 0;|Y #6#7 ! "N";
                #3#0  = "C";       || solicitud adeudo en cuenta
        |SINO;
                #3#0  = " ";       || solicitud saldo acreedor
        |FINSI;
            #3#1  = #10#113;      || cuenta cliente cargo
            alfa1 = #10#10 % 101; || tipo identificador titular
        |SI alfa1 ] "0";|Y alfa1 [ "9";
                #3#2 = "1";            || tipo identificacion DNI
        |SINO;
            |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
                    #3#2 = "6";        || tipo identificacion EXTRANJERO
            |SINO;
                |SI alfa1 ] "a";|Y alfa1 [ "z";
                        #3#2 = "2";    || tipo identificacion PASAPORTE
                |SINO;
                        #3#2 = "9";    || tipo identificacion CIF
                |FINSI;
            |FINSI;
        |FINSI;
            #3#3  = #10#10;       || identificador titular (CIF EMPRESA)
            #3#4  = #10#2;        || nombre del titular (NOMBRE EMPRESA)
        |HAZ monta;
        |HAZ fin_linea;
    |SINO;
        |HAZ fin_linea2;
    |FINSI;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO mpg;
/*
fech1 = ~;
fech2 = "01.06.2005";
nume1 = fech1;
nume2 = fech2;
|SI nume1 < nume2;     |ACABA;   |FINSI;  || tendria que hacer el DBA
*/
     clave = "MPG";
     |HAZ ini_linea;
     || SI sw_auxil = 0; |Y #0#14 = "L00";
     |SI sw_auxil = 0;
         |SI #14#99 ! 0;|O #6#7 ! "N";  || si es negativo o es adeudo en cuenta
             |DDEFECTO #3;              || o pago por ventanilla
             |SI #6#7 = "S"; #6#7 = "C"; |FINSI;
             |SI #14#99 = 0;|Y #6#7 ! "N";
                     #3#0  = #6#7;      || solicitud adeudo en cuenta o ventanilla
             |SINO;
                     #3#0  = " ";       || solicitud saldo acreedor
             |FINSI;
             alfa1 = #3#0;
             |QBF alfa1;
             |SI alfa1 ! "V";           || CCC,Tipo Id. y Id. titular
               |SI aCuentaCentro = "";
                    #3#1  = #10#113;     || cuenta cliente cargo: la de la EMPRESA
               |SINO;
                    #3#1 = aCuentaCentro;
               |FINSI;
                 alfa1 = #10#10 % 101; || tipo identificador titular
                 |SI alfa1 ] "0";|Y alfa1 [ "9";
                     #3#2 = "1";            || tipo identificacion DNI
                 |SINO;
                     |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
                         #3#2 = "6";        || tipo identificacion EXTRANJERO
                     |SINO;
                         |SI alfa1 ] "a";|Y alfa1 [ "z";
                             #3#2 = "2";    || tipo identificacion PASAPORTE
                         |SINO;
                             #3#2 = "9";    || tipo identificacion CIF
                         |FINSI;
                     |FINSI;
                 |FINSI;
                 alfa1 = #10#10;
                 |QBF alfa1;
                 alfa1 = "00000000000000" + alfa1;
                 alfa1 = alfa1 % -114;
                 #3#3  = alfa1;       || identificador titular (CIF EMPRESA)
                 || lo ajusto yo con ceros por la izda pq tiene que ir ajustado
                 || asi cuando no sea pago por ventanilla y en blanco (sin ceros)
                 || cuando sea pago por ventanilla
                 alfa1 = #3#0;
                 |QBF alfa1;
                 |SI alfa1 = "";
                     #3#4  = #10#2;        || nombre del titular (NOMBRE EMPRESA)
                 |FINSI;
             |FINSI;
             |HAZ monta;
             |HAZ fin_linea;
         |SINO;
             |HAZ fin_linea2;
         |FINSI;
     |SINO;
         |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_TT_92;
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#99 ! 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "92";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#99;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_91;
     clave = "EDT";
     |HAZ ini_linea;
     swSigue = 0;
     |SI sw_auxil = 0;
          |SI #14#98 ! 0;
               swSigue = 1;
          |FINSI;
          |SI #14#98 = 0; |Y #14#99 = 0;
               swSigue = 1;
          |FINSI;
          |SI #14#98 = 0; |Y #14#99 ! 0;
               swSigue = 0;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |DDEFECTO #3;
          #3#0  = "TT";              || tipo elemento datos
          #3#1  = "91";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = #14#98;            || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_TT_30;
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "30";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#8  = "";                || signo
        nume1 = #14#87 + #14#147 + #14#83 + #14#161 - #14#89 - #14#160;
    |SI nume1 < 0;  nume1 = nume1 * -1; #3#8 = "-";   |FINSI;
        #3#7  = nume1;             || importe o cuota
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_20;
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#85 ! 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "20";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#8  = "";                || signo
        nume1 = #14#85;
    |SI nume1 < 0;  nume1 = nume1 * -1; #3#8 = "-";   |FINSI;
        #3#7  = nume1;             || importe o cuota
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_TT_10;
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;
||Y #14#32 ! 0;
    |DDEFECTO #3;
        #3#0  = "TT";              || tipo elemento datos
        #3#1  = "10";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#8  = "";                || signo
        nume1 = #14#16 + #14#25 + #14#113 + #14#169 - #14#31 - #14#159;
    |SI nume1 < 0;  nume1 = nume1 * -1; #3#8 = "-";   |FINSI;
        #3#7  = nume1;             || importe o cuota
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_90;                || recargo de mora
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#94 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "90";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#93;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#94;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#97;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_86;                || bonificaciones retroactivas
    clave = "EDT";
|HAZ ini_linea;
    tot_ca_86 = tot_ca_86 ! EURODB;
    nume1 = tot_ca_86;
|SI sw_auxil = 0;|Y nume1 ! 0;     || antes ponia el #14#104
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "86";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;             || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_80;                || bonificaciones + subvenciones
    clave = "EDT";
|HAZ ini_linea;
    nume1 = nBonifFPCont;
|SI sw_auxil = 0;|Y nume1 ! 0; |Y swBonifFPCont = 1;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "80";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;             || importe o cuota
        #3#8  = aSigno;                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_60;                || Suma de bonificaciones, deducciones, etc
    clave = "EDT";
|HAZ ini_linea;
|| nume1 = #14#31 + #14#89;           || Bonif. INEM + Reducciones
nume1 = #14#89;
|SI sw_auxil = 0;|Y nume1 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "60";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "T";               || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_57;                || CC EMPRESARIALES (MATERNIDAD)
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#147 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "57";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#28;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#145;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#147;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_53;                || base FOGASA + FP tipo EMPRESARIAL
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;
     |SI #14#162 ! 0; |O #14#161 ! 0;
         |DDEFECTO #3;
             #3#0  = "CA";              || tipo elemento datos
             #3#1  = "53";              || clave
             #3#2  = "";                || calificador clave
             #3#3  = #14#162;           || base
             #3#4  = "T";               || indicador de factor o tipo
             descom = #14#163;
             descom = 0;
         |HAZ descompone;
             #3#5  = entero;            || parte entera de tipo
             #3#6  = decima;            || parte decimal de factor o tipo
             #3#7  = #14#161;            || importe o cuota
             #3#8  = "";                || signo
             #3#9  = "";                || reservado
         |HAZ monta;
         |HAZ fin_linea;
     |SINO;
         |HAZ fin_linea2;
     |FINSI;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_52;                || base FOGASA + FP tipo TOTAL
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;
||Y #14#83 ! 0;                    || dio un error porque faltaba este segmento
    |DDEFECTO #3;                  || aunque sea cero lo pongo
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "52";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#148;           || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#149;
        descom = 0;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#83;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_51;                || base Desempleo FIJOS Y NO FIJOS EN IT
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#147 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "51";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#28;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#145;
        descom = 0;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#147;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_50;                || base Desempleo
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0; |Y #14#87 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "50";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#27;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#86;
        descom = 0;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#87;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_32;                || cuotas epigrafes IMS
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#82 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "32";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#82;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_31;                || cuotas epigrafes ILT
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#81 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "31";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#81;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_30;
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#85 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "30";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = #14#85;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_22;      || ILT enf.comun + maternidad + reducciones
    clave = "EDT";
|HAZ ini_linea;
    || nume1 = tot_cd_01 + tot_cd_02 + tot_cd_06 + tot_cd_17;
    nume1 = #14#31;
|SI sw_auxil = 0;|Y nume1 ! 0;     || antes ponia el #14#31
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "22";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = nume1;             || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_13;                || cotizacion solidaridad
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#169 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "13";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = #14#168;           || base
          #3#4  = "";                || indicador de factor o tipo
          descom = 0;
          |HAZ descompone;
          #3#5  = entero;            || parte entera de tipo
          #3#6  = decima;            || parte decimal de factor o tipo
          #3#7  = #14#169;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

/*
|PROCESO edt_CA_11;                || otros conceptos (contratos < 7 dias)
     clave = "EDT";
     |HAZ ini_linea;
     nume3 = #14#112 - tot_ba_35;            || base
     nume4 = #14#113 - tot_ca_03;            || cuota
     |SI sw_auxil = 0; |Y nume3 > 0;
          |DDEFECTO #3;
          #3#0  = "CA";                 || tipo elemento datos
          #3#1  = "11";                 || clave
          #3#2  = "006";                   || calificador clave
          #3#3  = nume3;           || base
          #3#4  = "T";                  || indicador de factor o tipo
          descom = 36;                  || el 36 %
          |HAZ descompone;
          #3#5  = entero;            || parte entera de tipo
          #3#6  = decima;            || parte decimal de factor o tipo
          #3#7  = nume4;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CA_03;                || cotizacion trabajadores ext.event.
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0; |Y tot_ca_03 ! 0;
          |DDEFECTO #3;
          #3#0  = "CA";              || tipo elemento datos
          #3#1  = "03";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = tot_ba_35;         || base
          #3#4  = "T";               || indicador de factor o tipo
          |SI #14#114 ! 0;
               descom = #14#114;
          |SINO;
               descom = 11.50;       || que remedio, no voy a liarla mas, a pelo
          |FINSI;
          |HAZ descompone;
          #3#5  = entero;            || parte entera de tipo
          #3#6  = decima;            || parte decimal de factor o tipo
          tot_ca_03 = (tot_ba_35 % descom) ! 0; || vuelvo a calcular por ajuste decim.
          #3#7  = tot_ca_03;            || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;
*/

|PROCESO edt_CA_02;                || cotizacion trabajadores NO FIJOS
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#23 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "02";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#23;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#24;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#25;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CA_01;                || cotizacion trabajadores FIJOS
    clave = "EDT";
|HAZ ini_linea;
|SI sw_auxil = 0;|Y #14#14 ! 0;
    |DDEFECTO #3;
        #3#0  = "CA";              || tipo elemento datos
        #3#1  = "01";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = #14#14;            || base
        #3#4  = "T";               || indicador de factor o tipo
        descom = #14#15;
    |HAZ descompone;
        #3#5  = entero;            || parte entera de tipo
        #3#6  = decima;            || parte decimal de factor o tipo
        #3#7  = #14#16;            || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_30;
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#160 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "30";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = #14#160;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_29;
     clave = "EDT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y #14#159 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo elemento datos
          #3#1  = "29";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = "";                || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = #14#159;           || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edt_CD_28;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_28 = tot_cd_28 ! 2;
|SI sw_auxil = 0;|Y tot_cd_28 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "28";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_28;         || importe o cuota
        #3#8  = aSigno;            || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_22;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_22 = tot_cd_22 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_22 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "22";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_22;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;
/*
|PROCESO edt_CD_18;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_18 = tot_cd_18 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_18 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "18";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_18;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;
*/
|PROCESO edt_CD_16;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_16 = tot_cd_16 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_16 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "16";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_16;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_11;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_11 = tot_cd_11 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_11 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "11";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_11;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_10;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_10 = tot_cd_10 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_10 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "10";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_10;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_07;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_07 = tot_cd_07 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_07 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "07";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_07;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|| lo que ira al EDT_CA_22

|PROCESO edt_CD_27;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_27 = tot_cd_27 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_27 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "27";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_27;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_26;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_26 = tot_cd_26 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_26 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "26";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_26;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_17;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_17 = tot_cd_17 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_17 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "17";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_17;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_CD_06;
    clave = "EDT";
|HAZ ini_linea;
    tot_cd_06 = tot_cd_06 ! EURODB;
|SI sw_auxil = 0;|Y tot_cd_06 ! 0;
    |DDEFECTO #3;
        #3#0  = "CD";              || tipo elemento datos
        #3#1  = "06";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = "";                || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = tot_cd_06;         || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_02;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_02 = tot_ba_02 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_02 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "02";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_02;         || base
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO tct;
     clave = "TCT";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "0";          || modalidad pago (normal)
          #3#1  = #11#2;        || clave entidad
          #3#2  = nro_trab;     || nro.trabajadores
          #3#3  = "";           || tipo exp.
          #3#4  = "";           || a¤o exp.
          #3#5  = "";           || referencia exp.
          #3#6  = 0;          || Fijos con jornadas reales
          #3#7  = 0;           || Event. con jornadas reales
          nume2 = nFijos + nEven;
          #3#8  = 0;           || Total trab. con jornadas reales
          #3#9  = "";              || Reservado
          #3#10  = "";             || Reservado
          #3#11 = 0;        || Total jornadas reales
          #3#12 = 0;            || total trabajadores extranjeros REA
          |SI #0#12 = "A";|O #0#12 = "T";|O #0#17 = 2;
               |SI #0#18 [ 2008;
                    #3#6  = nFijos;          || Fijos con jornadas reales
                    #3#7  = nEven;           || Event. con jornadas reales
                    nume2 = nFijos + nEven;
                    #3#8  = nume2;           || Total trab. con jornadas reales
                    #3#9  = "";              || Reservado
                    #3#10  = "";             || Reservado
                    #3#11 = nJorAlta;        || Total jornadas reales
                    #3#12 = nREA;                || total trabajadores extranjeros REA
               |FINSI;
          |FINSI;
          |SI #0#12 = "A";|O #0#12 = "T";|O #0#17 = 2;
               #3#10 = #0#10;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;
/*
|PROCESO edt_BA_35;
     clave = "EDT";
     |HAZ ini_linea;
     tot_ba_35 = tot_ba_35 ! EURODB;
     |SI sw_auxil = 0;|Y tot_ba_35 ! 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo elemento datos
          #3#1  = "35";              || clave
          #3#2  = "";                || calificador clave
          #3#3  = tot_ba_35;         || base
          #3#4  = "";                || indicador de factor o tipo
          #3#5  = "";                || parte entera de tipo
          #3#6  = "";                || parte decimal de factor o tipo
          #3#7  = "";                || importe o cuota
          #3#8  = "";                || signo
          #3#9  = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;
*/

|PROCESO edt_BA_34;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_34 = tot_ba_34 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_34 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "34";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_34;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|| lo que sumara el EDT_CA_02: el 21 que ya lo tengo y el 23

|PROCESO edt_BA_23;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_23 = tot_ba_23 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_23 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "23";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_23;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|| al EDT_CA_52 van la 01, 41, 21, 23, 30, 32, 36, 37, y la 38:

|PROCESO edt_BA_38;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_38 = tot_ba_38 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_38 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "38";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_38;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|| al EDT_CA_51 van la 21 y la 32 que las tengo mas la 36:

|PROCESO edt_BA_32;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_32 = tot_ba_32 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_32 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "32";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_32;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_42;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_42 = tot_ba_42 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_42 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "42";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_42;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_22;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_22 = tot_ba_22 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_22 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "22";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_22;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_21;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_21 = tot_ba_21 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_21 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "21";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_21;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|| al EDT_CA_50 van la 01 y la 30 que las tengo mas la 36:

|PROCESO edt_BA_36;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_36 = tot_ba_36 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_36 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "36";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_36;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|| lo que sumara el EDT_CA_01:

|PROCESO edt_BA_37;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_37 = tot_ba_37 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_37 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "37";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_37;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_41;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_41 = tot_ba_41 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_41 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "41";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_41;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_30;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_30 = tot_ba_30 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_30 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "30";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_30;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO edt_BA_01;
    clave = "EDT";
|HAZ ini_linea;
    tot_ba_01 = tot_ba_01 ! EURODB;
|SI sw_auxil = 0;|Y tot_ba_01 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo elemento datos
        #3#1  = "01";              || clave
        #3#2  = "";                || calificador clave
        #3#3  = tot_ba_01;         || base (la cogemos del auxiliar para)
        #3#4  = "";                || indicador de factor o tipo
        #3#5  = "";                || parte entera de tipo
        #3#6  = "";                || parte decimal de factor o tipo
        #3#7  = "";                || importe o cuota
        #3#8  = "";                || signo
        #3#9  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

------------------------------------------------------------------------------
                        AGRARIOS: los EDL
------------------------------------------------------------------------------
|PROCESO edl_CD_30;
     nume1 = 0;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     |SI #0#18 ] 2012;
          |SI #11#47 = "A";
               |SI eldat = 2; |Y #11#37 ! 0;
                    nume1 = #11#92;          || red. Des Enf
               |FINSI;
               |SI eldat = 4; |Y #11#82 ! 0;
                    nume1 = #11#94 + #11#96 + #11#98; || red. Des Pago Directo
               |FINSI;
               |SI eldat = 4; |Y #11#69 ! 0;
                    nume1 = #11#94 + #11#96 + #11#98; || red. Des Pago Directo
               |FINSI;
          |FINSI;
          |SI #11#47 = "E";
               |SI eldat = 2; |Y #11#37 ! 0;
                    nume1 = #11#92;          || red. Des Enf
               |FINSI;
               |SI eldat = 4; |Y #11#82 ! 0;
                    nume1 = #11#94 + #11#96 + #11#98; || red. Des Pago Directo
               |FINSI;
               |SI eldat = 4; |Y #11#69 ! 0;
                    nume1 = #11#94 + #11#96 + #11#98; || red. Des Pago Directo
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nume1 = 0; |ACABA; |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "30";              || clave compensacion reducciones
          #3#2  = " ";                 || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_29;
     nume1 = 0;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     |SI #0#18 ] 2012;
          |SI #11#47 = "A";
               |SI eldat = 1;
                    nume1 = #11#90;          || red. CC alta
               |FINSI;
               |SI eldat = 2; |Y #11#37 ! 0;
                    nume1 = #11#91;          || red. CC Enf+Acc
               |FINSI;
               |SI eldat = 4; |Y #11#82 ! 0;
                    nume1 = #11#93 + #11#95 + #11#97; || red. CC Pago Directo
               |FINSI;
               |SI eldat = 4; |Y #11#69 ! 0;
                    nume1 = #11#93 + #11#95 + #11#97; || red. CC Pago Directo
               |FINSI;
          |FINSI;
          |SI #11#47 = "E";
               |SI eldat = 1;
                    nume1 = #11#90;          || red. CC alta
               |FINSI;
               |SI eldat = 2; |Y #11#37 ! 0; || red. CC Enf+Acc
                    nume1 = #11#91;
               |FINSI;
               |SI eldat = 4; |Y #11#82 ! 0;
                    nume1 = #11#93 + #11#95 + #11#97; || red. CC Pago Directo
               |FINSI;
               |SI eldat = 4; |Y #11#69 ! 0;
                    nume1 = #11#93 + #11#95 + #11#97; || red. CC Pago Directo
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nume1 = 0; |ACABA; |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "29";              || clave compensacion reducciones
          #3#2  = " ";                 || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_28;
|ACABA;
     clave = "EDL";
     |HAZ ini_linea;
     nBase = #11#88;
     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "28";
          nume1 = #11#20 ! 0;
          #3#2  = nume1;             || elemento
          #3#3  = nBase;             || importe
          #3#4  = aSigno;            || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          ||HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada
          |SI #12#39 ! 0;
               |SI aParam = "TC2";
                    fech1 = #12#40;        || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    |HAZ lee_bonif;
                    #3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #12#40;        || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    #3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_28 = tot_cd_28 + nBase;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_27;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     |SI #0#18 [ 2010;
          |SI #11#47 ! "E"; |O #11#83 = nRedFijaMes;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #11#47 ! "E";
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #11#83 = 0; |ACABA; |FINSI;
     nume1 = 0;

     |SI eldat = 1;
          nume1 = #11#24;               || jornadas alta
          nume1 = nume1 * (nRedJorCC + nRedJorATEP);
     |FINSI;
     |SI eldat = 2; |Y #nomcontr#54 = "S";
          nume1 = #11#63 - #11#85;      || jornadas en IT
          nume1 = nume1 * nRedJorATEP;
     |FINSI;
     |SI eldat = 4; |Y #nomcontr#54 = "S";
          nume1 = #11#85;               || jornadas en IT
          nume1 = nume1 * nRedJorATEP;
     |FINSI;

     || nume1 = #11#83;
     |SI nume1 = 0; |ACABA; |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "27";              || clave compensacion reducciones
          #3#2  = " ";                 || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          tot_cd_27 = tot_cd_27 + nume1;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO AjustaReduccion;
     nDiferencia = 0;
     nTotal = 0;
     sw_eldat1 = 0;
     sw_eldat2 = 0;
     sw_eldat4 = 0;
     |SI #11#47 = "A"; |O #11#47 = "e";
          nume1 = (#11#20 - #11#33);    || dias alta
          nume1 = nume1 * (nRedFijaCC + nRedFijaATEP);
          nume1 = nume1 ! 0;
          nTotal = nTotal + nume1;
          |SI nume1 ! 0; sw_eldat1 = 1; |FINSI;

          |SI #nomcontr#54 = "S";
               nume1 = #11#33 - #11#85;      || dias IT
               nume1 = nume1 * nRedFijaATEP;
               nume1 = nume1 ! 0;
               nTotal = nTotal + nume1;
               |SI nume1 ! 0; sw_eldat2 = 1; |FINSI;

               nume1 = #11#85 * nRedFijaATEP;
               nume1 = nume1 ! 0;
               nTotal = nTotal + nume1;
               |SI nume1 ! 0; sw_eldat4 = 1; |FINSI;
          |FINSI;

          nDiferencia = #11#83 - nTotal;
     |FINSI;
|FPRC;

|PROCESO edl_CD_26;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     |SI #0#18 [ 2010;
          |SI #11#47 ! "A"; |Y #11#83 ! nRedFijaMes;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #11#47 ! "A";
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #11#83 = 0; |ACABA; |FINSI;

     nCConst = #labtraba#248;
     |HAZ constante;

     nume1 = 0;

     |SI #0#18 ] 2011;
          |HAZ AjustaReduccion;
     |FINSI;

     nume1 = 0;

     |SI eldat = 1;
          |SI #11#47 = "A"; |O #11#47 = "e";
               nume1 = (#11#20 - #11#33);    || dias alta
               nume1 = nume1 * (nRedFijaCC + nRedFijaATEP);
          |SINO;
               nume1 = nRedFijaMes;
          |FINSI;
          nume1 = nume1 ! 0;
          |SI sw_eldat1 = 1;
               nume1 = nume1 + nDiferencia;
          |FINSI;
     |FINSI;
     |SI eldat = 2; |Y #11#47 ! "E"; |Y #nomcontr#54 = "S";
          nume1 = #11#33 - #11#85;      || dias IT
          nume1 = nume1 * nRedFijaATEP;
          nume1 = nume1 ! 0;
          |SI sw_eldat2 = 1; |Y sw_eldat1 = 0;
               nume1 = nume1 + nDiferencia;
          |FINSI;
     |FINSI;
     |SI eldat = 4; |Y #11#47 ! "E"; |Y #nomcontr#54 = "S";
          nume1 = #11#85;               || dias IT
          nume1 = nume1 * nRedFijaATEP;
          nume1 = nume1 ! 0;
          |SI sw_eldat4 = 1; |Y sw_eldat1 = 0; |Y sw_eldat2 = 0;
               nume1 = nume1 + nDiferencia;
          |FINSI;
     |FINSI;

     |SI nume1 = 0; |ACABA; |FINSI;
     |SI nume1 = 0390;
          nume1 = 0387;
     |FINSI;

     || si tengo activada la reduccion en ATEP en IT, en verdad resulta que si es
     || IT todo el mes NO SERIAN 30*0.13 sino 30*0.129 y en estos casos
     || devuelven el lote. Lo dejo asi a pelo que no me fio de cambiar
     || ahora estos valores ya que es el unico caso que da problemas.
     || 98.2357 - 24.11.2010

     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "26";              || clave compensacion reducciones
          #3#2  = " ";                 || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          tot_cd_26 = tot_cd_26 + nume1;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO nombotra;
     nBonif = #nombotra#2;
     |ERROR10;
|FPRC;

|DEFBUCLE nombotra;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     ;
     NULL, nombotra;
|FIN;

|PROCESO AjustaPFE;
     nAjustePFE = 0;
     nDiasMes = 0;
     nume1 = 0;
     nDiasIT_2 = 0;

     |BUCLE nombotra;

     |SI #nombotra#2 = 110; |O #nombotra#2 = 115;   || esta bonificacion solo
     |O #nombotra#2 = 134;   || esta bonificacion solo
          nDiasIT = 0;        || tiene que ir en el segmento de alta,
     |FINSI;                  || en el de IT no

     nDiasMes = nDiasAlta + nDiasIT + nDiasMate + nDiasExp;

     |SI #11#47 = "A"; |O #11#47 = "e";
          nDiasIT_2 = #11#85;
     |FINSI;
     |SI #11#47 = "E";
          nDiasIT_2 = #11#33 / #11#63;
          nDiasIT_2 = (nDiasIT_2 * #11#85) ! 0;
     |FINSI;

     |SI nDiasMes > 30;
          nAjustePFE = 1;
     |FINSI;
     |SI nDiasMes ] 28; |Y #0#1 = 2;
          |SI nDiasMes = 28;
               nAjustePFE = -2;
          |FINSI;
          |SI nDiasMes = 29;
               nAjustePFE = -1;
          |FINSI;
     |FINSI;
     |SI eldat = 1;
          nDias = nDiasAlta;
/*
          |SI #11#24 = 0;
               nDias = 0;
          |FINSI;
*/
     |FINSI;
     |SI eldat = 2;
          nDias = nDiasIT + nDiasExp;
          nDias = nDias - nDiasIT_2;
/*
          |SI #11#24 = 0; |Y #11#65 = 0;     || si no tengo jornadas en alta
               nDias = nDiasMes;             || ni vacaciones, para la propor-
          |FINSI;                            || cion de dias bonificados todo
          |SI #11#63 = 0;                    || tiene que salir en IT
               nDias = 0;
          |FINSI;
*/
     |FINSI;
     |SI eldat = 3;
          nDias = nDiasMate;
          |SI #11#65 = 0;
               nDias = 0;
          |FINSI;
     |FINSI;
     |SI eldat = 4;
          nDias = nDiasIT_2;
          |SI #11#85 = 0;
               nDias = 0;
          |FINSI;
     |FINSI;
     |SI nAjustePFE ! 0;
          nDiasMes = nDiasMes - nAjustePFE;
     |FINSI;

     |SI eldat = 1;
          nume1 = nDiasIT + nDiasMate + nDiasExp;
          |SI nDias > 0; |Y nume1 = 0;
               |SI nAjustePFE ! 0;
                    nDias = nDias - nAjustePFE;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI eldat = 2;
          nume1 = nDiasIT + nDiasExp - nDiasIT_2;
          |SI nAjustePFE ! 0; |Y nume1 > 0;
               nDias = nDias - nAjustePFE;
          |FINSI;
     |FINSI;
     |SI eldat = 3;
          nume1 = nDiasMate;
          |SI nAjustePFE ! 0; |Y nume1 > 0;
               nDias = nDias - nAjustePFE;
          |FINSI;
     |FINSI;
     |SI eldat = 4;
          nume1 = nDiasIT_2;
          |SI nAjustePFE ! 0; |Y nume1 > 0;
               nDias = nDias - nAjustePFE;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO edl_CD_22;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;

     nBase = #11#73;
     |HAZ AjustaPFE;

     nBase = nBase / 100;
     nBase = (((nBase / nDiasMes) ! 2) * nDias) ! 2;
     nBase = (nBase * 100);

     |SI nBase < 0; nBase = 0; |FINSI;
     |SI sw_auxil = 0;|Y nBase ! 0; |Y nDias ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "22";
          nume1 = #11#20 ! 0;

          |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
               #3#2  = 0;             || elemento
          |SINO;
               #3#2  = nume1;             || elemento
          |FINSI;

          #3#3  = nBase;             || importe
          #3#4  = "";                || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          ||HAZ fechas_bonif;
          #3#9  = "";                || referencia asociada

          |ABRE #nombotra;

          nBonif = 0;
          |BUCLE nombotra;

          |SI nBonif ! 0;
               |SI aParam = "TC2";
                    fech1 = #nombotra#4;     || se guarda la fecha para el TC2
                    |HAZ fechaTC2;
                    #3#6 = for_fecha;
               |SINO;
                    ||HAZ lee_bonif;
                    ||#3#5  = "3";           || tipo de resolucion (bonificacion)
                    fech1 = #nombotra#4;     || fecha resolucion (bonificacion)
                    |HAZ fecha;
                    #3#6  = for_fecha;
                    ||#3#9  = #13#2;         || referencia asociada
               |FINSI;
          |FINSI;
          |SI aParam = "TC2";
               #3#9  = aEpiTc2;       || se guarda el epigrafe para el TC2
          |FINSI;
          #3#10 = "";                || reservado
          tot_cd_22 = tot_cd_22 + nBase;
          tottracd22 = tottracd22 + nBase;

          nume4 = #11#73 - tottracd22;
          |SI nume4 ! 0; |Y nume4 ] -25; |Y nume4 [ 25;
          || se habran provocado diferencias
               nBase = nBase + nume4;
               #3#3  = nBase;
               tot_cd_22 = tot_cd_22 + nume4;
          |FINSI;
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_17;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     nume1 = 0;

     |SI eldat = 1; |Y #11#25 ! 0; nume1 = reducc;  |FINSI;
     |SI eldat = 2; |Y #11#37 ! 0; nume1 = reduccb; |FINSI;
     ||SI eldat = 4; |Y #11#25 = 0; |Y #11#37 = 0; |Y #11#82 ! 0; nume1 = reducc + reduccb; |FINSI;
     |SI eldat = 4; nume1 = reducce; |FINSI;
     |SI sw_auxil = 0;|Y nume1 ! 0; |Y swbon_65 = 1;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "17";              || clave compensacion reducciones
          tot_cd_17 = tot_cd_17 + nume1;
          nume2 = #11#20 ! 0;
          #3#2  = " ";               || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          |SI #12#39 ! 0;
               |HAZ lee_bonif;
               #3#5  = "3";           || tipo de resolucion (bonificacion)
               fech1 = #12#40;        || fecha resolucion (bonificacion)
               |HAZ fecha;
               #3#6  = for_fecha;
               #3#9  = #13#2;         || referencia asociada
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_16;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     nume1 = 0;
     |SI eldat = 1; |Y #11#25 ! 0; nume1 = bon_60; |FINSI;
     |SI eldat = 2; |Y #11#25 = 0; |Y #11#37 ! 0; nume1 = bon_60; |FINSI;
     |SI eldat = 4; |Y #11#25 = 0; |Y #11#37 = 0; |Y #11#82 ! 0; nume1 = bon_60; |FINSI;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "16";              || clave compensacion reducciones
          tot_cd_16 = tot_cd_16 + nume1;
          nume2 = #11#20 ! 0;
          ||#3#2  = nume2;             || elemento
          #3#2  = " ";                 || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "R.D.Ley 16/2001"; || referencia asociada
          |HAZ fecha_bon_16;
          fech1 = fecha_bon_16;  || fecha resolucion (subvencion)
          |HAZ fecha;
          #3#6  = for_fecha;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_11;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y sub85dis ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "11";              || clave compensacion reducciones
          tot_cd_11 = tot_cd_11 + sub85dis;
          nume1 = #20#101;
          #3#2  = nume1;             || elemento
          #3#3  = sub85dis;          || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          |SI #12#39 ! 0;
               |HAZ lee_bonif;
               #3#5  = "3";           || tipo de resolucion (bonificacion)
               fech1 = #12#40;        || fecha resolucion (bonificacion)
               |HAZ fecha;
               #3#6  = for_fecha;
               #3#9  = #13#2;         || referencia asociada
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_10;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0;|Y sub85pre ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "10";              || clave compensacion reducciones
          tot_cd_10 = tot_cd_10 + sub85pre;
          nume1 = #20#101;
          #3#2  = nume1;             || elemento
          #3#3  = sub85pre;          || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          |SI #12#39 ! 0;
               |HAZ lee_bonif;
               #3#5  = "3";           || tipo de resolucion (bonificacion)
               fech1 = #12#40;        || fecha resolucion (bonificacion)
               |HAZ fecha;
               #3#6  = for_fecha;
               #3#9  = #13#2;         || referencia asociada
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_07;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     nume1 = 0;
     |SI #0#18 ] 2012;
          |SI eldat = 1; |Y #11#25 ! 0; nume1 = bonifi;  |FINSI;
          |SI eldat = 2; |Y #11#37 ! 0; nume1 = bonifib; |FINSI;
          |SI eldat = 4; |Y #11#25 = 0; |Y #11#37 = 0; |Y #11#82 ! 0; nume1 = bonifi + bonifib; |FINSI;
     |SINO;
          |SI eldat = 1; nume1 = bonifi;  |FINSI;
          |SI eldat = 2; nume1 = bonifib; |FINSI;
     |FINSI;
     |SI sw_auxil = 0;|Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "07";              || clave compensacion reducciones
          tot_cd_07 = tot_cd_07 + nume1;
          nume2 = #11#20 ! 0;
          #3#2  = " ";             || elemento
          ||#3#2  = nume2;             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          |SI #12#39 ! 0;
               |HAZ lee_bonif;
               #3#5  = "3";           || tipo de resolucion (bonificacion)
               fech1 = #12#40;        || fecha resolucion (bonificacion)
               |HAZ fecha;
               #3#6  = for_fecha;
               #3#9  = #13#2;         || referencia asociada
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_CD_06;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     nume1 = 0;
     |SI eldat = 1; |Y #11#25 ! 0; nume1 = reducc;  |FINSI;
     |SI eldat = 2; |Y #11#37 ! 0; nume1 = reduccb; |FINSI;
     |SI eldat = 4; |Y #11#25 = 0; |Y #11#37 = 0; |Y #11#82 ! 0; nume1 = reducc + reduccb; |FINSI;
     |SI sw_auxil = 0;|Y nume1 ! 0; |Y swbon_65 ! 1;
          |DDEFECTO #3;
          #3#0  = "CD";              || tipo de elemento de datos
          #3#1  = "06";              || clave compensacion reducciones
          tot_cd_06 = tot_cd_06 + nume1;
          nume2 = #11#20 ! 0;
          #3#2  = " ";               || elemento
          ||#3#2  = nume2;             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo resolucion
          #3#6  = "        ";        || fecha resolucion (fecha parte medico)
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          |SI #12#39 ! 0;
               |HAZ lee_bonif;
               #3#5  = "3";           || tipo de resolucion (bonificacion)
               fech1 = #12#40;        || fecha resolucion (bonificacion)
               |HAZ fecha;
               #3#6  = for_fecha;
               #3#9  = #13#2;         || referencia asociada
          |FINSI;
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_34;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     |SI #11#47 = "A"; || sistema General NO
          |ACABA;
     |FINSI;

    clave = "EDL";
|HAZ ini_linea;
    nume1 = 0;
|SI eldat = 3; nume1 = #11#66;   |FINSI;        || base AT/EP alta
|SI nume1 < 0; nume1 = 0;     |FINSI;

|SI eldat = 3;|Y sw_dat3 = 0; nume1 = 0;     |FINSI;   || si no ha grabado el dat

|SI sw_auxil = 0;|Y nume1 ! 0;
    |DDEFECTO #3;
        #3#0  = "BA";              || tipo de elemento de datos
        #3#1  = "34";              || clave bases AT y EP
        #3#2  = "000";             || elemento
        #3#3  = nume1;             || importe
        #3#4  = " ";               || signo (reservado)
        #3#5  = " ";               || tipo de resolucion
        #3#6  = "        ";        || fecha resolucion
        #3#7  = "        ";        || inicio periodo
        #3#8  = "        ";        || fin periodo
        #3#9  = "";                || referencia asociada
        #3#10 = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
        tot_ba_34 = tot_ba_34 + nume1;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;


|PROCESO edl_BA_38;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     |SI #0#18 ] 2012;        || obsoleto, aunque de momento no lo quito
          |ACABA;
     |FINSI;

     |SI eldat = 2; nume1 = #11#37 - #11#82; |FINSI;
     |SI eldat = 4; nume1 = #11#82; |FINSI;
     |SI nume1 = 0; |O #nomconst#12 ! 0;
          |ACABA;
     |FINSI;
     clave = "EDL";                  || Fogasa
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "38";              || clave bases conting.comunes
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_38 = tot_ba_38 + nume1;
      |SINO;
          |HAZ fin_linea2;
      |FINSI;
|FPRC;

|PROCESO edl_BA_36;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     nume1 = #11#37 - #11#82;
     |SI #11#47 ! "E"; |O nume1 = 0; |O #nomconst#12 = 0;
          |ACABA;
     |FINSI;
     clave = "EDL";                  || Base IT / maternidad no fijos
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "36";              || clave bases conting.comunes
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_36 = tot_ba_36 + nume1;
      |SINO;
          |HAZ fin_linea2;
      |FINSI;
|FPRC;

|PROCESO edl_BA_32;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     nume1 = #11#82;
     |SI #11#47 ! "E"; |O nume1 = 0; |O #nomconst#12 = 0;
          |ACABA;
     |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "32";              || clave bases conting.comunes
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_32 = tot_ba_32 + nume1;
      |SINO;
          |HAZ fin_linea2;
      |FINSI;
|FPRC;

|PROCESO edl_BA_37;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     |SI #11#25 = 0; |O #nomconst#12 ! 0;
          |ACABA;
          || POR JORNADAS REALES, EXCLUIDOS DESEMPLEO
     |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0;               || Base Cont. Comunes Fijos
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "37";              || clave bases conting.comunes
          #3#2  = "000";             || elemento
          #3#3  = #11#25;            || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_37 = tot_ba_37 + #11#25;
      |SINO;
          |HAZ fin_linea2;
      |FINSI;
|FPRC;

|PROCESO edl_BA_30;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;
     |SI #11#25 = 0; |O #nomconst#12 = 0;
          |ACABA;
          || POR JORNADAS REALES, CON DESEMPLEO
     |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     |SI sw_auxil = 0;               || Base Cont. Comunes Fijos
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "30";              || clave bases conting.comunes
          #3#2  = "000";             || elemento
          #3#3  = #11#25;            || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_30 = tot_ba_30 + #11#25;
      |SINO;
          |HAZ fin_linea2;
      |FINSI;
|FPRC;

|PROCESO edl_BA_23;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;

     nume1 = #11#37 - #11#82;
     |SI sw_auxil = 0; |Y nume1 ! 0; |Y #nomconst#12 ! 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "23";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_23 = tot_ba_23 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_22;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     swSigue = 0;
     |SI #0#18 ] 2012;
          nume1 = #11#99;
          nume1 = nume1 + #11#68;
          |SI sw_auxil = 0; |Y nume1 ! 0;
               swSigue = 1;
          |FINSI;
     |SINO;
          nume1 = #11#82;
          |SI sw_auxil = 0; |Y nume1 ! 0; |Y #nomconst#12 ! 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1; |Y swbon_65 ! 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "22";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_22 = tot_ba_22 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_21;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     nume1 = #11#82;
     nume1 = nume1 + #11#67;
     swSigue = 0;
     |SI #0#18 ] 2012;
          |SI sw_auxil = 0; |Y nume1 ! 0;
               swSigue = 1;
          |FINSI;
     |SINO;
          |SI sw_auxil = 0; |Y nume1 ! 0; |Y #nomconst#12 ! 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "21";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_21 = tot_ba_21 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_42;
     |SI eldat ! 1;
          |SI #0#18 < 2012;
               |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
          |FINSI;
     |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     nume1 = 0;

     |SI eldat = 1; nume1 = #11#27;     |FINSI;        || base AT/EP alta
     |SI eldat = 2; nume1 = #11#31;     |FINSI;        || base AT/EP IT
     |SI eldat = 4; nume1 = #11#82;     |FINSI;        || base AT/EP Emp IT

     |SI nume1 < 0; nume1 = 0;     |FINSI;

     |SI sw_auxil = 0;|Y nume1 ! 0; |Y swbon_65 = 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "42";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_42 = tot_ba_42 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_02;
     |SI eldat ! 1;
          |SI #0#18 < 2012;
               |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
          |FINSI;
     |FINSI;
     clave = "EDL";
     |HAZ ini_linea;
     nume1 = 0;
     |SI #0#18 ] 2012;
          |SI eldat = 1; nume1 = #11#27;     |FINSI;        || base AT/EP alta
          |SI eldat = 2; nume1 = #11#31;     |FINSI;        || base AT/EP IT
     |SINO;
          |SI eldat = 1; nume1 = #11#27;     |FINSI;        || base AT/EP alta
          |SI #11#47 = "A"; |O #11#47 = "e";
               |SI eldat = 2; nume1 = #11#84 * (#11#33 - #11#85);     |FINSI;        || base AT/EP baja
               |SI eldat = 4; nume1 = #11#84 * #11#85;     |FINSI;        || base AT/EP baja
          |FINSI;
          |SI #11#47 = "E";
               |SI eldat = 2;
                    nume1 = #11#63 - #11#85;      || jornadas en IT
                    nume1 = nume1 * #11#84;
               |FINSI;
               |SI eldat = 4;
                    || el campo 86 es el equivalente al swAjuste3
                    nume1 = #11#85;      || jornadas en IT
                    |SI #11#63 > 30; |Y #11#84 = 10554;
                         nume1 = nume1 - 1;
                    |FINSI;
                    nume1 = nume1 * #11#84;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nume1 < 0; nume1 = 0;     |FINSI;
/*
     |SI eldat = 1;|Y sw_dat1 = 0; nume1 = 0;     |FINSI;   || si no ha grabado
     |SI eldat = 2;|Y sw_dat2 = 0; nume1 = 0;     |FINSI;   ||/el dat
*/

     |SI sw_auxil = 0;|Y nume1 ! 0; |Y swbon_65 ! 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "02";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_02 = tot_ba_02 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_41;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     |SI eldat = 1; nume1 = #11#25; |FINSI;
     |SI sw_auxil = 0; |Y nume1 ! 0; |Y #nomconst#12 = 0;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "41";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_41 = tot_ba_41 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO edl_BA_01;
     |SI #0#18 < 2012;
          |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
     |FINSI;

     clave = "EDL";
     |HAZ ini_linea;
     |SI #0#18 ] 2012;
          |SI eldat = 1; nume1 = #11#25;     |FINSI;        || base AT/EP alta
          |SI eldat = 2; nume1 = #11#37;     |FINSI;        || base AT/EP alta
     |SINO;
          |SI eldat = 1; nume1 = #11#25; |FINSI;
     |FINSI;
     swSigue = 0;
     |SI #0#18 [ 2011;
          |SI sw_auxil = 0; |Y nume1 ! 0; |Y #nomconst#12 ! 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI #0#18 ] 2012;
          |SI sw_auxil = 0; |Y nume1 ! 0;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |DDEFECTO #3;
          #3#0  = "BA";              || tipo de elemento de datos
          #3#1  = "01";              || clave bases AT y EP
          #3#2  = "000";             || elemento
          #3#3  = nume1;             || importe
          #3#4  = " ";               || signo (reservado)
          #3#5  = " ";               || tipo de resolucion
          #3#6  = "        ";        || fecha resolucion
          #3#7  = "        ";        || inicio periodo
          #3#8  = "        ";        || fin periodo
          #3#9  = "";                || referencia asociada
          #3#10 = "";                || reservado
          |HAZ monta;
          |HAZ fin_linea;
          tot_ba_01 = tot_ba_01 + nume1;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO CodigosNuevos;
     aContrato = #labtraba#45;
     |QBF aContrato;
     aContrato = ("000" + aContrato) % -103;
     |ABRE #nomequiv;
     #nomequiv#0 = aContrato;
     |LEE 000#nomequiv.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
               aContrato = #nomequiv#2;      || tiempo parcial
          |SINO;
               aContrato = #nomequiv#1;      || tiempo completo
          |FINSI;
     |FINSI;
     |CIERRA #nomequiv;
     nContrato = aContrato;
|FPRC;

|PROCESO datos_trab;
     |ABRE #12;
     #12#0 = #11#0;
     #12#1 = #11#39;
     |LEE 000#12=;
     |HAZ CodigosNuevos;
     |CIERRA #12;
|FPRC;

|PROCESO lee_bonif;
|HAZ datos_trab;
|DDEFECTO #13;
|ABRE #13;
    #13#0 = #12#39;
|LEE 000#13=;
|CIERRA #13;
|FPRC;

|PROCESO BonifFPCont;
     |SI #labempre#127 = 0;        || si hay recargo de mora no se bonifica
          |SI #14#118 = "X";
               swBonifFPCont = 1;
               nBonifFPCont = #14#167;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO calcula_bonif;
     bonifi = 0;
     bonifib = 0;
     reducc = 0;
     reduccb = 0;
     reducce = 0;
     subven = 0;
     sub85pre = 0;
     sub85dis = 0;
     reduc0502 = 0;
     reduc0502b = 0;
     bon_60 = 0;
     swbon_65 = 0;

     |SI #11#48 < 10;
          |ABRE #20;
          #20#0 = #11#0;
          #20#1 = #11#39;
          #20#2 = #0#1;
          #20#3 = #11#48;       || TENER EN CUENTA PA CUANDO VENGA DEL HISTORICO
          |SI #0#12 = "H";
               nNume2 = #0#3 - 2000;
               #20#66 = nNume2;
               nNume1 = 81;
          |SINO;
               nNume1 = 81;
          |FINSI;
          |LEE 000#20=;                 || lee calculos cabs.
          |SI FSalida = 0;
               |SI #20#63 ! 0;|O #20#64 ! 0;|O #20nNume1 ! 0; |O #20#99 ! 0;  || si tiene bonificacion
                    |HAZ lee_bonif;                           || lee la bonificacion
                    |SI #12#39 ! 0;
                         aClaveTGSS = #13#13;
                         |QBF aClaveTGSS;
                         aClaveTGSS = "000" + aClaveTGSS;
                         aClaveTGSS = aClaveTGSS % -103;
                         |SI #13#10 = 1;
                              |SI aClaveTGSS ! "018";
                                   reducc = #20#63 + #20nNume1 - #20#56;
                                   || reduccb = #20#56 + #20nNume1;
                                   reduccb = #20#56;
                              |SINO;
                                   reduc0502 = #20#63 - #20#56;  || parte en alta
                                   reduc0502b = #20#56;          || parte en baja
                              |FINSI;
                         |FINSI;
                         |SI #13#10 = 2;
                              bonifi = #20#63 + #20nNume1 - #20#56;
                              || bonifib = #20#56 + #20nNume1;
                              bonifib = #20#56;
                         |FINSI;
                         |SI #13#10 = 3; |O #13#10 = 4;
                              reducc = #20#63 + #20nNume1 - #20#56;
                              reduccb = #20#56;
                              |SI #13#10 = 4;
                                   swbon_65 = 1;
                                   nNume = reducc;
                                   ||reducc = (#11#25 % (#nombonif#4 + #nombonif#6)) ! 2;
                                   ||reduccb = (#11#37 % (#nombonif#4 + #nombonif#6)) ! 2;
                                   reducc = ((#11#25 % #nombonif#4) ! 2) + ((#11#25 % #nombonif#6) ! 2);
                                   reduccb = ((#11#37 % #nombonif#4) ! 2) + ((#11#37 % #nombonif#6) ! 2);
                                   reducce = (#11#82 % #nombonif#4) ! 2;
                              |FINSI;
                         |FINSI;
                         |SI #20#9 = 85; |O #20#9 = 97; |O #20#9 = 421;  || formacion teorica
                              |SI #13#12 > 5;  || precio hora 8 euros pres., 5 dist
                                   sub85pre = #20#64;
                              |SINO;
                                   sub85dis = #20#64;
                              |FINSI;
                         |SINO;
                              subven = #20#64;
                         |FINSI;
                    |FINSI;
                    /*
                    |SI #20#93 ! 0;      || importe cuota bonif maternidad
                    || esta parte distinta de la del i_2ytc2: ha de ser asi
                         |SI #12#39 = 0;      || si solo hay maternidad,
                              bonifi = 0;    || que la bonif no salga
                         |FINSI;             || negativa
                          bonifib = bonifib + #20#93;
                    |FINSI;
                    */
               |FINSI;
               |SI #20#92 ! 0;      || mayores de 60 a¤os y 5 de antiguedad
                    bon_60 = #20#92;
               |FINSI;
               |SI #20#99 ! 0;      || mayores de 59 a¤os y 4 de antiguedad
                    reducc = reducc + #20#99;
               |FINSI;
          |SINO;
               alfa1 = "    Calculo:["+#20#0+"]["+#20#1+"]["+#20#2+"]["+#20#3+"] inexistente ...";
               |MENAV alfa1;
          |FINSI;
          |CIERRA #20;
     |SINO;
          |MENAV "0000Inconsistencia. Exp.Regul.Empleo Agrarios.";
     |FINSI;
|FPRC;

|PROCESO totalitos1;
     |SI #11#24 ! 0;          || hay jornadas reales trabajadas
          |SI #11#47 ! "E";   || es un fijo
               nFijos = nFijos + 1;
          |SINO;              || es un eventual
               nEven = nEven + 1;
          |FINSI;
          |SI #11#70 > 0;     || hay base fija cot en TC: extranjero REA
               nREA = nREA + 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO totalitos2;
     nJorAlta = nJorAlta + #11#24;
|FPRC;

|PROCESO datos_mes;
     |HAZ calcula_bonif;
     |HAZ BonifFPCont;
     |HAZ pasaaeuros_edl;

     nDiasAlta = 0;
     nDiasMate = 0;
     nDiasExp = 0;
     nDiasIT = 0;
     tottracd22 = 0;
     nEquivDias = 0;

     |HAZ ulti_dia;
     |HAZ dias_alta_2;

     |PARA eldat = 1; |SI eldat [ 4; |HACIENDO eldat = eldat + 1;
          |SI #11#47 = "A"; |O #11#47 = "e";      || COTIZACION GENERAL
               |SI eldat = 1;
                    |HAZ dat;
                    |HAZ edl_BA_01;       || cc, des, fog con desempleo
                    |SI #0#18 [ 2011;
                         |HAZ edl_BA_41;       || cc, fog excluidos desempleo
                    |FINSI;
                    |HAZ edl_BA_02;       || AT y EP
                    |HAZ edl_BA_42;       || AT y EP mayores 65 a¤os exencion cuotas
               |FINSI;

               |SI eldat = 2;
                    |HAZ dat;
                    |SI #0#18 ] 2012;
                         |HAZ edl_BA_01;       || cc, des, fog con desempleo
                    |SINO;
                         |HAZ edl_BA_23;       || fog excluidos desempleo en IT
                    |FINSI;
                    |HAZ edl_BA_02;       || AT y EP
                    |HAZ edl_BA_42;       || AT y EP mayores 65 a¤os exencion cuotas
                    |HAZ edl_BA_38;       || fog excluidos desempleo en IT
               |FINSI;

               |SI eldat = 4;
                    |HAZ dat;
                    |HAZ edl_BA_21;       || des, fog con desempleo en IT
                    |SI #0#18 ] 2012;
                         |HAZ edl_BA_22;
                         |HAZ edl_BA_42;       || AT y EP mayores 65 a¤os exencion cuotas
                    |SINO;
                         |HAZ edl_BA_02;       || AT y EP
                         |HAZ edl_BA_38;       || fog excluidos desempleo en IT
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI #11#47 = "E";          || COTIZACION POR JORNADAS
               |SI eldat = 1;
                    |HAZ dat;
                    |SI #0#18 ] 2012;
                         |HAZ edl_BA_01;       || cc, des, fog con desempleo
                    |SINO;
                         |HAZ edl_BA_30;       || cc, des, fog con desempleo
                         |HAZ edl_BA_37;       || cc, fog excluidos desempleo
                    |FINSI;
                    |HAZ edl_BA_02;       || AT y EP
               |FINSI;

               |SI eldat = 2;
                    |HAZ dat;
                    |SI #0#18 ] 2012;
                         |HAZ edl_BA_01;
                    |SINO;
                         |HAZ edl_BA_36;       || des, fog con desempleo en IT, dias 1-15
                         |HAZ edl_BA_38;       || fog excluidos desempleo en IT
                    |FINSI;
                    |HAZ edl_BA_02;       || AT y EP
               |FINSI;

               |SI eldat = 4;
                    |HAZ dat;
                    |HAZ edl_BA_21;       || des, fog con desempleo en IT
                    |SI #0#18 ] 2012;
                         |HAZ edl_BA_22;
                    |SINO;
                         |HAZ edl_BA_32;       || AT y EP
                         |HAZ edl_BA_38;       || fog excluidos desempleo en IT
                    |FINSI;
                    |HAZ edl_BA_02;       || AT y EP
               |FINSI;
          |FINSI;

          |SI eldat = 1; |O eldat = 2; |O eldat = 4;
               |HAZ edl_CD_06;           || reducciones
               |HAZ edl_CD_07;           || bonificaciones
               |HAZ edl_CD_10;           || form.teorica presencial
               |HAZ edl_CD_11;           || form.teorica a distancia
               |HAZ edl_CD_16;       || reduccion mayores 60 a¤os y mas de 5 de antiguedad
               |HAZ edl_CD_17;       || reduccion mayores 60 a¤os y mas de 5 de antiguedad
               ||HAZ edl_CD_18;       || reduccion desempleo familiares
               |HAZ edl_CD_22;       || bonif PFE
               |HAZ edl_CD_26;       || bonif fija
               |HAZ edl_CD_27;       || bonif fija
               |SI eldat = 4;
                    |HAZ edl_CD_28;
               |FINSI;
               |SI #0#18 ] 2012;
                    |HAZ edl_CD_29;       || reduccion CC
                    |SI eldat ! 1;
                         |HAZ edl_CD_30;       || reduccion Desempleo solo en IT
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI eldat = 3;
               |HAZ dat;
               |HAZ edl_BA_34;       || vacaciones (cotiza solo AT y EP)
          |FINSI;

          |SI #0#12 ! "A";         || en atrasos no hay total de jornadas reales
               |HAZ totalitos2;
          |FINSI;
     |SIGUE;
|FPRC;
------------------------------------------------------------------------------
                         || FIN PROCESOS AGRARIOS
------------------------------------------------------------------------------

|PROCESO dias_alta_2;
     |PARA eldat = 1; |SI eldat [ 3; |HACIENDO eldat = eldat + 1;
          |SI eldat = 1;
               d_alta = (#11#20 ! 0) - (#11#43 + #11#44 + #11#49);   || dias alta
               nume1 = #11#43 + #11#44 + #11#49;
               |SI dat_mes = 2; |Y nume1 = 28;     || febrero, todo el mes en IT
                    d_alta = 0;   || a la fuerza
               |FINSI;
               nDiasAlta = d_alta;
          |FINSI;
          |SI eldat = 2;
               |SI aParam ! "TC2";
                    d_alta = #11#43 + #11#44;                    || dias IT
               |SINO;
                    d_alta = #11#43 + #11#44 + #11#49;
               |FINSI;
               nume1 = d_alta;  |HAZ liquidados;
               d_alta = nume1;
               nDiasIT = d_alta;
          |FINSI;
          |SI eldat = 3;
               d_alta = #11#49;                                      || dias mater
               nume1 = d_alta;  |HAZ liquidados;
               d_alta = nume1;
               nDiasMate = d_alta;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dias_alta;
     |SI eldat = 1;
          d_alta = (#11#20 ! 0) - (#11#43 + #11#44 + #11#49);   || dias alta
     |FINSI;
|SI eldat = 2;
    |SI aParam ! "TC2";
        d_alta = #11#43 + #11#44;                    || dias IT
    |SINO;
        d_alta = #11#43 + #11#44 + #11#49;
    |FINSI;
        nume1 = d_alta;  |HAZ liquidados;
        d_alta = nume1;
|FINSI;
|SI eldat = 3;
        d_alta = #11#49;                                      || dias mater
        nume1 = d_alta;  |HAZ liquidados;
        d_alta = nume1;
|FINSI;
|SI d_alta < 0;|O d_alta = 0;
        d_alta = 0;
|FINSI;
|SI #11#22 = 87; |O #11#22 = 97; |O #11#22 = 85; |O #11#22 = 421;
     d_alta = #11#20 ! 0;     || aprendices sin cotizacion al 126!
|FINSI;
|SI #12#42 = "X"; |O #12#42 = "T"; |O #12#42 = "P"; |O #12#42 = "I";
     |HAZ t_parcial;                  || si es tiempo parcial o irregular
|SINO;                                || cotizan por horas, se pone en el EDL
     ind_cot = " ";                   || si no, cotizan normal
|FINSI;

|SI #0#17 = 2;                || en finiquitos buscamos dias de alta d cada
     d_alta = dias_finiq;     || mes y proporcionamos la base
|FINSI;

|SI nSwDiasCero = 0;
     |SI d_alta = 0;
          d_alta = 1;
          nSwDiasCero = 1;
     |FINSI;
|SINO;
     d_alta = d_alta - 1;
     nSwDiasCero = 0;
     |SI d_alta [ 0;
          d_alta = d_alta + 1;     || cambio manual, si procede
     |FINSI;
|FINSI;

|FPRC;

|PROCESO t_parcial;
     |SI eldat = 1;
          d_alta = #11#24 - ((#11#33 * #12#47) ! 0);  || horas en alta
     |FINSI;
     |SI eldat = 2; |O eldat = 3;
          d_alta = (#11#33 * #12#47) ! 0;  || horas en IT
     |FINSI;

||     d_alta = #11#24;   || Horas cotizadas del nomtrtc2
     ind_cot = "H";     || Indicador cotizacion  de los de t. parcial
|FPRC;

|PROCESO BuscaDisca;
     |ABRE #nomir003;
     #nomir003#0 = #labtraba#7;         || nif
     #nomir003#40 = #0#0;               || ejercicio
     #nomir003#41 = #labtraba#0;        || empresa
     |LEE 000#nomir003.=;
     |SI FSalida = 0;
          |SI #nomir003#6 = "S";
               #3#25  = "D";                   || Indicadores de discapacidad
          |FINSI;
     |FINSI;
     |CIERRA #nomir003;
|FPRC;

|PROCESO PFETP;
     swSigue = 0;

     |BUCLE nombotra;

     || aAlfa1 = #labtraba#36;
     aAlfa1 = #nombotra#4;
     aAlfa2 = "08.03.2009";
     fFecha1 = aAlfa1;
     fFecha2 = aAlfa2;
     |SI fFecha1 < fFecha2;
          |SI #0#0 [ 2009;
               |SI #0#0 = 2009;
                    |SI #0#1 [ 4;
                         swSigue = 1;
                    |FINSI;
               |SINO;
                     swSigue = 1;
               |FINSI;
          |FINSI;
          |SI swSigue = 1;
               |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
                    |SI #labtraba#234 > 0; |Y #labtraba#234 < 10;
                         #3#16 = "3";
                    |FINSI;
                    |SI #labtraba#234 ] 10; |Y #labtraba#234 < 20;
                         #3#16 = "2";
                    |FINSI;
                    |SI #labtraba#234 ] 20; |Y #labtraba#234 < 30;
                         #3#16 = "1";
                    |FINSI;
                    |SI #labtraba#234 ] 30;
                         #3#16 = "4";
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO dat;
     |SI eldat ! 1;
          |SI #0#18 < 2012;
               |SI #0#12 = "A"; |ACABA; |FINSI; || en atrasos NO
          |FINSI;
     |FINSI;
     |SI eldat = 3;           || VACACIONES COTIZADAS
          |SI #11#47 = "A"; || sistema General NO
               |ACABA;
          |FINSI;
     |FINSI;

     clave = "DAT";
     |HAZ ini_linea;

     nCConst = #labtraba#248;
     |HAZ constante;

     |SI eldat = 1;           || base CC
          |SI #11#47 = "A"; |O #11#47 = "e";
               nume1 = #11#20 - #11#33;      || dias alta
          |SINO;
               nume1 = #11#24;               || jornadas alta
               |SI #0#12 = "A";
                    || atrasos, jornadas alta pero sin base de cotiz. por pasarse
                    || del maximo (por ejemplo)
                    nNume = #11#25 + #11#27;
                    |SI nNume = 0;
                         nume1 = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
          nume2 = #11#25;
     |FINSI;
     |SI eldat = 2;      || base IT
          |SI #11#47 = "A"; |O #11#47 = "e";
               nume1 = #11#33 - #11#85;      || dias IT
          |SINO;
               nume1 = #11#63 - #11#85;      || jornadas en IT
          |FINSI;
          |SI #0#12 = "A"; |Y #11#31 = 0; |Y #11#37 = 0;
               || ATRASOS, base de it es cero, aunque haya dias, aqui no
               || debe salir nada en el DAT, ya que debe ser por alguna
               || IT por la que no se cotiza (ITs de que vienen del a¤o
               || anterior por ejemplo)
               nume1 = 0;
          |FINSI;
          nume2 = #11#37;
     |FINSI;
     |SI eldat = 3;      || base vacaciones
          nume1 = #11#66;
          nume2 = #11#65;
     |FINSI;
     |SI eldat = 4;      || base pago directo SS
          nume1 = #11#85 + #11#69;
          |SI #0#12 = "A"; |Y #11#82 = 0; |Y #11#67 = 0;
               nume1 = 0;
          |FINSI;
     |FINSI;
     |SI sw_auxil = 0; |Y nume1 ! 0;
          |DDEFECTO #3;
          #3#0  = "0";                  || indicador
          #3#1  = dat_mes;              || mes TC2
          #3#2  = " ";                  || huelga parcial (NO)
          #3#3  = " ";                  || pluriempleo
          #3#3  = " ";                    || pluriempleo (NO)
          |SI #12#237 = "S";
               #3#3  = "P";                || pluriempleo SI
          |FINSI;
          #3#4  = " ";                  || sin reduccion
          ||migue
          |SI #0#18 [ 2009;
               |SI #20#65 > 0; |Y eldat = 2;
                    #3#4 = "D";    || maternidad tiempo completo
                    |SI #20#110 > 0;
                         #3#4 = "I";    || Control IT
                    |FINSI;
               |FINSI;
          |SINO;
               |SI eldat = 2;
                    #3#4 = "I"; || indica IT (enfermedad o accidente)
               |FINSI;
               |SI eldat = 4;
                    |SI #11#49 > 0;
                         |SI #20#110 > 0;
                              #3#4 = "I"; || indica Control IT
                         |SINO;
                              #3#4 = "D"; || indica maternidad tiempo completo
                         |FINSI;
                    |SINO;
                         |SI #11#69 = 0;
                              #3#4 = "I"; || indica IT (enfermedad o accidente)
                         |SINO;
                              || no pinto nada, es un ERE
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          #3#5  = " ";                  || modalidad salario
          #3#6 = " ";                  || alta sin retribucion
          #3#7 = " ";                  || otros
          |SI eldat = 4; |Y #11#69 ! 0;     || indicador dias/jorn. ERE
               #3#7 = "T";
          |FINSI;
          |SI #12#112 ! "S";
               #3#8  = " ";             || contrato inferior a 7 dias NO
          |SINO;
               #3#8  = "C";             || contrato inferior a 7 dias SI
          |FINSI;
          |SI #0#17 = 2;
               #3#9  = dias_finiq;
          |SINO;
               #3#9  = nume1;                || cotizacion (dias o jornadas en alta)
          |FINSI;
          |SI #12#42 = "e"; |Y #11#70 > 0; |Y eldat = 1;
               |HAZ ulti_dia;
               |SI #11#20 ! 30;   || no estoy de alta el mes completo
                    nume2 = (#11#20 - #11#33); || dias trabajados
               |SINO;
                    |SI #11#33 > 0;  || estoy de alta el mes completo pero tengo IT
                         nume2 = (topemes - #11#33); || dias trabajados
                    |SINO;         || mes completo sin IT
                         nume2 = topemes;
                    |FINSI;
               |FINSI;
               #3#10 = nume2;
          |SINO;
               |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
                    |SI #11#73 > 0;
                         || soy tiempo parcial y estoy bonificado por el RDL 05/2006
                         #3#10 = #11#20; || he de poner aqui los dias en alta
                    |SINO;
                         #3#10 = "  ";
                    |FINSI;
               |SINO;
                    #3#10 = "  ";
               |FINSI;
          |FINSI;
          #3#11 = ind_cot;              || indicador cotizacion
          #3#12 = " ";                    || reservado
          #3#13 = "0";                    || clave dias normales
          |SI #12#42 = "C";|O #12#42 = "F";
               #3#13 = "4";          || citricos (Regimen 911)
          |FINSI;
          #3#14 = "  ";                   || especificos
          #3#15 = "  ";                             || reservado
          #3#16 = "";
          |SI #11#73 > 0;
               |HAZ PFETP;
          |FINSI;
          #3#17 = #12#33;                           || grupo cotizacion
          #3#18 = "   ";                            || categoria
          |SI #11#101 ! 0;
               #3#18 = "S  ";                        || reservado
          |FINSI;
          |SI #11#74 = 9999;
              #3#18 = "J  ";           || Sistema Nacional Garantia Juvenil
          |FINSI;

          #3#19 = " ";                              || indicador procedencia.
                    || contratos jubilacion parcial parcial, paso de momento
          aContrato = #11#22;
          |HAZ CodigosNuevos;
          #11#22 = aContrato;
          #3#20 = #11#22;                           || clave contrato
          |SI #0#18 [ 2006;
               |SI #11#26 > 499; #11#26 = #11#26 - 500; |FINSI;
               || lo del parchecito para epigrafes raros (> 500)
               |SI eldat = 1;  #3#21 = #11#26;     |FINSI;   || epigrafe normal
               |SI eldat = 2;  #3#21 = 126;        |FINSI;   || epigrafe IT (126)
               |SI eldat = 3;  #3#21 = #11#26;     |FINSI;   || epigrafe normal(vac)
          |SINO;
               |SI #0#18 [ 2009;
                    |SI eldat = 1; |O eldat = 3;
                         |SI #11#26 > 900;
                              #3#23 = #labtraba#204;
                         |FINSI;
                    |FINSI;
                    |SI eldat = 2; |O eldat = 4;
                         #3#23 = "c";
                    |FINSI;
               |SINO;
                    |SI #11#26 > 900;
                         #3#23 = #labtraba#204;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #labtraba#42 = "A"; |O #labtraba#42 = "e";
               #3#24 = "G";
          |SINO;
               #3#24 = "J";
          |FINSI;
          #3#25 = " ";                   || Indicadores de discapacidad
          |HAZ BuscaDisca;

          #3#26  = "";                    || Indicador de Relacion Laboral
          |SI #labtraba#122 ! " ";
               |SI #labtraba#122 = "1"; #3#26  = "0100"; |FINSI;
               |SI #labtraba#122 = "2"; #3#26  = "0409"; |FINSI;
               |SI #labtraba#122 = "3"; #3#26  = "0900"; |FINSI;
          |FINSI;
          #3#27  = "";                    || Colectivo peculiaridad cotizacion
          |SI #11#74 > 0;
               #3#27 = #11#74;
               |SI #11#74 = 9999;  || Sistema nacional garantia juvenil
                    #3#27 = "";
               |FINSI;
          |FINSI;
          |SI #11#74 = 3141; |Y reduccb = 0; |Y eldat ! 1;
               #3#27 = "";
          |FINSI;

          #3#28  = #11#77;                || Informacion complementaria RED
          |SI #nomconst#12 = 0;
               #3#29  = "N";                 || excluido de cotizar en desempleo
          |SINO;
               #3#29  = "";                  || Reservado
          |FINSI;
/*
          |SI eldat = 1;   sw_dat1 = 1;   |FINSI;
          |SI eldat = 2;   sw_dat2 = 1;   |FINSI;
          |SI eldat = 3;   sw_dat3 = 1;   |FINSI;
*/
          |HAZ monta;
          |HAZ fin_linea;
     |SINO;
          |HAZ fin_linea2;
     |FINSI;
|FPRC;

|PROCESO ayn;
    clave = "AYN";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
     aCadena = #labtraba#2;
     |HAZ SeparaNom_plb;
     apell1 = eaApel1;
     apell2 = eaApel2;
     nombre = eaNom;
     aAbreviado = (apell1 % 102) + (apell2 % 102) + (nombre % 101);
     aAbreviado = aAbreviado > aAbreviado;
        #3#0  = apell1;            || primer apellido
        #3#1  = apell2;            || segundo apellido
        #3#2  = nombre;            || nombre
        #3#3  = aAbreviado;        || reservado
        #3#4  = "";                || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO TipoID;
     alfa1 = #12#7 % 101;
     alfa2 = #12#7;
     |QBF alfa2;
     alfa2 = alfa2 % -101;

     |SI alfa1 ] "A"; |Y alfa1 [ "z";
          |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
               |SI alfa2 ] "A"; |Y alfa2 [ "z";
                    #3#2 = "6";                  || tipo identif.(EXTRANJERO)
                    #3#3 = "   ";                || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |SINO;
                    #3#2 = "2";                  || tipo identif.(PASAPORTE)
                    #3#3 = #12#76 % 103;         || pais emisor
                    #3#7 = #12#76 % 103;         || nacionalidad
               |FINSI;
          |SINO;
               #3#2 = "2";                  || tipo identif.(PASAPORTE)
               #3#3 = #12#76 % 103;         || pais emisor
               #3#7 = #12#76 % 103;         || nacionalidad
          |FINSI;
     |FINSI;
     |SI #nomcontr#40 = 2;
          |SI #3#2 = "6";
               aAlfa = #12#7;
               |QBF aAlfa;
               aAlfa1 = aAlfa % 101;
               aAlfa = aAlfa - aAlfa1;
               alfa6 = aAlfa % 0;
               long = alfa6;
               |SI long ! 9;
                    aAlfa = aAlfa1 + "0" + aAlfa;
               |SINO;
                    aAlfa = aAlfa1 + aAlfa;
               |FINSI;
               #12#7 = aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tra;
    clave = "TRA";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = #12#75 % 102;                || provincia NAFSS
        #3#1  = #12#75 % 3;                  || numero NAFSS
        #3#2  = "1";                         || tipo identificador (DNI)
        |HAZ TipoID;
        #3#3  = "000";                       || pais (espa¤a)
        #3#4  = #12#7;                       || DNI
        #3#5  = #12#77;                      || rot.control (cod.centro)
    |HAZ cta_cotizacion;
        #3#6  = descto;                      || rot.control (des.centro)
        #3#7  = "";                          || nacionalidad (reserv.afiliac.)
        #3#8  = "";                          || indicadores (reserv.afiliac.)
        #3#9  = "";                          || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO exc;
|FPRC;

|PROCESO rzs;
    clave = "RZS";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "0";          || indicador razon social (siempre 0)
        #3#1  = #6#4;         || tipo alfab. empresario
        #3#2  = #10#2;        || razon social
        #3#3  = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO BuscaCCCEmp;
     |ABRE #gomccchi;
     #gomccchi#0 = #11#0;
     #gomccchi#1 = 00;
     |LEE 000#gomccchi.=;
     |SI FSalida = 0;
          |SI #0#18 [ 2011;
               #10#13 = #gomccchi#2;
          |FINSI;
     |FINSI;
     |CIERRA #gomccchi;
|FPRC;

|PROCESO emp;
    clave = "EMP";
|HAZ ini_linea;
|SI sw_auxil = 0;
        linea_EMP = linea;
        tot_emp = tot_emp + 1;
    |DDEFECTO #3;
        #3#0  = aRegimen;          || RRSS

        #3#1  = cta_co % 102;      || provincia
        #3#2  = cta_co % 309;      || nro.cta.cotizacion
        alfa1 = #10#10 % 101;
    |SI alfa1 ] "0";|Y alfa1 [ "9";
            #3#3 = "1";            || tipo identificacion DNI
    |SINO;
        |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";
                #3#3 = "6";        || tipo identificacion EXTRANJERO
        |SINO;
            |SI alfa1 ] "a";|Y alfa1 [ "z";
                    #3#3 = "2";    || tipo identificacion PASAPORTE
            |SINO;
                    #3#3 = "9";    || tipo identificacion CIF
            |FINSI;
        |FINSI;
    |FINSI;
        #3#4  = #6#3;              || pais
        #3#5  = #10#10;            || nro.identif.empresario
    |SI aParam ! "TC2";
            #3#6  = "";            || calif.cod.empresario
    |SINO;
            #3#6  = #14#117;       || guarda si es abreviado el TC2
    |FINSI;

     nRegimen = #6#2;
     |SI #0#18 [ 2011; |Y nRegimen = 0163;
          nRegimen = 0613;
     |FINSI;
     |SI #0#18 ] 2012; |Y nRegimen = 0613;
          nRegimen = 0163;
     |FINSI;
     #3#7 = nRegimen;              || RRSS principal

        |HAZ BuscaCCCEmp;
        #3#8  = #10#13 % 102;      || provincia principal
        #3#9  = #10#13 % 309;      || nro.cta.cotizacion principal
        #3#10 = #0#18;             || a¤o lote
        #3#11 = #0#1;              || desde mes
        |SI #0#17 = 2; #3#11 = 1; |FINSI;    || en finiquitos periodo es desde enero
        #3#12 = #0#13;             || hasta mes
        #3#13 = #0#14;     || calificador liquidacion (normal)
    |SI #0#9 = "T"; #3#14 = "0";   |FINSI;  || liquidacion (total en plazo)
    |SI #0#9 = "O"; #3#14 = "1";   |FINSI;  || liquidacion (obrera en plazo)
    |SI #0#9 = "P"; #3#14 = "2";   |FINSI;  || liquidacion (patronal en plazo)
    |SI aParam ! "TC2";
            #3#15 = "";                 || libre usuario
            #3#16 = "";
    |SINO;
            #3#15 = aLibre;             || centro (para el TC2)
            #3#16 = aReser;             || centro especial (para el TC2)
    |FINSI;
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO inm;
|FPRC;

|VARIABLES;
     nHBase = 0;
     nHDeci = 0;
     nHRest = 0;
     aHCara = "";
     aHCade = "";
|FIN;

|PROCESO PasaHexaResto;
     |SI nHRest [ 9;
          aHCara = nHRest;
     |SINO;
          nHRest = nHRest + 55;
          aHCara = &nHRest;
     |FINSI;
|FPRC;

|PROCESO PasaHexa;
     aHCade = "";
     |PARA; |SI nHDeci ] nHBase; |HACIENDO;
          nHRest = nHDeci $ nHBase;
          nHDeci = ((nHDeci - nHRest) / nHBase);
          |HAZ PasaHexaResto;
          aHCade = aHCara + aHCade;
     |SIGUE;
     nHRest = nHDeci;
     |HAZ PasaHexaResto;
     aHCade = aHCara + aHCade;
|FPRC;

|PROCESO ulti_dia11;     || halla el ultimo dia del mes
    nume2 = 0;
    nume1 = #0#0 $ 4;    || a¤o historico
|SI nume1 = 0;|Y #36#9 = "S";
        nume2 = 1;
|FINSI;

    topemes = 31;
|SI ult11 = 2;
        topemes = 28 + nume2;
|FINSI;
|SI ult11 = 4;|O ult11 = 6;|O ult11 = 9;|O ult11 = 11;
        topemes = 30;
|FINSI;
|FPRC;

|PROCESO BoniExpediente_T_11;
     nPorBon = 0;
     |SI #19#63 ! 0;      nPorBon = #19#124;   |FINSI;
     |SI #19#123 ! 0;     nPorBon = #19#125;   |FINSI;

     |DDEFECTO #nomepigr;
     |ABRE #nomepigr;
     #nomepigr#0 = #labtraba#32;
     |LEE 000#nomepigr.=;
     epig_ilt = #nomepigr#1;
     epig_ims = #nomepigr#2;
     |CIERRA #nomepigr;

     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = #labtraba#32;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0;
          epig_ilt = #nomepitr#3;
          epig_ims = #nomepitr#4;
     |FINSI;
     |CIERRA #nomepitr;

     nCConst = #labtraba#248;
     |HAZ constante;
/*
     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;

     |DDEFECTO #nomcones;
     |ABRE #nomcones;
     #nomcones#0 = #labempre#32;
     |LEE 000#nomcones.=;
     |CIERRA #nomcones;
*/
     por1_cont = #nomconst#7;
     por1_dfpg = #nomconst#13 + #nomconst#15 + #nomconst#17 + #nomconst#19;
     ||SI #21#9 = 64;    por1_cont = por1_cont * #nomcones#21;   |FINSI;
     ||SI #21#9 = 65;    por1_cont = por1_cont * #nomcones#22;   |FINSI;
     por1_cont = por1_cont ! 2;

     bon_0 = #19#119 * #labtraba#242;         || base CC
     bon_3 = #19#119 * #labtraba#242;         || base CP
     bon_5 = 0;

     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;

     base_A = ((bon_0 % #nombonif#4)!EURODB) % nPorBon;
     base_A = base_A ! EURODB;
     base_B = ((bon_3 % #nombonif#5)!EURODB) % nPorBon;
     base_B = base_B ! EURODB;
     |SI #nombonif#8 = "S";
          zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
          zbase_9 = zbase_9 ! EURODB;
          zbase_9 = zbase_9 + (bon_5 % (#nomconst#3 + #nomconst#4));
          zbase_9 = zbase_9 ! EURODB;
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;
     |FINSI;
     base_F = base_A + base_B + base_C;

     #19#63 = base_F;
     #19#123 = 0;
|FPRC;

|PROCESO tipo_T_meses_11;          || expedientes de regulacion
|SALVA_DATOS #11;
|HAZ iniswitch;
|SI #19#119 ! 0;|Y #19#9 ! 87;|Y #19#9 ! 97;|Y #19#9 ! 85;
    #11#20 = #19#119;           || dias en alta
    #11#25 = #11#20 * #12#242;  || base contin. comunes
    #11#26 = #22#2;             || epigrafe (126)
    #11#27 = #11#25;            || base contin. profes.
    |SI #19#124 ! 0;            || si tiene bonificacion
        |HAZ lee_bonif;
        |HAZ BoniExpediente_T_11;
        |SI #13#10 = 1;  reducc = #19#63 + #19#123;    |FINSI;
        |SI #13#10 = 2;  bonifi = #19#63 + #19#123;    |FINSI;
        |SI #13#10 = 3;  reducc = #19#63 + #19#123;    |FINSI;
    |FINSI;
    |SI #19#130 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
        bon_60 = #19#130;
    |FINSI;
    dat_mes = #19#2;
    |HAZ datos_mes;
|FINSI;

|REPON_DATOS #11;
|FPRC;

|PROCESO tipo_T_meses_10;          || normales
|SALVA_DATOS #11;
||SI nPEnf = -1;
        nPEnf = #19#35;
        nPAcc = #19#36;
||FINSI;
|HAZ iniswitch;
    #11#20 = #19#8;      || dias en alta
    #11#22 = #19#9;      || tipo de contrato
    #11#24 = #19#11;     || horas contrato
    #11#25 = #19#39 - #19#62;     || base CC
    #11#26 = #12#32;     || epigrafe

|SI #19#65 ! 0;|Y #11#22 ! 87;|Y #11#22 ! 97;|Y #11#22 ! 85;
        ult11 = #19#2;   |HAZ ulti_dia11;
        nume1 = #19#65;  |HAZ liquidados;
        nume4 = #19#62;  || me quedo con base IT original por si me hace falta
        #19#62 = nPAcc * nume1;              || recalcula base ILT
        #11#27 = #19#40 - #19#62;      || base CP

        #11#61 = nPEnf * nume1;
        #11#62 = nPAcc * nume1;

        #11#25 = #11#25 + (nPEnf * nume1);  || maternidad
        #11#27 = #11#27 + (nPAcc * nume1);
        dias_enfmat = #19#31 + #19#65;       || dias enf + dias mat
        |SI dias_enfmat ] topemes;
            #11#27 = 0;       || parche gordo: si esta todo el mes entre
            #19#62 = nume4;   || maternidad y enfermedad,la base CP es cero
        |FINSI;               || y uso como base IT la q me guarde antes
|SINO;
        #11#27 = #19#40 - #19#62;      || base CP
    |SI #11#27 < 0;
            #19#62 = #19#62 + #11#27;
            #11#27 = 0;
    |FINSI;
    |SI s_ori = "T";
        #11#61 = 0; #11#62 = 0;    || se supone que si no tengo mater
    |FINSI;
|FINSI;
    #11#28 = #19#41;               || base horas 1
    #11#29 = #19#42;               || base horas 2

    #11#32 = #19#57;                    || dto. enfermedad
    #11#33 = #19#31 + #19#32 + #19#65;  || dias enfer.acci.mater.

    || los dias de ILT se desglosan usando los campos
    || desde/hasta informativos
    #11#43 = #19#31;     || enfermedad comun
    #11#44 = #19#32;     || accidente trabajo
    #11#49 = #19#65;     || maternidad

    #11#34 = #19#58;     || dto. acc.trabajo
    #11#35 = #19#12;     || codigo bonificacion
    #11#36 = #22#2;      || epigrafe enfermedad

    #11#31 = #19#62;     || base ILT
    #11#37 = #19#62;     || base ILT

    #11#59 = nPEnf;      || promedio enfermedad
    #11#60 = nPAcc;      || promedio accidente
    #11#63 = #19#55;     || jornadas en baja

|SI #19#65 ! 0;
        ult11 = #19#2;   |HAZ ulti_dia11;
        nume1 = #19#65;  |HAZ liquidados;
        bcomun = (nPEnf * nume1) % #22#7;
        bprofe = (nPAcc * nume1) % (#22#13 + #22#15 + #22#17 + #22#19);
        bcomun = bcomun ! EURODB;
        bprofe = bprofe ! EURODB;
     ||   #19#55 = bcomun + bprofe;  || reduccion por maternidad
|SINO;
     #11#46 = "";
|FINSI;                            || (usa un campo inhibido del nomcalca)

|PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;

    |SI #19nume1 = "M";       || parche de AGIRED para maternidad
            #11#46 = #19#55;  || (usa el campo 'LITERAL ATRASOS')
    |FINSI;
|SIGUE;
    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    bon_60 = 0;
    swbon_65 = 0;

|SI #19#63 ! 0;|O #19#64 ! 0;|O #19#123 ! 0;|O #19#130 ! 0;   || si tiene bonificacion
    |HAZ lee_bonif;                            || lee la bonificacion
    |SI #13#10 = 1; reducc = #19#63 + #19#123;    |FINSI;
    |SI #13#10 = 2; bonifi = #19#63 + #19#123;    |FINSI;
    |SI #13#10 = 3; reducc = #19#63 + #19#123;    |FINSI;
    |SI #13#10 = 4;  reducc = #19#63 + #19#123; swbon_65 = 1;    |FINSI;
    |SI #19#9 = 85;|O #19#9 = 97;   || formacion teorica
        |SI #13#12 > 400;           || precio hora
                sub85pre = #19#64;
        |SINO;
                sub85dis = #19#64;
        |FINSI;
    |SINO;
            subven = #19#64;
    |FINSI;
    |SI #19#130 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
        bon_60 = #19#130;
    |FINSI;
|FINSI;

    dat_mes = #19#2;
|HAZ datos_mes;

|REPON_DATOS #11;
|FPRC;

|PROCESO tipo_T_meses_1;
|SI s_pas [ 3; |HAZ tipo_T_meses_10;    |FINSI;
|SI s_pas ] 4; |HAZ tipo_T_meses_11;    |FINSI;
|FPRC;

|DEFBUCLE tipo_T_meses;
 #19#1;
 ;
 #11#0, #11#39, any_hist, #0#1,  #0#17;
 #11#0, #11#39, any_hist, #0#13, #0#17;
 ;
 NULL, tipo_T_meses_1;
|FIN;

|PROCESO BoniExpediente_A_11;
     nPorBon = 0;
     |SI #21#63 ! 0;     nPorBon = #21#82;   |FINSI;
     |SI #21#81 ! 0;     nPorBon = #21#83;   |FINSI;

     |DDEFECTO #nomepigr;
     |ABRE #nomepigr;
     #nomepigr#0 = #labtraba#32;
     |LEE 000#nomepigr.=;
     epig_ilt = #nomepigr#1;
     epig_ims = #nomepigr#2;
     |CIERRA #nomepigr;

     |ABRE #nomepitr;
     #nomepitr#0 = #labtraba#0;
     #nomepitr#1 = #labtraba#1;
     #nomepitr#2 = #labtraba#32;
     |LEE 000#nomepitr.=;
     |SI FSalida = 0;
          epig_ilt = #nomepitr#3;
          epig_ims = #nomepitr#4;
     |FINSI;
     |CIERRA #nomepitr;

     nCConst = #labtraba#248;
     |HAZ constante;
/*
     CodigoCons = #labempre#32;
     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;|Y #nomtraca#3 ! 0;
          CodigoCons = #nomtraca#3;
     |FINSI;
     |CIERRA #nomtraca;

     |DDEFECTO #nomconst;
     |ABRE #nomconst;
     #nomconst#0 = CodigoCons;
     |LEE 000#nomconst.=;
     |CIERRA #nomconst;

     |DDEFECTO #nomcones;
     |ABRE #nomcones;
     #nomcones#0 = #labempre#32;
     |LEE 000#nomcones.=;
     |CIERRA #nomcones;
*/
     por1_cont = #nomconst#7;
     por1_dfpg = #nomconst#13 + #nomconst#15 + #nomconst#17 + #nomconst#19;
     ||SI #21#9 = 64;    por1_cont = por1_cont * #nomcones#21;   |FINSI;
     ||SI #21#9 = 65;    por1_cont = por1_cont * #nomcones#22;   |FINSI;
     por1_cont = por1_cont ! 2;

     bon_0 = #21#78 * #labtraba#242;         || base CC
     bon_3 = #21#78 * #labtraba#242;         || base CP
     bon_5 = 0;

     base_A = 0;
     base_B = 0;
     base_C = 0;
     base_F = 0;

     base_A = ((bon_0 % #nombonif#4)!EURODB) % nPorBon;
     base_A = base_A ! EURODB;
     base_B = ((bon_3 % #nombonif#5)!EURODB) % nPorBon;
     base_B = base_B ! EURODB;
     |SI #nombonif#8 = "S";
          zbase_9 = (bon_3 - bon_5) % (epig_ilt + epig_ims);
          zbase_9 = zbase_9 ! EURODB;
          zbase_9 = zbase_9 + (bon_5 % (#nomconst#3 + #nomconst#4));
          zbase_9 = zbase_9 ! EURODB;
          base_C = zbase_9 % nPorBon;
          base_C = base_C ! EURODB;
     |FINSI;
     base_F = base_A + base_B + base_C;

     #21#63 = base_F;
     #21#81 = 0;
|FPRC;

|PROCESO tipo_A_meses_11;
|SALVA_DATOS #11;
|HAZ iniswitch;
|SI #21#78 ! 0;|Y #21#9 ! 87;|Y #21#9 ! 97;|Y #21#9 ! 85;|O #21#88 ! 0;
    #11#20 = #21#78;            || dias en alta
    #11#25 = #11#20 * #12#242;  || base contin. comunes
    |SI #0#18 [ 2009;
         |SI #0#18 [ 2006;
              #11#26 = #22#2;             || epigrafe (126)
         |SINO;
              #11#26 = 904;             || epigrafe (126)
         |FINSI;
    |SINO;
         |HAZ VerifCNAE;
         #11#26 = nEpigConv;
    |FINSI;
    #11#27 = #22#37 + #22#38;
    || #11#27 = #11#25;            || base contin. profes.
    |SI #21#82 ! 0;             || si tiene bonificacion
        |HAZ lee_bonif;
        |HAZ BoniExpediente_A_11;
        |SI #13#10 = 1;  reducc = #21#63 + #21#81;     |FINSI;
        |SI #13#10 = 2;  bonifi = #21#63 + #21#81;     |FINSI;
        |SI #13#10 = 3;  reducc = #21#63 + #21#81;     |FINSI;
    |FINSI;
    |SI #21#88 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
        bon_60 = #21#88;
    |FINSI;
    dat_mes = #21#2;
    |HAZ datos_mes;
|FINSI;

|REPON_DATOS #11;
|FPRC;

|PROCESO CompModulo2;
     swNoAjuste3 = 0;
     |SI dat_mes = 2;
          |PARA para1 = 27; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
               |SI #20para1 = "E"; |O #20para1 = "A"; |O #20para1 = "M"; |O #20para1 = "D";
                    desde = para1 - 8;
                    hasta = para1 - 4;
                    |SI #20hasta = topemes; |O #20hasta ! 0
                         swNoAjuste3 = 1;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO modulo2;
     || este proceso se crea para controlar el tema de la opcion "3" en el
     || control de la aplicacion en el calculo de Dias de IT
     || solo si no soy diario, estoy en un mes de 31 dias y tengo parte en IT
     || esta copiado del i_nomcal3, donde hay uno igual, si se cambia algo
     || tenerlo en cuenta por si alli hace falta

     || aqui en agrarios solo para atrasos, de momento, en el proceso normal
     || se ajustan los dias en el i_2ytc2

     nume1 = #0#0 $ 4;
     |SI nume1 = 0;
          bisiesto = 1;
     |FINSI;

     swAjuste3 = 0;
     swNoAjuste3 = 0;
     nume1 = #21#31 + #21#32 + #21#65;  || dias enfer.acci.mater.
     |SI #36#17 = 3;
          swSigue = 0;
          |SI #labtraba#42 = "A";
               swSigue = 1;
          |FINSI;
          |SI dat_mes = 2;                 || esto surge porque en paternidad
               |SI #20#65 = #20#118; |Y #20#118 > 0;     || de ningun modo puedo estar mas
                    swSigue = 0;        || de los dias estipulados (13)
               |FINSI;                  || con lo que no puedo ajustar en
          |FINSI;                       || febrero a¤adiendo dias a la pat
          |SI swSigue = 1;
               |SI nume1 ! 0; |Y #11#20 ] 30;
               || todo el mes en alta y alguna IT, asi en agrarios atrasos
               || de momento

               ||Y #11#41 [ 1; |Y nume2 ] topemes; |Y swNoAjuste3 = 0;
                    |SI dat_mes ! 4; |Y dat_mes ! 6; |Y dat_mes ! 9; |Y dat_mes ! 11;
                         ult11 = dat_mes; |HAZ ulti_dia11;
                         |SI dat_mes ! 2;
                              swAjuste3 = 1;
                         |SINO;
                              swAjuste3 = -2 + bisiesto;
                         |FINSI;
                    |FINSI;
               |FINSI;
/*
                         |SI eldat = 2;
                              || no en caso de enf o acc todo el mes
                              nume1 = #11#43 + #11#44 + #11#49;
                              |SI nume1 < dia_2; || (total dias IT < dias lab. mes)
                                   |SI #11#49 = 0;
                                        || si tengo mat, le quito el dia luego a
                                        || la mat
                                        d_alta = d_alta - swAjuste3;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                         |SI eldat = 3;
                              || no en caso de baja todo el mes
                              nume1 = #11#43 + #11#44 + #11#49;
                              |SI nume1 < dia_2; || (dias baja < dias labor. mes)
                                   d_alta = d_alta - swAjuste3;
                                   || a ver, vuelvo a quitar esto,si soy enf. y mat.
                                   || el mismo mes con todo el mes de IT ya le he
                                   || quitado antes el dia a la enf
                              |SINO;    || salvo que sea por enf. y mat.
                                   nume3 = #11#43 + #11#49;
                                   |SI nume3 ] dia_2; |Y #11#43 > 0; |Y #11#49 > 0;
                                        d_alta = d_alta - swAjuste3;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
*/
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipo_A_meses_10;
     |SALVA_DATOS #11;
     nPEnf = #21#35;
     nPAcc = #21#36;
     |HAZ iniswitch;

    #11#20 = #21#8;      || dias en alta
    #11#22 = #21#9;      || tipo de contrato
    #11#24 = #21#11;     || horas contrato
    #11#25 = #21#39 - #21#62 + #21#117;              || base CC
    |SI #0#18 [ 2006;
          nEpigConv = #12#32;
    |SINO;
          |HAZ VerifCNAE;
    |FINSI;
    #11#26 = nEpigConv;     || epigrafe
    || ¨por que estaba esto asi? 26-05-2016
    || #11#27 = #21#37 + #21#38;
    #11#27 = #21#40 - #21#62 + #21#117;

    #11#28 = #21#41;               || base horas 1
    #11#29 = #21#42;               || base horas 2
    #11#32 = #21#57;                    || dto. enfermedad

    || los dias de ILT se desglosan usando los campos
    || desde/hasta informativos
    #11#43 = #21#31;     || enfermedad comun
    #11#44 = #21#32;     || accidente trabajo
    #11#49 = #21#65;     || maternidad
     #11#33 = #21#31 + #21#32 + #21#65;  || dias enfer.acci.mater.
     dat_mes = #21#2;
     |HAZ modulo2;
     |SI swAjuste3 ! 0;
          #11#33 = #11#33 - swAjuste3;
     |FINSI;
    #11#34 = #21#58;     || dto. acc.trabajo
    #11#35 = #21#12;     || codigo bonificacion
    #11#36 = #22#2;      || epigrafe enfermedad

    #11#31 = #21#62 - #21#115;     || base ILT
    #11#37 = #21#62 - #21#115;     || base ILT

    #11#63 = #21#55;     || jornadas en baja
    #11#59 = nPEnf;      || promedio enfermedad
    #11#60 = nPAcc;      || promedio accidente

|SI #21#65 ! 0;
        ult11 = #21#2;   |HAZ ulti_dia11;
        nume1 = #21#65;  |HAZ liquidados;
        bcomun = (nPEnf * nume1) % #22#7;
        bprofe = (nPAcc * nume1) % (#22#13 + #22#15 + #22#17 + #22#19);
        bcomun = bcomun ! EURODB;
        bprofe = bprofe ! EURODB;
        || #21#55 = bcomun + bprofe;  || reduccion por maternidad
|SINO;
     #11#46 = "";
|FINSI;                            || (usa un campo inhibido del nomcalca)

|PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;

    |SI #21nume1 = "M";       || parche de AGIRED para maternidad
            #11#46 = #21#55;  || (usa el campo 'LITERAL ATRASOS')
    |FINSI;
|SIGUE;
     #11#67 = 0;
     #11#82 = #21#115;
     #11#85 = #21#114;
     #11#87 = #21#124;
     #11#99 = #21#134;

     #11#90 = #21#148;
     #11#91 = #21#149;
     #11#92 = #21#150;

     #11#93 = #21#151;
     #11#94 = #21#152;
     #11#95 = #21#153;
     #11#96 = #21#154;
     #11#97 = #21#157;
     #11#98 = #21#158;

    bonifi = 0;
    reducc = 0;
    subven = 0;
    sub85pre = 0;
    sub85dis = 0;
    bon_60 = 0;
    swbon_65 = 0;

|SI #21#63 ! 0;|O #21#64 ! 0;|O #21#81 ! 0;|O #21#88 ! 0;   || si tiene bonificacion
    |HAZ lee_bonif;                           || lee la bonificacion
    |SI #13#10 = 1; reducc = #21#63 + #21#81;     |FINSI;
    |SI #13#10 = 2; bonifi = #21#63 + #21#81;     |FINSI;
    |SI #13#10 = 3; reducc = #21#63 + #21#81;     |FINSI;
    |SI #13#10 = 4; reducc = #21#63 + #21#81; swbon_65 = 1;    |FINSI;
    |SI #21#9 = 85;|O #21#9 = 97;   || formacion teorica
        |SI #13#12 > 400;           || precio hora
                sub85pre = #21#64;
        |SINO;
                sub85dis = #21#64;
        |FINSI;
    |SINO;
            subven = #21#64;
    |FINSI;
    |SI #21#88 ! 0;             || bonif. mayores 60 a¤os, RDL 16/2001
        bon_60 = #21#88;
    |FINSI;
|FINSI;

    dat_mes = #21#2;
|HAZ datos_mes;

|REPON_DATOS #11;
|FPRC;

|PROCESO tipo_A_meses_1;
|SI s_pas [ 3; |HAZ tipo_A_meses_10;    |FINSI;
|SI s_pas ] 4; |HAZ tipo_A_meses_11;    |FINSI;
|FPRC;

|DEFBUCLE tipo_A_meses;
 #21#1;
 ;
 #11#0, #11#39, #0#1,  5;
 #11#0, #11#39, #0#13, 5;
 ;
 NULL, tipo_A_meses_1;
|FIN;

|PROCESO total_dias;
     |ABRE #19;
     |PARA nMes2 = desde_mes; |SI nMes2 [ #0#13; |HACIENDO nMes2 = nMes2 + 1;
          #19#0 = #11#0;
          #19#1 = #11#39;
          #19#66 = nAnyo;
          #19#2 = nMes2;
          #19#3 = 0;
          |LEE 000#19=;
          |SI FSalida = 0;              || si hay ficha en el Hco. del mes los
               dias_finiq = #19#8;      || dias son los dias de alta
          |SINO;                        || si no hay ficha:
               |SI nMes2 = #0#13;
                    dias_finiq = #11#20;    || es el ultimo mes: cogo los del lote
               |SINO;
                    dias_finiq = 30;        || sino pongo 30 por defecto
               |FINSI;
          |FINSI;
          total_dias = total_dias + dias_finiq;   || totalizo
     |SIGUE;
|FPRC;

|PROCESO cuenta_dias;
     |HAZ total_dias;
     |DDEFECTO #19;
     #19#0 = #11#0;
     #19#1 = #11#39;
     #19#66 = nAnyo;
     #19#2 = dat_mes;
     #19#3 = 0;
     |LEE 000#19=;
     |SI FSalida = 0;
          dias_finiq = #19#8;      || si hay ficha en el Hco. del mes los
     |SINO;                        || dias son los dias de alta
          |SI nMes2 = #0#13;
               dias_finiq = #11#20;    || es el ultimo mes: cogo los del lote
          |SINO;
               dias_finiq = 30;        || sino pongo 30 por defecto
          |FINSI;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO vacaciones;               || se realiza TC complementario en caso de
     nAnyo = #0#0 - 2000;
     dat_mes = nMes;
     total_dias = 0;
     ||HAZ cuenta_dias;
     total_dias = #20#159 + #20#160;

     |SI nMes ! #0#13;
          dias_finiq = #20#159;
          #11#25 = ((nBaseCC_vac * dias_finiq) / total_dias) ! EURODB;
          #11#27 = ((nBaseCP_vac * dias_finiq) / total_dias) ! EURODB;
          nBaseCC_acu = nBaseCC_acu + #11#25;
          nBaseCP_acu = nBaseCP_acu + #11#27;
          || reduccion
          #11#90 = (#11#25 % #20#149) ! 2;
     |SINO;
          #11#25 = nBaseCC_vac - nBaseCC_acu;
          #11#27 = nBaseCP_vac - nBaseCP_acu;
          |SI #20#160 = 0;
               dias_finiq = #20#159;
          |SINO;
               dias_finiq = #20#160;
          |FINSI;
          || reduccion
          #11#90 = (#11#25 % #20#149) ! 2;
     |FINSI;

     ||HAZ calcula_bonif;           || finiquito con vacaciones

     || ahora tiene que proporcionar segun los meses que haya calculado
     || para el finiquito tambien todas las bonificaciones y reducciones
     || hago con todas las variables que tienen importes de bonif. lo mismo
|SI reducc > 0;
     nReducc_vac = reducc;
     |SI nMes ! #0#13;
          reducc = ((nReducc_vac * dias_finiq) / total_dias) ! EURODB;
          nReducc_acu = nReducc_acu + reducc;
     |SINO;
          reducc = nReducc_vac - nReducc_acu;
          dias_finiq = #11#20;
     |FINSI;
|FINSI;

|SI bonifi > 0;
     nBonifi_vac = bonifi;
     |SI nMes ! #0#13;
          bonifi = ((nBonifi_vac * dias_finiq) / total_dias) ! EURODB;
          nBonifi_acu = nBonifi_acu + bonifi;
     |SINO;
          bonifi = nBonifi_vac - nBonifi_acu;
          dias_finiq = #11#20;
     |FINSI;
|FINSI;

|SI subven > 0;
     nSubven_vac = subven;
     |SI nMes ! #0#13;
          subven = ((nSubven_vac * dias_finiq) / total_dias) ! EURODB;
          nSubven_acu = nSubven_acu + subven;
     |SINO;
          subven = nSubven_vac - nSubven_acu;
          dias_finiq = #11#20;
     |FINSI;
|FINSI;

|SI sub85pre > 0;
     nSub85pre_vac = sub85pre;
     |SI nMes ! #0#13;
          sub85pre = ((nSub85pre_vac * dias_finiq) / total_dias) ! EURODB;
          nSub85pre_acu = nSub85pre_acu + sub85pre;
     |SINO;
          sub85pre = nSub85pre_vac - nSub85pre_acu;
          dias_finiq = #11#20;
     |FINSI;
|FINSI;

|SI sub85dis > 0;
     nSub85dis_vac = sub85dis;
     |SI nMes ! #0#13;
          sub85dis = ((nSub85dis_vac * dias_finiq) / total_dias) ! EURODB;
          nSub85dis_acu = nSub85dis_acu + sub85dis;
     |SINO;
          sub85dis = nSub85dis_vac - nSub85dis_acu;
          dias_finiq = #11#20;
     |FINSI;
|FINSI;

|SI bon_60 > 0;
     nBon_60_vac = bon_60;
     |SI nMes ! #0#13;
          bon_60 = ((nBon_60_vac * dias_finiq) / total_dias) ! EURODB;
          nBon_60_acu = nBon_60_acu + bon_60;
     |SINO;
          bon_60 = nBon_60_vac - nBon_60_acu;
          dias_finiq = #11#20;
     |FINSI;
|FINSI;

     nSwitchEuro1 = 0;   || para que me redondee a euros !!!
     |HAZ datos_mes;
|FPRC;

|PROCESO trabajadores;
     |ABRE #20;          || leo los datos del trabajador
     #20#0 = #11#0;
     #20#1 = #11#39;
     #20#2 = #0#1;
     #20#3 = #11#48;
     |LEE 000#20=;
     |CIERRA #20;

     #12#0 = #11#0;       || empresa
     #12#1 = #11#39;      || trabajador
     |LEE 000#12=;
     |SI FSalida = 0;
          |HAZ iniswitch;
          |SI #11#25 ! 0;|O #11#27 ! 0;|O #11#37 ! 0; |O #11#66 ! 0; |O #11#82 ! 0;
               nEmp_Act = #11#0;
               aNAFSS_Act = #11#52;
               aSSCen2_Act = #11#9;       || nro patronal Centro
               |QBF aNAFSS_Act;
               |QBF aSSCen2_Act;
               |SI aNAFSS_Act = aNAFSS_Ant; |Y nEmp_Act = nEmp_Ant;
               |Y aSSCen2_Act = aSSCen2_Ant;
                    || mismo trabajador en misma empresa: no crees dos DAT
               |SINO;                             || si es el mismo NAFSS, entonces
                                                  || es el mismo trab. que ha tenido
                    |SI #11#48 ! 2;|O #0#17 = 2;  || alta y baja o cambio de algo y
                         nro_trab = nro_trab + 1; || NO tengo que crear dos segmentos
                    |FINSI;                       || TRA ni AYN, con uno vale. Tampoco
                    |HAZ totalitos1;
                    |HAZ tra;                     || tengo que contar dos veces al mismo
                    |HAZ ayn;                     || trabajador (05.04.2004)
               |FINSI;
               nEmp_Ant = #11#0;
               aNAFSS_Ant = #11#52;
               aSSCen2_Ant = #11#9;
               |QBF aNAFSS_Ant;
               |QBF aSSCen2_Ant;
               |SI #0#12 = "A";|O #0#12 = "T";
                    nPEnf = -1;
                    nPAcc = -1;
                    |SI #0#12 = "A";  |BUCLE tipo_A_meses;     |FINSI;
                    |SI #0#12 = "T";  |BUCLE tipo_T_meses;     |FINSI;
               |SINO;
                    |SI #0#17 = 2;
                         alfa1 = #12#36 % -104;   || a¤o alta trabajador
                         alfa2 = #0#0;            || a¤o nominas
                         desde_mes = #0#1;
                         |SI #20#160 ! 0;
                              #0#13 = desde_mes + 1;
                              ultimo_mes = #0#13;
                              |SI #20#159 = 0;
                                   desde_mes = ultimo_mes;
                              |FINSI;
                         |SINO;
                              #0#13 = desde_mes;
                              |SI ultimo_mes = "";
                                   ultimo_mes = #0#13;
                              |FINSI;
                         |FINSI;
                         nume1 = desde_mes;           || se queda con el primer mes
                         nume2 = primer_mes;          || para cambiar luego el EMP
                         |SI nume1 < nume2; |O nume2 = 0;    || si es necesario en finiquitos
                              primer_mes = desde_mes;
                         |FINSI;

                         nBaseCC_vac = #11#25;       || guarda las bases para finiquitos
                         nBaseCP_vac = #11#27;       || para proporcionar las vacaciones
                         nBaseCC_acu = 0;
                         nBaseCP_acu = 0;
                         nReducc_acu = 0;
                         nBonifi_acu = 0;
                         nSubven_acu = 0;
                         nSub85pre_acu = 0;
                         nSub85dis_acu = 0;
                         nBon_60_acu = 0;

                         |PARA nMes = desde_mes; |SI nMes [ #0#13; |HACIENDO nMes = nMes + 1;
                             |HAZ vacaciones;
                         |SIGUE;
                    |SINO;
                         dat_mes = #0#1;
                         |HAZ datos_mes;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cambia_fecha;
     |SI #0#17 = 2;
/*
          primer_mes = "00" + primer_mes;
          primer_mes = primer_mes % -102;
          #5#0 = #2#0;
          #5#1 = linea_EMP;
          |LEE 101#5=;
          |SI FSalida = 0;
               alfa1 = #5#4 % 154;
               alfa2 = #5#4 % -111;
               #5#4 = alfa1 + primer_mes + alfa2;
               |GRABA 020#5a;
          |FINSI;
*/
          primer_mes = "00" + primer_mes;
          primer_mes = primer_mes % -102;
          ultimo_mes = "00" + ultimo_mes;
          ultimo_mes = ultimo_mes % -102;
          alfa3 = #0#18;
          #5#0 = #2#0;
          #5#1 = linea_EMP;
          |LEE 101#5=;
          |SI FSalida = 0;
               alfa1 = #5#4 % 150;
               alfa2 = #5#4 % -109;
               #5#4 = alfa1 + alfa3 + primer_mes + ultimo_mes + alfa2;
               |GRABA 020#5a;
          |FINSI;

     |FINSI;
|FPRC;

|PROCESO fecha_finiq;
     |SI #0#17 = 2;
          |SI #0#12 = "M"; |O #0#12 = "A";
               |NOME_DAT #50 "labempax";
               |ABRE #labempax;
               #labempax#0 = #50#0;
               ||#labempax#18 = #50#18;
               #labempax#18 = #14#133;
               #labempax#1 = #50#1;
               #labempax#2 = #0#17;
               |LEE 101#labempax.=;
               |SI FSalida = 0;
                    #labempax#59 = primer_mes;
                    |GRABA 020#labempax.a;
               |FINSI;
               |LIBERA #labempax;
               |CIERRA #labempax;
               |NOME_DAT #50 temp4;
          |SINO;
               |ABRE #labemphi;
               #labemphi#0 = #52#0;
               ||#labemphi#18 = #52#18;
               #labemphi#18 = #14#133;
               #labemphi#1 = #52#1;
               #labemphi#2 = #0#17;
               |LEE 101#labemphi.=;
               |SI FSalida = 0;
                    #labemphi#59 = primer_mes;
                    |GRABA 020#labemphi.a;
               |FINSI;
               |LIBERA #labemphi;
               |CIERRA #labemphi;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO despues;
     |HAZ tct;
     |HAZ pasaaeuros_edt;

     |HAZ edt_BA_01;
     |SI #0#18 ] 2012;
          |HAZ edt_BA_02;
     |FINSI;
     |HAZ edt_BA_41;
     |HAZ edt_BA_21;
     |SI #0#18 ] 2012;
          |HAZ edt_BA_22;
     |FINSI;
     |SI #0#18 ] 2012;        || lo ponemos a partir de 2012
          |HAZ edt_BA_42;
     |FINSI;
     |HAZ edt_BA_23;
     |HAZ edt_BA_30;
     |HAZ edt_BA_37;
     |HAZ edt_BA_32;
     |HAZ edt_BA_36;
     |HAZ edt_BA_38;
     |SI #0#18 [ 2011;
          |HAZ edt_BA_02;
     |FINSI;

     |HAZ edt_CD_06;
     |HAZ edt_CD_26;
     |HAZ edt_CD_27;

     |HAZ edt_CD_07;
     |HAZ edt_CD_10;
     |HAZ edt_CD_11;
     |HAZ edt_CD_16;
     ||HAZ edt_CD_18;
     |HAZ edt_CD_17;
     |HAZ edt_CD_22;
     |HAZ edt_CD_28;
     |HAZ edt_CD_29;
     |HAZ edt_CD_30;

     |HAZ edt_CA_01;
     |SI #0#18 ] 2012;
          |HAZ edt_CA_02;
     |FINSI;
     ||HAZ edt_CA_03;
     ||HAZ edt_CA_11;
     |HAZ edt_CA_13;
     |HAZ edt_CA_22;
     |HAZ edt_CA_30;
     |HAZ edt_CA_31;
     |HAZ edt_CA_32;
     |HAZ edt_CA_50;
     |HAZ edt_CA_52;
     |SI #0#18 [ 2011;
          |HAZ edt_CA_51;
     |FINSI;
     |SI #0#18 ] 2012;
          || ya no
          ||HAZ edt_CA_57;
          |HAZ edt_CA_51;
          |HAZ edt_CA_53;
     |FINSI;
     |HAZ edt_CA_60;
     |HAZ edt_CA_80;
     |HAZ edt_CA_86;
     |HAZ edt_CA_90;
     |HAZ edt_TT_10;
     |HAZ edt_TT_20;
     |HAZ edt_TT_30;
     |HAZ edt_TT_91;
     |HAZ edt_TT_92;
     ||HAZ dba;
     |HAZ mpg;
     ||HAZ tyf;          || inhibido por ser opcional y problematico
     |HAZ ttt;
     |HAZ ett;
     |HAZ tfi;
     |HAZ cambia_fecha;       || solo sirve para cambiar el mes desde en el EMP
                              || (para finiquitos de vacaciones)
     |HAZ fecha_finiq;        || para grabar la fecha de vacaciones para TC1 en papel
|FPRC;

|PROCESO regimen;
     |ABRE #silcon15;
     #silcon15#0 = #nomtrtc2#0;
     #silcon15#1 = #nomtrtc2#14;
     |LEE 000#silcon15.=;
     |SI FSalida = 0;
          aRegimen = #silcon15#2;
     |SINO;
          aRegimen = #6#2;
     |FINSI;

     nRegimen = aRegimen;
     |SI #0#18 [ 2011; |Y nRegimen = 163;
          nRegimen = 613;
          aRegimen = nRegimen;
     |FINSI;
     |SI #0#18 ] 2012; |Y nRegimen = 613;
          nRegimen = 163;
          aRegimen = nRegimen;
     |FINSI;
     |CIERRA #silcon15;
|FPRC;

|PROCESO BuscaCCCCen;
     |ABRE #gomccchi;
     #gomccchi#0 = #11#0;
     #gomccchi#1 = #11#14;
     |LEE 000#gomccchi.=;
     |SI FSalida = 0;
          |SI #0#18 [ 2011;
               #16#10 = #gomccchi#2;
          |FINSI;
     |FINSI;
     |CIERRA #gomccchi;
|FPRC;

|PROCESO cta_cotizacion;
     #10#45 = aPorCentros;         || asi se si lo pedia por centros o no originalmente
     |SI #11#22 = 87;|O #11#22 = 97;|O #11#22 = 85;
     |O #11#22 = 64;|O #11#22 = 65;
          |DDEFECTO #17;
          |ABRE #17;
          #17#0 = #11#0;
          #17#13= #11#14;
          |SI #11#22 = 97;|O #11#22 = 85;
               #17#1 = 87;
          |SINO;
               |SI #11#22 = 65;
                    #17#1 = 64;
               |SINO;
                    #17#1 = #11#22;
               |FINSI;
          |FINSI;
          |LEE 000#17=;
          |CIERRA #17;

          descto = #17#2;       || descripcion centro de trabajo especial
          cta_co = #17#10;      || cta.cto. del centro de trabajo especial

          aLibre = #17#13;      || centro (para el TC2)
          aReser = #17#1;       || contrato (para el TC2)
     |SINO;
          |HAZ BuscaCCCEmp;
          cta_co = #10#13;          || cta.cot. de la empresa
          |DDEFECTO #16;
          |ABRE #16;
          #16#0 = #11#0;
          #16#1 = #11#14;
          |LEE 000#16=;
     |CIERRA #16;
     |HAZ BuscaCCCCen;

     descto = #16#2;           || descripcion centro de trabajo
     |SI #10#45 = "S";
            cta_co = #16#10;      || cta.cot. centro de trabajo
            aLibre = #16#1;
    |SINO;
            aLibre = "";
    |FINSI;
        aReser = "";
|FINSI;
    aLibre = ("00" + aLibre) % -102;
    aReser = ("00" + aReser) % -102;
#10#45 = "N";         || lo dejo como estaba: en los agrarios siempre por empresa

|FPRC;

|PROCESO limpia_var;
    nro_trab = 0;

    tot_ba_01 = 0;
    tot_ba_02 = 0;
    tot_ba_21 = 0;
    tot_ba_22 = 0;
    tot_ba_41 = 0;
    tot_ba_42 = 0;
    tot_ba_23 = 0;
    tot_ba_34 = 0;
    tot_ba_36 = 0;
    tot_ba_37 = 0;
    tot_ba_38 = 0;
    tot_ba_30 = 0;
    tot_ba_32 = 0;

    tot_cd_06 = 0;
    tot_cd_07 = 0;
    tot_cd_10 = 0;
    tot_cd_11 = 0;
    tot_cd_13 = 0;
    tot_cd_16 = 0;
    tot_cd_17 = 0;
    tot_cd_22 = 0;
    tot_cd_26 = 0;
    tot_cd_27 = 0;
    tot_cd_28 = 0;

    tot_ca_86 = 0;

    tot_ca_01 = 0;
    tot_ca_02 = 0;
    tot_ca_22 = 0;
    tot_ca_30 = 0;
    tot_ca_50 = 0;
    tot_ca_51 = 0;
    tot_ca_52 = 0;

    primer_mes = "";
    ultimo_mes = "";
    nFijos = 0;
    nEven = 0;
    nREA = 0;
    nJorAlta = 0;
    nBonifFPCont = 0;
|FPRC;

|PROCESO CuentaCentro;
     aCuentaCentro = "";
     |SI #11#54 = "S";      || si por centros = "S"
          |ABRE #labcentr;
          #labcentr#0 = #11#0;
          #labcentr#1 = #11#14;
          |LEE 000#labcentr.=;
          |SI FSalida = 0;
               aAlfa = #labcentr#20;
               |QBF aAlfa;
               |SI aAlfa ! "";
                    aCuentaCentro = aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #labcentr;
     |FINSI;
|FPRC;

|PROCESO cambia_autoriz;
     #silcon03#0 = #silcon03#0;
     #silcon03#1 = 0002;
     |LEE 101#silcon03.=;
     |SI FSalida = 0;
          nNume1 = nPosicion;
          nNume1 = 100 + nNume1;
          aAlfa1 = #silcon03#4 % nNume1;
          nNume2 = nPosicion + 9;
          nNume2 = (nNume2 * 100) + 99;
          aAlfa2 = #silcon03#4 % nNume2;
          #silcon03#4 = aAlfa1 + #silcon06#5 + aAlfa2;
          |GRABA 020#silcon03.a;
     |FINSI;
|FPRC;

|PROCESO antes;
|HAZ limpia_var;
|HAZ cta_cotizacion;
|HAZ regimen;
|HAZ CuentaCentro;

|HAZ inm;
|SI aAutorizacion ! ""; |Y aAutorizacion ! #6#5;
     || ya ha hecho la primera empresa
     || si la autorizacion anterior es distinta a la de la empresa actual,
     || le meto la general.En caso de dos distintas,la del control RED siempre

     #6#5 = #1#0;
     aAutorizacion = #1#0;
|SINO;
     aAutorizacion = #6#5;
|FINSI;
nPosicion = 10;
|HAZ cambia_autoriz;
|HAZ emp;
|HAZ rzs;
|HAZ exc;
|FPRC;

|PROCESO si_es_bueno;
    sw_bueno = 1;

|SI s_pas = 1;|O s_pas = 4;        || resto
    |SI #11#22=87;|O #11#22=97;|O #11#22=85;
                  |O #11#22=64;|O #11#22=65;
            sw_bueno=0;
    |FINSI;
|FINSI;
|SI s_pas = 2;|O s_pas = 5;        || aprendices
    |SI #11#22!87;|Y #11#22!97;|Y #11#22!85;              sw_bueno=0; |FINSI;
|FINSI;
|SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
    |SI #11#22!64;|Y #11#22!65;                           sw_bueno=0; |FINSI;
|FINSI;
|FPRC;

|PROCESO antesaun;                 || para Bonif Formacion Continua (CA80)
     |SI nEmpresaAnt ! #11#0;      || cuando cambio de empresa he de dejar
          swBonifFPCont = 0;       || que haga la bonif, si no se queda a uno
     |FINSI;                       || para que la haga una sola vez
     nEmpresaAnt = #11#0;
|FPRC;

|PROCESO ruptura_empresa;
     |HAZ si_es_bueno;
     |SI sw_bueno = 1;
          |SI ant_centro = -1;          || se utiliza de switch, no como ruptura!!!
               ant_centro = 0;
               |ABRE #14;
               |DDEFECTO #14;
               #14#100 = #11#0;           || empresa
               #14#133 = 99;              || centro de trabajo
               |LEE 000#14=;              || lee datos TC1
               |HAZ antesaun;
               |HAZ antes;
          |FINSI;
          |HAZ trabajadores;
     |FINSI;
|FPRC;

|PROCESO ruptura_centros;
     |HAZ si_es_bueno;
     |SI sw_bueno = 1;
          |SI ant_centro ! #11#14;
               |SI ant_centro ! -1; |HAZ despues;  |FINSI;   || cierra liquidacion
               ant_centro = #11#14;
               |ABRE #14;
               |DDEFECTO #14;
               #14#100 = #11#0;           || empresa
               #14#133 = #11#14;          || centro de trabajo
               |LEE 000#14=;                                 || lee datos TC1
               |CIERRA #14;
               |HAZ antesaun;
               |HAZ antes;                                   || abre liquidacion
          |FINSI;
          |HAZ trabajadores;
     |FINSI;
|FPRC;

|DEFBUCLE por_centros;
 #11#4;
 ;
 "S",     0,   0, "       ", "           ",  0;
 "S", 99999, 999, "zzzzzzz", "zzzzzzzzzzz", 19;
 ;
 NULL, ruptura_centros;
|FIN;

|DEFBUCLE por_empresa;
 #11#5;
 ;
 "N",     0, "       ", "           ",  0;
 "N", 99999, "zzzzzzz", "zzzzzzzzzzz", 19;
 ;
 NULL, ruptura_empresa;
|FIN;

|PROCESO empresas1;
     |ABRE #6;
     #6#0 = #15#0;
     |LEE 000#6=;
     #10#0 = #6#0;
     |LEE 000#10=;
     |SI FSalida = 0;
          |SI #10#45 ! "S";|Y #10#45 ! "N"; #10#45 = "N"; |FINSI;  || centros S/N
          #15#0 = #10#0;

          |PINTA 2302, "Procesando ... ";
          |PINTA 2318, #10#0;
          |PINTA 2324, #10#2;

          |DELINDEX #20;
          |HAZ carga_temporal;       || recarga del Tmp. TC2

          |DELINDEX #20;
     |FINSI;
     |CIERRA #6;
|FPRC;

|DEFBUCLE empresas;
     #15#1;
     2;
     00001, "*";
     99999, "*";
     ;
     NULL, empresas1;
|FIN;

|PROCESO eti;
    clave = "ETI";
|HAZ ini_linea;
|SI sw_auxil = 0;
    |DDEFECTO #3;
        #3#0  = "TC22";
        #3#1  = "0";
        #3#2  = "VIP2";
        #3#3  = "1";
        #3#4  = #1#0;         || clave autorizacion
        #3#5  = "243     ";   || proveedor nomina + 5 blancos (reservados)
        fech1 = ~;
    |HAZ fecha;
        #3#6  = for_fecha;    || fecha
    |HAZ hora;
        #3#7  = for_hora;     || hora
        #3#8  = fichero;      || fichero
        #3#9  = extension;    || sufijo
        #3#10 = "N";          || codigo prioridad
        #3#11 = indica;       || indicador
        #3#12 = #0#18 % -102; || a¤o lote
        #3#13 = #0#1;         || mes
        #3#14 = #0#6;         || serie
        #3#15 = #0#7;         || nro. envio
        #3#16 = #0#8;         || nro. documento
        #3#17 = "";           || reservado
    |HAZ monta;
    |HAZ fin_linea;
|SINO;
    |HAZ fin_linea2;
|FINSI;
|FPRC;

|PROCESO graba_lote;
     #2#1 = fichero;       || nombre salida
     #2#2 = extension;     || extension
     #2#3 = ~;             || fecha creacion
     #2#4 = ~;             || fecha grabacion
     |SI #0#21 = "S";
          #2#5 = #0#22;
          #2#6 = #0#23;
          #2#7 = "cra";
     |SINO;
          #2#5 = 0;
          #2#6 = "";
          #2#7 = "";
     |FINSI;
     |GRABA 020#2b;
|FPRC;

____________________________________/ PROCESO PRINCIPAL
|PROCESO tipo3;
     |ABRE #1;
     |ABRE #2;
     |ABRE #4;
     |ABRE #5;
     |ABRE #10;
     |ABRE #12;
     |ABRE #15;
     |ABRE #tsilcon9;
         #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida = 0;|Y aParam ! "TC2";
         |MENAV "    Numero de Lote YA existente ...";
     |SINO;
             fichero = #0#3;
             extension = #0#4;

             alfa1 = Usuario; |QBF alfa1;
             temp1 = "1" + alfa1;  |NOME_DAT #14 temp1;     || tmp. TC1
             temp2 = "2" + alfa1;  |NOME_DAT #11 temp2;     || tmp. TC2
             temp3 = "3" + alfa1;  |NOME_DAT #20 temp3;     || tmp. calculos
             temp4 = "7" + alfa1;  |NOME_DAT #50 temp4;     || aux. empresas
             temp5 = "8" + alfa1;  |NOME_DAT #51 temp5;     || aux. epigrafes
             temp6 = "9" + alfa1;  |NOME_DAT #24 temp6;     || tc1 solo

         |SI #0#12 = "M"; s_nom = "gomyytc2"; |FINSI;
         |SI #0#12 = "H"; s_nom = "gomwwtc2"; |FINSI;
         |SI #0#12 = "A"; s_nom = "gomsstc2"; |FINSI;

         |SI #0#5 = "N"; indica = " ";  |FINSI;   || normal
         |SI #0#5 = "R"; indica = " ";  |FINSI;   || reenvio
         |SI #0#5 = "P"; indica = "P";  |FINSI;   || pruebas
         |SI #0#5 = "S"; indica = "N";  |FINSI;   || reenvio SIN sustitucion
         |HAZ graba_lote;
         |HAZ eti;
         |BUCLE empresas;
         |HAZ etf;
     |FINSI;
     |LIBERA #2;

     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #10;
     |CIERRA #12;
     |CIERRA #15;
     |CIERRA #tsilcon9;

     |DELINDEX #11;      || tmp. TC2
     |DELINDEX #14;      || tmp. TC1
     |DELINDEX #20;      || tmp. calculos
     |DELINDEX #24;      || tc1 sin tc2
     |DELINDEX #50;      || aux. empresas
     |DELINDEX #51;      || aux. epigrafes
     |DBASS aAlfa; |QBF aAlfa;
     |SI aAlfa ! "/u/dsprofes/"; |Y #0#21 ! "S";
          |DELINDEX #15;      || parrilla empresas
          |DELINDEX #23;      || parrilla trabajadores
          |DELINDEX #tsilcon9;      || parrilla centros
     |FINSI;
|FPRC;

|PROCESO RedFijas;
     |SI #0#18 [ 2009;
          nRedFijaCC = 0063;         || reduccion fija de 21 euros
          nRedFijaATEP = 0007;       || reduccion fija de 21 euros
          nRedJorCC = 0063;          || reduccion fija de 0.70 euros
          nRedJorATEP = 0007;        || reduccion fija de 0.70 euros
          nRedFijaMes = 2100;
     |FINSI;
     |SI #0#18 = 2010;
          nRedFijaCC = 0116;        || reduccion fija de 38.70 euros
          nRedFijaATEP = 0013;       || reduccion fija de 38.70 euros
          nRedJorCC = 0150;          || reduccion fija de 1.68 euros
          nRedJorATEP = 0018;        || reduccion fija de 1.68 euros
          nRedFijaMes = 3870;
     |FINSI;
     |SI #0#18 ] 2011;
          nRedFijaCC = 0169.066667;  || reduccion fija de 38.70 euros
          nRedFijaATEP = 0018.766667;|| reduccion fija de 38.70 euros
          nRedJorCC = 0220;          || reduccion fija de 1.68 euros
          nRedJorATEP = 0025;        || reduccion fija de 1.68 euros
          nRedFijaMes = 5635;
     |FINSI;
|FPRC;

|PROCESO Borrador;
     |_PDIR aAlfa;
     |SI FSalida = 0;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa1 = aAlfa;
               |FBORRA aAlfa1;
               |_SDIR aAlfa;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO BorraTemporales;
     || esto es para evitar el error ese de la estructura del temporal
     || que no es valida que pasa en algunos clientes algunas veces y que
     || no sabemos de donde sale, no me complico la vida y borro los
     || temporales t(0-9)*.* a mano y ya esta

     |DBASS aAlfa;
     |QBF aAlfa;
     ||SI aAlfa ! "/u/dsprofes/"; |Y aAlfa ! "/u/dsasesor/";
          || solo en clientes
          |DFICE aFich;
          |PARA nume1 = 0; |SI nume1 [ 9; |HACIENDO nume1 = nume1 + 1;
               aNumero = nume1; |QBF aNumero;
               aAlfa = aFich + "t" + aNumero + "*"; |HAZ Borrador;
               aAlfa = aFich + "u" + aNumero + "*"; |HAZ Borrador;
               aAlfa = aFich + "v" + aNumero + "*"; |HAZ Borrador;
               aAlfa = aFich + "g" + aNumero + "*"; |HAZ Borrador;
               aAlfa = aFich + aNumero + "*"; |HAZ Borrador;
          |SIGUE;
     ||FINSI;
|FPRC;

|PROGRAMA;
     |HAZ BorraTemporales;
     |HAZ PaseAutorizacion;
     aParam = eaParame;
     |QBF aParam;
     |HAZ tipo8;
     |CLS;
     |CABEZA "CREAC.LOTE TC2/8";
     |DDEFECTO #0;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          enDesCen = 1;
          enHasCen = 99;
          eaFuente = #0#12;
          |HAZ RedFijas;
          |HAZ tipo3;

          aAlfa = #0#2; |QBF aAlfa; aAlfa = ("00000" + aAlfa) % -105;
          aAlfa = "    Se ha generado el lote fan número " + aAlfa;
          |MENAV aAlfa;
          |SI #0#21 = "S";
               |HAZ LanzaCRA;
               |HAZ GrabaLotes;
          |SINO;
               |HAZ GrabaLote;
          |FINSI;
     |FINSI;
     |HAZ tipo9;
|FPRO;

_________________/ TRASPASO DE nomcalca,nomcalac y nomhicca AL tsilcon1
|PROCESO ulti_dia;  || halla el ultimo dia del mes
    nume2 = 0;
    nume1 = #0#0 $ 4;    || a¤o historico
|SI nume1 = 0;|Y #36#9 = "S";
        nume2 = 1;
|FINSI;

    topemes = 31;
|SI #20#2= 2;
        topemes = 28 + nume2;
|FINSI;
|SI #20#2 = 4;|O #20#2 = 6;|O #20#2 = 9;|O #20#2 = 11;
        topemes = 30;
|FINSI;
|FPRC;

|PROCESO liquidados;
    dia_2 = topemes;     || dias que tiene el mes
    dia_3 = 30;          || dias cotizacion 'mensual'
|SI #12#42 = "D";|O #12#42 = "T";
        dia_3 = topemes; || dias cotizacion 'diario'
|FINSI;
    dia_4 = dia_3;

|SI nume1 > dia_4;  nume1 = dia_4;  |FINSI;
|SI nume1 = dia_2; |Y nume1<dia_4;  nume1 = dia_4;  |FINSI;
|SI #12#42 = "C";
    |SI aParam ! "TC2";
        nume1 = #11#43 + #11#44;                    || dias IT
    |SINO;
        nume1 = #11#43 + #11#44 + #11#49;
    |FINSI;

    ||nume1 = #11#43;
|FINSI;    || para q en citricos no topee
|FPRC;

|PROCESO maternidad;
     |SI #20#65 ! 0;
          |HAZ ulti_dia;
          nume1 = #20#65;
          #12#0 = #20#0;
          #12#1 = #20#1;
          |LEE 000#12=;
          |HAZ liquidados;

          nCConst = #labtraba#248;
          |HAZ constante;
     /*
        CodigoCons = #labempre#32;    || cte. por defecto es la de la empresa
        |ABRE #nomtraca;              || para que en maternidad coja tambien
        |ABRE #22;                    || la constante que tenga la empleada
        #nomtraca#0 = #20#0;
        #nomtraca#1 = #20#1;
        |LEE 000#nomtraca.=;
        |SI FSalida = 0;|Y #nomtraca#3 ! 0;
             CodigoCons = #nomtraca#3;
        |FINSI;
        |CIERRA #nomtraca;
        #22#0 = CodigoCons;
        |LEE 000#22=;            || lee la constante (para las maternidades)
        |CIERRA #22;
     */
          bcomun = (#20#35 * nume1) % #22#7;
          bprofe = (#20#36 * nume1) % (#22#13 + #22#15 + #22#17 + #22#19);
          bcomun = bcomun ! EURODB;
          bprofe = bprofe ! EURODB;
          || #20#55 = #20#55 + (bcomun + bprofe); || reduccion por maternidad
     |FINSI;                            || (usa un campo inhibido del nomcalca)
|FPRC;

|PROCESO graba_nomhicac;
    #23#1 = #19#0;
    #23#2 = #19#1;
|LEE 000#23=;
|SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

     swStop = 0;
     nEmp = #19#0;
     nTra = #19#1;
     |HAZ CompCentro;
     |SI swStop = 1;
          |ACABA;
     |FINSI;

|DDEFECTO #20;
    #20#0 = #19#0;  || empresa
    #20#1 = #19#1;  || trabajador
    #20#2 = #0#1;   || mes
    #20#3 = 0;      || tipo
|LEE 101#20=;
    FEstado = FSalida;

    #20#4  = #19#4;           || fecha alta
    #20#5  = #19#5;           || fecha baja
    #20#6  = #19#6;           || fecha antiguedad.
    #20#7  = #19#7;           || dias periodo
    #20#8  = #20#8 + #19#8;   || dias alta
    #20#9  = #19#9;           || tipo contrato
    #20#10 = #20#10 + #19#10; || dias contrato
    #20#11 = #20#11 + #19#11; || horas contrato
    #20#12 = #19#12;          || cod.bonific.
    #20#13 = #19#13;          || (%)irpf 1
    #20#14 = #20#14 + #19#14; || base irpf 1
    #20#15 = #20#15 + #19#15; || retencion 1
    #20#16 = #20#16 + #19#16; || base irpf pagas
    #20#17 = #20#17 + #19#17; || retencion pagas
    #20#18 = #20#18 + #19#18; || base irpf exenta
    #20#19 = #19#19;          || desde dia 1
    #20#20 = #19#20;          || desde dia 2
    #20#21 = #19#21;          || desde dia 3
    #20#22 = #19#22;          || desde dia 4
    #20#23 = #19#23;          || hasta dia 1
    #20#24 = #19#24;          || hasta dia 2
    #20#25 = #19#25;          || hasta dia 3
    #20#26 = #19#26;          || hasta dia 4
    #20#27 = #19#27;          || tipo falta 1
    #20#28 = #19#28;          || tipo falta 2
    #20#29 = #19#29;          || tipo falta 3
    #20#30 = #19#30;          || tipo falta 4
    #20#31 = #20#31 + #19#31; || total dias E
    #20#32 = #20#32 + #19#32; || total dias A
    #20#33 = #20#33 + #19#33; || total dias H
    #20#34 = #20#34 + #19#34; || total dias F
    |SI FEstado ! 0;
           #20#35 = #19#35;        || prom.enferm.
           #20#36 = #19#36;        || prom.accid.
    |FINSI;
    #20#37 = #20#37 + #19#37; || remuner. total
    #20#38 = #20#38 + #19#38; || prorrata pagas
    #20#39 = #20#39 + #19#39; || base cont.comunes
    nume1 = #19#40 - #19#62;
    |SI nume1 < 0;
          nBIlt = #19#40;
    |SINO;
          nBIlt = #19#62;
    |FINSI;
    #20#40 = #20#40 + #19#40; || base cont.profes.
    #20#62 = #20#62 + nBIlt;   || base ILT
    #20#41 = #20#41 + #19#41; || base horas 1
    #20#42 = #20#42 + #19#42; || base horas 2
    #20#43 = #20#43 + #19#43; || base bonif. CC 1
    #20#44 = #20#44 + #19#44; || base bonif. CP 1
    #20#45 = #20#45 + #19#45; || s.s. cgo. empresa
    #20#46 = #20#46 + #19#46; || bruto recibo
    #20#47 = #20#47 + #19#47; || bruto paga
    #20#48 = #20#48 + #19#48; || cuota cont.comunes
    #20#49 = #20#49 + #19#49; || cuota cont.profes.
    #20#50 = #20#50 + #19#50; || cuota horas 1
    #20#51 = #20#51 + #19#51; || cuota horas 2
    #20#52 = #20#52 + #19#52; || anticipos 1
    #20#53 = #20#53 + #19#53; || anticipos 2
    #20#54 = #20#54 + #19#54; || en especie
    #20#55 = #20#55 + #19#55; || jornadas en baja
    #20#56 = #19#56;          || ~
    #20#57 = #20#57 + #19#57; || prest. enf. comun
    #20#58 = #20#58 + #19#58; || prest. accid.
    #20#59 = #20#59 + #19#59; || compl. enf. comun
    #20#60 = #20#60 + #19#60; || compl. accid.
    #20#61 = #19#61;          || (%) cont. comunes
    ||#20#62 = #20#62 + #19#62; || base ILT
    #20#63 = #20#63 + #19#63; || cuota bonif. 1
    #20#64 = #20#64 + #19#64; || subv. horas formacion
    #20#65 = #20#65 + #19#65; || total dias M

    #20#66 = #20#66 + #19#105;|| total dias vacaciones
    #20#67 = #19#106;         || (%) irpf 2
    #20#68 = #19#107;         || (%) irpf 3
    #20#69 = #20#69 + #19#108;|| base irpf 2
    #20#70 = #20#70 + #19#109;|| base irpf 3
    #20#71 = #20#71 + #19#110;|| retencion 2
    #20#72 = #20#72 + #19#111;|| retencion 3
    #20#73 = #20#73 + #19#112;|| prestacion enf. empresa
    #20#74 = #20#74 + #19#113;|| total bases
    #20#75 = #20#75 + #19#114;|| total retenciones
    #20#76 = #19#117;         || dto. pagas huelga
    #20#77 = #19#118;         || dto. pagas absentismo
    #20#78 = #20#78 + #19#119;|| total dias desempleo
    #20#79 = #20#79 + #19#121;|| base bonif. CC 2
    #20#80 = #20#80 + #19#122;|| base bonif. CP 2
    #20#81 = #20#81 + #19#123;|| cuota bonif. 2
    #20#82 = #19#124;         || (%) bonif. 1
    #20#83 = #19#125;         || (%) bonif. 2
    #20#84 = #20#84 + #19#126;|| base ILT bonif. 1
    #20#85 = #20#85 + #19#127;|| base ILT bonif. 2
                    || (hueco por si aparecen campos nuevos)
    #20#90 = #19#68;          || clave enf. (adaptado en silcon10)
    #20#91 = #19#70;          || dias enf. actual (adaptado en silcon10)
    #20#92 = #20#92 + #19#130;|| bonif R.D.L. 16/2001

|HAZ maternidad;
|SI FEstado ! 0;    |GRABA 020#20n;     |FINSI;
|SI FEstado = 0;    |GRABA 020#20a;     |FINSI;
|LIBERA #20;
|FPRC;

|DEFBUCLE lee_nomhicac;
 #19#1;
 ;
 #6#0,     1, any_hist, #0#1,  #0#17;
 #6#0, 99999, any_hist, #0#13, #0#17;
 ;
 NULL, graba_nomhicac;
|FIN;

|PROCESO graba_nomcalac;
    #23#1 = #21#0;
    #23#2 = #21#1;
|LEE 000#23=;
|SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

     swStop = 0;
     nEmp = #21#0;
     nTra = #21#1;
     |HAZ CompCentro;
     |SI swStop = 1;
          |ACABA;
     |FINSI;

|DDEFECTO #20;
    #20#0 = #21#0;  || empresa
    #20#1 = #21#1;  || trabajador
    #20#2 = #0#1;  || mes
    #20#3 = 0;      || tipo
|LEE 101#20=;
    FEstado = FSalida;

     |SI #21#39 = 0;
     |Y #21#40 = 0;
     |Y #21#62 = 0;
          |LIBERA #20;
          |ACABA;
     |FINSI;

    #20#4  = #21#4;           || fecha alta
    #20#5  = #21#5;           || fecha baja
    #20#6  = #21#6;           || fecha antiguedad.
    #20#7  = #21#7;           || dias periodo
    #20#8  = #20#8 + #21#8;   || dias alta
    #20#9  = #21#9;           || tipo contrato
    #20#10 = #20#10 + #21#10; || dias contrato
    #20#11 = #20#11 + #21#11; || horas contrato
    #20#12 = #21#12;          || cod.bonific.
    #20#13 = #21#13;          || (%)irpf 1
    #20#14 = #20#14 + #21#14; || base irpf 1
    #20#15 = #20#15 + #21#15; || retencion 1
    #20#16 = #20#16 + #21#16; || base irpf pagas
    #20#17 = #20#17 + #21#17; || retencion pagas
    #20#18 = #20#18 + #21#18; || base irpf exenta
    #20#19 = #21#19;          || desde dia 1
    #20#20 = #21#20;          || desde dia 2
    #20#21 = #21#21;          || desde dia 3
    #20#22 = #21#22;          || desde dia 4
    #20#23 = #21#23;          || hasta dia 1
    #20#24 = #21#24;          || hasta dia 2
    #20#25 = #21#25;          || hasta dia 3
    #20#26 = #21#26;          || hasta dia 4
    #20#27 = #21#27;          || tipo falta 1
    #20#28 = #21#28;          || tipo falta 2
    #20#29 = #21#29;          || tipo falta 3
    #20#30 = #21#30;          || tipo falta 4
    #20#31 = #20#31 + #21#31; || total dias E
    #20#32 = #20#32 + #21#32; || total dias A
    #20#33 = #20#33 + #21#33; || total dias H
    #20#34 = #20#34 + #21#34; || total dias F
    |SI FEstado ! 0;
            #20#35 = #21#35;       || prom.enferm.
            #20#36 = #21#36;       || prom.accid.
    |FINSI;
    #20#37 = #20#37 + #21#37; || remuner. total
    #20#38 = #20#38 + #21#38; || prorrata pagas
    #20#39 = #20#39 + #21#39; || base cont.comunes
    || #20#39 = 0;  || atrasos de agrarios sin cont. comunes
    /*
    ¨por que?
    nume1 = #21#40 - #21#62;
    |SI nume1 < 0;
          nBIlt = #21#40;
    |SINO;
          nBIlt = #21#62;
    |FINSI;
    */
    nBIlt = #21#62;
    #20#40 = #20#40 + #21#40; || base cont.profes.
    #20#62 = #20#62 + nBIlt;   || base ILT
    #20#41 = #20#41 + #21#41; || base horas 1
    #20#42 = #20#42 + #21#42; || base horas 2
    #20#43 = #20#43 + #21#43; || base bonif. CC 1
    #20#44 = #20#44 + #21#44; || base bonif. CP 1
    #20#45 = #20#45 + #21#45; || s.s. cgo. empresa
    #20#46 = #20#46 + #21#46; || bruto recibo
    #20#47 = #20#47 + #21#47; || bruto paga
    #20#48 = #20#48 + #21#48; || cuota cont.comunes
    #20#49 = #20#49 + #21#49; || cuota cont.profes.
    #20#50 = #20#50 + #21#50; || cuota horas 1
    #20#51 = #20#51 + #21#51; || cuota horas 2
    #20#52 = #20#52 + #21#52; || anticipos 1
    #20#53 = #20#53 + #21#53; || anticipos 2
    #20#54 = #20#54 + #21#54; || en especie
    #20#55 = #20#55 + #21#55; || jornadas en baja
    #20#56 = #21#56;          || ~
    #20#57 = #20#57 + #21#57; || prest. enf. comun
    #20#58 = #20#58 + #21#58; || prest. accid.
    #20#59 = #20#59 + #21#59; || compl. enf. comun
    #20#60 = #20#60 + #21#60; || compl. accid.
    #20#61 = #21#61;          || (%) cont. comunes
    ||#20#62 = #20#62 + #21#62; || base ILT
    #20#63 = #20#63 + #21#63; || cuota bonif. 1
    #20#64 = #20#64 + #21#64; || subv. horas formacion
    #20#65 = #20#65 + #21#65; || total dias M
    #20#66 = #20#66 + #21#66; || total dias V
    #20#67 = #21#67;          || (%) irpf 2
    #20#68 = #21#68;          || (%) irpf 3
    #20#69 = #20#69 + #21#69; || base irpf 2
    #20#70 = #20#70 + #21#70; || base irpf 3
    #20#71 = #20#71 + #21#71; || retencion 2
    #20#72 = #20#72 + #21#72; || retencion 3
    #20#73 = #20#73 + #21#73; || prest. enf. comun empresa
    #20#74 = #20#74 + #21#74; || total bases irpf
    #20#75 = #20#75 + #21#75; || total retenciones
    #20#76 = #21#76;          || dto. pagas huelga
    #20#77 = #21#77;          || dto. pagas absentismo
    #20#78 = #20#78 + #21#78; || total dias D
    #20#79 = #20#79 + #21#79; || base bonif. CC 2
    #20#80 = #20#80 + #21#80; || base bonif. CP 2
    #20#81 = #20#81 + #21#81; || cuota bonif. 2
    #20#82 = #21#82;          || (%) bonif. 1
    #20#83 = #21#83;          || (%) bonif. 2
    #20#84 = #20#84 + #21#84; || base ILT bonif. 1
    #20#85 = #20#85 + #21#85; || base ILT bonif. 2
    #20#92 = #20#92 + #21#88; || bonif. RDL 16/2001
    #20#119 = #20#119 + #21#117; || base maternidad

     #20#148 = #20#148 + #21#148;
     #20#149 = #20#149 + #21#149;
     #20#150 = #20#150 + #21#150;
     #20#151 = #20#151 + #21#151;
     #20#152 = #20#152 + #21#152;
     #20#153 = #20#153 + #21#153;
     #20#154 = #20#154 + #21#154;
     #20#155 = #20#155 + #21#155;
     #20#156 = #20#156 + #21#156;
     #20#157 = #20#157 + #21#157;
     #20#158 = #20#158 + #21#158;

     #20#124 = #20#124 + #21#114;
     #20#125 = #20#125 + #21#115;
     #20#126 = #20#126 + #21#124;
     #20#127 = #20#127 + #21#134;

|HAZ maternidad;
|SI FEstado ! 0;    |GRABA 020#20n;     |FINSI;
|SI FEstado = 0;    |GRABA 020#20a;     |FINSI;
|LIBERA #20;
|FPRC;

|DEFBUCLE lee_nomcalac;
 #21#1;
 ;
 #6#0,     1, #0#1,  5;
 #6#0, 99999, #0#13, 5;
 ;
 NULL, graba_nomcalac;
|FIN;

|PROCESO graba_nomhicca_2;
     |DDEFECTO #20;
     |PARA para1 = 0; |SI para1 [ 65; |HACIENDO para1 = para1 + 1;
          #20para1 = #19para1;
     |SIGUE;

     #20#66 = #19#105;         || total dias vacaciones
     #20#67 = #19#106;         || (%) retencion 2
     #20#68 = #19#107;         || (%) retencion 3
     #20#69 = #19#108;         || base irpf 2
     #20#70 = #19#109;         || base irpf 3
     #20#71 = #19#110;         || retencion 2
     #20#72 = #19#111;         || retencion 3
     #20#73 = #19#112;         || prestacion enf. empresa
     #20#74 = #19#113;         || total bases
     #20#75 = #19#114;         || total retenciones
     #20#76 = #19#117;         || dto. pagas huelga
     #20#77 = #19#118;         || dto. pagas absentismo
     #20#78 = #19#119;         || total dias desempleo
     #20#79 = #19#121;         || base bonif. CC 2
     #20#80 = #19#122;         || base bonif. CP 2
     #20#81 = #19#123;         || cuota bonif. 2
     #20#82 = #19#124;         || (%) bonif. 1
     #20#83 = #19#125;         || (%) bonif. 2
     #20#84 = #19#126;         || base ILT bonif. 1
     #20#85 = #19#127;         || base ILT bonif. 2
     #20#92 = #19#130;         || bonif. mayores 60 a¤os, R.D.L. 16/2001
     ||#20#93 = #19#131;         || cuota bonif. mater agrarios
                    || (hueco por si aparecen campos nuevos)
     #20#90 = #19#68;          || clave enf. (adaptado en silcon10)
     #20#91 = #19#70;          || dias enf. actual (adaptado en silcon10)
     #20#99 = #19#148;         || bonif mayores 59 a¤os, 4 de antig.
     #20#101 = #19#149;      || Horas subvencionadas formacion
     #20#121 = #19#206 + #19#207;      || cuota solidaridad

     #20#110 = #19#173;      || dias Control IT
     #20#111 = #19#174;      || base Control IT
     |SI #0#17 = 2;
          #20#159 = #19#213;      || dias finiquito mes de calculo
          #20#160 = #19#214;      || dias finiquito mes siguiente
          #20#148 = #19#190;      || total reduccion
          #20#149 = #19#191;      || % reduccion
     |FINSI;

     |GRABA 020#20n;
|FPRC;

|PROCESO graba_nomhicca;
    #23#1 = #19#0;
    #23#2 = #19#1;
|LEE 000#23=;
|SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

     swStop = 0;
     nEmp = #21#0;
     nTra = #21#1;
     |HAZ CompCentro;
     |SI swStop = 1;
          |ACABA;
     |FINSI;

|SI aParam ! "TC2";
    |HAZ graba_nomhicca_2;
|SINO;
    |SI #19#3 ! 2;
        |HAZ graba_nomhicca_2;
    |SINO;
        || los finiquitos se refunden en el mes normal
        |DDEFECTO #20;
            #20#0 = #19#0;
            #20#1 = #19#1;
            #20#2 = #19#2;
            #20#3 = 0;
        |LEE 101#20=;
            FEstado = FSalida;

            #20#39 = #20#39 + #19#39; || base cont.comunes
            #20#40 = #20#40 + #19#40; || base cont.profes.
            #20#41 = #20#41 + #19#41; || base horas 1
            #20#42 = #20#42 + #19#42; || base horas 2
            #20#43 = #20#43 + #19#43; || base bonif. CC 1
            #20#44 = #20#44 + #19#44; || base bonif. CP 1
            #20#45 = #20#45 + #19#45; || s.s. cgo. empresa
            #20#48 = #20#48 + #19#48; || cuota cont.comunes
            #20#49 = #20#49 + #19#49; || cuota cont.profes.
            #20#50 = #20#50 + #19#50; || cuota horas 1
            #20#51 = #20#51 + #19#51; || cuota horas 2
            #20#57 = #20#57 + #19#57; || prest. enf. comun
            #20#58 = #20#58 + #19#58; || prest. accid.
            #20#59 = #20#59 + #19#59; || compl. enf. comun
            #20#60 = #20#60 + #19#60; || compl. accid.
            #20#62 = #20#62 + #19#62; || base ILT
            #20#63 = #20#63 + #19#63; || cuota bonif. 1
            #20#64 = #20#64 + #19#64; || subv. horas formacion
            #20#73 = #20#73 + #19#73; || prest. enf. comun empresa
            #20#79 = #20#79 + #19#121;|| base bonif. CC 2
            #20#80 = #20#80 + #19#122;|| base bonif. CP 2
            #20#81 = #20#81 + #19#123;|| cuota bonif. 2
            #20#84 = #20#84 + #19#126;|| base ILT bonif. 1
            #20#85 = #20#85 + #19#127;|| base ILT bonif. 2

        |HAZ maternidad;
        |SI FEstado = 0; |GRABA 020#20a;     |FINSI;
        |SI FEstado ! 0; |GRABA 020#20n;     |FINSI;
        |LIBERA #20;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE lee_nomhicca;
 #19#1;
 ;
 #6#0,     1, any_hist, #0#1, tipo_bot;
 #6#0, 99999, any_hist, #0#1, tipo_top;
 ;
 NULL, graba_nomhicca;
|FIN;

|PROCESO los_tcs;
     #15#0 = #6#0;
     |LEE 000#15=;
     |SI swSelEmp ! 0;
          |SI FSalida ! 0; |O #15#2 ! "*";    |ACABA;   |FINSI;
     |FINSI;

     nEmpresa = #6#0;
     nTrabaj = #23#2;
     nMes = #0#1;
     nAnyo = #0#0;
     aLiq = #0#9;
     s_anyl = #0#18;

     nDesdeTipo = tipo_bot;
     nHastaTipo = tipo_top;

     alfa1 = Usuario;       |QBF alfa1;       alfa1 = "g" + alfa1;
     |NOME_DAT #11 alfa1;
     |DELINDEX #11;
     alfa1 = Usuario;       |QBF alfa1;       alfa1 = "1" + alfa1;
     |NOME_DAT #14 alfa1;
     |DELINDEX #14;
     |MODULO eaVengode;

     s_tat = #0#17;
     s_ele = #0#14;
     s_num = #0#2;
     s_fich = #0#3;

     |SI #0#12 = "M";
          |SUB_EJECUTA "gomyytc2";
          |SUB_EJECUTA "gomyytc1";
     |FINSI;

     |SI #0#12 = "H";
          |SUB_EJECUTA "gomwwtc2";
          |SUB_EJECUTA "gomwwtc1";
     |FINSI;

     |SI #0#12 = "A";
          nDesdeMes = #0#1;
          nHastaMes = #0#13;
          |SUB_EJECUTA "gomsstc2";
          |SUB_EJECUTA "gomsstc1";
     |FINSI;

     ||PARA s_pas = 1; |SI s_pas [ 6; |HACIENDO s_pas = s_pas + 1;
          corta = 0;
          |SI s_pas = 1;|Y #0#15 ! "T";|Y #0#15 ! "R"; corta = 1; |FINSI;
          |SI s_pas = 2;|Y #0#15 ! "T";|Y #0#15 ! "A"; corta = 1; |FINSI;
          |SI s_pas = 3;|Y #0#15 ! "T";|Y #0#15 ! "P"; corta = 1; |FINSI;
          |SI s_pas = 4;|Y #0#15 ! "T";|Y #0#15 ! "R"; corta = 1; |FINSI;
          |SI s_pas = 5;|Y #0#15 ! "T";|Y #0#15 ! "A"; corta = 1; |FINSI;
          |SI s_pas = 6;|Y #0#15 ! "T";|Y #0#15 ! "P"; corta = 1; |FINSI;
          |SI corta = 0;
               ||HAZ los_tcs;
               s_res = 0;
               |SI s_res = 0;
                    ant_centro = -1;
                    s_res = 0;
                    alfa1 = Usuario; |QBF alfa1;    alfa1 = "1" + alfa1;
                    |NOME_DAT #14 alfa1;
                    |ABRE #14;
                    |LEE 000#14p;            || para comprobar si hay algo
                    |SI FSalida ! 0;
                         s_res = 1;
                    |FINSI;
                    |CIERRA #14;
                    |SI s_res = 0;
                         aPorCentros = #10#45;
                         || #10#45 = "N"; || siempre por_empresa
                         || no se contemplan por centros en los agrarios de
                         || momento, aunque si que haya un centro normal y
                         || otro agrario
                         |SI #10#45 = "N";   |BUCLE por_empresa;   |FINSI;
                         |SI #10#45 = "S";   |BUCLE por_centros;   |FINSI;
                         |HAZ despues;
                         |HAZ actua_registro;
                    |FINSI;
               |FINSI;
          |FINSI;
     ||SIGUE;
|FPRC;

|PROCESO graba_nomcalca_2;
|DDEFECTO #20;
|PARA para1 = 0; |SI para1 [ 88; |HACIENDO para1 = para1 + 1;
        #20para1 = #18para1;
|SIGUE;
        #20#92 = #18#88;      || Bonif R.D.L. 16/2001 mayores 60 a¤os
        #20#99 = #18#106;     || Bonif mayores 59 a¤os, 4 de antig.
        #20#101 = #18#107;      || Horas subvencionadas formacion
        #20#121 = #18#164 + #18#165;      || cuota solidaridad
        #20#110 = #18#131;      || dias Control IT
        #20#111 = #18#132;      || base Control IT
        |SI #0#17 = 2;
               #20#159 = #18#171;      || dias finiquito mes de calculo
               #20#160 = #18#172;      || dias finiquito mes siguiente
               #20#148 = #18#148;      || total reduccion
               #20#149 = #18#149;      || % reduccion
        |FINSI;

||HAZ maternidad;
|GRABA 020#20n;
|FPRC;

|PROCESO CompCentro;
     #labtraba#0 = nEmp;
     #labtraba#1 = nTra;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          #tsilcon9#0 = #labtraba#0;
          #tsilcon9#1 = #labtraba#77;
          |LEE 000#tsilcon9.=;
          |SI FSalida = 0;
               |SI #tsilcon9#3 ! "*";
                    swStop = 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO graba_nomcalca;
     #23#1 = #18#0;
     #23#2 = #18#1;
     |LEE 000#23=;
     |SI FSalida = 0;|Y #23#7 ! "*";    |ACABA;   |FINSI;

     swStop = 0;
     nEmp = #nomcalca#0;
     nTra = #nomcalca#1;
     |HAZ CompCentro;
     |SI swStop = 1;
          |ACABA;
     |FINSI;

     |SI aParam ! "TC2";
          |HAZ graba_nomcalca_2;
     |SINO;
          |SI #18#3 ! 2;
               |HAZ graba_nomcalca_2;
          |SINO;
               || los finiquitos se refunden en el mes normal
               |DDEFECTO #20;
               #20#0 = #18#0;
               #20#1 = #18#1;
               #20#2 = #18#2;
               #20#3 = 0;
               |LEE 101#20=;
               FEstado = FSalida;
               #20#39 = #20#39 + #18#39; || base cont.comunes
               #20#40 = #20#40 + #18#40; || base cont.profes.
               #20#41 = #20#41 + #18#41; || base horas 1
               #20#42 = #20#42 + #18#42; || base horas 2
               #20#43 = #20#43 + #18#43; || base bonif. CC 1
               #20#44 = #20#44 + #18#44; || base bonif. CP 1
               #20#45 = #20#45 + #18#45; || s.s. cgo. empresa
               #20#48 = #20#48 + #18#48; || cuota cont.comunes
               #20#49 = #20#49 + #18#49; || cuota cont.profes.
               #20#50 = #20#50 + #18#50; || cuota horas 1
               #20#51 = #20#51 + #18#51; || cuota horas 2
               #20#57 = #20#57 + #18#57; || prest. enf. comun
               #20#58 = #20#58 + #18#58; || prest. accid.
               #20#59 = #20#59 + #18#59; || compl. enf. comun
               #20#60 = #20#60 + #18#60; || compl. accid.
               #20#62 = #20#62 + #18#62; || base ILT
               #20#63 = #20#63 + #18#63; || cuota bonif. 1
               #20#64 = #20#64 + #18#64; || subv. horas formacion
               #20#73 = #20#73 + #18#73; || prest. enf. comun empresa
               #20#79 = #20#79 + #18#79; || base bonif. CC 2
               #20#80 = #20#80 + #18#80; || base bonif. CP 2
               #20#81 = #20#81 + #18#81; || cuota bonif. 2
               #20#84 = #20#84 + #18#84; || base ILT bonif. 1
               #20#85 = #20#85 + #18#85; || base ILT bonif. 2
               #20#88 = #20#88 + #18#88; || cuota bonif. 16/2001

               |SI FEstado = 0; |GRABA 020#20a;     |FINSI;
               |SI FEstado ! 0; |GRABA 020#20n;     |FINSI;
               |LIBERA #20;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_nomcalca;
 #18#1;
 ;
 #6#0,     1, #0#1, tipo_bot;
 #6#0, 99999, #0#1, tipo_top;
 ;
 NULL, graba_nomcalca;
|FIN;

|PROCESO control;
     |DDEFECTO #36;
     |ABRE #36;
     |LEE 000#36p;
     |SI FSalida ! 0;
          |MENAV "    No existe control, usando defectos ...";
     |FINSI;
     |CIERRA #36;

     #36#17 = 3;    || paso, para los agrarios mensuales que lo haga
     #36#18 = 3;    || siempre como "3"
|FPRC;

|PROCESO carga_temporal;
     |HAZ control;
     |ABRE #20;
     ||ABRE #22;
     |ABRE #23;
     |SELECT #2#23;
     ||DDEFECTO #22;
     ||#22#0 = #10#32;
     ||LEE 000#22=;                 || lee la constante (para las maternidades)

     nCConst = 700;
     |HAZ constante;

     any_hist = #0#0 $ 100;    || a¤o historico
     |SI aParam ! "TC2";
          tipo_bot = #0#17;         || limites de tipo para el bucle
          tipo_top = #0#17;
     |FINSI;

     |SI #0#11 = "N";
          swSelEmp = 0;
     |SINO;
          swSelEmp = 1;
     |FINSI;

     |SI #0#12 = "M";
          |BUCLE lee_nomcalca;
          |HAZ los_tcs;
     |FINSI;

     |SI #0#12 = "H";
          |BUCLE lee_nomhicca;
          |HAZ los_tcs;
     |FINSI;

     |SI #0#12 = "A";
          |BUCLE lee_nomcalac;
          |HAZ los_tcs;
     |FINSI;

     ||SI #0#12 = "T";    |BUCLE lee_nomhicac;     |FINSI;
     |CIERRA #20;
     ||CIERRA #22;
     |CIERRA #23;
|FPRC;

_________________/ TRASPASO DE AUXILIARES DEL TC1 SI ESTAMOS IMPRIMIENDO TC2
|PROCESO nomwepig_1;
     |PARA para1 = 0; |SI para1 [ 19; |HACIENDO para1 = para1 + 1;
          |SI para1 ! 11;
               #53para1 = #51para1;
          |SINO;
               #53#11 = any_hist;
          |FINSI;
     |SIGUE;
     |SI eaFuente = "T";
          |SI #53#9 = 0; #53#9 = 5;     |FINSI;
          |SI #53#9 = 8; #53#9 = 6;     |FINSI;
          |SI #53#9 = 9; #53#9 = 7;     |FINSI;
          |SI #53#9 = 10; #53#9 = 15;   |FINSI;
          |SI #53#9 = 18; #53#9 = 16;   |FINSI;
          |SI #53#9 = 19; #53#9 = 17;   |FINSI;
     |FINSI;
     |SI aParam ! "TC2";|Y #0#17 = 2;|Y #53#9 = 0;
          #53#9 = 2;
     |FINSI;
     |BORRA 000#53c;
     |GRABA 020#53n;
|FPRC;

|PROCESO tempo7_1;
     |SI s_pas = 1;|O s_pas = 4;        || resto
          |SI #51#9 = 0;|O #51#9 = 10;  |HAZ nomwepig_1;    |FINSI;
     |FINSI;
     |SI s_pas = 2;|O s_pas = 5;        || aprendices
          |SI #51#9 = 8;|O #51#9 = 18;  |HAZ nomwepig_1;    |FINSI;
     |FINSI;
     |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
          |SI #51#9 = 9;|O #51#9 = 19;  |HAZ nomwepig_1;    |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE tempo7;
 #51#1;
 ;
 #10#0, 001, 01,   0,  0;
 #10#0, 999, 12, 999, 99;
 ;
 NULL, tempo7_1;
|FIN;

|PROCESO nomwepig;
     |ABRE #53;
     |BUCLE tempo7;
     |CIERRA #53;
|FPRC;

|PROCESO labemphi_1;
     |PARA para1 = 0; |SI para1 [ 92; |HACIENDO para1 = para1 + 1;
          |SI para1 ! 16;|Y para1 ! 19;
               #52para1 = #50para1;
          |SINO;
               |SI para1 = 16;
                    #52#16 = any_hist;
               |FINSI;
               |SI para1 = 19;
                    #52#19 = #50#16;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI eaFuente = "T";
          |SI #52#2 = 0; #52#2 = 5;     |FINSI;
          |SI #52#2 = 8; #52#2 = 6;     |FINSI;
          |SI #52#2 = 9; #52#2 = 7;     |FINSI;
          |SI #52#2 = 10; #52#2 = 15;   |FINSI;
          |SI #52#2 = 18; #52#2 = 16;   |FINSI;
          |SI #52#2 = 19; #52#2 = 17;   |FINSI;
     |FINSI;
     |SI aParam ! "TC2";|Y #0#17 = 2;|Y #52#2 = 0;
          #52#2 = 2;
     |FINSI;
     |BORRA 000#52c;
     |GRABA 020#52n;
|FPRC;

|PROCESO tempo4_1;
     |SI s_pas = 1;|O s_pas = 4;        || resto
          |SI #50#2 = 0;|O #50#2 = 10;  |HAZ labemphi_1;    |FINSI;
     |FINSI;
     |SI s_pas = 2;|O s_pas = 5;        || aprendices
          |SI #50#2 = 8;|O #50#2 = 18;  |HAZ labemphi_1;    |FINSI;
     |FINSI;
     |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
          |SI #50#2 = 9;|O #50#2 = 19;  |HAZ labemphi_1;    |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE tempo4;
 #50#1;
 ;
 #10#0, 001, 01,  0;
 #10#0, 999, 12, 99;
 ;
 NULL, tempo4_1;
|FIN;

|PROCESO labemphi;
     |ABRE #52;
     |BUCLE tempo4;
     |CIERRA #52;
|FPRC;

|PROCESO nomtepig_1;
     |SI eaFuente = "A";
          |SI #51#9 = 0; #51#9 = 5;     |FINSI;
          |SI #51#9 = 8; #51#9 = 6;     |FINSI;
          |SI #51#9 = 9; #51#9 = 7;     |FINSI;
          |SI #51#9 = 10; #51#9 = 15;   |FINSI;
          |SI #51#9 = 18; #51#9 = 16;   |FINSI;
          |SI #51#9 = 19; #51#9 = 17;   |FINSI;
     |FINSI;
     |SI aParam ! "TC2";|Y #0#17 = 2;|Y #51#9 = 0;
          #51#9 = 2;
     |FINSI;

     |NOME_DAT #51 "nomtepig";
     |ABRE #51;
     |BORRA 000#51c;
     |GRABA 020#51n;
     |CIERRA #51;

     |SI eaFuente = "A";
          |SI #51#9 = 5; #51#9 = 0;     |FINSI;
          |SI #51#9 = 6; #51#9 = 8;     |FINSI;
          |SI #51#9 = 7; #51#9 = 9;     |FINSI;   || repone para continuar
          |SI #51#9 = 15; #51#9 = 10;   |FINSI;   ||/con el bucle
          |SI #51#9 = 16; #51#9 = 18;   |FINSI;
          |SI #51#9 = 17; #51#9 = 19;   |FINSI;
     |FINSI;
     |SI aParam ! "TC2";|Y #0#17 = 2;|Y #51#9 = 2;
          #51#9 = 0;
     |FINSI;
|FPRC;

|PROCESO nomtepig;
     |PARA; |SI; |HACIENDO;
          |NOME_DAT #51 temp5;
          |ABRE #51;
          |SI nSwPrimera = 0;
               nSwPrimera = 1;
               |DDEFECTO #51;
               #51#0 = #10#0;
               |LEE 020#51];
               |SI FSalida ! 0;|O #51#0 ! #10#0;
                    |CIERRA #51;
                    |SAL;
               |FINSI;
          |SINO;
               |LEE 000#51=;
               |LEE 000#51s;
               |SI FSalida ! 0;|O #51#0 ! #10#0;
                    |CIERRA #51;
                    |SAL;
               |FINSI;
          |FINSI;
          |CIERRA #51;

          |SI s_pas = 1;|O s_pas = 4;        || resto
               |SI #51#9 = 0;|O #51#9 = 10;  |HAZ nomtepig_1;    |FINSI;
          |FINSI;
          |SI s_pas = 2;|O s_pas = 5;        || aprendices
               |SI #51#9 = 8;|O #51#9 = 18;  |HAZ nomtepig_1;    |FINSI;
          |FINSI;
          |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
               |SI #51#9 = 9;|O #51#9 = 19;  |HAZ nomtepig_1;    |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO labempax_1;
     |SI eaFuente = "A";
          |SI #50#2 = 0; #50#2 = 5;     |FINSI;
          |SI #50#2 = 8; #50#2 = 6;     |FINSI;
          |SI #50#2 = 9; #50#2 = 7;     |FINSI;
          |SI #50#2 = 10; #50#2 = 15;   |FINSI;
          |SI #50#2 = 18; #50#2 = 16;   |FINSI;
          |SI #50#2 = 19; #50#2 = 17;   |FINSI;
     |FINSI;
     |SI aParam ! "TC2";|Y #0#17 = 2;|Y #50#2 = 0;
          #50#2 = 2;
     |FINSI;

     |NOME_DAT #50 "labempax";
     |ABRE #50;
     |BORRA 000#50c;
     |GRABA 020#50n;
     |CIERRA #50;

     |SI eaFuente = "A";
          |SI #50#2 = 5; #50#2 = 0;     |FINSI;
          |SI #50#2 = 6; #50#2 = 8;     |FINSI;
          |SI #50#2 = 7; #50#2 = 9;     |FINSI;   || repone para continuar
          |SI #50#2 = 15; #50#2 = 10;   |FINSI;   ||/con el bucle
          |SI #50#2 = 16; #50#2 = 18;   |FINSI;
          |SI #50#2 = 17; #50#2 = 19;   |FINSI;
     |FINSI;
     |SI aParam ! "TC2";|Y #0#17 = 2;|Y #50#2 = 2;
          #50#2 = 0;
     |FINSI;
|FPRC;

|PROCESO labempax;
     |PARA; |SI; |HACIENDO;
          |NOME_DAT #50 temp4;
          |ABRE #50;
          |SI nSwPrimera = 0;
               nSwPrimera = 1;
               |DDEFECTO #50;
               #50#0 = #10#0;
               |LEE 020#50];
               |SI FSalida ! 0;|O #50#0 ! #10#0;
                    |CIERRA #50;
                    |SAL;
               |FINSI;
          |SINO;
               |LEE 000#50=;
               |LEE 000#50s;
               |SI FSalida ! 0;|O #50#0 ! #10#0;
                    |CIERRA #50;
                    |SAL;
               |FINSI;
          |FINSI;
          |CIERRA #50;

          |SI s_pas = 1;|O s_pas = 4;        || resto
               |SI #50#2 = 0;|O #50#2 = 10;  |HAZ labempax_1;    |FINSI;
          |FINSI;
          |SI s_pas = 2;|O s_pas = 5;        || aprendices
               |SI #50#2 = 8;|O #50#2 = 18;  |HAZ labempax_1;    |FINSI;
          |FINSI;
          |SI s_pas = 3;|O s_pas = 6;        || tiempo parcial
               |SI #50#2 = 9;|O #50#2 = 19;  |HAZ labempax_1;    |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO AuxiliaresTC1;
     |SI eaFuente = "M";|O eaFuente = "A";
          nSwPrimera = 0;     |HAZ labempax;
          nSwPrimera = 0;     |HAZ nomtepig;
     |FINSI;
     |SI eaFuente = "H";|O eaFuente = "T";
          |HAZ labemphi;
          |HAZ nomwepig;
     |FINSI;
|FPRC;

|PROCESO Activa20; |TIPO 7;
     |SI #0#14 = "L00";
          |CAMPO_MODIFICA #0#20, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#20, 1, "N";
     |FINSI;
|FPRC;

|PROCESO CamposCRA;
     |SI #0#21 = "S";
          |CAMPO_MODIFICA #0#22, 1, "S";
          |CAMPO_MODIFICA #0#23, 1, "S";
          #0#22 = #0#2 + 1;
          #0#23 = #0#3;
          |PINTA #0#22;
          |PINTA #0#23;
     |SINO;
          |CAMPO_MODIFICA #0#22, 1, "N";
          |CAMPO_MODIFICA #0#23, 1, "N";
          #0#22 = 00000;
          #0#23 = "        ";
          |PINTA #0#22;
          |PINTA #0#23;
     |FINSI;
|FPRC;

|PROCESO LanzaCRA;
     s_ori = #0#12;
     s_tat = #0#17;
     s_any = #0#0;
     s_mes = #0#1;
     s_has = #0#13;
     s_anyl = #0#18;
     s_sel = #0#11;
     s_lotecra = #0#22;
     s_fichcra = #0#23;
     |SUB_EJECUTA "silcon20;silcon16";
|FPRC;

|PROCESO GrabaLote;
     aAlfa1 = #0#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#3; |QBF aAlfa2;
     aAlfa3 = #0#4; |QBF aAlfa3;
     aAlfa = "    S¿Desea grabar el fichero " + aAlfa2 + "." + aAlfa3 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          enLote = #0#2;
          eaFich = #0#3; |QBF eaFich;
          eaExt = #0#4; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";
     |FINSI;
|FPRC;

|PROCESO GrabaLotes;
     aAlfa1 = #0#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#3; |QBF aAlfa2;
     aAlfa3 = #0#4; |QBF aAlfa3;

     aAlfa4 = #0#22; |QBF aAlfa4; aAlfa4 = ("00000" + aAlfa4) % -105;
     aAlfa5 = #0#23; |QBF aAlfa5;
     aAlfa6 = "cra"; |QBF aAlfa6;

     aAlfa = "    S¿Desea grabar los ficheros " + aAlfa2 + "." + aAlfa3 + " y ";
     aAlfa = aAlfa + aAlfa5 + "." + aAlfa6 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          enLote = #0#2;
          eaFich = #0#3; |QBF eaFich;
          eaExt = #0#4; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";

          enLote = #0#22;
          eaFich = #0#23; |QBF eaFich;
          eaExt = "cra"; |QBF eaExt;
          |SUB_EJECUTA "silcon05;silcon09";
     |FINSI;
|FPRC;
