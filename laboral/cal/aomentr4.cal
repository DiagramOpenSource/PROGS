|FICHEROS;
     aomentr4 #0;
     aomparam #1;
     aomentr3 #2;
     gomantl1@;
     gopre001@;
     gopre002@;
     gopre003@;
     goparame@;
     aomhoras;
     aomentrh #3,MANTE;
|FIN;

|VARIABLES;
     &enBoton = 0;
     aSer = "";
     aAlfa = "";
     aDef = "";
     aPath = "";
     aPathBas = "";
     aPathDef = "";
     aPathDat = "";
     &aTrabajador = "";
     &nUnidades = "";
     nModo = 0;
     &nPendientes = 0;
     &swPaso = 0;
|FIN;

|PROCESO Min;
     #gomantl1@#0 = aSer;
     #gomantl1@#1 = #2#1;
     #gomantl1@#2 = 001;

     #gopre002@#0 = #0#8;
     #gopre002@#1 = #0#9;
     #gopre002@#2 = 001;

     #gopre003@#0 = #0#8;
     #gopre003@#1 = #0#9;
     #gopre003@#2 = #0#11;
     #gopre003@#3 = 001;
|FPRC;

|PROCESO Max;
     #gomantl1@#0 = aSer;
     #gomantl1@#1 = #2#1;
     #gomantl1@#2 = 999;

     #gopre002@#0 = #0#8;
     #gopre002@#1 = #0#9;
     #gopre002@#2 = 999;

     #gopre003@#0 = #0#8;
     #gopre003@#1 = #0#9;
     #gopre003@#2 = #0#11;
     #gopre003@#3 = 999;
|FPRC;

|PROCESO PidePres; |TIPO 7;
/*
     |ABRE #1; |LEE 000#1p; |CIERRA #1;
     |SI #1#4 = "E"; |ACABA; |FINSI;

     |DBASS aPath;
     aPathBas = aPath + #1#1; |QBF aPathBas;
     aPathDef = aPathBas + "def/";
     aPathDat = aPathBas + "fich/" + (("00000" + #1#2) % -105) + "/";

     aDef = aPathDef + "gomantl1"; |CARGA_DEF aDef, gomantl1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aDef = aPathDef + "gopre001"; |CARGA_DEF aDef, gopre001@;
     aDef = aPathDef + "gopre002"; |CARGA_DEF aDef, gopre002@;
     aDef = aPathDef + "gopre003"; |CARGA_DEF aDef, gopre003@;
     aDef = aPathDef + "goparame"; |CARGA_DEF aDef, goparame@;

     |PATH_DAT #gomantl1@#aPathDat#;
     |PATH_DAT #gopre001@#aPathDat#;
     |PATH_DAT #gopre002@#aPathDat#;
     |PATH_DAT #gopre003@#aPathDat#;
     |PATH_DAT #goparame@#aPathDat#;

     |SI #1#4 = "C"; |O #1#4 = "P";
          aSer = ("00000" + #2#0) % -105;
          |ABRE #gomantl1@;
          |SELECT #2#gomantl1@;
          #gomantl1@#0 = aSer;
          #gomantl1@#1 = #2#1;
          #gomantl1@#3 = #0#8;
          #gomantl1@#4 = #0#9;
          |LEE 000#gomantl1@.];
          |SI FSalida = 0; |Y #gomantl1@#0 = aSer;  |Y #gomantl1@#1 = #2#1;
               |CONSULTA_F_CLAVE #1#gomantl1@, Min, Max;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    #0#8 = #gomantl1@#3;
                    #0#9 = #gomantl1@#4;

                    |ABRE #gopre001@;
                    #gopre001@#0 = #0#8;
                    #gopre001@#1 = #0#9;
                    |LEE 020#gopre001@.=;
                    |CIERRA #gopre001@;

                    #0#10 = #gopre001@#8;

                    |ABRE #gopre002@;
                    |SELECT #6#gopre002@;
                    #gopre002@#0 = #0#8;
                    #gopre002@#1 = #0#9;
                    #gopre002@#12 = #0#11;
                    |LEE 000#gopre002@.];
                    |CONSULTA_F_CLAVE #1#gopre002@, Min, Max;
                    |SI FSalida ! 0;
                         |ERROR;
                    |SINO;
                         #0#11 = #gopre002@#12;
                         #0#12 = #gopre002@#13;

                         |SI #1#4 = "P";
                              |ABRE #gopre003@;
                              |SELECT #2#gopre003@;
                              #gopre003@#0 = #0#8;
                              #gopre003@#1 = #0#9;
                              #gopre003@#2 = #0#11;
                              #gopre003@#4 = #0#13;
                              |LEE 000#gopre003@.];
                              |CONSULTA_F_CLAVE #1#gopre003@, Min, Max;
                              |SI FSalida ! 0;
                                   |ERROR;
                              |SINO;
                                   #0#13 = #gopre003@#4;
                                   #0#14 = #gopre003@#5;
                              |FINSI;
                              |CIERRA #gopre003@;
                         |FINSI;
                    |FINSI;
                    |CIERRA #gopre002@;
               |FINSI;
               |PINTA #0#8;
               |PINTA #0#9;
          |SINO;
               |MENAV "0000No existe lineas de expediente...";
               |ERROR;
          |FINSI;
     |FINSI;

     |DESCARGA_DEF #goparame@;
     |DESCARGA_DEF #gopre003@;
     |DESCARGA_DEF #gopre002@;
     |DESCARGA_DEF #gopre001@;
     |DESCARGA_DEF #gomantl1@;
*/
|FPRC;

|PROCESO DefectoCero; |TIPO 7;   || proceso para grabar el tipo de horas = tipo 00
     |ABRE #aomhoras;            || para vipei que NO usa el tipo de hora
     #aomhoras#0 = 00;
     |LEE 101#aomhoras.=;
     |SI FSalida ! 0;
          #aomhoras#0 = 00;
          #aomhoras#2 = "No se utiliza Tipo de Hora";
          |GRABA 020#aomhoras.n;
     |FINSI;
     |CIERRA #aomhoras;
|FPRC;

|PROCESO inferior;
     || #aomentrh#0 = aSer;           || serie expediente
     #aomentrh#0 = #aomentr4#1;    || serie expediente
     #aomentrh#1 = #aomentr4#7;    || nro expediente
     #aomentrh#2 = #aomentr4#2;    || empresa
     #aomentrh#4 = #aomentr4#3;    || trabajador
     #aomentrh#6 = #aomentr4#0;    || fecha
     #aomentrh#8 = 001;            || linea
|FPRC;

|PROCESO superior;
     || #aomentrh#0 = aSer;           || serie expediente
     #aomentrh#0 = #aomentr4#1;    || serie expediente
     #aomentrh#1 = #aomentr4#7;    || nro expediente
     #aomentrh#2 = #aomentr4#2;    || empresa
     #aomentrh#4 = #aomentr4#3;    || trabajador
     #aomentrh#6 = #aomentr4#0;    || fecha
     #aomentrh#8 = 999;            || linea
|FPRC;

|PROCESO F5;
     |PTEC 827;
|FPRC;

|PROCESO PidePres2;
     |PUSHV 13012380;

     |CONTROL_SIMPLE 0, "BOTON,F5 -Alta Partida", 2430, 2450, F5;
     enBoton = FSalida;
     |ESTADO_CONTROL enBoton, "DISABLE";

     nUnidades = #aomentr4#5;
     /*
     aSer = #aomentr4#1;
     |QBF aSer;
     aSer = ("00000" + aSer) % -105;
     */
     |SI nUnidades ! 0;
          swPaso = 0;
          |ENTLINEAL #1#aomentrh, -1, 9, 22, 1, inferior, superior;
     |FINSI;
     |PARA; |SI nPendientes ! 0; |HACIENDO;
          |SI nPendientes > 0;
               |MENAV "    ATENCION: Quedan unidades pendientes de asignar";
          |FINSI;
          |SI nPendientes < 0;
               |MENAV "    ATENCION: Se han asignado mas unidades de las disponibles";
          |FINSI;
          swPaso = 0;
          |ENTLINEAL #1#aomentrh, -1, 9, 22, 1, inferior, superior;
     |SIGUE;
     |FIN_CONTROL_WINDOWS enBoton;
     |PULSATECLA;
     |POPV;
|FPRC;

|PROCESO BorraLin;
     |BORRA 020#aomentrh.a;
|FPRC;

|DEFBUCLE BorraLin;
     #aomentrh#1;
     ;
     aAlfa, #aomentr4#7, #aomentr4#2, #aomentr4#3, #aomentr4#0, 001;
     aAlfa, #aomentr4#7, #aomentr4#2, #aomentr4#3, #aomentr4#0, 999;
     be;
     NULL, BorraLin;
|FIN;

|PROCESO BorraLineas; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          aAlfa = #aomentr4#1;
          |BUCLE BorraLin;
     |FINSI;
|FPRC;
