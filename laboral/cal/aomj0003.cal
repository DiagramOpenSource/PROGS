|FICHEROS;
     aomj0003 #0;
     temp0001@ #500;
     nomconli;
     nomtrali;
     nomcatli;
     labtraba;
|FIN;

|VARIABLES;
     aAlfa = "";
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;
     nCampo = 0;
     nNume = 0;
     swExiste = 0;
|FIN;

|PROCESO Comprueba; |TIPO 0;
     swExiste = 0;

     |ABRE #nomconli;
     #nomconli#0 = #labtraba#87;
     nCampo = Campo;
     #nomconli#2 = #0nCampo;
     |LEE 000#nomconli.=;
     nCampo = nCampo + 1;
     |SI FSalida = 0;
          #0nCampo = #nomconli#6;
          |PINTA #0nCampo;
     |SINO;
          aAlfa = "    ATENCION: Concepto no definido en convenio. Pulse F11 ";
          aAlfa = aAlfa + "para consultar.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
     |CIERRA #nomconli;

     |ABRE #nomtrali;
     #nomtrali#0 = #0#0;
     #nomtrali#1 = #0#1;
     nCampo = Campo;
     #nomtrali#2 = #0nCampo;
     |LEE 000#nomtrali.=;
     nCampo = nCampo + 2;
     |SI FSalida = 0;
          nNume = #nomtrali#4;
          #0nCampo = nNume;
          |PINTA #0nCampo;
          swExiste = 1;
     |FINSI;
     |CIERRA #nomconli;

     |SI swExiste = 0;
          |ABRE #nomcatli;
          #nomcatli#0 = #labtraba#87;
          #nomcatli#1 = #labtraba#17;
          nCampo = Campo;
          #nomcatli#2 = #0nCampo;
          |LEE 000#nomcatli.=;
          nCampo = nCampo + 2;
          |SI FSalida = 0;
               nNume = #nomcatli#4;
               #0nCampo = nNume;
               |PINTA #0nCampo;
          |SINO;
               aAlfa = "    ATENCION: Concepto no definido en importes por categoría ";
               aAlfa = aAlfa + "ni trabajador. No existe precio dieta.";
               |MENAV aAlfa;
          |FINSI;
          |CIERRA #nomconli;
     |FINSI;
|FPRC;

|PROCESO BuscaCon; |TIPO 66;
     aAlfa = "SELECT nomconli.2,nomconli.6 FROM nomconli INTO tm" + Usuario;
     aAlfa = aAlfa + ".def WHERE 0 == " + #labtraba#87;
     |SQL aAlfa;
     |SI FSalida ! 0;
          |MENAV "    No hay definidos conceptos en el convenio";
          |ERROR;
          |ACABA;
     |FINSI;
     |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
     |CARGA_DEF aAlfa , temp0001@;
     |SI FSalida = 0;
          aAlfa = "tm" + Usuario; |NOME_DAT #500 aAlfa;
          |ABRE #temp0001@;
          nModo = 2 + 4 + 8 + 16;
          nPos1 = 1250; nPos2 = 2380;
          |C_V #temp0001@#0, 1, "S";
          |C_V #temp0001@#1, 1, "S";
          |LINEAL_SIMPLE #1#temp0001@,nModo, nPos1, nPos2, NULL, NULL, NULL;
          |SI FSalida = 0;
               nCampo = Campo;
               #aomj0003#nCampo# = #temp0001@#0;
               |PINTA #aomj0003#nCampo#;
               nCampo = nCampo + 1;
               #aomj0003#nCampo# = #temp0001@#1;
               |PINTA #aomj0003#nCampo#;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #temp0001@;
          |DELINDEX #temp0001@;
          |DESCARGA_DEF #temp0001@;
     |FINSI;
     |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
     |FBORRA aAlfa;
|FPRC;
