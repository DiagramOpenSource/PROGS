|FICHEROS;
     nomcot31 #0;
     nomcot32;

     nomcot01;
     nomcot02;

     labempre;
     labtraba;
     labcentr;
     nomcenes;
|FIN;

|VARIABLES;
     aNaf = "";
     nCampo = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aParam = "";
|FIN;

|PROCESO inf;
     #nomcot02#0 = #0#0;
     #nomcot02#5 = aNaf;
     #nomcot02#1 = #0#2;
     #nomcot02#2 = #0#3;
     #nomcot02#3 = #0#4;
     #nomcot02#4 = "               ";
     #nomcot02#6 = 01;
|FPRC;

|PROCESO sup;
     #nomcot02#0 = #0#0;
     #nomcot02#5 = aNaf;
     #nomcot02#1 = #0#2;
     #nomcot02#2 = #0#3;
     #nomcot02#3 = #0#4;
     #nomcot02#4 = "zzzzzzzzzzzzzzz";
     #nomcot02#6 = 31;
|FPRC;

|PROCESO nomcot01;
     |PARA nCampo = 0; |SI nCampo [ 31; |HACIENDO nCampo = nCampo + 1;
          #nomcot32#nCampo# = #nomcot01#nCampo#;
     |SIGUE;
     |GRABA 020#nomcot32.n;
     |LIBERA #nomcot32;
|FPRC;

|DEFBUCLE nomcot01;
     #nomcot01#1;
     ;
     #0#0, #0#2, #0#3, #0#4, "               ", aNaf, 01;
     #0#0, #0#2, #0#3, #0#4, "zzzzzzzzzzzzzzz", aNaf, 31;
     ;
     NULL, nomcot01;
|FIN;

|PROCESO BuscaNaf;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          aNaf = #labtraba#75;
          |QBF aNaf;
          aAlfa1 = aNaf % 102;
          aAlfa2 = aNaf % 310;
          |QBF aAlfa2;
          aAlfa2 = ("0000000000" + aAlfa2) % -110;
          aNaf = aAlfa1 + aAlfa2;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROGRAMA;
     |CLS;

     |PINPA #0#0;

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |BORRA 020#0a;
     |FINSI;

     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida = 0;
          aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_nomcot32_" + aAlfa;
          |NOME_DAT #nomcot32#aAlfa#;
          |DELINDEX #nomcot32;
          |ABRE #nomcot01;
          |ABRE #nomcot02;
          |ABRE #nomcot32;
          |ABRE #labtraba;

          |HAZ BuscaNaf;

          aParam = PARAMETRO;
          |SI aParam = "D";
               |BUCLE nomcot01;
               |CONSULTA_CLAVE #1#nomcot32;
          |FINSI;
          |SI aParam = "T";
               |CONSULTA_F_CLAVE #2#nomcot02, inf, sup;
          |FINSI;


          |CIERRA #labtraba;
          |CIERRA #nomcot32;
          |DELINDEX #nomcot32;
          |CIERRA #nomcot02;
          |CIERRA #nomcot01;
     |FINSI;


     |GRABA 000#0n;
     |CIERRA #0;
|FPRO;
