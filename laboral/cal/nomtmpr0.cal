|FICHEROS;
     nomtmpr0 #0;
     nomtmpr1;
|FIN;

|VARIABLES;
     aAlfa = "";
     aOrigen = "";
     aRutaFich = "";
     aRutaOrigen = "";
     aDestino = "";
|FIN;

|PROCESO superior;
     #nomtmpr1#38 = #0#33;
     #nomtmpr1#0 = 99999;
     #nomtmpr1#2 = 99;
     #nomtmpr1#1 = 99999;
     #nomtmpr1#19 = 99;
     #nomtmpr1#23 = 9;
|FPRC;

|PROCESO inferior;
     #nomtmpr1#38 = #0#33;
     #nomtmpr1#0 = 00001;
     #nomtmpr1#2 = 01;
     #nomtmpr1#1 = 00001;
     #nomtmpr1#19 = 01;
     #nomtmpr1#23 = 0;
|FPRC;

|PROCESO PintaPantalla; |TIPO 14;
     |ATRI 0;

     |SI #0#14 = "M"; |PINTA 0753, " MENSUAL "; |FINSI;
     |SI #0#14 = "H"; |PINTA 0753, "HISTORICO"; |FINSI;
     |SI #0#14 = "A"; |PINTA 0753, " ATRASOS "; |FINSI;

     aAlfa = #0#41; |QBF aAlfa;
     |SI #0#14 = "M"; |O aAlfa = "PAGAS";
          |PINTA 1215, "³ A¤o ...........:               ³";
          |PINTA 1315, "³ Mes ...........:               ³";

          |CAMPO_VISUAL #0#16, 1, "S";
          |CAMPO_VISUAL #0#15, 1, "S";
          |CAMPO_POSICION #0#16, 1, 1235;
          |CAMPO_POSICION #0#15, 1, 1335;

          |PINTA #0#16;
          |PINTA #0#15;
          |SI aAlfa = "PAGAS";
               |CAMPO_VISUAL #0#4, 1, "N";
               |CAMPO_VISUAL #0#19, 1, "N";
               |CAMPO_VISUAL #0#7, 1, "N";
               |CAMPO_VISUAL #0#13, 1, "N";
               |PINTA 1815, "³                                                ³";
               |PINTA 1915, "³                                                ³";
          |SINO;
               |CAMPO_VISUAL #0#4, 1, "S";
               |CAMPO_VISUAL #0#19, 1, "S";
               |CAMPO_VISUAL #0#7, 1, "S";
               |CAMPO_VISUAL #0#13, 1, "S";
               |PINTA 1815, "³ Tipo de n¢mina ......:   -                     ³";
               |PINTA 1915, "³ Importe TC1 (S/N/A)..:   Trab. baja (A/B/T):   ³";
               |PINTA #0#4;
               |PINTA #0#19;
               |PINTA #0#7;
               |PINTA #0#13;
          |FINSI;
     |SINO;
          |PINTA 1266, "            ";
          |PINTA 1366, "            ";

          |PINTA 1215, "³ A¤os ..........:             ";
          |PINTA 1315, "³ Meses .........:             ";
          |PINTA #0#5;
          |PINTA #0#10;
          |PINTA #0#2;
          |PINTA #0#9;

          |CAMPO_VISUAL #0#4, 1, "S";
          |CAMPO_VISUAL #0#19, 1, "S";
          |CAMPO_VISUAL #0#7, 1, "S";
          |CAMPO_VISUAL #0#13, 1, "S";
          |PINTA 1815, "³ Tipo de n¢mina ......:   -                     ³";
          |PINTA 1915, "³ Importe TC1 (S/N/A)..:   Trab. baja (A/B/T):   ³";
          |PINTA #0#4;
          |PINTA #0#19;
          |PINTA #0#7;
          |PINTA #0#13;
     |FINSI;
     |ATRI 0;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = "Emisión";
     |SINO;
          |HAZ Informe;
     |FINSI;
|FPRC;

|PROCESO Informe;
          aAlfa = "c:\ds\crystal\cabecerah.dbf";
          |RFBORRA aAlfa;
          aAlfa = "c:\ds\crystal\detalleh.dbf";
          |RFBORRA aAlfa;

          aAlfa = #0#33; |QBF aAlfa;
          aAlfa = ("0000000" + aAlfa) % -107;
          aOrigen = aAlfa + "_";
          aAlfa = #0#34; |QBF aAlfa;
          aAlfa = (aAlfa % 102) + (aAlfa % 402) + (aAlfa % -104);
          aOrigen = aOrigen + aAlfa;
          aAlfa = #0#35; |QBF aAlfa;
          aAlfa = (aAlfa % 102) + (aAlfa % 402) + (aAlfa % 702);
          aOrigen = aOrigen + "_" + aAlfa;

          |DFICE aRutaFich;
          |QBF aRutaFich;
          aRutaOrigen = aRutaFich + "reg_res";
          aRutaOrigen = aRutaFich + "reg_res" + "/" + aOrigen + "_cab.dbf";

          aDestino = "c:\ds\crystal\cabecerah.dbf";

          |ENVIA_FICHERO aRutaOrigen, aDestino;

          |SI FSalida = 0;
               Impresora = "CrystalReport";
               |IMPRE -1;
               |INFOR "nomyrenh";
          |SINO;
               |MENAV "    ATENCION: no se han encontrado datos de esta emisión";
               |FININF;
               |ACABA;
          |FINSI;

          |DFICE aRutaFich;
          |QBF aRutaFich;
          aRutaOrigen = aRutaFich + "reg_res";
          aRutaOrigen = aRutaFich + "reg_res" + "/" + aOrigen + "_det.dbf";

          aDestino = "c:\ds\crystal\detalleh.dbf";

          |ENVIA_FICHERO aRutaOrigen, aDestino;

          |FININF;
          |FINIMP;
|FPRC;
