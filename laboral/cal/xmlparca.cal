|FICHEROS;
     xmlparca #0;
     xmlparli #1;
     xmlarbol #100;
|FIN;

|VARIABLES;
     swHayHijos = 0;
     aVengoDe = "";
     aEntComp = "";
     nContador = 0;
     aAlfa = "";
     aEntidad = "";
     nNume1 = 0;
     nNivel = 0;
     nElemento = 0;
     nPrimerDig = 1;
     aBlanco = " ";
     nBlancos = 0;
     aNivel = "";
     aNivel2 = "";
     nLongitud = 0;
     aLongitud = "";
     nCorta = 0;
     nCorta1 = 0;
     nCorta2 = 0;
     aParte1 = "";
     aParte2 = "";
     nNivel2 = 0;

     i = 0;
     j = 0;
     k = 0;
     swACero = 0;
|FIN;

|PROCESO QuitaCeros;
     |PARA i = 1; |SI i [ 21; |HACIENDO i = i + 1;
          || j = 100 + i;
          || j = (-1) * j;
          aAlfa = aNivel % -101;
          |SI aAlfa = "0";
               k = 20 - i;
               k = k + 100;
               aNivel = aNivel % k;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     |SI nNivel2 = 10; |O nNivel2 = 20; |O nNivel2 = 30; |O nNivel2 = 40;
      |O nNivel2 = 50; |O nNivel2 = 60; |O nNivel2 = 70; |O nNivel2 = 80;
          aNivel = aNivel + "0";
     |FINSI;
|FPRC;

|PROCESO Construye2;
     aNivel = aNivel + "00000000000000000000";
     aNivel = aNivel % 120;
     nCorta = nNivel * 2;
     nCorta1 = nCorta - 2;
     nCorta1 = 100 + nCorta1;
     aParte1 = aNivel % nCorta1;
     nCorta2 = 20 - nCorta;
     nCorta2 = -1 * (100 + nCorta2);
     aParte2 = aNivel % nCorta2;

     nCorta = 100 + nCorta;
     aNivel2 = aNivel % nCorta;
     aNivel2 = aNivel2 % -102;
     nNivel2 = aNivel2;
     nNivel2 = nNivel2 + 1;
     || aNivel2 = nNivel2;
     aNivel2 = #xmlparli#1;
     aNivel2 = "00" + aNivel2;
     aNivel2 = aNivel2 % -102;

     aNivel = aParte1 + aNivel2 + aParte2;
     |SI swACero = 1;
          aNivel = aNivel - aParte2;
          aNivel = aNivel + "0000000000000000000";
          aNivel = aNivel % 120;
     |FINSI;
     |HAZ QuitaCeros;
|FPRC;

|PROCESO ConstruyeNivel;
     |SI nElemento [ 1;
          nNivel = nNivel + 1;
     |FINSI;
     nContador = nContador + 1;
|FPRC;

|PROCESO BuscaHijos;
     swHayHijos = 1;

     aEntidad = #xmlparli#2;
     |HAZ impresion;
|FPRC;

|DEFBUCLE BuscaHijos;
     #xmlparli#1;
     ;
     aEntidad,   1;
     aEntidad, 999;
     ;
     NULL, BuscaHijos;
|FIN;

|PROCESO MarcaFin;
     |HAZ ConstruyeNivel;
     |HAZ Construye2
     #100#0 = nContador;
     #100#1 = nNivel;
     #100#2 = #xmlparli#2;
     |SI nNivel = 1;          || excepcion: la ultima
          #100#2 = #xmlparli#0;
     |FINSI;
     #100#3 = aNivel;
     #100#5 = 2;
     |GRABA 020#100n;
|FPRC;

|PROCESO impresion;
     swHayHijos = 0;
     #xmlparca#0 = aEntidad;
     |LEE 000#xmlparca.=;
     |SI FSalida = 0;         || tiene hijos
          |SALVA_FICHA #xmlparca;
          |SALVA_FICHA #xmlparli;

          swACero = 0;
          |SI nElemento ! 0;
               nNivel = nNivel - 1;
               swACero = 1;
          |FINSI;
          nElemento = 0;
          |HAZ ConstruyeNivel;
          |HAZ Construye2
          #100#0 = nContador;
          #100#1 = nNivel;
          #100#2 = aEntidad;
          #100#3 = aNivel;
          #100#5 = 0;              || abro entidad compleja
          |GRABA 020#100n;

          |BUCLE BuscaHijos;

          |SI swHayHijos = 0;
               nNivel = nNivel - 1;
               |REPON_FICHA #xmlparca;
               |REPON_FICHA #xmlparli;
               |PARA; |SI FSalida = -1; |HACIENDO;
                    |REPON_FICHA #xmlparca;
                    |REPON_FICHA #xmlparli;
                    ||HAZ MarcaFin2;
               |SIGUE;
               |HAZ MarcaFin;
          |FINSI;
     |SINO;
          nElemento = nElemento + 1;
          |HAZ ConstruyeNivel;
          |HAZ Construye2;
          #100#0 = nContador;
          #100#1 = nNivel;
          #100#2 = aEntidad;
          #100#3 = aNivel;
          #100#5 = 1;              || entidad simple
          |GRABA 020#100n;
     |FINSI;
|FPRC;

|PROCESO impresion1;
     aEntidad = #0#0;
     |HAZ impresion;
|FPRC;

|PROCESO ElPrint;
     aAlfa = "";
     nBlancos = #xmlarbol#1 - 1;
     |PARA nNume1 = 0; |SI nNume1 [ nBlancos; |HACIENDO nNume1 = nNume1 + 1;
          aAlfa = aAlfa + " ";
     |SIGUE;
     aAlfa = aAlfa + #xmlarbol#2;
     #xmlarbol#2 = aAlfa;
     |PRINT;
|FPRC;

|DEFBUCLE informe;
     #xmlarbol#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ElPrint;
|FIN;

|PROCESO informe;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "xmlarbol";
          |BUCLE informe;
          |PIEINF;
          |FININF;
     |FINSI;
     |FINIMP;
|FPRC;

|PROCESO arbol;
     |SI FSalida = 13;
          aAlfa = Usuario;    |QBT aAlfa;    aAlfa = ("x" + aAlfa) % 108;
          |NOME_DAT #100 aAlfa;
          |DELINDEX #100;
          |ABRE #100;
          aEntidad = #0#0;
          |HAZ impresion;
          |HAZ informe;
          |CIERRA #100;
     |FINSI;
|FPRC;
