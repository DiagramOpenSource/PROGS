||PROCESOS PARA LA IMPRESION DE LA NOMINA EN CRYSTAL REPORTS
/*
|FICHEROS;
     nombanco;
|FIN;

|VARIABLES;
     &aSit_lab = "":
     &aSit_fam = "";
     &aGrado_minus  = "";
     &aNif_conyuge  = "";
     &aP1       = "";
     &aP11      = "";
     &aP2       = "";
     &aP21      = "";
     &aP1_del   = "";
     &aP11_del  = "";
     &aP2_del   = "";
     &aP21_del  = "";
     &aP1_al    = "";
     &aP11_al   = "";
     &aP2_al    = "";
     &aP21_al   = "";
     &aP1_mes   = "";
     &aP11_mes  = "";
     &aP2_mes   = "";
     &aP21_mes  = "";
     &nP1_mes   = 0;
     &nP11_mes  = 0;
     &nP2_mes   = 0;
     &nP21_mes  = 0;
     aNume = "";
|FIN;

|PROCESO DatosPersonalesCR;
     |SI #agidanif#2 = "TITULAR     ";
          aCampo = "sit_lab";
          aAlfa = #agidanif#36; |QBF aAlfa;
          aAlfa = "A" + aAlfa;
          aValor = aAlfa;
          aSit_lab = aValor;

          aCampo = "sit_fam";      aValor = #agidanif#15;
          aSit_fam = aValor;

          aValor = #agidanif#17;
          |QBF aValor;
          |SI aValor ! "";
               aValor = aValor + "%";
          |FINSI;
          aCampo = "grado_minus";  aValor = #agidanif#17;
          aGrado_minus = aValor;

     |FINSI;
     |SI #agidanif#2 = "CONYUGE     ";
          aCampo = "nif_conyuge";  aValor = #agidanif#8;
          aNif_conyuge = aValor;
     |FINSI;
     |SI #agidanif#2 = "DESCENDIENTE";
          aAlfa1 = #agidanif#13;
          |QBF aAlfa1;
          aAlfa1 = aAlfa1 % -104;
          nNume1 = aAlfa1;              || El anyo de nacimiento
          fFecha = ~;
          aAlfa2 = fFecha;
          aAlfa2 = aAlfa2 % -104;
          nNume2 = aAlfa2;              || El anyo actual
          nEdad = nNume2 - nNume1;
          |SI nEdad < 3;
               nDesc3 = nDesc3 + 1;
          |FINSI;
          |SI nEdad ] 3; |Y nEdad < 25;
               nDesc25 = nDesc25 + 1;
          |FINSI;
     |FINSI;
     |SI #agidanif#2 = "ASCENDIENTE ";
          nAscen = nAscen + 1;
     |FINSI;
|FPRC;

|PROCESO BuscaBanco;
     enCodBanco = #labtraba#71;
     |HAZ LeeBancos;
     #nombanco#1 = #709#1;
|FPRC;

|DEFBUCLE agidanifCR;
     #agidanif#1;
     ;
     #10#12, 00;
     #10#12, 99;
     ;
     NULL, DatosPersonalesCR;
|FIN;

|PROCESO agidanifCR;
     aSit_lab = "":
     aSit_fam = "";
     aGrado_minus  = "";
     aNif_conyuge  = "";
     nDesc3 = 0;
     nDesc25 = 0;
     nAscen = 0;
     |BUCLE agidanifCR;
|FPRC;

|PROCESO Formatea;
     aAlfa = aNume % -301;
     |SI aAlfa = ".";
          |ACABA;
     |FINSI;
     aAlfa = aNume % -201;
     |SI aAlfa = ".";
          aNume = aNume + "0";
          |ACABA;
     |FINSI;
     |SI aNume ! "0";
          aNume = aNume + ",00";
     |SINO;
          aNume = "";
     |FINSI;
|FPRC;

|PROCESO CargaIndemnizaCR;
     aP1       = "";
     aP11      = "";
     aP2       = "";
     aP21      = "";
     aP1_del   = "";
     aP11_del  = "";
     aP2_del   = "";
     aP21_del  = "";
     aP1_al    = "";
     aP11_al   = "";
     aP2_al    = "";
     aP21_al   = "";
     aP1_mes   = "";
     aP11_mes  = "";
     aP2_mes   = "";
     aP21_mes  = "";
     nEnfer = 0;
     nAccid = 0;
     nP1_mes   = 0;
     nP11_mes  = 0;
     nP2_mes   = 0;
     nP21_mes  = 0;
     |SI #0#67 = "A"; |Y #0#10 = 2;
          |SI #10#103 > 0;
               #10#186 = "Enfermedad";
          |SINO;
               #10#186 = "";
          |FINSI;
          |SI #10#104 > 0;
               #10#187 = "Accidente";
          |SINO;
               #10#187 = "";
          |FINSI;
     |FINSI;
     |PARA i = 186; |SI i [ 189; |HACIENDO i = i + 1;
          para1 = i;
          para2 = i - 8;
          para3 = i - 4;
          |SI #10para1 = "Enfermedad";
               |HAZ ultimodia;
               |SI nEnfer [ 1;
                    |SI nEnfer = 0;
                         aCampo = "prestacion1"; aValor = "Enfermedad";
                         aP1 = aValor;
                         |SI #0#10 ! 2;
                              aCampo = "prestacion1_del";  nNume = #10para2;
                              |SI nNume [ 0;
                                   nNume = 1;
                              |FINSI;
                              aValor = nNume;
                              aP1_del = aValor;
                              aCampo = "prestacion1_al";   aValor = #10para3;
                              aP1_al = aValor;
                         |FINSI;
                    |SINO;
                         aCampo = "prestacion11"; aValor = "Enfermedad";
                         aP11 = aValor;
                         |SI #0#10 ! 2;
                              aCampo = "prestacion11_del";  nNume = #10para2;
                              |SI nNume [ 0;
                                   nNume = 1;
                              |FINSI;
                              aValor = nNume;
                              aP11_del = aValor;
                              aCampo = "prestacion11_al";   aValor = #10para3;
                              aP11_al = aValor;
                         |FINSI;
                    |FINSI;
               |FINSI;
               nEnfer  = nEnfer + 1;
          |FINSI;
          |SI #10para1 = "Accidente ";
               |HAZ ultimodia;
               |SI nAccid [ 1;
                    |SI nAccid = 0;
                         aCampo = "prestacion2"; aValor = "Accidente ";
                         aP2 = aValor;
                         |SI #0#10 ! 2;
                              aCampo = "prestacion2_del";  nNume = #10para2;
                              |SI nNume [ 0;
                                   nNume = 1;
                              |FINSI;
                              aValor = nNume;
                              aP2_del = aValor;
                              aCampo = "prestacion2_al";   aValor = #10para3;
                              aP2_al = aValor;
                         |FINSI;
                    |SINO;
                         aCampo = "prestacion21"; aValor = "Accidente ";
                         aP21 = aValor;
                         |SI #0#10 ! 2;
                              aCampo = "prestacion21_del";  nNume = #10para2;
                              |SI nNume [ 0;
                                   nNume = 1;
                              |FINSI;
                              aValor = nNume;
                              aP21_del = aValor;
                              aCampo = "prestacion21_al";   aValor = #10para3;
                              aP21_al = aValor;
                         |FINSI;
                    |FINSI;
               |FINSI;
               nAccid = nAccid + 1;
          |FINSI;
          |SI #10para1 = "Maternidad"; |O #10para1 = "Paternidad";
          |O #10para1 = "Riesgo Emb."; |O #10para1 = "IT >12 mes.";
               |HAZ ultimodia;
               aCampo = "prestacion2";
               |SI #10para1 = "Maternidad";
                    aValor = "Maternidad";
               |FINSI;
               |SI #10para1 = "Paternidad";
                    aValor = "Paternidad";
               |FINSI;
               |SI #10para1 = "Riesgo Emb.";
                    aValor = "Riesgo Emb.";
               |FINSI;
               |SI #10para1 = "IT >12 mes.";
                    aValor = "IT >12 mes.";
               |FINSI;
               aP2 = aValor;
               |SI #0#10 ! 2;
                      aCampo = "prestacion2_del";  nNume = #10para2;
                      |SI nNume [ 0;
                           nNume = 1;
                      |FINSI;
                      aValor = nNume;
                      aP2_del = aValor;
                      aCampo = "prestacion2_al";   aValor = #10para3;
                      aP2_al = aValor;
               |FINSI;
          |FINSI;
          |SI #10para1 = "Absentismo"; |Y #nomcontr#47 = "T";
               |SI para1 = 186;
                    aCampo = "prestacion1";
                    aValor = "ABSENTISMO";
                    aP1 = aValor;
               |FINSI;
               |SI para1 = 187;
                    aCampo = "prestacion11";
                    aValor = "ABSENTISMO";
                    aP11= aValor;
               |FINSI;
               |SI para1 = 188;
                    aCampo = "prestacion2";
                    aValor = "ABSENTISMO";
                    aP2 = aValor;
               |FINSI;
               |SI para1 = 189;
                    aCampo = "prestacion21";
                    aValor = "ABSENTISMO";
                    aP21 = aValor;
               |FINSI;
               |HAZ ultimodia;
               |SI #0#10 ! 2;
                    |SI para1 = 186;
                         aCampo = "prestacion1_del";  nNume = #10para2;
                         |SI nNume [ 0; nNume = 1; |FINSI;
                         aValor = nNume;
                         aP1_del = aValor;
                         aCampo = "prestacion1_al";   aValor = #10para3;
                         aP1_al = aValor;
                    |FINSI;
                    |SI para1 = 187;
                         aCampo = "prestacion11_del";  nNume = #10para2;
                         |SI nNume [ 0; nNume = 1; |FINSI;
                         aValor = nNume;
                         aP11_del = aValor;
                         aCampo = "prestacion11_al";   aValor = #10para3;
                         aP11_al = aValor;
                    |FINSI;
                    |SI para1 = 188;
                         aCampo = "prestacion2_del";  nNume = #10para2;
                         |SI nNume [ 0; nNume = 1; |FINSI;
                         aValor = nNume;
                         aP2_del = aValor;
                         aCampo = "prestacion2_al";   aValor = #10para3;
                         aP2_al = aValor;
                    |FINSI;
                    |SI para1 = 189;
                         aCampo = "prestacion21_del";  nNume = #10para2;
                         |SI nNume [ 0; nNume = 1; |FINSI;
                         aValor = nNume;
                         aP21_del = aValor;
                         aCampo = "prestacion21_al";   aValor = #10para3;
                         aP21_al = aValor;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI nEnfer > 0;
          |SI nEnfer = 1;
               aCampo = "prestacion1_mes";  aValor = #10#103;
               aNume = aValor;
               |HAZ Formatea;
               aValor = aNume;
               aP1_mes = aValor;
          |SINO;
               aCampo = "prestacion11_mes";  aValor = #10#103;
               aNume = aValor;
               |HAZ Formatea;
               aValor = aNume;
               aP11_mes = aValor;
          |FINSI;
     |FINSI;
     |SI nAccid > 0;
          |SI nAccid = 1;
               aCampo = "prestacion2_mes";  aValor = #10#104;
               aNume = aValor;
               |HAZ Formatea;
               aValor = aNume;
               aP2_mes = aValor;
          |SINO;
               aCampo = "prestacion21_mes";  aValor = #10#104;
               aNume = aValor;
               |HAZ Formatea;
               aValor = aNume;
               aP2_mes = aValor;
          |FINSI;
     |FINSI;
     |SI #10#198 ! 0; |Y #nomcontr#47 ! "T";
          aCampo = "prestacion21";
          nNume = #10#198;
          aValor = nNume;
          aValor = "ABSENTISMO: " + aValor + " dias";
          aP21 = aValor;
          aNume = #10#199;
          |HAZ Formatea;
          aValor = aNume;
          aP21_mes = aValor;
*/
/*
          |SI #0#10 ! 2;
                 aCampo = "prestacion21_del";  nNume = #10para2;
                 |SI nNume [ 0;
                      nNume = 1;
                 |FINSI;
                 aValor = nNume;
                 aP21_del = aValor;
                 aCampo = "prestacion21_al";   aValor = #10para3;
                 aP21_al = aValor;
          |FINSI;
*/
/*
     |FINSI;
|FPRC;

|PROCESO ImpCrystal;     || procesos necesarios para impresion de la nomina
                         || en Crystal Reports
     |SI Impresora = "CrystalReport"; |O #0#69 = "P";
          |HAZ agidanifCR;       ||Datos personales para Crystal Reports
          |HAZ CargaIndemnizaCR;   ||Prestaciones e indemnizaciones Crystal Reports
          |HAZ BuscaBanco;
          |SI #0#9 = 2;
               #1#07 = #6#07;
               #1#08 = #6#08;
               #1#06 = #6#06;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CrystalDescComp;
     |SI Impresora = "CrystalReport";
          |SI concep = 511; #10camdesc = "Comp. Enfermedad";      |FINSI;
          |SI concep = 512; #10camdesc = "Comp. Accidente";       |FINSI;
          |SI concep = 513; #10camdesc = "Comp. Maternidad";      |FINSI;
          |SI concep = 514; #10camdesc = "Comp. ILT";             |FINSI;
          |SI concep = 515; #10camdesc = "Enfermedad Empresa"; |FINSI;
     |FINSI;
|FPRC;
*/
