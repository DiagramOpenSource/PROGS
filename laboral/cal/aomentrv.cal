|FICHEROS;
     aomentrv #0;
     aomparam #1;
     aomentr2 #2;
     gomantl1@;
     gopre001@;
     gopre002@;
     gopre003@;
     goparame@;
|FIN;

|VARIABLES;
     aSer = "";
     aAlfa = "";
     aDef = "";
     aPath = "";
     aPathBas = "";
     aPathDef = "";
     aPathDat = "";
|FIN;

|PROCESO Min;
     #gomantl1@#0 = aSer;
     #gomantl1@#1 = #2#1;
     #gomantl1@#2 = 001;

     #gopre002@#0 = #0#8;
     #gopre002@#1 = #0#9;
     #gopre002@#2 = 001;

     #gopre003@#0 = #0#8;
     #gopre003@#1 = #0#9;
     #gopre003@#2 = #0#11;
     #gopre003@#3 = 001;
|FPRC;

|PROCESO Max;
     #gomantl1@#0 = aSer;
     #gomantl1@#1 = #2#1;
     #gomantl1@#2 = 999;

     #gopre002@#0 = #0#8;
     #gopre002@#1 = #0#9;
     #gopre002@#2 = 999;

     #gopre003@#0 = #0#8;
     #gopre003@#1 = #0#9;
     #gopre003@#2 = #0#11;
     #gopre003@#3 = 999;
|FPRC;

|PROCESO PidePres; |TIPO 0;
     |ABRE #1; |LEE 000#1p; |CIERRA #1;
     |SI #1#4 = "E"; |ACABA; |FINSI;

     |DBASS aPath;
     aPathBas = aPath + #1#1; |QBF aPathBas;
     aPathDef = aPathBas + "def/";
     aPathDat = aPathBas + "fich/" + (("00000" + #1#2) % -105) + "/";

     aDef = aPathDef + "gomantl1"; |CARGA_DEF aDef, gomantl1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aDef = aPathDef + "gopre001"; |CARGA_DEF aDef, gopre001@;
     aDef = aPathDef + "gopre002"; |CARGA_DEF aDef, gopre002@;
     aDef = aPathDef + "gopre003"; |CARGA_DEF aDef, gopre003@;
     aDef = aPathDef + "goparame"; |CARGA_DEF aDef, goparame@;

     |PATH_DAT #gomantl1@#aPathDat#;
     |PATH_DAT #gopre001@#aPathDat#;
     |PATH_DAT #gopre002@#aPathDat#;
     |PATH_DAT #gopre003@#aPathDat#;
     |PATH_DAT #goparame@#aPathDat#;

     |SI #1#4 = "C"; |O #1#4 = "P";
          aSer = ("00000" + #2#0) % -105;
          |ABRE #gomantl1@;
          |SELECT #2#gomantl1@;
          #gomantl1@#0 = aSer;
          #gomantl1@#1 = #2#1;
          #gomantl1@#3 = #0#8;
          #gomantl1@#4 = #0#9;
          |LEE 000#gomantl1@.];
          |SI FSalida = 0; |Y #gomantl1@#0 = aSer;  |Y #gomantl1@#1 = #2#1;
               |CONSULTA_F_CLAVE #1#gomantl1@, Min, Max;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    #0#8 = #gomantl1@#3;
                    #0#9 = #gomantl1@#4;

                    |ABRE #gopre001@;
                    #gopre001@#0 = #0#8;
                    #gopre001@#1 = #0#9;
                    |LEE 020#gopre001@.=;
                    |CIERRA #gopre001@;

                    #0#10 = #gopre001@#8;

                    |ABRE #gopre002@;
                    |SELECT #6#gopre002@;
                    #gopre002@#0 = #0#8;
                    #gopre002@#1 = #0#9;
                    #gopre002@#12 = #0#11;
                    |LEE 000#gopre002@.];
                    |CONSULTA_F_CLAVE #1#gopre002@, Min, Max;
                    |SI FSalida ! 0;
                         |ERROR;
                    |SINO;
                         #0#11 = #gopre002@#12;
                         #0#12 = #gopre002@#13;

                         |SI #1#4 = "P";
                              |ABRE #gopre003@;
                              |SELECT #2#gopre003@;
                              #gopre003@#0 = #0#8;
                              #gopre003@#1 = #0#9;
                              #gopre003@#2 = #0#11;
                              #gopre003@#4 = #0#13;
                              |LEE 000#gopre003@.];
                              |CONSULTA_F_CLAVE #1#gopre003@, Min, Max;
                              |SI FSalida ! 0;
                                   |ERROR;
                              |SINO;
                                   #0#13 = #gopre003@#4;
                                   #0#14 = #gopre003@#5;
                              |FINSI;
                              |CIERRA #gopre003@;
                         |FINSI;
                    |FINSI;
                    |CIERRA #gopre002@;
               |FINSI;
          |SINO;
               |MENAV "0000No existe lineas de expediente...";
               |ERROR;
          |FINSI;
     |FINSI;

     |DESCARGA_DEF #goparame@;
     |DESCARGA_DEF #gopre003@;
     |DESCARGA_DEF #gopre002@;
     |DESCARGA_DEF #gopre001@;
     |DESCARGA_DEF #gomantl1@;
|FPRC;
