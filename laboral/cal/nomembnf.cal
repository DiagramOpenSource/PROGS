|FICHEROS;
     nomembnf #0;
     nomembnt #100;

     labempre;
     labtraba;
     nomembca;
     nomembli;
|FIN;

|VARIABLES;
     nNume = 0;
     aAlfa = "";
     fFecha = @;
     alfa1 = "";
     nUltimoAny = 0;
|FIN;

|PROCESO Defectos;
     fFecha = ~;
     aAlfa = fFecha;
     aAlfa = aAlfa % -104;
     nNume = aAlfa;
     #0#5 = nNume;
     #0#6 = nNume;
|FPRC;

|PROCESO nomembnt;
     |PRINT;
|FPRC;

|DEFBUCLE nomembnt;
     #nomembnt#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomembnt;
|FIN;

|PROCESO Informe;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |INFOR "nomembnf";

     |BUCLE nomembnt;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO GrabaTmp;
     #labempre#0 = #nomembli#0;
     |LEE 000#labempre.=;

     #labtraba#0 = #nomembli#0;
     #labtraba#1 = #nomembli#1;
     |LEE 000#labtraba.=;

     |SI #labtraba#44 = "A";
          #100#0 = #nomembli#0;
          #100#1 = #nomembli#1;
          #100#2 = #labtraba#7;
          #100#3 = #labempre#2;
          #100#4 = #labtraba#2;
          #100#5 = #nomembli#2;
          #100#6 = #nomembli#27;
          #100#7 = #nomembli#28;
          #100#8 = #nomembli#29;

          |GRABA 020#100n;
          |LIBERA #100;
     |FINSI;
|FPRC;

|PROCESO LeeEmbargo;
     #nomembli#0 = #nomembca#0;
     #nomembli#1 = #nomembca#1;
     #nomembli#2 = nUltimoAny;
     |LEE 000#nomembli.=;
     |SI FSalida = 0;         || a la fuerza
          |SI #nomembli#29 ! 0;
               || tengo aun importe pendiente

               |HAZ GrabaTmp;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nomembli;
     nUltimoAny = #nomembli#2;
|FPRC;

|DEFBUCLE nomembli;
     #nomembli#1;
     ;
     #nomembca#0, #nomembca#1, #0#5;
     #nomembca#0, #nomembca#1, #0#6;
     ;
     NULL, nomembli;
|FIN;

|PROCESO nomembca;
     || primero busco el ultimo a¤o en que ha habido embargo
     nUltimoAny = 0;

     |BUCLE nomembli;

     || ya tengo el ultimo a¤o, ahora a ver si tengo embargo restante de
     || ese ultimo a¤o

     |HAZ LeeEmbargo;
|FPRC;

|DEFBUCLE nomembca;
     #nomembca#1;
     ;
     #0#0, #0#2;
     #0#1, #0#3;
     ;
     NULL, nomembca;
|FIN;

|PROGRAMA;
     |CLS;
     |HAZ Defectos;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #nomembca;
          |ABRE #nomembli;

          alfa1 = Usuario;     alfa1 = (alfa1 + "zzzzzzzz") % 108;
          |NOME_DAT #100 alfa1;
          |DELINDEX #100;
          |ABRE #100;

          |BUCLE nomembca;

          |CIERRA #100;
          |CIERRA #nomembli;
          |CIERRA #nomembca;
          |CIERRA #labtraba;
          |CIERRA #labempre;

          |HAZ Informe;
     |FINSI;
|FPRO;
