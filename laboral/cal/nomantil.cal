|FICHEROS;
     nomantig #0;
     nomantil #1;
     temp0001@ #500;
|FIN;

|VARIABLES;
     &nAnu = 0;
     &nBie = 0;
     &nTri = 0;
     &nCua = 0;
     &nQui = 0;
     nCampo = 0;
     nValor = 0;
     nAnyos = 0;
     nTipo = 0;
     nTot = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nAcum = 0;
     aAlfa = "";
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;
     nLlevo = 0;
     nOrden = 0;
|FIN;

|PROCESO GeneraImportesL;
     |SI FSalida = 13;
          |SI #0#7 = "1";
               |ACABA;
          |FINSI;
          nValor = #1Campo;
          nAcum = 0;
          #1Campo = 0;
          |PARA nCampo1 = 31; |SI nCampo1 [ 100; |HACIENDO nCampo1 = nCampo1 + 1;
               |SI nCampo1 = 41; nCampo1 = nCampo1 + 20; |FINSI;
               |SI nCampo1 = 71; nCampo1 = nCampo1 + 20; |FINSI;
               nCampo2 = nCampo1 - 20;
               |SI #1nCampo2 ! 0;
                    |SI #0#8 = "S";
                         #1nCampo1 = nValor;
                         |PINTA #1nCampo1;
                    |SINO;
                         |SI #1nCampo2 ! 99;
                              nAcum = nAcum + nValor;
                         |FINSI;
                         #1nCampo1 = nAcum;
                         |PINTA #1nCampo1;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LimpiaTramosL;
     |PARA nCampo = 11; |SI nCampo [ 80; |HACIENDO nCampo = nCampo + 1;
          |SI nCampo = 21; nCampo = nCampo + 20; |FINSI;
          |SI nCampo = 51; nCampo = nCampo + 20; |FINSI;
          |SI nCampo ] 81; |SAL;                 |FINSI;
          #1nCampo = 0;
          |PINTA #1nCampo;
     |SIGUE;
|FPRC;

|PROCESO PintaTramoL;
     |SI nCampo = 21; nCampo = nCampo + 20; |FINSI;
     |SI nCampo = 51; nCampo = nCampo + 20; |FINSI;
     |SI nCampo ] 81; |ACABA;               |FINSI;

     |SI nLlevo = nTot;       || el ultimo campo
          nValor = 99;
     |FINSI;

     #1nCampo = nValor;
     |PINTA #1nCampo;
     nAnyos = nValor;
     nCampo = nCampo + 1;
|FPRC;

|PROCESO GeneraTramosL; |TIPO 7;
/*
     |HAZ LimpiaTramosL;
     nAnyos = 0;
     nValor = 0;
     nLlevo = 0;
     nTot = nAnu + nBie + nTri + nCua + nQui;
     nTot = nTot + 1;         || esto para que me deje meter al final un 99

     nCampo = 11;
     |PARA nTipo = 1; |SI nTipo [ nAnu; |HACIENDO nTipo = nTipo + 1;
          nValor = nAnyos + 1;
          nLlevo = nLlevo + 1;     || para saber por que tramo voy
          |HAZ PintaTramoL;
     |SIGUE;
     |PARA nTipo = 1; |SI nTipo [ nBie; |HACIENDO nTipo = nTipo + 1;
          nValor = nAnyos + 2;
          nLlevo = nLlevo + 1;     || para saber por que tramo voy
          |HAZ PintaTramoL;
     |SIGUE;
     |PARA nTipo = 1; |SI nTipo [ nTri; |HACIENDO nTipo = nTipo + 1;
          nValor = nAnyos + 3;
          nLlevo = nLlevo + 1;     || para saber por que tramo voy
          |HAZ PintaTramoL;
     |SIGUE;
     |PARA nTipo = 1; |SI nTipo [ nCua; |HACIENDO nTipo = nTipo + 1;
          nValor = nAnyos + 4;
          nLlevo = nLlevo + 1;     || para saber por que tramo voy
          |HAZ PintaTramoL;
     |SIGUE;
     |PARA nTipo = 1; |SI nTipo [ nQui; |HACIENDO nTipo = nTipo + 1;
          nValor = nAnyos + 5;
          nLlevo = nLlevo + 1;     || para saber por que tramo voy
          |HAZ PintaTramoL;
     |SIGUE;

     || el ultimo, pinta 99
     nLlevo = nLlevo + 1;     || para saber por que tramo voy
     |HAZ PintaTramoL;

     |GRABA 020#1a;
*/
     |HAZ LimpiaTramosL;
     nAnyos = 0;
     nValor = 0;
     nLlevo = 0;
     nTot = nAnu + nBie + nTri + nCua + nQui;
     nTot = nTot + 1;         || esto para que me deje meter al final un 99

     nCampo = 11;

     |PARA nOrden = 1; |SI nOrden [ 5; |HACIENDO nOrden = nOrden + 1;
          |SI #0#102 = nOrden;
               |PARA nTipo = 1; |SI nTipo [ nAnu; |HACIENDO nTipo = nTipo + 1;
                    nValor = nAnyos + 1;
                    nLlevo = nLlevo + 1;     || para saber por que tramo voy
                    |HAZ PintaTramoL;
               |SIGUE;
          |FINSI;
          |SI #0#103 = nOrden;
               |PARA nTipo = 1; |SI nTipo [ nBie; |HACIENDO nTipo = nTipo + 1;
                    nValor = nAnyos + 2;
                    nLlevo = nLlevo + 1;     || para saber por que tramo voy
                    |HAZ PintaTramoL;
               |SIGUE;
          |FINSI;
          |SI #0#104 = nOrden;
               |PARA nTipo = 1; |SI nTipo [ nTri; |HACIENDO nTipo = nTipo + 1;
                    nValor = nAnyos + 3;
                    nLlevo = nLlevo + 1;     || para saber por que tramo voy
                    |HAZ PintaTramoL;
               |SIGUE;
          |FINSI;
          |SI #0#105 = nOrden;
               |PARA nTipo = 1; |SI nTipo [ nCua; |HACIENDO nTipo = nTipo + 1;
                    nValor = nAnyos + 4;
                    nLlevo = nLlevo + 1;     || para saber por que tramo voy
                    |HAZ PintaTramoL;
               |SIGUE;
          |FINSI;
          |SI #0#106 = nOrden;
               |PARA nTipo = 1; |SI nTipo [ nQui; |HACIENDO nTipo = nTipo + 1;
                    nValor = nAnyos + 5;
                    nLlevo = nLlevo + 1;     || para saber por que tramo voy
                    |HAZ PintaTramoL;
               |SIGUE;
          |FINSI;
     |SIGUE;
     || el ultimo, pinta 99
     nLlevo = nLlevo + 1;     || para saber por que tramo voy
     |HAZ PintaTramoL;

     |GRABA 020#1a;
|FPRC;

|PROCESO BuscaCat; |TIPO 11;
     |SI FSalida = 13;
          aAlfa = "SELECT nomcateg.1,nomcateg.2 FROM nomcateg INTO tm" + Usuario;
          aAlfa = aAlfa + ".def WHERE 0 == " + #nomantil#0;
          |SQL aAlfa;
          |SI FSalida ! 0;
               |MENAV "    No hay definidas categorias en el convenio";
               |ERROR;
               |ACABA;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
          |CARGA_DEF aAlfa , temp0001@;
          |SI FSalida = 0;
               aAlfa = "tm" + Usuario; |NOME_DAT #500 aAlfa;
               |ABRE #temp0001@;
               nModo = 2 + 4 + 8 + 16;
               nPos1 = 1125; nPos2 = 2280;
               |C_V #temp0001@#0, 1, "S";
               |C_V #temp0001@#1, 1, "S";
               |LINEAL_SIMPLE #1#temp0001@,nModo, nPos1, nPos2, NULL, NULL, NULL;
               |SI FSalida = 0;
                    #nomantil#1 = #temp0001@#0;
                    |PINTA #nomantil#1;
                    |ERROR;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #temp0001@;
               |DELINDEX #temp0001@;
               |DESCARGA_DEF #temp0001@;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
          |FBORRA aAlfa;
          |ACABA;
     |FINSI;
|FPRC;
