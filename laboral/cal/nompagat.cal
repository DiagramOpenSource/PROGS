|FICHEROS;
    nompagat #0;
    nomconca #1;
    labtraba #2;
    nomcontr #32;
    labtrtra #50;
|FIN;

|VARIABLES;
    aalta = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    any = 0;
    atope = 0;
    bisiesto = 0;
    con_ant = 0;
    confe = 0;
    d1 = 0;
    d2 = 0;
    d3 = 0;
    d4 = 0;
    d5 = 0;
    d6 = 0;
    d7 = 0;
    d8 = 0;
    d_mes = 0;
    dalta = 0;
    dd_1 = 0;
    dd_2 = 0;
    dd_3 = 0;
    dd_4 = 0;
    dd_5 = 0;
    dd_6 = 0;
    dd_7 = 0;
    dd_8 = 0;
    dedia = 0;
    des_tra = 0;
    dia = 0;
    dtope = 0;
    e1 = 0;
    e2 = 0;
    e3 = 0;
    e4 = 0;
    e5 = 0;
    e6 = 0;
    e7 = 0;
    e8 = 0;
    f1 = 0;
    f2 = 0;
    f3 = 0;
    f4 = 0;
    f5 = 0;
    f6 = 0;
    f7 = 0;
    f8 = 0;
    falta = 0;
    fecsys = @;
    ftope = 0;
    h1 = 0;
    h2 = 0;
    h3 = 0;
    h4 = 0;
    h5 = 0;
    h6 = 0;
    h7 = 0;
    h8 = 0;
    hadia = 0;
    has_tra = 0;
    hh_1 = 0;
    hh_2 = 0;
    hh_3 = 0;
    hh_4 = 0;
    hh_5 = 0;
    hh_6 = 0;
    hh_7 = 0;
    hh_8 = 0;
    malta = 0;
    medes = 0;
    mehas = 0;
    mes = 0;
    mtope = 0;
    nume0 = 0;
    nume1 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    nume6 = 0;
    p_mes = "";
    paga = 0;
    periodo = 0;
    puntero = 0;
    tipop = "";
    tope = 0;
    topemes = 0;
    v_t = 0;
    vale_1 = 0;
    vale_2 = 0;
    vale_3 = 0;
    vale_4 = 0;
    vale_5 = 0;
    vale_6 = 0;
    vale_7 = 0;
    vale_8 = 0;

    &nom_paga = "";
    &g_emp = 0;
    &g_tra = 0;
    para1 = 0;
    &el_mes = 0;
    &el_any = 0;

    pror_p = 0;
    para2 = 0;
|FIN;

**********************************************************************
    PROCESO
**********************************************************************

|PROCESO bucle;
|HAZ bucle0;
|HAZ bucle1;
|HAZ bucle2;
|FPRC;

**********************************************************************

|PROCESO bucle0;
|HAZ bucle01;
|FPRC;

|PROCESO bucle1;
|SI #2#87 ! con_ant;
        con_ant = #2#87;
    |HAZ bucle11;
|FINSI;
|FPRC;

|PROCESO bucle2;
|PARA paga = 1; |SI paga [ 8; |HACIENDO paga = paga + 1;
    |HAZ bucle21;
|SIGUE;

|PARA para1 = 0; |SI para1 [ 247; |HACIENDO para1 = para1 + 1;
        #50para1 = #2para1;
|SIGUE;

|| esto es porque los trabajadores que tiene la paga prorrateada en su ficha
|| les esta ocurriendo que tiene dias de los acumulados bases/dias de la
|| ficha del trabajador, y esto no es posible al ser prorrateada
|| debe de por haber efectuado un recalculo de pagas y este recalculo no tenia
|| en cuenta antes las pagas prorrateadas por trabajador, les esta acumulando
|| dias sin tener que hacerlo, lo soluciono asi. 01.04.2008

|PARA para1 = 113; |SI para1 [ 120; |HACIENDO para1 = para1 + 1;
     |SI #50para1 = "S";
          para2 = para1 - 58;
         #50para2 = 0;
     |FINSI;
|SIGUE;

|GRABA 020#50n;

|FPRC;

|DEFBUCLE nomcalpa0;
 #2#1;
 ;
 g_emp, g_tra;
 g_emp, g_tra;
 ;
 NULL, bucle;
|FIN;

|PROCESO Tipo8;
     |DDEFECTO #32;
     |ABRE #32;
     |LEE 000#32p;
     |CIERRA #32;
|FPRC;

|PROCESO pintames;
|SI el_mes =  1;  topemes = 31;             |FINSI;
|SI el_mes =  2;  topemes = 28 + bisiesto;  |FINSI;
|SI el_mes =  3;  topemes = 31;             |FINSI;
|SI el_mes =  4;  topemes = 30;             |FINSI;
|SI el_mes =  5;  topemes = 31;             |FINSI;
|SI el_mes =  6;  topemes = 30;             |FINSI;
|SI el_mes =  7;  topemes = 31;             |FINSI;
|SI el_mes =  8;  topemes = 31;             |FINSI;
|SI el_mes =  9;  topemes = 30;             |FINSI;
|SI el_mes = 10;  topemes = 31;             |FINSI;
|SI el_mes = 11;  topemes = 30;             |FINSI;
|SI el_mes = 12;  topemes = 31;             |FINSI;
|FPRC;

|PROCESO bisiesto;
    nume1 = el_any;
    nume1 = nume1 $ 4;
|SI nume1 = 0;|Y #32#9 = "S";
        bisiesto = 1;
|SINO;
        bisiesto = 0;
|FINSI;
|FPRC;

|PROGRAMA;
|HAZ Tipo8;
|HAZ bisiesto;
|HAZ pintames;

|NOME_DAT #50 nom_paga;
|ABRE #1;
|ABRE #50;
|BUCLE nomcalpa0;
|CIERRA #1;
|CIERRA #50;
|FPRO;

**********************************************************************
    RUTINAS
**********************************************************************

|PROCESO bucle01;
    alfa1 = #2#36 % 102;  dia = alfa1;
    alfa1 = #2#36 % 402;  mes = alfa1;
    alfa1 = #2#36 %-104;  any = alfa1;
    falta = (any  * 100) + mes;
    aalta =  any;
    malta =  mes;
    dalta =  dia;

    ftope = (el_any * 100) + el_mes;
    atope =  el_any;
    mtope =  el_mes;
    dtope =  topemes;
|FPRC;

**********************************************************************

|PROCESO bucle11;
    #1#0 = #2#87;
|LEE 020#1=;
|SI FSalida = 0;
        vale_1=0;  vale_2=0;  vale_3=0;  vale_4=0;
        vale_5=0;  vale_6=0;  vale_7=0;  vale_8=0;
    |PARA paga = 1; |SI paga [ 8; |HACIENDO paga = paga + 1;
        |HAZ bucle111;
        pror_p = paga + 112;   || prorrateo paga S/N (trabajador)
        |SI #labtraba#pror_p# = "S";
             confe = 99;
        |FINSI;

        |SI medes ! 0; |Y mehas ! 0; |Y confe ! 99; |Y tipop ! "P";
            |HAZ bucle112;
            |HAZ bucle113;
        |FINSI;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO bucle111;
    puntero = paga + 3;      medes = #1puntero;
    puntero = puntero + 8;   mehas = #1puntero;
    puntero = puntero + 8;   confe = #1puntero;
    puntero = puntero + 8;   tipop = #1puntero;
    puntero = paga + 107;    dedia = #1puntero;
    puntero = paga + 115;    hadia = #1puntero;
|FPRC;

|PROCESO bucle112;
|SI mehas < el_mes;
    |SI medes ] mehas;
            des_tra = ( el_any     *100) +medes;
            has_tra = ((el_any +1) *100) +mehas;
    |SINO;
            des_tra = ((el_any +1) *100) +medes;
            has_tra = ((el_any +1) *100) +mehas;
    |FINSI;
|SINO;
    |SI medes ] mehas;
            des_tra = ((el_any -1) *100) +medes;
            has_tra = ( el_any     *100) +mehas;
    |SINO;
            des_tra = ( el_any     *100) +medes;
            has_tra = ( el_any     *100) +mehas;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO bucle113;
|SI paga=1; dd_1=des_tra; hh_1=has_tra; vale_1=1;
            d1=medes; h1=mehas; e1=dedia; f1=hadia;
|FINSI;
|SI paga=2; dd_2=des_tra; hh_2=has_tra; vale_2=1;
            d2=medes; h2=mehas; e2=dedia; f2=hadia;
|FINSI;
|SI paga=3; dd_3=des_tra; hh_3=has_tra; vale_3=1;
            d3=medes; h3=mehas; e3=dedia; f3=hadia;
|FINSI;
|SI paga=4; dd_4=des_tra; hh_4=has_tra; vale_4=1;
            d4=medes; h4=mehas; e4=dedia; f4=hadia;
|FINSI;
|SI paga=5; dd_5=des_tra; hh_5=has_tra; vale_5=1;
            d5=medes; h5=mehas; e5=dedia; f5=hadia;
|FINSI;
|SI paga=6; dd_6=des_tra; hh_6=has_tra; vale_6=1;
            d6=medes; h6=mehas; e6=dedia; f6=hadia;
|FINSI;
|SI paga=7; dd_7=des_tra; hh_7=has_tra; vale_7=1;
            d7=medes; h7=mehas; e7=dedia; f7=hadia;
|FINSI;
|SI paga=8; dd_8=des_tra; hh_8=has_tra; vale_8=1;
            d8=medes; h8=mehas; e8=dedia; f8=hadia;
|FINSI;
|FPRC;

**********************************************************************

|PROCESO bucle21;
|HAZ bucle211;
|SI v_t = 1;
    |HAZ bucle212;
|FINSI;
|FPRC;

|PROCESO bucle211;
|SI paga=1; des_tra=dd_1; has_tra=hh_1; v_t=vale_1;
            medes=d1; mehas=h1; dedia=e1; hadia=f1;
|FINSI;
|SI paga=2; des_tra=dd_2; has_tra=hh_2; v_t=vale_2;
            medes=d2; mehas=h2; dedia=e2; hadia=f2;
|FINSI;
|SI paga=3; des_tra=dd_3; has_tra=hh_3; v_t=vale_3;
            medes=d3; mehas=h3; dedia=e3; hadia=f3;
|FINSI;
|SI paga=4; des_tra=dd_4; has_tra=hh_4; v_t=vale_4;
            medes=d4; mehas=h4; dedia=e4; hadia=f4;
|FINSI;
|SI paga=5; des_tra=dd_5; has_tra=hh_5; v_t=vale_5;
            medes=d5; mehas=h5; dedia=e5; hadia=f5;
|FINSI;
|SI paga=6; des_tra=dd_6; has_tra=hh_6; v_t=vale_6;
            medes=d6; mehas=h6; dedia=e6; hadia=f6;
|FINSI;
|SI paga=7; des_tra=dd_7; has_tra=hh_7; v_t=vale_7;
            medes=d7; mehas=h7; dedia=e7; hadia=f7;
|FINSI;
|SI paga=8; des_tra=dd_8; has_tra=hh_8; v_t=vale_8;
            medes=d8; mehas=h8; dedia=e8; hadia=f8;
|FINSI;
|FPRC;

/*
            |HAZ bucle213;
            |SI nume0 = aalta;
                |SI nume1 = malta;|Y nume1 ! medes; |Y nume1 ! mehas;
                        d_mes = (d_mes - dalta) + 1;
                |FINSI;
                |SI nume1 = malta;|Y nume1 = medes;
                    |SI dalta ] dedia;
                            d_mes = (d_mes - dalta) + 1;
                    |SINO;
                            d_mes = (d_mes - dedia) + 1;
                    |FINSI;
                |FINSI;
                |SI nume1 = malta;|Y nume1 = mehas;
                    |SI dalta > hadia;
                            d_mes = 0;
                    |SINO;
                            d_mes = (hadia - dalta) + 1;
                    |FINSI;
                |FINSI;
            |SINO;
                |SI nume1 = medes;|Y medes ! mehas;
                        d_mes = (d_mes - dedia) + 1;
                |FINSI;
                |SI nume1 = mehas;|Y medes ! mehas;
                        d_mes = hadia;
                |FINSI;
                |SI medes = mehas;|Y nume1 = medes;
                        nume4=mes    $100; nume4=    mes-nume4; nume4=nume4/100;
                        nume5=des_tra$100; nume5=des_tra-nume5; nume5=nume5/100;
                        nume6=has_tra$100; nume6=has_tra-nume6; nume6=nume6/100;
                    |SI nume4 = nume5;
                            d_mes = (d_mes - dedia) + 1;
                    |FINSI;
                    |SI nume4 = nume6;
                            d_mes = hadia;
                    |FINSI;
                |FINSI;
            |FINSI;
                periodo = periodo + d_mes;
*/

|PROCESO bucle212;
    periodo = 0;
|SI ftope ! has_tra;
    |SI has_tra<ftope;
            tope=has_tra;
    |SINO;
            tope=ftope;
    |FINSI;
    |PARA mes = des_tra; |SI mes [ has_tra; |HACIENDO mes = mes + 1;
            nume0=mes $ 100; nume0=mes-nume0; nume0=nume0/100;
            nume1=mes $ 100;
        |SI nume1>12;
                alfa1=mes; alfa1=alfa1%104; nume1=alfa1;
                nume1=nume1+1; mes=(nume1*100)+1;
                nume0=mes $ 100; nume0=mes-nume0; nume0=nume0/100;
                nume1=mes $ 100;
        |FINSI;
        |SI mes ] falta; |Y mes [ tope;
            |HAZ bucle213;
            |SI nume0 = aalta;|Y nume1 = malta;
                |SI nume1 ! medes; |Y nume1 ! mehas;
                        d_mes = (d_mes - dalta) + 1;
                |FINSI;
                |SI nume1 = medes;|Y nume1 ! mehas;
                    |SI dalta ] dedia;
                            d_mes = (d_mes - dalta) + 1;
                    |SINO;
                            d_mes = (d_mes - dedia) + 1;
                    |FINSI;
                |FINSI;
                |SI nume1 = mehas;|Y nume1 ! medes;
                    |SI dalta > hadia;
                            d_mes = 0;
                    |SINO;
                            d_mes = (hadia - dalta) + 1;
                    |FINSI;
                |FINSI;
                |SI nume1 = medes;|Y nume1 = mehas;
                    |SI dalta ] dedia;
                            d_mes = (d_mes - dalta) + 1;
                    |SINO;
                            d_mes = (d_mes - dedia) + 1;
                    |FINSI;
                |FINSI;
            |SINO;
                |SI nume1 = medes;|Y medes ! mehas;
                        d_mes = (d_mes - dedia) + 1;
                |FINSI;
                |SI nume1 = mehas;|Y medes ! mehas;
                        d_mes = hadia;
                |FINSI;
                |SI medes = mehas;|Y nume1 = medes;
                        nume4=mes    $100; nume4=    mes-nume4; nume4=nume4/100;
                        nume5=des_tra$100; nume5=des_tra-nume5; nume5=nume5/100;
                        nume6=has_tra$100; nume6=has_tra-nume6; nume6=nume6/100;
                    |SI nume4 = nume5;
                            d_mes = (d_mes - dedia) + 1;
                    |FINSI;
                    |SI nume4 = nume6;
                            d_mes = hadia;
                    |FINSI;
                |FINSI;
            |FINSI;
                periodo = periodo + d_mes;
        |FINSI;
    |SIGUE;
|SINO;
    |SI medes = mehas;
            nume3 = mehas;
        |HAZ bucle213;
            periodo = (d_mes - dedia) + 1;
    |FINSI;
|FINSI;
|HAZ bucle214;
|FPRC;

|PROCESO bucle213;
|SI #2#42 = "D"; |O #2#42 = "T";
        alfa1=mes; alfa1=alfa1%-102;  nume3=alfa1;
    |SI nume3 =  1;  d_mes = 31;             |FINSI;
    |SI nume3 =  2;  d_mes = 28 + bisiesto;  |FINSI;
    |SI nume3 =  3;  d_mes = 31;             |FINSI;
    |SI nume3 =  4;  d_mes = 30;             |FINSI;
    |SI nume3 =  5;  d_mes = 31;             |FINSI;
    |SI nume3 =  6;  d_mes = 30;             |FINSI;
    |SI nume3 =  7;  d_mes = 31;             |FINSI;
    |SI nume3 =  8;  d_mes = 31;             |FINSI;
    |SI nume3 =  9;  d_mes = 30;             |FINSI;
    |SI nume3 = 10;  d_mes = 31;             |FINSI;
    |SI nume3 = 11;  d_mes = 30;             |FINSI;
    |SI nume3 = 12;  d_mes = 31;             |FINSI;
|SINO;
        d_mes = 30;
|FINSI;
|FPRC;

|PROCESO bucle214;
|SI paga [ 5;
        puntero = 54;
|SINO;
        puntero = 75;  || (80-5) !!!
|FINSI;
    puntero = puntero + paga;
    #2puntero = periodo;
|FPRC;
