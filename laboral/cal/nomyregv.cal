|FICHEROS;
     nomyregv;

     labempre;
     labtraba;
     labcentr;
     nomconca;
     nomconli;
     nomdesam;
     nomcateg;

     nomcalca;
     nomcalli;
     nomhicca;
     nomhicli;

     nomw0025;
     nomw0026;
     nomw0027;
     nomw0028;
     nomw0029;
|FIN;

|VARIABLES;
     nBus                = 0;
     nCol                = 0;
     nCel                = 0;
     nTot                = 0;
     nAcu                = 0;
     nBas                = 0;
     nAsa                = 0;
     nCmp                = 0;
     nCen                = 0;
     nPos                = 0;
     nLon                = 0;
     nCar                = 0;
     nAny                = 0;
     nCat                = 0;
     nLin                = 0;
     nColAcu             = 0;
     nCol48              = 0;
     nCol49              = 0;
     nCol50              = 0;
     nCol51              = 0;
     nCol99              = 0;
     nCol100             = 0;
     nCol101             = 0;
     nColEx              = 0;
     nColUlt             = 0;
     nAnt                = 0;
     nAho                = 0;
     nDes                = 0;
     nT1H                = 0;
     nT1T                = 0;
     nT2H                = 0;
     nT2T                = 0;
     nT3T                = 0;
     nT3H                = 0;
     nCanT1              = 0;
     nCanT2              = 0;
     nCanT3              = 0;
     nCanM1              = 0;
     nCanM2              = 0;
     nCanM3              = 0;
     nCan                = 0;
     nTrab               = 0;
     nOk                 = 0;
     nHSC                = 0;
     nHST                = 0;
     nDA                 = 0;
     nDM                 = 0;
     nVal                = 0;
     nCf                 = 0;
     nCf1                = 0;
     nCf2                = 0;
     nPara1              = 0;

     aAlfa               = "";
     aAlfa1              = "";
     aAlfa2              = "";
     aFic                = "";
     aBase               = "";
     aOri                = "";
     aDes                = "";
     aFicExc             = "";
     aFicPla             = "";
     aIP                 = "";
     aPath               = "";
     aPathTrab           = "";
     aLon                = "";
     aCar                = "";
     aPer                = "";
     aLet                = "";
     aSex                = "";
     aSexI               = "";
     fFecha              = @;

     {1}aVer             = "";
|FIN;

|PROCESO BuscaLetra;
                     aLet = "";
     |SI nBus = 1;   aLet = "A";  |ACABA;   |FINSI;
     |SI nBus = 2;   aLet = "B";  |ACABA;   |FINSI;
     |SI nBus = 3;   aLet = "C";  |ACABA;   |FINSI;
     |SI nBus = 4;   aLet = "D";  |ACABA;   |FINSI;
     |SI nBus = 5;   aLet = "E";  |ACABA;   |FINSI;
     |SI nBus = 6;   aLet = "F";  |ACABA;   |FINSI;
     |SI nBus = 7;   aLet = "G";  |ACABA;   |FINSI;
     |SI nBus = 8;   aLet = "H";  |ACABA;   |FINSI;
     |SI nBus = 9;   aLet = "I";  |ACABA;   |FINSI;
     |SI nBus = 10;  aLet = "J";  |ACABA;   |FINSI;
     |SI nBus = 11;  aLet = "K";  |ACABA;   |FINSI;
     |SI nBus = 12;  aLet = "L";  |ACABA;   |FINSI;
     |SI nBus = 13;  aLet = "M";  |ACABA;   |FINSI;
     |SI nBus = 14;  aLet = "N";  |ACABA;   |FINSI;
     |SI nBus = 15;  aLet = "O";  |ACABA;   |FINSI;
     |SI nBus = 16;  aLet = "P";  |ACABA;   |FINSI;
     |SI nBus = 17;  aLet = "Q";  |ACABA;   |FINSI;
     |SI nBus = 18;  aLet = "R";  |ACABA;   |FINSI;
     |SI nBus = 19;  aLet = "S";  |ACABA;   |FINSI;
     |SI nBus = 20;  aLet = "T";  |ACABA;   |FINSI;
     |SI nBus = 21;  aLet = "U";  |ACABA;   |FINSI;
     |SI nBus = 22;  aLet = "V";  |ACABA;   |FINSI;
     |SI nBus = 23;  aLet = "W";  |ACABA;   |FINSI;
     |SI nBus = 24;  aLet = "X";  |ACABA;   |FINSI;
     |SI nBus = 25;  aLet = "Y";  |ACABA;   |FINSI;
     |SI nBus = 26;  aLet = "Z";  |ACABA;   |FINSI;

     |SI nBus = 27;  aLet = "AA"; |ACABA;   |FINSI;
     |SI nBus = 28;  aLet = "AB"; |ACABA;   |FINSI;
     |SI nBus = 29;  aLet = "AC"; |ACABA;   |FINSI;
     |SI nBus = 30;  aLet = "AD"; |ACABA;   |FINSI;
     |SI nBus = 31;  aLet = "AE"; |ACABA;   |FINSI;
     |SI nBus = 32;  aLet = "AF"; |ACABA;   |FINSI;
     |SI nBus = 33;  aLet = "AG"; |ACABA;   |FINSI;
     |SI nBus = 34;  aLet = "AH"; |ACABA;   |FINSI;
     |SI nBus = 35;  aLet = "AI"; |ACABA;   |FINSI;
     |SI nBus = 36;  aLet = "AJ"; |ACABA;   |FINSI;
     |SI nBus = 37;  aLet = "AK"; |ACABA;   |FINSI;
     |SI nBus = 38;  aLet = "AL"; |ACABA;   |FINSI;
     |SI nBus = 39;  aLet = "AM"; |ACABA;   |FINSI;
     |SI nBus = 40;  aLet = "AN"; |ACABA;   |FINSI;
     |SI nBus = 41;  aLet = "AO"; |ACABA;   |FINSI;
     |SI nBus = 42;  aLet = "AP"; |ACABA;   |FINSI;
     |SI nBus = 43;  aLet = "AQ"; |ACABA;   |FINSI;
     |SI nBus = 44;  aLet = "AR"; |ACABA;   |FINSI;
     |SI nBus = 45;  aLet = "AS"; |ACABA;   |FINSI;
     |SI nBus = 46;  aLet = "AT"; |ACABA;   |FINSI;
     |SI nBus = 47;  aLet = "AU"; |ACABA;   |FINSI;
     |SI nBus = 48;  aLet = "AV"; |ACABA;   |FINSI;
     |SI nBus = 49;  aLet = "AW"; |ACABA;   |FINSI;
     |SI nBus = 50;  aLet = "AX"; |ACABA;   |FINSI;
     |SI nBus = 51;  aLet = "AY"; |ACABA;   |FINSI;
     |SI nBus = 52;  aLet = "AZ"; |ACABA;   |FINSI;

     |SI nBus = 53;  aLet = "BA"; |ACABA;   |FINSI;
     |SI nBus = 54;  aLet = "BB"; |ACABA;   |FINSI;
     |SI nBus = 55;  aLet = "BC"; |ACABA;   |FINSI;
     |SI nBus = 56;  aLet = "BD"; |ACABA;   |FINSI;
     |SI nBus = 57;  aLet = "BE"; |ACABA;   |FINSI;
     |SI nBus = 58;  aLet = "BF"; |ACABA;   |FINSI;
     |SI nBus = 59;  aLet = "BG"; |ACABA;   |FINSI;
     |SI nBus = 60;  aLet = "BH"; |ACABA;   |FINSI;
     |SI nBus = 61;  aLet = "BI"; |ACABA;   |FINSI;
     |SI nBus = 62;  aLet = "BJ"; |ACABA;   |FINSI;
     |SI nBus = 63;  aLet = "BK"; |ACABA;   |FINSI;
     |SI nBus = 64;  aLet = "BL"; |ACABA;   |FINSI;
     |SI nBus = 65;  aLet = "BM"; |ACABA;   |FINSI;
     |SI nBus = 66;  aLet = "BN"; |ACABA;   |FINSI;
     |SI nBus = 67;  aLet = "BO"; |ACABA;   |FINSI;
     |SI nBus = 68;  aLet = "BP"; |ACABA;   |FINSI;
     |SI nBus = 69;  aLet = "BQ"; |ACABA;   |FINSI;
     |SI nBus = 70;  aLet = "BR"; |ACABA;   |FINSI;
     |SI nBus = 71;  aLet = "BS"; |ACABA;   |FINSI;
     |SI nBus = 72;  aLet = "BT"; |ACABA;   |FINSI;
     |SI nBus = 73;  aLet = "BU"; |ACABA;   |FINSI;
     |SI nBus = 74;  aLet = "BV"; |ACABA;   |FINSI;
     |SI nBus = 75;  aLet = "BW"; |ACABA;   |FINSI;
     |SI nBus = 76;  aLet = "BX"; |ACABA;   |FINSI;
     |SI nBus = 77;  aLet = "BY"; |ACABA;   |FINSI;
     |SI nBus = 78;  aLet = "BZ"; |ACABA;   |FINSI;

     |SI nBus = 79;  aLet = "CA"; |ACABA;   |FINSI;
     |SI nBus = 80;  aLet = "CB"; |ACABA;   |FINSI;
     |SI nBus = 81;  aLet = "CC"; |ACABA;   |FINSI;
     |SI nBus = 82;  aLet = "CD"; |ACABA;   |FINSI;
     |SI nBus = 83;  aLet = "CE"; |ACABA;   |FINSI;
     |SI nBus = 84;  aLet = "CF"; |ACABA;   |FINSI;
     |SI nBus = 85;  aLet = "CG"; |ACABA;   |FINSI;
     |SI nBus = 86;  aLet = "CH"; |ACABA;   |FINSI;
     |SI nBus = 87;  aLet = "CI"; |ACABA;   |FINSI;
     |SI nBus = 88;  aLet = "CJ"; |ACABA;   |FINSI;
     |SI nBus = 89;  aLet = "CK"; |ACABA;   |FINSI;
     |SI nBus = 90;  aLet = "CL"; |ACABA;   |FINSI;
     |SI nBus = 91;  aLet = "CM"; |ACABA;   |FINSI;
     |SI nBus = 92;  aLet = "CN"; |ACABA;   |FINSI;
     |SI nBus = 93;  aLet = "CO"; |ACABA;   |FINSI;
     |SI nBus = 94;  aLet = "CP"; |ACABA;   |FINSI;
     |SI nBus = 95;  aLet = "CQ"; |ACABA;   |FINSI;
     |SI nBus = 96;  aLet = "CR"; |ACABA;   |FINSI;
     |SI nBus = 97;  aLet = "CS"; |ACABA;   |FINSI;
     |SI nBus = 98;  aLet = "CT"; |ACABA;   |FINSI;
     |SI nBus = 99;  aLet = "CU"; |ACABA;   |FINSI;
     |SI nBus = 100; aLet = "CV"; |ACABA;   |FINSI;
     |SI nBus = 101; aLet = "CW"; |ACABA;   |FINSI;
     |SI nBus = 102; aLet = "CX"; |ACABA;   |FINSI;
|FPRC;

|PROCESO PonColorCeldaCab;
     aAlfa = aLet + "6,Módulo1.ColorCarne";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = aLet + "7,Módulo1.ColorCarne";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = aLet + "6,Módulo1.Bordes";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = aLet + "7,Módulo1.Bordes";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
|FPRC;

|PROCESO BorraVar;
     nCol48  = 0;
     nCol49  = 0;
     nCol50  = 0;
     nCol51  = 0;
     nCol99  = 0;
     nCol100 = 0;
     nCol101 = 0;
     nColEx  = 0;
     nColUlt = 0;
     nT1H    = 0;
     nT1T    = 0;
     nT2H    = 0;
     nT2T    = 0;
     nT3T    = 0;
     nT3H    = 0;
     nCanT1  = 0;
     nCanT2  = 0;
     nCanT3  = 0;
     nCanM1  = 0;
     nCanM2  = 0;
     nCanM3  = 0;
|FPRC;

|PROCESO PonCab;
     aPer = "";
     |SI #nomyregv#1 = 1;   aPer = aPer + "Enero ";       |FINSI;
     |SI #nomyregv#1 = 2;   aPer = aPer + "Febrero ";     |FINSI;
     |SI #nomyregv#1 = 3;   aPer = aPer + "Marzo ";       |FINSI;
     |SI #nomyregv#1 = 4;   aPer = aPer + "Abril ";       |FINSI;
     |SI #nomyregv#1 = 5;   aPer = aPer + "Mayo ";        |FINSI;
     |SI #nomyregv#1 = 6;   aPer = aPer + "Junio ";       |FINSI;
     |SI #nomyregv#1 = 7;   aPer = aPer + "Julio ";       |FINSI;
     |SI #nomyregv#1 = 8;   aPer = aPer + "Agosto ";      |FINSI;
     |SI #nomyregv#1 = 9;   aPer = aPer + "Septiembre ";  |FINSI;
     |SI #nomyregv#1 = 10;  aPer = aPer + "Octubre ";     |FINSI;
     |SI #nomyregv#1 = 11;  aPer = aPer + "Noviembre ";   |FINSI;
     |SI #nomyregv#1 = 12;  aPer = aPer + "Diciembre ";   |FINSI;

     aPer = aPer + " de " + #nomyregv#2;
     aAlfa = "F3, " + aPer;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "A4, Empresa " + (("00000" + #labempre#0) % -105);
     aAlfa = aAlfa + " - " + #labempre#2;  |QBF aAlfa;
     aAlfa = aAlfa + "   " + "Centro " + (("000" + #nomw0027#1) % -103);
     aAlfa = aAlfa + " " + #nomw0027#2;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nCel = 1;
     nCol = 3;
     |PARA nCmp = 2;  |SI nCmp [ 50;  |HACIENDO nCmp = nCmp + 1;
           aAlfa = #nomw0026#nCmp#;  |QBF aAlfa;
           |SI aAlfa ! "";
               nCel = nCel + 1;
               nCol = nCol + 1;
               nBus = nCol;
               |HAZ BuscaLetra;

               |SI nCmp = 48;  nCol48 = nCol;  |FINSI;
               |SI nCmp = 49;  nCol49 = nCol;  |FINSI;
               |SI nCmp = 50;  nCol50 = nCol;  |FINSI;

               aAlfa = aLet + "7, " + aAlfa;
               |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

               |HAZ PonColorCeldaCab;
           |FINSI;
     |SIGUE;

     nCel = nCel + 1;
     nCol = nCol + 1;
     nBus = nCol;
     |HAZ BuscaLetra;

     aAlfa = aLet + "7, " + "TOTAL PLUSES SALARIALES";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nColUlt = nCol;
     nCol51  = nCol;

     |HAZ PonColorCeldaCab;

     nBus = nCel;
     |HAZ BuscaLetra;

     aAlfa = "F1, " + "A1:" + aLet + "1";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "C6,Módulo1.Combinar";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "F1,  ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "C6, VALORES MEDIOS COMPLEMENTOS SALARIALES ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nCel   = 0;
     nColEx = nCol + 1;
     |PARA nCmp = 52;  |SI nCmp [ 100;  |HACIENDO nCmp = nCmp + 1;
           aAlfa = #nomw0026#nCmp#;  |QBF aAlfa;
           |SI aAlfa ! "";
               nCel = nCel + 1;
               nCol = nCol + 1;
               nBus = nCol;
               |HAZ BuscaLetra;

               |SI nCmp = 99;   nCol99  = nCol;  |FINSI;
               |SI nCmp = 100;  nCol100 = nCol;  |FINSI;

               aAlfa = aLet + "7, " + aAlfa;
               |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

               |HAZ PonColorCeldaCab;
           |FINSI;
     |SIGUE;

     |SI nCel ! 0;
         nCol = nCol + 1;
         nBus = nCol;
         |HAZ BuscaLetra;

         nCol101 = nCol;

         aAlfa = aLet + "7, " + "TOTAL PLUSES EXTRASALARIALES";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         |HAZ PonColorCeldaCab;

         nBus = nCel + 1;
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         nBus = nColUlt + 1;
         |HAZ BuscaLetra;

         aAlfa = aLet + "6,Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + "6, VALORES MEDIOS PERCEPCIONES EXTRASALARIALES ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     nCol    = nCol + 1;
     nBus    = nCol;
     |HAZ BuscaLetra;

     nColUlt = nCol;

     aAlfa = "F1, " + "A1:A2";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = aLet + "6,Módulo1.CombinaV";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "F1,  ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = aLet + "6, " + "TOTAL SALARIO MEDIO";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |HAZ PonColorCeldaCab;
|FPRC;

|PROCESO nomw0025;
     #nomw0028#0 = #nomw0025#0;
     #nomw0028#1 = #nomw0025#1;
     #nomw0028#2 = #nomw0025#2;
     #nomw0028#3 = #nomw0025#3;
     |LEE 000#nomw0028.=;
     |SI FSalida ! 0;  |DDEFECTO #nomw0028;  |FINSI;

     |SI nCat ! #nomw0025#2;  |O aSex ! #nomw0025#3;
         nLin = nLin + 1;

         aAlfa = "A" + nLin + ", " + #nomw0025#5;  |QBF aAlfa;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "B" + nLin + ", " + #nomw0025#3;  |QBF aAlfa;
         |SI #nomw0025#3 ! "TOTAL          ";
             aAlfa = aAlfa + "  (" + #nomw0028#4 + ")";
         |FINSI;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         |PARA nBus = nDes;  |SI nBus [ nColUlt;  |HACIENDO nBus = nBus + 1;
               |HAZ BuscaLetra;

               aLet = aLet + nLin;
               aAlfa = aLet + ",Módulo1.Bordes";
               |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
         |SIGUE;
     |FINSI;

     |SI #nomw0025#4 [ 47;
         nCol = #nomw0025#4 + 2;
     |FINSI;

     |SI #nomw0025#4 = 48; nCol = nCol48;  |FINSI;
     |SI #nomw0025#4 = 49; nCol = nCol49;  |FINSI;
     |SI #nomw0025#4 = 50; nCol = nCol50;  |FINSI;
     |SI #nomw0025#4 = 51; nCol = nCol51;  |FINSI;

     |SI #nomw0025#4 ] 52;
         nCol = nColEx + (#nomw0025#4 - 52);
     |FINSI;

     |SI #nomw0025#4 = 99;  nCol = nCol99;   |FINSI;
     |SI #nomw0025#4 = 100; nCol = nCol100;  |FINSI;
     |SI #nomw0025#4 = 101; nCol = nCol101;  |FINSI;
     |SI #nomw0025#4 = 102; nCol = nColUlt;  |FINSI;

     |SI #nomw0025#2 = 9999;
         |SI #nomw0025#3 = "HOMBRES        ";  |O #nomw0025#3 = "MUJERES        ";
          |O #nomw0025#3 = "SIN CLASIFICAR ";
             nCen        = #nomw0025#1;
             nColAcu     = #nomw0025#4;
             nTot        = (#nomw0025#6 / #nomw0028#4) ! 2;

             |SALVA_FICHA #nomw0025;
             |HAZ AcumulaTot;
             |REPON_FICHA #nomw0025;
         |FINSI;
     |FINSI;

     nBus = nCol;
     |HAZ BuscaLetra;

     |SI #nomw0025#3 ! "TOTAL          ";
         |SI #nomw0025#6 ! 0;
             #nomw0025#7 = #nomw0025#6 / #nomw0028#4;

             aLet = aLet + nLin;
             aAlfa = aLet + ", " + #nomw0025#7;
             |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
         |FINSI;
     |SINO;
         |SI #nomw0025#7 ! 0;
             aLet = aLet + nLin;
             aAlfa = aLet + ", " + #nomw0025#7;
             |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
         |FINSI;
     |FINSI;

     |SI #nomw0025#2 = 9999;
         |SI #nomw0025#4 = 51;
             |SI #nomw0025#3 = "HOMBRES        "; nT1H = #nomw0025#7;  |FINSI;
             |SI #nomw0025#3 = "TOTAL          "; nT1T = #nomw0025#7;  |FINSI;
         |FINSI;

         |SI #nomw0025#4 = 101;
             |SI #nomw0025#3 = "HOMBRES        "; nT2H = #nomw0025#7;  |FINSI;
             |SI #nomw0025#3 = "TOTAL          "; nT2T = #nomw0025#7;  |FINSI;
         |FINSI;

         |SI #nomw0025#4 = 102;
             |SI #nomw0025#3 = "HOMBRES        "; nT3H = #nomw0025#7;  |FINSI;
             |SI #nomw0025#3 = "TOTAL          "; nT3T = #nomw0025#7;  |FINSI;
         |FINSI;
     |FINSI;

     nCat = #nomw0025#2;
     aSex = #nomw0025#3;

     |PULSATECLA;
|FPRC;

|DEFBUCLE nomw0025_1;
     #nomw0025#1;
     ;
     #nomw0027#0, #nomw0027#1, 000, "          ", 000;
     #nomw0027#0, #nomw0027#1, 999, "zzzzzzzzzz", 999;
     ;
     NULL, nomw0025;
|FIN;

|DEFBUCLE nomw0025_2;
     #nomw0025#1;
     ;
     #nomw0027#0, #nomw0027#1, 9999, "          ", 000;
     #nomw0027#0, #nomw0027#1, 9999, "zzzzzzzzzz", 999;
     ;
     NULL, nomw0025;
|FIN;

|PROCESO DesviaHombre;
     nLin = nLin + 1;

     aAlfa = "B" + nLin + ", % HOMBRES";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI nCol51 ! 0;
         aLet = "B" + nLin;
         aAlfa = aLet + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol51 - 3;
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "C" + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "C" + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol51;
         |HAZ BuscaLetra;

         nCanT1 = ((nT1H * 100) / nT1T) ! 2;
         aAlfa = aLet + nLin + ", " + nCanT1;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;

     |SI nCol101 ! 0;
         nBus = (nCol101 - nCol51 - 1);
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         nBus = nCol51 + 1;
         |HAZ BuscaLetra;

         aAlfa = aLet + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol101;
         |HAZ BuscaLetra;

         nCanT2 = ((nT2H * 100) / nT2T) ! 2;
         aAlfa = aLet + nLin + ", " + nCanT2;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;

     nBus = nColUlt;
     |HAZ BuscaLetra;

     nCanT3 = ((nT3H * 100) / nT3T) ! 2;
     aAlfa = aLet + nLin + ", " + nCanT3;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = aLet + nLin + ",Módulo1.Bordes";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
|FPRC;

|PROCESO DesviaMujer;
     nLin = nLin + 1;

     aAlfa = "B" + nLin + ", % MUJERES";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI nCol51 ! 0;
         aLet = "B" + nLin;
         aAlfa = aLet + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol51 - 3;
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "C" + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "C" + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol51;
         |HAZ BuscaLetra;

         nCanM1 = 100 - (((nT1H * 100) / nT1T) ! 2);
         aAlfa = aLet + nLin + ", " + nCanM1;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;

     |SI nCol101 ! 0;
         nBus = (nCol101 - nCol51 - 1);
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         nBus = nCol51 + 1;
         |HAZ BuscaLetra;

         aAlfa = aLet + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol101;
         |HAZ BuscaLetra;

         nCanM2 = 100 - (((nT2H * 100) / nT2T) ! 2);
         aAlfa = aLet + nLin + ", " + nCanM2;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;

     nBus = nColUlt;
     |HAZ BuscaLetra;

     nCanM3 = 100 - (((nT3H * 100) / nT3T) ! 2);
     aAlfa = aLet + nLin + ", " + nCanM3;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = aLet + nLin + ",Módulo1.Bordes";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
|FPRC;

|PROCESO nomw0029;
     nTrab = nTrab + 1;
|FPRC;

|DEFBUCLE nomw0029;
     #nomw0029#1;
     ;
     #nomw0027#0, #nomw0027#1, "            ";
     #nomw0027#0, #nomw0027#1, "zzzzzzzzzzzz";
     ;
     NULL, nomw0029;
|FIN;

|PROCESO DesviaTotal;
     nTrab = 0;
     |BUCLE nomw0029;

     nLin = nLin + 1;
     nOk  = 0;

     aAlfa = "B" + nLin + ", DIFERENCIA";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI nCol51 ! 0;
         aLet = "B" + nLin;
         aAlfa = aLet + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol51 - 3;
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "C" + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "C" + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol51;
         |HAZ BuscaLetra;

         nCan = nCanT1 - nCanM1;
         |SI nCan < 0;  nCan = nCan * -1;  |FINSI;
         aAlfa = aLet + nLin + ", " + nCan;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

/*
         |SI nTrab ] 50;
             |SI nCan > 25;
                 aAlfa = aLet + nLin + ",Módulo1.ColorRojo";
                 |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
                 nOk  = 1;
             |FINSI;
         |FINSI;
*/
     |FINSI;

     |SI nCol101 ! 0;
         nBus = (nCol101 - nCol51 - 1);
         |HAZ BuscaLetra;

         aAlfa = "F1, " + "A1:" + aLet + "1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         nBus = nCol51 + 1;
         |HAZ BuscaLetra;

         aAlfa = aLet + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         nBus = nCol101;
         |HAZ BuscaLetra;

         nCan = nCanT2 - nCanM2;
         |SI nCan < 0;  nCan = nCan * -1;  |FINSI;
         aAlfa = aLet + nLin + ", " + nCan;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = aLet + nLin + ",Módulo1.Bordes";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

/*
         |SI nTrab ] 50;
             |SI nCan > 25;
                 aAlfa = aLet + nLin + ",Módulo1.ColorRojo";
                 |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
                 nOk  = 1;
             |FINSI;
         |FINSI;
*/
     |FINSI;

     nBus = nColUlt;
     |HAZ BuscaLetra;

     nCan = nCanT3 - nCanM3;
     |SI nCan < 0;  nCan = nCan * -1;  |FINSI;
     aAlfa = aLet + nLin + ", " + nCan;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = aLet + nLin + ",Módulo1.Bordes";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     |SI nTrab ] 50;
         |SI nCan > 25;
             aAlfa = aLet + nLin + ",Módulo1.ColorRojo";
             |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
             nOk  = 1;
         |FINSI;
     |FINSI;

     |SI nOk = 1;
         nLin = nLin + 2;

         aAlfa = "F1, " + "A1:H1";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "A" + nLin + ",Módulo1.Combinar";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "F1,  ";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "A" + nLin + ",Módulo1.Izq_Neg";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

         aAlfa = "A" + nLin + ", ";
         aAlfa = aAlfa + "* La empresa ha superado el l¡mite del 25% y deber  incluir ";
         aAlfa = aAlfa + "en el registro una justificaci¢n al respecto";
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

         aAlfa = "A" + nLin + ",Módulo1.Izq_Neg";
         |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;
|FPRC;


|PROCESO Desviacion;
     nLin = nLin + 2;

     aAlfa = "F1, " + "A1:" + "F1";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "B" + nLin + ",Módulo1.Combinar";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "B" + nLin + ",Módulo1.Izq_Neg";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "F1,  ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "B" + nLin + ",  % DESVIACION";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |HAZ DesviaHombre;
     |HAZ DesviaMujer;
     |HAZ DesviaTotal;
|FPRC;

|PROCESO PonLin;
     nCat = 0;
     aSex = "";
     nLin = 7;
     nDes = 1;
     |BUCLE nomw0025_1;

     nCat = 0;
     aSex = "";
     nDes = 2;
     nLin = nLin + 2;

     aAlfa = "F1, " + "A1:" + "F1";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "B" + nLin + ",Módulo1.Combinar";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "B" + nLin + ",Módulo1.Izq_Neg";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "F1,  ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "B" + nLin + ",  RESUMEN VALORES MEDIOS";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |BUCLE nomw0025_2;

     |HAZ Desviacion;

     |PULSATECLA;
|FPRC;

|PROCESO ExtraePath;
     aPath = aVer1;
     aLon = aPath % 0;
     nLon = aLon;
     |PARA nPos = 1; |SI nPos [ nLon; |HACIENDO nPos = nPos + 1;
           nCar = (nPos * 100) + 1;
           aCar = aPath % nCar;
           |SI aCar = ",";
               nPos = nLon - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO ProcesaExcel;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;

     aFicExc = (("00000" + #nomw0027#0) % -105) + (("000" + #nomw0027#1) % -103) + ".xls";

     aOri = aPathTrab + aFicPla;
     aDes = aPathTrab + "trabajo.xls";
     |RCOPIA_FICHERO aOri, aDes;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDes;

     aAlfa = aPathTrab + aFicExc;
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";

     |HAZ BorraVar;
     |HAZ PonCab;
     |HAZ PonLin;

     aAlfa = aPathTrab + aFicExc;
     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;
     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";

     aAlfa = aPathTrab + "trabajo.xls";
     |RFBORRA aAlfa;

     |DESCARGADLL "agixl97.dll";

     aVer1 = "Excel.Sheet";
     |ESPECIFICA "VERSION_PROGRAMA", aVer;
     |HAZ ExtraePath;
     |SI aPath = "NO LOCALIZADO";
         |MENAV "0000 Se ha producido un error en la conexión con Excel";
         |ACABA;
     |FINSI;

     aAlfa = aPathTrab + aFicExc;
     |QBF aPath;
     aAlfa = "cmd " + &34 + "/c START " + aAlfa + &34;
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO nomw0027;
     |HAZ ProcesaExcel;
|FPRC;

|DEFBUCLE nomw0027;
     #nomw0027#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomw0027;
|FIN;

|| --------------------------------------------------------------------------

|PROCESO AcumulaCat;
     |SI nTot = 0;
         |ACABA;
     |FINSI;

     #nomw0026#nColAcu# = aAlfa1;

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = #labtraba#17;
     #nomw0025#3 = aSex;
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = #labtraba#17;
         #nomw0025#3 = aSex;
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = #nomcateg#2;
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#6 = #nomw0025#6 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;

|| Esto es para crear la fila contraria por si no tiene importes

     |SI aSex = "HOMBRES";
         aSexI = "MUJERES";
     |FINSI;

     |SI aSex = "MUJERES";
         aSexI = "HOMBRES";
     |FINSI;

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = #labtraba#17;
     #nomw0025#3 = aSexI;
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = #labtraba#17;
         #nomw0025#3 = aSexI;
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = #nomcateg#2;
         |GRABA 020#nomw0025.n;
     |FINSI;

|| Se Acumula todo los importes del primer o segundo apartado

     |SI nColAcu [ 50;
         nColAcu = 51;
     |SINO;
         nColAcu = 101;
     |FINSI;

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = #labtraba#17;
     #nomw0025#3 = aSex;
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = #labtraba#17;
         #nomw0025#3 = aSex;
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = #nomcateg#2;
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#6 = #nomw0025#6 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;


|| Se Acumula todo los importes de la fila

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = #labtraba#17;
     #nomw0025#3 = aSex;
     #nomw0025#4 = 102;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = #labtraba#17;
         #nomw0025#3 = aSex;
         #nomw0025#4 = 102;
         #nomw0025#5 = #nomcateg#2;
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#6 = #nomw0025#6 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;


     #nomw0027#0 = #labempre#0;
     #nomw0027#1 = nCen;
     |LEE 000#nomw0027.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0027;
         #nomw0027#0 = #labempre#0;
         #nomw0027#1 = nCen;
         #nomw0027#2 = "Todos los centros";
         |SI nCen ! 0;
             #labcentr#0 = #labempre#0;
             #labcentr#1 = nCen;
             |LEE 000#labcentr.=;

             #nomw0027#2 = #labcentr#2;
         |FINSI;

         |GRABA 020#nomw0027.n;
         |LIBERA #nomw0027;
     |FINSI;
|FPRC;

|PROCESOAcumulaTot;
     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = 9999;
     #nomw0025#3 = "TOTAL";
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = 9999;
         #nomw0025#3 = "TOTAL";
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = "";
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#7 = #nomw0025#7 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;
|FPRC;

|PROCESO AcumulaSex;
     |SI nTot = 0;
         |ACABA;
     |FINSI;

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = 9999;
     #nomw0025#3 = aSex;
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = 9999;
         #nomw0025#3 = aSex;
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = "";
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#6 = #nomw0025#6 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;

     |SI aSex = "HOMBRES";
         aSexI = "MUJERES";
     |FINSI;

     |SI aSex = "MUJERES";
         aSexI = "HOMBRES";
     |FINSI;

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = 9999;
     #nomw0025#3 = aSexI;
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = 9999;
         #nomw0025#3 = aSexI;
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = "";
         |GRABA 020#nomw0025.n;
     |FINSI;

|| Se Acumula todo los importes del primer o segundo apartado

     |SI nColAcu [ 50;
         nColAcu = 51;
     |SINO;
         nColAcu = 101;
     |FINSI;

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = 9999;
     #nomw0025#3 = aSex;
     #nomw0025#4 = nColAcu;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = 9999;
         #nomw0025#3 = aSex;
         #nomw0025#4 = nColAcu;
         #nomw0025#5 = "";
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#6 = #nomw0025#6 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;

|| Se Acumula todo los importes de la fila

     #nomw0025#0 = #labempre#0;
     #nomw0025#1 = nCen;
     #nomw0025#2 = 9999;
     #nomw0025#3 = aSex;
     #nomw0025#4 = 102;
     |LEE 101#nomw0025.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0025;
         #nomw0025#0 = #labempre#0;
         #nomw0025#1 = nCen;
         #nomw0025#2 = 9999;
         #nomw0025#3 = aSex;
         #nomw0025#4 = 102;
         #nomw0025#5 = "";
         |GRABA 020#nomw0025.b;
     |FINSI;

     #nomw0025#6 = #nomw0025#6 + nTot;

     |GRABA 020#nomw0025.a;
     |LIBERA #nomw0025;
|FPRC;

|PROCESO AcumulaTrab;
     nHSC = #nomconca#162;
     |SI nHSC = 0;  nHSC = 40;  |FINSI;

     nHST = #labtraba#234;
     |SI nHST = 0;  nHST = nHSC;  |FINSI;

     nCf1 = (nHST / nHSC) ! 3;
     nCf2 = (nDA / nDM) ! 3;

     |SI #labtraba#42 = "M";  |O #labtraba#42 = "X";
      |O #labtraba#42 = "A";
         nCf2 = (nDA / 30) ! 3;
     |FINSI;

     |SI #labtraba#42 = "F"; nCf2 = 1;  |FINSI;
     |SI #labtraba#42 = "C"; nCf2 = 1;  |FINSI;

     nCf = (nCf1 * nCf2) ! 3;

     #nomw0029#0 = #labempre#0;
     #nomw0029#1 = nCen;
     #nomw0029#2 = #labtraba#7;
     |LEE 101#nomw0029.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0029;
         #nomw0029#0 = #labempre#0;
         #nomw0029#1 = nCen;
         #nomw0029#2 = #labtraba#7;
         |GRABA 020#nomw0029.n;
     |FINSI;
     |LIBERA #nomw0029;

     #nomw0028#0 = #labempre#0;
     #nomw0028#1 = nCen;
     #nomw0028#2 = #labtraba#17;
     #nomw0028#3 = aSex;
     |LEE 101#nomw0028.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0028;
         #nomw0028#0 = #labempre#0;
         #nomw0028#1 = nCen;
         #nomw0028#2 = #labtraba#17;
         #nomw0028#3 = aSex;
         |GRABA 020#nomw0028.b;
     |FINSI;

     #nomw0028#4 = #nomw0028#4 + nCf;

     |GRABA 020#nomw0028.a;
     |LIBERA #nomw0028;

     #nomw0028#0 = #labempre#0;
     #nomw0028#1 = nCen;
     #nomw0028#2 = 9999;
     #nomw0028#3 = aSex;
     |LEE 101#nomw0028.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0028;
         #nomw0028#0 = #labempre#0;
         #nomw0028#1 = nCen;
         #nomw0028#2 = 9999;
         #nomw0028#3 = aSex;
         |GRABA 020#nomw0028.b;
     |FINSI;

     #nomw0028#4 = #nomw0028#4 + nCf;

     |GRABA 020#nomw0028.a;
     |LIBERA #nomw0028;
|FPRC;

|PROCESO BuscaCol;
     nAsa = 1;
     |SI #nomconli#2 ] 400;
         |SI #nomconli#11 = "N";
             nAsa = 0;
         |FINSI;
     |FINSI;

     nCol = 0;
     |SI nAsa = 1;
         |PARA nCmp = 2;  |SI nCmp [ 47;  |HACIENDO nCmp = nCmp + 1;
               aAlfa2 = #nomw0026#nCmp#;  |QBF aAlfa2;
               |SI aAlfa2 = "";
                   |SAL;
               |FINSI;

               |SI aAlfa1 = aAlfa2;
                   nCol = nCmp;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nCol ! 0;
             |ACABA;
         |FINSI;

         |PARA nCmp = 2;  |SI nCmp [ 47;  |HACIENDO nCmp = nCmp + 1;
               aAlfa2 = #nomw0026#nCmp#;  |QBF aAlfa2;
               |SI aAlfa2 = "";
                   nCol = nCmp;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nAsa = 0;
         |PARA nCmp = 52;  |SI nCmp [ 98;  |HACIENDO nCmp = nCmp + 1;
               aAlfa2 = #nomw0026#nCmp#;  |QBF aAlfa2;
               |SI aAlfa2 = "";
                   |SAL;
               |FINSI;

               |SI aAlfa1 = aAlfa2;
                   nCol = nCmp;
                   |SAL;
               |FINSI;
         |SIGUE;

         |SI nCol ! 0;
             |ACABA;
         |FINSI;

         |PARA nCmp = 52;  |SI nCmp [ 98;  |HACIENDO nCmp = nCmp + 1;
               aAlfa2 = #nomw0026#nCmp#;  |QBF aAlfa2;
               |SI aAlfa2 = "";
                   nCol = nCmp;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO nomcalli;
     |SI #nomcalli#4 ] 500;
         |ACABA;
     |FINSI;

     |SI #nomcalli#7 = 1;
         nCol   = 1;
         nTot   = #nomcalli#11 * #nomcalli#10;
         nAcu   = 1;
         aAlfa1 = "SALARIO BASE";
         |SI nBas = 1;
             nAcu = 0;
         |FINSI;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;

         nBas = 1;
         |ACABA;
     |FINSI;

     |SI #nomcalli#4 = 120; |O #nomcalli#4 = 407;
      |O #nomcalli#4 = 411;
         |SI #labtraba#213 ! 0;
             #nomcalli#4 = #labtraba#213;
         |FINSI;
     |FINSI;

     #nomconli#0 = #nomconca#0;
     #nomconli#2 = #nomcalli#4;
     |LEE 000#nomconli.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #nomdesam#0 = #nomconli#0;
     #nomdesam#1 = #nomconli#2;
     |LEE 000#nomdesam.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomdesam;
     |FINSI;

     aAlfa1 = #nomdesam#2;  |QBF aAlfa1;
     |SI aAlfa1 = "";
         aAlfa1 = #nomconli#6;  |QBF aAlfa1;
     |FINSI;

     aAlfa1 = aAlfa1 + "-" + ("000" + #nomconli#2) % -103;
     |HAZ BuscaCol;

     |SI nCol = 0;  |ACABA;  |FINSI;

     nTot = #nomcalli#11 * #nomcalli#10;
     nAcu = 1;

     nColAcu = nCol;  |HAZ AcumulaCat;
     nColAcu = nCol;  |HAZ AcumulaSex;
|FPRC;

|DEFBUCLE nomcalli;
     #nomcalli#1;
     ;
     #nomcalca#0, #nomcalca#1, #nomcalca#2, #nomcalca#3, 000;
     #nomcalca#0, #nomcalca#1, #nomcalca#2, #nomcalca#3, 999;
     ;
     NULL, nomcalli;
|FIN;

|PROCESO nomcalca;
     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #labtraba#77 < #nomyregv#5;  |O  #labtraba#77 > #nomyregv#6;
         |ACABA;
     |FINSI;

     |SI #nomyregv#8 = "S";
         |SI #labtraba#42  = "H";  |ACABA;  |FINSI;
         |SI #labtraba#247 = 521;  |ACABA;  |FINSI;
     |FINSI;
     |SI #nomyregv#9 = "S";
         |SI #nomyregv#10 ! 0; |Y #nomyregv#10 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#11 ! 0; |Y #nomyregv#11 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#12 ! 0; |Y #nomyregv#12 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#13 ! 0; |Y #nomyregv#13 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#14 ! 0; |Y #nomyregv#14 = #labtraba#248; |ACABA; |FINSI;
     |FINSI;

     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nCen = #labtraba#77;
     |SI #nomyregv#7 = "N";
         nCen = 0;
     |FINSI;

     aSex = "SIN CLASIFICAR";
     |SI #labtraba#252 = "V";  aSex = "HOMBRES";  |FINSI;
     |SI #labtraba#252 = "M";  aSex = "MUJERES";  |FINSI;

     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = #labtraba#17;
     |LEE 000#nomcateg.=;
     |SI FSalida ! 0;  |DDEFECTO #nomcateg;  |FINSI;

     nDM = #nomcalca#7;
     nDA = #nomcalca#8;

     |HAZ AcumulaTrab;

     |SI #nomcalca#57 ! 0;
         aAlfa1 = "ENFERMEDAD SEGURIDAD SOCIAL";
         nCol   = 48;
         nTot   = #nomcalca#57;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomcalca#73 ! 0;
         aAlfa1 = "ENFERMEDAD EMPRESA";
         nCol   = 49;
         nTot   = #nomcalca#73;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomcalca#58 ! 0;
         aAlfa1 = "ENFERMEDAD ACCIDENTE";
         nCol   = 50;
         nTot   = #nomcalca#58;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomcalca#59 ! 0;
         aAlfa1 = "COMPLEMENTO ENFERMEDAD";
         nCol   = 99;
         nTot   = #nomcalca#59;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomcalca#60 ! 0;
         aAlfa1 = "COMPLEMENTO ACCIDENTE";
         nCol   = 100;
         nTot   = #nomcalca#60;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     nBas = 0;
     |BUCLE nomcalli;

     |PULSATECLA;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     184;
     #labempre#0, 00000, #nomyregv#1, 0, #nomyregv#2;
     #labempre#0, 99999, #nomyregv#1, 0, #nomyregv#2;
     ;
     NULL, nomcalca;
|FIN;

|PROCESO nomhicli;
     |SI #nomhicli#4 ] 500;
         |ACABA;
     |FINSI;

     |SI #nomhicli#7 = 1;
         nCol   = 1;
         nTot   = #nomhicli#11 * #nomhicli#10;
         nAcu   = 1;
         aAlfa1 = "SALARIO BASE";
         |SI nBas = 1;
             nAcu = 0;
         |FINSI;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;

         nBas = 1;
         |ACABA;
     |FINSI;

     |SI #nomhicli#4 = 120; |O #nomhicli#4 = 407;
      |O #nomhicli#4 = 411;
         |SI #labtraba#213 ! 0;
             #nomhicli#4 = #labtraba#213;
         |FINSI;
     |FINSI;

     #nomconli#0 = #nomconca#0;
     #nomconli#2 = #nomhicli#4;
     |LEE 000#nomconli.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #nomdesam#0 = #nomconli#0;
     #nomdesam#1 = #nomconli#2;
     |LEE 000#nomdesam.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomdesam;
     |FINSI;

     aAlfa1 = #nomdesam#2;  |QBF aAlfa1;
     |SI aAlfa1 = "";
         aAlfa1 = #nomconli#6;  |QBF aAlfa1;
     |FINSI;
     aAlfa1 = aAlfa1 + "-" + ("000" + #nomconli#2) % -103;
     |HAZ BuscaCol;

     |SI nCol = 0;  |ACABA;  |FINSI;

     nTot = #nomhicli#11 * #nomhicli#10;
     nAcu = 1;

     nColAcu = nCol;  |HAZ AcumulaCat;
     nColAcu = nCol;  |HAZ AcumulaSex;
|FPRC;

|DEFBUCLE nomhicli;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 000;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 999;
     ;
     NULL, nomhicli;
|FIN;

|PROCESO nomhicca;
     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #labtraba#77 < #nomyregv#5;  |O  #labtraba#77 > #nomyregv#6;
         |ACABA;
     |FINSI;

     |SI #nomyregv#8 = "S";
         |SI #labtraba#42  = "H";  |ACABA;  |FINSI;
         |SI #labtraba#247 = 521;  |ACABA;  |FINSI;
     |FINSI;
     |SI #nomyregv#9 = "S";
         |SI #nomyregv#10 ! 0; |Y #nomyregv#10 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#11 ! 0; |Y #nomyregv#11 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#12 ! 0; |Y #nomyregv#12 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#13 ! 0; |Y #nomyregv#13 = #labtraba#248; |ACABA; |FINSI;
         |SI #nomyregv#14 ! 0; |Y #nomyregv#14 = #labtraba#248; |ACABA; |FINSI;
     |FINSI;

     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nCen = #labtraba#77;
     |SI #nomyregv#7 = "N";
         nCen = 0;
     |FINSI;

     aSex = "SIN CLASIFICAR";
     |SI #labtraba#252 = "V";  aSex = "HOMBRES";  |FINSI;
     |SI #labtraba#252 = "M";  aSex = "MUJERES";  |FINSI;

     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = #labtraba#17;
     |LEE 000#nomcateg.=;
     |SI FSalida ! 0;  |DDEFECTO #nomcateg;  |FINSI;

     nDM = #nomhicca#7;
     nDA = #nomhicca#8;

     |HAZ AcumulaTrab;

     |SI #nomhicca#57 ! 0;
         aAlfa1 = "ENFERMEDAD SEGURIDAD SOCIAL";
         nCol   = 48;
         nTot   = #nomhicca#57;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomhicca#112 ! 0;
         aAlfa1 = "ENFERMEDAD EMPRESA";
         nCol   = 49;
         nTot   = #nomhicca#112;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomhicca#58 ! 0;
         aAlfa1 = "ENFERMEDAD ACCIDENTE";
         nCol   = 50;
         nTot   = #nomhicca#58;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomhicca#59 ! 0;
         aAlfa1 = "COMPLEMENTO ENFERMEDAD";
         nCol   = 99;
         nTot   = #nomhicca#59;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     |SI #nomhicca#60 ! 0;
         aAlfa1 = "COMPLEMENTO ACCIDENTE";
         nCol   = 100;
         nTot   = #nomhicca#60;
         nAcu   = 1;

         nColAcu = nCol;  |HAZ AcumulaCat;
         nColAcu = nCol;  |HAZ AcumulaSex;
     |FINSI;

     nBas = 0;
     |BUCLE nomhicli;

     |PULSATECLA;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #labempre#0, 00000, nAny, #nomyregv#1, 0;
     #labempre#0, 99999, nAny, #nomyregv#1, 0;
     ;
     NULL, nomhicca;
|FIN;

|| ------------------------------------------------------------------------

|PROCESO labempre;
     aFic = "nomw0025" + Usuario;  |NOME_DAT #nomw0025#aFic#;
     aFic = "nomw0027" + Usuario;  |NOME_DAT #nomw0027#aFic#;
     aFic = "nomw0028" + Usuario;  |NOME_DAT #nomw0028#aFic#;
     aFic = "nomw0029" + Usuario;  |NOME_DAT #nomw0029#aFic#;

     |ABRE #nomw0025;  |CIERRA #nomw0025;  |DELINDEX #nomw0025;
     |ABRE #nomw0027;  |CIERRA #nomw0027;  |DELINDEX #nomw0027;
     |ABRE #nomw0028;  |CIERRA #nomw0028;  |DELINDEX #nomw0028;
     |ABRE #nomw0029;  |CIERRA #nomw0029;  |DELINDEX #nomw0029;

     |DDEFECTO #nomw0026;

     nAny = #nomyregv#2 - 2000;

     |ABRE #nomw0025;
     |ABRE #nomw0027;
     |ABRE #nomw0028;
     |ABRE #nomw0029;
     |BUCLE nomcalca;
     |BUCLE nomhicca;

     |BUCLE nomw0027;

     |CIERRA #nomw0025;  |DELINDEX #nomw0025;
     |CIERRA #nomw0027;  |DELINDEX #nomw0027;
     |CIERRA #nomw0028;  |DELINDEX #nomw0028;
     |CIERRA #nomw0029;  |DELINDEX #nomw0029;
|FPRC;

|DEFBUCLE labempre;
     #labempre#1;
     ;
     #nomyregv#3;
     #nomyregv#4;
     ;
     NULL, labempre;
|FIN;

|PROCESO T3;  |TIPO 3;
     |BUCLE labempre;
|FPRC;

|CALCULO Tipo0C8;
     aAlfa = #nomyregv#9;
     |SI aAlfa = "N";
         #nomyregv#10 = 0; |PINTA #nomyregv#10;
         #nomyregv#11 = 0; |PINTA #nomyregv#11;
         #nomyregv#12 = 0; |PINTA #nomyregv#12;
         #nomyregv#13 = 0; |PINTA #nomyregv#13;
         #nomyregv#14 = 0; |PINTA #nomyregv#14;
     |FINSI;
     |C_M #nomyregv#10, 1, aAlfa;
     |C_M #nomyregv#11, 1, aAlfa;
     |C_M #nomyregv#12, 1, aAlfa;
     |C_M #nomyregv#13, 1, aAlfa;
     |C_M #nomyregv#14, 1, aAlfa;
|FCAL;

|CALCULO Tipo0C10mas;
     |C_M #nomyregv#Campo#, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     aAlfa = "S";
     |SI #nomyregv#Campo# = 0; aAlfa = "N"; |FINSI;
     |PARA nPara1 = Campo + 1; |SI nPara1 [ 14; |HACIENDO nPara1 = nPara1 + 1;
           |C_M #nomyregv#nPara1#,1,aAlfa;
           |SI aAlfa = "N";
               #nomyregv#nPara1# = 0;
               |PINTA #nomyregv#nPara1#;
           |FINSI;
     |SIGUE;
|FCAL;

|PROGRAMA;
     |CLS;
     |CABEZA "REGISTRO VALORES MEDIOS DE SALARIO";

     |PINPA #0#nomyregv;

     |LEE 000#nomyregv.p;
     |SI FSalida ! 0;
         |DDEFECTO #nomyregv;

         fFecha = ~;
         aAlfa  = fFecha % -104;

         #nomyregv#2 = aAlfa;

         |GRABA 020#nomyregv.b;
     |FINSI;

     |PINDA #0#nomyregv;
     |ENDATOS #1#nomyregv;
     |SI FSalida = 0;
         |GRABA 020#nomyregv.a;
     |FINSI;
     |LIBERA #nomyregv;
|FPRO;

|PROCESO Borrado;
     aAlfa = aPathTrab + "*.*";
     |R_PDIR aAlfa;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aAlfa1 = aAlfa;
          |RFBORRA aAlfa1;
          |R_SDIR aAlfa;
     |SIGUE;
|FPRC;

|PROCESO T80;  |TIPO 80;
     |ABRET #nomyregv;
     |ABRET #labtraba;
     |ABRET #labcentr;
     |ABRET #nomconca;
     |ABRET #nomconli;
     |ABRET #nomdesam;
     |ABRET #nomcateg;

     aPathTrab = "C:\DOCUMENTOS\Salarios";  |RMKDIR aPathTrab;
     aPathTrab = "C:\DOCUMENTOS\Salarios\";
     |HAZ Borrado;

     aFicPla = "valores_medios.xls";

     |DBASE aBase;  |QBF aBase;
     aOri = aBase     + "documentos/valores_medios.xls";
     aDes = aPathTrab + aFicPla;

     aIP = "";
     |IP_REMOTO aIP;  |QBT aIP;
     |SI aIP ! "";
         |ENVIA_FICHERO aOri, aDes;
     |SINO;
         |COPIA_FICHERO aOri, aDes;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #nomyregv;
     |CIERRAT #labtraba;
     |CIERRAT #labcentr;
     |CIERRAT #nomconca;
     |CIERRAT #nomconli;
     |CIERRAT #nomdesam;
     |CIERRAT #nomcateg;
|FPRC;
