|FICHEROS;
     nomdator #0;
     aomparam;

   concept@ #1000;
   cacuent@ #1001;
   canempr@ #1002;
   diarios@ #1003;

     caenlac@ #1000;
     caconas@ #1001;
     camasic@ #1002;

     nomw0021,MANTE;
|FIN;

|VARIABLES;
     &swModulo = 0;
     aAlfa = "";
     aAlfa1 = "";
     nMaxDigit = 0;
     nTecla = 0;
     nCalc = 0;
|FIN;

|PROCESO EntraNOMW0021;
     |PUSHV 0501 2380;

     aAlfa = #0#4; |QBF aAlfa;
     aAlfa = ("0000" + aAlfa) % -104;
     #nomw0021#0 = aAlfa;
     #nomw0021#1 = #0#5;
     #nomw0021#2 = #0#6;
     #nomw0021#3 = #0#7;

     #nomw0021#4 = #0#20;
     #nomw0021#5 = #0#21;
     #nomw0021#6 = #0#22;

     |PINPA #0#nomw0021;
     |PINDA #0#nomw0021;

     |ENDATOS #1#nomw0021;
     |SI FSalida = 0;
          #0#4 = #nomw0021#0;
          #0#5 = #nomw0021#1;
          #0#6 = #nomw0021#2;
          #0#7 = #nomw0021#3;

          #0#20 = #nomw0021#4;
          #0#21 = #nomw0021#5;
          #0#22 = #nomw0021#6;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO PintaDatosBanco;
     |PINTA #0#4;
     |PINTA #0#5;
     |PINTA #0#6;
     |PINTA #0#7;
     |PINTA #0#21;
|FPRC;

|PROCESO Obligatorio;
     aAlfa = #0Campo;
     |QBF aAlfa;
     |SI aAlfa = "";
          |MENAV "    ATENCION. Campo obligatorio";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CompCuenta;
   aAlfa = #nomdator#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida !0; |HACIENDO;
      aAlfa1 = aAlfa % 0; nCalc = aAlfa1;
      nCalc = nMaxDigit - nCalc;
      aAlfa1 = "0" * nCalc;
      nCalc = FSalida + 98; aAlfa1 = aAlfa1 + (aAlfa % nCalc);
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa1 = (aAlfa % nCalc) + aAlfa1; aAlfa = aAlfa1;
      aAlfa = aAlfa - ".";
   |SIGUE;
   #nomdator#Campo# = aAlfa; |PINTA #nomdator#Campo#;

   aAlfa = #nomdator#Campo#; |QBF aAlfa;
   aAlfa = aAlfa % 0; nCalc = aAlfa;
   |SI nCalc = #canempr@#14; #cacuent@#1 = 1; |FINSI;
   |SI nCalc = #canempr@#15; #cacuent@#1 = 2; |FINSI;
   |SI nCalc = #canempr@#16; #cacuent@#1 = 3; |FINSI;
   |SI nCalc = #canempr@#17; #cacuent@#1 = 4; |FINSI;
   |SI nCalc = #canempr@#18; #cacuent@#1 = 5; |FINSI;
   |SI nCalc = #canempr@#19; #cacuent@#1 = 6; |FINSI;
   #cacuent@#0 = #nomdator#Campo#;
   |LEE 000#cacuent@.=;
   |SI FSalida ! 0;
       |MENAV "    Cuenta inexistente";
       |ERROR; |ACABA;
   |SINO;
      |SI #cacuent@#3 = "N";
         aAlfa = "    NEsta seleccionando una cuenta sin pase directo. " + &191 + " Continuar ? ";
         |CONFI aAlfa;
         |SI FSalida ! 0; |ERROR; |FINSI;
      |FINSI;
   |FINSI;

   |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
   |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
|FPRC;

|PROCESO Cuentas;
     swModulo = 0;
     |HAZ BuscaModulo;

     |SI swModulo ! 2805; |Y swModulo ! 1;
          |ACABA;
     |FINSI;

     nTecla = FSalida;

     aAlfa = #nomdator#Campo#;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12;
     |QBF aAlfa;
     aAlfa1 = aAlfa + "def/cacuenta.mas";
     |CARGA_DEF aAlfa1, cacuent@;
     |SI FSalida ! 0;
          |MENAV "    No encuentro el fichero de plan contable";
          |ERROR;
          |ACABA;
     |SINO;
          aAlfa1 = aAlfa + "def/canempre.mas";
          |CARGA_DEF aAlfa1, canempr@;
          |SI FSalida ! 0;
               |DESCARGA_DEF #cacuent@;
               |MENAV "    No encuentro el fichero de empresas";
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     aAlfa1 = aAlfa + "fich/";
     |PATH_DAT #1002#aAlfa1#;
     aAlfa1 = aAlfa + "fich/" + (("00000" + #nomdator#13) % -105) + #nomdator#14 + "/";
     |PATH_DAT #1001#aAlfa1#;

     |ABRE #canempr@;
     #canempr@#2 = #nomdator#13;
     #canempr@#3 = #nomdator#14;
     |LEE 000#canempr@.=;
     |SI FSalida ! 0; |DDEFECTO #canempr@; |FINSI;

     nMaxDigit = 0;
     |SI #canempr@#14 ] nMaxDigit; nMaxDigit = #canempr@#14; |FINSI;
     |SI #canempr@#15 ] nMaxDigit; nMaxDigit = #canempr@#15; |FINSI;
     |SI #canempr@#16 ] nMaxDigit; nMaxDigit = #canempr@#16; |FINSI;
     |SI #canempr@#17 ] nMaxDigit; nMaxDigit = #canempr@#17; |FINSI;
     |SI #canempr@#18 ] nMaxDigit; nMaxDigit = #canempr@#18; |FINSI;
     |SI #canempr@#19 ] nMaxDigit; nMaxDigit = #canempr@#19; |FINSI;

     |ABRE #cacuent@;
     |SI nTecla = 10;
          #cacuent@#0 = #nomdator#Campo#;
          |LEE 000#cacuent@.];
          |CONSULTA_CLAVE #1#cacuent@;
          |SI FSalida = 0;
              #nomdator#Campo# = #cacuent@#0;
              |PINTA #nomdator#Campo#;
          |FINSI;
     |FINSI;

     |HAZ CompCuenta;
|FPRC;

|PROCESO MiraEmpresa;
     nTecla = FSalida;

     swModulo = 0;
     |HAZ BuscaModulo;

     |SI swModulo ! 2805; |Y swModulo ! 1;
          |ACABA;
     |FINSI;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa = aAlfa + "def/canempre.mas";
     |CARGA_DEF aAlfa, canempr@;
     |SI FSalida = 0;
          aAlfa = #aomparam#12; |QBF aAlfa;
          aAlfa = aAlfa + "fich/"; |PATH_DAT #canempr@#aAlfa#;
          |ABRE #canempr@;
          |SI nTecla = 10;
               |CONSULTA_CLAVE #1#canempr@;
               |SI FSalida = 0;
                    #nomdator#13 = #canempr@#2;  |PINTA #nomdator#13;
                    #nomdator#14 = #canempr@#3; |PINTA #nomdator#14;
               |FINSI;
               |ERROR;
          |SINO;
               #canempr@#2 = #nomdator#13;
               #canempr@#3 = #nomdator#14;
               |LEE 000#canempr@.=;
               |SI FSalida ! 0;
                    |MENAV "    Empresa inexistente";
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
     |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     swModulo = 0;
     |HAZ BuscaModulo;


     |SI swModulo = 2805; |O swModulo = 1;
               ||       5678901234567890
          |PINTA 1805, "Empresa ..: ";
          |PINTA 1855, "Cuenta:";
          |CAMPO_MODIFICA #0#12, 1, "S";
          |CAMPO_MODIFICA #0#13, 1, "S";
          |CAMPO_MODIFICA #0#14, 1, "S";
          |CAMPO_VISUAL #0#12, 1, "S";
          |CAMPO_VISUAL #0#13, 1, "S";
          |CAMPO_VISUAL #0#14, 1, "S";
          |PINTA #0#12;
          |PINTA #0#13;
          |PINTA #0#14;
     |SINO;
          |PINTA 1805, "                      ";
          |PINTA 1855, "                     ";
          |PINTA 1905, "컴컴컴컴컴컴컴컴컴컴컴";
          |PINTA 1955, "컴컴컴컴컴컴컴컴컴컴캑";
          |CAMPO_MODIFICA #0#12, 1, "N";
          |CAMPO_MODIFICA #0#13, 1, "N";
          |CAMPO_MODIFICA #0#14, 1, "N";
          |CAMPO_VISUAL #0#12, 1, "N";
          |CAMPO_VISUAL #0#13, 1, "N";
          |CAMPO_VISUAL #0#14, 1, "N";
     |FINSI;
|FPRC;

/*
|PROGRAMA;
     swModulo = 0;
     |HAZ BuscaModulo;

     |CLS;

     |PINPA #0#0;
     |PINDA #0#0;

     |SI swModulo = 2805; |O swModulo = 1;
               ||       5678901234567890
          |PINTA 1705, "Cuenta .......: "
          |CAMPO_MODIFICA #0#12, 1, "S";
          |CAMPO_VISUAL #0#12, 1, "S";
          |PINTA #0#12;
     |SINO;
          |PINTA 1705, "                "
          |CAMPO_MODIFICA #0#12, 1, "N";
          |CAMPO_VISUAL #0#12, 1, "N";
     |FINSI;

     |MANTE #0;
|FPRO;
*/
