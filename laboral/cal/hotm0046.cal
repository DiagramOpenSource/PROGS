|FICHEROS;
    hotm0046 #0;
    nomhicca #1;
    labtraba #2;
    labempre #3;
    labemphi #10;

    hotm0051 #51;

|FIN;

|VARIABLES;
    seleccio = 0;
    sw = 0;

    grupo = " ";
    trabaja = 0;
    centro = 0;
    empresa = 0;

    ginf_enf = 0;
    ginf_sub = 0;
    ginf_bru = 0;
    ginf_dto = 0;
    ginf_tan = 0;
    ginf_ded = 0;
    ginf_dse = 0;
    ginf_liq = 0;
    ginf_sss = 0;
    ginf_exe = 0;
    cinf_enf = 0;
    cinf_sub = 0;
    cinf_bru = 0;
    cinf_dto = 0;
    cinf_tan = 0;
    cinf_ded = 0;
    cinf_dse = 0;
    cinf_liq = 0;
    cinf_sss = 0;
    cinf_exe = 0;
    tinf_tan = 0;

    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;

    &p_mes = " ";
    &ano = 0;
    &swlin = 0;
    &varinf1 = "";
    &varinf2 = "";
    &fecha = @;
    &cabeza = "";
    tip = "";
    ames = "";
    mes = 0;

    &inf_enf = 0;
    &inf_sub = 0;
    &inf_bru = 0;
    &inf_dto = 0;
    &inf_tan = 0;
    &inf_ded = 0;
    &inf_dse = 0;
    &inf_liq = 0;
    &inf_sss = 0;
    &inf_exe = 0;

    &pinf_enf = 0;
    &pinf_sub = 0;
    &pinf_bru = 0;
    &pinf_dto = 0;
    &pinf_ded = 0;
    &pinf_dse = 0;
    &pinf_liq = 0;
    &pinf_sss = 0;
    &pinf_exe = 0;

    &tinf_tc1 = 0;
    &tinf_tc1re = 0;
    &tinf_enf = 0;
    &tinf_sub = 0;
    &tinf_bru = 0;
    &tinf_dto = 0;
    &tinf_ded = 0;
    &tinf_dse = 0;
    &tinf_liq = 0;
    &tinf_sss = 0;
    &tinf_exe = 0;

    hay_algo = 0;

    g_empresa = 0;
    g_centro = 0;
    g_grupo = "";
    g_trabaja = 0;

    dia = 0;
    zmes = 0;
    any = 0;
    swbaja = 0;
    fecalf = "";
    &EURODB = 0;
    &resumen = "";
    &aAunno = "";
    &nAnticipo1 = 0;
    &nAnticipo2 = 0;
    &nAnticipo3 = 0;
    &nAnticipo4 = 0;
    nAnyo = 0;
     nTipo = 0;
|FIN;

|INCLUYE i_yreno;
____________________________________/ CALCULOS PANTALLA
|PROCESO mirames; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO defecto; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % -102;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;
____________________________________/ IMPORTE TC1
|PROCESO leyendo_tc1;
|SI #0#4 = 0;|O #0#4 = 2;
    |SI #10#2 =  0;|O #10#2 =  2;|O #10#2 =  8;|O #10#2 =  9;
     |O #10#2 = 10;|O #10#2 = 18;|O #10#2 = 19;
            hay_algo = 1;
            tinf_tc1re = tinf_tc1re + #10#20;
    |FINSI;
|FINSI;
|SI #0#4 ] 5;
    |SI #10#2 =  5;|O #10#2 =  6;|O #10#2 =  7;
     |O #10#2 = 15;|O #10#2 = 16;|O #10#2 = 17;
            hay_algo = 1;
            tinf_tc1re = tinf_tc1re + #10#20;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE lee_tc1;
 #10#1;
 ;
 empresa,  1,  #0#5, #0#2, #0#4;
 empresa, 99, #0#10, #0#9, #0#4;
 ;
 NULL, leyendo_tc1;
|FIN;

|PROCESO tc1;
    hay_algo = 0;
    resumen = #0#7;
||SI #0#7 = "N";
        tinf_tc1 = (tinf_sss + tinf_dse) - tinf_enf;    || aproximado
        aAunno = "";
||SINO;
    |BUCLE lee_tc1;
    |SI hay_algo = 0;
        tinf_tc1=(tinf_sss+tinf_dse)-tinf_enf;
        tinf_tc1re = tinf_tc1;
        aAunno = "- TC1 no calculado";
    |SINO;
        aAunno = "";
    |FINSI;
||FINSI;
|FPRC;

____________________________________/ CARGA DE VARIABLES
|PROCESO detalle;
    inf_enf = inf_enf + (#1#57+#1#58);              || prestacion
    inf_sub = inf_sub + (#1#46+#1#45-#1#57-#1#58);  || coste
    inf_bru = inf_bru + #1#46;                                  || bruto
    inf_dto = inf_dto + (#1#52+#1#53+#1#54);                    || dtos.varios
    inf_dto = inf_dto + nAnticipo1 + nAnticipo2;                || mod 500018
    inf_dto = inf_dto + nAnticipo3 + nAnticipo4;                || mod 500018
    inf_tan = #1#13;                                            || (%)IRPF 1
    inf_ded = inf_ded + #1#114;                                 || ret. IRPF
    || ded_not = (#1#48 < notaria) ! EURODB;
    || inf_dse = inf_dse + (ded_not+#1#49+#1#50+#1#51);            || deduc.S.S.
    inf_dse = inf_dse + (#1#48+#1#49+#1#50+#1#51);            || deduc.S.S.
    inf_sss = inf_sss + #1#45;                                  || S.S.empr.
    inf_exe = inf_exe + #1#18;                                  || IRPF exen.

    inf_liq = inf_bru -inf_dto -inf_ded -inf_dse;               || liquido
|FPRC;

|PROCESO grupos;
    ginf_enf = ginf_enf + (#1#57+#1#58);             || prestacion
    ginf_sub = ginf_sub + (#1#46+#1#45-#1#57-#1#58); || coste
    ginf_bru = ginf_bru + #1#46;                                 || bruto
    ginf_dto = ginf_dto + (#1#52+#1#53+#1#54);                   || dtos.varios
    ginf_dto = ginf_dto + nAnticipo1 + nAnticipo2;               || mod 500018
    ginf_dto = ginf_dto + nAnticipo3 + nAnticipo4;               || mod 500018
    ginf_ded = ginf_ded + #1#114;                                || ret. IRPF
    ||ded_not = (#1#48 < notaria) ! EURODB;
    ||ginf_dse = ginf_dse + (ded_not+#1#49+#1#50+#1#51);           || deduc.S.S.
    ginf_dse = ginf_dse + (#1#48+#1#49+#1#50+#1#51);           || deduc.S.S.
    ginf_sss = ginf_sss + #1#45;                                 || S.S.empr.
    ginf_exe = ginf_exe + #1#18;                                 || IRPF exen.

    ginf_liq = ginf_bru - ginf_dto - ginf_ded - ginf_dse;        || liquido
|FPRC;

|PROCESO centros;
    cinf_enf = cinf_enf + (#1#57+#1#58);             || prestacion
    cinf_sub = cinf_sub + (#1#46+#1#45-#1#57-#1#58); || coste
    cinf_bru = cinf_bru + #1#46;                                 || bruto
    cinf_dto = cinf_dto + (#1#52+#1#53+#1#54);                   || dtos.varios
    cinf_dto = cinf_dto + nAnticipo1 + nAnticipo2;               || mod 500018
    cinf_dto = cinf_dto + nAnticipo3 + nAnticipo4;               || mod 500018
    cinf_ded = cinf_ded + #1#114;                                || ret. IRPF
    ||ded_not = (#1#48 < notaria) ! EURODB;
    ||cinf_dse = cinf_dse + (ded_not+#1#49+#1#50+#1#51);           || deduc.S.S.
    cinf_dse = cinf_dse + (#1#48+#1#49+#1#50+#1#51);           || deduc.S.S.
    cinf_sss = cinf_sss + #1#45;                                 || S.S.empr.
    cinf_exe = cinf_exe + #1#18;                                 || IRPF exen.

    cinf_liq = cinf_bru - cinf_dto - cinf_ded - cinf_dse;        || liquido
|FPRC;

/*
|PROCESO totales;
    tinf_enf = tinf_enf + (#1#57+#1#58);             || prestacion
    tinf_sub = tinf_sub + (#1#46+#1#45-#1#57-#1#58); || coste
    tinf_bru = tinf_bru + #1#46;                                 || bruto
    tinf_dto = tinf_dto + (#1#52+#1#53+#1#54);                   || dtos.varios
    tinf_ded = tinf_ded + #1#114;                                || ret. IRPF
    ||ded_not = (#1#48 < notaria) ! 0;
    ||tinf_dse = tinf_dse + (ded_not+#1#49+#1#50+#1#51);           || deduc.S.S.
    tinf_dse = tinf_dse + (#1#48+#1#49+#1#50+#1#51);           || deduc.S.S.
    tinf_sss = tinf_sss + #1#45;                                 || S.S.empr.
    tinf_exe = tinf_exe + #1#18;                                 || IRPF exen.

    tinf_liq = tinf_bru - tinf_dto - tinf_ded - tinf_dse;        || liquido
|FPRC;
*/
|PROCESO &totales;
    tinf_enf = tinf_enf + inf_enf;
    tinf_sub = tinf_sub + inf_sub;
    tinf_bru = tinf_bru + inf_bru;
    tinf_dto = tinf_dto + inf_dto;
    tinf_ded = tinf_ded + inf_ded;
    tinf_dse = tinf_dse + inf_dse;
    tinf_sss = tinf_sss + inf_sss;
    tinf_exe = tinf_exe + inf_exe;

    tinf_liq = tinf_bru - tinf_dto - tinf_ded - tinf_dse;
|FPRC;
____________________________________/ PASE DE VARIABLES
|PROCESO puecentro;
    pinf_enf = cinf_enf;
    pinf_sub = cinf_sub;
    pinf_bru = cinf_bru;
    pinf_dto = cinf_dto;
    pinf_ded = cinf_ded;
    pinf_dse = cinf_dse;
    pinf_liq = cinf_liq;
    pinf_sss = cinf_sss;
    pinf_exe = cinf_exe;
|FPRC;

|PROCESO puegrupos;
    pinf_enf = ginf_enf;
    pinf_sub = ginf_sub;
    pinf_bru = ginf_bru;
    pinf_dto = ginf_dto;
    pinf_ded = ginf_ded;
    pinf_dse = ginf_dse;
    pinf_liq = ginf_liq;
    pinf_sss = ginf_sss;
    pinf_exe = ginf_exe;
|FPRC;
____________________________________/ LIMPIEZA DE VARIABLES
|PROCESO limpdetalle;
    inf_enf = 0;
    inf_sub = 0;
    inf_bru = 0;
    inf_dto = 0;
    inf_ded = 0;
    inf_dse = 0;
    inf_liq = 0;
    inf_sss = 0;
    inf_exe = 0;
|FPRC;

|PROCESO limpgrupos;
    ginf_enf = 0;
    ginf_sub = 0;
    ginf_bru = 0;
    ginf_dto = 0;
    ginf_ded = 0;
    ginf_dse = 0;
    ginf_liq = 0;
    ginf_sss = 0;
    ginf_exe = 0;
|FPRC;

|PROCESO limparcial;
    cinf_enf = 0;
    cinf_sub = 0;
    cinf_bru = 0;
    cinf_dto = 0;
    cinf_ded = 0;
    cinf_dse = 0;
    cinf_liq = 0;
    cinf_sss = 0;
    cinf_exe = 0;
|FPRC;

|PROCESO limptotal;
    tinf_enf = 0;
    tinf_sub = 0;
    tinf_bru = 0;
    tinf_dto = 0;
    tinf_ded = 0;
    tinf_dse = 0;
    tinf_liq = 0;
    tinf_sss = 0;
    tinf_exe = 0;
    tinf_tc1 = 0;
    tinf_tc1re = 0;
|FPRC;
____________________________________/ RUPTURAS
|PROCESO rup_empre;
|HAZ tc1;
    swlin = 2;
    #3#0 = g_empresa;
|LEE 020#3=;
    FSalida = "PAGINA";
|PRINT;
|HAZ limptotal;
    empresa = g_empresa;
    swlin = 0;
|FPRC;

|PROCESO rup_centr;
|HAZ lee_centro;
    swlin = 1;
    varinf1 = "Centro: " + #4#1 + "/" + #4#2;
|HAZ puecentro;
|PRINT;
|HAZ limparcial;
    centro = g_centro;
    swlin = 0;
|FPRC;

|PROCESO rup_areas;
|SI #0#6 = "S";
    |HAZ lee_area;
        swlin = 1;
        varinf1 = "Area: " + #5#0 + "/" + #5#1;
    |HAZ puegrupos;
    |PRINT;
    |HAZ limpgrupos;
        grupo = g_grupo;
        swlin = 0;
|FINSI;
|FPRC;

|PROCESO rup_traba;
    #3#0 = empresa;
|LEE 020#3=;

    #2#0 = empresa;
    #2#1 = trabaja;
|LEE 020#2=;

    swlin = 0;
|PRINT;
|HAZ limpdetalle;
    trabaja = g_trabaja;
    swlin = 0;
|FPRC;

|PROCESO imprimir;
|DDEFECTO #3;
    #3#0 = #1#0;
|LEE 000#3=;                       || lee la empresa
|SI FSalida = 0;|Y #3#36 ! "N";    || si resumen impreso SI
        #2#0 = #1#0;
        #2#1 = #1#1;
    |LEE 000#2=;                   || lee el trabajador
    |SI FSalida = 0;
            |HAZ DatosHist;
            g_empresa = #2#0;
            g_trabaja = #2#1;      || se guardan porque en la impresion
            g_centro = #2#77;      || se lee el trabajador
            g_grupo = #2#62;
        |SI sw = 0;
                seleccio = 1;
                empresa = #2#0;
                trabaja = #2#1;
                centro = #2#77;
                grupo = #2#62;
                sw = 1;
        |FINSI;
        |SI empresa ! g_empresa;             || ruptura por empresa
            |HAZ rup_traba;
            |HAZ rup_areas;
            |HAZ rup_centr;
            |HAZ rup_empre;
        |SINO;
            |SI centro ! g_centro;           || ruptura por centro
                |HAZ rup_traba;
                |HAZ rup_areas;
                |HAZ rup_centr;
            |SINO;
                |SI grupo ! g_grupo;|Y #0#6 = "S";     || ruptura por areas
                    |HAZ rup_traba;
                    |HAZ rup_areas;
                |SINO;
                    |SI trabaja ! g_trabaja;
                        |HAZ rup_traba;      || ruptura por trabajador
                    |FINSI;
                |FINSI;
            |FINSI;
        |FINSI;
        |HAZ notarias;        || lee (%) notarias
        |HAZ detalle;         || acumula por trabajador
        |HAZ grupos;          || acumula por areas
        |HAZ centros;         || acumula por centros
        ||HAZ totales;         || acumula por empresa
    |FINSI;
|FINSI;
|FPRC;

|PROCESO DatosHist;
     #hotm0051#0 = #nomhicca#0;    || Empresa
     nAnyo = #nomhicca#66 + 2000;
     #hotm0051#1 = nAnyo;          || anyo
     #hotm0051#2 = #nomhicca#2;    || mes
     #hotm0051#3 = #nomhicca#1;    || trabajador

     |LEE 000#hotm0051.=;
     |SI FSalida = 0;
          #2#62 = #hotm0051#6;     || Area
          #2#63 = #hotm0051#8;     || Seccion
          #2#77 = #hotm0051#4;     || Centro
     |FINSI;
|FPRC;

|PROCESO lee_traba;
     |DDEFECTO #2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     |LEE 000#2=;

     |HAZ DatosHist;

     |SI #2#77 < #0#11;|O #2#77 > #0#12;
          |ERROR;
     |SINO;
          swbaja = 0;
          fecalf = #1#5;

          alfa1 = fecalf %  102;   dia = alfa1;
          alfa1 = fecalf %  402;   zmes = alfa1;
          alfa1 = fecalf % -102;   any = alfa1;
          |SI alfa1 = "....";
               dia = 0;
               zmes = 0;
               any = 0;
          |FINSI;

          |SI any ] #0#5;|Y any [ #0#10;
               |SI zmes ] #0#2;|Y zmes [ #0#9;
                    swbaja = 1;
               |FINSI;
          |FINSI;

          |SI #0#13 ! "T";
               |SI #0#13 = "A";|Y swbaja = 1;   |ERROR;  |FINSI;
               |SI #0#13 = "B";|Y swbaja = 0;   |ERROR;  |FINSI;
          |FINSI;
     |FINSI;

|FPRC;

|DEFBUCLE area_si1;
 #1#1;
 ;
 #0#0,     1,  #0#5, #0#2, #0#4;
 #0#1, 99999, #0#10, #0#9, #0#4;
 ;
 NULL, lee_traba, NULL, NULL, NULL, imprimir;
 #2#0, #2#77, #2#62, #2#1, #1#66, #1#2, #1#3;
|FINSI;

|DEFBUCLE area_no1;
 #1#1;
 ;
 #0#0,     1,  #0#5, #0#2, #0#4;
 #0#1, 99999, #0#10, #0#9, #0#4;
 ;
 NULL, lee_traba, NULL, NULL, NULL, imprimir;
 #2#0, #2#77, #2#1, #1#66, #1#2, #1#3;
|FIN;

|DEFBUCLE area_si2;
 #1#1;
 ;
 #0#0,     1,  #0#5, #0#2, #0#4;
 #0#1, 99999, #0#10, #0#9, #0#4;
 ;
 NULL, lee_traba, NULL, NULL, NULL, imprimir;
 #2#0, #2#77, #2#62, #2#2, #2#1, #1#66, #1#2, #1#3;
|FIN;

|DEFBUCLE area_no2;
 #1#1;
 ;
 #0#0,     1,  #0#5, #0#2, #0#4;
 #0#1, 99999, #0#10, #0#9, #0#4;
 ;
 NULL, lee_traba, NULL, NULL, NULL, imprimir;
 #2#0, #2#77, #2#2, #2#1, #1#66, #1#2, #1#3;
|FIN;

|PROCESO centra;         || CENTRA TITULO DEL INFORME
    alfa1 = cabeza % 0;
    nume1 = alfa1;
    nume2 = ((79 - nume1) / 2) - 0.5;
    nume2 = nume2 ! 0;
    alfa1 = " " * nume2;
    cabeza = alfa1 + cabeza;
|FPRC;

|PROCESO el_mes;
|SI mes = 1;   ames = "ENE";  |FINSI;
|SI mes = 2;   ames = "FEB";  |FINSI;
|SI mes = 3;   ames = "MAR";  |FINSI;
|SI mes = 4;   ames = "ABR";  |FINSI;
|SI mes = 5;   ames = "MAY";  |FINSI;
|SI mes = 6;   ames = "JUN";  |FINSI;
|SI mes = 7;   ames = "JUL";  |FINSI;
|SI mes = 8;   ames = "AGO";  |FINSI;
|SI mes = 9;   ames = "SEP";  |FINSI;
|SI mes = 10;  ames = "OCT";  |FINSI;
|SI mes = 11;  ames = "NOV";  |FINSI;
|SI mes = 12;  ames = "DIC";  |FINSI;
|FPRC;

|PROCESO lite_periodo;
    mes = #0#2;     |HAZ el_mes;
    p_mes = ames + ":" + #0#5;

    mes = #0#9;     |HAZ el_mes;
    p_mes = p_mes + "/" + ames + ":" + #0#10;
|FPRC;

|PROCESO tipo3; |TIPO 3;
|IMPRE 0;
|SI FSalida = 0;
        ano = #0#5;
    |SI #0#4 = 0; tip = "MENSUAL - ";   |FINSI;
    |SI #0#4 = 2; tip = "FINIQUITO - "; |FINSI;
    |SI #0#4 ] 5; tip = "ATRASOS - ";   |FINSI;
        fecha = #0#3;
    |HAZ lite_periodo;
        cabeza = "RESUMEN HISTORICO NOMINAS " + tip + p_mes;
    |HAZ centra;
    |ABRE #2;
    |ABRE #3;
    |ABRE #hotm0051;
    |INFOR "nomyreno";

    |SI #0#8 = 1;
        |SI #0#6 = "S";  |BUCLE area_si1;  |FINSI;
        |SI #0#6 = "N";  |BUCLE area_no1;  |FINSI;
    |SINO;
        |SI #0#6 = "S";  |BUCLE area_si2;  |FINSI;
        |SI #0#6 = "N";  |BUCLE area_no2;  |FINSI;
    |FINSI;
    |SI seleccio = 1;
        |HAZ rup_traba;
        |HAZ rup_areas;
        |HAZ rup_centr;
        |HAZ tc1;
        |PIEINF;
    |FINSI;
    |FININF;
    |CIERRA #2;
    |CIERRA #3;
    |CIERRA #hotm0051;
|SINO;
    |MENAV "    Proceso abortado ...";
|FINSI;
|FINIMP;
|FPRC;
