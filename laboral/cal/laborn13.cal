|FICHEROS;
     laborn13;
     laborn03;
     labtraba;
     nomcateg;
     labempre;
     labtrtra;

     nomconca;
     nomtrato;
     labort03,MANTE;
     laborn07;
     laborn90;
     labcontr;
     nompmail;
|FIN;

|VARIABLES;
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;

     &eaDirDest  = "";
     &eaAsunto   = "";
     &eaTexto    = "";
     &eaFichero  = "";

     nContrato = 0;
     aAlfa = "";
     &nEmpExt = 0;
     &nTraExt = 0;
     &nTipoVar = 0;
     &nNuevoVal = 0;
     &aNuevoTra = "";
     &nNuevoAFI = 0;
     &nAntigVal = 0;
     &aNuevoVal1 = "";
     &nNuevoVal2 = 0;
     &nNuevoVal3 = 0;
     &nNuevoVal4 = 0;
     &nNuevaCat = 0;
     &aNombreCat = "";
     &nHorasTC2 = 0;
     &aClaveSal1 = "";
     &aClaveSal2 = "";
     &aAntigOcu = "";
     &aNuevaOcu = "";
     &aNuevaDesOcu = "";

     aAlfa1 = "";
     aAlfa2 = "";
     aParam = "";
     &eaUsuario = "";
     &eaFecha = "";
     &eaHora = "";
     nCampo = 0;
     aHora = "";
     nEmp = 0;
     &eaEmpresa = "";
     &eaTrabajador = "";
     &eaAccion = "";

     nNume = 0;
     nHoras = 0;
     &enEmpresa = 0;
     &enBoton3 = 0;
     &swBoton3 = 0;

     nCampo1 = 0;
     nEmpresas = 0;
     nCodEmp = 0;
     aNomEmp = "";
     &nLabornet = 0;
     &swMeHeSalido = 0;
     swSigue = 0;

     &eaQueEs = "";
|FIN;

|PROCESO labtraba13;
     |PARA nCampo = 0; |SI nCampo [ 253; |HACIENDO nCampo = nCampo + 1;
          #labtrtra#nCampo# = #labtraba#nCampo#;
     |SIGUE;
     |GRABA 020#labtrtra.n;
     |LIBERA #labtrtra;
|FPRC;

|DEFBUCLE labtraba13;
     #labtraba#1;
     44;
     #laborn13#5, 00001, "A";
     #laborn13#5, 99999, "A";
     ;
     NULL, labtraba13;
|FIN;

|PROCESO Defectos;
     aAlfa = Usuario; |QBF aAlfa;    aAlfa = "T" + aAlfa;
     |NOME_DAT #labtrtra#aAlfa#;
     |DELINDEX #labtrtra;
     |ABRE #labtrtra;
     |BUCLE labtraba13;
     |CIERRA #labtrtra;

     |SI aParam = "MODIF";
          || esto porque al poner este campo modificable en modo consulta/modif
          || me borraba los valores que se leian desde del campo
          |ABRE #labtraba;
          #labtraba#0 = #laborn13#5;
          #labtraba#1 = #laborn13#6;
          |LEE 000#labtraba.=;
          |SI FSalida = 0;
               |ATRI I;
               |PINTA 0830, #labtraba#2;
               |PINTA 0924, #labtraba#7;
               |PINTA 0955, #labtraba#75;
               |ATRI I;
          |FINSI;
          |CIERRA #labtraba;
     |FINSI;
|FPRC;

|PROCESO ConsultaTra13; |TIPO 66;
     aAlfa = Usuario; |QBF aAlfa;    aAlfa = "T" + aAlfa;
     |NOME_DAT #labtrtra#aAlfa#;
     |ABRE #labtrtra;
     |LEE 000#labtrtra.p;
     |CONSULTA_CLAVE #1#labtrtra;
     |SI FSalida = 0;
          #laborn13#Campo# = #labtrtra#1;
     |FINSI;
     |PINTA #laborn13#Campo#;
     |CIERRA #labtrtra;
|FPRC;

|PROCESO Horario;
     |PUSHV 09012280;
     |PINPA #0#labort03;
     |PINDA #0#labort03;
     enEmpresa = #laborn13#5;
     |ESTADO_CONTROL enBoton3, "DISABLE";
     |ENDATOS #1#labort03;

     nNume = #labort03#2 + #labort03#7 + #labort03#12 + #labort03#17;
     nNume = nNume + #labort03#22 + #labort03#27 + #labort03#32;
     |SI #laborn13#16 = 0;
          #laborn13#16 = nNume;
     |SINO;
          |SI #laborn13#16 ! nNume;
               aAlfa1 = #laborn13#16; |QBF aAlfa1;
               aAlfa2 = nNume; |QBF aAlfa2;
               aAlfa = "    ATENCION: el número de horas de tiempo parcial (";
               aAlfa = aAlfa + aAlfa1 + ") no coincide con el del horario (" + aAlfa2 + ").";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;

     |ESTADO_CONTROL enBoton3, "ENABLE";
     |POPV;
     |PINDA #0#laborn13;
|FPRC;

|PROCESO CompruebaHoras;
     |SI FSalida = 2;
          |ACABA;
     |FINSI;

     |SI #laborn13#16 > #nomconca#162;
          aAlfa = #nomconca#162;
          |QBF aAlfa;

          aAlfa1 = "    ATENCION. Las horas semanales no pueden ser ";
          aAlfa1 = aAlfa1 + "superiores a las horas del convenio (" + aAlfa + ")";
          |MENAV aAlfa1;
          |ERROR;
     |FINSI;
     |SI #laborn13#23 = "P";
          nHoras = 0;
          |PARA nCampo = 2; |SI nCampo [ 32; |HACIENDO nCampo = nCampo + 5;
               nHoras = nHoras + #labort03#nCampo#
          |SIGUE;
          |SI nHoras = 0;
               |HAZ Horario;
          |FINSI;
          |HAZ coeficiente;
          |HAZ HorasTC2;
     |FINSI;
|FPRC;

|PROCESO CompruebaCat; |TIPO 0;
     |SI #laborn13#7 = 2;
          |ABRE #nomcateg;
          #nomcateg#0 = #labtraba#87;
          #nomcateg#1 = #laborn13#24;
          |LEE 000#nomcateg.=;
          |SI FSalida = 0;
               #laborn13#24 = #nomcateg#1;
               |PINTA #laborn13#24;
               aNombreCat = #nomcateg#2 % 115;
               |ATRI I;
               |PINTA 1555, aNombreCat;
               |ATRI 0;
          |SINO;
               aAlfa = "    ATENCION: Categoria no definida en convenio. Pulse F5 ";
               aAlfa = aAlfa + "para consultar.";
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
          |CIERRA #nomcateg;
     |FINSI;
|FPRC;

|PROCESO MinCat;
     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = 001;
|FPRC;

|PROCESO MaxCat;
     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = 999;
|FPRC;

|PROCESO ConsultaCat;
     |SI FSalida = 13;
          |ABRE #nomcateg;
          |CONSULTA_F_CLAVE #1#nomcateg, MinCat, MaxCat;
          |SI FSalida = 0;
               #laborn13#Campo# = #nomcateg#1;
          |FINSI;
          |PINTA #laborn13#Campo#;
          |CIERRA #nomcateg;
     |FINSI;
|FPRC;

|PROCESO Boton3;
     |SI swBoton3 = 0;
          |CONTROL_SIMPLE 0, "BOTON,Horario", 1659, 1664, Horario;
          enBoton3 = FSalida;
          |SI #laborn13#23 = "P";
               |ESTADO_CONTROL enBoton3, "ENABLE";
          |SINO;
               |ESTADO_CONTROL enBoton3, "DISABLE";
          |FINSI;
          swBoton3 = 1;
     |FINSI;
|FPRC;

|PROCESO ActivaBoton;
     |SI #laborn13#23 = "P";
          |ESTADO_CONTROL enBoton3, "ENABLE";
     |SINO;
          |ESTADO_CONTROL enBoton3, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO ValidaCont; |TIPO 0;
     |SI #laborn13#7 ! 1;
          |ACABA;
     |FINSI;

     aAlfa = #laborn13#14;
     |QBF aAlfa;
     aAlfa = ("000" + aAlfa) % -103;
     #laborn13#14 = aAlfa;
     |PINTA #laborn13#14;

     |ABRE #nomtrato;
     nNume = #laborn13#14;
     #nomtrato#0 = 111;
     #nomtrato#1 = nNume;
     |LEE 000#nomtrato.=;
     |SI FSalida ! 0; |O nNume = 0;
          aAlfa = "    El contrato " + aAlfa + " no es un contrato valido. ";
          aAlfa = aAlfa + "Pulse F11 para ver los disponibles."
          |MENAV aAlfa;
          |ERROR;
     |SINO;
          |SI #laborn13#14 ] 100; |Y #laborn13#14 [ 199;
               #laborn13#23 = "C";
          |FINSI;
          |SI #laborn13#14 ] 200; |Y #laborn13#14 [ 299;
               #laborn13#23 = "P";
          |FINSI;
          |SI #laborn13#14 ] 400; |Y #laborn13#14 [ 499;
               #laborn13#23 = "C";
          |FINSI;
          |SI #laborn13#14 ] 500; |Y #laborn13#14 [ 599;
               #laborn13#23 = "P";
          |FINSI;
          |PINTA #laborn13#23;
          |HAZ ActivaBoton;
     |FINSI;
     |CIERRA #nomtrato;
|FPRC;

|PROCESO Min;
     #nomtrato#0 = 111;
     #nomtrato#1 = 001;
|FPRC;

|PROCESO Max;
     #nomtrato#0 = 111;
     #nomtrato#1 = 999;
|FPRC;

|PROCESO ConsultaCont; |TIPO 66;
     |SI #laborn13#7 ! 1;
          |ACABA;
     |FINSI;

     |ABRE #nomtrato;
     |CONSULTA_F_CLAVE #1#nomtrato, Min, Max;
     |SI FSalida = 0;
          #laborn13#14 = #nomtrato#1;
          |PINTA #laborn13#14;
     |FINSI;
     |CIERRA #nomtrato;
|FPRC;

|PROCESO Mensa14; |TIPO 7;
     |SI #laborn13#7 = 1;
          aAlfa = "    Tipo de Contrato. Pulse < F11 > para ver consultar los contratos disponibles";
          |MENSA aAlfa;
     |SINO;
          |MENSA "     ";
     |FINSI;
|FPRC;

|PROCESO Datos;
     #laborn13#8 = #labtraba#45;             || contrato
     #laborn13#9 = #labtraba#33;             || grupo tarifa
     #laborn13#10 = #labtraba#204;            || ocupacion
     #laborn13#11 = #labtraba#234;            || horas
     #laborn13#12 = (#laborn13#11 / 40 * 1000) ! 0;
     |PINTA #laborn13#8;
     |PINTA #laborn13#9;
     |PINTA #laborn13#10;
     |PINTA #laborn13#11;
     |PINTA #laborn13#12;
     |SI aParam ! "MODIF"; |Y aParam ! "CONSUL";
          #laborn13#29 = #labtraba#48;            || finiquito S/N
     |FINSI;
|FPRC;

|PROCESO Ayuda; |TIPO 7;
                    ||      3         4         5
                    ||  67890123456789012345678901234
          |PUSHV 14202380;
          |PINTA 1526, "                                            ";
          |PINTA 1626, "                                            ";
          |PINTA 1726, "                                            ";
          |PINTA 1826, "                                            ";
          |ATRI R;
          |PINTA 1526, " 1. Cambio de contrato o de  ";
          |PINTA 1626, "    de jornada               ";
          |PINTA 1726, " 2. Cambio de grupo cotiz.   ";
          |PINTA 1826, " 3. Cambio de ocupacion      ";
          |ATRI 0;
|FPRC;

|PROCESO Variacion;
     |POPV;

     |CAMPO_MODIFICA #laborn13#27, 1, "N";          || campo ocupacion
     |CAMPO_VISUAL #laborn13#27, 1, "N";
     |PINTA 1458, "   ";

     |SI #laborn13#7 = 2; |O #laborn13#7 = 3;
          |CAMPO_MODIFICA #laborn13#15, 1, "N";
          |CAMPO_MODIFICA #laborn13#16, 1, "N";
          |CAMPO_MODIFICA #laborn13#17, 1, "N";
          |CAMPO_MODIFICA #laborn13#18, 1, "N";
          |CAMPO_MODIFICA #laborn13#20, 1, "N";
          |CAMPO_MODIFICA #laborn13#23, 1, "N";
          |CAMPO_MODIFICA #laborn13#24, 1, "N";
          |CAMPO_MODIFICA #laborn13#19, 1, "N";
          |CAMPO_MODIFICA #laborn13#26, 1, "N";
          |CAMPO_MODIFICA #laborn13#25, 1, "N";
          |CAMPO_MODIFICA #laborn13#29, 1, "N";

          |CAMPO_VISUAL #laborn13#15, 1, "N";
          |CAMPO_VISUAL #laborn13#16, 1, "N";
          |CAMPO_VISUAL #laborn13#17, 1, "N";
          |CAMPO_VISUAL #laborn13#18, 1, "N";
          |CAMPO_VISUAL #laborn13#20, 1, "N";
          |CAMPO_VISUAL #laborn13#23, 1, "N";
          |CAMPO_VISUAL #laborn13#24, 1, "N";
          |CAMPO_VISUAL #laborn13#19, 1, "N";
          |CAMPO_VISUAL #laborn13#25, 1, "N";
          |CAMPO_VISUAL #laborn13#26, 1, "N";
          |CAMPO_VISUAL #laborn13#29, 1, "N";

          |PINTA 1354, "        ";
          |PINTA 1426, "                                           ";
          |PINTA 1526, "                                           ";
          |PINTA 1626, "                                           ";
          |PINTA 1726, "                                           ";
          |PINTA 1826, "                                           ";

          |CAMPO_MODIFICA #laborn13#14, 1, "S";
          |CAMPO_VISUAL #laborn13#14, 1, "S";
          |PINTA #laborn13#14;

          |SI #laborn13#7 = 2;
               |CAMPO_MODIFICA #laborn13#24, 1, "S";
               |CAMPO_VISUAL #laborn13#24, 1, "S";
               |CAMPO_POSICION #laborn13#24, 1, 1551;

               |PINTA #laborn13#14;
               |SI aParam ! "MODIF"; |Y aParam ! "CONSUL";
                    #laborn13#24 = #labtraba#17;
               |FINSI;
               |PINTA #laborn13#24;

               |ABRE #nomcateg;
               #nomcateg#0 = #labtraba#87;
               #nomcateg#1 = #laborn13#24;
               |LEE 000#nomcateg.=;
               aNombreCat = #nomcateg#2 % 115;
               |ATRI I;
               |PINTA 1555, aNombreCat;
               |ATRI 0;
               |CIERRA #nomcateg;

               aAlfa = "Nuevo Grupo Cotizacion :";
               |PINTA 1426, aAlfa;
               aAlfa = "Nueva categoria :";
               |PINTA 1526, aAlfa;
               |PINTA 1626, "-----------------------------";
          |FINSI;
          |SI #laborn13#7 = 3;
               |CAMPO_MODIFICA #laborn13#14, 1, "N";
               |CAMPO_VISUAL #laborn13#14, 1, "N";
               |PINTA 1450, "              ";

               aAlfa = "Nueva ocupacion .......:";
               |PINTA 1426, aAlfa;
               |PINTA 1526, "-----------------------------";

               |CAMPO_MODIFICA #laborn13#27, 1, "S";
               |CAMPO_VISUAL #laborn13#27, 1, "S";
               |CAMPO_POSICION #laborn13#27, 1, 1451;
               |PINTA #laborn13#27;
          |FINSI;
     |FINSI;
     |SI #laborn13#7 = 1;
          aAlfa = "Nuevo Contrato ........:                    ";
          |SI aParam ! "MODIF"; |Y aParam ! "CONSUL";
               #laborn13#14 = #laborn13#8;
          |FINSI;
          |PINTA #laborn13#14;
          |PINTA 1426, aAlfa;

                    ||      3         4         5         6
                    ||  678901234567890123456789012345678901
          ||PINTA 1626, "Tipo de Horas (D/S/M/A):     ";
          |PINTA 1354, "Fin: ";
          |PINTA 1526, "Horas Pactadas .....(A):     ";
          |PINTA 1626, "Horas Jornada Maxima(B):     ";
          |PINTA 1726, "Coeficiente .(A*1000/B):     (     )";
          |PINTA 1826, "Clave de Salario ......:            ";

          |ATRI I;
          |PINTA 1546,       "(A)";
          |PINTA 1646,       "(B)";
          |PINTA 1739, "(A*1000/B)";
          |PINTA 1864, "H.TC2";
          |ATRI 0;

          |CAMPO_MODIFICA #laborn13#14, 1, "S";
          ||CAMPO_MODIFICA #laborn13#15, 1, "S";
          |CAMPO_MODIFICA #laborn13#16, 1, "S";
          ||CAMPO_MODIFICA #laborn13#17, 1, "S";
          |CAMPO_MODIFICA #laborn13#18, 1, "S";
          |CAMPO_MODIFICA #laborn13#19, 1, "S";
          |CAMPO_MODIFICA #laborn13#20, 1, "S";
          |CAMPO_MODIFICA #laborn13#23, 1, "S";
          |CAMPO_MODIFICA #laborn13#25, 1, "S";
          |CAMPO_MODIFICA #laborn13#26, 1, "S";
          |CAMPO_MODIFICA #laborn13#29, 1, "S";

          |CAMPO_VISUAL #laborn13#14, 1, "S";
          |CAMPO_VISUAL #laborn13#15, 1, "S";
          |CAMPO_VISUAL #laborn13#16, 1, "S";
          |CAMPO_VISUAL #laborn13#17, 1, "S";
          |CAMPO_VISUAL #laborn13#18, 1, "S";
          |CAMPO_VISUAL #laborn13#19, 1, "S";
          |CAMPO_VISUAL #laborn13#20, 1, "S";
          |CAMPO_VISUAL #laborn13#23, 1, "S";
          |CAMPO_VISUAL #laborn13#25, 1, "S";
          |CAMPO_VISUAL #laborn13#26, 1, "S";
          |CAMPO_VISUAL #laborn13#29, 1, "S";

          |PINTA #laborn13#14;
          |PINTA #laborn13#15;
          |PINTA #laborn13#16;
          |PINTA #laborn13#17;
          |PINTA #laborn13#18;
          |PINTA #laborn13#19;
          |PINTA #laborn13#20;
          |PINTA #laborn13#23;
          |PINTA #laborn13#25;
          |PINTA #laborn13#26;
          |PINTA #laborn13#29;

          |HAZ Boton3;

          |HAZ CambioJornada;
     |FINSI;
|FPRC;

|PROCESO Comprobaciones;
     |SI #laborn13#7 = 1;
          |SI #laborn13#14 ! Contenido; |O #laborn13#19 = " ";
               nContrato = #laborn13#Campo#;
               #laborn13#19 = "M";
               |SI 201 [ nContrato; |Y nContrato [ 299;
                     #laborn13#19 = "X";
               |FINSI;
               |SI 501 [ nContrato; |Y nContrato [ 599;
                    #laborn13#19 = "X";
               |FINSI;
               #laborn13#26 = "M";
               |PINTA #laborn13#19;
               |PINTA #laborn13#26;
          |FINSI;
     |FINSI;
     |SI #laborn13#7 = 2;
          |SI #laborn13#14 < 1; |O #laborn13#14 > 12;
               |MENAV "    ATENCION: Valor no valido para el Grupo de Cotizacion";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambioJornada;
     |SI #laborn13#7 = 1; |Y #laborn13#14 = #laborn13#8; |Y #laborn13#23 = "P"; |Y #laborn13#16 ! #laborn13#11;
          |CAMPO_MODIFICA #laborn13#35, 1, "S";
          |CAMPO_VISUAL #laborn13#35, 1, "S";
          |PINTA 1962, " C.J.:   ³";
          #laborn13#35 = "S";
          |PINTA #laborn13#35;
     |SINO;
          |CAMPO_MODIFICA #laborn13#35, 1, "N";
          |CAMPO_VISUAL #laborn13#35, 1, "N";
          #laborn13#35 = "N";
          |PINTA 1962, "         ³";
     |FINSI;
|FPRC;

|PROCESO TP;
     |SI #laborn13#7 = 1; |Y #laborn13#23 = "P";
          ||CAMPO_MODIFICA #laborn13#15, 1, "S";
          |CAMPO_MODIFICA #laborn13#16, 1, "S";
          ||CAMPO_MODIFICA #laborn13#17, 1, "S";
          |CAMPO_MODIFICA #laborn13#18, 1, "S";
          |CAMPO_MODIFICA #laborn13#20, 1, "S";
          |CAMPO_MODIFICA #laborn13#25, 1, "S";

          |SI #laborn13#23 ! Contenido;
               #laborn13#16 = 0;
               #laborn13#17 = 0;
               #laborn13#18 = 0;
               #laborn13#20 = 0;
               #laborn13#25 = 0;

               |PINTA #laborn13#16;
               |PINTA #laborn13#17;
               |PINTA #laborn13#18;
               |PINTA #laborn13#19;
               |PINTA #laborn13#20;
               |PINTA #laborn13#25;
          |FINSI;

          |ABRE #nomconca;
          #nomconca#0 = #labtraba#87;
          |LEE 000#nomconca.=;
          |SI FSalida = 0; |Y #nomconca#162 ! 0;
               #laborn13#17 = #nomconca#162;
          |SINO;
               #nomconca#162 = 40;
          |FINSI;
          |PINTA #laborn13#17;
          |CIERRA #nomconca;
     |SINO;
          #laborn13#16 = 0;
          #laborn13#17 = 0;
          #laborn13#18 = 0;
          #laborn13#20 = 0;
          #laborn13#25 = 0;

          |PINTA #laborn13#16;
          |PINTA #laborn13#17;
          |PINTA #laborn13#18;
          |PINTA #laborn13#19;
          |PINTA #laborn13#20;
          |PINTA #laborn13#25;

          |CAMPO_MODIFICA #laborn13#15, 1, "N";
          |CAMPO_MODIFICA #laborn13#16, 1, "N";
          |CAMPO_MODIFICA #laborn13#17, 1, "N";
          |CAMPO_MODIFICA #laborn13#18, 1, "N";
          |CAMPO_MODIFICA #laborn13#20, 1, "N";
          |CAMPO_MODIFICA #laborn13#25, 1, "N";
     |FINSI;
     |HAZ ActivaBoton;
|FPRC;

|PROCESO coeficiente;
     #laborn13#18 = ((#laborn13#16 * 1000) / #laborn13#17) ! 0;
     |SI #laborn13#18 > 1000;
          #laborn13#18 = 0;
     |FINSI;
     |PINTA #laborn13#18;

     |SI #laborn13#15 = "S";
          #laborn13#20 = #laborn13#16;
     |SINO;
          #laborn13#20 = 0;
     |FINSI;
     |PINTA #laborn13#20;
|FPRC;

|PROCESO HorasTC2;
     #laborn13#25 = #laborn13#20 / 7;
     |PINTA #laborn13#25;
|FPRC;

|PROCESO HorasTP;
     |SI #laborn13#20 = 0; |Y #laborn13#7 = 4;
          aAlfa = "    Debera indicar el nuevo numero de horas TP para el trabajador";
          aAlfa = aAlfa + " en su ficha.";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Proceso;
     |CLS;
     |PINPA #0#laborn13;
     |PINDA #0#laborn13;

     |CAMPO_MODIFICA #laborn13#27, 1, "N";          || campo ocupacion
     |CAMPO_VISUAL #laborn13#27, 1, "N";
     |PINTA 1458, "   ";

     |ENDATOS #1#laborn13;
     |SI FSalida ! 0;
          swMeHeSalido = 1;
     |FINSI;
     |FIN_CONTROL_WINDOWS enBoton3;
     swBoton3 = 0;
|FPRC;

|PROCESO Email;
     aAlfa = #laborn13#5; |QBF aAlfa;
     eaEmpresa = ("00000" + aAlfa) % -105;
     eaEmpresa = eaEmpresa + " - " + #labempre#2;

     aAlfa = #laborn13#6; |QBF aAlfa;
     eaTrabajador = ("00000" + aAlfa) % -105;
     eaTrabajador = eaTrabajador + " - " + #labtraba#2;

     eaAccion = "variación";

     |HAZ ConsEmail;
|FPRC;

|PROCESO labempre;
     nEmpresas = nEmpresas + 1;
     nCodEmp = #labempre#0;
     aNomEmp = #labempre#2;
|FPRC;

|DEFBUCLE labempre;
     #labempre#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, labempre;
|FIN;

|PROCESO Empresas; |TIPO 7;
     |ABRE #labempre;
     |BUCLE labempre;
     |CIERRA #labempre;

     |SI nEmpresas = 1;
          || tengo una unica empresa que elegir

          #laborn13#5 = nCodEmp;
          |CAMPO_MODIFICA #laborn13#5, 1, "N";
          |PINTA #laborn13#5;
     |FINSI;
|FPRC;

|PROCESO Impresion;
     |ABRE #labcontr; |LEE 000#labcontr.p; |CIERRA #labcontr;
     |SI #labcontr#84 ! "S";
          |ACABA;
     |FINSI;

     eaQueEs = "C";

     aAlfa = "*laborn10;X";
     aAlfa = aAlfa + "13";
     aAlfa = aAlfa + #laborn03#0;
     aAlfa = aAlfa + #laborn03#1;
     aAlfa1 = #laborn03#3;
     aAlfa = aAlfa + aAlfa1;
     aAlfa = aAlfa + #laborn03#4;
     aAlfa = aAlfa + "IMPRE";

     |MENSA "    Imprimiendo solicitud de variación";
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO Contador;
     |ABRE #laborn90;

     #laborn90#0 = #laborn03#5;
     #laborn90#1 = 99999;

     |LEE 000#laborn90.];
     |SI FSalida = 0;
          |SI #laborn90#0 ! #laborn03#5;
               |LEE 000#laborn90.a;
          |FINSI;
     |SINO;
          |LEE 000#laborn90.u;
     |FINSI;

     |SI FSalida = 0;
     |Y #laborn90#0 = #laborn03#5;
          nNume = #laborn90#1;

          |DDEFECTO #laborn90;
          #laborn90#0 = #laborn03#5;
          #laborn90#1 = nNume + 1;

     |SINO;
          || es el primero de esta empresa !!!
          |DDEFECTO #laborn90;
          #laborn90#0 = #laborn03#5;
          #laborn90#1 = 1;
     |FINSI;

     #laborn90#2 = "V";
     #laborn90#3 = "Variaci¢n";
     #laborn90#4 = #laborn03#1;
     #laborn90#5 = #laborn03#2;
     #laborn90#6 = #laborn03#3;
     #laborn90#7 = #laborn03#4;

     |GRABA 020#laborn90.n;

     #laborn03#37 = #laborn90#1;

     |LIBERA #laborn90;
     |CIERRA #laborn90;
|FPRC;

|PROCESO VariosLaborbox;
     |ABRE #labtraba;
     #labtraba#0 = #laborn13#5;
     #labtraba#1 = #laborn13#6;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |SI #laborn13#7 = 3;
          || cambio de ocupacion, cojo la clave que tuviera el trabajador
          #laborn13#19 = #labtraba#42;
          #laborn13#26 = #labtraba#64;
     |FINSI;

     |SI #laborn13#7 = 2;
          || cambio de categoria, cojo la clave de la categoria si existe
          |ABRE #nomcateg;
          #nomcateg#0 = #labtraba#87;
          #nomcateg#1 = #laborn13#24;
          |LEE 000#nomcateg.=;
          |SI FSalida = 0;
               #laborn13#19 = #nomcateg#4;
               #laborn13#26 = #nomcateg#5;
          |FINSI;
     |FINSI;

     aAlfa = #laborn13#19;
     |QBF aAlfa;

     |SI #laborn13#7 = 1; |O aAlfa = "";
          || primero la clave de salario

          || cambio de contrato, cojo la que tuviera el trabajador y
          || si es TP, cambio, si me viene vacia siendo tipo 2 o 3 tambien
          || entro

          #laborn13#19 = #labtraba#42;
          #laborn13#26 = #labtraba#64;

          nContrato = #laborn13#14;
          swSigue = 0;
          |SI 100 [ nContrato; |Y nContrato [ 199;
               swSigue = 1;
          |FINSI;
          |SI 201 [ nContrato; |Y nContrato [ 299;
               swSigue = 2;
          |FINSI;
          |SI 301 [ nContrato; |Y nContrato [ 399;
               swSigue = 1;
          |FINSI;
          |SI 501 [ nContrato; |Y nContrato [ 599;
               swSigue = 2;
          |FINSI;
          |SI swSigue = 1;
               |SI #labtraba#64 = "M";
                    #laborn13#19 = "M";
               |SINO;
                    #laborn13#19 = "D";
               |FINSI;
          |FINSI;
          |SI swSigue = 2;
               |SI #labtraba#64 = "M";
                    #laborn13#19 = "X";
               |SINO;
                    #laborn13#19 = "T";
               |FINSI;
          |FINSI;

          || horas a TP y coeficiente

          |SI #laborn13#23 = "P";
               |ABRE #nomconca;
               #nomconca#0 = #labtraba#87;
               |LEE 000#nomconca.=;
               |SI FSalida = 0; |Y #nomconca#162 ! 0;
                    #laborn13#17 = #nomconca#162;
               |SINO;
                    #nomconca#162 = 40;
               |FINSI;
               |PINTA #laborn13#17;
               |CIERRA #nomconca;
          |FINSI;

          #laborn13#20 = #laborn13#16;
          #laborn13#25 = #laborn13#20 / 7;
          |PINTA #laborn13#20;
          |PINTA #laborn13#25;
     |FINSI;

     |PINTA #laborn13#19;
     |PINTA #laborn13#26;
|FPRC;

|PROGRAMA;
     |CLS;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #labempre#aAlfa1#;
     |FINSI;

     aParam = PARAMETRO;
     |SI aParam = "MODIF"; |O aParam = "CONSUL";
          |ABRE #laborn03;
          |SI aParam = "MODIF";
               #laborn03#0 = "P";         || estado: pendiente, consulta/modificacion
          |FINSI;
          |SI aParam = "CONSUL";
               #laborn03#0 = "A";         || estado: actualizado, solo consulta
          |FINSI;
          #laborn03#1 = eaUsuario;
          #laborn03#2 = "";
          #laborn03#3 = eaFecha;
          #laborn03#4 = eaHora;
          |LEE 101#laborn03.=;

          |PARA nCampo = 0; |SI nCampo [ 33; |HACIENDO nCampo = nCampo + 1;
               #laborn13#nCampo# = #laborn03#nCampo#;
          |SIGUE;
          #laborn13#34 = #laborn03#37;
          #laborn13#35 = #laborn03#38;
          #laborn13#36 = #laborn03#34;
          #laborn13#37 = #laborn03#35;
          #laborn13#38 = #laborn03#36;
          |PARA nCampo = 39; |SI nCampo [ 45; |HACIENDO nCampo = nCampo + 1;
               #laborn13#nCampo# = #laborn03#nCampo#;
          |SIGUE;

          |PINPA #0#laborn13;
          |PINDA #0#laborn13;
          |CAMPO_MODIFICA #laborn13#5, 1, "N";
          |CAMPO_MODIFICA #laborn13#6, 1, "N";
          |CAMPO_MODIFICA #laborn13#7, 1, "N";
          |SI aParam = "CONSUL";
          |FINSI;
          |PINDA #0#laborn13;

          |HAZ Variacion;

          || datos calendario
          |ABRE #laborn07;
          #laborn07#0 = "P";         || estado: pendiente, consulta usuario
          #laborn07#1 = eaUsuario;
          #laborn07#2 = "";
          #laborn07#3 = eaFecha;
          #laborn07#4 = eaHora;
          |LEE 101#laborn07.=;
          |SI FSalida = 0;
               |PARA nCampo = 7; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
                    nCampo1 = nCampo - 5;
                    #labort03#nCampo1# = #laborn07#nCampo#;
               |SIGUE;
          |FINSI;
          |CIERRA #laborn07;

          |QBF eaUsuario;
          aAlfa1 = eaUsuario % 105;
          |SI eaUsuario = "WEB";
          |O aAlfa1 = "NUBEA";
               |HAZ VariosLaborbox;
          |FINSI;

          |SI aParam = "MODIF";
               |ENDATOS #1#laborn13;
               |SI FSalida ! 0;
                    swMeHeSalido = 1;
               |FINSI;
               |FIN_CONTROL_WINDOWS enBoton3;
               swBoton3 = 0;
          |FINSI;
          |SI aParam = "CONSUL";
               |PARA nCampo = 0; |SI nCampo [ 33; |HACIENDO nCampo = nCampo + 1;
                    #laborn13#nCampo# = #laborn03#nCampo#;
               |SIGUE;
               #laborn13#34 = #laborn03#37;
               #laborn13#35 = #laborn03#38;
               #laborn13#36 = #laborn03#34;
               #laborn13#37 = #laborn03#35;
               #laborn13#38 = #laborn03#36;
               |PARA nCampo = 39; |SI nCampo [ 45; |HACIENDO nCampo = nCampo + 1;
                    #laborn13#nCampo# = #laborn03#nCampo#;
               |SIGUE;
               |PINDA #0#laborn13;
               |PAUSA;
          |FINSI;
     |SINO;
          |HAZ Proceso;
     |FINSI;
     |SI FSalida = 0;
          |SI aParam = "MODIF";
               |PARA nCampo = 0; |SI nCampo [ 33; |HACIENDO nCampo = nCampo + 1;
                    #laborn03#nCampo# = #laborn13#nCampo#;
               |SIGUE;
               #laborn03#38 = #laborn13#35;
               #laborn03#34 = #laborn13#36;
               #laborn03#35 = #laborn13#37;
               #laborn03#36 = #laborn13#38;
               |PARA nCampo = 39; |SI nCampo [ 45; |HACIENDO nCampo = nCampo + 1;
                    #laborn03#nCampo# = #laborn13#nCampo#;
               |SIGUE;
               |GRABA 020#laborn03.a;

               || datos calendario
               |ABRE #laborn07;
               #laborn07#0 = "P";         || estado: pendiente, consulta usuario
               #laborn07#1 = eaUsuario;
               #laborn07#2 = "";
               #laborn07#3 = eaFecha;
               #laborn07#4 = eaHora;
               |LEE 101#laborn07.=;
               |SI FSalida = 0;
                    |PARA nCampo = 7; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
                         nCampo1 = nCampo - 5;
                         #laborn07#nCampo# = #labort03#nCampo1#;
                    |SIGUE;
                    |GRABA 020#laborn07.a;
               |FINSI;
               |CIERRA #laborn07;
          |SINO;
               |ABRE #laborn03;
               #laborn03#0 = "P";    || Estado: Pendiente
               #laborn03#1 = Usuario % 0810;     || Usuario
               #laborn03#2 = "";     || Perfiles, en principio no lo uso
               #laborn03#3 = ~;      || Fecha
               |HORA aHora;
               #laborn03#4 = aHora;  || Hora
               |PARA nCampo = 5; |SI nCampo [ 33; |HACIENDO nCampo = nCampo + 1;
                    #laborn03#nCampo# = #laborn13#nCampo#;
               |SIGUE;
               #laborn03#38 = #laborn13#35;
               #laborn03#34 = #laborn13#36;
               #laborn03#35 = #laborn13#37;
               #laborn03#36 = #laborn13#38;
               |PARA nCampo = 39; |SI nCampo [ 45; |HACIENDO nCampo = nCampo + 1;
                    #laborn03#nCampo# = #laborn13#nCampo#;
               |SIGUE;
               |HAZ Contador;
               |GRABA 020#laborn03.n;

               |ABRE #laborn07;
               #laborn07#0 = "P";         || estado: pendiente, consulta usuario
               #laborn07#1 = Usuario % 0810;
               #laborn07#2 = "";
               #laborn07#3 = ~;
               #laborn07#4 = aHora;
               |PARA nCampo = 7; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
                    nCampo1 = nCampo - 5;
                    #laborn07#nCampo# = #labort03#nCampo1#;
               |SIGUE;
               |GRABA 020#laborn07.n;
               |CIERRA #laborn07;

               |MENAV "    La solicitud de variación ha sido grabada";
               |HAZ Impresion;

               |ABRE #nompmail; |LEE 000#nompmail.p; |CIERRA #nompmail;
               |SI #nompmail#11 = "S";
                    |HAZ Email;
               |FINSI;
          |FINSI;

          |CIERRA #laborn03;
     |FINSI;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #labempre#aAlfa2#;
     |FINSI;
|FPRO;
