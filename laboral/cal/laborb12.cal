|FICHEROS;
     laborb12 #0;
     laborb02;
     labtraba;

     :/integral/def/dsam0103 #103;
     :/integral/def/dsam0104 #104;

     labmunic #100;

     laborn90;
|FIN;

|VARIABLES;
     &enID = 0;

     aHora = "";
     &eaVarDni  = "";
     &enCalcCif = 0;

     &eaDirDest  = "";
     &eaAsunto   = "";
     &eaTexto    = "";

     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     corta = 0;
     sitio = 0;
     jg = 0;

     nCampo = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;

     aAlfa = "";
     nNume = 0;

     &eaUsuario = "";
     &eaFecha = @;
     &eaHora = "";
     &eaEstado = "";
     &aParam = "";

     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aFechaNac = "";
     fFechaHoy = @;

     aDuracion = "";
     aDiaAlta = "";
     aMesAlta = "";
     aAnyAlta = "";
     aDiaBaja = "";
     aMesBaja = "";
     aAnyBaja = "";

     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     nDiaBaja = 0;
     nMesBaja = 0;
     nAnyBaja = 0;

     nAnys = 0;
     nMeses = 0;
     nDias = 0;
     aDias = "";
     aMeses = "";
     aAnys = "";
     aFechaBaja = "";

     xmesnume = 0;
     xtopemes = 0;
     xmod = 0;
     xanynume = 0;
     fech1 = @;
     fech2 = @;
     aFecha1 = "";
     aFecha2 = "";
     aFechaIni = "";
     fFechaFin = @;
     aFechaFin = "";
     fFecha = @;
     aFecha = "";
     nConvenio = 0;

     dia1 = "";
     mes1 = "";
     any1 = "";
     dia = 0;
     mes = 0;
     any = 0;
     tope = 0;
     sw = 0;
     fec = "";
     mod = 0;

     &eaEmpresa = "";
     &eaTrabajador = "";
     &eaAccion = "";
     &aCadena = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";

     swPI = 0;
     aBase = "";
     aMas = "";
     swDatosPer = 0;
     swDatosFam = 0;
     nAscendientes = 0;
     nDescendientes = 0;
     swPorDNI = 0;
     aMensaje = "";
     nEmpresas = 0;
     nCodEmp = 0;
     aNomEmp = "";

     &enBoton3 = 0;
     &enEmpresa = 0;
     FEstado = 0;
     &swBoton3 = 0;
     aNif = "";
     swAnt = 0;
     &swHeSalido = 0;
|FIN;

|PROCESO Pais;
     aAlfa = #0#14;
     |QBF aAlfa;
     |SI aAlfa ! "";
          |ABRE #dsam0104;
          |SELECT #2#dsam0104;
          #dsam0104#1 = aAlfa;
          |LEE 000#dsam0104.=;
          |SI FSalida = 0;
               #0#13 = #dsam0104#0;
               |PINTA #0#13;
          |FINSI;
          |CIERRA #dsam0104;
     |FINSI;
|FPRC;

|PROCESO Cambia;
     aAlfa1 = #0nCampo1; |QBF aAlfa1;
     aAlfa2 = #0nCampo2; |QBF aAlfa2;
     |SI nCampo1 = 16;
          |SI #0#15 = #0#45;
               aAlfa1 = aAlfa2;
          |FINSI;
     |FINSI;
     |SI aAlfa1 ! aAlfa2;
          |CAMPO_ATRIBUTO #0nCampo1, S, 0, 0;
          |CAMPO_ATRIBUTO #0nCampo2, S, 0, 0;
     |SINO;
          |CAMPO_ATRIBUTO #0nCampo1, D, 0, 0;
          |CAMPO_ATRIBUTO #0nCampo2, D, 0, 0;
     |FINSI;
|FPRC;

|PROCESO Resalta;
     |PARA nCampo1 = 2; |SI nCampo1 [ 23; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2 = nCampo1 + 30;
          |HAZ Cambia;
     |SIGUE;
     nCampo1 = 58; nCampo2 = 60; |HAZ Cambia;
     nCampo1 = 59; nCampo2 = 61; |HAZ Cambia;
|FPRC;

|PROCESO ResaltaUno;
     nCampo1 = Campo;
     |SI nCampo1 ] 2; |Y nCampo1 [ 23;
          nCampo2 = nCampo1 + 30;
     |SINO;
          nCampo2 = nCampo1 + 2;
     |FINSI;
     |HAZ Cambia;
     |PINTA #0nCampo1;
     |PINTA #0nCampo2;
|FPRC;

|PROCESO ConsultaPais; |TIPO 66;
     |HAZ SacaVentana;
|FPRC;

|PROCESO CompruebaCP; |TIPO 0;
     || nCampo = Cod. Postal
     || nCampo1 = Nombre Municipio
     || nCampo2 = Codigo Provincia
     || nCampo3 = Nombre Provincia

     |SI Campo = 18;
          nCampo = 18;
          nCampo1 = 19;
          nCampo2 = 0;
          nCampo3 = 20;
     |FINSI;

     |ABRE #100;
     |SELECT #4#100;
     #100#4 = #0Campo;
     |LEE 000#100=;
     |SI FSalida = 0;
          |SI #0nCampo ! Contenido;
               nCampo = Campo;
               #0nCampo = #100#4;     |PINTA #0nCampo;
               #0nCampo1 = #100#3;     |PINTA #0nCampo1;
               ||#0nCampo2 = (#100#0 % 102);     |PINTA #0nCampo2;
               #0nCampo3 = #100#2;     |PINTA #0nCampo3;
          |FINSI;
     |SINO;
          |SI #0Campo ! "     ";
               nCampo = Campo;
               #0nCampo = "";     |PINTA #0nCampo;
               #0nCampo1 = "";     |PINTA #0nCampo1;
               ||#0nCampo2 = "";     |PINTA #0nCampo2;
               #0nCampo3 = "";     |PINTA #0nCampo3;
               |MENAV "    El Código Postal no existe. Pulse F11 para ver la lista."
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #100;
|FPRC;

|PROCESO DigitoNAFSS; |TIPO 0;
     aAlfa = #0Campo;
     |QBF aAlfa;
     aAlfa = aAlfa % 0;
     nNume = aAlfa;
     aAlfa = "    ATENCION. El número de afiliación a la Seg. Social ";
     aAlfa = aAlfa + "no puede exceder de 12 dígitos."
     |SI nNume > 12;
          |MENAV aAlfa;
          |ERROR;
     |FINSI;

     |SI FSalida = 9;
          alfa1 = #0Campo;
          |QBF alfa1;

          aAlfa = alfa1 % 0;            || si mide mas de 10 digitos y me piden
          nNume = aAlfa;                || que calcule el digito de control
          |SI nNume > 10;               || quito el que me hubieran introducido
               alfa1 = alfa1 % 110;
               #0Campo = alfa1;
          |FINSI;

          alfa2 = alfa1 % 102; alfa3 = alfa1 % -108;
          alfa4 = alfa3 % 101;
          |SI alfa4 = "0";
               alfa3 = alfa3 % 207;
               alfa1 = alfa2 + alfa3;
          |FINSI;
          nume1 = alfa1;
          nume2 = nume1 / 97;
          |HAZ trunca2;
          |SI nume1 ] 0; |Y nume1 [ 99;
               alfa1 = #0Campo;
               |QBF alfa1;
               alfa2 = nume1;
               alfa2 = "00" + alfa2;
               alfa2 = alfa2 % -102;
               alfa1 = alfa1 + alfa2;
               #0Campo = alfa1;
               |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO trunca2;
     corta = 0;
     alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
     |PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
          sitio = (jg * 100) + 1;
          alfa2 = alfa1 % sitio;
          |SI alfa2 = ".";  corta = jg;  |FINSI;
     |SIGUE;
     |SI corta ! 0;
          sitio = 100 + corta - 1;
          alfa1 = alfa1 % sitio;
     |FINSI;
     nume3 = alfa1;
     nume1 = nume1 - (nume3 * 97);
|FPRC;

|PROCESO LetraNIF;
     eaVarDni  = #0Campo;
     enCalcCif = 1;
     |HAZ CalculoDNI;
     #0Campo = eaVarDni;
     |PINTA #0Campo;
|FPRC;

     || BANCO
     aAlfa1 = #laborb02#19 + #laborb02#20 + #laborb02#21 + #laborb02#22 + #laborb02#23;
     |QBF aAlfa1;
     aAlfa2 = #labtraba#154;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;
          nEntrada = 1;
          #labtraba#154 = aAlfa1;
          #labtraba#72 = #laborb02#20 + #laborb02#21 + #laborb02#22 + #laborb02#23;
     |FINSI;
|FPRC;

|PROCESO IBAN;
     aAlfa = #labtraba#154;

     |SI swAnt = 0;
          #laborb12#19 = aAlfa % 104;
          #laborb12#20 = aAlfa % 504;
          #laborb12#21 = aAlfa % 904;
          #laborb12#22 = aAlfa % 1102;
          #laborb12#23 = aAlfa % 1310;
          #laborb12#33 = #labtraba#153;
          #laborb12#34 = #labtraba#155;
     |FINSI;
     |SI swAnt = 1;
          #laborb02#49 = aAlfa % 104;
          #laborb02#50 = aAlfa % 504;
          #laborb02#51 = aAlfa % 904;
          #laborb02#52 = aAlfa % 1102;
          #laborb02#53 = aAlfa % 1310;
          #laborb02#60 = #labtraba#153;
          #laborb02#61 = #labtraba#155;
     |FINSI;

     |ERROR10;
|FPRC;

|DEFBUCLE BuscaTra;
     #labtraba#2;
     44;
     aNif, "A";
     aNif, "A";
     be;
     NULL, IBAN;
|FIN;

|PROCESO labtraba;
     aNif = #laborb12#1;
     |QBF aNif;
     aNif = (aNif + "            ") % 112;
     |BUCLE BuscaTra;
|FPRC;

|PROCESO dsam0103;
     |SI #0Campo = Contenido;
          |ACABA;
     |FINSI;
     |ABRE #103;
     #103#0 = #laborb12#1;
     |LEE 101#103=;
     |SI FSalida = 0;
          |SI swAnt = 0;
               |PARA nCampo = 1; |SI nCampo [ 17; |HACIENDO nCampo = nCampo + 1;
                    nCampo1 = nCampo + 1;
                    #laborb12#nCampo1# = #103nCampo;
               |SIGUE;
          |FINSI;
          |SI swAnt = 1;
               || esta parte es al final, para que se grabe lo ANTiguo
               |PARA nCampo = 1; |SI nCampo [ 17; |HACIENDO nCampo = nCampo + 1;
                    nCampo1 = nCampo + 31;
                    #laborb02#nCampo1# = #103nCampo;
               |SIGUE;
          |FINSI;
     |FINSI;
     |CIERRA #103;

     |HAZ labtraba;

     |SI swAnt = 0;
          |HAZ Pais;
          |HAZ Resalta;
          |PINDA #0#laborb12;
     |FINSI;
|FPRC;

|PROCESO RecogeDatos;
     |SI aParam = "ALTA";
          |ABRE #laborb02;
          |LEE 000#laborb02.u;
          |SI FSalida = 0;
               enID = #laborb02#0 + 1;
          |SINO;
               enID = 1;
          |FINSI;
          #0#0 = enID;
          #0#25 = ~;
          |HORA aHora;
          #0#26 = aHora;
          #0#27 = Usuario % 0810;

          |PINPA #0#0;
          |HAZ Pais;
          |HAZ Resalta;
          |PINDA #0#0;

          |ACABA;
     |FINSI;

     |ABRE #laborb02;
     #laborb02#0 = enID;
     |LEE 101#laborb02.=;
     |SI FSalida = 0;
          || datos generales
          |PARA nCampo = 0; |SI nCampo [ 68; |HACIENDO nCampo = nCampo + 1;
               #laborb12#nCampo# = #laborb02#nCampo#;
          |SIGUE;
     |FINSI;
     |CIERRA #laborb02;

     |PINPA #0#0;

     |HAZ Pais;
     |HAZ Resalta;
     |PINDA #0#0;
|FPRC;

|PROCESO Contador;
     |ABRE #laborn90;

     #laborn90#0 = #laborb02#54;
     #laborn90#1 = 99999;

     |LEE 000#laborn90.];
     |SI FSalida = 0;
          |SI #laborn90#0 ! #laborb02#54;
               |LEE 000#laborn90.a;
          |FINSI;
     |SINO;
          |LEE 000#laborn90.u;
     |FINSI;

     |SI FSalida = 0;
     |Y #laborn90#0 = #laborb02#54;
          nNume = #laborn90#1;

          |DDEFECTO #laborn90;
          #laborn90#0 = #laborb02#54;
          #laborn90#1 = nNume + 1;

     |SINO;
          || es el primero de esta empresa !!!
          |DDEFECTO #laborn90;
          #laborn90#0 = #laborb02#54;
          #laborn90#1 = 1;
     |FINSI;

     #laborn90#2 = "D";
     #laborn90#3 = "Cambio Dat";
     #laborn90#4 = #laborb12#25;
     #laborn90#5 = "";
     #laborn90#6 = #laborb12#26;
     #laborn90#7 = #laborb12#27;

     |GRABA 020#laborn90.n;

     #laborb02#56 = #laborn90#1;

     |LIBERA #laborn90;
     |CIERRA #laborn90;
|FPRC;

|PROGRAMA;
     |CLS;
     aParam = PARAMETRO;
     |HAZ RecogeDatos;

     |SI aParam = "MODIF";
          swHeSalido = 0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |ABRE #laborb02;
               #laborb02#0 = #laborb12#0;
               |LEE 101#laborb02.=;
               |SI FSalida = 0;
                    |PARA nCampo = 0; |SI nCampo [ 68; |HACIENDO nCampo = nCampo + 1;
                         #laborb02#nCampo# = #laborb12#nCampo#;
                    |SIGUE;
                    |GRABA 020#laborb02.a;
               |FINSI;
               |CIERRA #laborb02;
          |SINO;
               swHeSalido = 1;
          |FINSI;
     |FINSI;
     |SI aParam = "CONSU";
          |PAUSA;
     |FINSI;
     |SI aParam = "ALTA";
          |CAMPO_MODIFICA #laborb12#1, 1, "S";
          |CAMPO_MODIFICA #laborb12#2, 1, "S";
          |CAMPO_MODIFICA #laborb12#32, 1, "S";
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |ABRE #laborb02;
               #laborb02#0 = #laborb12#0;
               |LEE 101#laborb02.=;
               |SI FSalida ! 0;
                    |PARA nCampo = 0; |SI nCampo [ 68; |HACIENDO nCampo = nCampo + 1;
                         #laborb02#nCampo# = #laborb12#nCampo#;
                    |SIGUE;

                    swAnt = 1;
                    |HAZ dsam0103;
                    swAnt = 0;

                    || codigo de empresa y trabajador
                    #laborb02#54 = #labtraba#0;
                    #laborb02#55 = #labtraba#1;

                    |HAZ Contador;

                    |GRABA 020#laborb02.n;
               |FINSI;
               |CIERRA #laborb02;
          |FINSI;
     |FINSI;
|FPRO;
