|FICHEROS;
    nogue003 #00;

    nomhicca;
    nomhicli;

    nogue001 #30;
    nogue002 #31;
    nomxpara #32;
    nomauxi1 #33;
    nomauxi2 #34;

    nogue014 #40;
    nogue006 #60; || Numero / Alfa
    nogue007 #70; || Subrayado/Titulo
    nogue008 #80; || Total Empresa/Centro
    nogue009 #90; || Total Area/Seccion

    labempre #01;   || empresas
    labtraba #02;   || trabajadores
    nomconst #03;   || constantes
    labcentr #06;   || centros de trabajo
    nomtrnom #10;   || def nomina
    nomcenes #35;   || centros 18/93
    nomcontr #36;   || control aplicacion
    nomdesam #100;  || descrip. ampliadas
    nomtraca #101;  || trabajadores cabs.
    nomconca #102;  || convenios cabs.
    nomvarca #103;  || variaciones empresa mes

    trabajo@;
|FIN;

|VARIABLES;
     i = 0;
     aCampos = 0;
     nCampo = 0;
     nCamHis = 0;
     nCampo1 = 0;
     nNume = 0;
     nCam = 0;
     aValor = "";
     punt_campo = 0;
     punt_tempr = 0;
     punt_tcent = 0;
     punt_tarea = 0;
     punt_tsecc = 0;
     punt_subra = 0;
     punt_titul = 0;
     punt_refer = 0;
     punt_signo = 0;
     calcu = "";
     laeme = "";
     refer = "";
     recogido = 0;
     multiplica = 0;
     memoria = 0;
     ant_empre = -1;
     ant_centr = -1;
     ant_area  = "";
     ant_secc  = "";
     ant_traba = -1;
     sw_ruptura = 0;
     rupturas = "";


     el_a00 = 0;
     el_a31 = 0;
     el_a32 = 0;
     el_a33 = 0;
     el_a34 = 0;
     el_a35 = 0;
     el_a36 = 0;
     el_a37 = 0;
     el_a39 = 0;
     el_a40 = 0;
     el_a41 = 0;
     anticipo3 = 0;
     afili = "";
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     ante_emp = 0;
     ante_tra = 0;
     anyo = 0;
     anyrec = 0;
     anytra = 0;
     apordfp = 0;
     aporfp = 0;
     apord = 0;
     aporhe1 = 0;
     aporhe2 = 0;
     arteris = "";
     bisiesto = 0;
     camdesc = 0;
     campo = 0;
     camptas = 0;
     concep = 0;
     dcal_101 = "";
     deducir = 0;
     desacc = 0;
     descri = "";
     desdia = 0;
     desenf = 0;
     diaalta = 0;
     diabaja = 0;
     diarec = 0;
     diatra = 0;
     domemp = "";
     duni_101 = 0;
     dval_101 = 0;
     duni_102 = 0;
     fecsys = @;
     fectra = "";
     hasacc = 0;
     hasdia = 0;
     hasenf = 0;
     import = 0;
     incluye = 0;
     lineas = 0;
     mensaje1 = "    ATENCION !!! Error de Entrada ...";
     mesalf = "";
     mesalta = 0;
     mesbaja = 0;
     mesliq1 = "";
     mesliq2 = "";
     mesnum = 0;
     mesrec = "";
     mestra = 0;
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     numer = 0;
     nro_copias = 0;
     p_mes = "";
     pantalla = 0;
     pobemp = "";
     seleccio = 0;
     situac = 0;
     swbaja = 0;
     swtacc = 0;
     swtenf = 0;
     tantici = 0;
     taporta = 0;
     tbcotiz = 0;
     tcotiz = 0;
     topemes = 0;
     tot_109 = 0;
     tot_110 = 0;
     tot_111 = 0;
     tot_112 = 0;
     tot_113 = 0;
     tot_114 = 0;
     tot_115 = 0;
     unidad = 0;
     valor = 0;
     guarda_emp = 0;
     guarda_cen = 0;
     guarda_are = "";
     guarda_sec = "";

     el_66 = 0;
     el_67 = 0;
     el_68 = 0;
     el_69 = 0;
     el_70 = 0;
     el_71 = 0;
     el_72 = 0;
     el_73 = 0;
     el_74 = 0;
     el_75 = 0;
     el_76 = 0;
     el_77 = 0;
     el_165 = 0;
     sw_equiv = 0;
     sw_control = 0;
     CodigoCons = 0;
     deci_h = 0;
     cta_co = "";
     para1 = 0;
     para2 = 0;
     duni_hest = 0;
     duni_hnoest = 0;

     aAlfa       = "";
     aDef        = "";
     aMas        = "";
     aFicTmp     = "";

     anybaja = 0;
     anticipo4 = 0;
     nEmpAnt = 0;
     nTraAnt = 0;
     swSigueReci = 0;

     &sw_nombre = 0;
     &linea = 0;
     &dmes = 0;
     &hmes = 0;
     &peri = 0;
     &swPDFMasivo = 0;
     &aProcedencia = "";
     &enColumnas = 0;
     &enInforme = 0;
     &EURODB = 0;
     &enCanti = 0;
     &eaMoneda = "";
     &aMonedaRec = "";
     &nCConst = 0;
     &fCFecha = @;
     &aCError = "";

     &swExcel = 0;
     nValor = 0;
     swProrr = 0;
|FIN;

||****************************************************************************
||******* LIBRERIAS **********************************************************
||****************************************************************************

|PROCESO Lib0;        || CONVIERTE A LITERAL MES EN NUMERO Y HALLA ULTIMO DIA
                       || PARAMETROS ENTRADA:  'mesnum', 'anynum'
                       || PARAMETROS SALIDA:   'mesalf', 'topemes'
     |SI mesnum =  1;  mesalf = "ENERO     ";  topemes = 31;  |FINSI;
     |SI mesnum =  2;
             mesalf = "FEBRERO   ";
             numer = #0#4 $ 4;
         |SI numer = 0; topemes = 29;  |SINO;  topemes = 28;  |FINSI;
     |FINSI;
     |SI mesnum =  3;  mesalf = "MARZO     ";  topemes = 31;  |FINSI;
     |SI mesnum =  4;  mesalf = "ABRIL     ";  topemes = 30;  |FINSI;
     |SI mesnum =  5;  mesalf = "MAYO      ";  topemes = 31;  |FINSI;
     |SI mesnum =  6;  mesalf = "JUNIO     ";  topemes = 30;  |FINSI;
     |SI mesnum =  7;  mesalf = "JULIO     ";  topemes = 31;  |FINSI;
     |SI mesnum =  8;  mesalf = "AGOSTO    ";  topemes = 31;  |FINSI;
     |SI mesnum =  9;  mesalf = "SEPTIEMBRE";  topemes = 30;  |FINSI;
     |SI mesnum = 10;  mesalf = "OCTUBRE   ";  topemes = 31;  |FINSI;
     |SI mesnum = 11;  mesalf = "NOVIEMBRE ";  topemes = 30;  |FINSI;
     |SI mesnum = 12;  mesalf = "DICIEMBRE ";  topemes = 31;  |FINSI;
     |SI mesnum =  0;  mesalf = "          ";  topemes =  0;  |FINSI;
|FPRC;

|PROCESO Lib1;        || SEPARA UNA FECHA DADA EN DIA,MES Y A¥O
                       || PARAMETROS ENTRADA:  'fectra'
                       || PARAMETROS SALIDA:   'diatra', 'mestra', 'anytra'
     diatra = 0;
     mestra = 0;
     anytra = 0;

     |SI fectra ! "          "; |Y fectra ! "..........";
         alfa1 = fectra % 102;
         diatra = alfa1;
         alfa1 = fectra % 402;
         mestra = alfa1;
         alfa1 = fectra % -102;
         anytra = alfa1;
     |FINSI;
|FPRC;

||****************************************************************************
||***** calculos de lectura e impresion **************************************
||****************************************************************************

|PROCESO Mes;
     |SI #10#15 = "ENERO     ";  mesnum =  1;  |FINSI;
     |SI #10#15 = "FEBRERO   ";  mesnum =  2;  |FINSI;
     |SI #10#15 = "MARZO     ";  mesnum =  3;  |FINSI;
     |SI #10#15 = "ABRIL     ";  mesnum =  4;  |FINSI;
     |SI #10#15 = "MAYO      ";  mesnum =  5;  |FINSI;
     |SI #10#15 = "JUNIO     ";  mesnum =  6;  |FINSI;
     |SI #10#15 = "JULIO     ";  mesnum =  7;  |FINSI;
     |SI #10#15 = "AGOSTO    ";  mesnum =  8;  |FINSI;
     |SI #10#15 = "SEPTIEMBRE";  mesnum =  9;  |FINSI;
     |SI #10#15 = "OCTUBRE   ";  mesnum = 10;  |FINSI;
     |SI #10#15 = "NOVIEMBRE ";  mesnum = 11;  |FINSI;
     |SI #10#15 = "DICIEMBRE ";  mesnum = 12;  |FINSI;
|FPRC;

|PROCESO Control;
     |DDEFECTO #36;
     |ABRE #36;
     |LEE 000#36p;
     |SI FSalida ! 0;
         |MENAV "    No existe control, usando defectos ...";
     |FINSI;
     |CIERRA #36;
|FPRC;

|PROCESO Constante;
     alfa1 = "01";
     alfa2 = #0#5;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     nNume = #0#4 + 2000;
     alfa3 = nNume;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
     |SI aCError ! "";
          |SI nCConst = 500;
               aAlfa = "0000No se ha encontrado la Constante Comun del ";
               aAlfa = aAlfa + " Regimen General (500)";
               |MENAV aAlfa;
          |SINO;
               alfa1 = #labtraba#0; alfa1 = "00000" + #labtraba#0; alfa1 = alfa1 % -105;
               alfa2 = #labtraba#1; alfa2 = "00000" + #labtraba#1; alfa2 = alfa2 % -105;
               aAlfa = "0000ATENCION: Trabajador: " + alfa1 + "." + alfa2;
               aAlfa = aAlfa + " La constante del trabajador no esta definida.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PrintLinea;
     |SI swExcel = 0;
          |PRINT;
     |SINO;
          |HAZ Linea_Excel;
     |FINSI;
|FPRC;

|PROCESO LeeTotales;
     |DDEFECTO #30;
     |ABRE #30;
     #30#0 = #0#7;
     |LEE 020#30=;
     |CIERRA #30;
     rupturas = #30#3 + #30#4 + #30#5;
|FPRC;

|PROCESO Recoge;
                         recogido = 0;
     |SI calcu = " 01";  recogido = #10#023;  |ACABA;  |FINSI;
     |SI calcu = " 02";  recogido = #10#024;  |ACABA;  |FINSI;
     |SI calcu = " 03";  recogido = #10#025;  |ACABA;  |FINSI;
     |SI calcu = " 04";  recogido = #10#026;  |ACABA;  |FINSI;
     |SI calcu = " 05";  recogido = #10#027;  |ACABA;  |FINSI;
     |SI calcu = " 06";  recogido = #10#028;  |ACABA;  |FINSI;
     |SI calcu = " 07";  recogido = #10#029;  |ACABA;  |FINSI;
     |SI calcu = " 08";  recogido = #10#030;  |ACABA;  |FINSI;
     |SI calcu = " 09";  recogido = #10#031;  |ACABA;  |FINSI;
     |SI calcu = " 10";  recogido = #10#032;  |ACABA;  |FINSI;
     |SI calcu = " 11";  recogido = #10#033;  |ACABA;  |FINSI;
     |SI calcu = " 12";  recogido = #10#034;  |ACABA;  |FINSI;
     |SI calcu = " 13";  recogido = #10#035;  |ACABA;  |FINSI;
     |SI calcu = " 14";  recogido = #10#036;  |ACABA;  |FINSI;
     |SI calcu = " 15";  recogido = #10#037;  |ACABA;  |FINSI;
     |SI calcu = " 16";  recogido = #10#038;  |ACABA;  |FINSI;
     |SI calcu = " 17";  recogido = #10#039;  |ACABA;  |FINSI;
     |SI calcu = " 18";  recogido = #10#040;  |ACABA;  |FINSI;
     |SI calcu = " 19";  recogido = #10#041;  |ACABA;  |FINSI;
     |SI calcu = " 20";  recogido = #10#042;  |ACABA;  |FINSI;
     |SI calcu = " 21";  recogido = #10#043;  |ACABA;  |FINSI;
     |SI calcu = " 22";  recogido = #10#044;  |ACABA;  |FINSI;
     |SI calcu = " 23";  recogido = #10#045;  |ACABA;  |FINSI;
     |SI calcu = " 24";  recogido = #10#046;  |ACABA;  |FINSI;
     |SI calcu = " 25";  recogido = #10#047;  |ACABA;  |FINSI;
     |SI calcu = " 26";  recogido = #10#048;  |ACABA;  |FINSI;
     |SI calcu = " 27";  recogido = #10#049;  |ACABA;  |FINSI;
     |SI calcu = " 28";  recogido = #10#050;  |ACABA;  |FINSI;
     |SI calcu = " 29";  recogido = #10#051;  |ACABA;  |FINSI;
     |SI calcu = " 30";  recogido = #10#052;  |ACABA;  |FINSI;
     |SI calcu = " 31";  recogido = #10#053;  |ACABA;  |FINSI;
     |SI calcu = " 32";  recogido = #10#054;  |ACABA;  |FINSI;
     |SI calcu = " 33";  recogido = #10#055;  |ACABA;  |FINSI;
     |SI calcu = " 34";  recogido = #10#056;  |ACABA;  |FINSI;
     |SI calcu = " 35";  recogido = #10#057;  |ACABA;  |FINSI;
     |SI calcu = " 36";  recogido = #10#058;  |ACABA;  |FINSI;
     |SI calcu = " 37";  recogido = #10#059;  |ACABA;  |FINSI;
     |SI calcu = " 38";  recogido = #10#060;  |ACABA;  |FINSI;
     |SI calcu = " 39";  recogido = #10#061;  |ACABA;  |FINSI;
     |SI calcu = "A00";  recogido = el_a00;   |ACABA;  |FINSI;
     |SI calcu = "A01";  recogido = #10#101;  |ACABA;  |FINSI;
     |SI calcu = "A02";  recogido = #10#102;  |ACABA;  |FINSI;
     |SI calcu = "A03";  recogido = #10#103;  |ACABA;  |FINSI;
     |SI calcu = "A04";  recogido = #10#104;  |ACABA;  |FINSI;
     |SI calcu = "A05";  recogido = #10#119;  |ACABA;  |FINSI;
     |SI calcu = "A06";  recogido = #10#120;  |ACABA;  |FINSI;
     |SI calcu = "A07";  recogido = #10#121;  |ACABA;  |FINSI;
     |SI calcu = "A08";  recogido = #10#122;  |ACABA;  |FINSI;
     |SI calcu = "A09";  recogido = #10#123;  |ACABA;  |FINSI;
     |SI calcu = "A10";  recogido = #10#127;  |ACABA;  |FINSI;
     |SI calcu = "A11";  recogido = #10#131;  |ACABA;  |FINSI;
     |SI calcu = "A12";  recogido = #10#124;  |ACABA;  |FINSI;
     |SI calcu = "A13";  recogido = #10#128;  |ACABA;  |FINSI;
     |SI calcu = "A14";  recogido = #10#132;  |ACABA;  |FINSI;
     |SI calcu = "A15";  recogido = #10#125;  |ACABA;  |FINSI;
     |SI calcu = "A16";  recogido = #10#129;  |ACABA;  |FINSI;
     |SI calcu = "A17";  recogido = #10#133;  |ACABA;  |FINSI;
     |SI calcu = "A18";  recogido = #10#126;  |ACABA;  |FINSI;
     |SI calcu = "A19";  recogido = #10#130;  |ACABA;  |FINSI;
     |SI calcu = "A20";  recogido = #10#134;  |ACABA;  |FINSI;
     |SI calcu = "A21";  recogido = #10#135;  |ACABA;  |FINSI;
     |SI calcu = "A22";  recogido = #10#153;  |ACABA;  |FINSI;
     |SI calcu = "A23";  recogido = #10#154;  |ACABA;  |FINSI;
     |SI calcu = "A24";  recogido = #10#155;  |ACABA;  |FINSI;
     |SI calcu = "A25";  recogido = #10#138;  |ACABA;  |FINSI;
     |SI calcu = "A26";  recogido = #10#139;  |ACABA;  |FINSI;
     |SI calcu = "A27";  recogido = #10#140;  |ACABA;  |FINSI;
     |SI calcu = "A28";  recogido = #10#141;  |ACABA;  |FINSI;
     |SI calcu = "A29";  recogido = #10#142;  |ACABA;  |FINSI;
     |SI calcu = "A30";  recogido = #10#118;  |ACABA;  |FINSI;
     |SI calcu = "A31";  recogido = el_a31;   |ACABA;  |FINSI;
     |SI calcu = "A32";  recogido = el_a32;   |ACABA;  |FINSI;
     |SI calcu = "A33";  recogido = el_a33;   |ACABA;  |FINSI;
     |SI calcu = "A34";  recogido = el_a34;   |ACABA;  |FINSI;
     |SI calcu = "A35";  recogido = el_a35;   |ACABA;  |FINSI;
     |SI calcu = "A37";  recogido = el_a37;   |ACABA;  |FINSI;

     |SI #2#42 = "T"; |O #2#42 = "D";
          |SI calcu = "A38";  recogido = 440;   |ACABA;  |FINSI;
     |SINO;
          |SI calcu = "A38";  recogido = 435;   |ACABA;  |FINSI;
     |FINSI;

     |SI calcu = "A39";  recogido = el_a39;   |ACABA;  |FINSI;
     |SI calcu = "A40";  recogido = el_a40;   |ACABA;  |FINSI;
     |SI calcu = "A41";  recogido = el_a41;   |ACABA;  |FINSI;
|FPRC;

|PROCESO Totales;
     |SI swExcel = 1;
          |PARA nCampo = 0; |SI nCampo [ 99; |HACIENDO nCampo = nCampo + 1;
               nCampo1 = nCampo + 100;

               #80nCampo  = #80nCampo + #60nCampo;
               #90nCampo  = #90nCampo + #60nCampo;
               #80nCampo1 = #80nCampo1 + #60nCampo;
               #90nCampo1 = #90nCampo1 + #60nCampo;
          |SIGUE;
     |SINO;
          |PARA nume1 = 6; |SI nume1 [ 35; |HACIENDO nume1 = nume1 + 1;
               punt_tempr = nume1 + 30;
               punt_tcent = nume1 + 60;
               punt_tarea = nume1 + 90;
               punt_tsecc = nume1 + 180;
               #32punt_tempr = #32punt_tempr + #32nume1;
               #32punt_tcent = #32punt_tcent + #32nume1;
               #32punt_tarea = #32punt_tarea + #32nume1;
               #32punt_tsecc = #32punt_tsecc + #32nume1;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO LeeAntCentr;
    #6#0 = ant_empre;
    #6#1 = ant_centr;
    |LEE 001#6=;
    |SI FSalida ! 0;
        |DDEFECTO #6;
    |FINSI;
|FPRC;

|PROCESO Linea1;        || ruptura por empresa
     linea = 1;
     |HAZ PrintLinea;
     ant_empre = #2#0;

     |SI swExcel = 1;
          |PARA nCampo = 0; |SI nCampo [ 99; |HACIENDO nCampo = nCampo + 1;
               #80Campo = 0;
          |SIGUE;
     |SINO;
          |PARA nume1 = 36; |SI nume1 [ 65; |HACIENDO nume1 = nume1 + 1;
               #32nume1 = 0;
          |SIGUE;
          |PIEINF;
     |FINSI;
|FPRC;

|PROCESO Linea2;        || ruptura por centro
     |SI #30#3 = "S";
          |HAZ LeeAntCentr;
          linea = 2;
          |HAZ PrintLinea;
          ant_centr = #2#77;
          |SI swExcel = 1;
               |PARA nCampo = 100; |SI nCampo [ 199; |HACIENDO nCampo = nCampo + 1;
                    #80nCampo = 0;
               |SIGUE;
          |SINO;
               |PARA nume1 = 66; |SI nume1 [ 95; |HACIENDO nume1 = nume1 + 1;
                    #32nume1 = 0;
               |SIGUE;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Linea3;        || ruptura por area
     |SI #30#4 = "S";
          #33#0 = ant_area;
          |LEE 000#33=;
          |SI FSalida ! 0;
              |DDEFECTO #33;

              #33#0 = ant_area;
          |FINSI;
          alfa1 = #33#1;
          |QBF alfa1;
          alfa1 = alfa1 + ".................................";
          alfa1 = alfa1 % 133;
          #33#1 = alfa1;

          linea = 3;
          |HAZ PrintLinea;
          ant_area  = #2#62;
          |SI swExcel = 1;;
               |PARA nCampo = 0; |SI nCampo [ 99; |HACIENDO nCampo = nCampo + 1;
                    #90nCampo = 0;
               |SIGUE;
          |SINO;
               |PARA nume1 = 96; |SI nume1 [ 125; |HACIENDO nume1 = nume1 + 1;
                    #32nume1 = 0;
               |SIGUE;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Linea4;        || ruptura por seccion
     |SI #30#5 = "S";
          #34#0 = ant_area;
          #34#1 = ant_secc;
          |LEE 000#34=;
          |SI FSalida ! 0;
              |DDEFECTO #34;

              #34#0 = ant_area;
              #34#1 = ant_secc;
          |FINSI;
          alfa1 = #34#2;
          |QBF alfa1;
          alfa1 = alfa1 + ".................................";
          alfa1 = alfa1 % 133;
          #34#2 = alfa1;

          linea = 4;
          |HAZ PrintLinea;
          || ant_area = #2#62;
          ant_secc = #2#63;

          |SI swExcel = 1;
               |PARA nCampo = 100; |SI nCampo [ 199; |HACIENDO nCampo = nCampo + 1;
                    #90nCampo = 0;
               |SIGUE;
          |SINO;
               |PARA nume1 = 186; |SI nume1 [ 215; |HACIENDO nume1 = nume1 + 1;
                    #32nume1 = 0;
               |SIGUE;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Limpia;         || no se puede hacer un DDEFECTO por los totales
    #32#00 = 0;
    #32#01 = "";
    #32#02 = 0;
    #32#03 = "";
    #32#04 = "";
    #32#05 = 0;
    #32#06 = 0;
    #32#07 = 0;
    #32#08 = 0;
    #32#09 = 0;
    #32#10 = 0;
    #32#11 = 0;
    #32#12 = 0;
    #32#13 = 0;
    #32#14 = 0;
    #32#15 = 0;
    #32#16 = 0;
    #32#17 = 0;
    #32#18 = 0;
    #32#19 = 0;
    #32#20 = 0;
    #32#21 = 0;
    #32#21 = 0;
    #32#22 = 0;
    #32#23 = 0;
    #32#24 = 0;
    #32#25 = 0;
    #32#26 = 0;
    #32#27 = 0;
    #32#28 = 0;
    #32#29 = 0;
    #32#30 = 0;
    #32#31 = 0;
    #32#32 = 0;
    #32#33 = 0;
    #32#34 = 0;
    #32#35 = 0;
|FPRC;

|PROCESO CtaCotizacion;
     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
      |O #2#45 = "064";|O #2#45 = "065";
         |DDEFECTO #35;
         #35#0 = #2#0;
         #35#13= #2#77;
         |SI #2#45 = "097";|O #2#45 = "085";
             #35#1 = "87";
         |SINO;
             |SI #2#45 = "065";
                 #35#1 = "64";
             |SINO;
                 #35#1 = #2#45 % 2;
             |FINSI;
        |FINSI;

        |LEE 000#35=;
        cta_co = #35#10;      || cta.cto. del centro de trabajo especial
     |SINO;
        cta_co = #1#13;       || cta.cot. de la empresa
        |DDEFECTO #6;
        #6#0 = #2#0;
        #6#1 = #2#77;
        |LEE 000#6=;
        |SI #1#45 = "S";
            cta_co = #6#10;        || cta.cot. centro de trabajo
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO CargasHicca_0;      || CARGA LOS CAMPOS LITERALES Y LOS FIJOS
     #10#000 = #1#10;          || cif empresa
     #10#001 = #1#00;          || codigo empresa
     #10#002 = #2#01;          || codigo trabajador
     #10#003 = #1#02;          || nombre empresa
     #10#004 = domemp;         || direccion empresa
     #10#005 = pobemp;         || poblacion empresa
     #10#006 = #2#02;          || nombre trabajador
     #10#007 = #2#18;          || categoria profesional
     #10#008 = #2#238;         || puesto de trabajo
     #10#009 = afili;          || s.s. empresa
     #10#010 = #2#38;          || fecha de impresion
     #10#011 = #2#31;          || nro. de matricula
     #10#012 = #2#07;          || d.n.i. trabajador
     #10#013 = #2#75;          || s.s. trabajador
     #10#172 = #2#77;          || centro de trabajo
     #10#014 = desdia;         || desde el dia
     #10#015 = mesliq1;        || desde el mes
     #10#016 = hasdia;         || hasta el dia
     #10#017 = mesliq2;        || hasta el mes
     #10#018 = #0#67;          || a¤o confeccion

     |SI #10#18 > 80;
         #10#18 = #10#18 + 1900;
     |SINO;
         #10#18 = #10#18 + 2000;
     |FINSI;

     |SI #2#42 ! "A";|Y #2#42 ! "B";|Y #2#42 ! "E";
         #10#019 = #10#019 + #nomhicca#08;          || total dias liquidacion
     |SINO;
         #10#019 = #10#019 + #nomhicca#11;          || total jornadas (AGRARIA*)
     |FINSI;

     #10#103 = #10#103 + #nomhicca#57;          || ptas. enfermedad
     #10#104 = #10#104 + #nomhicca#58;          || ptas. accidente

     |SI #0#8 = 1;
         #10#105 = desenf;         || del dia enfermedad
         #10#106 = hasenf;         || al dia enfermedad
         #10#107 = desacc;         || del dia accidente
         #10#108 = hasacc;         || al dia accidente
     |SINO;
         #10#105 = 0;
         #10#106 = 0;
         #10#107 = 0;
         #10#108 = 0;
     |FINSI;

     #10#119 = #10#119 + tcotiz;         || base cotizacion
     #10#120 = #10#120 + #nomhicca#38;          || base prorratas
     #10#121 = #10#121 + tbcotiz;        || total bases de cotizacion
     #10#122 = #2#33;          || grupo de cotizacion
     #10#123 = #10#123 + #nomhicca#39;          || base contingencias comunes
     #10#124 = #10#124 + #nomhicca#40;          || base D+P+F
     #10#125 = #10#125 + #nomhicca#41;          || base horas extra estruc.
     #10#126 = #10#126 + #nomhicca#42;          || base horas extra no estruc.
     #10#127 = #nomhicca#61;          || (%) contingencias comunes
     #10#128 = apordfp;        || (%) d+f+p
     #10#129 = aporhe1;        || (%) horas extra estruc.
     #10#130 = aporhe2;        || (%) horas extra no estruc.
     #10#131 = #10#131 + #nomhicca#48;          || ptas. contingencias comunes
     #10#132 = #10#132 + #nomhicca#49;          || ptas. d+f+p
     #10#133 = #10#133 + #nomhicca#50;          || ptas. horas extra estruc.
     #10#134 = #10#134 + #nomhicca#51;          || ptas. horas extra no estruc.
     #10#135 = #nomhicca#13;          || (%) I.R.P.F.
     #10#137 = #10#137 + taporta;        || total aportacion
     #10#139 = #10#139 + tantici;        || total anticipos
     #10#140 = #10#140 + #nomhicca#54;          || en especie
     #10#141 = #10#141 + deducir;        || total a deducir
     #10#143 = diarec;         || dia RECIBI
     #10#144 = mesrec;         || mes RECIBI
     #10#145 = anyrec;         || a¤o RECIBI

     |SI #10#145 > 80;
         #10#145 = #10#145 + 1900;
     |SINO;
         #10#145 = #10#145 + 2000;
     |FINSI;

     #10#150 = "ATRASOS CONVENIO";       || Literal fijo
     #10#151 = #nomhicca#el_67#;                  || (%) IRPF 2
     #10#152 = #nomhicca#el_68#;                  || (%) IRPF 3
     #10#160 = #10#160 + #nomhicca#52;          || anticipos 1
     #10#161 = #10#161 + #nomhicca#53;          || anticipos 2
     #10#196 = #10#196 + #nomhicca#131#;          || anticipos 3
     el_a37 = el_a37 + #nomhicca#146#;            || anticipos 3

     |SI #nomhicca#49 ! 0;
         #10#162 = apord;                                    || (%) desempleo
         #10#163 = aporfp;                                   || (%) form.prof.
         #10#164 = #10#164 + ((#nomhicca#40 % apord) ! EURODB);     || ptas. desempleo
         #10#165 = #10#165 + ((#nomhicca#40 % aporfp) ! EURODB);    || ptas.form.prof.
     |FINSI;
     el_a00 = el_a00 + #nomhicca#45;            || seg.social a cgo.empresa
     el_a31 = el_a31 + #nomhicca#52;            || anticipos 1
     el_a32 = el_a32 + #nomhicca#53;            || anticipos 2
     el_a36 = el_a36 + #nomhicca#131#;            || anticipos 3
     el_a33 = el_a33 + #nomhicca#17;            || cuota IRPF pagas
     el_a34 = el_a34 + #nomhicca#16;            || base IRPF pagas
     el_a35 = el_a35 + #nomhicca#128#;           || anticipos paga extra his
     el_a36 = el_a36 + #nomhicca#131#;           || anticipos 3 his

    |DDEFECTO #103;
    |ABRE #103;
    #103#0 = #nomhicca#0;   || empresa
    #103#1 = #nomhicca#1;   || trabajador
    #103#2 = #nomhicca#2;   || mes
    #103#3 = #nomhicca#3;   || tipo
    |LEE 000#103=;

    #10#169 = #103#28;
    #10#170 = #103#29;
    #10#171 = #103#30;
    #10#197 = #103#45;
    |CIERRA #103;
|FPRC;

|PROCESO CargasHicca_1;       || CARGA LOS CAMPOS SEGUN SU SITUACION
     incluye = 0;
     concep = #nomhicli#04;
     situac = #nomhicli#07;
     descri = #nomhicli#08;
     unidad = #nomhicli#11;      || unidades calculo
     valor  = #nomhicli#10;
     import = unidad * valor;

     |SI situac ! 0;
         lineas = 1;
         camptas = situac + 22;
         camdesc = situac + 61;
         #10camptas = #10camptas + import;
         arteris = descri % 101;

         |SI arteris ! "*";
             |DDEFECTO #100; #100#0 = #2#87; #100#1 = concep; |LEE 000#100=;
             alfa1 = #100#2;     |QBF alfa1;
             |SI alfa1 ! "";
                 #10camdesc = #100#2;
             |SINO;
                 #10camdesc = descri;
             |FINSI;
         |SINO;
             #10camdesc = "";
         |FINSI;

         |SI concep = 101;
             dcal_101 = #nomhicli#05;
             duni_101 = unidad;
             dval_101 = valor;
         |FINSI;

         |SI concep = 102;               ||   unidades concepto 102
             duni_102 = unidad;
         |FINSI;

         |SI concep ] 301; |Y concep [ 305;
             duni_hest = duni_hest + #nomhicli#11;
         |FINSI;

         |SI concep ] 306; |Y concep [ 310;
             duni_hnoest = duni_hnoest + #nomhicli#11;
         |FINSI;
     |FINSI;
     |SI concep ] 201; |Y concep [ 305;
     || vamos a probar aqui
          swProrr = 0;
          nCampo = concep - 181;
          |SI #nomconca#nCampo# = 99;
               swProrr = 1;
          |FINSI;
          nCampo = concep - 88;
          |SI #labtraba#nCampo# = "S";
               swProrr = 1;
          |FINSI;

          |SI swProrr = 1;
               el_a39 = el_a39 + (import ! 2);
          |SINO;
               el_a40 = el_a40 + (import ! 2);
               el_a41 = el_a41 + ((#nomhicli#9 * #nomhicli#10) ! 2);
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargasHicca_2;       || CARGA LOS CAMPOS TOTALES
     |SI #2#42!"A";|Y #2#42!"B";|Y #2#42!"E";|Y #2#42!"C";|Y #2#42!"F";|Y #2#42!"P";|Y #2#42!"I";
         |SI dcal_101 ! "L";
             deci_h = ((#nomhicca#33 * 100) $ 100) / 100;
             #10#021 = #10#021 + (#nomhicca#8-(#nomhicca#31+#nomhicca#32+#nomhicca#34+#nomhicca#65+deci_h+#nomhicca#66)); ||unid.sal.base
         |SINO;
             #10#021 = #10#021 + duni_101;
         |FINSI;
     |SINO;
         #10#021 = #10#021 + duni_101;  || AGRARIA/CITRICOS
     |FINSI;

     |SI #10#021 < 0;
         #10#021 = 0;                                   || si es neg., igual a 0
         #10#022 = 0;
     |SINO;
        #10#022 = #10#23 / #10#21;                     || valor salario base
     |FINSI;

     #10#177 = duni_102;              ||    unidades concepto 102
     |SI #10#022 = 0;
         #10#021 = 0;
     |FINSI;

     |PARA campo = 109; |SI campo [ 115; |HACIENDO campo = campo + 1;
         #10campo = 0;    || vacia los totales, porque acumula en conceptos
     |SIGUE;

     |PARA campo = 24; |SI campo [ 28;  |HACIENDO campo = campo + 1;
             tot_109 = campo;        #10#109 = #10#109 + #10tot_109;  || personales
             tot_110 = campo +  5;   #10#110 = #10#110 + #10tot_110;  || puesto trab.
             tot_111 = campo + 10;   #10#111 = #10#111 + #10tot_111;  || calidad ...
             tot_112 = campo + 15;   #10#112 = #10#112 + #10tot_112;  || vencimientos
             tot_113 = campo + 20;   #10#113 = #10#113 + #10tot_113;  || en especie
             tot_114 = campo + 25;   #10#114 = #10#114 + #10tot_114;  || acc.empres.
             tot_115 = campo + 30;   #10#115 = #10#115 + #10tot_115;  || indemnizac.
     |SIGUE;

     #10#116 = #10#101 + #10#102 + #10#103 + #10#104;    || prestaciones S.S.
     #10#117 = #10#059 + #10#060 + #10#061;              || mejoras voluntarias
     #10#118 = 0;
     |PARA campo = 109; |SI campo [ 117; |HACIENDO campo = campo + 1;
           #10#118 = #10#118 + #10campo;                       || t.devengado parcial
     |SIGUE;

     #10#118 = #10#118 + #10#023;                        || t.devengado + s.base
     #10#020 = #10#118;                                  || importe total
     #10#142 = #10#118 - #10#141;                        || liquido a percibir

     #10#136 = #10#136 + (#nomhicca#14 + #nomhicca#el_69# + #nomhicca#el_70#);    || tot.base IRPF
     #10#138 = #10#138 + (#nomhicca#15 + #nomhicca#el_71# + #nomhicca#el_72#);    || tot.ret. IRPF
     #10#138 = #10#138 + #nomhicca#17;    || tot. ret. IRPF + ret. pagas
     #10#153 = #10#153 + #nomhicca#14;                          || base IRPF 1
     #10#154 = #10#154 + #nomhicca#el_69#;                        || base IRPF 2
     #10#155 = #10#155 + #nomhicca#el_70#;                        || base IRPF 3
     #10#156 = dval_101;                                 || valor orig. s.base
     #10#157 = #10#157 + #nomhicca#15;                          || ret. IRPF 1
     #10#158 = #10#158 + #nomhicca#el_71#;                        || ret. IRPF 2
     #10#159 = #10#159 + #nomhicca#el_72#;                        || ret. IRPF 3

     enCanti = #10#142;    || Conversion de liquidos a euros o pesetas
     |HAZ ConverMoneda2;

     #10#173 = aMonedaRec;
     #10#174 = enCanti;
     #10#190 = #10#190 + duni_hest;
     #10#191 = #10#191 + duni_hnoest;
|FPRC;

|PROCESO CompleHicca_0;       || LEE EMPRESA,TRABAJADOR,CONSTANTE Y CENTRO
     |DDEFECTO #1;
     #1#0 = #nomhicca#0;
     |LEE 020#1=;             || empresa

     |DDEFECTO #2;
     #2#0 = #nomhicca#0;
     #2#1 = #nomhicca#1;
     |LEE 020#2=;             || trabajador

     nCConst = #labtraba#248;
     |HAZ Constante;

     |DDEFECTO #6;
     #6#0 = #2#0;
     #6#1 = #2#77;
     |LEE 020#6=;             || centro
|FPRC;

|PROCESO CompleHicca_1;       || CONSTRUYE LITERALES DATOS EMPRESA
     alfa1 = #6#03;
     alfa2 = #6#04;
     alfa3 = #6#05;

     |SI #0#9 = 1;
         alfa1 = #1#03;
         alfa2 = #1#04;
         alfa3 = #1#05;
     |FINSI;

     |QBF alfa1;
     |QBF alfa2;
     |QBF alfa3;
     domemp = alfa1 + " " + alfa2 + " " + alfa3;  || domicilio empresa

     alfa3 = "(" + (("00" + #6#07) % -102) + (("000" + #6#08) % -103) + ")";
     |SI #0#9 = 1;
         alfa3 = "(" + (("00" + #1#07) % -102) + (("000" + #1#08) % -103) + ")";
     |FINSI;

     pobemp = alfa3 + " " + #6#6;  |QBF pobemp;
     |SI #0#9 = 1;
         pobemp = alfa3 + " " + #1#6;  |QBF pobemp;
     |FINSI;

     afili = #6#10;
     |SI #0#9 = 1;
         afili = #1#13;
     |FINSI;

     |SI #nomhicca#9 = 87;|O #nomhicca#9 = 85;|O #nomhicca#9 = 97;
                          |O #nomhicca#9 = 64;|O #nomhicca#9 = 65;
         |DDEFECTO #35;
         #35#0 = #2#0;
         #35#13 = #2#77;
         |SI #nomhicca#9 = 85;|O #nomhicca#9 = 97;
             #35#1 = 87;
         |SINO;
             |SI #nomhicca#9 = 65;
                 #35#1 = 64;
             |SINO;
                 #35#1 = #nomhicca#9;
             |FINSI;
         |FINSI;
         |LEE 000#35=;
         afili = #35#10;
     |FINSI;
|FPRC;

|PROCESO CompleHicca_2;        || CONSTRUYE PERIODO DE LIQUIDACION
     mesnum = #nomhicca#2;
     |SI #0#8 = 2;
          mesnum = #0#5;
     |FINSI;

     anytra = #0#67;
     |HAZ Lib0;             || saca ultimo dia natural del mes desde !!!

     |SI #0#8 = 1;
         mesnum = #nomhicca#2;
         |HAZ Lib0;
         mesliq1 = mesalf;   || solo la primera nomina que entre
     |FINSI;

     swSigueReci = 0;
     |SI #0#8 = 2;
          swSigueReci = 1;
     |FINSI;

     |SI swSigueReci = 1;
         |SI #nomhicca#0 ! nEmpAnt; |O #nomhicca#1 ! nTraAnt;
             mesnum = #nomhicca#2;
             anytra = #0#67;
             |HAZ Lib0;
             mesliq1 = mesalf;   || solo la primera nomina que entre
         |FINSI;                 || del mismo trabajador, para poner el
     |FINSI;                     || mes desde el de la primera

     mesliq2 = mesalf;

     |SI #0#8 = 2;           || si tiene que refundir
          mesnum = #nomhicca#2;
          anytra = #0#67;
          |HAZ Lib0;         || saca ultimo dia natural del mes hasta !!!
          mesliq2 = mesalf;
     |FINSI;

     fectra = #nomhicca#4;      || desglosa fecha de alta
     |HAZ Lib1;
     diaalta = diatra;
     mesalta = mestra;
     |SI #0#8 = 2;
         |SI mesalta ] #0#5; |Y anytra = #0#67;  || si es alta este mes
             desdia = diaalta;
             mesnum = mesalta;
             anytra = #nomhicca#2;
             |HAZ Lib0;
             mesliq1 = mesalf;
         |SINO;
             desdia = 1;
         |FINSI;
     |SINO;
         |SI mesalta = #nomhicca#2; |Y anytra = #0#67;  || si es alta este mes
             desdia = diaalta;
         |SINO;
             desdia = 1;
         |FINSI;
     |FINSI;

     fectra = #nomhicca#5;      || desglosa fecha de baja
     |HAZ Lib1;
     diabaja = diatra;
     mesbaja = mestra;
     anybaja = anytra;
     |SI #0#8 = 2;
          |SI mesbaja [ #0#7; |Y mesbaja ! 0; |Y anytra = #0#67; |Y diabaja ! topemes; || si es baja este mes
               swbaja = 1;      || switch para saber si es baja en 'CargasHicca_1'
               |SI #nomhicca#2 > mesbaja; |Y #nomhicca#66 ] anybaja;
                   mesnum = #nomhicca#2;
                   |HAZ Lib0;
                   hasdia = topemes;
                   mesliq2 = mesalf;
                   anytra = #0#67;
               |SINO;
                   hasdia = diabaja;
                   mesnum = mesbaja;
                   anytra = #0#67;
                   |HAZ Lib0;
                   mesliq2 = mesalf;
               |FINSI;
          |SINO;
               mesnum = #nomhicca#2;
               anytra = #0#67;
               |HAZ Lib0;
               hasdia = topemes;
          |FINSI;
     |SINO;
          |SI mesbaja = #nomhicca#2; |Y anytra = #0#67;  || si es baja este mes
              swbaja = 1;      || switch para saber si es baja en 'CargasHicca_1'
              hasdia = diabaja;
          |SINO;
              hasdia = topemes;
          |FINSI;
     |FINSI;

     nEmpAnt = #nomhicca#0;
     nTraAnt = #nomhicca#1;
|FPRC;

|PROCESO CompleHicca_3;        || CARGA LOS PERIODOS DE LIQ. DE ENFERM. Y ACCTE.
     || construye periodo de liquidacion de enferm. y accte.
     || pasa periodos de IT tal cual estan en el nomcalca

     desenf = 0;  hasenf = 0;
     desacc = 0;  hasacc = 0;
     swtenf = 0;  swtacc = 0;

     |SI #nomhicca#27="E"; |O #nomhicca#27="M";
         desenf=#nomhicca#19; hasenf=#nomhicca#23; swtenf=1;
     |FINSI;

     |SI #nomhicca#28="E"; |O #nomhicca#28="M";
         |SI swtenf = 0;
             desenf = #nomhicca#20;
             hasenf = #nomhicca#24;
             swtenf = 1;
         |FINSI;
     |FINSI;

     |SI #nomhicca#29 = "E"; |O #nomhicca#29 = "M";
         |SI swtenf = 0;
             desenf = #nomhicca#21;
             hasenf = #nomhicca#25;
             swtenf = 1;
         |FINSI;
     |FINSI;

     |SI #nomhicca#30 = "E"; |O #nomhicca#30 = "M";
         |SI swtenf = 0;
             desenf = #nomhicca#22;
             hasenf = #nomhicca#26;
             swtenf = 1;
         |FINSI;
     |FINSI;

     |SI #nomhicca#27 = "A";
         desacc = #nomhicca#19;
         hasacc = #nomhicca#23;
         swtacc = 1;
     |FINSI;

     |SI #nomhicca#28 = "A"; |Y swtacc = 0;
         desacc = #nomhicca#20;
         hasacc = #nomhicca#24;
         swtacc = 1;
     |FINSI;

     |SI #nomhicca#29 = "A"; |Y swtacc = 0;
         desacc = #nomhicca#21;
         hasacc = #nomhicca#25;
         swtacc = 1;
     |FINSI;

     |SI #nomhicca#30 = "A"; |Y swtacc = 0;
         desacc = #nomhicca#22;
         hasacc = #nomhicca#26;
         swtacc = 1;
     |FINSI;

     |SI swtacc = 1;|Y #36#19 = "S";
         desacc = desacc - 1;
         |SI desacc < 0;  desacc = 1;  |FINSI;  || por el rollo de las mutuas
     |FINSI;

     |SI desenf = 0;  |Y swtenf = 1;
         desenf = 1;
     |FINSI;

     |SI hasenf = 0; |Y swtenf = 1;
         hasenf = #nomhicca#7;
     |FINSI;

     |SI desacc = 0; |Y swtacc = 1;
         desacc = 1;
     |FINSI;

     |SI hasacc = 0; |Y swtacc = 1;
         hasacc = #nomhicca#7;
     |FINSI;

     |PARA para1 = 19; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
          para2 = para1 + 159;
          |SI para1 [ 26;
               #10para2 = #nomhicca#para1#;
          |SINO;
               |SI #nomhicca#para1# = "E"; #10para2 = "Enfermedad"; |FINSI;
               |SI #nomhicca#para1# = "A"; #10para2 = "Accidente";  |FINSI;
               |SI #nomhicca#para1# = "H"; #10para2 = "Huelga";     |FINSI;
               |SI #nomhicca#para1# = "F"; #10para2 = "Absentismo"; |FINSI;
               |SI #nomhicca#para1# = "f"; #10para2 = "Absentismo"; |FINSI;
               |SI #nomhicca#para1# = "M"; #10para2 = "Maternidad"; |FINSI;
               |SI #nomhicca#para1# = "V"; #10para2 = "Vacaciones"; |FINSI;
               |SI #nomhicca#para1# = "D"; #10para2 = "Desempleo";  |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO CompleHicca_4;        || HALLA TOTALES VARIOS
     tcotiz  = #nomhicca#37 + #nomhicca#62;
     tbcotiz = tcotiz + #nomhicca#38;         || total bases de cotizacion
     apordfp = 0;
     aporfp  = 0;
     apord   = 0;
     aporhe1 = 0;
     aporhe2 = 0;

     |SI #nomhicca#40 ! 0;|Y #2#45 ! "087";|Y #2#45 ! "097";|Y #2#45 ! "085";
         apordfp = #3#13 + #3#15 + #3#17 + #3#19;   ||(%) d+f+p
         aporfp  = #3#17;                      ||(%) fp
         apord   = apordfp - aporfp;            ||(%) d
     |FINSI;

     |SI #nomhicca#41 ! 0;
         aporhe1 = #3#09;                || (%) horas extra estruc.
         |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
             aporhe1 = aporhe1 + #3#13+#3#15+#3#17+#3#19;    || aprendices
         |FINSI;
     |FINSI;

     |SI #nomhicca#42 ! 0;
         aporhe2 = #3#11;                || (%)horas extra no estruc.
         |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
             aporhe2 = aporhe2 + #3#13+#3#15+#3#17+#3#19;    || aprendices
         |FINSI;
     |FINSI;

     taporta = #nomhicca#48 + #nomhicca#49 + #nomhicca#50 + #nomhicca#51;           || total aportacion
     taporta = taporta + #nomhicca#el_165#;                                       || total aportacion
     tantici = #nomhicca#52 + #nomhicca#53 + #nomhicca#131#;                   || total anticipos
     deducir = taporta + #nomhicca#el_75# + tantici + #nomhicca#54;     || total a deducir
     deducir = deducir + #nomhicca#17;      || pagas juntas en parametrizados
|FPRC;

|PROCESO CompleHicca_5;        || CONSTRUYE FECHA LITERAL DEL RECIBI
     diabaja = 0;
     |SI #nomhicca#5 ! "          "; |Y #nomhicca#5 ! "..........";
         fectra = #nomhicca#5;
         |HAZ Lib1;
         |SI #0#5 = mestra; |Y #0#4 = anytra;
             diabaja = diatra;
         |FINSI;
     |FINSI;

     fectra = #0#6;
     |HAZ Lib1;
     diarec = diatra;
     |SI diabaja ! 0;
         diarec = diabaja;
     |FINSI;

     anyrec = anytra;
     mesnum = mestra;
     |HAZ Lib0;
     mesrec = mesalf;
|FPRC;

|PROCESO AcumHicca;
     nValor = nValor + #nomhicca#nCam#;
|FPRC;

|DEFBUCLE AcumHicca;
     #nomhicca#1;
     ;
     ante_emp, ante_tra, #0#4, #0#5, #0#10;
     ante_emp, ante_tra, #0#4, #0#6, #0#68;
     ;
     NULL, AcumHicca;
|FIN;

|PROCESO ValorFicHicca;
     aAlfa = aValor % 203;
     nCam = aAlfa;
     aAlfa = aValor % 101;
     |SI aAlfa = "1";
          aAlfa = "|NC";
          aCampos = #labtraba#aAlfa#;
          |SI nCam [ 253;
               aValor = #labtraba#nCam#;
          |FINSI;
          |SI nCam = 254;
               #40#0 = #2#7;
               |LEE 000#40=;
               |SI FSalida ! 0; |DDEFECTO #40; |FINSI;
               aValor = #40#1;
          |FINSI;
          |SI nCam = 255;
               #33#0 = #labtraba#62;
               |LEE 000#33=;
               |SI FSalida ! 0; |DDEFECTO #33; |FINSI;
               aValor = #33#1;
          |FINSI;
          |SI nCam = 256;
               #34#0 = #labtraba#62;
               #34#0 = #labtraba#63;
               |LEE 000#34=;
               |SI FSalida ! 0; |DDEFECTO #34; |FINSI;
               aValor = #34#2
          |FINSI;
     |SINO;
          |SALVA_FICHA #nomhicca;
          |SI #0#8 = 1;
               #nomhicca#0 = ante_emp;
               #nomhicca#1 = ante_tra;
               |LEE 000#nomhicca.=
               aValor = #nomhicca#nCam#;
          |FINSI;
          |SI #0#8 = 2;
               nValor = 0;
               |BUCLE AcumHicca;
               aValor = nValor;
          |FINSI;
          |REPON_FICHA #nomhicca;
     |FINSI;
|FPRC;

|PROCESO LeeCamposHiccaNormal;
     nCampo = enColumnas;
     nCampo1 = nCampo + 100;
     enColumnas = enColumnas + 1;

     punt_campo = punt_campo + 1;
     punt_subra = punt_subra + 1;
     punt_titul = punt_titul + 1;

     |PARA punt_refer=3; |SI punt_refer [ 14;
     |HACIENDO punt_refer=punt_refer+1;
          punt_signo=punt_refer+12;

          calcu = #31punt_refer % 103;
          laeme = calcu % 101;
          refer = calcu % -102;

          |SI calcu ! " 00";
               multiplica = 1;
               |SI #31punt_signo = "+"; multiplica=1; |SINO; multiplica=-1; |FINSI;

               nNume = #31punt_refer;
               |SI nNume > 1000;
                    aValor = #31punt_refer;
                    |HAZ ValorFicHicca;
                    |SI #31punt_signo = " ";
                         #60nCampo = 99999999;      || Carga 99999999 para identificarlo
                         #60nCampo1 = aValor;
                    |SINO;
                         nNume = aValor;
                         #60nCampo = #60nCampo + (nNume * multiplica);
                    |FINSI;
               |SINO;
                    |SI laeme = "M";
                         memoria = refer;  memoria = memoria - 1;
                         |SI #31punt_signo = " ";
                              #60nCampo = 99999999;      || Carga 99999999 para identificarlo
                              #60nCampo1 = #60memoria;
                         |SINO;
                              #60nCampo = #60nCampo + (#60memoria * multiplica);
                         |FINSI;
                    |SINO;
                         |HAZ Recoge;
                         |SI #31punt_signo = " ";
                              #60nCampo = 99999999;      || Carga 99999999 para identificarlo
                              #60nCampo1 = recogido;
                         |SINO;
                              #60nCampo = #60nCampo + (recogido * multiplica);
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;

     |SI #31#27 ! " ";
          |SI #31#27 = "+"; #60nCampo = #60nCampo + #31#28; |FINSI;
          |SI #31#27 = "-"; #60nCampo = #60nCampo - #31#28; |FINSI;
          |SI #31#27 = "*"; #60nCampo = #60nCampo * #31#28; |FINSI;
          |SI #31#27 = "/"; #60nCampo = #60nCampo / #31#28; |FINSI;
     |FINSI;

     #32punt_campo = #60nCampo;
     #32punt_subra = "=============";
     #32punt_titul = #31#2;
|FPRC;

|PROCESO LeeCamposHiccaExcel;
     nCampo = enColumnas;
     nCampo1 = nCampo + 100;
     enColumnas = enColumnas + 1;
     |PARA punt_refer=3; |SI punt_refer[14; |HACIENDO punt_refer=punt_refer+1; punt_signo=punt_refer+12;
          calcu = #31punt_refer % 103;
          laeme = calcu % 101;
          refer = calcu % -102;

          |SI calcu ! " 00";
               multiplica = 1;
               |SI #31punt_signo = "+"; multiplica=1; |SINO; multiplica=-1; |FINSI;
               nNume = #31punt_refer;
               |SI nNume > 1000;
                    aValor = #31punt_refer;
                    |HAZ ValorFicHicca;
                    |SI #31punt_signo = " ";
                         #60nCampo = 99999999;      || Carga 99999999 para identificarlo
                         #60nCampo1 = aValor;
                    |SINO;
                         nNume = aValor;
                         #60nCampo = #60nCampo + (nNume * multiplica);
                    |FINSI;
               |SINO;
                    |SI laeme = "M";
                         memoria = refer;  memoria = memoria - 1;
                         |SI #31punt_signo = " ";
                              #60nCampo = 99999999;      || Carga 99999999 para identificarlo
                              #60nCampo1 = #60memoria;
                         |SINO;
                              #60nCampo = #60nCampo + (#60memoria * multiplica);
                         |FINSI;
                    |SINO;
                         |HAZ Recoge;
                         |SI #31punt_signo = " ";
                              #60nCampo = 99999999;      || Carga 99999999 para identificarlo
                              #60nCampo1 = recogido;
                         |SINO;
                              #60nCampo = #60nCampo + (recogido * multiplica);
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI #31#27 ! " ";
          |SI #31#27 = "+"; #60nCampo = #60nCampo + #31#28; |FINSI;
          |SI #31#27 = "-"; #60nCampo = #60nCampo - #31#28; |FINSI;
          |SI #31#27 = "*"; #60nCampo = #60nCampo * #31#28; |FINSI;
          |SI #31#27 = "/"; #60nCampo = #60nCampo / #31#28; |FINSI;
     |FINSI;
     #70nCampo = "=============";
     #70nCampo1 = #31#2;
|FPRC;

|PROCESO ParametrizaHicca;
     punt_campo = 5;
     punt_subra = 125;
     punt_titul = 155;
     |HAZ Limpia;

     |DDEFECTO #60;
     |DDEFECTO #70;

     #32#0   = #10#1;       || codigo empresa
     #32#1   = #10#3;       || nombre empresa
     #32#2   = #10#2;       || codigo trabajador
     #32#3   = #10#6;       || nombre trabajador
     #32#217 = #10#12;      || dni
     #32#218 = #10#13;      || nafss
     #32#219 = #10#7;       || categoria
     #32#220 = #10#10;      || antiguedad
     #32#4 = "--";          || englobado
     |SI #0#8 = 1;
         |HAZ Mes;
         #32#4 = mesnum;  || mes
     |FINSI;
     #32#5 = #2#47;       || horas
     |ABRE #30;
     #30#0 = #0#7;
     |LEE 021#30=;
     |SI FSalida = 0;
          #32#216 = #30#2;      || titulo informe
          enColumnas = 0;
          |SI swExcel = 1;
               |BUCLELIN 2LeeCamposHiccaExcel#30;
          |SINO;
               |BUCLELIN 2LeeCamposHiccaNormal#30;
          |FINSI;
     |FINSI;
     |CIERRA #30;
|FPRC;

|PROCESO CompleHicca_6;    || carga e imprime
     |SI #0#8 = 2;
          #2#00 = guarda_emp;
          #2#77 = guarda_cen;   || el defbucle al leer otro calculo lee
          #2#62 = guarda_are;   ||/automaticamente otro trabajador,
          #2#63 = guarda_sec;   ||/por eso se guarda las claves
     |FINSI;
     |HAZ ParametrizaHicca;
     |SI sw_ruptura = 0;
          |HAZ Cabecera_Emp;

          ant_empre = #2#0;
          ant_centr = #2#77;
          ant_area  = #2#62;
          ant_secc  = #2#63;
          sw_ruptura = 1;
     |FINSI;
     |SI ant_empre ! #2#0;              || ruptura por empresa
          |HAZ Linea4;
          |HAZ Linea3;
          |HAZ Linea2;
          |HAZ Linea1;

          |HAZ Cabecera_Emp;
     |SINO;
          |SI ant_centr ! #2#77;|Y #30#3 = "S";         || ruptura por centro
               |HAZ Linea4;
               |HAZ Linea3;
               |HAZ Linea2;
          |SINO;
               |SI ant_area ! #2#62;|Y #30#4 = "S";      || ruptura por area
                    |HAZ Linea4;
                    |HAZ Linea3;
               |SINO;
                    |SI ant_secc ! #2#63;|Y #30#5 = "S";  || ruptura por seccion
                         |HAZ Linea4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     linea = 0;
     |SI #0#11 = "D";
         |HAZ PrintLinea;
     |FINSI;

     |HAZ Totales;

     |DDEFECTO #10;
     el_a00 = 0;
     el_a31 = 0;
     el_a32 = 0;
     el_a33 = 0;
     el_a34 = 0;
     el_a35 = 0;
     el_a37 = 0;

     el_a39 = 0;
     el_a40 = 0;
     el_a41 = 0;
|FPRC;

|PROCESO EquivHicca;
     el_66 = 105;
     el_67 = 106;
     el_68 = 107;
     el_69 = 108;
     el_70 = 109;
     el_71 = 110;
     el_72 = 111;
     el_73 = 112;
     el_74 = 113;
     el_75 = 114;
     el_76 = 117;
     el_77 = 118;
     el_165 = 207;
|FPRC;

|PROCESO ProcesoHicca;
     |SI sw_control = 0;
         |HAZ Control;
         sw_control = 1;
     |FINSI;

     |SI sw_equiv = 0;
         |HAZ EquivHicca;
         sw_equiv = 1;
     |FINSI;

     |SI ante_tra = 0;
         ante_emp = #nomhicca#0;
         ante_tra = #nomhicca#1;
     |FINSI;

     |SI #0#8 = 2;
         |SI ante_tra ! #nomhicca#1; |O ante_emp ! #nomhicca#0;
             |SI lineas = 1;
                  nro_copias = #36#34; || carga numero de copias de recibo (ctrl. aplicacion)
                  |PARA nume1 = 1; |SI nume1 [ nro_copias; |HACIENDO nume1 = nume1 + 1;
                        |HAZ CompleHicca_6;
                  |SIGUE;
                  |DDEFECTO #10;
               |FINSI;
          |FINSI;
     |FINSI;

     lineas = 0;     || para saber si los conceptos leidos son buenos
     swbaja = 0;
     |HAZ CompleHicca_0;   || lee empresa, trabajador y constante

     |SI #0#66 < #2#77;|O #0#65 > #2#77;     || seleccion centros
          |ACABA;
     |FINSI;

     |HAZ CompleHicca_1;
     |HAZ CompleHicca_2;
     |HAZ CompleHicca_3;
     |HAZ CompleHicca_4;
     |HAZ CompleHicca_5;   || construye fecha firma

     |BUCLELIN 0CargasHicca_1#nomhicca;   || carga campos lineas calculos

     ante_emp = #nomhicca#0;
     ante_tra = #nomhicca#1;
     |SI lineas = 1;
          seleccio = 1;    || para saber si se ha leido algo
          |HAZ CargasHicca_0;       || carga campos cabecera calculos
          |HAZ CargasHicca_2;       || carga campos totales
          |HAZ ImpCrystal;
          |SI #0#8 = 1;
               nro_copias = #36#34; || carga numero de copias de recibo (ctrl. aplicacion)
               |PARA nume1 = 1; |SI nume1 [ nro_copias; |HACIENDO nume1 = nume1 + 1;
                     |HAZ CompleHicca_6;
               |SIGUE;
               |DDEFECTO #10;
          |SINO;
               guarda_emp = #2#0;    || guarda
               guarda_cen = #2#77;   || las guarda porque en
               guarda_are = #2#62;
               guarda_sec = #2#63;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrdenaHicca;
    |DDEFECTO #1;
    #1#0 = #nomhicca#0;
    |LEE 000#1=;

    |DDEFECTO #2;
    #2#0 = #nomhicca#0;
    #2#1 = #nomhicca#1;
    |LEE 000#2=;

    |DDEFECTO #102;
    #102#0 = #2#87;
    |LEE 000#102=;

    |HAZ CtaCotizacion;
    #0#64 = cta_co;
|FPRC;

|DEFBUCLE nomhicca_1;      || 'SNN'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#77, #2#1;
|FIN;

|DEFBUCLE nomhicca_2;      || 'SSN'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#77, #2#62, #2#1;
|FIN;

|DEFBUCLE nomhicca_3;      || 'SSS'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#77, #2#62, #2#63, #2#1;
|FIN;

|DEFBUCLE nomhicca_4;      || 'NSS'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#62, #2#63, #2#1;
|FIN;

|DEFBUCLE nomhicca_5;      || 'NNS'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#63, #2#1;
|FIN;

|DEFBUCLE nomhicca_6;      || 'NNN'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#1;
|FIN;

|DEFBUCLE nomhicca_7;      || 'NSN'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#62, #2#1;
|FIN;

|DEFBUCLE nomhicca_8;      || 'SNS'
     #nomhicca#1;
     ;
     #0#0, #0#2, #0#4, #0#5, #0#10;
     #0#1, #0#3, #0#4, #0#6, #0#68;
     e;
     NULL, OrdenaHicca, NULL, NULL, NULL, ProcesoHicca;
     #2#0, #2#77, #2#63, #2#1;
|FIN;

|PROCESO Final;
     |SI seleccio ! 0;
          |SI swExcel = 1;
               |HAZ Excel_Fin;
          |SINO;
               |FINIMP;
          |FINSI;
     |FINSI;
     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #6;
     |CIERRA #100;
     |CIERRA #40;
     |CIERRA #33;
     |CIERRA #34;
|FPRC;

|PROCESO DesdeHistorico;
     |SI #0#9 = 00;
          swExcel = 0;
     |SINO;
          swExcel = 1;
     |FINSI;
     enInforme = #0#7;
     dmes = #0#5;     hmes = #0#6;   peri = #0#4;

     |SI swExcel = 0;
          |IMPRE 0;
     |SINO;
          |HAZ Excel_Inicio;
          FSalida = 0;
     |FINSI;

     |SI FSalida = 0;
          |ABRE #40;
          |ABRE #33;
          |ABRE #34;
          |ABRE #1;
          |ABRE #2;
          |ABRE #3;
          |ABRE #6;
          |ABRE #100;

          seleccio = 0;
          |SI swExcel = 0;
               |INFOR "nomypara";
          |FINSI;

          ||HAZ Excel_Inicio;
          |HAZ LeeTotales;
          |SI rupturas = "SNN";  |BUCLE nomhicca_1;  |FINSI;
          |SI rupturas = "SSN";  |BUCLE nomhicca_2;  |FINSI;
          |SI rupturas = "SSS";  |BUCLE nomhicca_3;  |FINSI;
          |SI rupturas = "NSS";  |BUCLE nomhicca_4;  |FINSI;
          |SI rupturas = "NNS";  |BUCLE nomhicca_5;  |FINSI;
          |SI rupturas = "NNN";  |BUCLE nomhicca_6;  |FINSI;
          |SI rupturas = "NSN";  |BUCLE nomhicca_7;  |FINSI;
          |SI rupturas = "SNS";  |BUCLE nomhicca_8;  |FINSI;

          |SI seleccio = 0;
              |MENAV "    Seleccion vacia ...";

              |HAZ Final;
              |ACABA;
          |FINSI;

          |SI #0#8 = 2;
              |SI lineas = 1;
                   |HAZ CompleHicca_6;
              |FINSI;
          |FINSI;

          |HAZ Linea4;
          |HAZ Linea3;
          |HAZ Linea2;
          |HAZ Linea1;

          |HAZ Final;
     |FINSI;
|FPRC;

|| ------------------------ El truco del almendruco -------------------------

|PROCESO nomcalcaTra;
     |PARA nCampo = 0;  |SI nCampo [ 65;  |HACIENDO nCampo = nCampo + 1;
           #nomhicca#nCampo# = #trabajo@#nCampo#
     |SIGUE;

     |PARA nCampo = 66;  |SI nCampo [ 75;  |HACIENDO nCampo = nCampo + 1;
         nCamHis = nCampo + 39;
         #nomhicca#nCamHis# = #trabajo@#nCampo#
     |SIGUE;

     |PARA nCampo = 76;  |SI nCampo [ 78;  |HACIENDO nCampo = nCampo + 1;
         nCamHis = nCampo + 41;
         #nomhicca#nCamHis# = #trabajo@#nCampo#
     |SIGUE;

     |PARA nCampo = 79;  |SI nCampo [ 192;  |HACIENDO nCampo = nCampo + 1;
         nCamHis = nCampo + 42;
         #nomhicca#nCamHis# = #trabajo@#nCampo#
     |SIGUE;

     #nomhicca#66 = #nogue003#4;

     |GRABA 020#nomhicca.n;
     |LIBERA #nomhicca;
|FPRC;

|DEFBUCLE nomcalcaTra;
     #trabajo@#1004;
     ;
     #0#0, #0#2, #0#5, #0#10;
     #0#1, #0#3, #0#6, #0#68;
     ;
     NULL, nomcalcaTra;
|FIN;

|PROCESO nomcalliTra;
     |PARA nCampo = 0;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
           #nomhicli#nCampo# = #trabajo@#nCampo#
     |SIGUE;

     #nomhicli#12 = #nogue003#4;

     |GRABA 020#nomhicli.n;
     |LIBERA #nomhicli;
|FPRC;

|DEFBUCLE nomcalliTra;
     #trabajo@#1005;
     ;
     #0#0, #0#2, #0#5, #0#10, 000;
     #0#1, #0#3, #0#6, #0#68, 999;
     ;
     NULL, nomcalliTra;
|FIN;

|PROCESO nomcalacTra;
     |PARA nCampo = 0;  |SI nCampo [ 65;  |HACIENDO nCampo = nCampo + 1;
           #nomhicca#nCampo# = #trabajo@#nCampo#
     |SIGUE;

     |PARA nCampo = 66;  |SI nCampo [ 75;  |HACIENDO nCampo = nCampo + 1;
         nCamHis = nCampo + 39;
         #nomhicca#nCamHis# = #trabajo@#nCampo#
     |SIGUE;

     |PARA nCampo = 76;  |SI nCampo [ 78;  |HACIENDO nCampo = nCampo + 1;
         nCamHis = nCampo + 41;
         #nomhicca#nCamHis# = #trabajo@#nCampo#
     |SIGUE;

     |PARA nCampo = 79;  |SI nCampo [ 190;  |HACIENDO nCampo = nCampo + 1;
         nCamHis = nCampo + 42;
         #nomhicca#nCamHis# = #trabajo@#nCampo#
     |SIGUE;

     #nomhicca#66 = #nogue003#4;

     |GRABA 020#nomhicca.n;
     |LIBERA #nomhicca;
|FPRC;

|DEFBUCLE nomcalacTra;
     #trabajo@#1004;
     ;
     #0#0, #0#2, #0#5, #0#10;
     #0#1, #0#3, #0#6, #0#68;
     ;
     NULL, nomcalacTra;
|FIN;

|PROCESO nomcalalTra;
     |PARA nCampo = 0;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
           #nomhicli#nCampo# = #trabajo@#nCampo#
     |SIGUE;

     #nomhicli#12 = #nogue003#4;

     |GRABA 020#nomhicli.n;
     |LIBERA #nomhicli;
|FPRC;

|DEFBUCLE nomcalalTra;
     #trabajo@#1005;
     ;
     #0#0, #0#2, #0#5, #0#10, 000;
     #0#1, #0#3, #0#6, #0#68, 999;
     ;
     NULL, nomcalalTra;
|FIN;

|PROCESO DesdeMensual;
     aFicTmp = "nomhicca" + Usuario;
     |NOME_DAT #nomhicca#aFicTmp#;
     |ABRE #nomhicca;  |CIERRA #nomhicca;  |DELINDEX #nomhicca;

     aFicTmp = "nomhicli" + Usuario;
     |NOME_DAT #nomhicli#aFicTmp#;
     |ABRE #nomhicli;  |CIERRA #nomhicli;  |DELINDEX #nomhicli;

     |ABRE #nomhicca;
     |ABRE #nomhicli;

     |DDEF aDef;
     aMas = aDef + "nomcalca.mas";
     |CARGA_DEF aMas, trabajo@;
     |BUCLE nomcalcaTra;
     |DESCARGA_DEF #trabajo@;

     aMas = aDef + "nomcalli.mas";
     |CARGA_DEF aMas, trabajo@;
     |BUCLE nomcalliTra;
     |DESCARGA_DEF #trabajo@;

     aMas = aDef + "nomcalac.mas";
     |CARGA_DEF aMas, trabajo@;
     |BUCLE nomcalacTra;
     |DESCARGA_DEF #trabajo@;

     aMas = aDef + "nomcalal.mas";
     |CARGA_DEF aMas, trabajo@;
     |BUCLE nomcalalTra;
     |DESCARGA_DEF #trabajo@;

     |CIERRA #nomhicca;
     |CIERRA #nomhicli;

     |HAZ DesdeHistorico;

     aFicTmp = "nomhicca" + Usuario;
     |NOME_DAT #nomhicca#aFicTmp#;
     |ABRE #nomhicca;  |CIERRA #nomhicca;  |DELINDEX #nomhicca;

     aFicTmp = "nomhicli" + Usuario;
     |NOME_DAT #nomhicli#aFicTmp#;
     |ABRE #nomhicli;  |CIERRA #nomhicli;  |DELINDEX #nomhicli;
|FPRC;
