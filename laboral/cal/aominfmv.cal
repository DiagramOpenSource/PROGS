|FICHEROS;
    aominfmv #0;   || def de impresion (graba)
    aomentra #1;   || fichero de entrada de horas
    aomhoras #2;   || fichero de tipos de hora
    labtraba #3;   || fichero de trabajadores
    aomtemp2 #4;   || def trabajo para ordenacion
|FIN;

|VARIABLES;
     seleccio = 0;
     igual = 0;
     nume1 = 0;
     campo = 0;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     espacios = "                     "; || para construir clave
     fecha = "";
     empre = "";
     traba = "";
     obras = "";
     horas = "";

     dfecha = "FECHAS";
     dempre = "EMPRESAS";
     dtraba = "TRABAJADORES";   || para construir literal de ordenacion
     dobras = "OBRAS";
     dhoras = "TIPOS HORA";
     z = "/";
    &descri = "";

    &swlin = 0;    || condicion para la impresion de totales

    &fecha1 = 0;
    &fecha2 = 0;
    &fecha3 = 0;
    &fecha4 = 0;
    &empre1 = 0;
    &empre2 = 0;
    &empre3 = 0;
    &empre4 = 0;
    &traba1 = 0;   || acumuladores de totales parciales
    &traba2 = 0;
    &traba3 = 0;
    &traba4 = 0;
    &obras1 = 0;
    &obras2 = 0;
    &obras3 = 0;
    &obras4 = 0;
    &sobra1 = 0;
    &sobra2 = 0;
    &sobra3 = 0;
    &sobra4 = 0;
    &horas1 = 0;
    &horas2 = 0;
    &horas3 = 0;
    &horas4 = 0;

    &total1 = 0;
    &total2 = 0;    || totales generales
    &total3 = 0;
    &total4 = 0;

    &afecha = "";
    &aempre = 0;
    &atraba = 0;    || valores anteriores a las rupturas
    &aobras = 0;
    &asubob = 0;
    &ahoras = 0;
|FIN;

|PROGRAMA;
|CLS;
|CABEZA "INF.MOVIMIENTOS";
|PINPA #0#0;
|DDEFECTO #0;
|ABRE #0;
|LEE 101#0p;
|SI FSalida ! 0;    |GRABA 020#0b; |FINSI;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0;
    |GRABA 020#0a;
|FINSI;
|LIBERA #0;
|CIERRA #0;
|FPRO;

************************************************************************
   RUTINAS DE GESTION DE PANTALLA
************************************************************************

|PROCESO norepito; |TIPO 0;  || CHEQUEA LA REPETICION DE ORDENACION
|SI #0Campo ! 0;
        igual = 0;
        nume1 = Campo - 1;
    |PARA campo = 11; |SI campo [ nume1; |HACIENDO campo = campo + 1;
        |SI #0campo = #0Campo;
                igual = 1;
        |FINSI;
    |SIGUE;
    |SI igual = 1;
        |MENAV "    ATENCION !!! Ordenacion ya entrada ...";
        |ERROR;
    |FINSI;
|FINSI;
|FPRC;
************************************************************************
   RUTINAS DE LECTURA E IMPRESION
************************************************************************

|PROCESO abucle4;   || FINAL DE IMPRESO
    afecha = #1#0;
    aempre = #1#2;
    atraba = #1#3;
    asubob = #1#7;
    aobras = #1#1;
    ahoras = #1#4;
|SI #0#16 = "S";  swlin = 1;  |PRINT;  |FINSI;
|SI #0#18 = "S";  swlin = 3;  |PRINT;  |FINSI;
|SI #0#23 = "S";  swlin = 6;  |PRINT;  |FINSI;
|SI #0#19 = "S";  swlin = 4;  |PRINT;  |FINSI;
|SI #0#20 = "S";  swlin = 5;  |PRINT;  |FINSI;
|SI #0#17 = "S";  swlin = 2;  |PRINT;  |FINSI;
|FPRC;

|PROCESO abucle3; || CONTROLA RUPTURAS,ACUMULA,LEE HORA Y TRABAJADOR E IMPRIME
|DDEFECTO #2;
    #2#0 = #1#4;
|LEE 000#2=;       || lee el tipo de hora

|DDEFECTO #3;
    #3#0 = #1#2;
    #3#1 = #1#3;
|LEE 000#3=;       || lee el trabajador

|SI afecha = "xxxxxxxx";  afecha = #1#0;  |FINSI;
|SI aempre = -1;          aempre = #1#2;  |FINSI;
|SI atraba = -1;          atraba = #1#3;  |FINSI;
|SI aobras = -1;          aobras = #1#1;  |FINSI;
|SI asubob = -1;          asubob = #1#7;  |FINSI;
|SI ahoras = -1;          ahoras = #1#4;  |FINSI;

|SI afecha ! #1#0; |Y #0#16 = "S";
        swlin = 1;
    |PRINT;
        afecha = #1#0;  fecha1 = 0;  fecha2 = 0;  fecha3 = 0;  fecha4 = 0;
|FINSI;
|SI aempre ! #1#2; |Y #0#17 = "S";
        swlin = 2;
    |PRINT;
        atraba = -1;
        aempre = #1#2;  empre1 = 0;  empre2 = 0;  empre3 = 0;  empre4 = 0;
|FINSI;
|SI atraba ! #1#3; |Y #0#18 = "S";
        swlin = 3;
    |PRINT;
        atraba = #1#3;  traba1 = 0;  traba2 = 0;  traba3 = 0;  traba4 = 0;
|FINSI;
|SI asubob ! #1#7; |Y #0#23 = "S";
        swlin = 6;
    |PRINT;
        asubob = #1#7;  sobra1 = 0;  sobra2 = 0;  sobra3 = 0;  sobra4 = 0;
|FINSI;
|SI aobras ! #1#1; |Y #0#19 = "S";
        swlin = 4;
    |PRINT;
        aobras = #1#1;  obras1 = 0;  obras2 = 0;  obras3 = 0;  obras4 = 0;
|FINSI;
|SI ahoras ! #1#4; |Y #0#20 = "S";
        swlin = 5;
    |PRINT;
        ahoras = #1#4;  horas1 = 0;  horas2 = 0;  horas3 = 0;  horas4 = 0;
|FINSI;

    swlin = 0;
|PRINT;

 ||   ACUMULADOS HORAS /  ACUMULADOS PTAS.HORAS  / ACUMULADOS DESTAJO
    fecha1=fecha1+#1#5; fecha2=fecha2+(#1#5*#2#1); fecha3=fecha3+#1#6;
    empre1=empre1+#1#5; empre2=empre2+(#1#5*#2#1); empre3=empre3+#1#6;
    traba1=traba1+#1#5; traba2=traba2+(#1#5*#2#1); traba3=traba3+#1#6;
    obras1=obras1+#1#5; obras2=obras2+(#1#5*#2#1); obras3=obras3+#1#6;
    horas1=horas1+#1#5; horas2=horas2+(#1#5*#2#1); horas3=horas3+#1#6;
    sobra1=sobra1+#1#5; sobra2=sobra2+(#1#5*#2#1); sobra3=sobra3+#1#6;

 ||   ACUMULADOS TOTAL PTAS.
    fecha4=fecha4+((#1#5*#2#1)+#1#6);
    empre4=empre4+((#1#5*#2#1)+#1#6);
    traba4=traba4+((#1#5*#2#1)+#1#6);
    obras4=obras4+((#1#5*#2#1)+#1#6);
    sobra4=sobra4+((#1#5*#2#1)+#1#6);
    horas4=horas4+((#1#5*#2#1)+#1#6);

 ||   ACUMULADOS GENERALES
    total1=total1+#1#5;            || total horas
    total2=total2+(#1#5*#2#1);     || total ptas.horas
    total3=total3+#1#6;            || total ptas.destajo
    total4=total2+total3;          || total ptas.totales
|FPRC;

|PROCESO abucle2;   || ACTIVA SWITCH DE IMPRESION EFECTIVA
|SI seleccio = 0;
        seleccio = 1;
        afecha = "xxxxxxxx";
        aempre = -1;
        atraba = -1;
        aobras = -1;
        asubob = -1;
        ahoras = -1;
|FINSI;
|FPRC;

|PROCESO abucle1;   || CARGA VARIABLES DE TRABAJO PARA ORDENACION

    alfa1 = #1#0;  alfa2=alfa1 %-104;  alfa3=alfa1 %402;  alfa4=alfa1 %102;
    fecha = alfa2 + alfa3 + alfa4;  || ****** FECHA

    alfa1 = #1#2; alfa1="00000"+alfa1;  alfa1=alfa1 %-105;
    empre = alfa1;                  || **** EMPRESA

    alfa1 = #1#3; alfa1="00000"+alfa1;  alfa1=alfa1 %-105;
    traba = alfa1;                  || * TRABAJADOR

    alfa1 = #1#1; alfa1="0000" +alfa1;  alfa1=alfa1 %-104;
    alfa2 = #1#7; alfa2="00"   +alfa2;  alfa2=alfa2 %-102;
    obras = alfa1 + alfa2;          || ******* OBRA

    alfa1 = #1#4; alfa1="00"   +alfa1;  alfa1=alfa1 %-102;
    horas = alfa1;                  || * TIPOS HORA

|FPRC;

|PROCESO abucle0;   || CONSTRUYE LA CLAVE PARA LA ORDENACION

|HAZ abucle1;
|DDEFECTO #4;

|SI #0#11 = 1;  #4#0 = fecha;  |FINSI;
|SI #0#11 = 2;  #4#0 = empre;  |FINSI;
|SI #0#11 = 3;  #4#0 = traba;  |FINSI;  || 1er. factor de ordenacion
|SI #0#11 = 4;  #4#0 = obras;  |FINSI;
|SI #0#11 = 5;  #4#0 = horas;  |FINSI;

|SI #0#12 = 1;  #4#1 = fecha;  |FINSI;
|SI #0#12 = 2;  #4#1 = empre;  |FINSI;
|SI #0#12 = 3;  #4#1 = traba;  |FINSI;  || 2do. factor de ordenacion
|SI #0#12 = 4;  #4#1 = obras;  |FINSI;
|SI #0#12 = 5;  #4#1 = horas;  |FINSI;

|SI #0#13 = 1;  #4#2 = fecha;  |FINSI;
|SI #0#13 = 2;  #4#2 = empre;  |FINSI;
|SI #0#13 = 3;  #4#2 = traba;  |FINSI;  || 3er. factor de ordenacion
|SI #0#13 = 4;  #4#2 = obras;  |FINSI;
|SI #0#13 = 5;  #4#2 = horas;  |FINSI;

|SI #0#14 = 1;  #4#3 = fecha;  |FINSI;
|SI #0#14 = 2;  #4#3 = empre;  |FINSI;
|SI #0#14 = 3;  #4#3 = traba;  |FINSI;  || 4to. factor de ordenacion
|SI #0#14 = 4;  #4#3 = obras;  |FINSI;
|SI #0#14 = 5;  #4#3 = horas;  |FINSI;

|SI #0#15 = 1;  #4#4 = fecha;  |FINSI;
|SI #0#15 = 2;  #4#4 = empre;  |FINSI;
|SI #0#15 = 3;  #4#4 = traba;  |FINSI;  || 5to. factor de ordenacion
|SI #0#15 = 4;  #4#4 = obras;  |FINSI;
|SI #0#15 = 5;  #4#4 = horas;  |FINSI;

|FPRC;

|DEFBUCLE aominfmv0;
 #1#1;
 ;
 #0#1, #0#3, #0#5, #0#7, #0#21, #0#09;
 #0#2, #0#4, #0#6, #0#8, #0#22, #0#10;
 be;
 NULL, abucle0, NULL, NULL, abucle2, abucle3;
 #4#0, #4#1, #4#2, #4#3, #4#4;
|FIN;

************************************************************************
   RUTINAS DE INICIO DE PROCESO
************************************************************************

|PROCESO descrip;            || CONSTRUYE DESCRIPCION DE ORDENACION
|SI #0#11 = 1;  descri = dfecha;            |FINSI;
|SI #0#11 = 2;  descri = dempre;            |FINSI;
|SI #0#11 = 3;  descri = dtraba;            |FINSI;|| 1er. factor de ordenacion
|SI #0#11 = 4;  descri = dobras;            |FINSI;
|SI #0#11 = 5;  descri = dhoras;            |FINSI;

|SI #0#12 = 1;  descri = descri +z +dfecha; |FINSI;
|SI #0#12 = 2;  descri = descri +z +dempre; |FINSI;
|SI #0#12 = 3;  descri = descri +z +dtraba; |FINSI;|| 2do. factor de ordenacion
|SI #0#12 = 4;  descri = descri +z +dobras; |FINSI;
|SI #0#12 = 5;  descri = descri +z +dhoras; |FINSI;

|SI #0#13 = 1;  descri = descri +z +dfecha; |FINSI;
|SI #0#13 = 2;  descri = descri +z +dempre; |FINSI;
|SI #0#13 = 3;  descri = descri +z +dtraba; |FINSI;|| 3er. factor de ordenacion
|SI #0#13 = 4;  descri = descri +z +dobras; |FINSI;
|SI #0#13 = 5;  descri = descri +z +dhoras; |FINSI;

|SI #0#14 = 1;  descri = descri +z +dfecha; |FINSI;
|SI #0#14 = 2;  descri = descri +z +dempre; |FINSI;
|SI #0#14 = 3;  descri = descri +z +dtraba; |FINSI;|| 4to. factor de ordenacion
|SI #0#14 = 4;  descri = descri +z +dobras; |FINSI;
|SI #0#14 = 5;  descri = descri +z +dhoras; |FINSI;

|SI #0#15 = 1;  descri = descri +z +dfecha; |FINSI;
|SI #0#15 = 2;  descri = descri +z +dempre; |FINSI;
|SI #0#15 = 3;  descri = descri +z +dtraba; |FINSI;|| 5to. factor de ordenacion
|SI #0#15 = 4;  descri = descri +z +dobras; |FINSI;
|SI #0#15 = 5;  descri = descri +z +dhoras; |FINSI;
|FPRC;

|PROCESO proceso; |TIPO 3;
|IMPRE 0;
|SI FSalida = 0;
    |HAZ descrip;
    |INFOR "aominfmv";
    |ABRE #2;
    |ABRE #3;
    |BUCLE aominfmv0;
    |CIERRA #2;
    |CIERRA #3;
    |SI seleccio = 0;
        |MENAV "    Seleccion vacia ...";
    |SINO;
        |HAZ abucle4;
        |PIEINF;
    |FINSI;
    |FININF;
|SINO;
    |MENAV "    Proceso abortado ...";
|FINSI;
|FINIMP;
|FPRC;
