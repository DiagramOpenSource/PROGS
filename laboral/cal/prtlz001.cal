|FICHEROS;
     cretam02;

     :integral/dsam0000;
     :integral/dsam0009;
     :basica/agitab99;
     :dsarchi/dsarm005;
     :dsarchi/prtlm001;
|FIN;

|VARIABLES;
     nDia                = 0;
     nMes                = 0;
     nAny                = 0;
     nGad                = 0;

     aAlfa               = "";
     aDia                = "";
     aHora               = "";

     fFec                = @;
     fFecDia             = @;

     &enModelo           = 0;
     &enForzar           = 0;
     &enBanco            = 0;
     &eaEntidad          = "";
     &eaOficina          = "";
     &eaDC               = "";
     &eaCuenta           = "";
     &eaNomEnt           = "";
     &eaNomOfi           = "";
     &eaFormaPago        = "";
     &eaIBAN             = "";
     &eaBIC              = "";
|FIN;

|PROCESO Tipo15Fm5;
|FPRC;

|PROCESO Tipo16Fm5;
|FPRC;

|PROCESO Tipo17Fm5;
|FPRC;

|PROCESO CogeDatosBancos;
     enBanco     = 0;
     eaEntidad   = "";
     eaOficina   = "";
     eaDC        = "";
     eaCuenta    = "";
     eaNomEnt    = "";
     eaNomOfi    = "";
     eaFormaPago = "";
     eaIBAN      = "";
     eaBIC       = "";

     #dsam0009#0 = #dsam0000#0;
     #dsam0009#1 = enModelo;
     |LEE 040#dsam0009.=;
     |SI FSalida = 0;
         |SI #dsam0009#9 = 1;  |O #dsam0009#8 = "          ";
             eaFormaPago = "1";
         |SINO;
             eaFormaPago = #dsam0009#9;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |SI enForzar = 1;
             enBanco     = #dsam0009#3;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaFormaPago = #dsam0009#9;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |ACABA;
     |FINSI;

     #dsam0009#0 = #dsam0000#0;
     #dsam0009#1 = 998;
     |LEE 040#dsam0009.=;
     |SI FSalida = 0;
         |SI #dsam0009#9 = 1;  |O #dsam0009#8 = "          ";
             eaFormaPago = "1";
         |SINO;
             eaFormaPago = #dsam0009#9;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |SI enForzar = 1;
             enBanco     = #dsam0009#3;
             eaFormaPago = #dsam0009#9;
             eaEntidad   = #dsam0009#5;
             eaOficina   = #dsam0009#6;
             eaDC        = #dsam0009#7;
             eaCuenta    = #dsam0009#8;
             eaNomEnt    = #dsam0009#4;
             eaNomOfi    = #dsam0009#10;
             eaBIC       = #dsam0009#11;
             eaIBAN      = #dsam0009#12;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #dsam0000#104 = 1;  |O #dsam0000#93 = "          ";
         eaFormaPago = "1";
     |SINO;
         eaFormaPago = #dsam0000#104;
         eaEntidad   = #dsam0000#90;
         eaOficina   = #dsam0000#91;
         eaDC        = #dsam0000#92;
         eaCuenta    = #dsam0000#93;
         eaNomEnt    = #dsam0000#89;
         eaNomOfi    = "";
         eaBIC       = #dsam0000#114;
         eaIBAN      = #dsam0000#116;
     |FINSI;

     |SI enForzar = 1;
         eaFormaPago = #dsam0000#104;
         eaEntidad   = #dsam0000#90;
         eaOficina   = #dsam0000#91;
         eaDC        = #dsam0000#92;
         eaCuenta    = #dsam0000#93;
         enBanco     = #dsam0000#88;
         eaNomEnt    = #dsam0000#89;
         eaNomOfi    = "";
         eaBIC       = #dsam0000#114;
         eaIBAN      = #dsam0000#116;
     |FINSI;
|FPRC;

|PROCESO PonPer;
     |SI #prtlm001#2 = 1;   #prtlm001#7 = "ENERO     ";  |FINSI;
     |SI #prtlm001#2 = 2;   #prtlm001#7 = "FEBRERO   ";  |FINSI;
     |SI #prtlm001#2 = 3;   #prtlm001#7 = "MARZO     ";  |FINSI;
     |SI #prtlm001#2 = 4;   #prtlm001#7 = "ABRIL     ";  |FINSI;
     |SI #prtlm001#2 = 5;   #prtlm001#7 = "MAYO      ";  |FINSI;
     |SI #prtlm001#2 = 6;   #prtlm001#7 = "JUNIO     ";  |FINSI;
     |SI #prtlm001#2 = 7;   #prtlm001#7 = "JULIO     ";  |FINSI;
     |SI #prtlm001#2 = 8;   #prtlm001#7 = "AGOSTO    ";  |FINSI;
     |SI #prtlm001#2 = 9;   #prtlm001#7 = "SEPTIEMBRE";  |FINSI;
     |SI #prtlm001#2 = 10;  #prtlm001#7 = "OCTUBRE   ";  |FINSI;
     |SI #prtlm001#2 = 11;  #prtlm001#7 = "NOVIEMBRE ";  |FINSI;
     |SI #prtlm001#2 = 12;  #prtlm001#7 = "DICIEMBRE ";  |FINSI;
|FPRC;

|PROCESO CalculaVto;
     nAny = #prtlm001#1;
     nMes = #prtlm001#2 + 2;
     nDia = 1;
     |SI nMes ] 13;
         nMes = 1 + (nMes - 13);
         nAny = #prtlm001#1 + 1;
     |FINSI;

     aAlfa = (("00" + nDia) % -102) + "." + (("00" + nMes) % -102) + "." + nAny;
     fFec  = aAlfa;
     nDia  = fFec;
     nDia  = nDia - 1;
     fFec  = nDia;

     fFecDia = fFec % 1;
     aDia    = (fFecDia % 1109) > " ";   |QBF aDia;

     |SI aDia = "SABADO";
         fFec = fFec + 2;
     |FINSI;

     |SI aDia = "DOMINGO";
         fFec = fFec + 1;
     |FINSI;

     #prtlm001#9  = fFec;
|FPRC;

|PROCESO BuscaGad;
     |SELECT #9#dsarm005;

     #dsarm005#8  = #prtlm001#0;
     #dsarm005#19 = #prtlm001#3;
     #dsarm005#17 = #prtlm001#1;
     #dsarm005#18 = #prtlm001#2;
     #dsarm005#20 = #cretam02#3;
     #dsarm005#0  = 1;
     |LEE 000#dsarm005.];
     |SI FSalida      ! 0;            |ACABA;  |FINSI;
     |SI #dsarm005#8  ! #prtlm001#0;  |ACABA;  |FINSI;
     |SI #dsarm005#19 ! #prtlm001#3;  |ACABA;  |FINSI;
     |SI #dsarm005#17 ! #prtlm001#1;  |ACABA;  |FINSI;
     |SI #dsarm005#18 ! #prtlm001#2;  |ACABA;  |FINSI;
     |SI #dsarm005#20 ! #cretam02#3;  |ACABA;  |FINSI;

     nGad = 1;
|FPRC;

|PROCESO cretam02;
     #dsam0000#0 = #cretam02#0;
     |LEE 000#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

     |DDEFECTO #prtlm001;

     #prtlm001#0  = #cretam02#0;
     #prtlm001#1  = #cretam02#1;
     #prtlm001#2  = #cretam02#2;
     #prtlm001#3  = enModelo;
     #prtlm001#4  = ("00" + #cretam02#3) % -102 + " " + #cretam02#4;
     #prtlm001#5  = #dsam0000#1;
     #prtlm001#6  = #agitab99#1;

     |HAZ PonPer;
     nGad = 0;  |HAZ BuscaGad;

     |SI #cretam02#22 = "B";  #prtlm001#8 = "E";  |FINSI;
     |SI nGad = 1;            #prtlm001#8 = "A";  |FINSI;

     |HAZ CalculaVto;

     #prtlm001#10 = #cretam02#16;

     enForzar = 1;
     |HAZ CogeDatosBancos;

     #prtlm001#11 = eaFormaPago;
     #prtlm001#12 = eaIBAN;
     #prtlm001#13 = #dsam0000#18;
     #prtlm001#14 = #dsam0000#72;
     #prtlm001#15 = #dsam0000#52;
     #prtlm001#16 = #cretam02#4;
     #prtlm001#17 = ~;

     |HORA aHora;  #prtlm001#18 = aHora;

     #prtlm001#19 = "LABORAL";

     |GRABA 020#prtlm001.n;
     |LIBERA #prtlm001;
|FPRC;

|DEFBUCLE cretam02;
     #cretam02#1;
     ;
     00000, 2018, 00, 00, "";
     99999, 9999, 99, 99, "zzzzzzzzzzzzzzz";
     ;
     NULL, cretam02;
|FIN;

|PROCESO LeeModelo;
     #agitab99#0 = enModelo;
     |LEE 000#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
|FPRC;

|PROGRAMA;
     ||RECIBO LIQUIDACION COTIZACIONES (RLC);
     enModelo    = 997;  |HAZ LeeModelo;
     |BUCLE cretam02;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |ABRET #prtlm001;
     |ABRET #dsarm005;
     |ABRET #dsam0000;
     |ABRET #dsam0009;
     |ABRET #agitab99;

     #agitab99#0 = 997;
     |LEE 000#agitab99.=;
     |SI FSalida ! 0;
         |DDEFECTO #agitab99;
         #agitab99#0 = 997;
         #agitab99#1 = "RECIBO LIQUIDACION COTIZACIONES (RLC)";
         #agitab99#2 = "RECIBO LIQUIDACION COTIZACIONES (RLC)";
         #agitab99#4 = "S";
         #agitab99#5 = "M";
         #agitab99#6 = "A";
         #agitab99#7 = "N";
         #agitab99#8 = "N";

         |GRABA 000#agitab99.n;
         |LIBERA #agitab99;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #prtlm001;
     |CIERRAT #dsarm005;
     |CIERRAT #dsam0000;
     |CIERRAT #dsam0009;
     |CIERRAT #agitab99;
|FPRC;
