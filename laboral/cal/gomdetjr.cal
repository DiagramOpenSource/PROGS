|FICHEROS;
     gomdetjr #0;
     labtraba;
     nomtrcal;
|FIN;

|VARIABLES;
     aAnyo = "";
     aMes = "";
     aFecha = "";
     fFecha = @;
     aDiaLet = "";
     fDiaLet = @;
     nDiaSem = 0;
     nDiaMes = 0;
     nFilNum = 0;
     nColNum = 0;
     nColCam = 0;
     nColIni = 0;
     nPos = 0;
     nPaso = 0;
     nCampo = 0;
     nCampo2 = 0;
     a = 0;
     nModo = 0;
     numer = 0;
     bisiesto = 0;
     mesnum = 0;
     anynum = 0;
     topemes = 0;
     aAlfa1 = "";
     i = 0;
     menos = 0;
     p_mes = "";
     fecsys = @;
     alfa1 = "";

     nMes = 0;
     nDia = 0;
     aCalendario = "";
     nNume1 = 0;
     nCampoDia = 0;
     nDias = 0;
|FIN;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
    numer = anynum $ 4;
|SI numer = 0;
        bisiesto = 1;
|SINO;
        bisiesto = 0;
|FINSI;
|SI mesnum =  1;  topemes = 31;            |FINSI;
|SI mesnum =  2;  topemes = 28 + bisiesto; |FINSI;
|SI mesnum =  3;  topemes = 31;            |FINSI;
|SI mesnum =  4;  topemes = 30;            |FINSI;
|SI mesnum =  5;  topemes = 31;            |FINSI;
|SI mesnum =  6;  topemes = 30;            |FINSI;
|SI mesnum =  7;  topemes = 31;            |FINSI;
|SI mesnum =  8;  topemes = 31;            |FINSI;
|SI mesnum =  9;  topemes = 30;            |FINSI;
|SI mesnum = 10;  topemes = 31;            |FINSI;
|SI mesnum = 11;  topemes = 30;            |FINSI;
|SI mesnum = 12;  topemes = 31;            |FINSI;
|FPRC;

|PROCESO DiasActividad;
     |SI #labtraba#42 ! "C"; |Y #labtraba#42 ! "F";
          |ACABA;
     |FINSI;

     nDias = 0;

     |ABRE #nomtrcal;
     aAnyo = #gomdetjr#2;
     #nomtrcal#0 = #labtraba#156;       || defecto calendario laboral
     #nomtrcal#13 = aAnyo;
     |LEE 000#nomtrcal.=;
     nMes = #gomdetjr#3;
     aCalendario = #nomtrcal#nMes#;
     |CIERRA #nomtrcal;

     anynum = #gomdetjr#2;
     |HAZ ulti_dia;
     |PARA nDia = 1; |SI nDia [ topemes; |HACIENDO nDia = nDia + 1;
          nCampoDia = nDia + 3;
          |SI #gomdetjr#nCampoDia# = "X";
               nDias = nDias + 1;
          |FINSI;
          |SI #gomdetjr#nCampoDia# = "I";
               nCampo = nDia + 3;
               nNume1 = (nDia * 100) + 1;
               aAlfa1 = aCalendario % nNume1;
               |SI aAlfa1 = 1;
                    || era un dia de fiesta
               |SINO;
                    nDias = nDias + 1;
               |FINSI;
          |FINSI;
     |SIGUE;

     #gomdetjr#35 = nDias;
     |PINTA #gomdetjr#35;
|FPRC;


____________________________________/ CALCULOS DE PANTALLA
|PROCESO defecto; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
    #0Campo = #0Campo - menos;
|PINTA #0Campo;
|FPRC;

|PROCESO mirames2; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
    #0Campo = #0Campo - 1;
    menos = 0;
|SI #0Campo = 0;
        #0Campo = 12;
        menos = 1;
|FINSI;
|PINTA #0Campo;
|FPRC;

|PROCESO dias;
     aAnyo = #gomdetjr#2;
     aMes  = #gomdetjr#3;
     aMes = "00" + aMes;
     aMes = aMes % -102;
     aFecha = "01" + "." + aMes + "." + aAnyo;
     fFecha = aFecha;
     fDiaLet = fFecha % 1;
     aDiaLet = fDiaLet;
     aDiaLet = aDiaLet % 1103;
     |SI aDiaLet = "Lun"; nDiaSem = 1; |FINSI;
     |SI aDiaLet = "Mar"; nDiaSem = 2; |FINSI;
     |SI aDiaLet = "Mie"; nDiaSem = 3; |FINSI;
     |SI aDiaLet = "Jue"; nDiaSem = 4; |FINSI;
     |SI aDiaLet = "Vie"; nDiaSem = 5; |FINSI;
     |SI aDiaLet = "Sab"; nDiaSem = 6; |FINSI;
     |SI aDiaLet = "Dom"; nDiaSem = 7; |FINSI;
     mesnum = #gomdetjr#3;
     anynum = #gomdetjr#2;
     |HAZ ulti_dia;
     |HAZ calendario;
|FPRC;

|PROCESO cabecera;
     |ATRI R;
     |PINTA 1220, " Lun ";
     |PINTA 1226, " Mar ";
     |PINTA 1232, " Mie ";
     |PINTA 1238, " Jue ";
     |PINTA 1244, " Vie ";
     |PINTA 1250, " Sab ";
     |PINTA 1256, " Dom ";
     |ATRI 0;
|FPRC;

|PROCESO Repinta; |TIPO 13;
     nModo = (FEntrada / 100) ! 0;
     ||SI nModo = 3;
     |HAZ dias;
     ||FINSI;
|FPRC;

|PROCESO Repinta2; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ dias;
     |FINSI;
|FPRC;

|PROCESO Inicializa;
     |PARA i = 4; |SI i [34; |HACIENDO i = i + 1;
          |CAMPO_MODIFICA #0i, 1, "S";
     |SIGUE;
|FPRC;

|PROCESO calendario;
     nDiaMes = 1;
     nFilNum = 1300;
     nColIni = 15;
     nColCam = 23;
     nPaso = 6;
     nCampo = 4;
     |HAZ cabecera;
     |HAZ Inicializa;
     |BLANCO 1310 2370;
     |PARA nFilNum = nFilNum; |SI nDiaMes [ topemes; |HACIENDO nFilNum = nFilNum + 100;
     |PARA nDiaSem = nDiaSem; |SI nDiaSem [ 7;  |HACIENDO nDiaSem = nDiaSem + 1;
          nColNum = nColIni + (nDiaSem * nPaso);
          nPos = nFilNum + nColNum;
          |SI nDiaMes < 10;
               nPos = nPos + 1;
               a = 1;
          |SINO;
               a = 0;
          |FINSI;
          |PINTA nPos, nDiaMes;
          nColCam = nPos + 3 - a;
          |CAMPO_VISUAL   #0nCampo, 1, "S";
          |CAMPO_POSICION #0nCampo, 1, nColCam;
          |PINTA #0nCampo;
          |SI nDiaMes < 10;
               nPos = nPos - 1;
          |FINSI;
          nDiaMes = nDiaMes + 1;
          |SI nDiaMes > topemes; |SAL; |FINSI;
          nCampo = nCampo + 1;
     |SIGUE;
     nDiaSem = 1;
     |SIGUE;

     topemes = topemes + 4
     |PARA nCampo = topemes; |SI nCampo [34; |HACIENDO nCampo = nCampo + 1;
          |CAMPO_MODIFICA #0nCampo, 1, "N";
          |CAMPO_VISUAL #0nCampo, 1, "N";
     |SIGUE;
|FPRC;

|PROCESO Ayuda; |TIPO 14;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |SI #labtraba#42 ! "E"; |Y #labtraba#42 ! "C"; |Y #labtraba#42 ! "F";
          #labtraba#42 = "E";
     |FINSI;

     |PINTA 2023, "                                     ";
     |ATRI S;
     ||            2         3         4         5         6
     ||            012345678901234567890123456789012345678901
     |CUADRO 19192362;
     |SI #labtraba#42 = "E";
          |PINTA 2020, " Marque con  una X los  d죂s  del mes con ";
          |PINTA 2120, " jornadas reales  trabajadas  y con una I ";
          |PINTA 2220, " los d죂s  de jornadas  te줿icas (en IT). ";
          |ATRI R;
          |PINTA 2037, "X";
          |PINTA 2160, "I";
          |ATRI I;

          |CAMPO_MODIFICA #0#35, 1, "N";
          |CAMPO_VISUAL #0#35, 1, "N";
          |PINTA 1928, "컴컴컴컴컴컴컴컴컴컴컴컴컴";
          |ATRI I;

     |FINSI;
     |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
          |PINTA 2020, " Marque con X los d죂s  con jornadas rea- ";
          |PINTA 2120, " lizadas, con una I los de jornadas  te- ";
          |PINTA 2220, " ricas IT y con D los d죂s de inactividad ";
          |ATRI R;
          |PINTA 2032, "X";
          |PINTA 2138, "I";
          |PINTA 2236, "D";
          |ATRI 0;
          |PINTA 1928, "컴컴컴컴컴컴컴컴컴컴컴";
          |ATRI R;
          |PINTA 1933, "D죂s activ.:";
          |CAMPO_MODIFICA #0#35, 1, "S";
          |CAMPO_VISUAL #0#35, 1, "S";
          |HAZ DiasActividad;
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO ValidaDia;
     |SI #0Campo = "D";
     |Y #labtraba#42 ! "C"; |Y #labtraba#42 ! "F";
          #0Campo = " ";
          |PINTA #0Campo;
          |ERROR;
     |FINSI;
|FPRC;
