|FICHEROS;
     nomsicos #0;
     nomcateg;
     nomtrato;
     nomcontr;
     labempre;
     labtraba;
     nomcalca;
     nomcalli;
     nomconca;
     nomboni3;
     nombotra;

     nomdic02;
     nomdictm;
|FIN;

|VARIABLES;
     aMensaje = "";
     aNomFic = "";
     aParam = "";

     fFecha = @;
     aFecha = "";
     fec = "";
     sw = 0;
     dia1 = "";
     mes1 = "";
     any1 = "";
     dia = 0;
     mes = 0;
     any = 0;
     tope = 0;
     men1 = "";

     nMes = 0;
     nTope = 0;
     nAny = 0;
     aAny = "";
     mod = 0;

     nCodigo = 0;

     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nMesAUTO = 0;
     &nAnyAUTO = 0;
     &nTipAUTO = 0;

     FEstado = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     &aCNAEEmp = "";
     &aVacacSINO = "";
     &enSwSimulacion = 0;
     &eaFichSimBox = "";

     aValor = "";
     nCampo = 0;
     aLon = "";
     aDato = "";
     aReg = "";
     i = 0;
     nPos = 0;
     aLetra = "";
     aTab = "";
     nLon = 0;
     aCrf = "";
     nLinea = 0;
     nNume = 0;
     aAlfa = "";
     aPath = "";
     aDes = "";
     nHandle = 0;
     swTP = 0;

     nMesActual = 0;
     nAnyActual = 0;
     fFecha1 = @;
     fFecha2 = @;
     fFechaAlta = @;
     fFechaBaja = @;
     swSigue = 0;
     swMigue = 0;
|FIN;

|PROCESO ayuda6; |TIPO 7;
     |SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

     |PUSHV 07302371;
     ||CUADRO 07 30 23 71;
     |ATRI R;   || 3        4         5         6         7
     ||            1234567890123456789012345678901234567890
     |PINTA 0730, " ---------- CLAVES DE SALARIO --------- ";
     |PINTA 0830, " (M) cotizacion mensual                 ";
     |PINTA 0930, " (D) cotizacion diaria                  ";
     |PINTA 1030, " (I) cotizacion irregular por dias      ";
     |PINTA 1130, " (P) cotizacion irregular por horas     ";
     |PINTA 1230, " (T) tiempo parcial cotizacion diaria   ";
     |PINTA 1330, " (X) tiempo parcial cotizacion mensual  ";
     ||PINTA 1430, " (A) R.Agrario, Sistema General         ";
     ||PINTA 1530, " (E) R.Agrario, Jornadas Reales         ";
     ||PINTA 1630, " (e) R.Agrario, Jornadas-Extranj.Contin.";
     |PINTA 1430, " (C) r.citricos, lunes/sabado   (1.33)  ";
     |PINTA 1530, " (F) r.citricos, lunes/viernes  (1.61)  ";
     |PINTA 1630, " (H) gerentes/cooperativistas autonomos ";
     |PINTA 1730, " (L) funcionario Administracion Local   ";
     |PINTA 1830, " (N) funcionario sin exencion Seg.Social";
     |ATRI 0;
|FPRC;

|PROCESO IRPF;
/*   || la regularizacion automatica la dejo a medias que es complicadillo
     |SI #0#26 = "S";
          |CAMPO_MODIFICA #0#12, 1, "N";
          #0#12 = 0;
          |PINTA #0#12;
     |SINO;
          |CAMPO_MODIFICA #0#12, 1, "S";
     |FINSI;
*/
     |SI #0#10 > 400;
          #0#12 = 2;
          |PINTA #0#12;
     |FINSI;
|FPRC;

|PROCESO min;
     #nomboni3#11 = "S";
     #nomboni3#0 = 001;
|FPRC;

|PROCESO max;
     #nomboni3#11 = "S";
     #nomboni3#0 = 999;
|FPRC;

|PROCESO CompHoras;
     |SI #0#6 = "X"; |O #0#6 = "T";
          |SI #0#13 = 0;
               |MENAV "    Es necesario indicar el número de horas en los contratos a tiempo parcial";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CompBon;
     |SI #0#28 = 000;
          |PINTA 1629, "                                                   ³";
     |FINSI;
|FPRC;

|PROCESO CompBonFom;
     |SI #0#29 ! 000;
          |ABRE #nomboni3;
          #nomboni3#0 = #0#29;
          |LEE 000#nomboni3.=;
          |SI FSalida = 0;
               |ATRI I;
               |CAMPO_ANCHO #nomboni3#1, 1, 47;
               |PINTA 1730, #nomboni3#1;
               |ATRI I;
          |FINSI;
          |CIERRA #nomboni3;
     |SINO;
          |PINTA 1729, "                                                   ³";
     |FINSI;
|FPRC;

|PROCESO BonFomento; |TIPO 66;
     |ABRE #nomboni3;
     |CONSULTA_F_CLAVE #2#nomboni3, min, max;
     |SI FSalida = 0;
          #0#29 = #nomboni3#0;
          |PINTA #0#29;
          |ATRI I;
          |CAMPO_ANCHO #nomboni3#1, 1, 47;
          |PINTA 1730, #nomboni3#1;
          |ATRI I;
     |FINSI;
     |CIERRA #nomboni3;
|FPRC;

|PROCESO TipoCont;
     swTP = 0;
     |SI #0#10 ] 200; |Y #0#10 [ 299;
          swTP = 1;
     |FINSI;
     |SI #0#10 ] 500; |Y #0#10 [ 599;
          swTP = 1;
     |FINSI;
     |SI swTP = 1;
          |SI #0#6 = "M";
               #0#6 = "X";
               #0#7 = "M";
          |FINSI;
          |SI #0#6 = "D";
               #0#6 = "T";
               #0#7 = "D";
          |FINSI;
          |PINTA #0#6;
          |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO CompCNAE;
     aAlfa1 = #0#22;
     |QBF aAlfa1;
     |SI aAlfa1 = "";
          #0Campo = "";
          |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO CompCNAEyOCUP;
     aAlfa1 = #0#22;
     aAlfa2 = #0#23;
     |QBF aAlfa1;
     |QBF aAlfa2;
     |SI aAlfa1 = ""; |Y aAlfa2 = "";
          aAlfa1 = "    Es necesario introducir un CNAE o un ocupacion ";
          aAlfa1 = aAlfa1 + "para el calculo correcto de los costes del trabajador.";
          |MENAV aAlfa1;
     |FINSI;
     |SI aAlfa1 = "01"; |Y aAlfa2 = "";
          aAlfa1 = "    ATENCION: el codigo 01 no tiene asociada cotizacion. "
          aAlfa1 = aAlfa1 + "Debe elegir una de sus actividades o una ocupacion.";
          |MENAV aAlfa1;
     |FINSI;
|FPRC;

|PROCESO RellenaCNAE;
     #0#22 = #labempre#128;
     #0#24 = #labempre#129;
     |PINTA #0#22;
     |PINTA #0#24;
|FPRC;

|PROCESO ayuda3; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|PUSHV 11401880;
|ATRI R;
||            4        5         6         7
||            1234567890123456789012345678901234567890
|PINTA 1141, " -----  TIPOS DE AJUSTE POSIBLES ------ ";
|PINTA 1241, " (0) Sin ajuste                         ";
|PINTA 1341, " (1) A brutos   (no cotiza -407-)       ";
|PINTA 1441, " (2) A brutos   (cotiza -120-)          ";
|PINTA 1541, " (3) A liquidos (no cotiza -407-)       ";
|PINTA 1641, " (4) A liquidos (cotiza -120-)          ";
|PINTA 1741, " (5) A brutos   (no cot./no IRPF -411-) ";
|PINTA 1841, " (6) A liquidos (no cot./no IRPF -411-) ";
|ATRI 0;
|FPRC;

|PROCESO Repon;
     |POPV;
|FPRC;

|PROCESO ImporteAjus; |TIPO 7;
     |SI #0#19 ! 0;
          |SI #0#20 [ 100;
               #0#21 = "D";
          |SINO;
               #0#21 = "M";
          |FINSI;
     |FINSI;
     |PINTA #0#21;
|FPRC;

|PROCESO topemes;
     |SI nMes = 1; |O nMes = 3; |O nMes = 5; |O nMes = 7; |O nMes = 8; |O nMes = 10; |O nMes = 12;
           nTope = 31;
     |SINO;
          |SI nMes = 2;
               aAny = aFecha % -104;
               nAny = aAny;
               mod = nAny $ 4;
               |SI mod = 0;
                    nTope = 29;
               |SINO;
                    nTope = 28;
               |FINSI;
          |SINO;
               nTope = 30;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PintaFechas;
     |SI Campo = 14;
          |SI #0Campo = Contenido;
               |ACABA;
          |FINSI;
     |FINSI;

     fFecha = ~;
     aAlfa = fFecha;
     aAlfa1 = aAlfa % -104;
     nAnyActual = aAlfa1;
     aAlfa1 = aAlfa % 402;
     nMesActual = aAlfa1;

     |SI #0#14 < nMesActual;
          nNume = nAnyActual + 1;
          any1 = nNume;
     |SINO;
          nNume = nAnyActual;
          any1 = nNume;
     |FINSI;

     mes1 = #0#14;
     mes1 = ("00" + mes1) % -102;
     #0#15 = "01." + mes1 + "." + any1;

     |PINTA #0#14;
     |PINTA #0#15;

     nMes = #0#14;
     nAny = nNume;
     |HAZ topemes;
     aAlfa = nTope;
     aAlfa = (("00" + aAlfa) % -102) + "." + mes1 + "." + any1;
     #0#16 = aAlfa;
     |PINTA #0#16;
|FPRC;

|PROCESO CompFechas;
     |SI Campo = 16; |Y FSalida = 2;
          |ACABA;
     |FINSI;
     |SI Campo = 15; |Y FSalida = 3;
          |ACABA;
     |FINSI;
/*
     aAlfa1 = #0#15 % 402;
     aAlfa2 = #0#16 % 402;

     aAlfa3 = #0#15 % -104;
     aAlfa4 = #0#16 % -104;

     |SI aAlfa1 ! aAlfa2; |O aAlfa3 ! aAlfa4;
          |MENAV "    ATENCION: La fecha de inicio y fin han de estar comprendidas en el mismo mes";
          |ERROR;
     |FINSI;
*/

     mes1 = #0#14;
     mes1 = ("00" + mes1) % -102;
     aAlfa = "01." + mes1 + "." + any1;
     fFecha1 = aAlfa;

     nMes = #0#14;
     nAny = nNume;
     |HAZ topemes;
     aAlfa = nTope;
     aAlfa = (("00" + aAlfa) % -102) + "." + mes1 + "." + any1;
     fFecha2  = aAlfa;

     aAlfa = #0#15;
     fFechaAlta = aAlfa;
     aAlfa = #0#16;
     fFechaBaja = aAlfa;

     |SI fFechaAlta > fFechaBaja;
          |MENAV "    ATENCION. La fecha de alta ha de ser anterior a la fecha de baja";
          |ERROR;
     |SINO;
          swSigue = 1;
/*
          |SI fFechaAlta > fFecha2; |O fFechaAlta < fFecha1;
               swSigue = 0;
          |FINSI;
          |SI fFechaBaja > fFecha2; |O fFechaBaja < fFecha1;
               swSigue = 0;
          |FINSI;
          |SI swSigue = 0;
               |MENAV "    Las fechas de alta y baja han de estar comprendidas en el mes de cálculo de la simulación";
               |ERROR;
          |FINSI;
*/
     |FINSI;
|FPRC;

|PROCESO AyudaFor; |TIPO 7;
     |SI Campo = 30;
          |MENSA "    El trabajador cotiza por desempleo? (S/N)";
     |FINSI;
     |SI Campo = 31;
          |SI #0#10 = 421;
               |MENSA "    Opciones: (S) Bonificado 100%, (T) Bonificado 75%, (N) No bonificado";
          |FINSI;
          |SI #0#10 = 422;
               |MENSA "    Opciones: (S) Bonificado 100% -RDL 8/2014-; (N) No bonificado";
          |FINSI;
     |FINSI;
     |SI Campo = 32;
          |SI #0#10 = 421;
               |MENSA "    Opciones: (1) Primer a¤o (75%), (2) Segundo a¤o (85%), (N) No proporcionar";
          |FINSI;
          |SI #0#10 = 420; |O #0#10 = 520;
               |MENSA "    Opciones: (1) Primer a¤o (60%), (2) Segundo a¤o (75%), (N) No proporcionar";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OcultaFor;
     |CAMPO_MODIFICA #0#30, 1, "N";
     |CAMPO_MODIFICA #0#31, 1, "N";
     |CAMPO_MODIFICA #0#32, 1, "N";

     |CAMPO_VISUAL #0#30, 1, "N";
     |CAMPO_VISUAL #0#31, 1, "N";
     |CAMPO_VISUAL #0#32, 1, "N";

||                 123456789
     |PINTA 1171, "         ³";
     |PINTA 1271, "         ³";
|FPRC;

|PROCESO Formativos;
     |HAZ OcultaFor;

     |SI #0#10 = 420; |O #0#10 = 520;        || practicas
          |CAMPO_MODIFICA #0#32, 1, "S";
          |CAMPO_VISUAL #0#32, 1, "S";
          |PINTA #0#32;

          |ATRI R;
          |PINTA 1177, "Pro";
          |ATRI I;
     |FINSI;

     |SI #0#10 = 421;                        || formacion
          |CAMPO_MODIFICA #0#30, 1, "S";
          |CAMPO_MODIFICA #0#31, 1, "S";
          |CAMPO_MODIFICA #0#32, 1, "S";
          |CAMPO_VISUAL #0#30, 1, "S";
          |CAMPO_VISUAL #0#31, 1, "S";
          |CAMPO_VISUAL #0#32, 1, "S";
          |PINTA #0#30;
          |PINTA #0#31;
          |PINTA #0#32;

          |ATRI R;
          |PINTA 1172, "D";
          |PINTA 1175, "B";
          |PINTA 1178, "P";
          |ATRI I;
     |FINSI;

     |SI #0#10 = 422;                        || becarios
          |CAMPO_MODIFICA #0#31, 1, "S";
          |CAMPO_VISUAL #0#31, 1, "S";
          |PINTA #0#31;

          |ATRI R;
          |PINTA 1174, "Bon";
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO Garantizados;
     |SI #0#18 = "S";
          |CAMPO_MODIFICA #0#19, 1, "S";
          |CAMPO_MODIFICA #0#20, 1, "S";
          |CAMPO_MODIFICA #0#21, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#19, 1, "N";
          |CAMPO_MODIFICA #0#20, 1, "N";
          |CAMPO_MODIFICA #0#21, 1, "N";

          #0#19 = 0;
          #0#20 = 0;
          #0#21 = "M";
     |FINSI;
|FPRC;

|PROCESO defectos;
     fFecha = ~;
     aFecha = fFecha;
     dia1 = aFecha % 102;
     mes1 = aFecha % 402;
     any1 = aFecha % -104;
     dia = dia1;
     mes = mes1;
     any = any1;
     #0#14 = mes;

     |HAZ PintaFechas;

     |HAZ Formativos;

     |HAZ RellenaCNAE;

     #0#2 = #labempre#1;
     |PINTA #0#2;
     |ABRE #nomconca;
     #nomconca#0 = #0#2;
     |LEE 000#nomconca.=;
     |ATRI I;
     |PINTA 1030, #nomconca#1;
     |ATRI I;
     |CIERRA #nomconca;

     |HAZ PintaFechas;
     |HAZ IRPF;
|FPRC;

|PROCESO CompTipo;
     |SI #0#18 = "S";
          |SI #0#19 = 0;
               |MENAV "    ATENCION: Es necesario indicar el tipo de Ajuste";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CompImporte;
     |SI #0#18 = "S";
          |SI #0#20 = 0;
               |MENAV "    ATENCION: Salario Garantizado con importe a cero !!!";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO verifech; |TIPO 0;
     fec = #0Campo; sw = 0;
     |SI fec ! "          ";
          dia1 = fec % A102;
          mes1 = fec % A402;
          any1 = fec % A704;
          dia = dia1; mes = mes1; any = any1;
          |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
               |SI mes [ 12; |Y mes ] 1;
                    |SI mes = 1; |O mes = 3; |O mes = 5; |O mes = 7; |O mes = 8; |O mes = 10; |O mes = 12;
                         tope = 31;
                    |SINO;
                         |SI mes = 2;
                              mod = any $ 4;
                              |SI mod = 0;
                                   tope = 29;
                              |SINO;
                                   tope = 28;
                              |FINSI;
                         |SINO;
                              tope = 30;
                         |FINSI;
                    |FINSI;
                    |SI dia [ tope;
                         sw = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          sw = 1;
     |FINSI;
     |SI sw = 0;
         |MENAV "    ATENCION: Formato de fecha incorrecta";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO activaparc; |TIPO 7;
     |SI #0#6 = "X"; |O #0#6 = "T"; |O #0#6 = "P";
          |CAMPO_MODIFICA #0#13, 1, "S";
     |SINO;
          #0#13 = 0;
          |PINTA #0#13;
          |CAMPO_MODIFICA #0#13, 1, "N";
     |FINSI;
|FPRC;

|PROCESO MinCon;
     #nomtrato#0 = #0#9;
     #nomtrato#1 = 001;
|FPRC;

|PROCESO MaxCon;
     #nomtrato#0 = #0#9;
     #nomtrato#1 = 999;
|FPRC;

|PROCESO ConsultaCon; |TIPO 66;
     |ABRE #nomtrato;
     |CONSULTA_F_CLAVE #1#nomtrato, MinCon, MaxCon;
     |SI FSalida = 0;
          #0#10 = #nomtrato#1;
          #0#11 = #nomtrato#2;
          |PINTA #0#10;
          |PINTA #0#11;
     |FINSI;
     |CIERRA #nomtrato;
|FPRC;

|PROCESO DatosCat;
     #0#5 = #nomcateg#3;
     #0#6 = #nomcateg#4;
     #0#7 = #nomcateg#5;
     |PINTA #0#5;
     |PINTA #0#6;
     |PINTA #0#7;
|FPRC;

|PROCESO MinCat;
     #nomcateg#0 = #0#2;
     #nomcateg#1 = 001;
|FPRC;

|PROCESO MaxCat;
     #nomcateg#0 = #0#2;
     #nomcateg#1 = 999;
|FPRC;

|PROCESO ConsultaCat; |TIPO 66;
     |ABRE #nomcateg;
     |CONSULTA_F_CLAVE #1#nomcateg, MinCat, MaxCat;
     |SI FSalida = 0;
          #0#3 = #nomcateg#1;
          #0#4 = #nomcateg#2;
          |PINTA #0#3;
          |PINTA #0#4;
          |HAZ DatosCat;
     |FINSI;
     |CIERRA #nomcateg;
|FPRC;

|PROCESO borra;
     |BORRA 020#nomcalli.a;
|FPRC;

|PROCESO BorraNombotra;
     |BORRA 020#nombotra.a;
     |LIBERA #nombotra;
|FPRC;

|DEFBUCLE BorraNombotra;
     #nombotra#1;
     ;
     #0#0, nCodigo, 001;
     #0#0, nCodigo, 999;
     be;
     NULL, BorraNombotra;
|FIN;

|PROCESO BorraRestos;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = nCodigo;
     |LEE 101#labtraba.=;
     |SI FSalida = 0;
          |BORRA 020#labtraba.a;
          |LIBERA #labtraba;
     |FINSI;
     |CIERRA #labtraba;

     |ABRE #nomcalca;
     #nomcalca#0 = #0#0;
     #nomcalca#1 = nCodigo;
     #nomcalca#2 = #0#14;
     #nomcalca#3 = 0;
     |LEE 101#nomcalca.=;
     |SI FSalida = 0;
          |BUCLELIN 0borra#nomcalca;
          |BORRA 020#nomcalca.a;
          |LIBERA #nomcalca;
     |FINSI;

     |CIERRA #nomcalca;

     |BUCLE BorraNombotra;
|FPRC;

|PROCESO ImprimeResumen;
     |SUB_EJECUTA "nomyrenm;AUTO";
|FPRC;

|PROCESO ImprimeNomina;
     nTipAUTO = 0;
     enSwSimulacion = 1;
     |SI aParam ! "";
          enSwSimulacion = 2; || de laborbox
          eaFichSimBox = aParam;
     |FINSI;
     |SUB_EJECUTA "nomrecib;AUTO";
|FPRC;

|PROCESO CalculaNomina;
     nEmpAUTO = #0#0;
     nTraAUTO = nCodigo;
     nMesAUTO = #0#14;
     nAnyAUTO = any;
     aVacacSINO = #0#27;

     |SUB_EJECUTA "nomcalcu;NOMSICOS";
     /*   || la regularizacion automatica la dejo a medias que es complicadillo
     |SI #0#26 = "N";
          |SUB_EJECUTA "nomcalcu;NOMSICOS";
     |SINO;
          |SUB_EJECUTA "nomcalcu;NOMSICOSR";
     |FINSI;
     */
|FPRC;

|PROCESO CreaTrabajador;
     |PARA nCodigo = 99999; |SI nCodigo ] 1; |HACIENDO nCodigo = nCodigo - 1;
          #labtraba#0 = #0#0;
          #labtraba#1 = nCodigo;
          |LEE 000#labtraba.=;
          |SI FSalida = 0;
               aAlfa1 = #labtraba#2; |QBF aAlfa1;
               aAlfa2 = #labtraba#7; |QBF aAlfa2;
               |SI aAlfa1 = "Simulacion Costes"; |Y aAlfa2 = "";
                    |HAZ BorraRestos;
                    |SAL;
               |FINSI;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;

     #labempre#0 = #0#0;           || empresa
     |LEE 000#labempre.=;

     #labtraba#0 = #0#0;           || empresa
     #labtraba#1 = nCodigo;        || trabajador
     #labtraba#2 = "Simulacion Costes"; || nombre trabajador
     #labtraba#87 = #0#2;          || convenio
     #labtraba#17 = #0#3;          || categoria
     #labtraba#18 = #0#4;          || nombre categoria
     #labtraba#33 = #0#5;          || grupo de cotizacion
     #labtraba#42 = #0#6;          || clave dias salario
     #labtraba#64 = #0#7;          || clave cotizacion M/D
     ||#labtraba#32 = #0#8;            || epigrafe
     #labtraba#204 = #0#23;            || ocupacion
     #labtraba#247 = #0#9;            || regimen cotizacion
     #labtraba#45 = #0#10;           || contrato

     |SI #0#10 = 420; |O #0#10 = 520;
          || % salario

          |SI #0#32 = "N";
               #labtraba#208 = "N";
          |FINSI;
          |SI #0#32 = "1";
               #labtraba#232 = 60; #labtraba#233 = 60; #labtraba#208 = "S";
          |FINSI;
          |SI #0#32 = "2";
               #labtraba#232 = 75; #labtraba#233 = 75; #labtraba#208 = "S";
          |FINSI;
     |FINSI;
     |SI #0#10 = 421;
          || % salario

          |SI #0#32 = "N";
               #labtraba#208 = "N";
          |FINSI;
          |SI #0#32 = "1";
               #labtraba#232 = 75; #labtraba#233 = 75; #labtraba#208 = "S";
          |FINSI;
          |SI #0#32 = "2";
               #labtraba#232 = 85; #labtraba#233 = 85; #labtraba#208 = "S";
          |FINSI;

          || bonificado S/T/N
          #labtraba#191 = #0#31;

          || cotiza al desempleo S/N
          #labtraba#190 = #0#30;
     |FINSI;
     |SI #0#10 = 422;
          || bonificado S/N
          |SI enSwSimulacion = 2; || de laborbox
               #labtraba#191 = #0#34;
          |SINO;
               #labtraba#191 = #0#31;
          |FINSI;
     |FINSI;

     |SI #0#33 = "S";         || con pagas (prorrateadas)
          |PARA nCampo = 113; |SI nCampo [ 120; |HACIENDO nCampo = nCampo + 1;
               #labtraba#nCampo# = "S";         || con pagas (prorrateadas)
          |SIGUE;
     |FINSI;

     #labtraba#30 = #0#12;           || irpf
     #labtraba#234 = #0#13;           || horas tiempo parcial
     #labtraba#34 = #0#15;           || fecha alta
     #labtraba#36 = #0#15;           || fecha alta
     #labtraba#37 = #0#16;           || fecha baja
     #labtraba#248 = #nomtrato#3;

     #labtraba#97 = #0#19;
     #labtraba#98 = #0#20;
     #labtraba#207 = #0#21;

     #labtraba#156 = #labempre#34;        || calendario

     #labtraba#39 = #0#28;
     |SI #0#28 ! 000;
          #labtraba#40 = #0#15;
     |FINSI;

/*   || la regularizacion automatica la dejo a medias que es complicadillo
     |SI #0#26 = "N";
          #labtraba#29 = 0;             || regularizacion No
     |SINO;
          #labtraba#29 = 1;             || regularizacion Si
     |FINSI;
*/
     #labtraba#29 = 0;             || regularizacion No
     aCNAEEmp = #0#22;            || CNAE empresa

     |SI #0#29 ! 000;
          #labtraba#121 = "S";
     |FINSI;
     |GRABA 020#labtraba.n;
     |LIBERA #labtraba;
                                   || bonif. fomento
     |SI #0#29 ! 000;
          |ABRE #nombotra;
          |ABRE #nomboni3;

          |BUCLE BorraNombotra;

          #nombotra#0 = #0#0;
          #nombotra#1 = nCodigo;
          #nombotra#2 = #0#29;
          #nombotra#4 = #0#15;
          #nombotra#5 = #0#16;

          #nomboni3#0 = #0#29;
          |LEE 000#nomboni3.=;

          #nombotra#6 = #nomboni3#2;
          #nombotra#7 = #nomboni3#2 / 12;

          |GRABA 020#nombotra.n;
          |LIBERA #nombotra;
          |CIERRA #nombotra;
          |CIERRA #nomboni3;
     |FINSI;
|FPRC;

|PROCESO Proceso;
     |ABRE #labempre;
     |ABRE #labtraba;
     |HAZ CreaTrabajador;
     |CIERRA #labtraba;
     |CIERRA #labempre;

     |HAZ CalculaNomina;
     |HAZ ImprimeNomina;
     |SI enSwSimulacion = 2;
          || si vengo de laborbox no lo hagas
     |SINO;
          |HAZ ImprimeResumen;
     |FINSI;
     |HAZ BorraRestos;
|FPRC;

|PROCESO AsignaValor;
     |SI nLinea = 1;
          #nomdictm#0 = nCampo;
          #nomdictm#1 = aValor;
          |GRABA 020#nomdictm.n;
          |LIBERA #nomdictm;
     |SINO;
          #nomdictm#0 = nCampo;
          |LEE 000#nomdictm.=;
          |SI FSalida = 0;
               |SELECT #2#nomdic02;
               #nomdic02#0 = 01;
               #nomdic02#3 = #nomdictm#1;
               |LEE 000#nomdic02.=;
               |SI FSalida = 0;
                    nNume = #nomdic02#1;
                    |HAZ ValidaValor;
                    #0nNume = aValor;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ValidaValor;
     |SI aValor = "None"; aValor = ""; |FINSI;
     |SI aValor = "True"; aValor = "S"; |FINSI;
     |SI aValor = "False"; aValor = "N"; |FINSI;
     aAlfa1 = aValor % 501;
     aAlfa2 = aValor % 801;
     |SI aAlfa1 = "-"; |Y aAlfa2 = "-"
          aValor = (aValor % 902) + "." + (aValor % 602) + "." + (aValor % 104);
     |FINSI;
|FPRC;

|PROCESO Dato;
/*
     nCampo = 1;
     aLon = aDato % A0;
     aReg = "";
     nLon = aLon;
*/
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aLetra = aDato % nPos;
          |SI aLetra = aTab; |O aLetra = aCrf;
               aValor = aReg;
               |QBF aValor;

               |HAZ AsignaValor;
               aReg = "";
               nCampo = nCampo + 1;

               |SI aLetra = aCrf;
                    nLinea = nLinea + 1;
                    nCampo = 1;
                    aLon = "250";
                    aReg = "";
                    nLon = 250;

                    |SI nLinea = 3;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |SINO;
               aReg = aReg + aLetra;
          |FINSI;
          |SI nCampo > 90; |SAL; |FINSI;     || Por si.... :)
     |SIGUE;
/*
     || el ultimo

     |QBF aReg;
     |SI aReg ! "";
          aValor = aReg;
          |HAZ AsignaValor;
     |FINSI;
*/
|FPRC;


|PROCESO LeePeticion;
     aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_nomdictm_" + aAlfa;
     |NOME_DAT #nomdictm#aAlfa#;
     |DELINDEX #nomdictm;

     |ABRE #nomdictm;
     |ABRE #nomdic02;

     aTab = &9;
     aCrf = &10;

     nLinea = 0;
     |DFICE aPath;
     aDes = aPath + aNomFic + ".ent";
     |XABRE "B", aDes, nHandle;
     |SI FSalida ] 0;
          nCampo = 1;
          nLon = 250;
          aLon = "250";
          aReg = "";

          nLinea = 1;
          |XLEE nHandle, 250, aDato;    || los nombres
          |HAZ Dato;

          |XLEE nHandle, 250, aDato;    || los nombres
          |HAZ Dato;

          nLinea = nLinea + 1;
          |XLEE nHandle, 250, aDato;
          |HAZ Dato;
          |XCIERRA nHandle;
     |FINSI;

     |CIERRA #nomdic02;
     |CIERRA #nomdictm;

     |DELINDEX #nomdictm;
|FPRC;

|PROCESO Inicio;
|FPRC;

|PROCESO PruebaPDF;
     aMensaje = "0000Ejecucucion con parametro";
||     |MENAV aMensaje;

     Impresora = "CrystalReport;c:/ds/crystal/pruebaUno.pdf";
     |IMPRE -1;
     |SI FSalida = 0;
          |INFOR "nomycrys";
          |PRINT;
          |FININF;
          |FINIMP;
     |SINO;
          aMensaje = "0000Problemas con impresora CrystalReports";
          |MENAV aMensaje;
     |FINSI;
|FPRC;

|PROCESO GrabaResultado;
|FPRC;

|PROCESO OtrosDatos;
     |ABRE #nomcateg;
     #nomcateg#0 = #0#2;
     #nomcateg#1 = #0#3;
     |LEE 000#nomcateg.=;
     |SI FSalida = 0;
          #0#4 = #nomcateg#2;
     |FINSI;
     |CIERRA #nomcateg;

     |ABRE #nomtrato;
     #nomtrato#0 = #0#9;
     #nomtrato#1 = #0#10;
     |LEE 000#nomtrato.=;
     |CIERRA #nomtrato;

     fFecha = ~;
     aFecha = fFecha;
     any1 = aFecha % -104;
     any = any1;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |QBF aParam;

     aAlfa = aParam % -105;
     aParam = aParam - "Migue";
     |SI aAlfa = "Migue";
          swMigue = 1;
     |FINSI;
     |ABRE #0;
     |SI aParam = "";
          |LEE 101#0p;
          FEstado = FSalida;
          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;
          |HAZ defectos;
          |HAZ CompBonFom;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |HAZ Proceso;
          |FINSI;

          |SI FEstado = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
     |SINO;
          aNomFic = aParam;
          |HAZ LeePeticion;
          |HAZ OtrosDatos;
          |SI swMigue = 1;
               |CLS;
               |PINPA #0#0;
               |PINDA #0#0;
               |PAUSA;
          |FINSI;
          |HAZ Proceso;

          ||HAZ PruebaPDF;

          |HAZ GrabaResultado;
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
|FPRO;
