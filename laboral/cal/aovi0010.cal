|FICHEROS;
   aovi0010 #0;
   aovi0008;

   aomparam #10;
   concept@ #1000;
   cacuent@ #1001;
   canempr@ #1002;
   diarios@ #1003;

     caenlac@ #1000;
     caconas@ #1001;
     camasic@ #1002;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aAlfa1 = "";
     nCalc  = 0;
     nTecla = 0;
     nMaxDigit = 0;

     fFecha = @;
     aFecha = "";
     aAny = "";
     aMes = "";
     nAny = 0;
     nMes = 0;
     nNume = 0;

     FEstado = 0;
     mesnum = 0;
     anynum = 0;
     aDia = "";
     topemes = 0;

     nImporte = 0;
     nSwError = 0;
     nDocum = 0;
     nDiario = 0;
     enNoModif = 0;
     aCuenta = "";
     fich_alta = "";
     numer = 0;
     bisiesto = 0;
     nEjer    = 0;
|FIN;

|PROCESO Defectos; |TIPO 7;
     fFecha = ~;
     aFecha = fFecha;
     aAny = aFecha % -104;
     aMes = aFecha % 402;
     nAny = aAny;
     nMes = aMes;
     #0#1 = nAny;
     #0#2 = nMes;
     |PINTA #0#1;
     |PINTA #0#2;
|FPRC;

|PROCESO CompCuenta;
   aAlfa = #aovi0010#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida !0; |HACIENDO;
      aAlfa1 = aAlfa % 0; nCalc = aAlfa1;
      nCalc = nMaxDigit - nCalc;
      aAlfa1 = "0" * nCalc;
      nCalc = FSalida + 98; aAlfa1 = aAlfa1 + (aAlfa % nCalc);
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa1 = (aAlfa % nCalc) + aAlfa1; aAlfa = aAlfa1;
      aAlfa = aAlfa - ".";
   |SIGUE;
   #aovi0010#Campo# = aAlfa; |PINTA #aovi0010#Campo#;

   aAlfa = #aovi0010#Campo#; |QBF aAlfa;
   aAlfa = aAlfa % 0; nCalc = aAlfa;
   |SI nCalc = #canempr@#14; #cacuent@#1 = 1; |FINSI;
   |SI nCalc = #canempr@#15; #cacuent@#1 = 2; |FINSI;
   |SI nCalc = #canempr@#16; #cacuent@#1 = 3; |FINSI;
   |SI nCalc = #canempr@#17; #cacuent@#1 = 4; |FINSI;
   |SI nCalc = #canempr@#18; #cacuent@#1 = 5; |FINSI;
   |SI nCalc = #canempr@#19; #cacuent@#1 = 6; |FINSI;
   #cacuent@#0 = #aovi0010#Campo#;
   |LEE 000#cacuent@.=;
   |SI FSalida ! 0;
       |MENAV "    Cuenta inexistente";
       |ERROR; |ACABA;
   |SINO;
      |SI #cacuent@#3 = "N";
         aAlfa = "    NEsta seleccionando una cuenta sin pase directo. " + &191 + " Continuar ? ";
         |CONFI aAlfa;
         |SI FSalida ! 0; |ERROR; |FINSI;
      |FINSI;
   |FINSI;

   |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
   |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
|FPRC;

|PROCESO Cuentas;
     nTecla = FSalida;

     aAlfa = #aovi0010#Campo#;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12;
     |QBF aAlfa;
     aAlfa1 = aAlfa + "def/cacuenta.mas";
     |CARGA_DEF aAlfa1, cacuent@;
     |SI FSalida ! 0;
          |MENAV "    No encuentro el fichero de plan contable";
          |ERROR;
          |ACABA;
     |SINO;
          aAlfa1 = aAlfa + "def/canempre.mas";
          |CARGA_DEF aAlfa1, canempr@;
          |SI FSalida ! 0;
               |DESCARGA_DEF #cacuent@;
               |MENAV "    No encuentro el fichero de empresas";
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     aAlfa1 = aAlfa + "fich/";
     |PATH_DAT #1002#aAlfa1#;
     aAlfa1 = aAlfa + "fich/" + (("00000" + #aovi0010#9) % -105) + #aovi0010#10 + "/";
     |PATH_DAT #1001#aAlfa1#;

     |ABRE #canempr@;
     #canempr@#2 = #aovi0010#9;
     #canempr@#3 = #aovi0010#10;
     |LEE 000#canempr@.=;
     |SI FSalida ! 0; |DDEFECTO #canempr@; |FINSI;

     nMaxDigit = 0;
     |SI #canempr@#14 ] nMaxDigit; nMaxDigit = #canempr@#14; |FINSI;
     |SI #canempr@#15 ] nMaxDigit; nMaxDigit = #canempr@#15; |FINSI;
     |SI #canempr@#16 ] nMaxDigit; nMaxDigit = #canempr@#16; |FINSI;
     |SI #canempr@#17 ] nMaxDigit; nMaxDigit = #canempr@#17; |FINSI;
     |SI #canempr@#18 ] nMaxDigit; nMaxDigit = #canempr@#18; |FINSI;
     |SI #canempr@#19 ] nMaxDigit; nMaxDigit = #canempr@#19; |FINSI;

     |ABRE #cacuent@;
     |SI nTecla = 10;
          #cacuent@#0 = #aovi0010#Campo#;
          |LEE 000#cacuent@.];
          |CONSULTA_CLAVE #1#cacuent@;
          |SI FSalida = 0;
              #aovi0010#Campo# = #cacuent@#0;
              |PINTA #aovi0010#Campo#;
          |FINSI;
     |FINSI;

     |HAZ CompCuenta;
|FPRC;

|PROCESO MiraCpts;
     nTecla = FSalida;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa = aAlfa - "contagen/";
     |SI FSalida ! 0;
          aAlfa = aAlfa + "modelos/";
          aAlfa1 = aAlfa + "def/dsmom030.mas";
          |CARGA_DEF aAlfa1, concept@;
          |SI FSalida ! 0;
               |MENAV "    No encuentro el fichero de conceptos";
               |ERROR;
               |ACABA;
          |SINO;
               aAlfa1 = aAlfa + "fich/"; |PATH_DAT #1000#aAlfa1#;
          |FINSI;
     |SINO;
          aAlfa = aAlfa - "contagen\";
          |SI FSalida ! 0;
         aAlfa = aAlfa + "modelos/";
         aAlfa1 = aAlfa + "def/dsmom030.mas";
         |CARGA_DEF  aAlfa1, concept@;
         |SI FSalida ! 0;
            |MENAV "    No encuentro el fichero de conceptos";
            |ERROR; |ACABA;
         |SINO;
            aAlfa1 = aAlfa + "fich/"; |PATH_DAT #1000#aAlfa1#;
         |FINSI;
      |SINO;
         aAlfa1 = aAlfa + "/def/caconcep.mas";
         |CARGA_DEF  aAlfa1, concept@;
         |SI FSalida ! 0;
            |MENAV "    No encuentro el fichero de conceptos";
            |ERROR; |ACABA;
         |SINO;
            aAlfa1 = aAlfa + "fich/" + (("00000" + #aovi0010#9) % -105) + #aovi0010#10 + "/";
            |PATH_DAT #1000#aAlfa1#;
         |FINSI;
      |FINSI;
   |FINSI;

   |ABRE #concept@;
   |SI nTecla = 10;
      #concept@#0 = #aovi0010#5;
      |LEE 000#concept@.];
      |CONSULTA_CLAVE #1#concept@;
      |SI FSalida = 0;
         #aovi0010#5 = #concept@#0; |PINTA #aovi0010#5;
         #aovi0010#6 = #concept@#1; |PINTA #aovi0010#6;
      |FINSI;
   |FINSI;
   #concept@#0 = #aovi0010#5;
   |LEE 000#concept@.=;
   |SI FSalida ! 0;
      |MENAV "    Concepto inexistente";
      |ERROR;
   |SINO;
      #aovi0010#6 = #concept@#1; |PINTA #aovi0010#6;
   |FINSI;
   |CIERRA #concept@; |DESCARGA_DEF #concept@;
|FPRC;

|PROCESO Codigo;
      |C_M #aovi0010#3, 1, "S"; |C_M #aovi0010#4, 1, "S";
      |C_M #aovi0010#5, 1, "S";
|FPRC;

|PROCESO MiraDiarios;
   nTecla = FSalida;

   |ABRE #aomparam;
   |LEE 000#aomparam.p;
   |SI FSalida ! 0;
      |MENAV "    No existe el control de parametros";
      |CIERRA #aomparam;
      |ERROR; |ACABA;
   |FINSI;
   |CIERRA #aomparam;

   aAlfa = #aomparam#12; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/camandia.mas";
   |CARGA_DEF aAlfa1, diarios@;
   |SI FSalida ! 0;
      |MENAV "    No encuentro el fichero de diarios";
      |ERROR; |ACABA;
   |SINO;
      aAlfa1 = aAlfa + "fich/" + (("00000" + #aovi0010#9) % -105) + #aovi0010#10 + "/";
      |PATH_DAT #1003#aAlfa1#;
   |FINSI;

   |ABRE #diarios@;
   |SI nTecla = 10;
      #diarios@#0 = #aovi0010#7;
      |LEE 000#diarios@.];
      |CONSULTA_CLAVE #1#diarios@;
      |SI FSalida = 0;
         #aovi0010#7 = #diarios@#0; |PINTA #aovi0010#7;
         #aovi0010#8 = #diarios@#1; |PINTA #aovi0010#8;
      |FINSI;
   |FINSI;
   #diarios@#0 = #aovi0010#7;
   |LEE 000#diarios@.=;
   |SI FSalida ! 0;
      |MENAV "    Diario inexistente";
      |ERROR;
   |SINO;
      #aovi0010#8 = #diarios@#1; |PINTA #aovi0010#8;
   |FINSI;
   |CIERRA #diarios@; |DESCARGA_DEF #diarios@;
|FPRC;

|PROCESO EmpresaConta;
     |SI FSalida = 2; |ACABA; |FINSI;

     #aovi0010#9  = #aovi0010#0;
     #aovi0010#10 = #aovi0010#1 - 2000;
     aAlfa1 = #aovi0010#1;
     aAlfa1 = aAlfa1 % -102;
     nEjer  = aAlfa1;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa1 = aAlfa + "def/canempre.mas";
     |CARGA_DEF aAlfa1, canempr@;
     |SI FSalida ! 0;
         |MENAV "    No encuentro el fichero de empresas";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa1 = aAlfa + "fich/";
     |PATH_DAT #1002#aAlfa1#;

     |ABRE #canempr@;
     |SELECT #4#canempr@;
     #canempr@#2  = #aovi0010#9;
     #canempr@#26 = nEjer;
     |LEE 000#canempr@.=;
     |SI FSalida ! 0;
         |MENAV "    Error. NO EXISTE EMPRESA CONTABLE";
         |ERROR;
     |SINO;
         #aovi0010#10 = #canempr@#3;
     |FINSI;
     |SELECT #1#canempr@;
     |CIERRA #canempr@;
     |DESCARGA_DEF #canempr@;
|FPRC;

|PROCESO MiraEmpresa;
   nTecla = FSalida;

   |ABRE #aomparam;
   |LEE 000#aomparam.p;
   |SI FSalida ! 0;
      |MENAV "    No existe el control de parametros";
      |CIERRA #aomparam;
      |ERROR; |ACABA;
   |FINSI;
   |CIERRA #aomparam;

   aAlfa = #aomparam#12; |QBF aAlfa;
   aAlfa = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa, canempr@;
   |SI FSalida = 0;
      aAlfa = #aomparam#12; |QBF aAlfa;
      aAlfa = aAlfa + "fich/"; |PATH_DAT #canempr@#aAlfa#;
      |ABRE #canempr@;
      |SI nTecla = 10;
         |CONSULTA_CLAVE #1#canempr@;
         |SI FSalida = 0;
            #aovi0010#9  = #canempr@#2;  |PINTA #aovi0010#9;
            #aovi0010#10 = #canempr@#3; |PINTA #aovi0010#10;
         |FINSI;
         |ERROR;
      |FINSI;
      |SI Campo = 86;
         #canempr@#2 = #aovi0010#9;
         #canempr@#3 = #aovi0010#10;
         |LEE 000#canempr@.=;
         |SI FSalida ! 0;
            |MENAV "    Empresa inexistente";
            |ERROR;
         |FINSI;
      |FINSI;
      |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
   |FINSI;
|FPRC;

|PROCESO Importe;
     nImporte = nImporte + #aovi0008#13;
|FPRC;

|DEFBUCLE Importe;
     #aovi0008#1;
     ;
     #0#0, #0#1, #0#2, 00001;
     #0#0, #0#1, #0#2, 99999;
     ;
     NULL, Importe;
|FIN;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
     numer = anynum $ 4;
     |SI numer = 0;
             bisiesto = 1;
     |SINO;
             bisiesto = 0;
     |FINSI;
     |SI mesnum =  1;  topemes = 31;            |FINSI;
     |SI mesnum =  2;  topemes = 28 + bisiesto; |FINSI;
     |SI mesnum =  3;  topemes = 31;            |FINSI;
     |SI mesnum =  4;  topemes = 30;            |FINSI;
     |SI mesnum =  5;  topemes = 31;            |FINSI;
     |SI mesnum =  6;  topemes = 30;            |FINSI;
     |SI mesnum =  7;  topemes = 31;            |FINSI;
     |SI mesnum =  8;  topemes = 31;            |FINSI;
     |SI mesnum =  9;  topemes = 30;            |FINSI;
     |SI mesnum = 10;  topemes = 31;            |FINSI;
     |SI mesnum = 11;  topemes = 30;            |FINSI;
     |SI mesnum = 12;  topemes = 31;            |FINSI;
|FPRC;

|PROCESO Asiento;
     nImporte = 0;
     |BUCLE Importe;
/*
     aCuenta = "";
     |ABRE #agifa024;
     #agifa024#0 = #gopre001#2;
     |LEE 000#agifa024.=;
     |SI FSalida = 0;
          aCodigoCli = #gopre001#2;
          aCuentaCli = #agifa024#16;
          |QBF aCuentaCli;
          |QBF aCodigoCli;
     |FINSI;
     |CIERRA #agifa024;
*/

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa = aAlfa + "def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlac@;
     |SI FSalida = 0;
          aAlfa = #aomparam#12; |QBF aAlfa;
          aAlfa = aAlfa + "def/caconasi.mas";
          |CARGA_DEF aAlfa, caconas@;
          |SI FSalida = 0;
               aAlfa = #aomparam#12; |QBF aAlfa;
               aAlfa = aAlfa + "def/camaasic.mas";
               |CARGA_DEF aAlfa, camasic@;
               |SI FSalida = 0;
                    aAlfa = #aomparam#12; |QBF aAlfa;
                    aAlfa = aAlfa + "fich/" + (("00000" + #0#9) % -105) + #0#10 + "/";
                    |PATH_DAT #caenlac@#aAlfa#; |PATH_DAT #camasic@#aAlfa#;
                    |PATH_DAT #caconas@#aAlfa#;
                    aAlfa = "pu" + Usuario; |QBF aAlfa; |NOME_DAT #caenlac@#aAlfa#;
                    |DELINDEX #caenlac@; |ABRE #caenlac@;
                    |ABRE #caconas@; |ABRE #camasic@;
                    ||ABRE #agifa722;

                    nSwError = 0;
/*
                    |SI #gocerlin#25 = "N";
                         #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
                         #agifa722#1 = #gocerlin#0;  || SERIE PRESUPUESTO
                         aAlfa = (("000000" + #gocerlin#1) % -106) + (("000" + #gocerlin#2) % -103);
                         #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
                         #agifa722#3 = #gocerlin#3;  || FECHA FACTURA
                         #agifa722#11 = 1;
                         #agifa722#8 = #goparame#85;
                         #agifa722#9 = #goparame#86;
                         |LEE 000#agifa722.=;
                         |SI FSalida = 0;
                              nDiario = #agifa722#4;
                              fFecha  = #agifa722#5;
                              nDocum  = #agifa722#6;
                              |BORRA 020#agifa722.a;

                              |DDEFECTO #caenlac@;
                              #caenlac@#37 = #agifa722#8;
                              #caenlac@#38 = #agifa722#9;
                              #caenlac@#0 = #agifa722#4;
                              #caenlac@#1 = #agifa722#5;
                              #caenlac@#2 = #agifa722#6;
                              #caenlac@#3 = 0;
                              #caenlac@#9 = 0;
                              #caenlac@#25 = "S";
                              |GRABA 020#caenlac@.n;
                         |SINO;
                              nSwError = 1;
                         |FINSI;
                    |SINO;
*/

                         mesnum = #0#2;
                         anynum = #0#1;
                         |HAZ ulti_dia;
                         aDia = topemes;
                         aDia = ("00" + aDia) % -102;

                         nMes = #0#2;
                         aMes = nMes;
                         aMes = ("00" + aMes) % -102;
                         nAny = #0#1;
                         aAny = nAny;

                         aFecha = aDia + "." + aMes + "." + aAny;
                         fFecha = aFecha;

                         nDiario = #0#7;

                         |LEE 101#caconas@.p;
                         |SI FSalida ! 0;
                              |DDEFECTO #caconas@;
                              |GRABA 020#caconas@.n;
                              |LEE 101#caconas@.p;
                         |FINSI;

                         #caconas@#1 = #caconas@#1 + 1;
                         aAlfa = "|NC"; nCalc = #caconas@#aAlfa#;
                         |SI nCalc > 2; #caconas@#2 = #caconas@#2 + 1; |FINSI;
                         nDocum = #caconas@#1;

                         |GRABA 020#caconas@.a;
                         |LIBERA #caconas@;

                         #camasic@#0 = nDiario;
                         #camasic@#1 = fFecha;
                         #camasic@#2 = nDocum;
                         |LEE 000#camasic@.=;
                         |SI FSalida = 0;
                              #camasic@#0 = nDiario;
                              #camasic@#1 = fFecha;
                              #camasic@#2 = 999999;
                              |LEE 000#camasic@.];
                              |SI FSalida = 0;
                                   |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                        nDocum = 1;
                                   |SINO;
                                        |LEE 000#camasic@.a;
                                        |SI FSalida = 0;
                                             |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                                  nDocum = #camasic@#2 + 1;
                                             |SINO;
                                                  nDocum = 1;
                                             |FINSI;
                                        |SINO;
                                             nDocum = 1;
                                        |FINSI;
                                   |FINSI;
                              |SINO;
                                   |LEE 000#camasic@.u;
                                   |SI FSalida = 0;
                                        |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                             nDocum = #camasic@#2 + 1;
                                        |SINO;
                                             nDocum = 1;
                                        |FINSI;
                                   |SINO;
                                        nDocum = 1;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
/*
                         |DDEFECTO #agifa722;
                         #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
                         #agifa722#1 = #gocerlin#0;  || SERIE PRESUPUESTO
                         aAlfa = (("000000" + #gocerlin#1) % -106) + (("000" + #gocerlin#2) % -103);
                         #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
                         #agifa722#3 = #gocerlin#3;  || FECHA FACTURA
                         #agifa722#11 = 1;
                         #agifa722#8 = #goparame#85;
                         #agifa722#9 = #goparame#86;
                         |LEE 000#agifa722.=;
                         |SI FSalida = 0;
                              nSwError = 1;
                         |SINO;
                              |DDEFECTO #agifa722;
                              #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
                              #agifa722#1 = #gocerlin#0;  || SERIE PRESUPUESTO
                              aAlfa = (("000000" + #gocerlin#1) % -106) + (("000" + #gocerlin#2) % -103);
                              #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
                              #agifa722#3 = #gocerlin#3;  || FECHA FACTURA
                              #agifa722#4 = nDiario;
                              #agifa722#5 = fFecha;
                              #agifa722#6 = nDocum;
                              #agifa722#7 = 10;
                              #agifa722#8 = #goparame#85;
                              #agifa722#9 = #goparame#86;
                              #agifa722#11 = 1;
                              |GRABA 020#agifa722.n;
*/
                              |DDEFECTO #caenlac@;
                              #caenlac@#0 = nDiario;
                              #caenlac@#1 = fFecha;
                              #caenlac@#2 = nDocum;
                              #caenlac@#3 = 10;

                              aAlfa = #0#3;
                              |QBF aAlfa;
                              aCuenta = aAlfa;
/*
                              aAlfa = #gocerenc#3;
                              |QBF aAlfa;
                              |SI aAlfa = "CLI";
                                   aCuenta = aCuentaCli;
                              |SINO;
                                   aAlfa = aAlfa % -103;
                                   |SI aAlfa = "COD";
                                        aAlfa = #gocerenc#3;
                                        |QBF aAlfa;
                                        aAlfa = aAlfa - "COD";
                                        aAlfa = aAlfa + aCodigoCli;
                                        aCuenta = aAlfa;
                                   |SINO;
                                        aCuenta = #gocerenc#3;
                                   |FINSI;
                              |FINSI;
*/

                              #caenlac@#4 = aCuenta;

                              #caenlac@#5 = 0;
                              #caenlac@#6 = #0#5;
                              aAlfa = #0#6; |QBF aAlfa;
                              #caenlac@#7 = aAlfa;
                              #caenlac@#8 = "D";
                              #caenlac@#9 = nImporte;      || importe
                              |GRABA 020#caenlac@.n;

                              |DDEFECTO #caenlac@;
                              #caenlac@#0 = nDiario;
                              #caenlac@#1 = fFecha;
                              #caenlac@#2 = nDocum;
                              #caenlac@#3 = 20;

                              aAlfa = #0#4;
                              |QBF aAlfa;
/*
                              |SI aAlfa = "CLI";
                                   aCuenta = aCuentaCli;
                              |SINO;
                                   aAlfa = aAlfa % -103;
                                   |SI aAlfa = "COD";
                                        aAlfa = #gocerenc#4;
                                        |QBF aAlfa;
                                        aAlfa = aAlfa - "COD";
                                        aAlfa = aAlfa + aCodigoCli;
                                        aCuenta = aAlfa;
                                   |SINO;
                                        aCuenta = #gocerenc#4;
                                   |FINSI;
                              |FINSI;
*/
                              aCuenta = aAlfa;
                              #caenlac@#4 = aCuenta;

                              #caenlac@#5 = 0;
                              #caenlac@#6 = #0#5;
                              aAlfa = #0#6; |QBF aAlfa;
/*
                              |SI #gocerenc#9  = "S";
                                   aAlfa = aAlfa + " " + #gocerlin#0; |QBF aAlfa;
                                   aAlfa1 = #gocerlin#1; aAlfa1 = "000000" + aAlfa1; aAlfa1 = aAlfa1 % -106;
                                   aAlfa = aAlfa + " " + aAlfa1;
                                   aAlfa1 = #gocerlin#2; aAlfa1 = "000" + aAlfa1; aAlfa1 = aAlfa1 % -103;
                                   aAlfa = aAlfa + " " + aAlfa1;
                              |FINSI;
                              ||SI #gotipoho#10 = "S"; aAlfa = aAlfa + " " + #gopaexca#1; |QBF aAlfa; |FINSI;
*/
                              #caenlac@#7 = aAlfa;
                              #caenlac@#8 = "H";
                              #caenlac@#9 = nImporte;      || importe
                              |GRABA 020#caenlac@.n;
                         |FINSI;
                    |FINSI;

                    |SI nSwError = 0;
                         aAlfa = #aomparam#12; |QBF aAlfa;
                         aAlfa = aAlfa + "fich/" + (("00000" + #0#9) % -105) + #0#10 + "/";
                         fich_alta = aAlfa;
                         aAlfa1 = #aomparam#12; |QBF aAlfa1;
                         aAlfa1 = aAlfa1 - "contagen";
                         |SI FSalida ! 0;
                              aAlfa1 = ":contagen/dsapunte.tab;";
                         |SINO;
                              aAlfa1 = ":agicont/dsapunte.tab;";
                         |FINSI;
                         enNoModif = 100;
                         aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;

                         |CIERRA #caenlac@;
                         |SUB_EJECUTA_NP aAlfa;
                         |ABRE #caenlac@; |LEE 000#caenlac@.c;
                    ||FINSI;
                    ||CIERRA #agifa722;
                    |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
                    |CIERRA #caconas@; |DESCARGA_DEF #caconas@;
                    |CIERRA #caenlac@; |DELINDEX #caenlac@; |DESCARGA_DEF #caenlac@;
               |FINSI;
          |FINSI;
     ||SINO;
          || CIERRA #goparame; |CIERRA #gocerenc; |ACABA;
     ||FINSI;

     || CIERRA #gocerenc; |CIERRA #goparame;
|FPRC;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |LEE 000#0p;
     FEstado = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          #0#9 = #0#0;        || EMPRESA CONTAGEN LA MISMA QUE EN NOMINAS
          aAlfa = #0#1;
          |QBF aAlfa;
          aAlfa = aAlfa % -101;
          nNume = aAlfa;
          #0#10 = nNume;      || PERIODO EL ULTIMO DIGITO DEL A¤O

          || AQUI EL ENLACE
          |HAZ Asiento;
     |FINSI;
     |SI FEstado = 0;
          |GRABA 000#0a;
     |SINO;
          |GRABA 000#0n;
     |FINSI;
|FPRO;
