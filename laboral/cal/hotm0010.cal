|FICHEROS;
     hotm0009 #0;
     hotm0010 #1;
|FIN;

|VARIABLES;
     Flag = 0;
     Calc = 0;
     UltLinea = 0;
     LineaAct = 0;
     ModoEntrada = 0;
     bisiesto = 0;
     topemes = 0;
     numer = 0;
     mesnum = 0;
     nTotalDias = 0;
|FIN;

|PROCESO RecalcProrrata;
     UltLinea = #hotm0010#4;
     #hotm0010#11 = #hotm0010#12 / #hotm0009#5;
     #hotm0009#6 = #hotm0009#6 + #hotm0010#11;
     |GRABA 020#hotm0010.a;
     nTotalDias = nTotalDias + #hotm0010#12;
|FPRC;

|DEFBUCLE RecalcProrrata;
     #hotm0010#1;
     ;
     #hotm0009#0, #hotm0009#1, #hotm0009#2, #hotm0009#3, 001;
     #hotm0009#0, #hotm0009#1, #hotm0009#2, #hotm0009#3, 999;
     ;
     NULL,RecalcProrrata;
|FIN;

|PROCESO Aviso;
     |SI nTotalDias > topemes
          |COLOR 7,4;
          |ATRI I;
          |PINTA 0772, "ATENCION";
          |COLOR 7,1;
          |PINTA 0872, "Excedido";
          |PINTA 0972, " limite ";
          |PINTA 1072, "dias mes";
          |COLOR 7,0;
          |ATRI 0;
     |SINO;
          |PINTA 0772, "        ";
          |PINTA 0872, "        ";
          |PINTA 0972, "        ";
          |PINTA 1072, "        ";
     |FINSI;
|FPRC;

|PROCESO Acumula; |TIPO 2;
     ModoEntrada = (FEntrada / 100) ! 0;
     Flag = 0+.1;
     #hotm0009#5 = #hotm0009#5 +. #hotm0010#12;
     |SI Flag > 0;
          #hotm0009#6 = 0;
          |SI ModoEntrada = 1;
               |GRABA 020#hotm0010.b;
          |SINO;
               |GRABA 020#hotm0010.a;
          |FINSI;
          LineaAct = #hotm0010#4;
          nTotalDias = 0;
          |BUCLE RecalcProrrata;
          |SI #hotm0009#6 < 1;
               Calc = 1 - #hotm0009#6;
               #hotm0010#0 = #hotm0009#0;
               #hotm0010#1 = #hotm0009#1;
               #hotm0010#2 = #hotm0009#2;
               #hotm0010#3 = #hotm0009#3;
               #hotm0010#4 = UltLinea;
               |LEE 000#hotm0010.=;
               |SI FSalida = 0;
                    #hotm0010#11 = #hotm0010#11 + Calc;
                    |GRABA 020#hotm0010.a;
                    #hotm0009#6 = 1;
               |FINSI;
          |FINSI;
          #hotm0010#0 = #hotm0009#0;
          #hotm0010#1 = #hotm0009#1;
          #hotm0010#2 = #hotm0009#2;
          #hotm0010#3 = #hotm0009#3;
          #hotm0010#4 = LineaAct;
          |LEE 000#hotm0010.=;
          |PONCONTROL 23,"si"; |PTEC 815;
     |SINO;
          #hotm0009#6 = #hotm0009#6 +. #hotm0010#11;
     |FINSI;
     |PINTA #hotm0009#6;
     #hotm0009#4 = #hotm0009#6;
     |PINTA #hotm0009#4;

     |HAZ UltimoDia;
     |HAZ Aviso;
|FPRC;

|PROCESO Calcula;
     |SI #1#13 ! 0; |Y #1#14 ! 0;
          #1#12 = #1#14 - #1#13 + 1;
     |FINSI;
     |SI #1#12 ! 0;
          |C_M #1#11,1,"N";
          || #hotm0010#11 = #hotm0010#12 / #hotm0009#5;
          #hotm0010#11 = #hotm0010#12 / (#hotm0009#5 + #hotm0010#12);
          |PINTA #1#11;
     |SINO;
          #1#11 = 1 - #0#4; |PINTA #1#11;
          |C_M #1#11,1,"S";
     |FINSI;
|FPRC;

|PROCESO UltimoDia;
     bisiesto = 0;
     numer = #1#2 $ 4;
     |SI numer = 0;
          bisiesto = 1;
     |FINSI;
     topemes = 31;
     mesnum = #1#3;
     |SI mesnum= 2;
          topemes = 28 + bisiesto;
     |FINSI;
     |SI mesnum= 4;|O mesnum= 6;|O mesnum= 9;|O mesnum=11;
          topemes = 30;
     |FINSI;
|FPRC;

|PROCESO Verifica1;
     |HAZ UltimoDia;
     |SI #1Campo > topemes;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Verifica2;
     |SI #1#14 < #1#13;
          |MENAV "    ATENCION: Dia Hasta no puede ser menor que Dia Desde";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO DiaCero;
     |SI #1#13 = 0;
          #1#14 = 0;
          |PINTA #1#14;
          |CAMPO_MODIFICA #1#14, 1, "N";
          |CAMPO_MODIFICA #1#12, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #1#14, 1, "S";
          |CAMPO_MODIFICA #1#12, 1, "N";
     |FINSI;
|FPRC;
