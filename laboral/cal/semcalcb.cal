|FICHEROS;
   semcalcb #0;
   semcalcl #1;
   semcntcu;
|FIN;

|VARIABLES;
   ModoEntrada = 0;
   &enEmpre = 0;
   &enTraba = 0;
   &enAnyo = 0;
   &enSemana = 0;
   &enTipo = 0;
     sdia = 0;
     smas = 0;
     sdife = 0;
     srest = 0;
     alfa1 = "";
     alfa2 = "";
     nume1 = 0;
     nume2 = 0;
     fech1 = @;
     fech2 = @;
     aAlfa1 = "";
     fFech1 = @;
|FIN;

|PROCESO BorraLineas;
   |BORRA 020#semcalcl.a;
|FPRC;

|DEFBUCLE BorraLineas;
#semcalcl#1;
;
#semcalcb#0,#semcalcb#1,#semcalcb#2,#semcalcb#3,#semcalcb#4,#semcalcb#5,001;
#semcalcb#0,#semcalcb#1,#semcalcb#2,#semcalcb#3,#semcalcb#4,#semcalcb#5,999;
;
NULL,BorraLineas;
|FIN;

|PROCESO BajaLineas; |TIPO 1;
   |ABRE #semcalcl;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3; |BUCLE BorraLineas; |FINSI;
   |CIERRA #semcalcl;
|FPRC;

|PROCESO Tipo4; |TIPO 4;
     enEmpre = #semcalcb#3;
     enTraba = #semcalcb#4;
     enAnyo = #semcalcb#0;
     enSemana = #semcalcb#1;
     enTipo = #semcalcb#5;
     |SUB_EJECUTA "sememrec";
|FPRC;

|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO mirasem; |TIPO 7;
     alfa1 = #0#0;
     alfa1 = "01.01." + alfa1;
     fech1 = alfa1;            || primero saca el dia de la semana
     fech2 = fech1 % 1;        ||/que fue el uno de enero
     alfa1 = fech2 % 11;

     |SI alfa1 = "Lunes";     sdia=1; smas=1; |FINSI;
     |SI alfa1 = "Martes";    sdia=7; smas=1; |FINSI;
     |SI alfa1 = "Miercoles"; sdia=6; smas=1; |FINSI;
     |SI alfa1 = "Jueves";    sdia=5; smas=1; |FINSI; ||saca el dia del mes que fue
     |SI alfa1 = "Viernes";   sdia=4; smas=1; |FINSI; ||el primer lunes del a¤o
     |SI alfa1 = "Sabado";    sdia=3; smas=1; |FINSI;
     |SI alfa1 = "Domingo";   sdia=2; smas=1; |FINSI;

     alfa1 = ("00" + sdia) % -102;  || construye el primer lunes del a¤o
     fech1 = ~;                     ||/como fecha inicial de calculo
     alfa2 = fech1 % -104;
     alfa1 = alfa1 + ".01." + alfa2;
     fech1 = alfa1;
     nume1 = fech1;                 || calcula dias hasta primer lunes a¤o

     fech1 = ~;                     || calcula dias hasta fecha actual
     nume2 = fech1;

     sdife = nume2 - nume1;         || calcula la diferencia desde el primer
     |SI sdife ] 0;
          srest = sdife $ 7;           || lunes hasta la fecha actual,la redondea,
          sdife = sdife + (7 - srest); || la divide por 7 y le suma 1 por la
          #0Campo = (sdife / 7) + smas;|| primera semana (en su caso !!!)
     |SINO;
          #0Campo = 1;
     |FINSI;

     |ABRE #semcntcu;
     |LEE 000#semcntcu.p;
     |CIERRA #semcntcu;

     #0Campo = #0Campo - #semcntcu#3;
     |SI #0Campo = 0; #0Campo = 52; |FINSI;

     |PINTA #0Campo;
|FPRC;

|PROCESO Mirames; |TIPO 7;    || calcula el mes por defecto segun sistema
     fech1 = ~;
     alfa1 = fech1;
     alfa1 = alfa1 % 402;
     #0Campo = alfa1;
     |PINTA #0Campo;
|FPRC;
