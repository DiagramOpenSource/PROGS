|| GENERACION DE RESUMENES DE NOMINA EN XML

|FICHEROS;
     nomyrenm #0;
     nomyrpac #0;
     labempre;
     labtraba;
     labcentr;
     nomtmpre #200;
     nomtmprf #202;
     nomtmpr0;
     nomtmpr1;
     nomcontr;
     labcontr;

     nomconca;
|FIN;

|VARIABLES;
     nLinea = 0;
     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;
     aRaizMacro = "";
     nMes = 0;
     aMes = "";
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";
     aValor = "";
     aMeses = "";
     fFecha = @;
     aFecha = "";
     aHora = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     {1}aVersion = "";
     aPath = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     aCaracter = "";
     nCaracter = 0;

     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
     nTotTotC15 = 0;
     nTotTotC16 = 0;
     nTotTotC17 = 0;
     nAntEmp = 0;
     nAntCen = 0;
     nAntTra = 0;
     nAntAny = 0;
     nNume = 0;
     aHoja = "";
     nHoja = 0;
     &month = 0;
     aNombreMacro = "";
     swHaEntrado = 0;
     aDesdeTra = "                                        ";
     aHastaTra = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";

     &enTipoInf = 0;
     &eaFuente = "";
     &enDesdeMes = 0;
     &enHastaMes = 0;
     &enAny = 0;
     &nOrdenEmp = 0;
     &nOrdenTra = 0;
     &informe = "";
     &enCuadre = 0;
     &nPara = 0;
     &nTipoD = 0;
     &nTipoH = 0;
     swHayAlgo = 0;
     &aNomPag = "";
     swPorAqui = 0;
     nTotInf = 0;
     nTipo = 0;
     swNomFinSep = 0;
     &nUnoTipo2 = 0;
     &nRegistro = 0;
     &fFechaEmision = @;
     &aHoraEmision = "";
     nCampo = 0;
     aUsuario = "";
     &swPagasSN = 0;

     nTotAreaC4 = 0;
     nTotAreaC5 = 0;
     nTotAreaC6 = 0;
     nTotAreaC7 = 0;
     nTotAreaC9 = 0;
     nTotAreaC10 = 0;
     nTotAreaC11 = 0;
     nTotAreaC12 = 0;
     nTotAreaC13 = 0;
     nTotAreaC14 = 0;
     nTotAreaC15 = 0;
     nTotAreaC16 = 0;
     nTotAreaC17 = 0;

     nTotTrabC4 = 0;
     nTotTrabC5 = 0;
     nTotTrabC6 = 0;
     nTotTrabC7 = 0;
     nTotTrabC9 = 0;
     nTotTrabC10 = 0;
     nTotTrabC11 = 0;
     nTotTrabC12 = 0;
     nTotTrabC13 = 0;
     nTotTrabC14 = 0;
     nTotTrabC15 = 0;
     nTotTrabC16 = 0;
     nTotTrabC17 = 0;

     aAntArea = "";
     aAntDesArea = "";
     aArea = "";
     &aRupAreas = "";
     nMesDesde = 0;
     nMesHasta = 0;
     &swDesglose = 0;
     aCelda = "";
     nCol = 0;
     &aCadena = "";
     nNivel = 0;
     nHandle = 0;
     aCen = "";
     aRutaXML = "";
     aRuta = "";
     aEmp = "";
     aFichero = "";
     aXMLDesdeMes = "";
     aXMLHastaMes = "";
     aXMLDesdeAny = "";
     aXMLHastaAny = "";
     aXMLFuente = "";
     aXMLOrdenTra = "";

     &swQuitaTildes = 0;
     nFicheros = 0;
     nImporteTC1 = 0;
     swSigue = 0;

     nRestaProrrata = 0;
     aIP = "";
|FIN;

|PROCESO nomtmpreXML;
     swHayAlgo = 1;

     |PRINT;
|FPRC;

|DEFBUCLE nomtmpre_meses;
     #200#1;
     ;
     00001, 001, "    ", 00001, 1999, enDesdeMes, nTipoD;
     99999, 999, "zzzz", 99999, 2999, enHastaMes, nTipoH;
     ;
     NULL, nomtmpreXML;
|FIN;

|DEFBUCLE nomtmpre;
     #200#1;
     ;
     00001, 001, "    ", 00001, 1999, nMesDesde, nTipoD;
     99999, 999, "zzzz", 99999, 2999, nMesHasta, nTipoH;
     ;
     NULL, nomtmpreXML;
|FIN;

|PROCESO Linea;
     |QBF aAlfa;
     aCadena = aAlfa;
     swQuitaTildes = 1;
     |HAZ QuitaRaros;
     |SI nNivel = 1;
          aCadena = aCadena;
     |FINSI;
     |SI nNivel = 2;
          aCadena = "  " + aCadena;
     |FINSI;
     |SI nNivel = 3;
          aCadena = "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 4;
          aCadena = "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 5;
          aCadena = "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 6;
          aCadena = "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     aCadena = aCadena + &13 + &10;
     aAlfa = aCadena;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Numero;
     |SI aAlfa = "0"; aAlfa = "0.00"; |FINSI;
     |SI aAlfa ! "";
          aAlfa1 = aAlfa % -301;
          |SI aAlfa1 ! ".";
               aAlfa1 = aAlfa % -201;
               |SI aAlfa1 ! ".";
                    aAlfa = aAlfa + ".00";
               |SINO;
                    aAlfa = aAlfa + "0";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Numero4;
     |SI aAlfa = "0";
          aAlfa = "0.0000";
          |ACABA;
     |FINSI;
     |SI aAlfa ! "";
          aAlfa1 = aAlfa % -501;
          |SI aAlfa1 = ".";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -401;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "0";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -301;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "00";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -201;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "000";
               |ACABA;
          |FINSI;
          aAlfa = aAlfa + ".0000";
     |FINSI;
|FPRC;

|PROCESO Numero6;
     |SI aAlfa = "0";
          aAlfa = "0.000000";
          |ACABA;
     |FINSI;
     |SI aAlfa ! "";
          aAlfa1 = aAlfa % -701;
          |SI aAlfa1 = ".";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -601;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "0";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -501;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "00";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -401;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "000";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -301;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "0000";
               |ACABA;
          |FINSI;
          aAlfa1 = aAlfa % -201;
          |SI aAlfa1 = ".";
               aAlfa = aAlfa + "00000";
               |ACABA;
          |FINSI;
          aAlfa = aAlfa + ".000000";
     |FINSI;
|FPRC;

/*
|| no deberia estar, borrar si se ve que vale

|PROCESO TotalEmp;
     nNivel = 2;
     aAlfa = "<TOTALES_CENTRO>";
     |HAZ Linea;

     nNivel = 4;
     aAlfa = nTotC4; |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<PRESTACIONES>" + aAlfa + "</PRESTACIONES>";
     |HAZ Linea;

     aAlfa = nTotC5;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<COSTE_TRABAJADOR>" + aAlfa + "</COSTE_TRABAJADOR>";
     |HAZ Linea;

     aAlfa = nTotC6;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_BRUTO>" + aAlfa + "</IMPORTE_BRUTO>";
     |HAZ Linea;

     aAlfa = nTotC7;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<DESCUENTOS>" + aAlfa + "</DESCUENTOS>";
     |HAZ Linea;

     aAlfa = nTotC9;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_RETENCION_IRPF>" + aAlfa + "</IMPORTE_RETENCION_IRPF>";
     |HAZ Linea;

     aAlfa = nTotC10;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BASES_EXENTAS>" + aAlfa + "</BASES_EXENTAS>";
     |HAZ Linea;

     aAlfa = nTotC11;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_TRABAJADOR>" + aAlfa + "</SS_TRABAJADOR>";
     |HAZ Linea;

     aAlfa = nTotC12;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<LIQUIDO>" + aAlfa + "</LIQUIDO>";
     |HAZ Linea;

     aAlfa = nTotC13;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_EMPRESA>" + aAlfa + "</SS_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotC14;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BONIFICACIONES>" + aAlfa + "</BONIFICACIONES>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = "</TOTALES_CENTRO>";
     |HAZ Linea;

     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
|FPRC;
*/
|PROCESO TotalesEmp;
     nNivel = 2;
     aAlfa = "<TOTALES_EMPRESA>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = nTotTotC4; |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<PRESTACIONES_EMPRESA>" + aAlfa + "</PRESTACIONES_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC5;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<COSTE_TRABAJADOR_EMPRESA>" + aAlfa + "</COSTE_TRABAJADOR_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC6;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_BRUTO_EMPRESA>" + aAlfa + "</IMPORTE_BRUTO_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC7;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<DESCUENTOS_EMPRESA>" + aAlfa + "</DESCUENTOS_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC9;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_RETENCION_IRPF_EMPRESA>" + aAlfa + "</IMPORTE_RETENCION_IRPF_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC10;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BASES_EXENTAS_EMPRESA>" + aAlfa + "</BASES_EXENTAS_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC11;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_TRABAJADOR_EMPRESA>" + aAlfa + "</SS_TRABAJADOR_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC12;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<LIQUIDO_EMPRESA>" + aAlfa + "</LIQUIDO_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC13;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_EMPRESA_EMPRESA>" + aAlfa + "</SS_EMPRESA_EMPRESA>";
     |HAZ Linea;

     aAlfa = nTotTotC14;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BONIFICACIONES_EMPRESA>" + aAlfa + "</BONIFICACIONES_EMPRESA>";
     |HAZ Linea;

     nTotInf = nTotTotC13 +  nTotTotC11 - nTotTotC4;
     ||HAZ Totales3XML;
     aAlfa = nTotInf;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_TC1_CALCULADO>" + aAlfa + "</IMPORTE_TC1_CALCULADO>";
     |HAZ Linea;

     nNivel = 2;
     aAlfa = "</TOTALES_EMPRESA>";
     |HAZ Linea;

     nNivel = 1;
     aAlfa = "</EMPRESA>";
     |HAZ Linea;

     nFicheros = nFicheros + 1;

     |XCIERRA  nHandle;

     |IP_REMOTO aIP;
     |SI aIP ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |FBORRA aOrigen;

     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
|FPRC;

|PROCESO TotalesCen;
     nNivel = 3;
     aAlfa = "<TOTALES_CENTRO>";
     |HAZ Linea;

     nNivel = 4;
     aAlfa = nTotC4; |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<PRESTACIONES_CENTRO>" + aAlfa + "</PRESTACIONES_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC5;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<COSTE_TRABAJADOR_CENTRO>" + aAlfa + "</COSTE_TRABAJADOR_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC6;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_BRUTO_CENTRO>" + aAlfa + "</IMPORTE_BRUTO_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC7;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<DESCUENTOS_CENTRO>" + aAlfa + "</DESCUENTOS_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC9;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_RETENCION_IRPF_CENTRO>" + aAlfa + "</IMPORTE_RETENCION_IRPF_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC10;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BASES_EXENTAS_CENTRO>" + aAlfa + "</BASES_EXENTAS_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC11;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_TRABAJADOR_CENTRO>" + aAlfa + "</SS_TRABAJADOR_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC12;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<LIQUIDO_CENTRO>" + aAlfa + "</LIQUIDO_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC13;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_EMPRESA_CENTRO>" + aAlfa + "</SS_EMPRESA_CENTRO>";
     |HAZ Linea;

     aAlfa = nTotC14;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BONIFICACIONES_CENTRO>" + aAlfa + "</BONIFICACIONES_CENTRO>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = "</TOTALES_CENTRO>";
     |HAZ Linea;

     nNivel = 2;
     aAlfa = "</CENTRO>";
     |HAZ Linea;

     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
|FPRC;

|PROCESO Conceptos;
     |SI #202#7 = 431;
          #202#10 = #202#10 * (-1);
          #202#11 = #202#11 * (-1);
     |FINSI;
/*
     || esto ya no, lo quito en el propio calculo del resumen, para todos
     || 18.04.2018

     |SI #202#7 ] 201; |Y #202#7 [ 208;
          |SI #202#45 = "P";
               nRestaProrrata = nRestaProrrata + #202#11;
          |FINSI;
     |FINSI;
*/
     nNivel = 5;
     aAlfa = "<CONCEPTO>";
     |HAZ Linea;

     nNivel = 6;
     aAlfa = #202#7;
     aAlfa = "<CODIGO_CONCEPTO>" + aAlfa + "</CODIGO_CONCEPTO>";
     |HAZ Linea;

     aAlfa = #202#8;
     |QBF aAlfa;
     aAlfa = "<DESCRIPCION_CONCEPTO>" + aAlfa + "</DESCRIPCION_CONCEPTO>";
     |HAZ Linea;

     aAlfa = #202#9;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<UNIDADES_CONCEPTO>" + aAlfa + "</UNIDADES_CONCEPTO>";
     |HAZ Linea;

     aAlfa = #202#10;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<VALOR_CONCEPTO>" + aAlfa + "</VALOR_CONCEPTO>";
     |HAZ Linea;

     aAlfa = #202#11;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_CONCEPTO>" + aAlfa + "</IMPORTE_CONCEPTO>";
     |HAZ Linea;

     nNivel = 5;
     aAlfa = "</CONCEPTO>";
     |HAZ Linea;
|FPRC;

|DEFBUCLE Conceptos;
     #202#1;
     ;
     || #200#0, #200#2, #200#21, #200#1, #200#41, #200#19, #200#23, 001;
     || #200#0, #200#2, #200#21, #200#1, #200#41, #200#19, #200#23, 499;
     || en atrasos desde historico
     || los conceptos se graban en el ultimo mes en que haya atrasos
     || bueno en verdad deberian grabarse en el mes "1" o el que grabe los
     || totales, pero da igual, cambio el bucle y ya esta, no deberia afectar
     || al resto de tipos 01.01.18 - 2884.3985
     #200#0, #200#2, #200#21, #200#1, #200#41, nMesDesde, #200#23, 001;
     #200#0, #200#2, #200#21, #200#1, #200#41, nMesHasta, #200#23, 499;
     ;
     NULL, Conceptos;
|FIN;

|PROCESO Conceptos600;
     |SI #202#11 = 0;
          #202#9 = 0;         || UNIDADES
          #202#10 = 0;        || VALOR
     |SINO;
          #202#9 = 1;
          #202#10 = 1;
     |FINSI;

     swSigue = 1;

     /*
     || Han de aparecer todos los conceptos, en todos los tipos de nomina
     || siempre, segun las ultimas indicaciones 002884.02591

     swSigue = 0;
     |SI #202#7 = 615;
          |SI aNomPag = "P"; |O swPagasSN = 2;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI #202#7 = 612;
          |SI aNomPag = "N";
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI #202#7 ! 612; |Y #202#7 ! 615;
          swSigue = 1;
     |FINSI;
     */

     |SI swSigue = 1;
          |HAZ Conceptos;
     |FINSI;
|FPRC;

|PROCESO OtrosConceptos;
     #202#7 = 601;                          || CODIGO
     #202#8 = "S.S. EMPRESA";               || DESCRIPCION
     #202#11 = #200#17;                     || IMPORTE
     |HAZ Conceptos600;

     #202#7 = 602;
     #202#8 = "S.S. TRABAJADOR";
     #202#11 = #200#14;
     |HAZ Conceptos600;

     #202#7 = 603;
     #202#8 = "PRORRATA PAGAS";
     #202#11 = #200#32 - nRestaProrrata;
     |HAZ Conceptos600;

     #202#7 = 604;
     #202#8 = "BONIFICACIONES";
     #202#11 = #200#16;
     |HAZ Conceptos600;

     #202#7 = 611;
     #202#8 = "DEDUCCION IRPF";
     #202#11 = #200#12;
     |HAZ Conceptos600;

     #202#7 = 612;
     #202#8 = "ANTICIPOS";
     #202#11 = #200#24;
     |HAZ Conceptos600;

     #202#7 = 613;
     #202#8 = "EMBARGO DE SALARIO";
     #202#11 = #200#29 + #200#26;  || embargos + anticipo 3
     |HAZ Conceptos600;

     #202#7 = 614;
     #202#8 = "DESCUENTO ADESLAS";
     #202#11 = #200#25;            || anticipo 2
     |HAZ Conceptos600;

     #202#7 = 615;
     #202#8 = "ANTICIPOS PAGA EXTRA";
     #202#11 = #200#27;
     |HAZ Conceptos600;

     #202#7 = 621;
     #202#8 = "PRESTACIONES ENFERMEDAD S.S.";
     #202#11 = #200#46;
     |HAZ Conceptos600;

     #202#7 = 622;
     #202#8 = "PRESTACIONES ENFERMEDAD EMPRESA";
     #202#11 = #200#47;
     |HAZ Conceptos600;

     #202#7 = 623;
     #202#8 = "COMPLEMENTO ENFERMEDAD";
     #202#11 = #200#48;
     |HAZ Conceptos600;

     #202#7 = 624;
     #202#8 = "PRESTACIONES ACCIDENTE S.S.";
     #202#11 = #200#49;
     |HAZ Conceptos600;

     #202#7 = 625;
     #202#8 = "COMPLEMENTO ACCIDENTE";
     #202#11 = #200#50;
     |HAZ Conceptos600;
|FPRC;

|PROCESO Trabajador;
     nNivel = 3;
     aAlfa = "<TRABAJADOR>";
     |HAZ Linea;

     nNivel = 4;

     #labtraba#0 = #200#0;
     #labtraba#1 = #200#1;
     |LEE 000#labtraba.=;

     aAlfa = #200#1;
     |QBF aAlfa;
     aAlfa = ("00000" + aAlfa) % -105;
     aAlfa = "<CODIGO_TRAB>" + aAlfa + "</CODIGO_TRAB>";
     |HAZ Linea;

     aAlfa = #200#5;
     |QBF aAlfa;
     aAlfa = "<NOMBRE_TRAB>" + aAlfa + "</NOMBRE_TRAB>";
     |HAZ Linea;

     aAlfa = #200#3;
     |QBF aAlfa;
     aAlfa = "<NIF_TRAB>" + aAlfa + "</NIF_TRAB>";
     |HAZ Linea;

     aAlfa = #labtraba#75;
     |QBF aAlfa;
     aAlfa = "<NUMERO_AFILIACION_TRAB>" + aAlfa + "</NUMERO_AFILIACION_TRAB>";
     |HAZ Linea;

     aAlfa = #200#51;
     |QBF aAlfa;
     aAlfa = "<DIAS_ALTA>" + aAlfa + "</DIAS_ALTA>";
     |HAZ Linea;

     aAlfa = #200#7;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<PRESTACIONES_TRAB>" + aAlfa + "</PRESTACIONES_TRAB>";
     |HAZ Linea;

     aAlfa = #200#8;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<COSTE_TRABAJADOR_TRAB>" + aAlfa + "</COSTE_TRABAJADOR_TRAB>";
     |HAZ Linea;

     aAlfa = #200#9;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_BRUTO_TRAB>" + aAlfa + "</IMPORTE_BRUTO_TRAB>";
     |HAZ Linea;

     nNivel = 4;
     aAlfa = "<CONCEPTOS>";
     |HAZ Linea;

     nRestaProrrata = 0;
     |BUCLE Conceptos;
     |HAZ OtrosConceptos;

     nNivel = 4;
     aAlfa = "</CONCEPTOS>";
     |HAZ Linea;


     aAlfa = #200#10;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<DESCUENTOS_TRAB>" + aAlfa + "</DESCUENTOS_TRAB>";
     |HAZ Linea;

     aAlfa = #200#11;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<PORC_RETENCION_IRPF_TRAB>" + aAlfa + "</PORC_RETENCION_IRPF_TRAB>";
     |HAZ Linea;

/*     aAlfa = #200#12;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<IMPORTE_RETENCION_IRPF_TRAB>" + aAlfa + "</IMPORTE_RETENCION_IRPF_TRAB>";
     |HAZ Linea;
*/

     aAlfa = #200#18;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BASES_EXENTAS_TRAB>" + aAlfa + "</BASES_EXENTAS_TRAB>";
     |HAZ Linea;
/*
     aAlfa = #200#14;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_TRABAJADOR_TRAB>" + aAlfa + "</SS_TRABAJADOR_TRAB>";
     |HAZ Linea;
*/
     aAlfa = #200#15;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<LIQUIDO_TRAB>" + aAlfa + "</LIQUIDO_TRAB>";
     |HAZ Linea;
/*
     aAlfa = #200#17;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<SS_EMPRESA_TRAB>" + aAlfa + "</SS_EMPRESA_TRAB>";
     |HAZ Linea;
*/
/*
     aAlfa = #200#16;
     |QBF aAlfa;
     |HAZ Numero;
     aAlfa = "<BONIFICACIONES_TRAB>" + aAlfa + "</BONIFICACIONES_TRAB>";
     |HAZ Linea;
*/
     nNivel = 3;
     aAlfa = "</TRABAJADOR>";
     |HAZ Linea;


     || TOTALES POR CENTRO

     nTotC4 = nTotC4 + #200#7;
     nTotC5 = nTotC5 + #200#8;
     nTotC6 = nTotC6 + #200#9;
     nTotC7 = nTotC7 + #200#10;
     nTotC9 = nTotC9 + #200#12;
     nTotC10 = nTotC10 + #200#18;
     nTotC11 = nTotC11 + #200#14;
     nTotC12 = nTotC12 + #200#15;
     nTotC13 = nTotC13 + #200#17;
     nTotC14 = nTotC14 + #200#16;
     nTotC15 = nTotC15 + #200#32;
     nTotC16 = nTotC16 + #200#34;
     nTotC17 = nTotC17 + #200#35;

     || TOTALES POR EMPRESA

     nTotTotC4 = nTotTotC4 + #200#7;
     nTotTotC5 = nTotTotC5 + #200#8;
     nTotTotC6 = nTotTotC6 + #200#9;
     nTotTotC7 = nTotTotC7 + #200#10;
     nTotTotC9 = nTotTotC9 + #200#12;
     nTotTotC10 = nTotTotC10 + #200#18;
     nTotTotC11 = nTotTotC11 + #200#14;
     nTotTotC12 = nTotTotC12 + #200#15;
     nTotTotC13 = nTotTotC13 + #200#17;
     nTotTotC14 = nTotTotC14 + #200#16;
     nTotTotC15 = nTotTotC15 + #200#32;
     nTotTotC16 = nTotTotC16 + #200#34;
     nTotTotC17 = nTotTotC17 + #200#35;
/*
     Estos totales no los usare de momento

     nTotAreaC4 = nTotAreaC4 + #200#7;
     nTotAreaC5 = nTotAreaC5 + #200#8;
     nTotAreaC6 = nTotAreaC6 + #200#9;
     nTotAreaC7 = nTotAreaC7 + #200#10;
     nTotAreaC9 = nTotAreaC9 + #200#12;
     nTotAreaC10 = nTotAreaC10 + #200#18;
     nTotAreaC11 = nTotAreaC11 + #200#14;
     nTotAreaC12 = nTotAreaC12 + #200#15;
     nTotAreaC13 = nTotAreaC13 + #200#17;
     nTotAreaC14 = nTotAreaC14 + #200#16;
     nTotAreaC15 = nTotAreaC15 + #200#32;
     nTotAreaC16 = nTotAreaC16 + #200#34;
     nTotAreaC17 = nTotAreaC17 + #200#35;

     nTotTrabC4 = nTotTrabC4 + #200#7;
     nTotTrabC5 = nTotTrabC5 + #200#8;
     nTotTrabC6 = nTotTrabC6 + #200#9;
     nTotTrabC7 = nTotTrabC7 + #200#10;
     nTotTrabC9 = nTotTrabC9 + #200#12;
     nTotTrabC10 = nTotTrabC10 + #200#18;
     nTotTrabC11 = nTotTrabC11 + #200#14;
     nTotTrabC12 = nTotTrabC12 + #200#15;
     nTotTrabC13 = nTotTrabC13 + #200#17;
     nTotTrabC14 = nTotTrabC14 + #200#16;
     nTotTrabC15 = nTotTrabC15 + #200#32;
     nTotTrabC16 = nTotTrabC16 + #200#34;
     nTotTrabC17 = nTotTrabC17 + #200#35;
*/
|FPRC;

|PROCESO CabeceraCen;
     nNivel = 2;
     aAlfa = "<CENTRO>";
     |HAZ Linea;

     aCen = #200#2;
     |QBF aCen;
     aCen = ("00" + aCen) % -102;

     nNivel = 3;
     aAlfa = "<CODIGO_CENTRO>" + aCen + "</CODIGO_CENTRO>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = #200#6; |QBF aAlfa;
     aAlfa = "<NOMBRE_CENTRO>" + aAlfa + "</NOMBRE_CENTRO>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = #200#44; |QBF aAlfa;
     aAlfa = "<CCC_CENTRO>" + aAlfa + "</CCC_CENTRO>";
     |HAZ Linea;
|FPRC;

|PROCESO CabeceraEmp;
     aRutaXML = #labcontr#51;
     aRuta = #labcontr#51;
     |QBF aRuta;
     aAlfa = aRuta % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/";
          aRuta = aRuta + "/";
     |FINSI;
     aRuta = aRuta + "RESUMENES/"
     |RMKDIR aRuta;

     aEmp = #200#0; |QBF aEmp;
     aEmp = ("00000" + aEmp) % -105;
     aFichero = "EMPRESA_" + aEmp;

     |SI swNomFinSep = 1;
          |SI nTipo = 0;
               aFichero = aFichero + "_NOMINA";
          |FINSI;
          |SI nTipo = 2;
               aFichero = aFichero + "_FINIQUITO";
          |FINSI;
     |FINSI;

     |SI aNomPag = "P";
          aFichero = aFichero + "_PAGAS";
     |FINSI;
     fFecha = ~;
     aFecha = fFecha;
     aFecha = (aFecha % 102) + (aFecha % 402) + (aFecha % -104);
     aFichero = aFichero + "_" + aFecha;
     |HORA aHora;
     |QBF aHora;
     aHora = aHora - ":" - ":";
     aFichero = aFichero + "_" + aHora + ".xml";

     #labempre#0 = #200#0;
     |LEE 000#labempre.=;

     aRuta = aRuta + aFichero;
     aDestino = aRuta;
     |DFICE aRuta;
     aRuta = aRuta + aFichero;
     aOrigen = aRuta;
     ||XABRE "CBW", aRuta, nHandle;
     |XABRE "A", aRuta, nHandle;
     |SI FSalida ] 0;
          nNivel = 1;
          aAlfa = "<EMPRESA>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = "<CODIGO_EMPRESA>" + aEmp + "</CODIGO_EMPRESA>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = #200#4; |QBF aAlfa;
          aAlfa = "<NOMBRE_EMPRESA>" + aAlfa + "</NOMBRE_EMPRESA>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = #labempre#10; |QBF aAlfa;
          aAlfa = "<CIF_EMPRESA>" + aAlfa + "</CIF_EMPRESA>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = #200#43; |QBF aAlfa;
          aAlfa = "<CCC_EMPRESA>" + aAlfa + "</CCC_EMPRESA>";
          |HAZ Linea;

          |SI #0#14 = "M";
               nMes = #0#15;
               |HAZ MesLetraXML;
               aXMLDesdeMes = aMes; aXMLHastaMes = aMes;
               aXMLDesdeAny = #0#16; aXMLHastaAny = #0#16;
          |FINSI;
          |SI #0#14 = "H";
               nNume = #0#5 + 2000; aXMLDesdeAny = nNume;
               nNume = #0#10 + 2000; aXMLHastaAny = nNume;

               nMes = #0#2; |HAZ MesLetraXML; aXMLDesdeMes = aMes;
               nMes = #0#9; |HAZ MesLetraXML; aXMLHastaMes = aMes;
          |FINSI;
          |SI #0#14 = "A";
               nNume = #0#16;
               aXMLDesdeAny = nNume;
               aXMLHastaAny = nNume;

               nMes = #0#2; |HAZ MesLetraXML; aXMLDesdeMes = aMes;
               nMes = #0#9; |HAZ MesLetraXML; aXMLHastaMes = aMes;
          |FINSI;
          |SI aNomPag = "P";
               nNume = #nomyrpac#5 + 2000;
               aXMLDesdeAny = nNume;
               aXMLHastaAny = nNume;

               nMes = #nomyrpac#2; |HAZ MesLetraXML; aXMLDesdeMes = aMes;
               nMes = #nomyrpac#2; |HAZ MesLetraXML; aXMLHastaMes = aMes;
          |FINSI;

          nNivel = 2;
          aAlfa = "<DESDE_MES>" + aXMLDesdeMes + "</DESDE_MES>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = "<DESDE_PERIODO>" + aXMLDesdeAny + "</DESDE_PERIODO>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = "<HASTA_MES>" + aXMLHastaMes + "</HASTA_MES>";
          |HAZ Linea;

          nNivel = 2;
          aAlfa = "<HASTA_PERIODO>" + aXMLHastaAny + "</HASTA_PERIODO>";
          |HAZ Linea;

          nNivel = 2;
          |SI #0#14 = "A"; |O #0#4 ] 5;
               aXMLFuente = "Atrasos";
          |SINO;
               |SI swNomFinSep = 1;
                    |SI nTipo = 0;
                         aXMLFuente = "Nomina";
                    |FINSI;
                    |SI nTipo = 2;
                         aXMLFuente = "Finiquito";
                    |FINSI;
               |SINO;
                    |SI nTipoD = nTipoH;
                         |SI nTipoD = 0;
                              aXMLFuente = "Nomina";
                         |FINSI;
                         |SI nTipoD = 2;
                              aXMLFuente = "Finiquito";
                         |FINSI;
                    |SINO;
                         aXMLFuente = "Nomina+Finiquito";
                    |FINSI;
               |FINSI;
               |SI aNomPag = "P";
                    aXMLFuente = "Pagas";
               |FINSI;
          |FINSI;
          aAlfa = "<FUENTE>" + aXMLFuente + "</FUENTE>";
          |HAZ Linea;
     |FINSI;
|FPRC;

|PROCESO GeneraXML;
     swHaEntrado = 1;

     |SI nAntCen ! 0;
          |SI nAntEmp ! #200#0; |O nAntCen ! #200#2;
               |HAZ TotalesCen;
          |FINSI;
     |FINSI;
     |SI nAntEmp ! #200#0; |Y nAntEmp ! 0;
          |HAZ TotalesEmp;
     |FINSI;
     |SI nAntEmp ! #200#0;
          |HAZ CabeceraEmp;
     |FINSI;
     |SI nAntEmp ! #200#0; |O nAntCen ! #200#2;
          |HAZ CabeceraCen;
     |FINSI;
     |HAZ Trabajador;

/*
     |SI nAntTra ! #200#1; |Y nAntTra ! 0;
          |HAZ TotalesTrab;
     |FINSI;
*/

/*
     aArea = #200#21;
     |QBF aArea;
     |SI aAntArea ! ""; |Y aAntArea ! aArea;
          |HAZ TotalesArea;
     |FINSI;

     |SI aAntArea ! ""; |Y aAntArea = aArea; |Y nAntCen ! #200#2;
          |HAZ TotalesArea;  || mismo codigo de area pero distinto centro
     |FINSI;

     |SI nAntCen ! 0; |Y nAntCen ! #200#2;
          |HAZ Totales;
     |FINSI;
*/

/*
     || de momento paso de esto tambien
     nLinea = nLinea + 1;
     |SI swDesglose = 1;
          aValor = #200#1; aValor = ("00000" + aValor) % -105;
          aAlfa1 = #200#5; |QBF aAlfa1;
          aAlfa2 = #200#3; |QBF aAlfa2;
          aValor = aValor + " - " + aAlfa1 + " (" + aAlfa2 + ")";
          |SI #200#1 ! nAntTra;
               nCol = 65;
               aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               aRaizMacro = "Módulo1.";
               aNombreMacro = "Gris_Negrita";
               aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          |FINSI;
          |SI #200#41 ! nAntAny; |O #200#1 ! nAntTra;
               nCol = 66;
               aAlfa = &nCol + nLinea + "," + #200#41; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               aRaizMacro = "Módulo1.";
               aNombreMacro = "Gris_Negrita";
               aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          |FINSI;
          nMes = #200#19;
          |HAZ MesLetraXML;
          aValor = aMes;
          |SI #200#23 = 1;
               aValor = aValor + " (Paga)";
          |FINSI;
          |SI #200#23 = 2;
               aValor = aValor + " (Finiq.)";
          |FINSI;
          nCol = 67;
          aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SINO;
          nCol = 64
          |SI #0#8 = 3;
               aValor = #200#37; aValor = ("0000" + aValor) % -104;
               nCol = nCol + 1;
               aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          |FINSI;
          aValor = #200#1; aValor = ("00000" + aValor) % -105;
          nCol = nCol+ 1;
          aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + #200#5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + #200#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
*/


     aAntArea = #200#21;
     |QBF aAntArea;
     aAntDesArea = #200#22;
     |QBF aAntDesArea;
     nAntTra = #200#1;
     nAntAny = #200#41;
     nAntEmp = #200#0;
     nAntCen = #200#2;
|FPRC;

|| ORDEN POR NUMERO DE REFERENCIA (ANTIGUA MATRICULA)

|DEFBUCLE GeneraXML_3;
     #200#3;
     ;
     00001, 001, "    ", 0000, 1999, nMesDesde, nTipoD, 00001;
     99999, 999, "zzzz", 9999, 2999, nMesHasta, nTipoH, 99999;
     ;
     NULL, GeneraXML;
|FIN;

|DEFBUCLE GeneraXML_meses_3;
     #200#3;
     ;
     00001, 001, "    ", 0000, 1999, month, nTipoD, 00001;
     99999, 999, "zzzz", 9999, 2999, month, nTipoH, 99999;
     ;
     NULL, GeneraXML;
|FIN;

|| ORDEN POR NOMBRE DE TRABAJADOR

|DEFBUCLE GeneraXML_2;
     #200#2;
     ;
     00001, 001, "    ", aDesdeTra, 1999, nMesDesde, nTipoD;
     99999, 999, "zzzz", aHastaTra, 2999, nMesHasta, nTipoH;
     ;
     NULL, GeneraXML;
|FIN;

|DEFBUCLE GeneraXML_meses_2;
     #200#2;
     ;
     00001, 001, "    ", aDesdeTra, 1999, month, nTipoD;
     99999, 999, "zzzz", aHastaTra, 2999, month, nTipoH;
     ;
     NULL, GeneraXML;
|FIN;

|| ORDEN POR CODIGO DE TRABAJADOR

|DEFBUCLE GeneraXML_1;
     #200#1;
     ;
     00001, 001, "    ", 00001, 1999, nMesDesde, nTipoD;
     99999, 999, "zzzz", 99999, 2999, nMesHasta, nTipoH;
     ;
     NULL, GeneraXML;
|FIN;

|DEFBUCLE GeneraXML_meses_1;
     #200#1;
     ;
     00001, 001, "    ", 00001, 1999, month, nTipoD;
     99999, 999, "zzzz", 99999, 2999, month, nTipoH;
     ;
     NULL, GeneraXML;
|FIN;


|PROCESO Totales3XML;
     |ABRE #200;
     #200#0 = nAntEmp;
     #200#1 = 1;
     #200#2 = 1;
     |SI #0#17 = 2; |Y #0#14 = "A";     || atrasos por meses
          #200#19 = 1;         || atrasos refundidos
     |SINO;
          #200#19 = month;
     |FINSI;
     #200#23 = nTipo;
     |SI #200#23 = 2;
          #200#1 = nUnoTipo2;
     |FINSI;
     |LEE 101#200];
     |CIERRA #200;

     nImporteTC1 = #200#20;

     nTotInf = 0;
|FPRC;

/*
|PROCESO TotalesTrab;
     |SI swDesglose ! 1;
          |ACABA;
     |FINSI;

     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;

     |SI swDesglose = 1;
          nCol = 65;
          aCelda = &nCol;
     |SINO;
          |SI #0#8 = 3; |Y swDesglose = 0;
               nCol = 67;
          |SINO;
               nCol = 66;
          |FINSI;
          aCelda = &nCol;
     |FINSI;
     aAlfa = aCelda + nLinea + ", Total TRABAJADOR: ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 68
     |SI #0#8 = 3; |Y swDesglose = 0;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotTrabC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotTrabC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SI enCuadre = 04;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotTrabC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotTrabC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     || ¨sirve para algo?
     || nTotInf = nTotTotC13 +  nTotTotC11 - nTotTotC4;

     nTotTrabC4 = 0;
     nTotTrabC5 = 0;
     nTotTrabC6 = 0;
     nTotTrabC7 = 0;
     nTotTrabC9 = 0;
     nTotTrabC10 = 0;
     nTotTrabC11 = 0;
     nTotTrabC12 = 0;
     nTotTrabC13 = 0;
     nTotTrabC14 = 0;
     nTotTrabC15 = 0;
     nTotTrabC16 = 0;
     nTotTrabC17 = 0;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO TotalesArea;
     |SI aRupAreas ! "S";
          |ACABA;
     |FINSI;

     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;

     |SI swDesglose = 1;
          nCol = 65;
          aCelda = &nCol;
     |SINO;
          |SI #0#8 = 3;
               nCol = 66;
          |SINO;
               nCol = 65;
          |FINSI;
          aCelda = &nCol;
     |FINSI;
     aAlfa = aCelda + nLinea + ", Total AREA: " + aAntArea + " - " + aAntDesArea;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 68;
     |SI #0#8 = 3;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotAreaC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotAreaC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SI enCuadre = 04;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotAreaC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotAreaC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     || ¨sirve para algo?
     || nTotInf = nTotTotC13 +  nTotTotC11 - nTotTotC4;

     nTotAreaC4 = 0;
     nTotAreaC5 = 0;
     nTotAreaC6 = 0;
     nTotAreaC7 = 0;
     nTotAreaC9 = 0;
     nTotAreaC10 = 0;
     nTotAreaC11 = 0;
     nTotAreaC12 = 0;
     nTotAreaC13 = 0;
     nTotAreaC14 = 0;
     nTotAreaC15 = 0;
     nTotAreaC16 = 0;
     nTotAreaC17 = 0;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO Totales2;
     nLinea = nLinea + 2;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;

     |SI swDesglose = 1;
          nCol = 65;
          aCelda = &nCol;
     |SINO;
          |SI #0#8 = 3; |Y swDesglose = 0;
               nCol = 67;
          |SINO;
               nCol = 66;
          |FINSI;
          aCelda = &nCol;
     |FINSI;
     aAlfa = aCelda + nLinea + ", Total EMPRESA:";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 68;
     |SI #0#8 = 3; |Y swDesglose = 0;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SI enCuadre = 04;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotTotC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotTotC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
     nTotInf = nTotTotC13 +  nTotTotC11 - nTotTotC4;

     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
     nTotTotC15 = 0;
     nTotTotC16 = 0;
     nTotTotC17 = 0;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO Totales;
     nLinea = nLinea + 2;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;
     |SI swDesglose = 1;
          nCol = 65;
          aCelda = &nCol;
     |SINO;
          |SI #0#8 = 3;
               nCol = 67;
          |SINO;
               nCol = 66;
          |FINSI;
          aCelda = &nCol;
     |FINSI;
     aAlfa = aCelda + nLinea + ", Total Centro " + nAntCen + ":";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 68;
     |SI #0#8 = 3; |Y swDesglose = 0;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SI enCuadre = 04;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + nTotC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;

     nLinea = nLinea + 1;
|FPRC;
*/

|PROCESO MesLetraXML;
     |SI nMes = 1;  aMes = "ENERO";          |FINSI;
     |SI nMes = 2;  aMes = "FEBRERO";        |FINSI;
     |SI nMes = 3;  aMes = "MARZO";          |FINSI;
     |SI nMes = 4;  aMes = "ABRIL";          |FINSI;
     |SI nMes = 5;  aMes = "MAYO";           |FINSI;
     |SI nMes = 6;  aMes = "JUNIO";          |FINSI;
     |SI nMes = 7;  aMes = "JULIO";          |FINSI;
     |SI nMes = 8;  aMes = "AGOSTO";         |FINSI;
     |SI nMes = 9;  aMes = "SEPTIEMBRE";     |FINSI;
     |SI nMes = 10; aMes = "OCTUBRE";        |FINSI;
     |SI nMes = 11; aMes = "NOVIEMBRE";      |FINSI;
     |SI nMes = 12; aMes = "DICIEMBRE";      |FINSI;
|FPRC;

|PROCESO ProcesoXML;
     |ABRE #labempre;
     |ABRE #labcentr;
     |ABRE #labtraba;
     |ABRE #labcontr;
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;

     |SI #0#14 = "M"; aXMLFuente = "Mensual"; |FINSI;
     |SI #0#14 = "H"; aXMLFuente = "Historico"; |FINSI;
     |SI #0#14 = "A"; aXMLFuente = "Atrasos"; |FINSI;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          aXMLFuente = "Atrasos";
     |SINO;
          |SI nOrdenTra = 1;
               aXMLOrdenTra = "Codigo";
          |FINSI;
          |SI nOrdenTra = 2;
               aXMLOrdenTra = "Nombre";
          |FINSI;
          |SI nOrdenTra = 3;
               aXMLOrdenTra = "Referencia";
          |FINSI;
     |FINSI;

     || ATRASOS VENDRA DESPUES
     |SI enTipoInf = 1; |Y eaFuente = "A"
          nAntEmp = 0;
          nAntCen = 0;
          |PARA month = 1; |SI month [ 12; |HACIENDO month = month + 1;

               || solo month = 1, lo grabo todo junto

               swHaEntrado = 0;
               nLinea = 0;
               |SI nOrdenTra = 1;
                    |BUCLE GeneraXML_meses_1;
               |FINSI;
               |SI nOrdenTra = 2;
                    |BUCLE GeneraXML_meses_2;
               |FINSI;
               |SI nOrdenTra = 3;
                    |BUCLE GeneraXML_meses_3;
               |FINSI;

               || TOTALES

               |SI swHaEntrado = 1;
                    |HAZ TotalesCen;  || el del ultimo trabajador siempre
                    |HAZ TotalesEmp;  || el del ultimo area siempre
               |FINSI;
          |SIGUE;
     |SINO;
          swHaEntrado = 0;
          nLinea = 0;

          || aqui hay que ver si tipo 0 y 2 juntos o separado
          || xxxxxxxxxx

          nMesDesde = 01;
          nMesHasta = 12;

          |SI swDesglose = 1;
               nMesDesde = 01;
               nMesHasta = 12;
          |SINO;
               |SI swNomFinSep = 1;
                    nTipoD = nTipo;
                    nTipoH = nTipo;
               |FINSI;
          |FINSI;

          nAntEmp = 0;
          nAntCen = 0;

          |SI nOrdenTra = 1
               |BUCLE GeneraXML_1;
          |FINSI;
          |SI nOrdenTra = 2;
               |BUCLE GeneraXML_2;
          |FINSI;
          |SI nOrdenTra = 3;
               |BUCLE GeneraXML_3;
          |FINSI;

          || TOTALES

          |SI swHaEntrado = 1;
               |HAZ TotalesCen;  || el del ultimo trabajador siempre
               |HAZ TotalesEmp;  || el del ultimo area siempre
          |FINSI;
     |FINSI;

     |CIERRA #labtraba;
     |CIERRA #labcentr;
     |CIERRA #labempre;

     |CIERRA #200;
|FPRC;

|PROCESO xml;
     swNomFinSep = 0;
     |SI nTipoD = 0; |Y nTipoH = 2; |Y #0#32 = 1; |Y swDesglose = 0;
          || resumen desde tipo 0 hasta tipo 2 (nomina y finiquitos) pero por
          || separado, en este caso en ficheros xml distintos han de salir
          swNomFinSep = 1;
          |PARA nTipo = 0; |SI nTipo [ 2; |HACIENDO nTipo = nTipo + 2;
               |HAZ ProcesoXML;
          |SIGUE;
     |SINO;
          |SI aNomPag = "P";
               month = 1;
               nPara = 0;
          |FINSI;
          |HAZ ProcesoXML;
     |FINSI;
     |SI nFicheros = 0;
          aAlfa = "    No se han encontrado datos para la generación de ";
          aAlfa = aAlfa + "resúmenes de nóminas";
     |FINSI;
     |SI nFicheros = 1;
          |SI aNomPag = "P"
               aAlfa1 = #nomyrpac#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
          |SINO;
               aAlfa1 = #nomyrenm#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
          |FINSI;
          aRuta = aDestino - aFichero;
          aAlfa = "    Se ha generado el resumen de la empresa " + aAlfa1;
          aAlfa = aAlfa + " en la carpeta " + aRuta;
     |FINSI;
     |SI nFicheros > 1;
          aRuta = aDestino - aFichero;
          aAlfa = "    Se ha generado los resúmenes de las empresas solicitadas ";
          aAlfa = aAlfa + "en la carpeta " + aRuta;
     |FINSI;
     |MENAV aAlfa;
|FPRC;
