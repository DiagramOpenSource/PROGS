|FICHEROS;
     vipe0006 #0;
     vipe0007 #7;
     vipe0013 #13;
     labtraba;
|FIN;

|VARIABLES;
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;
     nCampo00 = 0; nCampo01 = 0; aCampo02 = "";nCampo03 = 0; nCampo04 = 0;
     nCampo05 = 0; nCampo06 = 0; nCampo07 = 0; nCampo08 = 0; nCampo09 = 0;
     nCampo10 = 0; nCampo11 = 0; nCampo12 = 0; nCampo13 = 0; nCampo14 = 0;
     nCampo15 = 0; nCampo16 = 0; nCampo17 = 0; nCampo18 = 0; nCampo19 = 0;
     nCampo20 = 0; nCampo21 = 0; nCampo22 = 0; nCampo23 = 0; aCampo24 = "";
     aCampo25 = "";nCampo27 = 0; nCampo28 = 0; nCampo29 = 0;

     aNif = "";
     FEstado = 0;
     alfa1 = "";
     {-1}menu = "";
     menu1 = "2400";
     menu2 = "1";
     menu3 = "Elegir Opcion:";
     menu4 = "IRT";
     menu5 = "Imprimir";
     menu6 = "Revisar";
     menu7 = "Terminar";
     nOpcion = 0;
     nBoton1 = 0;
     fFecha = @;
     aAlfa = "";
     nNume = 0;
     aParam = "";
|FIN;

|PROCESO defecto; |TIPO 7;
     fFecha = ~;
     aAlfa = fFecha;
     aAlfa = aAlfa % -104;
     nNume = aAlfa;
     #0#2 = nNume;
     |PINTA #0#2;
|FPRC;

|PROCESO informe;
     |PRINT;
|FPRC;

|DEFBUCLE informe;
     #vipe0013#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, informe;
|FIN;

|PROCESO impresion;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |INFOR "vipe0007";
     |BUCLE informe;
     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PulsaBoton1;
     |HAZ impresion;
|FPRC;

|PROCESO Linea99;
     #vipe0013#24 = aCampo24;
     #vipe0013#03 = nCampo03;
     #vipe0013#04 = nCampo04;      || mes 99 (linea Total)
     |LEE 101#vipe0013.=;

     #vipe0013#00 = nCampo00;
     #vipe0013#01 = nCampo01;
     #vipe0013#02 = aCampo02;

     #vipe0013#05 = nCampo05;
     #vipe0013#06 = nCampo06;
     #vipe0013#07 = nCampo07;
     #vipe0013#08 = nCampo08;
     #vipe0013#09 = nCampo09;
     #vipe0013#10 = nCampo10;
     #vipe0013#11 = nCampo11;
     #vipe0013#12 = nCampo12;
     #vipe0013#13 = nCampo13;
     #vipe0013#14 = nCampo14;
     #vipe0013#15 = nCampo15;
     #vipe0013#16 = nCampo16;
     #vipe0013#17 = nCampo17;
     #vipe0013#18 = nCampo18;
     #vipe0013#19 = nCampo19;
     #vipe0013#20 = nCampo20;
     #vipe0013#21 = nCampo21;
     #vipe0013#22 = nCampo22;
     #vipe0013#23 = nCampo23;

     #vipe0013#25 = aCampo25;
     #vipe0013#27 = nCampo27;
     #vipe0013#28 = nCampo28;
     #vipe0013#29 = nCampo29;
     |GRABA 020#vipe0013.a;
     |LIBERA #vipe0013;
|FPRC;

|PROCESO Acumula;
     nCampo00 = #vipe0013#0;
     nCampo01 = #vipe0013#1;
     aCampo02 = #vipe0013#2;
     nCampo03 = #vipe0013#3;
     nCampo04 = 99;
     nCampo05 = nCampo05 + #vipe0013#5;
     nCampo06 = nCampo06 + #vipe0013#6;
     nCampo07 = nCampo07 + #vipe0013#7;
     nCampo08 = nCampo08 + #vipe0013#8;
     nCampo09 = nCampo09 + #vipe0013#9;
     nCampo10 = nCampo10 + #vipe0013#10;
     nCampo11 = nCampo11 + #vipe0013#11;
     nCampo12 = nCampo12 + #vipe0013#12;
     nCampo13 = nCampo13 + #vipe0013#13;
     nCampo14 = nCampo14 + #vipe0013#14;
     nCampo15 = nCampo15 + #vipe0013#15;
     nCampo16 = nCampo16 + #vipe0013#16;
     nCampo17 = nCampo17 + #vipe0013#17;
     ||SI #vipe0013#28 ! 0;
          nCampo18 = nCampo18 + #vipe0013#18;
     ||FINSI;
     nCampo19 = nCampo19 + #vipe0013#19;
     nCampo20 = nCampo20 + #vipe0013#20;
     nCampo21 = nCampo21 + #vipe0013#21;
     nCampo22 = nCampo22 + #vipe0013#22;
     nCampo23 = nCampo23 + #vipe0013#23;
     aCampo24 = #vipe0013#24;
     aCampo25 = " ";
     nCampo27 = nCampo27 + #vipe0013#27;
     nCampo29 = nCampo29 + #vipe0013#29;
     |SI #vipe0013#28 ! 0;
          nCampo28 = #vipe0013#28;
     |FINSI;
|FPRC;

|DEFBUCLE Acumula;
     #vipe0013#1;
     ;
     aNif, #0#2, 01;
     aNif, #0#2, 12;
     ;
     NULL, Acumula;
|FIN;

|PROCESO Inicializa;
     nCampo00 = 0; nCampo01 = 0; aCampo02 = "";nCampo03 = 0; nCampo04 = 0;
     nCampo05 = 0; nCampo06 = 0; nCampo07 = 0; nCampo08 = 0; nCampo09 = 0;
     nCampo10 = 0; nCampo11 = 0; nCampo12 = 0; nCampo13 = 0; nCampo14 = 0;
     nCampo15 = 0; nCampo16 = 0; nCampo17 = 0; nCampo18 = 0; nCampo19 = 0;
     nCampo20 = 0; nCampo21 = 0; nCampo22 = 0; nCampo23 = 0; aCampo24 = "";
     aCampo25 = "";nCampo27 = 0; nCampo28 = 0; nCampo29 = 0;
|FPRC;

|PROCESO Totales;
     #vipe0013#24 = aNif;
     #vipe0013#3 = #0#2;
     #vipe0013#4 = 99;
     |LEE 101#vipe0013.=;
     |SI FSalida = 0;
          |BORRA 020#vipe0013.a;
     |FINSI;

     |DDEFECTO #vipe0013;
     #vipe0013#24 = aNif;
     #vipe0013#3 = #0#2;
     #vipe0013#4 = 99;
     |GRABA 000#vipe0013.n;

     |HAZ Inicializa;
     |BUCLE Acumula;
     |HAZ Linea99;
|FPRC;

|PROCESO grabatmp;
     |DDEFECTO #vipe0013;
     #vipe0013#24 = #vipe0007#24;       || NIF
     #vipe0013#3 = #vipe0007#3;         || A¤o
     #vipe0013#4 = #vipe0007#4;         || Mes
     |LEE 101#vipe0013.=;
     FEstado = FSalida;
     |SI FEstado = 0; |Y #vipe0007#7 = 0;
          || si existe ya la linea y la que viene viene a cero no acumulo
          |LIBERA #vipe0013;
          |ACABA;
     |FINSI;
     #vipe0013#24 = #vipe0007#24;       || NIF
     #vipe0013#3 = #vipe0007#3;         || A¤o
     #vipe0013#4 = #vipe0007#4;         || Mes

     #vipe0013#0 = #vipe0007#0;       || codigo empresa
     #vipe0013#1 = #vipe0007#1;       || codigo trabajador
     #vipe0013#2 = #vipe0007#2;       || nombre trabajador
     #vipe0013#5 = #vipe0013#5 + #vipe0007#5;       || dias trabajados
     #vipe0013#6 = #vipe0007#6;       || horas contrato
     #vipe0013#7 = #vipe0013#7 + #vipe0007#7;       || horas mes
     #vipe0013#8 = #vipe0013#8 + #vipe0007#8;       || horas normales
     #vipe0013#9 = #vipe0013#9 + #vipe0007#9;       || horas IT
     #vipe0013#10 = #vipe0013#10 + #vipe0007#10;    || horas vacaciones
     #vipe0013#11 = #vipe0013#11 + #vipe0007#11;    || horas absentismo
     #vipe0013#12 = #vipe0013#12 + #vipe0007#12;    || total horas partes
     #vipe0013#13 = #vipe0013#13 + #vipe0007#13;    || diferencia
     #vipe0013#14 = #vipe0013#14 + #vipe0007#14;    || ptes. mes anterior
     || #vipe0013#14 = #vipe0007#14;    || ptes. mes anterior
     #vipe0013#15 = #vipe0013#15 + #vipe0007#15;    || regularizacion
     #vipe0013#16 = #vipe0013#16 + #vipe0007#16;    || pagadas mes
     #vipe0013#17 = #vipe0013#17 + #vipe0007#17;    || pendientes

     #vipe0013#18 = #vipe0013#18 + #vipe0007#18;    || arrastre pendientes

     #vipe0013#19 = #vipe0013#19 + #vipe0007#19;    || vacac. ptes. mes anterior
     #vipe0013#20 = #vipe0013#20 + #vipe0007#20;    || vacac. generadas mes
     #vipe0013#21 = #vipe0013#21 + #vipe0007#21;    || vacac. disfrutadas mes
     #vipe0013#22 = #vipe0013#22 + #vipe0007#22;    || vacac. ptes. mes
     || #vipe0013#23 = #vipe0013#23 + #vipe0007#23;    || arraste vac. pendientes
     #vipe0013#23 = #vipe0013#19 + #vipe0013#22;    || arraste vac. pendientes

     #vipe0013#27 = #vipe0013#27 + #vipe0007#27;    || vac. pendientes a¤o anterior
     || #vipe0013#27 = #vipe0007#27;    || vac. pendientes a¤o anterior

     || #vipe0013#28 = #vipe0013#28 + #vipe0007#28;    || total vac. pendientes
     || #vipe0013#28 = #vipe0007#28;    || total vac. pendientes
     #vipe0013#28 = #vipe0013#23 + #vipe0013#27;    || total vac. pendientes

     #vipe0013#29 = #vipe0013#29 + #vipe0007#29;    || vacaciones pagadas mes

     || los campos calculado S/N y centro de trabajo no hacen falta aqui

     |SI FEstado = 0;
          |GRABA 020#vipe0013.a;
     |SINO;
          |GRABA 020#vipe0013.n;
     |FINSI;

     |LIBERA #vipe0013;

     || nTraAnt = #vipe0013#1;
|FPRC;

|DEFBUCLE cargatmp;
     #vipe0007#1;
     24;
     #0#0, 00001, #0#2, 01, aNif;
     #0#0, 99999, #0#2, 12, aNif;
     ;
     NULL, grabatmp;
|FIN;

|PROCESO inferior;
     #vipe0013#24 = aNif;
     #vipe0013#3 = #0#2;
     #vipe0013#4 = 01;
|FPRC;

|PROCESO superior;
     #vipe0013#24 = aNif;
     #vipe0013#3 = #0#2;
     #vipe0013#4 = 99;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |QBF aParam;
     |SI aParam ! "";
          |NOME_DAT #7 aParam;
     |FINSI;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |PARA; |SI; |HACIENDO;
          |ENDATOS #1#0;
          |SI FSalida = -1;
               |SAL;
          |FINSI;
          |SI FSalida = 0;
               alfa1 = Usuario; |QBT alfa1;    alfa1 = ("i" + alfa1) % 108;
               |NOME_DAT #13 alfa1;
               |DELINDEX #13;

               |ABRE #vipe0013;
               |ABRE #labtraba;

               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 000#labtraba.=;
               aNif = #labtraba#7;

               |BUCLE cargatmp;
               |HAZ Totales;

               nModo = 2 + 4 + 8 + 16;
               nPos1 = 0902;
               nPos2 = 2280;

               |CONTROL_SIMPLE 0, "BOTON,Imprimir", 2335, 2345, PulsaBoton1;
               nBoton1 = FSalida;
               |ESTADO_CONTROL nBoton1, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ESTADO_CONTROL nBoton1, "ENABLE"; ||"SHOW""HIDE""ENABLE""DISABLE".

               |PARA; |SI; |HACIENDO;
                    |LINEAL_SIMPLE #1#vipe0013, nModo, nPos1, nPos2, inferior, superior, NULL;
                    |SI nOpcion = 3; |O FSalida = -1;
                         |SAL;
                    |FINSI;
                    /*
                    ||MENU menu;
                    nOpcion = FSalida;
                    |SI nOpcion = 1;
                         |HAZ impresion;
                    |FINSI;
                    |SI nOpcion = 2;
                    |FINSI;
                    |SI nOpcion = 3; |O FSalida = -1;
                         |SAL;
                    |FINSI;
                    */
               |SIGUE;

               |PULSATECLA;
               |FIN_CONTROL_WINDOWS nBoton1;
               |PULSATECLA;

               |CIERRA #vipe0013;
               |CIERRA #labtraba;
          |FINSI;
     |SIGUE;
|FPRO;
