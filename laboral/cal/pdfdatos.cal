|FICHEROS;
     pdfdatos #0;
     pdfdocca;
     pdfdocli;
     pdfcopia@ #100;
|FIN;

|VARIABLES;
     aPath = "";
     aFichero = "";
     aFicheroLista = "documentos.txt";
     nCanal = 0;
     nCanal2 = 0;
     nCaracter = 0;
     aCaracter = "";
     nCampo = 0;
     aCampo = "";
     nBusca = 0;
     aLinea = "";
     nLinea = 0;
     aContrato = "";

     {-1}menu = "";
     menu1 = "2400";
     menu2 = "2";
     menu3 = "Elegir Opcion:";
     menu4 = "AC";
     menu5 = "Editar";
     menu6 = "Actualizar";
     aAlfa1 = "";
     nOpcion = 0;
     aRutaDef = "";
     aRutaFich = "";
     swRepetido = 0;
     aAlfa = "";
|FIN;

|PROCESO Repetidos;
     swRepetido = 1;
|FPRC;

|DEFBUCLE Repetidos;
     #100#1002;
     2;
     #pdfdocca#0, 001, aCampo;
     #pdfdocca#0, 999, aCampo;
     ;
     NULL, Repetidos;
|FIN;

|PROCESO BuscaCampo;
     aCampo = "";
     |PARA nCaracter = 1; |SI nCaracter [ 50; |HACIENDO nCaracter = nCaracter + 1;
          nBusca = (nCaracter * 100) + 1;
          aCaracter = aLinea % nBusca;
          ||QBF aCaracter;
          |SI aCaracter = "[";
               |SAL;
          |SINO;
               aCampo = aCampo + aCaracter;
          |FINSI;
     |SIGUE;
     |QBF aCampo;
     #pdfdocli#0 = #pdfdocca#0;
     #pdfdocli#1 = nCampo;
     #pdfdocli#2 = aCampo;
     swRepetido = 0;
     aCampo = aCampo + "                                        ";
     aCampo = aCampo % 140;
     |BUCLE Repetidos;
     |SI swRepetido = 0;
          |GRABA 020#pdfdocli.n;
     |FINSI;
|FPRC;

|PROCESO Actualiza;
     #pdfdocca#0 = aContrato;
     |SI FSalida ! 0;
          |GRABA 020#pdfdocca.n;
     |FINSI;

     |DBASE aPath;
     |QBF aPath;
     aPath = aPath + "pdf/" + aContrato;
     aPath = aPath - ".pdf";
     aPath = aPath + "campos.txt";

     |XABRE "U", aPath, nCanal2;
     |SI FSalida ] 0;
          |PARA nCampo = 1; |SI FSalida ] 0; |HACIENDO nCampo = nCampo + 1;
               |XLEE nCanal2, 80, aLinea;
               |QBF aLinea;
               |SI aLinea = ""; |SAL;   |FINSI;
               |HAZ BuscaCampo;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO BorraLineas;
     |BORRA 020#pdfdocli.a;
|FPRC;

|DEFBUCLE BorraLineas;
     #pdfdocli#1;
     ;
     aAlfa1,   1;
     aAlfa1, 999;
     ;
     NULL, BorraLineas;
|FINSI;

|PROCESO BorraAntiguos;
     #pdfdocca#0 = aContrato;
     |BUCLE BorraLineas;
     |LEE 101#pdfdocca.=
|FPRC;

|PROCESO BuscaContratos;
     |DBASE aPath;
     |QBF aPath;
     aPath = aPath + "pdf/" + aFicheroLista;

     |XABRE "U", aPath, nCanal;
     |SI FSalida ] 0;
          |PARA nLinea = 1; |SI; |HACIENDO nLinea = nLinea + 1;
               |XLEE nCanal, 80, aContrato;
               |QBF aContrato;
               |SI aContrato = ""; |SAL;   |FINSI;
               |HAZ BorraAntiguos;
               |HAZ Actualiza;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO CargaCopia;
     |DBASE aRutaDef;
     |DBASE aRutaFich;
     |QBF aRutaDef;
     |QBF aRutaFich;
     aRutaDef = aRutaDef + "def/pdfdocli.mas";
     |CARGA_DEF aRutaDef, pdfcopia@;
     |SI FSalida ! 0;
          |MENAV "    Error en CARGADEF: pdfdocli";
     |FINSI;
|FPRC;

|PROCESO Copia2;
     #pdfdocli#0 = aAlfa1;
     |GRABA 020#pdfdocli.n;
|FPRC;

|DEFBUCLE Copia2;
     #pdfdocli#1;
     ;
     aAlfa, 001;
     aAlfa, 999;
     ;
     NULL, Copia2;
|FIN;

|PROCESO CopiaDeOtro;
     |ABRE #pdfdocca;
     |ABRE #pdfdocli;

     |BUCLE Copia2;

     |CIERRA #pdfdocli;
     |CIERRA #pdfdocca;
|FPRC;

|PROCESO CargaDatos; |TIPO 0;

          || copia desde este modelo
          || aAlfa = "pe-170.pdf";
          aAlfa = #0#1;
          |QBF aAlfa;

          || a este modelo
          || aAlfa1 = "pe-226.pdf";
          aAlfa1 = #0#2;
          |QBF aAlfa1;

     |SI #pdfdatos#0 = "S";
          |BUCLE BorraLineas;
          |HAZ CopiaDeOtro;
          |ACABA;
/*

          |ABRE #pdfdocca;
          |ABRE #pdfdocli;
          |HAZ CargaCopia;
          |HAZ BuscaContratos;
          |DESCARGA_DEF #pdfcopia@;
          |CIERRA #pdfdocca;
          |CIERRA #pdfdocli;
*/
     |FINSI;
|FPRC;
