|FICHEROS;
     nomytran #0;
     labempre;
     labtraba;
     labcentr;

     nomcalca;
     nomcalac;
     nomhicca;
     nomcalcu;

     nomrevli;

     nomw0023;
     nomcontr;

     &bancosc@;
|FIN;

|VARIABLES;
     nMes                = 0;
     nEmbargo            = 0;
     nDevenga            = 0;
     nDeducir            = 0;
     nBaja               = 0;
     nDia                = 0;
     nAny                = 0;
     nDiasTope           = 0;
     nTopeMes            = 0;
     nIde                = 0;
     nDMes               = 0;
     nHMes               = 0;
     nOpcion             = 0;

     aAlfa               = "";
     aMes                = "";
     aMes1               = "";
     aMes2               = "";
     aFicTmp             = "";
     aEmp                = "";
     aCen                = "";
     aNomEmp             = "";

     fFecSys             = @;

     {-1}aMenu           = "";
         aMenu1          = "2400";
         aMenu2          = "1";
         aMenu3          = "Archivo documental activado. Elija opci¢n: ";
         aMenu4          = "IAB";
         aMenu5          = "Imprimir";
         aMenu6          = "Archivar";
         aMenu7          = "Ambos";

     &enCodBanco         = 0;
     &enSwDeDonde        = 0;
     &eaVengoDe          = "";
     &nArchi             = 0;
     &enEmp              = 0;
     &swErrorDSArchi     = 0;
     &enDesdeMes         = 0;
     &enAny              = 0;
     &eaTitulo           = "";
     &eaPeriodos         = "";
     aOficina = "";
     nImporteTran = 0;
|FIN;

|PROCESO CogeNombre;
     |SI nMes =  1;  aMes = "ENERO";       nTopeMes = 31; |FINSI;
     |SI nMes =  2;  aMes = "FEBRERO";     nTopeMes = 28; |FINSI;
     |SI nMes =  3;  aMes = "MARZO";       nTopeMes = 31; |FINSI;
     |SI nMes =  4;  aMes = "ABRIL";       nTopeMes = 30; |FINSI;
     |SI nMes =  5;  aMes = "MAYO";        nTopeMes = 31; |FINSI;
     |SI nMes =  6;  aMes = "JUNIO";       nTopeMes = 30; |FINSI;
     |SI nMes =  7;  aMes = "JULIO";       nTopeMes = 31; |FINSI;
     |SI nMes =  8;  aMes = "AGOSTO";      nTopeMes = 31; |FINSI;
     |SI nMes =  9;  aMes = "SEPTIEMBRE";  nTopeMes = 30; |FINSI;
     |SI nMes = 10;  aMes = "OCTUBRE";     nTopeMes = 31; |FINSI;
     |SI nMes = 11;  aMes = "NOVIEMBRE";   nTopeMes = 30; |FINSI;
     |SI nMes = 12;  aMes = "DICIEMBRE";   nTopeMes = 31; |FINSI;
|FPRC;

|PROCESO AcumMensual;
     nEmbargo = #nomcalca#104;
     |SI #nomcalca#16 ! 0;
         nEmbargo = ((#nomcalca#104 * (#nomcalca#46 / (#nomcalca#46 + #nomcalca#47))) ! 2);
     |FINSI;

     nDevenga = #nomcalca#46;
     nDeducir = #nomcalca#48 + #nomcalca#49 + #nomcalca#50 + #nomcalca#51;
     nDeducir = nDeducir     + #nomcalca#52 + #nomcalca#53 + #nomcalca#54;
     nDeducir = nDeducir     + #nomcalca#75 + #nomcalca#89 + nEmbargo + #nomcalca#165;

     |SI nBaja = 1; |O #labempre#25 = 2;
         || si es baja este mes o la paga va
         || /junto con el recibo, acumula la paga
         || si las pagas van en un solo recibo
         || mete anticipos de paga extra

         nDevenga = nDevenga + #nomcalca#16;
         nDeducir = nDeducir + #nomcalca#17;
         |SI #labempre#25 = 2;
             nDeducir = nDeducir + #nomcalca#86;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO AcumPagas;
     nEmbargo = #nomcalca#104;
     |SI nEmbargo ! 0;
         nEmbargo = #nomcalca#104 - ((#nomcalca#104 * (#nomcalca#46 / (#nomcalca#46 + #nomcalca#47))) ! 2);
     |FINSI;

     nDevenga = #nomcalca#16;
     nDeducir = #nomcalca#17 + #nomcalca#86 + nEmbargo;
|FPRC;

|PROCESO nomrevli;
     nImporteTran = #nomrevli#6;
|FPRC;

|DEFBUCLE nomrevli;
     #nomrevli#4;
     ;
     #nomw0023#2, #nomw0023#3, #nomw0023#0, #nomw0023#1, #nomytran#10, #nomytran#1, 000001;
     #nomw0023#2, #nomw0023#3, #nomw0023#0, #nomw0023#1, #nomytran#10, #nomytran#1, 999999;
     ;
     NULL, nomrevli;
|FIN;

|PROCESO BuscaTrans;
     nImporteTran = 0;
     |BUCLE nomrevli;
|FPRC;

|PROCESO nomcalca;
     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |DDEFECTO #labtraba;  |FINSI;

     |SI #labtraba#70 ! "T";
         |ACABA;
     |FINSI;

     |SI #labtraba#71 < #nomytran#8; |O #labtraba#71 > #nomytran#9;
         |ACABA;
     |FINSI;

     |SI #labtraba#77 < #nomytran#12; |O #labtraba#77 > #nomytran#13;
         |ACABA;
     |FINSI;

     aAlfa = #nomcalca#5 %  102;    nDia = aAlfa;
     aAlfa = #nomcalca#5 %  402;    nMes = aAlfa;
     aAlfa = #nomcalca#5 %  -102;   nAny = aAlfa;

     |SI aAlfa = "..";
         nDia = 0;
         nMes = 0;
         nAny = 0;
     |FINSI;

     nBaja = 0;

     |SI nMes = #nomytran#3; |Y nAny = #nomytran#4;  |Y nDia ! nDiasTope;
         nBaja = 1;
     |FINSI;

     |SI #nomytran#14 = "N";
         |SI nBaja = 1;  |ACABA;  |FINSI;
     |FINSI;

     #labempre#0 = #nomcalca#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;  |DDEFECTO #labempre;  |FINSI;

     #labcentr#0 = #nomcalca#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI FSalida ! 0;  |DDEFECTO #labcentr;  |FINSI;

     enCodBanco = #labtraba#71;
     |HAZ LeeBancos;
     aOficina = "";
     |SI enSwDeDonde = 0;
          aOficina = "";
     |SINO;
          aOficina = #bancosc@#5;
     |FINSI;

     |SI #nomytran#1 = "M";  |HAZ AcumMensual;  |FINSI;
     |SI #nomytran#1 = "P";  |HAZ AcumPagas;    |FINSI;

     #nomw0023#0 = #nomcalca#184;
     #nomw0023#1 = #nomcalca#2;
     #nomw0023#2 = #nomcalca#0;
     #nomw0023#3 = #nomcalca#1;
     |LEE 000#nomw0023.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0023;
         #nomw0023#0 = #nomcalca#184;
         #nomw0023#1 = #nomcalca#2;
         #nomw0023#2 = #nomcalca#0;
         #nomw0023#3 = #nomcalca#1;
         |GRABA 020#nomw0023.b;
     |FINSI;

     #nomw0023#4  = #labcentr#1;
     #nomw0023#5  = #labtraba#71;
     #nomw0023#6  = #labempre#2;
     #nomw0023#7  = #labempre#135;
     #nomw0023#8  = #labcentr#2;
     #nomw0023#9  = aOficina;
     #nomw0023#10 = #labtraba#7;
     #nomw0023#11 = #labtraba#2;
     #nomw0023#12 = #labtraba#154 % 104;
     #nomw0023#13 = #labtraba#154 % 504;
     #nomw0023#14 = #labtraba#154 % 904;
     #nomw0023#15 = #labtraba#154 % 1304;
     #nomw0023#16 = #labtraba#154 % 1704;
     #nomw0023#17 = #labtraba#154 % 2104;
     #nomw0023#18 = #nomw0023#18 + (nDevenga - nDeducir);
     #nomw0023#19 = #nomw0023#0 + (("00" + #nomw0023#1) % -102);

     nMes  = #nomw0023#1;  |HAZ CogeNombre;
     aAlfa = aMes + " " + #nomw0023#0;

     #nomw0023#20 = aAlfa;

     |HAZ BuscaTrans;
     #nomw0023#21 = nImporteTran;

     |GRABA 020#nomw0023.a;
     |LIBERA #nomw0023;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #nomytran#0, #nomytran#5, #nomytran#3, #nomytran#10;
     #nomytran#7, #nomytran#6, #nomytran#3, #nomytran#10;
     ;
     NULL, nomcalca;
|FIN;

|PROCESO Mensual;
     |BUCLE nomcalca;
|FPRC;

|PROCESO AcumMensual_Histo;
     nEmbargo = #nomhicca#146;
     |SI #nomhicca#16 ! 0;
         nEmbargo = ((#nomhicca#146 * (#nomhicca#46 / (#nomhicca#46 + #nomhicca#47))) ! 2);
     |FINSI;

     nDevenga = #nomhicca#46;
     nDeducir = #nomhicca#48 + #nomhicca#49  + #nomhicca#50  + #nomhicca#51;
     nDeducir = nDeducir     + #nomhicca#52  + #nomhicca#53  + #nomhicca#54;
     nDeducir = nDeducir     + #nomhicca#114 + #nomhicca#131 + nEmbargo + #nomhicca#207;

     |SI nBaja = 1; |O #labempre#25 = 2;
         || si es baja este mes o la paga va
         || /junto con el recibo, acumula la paga
         || si las pagas van en un solo recibo
         || mete anticipos de paga extra

         nDevenga = nDevenga + #nomhicca#16;
         nDeducir = nDeducir + #nomhicca#17;
         |SI #labempre#25 = 2;
             nDeducir = nDeducir + #nomhicca#128;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO AcumPagas_Histo;
     nEmbargo = #nomhicca#146;
     |SI nEmbargo ! 0;
         nEmbargo = #nomhicca#146 - ((#nomhicca#146 * (#nomhicca#46 / (#nomhicca#46 + #nomhicca#47))) ! 2);
     |FINSI;

     nDevenga = #nomhicca#16;
     nDeducir = #nomhicca#17 + #nomhicca#128 + nEmbargo;
|FPRC;

|PROCESO nomhicca;
     |SI #nomhicca#66 = #nomytran#4;  |Y #nomhicca#2 < nDMes;
         |ACABA;
     |FINSI;

     |SI #nomhicca#66 = #nomytran#16; |Y #nomhicca#2 > nHMes;
         |ACABA;
     |FINSI;

     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |DDEFECTO #labtraba;  |FINSI;

     |SI #labtraba#70 ! "T";
         |ACABA;
     |FINSI;

     |SI #labtraba#71 < #nomytran#8; |O #labtraba#71 > #nomytran#9;
         |ACABA;
     |FINSI;

     |SI #labtraba#77 < #nomytran#12; |O #labtraba#77 > #nomytran#13;
         |ACABA;
     |FINSI;

     aAlfa = #nomhicca#5 %  102;  nDia = aAlfa;
     aAlfa = #nomhicca#5 %  402;  nMes = aAlfa;
     aAlfa = #nomhicca#5 % -102;  nAny = aAlfa;

     |SI aAlfa = "..";
         nDia = 0;
         nMes = 0;
         nAny = 0;
     |FINSI;

     nBaja = 0;

     |SI nMes = #nomytran#3; |Y nAny = #nomytran#4;  |Y nDia < nDiasTope;
         nBaja = 1;
     |FINSI;

     |SI #nomytran#14 = "N";
         |SI nBaja = 1;  |ACABA;  |FINSI;
     |FINSI;

     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;  |DDEFECTO #labempre;  |FINSI;

     #labcentr#0 = #nomhicca#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI FSalida ! 0;  |DDEFECTO #labcentr;  |FINSI;

     enCodBanco = #labtraba#71;
     |HAZ LeeBancos;
     aOficina = "";
     |SI enSwDeDonde = 0;
          aOficina = "";
     |SINO;
          aOficina = #bancosc@#5;
     |FINSI;

     |SI #nomytran#1 = "M";  |HAZ AcumMensual_Histo;  |FINSI;
     |SI #nomytran#1 = "P";  |HAZ AcumPagas_Histo;    |FINSI;

     |SI #nomytran#17 = "1";
         nAny = #nomhicca#226;
         |SI nAny = 0;
             nAny = 2000 + #nomhicca#66;
         |FINSI;

         nMes = #nomhicca#2;
     |SINO;
         nAny = 2000 + #nomytran#4;
         nMes = #nomytran#3;
     |FINSI;

     #nomw0023#0  = nAny;
     #nomw0023#1  = nMes;
     #nomw0023#2  = #nomhicca#0;
     #nomw0023#3  = #nomhicca#1;
     |LEE 000#nomw0023.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0023;
         #nomw0023#0  = nAny;
         #nomw0023#1  = nMes;
         #nomw0023#2  = #nomhicca#0;
         #nomw0023#3  = #nomhicca#1;
         |GRABA 020#nomw0023.b;
     |FINSI;

     #nomw0023#4  = #labcentr#1;
     #nomw0023#5  = #labtraba#71;
     #nomw0023#6  = #labempre#2;
     #nomw0023#7  = #labempre#135;
     #nomw0023#8  = #labcentr#2;
     #nomw0023#9  = aOficina;
     #nomw0023#10 = #labtraba#7;
     #nomw0023#11 = #labtraba#2;
     #nomw0023#12 = #labtraba#154 % 104;
     #nomw0023#13 = #labtraba#154 % 504;
     #nomw0023#14 = #labtraba#154 % 904;
     #nomw0023#15 = #labtraba#154 % 1304;
     #nomw0023#16 = #labtraba#154 % 1704;
     #nomw0023#17 = #labtraba#154 % 2104;
     #nomw0023#18 = #nomw0023#18 + (nDevenga - nDeducir);

     |SI #nomytran#17 = "1";
          nMes  = #nomw0023#1;  |HAZ CogeNombre;
          aAlfa = aMes + " " + #nomw0023#0;

          #nomw0023#19 = #nomw0023#0 + (("00" + #nomw0023#1) % -102);
     |SINO;
          nMes  = #nomytran#3;  |HAZ CogeNombre;
          nAny  = 2000 + #nomytran#4;
          aAlfa = aMes + " " + nAny;

          |SI #nomytran#15 ! #nomytran#3;
               nMes  = #nomytran#15;  |HAZ CogeNombre;
               nAny  = 2000 + #nomytran#16;
               aAlfa = aAlfa + " - " + aMes + " " + nAny;
          |FINSI;

          #nomw0023#19 = #nomytran#4 + (("00" + #nomytran#3) % -102);
     |FINSI;

     #nomw0023#20 = aAlfa;
     |HAZ BuscaTrans;
     #nomw0023#21 = nImporteTran;

     |GRABA 020#nomw0023.a;
     |LIBERA #nomw0023;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #nomytran#0, #nomytran#5, #nomytran#4,  nDMes, #nomytran#10;
     #nomytran#7, #nomytran#6, #nomytran#16, nHMes, #nomytran#10;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO Historico;
     nDMes = #nomytran#3;
     nHMes = #nomytran#15;
     |SI #nomytran#4 ! #nomytran#16;
         nDMes = 1;
         nHMes = 12;
     |FINSI;

     nMes = #nomytran#15;  |HAZ CogeNombre;
     nDiasTope = nTopeMes;

     |BUCLE nomhicca;
|FPRC;

|PROCESO AcumMensual_Atrasos;
     nDevenga = #nomcalac#46;
     nDeducir = #nomcalac#48 + #nomcalac#49 + #nomcalac#50 + #nomcalac#51;
     nDeducir = nDeducir     + #nomcalac#52 + #nomcalac#53 + #nomcalac#54;
     nDeducir = nDeducir     + #nomcalac#75 + #nomcalac#89;

     |SI nBaja = 1; |O #labempre#25 = 2;
         || si es baja este mes o la paga va
         || /junto con el recibo, acumula la paga
         || si las pagas van en un solo recibo
         || mete anticipos de paga extra

         nDevenga = nDevenga + #nomcalac#16;
         nDeducir = nDeducir + #nomcalac#17;
     |FINSI;
|FPRC;

|PROCESO nomcalac;
     #labtraba#0 = #nomcalac#0;
     #labtraba#1 = #nomcalac#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;  |DDEFECTO #labtraba;  |FINSI;

     |SI #labtraba#70 ! "T";
         |ACABA;
     |FINSI;

     |SI #labtraba#71 < #nomytran#8; |O #labtraba#71 > #nomytran#9;
         |ACABA;
     |FINSI;

     |SI #labtraba#77 < #nomytran#12; |O #labtraba#77 > #nomytran#13;
         |ACABA;
     |FINSI;

     aAlfa = #nomcalac#5 %  102;    nDia = aAlfa;
     aAlfa = #nomcalac#5 %  402;    nMes = aAlfa;
     aAlfa = #nomcalac#5 %  -102;   nAny = aAlfa;

     |SI aAlfa = "..";
         nDia = 0;
         nMes = 0;
         nAny = 0;
     |FINSI;

     nBaja = 0;

     |SI nMes ] #nomytran#3;  |Y nMes [ #nomytran#15;
                              |Y nAny = #nomytran#4;
         nBaja = 1;
     |FINSI;

     |SI #nomytran#14 = "N";
         |SI nBaja = 1;  |ACABA;  |FINSI;
     |FINSI;

     #labempre#0 = #nomcalac#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;  |DDEFECTO #labempre;  |FINSI;

     #labcentr#0 = #nomcalac#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI FSalida ! 0;  |DDEFECTO #labcentr;  |FINSI;

     enCodBanco = #labtraba#71;
     |HAZ LeeBancos;
     aOficina = "";
     |SI enSwDeDonde = 0;
          aOficina = "";
     |SINO;
          aOficina = #bancosc@#5;
     |FINSI;

     |HAZ AcumMensual_Atrasos;

     |SI #nomytran#17 = "1";
         nAny = #nomcalac#184;
         nMes = #nomcalac#2;
     |SINO;
         nAny = 2000 + #nomytran#4;
         nMes = #nomytran#3;
     |FINSI;

     #nomw0023#0  = nAny;
     #nomw0023#1  = nMes;
     #nomw0023#2  = #nomcalac#0;
     #nomw0023#3  = #nomcalac#1;
     |LEE 000#nomw0023.=;
     |SI FSalida ! 0;
         |DDEFECTO #nomw0023;
         #nomw0023#0  = nAny;
         #nomw0023#1  = nMes;
         #nomw0023#2  = #nomcalac#0;
         #nomw0023#3  = #nomcalac#1;
         |GRABA 020#nomw0023.b;
     |FINSI;

     #nomw0023#4  = #labcentr#1;
     #nomw0023#5  = #labtraba#71;
     #nomw0023#6  = #labempre#2;
     #nomw0023#7  = #labempre#135;
     #nomw0023#8  = #labcentr#2;
     #nomw0023#9  = aOficina;
     #nomw0023#10 = #labtraba#7;
     #nomw0023#11 = #labtraba#2;
     #nomw0023#12 = #labtraba#154 % 104;
     #nomw0023#13 = #labtraba#154 % 504;
     #nomw0023#14 = #labtraba#154 % 904;
     #nomw0023#15 = #labtraba#154 % 1304;
     #nomw0023#16 = #labtraba#154 % 1704;
     #nomw0023#17 = #labtraba#154 % 2104;
     #nomw0023#18 = #nomw0023#18 + (nDevenga - nDeducir);

     |SI #nomytran#17 = "1";
         nMes  = #nomw0023#1;  |HAZ CogeNombre;
         aAlfa = aMes + " " + #nomw0023#0;

         #nomw0023#19 = #nomw0023#0 + (("00" + #nomw0023#1) % -102);
     |SINO;
         nMes  = #nomytran#3;  |HAZ CogeNombre;
         nAny  = 2000 + #nomytran#4;
         aAlfa = aMes + " " + nAny;

         nMes  = #nomytran#15;  |HAZ CogeNombre;
         nAny  = 2000 + #nomytran#16;
         aAlfa = aAlfa + " - " + aMes + " " + nAny;

         #nomw0023#19 = #nomytran#4 + (("00" + #nomytran#3) % -102);
     |FINSI;

     #nomw0023#20 = aAlfa;
     |HAZ BuscaTrans;
     #nomw0023#21 = nImporteTran;

     |GRABA 020#nomw0023.a;
     |LIBERA #nomw0023;
|FPRC;

|DEFBUCLE nomcalac;
     #nomcalac#1;
     ;
     #nomytran#0, #nomytran#5, #nomytran#03, 5;
     #nomytran#0, #nomytran#6, #nomytran#15, 5;
     ;
     NULL, nomcalac;
|FIN;

|PROCESO Atrasos;
     |BUCLE nomcalac;
|FPRC;

|PROCESO nomw0023Papel;
     |PRINT;
|FPRC;

|DEFBUCLE nomw0023Papel;
     #nomw0023#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomw0023Papel;
|FIN;

|PROCESO Papel;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "nomytran";

     |BUCLE nomw0023Papel;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Mensaje;
     aEmp = "                                             ";
     aCen = "                                             ";

     aAlfa   = ("00000" + #labempre#0) % -105;
     aNomEmp = #labempre#2;
     aNomEmp = aNomEmp % 126;
     aEmp = "Empresa: " + aAlfa + " - " + aNomEmp;
     aEmp = " " + aEmp + " ";

     |CUADRO 1217 1619;
     |ATRI R;
     |PINTA 1318, "      - Procesando archivo de transferencias -      ";
     |PINTA 1418, "                                                    ";
     |PINTA 1518, "                                                    ";
     |PINTA 1518, aEmp;
     |ATRI 0;
|FPRC;

|PROCESO nomw0023Archi;
     |PRINT;
|FPRC;

|DEFBUCLE nomw0023Archi;
     #nomw0023#2;
     ;
     #labempre#0, 0000, 00, 00000;
     #labempre#0, 9999, 99, 99999;
     ;
     NULL, nomw0023Archi;
|FIN;

|PROCESO ArchivaEmpresa;
     #labempre#0 = #nomw0023#2;
     |LEE 000#labempre.=;

     |HAZ Mensaje;

     |HAZ IMPREArchi;

     |BUCLE nomw0023Archi;

     |PIEINF;
     |FININF;
     |FINIMP;

     |SI swErrorDSArchi = 0;
         |HAZ Archivando;
     |FINSI;
|FPRC;

|PROCESO Archivado;
     enDesdeMes   = #nomw0023#1;
     enAny        = #nomw0023#0;
     eaTitulo     = #nomytran#22;
     eaPeriodos   = ("00" + #nomytran#3) % -102;
     eaPeriodos   = eaPeriodos + "/" + #nomytran#4;
     eaPeriodos   = eaPeriodos + " a  " + (("00" + #nomytran#15) % -102);
     eaPeriodos   = eaPeriodos + "/" + #nomytran#16;

     |ABRE #labempre;
     |PARA enEmp = #nomytran#0;  |SI enEmp [ #nomytran#7;  |HACIENDO enEmp = enEmp + 1;
           |SELECT #2#nomw0023;
           #nomw0023#2 = enEmp;
           #nomw0023#0 = 0;
           #nomw0023#1 = 0;
           #nomw0023#3 = 0
           |LEE 000#nomw0023.];
           |SI FSalida = 0;  |Y #nomw0023#2 = enEmp;
               |HAZ ArchivaEmpresa;
           |FINSI;
     |SIGUE;
     |CIERRA #labempre;
|FPRC;

|PROCESO Emision;
     aAlfa = "RELACION DE TRANSFERENCIAS ";

     |SI #nomytran#20 = "A";
         aAlfa = aAlfa + "ATRASOS. ";
     |FINSI;

     |SI #nomytran#1 = "P";
         aAlfa = aAlfa + " (PAGAS EXTRAS)";
     |FINSI;

     #nomytran#22 = aAlfa;

     |HAZ Papel;
/*
     eaVengoDe = "nomytran";
     |HAZ MiraSiArchiva;
     |SI nArchi = 0;
         |HAZ Papel;
         |ACABA;
     |FINSI;

     |MENU aMenu;
     nOpcion = FSalida;
     |SI nOpcion = 1;  |HAZ Papel;      |FINSI;
     |SI nOpcion = 2;  |HAZ Archivado;  |FINSI;
     |SI nOpcion = 3;  |HAZ Papel;      |FINSI;
     |SI nOpcion = 3;  |HAZ Archivado;  |FINSI;
*/
|FPRC;

|PROCESO T3;
     aFicTmp = "nomw0023" + Usuario;
     |NOME_DAT #nomw0023#aFicTmp#;
     |ABRE #nomw0023;  |CIERRA #nomw0023;  |DELINDEX #nomw0023;

     |ABRET #nomw0023;
     |ABRE #labempre;
     |ABRE #labtraba;
     |ABRE #labcentr;

     |SI #nomytran#20 = "M";  |HAZ Mensual;     |FINSI;
     |SI #nomytran#20 = "H";  |HAZ Historico;   |FINSI;
     |SI #nomytran#20 = "A";  |HAZ Atrasos;     |FINSI;

     |CIERRA #labempre;
     |CIERRA #labtraba;
     |CIERRA #labcentr;

     |LEE 000#nomw0023.p;
     |SI FSalida ! 0;
         |MENAV "0000Seleccion vacia.";
     |SINO;
         |HAZ Emision;
     |FINSI;

     |CIERRAT #nomw0023;
     |DELINDEX #nomw0023;
|FPRC;

|PROCESO T0C10; |TIPO 0;
     |SI #nomytran#20 = "M"; |Y #nomytran#Campo# ! 0;
                             |Y #nomytran#Campo# ! 2;
          |MENAV "0000Tipo de Registro no valido para la fuente de datos mensual!";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO T7C10; |TIPO 7;
     |SI #nomytran#20 = "M";
          |MENSA "0000Tipo de registro: (0) mensual; (2) finiquito.";
     |FINSI;

     |SI #nomytran#20 = "H";
          |MENSA "0000Tipo de registro: (0) mensual; (2) finiquito; (5 + n) atrasos";
     |FINSI;
|FPRC;

|PROCESO T7C4; |TIPO 7;
     fFecSys = ~;
     aAlfa   = fFecSys % -102;
     #nomytran#Campo# = aAlfa;
     |PINTA #nomytran#Campo#;
|FPRC;

|PROCESO T0C3; |TIPO 0;
     |SI #nomytran#20 = "M";  |Y Campo = 15;
         |ACABA;
     |FINSI;

     nMes = #nomytran#Campo#;
     |HAZ CogeNombre;
     nDiasTope = nTopeMes;

     |SI Campo = 3;   aMes1 = (aMes + "          ") % 110;  |FINSI;
     |SI Campo = 15;  aMes2 = (aMes + "          ") % 110;  |FINSI;

     |ATRI I;
     |SI Campo = 3;  |PINTA 1135, aMes1; |FINSI;
     |SI Campo = 15; |PINTA 1151, aMes2; |FINSI;
     |ATRI 0;
|FPRC;

|PROCESO T7C3; |TIPO 7;
     fFecSys = ~;
     aAlfa   = fFecSys % 402;

     #nomytran#Campo# = aAlfa;
     |PINTA #nomytran#Campo#;
|FPRC;

|PROCESO FuenteDatos;
     #nomytran#17 = "2";

     |SI #nomytran#20 = "M";
          aAlfa = "MENSUAL  ";

          |C_V #nomytran#15, 1, "N";
          |C_V #nomytran#16, 1, "N";
          |C_V #nomytran#17, 1, "N";
          |C_V #nomytran#1,  1, "S";
          |C_V #nomytran#7,  1, "S";

          |PINTA 1118,"Mes ........:                               ";
          |PINTA 1218,"A¤o ........:                               ";
          |PINTA 1718,"                        ";

          |PINTA #nomytran#7;
          |PINTA #nomytran#3;
          |PINTA #nomytran#4;
          |PINTA #nomytran#1;
          |PINTA #nomytran#10;
     |FINSI;

     |SI #nomytran#20 = "H";
          aAlfa = "HISTORICO";

          |C_V #nomytran#15, 1, "S";
          |C_V #nomytran#16, 1, "S";
          |C_V #nomytran#17, 1, "S";
          |C_V #nomytran#1,  1, "S";
          |C_V #nomytran#10, 1, "S";
          |C_V #nomytran#7,  1, "S";

          |PINTA #nomytran#7;
          |PINTA #nomytran#3;
          |PINTA #nomytran#4;
          |PINTA #nomytran#15;
          |PINTA #nomytran#16;
          |PINTA #nomytran#17;
          |PINTA #nomytran#1;
          |PINTA #nomytran#10;
     |FINSI;

     |SI #nomytran#20 = "A";
          aAlfa = "ATRASOS  ";

          |C_V #nomytran#7,  1, "N";
          |C_V #nomytran#16, 1, "N";
          |C_V #nomytran#10, 1, "N";
          |C_V #nomytran#1,  1, "N";

          |C_V #nomytran#3,  1, "S";
          |C_V #nomytran#4,  1, "S";
          |C_V #nomytran#15, 1, "S";
          |C_V #nomytran#17, 1, "S";

          |PINTA 0718,"Empresa ....:                               ";
          |PINTA 1118,"Meses ......:                               ";
          |PINTA 1218,"A¤o  .......:                               ";
          |PINTA 1618, "                          ";
          |PINTA 1818, "                          ";

          #nomytran#17 = "1";

          |PINTA #nomytran#7;
          |PINTA #nomytran#16;
          |PINTA #nomytran#10;
          |PINTA #nomytran#1;

          |PINTA #nomytran#3;
          |PINTA #nomytran#4;
          |PINTA #nomytran#15;
          |PINTA #nomytran#17;
     |FINSI;

     |PINTA 0770, aAlfa;
     |PINTA #nomytran#20;
|FPRC;

|PROCESO T7C0; |TIPO 7;
     |SI PARAMETRO = "M"; |O PARAMETRO = "H"; |O PARAMETRO = "A";
         #nomytran#20 = PARAMETRO;
     |FINSI;

     |HAZ FuenteDatos;
     |PINDA #0#nomytran;
|FPRC;

|PROGRAMA;
     |CLS;

     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;

     |PINPA #0#0;

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |BORRA 020#0a;
     |FINSI;

     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ T3;
     |FINSI;

     |GRABA 000#0n;
     |CIERRA #0;
|FPRO;
