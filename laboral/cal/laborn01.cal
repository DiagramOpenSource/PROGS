|FICHEROS;
     laborn01;           || este def el del lineal
     labore01;           || extension de este def
     laborn02;           || Solicitudes de BAJA
     laborn07;           || horarios
     laborn10;
     labort11;
     labornx1;
     laborn92;

     labcodco;
     nomconca;
     nomcateg,MANTE;
     nomtrato;
     labor001;           || empresas labornet
     labtraba,MANTE;

     nompmail;
     labor009;

     labempre@;
     labtraba@;
     labpadre@;
     labcentr@;
     nomtraca@;
     nomtrali@;
     nomhortp@;
     agidanif@;
     dsam0101@;
     dsam0103@;

     nombotra,MANTE;
     nomboni3;
     labcentr;
     nomtraca;
     nomtrali;
     nomconli,MANTE;
|FIN;

|VARIABLES;
     &nLabornet  = 0;
     &enNumLinea = 0;
     &enEmpLabornet = 0;
     &enTraLabornet = 0;
     &enHorasSemana = 0;
     &eaTipoJornada = "";
     &eaPrimerDia = "";
     &eaUltimoDia = "";
     &eaSalario = "";
     &enDurMeses = 0;
     &enDurDias = 0;
     &eaFechaIni = "";
     &eaFechaFin = "";

     &nEmpExt    = 0;
     &nTraExt    = 0;
     &fFechaAlta = @;
     &aTipoContr = "";

     &eaDirDest  = "";
     &eaAsunto   = "";
     &eaTexto    = "";
     &eaFichero  = "";

     aObser = ""; ||Variable para la recogida de observaciones
     nCampo         = 0;
     nCampo1        = 0;
     nCampo2        = 0;
     nCampo3        = 0;
     nCampo4        = 0;
     nCampo5        = 0;
     nCampo6        = 0;
     nCampo7        = 0;
     nCampo8        = 0;
     nRegis         = 0;
     nAscci         = 0;
     nHandle        = 0;
     nError         = 0;
     nLinea         = 0;
     nCalc          = 0;

     aParam     = "";
     aCampo         = "";
     aCaracter      = "";
     aWeb           = "";
     aAbre          = "";
     aAbreSmf       = "";
     aAlfa          = "";
     aBase          = "";
     aMas           = "";
     aFichLab       = "";
     aFichInt       = "";
     aFichBas       = "";
     aTecla         = "";
     &nSinPI        = 0;
     aCopialo1      = "";
     aCopialo2      = "";
     &aFlag         = "";
     &aTitulo       = "";

     &nEmp = 0;
     &nTra = 0;
     &aCons = "";
     &aImp = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aFecha = "";
     nNume = 0;
     swCopia = 0;
     nExiste = 0;
     nPan = 0;
     &eaUsuario = "";
     &eaFecha = @;
     &eaHora = "";
     aTipo = "";
     fec = "";
     aUsuarioD = "";
     aUsuarioH = "";
     aSiEsX    = "";
     FEstado   = 0;

     &eaVengoDe = "laborn01";
     &eaEmpresa = "";
     &eaObra = "";
     &eaContrato = "";

     &eaParam       = "";
     &enFSalida     = 0;
     &eaMotiv       = "";
     &efFecha       = @;
     &enBorrado     = 0;
     &enActualizado = 0;
     &eaEstado      = "";

     &enEmpresa = 0;
     &enTrabajador = 0;
     &enNuevoCodigo = 0;
     &enRegistroCont = 0;

     aMensa = "";
     &aIdContrata = "";
     &enEmp = 0;
     &enTra = 0;
     nValorLog = 0;
     swActualizacion = 0;
     nFecha = 0;
     fFecha = @;
     swLaborBox = 0;
     &eaHorario = "";

     &fFechaDesde = @;
     &fFechaHasta = @;
     &nAnys = 0;
     &nMeses = 0;
     &nDias = 0;
     aFechaIni = "";
     aFechaFin = "";
     swEncontrado = 0;

     swLocalizado = 0;
     aQueBusco = "";
     nPosibleLinea = 0;
|FIN;

|PROCESO Log;
     |SI swActualizacion = 0;
          |ACABA;
     |FINSI;

     |ABRE #laborn92;
     #laborn92#0 = #laborn01#5;
     #laborn92#1 = #laborn01#242;
     |LEE 101#laborn92.=;
     |SI FSalida = 0;
          |SI #laborn92#2 < nValorLog;
               #laborn92#2 = nValorLog;
               |GRABA 020#laborn92.a;
          |FINSI;
     |SINO;
          #laborn92#2 = nValorLog;
          |GRABA 020#laborn92.n;
     |FINSI;
     |LIBERA #laborn92;
     |CIERRA #laborn92;
|FPRC;

|| Actualizar Datos ------------------------------------------------------

|PROCESO DirAgidanif;
     #agidanif@#24 = #laborn01#223;
     #agidanif@#25 = #laborn01#17;
     #agidanif@#26 = #laborn01#224;
     #agidanif@#27 = #laborn01#225;
     #agidanif@#28 = #laborn01#226;
     #agidanif@#29 = #laborn01#227;
|FPRC;

|PROCESO DirDsam0103;
     #dsam0103@#9  = #laborn01#223;
     #dsam0103@#2  = #laborn01#17;
     #dsam0103@#3  = #laborn01#224;
     #dsam0103@#16 = #laborn01#225;
     #dsam0103@#10 = #laborn01#226;
     #dsam0103@#11 = #laborn01#227;
|FPRC;

|PROCESO CamposWebImportes;
     |ABRE #nomtraca;
     |ABRE #nomtrali;
     |ABRE #nomconli;

     |PARA nCampo = 25; |SI nCampo [ 33; |HACIENDO nCampo = nCampo + 2;
          nCampo1 = nCampo + 1;
          |SI #labore01#nCampo# ! 000;
               #nomtraca#0 = #labtraba@#0;
               #nomtraca#1 = #labtraba@#1;
               |LEE 101#nomtraca.=;
               |SI FSalida ! 0;
                    |GRABA 020#nomtraca.n;
                    |LIBERA #nomtraca;
               |FINSI;

               #nomtrali#0 = #nomtraca#0;
               #nomtrali#1 = #nomtraca#1;
               #nomtrali#2 = #labore01#nCampo#;
               |LEE 101#nomtrali.=;
               FEstado = FSalida;

               #nomconli#0 = #labtraba@#87;
               #nomconli#2 = #nomtrali#2;
               |LEE 000#nomconli.=;
               |SI FSalida = 0;
                    |SI #nomconli#3 = "M"; |O #nomconli#3 = "D";
                         #nomtrali#3 = "";
                    |SINO;
                         #nomtrali#3 = "         1";
                    |FINSI;
               |SINO;
                    #nomtrali#3 = "         1";
               |FINSI;

               aAlfa = #labore01#nCampo1#;
               aAlfa = "          " + aAlfa;
               aAlfa = aAlfa % -112;
               #nomtrali#4 = aAlfa;

               #nomtrali#5 = #nomconli#6;

               |SI FEstado ! 0;
                    |GRABA 020#nomtrali.n;
               |SINO;
                    |GRABA 020#nomtrali.a;
               |FINSI;
          |FINSI;
     |SIGUE;

     |CIERRA #nomconli;
     |CIERRA #nomtrali;
     |CIERRA #nomtraca;
|FPRC;

|PROCESO CamposWebLabtraba;
     |SI #labore01#24 ! 0;                   || irpf fijo
          #labtraba@#29 = 0;
          #labtraba@#30 = #labore01#24;
          #labtraba@#174 = #labore01#24;
          #labtraba@#175 = #labore01#24;
     |FINSI;

     #labtraba@#127 = #labore01#6;      || email

     aAlfa = #labore01#7;               || IBAN
     |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = aAlfa % -120;
          #labtraba@#72 = aAlfa;
     |FINSI;

     aAlfa = #labore01#8;               || fecha antiguedad
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "01.01.0000";
          #labtraba@#34 = aAlfa;
     |SINO;
          aAlfa = (("00" + #laborn01#193) % -102) + "." + (("00" + #laborn01#194) % -102) + "." + #laborn01#195;
          #labtraba@#34 = aAlfa;
     |FINSI;

     #labtraba@#238 = #labore01#9;      || puesto de trabajo
     #labtraba@#33 = #labore01#40;      || grupo de tarifa
     #labtraba@#204 = #labore01#41;      || ocupacion
     #labtraba@#205 = #labore01#11;      || ocupacion

     aAlfa = #labore01#45;              || codigo nacionalidad
     |QBF aAlfa;
     |SI aAlfa ! "724"; |Y aAlfa ! "";
          aAlfa = aAlfa + " " + #laborn01#21;
     |SINO;
          aAlfa = #laborn01#16;
     |FINSI;
     #labtraba@#76 = aAlfa;             || Nacionalidad / lugar nacimiento

     #labtraba@#251 = #labore01#44;     || estado civil

     aAlfa = #labore01#13;               || texto finiquito
     |QBF aAlfa;
     |SI aAlfa ! "";
          #labtraba@#49 = aAlfa;
     |FINSI;

     #labtraba@#42 = "M"; #labtraba@#64 = "M";    || por defecto
     aAlfa = #labore01#14;               || tipo de cotizacion
     |QBF aAlfa;
     |SI aAlfa ! "";
          |SI aAlfa = "M";
               #labtraba@#64 = "M";
               |SI #laborn01#218 = "C";
                    #labtraba@#42 = "M";
               |FINSI;
               |SI #laborn01#218 = "P";
                    #labtraba@#42 = "X";
               |FINSI;
          |FINSI;
          |SI aAlfa = "D";
               #labtraba@#64 = "D";
               |SI #laborn01#218 = "C";
                    #labtraba@#42 = "D";
               |FINSI;
               |SI #laborn01#218 = "P";
                    #labtraba@#42 = "T";
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #laborn01#228 = 163; |O #laborn01#228 = 613;
          |SI #laborn01#199 ] 100; |Y #laborn01#199 [ 299;
               #labtraba@#42 = "A";
               #labtraba@#64 = "A";
          |SINO;
               #labtraba@#42 = "E";
               #labtraba@#64 = "E";
          |FINSI;
     |FINSI;

     nNume = #labore01#15;         || periodo de carencia
     |SI nNume = 0;
          #labtraba@#241 = "N"; #labtraba@#138 = "N";
     |FINSI;
     |SI nNume = 1;
          #labtraba@#241 = "S"; #labtraba@#138 = "S";
     |FINSI;


     nNume = #labore01#42;         || bonificaciones 1
     |SI nNume ! 0;
          #labtraba@#39 = nNume;
          aAlfa = #labore01#17; |QBF aAlfa;
          |SI aAlfa ! ""; |Y aAlfa ! "01.01.0000";
               #labtraba@#40 = aAlfa;
          |FINSI;
          aAlfa = #labore01#18; |QBF aAlfa;
          |SI aAlfa ! ""; |Y aAlfa ! "01.01.0000";
               #labtraba@#41 = aAlfa;
          |FINSI;
     |FINSI;

     nNume = #labore01#43;         || bonificaciones 2
     |SI nNume ! 0;
          #labtraba@#121 = "S";

          |ABRE #nombotra;
          |ABRE #nomboni3;
          #nomboni3#0 = nNume;
          |LEE 000#nomboni3.=;
          |SI FSalida = 0;
               #nombotra#0 = #labtraba@#0;
               #nombotra#1 = #labtraba@#1;
               #nombotra#2 = nNume;

               #nombotra#3 = #nomboni3#1;
               #nombotra#4 = #labore01#20;
               #nombotra#6 = #nomboni3#2;
               #nombotra#7 = #nomboni3#2 / 12;

               |SI #nomboni3#3 = 999;
                    #nombotra#5 = "31.12.9999";
               |SINO;
                    nMeses = #nomboni3#3 / 1000;
                    fFecha = #nombotra#4 + nMeses;
                    nFecha = fFecha;
                    nFecha = nFecha - 1;
                    fFecha = nFecha;
                    #nombotra#5 = fFecha;
               |FINSI;
               |GRABA 020#nombotra.n;
               |LIBERA #nombotra;
          |FINSI;

          |CIERRA #nomboni3;
          |CIERRA #nombotra;
     |FINSI;

     nNume = #labore01#35;         || ajuste
     |SI nNume = 0;
          #labtraba@#97 = 0; #labtraba@#98 = 0;
     |FINSI;
     |SI nNume = 1;
          #labtraba@#97 = 2; #labtraba@#98 = #labore01#36;
     |FINSI;
     |SI nNume = 2;
          #labtraba@#97 = 4; #labtraba@#98 = #labore01#36;
     |FINSI;

     #labtraba@#73 = #laborn01#230;
     #labtraba@#140 = #laborn01#231;
     #labtraba@#139 = #labore01#37;
     #labtraba@#12 = #labore01#38;

     |ABRE #labcentr;
     #labcentr#0 = #labtraba@#0;
     #labcentr#1 = #labtraba@#77;
     |LEE 000#labcentr.=;
     |SI FSalida = 0;
          #labtraba@#247 = #labcentr#31;
     |FINSI;
     |CIERRA #labcentr;

     || regimen autonomos
     |SI #laborn01#199 = 999;
          #labtraba@#42 = "H";
          #labtraba@#247 = "0521";
     |FINSI;
     |SI #laborn01#228 = 163; |O #laborn01#228 = 613; || agrarios
          #labtraba@#247 = 163;
     |FINSI;

     || pagas prorrateadas S/N
     #labtraba@#113 = "N"; #labtraba@#114 = "N"; #labtraba@#115 = "N"; #labtraba@#116 = "N";
     #labtraba@#117 = "N"; #labtraba@#118 = "N"; #labtraba@#119 = "N"; #labtraba@#120 = "N";

     #labtraba@#113 = #labore01#46; #labtraba@#114 = #labore01#47;
     #labtraba@#115 = #labore01#48; #labtraba@#116 = #labore01#49;
     #labtraba@#117 = #labore01#50; #labtraba@#118 = #labore01#51;
     #labtraba@#119 = #labore01#52; #labtraba@#120 = #labore01#53;
|FPRC;

|PROCESO Localiza;
     |PARA nLinea = 2; |SI nLinea [ 20; |HACIENDO nLinea = nLinea + 1;
          #agidanif@#0 = #labtraba@#7;
          #agidanif@#1 = nLinea;
          |LEE 101#agidanif@.=;
          |SI FSalida = 0;
               aAlfa = #agidanif@#13;
               aAlfa = aAlfa % -104;
               nNume = aAlfa;

               |SI #agidanif@#2 = aQueBusco;
               |Y #laborn01#nCampo4# = nNume;
                    swLocalizado = 1;
               |FINSI;
          |SINO;
               |SI nPosibleLinea = 0;
                    nPosibleLinea = nLinea;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO GrabaDatos;
     swLaborBox = 0;
     aAlfa = #laborn01#1;
     |QBF aAlfa;
     aAlfa1 = #laborn01#1 % 105;
     |SI aAlfa = "WEB";
     |O aAlfa1 = "NUBEA";
          |ABRE #labore01;
          #labore01#0 = #laborn01#0;
          #labore01#1 = #laborn01#1;
          #labore01#2 = #laborn01#2;
          #labore01#3 = #laborn01#3;
          #labore01#4 = #laborn01#4;
          |LEE 000#labore01.=;
          |SI FSalida = 0;
               swLaborBox = 1;
          |FINSI;
          |CIERRA #labore01;
     |FINSI;

     |DDEFECTO #labtraba@;
     #labtraba@#0  = #laborn01#5;
     #labtraba@#1  = #laborn01#215;
     aAlfa = #laborn01#7;                |QBF aAlfa;
     aAlfa = aAlfa + " " + #laborn01#8;  |QBF aAlfa;
     aAlfa = aAlfa + ", " + #laborn01#6;  |QBF aAlfa;
     #labtraba@#2 = aAlfa;

     aAlfa1 = #laborn01#223; |QBF aAlfa1;
     |SI aAlfa1 ! ""; aAlfa2 = aAlfa1; |FINSI;
     aAlfa1 = #laborn01#17;  |QBF aAlfa1;
     |SI aAlfa1 ! ""; aAlfa2 = aAlfa2 + " " + aAlfa1; |FINSI;
     #labtraba@#3  = aAlfa2;
     #labtraba@#4 = #laborn01#224;
     #labtraba@#5 = #laborn01#226;

     #labtraba@#6  = #laborn01#19;
     aAlfa   = #laborn01#9;                |QBF aAlfa;
     aAlfa   = aAlfa + #laborn01#10;
     #labtraba@#7  = aAlfa;
     #labtraba@#8  = #laborn01#216;
     #labtraba@#9  = #laborn01#217;
     #labtraba@#10 = #laborn01#20;
     aAlfa   = (("00" + #laborn01#13) % -102) + "." + (("00" + #laborn01#14) % -102) + "." + #laborn01#15;
     #labtraba@#11 = aAlfa;
     #labtraba@#17 = #laborn01#202;
     #labtraba@#18 = #laborn01#214;
     aAlfa   = (("00" + #laborn01#193) % -102) + "." + (("00" + #laborn01#194) % -102) + "." + #laborn01#195;
     #labtraba@#34 = aAlfa;
     #labtraba@#36 = aAlfa;
     #labtraba@#253 = aAlfa;
     #labtraba@#38 = aAlfa;
     nNume = #laborn01#203 + #laborn01#204;
     |SI nNume ! 0;
          aAlfa   = (("00" + #laborn01#196) % -102) + "." + (("00" + #laborn01#197) % -102) + "." + #laborn01#198;
          #labtraba@#37 = aAlfa;
     |FINSI;
     |SI #laborn01#218 = "P";      || horas semana y tc2
          #labtraba@#42 = "X";
          #labtraba@#64 = "M";
     |FINSI;
     #labtraba@#45 = #laborn01#199;
     #labtraba@#75 = #laborn01#11;
     #labtraba@#76 = #laborn01#16;
     #labtraba@#77 = #laborn01#200;
     #labtraba@#87 = #laborn01#201;
     |ABRE #nomconca;
     #nomconca#0 = #laborn01#201;
     |LEE 000#nomconca.=;
     |SI FSalida = 0;
          #labtraba@#25 = #nomconca#1;
     |FINSI;
     |CIERRA #nomconca;
     #labtraba@#244 = #laborn01#221;     || telefono
     #labtraba@#247 = #laborn01#228;     || regimen cotizacion
     #labtraba@#73 = #laborn01#230;     || codigo nivel de estudios
     #labtraba@#140 = #laborn01#231;     || descripcion nivel de estudios
     #labtraba@#185 = #laborn01#232;     || codigo de profesion
     #labtraba@#19 = #laborn01#233;     || descripcion profesion
     #labtraba@#27 = #laborn01#233;     || descripcion profesion
     #labtraba@#252 = #laborn01#12;
     #labtraba@#26 = #labtraba@#7;       || nro de demanda INEM
     #labtraba@#111 = #laborn01#229;       || tipo de relacion laboral
     #labtraba@#31 = #laborn01#249;       || referencia (matricula)
     #labtraba@#245 = #laborn01#209;       || 1ra. linea comentarios

     |SI #laborn01#218 = "P";      || horas semana y tc2
          #labtraba@#234 = #laborn01#205;
          #labtraba@#47 = #labtraba@#234 / 7;
     |FINSI;

     |ABRE #nomtrato;
     #nomtrato#0 = #labtraba@#247;
     #nomtrato#1 = #labtraba@#45;
     |LEE 000#nomtrato.=;
     |SI FSalida = 0;
          #labtraba@#248 = #nomtrato#3;
     |FINSI;
     |CIERRA #nomtrato;

     |DDEFECTO #labor009;
     |ABRE #labor009; |LEE 000#labor009.p; |CIERRA #labor009;
     #labtraba@#48 = #labor009#1;

     |ABRE #nomcateg;
     #nomcateg#0 = #laborn01#201;
     #nomcateg#1 = #laborn01#202;
     |LEE 000#nomcateg.=;
     |SI FSalida = 0;
          #labtraba@#33 = #nomcateg#3;
          #labtraba@#42 = #nomcateg#4;
          #labtraba@#64 = #nomcateg#5;
     |FINSI;
     |CIERRA #nomcateg;

     |SI #laborn01#199 = 999;
          #labtraba@#42 = "H";
          #labtraba@#247 = "0521";
     |FINSI;

     |ABRE #labempre@;         || empresa
     #labempre@#0 = #laborn01#5;
     |LEE 000#labempre@.=;
     |SI FSalida = 0;
          |PARA nCampo = 113; |SI nCampo [ 120; |HACIENDO nCampo = nCampo + 1;
               nCampo1 = nCampo - 60;
               #labtraba@#nCampo# = #labempre@#nCampo1#;
          |SIGUE;
     |FINSI;
     |CIERRA #labempre@;

     || calendario

     #labtraba@#156 = #labempre@#34;      || por defecto el de la empresa

     #labcentr@#0 = #labtraba@#0;
     #labcentr@#1 = #labtraba@#77;
     |LEE 000#labcentr@.=;
     |SI FSalida = 0;
          |SI #labcentr@#15 ! 0;
               #labtraba@#156 = #labcentr@#15;      || si es distinto a cero, el del centro
          |FINSI;
     |FINSI;

     |ABRE #labcentr;
     #labcentr#0 = #labtraba@#0;
     #labcentr#1 = #labtraba@#77;
     |LEE 000#labcentr.=;
     |SI FSalida = 0;
          #labtraba@#24 = #labcentr#6;
     |FINSI;
     |CIERRA #labcentr;

     |SI swLaborBox = 1;
          |HAZ CamposWebLabtraba;
     |FINSI;

     |SI swLaborBox = 1;
          |HAZ CamposWebImportes;
     |FINSI;

     |GRABA 020#labtraba@.n;
     |LIBERA #labtraba@;

     |DDEFECTO #labpadre@;
     #labpadre@#0 = #labtraba@#0;
     #labpadre@#1 = #labtraba@#1;
     |SI #laborn01#26 ! "            ";  #labpadre@#4 = "C";  |FINSI;

     |SI #laborn01#12 = "V";  #labpadre@#5 = "V";  |FINSI;
     |SI #laborn01#12 = "M";  #labpadre@#5 = "M";  |FINSI;
     |GRABA 020#labpadre@.n;
     |LIBERA #labpadre@;

     |SI nSinPI = 0;
          #dsam0103@#0 = #labtraba@#7;
          |LEE 101#dsam0103@.=;
          |SI FSalida ! 0;
              |DDEFECTO #dsam0103@;
              #dsam0103@#0  = #labtraba@#7;
              #dsam0103@#1  = #labtraba@#2;
              |HAZ DirDsam0103;
              #dsam0103@#4  = #labtraba@#8;
              #dsam0103@#5  = #labtraba@#9;
              #dsam0103@#6  = #labtraba@#6;
              #dsam0103@#7  = #labtraba@#10;

               |ABRE #dsam0101@;
               #dsam0101@#0 = #dsam0103@#4;
               #dsam0101@#1 = #dsam0103@#5;
               |LEE 000#dsam0101@.=;
               |SI FSalida = 0;
                    #dsam0103@#14 = #dsam0101@#4;     || codigo autonomia
                    #dsam0103@#15 = #dsam0101@#5;     || nombre autonomia
               |FINSI;
               |CIERRA #dsam0101@;

              aAlfa = #laborn01#9;
              aAlfa = aAlfa % 101;

              #dsam0103@#12 = "ES";
              #dsam0103@#13 = "ESPA¥A";
/*
              |SI swLaborBox = 1;
                   #dsam0103@#12 = #labore01#39;
                   #dsam0103@#13 = #labore01#5;
              |FINSI;
*/
              #dsam0103@#8 = #laborn01#221;         || telefono 1
              |GRABA 020#dsam0103@.n;
          |FINSI;
          |LIBERA #dsam0103@;

          |SI #laborn01#26 ! "            ";
              aAlfa   = #laborn01#26;                |QBF aAlfa;
              aAlfa   = aAlfa + #laborn01#27;
              #dsam0103@#0  = aAlfa;
              |LEE 101#dsam0103@.=;
              |SI FSalida ! 0;
                  |DDEFECTO #dsam0103@;
                  #dsam0103@#0  = aAlfa;
                  aAlfa   = #laborn01#28;               |QBF aAlfa;
                  aAlfa   = aAlfa + " " + #laborn01#29; |QBF aAlfa;
                  aAlfa   = aAlfa + "," + #laborn01#30; |QBF aAlfa;
                  #dsam0103@#1  = aAlfa;
                  |HAZ DirDsam0103;
                  #dsam0103@#4  = #labtraba@#8;
                  #dsam0103@#5  = #labtraba@#9;
               |ABRE #dsam0101@;
               #dsam0101@#0 = #dsam0103@#4;
               #dsam0101@#1 = #dsam0103@#5;
               |LEE 000#dsam0101@.=;
               |SI FSalida = 0;
                    #dsam0103@#14 = #dsam0101@#4;     || codigo autonomia
                    #dsam0103@#15 = #dsam0101@#5;     || nombre autonomia
               |FINSI;
               |CIERRA #dsam0101@;
                  #dsam0103@#6  = #labtraba@#6;
                  #dsam0103@#7  = #labtraba@#10;
                  #dsam0103@#13 = #laborn01#21;
                  #dsam0103@#8 = #laborn01#221;         || telefono 1
                  |GRABA 020#dsam0103@.n;
              |FINSI;
             |LIBERA #dsam0103@;
         |FINSI;
     |FINSI;

     /***********************************************************************/
     /***********           TITULAR, CONYUGE,             *******************/
     /***********       ASCENDIENTES Y DESCENDIENTES      *******************/
     /***********************************************************************/

     || TITULAR

     #agidanif@#0 = #labtraba@#7;
     #agidanif@#1 = 1;
     |LEE 101#agidanif@.=;
     |SI FSalida ! 0;
          |DDEFECTO #agidanif@;
          #agidanif@#0  = #labtraba@#7;
          #agidanif@#1  = 1;
          #agidanif@#2  = "TITULAR";
          #agidanif@#8  = #labtraba@#7;
          #agidanif@#9  = #laborn01#7;
          #agidanif@#10 = #laborn01#8;
          #agidanif@#11 = #laborn01#6;
          #agidanif@#12 = #labtraba@#2;
          #agidanif@#13 = #labtraba@#11;
          #agidanif@#16 = #laborn01#34;
          |SI #laborn01#26 ! "            ";  #agidanif@#14 = "C";  |FINSI;
          #agidanif@#15 = #laborn01#25;
          #agidanif@#36 = #labtraba@#111;
          #agidanif@#17 = #laborn01#23;
          |SI #laborn01#24 = "S"; #agidanif@#18 = "S";  |FINSI;

          |HAZ DirAgidanif;

          #agidanif@#30 = #labtraba@#8;
          #agidanif@#31 = #labtraba@#9;
          #agidanif@#32 = #labtraba@#6;
          #agidanif@#33 = #labtraba@#10;
          |SI #laborn01#35 = "S"; #agidanif@#38 = "S";  |FINSI;
          |SI #laborn01#36 = "S"; #agidanif@#39 = "S";  |FINSI;
          aAlfa   = (("00" + #laborn01#37) % -102) + "." + (("00" + #laborn01#38) % -102) + "." + #laborn01#39;
          #agidanif@#40 = aAlfa;
          #agidanif@#34 = #laborn01#221;      || telefono 1
          #agidanif@#35 = #laborn01#222;      || telefono 2
          |SI swLaborBox = 1;
               |SI #labore01#22 = 1;
                    #agidanif@#44 = "S";      || vivienda
                    || pongo por defecto este campo de deduccion, da igual
                    || cualquiera de los dos, es igual para la nomina
               |FINSI;
               |SI #labore01#23 = 1;
                    #agidanif@#23 = 2;        || ceuta/melilla
                    || pongo por defecto el 2, me da igual
                    || cualquier valor que no sea cero, es igual para la nomina
               |FINSI;
          |FINSI;
          |GRABA 020#agidanif@.n;
      |FINSI;
      |LIBERA #agidanif@;

     || CONYUGE

     |SI #laborn01#26 ! "            ";
          swLocalizado = 0;
          aQueBusco = "CONYUGE     ";
          nPosibleLinea = 0;
          |HAZ Localiza;
          |SI swLocalizado = 0; |Y nPosibleLinea ! 0;
               nLinea = nPosibleLinea;
               #agidanif@#0 = #labtraba@#7;
               #agidanif@#1 = nLinea;
               |LEE 101#agidanif@.=;
               |SI FSalida ! 0;
                    |DDEFECTO #agidanif@;
                    #agidanif@#0  = #labtraba@#7;
                    #agidanif@#1  = 2;
                    #agidanif@#2  = "CONYUGE";
                    aAlfa   = #laborn01#26;                |QBF aAlfa;
                    aAlfa   = aAlfa + #laborn01#27;
                    #agidanif@#8  = aAlfa;
                    #agidanif@#9  = #laborn01#29;
                    #agidanif@#10 = #laborn01#30;
                    #agidanif@#11 = #laborn01#28;
                    aAlfa   = #laborn01#28;               |QBF aAlfa;
                    aAlfa   = aAlfa + " " + #laborn01#29; |QBF aAlfa;
                    aAlfa   = aAlfa + "," + #laborn01#30; |QBF aAlfa;
                    #agidanif@#12 = aAlfa;
                    aAlfa   = (("00" + #laborn01#31) % -102) + "." + (("00" + #laborn01#32) % -102) + "." + #laborn01#33;
                    #agidanif@#13 = aAlfa;
                    #agidanif@#14 = "C";
                    #agidanif@#25 = #labtraba@#3;
                    #agidanif@#30 = #labtraba@#8;
                    #agidanif@#31 = #labtraba@#9;
                    #agidanif@#32 = #labtraba@#6;
                    #agidanif@#33 = #labtraba@#10;
                    |GRABA 020#agidanif@.n;
               |FINSI;
               |LIBERA #agidanif@;
          |FINSI;
     |FINSI;

     || DESCENDIENTES
     nLinea = 3;
     |PARA nCampo1 = 113;  |SI nCampo1 [ 185;  |HACIENDO nCampo1 = nCampo1 + 8;
          nCampo2 = nCampo1 + 1;
          nCampo3 = nCampo1 + 2;
          nCampo4 = nCampo1 + 3;
          nCampo5 = nCampo1 + 4;
          nCampo6 = nCampo1 + 5;
          nCampo7 = nCampo1 + 6;
          nCampo8 = nCampo1 + 7;

          |SI #laborn01#nCampo4# ! 1900;
               swLocalizado = 0;
               aQueBusco = "DESCENDIENTE";
               nPosibleLinea = 0;
               |HAZ Localiza;
               |SI swLocalizado = 0; |Y nPosibleLinea ! 0;
                    nLinea = nPosibleLinea;
                    #agidanif@#0 = #labtraba@#7;
                    #agidanif@#1 = nLinea;
                    |LEE 101#agidanif@.=;
                    |SI FSalida ! 0;
                         |DDEFECTO #agidanif@;
                         #agidanif@#0  = #labtraba@#7;
                         #agidanif@#1  = nLinea;
                         #agidanif@#2  = "DESCENDIENTE";
                         #agidanif@#9  = #laborn01#nCampo2#;
                         #agidanif@#10 = #laborn01#nCampo3#;
                         #agidanif@#11 = #laborn01#nCampo1#;
                         aAlfa   = #agidanif@#9;                |QBF aAlfa;
                         aAlfa   = aAlfa + " " + #agidanif@#10; |QBF aAlfa;
                         aAlfa   = aAlfa + "," + #agidanif@#11; |QBF aAlfa;
                         #agidanif@#12 = aAlfa;
                         aAlfa   = "01.01." + #laborn01#nCampo4#;
                         #agidanif@#13 = aAlfa;
                         #agidanif@#17 = #laborn01#nCampo7#;
                         |SI #laborn01#nCampo8# = "S"; #agidanif@#18 = "S";  |FINSI;

                         |HAZ DirAgidanif;

                         #agidanif@#30 = #labtraba@#8;
                         #agidanif@#31 = #labtraba@#9;
                         #agidanif@#32 = #labtraba@#6;
                         #agidanif@#33 = #labtraba@#10;
                         #agidanif@#41 = #laborn01#nCampo5#;
                         |GRABA 020#agidanif@.n;
                    |FINSI;
                    |LIBERA #agidanif@;
               |FINSI;
          |FINSI;
     |SIGUE;

     || ASCENDIENTES
     |PARA nCampo1 = 42;  |SI nCampo1 [ 105;  |HACIENDO nCampo1 = nCampo1 + 7;
          nCampo2 = nCampo1 + 1;
          nCampo3 = nCampo1 + 2;
          nCampo4 = nCampo1 + 3;
          nCampo5 = nCampo1 + 4;
          nCampo6 = nCampo1 + 5;
          nCampo7 = nCampo1 + 6;

          |SI #laborn01#nCampo4# ! 1900;
               swLocalizado = 0;
               aQueBusco = "ASCENDIENTE ";
               nPosibleLinea = 0;
               |HAZ Localiza;
               |SI swLocalizado = 0; |Y nPosibleLinea ! 0;
                    nLinea = nPosibleLinea;
                    #agidanif@#0 = #labtraba@#7;
                    #agidanif@#1 = nLinea;
                    |LEE 101#agidanif@.=;
                    |SI FSalida ! 0;
                         |DDEFECTO #agidanif@;
                         #agidanif@#0  = #labtraba@#7;
                         #agidanif@#1  = nLinea;
                         #agidanif@#2  = "ASCENDIENTE";
                         #agidanif@#5  = #laborn01#nCampo5#;
                         #agidanif@#9  = #laborn01#nCampo2#;     || ape1
                         #agidanif@#10 = #laborn01#nCampo3#;     || ape2
                         #agidanif@#11 = #laborn01#nCampo1#;     || nombre
                         aAlfa   = #agidanif@#9;                |QBF aAlfa;
                         aAlfa   = aAlfa + " " + #agidanif@#10; |QBF aAlfa;
                         aAlfa   = aAlfa + "," + #agidanif@#11; |QBF aAlfa;
                         #agidanif@#12 = aAlfa;
                         aAlfa   = "01.01." + #laborn01#nCampo4#;
                         #agidanif@#13 = aAlfa;
                         #agidanif@#17 = #laborn01#nCampo6#;
                         |SI #laborn01#nCampo7# = "S"; #agidanif@#18 = "S";  |FINSI;

                         #agidanif@#30 = #labtraba@#8;
                         #agidanif@#31 = #labtraba@#9;
                         #agidanif@#32 = #labtraba@#6;
                         #agidanif@#33 = #labtraba@#10;

                         |GRABA 020#agidanif@.n;
                    |FINSI;
                    |LIBERA #agidanif@;
               |FINSI;
          |FINSI;
     |SIGUE;

     /***********************************************************************/
     /***********************************************************************/

|FPRC;

|PROCESO CopiaNomtrali2;
     #nomtrali@#0 = nEmp;
     #nomtrali@#1 = #laborn01#215;
     |GRABA 020#nomtrali@.n;
     |SI FSalida ! 0;
          aAlfa1 = #nomtrali@#0;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
          aAlfa2 = #nomtrali@#1;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
          aAlfa = "    Ya estan definidos Importes por Trabajador";
          aAlfa = aAlfa + " para el trabajador destino " + aAlfa1 + "." + aAlfa2;
          |MENAV aAlfa;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CopiaNomtrali;
     #nomtrali@#1003;
     ;
     nEmp, nTra, 001;
     nEmp, nTra, 999;
     ;
     NULL, CopiaNomtrali2;
|FIN;

|PROCESO CopiaNomtrali;
     |SI aImp = "S"; |Y swCopia = 1;
          |ABRE #nomtraca@;
          |DDEFECTO #nomtraca@;
          #nomtraca@#0 = nEmp;
          #nomtraca@#1 = #laborn01#215;
          |LEE 000#nomtraca@.=;
          |SI FSalida ! 0;    || si no existe grabo cabecera
               #nomtraca@#0 = #laborn01#5;
               #nomtraca@#1 = #laborn01#215;
               #nomtraca@#3 = 0;

               |ABRE #labempre@;         || constante de la empresa
               #labempre@#0 = nEmp;
               |LEE 000#labempre@.=;
               |SI FSalida = 0;
                    #nomtraca@#3 = #labempre@#32;
               |FINSI;
               |CIERRA #labempre@;

               |GRABA 020#nomtraca@.n;
          |FINSI;
          |BUCLE CopiaNomtrali;
     |FINSI;
|FPRC;

|PROCESO CopiaNomtraca;
     |ABRE #nomtraca@;
     |DDEFECTO #nomtraca@;
     #nomtraca@#0 = nEmp;
     #nomtraca@#1 = #laborn01#215;
     |LEE 000#nomtraca@.=;
     |SI FSalida ! 0;
          |SI aCons = "S";
               #nomtraca@#0 = nEmp;
               #nomtraca@#1 = nTra;
               |LEE 000#nomtraca@.=;
               |SI FSalida = 0;
                    #nomtraca@#0 = #laborn01#5;
                    #nomtraca@#1 = #laborn01#215;
                    |GRABA 020#nomtraca@.n;
               |SINO;
                    aAlfa1 = nEmp;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
                    aAlfa2 = nTra;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
                    aAlfa = "    NO se pueden copiar Importes por Trabajador.";
                    aAlfa = aAlfa + " NO existen en trabajador origen " + aAlfa1 + "." + aAlfa2;
                    |MENAV aAlfa;
                    swCopia = 0;
               |FINSI;
          |FINSI;
     |SINO;
          aAlfa1 = #nomtraca@#0;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
          aAlfa2 = #nomtraca@#1;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
          aAlfa = "    Ya estan definidos Importes por Trabajador";
          aAlfa = aAlfa + " para el trabajador destino " + aAlfa1 + "." + aAlfa2;
          |MENAV aAlfa;
          swCopia = 0;
     |FINSI;
     |CIERRA #nomtraca@;
|FPRC;

|PROCESO ConstruyeFecha;
     nCampo1 = nCampo - 2;
     nCampo2 = nCampo - 1;
     nCampo3 = nCampo;
     aAlfa1 = #laborn01#nCampo1#; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #laborn01#nCampo2#; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = #laborn01#nCampo3#;
     aFecha = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
|FPRC;

|PROCESO Horario;
     |ABRE #laborn07;
     |ABRE #nomhortp@;         || carga_def del nomhortp

     #laborn07#0 = "P";
     #laborn07#1 = #laborn01#1;
     #laborn07#2 = #laborn01#2;
     #laborn07#3 = #laborn01#3;
     #laborn07#4 = #laborn01#4;
     |LEE 000#laborn07.=;
     |SI FSalida = 0;
          #nomhortp@#0 = #labtraba@#0;
          #nomhortp@#1 = #labtraba@#1;
          |LEE 101#nomhortp@.=;
          FEstado = FSalida;

          |PARA nCampo = 2; |SI nCampo [ 66; |HACIENDO nCampo = nCampo + 1;
               nCampo1 = nCampo + 5;
               #nomhortp@#nCampo# = #laborn07#nCampo1#;
          |SIGUE;

          |SI FEstado = 0;
               |GRABA 020#nomhortp@.a;
          |SINO;
               |GRABA 020#nomhortp@.n;
          |FINSI;

          |BORRA 020#laborn07.a;
          #laborn07#0 = "A";
          |LEE 101#laborn07.=;
          |SI FSalida = 0;
               |GRABA 020#laborn07.a;
          |SINO;
               |GRABA 020#laborn07.n;
          |FINSI;
          |LIBERA #laborn07;
     |FINSI;

     |CIERRA #nomhortp@;
     |CIERRA #laborn07;
|FPRC;

|PROCESO SincronizaEmp;
     nEmpExt    = #laborn01#5;
     nTraExt    = #laborn01#215;

     aAlfa = nEmpExt;
     aAlfa = "labor001;EXPR" + aAlfa;
     |SUB_EJECUTA aAlfa;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO EnviaCorreo;
          aAlfa =         #laborn01#7; |QBF aAlfa;
          aAlfa = aAlfa + " " + #laborn01#8; |QBF aAlfa;
          aAlfa = aAlfa + ", " + #laborn01#6; |QBF aAlfa;
          eaTexto = &13 + &10 + "El administrador ha hecho efectiva el alta del trabajador " + aAlfa; |QBF eaTexto;
          aAlfa = ("00000" + #laborn01#5) % -106;
          eaTexto = eaTexto + " de la empresa (" + aAlfa + ") " + #laborn01#210; |QBF eaTexto;
          aAlfa = ("00000" + #laborn01#215) % -105;
          eaTexto = eaTexto + " con el codigo (" + aAlfa + ")";

          eaTexto = eaTexto + &13 + &10 + &13 + &10;
          eaTexto = eaTexto + " Actualización con fecha " + #laborn01#3 + " a las " + #laborn01#4 + &13 + &10;

          aAlfa  = ("00000" + #laborn01#5) % -106;
          aAlfa1 = ("00000" + #laborn01#215) % -105;
          eaAsunto  = "Efectivo alta trabajador (" + aAlfa + "/" + aAlfa1 + ") ";
          aAlfa =         #laborn01#7; |QBF aAlfa;
          aAlfa = aAlfa + #laborn01#8; |QBF aAlfa;
          aAlfa = aAlfa + ", " + #laborn01#6; |QBF aAlfa;
          eaAsunto  = eaAsunto + aAlfa;
          eaFichero = "";
          eaDirDest = "";

          aAlfa = #laborn01#5; |QBF aAlfa;
          eaEmpresa = ("00000" + aAlfa) % -105;
          |HAZ ConsEmail2;
|FPRC;

|PROCESO TA2;
          || Emision TA2
          nEmpExt    = #laborn01#5;
          nTraExt    = #laborn01#215;
          aAlfa   = (("00" + #laborn01#193) % -102) + "." + (("00" + #laborn01#194) % -102) + "." + #laborn01#195;
          fFechaAlta = aAlfa;
          aTipoContr = #laborn01#218;

          || ¨Quien usa el TA2 a estas alturas?

          |SI #laborn01#228 = 613; |O #laborn01#228 = 163;
               |SUB_EJECUTA "labta611;ALTA";
          |SINO;
               |SUB_EJECUTA "labparta;ALTA";
          |FINSI;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
|FPRC;

|PROCESO NuevoCodigo;
     |PUSHV 05012380;
     #labort11#0 = #laborn01#5;
     #labort11#1 = #laborn01#215;
     #labort11#2 = #laborn01#210;
     aAlfa = #laborn01#7;                |QBF aAlfa;
     aAlfa = aAlfa + " " + #laborn01#8;  |QBF aAlfa;
     aAlfa = aAlfa + ", " + #laborn01#6;  |QBF aAlfa;
     #labort11#3 = aAlfa;

     |PINPA #0#labort11;
     |PINDA #0#labort11;
     |ENDATOS #1#labort11;
|FPRC;

|PROCESO Contrato;
          ||  Selecciono del tipo de contrato indicado el que necesito
          aAlfa = "SELECT * FROM labcodco INTO 00" + Usuario + " WHERE 1 == " + #laborn01#199;
          |SQL aAlfa;
          aAlfa = FSalida;
          |QBF aAlfa;
          aAlfa = aAlfa - "Seleccionados:";
          nCalc = FSalida + 85; aAlfa = aAlfa % nCalc;
          nCalc = aAlfa;
          |SI nCalc = 0;
               |MENAV "    Código de contrato no encontrado"; |ERROR; |ACABA;
          |FINSI;

          aAlfa = "00" + Usuario; |NOME_DAT #labcodco#aAlfa#;
          |ABRE #labcodco;
          |SI nCalc > 1;
               aMensa = "    Seleccione el tipo de contrato " + #laborn01#199;
               aMensa = aMensa + " que se le hará al trabajador";
               |MENSA aMensa;
               |CONSULTA_CLAVE #1#labcodco;
               |SI FSalida = 0;
                    enNumLinea = #labcodco#0;
               |FINSI;
          |SINO;
               |LEE 000#labcodco.p;
               enNumLinea = #labcodco#0;
          |FINSI;

          enEmpLabornet = #laborn01#5;
          enTraLabornet = #laborn01#215;
          enHorasSemana = #laborn01#205;
          eaTipoJornada = #laborn01#218;
          eaPrimerDia = #laborn01#206;
          eaUltimoDia = #laborn01#207;
          eaSalario = #laborn01#208;
          enDurMeses = #laborn01#203;
          enDurDias = #laborn01#204;
          eaObra = #laborn01#234;
          eaContrato = #laborn01#199;

          |SI swLaborBox = 1;
               eaHorario = #labore01#12;

               aAlfa = #laborn01#196;
               |QBF aAlfa;
               aAlfa = (("00" + aAlfa) % -102);     || fecha de baja
               |SI aAlfa ! "00";
                    aAlfa1 = #laborn01#193; aAlfa1 = ("00" + aAlfa1) % -102;
                    aAlfa2 = #laborn01#194; aAlfa2 = ("00" + aAlfa2) % -102;
                    aAlfa3 = #laborn01#195;
                    aFechaIni = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
                    fFechaDesde = aFechaIni;
                    aAlfa1 = #laborn01#196; aAlfa1 = ("00" + aAlfa1) % -102;
                    aAlfa2 = #laborn01#197; aAlfa2 = ("00" + aAlfa2) % -102;
                    aAlfa3 = #laborn01#198;
                    aFechaFin = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
                    fFechaHasta = aFechaFin;
                    |HAZ Periodo_Dur;

                    enDurMeses = (nAnys * 12) + nMeses;
                    enDurDias = nDias;
               |FINSI;
          |FINSI;

          nCampo = 195;
          |HAZ ConstruyeFecha;
          eaFechaIni = aFecha;

          nNume = enDurMeses + enDurDias;
          |SI nNume ! 0;
               nCampo = 198;
               |HAZ ConstruyeFecha;
               eaFechaFin = aFecha;
          |FINSI;

          aAlfa = #labcodco#3; |QBF aAlfa;
          |SUB_EJECUTA aAlfa;

          |CIERRA #labcodco;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
|FPRC;

|PROCESO LlamaNetContrata;
          aAlfa = "    S¿Desea enviar el alta online a través de ConectaSS?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               aAlfa1 = #labtraba#0;  aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
               aAlfa2 = #labtraba#1;  aAlfa2 = "00000" + aAlfa2; aAlfa2 = aAlfa2 % -105;
               aAlfa = aAlfa1 + aAlfa2;
               aAlfa = "labnct07;"+ "01" + aAlfa;
               |SUB_EJECUTA aAlfa;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;

               |MENAV "    A continuación se accederá a completar el contrato de trabajo del nuevo trabajador.";
          |FINSI;
|FPRC;

|PROCESO BorraNomtrali;
     |BORRA 020#nomtrali.a;
     |LIBERA #nomtrali;
|FPRC;

|DEFBUCLE BorraNomtrali;
     #nomtrali#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     be;
     NULL, BorraNomtrali;
|FIN;

|PROCESO BorraNombotra;
     |BORRA 020#nombotra.a;
     |LIBERA #nombotra;
|FPRC;

|DEFBUCLE BorraNombotra;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     be;
     NULL, BorraNombotra;
|FIN;

|PROCESO BorraRestos;
     |ABRE #labpadre@;
     #labpadre@#0 = #labtraba#0;
     #labpadre@#1 = #labtraba#1;
     |LEE 101#labpadre@.=;
     |SI FSalida = 0;
          |BORRA 020#labpadre@.a;
     |FINSI;
     |CIERRA #labpadre@;

     |ABRE #nombotra;
     |BUCLE BorraNombotra;
     |CIERRA #nombotra;

     |ABRE #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 101#nomtraca.=;
     |SI FSalida = 0;
          |BORRA 020#nomtraca.a;
     |FINSI;
     |CIERRA #nomtraca;

     |ABRE #nomtrali;
     |BUCLE BorraNomtrali;
     |CIERRA #nomtrali;
|FPRC;

|PROCESO Trabajador;
          |ABRE #labpadre@;
          |ABRE #labcentr@;
          |SI nSinPI = 0;     |ABRE #dsam0103@;    |FINSI;
          ||SI #0#1   = "S";   |ABRE #agidanif@;    |FINSI;
          |ABRE #agidanif@;
          |HAZ GrabaDatos;

          |SI swCopia = 1;
               |HAZ CopiaNomtraca;
               |HAZ CopiaNomtrali;
          |FINSI;

          |CIERRA #labtraba@;
          |CIERRA #labpadre@;
          |CIERRA #labcentr@;
          |SI nSinPI = 0;     |CIERRA #dsam0103@;  |FINSI;
          |CIERRA #agidanif@;

          |SI #laborn01#218 = "P";
               |HAZ Horario;
          |FINSI;

          |ABRE #labtraba;
          #labtraba#0 = #laborn01#5;
          #labtraba#1 = #laborn01#215;
          |LEE 000#labtraba.=;

          |CLS;
          |PINPA #0#labtraba;
          |PINDA #0#labtraba;
          |ENDATOS #2#labtraba;
          |SI FSalida = 0;
               |GRABA 020#labtraba.a;
               |LIBERA #labtraba;
               enActualizado = 1;
          |SINO;
               |BORRA 020#labtraba.a;
               |LIBERA #labtraba;

               |HAZ BorraRestos;

          |FINSI;

          |CIERRA #labtraba;
|FPRC;

|PROCESO Actualiza;
     nLabornet = 1;

     |HAZ LeeFichaActual;
     |SI swEncontrado = 0;  |ACABA;  |FINSI;

     eaUsuario = #laborn01#1;      || ha introducido, permito modificar
     eaFecha = #laborn01#3;
     eaHora = #laborn01#4;
     |SUB_EJECUTA "laborn11;MODIF";
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |HAZ LeeFichaActual;|| tengo que volver a leerlo, si no vuelve al
                         || valor que tenia antes de las modificaciones

     |CONFI "0000S¿Confirma que desea actualizar la solicitud?";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enNuevoCodigo = 0;

     nValorLog = 1; |HAZ Log;

     |ABRE #labtraba@;
     #labtraba@#0 = #laborn01#5;
     #labtraba@#1 = 99999;
     |LEE 040#labtraba@.];
     |SI FSalida = 0;
         |LEE 040#labtraba@.a;
     |SINO;
         |LEE 040#labtraba@.u;
     |FINSI;

     #laborn01#215 = 1;
     |SI FSalida = 0;  |Y #labtraba@#0 = #laborn01#5;
         #laborn01#215 = #labtraba@#1 + 1;
     |FINSI;

     |MENAV "    Introduzca el código de trabajador, por defecto se asignará el último + 1";
     |HAZ NuevoCodigo;

     |SI FSalida = 0;
          #laborn01#215 = #labort11#1;
     |SINO;
          |HAZ NuevoCodigo;
     |FINSI;

     #labtraba@#0 = #laborn01#5;
     #labtraba@#1 = #laborn01#215;
     |LEE 040#labtraba@.=;
     |SI FSalida = 0;
          |MENAV "    El trabajador ya existe. Introduzca un nuevo código.";
          |HAZ NuevoCodigo;
     |FINSI;

     |POPV;

     enNuevoCodigo = #laborn01#215;

     |CONFI "    SEl trabajador se actualizará con el código introducido. ¿Desea continuar?";
     |SI FSalida = 0;
          nValorLog = 2; |HAZ Log;
          enActualizado = 0;
          |HAZ Trabajador;
          |HAZ LeeFichaActual;
          #laborn01#215 = enNuevoCodigo;

          |SI enActualizado = 1;
               || Impresion del TA2
               || esta obsoleto, pero lo dejo, que a alguien le hara falta
               || algun dia, ya veras
               ||HAZ TA2;

               || NetContrat@
     nValorLog = 3; |HAZ Log;
               |HAZ LlamaNetContrata;
               |HAZ LeeFichaActual;
               #laborn01#215 = enNuevoCodigo;

               || Impresion del contrato
     nValorLog = 4; |HAZ Log;
               |HAZ Contrato;
               |HAZ LeeFichaActual;
               #laborn01#215 = enNuevoCodigo;
               #laborn01#243 = enRegistroCont;

     nValorLog = 5; |HAZ Log;
               || actualizacion del registro de solicitud de alta

               || primero me paso todos los campos del registro que voy a borrar
               || a un temporal, ya que ha habido varios fallos en los que al
               || borrar el registro pierde la clave, asi me aseguro

               |DDEFECTO #labornx1;
               |PARA nCampo = 0; |SI nCampo [ 249; |HACIENDO nCampo = nCampo + 1;
                    #labornx1#nCampo# = #laborn01#nCampo#;
               |SIGUE;

               |BORRA 020#laborn01.a;
               |BORRA 000#labore01.c;

               |PARA nCampo = 0; |SI nCampo [ 249; |HACIENDO nCampo = nCampo + 1;
                    #laborn01#nCampo# = #labornx1#nCampo#;
               |SIGUE;

               #laborn01#0 = "A";
               #laborn01#235 = Usuario % 0810;
               #laborn01#236 = ~;
               |HORA aAlfa;
               #laborn01#237 = aAlfa;
               |GRABA 020#laborn01.n;
               |LIBERA #laborn01;

               #labore01#0 = "A";
               #labore01#1 = #laborn01#1;
               #labore01#2 = #laborn01#2;
               #labore01#3 = #laborn01#3;
               #labore01#4 = #laborn01#4;
               |GRABA 020#labore01.n;
               |LIBERA #labore01;

               |MENAV "    El trabajador ha sido actualizado correctamente";

     nValorLog = 6; |HAZ Log;
               |SI #laborn01#238 = "S";
                    |ABRE #laborn02;
                    #laborn02#0 = "P";
                    #laborn02#1 = #laborn01#1;
                    #laborn02#2 = #laborn01#2;
                    #laborn02#3 = #laborn01#3;
                    #laborn02#4 = #laborn01#4;
                    |LEE 101#laborn02.=;
                    |SI FSalida = 0;
                         aAlfa = "    Recuerde que existe un movimiento de baja ";
                         aAlfa = aAlfa + "asociado a esta alta";
                         |MENAV aAlfa;
                         #laborn02#6 = #laborn01#215;
                         |GRABA 020#laborn02.a;
                         |LIBERA #laborn02;
                    |FINSI;
                    |CIERRA #laborn02;
               |FINSI;

               || sincronizacion de este trabajador

     nValorLog = 7; |HAZ Log;
               enEmpresa = #labtraba#0;
               enTrabajador = #labtraba#1;
               |HAZ ActualizaLabornet;

     nValorLog = 8; |HAZ Log;
               |ABRE #nompmail; |LEE 000#nompmail.p; |CIERRA #nompmail;
               |SI #nompmail#11 = "S";
                    |HAZ EnviaCorreo;
               |FINSI;
          |SINO;
               #laborn01#215 = 0;
          |FINSI;
     |SINO;
          #laborn01#215 = 0;
     |FINSI;

     nValorLog = 9; |HAZ Log;
     |CLS;
|FPRC;

|| Datos Pantalla --------------------------------------------------------

|PROCESO Mensa;  |TIPO 7;

     |SI #laborn01#0 = "P";        || pendientes de actualizar
          |SI aParam = "USUARIO";
               |MENSA "0000 <F2> Ver/Modificar Datos. <F4> Borrar Registro.";
          |SINO;
               |MENSA "0000 <F2> Ver Datos. <F3> Actualizar Alta. <F4> Borrar Registro.";
          |FINSI;
     |SINO;                   || ya actualizados
          |MENSA "0000 <F2> Consultar Datos.";
     |FINSI;
|FPRC;

|PROCESO Consulta;
               eaUsuario = #laborn01#1;      || ha introducido, permito modificar
               eaFecha = #laborn01#3;
               eaHora = #laborn01#4;
               |SUB_EJECUTA "laborn11;CONSU";
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;

               |ACABA;
               |POPV;
|FPRC;

|PROCESO Opciones; |TIPO 0;
     |SI enFSalida ! 0;
          FSalida = enFSalida;
     |FINSI;

     || consulta de datos introducidos
     |SI FSalida = 10;
          |SI aParam = "USUARIO"; |O aParam = "ADMIN";  || consulta el usuario los datos que
               eaUsuario = #laborn01#1;      || ha introducido, permito modificar
               eaFecha = #laborn01#3;
               eaHora = #laborn01#4;
               |SUB_EJECUTA "laborn11;MODIF";
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |ACABA;
          |FINSI;
          |SI aParam = "HISTO"; |O aParam = "HISTOUSU";
               |HAZ Consulta;           || consulta de datos introducidos
               |ACABA;
          |FINSI;                       || o ya actualizados, solo visualizar
          |ACABA;
     |FINSI;

     |SI FSalida = 11;  |Y #laborn01#0 = "P"; |Y aParam = "ADMIN";
          swActualizacion = 1;
          |HAZ Actualiza;
          |ACABA;
     |FINSI;

     |SI FSalida = 12;  |Y #laborn01#0 = "P";
          enBorrado = 1;
          |SI aSiEsX = "";
              |CONFI "0000N¿Está seguro de que desea rechazar la solicitud seleccionada?";
              |SI FSalida ! 0;
                  enBorrado = 0;
                  |ERROR;
                  |ACABA;
              |FINSI;
          |FINSI;

          |HAZ LeeFichaActual;
          |BORRA 020#laborn01.a;  |LIBERA #laborn01;
          |BORRA 000#labore01.c;  |LIBERA #labore01;

          #laborn01#0   = "R";
          #laborn01#244 = eaMotiv;
          |GRABA 020#laborn01.n;
          |LIBERA #laborn01;

          #labore01#0 = "R";
          #labore01#1 = #laborn01#1;
          #labore01#2 = #laborn01#2;
          #labore01#3 = #laborn01#3;
          #labore01#4 = #laborn01#4;
          |GRABA 020#labore01.n;
          |LIBERA #labore01;
     |FINSI;
|FPRC;

|| Comienzo Programa -----------------------------------------------------

|PROCESO LeeFichaActual;
     swEncontrado = 0;
     #laborn01#0 = eaEstado;
     #laborn01#1 = eaUsuario;
     #laborn01#3 = efFecha;
     #laborn01#4 = eaHora;
     |LEE 101#laborn01.=;
     |SI FSalida = 0;
          swEncontrado = 1;
     |FINSI;

     swLaborBox = 0;
     aAlfa = #laborn01#1;
     |QBF aAlfa;
     aAlfa1 = #laborn01#1 % 105;
     |SI aAlfa = "WEB";
     |O aAlfa1 = "NUBEA";
          |DDEFECTO #labore01;
          #labore01#0 = eaEstado;
          #labore01#1 = eaUsuario;
          #labore01#3 = efFecha;
          #labore01#4 = eaHora;
          |LEE 101#labore01.=;
          swLaborBox = 1;
     |FINSI;
|FPRC;

|PROGRAMA;
     swActualizacion = 0;

     |DBASS aBase;  |QBF aBase;

     aFichLab = aBase + "laboral/fich/";
     aFichInt = aBase + "integral/fich/";
     aFichBas = aBase + "basica/fich/";

     aMas  = aBase + "laboral/def/labtraba.mas";

     |CARGA_DEF aMas, labtraba@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aMas  = aBase + "laboral/def/labpadre.mas";

     |CARGA_DEF aMas, labpadre@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labtraba@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "laboral/def/labcentr.mas";

     |CARGA_DEF aMas, labcentr@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "laboral/def/nomtraca.mas";

     |CARGA_DEF aMas, nomtraca@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "laboral/def/nomtrali.mas";

     |CARGA_DEF aMas, nomtrali@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #nomtraca@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "laboral/def/labempre.mas";

     |CARGA_DEF aMas, labempre@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #nomtraca@;
         |DESCARGA_DEF #nomtrali@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "laboral/def/nomhortp.mas";

     |CARGA_DEF aMas, nomhortp@;
     |SI FSalida ! 0;
         aAlfa = "0000 No puedo cargar el Def " + aMas;
         |MENAV aAlfa;
         |DESCARGA_DEF #labpadre@;
         |DESCARGA_DEF #labtraba@;
         |DESCARGA_DEF #labcentr@;
         |DESCARGA_DEF #nomtraca@;
         |DESCARGA_DEF #nomtrali@;
         |DESCARGA_DEF #labempre@;
         |DESCARGA_DEF #nomhortp@;

         |ACABA;
     |FINSI;

     aMas  = aBase + "integral/def/dsam0103.mas";
     |CARGA_DEF aMas, dsam0103@;
     |SI FSalida ! 0;
          nSinPI = 1;         || no tiene PI
     |SINO;
          nSinPI = 0;         || si tiene PI

          aMas  = aBase + "integral/def/dsam0101.mas";
          |CARGA_DEF aMas, dsam0101@;
     |FINSI;

     aMas  = aBase + "basica/def/agidanif.mas";

     |CARGA_DEF aMas, agidanif@;
     |SI FSalida ! 0;
          aAlfa = "0000 No puedo cargar el Def " + aMas;
          |MENAV aAlfa;

          |SI nSinPI = 0;     |DESCARGA_DEF #dsam0101@;     |FINSI;
          |SI nSinPI = 0;     |DESCARGA_DEF #dsam0103@;     |FINSI;

          |DESCARGA_DEF #labcentr@;
          |DESCARGA_DEF #labpadre@;
          |DESCARGA_DEF #labtraba@;
          |DESCARGA_DEF #nomtraca@;
          |DESCARGA_DEF #nomtrali@;
          |DESCARGA_DEF #labempre@;
          |DESCARGA_DEF #nomhortp@;
          |ACABA;
     |FINSI;

     |PATH_DAT #labtraba@#aFichLab#;
     |PATH_DAT #labpadre@#aFichLab#;
     |PATH_DAT #labcentr@#aFichLab#;
     |PATH_DAT #nomtraca@#aFichLab#;
     |PATH_DAT #nomtrali@#aFichLab#;
     |PATH_DAT #labempre@#aFichLab#;
     |PATH_DAT #nomhortp@#aFichLab#;
     |SI nSinPI = 0;     |PATH_DAT #dsam0101@#aFichInt#; |FINSI;
     |SI nSinPI = 0;     |PATH_DAT #dsam0103@#aFichInt#;  |FINSI;
     ||SI #0#1 = "S";    |PATH_DAT #agidanif@#aFichBas#;  |FINSI;

     |PATH_DAT #agidanif@#aFichBas#;

     |SI enFSalida ! 12;
          |CLS;
     |FINSI;
     |CABEZA "Altas";

     aAlfa = Usuario % 0810;
     |SI aParam = "ADMIN"; |O aParam = "HISTO";
          aUsuarioD = "";
          aUsuarioH = "zzzzzzzzzz";
     |FINSI;
     |SI aParam = "USUARIO"; |O aParam = "HISTOUSU";
          aUsuarioD = aAlfa;
          aUsuarioH = aAlfa;
     |FINSI;

     |ABRE #laborn01;
     |ABRE #labore01;
     |SI aParam = "ADMIN"; |O aParam = "USUARIO";
          aTipo = "P";   || los pendientes de actualizar
          |HAZ LeeFichaActual;
          |HAZ Opciones;
     |FINSI;
     |SI aParam = "HISTO"; |O aParam = "HISTOUSU";
          aTipo = "A";   || consulta del historico, los ya actualizados
          |HAZ LeeFichaActual
          |HAZ Opciones;
     |FINSI;

     |CIERRA #laborn01;
     |CIERRA #labore01;

     ||SI #0#1 = "S";     |DESCARGA_DEF #agidanif@;     |FINSI;

     |DESCARGA_DEF #agidanif@;
     |SI nSinPI = 0;     |DESCARGA_DEF #dsam0101@;     |FINSI;
     |SI nSinPI = 0;     |DESCARGA_DEF #dsam0103@;     |FINSI;

     |DESCARGA_DEF #nomhortp@;
     |DESCARGA_DEF #labempre@;
     |DESCARGA_DEF #nomtrali@;
     |DESCARGA_DEF #nomtraca@;
     |DESCARGA_DEF #labcentr@;
     |DESCARGA_DEF #labpadre@;
     |DESCARGA_DEF #labtraba@;
     nValorLog = 10; |HAZ Log;
|FPRO;

|PROCESO Tipo80n01;  |TIPO 80;
     |SI PARAMETRO = "";  |ACABA;  |FINSI;

     aSiEsX = PARAMETRO % 101;
     |SI aSiEsX = "X";
         aAlfa     = PARAMETRO % 202;   enFSalida = aAlfa;
         eaEstado  = PARAMETRO % 401;
         eaUsuario = PARAMETRO % 510;
         aAlfa     = PARAMETRO % 1510;  efFecha = aAlfa;
         eaHora    = PARAMETRO % 2508;
         eaParam   = PARAMETRO % 3310;  |QBF eaParam;
         aParam    = eaParam;
     |SINO;
          aParam = PARAMETRO;  |QBF aParam;
          |SI eaParam ! "";
              eaParam = aParam;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo90n01;  |TIPO 90;
     nValorLog = 11; |HAZ Log;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |SUB_EJECUTA "|laborx00.tab";
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     nValorLog = 12; |HAZ Log;
|FPRC;
