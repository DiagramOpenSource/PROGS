|FICHEROS;
     nomhorno #0;
     nomhorli;
     nomhortm,MANTE;

     labempre;
     labtraba;
     nomcalca;
     nomcalli;
     nomhicca;
     nomhicli;
     nomconca;
|FIN;

|VARIABLES;
     nEmp = 0;
     nTra = 0;
     nJornadas = 0;
     aOrigen = "";
     nAnyXX = 0;
     FEstado = 0;
     &nMes = 0;
     &nAny = 0;
     &nTopemes = 0;

     swSigue = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nMesAlta = 0;
     nAnyAlta = 0;
     nMesBaja = 0;
     nAnyBaja = 0;
     nLinea = 0;
     nCampo = 0;
|FIN;

|PROCESO nomhortm;
     nLinea = nLinea + 1;
     |PARA nCampo = 0; |SI nCampo [ 4; |HACIENDO nCampo = nCampo + 1;
          #nomhorli#nCampo# = #nomhortm#nCampo#;
     |SIGUE;
     |LEE 101#nomhorli.=;
     |SI FSalida = 0;
          #nomhorli#8 = #nomhortm#8;
          |GRABA 020#nomhorli.a;
     |FINSI;
     |LIBERA #nomhortm;
|FPRC;

|DEFBUCLE nomhortm;
     #nomhortm#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomhortm;
|FIN;

|PROCESO nomhorli;
     nLinea = nLinea + 1;
     |PARA nCampo = 0; |SI nCampo [ 9; |HACIENDO nCampo = nCampo + 1;
          #nomhortm#nCampo# = #nomhorli#nCampo#;
     |SIGUE;
     #nomhortm#10 = nLinea;
     |GRABA 020#nomhortm.n;
     |LIBERA #nomhortm;
|FPRC;

|DEFBUCLE nomhorli;
     #nomhorli#2;
     ;
     #0#0, #0#2, #0#6, #0#7, 0, #0#4;
     #0#1, #0#3, #0#6, #0#7, 0, #0#5;
     ;
     NULL, nomhorli;
|FIN;

|PROCESO busca;
     nJornadas = 0;
     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
     |O #labtraba#42 = "P"; |O #labtraba#42 = "I";
          |ACABA;
     |FINSI;

     |SI aOrigen = "M";
          nJornadas = 0;
          |SI #nomcalca#184 ! #0#6;
               |ACABA;
          |FINSI;

          |SI #labtraba#42 = "E";
               #nomcalli#0 = #nomcalca#0;
               #nomcalli#1 = #nomcalca#1;
               #nomcalli#2 = #nomcalca#2;
               #nomcalli#3 = #nomcalca#3;
               #nomcalli#4 = 903;
               |LEE 000#nomcalli.=;
               |SI FSalida = 0;
                    nJornadas = #nomcalli#9;
               |FINSI;
          |SINO;
               nJornadas = #nomcalca#8;
               nJornadas = nJornadas - #nomcalca#31 - #nomcalca#32 - #nomcalca#33;
               nJornadas = nJornadas - #nomcalca#34 - #nomcalca#194 - #nomcalca#131;
               nJornadas = nJornadas - #nomcalca#65 - #nomcalca#66 - #nomcalca#78;
          |FINSI;
     |FINSI;

     |SI aOrigen = "H";
          nJornadas = 0;
          |SI #labtraba#42 = "E";
               #nomhicli#0 = #nomhicca#0;
               #nomhicli#1 = #nomhicca#1;
               #nomhicli#12 = nAnyXX;
               #nomhicli#2 = #nomhicca#2;
               #nomhicli#3 = #nomhicca#3;
               #nomhicli#4 = 903;
               |LEE 000#nomhicli.=;
               |SI FSalida = 0;
                    nJornadas = #nomhicli#9;
               |FINSI;
          |SINO;
               nJornadas = #nomhicca#8;
               nJornadas = nJornadas - #nomhicca#31 - #nomhicca#32 - #nomhicca#65;
               nJornadas = nJornadas - #nomhicca#105 - #nomhicca#33 - #nomhicca#34;
               nJornadas = nJornadas - #nomhicca#173 - #nomhicca#236 - #nomhicca#119;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #labtraba#0, #labtraba#1, nAnyXX, #0#7, 0;
     #labtraba#0, #labtraba#1, nAnyXX, #0#7, 0;
     ;
     NULL, busca;
|FIN;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #labtraba#0, #labtraba#1, #0#7, 0;
     #labtraba#0, #labtraba#1, #0#7, 0;
     ;
     NULL, busca;
|FIN;

|PROCESO BuscaNominas;
     aOrigen = "M";
     |BUCLE nomcalca;

     aOrigen = "H";
     nAnyXX = #0#6 - 2000;
     |BUCLE nomhicca;
|FPRC;

|PROCESO labtraba;
     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |SI FSalida = 0;
          |SI #nomconca#165 ! "S";
               |ACABA;
          |FINSI;
     |FINSI;

     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
     |O #labtraba#42 = "P"; |O #labtraba#42 = "I";
          |ACABA;
     |FINSI;

     nEmp = #labtraba#0;
     nTra = #labtraba#1;

     swSigue = 0;

     aAlfa = #labtraba#36;
     aAlfa1 = aAlfa % 402;
     aAlfa2 = aAlfa % -104;
     nMesAlta = aAlfa1;
     nAnyAlta = aAlfa2;
     |SI nAnyAlta = #0#6;
          |SI nMesAlta [ #0#7;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI nAnyAlta < #0#6;
          swSigue = 1;
     |FINSI;

     |SI swSigue = 1;
          aAlfa = #labtraba#37;
          |QBF aAlfa;
          |SI aAlfa ! ""; |Y aAlfa ! "..........";
               aAlfa1 = aAlfa % 402;
               aAlfa2 = aAlfa % -104;
               nMesBaja = aAlfa1;
               nAnyBaja = aAlfa2;
               |SI nAnyBaja < #0#6;
                    swSigue = 0;
               |FINSI;
               |SI nAnyBaja = #0#6;
                    |SI nMesBaja < #0#7;
                         swSigue = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swSigue = 1;
          |HAZ BuscaNominas;

          |DDEFECTO #nomhorli;

          #nomhorli#0 = nEmp;
          #nomhorli#1 = nTra;
          #nomhorli#2 = #0#6;
          #nomhorli#3 = #0#7;
          #nomhorli#4 = 0;
          |LEE 000#nomhorli.=;
          FEstado = FSalida;

          #nomhorli#5 = #labempre#2;
          #nomhorli#6 = #labtraba#2;
          #nomhorli#7 = nJornadas;
          #nomhorli#9 = #labtraba#87;

          |SI FEstado = 0;
               |GRABA 020#nomhorli.a;
          |SINO;
               |GRABA 020#nomhorli.n;
          |FINSI;
          |LIBERA #nomhorli;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     87;
     #0#0, #0#2, #0#4;
     #0#1, #0#3, #0#5;
     ;
     NULL, labtraba;
|FIN;

|PROCESO inferior;
     #nomhortm#10 = 0001;
|FPRC;

|PROCESO superior;
     #nomhortm#10 = 9999;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;

     |ABRE #0;
     |DDEFECTO #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |BORRA 020#0a;
     |FINSI;

     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #nomhorli;
          |ABRE #nomcalli;
          |ABRE #nomhicli;
          |ABRE #nomconca;

          |BUCLE labtraba;

          aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_nomhortm_" + aAlfa;
          |NOME_DAT #nomhortm#aAlfa#;
          |DELINDEX #nomhortm;
          |ABRE #nomhortm;

          |BUCLE nomhorli;

          |ENTLINEAL #1#nomhortm, 1, 2, 22, 0, inferior, superior;

          |BUCLE nomhortm;

          |CIERRA #nomhortm;
          |CIERRA #nomconca;
          |CIERRA #nomcalli;
          |CIERRA #nomhicli;
          |CIERRA #nomhorli;
          |CIERRA #labtraba;
          |CIERRA #labempre;
     |FINSI;

     |GRABA 000#0n;
     |CIERRA #0;
|FPRO;
