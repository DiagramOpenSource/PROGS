|FICHEROS;
     laborb02;           || este def

     labtraba;
     labpadre;
     labtracu;
     :/integral/def/dsam0103;

     labor001;           || empresas labornet

     laborn10;
|FIN;

|VARIABLES;
     &nLabornet  = 0;
     &enNumLinea = 0;
     &enEmpLabornet = 0;
     &enTraLabornet = 0;
     &enHorasSemana = 0;
     &eaTipoJornada = "";
     &eaPrimerDia = "";
     &eaUltimoDia = "";
     &eaSalario = "";
     &enDurMeses = 0;
     &enDurDias = 0;
     &eaFechaIni = "";
     &eaFechaFin = "";

     &nEmpExt    = 0;
     &nTraExt    = 0;
     &fFechaAlta = @;
     &aTipoContr = "";

     &eaDirDest  = "";
     &eaAsunto   = "";
     &eaTexto    = "";
     &eaFichero  = "";

     aObser = ""; ||Variable para la recogida de observaciones
     nCampo         = 0;
     nCampo1        = 0;
     nCampo2        = 0;
     nCampo3        = 0;
     nCampo4        = 0;
     nCampo5        = 0;
     nCampo6        = 0;
     nCampo7        = 0;
     nCampo8        = 0;
     nRegis         = 0;
     nAscci         = 0;
     nHandle        = 0;
     nError         = 0;
     nLinea         = 0;
     nCalc          = 0;

     aParam     = "";
     aCampo         = "";
     aCaracter      = "";
     aWeb           = "";
     aAbre          = "";
     aAbreSmf       = "";
     aAlfa          = "";
     aBase          = "";
     aMas           = "";
     aFichLab       = "";
     aFichInt       = "";
     aFichBas       = "";
     aTecla         = "";
     &nSinPI        = 0;
     aCopialo1      = "";
     aCopialo2      = "";
     &aFlag         = "";
     &aTitulo       = "";

     &nEmp = 0;
     &nTra = 0;
     &aCons = "";
     &aImp = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aFecha = "";
     nNume = 0;
     swCopia = 0;
     nExiste = 0;
     nPan = 0;
     &eaUsuario = "";
     &eaFecha = @;
     &eaHora = "";
     aTipo = "";
     fec = "";
     aUsuarioD = "";
     aUsuarioH = "";
     FEstado = 0;
     aSiEsX    = "";

     &eaVengoDe = "laborn01";
     &eaEmpresa = "";
     &eaObra = "";
     &eaContrato = "";

     &eaParam       = "";
     &enFSalida     = 0;
     &efFecha       = @;
     &enBorrado     = 0;
     &enActualizado = 0;
     &eaEstado      = "";
     &eaMotiv       = "";

     &enEmpresa = 0;
     &enTrabajador = 0;
     &enNuevoCodigo = 0;
     &enRegistroCont = 0;

     aMensa = "";
     eaID = "";
     &enID = 0;
     nEntrada = 0;
     aNif = "";
     &swHeSalido = 0;
|FIN;

|| Actualizar Datos ------------------------------------------------------

|PROCESO CompruebaNif;
     nEntrada = 0;

     || NOMBRE
     aAlfa1 = #labtraba#2;    |QBF aAlfa1;
     aAlfa2 = #laborb02#2;  |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || DOMICILIO (SIGLA + NOMBRE CALLE)
     |SI #laborb02#10 ! "  ";
         aAlfa1 = #labtraba#3; |QBF aAlfa1;
         aAlfa2 = #laborb02#10 + " " + #laborb02#3; aAlfa2 = aAlfa2 % 130; |QBF aAlfa2;
         |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;
     |SINO;
         aAlfa1 = #labtraba#3;       |QBF aAlfa1;
         aAlfa2 = #laborb02#3;     |QBF aAlfa2;
         |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;
     |FINSI;

     || NUMERO
     aAlfa1 = #labtraba#4;                        |QBF aAlfa1;
     aAlfa2 = #laborb02#4;                  |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || PISO
     aAlfa1 = #labtraba#5;                    |QBF aAlfa1;
     aAlfa2 = #laborb02#11;                 |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || PROVINCIA CP
     aAlfa1 = #labtraba#8;                    |QBF aAlfa1;
     aAlfa2 = #laborb02#5;                  |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || LOCALIDAD CP
     aAlfa1 = #labtraba#9;                    |QBF aAlfa1;
     aAlfa2 = #laborb02#6;                  |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || NOMBRE LOCALIDAD
     aAlfa1 = #labtraba#6;                    |QBF aAlfa1;
     aAlfa2 = #laborb02#7;                  |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || NOMBRE PROVINCIA
     aAlfa1 = #labtraba#10;                   |QBF aAlfa1;
     aAlfa2 = #laborb02#8;                  |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     || TELEFONO
     aAlfa1 = #labtraba#244;                   |QBF aAlfa1;
     aAlfa2 = #laborb02#9;                   |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;  nEntrada = 1;  |FINSI;

     |SI nEntrada = 1;
          #labtraba#2  = #laborb02#2;

          |SI #laborb02#10 ! "  ";
               aAlfa1 = #laborb02#10 + " " + #laborb02#3; aAlfa1 = aAlfa1 % 130;
               |QBF aAlfa1;
          |SINO;
               aAlfa1 = #laborb02#3; |QBF aAlfa1;
          |FINSI;
          aAlfa2 = #labtraba#3; |QBF aAlfa2;
          |SI aAlfa1 ! aAlfa2;
               #labtraba#3 = #laborb02#10 + " " + #laborb02#3;
          |FINSI;

          #labtraba#4 = #laborb02#4;
          #labtraba#5 = #laborb02#11;
          #labtraba#8 = #laborb02#5;
          #labtraba#9 = #laborb02#6;
          #labtraba#6 = #laborb02#7;
          #labtraba#10 = #laborb02#8;
          #labtraba#244 = #laborb02#9;
     |FINSI;

     || BANCO

     aAlfa1 = #laborb02#19 + #laborb02#20 + #laborb02#21 + #laborb02#22 + #laborb02#23;
     |QBF aAlfa1;
     aAlfa2 = #labtraba#154;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2;
          nEntrada = 1;
          #labtraba#154 = aAlfa1;
          #labtraba#72 = #laborb02#20 + #laborb02#21 + #laborb02#22 + #laborb02#23;
          #labtraba#153 = #laborb02#58;
          #labtraba#155 = #laborb02#59;
     |FINSI;

     |ABRE #labtracu;
     #labtracu#0 = #labtraba#0;
     #labtracu#1 = #labtraba#1;
     |LEE 101#labtracu.=;
     |SI FSalida = 0;
          #labtracu#5 = #laborb02#20;
          #labtracu#6 = #laborb02#21;
          #labtracu#8 = #laborb02#22;
          #labtracu#7 = #laborb02#23;
          aAlfa1 = #laborb02#19 + #laborb02#20 + #laborb02#21 + #laborb02#22 + #laborb02#23;
          #labtracu#12 = aAlfa1;
          |GRABA 020#labtracu.a;
          |LIBERA #labtracu;
     |FINSI;
     |CIERRA #labtracu;
|FPRC;

|PROCESO GrabaTra;
     nEntrada = 0;
     |HAZ CompruebaNif;

     |SI nEntrada = 1;
          |GRABA 020#labtraba.a;
          |LIBERA #labtraba;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaTra;
     #labtraba#2;
     44;
     aNif, "A";
     aNif, "A";
     be;
     NULL, GrabaTra;
|FIN;

|PROCESO labtraba;
     aNif = #laborb02#1;
     |QBF aNif;
     aNif = (aNif + "            ") % 112;
     |BUCLE BuscaTra;
|FPRC;


|PROCESO dsam0103;
     |ABRE #dsam0103;
     #dsam0103#0 = #laborb02#1;
     |LEE 101#dsam0103.=;
     |SI FSalida = 0;
          |PARA nCampo = 1; |SI nCampo [ 17; |HACIENDO nCampo = nCampo + 1;
               nCampo1 = nCampo + 1;
               #dsam0103#nCampo# = #laborb02#nCampo1#;
          |SIGUE;
     |FINSI;
     |GRABA 020#dsam0103.a;
     |LIBERA #dsam0103;
     |CIERRA #dsam0103;
|FPRC;

|PROCESO Actualiza;
     |HAZ LeeFichaActual;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enID = #laborb02#0;
     swHeSalido = 0;
     |SUB_EJECUTA "laborb12;MODIF";
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |HAZ LeeFichaActual;|| tengo que volver a leerlo, si no vuelve al
                         || valor que tenia antes de las modificaciones

     |SI swHeSalido = 0;
          |CONFI "0000SSe actualizarán los cambios realizados en el trabajador. ¿Desea continuar?";
          |SI FSalida ! 0;  |ACABA;  |FINSI;

          |HAZ LeeFichaActual;

          |HAZ dsam0103;

          |HAZ labtraba;

          |HAZ LeeFichaActual;

          || actualizacion del registro de solicitud de alta

          #laborb02#24 = "A";
          #laborb02#28 = ~;
          |HORA aAlfa;
          #laborb02#29 = aAlfa;
          #laborb02#30 = Usuario % 0810;
          |GRABA 020#laborb02.a;
          |LIBERA #laborb02;

          |MENAV "    El trabajador ha sido actualizado correctamente";
     |SINO;
          |MENAV "    Proceso cancelado";
     |FINSI;
     |CLS;
|FPRC;

|PROCESO Consulta;
     enID = #laborb02#0;
     |SUB_EJECUTA "laborb12;CONSU";
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |ACABA;
     |POPV;
|FPRC;

|PROCESO Opciones; |TIPO 0;
     |SI enFSalida ! 0;
          FSalida = enFSalida;
     |FINSI;

     || consulta de datos introducidos
     |SI FSalida = 10;
          |SI aParam = "ADMIN";  || consulta el usuario los datos que
               enID = #laborb02#0;
               |SUB_EJECUTA "laborb12;MODIF";
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
               |ACABA;
          |FINSI;
          |SI aParam = "HISTO";
               |HAZ Consulta;           || consulta de datos introducidos
               |ACABA;
          |FINSI;                       || o ya actualizados, solo visualizar
          |ACABA;
     |FINSI;

     |SI FSalida = 11;
          |HAZ Actualiza;
          |ACABA;
     |FINSI;

     |SI FSalida = 12;
          enBorrado = 1;
          |HAZ LeeFichaActual;

          #laborb02#24 = "R";
          #laborb02#62 = eaMotiv;

          |GRABA 020#laborb02.a;
          |LIBERA #laborb02;
     |FINSI;
|FPRC;

|PROCESO LeeFichaActual;
     #laborb02#0 = enID;
     |LEE 101#laborb02.=;
|FPRC;

|PROGRAMA;
     |DBASS aBase;  |QBF aBase;

     |ABRE #laborb02;
     |SI aParam = "ADMIN";
          aTipo = "P";   || los pendientes de actualizar
     |FINSI;
     |SI aParam = "HISTO";
          aTipo = "A";   || consulta del historico, los ya actualizados
     |FINSI;

     |HAZ LeeFichaActual;
     |HAZ Opciones;
     |CIERRA #laborb02;
|FPRO;

|PROCESO Tipo80n01;  |TIPO 80;
     |SI PARAMETRO = "";  |ACABA;  |FINSI;
     aParam = PARAMETRO;
     |QBF aParam;

     |SI aParam = "MENULISTA";
          |ABRE #laborb02;
          |CONSULTA_CLAVE #1#laborb02;
          |CIERRA #laborb02;
          |ACABA;
     |FINSI;

|| LEER LA ID
     aAlfa     = PARAMETRO % 202;   enFSalida = aAlfa;
     eaID = PARAMETRO % 407;
     enID = eaID;
     eaParam = PARAMETRO % 1110;  |QBF eaParam;
     aParam = eaParam;
|FPRC;

|PROCESO Tipo90n01;  |TIPO 90;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |SUB_EJECUTA "|laborx00.tab";
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;
