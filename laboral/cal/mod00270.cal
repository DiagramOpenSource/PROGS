/*
|FICHEROS;
     mod00270 #0;
     mod00272 #1;
     mod00262;
     mod00264;
     mod00271 #1;
     mod00274;

     labempre;
     labtraba;

     nomfical;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    ant_tipo = "";
     nModo = 0;

     nDiaMes = 0;
     nFilNum = 0;
     nColIni = 0;
     nColNum = 0;
     nColCam = 0;
     nPaso = 0;
     nCampo = 0;
     topemes = 0;
     nPos = 0;
     a = 0;
     nDiaSem = 0;

     aAlfa1 = "";
     aAlfa = "";
     nNume = 0;

     aAnyo = "";
     aMes = "";
     mesnum = 0;
     anynum = 0;
     aFecha = "";
     fFecha = @;
     fDiaLet = @;
     aDiaLet = "";
     nPosHoras = 0;

     swFestivo = 0;
     nFechaNume = 0;
     nCampoF = 0;
     nCampoF1 = 0;
     nCampoF2 = 0;
     nCampoF3 = 0;
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     swAlta = 0;
     nEmp = 0;
     nTra = 0;
     fFechaAlta = @;
     fFechaBaja = @;
     nDia = 0;
     swSoloAlta = 0;
     nTotalHoras = 0;

     numer = 0;
     menos = 0;
     bisiesto = 0;
     fecsys = @;
     i = 0;

     swAlguno = 0;
     swCambio = 0;
     nTotalJor = 0;
     nCampoDia = 0;
     nCampo2 = 0;

     aNif = "";
     swUno = 0;
     nDesdeEmp = 0;
     nHastaEmp = 0;
     nDesdeTra = 0;
     nHastaTra = 0;

     fFechaIni = @;
     fFechaFin = @;
     aFechaAlta = "";
     aFechaBaja = "";
     &nTopemes = 0;
     &nMes = 0;
     &nAny = 0;
     aLista = "";
     nPosicion = 0;
|FIN;
____________________________________/

|| PROCESOS PARA CARGAR JORNADAS POR NIF

|PROCESO JornadasPorNIF;
     |PARA nCampo = 6; |SI nCampo [ 38; |HACIENDO nCampo = nCampo + 1;
          |SI #mod00271#nCampo# = "X"; |O #mod00271#nCampo# = "I";
               #mod00270#nCampo# = #mod00271#nCampo#
               |PINTA #mod00270#nCampo#;

               nCampo2 = nCampo + 35;
               #mod00270#nCampo2# = #mod00271#1;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE JornadasPorNIF;
     #mod00271#1;
     ;
     #labtraba#7, #0#0, 00001, #0#2, #0#3;
     #labtraba#7, #0#0, 99999, #0#2, #0#3;
     ;
     NULL, JornadasPorNIF;
|FIN;

|PROCESO mod00271;
     |SI #mod00271#1 ! #labtraba#1;
          || otro codigo
          #mod00271#6 = #mod00271#6 + 1;
          nTotalJor = #mod00271#6;
          |GRABA 020#mod00271.a;
          |LIBERA #mod00271;
     |FINSI;
|FPRC;

|DEFBUCLE mod00271;
     #mod00271#1;
     ;
     #labtraba#7, #0#0, 00001, #0#2, #0#3;
     #labtraba#7, #0#0, 99999, #0#2, #0#3;
     ;
     NULL, mod00271;
|FIN;

|PROCESO mod00262;
     #labtraba#0 = #mod00262#0;
     #labtraba#1 = #mod00262#1;
     |LEE 000#labtraba.=;

     |SI swUno = 1;
          |SI aNif = #labtraba#7;
               || SIGUE
          |SINO;
               |ACABA;
          |FINSI;
     |FINSI;

     |DDEFECTO #mod00271
     #mod00271#4 = #labtraba#7;
     #mod00271#0 = #mod00262#0;
     #mod00271#1 = #mod00262#1;
     #mod00271#2 = #mod00262#2;
     #mod00271#3 = #mod00262#3;
     |LEE 101#mod00271.=;
     FEstado = FSalida;

     #mod00271#5 = #labtraba#2;

     nCampoDia = #mod00262#4 + 7;
     #mod00271#nCampoDia# = "X";

     |SI FEstado = 0;
          #mod00271#6 = #mod00271#6 + 1;
          #mod00271#7 = #mod00271#7 + 1;
          |GRABA 020#mod00271.a;
     |SINO;
          #mod00271#6 = 1;
          #mod00271#7 = 1;
          |GRABA 020#mod00271.n;
     |FINSI;
     |LIBERA #mod00271;

     nTotalJor = 0;
     |SALVA_FICHA #mod00271;
     |BUCLE mod00271;
     |REPON_FICHA #mod00271;

     |SI nTotalJor ! 0;
          |LEE 101#mod00271.=;
          #mod00271#6 = nTotalJor;
          |GRABA 020#mod00271.a;
          |LIBERA #mod00271;
     |FINSI;
|FPRC;

|DEFBUCLE mod00262;
     #mod00262#1;
     ;
     nDesdeEmp, nDesdeTra, #0#2, #0#3, 01;
     nHastaEmp, nHastaTra, #0#2, #0#3, 31;
     ;
     NULL, mod00262;
|FIN;

|PROCESO BuscaAlguno;
     swAlguno = 1;
|FPRC;

|DEFBUCLE BuscaAlguno;
     #mod00271#1;
     ;
     "            ", nDesdeEmp, nDesdeTra, #0#2, #0#3;
     "zzzzzzzzzzzz", nHastaEmp, nHastaTra, #0#2, #0#3;
     ;
     NULL, BuscaAlguno;
|FIN;

|PROCESO CargaTmp;
     aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_mod00271_" + aAlfa;
     |NOME_DAT #mod00271#aAlfa#;
     |ABRE #mod00271;

     nDesdeEmp = #0#0;
     nHastaEmp = #0#0;
     nDesdeTra = 00001;
     nHastaTra = 99999;
     |SI swUno = 1;
          nDesdeTra = #0#1;
          nHastaTra = #0#1;
     |FINSI;
     swAlguno = 0;
     |BUCLE BuscaAlguno;

     |SI swAlguno = 0; |O swCambio = 1;
          |DELINDEX #mod00271;
          |ABRE #mod00271;
          |ABRE #labtraba;
          |BUCLE mod00262;
          |CIERRA #labtraba;
          |CIERRA #mod00271;

          swCambio = 0;
     |FINSI;

     |CIERRA #mod00271;
|FPRC;

|PROCESO PintaCodigo; |TIPO 7;

     |PARA nPos = 14; |SI nPos [ 22; |HACIENDO nPos = nPos + 1;
          nPosicion = (nPos * 100) + 72;
          |PINTA nPosicion, " ";
     |SIGUE;

     aAlfa1 = aLista;
     nCampo = Campo + 33;
     aAlfa2 = #0nCampo; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;
     aAlfa3 = aLista - aAlfa2;
     nNume = FSalida;
     |SI nNume ! 0;
          nNume = (((((nNume - 5) / 100) - 1) / 5) + 14);
          nPosicion = (nNume * 100) + 72;
          |PINTA nPosicion, "*";
     |FINSI;

     ||PINTA 2115, #0nCampo;

|FPRC;

|PROCESO PintaDatos;
               |ABRE #labempre;
               #labempre#0 = #mod00270#0;
               |LEE 000#labempre.=;
               |CIERRA #labempre;

               |ABRE #labtraba;
               #labtraba#0 = #mod00270#0;
               #labtraba#1 = #mod00270#1;
               |LEE 000#labtraba.=;
               |CIERRA #labtraba;

               |PINTA 0730, #labempre#2;
               |PINTA 0830, #labtraba#2;
|FPRC;

|PROCESO PintaJornadas;
     |BUCLE JornadasPorNIF;
|FPRC;

|PROCESO superior;
     #mod00274#0 = 99999;
|FPRC;

|PROCESO inferior;
     #mod00274#0 = 1;
|FPRC;

|PROCESO BuscaCodigo;
     |SI #mod00274#1 [ nDia; |Y nDia [ #mod00274#2;
          #0nCampo = #mod00274#0;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaCodigo;
     #mod00274#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BuscaCodigo;
|FIN;

|PROCESO Fecha;
     aAlfa = #labtraba#36;
     |QBF aAlfa;
     |SI aAlfa ! "";
          fFechaAlta = aAlfa;
     |FINSI;

     aAlfa1 = "01";
     aAlfa2 = #0#3; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = #0#2; |QBF aAlfa3;
     aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
     fFechaIni = aAlfa;

     nMes = #0#3;
     nAny = #0#2;
     |HAZ topemes_plb;
     aAlfa1 = nTopemes; |QBF aAlfa1;
     aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
     fFechaFin = aAlfa;

     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa ! "";
          fFechaBaja = aAlfa;
     |SINO;
          fFechaBaja = fFechaFin;
     |FINSI;

     |SI fFechaAlta > fFechaFin; |O fFechaBaja < fFechaIni;
          |ACABA;
     |FINSI;

     aFechaAlta = fFechaAlta;
     aFechaBaja = fFechaBaja;
     |SI fFechaAlta < fFechaIni;
          #mod00274#1 = 01;
     |SINO;
          aAlfa = aFechaAlta % 102;
          #mod00274#1 = aAlfa;
     |FINSI;
     |SI fFechaBaja > fFechaFin;
          #mod00274#2 = nTopemes;
     |SINO;
          aAlfa = aFechaBaja % 102;
          #mod00274#2 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO AsignaTrab;
     |DDEFECTO #mod00274;
     #mod00274#0 = #0nCampo;
     |LEE 101#mod00274.=;
     |SI FSalida ! 0;
          #labtraba#0 = #0#0;
          #labtraba#1 = #0nCampo;
          |LEE 000#labtraba.=;

          |HAZ Fecha;

          #mod00274#3 = 1;
          |GRABA 020#mod00274.n;

          aAlfa = #0nCampo;
          |QBF aAlfa;
          aAlfa = ("00000" + aAlfa) % -105;
          aLista = aLista + aAlfa;
     |SINO;
          #mod00274#3 = #mod00274#3 + 1;
          |GRABA 020#mod00274.a;
     |FINSI;
     |LIBERA #mod00274;
|FPRC;

|PROCESO PintaFichas;
     aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_mod00274_" + aAlfa;
     |NOME_DAT #mod00274#aAlfa#;
     |DELINDEX #mod00274;
     |ABRE #mod00274;

     aLista = "";
     |ABRE #labtraba;
     |PARA nCampo = 41; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
          |SI #0nCampo ! 0;
               |HAZ AsignaTrab;
          |FINSI;
     |SIGUE;

     |PARA nCampo = 41; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
          |SI #0nCampo = 0;
               nDia = nCampo - 40;
               |BUCLE BuscaCodigo;
          |FINSI;
     |SIGUE;
     |ENTLINEAL #1#mod00274, 1, 7, 22, 0, inferior, superior;

     |CIERRA #labtraba;
     |CIERRA #mod00274;
|FPRC;

|PROCESO UnoSolo;
     swUno = 1;

     |ABRE #labtraba;
     #labtraba#0 = #mod00270#0;
     #labtraba#1 = #mod00270#1;
     |LEE 000#labtraba.=;
     aNif = #labtraba#7;
     |CIERRA #labtraba;

     |HAZ CargaTmp;
     swUno = 0;

     |HAZ PintaJornadas;

     |HAZ PintaFichas;
|FPRC;

|PROCESO ConsultaNIF;
     |SI FSalida = 18;
          |HAZ CargaTmp;

          |ABRE #labtraba;
          #labtraba#0 = #mod00270#0;
          #labtraba#1 = #mod00270#1;
          |LEE 000#labtraba.=;
          |CIERRA #labtraba;

          |ABRE #mod00271;
          #mod00271#4 = #labtraba#7;
          #mod00271#0 = #mod00270#0;
          #mod00271#1 = #mod00270#1;
          #mod00271#2 = #mod00270#2;
          #mod00271#3 = #mod00270#3;
          |LEE 000#mod00271.=;

          |CONSULTA_CLAVE #1#mod00271;

          |CIERRA #mod00271;

          |SI FSalida = 0;
               #mod00270#0 = #mod00271#0;
               #mod00270#1 = #mod00271#1;
               #mod00270#2 = #mod00271#2;
               #mod00270#3 = #mod00271#3;
               |PINTA #mod00270#0;
               |PINTA #mod00270#1;
               |PINTA #mod00270#2;
               |PINTA #mod00270#3;

               |HAZ PintaDatos;
               |HAZ PintaJornadas;
          |FINSI;
     |FINSI;
|FPRC;

||  PROCESOS PARA PINTA EL CALENDARIO

|PROCESO ulti_dia;  || halla el ultimo dia del mes
    numer = anynum $ 4;
|SI numer = 0;
        bisiesto = 1;
|SINO;
        bisiesto = 0;
|FINSI;
|SI mesnum =  1;  topemes = 31;            |FINSI;
|SI mesnum =  2;  topemes = 28 + bisiesto; |FINSI;
|SI mesnum =  3;  topemes = 31;            |FINSI;
|SI mesnum =  4;  topemes = 30;            |FINSI;
|SI mesnum =  5;  topemes = 31;            |FINSI;
|SI mesnum =  6;  topemes = 30;            |FINSI;
|SI mesnum =  7;  topemes = 31;            |FINSI;
|SI mesnum =  8;  topemes = 31;            |FINSI;
|SI mesnum =  9;  topemes = 30;            |FINSI;
|SI mesnum = 10;  topemes = 31;            |FINSI;
|SI mesnum = 11;  topemes = 30;            |FINSI;
|SI mesnum = 12;  topemes = 31;            |FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
    #0Campo = #0Campo - menos;
|PINTA #0Campo;
|FPRC;

|PROCESO mirames2; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
    #0Campo = #0Campo - 1;
    menos = 0;
|SI #0Campo = 0;
        #0Campo = 12;
        menos = 1;
|FINSI;
|PINTA #0Campo;
|FPRC;

|PROCESO cabecera;
     |BLANCO 1109 2053;
     |CUADRO 11092053;
     |ATRI R;
     |PINTA 1211, " Lun ";
     |PINTA 1217, " Mar ";
     |PINTA 1223, " Mie ";
     |PINTA 1229, " Jue ";
     |PINTA 1235, " Vie ";
     |PINTA 1241, " Sab ";
     |PINTA 1247, " Dom ";
     |ATRI 0;
|FPRC;

|PROCESO Repinta; |TIPO 13;
     nModo = (FEntrada / 100) ! 0;
     |HAZ dias;
|FPRC;

|PROCESO Repinta2; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ dias;
     |FINSI;
|FPRC;

|PROCESO Inicializa;
     |PARA i = 8; |SI i [ 38; |HACIENDO i = i + 1;
          |CAMPO_MODIFICA #0i, 1, "S";
     |SIGUE;
|FPRC;

|PROCESO calendario;
     nDiaMes = 1;
     nFilNum = 1300;
     ||nColIni = 15;
     ||nColCam = 23;
     nColIni = 6;
     nColCam = 14;
     nPaso = 6;
     nCampo = 8;
     |HAZ cabecera;
     |HAZ Inicializa;
     |PARA nFilNum = nFilNum; |SI nDiaMes [ topemes; |HACIENDO nFilNum = nFilNum + 100;
     |PARA nDiaSem = nDiaSem; |SI nDiaSem [ 7;  |HACIENDO nDiaSem = nDiaSem + 1;
          nColNum = nColIni + (nDiaSem * nPaso);
          nPos = nFilNum + nColNum;
          |SI nDiaMes < 10;
               nPos = nPos + 1;
               a = 1;
          |SINO;
               a = 0;
          |FINSI;
          |PINTA nPos, nDiaMes;
          nColCam = nPos + 3 - a;
          |CAMPO_VISUAL   #0nCampo, 1, "S";
          |CAMPO_POSICION #0nCampo, 1, nColCam;
          |PINTA #0nCampo;
          |SI nDiaMes < 10;
               nPos = nPos - 1;
          |FINSI;
          nDiaMes = nDiaMes + 1;
          |SI nDiaMes > topemes; |SAL; |FINSI;
          nCampo = nCampo + 1;
     |SIGUE;
     nDiaSem = 1;
     |SIGUE;

     topemes = topemes + 8
     |PARA nCampo = topemes; |SI nCampo [ 38; |HACIENDO nCampo = nCampo + 1;
          |CAMPO_MODIFICA #0nCampo, 1, "N";
          |CAMPO_VISUAL #0nCampo, 1, "N";
     |SIGUE;
|FPRC;

|PROCESO dias;
     aAnyo = #mod00270#2;
     aMes  = #mod00270#3;
     aMes = "00" + aMes;
     aMes = aMes % -102;
     aFecha = "01" + "." + aMes + "." + aAnyo;
     fFecha = aFecha;
     fDiaLet = fFecha % 1;
     aDiaLet = fDiaLet;
     aDiaLet = aDiaLet % 1103;
     |SI aDiaLet = "Lun"; nDiaSem = 1; |FINSI;
     |SI aDiaLet = "Mar"; nDiaSem = 2; |FINSI;
     |SI aDiaLet = "Mie"; nDiaSem = 3; |FINSI;
     |SI aDiaLet = "Jue"; nDiaSem = 4; |FINSI;
     |SI aDiaLet = "Vie"; nDiaSem = 5; |FINSI;
     |SI aDiaLet = "Sab"; nDiaSem = 6; |FINSI;
     |SI aDiaLet = "Dom"; nDiaSem = 7; |FINSI;
     mesnum = #mod00270#3;
     anynum = #mod00270#2;
     |HAZ ulti_dia;
     |HAZ calendario;
     |PARA nCampo = 8; |SI nCampo [ 71; |HACIENDO nCampo = nCampo + 1;
          |SI nCampo = 39; |O nCampo = 40;
               || nada
          |SINO;
               #mod00270#nCampo# = "";
               |PINTA #mod00270#nCampo#;
          |FINSI;
     |SIGUE;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |ABRE #0;
     |LEE 001#0p;
     |SI FSalida ! 0;
          |DDEFECTO #0;
          |GRABA 020#0n;
     |FINSI;
     |LEE 101#0=;
     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida = 0;
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;
*/
