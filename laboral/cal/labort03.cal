|FICHEROS;
     labort03 #0;
     nomfical;
     labempre;
     labtraba;
     labtrtra #50;
     labregis;
     labhisto;
|FIN;

|VARIABLES;
     swError = 0;
     swHorasLoc = 0;
     aHorasSalida = "";
     aMinutosSalida = "";
     aHoras = "";
     aLon = "";
     nLon = 0;
     nCar = 0;
     nPos = 0;
     nNume1 = 0;
     nNume2 = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nModo = 0;

     nCampo = 0;
     nLimite = 0;
     fFecha = @;
     FEstado = 0;
     nCampoHoras = 0;
     nCampoCalendario = 0;
     aLonHoras = "";
     nLonHoras = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nRegistro = 0;
     swPintaHoras = 0;
     nSuma = 0;
     &eaEmpresa = "";
     &eaNombre = "";

     nTotal = 0;
     nCampoT = 0;
     nHoras = 0;
     nHoras1 = 0;
     nHoras2 = 0;
     nMinutos = 0;
     nMinutos1 = 0;
     nMinutos2 = 0;
|FIN;

|PROCESO labtraba;
     |PARA nCampo = 0; |SI nCampo [ 253; |HACIENDO nCampo = nCampo + 1;
          #50nCampo = #labtraba#nCampo#;
     |SIGUE;
     |GRABA 020#50n;
     |LIBERA #50;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#4;
     ;
     "P", #0#0, 00001;
     "X", #0#0, 99999;
     ;
     NULL, labtraba;
|FIN;

|PROCESO CargaTrabTP;
     aAlfa = Usuario; |QBF aAlfa;    aAlfa = "T" + aAlfa;
     |NOME_DAT #50 aAlfa;
     |DELINDEX #50;
     |ABRE #50;
     |BUCLE labtraba;
     |CIERRA #50;
|FPRC;

|PROCESO ConsultaTra;
     |SI FSalida = 18;
          aAlfa = Usuario; |QBF aAlfa;    aAlfa = "T" + aAlfa;
          |NOME_DAT #50 aAlfa;
          |ABRE #50;
          |LEE 000#50p;
          |CONSULTA_CLAVE #1#50;
          |SI FSalida = 0;
               #0#1 = #50#1;
               |PINTA #0#1;

               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 000#labtraba.=;

               |ATRI I;
               |PINTA 0931, #labtraba#2;
               |ATRI I;

               |CIERRA #labtraba;
          |FINSI;
          |CIERRA #50;
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 2; |O nModo = 3; |O nModo = 4;
               |PTEC 802;
               |PTEC 802;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO HorasContrato;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |SI #labtraba#42 ! "X"; |Y #labtraba#42 ! "T"; |Y #labtraba#42 ! "P";
          aAlfa = "    El trabajador no tiene clave de cotización por ";
          aAlfa = aAlfa + "horas: X, T ó P";
          |MENAV aAlfa;
          |ERROR;
     |SINO;
          |SI #labtraba#42 = "X";

          |FINSI;
          |SI #labtraba#42 = "M";

          |FINSI;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO CopiaHoras;
     |SI Campo ! 2;
          |HAZ FormatoHoras;
     |FINSI;
     |SI FSalida = 13;
          |SI Campo = 2;
               nCampoCalendario = 1;
               fFecha = ~;
               aAlfa = fFecha;
               aAlfa = aAlfa % -104;
               |ABRE #nomfical;
               #nomfical#0 = #labtraba#156;
               #nomfical#1 = aAlfa;
               |LEE 000#nomfical.=;
               FEstado = FSalida;

               nCampo = Campo;
               nLimite = nCampo + 30;
               |PARA nCampo = nCampo; |SI nCampo [ nLimite; |HACIENDO nCampo = nCampo + 5;
                    nCampoCalendario = nCampoCalendario + 1;
                    |SI FEstado = 0; |Y #nomfical#nCampoCalendario# = 1;
                         || hay calendario y el dia es festivo
                         #0nCampo = 0;
                    |SINO;
                         #0nCampo = #0Campo;
                    |FINSI;
                    |PINTA #0nCampo;
               |SIGUE;
               |CIERRA #nomfical;
          |FINSI;
          |SI Campo = 3; |O Campo = 4; |O Campo = 5; |O Campo = 6;
          |O Campo = 39; |O Campo = 40; |O Campo = 41; |O Campo = 42;
               nCampo = Campo;
               |SI Campo = 3; |O Campo = 4; |O Campo = 5; |O Campo = 6;
                    nLimite = nCampo + 30;
                    |PARA nCampo = nCampo; |SI nCampo [ nLimite; |HACIENDO nCampo = nCampo + 5;
                         |SI Campo = 3; nCampoHoras = nCampo - 1; |FINSI;
                         |SI Campo = 4; nCampoHoras = nCampo - 2; |FINSI;
                         |SI Campo = 5; nCampoHoras = nCampo - 3; |FINSI;
                         |SI Campo = 6; nCampoHoras = nCampo - 4; |FINSI;
                         ||SI #0nCampoHoras ! 0;
                              #0nCampo = #0Campo;
                         ||SINO;
                              ||#0nCampo = "     ";
                         ||FINSI;
                         |PINTA #0nCampo;
                    |SIGUE;
               |FINSI;
               nSuma = -1;
               |SI Campo = 39; |O Campo = 40; |O Campo = 41; |O Campo = 42;
                    nLimite = nCampo + 24;
                    |PARA nCampo = nCampo; |SI nCampo [ nLimite; |HACIENDO nCampo = nCampo + 4;
                         nSuma = nSuma + 1;
                         |SI Campo = 39; nCampoHoras = nCampo - 37 + nSuma; |FINSI;
                         |SI Campo = 40; nCampoHoras = nCampo - 38 + nSuma; |FINSI;
                         |SI Campo = 41; nCampoHoras = nCampo - 39 + nSuma; |FINSI;
                         |SI Campo = 42; nCampoHoras = nCampo - 40 + nSuma; |FINSI;
                         ||SI #0nCampoHoras ! 0;
                              #0nCampo = #0Campo;
                         ||SINO;
                              ||#0nCampo = "     ";
                         ||FINSI;
                         |PINTA #0nCampo;
                    |SIGUE;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ TotalHoras;
|FPRC;

|PROCESO FormatoHoras;
     swError = 0;
     swHorasLoc = 0;
     aHorasSalida = "";
     aMinutosSalida = "";
     aLonHoras = "";
     nLonHoras = 0;

     aHoras = #0Campo;
     |QBT aHoras;
     |SI aHoras = "";
          |HAZ TotalHoras;
          |ACABA;
     |FINSI;
     aLon = aHoras % 0;
     nLon = aLon;
     |SI nLon ! 5;
          |PARA nCar = 1; |SI nCar [ nLon; |HACIENDO nCar = nCar + 1;
               nPos = (nCar * 100) + 1;
               aAlfa = aHoras % nPos;
               |SI swHorasLoc = 0;
                    |SI aAlfa = "."; |O aAlfa = ":"; |O aAlfa = ",";
                         swHorasLoc = 1;
                    |SINO;
                         aLonHoras = aHorasSalida % 0;
                         nLonHoras = aLonHoras;
                         |SI nLonHoras ! 2;
                              aHorasSalida = aHorasSalida + aAlfa;
                         |SINO;
                              aMinutosSalida = aMinutosSalida + aAlfa;
                         |FINSI;
                    |FINSI;
               |SINO;
                    aMinutosSalida = aMinutosSalida + aAlfa;
               |FINSI;
          |SIGUE;
          aHorasSalida = ("00" + aHorasSalida) % -102;
          aMinutosSalida = ("00" + aMinutosSalida) % -102;
          aAlfa1 = aHorasSalida;
          aAlfa2 = aMinutosSalida;
     |SINO;
          aAlfa1 = aHoras % 102;
          aAlfa2 = aHoras % -102;
          aHorasSalida = aAlfa1;
          aMinutosSalida = aAlfa2;
     |FINSI;

     nNume1 = aAlfa1;
     nNume2 = aAlfa2;
     |SI nNume1 < 0; |O nNume1 > 23;
          swError = 1;
     |FINSI;
     |SI nNume2 < 0; |O nNume2 > 59;
          swError = 2;
     |FINSI;
     |SI swError = 1;
          |MENAV "    ATENCION. Error de introducción de datos. Revise el número de horas";
          |ERROR;
          |ACABA;
     |FINSI;
     |SI swError = 2;
          |MENAV "    ATENCION. Error de introducción de datos. Revise el número de minutos";
          |ERROR;
          |ACABA;
     |FINSI;

     aAlfa = aHorasSalida + ":" + aMinutosSalida;
     #0Campo = aAlfa;
     |PINTA #0Campo;

     |SI swError = 0;
          |HAZ TotalHoras;
     |FINSI;
|FPRC;

|PROCESO labhisto;
     nCampo1 = 0;
     nCampo2 = 0;

     |SI #labhisto#101 = "labcon01"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labcon02"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labcon05"; nCampo1 = 66; nCampo2 = 67; |FINSI;
     |SI #labhisto#101 = "labcon09"; nCampo1 = 59; nCampo2 = 60; |FINSI;
     |SI #labhisto#101 = "labcon21"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labcon22"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labcon36"; nCampo1 = 56; nCampo2 = 57; |FINSI;
     |SI #labhisto#101 = "labcon39"; nCampo1 = 57; nCampo2 = 59; |FINSI;
     |SI #labhisto#101 = "labcon51"; nCampo1 = 55; nCampo2 = 56; |FINSI;
     |SI #labhisto#101 = "labcon52"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labcon53"; nCampo1 = 59; nCampo2 = 00; |FINSI;
     |SI #labhisto#101 = "labcon54"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labcon55"; nCampo1 = 57; nCampo2 = 59; |FINSI;
     |SI #labhisto#101 = "labcon75"; nCampo1 = 80; nCampo2 = 81; |FINSI;
     |SI #labhisto#101 = "labcon85"; nCampo1 = 29; nCampo2 = 52; |FINSI;
     |SI #labhisto#101 = "labcon86"; nCampo1 = 29; nCampo2 = 00; |FINSI;
     |SI #labhisto#101 = "labcon95"; nCampo1 = 57; nCampo2 = 59; |FINSI;
     |SI #labhisto#101 = "labcon9a"; nCampo1 = 57; nCampo2 = 59; |FINSI;
     |SI #labhisto#101 = "labcona5"; nCampo1 = 68; nCampo2 = 69; |FINSI;
     |SI #labhisto#101 = "labcona6"; nCampo1 = 68; nCampo2 = 69; |FINSI;
     |SI #labhisto#101 = "labconb1"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labconb2"; nCampo1 = 54; nCampo2 = 55; |FINSI;
     |SI #labhisto#101 = "labconb3"; nCampo1 = 55; nCampo2 = 56; |FINSI;
     |SI #labhisto#101 = "labconb5"; nCampo1 = 59; nCampo2 = 00; |FINSI;
     |SI #labhisto#101 = "labconb7"; nCampo1 = 59; nCampo2 = 60; |FINSI;
     |SI #labhisto#101 = "labconb8"; nCampo1 = 59; nCampo2 = 60; |FINSI;
     |SI #labhisto#101 = "labconb9"; nCampo1 = 59; nCampo2 = 60; |FINSI;


     |SI nCampo1 = 0; |Y nCampo2 = 0;
          |ACABA;
     |FINSI;

     aAlfa1 = "";
     aAlfa2 = "";

     aAlfa1 = #labhisto#nCampo1#; |QBF aAlfa1;
     |SI nCampo2 ! 0;
          aAlfa2 = #labhisto#nCampo2#; |QBF aAlfa2;
     |FINSI;
     aAlfa = aAlfa1 + aAlfa2;
     |SI aAlfa ! "";
          swPintaHoras = 1;
          aAlfa2 = aAlfa % 105;
          |SI aAlfa2 = ".....";
               swPintaHoras = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO labregis;
     nRegistro = #labregis#0;
|FPRC;

|DEFBUCLE labregis;
     #labregis#2;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, labregis;
|FIN;

|PROCESO BuscaContrato; |TIPO 14;
     ||ACABA;
     |ABRE #labhisto;

     swPintaHoras = 0;

     nRegistro = 0;
     |BUCLE labregis;

     #labhisto#100 = nRegistro;
     #labhisto#103 = "  ";
     |LEE 000#labhisto.=;
     |SI FSalida = 0;
          |HAZ labhisto;
     |FINSI;

     |SI swPintaHoras = 1;
          #0#37 = #labhisto#nCampo1#;
          #0#38 = #labhisto#nCampo2#;
          |ATRI I;
          |PINTA 2113, "                                                         ";
          |PINTA 2213, "                                                         ";
          |PINTA 2313, "                                                         ";
          |ATRI I;

          |ATRI R;
          |PINTA 2107, "Horario literal registrado en el contrato del trabajador              ";
          |ATRI I;
          |PINTA 2207, #0#37;
          |PINTA 2307, #0#38;
     |SINO;
          |ATRI S;
          |PINTA 2106, "                                                                         ";
          |PINTA 2206, "                                                                         ";
          |PINTA 2306, "                                                                         ";
          |PINTA 2113, " Los horarios introducidos  para el trabajador, se usar n";
          |PINTA 2213, " para rellenar por defecto el registro de horas  realiza-";
          |PINTA 2313, " das mensualmente  por los trabajadores a tiempo parcial.";
          |ATRI I;
     |FINSI;

     |CIERRA #labhisto;
|FPRC;

|PROCESO PintaNombre; |TIPO 7;
     aAlfa = #labempre#2;
     |QBF aAlfa;
     |SI aAlfa = "";
          #labempre#2 = eaEmpresa;
          |PINTA 0831, #labempre#2;
     |FINSI;

     aAlfa = #labtraba#2;
     |QBF aAlfa;
     |SI aAlfa = "";
          #labtraba#2 = eaNombre;
          |PINTA 0931, #labtraba#2;
     |FINSI;
|FPRC;

|PROCESO AcumHoras;
     aAlfa1 = #0nCampo1; |QBF aAlfa1;
     aAlfa2 = #0nCampo2; |QBF aAlfa2;

     |SI aAlfa1 ! ""; |Y aAlfa2 ! "";
          aAlfa = aAlfa1 % 102;
          nHoras1 = aAlfa;
          aAlfa = aAlfa1 % 402;
          nMinutos1 = aAlfa;

          aAlfa = aAlfa2 % 102;
          nHoras2 = aAlfa;
          aAlfa = aAlfa2% 402;
          nMinutos2 = aAlfa;

          nHoras = nHoras2 - nHoras1;
          nMinutos = nMinutos2 - nMinutos1;

          nMinutos = nMinutos / 60;
          nHoras = nHoras + nMinutos;

          nTotal = nTotal + nHoras;
     |FINSI;
|FPRC;

|PROCESO TotalHoras;
     || LUNES
     nTotal = 0;
     nCampoT = 2;
     nCampo1 = 3; nCampo2 = 4; |HAZ AcumHoras;
     nCampo1 = 5; nCampo2 = 6; |HAZ AcumHoras;
     nCampo1 = 39; nCampo2 = 40; |HAZ AcumHoras;
     nCampo1 = 41; nCampo2 = 42; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;

     || MARTES
     nTotal = 0;
     nCampoT = 7;
     nCampo1 = 8; nCampo2 = 9; |HAZ AcumHoras;
     nCampo1 = 10; nCampo2 = 11; |HAZ AcumHoras;
     nCampo1 = 43; nCampo2 = 44; |HAZ AcumHoras;
     nCampo1 = 45; nCampo2 = 46; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;

     || MIERCOLES
     nTotal = 0;
     nCampoT = 12;
     nCampo1 = 13; nCampo2 = 14; |HAZ AcumHoras;
     nCampo1 = 15; nCampo2 = 16; |HAZ AcumHoras;
     nCampo1 = 47; nCampo2 = 48; |HAZ AcumHoras;
     nCampo1 = 49; nCampo2 = 50; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;

     || JUEVES
     nTotal = 0;
     nCampoT = 17;
     nCampo1 = 18; nCampo2 = 19; |HAZ AcumHoras;
     nCampo1 = 20; nCampo2 = 21; |HAZ AcumHoras;
     nCampo1 = 51; nCampo2 = 52; |HAZ AcumHoras;
     nCampo1 = 53; nCampo2 = 54; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;

     || VIERNES
     nTotal = 0;
     nCampoT = 22;
     nCampo1 = 23; nCampo2 = 24; |HAZ AcumHoras;
     nCampo1 = 25; nCampo2 = 26; |HAZ AcumHoras;
     nCampo1 = 55; nCampo2 = 56; |HAZ AcumHoras;
     nCampo1 = 57; nCampo2 = 58; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;

     || SABADO
     nTotal = 0;
     nCampoT = 27;
     nCampo1 = 28; nCampo2 = 29; |HAZ AcumHoras;
     nCampo1 = 30; nCampo2 = 31; |HAZ AcumHoras;
     nCampo1 = 59; nCampo2 = 60; |HAZ AcumHoras;
     nCampo1 = 61; nCampo2 = 62; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;

     || DOMINGO
     nTotal = 0;
     nCampoT = 32;
     nCampo1 = 33; nCampo2 = 34; |HAZ AcumHoras;
     nCampo1 = 35; nCampo2 = 36; |HAZ AcumHoras;
     nCampo1 = 63; nCampo2 = 64; |HAZ AcumHoras;
     nCampo1 = 65; nCampo2 = 66; |HAZ AcumHoras;
     #0nCampoT = nTotal;
     |PINTA #0nCampoT;
|FPRC;
