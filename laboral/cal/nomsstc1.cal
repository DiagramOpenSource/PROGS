|FICHEROS;
    nomsstc1 #0;    || emision TC1
    labempre #1;    || empresas
    labempax #2;    || aux. empresas
    nomconst #3;    || constantes
    nomtepig #4;    || aux. epigrafes
    nomtrtc1 #7;    || campos de impresion
    labcentr #10;   || centros de trabajo
    nomcenes #13;   || centros 18/93
    nomtstc1 #14;   || tmp. para importes TC1
    nomcones #15;   || constantes especiales 18/93
    silcon06 #30;   || datos AGIRED
    nomtraca;
    labtraba;
    nomtepcd;
    nomepigr;
    ref00001@ #1001;
|FIN;

|VARIABLES;
    sgdonum = 0;
    total = 0;
    menos = 0;
    cont = 0;
    epi = 0;
    trab = 0;
    ilt = 0;
    ims = 0;
    bas = 0;
    imp1 = 0;
    imp2 = 0;
    ini = 0;
    x = 0;
    informe = "nomyytc1";
    postal1 = "";   || Codigo postal1 alfa
    postal2 = "";   || Codigo postal2 alfa
    domi    = "";   || Variable para quitar espacios al domicilio
    afili   = "";   || Variable para quitar espacios al nro. de afiliacion
    sgdoalf = "";   || Variable para quitar espacios al nro. de afiliacion
    fecsys = @;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume0 = 0;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;

    p_mes = "";
    desde = 0;
    hasta = 0;
    seleccio = 0;
    seleccio9 = 0;
    runnom = "nomsstc1";
    notaria = 0;
    tip = 0;
    tip2 = 0;
    tip3 = 0;
    emp_ant = -1;
    cen_ant = -1;
    hay_algo = 0;
    el_period = 0;
    c_trab = 0;
    &silcon1 = "";
    &silcon2 = "";
    &silcon3 = "";
    &apelli = "";
    &clave_IE = "";
    por_dfp = 0;
    por_mat = 0;
    liqu = "";
    siono_cen = "";
    formato = "";
    cc64 = 0;
    cc65 = 0;
    para1 = 0;
    para2 = 0;
    nEl36 = 36;
    nBase36 = 0;
    bon_162001 = 0;
    nCuota_mater = 0;
    &EURODB = 0;
    nDS = 0;
    nFG = 0;
    nFP = 0;
    swCte = 0;
    nCteAnt = 0;
    nFPEmp = 0;
    nFPTra = 0;
    nContEmp = 0;
    &aCC = "";

     &fCFecha = @;
     &aCError = "";
     &nCConst = 0;
     aAlfa = "";

     nBase = 0;
     nCuotaTot = 0;
     nCuota = 0;
     nAntPorc = 0;
     nAnyo = 0;
     nILTERE = 0;
     nIMSERE = 0;
     nBaseERE = 0;
     nBaseEREDes = 0;

     &swModulo = 0;
     aContEsp = "";
     n106BomPor = 0;
     n121BomPor = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aFecha = "";
     fFecha = @;
     &nEnEmpresa = 0;
    nCuotaFogTot = 0;
    nCuotaFog = 0;
    nPintaPorc = 0;
    nPorFOGASA = 0;
|FIN;

|INCLUYE i_tempo;
|INCLUYE i_reco2;
|INCLUYE i_cuadr;
||INCLUYE i_verif;
||INCLUYE i_seguim;

|PROCESO SiBomberos;
     aContEsp = "N";
     n106BomPor = 0;
     n121BomPor = 0;
     |SI swModulo = 3145;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/bomb0001.mas";
          |CARGA_DEF aAlfa, ref00001@;
          |SI FSalida = 0;
               |ABRE #1001;
               #1001#0 = #2#0;                || empresa
               #1001#1 = #2#18;               || centro;
               |LEE 000#1001=;
               |SI FSalida = 0;
                    aContEsp = #1001#2;
               |FINSI;
               |CIERRA #1001;
          |FINSI;
          |DESCARGA_DEF #ref00001@;
          |SI aContEsp ! "S";
               |ACABA;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/bomb0003.mas";
          |CARGA_DEF aAlfa , ref00001@;
          |SI FSalida = 0;
               aAlfa1 = #0#2; aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
               aAlfa2 = #0#3;
               aFecha = "01" + "." + aAlfa1 + "." + aAlfa2;
               fFecha = aFecha;
               |ABRE #1001;
               #1001#0 = fFecha;
               |LEE 000#1001];
               |SI FSalida = 0;
                    |SI fFecha ! #1001#0;
                         |LEE 000#1001a;
                    |FINSI;
               |SINO;
                    |LEE 000#1001u;
               |FINSI;
               |CIERRA #1001;
               |SI FSalida = 0; |Y fFecha ] #1001#0;
                    n106BomPor = #1001#1;
                    n121BomPor = #1001#2;
               |SINO;
                    aAlfa = "    No se han definido los % de Cotizacion Especial ";
                    aAlfa = aAlfa + "ni Contingencias Excluidas.";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #ref00001@;
     |FINSI;
     |SI aContEsp = "S";
          #7#146 = 8;
          #7#112 = #7#112 + #2#3;                      || base 106
          #7#114 = n106BomPor;                         || (%) 106
          #7#113 = #7#113 + (#2#3 % n106BomPor);       || cuota 106

          #7#110 = n121BomPor;                         || (%) 121
          #7#111 = ((#7#16 + #7#25) % #7#110) ! EURODB;|| cuota 121
     |FINSI;
|FPRC;

____________________________________/ CALCULOS DE PANTALLA
|PROCESO Tipo88; |TIPO 88;
     |HAZ LeeEURODB;
|FPRC;

|PROCESO defecto; |TIPO 7;
    |SI #0Campo ! 1900;  |ACABA;   |FINSI;

    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
    #0Campo = #0Campo - menos;
|PINTA #0Campo;
|FPRC;

|PROCESO clave_IE;
     alfa1 = #1#10 % 101; || tipo identificador titular
     |SI alfa1 ] "0";|Y alfa1 [ "9";
          clave_IE = "1";            || tipo identificacion DNI
     |SINO;
          |SI alfa1 = "X"; |O alfa1 = "Y"; |O alfa1 = "Z";       || extranjero
               clave_IE = "6";        || tipo identificacion EXTRANJERO
          |SINO;
               |SI alfa1 ] "a";|Y alfa1 [ "z";
                    clave_IE = "2";    || tipo identificacion PASAPORTE
               |SINO;
                    clave_IE = "9";    || tipo identificacion CIF
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|SI Campo = 2;  |PINTA 1225, p_mes;  |FINSI;
|SI Campo = 7;  |PINTA 1325, p_mes;  |FINSI;
|FPRC;

|PROCESO hasmayor; |TIPO 0;  || chequea que el hasta sea mayor que el desde
|SI #0Campo < #0#2;
    |MENAV "    ATENCION !!! Error de entrada ...";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
    #0Campo = #0Campo - 1;
    menos = 0;
|SI #0Campo = 0;
        #0Campo = 12;
        menos = 1;
|FINSI;
|PINTA #0Campo;
|FPRC;
____________________________________/ PREPARACION DEL TC1
|PROCESO tc1;
    notaria = #2#16;

    #7#0 = #1#2;                             || nombre de la empresa
|SI siono_cen = "S";  afili = #10#10;  |FINSI;
|SI siono_cen = "N";  afili = #1#13;   |FINSI;
|QBF afili;
    sgdoalf = afili % 0;
    sgdonum = sgdoalf;
    sgdonum = sgdonum - 4;
    sgdonum = sgdonum + 300;                 || para coger 2do. digito
    #7#1 = afili % 102;                      || primer digito S.S.
    #7#2 = afili % sgdonum;                  || segundo digito S.S.
    #7#3 = afili % -102;                     || tercer digito S.S.
|SI tip = 5;
    |SI siono_cen = "S";                    || DATOS CENTRO
            domi = #10#3;
        |QBF domi;
            #7#4 = domi+" "+#10#4+" "+#10#5;
            postal1 =  "00" + #10#7;
            postal1 = postal1 % -102;
            postal2 = "000" + #10#8;
            postal2 = postal2 % -103;
            #7#5 = " " + postal1 + postal2 + " " + #10#6;
            #7#6 = #10#9;
            #7#9 = #10#14;                        || entidad
            #7#10 = #10#13;                       || clave entidad
    |SINO;                             || DATOS EMPRESA
            domi = #1#3;
        |QBF domi;
            #7#4 = domi+" "+#1#4+" "+#1#5;
            postal1 = "00" + #1#7;
            postal1 = postal1 % -102;
            postal2 = "000" + #1#8;
            postal2 = postal2 % -103;
            #7#5 = " " + postal1 + postal2 + " " + #1#6;
            #7#6 = #1#9;
            #7#9 = #1#20;                         || entidad
            #7#10 = #1#19;                        || clave entidad
    |FINSI;
|SINO;
    |HAZ cen_esp;
        domi = #13#3;
    |QBF domi;
        #7#4 = domi+" "+#13#4+" "+#13#5;
        postal1 =  "00" + #13#7;
        postal1 = postal1 % -102;
        postal2 = "000" + #13#8;
        postal2 = postal2 % -103;
        #7#5 = " " + postal1 + postal2 + " " + #13#6;
        #7#6 = #13#9;
        #7#9 = #13#15;                       || entidad
        #7#10 = #13#14;                      || clave entidad
|FINSI;
    #7#7 = "";                             || Mes en letra (INHIBIDO!!)
    #7#11 = #1#12;                         || Actividad empresa
    #7#12 = #1#11;                         || Clave actividad
    #7#13 = #1#10;                         || CIF empresa
    |HAZ clave_IE;

|SI tip = 5;
        #7#14 = #7#14 + #2#3;              || Contingencias comunes
        #7#15 = #3#6 + #3#7;
        #7#16 = #7#14 % #7#15;

        #7#23 = #7#23 + #2#4;              || Contingencias comunes coef.red.
        #7#24 = #3#6;
        #7#25 = #7#23 % #7#24;
|FINSI;                            || tiempo parcial <12 horas R.D.489/98

|SI tip = 7;
    |SI liqu = "T";
            || cc64 = ((#3#6 * #15#21)!2) + ((#3#7 * #15#21)!2);
            || cc65 = ((#3#6 * #15#22)!2) + ((#3#7 * #15#22)!2);
    |FINSI;
    |SI liqu = "O";
            || cc64 = (#3#7 * #15#21) ! 2;
            || cc65 = (#3#7 * #15#22) ! 2;
    |FINSI;
    |SI liqu = "P";
            || cc64 = (#3#6 * #15#21) ! 2;
            || cc65 = (#3#6 * #15#22) ! 2;
    |FINSI;

        #7#14 = #7#14 + (#2#48 + #2#49);     || Contingencias comunes
    |SI #7#16 = 0;
        |SI #2#48 ! 0;|Y #2#49 ! 0;
                #7#15 = 0;
        |SINO;
            |SI #2#48 ! 0;    #7#15 = cc64;  |FINSI;
            |SI #2#49 ! 0;    #7#15 = cc65;  |FINSI;
        |FINSI;
    |SINO;
        |SI #2#48 ! 0;|Y #7#15 = cc65;  #7#15 = 0;     |FINSI;
        |SI #2#49 ! 0;|Y #7#15 = cc64;  #7#15 = 0;     |FINSI;
    |FINSI;
        #7#16 = #7#16 + (#2#48 % cc64) + (#2#49 % cc65);

        #7#23 = 0;
        #7#24 = 0;
        #7#25 = 0;
|FINSI;

    #7#17 = #7#17 + #2#5;                  || Horas extras estruc.
    #7#18 = #3#8 + #3#9;
    #7#19 = #7#17 % #7#18;

    #7#20 = #7#20 + #2#6;                  || Horas extras no estruc.
    #7#21 = #3#10 + #3#11;
    #7#22 = #7#20 % #7#21;

|SI tip = 0; |O tip = 5;
          nBase36 = (#2#51 % #3#6) ! EURODB;
          #7#113 = #7#113 + (#2#3 % #3#74) + (nBase36 % nEl36); || cuota 106
          #7#147 = #7#147 + nBase36;                            || parcial base 106
          |SI #3#74 ! 0;|Y #7#147 ! 0;
               #7#112 = 0;                        || base 106 (conjunto)
               #7#114 = 0;                        || (%) 106 (conjunto)
               #7#146 = 8;                        || tipo 106 (conjunto)
          |SINO;
               |SI #3#74 ! 0;
                    #7#112 = #7#112 + #2#3;       || base 106 (notarias)
                    #7#114 = #3#74;               || (%) 106 (notarias)
                    #7#146 = 8;                   || tipo 106 (notarias)
               |FINSI;
               |SI #7#147 ! 0;
                    #7#112 = #7#112 + nBase36;    || base 106 (12/2001)
                    #7#114 = nEl36;               || (%) 106 (12/2001)
                    #7#146 = 6;                   || tipo 106 (12/2001)
               |FINSI;
          |FINSI;

        #7#119 = #7#16;                    || deducc.volunt.(122)
        #7#120 = #3#75;                    || (%) deduc.volunt.
        #7#121 = #7#119 % #7#120;          || cuota deduc.volunt. (132)
|FINSI;
    #7#110 = notaria;                      || (%) deducc.notarias
    #7#111 = ((#7#16 + #7#25) % #7#110) ! EURODB;         || cuota notarias 131

     nEnEmpresa = #2#0;
     |HAZ BuscaModulo;
     |SI tip ! 3;
          |HAZ SiBomberos;
     |FINSI;

    #7#26 = #7#16 + #7#19 + #7#22 + #7#25 + #7#113; || Suma de cuotas
    ||#7#27 = #7#27 + #2#7;                  || Plus familiar (*)
    ||#7#28 = #7#28 + #2#8;                  || Asistencia subnormal (*)
    #7#29 = #7#29 + #2#9;                  || Importe I.L.T. (*)
    #7#30 = #7#30 + #2#11 + #2#21;         || Bonificaciones contingencias (*)
    #7#31 = #7#27 + #7#28 + #7#29 + #7#30;   || Punto 210
    #7#32 = #7#26 - #7#31 - #7#111 - #7#121; || Punto 299
    nBaseEREDes = 0;
|HAZ leepitrab;
|SI tip ! 6;
        nDS = #3#12 +#3#13;                                 || DESEMPLEO
        nFG = #3#14 +#3#15;                                 || FG
        nFP = #3#16 +#3#17 +#3#18 +#3#19;                   || FP+FS
        nDS = (#7#80 % nDS) ! EURODB;   || la TGSS lo calcula asi,
        nFG = (#7#80 % nFG) ! EURODB;   ||/sino se provocan diferencias
        nFP = (#7#80 % nFP) ! EURODB;
        #7#86 = #3#12 +#3#13 +#3#14 +#3#15 +#3#16 +#3#17 +#3#18 +#3#19;
        #7#87 = nDS + nFG + nFP;
        #7#88 = #7#87;                     || Punto 510

        #7#149 = #3#12 + #3#14 + #3#16 + #3#18; || porc. en CP Maternidad
        || #7#150 = #7#148 % #7#149;               || cuota en CP Maternidad
        #7#150 = (#7#148 + #7#158) % #7#149;    || cuota en CP Maternidad+ERE
        nCuota_mater = nCuota_mater ! EURODB;
        nume0 = #7#150 - nCuota_mater;
/*        |SI nume0 < 0; nume0 = -nume0; |FINSI;
        |SI nume0 > 0.03;
               |SI por_mat = -1; por_mat = 0; |FINSI;
               #7#149 = por_mat;
               #7#150 = nCuota_mater;
        |FINSI;
*/
        #7#150 = nCuota_mater;     || siempre lo calculado
        |SI #4#17 ! 0;
            #7#149 = #4#17;        || si me he guardado algun %  en el nomtepig
        |SINO;                     || es que tengo que pintarlo
            #7#149 = 0;
        |FINSI;

        #7#145 = nCuotaTot;   || ATENCION: 21.01.04: esta cuota es la que cal-
                              || culo mediante el proceso LaCuota, respecto a
                              || los importes grabados. Se cambia por las di-
                              || ferencias que se provocaban respecto a TGSS.
        || #7#145 = #7#145 + nFG + nFP;
        #7#145 = #7#145 + nCuotaFogTot + nFP;
        #7#145 = #7#145 ! EURODB;
        nume1 = #7#87 - #7#145;
        por_dfp = #7#86;

/*        |SI nume1 < 0;   nume1 = -nume1; |FINSI;
        |SI nume1 > 0.03;
               #7#86 = 0;
               #7#88 = #7#145;
        |FINSI;
*/
         #7#88 = #7#145;          || siempre lo calculado
         |SI #4#20 ! 0;
              #7#86 = #4#20;      || si me he guardado algun %  en el nomtepig
         |SINO;                   || es que tengo que pintarlo
              #7#86 = 0;
         |FINSI;

        || #7#87 = #7#80;
        #7#87 = #7#80 + nBaseEREDes;        || el 301 (= 501 + 502) + base ERE
        #7#80 = #7#80 - #7#148;
        || #7#88 = #7#88 - (#7#148 % por_dfp);
        #7#88 = #7#88 - nContEmp;
        #7#80 = #7#80 - bon_162001;             || resta base bon. RDL 162002 > 65
        #7#88 = #7#88 - (bon_162001 % por_dfp); || resta cuota bon. RDL 162002 > 65
        #7#148 = #7#148 + #7#158;  || acumulo al 148 el 158 (ERE)
|SINO;
        #7#14 = 0;
        #7#15 = 0;
        #7#80 = 0;
        #7#86 = 0;
    |SI liqu = "T";      || total
            ||#7#16 = #7#16 + (((#15#10 + #15#13) * #2#46) + ((#15#16 + #15#19) * #2#47));
            #7#16 = #7#16 + ((#3#82 + #3#83) * #2#47);
    |FINSI;
    |SI liqu = "O";      || obrera
            ||#7#16 = #7#16 + ((#15#13 * #2#46) + (#15#19 * #2#47));
            #7#16 = #7#16 + (#3#83 * #2#47);
    |FINSI;
    |SI liqu = "P";      || patronal
            ||#7#16 = #7#16 + ((#15#10 * #2#46) + (#15#16 * #2#47));
            #7#16 = #7#16 + (#3#82 * #2#47);
    |FINSI;
    |SI liqu = "A";      || aplazamiento de cuotas
            ||#7#16 = #7#16 + ((#15#13 * #2#46) + (#15#19 * #2#47));
            #7#16 = #7#16 + (#3#83 * #2#47);
    |FINSI;
        #7#32 = #7#16 + #7#19 + #7#22 - #7#31 - #7#111;     || casilla 299
    |SI liqu = "T";      || total
            || #7#88 = #7#88 + (((#15#12 + #15#5) * #2#46) + ((#15#18 + #15#20) * #2#47));
            #7#88 = #7#88 + ((#3#84 + #3#85) * #2#47);
    |FINSI;
    |SI liqu = "O";      || obrera
            || #7#88 = #7#88 + ((#15#5 * #2#46) + (#15#20 * #2#47));
            #7#88 = #7#88 + (#3#85 * #2#47);
    |FINSI;
    |SI liqu = "P";      || patronal
            || #7#88 = #7#88 + ((#15#12 * #2#46) + (#15#18 * #2#47));
            #7#88 = #7#88 + (#3#84 * #2#47);
    |FINSI;
    |SI liqu = "A";      || aplazamiento de cuotas
            || #7#88 = #7#88 + ((#15#5 * #2#46) + (#15#20 * #2#47));
            #7#88 = #7#88 + (#3#85 * #2#47);
    |FINSI;
|FINSI;
    #7#89 = #7#89 + #2#12;                 || Bonificaciones inem (*)
    #7#90 = #7#88 + #7#150 - #7#89;        || Diferencia
    #7#91 = #7#91 + #2#15;                 || Acumulados disponibles (*)
    #7#92 = #7#90 - #7#91;                 || Punto 699
    #7#93 = #7#32 + #7#85 + #7#92;         || Base calculo recargo
    #7#94 = #1#127;                        || Recargo
    #7#97 = (#7#93 % #7#94);                   || TOTAL RECARGO
    total = (#7#32 + #7#85 + #7#92 + #7#97) ! EURODB; || TOTAL A PAGAR
|SI total > 0; #7#98 = total; #7#99 = 0;        |FINSI;  || A ingresar
|SI total < 0; #7#99 = total * (-1); #7#98 = 0; |FINSI;  || A percibir
    #7#100 = #1#0;                         || Codigo empresa
    #7#101 = #1#30;                        || Codigo banco
    #7#102 = #1#31;                        || Nombre banco
    #7#104 = #7#89 + #7#91;                || Punto 610 (TC1/92)
|SI tip = 5;
    |SI siono_cen = "N";   #7#105 = #01#13;   |FINSI;       || s.s. empresa
    |SI siono_cen = "S";   #7#105 = #10#10;   |FINSI;       || s.s. centro
|SINO;
        #7#105 = #13#10;                               || s.s. centro 18/93
|FINSI;
|SI #0#7 = #0#2;|O formato = 1;
        #7#8 = el_period + 2000;        || a¤o hasta
        #7#103 = #2#1;                  || mes hasta
        #7#106 = #7#103;                || mes desde
        #7#107 = #7#8;                  || año desde
|SINO;
        #7#8 = el_period + 2000;        || a¤o hasta
        #7#103 = #0#7;                  || mes hasta
        #7#106 = #0#2;                  || mes desde
        #7#107 = #7#8;                  || a¤o desde
|FINSI;
|SI #7#103 = #7#106; #7#106 = 0; #7#107 = 0; |FINSI;

    #7#108 = #2#17;                     || Nro. de TC2/1 (*)
     |SI bon_162001 > 0;                || clave del 209
         |SI #7#108 > 0;                || si hay bon RDL 16/2001
             #7#108 = 5;                || y otras es un "5"
         |SINO;                         || si solo hay del RDL 16/2001
             #7#108 = 1;                || es un "1"
         |FINSI;
     |FINSI;
|SI tip2 = 0;
        #7#109 = #0#10;
|SINO;
        #7#109 = "E.R.Emp.Atrasos: " + #1#29 + "/" + #1#35; || nro.exp.
|FINSI;
    #7#115 = #1#113;                       || cuenta corriente
    #7#116 = #0#13;                        || fecha impresion

|SI #2#22 = "N";                           || TC1/TC2 abreviado
    |PARA para1 = 122; |SI para1 [ 144; |HACIENDO para1 = para1 + 1;
            para2 = para1 - 99;
            #7para1 = #2para2;
    |SIGUE;
        #7#133 = (#2#34 % 102) + (#2#34 % 402) + (#2#34 % -104);

        alfa1 = #7#142; |QBF alfa1;
        alfa2 = #7#143; |QBF alfa2;    || une los dos apellidos
        apelli = alfa1 + " " + alfa2;

        alfa1 = "1";
        alfa2 = #7#123 % 101;
    |SI alfa2 ] "A";|Y alfa2 [ "z";
        |SI alfa2 = "X"; |O alfa2 = "Y"; |O alfa2 = "Z";       || extranjero
                alfa1 = "6";                || tipo identif. (EXTRANJERO)
        |SINO;
                alfa1 = "2";                || tipo identif. (PASAPORTE)
        |FINSI;
    |FINSI;
        #7#123 = alfa1 + (#7#123 % 111);
|SINO;
    |PDEFECTO #7, 122, 145;
        apelli = "";
|FINSI;

|FPRC;

|PROCESO cen_esp;
|ABRE #13;
|DDEFECTO #13;
    #13#0 = #1#0;
|SI #2#18 = 99;  #13#13 = 1;      |FINSI;
|SI #2#18 ! 99;  #13#13 = #2#18;  |FINSI;
|SI tip = 6;  #13#1 = 87;  |FINSI;
|SI tip = 7;  #13#1 = 64;  |FINSI;
|LEE 000#13=;
|CIERRA #13;
|FPRC;

|PROCESO mira_cte;
     |DDEFECTO #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida ! 0;|O #nomtraca#3 = 0;
          swCte = 1;
          |ERROR10;
     |SINO;
          |SI #nomtraca#3 ! nCteAnt; |Y nCteAnt ! 0;
               swCte = 1;
               |ERROR10;
          |FINSI;
          nCteAnt = #nomtraca#3;
     |FINSI;
|FPRC;

|DEFBUCLE trabajadores;
     #labtraba#1;
     77;
     #2#0,     1, #2#18;
     #2#0, 99999, #2#18;
     ;
     NULL, mira_cte;
|FIN;

|PROCESO cte_centro;
     swCte = 0;
     nCteAnt = 0;
     |ABRE #nomtraca;
     |BUCLE trabajadores;
     |CIERRA #nomtraca;
     |SI swCte ! 1;
          #3#0 = nCteAnt;
     |FINSI;
|FPRC;

____________________________________/ IMPRESION DE CADA TC1
|PROCESO sacalo;
|SI hay_algo ! 0;
        seleccio = 1;
    |HAZ lee_silcon;
    |INFOR c_informe;
    aCC = "4 6 0";
    |PRINT;
    |PIEINF;
    |FININF;
    |HAZ graba_total;
    |SI #0#6 = "T";
/*
            se_empre = emp_ant;    || codigo empresa
            se_tipos = "tc1";      || tipo de modelo
        |SI siono_cen = "N";
                se_activ = 99;     || centro de trabajo (99)
        |SINO;
                se_activ = cen_ant;|| centro de trabajo asignado
        |FINSI;
            se_impor = total;      || total a pagar
            se_fecha = #7#116;     || fecha emision
            se_prime = tip3;       || tipo (con el cero inicializa importe)
        |HAZ AlAgicli;
*/
    |FINSI;

        cen_ant = #2#18;
        emp_ant = #2#0;
    |DDEFECTO #7;
|FINSI;
|FPRC;

|PROCESO graba_total;
|SI #0#6 = "T";
        #14#0 = emp_ant;
        #14#1 = cen_ant;
    |SI formato = 1;|O #0#2 = #0#7;
            #14#2 = #7#103;             || mes hasta
    |SINO;
            #14#2 = #7#106;             || mes desde
    |FINSI;
        #14#3 = tip3;
        #14#5 = el_period;
        #14#4 = total;
    |GRABA 020#14n;
|FINSI;
|FPRC;

|PROCESO graba_cero;
|SI #0#6 = "T";
    |LEE 121#2=;
        #2#20 = 0;
    |GRABA 020#2a;
    |LIBERA #2;
|FINSI;
|FPRC;

|PROCESO lee_silcon;
    silcon1 = "";
    silcon2 = "";
    silcon3 = "";
|DDEFECTO #30;
|ABRE #30;
    #30#0 = #7#100;
|LEE 000#30=;
|SI FSalida = 0;
        silcon1 = "NO ACOMPA¥A TC2.";
        silcon2 = "Aut.TGSS";
        silcon3 = "del";
        #7#117 = #30#5;                 || nro.autorizacion SILCON
        #7#118 = #30#6;                 || fecha autorizacion SILCON
|FINSI;
|CIERRA #30;
|FPRC;

|PROCESO limpieza;    || Pone a cero constantes segun patronal u obrera
|SI liqu ! "T";
    |SI liqu = "O"; |O liqu = "A";
            ini = 6;
            #2#4 = 0;
            #2#7 = 0;   || plus familiar aux. empresas
            #2#8 = 0;   || asist. subnormal aux. empresas
            #2#9 = 0;   || importe I.L.T. aux. empresas
            #2#10 = 0;  || importe accidentes aux. empresas
            #2#11 = 0;  || bonificaciones contingencias
            #2#12 = 0;  || bonificaciones INEM
            #2#15 = 0;  || acumulados disponibles
            #2#21 = 0;   || compens.maternidad
            #3#74 = 0;   || recargo notarias-ayuntamientos
    |SINO;
            ini = 7;
            #3#5 = 0;    || coeficiente reductor no en patronal
    |FINSI;
    |PARA x = ini; |SI x < 20; |HACIENDO x = x + 2;
            #3x = 0;
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#2;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
     |SI aCError ! "";
          aAlfa = "0000No se ha encontrado la Constante Comun del ";
          aAlfa = aAlfa + " Regimen General (500)";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO empresa;
     #1#0 = #2#0;
     |LEE 000#1=;
     |SI FSalida = 0;
          |SI #1#46 ! "S";|Y #1#46 ! "N";     #1#46 = "N";   |FINSI;
          |SI #1#48 ! "1";|Y #1#48 ! "2";     #1#48 = "2";   |FINSI;

          |SI #1#46 ! siono_cen;    |ACABA;   |FINSI;
          |SI #1#48 ! formato;      |ACABA;   |FINSI;

          #10#0 = #2#0;
          #10#1 = #2#18;
          |LEE 000#10=;
          |SI FSalida = 0;|O #2#18 = 99;
               nCConst = 500;
               |HAZ constante;
               ||#3#0 = #1#32;
               ||SI siono_cen = "S";
                    ||HAZ cte_centro;
               ||FINSI;
               ||LEE 000#3=;                    || lee constante
               ||SI FSalida = 0;
               |SI aCError = "";
                    ||DDEFECTO #15;
                    ||#15#0 = #1#32;          || lee constante especial
                    ||LEE 000#15=;
                    |HAZ limpieza;         || obrera, patronal o total
                    |SI emp_ant = -1;
                         emp_ant = #2#0;  cen_ant = #2#18;
                    |FINSI;
                    |SI emp_ant ! #2#0;        || por empresas
                         |HAZ sacalo;
                    |SINO;
                         |SI cen_ant ! #2#18;|Y siono_cen = "S";     || por centros
                              |HAZ sacalo;
                         |SINO;
                              |SI formato = 1;                        || por meses
                                   |HAZ sacalo;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |HAZ tc1;         || calculo del TC1
                    hay_algo = 1;
                    |HAZ graba_cero;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
____________________________________/ ACTUALIZACION IMPORTES TC1 EMPRESA
|PROCESO graba_tc12;
    #1#0 = emp_ant;
|LEE 101#1=;
|SI FSalida = 0;
        #1#126 = total;
    |GRABA 020#1a;
|FINSI;
|LIBERA #1;

    total = 0;
    emp_ant = #2#0;
|FPRC;

|PROCESO graba_tc11;
|SI #2#2 !  0;|Y #2#2 !  8;|Y #2#2 !  9;     || solo los de atrasos
 |Y #2#2 ! 10;|Y #2#2 ! 18;|Y #2#2 ! 19;

    |SI emp_ant = -1;   emp_ant = #2#0;     |FINSI;

    |SI emp_ant ! #2#0;
        |HAZ graba_tc12;
    |FINSI;
        total = total + #2#20;

|FINSI;
|FPRC;

|PROCESO graba_tc10;
    emp_ant = -1;
    total = 0;
|FPRC;

|DEFBUCLE graba_tc1;
 #2#1;
 ;
 #0#0,   0, #0#2,  0;
 #0#1, 999, #0#7, 19;
 ;
 graba_tc10, graba_tc11, NULL, NULL, graba_tc12;
|FIN;

|PROCESO actua_empresa;
|ABRE #1;
|BUCLE graba_tc1;
|CIERRA #1;
|FPRC;
____________________________________/ CALCULO PRINCIPAL
|DEFBUCLE auxiliar;
 #2#1;
 50;
 #0#0, #0#4, #0#2, tip3, "G";
 #0#1, #0#5, #0#7, tip3, "G";
 ;
 NULL, empresa, NULL, NULL, sacalo;
|FIN;

|PROCESO lecturas;
|PARA tip2 = 0; |SI tip2 [ 10; |HACIENDO tip2 = tip2 + 10;

    |SI tip2 = 0;   liqu = #0#6;   |FINSI;
    |SI tip2 = 10;  liqu = #0#11;  |FINSI;

    |SI #0#12 = "T";|O #0#12 = "R";
        emp_ant = -1;   cen_ant = -1;   hay_algo = 0;
        tip = 5;    tip3 = tip + tip2;  |BUCLE auxiliar;     || todos
    |FINSI;

||    |SI #0#12 = "T";|O #0#12 = "A";
||        emp_ant = -1;   cen_ant = -1;  hay_algo = 0;
||        tip = 6;    tip3 = tip + tip2;  |BUCLE auxiliar;     || aprendizaje
||    |FINSI;

    |SI #0#12 = "T";|O #0#12 = "P";
        emp_ant = -1;   cen_ant = -1;   hay_algo = 0;
        tip = 7;    tip3 = tip + tip2;  |BUCLE auxiliar;     || tiempo parcial
    |FINSI;
|SIGUE;
|FPRC;

|PROCESO principal;
    seleccio = 0;
|HAZ nom_usu;
    alfa1 = nom_tmp;
|NOME_DAT #14 alfa1;
|DELINDEX #14;
|ABRE #1;             || empresas
|ABRE #3;             || constantes
|ABRE #10;            || centros de trabajo
|ABRE #14;
|ABRE #15;
|HAZ lecturas;
|CIERRA #1;
|CIERRA #3;
|CIERRA #10;
|CIERRA #14;
|CIERRA #15;
|SI seleccio ! 0;
    |SI #0#6 = "T";
        |HAZ re_importe;
        |HAZ actua_empresa;
        |DELINDEX #14;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO tipo3; |TIPO 3;
    c_informe = "nomyytc1";
|HAZ cuadres;
|SI sw_cuadre = 0;
    |IMPRE 0;
    |SI FSalida = 0;
            el_period = #0#3 $ 100;

        |MENSA "2302Imprimiendo TC1 de empresas (separado) ...          ";
        formato = "1";   siono_cen = "N";    |HAZ principal;
        seleccio9 = seleccio9 + seleccio;

        |MENSA "2302Imprimiendo TC1 de centros de trabajo (separado) ...";
        formato = "1";   siono_cen = "S";    |HAZ principal;
        seleccio9 = seleccio9 + seleccio;

        |MENSA "2302Imprimiendo TC1 de empresas (refundido) ...         ";
        formato = "2";   siono_cen = "N";    |HAZ principal;
        seleccio9 = seleccio9 + seleccio;

        |MENSA "2302Imprimiendo TC1 de centros de trabajo (refundido) ...";
        formato = "2";   siono_cen = "S";    |HAZ principal;
        seleccio9 = seleccio9 + seleccio;

        |SI seleccio9 = 0;
            |MENAV "    Seleccion vacia ...";
        |FINSI;
    |SINO;
        |MENAV "    Proceso abortado ...";
    |FINSI;
    |FINIMP;
|FINSI;
|FPRC;
____________________________________/ ACTUALIZACION IMPORTES TC1 AUX.EMPRESA
|PROCESO importes1;
    #2#0 = #14#0;
    #2#18 = #14#1;
    #2#1 = #14#2;
    #2#2 = #14#3;
|LEE 121#2=;
|SI FSalida = 0;
        #2#20 = #14#4;
    |GRABA 020#2a;
|FINSI;
|LIBERA #2;
|FPRC;

|DEFBUCLE importes;
 #14#1;
 ;
     0,   0,  0,  1,  0;
 99999, 999, 99, 12, 19;
 ;
 NULL, importes1;
|FIN;

|PROCESO re_importe;
|ABRE #2;
|BUCLE importes;
|CIERRA #2;
|FPRC;
____________________________________/ CALCULOS DE LECTURA DE EPIGRAFES
     / LA RUPTURA SE HACE EN EL CUARTO EPIGRAFE POR ADAPTACION AL TC1/16
|PROCESO losseis1;
    cont = 0;       || contador para saber que no pase de 4 (TC1/16)
    epi  = 33;
    trab = 34;
    ilt  = 35;
    ims  = 36;
    bas  = 37;
    imp1 = 38;
    imp2 = 39;
    bon_162001 = 0;
    nCuota_mater = 0;
    por_mat = 0;
    nFPEmp = 0;
    nFPTra = 0;
    nContEmp = 0;
     nBaseERE = 0;
     nILTERE = 0;
     nIMSERE = 0;
|FPRC;
/*
|PROCESO epigrafe_ERE;
     |SI #4#19 ! 0;
          |ABRE #nomepigr;
          |SI #0#3 [ 2006;
               #nomepigr#0 = 126;
          |SINO;
               #nomepigr#0 = 904;
          |FINSI;
          |LEE 000#nomepigr.=;
          |SI FSalida = 0;
               nBaseERE = nBaseERE + #4#19;
               || migue
               || nILTERE = nILTERE + (#4#19 % #nomepigr#1);
               || nIMSERE = nIMSERE + (#4#19 % #nomepigr#2);
               nILTERE = nILTERE + #4#22;
               nIMSERE = nIMSERE + #4#23;
          |FINSI;
          |CIERRA #nomepigr;
     |FINSI;
|FPRC;
*/

|PROCESO epigrafe_ERE;
     || migue
     |SI #4#19 ! 0;
          nBaseERE = nBaseERE + #4#19;
          nILTERE = nILTERE + #4#22;
          nIMSERE = nIMSERE + #4#23;
     |FINSI;
|FPRC;

|PROCESO losseis2;
    cont = cont + 1;
|SI liqu = "O";                || si es obrera limpia importes epigrafes
        #4#7 = 0;              || importe I.L.T.
        #4#8 = 0;              || importe I.M.S.
        #4#14 = 0;
        #4#19 = 0;
|FINSI;
|SI cont [ 4;
        #7epi  = #4#2;                          || Epigrafe
        #7trab = #7trab + #4#6;                 || Numero de trabajadores (*)
        #7ilt  = #4#3;                          || % I.L.T.
        #7ims  = #4#4;                          || % I.M.S.
        #7bas  = #7bas + #4#5;                  || Bases (*)
        #7imp1 = #7imp1 + #4#7;                 || Importe I.L.T. (*)
        #7imp2 = #7imp2 + #4#8;                 || Importe I.M.S. (*)

        epi    = epi  + 7;
        trab   = trab + 7;
        ilt    = ilt  + 7;
        ims    = ims  + 7;   || acumula punteros
        bas    = bas  + 7;
        imp1   = imp1 + 7;
        imp2   = imp2 + 7;
|SINO;
        #7#75 = #7#75 + #4#6;                 || Numero de trabajadores
        #7#76 = #7#76 + #4#5;                 || Bases
        #7#77 = #7#77 + #4#7;                 || Importe I.L.T.
        #7#78 = #7#78 + #4#8;                 || Importe I.M.S.
|FINSI;
    c_trab = c_trab + #4#6;
    #7#148 = #7#148 + #4#14;           || Base Cont. Prof. Maternidad
    #7#158 = #7#158 + #4#19;   || Base ERE
    bon_162001 = bon_162001 + #4#15;   || Base bonif. RDL 16/2001 >65
     nCuota_mater = nCuota_mater + #4#16 + #4#20; || Cuota cont. empres. calculada para
              || comparacion por diferencia d constante (incluye ERE)
     |HAZ epigrafe_ERE;
     |SI liqu = "A";
          #7#148 = 0;
          #7#158 = 0;
     |FINSI;

|SI #4#17 > 0;
     |SI por_mat ! -1;                || a -1 indica que hay bases pero con
          |SI por_mat > 0;            || porcentajes diferentes
               |SI #4#17 ! por_mat;
                    por_mat = #4#17;
               |FINSI;
          |SINO;
               por_mat = #4#17;
          |FINSI;
     |FINSI;
|FINSI;

nCuota_mater = nCuota_mater + #4#16; || Cuota cont. empres. calculada para
                                     || comparacion por diferencia d constantes

|SI liqu = "T";
     nContEmp = nContEmp + #4#16 + #4#18;
|FINSI;
|SI liqu = "O";
     nContEmp = nContEmp + #4#18;
|FINSI;
|SI liqu = "P";
     nContEmp = nContEmp + #4#16;
|FINSI;
|SI liqu = "A";
     nContEmp = nContEmp + #4#18;
|FINSI;
nFPEmp = nFPEmp + #4#12;
nFPTra = nFPTra + #4#13;
|FPRC;

|PROCESO losseis3;
||SI c_trab > #7#79;
||        #7#79 = c_trab;
||FINSI;
||    #7#79 = #7#34 +#7#41 +#7#48 +#7#55 +#7#62 +#7#69 +#7#75; || trabajadores
    #7#80 = #7#37 +#7#44 +#7#51 +#7#58 +#7#65 +#7#72 +#7#76; || bases
    #7#81 = #7#38 +#7#45 +#7#52 +#7#59 +#7#66 +#7#73 +#7#77; || importe I.L.T
    #7#82 = #7#39 +#7#46 +#7#53 +#7#60 +#7#67 +#7#74 +#7#78; || importe I.M.S
    nBaseEREDes = nBaseEREDes + nBaseERE;   || me la guardo para sumar a base
    #7#81 = #7#81 + nILTERE;                || epig. a imprimir
    #7#82 = #7#82 + nIMSERE;
    #7#83 = #7#81 + #7#82;                        || Punto 310
    #7#84 = #7#84 + #2#10;                        || Importe accidentes (*)
    #7#85 = #7#83 - #7#84;                        || Punto 499
    #7#79 = #7#79 + #2#13;                        || trabajadores
|SI liqu = "P";     #7#145 = #7#145 + (nFPEmp ! EURODB); |FINSI;
|SI liqu = "O";     #7#145 = #7#145 + (nFPTra ! EURODB); |FINSI;
|SI liqu = "T";     #7#145 = #7#145 + (nFPEmp ! EURODB) + (nFPTra ! EURODB); |FINSI;
|SI liqu = "A";     #7#145 = #7#145 + (nFPTra ! EURODB); |FINSI;
|FPRC;

|DEFBUCLE nomsstc11;
 #4#1;
 ;
 #2#0, #2#18, #2#1,   0, tip3;
 #2#0, #2#18, #2#1, 999, tip3;
 ;
 losseis1, losseis2, NULL, NULL, losseis3;
|FIN;

|PROCESO leepitrab;
    c_trab = 0;
|BUCLE nomsstc11;
|HAZ LaCuota;
|FPRC;

__________________/ LECTURA DE AUXILIARES PARA CUOTAS DESEMPLEO

|PROCESO sumacuotaM;
     |SI nAntPorc = #nomtepcd#21;
          nBase = nBase + #nomtepcd#5;
          nPintaPorc = #nomtepcd#21 + #nomtepcd#23;
          nPorFOGASA = #nomtepcd#23;
     |SINO;
          nCuota = (nBase * nAntPorc / 100) ! 2;
          nCuotaTot = nCuotaTot + nCuota;

          nCuotaFog = (nBase * #nomtepcd#23 / 100) ! 2;
          nCuotaFogTot = nCuotaFogTot + nCuotaFog;

          nPorFOGASA = #nomtepcd#23;
          nPintaPorc = 0;

          nBase = #nomtepcd#5;
     |FINSI;
     nAntPorc = #nomtepcd#21;
|FPRC;

|DEFBUCLE nomtepcd;
     #nomtepcd#2;
     ;
       0, #2#0, #0#2, 00001, #2#18,   0, tip3; || %,Emp,Mes,Tra,Cen,Epi,Tip
     100, #2#0, #0#2, 99999, #2#18, 999, tip3;
     ;
     NULL, sumacuotaM;
|FIN;

|PROCESO LaCuota;
     nBase = 0;
     nCuota = 0;
     nCuotaTot = 0;

     nCuotaFog = 0;
     nCuotaFogTot = 0;
     nPorFOGASA = 0;
     nPintaPorc = 0;

     nAntPorc = 0;
     nAnyo = #0#3 - 2000;
     |BUCLE nomtepcd;

     nCuota = (nBase * nAntPorc / 100) ! 2;
     nCuotaTot = nCuotaTot + nCuota;
     nCuotaFog = (nBase * nPorFOGASA / 100) ! 2;
     nCuotaFogTot = nCuotaFogTot + nCuotaFog;

     nume1 = nCuotaTot - (nFPTra ! EURODB) - (nFPEmp ! EURODB);
     |SI liqu = "P";
          nCuotaTot = nCuotaTot - (nFPTra ! EURODB);
          nCuotaTot = nCuotaTot - nume1;
     |FINSI;
     |SI liqu = "O";
          nCuotaTot = nCuotaTot - (nFPEmp ! EURODB);
          nCuotaFogTot = 0;
     |FINSI;
     |SI liqu = "A";
          nCuotaTot = nCuotaTot - (nFPEmp ! EURODB);
     |FINSI;
|FPRC;
