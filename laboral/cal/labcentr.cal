|FICHEROS;
     labcentr #0;
     labmunic;
     nomfical;
     nomconca;
     labempre;
     nommutua;
     nomcnaec;
     silcon15,MANTE;
     nomcnahi;
     labtraba;
     nomcontr;
     nomw0021,MANTE;
     labemett,MANTE;
     sacecotc;
|FIN;

|VARIABLES;
      anterio0 = 0;
 anterio1 = 0;
 modo = 0;
 nume1 = 0;
 nume2 = 0;
 corta = 0;
 nume3 = 0;
 jg = 0;
 sitio = 0;
    sindical = "";
    mensaje1 = "    ATENCION!!! Solicite Libro de Matricula para este Centro ...";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    runnom = "";
     nPob = 0;
     fFecha = @;
     aFecha = "";
     aAny = "";
     swExiste = 0;
     nCalendario = 0;
     enEmpresa = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nModo = 0;
     &nOpcionPLB = 0;
     &aCodPos = "";
     aCNAE = "";
     aDesCNAE = "";
     FEstado = 0;
     swAgrario = 0;
     &eaVengoDe = "";
     nOpcion = 0;
     enBotonSS = 0;
     enBotonETT = 0;
     swBotonSS = 0;
     swBotonETT = 0;

     &eaEmail = "";
     &nArchi = 0;
     nCampo = 0;
     nRegimen = 0;
     nModoReal = 0;
     nLon = 0;
     aLon = "";
     aValor = "";
     nNume = 0;
     swF9 = 0;
|FIN;

|PROCESO EsAgrario;
     swAgrario = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE EsAgrario;
     #labtraba#1;
     247;
     #0#0, 00001, nRegimen;
     #0#0, 99999, nRegimen;
     ;
     NULL, EsAgrario;
|FIN;

|PROCESO agrarios; |TIPO 14;
     swAgrario = 0;
     nRegimen = 613;
     |BUCLE EsAgrario;
     nRegimen = 163;
     |BUCLE EsAgrario;
     |SI swAgrario = 1;
          |CAMPO_MODIFICA #0#24, 1, "S";
          |CAMPO_VISUAL #0#24, 1, "S";
          |ATRI 0;
          |PINTA 1755, "Exc:   ";
          |ATRI I;
          |PINTA #0#24;
          |ATRI I;
     |SINO;
          |CAMPO_MODIFICA #0#24, 1, "N";
          |CAMPO_VISUAL #0#24, 1, "N";
          |ATRI 0;
          |PINTA 1755, "       ";
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO sindical; |TIPO 0;
/*
    anterio0 = #0#0;
    anterio1 = #0Campo;
|SI #0Campo > 1;
        #0#1 = 1;
    |LEE 001#0=;
    |SI FSalida = 0;
            sindical = #0#12;
    |SINO;
            sindical = "NO EXISTE";
    |FINSI;
    |DDEFECTO #0;
    ||PDEFECTO #0, 0, 16;
        #0#0 = anterio0;
        #0#1 = anterio1;
        #0#12 = sindical;
    |MODULO runnom;
    |SI runnom = "labcentr";
        |PINDA #0#0;
    |FINSI;
|FINSI;
|HAZ mensaje;
*/

|FPRC;

|PROCESO mensaje;
    modo = FEntrada /100;
    modo = modo ! 0;
|MODULO alfa1;
|SI modo = 1; |Y alfa1 = "labcentr";
    |MENAV mensaje1;
|FINSI;
|FPRC;

|PROCESO ValidaCCC;
     alfa1 = #0Campo;
     |QBF alfa1;

     aLon = alfa1 % 0;
     nLon = aLon;
     |SI nLon = 11;
          alfa1 = alfa1 % 109;
     |FINSI;

     aValor = alfa1;

     alfa2 = alfa1 % 102; alfa3 = alfa1 % -107;
     alfa4 = alfa3 % 101;
     |SI alfa4 = "0";
          alfa3 = alfa3 % 206;
          alfa1 = alfa2 + alfa3;
     |FINSI;
     nume1 = alfa1;
     nume2 = nume1 / 97;
     |HAZ trunca3;
     |SI nume1 ] 0; |Y nume1 [ 99;
          alfa1 = aValor;
          |QBF alfa1;
          alfa2 = nume1;
          alfa2 = "00" + alfa2;
          alfa2 = alfa2 % -102;
          alfa1 = alfa1 + alfa2;
    |FINSI;

     alfa2 = #0#32;
     |QBF alfa2;

     |SI alfa2 ! alfa1;
          |MENAV "    ATENCION. Error en la validación. El CCC introducido es incorrecto";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CompCCC;
     aValor = #0Campo;
     aValor = aValor % 109;
     alfa1 = aValor;
     |QBF alfa1;
     alfa2 = alfa1 % 102; alfa3 = alfa1 % -107;
     alfa4 = alfa3 % 101;
     |SI alfa4 = "0";
          alfa3 = alfa3 % 206;
          alfa1 = alfa2 + alfa3;
     |FINSI;
     nume1 = alfa1;
     nume2 = nume1 / 97;
     |HAZ trunca3;
     |SI nume1 ] 0; |Y nume1 [ 99;
          alfa1 = aValor;
          |QBF alfa1;
          alfa2 = nume1;
          alfa2 = "00" + alfa2;
          alfa2 = alfa2 % -102;
          alfa1 = alfa1 + alfa2;
          #0Campo = alfa1;
          |PINTA #0Campo;
    |FINSI;
|FPRC;

|PROCESO trunca2;
     corta = 0;
     alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
     |PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
          sitio = (jg * 100) + 1;
          alfa2 = alfa1 % sitio;
          |SI alfa2 = ".";  corta = jg;  |FINSI;
     |SIGUE;
     |SI corta ! 0;
          sitio = 100 + corta - 1;
          alfa1 = alfa1 % sitio;
     |FINSI;
     nume3 = alfa1;
     nume1 = nume1 - (nume3 * 97);
|FPRC;

|PROCESO EmpUsuariaETT;
          nModo = (FEntrada / 100) ! 0;

          |PUSHV 05012380;
          |DDEFECTO #labemett;
          |ABRE #labemett;
          #labemett#0 = #0#0;
          #labemett#1 = #0#1;
          |LEE 101#labemett.=;
          FEstado = FSalida;

          |PINPA #0#labemett;
          |CAMPO_ANCHO #sacecotc#1, 1, 69;
          |PINDA #0#labemett;

          |SI FEstado ! 0;
               |ENDATOS #1#labemett;
          |SINO;
               |ENDATOS #2#labemett;
          |FINSI;

          |SI FSalida = 0;
               |SI FEstado ! 0;
                    |GRABA 020#labemett.n;
               |SINO;
                    |GRABA 020#labemett.a;
               |FINSI;
          |FINSI;
          |CIERRA #labemett;
          |POPV;
|FPRC;

|PROCESO control3; |TIPO 0;
     |SI FSalida = 9;
          aAlfa = #0Campo;
          |QBF aAlfa;
          aLon = aAlfa % 0;
          nLon = aLon;
          |SI nLon = 9; |O nLon = 11;
               |HAZ CompCCC;
          |FINSI;
     |FINSI;

     aAlfa = #0Campo;
     |QBF aAlfa;
     aLon = aAlfa % 0;
     nLon = aLon;
     |SI aAlfa ! ""; |Y nLon ! 11;
          |MENAV "    El CCC del centro debe tener 11 dígitos";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO trunca3;
    corta = 0;
    alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
|PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
        sitio = (jg * 100) + 1;
        alfa2 = alfa1 % sitio;
    |SI alfa2 = ".";  corta = jg;  |FINSI;
|SIGUE;
|SI corta ! 0;
        sitio = 100 + corta - 1;
        alfa1 = alfa1 % sitio;
|FINSI;
    nume3 = alfa1;
    nume1 = nume1 - (nume3 * 97);
|FPRC;


|PROCESO nomfical_cen;
     swExiste = 1;
     nCalendario = #nomfical#0;
     |ERROR10;
|FPRC;

|DEFBUCLE nomfical;
     #nomfical#1;
     ;
     000, aAny;
     999, aAny;
     ;
     NULL, nomfical_cen;
|FIN;

|PROCESO labmunic;
     nPob = #labmunic#1;
     fFecha = ~;
     aFecha = fFecha;
     aAny = aFecha % -104;
     |BUCLE nomfical;
     |SI swExiste = 1;
          #0#15 = nCalendario;
          |PINTA #0#15;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE labmunic;
     #labmunic#4;
     ;
     alfa3;
     alfa3;
     ;
     NULL, labmunic;
|FIN;

|PROCESO Calendario;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          |ABRE #nomfical;
          alfa1 = #0#7; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
          alfa2 = #0#8; alfa2 = "000" + alfa2; alfa2 = alfa2 % -103;
          alfa3 = alfa1 + alfa2;
          |BUCLE labmunic;
          |CIERRA #nomfical;
     |FINSI;
|FPRC;

|PROCESO Defectos; |TIPO 7;
     nModoReal = (FEntrada / 100) ! 0;
     modo = (FEntrada / 100) ! 0;

     |ABRE #nomconca;
     #nomconca#0 = #labempre#1;
     |LEE 000#nomconca.=;
     #0#19 = #nomconca#1;
     |PINTA #0#19;
     |CIERRA #nomconca;

     |SI modo = 1;
          |ABRE #labempre;
          #labempre#0 = #labcentr#0;
          |LEE 000#labempre.=;
          #0#16 = #labempre#1;          || convenio
          |PINTA #0#16;
          |CIERRA #labempre;
     |FINSI;
|FPRC;

|PROCESO PintaAct;
/*
     #0#18 = #labempre#12;
     |PINTA #0#18;
*/
|FPRC;

|PROCESO PintaMut;
     #0#14 = #nommutua#1;
     |PINTA #0#14;
|FPRC;

|PROCESO PintaCon;
     |ABRE #nomconca;
     #nomconca#0 = #0#16;
     |LEE 000#nomconca.=;
     #0#19 = #nomconca#1;
     |PINTA #0#19;
     |CIERRA #nomconca;
|FPRC;

|PROCESO CNAECen;
     alfa1 = #0Campo;
     |QBF alfa1;
     |SI alfa1 = "";
          alfa1 = "Sin actividad propia. El centro asume el CNAE de la empresa";
          #0#23 = alfa1;
          |PINTA #0#23;
          #0#17 = 0;
          ||PINTA #0#17;
     |SINO;
/*
          |SI alfa1 = "01";
               alfa1 = "    ATENCION: el codigo 01 no tiene asociada cotizacion. "
               alfa1 = alfa1 + "Debe elegir una de sus actividades asociadas";
               |MENAV alfa1;
               |ERROR;
          |SINO;
*/
               alfa1 = alfa1 % 102;
               #0#17 = alfa1;
               ||PINTA #0#17;
          ||FINSI;
     |FINSI;
|FPRC;

|PROCESO RellenaCNAECen; |TIPO 7;
     aCNAE = #0#22;
     |QBF aCNAE;
     aDesCNAE = #0#23;

     |ABRE #nomcnaec;
     alfa1 = #0#22;
     |QBF alfa1;
     #nomcnaec#0 = alfa1;
     |LEE 000#nomcnaec.=;
     |SI FSalida ! 0;
          |SI #0#17 > 0; |Y #0#17 < 100;
               alfa1 = #0#17;
               alfa1 = ("000" + alfa1) % -102;

               #nomcnaec#0 = alfa1;
               |LEE 000#nomcnaec.=;
               |SI FSalida = 0;
                    #0#22 = #nomcnaec#0;
                    #0#23 = #nomcnaec#1;
                    |PINTA #0#22;
                    |PINTA #0#23;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #nomcnaec;
|FPRC;

|PROCESO silcon15; |TIPO 3;
     || nModo = (FEntrada / 100) ! 0;
     |SI nModoReal = 1; |Y FSalida = 0;
          |GRABA 020#labcentr.a;

          |ABRE #silcon15;
          #silcon15#0 = #labcentr#0;
          #silcon15#1 = #labcentr#1;
          |LEE 101#silcon15.=;
          |SI FSalida ! 0; |Y nModoReal = 1;
               |PUSHV 09151670;
               |COLOR 7,1;
               |ATRI I;
               ||              2         3         4         5         6
               ||            89012345678901234567890123456789012345678901234567890
               |PINTA 1018, "               -   AVISO   -                 ";
               |PINTA 1118, " Si el centro que  se acaba  de dar de  alta ";
               |PINTA 1218, " cotiza por un rgimen distinto al principal ";
               |PINTA 1318, " de la empresa, ser  necesario darlo de alta ";
               |PINTA 1418, " para el  Sistema RED con su rgimen propio. ";
               |PAUSA;

               aAlfa = "    N¿Desea dar del alta el centro para el Sistema RED?";
               |ATRI 0;
               |CONFI aAlfa;
               |POPV;
               |SI FSalida = 0;
                    |SALVA_FICHA #labcentr;
                    |PUSHV 05012380;
                    |CLS;
                    |PINPA #0#silcon15;
                    |DDEFECTO #silcon15;
                    #silcon15#0 = #labcentr#0;
                    #silcon15#1 = #labcentr#1;
                    |PINDA #0#silcon15;
                    |ENDATOS #1#silcon15;
                    |SI FSalida = 0;
                         |GRABA 020#silcon15.n;
                    |FINSI;
                    |POPV;
               |FINSI;
          |FINSI;
          |LIBERA #silcon15;
          |CIERRA #silcon15;
          |REPON_FICHA #labcentr;
     |FINSI;
|FPRC;

|PROCESO ConsultaCal2; |TIPO 66;
     aAlfa1 = #0#7; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#8; |QBF aAlfa2; aAlfa2 = ("000" + aAlfa2) % -103;
     aCodPos = aAlfa1 + aAlfa2;
     nOpcionPLB = 0;
     |HAZ ConsCalenPLB;
     |SI nOpcionPLB ! 0;
          #0Campo = nOpcionPLB;
          |PINTA #0Campo;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO SSOnlineCen;
     aAlfa1 = #0#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#1; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;
     |SI nOpcion = 1;
          aAlfa = "labnct07;"+ "06" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 2;
          aAlfa = "labnct07;"+ "09" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 3;
          aAlfa = "labnct07;"+ "11" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 4;
          aAlfa = "labnct07;"+ "13" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 5;
          aAlfa = "labnct07;"+ "15" + aAlfa1 + aAlfa2;
     |FINSI;

     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO MenuSS;
     eaVengoDe = "labcentr";
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 4;
     aPopup3 = "1. Situación de la empresa";
     aPopup4 = "2. Certificado situación de cotización";
     aPopup5 = "3. Afiliados en el Cod. Cta. Coticación";
     aPopup6 = "4. Consulta de tabajadores en alta";
     aPopup7 = "5. Consulta de Convenios";
     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nOpcion = FSalida;
     |HAZ SSOnlineCen;
|FPRC;

|PROCESO BotonSS;
     |CONTROL_SIMPLE 0, "BOTON,Seguridad Social Online", 0764, 0779, ConectaSS;
     enBotonSS = FSalida;
     |ESTADO_CONTROL enBotonSS, "ENABLE";
     swBotonSS = 1;
|FPRC;

|PROCESO BotonETT;
     |ABRE #labempre;
     #labempre#0 = #labcentr#0;
     |LEE 000#labempre.=;
     |SI FSalida = 0; |Y #labempre#68 = "S";
          |CONTROL_SIMPLE 0, "BOTON,  Empresa Usuaria ETT  ", 0864, 0879, EmpUsuariaETT;
          enBotonETT = FSalida;
          |ESTADO_CONTROL enBotonETT, "ENABLE";
          swBotonETT = 1;
     |FINSI;
     |CIERRA #labempre;
|FPRC;

|PROCESO Botones; |TIPO 8;
     |MODULO aAlfa; |QBF aAlfa; |SI aAlfa ! "labcentr"; |ACABA; |FINSI;

     |SI swBotonSS = 0;
          |HAZ BotonSS;
     |FINSI;
     |SI swBotonETT = 0;
          |HAZ BotonETT;
     |FINSI;
|FPRC;

|PROCESO FinBotones; |TIPO 9;
     |MODULO aAlfa; |QBF aAlfa; |SI aAlfa ! "labcentr"; |ACABA; |FINSI;

     |SI swBotonSS = 1;
          |HAZ FinBotonSS;
     |FINSI;
     |SI swBotonETT = 1;
          |HAZ FinBotonETT;
     |FINSI;
|FPRC;

|PROCESO FinBotonSS;
     |FIN_CONTROL_WINDOWS enBotonSS;
     swBotonSS = 0;
     |PULSATECLA;
|FPRC;

|PROCESO FinBotonETT;
     |FIN_CONTROL_WINDOWS enBotonETT;
     swBotonETT = 0;
     |PULSATECLA;
|FPRC;

|PROCESO ETT; |TIPO 14;
     |MODULO aAlfa; |QBF aAlfa; |SI aAlfa ! "labcentr"; |ACABA; |FINSI;

     |ABRE #labempre;
     #labempre#0 = #labcentr#0;
     |LEE 000#labempre.=;
     |SI #labempre#68 = "S";
          |SI swBotonETT = 1;
               || no hagas nada, no hace falta que quites el boton se ya lo tenias
          |SINO;
               |HAZ BotonETT;
          |FINSI;
     |SINO;
          |HAZ FinBotonETT;
     |FINSI;
     |CIERRA #labempre;
|FPRC;

|PROCESO CompEmail_cen;
     eaEmail = #0Campo;
     |HAZ CompEmail_plb;
|FPRC;

|PROCESO CompDSArchi_cen;
     |HAZ MiraSiArchiva;
     |SI nArchi ! 1; |Y #0Campo = "S";
          aAlfa = "    Ha de tener instalada la aplicación DSARCHI y activar ";
          aAlfa = aAlfa + "la emisión de nóminas para poder usar esta opción";
          |MENAV aAlfa;

          #0Campo = "N";
          |PINTA #0Campo;
          |ACABA;
     |FINSI;
     |SI #0Campo = "S";
          nCampo = Campo - 1;
          aAlfa = #0nCampo;
          |QBF aAlfa;
          |SI aAlfa = "";
               aAlfa = "    ATENCION. La dirección de correo electrónico del ";
               aAlfa = aAlfa + "trabajador está en blanco. No se enviará la nómina.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo7C20Fcentr;  |TIPO 7;
     |PUSHV 0501 2380;

     #nomw0021#0 = #labcentr#20 % 104;
     #nomw0021#1 = #labcentr#20 % 504;
     #nomw0021#2 = #labcentr#20 % 1110;
     #nomw0021#3 = #labcentr#20 % 902;
     #nomw0021#4 = #labcentr#27;
     #nomw0021#5 = #labcentr#28;
     #nomw0021#6 = #labcentr#29;

     |PINPA #0#nomw0021;
     |PINDA #0#nomw0021;
     |ENDATOS #1#nomw0021;
     |SI FSalida = 0;
         #labcentr#20  = #nomw0021#0 + #nomw0021#1 + #nomw0021#3 + #nomw0021#2;
         #labcentr#27  = #nomw0021#4;
         #labcentr#28  = #nomw0021#5;
         #labcentr#29  = #nomw0021#6;
         |PINTA #labcentr#20;
     |FINSI;

     |POPV;

     |PINTA #labcentr#20;
     |PINTA #labcentr#27;
     |PINTA #labcentr#28;
     |PINTA #labcentr#29;
|FPRC;
