|FICHEROS;
     labacu11 #0;
     labacu12 #100,MANTE;
     labacu13 #101;
     labacu14,MANTE;
     labempre;
     labtraba;
     labcentr;
     nomir003;
     nomconca;

     ClientPI@ #5000;
|FIN;

|VARIABLES;
     &eaEmailPI = "";

     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aMensa = "";

     FEstado = 0;
     nume1 = 0;
     nCampoEmp = 0;
     nEmpre = 0;
     nCont = 0;
     nHastaCampo = 0;
     nEmpresa = 0;
     nMinGru = 0;
     nMaxGru = 0;
     swF11Emp = 0;
     npara1 = 0;
     nSw    = 0;

     nDEmpre  = 0;
     nHEmpre  = 0;

     nBoton   = 0;

     fecha = @;
     swIntegral = 0;

     &runnom = "labacu11";
     &aEDiscap = "";
     &nSwSisc = 0;
     nBoton1 = 0;
     nTrabajador = 0;

     nDesdeEmpresa = 0;
     nHastaEmpresa = 0;
     nDesdeAlumno = 0;
     nHastaAlumno = 0;
     aParametro = "";
     aTipoEmision = "";
     aEmpresa = "";
     aAlumno = "";
     &aTipoVia = "";
     &aVia = "";
     &aNum = "";
     &aEsc = "";
     &aPiso = "";
     &aPta = "";
     &aConvenio = "";

     &aCadena = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &aDomicilio = "";

     nCampo = 0;
     nAntEmpresa = 0;
|FIN;

|PROCESO mensaEmp; |TIPO 7;
     |SI #0#2 = 0; |Y #0#19 = 0; |Y Campo ! 2; |Y Campo ! 19;
          |ACABA;
     |FINSI;
     |MENSA "    < F11 > consulta de empresas";
|FPRC;

|PROCESO BuscaEmpresa;
     FEstado = FSalida;

     |SI FSalida = 13; |O swF11Emp = 1;
          |ABRE #labempre;
          |CONSULTA_CLAVE #1#labempre;
          |SI FSalida = 0;
               #0Campo = #labempre#0;
               |PINTA #0Campo;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #labempre;
          swF11Emp = 0;
     |FINSI;

     |DFICE aAlfa1;
     |DFICB aAlfa2;

|FPRC;

|PROCESO F11Emp; |TIPO 66;
     swF11Emp = 1;
     |HAZ BuscaEmpresa;
|FPRC;

|PROCESO CompEmpre;
     |SI #0Campo ! 0;
          |ABRE #labempre;
          #labempre#0 = #0Campo;
          |LEE 000#labempre.=;
          |SI FSalida ! 0;
               aAlfa1 = #0Campo; aAlfa1 = "00000" + aAlfa1; aAlfa1 = aAlfa1 % -105;
               aMensa = "    La Empresa " + aAlfa1 + " no existe";
               |MENAV aMensa;
               |ERROR;
          |FINSI;
          |CIERRA #labempre;
     |FINSI;
|FPRC;

|PROCESO seleccion1; |TIPO 0;
     |SI #0#2 = 0;
          aAlfa1 = "S";
          aAlfa2 = "N";
          |PARA nume1 = 2; |SI nume1 [ 18; |HACIENDO nume1 = nume1 + 1;
               #0nume1 = 0;
               |PINTA #0nume1;
          |SIGUE;
     |SINO;
          |SI nMinGru ! 0;
               || no deberia estar asi, pero si lo quito me iguala a cero
               || el desde empresa y no debe, tengo tiempo de ver por que
               |PARA nume1 = nMinGru; |SI nume1 [ nMaxGru; |HACIENDO nume1 = nume1 + 1;
                    #0nume1 = 0;
               |SIGUE;
               |PINDA #0#0;
          |FINSI;
          aAlfa1 = "N";
          aAlfa2 = "S";
     |FINSI;

     aAlfa = runnom;
     |QBF aAlfa;
     aAlfa = aAlfa % -104;
     |SI aAlfa = "reci";      || si no me ponia como no modificable el campo
          nHastaCampo = 3;    || a¤o y otros en emision de recibos
     |SINO;
          nHastaCampo = 21;
     |FINSI;

     |PARA npara1 = 0; |SI npara1 [ nHastaCampo; |HACIENDO npara1 = npara1 + 1;
          |CAMPO_MODIFICA #0npara1, 1, aAlfa1;
     |SIGUE;
     |PARA npara1 = 2; |SI npara1 [ 19; |HACIENDO npara1 = npara1 + 1;
          |CAMPO_MODIFICA #0npara1, 1, aAlfa2;
     |SIGUE;
     |PARA npara1 = nMinGru; |SI npara1 [ nMaxGru; |HACIENDO npara1 = npara1 + 1;
          |CAMPO_MODIFICA #0npara1, 1, aAlfa1;
     |SIGUE;
|FPRC;

|PROCESO grabatmp;
     #labtraba#0 = #labacu13#0;
     #labtraba#1 = #labacu13#1;
     |LEE 000#labtraba.=;

     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEFECTO #100;
     #100#0 = #labtraba#0;
     #100#1 = #labtraba#1;
     #100#2 = #labempre#2;
     #100#3 = #labtraba#2;
     |SI #labacu11#22 = "S";
          #100#4 = "*";
     |SINO;
          #100#4 = " ";
     |FINSI;
     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|DEFBUCLE labacu13;
     #labacu13#1;
     ;
     nDEmpre, 00001;
     nHEmpre, 99999;
     ;
     NULL, grabatmp;
|FIN;

|PROCESO lectura;
     nCont = 1;
     |SI #0#2 = 0;
          nDEmpre = #0#0; nHEmpre = #0#1;   |BUCLE labacu13;
     |SINO;
          |PARA nCampo = 2; |SI nCampo [ 16; |HACIENDO nCampo = nCampo + 1;
               nDEmpre = #0nCampo;
               nHEmpre = #0nCampo;
               |BUCLE labacu13;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO sel_min;
     #100#0 = 00001;
     #100#1 = 00001;
|FPRC;

|PROCESO sel_max;
     #100#0 = 99999;
     #100#1 = 99999;
|FPRC;

|PROCESO ficha;
     #labacu14#0 = #labacu13#0;
     |LEE 000#labacu14.=;

     aTipoVia = #101#20;
     aVia = #101#21;
     aNum = #101#22;
     aEsc = #101#23;
     aPiso = #101#24;
     aPta = #101#25;

     |QBF aTipoVia;
     |QBF aVia;
     |QBF aNum;
     |QBF aEsc;
     |QBF aPiso;
     |QBF aPta;

     aDomicilio = aTipoVia + ". " + aVia + ". ";
     |SI aNum ! ""; aDomicilio = aDomicilio + "Num. " + aNum + ". "; |FINSI;
     |SI aEsc ! ""; aDomicilio = aDomicilio + "Esc. " + aEsc + ". " ; |FINSI;
     |SI aPiso ! ""; aDomicilio = aDomicilio + "Piso " + aPiso + ". " ; |FINSI;
     |SI aPta ! ""; aDomicilio = aDomicilio + "Pta. " + aPta + ". " ; |FINSI;

     |PRINT;
|FPRC;

/*
|PROCESO ficha;
     #labacu14#0 = #labacu13#0;
     |LEE 000#labacu14.=;

     #labtraba#0 = #labacu13#0;
     #labtraba#1 = #labacu13#1;
     |LEE 000#labtraba.=;

     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;

     #ClientPI@#0 = #labtraba#7;
     |LEE 000#ClientPI@.=;

     fecha = ~;
     aAlfa = fecha % -104;

     #nomir003#0 = #labtraba#7;
     #nomir003#40 = aAlfa;
     #nomir003#41 = #labtraba#0;
     aEDiscap = "N";

     |LEE 000#nomir003.=;
     |SI FSalida ! 0;
          |LEE 000#nomir003.];
          |SI FSalida = 0;
               |LEE 000#nomir003.a;
               |SI #nomir003#0 = #labtraba#7; |Y #nomir003#41 = #labtraba#0; |Y FSalida = 0;
                    aEDiscap = #nomir003#6;
               |FINSI;
          |SINO;
               |LEE 000#nomir003.u;
               |SI FSalida = 0;
                    |SI #nomir003#0 = #labtraba#7; |Y #nomir003#41 = #labtraba#0;
                         aEDiscap = #nomir003#6;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          aEDiscap = #nomir003#6;
     |FINSI;

     aCadena = #labtraba#2;
     |HAZ SeparaNom_plb;

     aTipoVia = #5000#9;
     aVia = #5000#2;
     aNum = #5000#3;
     aEsc = #5000#16;
     aPiso = #5000#10;
     aPta = #5000#11;

     |QBF aTipoVia;
     |QBF aVia;
     |QBF aNum;
     |QBF aEsc;
     |QBF aPiso;
     |QBF aPta;

     aDomicilio = aTipoVia + ". " + aVia + ". ";
     |SI aNum ! ""; aDomicilio = aDomicilio + "Num. " + aNum + ". "; |FINSI;
     |SI aEsc ! ""; aDomicilio = aDomicilio + "Esc. " + aEsc + ". " ; |FINSI;
     |SI aPiso ! ""; aDomicilio = aDomicilio + "Piso " + aPiso + ". " ; |FINSI;
     |SI aPta ! ""; aDomicilio = aDomicilio + "Pta. " + aPta + ". " ; |FINSI;

     |PRINT;
|FPRC;
*/

|PROCESO labacu12_fic;
     #labacu13#0 = #labacu12#0;
     #labacu13#1 = #labacu12#1;
     |LEE 000#labacu13.=;
     |SI FSalida = 0;
          |HAZ ficha;
     |FINSI;
|FPRC;

|DEFBUCLE labacu12_fic;
     #labacu12#2;
     ;
     00001, 00001, "*";
     99999, 99999, "*";
     ;
     NULL, labacu12_fic;
|FIN;

|DEFBUCLE ficha;              || ficha de alumno
     #labacu13#1;
     ;
     nDesdeEmpresa, nDesdeAlumno;
     nHastaEmpresa, nHastaAlumno;
     ;
     NULL, ficha;
|FIN;

|PROCESO documento;
     #labempre#0 = #labacu14#0;
     |LEE 000#labempre.=;

     |PRINT;
|FPRC;

/*
|PROCESO documento;
     #labempre#0 = #labacu14#0;
     |LEE 000#labempre.=;
     #ClientPI@#0 = #labempre#10;
     |LEE 000#ClientPI@.=;

     aTipoVia = #5000#9;
     aVia = #5000#2;
     aNum = #5000#3;
     aEsc = #5000#16;
     aPiso = #5000#10;
     aPta = #5000#11;

     #nomconca#0 = #labempre#1;
     |LEE 000#nomconca.=;
     aConvenio = #nomconca#1;

     |PRINT;
|FPRC;
*/

|PROCESO labacu12_doc;
     |SI #labacu12#0 ! nAntEmpresa;
          |SI #labacu12#4 = "*";
               #labacu14#0 = #labacu12#0;
               |LEE 000#labacu14.=;
               |SI FSalida = 0;
                    |HAZ documento;
               |FINSI;
          |FINSI;
     |FINSI;

     nAntEmpresa = #labacu12#0;
|FPRC;

|DEFBUCLE labacu12_doc;
     #labacu12#1;
     ;
     00001, 00001;
     99999, 99999;
     ;
     NULL, labacu12_doc;
|FIN;

|DEFBUCLE documento;         || documento de adhesion
     #labacu14#1;
     ;
     nDesdeEmpresa;
     nHastaEmpresa;
     ;
     NULL, documento;
|FIN;

|PROCESO AbreFicheros;
     |ABRE #labempre;
     |ABRE #labcentr;
     |ABRE #labtraba;
     |ABRE #nomir003;
     |ABRE #nomconca;
     |ABRE #labacu13;
     |ABRE #labacu14;

     aAlfa = Usuario;
     |QBF aAlfa;
     aAlfa = "1" + aAlfa;
     |NOME_DAT #100 aAlfa;
     |DELINDEX #100;
     |ABRE #100;

     |DBASS aAlfa; |QBF aAlfa;
     aAlfa1 = aAlfa + "integral/def/dsam0103.mas";
     |CARGA_DEF aAlfa1, ClientPI@;
     |SI FSalida = 0;
          swIntegral = 1;
          |ABRE #ClientPI@;
     |FINSI;
|FPRC;

|PROCESO CierraFicheros;
     |CIERRA #ClientPI@;
     |DESCARGA_DEF #ClientPI@;

     |DELINDEX #100;
     |CIERRA #100;
     |CIERRA #labacu14;
     |CIERRA #labacu13;
     |CIERRA #nomir003;
     |CIERRA #nomconca;
     |CIERRA #labtraba;
     |CIERRA #labcentr;
     |CIERRA #labempre;
|FPRC;

|PROGRAMA;
     aParametro = PARAMETRO;
     |QBF aParametro;
     |SI aParametro ! "";
          |HAZ AbreFicheros;

          aTipoEmision = aParametro % 103;
          aEmpresa = aParametro % 405;
          aAlumno = aParametro % 905;

          nDesdeEmpresa = aEmpresa;
          nHastaEmpresa = aEmpresa;
          nDesdeAlumno = aAlumno;
          nHastaAlumno = aAlumno;

          |SI aTipoEmision = "DOC";
               Impresora = "CrystalReport";
               |IMPRE -1;
               |INFOR "labacu14";
               |BUCLE documento;
               |PIEINF;
               |FININF;
          |FINSI;

          |SI aTipoEmision = "FIC";
               Impresora = "CrystalReport";
               |IMPRE -1;
               |INFOR "labacu13";
               |BUCLE ficha;
               |PIEINF;
               |FININF;
          |FINSI;

          |HAZ CierraFicheros;
     |SINO;
          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;

          |ENDATOS #1#0;
          |SI FSalida = 0;
               |HAZ AbreFicheros;

               |HAZ lectura;
               |ENTLINEAL #1#100, -1, 4, 22, 1, sel_min, sel_max;

               aAlfa = "    S¿Desea continuar con la generación de los documentos?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    Impresora = "CrystalReport";
                    |IMPRE -1;
                    |INFOR "labacu14";

                    |BUCLE labacu12_doc;

                    |PIEINF;
                    |FININF;
                    |FINIMP;

                    Impresora = "CrystalReport";
                    |IMPRE -1;
                    |INFOR "labacu13";

                    |BUCLE labacu12_fic;

                    |PIEINF;
                    |FININF;
                    |FINIMP;
               |FINSI;
               |HAZ CierraFicheros;
          |FINSI;
     |FINSI;
|FPRO;
