|FICHEROS;
     nomrecss #0;
     labtraba #2;
     nomhicca #3;
     labbasec #4;
     labbasel #5;
|FIN;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     para1 = 0;
     para2 = 0;
     para3 = 0;
     para4 = 0;
     fech1 = @;
     fech2 = @;
     fech3 = @;
     fech4 = @;
     FEstado = 0;

     tope = 0;
     bisiesto = 0;
     fecha = @;
     linea = 0;
|FIN;
____________________________________/ CALCULOS PANTALLA
|PROCESO defecto; |TIPO 7;
     fech1 = ~;
     alfa1 = fech1;
     alfa1 = alfa1 % -102;
     #0Campo = alfa1;
     |PINTA #0Campo;
|FPRC;
____________________________________/ CALCULOS COMUNES
|PROCESO lee_traba;
     #0#09 = #3#0;    |PINTA #0#9;
     #0#10 = #3#1;    |PINTA #0#10;
     #0#11 = #3#2;    |PINTA #0#11;

     #2#0 = #3#0;
     #2#1 = #3#1;
     |LEE 000#2=;
     FEstado = FSalida;
|FPRC;

|PROCESO cabecera;
     |DDEFECTO #4;
     #4#0 = #2#0;
     #4#1 = #2#1;
     |LEE 000#4=;
     |SI FSalida ! 0;
          |GRABA 020#4n;
     |FINSI;
|FPRC;

|PROCESO fecha;
     alfa1 = tope;   alfa1 = ("00" + alfa1) % -102;
     alfa2 = #3#2;   alfa2 = ("00" + alfa2) % -102;
     alfa3 = #0#8;   alfa3 = ("00" + alfa3) % -102;
     |SI #0#8 > 80;
          alfa1 = alfa1 + "." + alfa2 + ".19" + alfa3;
     |SINO;
          alfa1 = alfa1 + "." + alfa2 + ".20" + alfa3;
     |FINSI;
     fecha = alfa1;
|FPRC;

|PROCESO topemes;
     ||bisiesto = #3#66 $ 4;
     bisiesto = #0#8 $ 4;
     |SI bisiesto = 0;   bisiesto = 1;  |SINO;    bisiesto = 0;  |FINSI;

     |SI #3#2 = 1;  tope = 31;     |FINSI;
     |SI #3#2 = 2;  tope = 28 + bisiesto;    |FINSI;
     |SI #3#2 = 3;  tope = 31;     |FINSI;
     |SI #3#2 = 4;  tope = 30;     |FINSI;
     |SI #3#2 = 5;  tope = 31;     |FINSI;
     |SI #3#2 = 6;  tope = 30;     |FINSI;
     |SI #3#2 = 7;  tope = 31;     |FINSI;
     |SI #3#2 = 8;  tope = 31;     |FINSI;
     |SI #3#2 = 9;  tope = 30;     |FINSI;
     |SI #3#2 =10;  tope = 31;     |FINSI;
     |SI #3#2 =11;  tope = 30;     |FINSI;
     |SI #3#2 =12;  tope = 31;     |FINSI;
|FPRC;

|PROCESO ultima;
     |DDEFECTO #5;
     #5#0 = #2#0;
     #5#1 = #2#1;
     #5#2 = 999;
     |LEE 000#5];
     |SI FSalida = 0;
          |LEE 000#5a;
     |SINO;
          |LEE 000#5u;
     |FINSI;
     |SI FSalida = 0;|Y #5#0 = #2#0;|Y #5#1 = #2#1;
          linea = #5#2;
     |SINO;
          linea = 0;
     |FINSI;
|FPRC;
____________________________________/ LECTURA DE ATRASOS
|PROCESO la_misma1;
     |SI fecha = #5#3;
          linea = #5#2;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO la_misma;
     linea = 0;
     |CIERRA #5;
     |BUCLELIN 2la_misma1#4;
     |ABRE #5;
|FPRC;

|PROCESO lineas_a;
     |HAZ topemes;
     |HAZ fecha;
     |HAZ la_misma;
     |SI linea = 0; |HAZ ultima;   linea = linea + 1;  |FINSI;
     |DDEFECTO #5;
     #5#0 = #2#0;         || empresa
     #5#1 = #2#1;         || trabajador
     #5#2 = linea;        || linea
     |LEE 101#5=;
     FEstado = FSalida;
     #5#3 = fecha;        || fecha
     #5#4 = #3#10;        || dias contrato
     #5#5 = #3#11;        || horas contrato
     alfa1 = #3#9;
     alfa1 = ("000" + alfa1) % -103;
     #5#6 = alfa1;                  || tipo de contrato
     |SI #0#13 = "S";|Y #0#7 ! "T";
          #5#7 = #3#39;                 || base comunes
          #5#8 = #3#40;                 || base profesionales
     |SINO;
          #5#7 = #5#7 + #3#39;          || base comunes
          #5#8 = #5#8 + #3#40;          || base profesionales
     |FINSI;
     #5#9 = "Atrasos incluidos.";   || observaciones
     |SI FEstado ! 0;    |GRABA 020#5n; |FINSI;
     |SI FEstado = 0;    |GRABA 020#5a; |FINSI;
     |LIBERA #5;
|FPRC;

|PROCESO atrasos1;
     |SI #3#39 ! 0;|O #3#40 ! 0;
          |HAZ lee_traba;
          |SI FEstado = 0;
               |HAZ cabecera;
               |HAZ lineas_a;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE atrasos;
     #3#1;
     ;
     #0#0, #0#2, #0#6, #0#4, 5;
     #0#1, #0#3, #0#6, #0#5, 20;
     ;
     NULL, atrasos1;
|FIN;
____________________________________/ LECTURA DE NO ATRASOS
|PROCESO lineas_m;
     |HAZ topemes;
     |HAZ fecha;
     |HAZ la_misma;
     |SI linea = 0; |HAZ ultima;   linea = linea + 1;  |FINSI;
     |DDEFECTO #5;
     #5#0 = #2#0;        || empresa
     #5#1 = #2#1;        || trabajador
     #5#2 = linea;       || linea
     |LEE 101#5=;
     FEstado = FSalida;
     #5#3 = fecha;       || fecha
     #5#4 = #3#10;       || dias contrato
     #5#5 = #3#11;       || horas contrato
     alfa1 = #3#9;
     alfa1 = ("000" + alfa1) % -103;
     #5#6 = alfa1;       || tipo de contrato
     |SI #0#13 = "S";
          #5#7 = #3#39;                 || base comunes
          #5#8 = #3#40;                 || base profesionales
     |SINO;
          #5#7 = #5#7 + #3#39;          || base comunes
          #5#8 = #5#8 + #3#40;          || base profesionales
     |FINSI;
     #5#9 = "";          || observaciones
     |SI FEstado ! 0;    |GRABA 020#5n; |FINSI;
     |SI FEstado = 0;    |GRABA 020#5a; |FINSI;
     |LIBERA #5;
|FPRC;

|PROCESO meses1;
     |SI #3#39 ! 0;|O #3#40 ! 0;
          |HAZ lee_traba;
          |SI FEstado = 0;
               |HAZ cabecera;
               |HAZ lineas_m;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE meses;
     #3#1;
     ;
     #0#0, #0#2, #0#6, #0#4, 0;
     #0#1, #0#3, #0#6, #0#5, 2;
     ;
     NULL, meses1;
|FIN;
____________________________________/ INICIALIZAR
|PROCESO labbasel_1;
     fech3 = #labbasel#3;
     |SI fech3 ] fech1;|Y fech3 [ fech2;
          |BORRA 020#labbasel.a;
     |FINSI;
     |LIBERA #labbasel;
|FPRC;

|PROCESO labbasel_0;
     alfa1 = "01";
     alfa2 = #0#4;   alfa2 = ("00" + alfa2) % -102;
     alfa3 = #0#8;   alfa3 = ("00" + alfa3) % -102;
     |SI #0#8 > 80;
          alfa1 = alfa1 + "." + alfa2 + ".19" + alfa3;
     |SINO;
          alfa1 = alfa1 + "." + alfa2 + ".20" + alfa3;
     |FINSI;
     fech1 = alfa1;

     bisiesto = #0#8 $ 4;
     |SI bisiesto = 0;   bisiesto = 1;  |SINO;    bisiesto = 0;  |FINSI;

     |SI #0#5 = 1;  tope = 31;     |FINSI;
     |SI #0#5 = 2;  tope = 28 + bisiesto;    |FINSI;
     |SI #0#5 = 3;  tope = 31;     |FINSI;
     |SI #0#5 = 4;  tope = 30;     |FINSI;
     |SI #0#5 = 5;  tope = 31;     |FINSI;
     |SI #0#5 = 6;  tope = 30;     |FINSI;
     |SI #0#5 = 7;  tope = 31;     |FINSI;
     |SI #0#5 = 8;  tope = 31;     |FINSI;
     |SI #0#5 = 9;  tope = 30;     |FINSI;
     |SI #0#5 =10;  tope = 31;     |FINSI;
     |SI #0#5 =11;  tope = 30;     |FINSI;
     |SI #0#5 =12;  tope = 31;     |FINSI;

     alfa1 = tope;   alfa1 = ("00" + alfa1) % -102;
     alfa2 = #0#5;   alfa2 = ("00" + alfa2) % -102;
     alfa3 = #0#8;   alfa3 = ("00" + alfa3) % -102;
     |SI #0#8 > 80;
          alfa1 = alfa1 + "." + alfa2 + ".19" + alfa3;
     |SINO;
          alfa1 = alfa1 + "." + alfa2 + ".20" + alfa3;
     |FINSI;
     fech2 = alfa1;
|FPRC;

|DEFBUCLE labbasel;
     #labbasel#1;
     ;
     #0#0, #0#2,   1;
     #0#1, #0#3, 999;
     be;
     labbasel_0, labbasel_1;
|FIN;
____________________________________/ PROCESO INICIAL
|PROCESO recupera; |TIPO 3;
     |SI #0#12 = "SI";
          |ABRE #2;
          |ABRE #4;
          |ABRE #5;

          |SI #0#13 = "S";
               |ATRI P;  |MENSA "    Inicializando ...";    |ATRI 0;
               |BUCLE labbasel;
          |FINSI;

          |SI #0#7 = "M";|O #0#7 = "T";
               |ATRI P;  |MENSA "    Recuperando meses ...";     |ATRI 0;
               |BUCLE meses;
          |FINSI;

          |SI #0#7 = "A";|O #0#7 = "T";
               |ATRI P;  |MENSA "    Recuperando atrasos ...";   |ATRI 0;
               |BUCLE atrasos;
          |FINSI;

          |CIERRA #2;
          |CIERRA #4;
          |CIERRA #5;
     |FINSI;
|FPRC;
