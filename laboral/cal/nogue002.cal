|FICHEROS;
    nogue002 #0;
    nogue005 #5;
    nomconpa;
    labtraba;
    nomhicca;
    referen@;
|FIN;

|VARIABLES;
     aAlfa = "";
     aCampos = "";
     aCampo = "";
     i = 0;


    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;

     nUltima = 0;
     nInforme = 0;
     nPosicion = 0;
     nLinea = 0;
     nCampo = 0;
     nLineaReal = 0;
     nLineaNueva = 0;
     &swModulo = 0;
|FIN;

|PROCESO rellena; |TIPO 0;
     |SI FSalida = 17; |HAZ ContTraba; |FINSI;
     |SI FSalida = 18; |HAZ ContHisto; |FINSI;

     alfa1 = #0Campo;
     |QBT alfa1;
     alfa2 = alfa1 % 101;

     |SI alfa1 = "1255";  |ACABA;  |FINSI;
     |SI alfa1 = "1256";  |ACABA;  |FINSI;

     |SI alfa1 > 1000;
          |SI alfa2 = 1;
               aAlfa = "|NC";
               aCampos = "1" + #labtraba#aAlfa#;


               |SI #0Campo > aCampos;
                    |MENAV "0000El campo no existe...";
                    |ERROR;
               |FINSI;
          |SINO;
               aAlfa = "|NC";
               aCampos = "2" + #nomhicca#aAlfa#;
               |SI #0Campo ] aCampos;
                    |MENAV "0000El campo no existe...";
                    |ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          |SI alfa2 ! "M";
               |SI alfa2 ! "A";
                    nume1 = alfa1;
                    |SI nume1 > 39;
                         |MENAV "    ATENCION!!! Rango: del 0 al 39 ...";
                         |ERROR;
                    |SINO;
                         alfa1 = "00" + alfa1;
                         #0Campo = alfa1 % -102;
                         #0Campo = " " + #0Campo;
                         |PINTA #0Campo;
                    |FINSI;
               |SINO;
                    alfa2 = alfa1 % -102;
                    nume1 = alfa2;
                    |SI nume1 > 41;
                         |MENAV "    ATENCION!!! Rango: del A01 al A41 ...";
                         |ERROR;
                    |FINSI;
               |FINSI;
          |SINO;
               alfa2 = alfa1 % -102;
               nume1 = alfa2;
               |SI nume1 ] #0#1;
                    |MENAV "    ATENCION!!! Campo sin definir ...";
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AyudaF11; |TIPO 7;
     |PUSHV 0563 0980;
     |ATRI R;
     |PINTA 0664, "F9  - TRABAJADOR ";
     |PINTA 0764, "F10 - NOMINAS    ";
     |PINTA 0864, "F11 - CONCEPTOS  ";
     |ATRI 0;

     |MENSA "0000Referencia planilla nomina; [M??]->campo ya definido; [????]->campo fichero;";
|FPRC;

|PROCESO Restaura;
     |POPV;
|FPRC;

|PROCESO cuenta;
     nUltima = #0#1;
|FPRC;

|DEFBUCLE cuenta;
     #0#1;
     ;
     nInforme, 01;
     nInforme, 99;
     ;
     NULL, cuenta;
|FIN;

|PROCESO InsertaLinea; |TIPO 11;
     |SI FSalida ! 13;
          |ACABA;
     |FINSI;

     nPosicion = #0#1;
     nInforme = #0#0;
     |BUCLE cuenta;

     |PARA nLinea = nUltima; |SI nLinea ] nPosicion; |HACIENDO nLinea = nLinea - 1;
          #0#0 = nInforme;
          #0#1 = nLinea;
          |LEE 101#0=;
          |SI FSalida = 0;
               #0#0 = nInforme;
               #0#1 = nLinea + 1;
               |GRABA 020#0n;
               |LIBERA #0;

               |SI nLinea ! nPosicion;
                    #0#0 = nInforme;
                    #0#1 = nLinea;
                    |LEE 101#0=;
                    |SI FSalida = 0;
                         |BORRA 020#0a;
                         |LIBERA #0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;

     #0#0 = nInforme;
     #0#1 = nPosicion;
     |LEE 101#0=;
     |SI FSalida = 0;
          #0#2 = "";
          |PARA nCampo = 3; |SI nCampo [ 14; |HACIENDO nCampo = nCampo + 1;
               #0nCampo = " 00";
          |SIGUE;
          |PARA nCampo = 15; |SI nCampo [ 26; |HACIENDO nCampo = nCampo + 1;
               #0nCampo = "+";
          |SIGUE;
          |GRABA 020#0a;
          |LIBERA #0;
          |LEE 000#0=;
     |FINSI;
     |PONCONTROL 23, "si"; |PTEC 815;
     |ERROR;
|FPRC;

|PROCESO ContTraba;
     aAlfa = Usuario;
     |NOME_DAT #5 aAlfa; |DELINDEX #5; |ABRE #5;

     aAlfa = "|NC";
     aCampos = #labtraba#aAlfa#;
     |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
          aCampo = ("000" + i) % -103;
          aAlfa = "|C" + aCampo + "NOMBRE";
          aAlfa = #labtraba#aAlfa#;

          #5#0 = "1" + aCampo;
          #5#1 = aAlfa;
          |GRABA 020#5n;
     |SIGUE;
     aCampo = ("000" + i) % -103; #5#0 = "1" + aCampo; #5#1 = "N§ TRABAJADOR SAP";
     |GRABA 020#5n;
     i = i + 1; aCampo = ("000" + i) % -103; #5#0 = "1" + aCampo; #5#1 = "DESCRIPCION AREA";
     |GRABA 020#5n;
     i = i + 1; aCampo = ("000" + i) % -103; #5#0 = "1" + aCampo; #5#1 = "DESCRIPCION SECCION";
     |GRABA 020#5n;

     |LEE 000#5p;
     |CONSULTA_CLAVE #1#5;
     |SI FSalida = 0;
          #0Campo = #5#0; |PINTA #0Campo;
     |SINO;
          |ERROR;
     |FINSI;

     |CIERRA #5; |DELINDEX #5;
|FPRC;

|PROCESO ContHisto;
     aAlfa = Usuario;
     |NOME_DAT #5 aAlfa; |DELINDEX #5; |ABRE #5;

     aAlfa = "|NC";
     aCampos = #nomhicca#aAlfa#;
     |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
          aCampo = ("000" + i) % -103;
          aAlfa = "|C" + aCampo + "NOMBRE";
          aAlfa = #nomhicca#aAlfa#;

          #5#0 = "2" + aCampo;
          #5#1 = aAlfa;
          |GRABA 020#5n;
     |SIGUE;

     |LEE 000#5p;
     |CONSULTA_CLAVE #1#5;
     |SI FSalida = 0;
          #0Campo = #5#0; |PINTA #0Campo;
     |SINO;
          |ERROR;
     |FINSI;

     |CIERRA #5; |DELINDEX #5;
|FPRC;

|PROCESO T66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "nomconpa";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario;
          |NOME_DAT #referen@#aAlfa#; |DELINDEX #referen@;

          |ABRE #nomconpa;
          |ABRE #referen@;
          |LEE 000#nomconpa.p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SALVA_DATOS #nomconpa;
               |REPON_DATOS #referen@;
               |GRABA 020#referen@.n;
               |LEE 000#nomconpa.s;
          |SIGUE;
          #referen@#0 = "A38";
          #referen@#1 = "Días a¤o trabajados";
          |GRABA 020#referen@.n;

          #referen@#0 = #0Campo;
          |LEE 000#referen@.];
          |CONSULTA_CLAVE #1#referen@;
          |SI FSalida = 0;
               #0Campo = #referen@#0; |PINTA #0Campo;
          |SINO;
               |ERROR;
          |FINSI;

          |CIERRA #referen@;
          |CIERRA #nomconpa;
          |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PintaCuenta; |TIPO 7;
     |HAZ BuscaModulo;
     |SI swModulo = 3430; |O swModulo = 1;
          |PINTA 2241, " Signo....:       Cuenta:              ";

          |CAMPO_MODIFICA #0#29, 1, "S";
          |CAMPO_VISUAL #0#29, 1, "S";
          |PINTA #0#29;
          |CAMPO_MODIFICA #0#30, 1, "S";
          |CAMPO_VISUAL #0#30, 1, "S";
          |PINTA #0#30;
     |FINSI;
|FPRC;
