|FICHEROS;
     nomcocop #0;   || Este mismo def
     nomconre #1;   || Registro de copias realizadas

     nomconhi #2;   || el historico de importes por Categoria
     nomcatli;
     nomfichi;      || el historico de finiquitos (cabecera)
     nomfilhi;      || el historico de finiquitos (lineas)
     nomfinca;
     nomfinli;
     nomcaxhi;      || el historico de complementos y antiguedad por a¤os
     nomconax;
     nomanthi;      || el historico de antiguedades por categorias
     nomantca;
|FIN;

|VARIABLES;
     swRegraba = 0;
     aAlfa = "";
     nCampo = 0;
     swHeEntrado = 0;
|FIN;

|PROCESO graba_nomanthi;
     swHeEntrado = 1;
     #nomanthi#0 = #nomantca#0;
     #nomanthi#1 = #nomantca#1;
     #nomanthi#64 = #nomcocop#1;
     |LEE 101#nomanthi.=;
     |PARA nCampo = 2; |SI nCampo [ 63; |HACIENDO nCampo = nCampo + 1;
          #nomanthi#nCampo# = #nomantca#nCampo#;
     |SIGUE;
     |SI FSalida = 0;
          |GRABA 020#nomanthi.a;
     |SINO;
          |GRABA 020#nomanthi.n;
     |FINSI;
     |LIBERA #nomanthi;
|FPRC;

|DEFBUCLE nomantca;
     #nomantca#1;
     ;
     #nomcocop#0, 000;
     #nomcocop#0, 999;
     ;
     NULL, graba_nomanthi;
|FIN;

|PROCESO graba_nomcaxhi;
     swHeEntrado = 1;
     #nomcaxhi#0 = #nomconax#0;
     #nomcaxhi#235 = #nomcocop#1;
     |LEE 101#nomcaxhi.=;
     |PARA nCampo = 1; |SI nCampo [ 234; |HACIENDO nCampo = nCampo + 1;
          #nomcaxhi#nCampo# = #nomconax#nCampo#;
     |SIGUE;
     |SI FSalida = 0;
          |GRABA 020#nomcaxhi.a;
     |SINO;
          |GRABA 020#nomcaxhi.n;
     |FINSI;
     |LIBERA #nomcaxhi;
|FPRC;

|DEFBUCLE nomconax;
     #nomconax#1;
     ;
     #nomcocop#0;
     #nomcocop#0;
     ;
     NULL, graba_nomcaxhi;
|FIN;

|PROCESO graba_nomfilhi;
     swHeEntrado = 1;
     #nomfilhi#0 = #nomfinli#0;
     #nomfilhi#1 = #nomfinli#1;
     #nomfilhi#2 = #nomfinli#2;
     #nomfilhi#15 = #nomcocop#1;
     |LEE 101#nomfilhi.=;
     |PARA nCampo = 3; |SI nCampo [ 14; |HACIENDO nCampo = nCampo + 1;
          #nomfilhi#nCampo# = #nomfinli#nCampo#;
     |SIGUE;
     |SI FSalida = 0;
          |GRABA 020#nomfilhi.a;
     |SINO;
          |GRABA 020#nomfilhi.n;
     |FINSI;
     |LIBERA #nomfilhi;
|FPRC;

|DEFBUCLE nomfinli;
     #nomfinli#1;
     ;
     #nomcocop#0, 000, 01;
     #nomcocop#0, 999, 99;
     ;
     NULL, graba_nomfilhi;
|FIN;

|PROCESO graba_nomfichi;
     swHeEntrado = 1;
     #nomfichi#0 = #nomfinca#0;
     #nomfichi#1 = #nomfinca#1;
     #nomfichi#4 = #nomcocop#1;
     |LEE 101#nomfichi.=;
     |PARA nCampo = 2; |SI nCampo [ 3; |HACIENDO nCampo = nCampo + 1;
          #nomfichi#nCampo# = #nomfinca#nCampo#;
     |SIGUE;
     |SI FSalida = 0;
          |GRABA 020#nomfichi.a;
     |SINO;
          |GRABA 020#nomfichi.n;
     |FINSI;
     |LIBERA #nomfichi;
|FPRC;

|DEFBUCLE nomfinca;
     #nomfinca#1;
     ;
     #nomcocop#0, 000;
     #nomcocop#0, 999;
     ;
     NULL, graba_nomfichi;
|FIN;

|PROCESO graba_nomconhi;
     swHeEntrado = 1;
     #nomconhi#0 = #nomcatli#0;
     #nomconhi#1 = #nomcatli#1;
     #nomconhi#2 = #nomcatli#2;
     #nomconhi#11 = #nomcocop#1;
     |LEE 101#nomconhi.=;
     |PARA nCampo = 3; |SI nCampo [ 6; |HACIENDO nCampo = nCampo + 1;
          #nomconhi#nCampo# = #nomcatli#nCampo#;
     |SIGUE;
     |SI FSalida = 0;
          |GRABA 020#nomconhi.a;
     |SINO;
          |GRABA 020#nomconhi.n;
     |FINSI;
     |LIBERA #nomconhi;
|FPRC;

|DEFBUCLE nomcatli;
     #nomcatli#1;
     ;
     #nomcocop#0, 001, 001;
     #nomcocop#0, 999, 999;
     ;
     NULL, graba_nomconhi;
|FIN;

|PROCESO LasCopias;
     swHeEntrado = 0;
     |SI swRegraba ! 1;
          |ACABA;
     |FINSI;

     swHeEntrado = 0;

     |BUCLE nomcatli;
     |BUCLE nomfinca;
     |BUCLE nomfinli;
     |BUCLE nomconax;
     |BUCLE nomantca;

     |SI swHeEntrado ! 1;
          |LEE 101#nomconre.=;
          |BORRA 020#nomconre.a;
          aAlfa = "    ATENCION: No se han encontrado datos para realizar la copia.";
          |MENAV aAlfa;
     |SINO;
          aAlfa = "    Se ha registrado la copia con exito";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO nomconre;
     swRegraba = 1;

     #nomconre#0 =  #nomcocop#0;
     #nomconre#1 =  #nomcocop#1;
     |LEE 101#nomconre.=;
     #nomconre#2 =  #nomcocop#2;
     |SI FSalida = 0;
          aAlfa = "    NATENCION: Ya existe una copia del convenio guardada ";
          aAlfa = aAlfa + "con esta fecha. Desea sobreescribir?"
          |CONFI aAlfa;
          |SI FSalida = 0;
               |GRABA 020#nomconre.a;
          |SINO;
               swRegraba = 0;
          |FINSI;
     |SINO;
          |GRABA 020#nomconre.n;
     |FINSI;
|FPRC;

|PROCESO Tipo3cc; |TIPO 3;
     |SI FSalida = 0;
          |ABRE #nomconre;
          |ABRE #nomconhi;   || el hisrotico de importes por categoria
          |ABRE #nomfichi;   || el historico de finiquitos (cabecera)
          |ABRE #nomfilhi;   || el historico de finiquitos (lineas)
          |ABRE #nomcaxhi;   || el historico de complementos y antiguedad por a¤os
          |ABRE #nomanthi;   || el historico de antiguedades por categorias

          |HAZ nomconre;
          |HAZ LasCopias;

          |CIERRA #nomanthi;
          |CIERRA #nomcaxhi;
          |CIERRA #nomfilhi;
          |CIERRA #nomfichi;
          |CIERRA #nomconhi;
          |CIERRA #nomconre;
     |FINSI;
|FPRC;
