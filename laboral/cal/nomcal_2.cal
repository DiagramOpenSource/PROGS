|FICHEROS;
    nomcalcu #0;
    labempre #1;       || empresas                     ATENCION: ESTOY CERCA
    labtraba #2;       || trabajadores                 DE LAS 8000 LINEAS
    nomcatca #3;       || aux. categorias cabs.        MUCHO CUIDADO !!!!!!!
    nomcatli #4;       || aux. categorias lins.
    nomtraca #5;       || aux. trabajadores cabs.
    nomtrali #6;       || aux. trabajadores lins.
    nomvarca #7;       || variaciones trabajadores/mes cabs.
    nomvarli #8;       || variaciones trabajadores/mes lins.
    nomconca #9;       || convenios cabs.
    nomconli #10;      || convenios lins.
    nomcalca #11;      || calculos cabs.
    nomcalli #12;      || calculos lins.
    nomantca #13;      || antiguedades/categorias
    nomconax #14;      || auxiliar convenios
    nomconst #15;      || constantes
    nombonif #16;      || bonificaciones
    nomepigr #17;      || epigrafes
    nomtrcal #20;      || calendario laboral
    nomcontr #32;      || control aplicacion
    nomantpl #33;      || ptas. base antiguedad convenio/categoria
    nomcones #35;      || cotizacion especial R.D.-Ley 18/93
    nomnotay #36;      || centros notarias/ayuntamientos
    nomconat #37;      || definic.ctos.autom.
    nomafema #38;      || afectados por R.D. 1426/97
    nomhicca #39;      || historico cabs.
    nomvart3 #40;      || variaciones t.parcial (ctos.irregulares)
    nomimpre;          || registro tipos IRPF en pagas extras Lins.
    nomlogca;          || log incidencias calculo de la nomina Cabs.
    nomlogli;          || log incidencias calculo de la nomina Lins.
    nomincid;          || fichero de incidencias
    labmunic;
    nomfical;
    nomfinli;
    nomabsli;
    nompluri;
    &copiadef@ #500;      || para hacer CARGA_DEF, que ya no caben mas ficheros
    nomcot2x;
    nomcontq;
|FIN;

|VARIABLES;
    FEstado = 0;
    act = 0;
    actc = 0;
    acu_auto = 0;
    acum1_200 = 0;
    &acum2_200 = 0;
    &acum_10 = 0;
    &acum_11 = 0;
    acum_12 = 0;
    acum_13 = 0;
    acum_30 = 0; acum_301 = 0; acum_302 = 0; acum_303 = 0;
    acum_31 = 0; acum_311 = 0; acum_312 = 0; acum_313 = 0;
    &acum_40 = 0; &acum_401 = 0; &acum_402 = 0; &acum_403 = 0; &acum_41 = 0;
    &acum_50 = 0; &acum_51 = 0; &acum_52 = 0; &acum_53 = 0; &acum_54 = 0;
    &acum_60 = 0;
    acum_90 = 0; &acum_99 = 0; &acum_991 = 0; &acum_992 = 0; &acum_993 = 0;
    acum_smi0 = 0; acum_smi1 = 0; acum_smi2 = 0; acum_smi3 = 0;
    acum_smi4 = 0; acum_smi5 = 0; acum_smi6 = 0; acum_smi7 = 0;
    acumb = 0;
    ajus_1 = 0;
    ajus_2 = 0;
    ajus_p = 0;
    alfa1 = ""; alfa2 = ""; alfa3 = ""; alfa4 = ""; alfa5 = "";
    alfa6 = ""; alfa7 = ""; alfa8 = ""; alfa9 = ""; alfa10 = "";
    anti_41 = 0;
    &antici1 = 0; &antici2 = 0; &antici3 = 0;
    &antici4 = 0; || (este es el Anticipos 3)
    anticom = 0; &anticom2 = 0; &anticom3 = 0;
    any = 0;           || calculo 'desglosa'
    anyo1 = 0;
    anyo2 = 0;
    anyalt = 0;
    &anynum = 0;
    &anyos = 0;
    anyven = 0;
    auto1 = 0; auto2 = 0; auto3 = 0;
    &aux_conv = 0;
    &base_1 = 0;
    &base_2 = 0;
    &base_3 = 0;
    base_4 = 0;
    &base_5 = 0;           || base IT de contingencias PROFESIONALES
    &base_5cc = 0;         || base IT de contingencias COMUNES
    &base_6 = 0;
    &base_7 = 0;
    &base_8 = 0;
    &base_9 = 0;
    zbase_9 = 0;
    &base_10 = 0; || riesgo
    &base_11 = 0; || control IT Seg. Soc.
    &base_A = 0;
    &zbase_A = 0;
    base_B = 0;
    &zbase_B = 0; &base_AB = 0; &zbase_AB = 0;
    &base_C = 0; &zbase_C = 0; &base_D = 0;
    &base_E = 0;
    &base_F = 0;
    &zbase_F = 0;
    &base_G = 0;
    base_M = 0;
    zbase_M = 0;
    base_N = 0;
    zbase_N = 0;
    base_MN = 0;
    zbase_MN = 0;
    bases = 0;
    &bisiesto = 0;
    &bon_0 = 0; &zbon_0 = 0;
    &bon_1 = 0;          || exportable al 'nomcalfi'
    &bon_2 = 0;          || exportable al 'nomcalfi'
    zbon_1 = 0; zbon_2 = 0;
    &bon_3 = 0; &zbon_3 = 0;
    bon_5 = 0;  zbon_5 = 0;
    bon_7 = 0;
    bruto_aju = 0;
    &bruto_pag = 0;
    &bruto_rec = 0;
    cabecera = 0;      || switch para grabar o no cabeceras de calculos
    cale_val = 0;
    &camdes = 0;
    &camhas = 0;
    campo = 0;
    &campomax = 0;
    &campomin = 0;
    &campos = 0;
    &coba_1 = 0; &cobb_1 = 0; &coba_2 = 0; &cobb_2 = 0;
    &coba_3 = 0; &cobb_3 = 0; &coba_4 = 0; &cobb_4 = 0;
    &coba_5 = 0; &cobb_5 = 0;
    concep0 = 0;
    concep1 = 0;
    concep2 = 0;
    &concepto = 0;      || variable de trabajo del campo 'concepto'
    conser1 = 0;
    conser2 = 0;
    &convenio = 0;      || switch de error de existencia o no de linea convenio
    &coti_0 = 0;
    &coti_1 = 0;
    coti_2 = 0;
    dabse_k = 0;
    dabse_1 = 0;
    &dabse_2 = 0;
    dabse_3 = 0;
    dperm_k = 0; dperm_1 = 0; &dperm_2 = 0;
    dacci_k = 0;
    &dacci_0 = 0;
    &dacci_X0 = 0;
    &dacci_1 = 0;
    &dacci_2 = 0;
    &dacci_20 = 0; &dacci_21 = 0; &dacci_22 = 0; &dacci_23 = 0; &dacci_24 = 0;
    &dacci_3 = 0;
    &dacci_Y = 0; &dacci_y = 0; &dacci_Z = 0; &dacci_z = 0;
     aFabre = "";
     &dacci_z0 = 0;   || simula linea 0 accidentes
     &dacci_Z0 = 0;    || 1ra. linea accidentes
     &dacci_Y0 = 0;    || 2da. linea accidentes
     &dacci_y0 = 0;   || simula linea 3 accidentes
     &dacci_z0_H = 0;   || simula linea 0 accidentes
     &dacci_Z0_H = 0;    || 1ra. linea accidentes
     &dacci_Y0_H = 0;    || 2da. linea accidentes
     &dacci_y0_H = 0;   || simula linea 3 accidentes
     &dacci_ZC = 0;     &dacci_ZC_H = 0;    || 1da. linea accidente
     &dacci_YC = 0;     &dacci_YC_H = 0;    || 2da. linea accidente
     &dacci_ZC0 = 0;    || 1da. linea accidente
     &dacci_YC0 = 0;    || 2da. linea accidente

    dacci_t = 0;
    &dacum_30 = 0;
    &dacum_31 = 0;
    &dacum_999 = 0;
    dacum_vac = 0;
    dalta_k = 0;
    &dalta_1 = 0; dalta_2 = 0;
    &dalta_3 = 0;
    &danti_0 = 0; &danti_1 = 0;
    dbaja_k = 0;
    dbaja_1 = 0; dbaja_2 = 0;
    &dbaja_3 = 0;
    &dboni_1 = 0;
    &dboni_2 = 0;
    &dcobr_0 = 0;
    dcobr_A = 0;
    dcofi_1 = 0; dcofi_1A = 0;
    &dcofi_2 = 0; dcofi_3 = 0; dcofi_4 = 0; dcofi_5 = 0;
    dcofi_6 = 0; dcofi_7 = 0;
    dcofi_201 = 0; dcofi_202 = 0; dcofi_203 = 0; dcofi_204 = 0;
    dcofi_205 = 0; dcofi_206 = 0; dcofi_207 = 0; dcofi_208 = 0;
    dcofi_209 = 0;
    &dcofi_999 = 0;
    &dcofi_999A = 0;
    &dcoti_0 = 0;        || exportable al 'nomcalfi'
    ddese_k = 0;
    ddese_1 = 0;
    &ddese_2 = 0;
    ddese_reales = 0;
    de1 = 0;
    de2 = 0;
    dedia = 0;
    dedia1 = 0;
    &deducss = 0;
    denfe_k = 0;
    &denfe_0 = 0;
    &denfe_1 = 0;
    &denfe_2 = 0;
    &denfe_20 = 0;
    &denfe_21 = 0;
    &denfe_22 = 0;
    &denfe_23 = 0;
    &denfe_24 = 0;
    &denfe_3 = 0;
    &denfe_4 = 0;
    &denfe_A = 0;
    &denfe_B = 0;
    &denfe_C = 0;
    &denfe_D = 0;
    &denfe_A0 = 0;
    &denfe_B0 = 0;
    &denfe_C0 = 0;
    &denfe_D0 = 0;
    &denfe_V = 0;
    &denfe_W = 0;
    &denfe_X = 0;
    &denfe_Y = 0;
    &denfe_Z = 0;
    &denfe_V0 = 0;
    &denfe_W0 = 0;
    &denfe_X0 = 0;
    &denfe_Y0 = 0;
    &denfe_Z0 = 0;
    &denfe_t = 0;
    des = 0;
    des1 = 0;
    des2 = 0;
    desc = 0;
    desde = 0;
    desde1 = 0;
    dhuel_k = 0;
    dhuel_1 = 0;
    &dhuel_2 = 0;
    &dhuel_3 = 0;
    dia = 0;
    dia_k = 0;
    dia_1 = 0;
    &dia_2 = 0;
    &dia_3 = 0;
    &dia_4 = 0;
    &diaalt = 0;
    diafest = 0;
    dialabo = 0;
    dias_dto = 0;
    &dias_v = 0;
    diasp = 0;
    diast = 0;
    &diastc2 = 0;
    diaven = 0;
    difer1 = 0;
    difer_a = 0;
    difer_m = 0;
    &reten_p = 0;
    difere = 0;
    diff = 0;
    &dilt = 0;
    &divide = 0;
    &dlabo_0 = 0;
    dlabi_0 = 0;
    &dlabo_k = 0;
    dlabi_k = 0;
    dmate_k = 0;
    &dmate_0 = 0;
    dmate_1 = 0;
    &dmate_2 = 0;
    &dries_2 = 0;
    &dcont_2 = 0;
    dmate_3 = 0;
    dmate_t = 0;
    dmate_Z = 0;
    dmate_Y = 0;
    &dpate_2 = 0;
    &doce = 0;
    &dto_con = 0;
    &dto_des = 0;
    &dto_dfp = 0;
    &dto_ho1 = 0;
    &dto_ho2 = 0;
    dto_tot = 0;
    dtot = 0;
    duni1_101 = 0;
    &duni1_102 = 0;
    duni1_103 = 0;
    duni1_200 = 0;
    &duni1_902 = 0;
    &duni1_903 = 0;
    &duni1_999 = 0;
    duni2_101 = 0;
    duni2_102 = 0;
    duni2_103 = 0;
    duni2_200 = 0;
    &duni2_902 = 0;
    duni2_903 = 0;
    &duni2_998 = 0;
    &duni2_999 = 0;
    duni3_200 = 0;
     &swcalindem = 0;
     &swcalvacac = 0;
    dtodo_3 = 0;
    dvaca_1 = 0;
    dvaca_2 = 0;
    dvaca_k = 0;
    &dvalo_101 = 0;
    dvalo_102 = 0;
    dvalo_103 = 0;
    dvalo_200 = 0;
    dvalo_201 = 0;
    dvalo_202 = 0;
    dvalo_203 = 0;
    dvalo_204 = 0;
    dvalo_205 = 0;
    dvalo_206 = 0;
    dvalo_207 = 0;
    dvalo_208 = 0;
    dvalo_209 = 0;
    &dvalo_902 = 0;
    dvalo_903 = 0;
    &dvalo_999 = 0;
    dvalo_pag = 0;
    &dvalo_pro = 0;
    elotro = 0;
    &es_aprendi = 0;
    &es_irregul = 0;
    &es_parcial = 0;
    &epig_ilt = 0;
    &epig_ims = 0;
    &especie = 0;
    estevale = 0;
    &exce_smi = 0;
    &fanti_d = 0;
    &fanti_a = 0;
    &fanti_m = 0;
    fecalf = "";       || calculo 'desglosa'
    &fecbaj = "";       || calculo 'baja'
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fecsis = @;        || variable fecha de trabajo
    fecsys = @;        || variable fecha de trabajo
    &fijo_1 = 0;
    fvenci = "";       || fecha vencimiento antiguedad
    ganti_a = 0;
    ganti_m = 0;
    &graba04 = 0;
    &graba05 = "";
    &graba06 = 0;
    &graba07 = 0;
    &graba08 = "";
    &graba09 = 0;
    &graba10 = 0;
    &graba11 = 0;
    guarda_l = 0;
    gua_i = 0;
    &guarda = 0;
    guarda_dia_4 = 0;
    &grupo = 0;               || exportable al 'nomcalfi'
    ha1 = 0;
    ha2 = 0;
    hadia = 0;
    hadia1 = 0;
    has = 0;
    has1 = 0;
    has2 = 0;
    hasc = 0;
    hasta = 0;
    hasta1 = 0;
    &hcobr_0 = 0;
    &hcoti_0 = 0;      || exportable al 'nomcalfi'
    hdias_0 = 0;
    &histori = "";      || variable tabla indicando variaciones/trabajador
    &histori3 = "";      || variable tabla indicando variaciones/trabajador
    &horasex = 0;
    &nHorasTut = 0;
    &nBonifTut = 0;
    horastp = 0;
    horatc2 = 0;
    hbaja_2 = 0;
    hdese_2 = 0;
    hhuel_3 = 0;
    habse_3 = 0;
    hperm_3 = 0;
    hacci_2 = 0;
    henfe_2 = 0;
    hmate_2 = 0;
    idia_1 = 0;
    idia_3 = 0;
    idia_4 = 0;
    idia_6 = 0;
    idia_7 = 0;
    &indemni = 0;
    lin_1 = 0;
    lin_2 = 0;
    liq_aju = 0;
    &liquido = 0;
    m_dias = 0;
    mas = 0;
    mensaje0 = "    Seleccion vacia ... ";
    mensaje1 = "ATENCION, PROCESO DETENIDO !!! Convenio ";
    mensaje2 = ", INEXISTENTE en fichero ";
    mes = 0;
    mesalt = 0;
    mesco = 0;
    &meslabo = "";      || mes del calendario laboral
    &mesnum = 0;
    mespinta = "";     || variable de trabajo para pintar el mes
    mesven = 0;
    &mid = 0;
    notaria = 0;
    &nume0 = 0;
    &nume1 = 0;
    &nume2 = 0;
    nume3 = 0; nume4 = 0; nume5 = 0; nume6 = 0; nume7 = 0;
    nume8 = 0; nume9 = 0; nume10 = 0;
    numer = 0;
    p_mes = "";        || variable de trabajo para pintar mes literal
    &paga = 0;
    pagavac = 0;
    &para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    pcofi_2 = 0;
    pdia_0 = 0;
    pdia_0_E = 0;
    pdia_1 = 0;
    pdia_2 = 0;
    pdia_3 = 0;
    pdia_4 = 0;
    pdia_6 = 0;
    pdia_7 = 0;
    pdia_a = 0;
    pdia_a_E = 0;
    pdia_b = 0;
    pdia_c = 0;
    pdia_d = 0;
    pdia_e = 0;
    pdia_f = 0;
    pdia_g = 0;
    pepulti = 0;
    &perio = 0;
    &por1_cont = 0;
    por1_dfpg = 0;
    por1_hor1 = 0;
    por1_hor2 = 0;
    &por2_cont = 0;
    &por2_dfpg = 0;
    &por2_hor1 = 0;
    &por2_hor2 = 0;
    &porce = 0;
    porcp = 0;
    || &bon_60 = 0; fecha_bon_16 = ""; por_bon_16 = 0; por_bon_60 = 0;
    pp = 0;
    primera = 0;
    produc1 = 0;
    produc2 = 0;
    produc3 = 0;
    product = 0;
    &prom_ac2 = 0;
    &prom_acc = 0;
    &prom_enf = 0;
    prom_ind = 0;
    &propo = 0;          || exportable al 'nomcalfi'
    puntero = 0;
    &reten_1 = 0;
    &reten_11 = 0;
    &reten_12 = 0;
    &reten_13 = 0;
    &reten_2 = 0;
    rompe = 0;
    s_reajus = 0;
    &seleccio = 0;      || exportable al 'nomcalfi'
    sigui = 0;
    &stop = 0;
    swDiferFiniq = 0;
    sw_bruaju = 0;
    &sw_mater = 0;
    &swaju_abs = 0;
    &swaju_acc = 0;
    &swaju_des = 0;
    &swaju_enf = 0;
    &swaju_hue = 0;
    &swaju_mat = 0;
    &swaju_vac = 0;
    &swaju_per = 0;
    &swajuac = 0;
    &swajuen = 0;
    swalta = 0;
    &swbaja = 0;
    &swcongra = 0;
    swconst = 0;
    &swfuera = 0;
    &swgracon = 0;
    &swmarca = "";      || indicador de variaciones/trabajador
    swpaga = 0;
    swpro = 0;
    t_haz = 0;
    tempor = 0;
    tipo_p = 0;
    &tipo1 = "";        || mes que cumple a¤o (actual)
    &tipo2 = "";        || mes que cumple a¤o (siguiente)
    &tipo3 = "";        || trimestre que cumple a¤o (actual)
    &tipo4 = "";        || trimestre que cumple a¤o (siguiente)
    &tipo5 = "";        || semestre que cumple a¤o (actual)
    &tipo6 = "";        || semestre que cumple a¤o (siguiente)
    &tipo7 = "";        || a¤o que cumple a¤o (actual)
    &tipo8 = "";        || a¤o que cumple a¤o (siguiente)
    &tipos = 0;
    &tipox = 0;
    &topemes = 0;
    &topemes1 = 0;
    &topemes2 = 0;
    &topesmi = 0;
    &totact = 0;
    &totalt = 0;
    &totven = 0;
    &tp = 0;             || exportable al 'nomcalfi'
    tp1 = 0;
    tp2 = 0;
    tp3 = 0;
    tpx = 0;
    tpz = 0;
    trabamen = "";
    &unidades = 0;
    &vacacio = 0;
    val_auto = 0;
    valorito = 0;
    vcobr_0 = 0;
    vcoti_0 = 0;
    vlabo_0 = 0;
    vlabo_k = 0;
    &yaesta = 0;
    CodigoCons = 0;
    &nMes99 = 0;
    &nSwMes99 = 0;

     &nVtoBonif = 0;
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nPara1 = 0;
     nPara2 = 0;
     &nPorBon1 = 0;
     &nPorBon2 = 0;
     nQueBusca = 0;
     &nRecAy = 0;
     nSwAvisaNor = 0;
     nEl36 = 0;
     nDiasMensual = 30;
     nTopeMensIndem = 42;     || tope de mensualidades a pagar en indemnizacion
     &EURODB = 0;
     swMensaPaga = 0
     swIRPFPaga = 0
     aAlfa = "";
     &nMes = 0;
     &nDiasBonBaja = 0;
     nDia = 0;
     nDiasBaja = 0;
     &aFecBajaBon = "";
     &nContLog = 0;
     &nNroErrores = 0;
     &nIncid = 0;
     &aDesIncid = "";
     &swIniLog = 0;
     pror_p = 0;

     &aCError = "";
     &fCFecha = @;
     &nCConst = 0;
     &nDiasAlta = 0;
     &aNif = "";
     &aDef = "";
     &nCarencia = 180;
     &swEnFiniq = 0;
     || nMesesBon16 = 0; nAnyosBon16 = 0; nPB16Calc = 0; nPB16CalcA = 0;
     || por_bon_16A = 0; bon_60A = 0;

     &denfe_T0 = 0;
     &denfe_U0 = 0;
     &denfe_S0 = 0;
     &denfe_R0 = 0;

     &denfe_T = 0;
     &denfe_U = 0;
     &denfe_S = 0;
     &denfe_R = 0;

     &denfe_Z_H = 0;    || dias 1ra. enfermedad CON HOSPITALIZACION
     &denfe_Y_H = 0;    || 1ra. linea resto enfermedades CON HOSPITALIZACION
     &denfe_X_H = 0;    || 2da. linea resto enfermedades CON HOSPITALIZACION
     &denfe_W_H = 0;    || 3ra. linea resto enfermedades CON HOSPITALIZACION
     &denfe_V_H = 0;    || 4ta. linea resto enfermedades CON HOSPITALIZACION

     &denfe_U_H = 0;    || 1ra. linea 1ra. enfermedad CON HOSPITALIZACION
     &denfe_T_H = 0;    || 2da. linea 1ra. enfermedad CON HOSPITALIZACION
     &denfe_S_H = 0;    || 3ra. linea 1ra. enfermedad CON HOSPITALIZACION
     &denfe_R_H = 0;    || 4ta. linea 1ra. enfermedad CON HOSPITALIZACION

     &denfe_Z0_H = 0;    || dias 1ra. enfermedad CON HOSPITALIZACION
     &denfe_U0_H = 0;    || 1ra. linea 1ra. enfermedad CON HOSPITALIZACION
     &denfe_T0_H = 0;    || 2da. linea 1ra. enfermedad CON HOSPITALIZACION
     &denfe_S0_H = 0;    || 3ra. linea 1ra. enfermedad CON HOSPITALIZACION
     &denfe_R0_H = 0;    || 4ta. linea 1ra. enfermedad CON HOSPITALIZACION

     &denfe_Y0_H = 0;    || 1ra. linea resto enfermedades CON HOSPITALIZACION
     &denfe_X0_H = 0;    || 2da. linea resto enfermedades CON HOSPITALIZACION
     &denfe_W0_H = 0;    || 3ra. linea resto enfermedades CON HOSPITALIZACION
     &denfe_V0_H = 0;    || 4ta. linea resto enfermedades CON HOSPITALIZACION

     &nHospi = 0; nHospi1 = 0; nHospi2 = 0; nHospi3 = 0; nHospi4 = 0;
     denfe_3_H = 0;
     denfe_3_Hasta = 0;

     &nHospi_Acc = 0;
     nHospi1_Acc = 0;
     nHospi2_Acc = 0;
     nHospi3_Acc = 0;
     nHospi4_Acc = 0;
     &dacci_Z_H = 0;
     &dacci_z_H = 0;
     &dacci_Y_H = 0;
     &dacci_y_H = 0;

     &aBaja1_Art = "";
     &aBaja2_Art = "";
     &aBaja3_Art = "";
     &aBaja4_Art = "";
     aFechaRef = "";
     &nDesem = 0;
     nTope = 0;
     &nCodPob = 0;
     &nProvincia = 0;
     &nPoblacion = 0;
     &nAut = 0;
     &aCodPostal = "";
     &nDiaAct1 = 0; &nDiaAct2 = 0; &nDiaAct3 = 0; &nDiaAct4 = 0;
     &nDiaAct5 = 0; &nDiaAct6 = 0; &nDiaAct7 = 0; &nDiaAct8 = 0;
     &semana1 = 0;
     dianum = 0;
     clavep = "";
     &aCalenConcep = "";
     pesos = 0;
     diades = 0;
     mesdes = 0;
     diahas = 0;
     meshas = 0;
     diafij = 0;
     mesfij = 0;
     mid_1 = 0;
     mid_2 = 0;
     &conser3 = 0;
     &conser4 = 0;
     &ajuste5 = 0;
     &ajuste6 = 0;
     &ajuste7 = 0;
     &swConcep = 0;
     nMesFiesta = 0;
     swMinero = 0;
     nBaseMinero = 0;
     &nPropPrac = 1;
     &nAjuste = 0;
     &nConcepFV = 0;
     &aDescripFV = "";
     &nUnidFV = 0;
     &nImporFV = 0;
     &swNoEntra = 0;
     &nTotFV = 0;
     &swCumple = 0;
     nDesdeMes = 0;
     nHastaMes = 0;
     &nAny = 0;
     nAjusteEB = 0;
     &nAjusteEBnor1 = 0; &nAjusteEBnor2 = 0; &nAjusteEBnor3 = 0;
     nAjusteEB4101 = 0; nAjusteEB4102 = 0; nAjusteEB4103 = 0;
     nAjusteEB420 = 0;
     &swConceptoOFF = 0;
     &nTopeMax = 0;
     &nTopeMin = 0;
     &promE_AUTO = 0;
     &promA_AUTO = 0;

     fFechaAnt = @;
     fFecha = @;
     aFecha = "";
     nAnysAlta = 0;
     nTotalMeses = 0;
     aFechaDesde = "";
     aFechaHasta = "";
     fFechaDesde = @;
     fFechaHasta = @;
     reten_vac = 0;
     bruto_vac = 0;
     liqui_vac = 0;
     diferencia = 0;
     fFechaAlta = @;
     aBase = "";
     aMas = "";
     aFich = "";
     swNoMensa = 0;
     dacum_aju = 0;

     dto_tot_liq = 0
     dto_con_liq = 0;
     dto_dfp_liq = 0;
     reten1_liq = 0;
     reten11_liq = 0;
     swGraba = 0;
     FExiste = 0;
     &swAjuste3 = 0;
     &swAjuste3_C = 0;
     &swAjuste3_2 = 0;

     aFechaAlta = "";
     &aFechaBaja = "";
     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     nMesBaja = 0;
     nAnyBaja = 0;
     aDia = ""; aMes = ""; aAny = "";
     nCotAlta = 0;
     swTransRaro = 0;
     dto_tot_pag = 0;
     dto_con_pag = 0;
     dto_dfp_pag = 0;
     reten1_pag = 0;
     acump_200 = 0;
     &ny_D = 0;
     &ny_H = 0;
     &nz_D = 0;
     &nz_H = 0;
     nUni200_1 = 0;
     nUni200_2 = 0;
     diff_L = 0;
     &dreca_0 = 0;
     &dreca_1 = 0; &dreca_2 = 0; &dreca_3 = 0; &dreca_4 = 0;
     &dunic_201 = 0; &dunic_202 = 0; &dunic_203 = 0; &dunic_204 = 0;
     &dunic_205 = 0; &dunic_206 = 0; &dunic_207 = 0; &dunic_208 = 0; &dunic_999 = 0;
     swComp = 0;
     swItch = 0;
     dvalo_201_A = 0; dvalo_202_A = 0; dvalo_203_A = 0; dvalo_204_A = 0;
     dvalo_205_A = 0; dvalo_206_A = 0; dvalo_207_A = 0; dvalo_208_A = 0;
     &swCalPaga = 0;
     &swCalPror = 0;
     campoc = 0;
     swNoAjuste3 = 0;
     swNoAjuste3_2 = 0;
     aContEsp = 0;
     n106BomPor = 0;
     n121BomPor = 0;
     &swModulo = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     &nIRPF1 = 0;
     &nIRPF2 = 0;
     &nIRPF3 = 0;
     nIRPFSol = 0;
     nImpReal = 0;
     nImpTeor = 0;
     pageta = 0;
     &nArrAnyAnt = 0;

     &nEmp = 0;
     &nTra = 0;
     &nBonifFCI1 = 0;
     &nBonifFCI2 = 0;
     fFechaIniBon = @;
     fFechaFinBon = @;
     nDiasBon = 0;
     &nCodigoBon = 0;
     &nTip = 0;
     nSimulaPaga = 0;
     daviso18 = 0;
     &swForm = 0;
     &denfe_UC = 0;    || 1ra. linea 1ra. enfermedad
     &denfe_TC = 0;    || 2da. linea 1ra. enfermedad
     &denfe_SC = 0;    || 3ra. linea 1ra. enfermedad
     &denfe_RC = 0;    || 4ta. linea 1ra. enfermedad

     &denfe_YC = 0;    || 1ra. linea resto enfermedades
     &denfe_XC = 0;    || 2da. linea resto enfermedades
     &denfe_WC = 0;    || 3ra. linea resto enfermedades
     &denfe_VC = 0;    || 4ta. linea resto enfermedades

     &swPrimera = 0;
     dias_p = 0;
     dias_d = 0;
     nImpPaga = 0;
     &nDiasAcum = 0;
     nTotDiasPaga = 0;
     nTotDiasPaga1 = 0;
     &nPasoIT = 0;
     &denfe_UC0 = 0;
     &denfe_TC0 = 0;
     &denfe_SC0 = 0;
     &denfe_RC0 = 0;
     &denfe_YC0 = 0;
     &denfe_XC0 = 0;
     &denfe_WC0 = 0;
     &denfe_VC0 = 0;
     &nPrecioVar = 0;
     anticom0 = 0;
     nImporteAju2 = 0;
     &bon_55 = 0;
     || &nBonifTex1 = 0;
     || &nBonifTex2 = 0;
     swCambioBon = 0;
     fIniBon = @;
     aIniBon = "";
     fAny1Bon = @;
     fAny2Bon = @;
     nDiasBon_1 = 0;
     fFechaCal = @;
     &aIndTex = "";
     devenga = 0;
     deducir = 0;
     &liquipag = 0;
     &swDiosMio = 0;
     &swComp120 = 0;
     &nBaseIT2 = 0;
     &nBaseComp = 0;
     &nImporte_E = 0;
     &nDiasTeor_E = 0;
     &nDiasReal_E = 0;
     &aFechaFIN = "";
     &nEmbargo = 0;
     swajuste11 = 0;
     &nEpigConv = 0;
     &nAcumAbs = 0;
     &nAnysParaAnt = 0;
     &bon_59 = 0;
     &nVacMesAct = 0;
     &nVacRestoAny = 0;
     &aCNAEEmp = "";
     &nPresDiaEnf = 0;
     &nPresDiaAcc = 0;
     &dcoti_c = 0; dcoti_x = 0;
     &dacci_X2 = 0;
     nDiasMedia = 0;
     &swSigue = 0;
     &swHistor = 0;
     swEoC = 0;
     nGuarda_c = 0;
     &nDiasLabTra = 0;
     &nDiasLabAny = 0;

     &fFechaBaja = @;
     &fech4 = @;
     &nIngresos = 0;
     &nIngresosPag = 0;
     &nDeducc = 0;
     &nDeduccPag = 0;
     &nLiquidoNom = 0;
     &nLiquidoPag = 0;
     swProrPaga = 0;     || estoy en CALCULO DE PRORRATA
     &swMater = 0;
     &swPater = 0;
     &swCont = 0;
     &swRiesgo = 0;
     nDiasCotIT = 0;
     swIguales = 0;
     &aTipoIT = "";
     camprop = 0;
     &ddese_3 = 0;
     &ddese_4 = 0;
     &nPropDesTP = 0;
     &swAjusteD = 0;
     &swAjusteDD = 0;
     &denfe_NO = 0;
     &nDesEnf = 0; &nDesAcc = 0; &nDesMat = 0;
     &nDesPat = 0; &nDesRie = 0; &nDesCon = 0;
     &nBonifERE = 0;
     &nDiasBonifERE = 0;
     &swParcheAjuIT = 0;
     &nBaseMesAntIT = 0;
     &enMes = 0;
     &enAny = 0;
     &nCodBonFom1 = 0; &nCodBonFom2 = 0;
     || &nCodBonTex1 = 0; &nCodBonTex2 = 0;
     &swApliMin = 0;
     &swApliMax = 0;
     nBonTot = 0;
     &swIndem = 0;
     &nRemunMesOri = 0;
     &nEl928 = 0;
     &nPromEnf_ENTERO = 0;
     &nEstoyEnAjuste = 0;
     &swFuncRecorte = 0;
     nAcum10_Antes = 0;
     &nNuevaAcum10 = 0;
     &nDiferPror = 0;
     &nUnidYaPagadas = 0;
     &nBonifFormEmp = 0;
     &nBonifFormTra = 0;
     &nTotalPrecioVar = 0;
     &nPrecioVarMes = 0;
     &dacum_999_completo = 0;
     nDiferencia = 0;
     &sw79 = 0;
     &aVacacSINO = "";        || proviene de la simulacion de costes
     &nPasoLog = 0;
     &nCanal = 0;
     &nDiasEnfBase2 = 0; &nDiasAccBase2 = 0;
     &nDiasMatBase2 = 0;
     &denfe_A_Base2 = 0; &denfe_B_Base2 = 0; &denfe_C_Base2 = 0; &denfe_D_Base2 = 0;
     &dacci_X2_Base2 = 0;
     &nPromedio = 0;
     swSigue1 = 0;
     &denfe_U_Base2 = 0; &denfe_T_Base2 = 0;
     &denfe_S_Base2 = 0; &denfe_R_Base2 = 0;
     &denfe_Y_Base2 = 0; &denfe_X_Base2 = 0;
     &denfe_W_Base2 = 0; &denfe_V_Base2 = 0;
     nBase = 0;
     aUsuario = "";
     swBuscaDupliERE = 0;
     &nCuantos = 0;
     &nDiasMesTrab = 0;
     &nCoefEspecial = 1;
     &sw45y33 = 0;
     &swControlIT = 0;
     &aTipoOrigen = "";
     swSoyControlIT = 0;
     swSigue2 = 0;
     &nDiasCotERE = 0;
     &swAbsVacHue = 0;
     &swAgosto2012 = 0;
     &base_6p_com = 0; &base_7p_des = 0; &base_7p_fog = 0; &base_7p_fp= 0;
     &base_6p_com_tra = 0; &base_7p_des_tra = 0; &base_7p_fog_tra = 0; &base_7p_fp_tra = 0;
     &base_7_ori = 0;
     &dto_sol_emp = 0; &dto_sol_tra = 0; &dto_exc_emp = 0; &dto_exc_tra = 0;
     nPorcFormacion = 0;
     &nPropJub = 0;
     &nAnysIndem = 0;
     &aCCTopeadas = ""; &aCPTopeadas = "";
     &swNuevoAju = 0;
     &swAjusteIT = 0;
     &nLineaIT = 0;
     &swAjusteIT2 = 0;
     &aTipoAjusteIT = "";
     &aTipoAjusteIT2 = "";
     &nBonifJuv = 0;
     &nHorasRegTP = 0;
     &histori2 = "";
     nVecesL = 0;
     denfe_UY_BP = 0; denfe_TX_BP = 0; denfe_SW_BP = 0; denfe_RV_BP = 0;
     dacci_Z_BP = 0; dacci_Y_BP = 0;
     nBaseCompTramo = 0;
     nBasePresTramo = 0;
     &nLimiteAnys = 0;
     &nAcumRecMes1 = 0; &nAcumRecMes2 = 0; &nAcumRecMes3 = 0; &nAcumRecMes4 = 0;
     swPagasProrr = 0;
     swOtroAlta = 0;
     &aTipUltimaIT = "";
     &nBaseBon945 = 0;
     &aVersion = "";
     aConceptosComp = "";
     &nImporteComp = 0;
     aLon = ""; nLon = 0; nPos = 0; nConcepto = 0;
     swITEmp = 0;
     por1_des = 0; por1_fp = 0;
     por2_des = 0; por2_fog = 0; por2_fp = 0;
     &nHorasFor = 0;
     swCambiaCot_A = 0;
     &nDiasBonifJuv = 0;
     nElAjuste = 0;
     &swBuscoTPXIT = 0;
     &nJornadasIT = 0;
     swCitrico = 0;
     nCuota = 0;
     &nDiasInactividad = 0;
     nBaseEmpTra = 0; nBaseEmp = 0; nCuotaEmpTra = 0; nCuotaEmp = 0;
     &nCuotaEmpCC = 0; &nCuotaEmpDes = 0; &nCuotaEmpFog = 0; &nCuotaEmpFP = 0;
     nDifDiarioFeb = 0;
     swCotizTramos = 0;
     &enTipo = 0;
     &enImpRem = 0;
     &enImpExt30 = 0;
     &enImpExt31 = 0;
     &aCCCReg = "";
     &nPreavisoAbo = 0;
     &nPreavisoDto = 0;
     &nVacDto = 0;
     nCalc = 0;
     &enHorasTeor = 0;
     dia_4_cot30 = 0;
     swUltimoDiaIT = 0;
     &swCambiaProm = 0;
     &nNroHorasExtra = 0;
     &nDiasAltaInt = 0;
     &swFijoDisc = 0;
     swFijoDH = 0;       || para topes, solo para ajustes tipo 4
     &nHorasCEC = 0;
     &aTempEpig = "";
     &nBase946 = 0;
     &nBase947 = 0;
     &nBasePresEnf = 0; &nBasePresAcc = 0;
     &nUniDes2 = 0; &nBaseDes2 = 0;
     &nDiasAltaCEC = 0; &nDiasITCEC = 0; &swCandidatoCEC = 0;
     &nDiasERETC_CEC = 0; &nDiasERETP_CEC = 0;
|FIN;

||*************************************************************************
||                    LECTURA DE CONCEPTOS
||*************************************************************************

|PROCESO leeconceptos;
     || lee y graba desde el fichero de categorias
     aConceptosComp = "";
     |ABRE #3;
     |DDEFECTO #3;
     |DDEFECTO #4;
         #3#0 = #2#87;
         #3#1 = #2#17;
     |LEE 000#3=;
     |SI FSalida = 0;
         |BUCLELIN 2gracateg#3;
     |FINSI;
     |CIERRA #3;

     || lee y graba desde el fichero de aux. de trabajadores
     CodigoCons = 0;
     |ABRE #5;
     |DDEFECTO #5;
     |DDEFECTO #6;
         #5#0 = #2#0;
         #5#1 = #2#1;
     |LEE 000#5=;
     |SI FSalida = 0;
         CodigoCons = #5#3;
         |BUCLELIN 2gratraba#5;
     |FINSI;
     |CIERRA #5;

     || lee y graba desde el fichero de var. de trabajadores
     |HAZ horasfor;
     |SI nHorasFor ! 0;       || simulo como si me viene de
          #6#2 = 901;         || importes por trabajador
          #6#3 = nHorasFor;
          |HAZ gratraba;
     |FINSI;
     |ABRE #7;
     |DDEFECTO #7;
     |DDEFECTO #8;
     #7#0 = #2#0;
     #7#1 = #2#1;
     |SI nMes99 ! 0;
          |SI nSwMes99 = 1;
               #7#2 = nMes99;        || calculo IRPF 99 (todos los meses)
          |FINSI;
          |SI nSwMes99 = 2;
               |SI nMes99 ! #0#8;
                    #7#2 = #0#8;      || calculo IRPF 99 (solo el mes corriente)
               |SINO;
                    #7#2 = nMes99;    || calculo IRPF 99 (solo el mes corriente)
               |FINSI;
          |FINSI;
     |SINO;
          #7#2 = #0#8;
     |FINSI;
     #7#3 =    0;
     |LEE 000#7=;
     |SI FSalida = 0;
          antici1 = #7#19;      || anticipos 1
          antici2 = #7#20;      || anticipos 2
          especie = #7#21;      || en especie
          antici4 = #7#44;      || anticipos 3
          |BUCLELIN 2gravaria#7;
     |FINSI;
     |HAZ Hospital;
     |CIERRA #7;

     |SI runnom = "nomcalfi";
          |HAZ VarFini;
     |FINSI;
|FPRC;

||***************************************************************************
||                GRABACION DE LINEAS DE REGISTRO
||***************************************************************************

|PROCESO gracateg;  || de calculo 'leecateg', graba lineas de categorias
     concepto = #04#02;
     unidades = #04#03;
     |HAZ convenio;
     |SI convenio = 0;
          |HAZ recarga;
          #12#04 = #04#02;      || concepto
          #12#09 = #04#03;      || unidades
          #12#10 = #04#04;      || valor
          |SI #4#5 ! "N";
               #12#10 = #12#10 * tp; || proporcion en los tiempos parciales
               #12#10 = #12#10 * nPropPrac;
          |FINSI;
          |SI #10#3 = "A";     #12#10 = 0;    |FINSI;
          |SI #12#5 = "H"; #12#9 = nHorasRegTP; |FINSI;
          |GRABA 020#12n;
          cabecera = 1;     || switch para grabar posteriormente la cabecera
     |FINSI;
|FPRC;

|PROCESO gratraba;  || de calculo 'leetraba', graba lineas de trabajadores
     concepto = #06#02;
     unidades = #06#03;
     |HAZ convenio;
     |SI convenio = 0;
          |DDEFECTO #12;
          |HAZ recarga;
          #12#04 = #06#02;
          |LEE 000#12=;
          |SI FSalida = 0;  |BORRA 020#12a;  |FINSI;
          |HAZ recarga;
          #12#04 = #06#02;      || concepto
          |SI #06#03 ! "          ";    #12#09 = #06#03;  |FINSI;  || unid.
          |SI #06#04 ! "            ";  #12#10 = #06#04;  |FINSI;  || valor
          |SI #10#3 = "A";     #12#10 = 0;    |FINSI;
          |SI #12#5 = "H"; #12#9 = nHorasRegTP; |FINSI;
          nNume1 = #12#9 * #12#10;

          ||SI nNume1 ! 0; aAlfa = concepto; aConceptosComp = aConceptosComp + aAlfa; |FINSI;
          || Los que NO tengo en cuenta para proporcionar a jornada completa
          || SOLO los de variaciones del mes, los de variaciones por trabajador
          || SI que los "elevo" al 100%, comentado con Pin. 3430.1307

          |GRABA 020#12n;
          cabecera = 1;     || switch para grabar posteriormente la cabecera
     |FINSI;
|FPRC;

|PROCESO gravaria;  || de calculo 'leevaria', graba lineas de variaciones
     concepto = #08#04;
     unidades = #08#05;
     |HAZ convenio;
     |SI convenio = 0;
          |DDEFECTO #12;
          |HAZ recarga;
          #12#04 = #08#04;
          |LEE 000#12=;
          |SI FSalida = 0;  |BORRA 020#12a;  |FINSI;
          |HAZ recarga;
          #12#04 = #08#04;  || concepto
          |SI #08#05 ! "          ";    #12#09 = #08#05;  |FINSI;  || unid.
          |SI runnom = "nomcalfi"; |Y concepto = 125;
               |SI #12#9 [ 0; #12#9 = 0; |FINSI;
          |FINSI;
          |SI #08#06 ! "            ";  #12#10 = #08#06;  |FINSI;  || valor
          |SI #10#3 = "A";     #12#10 = 0;    |FINSI;
          |SI #12#5 = "H"; #12#9 = nHorasRegTP; |FINSI;
          nNume1 = #12#9 * #12#10;
          |SI nNume1 ! 0; aAlfa = concepto; aConceptosComp = aConceptosComp + aAlfa; |FINSI;
          |GRABA 020#12n;
          cabecera = 1;     || switch para grabar posteriormente la cabecera
     |FINSI;
|FPRC;

|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#8;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#9;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;
     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
|FPRC;

|PROCESO borralineas;
     |BORRA 020#12a;
|FPRC;

||***************************************************************************
||                 GRABACION DE CABECERA DE REGISTRO
||***************************************************************************

|PROCESO cabecera;
     |SI cabecera = 1; |O #labtraba#45 = "422"; || comprueba si hay que grabar la cabecera
          seleccio = 1;
          |HAZ CompAgosto2012;
          |HAZ calleer;          || lee empresa, constantes, calendario, etc.
          |SI #0#9 ] 2007; |Y nEpigConv = 0;
               |BUCLELIN 0borralineas#11; || en verdad no haria falta ya que lo
               |ACABA;
          |FINSI;
          |HAZ IniciaCosas;
          |HAZ ControlMat;
          |HAZ caldias;          || calcula los dias de ILT, alta, baja
          |HAZ ProcesosVarios;
          |SI swTransRaro = 1;
               #11#0  = #2#0;     || empresa
               #11#1  = #2#1;     || trabajador
               #11#2  = #0#8;     || mes
               #11#3  =    0;     || tipo
               |BUCLELIN 0borralineas#11; || en verdad no haria falta ya que lo
               |ACABA;
          |FINSI;
          nIRPF1 = #2#30; nIRPF2 = #2#174; nIRPF3 = #2#175; nIRPFSol = #2#216;
          |HAZ calanti;          || calcula 101, 102 y 103
          |HAZ calunac;          || calcula las unidades y los acumulados
          |HAZ AcumAbs;
          |HAZ calpror;          || calcula la prorrata SOLO PAGAS PRORRATEADAS
          |HAZ calpaga;          || calcula las pagas SOLO PAGAS PRORRATEADAS
          |SI #0#12 = "N"; |Y aParam ! "NOMVARCA"; |Y aParam ! "AUTO"; |Y aParam ! "AUTOCONREG";
          |Y aParam ! "CALAUTO";
               |HAZ recuperapaga;
          |FINSI;
          |HAZ calenfe;      || calcula los complementos de enfer. y accid.
          |HAZ calfin1;      || calculo final 1
          |HAZ calfin2;      || calculo final 2
          |HAZ carencia;
          |HAZ calfinvac;
          |HAZ CalIndNUEVO;

          |SI swSegPasada = 0;
               nPaso = 2; |HAZ CompAjuste;
               |SI swDiosMio = 1;
                    |HAZ cerodias;
                    |HAZ proceso;
                    swCompAjuste = 1;
                    |HAZ CompAjuste;
               |FINSI;
               |SI swCompAjuste = 1; |Y swSegPasada = 1;
                    |HAZ cerodias;
                    |HAZ proceso;
               |FINSI;
               swSegPasada = 0;
               swCompAjuste = 0;
               swDiosMio = 0;
          |FINSI;
          |HAZ VariosFinal;
          |DDEFECTO #11;
          #11#0 = #2#0;     || empresa
          #11#1 = #2#1;     || trabajador
          #11#2 = #0#8;     || mes
          #11#3 =    0;     || tipo
          #11#4 = #2#36;    || fecha de alta
          #11#5 = fecbaj;   || fecha de baja
          |SI nDiasAltaInt ! 0; #11#5 = ""; |FINSI;
          || cojo los dias de alta de los intervalos, la fecha baja no es real
          #11#6 = #2#34;    || fecha de antiguedad
          #11#7 = dia_2;    || dias periodo
          #11#8 = dcoti_0;  || dias alta
          |SI es_irregul = 1;|Y tpz ! 0;
               #11#8 = tpz;   || dias alta en irregulares
          |FINSI;
          |SI swCambiaCot = 1;
               #11#8 = dbaja_3 - dalta_3 + 1 - dhuel_2 - ddese_2;
               |SI swCandidatoCEC = 1; |Y ddese_2 ! 0; |Y nDiasAltaCEC ! 0;
                    #11#8 = #11#8 - nElAjuste;    || dos fichas, la segunda
               |FINSI;             || en ERE y trab. a TP
          |FINSI;
          |SI ddese_3 > 0;
               || ddese_3 trae los dias naturales y no cotizables
               nNume1 = dia_4 - (dalta_2 + dbaja_2 + dhuel_2 + ddese_2);
               |SI swCambiaCot = 1; nNume1 = nNume1 + nElAjuste; |FINSI;
               #11#8 = nNume1;
          |FINSI;
          #11#9  = #2#45;    || tipo contrato
          |SI swbaja = 1; |Y runnom ! "nomcalir";
               |SI #2#45 = "441"; |O #2#45 = "540"; |O #2#45 = "541";
                    nIncid = 29;
                    |HAZ graba_inc;
               |FINSI;
          |FINSI;
          |SI #labempre#137 = "0";
               #11#10 = #11#8;    || dias contrato (TC2) = dias alta
          |SINO;
               #11#10 = dcoti_x;  || dias sistema plusgestiona (para pagas al act.)
          |FINSI;
          |SI diastc2 ! 0;
               #11#10 = diastc2; || dias contrato (TC2) = concepto 917
          |FINSI;
          |SI swCitrico ! 0;
               #11#10 = fijo_1;
          |FINSI;
          #11#11 = #2#47;    || horas contrato
          nume1 = (#2#47 * #11#8);
          |SI 0 < nume1; |Y nume1 < 0.5;
               nume1 = 1;
          |SINO;
               nume1 = nume1 ! 0;
          |FINSI;
          |SI es_parcial = 1; |O es_irregul = 1;
               #11#11 = nume1;   || horas contrato por dias alta en t.parcial
          |SINO;
               |SI #labtraba#45 ] 300; |Y #labtraba#45 [ 399;
                    |SI #nomconca#162 = 0; #nomconca#162 = 40; |FINSI;
                    #11#11 = (((#nomconca#162 / 7) ! 2) * #11#8) ! 0;
                    |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
                         |SI #labtraba#47 ! 0;
                              #11#11 = (#labtraba#47 * #11#8) ! 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI es_parcial = 1; |O swFijoDH = 1;  || soy tiempo parcial
               |SI #labtraba#97 = 4; |Y nHorasCEC ! 0; #11#11 = nHorasCEC; |FINSI;
          |FINSI;
          |SI #labtraba#42 = "L"; |Y #labtraba#129 = "G";
               #11#11 = nume1;   || guarda legal, jornada reducida, ayunt.
          |FINSI;
          |SI horatc2 ! 0;
               #11#11 = horatc2; || horas contrato = concepto 918
          |FINSI;
          || tema de millenium, si molesta, quitarlo
          |SI enHorasTeor ! 0; #11#11 = nHorasRegTP; |FINSI;
          #11#12 = #2#39;   || codigo bonificacion
          #11#13 = nIRPF1;   || (%) IRPF 1
          #11#87 = reten_p;  || (%) IRPF paga extra
          #11#14 = acum_991; || base IRPF 1
          #11#15 = reten_11; || retencion IRPF 1
          #11#16 = acum2_200;|| base IRPF pagas
          #11#17 = reten_2;  || retencion IRPF pagas
          #11#18 = acum_41;  || base IRPF exenta
          |PARA campo = 12; |SI campo [ 15; |HACIENDO campo = campo + 1;
               desde = campo - 8;
               hasta = campo - 4;
               puntero = desde + 15;  #11puntero = #7desde;   || tabla de
               puntero = hasta + 15;  #11puntero = #7hasta;   || /variaciones
               puntero = campo + 15;  #11puntero = #7campo;

               nume1 = campo + 23;    || campo 35 del nomvarca
               nume2 = campo + 27;    || campo 39 del nomvarca
               puntero = nume1 + 57;  #11puntero = #7nume1;
               puntero = nume2 + 58;  #11puntero = #7nume2;
               puntero = campo + 107;
               nume1 = campo + 35;    #11puntero = #7nume1;
          |SIGUE;
          #11#31 = denfe_2;  || total dias enfermedad
          #11#32 = dacci_2;  || total dias accidente
          #11#33 = dhuel_2;  || total dias huelga
          #11#34 = dabse_2;  || total dias absentismo
          #11#35 = prom_enf; || promedio enfermedad
          #11#36 = prom_acc + prom_ac2; || promedio accidente
          |SI nRemunMesOri = 0;
               #11#37 = acum_10 + coba_3 + exce_smi; || remuneracion total
               #11#37 = #11#37 + dacum_30 + dacum_31; || horas extras
          |SINO;
               #11#37 = nRemunMesOri;
          |FINSI;
          #11#38 = dvalo_pro;|| base prorratas
          #11#39 = base_6;   || base cotizacion cont. comunes
          #11#40 = base_7;   || base cotizacion D+F+P
          #11#41 = dacum_30; || base H.E. 1
          #11#42 = dacum_31; || base H.E. 2
          |SI base_F ! 0;
               #11#43 = bon_0;    || base bonificada CC (1)
          |FINSI;
          #11#44 = bon_3;    || base bonificada CP (1)
          #11#45 = base_E;   || S.S. cgo. empresa
          #11#46 = bruto_rec;|| bruto recibo
          #11#47 = bruto_pag;|| bruto paga
          #11#48 = dto_con + deducss;  || dto. cont. comunes
          #11#49 = dto_dfp;  || dto. D+F+P
          #11#50 = dto_ho1;  || dto. horas 1
          #11#51 = dto_ho2;  || dto. horas 2
          #11#52 = antici1;  || anticipos -1-
          #11#53 = antici2;  || anticipos -2-
          #11#89 = antici4;  || anticipos -3-
          #11#54 = especie;  || en especie
          #11#86 = antici3;  || anticipos paga extra
          #11#104 = nEmbargo; || importe embargo
          #11#105 = nAcumAbs; || descuento absentismo (en negativo)
          |SI swMinero = 1;
               #11#55 = dcobr_0 - dlabo_k;
               #11#56 = nBaseMinero;  || base de cotizacion mineros
          |SINO;
               #11#55 = dlabo_0; || desde 18.04.2007 dias efectivamente trabajados
               #11#56 = acum_52;  || importe ayuda subnormalidad (502)
          |FINSI;
          |SI #labtraba#42 = "C";|O #labtraba#42 = "F";    || para citricos me guardo dia alta reales
               #11#55 = dcoti_c;             || me los sigo guardando, pero en
               #11#56 = nJornadasIT;         || jornadas en IT si me las han puesto
               #11#118 = nDiasInactividad;
          |FINSI;                            || verdad ya no lo uso
          #11#57 = acum_53;  || importe enfermedad          (503)
          #11#58 = acum_54;  || importe accidentes          (504)
          #11#59 = denfe_3+dmate_3;  || complemento enf./mat. (511+513)
          #11#60 = dacci_3+dtodo_3;  || complemento acci./autom. (514+512)
          |SI es_aprendi = 0;
               #11#61 = bon_1;    || (%) con. comunes
          |FINSI;
          |SI #labtraba#42 = "L"; |Y #nomcontr#72 = "N";
               base_5 = guarda_l;
          |FINSI;
          #11#62 = base_5;   || base cotiz. enfe/acci
          #11#63 = base_F;   || cuota bonif. (1)
          #11#64 = base_D;   || subvencion horas
          #11#107 = horasex;   || horas formacion subvencionadas
          #11#182 = nHorasTut; || horas tutoria subvencionadas
          #11#183 = nBonifTut; || Importe Bonif. Tutoria
          #11#65 = dmate_2;  || total dias maternidad
          #11#66 = dvaca_2;  || total dias vacaciones
          #11#67 = nIRPF2;   || (%) irpf 2
          #11#68 = nIRPF3;   || (%) irpf 3
          #11#69 = acum_992; || base irpf 2
          #11#70 = acum_993; || base irpf 3
          #11#71 = reten_12; || reten. irpf 2
          #11#72 = reten_13; || reten. irpf 3
          #11#73 = denfe_4;  || prestacion enf. empresa     (515)
          #11#74 = acum_99;  || total bases irpf
          #11#75 = reten_1;  || total retenciones
          #11#76 = #7#25;    || dto.pagas huelga
          #11#77 = #7#26;    || dto.pagas absentismo
          #11#78 = ddese_reales;
          || BASE COTIZACION EMPRESARIAL
          #11#79 = coba_4 + nDesem + coba_5;
          #11#80 = cobb_4 + nDesem + cobb_5;

          #11#81 = zbase_F;  || cuota bonif. (1)
          #11#82 = nPorBon1; || (%) bonif. (1), para el TC2/1
          #11#83 = nPorBon2; || (%) bonif. (2), para el TC2/1
          #11#84 = bon_5;    || base ILT bonificada (1), para el TC2/1
          #11#85 = zbon_5;   || base ILT bonificada (2), para el TC2/1
          || #11#88 = bon_60;   || importe bonificacion mayores 60 a¤os RDL 16/2001
          #11#91 = dperm_2;  || total dias permisos sin retribucion
          #11#96 = nBonifFCI1;   || importe boni. fomento cont. indef. RDL 5/2006
          || #11#101 = bon_55;     || importe bonificacion mayores 55 a¤os TEXTIL
          || #11#102 = nBonifTex1;  || importe boni. fomento cont. par ale TEXTIL
          || #11#103 = aIndTex;
          || #11#106 = bon_59;   || importe bonificacion mayores 59 a¤os
          #11#117 = coba_4;       || base en situacion de maternidad
          #11#125 = nBonifERE; || importe bonificacion ERE 50% CC
          #11#126 = nDiasBonifERE; || dias bonificacion ERE 50% CC
          #11#127 = #2#242;        || base diaria en ERE
          #11#128 = nDesem;        || base total en ERE
          #11#129 = dries_2;       || dias en situacion de riesgo
          #11#130 = base_10;       || base en situacion de riesgo
          #11#131 = dcont_2;       || dias en situacion de IT control S.S.
          |SI #11#131 > 0;
               #11#65 = #11#65 - #11#131;
          |FINSI;
          #11#132 = base_11;       || base en situacion de IT control S.S.
          #11#133 = nBonifFCI2;    || importe boni. fomento cont. indef. RDL 5/2006
          || #11#134 = nBonifTex2;    || importe boni. fomento cont. par ale TEXTIL
          #11#135 = nCodBonFom1;
          #11#136 = nCodBonFom2;
          || #11#137 = nCodBonTex1;
          || #11#138 = nCodBonTex2;
          #11#139 = dpate_2;       || dias en situacion de paternidad
          #11#140 = ddese_4;            || dias en situacion de ERE a T.Completo
          #11#141 = ddese_2 - ddese_4;  || dias en situacion de ERE a T.Parcial
          #11#142 = dto_des;
          #11#143 = nBonifFormEmp;
          #11#144 = nBonifFormTra;

          #11#108 = bruto_rec + base_E;      || coste total trabajador
          #11#109 = nLiquidoNom;             || liquido nomina
          #11#110 = acum2_200;               || coste pagas
          #11#111 = nLiquidoPag;             || liquido pagas
          #11#112 = #11#108 + #11#110;       || total coste
          #11#113 = #11#109 + #11#111;       || total liquido
          #11#146 = nBaseIT2;
          #11#147 = #labtraba#111;
          #11#159 = #nomcontr#17;
          #11#160 = #nomcontr#61;
          #11#161 = #labempre#128;
          #11#162 = #labtraba#204;
          #11#163 = #labtraba#248;
          #11#164 = dto_sol_emp;
          #11#165 = dto_sol_tra;
          #11#166 = dto_exc_emp;
          #11#167 = dto_exc_tra;
          #11#168 = aCCTopeadas;
          #11#169 = aCPTopeadas;
          #11#170 = nBonifJuv;
          #11#184 = #0#9;
          fFecha = ~; #11#188 = fFecha;
          |SI #nomvarca#19 ! 0; #11#185 = #nomvarca#28; |FINSI;
          |SI #nomvarca#20 ! 0; #11#186 = #nomvarca#29; |FINSI;
          |SI #nomvarca#44 ! 0; #11#187 = #nomvarca#45; |FINSI;
          #11#190 = aVersion;
          #11#191 = zbon_0;   || base bonificada CC (2)
          #11#192 = zbon_3;   || base bonificada CP (2)
          |SI swCambiaCot = 1; |O swCambiaCot_A = 1;
               #11#181 = "S";
          |FINSI;
          #11#194 = dperm_2;
          #11#195 = coba_5 / dperm_2; #11#196 = cobb_5 / dperm_2;
          #11#197 = coba_5; #11#198 = cobb_5;
          #11#199 = nPreavisoAbo + nPreavisoDto;
          #11#200 = nVacDto;
          |HAZ SS_Empresa;

          |SI swCotizTramos = 1;
               |HAZ TraspasoCEC;
               || posibles variaciones del liquido
               #11#109 = #11#109 + dto_con + dto_dfp - #11#48 - #11#49;
               #11#113 = #11#113 + dto_con + dto_dfp - #11#48 - #11#49;
          |FINSI;
          nNume1 = #11#39 - #11#62 + #11#117 + #11#130 + #11#132;
          nNume1 = nNume1 ! 2;
          |SI dcofi_1 = 0; |Y nNume1 > 0;
               nIncid = 17;
               |HAZ graba_inc;
          |FINSI;

          |GRABA 020#11a;             || ya habia grabado antes para |BUCLELIN

          |SI aParam = "NOMVARCA";
               promE_AUTO = #11#39 / dcoti_0;
               promA_AUTO = (#11#39 - (#11#41 + #11#42)) / dcoti_0;
               |DELINDEX #11;
               |DELINDEX #12;
          |FINSI;
          |LIBERA #11;
          |SI nIncid = 0; |Y runnom ! "nomcalfi";
               nIncid = 999;
               |HAZ graba_inc;
          |FINSI;
          |SI aParam ! "AUTO"; |Y aParam ! "AUTOCONREG";|Y aParam ! "NOMVARCA";
          |Y runnom ! "nomcalir"; |Y runnom ! "nomcalfi";
          |Y runnom ! "nomcalf1"; |Y runnom ! "nomcalf2"; |Y runnom ! "nomautom";
               |HAZ Auxiliar;

               enMes = #0#8; enAny = #0#9;
               |HAZ CompBases;
               ||HAZ GrabaBases;        || 25.01.2018 -> desde CEC, ya no mas
               |HAZ RedFunc2010_Fin;   || 14.11.2018 -> lo quito, ya es hora

               nTip = #nomcalca#3;

               devenga = nIngresos + nIngresosPag;
               deducir = nDeducc + nDeduccPag;
               liquipag = devenga - deducir;

               |HAZ GrabaNompag;
               |SI #nomcalca#16 > 0;
                    |SI swbaja ! 1; |Y #labempre#25 ! 2;
                         nTip = #nomcalca#3 + 10;
                         |HAZ GrabaNompag;
                    |FINSI;
               |FINSI;
               |HAZ BuscaModulo;
               |SI swModulo = 2884; |O swModulo = 1;
                    |SI swbaja = 1;
                         |HAZ GrabaFiniqCero;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

||****************************************************************************
||            RUTINAS GENERALES ESPECIFICAS O COMUNES A CALCULOS
||****************************************************************************

|PROCESO recarga;   || recarga campos de las lineas del nomcalli
    #12#00 = #02#00;   || codigo empresa
    #12#01 = #02#01;   || codigo trabajador
    #12#02 = #00#08;   || mes
    #12#03 =      0;   || tipo
    #12#05 = #10#03;   || calculo alfa
|SI #12#05 = "Z";
        #12#05 = "F";
    |SI #labtraba#42 = "M";|O #labtraba#42 = "X";|O es_irregul = 1; #12#05 = "F"; |FINSI;
    |SI #labtraba#42 = "D";|O #labtraba#42 = "T";                   #12#05 = "M"; |FINSI;
|FINSI;
    #12#06 = #10#04;   || calculo nume
    #12#07 = #10#05;   || situacion
    #12#08 = #10#06;   || descripcion
    #12#11 =      0;   || unidades calculo
|FPRC;

|PROCESO coefi;     || CALCULA EN 'dcofi_999' COEFICIENTE SEGUN LINEA CALCULO
     concepto = #12#4;
     unidades = #12#9;
     |HAZ convenio;      || lee el concepto del convenio para recoger vacaciones
     |SI #12#5 = "M"; #12#9 = dia_4;  |FINSI;  || si es 'M' le pone dias cotizables
     |SI #12#5 = "D";
          |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
               |SI concepto ! 903; #12#9 = dia_4; |FINSI;
          |SINO;
                #12#9 = dia_2;  || si es 'D' le pone dias del mes
          |FINSI;
     |FINSI;
     |SI concepto = 908; |Y #nomconca#164 = "S";
          #12#5 = "F"; #12#6 = 1;
          |HAZ Excep908;
     |FINSI;
     |SI #12#6 = 0;  dcofi_999 = 1;         |FINSI;
     |SI #12#6 = 1;  dcofi_999 = dcofi_1;   |FINSI;   || dias cobro
     |SI #12#6 = 1;  dcofi_999A = dcofi_1A;   |FINSI;   || dias cobro
     |SI #12#6 = 2;  dcofi_999 = dcofi_2;   |FINSI;   || dias cotizables
     |SI #12#6 = 1; |Y #labtraba#42 = "D"; |Y #labtraba#64 = "M";
          |SI #12#5 = "F"; |O #12#5 = "V";
               |SI #12#6 = 1;  dcofi_999 = dcobr_0 / dia_2;   |FINSI;
          |FINSI;
     |FINSI;
     |SI #10#7 = "N"; || no entra en vacaciones
          |SI #12#5 ! "V";    || en los "V" no entra lo de Vacaciones "N"
               |SI #12#6 = 0;       || 'N0'
                    |SI dvaca_2 ! 0;  dcofi_999 = 0;  |SINO;  dcofi_999 = 1;  |FINSI;
               |FINSI;
               |SI #12#6 = 1;       || 'N1'
                    dcofi_999 = dcofi_5;
                    |SI #nomcontr#47 = "C"; |Y dabse_2 ! 0;
                         dcofi_999 = dcofi_1;     || dias cobro
                         dcofi_999A = dcofi_1A;    || OJO caso de que haya vac. no funcionaria bien
                    |FINSI;
               |FINSI;
               |SI #12#6 = 2;       || 'N2'
                    dcofi_999 = dcofi_7;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #10#7 = "E";|Y #12#5 ! "V";         || solo entra en vacaciones
          |SI #12#6 = 0;                      || 'E0'
               |SI dvaca_2 = 0;  dcofi_999 = 0;  |SINO;  dcofi_999 = 1;  |FINSI;
          |FINSI;
          |SI #12#6 = 1;|O #12#6 = 2;         || 'E1' / 'E2'
               dcofi_999 = dcofi_6;
               dcofi_999A = dcofi_6;    || OJO caso de que haya vac. no funcionaria bien
          |FINSI;
     |FINSI;
     |SI #12#5 = "L";         || dias laborables
          |SI #10#7 = "S";
                             #12#9 = conser1;
               |SI #12#6 = 1;  #12#9 = dlabo_0;  |FINSI;
               |SI #12#6 = 2;  #12#9 = dlabi_0;  |FINSI;
          |FINSI;
          |SI #10#7 = "N";    #12#9 = vlabo_0;  |FINSI;      || vac. no
          |SI #10#7 = "E";    #12#9 = dvaca_1;  |FINSI;      || solo vac.

          |SI ddese_3 > 0;
               #12#9 = #12#9 + ajuste7;
          |FINSI;
     |FINSI;
     |SI #12#5 = "K";         || dias festivos
         |SI #10#7 = "S";
             ||SI #12#6 = 0;  #12#9 = conser2;  |FINSI;
                             #12#9 = conser2;
             |SI #12#6 = 1;  #12#9 = dlabo_k;  |FINSI;
             |SI #12#6 = 2;  #12#9 = dlabi_k;  |FINSI;
         |FINSI;
         |SI #10#7 = "N";    #12#9 = vlabo_k;  |FINSI;      || vac. no
         |SI #10#7 = "E";    #12#9 = dvaca_k;  |FINSI;      || solo vac.
     |FINSI;
     |SI #12#5 = "E";         || dias laborables
          |HAZ CalenConcep;
          conser3 = 0; conser4 = 0;
          |HAZ calendar;

          |SI #10#7 ! "E";
               #12#9 = conser3;
               |SI #12#6 = 1;  #12#9 = dialabo - ajuste5 - ajuste6;  |FINSI;
               |SI #12#6 = 2;  #12#9 = dialabo - ajuste5 - ajuste6;  |FINSI;
               |SI #10#7 = "N";    #12#9 = #12#9 - dvaca_1;          |FINSI;      || vac. no
          |SINO;
               |SI #10#7 = "E";    #12#9 = dvaca_1;          |FINSI;      || solo vac.
          |FINSI;
          |SI #nomcontr#47 ! "C";
               #12#9 = #12#9 - (dabse_2 - dabse_k);    || me faltaba quitar los absentismos
          |FINSI;
          |SI ddese_3 > 0;
               #12#9 = #12#9 + ajuste7;
          |FINSI;
     |FINSI;
     |SI #12#5 = "L"; |O #12#5 = "K"; |O #12#5 = "E";
          dcofi_999 = 1;
     |FINSI;
     |SI #labempre#137 = "1";
          |SI #12#5 = "L"; |O #12#5 = "E";
               |SI #12#9 > dcobr_0;
                    #12#9 = dcobr_0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cal_vaca;
     |SI #10#2 < 499;
     |Y #10#2 ! 410; |Y #10#2 ! 415;
          |SI #10#7 = "S";|O #10#7 = "E";   || si entra en vacaciones
               |HAZ el_divide;
               product = #12#09 * #12#10;
               product = product ! EURODB;
               |SI #10#3 = "L"; |O #10#3 = "E";
                    product = #10#14 * #12#10;
               |FINSI;
               dacum_vac = dacum_vac + (product / divide);
          |FINSI;
     |FINSI;
|FPRC;

||***************************************************************************
||   CALCULO DE LECTURA DE EMPRESA,CALENDARIO,CONSTANTES,BONIFICACIONES,ETC.
||****************************************************************************

|PROCESO calleer;
     |DDEFECTO #1;
     |ABRE #1;
         #1#0 = #11#0;
     |LEE 000#1=;         || lee la empresa
     |CIERRA #1;
     |SI CodigoCons = 0;
          CodigoCons = #1#32;
     |FINSI;

         |ABRE #20;                || lee el calendario
         |DDEFECTO #20;
             #20#0  = #2#156;
             #20#13 = #0#9;
         |LEE 000#20=;
             topemes1 = 0;
             topemes2 = 0;    || calcula los dias laborables del mes
             swmarca = "A";
         |HAZ FiestaAct;
         swConcep = 0;
         |HAZ calendar;
             conser1 = dialabo;    || guarda los dias laborables del mes
             conser2 = diafest;    || guarda los dias festivos del mes
         |CIERRA #20;

     |DDEFECTO #36;
     |ABRE #36;
         #36#0 = #2#0;
         #36#1 = #2#77;
     |LEE 000#36=;            || deducciones de notarias y ayuntamientos
     |CIERRA #36;
     nCConst = #labtraba#248;
     |HAZ constante;
     |SI #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
          es_aprendi = 1;
     |FINSI;

     |SI aCError ! "";
          nIncid = 3;
          |HAZ graba_inc;
     |FINSI;
     nRecAy = #15#74;
     |SI #36#5 = "N";    nRecAy = 0;    |FINSI;
     |SI nElAny [ 2018;
         nEl36 = 36;
     |SINO;
         nEl36 = 40;
     |FINSI;
     |SI #2#112 ! "S";   nEl36 = 0;     |FINSI;
     |SI nElAny = 2017; |Y nElMes [ 6; #15#76 = 532.51; |FINSI;
         topesmi = (#15#76 % 20) ! EURODB;
         por1_cont = #15#07;                             || (%) contigen.(tra.)
         |SI #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
              por1_hor1 = #15#09;                             || (%) horas 1  (tra.)
              por1_hor2 = #15#11;                             || (%) horas 2  (tra.)
         |SINO;
              por1_hor1 = 0;                             || (%) horas 1  (tra.)
              por1_hor2 = 0;                             || (%) horas 2  (tra.)
         |FINSI;
         por1_dfpg = #15#13 + #15#15 + #15#17 + #15#19;  || (%) d+f+p+g  (tra.)
         por1_des = #15#13; por1_fp= #15#17; || ccc
         por2_cont = #15#06;                            || (%) contigen.(emp.)
         |SI #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
              por2_hor1 = #15#08;                             || (%) horas 1  (emp.)
              por2_hor2 = #15#10;                             || (%) horas 2  (emp.)
         |SINO;
              por2_hor1 = 0;                                  || (%) horas 1  (emp.)
              por2_hor2 = 0;                                  || (%) horas 2  (emp.)
         |FINSI;
         por2_dfpg = #15#12 + #15#14 + #15#16 + #15#18;  || (%) d+f+p+g  (emp.)
         por2_des = #15#12; por2_fog = #15#14; por2_fp = #15#16; || ccc

     |SI #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
             por1_hor1 = por1_hor1 + por1_dfpg;         || (%) horas 1 (aprend)
             por1_hor2 = por1_hor2 + por1_dfpg;         || (%) horas 2 (aprend)
     |FINSI;
         por1_cont = por1_cont ! 2;
         por2_cont = por2_cont ! 2;
         notaria = #36#2;
     |SI #labtraba#42 = "L";
             por1_cont = por1_cont - #36#4;       || (%) deduccion ayuntamientos
             notaria = 0;
     |FINSI;
          |ABRE #16;
          |DDEFECTO #16;
          #16#0 = #2#39;
          |LEE 000#16=;            || lee bonificacion
          |SI FSalida = 0;
               nCodigoBon = #16#0;
               nMes = #0#8;
               nAny = #0#9;
               |HAZ VerifBonif;
               |SI swAgosto2012 = 1; |Y #nombonif#27 = "N";
                   |DDEFECTO #16;
               |FINSI;
          |FINSI;
          |CIERRA #16;
          |SI #16#10 = 4;
                  por1_dfpg = 0;  || (%) d+f+p+g  (tra.)
                  por2_dfpg = 0;  || (%) d+f+p+g  (emp.)
                  por1_des = 0; por1_fp = 0;
                  por2_des = 0; por2_fog = 0; por2_fp = 0;
          |FINSI;
     |SI #0#9 ] 2007;
          |HAZ VerifCNAE;
     |SINO;
          nEpigConv = #2#32;
     |FINSI;
     |NOME_DAT #17 aTempEpig;
     |ABRE #17;
     |DDEFECTO #17;
         #17#0  = nEpigConv;
     |LEE 000#17=;            || lee epigrafe
         epig_ilt = #17#1;
         epig_ims = #17#2;
     |CIERRA #17;

          |SI #0#9 [ 2006;
               |HAZ EpiTrab;
          |FINSI;

     || lee control de aplicacion
     |DDEFECTO #32; |ABRE #32; |LEE 101#32p; |LIBERA #32; |CIERRA #32;
     #nomcontr#17 = 3; #nomcontr#18 = 3; #nomcontr#61 = 1; || se acabo, para TODOS
     |HAZ Varios1;

     |DDEFECTO #nomcontq;
     |ABRE #nomcontq; |LEE 000#nomcontq.p; |CIERRA #nomcontq;
|FPRC;

||****************************************************************************
||                        RUTINAS DEL CALCULO DE DIAS
||****************************************************************************

|PROCESO calendar;                 || CALCULA LOS DIAS LABORABLES
     nume1 = #0#8;
     meslabo = #20nume1;
     |SI swConcep = 1;
          meslabo = aCalenConcep;
     |FINSI;
     dialabo = 0;
     diafest = 0;
     |SI topemes1 = 0; topemes1 = 1;      |FINSI;
     |SI topemes2 = 0; topemes2 = guarda; |FINSI;
     |PARA mid = topemes1; |SI mid [ topemes2; |HACIENDO mid = mid + 1;
          nume1 = (mid * 100) + 1;
          alfa1 = meslabo % nume1;
          |SI mid = nDiaAct1; |O mid = nDiaAct2; |O mid = nDiaAct3; |O mid = nDiaAct4;
           |O mid = nDiaAct5; |O mid = nDiaAct6; |O mid = nDiaAct7; |O mid = nDiaAct8;
               alfa1 = "1";
          |FINSI;
          |SI alfa1 = "0";
               dialabo = dialabo + 1;     || cuenta dias laborables
          |SINO;
               diafest = diafest + 1;     || cuenta dias festivos
          |FINSI;
          |SI swmarca ! "A";                 || construye las variaciones en variab.
               alfa1 = histori % 0;  nume0 = alfa1;         || longitud
               nume1 = (100 + (mid - 1));                   || parte izquierda
               alfa1 = histori % nume1;
               nume2 = (100 + (nume0 - mid)) * (-1);        || parte derecha
               alfa2 = histori % nume2;
               histori = alfa1 + swmarca + alfa2;           || une
               |SI swmarca ! "B";
                    alfa1 = histori2 % 0;  nume0 = alfa1;    || longitud
                    nume1 = (100 + (mid - 1));              || parte izquierda
                    alfa1 = histori2 % nume1;
                    nume2 = (100 + (nume0 - mid)) * (-1);   || parte derecha
                    alfa2 = histori2 % nume2;
                    |SI swmarca = "D";
                         nume1 = (mid * 100) + 1;
                         alfa8 = histori2 % nume1;
                         |SI alfa8 = "I"; |O alfa8 = "J"; |O alfa8 = "M";
                              || ojo, accidente, enf, o mat/pat a TP
                              || no cambio la incidencia
                         |SINO;
                              histori2 = alfa1 + swmarca + alfa2;           || une
                         |FINSI;
                    |SINO;
                         histori2 = alfa1 + swmarca + alfa2;           || une
                    |FINSI;
               |FINSI;

               || calendario teniendo en cuenta los dias de ERE
               alfa1 = histori3 % 0;  nume0 = alfa1;        || longitud
               nume1 = (100 + (mid - 1));                   || parte izquierda
               alfa1 = histori3 % nume1;
               nume2 = (100 + (nume0 - mid)) * (-1);        || parte derecha
               alfa2 = histori3 % nume2;
               |SI #7campos = "D";
                    |SI #7camprop ! 100; |Y #7camprop ! 0;
                         histori3 = alfa1 + "d" + alfa2;          || une
                    |SINO;
                         histori3 = alfa1 + "D" + alfa2;          || une
                    |FINSI;
               |SINO;
                    || para que pueda haber IT y ERE a TP
                    |SI swmarca ! "I"; |Y swmarca ! "J"; |Y swmarca ! "M";
                         histori3 = alfa1 + swmarca + alfa2;          || une
                    |FINSI;
               |FINSI;
          |FINSI;
          nume1 = (mid * 100) + 1;
          alfa1 = meslabo % nume1;
          alfa2 = histori % nume1;
          |SI swConcep = 1; |O swConcep = 2;
               |SI swConcep = 2;
                    |SI alfa1 = "0";
                         |SI alfa2 = "B"; |O alfa2 = "M"; || los dias que siendo labora-
                              ajuste6 = ajuste6 + 1;      || bles el trab. no es alta
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI swConcep = 1;
                    |SI mid = nDiaAct1; |O mid = nDiaAct2; |O mid = nDiaAct3;
                     |O mid = nDiaAct4; |O mid = nDiaAct5; |O mid = nDiaAct6;
                     |O mid = nDiaAct7; |O mid = nDiaAct8;
                         alfa1 = "1";
                    |FINSI;
                    |SI alfa2 = "A";
                         |SI alfa1 = "0";
                              conser3 = conser3 + 1;
                         |SINO;
                              conser4 = conser4 + 1;
                         |FINSI;
                    |FINSI;
                    |SI alfa1 = "0";
                         |SI alfa2 = "B"; |O alfa2 = "M";   || dias laborables que
                              ajuste6 = ajuste6 + 1;        || el trab. no es alta
                         |FINSI;
                    |FINSI;
                    |SI alfa2 ! "A"; |Y alfa2 ! "B"; |Y alfa2 ! "M";
                    |Y alfa1 = "0";
                         |SI alfa2 ! "K";
                              ajuste5 = ajuste5 + 1; || los dias laborables enfermo
                                            || segun calendario del concepto
                         || el absentismo lo trato aparte que si no aqui es un lio
                         || y no puedo controlar bien los dias que no esta completo
                         || de absentismo
                         || vuelvo a tener en cuenta aqui el absentismo 19.12.2006
                         || que si lo hago despues provoco desajustes, ya veremos
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO altas;
    swalta = 0;
    fecalf = #2#36;
    dalta_3 = 1;
|HAZ desglosa;
|SI mes = #0#8; |Y any = #0#9;     || si es alta este mes
        swalta = 1;
        topemes1 = 0;
        topemes2 = dia - 1;
        dialabo = 0;
        diafest = 0;
    |SI topemes2 ! 0;
         |HAZ FiestaAct;
         swConcep = 0;
         |HAZ calendar;
    |FINSI;  || por si es alta el dia 1
        dalta_k = diafest;         || dias festivos antes del alta
        dalta_1 = dialabo;         || dias laborables antes del alta
        dalta_2 = dia - 1;         || dias cotizables antes del alta
        dalta_3 = dia;             || dia que es alta
|FINSI;
|FPRC;

|PROCESO bajas;
     swbaja = 0;
     dbaja_3 = dia_2;
     fecbaj = #2#37;
     |SI #7#16 ! "..........";|Y #7#16 ! "          ";
          fecbaj = #7#16;
     |FINSI;
     nDiasAltaInt = 0;
     |QBF fecbaj;
     |SI #labtraba#42 ! "I"; |Y fecbaj = "";
          |HAZ IntervalosAlta;
          |SI nDiasAltaInt ! 0;
               nNume1 = fCFecha;
               nNume1 = nNume1 + nDiasAltaInt - 1;
               fFecha = nNume1;
               fecbaj = fFecha;
          |FINSI;
     |FINSI;
     |SI swDiosMio = 1;
          |ACABA;
     |FINSI;
     fecalf = fecbaj;
     |HAZ desglosa;
     |SI mes = #0#8; |Y any = #0#9;     || si es baja este mes
          swbaja = 1;
          topemes1 = dia + 1;
          topemes2 = 0;
          dialabo = 0;
          diafest = 0;
          |SI topemes1 [ guarda;
               |HAZ FiestaAct;
               swConcep = 0;
               |HAZ calendar;
          |FINSI;  || por si es final de mes
          dbaja_k = diafest;         || dias festivos despues de la baja
          dbaja_1 = dialabo;         || dias laborables despues de la baja
          dbaja_2 = dia_2 - dia;     || dias cotizables despues de la baja
          dbaja_3 = dia;             || dia hasta el que trabaja
     |FINSI;
     |SI swbaja = 1; |Y runnom = "nomcalf2"; |Y #1#39 ! 1; |Y #2#48 = "S";
          alfa1 = #2#0; alfa1 = "00000" + alfa1; alfa1 = alfa1 % -105;
          alfa2 = #2#1; alfa2 = "00000" + alfa2; alfa2 = alfa2 % -105;

          aAlfa = "    ATENCION: Trabajador " + alfa1 + "." + alfa2;
          aAlfa = aAlfa + " es baja este mes.";
          |MENAV aAlfa;
          aAlfa = "    Tendra que actualizar la nomina para calcular el finiquito aparte.";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO huelga;
     dhuel_k = dhuel_k + diafest;   || dias festivos que esta en huelga
     dhuel_1 = dhuel_1 + dialabo;   || dias laborables que esta en huelga
     |SI #nomabsli#7 ! 0;
          #7#22 = #nomabsli#7;
     |FINSI;
     |SI dhuel_2 = 0;
          dhuel_2 = #7#22 / 100;     || parte decimal
     |FINSI;
     dhuel_2 = dhuel_2 + dias_v;    || dias huelga
     dhuel_3 = dhuel_3 + dias_v;    || dias huelga(sin decim.)
     #nomabsli#5 = "S";
     |SI #nomabsli#5 = "S";
          #7#25 = "S";
     |SINO;
          #7#25 = "N";
     |FINSI;
|FPRC;

|PROCESO desemp;
     ddese_k = ddese_k + diafest;   || dias festivos que esta en desemp.
     ddese_1 = ddese_1 + dialabo;   || dias laborables que esta en desemp.
     |SI ddese_2 = 0;
          ddese_2 = #7#27 / 100;     || parte decimal
     |FINSI;

     swBuscaDupliERE = 1;
     |HAZ BuscaOtroAlta;
     swBuscaDupliERE = 0;

     nNume1 = ((dias_v * #7camprop) / 100) ! 2;
     ddese_reales = ddese_reales + nNume1;    || dias desemp. REALES
     |SI swAjusteIT = nLineaIT; |O swAjusteIT2 = nLineaIT;
          |HAZ NuevoAjuste;
          swAjusteD = swNuevoAju;
     |FINSI;

     nNume1 = ((dias_v * #7camprop) / 100) ! 2;
     ddese_2 = ddese_2 + nNume1;    || dias desemp.
     |SI #7camprop ! 100;
          ddese_3 = ddese_3 + (dias_v - nNume1);
          ddese_4 = ddese_4 + nNume1; || lo que le falta para llegar a los dias totales
     |FINSI;
|FPRC;

|PROCESO absent;
     dabse_k = dabse_k + diafest;   || dias festivos que esta absento
     dabse_1 = dabse_1 + dialabo;   || dias laborables que esta absento

     dabse_2 = dabse_2 + dias_v;    || dias absentismo
     #nomabsli#5 = "S";
     |SI #nomabsli#5 = "S";
          dabse_3 = dabse_3 + dias_v;     || dias abs.(sin decim.para pagas)
          || #7#26 = "S";
     |FINSI;
|FPRC;

|PROCESO permis;
     dperm_k = dperm_k + diafest;   || dias festivos que esta de permiso
     dperm_1 = dperm_1 + dialabo;   || dias laborables que esta de permiso

     dperm_2 = dperm_2 + dias_v;    || dias de permiso
|FPRC;

|PROCESO accide;
     dacci_0 = #2#92;
     dacci_k = dacci_k + diafest;     || dias festivos que esta accidentado
     dacci_1 = dacci_1 + dialabo;     || dias laborables que esta accidentado
     dacci_2 = dacci_2 + dias_v;      || dias cotizables que idem
     nume1 = campos + 23;
     |SI #7nume1 = "S";
          |SI campos = 12; dreca_1 = #7#43 + nAcumRecMes1; |FINSI;
          |SI campos = 13; dreca_2 = #7#43 + nAcumRecMes2; |FINSI;
          |SI campos = 14; dreca_3 = #7#43 + nAcumRecMes3; |FINSI;
          |SI campos = 15; dreca_4 = #7#43 + nAcumRecMes4; |FINSI;
     |FINSI;
     nPasoIT = 1; |HAZ RegistroIT;

     nume1 = topemes2 - topemes1 + 1;

     |SI campos = 12;  dacci_21 = nume1;  nume1 = 0;  |FINSI;
     |SI campos = 13;  dacci_22 = nume1;  nume1 = 0;  |FINSI;
     |SI campos = 14;  dacci_23 = nume1;  nume1 = 0;  |FINSI;
     |SI campos = 15;  dacci_24 = nume1;  nume1 = 0;  |FINSI;
|FPRC;

|PROCESO enferm;
     |SI #2#60 = "E";         || arrastra los meses anteriores si es misma clave
          denfe_0 = #2#89;
     |FINSI;
     nume1 = campos + 23;
     |SI #7nume1 = "S";
          |SI campos = 12; dreca_1 = #7#43 + nAcumRecMes1; |FINSI;
          |SI campos = 13; dreca_2 = #7#43 + nAcumRecMes2; |FINSI;
          |SI campos = 14; dreca_3 = #7#43 + nAcumRecMes3; |FINSI;
          |SI campos = 15; dreca_4 = #7#43 + nAcumRecMes4; |FINSI;
     |FINSI;

     denfe_k = denfe_k + diafest;     || dias festivos que esta enfermo
     denfe_1 = denfe_1 + dialabo;     || dias laborables que esta enfermo
     nume1 = topemes2 - topemes1 + 1;

     |SI campos = 12;  denfe_21 = nume1;  nume1 = 0;  |FINSI;
     |SI campos = 13;  denfe_22 = nume1;  nume1 = 0;  |FINSI;
     |SI campos = 14;  denfe_23 = nume1;  nume1 = 0;  |FINSI;
     |SI campos = 15;  denfe_24 = nume1;  nume1 = 0;  |FINSI;

     denfe_2 = denfe_2 + dias_v;      || dias cotizables que idem

     nPasoIT = 1; |HAZ RegistroIT;
|FPRC;

|PROCESO matern;
     |SI #2#60 = "M"; |O #2#60 = "P"; |O #2#60 = "R"; |O #2#60 = "C";  || arrastra los meses anteriores si es misma clave
          dmate_0 = #2#89;
     |FINSI;
     dmate_k = dmate_k + diafest;     || dias festivos que esta pariendo
     dmate_1 = dmate_1 + dialabo;     || dias laborables que esta pariendo
     dmate_2 = dmate_2 + dias_v;      || dias cotiz. que idem

     sw_mater = 0;
     m_dias = dmate_0 + dmate_2;

     alfa1 = topemes2;    alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
     alfa2 = #0#8;        alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = alfa1 + "." + alfa2 + "." + #0#9;
     fech1 = alfa3;            nume1 = fech1;
     fech2 = "01.01.1995";     nume2 = fech2;
     nume3 = nume1 - nume2 + 1;

     |SI m_dias [ nume3; sw_mater = 1;  |FINSI;
     |SI #0#8 ] 6;  sw_mater = 1;  |FINSI;

     |SI #7campos = "R";
          dries_2 = dries_2 + dias_v;      || dias naturales en riesgo
     |FINSI;
     |SI #7campos = "C";
          dcont_2 = dcont_2 + dias_v;      || dias naturales en IT control SS
          nPasoIT = 1;
          |HAZ RegistroIT;
     |FINSI;
     |SI #7campos = "P";
          dpate_2 = dpate_2 + dias_v;      || dias naturales en paternidad
     |FINSI;
|FPRC;

|PROCESO vacaci;
    dvaca_k = dvaca_k + diafest;   || dias festivos de vacaci.
    dvaca_1 = dvaca_1 + dialabo;   || dias laborables de vacaci.
|SI dvaca_2 = 0;
        dvaca_2 = #7#24 / 100;     || parte decimal
|FINSI;
    dvaca_2 = dvaca_2 + dias_v;    || dias cotiz. de vacaci.
|FPRC;

|PROCESO diasacc0;  || DESGLOSA LOS DIAS DE ACCIDENTE
     |SI #labtraba#247 = 138; |HAZ diasacc0_138; |ACABA; |FINSI;
     dacci_X0 = 0;
     dacci_X2 = 0;
     |PARA para1 = 1; |SI para1 [ 4; |HACIENDO para1 = para1 + 1;
          swSigue = 0;
          |SI para1 = 1; swSigue = 1;;  |FINSI;
          |SI para1 = 2; |Y #nomvarca#12 = "D"; swSigue = 1; |FINSI;
          |SI swSigue = 1;  nume1 = dacci_21 + dacci_0;  |FINSI;
          |SI para1 = 2;  nume1 = dacci_22;            |FINSI;
          |SI para1 = 3;  nume1 = dacci_23;            |FINSI;
          |SI para1 = 4;  nume1 = dacci_24;            |FINSI;
          |SI nume1 ! 0;
               dacci_X0 = nume1;                             || al 75% para informe
               dacci_X2 = dacci_X2 + nume1;                  || al 75% para prestacion
               |SI para1 = 1; |Y dacci_0 > 0;
                    dacci_X0 = dacci_X0 - dacci_0;
                    dacci_X2 = dacci_X2 - dacci_0;
               |FINSI;
               |HAZ DiasBaseIT2;
               nPasoIT = 2; |HAZ RegistroIT;
          |FINSI;
     |SIGUE;
     |SI nDesAcc ! 0; |Y dacci_X2 ! 0;
          dacci_X2 = dacci_X2 - (nDesAcc * nPropDesTP / 100);
     |FINSI;
|FPRC;

|PROCESO diasenf0;  || DESGLOSA LOS DIAS DE ENFERMEDAD
     |SI #labtraba#247 = 138; |HAZ diasenf0_138; |ACABA; |FINSI;
     |PARA para1 = 1; |SI para1 [ 4; |HACIENDO para1 = para1 + 1;
          denfe_A0 = 0;
          denfe_B0 = 0;         || acumuladores parciales
          denfe_C0 = 0;
          denfe_D0 = 0;
          |SI para1 = 1;  nume1 = denfe_21 + denfe_0 + dreca_1;  |FINSI;
          |SI para1 = 2;  nume1 = denfe_22 + dreca_2;            |FINSI;    || dias enfermo
          |SI para1 = 3;  nume1 = denfe_23 + dreca_3;            |FINSI;
          |SI para1 = 4;  nume1 = denfe_24 + dreca_4;            |FINSI;
          |SI #nomvarca#12 = "D"; |Y para1 = 2; nume1 = nume1 + denfe_0; |FINSI;
          |SI #nomvarca#12 = "D"; |Y #nomvarca#13 ! "E"; |Y para1 = 3; nume1 = nume1 + denfe_0; |FINSI;
          |SI #nomvarca#12 = "D"; |Y #nomvarca#13 ! "E"; |Y #nomvarca#14 ! "E";
               |SI para1 = 4; nume1 = nume1 + denfe_0; |FINSI;
          |FINSI;
          |SI nume1 ! 0;
               |SI nume1 ] 3;
                    denfe_A0 = 3;     nume1 = nume1 - 3;       || al  0%
               |SINO;
                    denfe_A0 = nume1; nume1 = 0;
               |FINSI;
               |SI nume1 ] 12;
                    denfe_D0 = 12;    nume1 = nume1 - 12;      || al 60% (empresario)
               |SINO;
                    denfe_D0 = nume1; nume1 = 0;
               |FINSI;
               |SI nume1 ] 5;
                    denfe_B0 = 5;     nume1 = nume1 - 5;       || al 60% (seg.social)
               |SINO;
                    denfe_B0 = nume1; nume1 = 0;
               |FINSI;
               |SI nume1 ] 1;
                    denfe_C0 = nume1;                          || al 75%
               |SINO;
                    denfe_C0 = nume1; nume1 = 0;
               |FINSI;

               |SI para1 = 1;  nume1 = denfe_21;            |FINSI;
               |SI para1 = 2;  nume1 = denfe_22;            |FINSI;    || dias enfermo
               |SI para1 = 3;  nume1 = denfe_23;            |FINSI;
               |SI para1 = 4;  nume1 = denfe_24;            |FINSI;
               |SI denfe_C0 > nume1;
                    denfe_A0 = 0;
                    denfe_D0 = 0;
                    denfe_B0 = 0;
                    denfe_C0 = nume1;
               |SINO;
                    nume1 = nume1 - denfe_C0;
               |FINSI;
               |SI denfe_B0 > nume1;
                    denfe_A0 = 0;
                    denfe_D0 = 0;
                    denfe_B0 = nume1;
               |SINO;
                    nume1 = nume1 - denfe_B0;
               |FINSI;
               |SI denfe_D0 > nume1;
                    denfe_A0 = 0;
                    denfe_D0 = nume1;
               |SINO;
                    nume1 = nume1 - denfe_D0;
               |FINSI;
               |SI denfe_A0 > nume1;
                    denfe_A0 = nume1;
               |FINSI;

               denfe_A = denfe_A + denfe_A0;
               denfe_B = denfe_B + denfe_B0;
               denfe_C = denfe_C + denfe_C0;
               denfe_D = denfe_D + denfe_D0;

               |HAZ DiasBaseIT2;

               nPasoIT = 2; |HAZ RegistroIT;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO bonif;
          fecalf = #2#40; |HAZ desglosa; || desglosa fecha alta bonificacion
          diaalt = dia;     mesalt = mes;          anyalt = any;
          totalt = (anyalt * 100) + mesalt;

          fecalf = #2#41; |HAZ desglosa; || desglosa fecha vto. bonificacion
          diaven = dia;     mesven = mes;          anyven = any;
          totven = (anyven * 100) + mesven;

          alfa1 = #0#9;     alfa1 = alfa1 % -104;  nume1 = alfa1;
          totact = (nume1 * 100) + #0#8;

          nPorBon1 = #16#3;
          nPorBon2 = 0;
          |SI totven = 0;
               totven = totalt;
               |HAZ VtoBonif;
               diaven = diaalt;
               mesven = totven $ 100;
               anyven = (totven - mesven) / 100;

               alfa1 = diaven;  alfa1 = ("00" + alfa1) % -102;
               alfa2 = mesven;  alfa2 = ("00" + alfa2) % -102;
               alfa3 = anyven;

               alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

               fech1 = alfa4;
               nume1 = fech1;  nume1 = nume1 - 1;  fech1 = nume1;

               fecalf = fech1; |HAZ desglosa;
               diaven = dia;   mesven = mes;  anyven = any;
         |FINSI;
         aFecBajaBon = fecalf;
         dboni_1 = 0;    || dias de bonificacion
         dboni_2 = 0;    || dias de no bonificacion

     |SI totalt [ totact;|Y totven ] totact; || si esta vigente
         |SI dcoti_0 > dia_4;      || CITRICOS CON COEFICIENTE
                 dboni_1 = dcoti_0;
                 dboni_2 = 0;
         |SINO;
                 dboni_1 = dia_4;
                 dboni_2 = dcoti_0 - dboni_1;
         |FINSI;
     |FINSI;
     |SI totact = totalt;|Y totven ! totact; || si es alta este mes
          |SI dcoti_0 > guarda_dia_4;      || CITRICOS CON COEFICIENTE
               dboni_1 = (dcoti_0 - diaalt) + 1;
               dboni_2 = 0;
          |SINO;
               dboni_1 = (guarda_dia_4 - diaalt) + 1;
               |SI dboni_1 = dmate_1;   || maternidad que empieza el mismo dia que
                    dboni_1 = dboni_1 - swAjuste3;     || vence la bonif
               |FINSI;                  || si hay ajuste tengo que aplicarlo ahi
               dboni_2 = dcoti_0 - dboni_1;
          |FINSI;
     |FINSI;
     |SI totact ! totalt;|Y totven = totact; || si es baja este mes
          dboni_1 = diaven;
          || no es lo suyo, pero es una manera de controlarlo en maternidad
          || que es el caso mas comun
          |SI dboni_1 = dmate_1;   || maternidad que acaba en mismo dia que
               dboni_1 = dboni_1 - swAjuste3;     || vence la bonif
          |FINSI;                  || si hay ajuste tengo que aplicarlo ahi
          dboni_2 = dcoti_0 - dboni_1;
     |FINSI;
     |SI totact = totalt;|Y totven = totact; || si es alta y baja este mes
             dboni_1 = diaven - diaalt + 1;
             dboni_2 = dcoti_0 - dboni_1;
     |FINSI;

     |SI dboni_1 < 0;  dboni_1 = 0;  |FINSI;
     |SI dboni_2 < 0;  dboni_2 = 0;  |FINSI;

     || en desempleo no hago esto porque si no, no sale
     |SI ddese_2 = 0;
          |SI dboni_1 > dcoti_0;   dboni_1 = dcoti_0;  |FINSI;
     |FINSI;
|FPRC;

||****************************************************************************
||                      SUBRUTINAS DEL CALCULO DE DIAS
||****************************************************************************

|PROCESO desglosa;     || DESGLOSA EN DIA, MES Y ANYO UNA FECHA DD.MM.AAAA
    alfa1 = fecalf %  102;   dia = alfa1;
    alfa1 = fecalf %  402;   mes = alfa1;
    alfa1 = fecalf % -104;   any = alfa1;
|SI alfa1 = "....";
        dia = 0;
        mes = 0;
        any = 0;
|FINSI;
|FPRC;

||****************************************************************************
||                CALCULO DEL SALARIO BASE, ANTIGUEDAD Y PLUS
||****************************************************************************

|PROCESO calanti;     || LANZA LOS CALCULOS DE ANTIGUEDAD Y PLUS
|HAZ leetodo;
    duni1_101 = 0;    duni2_101 = 0;    dvalo_101 = 0;
    duni1_102 = 0;    duni2_102 = 0;    dvalo_102 = 0;
    duni1_103 = 0;    duni2_103 = 0;    dvalo_103 = 0;
    danti_0 = 0;      danti_1 = 0;
    nAcumAbs = 0;
|HAZ cal_101;                    || calcula el salario base
|SI #9#2 = 3;                    || (si antig=3, calcula antes el plus !!!)
    |HAZ cal_103;
|FINSI;
|HAZ cal_102;                    || calcula la antiguedad
|SI #9#2 ! 3;                    || calcula los pluses
    |HAZ cal_103;                || (si antig=3, ya habra entrado antes !!!)
|FINSI;
|HAZ gratodo;                    || regraba o graba conceptos 101,102 y 103
|FPRC;

||****************************************************************************
||            RUTINAS DEL CALCULO DEL SALARIO BASE, ANTIGUEDAD Y PLUS
||****************************************************************************

|PROCESO leetodo;    || LEE ANTIG./CATEG., AUX. CONVENIOS Y PTAS. BASE ANTIG.
    |ABRE #13;
    |DDEFECTO #13;
        #13#0 = #2#87;
        #13#1 = #2#17;
    |LEE 000#13=;                 || lee antiguedad/categoria
    |CIERRA #13;
|| ******
    |ABRE #14;
    |DDEFECTO #14;
        #14#0 = #2#87;
    |LEE 000#14=;                 || lee auxiliar de convenios
        aux_conv = FSalida;
    |CIERRA #14;
|| ******
    |ABRE #33;
    |DDEFECTO #33;
        #33#0 = #2#87;
        #33#1 = #2#17;
    |LEE 000#33=;                 || lee ptas. base antiguedad
    |CIERRA #33;
|FPRC;

|PROCESO cal_101;         || CALCULA EL SALARIO BASE
     doce = 101;
     |HAZ leedoce;
     |SI FSalida = 0;
          |HAZ coefi;
          duni1_101 = #12#9;
          duni2_101 = dcofi_999 * duni1_101;
          dvalo_101 = #12#10;
          duni2_101 = duni2_101 ! 6;
          |SI #nomcontr#47 = "C"; |Y dabse_2 ! 0;
               nAcumAbs = nAcumAbs + (((dcofi_999 - dcofi_999A) * duni1_101) ! 6) * #12#10;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cal_102;     || CALCULA LA ANTIGUEDAD
     doce = 102;
     |HAZ leedoce;
     |SI FSalida = 0;
          |HAZ coefi;
          duni1_102 = #12#9;
          dvalo_102 = #12#10;
          |SI #9#2 < 2; |O #labtraba#42 = "L"; |O #labtraba#42 = "N";
               duni2_102 = duni1_102 * dcofi_999;
          |SINO;
               |SI aux_conv ! 0;
                    danti_0 = dvalo_101;         || no existe la tabla
                    |SI #12#5 = "F"; |O #12#5 = "V"; |O #12#5 = "H";
                         danti_1 = duni1_102;     || coge el que viene
                    |FINSI;
               |SINO;
                    |HAZ anyanti;
                    |HAZ poranti;
               |FINSI;
               duni1_102 = danti_1;
               duni2_102 = danti_1 * dcofi_999;
               |SI #9#2 ! 4;
                    |SI #14#95 = 9;                    || si es sobre antig./categ.
                         dvalo_102 = danti_0;       || se inhibe la clave 3 !!!
                    |SINO;
                         dvalo_102 = (duni1_101 * danti_0) /100;
                         |SI #9#2 ! 2;
                              dvalo_102 = dvalo_102 + ((duni1_103*dvalo_103)/100);
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI #12#5 = "F"; |O #12#5 = "V"; |O #12#5 = "H";
                         |SI #12#9 = 0;  #12#9 = 1;  |FINSI;
                    |FINSI;
                    nume1 = #33#03 * #12#9;      || por las unidades segun cpto.
                    dvalo_102 = (nume1/100)*tp;  || 1% de ptas. base antiguedad
               |FINSI;                              ||/proporciona tiempos parcial
          |FINSI;
          dvalo_102 = dvalo_102 * nPropPrac;
          duni2_102 = duni2_102 ! 6;
          |SI #nomcontr#47 = "C"; |Y dabse_2 ! 0;
               nAcumAbs = nAcumAbs + (((dcofi_999 - dcofi_999A) * duni1_102) ! 6) * dvalo_102;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cal_103;       || CALCULA EL PLUS
    doce = 103;
|HAZ leedoce;
|SI FSalida = 0;
        duni1_103 = #12#9;
    |HAZ coefi;
    |SI #9#3 < 2;
            duni1_103 = #12#9;
    |FINSI;
        duni2_103 = duni1_103 * dcofi_999;
        dvalo_103 = #12#10;
    |SI #9#3 = 2;|O #9#3 = 3;
            dvalo_103 = (duni1_101*dvalo_101) /100;    || 1% sal.base
    |FINSI;
    |SI #9#3 = 3;
            dvalo_103 = dvalo_103 + ((duni1_102 *dvalo_102) /100);
    |FINSI;
        duni2_103 = duni2_103 ! 6;   || redondea unid. calculo
     |SI #nomcontr#47 = "C"; |Y dabse_2 ! 0;
           nAcumAbs = nAcumAbs + (((dcofi_999 - dcofi_999A) * duni1_103) ! 6) * #12#10;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO gratodo;     || GRABA O REGRABA CONCEPTOS 101,102 Y 103
    swgracon = 0;     || para que no machaque campos si existe
    swcongra = 0;     || para que no acumule si existe
    graba04 = 101;
    graba09 = duni1_101;
    graba10 = dvalo_101;
    graba11 = duni2_101;
|SI duni1_101 ! 0; |O dvalo_101 ! 0; |O duni2_101 ! 0;
    |HAZ grabacon;
|FINSI;
    graba04 = 102;
    graba09 = duni1_102;
    graba10 = dvalo_102;
    graba11 = duni2_102;
|SI duni1_102 ! 0; |O dvalo_102 ! 0; |O duni2_102 ! 0;
    |HAZ grabacon;
|FINSI;
    graba04 = 103;
    graba09 = duni1_103;
    graba10 = dvalo_103;
    graba11 = duni2_103;
|SI duni1_103 ! 0; |O dvalo_103 ! 0; |O duni2_103 ! 0;
    |HAZ grabacon;
|FINSI;
|FPRC;

||****************************************************************************
||          SUBRUTINAS DEL CALCULO DEL SALARIO BASE, ANTIGUEDAD Y PLUS
||****************************************************************************

|PROCESO anyanti;   || CALCULA LOS A¥OS DE ANTIGUEDAD
     |SI #2#239 = "F";
          |HAZ BuscaModulo;
          |SI swModulo = 002537;
               || si esta en el modulo tiene que hacerlo otra vez para
               || volver a calcular las variables tipo1 al tipo9 por si
               || el convenio tuviera la antiguedad congelada
               |HAZ tipos;
          |FINSI;
          tipox = #14#95;            || tipo de calculo segun aux. convenios
          |SI #14#95 = 9;
               tipox = #13#3;         || tipo de calculo segun antig/categ.
          |FINSI;

          alfa1 = #2#34  % 102;  fanti_d = alfa1;   || meses antiguedad
          alfa2 = #2#34  % 402;  fanti_m = alfa2;   || meses antiguedad
          alfa3 = #2#34  % -104; fanti_a = alfa3;   || anyos antiguedad

          |SI tipox =  0;  fvenci = #2#34;  |FINSI;     || saca vencimiento
          |SI tipox =  1;  fvenci = tipo1;  |FINSI;     ||/segun tipo
          |SI tipox =  2;  fvenci = tipo2;  |FINSI;
          |SI tipox =  3;  fvenci = tipo3;  |FINSI;
          |SI tipox =  4;  fvenci = tipo4;  |FINSI;
          |SI tipox =  5;  fvenci = tipo5;  |FINSI;
          |SI tipox =  6;  fvenci = tipo6;  |FINSI;
          |SI tipox =  7;  fvenci = tipo7;  |FINSI;
          |SI tipox =  8;  fvenci = tipo8;  |FINSI;
          |SI tipox = 10;  fvenci = tipo1;  |FINSI;
          |SI tipox = 11; |Y fanti_m < 7;
               fvenci = tipo7;
          |FINSI;
          |SI tipox = 11; |Y fanti_m > 6;
               fvenci = tipo8;
          |FINSI;

          alfa2 = fvenci % 102;  ganti_m = alfa2;   || meses vencimiento antiguedad
          alfa3 = fvenci % -104; ganti_a = alfa3;   || anyos vencimiento antiguedad

          difer_m = ganti_m - fanti_m;    || diferencia meses
          difer_a = ganti_a - fanti_a;    || diferencia anyos

          |SI difer_m < 0;  difer_a = difer_a - 1;  |FINSI;
          |SI difer_a < 0;  difer_a = 0;            |FINSI;

          anyos = difer_a;

          |SI tipox = 10;
               |HAZ AntigSidero;
               |SI anyos > nLimiteAnys;
                    anyos = nLimiteAnys;
               |FINSI;
          |FINSI;
     |SINO;
          anyos = (#2#240 - (#2#240 $ 365)) / 365;
     |FINSI;
|FPRC;

||****************************************************************************
||            CALCULO DE LAS UNIDADES Y DE LOS ACUMULADOS
||****************************************************************************

|PROCESO calunac;      || LECTURA DE CONCEPTOS
    #11#00 = #02#00;   || empresa
    #11#01 = #02#01;   || trabajador
    #11#02 = #00#08;   || mes
    #11#03 =      0;   || tipo
    |GRABA 020#11n;
|LIBERA #11;
|LEE 101#11=;
    acum_10 = 0;
    acum_11 = 0;
    acum_12 = 0;
    acum_13 = 0;
    acum_30 = 0;
    acum_301 = 0;
    acum_302 = 0;
    acum_303 = 0;
    acum_31 = 0;
    acum_311 = 0;
    acum_312 = 0;
    acum_313 = 0;
    acum_40 = 0;
    acum_401 = 0;
    acum_402 = 0;
    acum_403 = 0;
    acum_41 = 0;    anti_41 = 0;
    acum_50 = 0; acum_51 = 0; acum_52 = 0; acum_53 = 0; acum_54 = 0;
    acum_60 = 0;
    acum_90 = 0;
    horasex = 0;    || horas subvencionadas
    || horasex estaba comentada, no es correcto pues entonces no se inicia
    || y arrastra a los demas
    nHorasTut = 0; nBonifTut = 0;
    vacacio = 30;   || dias vacaciones a¤o (por defecto 30!!!)
    |SI #nomconca#144 = 0;
        |SI #labtraba#126 = "L";
              vacacio = 22;
        |SINO;
              vacacio = 30;
        |FINSI;
    |SINO;
        |SI #labtraba#126 = "L";
             vacacio = #nomconca#161;   || dias vacaciones a¤o LABORABLES
        |SINO;
             vacacio = #nomconca#144;   || dias vacaciones a¤o NATURALES
        |FINSI;
    |FINSI;
    pagavac = -1;   || dias a pagar por vacaciones
    indemni = -1;   || dias indemnizacion al a¤o
    horastp = 0;    || horas trabajadas mes (tipos parciales)
    anticom = -1;   || acumulado del anti-complemento
    bruto_aju = 0;  || bruto base para ajustes
    sw_bruaju = 0;
    liq_aju = 0;    || liquido base para ajustes
    deducss = 0;    || deduccion seg. social forzada (autonomos)
    diastc2 = 0;    || dias TC2
    horatc2 = 0;    || horas TC2
    prom_ind = -1;  || promedio indemnizacion
    exce_smi = 0;   || exceso del 20% SMI
    acum_smi0 = 0; acum_smi1 = 0; acum_smi2 = 0; acum_smi3 = 0;
    acum_smi4 = 0; acum_smi5 = 0; acum_smi6 = 0; acum_smi7 = 0;
    nAjusteEB = 0;
    nAjusteEBnor1 = 0; nAjusteEBnor2 = 0; nAjusteEBnor3 = 0;
    nAjusteEB4101 = 0; nAjusteEB4102 = 0; nAjusteEB4103 = 0;
    nAjusteEB420 = 0;
|HAZ borra_afecta;
|CIERRAT #12;
|BUCLELIN 0cal_999#11;
|ABRET #12;
|HAZ calautom;
|HAZ graba_afecta;
|SI denfe_2 ! 0; |O dacci_2 ! 0;
    |SI #2#43 = "S"; |O #2#43 = "s";  || si ha estado enfermo y el anti-comp.
            anticom = 0;              || es valido, lo calcula
        |CIERRAT #12;
        |BUCLELIN 0cal_998#11;
        |ABRET #12;
    |FINSI;
|FINSI;

    acum_10 = acum_10 ! EURODB;
    acum_11 = acum_11 ! EURODB;
    acum_12 = acum_12 ! EURODB;
    acum_13 = acum_13 ! EURODB;
    acum_30 = acum_30 ! EURODB;
    acum_301 = acum_301 ! EURODB;
    acum_302 = acum_302 ! EURODB;
    acum_303 = acum_303 ! EURODB;
    acum_31 = acum_31 ! EURODB;
    acum_311 = acum_311 ! EURODB;
    acum_312 = acum_312 ! EURODB;
    acum_313 = acum_313 ! EURODB;
    acum_40 = acum_40 ! EURODB;
    acum_401 = acum_401 ! EURODB;
    acum_402 = acum_402 ! EURODB;
    acum_403 = acum_403 ! EURODB;
    acum_41 = acum_41 ! EURODB;    anti_41 = anti_41 ! EURODB;
    acum_60 = acum_60 ! EURODB;
    acum_50 = acum_50 ! EURODB;
    acum_90 = acum_90 ! EURODB;
|FPRC;

||****************************************************************************
||             RUTINAS DEL CALCULO DE LAS UNIDADES Y ACUMULADOS
||****************************************************************************

|PROCESO cal_999;     || CALCULA LAS UNIDADES CALCULO DE LOS DEMAS CONCEPTOS
     |SI #12#04 < 200; |O #12#04 > 208;    || los de pagas extras no entran
          |SI #12#04 > 103;                 || el 101,102 y 103 ya estan calculados
               |HAZ coefi;                   || saca el coeficiente y unidades
               nCoefEspecial = 1;
               concepto = #12#4;
               |HAZ ConceptosEspeciales;
               duni1_999 = #12#9;                    || unidades de 'coefi'
               |SI concepto = 410; |O concepto = 415;
                    duni2_999 = duni1_999;           || finiquito, las unid. que vengan
               |SINO;
                    duni2_999 = duni1_999 * dcofi_999;    || halla unidades calculo
               |FINSI;
               duni2_999 = duni2_999 ! 6;            || redondea
               duni2_999 = duni2_999 * nCoefEspecial;
               graba04 = #12#4;                      || carga concepto
               graba09 = duni1_999;                  || carga unidades
               graba10 = #12#10;
               graba11 = duni2_999;                  || carga unidades calculo
               swgracon = 0;                         || para que no machaque campos
               swcongra = 0;                         || para que no acumule
               |HAZ grabacon;                            || regraba linea calculo
               |SI #12#6 ! 0;
                    |SI #nomcontr#47 = "C"; |Y dabse_2 ! 0;
                         |SI #12#5 ! "E"; |Y #12#5 ! "L";
                              nAcumAbs = nAcumAbs + (((dcofi_999 - dcofi_999A) * duni1_999) ! 6) * #12#10;
                         |SINO;
                              nAcumAbs = nAcumAbs + (dabse_2 * #12#10);
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               concepto = #12#04;
               |HAZ convenio;
          |FINSI;
          |HAZ acu_ctos;
     |FINSI;
|FPRC;

|PROCESO AjusteEB;
     |SI #12#4 ] 101; |Y #12#4 [ 399;   || concepto normal
          |SI #10#8 = 1; nAjusteEBnor1 = nAjusteEBnor1 + product; |FINSI;
          |SI #10#8 = 2; nAjusteEBnor2 = nAjusteEBnor2 + product; |FINSI;
          |SI #10#8 = 3; nAjusteEBnor3 = nAjusteEBnor3 + product; |FINSI;
     |FINSI;
     |SI #12#4 ] 401; |Y #12#4 [ 410;   || no cotiza
          |SI #10#8 = 1; nAjusteEB4101 = nAjusteEB4101 + product; |FINSI;
          |SI #10#8 = 2; nAjusteEB4102 = nAjusteEB4102 + product; |FINSI;
          |SI #10#8 = 3; nAjusteEB4103 = nAjusteEB4103 + product; |FINSI;
     |FINSI;
     |SI #12#4 ] 411; |Y #12#4 [ 420;   || ni cotiza ni irpf
          nAjusteEB420 = nAjusteEB420 + product;
     |FINSI;

     |SI swDiosMio = -1; |ACABA; |FINSI;
     || si no en este caso volveria a descontar del IRPF, no es necesario
     || una segunda vez, tiquet 003086.01189
     |SI #12#4 [ 410;
          |SI #10#8 = 1;  acum_11 = acum_11 - product;  |FINSI;
          |SI #10#8 = 2;  acum_12 = acum_12 - product;  |FINSI;
          |SI #10#8 = 3;  acum_13 = acum_13 - product;  |FINSI;
     |FINSI;
     |SI #12#4 [ 400;
          acum_10 =acum_10 - product;
     |FINSI;
|FPRC;

|PROCESO acu_ctos;
    duni2_999 = #12#11;
    dvalo_999 = #12#10;
    product = duni2_999 * dvalo_999;
    product = product ! EURODB;
|SI #12#4 = 125; |Y duni2_999 < 0;
     #12#4 = 966;
|FINSI;
|SI #12#4 ] 101;|Y #12#4 [ 199;
                    acum_10 = acum_10 + product;
    |SI #10#8 = 1;  acum_11 = acum_11 + product;  |FINSI;
    |SI #10#8 = 2;  acum_12 = acum_12 + product;  |FINSI;
    |SI #10#8 = 3;  acum_13 = acum_13 + product;  |FINSI;
|FINSI;
|SI #12#4]301;|Y #12#4[304;
                    acum_30 =acum_30   +product;
    |SI #10#8 = 1;  acum_301 =acum_301 +product;  |FINSI;
    |SI #10#8 = 2;  acum_302 =acum_302 +product;  |FINSI;
    |SI #10#8 = 3;  acum_303 =acum_303 +product;  |FINSI;
|FINSI;
|SI #12#4]305;|Y #12#4[399;
                    acum_31 =acum_31   +product;
    |SI #10#8 = 1;  acum_311 =acum_311 +product;  |FINSI;
    |SI #10#8 = 2;  acum_312 =acum_312 +product;  |FINSI;
    |SI #10#8 = 3;  acum_313 =acum_313 +product;  |FINSI;
|FINSI;
|SI #12#4 ] 301; |Y #12#4 [ 310;
     |SI product > 0;
          nNroHorasExtra = nNroHorasExtra + duni2_999;
     |FINSI;
|FINSI;
|SI #12#4 ] 400; |Y #12#4 [ 410;
                    acum_40 = acum_40 + product;
    |SI #10#8 = 1;  acum_401 = acum_401 + product;  |FINSI;
    |SI #10#8 = 2;  acum_402 = acum_402 + product;  |FINSI;
    |SI #10#8 = 3;  acum_403 = acum_403 + product;  |FINSI;
    |HAZ acum_afecta;
    |SI #12#4 = 409;
          aVacacSINO = "N";   || si no, lo mete dos veces en la base de IRPF
    |FINSI;
|FINSI;
|SI #12#4]411;|Y #12#4[499;
    |SI #10#8 ! 0;
            acum_41 =acum_41   +product;
    |SINO;
            acum_60 =acum_60   +product;
    |FINSI;
    |HAZ acum_afecta;
|FINSI;

swSigue = 0;
|SI #12#4 ] 101; |Y #12#4 [ 199;
     swSigue = 1;
|FINSI;
|SI #12#4 ] 400; |Y #12#4 [ 499; |Y #10#11 = "S";
     swSigue = 1;
|FINSI;
|SI swSigue = 1;
    aLon = aConceptosComp % 0; nLon = aLon; nLon = nLon / 3;
    |PARA nPos = 1; |SI nPos [ nLon; |HACIENDO nPos = nPos + 1;
          nNume1 = ((((nPos - 1) * 3) + 1) * 100) + 3;
          aAlfa = aConceptosComp % nNume1;
          nConcepto = aAlfa;
          |SI #12#4 = nConcepto;
               nImporteComp = nImporteComp + product;
          |FINSI;
    |SIGUE;
|FINSI;
|SI #12#4]101;|Y #12#4[499;|Y #2#97 ! 0;
     |HAZ nomtraju;
     |SI swNoEntra ! 1;
          |SI #10#9="S";
               bruto_aju = bruto_aju + product;
          |FINSI;
     |FINSI;
     |SI #2#97 = 4;
          |SI #10#9 = "N"; |O swNoEntra = 1;
               |HAZ AjusteEB;
          |FINSI;
     |SINO;
     |FINSI;
|FINSI;
|SI #12#4 = 916; |Y #labtraba#42 = "H"; |Y #2#97 = 6; |Y #10#9="S";
      bruto_aju = bruto_aju - product;
|FINSI;
|SI #12#4=501;              acum_51 =product;                |FINSI;
|SI #12#4=502;              acum_52 =product;                |FINSI;
|SI #12#4]505;|Y #12#4[599; acum_50 =acum_50 + product;       |FINSI;
|SI #12#4=901; |Y runnom ! "nomcalfi"; horasex =duni1_999;   |FINSI;
|SI #12#4=961; |Y runnom ! "nomcalfi";
     nHorasTut = duni1_999; nBonifTut = duni1_999 * dvalo_999;
|FINSI;
|SI #12#4=902;              indemni =duni1_999;              |FINSI;
|SI #12#4=904;              vacacio =duni1_999;              |FINSI;
|SI #12#4=905;              horastp =duni1_999;              |FINSI;
|SI #12#4=906;|Y antici1=0; antici1 =product;                |FINSI;
|SI #12#4=907;|Y antici2=0; antici2 =product;                |FINSI;
|SI #12#4=926;              antici4 =antici4 + product;      |FINSI;
|SI #12#4=908;|Y especie=0; especie =product;                |FINSI;
|SI #12#4=923;              especie = especie + product;     |FINSI;
|SI #12#4=924;              especie = especie + product;     |FINSI;
|SI #12#4=921;|Y antici3=0; antici3 =product;                |FINSI;
|SI #12#4=915;              pagavac =duni1_999;              |FINSI;
|SI #12#4=916;              deducss =product;                |FINSI;
|SI #12#4=917;              diastc2 =duni1_999;              |FINSI;
|SI #12#4=918;              horatc2 =duni1_999;              |FINSI;
|SI #12#4=919;
                    ||acum_10 =acum_10 +product;
    |SI #10#8 = 1;  acum_11 =acum_11 +product;  |FINSI;
    |SI #10#8 = 2;  acum_12 =acum_12 +product;  |FINSI;
    |SI #10#8 = 3;  acum_13 =acum_13 +product;  |FINSI;
|FINSI;
|SI #12#4=920;              prom_ind=duni1_999;              |FINSI;
|SI #12#4=928; nEl928 = dvalo_999;              |FINSI;
|PARA nNume1 = 951; |SI nNume1 [ 960; |HACIENDO nNume1 = nNume1 + 1;
     |SI #12#4 = nNume1;
          antici4 = antici4 + product;
     |FINSI;
|SIGUE;
|SI #12#4 = 945;              nBaseBon945 = duni1_999;              |FINSI;
|SI #12#4 = 946;              nBase946 = dvalo_999;              |FINSI;
|SI #12#4 = 947;              nBase947 = dvalo_999;              |FINSI;
|SI #12#4 = 948;  nUniDes2 = duni1_999; nBaseDes2 = dvalo_999;  |FINSI;
|HAZ cal_vaca;
|SI #12#4 = 965; |O #12#4 = 966;
     |SI #12#4 = 966;
          #12#7 = 0;
          #12#8 = "DTO.VAC.";
     |FINSI;
     |SI dvalo_999 = 0;
          dvalo_999 = dacum_vac;
          #12#10 = dvalo_999;
     |FINSI;
     product = duni2_999 * dvalo_999;
     |GRABA 020#12a;
     |LIBERA #12;
     |SI product > 0;
          nPreavisoAbo = product;
          acum_10 = acum_10 + product;
          acum_11 = acum_11 + product;
     |SINO;
          |SI #12#4 = 965;
               nPreavisoDto = product;
          |FINSI;
          |SI #12#4 = 966;
               nVacDto = product;
          |FINSI;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO acum_afecta;
||SI es_aprendi = 0;|Y #10#11 = "S"; || formacion tambien: 1910.714
|SI #10#11 = "S";
    |SI #10#12 ! 0;
        |SI #10#12 = 1;  acum_smi1 = acum_smi1 + product; |FINSI;
        |SI #10#12 = 2;  acum_smi2 = acum_smi2 + product; |FINSI;
        |SI #10#12 = 3;  acum_smi3 = acum_smi3 + product; |FINSI;
        |SI #10#12 = 4;  acum_smi4 = acum_smi4 + product; |FINSI;
        |SI #10#12 = 5;  acum_smi5 = acum_smi5 + product; |FINSI;
        |SI #10#12 = 6;  acum_smi6 = acum_smi6 + product; |FINSI;
        |SI #10#12 = 7;  acum_smi7 = acum_smi7 + product; |FINSI;
    |SINO;
            alfa1 = "    Debera revisar el concepto [" + #10#2 + "] del convenio [" + #10#0 + "] ...";
        |MENAV alfa1;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO graba_afecta1;
|SI acum_smi0 > topesmi;
        exce_smi = exce_smi + (acum_smi0 - topesmi);
    |LEE 101#38=;
        FEstado = FSalida;

        #38#5 = acum_smi0;        || importe por clave
        #38#6 = topesmi;          || tope 20% SMI
        #38#7 = #38#5 - #38#6;    || exceso
        #38#9 = #2#2;             || nombre trabajador

    |SI FEstado = 0;    |GRABA 020#38a;     |FINSI;
    |SI FEstado ! 0;    |GRABA 020#38n;     |FINSI;
    |LIBERA #38;
|FINSI;
|FPRC;

|PROCESO graba_afecta;
     nNume1 = (dcoti_0 + ddese_3) / 30;
     |SI nNume1 > 1; nNume1 = 1; |FINSI;
     topesmi = (topesmi * nNume1) ! EURODB;
     |ABRE #38;
     #38#0 = #0#9;   || a¤o
     #38#1 = #0#8;   || mes
     #38#2 = #2#0;   || empresa
     #38#3 = #2#1;   || trabajador
     acum_smi0 = acum_smi1; #38#4=1; #38#8 = "Dietas      "; |HAZ graba_afecta1;
     acum_smi0 = acum_smi2; #38#4=2; #38#8 = "Locomocion  "; |HAZ graba_afecta1;
     acum_smi0 = acum_smi3; #38#4=3; #38#8 = "P.Transporte"; |HAZ graba_afecta1;
     acum_smi0 = acum_smi4; #38#4=4; #38#8 = "Moneda, etc."; |HAZ graba_afecta1;
     acum_smi0 = acum_smi5; #38#4=5; #38#8 = "Vivienda    "; |HAZ graba_afecta1;
     acum_smi0 = acum_smi6; #38#4=6; #38#8 = "En especie  "; |HAZ graba_afecta1;
     topesmi = 0;
     acum_smi0 = acum_smi7; #38#4=7; #38#8 = "Cotiza 100% "; |HAZ graba_afecta1;
     topesmi = (topesmi * nNume1) ! EURODB; || lo dejo como estaba
     |CIERRA #38;
|FPRC;

|PROCESO nomafema1;
|BORRA 020#38a;
|LIBERA #38;
|FPRC;

|DEFBUCLE nomafema;
 #38#1;
 ;
 nume1, #0#8, #2#0, #2#1,   1;
 nume1, #0#8, #2#0, #2#1, 999;
 be;
 NULL, nomafema1;
|FIN;

|PROCESO borra_afecta;
    nume1 = #0#9;
|BUCLE nomafema;
|FPRC;

|PROCESO cal_998;     || CALCULA EL ANTI-COMPLEMENTO, EN SU CASO
     nume1 = 0;
     |SI #12#6 = 1; |O #12#5 = "P";     || pagas tambien
          |SI #12#4 > 100;|Y #12#4 [ 199;  nume1 = 1;  |FINSI; || los cien
          |SI #12#4 > 200;|Y #12#4 [ 208;              || pagas prorrateadas
               nNume1 = #12#4 - 181;
               nNume2 = #12#4 - 88;
               |SI #nomconca#nNume1# = 99; |O #labtraba#nNume2# = "S";
                    nume1 = 1;
               |FINSI;
          |FINSI;
          |SI #12#4 > 400;|Y #12#4 < 499;  nume1 = 1;  |FINSI; || los cuatrocientos
          |SI nume1 ! 0;
               concepto = #12#4;
               |HAZ convenio;
               |SI #10#10 ! "S";|O #10#7 = "E";     || complemento NO o
                    nume1 = 0;                   ||/EXCLUSIVO vacaciones
               |SINO;
                    |SI #10#7 = "N";|Y dvaca_2 ! 0;  || si un concepto no entra en
                         nume1 = 0;               ||/vacaciones y en este mes
                    |FINSI;                          ||/hay dias de vacaciones
               |FINSI;                              ||/no entra!!!
          |FINSI;
          |SI nume1 ! 0;
               duni2_999 = #12#11;  || unidades cobro
               duni2_998 = #12#9;   || unidades cotiz.
               dvalo_999 = #12#10;  || valor
               |SI #12#5 = "L"; duni2_998 = conser1; |FINSI;
               |SI #12#5 = "K"; |O #12#5 = "E"; duni2_998 = conser2; |FINSI;

               |SI #12#4 > 200;|Y #12#4 [ 208;              || pagas prorrateadas
                    |HAZ Unid200_998;
               |FINSI;
               |SI dmate_2 > 0;
                    duni2_998 = duni2_998 * ((dia_4 - dmate_2) / dia_4);  || segun dias alta
               |SINO;
                    || duni2_998 = duni2_998 * dcofi_2;  || segun dias alta
                    duni2_998 = duni2_998 * ((dcoti_0 - ddese_2) / dia_4);  || segun dias alta
               |FINSI;
               duni2_998 = duni2_998 ! 6;
               |SI duni2_998 > dcoti_0; |Y concepto ! 102; || (no para antiguedad)
                    duni2_998 = dcoti_0;
               |FINSI;

               produc1 = duni2_999 * dvalo_999;
               produc1 = produc1 ! EURODB;

               produc2 = duni2_998 * dvalo_999;
               produc2 = produc2 ! EURODB;

               produc3 = produc2 - produc1;
               anticom = anticom + produc3;

               |SI #12#4 ] 411;|Y #12#4 [ 499; anti_41 = anti_41 + produc3; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

||****************************************************************************
||        CALCULO DE LOS CONCEPTOS AUTOMATICOS
||****************************************************************************

|PROCESO lee_autom1;
     acu_auto = 0;
     concepto = #37#1;

     || vuelvo a comprobar si el concepto en verdad es automatico, por si los restos
     #nomconli#0 = #labtraba#87;
     #nomconli#2 = concepto;
     |LEE 000#nomconli.=;
     |SI FSalida ! 0; |O #nomconli#3 ! "A";
          |ACABA;
     |FINSI;

     #12#0 = #2#0;
     #12#1 = #2#1;
     #12#2 = #0#8;
     #12#3 = 0;
     #12#4 = concepto;
     |LEE 000#12=;
     |SI FSalida = 0;
          nCalc = #12#6;
          |PARA auto3 = 32; |SI auto3 [ 46; |HACIENDO auto3 = auto3 + 1;
               |SI #37auto3 ! 0;
                    auto1 = auto3 - 30;     auto2 = auto3 - 15;
                    val_auto = 0;
                    |SI #37auto2 ! "C";
                         |SI #37auto2 = "U";|O #37auto2 = "I";
                              #12#4 = #37auto3;
                              |LEE 000#12=;
                              |SI FSalida = 0;
                                   |SI #37auto2 = "U"; val_auto = #12#9; |FINSI;
                                   |SI #37auto2 = "I"; val_auto = #12#10 * #12#9; |FINSI;
                                   || lo logico es que si es "1" el concepto automatico, cojamos 3430.1376
                                   || el importe ya proporcionado de un concepto "1", no hacerlo otra vez
                                   |SI nCalc = 1; |Y #37auto2 = "I"; |Y #12#6 = 0;
                                        || para que despues el concepto vaya con el importe que debe
                                        val_auto = (#12#10 * #12#9) / dcofi_1;
                                   |FINSI;
                                   || despues al multiplicar por la parte en alta,
                                   || los "L" y los "E" han de ir enteros 1624.2512
                                   |SI #12#5 = "L"; |O #12#5 = "E"; val_auto = val_auto / dcofi_999; |FINSI;
                              |FINSI;
                         |SINO;
                              |SI #37auto2 = "P";|O #37auto2 = "E";
                                   |SI #37auto3 = 1;    val_auto = nIRPF1;   |FINSI;
                                   |SI #37auto3 = 2;    val_auto = nIRPF2;  |FINSI;
                                   |SI #37auto3 = 3;    val_auto = nIRPF3;  |FINSI;
                              |FINSI;
                              |SI #37auto2 = "E";
                                   val_auto = 100 / (val_auto + 100);
                              |FINSI;
                         |FINSI;
                    |SINO;
                         val_auto = #37auto3;
                    |FINSI;

                    |SI #37auto1 = "+";    acu_auto = acu_auto + val_auto;    |FINSI;
                    |SI #37auto1 = "-";    acu_auto = acu_auto - val_auto;    |FINSI;
                    |SI #37auto1 = "/";    acu_auto = acu_auto / val_auto;    |FINSI;
                    |SI #37auto1 = "*";    acu_auto = acu_auto * val_auto;    |FINSI;
                    |SI #37auto1 = "%";    acu_auto = acu_auto % val_auto;    |FINSI;
               |FINSI;
          |SIGUE;

          #12#4 = concepto;
          |LEE 000#12=;
          |HAZ coefi;
          graba04 = concepto;
          graba05 = #10#3;
          graba06 = #10#4;
          graba07 = #10#5;
          graba08 = #10#6;
          graba09 = 1;
          graba10 = acu_auto;
          graba11 = graba09 * dcofi_999;
          swgracon = 1;     || para que regrabe campos
          swcongra = 0;     || para que acumule si existe
          |SI concepto ] 900;
               |HAZ autovarca;      || comprueba si algun concepto autom. se anula
          |FINSI;
          |HAZ grabacon;
          |HAZ acu_ctos;
     |FINSI;
|FPRC;

|DEFBUCLE lee_autom;
 #37#1;
 ;
 #2#87, 101;
 #2#87, 999;
 ;
 NULL, lee_autom1;
|FIN;

|PROCESO calautom;
|BUCLE lee_autom;
|FPRC;

||****************************************************************************
||        CALCULO DE LA ENFERMEDAD (503), ACCID. (504) Y COMPLEMENTOS
||****************************************************************************

|PROCESO calenfe;
     |SI runnom = "nomcalir"; |ACABA; |FINSI;
     |SI swCambiaProm = 0;
          prom_enf = #2#95;    || promedio enfermedad (trabajador)
          prom_acc = #2#96;    || promedio accidente (trabajador)
          |SI #7#17 ! 0;  prom_enf = #7#17;  |FINSI;  || promedio enfermedad (variac.)
          |SI #7#18 ! 0;  prom_acc = #7#18;  |FINSI;  || promedio accidente (variac.)
          |SI es_aprendi ! 0;
               nPorcFormacion = 75;
               |SI nElAny = 2013; |Y nElMes ] 11; nPorcFormacion = 100; |FINSI;
               |SI nElAny ] 2014; nPorcFormacion = 100; |FINSI;
               |SI nPorcFormacion = 100; prom_enf = #15#33; prom_acc = #15#33; |FINSI;
          |FINSI;
          |HAZ calproac;      || es lo que tomo
     |FINSI;
     |HAZ VariosBasesIT;

     |SI nBase946 ! 0; nBasePresEnf = nBase946; |SINO; nBasePresEnf = prom_enf; |FINSI;
     |SI nBase947 ! 0; nBasePresAcc = nBase947; |SINO; nBasePresAcc = prom_acc; |FINSI;

     base_3 = (((nBasePresAcc+prom_ac2) * .75) ! 2) * dacci_X2; || accidente al 75% (504)
     |SI nPropDesTP ! 0; |Y nDesEnf ! 0;
          nBasePresEnf = nBasePresEnf * ((100 - nPropDesTP) / 100);
     |FINSI;
     |SI nPropDesTP ! 0; |Y nDesAcc ! 0;
          || accidente al 75% (504), en ERE Parcial lo hago asi, si no despues
          || da problemas en los ajustes
          nBasePresAcc = nBasePresAcc * ((100 - nPropDesTP) / 100);
          base_3 = ((nBasePresAcc % 75) ! 2) * (dacci_X2 / (nPropDesTP / 100));
     |FINSI;

     |SI #labtraba#241 = "N"; |Y #labtraba#138 = "N"; base_3 = 0; |FINSI;

     |SI #labtraba#247 = 138;
          dacci_3 = base_3;
          base_3 = 0;
     |FINSI;
     concepto = 927;
     nBaseIT2 = 0;
     |HAZ BaseIT2;
     || CALCULO DE PRESTACIONES POR IT
     |SI #labtraba#42 ! "L"; |O #nomcontr#72 = "S";
          base_1 = ((nBasePresEnf * 0.75) ! 2) * denfe_C; ||enfermedad al 75% (503)
          base_2 = ((nBasePresEnf * 0.60) ! 2) * denfe_B; ||enfermedad al 60% (503)
          base_4 = 0;
          |SI sw_mater = 0;
               base_4 = ((nBasePresEnf * 0.75) ! 2) * dmate_2; ||maternidad al 75% (503)
          |FINSI;
          denfe_4= ((nBasePresEnf * 0.60) ! 2) * denfe_D; ||enfer.empr.al 60% (515)
          |HAZ OrigenControlIT;
          |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y aTipoOrigen = "E";
               denfe_C = denfe_C + dcont_2; || migue
          |FINSI;
     |FINSI;
     || CALCULO DE BASES POR ENFERMEDAD
     nume1 = denfe_2;     |HAZ liquidados;
     coba_1 = prom_enf * nume1;   || base CC enfermedad (base ILT)
     cobb_1 = prom_acc * nume1;   || base AT enfermedad
     |SI nume1 > 0; |Y prom_enf [ 0;
          nIncid = 1;
          |HAZ graba_inc;
     |FINSI;
     || CALCULO DE BASES POR MATERNIDAD
     nume1 = dmate_2;     |HAZ liquidados;
     coba_4 = prom_enf * nume1;   || base CC maternidad (base ILT)
     cobb_4 = prom_acc * nume1;   || base AT maternidad
     |SI nume1 > 0; |Y prom_enf [ 0;
          nIncid = 1;
          |HAZ graba_inc;
     |FINSI;

     || CALCULO DE BASES POR ACCIDENTE
     nume1 = dacci_2;     |HAZ liquidados;
     coba_2 = (prom_acc + prom_ac2) * nume1;   || base AT accidente (base ILT)
     cobb_2 = prom_enf * nume1;   || base CC accidente
     |SI nume1 > 0; |Y prom_acc [ 0;
          nIncid = 2;
          |HAZ graba_inc;
     |FINSI;
     |HAZ calenfe_BaseIT2;
     |SI #labtraba#241 = "N"; |Y #labtraba#138 = "N";
          coba_4 = coba_4 + coba_1;
          cobb_4 = cobb_4 + cobb_1;
          coba_1 = 0; cobb_1 = 0;
          sw_mater = 1;
          swITEmp = 1;
     |FINSI;
     || CALCULO DE BASES POR ABSENTISMO
     nume1 = dabse_2;     |HAZ liquidados;
     |SI #32#2 = "N";         || por el promedio de enfermedad
          coba_3 = prom_enf * nume1; || base CC abs.
          cobb_3 = prom_acc * nume1; || base AT abs.
     |SINO;                   || por el minimo de su categoria
          |SI #32#2 = "S";
               |SI es_parcial = 1;   || soy tiempo parcial
                    campomin = 58;
                    campomin = campomin + grupo;
                    nume2 = (#labtraba#47 * nume1);
                    |SI 0 < nume2; |Y nume2 < 0.5;
                         nume2 = 1;
                    |FINSI;
                    coba_3 = #15campomin * nume2;
                    cobb_3 = #15campomin * nume2;
               |SINO;
                    campomin = #2#33 + 23;  coti_0 = #15campomin * tp;  || minimo CC
                    |SI grupo = 12; coti_1 = #15#22 * tp;  |FINSI;          || minimo AT
                    |SI grupo = 11; coti_1 = #15#21 * tp;  |FINSI;
                    |SI grupo < 11; coti_1 = #15#23 * tp;  |FINSI;
                    coba_3 = coti_0 * nume1;   || base CC abs.
                    cobb_3 = coti_1 * nume1;   || base AT abs.
               |FINSI;
         |SINO;
               coba_3 = 0;      || sin cotizacion (X)
               cobb_3 = 0;
         |FINSI;
     |FINSI;
     || CALCULO DE BASES POR ALTA SIN RETRIBUCION
     nume1 = dperm_2;
     |SI swCambiaCot = 0; |HAZ liquidados; |FINSI;
     coba_5 = 0; cobb_5 = 0;
     |SI nume1 ! 0;
          campomin = #2#33 + 23;  coti_0 = #15campomin;  || minimo CC
          coti_1 = #15#21;                               || minimo CP
          |SI es_parcial = 1;
               nume4 = tp ! 3;     || coef. a tres decimales, como SILTRA
               nume2 = nume4 * coti_0;     || coef. a tres decimales, como SILTRA
               coba_5 = nume1 * nume2; || esos son los dias que multi-
               nume2 = nume4 * coti_1;     || coef. a tres decimales, como SILTRA
               cobb_5 = nume1 * nume2; || plico por la base minima
               || cuidado para cont. profesionales:
               nNume1 = ((coti_1 * 30) * nume4) ! 2;
               |SI cobb_5 > nNume1; cobb_5 = nNume1; |FINSI;
          |SINO;
               coba_5 = nume1 * coti_0;
               cobb_5 = nume1 * coti_1;
          |FINSI;
     |FINSI;
     nume7 = base_1 + base_2 + base_4;  || prest. Seg. Soc.
     |SI #nomcontr#48 = "N";
          nume7 = nume7 + denfe_4; || prest. empresa
     |FINSI;
     |HAZ carencia;
     |SI #labtraba#42 = "H";
          base_1 = 0; base_2 = 0;    base_3 = 0;    base_4 = 0;
          denfe_4 = 0;
     |FINSI;
     |SI #2#241 = "N";             || prestaciones ILT: NO
          |SI nume7 ! 0;
               |SI nDiasAlta > nCarencia;
                    nIncid = 7;
                    |HAZ graba_inc;
               |FINSI;
          |FINSI;
          base_2 = 0; base_4 = 0;
          |SI #2#241 = "N"; |Y #labtraba#138 = "N";    || esto por 3237.3596
               base_1 = 0;                             || antes no estaba
               |SI #nomcontr#48 = "N";
                    denfe_4 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nume7 ! 0;
               |SI nDiasAlta < nCarencia;
                    nIncid = 11;
                    |HAZ graba_inc;
               |FINSI;
          |FINSI;
     |FINSI;

     swCumple = 1;
     |HAZ RevisaNormas;
     nPresDiaEnf = 0;
     nPresDiaAcc = 0;
     |SI anticom = -1;
          |SI #labtraba#42 ! "L"; |O #nomcontr#72 = "S";
               |HAZ complementos;   || calcula compl. segun convenio
               |SI denfe_3 ! 0; |O dacci_3 ! 0; |O anticom2 ! 0; |O anticom3 ! 0;
                    |SI #2#179 = "N";
                         denfe_3 = 0;
                         dacci_3 = 0;
                         anticom2 = 0;
                         anticom3 = 0;
                         nIncid = 9;
                         |HAZ graba_inc;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          anticom = 0;
          |BUCLELIN 0cal_998#11;
     |FINSI;

     |SI #15#75 ! 0;               || si lleva porcentaje por deduccion voluntaria
     |O #2#241 = "X";              || la empresa asume a su cargo las prestaciones
                                   || por enf. comun y accid. no laboral
          base_1 = 0; base_2 = 0;    base_4 = 0;
          |SI #2#241 = "X"; denfe_4 = 0; |FINSI;
     |FINSI;
     acum_53 = base_1 + base_2 + base_4;  || prest. enf.
     acum_54 = base_3;                    || prest. acc.
     |SI anticom ! -1;
          |SI #labtraba#42 ! "L"; |O #nomcontr#72 = "S";
               |HAZ anticomp;       || calcula el anti-complemento
          |FINSI;
     |FINSI;
     |SI anticom = -1; |Y anticom2 ! 0;
          |SI #labtraba#42 ! "L"; |O #nomcontr#72 = "S";
               |HAZ anticomp2;       || calcula el anti-complemento
          |FINSI;
     |FINSI;
     |SI anticom = -1; |Y anticom3 ! 0;
          |SI #labtraba#42 ! "L"; |O #nomcontr#72 = "S";
               |HAZ anticomp3;       || calcula el anti-complemento
          |FINSI;
     |FINSI;
     |SI diff_L ! 0;
          nPasoIT = 90;
          |HAZ RegistroIT;
     |FINSI;
     || excepcion para complementos tipo "P", en mensuales en meses de 31 o 28
     || dias hay que ajustar el complemento para que no se pase de la base de
     || cotizacion, uso nPresDia que es la prestacion que pague en el ultimo dia
     || de IT,  solo si es tipo "P" de verdad Y COMPLEMENTO EL 100%
     swSigue = 0;
     |SI #nomconax#5 = "P"; |Y #nomconax#4 = 100; swSigue = swSigue + 1; |FINSI;
     |SI #nomconax#117 = "P"; |Y #nomconax#116 = 40; swSigue = swSigue + 1; |FINSI;
     |SI #nomconax#198 = "P"; |Y #nomconax#197 = 25; swSigue = swSigue + 1; |FINSI;

     |SI #nomconax#23 = "P"; |Y #nomconax#19 = 100; swSigue = swSigue + 1; |FINSI;
     |SI #nomconax#24 = "P"; |Y #nomconax#20 = 40; swSigue = swSigue + 1; |FINSI;
     |SI #nomconax#25 = "P"; |Y #nomconax#21 = 25; swSigue = swSigue + 1; |FINSI;

     |HAZ MasComplemento;

     denfe_3 = denfe_3 ! 2;
     |SI swSigue ] 3; |Y #nomcontq#1 ! 1;
          nume2 = denfe_3 + denfe_4 + acum_53;
          swSigue2 = 0;
          |SI swAjuste3_C ! 0; |Y #labtraba#42 ! "H"; |Y nume2 ! 0; |Y denfe_3 > 0;
               swSigue2 = 1;
               nume7 = swAjuste3_C;
          |FINSI;
          |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y nume2 ! 0; |Y denfe_3 > 0;
               |SI swAjuste3 ! 0; |O swAjuste3_C ! 0;
                    swSigue2 = 1;
               |FINSI;
               |SI swAjuste3 ! 0; nume7 = swAjuste3; |FINSI;
               |SI swAjuste3_C ! 0; nume7 = swAjuste3_C; |FINSI;
          |FINSI;
          |SI swSigue2 = 1;
               || le quito el ultimo dia de prestacion
               denfe_3 = denfe_3 - (nume7 * (nPresDiaEnf ! 2)); || le quito el ultimo dia de prestacion
               |SI denfe_3 < 0;
                    denfe_3 = 0;
               |FINSI;
               nPasoIT = 991; |HAZ RegistroIT;     || para que salga en informe
          |FINSI;
     |FINSI;

     || lo mismo para accidentes
     swSigue = 0;
     || en accidentes me basta con que se complemente el 25%, eso quiere decir
     || que tengo que aplicar esto, el dia de inicio del complemento me da igual
     || porque la prestacion es del 75% siempre
     |SI #nomconax#53 = "P"; |Y #nomconax#51 = 25; swSigue = 1; |FINSI;
     |SI #nomconax#54 = "P"; |Y #nomconax#52 = 25; swSigue = 1; |FINSI;
     |SI #nomconax#174 = "P"; |Y #nomconax#172 = 25; swSigue = 1; |FINSI;
     |SI dacci_Z ! 0; |Y #nomconax#51 ! 25; swSigue = 0; |FINSI;
     || primera linea no al 100% y dias en esa primera linea
     |SI swSigue = 1; |Y #nomcontq#1 ! 1;
          nume2 = dacci_3 + acum_54;
          |SI swAjuste3_C ! 0;
          |Y #labtraba#42 ! "H"; |Y nume2 ! 0; |Y dacci_3 > 0; |Y denfe_2 = 0;
               || (si tengo enf y acc el mismo mes, el dia cotiz. que me sobra lo
               || quito de la enf, esto aqui no hace falta) 27.05.2010 - 00766.00749

               || le quito el ultimo dia de prestacion
               dacci_3 = dacci_3 - (swAjuste3_C * (nPresDiaAcc ! 2)); || le quito el ultimo dia de prestacion
               |SI dacci_3 < 0;
                    dacci_3 = 0;
               |FINSI;
               nPasoIT = 992; |HAZ RegistroIT;     || para que salga en informe
          |FINSI;
     |FINSI;

     denfe_3 = denfe_3 ! EURODB;    || compl. enf.
     dacci_3 = dacci_3 ! EURODB;    || compl. acc.
     dmate_3 = dmate_3 ! EURODB;    || compl. mat.
     dtodo_3 = dtodo_3 ! EURODB;    || compl. ilt (autom.)
     denfe_4 = denfe_4 ! EURODB;    || prest. empr.
     acum_53 = acum_53 ! EURODB;    || prest. enf.
     acum_54 = acum_54 ! EURODB;    || prest. acc.
     |HAZ grabados;    || graba conceptos (511, 512, 513, 514 y 515)
|FPRC;

|PROCESO liquidados;
|SI nume1 > dia_4;  nume1 = dia_4;  |FINSI;
|SI nume1 = dia_2; |Y nume1<dia_4;
     |SI #labtraba#42 ! "C"; |Y #labtraba#42 ! "F";
          nume1 = dia_4;
     |FINSI;
|FINSI;
|FPRC;

||****************************************************************************
||      RUTINAS DEL CALCULO DE LA ENFERMEDAD, ACCIDENTE Y COMPLEMENTOS
||****************************************************************************

|PROCESO calproac;
     nume1 = 0;      || acumulador de nro. de meses
     nume2 = 0;      || acumulador de bases cotizadas
     prom_ac2 = 0;   || promedio accid.
     |SI #1#40 = "S";|Y dacci_2 ! 0;
          |SI #labtraba#92 = 0;
               |HAZ NuevoCalproac;
               || me cargo lo del nomtrahx, que ademas no era lo correcto
          |SINO;
               |HAZ BaseMesAntIT;
               |SI nBaseMesAntIT ! 0;
                    prom_acc = nBaseMesAntIT;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI swCambiaCot = 1; |Y #labtraba#247 ! 138;
          || la base de IT nunca puede superar a la base maxima
          || esto da problemas en los X-M que cotizan como diarios en IT
          || 135.4295
          nDiasCotIT = denfe_2 + dmate_2 + dacci_2 - swAjuste3;
          |SI nDiasCotIT = guarda;
               nNume1 = 30 * #nomconst#36;
               nNume2 = nDiasCotIT * prom_enf;
               |SI nNume2 > nNume1;
                    prom_enf = (nNume1 / 31) ! 2;
                    prom_acc = (nNume1 / 31) ! 2;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO complementos;
||____________________________________/ DESGLOSA DIAS ENFERMEDAD
|SI #labtraba#247 = 138; |ACABA; |FINSI;

    denfe_Z = 0;    || dias 1ra. enfermedad
    denfe_Y = 0;    || 1ra. linea resto enfermedades
    denfe_X = 0;    || 2da. linea resto enfermedades
    denfe_W = 0;    || 3ra. linea resto enfermedades
    denfe_V = 0;    || 4ta. linea resto enfermedades

    denfe_U = 0;    || 1ra. linea 1ra. enfermedad
    denfe_T = 0;    || 2da. linea 1ra. enfermedad
    denfe_S = 0;    || 3ra. linea 1ra. enfermedad
    denfe_R = 0;    || 4ta. linea 1ra. enfermedad

    denfe_Z_H = 0;    || dias 1ra. enfermedad CON HOSPITALIZACION
    denfe_Y_H = 0;    || 1ra. linea resto enfermedades CON HOSPITALIZACION
    denfe_X_H = 0;    || 2da. linea resto enfermedades CON HOSPITALIZACION
    denfe_W_H = 0;    || 3ra. linea resto enfermedades CON HOSPITALIZACION
    denfe_V_H = 0;    || 4ta. linea resto enfermedades CON HOSPITALIZACION

    denfe_U_H = 0;    || 1ra. linea 1ra. enfermedad CON HOSPITALIZACION
    denfe_T_H = 0;    || 2da. linea 1ra. enfermedad CON HOSPITALIZACION
    denfe_S_H = 0;    || 3ra. linea 1ra. enfermedad CON HOSPITALIZACION
    denfe_R_H = 0;    || 4ta. linea 1ra. enfermedad CON HOSPITALIZACION

     nArrAnyAnt = #2#90;
     ||HAZ AjuCompFeb;
     |HAZ AjusteEnf3_Comp;

|PARA para1 = 1; |SI para1 [ 4; |HACIENDO para1 = para1 + 1;
     denfe_Z0 = 0;    || dias 1ra. enfermedad
     denfe_U0 = 0;    || 1ra. linea 1ra. enfermedad
     denfe_T0 = 0;    || 2da. linea 1ra. enfermedad
     denfe_S0 = 0;    || 3ra. linea 1ra. enfermedad
     denfe_R0 = 0;    || 4ta. linea 1ra. enfermedad

     denfe_Y0 = 0;    || 1ra. linea resto enfermedades
     denfe_X0 = 0;    || 2da. linea resto enfermedades
     denfe_W0 = 0;    || 3ra. linea resto enfermedades
     denfe_V0 = 0;    || 4ta. linea resto enfermedades

     denfe_Z0_H = 0;    || dias 1ra. enfermedad CON HOSPITALIZACION
     denfe_U0_H = 0;    || 1ra. linea 1ra. enfermedad CON HOSPITALIZACION
     denfe_T0_H = 0;    || 2da. linea 1ra. enfermedad CON HOSPITALIZACION
     denfe_S0_H = 0;    || 3ra. linea 1ra. enfermedad CON HOSPITALIZACION
     denfe_R0_H = 0;    || 4ta. linea 1ra. enfermedad CON HOSPITALIZACION

     denfe_Y0_H = 0;    || 1ra. linea resto enfermedades CON HOSPITALIZACION
     denfe_X0_H = 0;    || 2da. linea resto enfermedades CON HOSPITALIZACION
     denfe_W0_H = 0;    || 3ra. linea resto enfermedades CON HOSPITALIZACION
     denfe_V0_H = 0;    || 4ta. linea resto enfermedades CON HOSPITALIZACION

     nHospi = 0;

     |SI para1 = 1;  denfe_20 = denfe_21;  |FINSI;
     |SI para1 = 2;  denfe_20 = denfe_22;  |FINSI;      || dias enfermo
     |SI para1 = 3;  denfe_20 = denfe_23;  |FINSI;
     |SI para1 = 4;  denfe_20 = denfe_24;  |FINSI;

     |SI para1 = 1;  nHospi = nHospi1;  |FINSI;
     |SI para1 = 2;  nHospi = nHospi2;  |FINSI;
     |SI para1 = 3;  nHospi = nHospi3;  |FINSI;
     |SI para1 = 4;  nHospi = nHospi4;  |FINSI;
     |SI para1 = 1;  dreca_0 = dreca_1; |FINSI;
     |SI para1 = 2;  dreca_0 = dreca_2; |FINSI;
     |SI para1 = 3;  dreca_0 = dreca_3; |FINSI;
     |SI para1 = 4;  dreca_0 = dreca_4; |FINSI;
     |SI nHospi = 1;
          |HAZ Paralelo;
          nPasoIT = 3; |HAZ RegistroIT;
     |SINO;
          |HAZ OrigenControlIT;
          |SI dcont_2 > 0; |Y para1 = swControlIT; |Y #nomcontr#62 = "S";
          |Y aTipoOrigen = "E";
               |SI swAjuste3 ! 0; |Y swAjuste3_C ! 0; || libro de comentarios (7)
                    denfe_20 = dcont_2 - swAjuste3;
               |SINO;
                    denfe_20 = dcont_2 - swAjuste3 - swAjuste3_C;
               |FINSI;
               denfe_t = dcont_2;
               denfe_0 = 365;
               |SI #labtraba#60 = "C";
                    denfe_0 = denfe_0 + #labtraba#89;
               |FINSI;
          |FINSI;
          |SI denfe_20 ! 0;              || si ha estado enfermo
               |HAZ leetodo;              || lee cada vez el auxiliar de convenios
               denfe_t = denfe_20;
               swPrimera = 1;           || por defecto la primera del a¤o
               |HAZ BuscaPE;            || busco si no lo es
               |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y para1 = swControlIT;
                    |HAZ PrimeraControlIT;
               |FINSI;
               |SI swPrimera = 1; |Y para1 ! swControlIT;
                    |SI para1 ! 1;      || no va a ser la primera del a¤o si
                         |PARA nNume1 = 1; |SI nNume1 < para1; |HACIENDO nNume1 = nNume1 + 1;
                              campo = nNume1 + 11;
                              |SI #nomvarca#campo# = "E";
                                   |SI dreca_0 = 0; || no es la primera linea de enfermedad
                                         swPrimera = 0; || SALVO QUE HAYA RECAIDA
                                   |FINSI;
                              |FINSI;
                         |SIGUE;
                         |SI #labtraba#89 ! 0; |Y #nomvarca#4 = 0;
                              aAlfa = #labtraba#125;   || si resulta que tengo
                              aAlfa = aAlfa % -104;    || dos IT, una que viene
                              nNume1 = aAlfa;           || del a¤o anterior y otra
                              |SI nNume1 ! nElAny;      || entonces la segunda es
                                   swPrimera = 1;      || la primera del a¤o
                              |FINSI;                  || seguro
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI dreca_0 > 0;
                    denfe_0 = denfe_0 + dreca_0;
               |FINSI;
               swSigue = 0;
               |SI para1 = 1; swSigue = 1; |FINSI;
               |SI para1 = 2; |Y #nomvarca#12 = "D"; swSigue = 1; |FINSI;
               |SI swSigue = 1;
                    denfe_t = denfe_t + denfe_0;   || suma dias enferm. actual
               |SINO;
                    denfe_t = denfe_t + dreca_0;   || suma dias recaida
               |FINSI;
               |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y para1 = swControlIT; |Y para1 ! 1;
                    || para para = 1 ya lo habia sumado antes
                    denfe_t = denfe_t + denfe_0;   || suma dias enferm. actual
               |FINSI;
               |SI swPrimera = 1;
                         |SI denfe_t > #14#3; |Y #14#3 ! 0;
                              denfe_U0 = #14#3 - #14#2 + 1;
                         |SINO;
                              denfe_U0 = denfe_t;
                         |FINSI;

                         |SI denfe_t > #14#115; |Y #14#115 ! 0;
                              denfe_T0 = #14#115 - #14#114 + 1;
                         |SINO;
                              denfe_T0 = denfe_t - denfe_U0;
                         |FINSI;

                         |SI denfe_t > #14#196; |Y #14#196 ! 0;
                              denfe_S0 = #14#196 - #14#195 + 1;
                         |SINO;
                              denfe_S0 = denfe_t - denfe_U0 - denfe_T0;
                         |FINSI;

                         |SI denfe_t > #14#205; |Y #14#205 ! 0;
                              denfe_R0 = #14#205 - #14#204 + 1;
                         |SINO;
                              denfe_R0 = denfe_t - denfe_U0 - denfe_T0 - denfe_S0;
                         |FINSI;
                         denfe_Z0 = denfe_U0 + denfe_T0 + denfe_S0 + denfe_R0;
               |FINSI;

               |SI denfe_Z0 ] #14#11;  #14#11 = denfe_Z0 + 1;  |FINSI;
               |SI denfe_Z0 < #14#15;
                    |SI denfe_t > #14#15;
                         denfe_Y0 = #14#15 - #14#11 + 1;
                    |SINO;
                         denfe_Y0 = denfe_t - (denfe_Z0);
                    |FINSI;
               |FINSI;
               |SI denfe_Z0 ] #14#12;  #14#12 = denfe_Z0 + 1;  |FINSI;
               |SI denfe_Z0 < #14#16;
                    |SI denfe_t > #14#16;
                         denfe_X0 = #14#16 - #14#12 + 1;
                    |SINO;
                         denfe_X0 = denfe_t - (denfe_Y0 + denfe_Z0);
                    |FINSI;
               |FINSI;
               |SI denfe_Z0 ] #14#13;  #14#13 = denfe_Z0 + 1;  |FINSI;
               |SI denfe_Z0 < #14#17;
                    |SI denfe_t > #14#17;
                         denfe_W0 = #14#17 - #14#13 + 1;
                    |SINO;
                         denfe_W0 = denfe_t - (denfe_X0 + denfe_Y0 + denfe_Z0);
                    |FINSI;
               |FINSI;
               |SI denfe_Z0 ] #14#14;  #14#14 = denfe_Z0 + 1;  |FINSI;
               |SI denfe_Z0 < #14#18;
                    |SI denfe_t > #14#18;
                         denfe_V0 = #14#18 - #14#14 + 1;
                    |SINO;
                         denfe_V0 = denfe_t - (denfe_W0 + denfe_X0 + denfe_Y0 + denfe_Z0);
                    |FINSI;
               |FINSI;
          |FINSI;

          ||____________________________________/ QUITA DIAS MESES ANTERIORES
          ||SI para1 = 1;                      || (solo la primera vez)
               nume1 = denfe_20;
               nume2 = denfe_U0 + denfe_T0 + denfe_S0 + denfe_R0;
               |SI nume2 > 0;
                    denfe_NO = denfe_t - nume2;
                    nume1 = nume1 - denfe_NO;
                    |SI nume1 < 0;
                         nume1 = 0;
                    |FINSI;
               |FINSI;

               |SI nume2 > 0;
                    || si es 1ra. enfermedad

                    |SI denfe_R0 > nume1;
                         denfe_U0 = 0;
                         denfe_T0 = 0;
                         denfe_S0 = 0;
                         denfe_R0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_R0;
                    |FINSI;
                    |SI denfe_S0 > nume1;
                         denfe_U0 = 0;
                         denfe_T0 = 0;
                         denfe_S0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_S0;
                    |FINSI;
                    |SI denfe_T0 > nume1;
                         denfe_U0 = 0;
                         denfe_T0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_T0;
                    |FINSI;
                    |SI denfe_U0 > nume1;
                         denfe_U0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_U0;
                    |FINSI;
                    |SI dreca_0 > 0;
                         denfe_Z0 = denfe_Z0 - dreca_0;
                    |FINSI;
               |SINO;
                    nume2 = denfe_Y0 + denfe_X0 + denfe_W0 + denfe_V0;
                    |SI nume2 > 0;
                         denfe_NO = denfe_t - nume2;
                         nume1 = nume1 - denfe_NO;
                         |SI nume1 < 0;
                              nume1 = 0;
                         |FINSI;
                    |FINSI;

                    |SI denfe_V0 > nume1;
                         denfe_Z0 = 0;

                         denfe_Y0 = 0;
                         denfe_X0 = 0;
                         denfe_W0 = 0;
                         denfe_V0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_V0;
                    |FINSI;
                    |SI denfe_W0 > nume1;
                         denfe_Z0 = 0;

                         denfe_Y0 = 0;
                         denfe_X0 = 0;
                         denfe_W0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_W0;
                    |FINSI;
                    |SI denfe_X0 > nume1;
                         denfe_Z0 = 0;

                         denfe_Y0 = 0;
                         denfe_X0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_X0;
                    |FINSI;
                    |SI denfe_Y0 > nume1;
                         denfe_Z0 = 0;

                         denfe_Y0 = nume1;
                    |SINO;
                         nume1 = nume1 - denfe_Y0;
                    |FINSI;
                    |SI denfe_Z0 > nume1;
                         denfe_Z0 = nume1;
                    |FINSI;
               |FINSI;
          ||FINSI;

          denfe_Z = denfe_Z + denfe_Z0;
          denfe_U = denfe_U + denfe_U0;   || 1ra linea 1ra enfermedad
          denfe_T = denfe_T + denfe_T0;   || 2da linea 2da enfermedad
          denfe_S = denfe_S + denfe_S0;   || 3ra linea 2da enfermedad
          denfe_R = denfe_R + denfe_R0;   || 4ta linea 2da enfermedad

          denfe_Y = denfe_Y + denfe_Y0;
          denfe_X = denfe_X + denfe_X0;
          denfe_W = denfe_W + denfe_W0;
          denfe_V = denfe_V + denfe_V0;
          |HAZ ComplementoIT2;
          nPasoIT = 3; |HAZ RegistroIT;
     |FINSI;
|SIGUE;

||____________________________________/ CALCULA COMPLEMENTO ENFERMEDAD
denfe_3 = 0;         || inicializa acumuladores
anticom2 = 0;
anticom3 = 0;
diff_L = 0;
swComp120 = 0;
nImporte_E = 0;

|SI swSegPasada = 1;
     nPaso = 3; |HAZ CompAjuste;
|FINSI;
|HAZ CalPresENF;
|HAZ CalPresACC;

|SI #2#241 = "N"; |Y #nomcontr#49 = "N";
     denfe_S = 0; denfe_R = 0; denfe_W = 0; denfe_V = 0;
|FINSI;

|SI #2#241 = "N"; |Y #labtraba#138 = "N";
     denfe_SC = 0; denfe_RC = 0;
     denfe_WC = 0; denfe_VC = 0;
     |SI #nomcontr#48 = "N";
          denfe_UC = 0; denfe_TC = 0;
          denfe_YC = 0; denfe_XC = 0;
     |FINSI;
     |SI #nomcontr#49 = "N";
          denfe_SC = 0; denfe_RC = 0;
          denfe_WC = 0; denfe_VC = 0;
     |FINSI;
|FINSI;
|HAZ LimpiaDesglose;
|HAZ CalcCompEnf;        || Calcula complemento ENFERMEDAD
|HAZ CalcCompEnf_H;      || Calcula complemento ENFERMEDAD con Hospitalizacion
denfe_3 = denfe_3 + denfe_3_H;

||____________________________________/ DESGLOSA DIAS ACCIDENTE
     |HAZ AjusteAcc3_Comp;

     dacci_z = 0;   || simula linea 0 accidentes
     dacci_Z = 0;    || 1ra. linea accidentes
     dacci_Y = 0;    || 2da. linea accidentes
     dacci_y = 0;   || simula linea 3 accidentes
     dacci_z_H = 0;   || simula linea 0 accidentes
     dacci_Z_H = 0;    || 1ra. linea accidentes
     dacci_Y_H = 0;    || 2da. linea accidentes
     dacci_y_H = 0;   || simula linea 3 accidentes

     |PARA para1 = 1; |SI para1 [ 4; |HACIENDO para1 = para1 + 1;
          dacci_z0 = 0;   || simula linea 0 accidentes
          dacci_Z0 = 0;    || 1ra. linea accidentes
          dacci_Y0 = 0;    || 2da. linea accidentes
          dacci_y0 = 0;   || simula linea 3 accidentes
          dacci_z0_H = 0;   || simula linea 0 accidentes
          dacci_Z0_H = 0;    || 1ra. linea accidentes
          dacci_Y0_H = 0;    || 2da. linea accidentes
          dacci_y0_H = 0;   || simula linea 3 accidentes

          |SI para1 = 1; dacci_20 = dacci_21; |FINSI;
          |SI para1 = 2; dacci_20 = dacci_22; |FINSI;
          |SI para1 = 3; dacci_20 = dacci_23; |FINSI;
          |SI para1 = 4; dacci_20 = dacci_24; |FINSI;

          |SI para1 = 1;  dreca_0 = dreca_1; |FINSI;
          |SI para1 = 2;  dreca_0 = dreca_2; |FINSI;
          |SI para1 = 3;  dreca_0 = dreca_3; |FINSI;
          |SI para1 = 4;  dreca_0 = dreca_4; |FINSI;

          swSoyControlIT = 0;
          |HAZ OrigenControlIT;
          |SI dcont_2 > 0; |Y para1 = swControlIT; |Y #nomcontr#62 = "S";
          |Y aTipoOrigen = "A"; || libro de comentarios (7)
               |SI swAjuste3 ! 0; |Y swAjuste3_C ! 0;
                    dacci_20 = dcont_2 - swAjuste3;
               |SINO;
                    dacci_20 = dcont_2 - swAjuste3 - swAjuste3_C;
               |FINSI;
               dacci_t = dcont_2 + 365;
               |SI #labtraba#60 = "C";
                    dacci_0 = dacci_0 + #labtraba#92;
               |FINSI;
               swSoyControlIT = 1;
          |FINSI;

          |SI dacci_20 ! 0;        || si ha estado accidentado
               |SI swSoyControlIT = 0;
                    dacci_t = dacci_20; || suma los dias accidente actual

                    |SI dreca_0 > 0;
                         dacci_t = dacci_t + dreca_0;
                    |FINSI;
                    swSigue = 0;
                    |SI para1 = 1; swSigue = 1; |FINSI;
                    |SI para1 = 2; |Y #nomvarca#12 = "D"; swSigue = 1; |FINSI;
                    |SI swSigue = 1;
                         dacci_t = dacci_t + #2#92; || suma los dias accidente actual
                    |FINSI;
               |FINSI;

               |HAZ simula;

               |SI nHospi_Acc = 0;                || SIN hospitalizacion
                    |SI nz_H ! 0;
                         |SI dacci_t > nz_H;
                              dacci_z0 = nz_H - nz_D + 1;
                         |SINO;
                              dacci_z0 = dacci_t - nz_D + 1;
                         |FINSI;
                    |FINSI;

                    |SI #14#49 ! 0;
                         |SI dacci_t > #14#49;
                              dacci_Z0 = #14#49 - #14#47 + 1;
                         |SINO;
                              dacci_Z0 = dacci_t - dacci_z0;
                         |FINSI;
                    |FINSI;

                    |SI #14#50 ! 0;
                         |SI dacci_t > #14#50;
                              dacci_Y0 = #14#50 - #14#48 + 1;
                         |SINO;
                              dacci_Y0 = dacci_t - dacci_z0 - dacci_Z0;
                         |FINSI;
                    |FINSI;

                    |SI ny_H ! 0;
                         |SI dacci_t > ny_H;
                              dacci_y0 = ny_H - ny_D + 1;
                         |SINO;
                              dacci_y0 = dacci_t - dacci_z0 - dacci_Z0 - dacci_Y0;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI nz_H ! 0;
                         |SI dacci_t > nz_H;
                              dacci_z0_H = nz_H - nz_D + 1;
                         |SINO;
                              dacci_z0_H = dacci_t - nz_D + 1;
                         |FINSI;
                    |FINSI;

                    |SI dacci_t ! #14#170;
                         |SI dacci_t > #14#170;
                              dacci_Z0_H = #14#170 - #14#168 + 1;
                         |SINO;
                              dacci_Z0_H = dacci_t - dacci_z0_H;
                         |FINSI;
                    |FINSI;

                    |SI #14#171 ! 0;
                         |SI dacci_t > #14#171;
                              dacci_Y0_H = #14#171 - #14#69 + 1;
                         |SINO;
                              dacci_Y0_H = dacci_t - dacci_z0_H - dacci_Z0_H;
                         |FINSI;
                    |FINSI;

                    |SI ny_H ! 0;
                         |SI dacci_t > ny_H;
                              dacci_y0_H = ny_H - ny_D + 1;
                         |SINO;
                              dacci_y0_H = dacci_t - dacci_z0_H - dacci_Z0_H - dacci_Y0_H;
                         |FINSI;
                    |FINSI;
               |FINSI;
     ||____________________________________/ QUITA DIAS MESES ANTERIORES
               nume1 = dacci_20;
               |SI nHospi_Acc = 0;                || SIN hospitalizacion
                    |SI dacci_y0 > nume1;
                         dacci_z0 = 0;
                         dacci_Z0 = 0;
                         dacci_Y0 = 0;
                         dacci_y0 = nume1;
                    |SINO;
                         nume1 = nume1 - dacci_y0;
                    |FINSI;
                    |SI dacci_Y0 > nume1;
                         dacci_z0 = 0;
                         dacci_Z0 = 0;
                         dacci_Y0 = nume1;
                    |SINO;
                         nume1 = nume1 - dacci_Y0;
                    |FINSI;
                    |SI dacci_Z0 > nume1;
                         dacci_z0 = 0;
                         dacci_Z0 = nume1;
                    |SINO;
                         nume1 = nume1 - dacci_Z0;
                    |FINSI;
                    |SI dacci_z0 > nume1;
                         dacci_z0 = nume1;
                    |FINSI;
               |SINO;
                    |SI dacci_y0_H > nume1;
                         dacci_z0_H = 0;
                         dacci_Z0_H = 0;
                         dacci_Y0_H = 0;
                         dacci_y0_H = nume1;
                    |SINO;
                         nume1 = nume1 - dacci_y0_H;
                    |FINSI;
                    |SI dacci_Y0_H > nume1;
                         dacci_z0_H = 0;
                         dacci_Z0_H = 0;
                         dacci_Y0_H = nume1;
                    |SINO;
                         nume1 = nume1 - dacci_Y0_H;
                    |FINSI;
                    |SI dacci_Z0_H > nume1;
                         dacci_z0_H = 0;
                         dacci_Z0_H = nume1;
                    |SINO;
                         nume1 = nume1 - dacci_Z0_H;
                    |FINSI;
                    |SI dacci_z0_H > nume1;
                         dacci_z0_H = nume1;
                    |FINSI;
               |FINSI;
          |FINSI;
          dacci_z = dacci_z + dacci_z0;
          dacci_Z = dacci_Z + dacci_Z0;
          dacci_Y = dacci_Y + dacci_Y0;
          dacci_y = dacci_y + dacci_y0;
          dacci_z_H = dacci_z_H + dacci_z0_H;
          dacci_Z_H = dacci_Z_H + dacci_Z0_H;
          dacci_Y_H = dacci_Y_H + dacci_Y0_H;
          dacci_y_H = dacci_y_H + dacci_y0_H;
          nPasoIT = 3; |HAZ RegistroIT;
     |SIGUE;
||____________________________________/ CALCULA COMPLEMENTO ACCIDENTE
          dacci_3 = 0;         || inicializa acumuladores

          |SI swSegPasada = 1;
              nPaso = 3; |HAZ CompAjuste;
          |FINSI;
          |SI nHospi_Acc = 0;                || SIN hospitalizacion
               |HAZ CalcCompAcc;
          |SINO;                             || CON hospitalizacion
               |HAZ CalcCompAcc_H;
          |FINSI;
          dacci_3 = dacci_3;
|FPRC;

|PROCESO CalPresACC;
     || este proceso calcula que prestacion cobra el trabajador por tramo
     || de complemento en ACCIDENTE

     |HAZ AjusteAcc3_REV;     || voy a mirar prestaciones, no tengo que descontar
                              || el ajuste3
     dacci_ZC = 0; dacci_ZC_H = 0;      || 1ra. linea accidente
     dacci_YC = 0; dacci_YC_H = 0;      || 2da. linea accidente
     dacci_Z_BP = 0; dacci_Y_BP = 0;
     |PARA para1 = 1; |SI para1 [ 4; |HACIENDO para1 = para1 + 1;
          nume1 = 0;
          swSigue = 0;
          |SI para1 = 1; swSigue = 1; |FINSI;
          |SI para1 = 2; |Y #nomvarca#12 = "D"; swSigue = 1; |FINSI;
          |SI swSigue = 1;
               |SI #2#92 > 0;
                    nume1 = #2#92;
               |FINSI;
               nume1 = nume1 + dreca_1;
               nume2 = dacci_21 + nume1;
          |FINSI;
          |SI para1 = 2; nume1 = dreca_2; nume2 = dacci_22 + dreca_2;          |FINSI;
          |SI para1 = 3; nume1 = dreca_3; nume2 = dacci_23 + dreca_3;          |FINSI;
          |SI para1 = 4; nume1 = dreca_4; nume2 = dacci_24 + dreca_4;          |FINSI;
          nume1 = nume1 + 1;
          dacci_ZC0 = 0;    || 1da. linea accidente
          dacci_YC0 = 0;    || 2da. linea accidente

          nume9 = para1 + 30;
          |SI #7nume9 = "S";           || con Hospitalizacion
               nume3 = 168; nume4 = 170; nume5 = 172;
               nume6 = 169; nume7 = 171; nume8 = 173;
          |SINO;                       || sin Hospitalizacion
               nume3 = 47; nume4 = 49; nume5 = 51;
               nume6 = 48; nume7 = 50; nume8 = 52;
          |FINSI;

          |PARA nume1 = nume1; |SI nume1 [ nume2; |HACIENDO nume1 = nume1 + 1;
               |SI #nomconax#nume3# [ nume1; |Y nume1 [ #nomconax#nume4#;
               |Y #nomconax#nume3# ! 0; |Y #nomconax#nume4# ! 0; |Y #nomconax#nume5# ! 0;
                    dacci_ZC0 = dacci_ZC0 + ((nBasePresAcc * .75) ! 2);
                    nPresDiaAcc = (nBasePresEnf * .75) ! 2;
                    dacci_Z_BP = nPresDiaAcc;
               |FINSI;
               |SI #nomconax#nume6# [ nume1; |Y nume1 [ #nomconax#nume7#;
               |Y #nomconax#nume6# ! 0; |Y #nomconax#nume7# ! 0; |Y #nomconax#nume8# ! 0;
                    dacci_YC0 = dacci_YC0 + ((nBasePresAcc * .75) ! 2)
                    nPresDiaAcc = (nBasePresEnf * .75) ! 2;
                    dacci_Y_BP = nPresDiaAcc;
               |FINSI;
          |SIGUE;

          dacci_ZC = dacci_ZC + dacci_ZC0;
          dacci_YC = dacci_YC + dacci_YC0;

          |SI #7nume9 = "S";           || con Hospitalizacion
               dacci_ZC_H = dacci_ZC_H + dacci_ZC0;
               dacci_YC_H = dacci_YC_H + dacci_YC0;
          |FINSI;
          |SI dacci_ZC > 0; |O dacci_YC > 0
               nPasoIT = 4; |HAZ RegistroIT;
          |FINSI;
     |SIGUE;

     |HAZ AjusteAcc3_Pres;    || para que vuelva a estar como estaba
|FPRC;

|PROCESO CalPresENF;
     || este proceso calcula que prestacion cobra el trabajador por tramo
     || de complemento
     nume0 = denfe_2;
     |HAZ AjusteEnf3_REV;     || voy a mirar prestaciones, no tengo que descontar
                              || el ajuste3
     denfe_UC = 0;    || 1ra. linea 1ra. enfermedad
     denfe_TC = 0;    || 2da. linea 1ra. enfermedad
     denfe_SC = 0;    || 3ra. linea 1ra. enfermedad
     denfe_RC = 0;    || 4ta. linea 1ra. enfermedad
     denfe_YC = 0;    || 1ra. linea resto enfermedades
     denfe_XC = 0;    || 2da. linea resto enfermedades
     denfe_WC = 0;    || 3ra. linea resto enfermedades
     denfe_VC = 0;    || 4ta. linea resto enfermedades
     || Bases para prestaciones en cada tramo de complemento, me haran falta
     || despues para ajustar
     denfe_UY_BP = 0; denfe_TX_BP = 0; denfe_SW_BP = 0; denfe_RV_BP = 0;

     |PARA para1 = 1; |SI para1 [ 4; |HACIENDO para1 = para1 + 1;
          |SI nBaseIT2 ! 0; |Y nDiasEnfBase2 ! 0; |Y para1 ] 2; nBase = nBaseIT2;
          |SINO; nBase = nBasePresEnf; |FINSI;

          |SI para1 = 1; nume0 = #2#89 + dreca_1; nume10 = denfe_21 + nume0;  |FINSI;
          |SI para1 = 2; nume0 = dreca_2;         nume10 = denfe_22 + nume0;  |FINSI;
          |SI para1 = 3; nume0 = dreca_3;         nume10 = denfe_23 + nume0;  |FINSI;
          |SI para1 = 4; nume0 = dreca_4;         nume10 = denfe_24 + nume0;  |FINSI;
          nume0 = nume0 + 1;

             || a ver esto no tiene sentido, en ctrol IT no hay prestacion
               || de todos modos lo comento de momento || migue desde aqui
          |HAZ OrigenControlIT;
          |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y para1 = swControlIT;
          |Y aTipoOrigen = "E";
               nume0 = 365;
               |SI #labtraba#60 = "C"; nume0 = nume0 + #labtraba#89; |FINSI;
               nume10 = nume0 + dcont_2;
               nume0 = nume0 + 1;
          |FINSI;                                      || migue hasta aqui

          denfe_UC0 = 0;    || 1ra. linea 1ra. enfermedad
          denfe_TC0 = 0;    || 2da. linea 1ra. enfermedad
          denfe_SC0 = 0;    || 3ra. linea 1ra. enfermedad
          denfe_RC0 = 0;    || 4ta. linea 1ra. enfermedad
          denfe_YC0 = 0;    || 1ra. linea resto enfermedades
          denfe_XC0 = 0;    || 2da. linea resto enfermedades
          denfe_WC0 = 0;    || 3ra. linea resto enfermedades
          denfe_VC0 = 0;    || 4ta. linea resto enfermedades
          nume9 = para1 + 30;
          swPrimera = 1;
          |HAZ BuscaPE;
          |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y para1 = swControlIT;
               |HAZ PrimeraControlIT;
          |FINSI;
          |SI swPrimera = 1;
               |SI #7nume9 = "S";           || con Hospitalizacion
                    nume5 = 213; nume6 = 214; nume7 = 222; nume8 = 223;
                    nume1 = 123; nume2 = 124; nume3 = 186; nume4 = 187;
               |SINO;                       || sin Hospitalizacion
                    nume1 = 2; nume2 = 3; nume3 = 114; nume4 = 115;
                    nume5 = 195; nume6 = 196; nume7 = 204; nume8 = 205;
               |FINSI;
          |SINO;
               |SI #7nume9 = "S";           || con Hospitalizacion
                    nume1 = 132; nume2 = 136; nume3 = 133; nume4 = 137;
                    nume5 = 134; nume6 = 138; nume7 = 135; nume8 = 139;
               |SINO                        || sin Hospitalizacion
                    nume1 = 11; nume2 = 15; nume3 = 12; nume4 = 16;
                    nume5 = 13; nume6 = 17; nume7 = 14; nume8 = 18;
               |FINSI;
          |FINSI;
          |PARA nume0 = nume0; |SI nume0 [ nume10; |HACIENDO nume0 = nume0 + 1;
               nPresDiaEnf = 0;
               |SI #nomconax#nume1# [ nume0; |Y nume0 [ #nomconax#nume2#;
               |Y #nomconax#nume1# ! 0; |Y #nomconax#nume2# ! 0;
                    |SI 0 [ nume0; |Y nume0 [ 3;    nPresDiaEnf = 0;                |FINSI;
                    |SI 4 [ nume0; |Y nume0 [ 15;   nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 16 [ nume0; |Y nume0 [ 20;  nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 21 [ nume0;                 nPresDiaEnf = (nBase * .75) ! 2; |FINSI;
                    denfe_UC0 = denfe_UC0 + nPresDiaEnf;
                    denfe_UY_BP = nPresDiaEnf;
               |FINSI;
               |SI #nomconax#nume3# [ nume0; |Y nume0 [ #nomconax#nume4#;
               |Y #nomconax#nume3# ! 0; |Y #nomconax#nume4# ! 0;
                    |SI 0 [ nume0; |Y nume0 [ 3;    nPresDiaEnf = 0;                |FINSI;
                    |SI 4 [ nume0; |Y nume0 [ 15;   nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 16 [ nume0; |Y nume0 [ 20;  nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 21 [ nume0;                 nPresDiaEnf = (nBase * .75) ! 2; |FINSI;
                    denfe_TC0 = denfe_TC0 + nPresDiaEnf;
                    denfe_TX_BP = nPresDiaEnf;
               |FINSI;
               |SI #nomconax#nume5# [ nume0; |Y nume0 [ #nomconax#nume6#; |Y #nomconax#nume6# ! 0;
               |Y #nomconax#nume5# ! 0; |Y #nomconax#nume6# ! 0;
                    |SI 0 [ nume0; |Y nume0 [ 3;    nPresDiaEnf = 0;                |FINSI;
                    |SI 4 [ nume0; |Y nume0 [ 15;   nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 16 [ nume0; |Y nume0 [ 20;  nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 21 [ nume0;                 nPresDiaEnf = (nBase * .75) ! 2; |FINSI;
                    denfe_SC0 = denfe_SC0 + nPresDiaEnf;
                    denfe_SW_BP = nPresDiaEnf;
               |FINSI;
               |SI #nomconax#nume7# [ nume0; |Y nume0 [ #nomconax#nume8#;
               |Y #nomconax#nume7# ! 0; |Y #nomconax#nume8# ! 0;
                    |SI 0 [ nume0; |Y nume0 [ 3;    nPresDiaEnf = 0;                |FINSI;
                    |SI 4 [ nume0; |Y nume0 [ 15;   nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 16 [ nume0; |Y nume0 [ 20;  nPresDiaEnf = (nBase * .60) ! 2; |FINSI;
                    |SI 21 [ nume0;                 nPresDiaEnf = (nBase * .75) ! 2; |FINSI;
                    denfe_RC0 = denfe_RC0 + nPresDiaEnf;
                    denfe_RV_BP = nPresDiaEnf;
               |FINSI;
          |SIGUE;

          swPrimera = 1;
          |HAZ BuscaPE;
          |SI dcont_2 > 0; |Y #nomcontr#62 = "S"; |Y para1 = swControlIT;
               |HAZ PrimeraControlIT;
          |FINSI;
          |SI swPrimera = 1;
               denfe_UC = denfe_UC + denfe_UC0;        || la 1¦ del a¤o
               denfe_TC = denfe_TC + denfe_TC0;
               denfe_SC = denfe_SC + denfe_SC0;
               denfe_RC = denfe_RC + denfe_RC0;
          |SINO;
               denfe_YC0 =  denfe_UC0; denfe_UC0 = 0;   || no es la
               denfe_XC0 =  denfe_TC0; denfe_TC0 = 0;   || 1¦ del a¤o
               denfe_WC0 =  denfe_SC0; denfe_SC0 = 0;
               denfe_VC0 =  denfe_RC0; denfe_RC0 = 0;

               denfe_YC = denfe_YC + denfe_YC0;
               denfe_XC = denfe_XC + denfe_XC0;
               denfe_WC = denfe_WC + denfe_WC0;
               denfe_VC = denfe_VC + denfe_VC0;
          |FINSI;

          nPasoIT = 4; |HAZ RegistroIT;
     |SIGUE;

     |HAZ AjusteEnf3_Pres;    || para que vuelva a estar como estaba
|FPRC;

|PROCESO CompBaseComp;
     || esto se hace porque al redondear a 2 decimales el promedio para la
     || prestacion y el complemento, puede ser que en total no cuadre con
     || el promedio cuando es al 100%, mirar 1624.2186
     nNume1 = (nBaseCompTramo + nBasePresTramo) - nPromedio;
     |SI nNume1 > 0; |Y nNume1 < 0.10;
          || por ejemplo un margen de 10 centimos de prestacion
          nBaseCompTramo = nBaseCompTramo - nNume1;
     |FINSI;
|FPRC;

|PROCESO CalcCompEnf;
     aTipoIT = "E";
     nPromedio = prom_enf;
     |SI denfe_U ! 0; |Y #14#5 ! " ";        || si no es cero         1RA. LINEA 1RA. ENFERMEDAD
          |SI #14#5 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#04/100) ! 2);
               nBasePresTramo = denfe_UY_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_U - denfe_U_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_U_Base2 * (nBaseIT2 * (#14#04/100) ! 2));
          |SINO;
               desde = 6;
               hasta = 10;
               porce = #14#04;
               |HAZ acumcomp;
               |SI denfe_U > divide;    || porque si estoy todo el mes de baja
                    denfe_U = divide;   || he dividido antes por 30 si soy mensual
               |FINSI;                  || y tengo que multiplicar por 30 ahora
               denfe_3 = denfe_3 +(dacum_999 * denfe_U);
               |SI #14#5 = "H";
                    anticom0 = ((dacum_999 * denfe_U) - denfe_UC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 51; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_T ! 0; |Y #14#117 ! " ";        || si no es cero         2DA. LINEA 1RA. ENFERMEDAD
          |SI #14#117 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#116/100) ! 2);
               nBasePresTramo = denfe_TX_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_T - denfe_T_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_T_Base2 * (nBaseIT2 * (#14#116/100) ! 2));
          |SINO;
               desde = 118;
               hasta = 122;
               porce = #14#116;
               |HAZ acumcomp;
               denfe_3 = denfe_3 +(dacum_999 * denfe_T);
               |SI #14#117 = "H";
                    anticom0 = ((dacum_999 * denfe_T) - denfe_TC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 52; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;

     |SI denfe_S ! 0; |Y #14#198 ! " ";        || si no es cero         3RA. LINEA 1RA. ENFERMEDAD
          |SI #14#198 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#197/100) ! 2);
               nBasePresTramo = denfe_SW_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_S - denfe_S_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_S_Base2 * (nBaseIT2 * (#14#197/100) ! 2));
          |SINO;
               desde = 199;
               hasta = 203;
               porce = #14#197;
               |HAZ acumcomp;
               denfe_3 = denfe_3 + (dacum_999 * denfe_S);
               |SI #14#198 = "H";
                    anticom0 = ((dacum_999 * denfe_S) - denfe_SC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 53; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_R ! 0; |Y #14#207 ! " ";        || si no es cero         4TA. LINEA 1RA. ENFERMEDAD
          |SI #14#207 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#206/100) ! 2);
               nBasePresTramo = denfe_RV_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_R - denfe_R_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_R_Base2 * (nBaseIT2 * (#14#206/100) ! 2));
          |SINO;
               desde = 208;
               hasta = 212;
               porce = #14#206;
               |HAZ acumcomp;
               denfe_3 = denfe_3 + (dacum_999 * denfe_R);
               |SI #14#207 = "H";
                    anticom0 = ((dacum_999 * denfe_R) - denfe_RC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 54; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;

     |SI denfe_Y ! 0; |Y #14#23 ! " ";        || 1RA. LIN. 2DA. ENF.
          |SI #14#23 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#19/100) ! 2);
               nBasePresTramo = denfe_UY_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_Y - denfe_Y_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_Y_Base2 * (nBaseIT2 * (#14#19/100) ! 2));
          |SINO;
               desde = 27;
               hasta = 31;
               porce = #14#19;
               |HAZ acumcomp;
               |SI denfe_Y > divide;    || porque si estoy todo el mes de baja
                    denfe_Y = divide;   || he dividido antes por 30 si soy mensual
               |FINSI;                  || y tengo que multiplicar por 30 ahora
               denfe_3 = denfe_3 + (dacum_999 * denfe_Y);
               |SI #14#23 = "H";
                    anticom0 = ((dacum_999 * denfe_Y) - denfe_YC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 51; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_X ! 0; |Y #14#24 ! " ";        || 2DA. LIN. 2DA. ENF.
          |SI #14#24 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#20/100) ! 2);
               nBasePresTramo = denfe_TX_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_X - denfe_X_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_X_Base2 * (nBaseIT2 * (#14#20/100) ! 2));
          |SINO;
               desde = 32;
               hasta = 36;
               porce = #14#20;
               |HAZ acumcomp;
               denfe_3 = denfe_3 +(dacum_999 * denfe_X);
               |SI #14#24 = "H";
                    anticom0 = ((dacum_999 * denfe_X) - denfe_XC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 52; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_W ! 0; |Y #14#25 ! " ";        || 3RA. LIN. 2DA. ENF.
          |SI #14#25 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#21/100) ! 2);
               nBasePresTramo = denfe_SW_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_W - denfe_W_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_W_Base2 * (nBaseIT2 * (#14#21/100) ! 2));
          |SINO;
               desde = 37;
               hasta = 41;
               porce = #14#21;
               |HAZ acumcomp;
               denfe_3 = denfe_3 +(dacum_999 * denfe_W);
               |SI #14#25 = "H";
                    anticom0 = ((dacum_999 * denfe_W) - denfe_WC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 53; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_V ! 0; |Y #14#26 ! " ";        || 4TA. LIN. 2DA. ENF.
          |SI #14#26 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio * (#14#22/100) ! 2);
               nBasePresTramo = denfe_RV_BP;
               |HAZ CompBaseComp;
               denfe_3 = denfe_3 + ((denfe_V - denfe_V_Base2) * nBaseCompTramo);
               denfe_3 = denfe_3 + (denfe_V_Base2 * (nBaseIT2 * (#14#22/100) ! 2));
          |SINO;
               desde = 42;
               hasta = 46;
               porce = #14#22;
               |HAZ acumcomp;
               denfe_3 = denfe_3 +(dacum_999 * denfe_V);
               |SI #14#26 = "H";
                    anticom0 = ((dacum_999 * denfe_V) - denfe_VC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 54; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_3 > 0; |O anticom2 > 0; |O anticom3 > 0;
          |SI swCumple = 0;
               denfe_3 = 0;
               anticom2 = 0;
               anticom3 = 0;
               nIncid = 8;
               |HAZ graba_inc;
          |FINSI;
     |FINSI;
     |SI nDesEnf ! 0; |Y denfe_3 ! 0;
          || tengo desempleo y accidente a la vez
          || ajusto los dias de accidente a la jornada del ERE
          denfe_3 = denfe_3 * (1 - (nPropDesTP / 100));
     |FINSI;
|FPRC;

|PROCESO CalcCompEnf_H;
     |SI swCumple = 0;
          |ACABA;
     |FINSI;
     aTipoIT = "E";
     |SI denfe_U_H ! 0; |Y #14#126 ! " ";        || si no es cero         1RA. LINEA 1RA. ENFERMEDAD
          |SI #14#126 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_U_H * (prom_enf * (#14#125/100) ! 2));
          |SINO;
               desde = 127;
               hasta = 131;
               porce = #14#125;
               |HAZ acumcomp;
               |SI denfe_U_H > divide;    || porque si estoy todo el mes de baja
                    denfe_U_H = divide;   || he dividido antes por 30 si soy mensual
               |FINSI;                    || y tengo que multiplicar por 30 ahora
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_U_H);
               |SI #14#126 = "H";
                    anticom0 = ((dacum_999 * denfe_U_H) - denfe_UC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 51; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_T_H ! 0; |Y #14#189 ! " ";        || si no es cero         2DA. LINEA 2DA. ENFERMEDAD
          |SI #14#189 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_T_H * (prom_enf * (#14#188/100) ! 2));
          |SINO;
               desde = 190;
               hasta = 194;
               porce = #14#188;
               |HAZ acumcomp;
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_T_H);
               |SI #14#189 = "H";
                    anticom0 = ((dacum_999 * denfe_T_H) - denfe_TC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 52; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_S_H ! 0; |Y #14#216 ! " ";        || si no es cero         1RA. LINEA 1RA. ENFERMEDAD
          |SI #14#216 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_S_H * (prom_enf * (#14#215/100) ! 2));
          |SINO;
               desde = 217;
               hasta = 221;
               porce = #14#215;
               |HAZ acumcomp;
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_S_H);
               |SI #14#216 = "H";
                    anticom0 = ((dacum_999 * denfe_S_H) - denfe_SC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 53; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_R_H ! 0; |Y #14#225 ! " ";        || si no es cero         2DA. LINEA 2DA. ENFERMEDAD
          |SI #14#225 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_R_H * (prom_enf * (#14#224/100) ! 2));
          |SINO;
               desde = 226;
               hasta = 230;
               porce = #14#224;
               |HAZ acumcomp;
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_R_H);
               |SI #14#225 = "H";
                    anticom0 = ((dacum_999 * denfe_R_H) - denfe_RC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 54; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;

     |SI denfe_Y_H ! 0; |Y #14#144 ! " ";        || si no es cero
          |SI #14#144 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_Y_H * (prom_enf * (#14#140/100) ! 2));
          |SINO;
               desde = 148;
               hasta = 152;
               porce = #14#140;
               |HAZ acumcomp;
               |SI denfe_Y_H > divide;    || porque si estoy todo el mes de baja
                    denfe_Y_H = divide;   || he dividido antes por 30 si soy mensual
               |FINSI;                    || y tengo que multiplicar por 30 ahora
               denfe_3_H = denfe_3_H + (dacum_999 * denfe_Y_H);
               |SI #14#144 = "H";
                    anticom0 = ((dacum_999 * denfe_Y_H) - denfe_YC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 51; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_X_H ! 0; |Y #14#145 ! " ";        || si no es cero
          |SI #14#145 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_X_H * (prom_enf * (#14#141/100) ! 2));
          |SINO;
               desde = 148;
               hasta = 152;
               porce = #14#140;
               |HAZ acumcomp;
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_X_H);
               |SI #14#145 = "H";
                    anticom0 = ((dacum_999 * denfe_X_H) - denfe_XC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 52; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_W_H ! 0; |Y #14#146 ! " ";        || si no es cero
          |SI #14#146 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_W_H * (prom_enf * (#14#142/100) ! 2));
          |SINO;
               desde = 158;
               hasta = 162;
               porce = #14#142;
               |HAZ acumcomp;
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_W_H);
               |SI #14#146 = "H";
                    anticom0 = ((dacum_999 * denfe_W_H) - denfe_WC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 53; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_V_H ! 0; |Y #14#147 ! " ";        || si no es cero
          |SI #14#147 = "P";    || si es por promedio
               denfe_3_H = denfe_3_H + (denfe_V_H * (prom_enf * (#14#143/100) ! 2));
          |SINO;
               desde = 163;
               hasta = 167;
               porce = #14#143;
               |HAZ acumcomp;
               denfe_3_H = denfe_3_H +(dacum_999 * denfe_V_H);
               |SI #14#147 = "H";
                    anticom0 = ((dacum_999 * denfe_V_H) - denfe_VC);
                    anticom2 = anticom2 + anticom0;
               |FINSI;
          |FINSI;
          nPasoIT = 54; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI denfe_3 > 0; |O anticom2 > 0;
          |SI swCumple = 0;
               denfe_3 = 0;
               anticom2 = 0;
               nIncid = 8;
               |HAZ graba_inc;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AjusteAcc3_Pres;
     |SI #labtraba#42 = "D"; |Y #labtraba#64 = "M"; |ACABA; |FINSI;
     |SI swAjuste3 = 0; |Y swAjuste3_2 ! 0; |Y swaju_acc = 1;
          |SI dacci_24 ! 0; dacci_24 = dacci_24 - swAjuste3_2; |ACABA; |FINSI;
          |SI dacci_23 ! 0; dacci_23 = dacci_23 - swAjuste3_2; |ACABA; |FINSI;
          |SI dacci_22 ! 0; dacci_22 = dacci_22 - swAjuste3_2; |ACABA; |FINSI;
          |SI dacci_21 ! 0; dacci_21 = dacci_21 - swAjuste3_2; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO AjusteAcc3_Comp;
     swSigue = 0;
     |SI swAjuste3_C ! 0;
          |SI denfe_21 = 0; |Y denfe_22 = 0; |Y denfe_23 = 0; |Y denfe_24 = 0;
               |SI dcont_2 = 0;
               || ojo: en caso de enfermedad y accidente el mismo mes en mes
               || de 31 dias (con ajuste) no tengo que usar esto en el accid.
               || ya que el dia que me sobra para cotizar lo quito de la enf.
               || 27.05.2010 - 00766.00749
               || pero si tengo ctrol IT no tengo que ajustar 05.06.2012
                   swSigue = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |SI dacci_24 ! 0; dacci_24 = dacci_24 - swAjuste3_C; |ACABA; |FINSI;
          |SI dacci_23 ! 0; dacci_23 = dacci_23 - swAjuste3_C; |ACABA; |FINSI;
          |SI dacci_22 ! 0; dacci_22 = dacci_22 - swAjuste3_C; |ACABA; |FINSI;
          |SI dacci_21 ! 0; dacci_21 = dacci_21 - swAjuste3_C; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalcCompAcc;
     aTipoIT = "A";
     nPromedio = prom_acc;
     |SI nBaseIT2 ! 0; |Y nDiasAccBase2 ! 0; nPromedio = nBaseIT2; |FINSI;
     |SI dacci_Z ! 0; |Y #14#53 ! " ";        || si no es cero
          |SI #14#53 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio + prom_ac2) * ((#14#51/100) ! 2);
               nBasePresTramo = dacci_Y_BP;
               |HAZ CompBaseComp;
               dacci_3 = dacci_3 + (dacci_Z * nBaseCompTramo);
          |SINO;
               desde = 55;
               hasta = 59;
               porce = #14#51;
               |HAZ acumcomp;
               |SI #14#53 = "H";
                    anticom3 = anticom3 + ((dacum_999 * dacci_Z) - dacci_ZC);
               |SINO;
                    dacci_3 = dacci_3 + (dacum_999 * dacci_Z);
               |FINSI;
          |FINSI;
          nPasoIT = 56; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI dacci_Y ! 0; |Y #14#54 ! " ";        || si no es cero
          |SI #14#54 = "P";    || si es por promedio
               nBaseCompTramo = (nPromedio + prom_ac2) * ((#14#52/100) ! 2);
               nBasePresTramo = dacci_Z_BP;
               |HAZ CompBaseComp;
               dacci_3 = dacci_3 + (dacci_Y * nBaseCompTramo);
          |SINO;
               desde = 60;
               hasta = 64;
               porce = #14#52;
               |HAZ acumcomp;
               |SI #14#54 = "H";
                    anticom3 = anticom3 + ((dacum_999 * dacci_Y) - dacci_YC);
               |SINO;
                    dacci_3 = dacci_3 +(dacum_999 * dacci_Y);
               |FINSI;
          |FINSI;
          nPasoIT = 57; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI nDesAcc ! 0; |Y dacci_3 ! 0;
          || tengo desempleo y accidente a la vez
          || ajusto los dias de accidente a la jornada del ERE
          dacci_3 = dacci_3 * (1 - (nPropDesTP / 100));
     |FINSI;
|FPRC;

|PROCESO AjusteAcc3_H;
     |SI swAjuste3 ! 0;
          |SI dacci_Y_H ! 0; dacci_Y_H = dacci_Y_H - swAjuste3; |ACABA; |FINSI;
          |SI dacci_Z_H ! 0; dacci_Z_H = dacci_Z_H - swAjuste3; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalcCompAcc_H;
     aTipoIT = "A";
     |SI dacci_Z_H ! 0; |Y #14#174 ! " ";        || si no es cero
          |SI #14#174 = "P";    || si es por promedio
               dacci_3 = dacci_3 + (dacci_Z_H * ((prom_acc + prom_ac2) * (#14#172/100) ! 2));
          |SINO;
               desde = 176;
               hasta = 180;
               porce = #14#172;
               |HAZ acumcomp;
               |SI #14#174 = "H";
                    anticom3 = anticom3 + ((dacum_999 * dacci_Z_H) - dacci_ZC);
               |SINO;
                    dacci_3 = dacci_3 + (dacum_999 * dacci_Z_H);
               |FINSI;
          |FINSI;
          nPasoIT = 56; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
     |SI dacci_Y_H ! 0; |Y #14#175 ! " ";        || si no es cero
          |SI #14#175 = "P";    || si es por promedio
               dacci_3 = dacci_3 + (dacci_Y_H * ((prom_acc + prom_ac2) * (#14#173/100) ! 2));
          |SINO;
               desde = 181;
               hasta = 185;
               porce = #14#173;
               |HAZ acumcomp;
               |SI #14#175 = "H";
                    anticom3 = anticom3 + ((dacum_999 * dacci_Y_H) - dacci_YC);
               |SINO;
                    dacci_3 = dacci_3 + (dacum_999 * dacci_Y_H);
               |FINSI;
          |FINSI;
          nPasoIT = 57; |HAZ RegistroIT;
          dacum_999 = 0;
     |FINSI;
|FPRC;

|PROCESO anticomp;    || CALCULA EL ANTI-COMPLEMENTO
     |SI denfe_2 ! 0; |O dmate_2 ! 0; |O dacci_2 ! 0;
          dtodo_3 = anticom - (acum_53 + acum_54 + denfe_4);
          |SI dtodo_3 < 0;     dtodo_3 = 0;   |FINSI;
     |FINSI;
|FPRC;

|PROCESO anticomp2;    || CALCULA EL ANTI-COMPLEMENTO PARA AJUSTE "H"
     |SI denfe_2 ! 0; |O dcont_2 ! 0;
          || denfe_3 = anticom2 + diff_L - (acum_53 + denfe_4);
          /*
          || lo quito, mira el 2884.2898, si lo dejo, en casos en que haya
          || conceptos L a complementar y el anticom2 en tipo "H" sea negativo
          || no se resta, y ha de restarse
          |SI anticom2 < 0;
               anticom2 = 0;
          |FINSI;
          */
          denfe_3 = anticom2 + diff_L;
          |SI denfe_3 < 0;     denfe_3 = 0;   |FINSI;
     |FINSI;
|FPRC;

|PROCESO anticomp3;    || CALCULA EL ANTI-COMPLEMENTO
     |SI dacci_2 ! 0; |O dcont_2 ! 0;
          || dacci_3 = anticom3 + diff_L - acum_54;
          dacci_3 = dacci_3 + anticom3 + diff_L;
          |SI dacci_3 < 0;     dacci_3 = 0;   |FINSI;
     |FINSI;
|FPRC;

|PROCESO grabados;    || GRABA CONCEPTOS 511 Y 512
     swgracon = 1;     || para que grabe todos los campos
     swcongra = 0;     || para que no acumule si existe
     graba05 = "V";
     graba06 = 0;
     graba09 = 1;
     graba11 = 1;
     |SI denfe_3 ! 0;
          graba04 = 511;
          graba07 = 38;
          graba08 = "COMP.ENF";
          graba10 = denfe_3;
          |HAZ grabacon;
          acum_50 = acum_50 + denfe_3;
     |FINSI;

     |SI dacci_3 ! 0;
          graba04 = 512;
          graba07 = 39;
          graba08 = "COMP.ACC";
          graba10 = dacci_3;
          |HAZ grabacon;
          acum_50 = acum_50 + dacci_3;
     |FINSI;

     |SI dmate_3 ! 0;
          graba04 = 513;
          graba07 = 38;
          graba08 = "COMP.MAT";
          graba10 = dmate_3;
          |HAZ grabacon;
          acum_50 = acum_50 + dmate_3;
     |FINSI;

     |SI dtodo_3 ! 0;
          graba04 = 514;
          graba07 = 39;
          graba08 = "COMP.ILT";
          graba10 = dtodo_3;
          |HAZ grabacon;
          acum_50 = acum_50 + dtodo_3;
     |FINSI;

     |SI denfe_4 ! 0;
          graba04 = 515;
          graba07 = 37;
          graba08 = "ENF.EMP.";
          graba10 = denfe_4;
          |HAZ grabacon;
          acum_50 = acum_50 + denfe_4;
     |FINSI;
|FPRC;

||****************************************************************************
||    SUBRUTINAS DEL CALCULO DE LA ENFERMEDAD, ACCIDENTE Y COMPLEMENTOS
||****************************************************************************

|PROCESO comp_L;
     |HAZ CalenConcep;
     |HAZ calendar;
     conser3 = 0; conser4 = 0;
|FPRC;

|PROCESO acumcomp;   || LEE CONCEPTOS Y ACUMULA VALOR DE COMPLEMENTOS
     nume1 = 0;
     swComp120 = 0;
     nBaseComp = 0;
     |PARA campoc = desde; |SI campoc [ hasta; |HACIENDO campoc = campoc + 1;
          nume1 = nume1 + #14campoc;
     |SIGUE;
     |SI nume1 = 0;
          nume1 = 100;
          |PARA campoc = desde; |SI campoc [ hasta; |HACIENDO campoc = campoc + 1;
               |SI nume1 [ 400; #14campoc = nume1; |FINSI;
               nume1 = nume1 + 100;
          |SIGUE;
     |FINSI;
     |PARA campoc = desde; |SI campoc [ hasta; |HACIENDO campoc = campoc + 1;
          |SI #14campoc ! 0;
                                    desc = #14campoc; hasc = #14campoc;
               |SI #14campoc = 100;  desc = 101;      hasc = 199;     |FINSI;
               |SI #14campoc = 200;  desc = 201;      hasc = 208;     |FINSI;
               |SI #14campoc = 400;  desc = 401;      hasc = 420;     |FINSI;
               |PARA actc = desc; |SI actc [ hasc; |HACIENDO actc = actc + 1;
                    concepto = actc;   || bucle para los 100 y 400
                    nPrecioVar = 0;
                    nPrecioVarMes = 0;
                    doce = concepto;   || lee y acumula conceptos paga
                    swComp = 0;
                    |DDEFECTO #10;
                    #10#10 = "N"; || no es el defecto pero ha de ser asi aqui
                    #10#0 = #2#87; #10#2 = concepto; |LEE 000#10=;
                    |HAZ leedoce;
                    |SI FSalida = 0; |Y #12#6 = 1; |Y #10#10 = "S"; || si existe y el tipo es 1 !!!
                         swComp = 1;
                    |FINSI;
                    |SI #10#3 = "F"; |Y #10#4 = 0; |Y #10#10 = "S"; |Y #nomcontr#43 = 1;
                         swComp = 1;
                         |HAZ BuscaHistIT;
                         |SI nBaseComp = 0;
                              nPrecioVar = 0;
                              |HAZ BuscaMesAnt;
                              #12#9 = 1;
                              #12#10 = nPrecioVar;
                              nTotalPrecioVar = nTotalPrecioVar + (nPrecioVar - nPrecioVarMes);
                         |FINSI;
                    |FINSI;
                    |SI concepto = 120; |Y #labtraba#97 ] 2; |Y #labtraba#97 [ 4;
                    |Y #10#4 = 1; |Y #10#10 = "S"; || si es el 120 y el tipo es 1 !!!
                    || Y #12#6 = 1; |Y #10#10 = "S"; || si es el 120 y el tipo es 1 !!!
                    || estaba con el #12#6, pero en verdad tenia que ser el #10#4
                         |SI swSegPasada = 1;
                              swComp = 1;
                         |SINO;
                              swComp120 = 1;
                         |FINSI;
                    |FINSI;
                    |SI concepto ] 201; |Y concepto [ 208; |Y #10#10 = "S";
                         swComp = 1;
                    |FINSI;
                    |SI swComp = 1;
                         duni1_999 = #12#09;
                         duni2_999 = #12#11;
                         dvalo_999 = #12#10;
                         |HAZ el_divide;
                         |SI concepto ] 201; |Y concepto [ 208;
                              |HAZ Unid200c;
                         |FINSI;
                         swEoC = 0;
                         |SI #12#5 = "E"; |O #12#5 = "L";
                              |SI nPrecioVar = 0;        || dias laborables
                              || en diff_L vamos a guardar la diferencia entre
                              || lo que deberia haber cobrado por conceptos E y L
                              || E (seria igual con L pero de momento se queda asi)
                              || y lo que hemos cobrado en verdad, estos conceptos no
                              || los tenemos en cuenta en el calculo normal del
                              || complemento

                              || lo del nPrecioVar ! 0 es necesario
                              || por si es un variable del mes anterior
                                   swEoC = 1;
                              |FINSI;
                         |FINSI;
                         |SI swEoC = 1;        || dias laborables
                              |SI nVecesL = 0;
                                   || si tengo varios tramos, entro aqui una vez por
                                   || cada tramo que entre al proceso acumcomp y se acumula,
                                   || mas veces de la cuenta, y lo de
                                   || los conceptos L no se hace por tramo, se hace en total
                                   || con esta variable control que lo haga solo una vez
                                   |HAZ comp_L;
                                   |SI dvalo_999 ! 0;
                                        nDiasTeor_E = dialabo - dabse_2 - ajuste6;
                                        || nDiasReal_E = duni1_999 + ajuste6 + dabse_1 - dabse_2;
                                        nDiasReal_E = duni1_999;
                                        diff_L = diff_L + ((nDiasTeor_E - nDiasReal_E) * dvalo_999 * (porce / 100));
                                        nImporte_E = nImporte_E + (dvalo_999 * (porce / 100));
                                        || los dabse_s es para que me cuente con los decimales
                                        || correspondientes los absnetimos
                                   |FINSI;
                              |FINSI;
                         |SINO;
                              |SI duni1_999 ! 0;
                                   |SI concepto ! 120; |Y duni1_999 ! 1;
                                        product = (duni1_999 - dabse_2) * dvalo_999;
                                   |SINO;
                                        product = (duni1_999 - (dabse_2 / divide)) * dvalo_999;
                                   |FINSI;
                                   product = product ! EURODB;
                                   divide = divide - dabse_2;
                                   |HAZ DesgloseComp;
                                   dacum_999 = dacum_999+(((product / divide) * porce)/100);
                                   dacum_999_completo = dacum_999_completo+ (product / divide);
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    swComp = 0;
               |SIGUE;
          |FINSI;
     |SIGUE;

     |HAZ TotalDesglose;
     |SI swSegPasada = 0;     || cuando hay complementos de ajustes no redondeo
          dacum_999 = dacum_999 ! EURODB;    || ya que no me sale exacto
     |FINSI;
     swComp = 0;
     nVecesL = 1;
|FPRC;

||****************************************************************************
||                        CALCULO DE LA PRORRATA
||****************************************************************************

|PROCESO calpror;
     dvalo_pro = 0;   || acumulador total prorratas
     dvalo_pag = 0;   || acumulador total pagas
     daviso18 = 0;

     dvalo_201_A = 0; dvalo_202_A = 0; dvalo_203_A = 0; dvalo_204_A = 0;
     dvalo_205_A = 0; dvalo_206_A = 0; dvalo_207_A = 0; dvalo_208_A = 0;

     dunic_201 = 0; dunic_202 = 0; dunic_203 = 0; dunic_204 = 0;
     dunic_205 = 0; dunic_206 = 0; dunic_207 = 0; dunic_208 = 0; dunic_999 = 0;
     nDiferPror = 0;
     swPagasProrr = 0;
     |PARA paga = 1; |SI paga [ 8; |HACIENDO paga = paga + 1;
          swProrPaga = 1;     || estoy en CALCULO DE PRORRATA
          |HAZ empieza;
          swCalPror = 0;
          |SI runnom = "nomcalir"; #0#12 = "S"; |FINSI;
          |SI #0#12 ! "N"; |O #9mesco = 99; |O #9mesco ! #0#8;
               swCalPror = 1;
          |FINSI;
          |SI swCalPror = 0;  || deberia tenerla emitida y grabada, compruebo
               |HAZ compruebapaga; || que tengo grabago registro, si no en
               |SI #9hasta ! #9mesco; |Y #9mesco ! 99; |Y #9mesco = #0#8;
               |Y swbaja = 1;
                    || PAGA DIFERIDA EN EL MES QUE SE PAGA

                    || pero esto solo SI ES BAJA EN EL MES QUE SE PAGA
                    || mirar tiquet 001485.00324 que es cuando ha saltado
                    swCalPror = 1; || mirar tiquet 001485.00269
                    nDiferPror = 200 + paga;
               |FINSI;
          |FINSI;             || el propio proceso pongo a uno el swCalPror
          |SI runnom = "nomcalfi"; |Y #9mesco = nElMes;
               |SI #9hasta ! #9mesco; |Y #9mesco ! 99;
                    swCalPaga = 1;
                    || paga diferida, ojo !! calculala siempre en finiquito
               |SINO;
                    swCalPror = 0;
                    |HAZ compruebapaga;
               |FINSI;
          |FINSI;
          |SI swCalPror = 1;
               |SI #9diasp ! 0;|O #9porcp ! 0;
                    nQueBusca = 1;
                    |HAZ busca;
                    |SI swpro = 1;
                         |HAZ cal_cofi;           || calcula el valor del concepto 2xx
                                               || calcula coeficiente 2xx
                         |HAZ cal_unid;           || calcula las unidades del 2xx
                         |HAZ gracal_200;         || graba el concepto 2xx
                    |SINO;
                         duni1_200 = 0;
                         duni2_200 = 0;
                         dvalo_200 = 1;
                         |HAZ gracal_200;         || graba el concepto 2xx (vacio)
                    |FINSI;
                    |SI paga = 1;  dvalo_201 = dvalo_209; |FINSI;
                    |SI paga = 2;  dvalo_202 = dvalo_209; |FINSI;
                    |SI paga = 3;  dvalo_203 = dvalo_209; |FINSI;
                    |SI paga = 4;  dvalo_204 = dvalo_209; |FINSI;
                    |SI paga = 5;  dvalo_205 = dvalo_209; |FINSI;
                    |SI paga = 6;  dvalo_206 = dvalo_209; |FINSI;
                    |SI paga = 7;  dvalo_207 = dvalo_209; |FINSI;
                    |SI paga = 8;  dvalo_208 = dvalo_209; |FINSI;
              |FINSI;
          |FINSI;
          |SI swProrPaga = 11;   || deja la paga a "F"
               #labtraba#tipo_p# = "F";
          |FINSI;
     |SIGUE;                              || pasa las pagas de 1 a 8
|FPRC;

||****************************************************************************
||                   RUTINAS PARA EL CALCULO DE LA PRORRATA
||****************************************************************************

|PROCESO busca;  || BUSCA SI HAY PRORRATA EN LA PAGA ACTUAL Y VA CONTANDO DIAS
     mas = 0;
     rompe = 0;
     |SI #9hasta = #9desde; |Y #9dedia > #9hadia;  rompe = 1;  |FINSI;
     |SI #9hasta < #9desde; |O rompe = 1;
          nume1 = #0#9 - 1;
          des1  = #9desde;   des2 =       1;
          has1  =      12;   has2 = #9hasta;
          swSigue = 0;
          |SI nQueBusca = 1;            || en el periodo para prorrata!!:
               swSigue = 1;
          |FINSI;
          |SI nQueBusca = 2;
               swSigue1 = 0;
               |SI runnom = "nomcalfi"; swSigue1 = 1; |FINSI;
               |SI #labempre#39 = 1; |Y swbaja = 1; |Y #2#48 = "S";
                    swSigue1 = 1;
               |FINSI;
               || ****************** comentario (1) ************************
               |SI swSigue1 = 1;
                    |SI #9dedia < #9hadia;
                    || **************** comentario (2) ********************
                         swSigue = 1;
                    |FINSI;
               |FINSI;
                    || *************** comentario (3) ********************
               |SI #9mesco = 99;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI swSigue = 1;
               |SI #9desde [ #0#8;      ||  si ya ha empezado el ejer. actual
                    mas = 1;            ||  ejemplo: desde=4, hasta=3, actual=4
               |FINSI;                  ||  empieza a contar en este a¤o !!!
          |FINSI;
     |SINO;
          nume1 = #0#9;
          des1 = #9desde;   des2 =  0;
          has1 = #9hasta;   has2 = -1;
     |FINSI;
     anyo1 = nume1 + mas;
     anyo2 = #0#09 + mas;

     des = (anyo1 * 100) + #9desde;  || mes desde
     has = (anyo2 * 100) + #9hasta;  || mes hasta
     act = (#0#9  * 100) + #0#8;     || mes actual

     |SI act ] des; |Y act [ has;       swpro = 1;     |FINSI;

     |PARA pp = des1; |SI pp [ has1; |HACIENDO pp = pp + 1;
          anynum = anyo1;  |HAZ busca2;
     |SIGUE;
     |PARA pp = des2; |SI pp [ has2; |HACIENDO pp = pp + 1;
          anynum = anyo2;  |HAZ busca2;
     |SIGUE;

     mesnum = #9hasta;  anynum = anyo2;         |HAZ ulti_dia;

     |SI #2#64="D";|O #2#64="T";  pepulti=topemes;  |SINO;  pepulti=30;  |FINSI;
     |SI #9dedia !       0;  nume6=#9dedia-      1; |SINO;  nume6 = 0;   |FINSI;
     |SI #9hadia ! topemes;  nume7=pepulti-#9hadia; |SINO;  nume7 = 0;   |FINSI;
     |SI #9hadia = 28; |Y topemes = 29; nume7 = 0; |FINSI; || 6546.122 mirar si molesta

     perio = perio - (nume6 + nume7);
|FPRC;

|PROCESO busca2;
    topemes = 30;        || si es mensual cuenta por 30 los meses
|SI #2#64 = "D";|O #2#64 = "T";
        mesnum = pp;
    |HAZ ulti_dia;
|FINSI;
    perio = perio + topemes;
|FPRC;

|PROCESO cal_cofi;
     |SI #2tipo_p = "V";
          concep1 = 51 + paga;      || calcula el 1er. campo de conceptos
          concep2 = concep1 + 32;   || calcula el ultimo campo de concep.
          |PARA campo = concep1; |SI campo [ concep2; |HACIENDO campo=campo+8;
               |SI #9campo ! 0;
                    desc = #9campo;  hasc = #9campo;
                    |SI #9campo = 100; desc = 101; hasc = 199; |FINSI;
                    |SI #9campo = 400; desc = 401; hasc = 420; |FINSI;
                    |PARA actc = desc; |SI actc [ hasc; |HACIENDO actc=actc+1;
                         concepto = actc;    || bucle para los 100 y 400
                         |HAZ leeconcep; || lee y acumula conceptos paga
                    |SIGUE;
               |FINSI;              || si el concepto no es cero
          |SIGUE;                  || pasa los conceptos
     |SINO;
          |HAZ SimulaPaga;

          |SI #2tipo_p = "B";      || importe bruto
               dvalo_209 = #2ajus_p / #9diasp;
          |FINSI;
          reten_p = nIRPF1;
          |HAZ RetenPaga;

          |SI #2tipo_p = "L";      || importe liquido
               || dvalo_209 = ((#2ajus_p * 100) / (100 - nIRPF1)) / #9diasp;
               dvalo_209 = ((#2ajus_p * 100) / (100 - reten_p)) / #9diasp;
          |FINSI;
          dvalo_209 = dvalo_209 ! (EURODB + 2);     || valor pagas
          dvalo_200 = dvalo_209;                    || valor prorrata
          |SI nSimulaPaga > dvalo_200;
               daviso18 = paga;
          |FINSI;
     |FINSI;
     |SI #0#8 = #9desde;|Y #9dedia !      1;  estevale = 1;  |FINSI;
     |SI #0#8 = #9hasta;|Y #9hadia ! guarda;  estevale = 1;  |FINSI;
     |SI estevale = 1;
          |HAZ recuento;
          |SI #10#4=1;         || dias trabajados
               dcofi_999=(pdia_a-(pdia_b+pdia_c+pdia_d+pdia_e+pdia_f+pdia_g))/pdia_a;
          |FINSI;
          |SI #10#4=2;         || dias cotizados
               dcofi_999=(pdia_a-        pdia_c                      )/pdia_a;
          |FINSI;
     |SINO;
          |HAZ diaspaga;
          |SI #10#4 = 1; dcofi_999 = hcobr_0 / hdias_0;  |FINSI; || dias trabajados
          |SI #10#4 = 2; dcofi_999 = hcoti_0 / hdias_0;  |FINSI; || dias cotizados
          |SI dhuel_2 > 0; |Y #9mesco = 99; |Y #7#25 = "N";
               |SI #10#4 = 1; dcofi_999 = (hcobr_0 + dhuel_2) / hdias_0;  |FINSI; || dias trabajados
               |SI #10#4 = 2; dcofi_999 = (hcoti_0 + dhuel_2) / hdias_0;  |FINSI; || dias cotizados
          |FINSI;
     |FINSI;
     |SI #10#4 = 0;     dcofi_999 = 1;  |FINSI;   || sin descuento
     |SI dcofi_999 < 0; dcofi_999 = 0;  |FINSI;

     |SI paga = 1;  dcofi_201 = dcofi_999;   |FINSI;  || guarda los coeficientes
     |SI paga = 2;  dcofi_202 = dcofi_999;   |FINSI;  ||/de cada paga para usarlos
     |SI paga = 3;  dcofi_203 = dcofi_999;   |FINSI;  ||/en pagas que contienen
     |SI paga = 4;  dcofi_204 = dcofi_999;   |FINSI;  ||/a su vez pagas
     |SI paga = 5;  dcofi_205 = dcofi_999;   |FINSI;
     |SI paga = 6;  dcofi_206 = dcofi_999;   |FINSI;
     |SI paga = 7;  dcofi_207 = dcofi_999;   |FINSI;
     |SI paga = 8;  dcofi_208 = dcofi_999;   |FINSI;
|FPRC;

|PROCESO leeconcep;  || lee y acumula concepto para paga
    doce = concepto;
|HAZ ExcepPagas;
|SI swConceptoOFF = 1;
     |ACABA;
|FINSI;
|HAZ leedoce;
|SI FSalida = 0;
        duni1_999 = #12#09;
        duni2_999 = #12#11;
        dvalo_999 = #12#10;
    |SI #12#05="F";|Y duni1_999=0;|Y concepto!102; || si es calculo 'F' carga
            duni1_999 = 1;                         ||/las unidades con 1 !!!
    |FINSI;
    |SI concepto ] 201;|Y concepto [ 208;
        |SI concepto = 201;  dcofi_209 = dcofi_201;  |FINSI;
        |SI concepto = 202;  dcofi_209 = dcofi_202;  |FINSI; || cogemos las
        |SI concepto = 203;  dcofi_209 = dcofi_203;  |FINSI; ||/unidades
        |SI concepto = 204;  dcofi_209 = dcofi_204;  |FINSI; ||/originales
        |SI concepto = 205;  dcofi_209 = dcofi_205;  |FINSI; ||/para pagas
        |SI concepto = 206;  dcofi_209 = dcofi_206;  |FINSI; ||/que contienen
        |SI concepto = 207;  dcofi_209 = dcofi_207;  |FINSI; ||/pagas
        |SI concepto = 208;  dcofi_209 = dcofi_208;  |FINSI;

        || esto es para casos con el switch de la paga = 1
        |SI concepto = 201;  |Y dvalo_201_A = 1; dvalo_999 = dvalo_201;  |FINSI;
        |SI concepto = 202;  |Y dvalo_202_A = 1; dvalo_999 = dvalo_202;  |FINSI;
        |SI concepto = 203;  |Y dvalo_203_A = 1; dvalo_999 = dvalo_203;  |FINSI;
        |SI concepto = 204;  |Y dvalo_204_A = 1; dvalo_999 = dvalo_204;  |FINSI;
        |SI concepto = 205;  |Y dvalo_205_A = 1; dvalo_999 = dvalo_205;  |FINSI;
        |SI concepto = 206;  |Y dvalo_206_A = 1; dvalo_999 = dvalo_206;  |FINSI;
        |SI concepto = 207;  |Y dvalo_207_A = 1; dvalo_999 = dvalo_207;  |FINSI;
        |SI concepto = 208;  |Y dvalo_208_A = 1; dvalo_999 = dvalo_208;  |FINSI;

        duni1_999 = duni1_999 / dcofi_209;
    |FINSI;
    |HAZ cal_valo;   || va acumulando el valor de los 5
|FINSI;              || si el concepto existe en calculos
|FPRC;

|PROCESO el_divide;
|SI #12#05="D";                divide=dia_2;     |FINSI; || dias mes
|SI #12#05="M";                divide=dia_4;     |FINSI; || dias cotiz.
|SI #12#05="K";                divide=duni1_999; |FINSI; || dias lab./fes.
|SI #12#05="L";                divide=dia_4;     |FINSI; || dias lab./fes.
|SI #12#05="E";                divide=dia_4;     |FINSI; || dias lab./fes.
|SI #12#05="V";|O #12#05="A"; |O #12#05 = "F"; divide = 30; |FINSI; || fijos
|SI #12#05 = "H";
     |SI #labtraba#42 = "P";
          divide = dcoti_0;
     |SINO;
          divide = 30;
     |FINSI;
|FINSI;
|SI swComp = 1; |Y #12#05 = "F"; divide = dia_4; |FINSI;
|SI swComp = 1; |Y #12#05 = "P"; divide = dia_4; |FINSI;
|SI es_irregul = 1;|Y tpz ! 0;
    |DDEFECTO #40;
    |ABRE #40;                || si se carga con los dias de alta
        #40#0 = #2#87;        ||/se divide por los mismos
        #40#1 = #12#4;
    |LEE 000#40=;
    |SI #40#3 = "S";     divide = tpz;  |FINSI;
    |CIERRA #40;
|FINSI;
|FPRC;

|PROCESO cal_valo;   || CALCULA EL VALOR ACUMULADO DE LOS 5 CONCEPTOS POR PAGA
     |SALVA_FICHA #10;
     #10#0 = #2#87; #10#2 = concepto; |LEE 000#10=;
     nDiasMedia = #10#14;
     |REPON_FICHA #10;
     product = duni1_999 * dvalo_999;
     product = product ! EURODB;
     |SI #12#05 = "L"; |O #12#05 = "E";
          |SI #9tipos ! "P";
               product = nDiasMedia * dvalo_999;
          |FINSI;
     |FINSI;
     |SI #9tipos = "N";  || si es tipo 'N' o 'P'
          |HAZ el_divide;
     |SINO;
          divide = 100;
     |FINSI;
     |SI #12#05 = "E"; |O #12#05 = "L";
          |SI #9tipos ! "P";
               |HAZ cal_unid_E;
          |FINSI;
     |FINSI;

     |SI concepto ] 401; |Y concepto [ 420;       || valor prorratas
          |SI #9#140 = "S";
               dvalo_200 = dvalo_200 + (product / divide);
          |SINO;
               || un concepto 400 que no se prorratea dentro de una paga
               || si la paga es porcentual y luego forma parte de otra hay
               || qye hacer ciertos ajustes
               |SI #9tipos = "P";
                    |SI paga = 1;  dvalo_201_A = 1;    |FINSI;
                    |SI paga = 2;  dvalo_202_A = 1;    |FINSI;
                    |SI paga = 3;  dvalo_203_A = 1;    |FINSI;
                    |SI paga = 4;  dvalo_204_A = 1;    |FINSI;
                    |SI paga = 5;  dvalo_205_A = 1;    |FINSI;
                    |SI paga = 6;  dvalo_206_A = 1;    |FINSI;
                    |SI paga = 7;  dvalo_207_A = 1;    |FINSI;
                    |SI paga = 8;  dvalo_208_A = 1;    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |SI #12#05 = "E"; |O #12#05 = "L";
               |SI #9tipos ! "P";
                    dvalo_200 = dvalo_200 + (((product / nDiasMedia) * (nUni200_2 / nUni200_1)) ! EURODB);    || valor prorratas
               |SINO;
                    dvalo_200 = dvalo_200 + (product / divide);    || valor prorratas
               |FINSI;
          |SINO;
               dvalo_200 = dvalo_200 + (product / divide);    || valor prorratas
          |FINSI;
     |FINSI;
     |SI #12#05 = "E"; |O #12#05 = "L";
          |SI #9tipos ! "P";
               dvalo_209 = dvalo_209 + (((product / nDiasMedia) * (nUni200_2 / nUni200_1)) ! EURODB);    || valor prorratas
          |SINO;
               dvalo_209 = dvalo_209 + (product / divide);        || valor pagas
          |FINSI;
     |SINO;
          dvalo_209 = dvalo_209 + (product / divide);        || valor pagas
     |FINSI;
|FPRC;

|PROCESO cal_unid_E;   || CALCULA LAS UNIDADES DEL CONCEPTO 2xx para concep.E
|| bueno esto es una ayudita para saber ya ants de tiempo las unidades que se
|| van a pagar de paga, porque en funcion de eso voy a cobrar mas o menos
|| importe en la paga de los conceptos "E", vamos alla
     |SI es_irregul = 1;|Y tpz ! 0;
          pdia_0_E = tpz;
     |SINO;
          pdia_0_E = hdias_0;
     |FINSI;
     pdia_a_E = pdia_0_E;
     |SI dcofi_999 ! 0;
          duni1_200 = (pdia_a_E * #9diasp * dcofi_999) / perio;
     |SINO;
          duni1_200 = (pdia_a_E * #9diasp * 1) / perio;
     |FINSI;
     duni3_200 = (pdia_a_E * #9diasp *         1) / perio;     || entero
     |SI #9tipos = "P";   || pagas porcentuales
          duni1_200 = #9porcp * dcofi_999;
          duni3_200 = #9porcp *         1;                    || entero
     |FINSI;
     duni3_200 = duni3_200 ! 6;
     duni3_200 = duni3_200 / dia_4;
     |SI #7#26 = "S";
          duni2_200 = duni2_200-(duni3_200 * dabse_3);   || menos absent.
     |FINSI;
     duni2_200 = duni2_200-(duni3_200 * dperm_2);   || menos absent.

     duni1_200 = duni1_200 ! 6;
     duni2_200 = duni2_200 ! 6;

     nUni200_1 = duni1_200;        || unidades que resultaran en prorrata

     || duni1_200 = (pdia_a * pdia_a * dcofi_999) / perio;
     |SI dcofi_999 ! 0;
          duni1_200 = (pdia_a_E * ((nDiasMedia * (#9diasp / 30)) ! 0) * dcofi_999) / perio;
     |SINO;
          duni1_200 = (pdia_a_E * ((nDiasMedia * (#9diasp / 30)) ! 0) * 1) / perio;
     |FINSI;
     duni3_200 = (pdia_a_E * #9diasp *         1) / perio;     || entero
     |SI #9tipos = "P";   || pagas porcentuales
          duni1_200 = #9porcp * dcofi_999;
          duni3_200 = #9porcp *         1;                    || entero
     |FINSI;
     duni3_200 = duni3_200 ! 6;
     duni3_200 = duni3_200 / dia_4;
     |SI #7#26 = "S";
          duni2_200 = duni2_200-(duni3_200 * dabse_3);   || menos absent.
     |FINSI;

     duni2_200 = duni2_200-(duni3_200 * dperm_2);   || menos permiso

     duni1_200 = duni1_200 ! 6;
     duni2_200 = duni2_200 ! 6;

     nUni200_2 = duni1_200;        || unidades que resultaran en prorrata
|FPRC;

|PROCESO cal_unid;   || CALCULA LAS UNIDADES DEL CONCEPTO 2xx
/*   || esto no esta activo aun, se dejo a mediad
     |SI #nomconca#166 = "C";
          pdia_a = #9diasp;
          anynum = nElAny; mesnum = nElMes; |HAZ ulti_dia;
          dcofi_999 = (hcobr_0 + dalta_2 + (topemes - dbaja_3)) / pdia_a;
          |SI dcofi_999 > 1;
               dcofi_999 = 1;
          |FINSI;
     |FINSI;
*/
     duni1_200 = (pdia_a * #9diasp * dcofi_999) / perio;
     duni3_200 = (pdia_a * #9diasp *         1) / perio;     || entero
     |SI #9tipos = "P";   || pagas porcentuales
          duni1_200 = #9porcp * dcofi_999;
          duni3_200 = #9porcp *         1;                    || entero
     |FINSI;
     duni3_200 = duni3_200 ! 6;
     duni3_200 = duni3_200 / dia_4;
     |SI #7#26 = "S";
          duni2_200 = duni2_200-(duni3_200 * dabse_3);   || menos absent.
     |FINSI;
     || duni2_200 = duni2_200-(duni3_200 * dperm_2);   || menos permiso
     || no lo entiendo, esa linea hace que se descuente dos veces en caso
     || de permiso, si hace falta, comprobar 766.1798
     duni1_200 = duni1_200 ! 6;
     duni2_200 = duni2_200 ! 6;
     product = duni2_200 * dvalo_209;  product = product ! EURODB;
     acum1_200 = acum1_200 + product;
|FPRC;

|PROCESO gracal_200;    || GRABA EL CONCEPTO 2xx;
    swgracon = 1;       || para que grabe todos los campos
    swcongra = 0;       || para que no acumule si existe
    graba04 = concep0;
    graba05 = #10#3;
    graba06 = #10#4;
    graba07 = #10#5;
    graba08 = #10#6;
    graba09 = duni1_200;
    graba10 = dvalo_200;
    graba11 = duni2_200;
|SI duni1_200 ! 0; |O duni2_200 ! 0; |O dvalo_200 ! 0;
    |SI duni2_200 ! 0;
            graba05 = "P";
            graba06 = 0;      || dto. por huelga/absentismo
    |FINSI;
    |HAZ grabacon;
        dvalo_200 = dvalo_200 ! 4;
        duni1_200 = duni1_200 ! 6;
        product = (dvalo_200 * duni1_200) ! 6;
    |SI #9mesco = 99;                 || cuando no son pagas 99 no
            product = product ! EURODB;    || redondea para lograr mayor exactitud
    |FINSI;
        dvalo_pro = dvalo_pro + product;     || total prorratas
        dvalo_209 = dvalo_209 ! 4;
        product = (dvalo_209 * duni1_200) ! 6;
    |SI #9mesco = 99;                 || cuando no son pagas 99 no
            product = product ! EURODB;    || redondea para lograr mayor exactitud
    |FINSI;
        dvalo_pag = dvalo_pag + product;     || total pagas
     |HAZ nomtraju;
     |SI #9mesco = 99;  || paga prorrateada      06.10.2005
          |SI #labtraba#97 = 4;    || ajuste a liquidos (solo tipo 4 de momento)
               |SI #10#9 = "N"; |O swNoEntra = 1;
                    acump_200 = acump_200 + product;   || que cobrare este mes
               |FINSI;
          |FINSI;
     |FINSI;

|FINSI;
|FPRC;

||****************************************************************************
||                        CALCULO DE LAS PAGAS
||****************************************************************************

|PROCESO calpaga;
     swpaga = 0;               || para saber si hay que incluir finiquito:
                               || si es baja y le corresponde finiquito
     |SI swbaja=1;|Y #2#48="S";|Y runnom!"nomcalir";
          |SI #1#39="1";|Y runnom!"nomcalfi"; swpaga=1; |FINSI;
          |SI #1#39!"1";|Y runnom="nomcalfi"; swpaga=1; |FINSI;
     |FINSI;

     |SI aFechaFIN ! "";      || soy Sykes, soy Finiquito
          swbaja = 1; swpaga = 1;
     |FINSI;

     dunic_201 = 0; dunic_202 = 0; dunic_203 = 0; dunic_204 = 0;
     dunic_205 = 0; dunic_206 = 0; dunic_207 = 0; dunic_208 = 0; dunic_999 = 0;
     swPagasProrr = 0;
     |PARA paga = 1; |SI paga [ 8; |HACIENDO paga = paga + 1;
          nUnidYaPagadas = 0;
          swCalPaga = 0;
          swProrPaga = 2;     || estoy en CALCULO DE PAGAS
          |HAZ empieza;                  || inicializa
          |SI runnom = "nomcalir"; #0#12 = "S"; |FINSI;
          |SI #0#12 ! "N"; |O #9mesco = 99; |O #9mesco ! #0#8;
               swCalPaga = 1;
          |FINSI;
          |SI swCalPaga = 0;  || deberia tenerla emitida y grabada, compruebo
               |HAZ compruebapaga; || que tengo grabado registro, si no en
          |FINSI;             || el propio proceso pongo a uno el swCalPaga
          |SI runnom = "nomcalfi"; |Y #9mesco = nElMes;
          |Y aFechaFIN = ""; || si soy Sykes (Theorical) NO tengo que comprobar esto ni dar avisos
               swCalPaga = 0;
               |HAZ compruebapaga;
               |SI swCalPaga ! 1; ||
                    |SI #9hasta ! #9mesco; |Y #9mesco ! 99; || diferida !!!
                         swCalPaga = 1;

                         |SI nElMes = #9mesco;
                         || el colmo, si el mes que es baja
                         || es el mes de cobro de la paga dif. y ya tenia paga acu-
                         || mulada, en este caso, NO hay que descontar unidades
                         || 2884.1932, si molesta quitas la linea que no tiene que pasar mucho mas
                              swCalPaga = 1;
                         |SINO;
                              aAlfa = nElMes; aAlfa = ("00" + aAlfa) % -102;
                              aAlfa = "    ATENCION: La paga extra correspondiente al mes " + aAlfa;
                              aAlfa = aAlfa + " es diferida.";
                              |MENAV aAlfa;
                              aAlfa = "    Al ser diferida, se calculará solo la parte ";
                              aAlfa = aAlfa + "correspondiente al prorrateo de los dias ";
                              aAlfa = aAlfa + "trabajados este mes";
                              |MENAV aAlfa;

                              swCalPaga = 1;
                              |HAZ recuperapagalin_FIN;
                         |FINSI;
                    |SINO;
                         |SI swCalPaga = 0;
                              aAlfa = nElMes; aAlfa = ("00" + aAlfa) % -102;
                              aAlfa = "    ATENCION: La paga extra correspondiente al mes " + aAlfa;
                              aAlfa = aAlfa + " ya ha sido emitida. No se calculará.";
                              |MENAV aAlfa;
                              |HAZ AvisaPagaErronea;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI swCalPaga = 1;
               |SI #9diasp ! 0;|O #9porcp ! 0;
                    nQueBusca = 2;
                    |HAZ busca;                || calcula dias periodo y prorrateo si/no
                    |HAZ confec_1;             || calcula pagas
               |FINSI;
          |FINSI;
          |SI swProrPaga = 22;   || deja la paga a "F"
               #labtraba#tipo_p# = "F";
          |FINSI;
     |SIGUE;
|FPRC;

||****************************************************************************
||                 RUTINAS PARA EL CALCULO DE LAS PAGAS
||****************************************************************************

|PROCESO confec_1;     || LANZA CALCULO DE PAGAS
     swDiferFiniq = 0;
     |SI #9mesco = 99; |O #9mesco = #0#8; |O swpaga = 1;
          |SI #9mesco = 99;|O #9mesco = #0#8;           || si es baja el ult.dia del mes
               |SI runnom="nomcalfi";|Y dbaja_3=dia_2;   ||/y es mes de confeccion
                    |SI #9hasta ! #9mesco;|Y #9mesco ! 99;||/y estamos calculando finiquito
                         swDiferFiniq = 1;                 ||/y no es diferida
                    |SINO;                                ||/ NO INCLUYE ESTA PAGA!!!
                         |ACABA;
                    |FINSI;
               |FINSI;

               |SI runnom ! "nomcalfi";
                    |SI dbaja_3!dia_2;|Y swpaga=0;|Y swbaja=1;|Y #9mesco ! 99;
                    |Y #10#3 ! "P";
                         |ACABA;            || si no es finiquito y es baja a
                    |FINSI;                 || /mitad de mes y es mes de paga

                    || pagas "P", mes de baja, no las pagues aqui, se pagaran
                    || en el finiquito siempre que no sea baja el
                    || ultimo dia claro 07.06.2009
                    || o sea finiquito junto mes, entonces si
                    |SI #9mesco = #0#8; |Y swbaja = 1; |Y #10#3 = "P";
                    |Y dbaja_3 ! dia_2; |Y #1#39 ! 1;
                         |ACABA;
                    |FINSI;
               |FINSI;
               |SI runnom = "nomcalfi";
                    ||SI #9mesco = 99; |O #10#3 = "P";
                    || las pagas "P" que se pagan en el mes en que el trabajador
                    || es baja no hay por que dejar de pagarlas en el finiquito
                    || donde no hay que pagarlas es en la nomina 07.06.2009
                    |SI #9mesco = 99;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ cargavar;                 || carga vars. y calcula coeficientes
          |HAZ leecal_200;               || lee el concepto paga
          |SI swProrPaga = 22;
               |SI #2tipo_p = "B";      || importe bruto
               |Y dvalo_209 ! 0;   || si no en finiquitos SIEMPRE cobraba esta paga
                                   || aunque no tocara
                    dvalo_209 = #2ajus_p / #9diasp;
               |FINSI;
          |FINSI;
          |SI #9mesco = 99;              || si el mes de confeccion es el 99
               |HAZ confec_2;             || /calcula solo lo de este mes
          |SINO;
               |HAZ confec_3;             || si el mes de confeccion no es 99
          |FINSI;                        || /pueden pasar dos cosas (Ver 'confec_3')

          |HAZ grapaga;
          |SI daviso18 = paga;     || lo comento ya que hay algo que no esta correcto
               ||nIncid = 18;      || a la hora de localizar las pagas para las que
               ||HAZ graba_inc;    || he de sacar el aviso, estamos en Diciembre, mal
          |FINSI;                  || momento para tocar pagas, para mas adelante
     |FINSI;
|FPRC;

||****************************************************************************
||                 SUBRUTINAS DEL CALCULO DE LAS PAGAS
||****************************************************************************

|PROCESO cargavar;
     diast = paga + 49;    || dias dto. enfe/acci
     acumb = paga + 54;    || acumulado bases o dias
     bases = paga + 64;    || bases diferidas
     |SI paga > 5;                 || desorden de campos !!!
          diast = paga + 72;
          acumb = paga + 75;
          bases = paga + 78;
     |FINSI;
     |SI paga = 1; dvalo_209 = dvalo_201; |FINSI;
     |SI paga = 2; dvalo_209 = dvalo_202; |FINSI;
     |SI paga = 3; dvalo_209 = dvalo_203; |FINSI;
     |SI paga = 4; dvalo_209 = dvalo_204; |FINSI;
     |SI paga = 5; dvalo_209 = dvalo_205; |FINSI;
     |SI paga = 6; dvalo_209 = dvalo_206; |FINSI;
     |SI paga = 7; dvalo_209 = dvalo_207; |FINSI;
     |SI paga = 8; dvalo_209 = dvalo_208; |FINSI;
     dvalo_209 = dvalo_209 ! (EURODB + 2);
     |SI #0#8 = #9desde;|Y #9dedia !      1;  estevale = 1;  |FINSI;
     |SI #0#8 = #9hasta;|Y #9hadia ! guarda;  estevale = 1;  |FINSI;
     |SI estevale = 1;
          |HAZ recuento;
          dcofi_999 = pdia_0 - pdia_2;
          pcofi_2 = dcofi_999 / pdia_0;      || para 'confec_X'
          |SI #nomcontr#39 = "E";
               |SI #1#26 = "S";     dcofi_999 = dcofi_999 - pdia_1;    |FINSI;
               |SI #1#27 = "S";     dcofi_999 = dcofi_999 - pdia_3;    |FINSI;
               |SI #1#43 = "S";     dcofi_999 = dcofi_999 - pdia_6;    |FINSI;
               |SI #1#44 = "S";     dcofi_999 = dcofi_999 - pdia_4;    |FINSI;
          |SINO;
               |SI #9#145 = "S";     dcofi_999 = dcofi_999 - pdia_1;    |FINSI;
               |SI #9#143 = "S";     dcofi_999 = dcofi_999 - pdia_3;    |FINSI;
               |SI #9#146 = "S";     dcofi_999 = dcofi_999 - pdia_6;    |FINSI;
               |SI #9#147 = "S";     dcofi_999 = dcofi_999 - pdia_4;    |FINSI;
          |FINSI;
          dcofi_999 = dcofi_999 - pdia_7;
          |SI dcofi_999 < 0; dcofi_999 = 0; |FINSI;
          dcofi_999 = dcofi_999 / pdia_0;
     |SINO;
          dcofi_999 = hcobr_0;
          |SI #nomcontr#39 = "E";
               |SI #1#26 = "N";     dcofi_999 = dcofi_999 + denfe_2 + dcont_2;   |FINSI;
               |SI #1#27 = "N";     dcofi_999 = dcofi_999 + dacci_2;   |FINSI;
               |SI #1#43 = "N";     dcofi_999 = dcofi_999 + dmate_2 - dcont_2;   |FINSI;
               |SI #1#44 = "N";
                                     dcofi_999 = dcofi_999 + dabse_3;
                                     dcofi_999 = dcofi_999 + dperm_2;
               |FINSI;
          |SINO;
               |SI #9#145 = "N";     dcofi_999 = dcofi_999 + denfe_2 + dcont_2;   |FINSI;
               |SI #9#143 = "N";     dcofi_999 = dcofi_999 + dacci_2;   |FINSI;
               |SI #9#146 = "N";     dcofi_999 = dcofi_999 + dmate_2 - dcont_2;   |FINSI;
               |SI #9#147 = "N";
                                     dcofi_999 = dcofi_999 + dabse_3;
                                     dcofi_999 = dcofi_999 + dperm_2;
               |FINSI;
          |FINSI;
          |SI dhuel_2 > 0; |Y #9mesco = 99; |Y #7#25 = "N";
               dcofi_999 = dcofi_999 + dhuel_2;
          |FINSI;
          |SI dcofi_999 > hdias_0;      || parche porque por algun motivo
               dcofi_999 = hdias_0;     || en caso de accidente desde X hasta 0
          |FINSI;                       || paga pror por trabajador, mes 31 dias,
          dcofi_999 = dcofi_999 / hdias_0;     || salia dcofi_999 > 1

          pcofi_2 = hcoti_0 / hdias_0;              || para 'confec_X'
          |HAZ diaspaga;
     |FINSI;

     |SI es_irregul = 1; |Y tpz ! 0;     || en los irregulares el coeficiente de paga
             pcofi_2 = 1;     || es siempre 1
     |FINSI;
|FPRC;

|PROCESO leecal_200;    || LEE CONCEPTO DE LINEAS DE CALCULOS CORREP. A PAGA
    doce = concep0;
|HAZ leedoce;
|SI FSalida ! 0;         || si no esta en calculos, lee convenio
    |DDEFECTO #10;
        #10#0 = #9#0;
        #10#2 = concep0;
    |LEE 000#10=;
        #12#05 = #10#3;   || carga calculo alfa de convenios
        #12#06 = #10#4;   || carga calculo nume de convenios
        #12#07 = #10#5;   || carga situacion de convenios
        #12#08 = #10#6;   || carga descripcion de convenios
        #12#09 = 0;
        #12#10 = 0;
        #12#11 = 0;
|FINSI;
    duni1_999 = #12#09;
    duni2_999 = #12#11;
    dvalo_999 = #12#10;
    product = duni2_999 * dvalo_999;         || resta lo acumulado en IRPF
    product = product ! EURODB;              ||/de dto.huelga-absent. por
    acum1_200 = acum1_200 - product;         || tratarlo al confeccionar
|FPRC;

|PROCESO confec_2;  || CALCULA PAGA CUANDO ES 99
     dunic_999 = 0;
     |SI es_irregul = 0;|Y #10#4 ! 0;
          |SI #9tipos = "P";   || si es porcentual
               duni2_999 = #9porcp * dcofi_999;
               dunic_999 = #9porcp * 1;
          |SINO;               || si es normal
               duni2_999 = (pdia_a * dcofi_999) * (#9diasp / perio);
               dunic_999 = (pdia_a * 1) * (#9diasp / perio);
          |FINSI;
     |SINO;
          duni2_999 = duni1_999;     || irregulares y pagas 99 con V0
     |FINSI;
     duni2_999 = (duni2_999*dvalo_209)/dvalo_999;  || ajusta a paga completa
     duni2_999 = duni2_999 ! 6;                    || redondea

     dunic_999 = (dunic_999*dvalo_209)/dvalo_999;  || ajusta a paga completa
     dunic_999 = dunic_999 ! 6;                    || redondea

     product = duni2_999 * dvalo_999;
     product = product ! EURODB;
     acum1_200 = acum1_200 + product;
     |HAZ nomtraju;
     |SI #10#9 = "N"; |O swNoEntra = 1;
          bruto_aju = bruto_aju - product;
     |FINSI;
     || lo resta porque luego le suma 'acum1_200'

     |SI paga = 1;  dunic_201 = dunic_999;   |FINSI;
     |SI paga = 2;  dunic_202 = dunic_999;   |FINSI;
     |SI paga = 3;  dunic_203 = dunic_999;   |FINSI;
     |SI paga = 4;  dunic_204 = dunic_999;   |FINSI;
     |SI paga = 5;  dunic_205 = dunic_999;   |FINSI;
     |SI paga = 6;  dunic_206 = dunic_999;   |FINSI;
     |SI paga = 7;  dunic_207 = dunic_999;   |FINSI;
     |SI paga = 8;  dunic_208 = dunic_999;   |FINSI;
|FPRC;


|PROCESO confec_3;    || CALCULA PAGA CUANDO NO ES 99
                           || si el mes actual es distinto al de fin calculo paga
     |SI #9hasta ! #9mesco;        || /coge las bases diferidas de dos formas:
          |SI swpro = 0;|Y swDiferFiniq = 0;  || si no hay prorrata este mes
               duni2_999 = #9diasp;        || /mete las bases diferidas en valor
               dvalo_999 = (#2bases / #9diasp); ||estaba redon. a 2,se lo quito por euro

               || ojo, porque si no hago esto, si no hay importe de paga diferida
               || me pone 30 dias (los de la paga) de todos modos, y eso
               || despues en atrasos me la lia 4333.1721 19/10/2017
               |SI dvalo_999 = 0; duni2_999 = 0; |FINSI;
               product = duni2_999 * dvalo_999;
               product = product ! EURODB;
               |SI swpaga = 0;
                    acum2_200 = acum2_200 + product;
               |SINO;
                    acum1_200 = acum1_200 + product;
               |FINSI;
          |SINO;               || si si que hay calcula las unidades calculo
               |SI swDiferFiniq = 0;      || diferida con finiquito a parte
                    duni2_999 = duni2_999 + (#2bases/dvalo_999);
               |FINSI;
               |SI swpaga = 1;
                    |HAZ confec_X;
               |SINO;
                    swSigue = 0;
                    || asi pillo a gente que pasa a ser TC y que antes era TP
                    ||SI #labtraba#42 = "X"; |Y #labtraba#234 > 0;
                    ||SI runnom ! "nomcalfi";
                         |SI #nomcontr#50 = "S"; |O #nomcontr#50 = "I";
                              swSigue = 1;
                         |FINSI;
                    ||FINSI;
                    ||Y #labtraba#tipo_p# = "B"; |Y #labtraba#ajus_p# > 0;
                    |SI swSigue = 1;
                         nImpPaga = 0;
                         aNif = #labtraba#7;
                         nDiasAcum = 0;
                         nTotDiasPaga = #labtraba#dias_p#;
                         |HAZ PropPagaTP;
                         |SI nDiasAcum ! 0;
                              dvalo_999 = nImpPaga / duni2_999;
                              product = nImpPaga;
                              acum2_200 = acum2_200 + product;

                              nIncid = 23;
                              |HAZ graba_inc;
                         |SINO;
                              product = duni2_999 * dvalo_999;
                              product = product ! EURODB;
                              acum2_200 = acum2_200 + product;
                         |FINSI;
                    |SINO;
                         product = duni2_999 * dvalo_999;
                         product = product ! EURODB;
                         acum2_200 = acum2_200 + product;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          duni2_999 = 0;
          |HAZ confec_X;    || cuando en el mes actual es cuando se acaba la paga
     |FINSI;               || /no hay que coger nada diferido
|FPRC;

|PROCESO Parche_P;
     concep1 = 51 + paga;      || calcula el 1er. campo de conceptos
     concep2 = concep1 + 32;   || calcula el ultimo campo de concep.
     |PARA campo = concep1; |SI campo [ concep2; |HACIENDO campo=campo+8;
          swItch = 0;
          |SI #9campo ] 201; |Y #9campo [ 208;
               |SI #9campo = 201; |Y dvalo_201_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 202; |Y dvalo_202_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 203; |Y dvalo_203_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 204; |Y dvalo_204_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 205; |Y dvalo_204_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 205; |Y dvalo_205_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 206; |Y dvalo_206_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 207; |Y dvalo_207_A = 1; swItch = 1; |FINSI;
               |SI #9campo = 208; |Y dvalo_208_A = 1; swItch = 1; |FINSI;
          |FINSI;              || si el concepto no es cero
          |SI swItch = 1;
               |SI paga = 1; dvalo_999 = dvalo_201;    |FINSI;
               |SI paga = 2; dvalo_999 = dvalo_202;    |FINSI;
               |SI paga = 3; dvalo_999 = dvalo_203;    |FINSI;
               |SI paga = 4; dvalo_999 = dvalo_204;    |FINSI;
               |SI paga = 5; dvalo_999 = dvalo_205;    |FINSI;
               |SI paga = 6; dvalo_999 = dvalo_206;    |FINSI;
               |SI paga = 7; dvalo_999 = dvalo_207;    |FINSI;
               |SI paga = 8; dvalo_999 = dvalo_208;    |FINSI;
               dvalo_999 = dvalo_999 ! 4;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO confec_X;   || CALCULA LA PAGA ACTUAL
     |HAZ Parche_P;

     |SI #9tipos = "N";
          |HAZ descuento;
          duni2_200 = (#2acumb+ (pdia_0*pcofi_2) ) -dias_dto;

          |HAZ Histor;
          |SI aFechaFIN ! ""; |Y swHistor = 1; |Y runnom = "nomcalfi";
               || Sykes, theorical, nomina en Historico
               duni2_200 = #2acumb;
          |FINSI;

          |SI duni2_200 < 0;  duni2_200 = 0;  |FINSI;
          nTotDiasPaga1 = duni2_200;
          duni2_200 = (duni2_200 * #9diasp) / perio;
          swHistor = 0;
     |SINO;
          duni2_200=(#2acumb+( (#9porcp*dcofi_999)*dvalo_999) ) /dvalo_999;
     |FINSI;
     duni2_200=(duni2_200*dvalo_209)/dvalo_999;  || ajusta a paga completa

     duni2_999 = duni2_999 + duni2_200; || unidades calculo totales
     duni2_999 = duni2_999 ! 6;         || se redondea como las prorratas !!!
     product = duni2_999 * dvalo_999;
     product = product ! EURODB;

     nImpReal = 0;
     nImpTeor = 0;
     swSigue = 0;
     ||SI #labtraba#42 = "X"; |Y #labtraba#234 > 0;
     ||SI runnom ! "nomcalfi";
          || asi pillo a gente que pasa a ser TC y que antes era TP
          |SI #nomcontr#50 = "S"; |O #nomcontr#50 = "I";
               swSigue = 1;
          |FINSI;
     ||FINSI;
     ||Y #labtraba#tipo_p# = "B"; |Y #labtraba#ajus_p# > 0;
     |SI swSigue = 1;
          nImpPaga = 0;
          aNif = #labtraba#7;
          nDiasAcum = 0;
          nTotDiasPaga = #labtraba#dias_p#;
          |HAZ PropPagaTP;
          |SI nDiasAcum ! 0;
               dvalo_999 = nImpPaga / duni2_999;
               product = nImpPaga;
               nIncid = 23;
               |HAZ graba_inc;
          |FINSI;
     |FINSI;
     |SI swpaga = 0;
          acum2_200 = acum2_200 + product;
     |SINO;
          acum1_200 = acum1_200 + product;
     |FINSI;
|FPRC;

|PROCESO descuento;
    idia_1 = 0;
    idia_3 = 0;
    idia_4 = 0;
    idia_6 = 0;
    idia_7 = 0;
|SI #9hasta1 = #0#8;               || si el dto. por ILT acaba este mes
    |SI #9hadia1 = guarda;         || si es el mes completo
            idia_1 = pdia_1;
            idia_3 = pdia_3;
            idia_4 = pdia_4;
            idia_6 = pdia_6;
            idia_7 = pdia_7;
    |SINO;                         || si no es el mes completo
        |PARA mid = 1; |SI mid [ #9hadia1; |HACIENDO mid = mid + 1;
                nume1 = (100 * mid) + 1;
                alfa1 = histori % nume1;
            |SI alfa1 = "I"; |O alfa1 = "C";
                 idia_1 = idia_1 + 1;
            |FINSI;  || enf.
            |SI alfa1 = "M";  |O alfa1 = "P"; |O alfa1 = "R";
                 idia_6 = idia_6 + 1;
            |FINSI;  || mat, pat, rie, otr
            |SI alfa1 = "J";  idia_3 = idia_3 + 1;  |FINSI;  || accid.
            |SI alfa1 = "K"; |O alfa1 = "S"; idia_4 = idia_4 + 1;  |FINSI;  || abs.
        |SIGUE;
    |FINSI;
|SINO;
    |SI swpaga = 1;      || si es finiquito
            idia_1 = pdia_1;
            idia_3 = pdia_3;
            idia_4 = pdia_4;
            idia_6 = pdia_6;
            idia_7 = pdia_7;
    |FINSI;

|FINSI;

|SI idia_1 > dia_4; idia_1 = dia_4;     |FINSI;
|SI idia_6 > dia_4; idia_6 = dia_4;     |FINSI;
|SI idia_3 > dia_4; idia_3 = dia_4;     |FINSI;
|SI idia_4 > dia_4; idia_4 = dia_4;     |FINSI;
|SI idia_7 > dia_4; idia_7 = dia_4;     |FINSI;
     || controlar que los dias de baja no sean
     || nunca mayor que los dias cotizables

    dias_dto = #2diast;
|SI #nomcontr#39 = "E";
     |SI #1#26 = "S";  dias_dto = dias_dto + idia_1;  |FINSI;    || enf.
     |SI #1#43 = "S";  dias_dto = dias_dto + idia_6;  |FINSI;    || mat.
     |SI #1#27 = "S";  dias_dto = dias_dto + idia_3;  |FINSI;    || accid.
     |SI #1#44 = "S";  dias_dto = dias_dto + idia_4;  |FINSI;    || absen.
|SINO;
     |SI #9#145 = "S";  dias_dto = dias_dto + idia_1;  |FINSI;    || enf.
     |SI #9#143 = "S";  dias_dto = dias_dto + idia_3;  |FINSI;    || acc.
     |SI #9#146 = "S";  dias_dto = dias_dto + idia_6;  |FINSI;    || mat.
     |SI #9#147 = "S";  dias_dto = dias_dto + idia_4;  |FINSI;    || absen.
|FINSI;

     dias_dto = dias_dto + idia_7;      || perm.
|FPRC;

|PROCESO grapaga;       || REGRABA LA PAGA
    graba04 = concep0;
    swcongra = 0;       || para que no acumule si existe
|SI swpaga = 1; |O #9mesco = 99;
        swgracon = 1;     || para que regrabe los campos si existe
        graba05 = "P";
        graba06 = 0;
|SINO;
        swgracon = 0;
        graba05 = #12#05;
        graba06 = #12#06;
|FINSI;
    graba07 = #12#7;
    graba08 = #12#8;
    duni1_999 = duni1_999 ! 6;
    duni2_999 = duni2_999 ! 6;
    graba09 = duni1_999;
    graba10 = dvalo_999;
    graba11 = duni2_999 - nUnidYaPagadas;
|SI duni1_999 ! 0; |O duni2_999 ! 0; |O dvalo_999 ! 0;
    |HAZ grabacon;
|FINSI;
|FPRC;

||****************************************************************************
||              RUTINAS COMUNES A PRORRATAS Y PAGAS
||****************************************************************************

|PROCESO recuento;
    de1 = 0;  ha1 = -1;  de2 = 0;  ha2 = -1;
|SI #0#8 = #9desde;     de1 = #9dedia;  ha1 =  guarda;  |FINSI;
|SI #0#8 = #9hasta;     de1 =       1;  ha1 = #9hadia;  |FINSI;
|SI #9desde = #9hasta;|Y #9dedia [ #9hadia;
        de1 = #9dedia;  ha1 = #9hadia;
|FINSI;
|SI #9desde = #9hasta;|Y #9dedia > #9hadia;
        de1 = #9dedia;  ha1 =  guarda;
        de2 =       1;  ha2 = #9hadia;
|FINSI;
|PARA mid = de1; |SI mid [ ha1; |HACIENDO mid = mid + 1;
        nume1 = (100 * mid) + 1;
        alfa1 = histori % nume1;
    |SI                mid [ dia_3;  pdia_a = pdia_a + 1;  |FINSI;  || alta
    ||SI alfa1 = "I";                 pdia_b = pdia_b + 1;  |FINSI;  || enf.
    |SI alfa1 = "I";|Y mid [ dia_3;  pdia_b = pdia_b + 1;  |FINSI;  || enf.
    |SI alfa1 = "B"; |O alfa1 = "D"; |Y mid [ dia_3;  pdia_c = pdia_c + 1;  |FINSI;  || baja
    alfa2 = histori3 % nume1;
    |SI alfa1 = "D"; |Y alfa2 = "d"; |Y mid [ dia_3;  pdia_c = pdia_c - (1 - (nPropDesTP / 100));  |FINSI; || ERE TP
    |SI alfa1 = "J";                 pdia_d = pdia_d + 1;  |FINSI;  || accid.
    |SI alfa1 = "K";|O alfa1= "S";   pdia_e = pdia_e + 1;  |FINSI;  || abs.
    |SI alfa1 = "M";  |O alfa1 = "P"; |O alfa1 = "R"; |O alfa1 = "C";
         pdia_f = pdia_f + 1;
    |FINSI;  || mat, pat, rie, otr.
|SIGUE;
|PARA mid = de2; |SI mid [ ha2; |HACIENDO mid = mid + 1;
        nume1 = (100 * mid) + 1;
        alfa1 = histori % nume1;
    |SI mid [ dia_3;  pdia_0 = pdia_0 + 1;  |FINSI;  || alta
    |SI alfa1 = "I"; |O alfa1 = "C"; || enf.
          |SI mid [ dia_3;
               pdia_1 = pdia_1 + 1;
          |FINSI;
    |FINSI;
    |SI alfa1 = "B"; |O alfa1 = "D"; |Y mid [ dia_3;  pdia_2 = pdia_2 + 1;  |FINSI;  || baja
    alfa2 = histori3 % nume1;
    |SI alfa1 = "D"; |Y alfa2 = "d"; |Y mid [ dia_3;  pdia_2 = pdia_2 - (1 - (nPropDesTP / 100));  |FINSI; || ERE TP
    |SI alfa1 = "J";                 pdia_3 = pdia_3 + 1;  |FINSI;  || accid.
    |SI alfa1 = "K"; |O alfa1= "S";  pdia_4 = pdia_4 + 1;  |FINSI;  || abs.
    |SI alfa1 = "M";  |O alfa1 = "P"; |O alfa1 = "R";
          pdia_6 = pdia_6 + 1;  || mat, pat, rie
    |FINSI;
|SIGUE;

    pdia_a = pdia_a + pdia_0;   || letras --> prorrata (contienen los de paga)
    pdia_b = pdia_b + pdia_1;   || numeros -> paga
    pdia_c = pdia_c + pdia_2;
    pdia_d = pdia_d + pdia_3;
    pdia_e = pdia_e + pdia_4;
    pdia_f = pdia_f + pdia_6;
    pdia_g = pdia_g + pdia_7;

|SI ha2 = -1;            || si la paga va en meses completos |O
    |O swpaga = 1;       || si es finiquito |O
    |O #9mesco = 99;     || si es paga de confeccion 99:
        pdia_0 = pdia_a;
        pdia_1 = pdia_b;
        pdia_2 = pdia_c; || se paga lo mismo que se prorratea!
        pdia_3 = pdia_d;
        pdia_4 = pdia_e;
        pdia_6 = pdia_f;
        pdia_7 = pdia_g;
|FINSI;
|FPRC;

|PROCESO empieza;         || SACA LAS VARIABLES DEL CONVENIO SEGUN PAGA
     duni1_999 = 0;
     duni2_999 = 0;
     dvalo_999 = 0;
     dvalo_200 = 0;
     dvalo_209 = 0;
     duni1_200 = 0;
     duni2_200 = 0;
     duni3_200 = 0;
     dias_dto = 0;
     swpro = 0;
     perio = 0;
     pdia_0 = 0; pdia_1 = 0; pdia_2 = 0; pdia_3 = 0; pdia_4 = 0; pdia_6 = 0; pdia_7 = 0;
     pdia_a = 0; pdia_b = 0; pdia_c = 0; pdia_d = 0; pdia_e = 0; pdia_f = 0; pdia_g = 0;
     estevale = 0;
     dedia = paga + 107;    || desde dia prorrata
     hadia = paga + 115;    || hasta dia prorrata
     desde = paga + 3;      || desde mes prorrata
     hasta = paga + 11;     || hasta mes prorrata
     dedia1 = paga + 123;   || desde dia ilt
     hadia1 = paga + 131;   || hasta dia ilt
     desde1 = paga + 91;    || desde mes ilt
     hasta1 = paga + 99;    || hasta mes ilt
     tipos = paga + 27;     || tipo de calculo
     diasp = paga + 35;     || dias
     porcp = paga + 43;     || porcentaje
     concep0 = paga + 200;  || concepto de paga
     mesco = paga + 19;     || mes confeccion
     dias_p = paga + 54;    || dias ajuste paga (trabajador)
     tipo_p = paga + 156;   || tipo ajuste paga (trabajador)
     ajus_p = paga + 164;   || importe ajuste paga (trabajador)
     dias_d = paga + 49;    || dias descuento paga (trabajador)

     |DDEFECTO #10;
     #10#0 = #9#0;
     #10#2 = concep0;
     |LEE 000#10=;

     pror_p = paga + 112;   || prorrateo paga S/N (trabajador)
     |SI #labtraba#pror_p# = "S";
          #9mesco = 99;
     |FINSI;
     |SI #labtraba#tipo_p# = "F";
           |SI swProrPaga = 1;     || estoy en el calculo de la prorrata
                #labtraba#tipo_p# = "V";
                swProrPaga = 11;   || para que despues lo deje como estaba
           |FINSI;
           |SI swProrPaga = 2;     || estoy en el calculo de la paga
                #labtraba#tipo_p# = "B";
                swProrPaga = 22;   || para que despues lo deje como estaba
           |FINSI;
     |FINSI;
     |SI #9mesco = 99;
          swPagasProrr = 1;
     |FINSI;
|FPRC;

|PROCESO diaspaga;
     |SI es_irregul = 1;|Y tpz ! 0;
          pdia_0 = tpz;
     |SINO;
          pdia_0 = hdias_0;
     |FINSI;
                                               pdia_a = pdia_0;
    pdia_1 = denfe_2 + dcont_2;                pdia_b = pdia_1;
    pdia_2 = dalta_2+dbaja_2+dhuel_2+ddese_2;  pdia_c = pdia_2;
    |SI dhuel_2 > 0; |Y #9mesco = 99; |Y #7#25 = "N";
         pdia_2 = pdia_2 - dhuel_2;
         pdia_c = pdia_c - dhuel_2;
    |FINSI;
    pdia_3 = dacci_2;                          pdia_d = pdia_3;
    pdia_4 = dabse_2;                          pdia_e = pdia_4;
    pdia_6 = dmate_2 - dcont_2;                pdia_f = pdia_6;
    pdia_7 = dperm_2;                          pdia_g = pdia_7;
|FPRC;

||****************************************************************************
||                      CALCULO FINAL 1 (ajusta a brutos)
||****************************************************************************

|PROCESO calfin1;    || CALCULOS ANTERIORES AL AJUSTE A BRUTOS
|HAZ calindem;  || calcula la indemnizacion
|HAZ calvacac;  || calcula las vacaciones
|HAZ calirpfr;  || calcula base IRPF recibos
|HAZ calajust;  || anticipos, en especie en ajustes S/N

|SI swSegPasada = 1;
     nPaso = 4; |HAZ CompAjuste;
|FINSI;
|HAZ calajus1;  || ajusta a brutos, concepto 407 (no cotiza) y 120 (cotiza)

|SI swSegPasada = 1;
     nPaso = 5; |HAZ CompAjuste;
|FINSI;
|HAZ calirpfp;  || calcula base IRPF pagas
|FPRC;

||****************************************************************************
||                       RUTINAS CALCULO FINAL 1
||****************************************************************************

|PROCESO CompruebaIndem;
     |SI sw45y33 = 1;    || ya viene topeado del dias_alta al ir por la nueva
          |ACABA;        || norma de la Reforma de 12.02.2012
     |FINSI;
     |SI duni1_902 = 45; nTopeMensIndem = 42; |FINSI;  || Topeamos dias
     |SI duni1_902 = 33; nTopeMensIndem = 24; |FINSI;  || segun 902
     |SI duni1_902 = 20;
          |SI #nomvarca#46 = 90;
               nTopeMensIndem = 9;
          |SINO;
               nTopeMensIndem = 12;
          |FINSI;
     |FINSI;
     nume1 = nDiasMensual * nTopeMensIndem;
     |SI duni2_902 > nume1;
          || no pregunto mas, esto es asi, legalmente 12.06.2018
          duni2_902 = nume1;
          graba11 = nume1;    || para el 'grabacon'
/*
          alfa2 = #2#0;
          alfa2 = "00000" + alfa2;
          alfa2 = alfa2 % -105;
          alfa3 = #2#1;
          alfa3 = "00000" + alfa3;
          alfa3 = alfa3 % -105;

          alfa1 = "0000STrabajador " + alfa2 +"." + alfa3;
          alfa1 = alfa1 +". La indemnizacion supera el tope de " + nTopeMensIndem;
          alfa1 = alfa1 + " mensualidades. Topear Importe?";
          |CONFI alfa1;
          |SI FSalida = 0;
               duni2_902 = nume1;
               graba11 = nume1;    || para el 'grabacon'
          |FINSI;
*/
     |FINSI;
|FPRC;

|PROCESO calindem;   || CALCULA LA INDEMNIZACION
     |SI aFechaFIN ! "";  |Y aFechaBaja = "";
          fecbaj = aFechaFIN;
     |FINSI;
     |SI indemni ! -1; |Y swpaga = 1;
          |SI #2#36 ! "..........";|Y #2#36 ! "          ";      || fecha alta valida
               |SI fecbaj ! "..........";|Y fecbaj ! "          ";|| fecha baja valida
                    swcalindem = 1;
                    |HAZ dias_alta;
                    |SI prom_ind ! -1;
                         dvalo_902 = prom_ind;
                    |SINO;
                         dvalo_902 = prom_enf;
                    |FINSI;
                    product = dvalo_902 * duni2_902;
                    product = product ! EURODB;
                    /*
                    |SI #32#13 = "N";  concepto = 415;  |FINSI;     || sin IRPF
                    |SI #32#13 = "S";  concepto = 410;  |FINSI;     || con IRPF
                    */
                    swIndem = 2;   || por concepto
                    |HAZ ConcIndAuto;   || Autom.
                    |SI concepto = 410; |HAZ PreguntaIndem; |FINSI;  || Pregunta
                    |HAZ convenio;
                    |SI convenio = 0;
                         graba04 = concepto;
                         graba09 = indemni;
                         graba10 = dvalo_902;
                         graba11 = duni2_902;
                         |SI product ! 0;
                              |HAZ CompruebaIndem;
                              swgracon = 1;   || para que regrabe campos
                              swcongra = 2;   || para que acumule si existe
                              graba05 = #10#3;
                              graba06 = #10#4;
                              graba07 = #10#5;
                              graba08 = #10#6;
                              |HAZ grabacon;
                              |HAZ acu_ctos;
                         |FINSI;
                    |SINO;
                         alfa1 = "    Indemnizacion: concepto [" + concepto + "] no definido en convenio ...";
                         |MENAV alfa1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AjusteVac;
     stop = nume2 ! EURODB;
     |PARA; |SI liq_aju ! stop; |HACIENDO;
          difer1 = stop - liq_aju;
          alfa1 = difer1; |SI alfa1 = "0";|O alfa1 = "-0"; difer1 = 0; |FINSI;
          |SI difer1 > 0;
               difere = difere + difer1;   || acumula dif. en var.trab.
               bruto_aju = bruto_aju + difer1;

               dto_tot = (difer1 % nume1);

               liq_aju = nume2 - dto_tot;

               bruto_aju = bruto_aju + difer1;

               |HAZ calirpfr; || recalcula base IRPF recibo
               |HAZ calirpfp; || recalcula retenciones IRPF recibo

               |SI #labtraba#42 ! "H";
                    |HAZ calcotiz;        || bases cotizacion
               |SINO;
                    base_5 = 0;
                    base_6 = 0;   || los gerentes/coperativistas autonomos
                    base_7 = 0;   || no cotizan !!!
                    dacum_30 = 0;
                    dacum_31 = 0;
               |FINSI;
          |SINO;
               stop = liq_aju;  || corta el bucle
          |FINSI;
          liq_aju = liq_aju ! EURODB;
     |SIGUE;
|FPRC;

|PROCESO calvacac;   || CALCULA LAS VACACIONES
     swSigue = 0;
     |SI aVacacSINO = "N";    || vengo de la simulacion de costes y he dicho
          |ACABA;             || que NO quiero vacaciones
     |FINSI;
     |SI vacacio ! -1;
          |SI swpaga = 1; |O aVacacSINO = "S";
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          swEnFiniq = 0;
          |SI aFechaFIN ! "";  fecbaj = aFechaFIN; |FINSI;
          |SI #2#36 ! "..........";|Y #2#36 ! "          ";      || fecha alta valida
               |SI fecbaj ! "..........";|Y fecbaj ! "          ";|| fecha baja valida
                    |SI pagavac = -1;
                         swEnFiniq = 1;
                         swcalvacac = 1;
                         alfa1 = #labtraba#126;
                         |QBF alfa1;
                         |SI alfa1 = ""; || trabajador antiguo
                              alfa1 = #nomconca#160;
                         |FINSI;
                         |SI alfa1 = "L";
                              nElAny = #0#9;
                              aFechaBaja = fecbaj;
                              |HAZ dias_lab_tra;
                              nume0 = nDiasLabTra;
                              |HAZ dias_lab_any;
                              nume1 = nDiasLabAny;
                         |SINO;    || como siempre
                              |HAZ dias_alta;
                              nume1 = 365;
                         |FINSI;
                         swEnFiniq = 0;
                         swcalvacac = 0;
                         duni1_903 = vacacio;
                         duni2_903 = (nume0 / nume1) * vacacio;
                         nElMes = #0#8; nElAny = #0#9;
                         duni2_903 = duni2_903 - #2#173;       || resta los disfrutados
                         |SI runnom = "nomcalfi";
                             |HAZ BuscaVac;
                             duni2_903 = duni2_903 - nVacMesAct;  || resta los pagados en nomina
                         |FINSI;
                         |SI aFechaFIN ! ""; || soy Sykes, soy un finiquito
                              |HAZ BuscaVac;
                              duni2_903 = duni2_903 + #2#173 - nVacMesAct - nVacRestoAny;       || resta los disfrutados
                         |FINSI;
                    |SINO;
                         duni2_903 = pagavac;
                    |FINSI;
                    |SI #labtraba#180 ! "0";
                         |SI #labtraba#180 = "2";    || ajusto vacaciones a bruto
                              |SI #labtraba#181 = "M";
                                   dacum_vac = #labtraba#215 / 30;
                                   || dejo 30 fijo si es mensual para hallar el precio por
                                   || dia, en vacaciones supongo ese importe para hallar
                                   || el importe por dia
                              |SINO;
                                   dacum_vac = #labtraba#215;
                              |FINSI;
                         |FINSI;
                         |SI #labtraba#180 = "4";    || ajusto vacaciones a liquido
                              || de momento igual
                              |SI #labtraba#181 ! "M";
                                   nume2 = #labtraba#215 * 30;
                              |SINO;
                                   nume2 = #labtraba#215;
                              |FINSI;
                              nume1 = #nomconst#7 + #nomconst#13 + #nomconst#15 + #nomconst#17;
                              nume1 = nume1 + nIRPF1;
                              || nume2 es el total que tengo que cobrar
                              || nume1 es el % (SS + IRPF) que tendre que pagar
                              || ahora ajusto manualmente:

                              bruto_vac = nume2;
                              stop = bruto_vac;
                              |PARA; |SI liqui_vac ! stop; |HACIENDO;
                                   diferencia = stop - liqui_vac;
                                   alfa1 = diferencia;
                                   |SI alfa1 = "0"; |O alfa1 = "-0";
                                        diferencia = 0;
                                   |FINSI;
                                   |SI diferencia > 0;
                                        reten_vac = (diferencia % nume1);
                                        bruto_vac = bruto_vac + reten_vac;
                                        liqui_vac = liqui_vac + (diferencia - reten_vac);
                                   |SINO;
                                        |SAL;
                                        || AJUSTADO
                                   |FINSI;
                              |SIGUE;
                              dacum_vac = bruto_vac / 30;
                         |FINSI;
                     |FINSI;

                     dvalo_903 = dacum_vac; || acumulador precio dia vacacion
                     product = dvalo_903 * duni2_903;
                     product = product ! EURODB;

                     |SI #32#1 = "N";  concepto = 409;  |FINSI;
                     |SI #32#1 = "S";  concepto = 125;  |FINSI;
                     |HAZ convenio;
                     |SI convenio = 0;
                         graba04 = concepto;
                         graba09 = vacacio;
                         graba10 = dvalo_903;
                         graba11 = duni2_903;
                         |SI product ! 0;
                              swgracon = 1;   || para que regrabe campos
                              swcongra = 2;   || para que acumule si existe
                              graba05 = #10#3;
                              graba06 = #10#4;
                              graba07 = #10#5;
                              graba08 = #10#6;
                              |HAZ grabacon;
                              product = graba10 * graba11;
                              |SI #32#1 = "N";
                                   acum_40  =acum_40 +product;
                                   |SI #10#8 = 1;  acum_401 =acum_401+product;  |FINSI;
                                   |SI #10#8 = 2;  acum_402 =acum_402+product;  |FINSI;
                                   |SI #10#8 = 3;  acum_403 =acum_403+product;  |FINSI;
                              |SINO;
                                   acum_10  =acum_10 +product;
                                   |SI #10#8 = 1;  acum_11  =acum_11 +product;  |FINSI;
                                   |SI #10#8 = 2;  acum_12  =acum_12 +product;  |FINSI;
                                   |SI #10#8 = 3;  acum_13  =acum_13 +product;  |FINSI;
                              |FINSI;
                              bruto_aju = bruto_aju + product;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

/****************************************************************************/

|PROCESO calirpfr;   || CALCULA BASE IRPF, BRUTO RECIBOS Y BRUTO PAGAS
    acum_99 = acum_10 + acum_30  + acum_31  + acum_40;   || total
    acum_991 = acum_11 + acum_301 + acum_311 + acum_401;  || irpf 1
    acum_992 = acum_12 + acum_302 + acum_312 + acum_402;  || irpf 2
    acum_993 = acum_13 + acum_303 + acum_313 + acum_403;  || irpf 3

    acum_99  = acum_99 +acum_50+acum_51+acum_52+acum_53+acum_54+acum_90;
     acum_991 = acum_991+acum_50+acum_51+acum_52+acum_53+acum_54+acum_90;
|SI runnom ! "nomcalir"; ;    || en el calculo de (%) IRPF no acumula pagas 99!
        acum_99  = acum_99 +acum1_200;
        acum_991 = acum_991+acum1_200;
|FINSI;
|SI runnom = "nomcalir"; |Y #labtraba#97 = 4; || ATENCION: si tengo ajustes a li-
        acum_99  = acum_99 +acum1_200;        || quido si que tiene que acumular
        acum_991 = acum_991+acum1_200;        || IRPF porque si no en la estimacion
|FINSI;                                       || no ajusta correctamente 23.03.2007
|SI sw_bruaju = 0;
    |SI #labtraba#42 ! "L"; |O #nomcontr#72 = "S";
            bruto_aju=bruto_aju+acum1_200;
    |SINO;
            bruto_aju=bruto_aju+acum1_200+acum_50+acum_51+acum_52+acum_53;
    |FINSI;
    sw_bruaju=1;
|FINSI;    || le suma al bruto ajustes lo que le falta (solo una vez)
    acum_99 = acum_99  ! EURODB;        || /de los conceptos que no retienen IRPF
    acum_991= acum_991 ! EURODB;
    acum_992= acum_992 ! EURODB;
    acum_993= acum_993 ! EURODB;
    bruto_rec = acum_99 + acum_41 + acum_60; || bruto recibo
    bruto_pag = acum2_200;                             || bruto pagas
    bruto_rec = bruto_rec ! EURODB;
    bruto_pag = bruto_pag ! EURODB;

     || tengo que quitarlo de aqui porque si no la base total de IRPF no sale bien
     || bien en casos de ajustes a liquidos que tienen conceptos que se ajustan
     || brutos


     |SI swDiosMio ! -1; || pero solo en la primera pasada del caso que haya IT

     ||Y nEstoyEnAjuste ! 11;  || y en este ajuste tampoco que si no no se me
                              || queda bien grabada la base en el mantenimiento

          || acum_99 = acum_99 - nAjusteEBnor - nAjusteEB410;
          || pero solo los que NO van a IRPF, los de de los que si van  no lo
          || quito de aqui, esto en teoria hemos deducido que es la causa
          || del problema del IRPF de diciembre de 2010, ver 700000.6217
          || que contiene ejemplos, por si diera problemas
          acum_99 = acum_99 - nAjusteEB4101 - nAjusteEB4102 - nAjusteEB4103;
     |FINSI;
     |SI #labtraba#247 = 138;
          acum_99 = 0;
          acum_991 = 0;
     |FINSI;
|FPRC;

|PROCESO repon_ajuste_calajus3;
     |SI runnom = "nomcalir";
          |SI #2#97 = 3; |Y #2#246 = "S"; || lo tengo que hacer para el ajuste
               #2#98 = #2#98 - especie;   || tipo 3, que al acumular en el propio
          |FINSI;                         || #2#98, lo incrementaba en la
     |FINSI;                              || estimacion
|FPRC;

|PROCESO calajust;
     |SI #2#246 = "S";   || incluye los anticipos y el en especie en los ajustes
          #2#98 = #2#98 + antici1 + antici2 + especie + antici4;
          #2#98 = #2#98 + ((-1) * nPreavisoDto);
          #2#98 = #2#98 + ((-1) * nVacDto);
          |SI #2#97 = 4; |O #2#97 = 6;   || parchecito: le quito lo de especie
              #2#98 = #2#98 - especie;   || para que no me incluya la especie
          |FINSI;                        || hasta despues del ajuste (fallaba
     |FINSI;                             || si no se estaba periodo completo
|FPRC;                                   || del alta)

|PROCESO Elgraba07;
     |SI #labtraba#213 ] 101;
          |SALVA_FICHA #10;
          #10#0 = #labtraba#87;
          #10#2 = #labtraba#213;
          |LEE 000#10=;
          |SI FSalida = 0;
               graba07 = #10#5;
               graba08 = #10#6;
          |FINSI;
          |REPON_FICHA #10;
     |FINSI;
|FPRC;

|PROCESO inclusoIT;
     || utilizo esto para lo del ajuste incluso en IT, tengo que poner la
     || variable stop para que no tenga en cuenta el dcofi_999 y se calcule
     || siempre entera, aparte ahora si que tengo que tener en cuenta las
     || prestaciones
     |SI #labtraba#183 = "S";      || mes completo siempre
          |SI #labtraba#182 = "S";      || cobra completo incluso en IT
               stop = nAjuste * 1;
               stop = stop - acum_53 - acum_54 - denfe_3 - denfe_4 - dacci_3;
          |SINO;
               || mes entero menos parte en IT
               stop = nAjuste * (dcofi_1  + (1 - dcofi_2));
               stop = stop - acum_53 - acum_54 - denfe_3 - denfe_4 - dacci_3;
          |FINSI;
     |SINO;
          |SI #labtraba#182 = "S";      || utilizo esto para lo del ajuste
               stop = nAjuste * dcofi_2;          || incluso en IT
               |SI dabse_2 ! 0;
                    stop = nAjuste * dcofi_3;     || absentismo
               |FINSI;
               |SI ddese_3 > 0;
                    stop = nAjuste * ((dcobr_0 + denfe_2 + dacci_2) / dia_4);  || incluso en IT
               |FINSI;
               stop = stop - acum_53 - acum_54 - denfe_3 - denfe_4 - dacci_3;
          |SINO;
               || normal, ni mes completo, ni incluso IT
          |FINSI;
     |FINSI;

     nNume1 = denfe_2 + dmate_2 + dacci_2 - swAjuste3;
     |SI nNume1 > 0; |Y #labtraba#182 = "N";
          || no tienes que hacer eso
     |SINO;
          stop = stop - nBonifFormTra; || historia tiquet 4209.512
     |FINSI;

     |SI swCitrico ! 0;
          || ajustes citricos (Dany) paso de coeficientes y cosas de ese tipo
          || aqui el dcofi_1 y dcofi_2 no tienen sentido
          stop = nAjuste;
     |FINSI;
     |SI swSegPasada = 0;
          nPaso = 1; |HAZ CompAjuste;
     |FINSI;
|FPRC;

|PROCESO calajus1;   || AJUSTA A BRUTOS (cotizando -120-, o sin cotizar -407-)
     |SI #2#97 [ 2; |Y #2#97 ! 0;
          |SI #2#97 = 1;
               concepto = 407;
          |SINO;
               concepto = 120;
          |FINSI;
          nAjuste = #2#98;
          |HAZ ajustes;
          |SI convenio = 0;
               stop = nAjuste * dcofi_999;   stop = stop ! EURODB;
               |SI nAcumAbs ! 0;
                    stop = nAjuste * dcofi_999A;   stop = stop ! EURODB;
               |FINSI;
               |HAZ inclusoIT;
               |HAZ parche_aju_IT;
               ajus_1 = stop - bruto_aju;
               |SI nAcumAbs ! 0;
                    ajus_1 = stop - (bruto_aju - nAcumAbs);
               |FINSI;
               |SI ajus_1 > 0; |Y #2#97 ! 1; |Y #2#97 ! 5;
                    |SI dilt ] dia_2;
                         || estoy todo el mes en IT y en el ajuste le tengo
                         || que meter algun importe: eso no es correcto porque
                         || me crearia una base de cotizacion en alta que no
                         || procede: aviso
                         ajus_1 = 0;
                         nIncid = 12;
                         |HAZ graba_inc;
                         |ACABA;
                    |FINSI;
               |FINSI;
               |SI ajus_1 > 0;|O #2#61 = "S";
                    graba04 = concepto;
                    graba05 = #10#3;
                    graba06 = #10#4;
                    graba07 = #10#5;
                    graba08 = #10#6;
                    |HAZ Elgraba07;
                    graba09 = 1;
                    graba10 = ajus_1;
                    graba11 = 1;
                    swgracon = 1;     || para que regrabe campos
                    swcongra = 1;     || para que acumule si existe
                    |HAZ grabacon;
                    |SI #2#97 = 1;
                         acum_40  =acum_40  +ajus_1;
                         |SI #10#8 = 1;  acum_401 =acum_401 +ajus_1;  |FINSI;
                         |SI #10#8 = 2;  acum_402 =acum_402 +ajus_1;  |FINSI;
                         |SI #10#8 = 3;  acum_403 =acum_403 +ajus_1;  |FINSI;
                    |SINO;
                         acum_10 =acum_10 +ajus_1;
                         |SI #10#8 = 1;  acum_11 =acum_11 +ajus_1;  |FINSI;
                         |SI #10#8 = 2;  acum_12 =acum_12 +ajus_1;  |FINSI;
                         |SI #10#8 = 3;  acum_13 =acum_13 +ajus_1;  |FINSI;
                    |FINSI;
                    bruto_aju = bruto_aju + ajus_1;
                    bruto_rec = bruto_rec + ajus_1; || actualiza bruto recibo
                    |SI #labtraba#247 ! 138;
                         |SI #10#8 = 1;  acum_991 =acum_991 +ajus_1;  |FINSI;
                         |SI #10#8 = 2;  acum_992 =acum_992 +ajus_1;  |FINSI;
                         |SI #10#8 = 3;  acum_993 =acum_993 +ajus_1;  |FINSI;
                         acum_99 = acum_99 + ajus_1;     || actualiza IRPF total
                    |FINSI;
                    |SI ajus_1 < 0; |Y runnom ! "nomcalfi"; |Y swParcheAjuIT = 0;
                         nIncid = 5;
                         |HAZ graba_inc;
                         nIncid = 6;
                         |SI #2#213 ] 101; aAlfa = #2#213; |SINO; aAlfa = #10#2; |FINSI;
                         aDesIncid = "  *** Concepto: " + aAlfa + ". CIF Empresa: " + #labempre#10 + "***";
                         |HAZ graba_inc;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO calajus11;   || AJUSTE ESPECIAL A BRUTOS (cotizando -120-, o sin cotizar -407-)
     nAjusteEB = 0;
     nAjusteEB = nAjusteEBnor1 + nAjusteEBnor2 + nAjusteEBnor3;
     nAjusteEB = nAjusteEB + nAjusteEB4101 + nAjusteEB4102 + nAjusteEB4103;
     nAjusteEB = nAjusteEB + nAjusteEB420;

     || funcionarios en junio 2010 en adelante, se les ha calculado una nueva
     || acum_10, por ser mayor la base de Mayo 2010 que lo que se les calcula
     || ahora, recupero con la acum_10 que me habia quedado en el ajuste
     || sino lo que sale no es coherente
     |SI swFuncRecorte = 1; |Y nNuevaAcum10 > 0;
          acum_10 = nAcum10_Antes;
     |FINSI;

     |SI #2#97 = 4; |Y nAjusteEB > 0;
          nEstoyEnAjuste = 11;    || para saber que estoy dentro de los calculos
          concepto = 121;
          nAjuste = nAjusteEB;
          stop = nAjuste;
          ||HAZ ajustes;
          |SI convenio = 0;
               ajus_1 = stop;
               |SI ajus_1 > 0;
                    |SI dilt ] dia_2; |Y swajuste11 = 0;
                         || estoy todo el mes en IT y en el ajuste le tengo
                         || que meter algun importe: eso no es correcto porque
                         || me crearia una base de cotizacion en alta que no
                         || procede: aviso
                         ajus_1 = 0;
                         nIncid = 12;
                         |HAZ graba_inc;
                         nEstoyEnAjuste = 0;
                         |ACABA;
                    |FINSI;
               |FINSI;
               ajus_1 = nAjusteEBnor1 + nAjusteEBnor2 + nAjusteEBnor3;
               ajus_1 = ajus_1 + nAjusteEB4101 + nAjusteEB4102 + nAjusteEB4103;
               |SI ajus_1 > 0;|O #2#61 = "S";
                    acum_10 = acum_10 + ajus_1;
                    acum_11 = acum_11 + nAjusteEBnor1 + nAjusteEB4101;
                    acum_12 = acum_12 + nAjusteEBnor2 + nAjusteEB4102;
                    acum_13 = acum_13 + nAjusteEBnor3 + nAjusteEB4103;
                    |HAZ calirpfr; || recalcula base IRPF recibo
                    |HAZ calirpfp; || recalcula retenciones IRPF recibo
                    |SI #labtraba#42 ! "H";
                         acum_10 =acum_10 - nAjusteEB4101 - nAjusteEB4102 - nAjusteEB4103;
                         |SI swajuste11 = 1;
                              acum_10 = acum_10 - nAjusteEBnor1 - nAjusteEBnor2 - nAjusteEBnor3;
                         |FINSI;
                         || me habra subido mi nuevo acum_10, vuelvo a hacer lo
                         || mismo que en calajus4, me quedo con nAcum10_Antes
                         || si el acum_10 cambia durante el calculo de bases
                         || luego me quedo con ese en este caso, no haria falta
                         || en verdad
                         nAcum10_Antes = acum_10;
                         |HAZ calcotiz;        || bases cotizacion
                    |SINO;
                         base_5 = 0;
                         base_6 = 0;   || los gerentes/coperativistas autonomos
                         base_7 = 0;   || no cotizan !!!
                         dacum_30 = 0;
                         dacum_31 = 0;
                    |FINSI;
                    |SI es_aprendi = 0;
                              |HAZ calboni1;  || calcula bases bonificacion y cuotas
                              ||HAZ calboni11; || idem de la segunda parte
                              swNoMensa = 1;
                              ||HAZ calboni60; || bonif mayores 60 a¤os, RDL 16/2001
                              nEmp = #labtraba#0;
                              nTra = #labtraba#1;
                              nMes = #0#8;
                              nAny = #0#9;
                              ||HAZ calboniFomEmp; || bonif comento contratacion indefinida RDL 5/2006
                         |SINO;
                              |HAZ calboni2;  || calcula cuotas aprendices R.D.-Ley 18/93
                         |FINSI;
                         |HAZ calboni3;      || cuotas acumuladas
                    bruto_aju = bruto_aju + ajus_1;
               |FINSI;
          |FINSI;
          || si no va a SS no tengo que sumarlo otra vez
          || al bruto recibo otra vez
          |SI nAjusteEB4101 > 0; |O nAjusteEB4102 > 0; |O nAjusteEB4103 > 0;
               bruto_rec = bruto_rec - nAjusteEB4101 - nAjusteEB4102 - nAjusteEB4103;
          |FINSI;
          nEstoyEnAjuste = 0;
     |FINSI;
     swajuste11 = 0;     || lo dejo como estab, claro
|FPRC;

|PROCESO calirpfp;   || CALCULA RETENCIONES IRPF
     reten1_pag = 0;

     reten_11 = acum_991 % nIRPF1;  || retencion IRPF 1
     reten_12 = acum_992 % nIRPF2;  || retencion IRPF 2
     reten_13 = acum_993 % nIRPF3;  || retencion IRPF 3
     reten_11 = reten_11 ! EURODB;
     reten_12 = reten_12 ! EURODB;
     reten_13 = reten_13 ! EURODB;
     reten_1 = reten_11 + reten_12 + reten_13;  || total retenciones
     |HAZ RetenPaga;
     |SI swCalPaga = 1;
          reten_2 = (acum2_200 % reten_p) ! EURODB;     || retencion IRPF pagas
     |FINSI;

     || para ajustes a liquido por si es necesario
     reten11_liq = (acum_991 - denfe_4) % nIRPF1; || retencion IRPF 1
     reten1_liq = reten11_liq + reten_12 + reten_13;  || total retenciones

     reten1_pag = (acump_200 % nIRPF1) ! EURODB;
|FPRC;


||****************************************************************************
||                     CALCULO FINAL 2 (ajuste a liquidos)
||****************************************************************************

|PROCESO calfin2;   || CALCULOS POSTERIORES AL AJUSTE A BRUTOS
nDesem = 0;

|SI #labtraba#42 ! "H";
    |HAZ calcotiz;        || bases cotizacion
|SINO;
        base_5 = 0;
        base_6 = 0;   || los gerentes/coperativistas autonomos
        base_7 = 0;   || no cotizan !!!
        dacum_30 = 0;
        dacum_31 = 0;
|FINSI;
swNoMensa = 0;
|| nBonifTex1 = 0;
|| nBonifTex2 = 0;
nBonifFCI1 = 0;
nBonifFCI2 = 0;
|SI es_aprendi = 0;
    |HAZ calboni1;  || calcula bases bonificacion y cuotas
    ||HAZ calboni11; || idem de la segunda partes
    ||HAZ calboni60; || bonif mayores 60 a¤os, RDL 16/2001
    nEmp = #labtraba#0;
    nTra = #labtraba#1;
    nMes = #0#8;
    nAny = #0#9;
    |HAZ calboniFomEmp; || bonif fomento contratacion indefinida RDL 5/2006
    |HAZ calboniERE; || bonif 50% CC ERE RDL 2/2009
|SINO;
    |HAZ calboni2;  || calcula cuotas aprendices R.D.-Ley 18/93
    |HAZ calboniERE; || bonif 50% CC ERE RDL 2/2009
|FINSI;
|HAZ calboni3;      || cuotas acumuladas
|HAZ repon_ajuste;
|SI swSegPasada = 1;
     nPaso = 4; |HAZ CompAjuste;
|FINSI;
|HAZ calajus3;      || ajusta a liquidos, concepto 407 (no cotiza)
|HAZ calajus4;      || ajusta a liquidos, concepto 120 (cotiza)
|HAZ calajus5;      || ajusta a liquidos y brutos, concepto 411 (no cotiza y no IRPF)
|HAZ calajus11;     || ajusta a brutos, concepto 407 (no cotiza) y 120 (cotiza)
|SI swSegPasada = 1;
     nPaso = 5; |HAZ CompAjuste;
|FINSI;
          |SI swFuncRecorte = 1; |Y acum_10 = 0;
               acum_10 = nNuevaAcum10;
          |FINSI;
          enImpRem = (acum_10 + dvalo_pro + exce_smi + coba_3) ! 2;
          enImpExt30 = dacum_30 ! 2;
          enImpExt31 = dacum_31 ! 2;
          |SI swCotizTramos = 1;
               |SI swDiosMio = -1; |O swSegPasada = 1;
                    |SI swDiosMio = -1; |Y swSegPasada = 1;
                         |HAZ CotizacionTramos;
                    |SINO;
                         || si no, no
                    |FINSI;
               |SINO;
                    |HAZ CotizacionTramos;
               |FINSI;
               |SI swCambiaProm = 1;
                    |HAZ proceso;
                    swCambiaProm = 0;
               |FINSI;
          |FINSI;
|HAZ calssemp;      || calcula S.S. cgo. empresa
|FPRC;

||****************************************************************************
||                       RUTINAS CALCULO FINAL 2
||****************************************************************************

|PROCESO calcotiz;       || BASES COTIZACION
     |SI #labtraba#247 = 138;
|HAZ calcotiz_138;  |ACABA; |FINSI;
     dacum_30 = acum_30;
     dacum_31 = acum_31;       || bases horas extraordinarias
     |HAZ RedFunc2010;         || 14.11.2018 -> lo quito, ya es hora
     |SI es_aprendi = 0;
          gua_i = hcoti_0;           || lo guarda por si varia
          |SI es_irregul = 1;|Y tpz ! 0;    hcoti_0 = tpz; |FINSI;   || irregulares
          swSigue = 0;
          |SI swCambiaCot = 1; |Y nEstoyEnAjuste = 0;
               |SI swAjuste3 ! 0; |O nDiasCotIT = guarda;
                    swSigue = 1;
               |FINSI;
          |FINSI;
          |SI swSigue = 1;
               || trab clave X en IT, a ver si tengo que cotizar el dia del ajuste
               swBuscoTPXIT = 1;        || este switch porque si no la cagamos
               |HAZ BuscaOtroAlta;      || porque no entra a contar los dias
               swBuscoTPXIT = 0;        || y aqui me hace falta
               |SI nDiasMesTrab = guarda;
                    |HAZ TPXenIT;
               |SINO;
                    || si no estoy de alta el mes completo, no tengo que cotizar
                    || un dia mas
                    swCambiaCot = 0;
               |FINSI;
          |FINSI;
          base_5 = cobb_1 + coba_2 + cobb_4;             || base AT (ILT)
          base_5cc = coba_1 + cobb_2 + coba_4;             || base AT (ILT)
          |SI #labtraba#42 = "L"; |Y #nomcontr#72 = "N";   || funcionarios sin ILT
               guarda_l = base_5;
               base_5 = 0;
          |FINSI;
          nume1 = acum_10 + dvalo_pro + exce_smi;   || ctos.100+prorr.+SMI
          nume2 = dacum_30 + dacum_31;              || horas extras
          base_6 = nume1 + coba_1 + cobb_2 + coba_3 + coba_4;           || CC
          base_7 = nume1 + cobb_1 + coba_2 + cobb_3 + cobb_4 + nume2;   || AT
          |SI #labtraba#42 = "T"; |O #labtraba#42 = "X";
               base_6 = base_6 + nume2;      || TP: cotizan a comunes tambien
          |FINSI;

          |SI swMinero = 1;
               base_6 = (hcoti_0 * nBaseMinero) ! 2;
          |FINSI;

          |SI sw_mater ! 0;
               base_6 = base_6 - coba_4;
               base_7 = base_7 - cobb_4;
          |FINSI;
          |SI nElMes = 2; |Y dabse_2 = 28;   || lo dejo ya a cero en este
               swAjuste3 = 0;                || caso para que no lo lie mas
          |FINSI;
          |SI swAjuste3 ! 0;
               |SI nBaseIT2 ! 0;
                    base_5cc = base_5cc - (swAjuste3 * nBaseIT2);
                    base_5 = base_5 - (swAjuste3 * nBaseIT2);
               |SINO;
                    base_5cc = base_5cc - (swAjuste3 * (prom_enf + prom_ac2));
                    base_5 = base_5 - (swAjuste3 * (prom_acc + prom_ac2));
               |FINSI;

               || bueno si hay horas extras y baja por accidente (prom_ac2) hay
               || que restar tambien lo que aumenta la base por culpa de las hext

               |SI dmate_2 = 0;    || en maternidad no me restes de las bases
               |Y swITEmp = 0;
                    |SI nBaseIT2 ! 0;
                         base_6 = base_6 - (swAjuste3 * nBaseIT2);
                         base_7 = base_7 - (swAjuste3 * nBaseIT2);
                    |SINO;
                         base_6 = base_6 - (swAjuste3 * prom_enf);
                         base_7 = base_7 - (swAjuste3 * prom_acc);
                    |FINSI;
               |FINSI;
          |FINSI;

          swajuen = 0;     || puede volver (en ajustes)
          nume1 = ddese_2;
          |SI swCambiaCot = 0; |HAZ liquidados; |FINSI;
          nDesem = nume1 * #labtraba#242;    || tengo regulacion de empleo
          nDesem = nDesem ! 2;
          nPropJub = 100;
          |HAZ JubilacionParcial;
          swFijoDH = 0;
          |SI #labtraba#45 ] 300; |Y #labtraba#45 [ 399;
               swFijoDH = 1;
               |SI #labtraba#47 = 0;
                    #labtraba#47 = (#nomconca#162 / 7) ! 2;
               |FINSI;
          |FINSI;
          |HAZ topes_cc;
          anynum = nElAny; mesnum = nElMes; |HAZ ulti_dia;

          |SI sw_mater = 0;
               nume1 = 30;                || maximo C.C. sin maternidad (30 dias porque
          |SINO;                         || la base de CC contiene alta+enf+acc
               |SI #labtraba#42 = "C"; |O #labtraba#42 = "F"; || si hay maternidad cojo solo los dias coti-
                    nume1 = fijo_1 + denfe_2 + dacci_2; || zables menos los de mater. pq la es lo que
               |SINO;                         || contiene la base de CC
                    nume1 = hcoti_0 - dmate_2 + swAjuste3;
               |FINSI;                  || menos en citricos claro
          |FINSI;

          |SI sw_mater ! 0; |Y dmate_2 = topemes; |Y nElMes = 2;
               nume1 = 0;     || en febrero, todo el mes alta y de maternidad
          |FINSI;
          swajuac = 0;     || puede volver (en ajustes)
          |HAZ topes_cp;

          anynum = nElAny; mesnum = nElMes;
          |HAZ ulti_dia;
          |SI sw_mater = 0;
               nume1 = 30;                || maximo C.C. sin maternidad (30 dias porque
          |SINO;                          || la base de CC contiene alta+enf+acc
               nume1 = hcoti_0 - dmate_2 + swAjuste3; || si hay maternidad cojo solo los dias coti-
          |FINSI;                         || zables menos los de mater. pq la es lo que
                                          || contiene la base de CC
          |SI sw_mater ! 0; |Y dmate_2 = topemes; |Y nElMes = 2;
               nume1 = 0;     || en febrero, todo el mes alta y de maternidad
          |FINSI;

          |SI nume1 < 0; nume1 = 0; |FINSI;  || por si acaso, nunca se sabe
          coti_0 = ((#15#20 * nume1) % propo) ! 2;         || maximo A.T.

          |SI coti_0 [ base_7; |Y propo = 100;
               base_7 = coti_0;
               aCPTopeadas = "M";
          |FINSI;

          hcoti_0 = gua_i;      || lo repone por si ha variado
     |SINO;
          base_5 = 0;
          |SI grupo [ 10; base_6 = #15#33;    base_7 = #15#23;    |FINSI;
          |SI grupo = 11; base_6 = #15#34;    base_7 = #15#21;    |FINSI;
          base_5 = base_6;
          swSigue = 0;
          |SI dcoti_0 ] 30;
               swSigue = 1;
          |FINSI;
          |SI nDiasMesTrab ] 28; |Y nElMes = 2; |Y nCuantos > 1; |Y #labtraba#42 = "D";
               dcoti_0 = dcoti_0 + 2 - bisiesto;
          |FINSI;
          |SI dcoti_0 ] 28; |Y #labtraba#42 = "D"; |Y nElMes = 2;
               swSigue = 1;
          |FINSI;
          |SI swSigue = 1;
               base_6 = (base_6 % nPorcFormacion) * 30;
               base_7 = (base_7 % nPorcFormacion) * 30;
          |SINO;
               base_6 = (base_6 % nPorcFormacion) * (dcoti_0 + ddese_3);
               base_7 = (base_7 % nPorcFormacion) * (dcoti_0 + ddese_3);
          |FINSI;
          |SI nDiasMesTrab ] 28; |Y nElMes = 2; |Y nCuantos > 1; |Y #labtraba#42 = "D";
               dcoti_0 = dcoti_0 - 2 + bisiesto;
          |FINSI;
          nDiasCotIT = denfe_2 + dmate_2 + dacci_2 - swAjuste3;
          |SI nDiasCotIT > 30;
               nDiasCotIT = 30;
          |FINSI;
          |SI nDiasCotIT ] 28; |Y #labtraba#42 = "D"; |Y nElMes = 2;
               nDiasCotIT = 30;
          |SINO;
               || no puede haber mas dias cot. en IT que cot. en alta
               |SI nDiasCotIT > dcoti_0; nDiasCotIT = dcoti_0; |FINSI;
          |FINSI;
          nPromEnf_ENTERO = base_5 % nPorcFormacion;
          base_5 = (base_5 % nPorcFormacion) * nDiasCotIT;
          |SI nDiasCotIT ! 0;
               |HAZ ExaminaIT;
          |FINSI;
          |SI dmate_2 ! 0;    || SOLO PARA MATERNIDAD (hombre)
               |SI denfe_2 ! 0;
                    || tengo enf y mat
                    |SI swAjuste3 ! 0; |Y aTipUltimaIT = "M";
                         base_6 = base_6 - ((dmate_2 - swAjuste3) * #15#33);
                         base_7 = base_7 - ((dmate_2 - swAjuste3) * #15#23);
                    |SINO;
                         base_6 = base_6 - (dmate_2 * #15#33);
                         base_7 = base_7 - (dmate_2 * #15#23);
                    |FINSI;
               |SINO;
                    base_6 = base_6 - (base_5 ! 2);
                    base_7 = base_7 - (base_5 ! 2);
               |FINSI;
               |SI #labtraba#42 = "D";
                    nNume1 = #15#23 * 30; || maximo, mas de esto no se puede
                    |SI coba_4 > nNume1;  || cotizar en formacion por nada
                         coba_4 = nNume1; || aunque sea diraio en formacion
                         cobb_4 = nNume1;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI denfe_2 ! 0;
               |SI #labtraba#241 = "N"; |Y #labtraba#138 = "N";
                    || enfermedad sin prestaciones: a la base empresarial
                    || si coincide con maternidad, ya veremos
                    base_6 = base_6 - (base_5 ! 2);
                    base_7 = base_7 - (base_5 ! 2);
               |FINSI;
          |FINSI;
          |SI grupo ! 10; |Y grupo ! 11; |Y #labtraba#45 ! "422"; || becarios si
               nIncid = 28;
               |HAZ graba_inc;
          |FINSI;
          nume1 = ddese_2; |HAZ liquidados;
          nDiasCotERE = nume1;
          |HAZ ERE_Formacion;
     |FINSI;
|FPRC;

|PROCESO topes_it_prof;
     swSigue = 0;
     |SI #labtraba#42 = "C"; |O #labtraba#42 = "F"; swSigue = 1; |FINSI;
     |SI #labtraba#42 = "D"; swSigue = 1; |FINSI;
     |SI #labtraba#33 ] 08;  swSigue = swSigue + 1; |FINSI;
     |SI #0#8 = 2; swSigue = swSigue + 1; |FINSI;
     nNume1 = denfe_2 + dacci_2 + dmate_2;
     |SI nNume1 = 28; |O nNume1 = 29; swSigue = swSigue + 1; |FINSI;
     |SI dalta_3 = 1; |Y dbaja_3 = guarda; |Y nDiasInactividad = 0;
          swSigue = swSigue + 1;
     |FINSI;
     |SI swSigue = 5;
          || en resumen, citrico, diario, febrero, todo el mes en IT
          coti_1 = (#nomconst#campomin# * 30);
          |SI base_7 < coti_1;
               nDifDiarioFeb = coti_1 - base_7;
               base_5 = base_5 + nDifDiarioFeb;
               base_7 = base_7 + nDifDiarioFeb;
               aCPTopeadas = "m"
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO topes_cc;
     |SI #labtraba#247 = 138; |ACABA; |FINSI;
     swApliMin = 0;
     swApliMax = 0;
     nTopeMax = hcoti_0;    || para maximo de dias de grupos > 8
     nTopeMin = hcoti_0;    || para maximo de dias de grupos > 8
     |SI nTopeMax > 30;  || diarios grupo [ 07, raro pero hay
          nTopeMax = 30; || estaba igual pero comprobaba que el grupo fuera
     |FINSI;             || > 08 ... vale para todos los grupos claro
     |SI dhuel_2 > 0;
          nTopeMax = nTopeMax + dhuel_2 - dhuel_3;
          nTopeMin = nTopeMin + dhuel_2 - dhuel_3;
          |SI nTopeMin < 1; |Y nTopeMax < 1; || chorrada milenaria
               nTopeMin = 1; nTopeMax = 1;
          |FINSI;
     |FINSI;
     nTopeMax = nTopeMax - dperm_2; nTopeMin = nTopeMin - dperm_2;
     |SI nTopeMax < 0; nTopeMax = 0; |FINSI;
     |SI nTopeMin < 0; nTopeMin = 0; |FINSI;
     campomax = grupo + 35;  coti_1 = #15campomax * nTopeMax; ||maximo C.C.
     campomin = grupo + 23;  coti_0 = #15campomin * nTopeMin; ||minimo C.C.
     |SI #labtraba#135 ! "S";  || jubilacion parcial, no lo hago por horas
          |SI es_parcial = 1; |O swFijoDH = 1;  || soy tiempo parcial
               campomin = 58;
               campomin = campomin + grupo;
               nume2 = dcoti_0 - dperm_2;
               nume1 = (#labtraba#47 * nume2);
               |SI 0 < nume1; |Y nume1 < 0.5;
                    nume1 = 1;
               |SINO;
                    nume1 = nume1 ! 0;
               |FINSI;
               |SI #labtraba#97 = 4; |Y nHorasCEC ! 0; nume1 = nHorasCEC; |FINSI;
               coti_0 = #15campomin * nume1;
               |HAZ topes_tp_it_comunes;
          |FINSI;
     |FINSI;

     |SI horastp ! 0;|Y es_irregul = 1;
          |SI #labtraba#42 = "P"; campomin = 58; |SINO; campomin = 47;  |FINSI;
          campomin = campomin + grupo;
          coti_0 = #15campomin * horastp;
     |FINSI;
     |SI #labtraba#248 = 509; |Y es_parcial = 1; |Y nElAny ] 2011;
          || excluidos de fogasa, limite por horas que salio en el boletin
          || 2011/1
          campomin = 47;
          campomin = campomin + grupo;
          nNume1 = #15campomin * nTopeMin;
          |SI coti_0 < nNume1;
               coti_0 = nNume1;     || si no, el minimo por horas
          |FINSI;
     |FINSI;
     |SI sw_mater ! 0;
          |SI nBaseIT2 = 0;
               base_6 = base_6 + coba_4 - (swAjuste3 * prom_enf);
          |SINO;
               base_6 = base_6 + coba_4 - (swAjuste3 * nBaseIT2);
          |FINSI;
     |FINSI;
     |HAZ PluriempleoCC;
     |HAZ MinimosCC;
     |HAZ MaximosCC;
     swIguales = 0;

     |SI base_5 = base_6; swIguales = 1; |FINSI;
     |SI coti_1 [ base_6;
          base_6 = coti_1;
          swajuen = 1;
          aCCTopeadas = "M";
     |FINSI;
     |SI base_5 ! base_6; |Y swIguales = 1; base_5 = base_6; |FINSI;
     |SI nElMes = 2; |Y denfe_2 = dia_2; || feb, todo el mes en enf.
          |SI swApliMin = 1;             || si he topeado a minimos
               |SI base_6 > base_5;
                    base_5 = base_6;    || igualo bases, si no da luego error
               |FINSI;                  || 001485.00236
          |FINSI;
     |FINSI;
     |SI sw_mater ! 0;
          |SI nBaseIT2 = 0;
               base_6 = base_6 - coba_4 + (swAjuste3 * prom_enf);
          |SINO;
               base_6 = base_6 - coba_4 + (swAjuste3 * nBaseIT2);
          |FINSI;
          |SI base_6 < 0; coba_4 = coba_4 + base_6; base_6 = 0; |FINSI;
     |FINSI;
     || comentario (5) libro de comentarios nomcal_5
|FPRC;

|PROCESO topes_cp;
     |SI #labtraba#247 = 138; |ACABA; |FINSI;
     nNume2 = 28 + bisiesto;
     |SI #0#8 = 2; |Y hcoti_0 ] nNume2;                  || EXCEPCION GORDA:
          nNume1 = denfe_2 + dacci_2 + dmate_2 - swAjuste3;
          |SI nNume1 < 0; nNume1 = 0; |FINSI;
          |SI nNume1 = 0; hcoti_0 = 30; |FINSI;    || solo si todo el mes alta
     |FINSI;
     nTopeMax = hcoti_0;    || para maximo de dias de grupos > 8
     nTopeMin = hcoti_0;    || para maximo de dias de grupos > 8
     |SI nTopeMin > 30;
           nTopeMin = 30;
     |FINSI;
     |SI dhuel_2 > 0;
          nTopeMax = nTopeMax + dhuel_2 - dhuel_3;
          |SI nTopeMin < 1; |Y nTopeMax < 1; || chorrada milenaria
               nTopeMin = 1; nTopeMax = 1;
          |FINSI;
     |FINSI;
     nTopeMax = nTopeMax - dperm_2; nTopeMin = nTopeMin - dperm_2;
     |SI nTopeMax < 0; nTopeMax = 0; |FINSI;
     |SI nTopeMin < 0; nTopeMin = 0; |FINSI;
     |SI nTopeMax [ 30;
          coti_0 = #15#20 * nTopeMax;                         || maximo A.T.
          |SI grupo = 12; coti_1 = #15#22 * nTopeMax;  |FINSI;    || minimo A.T.
          |SI grupo = 11; coti_1 = #15#21 * nTopeMax;  |FINSI;
          |SI grupo < 11; coti_1 = #15#23 * nTopeMax;  |FINSI;
     |SINO;
          coti_0 = #15#20 * 30;                              || maximo A.T.
          |SI grupo = 12; coti_1 = #15#22 * 30;       |FINSI;    || minimo A.T.
          |SI grupo = 11; coti_1 = #15#21 * 30;       |FINSI;
          |SI grupo < 11; coti_1 = #15#23 * 30;       |FINSI;
     |FINSI;
          |SI #labtraba#135 ! "S";  || jubilacion parcial, no lo hago por horas
               |SI es_parcial = 1; |O swFijoDH = 1;  || soy tiempo parcial
                    |SI grupo ] 11; campomin = 73; |SINO; campomin = 72; |FINSI;
                    nume2 = (dcoti_0 - dperm_2);
                    nume1 = (#labtraba#47 * nume2);
                    |SI 0 < nume1; |Y nume1 < 0.5;
                         nume1 = 1;
                    |SINO;
                         nume1 = nume1 ! 0;
                    |FINSI;
                    |SI #labtraba#97 = 4; |Y nHorasCEC ! 0; nume1 = nHorasCEC; |FINSI;
                    coti_1 = #15campomin * nume1;
                    |HAZ topes_tp_it_prof;
               |FINSI;
          |FINSI;
     |SI #labtraba#248 = 509; |Y es_parcial = 1; |Y nElAny ] 2011;
          || excluidos de fogasa, limite por horas que salio en el boletin
          || 2011/1
          campomin = 47;
          campomin = campomin + grupo;
          nNume1 = #15campomin * nTopeMin;
          |SI coti_1 < nNume1;
               coti_1 = nNume1;     || si no, el minimo por horas
          |FINSI;
     |FINSI;
     |SI horastp ! 0;|Y es_irregul = 1;
          |SI grupo ] 11;
               |SI #labtraba#42 = "P"; campomin = 73; |SINO; campomin = 71; |FINSI;
          |SINO;
               |SI #labtraba#42 = "P"; campomin = 72; |SINO; campomin = 70; |FINSI;
          |FINSI;
          coti_1 = #15campomin * horastp;
     |FINSI;
     |SI sw_mater ! 0;
          |SI nBaseIT2 = 0;
               base_7 = base_7 + cobb_4 - (swAjuste3 * prom_enf);
          |SINO;
               base_7 = base_7 + cobb_4 - (swAjuste3 * nBaseIT2);
          |FINSI;
     |FINSI;
     |HAZ PluriempleoCP;

     nDifDiarioFeb = 0;
     |HAZ topes_it_prof;
     |HAZ MinimosCP;
     |HAZ MaximosCP;
     swIguales = 0;
     |SI base_5 = base_7; swIguales = 1; |FINSI;

     |SI base_7 ] coti_0;
           base_7 = coti_0;
           swajuac = 1;
          aCPTopeadas = "M";
     |FINSI;
     |SI base_5 ! base_7; |Y swIguales = 1; base_5 = base_7; |FINSI;
     |SI sw_mater ! 0;
          |SI nBaseIT2 = 0;
               base_7 = base_7 - cobb_4 + (swAjuste3 * prom_enf) - nDifDiarioFeb;
          |SINO;
               base_7 = base_7 - cobb_4 + (swAjuste3 * nBaseIT2);
          |FINSI;
          |SI base_7 < 0; cobb_4 = cobb_4 + base_7; base_7 = 0; |FINSI;
     |FINSI;
     || comentario (6) libro de comentarios nomcal_5
|FPRC;

|PROCESO calboni1;       || CALCULA BASES BONIFICACION
     bon_0 = 0;           || base CC bonificacion (1)
     bon_3 = 0;           || base CP bonificacion (1)
     bon_5 = 0;           || base CC ILT bonificacion (1)
     bon_7 = 0;           || base CP ILT bonificacion (1)
     bon_1 = por1_cont;   || (%) cont. comunes
     bon_2 = por1_dfpg;   || (%) D+F+P
     dto_con_pag = 0;
     dto_dfp_pag = 0;
     |SI runnom = "nomcalfi";
          || contratos de interinidad por sustitucion por maternidad no
          || de bonifican en finiquitos: 3923.302
          |SI #labtraba#45 = "410"; |O #labtraba#45 = "510";
               |ACABA;
          |FINSI;
     |FINSI;
     swSigue = 0;
     |SI #2#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0; swSigue = 1; |FINSI;
     |SI #2#39 ! 0;                 |Y #nombonif#28 ! 0; swSigue = 1; |FINSI;
     |SI swSigue = 1;
          lin_1 = #16#6 % nPorBon1;
          lin_2 = #16#7 % nPorBon1;
          bon_0 = base_6;
          bon_3 = base_7;          || horas extras entran en la base de bonif.
          bon_5 = base_5;          || 160.1159
          nBaseBon945 = nBaseBon945 * dcofi_1;
          |SI nBaseBon945 ! 0; bon_0 = nBaseBon945; bon_3 = nBaseBon945; |FINSI;
          |SI sw_mater = 1; |Y #labtraba#42 ! "H";
               bon_0 = bon_0 + coba_4 - (swAjuste3 * prom_enf);
               bon_3 = bon_3 + cobb_4 - (swAjuste3 * prom_enf);
          |FINSI;
          |SI nDesem ! 0;
               bon_0 = bon_0 + nDesem;
               bon_3 = bon_3 + nDesem;
          |FINSI;
          bon_1 = por1_cont - lin_1;
          bon_2 = por1_dfpg - lin_2;
          |SI dboni_1 ! dcoti_0;    || dias bonificacion distintos a dias cotizacion
               |HAZ el_caso_raro;
               |SI nDiasBonBaja ! 0;
                    bon_0 = bon_0 - bon_5;
                    bon_3 = bon_3 - bon_5;
                    nDiasBaja = denfe_2 + dmate_2 + dacci_2 - swAjuste3;
                    |SI swCambiaCot = 0;
                         |SI dboni_1 = nDiasBonBaja;
                              dboni_1 = dboni_1 - swAjuste3;
                         |FINSI;
                         nDiasBonBaja = nDiasBonBaja - swAjuste3; || 001624.02538
                    |FINSI;
                    |SI dboni_1 < nDiasBonBaja;   || no puede ser menor el nro de
                         dboni_1 = nDiasBonBaja;  || dias Bonif que el numero de
                    |FINSI;                       || dias bonif en IT 001624.02563
                    nume1 = (dboni_1 - nDiasBonBaja) / (dcoti_0 - nDiasBaja);
                    bon_0 = bon_0 * nume1;
                    bon_3 = bon_3 * nume1;
                    bon_5 = prom_enf * nDiasBonBaja;    || dias bonificacion distintos a dias cotizacion
                    bon_7 = prom_acc * nDiasBonBaja;    || dias bonificacion distintos a dias cotizacion
                    |SI nElMes = 1; |O nElMes = 2; |O nElMes = 3; |O nElMes = 5;
                    |O nElMes = 7; |O nElMes = 8; |O nElMes = 10; |O nElMes = 12;
                         || a ver, mas ajustes, si estoy el mes entero de
                         || IT, swAjuste3 es cero, con lo que no cuento los
                         || dias de ajuste para la parte de bonif en IT
                         || hago esto para solucionarlo
                         nNume1 = denfe_2 + dmate_2 + dacci_2;
                         |SI swAjuste3 = 0; || si no ya he ajustado antes
                         |Y #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                         |Y nNume1 = topemes;
                              bon_5 = bon_5 - (prom_enf * nElAjuste);
                              bon_7 = bon_7 - (prom_acc * nElAjuste);
                         |FINSI;
                    |FINSI;
                    bon_0 = bon_0 + bon_5;
                    bon_3 = bon_3 + bon_7;
               |SINO;
                    nume1 = dboni_1 / (dboni_1 + dboni_2);
                    bon_0 = bon_0 * nume1;
                    bon_3 = bon_3 * nume1;
                    bon_5 = bon_5 * nume1;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI base_6p_com = 0; || ccc
          dto_con = base_6 % bon_1;       dto_con = dto_con ! EURODB; || cont. comunes
          dto_dfp = ((base_7 % por1_des) ! 2) + ((base_7 % por1_fp) ! 2);
          dto_sol_tra = (base_6 % #nomconst#93) ! EURODB; || cot.solidaridad
          dto_sol_emp = ((base_6 % (#nomconst#92 + #nomconst#93)) ! 2) - dto_sol_tra;
     |SINO;
          |HAZ CotizPluriTrab;
     |FINSI;
     dto_ho1 = dacum_30 % por1_hor1; dto_ho1 = dto_ho1 ! EURODB; || horas no
     dto_ho2 = dacum_31 % por1_hor2; dto_ho2 = dto_ho2 ! EURODB; || horas si
     || para ajustes a liquido si es necesario
     dto_con_liq = (base_6 - coba_1) % bon_1;
     dto_con_liq = dto_con_liq ! EURODB;
     dto_dfp_liq = (base_7 - coba_1) % bon_2;
     dto_dfp_liq = dto_dfp_liq ! EURODB;

     dto_con_pag = (acump_200 % bon_1) ! EURODB;
     dto_dfp_pag = (acump_200 % bon_2) ! EURODB;

     |SI #16#10 = 4;           || RDL 16/2001 2.2.1
          bon_1 = por1_cont - #16#6;
     |FINSI;
|FPRC;
/*
|| este proceso me sobra, lo hago ya en el calculo nuevo de tramos
|PROCESO calboni11;      || CALCULA BASES BONIFICACION
    zbon_0 = 0;          || base CC bonificacion (2)
    zbon_3 = 0;          || base CP bonificacion (2)
    zbon_5 = 0;          || base ILT bonificacion (2)
    zbon_1 = 0; zbon_2 = 0;
    zbon_1 = por1_cont;  || (%) cont. comunes
    zbon_2 = por1_dfpg;  || (%) D+F+P
|SI #2#39 ! 0; |Y dboni_2 ! 0; |Y nPorBon2 ! 0;
        lin_1 = #16#6 % nPorBon2;
        lin_2 = #16#7 % nPorBon2;
        zbon_0 = base_6 + nDesem;
        zbon_3 = base_7 + nDesem;
        zbon_5 = base_5;
    |SI sw_mater = 1;
            zbon_0 = zbon_0 + coba_4;  ||(dmate_2 * prom_enf);
            zbon_3 = zbon_3 + cobb_4;  ||(dmate_2 * prom_acc);
    |FINSI;
    |SI nDesem ! 0;
            zbon_0 = zbon_0 + nDesem;  ||(dmate_2 * prom_enf);
            zbon_3 = zbon_3 + nDesem;  ||(dmate_2 * prom_acc);
    |FINSI;
        zbon_1 = por1_cont - lin_1;
        zbon_2 = por1_dfpg - lin_2;
    |SI dboni_2 ! dcoti_0;    || dias bonificacion distintos a dias cotizacion
            nume1 = dboni_2 / (dboni_1 + dboni_2);
            zbon_0 = zbon_0 * nume1;
            zbon_3 = zbon_3 * nume1;
            zbon_5 = zbon_5 * nume1;
    |FINSI;
        nume1 = bon_0 + zbon_0;
    |SI nume1 ! base_6;  zbon_0 = zbon_0 - (nume1 - base_6);     |FINSI;
        nume1 = bon_3 + zbon_3;
    |SI nume1 ! base_7;  zbon_3 = zbon_3 - (nume1 - base_7);     |FINSI;
|FINSI;
|SI #16#10 = 4;           || RDL 16/2001 2.2.1
        zbon_1 = por1_cont - #16#6;
|FINSI;
|FPRC;
*/
|PROCESO calboni2;
     bon_0 = 0; zbon_0 = 0;
     bon_1 = 0;
     bon_2 = 0;
     bon_3 = 0; zbon_3 = 0;
     bon_5 = 0; zbon_5 = 0;
     |SI #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
          dto_con = #nomconst#83; dto_dfp = #nomconst#85;
          |SI #2#45 = "422";
               dto_dfp = 0;
          |SINO;
               |SI #labtraba#190 = "S";
                    dto_dfp = #nomconst#85 + #nomconst#91;
                    dto_des = #nomconst#91;
               |FINSI;
          |FINSI;
          |SI runnom ! "nomcalfi";
               |SI #labtraba#191 = "S"; |O #labtraba#191 = "T";
                    nBonifFormEmp = #nomconst#82 + #nomconst#84;
                    nBonifFormEmp = nBonifFormEmp + #nomconst#86 + #nomconst#87;
                    nBonifFormTra = #nomconst#83 + #nomconst#85;
                    |SI #labtraba#190 = "S";
                         nBonifFormEmp = nBonifFormEmp + #nomconst#90;
                         nBonifFormTra = nBonifFormTra + #nomconst#91;
                    |FINSI;
                    nNume1 = dbaja_3 - dalta_3 + 1;   || por si viene de mat. y acaba este mes
                    |SI dmate_2 ] dia_2; |O dmate_2 ] nNume1; nBonifFormTra = 0; |FINSI;
                    |SI #labtraba#42 = "D"; |Y dmate_2 = 30; |Y topemes = 31;
                    |Y dbaja_3 = 31;         || parche feo, y mal puesto
                         nBonifFormTra = 0;  || quitarlo si molesta
                    |FINSI;
                    |SI #labtraba#191 = "T";
                         nBonifFormEmp = nBonifFormEmp % 75;
                    |FINSI;
                    |SI #2#45 = "422"; |Y #labtraba#191 = "S";
                         nBonifFormEmp = #nomconst#82 + #nomconst#86 + #nomconst#87;
                         nBonifFormTra = #nomconst#83;
                         |SI nElAny [ 2013;
                              nBonifFormEmp = 0; nBonifFormTra = 0;
                         |SINO;
                              |SI nElAny = 2014; |Y nElMes < 8;
                                   nBonifFormEmp = 0; nBonifFormTra = 0;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          swForm = 1;
          |HAZ BuscaOtroForm;
          nNume1 = base_6 ! 0;
          aAlfa = nNume1; |QBF aAlfa;
          aAlfa1 = nNume1; |QBF aAlfa1;
          |SI aAlfa = "0"; |O aAlfa1 = "-0";  || todo el mes en maternidad, por ejemplo
               dto_dfp = 0; dto_con = 0; dto_des = 0;
          |FINSI;
     |FINSI;
     dto_ho1 = dacum_30 % por1_hor1; dto_ho1 = dto_ho1 ! EURODB; || horas no
     dto_ho2 = dacum_31 % por1_hor2; dto_ho2 = dto_ho2 ! EURODB; || horas si
|FPRC;

|PROCESO calboni3;
     dto_tot = dto_con + dto_dfp + dto_ho1 + dto_ho2 + dto_sol_tra;
     |SI es_aprendi = 1; |Y dto_con = 0; |Y nBonifFormTra ! 0;
     |Y runnom = "nomcalir"; |Y #2#97 = 4;  || parche 5127.369
          dto_tot = dto_tot + nBonifFormTra;
     |FINSI;
     dto_tot = dto_tot + reten_1;        || total dtos. (no anticipos/especie)
     dto_tot_pag = reten1_pag;
     liquido = bruto_rec - dto_tot;      || liquido bueno
     nNume1 = denfe_2 + dmate_2 + dacci_2 - swAjuste3;

     || ESTO NO ESTA BIEN, revisar el tiquet 2884.2827 para ver por
     || que se puso, y el 5050.344 que es en el que ha fallado y lo he
     || dejado como estaba
     || lo vuelvo a activar con el 3430.990, y lo dejor que no actue si el
     || trabajador tiene "Incluso en IT" a SI, que es el caso que no salia
     || bien
     |SI nNume1 > 0; |Y #labtraba#182 = "N";
          || tengo alguna IT y ajustar en IT SI
          || pero descontando solo lo de la parte que entra en el liquido mas la
          || prorrata para la SS, no todo. Tiquet 002884.02827
          liq_aju = bruto_aju;          || liquido para ajustes a liquido
          |SI swPagasProrr = 1;             || si la ultima paga es prorr (esto
               nNume2 = bruto_aju;      || habria que hacerlo por paga) asumo
          |SINO;                        || que todas lo son y no tengo en cuenta
               nNume2 = bruto_aju + dvalo_pro;    || la prorrata en ajustes
          |FINSI;                       || a liquido ya que va en el bruto
          |SI es_aprendi = 0;
               liq_aju = liq_aju - (nNume2 % por1_cont);
               liq_aju = liq_aju - (nNume2 % por1_dfpg);
          |SINO;
               |SI #labtraba#191 ! "S";
                    liq_aju = liq_aju - (#nomconst#83 + #nomconst#85 + #nomconst#91);
                    || asumo que todos los 421 cotizan al desempleo, paso de lios
               |FINSI;
          |FINSI;
          liq_aju = liq_aju - (bruto_aju % nIRPF1) + dto_tot_pag;
     |SINO;
          || como siempre, no me meto en lios

          liq_aju = bruto_aju - dto_tot + dto_tot_pag;      || liquido ajustes
     |FINSI;
|FPRC;

|PROCESO repon_ajuste;
     |SI runnom = "nomcalir";
          |SI #2#246 = "S";
               #2#98 = #2#98 - antici1 - antici2 - especie - antici4;
               #2#98 = #2#98 - nPreavisoDto - nVacDto;
               |SI #2#97 = 4; |O #2#97 = 3;   || habia un problema al regularizar
                   #2#98 = #2#98 + especie;   || ya que mes a mes iba acumulando
               |FINSI;                        || conceptos en especie y anticipos
          |FINSI;                             || al #2#98 y estimaba una barbaridad
     |FINSI;
|FPRC;

|PROCESO calajus3;   || AJUSTA A LIQUIDOS (no cotizar -407-)
     |SI #2#97 = 3;
          concepto = 407;
          nAjuste = #2#98;
          nAjuste = nAjuste - nBonifFormTra; || formacion bonificados 1472.677
          |HAZ ajustes;
          |SI convenio = 0;
               stop = nAjuste * dcofi_999;   stop = stop ! EURODB;
               |HAZ inclusoIT;
               difere = stop - liq_aju;               || cantidad a ajustar
               |SI difere > 0;|O #2#61 = "S";
                    ajus_2 = (difere*100)/(100-nIRPF1); || cant.a aj. sin (%)ret.
                    ajus_2 = ajus_2 ! EURODB;
                    difere = (bruto_aju+ajus_2)-(dto_tot-reten_1);  || recalculo
                    difer1 = (acum_99+ajus_2)%nIRPF1;                || /del IRPF
                    difer1 = difer1 ! EURODB;
                    difere = difere - difer1;
                    ajus_2 = ajus_2 + (stop - difere); || reaj. por diferencia
                    ajus_2 = ajus_2 ! EURODB;
                    acum_40  =acum_40  +ajus_2;
                    |SI #10#8 = 1;  acum_401 =acum_401 +ajus_2;  |FINSI;
                    |SI #10#8 = 2;  acum_402 =acum_402 +ajus_2;  |FINSI;
                    |SI #10#8 = 3;  acum_403 =acum_403 +ajus_2;  |FINSI;
                    bruto_aju=bruto_aju+ajus_2;
                    |HAZ calirpfr;
                    |HAZ calirpfp;
                    graba04 = concepto;
                    graba05 = #10#3;
                    graba06 = #10#4;
                    graba07 = #10#5;
                    graba08 = #10#6;
                    |HAZ Elgraba07;
                    graba09 = 1;
                    graba10 = ajus_2;
                    graba11 = 1;
                    swgracon = 1;  || para que regrabe los campos si existe
                    swcongra = 1;  || para que acumule si existe
                    |HAZ grabacon;
                    |SI difere < 0;  |Y runnom ! "nomcalfi";
                         nIncid = 5;
                         |HAZ graba_inc;
                         nIncid = 6;
                         |SI #2#213 ] 101; aAlfa = #2#213; |SINO; aAlfa = #10#2; |FINSI;
                         aDesIncid = "  *** Concepto: " + aAlfa + ". CIF Empresa: " + #labempre#10 + "***";
                         |HAZ graba_inc;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ repon_ajuste_calajus3;
     |FINSI;
|FPRC;

|PROCESO calajus4;   || AJUSTA A LIQUIDOS (cotiza -120-)
     |SI #2#97 = 4;
          nEstoyEnAjuste = 4;    || para saber que estoy dentro de los calculos
          difere = 0;         || de un ajuste
          concepto = 120;
          nAjuste = #2#98;
          |HAZ ajustes;
          |SI convenio = 0;
               liq_aju = liq_aju ! EURODB;
               |SI liq_aju < 0;
                    liq_aju = 0;
               |FINSI;
               stop = nAjuste * dcofi_999;
               |HAZ inclusoIT;
               |SI #2#246 = "S";
                    stop = stop + especie;
               |FINSI;
               |SI #2#246 = "S"; |Y runnom = "nomcalir";
                    stop = stop + antici1 + antici2 + antici3;
                    stop = stop + ((-1) * nPreavisoDto) + ((-1) * nVacDto);
               |FINSI;
               |SI #labtraba#42 = "H"; |Y deducss ! 0;
                    stop = stop + deducss;   || a¤ado deducciones ss del 916
               |FINSI;                       || para autonomos
               stop = stop ! EURODB;
               |SI stop > 0;
                    |SI dilt ] dia_2; |Y #labtraba#182 ! "S";
                         || estoy todo el mes en IT y en el ajuste le tengo
                         || que meter algun importe: eso no es correcto porque
                         || me crearia una base de cotizacion en alta que no
                         || procede: aviso
                         stop = 0;
                         difere = 0;
                         nIncid = 12;
                         |HAZ graba_inc;
                         nEstoyEnAjuste = 0;
                         |ACABA;
                    |FINSI;
               |FINSI;

               |PARA; |SI liq_aju ! stop; |HACIENDO;
                    difer1 = stop - liq_aju;
                    alfa1 = difer1; |SI alfa1 = "0";|O alfa1 = "-0"; difer1 = 0; |FINSI;
                    |SI difer1 > 0;|O #2#61 = "S";
                         difere = difere + difer1;   || acumula dif. en var.trab.
                         acum_10 =acum_10 + difer1;
                         |SI #10#8 = 1;  acum_11 =acum_11 +difer1;  |FINSI;
                         |SI #10#8 = 2;  acum_12 =acum_12 +difer1;  |FINSI;
                         |SI #10#8 = 3;  acum_13 =acum_13 +difer1;  |FINSI;
                         bruto_aju = bruto_aju + difer1;
                         |HAZ calirpfr; || recalcula base IRPF recibo
                         |HAZ calirpfp; || recalcula retenciones IRPF recibo
                         |SI #labtraba#42 ! "H";
                              nAcum10_Antes = acum_10;
                              |HAZ calcotiz;        || bases cotizacion
                              || la nueva acum_10 solo la usan los funcionarios
                              || para el calculo de las cuotas de la SS, para el
                              || resto de calculos tengo que usar la remuneracion
                              || real
                              |SI swFuncRecorte = 1;
                                   acum_10 = nAcum10_Antes;
                              |FINSI;
                         |SINO;
                              base_5 = 0;
                              base_6 = 0;   || los gerentes/coperativistas autonomos
                              base_7 = 0;   || no cotizan !!!
                              dacum_30 = 0;
                              dacum_31 = 0;
                         |FINSI;
                         |SI es_aprendi = 0;
                              |HAZ calboni1;  || calcula bases bonificacion y cuotas
                              ||HAZ calboni11; || idem de la segunda parte
                              swNoMensa = 1;
                              ||HAZ calboni60; || bonif mayores 60 a¤os, RDL 16/2001
                              nEmp = #labtraba#0;
                              nTra = #labtraba#1;
                              nMes = #0#8;
                              nAny = #0#9;
                              ||HAZ calboniFomEmp; || bonif comento contratacion indefinida RDL 5/2006
                         |SINO;
                              |HAZ calboni2;  || calcula cuotas aprendices R.D.-Ley 18/93
                         |FINSI;
                         |HAZ calboni3;      || cuotas acumuladas
                    |SINO;
                         stop = liq_aju;  || corta el bucle
                    |FINSI;
                    liq_aju = liq_aju ! EURODB;
               |SIGUE;
               || una vez que he salido de todo lo relacionado con el ajuste
               || vuelvo a poner la acum_10 que me hace falta para bases de
               || cotizacion, que es la que puede haber cambiado
               |SI swFuncRecorte = 1; |Y nNuevaAcum10 > 0;
                    acum_10 = nNuevaAcum10;
               |FINSI;
               graba04 = concepto;
               graba05 = #10#3;
               graba06 = #10#4;
               graba07 = #10#5;
               graba08 = #10#6;
               |HAZ Elgraba07;
               graba09 = 1;
               graba10 = difere;   || diferencia acumulada en el bucle
               graba11 = 1;
               swgracon = 1;   || para que regrabe si existe
               swcongra = 1;   || para que acumule si existe
               |HAZ grabacon;
               |SI difere < 0;  |Y runnom ! "nomcalfi";
                    nIncid = 5;
                    |HAZ graba_inc;
                    nIncid = 6;
                    |SI #2#213 ] 101; aAlfa = #2#213; |SINO; aAlfa = #10#2; |FINSI;
                    aDesIncid = "  *** Concepto: " + aAlfa + ". CIF Empresa: " + #labempre#10 + "***";
                    |HAZ graba_inc;
               |FINSI;
          |FINSI;
          nEstoyEnAjuste = 0;
     |FINSI;
|FPRC;

|PROCESO calajus5;  || AJUSTA A BRUTOS Y LIQUIDOS (sin cotizar y sin IRPF -411-)
     |SI #2#97 ] 5;
          concepto = 411;
          nAjuste = #2#98;
          |HAZ ajustes;
          |SI convenio = 0;
               stop = nAjuste * dcofi_999;   stop = stop ! EURODB;
               |HAZ inclusoIT;
               |SI #2#246 = "S";
                    stop = stop + especie; || VER PARCHE DEL PROCESO calajust
               |FINSI;
               |SI #2#97 = 5;
                    ajus_1 = stop - bruto_aju;
               |SINO;
                    ajus_1 = stop - liq_aju;
               |FINSI;
               |SI ajus_1 > 0;|O #2#61 = "S";
                    graba04 = concepto;
                    graba05 = #10#3;
                    graba06 = #10#4;
                    graba07 = #10#5;
                    graba08 = #10#6;
                    |HAZ Elgraba07;
                    graba09 = 1;
                    graba10 = ajus_1;
                    graba11 = 1;
                    swgracon = 1;  || para que regrabe si existe
                    swcongra = 1;  || para que acumule si existe
                    |HAZ grabacon;
                    |SI #10#8 ! 0;
                         acum_41 = acum_41 + ajus_1;     || actualiza acumulado
                    |SINO;
                         acum_60 = acum_60 + ajus_1;
                    |FINSI;
                    bruto_aju = bruto_aju + ajus_1;
                    bruto_rec = bruto_rec + ajus_1; || actualiza bruto recibo
                    |SI #2#97 = 6;
                         liquido = liquido + ajus_1; || actualiza liquido recibo
                         liq_aju = liq_aju + ajus_1;
                    |FINSI;
                    |SI ajus_1 < 0; |Y runnom ! "nomcalfi";
                         nIncid = 5;
                         |HAZ graba_inc;
                         nIncid = 6;
                         |SI #2#213 ] 101; aAlfa = #2#213; |SINO; aAlfa = #10#2; |FINSI;
                         aDesIncid = "  *** Concepto: " + aAlfa + ". CIF Empresa: " + #labempre#10 + "***";
                         |HAZ graba_inc;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO calssemp;    || CALCULA S.S. A CGO. EMPRESA (18/93 y resto)
    |SI sw_mater = 1; |Y #labtraba#42 ! "H";
          |SI swAjuste3 ! 0; |Y #labtraba#247 ! 138;
               |SI nBaseIT2 ! 0;
                    coba_4 = coba_4 - (swAjuste3 * nBaseIT2);
                    cobb_4 = cobb_4 - (swAjuste3 * nBaseIT2);
               |SINO;
                    coba_4 = coba_4 - (swAjuste3 * prom_enf);
                    cobb_4 = cobb_4 - (swAjuste3 * prom_acc);
               |FINSI;
          |FINSI;
          base_6 = base_6 + coba_4;
          base_7 = base_7 + cobb_4 + nDifDiarioFeb;
     |FINSI;
     base_6 = base_6 + coba_5; base_7 = base_7 + cobb_5; || alta s/ret
     base_10 = dries_2 * prom_enf;
     base_11 = dcont_2 * prom_enf;
     |SI swITEmp = 1;
          base_11 = base_11 + coba_4;
     |FINSI;
     |SI nDesem ! 0; |Y #labtraba#42 ! "H";
          base_5 = base_5 + nDesem;
          bon_5 = bon_5 + nDesem;
          base_6 = base_6 + nDesem;
          base_7 = base_7 + nDesem;
     |FINSI;

     base_5 = base_5 ! EURODB;
     base_6 = base_6 ! EURODB;
     base_7 = base_7 ! EURODB;
     base_A = 0;   base_B = 0;   base_C = 0;   base_F = 0;
     base_D = 0;   base_E = 0;   base_G = 0;   base_M = 0; base_N = 0
     base_AB = 0;  base_MN = 0;
     zbase_A = 0;  zbase_B = 0;  zbase_C = 0;  zbase_F = 0;
     zbase_M = 0;  zbase_N = 0;
     zbase_AB = 0; zbase_MN = 0;
     base_8 = ((dacum_30 % por2_hor1) ! 2) + ((dacum_31 % por2_hor2) ! 2); || h.ext.
     |SI #2#39 ! 0; |Y dboni_1 ! 0; |Y #16#11 = "S";
          base_D = horasex * #16#12;      || cuota (2) bonif. horas formacion
     |FINSI;
     nCuotaEmpCC = 0; nCuotaEmpDes = 0; nCuotaEmpFog = 0; nCuotaEmpFP = 0;
     |SI es_aprendi = 0;
          base_G = (base_6 % (por1_cont + por2_cont) ) ! EURODB;
          base_G = (base_G % #15#75) ! EURODB;
          |SI base_6p_com = 0; || cc
               nBaseEmpTra = base_6 - (coba_4 + coba_5 + nDesem);
               nBaseEmp = coba_4 + coba_5 + nDesem;
               || cuota cc emp+tra
               nCuotaEmpCC = (nBaseEmpTra % (por1_cont + por2_cont) ! 2) - ((nBaseEmpTra % por1_cont) ! 2);
               || cuota cc emp
               nCuotaEmpCC = nCuotaEmpCC + ((nBaseEmp % por2_cont) ! 2); || cc
               base_8 = base_8 + nCuotaEmpCC;
          |SINO;
               |HAZ CotizPluriCC;
          |FINSI;
          |SI notaria > 0;
               nNume1 = (base_6 % (por1_cont + por2_cont));
               nNume1 = nNume1 % notaria;
               base_8 = base_8 - nNume1;          || ded.notarias
          |FINSI;
          |SI nRecAy > 0;
               base_8 = base_8 + (base_6 % nRecAy); || cc
          |FINSI;
          |SI base_7p_des = 0; |Y base_7p_fog = 0; |Y base_7p_fp = 0;  || ccc
                nBaseEmpTra = base_7 - (cobb_4 + cobb_5 + nDesem);
                nBaseEmp = cobb_4 + cobb_5 + nDesem;

                nCuotaEmpTra = (nBaseEmpTra % (por1_des + por2_des)) ! 2; || total
                nCuotaEmpTra = nCuotaEmpTra - ((nBaseEmpTra % por1_des) ! 2); || total
                nCuotaEmp = (nBaseEmp % por2_des) ! 2;
                nCuotaEmpDes = nCuotaEmpTra + nCuotaEmp;
                base_8 = base_8 + nCuotaEmpDes;

                nCuotaEmpTra = (nBaseEmpTra % (por1_fp + por2_fp)) ! 2; || total
                nCuotaEmpTra = nCuotaEmpTra - ((nBaseEmpTra % por1_fp) ! 2); || total
                nCuotaEmp = (nBaseEmp % por2_fp) ! 2;
                nCuotaEmpFP = nCuotaEmpTra + nCuotaEmp;
                base_8 = base_8 + nCuotaEmpFP;

                nCuotaEmpFog = (base_7 % por2_fog) ! 2;
                base_8 = base_8 + nCuotaEmpFog;
          |SINO;
               |HAZ CotizPluriCP;
          |FINSI;
          base_8 = base_8 + ((nCuotaEmpCC % nEl36) ! 2);
          |SI #labtraba#42 = "L"; |Y #nomcontr#72 = "N";     base_5 = guarda_l;  |FINSI;
          base_9 = ((base_7 - base_5) % epig_ilt) ! 2;      || epig.normal
          base_9 = base_9 + (((base_7 - base_5) % epig_ims) ! 2);      || epig.normal
          base_9 = base_9 + ((base_5 % epig_ilt) ! 2);      || epig.normal
          base_9 = base_9 + ((base_5 % epig_ims) ! 2);      || epig.normal
          base_9 = base_9 ! EURODB;
          |SI #labtraba#42 = "L"; |Y #nomcontr#72 = "N";     base_5 = 0;         |FINSI;
          bon_0 = bon_0 ! 2;
          bon_3 = bon_3 ! 2;
          bon_5 = bon_5 ! 2;
          zbon_0 = zbon_0 ! 2;
          zbon_3 = zbon_3 ! 2;
          zbon_5 = zbon_5 ! 2;
          |SI #2#39 ! 0; |Y dboni_1 ! 0; |Y nPorBon1 ! 0;
               base_A = (((bon_0 % #16#4) ! 2) % nPorBon1) ! 2; || cuota bonif. linea 1
               |SI bon_0 = base_6;       || solo si toda la base es bonificada
               |Y #16#4 = por2_cont;
                    base_A = (nCuotaEmpCC % nPorBon1) ! 2; || cuota cc
               |FINSI;
               base_B = ((bon_3 % #16#5) % nPorBon1) ! 2; || cuota bonif. linea 2
               |SI #16#5 = por2_dfpg;   || bonifico todo CP, redondeo asi
               |Y bon_0 = base_7;       || solo si toda la base es bonificada
                                        || sino estoy bonificando mas de la cuenta
                                        || 3079.383
                    nNume1 = (nCuotaEmpDes % nPorBon1) ! 2; || cuota des
                    nNume2 = (nCuotaEmpFP % nPorBon1) ! 2; || cuota fp
                    nNume3 = (nCuotaEmpFog % nPorBon1) ! 2; || cuota fog
                    base_B = nNume1 + nNume2 + nNume3;
               |FINSI;
               |HAZ LimiteBonif;
               base_AB = (base_A + base_B) ! EURODB; || redondea juntas para q no haya problemas
               base_M = (((bon_0 % #16#6) ! 2) % nPorBon1) ! 2; || cuota bonif. linea 1
               base_N = (((bon_3 % #16#7) ! 2) % nPorBon1) ! 2; || cuota bonif. linea 2
               base_MN = (base_M + base_N) ! EURODB; || redondea juntas para q no haya problemas
               |SI #16#08 = "S";
                    zbase_9 = ((bon_3 - bon_5) % epig_ilt) ! 2;
                    zbase_9 = zbase_9 + (((bon_3 - bon_5) % epig_ims) ! 2);
                    zbase_9 = zbase_9 + ((bon_5 % epig_ilt) ! 2);
                    zbase_9 = zbase_9 + ((bon_5 % epig_ims) ! 2);
                    zbase_9 = zbase_9 ! EURODB;
                    base_C = zbase_9 % nPorBon1;      || cuota bonificada accidentes
                    base_C = base_C ! EURODB;
               |FINSI;
          |FINSI;
          |SI #2#39 ! 0; |Y dboni_2 ! 0; |Y nPorBon2 ! 0;
               zbase_A = (zbon_0 % #16#4) % nPorBon2; || cuota bonif. linea 1
               zbase_B = (zbon_3 % #16#5) % nPorBon2; || cuota bonif. linea 2
               zbase_AB = (zbase_A + zbase_B) ! EURODB;   || redondea juntas para q no haya problemas
               zbase_M = (zbon_0 % #16#6) % nPorBon1; || cuota bonif. linea 1
               zbase_N = (zbon_3 % #16#7) % nPorBon1; || cuota bonif. linea 2
               zbase_MN = (zbase_M + zbase_N) ! EURODB; || redondea juntas para q no haya problemas
               |SI #16#08 = "S";
                    || ANTES: nomcal_5: NOMINAS ANTERIORES A 2009 (3)
                    zbase_9 = ((zbon_3 - zbon_5) % epig_ilt) ! 2;
                    zbase_9 = zbase_9 + (((zbon_3 - zbon_5) % epig_ims) ! 2);
                    zbase_9 = zbase_9 + ((zbon_5 % epig_ilt) ! 2);
                    zbase_9 = zbase_9 + ((zbon_5 % epig_ims) ! 2);
                    zbase_9 = zbase_9 ! EURODB;
                    zbase_C = zbase_9 % nPorBon2;     || cuota bonificada accidentes
                    zbase_C = zbase_C ! EURODB;
               |FINSI;
          |FINSI;
          |SI #2#39 = 501; |O #2#39 = 502;
               |HAZ calboni_taripla;
          |FINSI;
          |SI #2#39 = 505; |O #2#39 = 506; |O #2#39 = 507; |O #2#39 = 508;
               |HAZ calboni_500;
          |FINSI;
          base_E = base_8+base_9+dto_sol_emp-(base_AB+base_C+zbase_AB+zbase_C+base_D+base_G+nBonifTut); ||SS emp.
          |SI nBonifFCI1 > 0; |O nBonifFCI2 > 0;
||O nBonifTex1 > 0; |O nBonifTex2 > 0;
               || base_E = base_E - nBonifFCI1 - nBonifFCI2 - nBonifTex1 - nBonifTex2;
               base_E = base_E - nBonifFCI1 - nBonifFCI2;
               |SI base_E < 0;
                    nume2 = base_E;
                    base_E = 0;
                    /*
                    |SI nBonifTex1 > 0;
                         nBonifTex1 = nBonifTex1 + nume2;
                         |SI nBonifTex1 < 0;
                              nume2 = nBonifTex1;
                              nBonifTex1 = 0;
                         |SINO;
                              nume2 = 0;
                         |FINSI;
                    |FINSI;
                    */
                    |SI nBonifFCI2 > 0; |Y nume2 ! 0;
                         nBonifFCI2 = nBonifFCI2 + nume2;
                         |SI nBonifFCI2 < 0;
                              nume2 = nBonifFCI2;
                              nBonifFCI2 = 0;
                         |SINO;
                              nume2 = 0;
                         |FINSI;
                    |FINSI;
                    |SI nBonifFCI1 > 0; |Y nume2 ! 0;
                         nBonifFCI1 = nBonifFCI1 + nume2;
                         |SI nBonifFCI1 < 0;
                              nume2 = nBonifFCI1;
                              nBonifFCI1 = 0;
                         |SINO;
                              nume2 = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nBonifERE > 0;
               base_E = base_E - nBonifERE;
               |SI base_E < 0;
                    nBonifERE = nBonifERE + base_E;
                    base_E = 0;
               |FINSI;
          |FINSI;
          |HAZ ss_ayunt;
          |HAZ AytoFuncNueExcl;
     |SINO;
          |SI #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
               base_E = #nomconst#82 + #nomconst#84 + #nomconst#86 + #nomconst#87;
               |SI #2#45 = "422";
                    base_E = #nomconst#82 + #nomconst#86 + #nomconst#87;
               |SINO;
                    |SI #labtraba#190 = "S";
                         base_E = base_E + #nomconst#90;
                    |FINSI;
               |FINSI;
               base_E = base_E - nBonifFormEmp;
               |SI nBonifERE > 0;
                    base_E = base_E - nBonifERE;
               |FINSI;
               |SI nBonifFormTra ! 0;
                    dto_con = 0;
                    dto_dfp = 0;
                    dto_des = 0;
               |FINSI;
               |SI #nombonif#3 ! 0; |Y #nombonif#3 ! 100;
                    base_AB = (#nomconst#82 + #nomconst#84 + #nomconst#90 + #nomconst#86 + #nomconst#87);
                    base_AB = base_AB % #nombonif#3;
                    base_E = base_E - base_AB;
               |FINSI;
               swForm = 2;
               |HAZ BuscaOtroForm;
               swOtroAlta = 1;
               |HAZ BuscaOtroAlta;
               swOtroAlta = 0;
               |SI nCuantos > 1; |Y dto_con = 0; |Y dto_dfp = 0; |Y dto_des = 0;
                    nBonifFormEmp = 0;
                    nBonifFormTra = 0;
               |FINSI;
          |FINSI;
          base_E = base_E + base_8 - base_D - nBonifTut;   || mas las horas extras, si hubieran
     |FINSI;
     |SI base_E < 0; |Y base_D = 0; |Y nBonifTut = 0; base_E = 0; |FINSI;
                                           || menos la subvencion horas
     |SI nBonifJuv > 0;
          base_E = base_E - nBonifJuv;
     |FINSI;
     base_F = base_AB + base_C + base_MN;         || cuota (1) bonif.
     zbase_F = zbase_AB + zbase_C + zbase_MN;     || cuota (2) bonif.
     |SI sw_mater = 1; |Y #labtraba#42 ! "H";
          base_6 = (base_6 ! EURODB) - (coba_4 ! EURODB);
          base_7 = (base_7 ! EURODB) - (cobb_4 ! EURODB) - nDifDiarioFeb;
     |FINSI;
     |SI nDesem ! 0; |Y #labtraba#42 ! "H";
          base_5 = base_5 - nDesem;
          base_6 = base_6 - nDesem;
          base_7 = base_7 - nDesem;
     |FINSI;
     base_6 = base_6 - coba_5; base_7 = base_7 - cobb_5; || alta s/ret
|FPRC;

|PROCESO ajustes;
     |SI concepto ! 121;
          |HAZ convenio;
     |SINO;
          convenio = 0;
     |FINSI;
     |SI convenio = 0;
          dcofi_999 = 1;
          |SI #10#4 = 1; dcofi_999 = dcofi_1;  |FINSI;
          |SI #10#4 = 1; |Y #labtraba#42 = "D"; |Y #labtraba#64 = "M";
          |Y dilt = 0;
               || me completo en alta, ajuste en D-M, dcofi_1 no me vale 3725.1630
               dcofi_999 = dcofi_2;
          |FINSI;
          |SI #10#4 = 2;  dcofi_999 = dcofi_2;  |FINSI;
     |SINO;
          alfa1 = "    Ajustes: concepto [" + concepto + "] no definido en convenio ...";
          |MENAV alfa1;
     |FINSI;
     |SI #2#207 = "D";
          |SI #labtraba#42 = "D";|O #labtraba#42 = "T";
               mesnum = #0#8;
               |HAZ ulti_dia;
               nAjuste = nAjuste * topemes;
          |SINO;
               nAjuste = nAjuste * 30;
          |FINSI;
     |FINSI;
|FPRC;
