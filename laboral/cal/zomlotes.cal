|FICHEROS;
     zomlotes #0;
     labtraba;
     nomhicca;
     nomcaldl;
     silcon02;
     silcon03;
|FIN;

|VARIABLES;
     swCambiado = 0;
     aSegmento = "";
     aSegmento1 = "";
     aSegmento2 = "";
     nDias = 0;
     nDiasEnf0 = 0;
     nDiasEnf1 = 0;
     nDiasEnf2 = 0;
     nDiasAcc0 = 0;
     nDiasAcc1 = 0;
     nDiasAcc2 = 0;
     nDiasMat0 = 0;
     nDiasMat1 = 0;
     nDiasMat2 = 0;
     nDiasRie0 = 0;
     nDiasRie1 = 0;
     nDiasRie2 = 0;
     nDiasPat0 = 0;
     nDiasPat1 = 0;
     nDiasPat2 = 0;
     nDiasCon0 = 0;
     nDiasCon1 = 0;
     nDiasCon2 = 0;

     nHorasEnf0 = 0;
     nHorasEnf1 = 0;
     nHorasEnf2 = 0;
     nHorasAcc0 = 0;
     nHorasAcc1 = 0;
     nHorasAcc2 = 0;
     nHorasMat0 = 0;
     nHorasMat1 = 0;
     nHorasMat2 = 0;
     nHorasRie0 = 0;
     nHorasRie1 = 0;
     nHorasRie2 = 0;
     nHorasPat0 = 0;
     nHorasPat1 = 0;
     nHorasPat2 = 0;
     nHorasCon0 = 0;
     nHorasCon1 = 0;
     nHorasCon2 = 0;

     nBase = 0;
     nPeriodo = 0;
     aTipoLiq = "";
     nDiasEnf = 0;
     nDiasAcc = 0;
     nDiasMat = 0;
     nDiasCon = 0;
     nDiasRie = 0;
     nDiasPat = 0;
     aFechaAlta = "";
     aFechaBaja = "";
     fFechaAlta = @;
     fFechaBaja = @;
     aPeriodoLote = "";
     fPeriodoLote = @;
     aPeriodo = "";
     aNif = "";
     aDias = "";
     nLinea = 0;
     nLineas = 0;
     aLinea = "";
     aLineas = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nNume = 0;
     nCambiados = 0;
     swCorrecto = 0;
     aTP = "";
     nDiasMenos2 = 0;
     aExt = "";
|FIN;

|PROCESO cerodias;
     nDias = 0;
     nDiasEnf0 = 0;
     nDiasEnf1 = 0;
     nDiasEnf2 = 0;
     nDiasAcc0 = 0;
     nDiasAcc1 = 0;
     nDiasAcc2 = 0;
     nDiasMat0 = 0;
     nDiasMat1 = 0;
     nDiasMat2 = 0;
     nDiasRie0 = 0;
     nDiasRie1 = 0;
     nDiasRie2 = 0;
     nDiasPat0 = 0;
     nDiasPat1 = 0;
     nDiasPat2 = 0;
     nDiasCon0 = 0;
     nDiasCon1 = 0;
     nDiasCon2 = 0;
     nDiasEnf = 0;
     nDiasAcc = 0;
     nDiasMat = 0;
     nDiasCon = 0;
     nDiasRie = 0;
     nDiasPat = 0;

     nHorasEnf0 = 0;
     nHorasEnf1 = 0;
     nHorasEnf2 = 0;
     nHorasAcc0 = 0;
     nHorasAcc1 = 0;
     nHorasAcc2 = 0;
     nHorasMat0 = 0;
     nHorasMat1 = 0;
     nHorasMat2 = 0;
     nHorasRie0 = 0;
     nHorasRie1 = 0;
     nHorasRie2 = 0;
     nHorasPat0 = 0;
     nHorasPat1 = 0;
     nHorasPat2 = 0;
     nHorasCon0 = 0;
     nHorasCon1 = 0;
     nHorasCon2 = 0;
|FPRC;

|PROCESO CambiaD;
     aAlfa = aSegmento % 0801;
     |SI aAlfa = "I"; |O aAlfa = "D";
          swCorrecto = 1;
          |ACABA;
     |FINSI;

     aSegmento1 = aSegmento % 0107;
     aSegmento2 = aSegmento % 0953;
     aSegmento = aSegmento1 + "D" + aSegmento2;
     #silcon03#4 = aSegmento;
     |GRABA 020#silcon03.a;
     |LIBERA #silcon03;
     swCambiado = 1;
     nCambiados = nCambiados + 1;
|FPRC;

|PROCESO CambiaI;
     aAlfa = aSegmento % 0801;
     |SI aAlfa = "I"; |O aAlfa = "D";
          swCorrecto = 1;
          |ACABA;
     |FINSI;

     aSegmento1 = aSegmento % 0107;
     aSegmento2 = aSegmento % 0953;
     aSegmento = aSegmento1 + "I" + aSegmento2;
     #silcon03#4 = aSegmento;
     |GRABA 020#silcon03.a;
     |LIBERA #silcon03;
     swCambiado = 1;
     nCambiados = nCambiados + 1;
|FPRC;

|PROCESO ComparaDias;
     swCambiado = 0;

     || enfermedad
     |SI nDias = nDiasEnf0;
||O nDiasEnf = nDiasEnf0;
     |O nDias = nHorasEnf0;
     |O nDiasMenos2 = nDiasEnf0;
          |SI swCambiado = 0; |Y nDiasEnf > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasEnf1;
||O nDiasEnf = nDiasEnf1;
     |O nDias = nHorasEnf1;
     |O nDiasMenos2 = nDiasEnf1;
          |SI swCambiado = 0; |Y nDiasEnf > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasEnf2;
||O nDiasEnf = nDiasEnf2;
     |O nDias = nHorasEnf2;
     |O nDiasMenos2 = nDiasEnf2;
          |SI swCambiado = 0; |Y nDiasEnf > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;

     || accidente
     |SI nDias = nDiasAcc0;
||O nDiasAcc = nDiasAcc0;
     |O nDias = nHorasAcc0;
     |O nDiasMenos2 = nDiasAcc0;
          |SI swCambiado = 0; |Y nDiasAcc > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasAcc1;
||O nDiasAcc = nDiasAcc1;
     |O nDias = nHorasAcc1;
     |O nDiasMenos2 = nDiasAcc1;
          |SI swCambiado = 0; |Y nDiasAcc > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasAcc2;
||O nDiasAcc = nDiasAcc2;
     |O nDias = nHorasAcc2;
     |O nDiasMenos2 = nDiasAcc2;
          |SI swCambiado = 0; |Y nDiasAcc > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;

     || control IT
     |SI nDias = nDiasCon0;
||O nDiasCon = nDiasCon0;
     |O nDias = nHorasCon0;
     |O nDiasMenos2 = nDiasCon0;
          |SI swCambiado = 0; |Y nDiasCon > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasCon1;
||O nDiasCon = nDiasCon1;
     |O nDias = nHorasCon1;
     |O nDiasMenos2 = nDiasCon1;
          |SI swCambiado = 0; |Y nDiasCon > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasCon2;
||O nDiasCon = nDiasCon2;
     |O nDias = nHorasCon2;
     |O nDiasMenos2 = nDiasCon2;
          |SI swCambiado = 0; |Y nDiasCon > 0;
               |HAZ CambiaI;
          |FINSI;
     |FINSI;

     || Maternidad
     |SI nDias = nDiasMat0;
||O nDiasMat = nDiasMat0;
     |O nDias = nHorasMat0;
     |O nDiasMenos2 = nDiasMat0;
          |SI swCambiado = 0; |Y nDiasMat > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasMat1;
||O nDiasMat = nDiasMat1;
     |O nDias = nHorasMat1;
     |O nDiasMenos2 = nDiasMat1;
          |SI swCambiado = 0; |Y nDiasMat > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasMat2;
||O nDiasMat = nDiasMat2;
     |O nDias = nHorasMat2;
     |O nDiasMenos2 = nDiasMat2;
          |SI swCambiado = 0; |Y nDiasMat > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;

     || Paternidad
     |SI nDias = nDiasPat0;
||O nDiasPat = nDiasPat0;
     |O nDias = nHorasPat0;
     |O nDiasMenos2 = nDiasPat0;
          |SI swCambiado = 0; |Y nDiasPat > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasPat1;
||O nDiasPat = nDiasPat1;
     |O nDias = nHorasPat1;
     |O nDiasMenos2 = nDiasPat1;
          |SI swCambiado = 0; |Y nDiasPat > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasPat2;
||O nDiasPat = nDiasPat2;
     |O nDias = nHorasPat2;
     |O nDiasMenos2 = nDiasPat2;
          |SI swCambiado = 0; |Y nDiasPat > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;

     || Riesgo
     |SI nDias = nDiasRie0;
||O nDiasRie = nDiasRie0;
     |O nDias = nHorasRie0;
     |O nDiasMenos2 = nDiasRie0;
          |SI swCambiado = 0; |Y nDiasRie > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasRie1;
||O nDiasRie = nDiasRie1;
     |O nDias = nHorasRie1;
     |O nDiasMenos2 = nDiasRie1;
          |SI swCambiado = 0; |Y nDiasRie > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
     |SI nDias = nDiasRie2;
||O nDiasRie = nDiasRie2;
     |O nDias = nHorasRie2;
     |O nDiasMenos2 = nDiasRie2;
          |SI swCambiado = 0; |Y nDiasRie > 0;
               |HAZ CambiaD;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO nomcaldl;
     #nomcaldl#0 = #nomhicca#0;
     #nomcaldl#1 = #nomhicca#1;
     #nomcaldl#2 = #nomhicca#66 + 2000;
     #nomcaldl#3 = #nomhicca#2;
     #nomcaldl#4 = #nomhicca#3;
     #nomcaldl#5 = nBase;
     |LEE 000#nomcaldl.=;

     |SI FSalida = 0;
          || ENFERMEDAD
          |SI nBase = 021000;
               nDiasEnf0 = #nomcaldl#8;
               nHorasEnf0 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 121000;
               nDiasEnf1 = #nomcaldl#8;
               nHorasEnf1 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 221000;
               nDiasEnf2 = #nomcaldl#8;
               nHorasEnf2 = #nomcaldl#9;
          |FINSI;

          || ACCIDENTE
          |SI nBase = 031000;
               nDiasAcc0 = #nomcaldl#8;
               nHorasAcc0 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 131000;
               nDiasAcc1 = #nomcaldl#8;
               nHorasAcc1 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 231000;
               nDiasAcc2 = #nomcaldl#8;
               nHorasAcc2 = #nomcaldl#9;
          |FINSI;

          || IT CONTROL SEGURIDAD SOCIAL
          |SI nBase = 091000;
               nDiasCon0 = #nomcaldl#8;
               nHorasCon0 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 191000;
               nDiasCon1 = #nomcaldl#8;
               nHorasCon1 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 291000;
               nDiasCon2 = #nomcaldl#8;
               nHorasCon2 = #nomcaldl#9;
          |FINSI;

          || MATERNIDAD
          |SI nBase = 041000;
               nDiasMat0 = #nomcaldl#8;
               nHorasMat0 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 141000;
               nDiasMat1 = #nomcaldl#8;
               nHorasMat1 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 241000;
               nDiasMat2 = #nomcaldl#8;
               nHorasMat2 = #nomcaldl#9;
          |FINSI;

          || PATERNIDAD
          |SI nBase = 051000;
               nDiasPat0 = #nomcaldl#8;
               nHorasPat0 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 151000;
               nDiasPat1 = #nomcaldl#8;
               nHorasPat1 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 251000;
               nDiasPat2 = #nomcaldl#8;
               nHorasPat2 = #nomcaldl#9;
          |FINSI;

          || RIESGO
          |SI nBase = 061000;
               nDiasRie0 = #nomcaldl#8;
               nHorasRie0 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 161000;
               nDiasRie1 = #nomcaldl#8;
               nHorasRie1 = #nomcaldl#9;
          |FINSI;
          |SI nBase = 261000;
               nDiasRie2 = #nomcaldl#8;
               nHorasRie2 = #nomcaldl#9;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nomhicca;
     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = 10;
     #nomhicca#2 = nPeriodo;
     |SI aTipoLiq = "L00";
          #nomhicca#3 = 0;
     |FINSI;
     |SI aTipoLiq = "L03";
          #nomhicca#3 = 5;
     |FINSI;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          || ENFERMEDAD
          |SI #nomhicca#31 ! 0;
               nDiasEnf = #nomhicca#31;
               nBase = 21000;
               |HAZ nomcaldl;
               nBase = 121000;
               |HAZ nomcaldl;
               nBase = 221000;
               |HAZ nomcaldl;
          |FINSI;

          || ACCIDENTE
          |SI #nomhicca#32 ! 0;
               nDiasAcc = #nomhicca#32;
               nBase = 31000;
               |HAZ nomcaldl;
               nBase = 131000;
               |HAZ nomcaldl;
               nBase = 231000;
               |HAZ nomcaldl;
          |FINSI;

          || MATERNIDAD
          |SI #nomhicca#65 ! 0;
               nDiasMat = #nomhicca#65;
               nBase = 041000;
               |HAZ nomcaldl;
               nBase = 141000;
               |HAZ nomcaldl;
               nBase = 241000;
               |HAZ nomcaldl;
          |FINSI;

          || PATERNIDAD
          |SI #nomhicca#181 ! 0;
               nDiasPat = #nomhicca#181;
               nBase = 051000;
               |HAZ nomcaldl;
               nBase = 151000;
               |HAZ nomcaldl;
               nBase = 251000;
               |HAZ nomcaldl;
          |FINSI;

          || RIESGO
          |SI #nomhicca#171 ! 0;
               nDiasRie = #nomhicca#171;
               nBase = 061000;
               |HAZ nomcaldl;
               nBase = 161000;
               |HAZ nomcaldl;
               nBase = 261000;
               |HAZ nomcaldl;
          |FINSI;

          || IT CONTROL SEGURIDAD SOCIAL
          |SI #nomhicca#173 ! 0;
               nDiasCon = #nomhicca#173;
               nBase = 21000;
               |HAZ nomcaldl;
               nBase = 121000;
               |HAZ nomcaldl;
               nBase = 221000;
               |HAZ nomcaldl;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO labtraba;
     aFechaAlta = #labtraba#36;
     aFechaBaja = #labtraba#37;
     |QBF aFechaBaja;
     |SI aFechaBaja = ""; |O aFechaBaja = "..........";
          aFechaBaja = "31.12.2010";
     |FINSI;
     fFechaAlta = aFechaAlta;
     fFechaBaja = aFechaBaja;
     |SI fFechaAlta [ fPeriodoLote; |Y fPeriodoLote [ fFechaBaja;
          |HAZ nomhicca;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#2;
     ;
     aNif;
     aNif;
     ;
     NULL, labtraba;
|FIN;

|PROCESO silcon03;
          nLinea = #silcon03#1;
          aLinea = nLinea;
          aLineas = nLineas;
          aAlfa = "Examinando linea " + aLinea + " de " + aLineas;
          |PINTA 1726, aAlfa;

          |SI #silcon03#3 = "EMP";
               aSegmento = #silcon03#4;
               aPeriodo = aSegmento % 5502;
               nPeriodo = aPeriodo;
               aPeriodoLote = "01." + aPeriodo + ".2010";
               fPeriodoLote = aPeriodoLote;
               aTipoLiq = aSegmento % 5903;
          |FINSI;
          |SI #silcon03#3 = "TRA";
               |HAZ cerodias;
               aSegmento = #silcon03#4;
               aNif = aSegmento % 1714;
               aExt = aNif % 0501;
               |SI aExt = "0";
                    aNif = aNif % 0609;
               |SINO;
                    aNif = aNif % 0510;
               |FINSI;
               |BUCLE labtraba;
          |FINSI;
          |SI #silcon03#3 = "DAT";
               aSegmento = #silcon03#4;
               aDias = aSegmento % 1303;
               nDias = aDias;
               nDiasMenos2 = nDias - 2;
               aTP = aSegmento % 1601;
               |HAZ ComparaDias;
               |SI swCorrecto = 1;
                    |ERROR10;
               |FINSI;
          |FINSI;
|FPRC;

|DEFBUCLE silcon03;
     #silcon03#1;
     ;
     #silcon02#0, 00001;
     #silcon02#0, 99999;
     ;
     NULL, silcon03;
|FIN;

|PROCESO silcon02;
     #silcon03#0 = #silcon02#0;
     #silcon03#1 = 99999;
     |LEE 000#silcon03.];
     |LEE 000#silcon03.a;
     nLineas = #silcon03#1;
     nCambiados = 0;
     swCorrecto = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     |BUCLE silcon03;
     |SI swCorrecto = 1;
          nNume = #silcon03#0;
          aAlfa = nNume;
          aAlfa = "    El lote " + aAlfa + " no necesita ser revisado.";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     nNume = #silcon03#0;
     aAlfa1 = nNume;
     aAlfa2 = nCambiados;
     aAlfa = "    Lote: " + aAlfa1 + ". Cambiadas " + aAlfa2 + " lineas.";
     |MENAV aAlfa;
|FPRC;

|DEFBUCLE silcon02;
     #silcon02#1;
     ;
     #0#0;
     #0#1;
     ;
     NULL, silcon02;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #labtraba;
          |ABRE #nomhicca;
          |ABRE #silcon02;
          |ABRE #silcon03;
          |ABRE #nomcaldl;
          |BUCLE silcon02;
          |CIERRA #nomcaldl;
          |CIERRA #silcon03;
          |CIERRA #silcon02;
          |CIERRA #nomhicca;
          |CIERRA #labtraba;
     |FINSI;
|FPRO;
