|FICHEROS;
     syke0001 #0;
     syke0002 #100;      || tmp para grabar campos del informe
     labtraba;
     labcentr;
     nomauxi1;
     nomauxi2;
     nomconca;
     nomconli;
     nomcalca;
     nomcalli;
     nomhicca;
     nomhicli;
     nomcontr;
     nomcatli #4;       || aux. categorias lins.
     nomtrali #6;       || aux. trabajadores lins.
     nomvarli #8;       || variaciones trabajadores/mes lins.
     nomfinli;
     nomepigr;
     nomconst;
     nomcalfi;
     labempre;
     syke0014;          ||Prorrateo Area / Seccion de Trabajdores modulo Sykes
     syke0015 #101;

     syke0020;
     syke0021;
     syke0026;
     syke0023 #200;
     syke0027 #201;
     syke0028 #202;

     nomtrato;
|FIN;

|VARIABLES;
     ||Variable para la apertura del Excel
     {1}aVersion      = "";
     aPath = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     nCaracter = 0;
     aCaracter = "";
     nNum = 0;

     nCodCentro = 0;
     aCodArea = "";
     aCodSeccion = "";
     nLinea = 0;
     nLineaAnt = 0;
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";
     nTotalP = 0;
     nTotalQ = 0;
     nTotalS = 0;
     nTotalT = 0;
     nTotalU = 0;
     nTotalV = 0;
     nTotalW = 0;

     aArea = "";         || BUSINESS UNIT
     aCategoria = "";    || DEPARTMENT/Position
     aCentro = "";       || LOCATION
     aSeccion = "";      || CAMPAIGN
     aCodTra = "";       || CODE
     aNomTra = "";       || WORKER
     aFechaAlta = "";    || DATE LAST CONTRACT
     aFechaBaja = "";    || FINISH DATE
     nPorJornada = 0;    || % WORK-TIME
     &nPaga1 = 0;         || 13-EXTRA PAYMENT
     &nPaga2 = 0;         || 14-EXTRA PAYMENT
     &nVacac = 0;         || HOLIDAYS
     &nIndem = 0;         || INDEMNITY
     nTotalLiq = 0;      || LIQUIDATION TOTAL
     &nSSVacac = 0;       || SOC. SEC. HOLIDAYS
     nTotalCoste = 0;    || TOTAL COST
     &nDiasVacac = 0;       || VACACIONES PENDIENTES DE DISFRUTAR

     nHoras = 0;
     nHorasMes = 0;
     aAlfa0 = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     FEstado = 0;
     aFecha = "";
     fFecha = @;
     nNume0 = 0;
     nNume1 = 0;
     nNume2 = 0;
     aDia = "";
     &nMes = 0;
     &aMes = "";
     &nAny = 0;
     aAny = "";

     swUnid = 0;
     nNume = 0;
     nTipoPaga = 0;
     nDesdeMes = 0;
     nHastaMes = 0;
     &nConcepto = 0;
     nUnid = 0;
     swSoyDiferida = 0;
     nPrecio = 0;
     nTotal = 0;
     nCampo = 0;
     nMesPago = 0;

     fecbaj = "";

     bisiesto = 0;
     numer = 0;
     anynum = 0;
     mesnum = 0;
     topemes = 0;
     alfa1 = "";
     fecalf = "";
     dia = 0;
     mes = 0;
     any = 0;
     nume0 = 0;
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     nume5 = 0;
     fech1 = @;
     product = 0;
     fech2 = @;

     fecsis = @;
     fecsys = @;
     aAlfa = "";
     &aFechaFIN = "";
/*
     nPrecioCon = 0;
     aTipoCal = "";
     dacum_vac = 0;
     duni1_903 = 0;
     duni2_903 = 0;
     dvalo_903 = 0;
     vacacio = 0;
*/
     nImporInd = 0;
     concepto = 0;
     aUnid = "";
     nMesesAlta = 0;
     swTengoDerecho = 0;
     nTotInd = 0;
     fFechaAnt = @;
     fFechaAlta = @;
     fFechaBaja = @;
     aDiaAlta = "";
     aMesAlta = "";
     aAnyAlta = "";
     aDiaBaja = "";
     aMesBaja = "";
     aAnyBaja = "";
     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     nDiaBaja = 0;
     nMesBaja = 0;
     nAnyBaja = 0;
     guarda = 0;
     nDiasAlta = 0;
     nPropAlta = 0;
     nNumDias = 0;
     nDiasPago = 0;
     nPorCada = 0;
     nUnidades = 0;
     nFechaAlta = 0;
     nFechaBaja = 0;
     nConceptos = 0;
     nTotBru = 0;
     nIRPF1 = 0;
     duni1_902 = 0;
     duni2_902 = 0;
     dvalo_902 = 0;
     &fCFecha = @;
     &aCError = "";
     &nCConst = 0;
     nTrab = 0;
     aTrab = "";
     nNroTrab = 0;
     aNroTrab = "";

     nConcepto1 = 0;
     nDConcepto = 0;
     nHConcepto = 0;
     nRango = 0;
     nTImporInd = 0;

     nDesdeMesPro = 0;
     nHastaMesPro = 0;
     nCoefi = 0;
     nUnidTotal = 0;
     aFechaIni = "";
     fFechaIni = @;
     swCoef = 0;
     aDesdeAnyPro = "";
     aHastaAnyPro = "";
     nDesdeAnyPro = 0;
     nHastaAnyPro = 0;
     nNume3 = 0;
     nNume4 = 0;
     nNume5 = 0;
     swHay99 = 0;
     swSigue = 0;
     swFiniq = 0;
     aNif = "";

     swDiasAlta = 0;
     nDiasTrab = 0;
     nDiasTotal = 0;
     nMesBusca = 0;
     nMesHastaPro = 0;
     swProrr = 0;
     swVacac = 0;
     nTrabActual = 0;
     nDesdeMesBus = 0;
     nHastaMesBus = 0;
     nUltMesCAS = 0;
     swHaEntrado = 0;
     nUltLinCAS = 0;
     nDesdeLinBus = 0;
     nHastaLinBus = 0;

     nImporte = 0;
     aAccount = "";
     aUnit = "";
     aActivity = "";
     aReference = "";
     &nTopemes = 0;
     nC10 = 0; nC11 = 0; nC12 = 0; nC13 = 0; nC14 = 0; nC15 = 0; nC16 = 0;
     nC23 = 0;
     nTotalLineas2 = 0;
     swAgrupa = 0;
     nTotalLineas = 0;
     xAnterior = 0;
     aResultado = "";
     &runnom = "";
|FIN;

|PROCESO Defectos; |TIPO 7;
     fFecha = ~;
     aFecha = fFecha;

     aMes = aFecha % 402;
     aAny = aFecha % -104;

     nMes = aMes;
     nAny = aAny;

     #0#4 = nAny;
     #0#5 = nMes;

     |PINTA #0#4;
     |PINTA #0#5;

     |HAZ fechaenvio;
|FPRC;

|PROCESO fechaenvio;
     nMes = #0#5;
     nAny = #0#4;
     |HAZ topemes_plb;
     aAlfa = nTopemes; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;

     aAlfa1 = #0#5; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#4;

     aAlfa = aAlfa + "." + aAlfa1 + "." + aAlfa2;
     #0#9 = aAlfa;
     |PINTA #0#9;
|FPRC;

|PROCESO Inicializa;
     aArea = "";         || BUSINESS UNIT
     aCategoria = "";    || DEPARTMENT/Position
     aCentro = "";       || LOCATION
     aSeccion = "";      || CAMPAIGN
     aCodTra = "";       || CODE
     aNomTra = "";       || WORKER
     aFechaAlta = "";    || DATE LAST CONTRACT
     aFechaBaja = "";    || FINISH DATE
     nPorJornada = 0;    || % WORK-TIME
     nPaga1 = 0;         || 13-EXTRA PAYMENT
     nPaga2 = 0;         || 14-EXTRA PAYMENT
     nVacac = 0;         || HOLIDAYS
     nIndem = 0;         || INDEMNITY
     nTotalLiq = 0;      || LIQUIDATION TOTAL
     nSSVacac = 0;       || SOC. SEC. HOLIDAYS
     nTotalCoste = 0;    || TOTAL COST
     nDiasVacac = 0;     || DIAS VACACIONES PENDIENTES

     nHoras = 0;
|FPRC;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
     bisiesto = 0;
     numer = anynum $ 4;
     |SI numer = 0;
          bisiesto = 1;
     |FINSI;
     topemes = 31;
     |SI mesnum= 2;
          topemes = 28 + bisiesto;
     |FINSI;
     |SI mesnum= 4;|O mesnum= 6;|O mesnum= 9;|O mesnum=11;
          topemes = 30;
     |FINSI;
|FPRC;

|PROCESO desglosa;     || DESGLOSA EN DIA, MES Y ANYO UNA FECHA DD.MM.AAAA
     alfa1 = fecalf %  102;   dia = alfa1;
     alfa1 = fecalf %  402;   mes = alfa1;
     alfa1 = fecalf % -104;   any = alfa1;
     |SI alfa1 = "....";
          dia = 0;
          mes = 0;
          any = 0;
     |FINSI;
|FPRC;

|PROCESO dias_alta;
     fecsis = fecbaj;
     fecalf = fecsis;
     |HAZ desglosa;
     nume2 = any;

     aFecha = #labtraba#36;          || por fecha de alta

                      || si la fecha de alta es anterior al
     fech1 = aFecha;               || 1 de Enero del any que se calcula
     alfa1 = #0#4;                 || el finiquito limito fecha de alta
     alfa1 = "01.01." + alfa1;     || al 1 de Enero del any de calculo
     fech2 = alfa1;
     |SI fech1 < fech2;
          fecsys = fech2;
     |SINO;
          fecsys = fech1;
     |FINSI;

     fecalf=fecsys;
     |HAZ desglosa;
     nume1=any;

     nume5 = 0;

     |PARA nume4 = nume1;|SI nume4 [ nume2; |HACIENDO nume4 = nume4 + 1;
          nume3 = nume4 $ 4;
          |SI any  = nume4;|Y mes  > 2;  nume3 = 1;          |FINSI;
          |SI #0#4 = nume4;|Y #0#5 [ 2;  nume3 = 1;          |FINSI;
          |SI nume3 = 0; nume5 = nume5 + 1;  |FINSI;
     |SIGUE;
     nume0 = fecsis - fecsys;
     nume0 = nume0 - nume5 + 1; || menos dias bisiestos + ambos inclusive
|FPRC;

|PROCESO BuscaPagaMes;
     swUnid = 0;
     nNume = 0;
     #nomhicli#0 = #labtraba#0;
     #nomhicli#1 = #labtraba#1;

     |SI nTipoPaga = 1;
          #nomhicli#12 = #0#4 - 2000;
          |SI nMes [ #0#5; || solo acumulo unidades hasta el mes que pido
               swUnid = 1;
          |FINSI;
     |FINSI;

     |SI nTipoPaga = 21;                        || viene del a쨚 pasado
          #nomhicli#12 = #0#4 - 2000 - 1;
          swUnid = 1;
     |FINSI;
     |SI nTipoPaga = 22;                        || lo que llevo de este a쨚
          #nomhicli#12 = #0#4 - 2000;
          |SI nMes [ #0#5;
               swUnid = 1;
          |FINSI;
     |FINSI;

     |SI nDesdeMes [ #0#5; |Y #0#5 [ 12;
          |SI nTipoPaga = 31;
               #nomhicli#12 = #0#4 - 2000;
               |SI nMes [ #0#5;
                    swUnid = 1;
               |SINO;
                    swUnid = 0;
               |FINSI;
          |FINSI;
          |SI nTipoPaga = 32;
               #nomhicli#12 = #0#4 - 2000 + 1;
               swUnid = 0;
          |FINSI;
     |FINSI;
     |SI 1 [ #0#5; |Y #0#5 [ nHastaMes;
          |SI nTipoPaga = 31;
               #nomhicli#12 = #0#4 - 2000 - 1;
               swUnid = 1;
          |FINSI;
          |SI nTipoPaga = 32;
               #nomhicli#12 = #0#4 - 2000;
               |SI nMes [ #0#5;
                    swUnid = 1;
               |SINO;
                    swUnid = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nHastaMes < #0#5; |Y #0#5 < nDesdeMes;
          |SI nTipoPaga = 31;
               #nomhicli#12 = #0#4 - 2000 - 1;
               swUnid = 1;
          |FINSI;
          |SI nTipoPaga = 32;
               #nomhicli#12 = #0#4 - 2000;
               swUnid = 1;
          |FINSI;
     |FINSI;

     #nomhicli#2 = nMes;
     #nomhicli#3 = 0;
     #nomhicli#4 = nConcepto;
     |LEE 000#nomhicli.=;

     |SI FSalida = 0;
          |SI swUnid = 1; || solo acumulo unidades hasta el mes que pido
               nUnid = nUnid + #nomhicli#9;
          |FINSI;
          |SI swSoyDiferida = 1;
               nNume = (#nomhicli#9 * #nomhicli#10);
          |FINSI;
          nPrecio = #nomhicli#10;  || pero el precio lo busco hasta
     |SINO;
          #nomcalli#0 = #labtraba#0;
          #nomcalli#1 = #labtraba#1;
          #nomcalli#2 = nMes;
          #nomcalli#3 = 0;
          #nomcalli#4 = nConcepto;
          |LEE 000#nomcalli.=;

          |SI FSalida = 0;
               |SI swUnid = 1; || solo acumulo unidades hasta el mes que pido
                     nUnid = nUnid + #nomcalli#9;
               |FINSI;
               |SI swSoyDiferida = 1;
                    nNume = (#nomcalli#9 * #nomcalli#10);
               |FINSI;
               nPrecio = #nomcalli#10;  || pero el precio lo busco hasta
          |FINSI;
     |FINSI;
|FPRC;

/****************************************************************************/
/*               CALCULO DE INDEMNIZACIONES SEGUN CONVENIO                  */
/****************************************************************************/

|PROCESO AntiguedadInd;
     #nomcalli#0 = #labtraba#0;
     #nomcalli#1 = #labtraba#1;
     #nomcalli#2 = #0#5;
     #nomcalli#3 = 0;
     #nomcalli#4 = 102;
     |LEE 000#nomcalli.=;
     |SI FSalida = 0;
          |SI #nomcalli#9 = 1;     || unidades = 1, mensual
               nImporInd = nImporInd + (#nomcalli#10 / 30);
          |SINO;
               nImporInd = nImporInd + #nomcalli#10;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaConInd3;
     |ABRE #4;
     #4#0 = #labtraba#87; #4#1 = #labtraba#17; #4#2 = nConcepto1;
     |LEE 000#4=;
     |SI FSalida = 0;
          nImporInd = #4#4;
          aUnid = #4#3;
          |QBT aUnid;
          |SI aUnid = "1";
               nImporInd = #4#4 / 30;
          |SINO;
               nImporInd = #4#4;
          |FINSI;
     |FINSI;
     |CIERRA #4;

     |ABRE #6;
     #6#0 = #labtraba#0;  #6#1 = #labtraba#1;  #6#2 = nConcepto1;
     |LEE 000#6=;
     |SI FSalida = 0;
          nImporInd = #6#4;
          aUnid = #6#3;
          |QBT aUnid;
          |SI aUnid = "1";
               nImporInd = #6#4 / 30;
          |SINO;
               nImporInd = #6#4;
          |FINSI;
     |FINSI;
     |CIERRA #6;

     |ABRE #8;
     #8#0 = #labtraba#0;  #8#1 = #labtraba#1;  #8#2 = #0#5;  #8#3 = 0;  #8#4 = nConcepto1;
     |LEE 000#8=;
     |SI FSalida = 0;
          nImporInd = #8#6 / 30;
          aUnid = #8#5;
          |QBT aUnid;
          |SI aUnid = "1";
               nImporInd = #8#6 / 30;
          |SINO;
               nImporInd = #8#6;
          |FINSI;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Graba022;
     |SI nImporte ! 0;
          |DDEFECTO #200;
          #syke0026#0 = nConcepto;
          |LEE 000#syke0026.=;
          aAccount = #syke0026#2;
          |QBF aAccount;
          |SI aAccount ! "";
               #200#0 = aUnit;
               #200#1 = aActivity;
               #200#2 = aAccount;
               |LEE 101#200=;
               |SI FSalida = 0;
                    #200#3 = #200#3 + nImporte;
                    |GRABA 020#200a;
               |SINO;
                    #200#3 = #200#3 + nImporte;
                    |GRABA 020#200n;
                    nTotalLineas2 = nTotalLineas2 + 1;
               |FINSI;
               |LIBERA #200;

               |DDEFECTO #200;
               swAgrupa = 0;
               aAlfa1 = aAccount % 103;
               aAlfa2 = aAccount % 106;
               |SI aAlfa2 = "640013";
                    swAgrupa = 1;
               |FINSI;
               |SI aAlfa2 = "640014";
                    swAgrupa = 2;
               |FINSI;
               |SI aAlfa2 = "642015"; |O aAlfa2 = "640017";
                    swAgrupa = 3;
               |FINSI;
               |SI aAlfa1 = "641";
                    swAgrupa = 4;
               |FINSI;

               |SI swAgrupa ! 0;
                    |SI swAgrupa = 1;
                         aAccount = "4650130000";
                    |FINSI;
                    |SI swAgrupa = 2;
                         aAccount = "4650140000";
                    |FINSI;
                    |SI swAgrupa = 3;
                         aAccount = "4650150000";
                    |FINSI;
                    |SI swAgrupa = 4;
                         aAccount = "4650160000";
                    |FINSI;
                    nImporte = (-1) * nImporte;

                    #200#0 = "0515999999";
                    #200#1 = "9999999";
                    #200#2 = aAccount;
                    |LEE 101#200=;
                    |SI FSalida = 0;
                         #200#3 = #200#3 + nImporte;
                         |GRABA 020#200a;
                    |SINO;
                         #200#3 = #200#3 + nImporte;
                         |GRABA 020#200n;
                         nTotalLineas2 = nTotalLineas2 + 1;
                    |FINSI;
/*
|| xxxxxxxxxxxxxxxxxx
     || pruebas para el tiquet 3462.565, lo dejo aqui por si
     || hiciera falta volver a activarlo
                    |SI swAgrupa = 4;
                         #202#0 = #labtraba#0;
                         #202#1 = #labtraba#1;
                         #202#2 = #100#19;
                         #202#3 = #100#18;
                         #202#4 = #100#17;
                         #202#5 = nImporte;
                         #202#6 = #200#3;
                         xAnterior = #200#3;
                         |GRABA 020#202n;
                         |LIBERA #202;
                    |FINSI;
*/

                    |LIBERA #200;
               |FINSI;
          |FINSI;
/*
     || pruebas para el tiquet 3462.565, lo dejo aqui por si
     || hiciera falta volver a activarlo
     |SINO;
                         #202#0 = #labtraba#0;
                         #202#1 = #labtraba#1;
                         #202#2 = #100#19;
                         #202#3 = #100#18;
                         #202#4 = #100#17;
                         #202#5 = 0;
                         #202#6 = xAnterior;
                         |GRABA 020#202n;
                         |LIBERA #202;
*/
     |FINSI;
|FPRC;

|PROCESO GrabaTMP_UploadFile;
     #syke0020#3 = #labtraba#0;
     #syke0020#4 = #100#19;
     #syke0020#0 = #100#17;
     |LEE 000#syke0020.=;
     |SI FSalida = 0;
          aUnit = #syke0020#2;
          aUnit = "0515" + aUnit;
     |SINO;
          aUnit = "";
     |FINSI;

     #syke0021#4 = #labtraba#0;
     #syke0021#5 = #100#19;
     #syke0021#0 = #100#17;
     #syke0021#1 = #100#18;
     |LEE 000#syke0021.=;
     |SI FSalida = 0;
          aActivity = #syke0021#3;
     |SINO;
          aActivity = "";
     |FINSI;

     |SI aActivity = "";
          aAlfa = #100#19; |QBF aAlfa; aAlfa = aAlfa + "-";

          aAlfa = aAlfa + #100#17; |QBF aAlfa; aAlfa = aAlfa + "-";

          aAlfa = aAlfa + #100#18; |QBF aAlfa;

          aActivity = aAlfa;

          #201#0 = #labtraba#0;
          #201#1 = #labtraba#1;
          #201#2 = #100#19;
          #201#3 = #100#17;
          #201#4 = #100#18;
          #201#5 = #labtraba#2;
          #201#6 = "TRA";
          |LEE 000#201=;
          |SI FSalida ! 0;
               |GRABA 020#201n;
               |LIBERA #201;
          |FINSI;
     |FINSI;

     |SI nC10 ! 0; nConcepto = 10; nImporte = nC10; |HAZ Graba022; |FINSI;
     |SI nC11 ! 0; nConcepto = 11; nImporte = nC11; |HAZ Graba022; |FINSI;
     |SI nC12 ! 0; nConcepto = 12; nImporte = nC12; |HAZ Graba022; |FINSI;
     |SI nC13 ! 0; nConcepto = 13; nImporte = nC13; |HAZ Graba022; |FINSI;

     || pruebas para el tiquet 3462.565, lo dejo aqui por si
     || hiciera falta volver a activarlo
     || nConcepto = 13; nImporte = nC13; |HAZ Graba022;

     |SI nC14 ! 0; nConcepto = 14; nImporte = nC14; |HAZ Graba022; |FINSI;
     |SI nC15 ! 0; nConcepto = 15; nImporte = nC15; |HAZ Graba022; |FINSI;
     |SI nC16 ! 0; nConcepto = 16; nImporte = nC16; |HAZ Graba022; |FINSI;
|FPRC;

|PROCESO GrabaCamposNuevo;
     |DDEFECTO #100;
     nC10 = 0; nC11 = 0; nC12 = 0; nC13 = 0; nC14 = 0; nC15 = 0; nC16 = 0;
     nC23 = 0;

     #100#17 = #101#4;        || AREA
     #100#18 = #101#6;        || SECCION
     #100#19 = #101#2;        || CENTRO

     || #100#17 = aCodArea;
     || #100#18 = aCodSeccion;
     #100#0 = #labtraba#0;
     #100#5 = #labtraba#1;    || CODE
     |LEE 101#100=;
     FEstado = FSalida;

     #100#0 = #labtraba#0;
     #100#1 = #101#5;         || BUSINESS UNIT         (Descripcion Area)
     #100#2 = aCategoria;     || DEPARTMENT/Position
     #100#3 = #101#3;         || LOCATION              (Descripcion Centro)
     #100#4 = #101#7;         || CAMPAIGN              (Descripcion Seccion)
     #100#5 = #labtraba#1;    || CODE
     #100#6 = aNomTra;        || WORKER
     #100#7 = aFechaAlta;     || DATE LAST CONTRACT
     #100#8 = aFechaBaja;     || FINISH DATE
     #100#9 = nPorJornada * 100;    || % WORK-TIME
     #100#10 = nPaga1 * (#101#8 / #101#9) * (#101#13/#101#14);        || 13-EXTRA PAYMENT
     #100#11 = nPaga2 * (#101#8 / #101#9) * (#101#13/#101#14);        || 14-EXTRA PAYMENT
     #100#13 = nIndem * (#101#11 / #101#12) * (#101#15/#101#16);        || INDEMNITY

     #100#12 = nVacac * (#101#17 / #101#18) * (#101#15/#101#16);        || HOLIDAYS
     #100#15 = nSSVacac * (#101#17 / #101#18) * (#101#15/#101#16);      || SOC. SEC. HOLIDAYS

     #100#14 = #100#10 + #100#11 + #100#12 + #100#13;     || LIQUIDATION TOTAL
     #100#16 = #100#14 + #100#15;   || TOTAL COST

     #100#17 = #101#4;        || AREA
     #100#18 = #101#6;        || SECCION
     #100#19 = #101#2;        || CENTRO
|| xxxxxxxxxxxxxxxxx
     || campos nuevos pedido Sykes

     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
          #100#20 = #labtraba#234;
     |SINO;
          #100#20 = 39;
     |FINSI;

     #100#21 = #labtraba#7;
     nNume = #labtraba#45;
     |SI nNume < 400;
          #100#22 = "indefinido";
     |SINO;
          #100#22 = "temporal";
     |FINSI;

     |ABRE #nomtrato;
     #nomtrato#0 = 0111;
     #nomtrato#1 = nNume;
     |LEE 000#nomtrato.=;
     |SI FSalida = 0;
          #100#22 = #nomtrato#2;
     |FINSI;
     |CIERRA #nomtrato;

     || #100#23 = nDiasVacac;
     #100#23 = nDiasVacac * (#101#17 / #101#18) * (#101#15/#101#16); || DIAS HOLIDAYS

     nC10 = #100#10;
     nC11 = #100#11;
     nC12 = #100#12;
     nC13 = #100#13;
     nC14 = #100#14;
     nC15 = #100#15;
     nC16 = #100#16;
     nC23 = #100#23;

     |SI FEstado = 0;
          |GRABA 020#100.a;
     |SINO;
          |GRABA 020#100.n;
     |FINSI;
     |LIBERA #100;
     nTotalLineas = nTotalLineas + 1;

     |HAZ GrabaTMP_UploadFile;
|FPRC;

|DEFBUCLE GrabaCamposNuevo;
     #101#1;
     ;
     #labtraba#0, #labtraba#1, 01, "    ", "    ";
     #labtraba#0, #labtraba#1, 99, "zzzz", "zzzz";
     ;
     NULL, GrabaCamposNuevo;
|FIN;

|PROCESO GrabaNuevo;
     |BUCLE GrabaCamposNuevo;
|FPRC;

|DEFBUCLE GrabaPorNIF;
     #labtraba#2;
     ;
     aNif;
     aNif;
     ;
     NULL, GrabaNuevo;
|FIN;

|PROCESO ElActual;
     |DDEFECTO #101;

     #101#0 = #labtraba#0;         || empresa
     #101#1 = #labtraba#1;         || trabajador
     #101#2 = #labtraba#77;         || centro
     #101#4 = #labtraba#62;         || area
     #101#6 = #labtraba#63;         || seccion
     |LEE 101#101=;
     FEstado = FSalida;

     #101#3 = aCentro;             || descripcion centro
     #101#5 = aArea;               || descripcion area
     #101#7 = aSeccion;            || descripcion seccion

     |SI swCoef = 1;
          #101#8 = #101#8 + nUnid;
          #101#9 = nUnidTotal;

          #101#13 = nDiasTrab;
          #101#14 = nDiasTotal;
     |FINSI;

     |SI swCoef = 2;
          #101#11 = #101#11 + nUnid;
          #101#12 = nUnidTotal;

          #101#15 = nDiasTrab;
          #101#16 = nDiasTotal;
     |FINSI;

     |SI swCoef = 3;
          #101#17 = #101#17 + nUnid;
          #101#18 = nUnidTotal;

          #101#15 = nDiasTrab;
          #101#16 = nDiasTotal;
     |FINSI;

     #101#10 = "S";

     |SI FEstado = 0;
          |GRABA 020#101a;
     |SINO;
          |GRABA 020#101n;
     |FINSI;
     |LIBERA #101;
|FPRC;

|PROCESO BuscaUltArea;
     |SI #syke0014#2 = aDesdeAnyPro; |Y #syke0014#3 < nDesdeMesPro; |Y #syke0014#3 ! 99;
          |ACABA;
     |FINSI;
     |SI #syke0014#2 = aHastaAnyPro; |Y #syke0014#3 > nHastaMesPro; |Y #syke0014#3 ! 99;
          |ACABA;
     |FINSI;
     |SI #syke0014#3 = 99; |Y nUltMesCAS = 0;
          nUltMesCAS = 99;      || ultimo mes del que tengo
     |FINSI;

     |SI #syke0014#3 = #0#5;
          nUltMesCAS = #syke0014#3;      || ultimo mes del que tengo
          nUltLinCAS = #syke0014#4;      || ultimo mes del que tengo
     |FINSI;
|FPRC;

|DEFBUCLE BuscaUltArea;
     #syke0014#1;
     ;
     #labtraba#0, #labtraba#1, aDesdeAnyPro, 01, 01;
     #labtraba#0, #labtraba#1, aHastaAnyPro, 99, 99;
     ;
     NULL, BuscaUltArea;
|FIN;

|PROCESO BuscaAreas;
     |SI #syke0014#2 = aDesdeAnyPro; |Y #syke0014#3 < nDesdeMesPro; |Y #syke0014#3 ! 99;
          |ACABA;
     |FINSI;
     |SI #syke0014#2 = aHastaAnyPro; |Y #syke0014#3 > nHastaMesPro; |Y #syke0014#3 ! 99;
          |ACABA;
     |FINSI;
     |SI #syke0014#2 = aDesdeAnyPro; |Y #syke0014#3 = nDesdeMesPro; |Y #syke0014#3 ! 99;
          || mes alta (nNume2) el mismo mes en que estoy buscando
          || y dia alta (nNume0) mayor que el dia que acaba la prorrata
          |SI nMesAlta = #syke0014#3; |Y nDiaAlta > #syke0014#13;
               nUnidTotal = nUnidTotal - #syke0014#11;
               nNume = #syke0014#11;
               nUnid = nUnid - nNume;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #syke0014#3 = 99;
          swHay99 = 1;
     |FINSI;

     |DDEFECTO #101;
     #101#0 = #syke0014#0;         || empresa
     #101#1 = #syke0014#1;         || trabajador
     #101#2 = #syke0014#5;         || centro
     #101#4 = #syke0014#7;         || area
     #101#6 = #syke0014#9;         || seccion
     |LEE 101#101=;
     FEstado = FSalida;

     #101#3 = #syke0014#6;         || descripcion centro
     #101#5 = #syke0014#8;         || descripcion area
     #101#7 = #syke0014#10;        || descripcion seccion

     |SI swCoef = 1;
          |SI #syke0014#3 = 99;
               #101#8 = #101#8 + (#syke0014#11 * nUnid);    || unidades para prorrata
               #101#9 = nUnidTotal;               || unidades totales para prorrata
          |SINO;
               #101#8 = #101#8 + #syke0014#11;    || unidades para prorrata
               #101#9 = nUnidTotal;               || unidades totales para prorrata
               nNume = #syke0014#11;
               nUnid = nUnid - nNume;
          |FINSI;
          #101#13 = nDiasTrab;
          #101#14 = nDiasTotal;
     |FINSI;
     |SI swCoef = 2;
          |SI #syke0014#3 = 99;
               #101#11 = #101#11 + (#syke0014#11 * nUnid);    || unidades para prorrata
               #101#12 = nUnidTotal;               || unidades totales para prorrata
          |SINO;
               #101#11 = #101#11 + #syke0014#11;    || unidades para prorrata
               #101#12 = nUnidTotal;               || unidades totales para prorrata
               nNume = #syke0014#11;
               nUnid = nUnid - nNume;
          |FINSI;
          #101#15 = nDiasTrab;
          #101#16 = nDiasTotal;
     |FINSI;

     |SI swCoef = 3;
          |SI nUltLinCAS ! 0;
               #syke0014#11 = 1;
          |FINSI;
          #101#17 = #101#17 + (#syke0014#11 * nUnid);    || unidades para prorrata
          #101#18 = nUnidTotal;               || unidades totales para prorrata

          #101#15 = nDiasTrab;
          #101#16 = nDiasTotal;
     |FINSI;

     |SI FEstado = 0;
          |GRABA 020#101a;
     |SINO;
          |GRABA 020#101n;
     |FINSI;
     |LIBERA #101;
|FPRC;

|DEFBUCLE BuscaAreas;
     #syke0014#1;
     ;
     #labtraba#0, #labtraba#1, aDesdeAnyPro, nDesdeMesBus, nDesdeLinBus;
     #labtraba#0, #labtraba#1, aHastaAnyPro, nHastaMesBus, nHastaLinBus;
     ;
     NULL, BuscaAreas;
|FIN;

|PROCESO DiasAlta;
     swDiasAlta = 1;

     |HAZ CompFechas;
     swDiasAlta = 0;
     |SI swSigue = 0;
          |ACABA;
     |FINSI;
     |SI fFechaIni > fFechaAlta;
          nNume1 = fFechaIni;
     |SINO;
          nNume1 = fFechaAlta;
     |FINSI;

     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          nNume2 = fFechaBaja;
     |SINO;
          fFechaBaja = aFechaFIN;
          nNume2 = fFechaBaja;
     |FINSI;

     || para lo que estoy buscando (vacaciones desde el primer dia del a쨚 y
     || prorrata desde el primer dia de prorrateo de la paga) (y siempre
     || hasta el ultimo dia del mes del que pido el informe de los huevos)

     || los dias que esta de alta en total el NIF del trabajador
     nDiasTotal = nDiasTotal + (nNume2 - nNume1 + 1);
     |SI #labtraba#1 = nTrabActual;
     || los dias de alta del trabajador en cuestion
          nDiasTrab = nNume2 - nNume1 + 1;
     |FINSI;
|FPRC;

|DEFBUCLE DiasAlta;
     #labtraba#2;
     ;
     aNif;
     aNif;
     ;
     NULL, DiasAlta;
|FIN;

|PROCESO Vacaciones;
     fFechaAlta = #labtraba#36;     || la fecha de alta contrato
     aAlfa0 = #labtraba#36 % 102;
     aAlfa1 = #labtraba#36 % 402;
     aAlfa2 = #labtraba#36 % -104;

     aAlfa3 = "01"
     aAlfa4 = #0#4;
     aFechaIni = "01" + "." + aAlfa3 + "." + aAlfa4;
     fFechaIni = aFechaIni;
     |SI fFechaAlta > fFechaIni;
          aAlfa1 = aAlfa1;
          aAlfa2 = aAlfa2;
     |SINO;
          aAlfa1 = aAlfa3;
          aAlfa2 = aAlfa4;
     |FINSI;

     nNume0 = aAlfa0;         || dia alta
     nNume2 = aAlfa1;         || mes alta
     nNume3 = aAlfa2;         || a쨚 alta

     nDiaAlta = aAlfa0;         || dia alta
     nMesAlta = aAlfa1;         || mes alta
     nAnyAlta = aAlfa2;         || a쨚 alta

     nNume4 = #0#5;           || mes que se pide
     nNume5 = #0#4;           || a쨚 que se pide
     nUnid = 0;
     |PARA nNume3 = nNume3; |SI nNume3 [ nNume5; |HACIENDO nNume3 = nNume3 + 1;
          |PARA nNume2 = nNume2; |SI nNume2 [ 12; |HACIENDO nNume2 = nNume2 + 1;
               nUnid = nUnid + 1;
               |SI nNume3 = nNume5; |Y nNume2 = nNume4;
                    |SAL;
               |FINSI;
          |SIGUE;
          |SI nNume2 = 13;
               nNume2 = 1;
          |FINSI;
     |SIGUE;
     nUnid = 1;
     nUnidTotal = nUnid;

     nDesdeMesPro = aAlfa1;
     aDesdeAnyPro = aAlfa2;
     nHastaMesPro = #0#5;
     aHastaAnyPro = #0#4;
     swCoef = 3;
     swHay99 = 0;

     |SALVA_FICHA #labtraba;
     aNif = #labtraba#7;
     nTrabActual = #labtraba#1;
     nDiasTrab = 0;
     nDiasTotal = 0;

     |BUCLE DiasAlta;    || primero cuento dias alta
     |REPON_FICHA #labtraba;

     nUltMesCAS = 0;
     nUltLinCAS = 0;

     |BUCLE BuscaUltArea;       || ahora para coeficientes de vacaciones

     nDesdeMesBus = nUltMesCAS;
     nHastaMesBus = nUltMesCAS;

     |SI nUltLinCAS ! 0;
          nDesdeLinBus = nUltLinCAS;
          nHastaLinBus = nUltLinCAS;
     |SINO;
          nDesdeLinBus = 01;
          nHastaLinBus = 99;
     |FINSI;

     |BUCLE BuscaAreas;       || ahora para coeficientes de vacaciones

     |SI nUltMesCAS = 0;      || tengo que coger area/secc del labtraba
          |HAZ ElActual;
     |FINSI;
|FPRC;

|PROCESO Indemnizaciones;
     fFechaAlta = #labtraba#36;     || la fecha de alta contrato
     aAlfa0 = #labtraba#36 % 102;
     aAlfa1 = #labtraba#36 % 402;
     aAlfa2 = #labtraba#36 % -104;

     aAlfa3 = "01"
     aAlfa4 = #0#4;
     aFechaIni = "01" + "." + aAlfa3 + "." + aAlfa4;
     fFechaIni = aFechaIni;
     |SI fFechaAlta > fFechaIni;
          aAlfa1 = aAlfa1;
          aAlfa2 = aAlfa2;
     |SINO;
          aAlfa1 = aAlfa3;
          aAlfa2 = aAlfa4;
     |FINSI;

     nNume0 = aAlfa0;         || dia alta
     nNume2 = aAlfa1;         || mes alta
     nNume3 = aAlfa2;         || a쨚 alta

     nDiaAlta = aAlfa0;         || dia alta
     nMesAlta = aAlfa1;         || mes alta
     nAnyAlta = aAlfa2;         || a쨚 alta

     nNume4 = #0#5;           || mes que se pide
     nNume5 = #0#4;           || a쨚 que se pide
     nUnid = 0;
     |PARA nNume3 = nNume3; |SI nNume3 [ nNume5; |HACIENDO nNume3 = nNume3 + 1;
          |PARA nNume2 = nNume2; |SI nNume2 [ 12; |HACIENDO nNume2 = nNume2 + 1;
               nUnid = nUnid + 1;
               |SI nNume3 = nNume5; |Y nNume2 = nNume4;
                    |SAL;
               |FINSI;
          |SIGUE;
          |SI nNume2 = 13;
               nNume2 = 1;
          |FINSI;
     |SIGUE;
     nUnidTotal = nUnid;

     nDesdeMesPro = aAlfa1;
     aDesdeAnyPro = aAlfa2;
     nHastaMesPro = #0#5;
     aHastaAnyPro = #0#4;
     swCoef = 2;
     swHay99 = 0;

     |SALVA_FICHA #labtraba;
     aNif = #labtraba#7;
     nTrabActual = #labtraba#1;
     nDiasTrab = 0;
     nDiasTotal = 0;

     |BUCLE DiasAlta;    || primero cuento dias alta
     |REPON_FICHA #labtraba;

     nDesdeMesBus = 01;
     nHastaMesBus = 99;

     nDesdeLinBus = 01;
     nHastaLinBus = 99;

     |BUCLE BuscaAreas;       || ahora para coeficientes de indemnizaciones

     |SI swHay99 = 0;      || si quedan unidades a repartir (no hay 99)
          |HAZ ElActual;
     |FINSI;
|FPRC;

|PROCESO Pagas;
     |SI #0#5 [ 6
          nDesdeMesPro = 1;
     |SINO;
          nDesdeMesPro = 7;
     |FINSI;
     nHastaMesPro = #0#5;

     fFechaAlta = #labtraba#36;     || la fecha de alta contrato
     aAlfa1 = nDesdeMesPro; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#4;
     aFechaIni = "01" + "." + aAlfa1 + "." + aAlfa2;
     fFechaIni = aFechaIni;

     |SI fFechaAlta > fFechaIni;
          aAlfa1 = #labtraba#36 % 102;
          aAlfa2 = #labtraba#36 % 402;
          nDesdeMesPro = aAlfa2;
          nUnid = nHastaMesPro - nDesdeMesPro + 1;
     |SINO;
          nUnid = nHastaMesPro - nDesdeMesPro + 1;
     |FINSI;
     nUnidTotal = nUnid;

     nDiasTotal = 0;
     |PARA nMesBusca = nDesdeMesPro; |SI nMesBusca [ nMesHastaPro; |HACIENDO nMesBusca = nMesBusca + 1;
          anynum = #0#4;
          mesnum = nMesBusca;
          |HAZ ulti_dia;
          nDiasTotal = nDiasTotal + topemes;
     |SIGUE;

     aDesdeAnyPro = #0#4;
     aHastaAnyPro = #0#4;
     swCoef = 1;
     swHay99 = 0;

     |SALVA_FICHA #labtraba;
     aNif = #labtraba#7;
     nTrabActual = #labtraba#1;
     nDiasTrab = 0;
     nDiasTotal = 0;

     |BUCLE DiasAlta;    || primero cuento dias alta
     |REPON_FICHA #labtraba;

     nDesdeMesBus = 01;
     nHastaMesBus = 99;

     nDesdeLinBus = 01;
     nHastaLinBus = 99;

     |BUCLE BuscaAreas;       || busco para los coeficientes de la paga.

     |SI swHay99 = 0;      || si quedan unidades a repartir (no hay 99)
          |HAZ ElActual;
     |FINSI;
|FPRC;

|PROCESO Prorrateos;
     |HAZ Pagas;
     |HAZ Indemnizaciones;
     |HAZ Vacaciones;
|FPRC;

|PROCESO CompFechas;
     swSigue = 1;
     swFiniq = 1;
     swVacac = 1;

     fFechaAlta = #labtraba#36;
     fFechaBaja = #labtraba#37;

     anynum = #0#4;
     mesnum = #0#5;
     |HAZ ulti_dia;

     aDia = topemes; aDia = ("00" + aDia) % -102;
     aMes = #0#5; aMes = ("00" + aMes) % -102;
     aAny = #0#4;
     aFecha = aDia + "." + aMes + "." + aAny;
     fFecha = aFecha;

     |SI swCoef ! 1;     || vengo de prorratas, ya tengo cargada la fechaini
          aFecha = "01.01." + aAny;
          fFechaIni = aFecha;
     |FINSI;

     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          |SI fFechaBaja [ fFecha;      || los que se dan de baja este mes
               |SI #labtraba#48 ! "N";  || tampoco los incluyo
                    swSigue = 0;
               |SINO;
                    swFiniq = 0;        || de estos NO me calcules finiquito
               |FINSI;
          |FINSI;
     |FINSI;

     |SI fFechaAlta > fFecha;           || los que sean alta despues del mes
          swSigue = 0;                  || que pido tampoco los muestro
     |FINSI;

     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          |SI fFechaBaja < fFechaIni;   || estoy de baja antes de que empiezan
               swSigue = 0;             || a contar lo que busque
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO labtraba;
     |HAZ Inicializa;

     swDiasAlta = 0;
     |HAZ CompFechas;
     |SI swSigue = 0;
          |ACABA;
     |FINSI;

     nTrab = nTrab + 1;
     aTrab = nTrab;
     aNroTrab = nNroTrab;
     aAlfa = "    Procesando trabajador " + aTrab + " de " + aNroTrab;
     |PINTA 1820, aAlfa;

     #nomauxi1#0 = #labtraba#62;
     |LEE 000#nomauxi1.=;
     |SI FSalida = 0;
          aArea = #nomauxi1#1;
          aCodArea = #nomauxi1#0;
     |FINSI;

     aCategoria = #labtraba#18;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI FSalida = 0;
          aCentro = #labcentr#2;
          nCodCentro = #labcentr#1;
     |FINSI;

     #nomauxi2#0 = #labtraba#62;
     #nomauxi2#1 = #labtraba#63;
     |LEE 000#nomauxi2.=;
     |SI FSalida = 0;
          aSeccion = #nomauxi2#2;
          aCodSeccion = #nomauxi2#1;
     |FINSI;

     aCodTra = #labtraba#1;
     |QBF aCodTra;
     aCodTra = "00000" + aCodTra;
     aCodTra = aCodTra % -105;

     aNomTra = #labtraba#2;

     || estaba puesto para que se imprimiera la fecha de alta, nos piden que
     || lo cambiemos por la de antiguedad: 003462.00418
     aFechaAlta = #labtraba#34;
     aFechaBaja = #labtraba#37;


/*
     ||Busca Horas Mes Cto 909
     #nomcalli#0 = #labtraba#0;
     #nomcalli#1 = #labtraba#1;
     #nomcalli#2 = #0#5;
     #nomcalli#3 = 0;
     #nomcalli#4 = 909;
     |LEE 000#nomcalli.=;
     |SI FSalida = 0;
          nNum = #nomcalli#10 * #nomcalli#11;
          nHorasMes = nNum;
     |SINO;
          nHorasMes = 39;
     |FINSI;
*/
     || a pelo: es para sykes, lo del nomcalli no esta bien, no me meto en lios
     nHorasMes = 39;

     nHoras = #labtraba#234;
     |SI nHoras ! 0;
          nPorJornada = (nHoras / nHorasMes) ! 2;
     |SINO;
          nPorJornada = 0;
     |FINSI;
/*
     nConcepto = 201;
     |HAZ BuscaAcumPaga;
     nPaga1 = nTotal;

     nConcepto = 202;
     |HAZ BuscaAcumPaga;
     nPaga2 = nTotal;
*/
     anynum = #0#4;
     mesnum = #0#5;
     |HAZ ulti_dia;
     aDia = topemes; aDia = ("00" + aDia) % -102;
     aMes = #0#5; aMes = ("00" + aMes) % -102;
     aAny = #0#4;
     aFechaFIN = aDia + "." + aMes  + "." + aAny;  || fecha baja

     ||HAZ Indemnizacion;
     || nIndem = product;

     aMes = #0#5; aMes = ("00" + aMes) % -102;
     aAny = #0#4;

     aAlfa = #labtraba#0;
     |QBF aAlfa;
     aAlfa = "00000" + aAlfa;
     aAlfa = aAlfa % -105;
     aAlfa = aAlfa + aCodTra + aMes + aAny;
     aAlfa = "nomcalfi;" + aAlfa;

     |SI swFiniq = 1;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     |SI #0#6 = "N";
          nume1 = #labtraba#45;
          |SI nume1 [ 399;
               nIndem = 0;
          |FINSI;
     |FINSI;

     nTotalLiq = nPaga1 + nPaga2 + nVacac + nIndem;     || LIQUIDATION TOTAL

     |SI nSSVacac < 0;
          nSSVacac = 0;
     |FINSI;

     nTotalCoste = nTotalLiq + nSSVacac;

     |HAZ Prorrateos;

     |SI nTotalLiq ! 0;
          aNif = #labtraba#7;
          |SALVA_FICHA #labtraba;
          |BUCLE GrabaPorNIF;
          |REPON_FICHA #labtraba;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     77;
     #0#0, #0#7, #0#2;
     #0#1, #0#8, #0#3;
     ;
     NULL, labtraba;
|FIN;


|PROCESO CuentaTraba;
     swDiasAlta = 0;
     |HAZ CompFechas;

     |SI swSigue = 1;
          nNroTrab = nNroTrab + 1;
     |FINSI;
|FPRC;

|DEFBUCLE CuentaTraba;
     #labtraba#1;
     77;
     #0#0, #0#7, #0#2;
     #0#1, #0#8, #0#3;
     ;
     NULL, CuentaTraba;
|FIN;

|PROCESO PintaCuadro;
     |PINTA 1715, "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커";
     |PINTA 1815, "                                                ";
     |PINTA 1915, "                                                ";
     |PINTA 2015, "                                                ";
     |PINTA 2115, "읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸";
|FPRC;

|PROCESO ElProceso;
     |ABRE #labtraba;
     |ABRE #labcentr;
     |ABRE #nomauxi1;
     |ABRE #nomauxi2;
     |ABRE #nomconca;
     |ABRE #nomconli;
     |ABRE #nomcalca;
     |ABRE #nomcalli;
     |ABRE #nomhicca;
     |ABRE #nomhicli;
     |ABRE #nomcontr;
     |ABRE #nomepigr;
     |ABRE #syke0014;

     |ABRE #syke0020;
     |ABRE #syke0021;
     |ABRE #syke0026;

     |LEE 000#nomcontr.p;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("s" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #100;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("w" + aAlfa1) % 108;
     |NOME_DAT #101 aAlfa1;
     |DELINDEX #101;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("t" + aAlfa1) % 108;
     |NOME_DAT #200 aAlfa1;
     |DELINDEX #200;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("u" + aAlfa1) % 108;
     |NOME_DAT #201 aAlfa1;
     |DELINDEX #201;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("y" + aAlfa1) % 108;
     |NOME_DAT #202 aAlfa1;
     |DELINDEX #202;

     |ABRE #100;
     |ABRE #101;
     |ABRE #200;
     |ABRE #201;
     |ABRE #202;

     |HAZ PintaCuadro;
     |BUCLE CuentaTraba;
     |BUCLE labtraba;

     || pruebas para el tiquet 3462.565, lo dejo aqui por si
     || hiciera falta volver a activarlo
     ||CONSULTA_CLAVE #1#202;

     |CIERRA #syke0020;
     |CIERRA #syke0021;
     |CIERRA #syke0026;
     |CIERRA #202;
     |CIERRA #201;
     |CIERRA #200;
     |CIERRA #101;
     |CIERRA #100;
     |CIERRA #syke0014;
     |CIERRA #nomepigr;
     |CIERRA #nomcontr;
     |CIERRA #nomhicli;
     |CIERRA #nomhicca;
     |CIERRA #nomcalli;
     |CIERRA #nomcalca;
     |CIERRA #nomconli;
     |CIERRA #nomconca;
     |CIERRA #nomauxi2;
     |CIERRA #nomauxi1;
     |CIERRA #labcentr;
     |CIERRA #labtraba;
|FPRC;

|PROCESO syke0023;
     nLinea = nLinea + 1;

     || Run Group
     aAlfa1 = #0#5;
     |QBF aAlfa1;
     aAlfa1 = ("00" + aAlfa1) % -102;

     aAlfa2 = #0#4;
     aAlfa2 = aAlfa2 % -102;

     aAlfa = "TL" + aAlfa1 + aAlfa2;

     aAlfa = "A" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || FC
     aAlfa = "A";
     aAlfa = "B" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || sequence number
     nNume = nLinea - 1;
     aAlfa = nNume;
     aAlfa = "C" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Reference
     nMes = #0#5;
     |HAZ MesLetra_plb;
     aAlfa1 = (aMes % 103);

     aAlfa2 = #0#4;
     aAlfa2 = aAlfa2 % -102;

     aAlfa = "THEOR. LIQUID " + aAlfa1 + " " + aAlfa2;
     aReference = aAlfa;
     aAlfa = "D" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Post Date
     aAlfa = #0#9;
     aAlfa = (aAlfa % 102) + "/" + (aAlfa % 402) + "/" + (aAlfa % -104);
     aAlfa = "E" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Company/Acct Unit
     aAlfa = #200#0;
     aAlfa = "F" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Account Number
     aAlfa = #200#2;
     aAlfa = "G" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Description
     aAlfa = aReference;
     aAlfa = "H" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Trans Amt
     aAlfa = "I" + nLinea + "," + #200#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Activity
     aAlfa = #200#1;
     aAlfa = "J" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Acct Cat
     || aAlfa = "K" + nLinea + "," + ""; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Post Date
     aAlfa = #0#9;
     aAlfa = (aAlfa % 102) + "/" + (aAlfa % 402) + "/" + (aAlfa % -104);
     aAlfa = "L" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Reverse
     aAlfa = "Y";
     aAlfa = "M" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     ||HAZ Mensajes;
|FPRC;

|DEFBUCLE syke0023;
     #200#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, syke0023;
|FIN;

|PROCESO Impresion;
     nLinea = nLinea + 1;
     #labempre#0 = #100#0;
     |LEE 000#labempre.=;
     |SI FSalida = 0;
          aAlfa = "A" + nLinea + "," + #labempre#2; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
     aAlfa = "B" + nLinea + "," + #100#1; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + #100#2; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + #100#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + #100#4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = #100#5;     |QBF aAlfa;
     aAlfa = "00000" + aAlfa;
     aAlfa = aAlfa % -105;
     aAlfa = "F" + nLinea + "," + "'" + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + #100#6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "H" + nLinea + "," + #100#20; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + #100#21; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "L" + nLinea + "," + #100#22; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "M" + nLinea + "," + #100#7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + #100#8; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI #100#9 ! 0;
          aAlfa = "O" + nLinea + "," + #100#9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
     aAlfa = "P" + nLinea + "," + #100#10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Q" + nLinea + "," + #100#11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "R" + nLinea + "," + #100#23; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "S" + nLinea + "," + #100#12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "T" + nLinea + "," + #100#13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "U" + nLinea + "," + #100#14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "V" + nLinea + "," + #100#15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "W" + nLinea + "," + #100#16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nTotalP = nTotalP + #100#10;
     nTotalQ = nTotalQ + #100#11;
     nTotalS = nTotalS + #100#12;
     nTotalT = nTotalT + #100#13;
     nTotalU = nTotalU + #100#14;
     nTotalV = nTotalV + #100#15;
     nTotalW = nTotalW + #100#16;

     nNume = nLinea - 8;
     aAlfa1 = nNume;
     |QBF aAlfa1;
     aAlfa2 = nTotalLineas;
     |QBF aAlfa2;
     aAlfa = "L죒ea " + aAlfa1 + " de " + aAlfa2 + ".";
     |PINTA 1943, aAlfa;
|FPRC;

|DEFBUCLE Impresion;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impresion;
|FIN;

|PROCESO Totales;
     nLinea = nLinea + 1;

     aAlfa = "O" + nLinea + "," + "TOTAL"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "P" + nLinea + "," + nTotalP; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Q" + nLinea + "," + nTotalQ; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "S" + nLinea + "," + nTotalS; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "T" + nLinea + "," + nTotalT; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "U" + nLinea + "," + nTotalU; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "V" + nLinea + "," + nTotalV; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "W" + nLinea + "," + nTotalW; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
|FPRC;

|PROCESO ElInforme;
     |PINTA 1921, "Generando Hoja Excel. ";
     |ABRE #100;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "documentos/theorical_liquidation.xls";
     aDestinoTrab = "C:\DOCUMENTOS";         |RMKDIR aDestino;
     aDestino = aDestinoTrab + "\trabajo.xls";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDestino;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "THEORICAL LIQUIDATION";

     nLinea = 7;
     |ABRE #labempre;
     aAlfa = "C4," + #0#5 +" / " + #0#4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |BUCLE Impresion;
     |CIERRA #labempre;

     ||Totales Finales
     |HAZ Totales;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Upload File";
     || nPaso = 3;
     nLinea = 1;
     |BUCLE syke0023;

     aAlfa   = aDestinoTrab + "\theorical_liquidation.xls";
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;
     aResultado = aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
     |DESCARGADLL "agixl97.dll";

     aDestino   = aDestinoTrab + "\trabajo.xls";
     |RFBORRA aDestino;

     aVersion1 = "Excel.Sheet";
     |ESPECIFICA "VERSION_PROGRAMA", aVersion;
     |HAZ ExtraePath;
     |SI aPath = "NO LOCALIZADO";
         |MENAV "0000 No puedo encontrar automaticamente la Excel";
         |ACABA;
     |FINSI;

     |QBF aPath;

     || aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aResultado + &34;
     |RSYSTEM aAlfa;

     |CIERRA #100;
|FPRC;

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO imprime;
     |PRINT;
|FPRC;

|DEFBUCLE syke0027;
     #201#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, imprime;
|FIN;

|PROCESO SinActividad;
     |ABRE #201;
     |LEE 000#201p;
     |SI FSalida = 0;
          aAlfa = "    SSe ha detectado trabajadores en Secciones ";
          aAlfa = aAlfa + "sin actividad. 풡esea imprimir la lista?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               |IMPRE 0;
               |SI FSalida = 0;
                    |INFOR "syke0028";
                    |BUCLE syke0027;
                    |PIEINF;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
     |FINSI;
     |CIERRA #201;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ ElProceso;
          |HAZ ElInforme;
          |HAZ SinActividad;
     |FINSI;
|FPRO;
