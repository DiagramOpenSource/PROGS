|FICHEROS;
     nomrecib #00;       || def de impresion
     nomcalcu #40;       || parrilla de codigos
     nomcalat #41;       || parrilla de codigos atrasos
     dsnetm00@ #150;     || parametros dsnetcom

     nomtrnom #10;
     labempre #1;
     labtraba #2;
     nomtraca;
     nombanco;
     nomcontr;
     nomcont1;
     nomcont3;

     pdfdocca;
     pdfdocli;
     pdfimtmp #200;

     nomgruec;           || grupos de empresas Cabs.
     nomgruel;           || grupos de Empresas Lins.

     copiadef@ #500;
|FIN;

|VARIABLES;
     nDesdeFuera=0;
     i=0;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     anyo = 0;
     bisiesto = 0;
     fecsys = @;
     nume1 = 0;
     nume2 = 0;
     p_mes = "";
     topemes = 0;

     &acum = 1;
     &runnom = "nomyreci";
     aCadena1="";
     aFuente="";
     aTipoRecibo="";
     aTipoImpresion="";

     aDirDes = "";
     aRutaDes = "";
     aRuta = "";
     aRutaDatos = "";
     nCanal = 0;
     aArchivo = "";
     aCabecera = "";
     aTipoResumen = "";
     aTipoNomina = "";
     aEmpresa = "";
     aAnyDesde = "";
     aAnyHasta = "";
     aMesDesde = "";
     aMesHasta = "";
     aOrdenacion = "";
     aAny = "";
     aDireccion = "";
     aTrabajadorDesde = "";
     aTrabajadorHasta = "";
     nEmpresa = 0;
     nAny = 0;
     nMesDesde = 0;
     nMesHasta = 0;
     nOrdenacion = 0;
     nDireccion = 0;
     nTrabajadorDesde = 0;
     nTrabajadorHasta = 0;

     cParam         = "";
     cParte         = "";
     &cOrigen        = "";
     &cDestino       = "";
     cDirBase       = "";
     cUsuario       = "";
     cIp            = "";
     cDirUsu        = "";
     cNumUsu        = "";
     aAlfa = "";
     aTabla = "";
     aDir = "";
     &nErrorInf = 0;
     aSystem = "";
     aBaseBin = "";
     aDirOri = "";

     nLongitud = 0;
     aLongitud = "";
     &swDesdeWeb = 0;
     &aParametro = "";
     salte_1 = 0;
     salte_2 = 0;
     para1 = 0;

     nAscii = 0;
     aCaracter = "";
     aCaracterSal = "";
     aCadena = "";
     aCadenaSal = "";
     nPos = 0;
     nBusca = 0;
     aValor = "";
     aCampo = "";
     nTipo = 0;
     &swCopia = 0;
     &aID = "";
     &enWeb = 0;
     &eaWebDirPDF = "";
     &eaWebArchivo = "";
     &eaWebDirDes = "";
     aTipoEmiAt = "";
     nSwNumer = 0;
     nNume = 0;
     &aListaFich = "";
     &swPDFMasivo = 0;
     &aParam1 = "";
     &aParam2 = "";
     &aProcedencia = "";
     &nNroCopias = 0;
     &enCodBanco = 0;
     &swComercio = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     swCarga = 0;

     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nAnyAUTO = 0;
     &nMesAUTO = 0;
     &nTipAUTO = 0;
     &aParam = "";
     aTipoAtrasos = "";
     aRutaPDFWeb = "";
     &nArchi = 0;
     FEstado = 0;

     aMes = "";
     aDef = "";
     aFic = "";
     aPath = "";
     nMes = 0;
     nCampoMes = 0;
     &swEmailDirecto = 0;
     &swImpDirecto = 0;
     &eaVengoDe = "";
     &swPasada = 0;
     &swStopIRPF = 0;
     &eaMensaCad = "";
     &enErrorCad = 0;

     aBase = "";
     aOrigen = "";
     aDestino = "";
     nHandle = 0;
     aDirLocal = "";
     aDocRemoto = "";
     aDocServidor = "";
     aIPRemoto = "";
     {1}aContiene = "";
     swYaExiste = 0;
     swAcaba = 0;
     &enTipoAt = 0;
     aFicheroTgz = "";
     aFicheroTar = "";
     aRutaDestino = "";
     aAbre = "";
     nHandleTgz = 0;
     &enSwSimulacion = 0;
     &eaFichSimBox = "";
|FIN;

|INCLUYE nomcal_4;

*************************************************************************
      RECOGE LA PARRILLA DEL CALCULO Y GESTIONA EL TIPO DE SELECCION
*************************************************************************

|PROCESO ConsEmp; |TIPO 66;
     |DFICE aAlfa1;
     |DFICB aAlfa2;

     |SI aAlfa1 ! aAlfa2;
          |PATH_DAT #1 aAlfa1;
     |FINSI;

     |ABRE #labempre;
     |LEE 000#labempre.p;
     |CONSULTA_CLAVE #1#labempre;
     |SI FSalida = 0;
          #0Campo = #labempre#0;
          |PINTA #0Campo;
     |FINSI;
     |CIERRA #labempre;
|FPRC;

|PROCESO MinTra;
     #labtraba#0 = #0nCampo;
     #labtraba#1 = 00001;
|FPRC;

|PROCESO MaxTra;
     #labtraba#0 = #0nCampo;
     #labtraba#1 = 99999;
|FPRC;

|PROCESO ConsTra; |TIPO 66;
     |ABRE #labtraba;
     nCampo = Campo - 2;
     |CONSULTA_F_CLAVE #1#labtraba, MinTra, MaxTra;
     |SI FSalida = 0;
          #0Campo = #labtraba#1;
          |PINTA #0Campo;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO Parrillas; |TIPO 7;
     |SI #0#67="M"; |O #0#67="H";
          |HAZ parrillaMH;
     |SINO;
          |HAZ parrillaA;
     |FINSI;
     #0#9 = #nomcontr#52;
     |PINTA #0#9;
|FPRC;

|PROCESO parrillaA;
     |ABRE #41;
     |LEE 001#41p;
     |SI FSalida ! 0;  |DDEFECTO #41;  |FINSI;
     |PARA nume1 = 21; |SI nume1 [ 41; |HACIENDO nume1 = nume1 + 1;
             nume2 = nume1 + 21;
             #0nume1 = #41nume1;
             #0nume2 = #41nume2;
     |SIGUE;
         #0#4 = #41#9 $ 100;  || a¤o
         #0#5 = #41#8;        || desde mes
         #0#7 = #41#10;       || hasta mes
     |CIERRA #41;
     |PINDA #0#0;
|FPRC;

|PROCESO parrillaMH;
     aAlfa = Usuario;         |QBF aAlfa;
     aAlfa = "n" +  aAlfa;
     |NOME_DAT #40 aAlfa;

     |ABRE #40;
     |LEE 001#40p;
     |SI FSalida ! 0;  |DDEFECTO #40;  |FINSI;
     |PARA nume1 = 21; |SI nume1 [ 41; |HACIENDO nume1 = nume1 + 1;
             nume2 = nume1 + 21;
             #0nume1 = #40nume1;
             #0nume2 = #40nume2;
     |SIGUE;
         #0#0 = #40#0;
         #0#1 = #40#1;        || desde/hasta empresa/trabajador
         #0#2 = #40#2;
         #0#3 = #40#3;
         #0#4 = #40#9 $ 100;  || a¤o
         #0#5 = #40#8;        || mes
     |CIERRA #40;
     |PINDA #0#0;
|FPRC;

|PROCESO Seleccion; |TIPO 0;
     |SI #0#21 = 0;
         |CAMPO_MODIFICA #0#0, 1, "S";
         |CAMPO_MODIFICA #0#1, 1, "S";
         |CAMPO_MODIFICA #0#2, 1, "S";
         |CAMPO_MODIFICA #0#3, 1, "S";
         |CAMPO_MODIFICA #0#63, 1, "S";
         |CAMPO_MODIFICA #0#22, 1, "N";
         |CAMPO_MODIFICA #0#23, 1, "N";
         |CAMPO_MODIFICA #0#24, 1, "N";
         |CAMPO_MODIFICA #0#25, 1, "N";
         |CAMPO_MODIFICA #0#26, 1, "N";
         |CAMPO_MODIFICA #0#27, 1, "N";
         |CAMPO_MODIFICA #0#28, 1, "N";
         |CAMPO_MODIFICA #0#29, 1, "N";
         |CAMPO_MODIFICA #0#30, 1, "N";
         |CAMPO_MODIFICA #0#31, 1, "N";
         |CAMPO_MODIFICA #0#32, 1, "N";
         |CAMPO_MODIFICA #0#33, 1, "N";
         |CAMPO_MODIFICA #0#34, 1, "N";
         |CAMPO_MODIFICA #0#35, 1, "N";
         |CAMPO_MODIFICA #0#36, 1, "N";
         |CAMPO_MODIFICA #0#37, 1, "N";
         |CAMPO_MODIFICA #0#38, 1, "N";
         |CAMPO_MODIFICA #0#39, 1, "N";
         |CAMPO_MODIFICA #0#40, 1, "N";
         |CAMPO_MODIFICA #0#41, 1, "N";
         |CAMPO_MODIFICA #0#42, 1, "N";
         |CAMPO_MODIFICA #0#43, 1, "N";
         |CAMPO_MODIFICA #0#44, 1, "N";
         |CAMPO_MODIFICA #0#45, 1, "N";
         |CAMPO_MODIFICA #0#46, 1, "N";
         |CAMPO_MODIFICA #0#47, 1, "N";
         |CAMPO_MODIFICA #0#48, 1, "N";
         |CAMPO_MODIFICA #0#49, 1, "N";
         |CAMPO_MODIFICA #0#50, 1, "N";
         |CAMPO_MODIFICA #0#51, 1, "N";
         |CAMPO_MODIFICA #0#52, 1, "N";
         |CAMPO_MODIFICA #0#53, 1, "N";
         |CAMPO_MODIFICA #0#54, 1, "N";
         |CAMPO_MODIFICA #0#55, 1, "N";
         |CAMPO_MODIFICA #0#56, 1, "N";
         |CAMPO_MODIFICA #0#57, 1, "N";
         |CAMPO_MODIFICA #0#58, 1, "N";
         |CAMPO_MODIFICA #0#59, 1, "N";
         |CAMPO_MODIFICA #0#60, 1, "N";
         |CAMPO_MODIFICA #0#61, 1, "N";
         |CAMPO_MODIFICA #0#62, 1, "N";
         |PARA nume1 = 21; |SI nume1 [ 62; |HACIENDO nume1 = nume1 + 1;
             #0nume1 = 0;
         |SIGUE;
         |PINDA #0#0;
     |SINO;
         |CAMPO_MODIFICA #0#0, 1, "N";
         |CAMPO_MODIFICA #0#1, 1, "N";
         |CAMPO_MODIFICA #0#2, 1, "N";
         |CAMPO_MODIFICA #0#3, 1, "N";
         |CAMPO_MODIFICA #0#63, 1, "N";
         |CAMPO_MODIFICA #0#22, 1, "S";
         |CAMPO_MODIFICA #0#23, 1, "S";
         |CAMPO_MODIFICA #0#24, 1, "S";
         |CAMPO_MODIFICA #0#25, 1, "S";
         |CAMPO_MODIFICA #0#26, 1, "S";
         |CAMPO_MODIFICA #0#27, 1, "S";
         |CAMPO_MODIFICA #0#28, 1, "S";
         |CAMPO_MODIFICA #0#29, 1, "S";
         |CAMPO_MODIFICA #0#30, 1, "S";
         |CAMPO_MODIFICA #0#31, 1, "S";
         |CAMPO_MODIFICA #0#32, 1, "S";
         |CAMPO_MODIFICA #0#33, 1, "S";
         |CAMPO_MODIFICA #0#34, 1, "S";
         |CAMPO_MODIFICA #0#35, 1, "S";
         |CAMPO_MODIFICA #0#36, 1, "S";
         |CAMPO_MODIFICA #0#37, 1, "S";
         |CAMPO_MODIFICA #0#38, 1, "S";
         |CAMPO_MODIFICA #0#39, 1, "S";
         |CAMPO_MODIFICA #0#40, 1, "S";
         |CAMPO_MODIFICA #0#41, 1, "S";
         |CAMPO_MODIFICA #0#42, 1, "S";
         |CAMPO_MODIFICA #0#43, 1, "S";
         |CAMPO_MODIFICA #0#44, 1, "S";
         |CAMPO_MODIFICA #0#45, 1, "S";
         |CAMPO_MODIFICA #0#46, 1, "S";
         |CAMPO_MODIFICA #0#47, 1, "S";
         |CAMPO_MODIFICA #0#48, 1, "S";
         |CAMPO_MODIFICA #0#49, 1, "S";
         |CAMPO_MODIFICA #0#50, 1, "S";
         |CAMPO_MODIFICA #0#51, 1, "S";
         |CAMPO_MODIFICA #0#52, 1, "S";
         |CAMPO_MODIFICA #0#53, 1, "S";
         |CAMPO_MODIFICA #0#54, 1, "S";
         |CAMPO_MODIFICA #0#55, 1, "S";
         |CAMPO_MODIFICA #0#56, 1, "S";
         |CAMPO_MODIFICA #0#57, 1, "S";
         |CAMPO_MODIFICA #0#58, 1, "S";
         |CAMPO_MODIFICA #0#59, 1, "S";
         |CAMPO_MODIFICA #0#60, 1, "S";
         |CAMPO_MODIFICA #0#61, 1, "S";
         |CAMPO_MODIFICA #0#62, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Rellena;
     aAlfa = #0#16;
     |QBF aAlfa;
     aAlfa = ("00" + aAlfa) % -102;
     #0#16 = aAlfa;
     |PINTA #0#16;
|FPRC;

|PROCESO DesdeFuera;
     |SI nDesdeFuera=0;
          |SI aFuente!"";
               |CAMPO_MODIFICA #0#67,1,"N";
          |FINSI;

          |SI aTipoRecibo!"";
               |CAMPO_MODIFICA #0#68,1,"N";
          |FINSI;

          |SI aTipoImpresion!"";
               |CAMPO_MODIFICA #0#69,1,"N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PParametro; |TIPO 7;
     |SI #0#69 = "F";
          aParam1 = "PDF";
          aParam2 = PARAMETRO;
          aCadena1 = aParam2;
          aTipoImpresion = "I";
     |SINO;
          aCadena1 = PARAMETRO;
     |FINSI;
     |QBF aCadena1;
     |SI aCadena1="";
          nDesdeFuera=1;
     |HAZ DesdeFuera;
     |SINO;
          nDesdeFuera=0;

          aFuente=aCadena1 % 101;
          |SI aFuente!"M"; |Y aFuente!"H"; |Y aFuente!"A"; |Y aFuente!"T"; aFuente=""; |FINSI;

          aTipoRecibo=aCadena1 % 201;
          |SI aTipoRecibo!"N";|Y aTipoRecibo!"F";|Y aTipoRecibo!"P"; aTipoRecibo=""; |FINSI;

          aTipoImpresion=aCadena1 % 301;
          |SI aTipoImpresion!"I"; |Y aTipoImpresion!"P";|Y aTipoImpresion!"A"; aTipoImpresion=""; |FINSI;

          |SI aFuente="M"; |O aFuente="H"; |O aFuente="A"; |O aFuente = "T";
               #0#67=aFuente;
          |FINSI;
          |SI aTipoRecibo="N"; |O aTipoRecibo="F"; |O aTipoRecibo="P";
               #0#68=aTipoRecibo;
          |FINSI;
          |SI aTipoImpresion="I"; |O aTipoImpresion="P"; |O aTipoImpresion="A";
               #0#69=aTipoImpresion;
          |FINSI;

          |PINTA #0#67;
          |PINTA #0#68;
          |PINTA #0#69;

          |HAZ FuenteDatos;
          |HAZ TipoRecibo;
          |HAZ TipoImpresion;
          |HAZ DesdeFuera;
     |FINSI;
|FPRC;

|PROCESO FuenteDatos; |TIPO 0;
     |SI #0#67="M";
          aCadena1="MENSUAL  ";
          |CAMPO_MODIFICA #0#68,1,"S";
          |CAMPO_VISUAL #0#7,1,"N";

          |PINTA 0945,"Tipo de Recibo (0/2) :";
          |PINTA 0745,"Mes ...:       ";
          |PINTA #0#5;
          #0#10 = 0;
          |PINTA #0#10;
     |FINSI;

     |SI #0#67="H";
          aCadena1="HISTORICO";
          |CAMPO_MODIFICA #0#68,1,"S";
          |CAMPO_VISUAL #0#7,1,"N";

          |PINTA 0945,"Tipo de Recibo (0/2) :";
          |PINTA 0745,"Mes ...:       ";
          |PINTA #0#5;
          #0#10=0;
          |PINTA #0#10;
     |FINSI;

     |SI #0#67="A"; |O #0#67="T";
          aCadena1="ATRASOS  ";
          |CAMPO_MODIFICA #0#68,1,"N";
          |CAMPO_VISUAL #0#7,1,"S";
          |SI #0#67="T";
               |CAMPO_MODIFICA #0#69,1,"N";
          |FINSI;

          |PINTA 0945,"Tipo de Recibo (1/2) :";
          |PINTA 0745,"Meses .:   -  ";
          |PINTA #0#5;
          |PINTA #0#7;
          #0#68="N";
          |PINTA #0#68;
          #0#10=1;
          |PINTA #0#10;

          |CAMPO_MODIFICA #0#15, 1, "N";
          |CAMPO_VISUAL #0#15, 1, "N";
          |PINTA 2239, "³          ³";
     |FINSI;

     |SI #0#67="T";
          aCadena1="ATRA.HIS.";
          |CAMPO_MODIFICA #0#68,1,"N";
          |CAMPO_VISUAL #0#7,1,"S";

          |PINTA 0945,"Tipo de Recibo (1/2) :";
          |PINTA 0745,"Meses .:   -  ";
          |PINTA #0#5;
          |PINTA #0#7;
          #0#68="N";
          |PINTA #0#68;
          #0#10=1;
          |PINTA #0#10;
/*
          || ya no, lo coge de lo que se graba en los atrasos

          |CAMPO_MODIFICA #0#78, 1, "S";
          |CAMPO_VISUAL #0#78, 1, "S";
          #0#78 = #0#4;
          |PINTA 1144, "³A¤o de impresi¢n ....:";
          |PINTA #0#78;
*/
          |CAMPO_MODIFICA #0#16,1,"S";
          |CAMPO_VISUAL #0#16,1,"S";
          |PINTA 0771, "Tipo:";
          |PINTA #0#16;

          |CAMPO_MODIFICA #0#15, 1, "N";
          |CAMPO_VISUAL #0#15, 1, "N";
          |PINTA 2239, "³          ³";
     |FINSI;

     |ATRI I;
     |PINTA 0732,aCadena1;
     |ATRI 0;

     |HAZ TipoRecibo;
     |HAZ DesdeFuera;
|FPRC;

|PROCESO TipoRecibo; |TIPO 0;
     |SI #0#68="N";
          aCadena1="NOMINA   ";

          |CAMPO_MODIFICA #0#69,1,"S";
          |CAMPO_POSICION #0#10,1,0968;
          |CAMPO_POSICION #0#13,1,0971;
          |CAMPO_POSICION #0#14,1,0972;
          |CAMPO_VISUAL #0#10,1,"S";
          |CAMPO_VISUAL #0#13,1,"N";
          |CAMPO_VISUAL #0#14,1,"N";
          |PINTA #0#10;
     |FINSI;
     |SI #0#68="F";
          aCadena1="FINIQUITO";

          |PINTA 0945,"Propuesta/Finiquito .:";
          |CAMPO_MODIFICA #0#69,1,"N";
          |CAMPO_POSICION #0#10,1,0970;
          |CAMPO_POSICION #0#13,1,0968;
          |CAMPO_POSICION #0#14,1,0972;
          |CAMPO_VISUAL #0#10,1,"N";
          |CAMPO_VISUAL #0#13,1,"S";
          |CAMPO_VISUAL #0#14,1,"N";
          |PINTA #0#13;

          #0#69="I";
          |PINTA #0#69;
     |FINSI;

     |SI #0#68="P";
          aCadena1="PAGA     ";

          |PINTA 0945,"Desglosar Paga (S/N) :";
          |CAMPO_MODIFICA #0#69,1,"S";
          |CAMPO_POSICION #0#10,1,0970;
          |CAMPO_POSICION #0#13,1,0971;
          |CAMPO_POSICION #0#14,1,0968;
          |CAMPO_VISUAL #0#10,1,"N";
          |CAMPO_VISUAL #0#13,1,"N";
          |CAMPO_VISUAL #0#14,1,"S";
          |PINTA #0#14;
     |FINSI;

     |ATRI I;
     |PINTA 0832,aCadena1;
     |ATRI 0;

     |HAZ DesdeFuera;
|FPRC;

|PROCESO TipoImpresion;|TIPO 0;
     |SI #0#69="I"; |O #0#69="A"; |O #0#69 = "F";
          |SI #0#69="I";
               |SI #nomcontr#37 = "N";
                    aCadena1="IMPRESORA";
               |SINO;
                    aCadena1=" - PDF - ";
               |FINSI;
          |FINSI;
          |SI #0#69 = "A";
               aCadena1=" ABIERTA ";
          |FINSI;
          |CAMPO_VISUAL #0#0,0,alfa1;
          |SI alfa1="N";
               |PINTA 1302,"ÚÄ Seleccion salteada  ÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ¿";
               |PINTA 1402,"³     /     ³     /     ³     /     ³     /     ³     /     ³     /     ³";
               |PINTA 1502,"³     /     ³     /     ³     /     ³     /     ³     /     ³     /     ³";
               |PINTA 1602,"³     /     ³     /     ³     /     ³     /     ³     /     ³     /     ³";
               |PINTA 1702,"ÀÄÄÄÄÂÄ Seleccion desde/hasta ÄÄÄÄÄÄÁÄÄÄÄ¿ÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÙ";
                    |PINTA 1807,"ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄ´";
                    |PINTA 1907,"³         ³Empresa³Trabajador³Centro³";
                    |PINTA 2007,"³Desde ..:³       ³          ³      ³";
                    |PINTA 2107,"³Hasta ..:³       ³          ³      ³";
                    |PINTA 2207,"³Orden ..:                          ³";
                    |PINTA 2307,"ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";

               |ATRI R;
               |PINTA 1304," Seleccion salteada  ";
               |PINTA 1709," Seleccion desde/hasta ";
               |PINTA 1918,"Empresa";
               |PINTA 1926,"Trabajador";
               |PINTA 1937,"Centro";
               |ATRI 0;

               |PARA i=21;|SI i[62;|HACIENDO i=i+1;
                    |SI i!41;|Y i!62; |Y i!27; |Y i!48;|Y i!34; |Y i!55;
                         |CAMPO_VISUAL #0i,1,"S";
                         |PINTA #0i;
                    |FINSI;
               |SIGUE;

               |CAMPO_VISUAL #0#0,1,"S";
               |CAMPO_VISUAL #0#1,1,"S";
               |CAMPO_VISUAL #0#2,1,"S";
               |CAMPO_VISUAL #0#3,1,"S";
               |CAMPO_VISUAL #0#65,1,"S";
               |CAMPO_VISUAL #0#66,1,"S";
               |CAMPO_VISUAL #0#63,1,"S";

               |CAMPO_VISUAL #0#11,1,"N";
               |CAMPO_VISUAL #0#12,1,"N";

               |PINTA #0#0;
               |PINTA #0#1;
               |PINTA #0#2;
               |PINTA #0#3;
               |PINTA #0#65;
               |PINTA #0#66;
               |PINTA #0#63;
          |FINSI;
     |FINSI;
     |SI #0#69="P";
          |ERROR;
     /*
          aCadena1="PANTALLA ";
                    |PARA i=11;|SI i[23;|HACIENDO i=i+1;
                         |BLIN i;
                    |SIGUE;
                    |PARA i=21;|SI i[61;|HACIENDO i=i+1;
                         |CAMPO_VISUAL #0i,1,"N";
                    |SIGUE;
                    |PARA i=70;|SI i[77;|HACIENDO i=i+1;
                         |CAMPO_VISUAL #0i,1,"N";
                    |SIGUE;
                    |CAMPO_VISUAL #0#0,1,"N";
                    |CAMPO_VISUAL #0#1,1,"N";
                    |CAMPO_VISUAL #0#2,1,"N";
                    |CAMPO_VISUAL #0#3,1,"N";
                    |CAMPO_VISUAL #0#65,1,"N";
                    |CAMPO_VISUAL #0#66,1,"N";
                    |CAMPO_VISUAL #0#63,1,"N";
                    |CAMPO_MODIFICA #0#15,1,"N";
                    |CAMPO_VISUAL #0#15,1,"N";


                    |PINTA 1144,"ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ"
                    |PINTA 1230,"ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿";
                    |PINTA 1330,"³ Empresa ....:       ³";
                    |PINTA 1430,"³ Trabajador .:       ³";
                    |PINTA 1530,"ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";

                    |ATRI R;
                    |PINTA 1236," Seleccion ";
                    |ATRI 0;

                    #0#11=1;
                    #0#12=1;
                    |CAMPO_VISUAL #0#11,1,"S";
                    |CAMPO_VISUAL #0#12,1,"S";
                    |PINTA #0#11;
                    |PINTA #0#12;
          */
     |FINSI;

     |ATRI I;
     |PINTA 0932,aCadena1;
     |ATRI 0;
|FPRC;

|PROCESO MensaOrden; |TIPO 7;
     |SI #0#69 = "A";
          |MENSA "    1. por codigo; 2. por nombre";
     |SINO;
          |MENSA "    1.codigo; 2.nombre; 3-area.secccion; 4.centro trabajo; 5.TC2; 6.Nom.Emp-Tra."
     |FINSI;
|FPRC;

|PROCESO MensajeTipoRec; |TIPO 7;
     |SI #0#67="M";
           |MENSA "0000Entre: (0) nomina mensual; (2) nomina finiquito";
     |FINSI;
     |SI #0#67="H";
           |MENSA "0000Entre: (0) mensual; (2) finiquito; (5 - 20) atrasos";
     |FINSI;
     |SI #0#67="A"; |O #0#67 = "T";
           |MENSA "0000Entre: (1) recibos separados por meses; (2) recibos refundidos en uno";
     |FINSI;
|FPRC;

|PROCESO MiraTipoRec;|TIPO 0;
     |SI #0#67="M";
          |SI #0#10!0; |Y #0#10!2;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI #0#67="H";
          |SI #0#10=1;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI #0#67="A"; |O #0#67="T";
          |SI #0#10!1; |Y #0#10!2;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI #0#67="T";
          |SI #0#10!1; |Y #0#10!2;
               |MENAV "0000Tipo de Recibo no valido!";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AnyoDefecto; |TIPO 7; ||calcula el periodo por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -102;
    #0Campo = alfa1;
    |PINTA #0Campo;
|FPRC;

|PROCESO MiraTopeMes; |TIPO 0;
         nume1 = anyo $ 4;
     |SI nume1 = 0;
             bisiesto = 1;
     |SINO;
             bisiesto = 0;
     |FINSI;

     |SI #0#5 =  1;  p_mes = "ENERO     ";  topemes = 31;  |FINSI;
     |SI #0#5 =  2;  p_mes = "FEBRERO   ";  topemes = 28 + bisiesto;  |FINSI;
     |SI #0#5 =  3;  p_mes = "MARZO     ";  topemes = 31;  |FINSI;
     |SI #0#5 =  4;  p_mes = "ABRIL     ";  topemes = 30;  |FINSI;
     |SI #0#5 =  5;  p_mes = "MAYO      ";  topemes = 31;  |FINSI;
     |SI #0#5 =  6;  p_mes = "JUNIO     ";  topemes = 30;  |FINSI;
     |SI #0#5 =  7;  p_mes = "JULIO     ";  topemes = 31;  |FINSI;
     |SI #0#5 =  8;  p_mes = "AGOSTO    ";  topemes = 31;  |FINSI;
     |SI #0#5 =  9;  p_mes = "SEPTIEMBRE";  topemes = 30;  |FINSI;
     |SI #0#5 = 10;  p_mes = "OCTUBRE   ";  topemes = 31;  |FINSI;
     |SI #0#5 = 11;  p_mes = "NOVIEMBRE ";  topemes = 30;  |FINSI;
     |SI #0#5 = 12;  p_mes = "DICIEMBRE ";  topemes = 31;  |FINSI;
|FPRC;

|PROCESO Mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
     |SI #0#67!"A";
         fecsys = ~;
         alfa1 = fecsys;
         alfa1 = alfa1 % 402;
         #0Campo = alfa1;
         |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO Finalmes; |TIPO 7;
     |SI #0#67 = "A"; |O #0#67 = "T";
          |ACABA;
     |FINSI;

    |SI #0#4 < 80;
             anyo = #0#4 + 2000;
    |SINO;
             anyo = #0#4 + 1900;
    |FINSI;

    alfa1 = anyo;                                               || anyo
    |HAZ MiraTopeMes;
    alfa2 = topemes;                                            || dia

    alfa3 = #0#5;  alfa3 = "00" + alfa3;  alfa3 = alfa3 % -102; || mes

    alfa1 = alfa2 + "." + alfa3 + "." + alfa1;                  || fecha entera
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;


/*****************************************************************/
/*  PROCESO PRINCIPAL                                            */
/*****************************************************************/
|PROCESO CrearRecibo; |TIPO 3;
     |SI #nomcontr#37 = "S"; |Y #0#69 = "I";
          aParam1 = "PDF";
          aParam2 = PARAMETRO;
          aCadena1 = aParam2;
          aTipoImpresion = "I";
          #0#69 = "I";
          aProcedencia = "nomrecib";
          |HAZ ImpresionPDF;
     |SINO;
          |HAZ principal;
     |FINSI;
|FPRC;

|PROCESO principal;
     /* NOMINAS IMPRESORA */
     |SI #0#67="M"; |Y #0#68="N"; |Y #0#69="I";
          runnom = "nomyreci";
          acum=1;
          |HAZ impreMNI;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreMNI;
          |FINSI;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="N"; |Y #0#69="I";
          runnom = "nomwreci";
          acum=0;
          |HAZ impreHNI;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreHNI;
          |FINSI;
     |FINSI;
     |SI #0#67="A"; |Y #0#69="I";
          runnom = "nomsreci";
          acum=0;
          |HAZ impreAI;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreAI;
          |FINSI;
     |FINSI;
     |SI #0#67="T"; |Y #0#69="I";
          runnom = "nomsreci";
          acum=0;
          |HAZ impreTI;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreTI;
          |FINSI;
     |FINSI;

     /* NOMINAS PANTALLA */
     /*
     |SI #0#67="M"; |Y #0#68="N"; |Y #0#69="P";
          ||HAZ impreMNP;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="N"; |Y #0#69="P";
          ||HAZ impreHNP;
     |FINSI;
     |SI #0#67="A"; |Y #0#68="N"; |Y #0#69="P";
          ||HAZ impreANP;
     |FINSI;
     |SI #0#67="T"; |Y #0#68="N"; |Y #0#69="P";
          ||HAZ impreANP;
     |FINSI;
     */
     /* NOMINAS ABIERTA */
     |SI #0#67="M"; |Y #0#68="N"; |Y #0#69="A";
          |HAZ impreMNA;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreMNA;
          |FINSI;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="N"; |Y #0#69="A";
          |HAZ impreHNA;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreHNA;
          |FINSI;
     |FINSI;
     |SI #0#67="A"; |Y #0#68="N"; |Y #0#69="A";
          |HAZ impreANA;
     |FINSI;
     |SI #0#67="T"; |Y #0#68="N"; |Y #0#69="A";
          enTipoAt = #0#16;
          |HAZ impreTNA;
     |FINSI;

     /* CARTA FINIQUITO */
     |SI #0#67="M"; |Y #0#68="F";
          #0#10=2;
          runnom="nomycalf";
          |HAZ impreMF;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreMF;
          |FINSI;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="F";
          #0#10=2;
          runnom="nomwcalf";
          |HAZ impreHF;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreHF;
          |FINSI;
     |FINSI;

     /* PAGAS IMPRESORA */
     |SI #0#67="M"; |Y #0#68="P"; |Y #0#69="I";
          |HAZ impreMPI;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreMPI;
          |FINSI;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="P"; |Y #0#69="I";
          |HAZ impreHPI;
          |SI swPasada = 1;
               swPasada = 2;
               swStopIRPF = 0;
               |HAZ impreHPI;
          |FINSI;
     |FINSI;


     /* PAGAS PANTALLA */
     /*
     |SI #0#67="M"; |Y #0#68="P"; |Y #0#69="P";
          |HAZ impreMPP;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="P"; |Y #0#69="P";
          |HAZ impreHPP;
     |FINSI;
     */
     /* PAGAS ABIERTA */
     |SI #0#67="M"; |Y #0#68="P"; |Y #0#69="A";
          |HAZ impreMPA;
     |FINSI;
     |SI #0#67="H"; |Y #0#68="P"; |Y #0#69="A";
          |HAZ impreHPA;
     |FINSI;
|FPRC;

|PROCESO FechaRecibi;
     |SI #0#4 < 80;
          anyo = #0#4 + 2000;
     |SINO;
          anyo = #0#4 + 1900;
     |FINSI;

     alfa1 = anyo;            || anyo
     |HAZ MiraTopeMes;
     alfa2 = topemes;         || dia

     alfa3 = #0#5;
     alfa3 = "00" + alfa3;
     alfa3 = alfa3 % -102;    || mes

     alfa1 = alfa2 + "." + alfa3 + "." + alfa1;      || fecha entera
     #0#6  = alfa1;
|FPRC;

-------------------------------------------------------------------------------
                    ||   PROCESOS COMUNES

|PROCESO prepara_impresion;
     aDir = "/tmp/";
     Impresora = aDir + Usuario;
     |PINTA 2001, Usuario;
     |PINTA 2101, Impresora;
     |IMPRE -77;
     |PINTA 2201, FSalida;
     |SI FSalida ! 0;
          nErrorInf = 1;
     |FINSI;
     aAlfa = "chmod 777 " + Impresora;;
     |SYSTEM aAlfa;
|FPRC;

|PROCESO traete_fichero;
     |FINIMP;
     cOrigen = aDir + Usuario;
     cDestino = aDirDes;
     |QBF cDestino;
     aArchivo = aArchivo - ".txt";
     cDestino = cDestino + aArchivo;
     |COPIA_FICHERO cOrigen, cDestino;
     |SI FSalida ! 0;
          nErrorInf = 0;
     |FINSI;
     aAlfa = "chmod 777 " + cDestino;
     |SYSTEM aAlfa;
|FPRC;

|PROCESO ConviertePdf;
     |DBASS aBaseBin;  |QBF aBaseBin;
     aBaseBin = aBaseBin + "bin/topdf.sh ";

     aSystem = aBaseBin + cDestino;
     |SYSTEM aSystem;

     aSystem = "chmod 777 " + cDestino + ".pdf";
     |SYSTEM aSystem;

     |FBORRA cDestino;

     ||SI #0#6 = "S";  |HAZ AlaWeb;  |FINSI;
     ||SI #0#5 = "S";  |HAZ Correo;  |FINSI;

     ||FBORRA aPdf;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO LeeParam;
     |DBASS aRutaDes;
     |DBASS aRutaDatos;
     |QBF aRutaDes;
     |QBF aRutaDatos;
     aRutaDes = aRutaDes + "dsnetcom/def/dsnetm00.mas";
     |CARGA_DEF aRutaDes, dsnetm00@;
     |SI FSalida ! 0;
          |MENAV "    Error en CARGADEF: dsnetm00";
     |SINO;
          aRutaDatos = aRutaDatos + "dsnetcom/fich/";
          |PATH_DAT #150 aRutaDatos;
          |ABRE #150;
          |LEE 000#150p;
          |SI FSalida = 0;
               aDirDes = #150#7;
               aDirOri = aDirDes;
               eaWebDirDes = aDirDes;
               aDirOri = aDirDes;
          |SINO;
               |MENAV "    Error de datos en fichero de configuracion dsnetm00";
          |FINSI;
          |CIERRA #150;
     |FINSI;
     |DESCARGA_DEF #dsnetm00@;
|FPRC;

|PROCESO LeeOrigen;

     aArchivo = PARAMETRO;
     |QBF aDirOri;
     aRuta = aDirOri + aArchivo;

     |XABRE "U", aRuta, nCanal;
     |SI FSalida ] 0;
          |XLEE nCanal, 100, aCabecera;
          |XLEE nCanal,   5, aTipoNomina;
          |XLEE nCanal,  10, aEmpresa;
          |XLEE nCanal,  10, aTrabajadorDesde;
          |XLEE nCanal,  10, aTrabajadorHasta;
          |XLEE nCanal,  10, aMesDesde;
          |XLEE nCanal,  10, aMesHasta;
          |XLEE nCanal,  10, aAny;
          |XLEE nCanal,   5, aOrdenacion;
          |XLEE nCanal,   5, aDireccion;
          |XLEE nCanal,   5, aTipoAtrasos;
          |XLEE nCanal, 100, aRutaPDFWeb;
     |FINSI;
     |XCIERRA nCanal;
     |QBF aCabecera;
     |QBF aTipoNomina;
     |QBF aEmpresa;
     |QBF aTrabajadorDesde;
     |QBF aTrabajadorHasta;
     |QBF aMesDesde;
     |QBF aMesHasta;
     |QBF aAny;
     |QBF aOrdenacion;
     |QBF aDireccion;
     |QBF aTipoAtrasos;
     |QBF aRutaPDFWeb;
     nEmpresa = aEmpresa;
     nTrabajadorDesde = aTrabajadorDesde;
     nTrabajadorHasta = aTrabajadorHasta;
     nMesDesde = aMesDesde;
     nMesHasta = aMesHasta;
     nAny = aAny;
     nOrdenacion = aOrdenacion;
     nDireccion  = aDireccion;
     eaWebDirPDF = aRutaPDFWeb + "/pdf/";
|FPRC;

|PROCESO PasaParametros;
     #0#0 = nEmpresa;
     #0#1 = nEmpresa;
     #0#2 = nTrabajadorDesde;
     #0#3 = nTrabajadorHasta;
     |SI nAny ] 2000;
          #0#4 = nAny - 2000;
     |SINO;
          #0#4 = nAny - 1900;
     |FINSI;
     #0#5 = nMesDesde;
     |HAZ FechaRecibi;
     #0#7 = nMesHasta;
     #0#9 = nDireccion;      || direccion a imprimir
     |SI aTipoNomina = "M"; |O aTipoNomina = "P";
          #0#10 = 0;
     |FINSI;
     |SI aTipoNomina = "F";
          #0#10 = 2;
     |FINSI;
     |SI aTipoNomina = "A";
          #0#10 = 5;
     |FINSI;
     #0#63 = nOrdenacion;
     #0#65 =  1;              || desde centro
     #0#66 = 99;              || hasta centro
     #0#67 = "H";             || fuente de datos
     |SI aTipoNomina = "M"; |O aTipoNomina = "F";
          #0#68 = "N";
     |SINO;
          #0#68 = aTipoNomina;
     |FINSI;
     ||#0#69 = "I";             || Tipo de Impresion
     #0#69 = "A";             || Tipo de Impresion (abierta)
     #0#70 = "EUROS  ";
     PARAMETRO = "H" + #0#68 + "I";
|FPRC;

|PROCESO ImpresionPDF;
     |SI aParam1 ! "PDF";
          aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
          |NOME_DAT #200 aAlfa1;
          |DELINDEX #pdfimtmp;
          |ABRE #pdfimtmp;
          |ABRE #pdfdocca;
          |ABRE #pdfdocli;

          swCopia = 1;
          |HAZ principal;
          |HAZ BuscaArchivo;     ||asigna a aArchivo el nombre del pdf
          |HAZ CargaTemporal;    ||mira a ver si esta el pdf en el mantenimiento
          ||BUCLE GrabaTemporal;
          |SI PARAMETRO = "HFI";
               |HAZ CargaFiniq;
          |SINO;
               |HAZ CargaCampos;
          |FINSI;

          |CIERRA #pdfimtmp;
          |CIERRA #pdfdocca;
          |CIERRA #pdfdocli;
          |SUB_EJECUTA "pdfgraba";
          |SUB_EJECUTA "pdfimpre";
     |SINO;
          swPDFMasivo = 1;
          |HAZ principal;
          |HAZ ImprimePDF;
     |FINSI;
|FPRC;

|PROCESO ImprimePDF;
     |SUB_EJECUTA "pdfimpre";
|FPRC;

/************************ FIN PROCESOS IMPRESION EN PDF *********************/

|PROCESO ParamAUTO;
     #0#0 = nEmpAUTO;
     #0#1 = nEmpAUTO;
     #0#2 = nTraAUTO;
     #0#3 = nTraAUTO;
     #0#4 = nAnyAUTO - 2000;
     #0#5 = nMesAUTO;
     ||HAZ FechaRecibi;
     #0#7 = nMesAUTO;
     || #0#9 = nDireccion;      || direccion a imprimir
     #0#10 = nTipAUTO;               || tipo de nomina
     #0#63 =  1;
     #0#65 =  1;              || desde centro
     #0#66 = 99;              || hasta centro
     #0#67 = "M";             || fuente de datos
     |SI nTipAUTO = 0;
          #0#68 = "N";             || tipo de nomina
          PARAMETRO = "MNI";
          |ABRE #nomcont1; |LEE 000#nomcont1.=; |CIERRA #nomcont1;
          |SI #nomcont1#9  = 006554;
               PARAMETRO = "MNA";
          |FINSI;
     |FINSI;
     |SI nTipAUTO = 2;
          |ABRE #labempre;
          #labempre#0 = nEmpAUTO;
          |LEE 000#labempre.=;
          |CIERRA #labempre;
          |SI #labempre#39 = 2;
               #0#68 = "N";             || tipo de nomina
               PARAMETRO = "MNI";
          |SINO;
               #0#68 = "F";             || tipo de nomina
               PARAMETRO = "MFI";
          |FINSI;
     |FINSI;
     #0#69 = "I";             || Tipo de Impresion (impresora) (Crystal)
     |SI nTipAUTO = 0;
          |SI #nomcont1#9  = 006554;
               #0#69 = "A";   || Natasha ETT, nomina abierta
          |FINSI;
     |FINSI;
     #0#70 = "EUROS  ";
|FPRC;

|PROCESO TraeLogos;
     |DBASE aBase;
     |QBF aBase;
     aOrigen = aBase + "documentos/logos.tgz";
     |XABRE "E", aOrigen, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     swAcaba = 0;
     aAlfa = "C:\DOCUMENTOS\NOMLOGOS\logos.mdb";
     |XABRE "CE", aAlfa, nHandle;
     |SI FSalida ] 0;
          || ya tengo el logos.mdb en c:\documentos\nomlogos

          |SI #nomcont1#9 = 0;
               || no actualices si ya tienes el ficheros y no usas logos
               || swAcaba = 1;
          |FINSI;
          |SI #nomcont1#9 ! 98;
               || no actualices en todos los clientes, solo los que active
               || aqui, que en algunos tarda mucho
               swAcaba = 1;
          |FINSI;
          || OJO,  si hay una actualizacion de estructura de tabla o algo asi
          || hay que poner que actualice siempre, cuidado

          |SI swAcaba = 1;
               |XCIERRA nHandle;
               |ACABA;
          |FINSI;

     |FINSI;

     aDirLocal = "C:\DOCUMENTOS\NOMLOGOS\";
     |RMKDIR aDirLocal;
     aOrigen = aBase + "documentos/logos.mdb";
     aDestino = aDirLocal + "logos.mdb";

     || aDestino = aDirLocal + "logos.tgz";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor; |O aDocRemoto = "";
          |RFBORRA aDestino;

          aIPRemoto = "";
          |IP_REMOTO aIPRemoto; |QBT aIPRemoto;

          |CUADRO 05031177;
                    ||  0    1         2         3         4         5         6         7
                    ||  56789012345678901234567890123456789012345678901234567890123456789012345
          |PINTA 0605, "             ACTUALIZACION DEL FORMATO DEL RECIBO DE NOMINA             ";
          |PINTA 0705, "    Este proceso tardar  unos segundos y se realizar  una vez en cada   ";
          |PINTA 0805, "  puesto de trabajo. No cierre esta ventana hasta que no se complete el ";
          |PINTA 0905, " proceso. Aunque la barra de progreso se detenga, se est  realizando la ";
          |PINTA 1005, "                     actualizaci¢n en segundo plano.                    ";

          aOrigen = aBase + "documentos/logos.tgz";
          aDestino = aDirLocal + "logos.tgz";

          |SI aIPRemoto ! "";
               |ENVIA_FICHERO aOrigen, aDestino;
          |SINO;
               |COPIA_FICHERO aOrigen, aDestino;
          |FINSI;

          aFicheroTgz = "logos.tgz"
          aFicheroTar = "logos.tar"
          aRutaDestino = aDirLocal;

          aAlfa = aDestino;
          |RDESCOMPRIME aAlfa;

          |PARA;  |SI;  |HACIENDO;
               aAbre = aRutaDestino + aFicheroTar;
               |XABRE "EC", aAbre, nHandleTgz;
               |SI FSalida ] 0;  |SAL;  |FINSI;

               |PULSATECLA;
          |SIGUE;

          |RDETAR aAbre, aRutaDestino;

          |PARA;  |SI;  |HACIENDO;
               aAbre = aDirLocal + "logos.mdb";
               |XABRE "EC", aAbre, nHandleTgz;
               |SI FSalida ] 0;  |SAL;  |FINSI;

               |PULSATECLA;
          |SIGUE;

          aAlfa = aDirLocal + "logos.tgz";
          |RFBORRA aAlfa;
          aAlfa = aDirLocal + "logos.tar";
          |RFBORRA aAlfa;

          |CLS;
     |FINSI;
|FPRC;

|PROGRAMA;
     eaMensaCad = "9";
     |HAZ ControlCaducidad;
     |SI enErrorCad = 1;
         |ACABA;
     |FINSI;

     runnom = "nomyreci";
     aParam = PARAMETRO;
     aParam1 = PARAMETRO;
     aParam2 = PARAMETRO;
     |QBF aParam;
     |QBF aParam1;
     |QBF aParam2;
     aParam1 = aParam1 % 103;
     aParam2 = aParam2 % -103;
     |SI aParam2 = "IPI"; |O aParam2 = "API"; |O aParam2 = "PPI";
          PARAMETRO = PARAMETRO - "PI";
     |FINSI;
     aLongitud = PARAMETRO % 0;
     nLongitud = aLongitud;

     |ABRE #nomcontr;
     |LEE 000#nomcontr.p;
     |CIERRA #nomcontr;

     |ABRE #nomcont1;
     |LEE 000#nomcont1.p;
     |SI FSalida ! 0;
          |DDEFECTO #nomcont1;
     |FINSI;
     |SI enSwSimulacion ] 1; #nomcont1#8 = "S"; |FINSI;
     |CIERRA #nomcont1;

     |ABRE #nomcont3;
     |LEE 000#nomcont3.p;
     |SI FSalida ! 0;
          |DDEFECTO #nomcont3;
     |FINSI;
     |CIERRA #nomcont3;

     |HAZ TraeLogos;

     |SI aParam = "AUTO";
          |HAZ ParamAUTO;
          |HAZ principal;
          |ACABA;
     |FINSI;
     |SI aParam = "CMSB";
          || xxxxxxxxxx
          |DBASE aPath;
          aDef = aPath + "/def/cmsb0001";
          aFic = aPath + "/fich/";
          |CARGA_DEF aDef, copiadef@;
          |SI FSalida = 0;
               |ABRE #500;
               |LEE 000#500.p;

               |PARA nCampo = 0; |SI nCampo [ 77; |HACIENDO nCampo = nCampo + 1;
                    |SI nCampo ! 5;
                         #0nCampo = #500nCampo;
                    |FINSI;
               |SIGUE;

               |PARA nMes = 1; |SI nMes [ 12; |HACIENDO nMes = nMes + 1;
                    nCampoMes = nMes + 78;
                    |SI #500nCampoMes = "X";
                         #0#5 = nMes;
                         |SI #0#69 = "E"; |Y swEmailDirecto = 0;
                              swImpDirecto = 0;
                              swEmailDirecto = 1;
                              #0#69 = "I";
                         |SINO;
                              swImpDirecto = 1;
                              swEmailDirecto = 0;
                         |FINSI;

                         |SI #0#67 = "T";
                              #0#67 = "H";
                         |FINSI;

                         PARAMETRO = #0#67 + #0#68 + #0#69;
                         eaVengoDe = "nomrecib";
                         |HAZ MiraSiArchiva;
                         |HAZ principal
                    |FINSI;
               |SIGUE;

               |CIERRA #500;
               |DESCARGA_DEF #copiadef@;
          |SINO;
               aAlfa = "    Error en CARGA_DEF: " + aPath;
               |MENAV aAlfa;
          |FINSI;

          |ACABA;
     |FINSI;
     |SI aParam2 = "COM";
          swComercio = 1;
     |FINSI;
     |SI nLongitud > 3; |Y aParam1 ! "PDF"; |Y swComercio ! 1;
          |HAZ LeeParam;
          |HAZ LeeOrigen;
          eaWebArchivo = PARAMETRO;
          |SI aTipoNomina = "A";
               aParametro = PARAMETRO;
               |SUB_EJECUTA "nomareci";
               |ACABA;
          |FINSI;
          |HAZ PasaParametros;
          swDesdeWeb = 1;
          enWeb = 1;
          |HAZ ImpresionPDF;
     |SINO;
          eaVengoDe = "nomrecib";
          |HAZ MiraSiArchiva;
          |CLS;
          |CABEZA "EMISION DE RECIBOS DE NOMINA";
          |PINPA #0#0;
          |PINDA #0#0;
          swDesdeWeb = 0;
          |ENDATOS #1#0;
     |FINSI;
|FPRO;
