|FICHEROS;
     labempre #1;   || empresas
     nomconst #3;   || constantes
     nomtrtc1 #7;   || campos de impresion
     labcentr #10;  || centros de trabajo
     nomcenes #13;  || centros 18/93
     nomtstc1 #14;  || tmp. para importes TC1
     || nomcones #15;  || constante especial 18/93
     silcon06 #30;  || datos AGIRED
     nomnotay #36;  || centros notarias ayuntamientos
     labtraba;      || maestro de trabajadores
     nomtraca;      || para buscar la cte por trabajador
     nomtepcd;
     nomwepcd;
     nomepigr;
     ref00001@ #1001;
     nompluba;
     tsilco13;
     nomssfan;
|FIN;

|VARIABLES;
     sgdonum = 0;
     total = 0;
     cont = 0;
     epi = 0;
     trab = 0;
     ilt = 0;
     ims = 0;
     bas = 0;
     imp1 = 0;
     imp2 = 0;
     ini = 0;
     x = 0;
     postal1 = "";   || Codigo postal1 alfa
     postal2 = "";   || Codigo postal2 alfa
     domi    = "";   || Variable para quitar espacios al domicilio
     afili   = "";   || Variable para quitar espacios al nro. de afiliacion
     sgdoalf = "";   || Variable para quitar espacios al nro. de afiliacion
     fecsys = @;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume0 = 0;
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     para1 = 0;
     para2 = 0;
     p_mes = "";
     desde = 0;
     hasta = 0;
     seleccio = 0;
     seleccio1 = 0;
     seleccio2 = 0;
     tip = 0;
     tip2 = 0;
     tip3 = 0;
     siono_cen = "";
     el_period = 0;
     runnom = "";
     notaria = 0;
     emp_ant = -1;
     cen_ant = -1;
     hay_algo = 0;
     &silcon1 = "";
     &silcon2 = "";
     &silcon3 = "";
     &apelli = "";
     &clave_IE = "";
     liqu = "";
     cc64 = 0;
     cc65 = 0;
     por_dfp = 0;
     por_mat = 0;
     nEl36 = 36;
     nBase36 = 0;
     bon_162001 = 0;
     nCuota_mater = 0;
     &EURODB = 0;
     nDS = 0;
     nFG = 0;
     nFP = 0;
     swCte = 0;
     nCteAnt = 0;
     nFPEmp = 0;
     nFPTra = 0;
     nContEmp = 0;
     swHaEntrado = 0;
     &aVengoDe = "";
     fFecha1 = @;
     fFecha2 = @;
     aAlfa = "";
     &fCFecha = @;
     &nCConst = 0;
     &aCError = "";

     nBase = 0;
     nCuotaTot = 0;
     nCuota = 0;
     nAntPorc = 0;
     nAnyo = 0;
     nILTERE = 0;
     nIMSERE = 0;
     nBaseERE = 0;
     nBaseEREDes = 0;
     swElPrimero = 0;
     nExcFog = 0;
     nPorDS = 0;
     nAntPorDS = 0;
     &swModulo = 0;
     aContEsp = "";
     n106BomPor = 0;
     n121BomPor = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aFecha = "";
     fFecha = @;
     &nEnEmpresa = 0;
    nCuotaFogTot = 0;
    nCuotaFog = 0;
    nPintaPorc = 0;
    nPorFOGASA = 0;
     nBaseFog = 0;
     nEmp = 0;
     nTra = 0;
     nBaseFogPlu = 0;
     nTotalSSEmp = 0;
     aCCC = "";
     s_any = 0;
     s_mes = 0;
|FIN;

|PROCESO SiBomberos;
     aContEsp = "N";
     n106BomPor = 0;
     n121BomPor = 0;
     |SI swModulo = 3145;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/bomb0001.mas";
          |CARGA_DEF aAlfa, ref00001@;
          |SI FSalida = 0;
               |ABRE #1001;
               #1001#0 = #2#0;                || empresa
               #1001#1 = #2#18;               || centro;
               |LEE 000#1001=;
               |SI FSalida = 0;
                    aContEsp = #1001#2;
               |FINSI;
               |CIERRA #1001;
          |FINSI;
          |DESCARGA_DEF #ref00001@;
          |SI aContEsp ! "S";
               |ACABA;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/bomb0003.mas";
          |CARGA_DEF aAlfa , ref00001@;
          |SI FSalida = 0;
               aAlfa1 = #0#2; aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
               aAlfa2 = #0#3;
               aFecha = "01" + "." + aAlfa1 + "." + aAlfa2;
               fFecha = aFecha;
               |ABRE #1001;
               #1001#0 = fFecha;
               |LEE 000#1001];
               |SI FSalida = 0;
                    |SI fFecha ! #1001#0;
                         |LEE 000#1001a;
                    |FINSI;
               |SINO;
                    |LEE 000#1001u;
               |FINSI;
               |CIERRA #1001;
               |SI FSalida = 0; |Y fFecha ] #1001#0;
                    n106BomPor = #1001#1;
                    n121BomPor = #1001#2;
               |SINO;
                    aAlfa = "    No se han definido los % de Cotizacion Especial ";
                    aAlfa = aAlfa + "ni Contingencias Excluidas.";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #ref00001@;
     |FINSI;
     |SI aContEsp = "S";
          #7#146 = 8;
          #7#112 = #7#112 + #2#3;                      || base 106
          #7#114 = n106BomPor;                         || (%) 106
          #7#113 = #7#113 + (#2#3 % n106BomPor);       || cuota 106

          #7#110 = n121BomPor;                         || (%) 121
          #7#111 = ((#7#16 + #7#25) % #7#110) ! EURODB;|| cuota 121
     |FINSI;
|FPRC;

|PROCESO labtrabaNIF;
     |SI #labtraba#204 ! " ";
          #7#128 = #labtraba#204;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE labtrabaNIF;
     #labtraba#2;
     0, 44;
     #2#24, #2#0, "A";
     #2#24, #2#0, "A";
     ;
     NULL, labtrabaNIF;
|FIN;

|PROCESO nomssfan;
     nTotalSSEmp = nTotalSSEmp + #nomssfan#9;
|FPRC;

|DEFBUCLE nomssfan;
     #nomssfan#2;
     ;
     aCCC, s_any, s_mes, 00;
     aCCC, s_any, s_mes, 00;
     ;
     NULL, nomssfan
|FIN;

|PROCESO SegSocEmp;
     aAlfa1 = #7#1; |QBF aAlfa1;
     aAlfa2 = #7#2; |QBT aAlfa2; aAlfa2 = aAlfa2 % 8;
     aAlfa3 = #7#3; |QBF aAlfa3;

     aCCC = "0111" + aAlfa1 + aAlfa2 + aAlfa3;
     s_mes = #0#2;
     |SI runnom = "nomwwtc1";
          s_any = #0#3 + 2000;
     |SINO;
          s_any = #0#3;
     |FINSI;

     nTotalSSEmp = 0;

     |BUCLE nomssfan;

     |SI nTotalSSEmp < 0;
          |SI #2#98 > 0;
               #2#98 = #2#98 + nTotalSSEmp;
          |FINSI;
     |FINSI;
|FPRC;

||____________________________________/ PREPARACION DEL TC1
|PROCESO tc1;
     |SI runnom = "nomyytc1";  notaria = #2#16;  |FINSI;
     |SI runnom = "nomwwtc1";  notaria = #2#19;  |FINSI;

     #7#0 = #1#2;

     |SI siono_cen = "N";   afili = #1#13;   |FINSI;
     |SI siono_cen = "S";   afili = #10#10;  |FINSI;
     |QBF afili;
     sgdoalf = afili % 0;
     sgdonum = sgdoalf;
     sgdonum = sgdonum - 4;
     sgdonum = sgdonum + 300;
     #7#1 = afili % 102;
     #7#2 = afili % sgdonum;
     #7#3 = afili % -102;

     |SI tip = 0; |O tip = 2;
          |SI siono_cen = "S";               || DATOS CENTRO
               domi = #10#3;
               |QBF domi;
               #7#4 = domi+" "+#10#4+" "+#10#5;
               postal1 =  "00" + #10#7;
               postal1 = postal1 % -102;
               postal2 = "000" + #10#8;
               postal2 = postal2 % -103;
               #7#5 = " " + postal1 + postal2 + " " + #10#6;
               #7#6 = #10#9;
               #7#9 = #10#14;
               #7#10 = #10#13;
          |SINO;                             || DATOS EMPRESA
               domi = #1#3;
               |QBF domi;
               #7#4 = domi+" "+#1#4+" "+#1#5;
               postal1 = "00" + #1#7;
               postal1 = postal1 % -102;
               postal2 = "000" + #1#8;
               postal2 = postal2 % -103;
               #7#5 = " " + postal1 + postal2 + " " + #1#6;
               #7#6 = #1#9;
               #7#9 = #1#20;
               #7#10 = #1#19;
          |FINSI;
     |SINO;
          |HAZ cen_esp;                      || DATOS CENTRO ESPECIAL
          domi = #13#3;
          |QBF domi;
          #7#4 = domi+" "+#13#4+" "+#13#5;
          postal1 =  "00" + #13#7;
          postal1 = postal1 % -102;
          postal2 = "000" + #13#8;
          postal2 = postal2 % -103;
          #7#5 = " " + postal1 + postal2 + " " + #13#6;
          #7#6 = #13#9;                      || provincia
          #7#9 = #13#15;                     || entidad
          #7#10 = #13#14;                    || clave entidad
     |FINSI;

     |HAZ mes;
     alfa1 = #0#3;
     alfa1 = alfa1;
     #7#8 = alfa1;                           || a¤o hasta (TC1/92)
|SI runnom = "nomwwtc1"; #7#8 = #7#8 + 2000; |FINSI;
     #7#11 = #1#12;                          || actividad empresa
     #7#12 = #1#11;                          || clave actividad
     #7#13 = #1#10;                          || CIF empresa
     |HAZ clave_IE;
     |SI tip = 0; |O tip = 2;
          #7#14 = #7#14 + #2#3;              || conting.comunes
          #7#15 = #3#6 + #3#7;
          #7#16 = #7#14 % #7#15;

          #7#23 = #7#23 + #2#4;              || conting.comunes coef.red.
          #7#24 = #3#6;
          #7#25 = #7#23 % #7#24;
     |FINSI;

     |SI tip = 9;
     /*
          |SI liqu = "T";
               cc64 = ((#3#6 * #15#21)!2) + ((#3#7 * #15#21)!2);
               cc65 = ((#3#6 * #15#22)!2) + ((#3#7 * #15#22)!2);
          |FINSI;
          |SI liqu = "O";
               cc64 = (#3#7 * #15#21) ! 2;
               cc65 = (#3#7 * #15#22) ! 2;
          |FINSI;
          |SI liqu = "P";
               cc64 = (#3#6 * #15#21) ! 2;
               cc65 = (#3#6 * #15#22) ! 2;
          |FINSI;
     */
          #7#14 = #7#14 + (#2#48 + #2#49);     || Contingencias comunes
          |SI #7#16 = 0;
               |SI #2#48 ! 0;|Y #2#49 ! 0;
                    #7#15 = 0;
               |SINO;
                    |SI #2#48 ! 0;    #7#15 = cc64;  |FINSI;
                    |SI #2#49 ! 0;    #7#15 = cc65;  |FINSI;
               |FINSI;
          |SINO;
               |SI #2#48 ! 0;|Y #7#15 = cc65;  #7#15 = 0;     |FINSI;
               |SI #2#49 ! 0;|Y #7#15 = cc64;  #7#15 = 0;     |FINSI;
          |FINSI;
          #7#16 = #7#16 + (#2#48 % cc64) + (#2#49 % cc65);

          #7#23 = 0;
          #7#24 = 0;
          #7#25 = 0;
     |FINSI;

     #7#17 = #7#17 + #2#5;                   || horas extras estruc.
     #7#18 = #3#8 + #3#9;
     #7#19 = #7#17 % #7#18;

     #7#20 = #7#20 + #2#6;                   || horas extras no estruc.
     #7#21 = #3#10 + #3#11;
     #7#22 = #7#20 % #7#21;
     |SI tip = 0; |O tip = 2;
          nBase36 = (#2#51 % #3#6) ! EURODB;
          #7#113 = #7#113 + (#2#68 % #2#69) + (nBase36 % nEl36);  || cuota 106
          #7#147 = #7#147 + nBase36;                             || parcial base 106
          |SI #2#68 ! 0;|Y #7#147 ! 0;
               #7#112 = 0;                        || base 106 (conjunto)
               #7#114 = 0;                        || (%) 106 (conjunto)
               #7#146 = 8;                        || tipo 106 (conjunto)
          |SINO;
               |SI #2#68 ! 0;
                    #7#112 = #7#112 + #2#68;       || base 106 (notarias)
                    #7#114 = #2#69;               || (%) 106 (notarias)
                    #7#146 = 8;                   || tipo 106 (notarias)
               |FINSI;
               |SI #7#147 ! 0;
                    #7#112 = #7#112 + nBase36;    || base 106 (12/2001)
                    #7#114 = nEl36;               || (%) 106 (12/2001)
                    #7#146 = 6;                   || tipo 106 (12/2001)
               |FINSI;
          |FINSI;

          #7#119 = #7#16;                    || deducc.volunt.(122)
          #7#120 = #3#75;                    || (%) deduc.volunt.
          #7#121 = #7#119 % #7#120;          || cuota deduc.volunt. (132)
     |FINSI;

     #7#110 = notaria;                                 || (%)deducc.notarias
     #7#111 = ((#7#16 + #7#25)% #7#110) ! EURODB;               || cuota notarias 131

     nEnEmpresa = #2#0;
     |HAZ BuscaModulo;
     |HAZ SiBomberos;

     #7#26 = #7#16 + #7#19 + #7#22 + #7#25 + #7#113;   || suma de cuotas
     #7#29 = #7#29 + #2#9;                             || compens.enf.comun
     #7#30 = #7#30 + #2#11 + #2#21 - #2#21;            || maternidad+reducciones
     #7#31 = #7#27 + #7#28 + #7#29 + #7#30;            || punto 210
     #7#32 = #7#26 - #7#31 - #7#111 - #7#121;          || punto 299
     nBaseEREDes = 0;
     |HAZ leepitrab;
     |SI tip ! 8;
          nDS = #3#12 +#3#13;                                 || DESEMPLEO
          nFG = #3#14 +#3#15;                                 || FG
          nFP = #3#16 +#3#17 +#3#18 +#3#19;                   || FP+FS
          nDS = (#7#80 % nDS) ! EURODB;   || la TGSS lo calcula asi,
          nFG = ((#7#80 - nExcFog) % nFG) ! EURODB;   ||/sino se provocan diferencias
          nFP = (#7#80 % nFP) ! EURODB;
          #7#86 = #3#12 +#3#13 +#3#14 +#3#15 +#3#16 +#3#17 +#3#18 +#3#19;
          #7#87 = nDS + nFG + nFP;
          #7#88 = #7#87;                     || Punto 510

          #7#149 = #3#12 + #3#14 + #3#16 + #3#18; || porc. en CP Maternidad
          #7#150 = (#7#148 + #7#158) % #7#149;    || cuota en CP Maternidad+ERE
          nCuota_mater = nCuota_mater ! EURODB;
          nume0 = #7#150 - nCuota_mater;

/*          |SI nume0 < 0; nume0 = -nume0; |FINSI;
          |SI nume0 > 0.03;
                 |SI por_mat = -1; por_mat = 0; |FINSI;
                 #7#149 = por_mat;
                 #7#150 = nCuota_mater;
          |FINSI;
*/
          #7#150 = nCuota_mater;   || siempre lo calculado
          |SI #4#17 ! 0;
               #7#149 = #4#17;     || si me he guardado algun %  en el nomtepig
          |SINO;                   || es que tengo que pintarlo
               #7#149 = 0;
          |FINSI;

          #7#145 = nCuotaTot;   || ATENCION: 21.01.04: esta cuota es la que cal-
                                || culo mediante el proceso LaCuota, respecto a
                                || los importes grabados. Se cambia por las di-
                                || ferencias que se provocaban respecto a TGSS.
          #7#145 = #7#145 + nCuotaFogTot + nFP;
          #7#145 = #7#145 ! EURODB;
          nume1 = #7#87 - #7#145;
          por_dfp = #7#86;

/*          |SI nume1 < 0; nume1 = -nume1; |FINSI;
          |SI nume1 > 0.03;
               #7#86 = 0;
               #7#88 = #7#145;
          |FINSI;
*/
          #7#88 = #7#145;          || siempre lo calculado
          |SI nPorDS ! -1;
               #7#86 = nPorDS;      || si me he guardado algun %  en el nomtepig
          |SINO;                   || es que tengo que pintarlo
               #7#86 = 0;
          |FINSI;
          #7#87 = #7#80 + nBaseEREDes;        || el 301 (= 501 + 502) + base ERE
          #7#80 = #7#80 - #7#148;             || quito a la base las cont. empres.
          || #7#88 = #7#88 - (#7#148 % por_dfp);
          #7#88 = #7#88 - nContEmp;
          #7#80 = #7#80 - bon_162001;             || resta base bon. RDL 162001 >65
          #7#88 = #7#88 - (bon_162001 % por_dfp); || resta cuota bon. RDL 162001 >65
          |SI #7#80 = 0;
               #7#86 = 0;          || por si a causa de la bonif. la base
               #7#88 = 0;          || fuera cero pongo a cero cuota y %
          |FINSI;
          #7#148 = #7#148 + #7#158;  || acumulo al 148 el 158
     |SINO;
          || como el campo 46 del labempax ya no se usa lo uso para grabar cuantos
          || de los trabajadores en formacion estan de maternidad, y a esos le tengo
          || que quitar la cuota obrera
          #7#14 = 0;
          #7#15 = 0;
          #7#80 = 0;
          #7#86 = 0;
             aAlfa = #2#34; |QBF aAlfa;
             |SI aAlfa = "422";
               #nomconst#84 = 0; #nomconst#85 = 0;
               #nomconst#90 = 0; #nomconst#91 = 0;
             |FINSI;
          |SI liqu = "T";      || total
               #7#16 = #7#16 + ((#nomconst#82 + #nomconst#83) * #2#47);
               #7#16 = #7#16 - ((#nomconst#82 + #nomconst#83) * #2#46);
               #7#25 = #7#25 + (#nomconst#82 * #2#46);
          |FINSI;
          |SI liqu = "O"; |O liqu = "A";      || obrera
               #7#16 = #7#16 + (#nomconst#83 * #2#47);
               #7#16 = #7#16 - (#nomconst#83 * #2#46);
          |FINSI;
          |SI liqu = "P";      || patronal
               #7#16 = #7#16 + (#nomconst#82 * #2#47);
               #7#16 = #7#16 - (#nomconst#82 * #2#46);
               #7#25 = #7#25 + (#nomconst#82 * #2#46);
          |FINSI;

          #7#32 = #7#16 + #7#19 + #7#22 + #7#25 - #7#31 - #7#111;     || casilla 299

          |SI liqu = "T";      || total
               #7#88 = #7#88 + ((#nomconst#84 + #nomconst#85) * #2#47);
               #7#88 = #7#88 - ((#nomconst#84 + #nomconst#85) * #2#46);
               #7#88 = #7#88 + ((#nomconst#90 + #nomconst#91) * #2#81);
               #7#88 = #7#88 - ((#nomconst#90 + #nomconst#91) * #2#82);
               #7#150 = #7#150 + (#nomconst#84 * #2#46);
               #7#150 = #7#150 + (#nomconst#90 * #2#82);
         |FINSI;
         |SI liqu = "O"; |O liqu = "A";      || obrera
               #7#88 = #7#88 + (#nomconst#85 * #2#47);
               #7#88 = #7#88 - (#nomconst#85 * #2#46);
               #7#88 = #7#88 + (#nomconst#91 * #2#81);
               #7#88 = #7#88 - (#nomconst#91 * #2#82);
         |FINSI;
         |SI liqu = "P";      || patronal
               #7#88 = #7#88 + (#nomconst#84 * #2#47);
               #7#88 = #7#88 - (#nomconst#84 * #2#46);
               #7#88 = #7#88 + (#nomconst#90 * #2#81);
               #7#88 = #7#88 - (#nomconst#90 * #2#82);
               #7#150 = #7#150 + (#nomconst#84 * #2#46);
               #7#150 = #7#150 + (#nomconst#90 * #2#82);
          |FINSI;
     |FINSI;
     #7#89 = #7#89 + #2#12;                  || bonific./subvenciones
     |HAZ SegSocEmp;
     || #7#170 = #7#170 + #2#98; || no hace falta que lo imprima
     #7#89 = #7#89 + #2#98;        || sistema nacional garantia juvenil
     #7#90 = #7#88 + #7#150 - #7#89;         || diferencia
     #7#91 = #7#91 + #2#15;                  || compens.desem.parcial
     #7#92 = #7#90 - #7#91;                  || punto 699
     #7#93 = #7#32 + #7#85 + #7#92;          || base calculo recargo
     #7#94 = #1#127;                         || recargo
     #7#97 = (#7#93 % #7#94);                     || total recargo
     total = (#7#32 + #7#85 + #7#92 + #7#97) ! EURODB; || total final
     |SI total > 0; #7#98 = total; #7#99 = 0;        |FINSI;  || a ingresar
     |SI total < 0; #7#99 = total * (-1); #7#98 = 0; |FINSI;  || a percibir
     #7#100 = #1#0;                          || codigo empresa
     #7#101 = #1#30;                         || codigo banco
     #7#102 = #1#31;                         || nombre banco
     #7#103 = #0#2;                          || mes hasta en numero (TC1/92)
     #7#104 = #7#89 + #7#91;                 || punto 610 (TC1/92)

     |SI tip = 0; |O tip = 2;
          |SI siono_cen = "N";     #7#105 = #01#13;    |FINSI;   || CCC
          |SI siono_cen = "S";     #7#105 = #10#10;    |FINSI;
     |SINO;
          #7#105 = #13#10;
     |FINSI;
     #7#106 = #7#103;                       || mes desde en numero (TC1/92)
     #7#107 = #7#8;                         || a¤o desde (TC1/92)
     #7#106 = 0;
     #7#107 = 0;
     |SI #2#2 = 2;                          || en finiquitos busco el mes
          #7#106 = #2#45;                   || que grabe en el labempax o
          #7#103 = #2#59;                   || labemphi al hacer el lote
          #7#107 = #7#8;
     |FINSI;

/*
     #7#108 = #7#108 + #2#17;               || nro. de TC2/1
     |SI bon_162001 > 0;                    || clave del 209
          |SI #7#108 > 0;                   || si hay bon RDL 16/2001
               #7#108 = 5;                  || y otras es un "5"
          |SINO;                            || si solo hay del RDL 16/2001
               #7#108 = 1;                  || es un "1"
          |FINSI;
     |FINSI;
*/
     |SI #7#30 > 0;
          |SI #7#30 = bon_162001;
               #7#108 = 1;         || HAY BONIF, TODA DE > 65 A¤OS
          |SINO;
               |SI bon_162001 > 0;
                    #7#108 = 5;    || HAY BONIF, DE LOS DOS TIPOS
               |SINO;
                    #7#108 = 2;    || HAY BONIF, SOLO FOMENTO DE EMPLEO
               |FINSI;
          |FINSI;
     |FINSI;

     |SI tip2 = 0;
          #7#109 = "";
     |SINO;
          #7#109 = "Exp.Reg.Empleo: " + #1#29 + "/" + #1#35;  || nro.exp.
     |FINSI;
     #7#115 = #1#113;                        || cuenta corriente
     #7#116 = #0#11;                         || fecha impresion

     |SI #2#22 = "N";
          aAlfa = #2#27; |QBF aAlfa;
          |SI aAlfa = 422;
               #2#27 = 0;
          |FINSI;
          aAlfa = #2#34; |QBF aAlfa;
          |SI aAlfa = "422";
               #2#34 = "";
          |FINSI;
          |PARA para1 = 122; |SI para1 [ 144; |HACIENDO para1 = para1 + 1;
               para2 = para1 - 99;
               #7para1 = #2para2;
          |SIGUE;
          |SI #2#29 = 904;
               #7#128 = "c";
          |SINO;
               #7#128 = "";
          |FINSI;
          |BUCLE labtrabaNIF;
          |PARA para1 = 151; |SI para1 [ 157; |HACIENDO para1 = para1 + 1;
               para2 = para1 - 99;
               #7para1 = #2para2;
          |SIGUE;
          #7#133 = (#2#34 % 102) + (#2#34 % 402) + (#2#34 % -104);

          alfa1 = #7#142; |QBF alfa1;
          alfa2 = #7#143; |QBF alfa2;   || une los dos apellidos
          apelli = alfa1 + " " + alfa2;
/*
          alfa1 = "1";
          alfa2 = #7#123 % 101;
          |SI alfa2 ] "A";|Y alfa2 [ "z";
               |SI alfa2 = "X";
                    alfa1 = "6";             || tipo identif. (EXTRANJERO)
               |SINO;
                    alfa1 = "2";             || tipo identif. (PASAPORTE)
               |FINSI;
          |FINSI;
          #7#123 = alfa1 + (#7#123 % 111);
*/
     |SINO;
          |PDEFECTO #7, 122, 144;
          apelli = "";
     |FINSI;
|FPRC;

|PROCESO cen_esp;
     |DDEFECTO #13;
     |ABRE #13;
     #13#0 = #1#0;
     |SI siono_cen = "N";     #13#13 = 1;     |FINSI;  || centro 1 cuando va conjunto
     |SI siono_cen = "S";     #13#13 = #2#18; |FINSI;
     |SI tip = 8;  #13#1 = 87;  |FINSI;
     |SI tip = 9;  #13#1 = 64;  |FINSI;
     |LEE 000#13=;
     |CIERRA #13;
|FPRC;

|PROCESO mes;
     |SI #0#2 = 1;  #7#7 = "Enero     "; |FINSI;
     |SI #0#2 = 2;  #7#7 = "Febrero   "; |FINSI;
     |SI #0#2 = 3;  #7#7 = "Marzo     "; |FINSI;
     |SI #0#2 = 4;  #7#7 = "Abril     "; |FINSI;
     |SI #0#2 = 5;  #7#7 = "Mayo      "; |FINSI;
     |SI #0#2 = 6;  #7#7 = "Junio     "; |FINSI;
     |SI #0#2 = 7;  #7#7 = "Julio     "; |FINSI;
     |SI #0#2 = 8;  #7#7 = "Agosto    "; |FINSI;
     |SI #0#2 = 9;  #7#7 = "Septiembre"; |FINSI;
     |SI #0#2 = 10; #7#7 = "Octubre   "; |FINSI;
     |SI #0#2 = 11; #7#7 = "Noviembre "; |FINSI;
     |SI #0#2 = 12; #7#7 = "Diciembre "; |FINSI;
|FPRC;


|PROCESO clave_IE;
     alfa1 = #1#10 % 101; || tipo identificador titular
     |SI alfa1 ] "0";|Y alfa1 [ "9";
          clave_IE = "1";            || tipo identificacion DNI
     |SINO;
          |SI alfa1 = "X";
               clave_IE = "6";        || tipo identificacion EXTRANJERO
          |SINO;
               |SI alfa1 ] "a";|Y alfa1 [ "z";
                    clave_IE = "2";    || tipo identificacion PASAPORTE
               |SINO;
                    clave_IE = "9";    || tipo identificacion CIF
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO mira_cte;
     |MODULO aVengoDe;
     alfa1 = #labtraba#37;
     |SI alfa1 = ".........."; alfa1 = ""; |FINSI;
     |QBF alfa1;
     |SI alfa1 ! "";          || si tengo informada fecha de baja
          alfa2 = alfa1 % 402; || mes baja
          alfa3 = alfa1 % 704; || a¤o baja
          alfa1 = "01" + "." + alfa2 + "." + alfa3;

          alfa2 = #0#2;   || mes emision Hco.
          nume3 = #0#3;   || a¤o emision Hco.
          |SI aVengoDe = "nomwwtc1";
               nume3 = nume3 + 2000;
          |FINSI;
          alfa3 = nume3;
          alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
          alfa4 = "01" + "." + alfa2 + "." + alfa3;

          fFecha1 = alfa1;    || fecha baja trabajador
          fFecha2 = alfa4;    || fecha emision TC1

          |SI fFecha1 < fFecha2;
               |ACABA;        || trabajador de baja en el mes de emision
          |FINSI;             || no juega
     |FINSI;

     |SI #labtraba#42 = "H";  |ACABA;   |FINSI;   || Los autonomos no juegan
     swHaEntrado = 1;                             || a esto
     |DDEFECTO #nomtraca;
     #nomtraca#0 = #labtraba#0;
     #nomtraca#1 = #labtraba#1;
     |LEE 000#nomtraca.=;
     |SI FSalida ! 0;|O #nomtraca#3 = 0;
          swCte = 1;
          |ERROR10;
     |SINO;
          |SI #nomtraca#3 ! nCteAnt; |Y nCteAnt ! 0;
               swCte = 1;
               |ERROR10;
          |FINSI;
          nCteAnt = #nomtraca#3;
     |FINSI;
|FPRC;

|DEFBUCLE trabajadores;
     #labtraba#1;
     77;
     #2#0,     1, #2#18;
     #2#0, 99999, #2#18;
     ;
     NULL, mira_cte;
|FIN;

|PROCESO cte_centro;
     swCte = 0;
     nCteAnt = 0;
     swHaEntrado = 0;
     |ABRE #nomtraca;
     |BUCLE trabajadores;
     |CIERRA #nomtraca;
     |SI swCte ! 1; |Y swHaEntrado ! 0;

#3#0 = nCteAnt;
     |FINSI;
|FPRC;

||____________________________________/ IMPRESION DE CADA TC1
|PROCESO sacalo;
     |SI hay_algo ! 0;
          seleccio = 1;
          |HAZ lee_silcon;
          |INFOR c_informe;
          |PRINT;
          |PIEINF;
          |FININF;
          |HAZ graba_total;
          |SI #0#6 = "T";
/*
               se_empre = emp_ant;      || codigo empresa
               se_tipos = "TC1";        || tipo de modelo
               |SI siono_cen = "N";
                    se_activ = 99;      || centro de trabajo (99)
               |SINO;
                    se_activ = cen_ant; || centro de trabajo asignado
               |FINSI;
               se_impor = total;        || total a pagar
               se_fecha = #7#116;       || fecha emision
               se_prime = tip3;         || tipo (con el cero inicializa importe)
               |HAZ AlAgicli;
*/
          |FINSI;

          cen_ant = #2#18;
          emp_ant = #2#0;
          |DDEFECTO #7;
     |FINSI;
|FPRC;

|PROCESO constante;
     |MODULO aVengoDe;
     alfa1 = "01";
     alfa2 = #0#2;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     |SI aVengoDe = "nomwwtc1"; |O aVengoDe = "mterww19";
          nume1 = #0#3 + 2000;
     |SINO;
          nume1 = #0#3;
     |FINSI;
     alfa3 = nume1;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;

     |SI #0#10 = "C";
          |ABRE #tsilco13; |LEE 000#tsilco13.p; |CIERRA #tsilco13;
          |SI #tsilco13#0 = 2;
               #nomconst#6 = #tsilco13#1;    #nomconst#7 = 0;
               #nomconst#12 = #tsilco13#2;   #nomconst#13 = 0;
               #nomconst#14 = 0;             #nomconst#15 = 0;
               #nomconst#16 = 0;             #nomconst#17 = 0;
               #labempre#127 = #tsilco13#5;
          |FINSI;
     |FINSI;

     |SI aCError ! "";
          aAlfa = "0000No se ha encontrado la Constante Comun del ";
          aAlfa = aAlfa + " Regimen General (500)";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO empresa;
     #1#0 = #2#0;
     |LEE 000#1=;                  || lee la empresa
     |SI FSalida = 0;
          |SI #1#46 ! "S";|Y #1#46 ! "N";    #1#46 = "N";   |FINSI;
          |SI #1#46 ! siono_cen;   |ACABA;   |FINSI;

          #10#0 = #2#0;
          #10#1 = #2#18;
          |LEE 000#10=;
          |SI FSalida = 0;|O #2#18 = 99;
               || #3#0 = #1#32;
               nCConst = 500;
               |HAZ constante;
               |SI aCError = "";
                    || DDEFECTO #15;         YA NO HACE FALTA CONSTANTE
                    || #15#0 = #1#32;        ESPECIAL
                    || LEE 000#15=;       || lee la constante especial
                    |HAZ limpieza;      || prepara segun obrera, patronal o total
                    |SI emp_ant = -1;
                         emp_ant = #2#0;
                         cen_ant = #2#18;
                    |FINSI;
                    |SI emp_ant ! #2#0;
                         |HAZ sacalo;
                    |SINO;
                         |SI cen_ant ! #2#18;|Y siono_cen = "S";
                              |HAZ sacalo;
                         |FINSI;
                    |FINSI;
                    |HAZ tc1;     || calculo del TC1
                    hay_algo = 1;
                    |HAZ graba_cero;
               |SINO;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO graba_total;
     |SI #0#6 = "T";
          #14#0 = emp_ant;
          #14#1 = cen_ant;
          #14#2 = #0#2;
          #14#3 = tip3;
          #14#5 = el_period;
          #14#4 = total;
          |GRABA 020#14n;
     |FINSI;
|FPRC;

|PROCESO graba_cero;
     |SI #0#6 = "T";
          |LEE 121#2=;
          #2#20 = 0;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO limpieza;    || Pone a cero constantes segun patronal u obrera
     |SI liqu ! "T";
          |SI liqu = "O"; |O liqu = "A";
               ini = 6;
               #2#4 = 0;
               #2#9 = 0;    || compens. enfer. comun
               #2#10 = 0;   || compens. accid. trabajo
               #2#11 = 0;   || reducciones (arriba)
               #2#12 = 0;   || bonificaciones, subvenciones (abajo)
               #2#15 = 0;   || compens. desem. parcial
               #2#21 = 0;   || compens. maternidad
               #3#74 = 0;   || recargo notarias/ayuntamientos
          |SINO;
               ini = 7;
               #3#5 = 0;    || coeficiente reductor no en patronal
          |FINSI;
          |PARA x = ini; |SI x < 20; |HACIENDO x = x + 2;
               #3x = 0;
          |SIGUE;
     |FINSI;

     |DDEFECTO #36;
     #36#0 = #10#0;
     #36#1 = #10#1;
     |LEE 000#36=;       || lee centros notarias ayuntamientos
     |SI #36#5 = "N";
          #3#74 = 0;     || sin recargo
     |FINSI;
|FPRC;

|PROCESO lee_silcon;
     silcon1 = "";
     silcon2 = "";
     silcon3 = "";
     |DDEFECTO #30;
     |ABRE #30;
     #30#0 = #7#100;
     |LEE 000#30=;
     |SI FSalida = 0;
          silcon1 = "NO ACOMPA¥A TC2.";
          silcon2 = "Aut.TGSS";
          silcon3 = "del";
          #7#117 = #30#5;                 || nro.autorizacion SILCON
          #7#118 = #30#6;                 || fecha autorizacion SILCON
     |FINSI;
     |CIERRA #30;
|FPRC;
____________________________________/ CALCULO PRINCIPAL
|PROCESO principal2;
     seleccio = 0;
     |HAZ nom_usu;
     alfa1 = nom_tmp;
     |NOME_DAT #14 alfa1;
     |DELINDEX #14;
     |ABRE #1;      || empresas
     |ABRE #3;      || constantes
     |ABRE #10;     || centros de trabajo
     |ABRE #14;     || tmp. importes
     ||ABRE #15;     || constantes especiales 18/93
     |ABRE #36;     || centros notarias ayuntamientos
     |HAZ lecturas;
     |CIERRA #1;
     |CIERRA #3;
     |CIERRA #10;
     |CIERRA #14;
     ||CIERRA #15;
     |CIERRA #36;
     |SI seleccio ! 0;
          |SI #0#6 = "T";
               |HAZ re_importe;
               |HAZ actua_empresa;
               |DELINDEX #14;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO principal;
     c_informe = "nomyytc1";
     |HAZ cuadres;
     |SI sw_cuadre = 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |MENSA "2302Imprimiendo TC1 de empresas ...";
               siono_cen = "N";  |HAZ principal2;    seleccio1 = seleccio;
               |MENSA "2302Imprimiendo TC1 de centros de trabajo ...";
               siono_cen = "S";  |HAZ principal2;    seleccio2 = seleccio;

               |SI seleccio1 = 0;|Y seleccio2 = 0;
                    |MENAV "    Seleccion vacia ...";
               |FINSI;
          |SINO;
               |MENAV "    Proceso ABORTADO !!!";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
____________________________________/ ACTUALIZA IMPORTE TC1 EN AUX.EMPRESAS
|PROCESO importes1;
     #2#0 = #14#0;        || empresa
     #2#18 = #14#1;       || centro
     #2#16 = #14#5;       || a¤o (solo historico)
     #2#1 = #14#2;        || mes
     #2#2 = #14#3;        || tipo
     |LEE 121#2=;
     |SI FSalida = 0;
          #2#20 = #14#4;
          |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
|FPRC;

|DEFBUCLE importes;
     #14#1;
     ;
         0,   0,  0,  1,  0;
     99999, 999, 99, 12, 19;
     ;
     NULL, importes1;
|FIN;

|PROCESO re_importe;
     |ABRE #2;
     |BUCLE importes;
     |CIERRA #2;
|FPRC;
____________________________________/ CALCULOS DE LECTURA DE EPIGRAFES
     / LA RUPTURA SE HACE EN EL CUARTO EPIGRAFE POR ADAPTACION AL TC1/16
|PROCESO losseis1;
     cont = 0;       || contador para saber que no pase de 4 (TC1/16)
     epi  = 33;
     trab = 34;
     ilt  = 35;
     ims  = 36;
     bas  = 37;
     imp1 = 38;
     imp2 = 39;
     bon_162001 = 0;
     nCuota_mater = 0;
     por_mat = 0;
     nFPEmp = 0;
     nFPTra = 0;
     nContEmp = 0;
     nBaseERE = 0;
     nILTERE = 0;
     nIMSERE = 0;
     nPorDS = 0;
     nAntPorDS = 0;
     swElPrimero = 0;
|FPRC;

/*
|PROCESO epigrafe_ERE;
     |SI #4#19 ! 0;
          |ABRE #nomepigr;
          |SI #0#3 [ 6;
               #nomepigr#0 = 126;
          |SINO;
               #nomepigr#0 = 904;
          |FINSI;
          |LEE 000#nomepigr.=;
          |SI FSalida = 0;
               nBaseERE = nBaseERE + #4#19;
               || nILTERE = nILTERE + (#4#19 % #nomepigr#1);
               || nIMSERE = nIMSERE + (#4#19 % #nomepigr#2);

               nILTERE = nILTERE + #4#22;
               nIMSERE = nIMSERE + #4#23;
          |FINSI;
          |CIERRA #nomepigr;
     |FINSI;
|FPRC;
*/

|PROCESO epigrafe_ERE;
|| migue
     |SI #4#19 ! 0;
          nBaseERE = nBaseERE + #4#19;

          nILTERE = nILTERE + #4#22;
          nIMSERE = nIMSERE + #4#23;
     |FINSI;
|FPRC;

|PROCESO losseis2;
     cont = cont + 1;
     |SI liqu = "O";                 || si es obrera limpia importes epigrafes
          #4#7 = 0;              || importe I.L.T.
          #4#8 = 0;              || importe I.M.S.
          #4#14 = 0;
          #4#19 = 0;
     |FINSI;
     |SI nAntPorDS ! #4#21; |Y swElPrimero ! 0; |Y nPorDS ! -1;
          nPorDS = -1;
     |SINO;
          nPorDS = #4#21;
     |FINSI;
     nAntPorDS = #4#21;
     swElPrimero = swElPrimero + 1;

     |SI cont [ 4;
          #7epi  = #4#2;                          || Epigrafe
          #7trab = #7trab + #4#6;                 || Numero de trabajadores (*)
          #7ilt  = #4#3;                          || % I.L.T.
          #7ims  = #4#4;                          || % I.M.S.
          #7bas  = #7bas + #4#5;                  || Bases (*)
          #7imp1 = #7imp1 + #4#7;                 || Importe I.L.T. (*)
          #7imp2 = #7imp2 + #4#8;                 || Importe I.M.S. (*)

          epi    = epi  + 7;
          trab   = trab + 7;
          ilt    = ilt  + 7;
          ims    = ims  + 7;   || acumula punteros
          bas    = bas  + 7;
          imp1   = imp1 + 7;
          imp2   = imp2 + 7;
     |SINO;
          #7#75 = #7#75 + #4#6;                 || Numero de trabajadores
          #7#76 = #7#76 + #4#5;                 || Bases
          #7#77 = #7#77 + #4#7;                 || Importe I.L.T.
          #7#78 = #7#78 + #4#8;                 || Importe I.M.S.
     |FINSI;
     #7#148 = #7#148 + #4#14;           || Base Cont. Prof. Maternidad
     #7#158 = #7#158 + #4#19;           || Base Cont. Prof. Maternidad
     bon_162001 = bon_162001 + #4#15;   || Base bonif. RDL 16/2001 >65
     ||nCuota_mater = nCuota_mater + #4#16 + #4#20; || Cuota cont. empres. calculada para
     nCuota_mater = nCuota_mater + #4#20; || Cuota cont. empres. calculada para
                                          || comparacion por diferencia d constante
     |SI #2#35 = "X";    || MARCO LA BONIF FORM. CONT SI EXISTE
          #7#118 = "X";
     |FINSI;
     |HAZ epigrafe_ERE;
     |SI liqu = "A";
          #7#148 = 0;
          #7#158 = 0;
     |FINSI;
     |SI #4#17 > 0;
          |SI por_mat ! -1;                || a -1 indica que hay bases pero con
               |SI por_mat > 0;            || porcentajes diferentes
                    |SI #4#17 ! por_mat;
                         por_mat = #4#17;
                    |FINSI;
               |SINO;
                    por_mat = #4#17;
               |FINSI;
          |FINSI;
     |FINSI;

     nFPEmp = nFPEmp +#4#12;
     nFPTra = nFPTra + #4#13;
     |SI liqu = "T";
          nContEmp = nContEmp + #4#16 + #4#18;
     |FINSI;
     |SI liqu = "O";
          nContEmp = nContEmp + #4#18;
          nPorDS = nPorDS - #4#24;
     |FINSI;
     |SI liqu = "P";
          nContEmp = nContEmp + #4#16;
          |SI nPorDS ! -1;
               nPorDS = #4#24;
          |FINSI;
     |FINSI;
     |SI liqu = "A";
          nContEmp = nContEmp + #4#18;
          nPorDS = nPorDS - #4#24;
     |FINSI;
|FPRC;

|PROCESO losseis3;
     || #7#79 = #7#34 +#7#41 +#7#48 +#7#55 +#7#62 +#7#69 +#7#75; || trabajadores
     || la linea de arriba estaba comentada, ahora la pongo otra vez activa
     || porque volvemos a tener como numero de trabajadores el numero de
     || movimientos, 11/09/03
     || ojo, que la vuelvo a comentar, porque como numero de trabajadores
     || ahora resulta que nos es numero de movimientos, sino el numero real
     || de trabajadores 05.04.2004

     #7#80 = #7#37 +#7#44 +#7#51 +#7#58 +#7#65 +#7#72 +#7#76; || bases
     #7#81 = #7#38 +#7#45 +#7#52 +#7#59 +#7#66 +#7#73 +#7#77; || importe I.L.T
     #7#82 = #7#39 +#7#46 +#7#53 +#7#60 +#7#67 +#7#74 +#7#78; || importe I.M.S
     nBaseEREDes = nBaseEREDes + nBaseERE;   || me la guardo para sumar a base
     #7#81 = #7#81 + nILTERE;                || epig. a imprimir
     #7#82 = #7#82 + nIMSERE;
     #7#83 = #7#81 + #7#82;                        || Punto 310
     #7#84 = #7#84 + #2#10;                        || Importe accidentes (*)
     #7#85 = #7#83 - #7#84;                        || Punto 499
     #7#79 = #7#79 + #2#13;                        || trabajadores
     || ahora comento esta
     || ahora descomento esta 05.04.2004
     |SI liqu = "P";     #7#145 = #7#145 + (nFPEmp ! EURODB); |FINSI;
     |SI liqu = "O";     #7#145 = #7#145 + (nFPTra ! EURODB); |FINSI;
     |SI liqu = "T";     #7#145 = #7#145 + (nFPEmp ! EURODB) + (nFPTra ! EURODB); |FINSI;
     |SI liqu = "A";     #7#145 = #7#145 + (nFPTra ! EURODB); |FINSI;
|FPRC;

__________________/ LECTURA DE AUXILIARES PARA CUOTAS DESEMPLEO

|PROCESO sumacuotaH;
     |SI nAntPorc = #nomwepcd#21; |O swElPrimero = 0;
          nBase = nBase + #nomwepcd#5;

          nEmp = #nomwepcd#0;
          nTra = #nomwepcd#20;
          |HAZ Pluriempleo;
          |SI nBaseFogPlu = 0;
               nBaseFog = nBaseFog + #nomwepcd#5;
          |SINO;
               nBaseFog = nBaseFog + nBaseFogPlu;
          |FINSI;

          |SI #nomwepcd#21 = 0;
               nExcFog = nExcFog + #nomwepcd#5;
          |FINSI;

          nPintaPorc = #nomwepcd#21 + #nomwepcd#23;
          nPorFOGASA = #nomwepcd#23;
     |SINO;
          nCuota = (nBase * nAntPorc / 100) ! 2;
          nCuotaTot = nCuotaTot + nCuota;

          nCuotaFog = (nBaseFog * #nomwepcd#23 / 100) ! 2;
          nCuotaFogTot = nCuotaFogTot + nCuotaFog;

          nPorFOGASA = #nomwepcd#23;
          nPintaPorc = 0;

          nBase = #nomwepcd#5;

          nEmp = #nomwepcd#0;
          nTra = #nomwepcd#20;
          |HAZ Pluriempleo;
          |SI nBaseFogPlu = 0;
               nBaseFog = #nomwepcd#5;
          |SINO;
               nBaseFog = nBaseFogPlu;
          |FINSI;
     |FINSI;
     nAntPorc = #nomwepcd#21;
     swElPrimero = swElPrimero + 1;
     || los asimilados los contara primero siempre ya que la clave usada es
     || por el % desempleo; en la variable nExcFog (Excluido Fogasa) meto
     || las bases que van a estar excluidas de FOGASA (las de los asimilados)
     || que asumo que son los que tienen un 0% de desempleo, luego lo restare
|FPRC;

|DEFBUCLE nomwepcd;
     #nomwepcd#2;
     ;
       0, #2#0, nAnyo, #0#2, 00001, #2#18,   0, tip3; || %,Emp,A¤o,Mes,Tra,Cen,Epi,Tip
     100, #2#0, nAnyo, #0#2, 99999, #2#18, 999, tip3; ||
     ;
     NULL, sumacuotaH;
|FIN;

|PROCESO Pluriempleo;
     nBaseFogPlu = 0;

     |SI runnom = "nomyytc1";  nAnyo = #0#3;         |FINSI;
     |SI runnom = "nomwwtc1";  nAnyo = #0#3 + 2000;  |FINSI;

     |ABRE #nompluba;
     #nompluba#0 = nEmp;
     #nompluba#1 = nTra;
     #nompluba#2 = nAnyo;
     #nompluba#3 = #0#2;
     #nompluba#4 = 0;
     |LEE 000#nompluba.=;
     |SI FSalida = 0;
          |SI #nompluba#7 ! #nompluba#5;     || de momento, solo para el caso
          |Y #nompluba#7 ! #nompluba#6;      || de que fogasa sea la unica con-
          |Y #nompluba#7 ! #nompluba#8;      || tingencia cuya base tenga un
               nBaseFogPlu = #nompluba#7;    || tope distinto
          |FINSI;
     |FINSI;
     |CIERRA #nompluba;
|FPRC;

|PROCESO sumacuotaM;
     |SI nAntPorc = #nomtepcd#21; |O swElPrimero = 0;
          nBase = nBase + #nomtepcd#5;

          nEmp = #nomtepcd#0;
          nTra = #nomtepcd#20;
          |HAZ Pluriempleo;
          |SI nBaseFogPlu = 0;
               nBaseFog = nBaseFog + #nomtepcd#5;
          |SINO;
               nBaseFog = nBaseFog + nBaseFogPlu;
          |FINSI;

          |SI #nomtepcd#21 = 0;
               nExcFog = nExcFog + #nomtepcd#5;
          |FINSI;
          nPintaPorc = #nomtepcd#21 + #nomtepcd#23;
          nPorFOGASA = #nomtepcd#23;
     |SINO;
          nCuota = (nBase * nAntPorc / 100) ! 2;
          nCuotaTot = nCuotaTot + nCuota;

          nCuotaFog = (nBaseFog * #nomtepcd#23 / 100) ! 2;
          nCuotaFogTot = nCuotaFogTot + nCuotaFog;

          nPorFOGASA = #nomtepcd#23;
          nPintaPorc = 0;

          nBase = #nomtepcd#5;

          nEmp = #nomtepcd#0;
          nTra = #nomtepcd#20;
          |HAZ Pluriempleo;
          |SI nBaseFogPlu = 0;
               nBaseFog = #nomtepcd#5;
          |SINO;
               nBaseFog = nBaseFogPlu;
          |FINSI;
     |FINSI;

     nAntPorc = #nomtepcd#21;
     swElPrimero = swElPrimero + 1;
     || los asimilados los contara primero siempre ya que la clave usada es
     || por el % desempleo; en la variable nExcFog (Excluido Fogasa) meto
     || las bases que van a estar excluidas de FOGASA (las de los asimilados)
     || que asumo que son los que tienen un 0% de desempleo, luego lo restare
|FPRC;

|DEFBUCLE nomtepcd;
     #nomtepcd#2;
     ;
       0, #2#0, #0#2, 00001, #2#18,   0, tip3; || %,Emp,Mes,Tra,Cen,Epi,Tip
     100, #2#0, #0#2, 99999, #2#18, 999, tip3;
     ;
     NULL, sumacuotaM;
|FIN;

|PROCESO LaCuota;
     nBase = 0;
     nBaseFog = 0;
     nCuotaTot = 0;
     nCuota = 0;

     nCuotaFog = 0;
     nCuotaFogTot = 0;
     nPorFOGASA = 0;
     nPintaPorc = 0;

     nAntPorc = 0;
     swElPrimero = 0;
     nExcFog = 0;
     |SI runnom = "nomyytc1"; |O runnom = "mteryy19";
          |BUCLE nomtepcd;
     |SINO;
          nAnyo = #0#3;
          |BUCLE nomwepcd;
     |FINSI;

     nCuota = (nBase * nAntPorc / 100) ! 2;
     nCuotaTot = nCuotaTot + nCuota;
     nCuotaFog = (nBase * nPorFOGASA / 100) ! 2;
     nCuotaFogTot = nCuotaFogTot + nCuotaFog;
     nCuotaFogTot = nCuotaFogTot - (nExcFog * nPorFOGASA / 100);

     nume1 = nCuotaTot - (nFPTra ! EURODB) - (nFPEmp ! EURODB);
     |SI liqu = "P";
          nCuotaTot = nCuotaTot - (nFPTra ! EURODB);
          nCuotaTot = nCuotaTot - nume1;
     |FINSI;
     |SI liqu = "O";
          nCuotaTot = nCuotaTot - (nFPEmp ! EURODB);
          nCuota_mater = 0;
          nCuotaFogTot = 0;
     |FINSI;
     |SI liqu = "A";
          nCuotaTot = nCuotaTot - (nFPEmp ! EURODB);
          nCuota_mater = 0;
          nCuotaFogTot = 0;
     |FINSI;
|FPRC;
