|FICHEROS;
     labaux01 #0;
|FIN;

/*
|PROCESO EnvioNetContrata;

     || A PARTIR DE AQUI SI ME VALDRA, EL SE PONE A HACER SU NETCONTRATA
     || Y SUS COSAS

     |ABRE #labcontr; |LEE 000#labcontr.p; |CIERRA #labcontr;

     swSigue = 0;
     |SUB_EJECUTA "labnct00";
     |SI swSigue = 0;
          |ACABA;
     |FINSI;

     |SI swSigue = 2;
          aContiene = "";
          |ESPECIFICA "RBASS", aContiene;
          aAlfa = aContiene1;
          |QBF aAlfa;
          aAlfa = aAlfa + "conectass";
          #labcontr#63 = aAlfa;
     |FINSI;

     aFich = aPath + eaFichero;

     aRuta = #labcontr#51;
     |QBF aRuta;
     aAlfa = aRuta % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/";
          aRuta = aRuta + "/";
     |FINSI;

     || ruta para errores
     aAlfa1 = #labcontr#63;
     |QBF aAlfa1;
     aAlfa = aAlfa1 % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/";        || ruta de los XML
          aAlfa1 = aAlfa1 + "\";
     |FINSI;

     aAlfa = aAlfa1 + "ERRORES";
     aRutaErrores = aAlfa;
     aRuta = aRutaErrores; |HAZ CompRuta; aRutaErrores = aRuta;

     aAlfa = aRutaErrores + "ERRORESNET.XML";
     |RFBORRA aAlfa;

     |XABRE "CBW", aRutaBAT, nHandleBAT;

     aAlfa = #labcontr#63; |QBF aAlfa;
     aRuta = aAlfa; |HAZ CompRuta; aAlfa = aRuta;

     aUnidad = aAlfa % 102;
     aResto = aAlfa - aUnidad;

     aAlfa = "@echo off" + &13 + &10;
     |XGRABA nHandleBAT, aAlfa;

     aUnidad = aUnidad + &13 + &10;
     |XGRABA nHandleBAT, aUnidad;

     aAlfa = "CD " + aResto + &13 + &10;
     |XGRABA nHandleBAT, aAlfa;

     aAlfa1 = #labcontr#62; |QBF aAlfa1;
     aAlfa = "rdn.exe " + aAlfa1 + " " + aFich + " " + aRutaErrores;

     aAlfa = "start " + aAlfa + &13 + &10;
     |XGRABA nHandleBAT, aAlfa;

     |XCIERRA nHandleBAT;
     |RSYSTEM aRutaBAT;
|FPRC;

|PROCESO Linea;
     |QBF aAlfa;
     aCadena = aAlfa;
     |SI nNivel = 1;
          aCadena = aCadena;
     |FINSI;
     |SI nNivel = 2;
          || aCadena = &09 + aCadena;
          aCadena = "  " + aCadena;
     |FINSI;
     |SI nNivel = 3;
          aCadena = "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 4;
          aCadena = "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 5;
          aCadena = "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 6;
          aCadena = "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 7;
          aCadena = "  " + "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 8;
          aCadena = "  " + "  " + "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 9;
          aCadena = "  " + "  " + "  " + "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 10;
          aCadena = "  " + "  " + "  " + "  " + "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI swSinReturn = 0;
          aCadena = aCadena + &13 + &10;
     |FINSI;
     aAlfa = aCadena;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO CreaFichero;
     aAlfa1 = #labtraba#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #labtraba#1; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;
     aArchivo = aAlfa1 + "_" + aAlfa2 + "_" + "horascomp.xml";
     aArchivo = aPath + aArchivo;

     |XABRE "CBW", aArchivo, nCanal;

     nNivel = 1;
     aLinea = "<?xml version=" + &34 + "1.0" + &34 + " encoding=";
     aLinea = aLinea + &34 + "ISO-8859-1" + &34 + " ?>" + &13 + &10;
     |HAZ Linea;

     aLinea = "<HORAS>";
     |HAZ Linea;

     nNivel = 1;
     aLinea = "</HORAS>";
     |HAZ Linea;
|FPRC;

|PROCESO CreaDirectorio;
     |ABRE #labcontr; |LEE 000#labcontr.=; |CIERRA #labcontr;

     swNetContrata = 1;
     aPath = #labcontr#51;
     |QBF aPath;
     |SI aPath = "";
          aPath = "C:\tmp\contratos";
          aAlfa = "    ATENCION. No está definida la ruta para almacenar los fichero xml ";
          aAlfa = aAlfa + "en el Control de la Aplicación.";
          |MENAV aAlfa;
          aAlfa = "    Se usará por defecto la carpeta C:\tmp";
          |MENAV aAlfa;
     |SINO;
          aAlfa = aPath % -101;
          |SI aAlfa ! "/"; |Y aAlfa ! "\";
               aPath = aPath + "\";
          |FINSI;
          |SI swNetContrata = 1;
               aPath = aPath + "NETCONTRATA\CONTRATA\";
          |SINO;
               aPath = aPath + "contratos\";
          |FINSI;
     |FINSI;

     aAlfa1 = aPath % 0;  nNume1 = aAlfa1;
     aAlfa2 = "";
     |PARA nPara1 = 1; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 1;
          nNume2 = (nPara1 * 100) + 1;
          aAlfa1 = aPath % nNume2;
          |SI aAlfa1 = "/"; |O aAlfa1 = "\";
               |SI aAlfa2 ! "";
                    |RMKDIR aAlfa2;
               |FINSI;
          |FINSI;
          aAlfa2 = aAlfa2 + aAlfa1;
     |SIGUE;
     |SI aAlfa2 ! "";
          |RMKDIR aAlfa2;
     |FINSI;

     aRuta = aPath; |HAZ CompRuta; aPath = aRuta;
     aRutaBAT = aPath + "ejecuta.bat";
|FPRC;

|PROCESO Envio;
     |HAZ CreaDirectorio;
     |HAZ CreaFichero;
     |HAZ EnvioNetContrata;

|FPRC;
*/
