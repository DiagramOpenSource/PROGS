|FICHEROS;
     hotm0001 #0;
     labtraba #1;

     hotm0016 #2;
     hotm0017 #3;
     hotm0012 #4;
|FIN;

|VARIABLES;
     nExiste=0;
     nTecla=0;
     aCadena1="";
     alfa1="";
     alfa2="";
     alfa3="";
     alfa4="";
     nume1=0;
     nume2=0;
     nume3=0;
     corta=0;
     jg=0;
     sitio=0;
     final="";
     lugar=0;
     resto=0;
     letra="";
     x="";
     nifnum=0;
     nModo=0;
     fFecha1=@;
     fFecha2=@;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;


|PROCESO Completa;|TIPO 0;
     |SI #0#32="C";
          |CAMPO_MODIFICA #0#34,1,"N";
          |CAMPO_MODIFICA #0#35,1,"N";
          |CAMPO_MODIFICA #0#36,1,"N";
          #0#34=0;
          #0#35=8;
          #0#36=40;
          |PINTA #0#34;
          |PINTA #0#35;
          |PINTA #0#36;
     |SINO;
          |CAMPO_MODIFICA #0#34,1,"S";
          |CAMPO_MODIFICA #0#35,1,"S";
          |CAMPO_MODIFICA #0#36,1,"S";
     |FINSI;
|FPRC;


|PROCESO Ultimo; |TIPO 7;
     nModo = (FEntrada/100)!0;
     |SI nModo = 1;
          nume1=#0#0;

          |ABRE #3;
          #3#0=nume1;
          |LEE 101#3=;
          |SI FSalida=0;
               #0#1=#3#1;
               #3#1=#3#1+1;
               |GRABA 020#3a;
          |SINO;
               |ABRE #1;
               #1#0=#0#0;
               #1#1=99999;
               |LEE 000#1];
               |SI FSalida=0;
                    |LEE 000#1a;
               |SINO;
                    |LEE 000#1u;
               |FINSI;
               |CIERRA #1;

               |SI #1#0=nume1;
                    #0#1=#1#1+1;
               |SINO;         || si hemos ido al ultimo y ha cambiado la empresa
                    #0#0=nume1;
                    #0#1=1;
               |FINSI;

               #3#1=nume1+1;
               |GRABA 020#3n;
          |FINSI;

          |LIBERA #3;
          |CIERRA #3;

          |PINTA #0#0;
          |PINTA #0#1;
     |FINSI;
|FPRC;



|PROCESO Edad; |TIPO 0;
     fFecha1=~;
     fFecha2=#0#22;
     fFecha1=fFecha1-fFecha2;
     aCadena1=fFecha1;
     aCadena1=aCadena1 % -104;
     #0#23=aCadena1;
|FPRC;


|PROCESO VerificaExiste; |TIPO 0;
     nTecla=FSalida;
     nModo = (FEntrada/100)!0;
     |SI nModo = 1;
          |SI nTecla!2;
               |ABRE #1;
               #1#0=#0#0;
               #1#1=#0#1;
               |LEE 000#1=;
               |SI FSalida=0;
                    |CONFI "00000El Trabajador Seleccionado ya Existen en AGINOM!, Quieres Continuar?";
                    |SI FSalida!0;
                         |ERROR;
                    |FINSI;
               |FINSI;
               |CIERRA #1;
          |FINSI;
     |FINSI;
|FPRC;



|PROCESO TrabCadena; |TIPO 0;
     |SI #0#46="S";
          |CAMPO_MODIFICA #0#47,1,"S";
          |CAMPO_MODIFICA #0#48,1,"S";
          |CAMPO_MODIFICA #0#49,1,"S";
          |CAMPO_MODIFICA #0#50,1,"S";
     |SINO;
          |CAMPO_MODIFICA #0#47,1,"N";
          |CAMPO_MODIFICA #0#48,1,"N";
          |CAMPO_MODIFICA #0#49,1,"N";
          |CAMPO_MODIFICA #0#50,1,"N";
     |FINSI;

|FPRC;

|PROCESO trunca3x;
    corta = 0;
    alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
|PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
        sitio = (jg * 100) + 1;
        alfa2 = alfa1 % sitio;
    |SI alfa2 = ".";  corta = jg;  |FINSI;
|SIGUE;
|SI corta ! 0;
        sitio = 100 + corta - 1;
        alfa1 = alfa1 % sitio;
|FINSI;
    nume3 = alfa1;
    nume1 = nume1 - (nume3 * 97);
|FPRC;


|PROCESO calculadfnfass; |TIPO 0;
|SI FSalida = 13;
        alfa1 = #0Campo;
    |QBF alfa1;
        alfa2 = alfa1 % 102; alfa3 = alfa1 % -108;
        alfa4 = alfa3 % 101;
    |SI alfa4 = "0";
            alfa3 = alfa3 % 207;
            alfa1 = alfa2 + alfa3;
    |FINSI;
        nume1 = alfa1;
        nume2 = nume1 / 97;
    |HAZ trunca3x;
    |SI nume1 ] 0; |Y nume1 [ 99;
            alfa1 = #0Campo;
        |QBF alfa1;
            alfa2 = nume1;
            alfa2 = "00" + alfa2;
            alfa2 = alfa2 % -102;
            alfa1 = alfa1 + alfa2;
            #0Campo = alfa1;
        |PINTA #0Campo;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO nifletra2;|TIPO 0;
     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;


|FICHEROS;
||     hotm0012 #0;
     hotm0016 #1;
|FIN;

|VARIABLES;
   UltLinea = 0;
   LineaAct = 0;
   Calc     = 0;
   Flag     = 0;
   ModoEntrada = 0;
|FIN;

|PROCESO RecalcProrrata;
   UltLinea = #hotm0016#2;
   #hotm0016#9 = #hotm0016#10 / #hotm0001#56;
   #hotm0001#54 = #hotm0001#54 + #hotm0016#9;
   |GRABA 020#hotm0016.a;
|FPRC;

|DEFBUCLE RecalcProrrata;
#hotm0016#1;
;
#hotm0001#0, #hotm0001#1, 001;
#hotm0001#0, #hotm0001#1, 999;
;
NULL,RecalcProrrata;
|FIN;

|PROCESO Acumula; |TIPO 2;
     ModoEntrada = (FEntrada / 100) ! 0;
     Flag = 0+.1;
     #hotm0001#56 = #hotm0001#56 +. #hotm0016#10;

     |ABRE #hotm0012;
     #hotm0012#0 = #hotm0001#0;
     #hotm0012#1 = #hotm0001#1;
     |LEE 000#hotm0012.=;
     |SI FSalida = 0;
        #hotm0012#3 = #hotm0001#56; |GRABA 020#hotm0012.a;
     |FINSI;
     |CIERRA #hotm0012;

     |SI Flag > 0;
        #hotm0001#54 = 0;
        |SI ModoEntrada = 1;
           |GRABA 020#hotm0016.b;
        |SINO;
           |GRABA 020#hotm0016.a;
        |FINSI;
        |SALVA_FICHA #hotm0016;
        |BUCLE RecalcProrrata;
        |REPON_FICHA #hotm0016;
        Calc = #hotm0001#54;
        |SI Calc < 1;
           Calc = 1 - Calc;
           #hotm0016#9 = #hotm0016#9 + Calc; |GRABA 020#hotm0016.a;
           #hotm0001#54 = 1;
        |FINSI;
        |PONCONTROL 23, "si"; |PTEC 815;
     |SINO;
        #hotm0001#54 = #hotm0001#54 +. #hotm0016#9;
     |FINSI;
     |PINTA #hotm0001#54;
|FPRC;

|PROCESO Calcula;
   Calc = #hotm0001#56 + #hotm0016#10;
   #hotm0016#9 = #hotm0016#10 / Calc;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #4;
     #4#0=#0#0;
     #4#1=#0#1;
     |LEE 101#4=;
     nExiste=FSalida;

     #4#2=#0#54;

     |SI nExiste=0;
          |GRABA 020#4a;
     |SINO;
          |GRABA 020#4n;
     |FINSI;

     |LIBERA #4; |CIERRA #4;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     |ABRE #hotm0012;
     #hotm0012#0 = #0#0;
     #hotm0012#1 = #0#1;
     |LEE 000#hotm0012.=;
     |SI FSalida ! 0;
          |GRABA 020#hotm0012.n;
     |FINSI;
     |CIERRA #hotm0012;
|FPRC;
