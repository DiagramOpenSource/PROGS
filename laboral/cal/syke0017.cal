|FICHEROS;
     syke0017  #0;
     syke0012  #100;

     nomauxi1;
     nomauxi2;
     syke0014;
     labtraba;
     labempre;
     labcentr;
     ref0001@ #900;      || cabeceras calculos
     ref0002@ #910;      || lineas calculos
     syke0015 #101;

     syke0013;
     syke0020;
     syke0021;
     syke0022;
     syke0023 #200;
     syke0027 #201;

     nomtrato;
|FIN;

|VARIABLES;
     nCto = 0;
     nNumCto = 0;
     nPara = 0;
     nCodAscii = 0;
     aColumna = "";

     aRaizMacro = "";

     {1}aVersion      = "";
     aPath = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     nCaracter = 0;
     aCaracter = "";

     nAnyo = 0;
     aAnyo = "";
     fecsys = @;
     aAlfa = "";
     aAlfa1 = "";
     aDirBase = "";
     nHoras = 0;
     nHorasMes = 0;
     nPorJornada = 0;
     aProc = "";
     nNum = 0;

     nLinea = 0;
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";

     nC0 = 0;
     aC1 = "";
     aC2 = "";
     aC3 = "";
     nC4 = 0;
     aC5 = "";
     nC6 = 0;
     aC7 = "";
     aC8 = "";
     aC9 = "";
     nC10 = 0;
     aC11 = "";
     fC12 = @;
     fC13 = @;
     nC14 = 0;
     nC15 = 0;
     nC16 = 0;
     nC17 = 0;
     nC18 = 0;
     nC19 = 0;
     nC20 = 0;
     nC21 = 0;
     nC22 = 0;
     nC23 = 0;
     nC24 = 0;
     nC25 = 0;
     nC26 = 0;
     nC27 = 0;
     nC28 = 0;
     nC29 = 0;
     nC30 = 0;
     nC31 = 0;
     nC32 = 0;
     nC33 = 0;
     nC34 = 0;
     nC35 = 0;

     nC36 = 0;
     aC37 = "";
     aC38 = "";
     nC39 = 0;
     nC40 = 0;

     ||AL QUE LO TOQUE LE CORTO LOS HUEVOS
     ||NO METER ENTRE ESTAS VARIABLES OTRA DECLARACION
     {-1}nTotal = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;
     nTotC18 = 0;
     nTotC19 = 0;
     nTotC20 = 0;
     nTotC21 = 0;
     nTotC22 = 0;
     nTotC23 = 0;
     nTotC24 = 0;
     nTotC25 = 0;
     nTotC26 = 0;
     nTotC27 = 0;
     nTotC28 = 0;
     nTotC29 = 0;
     nTotC30 = 0;
     nTotC31 = 0;
     nTotC32 = 0;
     nTotC33 = 0;
     nTotC34 = 0;
     nTotC39 = 0;
     nTotC40 = 0;

     nBrutoPaga = 0;
     nIRPFPaga = 0;
     swSigue = 0;

     FEstado = 0;
     swCoef = 0;
     nUnid = 0;
     nUnidTotal = 0;
     nDesdeMesPro = 0;
     nHastaMesPro = 0;
     aDesdeAnyPro = "";
     aHastaAnyPro = "";
     swHay99 = 0;
     fFechaAlta = @;
     aAlfa2 = "";
     fFechaIni = @;
     aFechaIni = "";
     nEmbargo = 0;
     nAnticPaga = 0;

     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     nTopeMes = 0;
     &nMes = 0;
     &aMes = "";
     aAlfa3 = "";

     nImporte = 0;
     nConcepto = 0;
     aAccount = "";
     aUnit = "";
     aActivity = "";
     nNume = 0;
     aReference = "";
     &nAny = 0;
     &nTopemes = 0;
     nTotalLineas1 = 0;
     nTotalLineas2 = 0;
     nPaso = 0;
     swAgrupa = 0;

     nDiferencia = 0;
     nCampo = 0;
     nValorTotal = 0;
     nValorParcial = 0;

     nAcumulado = 0;

     nAcumC15 = 0;
     nAcumC16 = 0; nAcumC17 = 0; nAcumC18 = 0; nAcumC19 = 0; nAcumC20 = 0;
     nAcumC21 = 0; nAcumC22 = 0; nAcumC23 = 0; nAcumC24 = 0; nAcumC25 = 0;
     nAcumC26 = 0; nAcumC27 = 0; nAcumC28 = 0; nAcumC29 = 0; nAcumC30 = 0;
     nAcumC31 = 0; nAcumC32 = 0; nAcumC33 = 0; nAcumC34 = 0;
     nAcumC39 = 0; nAcumC40 = 0;

     nParcialC15 = 0;
     nParcialC16 = 0; nParcialC17 = 0; nParcialC18 = 0; nParcialC19 = 0; nParcialC20 = 0;
     nParcialC21 = 0; nParcialC22 = 0; nParcialC23 = 0; nParcialC24 = 0; nParcialC25 = 0;
     nParcialC26 = 0; nParcialC27 = 0; nParcialC28 = 0; nParcialC29 = 0; nParcialC30 = 0;
     nParcialC31 = 0; nParcialC32 = 0; nParcialC33 = 0; nParcialC34 = 0;
     nParcialC39 = 0; nParcialC40 = 0;

     nSalarioBase = 0;
     aFechaRef = "";
     fFechaRef = @;
     aFechaBaja = "";
     fFechaBaja = @;
     aFechaAlta = "";

     aMesAlta = "";
     aMesBaja = "";
     aAnyAlta = "";
     aAnyBaja = "";

     nAnyBaja = 0;
     nMesBaja = 0;
     swNoSigas = 0;
     aResultado = "";
|FIN;

|PROCESO DesactivaAt;
     |SI #0#6 = "X";
          |CAMPO_MODIFICA #0#11, 1, "S";
          |CAMPO_MODIFICA #0#12, 1, "S";
          |PINTA #0#11;
          |PINTA #0#12;
     |SINO;
          |CAMPO_MODIFICA #0#11, 1, "N";
          |CAMPO_MODIFICA #0#12, 1, "N";
          #0#11 = 00;
          #0#12 = 00;
          |PINTA #0#11;
          |PINTA #0#12;
     |FINSI;
|FPRC;

|PROCESO MesesAtrasos;
     |SI #0#6 = "X";
          |PINTA 2042, "Meses: ";
          |CAMPO_VISUAL #0#11, 1, "S";
          |CAMPO_MODIFICA #0#11, 1, "S";
          |CAMPO_VISUAL #0#12, 1, "S";
          |CAMPO_MODIFICA #0#12, 1, "S";
          |PINTA #0#11;
          |PINTA #0#12;
          |PINTA 2053, "-";
     |SINO;
          |CAMPO_VISUAL #0#11, 1, "N";
          |CAMPO_MODIFICA #0#11, 1, "N";
          |CAMPO_VISUAL #0#12, 1, "N";
          |CAMPO_MODIFICA #0#12, 1, "N";
          |PINTA 2042, "                ³";
     |FINSI;
|FPRC;

|PROCESO Comprueba;
     |SI #0#4 = " "; |Y #0#5 = " "; |Y #0#6 = " ";
          |MENAV "    ATENCION: Debe elegir al menos una fuente de datos.";
          |POSICIONATE #0#4;
     |FINSI;
     /*
     |SI #0#8 = "N"; |Y #0#9 = "N";
          |MENAV "    ATENCION: Debe elegir al menos un tipo de datos.";
          |POSICIONATE #0#8;
     |FINSI;
     */
|FPRC;

|PROCESO mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
     fecsys = ~;
     aAlfa = fecsys;
     aAlfa = aAlfa % 402;
     #0#3 = aAlfa;
     |PINTA #0#3;
|FPRC;

|PROCESO miraanyo; |TIPO 7; ||calcula el periodo por defecto segun fecha sistema
     fecsys = ~;
     aAlfa = fecsys;
     aAlfa = aAlfa % -104;
     #0#2 = aAlfa;
     |PINTA #0#2;
|FPRC;

|PROCESO fechaenvio;
     nMes = #0#3;
     nAny = #0#2;
     |HAZ topemes_plb;
     aAlfa = nTopemes; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;

     aAlfa1 = #0#3; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#2;

     aAlfa = aAlfa + "." + aAlfa1 + "." + aAlfa2;
     #0#13 = aAlfa;
     ||PINTA #0#13;
|FPRC;

|PROCESO PonaCero;
     nC0 = 0;
     aC1 = "";
     aC2 = "";
     aC3 = "";
     nC4 = 0;
     aC5 = "";
     nC6 = 0;
     aC7 = "";
     aC8 = "";
     aC9 = "";
     nC10 = 0;
     aC11 = "";
     fC12 = @;
     fC13 = @;
     nC14 = 0;
     nC15 = 0;
     nC16 = 0;
     nC17 = 0;
     nC18 = 0;
     nC19 = 0;
     nC20 = 0;
     nC21 = 0;
     nC22 = 0;
     nC23 = 0;
     nC24 = 0;
     nC25 = 0;
     nC26 = 0;
     nC27 = 0;
     nC28 = 0;
     nC29 = 0;
     nC30 = 0;
     nC31 = 0;
     nC32 = 0;
     nC33 = 0;
     nC34 = 0;
     nC35 = 0;
     nC36 = 0;
     aC37 = "";
     aC38 = "";
     nC39 = 0;
     nC40 = 0;
     nEmbargo = 0;
     nAnticPaga = 0;
     nSalarioBase = 0;
|FPRC;

|PROCESO GrabaCamposNuevo;
     |DDEFECTO #100;

     #100#0 = nC0;            || cod empresa
     #100#1 = aC1;            || desc empresa
     #100#2 = #101#4;            || cod area
     #100#3 = #101#5;            || desc area
     #100#4 = nC4;            || cod categoria
     #100#5 = aC5;            || desc categoria
     #100#6 = #101#2;            || cod centro
     #100#7 = #101#3;            || desc centro
     #100#8 = #101#6;            || cod seccion
     #100#9 = #101#7;            || desc seccion
     #100#10 = nC10;          || cod trabajador
     #100#11 = aC11;          || nombre trabajador
     #100#12 = fC12;          || fecha alta
     #100#13 = fC13;          || fecha baja
     #100#14 = nC14 * 100;    || porcentaje jornada
     #100#15 = nC15;
     #100#16 = nC16;
     #100#17 = nC17 * (#101#8 / #101#9);          || PAGA EXTRA
     #100#18 = nC18;
     #100#19 = nC19 * (#101#8 / #101#9);          || SALARIO TOTAL
     #100#20 = nC20;
     #100#21 = nC21;
     #100#22 = nC22;
     #100#23 = nC23;
     #100#24 = nC24;
     #100#25 = nC25 * (#101#8 / #101#9);          || GROSS SALARY (BRUTO)
     #100#26 = nC26;
     #100#27 = nC27 * (#101#8 / #101#9);          || IRPF
     #100#28 = nC28;
     #100#29 = nC29;
     #100#30 = nC30 * (#101#8 / #101#9);          || EMBARGOS
     #100#31 = nC31 * (#101#8 / #101#9);          || ANTICIPOS
     #100#32 = nC32 * (#101#8 / #101#9);          || SALARIO NETO
     #100#33 = nC33;                              || SEG. SOCIAL EMPRESA
     #100#34 = nC34 * (#101#8 / #101#9);          || COSTE TOTAL
     #100#35 = nC35;                              || tipo
     #100#36 = nC36;                              || Horas Contrato
     #100#37 = aC37;                              || NIF
     #100#38 = aC38;                              || Tipo Contrato
     #100#39 = nC39 * (#101#8 / #101#9);          || Salario Base
     #100#40 = nC40 * (#101#8 / #101#9);          || Pluses

     |GRABA 020#100n;
     nTotalLineas1 = nTotalLineas1 + 1 ;

     || Variables para la pesta¤a UploadFile

     nParcialC17 = #100#17;
     nParcialC19 = #100#19;
     nParcialC25 = #100#25;
     nParcialC27 = #100#27;
     nParcialC30 = #100#30;
     nParcialC31 = #100#31;
     nParcialC32 = #100#32;
     nParcialC34 = #100#34;

     |HAZ GrabaTMP_UploadFile_P;
|FPRC;

|DEFBUCLE GrabaCamposNuevo;
     #101#1;
     ;
     #labtraba#0, #labtraba#1, 01, "    ", "    ";
     #labtraba#0, #labtraba#1, 99, "zzzz", "zzzz";
     ;
     NULL, GrabaCamposNuevo;
|FIN;

|PROCESO ElActual;
     |DDEFECTO #101;

     #101#0 = #labtraba#0;         || empresa
     #101#1 = #labtraba#1;         || trabajador
     #101#2 = #labtraba#77;         || centro
     #101#4 = #labtraba#62;         || area
     #101#6 = #labtraba#63;         || seccion
     |LEE 101#101=;
     FEstado = FSalida;

     #101#3 = aC7;             || descripcion centro
     #101#5 = aC3;               || descripcion area
     #101#7 = aC9;            || descripcion seccion

     |SI swCoef = 1;
          #101#8 = #101#8 + nUnid;
          #101#9 = nUnidTotal;
     |FINSI;

     |SI swCoef = 2;
          #101#11 = #101#11 + nUnid;
          #101#12 = nUnidTotal;
     |FINSI;

     #101#10 = "S";

     |SI FEstado = 0;
          |GRABA 020#101a;
     |SINO;
          |GRABA 020#101n;
     |FINSI;
|FPRC;

|PROCESO topemes;
     |SI nMes = 1; |O nMes = 3; |O nMes = 5; |O nMes = 7; |O nMes = 8;
     |O nMes = 10; |O nMes = 12;
          nTopeMes = 31;
     |SINO;
          |SI nMes = 2;
               nTopeMes = 28;
          |SINO;
               nTopeMes = 20;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaAreas;
     |SI #syke0014#2 = aDesdeAnyPro; |Y #syke0014#3 < nDesdeMesPro; |Y #syke0014#3 ! 99;
          |ACABA;
     |FINSI;
     |SI #syke0014#2 = aHastaAnyPro; |Y #syke0014#3 > nHastaMesPro; |Y #syke0014#3 ! 99;
          |ACABA;
     |FINSI;
     |SI #syke0014#3 = 99;
          swHay99 = 1;
     |FINSI;
/*
     || es mas complicado de lo que parece, de momento no

     aAlfa1 = #labtraba#36 % 102;
     aAlfa2 = #labtraba#36 % 402;
     aAlfa3 = #labtraba#36 % -104;
     nDiaAlta = aAlfa1;
     nMesAlta = aAlfa2;
     aAnyAlta = aAlfa3;
     |SI aAnyAlta = #syke0014#2; |Y nMesAlta = #syke0014#3;
          |SI nDiaAlta ! 1;
               nMes = nMesAlta;
               |HAZ topemes;
               nNume = (nDiaAlta - 1) / nTopeMes;

               nUnidTotal = nUnidTotal - nNume;
          |FINSI;
     |FINSI;
*/
     |DDEFECTO #101;

     #101#0 = #syke0014#0;         || empresa
     #101#1 = #syke0014#1;         || trabajador
     #101#2 = #syke0014#5;         || centro
     #101#4 = #syke0014#7;         || area
     #101#6 = #syke0014#9;         || seccion
     |LEE 101#101=;
     FEstado = FSalida;

     #101#3 = #syke0014#6;         || descripcion centro
     #101#5 = #syke0014#8;         || descripcion area
     #101#7 = #syke0014#10;        || descripcion seccion
     |SI swCoef = 1;
          |SI #syke0014#3 = 99;
               #101#8 = #101#8 + (#syke0014#11 * nUnid);    || unidades para prorrata
               #101#9 = nUnidTotal;               || unidades totales para prorrata
          |SINO;
               #101#8 = #101#8 + #syke0014#11;    || unidades para prorrata
               #101#9 = nUnidTotal;               || unidades totales para prorrata
               nUnid = nUnid - #syke0014#11;
          |FINSI;
     |FINSI;
     |SI swCoef = 2;
          |SI #syke0014#3 = 99;
               #101#11 = #101#11 + (#syke0014#11 * nUnid);    || unidades para prorrata
               #101#12 = nUnidTotal;               || unidades totales para prorrata
          |SINO;
               #101#11 = #101#11 + #syke0014#11;    || unidades para prorrata
               #101#12 = nUnidTotal;               || unidades totales para prorrata
               nUnid = nUnid - #syke0014#11;
          |FINSI;
     |FINSI;

     |SI FEstado = 0;
          |GRABA 020#101a;
     |SINO;
          |GRABA 020#101n;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaAreas;
     #syke0014#1;
     ;
     #labtraba#0, #labtraba#1, aDesdeAnyPro, 01, 01;
     #labtraba#0, #labtraba#1, aHastaAnyPro, 99, 99;
     ;
     NULL, BuscaAreas;
|FIN;

|PROCESO Prorrateos;
     |SI #0#3 [ 6
          nDesdeMesPro = 1;
     |SINO;
          nDesdeMesPro = 7;
     |FINSI;
     nHastaMesPro = #0#3;

     fFechaAlta = #labtraba#36;     || la fecha de alta contrato
     aAlfa1 = nDesdeMesPro; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#2;
     aFechaIni = "01" + "." + aAlfa1 + "." + aAlfa2;
     fFechaIni = aFechaIni;

     |SI fFechaAlta > fFechaIni;
          aAlfa1 = #labtraba#36 % 102;
          aAlfa2 = #labtraba#36 % 402;
          aAlfa3 = #labtraba#36 % -104;
          nDesdeMesPro = aAlfa2;
          nUnid = nHastaMesPro - nDesdeMesPro + 1;
     |SINO;
          nUnid = nHastaMesPro - nDesdeMesPro + 1;
     |FINSI;
     nUnidTotal = nUnid;


     aDesdeAnyPro = #0#2;
     aHastaAnyPro = #0#2;
     swCoef = 1;
     swHay99 = 0;

     |BUCLE BuscaAreas;       || busco para los coeficientes de la paga.

     aAlfa = nUnid; |QBF aAlfa;
     |SI swHay99 = 0; |Y aAlfa ! "0";     || si quedan unidades a repartir (no hay 99)
          |HAZ ElActual;
     |FINSI;
|FPRC;

|PROCESO BuscaCTO;
     ||OJO, solo para las pagas extras
     nNumCto = 0;
     #910#0 = #900#0;
     #910#1 = #900#1;
     #910#2 = #900#2;
     #910#3 = #900#3;
     #910#4 = nCto;
     |LEE 000#910=;
     |SI FSalida = 0;
          |SI #910#5 = "P";
               nNumCto = (#910#10 * #910#11) ! 2;
          |FINSI;
          |SI #910#5 = "V"; |Y #910#3 = 2;
               nNumCto = (#910#10 * #910#11) ! 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaCTOHis;
     nNumCto = 0;
     #910#0 = #900#0;
     #910#1 = #900#1;
     #910#2 = #900#2;
     #910#3 = #900#3;
     #910#4 = nCto;
     #910#12 = #900#66;
     |LEE 000#910=;
     |SI FSalida = 0;
          |SI #910#5 = "P";
               nNumCto = (#910#10 * #910#11) ! 2;
          |FINSI;
          |SI #910#5 = "V"; |Y #910#3 = 2;
               nNumCto = (#910#10 * #910#11) ! 2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Comprobacion;
     swNoSigas = 1;      || por defecto no sigo

     nMesAlta = 0;
     nAnyAlta = 0;

     aFechaAlta = #900#4;
     aMesAlta = aFechaAlta % 402;
     aAnyAlta = aFechaAlta % -104;
     nMesAlta = aMesAlta;
     nAnyAlta = aAnyAlta;

     |SI nMesAlta = #0#3; |Y nAnyAlta = #0#2;     || alta este mes
          swNoSigas = 0;
     |FINSI;

     nMesBaja = 0;
     nAnyBaja = 0;

     aFechaBaja = #900#5;
     |QBF aFechaBaja;
     fFechaBaja = aFechaBaja;
     |SI aFechaBaja ! ""; |Y aFechaBaja ! "..........";
          aMesBaja = aFechaBaja % 402;
          aAnyBaja = aFechaBaja % -104;
          nMesBaja = aMesBaja;
          nAnyBaja = aAnyBaja;
     |FINSI;

     |SI nMesBaja = #0#3; |Y nAnyBaja = #0#2;     || baja este mes
          swNoSigas = 0;
     |FINSI;

     #syke0013#0 = #900#0;         || cambio de campa¤a (area-seccion)
     #syke0013#1 = #900#1;         || durante este mes
     #syke0013#2 = #0#2;
     #syke0013#3 = #0#3;
     |LEE 000#syke0013.=;
     |SI FSalida = 0;
          swNoSigas = 0;
     |FINSI;
|FPRC;

|PROCESO ElCalculo;
     |HAZ PonaCero;
     nC0 = #900#0;
     #labempre#0 = #900#0;
     |LEE 000#labempre.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;
     aC1 = #labempre#2;

     #labtraba#0 = #900#0;
     #labtraba#1 = #900#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;

     |HAZ Comprobacion;
     |SI swNoSigas = 1;
          |ACABA;
     |FINSI;

     #nomauxi1#0 = #labtraba#62;
     |LEE 000#nomauxi1.=;
     |SI FSalida = 0;
          aC2 = #nomauxi1#0;
          aC3 = #nomauxi1#1;
     |FINSI;

     #nomauxi2#0 = #labtraba#62;
     #nomauxi2#1 = #labtraba#63;
     |LEE 000#nomauxi2.=;
     |SI FSalida = 0;
          aC8 = #nomauxi2#1;
          aC9 = #nomauxi2#2;
     |FINSI;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI FSalida = 0;
          nC6 = #labcentr#1;
          aC7 = #labcentr#2;
     |FINSI;

     nC4 = #labtraba#17;
     aC5 = #labtraba#18;
     nC10 = #labtraba#1;

     aC11 = #labtraba#2;
     ||fC12 = #900#4;
     || nos piden 28.12.2010 que no salga la fecha de alta sino la de antiguedad
     fC12 = #labtraba#34;
     fC13 = #900#5;

     nBrutoPaga = #900#47;
     nIRPFPaga = #900#17;

     |SI aProc = "nomcalca";
          nEmbargo = #900#104;
          nAnticPaga = #900#86;
     |FINSI;
     |SI aProc = "nomhicca";
          nEmbargo = #900#146;
          nAnticPaga = #900#128;
     |FINSI;
     |SI #0#10 = "P";
          |SI nBrutoPaga ! 0;
               || nEmbargo = nEmbargo / 2;
               nEmbargo = nEmbargo - ((nEmbargo * (#900#46 / (#900#46 + nBrutoPaga))) ! 2);
          |SINO;
               nEmbargo = 0;
          |FINSI;
     |FINSI;
     |SI #0#10 = "N";
          |SI nBrutoPaga ! 0;
               || nEmbargo = nEmbargo / 2;
               nEmbargo = (nEmbargo * (#900#46 / (#900#46 + nBrutoPaga))) ! 2;
          |FINSI;
     |FINSI;

     |SI #0#10 = "P";
          |CDEFECTO #900, 1;
     |FINSI;
/*
     |SI #0#10 = "N";
          nBrutoPaga = 0;
          nIRPFPaga = 0;
          nAnticPaga = 0;
     |FINSI;
*/
     nC17 = nBrutoPaga;

     nC23 = #900#41 + #900#42;

     nC25 = #900#46 + nBrutoPaga;
     nC26 = #900#48 + #900#49 + #900#50 + #900#51;
     nC28 = #900#54;

     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
          nC36 = #labtraba#234;
     |SINO;
          nC36 = 39;     || a pelo, hombre deberias leerlas del convenio pero
     |FINSI;             || "pa qui es y com le diuen"

     aC37 = #labtraba#7;
     nNume = #labtraba#45;

     |SI nNume < 400;
          aC38 = "indefinido";
     |SINO;
          aC38 = "temporal";
     |FINSI;

     |ABRE #nomtrato;
     #nomtrato#0 = 0111;
     #nomtrato#1 = nNume;
     |LEE 000#nomtrato.=;
     |SI FSalida = 0;
          aC38 = #nomtrato#2;
     |FINSI;
     |CIERRA #nomtrato;

     |SI aProc = "nomcalca";
          nC30 = nEmbargo;
          nC27 = #900#15 + #900#72 + nIRPFPaga + #900#71;
          nC27 = nC27 ! 2;

          nC29 = #900#71;
          nC31 = #900#52 + #900#53 + #900#89 + nAnticPaga;
          nC32 = #900#46 + nBrutoPaga - #900#48 - #900#49 - #900#15 - #900#72 - nIRPFPaga - #900#54 - #900#52 - #900#53 - #900#89 - nAnticPaga;

          ||Busca P.P. Extra Cto del 201 al 208
          nCto = 201; |HAZ BuscaCTO; nNum = nNumCto;
          nCto = 202; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 203; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 204; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 205; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 206; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 207; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 208; |HAZ BuscaCTO; nNum = nNum + nNumCto;

          |SI #0#10 = "N";
               nC17 = nNum + nC17;
          |FINSI;

          ||Busca Horas Mes Cto 431
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 431;
          |LEE 000#910=;
          |SI FSalida = 0;
               nC18 = #910#10;
          |FINSI;

          ||Busca Horas Mes Cto 909
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 909;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nHorasMes = nNum;
          |SINO;
               nHorasMes = 39;
          |FINSI;

          |SI #900#3 = 2;
               ||Busca Vacaciones Cto 125
               #910#0 = #900#0;
               #910#1 = #900#1;
               #910#2 = #900#2;
               #910#3 = #900#3;
               #910#4 = 125;
               |LEE 000#910=;
               |SI FSalida = 0;
                    nNum = #910#10 * #910#11;
                    nC16 = nNum;
               |FINSI;

               ||Busca Indeminizacion 415
               #910#0 = #900#0;
               #910#1 = #900#1;
               #910#2 = #900#2;
               #910#3 = #900#3;
               #910#4 = 415
               |LEE 000#910=;
               |SI FSalida = 0;
                    nC22 = #910#10 * #910#11;
               |FINSI;
          |FINSI;

          ||Busca Transporte Cto. 401
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 401;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nC20 = nNum;
          |FINSI;

          ||Busca Bonus Cto. 109
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 109;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nC21 = nNum;
          |FINSI;

          || Busca Salario Base
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 101;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nSalarioBase = nNum;
          |FINSI;
     |FINSI;

     |SI aProc = "nomhicca";
          nC30 = nEmbargo;
          nC27 = #900#15 + #900#111 + nIRPFPaga + #900#110;
          nC29 = #900#110;
          nC31 = #900#52 + #900#53 + #900#131 + nAnticPaga;
          nC32 = #900#46 + nBrutoPaga - #900#48 - #900#49 - #900#15 - #900#111 - nIRPFPaga - #900#52 - #900#53 - #900#131 - nAnticPaga;

          ||Busca P.P. Extra Cto del 201 al 208
          nCto = 201; |HAZ BuscaCTOHis; nNum = nNumCto;
          nCto = 202; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          nCto = 203; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          nCto = 204; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          nCto = 205; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          nCto = 206; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          nCto = 207; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          nCto = 208; |HAZ BuscaCTOHis; nNum = nNum + nNumCto;
          |SI #0#10 = "N";
               nC17 = nNum + nC17;
          |FINSI;

          ||Busca Horas Mes Cto 431
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 431;
          #910#12 = #900#66
          |LEE 000#910=;
          |SI FSalida = 0;
               nC18 = #910#10;
          |FINSI;

          ||Busca Horas Mes Cto 909
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 909;
          #910#12 = #900#66;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nHorasMes = nNum;
          |FINSI;

          |SI #900#3 = 2;
               ||Busca Vacaciones Cto 125
               #910#0 = #900#0;
               #910#1 = #900#1;
               #910#2 = #900#2;
               #910#3 = #900#3;
               #910#4 = 125;
               #910#12 = #900#66;
               |LEE 000#910=;
               |SI FSalida = 0;
                    nNum = #910#10 * #910#11;
                    nC16 = nNum;
               |FINSI;

               ||Busca Indeminizacion 415
               #910#0 = #900#0;
               #910#1 = #900#1;
               #910#2 = #900#2;
               #910#3 = #900#3;
               #910#4 = 415
               #910#12 = #900#66;
               |LEE 000#910=;
               |SI FSalida = 0;
                    nC22 = #910#10 * #910#11;
               |FINSI;
          |FINSI;

          ||Busca Bonus Cto. 109
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 109;
          #910#12 = #900#66;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nC21 = nNum;
          |FINSI;

          || Busca Salario Base
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 101;
          #910#12 = #900#66;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nSalarioBase = nNum;
          |FINSI;

          ||Busca Transporte Cto. 401
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 401;
          #910#12 = #900#66;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nC20 = nNum;
          |FINSI;
     |FINSI;

     |SI aProc = "nomcalac";
          nC27 = #900#15 + #900#72 + nIRPFPaga + #900#71;
          nC29 = #900#71;
          nC31 = #900#52 + #900#53 + #900#54;
          nC32 = #900#46 + nBrutoPaga - #900#48 - #900#49 - #900#15 - #900#72 - nIRPFPaga - #900#54 - #900#52 - #900#53;

          ||Busca P.P. Extra Cto del 201 al 208
          nCto = 201; |HAZ BuscaCTO; nNum = nNumCto;
          nCto = 202; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 203; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 204; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 205; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 206; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 207; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          nCto = 208; |HAZ BuscaCTO; nNum = nNum + nNumCto;
          |SI #0#10 = "N";
               nC17 = nNum + nC17;
          |FINSI;

          ||Busca Horas Mes Cto 431
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 431;
          |LEE 000#910=;
          |SI FSalida = 0;
               nC18 = #910#10;
          |FINSI;

          || Busca Horas Mes Cto 909

          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 909;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nHorasMes = nNum;
          |FINSI;

          |SI #900#3 = 2;
               ||Busca Vacaciones Cto 125
               #910#0 = #900#0;
               #910#1 = #900#1;
               #910#2 = #900#2;
               #910#3 = #900#3;
               #910#4 = 125;
               |LEE 000#910=;
               |SI FSalida = 0;
                    nNum = #910#10 * #910#11;
                    nC16 = nNum;
               |FINSI;

               ||Busca Indeminizacion 415
               #910#0 = #900#0;
               #910#1 = #900#1;
               #910#2 = #900#2;
               #910#3 = #900#3;
               #910#4 = 415
               |LEE 000#910=;
               |SI FSalida = 0;
                    nC22 = #910#10 * #910#11;
               |FINSI;
          |FINSI;

          ||Busca Transporte Cto. 401
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 401;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nC20 = nNum;
          |FINSI;

          ||Busca Bonus Cto. 109
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 109;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nC21 = nNum;
          |FINSI;

          ||Busca Salario Base
          #910#0 = #900#0;
          #910#1 = #900#1;
          #910#2 = #900#2;
          #910#3 = #900#3;
          #910#4 = 101;
          |LEE 000#910=;
          |SI FSalida = 0;
               nNum = #910#10 * #910#11;
               nSalarioBase = nNum;
          |FINSI;
     |FINSI;

     |SI #0#10 = "P";
          nC18 = 0;
          nC16 = 0;
          nC22 = 0;
          nC20 = 0;
          nC21 = 0;
     |FINSI;

     nHoras = #labtraba#234;
     |SI nHoras ! 0;
          ||nPorJornada = (nHoras / nHorasMes) ! 2;
          ||Aclara Tema Cto 909
          nPorJornada = (nHoras / 39) ! 2;
     |SINO;
          nPorJornada = 0;
     |FINSI;

     nC14 = nPorJornada;
     nC32 = nC32 - nC30; || EMBARGOS
     nC32 = nC25 - nC26 - nC27 - nC28 - nC30 - nC31;
     nC15 = nC25 - nC24 - nC23 - nC22 - nC21 - nC20 - nC19 - nC18 - nC17 - nC16;

     nC39 = nSalarioBase;
     nC40 = nC15 - nSalarioBase;

     || xxxxxxxxxxxxxxxxxxx
     nC19 = nC15 + nC16 + nC17 + nC18;

     nC33 = #900#45 - #900#57 - #900#58;
     nC34 = nC33 + nC25;
     nC35 = #900#3;

     nMes = #900#2;

     |SI #0#10 = "P";
          |HAZ Prorrateos;
          |BUCLE GrabaCamposNuevo;
     |SINO;
          #syke0014#0 = nC0;
          #syke0014#1 = nC10;
          #syke0014#2 = #0#2;
          #syke0014#3 = nMes;
          #syke0014#4 = 1;
          |LEE 000#syke0014.];
          |SI FSalida = 0; |Y #syke0014#0 = nC0; |Y #syke0014#1 = nC10; |Y #syke0014#2 = #0#2; |Y #syke0014#3 = nMes;
               |HAZ IniciaAcum;
               |PARA; |SI FSalida = 0; |Y #syke0014#0 = nC0; |Y #syke0014#1 = nC10; |Y #syke0014#2 = #0#2; |Y #syke0014#3 = nMes; |HACIENDO;
                    aC2 = #syke0014#7;
                    aC3 = #syke0014#8;
                    nC6 = #syke0014#5;
                    aC7 = #syke0014#6;
                    aC8 = #syke0014#9;
                    aC9 = #syke0014#10;
                    |HAZ IniciaParciales;
                    |HAZ GrabaTmpProrrata;
                    |LEE 000#syke0014.s;
               |SIGUE;
          |SINO;
               #syke0014#0 = nC0;
               #syke0014#1 = nC10;
               #syke0014#2 = #0#2;
               #syke0014#3 = 99;
               #syke0014#4 = 1;
               |LEE 000#syke0014.];
               |SI FSalida = 0; |Y #syke0014#0 = nC0; |Y #syke0014#1 = nC10; |Y #syke0014#2 = #0#2; |Y #syke0014#3 = 99;
                    |HAZ IniciaAcum;
                    |PARA; |SI FSalida = 0; |Y #syke0014#0 = nC0; |Y #syke0014#1 = nC10; |Y #syke0014#2 = #0#2; |Y #syke0014#3 = 99; |HACIENDO;
                         aC2 = #syke0014#7;
                         aC3 = #syke0014#8;
                         nC6 = #syke0014#5;
                         aC7 = #syke0014#6;
                         aC8 = #syke0014#9;
                         aC9 = #syke0014#10;
                         |HAZ IniciaParciales;
                         |HAZ GrabaTmpProrrata;
                         |LEE 000#syke0014.s;
                    |SIGUE;
               |SINO;
                    |HAZ GrabaTmp;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Graba022;
     |SI nConcepto = 26; |O nConcepto = 27;
     |O nConcepto = 28; |O nConcepto = 29;
     |O nConcepto = 30; |O nConcepto = 31; |O nConcepto = 32;
          nImporte = (-1) * nImporte;
     |FINSI;
     nImporte = nImporte ! 2;

     |SI nImporte ! 0;
          |DDEFECTO #200;
          #syke0022#0 = nConcepto;
          |LEE 000#syke0022.=;
          aAccount = #syke0022#2;
          |QBF aAccount;
          |SI nConcepto = 017;
               |SI #0#3 ] 7;                 || paga de diciembre se acumula
                    aAccount = "6400140000"; || en esta cuenta, no en la
               |FINSI;                       || del mantenimiento
          |FINSI;
          |SI aAccount ! "";
               swAgrupa = 0;
               aAlfa1 = "";
               aAlfa2 = "";
               aAlfa1 = aAccount % 103;
               |SI aAlfa1 = "460"; |O aAlfa1 = "461"; |O aAlfa1 = "476";
                    swAgrupa = 1;
               |FINSI;
               aAlfa2 = aAccount % 104;
               |SI aAlfa2 = "4751";
                    swAgrupa = 1;
               |FINSI;

               |SI swAgrupa = 0;
                    #200#0 = aUnit;
                    #200#1 = aActivity;
               |SINO;
                    #200#0 = "0515999999";
                    #200#1 = "9999999";
               |FINSI;
               #200#2 = aAccount;
               |LEE 101#200=;
               |SI FSalida = 0;
                    #200#3 = #200#3 + nImporte;
                    |GRABA 020#200a;
               |SINO;
                    #200#3 = #200#3 + nImporte;
                    |GRABA 020#200n;
                    nTotalLineas2 = nTotalLineas2 + 1;
               |FINSI;
               |LIBERA #200;

               || si empieza por la 642 hay que agruparlo en la 4760000000
               || con signo negativo, para la 6420900000 que es la seg.
               || soc. del trabajador no lo pongo negativo porque
               || ya lo puse al principio del proceso (concepto 26)

               |DDEFECTO #200;
               aAlfa = aAccount % 103;
               |SI aAlfa = "642";
                    |SI aAccount ! "6420900000";
                         nImporte = (-1) * nImporte;
                    |FINSI;

                    #200#0 = "0515999999";
                    #200#1 = "9999999";
                    #200#2 = "4760000000";
                    |LEE 101#200=;
                    |SI FSalida = 0;
                         #200#3 = #200#3 + nImporte;
                         |GRABA 020#200a;
                    |SINO;
                         #200#3 = #200#3 + nImporte;
                         |GRABA 020#200n;
                         nTotalLineas2 = nTotalLineas2 + 1;
                    |FINSI;
                    |LIBERA #200;
               |FINSI;
               |SI nConcepto = 026;          || seg. soc. trabajador
                    |DDEFECTO #200;
                    #200#0 = aUnit;          || hay que acumularla positiva
                    #200#1 = aActivity;      || en la 6420000000
                    #200#2 = "6420000000";
                    |LEE 101#200=;
                    nImporte = nImporte * (-1);
                    |SI FSalida = 0;
                         #200#3 = #200#3 + nImporte;
                         |GRABA 020#200a;
                    |SINO;
                         #200#3 = #200#3 + nImporte;
                         |GRABA 020#200n;
                         nTotalLineas2 = nTotalLineas2 + 1;
                    |FINSI;
                    |LIBERA #200;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaTMP_UploadFile;
     #syke0020#3 = #labtraba#0;
     #syke0020#4 = #labtraba#77;
     #syke0020#0 = #100#2;
     |LEE 000#syke0020.=;
     |SI FSalida = 0;
          aUnit = #syke0020#2;
          aUnit = "0515" + aUnit;
     |SINO;
          aUnit = "";
     |FINSI;

     #syke0021#4 = #labtraba#0;
     #syke0021#5 = #labtraba#77;
     #syke0021#0 = #100#2;
     #syke0021#1 = #100#8;
     |LEE 000#syke0021.=;
     |SI FSalida = 0;
          aActivity = #syke0021#3;
     |SINO;
          aActivity = "";
     |FINSI;

     |SI aActivity = "";
          aAlfa = #labtraba#77; |QBF aAlfa; aAlfa = aAlfa + "-";

          aAlfa = aAlfa + #100#2; |QBF aAlfa; aAlfa = aAlfa + "-";

          aAlfa = aAlfa + #100#8; |QBF aAlfa;

          aActivity = aAlfa;

          #201#0 = #labtraba#0;
          #201#1 = #labtraba#1;
          #201#2 = #labtraba#77;
          #201#3 = #100#2;
          #201#4 = #100#8;
          #201#5 = #labtraba#2;
          #201#6 = "TRA";
          |LEE 000#201=;
          |SI FSalida ! 0;
               |GRABA 020#201n;
               |LIBERA #201;
          |FINSI;
     |FINSI;

     |SI nC15 ! 0; nConcepto = 15; nImporte = nC15; |HAZ Graba022; |FINSI;
     |SI nC16 ! 0; nConcepto = 16; nImporte = nC16; |HAZ Graba022; |FINSI;
     |SI nC17 ! 0; nConcepto = 17; nImporte = nC17; |HAZ Graba022; |FINSI;
     |SI nC18 ! 0; nConcepto = 18; nImporte = nC18; |HAZ Graba022; |FINSI;
     |SI nC19 ! 0; nConcepto = 19; nImporte = nC19; |HAZ Graba022; |FINSI;
     |SI nC20 ! 0; nConcepto = 20; nImporte = nC20; |HAZ Graba022; |FINSI;
     |SI nC21 ! 0; nConcepto = 21; nImporte = nC21; |HAZ Graba022; |FINSI;
     |SI nC22 ! 0; nConcepto = 22; nImporte = nC22; |HAZ Graba022; |FINSI;
     |SI nC23 ! 0; nConcepto = 23; nImporte = nC23; |HAZ Graba022; |FINSI;
     |SI nC24 ! 0; nConcepto = 24; nImporte = nC24; |HAZ Graba022; |FINSI;
     |SI nC25 ! 0; nConcepto = 25; nImporte = nC25; |HAZ Graba022; |FINSI;
     |SI nC26 ! 0; nConcepto = 26; nImporte = nC26; |HAZ Graba022; |FINSI;
     |SI nC27 ! 0; nConcepto = 27; nImporte = nC27; |HAZ Graba022; |FINSI;
     |SI nC28 ! 0; nConcepto = 28; nImporte = nC28; |HAZ Graba022; |FINSI;
     |SI nC29 ! 0; nConcepto = 29; nImporte = nC29; |HAZ Graba022; |FINSI;
     |SI nC30 ! 0; nConcepto = 30; nImporte = nC30; |HAZ Graba022; |FINSI;
     |SI nC31 ! 0; nConcepto = 31; nImporte = nC31; |HAZ Graba022; |FINSI;
     |SI nC32 ! 0; nConcepto = 32; nImporte = nC32; |HAZ Graba022; |FINSI;
     |SI nC33 ! 0; nConcepto = 33; nImporte = nC33; |HAZ Graba022; |FINSI;
     |SI nC34 ! 0; nConcepto = 34; nImporte = nC34; |HAZ Graba022; |FINSI;
|FPRC;

|PROCESO GrabaTmp;
     |DDEFECTO #100;

     #100#0 = nC0;
     #100#6 = nC6;
     #100#2 = aC2;
     #100#8 = aC8;
     #100#10 = nC10;
     #100#35 = nC35;
     |LEE 101#100=;
     FEstado = FSalida;

     #100#0 = nC0;
     #100#1 = aC1;
     #100#2 = aC2;
     #100#3 = aC3;
     #100#4 = nC4;
     #100#5 = aC5;
     #100#6 = nC6;
     #100#7 = aC7;
     #100#8 = aC8;
     #100#9 = aC9;
     #100#10 = nC10;
     #100#11 = aC11;
     #100#12 = fC12;
     #100#13 = fC13;
     #100#14 = nC14 * 100;
     #100#15 = #100#15 + nC15;
     #100#16 = #100#16 + nC16;
     #100#17 = #100#17 + nC17;
     #100#18 = #100#18 + nC18;
     #100#19 = #100#19 + nC19;
     #100#20 = #100#20 + nC20;
     #100#21 = #100#21 + nC21;
     #100#22 = #100#22 + nC22;
     #100#23 = #100#23 + nC23;
     #100#24 = #100#24 + nC24;
     #100#25 = #100#25 + nC25;
     #100#26 = #100#26 + nC26;
     #100#27 = #100#27 + nC27;
     #100#28 = #100#28 + nC28;
     #100#29 = #100#29 + nC29;
     #100#30 = #100#30 + nC30;
     #100#31 = #100#31 + nC31;
     #100#32 = #100#32 + nC32;
     #100#33 = #100#33 + nC33;
     #100#34 = #100#34 + nC34;
     #100#35 = nC35;
     #100#36 = nC36;
     #100#37 = aC37;
     #100#38 = aC38;
     #100#39 = #100#39 + nC39;
     #100#40 = #100#40 + nC40;

     |SI FEstado = 0;
          |GRABA 020#100a;
     |SINO;
          |GRABA 020#100n;
          nTotalLineas1 = nTotalLineas1 + 1 ;
     |FINSI;

     ||HAZ GrabaTMP_UploadFile;

     |LIBERA #100;
|FPRC;

|PROCESO GrabaTMP_UploadFile_P;
     #syke0020#3 = #labtraba#0;
     #syke0020#4 = #syke0014#5;
     #syke0020#0 = #100#2;
     |LEE 000#syke0020.=;
     |SI FSalida = 0;
          aUnit = #syke0020#2;
          aUnit = "0515" + aUnit;
     |SINO;
          aUnit = "";
     |FINSI;

     #syke0021#4 = #labtraba#0;
     #syke0021#5 = #syke0014#5;
     #syke0021#0 = #100#2;
     #syke0021#1 = #100#8;
     |LEE 000#syke0021.=;
     |SI FSalida = 0;
          aActivity = #syke0021#3;
     |SINO;
          aActivity = "";
     |FINSI;

     |SI aActivity = "";
          aAlfa = #syke0014#5; |QBF aAlfa; aAlfa = aAlfa + "-";

          aAlfa = aAlfa + #100#2; |QBF aAlfa; aAlfa = aAlfa + "-";

          aAlfa = aAlfa + #100#8; |QBF aAlfa;

          aActivity = aAlfa;

          #201#0 = #labtraba#0;
          #201#1 = #labtraba#1;
          #201#2 = #syke0014#5;
          #201#3 = #100#2;
          #201#4 = #100#8;
          #201#5 = #labtraba#2;
          #201#6 = "PRO";
          |LEE 000#201=;
          |SI FSalida ! 0;
               |GRABA 020#201n;
               |LIBERA #201;
          |FINSI;
     |FINSI;

     |SI nC15 ! 0; nConcepto = 15; nImporte = nParcialC15; |HAZ Graba022; |FINSI;
     |SI nC16 ! 0; nConcepto = 16; nImporte = nParcialC16; |HAZ Graba022; |FINSI;
     |SI nC17 ! 0; nConcepto = 17; nImporte = nParcialC17; |HAZ Graba022; |FINSI;
     |SI nC18 ! 0; nConcepto = 18; nImporte = nParcialC18; |HAZ Graba022; |FINSI;
     |SI nC19 ! 0; nConcepto = 19; nImporte = nParcialC19; |HAZ Graba022; |FINSI;
     |SI nC20 ! 0; nConcepto = 20; nImporte = nParcialC20; |HAZ Graba022; |FINSI;
     |SI nC21 ! 0; nConcepto = 21; nImporte = nParcialC21; |HAZ Graba022; |FINSI;
     |SI nC22 ! 0; nConcepto = 22; nImporte = nParcialC22; |HAZ Graba022; |FINSI;
     |SI nC23 ! 0; nConcepto = 23; nImporte = nParcialC23; |HAZ Graba022; |FINSI;
     |SI nC24 ! 0; nConcepto = 24; nImporte = nParcialC24; |HAZ Graba022; |FINSI;
     |SI nC25 ! 0; nConcepto = 25; nImporte = nParcialC25; |HAZ Graba022; |FINSI;
     |SI nC26 ! 0; nConcepto = 26; nImporte = nParcialC26; |HAZ Graba022; |FINSI;
     |SI nC27 ! 0; nConcepto = 27; nImporte = nParcialC27; |HAZ Graba022; |FINSI;
     |SI nC28 ! 0; nConcepto = 28; nImporte = nParcialC28; |HAZ Graba022; |FINSI;
     |SI nC29 ! 0; nConcepto = 29; nImporte = nParcialC29; |HAZ Graba022; |FINSI;
     |SI nC30 ! 0; nConcepto = 30; nImporte = nParcialC30; |HAZ Graba022; |FINSI;
     |SI nC31 ! 0; nConcepto = 31; nImporte = nParcialC31; |HAZ Graba022; |FINSI;
     |SI nC32 ! 0; nConcepto = 32; nImporte = nParcialC32; |HAZ Graba022; |FINSI;
     |SI nC33 ! 0; nConcepto = 33; nImporte = nParcialC33; |HAZ Graba022; |FINSI;
     |SI nC34 ! 0; nConcepto = 34; nImporte = nParcialC34; |HAZ Graba022; |FINSI;
|FPRC;

|PROCESO AplicaDiferencia;
     |SI nCampo = 15; nParcialC15 = nParcialC15 - nDiferencia; |FINSI;
     |SI nCampo = 16; nParcialC16 = nParcialC16 - nDiferencia; |FINSI;
     |SI nCampo = 17; nParcialC17 = nParcialC17 - nDiferencia; |FINSI;
     |SI nCampo = 18; nParcialC18 = nParcialC18 - nDiferencia; |FINSI;
     |SI nCampo = 19; nParcialC19 = nParcialC19 - nDiferencia; |FINSI;
     |SI nCampo = 20; nParcialC20 = nParcialC20 - nDiferencia; |FINSI;
     |SI nCampo = 21; nParcialC21 = nParcialC21 - nDiferencia; |FINSI;
     |SI nCampo = 22; nParcialC22 = nParcialC22 - nDiferencia; |FINSI;
     |SI nCampo = 23; nParcialC23 = nParcialC23 - nDiferencia; |FINSI;
     |SI nCampo = 24; nParcialC24 = nParcialC24 - nDiferencia; |FINSI;
     |SI nCampo = 25; nParcialC25 = nParcialC25 - nDiferencia; |FINSI;
     |SI nCampo = 26; nParcialC26 = nParcialC26 - nDiferencia; |FINSI;
     |SI nCampo = 27; nParcialC27 = nParcialC27 - nDiferencia; |FINSI;
     |SI nCampo = 28; nParcialC28 = nParcialC28 - nDiferencia; |FINSI;
     |SI nCampo = 29; nParcialC29 = nParcialC29 - nDiferencia; |FINSI;
     |SI nCampo = 30; nParcialC30 = nParcialC30 - nDiferencia; |FINSI;
     |SI nCampo = 31; nParcialC31 = nParcialC31 - nDiferencia; |FINSI;
     |SI nCampo = 32; nParcialC32 = nParcialC32 - nDiferencia; |FINSI;
     |SI nCampo = 33; nParcialC33 = nParcialC33 - nDiferencia; |FINSI;
     |SI nCampo = 34; nParcialC34 = nParcialC34 - nDiferencia; |FINSI;
     |SI nCampo = 39; nParcialC39 = nParcialC39 - nDiferencia; |FINSI;
     |SI nCampo = 40; nParcialC40 = nParcialC40 - nDiferencia; |FINSI;
|FPRC;

|PROCESO AsignaVariable;
     |SI nCampo = 15; nValorTotal = nC15; |FINSI;
     |SI nCampo = 16; nValorTotal = nC16; |FINSI;
     |SI nCampo = 17; nValorTotal = nC17; |FINSI;
     |SI nCampo = 18; nValorTotal = nC18; |FINSI;
     |SI nCampo = 19; nValorTotal = nC19; |FINSI;
     |SI nCampo = 20; nValorTotal = nC20; |FINSI;
     |SI nCampo = 21; nValorTotal = nC21; |FINSI;
     |SI nCampo = 22; nValorTotal = nC22; |FINSI;
     |SI nCampo = 23; nValorTotal = nC23; |FINSI;
     |SI nCampo = 24; nValorTotal = nC24; |FINSI;
     |SI nCampo = 25; nValorTotal = nC25; |FINSI;
     |SI nCampo = 26; nValorTotal = nC26; |FINSI;
     |SI nCampo = 27; nValorTotal = nC27; |FINSI;
     |SI nCampo = 28; nValorTotal = nC28; |FINSI;
     |SI nCampo = 29; nValorTotal = nC29; |FINSI;
     |SI nCampo = 30; nValorTotal = nC30; |FINSI;
     |SI nCampo = 31; nValorTotal = nC31; |FINSI;
     |SI nCampo = 32; nValorTotal = nC32; |FINSI;
     |SI nCampo = 33; nValorTotal = nC33; |FINSI;
     |SI nCampo = 34; nValorTotal = nC34; |FINSI;
     |SI nCampo = 39; nValorTotal = nC39; |FINSI;
     |SI nCampo = 40; nValorTotal = nC40; |FINSI;

     nValorParcial = (nValorTotal * #syke0014#11) ! 2;
|FPRC;

|PROCESO Acumula;
     nAcumulado = 0;
     |SI nCampo = 15;
          nAcumC15 = nAcumC15 + nValorParcial; nAcumulado = nAcumC15;
          nParcialC15 = nValorParcial;
     |FINSI;
     |SI nCampo = 16;
          nAcumC16 = nAcumC16 + nValorParcial; nAcumulado = nAcumC16;
          nParcialC16 = nValorParcial;
     |FINSI;
     |SI nCampo = 17;
          nAcumC17 = nAcumC17 + nValorParcial; nAcumulado = nAcumC17;
          nParcialC17 = nValorParcial;
     |FINSI;
     |SI nCampo = 18;
          nAcumC18 = nAcumC18 + nValorParcial; nAcumulado = nAcumC18;
          nParcialC18 = nValorParcial;
     |FINSI;
     |SI nCampo = 19;
          nAcumC19 = nAcumC19 + nValorParcial; nAcumulado = nAcumC19;
          nParcialC19 = nValorParcial;
     |FINSI;
     |SI nCampo = 20;
          nAcumC20 = nAcumC20 + nValorParcial; nAcumulado = nAcumC20;
          nParcialC20 = nValorParcial;
     |FINSI;
     |SI nCampo = 21;
          nAcumC21 = nAcumC21 + nValorParcial; nAcumulado = nAcumC21;
          nParcialC21 = nValorParcial;
     |FINSI;
     |SI nCampo = 22;
          nAcumC22 = nAcumC22 + nValorParcial; nAcumulado = nAcumC22;
          nParcialC22 = nValorParcial;
     |FINSI;
     |SI nCampo = 23;
          nAcumC23 = nAcumC23 + nValorParcial; nAcumulado = nAcumC23;
          nParcialC23 = nValorParcial;
     |FINSI;
     |SI nCampo = 24;
          nAcumC24 = nAcumC24 + nValorParcial; nAcumulado = nAcumC24;
          nParcialC24 = nValorParcial;
     |FINSI;
     |SI nCampo = 25;
          nAcumC25 = nAcumC25 + nValorParcial; nAcumulado = nAcumC25;
          nParcialC25 = nValorParcial;
     |FINSI;
     |SI nCampo = 26;
          nAcumC26 = nAcumC26 + nValorParcial; nAcumulado = nAcumC26;
          nParcialC26 = nValorParcial;
     |FINSI;
     |SI nCampo = 27;
          nAcumC27 = nAcumC27 + nValorParcial; nAcumulado = nAcumC27;
          nParcialC27 = nValorParcial;
     |FINSI;
     |SI nCampo = 28;
          nAcumC28 = nAcumC28 + nValorParcial; nAcumulado = nAcumC28;
          nParcialC28 = nValorParcial;
     |FINSI;
     |SI nCampo = 29;
          nAcumC29 = nAcumC29 + nValorParcial; nAcumulado = nAcumC29;
          nParcialC29 = nValorParcial;
     |FINSI;
     |SI nCampo = 30;
          nAcumC30 = nAcumC30 + nValorParcial; nAcumulado = nAcumC30;
          nParcialC30 = nValorParcial;
     |FINSI;
     |SI nCampo = 31;
          nAcumC31 = nAcumC31 + nValorParcial; nAcumulado = nAcumC31;
          nParcialC31 = nValorParcial;
     |FINSI;
     |SI nCampo = 32;
          nAcumC32 = nAcumC32 + nValorParcial; nAcumulado = nAcumC32;
          nParcialC32 = nValorParcial;
     |FINSI;
     |SI nCampo = 33;
          nAcumC33 = nAcumC33 + nValorParcial; nAcumulado = nAcumC33;
          nParcialC33 = nValorParcial;
     |FINSI;
     |SI nCampo = 34;
          nAcumC34 = nAcumC34 + nValorParcial; nAcumulado = nAcumC34;
          nParcialC34 = nValorParcial;
     |FINSI;
     |SI nCampo = 39;
          nAcumC39 = nAcumC39 + nValorParcial; nAcumulado = nAcumC39;
          nParcialC39 = nValorParcial;
     |FINSI;
     |SI nCampo = 40;
          nAcumC40 = nAcumC40 + nValorParcial; nAcumulado = nAcumC40;
          nParcialC40 = nValorParcial;
     |FINSI;
|FPRC;

|PROCESO GrabaTmpProrrata;
     |DDEFECTO #100;

     #100#0 = nC0;
     #100#6 = nC6;
     #100#2 = aC2;
     #100#8 = aC8;
     #100#10 = nC10;
     #100#35 = nC35;
     |LEE 101#100=;
     FEstado = FSalida;

     #100#0 = nC0;
     #100#1 = aC1;
     #100#2 = aC2;
     #100#3 = aC3;
     #100#4 = nC4;
     #100#5 = aC5;
     #100#6 = nC6;
     #100#7 = aC7;
     #100#8 = aC8;
     #100#9 = aC9;
     #100#10 = nC10;
     #100#11 = aC11;
     #100#12 = fC12;
     #100#13 = fC13;
     #100#14 = nC14 * #syke0014#11 * 100;
     #100#36 = nC36;
     #100#37 = aC37;
     #100#38 = aC38;

     |PARA nCampo = 15; |SI nCampo [ 34; |HACIENDO nCampo = nCampo + 1;
          |HAZ AsignaVariable;
          || #100nCampo = #100nCampo + ((nValorTotal * #syke0014#11) ! 2);
          #100nCampo = #100nCampo + nValorParcial;
          |HAZ Acumula;
          nDiferencia = (nAcumulado - nValorTotal) ! 2;
          |SI nDiferencia ! 0;
               |SI -0.02 [ nDiferencia; |Y nDiferencia [ 0.02;
                    #100nCampo = #100nCampo - nDiferencia;
                    |HAZ AplicaDiferencia;
               |FINSI;
          |FINSI;
     |SIGUE;

     #100#35 = nC35;

     |PARA nCampo = 39; |SI nCampo [ 40; |HACIENDO nCampo = nCampo + 1;
          |HAZ AsignaVariable;
          || #100nCampo = #100nCampo + ((nValorTotal * #syke0014#11) ! 2);
          #100nCampo = #100nCampo + nValorParcial;
          |HAZ Acumula;
          nDiferencia = (nAcumulado - nValorTotal) ! 2;
          |SI nDiferencia ! 0;
               |SI -0.02 [ nDiferencia; |Y nDiferencia [ 0.02;
                    #100nCampo = #100nCampo - nDiferencia;
                    |HAZ AplicaDiferencia;
               |FINSI;
          |FINSI;
     |SIGUE;

/*
     #100#15 = #100#15 + (nC15 * #syke0014#11);
     #100#16 = #100#16 + (nC16 * #syke0014#11);
     #100#17 = #100#17 + (nC17 * #syke0014#11);
     #100#18 = #100#18 + (nC18 * #syke0014#11);
     #100#19 = #100#19 + (nC19 * #syke0014#11);
     #100#20 = #100#20 + (nC20 * #syke0014#11);
     #100#21 = #100#21 + (nC21 * #syke0014#11);
     #100#22 = #100#22 + (nC22 * #syke0014#11);
     #100#23 = #100#23 + (nC23 * #syke0014#11);
     #100#24 = #100#24 + (nC24 * #syke0014#11);
     #100#25 = #100#25 + (nC25 * #syke0014#11);
     #100#26 = #100#26 + (nC26 * #syke0014#11);
     #100#27 = #100#27 + (nC27 * #syke0014#11);
     #100#28 = #100#28 + (nC28 * #syke0014#11);
     #100#29 = #100#29 + (nC29 * #syke0014#11);
     #100#30 = #100#30 + (nC30 * #syke0014#11);
     #100#31 = #100#31 + (nC31 * #syke0014#11);
     #100#32 = #100#32 + (nC32 * #syke0014#11);
     #100#33 = #100#33 + (nC33 * #syke0014#11);
     #100#34 = #100#34 + (nC34 * #syke0014#11);
     #100#35 = nC35;
*/

     |SI FEstado = 0;
          |GRABA 020#100a;
     |SINO;
          |GRABA 020#100n;
          nTotalLineas1 = nTotalLineas1 + 1 ;
     |FINSI;

     ||HAZ GrabaTMP_UploadFile_P;

     |LIBERA #100;
|FPRC;

|PROCESO IniciaAcum;
     nAcumC15 = 0;
     nAcumC16 = 0; nAcumC17 = 0; nAcumC18 = 0; nAcumC19 = 0; nAcumC20 = 0;
     nAcumC21 = 0; nAcumC22 = 0; nAcumC23 = 0; nAcumC24 = 0; nAcumC25 = 0;
     nAcumC26 = 0; nAcumC27 = 0; nAcumC28 = 0; nAcumC29 = 0; nAcumC30 = 0;
     nAcumC31 = 0; nAcumC32 = 0; nAcumC33 = 0; nAcumC34 = 0;
     nAcumC39 = 0; nAcumC40 = 0;
|FPRC;

|PROCESO IniciaParciales;
     nParcialC15 = 0;
     nParcialC16 = 0; nParcialC17 = 0; nParcialC18 = 0; nParcialC19 = 0; nParcialC20 = 0;
     nParcialC21 = 0; nParcialC22 = 0; nParcialC23 = 0; nParcialC24 = 0; nParcialC25 = 0;
     nParcialC26 = 0; nParcialC27 = 0; nParcialC28 = 0; nParcialC29 = 0; nParcialC30 = 0;
     nParcialC31 = 0; nParcialC32 = 0; nParcialC33 = 0; nParcialC34 = 0;
     nParcialC39 = 0; nParcialC40 = 0;
|FPRC;

|DEFBUCLE nomhicca;
     #900#1005;
     ;
     #0#0, #0#14, nAnyo, #0#3, 0;
     #0#1, #0#15, nAnyo, #0#3, 2;
     ;
     NULL, ElCalculo;
|FIN;

|DEFBUCLE nomhiccawH;
     #900#1005;
     ;
     #0#0, #0#14, nAnyo, #0#3, 5;
     #0#1, #0#15, nAnyo, #0#3, 20;
     ;
     NULL, ElCalculo;
|FIN;

|DEFBUCLE nomcalca;
     #900#1004;
     ;
     #0#0, #0#14, #0#3, 0;
     #0#1, #0#15, #0#3, 2;
     ;
     NULL, ElCalculo;
|FIN;

|DEFBUCLE nomcalac;
     #900#1004;
     ;
     #0#0, #0#14, #0#11, 5;
     #0#1, #0#15, #0#12, 5;
     ;
     NULL, ElCalculo;
|FIN;

|PROCESO Mensajes;
     |SI nPaso = 1;
          |CUADRO 13211759;
          |ATRI R;
                    ||  2       3         4         5
                    ||  2345678901234567890123456789012345678
          |PINTA 1322, "                                     ";
          |PINTA 1422, " Generando ficheros temporales para  ";
          |PINTA 1522, " la elaboraci¢n de la hoja excel...  ";
          |PINTA 1622, "                                     ";
     |FINSI;
     |SI nPaso = 2;
          |ATRI R;
                    ||  2       3         4         5
                    ||  2345678901234567890123456789012345678
          |PINTA 1322, "                                     ";
          aAlfa =      "   Generando hoja Variaciones Trab.  ";
          |PINTA 1422, aAlfa;
          nNume = nLinea - 6;
          aAlfa1 = nNume; |QBF aAlfa1;
          nNume = nTotalLineas1 + 1;
          aAlfa2 = nNume; |QBF aAlfa2;
          aAlfa = "         L¡nea " + aAlfa1 + " de " + aAlfa2;
          aAlfa = aAlfa + "                                    ";
          aAlfa = aAlfa % 137;
          |PINTA 1522, aAlfa;
          |PINTA 1622, "                                     ";
     |FINSI;
     |SI nPaso = 3;
          |ATRI R;
                    ||  2       3         4         5
                    ||  2345678901234567890123456789012345678
          |PINTA 1322, "                                     ";
          aAlfa =      "     Generando hoja Upload File      ";
          |PINTA 1422, aAlfa;
          nNume = nLinea;
          aAlfa1 = nNume; |QBF aAlfa1;
          nNume = nTotalLineas2 + 1;
          aAlfa2 = nNume; |QBF aAlfa2;
          aAlfa = "         L¡nea " + aAlfa1 + " de " + aAlfa2;
          aAlfa = aAlfa + "                                    ";
          aAlfa = aAlfa % 137;
          |PINTA 1522, aAlfa;
          |PINTA 1622, "                                     ";
     |FINSI;
|FPRC;

|PROCESO ElProceso;
     nPaso = 1;
     |HAZ Mensajes;

     |ABRE #labempre;
     |ABRE #labtraba;
     |ABRE #labcentr;
     |ABRE #nomauxi1;
     |ABRE #nomauxi2;
     |ABRE #syke0013;
     |ABRE #syke0014;

     |ABRE #syke0020;
     |ABRE #syke0021;
     |ABRE #syke0022;
     |ABRE #syke0027;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("s" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #100;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("r" + aAlfa1) % 108;
     |NOME_DAT #101 aAlfa1;
     |DELINDEX #101;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("t" + aAlfa1) % 108;
     |NOME_DAT #200 aAlfa1;
     |DELINDEX #200;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("u" + aAlfa1) % 108;
     |NOME_DAT #201 aAlfa1;
     |DELINDEX #201;

     |ABRE #100;
     |ABRE #101;
     |ABRE #200;
     |ABRE #201;

     nTotalLineas1 = 0;
     nTotalLineas2 = 0;
     |SI #0#4 = "X";
          aProc = "nomcalca";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomcalca.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomcalli.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;

          ||ABRE #900;
          ||CONSULTA_CLAVE #1#900;
          ||CIERRA #900;

          |BUCLE nomcalca;
     |FINSI;
     |SI #0#5 = "X";
          aProc = "nomhicca";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomhicca.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomhicli.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;
          aAnyo = #0#2;
          aAnyo = #0#2 % -102;
          nAnyo = aAnyo;
          |BUCLE nomhicca;
     |FINSI;
     /*
     |SI #0#6 = "X";
          aProc = "nomcalac";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomcalac.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomcalal.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;

          |BUCLE nomcalac;
     |FINSI;
     |SI #0#7 = "X";
          aProc = "nomhicca";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomhicca.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;

          |BUCLE nomhiccawH;
     |FINSI;
     */
     ||CONSULTA_CLAVE #1#200;

     |DESCARGA_DEF #910;
     |DESCARGA_DEF #900;
     |CIERRA #syke0020;
     |CIERRA #syke0021;
     |CIERRA #syke0022;
     |CIERRA #201;
     |CIERRA #200;
     |CIERRA #101;
     |CIERRA #100;
     |CIERRA #labtraba;
     |CIERRA #labempre;
     |CIERRA #labcentr;
     |CIERRA #nomauxi1;
     |CIERRA #nomauxi2;
     |CIERRA #syke0014;
     |CIERRA #syke0013;
|FPRC;

|PROCESO syke0023;
     nLinea = nLinea + 1;

     || Run Group
     aAlfa1 = #0#3;
     |QBF aAlfa1;
     aAlfa1 = ("00" + aAlfa1) % -102;

     aAlfa2 = #0#2;
     aAlfa2 = aAlfa2 % -102;

     aAlfa = "P" + aAlfa1 + aAlfa2 + "DEF";

     aAlfa = "A" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || FC
     aAlfa = "A";
     aAlfa = "B" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || sequence number
     nNume = nLinea - 1;
     aAlfa = nNume;
     aAlfa = "C" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Reference
     aAlfa1 = #0#3;
     |QBF aAlfa1;
     aAlfa1 = ("00" + aAlfa1) % -102;

     aAlfa2 = #0#2;
     aAlfa2 = aAlfa2 % -102;

     aAlfa = "PAYROLL " + aAlfa1 + "-" + aAlfa2 + " DEF";
     aReference = aAlfa;
     aAlfa = "D" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Post Date
     aAlfa = #0#13;
     aAlfa = (aAlfa % 102) + "/" + (aAlfa % 402) + "/" + (aAlfa % -104);
     aAlfa = "E" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Company/Acct Unit
     aAlfa = #200#0;
     aAlfa = "F" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Account Number
     aAlfa = #200#2;
     aAlfa = "G" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Description
     aAlfa = aReference;
     aAlfa = "H" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Trans Amt
     aAlfa = "I" + nLinea + "," + #200#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Activity
     aAlfa = #200#1;
     aAlfa = "J" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Acct Cat
     || aAlfa = "K" + nLinea + "," + ""; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Post Date
     aAlfa = #0#13;
     aAlfa = (aAlfa % 102) + "/" + (aAlfa % 402) + "/" + (aAlfa % -104);
     aAlfa = "L" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || Reverse
     aAlfa = "N";
     aAlfa = "M" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |HAZ Mensajes;
|FPRC;

|DEFBUCLE syke0023;
     #200#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, syke0023;
|FIN;

|PROCESO syke0012;
     nLinea = nLinea + 1;
     aAlfa = "A" + nLinea + "," + #100#1; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "B" + nLinea + "," + #100#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + #100#5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + #100#7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + #100#9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = #100#10;     |QBF aAlfa;
     aAlfa = "00000" + aAlfa;
     aAlfa = aAlfa % -105;
     aAlfa = "F" + nLinea + "," + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + #100#11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

|| xxxxxxxxxxxxx
     aAlfa = "H" + nLinea + "," + #100#36; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + #100#37; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + #100#38; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + #100#12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "L" + nLinea + "," + #100#32; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + #100#33; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + #100#34; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
/*
     aAlfa = "L" + nLinea + "," + #100#13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI #100#14 ! 0;
          aAlfa = "M" + nLinea + "," + #100#14 + " %"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     aAlfa = "N" + nLinea + "," + #100#39; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + #100#40; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "P" + nLinea + "," + #100#15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Q" + nLinea + "," + #100#16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "R" + nLinea + "," + #100#17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "S" + nLinea + "," + #100#18; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "T" + nLinea + "," + #100#19; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "U" + nLinea + "," + #100#20; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "V" + nLinea + "," + #100#21; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "W" + nLinea + "," + #100#22; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "X" + nLinea + "," + #100#23; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Y" + nLinea + "," + #100#24; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Z" + nLinea + "," + #100#25; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AA" + nLinea + "," + #100#26; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AB" + nLinea + "," + #100#27; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AC" + nLinea + "," + #100#28; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AD" + nLinea + "," + #100#29; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AE" + nLinea + "," + #100#30; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AF" + nLinea + "," + #100#31; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "AG" + nLinea + "," + #100#32; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AH" + nLinea + "," + #100#33; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AI" + nLinea + "," + #100#34; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
*/

     nTotC32 = nTotC32 + #100#32;
     nTotC33 = nTotC33 + #100#33;
     nTotC34 = nTotC34 + #100#34;
/*
     nTotC15 = nTotC15 + #100#15;
     nTotC16 = nTotC16 + #100#16;
     nTotC17 = nTotC17 + #100#17;
     nTotC18 = nTotC18 + #100#18;
     nTotC19 = nTotC19 + #100#19;
     nTotC20 = nTotC20 + #100#20;
     nTotC21 = nTotC21 + #100#21;
     nTotC22 = nTotC22 + #100#22;
     nTotC23 = nTotC23 + #100#23;
     nTotC24 = nTotC24 + #100#24;
     nTotC25 = nTotC25 + #100#25;
     nTotC26 = nTotC26 + #100#26;
     nTotC27 = nTotC27 + #100#27;
     nTotC28 = nTotC28 + #100#28;
     nTotC29 = nTotC29 + #100#29;
     nTotC30 = nTotC30 + #100#30;
     nTotC31 = nTotC31 + #100#31;
     nTotC32 = nTotC32 + #100#32;
     nTotC33 = nTotC33 + #100#33;
     nTotC34 = nTotC34 + #100#34;
     nTotC39 = nTotC39 + #100#39;
     nTotC40 = nTotC40 + #100#40;
*/
     |HAZ Mensajes;
|FPRC;

|DEFBUCLE syke0012;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, syke0012;
|FIN;

|PROCESO Totales;
     aRaizMacro = "Módulo1.";

     nLinea = nLinea + 1;
     aAlfa = "I" + nLinea + "," + "TOTAL"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "J" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
|| xxxxxxxxxxxxx

     || las unicas tres columnas que totalizo

     aAlfa = "L" + nLinea + "," + nTotC32; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "M" + nLinea + "," + nTotC33; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "N" + nLinea + "," + nTotC34; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

/*
     InTotal = nTotC15<-;
     aColumna = "O";
     |PARA nPara = 15; |SI nPara [ 34; |HACIENDO nPara = nPara + 1;
          aAlfa = aColumna % 101;
          |SI aAlfa ! "A";
               |SI aColumna = "Z";
                    aColumna = "AA";
               |SINO;
                    nCodAscii = &aColumna;
                    nCodAscii = nCodAscii + 1;
                    aColumna = &nCodAscii;
               |FINSI;
          |SINO;
               aAlfa = aColumna % 201;
               aColumna = aAlfa;
               nCodAscii = &aColumna;
               nCodAscii = nCodAscii + 1;
               aColumna = &nCodAscii;
               aColumna = "A" + aColumna;
          |FINSI;

          aAlfa = aColumna + nLinea + "," + nTotal; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aAlfa = aColumna + nLinea + "," + aRaizMacro + "Gris";
          |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

          InTotal = InTotal + 1;
     |SIGUE;

     || las dos nuevas columnas

     aAlfa = "N" + nLinea + "," + nTotC39; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "O" + nLinea + "," + nTotC40; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
*/
|FPRC;

|PROCESO ElInforme;
     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("s" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |ABRE #100;

     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "documentos/variaciones_trabajadores.xls";
     aDestinoTrab = "C:\DOCUMENTOS";         |RMKDIR aDestino;
     aDestino = aDestinoTrab + "\trabajo.xls";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDestino;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "VARIACIONES";

     nLinea = 7;
     /*
     |SI #0#6 ! "X";
          aAlfa = "C4," + #0#3 +" / " + #0#2; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SINO;
          || Atrasos
          aAlfa = "C4," + "Atrasos - " + #0#2; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
     */

     nMes = #0#3;
     |HAZ MesLetra_plb;
     aMes = aMes % 103;
     aAlfa = "C4," + aMes;
/*
     |SI #0#3 ! #0#16;
          nMes = #0#16;
          |HAZ MesLetra_plb;
          aMes = aMes % 103;
          aAlfa = aAlfa + " - " + aMes;
     |FINSI;
*/
     aAlfa = aAlfa + " / " + #0#2;

     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nPaso = 2;
     |BUCLE syke0012;

     ||TOTALES;
     |HAZ Totales;
/*
     || nada de Upload File

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Upload File";
     nPaso = 3;
     nLinea = 1;
     |BUCLE syke0023;
*/
     aAlfa   = aDestinoTrab + "\variaciones_trabajadores.xls";
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;
     aResultado = aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
     |DESCARGADLL "agixl97.dll";

     aDestino   = aDestinoTrab + "\trabajo.xls";
     |RFBORRA aDestino;

         aVersion1 = "Excel.Sheet";
         |ESPECIFICA "VERSION_PROGRAMA", aVersion;
         |HAZ ExtraePath;
         |SI aPath = "NO LOCALIZADO";
             |MENAV "0000 No puedo encontrar automaticamente la Excel";
             |ACABA;
         |FINSI;

         |QBF aPath;

     || aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aResultado + &34;
     |RSYSTEM aAlfa;

     |CIERRA #100;
|FPRC;

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO Comprueba2;
     |SI #0#4 = " "; |Y #0#5 = " "; |Y #0#6 = " ";
          swSigue = 0;
     |FINSI;
     /*
     |SI #0#8 = "N"; |Y #0#9 = "N";
          swSigue = 0;
     |FINSI;
     */
|FPRC;

|PROCESO imprime;
     |PRINT;
|FPRC;

|DEFBUCLE syke0027;
     #201#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, imprime;
|FIN;

|PROCESO SinActividad;
     |ABRE #201;
     |LEE 000#201p;
     |SI FSalida = 0;
          aAlfa = "    SSe ha detectado trabajadores en Secciones ";
          aAlfa = aAlfa + "sin actividad. ¿Desea imprimir la lista?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               |IMPRE 0;
               |SI FSalida = 0;
                    |INFOR "syke0027";
                    |BUCLE syke0027;
                    |PIEINF;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
     |FINSI;
     |CIERRA #201;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ miraanyo;
     |HAZ mirames;
     |HAZ fechaenvio;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          swSigue = 1;
          |HAZ Comprueba2;
          |SI swSigue = 1;
               |HAZ ElProceso;
               |HAZ ElInforme;
               |HAZ SinActividad;
          |FINSI;
     |FINSI;
|FPRO;
