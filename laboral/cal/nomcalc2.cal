|FICHEROS;
     calculos@ #11;
     nomcaldc;
     nomcaldl;
     nomcaldm;
     labtraba;
     nombonif;
     nomboni3;
     nombotra;
     nomconca;
     nomredco;
     nomhicca;
|FIN;

|VARIABLES;
     &base_6 = 0;
     &base_7 = 0;
     &base_5 = 0;
     &coba_1 = 0;
     &coba_2 = 0;
     &cobb_1 = 0;
     &cobb_2 = 0;
     &coba_3 = 0;
     &coba_4 = 0;
     &cobb_4 = 0;
     &swAjuste3 = 0;
     &denfe_2 = 0;
     &dacci_2 = 0;
     &dmate_2 = 0;
     &ddese_2 = 0;
     &ddese_3 = 0;
     &ddese_4 = 0;
     &dries_2 = 0;
     &dcont_2 = 0;
     &prom_enf = 0;
     &prom_acc = 0;
     &prom_ac2 = 0;
     &dcoti_0 = 0;

     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nCodigo = 0;
     swLocalizada = 0;

     &swMater = 0;
     &swPater = 0;
     &swRiesgo = 0;
     &swCont = 0;

     nClave = 0;
     nDiasNat = 0;
     nDiasCot = 0;
     nBase = 0;
     nBaseDiaria = 0;
     nHorasTP = 0;
     aFechaIni = "";
     aFechaFin = "";

     &acum_53 = 0;
     &acum_54 = 0;

     &dia_2 = 0;
     &dia_4 = 0;
     &es_parcial = 0;
     &es_irregul = 0;

     nClaveBonif = 0;
     nBaseBonif = 0;
     nDiasCotTot = 0;
     nAcumBonif = 0;
     nAcumBase = 0;
     nDiferencia = 0;
     aIniBonif = "";
     aFinBonif = "";
     &fecha_bon_16 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nCumple = 0;
     nDiasBon1 = 0;
     &dalta_3 = 0;
     &dbaja_3 = 0;
     &guarda = 0;
     nume10 = 0;
     &nElAny = 0;
     &nElMes = 0;
     nDiasNatAnt = 0;
     nDiasCotAnt = 0;
     nHorasTPAnt = 0;
     nBaseAnt = 0;
     &histori = "";
     &histori3 = "";
     nDias59Alta = 0;
     nDias59Acc = 0;
     nDias59Enf = 0;
     nDias59Mat = 0;
     nDias59Des = 0;
     nDias59DesTP = 0;
     nDias59AltaTP = 0;
     nDias60Alta = 0;
     nDias60Acc = 0;
     nDias60Enf = 0;
     nDias60Mat = 0;
     nDias60Des = 0;
     nDias60DesTP = 0;
     nDias60AltaTP = 0;
     nDiasAltaTP = 0;
     nDiasBon59 = 0;
     nDiasBon60 = 0;
     nDia = 0;
     nPos = 0;

     nDias = 0;
     nNume = 0;
     nNume1 = 0;
     aCodigo = "";
     nEdad = 0;
     &nMes = 0;
     &nAny = 0;
     &nTopemes = 0;
     histori2 = "";
     nPos2 = 0;
     nDiaCumple = 0;
     nDesdeClave = 0;
     nHastaClave = 0;
     &nDiaCumple2 = 0;
     nDiasBonTot = 0;
     nDiasCotAlta = 0;
     nDiasCotEnf = 0;
     nDiasCotAcc = 0;
     nDiasCotMat = 0;
     nDiasCotPat = 0;
     nDiasCotRie = 0;
     nTipoBonif = 0;
     &horasex = 0;
     swFormYa = 0;
     &nPropDesTP = 0;
     nCumpleAnti = 0;
     nAnti = 0;
     dbaja_12 = 0;
     swSigue = 0;
     nAjusteTex = 0;
     &diastc2 = 0;

     aDef = "";
     aRutaDef = "";
     aRutaDatos = "";
     &enMes = 0;
     &enAny = 0;
     &nUnid990 = 0;
     nAtrHorasTP_Alta = 0;
     nAtrDiasTP_Alta = 0;
     nAtrHorasTP_Des = 0;
     nAtrDiasTP_Des = 0;
     &nDesAcc = 0;
     &nDesEnf = 0;
     &nDiasDesCoef = 0;
     nBaseTotalIT = 0;
     swParcheBonMat = 0;
     fech1 = @;
     nBonif = 0;
     swAjuste3Cont = 0;
     &nPromEnf_ENTERO = 0;
     nAjusteDes = 0;
     nAjusteDes60 = 0;
     nNume2 = 0;
     &swAjusteD = 0;
     &nBaseIT2 = 0;
     &aTipoITBase2 = "";
     &nDiasEnfBase2 = 0;
     &nDiasAccBase2 = 0;
     nBaseAlta = 0;
     nBisiesto = 0;
     nHoras59 = 0;
     nBaseMatPatRie = 0;
     &runnom = "nomcalat";
     dmate_reales = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     aTipoAjuste = "";
     nCuotaCC = 0;
     nBonifTP = 0;
     nDesde = 0;
     nHasta = 0;
     &aTipUltimaIT = "";
     &swCambiaCot = 0;
     nDiasCambiaCot = 0;
     &aCCTopeadas = "";
     &aCPTopeadas = "";
     nLinea = 0;
     aDescripcion = "";
     &nDiasBonifJuv = 0;
     nAntDias = 0;
     nPropJuv = 0;
     nCucu = 0;
     &coba_5 = 0;
     &dperm_2 = 0;
     &dcoti_c = 0;
|FIN;

|PROCESO BorraLin;
     |BORRA 020#nomcaldl.a;
     |LIBERA #nomcaldl;
|FPRC;

|DEFBUCLE BorraLin;
     #nomcaldl#1;
     ;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 000001;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 999999;
     be;
     NULL, BorraLin;
|FIN;

|PROCESO Descripcion;
     aCodigo = #nomcaldl#5;
     nCodigo = #nomcaldl#5;
     #nomcaldl#6 = "";
     swLocalizada = 0;

     aCodigo = nCodigo;
     aAlfa = ("0" + aCodigo) % -106;
     aAlfa = aAlfa % 101;
     |SI aAlfa ! "0";
          aAlfa = "0" + (aCodigo % -105);
          nCodigo = aAlfa;
     |FINSI;

     |ABRE #nomcaldm;
     #nomcaldm#0 = nCodigo;
     |LEE 000#nomcaldm.=;
     |SI FSalida = 0;
          swLocalizada = 1;
          #nomcaldl#6 = #nomcaldm#1;
     |SINO;
          aAlfa = nCodigo;
          aAlfa = aAlfa % 101;
          aAlfa = aAlfa + "1000";
          nCodigo = aAlfa;
          #nomcaldm#0 = nCodigo;
          |LEE 000#nomcaldm.=;
          |SI FSalida = 0;
               aAlfa1 = aCodigo % -103;
               nNume = aAlfa1;
               aAlfa = aCodigo % -102;
               nCodigo = aAlfa;
               swSigue = 0;
               |ABRE #nombonif;
               #nombonif#0 = nCodigo;
               |LEE 000#nombonif.=;
               |SI FSalida = 0;
                    |SI nNume [ 99;
                         swSigue = 1;
                    |FINSI;
                    |SI nNume ] 501; |Y nNume [ 508;
                         swSigue = 1;
                    |FINSI;
               |FINSI;
               |SI swSigue = 1;
                    swLocalizada = 1;
                    aAlfa = aCodigo % -103;
                    #nomcaldl#6 = "Bonif. Codigo " + aAlfa;
               |SINO;
                    aAlfa = aCodigo % -103;
                    nCodigo = aAlfa;
                    |ABRE #nomboni3;
                    #nomboni3#0 = nCodigo;
                    |LEE 000#nomboni3.=;
                    |SI FSalida = 0;
                    |O nCodigo = 362; |O nCodigo = 427; |O nCodigo = 436;
                    |O nCodigo = 727; |O nCodigo = 736;
                    |O nCodigo = 827; |O nCodigo = 836;
                         swLocalizada = 1;
                         #nomcaldl#6 = "Bonif.Fom.Emp." + aAlfa;
                    |SINO;
                         |SI nCodigo = 525; #nomcaldl#6 = "Bon.Hijo Aut.For."; |FINSI;
                         |SI nCodigo = 555; #nomcaldl#6 = "Bonif. Mayores 55"; |FINSI;
                         |SI nCodigo = 559; #nomcaldl#6 = "Bonif. Mayores 59"; |FINSI;
                         |SI nCodigo = 560; #nomcaldl#6 = "Bonif. Mayores 60"; |FINSI;
                         |SI nCodigo = 570; #nomcaldl#6 = "Bonif. 50% CC ERE"; |FINSI;
                         |SI nCodigo = 585; #nomcaldl#6 = "Bonif. 100% Cuotas Formacion"; |FINSI;
                         |SI nCodigo = 586; #nomcaldl#6 = "Bonif. Horas Tutorias"; |FINSI;
                    |FINSI;
                    |CIERRA #nomboni3;
               |FINSI;
               |CIERRA #nombonif;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CamposLin;
     #nomcaldl#0 = #nomcaldc#0;
     #nomcaldl#1 = #nomcaldc#1;
     #nomcaldl#2 = #nomcaldc#2;
     #nomcaldl#3 = #nomcaldc#3;
     #nomcaldl#4 = #nomcaldc#4;
     #nomcaldl#5 = nClave;

     |HAZ Descripcion;

     #nomcaldl#7 = nDiasNat;
     #nomcaldl#8 = nDiasCot;
     #nomcaldl#9 = nHorasTP;
     #nomcaldl#10 = nBase;
     #nomcaldl#11 = nBaseDiaria;
     #nomcaldl#12 = aFechaIni;
     #nomcaldl#13 = aFechaFin;
|FPRC;

|PROCESO ReGrabaLin;
     nBase = nBase ! 2;
     |SI nBase [ 0;
          |BORRA 020#nomcaldl.a;
          |ACABA;
     |FINSI;
     |HAZ CamposLin;
     |GRABA 020#nomcaldl.a;
     |LIBERA #nomcaldl;
|FPRC;

|PROCESO GrabaLin;
     |SI nBase [ 0;
          |ACABA;
     |FINSI;
     |HAZ CamposLin;
     |GRABA 020#nomcaldl.n;
     |LIBERA #nomcaldl;
|FPRC;

|PROCESO TiempoParcial;
     nAtrHorasTP_Alta = 0;
     nAtrDiasTP_Alta = 0;
     nAtrHorasTP_Des = 0;
     nAtrDiasTP_Des = 0;

     |SI es_parcial = 1;|O es_irregul = 1;
          nHorasTP = (nDiasCot * #labtraba#47);
          |SI 0 < nHorasTP; |Y nHorasTP < 0.5;
               nHorasTP = 1;
          |SINO;
               nHorasTP = nHorasTP ! 0;
          |FINSI;
     |FINSI;

     |SI ddese_3 ! 0;
          |SI nClave = 021000; |O nClave = 022000;
               |SI nDesEnf ! 0;
                    |SI es_parcial = 1;|O es_irregul = 1;
                         nHorasTP = (nDiasCot * #labtraba#47);
                    |SINO;
                         nHorasTP = nDiasCot * ((#nomconca#162 / 7) ! 2);
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nClave = 031000; |O nClave = 032000;
               |SI nDesAcc ! 0;
                    |SI es_parcial = 1;|O es_irregul = 1;
                         nHorasTP = (nDiasCot * #labtraba#47);
                    |SINO;
                         nHorasTP = nDiasCot * ((#nomconca#162 / 7) ! 2);
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nClave = 311000; |O nClave = 312000;
               |SI #nomredco#1 = "7.3.0";
                    nNume = ddese_3;
               |SINO;
                    nNume = nDiasCot;
               |FINSI;
               |SI nDesEnf ! 0;
                    nNume = nNume - denfe_2;
               |FINSI;
               |SI nDesAcc ! 0;
                    nNume = nNume - dacci_2;
               |FINSI;
               |SI es_parcial = 1;|O es_irregul = 1;
                    nHorasTP = (nNume * #labtraba#47);
               |SINO;
                    nHorasTP = nNume * ((#nomconca#162 / 7) ! 2);
               |FINSI;
          |FINSI;
          |SI nClave = 71000; |O nClave = 72000;
               |SI #nomredco#1 = "7.3.0";
                    nHorasTP = (ddese_2 * ((#nomconca#162 / 7) ! 2)) ! 0;
               |SINO;
                    || nHorasTP = ((ddese_2 - ddese_4) * ((#nomconca#162 / 7) ! 2)) ! 0;
                    nHorasTP = 0;  || ya no hay horas aqui, aqui solo dias completos
                                   || en ERE
               |FINSI;
          |FINSI;
          |SI #nomredco#1 ! "7.3.0";
               |SI nClave = 81000; |O nClave = 82000;
                    |SI es_parcial = 1;|O es_irregul = 1;
                         nHorasTP = (ddese_4 * #labtraba#47);
                    |SINO;
                         nHorasTP = ddese_4 * ((#nomconca#162 / 7) ! 2);
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI 0 < nHorasTP; |Y nHorasTP < 0.5;
               nHorasTP = 1;
          |SINO;
               nHorasTP = nHorasTP ! 0;
          |FINSI;
     |FINSI;
     |SI diastc2 ! 0;
          nHorasTP = (diastc2 * #labtraba#47);
     |FINSI;

     |SI aDef = "nomcalac";
          #nomcaldl#0 = #nomcaldc#0;
          #nomcaldl#1 = #nomcaldc#1;
          #nomcaldl#2 = #nomcaldc#2;
          #nomcaldl#3 = #nomcaldc#3;
          #nomcaldl#4 = 0;
          #nomcaldl#5 = 311000;
          |LEE 000#nomcaldl.=;
          |SI FSalida = 0;    || existio ERE a TP, parte en alta
               nAtrHorasTP_Alta = #nomcaldl#9;
               nAtrDiasTP_Alta = #nomcaldl#8;

               #nomcaldl#0 = #nomcaldc#0;
               #nomcaldl#1 = #nomcaldc#1;
               #nomcaldl#2 = #nomcaldc#2;
               #nomcaldl#3 = #nomcaldc#3;
               #nomcaldl#4 = 0;
               #nomcaldl#5 = 071000;
               |LEE 000#nomcaldl.=;
               |SI FSalida = 0;    || existio ERE a TP, parte en Desempleo
                    nAtrHorasTP_Des = #nomcaldl#9;
                    nAtrDiasTP_Des = (#nomcaldl#10 / #nomcaldl#11) ! 2;
                    nAtrDiasTP_Alta = nAtrDiasTP_Alta - nAtrDiasTP_Des;
               |FINSI;

               |SI nClave = 011000; |O nClave = 012000; || base en ALTA en ERE
                    || para trabajadores a tiempo parcial que tambien estaban
                    || en ERE a TP
                    |SI es_parcial = 1;|O es_irregul = 1;
                         nHorasTP = (nDiasCot - nAtrDiasTP_Alta) * #labtraba#47;
                         |SI 0 < nHorasTP; |Y nHorasTP < 0.5;
                              nHorasTP = 1;
                         |SINO;
                              nHorasTP = nHorasTP ! 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI nClave = 311000; |O nClave = 312000; || base en ALTA en ERE a TP
                    |SI es_parcial = 1;|O es_irregul = 1;
                         || no, aqui no me vuelvas a cambiar las horas
                         || el trabajador ya es tiempo parcial, las horas
                         || ya son las correctas
                    |SINO;
                         nHorasTP = nAtrHorasTP_Alta;
                    |FINSI;
               |FINSI;
               |SI nClave = 071000; |O nClave = 072000; || base en ERE a TP
                    nHorasTP = nAtrHorasTP_Des;
               |FINSI;

               ddese_3 = nAtrDiasTP_Alta;

               /*

               || lo quito definitivamente 21.01.2013
               || tiquet 3512.1089, atrasos mes 10, trabajador 00077.00004

               || en la clave 311000 en atrasos me hace falta
               |SI nClave = 311000;     || base en ALTA en ERE a TP
                    |SI nDiasCotAlta = ddese_3;
                         || no hagas nada
                         || a ver esto no lo entiendo, ya me viene cargado en
                         || nDiasCotAlta los dias trabajados de la parte de
                         || ERE a TP, entonces no se por que lo suma otra vez
                         || estoy duplicando esto y luego da error, voy a no
                         || sumarlo caso de que sea igual porque supongo que
                         || entonces es porque ya esta sumado
                         || si hay que quitarlo consultar antes el tiquet
                         || 98.2542 trabajador 401.9 datos Serna
                         || atrasos mes 11, prueba a calcularlo

                         || creo que esto es porque son ERES que tienen cargadas
                         || la variable ddese_3 de ERE a TP pero en verdad NO
                         || lo son, son ERES de los que estan multiplicados
                         || por un coeficiente, pero SIN SER a TP en verdad
                    |SINO;
                         |SI es_parcial = 1;|O es_irregul = 1;
                              || si es un ERE a TP en un trab. que ya era a TP
                              || esto no hay que hacerlo, me estropea el calculo
                              || de las bases
                              || realmente tampoco se por que esta para el resto
                              || de casos, si da problemas, plantearse el quitarlo
                              || 16.11.2011 - 002884.02054
                         |SINO;
                              nDiasCotAlta = nDiasCotAlta + ddese_3;
                         |FINSI;
                    |FINSI;
               |FINSI;
               */
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MaximoMes;
     |SI swCambiaCot = 1;
          |ACABA;
     |FINSI;

     swAjuste3Cont = 0;
     |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
     |Y #labtraba#42 ! "C"; |Y #labtraba#42 ! "F";
          |SI nClave = 41000;|| maternidad CC
               |SI dmate_2 > 30;
                    |SI dries_2 > 0; |O dcont_2 > 0;
                         || todo el mes entero entre riesgo y mater.
                         || tengo que quitar un dia de maternidad
                         nDiasCot = nDiasCot - 1;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nDiasCot > 30;
               nDiasCot = 30;
          |FINSI;
          |SI nElMes = 2;
               nBisiesto = 0;
               nNume = nElAny $ 4;
               |SI nNume = 0;
                    nBisiesto = 1;
               |FINSI;
               |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                    nNume = 28 + nBisiesto;
                    |SI nClave = 21000; |Y denfe_2 = dia_2; |Y nDiasCot = nNume;
                         nDiasCot = 30; || TODO EL MES EN ENFERMEDAD
                    |FINSI;
                    |SI nClave = 31000; |Y dacci_2 = dia_2; |Y nDiasCot = nNume;
                         nDiasCot = 30; || TODO EL MES EN ACCIDENTE
                    |FINSI;
               |FINSI;
               |SI nClave = 41000; |Y dmate_2 = dia_2;
                    |SI dries_2 = 0;    || todo el mes en maternidad
                         nDiasCot = 30;
                    |FINSI;
               |FINSI;
               |SI nClave = 61000; |Y dries_2 = dia_2;
                    nDiasCot = 30;
               |FINSI;
               |SI nClave = 61000; |Y dmate_2 = dia_2;
                    |SI dries_2 ! 0;
                         || febrero, todo el mes entre maternidad y riesgo
                         || los dos dias que sobran se los pongo al riesgo
                         nDiasCot = dries_2 + 2 - nBisiesto;
                    |FINSI;
               |FINSI;
               |SI nClave = 91000; |Y dmate_2 = dia_2;
                    |SI dmate_2 ! 0;
                         nDiasCot = 30;
                         swAjuste3Cont = 2;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonACero;
     nClave = 0;
     nDiasNat = 0;
     nDiasCot = 0;
     nBase = 0;
     nBaseDiaria = 0;
     nHorasTP = 0;
     aFechaIni = "";
     aFechaFin = "";
|FPRC;

|PROCESO nombotra;
     |SI #nombotra#2 = 111;
          swSigue = 1;
     |FINSI;
|FPRC;

|DEFBUCLE nombotra;
     #nombotra#1;
     ;
     #nombotra#0, #nombotra#1, 001;
     #nombotra#0, #nombotra#1, 999;
     ;
     NULL, nombotra;
|FIN;

|PROCESO ParcheBonifMat;
     |SI aDef = "nomcalac";        || de momento en atrasos NO
          |ACABA;
     |FINSI;

     swParcheBonMat = 0;
     swSigue = 0;

     |SI #11#135 = 111; |O #11#136 = 111;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 0;
          |BUCLE nombotra;
     |FINSI;

     |SI swSigue = 1;
          |ABRE #nombotra;              || para leer la fecha
          #nombotra#0 = #labtraba#0;
          #nombotra#1 = #labtraba#1;
          #nombotra#2 = 111;
          |LEE 000#nombotra.=;
          |CIERRA #nombotra;
          |SI #labtraba#39 ! 0; |Y #labtraba#41 ! "          "; |Y #labtraba#41 ! "..........";
               swSigue = 1;
          |FINSI;
          |SI #11#135 = 101; |Y #11#136 = 111;
               swSigue = 2;
          |FINSI;
          |SI #11#135 = 111; |Y #11#136 = 117;
               swSigue = 3;
          |FINSI;
          |SI swSigue = 1;
               fech1 = #labtraba#41;        || ahora compruebo que tengo 2 bonif.
               nume1 = fech1;              || y la otra es una que acaba justo
               nume1 = nume1 + 1;          || cuando la maternidad termina
               fech1 = nume1;              || en ese caso solo la tengo que pintar
               |SI #nombotra#4 = fech1;     || en el periodo de alta
                    aAlfa = fech1;
                    aAlfa1 = aAlfa % 402;
                    aAlfa2 = aAlfa % -104;
                    nume1 = aAlfa1;
                    nume2 = aAlfa2;
                    |SI nElAny = nume2; |Y nElMes = nume1;
                         swParcheBonMat = 1;
                    |FINSI;
               |FINSI;
          |FINSI;

          || lo siguiente es si estoy en el caso de dos bonificaciones de
          || fomento de empleo, una por desempleadas (la 101) y otra por
          || reincorporacion tras la maternidad (la 111). En este caso
          || en el mes de reincorporacion tiene que salir la 111 solo en la
          || parte de alta

          |SI swSigue = 2; |Y nClaveBonif = 111;
               swSigue = 4;
          |FINSI;
          |SI swSigue = 3; |Y nClaveBonif = 117;
               || tambien para el caso de dos bonificaciones por reincorpora-
               || cion de maternidad por el segundo embarazo, cuando empieza
               || la segunda, lo mismo

               swSigue = 4;
               |ABRE #nombotra;              || para leer la fecha
               #nombotra#0 = #labtraba#0;
               #nombotra#1 = #labtraba#1;
               #nombotra#2 = 117;
               |LEE 000#nombotra.=;
               |CIERRA #nombotra;
          |FINSI;
          |SI swSigue = 4;
               fech1 = #nombotra#4;        || ahora compruebo que tengo 2 bonif.
               aAlfa = fech1;
               aAlfa1 = aAlfa % 402;
               aAlfa2 = aAlfa % -104;
               nume1 = aAlfa1;          || mes que empieza la bonif.
               nume2 = aAlfa2;          || y a¤o que empieza la bonif.
               |SI nElAny = nume2; |Y nElMes = nume1;
                    || empiezo la bonif. este mes, entonces si que es porque
                    || este mes soy alta de maternidad y aqui si que tengo
                    || que aplicarla solo en la parte de alta
                    swParcheBonMat = 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ReparteBonif;
     |HAZ PonACero;
     |SI #nomcaldl#5 = 011000; |O #nomcaldl#5 = 111000; |O #nomcaldl#5 = 211000; |O #nomcaldl#5 = 311000;
     |O #nomcaldl#5 = 021000; |O #nomcaldl#5 = 121000; |O #nomcaldl#5 = 221000;
     |O #nomcaldl#5 = 031000; |O #nomcaldl#5 = 131000; |O #nomcaldl#5 = 231000;
     |O #nomcaldl#5 = 041000; |O #nomcaldl#5 = 141000; |O #nomcaldl#5 = 241000;
     |O #nomcaldl#5 = 051000; |O #nomcaldl#5 = 151000; |O #nomcaldl#5 = 251000;
     |O #nomcaldl#5 = 061000; |O #nomcaldl#5 = 161000; |O #nomcaldl#5 = 261000;
     |O #nomcaldl#5 = 071000; |O #nomcaldl#5 = 171000; |O #nomcaldl#5 = 271000;
     |O #nomcaldl#5 = 081000; |O #nomcaldl#5 = 181000; |O #nomcaldl#5 = 281000;
     |O #nomcaldl#5 = 091000; |O #nomcaldl#5 = 191000; |O #nomcaldl#5 = 291000;
          |SALVA_FICHA #nomcaldc;
          nDias = nDiasCotTot;
          aCodigo = #nomcaldl#5;
          aAlfa = ("0" + aCodigo) % -106
          aAlfa = aAlfa % 101;
          |SI nClaveBonif [ 099;           || de las "de siempre"
          |O nClaveBonif = 501; |O nClaveBonif = 502; |O nClaveBonif = 503;
               nDias = nDias + ddese_3;

               |HAZ ParcheBonifMat;
               |SI swParcheBonMat = 1;
                    |SI #nomcaldl#5 = 041000;
                         nDias = #nomcaldl#8;
                    |SINO;
                         nDias = 0;
                    |FINSI;
               |FINSI;
               |SI #labtraba#45 = 421; |Y nTipoBonif ! 10;
                    nClaveBonif = nClaveBonif + 700;
                    || bonif formacion y ademas algo mas de CC
               |FINSI;
          |FINSI;
          |SI nClaveBonif = 585;             || de las del 100% de las cuotas
               nDias = nDias + ddese_3;      || de formacion

               |HAZ ParcheBonifMat;
               |SI swParcheBonMat = 1;
                    |SI #nomcaldl#5 = 041000;
                         nDias = #nomcaldl#8;
                    |SINO;
                         nDias = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nClaveBonif ] 100; |Y nClaveBonif [ 499; || de las PFE
               |SI ddese_3 > nDiasCotAlta;
                    nDias = nDias + nDiasCotAlta;
               |SINO;
                    nDias = nDias + ddese_3;
               |FINSI;
               |HAZ ParcheBonifMat;
               |SI swParcheBonMat = 1;
                    |SI #nomcaldl#5 = 011000;
                         nDias = #nomcaldl#8;
                    |SINO;
                         nDias = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nClaveBonif = 362; |O nClaveBonif = 427; |O nClaveBonif = 436;
          |O nClaveBonif = 727; |O nClaveBonif = 736;
          |O nClaveBonif = 827; |O nClaveBonif = 836;
               |SI aAlfa = "1"
                    nDias = nDiasBon59;
               |SINO;
                    nDias = 0;
               |FINSI;
          |FINSI;
          |SI nClaveBonif = 559;
               |SI aAlfa = "1"; |O aAlfa = "3";
                    nDias = nDiasBon59;
               |SINO;
                    nDias = 0;
               |FINSI;
          |FINSI;
          |SI nClaveBonif = 555;
               |SI nCumple = 59;
                    |SI aAlfa = "0";
                         ||nDias = #nomcaldl#8;
                         nDias = nDiasCotTot - nDiasBon59;
                    |SINO;
                         nDias = 0;
                    |FINSI;
               |SINO;
                    || esto viene a causa del tiquet de Asecor 01624.01484
                    || en verdad digo yo que deberia estar asi siempre pero
                    || como no hay tiempo de comprobarlo lo dejo asi, si no
                    || no sale como debe la bonificacion para mayores de 55
                    || del textil ya que no tiene en cuenta todos los dias
                    || para repartirlo, tiene que tener en cuenta todos los
                    || dias cotizados

                    nDias = nDias + ddese_3;
               |FINSI;
          |FINSI;
          |SI nClaveBonif = 560;
               |SI aAlfa = "2"; |O aAlfa = "3";
                    nDias = nDiasBon60;
               |SINO;
                    nDias = 0;
               |FINSI;
          |FINSI;
          |SI #nomredco#1 = "7.3.0";
               |SI nClaveBonif = 570;
                    |SI #nomcaldl#5 = 071000; |O #nomcaldl#5 = 171000; |O #nomcaldl#5 = 271000;
                    |O  #nomcaldl#5 = 081000; |O #nomcaldl#5 = 181000; |O #nomcaldl#5 = 281000;
                         nDias = ddese_2;
                    |SINO;
                         nDias = 0;
                    |FINSI;
                |FINSI;
          |SINO;
               |SI nClaveBonif = 570;
                    |SI #nomcaldl#5 = 071000; |O #nomcaldl#5 = 171000; |O #nomcaldl#5 = 271000;
                    |O  #nomcaldl#5 = 081000; |O #nomcaldl#5 = 181000; |O #nomcaldl#5 = 281000;
                         nDias = ddese_2;
                         |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
                              |SI nDias > 30;
                                   nDias = 30;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         nDias = 0;
                    |FINSI;
               |FINSI;
          |FINSI;

               nNume = nDias60Mat + nDias60Des;
               |SI nNume = 0;    || si tengo 60 a¤os se los
                    |SI nClaveBonif = 559; |Y aAlfa = "1";
                         nDias = nDias + swAjuste3Cont;
                    |FINSI;
               |SINO;
                    |SI nClaveBonif = 560; |Y aAlfa = "2";
                         nDias = nDias + swAjuste3Cont;
                    |FINSI;
               |FINSI;

          nClave = #nomcaldl#5 + 1000 + nClaveBonif;
          |HAZ Descripcion;
          nDiasNat = #nomcaldl#7;
          nDiasCot = #nomcaldl#8;
          |SI #nomcaldl#5 = 071000;
               |SI #nomredco#1 = "7.3.0";
                    nDiasCot = ddese_2 - nDiasBon59 - nDiasBon60;
               |SINO;
                    || nDiasCot = (ddese_2 - ddese_4) - nDias59Des - nDias60Des;
                    || los dias que me venian en el #nomcaldl#8
               |FINSI;
          |FINSI;
          |SI #nomcaldl#5 = 081000;
               nDiasCot = ddese_4 - nDias59DesTP - nDias60DesTP;
          |FINSI;
          |SI #nomcaldl#5 = 271000; |O #nomcaldl#5 = 281000;
               |SI nDiasDesCoef > 0;
                    || esto porque tuve problemas con un ERE que tenia 16.5 dias
                    || en alta y 13.5 en ERE en caso de usar el parametro de la
                    || ley esa rara que aumente los dias de ERE en 0.25 en
                    || determinados casos, porque me redondeaba uno a 13 y otro 16
                    || y no me hacia bien el reparto al dividir la bonif. entre
                    || 30 dias para sacar la proporcion

                    || tendre problemas si en los dias de ERE hay dias con
                    || bonificacion de mayores de 60 y dias que no, lo dejo asi
                    || para salir del paso 16.06.2010

                    || empiezan los problemas, ERE de todo el mes 18 dias 59
                    || a¤os y 12 dias 60 a¤os, de momento lo parcheo asi
                    || 00098.02405 02.12.2010
                    |SI nDiasBon59 > 0; |Y nDiasBon60 > 0;
                         || no lo hago en este caso
                    |SINO;
                         nDiasCot = nDiasDesCoef;
                    |FINSI;
               |FINSI;
               |SI #nomredco#1 = "7.3.0";
                    nDiasCot = nDiasCot - ddese_3;
               |FINSI;
          |FINSI;
          |SI #nomcaldl#5 = 311000;
               |SI #nomredco#1 = "7.3.0";
                    nDiasCot = ddese_3;
               |SINO;
                    nDiasCot = ddese_3;
                    |SI nClaveBonif ] 100; |Y nClaveBonif [ 499; || de las PFE
                         |SI ddese_3 > nDiasCotAlta;
                               nDiasCot = nDiasCotAlta;
                         |SINO;
                               nDiasCot = ddese_3;
                         |FINSI;
                    |FINSI;
                    |SI nClaveBonif = 559;
                         nDiasCot = nDias59AltaTP;
                    |FINSI;
                    |SI nClaveBonif = 560;
                         nDiasCot = nDias60AltaTP;
                    |FINSI;
                    |SI nClaveBonif = 570;
                         nDiasCot = ddese_3 - nDias59AltaTP - nDias60AltaTP;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI nTipoBonif = 10;
               nDiasCot = 0;
               nDias = 0;
               |SI #nomcaldl#5 = 011000; |O #nomcaldl#5 = 111000; |O #nomcaldl#5 = 211000;
                    || en bonificaciones por horas de formacion han de salir
                    || las horas bonificadas, y no los dias cotizables
                    |SI swFormYa = 0;
                         nDiasCot = horasex;
                         nDias = horasex;
                         swFormYa = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nClaveBonif = 586;
               nDiasCot = #11#182;
               nDias = #11#182;
          |FINSI;

          nBase = (nDiasCot * nBaseBonif) / nDias;
          |SI nClaveBonif = 501; |O nClaveBonif = 502;
               |SI ddese_3 ! 0;
                    #nomcaldl#0 = #nomcaldc#0;
                    #nomcaldl#1 = #nomcaldc#1;
                    #nomcaldl#2 = #nomcaldc#2;
                    #nomcaldl#3 = #nomcaldc#3;
                    #nomcaldl#4 = #nomcaldc#4;
                    #nomcaldl#5 = nClave - nClaveBonif;
                    |LEE 000#nomcaldl.=;
                    |SI FSalida = 0;
                         nCuotaCC = (#nomcaldl#10 % 23.60) ! 2;
                         nBonifTP = (#nomcaldl#8 ! 0) * 3.33;
                         nBase = nCuotaCC - nBonifTP;
                    |FINSI;
               |FINSI;
          |FINSI;
          nBase = nBase ! 2;
          nAcumBonif = nAcumBonif + nBase;
          nDiferencia = nBaseBonif - nAcumBonif;
          |SI -0.45 [ nDiferencia; |Y nDiferencia [ 0.45;
               nBase = nBase + nDiferencia;
               nAcumBonif = nAcumBonif + nDiferencia;
          |FINSI;
          nBaseDiaria = 0;
          nHorasTP = 0;
          aFechaIni = aIniBonif;
          aFechaFin = aFinBonif;

          |SI nBase > 0.10;
               |HAZ GrabaLin;
          |FINSI;

          |REPON_FICHA #nomcaldc;
     |FINSI;
|FPRC;

|DEFBUCLE ReparteBonif;
     #nomcaldl#1;
     ;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, nDesde;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, nHasta;
     ;
     NULL, ReparteBonif;
|FIN;

|PROCESO ReparteBoni;
     nDesde = 000001;
     nHasta = 079999;
     |BUCLE ReparteBonif;

     nDesde = 300001;
     nHasta = 399999;
     |BUCLE ReparteBonif;

     nDesde = 080001;
     nHasta = 089999;
     |BUCLE ReparteBonif;
|FPRC;

|PROCESO BonFomTex;
     |ABRE #nombotra;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     #nombotra#2 = nClaveBonif;
     |LEE 000#nombotra.=;
     |SI FSalida = 0; |Y #nombotra#2 ! 0;
          aIniBonif = #nombotra#4;
          aFinBonif = #nombotra#5;
     |SINO;
          |SI #labtraba#212 = 3; |O #labtraba#212 = 4;
               |SI #11#106 > 0;         || 40% mayores 59 y 10% textil
                    nClaveBonif = 362;  || colectivo 1062
               |FINSI;
          |FINSI;
          |SI #labtraba#212 = 5; |O #labtraba#212 = 6;
               |SI #11#106 = 0;
                    nClaveBonif = 427;  || todo calzado: colectivo 0927
               |SINO;
                    nClaveBonif = 436;  || 40% mayores 59 y 10% calzado
               |FINSI;                  || colectivo 0936
          |FINSI;
          |SI #labtraba#212 = 13; |O #labtraba#212 = 14;
               |SI #11#106 = 0;
                    nClaveBonif = 727;  || colectivo 0727: juguete
               |SINO;
                    nClaveBonif = 736;  || 40% mayores 59 y 10% juguete
               |FINSI;                  || colectivo 0736
          |FINSI;
          |SI #labtraba#212 = 15; |O #labtraba#212 = 16;
               |SI #11#106 = 0;
                    nClaveBonif = 827;  || colectivo 0827: mueble
               |SINO;
                    nClaveBonif = 836;  || 40% mayores 59 y 10% mueble
               |FINSI;                  || colectivo 0836
          |FINSI;
     |FINSI;
     |CIERRA #nombotra;

     nAjusteTex = 0;
     |SI #11#106 > 0;
          nAjusteTex = #11#106 * 100 / 90;
          nAjusteTex = nAjusteTex - #11#106;
     |FINSI;
|FPRC;

|PROCESO Bonificaciones;
     nBaseBonif = #11#63 + #11#81; || bonificaciones de toda la vida
     nAcumBonif = 0;
     aIniBonif = #labtraba#40;
     aFinBonif = #labtraba#41;
     nClaveBonif = #11#12;
     nTipoBonif = 0;

     |SI aDef = "nomcalca";        || de momento en atrasos NO
          |SI #labtraba#248 = 516; |O #labtraba#248 = 518; |O #labtraba#248 = 520;
               |SI #labtraba#45 = "421";
                    nClaveBonif = 525;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nBaseBonif > 0.10;
          |SI nClaveBonif = 501; |O nClaveBonif = 502;
               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |SINO;
               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;
     |FINSI;

     nBaseBonif = #11#88;          || bonificaciones mayores > 60
     nAcumBonif = 0;
     aIniBonif = fecha_bon_16;
     aFinBonif = "";
     nClaveBonif = 560;
     nTipoBonif = 0;
     |SI nBaseBonif > 0.10;
          nDesde = 000001; nHasta = 999999;
          |BUCLE ReparteBonif;
     |FINSI;

     nBaseBonif = #11#96;          || bonificaciones fomento empleo 1
     nAcumBonif = 0;
     nTipoBonif = 0;
     |SI nBaseBonif > 0.10;
          |ABRE #nombotra;
          #nombotra#0 = #labtraba#0;
          #nombotra#1 = #labtraba#1;
          #nombotra#2 = #11#135;
          |LEE 000#nombotra.=;
          |SI FSalida = 0;
               nClaveBonif = #nombotra#2;
               aIniBonif = #nombotra#4;
               aFinBonif = #nombotra#5;
          |FINSI;
          |CIERRA #nombotra;

          nDesde = 000001; nHasta = 999999;
          |BUCLE ReparteBonif;
     |FINSI;

     |SI aDef = "nomcalca";        || de momento en atrasos NO
          nBaseBonif = #11#133;          || bonificaciones fomento empleo 2
          nAcumBonif = 0;
          nTipoBonif = 0;
          |SI nBaseBonif > 0.10;
               |ABRE #nombotra;
               #nombotra#0 = #labtraba#0;
               #nombotra#1 = #labtraba#1;
               #nombotra#2 = #11#136;
               |LEE 000#nombotra.=;
               |SI FSalida = 0;
                    nClaveBonif = #nombotra#2;
                    aIniBonif = #nombotra#4;
                    aFinBonif = #nombotra#5;
               |FINSI;
               |CIERRA #nombotra;

               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;

          nBaseBonif = #11#102;         || bonificaciones fomento empleo TEXTIL
          nAcumBonif = 0;
          nTipoBonif = 0;
          nClaveBonif = #11#137;

          |SI nBaseBonif > 0.10;
               |HAZ BonFomTex;

               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;

          nBaseBonif = #11#134;         || bonificaciones fomento empleo TEXTIL 2
          nAcumBonif = 0;
          nTipoBonif = 0;
          nClaveBonif = #11#138;

          |SI nBaseBonif > 0.10;
               |HAZ BonFomTex;

               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;
     |FINSI;

     nBaseBonif = #11#170;          || bonificaciones Garantia Juvenil
     nAcumBonif = 0;
     nTipoBonif = 0;
     |SI nBaseBonif > 0.10;
          |ABRE #nombotra;
          #nombotra#0 = #labtraba#0;
          #nombotra#1 = #labtraba#1;
          #nombotra#2 = 199;
          |LEE 000#nombotra.=;
          |SI FSalida = 0;
               nClaveBonif = #nombotra#2;
               aIniBonif = #nombotra#4;
               aFinBonif = #nombotra#5;
          |FINSI;
          |CIERRA #nombotra;

          nDesde = 000001; nHasta = 999999;
          |BUCLE ReparteBonif;
     |FINSI;

     nBaseBonif = #11#101;        || bonificaciones mayores > 55 TEXTIL
     nAcumBonif = 0;
     aIniBonif = fecha_bon_16;
     aFinBonif = "";
     nClaveBonif = 555;
     nTipoBonif = 0;
     |SI nBaseBonif > 0.10;
          nDesde = 000001; nHasta = 999999;
          |BUCLE ReparteBonif;
     |FINSI;

     nBaseBonif = #11#106;         || bonificaciones mayores > 59 a¤os
     nAcumBonif = 0;
     aIniBonif = "";
     aFinBonif = "";
     nClaveBonif = 559;
     nTipoBonif = 0;
     |SI nBaseBonif > 0.10;
          nDesde = 000001; nHasta = 999999;
          |BUCLE ReparteBonif;
     |FINSI;

     swFormYa = 0;
     nBaseBonif = #11#64;          || bonificaciones horas formacion
     nAcumBonif = 0;
     aIniBonif = "";
     aFinBonif = "";
     nClaveBonif = #11#12;
     nTipoBonif = 10;
     |SI nBaseBonif > 0.10;
          nDesde = 000001; nHasta = 999999;
          |BUCLE ReparteBonif;
     |FINSI;

     |SI aDef = "nomcalca";        || de momento en atrasos NO
          nBaseBonif = #11#143 + #11#144; || bonificaciones 100% cuotas formacion
          nAcumBonif = 0;
          aIniBonif = "";
          aFinBonif = "";
          nClaveBonif = 585;
          nTipoBonif = 0;
          |SI nBaseBonif > 0.10;
               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;
     |FINSI;

     |SI aDef = "nomcalca";        || de momento en atrasos NO
          nBaseBonif = #11#125;         || bonificaciones 50% CC ERE
          nAcumBonif = 0;
          aIniBonif = "";
          aFinBonif = "";
          nClaveBonif = 570;
          nTipoBonif = 0;
          |SI nBaseBonif > 0.10;
               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;
     |FINSI;

     |SI aDef = "nomcalca";        || en atrasos NO
          nBaseBonif = #11#183;          || Tutorias
          nAcumBonif = 0;
          aIniBonif = "";
          aFinBonif = "";
          nClaveBonif = 586;
          nTipoBonif = 0;
          |SI nBaseBonif > 0.10;
               nDesde = 000001; nHasta = 999999;
               |BUCLE ReparteBonif;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Diferencias;
     nAcumBase = nAcumBase + nBase;
     nDiferencia = nAcumBase - nBaseAnt;
     |SI -0.25 [ nDiferencia; |Y nDiferencia [ 0.25; |Y nDiferencia ! 0;
          || tenemos una peque¤a diferencia, ajusto:
          nBase = nBase - nDiferencia;
     |FINSI;
|FPRC;

|PROCESO ReparteBases;
     nAcumBase = 0;
     nHoras59 = 0;
     |HAZ PonACero;

     |SI #nomcaldl#5 = 11000; |O #nomcaldl#5 = 12000;
     |O #nomcaldl#5 = 21000; |O #nomcaldl#5 = 22000; |O #nomcaldl#5 = 29000;
     |O #nomcaldl#5 = 31000; |O #nomcaldl#5 = 32000; |O #nomcaldl#5 = 39000;
     |O #nomcaldl#5 = 71000; |O #nomcaldl#5 = 72000;
     |O #nomcaldl#5 = 81000; |O #nomcaldl#5 = 82000;
     |O #nomcaldl#5 = 91000; |O #nomcaldl#5 = 92000;

          |SALVA_FICHA #nomcaldc;
          |SALVA_FICHA #nomcaldl;
          nDiasNat = #nomcaldl#7 - nDiasBon59 - nDiasBon60;
          nDiasCot = #nomcaldl#8 - nDiasBon59 - nDiasBon60;
          |SI #nomcaldl#5 = 11000; |O #nomcaldl#5 = 12000;
               nDiasNat = #nomcaldl#7 - nDias59Alta - nDias60Alta;
               nDiasCot = #nomcaldl#8 - nDias59Alta - nDias60Alta;
          |FINSI;
          |SI #nomcaldl#5 = 21000; |O #nomcaldl#5 = 22000; |O #nomcaldl#5 = 29000;
               nDiasNat = #nomcaldl#7 - nDias59Enf - nDias60Enf;
               nDiasCot = #nomcaldl#8 - nDias59Enf - nDias60Enf;
          |FINSI;
          |SI #nomcaldl#5 = 31000; |O #nomcaldl#5 = 32000; |O #nomcaldl#5 = 39000;
               nDiasNat = #nomcaldl#7 - nDias59Acc - nDias60Acc;
               nDiasCot = #nomcaldl#8 - nDias59Acc - nDias60Acc;
          |FINSI;
          |SI #nomredco#1 = "7.3.0";
               |SI #nomcaldl#5 = 71000; |O #nomcaldl#5 = 72000;
                    nDiasNat = #nomcaldl#7 - nDias59Mat - nDias60Mat;
                    nDiasNat = nDiasNat - nDias59Des - nDias60Des;
                    nDiasCot = #nomcaldl#8 - nDias59Mat - nDias60Mat;
                    nDiasCot = nDiasCot - nDias59Des - nDias60Des;
               |FINSI;
          |SINO;
               |SI #nomcaldl#5 = 71000; |O #nomcaldl#5 = 72000;
                    nDiasNat = #nomcaldl#7 - nDias59Mat - nDias60Mat;
                    nDiasNat = nDiasNat - nDias59Des - nDias60Des;
                    nDiasCot = #nomcaldl#8 - nDias59Mat - nDias60Mat;
                    nDiasCot = nDiasCot - nDias59Des - nDias60Des;
               |FINSI;
               |SI #nomcaldl#5 = 81000; |O #nomcaldl#5 = 82000;
                    nDiasNat = #nomcaldl#7 - nDias59Mat - nDias60Mat;
                    nDiasNat = nDiasNat - nDias59DesTP - nDias60DesTP;
                    nDiasCot = #nomcaldl#8 - nDias59Mat - nDias60Mat;
                    nDiasCot = nDiasCot - nDias59DesTP - nDias60DesTP;
               |FINSI;
          |FINSI;
          |SI #nomcaldl#5 = 91000; |O #nomcaldl#5 = 92000;
               nDiasNat = #nomcaldl#7 - nDias59Mat - nDias60Mat;
               nDiasCot = #nomcaldl#8 - nDias59Mat - nDias60Mat;
               |SI nDiasNat = 0;
                    nDiasCot = 0;
               |FINSI;
          |FINSI;
          nClave = #nomcaldl#5;
          nDiasNatAnt = #nomcaldl#7;
          nDiasCotAnt = #nomcaldl#8;
          nHorasTPAnt = #nomcaldl#9;
          nBaseAnt = #nomcaldl#10;

          nBase = nDiasCot * ((nBaseAnt / nDiasCotAnt) ! 2);
          nBaseDiaria = #nomcaldl#11;
          nHorasTP = (nDiasCot * (nHorasTPAnt / nDiasCotAnt)) ! 0;
          |SI nHorasTP > 0;
               |SI #labtraba#42 = "T"; |O #labtraba#42 = "X";
                    || si es TP tengo que proporcionar la base a las HORAS
                    || 11.01.2010 - 003164.00316
                    nBase = ((nHorasTP / nHorasTPAnt) * nBaseAnt) ! 2;
               |FINSI;
          |FINSI;

          aFechaIni = #nomcaldl#12;
          aFechaFin = #nomcaldl#13;

          |SI nBase > 0.10;
               |HAZ Diferencias;
          |FINSI;
          |HAZ ReGrabaLin;

          || bonificaciones mayores de 59

          nClave = nClave + 100000;

          nDiasNat = nDiasBon59;
          nDiasCot = nDiasBon59;
          |SI nClave = 111000; |O nClave = 112000;
               nDiasNat = nDias59Alta;
               nDiasCot = nDias59Alta;
               |SI nDiasCot > nDiasCotAnt;   || no puede ser
                    nDiasCot = nDiasCotAnt;
               |FINSI;
          |FINSI;
          |SI nClave = 121000; |O nClave = 122000; |O nClave = 129000;
               nDiasNat = nDias59Enf;
               nDiasCot = nDias59Enf;
          |FINSI;
          |SI nClave = 131000; |O nClave = 132000; |O nClave = 139000;
               nDiasNat = nDias59Acc;
               nDiasCot = nDias59Acc;
          |FINSI;
          |SI #nomredco#1 = "7.3.0";
               |SI nClave = 171000; |O nClave = 172000;
                    nDiasNat = nDias59Mat + nDias59Des;
                    nDiasCot = nDias59Mat + nDias59Des;
               |FINSI;
          |SINO;
               |SI nClave = 171000; |O nClave = 172000;
                    nDiasNat = nDias59Mat + nDias59Des + nAjusteDes;
                    nDiasCot = nDias59Mat + nDias59Des;
               |FINSI;
               |SI nClave = 181000; |O nClave = 182000;
                    nDiasNat = nDias59Mat + nDias59DesTP;
                    nDiasCot = nDias59Mat + nDias59DesTP;
               |FINSI;
          |FINSI;
          |SI nClave = 191000; |O nClave = 192000;
               nDiasNat = nDias59Mat + nDias59Des;
               nDiasCot = nDias59Mat + nDias59Des;
               nNume = nDias60Mat + nDias60Des;
               |SI nDiasCot > 0; |Y nNume = 0;    || si tengo 60 a¤os se los
                                                  || a¤ado despues
                    nDiasNat = nDiasNat;
                    nDiasCot = nDiasCot + swAjuste3Cont;
               |FINSI;
          |FINSI;

          nBase = nDiasCot * ((nBaseAnt / nDiasCotAnt) ! 2);
          nBaseDiaria = #nomcaldl#11;
          nHorasTP = (nDiasCot * (nHorasTPAnt / nDiasCotAnt)) ! 0;
          |SI nHorasTP > 0
               |SI #labtraba#42 = "T"; |O #labtraba#42 = "X";
                    nHoras59 = nHorasTP;
                    || si es TP tengo que proporcionar la base a las HORAS
                    || 11.01.2010 - 003164.00316
                    nBase = ((nHorasTP / nHorasTPAnt) * nBaseAnt) ! 2;
               |FINSI;
          |FINSI;
          aFechaIni = #nomcaldl#12;
          aFechaFin = #nomcaldl#13;

          |SI nBase > 0.10;
               |HAZ Diferencias;
               |HAZ GrabaLin;
          |FINSI;

          || bonificaciones mayores de 60
          nClave = nClave + 100000;

          nDiasNat = nDiasNatAnt - #nomcaldl#7;
          nDiasCot = nDiasCotAnt - #nomcaldl#8;
          |SI nClave = 211000; |O nClave = 212000;
               nDiasNat = nDias60Alta;
               nDiasCot = nDias60Alta;
               |SI #nomredco#1 = "7.3.0";
                    || nada, como siempre
                    |SI nDiasCot > nDiasCotAnt;
                         || mes de 31 dias
                         nNume = nDiasCotAnt + 1;
                         |SI nDiasCot = nNume;
                              nDiasCot = nDiasCotAnt;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI nDiasCot > nDiasCotAnt;
                         || mes de 31 dias
                         nNume = nDiasCotAnt + 1;
                         |SI nDiasCot = nNume;
                              nDiasCot = nDiasCotAnt;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nClave = 221000; |O nClave = 222000; |O nClave = 229000;
               nDiasNat = nDias60Enf;
               nDiasCot = nDias60Enf;
          |FINSI;
          |SI nClave = 231000; |O nClave = 232000; |O nClave = 239000;
               nDiasNat = nDias60Acc;
               nDiasCot = nDias60Acc;
          |FINSI;
          |SI #nomredco#1 = "7.3.0";
               |SI nClave = 271000; |O nClave = 272000;
                    nDiasNat = nDias60Mat + nDias60Des;
                    nDiasCot = nDias60Mat + nDias60Des;
               |FINSI;
          |SINO;
               |SI nClave = 271000; |O nClave = 272000;
                    nDiasNat = nDias60Mat + nDias60Des + nAjusteDes + nAjusteDes60;
                    nDiasCot = nDias60Mat + nDias60Des;
               |FINSI;
               |SI nClave = 281000; |O nClave = 282000;
                    nDiasNat = nDias60Mat + nDias60DesTP;
                    nDiasCot = nDias60Mat + nDias60DesTP;
               |FINSI;
          |FINSI;
          |SI nClave = 291000; |O nClave = 292000;
               nDiasNat = nDias60Mat + nDias60Des;
               nDiasCot = nDias60Mat + nDias60Des;
               |SI nDiasCot > 0;
                    nDiasNat = nDiasNat;
                    nDiasCot = nDiasCot + swAjuste3Cont;
               |FINSI;
          |FINSI;

          nHorasTP = (nDiasCot * (nHorasTPAnt / nDiasCotAnt)) ! 0;
          nBase = nDiasCot * ((nBaseAnt / nDiasCotAnt) ! 2);
          |SI nHorasTP > 0
               || si es TP tengo que proporcionar la base a las HORAS
               || 11.01.2010 - 003164.00316
               |SI #labtraba#42 = "T"; |O #labtraba#42 = "X";
                    |SI nHoras59 > 0;   || TP, cambio de 59 a 60
                         nNume = nHorasTP + nHoras59;
                         |SI nNume > nHorasTPAnt;
                              nNume = nNume - nHorasTPAnt;
                              nHorasTP = nHorasTP - nNume;
                         |FINSI;
                    |FINSI;
                    nBase = ((nHorasTP / nHorasTPAnt) * nBaseAnt) ! 2;
               |FINSI;
          |FINSI;
          nBaseDiaria = #nomcaldl#11;
          aFechaIni = #nomcaldl#12;
          aFechaFin = #nomcaldl#13;

          |SI nBase > 0.10;
               |HAZ Diferencias;
               |HAZ GrabaLin;
          |FINSI;

          |REPON_FICHA #nomcaldl;
          |REPON_FICHA #nomcaldc;
     |FINSI;
|FPRC;

|DEFBUCLE ReparteBases;
     #nomcaldl#1;
     ;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, nDesdeClave;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, nHastaClave;
     ;
     NULL, ReparteBases;
|FIN;

|PROCESO CompDiasCot;
     nAjusteDes = 0;
     nAjusteDes60 = 0;
     |SI nDias59Enf > nDiasCotTot; nDias59Enf = nDiasCotTot; |FINSI;
     |SI nDias59Acc > nDiasCotTot; nDias59Acc = nDiasCotTot; |FINSI;
     |SI nDias59Mat > nDiasCotTot; nDias59Mat = nDiasCotTot; |FINSI;
     |SI nDias59Des > nDiasCotTot; nDias59Des = nDiasCotTot; |FINSI;

     |SI nDias60Enf > nDiasCotTot; nDias60Enf = nDiasCotTot; |FINSI;
     |SI nDias60Acc > nDiasCotTot; nDias60Acc = nDiasCotTot; |FINSI;
     |SI nDias60Mat > nDiasCotTot; nDias60Mat = nDiasCotTot; |FINSI;
     |SI nDias60Des > nDiasCotTot; nDias60Des = nDiasCotTot; |FINSI;


|| ni pu¤etera idea de por que esta esto aqui, pero por culpa de esto
|| casos como una simple it del dia 1 al 4 en un trabajador con bonif.
|| de mayores de 59 todo el mes no sale, ademas no es necesario porque
|| ya se topea antes: NO lo quito 26.08.2010 porque despues en la com-
|| probacion del lote al ver que las bases no lo cuadran lo hace por el
|| sistema de siempre, pero esto no esta bien, a quitar cuando se pueda
|| y se pueda probar bien luego
     |SI swAjuste3 ! 0;
          |SI nDias59Enf > 0; |Y nDias59Acc > 0;
               nDias59Acc = nDias59Acc - swAjuste3;
               nDiasBon59 = nDiasBon59 - swAjuste3;
          |SINO;
               |SI nDias59Alta > 0; |Y nDias59Enf > 0;
                    nDias59Enf = nDias59Enf - swAjuste3;
                    nDiasBon59 = nDiasBon59 - swAjuste3;
               |FINSI;
               |SI nDias59Alta > 0; |Y nDias59Acc > 0;
                    nDias59Acc = nDias59Acc - swAjuste3;
                    nDiasBon59 = nDiasBon59 - swAjuste3;
               |FINSI;
               |SI nDias59Alta > 0; |Y nDias59Mat > 0;
                    nDias59Mat = nDias59Mat - swAjuste3;
                    nDiasBon59 = nDiasBon59 - swAjuste3;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swAjuste3 ! 0;
          |SI nDias60Enf > 0; |Y nDias60Acc > 0;
               nDias60Acc = nDias60Acc - swAjuste3;
               nDiasBon60 = nDiasBon60 - swAjuste3;
          |SINO;
               |SI nDias60Alta > 0; |Y nDias60Enf > 0;
                    nDias60Enf = nDias60Enf - swAjuste3;
                    nDiasBon60 = nDiasBon60 - swAjuste3;
               |FINSI;
               |SI nDias60Alta > 0; |Y nDias60Acc > 0;
                    nDias60Acc = nDias60Acc - swAjuste3;
                    nDiasBon60 = nDiasBon60 - swAjuste3;
               |FINSI;
               |SI nDias60Alta > 0; |Y nDias60Mat > 0;
                    nDias60Mat = nDias60Mat - swAjuste3;
                    nDiasBon60 = nDiasBon60 - swAjuste3;
               |FINSI;
          |FINSI;
          |ACABA;
     |SINO;
          || no tengo enfermedad ni accidente ni nada, swAjuste no se activa
          || pero si que tengo ERE a tiempo parcial (aunque si fuera a tiempo
          || completo tambien deberia pero no me meto en eso de moemento)
          |SI ddese_3 > 0;
               nNume = nDiasCotTot + ddese_3;
               |SI nDiasBon59 > nNume;       || tengo bonif mayores de 59
                    nDiasBon59 = nNume;      || no tiene sentido que tenga
               |FINSI;                       || mas dias bonif de 59 que de
               |SI nDiasBon60 > nNume;       || alta, para mayores de 60
                    nDiasBon60 = nNume;      || los mismo
               |FINSI;
               |ACABA;
          |FINSI;

          || despues no sigo pasando por mas ajustes
          || el tiquet de esto es el 3076.1449, Datos ALFE, nomina de dic/2011
          || trabajador 00171.00007
     |FINSI;

     nNume = nDiasCotTot + ddese_3;

     |SI nDiasBon59 > nNume;
          nNume1 = nNume + 1;
          |SI nDiasBon59 = nNume1;
               nDiasBon59 = nNume;
               nAjusteDes = 1;
          |FINSI;
     |FINSI;
     |SI nDias59Alta > nNume;
          nNume1 = nNume + 1;
          |SI nDias59Alta = nNume1;
               nDias59Alta = nNume;
               nAjusteDes = 1;
          |FINSI;
     |FINSI;
     |SI nDiasBon60 > nNume;
          nNume1 = nNume + 1;
          |SI nDiasBon60 = nNume1;
               nDiasBon60 = nNume;
               nAjusteDes = 1;
          |FINSI;
     |FINSI;
     |SI nDias60Alta > nNume;
          nNume1 = nNume + 1;
          |SI nDias60Alta = nNume1;
               nDias60Alta = nNume;
               nAjusteDes = 1;
          |FINSI;
     |FINSI;
     nNume2 = nDiasBon59 + nDiasBon60;
     |SI nNume2 > nNume;
          nNume1 = nNume + 1;
          |SI nNume2 = nNume1;
               |SI nDias60Des = nDiasBon60;
                    nDias60Des = nDias60Des - 1;
               |FINSI;
               nDiasBon60 = nDiasBon60 - 1;
               nDias60Alta = nDias60Alta - 1;
               nAjusteDes60 = 1;
          |FINSI;
     |FINSI;
     nNume2 = nDias59Alta + nDias60Alta;
     |SI nNume2 > nNume;
          nNume1 = nNume + 1;
          |SI nNume2 = nNume1;
               |SI nDias60Des = nDias60Alta;
                    nDias60Des = nDias60Des - 1;
               |FINSI;
               nDias60Alta = nDias60Alta - 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DesTPCoef;
     || una barbaridad: en los trabajadores mayores de 60 a¤os con la variable
     || nDiasDesCoef con dias decimales, es decir que tienen que usar las lineas
     || 81000 para los dias en ERE a TP y la 31000 porque los tengo que pasar
     || a horas, NO estaban saliendo las bonificaciones en las lineas
     || de esta manera lo consigo, eso si, de momento solo para mayores de 60
     || y ademas no contemplo si no esta todo el mes con la bonificacion y
     || tiene dias con 59 y dias con 60, al tiempo

     |SI nDiasDesCoef > 0;
          nNume = nDiasDesCoef ! 0;
          |SI nNume ! nDiasDesCoef;     || con decimales
               |SI nDiasBon60 > 0;
                    nDiasBon60 = nDiasCotAlta + nDiasDesCoef;
                    nDias60DesTP = nDiasDesCoef;
                    nDias60AltaTP = nDiasCotAlta;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PrimerReparto;
     nDias59Alta = 0;
     nDias59Acc = 0;
     nDias59Enf = 0;
     nDias59Mat = 0;
     nDias59Des = 0;
     nDias59DesTP = 0;
     nDias60Alta = 0;
     nDias60Acc = 0;
     nDias60Enf = 0;
     nDias60Mat = 0;
     nDias60Des = 0;
     nDias60DesTP = 0;
     nDiasBon59 = 0;
     nDiasBon60 = 0;
     nDiasBonTot = 0;
     nDias59AltaTP = 0;
     nDias60AltaTP = 0;
     nDiasAltaTP = 0;
     histori2 = "";
     |SI #11#88 > 0; |O #11#106 > 0;
          nCumple = 0;
          nCumpleAnti = 0;
          nAnti = 0;
          |HAZ Cumplea¤os;

          |SI nCumpleAnti = 5; |Y nEdad ] 59;
               |SI #labtraba#212 = 01; |O #labtraba#212 = 03; |O #labtraba#212 = 05;
               |O #labtraba#212 = 13; |O #labtraba#212 = 15;
                    aAlfa = #labtraba#34;
               |FINSI;
               |SI #labtraba#212 = 02; |O #labtraba#212 = 04; |O #labtraba#212 = 06;
               |O #labtraba#212 = 14; |O #labtraba#212 = 16;
                    aAlfa = #labtraba#36;
               |FINSI;
          |SINO;
               aAlfa = #labtraba#11;
          |FINSI;

          aAlfa = aAlfa % 102;
          nume1 = aAlfa;
          |SI nCumple = 0; |O nCumple ] 61;
               |SI nEdad = 59;
                    |PARA nDia = 1; |SI nDia [ 31; |HACIENDO nDia = nDia + 1;
                         aAlfa = "59";
                         histori2 = histori2 + aAlfa;
                    |SIGUE;
               |FINSI;
               |SI nEdad ] 60;
                    |PARA nDia = 1; |SI nDia [ 31; |HACIENDO nDia = nDia + 1;
                         aAlfa = "60";
                         histori2 = histori2 + aAlfa;
                    |SIGUE;
               |FINSI;
          |FINSI;
          |SI nCumple = 59;
               nDiaCumple = nume1;
               |PARA nDia = 1; |SI nDia [ 31; |HACIENDO nDia = nDia + 1;
                    |SI nDia ] nDiaCumple
                         aAlfa = "59";
                    |SINO;
                         aAlfa = "58";
                    |FINSI;
                    histori2 = histori2 + aAlfa;
               |SIGUE;
          |FINSI;
          |SI nCumple = 60; |O nDiaCumple2 ! 0;
               |SI nDiaCumple2 ! 0;
                    nDiaCumple = nDiaCumple2;
               |SINO;
                    nDiaCumple = nume1;
               |FINSI;
               |PARA nDia = 1; |SI nDia [ 31; |HACIENDO nDia = nDia + 1;
                    |SI nDia ] nDiaCumple
                         |SI #11#88 > 0;
                              aAlfa = "60";
                         |SINO;
                              aAlfa = "  ";
                         |FINSI;
                    |SINO;
                         aAlfa = "59";
                    |FINSI;
                    histori2 = histori2 + aAlfa;
               |SIGUE;
          |FINSI;
          nMes = nElMes;
          nAny = nElAny;
          |HAZ topemes_plb;
          || ojo, febrero, mes entero de alta, esto es necesario porque
          || si no me crea una parte con 2 dias que no me bonifica
          dbaja_12 = dbaja_3;
/*
          |SI nElMes = 2;
               |SI dbaja_3 = 28; |O dbaja_3 = 29;
                    || febrero, todo el mes de alta;
                    dbaja_12 = nDiasCotTot; || (para mensuales, 30 dias)
               |FINSI;
          |FINSI;
*/

          |SI dbaja_3 < nDiasCotAlta; |Y nDiasCotAlta = 30; |Y nElMes = 2;
               |SI dbaja_3 = 28; |O dbaja_3 = 29;
                    dbaja_12 = nDiasCotAlta;
               |FINSI;
          |FINSI;
          |PARA nDia = dalta_3; |SI nDia [ dbaja_12; |HACIENDO nDia = nDia + 1;
               nPos = (nDia * 100) + 1;
               aAlfa = histori % nPos;
               nPos2 = (((nDia * 2) - 1) * 100) + 2; || edad cada dia
               aAlfa1 = histori2 % nPos2;

               |SI aAlfa = "A"; |O aAlfa = "K"; || (absentismo tambien claro)
                    nNume = nDias59Alta + nDias60Alta;
                    |SI nNume < nDiasCotAlta;
                         |SI aAlfa1 = "59";
                              nDias59Alta = nDias59Alta + 1;
                              nDiasBon59 = nDiasBon59 + 1;
                         |FINSI;
                         |SI aAlfa1 = "60";
                              nDias60Alta = nDias60Alta + 1;
                              nDiasBon60 = nDiasBon60 + 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |PARA nDia = dalta_3; |SI nDia [ dbaja_12; |HACIENDO nDia = nDia + 1;
               nPos = (nDia * 100) + 1;
               aAlfa = histori % nPos;
               nPos2 = (((nDia * 2) - 1) * 100) + 2; || edad cada dia
               aAlfa1 = histori2 % nPos2;

               |SI aAlfa = "J";
                    nNume = nDias59Acc + nDias60Acc;
                    |SI nNume < nDiasCotAcc;
                         |SI aAlfa1 = "59";
                              nDias59Acc = nDias59Acc + 1;
                              nDiasBon59 = nDiasBon59 + 1;
                         |FINSI;
                         |SI aAlfa1 = "60";
                              nDias60Acc = nDias60Acc + 1;
                              nDiasBon60 = nDiasBon60 + 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |PARA nDia = dalta_3; |SI nDia [ dbaja_12; |HACIENDO nDia = nDia + 1;
               nPos = (nDia * 100) + 1;
               aAlfa = histori % nPos;
               nPos2 = (((nDia * 2) - 1) * 100) + 2; || edad cada dia
               aAlfa1 = histori2 % nPos2;
               |SI aAlfa = "I";
                    nNume = nDias59Enf + nDias60Enf;
                    |SI nNume < nDiasCotEnf;
                         |SI aAlfa1 = "59";
                              nDias59Enf = nDias59Enf + 1;
                              nDiasBon59 = nDiasBon59 + 1;
                         |FINSI;
                         |SI aAlfa1 = "60";
                              nDias60Enf = nDias60Enf + 1;
                              nDiasBon60 = nDiasBon60 + 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |PARA nDia = dalta_3; |SI nDia [ dbaja_12; |HACIENDO nDia = nDia + 1;
               nPos = (nDia * 100) + 1;
               aAlfa = histori % nPos;
               nPos2 = (((nDia * 2) - 1) * 100) + 2; || edad cada dia
               aAlfa1 = histori2 % nPos2;
               |SI aAlfa = "M";
                    nNume = nDias59Mat + nDias60Mat;
                    |SI nNume < nDiasCotMat;
                         |SI aAlfa1 = "59";
                              nDias59Mat = nDias59Mat + 1;
                              nDiasBon59 = nDiasBon59 + 1;
                         |FINSI;
                         |SI aAlfa1 = "60";
                              nDias60Mat = nDias60Mat + 1;
                              nDiasBon60 = nDiasBon60 + 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |SI #nomredco#1 = "7.3.0";
               |PARA nDia = dalta_3; |SI nDia [ dbaja_12; |HACIENDO nDia = nDia + 1;
                    nPos = (nDia * 100) + 1;
                    aAlfa = histori % nPos;
                    nPos2 = (((nDia * 2) - 1) * 100) + 2; || edad cada dia
                    aAlfa1 = histori2 % nPos2;
                    |SI aAlfa = "B";
                         nNume = nDias59Des + nDias60Des;
                         nNume1 = ddese_2 + ddese_3;
                         |SI nNume < nNume1;
                              |SI aAlfa1 = "59";
                                   nDias59Des = nDias59Des + 1;
                                   nDiasBon59 = nDiasBon59 + 1;
                              |FINSI;
                              |SI aAlfa1 = "60";
                                   nDias60Des = nDias60Des + 1;
                                   nDiasBon60 = nDiasBon60 + 1;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SIGUE;
          |SINO;
               |PARA nDia = dalta_3; |SI nDia [ dbaja_12; |HACIENDO nDia = nDia + 1;
                    nPos = (nDia * 100) + 1;
                    aAlfa = histori3 % nPos;
                    nPos2 = (((nDia * 2) - 1) * 100) + 2; || edad cada dia
                    aAlfa1 = histori2 % nPos2;
                    |SI aAlfa = "D"; |O aAlfa = "d";
                         |SI aAlfa = "D";
                              nNume = nDias59Des + nDias60Des;
                              nNume1 = ddese_2 - ddese_4;
                              |SI nNume < nNume1;
                                   |SI aAlfa1 = "59";
                                        nDias59Des = nDias59Des + 1;
                                        nDiasBon59 = nDiasBon59 + 1;
                                   |FINSI;
                                   |SI aAlfa1 = "60";
                                        nDias60Des = nDias60Des + 1;
                                        nDiasBon60 = nDiasBon60 + 1;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                         |SI aAlfa = "d";
                              nNume = nDias59DesTP + nDias60DesTP;
                              nNume1 = ddese_4;
                              |SI nNume < nNume1;
                                   nDiasAltaTP = nDiasAltaTP + 1;
                                   |SI aAlfa1 = "59";
                                        nDias59DesTP = nDias59DesTP + (nPropDesTP / 100);
                                        nDias59AltaTP = nDias59AltaTP + ((100 - nPropDesTP) / 100);
                                        nDiasBon59 = nDiasBon59 + 1;
                                   |FINSI;
                                   |SI aAlfa1 = "60";
                                        nDias60DesTP = nDias60DesTP + (nPropDesTP / 100);
                                        nDias60AltaTP = nDias60AltaTP + ((100 - nPropDesTP) / 100);
                                        nDiasBon60 = nDiasBon60 + 1;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SIGUE;
          |FINSI;
          |HAZ CompDiasCot;

          |HAZ DesTPCoef;
     |FINSI;

     |SI #nomcaldl#5 = 11000; |O #nomcaldl#5 = 12000;
     |O #nomcaldl#5 = 21000; |O #nomcaldl#5 = 22000; |O #nomcaldl#5 = 29000;
     |O #nomcaldl#5 = 31000; |O #nomcaldl#5 = 32000; |O #nomcaldl#5 = 39000;
     |O #nomcaldl#5 = 71000; |O #nomcaldl#5 = 72000;
     |O #nomcaldl#5 = 81000; |O #nomcaldl#5 = 82000;
     |O #nomcaldl#5 = 91000; |O #nomcaldl#5 = 92000;
          nDesdeClave = 11000; nHastaClave = 11000; |BUCLE ReparteBases;
          nDesdeClave = 12000; nHastaClave = 12000; |BUCLE ReparteBases;
          nDesdeClave = 21000; nHastaClave = 21000; |BUCLE ReparteBases;
          nDesdeClave = 22000; nHastaClave = 22000; |BUCLE ReparteBases;
          nDesdeClave = 29000; nHastaClave = 29000; |BUCLE ReparteBases;
          nDesdeClave = 31000; nHastaClave = 31000; |BUCLE ReparteBases;
          nDesdeClave = 32000; nHastaClave = 32000; |BUCLE ReparteBases;
          nDesdeClave = 39000; nHastaClave = 39000; |BUCLE ReparteBases;
          nDesdeClave = 71000; nHastaClave = 71000; |BUCLE ReparteBases;
          nDesdeClave = 72000; nHastaClave = 72000; |BUCLE ReparteBases;
          nDesdeClave = 81000; nHastaClave = 81000; |BUCLE ReparteBases;
          nDesdeClave = 82000; nHastaClave = 82000; |BUCLE ReparteBases;
          nDesdeClave = 91000; nHastaClave = 91000; |BUCLE ReparteBases;
          nDesdeClave = 92000; nHastaClave = 92000; |BUCLE ReparteBases;
     |FINSI;
|FPRC;

|PROCESO Formacion;      || contratos en formacion la cotizacion es siempre
     |SI dcoti_0 > 30;   || por 30 dias sean diarios o mensuales, asi son
          dcoti_0 = 30;  || las cosas
     |FINSI;
|FPRC;

|PROCESO Formacion2;
     || contratos en formacion: aun se guarda la base de maternidad en la
     || base de contingencias comunes en alta, como en enfermedad y accidente
     || esto hace que si esta todo el mes en mat/pat/rie genere una linea
     || con cero dias cotizables pero con base, y eso provoca cuando se hace
     || el lote usando las lineas estas que salga una base BA01 en alta
/*
     |SI #labtraba#45 = "087"; |O #labtraba#45 = "097";
     |O #labtraba#45 = "085"; |O #labtraba#45 = "421";
          nNume = dmate_2 - swAjuste3;

          |SI nPromEnf_ENTERO ! 0;
               nBaseDiaria = nPromEnf_ENTERO;
          |SINO;
               nBaseDiaria = prom_enf;
          |FINSI;

          |SI dmate_2 > 0;
               nNume1 = dmate_2 - swAjuste3;
               nBase = nBase - (nNume1 * nBaseDiaria);
          |FINSI;
     |FINSI;
*/
     |SI #labtraba#45 = "087"; |O #labtraba#45 = "097";
     |O #labtraba#45 = "085"; |O #labtraba#45 = "421";
          |SI dmate_2 = 0;
               |SI denfe_2 > 0; |O dacci_2 > 0;
                    nBase = base_6 - (base_5 ! 2);
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Formacion3;
     || contratos en formacion la cotizacion es siempre
     || por 30 dias sean diarios o mensuales, hay que
     || controlar la mat o rie del mes completo de los diarios

     |SI #labtraba#45 = "087"; |O #labtraba#45 = "097";
     |O #labtraba#45 = "085"; |O #labtraba#45 = "421";
          |SI #labtraba#42 = "T"; |O #labtraba#42 = "D";
               dmate_reales = dmate_2 - dries_2;
               nNume = dmate_reales + dries_2;
               |SI nNume = 31;     || 31 dias entre maternidad y riesdo
                    |SI dmate_reales > 0; |Y dries_2 > 0;
                         |SI nClave = 41000;
                              || quito el dia de la maternidad, si entre
                              || meternidad y riesgo esta en diario
                              || los 31 dias
                              nBase = nBase - nBaseDiaria;
                         |FINSI;
                    |FINSI;
                    |SI nClave = 41000; |Y dmate_reales = 31;
                         || 31 dias en maternidad
                         nBase = nBase - nBaseDiaria;
                    |FINSI;
                    |SI nClave = 61000; |Y dries_2 = 31;
                         || 31 dias en riesgo
                         nBase = nBase - nBaseDiaria;
                    |FINSI;
                    |SI nClave = 62000; |Y dries_2 = 31;
                         || 31 dias en riesgo
                         nBase = nBase - nBaseDiaria;
                    |FINSI;
               |FINSI;
               |SI nElMes = 02;
                    |SI nNume = dcoti_0; || todo el mes de mat.
                         |SI nNume = 28;
                              nBase = nBase + (nBaseDiaria * 2);
                         |FINSI;
                         |SI nNume = 29;
                              nBase = nBase + (nBaseDiaria * 1);
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ParcheAtrDesTP;
     || no me arriesgo, solo la empresa 401 que es la que tiene problemas Serna
     || todo esto del tiquet 98.2592
     |SI #nomcaldc#3 = 2; |O #nomcaldc#0 = 00401;
          |ABRE #nomhicca;
          #nomhicca#0 = #nomcaldc#0;
          #nomhicca#1 = #nomcaldc#1;
          #nomhicca#66 = #nomcaldc#2 - 2000;
          #nomhicca#2 = #nomcaldc#3;
          #nomhicca#3 = 0;
          |LEE 000#nomhicca.=;
          |SI #nomhicca#8 ! dcoti_0;
               || problema, nos ha pasado con un seguro social de Serna en
               || febrero, atrasos, con desempleo y que usa lo de multiplicar
               || los dias en alta por 1.25

               || en la nomina del mes no se calculaban los mismos dias que
               || en atrasos, bueno en teoria es error de la nomina pero
               || no puede ser, el caso es que tengo que cotizar igual en
               || atrasos, por los mismos dias de la parte de alta

               || asi que fuerzo mi dcoti_0 a que tenga los mismos dias que
               || habia en el historico, asi funciona como debe

               dcoti_0 = #nomhicca#8;

               || esto es un parche feo y hay que quitarlo en cuanto se aclare
               || el tema
          |FINSI;

          |CIERRA #nomhicca;
     |FINSI;
|FPRC;

|PROCESO Desempleo2;
     || algo logico, si los dias cotizables en alta son cero (debido en este
     || caso a que todos los dias cotizables en alta van a ir al 311000 por
     || haber dias con decimales en el nDiasDesCoef) esta base tiene que ser
     || cero

     || en verdad deberia ser asi para todo, es decir, que si nDiasCotAlta = 0
     || que la base en alta fuera cero, pero no me atrevo a hacerlo en general

     |SI nDiasDesCoef > 0; |Y nDiasCot = 0;
          nBase = 0;
     |FINSI;
|FPRC;

|PROCESO ITAtrasos;
     |SI #11#62 = 0;     || parche atrasos, no puedo tener base de cc. en
          nBase = 0;     || IT si tengo la base de IT a cero, eso es por-
     |FINSI;             || que la IT venia del a¤o anterior
|FPRC;

|PROCESO CompBaseIT;
     || no puede ser que la base total de IT sea mayor que este campo
     || si eso se da es que por algun motivo de decimales nos hemos pasado
     || de los limites: 003916.00021

     |SI nBaseTotalIT > #11#62;
          nBase = nBase - (nBaseTotalIT - #11#62);
     |FINSI;
|FPRC;

|PROCESO AjusteMensual;
     || proceso para ver de que tramo de cotizacion del mes hago en ajuste
     || en los mensuales

     |SI swAjuste3 ! 0;
          || tengo ajuste

          aTipoAjuste = "";
          |PARA nCampo1 = 27; |SI nCampo1 [ 30; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 - 8;
               nCampo3 = nCampo1 - 4;

               aAlfa = #11nCampo1;
               |QBF aAlfa;
               |SI aAlfa ! "";
                    aTipoAjuste = aAlfa;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO TipoXenIT;
     swAjuste3 = 0;

     |SI swCambiaCot = 1;
          nBisiesto = 0;
          nNume = nElAny $ 4;
          |SI nNume = 0;
               nBisiesto = 1;
          |FINSI;
          |SI nElMes = 2;
               nDiasCambiaCot = -2 + nBisiesto;
          |SINO;
               nDiasCambiaCot = 1;
          |FINSI;
     |FINSI;

     |SI aTipUltimaIT = "E";
          coba_1 = coba_1 - (prom_enf * nDiasCambiaCot);
          cobb_1 = cobb_1 - (prom_acc * nDiasCambiaCot);
     |FINSI;
     |SI aTipUltimaIT = "A";
          coba_2 = coba_2 - ((prom_acc + prom_ac2) * nDiasCambiaCot);
          cobb_2 = cobb_2 - (prom_enf * nDiasCambiaCot);
     |FINSI;
     |SI aTipUltimaIT = "M"; |O aTipUltimaIT = "P"; |O aTipUltimaIT = "R";
     |O aTipUltimaIT = "C";
          coba_4 = coba_4 - (prom_enf * nDiasCambiaCot);
          cobb_4 = cobb_4 - (prom_acc * nDiasCambiaCot);
     |FINSI;
|FPRC;

|PROCESO TipoXenIT_Reverso;
     swAjuste3 = 0;

     |SI swCambiaCot = 1;
          nBisiesto = 0;
          nNume = nElAny $ 4;
          |SI nNume = 0;
               nBisiesto = 1;
          |FINSI;
          |SI nElMes = 2;
               nDiasCambiaCot = -2 + nBisiesto;
          |SINO;
               nDiasCambiaCot = 1;
          |FINSI;
     |FINSI;

     |SI aTipUltimaIT = "E";
          coba_1 = coba_1 + (prom_enf * nDiasCambiaCot);
          cobb_1 = cobb_1 + (prom_acc * nDiasCambiaCot);
     |FINSI;
     |SI aTipUltimaIT = "A";
          coba_2 = coba_2 + ((prom_acc + prom_ac2) * nDiasCambiaCot);
          cobb_2 = cobb_2 + (prom_enf * nDiasCambiaCot);
     |FINSI;
     |SI aTipUltimaIT = "M"; |O aTipUltimaIT = "P"; |O aTipUltimaIT = "R";
     |O aTipUltimaIT = "C";
          coba_4 = coba_4 + (prom_enf * nDiasCambiaCot);
          cobb_4 = cobb_4 + (prom_acc * nDiasCambiaCot);
     |FINSI;
|FPRC;


|PROCESO Lineas;
     nDiasCotTot = 0;
     nBaseTotalIT = 0;
     |HAZ PonACero;

     |SI #labtraba#45 = "087"; |O #labtraba#45 = "097";
     |O #labtraba#45 = "085"; |O #labtraba#45 = "421";
          |HAZ Formacion;
     |FINSI;

     |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
          dcoti_0 = dcoti_c;
     |FINSI;

     |SI diastc2 ! 0; |Y #labtraba#42 ! "P";
          dcoti_0 = diastc2;
          dia_2 = diastc2;
     |FINSI;

     |SI dalta_3 ! 1; |O dbaja_3 ! guarda;        || para sacar los dias reales en alta
          nume10 = dcoti_0;   || dias reales alta, dias alta: dias naturales
     |SINO;
          nume10 = dia_2;     || dias del mes reales
     |FINSI;

     nCucu = denfe_2 + dacci_2;
     |SI nCucu ! 0; |Y #labtraba#241 = "N"; |Y #labtraba#138 = "N";
          dcont_2 = nCucu;
          dmate_2 = nCucu;
          denfe_2 = 0;
          dacci_2 = 0;
          swCont = 1;
     |FINSI;

     |SI aDef = "nomcalac";
          |HAZ ParcheAtrDesTP;
     |FINSI;

     |SI #11#181 = "S";
          |HAZ TipoXenIT;
     |FINSI;

     |HAZ AjusteMensual;

     nClave = 11000;     || base en ALTA
     nDiasCot = dcoti_0 - (denfe_2 + dacci_2 + dmate_2) + swAjuste3;
     nDiasCot = nDiasCot + nDiasCambiaCot;
     |SI nDiasDesCoef > 0;
          nNume = nDiasDesCoef ! 0;
          |SI nNume ! nDiasDesCoef;
               nDiasCot = 0;
          |FINSI;
     |FINSI;
     |HAZ TiempoParcial;

     |SI aDef = "nomcalac";
          nDiasCot = nDiasCot - ddese_3;
     |FINSI;

     |SI nDiasCot < 0; nDiasCot = 0; |FINSI;

     |SI #nomredco#1 = "7.3.0";
          nDiasNat = nume10 - (denfe_2 + dacci_2 + dmate_2 + ddese_2);
     |SINO;
          nDiasNat = nume10 - (denfe_2 + dacci_2 + dmate_2 + ddese_2 + ddese_3);
     |FINSI;
     |SI ddese_2 > 0;
          nDiasNat = nDiasNat + swAjusteD;
     |FINSI;

     nBaseDiaria = 0;    || no la grabo de momento, no me hace falta realmente
     || nBase = base_6 - (coba_1 + cobb_2 + coba_3);
     || no tengo que quitar de aqui la base de absentismo 12.01.2010 - 001624.01461
     nBase = base_6 - (coba_1 + cobb_2);
     |SI dmate_2 = 0;
          |SI nBaseIT2 ! 0;
               nBase = nBase + (swAjuste3 * nBaseIT2);
          |SINO;
               nBase = nBase + (swAjuste3 * prom_enf);
          |FINSI;
     |FINSI;

     nBaseAlta = 0;
     nDiferencia = 0;
     |SI ddese_3 ! 0;    || desempleo a TP
          nBaseMatPatRie = 0;
          |SI dmate_2 > 0;
               nBaseMatPatRie = (dmate_2 - swAjuste3) * prom_enf;
          |FINSI;
          nBase = nBase - (ddese_3 * (base_6 - base_5 + nBaseMatPatRie) / (nDiasCot + ddese_3));
          nBaseAlta = nBase ! 2;
     |FINSI;

     |HAZ Formacion2;
     |HAZ Desempleo2;

     |SI nBase > 0.10; |Y #labtraba#248 ! 515;
          nDiasCotTot = nDiasCotTot + nDiasCot;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotAlta = nDiasCot;

     nClave = 12000;
     nBase = base_7 - (cobb_1 + coba_2);
     |SI dmate_2 = 0;
          |SI nBaseIT2 ! 0;
               nBase = nBase + (swAjuste3 * nBaseIT2);
          |SINO;
               nBase = nBase + (swAjuste3 * prom_enf);
          |FINSI;
     |FINSI;
     |SI ddese_3 ! 0;    || desempleo a TP
          nBaseMatPatRie = 0;
          |SI dmate_2 > 0;
               nBaseMatPatRie = (dmate_2 - swAjuste3) * prom_enf;
          |FINSI;
          nBase = nBase - (ddese_3 * (base_7 - base_5 + nBaseMatPatRie) / (nDiasCotAlta + ddese_3));
     |FINSI;
     |HAZ Formacion2;
     |HAZ Desempleo2;
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;

     |HAZ PonACero;

     || en verdad esta condicion no tengo muy claro por que esta aqui, pero
     || en meses en que estoy todo el tiempo de reg. empleo (sin IT) no debe
     || estar, se deben quedar los dias de nDiasCotAlta a cero

     nNume = denfe_2 + dacci_2 + dmate_2;
     || SI nDiasCotAlta = 0;
     || SI nPropDesTP ! 0; |Y ddese_3 ! 0; |Y nNume ! 0;
     || SI ddese_3 ! 0; |Y nPropDesTP ! 0;
     |SI ddese_3 ! 0;
          || nDiasCotAlta = ddese_2 - ((denfe_2 + dacci_2 + dmate_2 + swAjuste3) * nPropDesTP / 100);
          nDiasCotAlta = nDiasCotAlta + ddese_3;
     |FINSI;

     nClave = 311000;     || base en ALTA en ERE a TP
     nNume = (denfe_2 + dacci_2 + dmate_2);
     |SI #nomredco#1 = "7.3.0";
          nDiasCot = ddese_2 + ddese_3 + swAjuste3;
     |SINO;
          nDiasCot = ddese_3;
     |FINSI;

     |SI nDiasDesCoef > 0;
          nNume = nDiasDesCoef ! 0;
          |SI nNume ! nDiasDesCoef;
               nDiasCot = dcoti_0 - (denfe_2 + dacci_2 + dmate_2) + swAjuste3;
               ddese_3 = nDiasCot;
               nDiasCotAlta = nDiasCot;
          |FINSI;
     |FINSI;

     |SI ddese_3 > #11#8;
          nDiasCot = #11#8;
          nDiasCotAlta = nDiasCot;
     |FINSI;

     |HAZ TiempoParcial;

     /*
               || lo quito definitivamente 21.01.2013
               || tiquet 3512.1089, atrasos mes 10, trabajador 00077.00004

     |SI aDef = "nomcalac";
          |SI nDiasCotAlta = ddese_3;
               || no hagas nada: mirar comentario
               || del final del PROCESO TiempoParcial
          |SINO;
               |SI es_parcial = 1;|O es_irregul = 1;
                    || si es un ERE a TP en un trab. que ya era a TP
                    || esto no hay que hacerlo, me estropea el calculo
                    || de las bases
                    || realmente tampoco se por que esta para el resto
                    || de casos, si da problemas, plantearse el quitarlo
                    || 16.11.2011 - 002884.02054
               |SINO;
                    |SI nClave = 311000;     || base en ALTA en ERE a TP
                    || en la clave 311000 en atrasos me hace falta
                         ddese_3 = nAtrDiasTP_Alta;
                         nDiasCot = ddese_2 + ddese_3 + swAjuste3;
                         nDiasCotAlta = ddese_3;
                         || lo pongo aqui otra vez porque en atrasos la var. ddese_3
                         || se calcula dentro del proceso Tiempo PArcial
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     */

     || atencion, aqui hay un problema cuando se trata de ERE con el parametro
     || de multiplicar por 1.25 activado y ademas e ERE tenemos mater o pater
     || se puede comprobar con el tiquet 135.2863
     || cuando se arregle esto hay que tocar tamien el silcon10 y quitar las
     || lineas que sobran, busca "135.2863" y veras de que se trata

     nDiasNat = ddese_3;
     nBaseDiaria = 0;    || no la grabo de momento, no me hace falta realmente
     nBase = base_6 - (coba_1 + cobb_2);
     |SI dmate_2 = 0;
          |SI nBaseIT2 ! 0;
               nBase = nBase + (swAjuste3 * nBaseIT2);
          |SINO;
               nBase = nBase + (swAjuste3 * prom_enf);
          |FINSI;
     |FINSI;
     nBase = nDiasCot * (nBase / nDiasCotAlta);

     |SI nBase > 0.10;
          |SI nBaseAlta ! 0;
               nNume = nBaseAlta + (nBase ! 2);
               nDiferencia = nNume - (base_6 ! 2);
               |SI 0 < nDiferencia; |Y nDiferencia [ 0.02;
                    || existe una diferencia que despues en los lotes me dara
                    || problemas, la ajusto
                    nBase = nBase - nDiferencia;
               |FINSI;
          |FINSI;
          nDiasCotTot = nDiasCotTot;
          |HAZ GrabaLin;
     |FINSI;

     nClave = 312000;
     || nBase = ddese_3 * (base_7 / (nDiasCotAlta + ddese_3));
     nBase = base_7 - (coba_1 + cobb_2);
     |SI dmate_2 = 0;
          |SI nBaseIT2 ! 0;
               nBase = nBase + (swAjuste3 * nBaseIT2);
          |SINO;
               nBase = nBase + (swAjuste3 * prom_enf);
          |FINSI;
     |FINSI;
     nBase = nDiasCot * (nBase / nDiasCotAlta);

     |SI nBase > 0.10;
          |SI nBaseAlta ! 0;
               nNume = nBaseAlta + (nBase ! 2);
               nDiferencia = nNume - (base_7 ! 2);
               |SI 0 < nDiferencia; |Y nDiferencia [ 0.02;
                    || existe una diferencia que despues en los lotes me dara
                    || problemas, la ajusto
                    nBase = nBase - nDiferencia;
               |FINSI;
          |FINSI;
          |HAZ GrabaLin;
     |FINSI;

     |HAZ PonACero;

     nClave = 21000;                         || enfermedad CC
     nDiasNat = denfe_2;

     |SI denfe_2 ! 0; |Y dries_2 ! 0;
          || novedad, empezamos por aqui para introducir que la ultima IT
          || sea donde se realice el ajuste, muy fuerte hacerlo para todos
          || los tipos de IT, empezare por este caso e iremos poco a poco
          || con los que vayan saliendo

          || ENF + RIE
          |SI aTipoAjuste = "E";
               nDiasCot = denfe_2 - swAjuste3;
          |SINO;
               nDiasCot = denfe_2;
          |FINSI;
     |SINO;
          |SI denfe_2 > 0;
               |SI dacci_2 ] 0; |Y dmate_2 = 0;
                    nDiasCot = denfe_2 - swAjuste3;
               |SINO;
                    nDiasCot = denfe_2;
               |FINSI;
               |SI nBaseIT2 ! 0;
                    |SI aTipoITBase2 = "E";
                         nDiasCot = denfe_2 - swAjuste3;
                    |SINO;
                         nDiasCot = denfe_2;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ MaximoMes;
     nBaseDiaria = prom_enf;
     nBase = nDiasCot * nBaseDiaria;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "E";
               nDiasEnfBase2 = nDiasEnfBase2 - swAjuste3;
          |FINSI;
          nBaseDiaria = nBaseIT2;
          nBase = (nDiasCot - nDiasEnfBase2) * prom_enf;
          nBase = nBase + (nDiasEnfBase2 * nBaseDiaria);
     |FINSI;

     nBaseTotalIT = nBaseTotalIT + nBase;
     |HAZ CompBaseIT;
     |SI aDef = "nomcalac";
          |HAZ ITAtrasos;
     |FINSI;

     |HAZ TiempoParcial;
     |SI nBase > 0.10; |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;
     nClave = 22000;                         || enfermedad CP
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
     nClave = 29000;                         || prestaciones enf
     nBase = acum_53;
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotEnf = nDiasCot;

     |HAZ PonACero;
     nClave = 31000;                         || accidente CC
     nDiasNat = dacci_2;

     |SI denfe_2 = 0; |Y dmate_2 = 0;
          nDiasCot = dacci_2 - swAjuste3;
     |SINO;
          nDiasCot = dacci_2;
     |FINSI;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "A";
               nDiasCot = dacci_2 - swAjuste3;
          |SINO;
               nDiasCot = dacci_2;
          |FINSI;
     |FINSI;
     |HAZ MaximoMes;
     nBaseDiaria = prom_enf;
     nBase = nDiasCot * nBaseDiaria;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "A";
               nDiasAccBase2 = nDiasAccBase2 - swAjuste3;
          |FINSI;
          nBaseDiaria = nBaseIT2;
          nBase = (nDiasCot - nDiasAccBase2) * prom_enf;
          nBase = nBase + (nDiasAccBase2 * nBaseDiaria);
     |FINSI;

     nBaseTotalIT = nBaseTotalIT + nBase;
     |HAZ CompBaseIT;
     |SI aDef = "nomcalac";
          |HAZ ITAtrasos;
     |FINSI;
     |HAZ TiempoParcial;
     |SI nBase > 0.10; |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;

     nClave = 32000;                         || accidente CP
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
     nClave = 39000;                         || prestaciones Acc
     nBase = acum_54;
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotAcc = nDiasCot;

     |HAZ PonACero;

     nClave = 41000;                         || maternidad CC
     nDiasNat = dmate_2 - dries_2 - dcont_2;
     nDiasCot = dmate_2 - swAjuste3 - dries_2 - dcont_2;

     || esto es lo mismo que el proceso liquidados del nomcal_2, si no
     || lo hago aqui me sale mal la maternidad en febrero si esta todo el mes
     |SI nDiasCot = dia_2; |Y nDiasCot < dia_4;
          |SI #labtraba#42 ! "C"; |Y swAjuste3 = 0;
               || solo si no he hecho antes ajuste, si lo he hecho
               || ya no es necesario realizar mas ajustes
               nDiasCot = dia_4;
          |FINSI;
     |FINSI;
     |SI nElMes = 2; |Y swCambiaCot = 1;
          || a ver, febrero, todo el mes en maternidad, TP X ... los dias
          || naturales, valdria para cualquier mes, pero es otro parche
          nDiasCot = nDiasNat;
     |FINSI;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "M";
               nDiasCot = dmate_2 - swAjuste3 - dries_2 - dcont_2;
          |SINO;
               nDiasCot = dmate_2 - dries_2 - dcont_2;
          |FINSI;
     |FINSI;

     |HAZ MaximoMes;

     |SI nPromEnf_ENTERO ! 0;
          nBaseDiaria = nPromEnf_ENTERO;
     |SINO;
          nBaseDiaria = prom_enf;
     |FINSI;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "M";
               nBaseDiaria = nBaseIT2;
          |FINSI;
     |FINSI;

/*
     || este ajuste no tiene sentido, ya que por culpa de el se graban
     || 32 dias al sumar un dias de ajuste que no tiene que estar
     || lo quito 5127.475

     |SI aTipUltimaIT = "M"; |Y swCambiaCot = 1; |Y nDiasCotAlta = 0;
          |SI dalta_3 = 1; |Y dbaja_3 = nTopemes;
               || ajuste necesario solo si todo el mes de alta y en mat/pat/rie
               |SI denfe_2 = 0; |Y dries_2 = 0;
                    || si estoy todo el mes de IT pero es pq tengo mat y enf
                    || o rie todo el tiempo no, tiene que ser TODO el mes MAT
                    nDiasCot = nDiasCot + nDiasCambiaCot;
               |FINSI;
          |FINSI;
     |FINSI;
*/
     nBase = nDiasCot * nBaseDiaria;

     |SI #11#181 = "S";
          || tp en IT, todo el mes maternidad, mes de 31 dias, X-M
          |SI aCCTopeadas = "m"; |Y nDiasCot = dia_2;
               || TOPEADO A MINIMOS, la base es la base_5
               nBase = base_5;

               || ESTO ES PARA EL CASO DEL 5127.278, si provoca algun fallo
               || estudiarlo mejor
          |FINSI;
          |SI aCCTopeadas = "m"; |Y denfe_2 = 0; |Y dacci_2 = 0;
               || fallara si tiene riesgo o enfermedad, lo dejo asi de momento
               nBase = base_5;
          |FINSI;
     |FINSI;

     |HAZ Formacion3;

     |HAZ TiempoParcial;

     |SI aDef ! "nomcalac"; |Y swMater = 1;
          #11#117 = nBase;         || para grabar la base de maternidad
          |GRABA 020#11a;
     |FINSI;
     |SI nBase > 0.10; |Y swMater = 1;
     |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;
     nClave = 42000;                         || maternidad CP
     |SI nBase > 0.10; |Y swMater = 1;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotMat = nDiasCot;

     |HAZ PonACero;

     nClave = 51000;                         || paternidad CC
     nDiasNat = dmate_2;
     nDiasCot = dmate_2 - swAjuste3;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "P";
               nDiasCot = dmate_2 - swAjuste3;
          |SINO;
               nDiasCot = dmate_2;
          |FINSI;
     |FINSI;
     |HAZ MaximoMes;
     |SI nPromEnf_ENTERO ! 0;
          nBaseDiaria = nPromEnf_ENTERO;
     |SINO;
          nBaseDiaria = prom_enf;
     |FINSI;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "P";
               nBaseDiaria = nBaseIT2;
          |FINSI;
     |FINSI;
     |SI aTipUltimaIT = "P"; |Y swCambiaCot = 1; |Y nDiasCotAlta = 0;
          |SI dalta_3 = 1; |Y dbaja_3 = nTopemes;
               || ajuste necesario solo si todo el mes de alta y en mat/pat/rie
               nDiasCot = nDiasCot + nDiasCambiaCot;
          |FINSI;
     |FINSI;
     nBase = nDiasCot * nBaseDiaria;
     |HAZ TiempoParcial;
     |SI aDef ! "nomcalac"; |Y swPater = 1;
          #11#117 = nBase;         || para grabar la base de maternidad/paternidad
          |GRABA 020#11a;          || antes no lo haciamos pero ya nos ha salido
     |FINSI;                       || un lote con formacion y paternidad
     |SI nBase > 0.10; |Y swPater = 1;
     |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;

     nClave = 52000;                         || paternidad CP
     |SI #labtraba#7 = "21676665Q   "; || COMERSAN
          |SI prom_enf ! prom_acc;
               nBaseDiaria = prom_acc;
               nBase = nDiasCot * nBaseDiaria;
          |FINSI;
     |FINSI;

     |SI nBase > 0.10; |Y swPater = 1;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotPat = nDiasCot;

     |HAZ PonACero;

     nClave = 61000;                         || riesgo embarazo CC
     nDiasNat = dries_2;
     nNume1 = dmate_2 - dries_2;
     |SI denfe_2 ! 0; |Y dries_2 ! 0;
          || novedad, empezamos por aqui para introducir que la ultima IT
          || sea donde se realice el ajuste, muy fuerte hacerlo para todos
          || los tipos de IT, empezare por este caso e iremos poco a poco
          || con los que vayan saliendo

          || ENF + RIE
          |SI aTipoAjuste = "R";
               nDiasCot = dries_2 - swAjuste3;
          |SINO;
               nDiasCot = dries_2;
          |FINSI;
     |SINO;
          |SI denfe_2 = 0; |Y dacci_2 = 0; |Y nNume1 = 0;
               nDiasCot = dries_2 - swAjuste3;
          |SINO;
               nDiasCot = dries_2;
          |FINSI;
     |FINSI;
     |HAZ MaximoMes;
     |SI nPromEnf_ENTERO ! 0;
          nBaseDiaria = nPromEnf_ENTERO;
     |SINO;
          nBaseDiaria = prom_enf;
     |FINSI;
     |SI nBaseIT2 ! 0;
          |SI aTipoITBase2 = "R";
               nBaseDiaria = nBaseIT2;
          |FINSI;
     |FINSI;
     |SI aTipUltimaIT = "R"; |Y swCambiaCot = 1; |Y nDiasCotAlta = 0;
          |SI dalta_3 = 1; |Y dbaja_3 = nTopemes;
               || ajuste necesario solo si todo el mes de alta y en mat/pat/rie
               nDiasCot = nDiasCot + nDiasCambiaCot;
          |FINSI;
     |FINSI;
     nBase = nDiasCot * nBaseDiaria;

     |HAZ Formacion3;

     |HAZ TiempoParcial;
     |SI aDef ! "nomcalac"; |Y swRiesgo = 1;
          #11#130 = nBase;         || para grabar la base de riesgo
          |GRABA 020#11a;
     |FINSI;
     |SI nBase > 0.10;
     |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;

     nClave = 62000;                         || riesgo embarazo CP
     |SI prom_enf ! prom_acc;
          nBaseDiaria = prom_acc;
     |SINO;
          nBaseDiaria = prom_enf;
     |FINSI;
     nBase = nDiasCot * nBaseDiaria;
     |HAZ Formacion3;
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotRie = nDiasCot;

     |HAZ PonACero;

     nNume = ddese_2 + ddese_3;         || redondeo por si los "XX.XX5"
     ddese_2 = ddese_2 ! 2;             || de las narices
     ddese_3 = nNume - ddese_2;
     nClave = 71000;                         || Expediente regulacion Empleo CC

     nDiasNat = ddese_2 - ddese_4 - swAjusteD;
     nDiasCot = ddese_2 - ddese_4;
     |SI nDiasDesCoef > 0;
          nNume = nDiasDesCoef ! 0;
          |SI nNume ! nDiasDesCoef;
               nDiasNat = nDiasNat - ddese_3;
               nDiasCot = nDiasCot - ddese_3;
          |FINSI;
     |FINSI;
     |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
          |SI nDiasCot > 30;
               nDiasCot = 30;
          |FINSI;
     |FINSI;
     |HAZ TiempoParcial; || aqui no

     |SI aDef = "nomcalac";                  || si en atrasos tengo ERE a TP
          |SI nAtrDiasTP_Des ! 0;            || le quito al ddese_2 la parte de
               ddese_2 = nAtrDiasTP_Des;     || ERE a TP
               nDiasNat = ddese_2 + ddese_3;
               nDiasCot = ddese_2 + ddese_3 - swAjuste3;

               || lo pongo aqui otra vez porque en atrasos la var. ddese_3
               || se calcula dentro del proceso Tiempo PArcial
          |FINSI;
     |FINSI;
     |SI aDef = "nomcalca";
          nBaseDiaria = #labtraba#242;

          |SI #labtraba#45 = "421";
               nBase = #11#128;
          |SINO;
               nBase = nDiasCot * nBaseDiaria;
          |FINSI;
     |FINSI;
     |SI aDef = "nomcalac";
          nBaseDiaria = nUnid990;
          nBase = ddese_2 * nBaseDiaria;
     |FINSI;
     |HAZ MaximoMes;
     |SI nBase > 0.10;
     |Y #labtraba#248 ! 515;
          |SI #nomredco#1 = "7.3.0";
               nDiasCotTot = nDiasCotTot + ddese_2;
          |SINO;
               nDiasCotTot = nDiasCotTot + nDiasCot;
          |FINSI;
          |HAZ GrabaLin;
     |FINSI;
     nClave = 72000;                         || Expediente regulacion Empleo CP
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
     || para la nueva clave 081000
     |SI #nomredco#1 ! "7.3.0";
          |HAZ PonACero;
          nClave = 81000;                    || Expediente regulacion Empleo a TP CC

          nDiasNat = ddese_4;
          nDiasCot = ddese_4;
          || nDiasCot = ddese_3 - swAjuste3;
          || no hace falta ajuste, ya se ha hecho antes, ademas de que quedamos en
          || que para el ERE van los dias exactos en ERE, sin ajustar

/*
          || esto tampoco, quedamos (no se si alguien se acordara) que en los ERE
          || a tiempo parcial no se aplicaba lo del control de aplicacion, campo 55
          |SI nDiasDesCoef > 0;
               nNume = nDiasDesCoef ! 0;
               |SI nNume ! nDiasDesCoef;
                    nDiasNat = nDiasNat - ddese_3;
                    nDiasCot = nDiasCot - ddese_3;
               |FINSI;
          |FINSI;
*/

          |HAZ TiempoParcial;
          |SI aDef = "nomcalac";                  || si en atrasos tengo ERE a TP
               |SI nAtrDiasTP_Des ! 0;            || le quito al ddese_2 la parte de
                    ddese_2 = nAtrDiasTP_Des;     || ERE a TP
                    nDiasNat = ddese_4;
                    nDiasCot = ddese_4;

                    || lo pongo aqui otra vez porque en atrasos la var. ddese_3
                    || se calcula dentro del proceso Tiempo PArcial
               |FINSI;
          |FINSI;
          |SI aDef = "nomcalca";
               nBaseDiaria = #11#127;
               nBase = #11#128 - (#11#141 * nBaseDiaria);
          |FINSI;
          |SI aDef = "nomcalac";
               nBaseDiaria = nUnid990;
               nBase = ddese_4 * nBaseDiaria;
          |FINSI;
          |HAZ MaximoMes;
          |SI nBase > 0.10;
                nDiasCotTot = nDiasCotTot + ddese_4;
                |HAZ GrabaLin;
          |FINSI;
          nClave = 82000;                         || Expediente regulacion Empleo CP
          |SI nBase > 0.10;
               |HAZ GrabaLin;
          |FINSI;
     |FINSI;

     |HAZ PonACero;

     nClave = 91000;                         || Control IT Pago SS (Agotamiento pago delegado)
     nDiasNat = dcont_2;
     nDiasCot = dcont_2 - swAjuste3;
     |HAZ MaximoMes;
     nBaseDiaria = prom_enf;

     |SI aTipUltimaIT = "C"; |Y swCambiaCot = 1; |Y nDiasCotAlta = 0;
          |SI dalta_3 = 1; |Y dbaja_3 = nTopemes;
               || ajuste necesario solo si todo el mes de alta y en mat/pat/rie
               nDiasCot = nDiasCot + nDiasCambiaCot;
          |FINSI;
     |FINSI;

     nBase = nDiasCot * nBaseDiaria;
     |HAZ TiempoParcial;
     |SI aDef ! "nomcalac"; |Y swCont = 1;
          #11#132 = nBase;         || para grabar la base de riesgo
          |GRABA 020#11a;
     |FINSI;
     |SI nBase > 0.10; |Y swCont = 1;
     |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;
     nClave = 92000;                         || riesgo embarazo CP
     |SI nBase > 0.10; |Y swCont = 1;
          |HAZ GrabaLin;
     |FINSI;
     nDiasCotMat = nDiasCot;

     nClave = 93000;            || PERMISO SIN RETRIBUCION
     nDiasNat = dperm_2;
     nDiasCot = dperm_2;
     |HAZ MaximoMes;
     nBaseDiaria = coba_5 / dperm_2;

     nBase = nDiasCot * nBaseDiaria;
     |HAZ TiempoParcial;
     |SI nBase > 0.10;
     |Y #labtraba#248 ! 515;
           nDiasCotTot = nDiasCotTot + nDiasCot;
           |HAZ GrabaLin;
     |FINSI;
     nClave = 94000;                         || riesgo embarazo CP
     |SI nBase > 0.10;
          |HAZ GrabaLin;
     |FINSI;
|FPRC;

|PROCESO Cumplea¤os;               || comprueba si este mes cumple 59 a¤os
     aAlfa = #labtraba#11;         || ahora compruebo que tengo 2 bonif.
     aAlfa1 = aAlfa % 402;
     aAlfa2 = aAlfa % -104;
     nume1 = aAlfa1;     || mes
     nume2 = aAlfa2;     || a¤o
     nume3 = enAny - nume2;
     |SI enMes = nume1;
          nCumple = nume3;
          nEdad = nume3;
     |FINSI;
     |SI enMes > nume1;
          nEdad = nume3;
     |FINSI;
     |SI enMes < nume1;
          nEdad = nume3 - 1;
     |FINSI;

                                   || comprueba si este mes cumple Antiguedad
     aAlfa = #labtraba#34;         || ahora compruebo que tengo 2 bonif.

     |SI #labtraba#212 = 01; |O #labtraba#212 = 03; |O #labtraba#212 = 05;
     |O #labtraba#212 = 13; |O #labtraba#212 = 15;
          aAlfa = #labtraba#34;
     |FINSI;
     |SI #labtraba#212 = 02; |O #labtraba#212 = 04; |O #labtraba#212 = 06;
     |O #labtraba#212 = 14; |O #labtraba#212 = 16;
          aAlfa = #labtraba#36;
     |FINSI;
     aAlfa1 = aAlfa % 402;
     aAlfa2 = aAlfa % -104;
     nume1 = aAlfa1;     || mes
     nume2 = aAlfa2;     || a¤o
     nume3 = enAny - nume2;
     |SI enMes = nume1;
          nCumpleAnti = nume3;
          nAnti = nume3;
     |FINSI;
     |SI enMes > nume1;
          nAnti = nume3;
     |FINSI;
     |SI enMes < nume1;
          nAnti = nume3 - 1;
     |FINSI;

     || cumplo 5 a¤os de antiguedad y estoy en edad de haberme estado apli-
     || cando la de 4 a¤os de antiguedad, paso a aplicarme 5 a¤os (la del 50%)
     || hago un truquillo

     |SI nCumpleAnti = 5; |Y nEdad ] 60;
          nCumple = 60;
          nEdad = 59;
     |FINSI;

     |SI nCumpleAnti = 4;     || realmente lo hago solo para que entre en la
          nCumpleAnti = 0;    || siguiente condicion el mes que cumple 4 a¤os
     |FINSI;                  || de antiguedad teniendo mas de 59, si no, no
                              || entra, podia haber modificado la condicion
                              || poniendo "Y nCumpleAnti ] 0" pero no me fio
                              || 09.06.2010 - 01016.00272

     |SI nEdad ] 60; |Y nAnti = 4;      || cumplo 60 pero tengo 4 a¤os de ant.
     |Y nCumpleAnti = 0;
          nCumple = 0;
          nEdad = 59;
     |FINSI;
|FPRC;

|PROCESO DivideTramosJuv;
     |SI #nomcaldl#5 = 011000; |O #nomcaldl#5 = 012000; |O #nomcaldl#5 = 012507; |O #nomcaldl#5 = 012199;
     |O #nomcaldl#5 = 021000; |O #nomcaldl#5 = 022000; |O #nomcaldl#5 = 022507; |O #nomcaldl#5 = 022199;
     |O #nomcaldl#5 = 029000;

|| primero grabo el tramo bonificado
          |SALVA_FICHA #nomcaldl;
          nLinea = #nomcaldl#5;
          nLinea = 600000 + nLinea;
          #nomcaldl#5 = nLinea;

          aDescripcion = #nomcaldl#6;
          |QBF aDescripcion;
          aDescripcion = aDescripcion + " Tramo Gar. Juvenil";
          #nomcaldl#6 = aDescripcion;

          nAntDias = #nomcaldl#8;
          nPropJuv = nDiasBonifJuv / nAntDias;
          #nomcaldl#7 = nDiasBonifJuv;
          #nomcaldl#8 = nDiasBonifJuv;

          |SI #nomcaldl#9 ! 0;
               #nomcaldl#9 = (#nomcaldl#8 * #labtraba#47) ! 0;
          |FINSI;

          |SI #nomcaldl#5 = 611000; |O #nomcaldl#5 = 621000;
               #nomcaldl#10 = (#nomcaldl#10 * nPropJuv) ! 2;
          |FINSI;
          |SI #nomcaldl#5 = 612000; |O #nomcaldl#5 = 622000;
               #nomcaldl#10 = (#nomcaldl#10 * nPropJuv) ! 2;
          |FINSI;
          /*
          |SI #nomcaldl#5 = 429000;
               #nomcaldl#10 = #nomcaldl#10 * (#11#82 / (#11#82 + #11#83));
          |FINSI;
          */
          |SI #nomcaldl#5 = 612199; |O #nomcaldl#5 = 622199;
               #nomcaldl#10 = #11#170;
          |FINSI;
          |SI #nomcaldl#5 = 612507; |O #nomcaldl#5 = 622507;
               #nomcaldl#10 = (#nomcaldl#10 * nPropJuv) ! 2;
          |FINSI;
          |GRABA 020#nomcaldl.n;
          |LIBERA #nomcaldl;

|| ahora regrabo la linea "normal"
          |REPON_FICHA #nomcaldl;

          #nomcaldl#7 = #nomcaldl#7 - nDiasBonifJuv;
          #nomcaldl#8 = #nomcaldl#8 - nDiasBonifJuv;

          |SI #nomcaldl#9 ! 0;
               #nomcaldl#9 = (#nomcaldl#8 * #labtraba#47) ! 0;
          |FINSI;
          |SI #nomcaldl#5 = 011000; |O #nomcaldl#5 = 021000;
               #nomcaldl#10 = #nomcaldl#10 - ((#nomcaldl#10 * nPropJuv) ! 2);
          |FINSI;
          |SI #nomcaldl#5 = 012000; |O #nomcaldl#5 = 022000;
               #nomcaldl#10 = #nomcaldl#10 - ((#nomcaldl#10 * nPropJuv) ! 2);
          |FINSI;
          |SI #nomcaldl#5 = 012199; |O #nomcaldl#5 = 022199;
               #nomcaldl#10 = 0;
          |FINSI;
          |SI #nomcaldl#5 = 012507; |O #nomcaldl#5 = 022507;
               #nomcaldl#10 = #nomcaldl#10 - ((#nomcaldl#10 * nPropJuv) ! 2);
          |FINSI;
          /*
          |SI #nomcaldl#5 = 529000;
               #nomcaldl#10 = #nomcaldl#10 - (#nomcaldl#10 * (#11#82 / (#11#82 + #11#83)));
          |FINSI;
          */

          |SI #nomcaldl#10 ! 0;
               |GRABA 020#nomcaldl.a;
          |SINO;
               |BORRA 020#nomcaldl.a;
          |FINSI;

          |LIBERA #nomcaldl;
     |FINSI;
|FPRC;

|DEFBUCLE DivideTramosJuv;
     #nomcaldl#1;
     ;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 000001;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 999999;
     be;
     NULL, DivideTramosJuv;
|FIN;

|PROCESO BonifDosTramosJuv;
     |BUCLE DivideTramosJuv;
|FPRC;

|PROCESO DivideTramos502;
     |SI #nomcaldl#5 = 011000; |O #nomcaldl#5 = 012000; |O #nomcaldl#5 = 012502;
     |O #nomcaldl#5 = 021000; |O #nomcaldl#5 = 022000; |O #nomcaldl#5 = 022502;
     |O #nomcaldl#5 = 041000; |O #nomcaldl#5 = 042000; |O #nomcaldl#5 = 042502;
     |O #nomcaldl#5 = 029000;
          |SALVA_FICHA #nomcaldl;
          nLinea = #nomcaldl#5;
          nLinea = 400000 + nLinea;
          #nomcaldl#5 = nLinea;

          aDescripcion = #nomcaldl#6;
          |QBF aDescripcion;
          aDescripcion = aDescripcion + " Tramo 1 Bonif.";
          #nomcaldl#6 = aDescripcion;

          #nomcaldl#7 = #11#82;
          #nomcaldl#8 = #11#82;

          |SI #nomcaldl#9 ! 0;
               #nomcaldl#9 = (#11#82 * #labtraba#47) ! 0;
          |FINSI;

          |SI #nomcaldl#5 = 411000; |O #nomcaldl#5 = 421000;
          |O #nomcaldl#5 = 431000; |O #nomcaldl#5 = 441000;
               #nomcaldl#10 = #11#43;
          |FINSI;
          |SI #nomcaldl#5 = 412000; |O #nomcaldl#5 = 422000;
          |O #nomcaldl#5 = 432000; |O #nomcaldl#5 = 442000;
               #nomcaldl#10 = #11#44;
          |FINSI;
          |SI #nomcaldl#5 = 429000;
               #nomcaldl#10 = #nomcaldl#10 * (#11#82 / (#11#82 + #11#83));
          |FINSI;
          |SI #nomcaldl#5 = 412502; |O #nomcaldl#5 = 422502;
          |O #nomcaldl#5 = 432502; |O #nomcaldl#5 = 442502;
               #nomcaldl#10 = #11#63;
          |FINSI;
          |GRABA 020#nomcaldl.n;
          |LIBERA #nomcaldl;
          |REPON_FICHA #nomcaldl;

          |SALVA_FICHA #nomcaldl;
          nLinea = #nomcaldl#5;
          nLinea = 500000 + nLinea;
          #nomcaldl#5 = nLinea;

          aDescripcion = #nomcaldl#6;
          |QBF aDescripcion;
          aDescripcion = aDescripcion + " Tramo 2 Bonif.";
          #nomcaldl#6 = aDescripcion;

          #nomcaldl#7 = #nomcaldl#7 - #11#82;
          #nomcaldl#8 = #nomcaldl#8 - #11#82;

          |SI #nomcaldl#9 ! 0;
               #nomcaldl#9 = (#nomcaldl#8 * #labtraba#47) ! 0;
          |FINSI;
          |SI #nomcaldl#5 = 511000; |O #nomcaldl#5 = 521000;
          |O #nomcaldl#5 = 531000; |O #nomcaldl#5 = 541000;
               #nomcaldl#10 = #11#191;
          |FINSI;
          |SI #nomcaldl#5 = 512000; |O #nomcaldl#5 = 522000;
          |O #nomcaldl#5 = 532000; |O #nomcaldl#5 = 542000;
               #nomcaldl#10 = #11#192;
          |FINSI;
          |SI #nomcaldl#5 = 529000;
               #nomcaldl#10 = #nomcaldl#10 - (#nomcaldl#10 * (#11#82 / (#11#82 + #11#83)));
          |FINSI;
          |SI #nomcaldl#5 = 512502; |O #nomcaldl#5 = 522502;
          |O #nomcaldl#5 = 532502; |O #nomcaldl#5 = 542502;
               #nomcaldl#10 = #11#81;
          |FINSI;

          |GRABA 020#nomcaldl.n;
          |LIBERA #nomcaldl;
          |REPON_FICHA #nomcaldl;

          |BORRA 020#nomcaldl.a;
          |LIBERA #nomcaldl;
     |FINSI;
|FPRC;

|DEFBUCLE DivideTramos502;
     #nomcaldl#1;
     ;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 000001;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 999999;
     be;
     NULL, DivideTramos502;
|FIN;

|PROCESO BonifDosTramos502;
     |BUCLE DivideTramos502;
|FPRC;

|PROCESO DivideTramos501;
     |SI #nomcaldl#5 = 011000; |O #nomcaldl#5 = 012000; |O #nomcaldl#5 = 012501;
     |O #nomcaldl#5 = 041000; |O #nomcaldl#5 = 042000; |O #nomcaldl#5 = 042501;
          |SALVA_FICHA #nomcaldl;
          nLinea = #nomcaldl#5;
          nLinea = 400000 + nLinea;
          #nomcaldl#5 = nLinea;

          aDescripcion = #nomcaldl#6;
          |QBF aDescripcion;
          aDescripcion = aDescripcion + " Tramo 1 Bonif.";
          #nomcaldl#6 = aDescripcion;

          #nomcaldl#7 = #11#82;
          #nomcaldl#8 = #11#82;

          |SI #nomcaldl#9 ! 0;
               #nomcaldl#9 = (#11#82 * #labtraba#47) ! 0;
          |FINSI;

          |SI #nomcaldl#5 = 411000; |O #nomcaldl#5 = 441000;
               #nomcaldl#10 = #11#43;
          |FINSI;
          |SI #nomcaldl#5 = 412000; |O #nomcaldl#5 = 442000;
               #nomcaldl#10 = #11#44;
          |FINSI;
          |SI #nomcaldl#5 = 412501; |O #nomcaldl#5 = 422501;
               #nomcaldl#10 = #11#63;
          |FINSI;
          |GRABA 020#nomcaldl.n;
          |LIBERA #nomcaldl;
          |REPON_FICHA #nomcaldl;

          |SALVA_FICHA #nomcaldl;
          nLinea = #nomcaldl#5;
          nLinea = 500000 + nLinea;
          #nomcaldl#5 = nLinea;

          aDescripcion = #nomcaldl#6;
          |QBF aDescripcion;
          aDescripcion = aDescripcion + " Tramo SIN Bonif.";
          #nomcaldl#6 = aDescripcion;

          #nomcaldl#7 = #nomcaldl#7 - #11#82;
          #nomcaldl#8 = #nomcaldl#8 - #11#82;

          |SI #nomcaldl#9 ! 0;
               #nomcaldl#9 = (#nomcaldl#8 * #labtraba#47) ! 0;
          |FINSI;

          |SI #nomcaldl#5 = 511000;
               #nomcaldl#10 = #11#39 - #11#43;
          |FINSI;
          |SI #nomcaldl#5 = 541000;
               #nomcaldl#10 = #11#117 - #11#43;
          |FINSI;
          |SI #nomcaldl#5 = 512000;
               #nomcaldl#10 = #11#40 - #11#44;
          |FINSI;
          |SI #nomcaldl#5 = 542000;
               #nomcaldl#10 = #11#117 - #11#44;
          |FINSI;
          |SI #nomcaldl#5 ! 512501; |Y #nomcaldl#5 ! 542501;
               |GRABA 020#nomcaldl.n;
               |LIBERA #nomcaldl;
               |REPON_FICHA #nomcaldl;
          |FINSI;

          |BORRA 020#nomcaldl.a;
          |LIBERA #nomcaldl;
     |FINSI;
|FPRC;

|DEFBUCLE DivideTramos501;
     #nomcaldl#1;
     ;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 000001;
     #nomcaldc#0, #nomcaldc#1, #nomcaldc#2, #nomcaldc#3, #nomcaldc#4, 999999;
     be;
     NULL, DivideTramos501;
|FIN;

|PROCESO BonifDosTramos501;
     |BUCLE DivideTramos501;
|FPRC;

|PROCESO GrabaBases;
     |ABRE #nomredco; |LEE 101#nomredco.p; |CIERRA #nomredco;

     |ABRE #nomcaldc;
     |ABRE #nomcaldl;
     |ABRE #nomcaldm;

     aDef = "";
     |MODULO aAlfa;
     |QBF aAlfa;
     |SI aAlfa = "nomcalcu";
          aDef = "nomcalca";
     |FINSI;
     |SI aAlfa = "nomcalat";
          aDef = "nomcalac";
     |FINSI;

     |DBASS aRutaDef;
     |DBASS aRutaDatos;
     |QBF aRutaDef;
     |QBF aRutaDatos;
     aRutaDef = aRutaDef + "laboral/def/" + aDef + ".mas";
     |CARGA_DEF aRutaDef, calculos@;

     |SI FSalida ! 0;
         aAlfa = "    Error en CARGADEF: " + aRutaDef + " !!!";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aRutaDatos = aRutaDatos + "laboral/fich/";
     |PATH_DAT #11 aRutaDatos;
     |ABRE #11;

     #11#0 = #labtraba#0;
     #11#1 = #labtraba#1;
     #11#2 = enMes;
     |SI aDef = "nomcalca";
          #11#3 = 0;
     |FINSI;
     |SI aDef = "nomcalac";
          #11#3 = 5;
     |FINSI;
     |LEE 000#11=;

     |SI FSalida = 0;
          #nomcaldc#0 = #labtraba#0;
          #nomcaldc#1 = #labtraba#1;
          #nomcaldc#2 = enAny
          #nomcaldc#3 = enMes;
          #nomcaldc#4 = #11#3;
          |LEE 101#nomcaldc.=;
          |SI FSalida ! 0;
               |GRABA 020#nomcaldc.n;
          |FINSI;

          |BUCLE BorraLin;
          nDiasCotTot = 0;
          || mes que comienza la bonif. 59 a¤os y tengo otra de las antiguas ya
          nDiasBon1 = 0;
          |SI #11#63 > 0;
               |SI #11#106 > 0;
                    ||O #11#101 > 0;
                    nCumple = 0;
                    nCumpleAnti = 0;
                    nAnti = 0;
                    |HAZ Cumplea¤os;
                    |SI nCumple = 59;
                         aAlfa = #labtraba#11;
                         aAlfa = aAlfa % 102;
                         nume1 = aAlfa;
                         nDiasBon1 = nume1 - 1;
                    |FINSI;
               |FINSI;
          |FINSI;

          |HAZ Lineas;
          |HAZ PrimerReparto;
          |HAZ Bonificaciones;

          |SI #11#12 = 502; |Y #11#63 ! 0; |Y #11#81 ! 0;
               |HAZ BonifDosTramos502;
          |FINSI;

          || esto para que las bases de IT (los coba_s) vuelvan a ser las reales
          || si no la base en mat cambia y entra o no por donde no deberia
          |HAZ TipoXenIT_Reverso;

          nNume1 = coba_4 + #11#39;
          nNume2 = #11#43;
          nNume1 = nNume1 ! 2;
          nNume2 = nNume2 ! 2;
          |SI #11#12 = 501; |Y #11#63 ! 0; |Y nNume1 ! nNume2;
               || base CC distinta a base CC bonificada, entiendo que es
               || el mes donde acaba o empieza la bonif
               |HAZ BonifDosTramos501;
          |FINSI;

          |SI #11#170 ! 0; |Y nDiasBonifJuv ! #11#8;
               |HAZ BonifDosTramosJuv;
          |FINSI;
     |FINSI;

     |CIERRA #11;
     |DESCARGA_DEF #11;

     |CIERRA #nomcaldm;
     |CIERRA #nomcaldl;

     |LIBERA #nomcaldc;
     |CIERRA #nomcaldc;
|FPRC;
