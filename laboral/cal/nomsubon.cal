|FICHEROS;
     nomsubon #0;

     labempre;
     labtraba;
     nombonif;

     nomtmp09 #100;
|FIN;

|VARIABLES;
     aAlfa = "";
     aFechaBaja = "";
     fFechaBaja = @;
     aFechaAlta = "";
     fFechaAlta = @;
     fFechaIniRef = @;
     fFechaFinRef = @;
     swAcaba = 0;
     swCero = 0;

     nTotalAnys = 0;
     nTotalMeses = 0;
     nAnys = 0;
     nMeses = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
|FIN;

|PROCESO restaurame;
     |POPV;
|FPRC;

|PROCESO ayuda; |TIPO 7;
     |ATRI R;
     |PUSHV 06571480;
     ||            5 6         7         8
     ||            89012345678901234567890
     |PINTA 0758, " Tipo de Bonificación ";
     |PINTA 0858, " 1. Reducciones       ";
     |PINTA 0958, " 2. Bonificaciones    ";
     |PINTA 1058, " 3. Reducc. cont.   97";
     |PINTA 1158, " 4. Reducc. >65 a¤os  ";
     |PINTA 1258, " 5. Bon. Sector Incent";
     |PINTA 1358, " 6. Bon. Ceuta/Melilla";
     |ATRI 0;
|FPRC;

|PROCESO impresion;
     |PRINT;
|FPRC;

|DEFBUCLE impresion;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, impresion;
|FIN;

|PROCESO labtraba;
     swAcaba = 0;
     swCero = 0;

     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     #nombonif#0 = #labtraba#39;
     |LEE 000#nombonif.=;
     |SI FSalida ! 0;
          swAcaba = 1;
     |SINO;
          |SI #0#8 [ #nombonif#10; |Y #nombonif#10 [ #0#9;
               || adelante
          |SINO;
               swAcaba = 1;
          |FINSI;

          swCero = 0;
          nTotalMeses = 0;
          |SI #nombonif#14 = 0; |O #nombonif#3 = 0;
               swCero = swCero + 1;
          |SINO;
               nTotalMeses = #nombonif#14;
          |FINSI;
          |SI #nombonif#15 = 0; |O #nombonif#20 = 0;
               swCero = swCero + 1;
          |SINO;
               nTotalMeses = nTotalMeses + #nombonif#15;
          |FINSI;
          |SI #nombonif#16 = 0; |O #nombonif#21 = 0;
               swCero = swCero + 1;
          |SINO;
               nTotalMeses = nTotalMeses + #nombonif#16;
          |FINSI;
          |SI #nombonif#17 = 0; |O #nombonif#22 = 0;
               swCero = swCero + 1;
          |SINO;
               nTotalMeses = nTotalMeses + #nombonif#17;
          |FINSI;
          |SI #nombonif#18 = 0; |O #nombonif#23 = 0;
               swCero = swCero + 1;
          |SINO;
               nTotalMeses = nTotalMeses + #nombonif#18;
          |FINSI;
          |SI #nombonif#19 = 0; |O #nombonif#24 = 0;
               swCero = swCero + 1;
          |SINO;
               nTotalMeses = nTotalMeses + #nombonif#19;
          |FINSI;

          |SI swCero = 6;
               swAcaba = 1;
          |FINSI;
     |FINSI;

     |SI swAcaba = 1;
          |ACABA;
     |FINSI;

     aFechaAlta = #labtraba#40;
     |QBF aFechaAlta;
     fFechaAlta = aFechaAlta;

     aFechaBaja = #labtraba#41;
     |QBF aFechaBaja;
     |SI aFechaBaja ! ""; |Y aFechaBaja ! "..........";
          fFechaBaja = aFechaBaja;
     |SINO;
          |SI nTotalMeses < 999;
               nAnys = (nTotalMeses / 12);
               nAnys = (nAnys - 0.5) ! 0;
               nMeses = nTotalMeses $ 12;

               aAlfa1 = aFechaAlta % 102;

               aAlfa2 = aFechaAlta % 402;
               nNume2 = aAlfa2;

               aAlfa3 = aFechaAlta % -104;
               nNume3 = aAlfa3;

               nNume2 = nNume2 + nMeses;
               |SI nNume2 > 12;
                    nNume2 = 12 - nNume2;
                    nNume3 = nNume3 + 1;
               |FINSI;

               nNume3 = nNume3 + nAnys;

               aAlfa2 = nNume2; |QBF aAlfa2;
               aAlfa2 = ("00" + aAlfa2) % -102;
               aAlfa3 = nNume3;

               aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
               fFechaBaja = aAlfa;
          |SINO;
               fFechaBaja = "31.12.2999";
          |FINSI;
     |FINSI;

     fFechaIniRef = "01.08.2012";
     fFechaFinRef = "31.08.2012";

     |SI fFechaAlta [ fFechaFinRef; |Y fFechaBaja ] fFechaIniRef;
          |DDEFECTO #100;
          #100#0 = #labempre#0;
          #100#1 = #labtraba#1;
          #100#2 = #nombonif#0;
          #100#3 = #labempre#2;
          #100#4 = #labtraba#2;
          #100#5 = #nombonif#1;
          #100#6 = #nombonif#2;
          #100#7 = #nombonif#10;
          |SI #100#7 = 1;
               aAlfa = "Reducci¢n";
          |FINSI;
          |SI #100#7 = 2;
               aAlfa = "Bonificaci¢n";
          |FINSI;
          |SI #100#7 = 3;
               aAlfa = "Reducci¢n contrato 97";
          |FINSI;
          |SI #100#7 = 4;
               aAlfa = "Reducci¢n > 65 a¤os";
          |FINSI;
          |SI #100#7 = 5;
               aAlfa = "Bonificaci¢n Sector Incentivado";
          |FINSI;
          |SI #100#7 = 6;
               aAlfa = "Bonificaciones Ceuta/Melilla";
          |FINSI;
          #100#8 = aAlfa;

          #100#9 = #nombonif#4;
          #100#10 = #nombonif#5;
          #100#11 = #nombonif#6;
          #100#12 = #nombonif#7;

          #100#13 = #nombonif#8;

          #100#14 = #nombonif#14;
          #100#15 = #nombonif#15;
          #100#16 = #nombonif#16;
          #100#17 = #nombonif#3;
          #100#18 = #nombonif#20;
          #100#19 = #nombonif#21;

          #100#20 = #labtraba#7;
          #100#21 = #labtraba#75;
          #100#22 = #labtraba#36;
          #100#23 = #nombonif#27;

          |SI #0#7 = "S";
               #100#24 = 1;
          |SINO;
               #100#24 = 0;
          |FINSI;

          |GRABA 020#100n;
     |FINSI;
|FPRC;

|PROCESO grababonif;
     |DDEFECTO #100;
     #100#0 = 1;
     #100#1 = 1;
     #100#2 = #nombonif#0;
     |LEE 101#100=;
     |SI FSalida ! 0;
          #100#0 = 1;
          #100#1 = 1;
          #100#2 = #nombonif#0;
          #100#3 = "";
          #100#4 = "";
          #100#5 = #nombonif#1;
          #100#6 = #nombonif#2;
          #100#7 = #nombonif#10;
          |SI #100#7 = 1;
               aAlfa = "Reducci¢n";
          |FINSI;
          |SI #100#7 = 2;
               aAlfa = "Bonificaci¢n";
          |FINSI;
          |SI #100#7 = 3;
               aAlfa = "Reducci¢n contrato 97";
          |FINSI;
          |SI #100#7 = 4;
               aAlfa = "Reducci¢n > 65 a¤os";
          |FINSI;
          |SI #100#7 = 5;
               aAlfa = "Bonificaci¢n Sector Incentivado";
          |FINSI;
          |SI #100#7 = 6;
               aAlfa = "Bonificaciones Ceuta/Melilla";
          |FINSI;
          #100#8 = aAlfa;

          #100#9 = #nombonif#4;
          #100#10 = #nombonif#5;
          #100#11 = #nombonif#6;
          #100#12 = #nombonif#7;

          #100#13 = #nombonif#8;

          #100#14 = #nombonif#14;
          #100#15 = #nombonif#15;
          #100#16 = #nombonif#16;
          #100#17 = #nombonif#3;
          #100#18 = #nombonif#20;
          #100#19 = #nombonif#21;

          #100#20 = "";
          #100#21 = "";
          #100#22 = "";
          #100#23 = #nombonif#27;

          #100#24 = 0; || no lo pintes

          |GRABA 020#100n;
     |FINSI;
|FPRC;

|DEFBUCLE nombonif;
     #nombonif#1;
     ;
     01;
     99;
     ;
     NULL, grababonif;
|FIN;

|DEFBUCLE labtraba;
     #labtraba#8;
     39;
     "A", #0#0, #0#2, #0#4;
     "A", #0#1, #0#3, #0#5;
     ;
     NULL, labtraba;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #nombonif;

          aAlfa = Usuario; |QBT aAlfa;    aAlfa = ("b" + aAlfa) % 108;
          |NOME_DAT #100 aAlfa;
          |DELINDEX #100;
          |ABRE #100;

          |BUCLE labtraba;

          |SI #0#6 = "1";
               |BUCLE nombonif;
          |FINSI;

          Impresora = "CrystalReport";
          |IMPRE -1;
          |INFOR "nomsubon";

          |BUCLE impresion;

          |PIEINF;
          |FININF;
          |FINIMP;

          |CIERRA #100;
          |CIERRA #nombonif;
          |CIERRA #labtraba;
          |CIERRA #labempre;
     |FINSI;
|FPRO;
