|FICHEROS;
     nomtraen #0;
     nomdator;
     nompagli;

     aomparam #13;
     concept@ #1000;
     cacuent@ #1001;
     canempr@ #1002;
     diarios@ #1003;

     caenlac@ #1000;
     caconas@ #1001;
     camasic@ #1002;

     agifa041@;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aAlfa1 = "";
     nCalc  = 0;
     nTecla = 0;
     nMaxDigit = 0;

     fFecha = @;
     aFecha = "";
     aAny = "";
     aMes = "";
     &nAny = 0;
     &nMes = 0;
     nNume = 0;

     FEstado = 0;
     mesnum = 0;
     anynum = 0;
     aDia = "";
     topemes = 0;

     nImporte = 0;
     nSwError = 0;
     nDocum = 0;
     nDiario = 0;
     enNoModif = 0;
     aCuenta = "";
     fich_alta = "";
     numer = 0;
     bisiesto = 0;

     aLon = "":
     nLon1 = 0;
     nLon2 = 0;
     &nEmpresa = 0;
     &nTipo = 0;
     &aNorPag = "";
     nError = 0;
     aPath = "";
     aDef = "";
     aFic = "";
     nOrdenante = 0;
     aRegistro = "";
     aAntRegistro = "";
     aAntFecha = "";
|FIN;

|PROCESO Defectos; |TIPO 7;
     #0#1 = nAny;
     #0#2 = nMes;
     |PINTA #0#1;
     |PINTA #0#2;

     #0#9 = nEmpresa;
     |PINTA #0#9;
     #0#10 = nAny - 2000;
     |PINTA #0#9;
     |HAZ MiraEmpresa;
     |HAZ Descripcion;
|FPRC;

|PROCESO Descripcion;
     aMes = nMes; aMes = ("00" + aMes) % -102;
     aAlfa = "NOMINAS MES " + aMes;
     #0#6 = aAlfa;
     |PINTA #0#6;
|FPRC;

|PROCESO Produccion;     || por si estamos en produccion hago el cambiazo
     aLon = aAlfa % 0;
     nLon1 = aLon;
     aAlfa1 = aAlfa - "dsprofes/";
     aLon = aAlfa1 % 0;
     nLon2 = aLon;
     |SI nLon1 ! nLon2;
          aAlfa = aAlfa1 + "dsempres/";
     |FINSI;
|FPRC;
/*
|PROCESO NombreEmpCONT;
     nError = 1;
     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     |DBASS aAlfa;
     |HAZ Produccion;
     aPath = aAlfa + #13#1; |QBF aPath;

     aDef = aPath + "/def/agifa041";
     |CARGA_DEF aDef, agifa041@;
     |SI FSalida = 0;
          aFic = aPath + "/fich/"
          |PATH_DAT #agifa041@#aFic#;
          |ABRE #agifa041@;
          #agifa041@#0 = #0#9;
          |LEE 000#agifa041@.=;
          nError = FSalida;
          |SI nError = 0;
               #0#12 = #agifa041@#1;
               |PINTA #0#12;
          |FINSI;
          |CIERRA #agifa041@;
          |DESCARGA_DEF #agifa041@;
     |FINSI;
|FPRC;

|PROCESO Comprueba;
     nError = 1;
     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     |DBASS aAlfa;
     |HAZ Produccion;
     aPath = aAlfa + #13#1; |QBF aPath;

     aDef = aPath + "/def/agifa041";
     |CARGA_DEF aDef, agifa041@;
     |SI FSalida = 0;
          aFic = aPath + "/fich/"
          |PATH_DAT #agifa041@#aFic#;
          |ABRE #agifa041@;
          #agifa041@#0 = #0#9;
          |LEE 000#agifa041@.=;
          nError = FSalida;
          |SI nError = 0;
               #0#12 = #agifa041@#1;
               |PINTA #0#12;
          |SINO;                   || Consulta
               |LEE 000#agifa041@.];
               |CONSULTA_CLAVE #1#agifa041@;
               nError = FSalida;
               |SI FSalida = 0;
                    #0#9 = #agifa041@#0;
                    #0#12 = #agifa041@#1;
                    |PINTA #0#9;
                    |PINTA #0#12;
               |FINSI;
               |CIERRA #agifa041@;
               |DESCARGA_DEF #agifa041@;
          |FINSI;
     |FINSI;
     FSalida = nError;
     |SI FSalida ! 0;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Consulta;
     |SI FSalida = 10;
          nError = 1;
          |ABRE #13; |LEE 000#13p; |CIERRA #13;
          |DBASS aAlfa;
          |HAZ Produccion;
          aPath = aAlfa + #13#1; |QBF aPath;

          aDef = aPath + "/def/agifa041";
          |CARGA_DEF aDef, agifa041@;
          |SI FSalida = 0;
               aFic = aPath + "/fich/"
               |PATH_DAT #agifa041@#aFic#;
               |ABRE #agifa041@;
               #agifa041@#0 = #0#9;
               |LEE 000#agifa041@.];
               |CONSULTA_CLAVE #1#agifa041@;
               nError = FSalida;
               |SI FSalida = 0;
                    #0#9 = #agifa041@#0;
                    #0#12 = #agifa041@#1;
                    |PINTA #0#9;
                    |PINTA #0#12;
               |FINSI;
               |CIERRA #agifa041@;
               |DESCARGA_DEF #agifa041@;
          |FINSI;
          FSalida = nError;
          |SI FSalida ! 0;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;
*/
|PROCESO CompCuenta;
   aAlfa = #nomtraen#Campo#; |QBF aAlfa;
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida !0; |HACIENDO;
      aAlfa1 = aAlfa % 0; nCalc = aAlfa1;
      nCalc = nMaxDigit - nCalc;
      aAlfa1 = "0" * nCalc;
      nCalc = FSalida + 98; aAlfa1 = aAlfa1 + (aAlfa % nCalc);
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa1 = (aAlfa % nCalc) + aAlfa1; aAlfa = aAlfa1;
      aAlfa = aAlfa - ".";
   |SIGUE;
   #nomtraen#Campo# = aAlfa; |PINTA #nomtraen#Campo#;

   aAlfa = #nomtraen#Campo#; |QBF aAlfa;
   aAlfa = aAlfa % 0; nCalc = aAlfa;
   |SI nCalc = #canempr@#14; #cacuent@#1 = 1; |FINSI;
   |SI nCalc = #canempr@#15; #cacuent@#1 = 2; |FINSI;
   |SI nCalc = #canempr@#16; #cacuent@#1 = 3; |FINSI;
   |SI nCalc = #canempr@#17; #cacuent@#1 = 4; |FINSI;
   |SI nCalc = #canempr@#18; #cacuent@#1 = 5; |FINSI;
   |SI nCalc = #canempr@#19; #cacuent@#1 = 6; |FINSI;
   #cacuent@#0 = #nomtraen#Campo#;
   |LEE 000#cacuent@.=;
   |SI FSalida ! 0;
       |MENAV "    Cuenta inexistente";
       |ERROR; |ACABA;
   |SINO;
      |SI #cacuent@#3 = "N";
         aAlfa = "    NEsta seleccionando una cuenta sin pase directo. " + &191 + " Continuar ? ";
         |CONFI aAlfa;
         |SI FSalida ! 0; |ERROR; |FINSI;
      |FINSI;
   |FINSI;

   |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
   |CIERRA #cacuent@; |DESCARGA_DEF #cacuent@;
|FPRC;

|PROCESO Cuentas;
     nTecla = FSalida;

     aAlfa = #nomtraen#Campo#;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12;
     |QBF aAlfa;
     aAlfa1 = aAlfa + "def/cacuenta.mas";
     |CARGA_DEF aAlfa1, cacuent@;
     |SI FSalida ! 0;
          |MENAV "    No encuentro el fichero de plan contable";
          |ERROR;
          |ACABA;
     |SINO;
          aAlfa1 = aAlfa + "def/canempre.mas";
          |CARGA_DEF aAlfa1, canempr@;
          |SI FSalida ! 0;
               |DESCARGA_DEF #cacuent@;
               |MENAV "    No encuentro el fichero de empresas";
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     aAlfa1 = aAlfa + "fich/";
     |PATH_DAT #1002#aAlfa1#;
     aAlfa1 = aAlfa + "fich/" + (("00000" + #nomtraen#9) % -105) + #nomtraen#10 + "/";
     |PATH_DAT #1001#aAlfa1#;

     |ABRE #canempr@;
     #canempr@#2 = #nomtraen#9;
     #canempr@#3 = #nomtraen#10;
     |LEE 000#canempr@.=;
     |SI FSalida ! 0; |DDEFECTO #canempr@; |FINSI;

     nMaxDigit = 0;
     |SI #canempr@#14 ] nMaxDigit; nMaxDigit = #canempr@#14; |FINSI;
     |SI #canempr@#15 ] nMaxDigit; nMaxDigit = #canempr@#15; |FINSI;
     |SI #canempr@#16 ] nMaxDigit; nMaxDigit = #canempr@#16; |FINSI;
     |SI #canempr@#17 ] nMaxDigit; nMaxDigit = #canempr@#17; |FINSI;
     |SI #canempr@#18 ] nMaxDigit; nMaxDigit = #canempr@#18; |FINSI;
     |SI #canempr@#19 ] nMaxDigit; nMaxDigit = #canempr@#19; |FINSI;

     |ABRE #cacuent@;
     |SI nTecla = 10;
          #cacuent@#0 = #nomtraen#Campo#;
          |LEE 000#cacuent@.];
          |CONSULTA_CLAVE #1#cacuent@;
          |SI FSalida = 0;
              #nomtraen#Campo# = #cacuent@#0;
              |PINTA #nomtraen#Campo#;
          |FINSI;
     |FINSI;

     |HAZ CompCuenta;
|FPRC;

|PROCESO MiraCpts;
     nTecla = FSalida;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa = aAlfa - "contagen/";
     |SI FSalida ! 0;
          aAlfa = aAlfa + "modelos/";
          aAlfa1 = aAlfa + "def/dsmom030.mas";
          |CARGA_DEF aAlfa1, concept@;
          |SI FSalida ! 0;
               |MENAV "    No encuentro el fichero de conceptos";
               |ERROR;
               |ACABA;
          |SINO;
               aAlfa1 = aAlfa + "fich/"; |PATH_DAT #1000#aAlfa1#;
          |FINSI;
     |SINO;
          aAlfa = aAlfa - "contagen\";
          |SI FSalida ! 0;
         aAlfa = aAlfa + "modelos/";
         aAlfa1 = aAlfa + "def/dsmom030.mas";
         |CARGA_DEF  aAlfa1, concept@;
         |SI FSalida ! 0;
            |MENAV "    No encuentro el fichero de conceptos";
            |ERROR; |ACABA;
         |SINO;
            aAlfa1 = aAlfa + "fich/"; |PATH_DAT #1000#aAlfa1#;
         |FINSI;
      |SINO;
         aAlfa1 = aAlfa + "/def/caconcep.mas";
         |CARGA_DEF  aAlfa1, concept@;
         |SI FSalida ! 0;
            |MENAV "    No encuentro el fichero de conceptos";
            |ERROR; |ACABA;
         |SINO;
            aAlfa1 = aAlfa + "fich/" + (("00000" + #nomtraen#9) % -105) + #nomtraen#10 + "/";
            |PATH_DAT #1000#aAlfa1#;
         |FINSI;
      |FINSI;
   |FINSI;

   |ABRE #concept@;
   |SI nTecla = 10;
      #concept@#0 = #nomtraen#5;
      |LEE 000#concept@.];
      |CONSULTA_CLAVE #1#concept@;
      |SI FSalida = 0;
         #nomtraen#5 = #concept@#0; |PINTA #nomtraen#5;
         #nomtraen#6 = #concept@#1; |PINTA #nomtraen#6;
      |FINSI;
   |FINSI;
   #concept@#0 = #nomtraen#5;
   |LEE 000#concept@.=;
   |SI FSalida ! 0;
      |MENAV "    Concepto inexistente";
      |ERROR;
   |SINO;
      #nomtraen#6 = #concept@#1; |PINTA #nomtraen#6;
   |FINSI;
   |CIERRA #concept@; |DESCARGA_DEF #concept@;
|FPRC;

|PROCESO Codigo;
      |C_M #nomtraen#3, 1, "S"; |C_M #nomtraen#4, 1, "S";
      |C_M #nomtraen#5, 1, "S";
|FPRC;

|PROCESO MiraDiarios;
   nTecla = FSalida;

   |ABRE #aomparam;
   |LEE 000#aomparam.p;
   |SI FSalida ! 0;
      |MENAV "    No existe el control de parametros";
      |CIERRA #aomparam;
      |ERROR; |ACABA;
   |FINSI;
   |CIERRA #aomparam;

   aAlfa = #aomparam#12; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/camandia.mas";
   |CARGA_DEF aAlfa1, diarios@;
   |SI FSalida ! 0;
      |MENAV "    No encuentro el fichero de diarios";
      |ERROR; |ACABA;
   |SINO;
      aAlfa1 = aAlfa + "fich/" + (("00000" + #nomtraen#9) % -105) + #nomtraen#10 + "/";
      |PATH_DAT #1003#aAlfa1#;
   |FINSI;

   |ABRE #diarios@;
   |SI nTecla = 10;
      #diarios@#0 = #nomtraen#7;
      |LEE 000#diarios@.];
      |CONSULTA_CLAVE #1#diarios@;
      |SI FSalida = 0;
         #nomtraen#7 = #diarios@#0; |PINTA #nomtraen#7;
         #nomtraen#8 = #diarios@#1; |PINTA #nomtraen#8;
      |FINSI;
   |FINSI;
   #diarios@#0 = #nomtraen#7;
   |LEE 000#diarios@.=;
   |SI FSalida ! 0;
      |MENAV "    Diario inexistente";
      |ERROR;
   |SINO;
      #nomtraen#8 = #diarios@#1; |PINTA #nomtraen#8;
   |FINSI;
   |CIERRA #diarios@; |DESCARGA_DEF #diarios@;
|FPRC;

|PROCESO MiraEmpresa;
     nTecla = FSalida;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa = aAlfa + "def/canempre.mas";
     |CARGA_DEF aAlfa, canempr@;
     |SI FSalida = 0;
          aAlfa = #aomparam#12; |QBF aAlfa;
          aAlfa = aAlfa + "fich/"; |PATH_DAT #canempr@#aAlfa#;
          |ABRE #canempr@;
          |SI nTecla = 10;
               |CONSULTA_CLAVE #1#canempr@;
               |SI FSalida = 0;
                    #nomtraen#9 = #canempr@#2;  |PINTA #nomtraen#9;
                    #nomtraen#10 = #canempr@#3; |PINTA #nomtraen#10;
                    #nomtraen#12 = #canempr@#1; |PINTA #nomtraen#12;
               |FINSI;
               |ERROR;
          |SINO;
               #canempr@#2 = #nomtraen#9;
               #canempr@#3 = #nomtraen#10;
               |LEE 000#canempr@.=;
               |SI FSalida = 0;
                    #nomtraen#12 = #canempr@#1; |PINTA #nomtraen#12;
               |SINO;
                    |MENAV "    Empresa inexistente";
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
     |FINSI;
|FPRC;

|PROCESO ulti_dia;  || halla el ultimo dia del mes
     numer = anynum $ 4;
     |SI numer = 0;
             bisiesto = 1;
     |SINO;
             bisiesto = 0;
     |FINSI;
     |SI mesnum =  1;  topemes = 31;            |FINSI;
     |SI mesnum =  2;  topemes = 28 + bisiesto; |FINSI;
     |SI mesnum =  3;  topemes = 31;            |FINSI;
     |SI mesnum =  4;  topemes = 30;            |FINSI;
     |SI mesnum =  5;  topemes = 31;            |FINSI;
     |SI mesnum =  6;  topemes = 30;            |FINSI;
     |SI mesnum =  7;  topemes = 31;            |FINSI;
     |SI mesnum =  8;  topemes = 31;            |FINSI;
     |SI mesnum =  9;  topemes = 30;            |FINSI;
     |SI mesnum = 10;  topemes = 31;            |FINSI;
     |SI mesnum = 11;  topemes = 30;            |FINSI;
     |SI mesnum = 12;  topemes = 31;            |FINSI;
|FPRC;

|PROCESO Asiento;
     |ABRE #nomdator;
     #nomdator#0 = nOrdenante;
     |LEE 000#nomdator.=;
     #0#4 = #nomdator#12;
     |CIERRA #nomdator;

     |ABRE #aomparam;
     |LEE 000#aomparam.p;
     |SI FSalida ! 0;
          |MENAV "    No existe el control de parametros";
          |CIERRA #aomparam;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #aomparam;

     aAlfa = #aomparam#12; |QBF aAlfa;
     aAlfa = aAlfa + "def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlac@;
     |SI FSalida = 0;
          aAlfa = #aomparam#12; |QBF aAlfa;
          aAlfa = aAlfa + "def/caconasi.mas";
          |CARGA_DEF aAlfa, caconas@;
          |SI FSalida = 0;
               aAlfa = #aomparam#12; |QBF aAlfa;
               aAlfa = aAlfa + "def/camaasic.mas";
               |CARGA_DEF aAlfa, camasic@;
               |SI FSalida = 0;
                    aAlfa = #aomparam#12; |QBF aAlfa;
                    aAlfa = aAlfa + "fich/" + (("00000" + #0#9) % -105) + #0#10 + "/";
                    |PATH_DAT #caenlac@#aAlfa#; |PATH_DAT #camasic@#aAlfa#;
                    |PATH_DAT #caconas@#aAlfa#;
                    aAlfa = "pu" + Usuario; |QBF aAlfa; |NOME_DAT #caenlac@#aAlfa#;
                    |DELINDEX #caenlac@; |ABRE #caenlac@;
                    |ABRE #caconas@; |ABRE #camasic@;
                    ||ABRE #agifa722;

                    nSwError = 0;
/*
                         mesnum = #0#2;
                         anynum = #0#1;
                         |HAZ ulti_dia;
                         aDia = topemes;
                         aDia = ("00" + aDia) % -102;

                         nMes = #0#2;
                         aMes = nMes;
                         aMes = ("00" + aMes) % -102;
                         nAny = #0#1;
                         aAny = nAny;

                         aFecha = aDia + "." + aMes + "." + aAny;
*/
                         fFecha = aAntFecha;

                         nDiario = #0#7;

                         |LEE 101#caconas@.p;
                         |SI FSalida ! 0;
                              |DDEFECTO #caconas@;
                              |GRABA 020#caconas@.n;
                              |LEE 101#caconas@.p;
                         |FINSI;

                         #caconas@#1 = #caconas@#1 + 1;
                         aAlfa = "|NC"; nCalc = #caconas@#aAlfa#;
                         |SI nCalc > 2; #caconas@#2 = #caconas@#2 + 1; |FINSI;
                         nDocum = #caconas@#1;

                         |GRABA 020#caconas@.a;
                         |LIBERA #caconas@;

                         #camasic@#0 = nDiario;
                         #camasic@#1 = fFecha;
                         #camasic@#2 = nDocum;
                         |LEE 000#camasic@.=;
                         |SI FSalida = 0;
                              #camasic@#0 = nDiario;
                              #camasic@#1 = fFecha;
                              #camasic@#2 = 999999;
                              |LEE 000#camasic@.];
                              |SI FSalida = 0;
                                   |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                        nDocum = 1;
                                   |SINO;
                                        |LEE 000#camasic@.a;
                                        |SI FSalida = 0;
                                             |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                                  nDocum = #camasic@#2 + 1;
                                             |SINO;
                                                  nDocum = 1;
                                             |FINSI;
                                        |SINO;
                                             nDocum = 1;
                                        |FINSI;
                                   |FINSI;
                              |SINO;
                                   |LEE 000#camasic@.u;
                                   |SI FSalida = 0;
                                        |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                             nDocum = #camasic@#2 + 1;
                                        |SINO;
                                             nDocum = 1;
                                        |FINSI;
                                   |SINO;
                                        nDocum = 1;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                              |DDEFECTO #caenlac@;
                              #caenlac@#0 = nDiario;
                              #caenlac@#1 = fFecha;
                              #caenlac@#2 = nDocum;
                              #caenlac@#3 = 10;

                              aAlfa = #0#3;
                              |QBF aAlfa;
                              aCuenta = aAlfa;

                              #caenlac@#4 = aCuenta;

                              #caenlac@#5 = 0;
                              #caenlac@#6 = #0#5;
                              aAlfa = #0#6; |QBF aAlfa;
                              aAlfa = aAlfa + "-TR: " + aAntRegistro;
                              #caenlac@#7 = aAlfa;
                              #caenlac@#8 = "D";
                              #caenlac@#9 = nImporte;      || importe
                              |GRABA 020#caenlac@.n;

                              |DDEFECTO #caenlac@;
                              #caenlac@#0 = nDiario;
                              #caenlac@#1 = fFecha;
                              #caenlac@#2 = nDocum;
                              #caenlac@#3 = 20;

                              aAlfa = #0#4;
                              |QBF aAlfa;

                              aCuenta = aAlfa;
                              #caenlac@#4 = aCuenta;

                              #caenlac@#5 = 0;
                              #caenlac@#6 = #0#5;
                              aAlfa = #0#6; |QBF aAlfa;
                              aAlfa = aAlfa + "-TR: " + aAntRegistro;
                              #caenlac@#7 = aAlfa;
                              #caenlac@#8 = "H";
                              #caenlac@#9 = nImporte;      || importe
                              |GRABA 020#caenlac@.n;
                         |FINSI;
                    |FINSI;

                    |SI nSwError = 0;
                         aAlfa = #aomparam#12; |QBF aAlfa;
                         aAlfa = aAlfa + "fich/" + (("00000" + #0#9) % -105) + #0#10 + "/";
                         fich_alta = aAlfa;
                         aAlfa1 = #aomparam#12; |QBF aAlfa1;
                         aAlfa1 = aAlfa1 - "contagen";
                         |SI FSalida ! 0;
                              aAlfa1 = ":contagen/dsapunte.tab;";
                         |SINO;
                              aAlfa1 = ":agicont/dsapunte.tab;";
                         |FINSI;
                         enNoModif = 100;
                         aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;

                         |CIERRA #caenlac@;
                         |SUB_EJECUTA_NP aAlfa;
                         |ABRE #caenlac@; |LEE 000#caenlac@.c;
                    ||FINSI;
                    ||CIERRA #agifa722;
                    |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
                    |CIERRA #caconas@; |DESCARGA_DEF #caconas@;
                    |CIERRA #caenlac@; |DELINDEX #caenlac@; |DESCARGA_DEF #caenlac@;
               |FINSI;
          |FINSI;
     ||SINO;
          || CIERRA #goparame; |CIERRA #gocerenc; |ACABA;
     ||FINSI;

     || CIERRA #gocerenc; |CIERRA #goparame;
|FPRC;

|PROCESO Enlace;
     aRegistro = #nompagli#10;
     |QBF aRegistro;
     |SI aRegistro ! "";
          |SI aRegistro = aAntRegistro; |O aAntRegistro = "";
               nImporte = nImporte + #nompagli#12;
               nOrdenante = #nompagli#14;
               aAntRegistro = #nompagli#10;
               aAntFecha = #nompagli#8;
               |QBF aAntRegistro;
          |SINO;
               |HAZ Asiento;
               nImporte = 0;
               nImporte = nImporte + #nompagli#12;
               nOrdenante = #nompagli#14;
               aAntRegistro = #nompagli#10;
               aAntFecha = #nompagli#8;
          |FINSI;
          #nompagli#13 = "S";
          |GRABA 020#nompagli.a;
     |FINSI;
|FPRC;

|DEFBUCLE Enlace;
     #nompagli#2;
     7, 11, 13;
     nEmpresa, "      ", nAny, nMes, nTipo, aNorPag, 00001, "T", "S", "N";
     nEmpresa, "zzzzzz", nAny, nMes, nTipo, aNorPag, 99999, "T", "S", "N";
     be;
     NULL, Enlace;
|FIN;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |LEE 000#0p;
     FEstado = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          || AQUI EL ENLACE
          nImporte = 0;
          |BUCLE Enlace;
          |SI nImporte ! 0;
               |HAZ Asiento;
          |FINSI;
     |FINSI;


     |SI FEstado = 0;
          |GRABA 000#0a;
     |SINO;
          |GRABA 000#0n;
     |FINSI;
     |CIERRA #0;
|FPRO;
