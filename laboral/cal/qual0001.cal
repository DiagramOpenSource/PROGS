|FICHEROS;
     qual0001 #0;
     qual0002 #100;

     labtraba;
     labempre;
     ref0001@ #900;
     ref0002@ #910;
|FIN;

|VARIABLES;
     nCto = 0;
     nNumCto = 0;
     nPara = 0;
     nCodAscii = 0;
     aColumna = "";

     aRaizMacro = "";

     {1}aVersion      = "";
     aPath = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     nCaracter = 0;
     aCaracter = "";

     nAnyo = 0;
     aAnyo = "";
     fecsys = @;
     aAlfa = "";
     aAlfa1 = "";
     aDirBase = "";
     nHoras = 0;
     nHorasMes = 0;
     nPorJornada = 0;
     aProc = "";
     nNum = 0;

     nLinea = 0;
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";

     nC0 = 0;       || codigo Trabajador
     aC1 = "";      || NIF Trabajador
     aC2 = "";      || Nombre Trabajador
     nC3 = 0;       || Total Devengado
     nC4 = 0;       || Atrasos
     nC5 = 0;       || Antiguedad
     nC6 = 0;       || Incentivos Viajante
     nC7 = 0;       || Incentivos
     nC8 = 0;       || Retribucion Voluntaria
     nC9 = 0;       || Paga Beneficios
     nC10 = 0;      || P. Verano
     nC11 = 0;      || P. Navidad
     nC12 = 0;      || Plus Convenio
     nC13 = 0;      || Plus Escolaridad
     nC14 = 0;      || Kilometraje
     nC15 = 0;      || Plus Actividad
     nC16 = 0;      || Dietas
     nC17 = 0;      || Gastos de Viaje
     nC18 = 0;      || Jornadas Gastronomicas

     nC19 = 0;      || Salario Base
     nC20 = 0;      || Incapacidad Temporal
     nC21 = 0;      || Abs.Injus. / Dif.Sal.
     nC22 = 0;      || Gastos Viaje
     nC23 = 0;      || Dif. Vacac.

     nC24 = 0;      || Total Finiquitos
     nC25 = 0;      || Finiq: Paga 1
     nC26 = 0;      || Finiq: Paga 2
     nC27 = 0;      || Finiq: Paga 3
     nC28 = 0;      || Finiq: Vacaciones
     nC29 = 0;      || Finiq: Indemnizacion

     nC30 = 0;      || Complemento
     nC31 = 0;      || Diferencias
     nC32 = 0;      || Seg. Soc. Cgo. Empresa

     || NO METER ENTRE ESTAS VARIABLES OTRA DECLARACION

     {-1}nTotal = 0;
     nTotC3 = 0;
     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC8 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;
     nTotC18 = 0;
     nTotC19 = 0;
     nTotC20 = 0;
     nTotC21 = 0;
     nTotC22 = 0;
     nTotC23 = 0;
     nTotC24 = 0;
     nTotC25 = 0;
     nTotC26 = 0;
     nTotC27 = 0;
     nTotC28 = 0;
     nTotC29 = 0;
     nTotC30 = 0;
     nTotC31 = 0;
     nTotC32 = 0;

     nBrutoPaga = 0;
     nIRPFPaga = 0;
     swSigue = 0;

     FEstado = 0;
     FEstadoDef = 0;
     swCoef = 0;
     nUnid = 0;
     nUnidTotal = 0;
     nDesdeMesPro = 0;
     nHastaMesPro = 0;
     aDesdeAnyPro = "";
     aHastaAnyPro = "";
     swHay99 = 0;
     fFechaAlta = @;
     aAlfa2 = 0;
     fFechaIni = @;
     aFechaIni = "";
     nEmbargo = 0;
     nAnticPaga = 0;

     nImporte = 0;
     nConvenio = 0;
     nCategoria = 0;
     nConcepto = 0;
     nIncentivos = 0;
     nMes = 0;
     aMes = "";
     aValor = "";
     fFecha = @;
     aFecha = "";
     aHora = "";
     aMeses = "";
     swNoSumes = 0;
|FIN;

|PROCESO SoloUnMes;
     |SI #0#4 = "X";     || desde el mensual: solo un mes
          #0#16 = #0#3;
          |PINTA #0#16;
          |CAMPO_MODIFICA #0#16, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0#16, 1, "S";
     |FINSI;
|FPRC;

|PROCESO HastaMes;
     |SI #0#3 > #0#16;
          |MENAV "    El mes desde no puede ser mayor que el mes hasta";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO HastaTipo;
     |SI #0#12 > #0#17;
          |MENAV "    El tipo desde no puede ser mayor que el tipo hasta";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Selecc1;
     |SI #0#4 = "X";
          #0#5 = " ";
          |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO Selecc2;
     |SI #0#5 = "X";
          #0#4 = " ";
          |PINTA #0#4;
     |FINSI;
|FPRC;

|PROCESO Comprueba1;
     |SI #0#4 = " "; |Y #0#5 = " ";
          |MENAV "    ATENCION: Debe elegir una fuente de datos.";
          |POSICIONATE #0#4;
          |ACABA;
     |FINSI;
     |SI #0#4 = "X"; |Y #0#5 = "X";
          |MENAV "    ATENCION: Solo es posible elegir una fuente de datos.";
          |POSICIONATE #0#4;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO Selecc3;
          |SI #0#6 = "X";
               #0#7 = " ";
               |PINTA #0#7;
          |FINSI;
|FPRC;

|PROCESO Selecc4;
     |SI #0#7 = "X";
          #0#6 = " ";
          |PINTA #0#6;
          |CAMPO_MODIFICA #0#13, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#13, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Comprueba2;
     |SI #0#11 = "S";
          |SI #0#6 = " "; |Y #0#7 = " ";
               |MENAV "    ATENCION: Debe elegir al una fuente de datos para atrasos.";
               |POSICIONATE #0#6;
          |FINSI;
     |FINSI;
     |SI #0#6 = "X"; |Y #0#7 = "X";
          |MENAV "    ATENCION: Solo es posible elegir una fuente de datos de atrasos";
          |POSICIONATE #0#6;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO CamposAtrasos;
     |SI #0#11 = "S";
          |CAMPO_MODIFICA #0#6, 1, "S";
          |CAMPO_MODIFICA #0#7, 1, "S";
          |CAMPO_MODIFICA #0#12, 1, "S";
          |CAMPO_MODIFICA #0#13, 1, "S";
          |CAMPO_MODIFICA #0#17, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#6, 1, "N";
          |CAMPO_MODIFICA #0#7, 1, "N";
          |CAMPO_MODIFICA #0#12, 1, "N";
          |CAMPO_MODIFICA #0#13, 1, "N";
          |CAMPO_MODIFICA #0#17, 1, "N";
          #0#6 = " ";
          #0#7 = " ";
          #0#12 = 0;
          #0#13 = 2000;
          #0#17 = 0;
          |PINTA #0#6;
          |PINTA #0#7;
          |PINTA #0#12;
          |PINTA #0#13;
          |PINTA #0#17;
     |FINSI;
|FPRC;

|PROCESO mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
     fecsys = ~;
     aAlfa = fecsys;
     aAlfa = aAlfa % 402;
     #0#3 = aAlfa;
     #0#16 = aAlfa;
|FPRC;

|PROCESO miraanyo; |TIPO 7; ||calcula el periodo por defecto segun fecha sistema
     fecsys = ~;
     aAlfa = fecsys;
     aAlfa = aAlfa % -104;
     #0#2 = aAlfa;
     #0#13 = aAlfa;
|FPRC;

|PROCESO PonaCero;
     nC0 = 0;       || codigo Trabajador
     aC1 = "";      || NIF Trabajador
     aC2 = "";      || Nombre Trabajador
     nC3 = 0;       || Total Devengado
     nC4 = 0;       || Atrasos
     nC5 = 0;       || Antiguedad
     nC6 = 0;       || Incentivos Viajante
     nC7 = 0;       || Incentivos
     nC8 = 0;       || Retribucion Voluntaria
     nC9 = 0;       || Paga Beneficios
     nC10 = 0;      || P. Verano
     nC11 = 0;      || P. Navidad
     nC12 = 0;      || Plus Convenio
     nC13 = 0;      || Plus Escolaridad
     nC14 = 0;      || Kilometraje
     nC15 = 0;      || Plus Actividad
     nC16 = 0;      || Dietas
     nC17 = 0;      || Gastos de Viaje
     nC18 = 0;      || Jornadas Gastronomicas

     nC19 = 0;      || Salario Base
     nC20 = 0;      || Incapacidad Temporal
     nC21 = 0;      || Abs.Injus. / Dif.Sal.
     nC22 = 0;      || Gastos Viaje
     nC23 = 0;      || Dif. Vacac.
     nC24 = 0;      || Total Finiquitos
     nC25 = 0;      || Finiq: Paga 1
     nC26 = 0;      || Finiq: Paga 2
     nC27 = 0;      || Finiq: Paga 3
     nC28 = 0;      || Finiq: Vacaciones
     nC29 = 0;      || Finiq: Indemnizacion
     nC30 = 0;      || Complemento
     nC31 = 0;      || Diferencias
     nC32 = 0;      || SSCE

     nEmbargo = 0;
     nAnticPaga = 0;
     nIncentivos = 0;
|FPRC;

|PROCESO BuscaImporte;
     swNoSumes = 0;
     nImporte = 0;
     #910#0 = #900#0;
     #910#1 = #900#1;
     #910#2 = #900#2;
     #910#3 = #900#3;
     #910#4 = nConcepto;
     |SI aProc = "nomhicca";
          #910#12 = #0#2 - 2000;
     |FINSI;
     |SI aProc = "nomhiccaAT";
          #910#12 = #0#13 - 2000;
     |FINSI;
     |LEE 000#910=;
     |SI FSalida = 0;
          nImporte = #910#10 * #910#11;
     |FINSI;
     |SI nConcepto ] 201; |Y nConcepto [ 208; |Y #910#5 = "P";
          || Pagas prorrateadas no
          swNoSumes = 1;
     |FINSI;
|FPRC;

|PROCESO BuscaCTOHis;
     nNumCto = 0;
     #910#0 = #900#0;
     #910#1 = #900#1;
     #910#2 = #900#2;
     #910#3 = #900#3;
     #910#4 = nCto;
     #910#12 = #900#66;
     |LEE 000#910=;
     |SI FSalida = 0;
          |SI #910#5 = "P";
               nNumCto = #910#10 * #910#11;
          |FINSI;
          |SI #910#5 = "V"; |Y #910#3 = 2;
               nNumCto = #910#10 * #910#11;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaTmp;
     |DDEFECTO #100;
     #100#0 = nC0;
     |LEE 101#100=;
     FEstado = FSalida;

     #100#1 = aC1;
     #100#2 = aC2;

     |SI aProc = "nomcalac"; |O aProc = "nomhiccaAT";
          #100#4 = #100#4 + nC4;
          |SI FEstado = 0;
               |GRABA 020#100a;
          |SINO;
               |GRABA 020#100n;
          |FINSI;
          |LIBERA #100;
          |ACABA;
     |FINSI;

     |SI #900#3 = 2;
          #100#24 = #100#24 + nC24;
          #100#25 = #100#25 + nC25;
          #100#26 = #100#26 + nC26;
          #100#27 = #100#27 + nC27;
          #100#28 = #100#28 + nC28;
          #100#29 = #100#29 + nC29;
          |SI FEstado = 0;
               |GRABA 020#100a;
          |SINO;
               |GRABA 020#100n;
          |FINSI;
          |LIBERA #100;
          |ACABA;
     |FINSI;

     #100#3 = #100#3 + nC3;
     #100#4 = #100#4 + nC4;   || para que entre el concepto 108, no solo el tipo 5,6,7
     #100#5 = #100#5 + nC5;
     #100#6 = #100#6 + nC6;
     #100#7 = #100#7 + nC7;
     #100#8 = #100#8 + nC8;
     #100#9 = #100#9 + nC9;
     #100#10 = #100#10 + nC10;
     #100#11 = #100#11 + nC11;
     #100#12 = #100#12 + nC12;
     #100#13 = #100#13 + nC13;
     #100#14 = #100#14 + nC14;
     #100#15 = #100#15 + nC15;
     #100#16 = #100#16 + nC16;
     #100#17 = #100#17 + nC17;
     #100#18 = #100#18 + nC18;
     #100#19 = #100#19 + nC19;
     #100#20 = #100#20 + nC20;
     #100#21 = #100#21 + nC21;
     #100#22 = #100#22 + nC22;
     #100#29 = #100#29 + nC29;
     #100#30 = #100#30 + nC30;     || complemento
     #100#31 = #100#31 + nC31;     || diferencias
     #100#32 = #100#32 + nC32;     || SSCE

     |SI FEstado = 0;
          |GRABA 020#100a;
     |SINO;
          |GRABA 020#100n;
     |FINSI;
     |LIBERA #100;
|FPRC;

|PROCESO ElCalculo;
     |HAZ PonaCero;
     nC0 = #900#1;
     #labtraba#0 = #900#0;
     #labtraba#1 = #900#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;
     nConvenio = #labtraba#87;
     nCategoria = #labtraba#17;
     aC1 = #labtraba#7;       || NIF Trabajador
     aC2 = #labtraba#2;       || Nombre Trabajador

               || ATRASOS
     |SI aProc = "nomcalac"; |O aProc = "nomhiccaAT";
          nC4 = nC4 + #900#46;
          |HAZ GrabaTmp;
          |ACABA;
     |FINSI;

     |SI #900#3 = 2;     || FINIQUITOS
          nConcepto = 203;         || Paga Beneficios
          |HAZ BuscaImporte;
          nC25 = nImporte;

          nConcepto = 201;         || Paga Verano
          |HAZ BuscaImporte;
          nC26 = nImporte;

          nConcepto = 202;         || Paga Diciembre
          |HAZ BuscaImporte;
          nC27 = nImporte;

          nConcepto = 125;         || Vacaciones
          |HAZ BuscaImporte;
          nC28 = nImporte;

          nConcepto = 408;         || Indemnizacion
          |HAZ BuscaImporte;
          nC29 = nImporte;
          nConcepto = 410;
          |HAZ BuscaImporte;
          nC29 = nC29 + nImporte;

          nC24 = nC24 + nC25 + nC26 + nC27 + nC28 + nC29;  || Total Finiquitos

          |HAZ GrabaTmp;
          |ACABA;
     |FINSI;

     nC3 = #900#46;       || Total Devengado

     nConcepto = 102;         || Antiguedad
     |HAZ BuscaImporte;
     nC5 = nImporte;
     |SI nConvenio = 83; |O nConvenio = 85;  || Incentivos
          nConcepto = 105;
          |HAZ BuscaImporte;
          nIncentivos = nImporte;

          nConcepto = 120;
          |HAZ BuscaImporte;
          nIncentivos = nIncentivos + nImporte;
     |FINSI;
     |SI nConvenio = 84; |O nConvenio = 86;  || Incentivos
          nConcepto = 112;
          |HAZ BuscaImporte;
          nIncentivos = nImporte;
     |FINSI;
     |SI nCategoria = 32;
          nC6 = nIncentivos;       || Viajante
     |SINO;
          nC7 = nIncentivos;       || No Viajante
     |FINSI;

     |SI nConvenio = 83; |O nConvenio = 85;  || Retribucion Voluntaria
          nConcepto = 112;
          |HAZ BuscaImporte;
          nC8 = nImporte;
     |FINSI;
     |SI nConvenio = 84; |O nConvenio = 86;  || Retribucion Voluntaria
          nConcepto = 105;
          |HAZ BuscaImporte;
          nC8 = nImporte;

          nConcepto = 120;
          |HAZ BuscaImporte;
          nC8 = nC8 + nImporte;
     |FINSI;

     nConcepto = 203;         || Paga Beneficios
     |HAZ BuscaImporte;
     nC9 = nImporte;
     |SI swNoSumes = 0;
          nC3 = nC3 + nC9;     || acumulo pagas en Total Devengado
     |FINSI;

     nConcepto = 201;         || Paga Verano
     |HAZ BuscaImporte;
     nC10 = nImporte;
     |SI swNoSumes = 0;
          nC3 = nC3 + nC10;     || acumulo pagas en Total Devengado
     |FINSI;

     nConcepto = 202;         || Paga Diciembre
     |HAZ BuscaImporte;
     nC11 = nImporte;
     |SI swNoSumes = 0;
          nC3 = nC3 + nC11;     || acumulo pagas en Total Devengado
     |FINSI;

     nC3 = nC3 + nC4;                   || acumulo atrasos en Total Devengado

     nConcepto = 103;         || Plus Convenio
     |HAZ BuscaImporte;
     nC12 = nImporte;
     nConcepto = 106;
     |HAZ BuscaImporte;
     nC12 = nC12 + nImporte;

     nConcepto = 108;         || Diferencias Atrasos
     |HAZ BuscaImporte;
     nC4 = nImporte;

     nConcepto = 107;         || Plus Escolaridad
     |HAZ BuscaImporte;
     nC13 = nImporte;

     |SI nConvenio = 84; |O nConvenio = 86;  || Kilometraje
          nConcepto = 409;
          |HAZ BuscaImporte;
          nC14 = nImporte;
          nConcepto = 412;
          |HAZ BuscaImporte;
          nC14 = nC14 + nImporte;
     |FINSI;

     nConcepto = 104;         || Plus Actividad
     |HAZ BuscaImporte;
     nC15 = nImporte;

     |SI nConvenio = 84; |O nConvenio = 86;  || Dietas
          nConcepto = 413;
          |HAZ BuscaImporte;
          nC16 = nImporte;
     |FINSI;

     |SI nConvenio = 84; |O nConvenio = 86;  || Gastos de Viaje
          nConcepto = 414;
          |HAZ BuscaImporte;
          nC17 = nImporte;
     |FINSI;

     nConcepto = 416;         || Jornadas Gastronomicas
     |HAZ BuscaImporte;
     nC18 = nImporte;

     nConcepto = 101;         || Salario Base
     |HAZ BuscaImporte;
     nC19 = nImporte;

     || Incapacidad Temporal
     nC20 = #900#57 + #900#58 + #900#59 + #900#60;
     |SI aProc = "nomcalca"; |O aProc = "nomcalac";
          nC20 = nC20 + #900#73;
     |SINO;
          nC20 = nC20 + #900#112;
     |FINSI;

     |SI nConvenio = 83;      || Incapacidad Temporal
          nConcepto = 409;
          |HAZ BuscaImporte;
          nC20 = nC20 + nImporte;
     |FINSI;

     nC20 = (-1) * nC20;

     |SI nConvenio = 83;      || Abs.Injus / Dif. Salarial
          nConcepto = 108;
          |HAZ BuscaImporte;
          nC21 = nC21 + nImporte;
     |FINSI;
     |SI nConvenio = 84;      || Gastos Viaje
          nConcepto = 411;
          |HAZ BuscaImporte;
          nC22 = nC22 + nImporte;
     |FINSI;
     |SI nConvenio = 83;      || Dif. Vacac.
          nConcepto = 113;
          |HAZ BuscaImporte;
          nC23 = nC23 + nImporte;
     |FINSI;

     nC30 = #900#59 + #900#60;          || complemento

     nC31 = nC3;
     nC31 = nC31 - (nC5 + nC6 + nC7 + nC8 + nC9 + nC10 + nC11)
     nC31 = nC31 - (nC12 + nC13 + nC14 + nC15 + nC16 + nC17 + nC18 + nC19);
     nC31 = nC31 - (((-1) * nC20) + nC21 + nC22 + nC23);

     nC32 = #900#45;                    || Seg. Social Cgo. Empresa

     |HAZ GrabaTmp;
|FPRC;

|DEFBUCLE nomhiccaAT;
     #900#1005;
     ;
     #0#0, 00001, nAnyo, 01, #0#12;
     #0#0, 99999, nAnyo, 12, #0#17;
     ;
     NULL, ElCalculo;
|FIN;

|DEFBUCLE nomcalac;
     #900#1004;
     ;
     #0#0, 00001, 01, #0#12;
     #0#0, 99999, 12, #0#17;
     ;
     NULL, ElCalculo;
|FIN;

|DEFBUCLE nomhicca;
     #900#1005;
     ;
     #0#0, 00001, nAnyo, #0#3, 0;
     #0#0, 99999, nAnyo, #0#16, 2;
     ;
     NULL, ElCalculo;
|FIN;

|DEFBUCLE nomcalca;
     #900#1004;
     ;
     #0#0, 00001, #0#3, 0;
     #0#0, 99999, #0#16, 2;
     ;
     NULL, ElCalculo;
|FIN;

|PROCESO ElProceso;
     |ABRE #labempre;
     |ABRE #labtraba;

     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("s" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #100;

     |ABRE #100;
     |SI #0#4 = "X";
          aProc = "nomcalca";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomcalca.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomcalli.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;

          |BUCLE nomcalca;
     |FINSI;
     |SI #0#5 = "X";
          aProc = "nomhicca";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomhicca.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomhicli.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;
          aAnyo = #0#2;
          aAnyo = #0#2 % -102;
          nAnyo = aAnyo;
          |BUCLE nomhicca;
     |FINSI;

     |SI #0#6 = "X";
          aProc = "nomcalac";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomcalac.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomcalal.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;

          |BUCLE nomcalac;
     |FINSI;
     |SI #0#7 = "X";
          aProc = "nomhiccaAT";
          |DBASE aDirBase;    |QBF aDirBase;
          aAlfa = aDirBase + "def/nomhicca.mas";
          |CARGA_DEF aAlfa, ref0001@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;

          aAlfa = aDirBase + "def/nomhicli.mas";
          |CARGA_DEF aAlfa, ref0002@;
          |SI FSalida ! 0;    |ACABA;   |FINSI;
          |ABRE #910;
          aAnyo = #0#13;
          aAnyo = aAnyo % -102;
          nAnyo = aAnyo;

          |BUCLE nomhiccaAT;
     |FINSI;

     |CIERRA #910;
     |DESCARGA_DEF #910;
     |DESCARGA_DEF #900;
     |CIERRA #100;
     |CIERRA #labtraba;
     |CIERRA #labempre;
|FPRC;


|PROCESO GeneraHoja;
     nLinea = nLinea + 1;
     aAlfa = "A" + nLinea + "," + #100#0; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "B" + nLinea + "," + #100#1; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "C" + nLinea + "," + #100#2; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + #100#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + #100#4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "F" + nLinea + "," + #100#5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + #100#6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "H" + nLinea + "," + #100#7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + #100#8; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + #100#9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + #100#10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + #100#11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + #100#12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + #100#13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + #100#14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "P" + nLinea + "," + #100#15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Q" + nLinea + "," + #100#16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "R" + nLinea + "," + #100#17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "S" + nLinea + "," + #100#18; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "T" + nLinea + "," + #100#19; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "U" + nLinea + "," + #100#20; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "V" + nLinea + "," + #100#21; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "W" + nLinea + "," + #100#22; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "X" + nLinea + "," + #100#23; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Y" + nLinea + "," + #100#24; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Z" + nLinea + "," + #100#25; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AA" + nLinea + "," + #100#26; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AB" + nLinea + "," + #100#27; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AC" + nLinea + "," + #100#28; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AD" + nLinea + "," + #100#29; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AE" + nLinea + "," + #100#30; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AF" + nLinea + "," + #100#31; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AG" + nLinea + "," + #100#32; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nTotC3 = nTotC3 + #100#3;
     nTotC4 = nTotC4 + #100#4;
     nTotC5 = nTotC5 + #100#5;
     nTotC6 = nTotC6 + #100#6;
     nTotC7 = nTotC7 + #100#7;
     nTotC8 = nTotC8 + #100#8;
     nTotC9 = nTotC9 + #100#9;
     nTotC10 = nTotC10 + #100#10;
     nTotC11 = nTotC11 + #100#11;
     nTotC12 = nTotC12 + #100#12;
     nTotC13 = nTotC13 + #100#13;
     nTotC14 = nTotC14 + #100#14;
     nTotC15 = nTotC15 + #100#15;
     nTotC16 = nTotC16 + #100#16;
     nTotC17 = nTotC17 + #100#17;
     nTotC18 = nTotC18 + #100#18;
     nTotC19 = nTotC19 + #100#19;
     nTotC20 = nTotC20 + #100#20;
     nTotC21 = nTotC21 + #100#21;
     nTotC22 = nTotC22 + #100#22;

     nTotC23 = nTotC23 + #100#23;
     nTotC24 = nTotC24 + #100#24;
     nTotC25 = nTotC25 + #100#25;
     nTotC26 = nTotC26 + #100#26;
     nTotC27 = nTotC27 + #100#27;
     nTotC28 = nTotC28 + #100#28;
     nTotC29 = nTotC29 + #100#29;
     nTotC30 = nTotC30 + #100#30;
     nTotC31 = nTotC31 + #100#31;
     nTotC32 = nTotC32 + #100#32;
|FPRC;

|DEFBUCLE GeneraHoja;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, GeneraHoja;
|FIN;

|PROCESO Totales;
/*
     aRaizMacro = "Módulo1.";

     nLinea = nLinea + 1;
     aAlfa = "I" + nLinea + "," + "TOTAL"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "J" + nLinea + "," + aRaizMacro + "Gris";
     |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;


     InTotal = nTotC15<-;
     aColumna = "J";
     |PARA nPara = 15; |SI nPara [ 34; |HACIENDO nPara = nPara + 1;
          aAlfa = aColumna % 101;
          |SI aAlfa ! "A";
               |SI aColumna = "Z";
                    aColumna = "AA";
               |SINO;
                    nCodAscii = &aColumna;
                    nCodAscii = nCodAscii + 1;
                    aColumna = &nCodAscii;
               |FINSI;
          |SINO;
               aAlfa = aColumna % 201;
               aColumna = aAlfa;
               nCodAscii = &aColumna;
               nCodAscii = nCodAscii + 1;
               aColumna = &nCodAscii;
               aColumna = "A" + aColumna;
          |FINSI;




          aAlfa = aColumna + nLinea + "," + nTotal; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aAlfa = aColumna + nLinea + "," + aRaizMacro + "Gris";
          |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

          InTotal = InTotal + 1;
     |SIGUE;
*/
     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA

     aRaizMacro = "Módulo1.";
     aAlfa = "C" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "D" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "E" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "F" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "G" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "H" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "I" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "J" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "K" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "L" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "M" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "N" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "O" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "P" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "Q" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "R" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "S" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "T" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "U" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "V" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "W" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "X" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "Y" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "Z" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AA" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AB" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AC" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AD" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AE" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AF" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = "AG" + nLinea + "," + aRaizMacro + "Gris_Negrita"; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

     aAlfa = "C" + nLinea + ", Totales:"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "D" + nLinea + "," + nTotC3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "E" + nLinea + "," + nTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "F" + nLinea + "," + nTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "G" + nLinea + "," + nTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "H" + nLinea + "," + nTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "I" + nLinea + "," + nTotC8; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "J" + nLinea + "," + nTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "K" + nLinea + "," + nTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "L" + nLinea + "," + nTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "M" + nLinea + "," + nTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "N" + nLinea + "," + nTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "O" + nLinea + "," + nTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "P" + nLinea + "," + nTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Q" + nLinea + "," + nTotC16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "R" + nLinea + "," + nTotC17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "S" + nLinea + "," + nTotC18; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "T" + nLinea + "," + nTotC19; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "U" + nLinea + "," + nTotC20; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "V" + nLinea + "," + nTotC21; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "W" + nLinea + "," + nTotC22; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "X" + nLinea + "," + nTotC23; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Y" + nLinea + "," + nTotC24; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "Z" + nLinea + "," + nTotC25; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AA" + nLinea + "," + nTotC26; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AB" + nLinea + "," + nTotC27; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AC" + nLinea + "," + nTotC28; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AD" + nLinea + "," + nTotC29; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AE" + nLinea + "," + nTotC30; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AF" + nLinea + "," + nTotC31; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     aAlfa = "AG" + nLinea + "," + nTotC32; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
|FPRC;

|PROCESO MesLetra;
     |SI nMes = 1;  aMes = "ENERO";          |FINSI;
     |SI nMes = 2;  aMes = "FEBRERO";        |FINSI;
     |SI nMes = 3;  aMes = "MARZO";          |FINSI;
     |SI nMes = 4;  aMes = "ABRIL";          |FINSI;
     |SI nMes = 5;  aMes = "MAYO";           |FINSI;
     |SI nMes = 6;  aMes = "JUNIO";          |FINSI;
     |SI nMes = 7;  aMes = "JULIO";          |FINSI;
     |SI nMes = 8;  aMes = "AGOSTO";         |FINSI;
     |SI nMes = 9;  aMes = "SEPTIEMBRE";     |FINSI;
     |SI nMes = 10; aMes = "OCTUBRE";        |FINSI;
     |SI nMes = 11; aMes = "NOVIEMBRE";      |FINSI;
     |SI nMes = 12; aMes = "DICIEMBRE";      |FINSI;
|FPRC;

|PROCESO ElInforme;
     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("s" + aAlfa1) % 108;
     |NOME_DAT #100 aAlfa1;
     |ABRE #100;

     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "documentos/costes_convenio_especias.xls";
     aDestinoTrab = "C:\DOCUMENTOS";         |RMKDIR aDestino;
     aDestino = aDestinoTrab + "\trabajo.xls";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDestino;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "MONTHLY PAYROLL";

     aValor = "DESGLOSE CONVENIO ESPECIAS";
     aAlfa = "A1, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI #0#3 = #0#16;
          nMes = #0#3;
          |HAZ MesLetra;
          aMeses = aMes;
     |SINO;
          nMes = #0#3;
          |HAZ MesLetra;
          aMeses = aMes;
          nMes = #0#16;
          |HAZ MesLetra;
          aMeses = aMeses + " - " + aMes;
     |FINSI;

     aValor = #0#2;
     fFecha = ~;
     aFecha = fFecha;
     |HORA aHora;

     aValor = aMeses + " / " + aValor + "      " + aFecha + " " + aHora;
     aAlfa = "E1, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aValor = #labempre#10; |QBF aValor;
     aValor = aValor + "  " + #labempre#2; |QBF aValor;
     aAlfa = "A3, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nLinea = 6;

     |BUCLE GeneraHoja;

     ||TOTALES;

     |HAZ Totales;

     aAlfa   = aDestinoTrab + "\costes_convenio_especias.xls";
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
     |DESCARGADLL "agixl97.dll";

     aDestino   = aDestinoTrab + "\trabajo.xls";
     |RFBORRA aDestino;
         aVersion1 = "Excel.Sheet";
         |ESPECIFICA "VERSION_PROGRAMA", aVersion;
         |HAZ ExtraePath;
         |SI aPath = "NO LOCALIZADO";
             |MENAV "0000 No puedo encontrar automaticamente la Excel";
             |ACABA;
         |FINSI;

         |QBF aPath;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
     |RSYSTEM aAlfa;

     |CIERRA #100;
|FPRC;

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO Comprueba3;
     |SI #0#4 = " "; |Y #0#5 = " ";
          swSigue = 0;
     |FINSI;
     |SI #0#11 = "S";
          |SI #0#6 = " "; |Y #0#7 = " ";
               swSigue = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CLS;

     |HAZ miraanyo;
     |HAZ mirames;

     |ABRE #0;
     |LEE 000#0p;
     FEstadoDef = FSalida;

     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          swSigue = 1;

          |HAZ Comprueba3;
          |SI swSigue = 1;
               |HAZ ElProceso;
               |HAZ ElInforme;
          |FINSI;
     |FINSI;
     |SI FEstadoDef = 0;
          |GRABA 020#0a;
     |SINO;
          |GRABA 020#0n;
     |FINSI;
     |CIERRA #0;
|FPRO;
