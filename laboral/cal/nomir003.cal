|FICHEROS;
     nomir001  #0;
     labtraba  #2;
     nomir003  #102;
|FIN;

|VARIABLES;
     swHijos = 0;
     nPara1 = 0;
     nPara2 = 0;
     nEdad = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     nNume1 = 0;
     nNume2 = 0;
     fFech1 = @;
     fFech2 = @;
     nInkey = 0;
     NifLetra = "";
     x = "";
     final = "";
     letra = "";
     letrasnif = "TRWAGMYFPDXBNJZSQVHLCKE";
     lugar = 0;
     resto = 0;
     nifnum = 0;
     &nAnyo = 0;
     aAlfa = "";
|FIN;

/*
|PROCESO Causas; |TIPO 7;
     |PUSHV 07022379;
     |ATRI R;
     |CUADRO 07372379;
     ||            89012345678901234567890123456789012345678
     ||            3 4         5         6         7
     |PINTA 0738, "1. Aumento retribuciones/disminuc. gastos";
     |PINTA 0838, "2. Disminuc. reribuciones/aumento gastos ";
     |PINTA 0938, "3. Prolongacion de la actividad laboral  ";
     |PINTA 1038, "4. Movilidad geografica                  ";
     |PINTA 1138, "5. Aumento descend. con derecho a minimo ";
     |PINTA 1238, "6. Aumento grado disc. contrib. o descen.";
     |PINTA 1338, "7. Aumento ascend. o su grado discapacid.";
     |PINTA 1438, "8. Dismin. ascend. o su grado discapacid.";
     |PINTA 1538, "9. Obligacion pago de pension al conyuge ";
     |PINTA 1638, "10.Obligacion pago anualidades a hijos   ";
     |PINTA 1738, "11.Cambio situacion familiar de 2 a 3    ";
     |PINTA 1838, "12.Perdida de condicion resid. Ceuta/Mel.";
     |PINTA 1938, "13.Adquisicion condicion resid.Ceuta/Mel.";
     |PINTA 2038, "14.Comenzar trabajos fuera de Ceuta/Mel. ";
     |PINTA 2138, "   con la condicion de residente         ";
     |PINTA 2238, "15.Otras causas                          ";
|FPRC;
*/
|PROCESO Causas; |TIPO 7;
     |PUSHV 06372379;
     |ATRI R;
     ||            890123456789012345678901234567890123456789
     ||            3 4         5         6         7
     |PINTA 0638, " 1.Circunstancias que determinan variacio-";
     |PINTA 0738, "   nes en la base para calcular el %reten.";
     |PINTA 0838, " 2.Circunstancias que determinan variacio-";
     |PINTA 0938, "   nes en el importe del minimo personal. ";
     |PINTA 1038, " 3.Quedar obligado el perceptor a satisfa-";
     |PINTA 1138, "   cer pension compensatoria al conyuge.  ";
     |PINTA 1238, " 4.Quedar obligado el perceptor a satisfa-";
     |PINTA 1338, "   cer anualidades a favor de los hijos.  ";
     |PINTA 1438, " 5.Cambio situacion familiar de 2 a 3     ";
     |PINTA 1538, " 6.Perdida de condicion resid. Ceuta/Mel. ";
     |PINTA 1638, " 7.Adquisicion condicion resid. Ceuta/Mel.";
     |PINTA 1738, " 8.Comenzar trabajos fuera de Ceuta/Melil.";
     |PINTA 1838, "   con la condicion de residente          ";
     |PINTA 1938, " 9.El perceptor ha comunicado que realiza ";
     |PINTA 2038, "   pagos por prestamos por vivienda hab.  ";
     |PINTA 2138, "10.El perceptor ha comunicado la  improce-";
     |PINTA 2238, "   dencia de reduccion por pago prest.viv.";
     |PINTA 2338, "11.Otras causas                           ";
|FPRC;

|PROCESO Restaura;
     |ATRI 0;
     |POPV;
|FPRC

|PROCESO comp_hijos; |TIPO 7;
     swHijos = 0;
     |PARA nPara1 = 20; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
          nEdad = #0#2 - #102nPara1;
          |SI #102nPara1 ! 0;
               nPara2 = nPara1 + 10;    || grado minusvalia

               || solo tienen reduccion menores de 25 a¤os o mayores c/minusv.
               |SI nEdad < 25;
               |O #102nPara2 = "1"; |O #102nPara2 = "2";
                   swHijos = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     |PARA nPara1 = 20; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
          |SI #102nPara1 ! 0;
               swHijos = 1;
          |FINSI;
     |SIGUE;
     |SI #102#3 = 1; |Y swHijos ! 1;
          aAlfa1 = "    ATENCION. Para la situación familiar tipo 1 es obligatorio tener";
          aAlfa1 = aAlfa1 + " des- cendientes con derecho a reducción";
          |MENAV aAlfa1;
          #102#3 = 3;
          |PINTA #102#3;
          aAlfa = "    Se ha cambiado la situación familiar a tipo 3. Si no es correcto ";
          aAlfa = aAlfa + "cámbielo al 1 e introduzca los datos de los desc.";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO comp_conyuge; |TIPO 0;
     aAlfa1 = #102#4;
     |QBF aAlfa1;
     |SI aAlfa1 =""; |Y #102#3 = 2;
          aAlfa1 = "    ATENCION. Para la situación familiar tipo 2 es obligatorio tener informado";
          aAlfa1 = aAlfa1 + " el NIF del cónyuge.";
          |MENAV aAlfa1;
          #102#3 = 3;
          |PINTA #102#3;
          aAlfa = "    Se ha cambiado la situación familiar a tipo 3. Si no es correcto ";
          aAlfa = aAlfa + "cámbielo al 2 e introduzca el NIF del cónyuge";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO SinMovil102; |TIPO 7;
     |SI Campo ] 85;|Y Campo [ 94;
          nNume1 = Campo - 55;
     |FINSI;
     |SI Campo ] 105;|Y Campo [ 114;
          nNume1 = Campo - 43;
     |FINSI;
     |SI #102nNume1 = "1";
          |C_M #102Campo, 1, "S";
     |SINO;
          nNume2 = Campo + 1;
          |PDEFECTO #102, Campo, nNume2;
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO comp_asc102; |TIPO 7;
     |SI Campo ] 52;|Y Campo [ 61;
          nNume1 = Campo + 43;
     |FINSI;
     |SI #102nNume1 ! 0;
          |C_M #102Campo, 1, "S";
     |SINO;
          nNume2 = Campo + 1;
          ||PDEFECTO #102, Campo, nNume2;
          ||PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;
____________________________________/ PUNTO 03 (Parametros Calculo)
|PROCESO LetraNifbis;
        aAlfa1 = NifLetra;          || recoge valor en variable trabajo
    |QBT aAlfa1;                    || le quita los espacios en blanco
        x = aAlfa1 % 101;           || carga primer caracter
        x = x > x;
    |SI x ] "0";|Y x [ "9";
            final = "";                 || inicializa variable de trabajo
            aAlfa2 = aAlfa1 % 0;        || halla la longitud en caracteres
            nNume1 = aAlfa2;            || recoge valor en variable numerica
        |PARA nNume2 = 1; |SI nNume2 [ nNume1; |HACIENDO nNume2 = nNume2 + 1;
                lugar = (nNume2 * 100) + 1;       || construye literal
                aAlfa2 = aAlfa1 % lugar;          || despreciando puntos, etc.
            |SI aAlfa2="0";|O aAlfa2="1";|O aAlfa2="2";|O aAlfa2="3";
                           |O aAlfa2="4";|O aAlfa2="5";|O aAlfa2="6";
                           |O aAlfa2="7";|O aAlfa2="8";|O aAlfa2="9";
                    final = final + aAlfa2;
            |FINSI;
        |SIGUE;
            nifnum = final;
        |SI nifnum ! 0; |Y final ! "";
                resto = nifnum $ 23;       || halla el resto
                resto = resto + 1;         || le suma uno para no operar con cero
                lugar = (resto * 100) + 1; || halla la posicion en el literal
                letra = letrasnif % lugar; || saca la letra segun posicion
                NifLetra = final + letra;  || recoge en variable Campo
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO TipoEstima2;
     |SI #nomir003#5 = 2;
          |C_M #nomir003#121, 1, "S";
          |C_V #nomir003#121, 1, "S";
          |PINTA #nomir003#121;
     |SINO;
          |C_M #nomir003#121, 1, "N";
          |C_V #nomir003#121, 1, "N";
          |PINTA 1051, "   ";
     |FINSI;
|FPRC;

|PROCESO Ayuda121; |TIPO 7;
     |PUSHV 13261880;
     |ATRI R;
     |PINTA 1330, " Tipo de Calculo para contratos menores de un a¤o: ";
     |PINTA 1430, " 1. Estimar ingresos hasta la fecha de fin de con- ";
     |PINTA 1530, "    trato indicada o hasta final de a¤o.           ";
     |PINTA 1630, " 2. Tener en cuenta lo ingresado hasta el periodo  ";
     |PINTA 1730, "    que estamos calculando.                        ";
     |ATRI 0;
|FPRC;

|PROCESO AyudaTipo; |TIPO 7;
     |PUSHV 13262080;
     |ATRI R;
     |PINTA 1330, " Tipo de Relacion Laboral: ";
     |PINTA 1430, " 1. General                                        ";
     |PINTA 1530, " 2. Duracion inferior a un a¤o                     ";
     |PINTA 1630, " 3. Relaciones laborales especiales de caracter de-"
     |PINTA 1730, "    pendiente (salvo penados y discapacitados)     ";
     |PINTA 1830, " 4. Esporadica propia de retribuciones por peonadas";
     |PINTA 1930, "    o jornales diarios                             ";
     |ATRI 0;
|FPRC;

|PROCESO RestauraViv;
     |SI #nomir003#124 = "S"; |Y #nomir003#126 = "S";
          || no restaures que si no se jode la pantalla
     |SINO;
          |ATRI 0;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO AyudaViv; |TIPO 7;
                 ||     3        4         5         6         7
                 ||     012345678901234567890123456789012345678901234567

     |PUSHV 12022379;
     |ATRI R;
     |PINTA 1330, " Introduzca 'S' si el trabajador se acoge  a la ";
     |PINTA 1430, " deducción por pagos de préstamos  destinados a ";
     |PINTA 1530, " la vivienda habitual del perceptor adquirida o ";

     |SI Campo = 124;
          |PINTA 1630, " rehabilitada CON ANTERIORIDAD A 01/01/2011.    ";
     |FINSI;
     |SI Campo = 126;
          |PINTA 1630, " rehabilitada A PARTIR DE 01/01/2011.           ";
     |FINSI;
|FPRC;

/*
|| de momento NO
|PROCESO nomir012;
     |SI #nomir003#124 = "S"; |Y #nomir012#99 = "S";
     |FINSI;
|FPRC;

|DEFBUCLE nomir012;
     #nomir012#2;
     ;
     #nomir003#1;
     #nomir003#1;
     ;
     NULL, nomir012;
|FIN;
*/

|PROCESO CompViv;
     |SI #nomir003#124 = "S"; |Y #nomir003#126 = "S";
          aAlfa = "    ATENCION: no se pueden marcar las dos casillas de ";
          aAlfa = aAlfa + "deducción por vivienda. Debe elegir una.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;
