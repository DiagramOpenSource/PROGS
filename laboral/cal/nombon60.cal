|FICHEROS;
     nombon60 #0;
     labtraba #2;
     nombotmp #100,MANTE;
     labempre;
|FIN;

|VARIABLES;
     fFechaNac = @;
     nFechaNac = 0;
     aFechaNac = "";
     fFechaAnt = @;
     nFechaAnt = 0;
     aFechaAnt = "";
     aAnyoNac = "";
     nAnyoNac = 0;
     aMesNac = "";
     nMesNac = 0;
     aAnyoAnt = "";
     nAnyoAnt = 0;
     aMesAnt = "";
     nMesAnt = 0;
     nMesRef = 0;
     nAnyoRef = 0;

     nAnyos = 0;
     nMeses = 0;
     nEdad = 0;

     swGraba = 0;
     {-1}menu = "";
     menu1 = "2400";
     menu2 = "1";
     menu3 = "Elegir Opcion:";
     menu4 = "RACI";
     menu5 = "Revisar";
     menu6 = "Actualizar";
     menu7 = "Cancelar";
     menu8 = "Imprimir";
     aAlfa1 = "";
     nOpcion = 0;
     nPorc = 0;
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     nume5 = 0;
     nume6 = 0;
     nume7 = 0;
     nume8 = 0;
     nume9 = 0;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     alfa5 = "";
     alfa6 = "";
     alfa7 = "";
     alfa8 = "";
     fecha_bon_16 = "";
     nMesesBon16 = 0;
     nAnyosBon16 = 0;
     nPB16Calc = 0;
|FIN;

|PROCESO Modifica; |TIPO 7;
     |CAMPO_MODIFICA #100#6, 1, "S";
|FPRC;

|PROCESO por_bon_16;
     nPB16Calc = 0;      || inicializo
     alfa1 = #2#11 % -104;        || anyo nacimiento
     alfa2 = #2#11 % -602;        || mes nacimiento
     alfa5 = #2#11 % 102;         || dia nacimiento

     aFechaAnt = "";
     |SI #2#212 = 2; |O #2#212 = 4; |O #2#212 = 6;
     |O #2#212 = 14; |O #2#212 = 16;
          aFechaAnt = #2#36;       || fecha de referencia: fecha de Alta
     |SINO;
          |SI #2#212 = 11;
               aFechaAnt = #2#132;      || nueva fecha de referencia para Asecor
          |SINO;
               aFechaAnt = #2#34;       || fecha de referencia: fecha de Antiguedad
          |FINSI;
     |FINSI;

     alfa3 = aFechaAnt % -104;        || anyo antiguedad
     alfa4 = aFechaAnt % -602;        || mes antiguedad
     alfa6 = aFechaAnt % 102;         || dia antiguedad
     nume1 = alfa1;
     nume1 = alfa1 + 60;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + 5;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad

     |SI nume1 > nume3;            || cuando cumple 60 a¤os
          |SI nume1 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < 2002;
               fecha_bon_16 = "01.01.2002";
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 a¤os
               |SI nume1 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < 2002;
                    fecha_bon_16 = "01.01.2002";
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 a¤os
                    |SI nume1 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume5 < nume6;            || cuando cumple antiguedad
                    |SI nume3 < 2002;
                         fecha_bon_16 = "01.01.2002";
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
     |FINSI;

     alfa7 = fecha_bon_16 % 402;
     nume7 = alfa7;                || mes en que empieza a ser efectiva la bonif.
     alfa7 = fecha_bon_16 % -104;
     nume8 = alfa7;                || anyo en que empieza a ser efectiva la bonif.
     nMesesBon16 = #0#0 - nume7;
     nAnyosBon16 = #0#1 - nume8;
     |SI nAnyosBon16 > 0;
          |SI nMesesBon16 < 0;
               nMesesBon16 = 12 + nMesesBon16;
               nAnyosBon16 = nAnyosBon16 - 1;
          |FINSI;
     |FINSI;
     |SI nAnyosBon16 ] 0;
          |SI nAnyosBon16 ! 0; |O nMesesBon16 ] 0;
               nPB16Calc = 50 + (nAnyosBon16 * 10);
               |SI nPB16Calc > 100;
                    nPB16Calc = 100;
               |FINSI;
               |HAZ graba;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO selecciona;
     swGraba = 0;
     aFechaNac = #labtraba#11;          || fecha nacimiento
     aAnyoNac = aFechaNac % -104;
     nAnyoNac = aAnyoNac;
     nAnyoRef = #nombon60#1;
     aMesNac = aFechaNac % -602;
     nMesNac = aMesNac;
     nMesRef = #nombon60#0;

     nAnyos = nAnyoRef - nAnyoNac;
     nMeses = nMesRef - nMesNac;

     |SI nAnyos > 60;
          swGraba = swGraba + 1;
     |SINO;
         |SI nAnyos = 60;
              |SI nMeses ] 0;
                   swGraba = swGraba + 1;
              |FINSI;
         |FINSI;
     |FINSI;

     |SI #2#212 = 2; |O #2#212 = 4; |O #2#212 = 6;
     |O #2#212 = 14; |O #2#212 = 16;
          aFechaAnt = #2#36;       || fecha de referencia: fecha de Alta
     |SINO;
          |SI #2#212 = 11;
               aFechaAnt = #2#132;      || nueva fecha de referencia para Asecor
          |SINO;
               aFechaAnt = #2#34;       || fecha de referencia: fecha de Antiguedad
          |FINSI;
     |FINSI;

     aAnyoAnt = aFechaAnt % -104;
     nAnyoAnt = aAnyoAnt;
     aMesAnt = aFechaAnt % -602;
     nMesAnt = aMesAnt;

     nAnyos = nAnyoRef - nAnyoAnt;
     nMeses = nMesRef - nMesAnt;

     |SI nAnyos > 5;
          nPorc = 100;
          swGraba = swGraba + 1;
     |SINO;
         |SI nAnyos = 5;
              |SI nMeses ] 0;
                   swGraba = swGraba + 1;
              |FINSI;
         |FINSI;
     |FINSI;

     |SI #labtraba#44 = "A";
          swGraba = swGraba + 1;
     |FINSI;

     |HAZ graba;
|FPRC;

|PROCESO graba;
     ||SI swGraba = 3;
     |SI nPB16Calc > 0;;
          |DDEFECTO #100;
          #100#0 = #labtraba#0;    || Codigo empresa
          #100#1 = #labtraba#1;    || Codigo trabajador
          #100#2 = #labtraba#2;    || nombre trabajador
          #100#3 = #labtraba#11;   || fecha nacimiento
          || #100#4 = #labtraba#34;   || fecha antiguedad
          #100#4 = aFechaAnt;   || fecha antiguedad
          #100#5 = #labtraba#36;   || fecha alta
          #100#7 = #labtraba#45;   || Codigo Contrato
          #100#6 = nPB16Calc;
          #100#8 = #labtraba#87;
          || SI #labtraba#211 ! 0;
               || #100#6 = #labtraba#211;  || % bonif. >60 a¤os
          || SINO;
               || #100#6 = 50;
          || FINSI;
          |GRABA 020#100n;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     44;
     00001, 00001, "A";
     99999, 99999, "A";
     ;
     NULL, por_bon_16;
|FIN;

|PROCESO min;
     #nombotmp#0 = 1;
     #nombotmp#1 = 1;
|FPRC;

|PROCESO max;
     #nombotmp#0 = 99999;
     #nombotmp#1 = 99999;
|FPRC;

|PROCESO actualiza2;
     #labtraba#0 = #nombotmp#0;
     #labtraba#1 = #nombotmp#1;
     |LEE 101#labtraba.=
     |SI FSalida = 0;
          #labtraba#211 = #nombotmp#6;
          |GRABA 020#labtraba.a;
     |SINO;
          aAlfa1 = "0000Trabajador [" + #labtraba#0 + "." + #labtraba#1 + "] inaccesible.";
          |MENAV aAlfa1;
     |FINSI;
     |LIBERA #labtraba;
|FPRC;

|DEFBUCLE actualiza_labtraba;
     #nombotmp#1;
     ;
     00001,00001;
     99999,99999;
     ;
     NULL,actualiza2;
|FIN;

|PROCESO actualiza;
     |MENAV "0000Se actualizara la ficha del trabajador para los trabajadores listados";
     |ABRE #labtraba;
     |BUCLE actualiza_labtraba;
     |CIERRA #labtraba;
|FPRC;

|PROCESO imprime_linea;
     |PRINT;
|FPRC;

|DEFBUCLE impresion;
     #nombotmp#1;
     ;
     00001,00001;
     99999,99999;
     ;
     NULL,imprime_linea;
|FIN;

|PROCESO imprime;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "nombon60";
          |BUCLE impresion;
          |PRINT;
          |PIEINF;
          |FININF;
     |SINO;
          |MENAV "0000Proceso abortado.";
     |FINSI;
     |FINIMP;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     aAlfa1 = Usuario;  |QBF aAlfa1;    aAlfa1 = "b" + aAlfa1;
     |NOME_DAT #100 aAlfa1;
     |DELINDEX #100;
     |ABRE #100;
     |BUCLE labtraba;
     |CIERRA #100;

     |PARA; |SI; |HACIENDO;
          |ENTLINEAL #1#nombotmp,1,2,23,1,min,max;
          |MENU menu;
          nOpcion = FSalida;
          |SI nOpcion = 2;     |HAZ actualiza;     |SAL;|FINSI;
          |SI nOpcion = 3;     |SAL;                    |FINSI;
          |SI nOpcion = 4;     |HAZ imprime;            |FINSI;
          menu2 = nOpcion;
     |SIGUE;
|FPRC;
