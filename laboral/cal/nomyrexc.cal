|FICHEROS;
     nomyrenm #0;
     nomyrpac #0;
     labempre;
     labcentr;
     nomtmpre;
     nomyrtmp;
     nomystmp;
     nomtmpr0;
     nomtmpr1;
     nomcontr;

     nomres02;
     nomtmapt;      || totales por trabajador
     nomtmapa;      || totales por area
     nomtmapc;      || totales por centro
     nomtmape;      || totales por empresa

     nomtmprf;
     nomtmprg;      || conceptos que saldran impresos como columna
|FIN;

|VARIABLES;
     nLinea = 0;
     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;
     aRaizMacro = "";
     nMes = 0;
     aMes = "";
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";
     aValor = "";
     aMeses = "";
     fFecha = @;
     aFecha = "";
     aHora = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     {1}aVersion = "";
     aPath = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     aCaracter = "";
     nCaracter = 0;

     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
     nTotTotC15 = 0;
     nTotTotC16 = 0;
     nTotTotC17 = 0;
     nAntEmp = 0;
     nAntCen = 0;
     nAntTra = 0;
     nAntAny = 0;
     nNume = 0;
     aHoja = "";
     nHoja = 0;
     aHojaExcel = "";
     &month = 0;
     aNombreMacro = "";
     swHaEntrado = 0;
     aDesdeTra = "                                        ";
     aHastaTra = "中中中中中中中中中中中中中中中中中中中中";

     &enTipoInf = 0;
     &eaFuente = "";
     &enDesdeMes = 0;
     &enHastaMes = 0;
     &enAny = 0;
     &nOrdenEmp = 0;
     &nOrdenTra = 0;
     &informe = "";
     &enCuadre = 0;
     &nPara = 0;
     &nTipoD = 0;
     &nTipoH = 0;
     swHayAlgo = 0;
     &aNomPag = "";
     swPorAqui = 0;
     nTotInf = 0;
     nTipo = 0;
     swExcelSep = 0;
     &nUnoTipo2 = 0;
     &nCentroTipo2 = 0;
     &nRegistro = 0;
     &fFechaEmision = @;
     &aHoraEmision = "";
     nCampo = 0;
     aUsuario = "";
     &swPagasSN = 0;

     nTotAreaC4 = 0;
     nTotAreaC5 = 0;
     nTotAreaC6 = 0;
     nTotAreaC7 = 0;
     nTotAreaC9 = 0;
     nTotAreaC10 = 0;
     nTotAreaC11 = 0;
     nTotAreaC12 = 0;
     nTotAreaC13 = 0;
     nTotAreaC14 = 0;
     nTotAreaC15 = 0;
     nTotAreaC16 = 0;
     nTotAreaC17 = 0;

     nTotTrabC4 = 0;
     nTotTrabC5 = 0;
     nTotTrabC6 = 0;
     nTotTrabC7 = 0;
     nTotTrabC9 = 0;
     nTotTrabC10 = 0;
     nTotTrabC11 = 0;
     nTotTrabC12 = 0;
     nTotTrabC13 = 0;
     nTotTrabC14 = 0;
     nTotTrabC15 = 0;
     nTotTrabC16 = 0;
     nTotTrabC17 = 0;

     aAntArea = "";
     aAntDesArea = "";
     aArea = "";
     &aRupAreas = "";
     nMesDesde = 0;
     nMesHasta = 0;
     &swDesglose = 0;
     aCelda = "";
     nCol = 0;
     aResultado = "";
     nTC1Real = 0;
     nFormCont = 0;
     nTipoFormCont = 0;
     nBonHorasForm = 0;

     aCopia = "";
     aAlfa3 = "";
     aAlfa4 = "";
     aAlfa5 = "";
     aTipo = "";
     aTipo1 = "";
     aTipo2 = "";
     nTipo1 = 0;
     nTipo2 = 0;
     nNume2 = 0;
     nNume3 = 0;
     aPerTipo = "";
     nColLetra = 0;
     swNuevo = 0;
     nValor = 0;
     nNumColumnas = 0;        || el numero de columnas del informe
     nColConceptos = 0;       || la columna apartir de la que saldran los conceptos
     nNumConceptos = 0;       || cuando conceptos son (columnas que se a兀diran)
     nFinConceptos = 0;       || columna donde acaban los conceptos y se vuelve
                              || a las de la definicion
     swCuenta = 0;
     nEmpresa = 0;
     swNombres = 0;
     nNumeCol = 0;
     aLetraCol = "";
     nTotalSSTra = 0;
     nTotalPrest = 0;
     nTotalSSEmp = 0;
     nDesdeEmp = 0;
     nHastaEmp = 0;
     &swArchivaExcel = 0;
     &eaInforme = "";
     &eaHojaExcel = "";

     aEmp = "";
     aCen = "";
     aTra = "";
     aNomEmp = "";
     nEmpiezoPor = 0;
     nDCen       = 0;
     nHCen       = 0;

     &nTipoOriD = 0:
     &nTipoOriH = 0:
     &enSwFiniq = 0;
     &enPorEmp  = 0;
     &enPorCen  = 0;
     &enCen     = 0;
     &eaCen     = "";
|FIN;

/*

|| TODO ESTO DEL REGISTRO DE IMPRESION YA ESTA OBSOLETO
|| LO COMENTO .... YA LO BORRAMOS OTRO DIA 16.04.2018

|PROCESO AcabaRegistro;
     |CIERRA #nomtmpr1;
|FPRC;

|PROCESO GrabaRegistro;
     |PARA nCampo = 0; |SI nCampo [ 40; |HACIENDO nCampo = nCampo + 1;
          #nomtmpr1#nCampo# = #nomtmpre#nCampo#;
     |SIGUE;

     |GRABA 020#nomtmpr1.n;
|FPRC;

|PROCESO IniciaRegistro;
     |ABRE #nomtmpr0;
     |LEE 000#nomtmpr0.u;
     |SI FSalida ! 0;
          nRegistro = 1;
     |SINO;
          nRegistro = #nomtmpr0#33 + 1;
     |FINSI;

     fFechaEmision = ~;
     |HORA aHoraEmision;
     |QBF aHoraEmision;
     aUsuario = Usuario % 810;
     |SI aNomPag = "N";            || RESUMEN DE NOMINAS
          |PARA nCampo = 0; |SI nCampo [ 32; |HACIENDO nCampo = nCampo + 1;
               #nomtmpr0#nCampo# = #nomyrenm#nCampo#;
               #nomtmpr0#4 = nTipoD;
               || el valor de este campo se cambia durante el resumen (chapuza
               || historica que no cambiamos ahora), hay que volver a asignarle
               || su valor original
          |SIGUE;
          #nomtmpr0#37 = #nomyrenm#33;       || nomina/nomina+paga
          #nomtmpr0#38 = #nomyrenm#34;       || desde trabajador (no se usa en principio)
          #nomtmpr0#39 = #nomyrenm#35;       || hasta trabajador (no se usa en principio)
          #nomtmpr0#40 = #nomyrenm#37;       || descripcion
          |SI swPagasSN = 2;
               #nomtmpr0#41 = "NOMINAS+PAGAS";
          |SINO;
               #nomtmpr0#41 = "NOMINAS";
          |FINSI;
     |FINSI;
     |SI aNomPag = "P";            || RESUMEN DE PAGAS
          #nomtmpr0#0 = #nomyrpac#0;
          #nomtmpr0#1 = #nomyrpac#1;
          #nomtmpr0#15 = #nomyrpac#2;   || mes
          #nomtmpr0#3 = #nomyrpac#3;
          #nomtmpr0#4 = #nomyrpac#4;
          #nomtmpr0#16 = #nomyrpac#5 + 2000;    || a寸
          #nomtmpr0#6 = #nomyrpac#6;
          #nomtmpr0#8 = #nomyrpac#7;
          #nomtmpr0#11 = #nomyrpac#8;
          #nomtmpr0#12 = #nomyrpac#9;
          #nomtmpr0#14 = #nomyrpac#10;
          #nomtmpr0#30 = #nomyrpac#20;
          #nomtmpr0#31 = #nomyrpac#21;
          #nomtmpr0#40 = #nomyrpac#23;
          #nomtmpr0#41 = "PAGAS";
     |FINSI;

     #nomtmpr0#33 = nRegistro;
     #nomtmpr0#34 = fFechaEmision;
     #nomtmpr0#35 = aHoraEmision;
     #nomtmpr0#36 = aUsuario;

     |GRABA 020#nomtmpr0.n;
     |CIERRA #nomtmpr0;

     |ABRE #nomtmpr1;

     fFechaEmision = ~;
     |HORA aHoraEmision;
     |QBF aHoraEmision;
|FPRC;

|PROCESO nomtmpre;
     swHayAlgo = 1;
     |SI informe = "nomyren2"; |O informe = "nomyren4";
          |SI #nomcontr#56 = "S"; |O #nomyrenm#36 = "S"; |O #nomyrpac#22 = "S";
               #nomtmpre#38 = nRegistro;
               #nomtmpre#39 = fFechaEmision;
               #nomtmpre#40 = aHoraEmision;

               |HAZ GrabaRegistro;
          |FINSI;
     |FINSI;
     |PRINT;
|FPRC;
*/

|PROCESO Mensaje;
     aEmp = "                                             ";
     aCen = "                                             ";
     aTra = "                                             ";

     aAlfa = #labempre#0;
     |QBF aAlfa;
     aAlfa = ("00000" + aAlfa) % -105;
     aNomEmp = #labempre#2;
     aNomEmp = aNomEmp % 126;
     aEmp = "Empresa: " + aAlfa + " - " + aNomEmp;
     aEmp = " " + aEmp + " ";

     aCen = " Archivando resumen ... ";
     aCen = aCen + "                            ";
     aCen = aCen % 145;

     aTra = "";

               ||  1 2        3         4         5          6
               ||  890123456789012345678901234567890123456789012
     |ATRI R;
     |PINTA 1318, "     - Procesando archivo de resmenes -     ";
     |PINTA 1418, aEmp;
     |PINTA 1518, aCen;
     |PINTA 1618, aTra;
     |ATRI 0;
|FPRC;

|PROCESO nomtmpre;
     swHayAlgo = 1;
     |PRINT;
|FPRC;

|DEFBUCLE nomtmpre_meses;
     #nomtmpre#1;
     ;
     nDesdeEmp, 001, "    ", 00001, 1999, enDesdeMes, nTipoD;
     nHastaEmp, 999, "zzzz", 99999, 2999, enHastaMes, nTipoH;
     ;
     NULL, nomtmpre;
|FIN;

|DEFBUCLE nomtmpre;
     #nomtmpre#1;
     ;
     nDesdeEmp, 001, "    ", 00001, 1999, nMesDesde, nTipoD;
     nHastaEmp, 999, "zzzz", 99999, 2999, nMesHasta, nTipoH;
     ;
     NULL, nomtmpre;
|FIN;

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO AntesTodos;
     |SI swNuevo = 1; |ACABA; |FINSI;

     nCol = nCol + 1;    || COLUMNA 4
     aAlfa = &nCol + nLinea + "," + #nomtmpre#7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 5
     aAlfa = &nCol + nLinea + "," + #nomtmpre#8; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 6
     aAlfa = &nCol + nLinea + "," + #nomtmpre#9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 7
     aAlfa = &nCol + nLinea + "," + #nomtmpre#10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 8
     aAlfa = &nCol + nLinea + "," + #nomtmpre#11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 9
     aAlfa = &nCol + nLinea + "," + #nomtmpre#12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 10
     aAlfa = &nCol + nLinea + "," + #nomtmpre#18; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 11
     aAlfa = &nCol + nLinea + "," + #nomtmpre#14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 12
     aAlfa = &nCol + nLinea + "," + #nomtmpre#15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 13
     aAlfa = &nCol + nLinea + "," + #nomtmpre#17; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 14
     aAlfa = &nCol + nLinea + "," + #nomtmpre#16; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;    || COLUMNA 15
     aAlfa = &nCol + nLinea + "," + #nomtmpre#32; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nTotC4 = nTotC4 + #nomtmpre#7;
     nTotC5 = nTotC5 + #nomtmpre#8;
     nTotC6 = nTotC6 + #nomtmpre#9;
     nTotC7 = nTotC7 + #nomtmpre#10;
     nTotC9 = nTotC9 + #nomtmpre#12;
     nTotC10 = nTotC10 + #nomtmpre#18;
     nTotC11 = nTotC11 + #nomtmpre#14;
     nTotC12 = nTotC12 + #nomtmpre#15;
     nTotC13 = nTotC13 + #nomtmpre#17;
     nTotC14 = nTotC14 + #nomtmpre#16;
     nTotC15 = nTotC15 + #nomtmpre#32;
     nTotC16 = nTotC16 + #nomtmpre#34;
     nTotC17 = nTotC17 + #nomtmpre#35;

     nTotTotC4 = nTotTotC4 + #nomtmpre#7;
     nTotTotC5 = nTotTotC5 + #nomtmpre#8;
     nTotTotC6 = nTotTotC6 + #nomtmpre#9;
     nTotTotC7 = nTotTotC7 + #nomtmpre#10;
     nTotTotC9 = nTotTotC9 + #nomtmpre#12;
     nTotTotC10 = nTotTotC10 + #nomtmpre#18;
     nTotTotC11 = nTotTotC11 + #nomtmpre#14;
     nTotTotC12 = nTotTotC12 + #nomtmpre#15;
     nTotTotC13 = nTotTotC13 + #nomtmpre#17;
     nTotTotC14 = nTotTotC14 + #nomtmpre#16;
     nTotTotC15 = nTotTotC15 + #nomtmpre#32;
     nTotTotC16 = nTotTotC16 + #nomtmpre#34;
     nTotTotC17 = nTotTotC17 + #nomtmpre#35;

     nTotAreaC4 = nTotAreaC4 + #nomtmpre#7;
     nTotAreaC5 = nTotAreaC5 + #nomtmpre#8;
     nTotAreaC6 = nTotAreaC6 + #nomtmpre#9;
     nTotAreaC7 = nTotAreaC7 + #nomtmpre#10;
     nTotAreaC9 = nTotAreaC9 + #nomtmpre#12;
     nTotAreaC10 = nTotAreaC10 + #nomtmpre#18;
     nTotAreaC11 = nTotAreaC11 + #nomtmpre#14;
     nTotAreaC12 = nTotAreaC12 + #nomtmpre#15;
     nTotAreaC13 = nTotAreaC13 + #nomtmpre#17;
     nTotAreaC14 = nTotAreaC14 + #nomtmpre#16;
     nTotAreaC15 = nTotAreaC15 + #nomtmpre#32;
     nTotAreaC16 = nTotAreaC16 + #nomtmpre#34;
     nTotAreaC17 = nTotAreaC17 + #nomtmpre#35;

     nTotTrabC4 = nTotTrabC4 + #nomtmpre#7;
     nTotTrabC5 = nTotTrabC5 + #nomtmpre#8;
     nTotTrabC6 = nTotTrabC6 + #nomtmpre#9;
     nTotTrabC7 = nTotTrabC7 + #nomtmpre#10;
     nTotTrabC9 = nTotTrabC9 + #nomtmpre#12;
     nTotTrabC10 = nTotTrabC10 + #nomtmpre#18;
     nTotTrabC11 = nTotTrabC11 + #nomtmpre#14;
     nTotTrabC12 = nTotTrabC12 + #nomtmpre#15;
     nTotTrabC13 = nTotTrabC13 + #nomtmpre#17;
     nTotTrabC14 = nTotTrabC14 + #nomtmpre#16;
     nTotTrabC15 = nTotTrabC15 + #nomtmpre#32;
     nTotTrabC16 = nTotTrabC16 + #nomtmpre#34;
     nTotTrabC17 = nTotTrabC17 + #nomtmpre#35;
|FPRC;

|PROCESO ValorConceptos;
     || valor de cada columna

     nValor = 0;
     aValor = "";

     #nomtmprf#0 = #nomtmpre#0;
     #nomtmprf#2 = #nomtmpre#2;
     #nomtmprf#21 = #nomtmpre#21;
     #nomtmprf#1 = #nomtmpre#1;
     #nomtmprf#41 = #nomtmpre#41;
     |SI #nomyrenm#14 = "H";
          #nomtmprf#19 = #nomyrenm#9;
     |SINO;
          #nomtmprf#19 = #nomtmpre#19;
     |FINSI;
     #nomtmprf#23 = #nomtmpre#23;
     #nomtmprf#7 = #nomtmprg#1;
     |LEE 000#nomtmprf.=;
     |SI FSalida = 0;
          nValor = #nomtmprf#11;
     |SINO;
          nValor = 0;
     |FINSI;

     |HAZ ColumnaExcel;
     |SI swNombres = 1;
          aValor = #nomtmprg#2;
          |QBF aValor;
          aAlfa = aLetraCol + nLinea + "," + aValor;
     |SINO;
          aAlfa = aLetraCol + nLinea + "," + nValor;
     |FINSI;

     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     || totaliza valor de cada columna

     |SI swNombres = 1;
          || no totalices nada, solo he entrado para el nombre
          || de las columnas

          || pero ya que estas, ponme el formato

          aRaizMacro = "M鏚ulo9.";
          aNombreMacro = "FormatoTitulo";
          aAlfa = aLetraCol + nLinea + "," + aRaizMacro + aNombreMacro;
          |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |SINO;
          |SI #nomres02#4 = "S";
               #nomtmapc#nCol# = #nomtmapc#nCol# + nValor;
               #nomtmape#nCol# = #nomtmape#nCol# + nValor;
               #nomtmapa#nCol# = #nomtmapa#nCol# + nValor;
               #nomtmapt#nCol# = #nomtmapt#nCol# + nValor;
          |FINSI;
     |FINSI;

     nCol = nCol + 1;
|FPRC;

|DEFBUCLE ValorConceptos;
     #nomtmprg#1;
     ;
     nEmpresa, 001;
     nEmpresa, 999;
     ;
     NULL, ValorConceptos;
|FIN;

|PROCESO ColumnaExcel;
     |SI nCol [ 26;
          nColLetra = nCol + 64;
          aLetraCol = &nColLetra;
     |SINO;
          |SI nCol [ 52;
               nNumeCol = (nCol - 26) + 64;
               aLetraCol = "A" + &nNumeCol;
          |SINO;
               |SI nCol [ 78;
                    nNumeCol = (nCol - 52) + 64;
                    aLetraCol = "B" + &nNumeCol;
               |SINO;
                    nNumeCol = (nCol - 78) + 64;
                    aLetraCol = "C" + &nNumeCol;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AhoraTodos;
     |SI swNuevo = 0; |ACABA; |FINSI;

     nEmpiezoPor = 4;
     |SI nOrdenTra = 3;
          nEmpiezoPor = 5;
     |FINSI;
     |PARA nCol = nEmpiezoPor; |SI nCol [ nNumColumnas; |HACIENDO nCol = nCol + 1;
          |SI nCol = nColConceptos;
               #nomres02#0 = enCuadre;
               #nomres02#1 = nCol;
               |LEE 000#nomres02.=;
               |BUCLE ValorConceptos;
               || cuando acabe sigo por la siguiente columna
          |FINSI;
          #nomres02#0 = enCuadre;
          |HAZ CampoColumna;
          |LEE 000#nomres02.=;
          |SI FSalida = 0;
               || valor de cada columna

               nCampo = #nomres02#2;
               nValor = #nomtmpre#nCampo#;
               |HAZ ColumnaExcel;
               aAlfa = aLetraCol + nLinea + "," + nValor;
               |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

               || totaliza valor de cada columna

               |SI #nomres02#4 = "S";
                    nCampo = #nomres02#2;
                    #nomtmapc#nCol# = #nomtmapc#nCol# + #nomtmpre#nCampo#;
                    #nomtmape#nCol# = #nomtmape#nCol# + #nomtmpre#nCampo#;
                    #nomtmapa#nCol# = #nomtmapa#nCol# + #nomtmpre#nCampo#;
                    #nomtmapt#nCol# = #nomtmapt#nCol# + #nomtmpre#nCampo#;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO GeneraHoja;
     swHaEntrado = 1;

     |SI nAntTra ! #nomtmpre#1; |Y nAntTra ! 0;
          |HAZ TotalesTrab;
     |FINSI;

     aArea = #nomtmpre#21;
     |QBF aArea;
     ||SI aAntArea ! "";
     || por la descripcion y no por el codigo, ya que si no tengo area
     || asignada, el area esta en blanco, en la descripcion le pongo
     || "sin area asignada"
     |SI aAntDesArea ! "";
     |Y aAntArea ! aArea;
          |HAZ TotalesArea;
     |FINSI;

     ||SI aAntArea ! ""; |Y aAntArea = aArea; |Y nAntCen ! #nomtmpre#2;
     || por la descripcion y no por el codigo, ya que si no tengo area
     || asignada, el area esta en blanco, en la descripcion le pongo
     || "sin area asignada"
     |SI aAntDesArea ! ""; |Y aAntArea = aArea; |Y nAntCen ! #nomtmpre#2;
          |HAZ TotalesArea;  || mismo codigo de area pero distinto centro
     |FINSI;

     |SI nAntCen ! 0; |Y nAntCen ! #nomtmpre#2;
          |HAZ Totales;
     |FINSI;

     nLinea = nLinea + 1;
     |SI swDesglose = 1;
          aValor = #nomtmpre#1; aValor = ("00000" + aValor) % -105;
          aAlfa1 = #nomtmpre#5; |QBF aAlfa1;
          aAlfa2 = #nomtmpre#3; |QBF aAlfa2;
          aValor = aValor + " - " + aAlfa1 + " (" + aAlfa2 + ")";
          |SI #nomtmpre#1 ! nAntTra;
               nCol = 65;
               aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               aRaizMacro = "M鏚ulo1.";
               aNombreMacro = "Gris_Negrita";
               aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          |FINSI;
          |SI #nomtmpre#41 ! nAntAny; |O #nomtmpre#1 ! nAntTra;
               nCol = 66;
               aAlfa = &nCol + nLinea + "," + #nomtmpre#41; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               aRaizMacro = "M鏚ulo1.";
               aNombreMacro = "Gris_Negrita";
               aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          |FINSI;
          nMes = #nomtmpre#19;
          |HAZ MesLetra;
          aValor = aMes;
          |SI #nomtmpre#23 = 1;
               aValor = aValor + " (Paga)";
          |FINSI;
          |SI #nomtmpre#23 = 2;
               aValor = aValor + " (Finiq.)";
          |FINSI;
          nCol = 67;
          aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SINO;
          nCol = 64
          |SI nOrdenTra = 3;
               aValor = #nomtmpre#37; aValor = ("0000" + aValor) % -104;
               nCol = nCol + 1;
               aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          |FINSI;
          aValor = #nomtmpre#1; aValor = ("00000" + aValor) % -105;
          |SI #nomtmpre#53 = "N";
               aValor = "00000";
          |FINSI;
          nCol = nCol+ 1;
          aAlfa = &nCol + nLinea + "," + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + #nomtmpre#5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          nCol = nCol + 1;
          aAlfa = &nCol + nLinea + "," + #nomtmpre#3; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     || totalizo la bonif. Horas form de los trabajadores
     || luego la reiniciare cuando pinte el total de la empresa
     nBonHorasForm = nBonHorasForm + #nomtmpre#45;

     |HAZ AntesTodos;
     |HAZ AhoraTodos;

     nAntEmp = #nomtmpre#0;
     nAntCen = #nomtmpre#2;
     aAntArea = #nomtmpre#21;
     |QBF aAntArea;
     aAntDesArea = #nomtmpre#22;
     |QBF aAntDesArea;
     nAntTra = #nomtmpre#1;
     nAntAny = #nomtmpre#41;
|FPRC;

|| ORDEN POR NUMERO DE REFERENCIA (ANTIGUA MATRICULA)

|DEFBUCLE GeneraHoja_3;
     #nomtmpre#3;
     ;
     #nomyrtmp#0, nDCen, "    ", 0000, 1999, nMesDesde, nTipoD, 00001;
     #nomyrtmp#0, nHCen, "zzzz", 9999, 2999, nMesHasta, nTipoH, 99999;
     ;
     NULL, GeneraHoja;
|FIN;

|DEFBUCLE GeneraHoja_meses_3;
     #nomtmpre#3;
     ;
     #nomyrtmp#0, nDCen, "    ", 0000, 1999, month, nPara, 00001;
     #nomyrtmp#0, nHCen, "zzzz", 9999, 2999, month, nPara, 99999;
     ;
     NULL, GeneraHoja;
|FIN;

|| ORDEN POR NOMBRE DE TRABAJADOR

|DEFBUCLE GeneraHoja_2;
     #nomtmpre#2;
     ;
     #nomyrtmp#0, nDCen, "    ", aDesdeTra, 1999, nMesDesde, nTipoD;
     #nomyrtmp#0, nHCen, "zzzz", aHastaTra, 2999, nMesHasta, nTipoH;
     ;
     NULL, GeneraHoja;
|FIN;

|DEFBUCLE GeneraHoja_meses_2;
     #nomtmpre#2;
     ;
     #nomyrtmp#0, nDCen, "    ", aDesdeTra, 1999, month, nPara;
     #nomyrtmp#0, nHCen, "zzzz", aHastaTra, 2999, month, nPara;
     ;
     NULL, GeneraHoja;
|FIN;

|| ORDEN POR CODIGO DE TRABAJADOR

|DEFBUCLE GeneraHoja_1;
     #nomtmpre#1;
     ;
     #nomyrtmp#0, nDCen, "    ", 00001, 1999, nMesDesde, nTipoD;
     #nomyrtmp#0, nHCen, "zzzz", 99999, 2999, nMesHasta, nTipoH;
     ;
     NULL, GeneraHoja;
|FIN;

|DEFBUCLE GeneraHoja_meses_1;
     #nomtmpre#1;
     ;
     #nomyrtmp#0, nDCen, "    ", 00001, 1999, month, nPara;
     #nomyrtmp#0, nHCen, "zzzz", 99999, 2999, month, nPara;
     ;
     NULL, GeneraHoja;
|FIN;

|PROCESO AntesNegrita;
     |SI swNuevo = 1; |ACABA; |FINSI;
     |SI swDesglose = 1;
          nCol = 65;
          aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 67;
     |SINO;
          nCol = 66;
     |FINSI;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
|FPRC;

|PROCESO AhoraNegrita;
     |SI swNuevo = 0; |ACABA; |FINSI;
     nCol = 1;
     |SI swDesglose = 1;
          nCol = 1; nColLetra = nCol + 64;
          aAlfa = &nColLetra + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = nCol + 2;
     |SINO;
          nCol = nCol + 1;
     |FINSI;

     |HAZ ColumnaExcel;
     aAlfa = aLetraCol + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     nNume = nNumColumnas - 1;
     |SI enCuadre = 52;
     |O enCuadre = 02;
     |O enCuadre = 12;
     |O enCuadre = 55;
          || no tiene conceptos, no lo tengo claro por que, pero asi es
          nNume = nNumColumnas;
     |FINSI;
     |PARA nCol = nCol; |SI nCol [ nNume; |HACIENDO nCol = nCol + 1;
          |HAZ ColumnaExcel;
          aAlfa = aLetraCol + nLinea + "," + aRaizMacro + aNombreMacro;
          |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |SIGUE;
|FPRC;

|PROCESO TotalesNEG;
     aRaizMacro = "M鏚ulo1.";
     aNombreMacro = "Gris_Negrita";
     |HAZ AntesNegrita;
     |HAZ AhoraNegrita;
|FPRC;

|PROCESO Totales3;
     |SI swDesglose = 1;
          |ACABA;
     |FINSI;

     |ABRE #nomtmpre;
     #nomtmpre#0 = nAntEmp;
     #nomtmpre#1 = 1;
     #nomtmpre#2 = 1;
     #nomtmpre#21 = "    ";
     |SI #0#17 = 2; |Y #0#14 = "A";     || atrasos por meses
          #nomtmpre#19 = 1;         || atrasos refundidos
     |SINO;
          #nomtmpre#19 = month;
     |FINSI;
     #nomtmpre#23 = nTipo;
     |SI nTipoD = nTipoH; |Y nTipoD = 2;
          #nomtmpre#23 = 2;
     |FINSI;

     |SI #nomtmpre#23 = 2;
          #nomtmpre#1 = nUnoTipo2;
          #nomtmpre#2 = nCentroTipo2;
     |FINSI;

     |LEE 101#nomtmpre.];
     nTC1Real = 0;
     nFormCont = 0;
     nTipoFormCont = 0;
     nTC1Real = #nomtmpre#20;
     nFormCont = #nomtmpre#42;
     nTipoFormCont = #nomtmpre#71;

     |SI nTipoD = 0; |Y nTipoH = 2; |Y swExcelSep = 0;
          || para leer el total real del tipo 2, caso de que
          || se pida del 0 al 2 junto

          #nomtmpre#23 = 2;
          #nomtmpre#1 = nUnoTipo2;
          #nomtmpre#2 = nCentroTipo2;
          |LEE 101#nomtmpre.];
          |SI #nomtmpre#23 = 2;
               || si realmente hay un tipo 2
               nTC1Real = nTC1Real + #nomtmpre#20;
               #nomtmpre#20 = nTC1Real;
               || ya la he leido antes
               || nFormCont = nFormCont + #nomtmpre#42;
               || #nomtmpre#42 = nFormCont;
          |FINSI;
     |FINSI;

     |CIERRA #nomtmpre;

     nLinea = nLinea + 1;

     |SI enCuadre = 55;
          nTotInf = 0;
          nBonHorasForm = 0;
          |ACABA;
     |FINSI;

     |||SI #nomtmpre#42 ! 0;
     || ojo, sustituyo aqui lo del #nomtmpre#42 por la variable, no entiendo el
     || sentido de poner el campo en lugar de la variable, ya que si hay
     || finiquito se queda a cero el campo al leerlo, cosa que no es correcta
     || viene por el 2884.3707
     |SI nFormCont ! 0;
          aRaizMacro = "M鏚ulo1.";
          aNombreMacro = "Gris_Negrita";

          nLinea = nLinea + 1;
          aCelda = "K";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          aCelda = "L";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          aCelda = "M";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          aCelda = "K";

          |SI nTipoFormCont = 1;
               aAlfa = aCelda + nLinea + ", Bonif. Formaci▋ Continua"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          |FINSI;
          |SI nTipoFormCont = 2;
               aAlfa = aCelda + nLinea + ", Permiso Individual Formaci▋"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          |FINSI;
          |SI nTipoFormCont = 3;
               aAlfa = aCelda + nLinea + ", Bonif. Formaci▋ Continua / PIF"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          |FINSI;
          aCelda = "N";
          ||aAlfa = aCelda + nLinea + "," + #nomtmpre#42; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aAlfa = aCelda + nLinea + "," + nFormCont; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

          ||nTotInf = nTotInf - #nomtmpre#42;
          nTotInf = nTotInf - nFormCont;
     |FINSI;

     nLinea = nLinea + 1;

     || BONIFICACION HORAS FORMACION
     |SI nBonHorasForm ! 0;
          aRaizMacro = "M鏚ulo1.";
          aNombreMacro = "Gris_Negrita";

          nLinea = nLinea + 1;
          aCelda = "E";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          aCelda = "F";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          aCelda = "G";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;

          aCelda = "E";
          aAlfa = aCelda + nLinea + ", Bonif. Formaci▋ Continua"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
          aCelda = "G";
          aAlfa = aCelda + nLinea + "," + nBonHorasForm; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

          nTC1Real = nTC1Real + nBonHorasForm;
          #nomtmpre#20 = #nomtmpre#20 + nBonHorasForm;
     |FINSI;

     aRaizMacro = "M鏚ulo1.";
     aNombreMacro = "Gris_Negrita";

     |SI swDesglose = 1;
          aCelda = "A";
     |SINO;
          |SI nOrdenTra = 3; |Y swDesglose = 0;
               aCelda = "C";
          |SINO;
               aCelda = "B";
          |FINSI;
     |FINSI;
     aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = aCelda + nLinea + ", Total RLC:"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SI swDesglose = 1;
          aCelda = "B";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          aCelda = "D";
     |SINO;
          aCelda = "C";
     |FINSI;
     aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |SI #nomtmpre#20 = -1; #nomtmpre#20 = 0; |FINSI;
     aAlfa = aCelda + nLinea + "," + #nomtmpre#20; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nLinea = nLinea + 1;

     |SI swDesglose = 1;
          aCelda = "A";
     |SINO;
          |SI nOrdenTra = 3; |Y swDesglose = 0;
               aCelda = "C";
          |SINO;
               aCelda = "B";
          |FINSI;
     |FINSI;
     aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     aAlfa = aCelda + nLinea + ", Total informe:"; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SI swDesglose = 1;
          aCelda = "B";
          aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |FINSI;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          aCelda = "D";
     |SINO;
          aCelda = "C";
     |FINSI;
     aAlfa = aCelda + nLinea + "," + aRaizMacro + aNombreMacro; |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
     |SI #nomtmpre#55 = 1;
          nTotInf = nTotInf + #nomtmpre#56;
     |FINSI;
     aAlfa = aCelda + nLinea + "," + nTotInf; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI #nomtmpre#55 = 1;
          aCelda = "D";
          aAlfa = #nomtmpre#56;
          aAlfa = aCelda + nLinea + ", Recargo de Mora (20%): " + aAlfa; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     nLinea = nLinea + 1;
     nTotInf = 0;
     nBonHorasForm = 0;
|FPRC;

|PROCESO AntesTotTrab;
     |SI swNuevo = 1; |ACABA; |FINSI;
     |SI swDesglose = 1;
          nCol = 65;
     |SINO;
          |SI nOrdenTra = 3; |Y swDesglose = 0;
               nCol = 67;
          |SINO;
               nCol = 66;
          |FINSI;
     |FINSI;
     aCelda = &nCol;

     aAlfa = aCelda + nLinea + ", Total TRABAJADOR: ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 68;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 69;
     |FINSI;

     aAlfa = &nCol + nLinea + "," + nTotTrabC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotTrabC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTrabC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nTotTrabC4 = 0;
     nTotTrabC5 = 0;
     nTotTrabC6 = 0;
     nTotTrabC7 = 0;
     nTotTrabC9 = 0;
     nTotTrabC10 = 0;
     nTotTrabC11 = 0;
     nTotTrabC12 = 0;
     nTotTrabC13 = 0;
     nTotTrabC14 = 0;
     nTotTrabC15 = 0;
     nTotTrabC16 = 0;
     nTotTrabC17 = 0;
|FPRC;

|PROCESO CampoColumna;
/*
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          #nomres02#1 = nCol - 1;
     |SINO;
*/
          |SI nColConceptos ! 0;
               |SI nCol ] nColConceptos; |Y nCol [ nFinConceptos
                    #nomres02#1 = nColConceptos;
               |SINO;
                    |SI nCol > nFinConceptos
                         #nomres02#1 = nCol - nNumConceptos + 1;
                    |SINO;
                         #nomres02#1 = nCol;
                    |FINSI;
               |FINSI;
          |SINO;
               #nomres02#1 = nCol;
          |FINSI;
     ||FINSI;
|FPRC;

|PROCESO AhoraTotTrab;
     |SI swNuevo = 0; |ACABA; |FINSI;

     |SI swDesglose = 1;
          nCol = 1;
     |SINO;
          |SI nOrdenTra = 3; |Y swDesglose = 0;
               nCol = 3;
          |SINO;
               nCol = 2;
          |FINSI;
     |FINSI;
     |HAZ ColumnaExcel;

     aAlfa = aLetraCol + nLinea + ", Total TRABAJADOR: ";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 4;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 5; || se corre todo una columna!
     |FINSI;

     |PARA nCol = nCol; |SI nCol [ nNumColumnas; |HACIENDO nCol = nCol + 1;
          #nomres02#0 = enCuadre;
          |HAZ CampoColumna;
          |LEE 000#nomres02.=;
          |SI FSalida = 0;
               |SI #nomres02#4 = "S";
                    nCampo = #nomres02#2;
                    nValor = #nomtmapt#nCol#;
                    |HAZ ColumnaExcel;
                    aAlfa = aLetraCol + nLinea + "," + nValor;
                    |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               |FINSI;
          |FINSI;
     |SIGUE;

     |DDEFECTO #nomtmapt;
|FPRC;

|PROCESO TotalesTrab;
     |SI swDesglose ! 1;
          |ACABA;
     |FINSI;

     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;

     |HAZ AntesTotTrab;
     |HAZ AhoraTotTrab;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO AntesTotArea;
     |SI swNuevo = 1; |ACABA; |FINSI;
     nCol = 66;
     aCelda = &nCol;

     aAlfa = aCelda + nLinea + ", Total AREA: " + aAntArea + " - " + aAntDesArea;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = 68;
     |SI nOrdenTra = 3;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotAreaC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotAreaC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotAreaC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nTotAreaC4 = 0;
     nTotAreaC5 = 0;
     nTotAreaC6 = 0;
     nTotAreaC7 = 0;
     nTotAreaC9 = 0;
     nTotAreaC10 = 0;
     nTotAreaC11 = 0;
     nTotAreaC12 = 0;
     nTotAreaC13 = 0;
     nTotAreaC14 = 0;
     nTotAreaC15 = 0;
     nTotAreaC16 = 0;
     nTotAreaC17 = 0;
|FPRC;

|PROCESO AhoraTotArea;
     |SI swNuevo = 0; |ACABA; |FINSI;
     nCol = 2;
     |SI nOrdenTra = 3;
          nCol = 3;
     |FINSI;
     nColLetra = nCol + 64;
     aCelda = &nColLetra;

     aAlfa = aCelda + nLinea + ", Total AREA: " + aAntArea + " - " + aAntDesArea;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nCol = 4;
     |SI nOrdenTra = 3;
          nCol = 3;
     |FINSI;

     |PARA nCol = nCol; |SI nCol [ nNumColumnas; |HACIENDO nCol = nCol + 1;
          #nomres02#0 = enCuadre;
          |HAZ CampoColumna;
          |LEE 000#nomres02.=;
          |SI FSalida = 0;
               |SI #nomres02#4 = "S";
                    nCampo = #nomres02#2;
                    nValor = #nomtmapa#nCol#;
                    |HAZ ColumnaExcel;
                    aAlfa = aLetraCol + nLinea + "," + nValor;
                    |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               |FINSI;
          |FINSI;
     |SIGUE;

     |DDEFECTO #nomtmapa;
|FPRC;

|PROCESO TotalesArea;
     |SI aRupAreas ! "S";
          |ACABA;
     |FINSI;

     nLinea = nLinea + 2;

     || TOTALES EN GRIS Y NEGRITA

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;

     |HAZ AntesTotArea;
     |HAZ AhoraTotArea;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO AntesTotEmp;
     |SI swNuevo = 1; |ACABA; |FINSI;
     nCol = 68;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nTotInf = nTotTotC13 +  nTotTotC11 - nTotTotC4;

     nTotTotC4 = 0;
     nTotTotC5 = 0;
     nTotTotC6 = 0;
     nTotTotC7 = 0;
     nTotTotC9 = 0;
     nTotTotC10 = 0;
     nTotTotC11 = 0;
     nTotTotC12 = 0;
     nTotTotC13 = 0;
     nTotTotC14 = 0;
     nTotTotC15 = 0;
     nTotTotC16 = 0;
     nTotTotC17 = 0;
|FPRC;

|PROCESO AhoraTotEmp;
     |SI swNuevo = 0; |ACABA; |FINSI;
     nCol = 4;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 5;
     |FINSI;

     nTotalSSTra = 0;
     nTotalPrest = 0;
     nTotalSSEmp = 0;

     |PARA nCol = nCol; |SI nCol [ nNumColumnas; |HACIENDO nCol = nCol + 1;
          #nomres02#0 = enCuadre;
          |HAZ CampoColumna;
          |LEE 000#nomres02.=;
          |SI FSalida = 0;
               |SI #nomres02#4 = "S";
                    nCampo = #nomres02#2;
                    nValor = #nomtmape#nCol#;
                    |HAZ ColumnaExcel;
                    aAlfa = aLetraCol + nLinea + "," + nValor;
                    |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               |FINSI;

               |SI #nomres02#2 = 14; nTotalSSTra = nValor; |FINSI;
               |SI #nomres02#2 = 17; nTotalSSEmp = nValor; |FINSI;
               |SI #nomres02#2 = 7; nTotalPrest = nValor; |FINSI;
          |FINSI;
     |SIGUE;
     nTotInf = nTotalSSEmp + nTotalSSTra - nTotalPrest;

     |DDEFECTO #nomtmape;
|FPRC;

|PROCESO Totales2;
     nLinea = nLinea + 2;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;

     |SI swDesglose = 1;
          nCol = 65;
          aCelda = &nCol;
     |SINO;
          |SI nOrdenTra = 3; |Y swDesglose = 0;
               nCol = 67;
          |SINO;
               nCol = 66;
          |FINSI;
          aCelda = &nCol;
     |FINSI;
     aAlfa = aCelda + nLinea + ", Total EMPRESA:";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |HAZ AntesTotEmp;
     |HAZ AhoraTotEmp;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO AntesTotCen;
     |SI swNuevo = 1; |ACABA; |FINSI;
     nCol = 68;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 69
     |FINSI;
     aAlfa = &nCol + nLinea + "," + nTotC4; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC5; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC6; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC7; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 2;
     aAlfa = &nCol + nLinea + "," + nTotC9; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC10; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC11; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC12; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC13; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC14; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     nCol = nCol + 1;
     aAlfa = &nCol + nLinea + "," + nTotC15; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nTotC4 = 0;
     nTotC5 = 0;
     nTotC6 = 0;
     nTotC7 = 0;
     nTotC9 = 0;
     nTotC10 = 0;
     nTotC11 = 0;
     nTotC12 = 0;
     nTotC13 = 0;
     nTotC14 = 0;
     nTotC15 = 0;
     nTotC16 = 0;
     nTotC17 = 0;
|FPRC;

|PROCESO AhoraTotCen;
     |SI swNuevo = 0; |ACABA; |FINSI;
     nCol = 4;
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 5;
     |FINSI;

     |PARA nCol = nCol; |SI nCol [ nNumColumnas; |HACIENDO nCol = nCol + 1;
          #nomres02#0 = enCuadre;
          |HAZ CampoColumna;
          |LEE 000#nomres02.=;
          |SI FSalida = 0;
               |SI #nomres02#4 = "S";
                    nCampo = #nomres02#2;
                    nValor = #nomtmapc#nCol#;
                    |HAZ ColumnaExcel;
                    aAlfa = aLetraCol + nLinea + "," + nValor;
                    |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               |FINSI;
          |FINSI;
     |SIGUE;

     |DDEFECTO #nomtmapc;
|FPRC;

|PROCESO Totales;
     nLinea = nLinea + 2;

     #labcentr#0 = #labempre#0;
     #labcentr#1 = nAntCen;
     |LEE 000#labcentr.=;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          || desglosado no va bien la ejecucion de macros por hojas
     |SINO;
          |HAZ TotalesNEG;
     |FINSI;
     |SI swDesglose = 1;
          nCol = 65;
          aCelda = &nCol;
     |SINO;
          |SI nOrdenTra = 3;
               nCol = 67;
          |SINO;
               nCol = 66;
          |FINSI;
          aCelda = &nCol;
     |FINSI;
     aAlfa = #labcentr#2;
     |QBF aAlfa;
     aAlfa1 = #labcentr#10;
     |QBF aAlfa1;
     |SI aAlfa1 = "";
          aAlfa1 = #labempre#13;
          |QBF aAlfa1;
     |FINSI;
     aAlfa = aAlfa + " (CCC: " + aAlfa1 + ")";
     aAlfa = aCelda + nLinea + ", Total Centro " + nAntCen + " - " + aAlfa + ":";
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |HAZ AntesTotCen;
     |HAZ AhoraTotCen;

     nLinea = nLinea + 1;
|FPRC;

|PROCESO MesLetra;
     |SI nMes = 1;  aMes = "ENERO";          |FINSI;
     |SI nMes = 2;  aMes = "FEBRERO";        |FINSI;
     |SI nMes = 3;  aMes = "MARZO";          |FINSI;
     |SI nMes = 4;  aMes = "ABRIL";          |FINSI;
     |SI nMes = 5;  aMes = "MAYO";           |FINSI;
     |SI nMes = 6;  aMes = "JUNIO";          |FINSI;
     |SI nMes = 7;  aMes = "JULIO";          |FINSI;
     |SI nMes = 8;  aMes = "AGOSTO";         |FINSI;
     |SI nMes = 9;  aMes = "SEPTIEMBRE";     |FINSI;
     |SI nMes = 10; aMes = "OCTUBRE";        |FINSI;
     |SI nMes = 11; aMes = "NOVIEMBRE";      |FINSI;
     |SI nMes = 12; aMes = "DICIEMBRE";      |FINSI;
|FPRC;

|PROCESO AhoraNombresCol;
     |SI swNuevo = 0; |ACABA; |FINSI;
     nCol = 1;
     /*
     |SI nOrdenTra = 3; |Y swDesglose = 0;
          nCol = 2; || se corre todo una columna!
     |FINSI;
     */
     |PARA nCol = nCol; |SI nCol [ nNumColumnas; |HACIENDO nCol = nCol + 1;
          |SI nCol = nColConceptos;
               swNombres = 1;
|| xxxxxxxxxxxxx
               |BUCLE ValorConceptos;
               swNombres = 0;
               || cuando acabe sigo por la siguiente columna
          |FINSI;
          #nomres02#0 = enCuadre;
          |HAZ CampoColumna;
          |LEE 000#nomres02.=;
          |SI FSalida = 0;
               aValor = #nomres02#3;
               |QBF aValor;
               |HAZ ColumnaExcel;
               aAlfa = aLetraCol + nLinea + "," + aValor;
               |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               aRaizMacro = "M鏚ulo9.";
               aNombreMacro = "FormatoTitulo";
               aAlfa = aLetraCol + nLinea + "," + aRaizMacro + aNombreMacro;
               |ALFACALLDLL "agixl97.dll","ejecuta_celda", aAlfa;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Cabecera;
     nHoja = month;
     aHoja = nHoja;
     aHoja = ("00" + aHoja) % -102;
     aHoja = "Mes " + aHoja;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aHoja;

     aValor = "INFORME DE COSTES";
     |SI enCuadre = 55;
          aValor = "Informe de cuotas para solicitud de aplazamientos";
     |FINSI;
     |SI swDesglose = 1;
          aAlfa = "A1, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SINO;
          |SI nOrdenTra = 3;
               aCelda = "C1";
          |SINO;
               aCelda = "B1";
          |FINSI;
          aAlfa = aCelda + ", " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;
     |SI eaFuente = "M";
          nMes = #0#15;
          |HAZ MesLetra;
          aMeses = aMes;
          aAlfa = #0#16;
          aMeses = aMeses + "  " + aAlfa;
     |SINO;
          |SI enDesdeMes = enHastaMes; |Y #0#5 = #0#10;
               nMes = enDesdeMes;
               |HAZ MesLetra;
               aMeses = aMes;
               nNume = #0#5 + 2000;
               |SI aNomPag = "P";
                    nNume = #nomyrpac#5 + 2000;
               |FINSI;
               aAlfa = nNume;
               aMeses = aMeses + "  " + aAlfa;
          |SINO;
               nMes = enDesdeMes;
               |HAZ MesLetra;
               aMeses = aMes;
               nNume = #0#5 + 2000;
               aAlfa = nNume;
               aMeses = aMeses + "  " + aAlfa;

               nMes = enHastaMes;
               |HAZ MesLetra;
               aMeses = aMeses + " - " + aMes;
               nNume = #0#10 + 2000;
               aAlfa =nNume;
               aMeses = aMeses + "  " + aAlfa;
          |FINSI;
     |FINSI;

     fFecha = ~;
     aFecha = fFecha;
     |HORA aHora;

     aValor = aMeses + "      " + aFecha;
     |SI nOrdenTra = 3;
          aCelda = "F1";
     |SINO;
          aCelda = "E1";
     |FINSI;
     aAlfa = aCelda + ", " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aCelda = "E2";
     |SI nTipoOriD = nTipoOriH;
          |SI nTipoD = 0;
               aValor = "N▌inas mes";
          |FINSI;
          |SI nTipoH = 2;
               aValor = "Finiquitos mes";
          |FINSI;
     |SINO;
          |SI #0#32 = 1;
               |SI nTipo = 0;
                    aValor = "N▌inas mes";
               |FINSI;
               |SI nTipo = 2;
                    aValor = "Finiquitos mes";
               |FINSI;
          |SINO;
               aValor = "N▌inas mes";
          |FINSI;
     |FINSI;
     |SI nTipoOriD ] 5;
          aValor = "Atrasos";
     |FINSI;
     |SI enCuadre = 52; |O aNomPag = "P";
          aValor = "Pagas extraordinarias";
     |FINSI;
     aAlfa = aCelda + ", " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     |SI #0#14 = "M"; |O #0#14 = "H";
          |SI swPagasSN = 2;
               |SI #0#4 = 0; |Y #0#19 = 0;
                    aValor = " Pagas incluidas";
                    |SI nOrdenTra = 3;
                         aCelda = "F3";
                    |SINO;
                         aCelda = "E3";
                    |FINSI;
                    aAlfa = aCelda + ", " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;

     aValor = #labempre#0; aValor = ("00000" + aValor) % -105;
     aValor = aValor + " - "  + #labempre#2;

     || aValor = #labempre#10; |QBF aValor;
     |SI swDesglose = 1;
          aAlfa = "A3, " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |SINO;
          |SI nOrdenTra = 3;
               aCelda = "C3";
          |SINO;
               aCelda = "B3";
          |FINSI;
          aAlfa = aCelda + ", " + aValor; |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     nLinea = 6;
     |HAZ AhoraNombresCol;
|FPRC;

|PROCESO CompletaNombre;
          aAlfa = "";
          aAlfa1 = "";        ||   Empresa + Centro;
          aAlfa2 = "";        || Desde a寸
          aAlfa3 = "";        || Hasta a寸
          aAlfa4 = "";        || Desde Mes
          aAlfa5 = "";        || Hasta Mes
          aPerTipo = "";

          aAlfa1 = #labempre#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;

          |SI enPorCen = 1;
              aAlfa1 = aAlfa1 + "_" + (("000" + #nomystmp#1) % -103);
          |FINSI;

          |SI #0#14 = "M"; |O #0#14 = "A";
               nNume= #0#16;
               aAlfa2 = nNume;
          |SINO;
               |SI #0#5 = #0#10;
                    nNume = #0#5 + 2000;
                    aAlfa2 = nNume;
               |SINO;
                    nNume2 = #0#5 + 2000; nNume3 = #0#10 + 2000;
                    aAlfa2 = nNume2; aAlfa3 = nNume3;
               |FINSI;
          |FINSI;

          || Mes
          |SI #0#14 = "M";
               nNume = #0#15;
               aAlfa4 = nNume; |QBF aAlfa4; aAlfa4 = ("00" + aAlfa4) % -102;
          |SINO;
               |SI #0#2 = #0#9;
                    nNume = #0#2;
                    aAlfa4 = nNume; |QBF aAlfa4; aAlfa4 = ("00" + aAlfa4) % -102;
               |SINO;
                    nNume = #0#2;
                    aAlfa4 = nNume; |QBF aAlfa4; aAlfa4 = ("00" + aAlfa4) % -102;
                    nNume = #0#9;
                    aAlfa5 = nNume; |QBF aAlfa5; aAlfa5 = ("00" + aAlfa5) % -102;
               |FINSI;
          |FINSI;

          aPerTipo = "_" + aAlfa1;

          |SI aAlfa3 = "";
               aPerTipo = aPerTipo + "_" + aAlfa2;
               aPerTipo = aPerTipo + "_" + aAlfa4 + aAlfa5;
          |SINO;
               |SI aAlfa5 = "";
                    aPerTipo = aPerTipo + "_" aAlfa2 + aAlfa4 + "_" + aAlfa3 + aAlfa4;
               |SINO;
                    aPerTipo = aPerTipo + "_" aAlfa2 + aAlfa4 + "_" + aAlfa3 + aAlfa5;
               |FINSI;
          |FINSI;

          |SI nTipoD = nTipoH;
               aTipo = nTipo; |QBF aTipo; aTipo = ("00" + aTipo) % -102;
               aPerTipo = aPerTipo + "_" + aTipo;
          |SINO;
               aTipo1 = nTipo1; |QBF aTipo1; aTipo1 = ("00" + aTipo1) % -102;
               aTipo2 = nTipo2; |QBF aTipo2; aTipo2 = ("00" + aTipo2) % -102;
               aPerTipo = aPerTipo + "_" + aTipo1 + aTipo2;
          |FINSI;
|FPRC;

|PROCESO CuentaConceptos;
     nNumConceptos = nNumConceptos + 1;
|FPRC;

|DEFBUCLE CuentaConceptos;
     #nomtmprg#1;
     ;
     #labempre#0, 001;
     #labempre#0, 999;
     ;
     NULL, CuentaConceptos;
|FIN;

|PROCESO Columnas;
     nNumColumnas = nNumColumnas + 1;
     |SI #nomres02#2 = 256;
          nColConceptos = #nomres02#1;
     |FINSI;
|FPRC;

|DEFBUCLE Columnas;
     #nomres02#1;
     ;
     enCuadre, 01;
     enCuadre, 99;
     ;
     NULL, Columnas;
|FIN;

|PROCESO RastreaConceptos;
     || primero busco si esta el 256 entre los campos del informe
     || si lo esta, me tengo que quedar con:
     || en que posicion (columna)
     || cuantas columnas me a兀de

     nNumColumnas = 0;        || el numero de columnas del informe
     nColConceptos = 0;       || la columna a partir de la que saldran los conceptos
     nNumConceptos = 0;       || cuantos conceptos son (columnas que se a兀diran)
     nFinConceptos = 0;       || columna en la que acaban los conceptos
     |BUCLE Columnas;
     |SI nColConceptos ! 0;
          swCuenta = 1;
          |BUCLE CuentaConceptos;
          swCuenta = 0;
     |FINSI;

     nNumColumnas = nNumColumnas + nNumConceptos;
     nFinConceptos = nColConceptos + nNumConceptos - 1;

     ||CONSULTA_CLAVE #1#nomtmprg;
|FPRC;

|PROCESO ArchivaExcel;
     eaInforme = "ResumenExcel";
     eaHojaExcel = aCopia;
     |HAZ IMPREArchi;
|| xxxxxxxxxxxx
     |HAZ Mensaje;           || mensaje de envio al dsarchi
     |SI nTipo = 2;
          enSwFiniq = 1;
     |SINO;
          enSwFiniq = 0;
     |FINSI;

     |SI enPorCen = 1;
         enCen = #nomystmp#1;
         eaCen = #nomystmp#2;
     |FINSI;
     |HAZ Archivando;
|FPRC;

|PROCESO Borrado;
     aAlfa = aDestinoTrab + "/*.*";
     |R_PDIR aAlfa;
     |SI FSalida = 0;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa1 = aAlfa;
               |RFBORRA aAlfa1;
               |R_SDIR aAlfa;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Excel;

     aDestinoTrab = "C:\DOCUMENTOS\Resumen";         |RMKDIR aDestinoTrab;
     aAlfa = aDestinoTrab + "\plantilla.xls";
     aDestino = aDestinoTrab + "\trabajo.xls";

     |RCOPIA_FICHERO aAlfa, aDestino;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDestino;

     |SI enTipoInf = 1; |Y eaFuente = "A"
          |PARA month = 1; |SI month [ 12; |HACIENDO month = month + 1;
               swHaEntrado = 0;
               nLinea = 0;
               |HAZ Cabecera;
               |SI nOrdenTra = 1;
                    |BUCLE GeneraHoja_meses_1;
               |FINSI;
               |SI nOrdenTra = 2;
                    |BUCLE GeneraHoja_meses_2;
               |FINSI;
               |SI nOrdenTra = 3;
                    |BUCLE GeneraHoja_meses_3;
               |FINSI;

               || TOTALES

               |SI swHaEntrado = 1;
                    |HAZ TotalesTrab;  || el del ultimo trabajador siempre
                    |HAZ TotalesArea;  || el del ultimo area siempre
                    |HAZ Totales;      || el del ultimo centro siempre
                    |HAZ Totales2;
                    |HAZ Totales3;
               |FINSI;
          |SIGUE;
     |SINO;
          swHaEntrado = 0;
          nLinea = 0;

          || primero compruebo a ver que conceptos han de salir y cuales no
          || los que no tengan importe en ningun trabajador no deben salir

          |SI enCuadre ] 50;
          |O enCuadre ] 02;
               |HAZ RastreaConceptos;
          |FINSI;
|| xxxxxxxxxxxxxxx
          |HAZ Cabecera;

          || aqui hay que ver si tipo 0 y 2 juntos o separado

          nMesDesde = 01;
          nMesHasta = 12;

          |SI swDesglose = 1;
               nMesDesde = 01;
               nMesHasta = 12;
          |SINO;
               |SI swExcelSep = 1;
                    nTipoD = nTipo;
                    nTipoH = nTipo;
               |FINSI;
          |FINSI;

          |SI nOrdenTra = 1
               |BUCLE GeneraHoja_1;
          |FINSI;
          |SI nOrdenTra = 2;
               |BUCLE GeneraHoja_2;
          |FINSI;
          |SI nOrdenTra = 3;
               |BUCLE GeneraHoja_3;
          |FINSI;

          || TOTALES

          |SI swHaEntrado = 1;
               |HAZ TotalesTrab;  || el del ultimo trabajador siempre
               |HAZ TotalesArea;  || el del ultimo area siempre
               |HAZ Totales;  || el del ultimo centro siempre
               |HAZ Totales2;
               |HAZ Totales3;
          |FINSI;
     |FINSI;

     aAlfa   = aDestinoTrab + "\" + aHojaExcel;
     |RFBORRA aAlfa;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;
     aResultado = aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";

     aDestino   = aDestinoTrab + "\trabajo.xls";
     |RFBORRA aDestino;

     |SI enCuadre ] 50; |O enCuadre = 02; |O enCuadre = 12;
          |SI enCuadre ] 50; |O enCuadre = 02;
               aCopia = aResultado - "_par.xls";
          |FINSI;

          |SI enCuadre = 12;
               aCopia = aResultado - "_par_ref.xls";
          |FINSI;
          |HAZ CompletaNombre;

          aCopia = aCopia + aPerTipo + ".xls";

          |RCOPIA_FICHERO aResultado, aCopia;
          |SI swArchivaExcel = 1;
               |HAZ ArchivaExcel;
          |SINO;
               aVersion1 = "Excel.Sheet";
               |ESPECIFICA "VERSION_PROGRAMA", aVersion;
               |HAZ ExtraePath;
               |SI aPath = "NO LOCALIZADO";
                   |MENAV "0000 Se ha producido un error en la conexi鏮 con Excel";
                   |ACABA;
               |FINSI;

               |QBF aPath;

               || aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
               || aAlfa = "cmd " + &34 + "/c START /WAIT " + aCopia + &34;
               aAlfa = "cmd " + &34 + "/c START " + aCopia + &34;
               |RSYSTEM aAlfa;
          |FINSI;
     |SINO;
          aVersion1 = "Excel.Sheet";
          |ESPECIFICA "VERSION_PROGRAMA", aVersion;
          |HAZ ExtraePath;
          |SI aPath = "NO LOCALIZADO";
              |MENAV "0000 Se ha producido un error en la conexi鏮 con Excel";
              |ACABA;
          |FINSI;

          |QBF aPath;

          || aAlfa  = "cmd " + &34 + "/c START /WAIT " + aPath + " " + aAlfa + &34;
          aAlfa = "cmd " + &34 + "/c START /WAIT " + aResultado + &34;
          |RSYSTEM aAlfa;
     |FINSI;

     |CIERRA #nomtmpre;
|FPRC;

|PROCESO nomyrtmp;
     |ABRE #labempre;
     |ABRE #labcentr;
     |ABRE #nomres02;

     nDCen = 0;
     nHCen = 999;

     aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_nomtmprg_" + aAlfa;
     |NOME_DAT #nomtmprg#aAlfa#;
     |ABRE #nomtmprg;

     #labempre#0 = #nomyrtmp#0;
     |LEE 000#labempre.=;

     nEmpresa = #labempre#0;

     nAntEmp = 0;
     nAntCen = 0;
     nAntTra = 0;
     nAntAny = 0;
     aAntArea = "";
     aAntDesArea = "";

     |SI swExcelSep = 1;
          |PARA nTipo = 0; |SI nTipo [ 2; |HACIENDO nTipo = nTipo + 2;
               |HAZ Excel;
          |SIGUE;
     |SINO;
          |HAZ Excel;
     |FINSI;

     |CIERRA #nomtmprg;
     |CIERRA #nomres02;
     |CIERRA #labcentr;
     |CIERRA #labempre;
|FPRC;

|DEFBUCLE nomyrtmp;
     #nomyrtmp#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomyrtmp;
|FIN;

|PROCESO nomystmp;
     |ABRE #labempre;
     |ABRE #labcentr;
     |ABRE #nomres02;

     #nomyrtmp#0 = #nomystmp#0;
     nDCen       = #nomystmp#1;
     nHCen       = #nomystmp#1;

     aAlfa = Usuario; |QBT aAlfa; aAlfa = "tm_nomtmprg_" + aAlfa;
     |NOME_DAT #nomtmprg#aAlfa#;
     |ABRE #nomtmprg;

     #labempre#0 = #nomystmp#0;
     |LEE 000#labempre.=;

     nEmpresa = #labempre#0;

     nAntEmp = 0;
     nAntCen = 0;
     nAntTra = 0;
     nAntAny = 0;
     aAntArea = "";
     aAntDesArea = "";

     |SI swExcelSep = 1;
          |PARA nTipo = 0; |SI nTipo [ 2; |HACIENDO nTipo = nTipo + 2;
               |HAZ Excel;
          |SIGUE;
     |SINO;
          |HAZ Excel;
     |FINSI;

     |CIERRA #nomtmprg;
     |CIERRA #nomres02;
     |CIERRA #labcentr;
     |CIERRA #labempre;
|FPRC;

|DEFBUCLE nomystmp;
     #nomystmp#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, nomystmp;
|FIN;

|PROCESO ProcesosExcel;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar la DLL de Excel.";
          |ACABA;
     |FINSI;
     |SI enTipoInf = 1; |Y eaFuente = "A"
          aHojaExcel = "informe_costes_atrasos.xls"
     |SINO;
          |SI enCuadre ! 04;
               |SI swDesglose = 1;
                    aHojaExcel = "informe_costes_trabajador.xls"
               |SINO;
                    |SI nOrdenTra = 1; |O nOrdenTra = 2;
                         aHojaExcel = "informe_costes.xls"
                    |SINO;
                         aHojaExcel = "informe_costes_ref.xls"
                    |FINSI;
               |FINSI;
               |SI enCuadre ] 50; |O enCuadre = 02;
                    aHojaExcel = "informe_costes_par.xls"
               |FINSI;
               |SI enCuadre = 12;
                    || con numero de referencia, una columna mas
                    aHojaExcel = "informe_costes_par_ref.xls"
               |FINSI;
          |SINO;
               aHojaExcel = "informe_costes_04.xls"
          |FINSI;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "documentos/" + aHojaExcel;
     aDestinoTrab = "C:\DOCUMENTOS\Resumen";         |RMKDIR aDestinoTrab;
     |HAZ Borrado;
     aDestino = aDestinoTrab + "\plantilla.xls";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
          |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
          |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |SI enPorEmp = 1;  |Y swExcelSep = 0;
         |BUCLE nomyrtmp;
     |FINSI;

     |SI enPorCen = 1;  |Y swExcelSep = 0;
         |BUCLE nomystmp;
     |FINSI;

     |DESCARGADLL "agixl97.dll";
|FPRC;

|PROCESO ElInforme;
     |SI enCuadre ] 50; |O enCuadre = 02;
          swNuevo = 1;
     |FINSI;

     |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
     swPorAqui = 0;
     |SI informe = "nomyrweb"; |Y enCuadre = 00;
          || se pide el .inf o se pide desde internet
          |ACABA;
     |FINSI;
     |SI enCuadre = 00;
          |SI informe = "nomyren2"; |O informe = "nomyren4";
               || normal, cuadre 00 en Crystal
               swPorAqui = 1;
          |FINSI;
     |FINSI;
     |SI enCuadre = 03;
          || normal, cuadre 03 en Crystal
          swPorAqui = 1;
     |FINSI;
     |SI enCuadre = 02; |Y nOrdenTra = 3;
          || con numero de referencia, una columna mas
          enCuadre = 12;
     |FINSI;
     |SI enCuadre = 01;
          |ACABA;
     |FINSI;
     |SI swPorAqui = 1;
          |SI enTipoInf = 1; |Y eaFuente = "A"
               || ATRASOS: un mes en cada pagina
               || nada de imprimir un mes tras otro
               |SI informe = "nomyren2"; |O informe = "nomyren4";
                    |SI #nomcontr#56 = "S"; |O #nomyrenm#36 = "S"; |O #nomyrpac#22 = "S";
                         ||HAZ IniciaRegistro;
                    |FINSI;
               |FINSI;

               nDesdeEmp = 00001;
               nHastaEmp = 99999;
               |BUCLE nomtmpre_meses;

               |SI informe = "nomyren2"; |O informe = "nomyren4";
                    |SI #nomcontr#56 = "S"; |O #nomyrenm#36 = "S"; |O #nomyrpac#22 = "S";
                         ||HAZ AcabaRegistro;
                    |FINSI;
               |FINSI;
          |SINO;
               || nomina, paga o atrasos todo junto
               || normal en definitiva

               |SI aNomPag = "P";
                    month = 1;
                    nPara = 0;
               |FINSI;

               swHayAlgo = 0;
               |SI informe = "nomyren2"; |O informe = "nomyren4";
                    |SI #nomcontr#56 = "S"; |O #nomyrenm#36 = "S"; |O #nomyrpac#22 = "S";
                         ||HAZ IniciaRegistro;
                    |FINSI;
               |FINSI;

               |SI swDesglose = 1;
                    nMesDesde = 01;
                    nMesHasta = 12;
               |SINO;
                    nMesDesde = 01;
                    nMesHasta = 12;
               |FINSI;

               nDesdeEmp = 00001;
               nHastaEmp = 99999;
               |BUCLE nomtmpre;    || normal

               |SI informe = "nomyren2"; |O informe = "nomyren4";
                    |SI #nomcontr#56 = "S"; |O #nomyrenm#36 = "S"; |O #nomyrpac#22 = "S";
                         ||HAZ AcabaRegistro;
                    |FINSI;
               |FINSI;
          |FINSI;
          |ACABA;
     |FINSI;

     |SI enCuadre ! 10;
          swExcelSep = 0;
          |SI nTipoD = 0; |Y nTipoH = 2; |Y #0#32 = 1; |Y swDesglose = 0;
               swExcelSep = 1;
          |SINO;
               |SI aNomPag = "P";
                    month = 1;
                    nPara = 0;
               |FINSI;
          |FINSI;

          || lanzo el bucle para todas las empresas de la seleccion de las que
          || se haya guardado algun trabajador

          |HAZ ProcesosExcel;
     |SINO;
          |HAZ xml;
     |FINSI;
|FPRC;
