|FICHEROS;
     nomcalir #00;      || pantalla calculo
     ||nomescli #23;      || escala IRPF
     nomhicca #50;      || historico cabs.
     nomhicli #51;      || historico lins.
     ||nomfichp #52;      || mantenimiento calculo IRPF
     ||nomhirpf #53;      || historico IRPF
     nomir009;
     nomtrali;
     nomconca;
     nomvarli;
     nomir012;
     labempre;

     nomir016 #201;
|FIN;

|VARIABLES;
     &runnom = "nomcalir";
     &b_irpf = 0;
     &segsoc = 0;
     &falta_m = 0;
     &fecalta = "";
     &fecbaja = "";
     &fecsys1 = @;
     &fecsys2 = @;
     &gbaja_m = 0;
     &mensaje3 = "    ATENCION !!! Trabajador sin fecha de alta ...";
     &meses = 0;
     &p_irpf = 0;
     &pintado = 0;
     &sw_esca = 0;
     &sw_incom = 0;
     &t_irpf = 0;
     || &nomtmpca = "nomtmpca";
     || &nomtmpli = "nomtmpli";
     &nomtmpca = "";
     &nomtmpli = "";
     &p_cen = 0;

     &los_meses = 0;
     &el_anyo = 0;
     &sw_historico = 0;
     &no_alta = 0;
     &var_mes = 0;
     &var_imp = 0;
     &var_top = 0;

     &nCalculo99 = 0;
     &nEmpr99 = 0;
     &nTrab99 = 0;
     &nAnyo99 = 0;
     &nEstima = 0;
     &nSeguri = 0;
     &aFeAlta = "";
     &aFeBaja = "";
     &nDTipo = 0;
     &nHTipo = 0;
     &nEsteMes = 0;
     &el_anyoAnt = 0;
     &nVariable = 0;
     &nMesesVar = 0;
     &nDiasIT = 0;
     &swFiniq = 0;
     &swMesBaja = 0;
     &aPathDef = "";
     &aPathFich = "";
     &aBaseD = "";
     &nBaseEste2 = 0;
     &nRetenEste2 = 0;
     &eaVengoDe = "";
     &swAgrario = 0;
     &nTraAgr = 0;
     &nEmpAgr = 0;
     &nMesAgr = 0;
     &nAnyAgr = 0;
     &nJorAgr = 0;
     &aParam = "";
     || nDesdeMes = 0;
     || nHastaMes = 0;
     &nMesPago = 0;
     nDesdeDia = 0;
     nHastaDia = 0;

     &nPP201 = 0; &nPP202 = 0; &nPP203 = 0; &nPP204 = 0;
     &nPP205 = 0; &nPP206 = 0; &nPP207 = 0; &nPP208 = 0;
     nUniPP201 = 0; nUniPP202 = 0; nUniPP203 = 0; nUniPP204 = 0;
     nUniPP205 = 0; nUniPP206 = 0; nUniPP207 = 0; nUniPP208 = 0;
     nImpProrr = 0;
     nDiff = 0;
     nMesBusca = 0;
     || nDiasAcum = 0;
     swSegPasada = 0;
     nPaso = 0;
     swCompAjuste = 0;
     &nElMes = 0;
     &nElAny = 0;
     &nElMesIRPF = 0;
     &nElAnyIRPF = 0;
     nCampoPT = 0;
     aNifTra = "";
     nUnidPaga = 0;
     nFechaAnt = 0;
     aFechaAnt = "";
     nFechaNom = 0;
     aFechaNom = "";
     nDias = 0;
     nCodEmp = 0;
     nCodTra = 0;
     nDiasDivide = 0;
     nDelMensual = 0;
     nTipo = 0;
     nDesdeMesReal = 0;
     nHastaMesReal = 0;
     &nDiasPago = 0;
     &swContCont = 0;
     &aFeBajaReal = "";
     &swPerComp = 0;
     &nRetEstAnu = 0;
     nDesdeTipo = 0;
     nHastaTipo = 0;
     nCampo012 = 0;
     nMes012 = 0;
     nTipo012 = 0;
     nImporte012 = 0;
     swNo = 0;
     nTotal = 0;
     nTramo = 0;
     nTramos = 0;
     nDesde = 0;
     nHasta = 0;
     nGuardaUnidPaga = 0;
     swPosibleIT = 0;
     nImpAju = 0;
     nProrAju = 0;
     nCampoAju = 0;
     nCampoImpAju = 0;
     swOtraEmp = 0;
     &swOtraMensual = 0;
     swCambiaCot = 0;
|FIN;

|INCLUYE nomcal_2;
|INCLUYE nomcal_5;

||****************************************************************************
||                    LECTURA PRINCIPAL DE TRABAJADORES
||****************************************************************************

|PROCESO TipoCot;
     #labtraba#42 = #labtraba#42;
|FPRC;

|PROCESO proceso;
     |HAZ TipoCot;
     |HAZ chequea_alta;
     |SI swfuera = 0;
          #9#0 = #2#87;
          |LEE 000#9=;
          |SI FSalida = 0;
               |SI swAgrario = 0;
                    cabecera = 0;
                    |HAZ EnPracticas;
                    |HAZ leeregis;
                    |HAZ t_parcial;
                    |HAZ leeconceptos;
                    |HAZ cabecera;
               |SINO;
                    |DDEFECTO #nomcalca;
                    |SI #labtraba#42 = "A";
                         nEmpAgr = #2#0;
                         nTraAgr = #2#1;
                         nMesAgr = los_meses;
                         nAnyAgr = 2000 + el_anyo;
                         |SUB_EJECUTA_NP "gomcalc1";
                         |DDEFECTO #nomcalca;
                         |ABRE #nomcalca;
                         #nomcalca#0 = nEmpAgr;
                         #nomcalca#1 = nTraAgr;
                         #nomcalca#2 = nMesAgr;
                         #nomcalca#3 = 0;
                         |LEE 101#nomcalca.=;
                         |CIERRA #nomcalca;
                    |FINSI;
               |FINSI;
          |SINO;
               |ATRI P;
               trabamen = #2#87;
               trabamen = "    " + mensaje1 + trabamen + mensaje2;
               |MENAV trabamen;
               |ATRI 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO historico4;
     |SI #51#4 < 201; |O #51#4 > 299;
          |SI #51#4 ] 103; |Y #51#4 [ 410;
               |SI #51#5 = "V"; |O #51#5 = "F";
                    |ABRE #nomvarli;
                    #nomvarli#0 = nCodEmp;
                    #nomvarli#1 = nCodTra;
                    #nomvarli#2 = nElMesIRPF;
                    #nomvarli#3 = 0;
                    #nomvarli#4 = #nomhicli#4;
                    |LEE 000#nomvarli.=;
                    |SI FSalida = 0;
                         nVariable = nVariable + (#51#10 * #51#11) ! EURODB;
                    |FINSI;
                    |CIERRA #nomvarli;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO HistoricoV;
     |BUCLELIN 2historico4#50;      || en busca de conceptos variables
     nMesesVar = nMesesVar + 1;
|FPRC;

|DEFBUCLE HistoricoV;
     #50#1;
     ;
     #2#0, #2#1, el_anyoAnt,  1, 0;
     #2#0, #2#1, el_anyoAnt, 12, 0;
     ;
     NULL, HistoricoV;
|FIN;

|PROCESO Busca925;
     |ABRE #nomtrali;
     #nomtrali#0 = #2#0;
     #nomtrali#1 = #2#1;
     #nomtrali#2 = 925;
     |LEE 000#nomtrali.=;
     |SI FSalida = 0;
          nVariable = #nomtrali#4;
          nMesesVar = 12;
     |FINSI;
     |CIERRA #nomtrali;
|FPRC;

|PROCESO HistoricoV_PorNif;
     |BUCLE HistoricoV;
|FPRC;

|DEFBUCLE HistoricoV_PorNif;
     #labtraba#2;
     ;
     aNifTra;
     aNifTra;
     ;
     NULL, HistoricoV_PorNif;
|FIN;

|PROCESO ConceptosV;
     |ABRE #nomir009;
     #nomir009#0 = #2#0;
     |LEE 000#nomir009.=;
     |SI #nomir009#18 = 1;
          el_anyoAnt = el_anyo - 1;
          nVariable = 0;
          nMesesVar = 0;
          |HAZ Busca925;
          |SI nVariable = 0;
               nCodEmp = #labtraba#0;
               nCodTra = #labtraba#1;
               aNifTra = #labtraba#7;
               |SALVA_FICHA #labtraba;
               |BUCLE HistoricoV_PorNif;
               |REPON_FICHA #labtraba;
          |FINSI;
          |SI nVariable ! 0;
               nVariable = nVariable / nMesesVar;
               nVariable = nVariable * (12 - nEsteMes);
               nVariable = nVariable ! 2;
          |FINSI;
          b_irpf = b_irpf + nVariable;
     |FINSI;
     |CIERRA #nomir009;
|FPRC;

|PROCESO historico2;                    || descuenta las pagas 99
     |SI #51#4 ] 201;|Y #51#4 [ 299;|Y #51#5 = "P";
          |SI swMesBaja = 0;
               nume1 = (#51#10 * #51#11) ! EURODB;
               b_irpf = b_irpf - nume1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GeneraUnidPaga;
     aFechaAnt = #labtraba#36;
     aFechaAnt = (aFechaAnt % -104) + (aFechaAnt % 402);
     nFechaAnt = aFechaAnt;

     alfa1 = nMesBusca; alfa1 = ("00" + alfa1) % -102;
     nume5 = el_anyo - 1;
     alfa2 = nume5; alfa2 = ("00" + alfa2) % -102;
     alfa2 = "20" + alfa2;
     aFechaNom = alfa2 + alfa1;
     nFechaNom = aFechaNom;

     swSigue = 0;
     |SI nFechaAnt [ nFechaNom; |Y nCodEmp = #labtraba#0; |Y nCodTra = #labtraba#1;
     |Y nTipo = 1; |Y nTramo = 1;
          swSigue = 1;
     |FINSI;
     |SI nFechaAnt [ nFechaNom; |Y nCodEmp = #labtraba#0; |Y nCodTra = #labtraba#1;
     |Y swPosibleIT = 1;
          || si vengo del proceso que busca las teoricas unidades de paga
          || cuando hubo IT, entro en cualquiera de los dos tramos
          || y en cualquiera de los dos tipos
          swSigue = 1;
     |FINSI;
     |SI swSigue = 1;
          mesnum = nMesBusca;
          anynum = alfa2;
          |HAZ ulti_dia;
          |SI nFechaAnt = nFechaNom;
               alfa1 = #labtraba#36 % 102;
               nDiaAlta = alfa1;
               nDias = topemes - nDiaAlta + 1;
               |SI #labtraba#42 ! "D"; |O #labtraba#42 ! "T";
                    |SI nDias > 30;
                         nDias = 30;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #labtraba#42 = "D"; |O #labtraba#42 = "T";
                    nDias = topemes;
               |SINO;
                    nDias = 30;
               |FINSI;
          |FINSI;
          nDiasDivide = nHastaMes - nDesdeMes + 1;
          |SI nDesdeMes ] nHastaMesReal; |Y nTipo = 1;
               |SI nTramo = 1;
                    nDiasDivide = nDiasDivide + nHastaMesReal;
               |FINSI;
               |SI nTramo = 2;
                    nDiasDivide = nDiasDivide + (12 - nDesdeMesReal);
               |FINSI;
          |FINSI;
          |SI swPosibleIT = 1;
               |SI nHastaMesReal ] nDesdeMesReal;
                    nDiasDivide = nHastaMesReal - nDesdeMesReal + 1;
               |FINSI;
               |SI nHastaMesReal < nDesdeMesReal;
                    nDiasDivide = 12 - nDesdeMesReal + 1;
                    nDiasDivide = nDiasDivide + nHastaMesReal;
               |FINSI;
          |FINSI;
          |SI nDiasDivide = 0; |O nDiasDivide = 1;
               nDiasDivide = 12;
          |FINSI;
          |SI nDiasDivide < 0;
               nDiasDivide = 12 + nDiasDivide + 1;
          |FINSI;

          |SI nDiasDivide = 12; |Y #labtraba#42 ! "M";
               || si el a¤o es completo cojo todos los dias
               nDiasDivide = 365;
          |SINO;
               || esto esta mal imagino, habria que distinguir
               || los diarios, otro dia
               nDiasDivide = nDiasDivide * 30;
          |FINSI;
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               nUnidPaga = nDias * nDiasPago / nDiasDivide * nDias / 30;
          |SINO;
               || diarios
               nUnidPaga = nDias * nDiasPago / nDiasDivide;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaPosibleIT;
     swPosibleIT = 1;
     |ABRE #labempre;
     #labempre#0 = #51#0;
     |LEE 000#labempre.=;
     |CIERRA #labempre;

     |ABRE #50;
     #50#0 = #51#0;
     #50#1 = #51#1;
     #50#2 = #51#2;
     #50#3 = #51#3;
     #50#66 = #51#12;
     |LEE 000#50=;
     |SI FSalida = 0;
          |SI #50#31 ! 0;
               |SI #labempre#26 = "N";
                    |HAZ GeneraUnidPaga;
               |FINSI;
          |FINSI;
          |SI #50#32 ! 0;
               |SI #labempre#27 = "N";
                    |HAZ GeneraUnidPaga;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #50;
     swPosibleIT = 0;
|FPRC;

|PROCESO P_historico6;
     |SI #labtraba#0 ! nCodEmp;
          |ACABA;
     |FINSI;
     nMesBaja = 0;
     nAnyBaja = 0;
     |SI #labtraba#1 ! nCodTra;
          aAlfa = #labtraba#37;
          |SI aAlfa ! "          "; |Y aAlfa ! "..........";
               aAlfa1 = aAlfa % 402;
               aAlfa2 = aAlfa % -104;
               nMesBaja = aAlfa1;
               nAnyBaja = aAlfa2;
               nAnyBaja = nAnyBaja - 2000;
          |FINSI;
     |FINSI;
     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |PARA concepto = 201; |SI concepto [ 208; |HACIENDO concepto = concepto + 1;
          nume1 = concepto - 197;     || mes desde prorrateo
          nume2 = concepto - 189;     || mes hasta prorrateo
          nume3 = concepto - 181;     || mes de pago
          nume4 = concepto - 165;     || dias de pago
          nume5 = concepto - 93;      || dia desde prorrateo
          nume6 = concepto - 85;      || dia hasta prorrateo

          nDesdeMes = #nomconca#nume1#;
          nHastaMes = #nomconca#nume2#;
          nMesPago = #nomconca#nume3#;
          nDiasPago = #nomconca#nume4#;
          nDesdeDia = #nomconca#nume5#;
          nHastaDia = #nomconca#nume6#;

          swSigue = 1;
          nCampoPT = concepto - 88;
          |SI nMesPago = 99; |O #labtraba#nCampoPT# = "S"; |O nMesPago = 0;
               swSigue = 0;
          |FINSI;

          |SI nMesBaja ! 0; |Y nAnyBaja ! 0;      || trabajador de baja
               #51#0 = #labtraba#0;               || es otro codigo
               #51#1 = #labtraba#1;
               #51#2 = nMesBaja;
               #51#3 = 0;
               #51#4 = concepto;
               #51#12 = nAnyBaja;
               |LEE 000#51=;
               |SI FSalida = 0;
                    |SI #51#11 ! 0;
                         || se supone que entonces en el mes de baja del traba-
                         || jador he pagado la paga, con lo que no debe acumular
                         || unidades de esta de ningun modo, me salgo

                         |SI nDesdeDia = 1;
                              || ojo, efectivamente, es otro trabajador, es baja
                              || y es mes que cobra la paga, pero es que esa paga
                              || no es una paga "del 1 al 31", con lo que hay unid.
                              || de prorrata que se tendrian que tener en cuenta
                              || Dejo pasar y que acumule este mes tambien en
                              || estos casos, 07.06.2017 003430.01377

                              swSigue = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
               || y si no ... busco en finiquitos
               |SI swSigue = 1;
                    #51#3 = 2;
                    |LEE 000#51=;
                    |SI FSalida = 0;
                         |SI #51#11 ! 0;
                              || se supone que entonces en el mes de baja del traba-
                              || jador he pagado la paga, con lo que no debe acumular
                              || unidades de esta de ningun modo, me salgo
                              swSigue = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;

          |ABRE #50;
          #50#0 = #labtraba#0;     || a ver, si tengo tipo 1 de la paga que busco
          #50#1 = #labtraba#1;     || NO cojo de aqui nada, paso tres kilos
          #50#2 = nMesPago;        || porque voy a coger solo los importes reales
          #50#3 = 1;               || de la paga que me introduzcan
          #50#66 = el_anyo;
          |LEE 000#50=;
          |SI FSalida = 0;
               #50#3 = 0;
               |LEE 000#50=;
               |SI FSalida ! 0;    || tengo tipo 1 y no tengo tipo 0
                    swSigue = 0;   || no sigo con esta paga
               |FINSI;
          |FINSI;
          |CIERRA #50;
          |SI swSigue = 1;
               |SI nDesdeMes ] nHastaMes; |O nMesPago < nHastaMes;
                    nTipo = 1;          || lo de siempre
               |SINO;
                    |SI nDesdeMes < nHastaMes;
                         nTipo = 2;
                    |FINSI;
               |FINSI;

               nDesdeMesReal = nDesdeMes;
               nHastaMesReal = nHastaMes;
          |FINSI;
          |SI nMesPago < nElMesIRPF;
               swSigue = 0;
          |FINSI;
          |SI swSigue = 1;
               |SI nTipo = 2;
                    nHastaMes = nMes99 - 1;
               |FINSI;

               |SI nTipo = 1; |Y nDesdeMes ] nHastaMesReal;
                    nTramos = 2;
               |SINO;
                    nTramos = 1;
               |FINSI;

               |SI nTipo = 1; |Y nDesdeMesReal = nHastaMesReal;
               |Y nDesdeDia < nHastaDia;
               || por una paga desde 01/06 hasta 30/06 que nos ha salido
                    nTipo = 2;
                    nTramos = 1;
               |FINSI;

               |PARA nTramo = 1; |SI nTramo [ nTramos; |HACIENDO nTramo = nTramo + 1;
                    |SI nTipo = 1; |Y nTramos = 2;
                         |SI nTramo = 1;
                              nDesdeMes = nDesdeMes;
                              nHastaMes = 12;
                         |FINSI;
                         |SI nTramo = 2;
                              nDesdeMes = 1;
                              nHastaMes = nMes99 - 1;
                         |FINSI;
                    |FINSI;

                    |PARA nMesBusca = nHastaMes; |SI nMesBusca ] nDesdeMes; |HACIENDO nMesBusca = nMesBusca - 1;
                         nUnidPaga = 0;
                         #51#0 = #labtraba#0;
                         #51#1 = #labtraba#1;
                         #51#2 = nMesBusca;
                         #51#3 = 0;
                         #51#4 = concepto;
                         |SI nTipo = 1; |Y nTramo = 1;
                              #51#12 = el_anyo - 1;
                         |SINO;
                              #51#12 = el_anyo;
                         |FINSI;
                         |LEE 000#51=;
                         |SI FSalida = 0;
                              || esto en el tipo 2 no lo tengo en cuenta, si la
                              || nomina ya existe las unidades se tendran en cuenta luego
                              || ahora que si no existe y deberia si que la tengo
                              || que tener en cuenta
                              ||SI nTipo = 1;
                              || pues si, ahora lo tengo en cuenta para todos
                                   nUnidPaga = #51#9;
                              ||FINSI;
                              || busco por si hubiera tenido IT y tuve menos unidades
                              || de prorrata de pagas a causa de la IT, en ese caso si
                              || le empresa tiene descuento en pagas NO, debo contar
                              || como si no hubiera tenido IT

                              nGuardaUnidPaga = nUnidPaga;

                              |HAZ BuscaPosibleIT;
                              |SI nUnidPaga > nGuardaUnidPaga;
                                   nUnidPaga = nUnidPaga;
                              |SINO;
                                   nUnidPaga = nGuardaUnidPaga;
                              |FINSI;

                         |SINO;
                              || vamos a ver si, aunque no haya historico, hay que
                              || tener en cuenta las unidades de paga (invento de Dany)
                              || PERO SOLO EN TIPO 1, en el tramo correspondiente
                              || al a¤o anterior 02.09.2009

                              |HAZ GeneraUnidPaga;

                         |FINSI;
                         |SI nMesBaja = #51#2; |Y nAnyBaja = #51#12;
                              || el mes de baja del trabajador, si ha cobrado
                              || para no tengo que tener en cuenta esas prorra-
                              || tas
                                   |SI #51#10 ! 0;

                                   |FINSI;
                         |FINSI;

                         |SI concepto = 201; nUniPP201 = nUniPP201 + nUnidPaga; |FINSI;
                         |SI concepto = 202; nUniPP202 = nUniPP202 + nUnidPaga; |FINSI;
                         |SI concepto = 203; nUniPP203 = nUniPP203 + nUnidPaga; |FINSI;
                         |SI concepto = 204; nUniPP204 = nUniPP204 + nUnidPaga; |FINSI;
                         |SI concepto = 205; nUniPP205 = nUniPP205 + nUnidPaga; |FINSI;
                         |SI concepto = 206; nUniPP206 = nUniPP206 + nUnidPaga; |FINSI;
                         |SI concepto = 207; nUniPP207 = nUniPP207 + nUnidPaga; |FINSI;
                         |SI concepto = 208; nUniPP208 = nUniPP208 + nUnidPaga; |FINSI;
                    |SIGUE;
               |SIGUE;
          /*
          |SI nMesPago < nHastaMes;     || diferida del a¤o pasado, acumulo
                                        || importe guardado en labtraba
               nume4 = concepto - 136;
               |SI #labtraba#nume4# > 0;
                    b_irpf = b_irpf + #labtraba#nume4#;
               |FINSI;
          |FINSI;
          */
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE B_historico6;
     #labtraba#2;
     ;
     aNifTra;
     aNifTra;
     ;
     NULL, P_historico6;
|FIN;

|PROCESO historico6;
     nUniPP201 = 0; nUniPP202 = 0; nUniPP203 = 0; nUniPP204 = 0;
     nUniPP205 = 0; nUniPP206 = 0; nUniPP207 = 0; nUniPP208 = 0;
     aNifTra = #labtraba#7;
     nCodEmp = #labtraba#0;
     nCodTra = #labtraba#1;
     |SALVA_FICHA #labtraba;
     |BUCLE B_historico6;
     |REPON_FICHA #labtraba;
|FPRC;

|PROCESO AjustePagasF;
     nImpAju = 0;
     nProrAju = 0;
     nCampoAju = 0;
     nCampoImpAju = 0;

     || una cosa mas, si la paga es de ajuste tipo "F", lo que hago
     || es coger el importe que tengo en la ficha del trabajador
     || y lo divido por los meses de prorrateo de la paga

     nCampoAju = concepto - 44;
     nCampoImpAju = concepto - 36;
     |SI #labtraba#nCampoAju# = "F";
          nImpAju = #labtraba#nCampoImpAju#;
          nProrAju = nImpAju / 30; || aproximadamente
          || si hay diarios en esta circunstancia y alguien se queja
          || ya lo liaremos mas

          |SI concepto = 201; nPP201 = nProrAju; |FINSI;
          |SI concepto = 202; nPP202 = nProrAju; |FINSI;
          |SI concepto = 203; nPP203 = nProrAju; |FINSI;
          |SI concepto = 204; nPP204 = nProrAju; |FINSI;
          |SI concepto = 205; nPP205 = nProrAju; |FINSI;
          |SI concepto = 206; nPP206 = nProrAju; |FINSI;
          |SI concepto = 207; nPP207 = nProrAju; |FINSI;
          |SI concepto = 208; nPP208 = nProrAju; |FINSI;
     |FINSI;
|FPRC;

|PROCESO mensual5;
     |SI #12#4 ] 201; |Y #12#4 [ 208;
          concepto = #12#4;
          #nomconca#0 = #labtraba#87;
          |LEE 000#nomconca.=;

          swNo = 0;
          nume1 = #12#4 - 197;     || mes desde prorrateo
          nume2 = #12#4 - 189;     || mes haste prorrateo
          nume3 = #12#4 - 181;     || mes de pago
          nDesdeMes = #nomconca#nume1#;
          nHastaMes = #nomconca#nume2#;
          nMesPago = #nomconca#nume3#;
          nCampoPT = #12#4 - 88;
          |SI nMesPago = 99; |O #labtraba#nCampoPT# = "S";
               #11#74 = #11#74 + (#12#9 * #12#10);
               swNo = 1;
               || las pagas prorrateadas se calculan en la estimacion, pero no
               || se acumulan en el campo, las a¤ado aqui

               |SI #labtraba#42 ! "A"; |Y #labtraba#42 ! "B"; |Y #labtraba#42 ! "E"; |Y #labtraba#42 ! "e";
                    |SI #labtraba#97 = 4;
                         swNo = 1;
                         #11#74 = #11#74 - (#12#9 * #12#10);
                    |FINSI;
               |SINO;
                    swNo = 1;
                    #11#74 = #11#74 - (#12#9 * #12#10);
                    || esto estaba asi, pero me he dado cuenta que en agrarios
                    || estaba a¤adiendo a la base de IRPF las pagas prorrateadas
                    || cuando ya lo hace la estimacion, no es correcto, solo las
                    || quitaba en ajustes, pero en los no ajustados tambien pasa
                    || 12.09.2012. Lo hago para todos los agrarios.
                    /*
                    |SI #labtraba#97 = 1; |O #labtraba#97 = 2; |O #labtraba#97 = 4;
                         swNo = 1;
                         #11#74 = #11#74 - (#12#9 * #12#10);
                    |FINSI;
                    */
               |FINSI;
          |FINSI;
          |SI nDesdeMes ] nHastaMes;
               nDesdeMes = 1;
          |FINSI;
          |SI nMesPago < nHastaMes;
               swNo = 1;
               ||b_irpf = b_irpf - (#12#9 * #12#10);
          ||SINO;
               ||ACABA;
          |FINSI;
          |SI nDesdeMes [ los_meses; |Y los_meses [ nHastaMes; |Y los_meses [ nMesPago;
               || estos son los casos en que
               || la prorrata ha de tenerse en cuenta
          |SINO;
               swNo = 1;
               || b_irpf = b_irpf - (#12#9 * #12#10);
          |FINSI;
          nUnidPaga = #12#9;
          |SI #12#10 = 1;
               #12#10 = 0;
          |FINSI;
          |SI swNo = 0; |Y nUnidPaga ! 0;
               |SI concepto = 201; nUniPP201 = nUniPP201 + nUnidPaga; |FINSI;
               |SI concepto = 202; nUniPP202 = nUniPP202 + nUnidPaga; |FINSI;
               |SI concepto = 203; nUniPP203 = nUniPP203 + nUnidPaga; |FINSI;
               |SI concepto = 204; nUniPP204 = nUniPP204 + nUnidPaga; |FINSI;
               |SI concepto = 205; nUniPP205 = nUniPP205 + nUnidPaga; |FINSI;
               |SI concepto = 206; nUniPP206 = nUniPP206 + nUnidPaga; |FINSI;
               |SI concepto = 207; nUniPP207 = nUniPP207 + nUnidPaga; |FINSI;
               |SI concepto = 208; nUniPP208 = nUniPP208 + nUnidPaga; |FINSI;

               |SI concepto = 201; |Y nPP201 = 0; nPP201 = #12#10; |FINSI;
               |SI concepto = 202; |Y nPP202 = 0; nPP202 = #12#10; |FINSI;
               |SI concepto = 203; |Y nPP203 = 0; nPP203 = #12#10; |FINSI;
               |SI concepto = 204; |Y nPP204 = 0; nPP204 = #12#10; |FINSI;
               |SI concepto = 205; |Y nPP205 = 0; nPP205 = #12#10; |FINSI;
               |SI concepto = 206; |Y nPP206 = 0; nPP206 = #12#10; |FINSI;
               |SI concepto = 207; |Y nPP207 = 0; nPP207 = #12#10; |FINSI;
               |SI concepto = 208; |Y nPP208 = 0; nPP208 = #12#10; |FINSI;

               |HAZ AjustePagasF;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaProAct;
     || proceso para buscar el valor mas actual de las pagas para calcular
     || el valor exacto de la prorrata en la  regularizacion

     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |PARA concepto = 201; |SI concepto [ 208; |HACIENDO concepto = concepto + 1;
          nume1 = concepto - 197;     || mes desde prorrateo
          nume2 = concepto - 189;     || mes hasta prorrateo
          nume3 = concepto - 181;     || mes de pago

          nDesdeMes = #nomconca#nume1#;
          nHastaMes = #nomconca#nume2#;
          nMesPago = #nomconca#nume3#;

          |SI nDesdeMes ] nHastaMes;
               nDesdeMes = 1;
          |FINSI;

          swSigue = 1;
          nCampoPT = concepto - 88;
          |SI nMesPago = 99; |O #labtraba#nCampoPT# = "S"; |O nMesPago = 0;
               swSigue = 0;
          |FINSI;

          |SI swSigue = 1;
               |DBASS aBase;  |QBF aBase;
               aMas  = aBase + "laboral/def/nomcalli.mas";
               aFich = aBase + "laboral/fich/";

               |CARGA_DEF aMas, copiadef@;

               |ABRE #500;
               nDelMensual = 0;        || a ver, esto es por si no hay
               #500#0 = #labtraba#0;    || ningun importe ni nada de nada del
               #500#1 = #labtraba#1;    || historico con respecto a esa paga
               #500#2 = nElMesIRPF;     || para que coja las unidades del mensual
               #500#3 = 0;              || del mes que estoy calculando, mas lio
               #500#4 = concepto;       || pero en fin
               |LEE 000#500=;
               |SI FSalida = 0;
                    nDelMensual = #500#10;
               |FINSI;
               |CIERRA #500;

               |DESCARGA_DEF #copiadef@;

               |SI nDelMensual = 1;
                    nDelMensual = 0;
               |FINSI;

               |SI nDelMensual ! 0;
                    |SI concepto = 201; nPP201 = nDelMensual; |FINSI;
                    |SI concepto = 202; nPP202 = nDelMensual; |FINSI;
                    |SI concepto = 203; nPP203 = nDelMensual; |FINSI;
                    |SI concepto = 204; nPP204 = nDelMensual; |FINSI;
                    |SI concepto = 205; nPP205 = nDelMensual; |FINSI;
                    |SI concepto = 206; nPP206 = nDelMensual; |FINSI;
                    |SI concepto = 207; nPP207 = nDelMensual; |FINSI;
                    |SI concepto = 208; nPP208 = nDelMensual; |FINSI;
               |FINSI;

               |PARA nMesBusca = nHastaMes; |SI nMesBusca ] nDesdeMes; |HACIENDO nMesBusca = nMesBusca - 1;
                    #51#0 = #labtraba#0;
                    #51#1 = #labtraba#1;
                    #51#2 = nMesBusca;
                    #51#3 = 0;
                    #51#4 = concepto;
                    |SI nMesPago < nHastaMes; || es diferida del a¤o pasado, la prorrata
                         #51#12 = el_anyo - 1;|| que he de coger es la ultima de a¤o pasado
                    |SINO;
                         #51#12 = el_anyo;
                    |FINSI;
                    |LEE 000#51=;
                    |SI FSalida = 0;
                         |SI #51#10 = 1;
                              #51#10 = 0;
                         |FINSI;
                         |SI concepto = 201; |Y nPP201 = 0; nPP201 = #51#10; |FINSI;
                         |SI concepto = 202; |Y nPP202 = 0; nPP202 = #51#10; |FINSI;
                         |SI concepto = 203; |Y nPP203 = 0; nPP203 = #51#10; |FINSI;
                         |SI concepto = 204; |Y nPP204 = 0; nPP204 = #51#10; |FINSI;
                         |SI concepto = 205; |Y nPP205 = 0; nPP205 = #51#10; |FINSI;
                         |SI concepto = 206; |Y nPP206 = 0; nPP206 = #51#10; |FINSI;
                         |SI concepto = 207; |Y nPP207 = 0; nPP207 = #51#10; |FINSI;
                         |SI concepto = 208; |Y nPP208 = 0; nPP208 = #51#10; |FINSI;
                    |FINSI;
               |SIGUE;

               || si no encuentro hacia detras busco hacia delante hasta llegar
               || al mes actual en curso

               |SI nHastaMes = 12; nHastaMes = 1; |FINSI;   || claro

               |PARA nMesBusca = nHastaMes; |SI nMesBusca < nElMesIRPF; |HACIENDO nMesBusca = nMesBusca + 1;
                    #51#0 = #labtraba#0;
                    #51#1 = #labtraba#1;
                    #51#2 = nMesBusca;
                    #51#3 = 0;
                    #51#4 = concepto;
                    #51#12 = el_anyo;
                    |LEE 000#51=;
                    |SI FSalida = 0;
                         |SI #51#10 = 1;
                              #51#10 = 0;
                         |FINSI;
                         |SI concepto = 201; |Y nPP201 = 0; nPP201 = #51#10; |FINSI;
                         |SI concepto = 202; |Y nPP202 = 0; nPP202 = #51#10; |FINSI;
                         |SI concepto = 203; |Y nPP203 = 0; nPP203 = #51#10; |FINSI;
                         |SI concepto = 204; |Y nPP204 = 0; nPP204 = #51#10; |FINSI;
                         |SI concepto = 205; |Y nPP205 = 0; nPP205 = #51#10; |FINSI;
                         |SI concepto = 206; |Y nPP206 = 0; nPP206 = #51#10; |FINSI;
                         |SI concepto = 207; |Y nPP207 = 0; nPP207 = #51#10; |FINSI;
                         |SI concepto = 208; |Y nPP208 = 0; nPP208 = #51#10; |FINSI;
                    |FINSI;
               |SIGUE;

               || por ultimo si no tengo NADA, cojo lo del mensual

               |SI nDelMensual = 1;
                    nDelMensual = 0;
               |FINSI;
               |SI concepto = 201; |Y nPP201 = 0; nPP201 = nDelMensual; |FINSI;
               |SI concepto = 202; |Y nPP202 = 0; nPP202 = nDelMensual; |FINSI;
               |SI concepto = 203; |Y nPP203 = 0; nPP203 = nDelMensual; |FINSI;
               |SI concepto = 204; |Y nPP204 = 0; nPP204 = nDelMensual; |FINSI;
               |SI concepto = 205; |Y nPP205 = 0; nPP205 = nDelMensual; |FINSI;
               |SI concepto = 206; |Y nPP206 = 0; nPP206 = nDelMensual; |FINSI;
               |SI concepto = 207; |Y nPP207 = 0; nPP207 = nDelMensual; |FINSI;
               |SI concepto = 208; |Y nPP208 = 0; nPP208 = nDelMensual; |FINSI;

               |HAZ AjustePagasF;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Inicia012;
     #nomir012#0 = #2#7;      || Nif
     |SI swOtraEmp = 0;
          #nomir012#1 = #2#0;      || Empresa
          #nomir012#2 = #2#1;      || Trabajador
     |SINO;
          #nomir012#1 = nEmpr99;      || Empresa
          #nomir012#2 = nTrab99;      || Trabajador

          || claro, porque quiero que me estime la otra ficha de un trabajador
          || que esta de alta en dos empresas, pero para que me acumule y me
          || regularice los importes de los dos a la vez es asi: acumulo en el
          || codigo de trabajador que estoy calculando
     |FINSI;
     #nomir012#3 = nElAnyIRPF;      || A¤o
     #nomir012#4 = nElMesIRPF;      || Mes
     |LEE 101#nomir012.=;
     |SI FSalida = 0;
          |SI swOtraEmp = 1;
               || inicializo totales, que si no sumo dos veces

               #nomir012#17 = 0;
               #nomir012#30 = 0;
               #nomir012#56 = 0;
               #nomir012#43 = 0;
               #nomir012#69 = 0;
               #nomir012#82 = 0;
          |FINSI;
     |FINSI;

     nPP201 = 0; nPP202 = 0; nPP203 = 0; nPP204 = 0;
     nPP205 = 0; nPP206 = 0; nPP207 = 0; nPP208 = 0;
|FPRC;

|PROCESO Acum012;
     |SI nTipo012 = 0; nCampo012 = nMes012 + 4; |FINSI;
     |SI nTipo012 = 51; nCampo012 = nMes012 + 17; |FINSI;
     |SI nTipo012 = 1; nCampo012 = nMes012 + 30; |FINSI;
     |SI nTipo012 = 2; nCampo012 = nMes012 + 43; |FINSI;
     |SI nTipo012 ] 5; |Y nTipo012 [ 20;
          nCampo012 = nMes012 + 56;
     |FINSI;
     #nomir012#nCampo012# = #nomir012#nCampo012# + nImporte012;
|FPRC;

|PROCESO Graba012;
     nTotal = 0;
     |PARA nume1 = 5; |SI nume1 [ 69; |HACIENDO nume1 = nume1 + 1;
          nTotal = nTotal + #nomir012#nume1#;
          |SI nume1 = 17; #nomir012#nume1# = nTotal; nTotal = 0; |FINSI;
          |SI nume1 = 30; #nomir012#nume1# = nTotal; nTotal = 0; |FINSI;
          |SI nume1 = 43; #nomir012#nume1# = nTotal; nTotal = 0; |FINSI;
          |SI nume1 = 56; #nomir012#nume1# = nTotal; nTotal = 0; |FINSI;
          |SI nume1 = 69; #nomir012#nume1# = nTotal; nTotal = 0; |FINSI;
     |SIGUE;
     #nomir012#82 = #nomir012#17 + #nomir012#30 + #nomir012#43 + #nomir012#56;
     #nomir012#82 = #nomir012#82 + #nomir012#69;
     #nomir012#84 = #nomir012#82;

     |PARA nume1 = 70; |SI nume1 [ 81; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 - 65;
          nume3 = nume1 - 52;
          nume4 = nume1 - 39;
          nume5 = nume1 - 26;
          nume6 = nume1 - 13;
          #nomir012#nume1# = #nomir012#nume2# + #nomir012#nume3# + #nomir012#nume4#;
          #nomir012#nume1# = #nomir012#nume1# + #nomir012#nume5# + #nomir012#nume6#;
     |SIGUE;

     #nomir012#83 = 0;
     nume1 = #nomir012#4;
     nume1 = nume1 + 69 - 1;
     |PARA nume2 = 70; |SI nume2 [ nume1; |HACIENDO nume2 = nume2 + 1;
          #nomir012#83 = #nomir012#83 + #nomir012#nume2#;
     |SIGUE;
     |PARA nume2 = nume1 + 1 - 13; |SI nume2 [ 68; |HACIENDO nume2 = nume2 + 1;
          #nomir012#83 = #nomir012#83 + #nomir012#nume2#;
     |SIGUE;

     #nomir012#101 = nVariable;
     #nomir012#84 = #nomir012#84 + nVariable;

     |SI eaVengoDe = "nomir002";
          |ACABA;
     |FINSI;

     |GRABA 020#nomir012.a;
     |LIBERA #nomir012;
|FPRC;

|PROCESO AcumPagas;
     |HAZ BuscaTrab;   || busco a ver si acabo contrato y continuo luego

     || swPerComp: si = 1 es porque el motivo de baja es 8, 9 o 10 en un
     || trabajador que es baja este mes, o sea que continua contrato, en este caso
     || incluyo pagas para que no se despirule el % IRPF

     || swContCont: si = 1 es porque el trabajador es alta y baja el mismo
     || mes y continua contrato, en este caso y si swPerComp = 0 no lo tengo que
     || tener en cuenta las pagas

     |SI swContCont ! 1; |Y swPerComp = 0; || si continuo contrato no, que si no lo cuento 2 veces
          b_irpf = b_irpf + (nUniPP201 * nPP201);
          b_irpf = b_irpf + (nUniPP202 * nPP202);
          b_irpf = b_irpf + (nUniPP203 * nPP203);
          b_irpf = b_irpf + (nUniPP204 * nPP204);
          b_irpf = b_irpf + (nUniPP205 * nPP205);
          b_irpf = b_irpf + (nUniPP206 * nPP206);
          b_irpf = b_irpf + (nUniPP207 * nPP207);
          b_irpf = b_irpf + (nUniPP208 * nPP208);
     |FINSI;

     || Acumula

     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;

     |PARA concepto = 201; |SI concepto [ 208; |HACIENDO concepto = concepto + 1;
          nume3 = concepto - 181;     || mes de pago
          nMesPago = #nomconca#nume3#;

          nNume = 0;
          |SI concepto = 201; nNume = (nUniPP201 * nPP201); |FINSI;
          |SI concepto = 202; nNume = (nUniPP202 * nPP202); |FINSI;
          |SI concepto = 203; nNume = (nUniPP203 * nPP203); |FINSI;
          |SI concepto = 204; nNume = (nUniPP204 * nPP204); |FINSI;
          |SI concepto = 205; nNume = (nUniPP205 * nPP205); |FINSI;
          |SI concepto = 206; nNume = (nUniPP206 * nPP206); |FINSI;
          |SI concepto = 207; nNume = (nUniPP207 * nPP207); |FINSI;
          |SI concepto = 208; nNume = (nUniPP208 * nPP208); |FINSI;

          nCampoPT = concepto - 88;

          |SI nNume ! 0;
               |SI nMesPago ! 99; |Y #labtraba#nCampoPT# ! "S"; |Y nMesPago ! 0;
                    |SI nMesPago ! nElMesIRPF;
                         nImporte012 = nNume;
                         nMes012 = nMesPago;
                         nTipo012 = 51;         || PAGAS
                         |HAZ Acum012;
                    |SINO;
                         b_irpf = b_irpf - nNume;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO historico1;
    |SI #50#3 < 5;            || los atrasos los acumula pero estima el mes
         sw_historico = 1;    || (por si no hay mes y si hay atrasos)
    |FINSI;
     |SI nEsteMes ! 12;
          |SI #50#3 ! 2;
               b_irpf = b_irpf + #50#113 + #50#16;

               |SI #50#38 ! 0; |Y #50#3 [ 4;
                    |BUCLELIN 2historico2#50; || -pagas 99
               |FINSI;
          |FINSI;
     |SINO;
         b_irpf = b_irpf + (#50#113 + #50#16);
     |FINSI;

     segsoc = segsoc + (#50#48 + #50#49 + #50#50 + #50#51);
     seleccio = 1;

     nImporte012 = #50#113;
     nMes012 = los_meses;
     nTipo012 = 0;         || NOMINA
     |SI #50#3 = 1;
          nTipo012 = 1;         || si es un importe que viene del tipo 1
     |FINSI;
     |SI #50#3 ] 5; |Y #50#3 [ 20;
          nTipo012 = 5;         || si son atrasos
     |FINSI;
     |HAZ Acum012;

     nImporte012 = #50#16;
     nMes012 = los_meses;
     nTipo012 = 51;         || PAGA
     |SI #50#3 = 1;
          nTipo012 = 1;         || si es un importe que viene del tipo 1
     |FINSI;                  || va todo al mismo campo, no distingo nomina y paga
     |HAZ Acum012;
|FPRC;

|DEFBUCLE historico;
     #50#1;
     ;
     #2#0, #2#1, el_anyo, los_meses, nDesdeTipo;
     #2#0, #2#1, el_anyo, los_meses, nHastaTipo;
     ;
     NULL, historico1;
|FIN;

|PROCESO atrasos2;
|SI #51#4 ] 201;|Y #51#4 [ 299;|Y #51#5 = "P";
        nume1 = (#51#10 * #51#11) ! EURODB;
        b_irpf = b_irpf - nume1;
|FINSI;
|FPRC;

|PROCESO atrasos1;
    b_irpf = b_irpf + (#50#113 + #50#38);
|BUCLELIN 2atrasos2#50;
|FPRC;

|DEFBUCLE atrasos;
 #50#1;
 ;
 #2#0, #2#1, el_anyo,  1, 5;
 #2#0, #2#1, el_anyo, 12, 5;
 ;
 NULL, atrasos1;
|FIN;

|PROCESO diarios;
    var_mes = 0;
    nume1 = 0;
|PARA para1 = los_meses; |SI; |HACIENDO para1 = para1 + 1;
        nume1 = nume1 + 1;
    |SI nume1 [ var_top;
        |SI para1 = 1;  var_mes = var_mes + 31;            |FINSI;
        |SI para1 = 2;  var_mes = var_mes + 28 + bisiesto; |FINSI;
        |SI para1 = 3;  var_mes = var_mes + 31;            |FINSI;
        |SI para1 = 4;  var_mes = var_mes + 30;            |FINSI;
        |SI para1 = 5;  var_mes = var_mes + 31;            |FINSI;
        |SI para1 = 6;  var_mes = var_mes + 30;            |FINSI;
        |SI para1 = 7;  var_mes = var_mes + 31;            |FINSI;
        |SI para1 = 8;  var_mes = var_mes + 31;            |FINSI;
        |SI para1 = 9;  var_mes = var_mes + 30;            |FINSI;
        |SI para1 = 10; var_mes = var_mes + 31;            |FINSI;
        |SI para1 = 11; var_mes = var_mes + 30;            |FINSI;
        |SI para1 = 12; var_mes = var_mes + 31;            |FINSI;
    |SINO;
        |SAL;
    |FINSI;
|SIGUE;

|SI #2#97 ! 0;
        var_imp = #11#38 / #11#8;                 || importe diario prorrata
        b_irpf = b_irpf + (var_imp * var_mes) + (var_top * #11#74);
|SINO;
        var_imp = (#11#74 + #11#38) / #11#8;      || importe diario total
        b_irpf = b_irpf + (var_imp * var_mes);
|FINSI;
|FPRC;

|PROCESO mensuales;
    var_imp = (#11#74 + #11#38);
    var_mes = var_top;

    b_irpf = b_irpf + (var_imp * var_mes);
|FPRC;

|PROCESO pre_proceso;
     b_irpf = 0;         || esta variable ya no se usa, la dejo por si acaso
     |SI nCalculo99 = 0;
          ||HAZ AntesDel99;
          || esto no sirve para nada, ni se usa nada
     |SINO;
          |HAZ Inicia012;
          aFeBajaReal = #2#37;
          |SI swOtraEmp = 0;       || si es el segundo trabajador de un calculo
               #2#36 = aFeAlta;    || de trabajadores en dos empresas, coge las fechas
               #2#37 = aFeBaja;    || del segundo codigo, logicamente
          |FINSI;
          |ABRE #51;
          |HAZ historico6;
          |SI nEsteMes ! 12; |Y swMesBaja ! 1;
          || en diciembre o finiquito ya no, ahi es todo real
               |HAZ BuscaProAct;
          |FINSI;
          |CIERRA #51;
          |PARA los_meses = 1; |SI los_meses [ 12; |HACIENDO los_meses = los_meses + 1;
               |SI nEsteMes ! los_meses; |O swOtraEmp = 1;
               || para que en el ultimo mes tambien entre, por si son dos
               || fichas a la vez EN LA MISMA EMPRESA
               ||SI nEsteMes ! 99; |O swOtraEmp = 1;
                    || lo del swOtraEmp porque si esta a 1 es porque estoy estimando
                    || un trabajador con el mismo nif que otro, que esta en distinta
                    || empresa, en ese caso, estimo tambien lo que cobrara ese mes
                    || de moemento no
                    #0#8 = los_meses;
                    nElMes = #0#8;
                    sw_historico = 0;
                    nDesdeTipo = 0;
                    nHastaTipo = 99;
                    |BUCLE historico;
                    |SI nEsteMes = los_meses; |Y swOtraEmp = 1;
                         || esto es porque es la otra ficha de un trabajador
                         || de alta en dos empresas
                         || si tengo calculada la nomina en el mensual no
                         || me la tiene que estimar, que es cuando swOtraMensual
                         || es igual a 1 (viene del nomir001)
                         |SI swOtraMensual = 1;
                              sw_historico = 1;
                         |FINSI;
                    |FINSI;
                    |SI sw_historico = 0;
                         |HAZ lib_0;
                         |HAZ tipos;
                         |HAZ proceso;
                         |SI swfuera = 0;
                              |SI swMesBaja = 0;
                                   b_irpf = b_irpf + #11#74;
                                   |BUCLELIN 2mensual5#11;
                              |SINO;
                                   b_irpf = b_irpf + (#11#74+#11#16);

                                   || a ver, aqui esto no estaba, lo pongo por el
                                   || tiquet 2884.1900, que resulta que si
                                   || era baja y alta, no tenia en cuenta
                                   || las pagas prorrateadas para la estimacion
                                   || ojo a posibles efectos secundarios

                                   |BUCLELIN 2mensual5#11;
                              |FINSI;
                              segsoc = segsoc + (#11#48+#11#49+#11#50+#11#51);
                              nImporte012 = #11#74;
                              nMes012 = los_meses;
                              nTipo012 = 0;         || NOMINA
                              |HAZ Acum012;
                         |FINSI;
                    |SINO;
                    |FINSI;
                |SINO;
                    |SI swFiniq = 1;
                         || b_irpf = b_irpf + nBaseEste2;
                         || segsoc = segsoc + nSeguEste2;
                         || regularizo finiquitos, tengo que ver que tenia en
                         || el tipo cero del mes de baja para a¤adirlo a los
                         || ingresos acumulados hasta la fecha
                    |FINSI;
                    || esta en el historico
                    || es que si no los atrasos del mes en curso que esten
                    || ya actualizados pues no los pilla, es solo para eso
                    nDesdeTipo = 5;
                    nHastaTipo = 20;
                    |BUCLE historico;
                |FINSI;
          |SIGUE;
          |HAZ AcumPagas;
          |HAZ ConceptosV;
          |HAZ Graba012;
          b_irpf = #nomir012#84;
     |FINSI;
|FPRC;

|DEFBUCLE nomcalir0;
 #2#1;
 87, 17, 44, 29;
 #0#0, #0#2, #0#4, #0#6, "A", nDTipo;
 #0#1, #0#3, #0#5, #0#7, "A", nHTipo;
 ;
 NULL, pre_proceso;
|FIN;

|PROCESO nomir016;
     swOtraEmp = 1;
     || atencion, esto quiere decir que este trabajador tiene el mismo NIF
     || que el anterior y esta de alta en otra empresa al mismo tiempo, con lo
     || que hay que estimar a este, que es el segundo trabajador

     || me basare en la variable swOtraEmp para saber que esto es asi y en
     || las nEmpr99 y nTrab99 para saber cual es el trabajador original

     #0#0 = #nomir016#2;
     #0#1 = #nomir016#2;

     #0#2 = #nomir016#3;
     #0#3 = #nomir016#3;

     |BUCLE nomcalir0;
|FPRC;

|DEFBUCLE nomir016;
     #nomir016#1;
     ;
     nEmpr99, nTrab99, 00001, 00001;
     nEmpr99, nTrab99, 99999, 99999;
     ;
     NULL, nomir016;
|FIN;

|PROCESO tipo3;
     alfa1 = Usuario;
     |QBF alfa1;
     nomtmpca = "c3" + alfa1;
     nomtmpli = "c4" + alfa1;
     |NOME_DAT #11 nomtmpca;
     |NOME_DAT #12 nomtmpli;
     |DELINDEX #11;
     |DELINDEX #12;

     aAlfa2 = Usuario; |QBF aAlfa2; aAlfa2 = "u" + aAlfa2;
     |NOME_DAT #201 aAlfa2;
     |ABRE #201;

     |ABRET #09;
     |ABRET #10;
     |ABRET #11;
     |ABRET #12;
     |ABRE #nomconca;
     |ABRE #51;
     |ABRE #nomir012;
     el_anyo = #0#9 $ 100;

     segsoc = 0;
     swOtraEmp = 0;
     |BUCLE nomcalir0;

     swOtraEmp = 1;
     |BUCLE nomir016;
     swOtraEmp = 0;

     |SI seleccio = 0;|Y #0#11 = "N";|Y nCalculo99 = 0;
          |ATRI P;
          |MENAV mensaje0;
          |ATRI 0;
     |FINSI;

     |CIERRA #201;
     |CIERRA #nomir012;
     |CIERRAT #09;
     |CIERRAT #10;
     |CIERRAT #11;
     |CIERRAT #12;
     |CIERRA #51;
     |CIERRA #nomconca;
     |DELINDEX #11;
     |DELINDEX #12;
|FPRC;

|PROGRAMA;
     runnom = "nomcalir";
     |HAZ LeeEURODB;
     |SI nCalculo99 = 0;
          |CLS;
          |CABEZA "CALCULO IRPF";
          |DDEFECTO #0;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               nDTipo = 1;    nHTipo = 9;
               |HAZ tipo3;
          |FINSI;
     |SINO;
          #0#0 = nEmpr99; #0#1 = #0#0;
          #0#2 = nTrab99; #0#3 = #0#2;
          #0#9 = nAnyo99;
          nElAny = nAnyo99;
          nDTipo = 0;    nHTipo = 9;
          |HAZ tipo3;
          nEstima = b_irpf;
          nSeguri = segsoc;
     |FINSI;
|FPRO;

||****************************************************************************
||                  LLAMADAS DESDE EL MANTENIMIENTO
||****************************************************************************

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 1241, p_mes;
|FPRC;

|PROCESO mirames; |TIPO 7; ||calcula el mes por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;

|PROCESO defecto; |TIPO 7; ||calcula el a¤o por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    nume1 = alfa1;
|SI #0#13 = "S";              || a¤o anterior por defecto cuando va sobre
        nume1 = nume1 - 1;    ||/el historico de IRPF
|FINSI;
    #0Campo = nume1;
|PINTA #0Campo;
|FPRC;

|PROCESO lib_0;            || halla ultimo dia natural del mes
    mesnum = #0#8;
    anynum = #0#9;
|HAZ ulti_dia;
    guarda = topemes;      || cambia de variable para no perderlo
|FPRC;

|PROCESO noentre1; |TIPO 7;     || para (%) ejer. incom.
|SI #0#11 = "N"; |O #0#12 = "S";
    |CAMPO_MODIFICA #0#10, 1, "N";
|FINSI;
|FPRC;

|PROCESO noentre2; |TIPO 7;     || para (S/N) ejer. incom.
|SI #0#12 = "S";
        #0Campo = "N";
    |PINTA #0Campo;
    |CAMPO_MODIFICA #0#11, 1, "N";
|FINSI;
|FPRC;

|PROCESO anterior; |TIPO 0;
|SI #0#13 = "S";    alfa1 = "N";   alfa2 = "S";   |FINSI;
|SI #0#13 = "N";    alfa1 = "S";   alfa2 = "N";   |FINSI;
|C_M #0#10, 1, alfa1;
|C_M #0#11, 1, alfa1;
|C_M #0#12, 1, alfa1;
|C_M #0#14, 1, alfa2;
|FPRC;

||****************************************************************************
||         MODULO PARA EL CALCULO DEL (%) DE IRPF DE CADA TRABAJADOR
||****************************************************************************

|PROCESO incomple;
|HAZ incomple0;
|FPRC;

|PROCESO incomple0;   || COMPRUEBA QUE EL EJERCICIO SEA COMPLETO
|HAZ incomple1;  || desglosa fecha alta
|HAZ incomple2;  || desglosa fecha baja

    alfa2 = fecalta % 0402;  falta_m = alfa2;   || meses alta
    alfa2 = fecbaja % 0402;  gbaja_m = alfa2;   || meses baja

    meses = (gbaja_m - falta_m) + 1;    || diferencia meses

|SI meses < 12;
       sw_incom = 1;    || carga el switch para ejercicios incompletos
|FINSI;
|FPRC;

|PROCESO incomple1;    || FECHA DE ALTA PARA EL COMPUTO
|SI #2#36 ! "          "; |Y #2#36 ! "..........";
        fecsys1 = #2#36;
        nume1 = fecsys1;
|SINO;
        nume1 = 0;
|FINSI;
    alfa3 = #0#9;
    fecalf = "01.01." + alfa3;   || principio del a¤o actual
    fecsys2 = fecalf;
    nume2 = fecsys2;
|SI nume1 < nume2; |O nume1 = 0;
        fecalta = fecsys2;
|SINO;
        fecalta = fecsys1;
|FINSI;
|FPRC;

|PROCESO incomple2;    || FECHA DE BAJA PARA EL COMPUTO
|SI #2#37 ! "          "; |Y #2#37 ! "..........";
        fecsys1 = #2#37;
        nume1 = fecsys1;
|SINO;
     |SI #2#177 ! "          "; |Y #2#177 ! "..........";
        fecsys1 = #2#177;
        nume1 = fecsys1;
     |SINO;
        nume1 = 0;
     |FINSI;
|FINSI;
    alfa3 = #0#9;
    fecalf = "31.12." + alfa3;   || final del a¤o actual
    fecsys2 = fecalf;
    nume2 = fecsys2;
|SI nume1 > nume2; |O nume1 = 0;
        fecbaja = fecsys2;
|SINO;
        fecbaja = fecsys1;
|FINSI;
|FPRC;

/*
|PROCESO escala1;   || LEE LAS LINEAS DE LA ESCALA DE IRPF
|SI sw_esca = 0;
    |SI b_irpf [ #23#2;
            sw_esca = 1;
        |SI #2#29 = 9; #2#29 = 8; |FINSI;
            t_irpf = #2#29 + 3;
            p_irpf = #23t_irpf;    || carga el (%) de IRPF de la escala
        |SI p_irpf = 0;
                p_irpf = #0#15;    || (%) para cuando es cero
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE escala;
 #23#1;
 ;
 1,  1;
 1, 99;
 ;
 NULL, escala1;
|FIN;

|PROCESO porcenta; || BUSCA EL PORCENTAJE CORRESPONDIENTE
    p_irpf = 0;
|SI sw_incom = 1;
        sw_esca = 1;
        p_irpf = #0#10;   || incompleto
|SINO;
        sw_esca = 0;
    |BUCLE escala;
|FINSI;
|FPRC;

|PROCESO grabatra;   || REGRABA EL TRABAJADOR CON EL (%) IRPF CALCULADO
|SI sw_esca = 1;
    |ABRE #52;
        #52#0 = #2#0;
        #52#1 = #2#1;
    |LEE 101#52=;
        FEstado = FSalida;
    |DDEFECTO #52;
        #52#0 = #2#0;
        #52#1 = #2#1;
        #52#2 = #2#29;
        #52#3 = b_irpf;
        #52#4 = #2#30;
        #52#5 = p_irpf;
        #52#6 = meses;
        #52#7 = #0#9;
    |SI FEstado = 0;  |GRABA 020#52a;  |FINSI;
    |SI FEstado ! 0;  |GRABA 020#52n;  |FINSI;
    |LIBERA #52;
    |CIERRA #52;
|FINSI;
|FPRC;
*/

||****************************************************************************
||         CALCULOS ESPECIALES PARA EL nomcalir
||****************************************************************************

|PROCESO leeregis;    || recarga variables (nomcalir)
    #11#0 = #2#0;
    #11#1 = #2#1;
    #11#2 = #0#8;
    #11#3 = 0;
|SI #2#237 = "N";                  || variables para los pluriempleados
        grupo = #2#33;
        propo = 100;
|SINO;
        grupo = #2#236;       || grupo mayor de cotiz. en pluriempleo
        propo = #2#235;       || proporcion en pluriempleo
|FINSI;

    fijo_1 = 0;       || dias cotizados citricos
    cabecera = 0;     || switch para ver si tiene que grabar cabecera al final
    antici1 = 0;
    antici2 = 0;
    especie = 0;

|SI #2#64 ! "M";|Y #2#64 ! "D";    || clave cotizacion
        #2#64 = #labtraba#42;
|FINSI;

    es_aprendi = 0;
|SI #2#45 = "87";|O #2#45 = "97";|O #2#45 = "85"; es_aprendi = 1;     |FINSI;
|FPRC;

|PROCESO t_parcial;                || proporcion tiempo parcial
     tp1 = 40;
     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T"; |O #labtraba#42 = "P"; |O #labtraba#42 = "I";
          tp2 = #nomconca#162;
     |SINO;
          tp2 = 40;
     |FINSI;
     tpx = -1;

    es_parcial = 0;
|SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
        es_parcial = 1;
    |SI #2#234 ! 0;  tp1 = #2#234;  |FINSI;
        concepto = 910; |HAZ t_parcial2; |SI tp3 ! -1; tp1 = tp3; |FINSI;
        concepto = 912; |HAZ t_parcial2; |SI tp3 ! -1; tp1 = tp3; |FINSI;

        concepto = 909; |HAZ t_parcial2; |SI tp3 ! -1; tp2 = tp3; |FINSI;
        concepto = 911; |HAZ t_parcial2; |SI tp3 ! -1; tp2 = tp3; |FINSI;
|FINSI;
    tp = tp1 / tp2;

    es_irregul = 0;
|SI #labtraba#42 = "I";|O #labtraba#42 = "P";
        concepto = 914; |HAZ t_parcial2; |SI tp3 ! -1; tpx = tp3; |FINSI;
        es_irregul = 1;
|FINSI;

|SI tpx ! -1;  tpz = tpx;  |SINO;  tpz = #2#46;  |FINSI;
|FPRC;

|PROCESO t_parcial2;
    tp3 = -1;
|ABRE #4;
    #4#0 = #2#87; #4#1 = #2#17; #4#2 = concepto;
|LEE 000#4=;
|SI FSalida = 0; tp3 = #4#3; |FINSI;
|CIERRA #4;

|ABRE #6;
    #6#0 = #2#0;  #6#1 = #2#1;  #6#2 = concepto;
|LEE 000#6=;
|SI FSalida = 0; tp3 = #6#3; |FINSI;
|CIERRA #6;

|ABRE #8;
    #8#0 = #2#0;  #8#1 = #2#1;  #8#2 = #0#8;  #8#3 = 0;  #8#4 = concepto;
|LEE 000#8=;
|SI FSalida = 0; tp3 = #8#5; |FINSI;
|CIERRA #8;
|FPRC;

|PROCESO caldias;        || CALCULA DIAS VARIOS
|HAZ cerodias;           || inicializa variables
    dia_k = diafest;     || dias festivos del mes
    dia_1 = dialabo;     || dias laborables del mes
    dia_2 = topemes;     || dias que tiene el mes
    dia_3 = 30;          || dias cotizacion 'mensual'
|SI #labtraba#42 = "D";|O #labtraba#42 = "T";
        dia_3 = topemes; || dias cotizacion 'diario'
|FINSI;
    swmarca = "B";
|HAZ altas;              || calcula dias de alta (en su caso)
|HAZ bajas;              || calcula dias de baja (en su caso)
     || variables paralelas para los mensuales diarios o diarios mensuales
    hbaja_2 = dbaja_2;
|HAZ diatodos;           || calcula totales dias
|HAZ bonif;              || calcula dias bonificacion
|FPRC;

|PROCESO diatodos;                  || CALCULA TOTALES FINALES DE DIAS
    dia_4 = dia_3;

    hdias_0=dia_4;       || pueden ser mensuales diarios y diarios menusales
|SI #2#64 ! #labtraba#42;
    |SI #2#64 = "D";
            hdias_0=dia_2;
    |SINO;
            hdias_0=   30;
    |FINSI;
|FINSI;

|SI swbaja ! 0;|Y dbaja_2 ! 0;
        nume1 = dia_4 - (dalta_2 + dbaja_2);
        nume1 = nume1 - ((dbaja_3 - dalta_3) + 1);
        dbaja_2 = dbaja_2 + nume1;
|FINSI;

|SI swbaja ! 0;|Y hbaja_2 ! 0;
        nume1 = hdias_0 - (dalta_2 + hbaja_2);
        nume1 = nume1 - ((dbaja_3 - dalta_3) + 1);
        hbaja_2 = hbaja_2 + nume1;
|FINSI;

    dcobr_0=dia_4-(dalta_2+dbaja_2);
    dcoti_0=dia_4-(dalta_2+dbaja_2);
    dlabo_0=dia_1-(dalta_1+dbaja_1);
    dlabi_0=dia_1-(dalta_1+dbaja_1);
    dlabo_k=dia_k-(dalta_k+dbaja_k);
    dlabi_k=dia_k-(dalta_k+dbaja_k);

    hcobr_0=hdias_0-(dalta_2+hbaja_2);
    hcoti_0=hdias_0-(dalta_2+hbaja_2);

|SI dcobr_0 < 0;  dcobr_0 = 0;  |FINSI;  || dias cobro
|SI dcoti_0 < 0;  dcoti_0 = 0;  |FINSI;  || dias cotizables
|SI dlabo_0 < 0;  dlabo_0 = 0;  |FINSI;  || dias laborables 1
|SI dlabi_0 < 0;  dlabi_0 = 0;  |FINSI;  || dias laborables 2
|SI dlabo_k < 0;  dlabo_k = 0;  |FINSI;  || dias festivos 1
|SI dlabi_k < 0;  dlabi_k = 0;  |FINSI;  || dias festivos 1
|SI hcobr_0 < 0;  hcobr_0 = 0;  |FINSI;  || dias cobro sin dec.
|SI hcoti_0 < 0;  hcoti_0 = 0;  |FINSI;  || dias cotiz. sin dec.

    vcobr_0=dcobr_0;
    vcoti_0=dcoti_0;
    vlabo_0=dlabo_0;     || dias laborables menos vacaciones
    vlabo_k=dlabo_k;     || dias festivos menos vacaciones

    dia_4 = dia_3;  || recupera dias cotizables

    dcofi_1 =dcobr_0 /dia_4;        || coeficiente para dias cobro
|SI dcofi_1 > 1;    dcofi_1 = 1;   |FINSI;
    dcofi_2 =dcoti_0 /dia_4;        || coeficiente para dias cotizables
    dcofi_3 =dcofi_1;  || coefi. para no dto. enfermed.
    dcofi_4 =dcofi_1;  || coefi. no dto. acc.
    dcofi_5 =1;          || coefi. para vacacion  N1
    dcofi_6 =0;          || coefi. para vacacion  E1 y E2
    dcofi_7 =1;          || coefi. para vacacion  N2
|FPRC;

|PROCESO OtroNIFCalc;
     |SI nEmp ! #labtraba#0; |Y #nomir009#20 = 1;
          |ACABA;
     |FINSI;

     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = any - 2000;
     #nomhicca#2 = los_meses;
     #nomhicca#3 = 0;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          swfuera = 1;
     |FINSI;

     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = any - 2000;
     #nomhicca#2 = los_meses;
     #nomhicca#3 = 1;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          swfuera = 1;
     |FINSI;
|FPRC;

|DEFBUCLE OtroNIFCalc;
     #labtraba#2;
     ;
     aNifTra;
     aNifTra;
     ;
     NULL, OtroNIFCalc;
|FIN;

|PROCESO chequea_alta;  || chequea el trabajador este en periodo de alta
     swfuera = 0;
     |SI #labtraba#42 ! "A"; |Y #labtraba#42 ! "B"; |Y #labtraba#42 ! "E";
          swAgrario = 0;
     |SINO;
          swAgrario = 1;
     |FINSI;
     fecalf = #2#36;   || fecha de alta
     |HAZ desglosa;
     |SI any > #0#9;|O any = 0;
          swfuera = 1;
     |SINO;
          |SI mes > #0#8; |Y any = #0#9;
               swfuera = 1;
          |FINSI;
     |FINSI;
     |SI swfuera = 0;
          |SI #2#37 ! "          "; |Y #2#37 ! "..........";
               fecalf = #2#37;  || fecha de baja
          |SINO;
               fecalf = #2#177;  || fecha de baja
          |FINSI;
          |HAZ desglosa;
          |SI any < #0#9; |Y any ! 0;
               swfuera = 1;
          |SINO;
               |SI mes < #0#8; |Y any = #0#9; |Y mes ! 0;
                    swfuera = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |ABRE #nomir009;
     #nomir009#0 = #labtraba#0;
     |LEE 000#nomir009.=;
     |CIERRA #nomir009;
     |SI #nomir009#17 = 3;
          |ABRE #nomhicca;
          aNifTra = #labtraba#7;
          |SALVA_FICHA #labtraba;
          |BUCLE OtroNIFCalc;
          |REPON_FICHA #labtraba;
          |CIERRA #nomhicca;
     |FINSI;
|FPRC;

|PROCESO pintalo_irpf;
|PINTA 1934, #2#0;
|PINTA 1955, #2#1;
|PINTA 1968, #0#8;
|FPRC;

|PROCESO cerodias;     || INICIALIZA VARIABLES DEL CALCULO DE DIAS
    dalta_1 = 0;   dalta_2 = 0;   dalta_k = 0;
    dbaja_1 = 0;   dbaja_2 = 0;   dbaja_k = 0;
    dhuel_1 = 0;   dhuel_2 = 0;   dhuel_k = 0;   dhuel_3 = 0;
    ddese_1 = 0;   ddese_2 = 0;   ddese_k = 0;
    dabse_1 = 0;   dabse_2 = 0;   dabse_k = 0;   dabse_3 = 0;
    dperm_1 = 0;   dperm_2 = 0;   dperm_k = 0;
    dacci_0 = 0;   dacci_1 = 0;   dacci_k = 0;   dacci_2 = 0;    dacci_3 = 0;
    denfe_0 = 0;   denfe_1 = 0;   denfe_k = 0;   denfe_2 = 0;
    denfe_21 = 0;  denfe_22 = 0;  denfe_23 = 0;  denfe_24 = 0;
    dacci_21 = 0;  dacci_22 = 0;  dacci_23 = 0;  dacci_24 = 0; dacci_20 = 0;
    denfe_3 = 0;   denfe_4 = 0;
    denfe_3_H = 0;
    denfe_A = 0;   denfe_B = 0;   denfe_C = 0;   denfe_D = 0;
    dmate_0 = 0;   dmate_1 = 0;   dmate_k = 0;   dmate_2 = 0;    dmate_3 = 0;
    dvaca_1 = 0;   dvaca_2 = 0;   dvaca_k = 0;
    dboni_1 = 0;   dboni_2 = 0;
    dtodo_3 = 0;
    topemes1 = 0;  topemes2 = 0;
    topemes = guarda;             || restaura ultimo dia natural del mes
    dialabo = conser1;            || restaura dias laborables del mes
    diafest = conser2;            || restaura dias festivos del mes
    swaju_mat = 0;
    swaju_acc = 0;
    swaju_des = 0;
    swaju_enf = 0;
    swaju_hue = 0;
    swaju_abs = 0;
    swaju_vac = 0;
    swaju_per = 0;
    histori = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";  || hay 31 as
    dacum_vac = 0;
    acum1_200 = 0;
    acum2_200 = 0;
    acump_200 = 0;
    sw_mater = 0;
    guarda_l = 0;
    dreca_0 = 0;
    dreca_1 = 0;
    dreca_2 = 0;
    dreca_3 = 0;
    dreca_4 = 0;
     swMater = 0;
     swPater = 0;
     swRiesgo = 0;
|FPRC;

|PROCESO Hospital;

|FPRC;

|PROCESO BuscaOtroAlta;

|FPRC;
