|FICHEROS;
     nomrecib #0;  || def de impresion
     nomcalcu #40;  || parrilla de codigos
     nomcalat #41;  || parrilla de codigos atrasos
     labempre #1;  || empresas
     labtraba #2;  || trabajadores
     nomconst #3;  || constantes                 **********************
     nomcalca #4;  || calculo cabeceras          * OJO QUE ESTO  ESTA *
     nomcalli #5;  || calculo lineas             * CERCANO A LAS OCHO *
     labcentr #6;  || centros de trabajo         *    MIL LINEAS:     *
     nomtrnom #10;  || def nomina                 *                    *
     nomcenes #35;  || centros 18/93              *  ­­­ CUIDADO !!!   *
     nomcontr #36;  || control                    **********************
     nomdesam #100; || descrip. ampliadas
     nomtraca #101; || trabajadores cabs.
     nomconca #102; || convenios cabs.
     nomvarca #103; || variaciones empresa mes
     nomhicca #11;  || historico
     nomhicli #12;

     ||nomcalac #13;  || atrasos

     nomcalal #14;
     nomtrabi #15;  || def nomina abierta
     nomtmpca #93;
     nomtmpli #94;
     nomtmphc #95;
     nomtmphl #96;
     nomvart3 #99;
     nomimpra;      || Registro tipos IRPF en Paga Extra Dic Cabs.
     nomimpre;      || Registro tipos IRPF en Paga Extra Dic Lins.

     nomgruec;
     nomgruel;
     nompagfe;      || fecha recibi paga extra por convenio
     nombanco;

     labtraba;
     pdfimtmp #200;
     pdfdocca;
     pdfdocli;
     :/basica/def/agidanif #8;
     &bancosc@  #709;
     nomgirco;
     nomcont1;
     nomcont3;
|FIN;

|VARIABLES;
     &enGrupoTres = 0; &enSubGTres = 0; &enTipoTres = 0;
     &enSwMeteGrupoSubTipo = 0; &enSwDesde9 = 0;

     aMensaje = ""; nVar = 0;  aLong = ""; nLong = 0; aMod = ""; nPara = 0;
     nAlfa = 0; &enCodBanco = 0;  nDec = 0; alfacampo = ""; aVar = "";
     &nEmpresa = 0;
     &nTrabajador = 0;
     &nMes = 0;
     &nTipo = 0;
     d_para1 = 0;
     d_conc = 0;
     d_paga = 0;
     d_diasp = 0;
     d_porcp = 0;
     d_tipos = 0;
     d_campo = 0;
     concep1 = 0;
     concep2 = 0;
     desc = 0;
     hasc = 0;
     actc = 0;
     concepto = 0;
     duni1_999 = 0; duni2_999 = 0; dvalo_999 = 0;
     duni2_200 = 0; dvalo_200 = 0; dprod_200 = 0;
     dreal_200 = 0;
     product = 0;
     divide = 0;
     dia_2 = 0;
     dia_4 = 0;
     sd_bucle = 0;
     d_tipo_p = 0;
     d_entrada = 0;
     dcociente = 0;
     dnume1 = 0;
     dnume2 = 0;
     dbisiesto = 0;
     dalfa1 = "";
     dtopemes = 0;

     desglo="";
     dsalte_1 = 0;
     dsalte_2 = 0;
     nDesdeFuera=0;
     informe="";
     &poblafir = "";
     &causa = "";
     &importe = 0;
     &unidade = 0;
     &elvalor = 0;
     &liquido = "";
     &nLiquido = 0;

     &uniant=0;
     camctos = 0; camunia = 0; camunid = 0; camvalo = 0;
     &infunia = 0; &infctos = 0; &infptas = 0; &infdesc = "";
     &infvalo = 0; &infunid = 0;

     alguno = 0;
     linea16 = 0;
     &ninguno = 0;
     situac2 = 0;
     i=0;
     mes_i = 0;
     &afili = "";
     alfa1 = ""; alfa2 = ""; alfa3 = ""; alfa4 = "";
     anyo = 0;
     anyrec = 0;
     anytra = 0;
     anypaga = 0;
     apordfp = 0;
     apord = 0;
     aporfp = 0;
     aporhe1 = 0;
     aporhe2 = 0;
     arteris = "";
     bisiesto = 0;
     &camdesc = 0;
     campo = 0;
     camptas = 0;
     coment = 0;
     &concep = 0;
     dcal_101 = "";
     deducir = 0;
     desacc = 0;
     &descri = "";
     desdia = 0;
     desenf = 0;
     diaalta = 0;
     diabaja = 0;
     diarec = 0;
     diatra = 0;
     &domemp = "";
     duni_101 = 0;
     dval_101 = 0;
     duni_102 = 0;
     fecsys = @;
     fectra = "";
     hasacc = 0;
     hasdia = 0;
     hasenf = 0;
     &import = 0;
     &incluye = 0;
     lineas = 0;
     &mesalf = "";
     mesalta = 0;
     mesbaja = 0;
     mesliq = "";
     &mesnum = 0;
     mesrec = "";
     mestra = 0;
     nume1 = 0; nume2 = 0; nume3 = 0; nume4 = 0; numer = 0;
     nro_copias = 0;
     p_mes = "";
     pantalla = 0;
     &pobemp = "";
     &seleccio = 0;
     situac = 0;
     sw_comen = 0;
     swbaja = 0;
     swtacc = 0;
     swtenf = 0;
     tantici = 0;
     taporta = 0;
     tbcotiz = 0;
     tcotiz = 0;
     &topemes = 0;
     tot_109 = 0; tot_110 = 0; tot_111 = 0; tot_112 = 0;
     tot_113 = 0; tot_114 = 0; tot_115 = 0; &unidad = 0;
     &valor = 0;
     deci_h = 0;
     sw_control = 0;
     CodigoCons = 0;
     cta_co = "";
     salte_1 = 0;
     salte_2 = 0;

     &acum = 1;
     &runnom = "nomyreci";
     guarda_emp = 0;
     guarda_cen = 0;
     guarda_are = "";
     guarda_sec = "";
     el_66 = 0; el_67 = 0; el_68 = 0; el_69 = 0; el_70 = 0; el_71 = 0;
     el_72 = 0; el_73 = 0; el_74 = 0; el_75 = 0; el_76 = 0; el_77 = 0;
     sw_equiv = 0;
     ante_emp = 0;
     ante_tra = 0;
     el_a00 = 0;
     el_a31 = 0;
     el_a32 = 0;
     el_a33 = 0;
     el_a34 = 0;
     el_a35 = 0;
     mesliq1 = "";
     mesliq2 = "";
     &EURODB = 0;
     &swDesdeWeb = 0;
     duni_hest = 0;
     duni_hnoest = 0;
     swPrimerMes = 0;
     nDesdeEmp = 0;
     nHastaEmp = 0;
     nDesdeTra = 0;
     nHastaTra = 0;
     swPorGrupos = 0;
     nGrupo = 0;
     nCampoG = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nCampo = 0;
     nPaga = 0;
     nNume = 0;

     &aCError = "";
     &fCFecha = @;
     &nCConst = 0;
     &enCanti = 0;
     &eaMoneda = "";
     &aMonedaRec = "";

     nAscii = 0;
     aCaracter = "";
     aCaracterSal = "";
     aCadena = "";
     aCadenaSal = "";
     nPos = 0;
     nBusca = 0;
     &aValor = "";
     aCampo = "";
     &swCopia = 0;
     &aID = "";
     &enWeb = 0;
     &eaWebDirPDF = "";
     &eaWebArchivo = "";
     &eaWebDirDes = "";
     aTipoEmiAt = "";
     nSwNumer = 0;
     &aListaFich = "";
     &swPDFMasivo = 0;
     aLongitud = "";
     nLongitud = 0;
     &aArchivo = "";
     &nContador = 0; &nContadorImp = 0;
     &nContador2 = 0;
     &aContador = "";
     &aParam = "";
     &aParam1 = "";
     &aParam2 = "";
     &aProcedencia = "";
     para1 = 0;
     para2 = 0;
     &nNroCopias = 0;
     nNume1 = 0;
     nNume2 = 0;
     &nEdad = 0;
     &fFecha = @;
     &nDesc3 = 0;
     &nDesc25 = 0;
     &nAscen = 0;
     &swComercio = 0;
     &nEnfer = 0;
     &nAccid = 0;
     para3 = 0;
     nAny = 0;
     &nConcepto = 0;
     &FEstado = 0;
     &swModulo = 0;
     swCarga = 0;
     swHaEntrado = 0;
     swAgrupa = 0;
     aAgrupa = "";
     aNormal = "";
     situac_ult = 0;
     nPos1 = 0;
     aAlfa3 = "";
     situcon = 0;
     &aOrden = "";
     &tipoit = "";
     &nEmbargo = 0;
     nPropDesTP = 0;
     nDiasDesTP = 0;
     nDias = 0;
     &retoded = "";
     &nEmp = 0;
     &nTra = 0;
     &nTraNoEmi = 0;
     &swHayIncid = 0;
     &nArchi = 0;
 {-1}aMenu  = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Archivo documental activado. Elija opci¢n: ";
     aMenu4 = "IAB";
     aMenu5 = "Imprimir";
     aMenu6 = "Archivar";
     aMenu7 = "Ambos";
     &nOpcion = 0;
     &swEmailDirecto = 0;     || de momento para el modulo de Salus Baleares
     &swImpDirecto = 0;     || de momento para el modulo de Salus Baleares
     &aImpresora = "";
     &swPasada = 0;
     &swErrorDSArchi = 0;
     &nEmision = 0;
     &swNoArchives = 0;
     &nCuadre = 0;
     &nEmpresaLogo = 0;
     &enTipoAt = 0;
     &swParamEmpresa = 0;
     &aTipoIT = "";
     &nDiasIT = 0;
     nContrato = 0;
     &enSwSimulacion = 0;
     &eaFichSimBox = "";
     c_informe = "";
     sw_cuadre = 0;
     nTipoAt = 0;
|FIN;

||INCLUYE i_cuadr;
||INCLUYE i_pdfrec;
||INCLUYE i_nomre2;
||INCLUYE i_nomcr;

||****************************************************************************
||******* LIBRERIAS **********************************************************
||****************************************************************************

|PROCESO ElFININF_3;
     |SI nOpcion = 0; |O nOpcion = 1;   || no tengo DSArchi o he pedido impresion
          |SI swDesdeWeb = 0; |Y aParam1 ! "PDF"; |Y Impresora ! "CrystalReport";
               |FININF;
          |FINSI;
     |SINO;
          |FININF;
          |SI swErrorDSArchi = 0;
               |HAZ Mensaje;
               |HAZ Archivando;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ElIMPRE_3;
     |SI nArchi = 1;
          FEstado = 0;
          |SI swEmailDirecto = 0;       || = 1 VA DIRECTO POR EMAIL SIN PREGUNTAR
               |SI swImpDirecto = 0;    || = 1 VA DIRECTO POR IMPRE. SIN PREGUNTAR
                    |SI swPasada = 0;
                         |SI #0#67 = "T";
                              aMenu4 = "IA";
                              aMenu5 = "Imprimir";
                              aMenu6 = "Archivar";
                         |FINSI;
                         |MENU aMenu;
                         nOpcion = FSalida;
                    |SINO;         || solo es posible que sea 2
                         nOpcion = 2;
                    |FINSI;
               |SINO;
                    nOpcion = 0;
               |FINSI;
          |SINO;
               nOpcion = 2;
          |FINSI;
     |SINO;
          nOpcion = 0;
     |FINSI;
     |SI nOpcion = 3;
          nOpcion = 1;
          swPasada = 1;
     |FINSI;
     |SI nOpcion = 0; |O nOpcion = 1;   || no tengo DSArchi o he pedido impresion
          |SI aParam = "AUTO"; || en auto no me pidas impresora
               aImpresora = "CrystalReport";
          |FINSI;
          |SI swDesdeWeb = 0; |Y aParam1 ! "PDF";
               |SI aImpresora = "";
                                             || en la variable aImpresora me
                    |IMPRE 0;                || guardo la impresora, asi en
                    aImpresora = Impresora;  || las emisiones de varios meses
               |SINO;                        || solo pregunta una vez
                    Impresora = aImpresora;
                    |IMPRE -1;
               |FINSI;
               FEstado = FSalida;
          |FINSI;
          |SI Impresora = "CrystalReport";
               |HAZ Literales;
               |HAZ BuscaCrystal;
               |SI #0#68 ! "F";
                  |HAZ cuadre_emp;
                  |SI #0#69 ! "A";
                       |INFOR "nomycrys";
                  |SINO;
                       |INFOR "nomyabie";
                  |FINSI;
              |SINO;
                  |SI #0#13 = "F";
                      |INFOR "nomccalf";
                  |SINO;
                      |HAZ cuadre_emp;
                      |INFOR "nomycrys";
                  |FINSI;
              |FINSI;
               |SI #nomcontr#60 = "S"; |HAZ IniciaRegistro; |FINSI;
          |FINSI;
     |SINO;
          |SI nOpcion = 2;
               Impresora = "CrystalReport";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ElFINIMP_3;
     |SI nOpcion = 0; |O nOpcion = 1;   || no tengo DSArchi o he pedido impresion
          |SI Impresora = "CrystalReport";
               |FININF;
               |HAZ recupera_cuadres;
          |FINSI;
          |SI swDesdeWeb = 0; |Y aParam1 ! "PDF";
               |FINIMP;
               |SI #nomcontr#60 = "S"; |HAZ TerminaRegistro; |FINSI;
          |FINSI;
     |SINO;
          |SI seleccio ! 0; |Y swNoArchives = 0;
               |SI swErrorDSArchi = 0;
                    |MENAV "    Se han enviado al archivo documental los recibos de nómina emitidos.";
                    aAlfa = ":dsarchi/dpntz001;CLI";
                    |SUB_EJECUTA aAlfa;
               |SINO;
                    |MENAV "    No se han archivado las nóminas debido a los errores previos.";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ElINFOR_3;
     |SI nOpcion = 0; |O nOpcion = 1;   || no tengo DSArchi o he pedido impresion
          |SI swComercio = 1;
               c_informe = "nomyreco";
          |SINO;
               c_informe = "nomyreci";
          |FINSI;
          |INFOR c_informe;
     |FINSI;
|FPRC;

|PROCESO imprime_3;
     |SI nOpcion = 2;  |Y #nomrecib#69 ! "A";  || al DSArchi
          |HAZ IMPREArchi;
     |FINSI;
     |SI Impresora ! "CrystalReport"; |Y nOpcion ! 2;
          |HAZ ElINFOR_3;
     |FINSI;
     |SI swDesdeWeb = 0; |Y aParam1 ! "PDF";
          |SI #0#69 ! "A";
               |SI #0#63 = 6;
                    aAlfa = #10#2;
                    |QBF aAlfa;
                    aAlfa = ("00000" + aAlfa) % -105;
                    aOrden = #10#3;
                    aOrden = #10#3 + aAlfa;
               |SINO;
                    nContadorImp = nContadorImp + 1;
                    aOrden = nContadorImp;  |QBF aOrden; aOrden = ("0000" + aOrden) % -104;
               |FINSI;
          |FINSI;
          |HAZ Comentarios;
          |SI nOpcion = 1; |O nOpcion = 3; || impresion
               |SI #nomcontr#60 = "S"; |HAZ GuardaRegistro; |FINSI;
               nContador2 = nContador2 + 1
          |FINSI;
          |SI #0#69 ! "A";
               |PRINT;
          |FINSI;
          |PIEINF;
     |FINSI;
     |HAZ ElFININF_3;
|FPRC;

|PROCESO FinTotales_3;     || moneda y varios temas finales
     enCanti = #10#142;       ||  conversion de liquidos a euros o a pesetas
     |HAZ ConverMoneda2;
     #10#173 = aMonedaRec;
     #10#174 = enCanti;

     || liquido cero si negativo
     |SI #10#142 < 0; |Y #labtraba#141 = "S"; #10#142 = 0; |FINSI;
|FPRC;

|PROCESO cta_cotizacion_3;
     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
     |O #2#45 = "064";|O #2#45 = "065"; |O #2#45 = "421"; |O #2#45 = "422";
          |DDEFECTO #35;
          #35#0 = #2#0;
          #35#13= #2#77;
          |SI #2#45 = "097";|O #2#45 = "085"; |O #2#45 = "421"; |O #2#45 = "422";
               #35#1 = "87";
          |SINO;
               |SI #2#45 = "065";
                    #35#1 = "64";
               |SINO;
                    #35#1 = #2#45 % 2;
               |FINSI;
          |FINSI;
          |LEE 000#35=;
          cta_co = #35#10;      || cta.cto. del centro de trabajo especial
     |SINO;
          cta_co = #1#13;       || cta.cot. de la empresa
          |DDEFECTO #6;
          #6#0 = #2#0;
          #6#1 = #2#77;
          |LEE 000#6=;
          |SI #1#45 = "S";
               cta_co = #6#10;        || cta.cot. centro de trabajo
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO control_3;
     |DDEFECTO #36;
     |ABRE #36;
     |LEE 000#36p;
     |SI FSalida ! 0;
         |MENAV "    No existe control, usando defectos ...";
     |FINSI;
     |CIERRA #36;
|FPRC;

|PROCESO lib_0_3;        || CONVIERTE A LITERAL MES EN NUMERO Y HALLA ULTIMO DIA
                       || PARAMETROS ENTRADA:  'mesnum', 'anynum'
                       || PARAMETROS SALIDA:   'mesalf', 'topemes'
     aTipoIT = mesnum;
     |QBF aTipoIT;
     aTipoIT = ("00" + aTipoIT) % -102;
     |HAZ LiteralIT;
     mesalf = aValor;
     topemes = 31;
     |SI mesnum = 4; |O mesnum = 6; |O mesnum = 9; |O mesnum = 11;
          topemes = 30;
     |FINSI;
     |SI mesnum = 2;
          numer = #0#4 $ 4;
          |SI numer = 0; topemes = 29;  |SINO;  topemes = 28;  |FINSI;
     |FINSI;
     |SI mesnum =  0;  mesalf = "          ";  topemes =  0;  |FINSI;

     aTipoIT = "52";
     |HAZ LiteralIT;
     #10#234 = aValor;
|FPRC;

|PROCESO lib_1_3;        || SEPARA UNA FECHA DADA EN DIA,MES Y A¥O
                       || PARAMETROS ENTRADA:  'fectra'
                       || PARAMETROS SALIDA:   'diatra', 'mestra', 'anytra'
                       || VARIABLES: G_
         diatra = 0;
         mestra = 0;
         anytra = 0;
     |SI fectra ! "          "; |Y fectra ! "..........";
         alfa1 = fectra % 102;
         diatra = alfa1;
         alfa1 = fectra % 402;
         mestra = alfa1;
         alfa1 = fectra % -102;
         anytra = alfa1;
     |FINSI;
|FPRC;

|PROCESO comple_0_3;           || LEE EMPRESA,TRABAJADOR,CONSTANTE Y CENTRO
     |DDEFECTO #1;
     #1#0 = nEmp;
     |LEE 020#1=;             || empresa
     |HAZ ParamEmpresa;
     |DDEFECTO #2;
     #2#0 = nEmp; #2#1 = nTra;
     |LEE 020#2=;             || trabajador
     nCConst = #labtraba#248; |HAZ constante_3;
     |HAZ Centro;
     |HAZ Auxiliar;
     duni_hest = 0;           || inicializa variables acumuladoras del
     duni_hnoest = 0;         || nro. de horas extras estructurales y no estruct.
     |DDEFECTO #102;
     #102#0 = #2#87;
     |LEE 000#102=;
     #2#25 = #102#1;
     |HAZ LogoEmp_3;
|FPRC;

|PROCESO comple_1_3;       || CONSTRUYE LITERALES DATOS EMPRESA
     |SI #0#9 = 1; alfa1 = #1#03; |SINO; alfa1 = #6#03; |FINSI;
     |SI #0#9 = 1; alfa2 = #1#04; |SINO; alfa2 = #6#04; |FINSI;
     |SI #0#9 = 1; alfa3 = #1#05; |SINO; alfa3 = #6#05; |FINSI;
     |QBF alfa1; |QBF alfa2; |QBF alfa3;
     domemp = alfa1 + " " + alfa2 + " " + alfa3;  || domicilio empresa
     |SI runnom = "nomycalf"; |Y #0#10 = 2; |Y #1#39 = "3";
          domemp = alfa1;  || domicilio empresa
          |SI #0#9 = 2;
               #1#04 = #6#04;
               #1#05 = #6#05;
          |FINSI;
     |FINSI;
     |SI #0#9 = 1; alfa1 = "00" + #1#07; |SINO; alfa1 = "00" + #6#07; |FINSI;
     |SI #0#9 = 1; alfa2 = "000" + #1#08;|SINO; alfa2 = "000" + #6#08;|FINSI;
     alfa1 = alfa1 % -102;
     alfa2 = alfa2 % -103;
     alfa3 = "(" + alfa1 + alfa2 + ") ";
     |SI #0#9 = 1; alfa1 = #1#06; |SINO; alfa1 = #6#06; |FINSI;
     |QBF alfa1;
     pobemp = alfa3 + alfa1;                      || poblacion empresa
     |SI runnom = "nomycalf"; |Y #0#10 = 2; |Y #1#39 = "3";
          pobemp = alfa1;                      || poblacion empresa
          |SI #0#9 = 2;
               #1#9 = #6#9;
          |FINSI;
     |FINSI;
     afili = #6#10;
     |QBF afili;
     |SI afili = "";
          afili = #1#13;
     |FINSI;
     ||HAZ afili_agr;
     |SI #4#9 = 87; |O #4#9 = 85; |O #4#9 = 97; |O #4#9 = 64; |O #4#9 = 65;
     |O #4#9 = 421; |O #4#9 = 422;
          |DDEFECTO #35;
          #35#0 = #2#0;
          #35#13 = #2#77;
          |SI nContrato = 421; |O nContrato = 422;
               #35#1 = 87;
          |FINSI;
          |LEE 000#35=;
          afili = #35#10;
     |FINSI;
|FPRC;

|PROCESO TipoIT_3;
     |SI tipoit = "E"; tipoit = "Enfermedad"; |FINSI;
     |SI tipoit = "A"; tipoit = "Accidente"; |FINSI;
     |SI tipoit = "H"; tipoit = "Huelga"; |FINSI;
     |SI tipoit = "F"; |O tipoit = "f"; tipoit = "Absentismo"; |FINSI;
     |SI tipoit = "M"; tipoit = "Maternidad"; |FINSI;
     |SI tipoit = "P"; tipoit = "Paternidad"; |FINSI;
     |SI tipoit = "R"; tipoit = "Riesgo Emb"; |FINSI;
     |SI tipoit = "C"; tipoit = "IT Cont.SS"; |FINSI;
     |SI tipoit = "V"; tipoit = "Vacaciones"; |FINSI;
     |SI tipoit = "D"; tipoit = "Desempleo"; |FINSI;
     |SI tipoit = "S"; tipoit = "Perm.s/ret"; |FINSI;
|FPRC;

|PROCESO constante_3;
     alfa1 = "01";
     alfa2 = #0#5;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     nume1 = 2000 + #0#4;
     alfa3 = nume1;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
     |SI aCError ! "";
          |SI nCConst = 500;
               aAlfa = "0000No se ha encontrado la Constante Comun del ";
               aAlfa = aAlfa + " Regimen General (500)";
               |MENAV aAlfa;
          |SINO;
               alfa1 = #labtraba#0; alfa1 = "00000" + #labtraba#0; alfa1 = alfa1 % -105;
               alfa2 = #labtraba#1; alfa2 = "00000" + #labtraba#1; alfa2 = alfa2 % -105;
               aAlfa = "0000ATENCION: Trabajador: " + alfa1 + "." + alfa2;
               aAlfa = aAlfa + " La constante del trabajador no esta definida.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LogoEmp_3;
     nEmpresaLogo = #labempre#0;                  || imprime logo por empresa si hay
     |SI #nomcont1#9 ! 0; |Y #nomcont1#10 ! 0;    || imprime logo general
          nEmpresaLogo = 0;
     |FINSI;
     |SI #nomcont1#9 = 0; nEmpresaLogo = 0; |FINSI;
     |SI swParamEmpresa = 1; |Y #nomcont1#10 ! 0;    || imprime logo general
          nEmpresaLogo = #labempre#0;                  || imprime logo por empresa si hay
          || logo cabecera o pie POR EMPRESA, no general
     |FINSI;
|FPRC;

|PROCESO BuscaCateg_3;
/*
     |ABRE #nomcateg;
     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = #labtraba#17;
     |LEE 000#nomcateg.=;
     |SI FSalida = 0;
          aAlfa = #nomcateg#8;
          |QBF aAlfa;
          |SI aAlfa ! "";
               #10#7 = aAlfa;
          |SINO;
               #10#7 = #labtraba#18;
          |FINSI;
     |FINSI;
     |CIERRA #nomcateg;
*/
     || lo quito, no lo usa nadie
     aAlfa = #labtraba#206;
     |QBF aAlfa;
     |SI aAlfa ! "";
          #10#7 = aAlfa;
     |SINO;
          #10#7 = #labtraba#18;
     |FINSI;
|FPRC;

|PROCESO AgrupaSiNo_3;
     swAgrupa = 0;
     |SI #nomcontr#45 = "S"; ||Y concep < 201; las pagas tambien, ya veremos
     |Y situcon < 36;        || estaba puesto que las pagas no jugaban a esto
                             || lo quito para que jueguen el 22.10.2007 por el 3006.555
     |Y concep < 900; || anticipos no
     |Y situcon ! 17; || la situacion de las pagas en la nomina
          swAgrupa = 1;
     |FINSI;
     |SI concep > 400; swAgrupa = 0; |FINSI;
     |SI #0#69 = "A"; swAgrupa = 0; |FINSI;
     |SI swAgrupa = 1;
          situac2 = 0;
          |PARA nPos = 1; |SI nPos [ 256; |HACIENDO nPos = nPos + 7;
               nPos1 = (nPos * 100) + 7;     || (XXX YY ) (XXX concepto, YY posicion
               aAlfa = aNormal % nPos1;      || que ocupa por convenio)
               |SI aAlfa = "       ";
                    |SAL;
               |FINSI;
               aAlfa1 = aAlfa % 103;         || concepto alfa
               nNume1 = aAlfa1;              || concepto nume
               aAlfa2 = aAlfa % 502;         || posicion alfa
               nNume2 = aAlfa2;              || posicion nume
               |SI situcon = nNume2; |Y nNume1 ! concep; || vaya, el concepto en que
                    aAlfa = aAgrupa % nPos1;        || estoy se agrupaba ya con
                    aAlfa1 = aAlfa % 103;    || otro, tenia la misma posicion
                    nNume1 = aAlfa1;
                    aAlfa2 = aAlfa % 502;
                    nNume2 = aAlfa2;

                    |SI nNume2 ! 0;          || vale, pues a ver en cual ha quedado
                         situac2 = nNume2;   || y esa sera mi situacion
                    |FINSI;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO RegAgrupa_3;
     aAlfa1 = concep;
     aAlfa2 = situcon; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = situac; aAlfa3 = ("00" + aAlfa3) % -102;
     aNormal = aNormal + aAlfa1 + " " + aAlfa2 + " ";
     aAgrupa = aAgrupa + aAlfa1 + " " + aAlfa3 + " ";
|FPRC;

|PROCESO situacion_3;
     |SI concep = 965; |Y import [ 0;
          situac = 00; situcon = 00;
          |ACABA;
     |FINSI;
     |HAZ AgrupaSiNo_3;
     |SI swAgrupa = 1;
          |SI import ! 0;
               || parche para que en finiquitos, el primer conceptono salga
               || en el lugar del salario base, ya que no hay salario base
               |SI #0#10 = 2; |Y concep ! 101; |Y situac_ult = 0;
                    situac_ult = 1;
               |FINSI;
               |SI situac2 ! 0;
                    situac = situac2;
               |SINO;
                    situac = situac_ult + 1;
                    situac_ult = situac;
               |FINSI;
          |SINO;
               lineas = 1;    || he de poner esto porque si no, no se imprime
                              || una nomina con el mes entero de IT sin conceptos
                              || que solo tenga la prestacion
               situcon = 00;
               situac = 00;
          |FINSI;
     |SINO;
          situac = situcon;
     |FINSI;
     |HAZ RegAgrupa_3;
|FPRC;

|PROCESO DiasAgrarios_3;
     |SI swModulo = 2884; |ACABA; |FINSI;
     |SI #2#42 = "E"; |O #2#42 = "e";
          nNume = unidad + #10#205;
          |SI nNume > 23; #10#19 = nNume; |FINSI;
     |FINSI;
|FPRC;

|PROCESO cuadres_3;
     sw_cuadre = 0;
     |INFOR c_informe;
     |FININF;
|FPRC;

/*****************************************************************/
/*  ATRASOS HISTORICO-NOMINAS-IMPRESORA                          */
/*****************************************************************/

|PROCESO salteadaAtrasosHis;
|PARA salte_1 = 21; |SI salte_1 [ 41; |HACIENDO salte_1 = salte_1 + 1;
        salte_2 = salte_1 + 21;
    |PARA mes_i = #0#5; |SI mes_i [ #0#7; |HACIENDO mes_i = mes_i + 1;
            #11#0 = #0salte_1;     || empresa
            #11#1 = #0salte_2;     || trabajador
            #11#66 = #0#4;         || any
            #11#2 = mes_i;         || mes
            #11#3 = nTipoAt;         || tipo
        |LEE 000#11=;
        |SI FSalida = 0;
               |SI #0#69="I";
                    |HAZ procesoAtrasHisImpre;
               |FINSI;
        |FINSI;
    |SIGUE;
|SIGUE;
|FPRC;

|PROCESO procesoAtrasHisImpre;
|SI sw_control = 0; |HAZ control_3;  sw_control = 1;     |FINSI;

|SI ante_tra=0;  ante_emp = #11#0;  ante_tra = #11#1;  |FINSI;
|SI #0#10 = 2;
    |SI ante_tra ! #11#1; |O ante_emp ! #11#0;
        |SI lineas = 1;
               |HAZ comple_6AtrasHisImpre;
               |DDEFECTO #10;
        |FINSI;
        swPrimerMes = 0;
    |FINSI;
|FINSI;
    lineas = 0;     || para saber si los conceptos leidos son buenos
    swbaja = 0;
nEmp = #nomhicca#0; nTra = #nomhicca#1;
|HAZ comple_0_3;             || lee empresa, trabajador y constante
|SI #0#66 < #2#77;|O #0#65 > #2#77;     || seleccion centros
     |ACABA;
|FINSI;
nContrato = #11#9;
|HAZ comple_1_3;   || construye literales datos empresa
|HAZ comple_2AtrasHisImpre;   || construye periodo de liquidacion nomina
|HAZ comple_3AtrasHisImpre;   || construye periodo de liquidacion de enferm. y accte.
|HAZ comple_3_1_AtrasHisImpre;   || construye periodo de liquidacion de enferm. y accte.
|HAZ comple_4AtrasHisImpre;   || halla totales varios
|HAZ SS_Empresa;
|HAZ comple_5AtrasHisImpre;   || construye fecha firma
situac = 0; situac_ult = 0;
aNormal = ""; aAgrupa = "";
|BUCLELIN 0cargas_1AtrasHisImpre#11;   || carga campos lineas calculos
    ante_emp = #11#0;
    ante_tra = #11#1;
|SI lineas = 1;
        seleccio = 1;    || para saber si se ha leido algo
    |HAZ cargas_0AtrasHisImpre;       || carga campos cabecera calculos
    |HAZ cargas_2AtrasHisImpre;       || carga campos totales
    |HAZ ImpCrystal;
    |SI #0#10 = 1;
        |HAZ comple_6AtrasHisImpre;
        |DDEFECTO #10;
    |SINO;
        guarda_emp = #2#0;    || guarda
        guarda_cen = #2#77;   || las guarda porque en
        guarda_are = #2#62;
        guarda_sec = #2#63;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO cargas_0AtrasHisImpre;      || CARGA LOS CAMPOS LITERALES Y LOS FIJOS
    #10#000 = #1#10;          || cif empresa
    #10#001 = #1#00;          || codigo empresa
    #10#002 = #2#1;          || codigo trabajador
    #10#003 = #1#2;          || nombre empresa
    #10#004 = domemp;         || direccion empresa
    #10#005 = pobemp;         || poblacion empresa
    #10#006 = #2#2;          || nombre trabajador
    |HAZ BuscaCateg_3;          || categoria profesional
    #10#008 = #2#238;         || puesto de trabajo
    #10#009 = afili;          || s.s. empresa
    #10#10 = #2#38;          || fecha de impresion
    #10#11 = #2#31;          || nro. de matricula
    #10#12 = #2#07;          || d.n.i. trabajador
    #10#13 = #2#75;          || s.s. trabajador
    #10#172 = #2#77;          || centro de trabajo
    #10#14 = desdia;         || desde el dia
    #10#15 = mesliq1;        || desde el mes
    #10#16 = hasdia;         || hasta el dia
    #10#17 = mesliq2;        || hasta el mes
    ||SI #10#18 > 80;  #10#18 = #10#18 + 1900;  |SINO;  #10#18 = #10#18 + 2000;  |FINSI;
    #10#18 = #11#226;        || a¤o confeccion
|SI #2#42 ! "E";|Y #2#42 ! "e";
        #10#19 = #10#19 + #11#08;          || total dias liquidacion
          |SI swModulo = 2884;
               |SI #2#42 = "C"; |O #2#42 = "F"; #10#19 = #10#19 + #11#10; |FINSI;
          |FINSI;
|SINO;
        #10#19 = #10#19 + #11#11;          || total jornadas (AGRARIA*)
|FINSI;
    #10#103 = #10#103 + #11#57;          || ptas. enfermedad
    #10#104 = #10#104 + #11#58;          || ptas. accidente
|SI #0#10 = 1;
        #10#105 = desenf;         || del dia enfermedad
        #10#106 = hasenf;         || al dia enfermedad
        #10#107 = desacc;         || del dia accidente
        #10#108 = hasacc;         || al dia accidente
|SINO;
        #10#105 = 0; #10#106 = 0; #10#107 = 0; #10#108 = 0;
|FINSI;
    #10#119 = #10#119 + tcotiz;         || base cotizacion
    #10#120 = #10#120 + #11#38;          || base prorratas
    #10#121 = #10#121 + tbcotiz;        || total bases de cotizacion
    #10#122 = #2#33;          || grupo de cotizacion
    #10#123 = #10#123 + #11#39;          || base contingencias comunes
    #10#124 = #10#124 + #11#40;          || base D+P+F
    #10#125 = #10#125 + #11#41;          || base horas extra estruc.
    #10#126 = #10#126 + #11#42;          || base horas extra no estruc.
    #10#127 = #11#61;          || (%) contingencias comunes
    #10#128 = apordfp;        || (%) d+f+p
    #10#129 = aporhe1;        || (%) horas extra estruc.
    #10#130 = aporhe2;        || (%) horas extra no estruc.
    #10#131 = #10#131 + #11#48;          || ptas. contingencias comunes
    #10#132 = #10#132 + #11#49;          || ptas. d+f+p
    #10#133 = #10#133 + #11#50;          || ptas. horas extra estruc.
    #10#134 = #10#134 + #11#51;          || ptas. horas extra no estruc.
    #10#135 = #11#13;          || (%) I.R.P.F.
    #10#137 = #10#137 + taporta;        || total aportacion
    #10#139 = #10#139 + tantici;        || total anticipos
    #10#140 = #10#140 + #11#54;          || en especie
    #10#141 = #10#141 + deducir;        || total a deducir
    #10#143 = diarec;         || dia RECIBI
    #10#144 = mesrec;         || mes RECIBI
    #10#145 = anyrec;         || a¤o RECIBI
    |SI #10#145 > 80;  #10#145 = #10#145 + 1900;  |SINO;  #10#145 = #10#145 + 2000;  |FINSI;
    aTipoIT = "53"; |HAZ LiteralIT;
    #10#150 = aValor;                || Literal fijo
    #10#151 = #11#108;                  || (%) IRPF 2
    #10#152 = #11#109;                  || (%) IRPF 3
    #10#160 = #10#160 + #11#52;          || anticipos 1
    #10#161 = #10#161 + #11#53;          || anticipos 2
    #10#196 = #10#196 + #11#128;         || anticipos 3
    #10#193 = #10#193 + #11#45;          || S.S. cargo empresa
|SI #11#49 ! 0;
        #10#162 = apord;                                    || (%) desempleo
        #10#163 = aporfp;                                   || (%) form.prof.
        #10#164 = #10#164 + ((#11#40 % apord) ! EURODB);            || ptas. desempleo
        #10#165 = #10#165 + (#11#49 - ((#11#40 % apord) ! EURODB)); || ptas. form.prof.
|FINSI;
    #10#206 = #10#124;                  || base FP
    el_a00 = el_a00 + #11#45;            || seg.social a cgo.empresa
    el_a31 = el_a31 + #11#52;            || anticipos 1
    el_a32 = el_a32 + #11#53;            || anticipos 2
    el_a35 = el_a35 + #11#128;           || anticipos 3
    el_a33 = el_a33 + #11#17;            || cuota IRPF pagas
    el_a34 = el_a34 + #11#16;            || base IRPF pagas

nEmpresa=#11#0;   || empresa
nTrabajador=#11#1;   || trabajador
nMes=#11#2;   || mes
nTipo=#11#3;   || tipo
|FPRC;

|PROCESO cargas_1AtrasHisImpre;       || CARGA LOS CAMPOS SEGUN SU SITUACION
    descri = #12#08;
    unidad = #12#11;      || unidades calculo
    valor  = #12#10;
    import = unidad * valor;

     incluye = 0;
     concep = #12#4;
     situcon = #12#7;

     |HAZ situacion_3;

|SI situac ! 0; |O situcon ! 0;
    |SI concep ] 201; |Y concep [ 208; |Y #12#5 ! "P";
        |SI runnom ! "nomypara";|Y runnom ! "nomwpara";
            |SI swbaja = 1;
                |SI #2#48 = "S"; |Y #1#25=2;  incluye = 1;  |FINSI;  || si es finiquito
            |SINO;
                |SI #1#25 = 2;    incluye = 1;  |FINSI;  || si la paga va junta
            |FINSI;
        |SINO;
                incluye = 1;
        |FINSI;
    |SINO;
            incluye = 1;
    |FINSI;
    ||HAZ Dtos;
          |SI #nomcont3#2 = "S"; |HAZ PagasProrr; |FINSI;
          |SI concep = 301; |O concep = 306;
               |SI #nomcontr#37 = "S";
                    incluye = 0;
                    #10#118 = #10#118 + import;
               |FINSI;
          |FINSI;
    |SI incluye = 1;
            lineas = 1;
            camptas = situac + 22;
            camdesc = situac + 61;
            #10camptas = #10camptas + import;
            arteris = descri % 101;
        |SI arteris ! "*";
            |DDEFECTO #100; #100#0 = #2#87; #100#1 = concep; |LEE 000#100=;
            alfa1 = #100#2;     |QBF alfa1;
            |SI alfa1 ! "";
                    descri = alfa1;
            |FINSI;
            |HAZ UnidadesConcepto;
            #10camdesc = descri;
        |SINO;
                #10camdesc = "";
        |FINSI;
        ||HAZ Ampliada2;
        |SI concep = 101;
                dcal_101 = #12#05;
                duni_101 = unidad;
                dval_101 = valor;
        |FINSI;
        |SI concep = 102;               ||   unidades concepto 102
                duni_102 = unidad;
        |FINSI;
|FINSI;
        |SI concep ] 301; |Y concep [ 305;
            duni_hest = duni_hest + #5#11;
        |FINSI;
        |SI concep ] 306; |Y concep [ 310;
            duni_hnoest = duni_hnoest + #5#11;
        |FINSI;
    |FINSI;
     |SI concep = 101; |HAZ DiasAgrarios_3; |FINSI;
|FPRC;

|PROCESO cargas_2AtrasHisImpre;       || CARGA LOS CAMPOS TOTALES
|SI #2#42!"A";|Y #2#42!"B";|Y #2#42!"E";|Y #2#42 ! "e";
|Y #2#42!"C";|Y #2#42!"F";|Y #2#42!"P";|Y #2#42!"I";
    |SI dcal_101 ! "L";
            deci_h = ((#11#33 * 100) $ 100) / 100;
            #10#21 = #10#21 + (#11#8-(#11#31+#11#32+#11#34+#11#65)); ||unid.sal.base
            || quito lo de que en las unid. sal base se descuenten las vacaciones
            || no tiene por que y da problemas 001156.01116
    |SINO;
            #10#21 = #10#21 + duni_101;
    |FINSI;
|SINO;
        #10#21 = #10#21 + duni_101;  || AGRARIA/CITRICOS
|FINSI;
|SI #nomcontr#17 = 3; |Y #0#10 ! 2;   || con la opcion "3" en calculo dias IT cojo siempre
     #10#21 = duni_101;      || las unidades del 101, que es lo que deberia hacer
|FINSI;                       || siempre, pero por no casrgarme nada, pongo esto
|SI #10#21 < 0;
        #10#21 = 0;                                   || si es neg., igual a 0
        #10#22 = 0;
|SINO;
        #10#22 = #10#23 / #10#21;                     || valor salario base
|FINSI;
        #10#177 = duni_102;              || unidades concepto 102
|SI #10#22 = 0;  #10#21 = 0;  |FINSI;  || si valor es 0, unidades tambien
|PARA campo = 109; |SI campo [ 115; |HACIENDO campo = campo + 1;
    #10campo = 0;    || vacia los totales, porque acumula en conceptos
|SIGUE;
|PARA campo = 24; |SI campo [ 28;  |HACIENDO campo = campo + 1;
        tot_109 = campo;        #10#109 = #10#109 + #10tot_109;  || personales
        tot_110 = campo +  5;   #10#110 = #10#110 + #10tot_110;  || puesto trab.
        tot_111 = campo + 10;   #10#111 = #10#111 + #10tot_111;  || calidad ...
        tot_112 = campo + 15;   #10#112 = #10#112 + #10tot_112;  || vencimientos
        tot_113 = campo + 20;   #10#113 = #10#113 + #10tot_113;  || en especie
        tot_114 = campo + 25;   #10#114 = #10#114 + #10tot_114;  || acc.empres.
        tot_115 = campo + 30;   #10#115 = #10#115 + #10tot_115;  || indemnizac.
|SIGUE;
    #10#116 = #10#102 + #10#103 + #10#104;    || prestaciones S.S.
    #10#195 = #10#195 + (#11#46 - #10#116 + #nomtrnom#193);  || Total Neto + SS Emp
    #10#117 = #10#059 + #10#060 + #10#061;              || mejoras voluntarias
    #10#118 = 0;
|PARA campo = 109; |SI campo [ 117; |HACIENDO campo = campo + 1;
    #10#118 = #10#118 + #10campo;                       || t.devengado parcial
|SIGUE;
    #10#118 = #10#118 + #10#23 + #10#199;              || t.devengado + s.base + abs
    #10#20 = #10#118;                                  || importe total
    #10#142 = #10#118 - #10#141;                        || liquido a percibir

    #10#136 = #10#136 + (#11#14 + #11#108 + #11#109);    || tot.base IRPF
    #10#138 = #10#138 + (#11#15 + #11#110 + #11#111);    || tot.ret. IRPF
    #10#153 = #10#153 + #11#14;                          || base IRPF 1
    #10#154 = #10#154 + #11#108;                        || base IRPF 2
    #10#155 = #10#155 + #11#109;                        || base IRPF 3
    #10#156 = dval_101;                                 || valor orig. s.base
    #10#157 = #10#157 + #11#15;                          || ret. IRPF 1
    #10#158 = #10#158 + #11#110;                        || ret. IRPF 2
    #10#159 = #10#159 + #11#111;                        || ret. IRPF 3
|SI swbaja = 0; |Y #1#25 = 2;      || si la paga va junta y no es baja
        #10#136 = #10#136 + #11#16;    || tot. base IRPF + pagas
        #10#138 = #10#138 + #11#17;    || tot. ret. IRPF + ret. pagas
        #10#153 = #10#153 + #11#16;    || base IRPF 1 + pagas
        #10#157 = #10#157 + #11#17;    || ret. IRPF 1 + ret. pagas
|FINSI;
    #10#190 = #10#190 + duni_hest;
    #10#191 = #10#191 + duni_hnoest;
    |HAZ FinTotales_3;     || moneda y varios temas finales
|FPRC;

|PROCESO ordenaAtrasHisImpre;
|DDEFECTO #1;
    #1#0 = #11#0;
|LEE 000#1=;

|DDEFECTO #2;
    #2#0 = #11#0;
    #2#1 = #11#1;
|LEE 000#2=;

|DDEFECTO #102;
    #102#0 = #2#87;
|LEE 000#102=;
#2#25 = #102#1;
|HAZ cta_cotizacion_3;
    #0#64 = cta_co;
|FPRC;

|PROCESO comple_2AtrasHisImpre;        || CONSTRUYE PERIODO DE LIQUIDACION
|SI #0#10 = 2;
        mesnum = #0#5;
|SINO;
        mesnum = #11#2;
        |HAZ lib_0_3;
        mesliq1 = mesalf;
        |HAZ lib_0_3;
        mesliq2 = mesalf;
|FINSI;
|SI #0#10 = 2;
     |SI swPrimerMes = 0;
          mesnum = #11#2;
          swPrimerMes = 1;
          |HAZ lib_0_3;
          desdia = 1;
          mesliq1 = mesalf;
     |FINSI;
     mesnum = #11#2;
     |HAZ lib_0_3;
     hasdia = topemes;
     mesliq2 = mesalf;
|FINSI;
    anytra = #0#4;
|HAZ lib_0_3;             || saca ultimo dia natural del mes desde !!!
    ||mesliq1 = mesalf;
    ||mesliq2 = mesalf;

|SI #0#10 = 2;           || si tiene que refundir
        mesnum = #0#7;
        anytra = #0#4;
    |HAZ lib_0_3;         || saca ultimo dia natural del mes hasta !!!
    ||mesliq2 = mesalf;
|FINSI;

    fectra = #11#4;      || desglosa fecha de alta
|HAZ lib_1_3;
    diaalta = diatra;
    mesalta = mestra;
|SI #0#10 = 2;
    nNume = #nomhicca#226 - 2000;
    ||SI mesalta ] #0#5; |Y anytra = #0#4;  || si es alta este mes
    |SI mesalta ] #0#5; |Y anytra = nNume;  || si es alta este mes
            desdia = diaalta;
            mesnum = mesalta;
            anytra = #0#4;
        |HAZ lib_0_3;
            mesliq1 = mesalf;
    |SINO;
            desdia = 1;
    |FINSI;
|SINO;
    nNume = #nomhicca#226 - 2000;
    |SI mesalta = #11#2; |Y anytra = nNume;  || si es alta este mes
    ||SI mesalta = #11#2; |Y anytra = #0#4;  || si es alta este mes
            desdia = diaalta;
    |SINO;
            desdia = 1;
    |FINSI;
|FINSI;

    fectra = #11#5;      || desglosa fecha de baja
|HAZ lib_1_3;
    diabaja = diatra;
    mesbaja = mestra;
|SI #0#10 = 2;
    nNume = #nomhicca#226 - 2000;
    |SI mesbaja [ #0#7; |Y mesbaja ! 0; |Y anytra = nNume; || si es baja este mes
    ||SI mesbaja [ #0#7; |Y mesbaja ! 0; |Y anytra = #0#4; || si es baja este mes
            swbaja = 1;      || switch para saber si es baja en 'cargas_1'
            hasdia = diabaja;
            mesnum = mesbaja;
            anytra = #0#4;
        |HAZ lib_0_3;
            mesliq2 = mesalf;
    |FINSI;
|SINO;
    nNume = #nomhicca#226 - 2000;
    |SI mesbaja = #11#2; |Y anytra = nNume;  || si es baja este mes
    ||SI mesbaja = #11#2; |Y anytra = #0#4;  || si es baja este mes
            swbaja = 1;      || switch para saber si es baja en 'cargas_1'
            hasdia = diabaja;
    |SINO;
            hasdia = topemes;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO comple_3AtrasHisImpre;        || CARGA LOS PERIODOS DE LIQ. DE ENFERM. Y ACCTE.
    tipoit = "";
    desenf = 0;  hasenf = 0;
    desacc = 0;  hasacc = 0;
    swtenf = 0;  swtacc = 0;
|SI #11#27="E"; |O #11#27="M"; |O #11#27="P"; |O #11#27="R";
       desenf=#11#19; hasenf=#11#23; swtenf=1;
    tipoit = #11#27;
|FINSI;
|SI #11#28="E"; |O #11#28="M"; |O #11#28="P"; |O #11#28="R";
    |SI swtenf=0; desenf=#11#20; hasenf=#11#24; swtenf=1; |FINSI;
    tipoit = #11#28;
|FINSI;
|SI #11#29="E"; |O #11#29="M"; |O #11#29="P"; |O #11#29="R";
    |SI swtenf=0; desenf=#11#21; hasenf=#11#25; swtenf=1; |FINSI;
    tipoit = #11#29;
|FINSI;
|SI #11#30="E"; |O #11#30="M"; |O #11#30="P"; |O #11#30="R";
    |SI swtenf=0; desenf=#11#22; hasenf=#11#26; swtenf=1; |FINSI;
    tipoit = #11#30;
|FINSI;
     |SI swtenf = 1;
       |HAZ TipoIT_3;
     |FINSI;
|SI #11#27="A";              desacc=#11#19; hasacc=#11#23; swtacc=1; |FINSI;
|SI #11#28="A"; |Y swtacc=0; desacc=#11#20; hasacc=#11#24; swtacc=1; |FINSI;
|SI #11#29="A"; |Y swtacc=0; desacc=#11#21; hasacc=#11#25; swtacc=1; |FINSI;
|SI #11#30="A"; |Y swtacc=0; desacc=#11#22; hasacc=#11#26; swtacc=1; |FINSI;
|SI swtacc = 1;|Y #36#19 = "S";
        desacc = desacc - 1;
    |SI desacc < 0;  desacc = 1;  |FINSI;  || por el rollo de las mutuas
|FINSI;
|SI desenf = 0;|Y swtenf = 1;   desenf = 1;    |FINSI;
|SI hasenf = 0;|Y swtenf = 1;   hasenf = #11#7; |FINSI;
|SI desacc = 0;|Y swtacc = 1;   desacc = 1;    |FINSI;
|SI hasacc = 0;|Y swtacc = 1;   hasacc = #11#7; |FINSI;
|FPRC;

|PROCESO comple_3_1_AtrasHisImpre;        || CARGA LOS PERIODOS DE LIQ. DE ENFERM. Y ACCTE.
     |PARA para1 = 19; |SI para1 [ 30; |HACIENDO para1 = para1 + 1;
          para2 = para1 + 159;
          |SI para1 [ 26;
               #10para2 = #11para1;
          |SINO;
               tipoit = #11para1;
               |HAZ TipoIT_3;
               #10para2 = tipoit;
          |FINSI;
     |SIGUE;
     |SI #11#34 ! 0; #10#198 = #11#34; |FINSI; || dias absentismo
|FPRC;

|PROCESO comple_4AtrasHisImpre;        || HALLA TOTALES VARIOS
    tcotiz  = #11#37 + #11#62;
    tbcotiz = tcotiz + #11#38;         || total bases de cotizacion
|SI #11#40 ! 0;|Y #2#45 ! "087";|Y #2#45 ! "097";|Y #2#45 ! "085"; |Y #2#45 ! "421";
        apordfp = #3#13+#3#15+#3#17+#3#19;   ||(%) d+f+p
        aporfp = #3#17;                      ||(%) fp
        apord = apordfp - aporfp;            ||(%) d
|SINO;
        apordfp = 0;
        aporfp = 0;
        apord = 0;
|FINSI;
|SI #11#41 ! 0; |Y #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
        aporhe1 = #3#09;                || (%) horas extra estruc.
    |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085"; |O #2#45 = "421";
            aporhe1 = aporhe1 + #3#13+#3#15+#3#17+#3#19;    || aprendices
    |FINSI;
|SINO;
        aporhe1 = 0;
|FINSI;
|SI #11#42 ! 0; |Y #labtraba#42 ! "T"; |Y #labtraba#42 ! "X";
        aporhe2 = #3#11;                || (%)horas extra no estruc.
    |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085"; |O #2#45 = "421";
            aporhe2 = aporhe2 + #3#13+#3#15+#3#17+#3#19;    || aprendices
    |FINSI;
|SINO;
        aporhe2 = 0;
|FINSI;
    taporta = #11#48 + #11#49 + #11#50 + #11#51;         || total aportacion
    tantici = #11#52 + #11#53 + #11#128;                 || total anticipos
    deducir = taporta + #11#114 + tantici + #11#54;     || total a deducir

|SI runnom ! "nomypara";|Y runnom ! "nomwpara";
    |SI swbaja = 0; |Y #1#25 = 2;       || si la paga va junta y no es baja,
            deducir = deducir + #11#17;  || /le suma la parte IRPF de pagas
    |FINSI;
|SINO;
        deducir = deducir + #11#17;      || pagas juntas en parametrizados
|FINSI;
|FPRC;

|PROCESO comple_5AtrasHisImpre;        || CONSTRUYE FECHA LITERAL DEL RECIBI
     |HAZ sibajaAtrasHisImpre;              || (tiene en cuenta si el trabajador es baja)
     fectra = #0#6;
     |HAZ lib_1_3;
     diarec = diatra;
     anyrec = anytra;
     mesnum = mestra;
     |HAZ lib_0_3;
     mesrec = mesalf;
|FPRC;


|PROCESO sibajaAtrasHisImpre;   || COMPRUEBA SI EL TRABAJADOR ES BAJA EN ESTE MES
    diabaja = 0;
|SI #11#5 ! "          "; |Y #11#5 ! "..........";
        fectra = #11#5;
    |HAZ lib_1_3;
    |SI #0#5 = mestra; |Y #0#4 = anytra;
            diabaja = diatra;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE nomtreci0;
     #11#1;
     ;
     nDesdeEmp, nDesdeTra, #0#4, #0#5, nTipoAt;
     nHastaEmp, nHastaTra, #0#4, #0#7, nTipoAt;
     ;
     NULL, procesoAtrasHisImpre;
|FIN;

|DEFBUCLE EmpTraAtrasHisImpre;   || por nombre empresa, codigo trabajador
     #11#1;
     ;
     nDesdeEmp, nDesdeTra, #0#4, #0#5, nTipoAt;
     nHastaEmp, nHastaTra, #0#4, #0#7, nTipoAt;
     ;
     NULL, ordenaAtrasHisImpre, NULL, NULL, NULL, procesoAtrasHisImpre;
     #1#2, #2#0, #2#1;
|FIN;

|DEFBUCLE nombresAtrasHisImpre;
     #11#1;
     ;
     nDesdeEmp, nDesdeTra, #0#4, #0#5, nTipoAt;
     nHastaEmp, nHastaTra, #0#4, #0#7, nTipoAt;
     ;
     NULL, ordenaAtrasHisImpre, NULL, NULL, NULL, procesoAtrasHisImpre;
     #2#0, #2#2, #2#1;
|FIN;

|DEFBUCLE areasAtrasHisImpre;
     #11#1;
     ;
     nDesdeEmp, nDesdeTra, #0#4, #0#5, nTipoAt;
     nHastaEmp, nHastaTra, #0#4, #0#7, nTipoAt;
     ;
     NULL, ordenaAtrasHisImpre, NULL, NULL, NULL, procesoAtrasHisImpre;
     #2#0, #2#62, #2#63, #2#1;
|FIN;

|DEFBUCLE centrosAtrasHisImpre;
     #11#1;
     ;
     nDesdeEmp, nDesdeTra, #0#4, #0#5, nTipoAt;
     nHastaEmp, nHastaTra, #0#4, #0#7, nTipoAt;
     ;
     NULL, ordenaAtrasHisImpre, NULL, NULL, NULL, procesoAtrasHisImpre;
     #2#0, #2#77, #2#1;
|FIN;

|DEFBUCLE tc2AtrasHisImpre;
     #11#1;
     ;
     nDesdeEmp, nDesdeTra, #0#4, #0#5, nTipoAt;
     nHastaEmp, nHastaTra, #0#4, #0#7, nTipoAt;
     ;
     NULL, ordenaAtrasHisImpre, NULL, NULL, NULL, procesoAtrasHisImpre;
     #2#0, #0#64, #102#142, #2#75, #2#1, #11#2;
|FIN;

|PROCESO comple_6AtrasHisImpre;    || imprime y limpia
     |HAZ imprime_3;
     |SI #0#10 ! 2;
          |DDEFECTO #10;
     |FINSI;
|FPRC;

|PROCESO impreTI2
     |SI swPorGrupos = 0;
          nDesdeEmp = #0#0;
          nHastaEmp = #0#1;
          nDesdeTra = #0#2;
          nHastaTra = #0#3;
     |SINO;
          nDesdeEmp = #nomgruel#1;
          nHastaEmp = #nomgruel#1;
          nDesdeTra = 00001;
          nHastaTra = 99999;
     |FINSI;
     |SI #0#63 = 1;    |BUCLE nomtreci0;   |FINSI;
     |SI #0#63 = 2;    |BUCLE nombresAtrasHisImpre;     |FINSI;
     |SI #0#63 = 3;    |BUCLE areasAtrasHisImpre;       |FINSI;
     |SI #0#63 = 4;    |BUCLE centrosAtrasHisImpre;     |FINSI;
     |SI #0#63 = 5;    |BUCLE tc2AtrasHisImpre;         |FINSI;
     |SI #0#63 = 6;    |BUCLE EmpTraAtrasHisImpre;     |FINSI;
|FPRC;

|DEFBUCLE TIGrupo;         || lee empresas del grupo
     #nomgruel#1;
     ;
     nGrupo, 00001;
     nGrupo, 99999;
     ;
     NULL, impreTI2;
|FIN;

|PROCESO TIPorGrupos;
     swPorGrupos = 1;
     |PARA nCampoG = 70; |SI nCampoG [ 77; |HACIENDO nCampoG = nCampoG + 1;
          nGrupo = #0nCampoG;
          |BUCLE TIGrupo;
     |SIGUE;
|FPRC;

|PROCESO impreTI;
     c_informe = "nomyreci";
     |HAZ cuadres_3;
     |SI sw_cuadre = 0;
          |ABRE #1;
          |ABRE #2;
          |ABRE #3;
          |ABRE #6;
          |ABRE #35;
          |ABRE #100;
          |ABRE #102;
          |ABRE #11;
          |ABRE #12;
          |HAZ ElIMPRE_3;
          |SI FEstado = 0;
               aAlfa = #0#16;
               nTipoAt = aAlfa;
               seleccio = 0;
               |SI #0#21 = 0;
                    |SI #0#70 = 0;
                         |HAZ impreTI2;
                    |SINO;
                         |HAZ TIPorGrupos;
                    |FINSI;
               |SINO;
                    |HAZ salteadaAtrasosHis;
               |FINSI;
               |SI seleccio = 0;
                    |MENAV "    Seleccion vacia ...";
               |SINO;
                    |SI #0#10 = 2;
                         |SI lineas = 1;
                              |HAZ comple_6AtrasHisImpre;
                              |DDEFECTO #10;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               |MENAV "    Proceso ABORTADO !!!";
          |FINSI;
          |HAZ ElFINIMP_3;
          |CIERRA #1;
          |CIERRA #2;
          |CIERRA #3;
          |CIERRA #6;
          |CIERRA #35;
          |CIERRA #100;
          |CIERRA #102;
          |CIERRA #11;
          |CIERRA #12;
     |FINSI;
|FPRC;
