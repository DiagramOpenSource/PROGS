|FICHEROS;
     mod00271 #0;
     mod00272 #1,MANTE;
     mod00264;
     labtraba;

     nomfical;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    ant_tipo = "";
     nModo = 0;

     nDiaMes = 0;
     nFilNum = 0;
     nColIni = 0;
     nColNum = 0;
     nColCam = 0;
     nPaso = 0;
     nCampo = 0;
     topemes = 0;
     nPos = 0;
     a = 0;
     nDiaSem = 0;

     aAlfa1 = "";
     aAlfa = "";
     nNume = 0;

     aAnyo = "";
     aMes = "";
     mesnum = 0;
     anynum = 0;
     aFecha = "";
     fFecha = @;
     fDiaLet = @;
     aDiaLet = "";
     nPosHoras = 0;

     swFestivo = 0;
     nFechaNume = 0;
     nCampoF = 0;
     nCampoF1 = 0;
     nCampoF2 = 0;
     nCampoF3 = 0;
     aAlfa2 = "";
     aAlfa3 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     swAlta = 0;
     nEmp = 0;
     nTra = 0;
     fFechaAlta = @;
     fFechaBaja = @;
     nDia = 0;
     swSoloAlta = 0;
     nTotalHoras = 0;
|FIN;
____________________________________/


|PROCESO BuscaDia;
     swFestivo = 0;
     |ABRE #nomfical;
     #nomfical#0 = #labtraba#156;
     #nomfical#1 = #0#2;
     |LEE 000#nomfical.=;

     fDiaLet = fFecha % 1;
     aDiaLet = fDiaLet;
     aDiaLet = aDiaLet % 1103;

     |SI aDiaLet = "Lun"; |Y #nomfical#2 = 1; swFestivo = 1; |FINSI;
     |SI aDiaLet = "Mar"; |Y #nomfical#3 = 1; swFestivo = 1; |FINSI;
     |SI aDiaLet = "Mie"; |Y #nomfical#4 = 1; swFestivo = 1; |FINSI;
     |SI aDiaLet = "Jue"; |Y #nomfical#5 = 1; swFestivo = 1; |FINSI;
     |SI aDiaLet = "Vie"; |Y #nomfical#6 = 1; swFestivo = 1; |FINSI;
     |SI aDiaLet = "Sab"; |Y #nomfical#7 = 1; swFestivo = 1; |FINSI;
     |SI aDiaLet = "Dom"; |Y #nomfical#8 = 1; swFestivo = 1; |FINSI;

     aFecha = fFecha;
     aAlfa = (aFecha % 402) + (aFecha % 102);
     nFechaNume = aAlfa;

     |PARA nCampoF = 9; |SI nCampoF [ 96; |HACIENDO nCampoF = nCampoF + 3;
          nCampoF1 = nCampoF;
          nCampoF2 = nCampoF + 1;
          nCampoF3 = nCampoF + 2;

          aAlfa1 = #nomfical#nCampoF1#; |QBF aAlfa1;
          aAlfa2 = #nomfical#nCampoF2#; |QBF aAlfa2;
          nNume3 = #nomfical#nCampoF3#;
          |SI aAlfa1 ! ""; |Y aAlfa2 ! ""; |Y nNume3 = 1;
               aAlfa1 = (aAlfa1 % 302) + (aAlfa1 % 102);
               nNume1 = aAlfa1;
               aAlfa2 = (aAlfa2 % 302) + (aAlfa2 % 102);
               nNume2 = aAlfa2;
               |SI nNume1 [ nFechaNume; |Y nFechaNume [ nNume2;
                    swFestivo = 1;
                    |SAL;
               |FINSI;
          |FINSI;
     |SIGUE;

     |SI swFestivo = 0;
          |PARA nCampoF = 99; |SI nCampoF [ 157; |HACIENDO nCampoF = nCampoF + 2;
               nCampoF1 = nCampoF;
               nCampoF3 = nCampoF + 1;

               aAlfa1 = #nomfical#nCampoF1#; |QBF aAlfa1;
               nNume3 = #nomfical#nCampoF3#;
               |SI aAlfa1 ! ""; |Y nNume3 = 1;
                    aAlfa1 = (aAlfa1 % 302) + (aAlfa1 % 102);
                    nNume1 = aAlfa1;
                    |SI nNume1 = nFechaNume;
                         swFestivo = 1;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #nomfical;
|FPRC;

|PROCESO CompDia;
     swAlta = 0;
     swFestivo = 0;

     |ABRE #labtraba;
     #labtraba#0 = nEmp;
     #labtraba#1 = nTra;
     |LEE 000#labtraba.=;

     aAlfa = #labtraba#36;
     fFechaAlta = aAlfa;

     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa = ""; |O aAlfa = "..........";
          fFechaBaja = "31.12.2099";
     |SINO;
          fFechaBaja = aAlfa;
     |FINSI;

     aAlfa1 = nDiaMes; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#3; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = #0#2;
     aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
     fFecha = aAlfa;

     swAlta = 0;
     |SI fFechaAlta [ fFecha; |Y fFecha [ fFechaBaja;
          swAlta = 1;
     |FINSI;

     |SI swSoloAlta = 1;
          || me da igual festivo o no
     |SINO;
          |HAZ BuscaDia;
     |FINSI;


     |CIERRA #labtraba;
|FPRC;

|PROCESO topemes;
     topemes = 31;
     |SI #0#3 = 4; |O #0#3 = 4; |O #0#3 = 6; |O #0#3 = 9; |O #0#3 = 11;
          topemes = 30;
     |FINSI;
     nNume = #0#2 $ 4;
     |SI #0#3 = 2;
          |SI nNume = 0;
               topemes = 29;
          |SINO;
               topemes = 28;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cabecera;
     |ATRI R;
     |PINTA 1124, " Lun ";
     |PINTA 1130, " Mar ";
     |PINTA 1136, " Mi‚ ";
     |PINTA 1142, " Jue ";
     |PINTA 1148, " Vie ";
     |PINTA 1154, " S b ";
     |PINTA 1160, " Dom ";
     |ATRI 0;
|FPRC;

|PROCESO dias;
     aAnyo = #0#2;
     aMes  = #0#3;
     aMes = "00" + aMes;
     aMes = aMes % -102;
     aFecha = "01" + "." + aMes + "." + aAnyo;
     fFecha = aFecha;
     fDiaLet = fFecha % 1;
     aDiaLet = fDiaLet;
     aDiaLet = aDiaLet % 1103;
     |SI aDiaLet = "Lun"; nDiaSem = 1; |FINSI;
     |SI aDiaLet = "Mar"; nDiaSem = 2; |FINSI;
     |SI aDiaLet = "Mie"; nDiaSem = 3; |FINSI;
     |SI aDiaLet = "Jue"; nDiaSem = 4; |FINSI;
     |SI aDiaLet = "Vie"; nDiaSem = 5; |FINSI;
     |SI aDiaLet = "Sab"; nDiaSem = 6; |FINSI;
     |SI aDiaLet = "Dom"; nDiaSem = 7; |FINSI;
     mesnum = #0#3;
     anynum = #0#2;
|FPRC;

|PROCESO PintaTotalHoras;
               aAlfa = nTotalHoras;
               |QBF aAlfa;
               aAlfa1 = aAlfa % -301;
               |SI aAlfa1 ! ".";
                    aAlfa1 = aAlfa % -201;
                    |SI aAlfa1 = ".";
                         aAlfa = aAlfa + "0";
                    |SINO;
                         aAlfa = aAlfa + ".00";
                    |FINSI;
               |FINSI;

               aAlfa = ("      " + aAlfa) % -106;
               |PINTA 2313, aAlfa;
|FPRC;

|PROCESO Calendario; |TIPO 14;
     |ABRE #mod00272;

     |SI #0#0 = 1; |Y #0#1 = 1;
     |Y #0#2 = 2018; |Y #0#3 = 1;
          |ACABA;
     |FINSI;

     |HAZ topemes;
     |HAZ dias;

     nDiaMes = 1;
     nFilNum = 1200;
     nColIni = 24 - 4;
     nColCam = 23;
     nPaso = 6;
     nCampo = 4;
     ||HAZ Inicializa;
     |ATRI 0;
     |BLANCO 1121 2380;
     |CUADRO 1122 2366;
     |HAZ cabecera;
     nTotalHoras = 0;
     |PARA nFilNum = nFilNum; |SI nDiaMes [ topemes; |HACIENDO nFilNum = nFilNum + 200;
     |PARA nDiaSem = nDiaSem; |SI nDiaSem [ 7;  |HACIENDO nDiaSem = nDiaSem + 1;
          nColNum = nColIni + (nDiaSem * nPaso);
          nPos = nFilNum + nColNum;
          |SI nDiaMes < 10;
               nPos = nPos + 1;
               a = 1;
          |SINO;
               a = 0;
          |FINSI;

          nEmp = #0#0;
          nTra = #0#1;
          |HAZ CompDia;

          |SI swFestivo = 1;
               |ATRI S;
          |SINO;
               |ATRI I;
          |FINSI;

          |PINTA nPos, nDiaMes;
          |ATRI 0;
          nColCam = nPos + 3 - a;

          nPosHoras = nPos + 100;
          |SI nDiaMes [ 9;
               nPosHoras = nPosHoras - 2;
          |SINO;
               nPosHoras = nPosHoras - 1;
          |FINSI;
          nNume = 0;

          #mod00272#0 = #mod00271#0;
          #mod00272#1 = #mod00271#1;
          #mod00272#2 = #mod00271#2;
          #mod00272#3 = #mod00271#3;
          #mod00272#4 = nDiaMes;
          |LEE 000#mod00272.=;
          |SI FSalida = 0;
               nNume = #mod00272#5;
               |ATRI R;
               |SI nTotalHoras = 0;
                    |PINTA 2306, "TOTAL:";
               |FINSI;
               nTotalHoras =  nTotalHoras + nNume;
               |HAZ PintaTotalHoras;
               |ATRI 0;
          |FINSI;

          aAlfa = nNume;
          |QBF aAlfa;
          aAlfa1 = aAlfa % -301;
          |SI aAlfa1 ! ".";
               aAlfa1 = aAlfa % -201;
               |SI aAlfa1 = ".";
                    aAlfa = aAlfa + "0";
               |SINO;
                    aAlfa = aAlfa + ".00";
               |FINSI;
          |FINSI;

          |SI swAlta = 0;
               |ATRI R;
          |FINSI;
          |SI aAlfa ! "0.00";
               |PINTA nPosHoras, aAlfa;
          |SINO;
               nPosHoras = nPosHoras - 1;
               |PINTA nPosHoras, "     ";
          |FINSI;
          |ATRI 0;

          ||CAMPO_VISUAL   #0nCampo, 1, "S";
          ||CAMPO_POSICION #0nCampo, 1, nColCam;
          ||PINTA #0nCampo;
          |SI nDiaMes < 10;
               nPos = nPos - 1;
          |FINSI;
          nDiaMes = nDiaMes + 1;
          |SI nDiaMes > topemes; |SAL; |FINSI;
          nCampo = nCampo + 1;
     |SIGUE;
     nDiaSem = 1;
     |SIGUE;

     |CIERRA #mod00272;
|FPRC;

|PROCESO borraJorIDAL;
     |BORRA 020#mod00264.a;
     |LIBERA #mod00264;
|FPRC;

|DEFBUCLE borraJorIDAL;
     #mod00264#1;
     ;
     #mod00271#0, #mod00271#1, #mod00271#2, #mod00271#3, 00;
     #mod00271#0, #mod00271#1, #mod00271#2, #mod00271#3, 31;
     be;
     NULL, borraJorIDAL;
|FIN;

|PROCESO BajaTrab; |TIPO 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |BUCLE borraJorIDAL;
     |FINSI;
|FPRC;

|PROCESO BajaDia; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          nTotalHoras = nTotalHoras - #mod00272#5;

          |ATRI R;
          |HAZ PintaTotalHoras;
          |ATRI 0;

          #mod00272#5 = 0;
          |HAZ PintaDia;
     |FINSI;
|FPRC;

|PROCESO PintaDia;
     |HAZ topemes;
     |HAZ dias;

     nDiaMes = 1;
     nFilNum = 1200;
     nColIni = 24 - 4;
     nColCam = 23;
     nPaso = 6;
     nCampo = 4;

     |PARA nFilNum = nFilNum; |SI nDiaMes [ topemes; |HACIENDO nFilNum = nFilNum + 200;
     |PARA nDiaSem = nDiaSem; |SI nDiaSem [ 7;  |HACIENDO nDiaSem = nDiaSem + 1;
          nColNum = nColIni + (nDiaSem * nPaso);
          nPos = nFilNum + nColNum;
          |SI nDiaMes < 10;
               nPos = nPos + 1;
               a = 1;
          |SINO;
               a = 0;
          |FINSI;

          |SI nDiaMes = #mod00272#4;
               nEmp = #0#0;
               nTra = #0#1;
               swSoloAlta = 1;
               |HAZ CompDia;
               swSoloAlta = 0;

               nColCam = nPos + 3 - a;

               nPosHoras = nPos + 100;
               |SI nDiaMes [ 9;
                    nPosHoras = nPosHoras - 2;
               |SINO;
                    nPosHoras = nPosHoras - 1;
               |FINSI;

               nNume = #mod00272#5;

               aAlfa = nNume;
               |QBF aAlfa;
               aAlfa1 = aAlfa % -301;
               |SI aAlfa1 ! ".";
                    aAlfa1 = aAlfa % -201;
                    |SI aAlfa1 = ".";
                         aAlfa = aAlfa + "0";
                    |SINO;
                         aAlfa = aAlfa + ".00";
                    |FINSI;
               |FINSI;

               |SI swAlta = 0;
                    |ATRI R;
               |FINSI;
               |SI aAlfa ! "0.00";
                    |PINTA nPosHoras, "     ";
                    |PINTA nPosHoras, aAlfa;
               |SINO;
                    |PINTA nPosHoras, "     ";
               |FINSI;
               |ATRI 0;
          |FINSI;
          |SI nDiaMes < 10;
               nPos = nPos - 1;
          |FINSI;
          nDiaMes = nDiaMes + 1;
          |SI nDiaMes > topemes; |SAL; |FINSI;
          nCampo = nCampo + 1;
     |SIGUE;
     nDiaSem = 1;
     |SIGUE;

     |ATRI R;
     nModo = (FEntrada / 100) ! 0;
     nTotalHoras = nTotalHoras + #mod00272#5;
     |SI nModo = 2;
          nNume = Contenido;
          nTotalHoras = nTotalHoras - nNume;
     |FINSI;
     |HAZ PintaTotalHoras;
     |ATRI 0;
|FPRC;

|PROCESO defecto; |TIPO 7;
     modo = (FEntrada / 100) ! 0;
     |SI #1#2 = "01.01.1900"; |Y modo = 1;
             #1#2 = ~;
             |PINTA #1#2;
     |FINSI;
|FPRC;

|PROCESO antes; |TIPO 7;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;|Y ant_tipo ! "";
          #1Campo = ant_tipo;
          |PINTA #1Campo;
     |FINSI;
|FPRC;

|PROCESO despues; |TIPO 0;
     |SI FSalida = 0;
          ant_tipo = #1Campo;
     |FINSI;
|FPRC;

|PROCESO inferior;
     #mod00272#0 = #mod00271#0;
     #mod00272#1 = #mod00271#1;
     #mod00272#2 = "01.01.1900";
     #mod00272#3 = " ";
|FPRC;

|PROCESO superior;
     #mod00272#0 = #mod00271#0;
     #mod00272#1 = #mod00271#1;
     #mod00272#2 = "31.12.2999";
     #mod00272#3 = "Z";
|FPRC;

|PROCESO lineas; |TIPO 3;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         |ENTLINEAL #1#1, -3, 1, 22, 0, inferior, superior;
     |SINO;
         |ENTLINEAL #1#1, -3, 2, 22, 0, inferior, superior;
     |FINSI;
|FPRC;

|PROCESO lineas0; |TIPO 13;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4;
          |ENTLINEAL #1#1, 3, 0, 22, 0, inferior, superior;
     |FINSI;
|FPRC;

|PROCESO borra;
     |BORRA 020#mod00272.a;
|FPRC;

|DEFBUCLE borra;
     #mod00272#1;
     ;
     #mod00271#0, #mod00271#1, 2018, 01, 01;
     #mod00271#0, #mod00271#1, 2099, 12, 31;
     be;
     NULL, borra;
|FIN;

|PROCESO borralineas; |TIPO 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |BUCLE borra;
     |FINSI;
|FPRC;

|PROCESO tipo14; |TIPO 14;
     |ENTLINEAL #1#1, 3, 7, 22, 0, inferior, superior;
     |ATRI I;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          xxxxxxxxxxxxxxxxx
     |FINSI;
|FPRO;

/*
|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ tipo14;
     |MANTE #0;
|FPRO;
*/

/*
|PROCESO max;
     #mod00264#0 = #0#0;
     #mod00264#1 = #0#1;
     #mod00264#5 = #0#2;
     #mod00264#6 = #0#3;
     #mod00264#3 = 1;
     #mod00264#9 = 1;
     #mod00264#4 = 0;
     #mod00264#2 = 31;
|FPRC;

|PROCESO min;
     #mod00264#0 = #0#0;
     #mod00264#1 = #0#1;
     #mod00264#5 = #0#2;
     #mod00264#6 = #0#3;
     #mod00264#3 = 0;
     #mod00264#9 = 0;
     #mod00264#4 = 9999;
     #mod00264#2 = 00;
|FPRC;

|PROCESO Cosas;
     |ABRE #mod00264;
     |CONSULTA_F_CLAVE #2#mod00264, min, max;
     |CIERRA #mod00264;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
     aAlfa1 = FSalida;
     |SI aAlfa1 = "OPCION";
         FSalida = "Jornadas";
         |ACABA;
     |FINSI;

     |LEE 101#0=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ Cosas;
|FPRC;
*/
