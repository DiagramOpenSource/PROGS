|FICHEROS;
     labexpec #0;
     labexped,MANTE;
     nomcalca;
     labtraba;
     labempre;
     labcentr;
|FIN;

|VARIABLES;
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nNume4 = 0;
     nPara1 = 0;
     nPara2 = 0;
     nPara3 = 0;
     nPara4 = 0;
     fFech1 = @;
     fFech2 = @;
     fFech3 = @;
     fFech4 = @;
     nFEstado = 0;
     nSeleccio = 0;
     nSeleccio2 = 0;
     nModo = 0;

     &p_mes = "";
     nAnyo2 = 0;
     &aDomEmp = "";
     &aLocEmp = "";
     &aRazon = "";
     &aTelef = "";
     &aFecha1 = "";
     &aFecha2 = "";
|FIN;
____________________________________/
|PROCESO DefeTraba; |TIPO 0;
     |DDEFECTO #labtraba;
     |ABRE #labtraba;
     #labtraba#0 = #labexpec#0;
     #labtraba#1 = #labexped#0;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;
          |MENAV "0000Trabajador inaccesible o inexistente.";
          |ERROR;
     |SINO;
          |SI #labtraba#77 < #0#9; |O #labtraba#77 > #0#10;
               aAlfa1 = #labtraba#77; aAlfa1 = "00" + aAlfa1; aAlfa1 = aAlfa1 % -102;
               aAlfa1 = "0000Trabajador inaccesible por pertenecer al centro " + aAlfa1 + ".";
               |MENAV aAlfa1;
               |ERROR;
          |SINO;
               #labexped#1 = #labtraba#2;    |PINTA #labexped#1;
               #labexped#2 = #labtraba#7;    |PINTA #labexped#2;
          |FINSI;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;
____________________________________/
|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO Mirames; |TIPO 7;    || calcula el mes por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % 402;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO Pintames; |TIPO 0;   || pinta el nombre del mes
     |SI #0Campo =  1; p_mes = "ENERO     ";  |FINSI;
     |SI #0Campo =  2; p_mes = "FEBRERO   ";  |FINSI;
     |SI #0Campo =  3; p_mes = "MARZO     ";  |FINSI;
     |SI #0Campo =  4; p_mes = "ABRIL     ";  |FINSI;
     |SI #0Campo =  5; p_mes = "MAYO      ";  |FINSI;
     |SI #0Campo =  6; p_mes = "JUNIO     ";  |FINSI;
     |SI #0Campo =  7; p_mes = "JULIO     ";  |FINSI;
     |SI #0Campo =  8; p_mes = "AGOSTO    ";  |FINSI;
     |SI #0Campo =  9; p_mes = "SEPTIEMBRE";  |FINSI;
     |SI #0Campo = 10; p_mes = "OCTUBRE   ";  |FINSI;
     |SI #0Campo = 11; p_mes = "NOVIEMBRE ";  |FINSI;
     |SI #0Campo = 12; p_mes = "DICIEMBRE ";  |FINSI;
     |PINTA 0819, p_mes;
|FPRC;

|PROCESO FechaAlta;
|FPRC;

|PROCESO FechaBaja;
|FPRC;
____________________________________/

|PROCESO DatosEmpresa;

     |ABRE #labempre;
     #labempre#0 = #0#0;
     |LEE 000#labempre.=;
     |CIERRA #labempre;

     |SI #0#9 ! #0#10;   || cojo los datos de la empresa
          aDomEmp = #labempre#3;
          |QBF aDomEmp;
          aDomEmp = aDomEmp + ", " + #labempre#4;
          |QBF aDomEmp;
          aDomEmp = aDomEmp + " - " + #labempre#5;
          |QBF aDomEmp;

          aLocEmp = #labempre#6;
          |QBF aLocEmp;
          aLocEmp = aLocEmp + " (" + #labempre#9;
          |QBF aLocEmp;
          aLocEmp = aLocEmp + ")";

          aRazon = #labempre#2;
          aTelef = #labempre#111;
     |SINO;              || cojo los datos del centro de trabajo
          |ABRE #labcentr;
          #labcentr#0 = #0#0;
          #labcentr#1 = #0#9;
          |LEE 000#labcentr.=;
          |SI FSalida ! 0;
               aAlfa1 = #0#9;  aAlfa1 = "00" + #0#9; aAlfa1 = aAlfa1 % -102;
               aAlfa1 = "    No existe el centro " + aAlfa1 + ".";
               |MENAV aAlfa1;
          |SINO;
               aDomEmp = #labcentr#3;
               |QBF aDomEmp;
               aDomEmp = aDomEmp + ", " + #labcentr#4;
               |QBF aDomEmp;
               aDomEmp = aDomEmp + " - " + #labcentr#5;
               |QBF aDomEmp;

               aLocEmp = #labcentr#6;
               |QBF aLocEmp;
               aLocEmp = aLocEmp + " (" + #labcentr#9;
               |QBF aLocEmp;
               aLocEmp = aLocEmp + ")";

               aRazon = #labcentr#2;
               aTelef = #labempre#111;
          |FINSI;
          |CIERRA #labcentr;
     |FINSI;
|FPRC;

|PROCESO labexped;
     nSeleccio2 = 1;

     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 020#labtraba.=;

     |SI #labexped#3 ! "01.01.0000";
          aFecha1 = #labexped#3;
     |SINO;
          aFecha1 = "";
     |FINSI;

     |SI #labexped#4 ! "01.01.0000";
          aFecha2 = #labexped#4;
     |SINO;
          aFecha2 = "";
     |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE labexped;
     #labexped#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, labexped;
|FIN;

|PROCESO min;
     #labexped#0 = 1;
|FPRC;

|PROCESO max;
     #labexped#0 = 99999;
|FPRC;

|PROCESO nomcalca;

     #labtraba#0 = #nomcalca#0;
     #labtraba#1 = #nomcalca#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;

     |SI #labtraba#77 < #0#9; |O #labtraba#77 > #0#10;
          |ACABA;
     |FINSI;
     nSeleccio = 1;


     |DDEFECTO #labexped;
     #labexped#0 = #nomcalca#1;         || codigo
     #labexped#1 = #labtraba#2;         || apellidos y nombre
     #labexped#2 = #labtraba#7;         || DNI
     #labexped#3 = #labtraba#36;        || Fecha Alta
     aAlfa1 = #labtraba#37;
     |QBF aAlfa1;
     |SI aAlfa1 ! ""
          #labexped#4 = aAlfa1;         || Fecha Baja (Incorpor. al Desempleo)
     |SINO;
          #labexped#4 = ~;              || Fecha Baja (Incorpor. al Desempleo)
     |FINSI;
     |GRABA 020#labexped.n;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #labexpec#0,     1, #labexpec#2, 0;
     #labexpec#0, 99999, #labexpec#2, 0;
     ;
     NULL, nomcalca;
|FIN;

|PROCESO Lineal;
     aAlfa1 = #0#1;
     aAlfa1 = aAlfa1 % -102;
     nAnyo2 = aAlfa1;

     aAlfa1 = Usuario;
     |QBF aAlfa1;
     |NOME_DAT #labexped#aAlfa1#;
     |DELINDEX #labexped;
     |ABRE #labtraba;

     |ABRE #labexped;
     |BUCLE nomcalca;
     |CIERRA #labexped;

     |SI nSeleccio = 0;
          |MENAV "0000No se encuentran recibos calculados en el mes informado.";
          |MENAV "0000Podra rellenar manualmente la relacion.";
     |FINSI;

     |ENTLINEAL #1#labexped, 1, 3, 18, 0, min, max;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "labexped";
          |HAZ DatosEmpresa;
          |BUCLE labexped;
          |SI nSeleccio2 ! 0;
               |PIEINF;
          |SINO;
               |MENAV "0000Seleccion vacia.";
          |FINSI;
          |FININF;
     |SINO;
          |MENAV "0000Proceso abortado.";
     |FINSI;
     |FINIMP;

     |CIERRA #labtraba;
     |DELINDEX #labexped;
|FPRC;
