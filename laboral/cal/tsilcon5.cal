|FICHEROS;
     tsilcon5 #0;         || parrilla empresas
     tsilcon9 #99,MANTE;        || parrilla centros
     labcentr;
|FIN;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     para1 = 0;
     para2 = 0;
     para3 = 0;
     para4 = 0;
     fech1 = @;
     fech2 = @;
     fech3 = @;
     fech4 = @;
     elsw1 = 0;
     elsw2 = 0;
     elsw3 = 0;
     elsw4 = 0;
     FEstado = 0;
     seleccio = 0;
     modo = 0;
     sw_rup = 0;

     aListaCentros = "";
     aListaCentrosSel = "";
     nNroCentrosSel = "";
     aAlfa = "";
     aAlfa2 = "";
|FIN;
____________________________________/
|PROCESO tipo7_5; |TIPO 7;
     |SI #0#2 = "*";
          |MENSA "    < F1 > o ENTER: seleccionar la empresa. < F5 > seleccion de centros.s";
     |SINO;
          |MENSA "    Pulse < F1 > o ENTER para seleccionar o no la empresa..";
     |FINSI;
|FPRC;

|PROCESO tipo11_5; |TIPO 11;
     |HAZ Selecciona5;
|FPRC;

|PROCESO tipo0_5; |TIPO 0;
     nume1 = Contenido;
     |SI nume1 = #0Campo;
          |HAZ Selecciona5;
     |FINSI;
|FPRC;

|PROCESO min99;
     #99#0 = #0#0;
     #99#1 = 001;
|FPRC;

|PROCESO max99;
     #99#0 = #0#0;
     #99#1 = 999;
|FPRC;

|PROCESO SeleccionCentros;
     aAlfa = #tsilcon9#1;
     |QBF aAlfa;
     aAlfa = ("000" + aAlfa) % -103;

     aListaCentros = aListaCentros + aAlfa + ", ";

     |SI #tsilcon9#3 = "*";
          aListaCentrosSel = aListaCentrosSel + aAlfa + ", ";
          nNroCentrosSel = nNroCentrosSel + 1;
     |FINSI;
|FPRC;

|DEFBUCLE SeleccionCentros;
     #tsilcon9#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, SeleccionCentros;
|FIN;

|PROCESO AvisosSelCentros;
     aListaCentros = "";
     aListaCentrosSel = "";
     nNroCentrosSel = 0;
     aAlfa2 = #0#0; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;

     |BUCLE SeleccionCentros;

     |SI aListaCentros ! aListaCentrosSel;
          |SI nNroCentrosSel = 0;
               aAlfa = "    ATENCION. Empresa " + aAlfa2 + ": ";
               aAlfa = aAlfa + "se ha realizado una selección por centros"
               aAlfa = aAlfa + " pero no se ha marcado ninguno.";
          |FINSI;
          |SI nNroCentrosSel = 1;
               aAlfa = "    ATENCION. Empresa " + aAlfa2 + ": ";
               aAlfa = aAlfa + "se incluirán los trabajadores del centro ";
               aAlfa = aAlfa + aListaCentrosSel + "según la selección.";
          |FINSI;
          |SI nNroCentrosSel > 1;
               alfa1 = aListaCentrosSel % -106;
               aListaCentrosSel = aListaCentrosSel - alfa1;
               aListaCentrosSel = aListaCentrosSel + " y ";
               aListaCentrosSel = aListaCentrosSel + (alfa1 % -302) + ".";

               aAlfa = "    ATENCION. Empresa " + aAlfa2 + ": ";
               aAlfa = aAlfa + "se incluirán los trabajadores de los centros ";
               aAlfa = aAlfa + aListaCentrosSel;
          |FINSI;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO GrabaCentros;
     #tsilcon9#0 = #0#0;
     #tsilcon9#1 = #labcentr#1;
     #tsilcon9#2 = #labcentr#2;
     |LEE 000#tsilcon9.=;
     |SI FSalida ! 0;
          #tsilcon9#3 = "*";
          |GRABA 020#tsilcon9.n;
     |SINO;
          #tsilcon9#3 = "*";
          |GRABA 020#tsilcon9.a;
     |FINSI;
|FPRC;

|DEFBUCLE GrabaCentros;
     #labcentr#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, GrabaCentros;
|FIN;

|PROCESO Selecciona5;
     |SI FSalida = 0;|O FSalida = 9;
          |SI #0#2 = "*";
               #0#2 = " ";
          |SINO;
               #0#2 = "*";
          |FINSI;
          |PINTA #0#2;
          |GRABA 020#0a;

          |ABRE #tsilcon9;
          || siempre que cambie de estado
          |BUCLE GrabaCentros;

          |CIERRA #tsilcon9;
     |FINSI;
     |SI FSalida = 13; |Y #0#2 = "*";
          |PUSHV 0501 2380;
          |ENTLINEAL #1#99, 2, 4, 22, 1, min99, max99;
          |POPV;
          |HAZ AvisosSelCentros;
     |FINSI;
|FPRC;
