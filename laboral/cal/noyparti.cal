|FICHEROS;
    noyparti #0;
    labempre #1;    || empresas
    labtraba #2;    || trabajadores
    nomcalca #3;    || calculos cabs.
    nomcalli #4;    || calculos lins.
    noyareap #5;    || areas/secciones partidas
    nomconca #6;    || convenios cabs.
    noypartl #7;    || conceptos partidas lins.
    noypart1 #11;   || tmp. resumen
    noypart2 #12;   || campos informe
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    &fichero  = "";
    comienza  = "";
    &p_mes = "";
    concepto = 0;
    descrip = "";
    importe = 0;
    sw_conce = 0;
    &partida = "";
    ant_emp = 0;
    ant_con = 0;
    ant_are = "";
    &sw_salto = 0;
    &EURODB = 0;
|FIN;
____________________________________/ PROCESOS DE PANTALLA
|PROCESO mirames; |TIPO 7;
    fech1 = ~;
    alfa1 = fech1;
    alfa1 = alfa1 % 402;
    #0Campo = alfa1;
|PINTA #0Campo;
|HAZ pintames;
|FPRC;

|PROCESO pintames; |TIPO 0;
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 1842, p_mes;
|FPRC;
____________________________________/
|PROCESO fin_area;
|SELECT #2#5;
|DDEFECTO #5;
    #5#0 = ant_emp;    || empresa
    #5#3 = ant_are;    || area
|LEE 000#5=;
    sw_salto = 2;
|PRINT;
    sw_salto = 0;
    ant_are = #11#2;
|FPRC;

|PROCESO lee_tempo1;
|SI sw_rup = 0;
        ant_emp = #11#0;  ant_con = #11#1;  ant_are = #11#2;
        sw_rup = 1;
    |HAZ lee_empre;
    |HAZ lee_conve;
|FINSI;

|SI ant_emp ! #11#0;
        FSalida = "PAGINA";
        sw_salto = 1;
    |PRINT;
        sw_salto = 0;
        ant_emp = #11#0;
        ant_con = #11#1;
    |HAZ fin_area;
    |HAZ lee_empre;
    |HAZ lee_conve;
|SINO;
    |SI ant_con ! #11#1;
            FSalida = "PAGINA";
            sw_salto = 1;
        |PRINT;
            sw_salto = 0;
            ant_con = #11#1;
        |HAZ fin_area;
        |HAZ lee_conve;
    |SINO;
        |SI ant_are ! #11#2;
            |HAZ fin_area;
        |FINSI;
    |FINSI;
|FINSI;

|DDEFECTO #12;
    #12#0 = #11#0;       || empresa
    #12#1 = #11#1;       || convenio
    #12#2 = #11#2;       || partida 1
    #12#3 = #11#3;       || partida 2
    #12#4 = #11#4;       || importe

    partida = #12#2;               |QBF partida;
    partida = partida + #12#3;     |QBF partida;
    partida = (partida + " ...................") % 120;
|PRINT;
|FPRC;

|DEFBUCLE lee_tempo;
 #11#1;
 ;
    1,   1, "          ", "          ";
 9999, 999, "zzzzzzzzzz", "zzzzzzzzzz";
 e;
 NULL, lee_tempo1;
|FIN;
____________________________________/
|PROCESO graba_tmp;
|SI importe ! 0;
    |DDEFECTO #11;
        #11#0 = #3#0;        || empresa
        #11#1 = #2#87;       || convenio
        #11#2 = #5#3;        || partida 1
        #11#3 = #7#3;        || partida 2
    |LEE 101#11=;
        FEstado = FSalida;
        #11#4 = #11#4 + importe;     || importe
    |SI FEstado = 0;    |GRABA 020#11a;     |FINSI;
    |SI FEstado ! 0;    |GRABA 020#11n;     |FINSI;
    |SI FSalida = 0;
            seleccio = 1;
    |FINSI;
    |LIBERA #11;
|FINSI;
|FPRC;

|PROCESO lee_calculo4;
|HAZ lee_conce;
|SI sw_conce = 0;
    |SI concepto = 503;  importe = #3#57;                             |FINSI;
    |SI concepto = 504;  importe = #3#58;                             |FINSI;
    |SI concepto = 515;  importe = #3#73;                             |FINSI;
    |SI concepto = 801;  importe = #3#48 + #3#49 + #3#50 + #3#51;     |FINSI;
    |SI concepto = 802;  importe = #3#45;                             |FINSI;
    |SI concepto = 803;  importe = #3#74;                             |FINSI;
    |SI concepto = 804;  importe = #3#75;                             |FINSI;
    |SI concepto = 805;  importe = #3#18;                             |FINSI;
    |SI concepto = 806;  importe = #3#46;                             |FINSI;
    |SI importe ! 0;
        |HAZ graba_tmp;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO lee_calculo3;
    concepto = 503;     |HAZ lee_calculo4;
    concepto = 504;     |HAZ lee_calculo4;
    concepto = 801;     |HAZ lee_calculo4;
    concepto = 802;     |HAZ lee_calculo4;
    concepto = 803;     |HAZ lee_calculo4;
    concepto = 804;     |HAZ lee_calculo4;
    concepto = 805;     |HAZ lee_calculo4;
    concepto = 806;     |HAZ lee_calculo4;
|FPRC;

|PROCESO lee_calculo2;
    concepto = #4#4;
|HAZ lee_conce;
|SI sw_conce = 0;
        nume1 = #4#10;
        nume2 = #4#11;
        importe = (nume1 * nume2) ! EURODB;      || calcula importe
    |HAZ graba_tmp;
|FINSI;
|FPRC;

|PROCESO lee_calculo1;
|HAZ lee_traba;
|SI #2#87 ] #0#2;|Y #2#87 [ #0#3;
    |SI #2#62 ] #0#6;|Y #2#62 [ #0#7;
        |SI #2#63 ] #0#8;|Y #2#63 [ #0#9;
            |HAZ lee_areas;
            |BUCLELIN 2lee_calculo2#3;  || carga conceptos de linea
            |HAZ lee_calculo3;          || carga conceptos de cabecera
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE lee_calculo;
 #3#1;
 ;
 #0#0, #0#4, #0#10, 0;
 #0#1, #0#5, #0#10, 9;
 e;
 NULL, lee_calculo1;
|FIN;

|PROCESO fichero;
    fichero = Usuario; |QBT fichero;
    fichero = fichero % -106;
    fichero = comienza + fichero;
    fichero = (fichero + "zzzzzzzz") % 108;
|FPRC;

|PROCESO tipo3; |TIPO 3;
|IMPRE 0;
|SI FSalida = 0;

    |HAZ fichero;
    |NOME_DAT #11 fichero;
    |DELINDEX #11;
    |ABRE #2;
    |ABRE #5;
    |ABRE #7;
    |ABRE #11;
    |BUCLE lee_calculo;
    |CIERRA #2;
    |CIERRA #5;
    |CIERRA #7;
    |CIERRA #11;

    |ABRE #1;
    |ABRE #5;
    |SELECT #2#5;
    |ABRE #6;
    |SI seleccio = 0;
        |MENAV "    Seleccion vacia ...";
    |SINO;
        |INFOR "noyparti";
        |BUCLE lee_tempo;
        |HAZ fin_area;
        |PIEINF;
        |FININF;
    |FINSI;
    |CIERRA #1;
    |CIERRA #5;
    |CIERRA #6;
    |DELINDEX #11;

|SINO;
    |MENAV "    Proceso Abortado ...";
|FINSI;
|FINIMP;
|FPRC;
____________________________________/
|PROCESO lee_conve;
|DDEFECTO #6;
    #6#0 = #11#1;
|LEE 020#6=;
|FPRC;

|PROCESO lee_empre;
|DDEFECTO #1;
    #1#0 = #11#0;
|LEE 020#1=;
|FPRC;

|PROCESO lee_traba;
|DDEFECTO #2;
    #2#0 = #3#0;
    #2#1 = #3#1;
|LEE 020#2=;
|FPRC;

|PROCESO lee_areas;
|DDEFECTO #5;
    #5#0 = #2#0;         || empresa
    #5#1 = #2#62;        || area
    #5#2 = #2#63;        || seccion
|LEE 000#5=;
|FPRC;

|PROCESO lee_conce;
    sw_conce = 0;
|DDEFECTO #7;
    #7#0 = #2#87;        || convenio
    #7#1 = concepto;     || concepto
|LEE 000#7=;
    sw_conce = FSalida;
|FPRC;
