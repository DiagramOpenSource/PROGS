|FICHEROS;
     nomdesac #0;
     nomhicca #1;    || historico cabs.
     nomhicli #2;    || historico lins.
     labtraba #5;    || trabajadores
     nomvarca #7;    || variaciones cabs.
     nomvarli #8;    || variaciones lins.
     labbasec #9;    || bases cabs.
     labbasel #10;   || bases lins.
     labempre #12;   || empresas
     nomtrahx #31;   || bases cotiz. horas extras
     copiadef@ #500;
     nomatcon;

     nomcalca #3;
     nomcalli #4;
     nomcontr;

     nomagic1;
     nomagic2;
     nomembli;
     nomgirli;
     nomir012;
     nomvarcb;
     nomimpr1;
     nomimpr2;
     nompluba;
     nomhisit;

     :integral/dsam0017 #17;
     :integral/dsam0018 #18;
|FIN;

|VARIABLES;
    nume0 = 0;
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    seleccio = 0;
    swfuera = 0;
    campo = 0;
    linea = 0;
    borra = 0;
    mes = 0;
    any = 0;
    dia = 0;
    desde = 0;
    hasta = 0;
    puntero = 0;
    tp = 0;
    valorito = 0;
    p_mes = "";
    fecsys = @;
    alfa = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    diab = "";
    mesb = "";
    anyb = "";
    fecha = "";
    clave = "";
    fecalf = "";
    sw_mater = 0;
    m_dias = 0;
    base1 = 0;
    base2 = 0;
    sw_compru = 0;
    dhuel = 0;
    dabse = 0;
    dvaca = 0;
    ddese = 0;
    el_anyo = 0;
    nDesdeAny = 0;
    nHastaAny = 0;
    nDesdeMes = 0;
    nMes_tr = 0;
    nAnyo_tr = 0;
     aAlfa = "";
     dias_mat = 0;
     &nEnEmpresa = 0;
     &swModulo = 0;
     swCambia = 0;
     estado = 0;
     x = 0;
     aMotivoBaja = "";

     &enDnDIARIO = 0;
     &enHnDIARIO = 0;
     &efDFechas = @;
     &efHFechas = @;
     &enDDocume = 0;
     &enHDocume = 0;
     &enBorraAu = 0;    || para no ver pantalla

     aEmpresa = "";
     aPeriodo = "";
     aAlfa1 = "";
     aAlfa2 = "";
     swMensa = 0;
     swMensa1Dado = 0;
     swMensa2Dado = 0;
     nEmpAnt = 0;
     nCentro = 0;
     nEmpresa = 0;
     nPeriodo = 0;
     nCampo1 = 0;
     nCampo2 = 0;

     aFecha = "";
     nFecha = 0;
     fFecha = @;
     nNume = 0;
     aParam = "";
     &nEmpAUTO = 0;
     &nTraAUTO = 0;
     &nMesAUTO = 0;
     &nAnyAUTO = 0;

     nRegistro = 0;
     nUltima = 0;
     aDia = "";
     &aMes = "";
     aAny = "";
     &nMes = 0;
     &nAny = 0;
     &nTopemes = 0;
     nEmbargo = 0;
     nRestaDelEmbargo = 0;
     nLinea = 0;
     nHastaLinea = 0;
     nEmpDestino = 0;
     nTraDestino = 0;
     sw908 = 0;
     nCampoMen = 0;
     nCampoHis = 0;
|FIN;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO mayus; |TIPO 0;
     #0Campo = #0Campo > #0Campo;
     |PINTA #0Campo;
|FPRC;

|PROCESO defecto;|TIPO 7;  || Para hallar las dos ultimas cifras del a¤o
     fecsys = ~;
     alfa = fecsys;
     alfa = alfa % -102;
     #0Campo = alfa;
     |PINTA #0Campo;
|FPRC;

|PROCESO mes;|TIPO 7;
    fecsys = ~;
    alfa = fecsys;
    alfa = alfa % 402;
    #0Campo = alfa;
|PINTA #0Campo;
|FPRC;

|PROCESO pintames; |TIPO 0;      || PINTA EL MES LITERAL
|SI #0Campo =  1;  p_mes = "ENERO     ";  |FINSI;
|SI #0Campo =  2;  p_mes = "FEBRERO   ";  |FINSI;
|SI #0Campo =  3;  p_mes = "MARZO     ";  |FINSI;
|SI #0Campo =  4;  p_mes = "ABRIL     ";  |FINSI;
|SI #0Campo =  5;  p_mes = "MAYO      ";  |FINSI;
|SI #0Campo =  6;  p_mes = "JUNIO     ";  |FINSI;
|SI #0Campo =  7;  p_mes = "JULIO     ";  |FINSI;
|SI #0Campo =  8;  p_mes = "AGOSTO    ";  |FINSI;
|SI #0Campo =  9;  p_mes = "SEPTIEMBRE";  |FINSI;
|SI #0Campo = 10;  p_mes = "OCTUBRE   ";  |FINSI;
|SI #0Campo = 11;  p_mes = "NOVIEMBRE ";  |FINSI;
|SI #0Campo = 12;  p_mes = "DICIEMBRE ";  |FINSI;
|PINTA 1135, p_mes;
|FPRC;
____________________________________/ BUCLE DE COMPROBACION
|PROCESO Comprobando1;
/*
     || se puso en su momento porque les hizfo falta, lo quito 5412.936
     |DBASS aAlfa; |QBF aAlfa;
     |SI aAlfa = "/u/ase4311/";
          || no
     |SINO;
*/
          || normal

          alfa1 = "    Trabajador [" + #5#0 + "-" + #5#1 + "] con meses posteriores.";
          |MENAV alfa1;
          alfa1 = "    Proceso abortado. Revise la seleccion ...";
          |MENAV alfa1;
          sw_compru = 1;
          |ERROR10;
     ||FINSI;
|FPRC;

|DEFBUCLE Comprobando;
     #nomhicca#1;
     ;
     #labtraba#0, #labtraba#1, nDesdeAny, nDesdeMes, 0;
     #labtraba#0, #labtraba#1, nHastaAny,        12, 2;
     ;
     NULL, Comprobando1;
|FIN;

|PROCESO comprueba1;
     |ATRI I;
     |PINTA 1334, #5#0;
     |PINTA 1352, #5#1;
     |ATRI 0;

     |BUCLE Comprobando;
|FPRC;

|DEFBUCLE comprueba;
 #5#1;
 ;
 #0#0, #0#2;
 #0#1, #0#3;
 ;
 NULL, comprueba1;
|FIN;

|PROCESO HcoCtes;
     |ABRE #nomatcon;
     alfa = el_anyo;
     #nomatcon#77 = #1#0;          || empresa
     #nomatcon#78 = #1#1;          || trabajador
     #nomatcon#80 = alfa;          || a¤o
     #nomatcon#79 = #1#2;          || mes
     |LEE 101#nomatcon.=;
     |SI FSalida = 0;
           |BORRA 020#nomatcon.a;
     |FINSI;
     |CIERRA #nomatcon;
|FPRC;

____________________________________/ BUCLE DE LECTURA PRINCIPAL
|PROCESO actual;
     |ATRI I;
     |PINTA 1334, #1#0;
     |PINTA 1352, #1#1;
     || |PINTA 1554, #1#3;
     |ATRI 0;
     |HAZ traba1;
     |SI swfuera = 0; |Y aParam ! "AUTO";
         |HAZ CompContab;
     |FINSI;
     |SI swfuera = 0;
          seleccio = 1;
          |SI #1#3 ! 2;
               |HAZ horas;      || en los finiquitos no toca las horas
          |FINSI;
          |HAZ bases1;
          |HAZ HcoCtes;
          |HAZ varia1;
     |SINO;
          |SI swfuera = 1; |Y aParam ! "AUTO";
               |MENAV "    ATENCION!!! Este trabajador no es alta en el mes de calculo ...";
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomdesac0;
  #1#1;
  ;
  #0#0, #0#2, #0#5, #0#4, 0;
  #0#1, #0#3, #0#5, #0#4, 4;
  ;
  NULL, actual;
|FIN;

|PROCESO tipo3; |TIPO 3;
     |SI #0#6 ! "SI";    |ACABA;   |FINSI;

     |SI #0#5 > 80;
          el_anyo = #0#5 + 1900;
     |SINO;
          el_anyo = #0#5 + 2000;
     |FINSI;

     nDesdeMes = #nomdesac#4 + 1;
     nDesdeAny = #nomdesac#5;
     |SI nDesdeMes = 13;
          nDesdeMes = 1;
          nDesdeAny = #nomdesac#5 + 1;
          |SI nDesdeAny = 100;     nDesdeAny = 0; |FINSI;
     |FINSI;
     |SI nDesdeAny > 80;
          nHastaAny = 99;
     |SINO;
          nHastaAny = 79;
     |FINSI;
     |SI aParam ! "AUTO";
          |MENSA "2302Comprobando actualizaciones posteriores ...";
          |BUCLE comprueba;
          |SI sw_compru = 1;  |ACABA;   |FINSI;

          |MENSA "2302Desactualizando ...";
     |FINSI;

     |ABRE #5;           || trabajadores
     |ABRE #7;           || variaciones cabs.
     |ABRET #8;          || variaciones lins.
     |ABRE #9;           || bases cabs.
     |ABRET #10;         || bases lins.
     |ABRE #12;          || empresas
     |ABRE #31;          || horas extras
     |BUCLE nomdesac0;
     |CIERRA #5;
     |CIERRA #7;
     |CIERRAT #8;
     |CIERRA #9;
     |CIERRAT #10;
     |CIERRA #12;
     |CIERRA #31;
     |SI seleccio = 0; |Y aParam ! "AUTO";
          |MENAV "    Seleccion vacia ...";
     |FINSI;
|FPRC;

|PROCESO repon_irpf;
     |SALVA_FICHA #nomhicca;
     |ABRE #1;
     nMes_tr = #1#2 - 1;
     |SI nMes_tr = 0;
          nMes_tr = 1;
          nAnyo_tr = #1#66 - 1;
     |SINO;
          nAnyo_tr = #1#66;
     |FINSI;
     #1#0 = #1#0;
     #1#1 = #1#1;
     #1#66= nAnyo_tr;
     #1#2 = nMes_tr;
     #1#3 = #1#3;
     |LEE 000#1=;
     |SI FSalida = 0;
          #5#30  = #1#13;
          #5#174 = #1#106;
          #5#175 = #1#107;
     |FINSI;
     |CIERRA #1;
     |REPON_FICHA #nomhicca;
|FPRC;

____________________________________/ DESACTUALIZACION TRABAJADORES
|PROCESO FechaITActual;
     |SI #1#70 ! 0;      || habia una IT en curso del mes anterior
                         || su fecha inicio sera la que habia menos los dias
                         || de la enf actual
          alfa1 = "01";
          alfa2 = #0#4; |QBF alfa2; alfa2 = ("00" + alfa2) % -102;
          nume4 = 2000 + #0#5; alfa3 = nume4;
          aFecha = alfa1 + "." + alfa2 + "." + alfa3;
          fFecha = aFecha;
          nFecha = fFecha;
          nFecha = nFecha - #1#70;
          fFecha = nFecha;
          #5#125 = fFecha;
     |FINSI;
     |SI #1#70 = 0; |Y #1#73 = 0;
          #5#125 = "";
     |FINSI;
     aAlfa = #5#125;
     |QBF aAlfa;
     |SI #1#70 ! 0; |Y aAlfa = ""; || la IT ha terminado este mes
          |PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;
               nume2 = nume1 - 8;    || desde
               nume3 = nume1 - 4;    || hasta
               |SI #1nume1 = "E"; |O #1nume1 = "M";
               |O #1nume1 = "P"; |O #1nume1 = "R";
                    |SI #1nume2 = 0; |Y #1nume3 ! 0;
                         alfa1 = "01";
                         alfa2 = #0#4; |QBF alfa2; alfa2 = ("00" + alfa2) % -102;
                         nume4 = 2000 + #0#5; alfa3 = nume4;
                         aFecha = alfa1 + "." + alfa2 + "." + alfa3;
                         fFecha = aFecha;
                         nFecha = fFecha;
                         nFecha = nFecha - #1#70;
                         fFecha = nFecha;
                         #5#125 = fFecha;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |SI #1#73 ! 0; |Y aAlfa = ""; || la IT ha terminado este mes
          |PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;
               nume2 = nume1 - 8;    || desde
               nume3 = nume1 - 4;    || hasta
               |SI #1nume1 = "A";
                    |SI #1nume2 = 0; |Y #1nume3 ! 0;
                         alfa1 = "01";
                         alfa2 = #0#4; |QBF alfa2; alfa2 = ("00" + alfa2) % -102;
                         nume4 = 2000 + #0#5; alfa3 = nume4;
                         aFecha = alfa1 + "." + alfa2 + "." + alfa3;
                         fFecha = aFecha;
                         nFecha = fFecha;
                         nFecha = nFecha - #1#70;
                         fFecha = nFecha;
                         #5#125 = fFecha;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO traba2;
     |HAZ FechaITActual;
     #5#60 = #1#68;    || clave enfermedad
     #5#88 = #1#69;    || dias enfer. a¤o
     #5#89 = #1#70;    || dias enfer. actual
     #5#90 = #1#71;    || dias enfer. cal. anual
     #5#91 = #1#72;    || dias accte. a¤o
     #5#92 = #1#73;    || dias accte. actual
     #5#93 = #1#74;    || dias huelga a¤o
     #5#94 = #1#75;    || dias absentismo a¤o
     #5#95 = #1#76;    || promedio enfer.
     #5#96 = #1#77;    || promedio accte.
     |SI #5#42 = "A"; |O #5#42 = "E"; |O #5#42 = "e";
         #5#95 = #1#35;    || promedio enfer.
         #5#96 = #1#36;    || promedio accte.
     |FINSI;
     #5#44 = "A";      || situacion (siempre alta)
     #5#45 = #1#78;    || tipo contrato
     |SI #5#42 ! "X"; |Y #5#42 ! "T"; |Y #5#42 ! "P";
          #5#46 = #1#79;    || dias contrato
     |FINSI;
     |SI #5#42 = "X"; |O #5#42 = "T"; |O #5#42 = "P"; |O #5#42 = "I";
          #5#47 = #1#80;    || horas contrato
     |FINSI;
     #5#50 = #1#81;    || dias dto. ILT -1
     #5#51 = #1#82;    || dias dto. ILT -2
     #5#52 = #1#83;    || dias dto. ILT -3
     #5#53 = #1#84;    || dias dto. ILT -4
     #5#54 = #1#85;    || dias dto. ILT -5
     #5#78 = #1#86;    || dias dto. ILT -6
     #5#79 = #1#87;    || dias dto. ILT -7
     #5#80 = #1#88;    || dias dto. ILT -8
     #5#55 = #1#89;    || acum. bases/dias -1
     #5#56 = #1#90;    || acum. bases/dias -2
     #5#57 = #1#91;    || acum. bases/dias -3
     #5#58 = #1#92;    || acum. bases/dias -4
     #5#59 = #1#93;    || acum. bases/dias -5
     #5#81 = #1#94;    || acum. bases/dias -6
     #5#82 = #1#95;    || acum. bases/dias -7
     #5#83 = #1#96;    || acum. bases/dias -8
     #5#65 = #1#97;    || bases diferidas -1
     #5#66 = #1#98;    || bases diferidas -2
     #5#67 = #1#99;    || bases diferidas -3
     #5#68 = #1#100;   || bases diferidas -4
     #5#69 = #1#101;   || bases diferidas -5
     #5#84 = #1#102;   || bases diferidas -6
     #5#85 = #1#103;   || bases diferidas -7
     #5#86 = #1#104;   || bases diferidas -8
     #5#173 = #1#115;  || dias vacaciones a¤o
     |SI #5#239 = "D";   #5#240 = #5#240 - #1#8;  |FINSI;   || dias antiguedad
     #5#243 = #1#120;  || dias desempleo a¤o
     |HAZ repon_irpf;
     aMotivoBaja = #5#184;
     || #5#184 = "";
     #5#245 = "";
     #5#218 = #5#218 - #1#168;

     |PARA nume1 = 27; |SI nume1 [ 30; |HACIENDO nume1 = nume1 + 1;
          nume2 = nume1 - 8;    || desde
          nume3 = nume1 + 107;  || recaida S/N
          |SI #1nume1 = "E"; |O #1nume1 = "A";
               |SI #1nume2 = 0; |Y #1nume3 = "S";
                    #5#123 = "S";
               |SINO;
                    #5#123 = "N";
               |FINSI;
          |FINSI;
     |SIGUE;

     nEnEmpresa = #5#0;
     |HAZ BuscaModulo;
     |SI swModulo = 3145;
          |HAZ bomb0009;
     |FINSI;

     |DDEFECTO #12;
     #12#0 = #5#0;
     |LEE 000#12=;

     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO traba1;
     swfuera = 2;

     #5#0 = #1#0;    || empresa
     #5#1 = #1#1;    || trabajador
     |LEE 101#5=;
     |SI FSalida = 0;
          |HAZ chequea;
          |SI swfuera = 0;
               aMotivoBaja = "";
               |HAZ traba2;
          |FINSI;
     |SINO;
          alfa1 = "    Trabajador [" + #5#0 + "-" + #5#1 + "] inaccesible o inexistente ...";
          |SI aParam ! "AUTO";
               |MENAV alfa1;
          |FINSI;
     |FINSI;
|FPRC;

____________________________________/ DESACTUALIZACION HORAS EXTRAS
|PROCESO horas;
|DDEFECTO #31;
    #31#0 = #1#0;
    #31#1 = #1#1;
|LEE 101#31=;
|SI FSalida ! 0;    |GRABA 020#31b;     |FINSI;
    nume0 = #1#2 + 1;
    #31nume0 = #1#116;
|GRABA 020#31a;
|LIBERA #31;
|FPRC;
____________________________________/ DESACTUALIZACION BASES CONTINGENCIAS
|PROCESO si_mater;
    sw_mater = 0;
|SI #1#65 ! 0;  ||Y #0#5 ] 95;

        m_dias = #1#65;
    |SI #1#68 = "M";     m_dias = m_dias + #1#70; |FINSI;

        nume1 = 0;
    |SI #1#27 = "M";     nume1 = #1#23; |FINSI;
    |SI #1#28 = "M";     nume1 = #1#24; |FINSI;
    |SI #1#29 = "M";     nume1 = #1#25; |FINSI;
    |SI #1#30 = "M";     nume1 = #1#26; |FINSI;
    |SI nume1 = 0;       nume1 = #1#7;  |FINSI;

        alfa1 = nume1;       alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
        alfa2 = #0#4;        alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
        alfa3 = alfa1 + "." + alfa2 + "." + el_anyo;
        fech1 = alfa3;            nume1 = fech1;
        fech2 = "01.01.1995";     nume2 = fech2;
        nume3 = nume1 - nume2 + 1;

    |SI m_dias [ nume3; sw_mater = 1;  |FINSI;
    |SI #0#4 ] 6;   sw_mater = 1;  |FINSI;
|FINSI;
|FPRC;

|PROCESO bases1;
/*
     || este sistema esta francamente anticuado, lo cambio 01.08.2016

     |HAZ si_mater;
     |SI sw_mater = 0;
          base1 = #1#39;
          base2 = #1#40;
     |SINO;
          base1 = #1#39 + ((dias_mat * #1#35) ! 2);
          base2 = #1#40 + ((dias_mat * #1#35) ! 2);

          nume1 = #1#35 * (dias_mat + #1#31 + #1#32);
          |SI nume1 ! #1#62;    || comparo base en baja de mto. con base en baja real
               nume1 = nume1 - #1#62;  || si son distintas ajusto restando diferencia
               base1 = base1 - nume1;  || a base de comunes de y profesionales, esto es
               base2 = base2 - nume1;  || todo por lo del ajuste que se hizo (busca
          |FINSI;                    || swAjuste3 en nomcal_3
     |FINSI;
*/
     |SI #1#3 = 2; |Y #1#39 = 0;
          || finiquitos sin cotizacion, no pasa
          |ACABA;
     |FINSI;

     base1 = #1#39 + #1#159 + #1#172 + #1#174;
     base2 = #1#40 + #1#159 + #1#172 + #1#174;

     #9#0 = #1#0;
     #9#1 = #1#1;
     |LEE 000#9=;
     |SI FSalida = 0;
          linea = 0;
          borra = 0;
          |HAZ fechabas;
          |BUCLELIN 0bases2#9;
          || SI TENGO Exp. Reg. Empleo

          |SI #1#119 ! 0; |Y #1#3 = 0; |Y #1#9 ! 87; |Y #1#9 ! 97; |Y #1#9 ! 85;
          |Y #1#9 ! 421;
               base1 = base1 + (#1#119 * #labtraba#242);
               base2 = base2 + (#1#119 * #labtraba#242);
          |FINSI;
          |SI borra = 1;
               #10#0 = #1#0;
               #10#1 = #1#1;
               #10#2 = linea;
               |LEE 121#10=;
               |SI #10#7 = base1; |Y #10#8 = base2;
                    |BORRA 020#10a;
                    |SI linea = 1;
                         |BORRA 020#9a;  || si solo hay una linea, borra la cabecera
                    |FINSI;
               |SINO;
                    #10#7 = #10#7 - base1;  || resta base con.com.
                    #10#8 = #10#8 - base2;  || resta base d+f+p
                    |GRABA 020#10a;
               |FINSI;
               |LIBERA #10;
          |FINSI;
     |SINO;
          |SI aParam ! "AUTO";
               alfa1 = "    Bases Contingencias de [" + #9#0 + "-" + #9#1 + "] inaccesibles o inexistentes ...";
               |MENAV alfa1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO fechabas;
    fecalf = #1#5;
|HAZ desglosa;
|SI mes = #1#2; |Y any = el_anyo;
        diab = dia;
|SINO;
        diab = #1#7;
|FINSI;
                  diab = "0" + diab;  diab = diab % -102;
    mesb = #1#2;  mesb = "0" + #1#2;  mesb = mesb % -102;
    anyb = el_anyo;
    fecha = diab + "." + mesb + "." + anyb;
|FPRC;

|PROCESO bases2;
|SI fecha = #10#3;
        borra = 1;
        linea = #10#2;
|FINSI;
|FPRC;

|PROCESO ActEmbargoPI;
     |BORRA 020#18a;

     #17#0 = #labtraba#0;
     #17#1 = #labtraba#7;
     #17#2 = nRegistro;
     |LEE 101#17=;
     |SI FSalida = 0;
          #17#9 = #17#9 - nRestaDelEmbargo;
          #17#10 = #17#10 + nRestaDelEmbargo;
          |GRABA 020#17a;
          |LIBERA #17;
     |FINSI;
|FPRC;

|PROCESO dsam0018;
     nUltima = #18#3;
|FPRC;

|DEFBUCLE dsam0018;
     #18#1;
     ;
     #labtraba#0, #labtraba#7, nRegistro, 01;
     #labtraba#0, #labtraba#7, nRegistro, 99;
     ;
     NULL, dsam0018;
|FIN;

|PROCESO dsam0017;
     nRegistro = #17#2;

     nUltima = 0;
     |BUCLE dsam0018;

     nHastaLinea = nUltima - 2;    || busco por las tres ultimas lineas
     |SI nHastaLinea < 1; nHastaLinea = 1; |FINSI;

     |PARA nLinea = nUltima; |SI nLinea ] nHastaLinea; |HACIENDO nLinea = nLinea - 1;
          nRestaDelEmbargo = 0;
          #18#0 = #labtraba#0;
          #18#1 = #labtraba#7;
          #18#2 = nRegistro;
          #18#3 = nLinea;
          |LEE 101#18=;

          nMes = #0#4;
          nAny = #0#5 + 2000;
          |HAZ topemes_plb;
          aDia = nTopemes; |QBF aDia;
          aMes = nMes; |QBF aMes; aMes = ("00" + aMes) % -102;
          aAny = nAny;
          aFecha = aDia + "." + aMes + "." + aAny;
          fFecha = aFecha;
          |SI #18#4 = fFecha;
               |HAZ MesLetra_plb;
               aAlfa1 = "NOMINA " + aMes + " " + aAny;
               |SI #1#3 = 2;
                    aAlfa1 = "FINIQUITO " + aMes + " " + aAny;
               |FINSI;
               aAlfa2 = #18#5;
               |QBF aAlfa2;
               |SI aAlfa1 = aAlfa2;
                    |SI #18#13 = 0; |O #18#13 = #labtraba#1;
                         nRestaDelEmbargo = #18#6;
                         |HAZ ActEmbargoPI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |LIBERA #18;
          |SI nRestaDelEmbargo ! 0;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dsam0017;
     #17#1;
     ;
     #labtraba#0, #labtraba#7, 01;
     #labtraba#0, #labtraba#7, 99;
     ;
     NULL, dsam0017;
|FIN;

|PROCESO EmbargosIntegral;
     |ABRE #17;
     |ABRE #18;

     nRegistro = 0;
     nEmbargo = #1#146;

     |BUCLE dsam0017;
     |CIERRA #17;
     |CIERRA #18;
|FPRC;

|PROCESO embargos;
     |ABRE #nomembli;

     #nomembli#0 = #1#0;
     #nomembli#1 = #1#1;
     #nomembli#2 = #0#5 + 2000;
     |LEE 101#nomembli.=;
     |SI FSalida = 0;
          nCampo1 = (#0#4 * 2) + 1;
          nCampo2 = nCampo1 + 1;
          #nomembli#nCampo1# = #nomembli#nCampo1# - #1#146;
          |SI -0.1 [ #nomembli#nCampo1#; |Y #nomembli#nCampo1# [ 0.1;
               #nomembli#nCampo1# = 0;
          |FINSI;
          |SI #nomembli#nCampo1# = 0;
               #nomembli#nCampo2# = 0;
          |SINO;
               #nomembli#nCampo2# = #nomembli#nCampo2# - #1#146;
          |FINSI;
          #nomembli#29 = #nomembli#29 + #1#146;
          #nomembli#28 = #nomembli#28 - #1#146;
          |GRABA 020#nomembli.a;
          |LIBERA #nomembli;
     |FINSI;

     || ahora voy a buscar por si hubo cambio de codigo y tengo que
     || quitarselo del trabajador destino

     |SI #nomembli#36 = #0#4; || este mes cambio de codigo
          nEmpDestino = #nomembli#34;
          nTraDestino = #nomembli#35;

          |SALVA_FICHA #nomembli;

          #nomembli#0 = nEmpDestino;
          #nomembli#1 = nTraDestino;
          #nomembli#2 = #0#5 + 2000;
          |LEE 101#nomembli.=;
          |SI FSalida = 0;
               |SI #nomembli#30 = #labtraba#0; |Y #nomembli#31 = #labtraba#1;
               |Y #nomembli#32 = #0#4;
                    nCampo1 = (#0#4 * 2) + 1;
                    nCampo2 = nCampo1 + 1;
                    #nomembli#nCampo1# = #nomembli#nCampo1# - #nomembli#33;
                    |SI -0.1 [ #nomembli#nCampo1#; |Y #nomembli#nCampo1# [ 0.1;
                         #nomembli#nCampo1# = 0;
                    |FINSI;
                    |SI #nomembli#nCampo1# = 0;
                         #nomembli#nCampo2# = 0;
                    |SINO;
                         #nomembli#nCampo2# = #nomembli#nCampo2# - #nomembli#33;
                    |FINSI;
                    #nomembli#29 = #nomembli#29 + #nomembli#33;
                    #nomembli#28 = #nomembli#28 - #nomembli#33;

                    #nomembli#30 = 0;
                    #nomembli#31 = 0;
                    #nomembli#32 = 0;
                    #nomembli#33 = 0;

                    |GRABA 020#nomembli.a;
                    |LIBERA #nomembli;
               |FINSI;
          |FINSI;

          |REPON_FICHA #nomembli;

          #nomembli#34 = 0;
          #nomembli#35 = 0;
          #nomembli#36 = 0;
          #nomembli#37 = 0;

          |GRABA 020#nomembli.a;
          |LIBERA #nomembli;
     |FINSI;

     |CIERRA #nomembli;

     |SI #1#146 ! 0;
          |ABRE #nomcontr; |LEE 000#nomcontr.p; |CIERRA #nomcontr;
          |SI #nomcontr#65 = "S";
               |HAZ EmbargosIntegral;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO borra_nompluba;
     |ABRE #nompluba;
     #nompluba#1 = #nomhicca#0;
     #nompluba#2 = #nomhicca#1;
     nNume = #0#5 + 2000;
     #nompluba#3 = nNume;
     #nompluba#4 = #0#4;
     #nompluba#4 = 0;
     |LEE 101#nompluba.=;
     |SI FSalida = 0;
          |BORRA 020#nompluba.a;
     |FINSI;
     |LIBERA #nompluba;
     |CIERRA #nompluba;
|FPRC;

|PROCESO nomhisit;
     |BORRA 020#nomhisit.a;
     |LIBERA 020#nomhisit;
|FPRC;

|DEFBUCLE nomhisit;
     #nomhisit#1;
     ;
     #nomhicca#0, #nomhicca#1, nNume, #0#4, 1;
     #nomhicca#0, #nomhicca#1, nNume, #0#4, 4;
     ;
     NULL, nomhisit;
|FIN;

|PROCESO nomgirli;
     |BORRA 020#nomgirli.a;
     |LIBERA 020#nomgirli;
|FPRC;

|DEFBUCLE nomgirli;
     #nomgirli#2;
     ;
     #nomhicca#0, #nomhicca#1, nNume, #0#4;
     #nomhicca#0, #nomhicca#1, nNume, #0#4;
     ;
     NULL, nomgirli;
|FIN;

|PROCESO nomir012;
     |ABRE #nomir012;
     #nomir012#1 = #nomhicca#0;
     #nomir012#2 = #nomhicca#1;
     nNume = #0#5 + 2000;
     #nomir012#3 = nNume;
     #nomir012#4 = #0#4;
     |LEE 101#nomir012.=;
     |SI FSalida = 0;
          |BORRA 020#nomir012.a;
     |FINSI;
     |LIBERA #nomir012;
     |CIERRA #nomir012;
|FPRC;

|PROCESO nomvarcb;
     |BORRA 020#nomvarcb.a;
     #nomvarcb#4 = 0000;
     |GRABA 020#nomvarcb.n;
     |LIBERA #nomvarcb;
|FPRC;

|DEFBUCLE nomvarcb;
     #nomvarcb#1;
     ;
     #labtraba#0, #labtraba#1, #0#4, 0, nNume, 00;
     #labtraba#0, #labtraba#1, #0#4, 0, nNume, 31;
     be;
     NULL, nomvarcb;
|FIN;

|PROCESO nomvarcb_borra;
     |BORRA 020#nomvarcb.a;
     |LIBERA #nomvarcb;
|FPRC;

|DEFBUCLE nomvarcb_borra;
     #nomvarcb#1;
     ;
     #labtraba#0, #labtraba#1, #0#4, 0, 0000, 00;
     #labtraba#0, #labtraba#1, #0#4, 0, 0000, 31;
     be;
     NULL, nomvarcb_borra;
|FIN;

|PROCESO nomimpr2;
     |BORRA 020#nomimpr2.a;
     |LIBERA #nomimpr2;
|FPRC;

|DEFBUCLE nomimpr2;
     #nomimpr2#1;
     ;
     #labtraba#0, #labtraba#1, #0#4, 0, nNume, 101;
     #labtraba#0, #labtraba#1, #0#4, 0, nNume, 999;
     be;
     NULL, nomimpr2;
|FIN;

|PROCESO nomimpr1;
     |ABRE #nomimpr1;
     #nomimpr1#0 = #labtraba#0;
     #nomimpr1#1 = #labtraba#1;
     #nomimpr1#2 = #0#4;
     #nomimpr1#3 = 0;
     #nomimpr1#4 = nNume;
     |LEE 101#nomimpr1.=;
     |SI FSalida = 0;
          |BORRA 020#nomimpr1.a;
     |FINSI;
     |LIBERA #nomimpr1;
     |CIERRA #nomimpr1;
|FPRC;

____________________________________/ VARIACIONES
|PROCESO varia1;
     |SI #1#3 ! 2;    || en los finiquitos no toca las variaciones!!!
          #7#0 = #1#0;
          #7#1 = #1#1;
          #7#2 = #1#2;
          #7#3 = 0;
          |LEE 101#7=;
          |SI FSalida = 0;
               |BUCLELIN 1NULL#7;
               |BORRA 020#7a;
          |FINSI;
     |FINSI;

     |ABRE #nomcontr; |LEE 000#nomcontr.p;   |CIERRA #nomcontr;
     |SI #nomcontr#44 = "S"; |O aParam = "AUTO";
          |HAZ grabamen;
     |FINSI;
     |HAZ varia3;
     |HAZ embargos;

     nNume = #0#5 + 2000;
     |BUCLE nomvarcb_borra;   || primero borro lo que haya en el mes que desactualizo
     |BUCLE nomvarcb;         || ahora paso las que tenian a¤o a a¤o 0000 en el mes

     |SI #nomcontr#44 ! "S"; |O aParam = "AUTO";
          nNume = #0#5 + 2000;
          |BUCLE nomgirli;
          || no borro los resultados de la regularizacion si me quedo con los
          || calculos en el mantenimiento
          |HAZ nomir012;

          |HAZ borra_nompluba;
     |FINSI;

     nNume = #0#5 + 2000;
     |HAZ nomimpr1;
     |BUCLE nomimpr2;

     nNume = #0#5 + 2000;
     |BUCLE nomhisit;
|FPRC;

|PROCESO Anticipos95X;
     nNume = nNume + (#nomhicli#10 * #nomhicli#11) ! 2;
|FPRC;

|DEFBUCLE Anticipos95X;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 951;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 960;
     ;
     NULL, Anticipos95X;
|FIN;

|PROCESO Concepto908;
     sw908 = 1;
|FPRC;

|DEFBUCLE Concepto908;
     #nomhicli#1;
     ;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 908;
     #nomhicca#0, #nomhicca#1, #nomhicca#66, #nomhicca#2, #nomhicca#3, 908;
     ;
     NULL, Concepto908;
|FIN;

|PROCESO varia3;
|SI #1#3 ! 2;
    |DDEFECTO #7;
        dhuel = 0;  dabse = 0;  dvaca = 0;  ddese = 0;

        #7#00 = #1#0;  || empresa
        #7#01 = #1#1;  || trabajador
        #7#02 = #1#2;  || mes
        #7#03 = #1#3;  || solo graba el tipo 0!!!
    |PARA campo = 27; |SI campo [ 30; |HACIENDO campo = campo + 1;
            desde = campo - 8;
            hasta = campo - 4;
            puntero = desde - 15;  #7puntero = #1desde;   || tabla de
            puntero = hasta - 15;  #7puntero = #1hasta;   || /variaciones
            puntero = campo - 15;  #7puntero = #1campo;
        |SI #1campo = "H";    dhuel = dhuel + (#1hasta - #1desde) + 1; |FINSI;
        |SI #1campo = "F";    dabse = dabse + (#1hasta - #1desde) + 1; |FINSI;
        |SI #1campo = "f";    dabse = dabse + (#1hasta - #1desde) + 1; |FINSI;
        |SI #1campo = "V";    dvaca = dvaca + (#1hasta - #1desde) + 1; |FINSI;
        |SI #1campo = "D";    ddese = ddese + (#1hasta - #1desde) + 1; |FINSI;
        |SI #1campo = "C";
               #7#51 = #5#133;
        |FINSI;
    |SIGUE;
        #7#16 = #1#5;  || fecha baja
        #7#17 = #1#35; || prom. enfer.
        #7#18 = #1#36; || prom. accte.
        /*
        |SI #5#42 = "A"; |O #5#42 = "E"; |O #5#42 = "e";
             #7#17 = #1#158; || prom. enfer.
             #7#18 = #1#158; || prom. accte.
        |FINSI;
        */
        #7#19 = #1#52; || anticipos 1
        #7#20 = #1#53; || anticipos 2
        sw908 = 0;
        |BUCLE Concepto908;
        |SI sw908 = 0;
             || si se han introducido mediante el  concepto 908
             || no uses el campo este de variaciones
             #7#21 = #1#54; || en especie
        |FINSI;
        nNume = 0;
        |BUCLE Anticipos95X;
        #7#44 = #1#131 - nNume; || anticipos 3

        |SI #7#19 ! 0; #7#28 = #1#227; |FINSI;
        |SI #7#20 ! 0; #7#29 = #1#228; |FINSI;
        |SI #7#44 ! 0; #7#45 = #1#229; |FINSI;

    |SI #1#33 > 0;|Y #1#33 < 1;
            #7#22 = (#1#33 - 1) * 100;       || fraccion huelga
    |SINO;
            #7#22 = (#1#33 * 100) $ 100;     || fraccion huelga
        |SI #1#33 < dhuel;    #7#22 = -#7#22;     |FINSI;
    |FINSI;
    |SI #1#34 > 0;|Y #1#34 < 1;
            #7#23 = (#1#34 - 1) * 100;       || fraccion absentismo
    |SINO;
            #7#23 = (#1#34 * 100) $ 100;     || fraccion absentismo
        |SI #1#34 < dabse;    #7#23 = -#7#23;     |FINSI;
    |FINSI;
    |SI #1#66 > 0;|Y #1#66 < 1;
            #7#24 = (#1#66 - 1) * 100;       || fraccion vacaciones
    |SINO;
            #7#24 = (#1#66 * 100) $ 100;     || fraccion vacaciones
        |SI #1#66 < dvaca;    #7#24 = -#7#24;     |FINSI;
    |FINSI;
        #7#25 = #1#117;                 || dto.pagas huelga
        #7#26 = #1#118;                 || dto.pagas absentismo
    /*
    || a partir de la regulacion de empleo a TP esto lo quito
    |SI #1#119 > 0;|Y #1#119 < 1;
            #7#27 = (#1#119 - 1) * 100;       || fraccion desempleo
    |SINO;
            #7#27 = (#1#119 * 100) $ 100;     || fraccion desempleo
        |SI #1#119 < ddese;    #7#27 = -#7#27;     |FINSI;
    |FINSI;
    */
    aAlfa = #7#16;
    |QBF aAlfa;
    |SI aAlfa ! ""; |Y aAlfa ! "..........";
         aAlfa = aMotivoBaja;
         |QBF aAlfa;
         aAlfa = aAlfa % 102;
         #7#46 = aAlfa;
    |FINSI;
     #7#35 = #1#134; #7#36 = #1#135; #7#37 = #1#136; #7#38 = #1#137;

     /*
     #7#39 = "01.01.0000";
     #7#40 = "01.01.0000";
     #7#41 = "01.01.0000";
     #7#42 = "01.01.0000";
     */
     #7#39 = "";
     #7#40 = "";
     #7#41 = "";
     #7#42 = "";
     |SI #7#35 = "S";
          #7#39 = #1#139;
     |FINSI;
     |SI #7#36 = "S";
          #7#40 = #1#140;
     |FINSI;
     |SI #7#37 = "S";
          #7#41 = #1#141;
     |FINSI;
     |SI #7#38 = "S";
          #7#42 = #1#142;
     |FINSI;
     #7#47 = #1#161; #7#48 = #1#162; #7#49 = #1#163; #7#50 = #1#164;
     |SI #5#60 = "C";
          #7#51 = #5#133;
     |FINSI;
     || hospitalizacion, no me lo guardo en el historico de calculos

     || miro el historico de ITs

     |ABRE #nomhisit;

     |PARA campo = 27; |SI campo [ 30; |HACIENDO campo = campo + 1;
          |SI #1campo = "E";
               #nomhisit#0 = #1#0;
               #nomhisit#1 = #1#1;
               #nomhisit#2 = #1#66 + 2000;
               #nomhisit#3 = #1#2;
               #nomhisit#8 = campo - 26;
               |LEE 000#nomhisit.=;
               |SI FSalida = 0;
                    |SI #nomhisit#71 = "S";
                         nCampo1 = campo + 4;
                         #nomvarca#nCampo1# = "S";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;

     |CIERRA #nomhisit;

     |GRABA 020#7n;
|FINSI;
|BUCLELIN 0varia4#1;
|BORRA 020#1a;
|FPRC;

|PROCESO varia4;
|SI #2#04 < 201; |O #2#04 > 208;     || no conceptos 2xx
    |SI #2#04 < 501; |O #2#04 > 599; || no conceptos 5xx
        |SI #1#3 ! 2;                || no finiquitos
                #8#0 = #1#00;  || empresa
                #8#1 = #1#01;  || trabajador
                #8#2 = #1#02;  || mes
                #8#3 =     0;  || tipo
                #8#4 = #2#04;  || concepto
                #8#5 = #2#09;  || unidades
                |SI #8#4 = 927; #8#5 = #2#10; |FINSI;
                alfa1 = #8#5; |QBF alfa1;
                alfa1 = ("          " + alfa1) % -110;
                #8#5 = alfa1;
                #8#6 = #2#10;  || valor
                alfa1 = #8#6; |QBF alfa1;
                alfa1 = ("            " + alfa1) % -112;
                #8#6 = alfa1;
                |SI #8#4 = 927; #8#6 = "Promedio Mat"; |FINSI;
            |GRABA 020#8n;
        |FINSI;
    |FINSI;
|FINSI;
|BORRA 020#2a;
|FPRC;

____________________________________/ RUTINAS
|PROCESO chequea;  || chequea el trabajador este en periodo de alta
    swfuera = 0;
    fecalf = #5#36;   || fecha de alta
|HAZ desglosa;
|SI any > el_anyo;
        swfuera = 1;
|SINO;
    |SI mes > #0#4; |Y any = el_anyo;
            swfuera = 1;
    |FINSI;
|FINSI;
|SI swfuera = 0;
        fecalf = #5#37;  || fecha de baja
    |HAZ desglosa;
    |SI any < el_anyo; |Y any ! 0;
            swfuera = 1;
    |SINO;
        |SI mes < #0#4; |Y any = el_anyo; |Y mes ! 0;
                swfuera = 1;
        |FINSI;
    |FINSI;
|FINSI;
swfuera = 0;        || como si no entrara en el proceso,si entra no deja desactualizar
|FPRC;

|PROCESO desglosa;     || DESGLOSA EN DIA, MES Y ANYO UNA FECHA DD.MM.AAAA
    alfa1 = fecalf %  102;   dia = alfa1;
    alfa1 = fecalf %  402;   mes = alfa1;
    alfa1 = fecalf % -104;   any = alfa1;
|SI alfa1 = "....";
        dia = 0;
        mes = 0;
        any = 0;
|FINSI;
|FPRC;

/*************** PARA EL MODULO DE BOMBEROS *********************************/

|PROCESO bomb0009;
     || proceso para el tema de las antiguedades en bomberos


     |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/bomb0009.mas";
     |CARGA_DEF aAlfa, copiadef@;

     |ABRE #500;

     #500#0 = #labtraba#0;
     #500#1 = #labtraba#1;
     |LEE 000#500=;

     alfa = #500#37;
     alfa1 = alfa % 402;      || mes que cumplio la ultima antiguedad
     alfa2 = alfa % -104;     || a¤o que cumplio la ultima antiguedad

     nume1 = alfa1;
     nume2 = alfa2;
     nume2 = nume2 - 2000 - 3;

     nume1 = nume1 + 1;
     |SI nume1 = 13;
          nume1 = 1;
          nume2 = nume2 + 1;
     |FINSI;

     swCambia = 0;
     |SI nume1 = #0#4; |Y nume2 = #0#5;
          || el mes que estoy desactualizando he cumplido antiguedad
          |PARA nume1 = 9; |SI nume1 [ 21; |HACIENDO nume1 = nume1 + 3;
               nume2 = nume1 + 1;
               nume3 = nume1 + 2;
               |SI #500#28 = #500nume1; |Y #500#29 = #500nume2;
                    #500nume3 = #500nume3 - 1
                    |SI #500nume3 = 0;
                         #500nume1 = 0;
                         #500nume2 = " ";
                         #500nume3 = 0;
                    |FINSI;
                    swCambia = 1;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |SI swCambia = 1;
          alfa1 = #500#8 % -104;
          nume4 = alfa1;      || a¤o reconocimiento
          |PARA nume1 = 9; |SI nume1 [ 21; |HACIENDO nume1 = nume1 + 3;
               nume2 = nume1 + 1;
               nume3 = nume1 + 2;
               ||SI #500#28 = #500nume1; |Y #500#29 = #500nume2;
                    nume4 = nume4 + (#500nume3 * 3);
                    ||SAL;
               ||FINSI;
          |SIGUE;
          nume4 = nume4 + 3;
          alfa1 = nume4;
          alfa2 = (#500#8 % 106);
          alfa1 = alfa2 + alfa1;
          #500#37 = alfa1;
     |FINSI;

     |SI swCambia = 1;
          |GRABA 020#500a;
          |LIBERA #500;
     |FINSI;

     |CIERRA #500;

     |DESCARGA_DEF #copiadef@;
|FPRC;


/**** PARA CONSERVAR LA FICHA EN EL MENSUAL SI SE DESACTUALIZA POR ERROR ****/

|PROCESO grabalinmen;      || Graba lineas del mensual
     #4#0  = #2#0;   || Codigo empresa
     #4#1  = #2#1;   || Codigo trabajador
     #4#2  = #2#2;   || Mes
     #4#3  = #2#3;   || Tipo
     #4#4  = #2#4;   || Registro
     |LEE 101#4=;
     estado = FSalida;
     |DDEFECTO #4;
     |PARA x = 0; |SI x [ 11; |HACIENDO x = x + 1;
          #4x = #2x;    || Pase de variables
     |SIGUE;
     |SI estado = 0;
          |GRABA 020#4a;
     |SINO;
          |GRABA 020#4n;
     |FINSI;
     |LIBERA #4;
|FPRC;

|PROCESO grabamen;
     |ABRE #3;
     #3#0  = #1#0;   || Codigo empresa
     #3#1  = #1#1;   || Codigo trabajador
     #3#2  = #1#2;   || mes
     #3#3  = #1#3;   || tipo
     |LEE 101#3=;
     estado = FSalida;
     |DDEFECTO #3;
     |PARA x = 0; |SI x [ 65; |HACIENDO x = x + 1;
        #3x = #1x;    || Pase de variables
     |SIGUE;
     #3#66 = #1#105;    || dias vacaciones
     #3#67 = #1#106;    || (%) retencion 2
     #3#68 = #1#107;    || (%) retencion 3
     #3#69 = #1#108;    || base irpf 2
     #3#70 = #1#109;    || base irpf 3
     #3#71 = #1#110;    || imp. retencion 2
     #3#72 = #1#111;    || imp. retencion 3
     #3#73 = #1#112;    || prest. enf. empresa
     #3#74 = #1#113;    || total bases
     #3#75 = #1#114;    || total retenciones
     #3#76 = #1#117;    || dto. pagas huelga
     #3#77 = #1#118;    || dto. pagas absentismo
     #3#78 = #1#119;    || dias desempleo mes
     #3#79 = #1#121;    || base bonif. cc 2
     #3#80 = #1#122;    || base bonif. cp 2
     #3#81 = #1#123;    || cuota bonif. 2
     #3#82 = #1#124;    || % bonif. 1
     #3#83 = #1#125;    || % bonif. 2
     #3#84 = #1#126;    || base ILT bonif 1
     #3#85 = #1#127;    || base ILT bonif 2
     #3#86 = #1#128;    || anticipos Paga Extra
     #3#87 = #1#129;    || (%) retencion pagas
     #3#88 = #1#130;    || bonif. mayores 60 a¤os, R.D.L. 16/2001
     #3#89 = #1#131;    || anticipos 3 (P.Extra)
     #3#89 = #1#131;    || bonif. mater. agrarios,NO SE ESTA USANDO 17-12-02
     #3#90 = #1#132;    || dias laborables IT Regimen Carbon
     #3#91 = #1#133;    || dias permiso (sin retribucion, para bomberos)
     #3#96 = #1#138;    || bonif. Fomento contratacion indefinida RDL 5/2006
     #3#104 = #1#146;    || embargo
     #3#105 = #1#147;    || absentismo
     #3#106 = #1#148;    || bonif. > 59 a¤os y 4 de antiguedad
     #3#107 = #1#149;    || horas de formacion subvencionadas
     #3#108 = #1#150;
     #3#109 = #1#151;
     #3#110 = #1#152;
     #3#111 = #1#153;
     #3#112 = #1#154;
     #3#113 = #1#155;
     #3#114 = #1#156;
     #3#115 = #1#157;
     #3#116 = #1#158;
     #3#117 = #1#159;
     #3#118 = #1#160;
     #3#119 = #1#161;
     #3#120 = #1#162;
     #3#121 = #1#163;
     #3#122 = #1#164;
     #3#123 = #1#165;
     #3#124 = #1#166;
     #3#125 = #1#167;
     #3#126 = #1#168;
     #3#127 = #1#169;
     #3#128 = #1#170;
     #3#129 = #1#171;
     #3#130 = #1#172;
     #3#131 = #1#173;
     #3#132 = #1#174;

     #3#133 = #1#175;
     #3#134 = #1#176;
     #3#135 = #1#177;
     #3#136 = #1#178;
     #3#137 = #1#179;
     #3#138 = #1#180;
     #3#139 = #1#181;
     #3#140 = #1#182;
     #3#141 = #1#183;
     #3#142 = #1#184;
     #3#143 = #1#185;
     #3#144 = #1#186;
     #3#146 = #1#188;
     #3#147 = #1#189;

     #3#148 = #1#190;
     #3#149 = #1#191;
     #3#150 = #1#192;
     #3#151 = #1#193;
     #3#152 = #1#194;
     #3#153 = #1#195;
     #3#154 = #1#196;
     #3#155 = #1#197;
     #3#156 = #1#198;
     #3#157 = #1#199;
     #3#158 = #1#200;
     #3#159 = #1#201;
     #3#160 = #1#202;
     #3#161 = #1#203;
     #3#162 = #1#204;
     #3#163 = #1#205;
     #3#164 = #1#206;
     #3#165 = #1#207;
     #3#166 = #1#208;
     #3#167 = #1#209;
     #3#168 = #1#210;
     #3#169 = #1#211;
     #3#170 = #1#212;
     #3#171 = #1#213;
     #3#172 = #1#214;

     || Campos SS Cgo. Empresa Desglosada

     #3#173 = #1#215;
     #3#174 = #1#216;
     #3#175 = #1#217;
     #3#176 = #1#218;
     #3#177 = #1#219;
     #3#178 = #1#220;
     #3#179 = #1#221;
     #3#180 = #1#222;
     #3#181 = #1#223;
     #3#199 = #1#241;

     || campos para recaidas:

     #3#92 = #1#134; #3#93 = #1#135; #3#94 = #1#136; #3#95 = #1#137;
     #3#97 = #1#139; #3#98 = #1#140; #3#99 = #1#141; #3#100 = #1#142;

     |PARA nCampoMen = 182; |SI nCampoMen [ 198; |HACIENDO nCampoMen = nCampoMen + 1;
          nCampoHis = nCampoMen + 42;
          #3nCampoMen = #1nCampoHis;
     |SIGUE;

     |SI estado = 0;
          |GRABA 020#3a;
     |SINO;
          |GRABA 020#3n;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;

     |ABRE #4;
     |BUCLELIN 0grabalinmen#1;                            || graba historico lins. y
     |CIERRA #4;
|FPRC;


/****** Procesos para comprobacion y borrado de asiento si procede *********/

|PROCESO BorraNomagic1;
     |BORRA 020#nomagic1.a;
|FPRC;

|DEFBUCLE BorraNomagic1;
     #nomagic1#2;
     ;
     #nomhicca#0, nEmpresa, nPeriodo, enDnDIARIO, efDFechas, enDDocume;
     #nomhicca#0, nEmpresa, nPeriodo, enDnDIARIO, efDFechas, enDDocume;
     be;
     NULL, BorraNomagic1;
|FIN;

|PROCESO CompContab;
     |ABRE #nomagic1;
     |ABRE #nomagic2;

     swMensa = 0;
     |SI #nomhicca#0 ! nEmpAnt;
          swMensa1Dado = 0;
          swMensa2Dado = 0;
     |FINSI;

     #nomagic1#0 = #nomhicca#0;
     #nomagic1#1 = #nomhicca#1;
     #nomagic1#2 = #nomhicca#66;
     #nomagic1#3 = #nomhicca#2;
     #nomagic1#4 = #nomhicca#3;
     #nomagic1#5 = "H";
     |LEE 000#nomagic1.=;
     |SI FSalida = 0
          swMensa = 1;
     |FINSI;

     |SI swMensa = 1; |Y swMensa1Dado = 0;
          alfa1 = #nomhicca#0; |QBF alfa1; alfa1 = ("00000" + alfa1) % -105;
          alfa2 = #nomhicca#2; |QBF alfa2; alfa2 = ("00" + alfa2) % -102;
          aAlfa = "    ATENCION: en la Empresa " + alfa1 + " ya se ha ";
          aAlfa = aAlfa + "realizado el asiento de nominas del mes " + alfa2 + ".";
          |MENAV aAlfa;
          aAlfa = "    Si continua con la desactualizacion, el asiento de nominas ";
          aAlfa = aAlfa + " y el del TC1 si existe sera eliminado.";
          |MENAV aAlfa;
          swMensa1Dado = 1;        || ya he dado el mensaje
          swMensa2Dado = 1;        || ya he dado el mensaje
          |CONFI "    N¿Esta seguro de que desea continuar?";
          |SI FSalida = 0;
               swMensa1Dado = 2;   || he de borrar asiento y registro
               swMensa2Dado = 2;   || he de borrar asiento y registro
          |FINSI;
     |FINSI;

     |SI swMensa = 1; |Y swMensa1Dado = 2;
         enDnDIARIO = #nomagic1#6;
         enHnDIARIO = #nomagic1#6;
          efDFechas = #nomagic1#7;
          efHFechas = #nomagic1#7;
          enDDocume = #nomagic1#8;
          enHDocume = #nomagic1#8;
          enBorraAu = 3;    || para no ver pantalla y pasar de tipo asiento

          nEmpresa = #nomagic1#9;
          nPeriodo = #nomagic1#10;

          alfa1 = #nomagic1#9;  |QBF alfa1; alfa1 = ("00000" + alfa1) % -105;
          alfa2 = #nomagic1#10; |QBF alfa2;

          aEmpresa = alfa1;
          aPeriodo = alfa2;

          aAlfa1 = ":contagen/caborasi canempr1 " + aEmpresa + aPeriodo + ";" + aEmpresa + aPeriodo;
          |SUB_EJECUTA_NP aAlfa1;

          |CIERRA #nomagic1;
          |BUCLE BorraNomagic1;
          |ABRE #nomagic1;
     |SINO;
          |SI swMensa1Dado = 1;    || no he de desactualizar
               swfuera = 2;
          |SINO;
               swfuera = 0;
          |FINSI;
     |FINSI;
     |CIERRA #nomagic1;


     swMensa = 0;

     #nomagic2#0 = #nomhicca#0;
     || #nomagic2#1 = #labtraba#77;
     #nomagic2#1 = 0;
     #nomagic2#2 = #nomhicca#66;
     #nomagic2#3 = #nomhicca#2;
     #nomagic2#4 = 0;
     #nomagic2#5 = "H";
     |LEE 101#nomagic2.=;
     |SI FSalida = 0;
          swMensa = 1;
     |FINSI;

     |SI swMensa = 1; |Y swMensa2Dado = 0;

          alfa1 = #nomhicca#0; |QBF alfa1; alfa1 = ("00000" + alfa1) % -105;
          alfa2 = #nomhicca#2; |QBF alfa2; alfa2 = ("00" + alfa2) % -102;
          aAlfa = "    ATENCION: en la Empresa " + alfa1 + " ya se ha ";
          aAlfa = aAlfa + "realizado el asiento del TC1 del mes " + alfa2 + ".";
          |MENAV aAlfa;
          aAlfa = "    Si continua con la desactualizacion, el asiento del TC1 ";
          aAlfa = aAlfa + "sera eliminado y se tendra que volver a realizar el enlace.";
          |MENAV aAlfa;
          swMensa2Dado = 1;        || ya he dado el mensaje
          swMensa1Dado = 1;        || ya he dado el mensaje
          |CONFI "    N¿Esta seguro de que desea continuar?";
          |SI FSalida = 0;
              swMensa2Dado = 2;        || Borrar
              swMensa1Dado = 2;        ||
          |FINSI;
     |FINSI;

     |SI swMensa = 1; |Y swMensa2Dado = 2;
         nCentro = #nomagic2#1;

         || swfuera = 1;
         || swMensa2Dado = 2;   || he de borrar asiento y registro

         enDnDIARIO = #nomagic2#6;
         enHnDIARIO = #nomagic2#6;
         efDFechas = #nomagic2#7;
         efHFechas = #nomagic2#7;
         enDDocume = #nomagic2#8;
         enHDocume = #nomagic2#8;
         enBorraAu = 3;    || para no ver pantalla y pasar de parametros

         alfa1 = #nomagic2#9;  |QBF alfa1; alfa1 = ("00000" + alfa1) % -105;
         alfa2 = #nomagic2#10; |QBF alfa2;

         aEmpresa = alfa1;
         aPeriodo = alfa2;
         aAlfa1 = ":contagen/caborasi canempr1 " + aEmpresa + aPeriodo + ";" + aEmpresa + aPeriodo;
         |SUB_EJECUTA_NP aAlfa1;

         |BORRA 020#nomagic2.a;
         |LIBERA #nomagic2;

     |SINO;
          |SI swMensa2Dado = 1; |Y swMensa = 1;  || no he de desactualizar
               swfuera = 2;
          |FINSI;
     |FINSI;

     |CIERRA #nomagic2;
     |CIERRA #nomagic1;

     nEmpAnt = #nomhicca#0;
|FPRC;

/*
     || ejemplo para usar lo del borrado de apuntes

     enDnDIARIO   = 0;
     enHnDIARIO   = 0;
     efDFechas    = @;
     efHFechas    = @;
     enDDocume    = 0;
     enHDocume    = 0;
     enBorraAu    = 2;    || para no ver pantalla

     aAlfa1 = ":contagen/caborasi " + aEmpresa + aPeriodo;

     |SUB_EJECUTA_NP aAlfa1;
     || en el nomagicu esta
*/

|PROGRAMA;
     aParam = PARAMETRO;
     |QBF aParam;
     |SI aParam = "AUTO";
          #0#0 = nEmpAUTO;
          #0#1 = nEmpAUTO;
          #0#2 = nTraAUTO;
          #0#3 = nTraAUTO;
          #0#4 = nMesAUTO;
          #0#5 = nAnyAUTO - 2000;
          #0#6 = "SI";
          |HAZ tipo3
     |SINO;
          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |HAZ tipo3
          |FINSI;
     |FINSI;
|FPRO;
