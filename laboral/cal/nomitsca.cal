|FICHEROS;
     nomitsli #0,MANTE;
     labtraba #1;
     labempre #2;
     nomhicca #3;
     nomcontr;
|FIN;

|VARIABLES;
     p_mes = "";
     mod = 0;
     varnum1 = 0;
     varnum2 = 0;
     swporsi = 0;
     campo = 0;
     hasta = 0;
     desde = 0;
     baja = 0;
     mesbaja = 0;
     tipo = 0;
     mensaje0 = "0000ATENCION !!! Error de entrada ...";
     mensaje1 = "0000ATENCION !!! Primer dia erroneo ...";
     mensaje2 = "0000ATENCION !!! Tipo de enfermedad erroneo en ficha de trabajadores ...";
     mensaje3 = "0000ATENCION !!! Fecha fuera de periodo de alta ...";
     mensaje4 = "0000ATENCION !!! Fecha fuera del mes actual ...";
     men1 = "0000ATENCION !!! Fecha erronea ...";
     dia1 = "";
     mes1 = "";
     any1 = "";
     dia = 0;
     mes = 0;
     any = 0;
     tope = 0;
     sw = 0;
     fec = "";
     blanco = "          ";
     puntos = "..........";
     varnum = 0;
     desnum = 0;
     hasnum = 0;
     fecsys = @;
     alfa1 = "";
     alfa2 = "";

     fecalf = "";
     fech1 = @;
     nume1 = 0;
     hbase = 0;
     henfe = 0;
     hdias = 0;
     hhor1 = 0;
     hhor2 = 0;
     hmes = 0;
     hany = 0;
     hnat = 0;
     nModo = 0;

     anynum = 0;
     aAlfa = "";
     alfa3 = "";
     alfa4 = "";
     fech2 = @;
     nume2 = 0;
     nume3 = 0;
     numer = 0;
     mesnum = 0;
     nDiasAlta = 0;
     bisiesto = 0;
     topemes = 0;
     nCarencia = 180;
     fFechaHoy = @;
     aNif = "";
     nDesde = 0;
     nHasta = 0;
     nDiasBaja = 0;
     nCampo = 0;
     nCampoD = 0;
     nCampoT = 0;
     nCampoF = 0;
     aDia = "";
     nDia = 0;
     aMes = "";
     nMes = 0;
     aAny = "";
     nAny = 0;
     aFecha = "";
     aFechaBaja = "";
     aFechaAlta = "";
     aMensaje = "";
     swBajaInicial = 0;
|FIN;

|PROCESO Recaida; |TIPO 7;
     |SI #0#5 ! "E";
          #0Campo = "N";
          |PINTA #0Campo;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "S";
     |FINSI;
|FPRC;


|PROCESO Hospital; |TIPO 7;
     |SI #0#5 ! "E"; |Y #0#5 ! "A";
          #0Campo = "N";
          |PINTA #0Campo;
          |CAMPO_MODIFICA #0Campo, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0Campo, 1, "S";
     |FINSI;
|FPRC;

|PROCESO verifech; |TIPO 0;
     |SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;
     fec = #0Campo;
     sw = 0;
     |SI fec ! blanco; |Y fec ! puntos;
          dia1 = fec % A102;
          mes1 = fec % A402;
          any1 = fec % A704;
          dia = dia1; mes = mes1; any = any1;
          |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
               |SI mes [ 12; |Y mes ] 1;
                    |SI mes = 1; |O mes = 3; |O mes = 5; |O mes = 7;
                    |O mes = 8; |O mes = 10; |O mes = 12;
                         tope = 31;
                    |SINO;
                         |SI mes = 2;
                              mod = any $ 4;
                              |SI mod = 0;
                                   tope = 29;
                              |SINO;
                                   tope = 28;
                              |FINSI;
                         |SINO;
                              tope = 30;
                         |FINSI;
                    |FINSI;
                    |SI dia [ tope;
                         sw = 1;
                    |FINSI;
               |FINSI;
          |SINO;
               sw = 1;   || permito fecha 00.00.0000
          |FINSI;
     |SINO;
          sw = 1;
     |FINSI;
     |SI sw = 0;
          |MENAV men1;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO huel1; |TIPO 7;
     |SI #0#5 = "H"; |O #0#5 = "F"; |O #0#5 = "V";
          |CAMPO_MODIFICA #0#8, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#8, 1, "N";
          #0#8 = 0;
          |PINTA #0#8;
     |FINSI;
|FPRC;

|PROCESO huel2; |TIPO 7;
     |SI #0#8 ! 0;
          |CAMPO_MODIFICA #0#9, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#9, 1, "N";
          #0#9 = "N";
          |PINTA #0#9;
     |FINSI;
|FPRC;

|PROCESO chec1; |TIPO 0;  ||chequea que dias actual sea ! 0, cuando lo deba de ser
     |SI #0Campo ! "F"; |Y #0Campo ! "H"; |Y #0Campo ! "V";
          aFechaBaja = #0#3;
          aFechaAlta = #0#4;
          |SI #0Campo ! " ";
               |SI aFechaBaja = "00.00.0000";
                    |ABRE #1;
                    #1#0 = #0#0;
                    #1#1 = #0#1;
                    |LEE 000#1=;
                    |SI FSalida = 0;
                         |SI #0Campo ! "A";                || si el tipo no es correcto
                              |SI #1#60 ! #0Campo;
                                   |MENAV mensaje2;
                                   |ERROR;
                                   #0Campo = "";   || (asi no entra en los siguientes)
                              |FINSI;
                         |FINSI;
                         |SI #0Campo="E"; |O #0Campo="M";  || si dias actual enfer.=0
                              |SI #1#89 = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                         |SI #0Campo = "A";                || si dias actual accid.=0
                              |SI #1#92 = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |CIERRA #1;
               |SINO;
                    |SI #0Campo = "E"; |O #0Campo = "M";   || si dias actual ! 0
                         |SI #1#89 ! 0;                     || y desde dia ! 0
                              swporsi = 0;               || (enfermedad)
                              /*
                              |PARA campo=Campo-1;|SI campo]12;|HACIENDO campo=campo-1;
                                   hasta = campo - 4;
                                   desde = Campo - 8;
                                   |SI #0desde > #0hasta;
                                        swporsi = 1;
                                   |FINSI;
                              |SIGUE;
                              |SI swporsi = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                              */
                         |FINSI;
                    |FINSI;
                    |SI #0Campo = "A";                 || si dias actual ! 0
                    /*
                         |SI #1#92 ! 0;                || y desde dia ! 0
                              swporsi = 0;             || (accidente)
                              |PARA campo=Campo-1;|SI campo]12;|HACIENDO campo=campo-1;
                                   hasta = campo - 4;
                                   desde = Campo - 8;
                                   |SI #0campo = #0Campo; |Y #0desde > #0hasta;
                                        swporsi = 1;
                                   |FINSI;
                              |SIGUE;
                              |SI swporsi = 0;
                                   |MENAV mensaje1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                     */
                    |FINSI;
               |FINSI;
          |SINO;
               #0#5 = "00.00.0000";    || si el tipo es nada limpia el desde y
               #0#6 = "00.00.0000";    || el hasta
               |PINTA #0#5;
               |PINTA #0#6;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ayuda1; |TIPO 7;
     |SI FSalida = 4;|O FSalida = 5;    |ACABA;   |FINSI;

     |PUSHV 05381579;
     |ATRI R;
     ||            1234567890123456789012345678901234567890
     |PINTA 0639, " ---- RELACION DE CLAVES DE I.L.T. ---- ";
     |PINTA 0739, " (E) Enfermedad Comun.                  ";
     |PINTA 0839, " (M) Maternidad.                        ";
     |PINTA 0939, " (A) Accidente de Trabajo.              ";
     |PINTA 1039, " (F) Absentismo (con dto. en pagas).    ";
     |PINTA 1139, " (f) Absentismo (sin dto. en pagas).    ";
     |PINTA 1239, " (H) Huelga.                            ";
     |PINTA 1339, " (D) Expediente de Regulacion de Empleo.";
     |PINTA 1439, " (V) Vacaciones.                        ";
     |ATRI 0;
|FPRC;

|PROCESO ayuda2; |TIPO 0;
     |POPV;
|FPRC;

|PROCESO resta_mes;
     hmes = hmes - 1;
     |SI hmes = 0;
          hmes = 12;
          hany = hany - 1;
          |SI hany < 0;
               hany = 99;
          |FINSI;
     |FINSI;

     nume1 = hany $ 4;
     |SI nume1 = 0;   nume1 = 1;   |SINO;    nume1 = 0;     |FINSI;
     |SI hmes = 1;  hnat = 31;     |FINSI;
     |SI hmes = 2;  hnat = 28 + nume1;  |FINSI;
     |SI hmes = 3;  hnat = 31;     |FINSI;
     |SI hmes = 4;  hnat = 30;     |FINSI;
     |SI hmes = 5;  hnat = 31;     |FINSI;
     |SI hmes = 6;  hnat = 30;     |FINSI;
     |SI hmes = 7;  hnat = 31;     |FINSI;
     |SI hmes = 8;  hnat = 31;     |FINSI;
     |SI hmes = 9;  hnat = 30;     |FINSI;
     |SI hmes = 10; hnat = 31;     |FINSI;
     |SI hmes = 11; hnat = 30;     |FINSI;
     |SI hmes = 12; hnat = 31;     |FINSI;

     fecalf = #1#36;
     alfa1 = fecalf %  102;   dia = alfa1;
     alfa1 = fecalf %  402;   mes = alfa1;
     alfa1 = fecalf % -102;   any = alfa1;
     |SI alfa1 = "..";|O alfa1 = "  ";
          dia = 0;
          mes = 0;
          any = 0;
     |FINSI;

     |SI mes = hmes;|Y any = hany;
          hnat = hnat - dia + 1;
     |FINSI;
|FPRC;


|PROCESO busca_acc;
     |HAZ resta_mes;
     |DDEFECTO #3;
     #3#0  = #0#0;   || empresa
     #3#1  = #0#1;   || trabajador
     #3#2  = hmes;   || mes
     #3#3  = 0;   || tipo
     #3#66 = hany;   || a¤o
     |LEE 000#3=;
     |SI #3#65 ! 0;
          henfe = henfe + #3#62;
     |FINSI;
     |SI #2#40 ! "S";
          hhor1 = 0;
          hhor2 = 0;
     |SINO;
          hhor1 = hhor1 + #3#41;
          hhor2 = hhor2 + #3#42;
     |FINSI;
     hbase = hbase + #3#39;
     hdias = hdias + hnat;          || dias naturales!!!
|FPRC;

|PROCESO prom_tp_acc;
     aAlfa = #0#3;
     aAlfa = aAlfa % 402;
     hmes = aAlfa;
     fech1 = ~; alfa1 = fech1; alfa1 = alfa1 % -102;    || a¤o del sistema
     hany = alfa1;
     |ABRE #3;
     |HAZ busca_acc;
     |HAZ busca_acc;
     |HAZ busca_acc;
     |CIERRA #3;
|FPRC;

|PROCESO busca_enf;
     |HAZ resta_mes;
     |DDEFECTO #3;
     #3#0  = #0#0;   || empresa
     #3#1  = #0#1;   || trabajador
     #3#2  = hmes;   || mes
     #3#3  = 0;   || tipo
     #3#66 = hany;   || a¤o
     |LEE 000#3=;
     |SI #3#65 ! 0;
          henfe = henfe + #3#62;
     |FINSI;
     hbase = hbase + #3#39;
     hdias = hdias + hnat;          || dias naturales!!!
|FPRC;

|PROCESO prom_tp_enf;
     aAlfa = #0#3;
     aAlfa = aAlfa % 402;
     hmes = aAlfa;
     fech1 = ~; alfa1 = fech1; alfa1 = alfa1 % -102;    || a¤o del sistema
     hany = alfa1;
     |ABRE #3;
     hbase = 0;
     hdias = 0;
     henfe = 0;
     |HAZ busca_enf;
     |HAZ busca_enf;
     |HAZ busca_enf;
     |CIERRA #3;
|FPRC;

|PROCESO prom_mat; |TIPO 0;
     |SI #0Campo ! "M";  |ACABA;   |FINSI;

     |ABRE #1;
     |ABRE #2;
     #1#0 = #0#0;
     #1#1 = #0#1;
     |LEE 000#1=;
     |SI FSalida = 0;
          |SI #1#42 = "T";|O #1#42 = "X";|O #1#42 = "P";
               #2#0 = #0#0;
               |LEE 000#2=;           || lee la empresa

/*
        |HAZ prom_tp_enf;
            #0#17 = (hbase + henfe) / hdias;
        |PINTA #0#17;

        |HAZ prom_tp_acc;
            #0#18 = ((hbase + henfe) - (hhor1 + hhor2)) / hdias;
        |PINTA #0#18;
*/
          |FINSI;
     |FINSI;
     |CIERRA #1;
     |CIERRA #2;
|FPRC;
