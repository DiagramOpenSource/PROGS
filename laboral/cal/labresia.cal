|FICHEROS;
    labresia #0;
    labtraba #1;              || trabajadores
    nomhicca #2;              || historico cabs.
    labempre #3;              || empresas
    labcentr #4;              || centros trabajo
    labrespl #5,MANTE;        || planilla seleccion
|FIN;

|VARIABLES;
    fecsys = @;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    seleccio = 0;
    anterior = -1;
    centro = -1;
    ant_dni = "-1";
    &de = 0;
    &da = 0;
    &df = 0;
    &dm = 0;
    &dh = 0;
    &ta = 0;
    &tb = 0;
    &tg = 0;
    &as = "";
    des_emp = 0;
    has_emp = 0;

    fechtra = "";
    sistema = @;
    anynac1 = "";
    anyact1 = "";
    mesnac1 = "";
    mesact1 = "";
    dianac1 = "";
    diaact1 = "";
    anynac2 = 0;
    mesnac2 = 0;
    dianac2 = 0;
    anyact2 = 0;
    mesact2 = 0;
    diaact2 = 0;
    edadxxx = 0;

    &cod = 0;
    &nom = "";
    &nac = "";
    &cen = 0;
    &con = "";
    &hor = 0;
    &alt = @;
    &baj = @;
    &ven = @;
    &nif = "";

     aAlfa1 = "";
     aAlfa2 = "";
     nNume1 = 0;
     nNume2 = 0;
     fTopeBaja = @;
     fFech1 = @;
     fMayorAlta = @;
     swHayHist = 0;
|FIN;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO min;
    #5#0 = 1;
|FPRC;

|PROCESO max;
    #5#0 = 99999;
|FPRC;

|PROCESO noentres; |TIPO 0;
|SI #0#8 = "S";
        alfa1 = "N";
    |PUSHV 0501 2380;
    |ENTLINEAL #1#5, 1, 3, 22, 1, min, max;
    |POPV;
|SINO;
        alfa1 = "S";
|FINSI;
|CAMPO_MODIFICA #0#0, 1, alfa1;
|CAMPO_MODIFICA #0#1, 1, alfa1;
|CAMPO_MODIFICA #0#2, 1, alfa1;
|CAMPO_MODIFICA #0#3, 1, alfa1;
|FPRC;

|PROCESO defecto; |TIPO 7; ||calcula el a¤o por defecto segun fecha sistema
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -102;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;
____________________________________/ CALCULOS DE IMPRESION
|PROCESO menor;               || calcula la edad
    as = "";
|SI nac ! "          "; |Y nac ! "..........";
        sistema = ~;
        fechtra = nac;
        anynac1 = fechtra % -104;    || desglosa fecha nacimiento en a¤os
        anynac2 = anynac1;
        mesnac1 = fechtra %  402;    || meses
        mesnac2 = mesnac1;
        dianac1 = fechtra %  102;    || y dias
        dianac2 = dianac1;
        fechtra = sistema;
        anyact1 = fechtra % -104;    || desglosa fecha actual en a¤os
        anyact2 = anyact1;
        mesact1 = fechtra %  402;    || meses
        mesact2 = mesact1;
        diaact1 = fechtra %  102;    || y dias
        diaact2 = diaact1;
        edadxxx = anyact2 - anynac2; || halla los a¤os
    |SI mesnac2 > mesact2;
            edadxxx = edadxxx - 1;   || resta un a¤o si aun no ha llegado el mes
    |FINSI;
    |SI mesnac2 = mesact2; |Y dianac2 > diaact2; ||o si aun no ha llegado el dia
            edadxxx = edadxxx - 1;
    |FINSI;
    |SI edadxxx < 19;
            as = "*";
    |FINSI;
|FINSI;
|FPRC;

|PROCESO limpia;
    de = 0;
    da = 0;
    dm = 0;
    df = 0;
    dh = 0;
    ta = 0;
    tb = 0;
    tg = 0;
    fMayorAlta = "01.01.0001";
|FPRC;

|PROCESO detalle;
     swHayHist = 1;
     de = de + #2#31;     || dias enfermedad
     da = da + #2#32;     || accidente
     dm = dm + #2#65;     || maternidad
     df = df + #2#34;     || absentismo
     dh = dh + #2#33;     || huelga

     #1#0 = #2#0;
     #1#1 = #2#1;
     |LEE 000#1=;

     |SI #0#10 = "C";
          ta = ta + #2#08;     || dias alta
     |SINO;
          |SI #1#42 = "M"; |Y #2#8 = 30;     || ALTA EL MES COMPLETO
               ta = ta + #2#07;     || dias alta cambiado a peticion de Serna por dias mes
          |SINO;
               ta = ta + #2#08;     || dias alta
          |FINSI;
     |FINSI;
     |SI #0#10 = "C";
          tb = de + da + dm + df + dh; || dias baja
     |SINO;
          ta = ta - dh;             || los dias de huelga como si no existieran
          tb = de + da + dm + df; || dias baja
     |FINSI;
     tg = ta - tb;        || total general

     fFech1 = #2#4;
     |SI fFech1 > fMayorAlta;
          fMayorAlta = #2#4;
          con = #2#9;
          con = ("000" + con) % -103;
     |FINSI;
|FPRC;

|DEFBUCLE lee_histo;
 #2#1;
 ;
 #1#0, #1#1, #0#4, #0#5, 0;
 #1#0, #1#1, #0#4, #0#6, 0;
 ;
 NULL, detalle;
|FIN;

|PROCESO rup_centro;
|SI centro ! #1#77;|Y #0#7 = "S";           || ruptura por centro
    |SI centro ! -1;
        |SI seleccio ! 0;
            |PIEINF;
        |FINSI;
        |FININF;
    |FINSI;
    |INFOR "labresia";
        centro = #1#77;
        seleccio = 0;
        fMayorAlta = "01.01.0001";
|FINSI;
|DDEFECTO #4;
    #4#0 = #1#0;
    #4#1 = #1#77;
|LEE 020#4=;
|FPRC;

|PROCESO rup_empre;
|SI anterior ! #1#0;          || ruptura por empresa
    |SI anterior ! -1;
        |SI seleccio ! 0;
            |PIEINF;
        |FINSI;
        |FININF;
    |FINSI;
    |INFOR "labresia";
        anterior = #1#0;
        centro = #1#77;
        seleccio = 0;
        fMayorAlta = "01.01.0001";
    |DDEFECTO #3;
        #3#0 = #1#0;
    |LEE 020#3=;
|FINSI;
|FPRC;

|PROCESO valores_ant;
    cod = #1#1;
    nom = #1#2;
    nif = #1#7;
    nac = #1#11;
    cen = #1#77;
    hor = #1#47;
    alt = #1#36;
    baj = #1#37;
    ven = #1#41;
||    con = #1#45;
|FPRC;

|PROCESO rup_traba;
|SI da!0;|O de!0;|O dm!0;|O df!0;|O dh!0;|O ta!0;|O tb!0;|O tg!0;
    |HAZ menor;
    |PRINT;
        seleccio = 1;
|FINSI;
|HAZ limpia;
|FPRC;

|PROCESO sigue;
     |SI #labtraba#37 ! "          ";|Y #labtraba#37 ! "..........";
          fFech1 = #labtraba#37;
          |SI fFech1 < fTopeBaja;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI ant_dni = "-1";
             ant_dni = #1#7;
     |FINSI;
     |SI #0#9 = "S";
          |SI ant_dni ! #1#7;
               |HAZ rup_traba;
               ant_dni = #1#7;
          |FINSI;
     |SINO;
          |HAZ rup_traba;
          ant_dni = #1#7;
     |FINSI;

     |HAZ rup_empre;
     |HAZ rup_centro;
     swHayHist = 0;
     |BUCLE lee_histo;
     |SI swHayHist = 1;
          |HAZ valores_ant;
     |FINSI;
|FPRC;

|DEFBUCLE lee_traba2;
 #1#1;
 ;
 des_emp, #0#2;
 has_emp, #0#3;
 ;
 NULL, NULL, NULL, NULL, NULL, sigue;
 #1#0, #1#77, #1#7, #1#1;
|FIN;

|DEFBUCLE lee_traba1;
 #1#1;
 ;
 des_emp, #0#2;
 has_emp, #0#3;
 ;
 NULL, NULL, NULL, NULL, NULL, sigue;
 #1#0, #1#7, #1#1;
|FIN;

|PROCESO leyendo;
    des_emp = #5#0;
    has_emp = #5#0;
|SI #0#7 = "N";     |BUCLE lee_traba1;  |FINSI;
|SI #0#7 = "S";     |BUCLE lee_traba2;  |FINSI;
|HAZ rup_traba;
    ant_dni = "-1";
    fMayorAlta = "01.01.0001";
|FPRC;

|DEFBUCLE lee_plani;
 #5#1;
 ;
    1;
 9999;
 ;
 NULL, leyendo;
|FIN;

|PROCESO tipo3; |TIPO 3;
|IMPRE 0;
|SI FSalida = 0;

    |SI #0#4 < 80;  nNume1 = #0#4 + 2000;  |SINO;  nNume1 = #0#4 + 1900;   |FINSI;
    aAlfa1 = #0#5;  aAlfa1 = ("00" + aAlfa1) % -102;
    aAlfa2 = "01." + aAlfa1 + "." + nNume1;
    fTopeBaja = aAlfa2;
    nNume2 = fTopeBaja;
    nNume2 = nNume2 - 1;
    fTopeBaja = nNume2;
          || los que tengan fecha de baja anterior a esta, no entran

    |ABRE #1;
    |ABRE #3;
    |ABRE #4;
    |SI #0#8 = "N";
            des_emp = #0#0;
            has_emp = #0#1;
        |SI #0#7 = "N";     |BUCLE lee_traba1;  |FINSI;
        |SI #0#7 = "S";     |BUCLE lee_traba2;  |FINSI;
    |SINO;
        |BUCLE lee_plani;
    |FINSI;
    |CIERRA #1;
    |CIERRA #3;
    |CIERRA #4;
    |SI anterior ! -1;
        |HAZ rup_traba;
        |SI seleccio ! 0;
            |PIEINF;
        |FINSI;
        |FININF;
    |FINSI;
|SINO;
    |MENAV "    ATENCION!!! Proceso abortado ...";
|FINSI;
|FINIMP;
|FPRC;
