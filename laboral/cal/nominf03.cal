|FICHEROS;
     nominf03 #0;
     nomhicca;

     labempre;
     labcentr;
     labtraba;
     nomcnahi;
     nomcnama;
     nomocuma;
     nomepigr;
|FIN;

|VARIABLES;
     aAlfa = "";
     fFecha = @;

     nPorIT = 0;
     nPorIMS = 0;
     nPorIT_it = 0;
     nPorIMS_it = 0;

     nBaseIT = 0;
     nBaseMat = 0;
     nBaseAlta = 0;

     &nCuota = 0;

     nCuotaAlta = 0;
     nCuotaIT = 0;
     nCuotaIMS = 0;
     nCuota_it = 0;
     nCuotaIT_it = 0;
     nCuotaIMS_it = 0;

     nDesdeA¤o = 0;
     nHastaA¤o = 0;
     aAny = "";
     &nAny = 0;
     aFecha = "";
     &nMes = 0;
     aImporte = "";
     &nImporte = 0;
     nBaseERE = 0;
|FIN;

|PROCESO PintaImporte;
     nImporte = #0#4;
     aImporte = nImporte;
     |QBF aImporte;
     aAlfa = aImporte % -301;
     |SI aAlfa ! ".";
          aAlfa = aImporte % -201;
          |SI aAlfa ! ".";
               aImporte = aImporte + ".00";
               aImporte = ("       " + aImporte) % -107;
          |FINSI;
     |FINSI;

     |ATRI S;
     |PINTA 2055, aImporte;
     |ATRI 0;
|FPRC;

|PROCESO Epigrafes;
     #nomepigr#0 = #labtraba#32;
     |LEE 000#nomepigr.=;
     nPorIT = #nomepigr#1;
     nPorIMS = #nomepigr#2;

     #nomepigr#0 = 126;
     |LEE 000#nomepigr.=;
     nPorIT_it = #nomepigr#1;
     nPorIMS_it = #nomepigr#2;
|FPRC;

|PROCESO CNAE_Ocup;
     aAlfa = #labtraba#204;
     |QBF aAlfa;
     |SI nAny ] 2013;
          |SI aAlfa = "e";
               aAlfa = "";
          |FINSI;
     |FINSI;
     |SI "01.01.2010" [ fFecha ; |Y fFecha [ "01.12.2012";
          fFecha = "01.01.2010";
     |FINSI;
     |SI fFecha ] "01.01.2013";
          fFecha = "01.01.2013";
     |FINSI;
     |SI aAlfa ! "";
          #nomocuma#6 = fFecha;
          #nomocuma#0 = aAlfa;
          |LEE 000#nomocuma.=;
          |SI FSalida = 0;
               nPorIT = #nomocuma#2;
               nPorIMS = #nomocuma#3;
          |FINSI;
     |SINO;
          aAlfa = #labcentr#22;
          |QBF aAlfa;
          |SI aAlfa ! "";          || CNAE por Centro
               |SI 2008 [ nAny; |Y nAny [ 2009;
                    #nomcnahi#2 = nAny;
                    #nomcnahi#0 = #nomhicca#0;
                    #nomcnahi#4 = #labtraba#77;
                    |LEE 000#nomcnahi.=;
                    |SI FSalida = 0;
                         aAlfa = #nomcnahi#3;
                    |FINSI;
               |FINSI;
          |SINO;
               aAlfa = #labempre#128;
               |SI 2008 [ nAny; |Y nAny [ 2009;
                    #nomcnahi#2 = nAny;
                    #nomcnahi#0 = #nomhicca#0;
                    #nomcnahi#4 = 00;
                    |LEE 000#nomcnahi.=;
                    |SI FSalida = 0;
                         aAlfa = #nomcnahi#3;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI aAlfa ! "";
               #nomcnama#6 = fFecha;
               #nomcnama#0 = aAlfa;
               |LEE 000#nomcnama.=;
               |SI FSalida = 0;
                    nPorIT = #nomcnama#2;
                    nPorIMS = #nomcnama#3;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI 2007 [ nAny; |Y aAny [ 2009;
          #nomocuma#6 = fFecha;
          #nomocuma#0 = "c";
          |LEE 000#nomocuma.=;
          |SI FSalida = 0;
               nPorIT_it = #nomocuma#2;
               nPorIMS_it = #nomocuma#3;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nomhicca;
     #labempre#0 = #nomhicca#0;
     |LEE 000#labempre.=;

     #labtraba#0 = #nomhicca#0;
     #labtraba#1 = #nomhicca#1;
     |LEE 000#labtraba.=;

     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;

     || Bases

     nBaseERE = 0;
     nBaseIT = #nomhicca#62;
     nBaseMat = (#nomhicca#35 * #nomhicca#65);
     nBaseAlta = #nomhicca#40 - (nBaseIT - nBaseMat);
     |SI #nomhicca#119 ! 0;
          |SI #nomhicca#170 ! 0;
               nBaseERE = #nomhicca#170;
          |SINO;
               nBaseERE = #labtraba#242 * #nomhicca#119;
          |FINSI;
     |FINSI;

     || Porcentajes

     nAny = #nomhicca#66 + 2000;
     aFecha = nAny;
     aFecha = "01.01." + aFecha;
     fFecha = aFecha;

     nPorIT = 0;
     nPorIMS = 0;
     nPorIT_it = 0;
     nPorIMS_it = 0;

     aAlfa = "";
     |SI nAny ] 2007;
          |HAZ CNAE_Ocup;
     |SINO;
          |HAZ Epigrafes;
     |FINSI;

     || Cuotas

     nCuotaAlta = 0;
     nCuota_it = 0;

     |SI nAny [ 2009;
          nCuotaIT = nBaseAlta % nPorIT;
          nCuotaIMS = nBaseAlta % nPorIMS;
          nCuotaAlta = (nCuotaIT + nCuotaIMS) ! 2;
          nCuotaIT_it = (nBaseIT + nBaseERE) % nPorIT_it;
          nCuotaIMS_it = (nBaseIT + nBaseERE) % nPorIMS_it;
          nCuota_it = (nCuotaIT_it + nCuotaIMS_it) ! 2;
     |SINO;
          nCuotaIT = (nBaseAlta + nBaseIT + nBaseERE) % nPorIT;
          nCuotaIMS = (nBaseAlta + nBaseIT + nBaseERE) % nPorIMS;
          nCuotaAlta = (nCuotaIT + nCuotaIMS) ! 2;
     |FINSI;

     nCuota = nCuotaAlta + nCuota_it;
     nMes = #nomhicca#2;

     |PRINT;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     #0#0, 00001, nDesdeA¤o, 01,  0;
     #0#1, 99999, nHastaA¤o, 12, 99;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO Principal;
     |ABRE #nomhicca;
     |ABRE #labempre;
     |ABRE #labcentr;
     |ABRE #labtraba;
     |ABRE #nomcnahi;
     |ABRE #nomcnama;
     |ABRE #nomocuma;
     |ABRE #nomepigr;

     nDesdeA¤o = #0#2 - 2000;
     nHastaA¤o = #0#2 - 2000;
     |BUCLE nomhicca;

     |CIERRA #nomepigr;
     |CIERRA #nomocuma;
     |CIERRA #nomcnama;
     |CIERRA #nomcnahi;
     |CIERRA #labtraba;
     |CIERRA #labcentr;
     |CIERRA #labempre;
     |CIERRA #nomhicca;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ PintaImporte;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          Impresora = "CrystalReport";
          |IMPRE -1;
          |INFOR "nominf03";

          |HAZ Principal;

          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
|FPRO;
