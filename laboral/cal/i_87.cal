|INCLUYE i_fiche;
|INCLUYE i_varia;

|VARIABLES;
    minimo = 0;
    &minusva = "";
    plan_error = 0;
    los_87 = 0;
    los_97 = 0;
    no_ejecutes = 0;
    &siono = "";
|FIN;

|PROCESO dedicado; |TIPO 7;
    #0#50 = #0#52 % 15;
    minimo = #0#50;
|PINTA #0#50;
|FPRC;

|PROCESO minimo; |TIPO 0;
|SI #0#50 < minimo;
    |MENAV "    AVISO!!! Es inferior al 15% de las horas jornada ...";
|FINSI;
|FPRC;

|PROCESO lee_871;
|SI #2#45 = "85";|O #2#45 = "87";  || todos menos minusvalidos
    |SI #2#1 ! #0#2;
            los_87 = los_87 + 1;
    |FINSI;
|FINSI;
|SI #2#45 = "97";                  || solo los minusvalidos
    |SI #2#1 ! #0#2;
            los_97 = los_97 + 1;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE lee_87;
 #2#1;
 45, 77;
 #0#1,     1, "85", #0#3;
 #0#1, 99999, "97", #0#3;
 ;
 NULL, lee_871;
|FIN;

|PROCESO tope_plan; |TIPO 0;
|SI no_ejecutes = 0;
        los_87 = 0;
        los_97 = 0;
        plan_error = 0;
    |BUCLE lee_87;
    |SI #3#11 ]   0; |Y #3#11  [   5; |Y los_87 >  0;  plan_error = 1;  |FINSI;
    |SI #3#11 ]   6; |Y #3#11  [  10; |Y los_87 ]  2;  plan_error = 1;  |FINSI;
    |SI #3#11 ]  11; |Y #3#11  [  25; |Y los_87 ]  3;  plan_error = 1;  |FINSI;
    |SI #3#11 ]  26; |Y #3#11  [  40; |Y los_87 ]  4;  plan_error = 1;  |FINSI;
    |SI #3#11 ]  41; |Y #3#11  [  50; |Y los_87 ]  5;  plan_error = 1;  |FINSI;
    |SI #3#11 ]  51; |Y #3#11  [ 100; |Y los_87 ]  8;  plan_error = 1;  |FINSI;
    |SI #3#11 ] 101; |Y #3#11  [ 250; |Y los_87 ] 10;  plan_error = 1;  |FINSI;
    |SI #3#11 ] 251; |Y #3#11  [ 500; |Y los_87 ] 20;  plan_error = 1;  |FINSI;
    |SI #3#11 ] 501;                  |Y los_87 ] 30;  plan_error = 1;  |FINSI;
    |SI plan_error ! 0;
        |ATRI P;
        |MENAV "    AVISO!!! Plantilla de aprendices supera a la maxima establecida ...";
        |ATRI 0;
    |SINO;
        |DDEFECTO #2;
        |ABRE #2;
            #2#0 = #0#1;
            #2#1 = #0#2;
        |LEE 000#2=;
        |CIERRA #2;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO siono4; |TIPO 0;
    si4 = "";
|SI #0#53 = "S";  si4 = "si";  |FINSI;
|SI #0#53 = "N";  si4 = "no";  |FINSI;
|FPRC;

|PROCESO aprendi; |TIPO 7;
    #0#55 = los_87 + 1;
    #0#56 = los_97;
|PINTA #0#55;
|PINTA #0#56;
|FPRC;

|PROCESO sepasa; |TIPO 0;
    plan_error = 0;
|SI #3#11 ]   0; |Y #3#11  [   5; |Y #0#55 >  1;  plan_error = 1;  |FINSI;
|SI #3#11 ]   6; |Y #3#11  [  10; |Y #0#55 >  2;  plan_error = 1;  |FINSI;
|SI #3#11 ]  11; |Y #3#11  [  25; |Y #0#55 >  3;  plan_error = 1;  |FINSI;
|SI #3#11 ]  26; |Y #3#11  [  40; |Y #0#55 >  4;  plan_error = 1;  |FINSI;
|SI #3#11 ]  41; |Y #3#11  [  50; |Y #0#55 >  5;  plan_error = 1;  |FINSI;
|SI #3#11 ]  51; |Y #3#11  [ 100; |Y #0#55 >  8;  plan_error = 1;  |FINSI;
|SI #3#11 ] 101; |Y #3#11  [ 250; |Y #0#55 > 10;  plan_error = 1;  |FINSI;
|SI #3#11 ] 251; |Y #3#11  [ 500; |Y #0#55 > 20;  plan_error = 1;  |FINSI;
|SI #3#11 ] 501;                  |Y #0#55 > 30;  plan_error = 1;  |FINSI;
|SI plan_error ! 0;
    |MENAV "    AVISO!!! Plantilla de aprendices supera a la maxima establecida ...";
|FINSI;
|FPRC;

|PROCESO encarga; |TIPO 0;
|SI #0#60 ! 0;
    |SI #0#60 ! #0#2;
            #0#27 = "";
            #0#28 = "";
        |ABRE #2;
            #2#0 = #0#1;
            #2#1 = #0#60;
        |LEE 001#2=;
        |SI FSalida ! 0;
            |MENAV "    Trabajador inexistente ...";
            |ERROR;
        |SINO;
                #0#27 = #2#2;      || nombre
                #0#28 = #2#18;     || categoria
        |FINSI;
        |CIERRA #2;
        |PINTA #0#27;
        |PINTA #0#28;
    |SINO;
        |MENAV "    ATENCION!!! Es el mismo trabajador ...";
        |ERROR;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO edad_87; |TIPO 0;
    #0#3 = #2#77;
|PINTA #0#3;
|CAMPO_MODIFICA #0#54, 1, "N";
    no_ejecutes = 0;
|SI #2#11 ! vblanco; |Y #2#11 ! vpuntos;
        fechtra = #2#11;
    |HAZ edadanyo_ap;
    |SI edadxxx ! -1;
        |SI edadxxx ] 16;
            |SI edadxxx > 21;
                |MENAV "    El trabajador es mayor de 21 a¤os ...";
                ||ERROR;
                        ||no_ejecutes = 1;
            |FINSI;
        |SINO;
            |MENAV "    El trabajador es menor de 16 a¤os ...";
            |ERROR;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO edad_97; |TIPO 0;
    #0#3 = #2#77;
|PINTA #0#3;
|CAMPO_MODIFICA #0#54, 1, "S";
    no_ejecutes = 0;
|SI #2#11 ! vblanco; |Y #2#11 ! vpuntos;
        fechtra = #2#11;
    |HAZ edadanyo_ap;
    |SI edadxxx ! -1;
        |SI edadxxx < 16;
            |MENAV "    El trabajador es menor de 16 a¤os ...";
            |ERROR;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO edadanyo_ap;               || CALCULA LA EDAD SEGUN FECHA ACTUAL
|SI fechtra ! blanco; |Y fechtra ! puntos;
    sistema = ~;
    anynac1 = fechtra % -104;    || desglosa fecha nacimiento en a¤os
    anynac2 = anynac1;
    mesnac1 = fechtra %  402;    || meses
    mesnac2 = mesnac1;
    dianac1 = fechtra %  102;    || y dias
    dianac2 = dianac1;
    fechtra = sistema;
    anyact1 = fechtra % -104;    || desglosa fecha actual en a¤os
    anyact2 = anyact1;
    mesact1 = fechtra %  402;    || meses
    mesact2 = mesact1;
    diaact1 = fechtra %  102;    || y dias
    diaact2 = diaact1;
    edadxxx = anyact2 - anynac2; || halla los a¤os
    |SI mesnac2 > mesact2;
        edadxxx = edadxxx - 1;   || resta un a¤o si aun no ha llegado el mes
    |FINSI;
    |SI mesnac2 = mesact2; |Y dianac2 > diaact2; ||o si aun no ha llegado el dia
        edadxxx = edadxxx - 1;
    |FINSI;
|SINO;
    edadxxx = 0;
|FINSI;
|FPRC;

|PROCESO def_encar; |TIPO 7;
|DDEFECTO #87;
|ABRE #87;
    #87#0 = #0#1;
    #87#1 = #0#2;
|LEE 000#87=;
    #0#60 = #87#16; |PINTA #0#60;
    #0#27 = #87#17; |PINTA #0#27;
|CIERRA #87;
|FPRC;

|PROCESO acuerdo; |TIPO 0;
|SI FSalida = 0;|O FSalida = 3;
    |PUSHV 0501 2380;
    |PINPA #0#87;
    |DDEFECTO #87;
    |ABRE #87;
        #87#0 = #0#1;
        #87#1 = #0#2;
    |LEE 101#87=;
        FEstado = FSalida;

    |SI FEstado ! 0;
            #87#14 = #0#45;   || oficina empleo
            #87#15 = #1#9;    || provincia oficina
    |FINSI;

        #87#16 = #0#60;       || encargado aprendizaje
        #87#17 = #0#27;
    |CAMPO_MODIFICA #87#16, 1, "N";
    |CAMPO_MODIFICA #87#17, 1, "N";

    |PINDA #0#87;
    |ENDATOS #1#87;
    |SI FSalida = 0;
        |SI FEstado = 0;    |GRABA 020#87a;     |FINSI;
        |SI FEstado ! 0;    |GRABA 020#87n;     |FINSI;
    |FINSI;
    |LIBERA #87;
    |CIERRA #87;
    |POPV;
|FINSI;
|FPRC;

|PROCESO ciclos; |TIPO 0;
    siono = "SI";
|SI #0Campo = "N";
        siono = "NO";
|FINSI;
|FPRC;
