|FICHEROS;
     nomcal03 #0;
     nomcal04 #1;

     labtraba;
     labtrtra #50;
     nomcalca;
     nomhicca;
     nomvarca;
     nomfical;
     nomhortp;
     nomabsli;
     nomcontr;
|FIN;

|VARIABLES;
     aAlfa = "";
     aNombreMes = "";
     nNume = 0;
     nCampo = 0;
     nCampo1 = 0;
     nDesde = 0;
     nHasta = 0;
     nCampoD = 0;
     nCampoH = 0;
     nCampoP = 0;
     nTDMes = 0;
     nDia = 0;
     nMes = 0;
     nAny = 0;
     nPeso = 0;
     nPesoAnt = 0;
     nEmp = 0;
     nTra = 0;
     FEstado = 0;
     aAlfa0 = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     fFecha = @;
     fFecha1 = @;
     fFecha2 = @;
     aDiaSemana = "";
     aDiaQueBusco = "";
     nDiaQueBusco = 0;
     aDesde = "";
     aHasta = "";
     nNPeso = 0;
     fFechaAlta = @;
     fFechaBaja = @;
     nCal = 0;
     nModo = 0;

     swError = 0;
     swHorasLoc = 0;
     aHorasSalida = "";
     aMinutosSalida = "";
     aHoras = "";
     aLon = "";
     nLon = 0;
     nCar = 0;
     nPos = 0;
     nNume1 = 0;
     nNume2 = 0;
     aLonHoras = "";
     nLonHoras = 0;
     nSuma = 0;

     nCop_6 = 0;
     nCop_7 = 0;
     aCop_8 = "";
     aCop_9 = "";
     aCop_10 = "";
     aCop_11 = "";
     aCop_15 = "";
     aCop_16 = "";
     aCop_17 = "";
     aCop_18 = "";
     swFestivo = 0;
|FIN;

|PROCESO labtraba;
     |PARA nCampo = 0; |SI nCampo [ 253; |HACIENDO nCampo = nCampo + 1;
          #50nCampo = #labtraba#nCampo#;
     |SIGUE;
     |GRABA 020#50n;
     |LIBERA #50;
|FPRC;

|DEFBUCLE labtraba_todos;
     #labtraba#4;
     ;
     " ", #0#0, 00001;
     "z", #0#0, 99999;
     ;
     NULL, labtraba;
|FIN;

|DEFBUCLE labtraba;
     #labtraba#4;
     ;
     "P", #0#0, 00001;
     "X", #0#0, 99999;
     ;
     NULL, labtraba;
|FIN;

|PROCESO CargaTrabTP;
     |ABRE #nomcontr; |LEE 000#nomcontr.=; |CIERRA #nomcontr;
     aAlfa = Usuario; |QBF aAlfa;    aAlfa = "T" + aAlfa;
     |NOME_DAT #50 aAlfa;
     |DELINDEX #50;
     |ABRE #50;
     |SI #nomcontr#75 = "S";
          |BUCLE labtraba_todos;
     |SINO;
          |BUCLE labtraba;
     |FINSI;
     |CIERRA #50;
|FPRC;

|PROCESO ConsultaTra;
     |SI FSalida = 18;
          aAlfa = Usuario; |QBF aAlfa;    aAlfa = "T" + aAlfa;
          |NOME_DAT #50 aAlfa;
          |ABRE #50;
          |LEE 000#50p;
          |CONSULTA_CLAVE #1#50;
          |SI FSalida = 0;
               #0#1 = #50#1;
               |PINTA #0#1;

               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 000#labtraba.=;

               |ATRI I;
               |PINTA 0821, #labtraba#2;
               |ATRI I;

               |CIERRA #labtraba;
          |FINSI;
          |CIERRA #50;
     |FINSI;
|FPRC;

|PROCESO Defectos; |TIPO 7;
     fFecha = ~;
     aAlfa = fFecha;
     aAlfa = aAlfa % -104;
     #0#2 = aAlfa;
     |PINTA #0#2;

     fFecha = ~;
     aAlfa = fFecha;
     aAlfa = aAlfa % 402;
     #0#3 = aAlfa;
     |PINTA #0#3;
|FPRC;

|PROCESO HorasContrato;
     |ABRE #nomcontr; |LEE 000#nomcontr.=; |CIERRA #nomcontr;
     |SI #nomcontr#75 = "S";
          |ACABA;
     |FINSI;

     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |SI #labtraba#42 ! "X"; |Y #labtraba#42 ! "T"; |Y #labtraba#42 ! "P";
          aAlfa = "    El trabajador no tiene clave de cotización por ";
          aAlfa = aAlfa + "horas: X, T ó P";
          |MENAV aAlfa;
          |ERROR;
     |SINO;
          |SI #labtraba#42 = "X";

          |FINSI;
          |SI #labtraba#42 = "M";

          |FINSI;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO NombreMes; |TIPO 14;
     |SI #0#3 = 1;  aNombreMes = "Enero     "; |FINSI;
     |SI #0#3 = 2;  aNombreMes = "Febrero   "; |FINSI;
     |SI #0#3 = 3;  aNombreMes = "Marzo     "; |FINSI;
     |SI #0#3 = 4;  aNombreMes = "Abril     "; |FINSI;
     |SI #0#3 = 5;  aNombreMes = "Mayo      "; |FINSI;
     |SI #0#3 = 6;  aNombreMes = "Junio     "; |FINSI;
     |SI #0#3 = 7;  aNombreMes = "Julio     "; |FINSI;
     |SI #0#3 = 8;  aNombreMes = "Agosto    "; |FINSI;
     |SI #0#3 = 9;  aNombreMes = "Septiembre"; |FINSI;
     |SI #0#3 = 10; aNombreMes = "Octubre   "; |FINSI;
     |SI #0#3 = 11; aNombreMes = "Noviembre "; |FINSI;
     |SI #0#3 = 12; aNombreMes = "Diciembre "; |FINSI;
     |ATRI I;
     |PINTA 1018, aNombreMes;
     |ATRI I;
|FPRC;

|PROCESO LeeTrab;
     |ABRE #labtraba;
     #labtraba#0 = #1#0;
     #labtraba#1 = #1#1;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |DDEFECTO #nomvarca;
     |ABRE #nomvarca;
     #nomvarca#0 = #1#0;
     #nomvarca#1 = #1#1;
     #nomvarca#2 = #0#3;
     #nomvarca#3 = 0;
     |LEE 000#nomvarca.=;
     |CIERRA #nomvarca;
|FPRC;

|PROCESO nomabsli;
     |SI #nomabsli#2 [ fFecha; |Y fFecha [ #nomabsli#3; |Y #nomabsli#4 = "V";
          nPeso = 6;
     |FINSI;
|FPRC;

|DEFBUCLE nomabsli;
     #nomabsli#1;
     ;
     #labtraba#0, #labtraba#1, fFecha1;
     #labtraba#0, #labtraba#1, fFecha2;
     ;
     NULL, nomabsli;
|FIN;

|PROCESO ITS;
     |ABRE #nomcalca;
     |ABRE #nomhicca;
     |ABRE #nomvarca;

     || PRIMERO MIRO MENSUAL

     #nomcalca#0 = #labtraba#0;
     #nomcalca#1 = #labtraba#1;
     #nomcalca#2 = #1#3;
     #nomcalca#3 = 0;
     |LEE 000#nomcalca.=;
     |SI FSalida = 0;
          nNume = #nomcalca#31 + #nomcalca#32 + #nomcalca#33 + #nomcalca#34;
          nNume = nNume +  #nomcalca#65 + #nomcalca#66 + #nomcalca#78;

          |SI nNume ! 0;
               |PARA nCampo = 27; |SI nCampo [ 30; |HACIENDO nCampo = nCampo + 1;
                    nDesde = 0;
                    nHasta = 0;
                    nCampoD = nCampo - 8;
                    nCampoH = nCampo - 4;
                    |SI #nomcalca#nCampo# ! " ";
                         |SI #nomcalca#nCampoD# = 0;
                              nDesde = 1;
                         |SINO;
                              nDesde = #nomcalca#nCampoD#;
                         |FINSI;
                         |SI #nomcalca#nCampoH# = 0;
                              nHasta = nTDMes;
                         |SINO;
                              nHasta = #nomcalca#nCampoH#;
                         |FINSI;
                         |SI nDesde [ nDia; |Y nDia [ nHasta;
                              |SI #nomcalca#nCampo# = "D";
                                   nCampoP = nCampo + 92;
                                   |SI #nomcalca#nCampoP# ! 100;
                                        |SI nPeso = 0;
                                             nPeso = 5;
                                        |FINSI;
                                   |SINO;
                                        nPeso = 4;
                                   |FINSI;
                              |SINO;
                                   nPeso = 3;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SIGUE;
          |FINSI;
     |SINO;
/*
          || SI NO, MIRO VARIACIONES

          || DE MOMENTO NO, METERME EN ESTO ES UN LIO

          #nomvarca#0 = #labtraba#0;
          #nomvarca#1 = #labtraba#1;
          #nomvarca#2 = #1#3;
          #nomvarca#3 = 0;
          |LEE 000#nomvarca.=;
          |SI FSalida = 0;
               |PARA nCampo = 12; |SI nCampo [ 15; |HACIENDO nCampo = nCampo + 1;
                    nDesde = 0;
                    nHasta = 0;
                    nCampoD = nCampo - 8;
                    nCampoH = nCampo - 4;
                    |SI #nomvarca#nCampo# ! " ";
                         |SI #nomvarca#nCampoD# = 0;
                              nDesde = 1;
                         |SINO;
                              nDesde = #nomvarca#nCampoD#;
                         |FINSI;
                         |SI #nomvarca#nCampoH# = 0;
                              nHasta = nTDMes;
                         |SINO;
                              nHasta = #nomvarca#nCampoH#;
                         |FINSI;
                         |SI nDesde [ nDia; |Y nDia [ nHasta;
                              nPeso = 3;
                         |FINSI;
                    |SIGUE;
                    nNume = #labtraba#89 + #labtraba#92;
                    |SI nNume ! 0;
                         |SI #nomvarca#12 = " "; |Y #nomvarca#13 = " ";
                         |Y #nomvarca#14 = " "; |Y #nomvarca#15 = " ";
                              nPeso = 3;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
*/
     |FINSI;

     #nomhicca#0 = #labtraba#0;
     #nomhicca#1 = #labtraba#1;
     #nomhicca#66 = #1#2 - 2000;
     #nomhicca#2 = #1#3;
     #nomhicca#3 = 0;
     |LEE 000#nomhicca.=;
     |SI FSalida = 0;
          nNume = #nomhicca#31 + #nomhicca#32 + #nomhicca#33 + #nomhicca#34;
          nNume = nNume +  #nomhicca#65 + #nomhicca#105 + #nomhicca#119;

          |SI nNume ! 0;
               |PARA nCampo = 27; |SI nCampo [ 30; |HACIENDO nCampo = nCampo + 1;
                    nDesde = 0;
                    nHasta = 0;
                    nCampoD = nCampo - 8;
                    nCampoH = nCampo - 4;
                    |SI #nomhicca#nCampo# ! " ";
                         |SI #nomhicca#nCampoD# = 0;
                              nDesde = 1;
                         |SINO;
                              nDesde = #nomhicca#nCampoD#;
                         |FINSI;
                         |SI #nomhicca#nCampoH# = 0;
                              nHasta = nTDMes;
                         |SINO;
                              nHasta = #nomhicca#nCampoH#;
                         |FINSI;
                         |SI nDesde [ nDia; |Y nDia [ nHasta;
                              |SI #nomhicca#nCampo# = "D";
                                   nCampoP = nCampo + 134;
                                   |SI #nomhicca#nCampoP# ! 100;
                                        |SI nPeso = 0;
                                             nPeso = 5;
                                        |FINSI;
                                   |SINO;
                                        nPeso = 4;
                                   |FINSI;
                              |SINO;
                                   nPeso = 3;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SIGUE;
          |FINSI;
     |FINSI;

     aAlfa1 = "01"; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa2 = #0#3; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
     aAlfa3 = nAny;
     aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
     fFecha1 = aAlfa;

     aAlfa1 = nTDMes; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
     fFecha2 = aAlfa;

     |BUCLE nomabsli;

     |CIERRA #nomvarca;
     |CIERRA #nomhicca;
     |CIERRA #nomcalca;
|FPRC;

|PROCESO DiasMes;
     nTDMes = 31;
     |SI nMes = 4; |O nMes = 6; |O nMes = 9; |O nMes = 11;
          nTDMes = 30;
     |SINO;
          |SI nMes = 2;
               nTDMes = 28;
               |SI nAny = 1992; |O nAny = 1996; |O nAny = 2000;
               |O nAny = 2004; |O nAny = 2008; |O nAny = 2012;
               |O nAny = 2016; |O nAny = 2020; |O nAny = 2024;
                    nTDMes = 29;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaHorario;
     |ABRE #nomhortp;
     |DDEFECTO #nomhortp;
     #nomhortp#0 = #nomcal04#0;
     #nomhortp#1 = #nomcal04#1;
     |LEE 000#nomhortp.=;
     |SI FSalida = 0;
          aAlfa = #nomcal04#5;
          aAlfa = aAlfa % 102;

          |SI aAlfa = "Lu";    nCampo = 2;    nSuma = 0; |FINSI;
          |SI aAlfa = "Ma";    nCampo = 7;    nSuma = 1; |FINSI;
          |SI aAlfa = "Mi";    nCampo = 12;   nSuma = 2; |FINSI;
          |SI aAlfa = "Ju";    nCampo = 17;   nSuma = 3; |FINSI;
          |SI aAlfa = "Vi";    nCampo = 22;   nSuma = 4; |FINSI;
          |SI aAlfa = "S ";    nCampo = 27;   nSuma = 5; |FINSI;
          |SI aAlfa = "Do";    nCampo = 32;   nSuma = 6; |FINSI;

          |SI #nomhortp#nCampo# ! 0;
               |SI nPeso = 0;
                    #nomcal04#6 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#8 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#9 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#10 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#11 = #nomhortp#nCampo#;

                    nCampo = nCampo + 33 - nSuma;
                    #nomcal04#15 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#16 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#17 = #nomhortp#nCampo#;
                    nCampo = nCampo + 1;
                    #nomcal04#18 = #nomhortp#nCampo#;
               |FINSI;
          |SINO;
               || esto es para contemplar el caso de un dia que tuviera
               || que trabajar por no ser festivo, no tuviera horas con lo
               || que no tendria que trabajar en verdad y estuviera de IT
               || este dia no se tiene que contar para el AFI de dias trabajados
               |SI nPeso = 3;
                    |SI swFestivo = 0;
                         #nomcal04#13 = "IT (SinH)"
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #nomhortp;
|FPRC;

|PROCESO CreaMes;
     #0#0 = nEmp;         || Empresa
     #0#1 = nTra;         || Trabajador
     #0#2 = nAny;         || A¤o
     #0#3 = nMes;         || Mes
     |LEE 000#0=;

     |ABRE #1;

     |HAZ DiasMes;

     |PARA nDia = 1; |SI nDia [ nTDMes; |HACIENDO nDia = nDia + 1;

          |DDEFECTO #1;
          #1#0 = nEmp;         || Empresa
          #1#1 = nTra;         || Trabajador
          #1#2 = nAny;         || A¤o
          #1#3 = nMes;         || Mes
          #1#4 = nDia;         || Dia
          |LEE 000#1=;
          FEstado = FSalida;

          || 0: laborable
          || 1: festivo

          nPeso = 0;

          || busco que dia de la semana es el dia en que estoy
          aAlfa0 = nDia; |QBF aAlfa0;
          aAlfa0 = ("00" + aAlfa0) % -102;
          aAlfa1 = nMes; |QBF aAlfa1;
          aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = nAny;
          aAlfa3 = aAlfa0 + "."  + aAlfa1 + "." + aAlfa2;
          fFecha = aAlfa3;
          fFecha1 = fFecha % 1;
          aAlfa3 = fFecha1 % 1102;

          |SI aAlfa3 = "Lu"; aDiaSemana = "Lunes    "; |FINSI;
          |SI aAlfa3 = "Ma"; aDiaSemana = "Martes   "; |FINSI;
          |SI aAlfa3 = "Mi"; aDiaSemana = "Mircoles"; |FINSI;
          |SI aAlfa3 = "Ju"; aDiaSemana = "Jueves   "; |FINSI;
          |SI aAlfa3 = "Vi"; aDiaSemana = "Viernes  "; |FINSI;
          |SI aAlfa3 = "Sa"; aDiaSemana = "S bado   "; |FINSI;
          |SI aAlfa3 = "Do"; aDiaSemana = "Domingo  "; |FINSI;

          || Ahora asigno pesos segun si el dia es laborable, festivo, alta, baja o IT
          swFestivo = 0;
          nPeso = 0;     || por defecto laborale

          || Primero miro el calendario semanal

          |SI aAlfa3 = "Lu"; nPeso = #nomfical#2; |FINSI;
          |SI aAlfa3 = "Ma"; nPeso = #nomfical#3; |FINSI;
          |SI aAlfa3 = "Mi"; nPeso = #nomfical#4; |FINSI;
          |SI aAlfa3 = "Ju"; nPeso = #nomfical#5; |FINSI;
          |SI aAlfa3 = "Vi"; nPeso = #nomfical#6; |FINSI;
          |SI aAlfa3 = "Sa"; nPeso = #nomfical#7; |FINSI;
          |SI aAlfa3 = "Do"; nPeso = #nomfical#8; |FINSI;

          || despues el diario

          |PARA nCampo = 11; |SI nCampo [ 98; |HACIENDO nCampo = nCampo + 3;
               |SI #nomfical#nCampo# = 1;
                    nCampoD = nCampo - 2;
                    nCampoH = nCampo - 1;
                    aDesde = (#nomfical#nCampoD# % 302) + (#nomfical#nCampoD# % 102);
                    aHasta = (#nomfical#nCampoH# % 302) + (#nomfical#nCampoH# % 102);
                    nDesde = aDesde;

                    nHasta = aHasta;
                    aAlfa1 = nMes; |QBF aAlfa1;
                    aAlfa1 = ("00" + aAlfa1) % -102;
                    aAlfa2 = nDia; |QBF aAlfa2;
                    aAlfa2 = ("00" + aAlfa2) % -102;
                    aDiaQueBusco = aAlfa1 + aAlfa2; || (mes+dia)
                    nDiaQueBusco = aDiaQueBusco;
                    |SI nDesde [ nDiaQueBusco; |Y nDiaQueBusco [ nHasta;
                         nPeso = #nomfical#nCampo#;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |PARA nCampo = 100; |SI nCampo [ 158; |HACIENDO nCampo = nCampo + 2;
               |SI #nomfical#nCampo# = 1;
                    nCampoD = nCampo - 1;
                    nCampoH = nCampo - 1;
                    aDesde = (#nomfical#nCampoD# % 302) + (#nomfical#nCampoD# % 102);
                    aHasta = (#nomfical#nCampoH# % 302) + (#nomfical#nCampoH# % 102);
                    nDesde = aDesde;

                    nHasta = aHasta;
                    aAlfa1 = nMes; |QBF aAlfa1;
                    aAlfa1 = ("00" + aAlfa1) % -102;
                    aAlfa2 = nDia; |QBF aAlfa2;
                    aAlfa2 = ("00" + aAlfa2) % -102;
                    aDiaQueBusco = aAlfa1 + aAlfa2; || (mes+dia)
                    nDiaQueBusco = aDiaQueBusco;
                    |SI nDesde [ nDiaQueBusco; |Y nDiaQueBusco [ nHasta;
                         nPeso = #nomfical#nCampo#;
                    |FINSI;
               |FINSI;
          |SIGUE;

          |SI FEstado = 0; |Y #nomcal04#14 = 1;
               |SI nPeso = 1;
                    nPeso = 0;
               |FINSI;
          |FINSI;

          |SI nPeso = 1;
               swFestivo = 1;
          |FINSI;

          nNPeso = nDia + 50;

          || PESOS
          || 0: laborable
          || 1: festivo
          || 2: no esta en alta
          || 3: esta en IT

          || comprobacion de fechas de alta y baja

          |HAZ LeeTrab;
          fFechaAlta = #labtraba#36;
          |QBF aAlfa;
          |SI #nomvarca#16 ! "          "; |Y #nomvarca#16 ! "..........";
               aAlfa = #nomvarca#16;
          |SINO;
               aAlfa = #labtraba#37;
          |FINSI;
          |QBF aAlfa;
          |SI aAlfa = ""; |O aAlfa = "..........";
               fFechaBaja = "31.12.2999";
          |SINO;
               fFechaBaja = aAlfa;
          |FINSI;

          aAlfa1 = nDia; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = #1#3; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
          aAlfa3 = nAny;
          aAlfa = aAlfa1 + "." + aAlfa2 + "." + aAlfa3;
          fFecha = aAlfa;
          |SI fFechaAlta [ fFecha; |Y fFecha [ fFechaBaja;
               || correcto, el trabajador esta de alta
          |SINO;
               nPeso = 2;     || TRABAJADOR EN BAJA
          |FINSI;

          || comprobacion de periodos en IT

          |SI nPeso ! 2;
               |HAZ ITS;
          |FINSI;

          #1#5 = aDiaSemana;

          || contemplamos posibles cambios en el calendario que ya existia

          |SI FEstado = 0;
               |SI nPeso ! 0;
                    |SI #1#6 ! 0;
                         #0#5 = #0#5 - #1#6;
                         #0#7 = #0#7 - #1#6;
                         #1#6 = 0;
                         |GRABA 020#nomcal03.a;
                         |PINTA #0#5;
                         |PINTA #0#7;
                    |FINSI;
                    |SI #1#7 ! 0;
                         #0#6 = #0#6 - #1#7;
                         #0#7 = #0#7 - #1#7;
                         #1#7 = 0;
                         |GRABA 020#nomcal03.a;
                         |PINTA #0#6;
                         |PINTA #0#7;
                    |FINSI;
                    #1#8 = "";
                    #1#9 = "";
                    #1#10 = "";
                    #1#11 = "";
                    #1#15 = "";
                    #1#16 = "";
                    #1#17 = "";
                    #1#18 = "";
                    |PINTA #1#8;
                    |PINTA #1#9;
                    |PINTA #1#10;
                    |PINTA #1#11;
                    |PINTA #1#15;
                    |PINTA #1#16;
                    |PINTA #1#17;
                    |PINTA #1#18;
               |FINSI;
          |FINSI;

          |SI nPeso = 1; #1#13 = "Festivo"; |FINSI;
          |SI nPeso = 2; #1#13 = "Sin alta"; |FINSI;
          |SI nPeso = 3; #1#13 = "IT     "; |FINSI;
          |SI nPeso = 4; #1#13 = "ERE    "; |FINSI;
          |SI nPeso = 5; #1#13 = "ERE TP "; |FINSI;
          |SI nPeso = 6; #1#13 = "Vacac. "; |FINSI;

          |SI nPeso = 5;
               nPeso = 0;
          |FINSI;

          |SI nPeso = 3;
               |SI swFestivo = 1;
                    #nomcal04#13 = "IT (Fes)";
               |FINSI;
          |FINSI;

          |SI nPeso = 0;
               #1#12 = 0;
          |SINO;
               #1#12 = 1;
          |FINSI;

          |SI FEstado ! 0;
               |SI nPeso = 0; |O nPeso = 3;
                    |HAZ CargaHorario;
                    |SI #1#6 ! 0;
                         #0#5 = #0#5 + #1#6;
                         #0#7 = #0#7 + #1#6;
                         |PINTA #0#5;
                         |PINTA #0#7;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI FEstado = 0;
               |GRABA 020#1a;
          |SINO;
               |GRABA 020#1n;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Calendario;
     nEmp = #0#0;
     nTra = #0#1;
     nAny = #0#2;
     nMes = #0#3;

     nCal = #labtraba#156;

     |ABRE #nomfical;
     #nomfical#0 = nCal;
     #nomfical#1 = nAny;
     |LEE 000#nomfical.=;
     |CIERRA #nomfical;

     |HAZ CreaMes;
|FPRC;

|PROCESO Mes;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O nModo = 2;
          |HAZ Calendario;
     |FINSI;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     #nomcal04#12 = 1;
     |LINEAS_BI_ATRI #nomcal04#12, 0, I, -1;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     #0#5 = #0#5 +. #1#6;
     #0#6 = #0#6 +. #1#7;
     #0#7 = #0#7 +. #1#6 +. #1#7;
     |PINTA #0#5;
     |PINTA #0#6;
     |PINTA #0#7;
|FPRC;

|PROCESO FormatoHoras;
     swError = 0;
     swHorasLoc = 0;
     aHorasSalida = "";
     aMinutosSalida = "";
     aLonHoras = "";
     nLonHoras = 0;

     aHoras = #1Campo;
     |QBT aHoras;
     |SI aHoras = "";
          |ACABA;
     |FINSI;
     aLon = aHoras % 0;
     nLon = aLon;
     |SI nLon ! 5;
          |PARA nCar = 1; |SI nCar [ nLon; |HACIENDO nCar = nCar + 1;
               nPos = (nCar * 100) + 1;
               aAlfa = aHoras % nPos;
               |SI swHorasLoc = 0;
                    |SI aAlfa = "."; |O aAlfa = ":"; |O aAlfa = ",";
                         swHorasLoc = 1;
                    |SINO;
                         aLonHoras = aHorasSalida % 0;
                         nLonHoras = aLonHoras;
                         |SI nLonHoras ! 2;
                              aHorasSalida = aHorasSalida + aAlfa;
                         |SINO;
                              aMinutosSalida = aMinutosSalida + aAlfa;
                         |FINSI;
                    |FINSI;
               |SINO;
                    aMinutosSalida = aMinutosSalida + aAlfa;
               |FINSI;
          |SIGUE;
          aHorasSalida = ("00" + aHorasSalida) % -102;
          aMinutosSalida = ("00" + aMinutosSalida) % -102;
          aAlfa1 = aHorasSalida;
          aAlfa2 = aMinutosSalida;
     |SINO;
          aAlfa1 = aHoras % 102;
          aAlfa2 = aHoras % -102;
          aHorasSalida = aAlfa1;
          aMinutosSalida = aAlfa2;
     |FINSI;

     nNume1 = aAlfa1;
     nNume2 = aAlfa2;
     |SI nNume1 < 0; |O nNume1 > 23;
          swError = 1;
     |FINSI;
     |SI nNume2 < 0; |O nNume2 > 59;
          swError = 2;
     |FINSI;
     |SI swError = 1;
          |MENAV "    ATENCION. Error de introducción de datos. Revise el número de horas";
          |ERROR;
          |ACABA;
     |FINSI;
     |SI swError = 2;
          |MENAV "    ATENCION. Error de introducción de datos. Revise el número de minutos";
          |ERROR;
          |ACABA;
     |FINSI;

     aAlfa = aHorasSalida + ":" + aMinutosSalida;
     #1Campo = aAlfa;
     |PINTA #1Campo;
|FPRC;

|PROCESO Desbloquea; |TIPO 11;
     |SI FSalida = 13; |Y #nomcal04#12 ! 0;
          #nomcal04#12 = 0;
          #nomcal04#13 = "";
          #nomcal04#14 = 1;
          |GRABA 020#nomcal04.a;
          |PTEC 806;
     |FINSI;
     |SI FSalida = 14; |O FSalida = 15; |O FSalida = 16;
          |SI #nomcal04#12 ! 0;
               |PTEC 806;
          |SINO;
               |SI FSalida = 14;
                    nCop_6 = #nomcal04#6;
                    nCop_7 = #nomcal04#7;
                    aCop_8 = #nomcal04#8;
                    aCop_9 = #nomcal04#9;
                    aCop_10 = #nomcal04#10;
                    aCop_11 = #nomcal04#11;
                    aCop_15 = #nomcal04#15;
                    aCop_16 = #nomcal04#16;
                    aCop_17 = #nomcal04#17;
                    aCop_18 = #nomcal04#18;
                    |ATRI R;
                    |PINTA 1202, " COPIA:";
                    |PINTA 1209, #nomcal04#6;
                    |PINTA 1215, #nomcal04#7;
                    |PINTA 1222, #nomcal04#8;
                    |PINTA 1228, #nomcal04#9;
                    |PINTA 1234, #nomcal04#10;
                    |PINTA 1240, #nomcal04#11;
                    |PINTA 1246, #nomcal04#15;
                    |PINTA 1252, #nomcal04#16;
                    |PINTA 1258, #nomcal04#17;
                    |PINTA 1264, #nomcal04#18;
                    |ATRI 0;
               |FINSI;
               |SI FSalida = 15;
                    #0#5 = #0#5 - #1#6;
                    #0#6 = #0#6 - #1#7;
                    #0#7 = #0#7 - #1#6 - #1#7;

                    #nomcal04#6 = nCop_6; |PINTA #nomcal04#6;
                    #nomcal04#7 = nCop_7; |PINTA #nomcal04#7;
                    #nomcal04#8 = aCop_8; |PINTA #nomcal04#8;
                    #nomcal04#9 = aCop_9; |PINTA #nomcal04#9;
                    #nomcal04#10 = aCop_10; |PINTA #nomcal04#10;
                    #nomcal04#11 = aCop_11; |PINTA #nomcal04#11;
                    #nomcal04#15 = aCop_15; |PINTA #nomcal04#15;
                    #nomcal04#16 = aCop_16; |PINTA #nomcal04#16;
                    #nomcal04#17 = aCop_17; |PINTA #nomcal04#17;
                    #nomcal04#18 = aCop_18; |PINTA #nomcal04#18;
                    |GRABA 020#nomcal04.a;
                    |LIBERA #nomcal04;

                    #0#5 = #0#5 + #1#6;
                    #0#6 = #0#6 + #1#7;
                    #0#7 = #0#7 + #1#6 + #1#7;
                    |PINTA #0#5;
                    |PINTA #0#6;
                    |PINTA #0#7;
               |FINSI;
               |SI FSalida = 16;
                    nCop_6 = 0;
                    nCop_7 = 0;
                    aCop_8 = "";
                    aCop_9 = "";
                    aCop_10 = "";
                    aCop_11 = "";
                    aCop_15 = "";
                    aCop_16 = "";
                    aCop_17 = "";
                    aCop_18 = "";
                    |PINTA 1201, "ÚÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂ";
               |FINSI;
               |PTEC 806;
          |FINSI;
     |FINSI;
     |SI FSalida = 1;
          nCop_6 = 0;
          nCop_7 = 0;
          aCop_8 = "";
          aCop_9 = "";
          aCop_10 = "";
          aCop_11 = "";
          aCop_15 = "";
          aCop_16 = "";
          aCop_17 = "";
          aCop_18 = "";
          |PINTA 1201, "ÚÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂ";
     |FINSI;
|FPRC;
