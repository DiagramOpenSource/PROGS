|FICHEROS;
     cretap24 #0;

     cretam02;
     cretam05;
     cretae02;
|FIN;

|VARIABLES;
     &eaFichero = "";
     &aSoloFichero = "";

     nNume = 0;
     aLon = "";
     nLon = 0;
     nEspacio = 0;
     aEspacio = "";
     nBlancos = 0;
     nBlancosIzd = 0;
     nBlancosDer = 0;
     aBlancosIzd = "";
     aBlancosDer = "";

     aCadena = "";
     aCadenaSal = "";

     FLinea = 0;
     nNroLinea = 0;
     aNroLinea = "";
     aAlfa = "";

     nHandle = 0;
     aLinea = "";
     &aTotalLineas = "";

     aCCC = "";
     nAnyDesde = 0;
     nMesDesde = 0;
     aAnyDesde = "";
     aMesDesde = "";
     nTipo = 0;
     aDia = "";
     aMes = "";
     aAny = "";
     aEtiqueta = "";
     nLoc = 0;
     aValor = "";
     nValor = "";
     aCampoFecha = "";
     aDiaRec = "";
     aMesRec = "";
     aAnyRec = "";
     aHoraRec = "";
     aEtiquetaIni = "";
     aEtiquetaFin = "";
     aMesHasta = "";
     aAnyHasta = "";
     aTipo = "";

     nEmp = 0;
     nTra = 0;
     swEncontrada = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     &enMes = 0;
     &enAny = 0;
     &enSwAlta = 0;

     aNaf = "";
     aEstado = "";
     fFechaRec = @;

     aTipoIPF = "";
     aNumeroIPF = "";
     aSiglas = "";

     aDiaDesdeTramo = "";
     aMesDesdeTramo = "";
     aAnyDesdeTramo = "";
     aFechaDesdeTramo = "";
     aDiaHastaTramo = "";
     aMesHastaTramo = "";
     aAnyHastaTramo = "";
     aFechaHastaTramo = "";

     aDias = "";
     aHoras = "";
     aDescripcion = "";
     nConcepto = 0;
     nImporte = 0;
     aCentro = "";

     nCampo = 0;
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     aTipoSuma = "";
     nBase = 0;
     aTipoRLC = "";
     fFecha = @;
     aHora = "";
     &eaCadena = "";
     &eaCadenaSal = "";
     &swMsDos = 0;
     &swBasico = 0;

     aReferencia = "";
     aBlanco = "";
     aFichEnviado = "";
     aEspacios = "";
|FIN;

|PROCESO Centra;
     aLon = aCadena % 0;
     nLon = aLon;
     nBlancos = nEspacio - nLon;
     nNume = nBlancos / 2;
     nBlancosIzd = nNume ! 0;
     nBlancosDer = nBlancos - nBlancosIzd;
     aBlancosIzd = " " * nBlancosIzd;
     aBlancosDer = " " * nBlancosDer;
     aCadenaSal = aBlancosIzd + aCadena + aBlancosDer;
|FPRC;

|PROCESO LeeLinea;
     |XLEE nHandle, 300, aLinea;
     FLinea = FSalida;
     nNroLinea = nNroLinea + 1;
     aNroLinea = nNroLinea;
     aAlfa = " Linea " + aNroLinea + " de " + aTotalLineas;

     |ATRI R;
     aCadena = aAlfa; nEspacio = 35; |HAZ Centra;
     |PINTA 2223, aCadenaSal;
     |ATRI 0;
|FPRC;

|PROCESO cretae02;
     #cretae02#8 = "V";
     |GRABA 020#cretae02.a;
     |LIBERA #cretae02;

     |SI #cretae02#7 = "B"; |O #cretae02#7 = "T";
          #cretam02#0 = #cretae02#0;
          #cretam02#1 = #cretae02#1;
          #cretam02#2 = #cretae02#2;
          #cretam02#3 = #cretae02#3;
          #cretam02#4 = #cretae02#4;
          |LEE 101#cretam02.=;
          |SI FSalida = 0;
               |SI #cretae02#7 = "B";
                    #cretam02#7 = "V";
                    #cretam02#8 = aReferencia;
               |FINSI;

               |SI #cretae02#7 = "T";
                    #cretam02#9 = "V";
                    #cretam02#10 = aReferencia;
               |FINSI;

               |GRABA 020#cretam02.a;
               |LIBERA #cretam02;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE cretae02;
     #cretae02#1;
     ;
     00001, 2014, 01, 00, "               ", aReferencia;
     99999, 2099, 12, 20, "zzzzzzzzzzzzzzz", aReferencia;
     be;
     NULL, cretae02;
|FIN;

|PROCESO GrabaRegistro;
     |ABRE #cretam05;
     |SELECT #3#cretam05;

     nNume = 100;
     aBlanco = " ";
     aReferencia = "";

     aEspacios = aBlanco * nNume;
     aFichEnviado = ((aFichEnviado + aEspacios) % 199) + " ";
     #cretam05#7 = aFichEnviado;
     |LEE 101#cretam05.=;
     |SI FSalida = 0;
          aReferencia = #cretam05#4;

          #cretam05#11 = "V";
          #cretam05#12 = "Enviado";

          |GRABA 020#cretam05.a;
          |LIBERA #cretam05;
     |FINSI;

     |SI aReferencia ! "";
          |BUCLE cretae02;
     |FINSI;
|FPRC;

|PROCESO BuscaEtiqueta;
     aValor = "";
     nLoc = 0;

     aAlfa = aLinea - aEtiqueta;
     |SI aAlfa ! aLinea;
          aValor = aAlfa;
          nLoc = 1;
     |FINSI;
|FPRC;

|PROCESO Lectura;
     FLinea = 0;

     aAlfa = eaFichero;
     |XABRE "", aAlfa, nHandle; nHandle = FSalida;
     |SI FSalida ] 0;
          |PARA;
          |SI FLinea ] 0;
          |HACIENDO;
               FLinea = 0;
               |HAZ LeeLinea;

               aEtiqueta = "Fichero enviado       :";
               |HAZ BuscaEtiqueta;
               |SI nLoc = 1;
                    aFichEnviado = aValor;
                    aFichEnviado = aValor - ".tmp" + ".xml";
               |FINSI;

               aEtiqueta = "Resultado Transmision :";
               |HAZ BuscaEtiqueta;
               |SI nLoc = 1;
                    |SI aValor = "La transmision se ha realizado correctamente";
                         |HAZ GrabaRegistro;
                         |SAL;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;

     |XCIERRA nHandle;
|FPRC;

|PROGRAMA;
     |ABRE #cretam02;
     |ABRE #cretam05;
     |ABRE #cretae02;

     |HAZ Lectura;

     |CIERRA #cretae02;
     |CIERRA #cretam05;
     |CIERRA #cretam02;
|FPRO;
