|FICHEROS;
     labempre #01;   || empresas
     nomconst #03;   || constantes
     labtraba #05;   || trabajadores
     nomtrtc2 #07;   || tmp. impresion
     nombonif #08;   || bonificaciones
     nomepigr #09;   || epigrafes
     labcentr #10;   || centros trabajo
     nomequiv;       || tabla equivalencias contratos
     gomexplo #11;   || explotaciones
     labprovi #12;   || provincias
     nomepitr #18;   || epigrafes por trabajador
     nomcontr #50;   || control aplicacion
     nomtc203 #101;  || TMP TC2 cabs.
     nomtc204 #102;  || TMP TC2 lins.
     nomtraca;       || ctes. por trabajador
     gomcotiz;       || tabla de cotizaciones de jornadas por grupo de tarifa
     nombotra;
     nomboni3;
     nombofli;
|FIN;

|VARIABLES;
     sgdonum = 0;
     haentrat = 0;
     antcentr = 0;
     antbonif = 0;
     t_fijos = 0;
     t_aux1 = 0;
     t_event = 0;
     t_aux2 = 0;
     t_aux3 = 0;
     t_base4 = 0;
     t_aux4 = 0;
     t_por4 = 0;
     pp14 = 0;
     pp36 = 0;
     pp37 = 0;
     menos = 0;
     numalta1 = 0;
     numalta2 = 0;
     numbaja1 = 0;
     numbaja2 = 0;
     dianume1 = 0;
     dianume2 = 0;
     sanos = 0;
     tc21 = 0;
     puntero = 0;
     punt = 0;
     ya = 0;
     FEstado = 0;
     por_ilt = 0;
     por_ims = 0;
     informe = "gomyytc2";
     postal1 = "";   || Codigo postal1 alfa
     postal2 = "";   || Codigo postal2 alfa
     domi    = "";   || Variable para quitar espacios al domicilio
     afili   = "";   || Variable para quitar espacios al nro. de afiliacion
     sgdoalf = "";   || Variable para quitar espacios al nro. de afiliacion
     fecsys = @;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nNume1 = 0;
     nNume2 = 0;
     nPara1 = 0;
     nPara2 = 0;
     p_mes = "";
     pp15 = "";
     pp16 = "";  || de trabajo
     pp17 = "";
     pp18 = "";

     aContrato = "";
     nContrato = 0;

     aNombre = "";
     aApell1 = "";
     aApell2 = "";

     bot1 = "  ";
     top1 = "zz";
     bot2 = "         ";
     top2 = "zzzzzzzzz";
     bot3 = "           ";
     top3 = "zzzzzzzzzzz";

     diaalfa1 = "";
     diaalfa2 = "";
     alfalta1 = "";   || variables de trabajo para calcular mes alta/baja
     alfbaja1 = "";
     alfalta2 = "";
     alfbaja2 = "";

     &swbonif = 0;   || variables de condiciones para la impresion
     &swenfer = 0;
     &swepigr = 0;
     &swdetal = 0;
     &swclave = 0;

     &t_epigr = 0;   || codigo epigrafe total
     &t_epig0 = 0;   || acumula total epigrafe accidente (informe)
     t_epig1 = 0;   || acumula total epigrafe accidente
     t_epig2 = 0;   || nro. de trabajadores por epigrafe
     &t_epig3 = "";  || literal en total epigrafe
     t_epig4 = 0;   || contador de epigrafes diferentes por empresa
     t_epig5 = 0;   || acumula bases epigrafe global
     t_epig6 = 0;   || acumula importe ILT epigrafe global
     t_epig7 = 0;   || acumula importe IMS epigrafe global
     t_epig8 = 0;   || acumula nro. trabajadores epigrafe global
     t_epig9 = 0;   || base desempleo fijos (AGRARIA*)
     t_epiga = 0;   || base ILT fijos
     t_epigb = 0;   || base ILT no fijos

     t_enfe0 = 0;   || epigrafe enfermedad
     t_enfe1 = 0;   || total bases enfermedad
     t_enfe2 = 0;   || total trabajadores enfermos

     t_traba = 0;   || total trabajadores (empresas)
     t_trcen = 0;   || total trabajadores (centros)

     t_trab1 = 0;   || total trabajadores mes anterior (empresas)
     t_altas = 0;   || total altas (empresas)
     t_bajas = 0;   || total bajas (empresas)
     t_trab2 = 0;   || total trabajadores que quedan (empresas)

     t_trce1 = 0;   || total trabajadores mes anterior (centros)
     t_altce = 0;   || total altas (centros)
     t_bajce = 0;   || total bajas (centros)
     t_trce2 = 0;   || total trabajadores que quedan (centros)

     &t_trpo1 = 0;   || total trabajadores mes anterior (centros)
     &t_altpo = 0;   || total altas (centros)
     &t_bajpo = 0;   || total bajas (centros)
     &t_trpo2 = 0;   || total trabajadores que quedan (centros)

     &t_06 = 0; || totales pie TC2
     &t_07 = 0;
     &t_08 = 0;
     &t_09 = 0;
     &t_10 = 0;
     &t_11 = 0;
     &t_12 = 0;
     &t_14 = 0;
     &t_15 = 0; || jornadas reales (*)

     &desboni = "";  || descripcion de bonificacion
     &antepigr = 0;  || total epigrafe anterior

     &adjun_0 = "";  || variables para impreso 'SEGUN RELACION ADJUNTA'
     &adjun_1 = "";
     &adjun_2 = "";
     &adjun_3 = "";
     &adjun_4 = "";
     &adjun_5 = "";
     &adjun_6 = "";
     &adjun_7 = "";
     &adjun_8 = "";
     &adjun_9 = "";
     &adjun_A = "";
     &adjun_B = "";

     &antempre = 0;
     &antnombr = "";
     &antdirec = "";
     &antcodig = "";
     &antlocal = "";
     &antmutua = "";
     &antmutco = 0;
     &antcif   = "";
     &antcuent = "";

     antclave = "";
     &litecla = "";

     {99}busca = 0;

     &nomex = "";
     &direx = "";
     &locex = "";   || explotacion (*)
     &codex = "";
     &proex = "";

     &enB30 = 0;    || totalizadores informe
     &enB31 = 0;
     &enB02 = 0;
     &enB32 = 0;
     &enD01 = 0;
     &enD02 = 0;

     i = 0;
     j = 0;
     tot_i = 0;
     &nPer = "";
     &aPerinf = "";
     swCabecera = 0;
     &clave_IE = ""
     clave_IPF = ""
     aAbreviado = "";
     aTipo_Liq = "";
     aFecha = "";
     nFecha = 0;
     aNAFSS_Emp = "";
     aNAFSS_Tra = "";
     aCod_Postal = "";
     aCod_prov = "";
     aCod_pob = "";
     nCod_base = 0;
     aCod_base = "";
     sw_base = 0;
     nSwSiHay = 0;
     eaTitBorra = "";
     nSwOtroTC2 = 0;
     aCta = "";
     aCon = "";
     &nLinea = 0;
     nHojas = 0;
     nTraba = 0;
     aNSS = "";
     aApe = "";
     aIde = "";
     aNif = "";
     nEpi = 0;
     aEpi = "";
     nCto = 0;
     aBas = "";
     aDed = "";
     nDib = 0;
     nImp = 0;
     aSit = "";
     nDid = 0;
     nDed = 0;
     nFec = 0;
     nSwVacia2 = 0; nSwVacia3 = 0; nSwVacia4 = 0; nSwVacia5 = 0;
     nSwVacia6 = 0; nSwVacia7 = 0; nSwVacia8 = 0; nSwVacia9 = 0;
     nSwVacia10= 0; nSwVacia11= 0; nSwVacia12= 0; nSwVacia13= 0;
     nSwVacia14= 0; nSwVacia15= 0;
     aAlfa1 = "";
     aAlfa2 = "";
     enSwLin = 0;
     &enPagina = 0;
     aUltimo = "";
     bonifi = 0;
     bonifib = 0;
     reducc = 0;
     reduccb = 0;
     subven = 0;
     sub85pre = 0;
     sub85dis = 0;
     reduc0502 = 0;
     reduc0502b = 0;
     dias = 0;
     aFabre = "";
     aClaveTGSS = "";
     cte = 0;
     &t_desemfijos = 0;
     &t_desemeven = 0;
     &t_itfijos = 0;
     t_pordesem = 0;
     t_porit = 0;
     &t_iteven = 0;
     &t_reducc = 0;
     &t_bonif = 0;
     &t_subhoras = 0;
     &aModulo = "";
     nCotJor = 0;

     nTotEnf = 0;
     nTotMat = 0;
     nTotAcc = 0;
     nTopILT = 0;
     nTotILT = 0;
     aTipILT = "";
     anyonum = 0;
     m_des = 0;
     m_has = 0;
     m_fec = "";
     m_top = "";
     f_mes = "";
     fech1 = @;
     s_ori = "M";
     bisiesto = 0;
     guarda = 0;
     nBase_cp = 0;
     nMax_cp = 0;
     nMin_cp = 0;
     grupo = 0;
     dias_tope = 0;
     sw_tope = 0;
     &g_porit = 0;
     &g_pordesem = 0;
     nJornadas = 0;
     nDias = 0;
     nImpBase = 0;
     nImpDed = 0;
     nJornadasG = 0;
     nDiasG = 0;
     nImpBaseG = 0;
     nImpDedG = 0;
     swTraba = 0;
     bon_60 = 0;

     nBonifFPCont = 0;
     swBonifFPCont = 0;
     &s_tat = 0;
     &s_ele = "";
     estado = 0;

     fecha_bon_16 = "";
     aFechaRef = "";
     alfa4 = "";
     alfa5 = "";
     alfa6 = "";
     nume4 = 0;
     nume5 = 0;
     nume6 = 0;
     nume7 = 0;
     nume8 = 0;
     nAnyoBase = 0;
     aAnyoBase = "";

     swDobleBonif = 0;
     topemes = 0;

     &nCConst = 0;
     &fCFecha = @;
     &aCError = "";
     aAlfa = "";
     &fCFechaCot = @;
     &aCErrorCot = "";
     &nCodigoBon = 0;
     &nAny = 0;

     nAjustePFE = 0;
     nDiasMes = 0;
     nDiasAlta = 0;
     nDiasIT = 0;
     nDiasMate = 0;
     nBase = 0;
     nBonPFEAlta = 0;
     nBonPFEBaja = 0;
     &nEpigConv = 0;
     nNume3 = 0;
     t_nofog = 0;
     &nElMes = 0;
     &nElAny = 0;

     t_aux1a = 0;    || base cont. general, alta, con des.
     t_aux2a = 0;    || base cont. general, alta, sin des.
     t_aux3a = 0;    || base cont. jornadas, alta, con des
     t_aux4a = 0;    || base cont. jornadas, alta, sin des
     t_aux5a = 0;    || base FP
     t_aux6 = 0;     || base CC cot. empresarial (mat)
     t_aux6_01 = 0;  || base CC cot. empresarial (mat) grupo 01
     t_aux1a_01 = 0; || base cont. general, grupo 01
     t_aux1b = 0;    || base cont. general, IT, con des.
     t_aux1c = 0;    || base cont. general, IT, con des.
     t_aux2b = 0;    || base cont. general, IT, sin des.
     t_aux3c = 0;    || base cont. jornadas, IT, con des, pago emp
     t_aux3b = 0;    || base cont. jornadas, IT, con des, pago SS
     t_aux4b = 0;    || base cont. jornadas, IT, sin des (fogasa)
     t_aux7b = 0;
     t_aux7c = 0;
     t_epig1a = 0;
     t_epig2a = 0;
     t_epig3a = 0;
     t_epig4a = 0;
     t_epig1b = 0;
     t_epig2b = 0;
     t_epig3b = 0;
     t_epig4b = 0;

     t_cuotacont = 0;  || total cuota cont. comunes
     t_cuotades1 = 0;  || total cuota desempleo trab+emp
     t_cuotafoga = 0;  || total cuota fogasa
     t_basefoga = 0;

     t_basedestot = 0;
     t_tipodestot = 0;
     t_basedesemp = 0;
     t_tipodesemp = 0;

     t_basedestot1 = 0;
     t_tipodestot1 = 0;
     t_basedestot2 = 0;
     t_tipodestot2 = 0;
     t_basedestot3 = 0;
     t_tipodestot3 = 0;
     t_basedesemp1 = 0;
     t_tipodesemp1 = 0;
     t_basedesemp2 = 0;
     t_tipodesemp2 = 0;
     t_basedesemp3 = 0;
     t_tipodesemp3 = 0;
     t_tipo_G01 = 0;
     t_tipo_G01_emp = 0;

     swListo = 0;
     swNoAjuste3 = 0;
     swAjuste3 = 0;
     swSigue = 0;
     nBonif = 0;

     nRedCCAlta = 0;
     nRedCCEnf = 0;
     nRedDesEnf = 0;
     nRedCCMat = 0;
     nRedDesMat = 0;
     nRedCCAcc = 0;
     nRedDesAcc = 0;
     nRedCCEnfEmp = 0;
     nRedDesEnfEmp = 0;
     nNume = 0;
     nBonifERE = 0;

     aUltimaIT = "";
     nDesde = 0;
     nHasta = 0;
     nCampo = 0;
|FIN;
____________________________________/ RUTINAS DE CARGA DE TEMPORAL
|PROCESO IgnacioPrieto;
          || para este cliente la base de cont.profesionales es igual
          ||/al promedio para el desempleo multiplicado por las jornadas
    aFabre = "";
    |DIRECTORIO aFabre;
    aFabre = "rt  " + aFabre + "aginom/bin/mod00242.tab";
    |FABRE aFabre;
    |SI FSalida ] 0;
        |FCIERRA FSalida;
        aFabre = "";
        |DIRECTORIO aFabre;
        aFabre = "rt  " + aFabre + "aginom/bin/gafi0001.tab";
        |FABRE aFabre;
        |SI FSalida < 0;
            #7#27 = #5#242 * #6#11;
            #7#30 = #5#242 * #6#11;
            |SI #5#242 = 0;
                 alfa1 = #5#0; alfa1 = "00000" + alfa1; alfa1 = alfa1 % -105;
                 alfa2 = #5#1; alfa2 = "00000" + alfa2; alfa2 = alfa2 % -105;
                 alfa3 = "    ATENCION: Trabajador " + alfa1 + "." + alfa2;
                 alfa3 = alfa3 + " con base de cont. prof. a cero segun modulo";
                 alfa3 = alfa3 + " instalado 001906";
                 |MENAV alfa3;
            |FINSI;
        |SINO;
            |FCIERRA FSalida;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO constante;
     alfa1 = "01";
     alfa2 = #0#2;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFecha = alfa4;         || primer dia de mes de calculo
     aCError = "";            || inicializo errores
     |HAZ LeeCons;
|FPRC;

|PROCESO topemes;
     nume2 = 0;
     nume1 = #0#3 $ 4;    || a¤o historico
     |SI nume1 = 0;
          bisiesto = 1;
          nume2 = 1;
     |FINSI;
     topemes = 31;
     |SI #0#2 = 2;
        topemes = 28 + nume2;
     |FINSI;
     |SI #0#2 = 4;|O #0#2 = 6;|O #0#2 = 9;|O #0#2 = 11;
        topemes = 30;
     |FINSI;
|FPRC;

|PROCESO nombotra;
     nBonif = #nombotra#2;
     |ERROR10;
|FPRC;

|DEFBUCLE nombotra;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     ;
     NULL, nombotra;
|FIN;

|PROCESO LeeBonPFE;
     |ABRE #nombotra;
     |ABRE #nomboni3;

     nBonif = 0;
     |BUCLE nombotra;
     |SI nBonif ! 0;
          #nomboni3#0 = #nombotra#2;
          |LEE 000#nomboni3.=;
          |SI FSalida = 0;
               nume3 = #nomboni3#4;
          |FINSI;
     |FINSI;
     |CIERRA #nomboni3;
     |CIERRA #nombotra;
|FPRC;

|PROCESO AjusteMensuales;
     aUltimaIT = "";
     |PARA nCampo = 27; |SI nCampo [ 30; |HACIENDO nCampo = nCampo + 1;
          nDesde = nCampo - 8;
          nHasta = nCampo - 4;
          |SI #6nCampo ! " ";
               aUltimaIT = #6nCampo;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO modulo2;
     || este proceso se crea para controlar el tema de la opcion "3" en el
     || control de la aplicacion en el calculo de Dias de IT
     || solo si no soy diario, estoy en un mes de 31 dias y tengo parte en IT
     || esta copiado del i_nomcal3, donde hay uno igual, si se cambia algo
     || tenerlo en cuenta por si alli hace falta

     |HAZ topemes;
     swAjuste3 = 0;
     || swNoAjuste3 = 0;
     nume1 = #7#43 + #7#44 + #7#49;
     nume2 = #7#42;
     |SI nume2 = 0; nume2 = topemes; |FINSI;

     ||SI #nomcontr#17 = 3;   || siempre, claro, son mensuales

          swSigue = 1;
          |SI #labtraba#42 = "E";
               swSigue = 0;
          |FINSI;
          /*
          |SI #labtraba#42 ! "D"; |Y #labtraba#42 ! "T";
               swSigue = 1;
          |FINSI;
          |SI #labtraba#247 = 132; |Y #labtraba#33 < 8;
               swSigue = 1;
          |FINSI;
          */
          |SI swSigue = 1;
               |SI nume1 ! 0; |Y #7#20 ] 30; || (todo el mes en alta)
               |Y #7#41 [ 1; |Y nume2 ] topemes;
               ||Y swNoAjuste3 = 0;
                    |SI nElMes ! 4; |Y nElMes ! 6; |Y nElMes ! 9; |Y nElMes ! 11;
                         |SI nElMes ! 2;
                              swAjuste3 = 1;
                         |SINO;
                              swAjuste3 = -2 + bisiesto;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     ||FINSI;
|FPRC;

|PROCESO temporal2;
     |DDEFECTO #7;
     #1#0 = #6#0;
     |LEE 020#1=;               || Lee la empresa
     |SI FSalida = 0;           || Si existe lee constante
          /*
          #3#0 = #1#32;
          |LEE 020#3=;           || Lee la constante
          */
          #5#0 = #1#0;
          #5#1 = #6#1;
          |LEE 020#5=;       || Lee el trabajador, carga y graba
          |SI FSalida = 0;
               nCConst = #5#248;
               |HAZ constante;
               |SI aCError = "";
                    |SI #5#42 = "A";|O #5#42 = "B";|O #5#42 = "E";|O #5#42 = "e";
                         #10#0 = #1#0;
                         #10#1 = #5#77;
                         |LEE 020#10=;  || Lee el centro de trabajo
                         |SI FSalida = 0;    || Si existe sigue
                              #7#0 = #1#0;          || Codigo empresa
                              #7#1 = #1#2;          || Nombre de la empresa
                              #7#2 = #1#19;         || Clave Entidad A.T.
                              #7#3 = #1#20;         || Nombre Entidad A.T.
                              || SI #0#4 = "N";
                              |SI #1#45 = "N";
                                   domi = #1#3;     || Carga variable trabajo
                                   |QBF domi;       || Quita espacios
                                   #7#4 = domi+" "+#1#4+" "+#1#5; || Construye domicilio
                                   postal1 = "00" + #1#7;
                                   postal1 = postal1 % -102;|| Convierte a alfa el c.
                                   postal2 = "000" + #1#8;
                                   postal2 = postal2 % -103;|| Convierte a alfa resto de codigo
                                   #7#5 = postal1 + postal2;|| construye C.P.
                                   #7#6 = #1#6;        || Localidad
                                   afili = #1#13;
                              |SINO;
                                   domi = #10#3;    || Carga variable trabajo
                                   |QBF domi;       || Quita espacios
                                   #7#4 = domi+" "+#10#4+" "+#10#5; || Construye domicilio
                                   postal1 = "00" + #10#7;
                                   postal1 = postal1 % -102;|| Convierte a alfa el codigo provincia
                                   postal2 = "000" + #10#8;
                                   postal2 = postal2 % -103;|| Convierte a alfa resto de codigo
                                   #7#5 = postal1 + postal2;|| construye C.P.
                                   #7#6 = #10#6;       || Localidad
                                   afili = #10#10;
                              |FINSI;
                              #7#7 = #1#10;         || C.I.F. empresa
                              |HAZ clave_IE;
                              |QBF afili;
                              sgdoalf = afili % 0;
                              sgdonum = sgdoalf;
                              sgdonum = sgdonum - 4;
                              sgdonum = sgdonum + 300;   || para coger 2do. digito
                              #7#8 = afili % 102;   || Primer digito S.S.
                              #7#9 = afili % sgdonum;    || Segundo digito S.S.
                              #7#10 = afili % -102; || Tercer digito S.S.
                              |HAZ mes;             || Mes literal
                              #7#12 = #0#3;         || A¤o
                              |HAZ altabaja;        || Si es alta/baja/continua/X
                              #7#14 = #5#77;        || Centro de Trabajo
                              |SI #1#45 = "S"; |Y #10#21 ! 0;
                                   #7#14 = #10#21;
                              |FINSI;
                              afili = #5#75;
                              |QBF afili;
                              sgdoalf = afili % 0;
                              sgdonum = sgdoalf;
                              sgdonum = sgdonum - 4;
                              sgdonum = sgdonum + 300;   || para coger 2do. digito
                              #7#15 = afili % 102;  || Primer digito S.S.
                              #7#16 = afili % sgdonum;   || Segundo digito S.S.
                              #7#17 = afili % -102; || Tercer digito S.S.
                              #7#18 = #5#7;         || DNI/NIF trabajador
                              ||#7#19 = #5#2;         || Nombre Trabajador
                              |HAZ sep_nombre;
                              #7#19 = aAbreviado;   || Nombre trabajador abreviado
                              #7#20 = #6#8;         || Dias en Alta
                              #7#21 = #5#33;        || Grupo de Cotizacion
                              #7#22 = #6#9;         || (*) JORNADA DEL
                              #7#23 = #6#10;        || (*) JORNADA AL
                              #7#24 = #6#11;        || (*) NUMERO JORNADAS
                              #7#25 = #6#39;        || Base Contin.Comu.
                              |SI #0#3 [ 2006;
                                   nEpigConv = #5#32;        || Epigrafe
                              |SINO;
                                   |HAZ VerifCNAE;
                              |FINSI;
                              #7#26 = nEpigConv;        || Epigrafe
                              #7#28 = #6#41;        || Base Horas 1
                              #7#29 = #6#42;        || Base Horas 2
                              |SI #6#40 < 0; #6#40 = 0; |FINSI;
                              #7#30 = #6#40;        || BASE PROF.
                              |SI nElAny ] 2012;
                                   #7#25 = #7#25 - #6#62;
                                   #7#27 = #6#40;
                                   |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                        nume1 = 146;
                                   |FINSI;
                                   |SI runnom = "gomwwtc2"; nume1 = 188; |FINSI;
                                   #7#27 = #7#27 - #6nume1;
                                   |SI runnom = "gomyytc2";
                                        nume1 = 117;
                                        nume2 = 115;
                                        nume3 = 134;
                                        nume4 = 128;
                                   |FINSI;
                                   |SI runnom = "gomsstc2";
                                        nume1 = 119;
                                        nume2 = 125;
                                        nume3 = 127;
                                        nume4 = 128;
                                   |FINSI;
                                   |SI runnom = "gomwwtc2";
                                        nume1 = 159;
                                        nume2 = 157;
                                        nume3 = 176;
                                        nume4 = 170;
                                   |FINSI;
                                   #7#25 = #7#25 + #6nume1;
                                   |SI runnom = "gomsstc2";
                                        #7#27 = #7#27 - #6nume2 + #6nume1;
                                   |SINO;
                                        #7#27 = #7#27 + #6nume1 + #6nume4;
                                   |FINSI;
                                   |SI #6nume1 ! 0;
                                        || parche: tengo maternidad
                                        nNume = #6nume2 - #6nume1;
                                        |SI nNume = 0;
                                             || toda la base de pago directo es la de
                                             || maternidad
                                             #7#27 = #7#27 + #6nume3 - #6nume2;
                                             || esto lo hago por la posible deferencia
                                             || negativa que se me genera si las bases
                                             || de maternidad de CC y CP
                                             || son distintas
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                              |SI #7#26 ! 0; |Y nElAny [ 2011;
                                   #7#27 = #6#37 + #6#38;  || CONTIN.PROF.(*)(remuner)
                                   |SI runnom = "gomyytc2"; nume1 = 66;    |FINSI;
                                   |SI runnom = "gomsstc2"; nume1 = 66;    |FINSI;
                                   |SI runnom = "gomwwtc2"; nume1 = 105;   |FINSI;
                                   #7#65 = #6nume1;      || dias vacaciones
                                   #7#66 = #7#27 * #7#65 / (#7#20 - #7#33);
                                   #7#66 = #7#66 ! EURODB;
                                   || Esa es la base AT/EP en vacaciones
                                   || = base AT/EP alta *  dias_vac / dias_alta
                                   || se la quito a la base alta para hallar la
                                   || base alta real por si hubiera vacaciones
                                   #7#27 = #7#27 - #7#66;
                              |FINSI;
                              |SI runnom = "gomyytc2"; nume1 = 146;    |FINSI;
                              |SI runnom = "gomsstc2"; nume1 = 146;    |FINSI;
                              |SI runnom = "gomwwtc2"; nume1 = 188;   |FINSI;
                              #7#31 = #6nume1;      || Base IT DES, FP, FOG, ATEP
                                             || (puede ser distinta a la base
                                             ||  IT para CC)
                              #7#32 = #6#57;        || Dto. Enfermedad
                              #7#34 = #6#58;        || Dto. Acc.Trabajo
                              #7#35 = #6#12;        || Codigo Bonificacion
                              || migue
                              |SI #0#3 [ 2009;
                                   |SI #0#3 [ 2006;
                                        #7#36 = 126;         || Epigrafe Enfermedad
                                   |SINO;
                                        #7#36 = 904;
                                   |FINSI;
                              |SINO;
                                   |HAZ VerifCNAE;
                                   #7#36 = nEpigConv;
                              |FINSI;
                              |HAZ enfersano;           || Si es enfermo o sano
                              #7#39 = #6#1;         || Codigo Trabajador
                              #7#40 = #5#49 % -122; || Comentario
                              |HAZ suplemen;
                              || SI #0#4 = "N";  || Cod. cuenta S.S. tal cual
                              |SI #1#45 = "N";
                                   #7#45 = #1#13;
                              |SINO;
                                   #7#45 = #10#10;
                              |FINSI;
                              #7#46 = #5#10;        || (*) PROVINCIA TRABAJADOR

                              |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                   nume1 = 116;
                                   nume2 = 115;
                                   nume3 = 118;
                                   nume4 = 114;
                                   nume5 = 124;
                              |FINSI;

                              |SI runnom = "gomwwtc2"; nume1 = 158;    |FINSI;
                              |SI runnom = "gomwwtc2"; nume2 = 157;    |FINSI;
                              |SI runnom = "gomwwtc2"; nume3 = 160;    |FINSI;
                              |SI runnom = "gomwwtc2"; nume4 = 156;    |FINSI;
                              |SI runnom = "gomwwtc2"; nume5 = 166;    |FINSI;
                              #7#47 = #5#42;           || (*) CLAVE DIAS SALARIO
                              |SI nElAny ] 2012;
                                   |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                        |SI runnom = "gomyytc2";
                                             nume1 = 115;
                                             nume2 = 146;
                                             nume3 = 134;
                                             nume4 = 114;
                                             nume5 = 124;
                                             nume6 = 117;
                                        |FINSI;
                                        |SI runnom = "gomsstc2";
                                             || en atrasos se coge del tsilcon1
                                             nume1 = 125;
                                             nume2 = 62;
                                             nume3 = 127;
                                             nume4 = 124;
                                             nume5 = 126;
                                             nume6 = 119;
                                        |FINSI;
                                        nume7 = 128;
                                        |SI #5#42 = "A";
                                             nume8 = 78;
                                        |SINO;
                                             nume8 = 138;
                                        |FINSI;
                                   |FINSI;
                                   |SI runnom = "gomwwtc2";
                                        nume1 = 157;
                                        nume2 = 188;
                                        nume3 = 176;
                                        nume4 = 156;
                                        nume5 = 166;
                                        nume6 = 159;
                                        nume7 = 170;
                                        |SI #5#42 = "A";
                                             nume8 = 119;
                                        |SINO;
                                             nume8 = 180;
                                        |FINSI;
                                   |FINSI;
                                   #7#37 = #6#62 - #6nume1; || base CC IT
                                   |SI runnom ! "gomsstc2";
                                        || no en atrasos
                                        #7#31 = #6nume2 - #6nume3; || base CP IT
                                        #7#31 = #7#31 - #6nume7; || quito ERE
                                   |FINSI;
                                   #7#82 = #6nume1;    || Base CC total pago directo SS
                                   #7#99 = #6nume3;    || Base CP total pago directo SS

                                   #7#85 = #6nume4;    || Dias pago directo SS
                                   #7#87 = #6nume5;    || Dias o jornadas pago directo SS

                                   #7#61 = #6nume6;
                                   || de momento esta, si me coinciden enf y mat
                                   || ya veremos
                                   |SI #7#61 ! 0;
                                        || si existe base de maternidad
                                        || #7#62 = #6nume3;
                                        || ¨por que esta si ya tengo la base
                                        || de mat. en el nume6?
                                        #7#62 = #6nume6;
                                   |FINSI;

                                   #7#67 = #6nume7;    || base CC ERE
                                   #7#68 = #6nume7;    || base CP ERE
                                   #7#69 = #6nume8;    || dias o jorn. ERE
                              |SINO;
                                   #7#37 = #6#62;      || Base Enferm.Accte.
                                   |SI eaFuente ! "A"; |Y eaFuente ! "T";  || en atrasos no tiene que aparecer
                                        #7#84 = #6nume1;    || Base AT/EP diaria
                                        #7#82 = #6nume2;    || Base total pago directo SS
                                        #7#83 = #6nume3;    || Bonif Fija
                                        #7#85 = #6nume4;    || Dias pago directo SS
                                        #7#87 = #6nume5;    || Dias o jornadas pago directo SS
                                   |FINSI;
                              |FINSI;
                              #7#48 = #6#3;

                              || trabajadores excluidos del censo agrario
                              || los que cotizan como el reg.general por
                              || comunes: al 23.60 y no al 15.50
                              |SI #nomconst#6 > 16;
                                   #7#83 = 0;
                              |FINSI;

                              #7#43 = #6#31;      || enfermedad comun
                              #7#44 = #6#32;      || accidente trabajo
                              #7#49 = #6#65;      || maternidad
                              |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                   nume1 = 131;
                              |FINSI;
                              |SI runnom = "gomwwtc2";
                                   nume1 = 173;
                              |FINSI;
                              #7#49 = #7#49 + #6nume1;      || maternidad
                              |HAZ modulo2;

                              #7#33 = #7#43 + #7#44 + #7#49;  || Dias enfer.acci.mater.
                              #7#86 = swAjuste3;
                              |SI #7#33 ! 0;
                                   #7#33 = #7#33 - swAjuste3;
                              |FINSI;
                              |HAZ FechasInicioTC2;

                              #7#52 = #7#15 + #7#16;    || en BTRIEVE no mas de 7
                              #7#54 = #1#45;
                              #7#63 = #6#55;
                              |HAZ BaseCot;
                              |SI #5#42 = "e";
                                   |SI #5#33 = 12;     || la categoria
                                        nume1 = 11 + 22;
                                   |SINO;
                                        nume1 = #5#33 + 22;
                                   |FINSI;
                                   |SI #6#8 ! 30;   || no estoy de alta el mes completo
                                        nume2 = (#6#8 - #7#33); || dias trabajados
                                   |SINO;
                                        |SI #7#33 > 0;  || estoy de alta el mes completo pero tengo IT
                                             nume2 = (#6#7 - #7#33); || dias trabajados
                                        |SINO;         || mes completo sin IT
                                             nume2 = 30;
                                        |FINSI;
                                   |FINSI;
                                   |SI eaFuente ! "A"; |Y eaFuente ! "T";  || en atrasos no tiene que aparecer
                                                                     || esta base: 001185.00434
                                        #7#70 = ((#gomcotiz#nume1# * nume2) / 30) ! 2;   || base comunes
                                        #7#71 = (#7#70 % #3#7) ! 2;          || cuota
                                   |FINSI;
                              |FINSI;
                              |SI runnom = "gomyytc2"; |O runnom = "gomwwtc2"; |O runnom = "gomsstc2";
                                   |SI nElAny [ 2011;
                                        || #7#64 = (#6#55 * nCotJor) ! EURODB;

                                        sw_tope = 0;
                                        nBase_cp = #7#27;   || chequeo topes de cotizac.
                                        |HAZ topes_cp;      || en Cont. Profesionales
                                        #7#27 = nBase_cp;   || en Alta

                                        |SI #2#42 ! "E";
                                             nBase_cp = #7#33 * #7#84;   || chequeo topes de cotizac.
                                        |SINO;
                                             nBase_cp = #7#63 * #7#84;   || chequeo topes de cotizac.
                                        |FINSI;
                                        |HAZ topes_cp;      || en Cont. Profesionales
     /*
                                        nBase_cp = #7#66;   || chequeo topes de cotizac.
                                        |HAZ topes_cp;      || en Cont. Profesionales
                                        #7#66 = nBase_cp;   || en Vacaciones
     */
                                   |FINSI;
                              |FINSI;

                              |SI runnom = "gomyytc2"; |O runnom = "gomwwtc2"; |O runnom = "gomsstc2";
                                   |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                        nume1 = 96;
                                        nume2 = 106;
                                        nume4 = 107;
                                   |FINSI;
                                   |SI runnom = "gomwwtc2";
                                        nume1 = 138;
                                        nume2 = 148;
                                        nume4 = 149;
                                   |FINSI;
                                   |SI #6nume2 > 0;
                                        #7#74 = 3141;
                                   |FINSI;
                                   |SI #6nume1 > 0;
                                        #7#73 = #6nume1;
                                        |HAZ LeeBonPFE;
                                        |SI #7#74 ! 3141;
                                             #7#74 = nume3;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                              || reducciones
                              |SI #7#47 = "A"; |Y nElAny ] 2012;
                                   |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                        nume1 = 148; #7#90 = #6nume1;
                                        nume1 = 149; #7#91 = #6nume1;
                                        nume1 = 150; #7#92 = #6nume1;
                                        nume1 = 151; #7#93 = #6nume1;
                                        nume1 = 152; #7#94 = #6nume1;
                                        nume1 = 153; #7#95 = #6nume1;
                                        nume1 = 154; #7#96 = #6nume1;
                                        nume1 = 157; #7#97 = #6nume1;
                                        nume1 = 158; #7#98 = #6nume1;
                                   |FINSI;
                                   |SI runnom = "gomwwtc2";
                                        nume1 = 190; #7#90 = #6nume1;
                                        nume1 = 191; #7#91 = #6nume1;
                                        nume1 = 192; #7#92 = #6nume1;
                                        nume1 = 193; #7#93 = #6nume1;
                                        nume1 = 194; #7#94 = #6nume1;
                                        nume1 = 195; #7#95 = #6nume1;
                                        nume1 = 196; #7#96 = #6nume1;
                                        nume1 = 199; #7#97 = #6nume1;
                                        nume1 = 200; #7#98 = #6nume1;
                                   |FINSI;
                              |FINSI;
                              |SI #7#47 = "E"; |Y nElAny ] 2012;
                                   |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
                                        nume1 = 148; #7#90 = #6nume1;
                                        nume1 = 149; #7#91 = #6nume1;
                                        nume1 = 150; #7#92 = #6nume1;
                                        nume1 = 151; #7#93 = #6nume1;
                                        nume1 = 152; #7#94 = #6nume1;
                                        nume1 = 153; #7#95 = #6nume1;
                                        nume1 = 154; #7#96 = #6nume1;
                                        nume1 = 157; #7#97 = #6nume1;
                                        nume1 = 158; #7#98 = #6nume1;
                                   |FINSI;
                                   |SI runnom = "gomwwtc2";
                                        nume1 = 190; #7#90 = #6nume1;
                                        nume1 = 191; #7#91 = #6nume1;
                                        nume1 = 192; #7#92 = #6nume1;
                                        nume1 = 193; #7#93 = #6nume1;
                                        nume1 = 194; #7#94 = #6nume1;
                                        nume1 = 195; #7#95 = #6nume1;
                                        nume1 = 196; #7#96 = #6nume1;
                                        nume1 = 199; #7#97 = #6nume1;
                                        nume1 = 200; #7#98 = #6nume1;
                                   |FINSI;
                              |FINSI;
                              |PARA nume1 = 90; |SI nume1 [ 98; |HACIENDO nume1 = nume1 + 1;
                                   || en febrero 2012 hubo problemas con acc o mat
                                   || o enf de pago directo, se grababa en nomina
                                   || una cantidad negativa equivalente a un dia
                                   || de reduccion, en nomina esta arreglado
                                   || pero para no tener que recalcular hicimos esto
                                   || (quitar en junio 2012 por ejemplo)
                                   |SI #7nume1 < 0;
                                        |SI nume1 = 91;
                                             #7#97 = #7#97 + #7nume1;
                                        |FINSI;
                                        |SI nume1 = 92;
                                             #7#98 = #7#98 + #7nume1;
                                        |FINSI;
                                        #7nume1 = 0;
                                   |FINSI;
                              |SIGUE;
                              |SI runnom = "gomyytc2";
                                   nume1 = 125;
                                   #7#88 = #6nume1;
                              |FINSI;
                              |SI runnom = "gomwwtc2";
                                   nume1 = 167;
                                   #7#88 = #6nume1;
                              |FINSI;

                              || cotizacion de solidaridad
                              |SI runnom = "gomyytc2";
                                   nume1 = 164;
                                   nume2 = 165;
                              |FINSI;
                              |SI runnom = "gomwwtc2";
                                   nume1 = 206;
                                   nume2 = 207;
                              |FINSI;
                              |SI runnom = "gomsstc2";
                                   nume1 = 121;
                                   nume1 = 122; || (por ejemplo, uno a cero)
                              |FINSI;
                              #7#101 = #6nume1 + #6nume2;
                              |GRABA 020#7n;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaFechaBon;
     |ABRE #nombotra;
     nBonif = 0;
     |BUCLE nombotra;
     |SI nBonif ! 0;
          Alfa1 = #nombotra#4;
     |FINSI;
     |CIERRA #nombotra;
|FPRC;

|PROCESO LineaBase;
    |DDEFECTO #102;
    #102#0 = #7#55;                     || Codigo Convenio

    nFecha = aFecha;
    #102#1 = nFecha;                    || Periodo
    aNAFSS_Tra = #7#15 + #7#16 +#7#17;
    |QBT aNAFSS_Tra;
    #102#2 = aNAFSS_Tra;                || Nro. Afiliacion Trabajador
    |SI #0#3 [ 2006;
         #102#3 = #7#26;                     || Epigrafe
    |SINO;
         |SI #7#26 = "904";
               #102#3 = "c   ";
         |SINO;
               #102#3 = #labtraba#204;
         |FINSI;
    |FINSI;
    |SI #0#3 [ 2006;
         |SI #102#3 > 500; #102#3 = #102#3 - 500; |FINSI; || parchecito para epigrafes raros
    |FINSI;
    #102#6 = #7#19;                || Nombre
    |HAZ clave_IPF;
    #102#7 = clave_IPF;            || Clave I.P.F.
    #102#8 = #7#18;                || DNI/NIF/Pasaporte
    |HAZ datos_trab;
    ||#102#12 = nContrato;         || Codigo de contrato
    #102#12 = #5#45;               || Codigo de contrato
    #102#16 = aNAFSS_Emp;          || Cta. Cotiz. Empresa

    aAlfa1 = aCod_base % -103;     || Clave para ordenacion de lineas TC2/8
    nNume1 = aAlfa1;               || -------------------------------------
    |SI nNume1 > 0;                || A1 - Fijos sin IT
        aAlfa1 = "2";              || A2 - Fijos con IT
    |SINO;                         || B1 - Fijos sin desempleo sin IT
        aAlfa1 = "1";              || B2 - Fijos sin desempleo con IT
    |FINSI                         || E1 - Eventuales sin IT
    #102#17 = #7#47 + aAlfa1;      || E2 - Eventuales con IT
    |SI j = 1;
         sw_base = sw_base + 1;
    |FINSI;
    nJornadas = 0;
     |SI sw_base = 1; |O sw_base = 2; |O sw_base = 4;
          |SI #7#47 = "A"; |O #7#47 = "e";
               nJornadas = #7#20 - #7#33;    || dias alta
          |SINO;
               nJornadas = #7#24;            || Nro. Jornadas en Alta
          |FINSI;
     |FINSI;
     |SI sw_base = 3;          || para la base 35
          |HAZ topemes
          |SI #7#20 ! 30;   || no estoy de alta el mes completo
               nJornadas = (#7#20 - #7#33); || dias trabajados
          |SINO;
               |SI #7#33 > 0;  || estoy de alta el mes completo pero tengo IT
                    nJornadas = (topemes - #7#33); || dias trabajados
               |SINO;         || mes completo sin IT
                    nJornadas = topemes;
               |FINSI;
          |FINSI;
    |FINSI;
    |SI sw_base = 5; |O sw_base = 6; |O sw_base = 7;
        nJornadas = #7#63;       || Nro. Jornadas en Baja
          |SI #7#47 = "A"; |O #7#47 = "e";
               |SI sw_base = 5;
                    |SI j = 1;
                         nJornadas = #7#85;
                    |FINSI;
                    |SI j = 2;
                         nJornadas = #7#33 - #7#85;
                    |FINSI;
                    |SI j = 3;
                         nJornadas = #7#33;      || dias IT
                    |FINSI;
               |FINSI;
               |SI sw_base = 7;
                    nJornadas = #7#33;      || dias IT
               |FINSI;
          |SINO;
               |SI sw_base = 6;
                    |SI j = 1;
                         nJornadas = #7#85;
                    |FINSI;
                    |SI j = 2;
                         nJornadas = #7#63 - #7#85;
                    |FINSI;
                    |SI j = 3;
                         nJornadas = #7#63;      || dias IT
                    |FINSI;
               |FINSI;
               |SI sw_base = 7;
                    nJornadas = #7#63;      || jornadas en IT
               |FINSI;
          |FINSI;
    |FINSI;
    |SI sw_base = 8;
        nJornadas = #7#65;       || Nro. DIAS de Vacaciones
    |FINSI;
     nImpBase = 0;
     Alfa1 = aCod_base % 101;
     |SI Alfa1 = "1"; |Y sw_base = 1;
          |SI #nomconst#12 ! 0;
               #102#04 = "01";
          |SINO;
               #102#04 = "41";
          |FINSI;
          nImpBase = #7#25;             || base C.C. Cot. Gen. (01 - 41)
     |FINSI;
     Alfa1 = aCod_base % 201;
     |SI Alfa1 = "1"; |Y sw_base = 2;
          |SI #nomconst#12 ! 0;
               #102#04 = "30";
          |SINO;
               #102#04 = "37";
          |FINSI;
          nImpBase = #7#25;             || base C.C. Cot. Jor. (30 - 37)
     |FINSI;
    Alfa1 = aCod_base % 301;
    |SI Alfa1 = "1"; |Y sw_base = 3;
        #102#04 = "35";
        nImpBase = #7#70;                || base Cot. ext.even (35)
    |FINSI;
    Alfa1 = aCod_base % 401;
    |SI Alfa1 = "1"; |Y sw_base = 4;
        ||#102#04 = "02";           || la 02 la grabo como 42 para que salgan bien
        #102#04 = "42";             || las lineas, luego en la impresion lo cambio
        nImpBase = #7#27;               || base AT/EP (02)
    |FINSI;

     Alfa1 = aCod_base % 501;
     |SI Alfa1 = "1"; |Y sw_base = 5;
          |SI j = 1;
               nImpBase = #7#82;
               |SI nImpBase ! 0; |Y #nomconst#12 ! 0;
                    #102#04 = "21"; || Desempleo Cot.Gen. en IT paga Emp. (21)
               |SINO;
                    nImpBase = 0;
               |FINSI;
          |FINSI;
          |SI j = 2;
               nImpBase = #7#37 - #7#82;
               |SI nImpBase ! 0; |Y #nomconst#12 ! 0;
                    #102#04 = "23"; || Desempleo Cot.Gen. en IT paga S.S. (23)
               |SINO;
                    nImpBase = 0;
               |FINSI;
          |FINSI;
          |SI j = 3;
               nImpBase = #7#37;
               |SI nImpBase ! 0; |Y #nomconst#12 = 0;
                    #102#04 = "38"; || Desempleo Cot.Gen. en IT (38)
               |SINO;
                    nImpBase = 0;
               |FINSI;
          |FINSI;

          |SI #0#3 [ 2006;
               #102#03 = "126"
          |SINO;
               #102#03 = "c  "
          |FINSI;
    |FINSI;

     Alfa1 = aCod_base % 601;
     |SI Alfa1 = "1"; |Y sw_base = 6;
          |SI j = 1;
               nImpBase = #7#82;
               |SI nImpBase ! 0; |Y #nomconst#12 ! 0;
                    #102#04 = "32"; || Desempleo Cot.Gen. en IT paga Emp. (32)
               |SINO;
                    nImpBase = 0;
               |FINSI;
          |FINSI;
          |SI j = 2;
               nImpBase = #7#37 - #7#82;
               |SI nImpBase ! 0; |Y #nomconst#12 ! 0;
                    #102#04 = "36"; || Desempleo Cot.Gen. en IT paga S.S. (36)
               |SINO;
                    nImpBase = 0;
               |FINSI;
          |FINSI;
          |SI j = 3;
               nImpBase = #7#37;
               |SI nImpBase ! 0; |Y #nomconst#12 = 0;
                    #102#04 = "38"; || Desempleo Cot.Gen. en IT (38)
               |SINO;
                    nImpBase = 0;
               |FINSI;
          |FINSI;

          |SI #0#3 [ 2006;
               #102#03 = "126"
          |SINO;
               #102#03 = "c  "
          |FINSI;
    |FINSI;

    Alfa1 = aCod_base % 701;
    |SI Alfa1 = "1"; |Y sw_base = 7;
       ||#102#04 = "02";     || la 02 la grabo como 42 para que salgan bien
       #102#04 = "42";       || las lineas, luego en la impresion lo cambio

       || nImpBase = #7#37;      || base AT/EP en baja (02)
       |SI #7#47 = "A"; |O #7#47 = "e";
            nImpBase = #7#84 * #7#33;      || base AT/EP en baja (02)
       |SINO;
            nImpBase = #7#84 * #7#33;      || base AT/EP en baja (02)
       |FINSI;

       |SI #0#3 [ 2006;
            #102#03 = "126"
       |SINO;
            #102#03 = "c  "
       |FINSI;
       aUltimo = "02";       || estaba puesto a 22 si habia base AT/EP en baja
    |FINSI;
    Alfa1 = aCod_base % 801;
    |SI Alfa1 = "1"; |Y sw_base = 8;
       #102#04 = "44";        || base AT/EP vacaciones (34)
       nImpBase = #7#66;      || lo grabo como 44 para que salga al final del
                              || todo en la impresion
       || #102#03 = "126";    || es baja pero el epigrafe es el mismo
    |FINSI;
     nImpDed  = 0;
     nDias = 0;
     Alfa2 = #102#4;
     nume2 = Alfa2;
     ||SI nume2 = 01; |O nume2 = 41; |O nume2 = 30; |O nume2 = 37;
     ||SI #102#04 = aUltimo; |O sw_base = 3;   || lo del sw_base = 3 para que
     ||SI sw_base = 3;
     ||SI nume2 = 30; |O nume2 = 31;
     |HAZ calcula_bonif;                  || pinte bonif en alta
          |SI nume2 = 01; |O nume2 = 41; |O nume2 = 30; |O nume2 = 37;
               dias = #7#20 - #7#33;
               |SI bonifi > 0;
                    |SI reducc > 0;
                         swDobleBonif = 1;   || tengo la reduccion normal
                    |SINO;                   || mas otra bonif
                         #102#5 = "07";
                         nImpDed = bonifi;
                         Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                         #102#15 = Alfa1;
                         nDias = dias;
                         swDobleBonif = 2;
                    |FINSI;
               |FINSI;
               |SI sub85pre > 0;
                    #102#5 = "10";
                    nImpDed = sub85pre;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI sub85dis > 0;
                    #102#5 = "11";
                    nImpDed = sub85dis;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI reducc > 0;
                    #102#5 = "06";
                    nImpDed = reducc;
                    || Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    Alfa1 = "";
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI reduc0502 > 0;
                    #102#5 = "18";
                    nImpDed = reduc0502;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI nBonPFEAlta > 0;
                    #102#5 = "22";
                    nImpDed = nBonPFEAlta;
                    |HAZ BuscaFechaBon;
                    Alfa1 = Alfa1 % 102 + Alfa1 % 402 + Alfa1 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI bon_60 > 0;
                    |SI nImpDed ! 0;        || esto quiere decir que tengo bonif
                         swDobleBonif = 1;   || de >60 a¤os ademas de otra, activo
                    |SINO;                  || este switch para que en la siguiente
                         #102#5 = "16";      || vuelta me entre (base 42)
                         nImpDed = bon_60;
                         |HAZ fecha_bon_16;
                         Alfa1 = fecha_bon_16;
                         Alfa1 = Alfa1 % 102 + Alfa1 % 402 + Alfa1 % -102;
                         #102#15 = Alfa1;
                         nDias = dias;
                         swDobleBonif = 2;   || pa que no me la pinte mas veces,
                    |FINSI;                 || si no en baja me la pintaba
               |FINSI;                     || otra vez
               |SI #7#83 > 0;
                    |SI #7#83 = 21; |O #7#47 = "A";
                         #102#5 = "26";
                         nImpDed = #7#83;
                    |SINO;
                         #102#5 = "27";
                         nImpDed = #7#83;
                    |FINSI;
                    |SI #7#47 = "A"; |O #7#47 = "e";
                         nDias = #7#20;
                    |SINO;
                         nDias = #7#20;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI nume2 = 42; |Y swDobleBonif = 1;
               |SI bon_60 > 0;
                    #102#5 = "16";
                    nImpDed = bon_60;
                    |HAZ fecha_bon_16;
                    Alfa1 = fecha_bon_16;
                    Alfa1 = Alfa1 % 102 + Alfa1 % 402 + Alfa1 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
                    swDobleBonif = 2;   || pa que no me la pinte mas veces
               |FINSI;
               |SI bonifi > 0;
                    #102#5 = "07";
                    nImpDed = bonifi;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
                    swDobleBonif = 2;
               |FINSI;
          |FINSI;

            ||SI #102#4 = aUltimo;
          |SI nume2 = 32; |O nume2 = 33;
          ||SI sw_base = 8;
               dias = #7#33;
               |SI bonifib > 0;
                    #102#5 = "07";
                    nImpDed = bonifib;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI reduccb > 0;
                    #102#5 = "06";
                    nImpDed = reduccb;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI reduc0502b > 0;
                    #102#5 = "18";
                    nImpDed = reduc0502b;
                    Alfa1 = #5#40 % 102 + #5#40 % 402 + #5#40 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
               |SI nBonPFEBaja > 0;
                    #102#5 = "22";
                    nImpDed = nBonPFEBaja;
                    |HAZ BuscaFechaBon;
                    Alfa1 = Alfa1 % 102 + Alfa1 % 402 + Alfa1 % -102;
                    #102#15 = Alfa1;
                    nDias = dias;
               |FINSI;
          |FINSI;
     ||FINSI;

     nJornadasG = 0;      || Pongo a cero las variables que guardaran las
     nDiasG = 0;          || cantidades ya guardadas con la misma clave
     nImpBaseG = 0;       || por si hubiera un trabajador de baja/alta en
     nImpDedG = 0;       || el mismo mes

     |SI nImpBase > 0;                   || graba si hay algo en la base
          |LEE 000#102=;
          FEstado = FSalida;
          |SI FSalida = 0;
               nJornadasG = #102#9;
               nDiasG = #102#13;
               nImpBaseG = #102#10;
               nImpDedG = #102#14;
               |SI swTraba = 0;           || esto es para que cuando llegue al
                    nTraba = nTraba + 1;  || contador del nor. Trab. en la Impresion
                    swTraba = 1;          || del TC2/8 sepa que hay alguno que tiene
                    #101#11 = nTraba;     || mas de un movimiento y lo tenga en
                    |GRABA 000#101a;      || cuenta
               |FINSI;
          |FINSI;

          nJornadas = nJornadas + nJornadasG;
          nDias = nDias + nDiasG;
          nImpBase = nImpBase + nImpBaseG;
          nImpDed = nImpDed + nImpDedG;

          #102#9 = nJornadas;
          #102#13 = nDias;
          #102#10 = nImpBase;
          #102#14 = nImpDed;
          |SI #5#112 = "S";
               #102#11 = "8";
          |FINSI;

          |SI FEstado ! 0;
               |GRABA 000#102n;
          |SINO;
               |GRABA 000#102a;
          |FINSI;
          |SI FSalida ! 0;
               |SI FSalida = 100;
                    aAlfa1 = "0000EDLBA: Duplicado ["+#102#16+"."+#102#0+"."+#102#1+"."+#102#2+"."+#102#3+"."+#102#4+"."+#102#5+"]";
               |SINO;
                    aAlfa1 = "0000EDLBA: Segmento ["+#102#16+"."+#102#0+"."+#102#1+"."+#102#2+"."+#102#3+"."+#102#4+"."+#102#5+"]";
               |FINSI;
               |MENAV aAlfa1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO graba_temporal;

|| ______________________ TC2/8 -- CABECERA _________________________
     |DDEFECTO #101;

     aNAFSS_Emp = #7#8 + #7#9 + #7#10;
     |QBT aNAFSS_Emp;
     #101#0 = aNAFSS_Emp;                || Codigo Cuenta Cotizacion
     |LEE 000#101=;

     |SI FSalida ! 0;
          #101#1 = #7#1;                 || Nombre Empresa
          #101#2 = #7#4;                 || Domicilio
          #101#5 = #7#6;                 || Localidad
          aCod_Postal = #7#5;            || Codigo Postal
          aCod_prov = aCod_Postal % A102;   || Cod. Provincia
          aCod_pob = #7#5 % A303;           || Cod. Poblacion
          #101#6 = aCod_prov;
          #101#7 = aCod_pob;
          |HAZ provincia;                || Provincia
          #101#9 = clave_IE;             || Clave Identif. Empresario
          #101#10 = #7#7;                || C.I.F.
          |HAZ fecha;
          |HAZ calif_liq;
          #101#12 = aTipo_Liq;
          |GRABA 020#101n;
     |FINSI;

|| ________________________TC2/8 -- LINEAS__________________________

     #5#0 = #7#0;
     #5#1 = #7#39;
     |LEE 000#5=;

     nCConst = #5#248;
     |HAZ constante;

     |HAZ clave_base;
     sw_base = 0;
     nTraba = 0;
     swTraba = 0;
     swDobleBonif = 0;
     |PARA i = 1; |SI i [ 8; |HACIENDO i = i + 1;      ||toc
          |SI i = 5; |O i = 6;
               |PARA j = 1; |SI j [ 3; |HACIENDO j = j + 1;
                    |HAZ LineaBase;
               |SIGUE;
          |SINO;
               j = 1;
               |HAZ LineaBase;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE tc28;
#7#3;
;
    0, "A",   0,   0, bot3,     0,  0;
99999, "Z", 999, 999, top3, 99999, 99;
;
NULL, graba_temporal;
|FIN;

|PROCESO temporales;
     alfa1 = Usuario;  |QBF alfa1;    alfa1 = "c" + alfa1;
     |NOME_DAT #101 alfa1;
     |DELINDEX #101;   || Se carga el temporal que pudiera existir

     alfa1 = Usuario;  |QBF alfa1;    alfa1 = "l" + alfa1;
     |NOME_DAT #102 alfa1;
     |DELINDEX #102;   || Se carga el temporal que pudiera existir

     |ABRE #5;       || trabajadores
     |ABRE #12;      || provincias
     |ABRET #101;    || nomtc203 -> tc2 cabecera
     |ABRET #102;    || nomtc204 -> tc2 lineas
     |ABRE #8;       || bonificaciones
     |BUCLE tc28;
     |CIERRA #8;
     |CIERRA #12;
     |CIERRA #5;
     |CIERRAT #101;
     |CIERRAT #102;

     |IMPRE 0;
     |SI FSalida = 0;
          |HAZ MiraSiHay;
          |SI nSwSiHay = 1;
               |SI #0#11 = "B";
                    eaTitBorra = "Carga Inicial.";
                    |HAZ Borrador;
               |FINSI;
               |HAZ CuentaHojas;
               |HAZ CuentaTrabajadores;
               |SI #0#11 = "B";
                    eaTitBorra = "Carga Definitiva.";
                    |HAZ Borrador;
                    |FINIMP;
               |SINO;
                    |HAZ ImprimeTC2;
               |FINSI;
          |SINO;
               |MENAV "0000Seleccion vacia ...";
          |FINSI;
     |SINO;
          |MENAV "    Proceso abortado ...";
     |FINSI;
     |DELINDEX #101;          || TC2 cabs.
     |DELINDEX #102;          || TC2 lins.
|FPRC

|PROCESO topes_cp;
     sw_tope = sw_tope + 1;        || en alta: sw_tope=1; en baja: sw_tope=2
     |SI nBase_cp = 0;             || en vacaciones: sw_tope = 3
          |ACABA;                  || solo topeo si tengo algo en la base
     |FINSI;
     grupo = #labtraba#33;
     |SI #7#47 = "E";              || eventuales calculan los topes por
          |SI sw_tope = 1;         || jornadas reales, no por dias trabajados
               dias_tope = #7#24;
          |FINSI;
          |SI sw_tope = 2;         || Jornadas en Baja
               dias_tope = #7#63;
          |FINSI;
          |SI sw_tope = 3;         || Dias en Vacaciones
               dias_tope = #7#65;
          |FINSI;
     |SINO;
          |SI sw_tope = 1;         || Dias en Alta
               dias_tope = #7#20 - #7#33 - #7#65;
          |FINSI;
          |SI sw_tope = 2;         || Dias en Baja
               dias_tope = #7#33;
          |FINSI;
          |SI sw_tope = 3;         || Dias en Vacaciones
               dias_tope = #7#65;
          |FINSI;
     |FINSI;
     |SI dias_tope > 30; dias_tope = 30; |FINSI;
     nMax_cp = #nomconst#20 * dias_tope;                     || maximo A.T.
     |SI grupo = 12; nMin_cp = #nomconst#22 * dias_tope; |FINSI;    || minimo A.T.
     |SI grupo = 11; nMin_cp = #nomconst#21 * dias_tope; |FINSI;
     |SI grupo < 11; nMin_cp = #nomconst#23 * dias_tope; |FINSI;
     |SI nMax_cp [ nBase_cp; |Y nMax_cp > 0;
          nBase_cp = nMax_cp;      || topeo maximo
          #7#84 = #nomconst#20;
     |FINSI;
     |SI nMin_cp ] nBase_cp; |Y nMin_cp > 0;
          nBase_cp = nMin_cp;      || topeo minimo
          #7#84 = #nomconst#23;
     |FINSI;
|FPRC;

|PROCESO const_trab;          || busca la cte del trabajador si la hay
     |ABRE #nomtraca;         || ya existe el busca_const pero no quiero
     #nomtraca#0 = #1#0;      || problemas de abrir y cerrar ficheros otra vez
     #nomtraca#1 = #6#1;
     |LEE 000#nomtraca.=;
     |SI FSalida = 0;
          #nomconst#0 = #nomtraca#3;
          |LEE 000#nomconst.=;
     |FINSI;
     |CIERRA #nomtraca;
     FSalida = 0;
|FPRC;

|PROCESO mes;     || CALCULA MES LITERAL
|SI #0#2 = 1;  #7#11 = "Enero     "; |FINSI;
|SI #0#2 = 2;  #7#11 = "Febrero   "; |FINSI;
|SI #0#2 = 3;  #7#11 = "Marzo     "; |FINSI;
|SI #0#2 = 4;  #7#11 = "Abril     "; |FINSI;
|SI #0#2 = 5;  #7#11 = "Mayo      "; |FINSI;
|SI #0#2 = 6;  #7#11 = "Junio     "; |FINSI;
|SI #0#2 = 7;  #7#11 = "Julio     "; |FINSI;
|SI #0#2 = 8;  #7#11 = "Agosto    "; |FINSI;
|SI #0#2 = 9;  #7#11 = "Septiembre"; |FINSI;
|SI #0#2 = 10; #7#11 = "Octubre   "; |FINSI;
|SI #0#2 = 11; #7#11 = "Noviembre "; |FINSI;
|SI #0#2 = 12; #7#11 = "Diciembre "; |FINSI;
|FPRC;

|PROCESO fecha_bon_16;
     |SI #labtraba#212 = 2;
          aFechaRef = #labtraba#36;       || fecha de referencia: fecha de Alta
     |SINO;
          aFechaRef = #labtraba#34;       || fecha de referencia: fecha de Antiguedad
     |FINSI;
     alfa1 = #labtraba#11; |QBF alfa1;    || compruebo que exista fecha nacimiento
     alfa2 = aFechaRef; |QBF alfa2;    || compruebo que exista fecha de refer.
     |SI alfa1 = ""; |O alfa2 = ""; |O alfa1 = ".........."; |O alfa2 = "..........";
          |ACABA;
     |FINSI;

     alfa1 = #labtraba#11 % -104;        || anyo nacimiento
     alfa2 = #labtraba#11 % -602;        || mes nacimiento
     alfa5 = #labtraba#11 % 102;         || dia nacimiento
     alfa3 = aFechaRef % -104;        || anyo Fecha Referencia
     alfa4 = aFechaRef % -602;        || mes Fecha Referencia
     alfa6 = aFechaRef % 102;         || dia Fecha Referencia
     nume1 = alfa1;
     nume1 = alfa1 + 60;           || a¤o que cumple 60 a¤os
     alfa1 = nume1;
     nume3 = alfa3;                || a¤o que cumple 5 a¤os antiguedad
     nume3 = alfa3 + 5;
     alfa3 = nume3;
     nume2 = alfa2;                || mes edad
     nume4 = alfa4;                || mes antiguedad
     nume5 = alfa5;                || dia edad
     nume6 = alfa6;                || dia antiguedad

     nAnyoBase = #nomcontr#38;
     |SI nAnyoBase = 0;
          nAnyoBase = 2003;
     |FINSI;
     aAnyoBase = nAnyoBase;

     |SI nume1 > nume3;            || cuando cumple 60 a¤os
          |SI nume1 < nAnyoBase;
               fecha_bon_16 = "01.01." + aAnyoBase;
          |SINO;
               fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
          |FINSI;
     |FINSI;
     |SI nume1 < nume3;            || cuando cumple antiguedad
          |SI nume3 < nAnyoBase;
               fecha_bon_16 = "01.01." + aAnyoBase;
          |SINO;
               fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
          |FINSI;
     |FINSI;
     |SI nume1 = nume3;            || mismo a¤o: comprobamos meses
          |SI nume2 > nume4;            || cuando cumple 60 a¤os
               |SI nume1 < nAnyoBase;
                    fecha_bon_16 = "01.01." + aAnyoBase;
               |SINO;
                    fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
               |FINSI;
          |FINSI;
          |SI nume2 < nume4;            || cuando cumple antiguedad
               |SI nume3 < nAnyoBase;
                    fecha_bon_16 = "01.01." + aAnyoBase;
               |SINO;
                    fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
               |FINSI;
          |FINSI;
          |SI nume2 = nume4;       || antiguedad y 60 a¤os en = a¤o, =mes
               |SI nume5 > nume6;            || cuando cumple 60 a¤os
                    |SI nume1 < nAnyoBase;
                         fecha_bon_16 = "01.01." + aAnyoBase;
                    |SINO;
                         fecha_bon_16 = alfa5 + "." + alfa2 + "." + alfa1;
                    |FINSI;
               |FINSI;
               |SI nume5 < nume6;            || cuando cumple antiguedad
                    |SI nume3 < nAnyoBase;
                         fecha_bon_16 = "01.01." + aAnyoBase;
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
               |SI nume5 = nume6;
                    |SI nume3 [ nAnyoBase;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + aAnyoBase;
                    |SINO;
                         fecha_bon_16 = alfa6 + "." + alfa4 + "." + alfa3;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO mesTC2;     || CALCULA MES LITERAL
    bisiesto = #0#3 $ 4;
|SI bisiesto = 0;  bisiesto = 1;  |FINSI;
|SI bisiesto ! 0;  bisiesto = 0;  |FINSI;
|SI #0#2 = 1;  #7#11 = "Enero     ";  guarda = 31;  f_mes = "31.01."; |FINSI;
|SI #0#2 = 2;  #7#11 = "Febrero   ";  guarda = 28 + bisiesto;
     |SI bisiesto = 0;
          f_mes = "28.02.";
     |SINO;
          f_mes = "29.02.";
     |FINSI;
|FINSI;
|SI #0#2 = 3;  #7#11 = "Marzo     ";  guarda = 31;  f_mes = "31.03."; |FINSI;
|SI #0#2 = 4;  #7#11 = "Abril     ";  guarda = 30;  f_mes = "30.04."; |FINSI;
|SI #0#2 = 5;  #7#11 = "Mayo      ";  guarda = 31;  f_mes = "31.05."; |FINSI;
|SI #0#2 = 6;  #7#11 = "Junio     ";  guarda = 30;  f_mes = "30.06."; |FINSI;
|SI #0#2 = 7;  #7#11 = "Julio     ";  guarda = 31;  f_mes = "31.07."; |FINSI;
|SI #0#2 = 8;  #7#11 = "Agosto    ";  guarda = 31;  f_mes = "31.08."; |FINSI;
|SI #0#2 = 9;  #7#11 = "Septiembre";  guarda = 30;  f_mes = "30.09."; |FINSI;
|SI #0#2 = 10; #7#11 = "Octubre   ";  guarda = 31;  f_mes = "31.10."; |FINSI;
|SI #0#2 = 11; #7#11 = "Noviembre ";  guarda = 30;  f_mes = "30.11."; |FINSI;
|SI #0#2 = 12; #7#11 = "Diciembre ";  guarda = 31;  f_mes = "31.12."; |FINSI;
|FPRC;

____________________________________/ TRANSFORMACION CONTRATOS
|PROCESO CodigosNuevos;
     aContrato = #5#45;
     |QBF aContrato;
     aContrato = ("000" + aContrato) % -103;
     |ABRE #nomequiv;
     #nomequiv#0 = aContrato;
     |LEE 000#nomequiv.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "X";|O #labtraba#42 = "T";|O #labtraba#42 = "P";
               aContrato = #nomequiv#2;      || tiempo parcial
          |SINO;
               aContrato = #nomequiv#1;      || tiempo completo
          |FINSI;
     |FINSI;
     |CIERRA #nomequiv;
     nContrato = aContrato;
|FPRC;

|PROCESO datos_trab;
    nume1 = 0;
    nCotJor = 0;
    #5#0 = #7#0;
    #5#1 = #7#39;
    |LEE 000#5=;
    |HAZ CodigosNuevos;
|FPRC;

|PROCESO BaseCot;
     alfa1 = "01";
     alfa2 = #0#2;  alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
     alfa3 = #0#3;
     alfa4 = alfa1 + "." + alfa2 + "." + alfa3;

     fCFechaCot = alfa4;         || primer dia de mes de calculo
     aCErrorCot = "";            || inicializo errores
     |HAZ LeeCotAgr;
     |SI aCErrorCot ! "";
          |MENAV aCErrorCot;
     |SINO;
          nume1 = #labtraba#33;
          nCotJor = #gomcotiz#nume1#;
     |FINSI;
|FPRC;

|PROCESO fecha;                    ||  Construye periodo de liquidacion
    nFecha = #0#2 * 10000;
    nFecha = nFecha + #0#3;
    aPerinf = nFecha;
    aPerinf = (000000 + aPerinf) % -106;
|FPRC;

|PROCESO clave_base;
     nCod_base = 0;
     aCod_base = "";
     |SI #7#25 > 0;
          |SI #7#47 ! "E";
               nCod_base = nCod_base + 10000000;  || clave 01: Cont. Com. Fijos
                                                  || clave 41: idem sin desemp.
          |SINO;
               nCod_base = nCod_base + 01000000;  || clave 30: Cont. Com. No Fijos
                                                  || clave 37: idem sin desemp.
          |FINSI;
     |FINSI;

     ||SI #7#70 > 0;
     ||     nCod_base = nCod_base + 00100000;  || clave 35: Base Cont. Ext. Even.
     ||FINSI;

     |SI #7#27 > 0;
          nCod_base = nCod_base + 00010000;  || clave 02: Cont. Prof. Alta
     |FINSI;
     ||SI #7#37 > 0;
          |SI #7#47 ! "E";
               nCod_base = nCod_base + 00001000;  || clave 21: base ILT fijos paga SS
                                                  || clave 23: base ILT fijos paga Emp
                                                  || clave 38: base ILT fijos exc. des.
          |SINO;
               nCod_base = nCod_base + 00000100;  || clave 32: base ILT no fijos paga SS.
                                                  || clave 36: base ILT no fijos paga emp.
                                                  || clave 38: base ILT no fijos exc. des.
          |FINSI;
     ||FINSI;
     |SI #7#37 > 0;
          nCod_base = nCod_base + 00000010;   || clave 02: AT/EP en IT
     |FINSI;                                  || uso la 22 de momento

/*
     |SI #7#65 > 0;
          nCod_base = nCod_base + 00000001;  || clave 34: Cotizacion a C.P.
     |FINSI;                                   || en vacaciones (dias_vac > 0)
*/
     aCod_base = nCod_base;
     aCod_base = ("00000000" + aCod_base) % -108;

     |HAZ ultimo;
|FPRC;

|PROCESO ultimo;
    Alfa1 = aCod_base % -101;
    |SI Alfa1 = "1";
        aUltimo = "34";
    |SINO;
        Alfa1 = aCod_base % -201;
        |SI Alfa1 = "1";
            aUltimo = "22";  || la 22 es la base de AT/EP en baja, despues la paso a
        |SINO;               || 02, lo de 22 es para distinguirla
            Alfa1 = aCod_base % -301;
            |SI Alfa1 = "1";
                aUltimo = "33";
            |SINO;
                Alfa1 = aCod_base % -401;
                |SI Alfa1 = "1";
                    aUltimo = "32";
                |SINO;
                    Alfa1 = aCod_base % -501;
                    |SI Alfa1 = "1";
                        aUltimo = "02";
                    |SINO;
                        Alfa1 = aCod_base % -601;
                        |SI Alfa1 = "1";
                            aUltimo = "35";
                        |SINO;
                           Alfa1 = aCod_base % -701;
                           |SI Alfa1 = "1";
                               aUltimo = "31";
                           |SINO;
                               Alfa1 = aCod_base % -801;
                               |SI Alfa1 = "1";
                                   aUltimo = "30";
                               |FINSI;
                           |FINSI;
                       |FINSI;
                   |FINSI;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO lee_bonif;
|DDEFECTO #8;
|HAZ datos_trab;
    #8#0 = #5#39;
|LEE 000#8=;
|SI FSalida = 0;
     nMes = #0#2;
     nAny = #0#3;
     nCodigoBon = #8#0;
     |HAZ VerifBonif;
|FINSI;
|FPRC;

|PROCESO AjustaPFE;
     nAjustePFE = 0;
     nDiasMes = 0;

     nDiasAlta = (#7#20 ! 0) - (#7#43 + #7#44 + #7#49);   || dias alta
     nDiasIT = #7#43 + #7#44;
     nDiasMate = #7#49;

     nDiasMes = nDiasAlta + nDiasIT + nDiasMate;

     |SI nDiasMes > 30;
          nAjustePFE = 1;
     |FINSI;
     |SI nDiasMes ] 28; |Y #0#2 = 2;
          |SI nDiasMes = 28;
               nAjustePFE = -2;
          |FINSI;
          |SI nDiasMes = 29;
               nAjustePFE = -1;
          |FINSI;
     |FINSI;

     nBase = #7#73;

     nDias = nDiasAlta;

     |SI nDias > 0; |Y nDiasMate = 0; |Y nDiasIT = 0;
     |Y nAjustePFE ! 0;
          nDias = nDias - nAjustePFE;
     |FINSI;

     nBonPFEAlta = (((nBase / nDiasMes) ! 2) * nDias) ! 2;

     nDias = nDiasIT + nDiasMate;

     |SI nDias > 0; |Y nAjustePFE ! 0;
          nDias = nDias - nAjustePFE;
     |FINSI;

     |SI nDias > 0;
          nBonPFEBaja = nBase - nBonPFEAlta;
     |SINO;
          nBonPFEAlta = nBase;
          || aseguro el redondeo correcto
     |FINSI;
|FPRC;

|PROCESO calcula_bonif;  || ATENCION: TODOS LOS CAMBIOS QUE SE HAGAN EN LAS
     bonifi = 0;          || BONIFICACIONES DE LOS AGRARIOS HABRA QUE COPIARLOS
     bonifib = 0;
     reducc = 0;          || EN EL PROCESO calcula_bonif DEL silcon16 DE LOS
     reduccb = 0;
     subven = 0;          || AGRARIOS PARA QUE SALGA BIEN EN EL LOTE
     sub85pre = 0;        || ¨¨¨ A QUE YA NO TE ACORDABAS ???
     sub85dis = 0;
     reduc0502 = 0;
     reduc0502b = 0;
     bon_60 = 0;         || bonificacion mayores de 60 a¤os
     nAjustePFE = 0;
     nDias = 0;
     nDiasMes = 0;
     nDiasAlta = 0;
     nDiasIT = 0;
     nDiasMate = 0;
     nBase = 0;
     nBonPFEAlta = 0;
     nBonPFEBaja = 0;
     nBonifERE = 0;

     |SI #7#48 < 10;
          |ABRE #6;
          #6#0 = #7#0;
          #6#1 = #7#39;
          #6#2 = #0#2;
          #6#3 = #7#48;
          |SI runnom = "gomwwtc2";
               nNume2 = #0#3 - 2000;
               #6#66 = nNume2;
               nNume1 = 123;
               nNume3 = 148;
          |FINSI;
          |SI runnom = "gomyytc2"; |O runnom = "gomsstc2";
               nNume1 = 81;
               nNume3 = 106;
          |FINSI;
          |SI runnom = "gomsstc2";
               nNume1 = 81;
               nNume3 = 99;
          |FINSI;
          |LEE 000#6=;                 || lee calculos cabs.
          |SI FSalida = 0;
               |SI #6#63 ! 0;|O #6#64 ! 0;|O #6nNume1 ! 0; |O #6nNume3 ! 0;  || si tiene bonificacion
                    |HAZ lee_bonif;                          || lee la bonificacion
                    |SI #5#39 ! 0;
                         aClaveTGSS = #8#13;
                         |QBF aClaveTGSS;
                         aClaveTGSS = "000" + aClaveTGSS;
                         aClaveTGSS = aClaveTGSS % -103;
                         |SI #8#10 = 1;
                              |SI aClaveTGSS ! "018";
                                   reducc = #6#63 + #6nNume1 - #6#56;  || parte en alta
                                   || reduccb = #6#56 + #6nNume1;  || parte en baja
                                   reduccb = #6#56;  || parte en baja
                              |SINO;
                                   reduc0502 = #6#63 - #6#56;    || parte en alta
                                   reduc0502b = #6#56;           || parte en baja
                              |FINSI;
                         |FINSI;
                         |SI #8#10 = 2;
                              bonifi = #6#63 + #6nNume1 - #6#56;
                              || bonifib = #6#56 + #6nNume1; || la parte de bon.
                              bonifib = #6#56;    || doble solo una vez, en baja
                         |FINSI;                  || no la estamos calculando
                         |SI #8#10 = 3;
                              reducc = #6#63 + #6nNume1 - #6#56;
                              || reduccb = #6#56 + #6nNume1;
                              reduccb = #6#56;
                         |FINSI;
                         |SI #8#10 = 4;
                              reducc = #6#63 + #6nNume1 - #6#56;
                              || reduccb = #6#56 + #6nNume1;
                              reduccb = #6#56;
                         |FINSI;
                         |SI #6#9 = 85;|O #6#9 = 97;   || formacion teorica
                              |SI #8#12 > 2.4;           || precio hora
                                   sub85pre = #6#64;
                              |SINO;
                                   sub85dis = #6#64;
                              |FINSI;
                         |SINO;
                              subven = #6#64;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI runnom = "gomyytc2"; nume1 = 88;    |FINSI;
               |SI runnom = "gomsstc2"; nume1 = 88;    |FINSI;
               |SI runnom = "gomwwtc2"; nume1 = 130;   |FINSI;
               |SI #6nume1 ! 0;      || mayores de 60 a¤os y 5 de antiguedad
                    bon_60 = #6nume1;
               |FINSI;
               |SI #6nNume3 ! 0;      || mayores de 59 a¤os y 4 de antiguedad
                    reducc = reducc + #6nNume3;
               |FINSI;

               |SI #7#73 > 0;
                    |HAZ AjustaPFE;

                    bonifi = bonifi + #7#73;
               |FINSI;

               |SI #7#83 ! 0;
                    reducc = reducc + #7#83;
               |FINSI;
               nBonifERE = #7#88;
          |FINSI;
          |CIERRA #6;
     |SINO;
          |MENAV "0000Inconsistencia. Exp.Regul.Empleo Agrarios.";
     |FINSI;
|FPRC;

|PROCESO clave_IE;
            alfa1 = #1#10 % 101; || tipo identificador titular
        |SI alfa1 ] "0";|Y alfa1 [ "9";
                clave_IE = "1";            || tipo identificacion DNI
        |SINO;
            |SI alfa1 = "X";
                    clave_IE = "6";        || tipo identificacion EXTRANJERO
            |SINO;
                |SI alfa1 ] "a";|Y alfa1 [ "z";
                        clave_IE = "2";    || tipo identificacion PASAPORTE
                |SINO;
                        clave_IE = "9";    || tipo identificacion CIF
                |FINSI;
            |FINSI;
        |FINSI;
|FPRC;

|PROCESO clave_IPF;
    alfa1 = #7#18 % 101; || tipo identificador titular
    clave_IPF = "1"
    |SI alfa1 ] "A";|Y alfa1 [ "z";
        |SI alfa1 = "X";
            clave_IPF = "6";                  || tipo identif. (EXTRANJERO)
        |SINO;
            clave_IPF = "2";                  || tipo identif. (PASAPORTE)
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO sep_nombre;
    alfa1 = #5#2;   |QBF alfa1;
    alfa2 = alfa1 % 0;   nPara2 = alfa2;
    sw1 = 0;
    aApell1 = "";
    aApell2 = "";
    aNombre = "";
|PARA nPara1 = 1; |SI nPara1 [ nPara2; |HACIENDO nPara1 = nPara1 + 1;
        nNume2 = (nPara1 * 100) + 1;
        alfa3 = alfa1 % nNume2;
    |SI alfa3 = " ";|O alfa3 = ",";
        |SI aApell1 ! "";
                sw1 = sw1 + 1;
        |FINSI;
        |SI sw1 ] 2;|Y aNombre ! "";
                aNombre = aNombre + alfa3;
        |FINSI;
    |SINO;
        |SI sw1 = 0;  aApell1 = aApell1 + alfa3; |FINSI;
        |SI sw1 = 1;  aApell2 = aApell2 + alfa3; |FINSI;
        |SI sw1 ] 2;  aNombre = aNombre + alfa3; |FINSI;
    |FINSI;
|SIGUE;
    aAbreviado = (aApell1 % 102) + (aApell2 % 102) + (aNombre % 101);
    aAbreviado = aAbreviado > aAbreviado;
|FPRC;

|PROCESO provincia;
    #12#0 = #101#6;
    |LEE 000#12=;
    |SI FSalida = 0;
        #101#8 = #12#1;
    |SINO;
        #101#8 = "";
    |FINSI;
|FPRC;

|PROCESO calif_liq; |TIPO 7;
|SI #0#7 = "L00";  aTipo_Liq = "000";  |FINSI;
|SI #0#7 = "L02";  aTipo_Liq = "002";  |FINSI;
|SI #0#7 = "L03";  aTipo_Liq = "004";  |FINSI;
|SI #0#7 = "L04";  aTipo_Liq = "003";  |FINSI;
|SI #0#7 = "L07";  aTipo_Liq = "007";  |FINSI;
|SI #0#7 = "L09";  aTipo_Liq = "009";  |FINSI;
|SI #0#7 = "L10";  aTipo_Liq = "010";  |FINSI;
|SI #0#7 = "L11";  aTipo_Liq = "011";  |FINSI;
|FPRC;

|PROCESO CalculaFechaTC2;
     |SI #6#27 = aTipILT; m_des = #6#19;    m_has = #6#23; |FINSI;
     |SI #6#28 = aTipILT; m_des = #6#20;    m_has = #6#24; |FINSI;
     |SI #6#29 = aTipILT; m_des = #6#21;    m_has = #6#25; |FINSI;
     |SI #6#30 = aTipILT; m_des = #6#22;    m_has = #6#26; |FINSI;

     |SI m_des ! 0;
             alfa1 = m_des;   alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
             alfa2 = #6#2;    alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
             m_fec = alfa1 + "." + alfa2 + "." + anyonum;
     |SINO;
         |SI m_has ! 0;
                 alfa1 = m_has;   alfa1 = "00" + alfa1;    alfa1 = alfa1 % -102;
                 alfa2 = #6#2;    alfa2 = "00" + alfa2;    alfa2 = alfa2 % -102;
                 m_top = alfa1 + "." + alfa2 + "." + anyonum;
         |SINO;
                 m_top = f_mes + anyonum;
         |FINSI;
             fech1 = m_top;   nume1 = fech1;
             nume1 = nume1 - nTotILT + 1;
             fech1 = nume1;
             m_fec = fech1;
     |FINSI;
     m_fec = (m_fec % 102) + (m_fec % 402) + (m_fec % -102);
|FPRC;

|PROCESO FechasInicioTC2;
     |SI s_ori = "A";|O s_ori = "T";         || en atrasos no se puede
          |ACABA;                            ||/calcular la fecha inicio ILT
     |FINSI;

     nTotEnf = 0;
     nTotMat = 0;
     nTotAcc = 0;

     |SI s_ori = "M";
          |SI #5#60 = "E";    nTotEnf = #5#89;    |FINSI;
          |SI #5#60 = "M";    nTotMat = #5#89;    |FINSI;
                              nTotAcc = #5#92;
     |FINSI;

     anyonum = #0#3;
     |HAZ mesTC2;

/*     |SI s_ori = "H";
          |ABRE #200;
          #200#0 = #6#0;
          #200#1 = #6#1;
          #200#66= any_hist;
          #200#2 = #6#2;
          #200#3 = #6#3;
          |LEE 000#200=;
          |SI FSalida = 0;
               |SI #200#68 = "E";    nTotEnf = #200#70;    |FINSI;
               |SI #200#68 = "M";    nTotMat = #200#70;    |FINSI;
                                     nTotAcc = #200#73;
          |FINSI;
          |CIERRA #200;
     |FINSI;
*/
     nTotEnf = nTotEnf + #7#43;
     nTotMat = nTotMat + #7#49;
     nTotAcc = nTotAcc + #7#44;

     |SI nTotEnf ! 0;
          nTotILT = nTotEnf;
          aTipILT = "E";
          |HAZ CalculaFechaTC2;
          #7#56 = m_fec;
     |FINSI;
     |SI nTotAcc ! 0;
          nTotILT = nTotAcc;
          aTipILT = "A";
          |HAZ CalculaFechaTC2;
          #7#57 = m_fec;
     |FINSI;
     |SI nTotMat ! 0;
          nTotILT = nTotMat;
          aTipILT = "M";
          |HAZ CalculaFechaTC2;
          #7#58 = m_fec;
     |FINSI;
|FPRC;

||    ************* PROCESOS APA¤ADOS DEL nomtc200 **************
||    *************    PARA IMPRESION DEL TC2/8    **************
____________________________________/ IMPRESION TC2 DESDE TEMPORAL
|PROCESO &Totaliza;

     |SI nSwVacia4 = 1;  #102#4 = aBas;   |FINSI;
     |SI nSwVacia5 = 1;  #102#5 = aDed;   |FINSI;
     |SI nSwVacia10= 1;  #102#10 = nImp;  |FINSI;
     |SI nSwVacia14= 1;  #102#14 = nDed;  |FINSI;

     |SI #102#4 = "01"; |O #102#4 = "41"; |O #102#4 = "30"; |O #102#4 = "37";
          enB30 = enB30 + #102#10;
     |FINSI;
/*
     |SI #102#4 = "31";
          enB31 = enB31 + #102#10;
     |FINSI;
*/
     |SI #102#4 = "02"; |O #102#4 = "34"
          enB02 = enB02 + #102#10;
     |FINSI;
     |SI #102#4 = "21"; |O #102#4 = "23"; |O #102#4 = "32";
     |O #102#4 = "36"; |O #102#4 = "38";
          enB32 = enB32 + #102#10;
     |FINSI;

     |SI #102#5 = "06"; |O #102#5 = "26"; |O #102#5 = "27";
           enD01 = enD01 + #102#14;
     |FINSI;
     |SI #102#5 = "07";|O #102#5 = "10";|O #102#5 = "11";|O #102#5 = "13";
       |O #102#5 = "18"; |O #102#5 = "16"; |O #102#5 = "22";
          enD02 = enD02 + #102#14;
     |FINSI;

     |SI nSwVacia4 = 1;  #102#4 = "";     |FINSI;
     |SI nSwVacia5 = 1;  #102#5 = "";     |FINSI;
     |SI nSwVacia10= 1;  #102#10 = 0;     |FINSI;
     |SI nSwVacia14= 1;  #102#14 = 0;     |FINSI;
|FPRC;

|PROCESO &Inicializa;
     |SI nLinea ! 1;
          nLinea = 0;
     |FINSI;
     enB30 = 0;
     enB31 = 0;
     enB02 = 0;
     enB32 = 0;
     enD01 = 0;
     enD02 = 0;
|FPRC;

|PROCESO SaltaPagina;
     |PIEINF;
     |FININF;
     enPagina = enPagina + 1;
     |INFOR "gomyytc2";
|FPRC;

|PROCESO nomtc202_1;
     |SELECT #2#labtraba;
     |DDEFECTO #labtraba;
     #labtraba#7 = #102#8;
     |LEE 000#labtraba.=;
     |SELECT #1#labtraba;

     |SI #102#4 = "42";       || esto es una pirula para que pinte la base 02
          #102#4 = "02";      || que previamente he grabado como 42 para que
     |FINSI;                  || salga despues de las 30,31,32,33 (Ene-2003)
     |SI #102#4 = "44";       || esto es la misma pirula para vacaciones
          #102#4 = "34";      || he grabado como 44 la 34 para que salga
     |FINSI;                  || despues de las 30,31,32,33,02 (Ago-2003)

     |SI #102#5 > "50";         || bonificaciones retroactivas
          aAlfa1 = #102#15;     aAlfa1 = aAlfa1 % 102;
          |SI aAlfa1 = "56";  #102#5 = "06";   |FINSI;
          |SI aAlfa1 = "57";  #102#5 = "07";   |FINSI;

          aAlfa2 = #102#15;     aAlfa2 = aAlfa2 % 3;
          aAlfa2 = "55" + aAlfa2;
          #102#15 = aAlfa2;
     |FINSI;

     |SI nSwOtroTC2 = 0;
          nSwOtroTC2 = 1;
          aCon = #102#0;
          nPer = #102#1;
          |HAZ Inicializa;
          |INFOR "gomyytc2";
     |FINSI;
     |SI aCon ! #102#0;         || salto de pagina en cada convenio
          |HAZ SaltaPagina;
          aCon = #102#0;
          nPer = #102#1;
          nLinea = 0;
     |SINO;
          |SI nPer ! #102#1;    || salto de pagina en cada periodo
               |HAZ SaltaPagina;
               nPer = #102#1;
               nLinea = 0;
          |FINSI;
     |FINSI;

     nLinea = nLinea + 1;
     |SI nLinea = 15;
          nLinea = 1;
     |FINSI;

     nSwVacia2 = 0; nSwVacia3 = 0; nSwVacia4 = 0; nSwVacia5 = 0;
     nSwVacia6 = 0; nSwVacia7 = 0; nSwVacia8 = 0; nSwVacia9 = 0;
     nSwVacia10= 0; nSwVacia11= 0; nSwVacia12= 0; nSwVacia13= 0;
     nSwVacia14= 0; nSwVacia15= 0;

     |SI nLinea ! 1;|Y aApe = #102#6;|Y aIde = #102#7;
                    |Y aNif = #102#8;|Y aNSS = #102#2;
          #102#6 = "";                         nSwVacia6 = 1;
          #102#7 = "";                         nSwVacia7 = 1;
          #102#8 = "";                         nSwVacia8 = 1;
          #102#2 = "";                         nSwVacia2 = 1;
          |SI aEpi = #102#3;    #102#3 = "";      nSwVacia3 = 1; |FINSI;
          |SI nCto = #102#12;   #102#12 = 0;     nSwVacia12= 1; |FINSI;
          |SI aBas = #102#4;    #102#4 = "";     nSwVacia4 = 1; |FINSI;
          |SI aDed = #102#5;    #102#5 = "";     nSwVacia5 = 1; |FINSI;
          |SI nDib = #102#9;    #102#9 = 0;      nSwVacia9 = 1; |FINSI;
          |SI nImp = #102#10;   #102#10 = 0;     nSwVacia10= 1; |FINSI;
          |SI aSit = #102#11;   #102#11 = "";    nSwVacia11= 1; |FINSI;
          |SI nDid = #102#13;   #102#13 = 0;     nSwVacia13= 1; |FINSI;
          |SI nDed = #102#14;   #102#14 = 0;     nSwVacia14= 1; |FINSI;
          |SI nFec = #102#15;   #102#15 = 0;     nSwVacia15= 1; |FINSI;
     |FINSI;

     |SI #102#4 = "01";
          aEpi = "";      || para que en la linea 01 no aparezca el epigrafe
          #102#3 = "";
     |FINSI;

     |PRINT;

     |SI nSwVacia2 = 0;  aNSS = #102#2;   |FINSI;
     |SI nSwVacia3 = 0;  aEpi = #102#3;   |FINSI;
     |SI nSwVacia12= 0;  nCto = #102#12;  |FINSI;
     |SI nSwVacia4 = 0;  aBas = #102#4;   |FINSI;
     |SI nSwVacia5 = 0;  aDed = #102#5;   |FINSI;
     |SI nSwVacia6 = 0;  aApe = #102#6;   |FINSI;
     |SI nSwVacia7 = 0;  aIde = #102#7;   |FINSI;
     |SI nSwVacia8 = 0;  aNif = #102#8;   |FINSI;
     |SI nSwVacia9 = 0;  nDib = #102#9;   |FINSI;
     |SI nSwVacia10= 0;  nImp = #102#10;  |FINSI;
     |SI nSwVacia11= 0;  aSit = #102#11;  |FINSI;
     |SI nSwVacia13= 0;  nDid = #102#13;  |FINSI;
     |SI nSwVacia14= 0;  nDed = #102#14;  |FINSI;
     |SI nSwVacia15= 0;  nFec = #102#15;  |FINSI;

|FPRC;

|DEFBUCLE nomtc202; || cta.cot.,convenio,periodo,CLAVE,NAFSS,epig,cto.,clave base,clave deduccion
 #102#1;
 ;
 #101#0,"       ",000000,"  ","            ","   ",000,"  ","  ";
 #101#0,"zzzzzzz",999999,"zz","zzzzzzzzzzzz","zzz",999,"zz","zz";
 ;
 NULL, nomtc202_1;
|FIN;

|PROCESO nomtc201_1;
     |INFOR "gomyytc2";
     |SI FSalida ! 0;
          |MENAV "0000Informe [gomyytc2] inaccesible o inexistente ...";
          |ERROR10;
          |ACABA;
     |FINSI;
     nSwOtroTC2 = 0;
     enPagina = 1;
     |BUCLE nomtc202;
     |SI nSwOtroTC2 = 1;
          |PIEINF;
          |FININF;
     |FINSI;
|FPRC;

|DEFBUCLE nomtc201;
 #101#1;
 ;
 "               ";
 "zzzzzzzzzzzzzzz";
 ;
 NULL, nomtc201_1;
|FIN;

|PROCESO ImprimeTC2;
     |BUCLE nomtc201;
|FPRC;

|PROCESO MiraSiHay;
     nSwSiHay = 0;
     |ABRE #102;
     |LEE 000#102p;
     |SI FSalida = 0;
          nSwSiHay = 1;
     |FINSI;
     |CIERRA #102;
|FPRC;

|PROCESO Temporal_1;
     |SI #102#4 = "42";  #102#4 = "02";      |FINSI;
     |SI aCta = "";
          aCta = #102#16;
     |FINSI;
     |SI aCta ! #102#16;
          enSwLin = 1;
          |PRINT;
          aCta = #102#16;
     |SINO;
          enSwLin = 0;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE Temporal;
 #102#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, Temporal_1;
|FIN;

|PROCESO Borrador;
     |INFOR "gomtc299";
     |BUCLE Temporal;
     |PIEINF;
     |FININF;
|FPRC;

____________________________________/ CONTADOR DE TRABAJADORES
|PROCESO GrabaTrabaja;
     #101#0 = aCta;
     |LEE 101#101=;
     |SI FSalida = 0;
          #101#11 = nTraba;
          |GRABA 020#101a;
     |FINSI;
     |LIBERA #101;
|FPRC;

|PROCESO TemporalTrabaja_1;
     |SI nSwOtroTC2 = 0;
          nSwOtroTC2 = 1;
          nTraba = #101#11;
          nTraba = nTraba + 1;
          aCta = #102#16;
          aNSS = #102#2;
     |FINSI;
     |SI aCta ! #102#16;
          |HAZ GrabaTrabaja;
          || nTraba = #101#11;
          nTraba = 0;
          nTraba = nTraba + 1;
          aCta = #102#16;
          aNSS = #102#2;
     |SINO;
          |SI aNSS ! #102#2;
               nTraba = nTraba + 1;
               aNSS = #102#2;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE TemporalTrabaja;
 #102#2;
 ;
 INICIO;
 FINAL;
 ;
 NULL, TemporalTrabaja_1;
|FIN;

|PROCESO CuentaTrabajadores;
     nSwOtroTC2 = 0;
     |ABRE #101;
     |BUCLE TemporalTrabaja;
     |HAZ GrabaTrabaja;
     |CIERRA #101;
|FPRC;
____________________________________/ CONTADOR DE HOJAS
|PROCESO GrabaHojas;
     #101#0 = aCta;
     |LEE 101#101=;
     |SI FSalida = 0;
          #101#13 = nHojas;
          |GRABA 020#101a;
     |FINSI;
     |LIBERA #101;
|FPRC;

|PROCESO TemporalCuenta_1;
     |SI nSwOtroTC2 = 0;
          nSwOtroTC2 = 1;
          nLinea = 0;
          nHojas = 1;
          aCta = #102#16;
          aCon = #102#0;
          nPer = #102#1;
     |FINSI;
     |SI aCta ! #102#16;
          |HAZ GrabaHojas;
          nLinea = 0;
          nHojas = 1;
          aCta = #102#16;
          aCon = #102#0;
          nPer = #102#1;
     |SINO;
          |SI aCon ! #102#0;         || salto de pagina en cada convenio
               nLinea = 0;
               nHojas = nHojas + 1;
               aCon = #102#0;
               nPer = #102#1;
          |SINO;
               |SI nPer ! #102#1;    || salto de pagina en cada periodo
                    nLinea = 0;
                    nHojas = nHojas + 1;
                    nPer = #102#1;
               |FINSI;
          |FINSI;
     |FINSI;

     nLinea = nLinea + 1;
     |SI nLinea = 15;
          nLinea = 1;
          nHojas = nHojas + 1;
     |FINSI;
|FPRC;

|DEFBUCLE TemporalCuenta;
 #102#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, TemporalCuenta_1;
|FIN;

|PROCESO CuentaHojas;
     nSwOtroTC2 = 0;
     |ABRE #101;
     |BUCLE TemporalCuenta;
     |HAZ GrabaHojas;
     |CIERRA #101;
|FPRC;


|PROCESO altabaja;    || CALCULA CLAVE DE ALTA/BAJA/EMPATE
    alfalta1 = #6#4 % 402;  numalta1 = alfalta1;  || mes alta
    alfalta2 = #6#4 % 704;  numalta2 = alfalta2;  || a¤o alta

    alfbaja1 = #6#5 % 402;  numbaja1 = alfbaja1;  || mes baja
    alfbaja2 = #6#5 % 704;  numbaja2 = alfbaja2;  || a¤o baja

    diaalfa1 = #6#4 % 102;  dianume1 = diaalfa1;  || dia alta
    diaalfa2 = #6#5 % 102;  dianume2 = diaalfa2;  || dia baja

|SI numalta1 = #0#2; |Y numalta2 = #0#3;
        #7#13 = "A";     || es alta
|FINSI;
|SI numbaja1 = #0#2; |Y numbaja2 = #0#3;
        #7#13 = "B";     || es baja
|FINSI;
|SI numalta1 = numbaja1; |Y numalta2 = #0#3; |Y numbaja2 = #0#3;
        #7#13 = "X";     || es alta y baja en el mismo mes y a¤o
|FINSI;
|FPRC;

|PROCESO enfersano;    || CALCULA CLAVE DE ENFERMO/SANO
    sanos = #6#8 - #6#31;
|SI sanos < #6#31;       || si los dias de trabajo son menores a los dias
        #7#38 = "E";     || de enfermedad se incluye en el epigrafe accidente
|FINSI;                  || si no se incluye en el epigrafe de enfermedad
|FPRC;

|PROCESO suplemen;     || CALCULA VARIABLES PARA LINEA SUPLEMENTO
|SI #7#13="A"; #7#41=dianume1; #7#42=0; |FINSI;   || si es alta este mes
|SI #7#13="B"; #7#41=0; #7#42=dianume2; |FINSI;   || si es baja este mes
|SI #7#13=" "; #7#41=0; #7#42=0;        |FINSI;   || si continua

    #7#43 = #6#31 + #6#65;     || dias enfermedad+maternidad
    #7#44 = #6#32;             || dias accidente
|FPRC;

____________________________________/ LECTURA DEL TEMPORAL E IMPRESION TC2
|PROCESO impresion;
     haentrat = 1;
     |SI antempre = -1; |HAZ inicio; |HAZ borrado; |HAZ explota;|FINSI;
     |SI antcentr = -1;       antcentr = #7#14;    |FINSI;
     |SI antepigr = -1;       antepigr = #7#26;    |FINSI;

     |SI antempre ! #7#0;   || RUPTURA POR EMPRESA
          |HAZ empresas;             || graba en la plantilla en la empresa
          |HAZ centros;              || graba en la plantilla en el centro
          swbonif = 0;
          swdetal = 0;
          swenfer = 0;
          swepigr = 1;             || carga el switch de impresion de epigrafe(*)
          swclave = 0;
          t_epigr = antepigr;      || carga el epigrafe accidente
          t_epig0 = t_epig1;       || carga el total bases cont. comunes
          t_epig3 = "..........."; || carga el literal del total
          |HAZ auxiliar;               || graba en el auxiliar de empresas
          |HAZ BonifFPCont;
          |HAZ limpieza;             || inicializa variables acumuladoras
          |HAZ inicio;
          |HAZ borrado;
          |HAZ explota;
          |HAZ vacibusc;
          antbonif = -1;
          antepigr = #7#26;
          antcentr = #7#14;
     |SINO;
          |SI antcentr ! #7#14;  || RUPTURA POR CENTRO DE TRABAJO
               |SI #1#45 = "S";
                    |HAZ centros;            || graba en la plantilla en el centro
                    |HAZ auxiliar;
                    |HAZ BonifFPCont;
                    |HAZ limpieza;
               |FINSI;
               antcentr = #7#14;
          |FINSI;
     |FINSI;

     |SI antclave ! #7#47;
          swbonif = 0;
          swdetal = 0;
          swenfer = 0;
          swepigr = 0;
          swclave = 1;            || carga el switch de impresion del titulo
          |SI #7#47 = "A";  litecla = "FIJOS -";            |FINSI;
          |SI #7#47 = "B";  litecla = "FIJOS SIN DESEM.-";  |FINSI;
          |SI #7#47 = "E";  litecla = "EVENTUALES -";       |FINSI;
          antclave = #7#47;
     |FINSI;

     ||SI antbonif ! #7#35;          || RUPTURA POR BONIFICACION
          #8#0 = #7#35;
          antbonif = #7#35;
          |LEE 040#8=;
          |SI FSalida = 0; |Y #8#0 ! 0;  || si esta y no es cero
               nMes = #0#2;
               nAny = #0#3;
               nCodigoBon = #8#0;
               |HAZ VerifBonif;

               swenfer = 0;
               swepigr = 0;
               swdetal = 0;
               swbonif = 1;   || carga el switch de impresion de bonificacion
               swclave = 0;
               desboni = #8#1;   || carga en variable la descripcion
               |HAZ cuentc21;
          |SINO;
               |DDEFECTO #8;          || si no existe o es cero limpia los campos
          |FINSI;
     ||FINSI;

     #5#0 = #7#0;
     #5#1 = #7#39;
     |LEE 000#5=;

     nCConst = #5#248;
     |HAZ constante;

     swbonif = 0;
     swenfer = 0;
     swepigr = 0;
     swdetal = 1;
     swclave = 0;

     t_08 = t_08 + #7#28;            || acumula total bases horas 1
     t_09 = t_09 + #7#29;            || acumula total bases horas 2
     |SI #7#47 = "E";
          t_15 = t_15 + #7#24;            || acumula jornadas reales (*)
     |FINSI;
     |SI #5#112 = "S";
          t_aux3 = t_aux3 + #7#25; || acumula si Ley 12/2001 (ctos.<7 dias)
     |FINSI;

     t_traba = t_traba + 1;          || acumula nro. trabajadores empresas
     t_trcen = t_trcen + 1;          || acumula nro. trabajadores centros

     || BASES:
     |SI antclave = "A"; |O antclave = "e";
          t_fijos = t_fijos + 1;        || trabajadores cot. general
          |SI #nomconst#12 ! 0;              || CON desempleo
               |SI nElAny ] 2012;
                    t_aux1a = t_aux1a + #7#25 + #7#37; || cont. en alta
               |SINO;
                    t_aux1a = t_aux1a + #7#25;         || cont. en alta
               |FINSI;
               t_aux1b = t_aux1b + #7#82;         || cont. en IT dias 16-999
               t_aux1c = t_aux1c + (#7#30 - #7#82);  || cont. en IT dias 1-15

               t_aux1b = t_aux1b + #7#67;         || cont. en ERE

               t_epig1a = t_epig1a + #7#27;       || AT y EP en alta
               |SI nElAny ] 2012;
                    t_epig1b = t_epig1b + #7#31 + #7#99;
                    t_epig1b = t_epig1b + #7#67;  || en ERE
               |SINO;
                    t_epig1b = t_epig1b + (#7#84 * #7#33);    || AT y EP en IT
               |FINSI;
          |SINO;                             || SIN desempleo
               |SI nElAny ] 2012;
                    t_aux2a = t_aux2a + #7#25 + #7#37; || cont. en alta
               |SINO;
                    t_aux2a = t_aux2a + #7#25;         || cont. en alta
               |FINSI;
               t_aux2b = t_aux2b + #7#82;         || cont. en IT
               t_aux2b = t_aux2b + #7#67;         || cont. en ERE
               t_epig2a = t_epig2a + #7#27;       || AT y EP en alta
               |SI nElAny ] 2012;
                    t_epig2b = t_epig2b + #7#31 + #7#99;
                    t_epig2b = t_epig2b + #7#67;       || en ERE
               |SINO;
                    t_epig2b = t_epig2b + (#7#84 * #7#33);    || AT y EP en IT
               |FINSI;
          |FINSI;
     |SINO;
          t_event = t_event + 1;        || trabajadores cot. jornadas
          |SI #nomconst#12 ! 0;              || CON desempleo
               |SI nElAny ] 2012;
                    t_aux3a = t_aux3a + #7#25 + #7#37; || cont. en alta
               |SINO;
                    t_aux3a = t_aux3a + #7#25;         || cont. en alta
               |FINSI;
               t_epig3a = t_epig3a + #7#27;       || AT y EP en alta

               t_aux3b = t_aux3b + #7#82;         || cont. en IT, dia 15-999
               t_aux3c = t_aux3c + (#7#30 - #7#82); || cont. en IT, dia 1-15
               t_aux3b = t_aux3b + #7#67;         || cont. en ERE

               || nume1 = #7#33;
               nume1 = #7#63;   || JORNADAS, que soy EVENTUAL
               |SI nume1 > 30; |Y #7#84 = 105.54;
                    nume1 = nume1 - 1;
               |FINSI;
               |SI nElAny ] 2012;
                    t_epig3b = t_epig3b + #7#31 + #7#99;
                    t_epig3b = t_epig3b + #7#67;              || en ERE
               |SINO;
                    t_epig3b = t_epig3b + (#7#84 * nume1);    || AT y EP en IT
               |FINSI;
          |SINO;                             || SIN desempleo
               |SI nElAny ] 2012;
                    t_aux4a = t_aux4a + #7#25 + #7#37; || cont. comunes cot. general
               |SINO;
                    t_aux4a = t_aux4a + #7#25;         || cont. comunes cot. general
               |FINSI;
               t_epig4a = t_epig4a + #7#27;       || AT y EP en alta

               t_aux4b = t_aux4b + #7#30;         || cont. en IT (solo FOGASA)
               t_aux4b = t_aux4b + #7#67;         || cont. en ERE (solo FOGASA)
               ||nume1 = #7#33;
               nume1 = #7#63;   || JORNADAS, que soy EVENTUAL
               |SI nume1 > 30; |Y #7#84 = 105.54;
                    nume1 = nume1 - 1;
               |FINSI;
               |SI nElAny ] 2012;
                    t_epig4b = t_epig4b + #7#31 + #7#99;
                    t_epig4b = t_epig4b + #7#67;            || en ERE
               |SINO;
                    t_epig4b = t_epig4b + (#7#84 * nume1);    || AT y EP en IT
               |FINSI;
          |FINSI;
     |FINSI;
     || para todos a partir de 2012
     |SI #7#21 = 01;
          t_aux1a_01 = t_aux1a_01 + #7#25;   || cont. en alta grupo 01
          t_aux1a_01 = t_aux1a_01 + #7#37;   || cont. en it grupo 01
          || (las a¤ado para el grupo 01 a partir del boletin 2012-2)
          t_tipo_G01 = 28.30;
          t_tipo_G01_emp = 23.60;
     |FINSI;
     |SI #nomconst#16 ! 0;              || CON FP
          t_aux5a = t_aux5a + #7#27 + #7#31; || BASE para FP
     |FINSI;

     t_aux6 = t_aux6 + #7#82;           || BASE cont. EMP (mat)
     t_aux6 = t_aux6 + #7#67;           || BASE cont. EMP (ERE)
     |SI #7#21 = 01;
          t_aux6_01 = t_aux6_01 + #7#82;|| BASE cont. EMP (mat) grupo 01
          t_aux6_01 = t_aux6_01 + #7#67;|| BASE cont. EMP (ERE) grupo 01
     |FINSI;

     |SI #7#101 ! 0;
          t_aux7b = t_aux7b + #7#25 + #7#37 + #7#82 + #7#67;  || base cot. solidaridad
          t_aux7c = t_aux7c + #7#101; || cuota cot. solidaridad
     |FINSI;

     || la base para FOGASA + DESEMPLEO

     |HAZ lee_bonif;

     |SI nElAny ] 2012;
          |SI #nomconst#14 ! 0; |O #nomconst#16 ! 0;   || CON desempleo
               |SI #nombonif#10 ! 4;         || exentos fogasa y desempleo
                    t_basefoga = t_basefoga + #7#27 + #7#31;
               |FINSI;
          |FINSI;
     |SINO;
          |SI #nomconst#14 ! 0;                        || CON desempleo
               t_basefoga = t_basefoga + #7#30;
          |FINSI;
     |FINSI;

     || BASES Y TIPOS DEL DESEMPLEO:
     |SI nElAny ] 2012;
          t_basedestot = #7#30 - #7#99 + #7#62;
     |SINO;
          t_basedestot = #7#30 - #7#82;
     |FINSI;
     t_tipodestot = #nomconst#12 + #nomconst#13;

     |SI #nombonif#10 = 4;
          t_basedestot = 0;
     |FINSI;
||      xxxxxxxxxxxxxxx

     |SI nElAny ] 2012;
          t_basedesemp = #7#99;
          t_basedesemp = t_basedesemp + #7#68;    || parte de ERE
     |SINO;
          t_basedesemp = #7#82;
     |FINSI;
     t_tipodesemp = #nomconst#12;

     |SI #nombonif#10 = 4;
          t_basedesemp = 0;
     |FINSI;

     |SI t_basedestot ! 0; |Y t_tipodestot ! 0;
          swListo = 0;
          |SI t_tipodestot = t_tipodestot1;
               t_basedestot1 = t_basedestot1 + t_basedestot;
               swListo = 1;
          |FINSI;
          |SI t_tipodestot = t_tipodestot2;
               t_basedestot2 = t_basedestot2 + t_basedestot;
               swListo = 2;
          |FINSI;
          |SI t_tipodestot = t_tipodestot3;
               t_basedestot3 = t_basedestot3 + t_basedestot;
               swListo = 3;
          |FINSI;
          |SI swListo = 0;
               |SI t_tipodestot1 = 0;
                    t_basedestot1 = t_basedestot;
                    t_tipodestot1 = t_tipodestot;
               |SINO;
                    |SI t_tipodestot2 = 0;
                         t_basedestot2 = t_basedestot;
                         t_tipodestot2 = t_tipodestot;
                    |SINO;
                         |SI t_tipodestot3 = 0;
                              t_basedestot3 = t_basedestot;
                              t_tipodestot3 = t_tipodestot;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     ||SI t_basedesemp ! 0; |Y t_tipodesemp ! 0;
     |SI t_basedesemp ! 0;
          |SI t_tipodesemp ! 0;
               swListo = 0;
               |SI t_tipodesemp = t_tipodesemp1;
                    t_basedesemp1 = t_basedesemp1 + t_basedesemp;
                    swListo = 1;
               |FINSI;
               |SI t_tipodesemp = t_tipodesemp2;
                    t_basedesemp2 = t_basedesemp2 + t_basedesemp;
                    swListo = 2;
               |FINSI;
               |SI t_tipodesemp = t_tipodesemp3;
                    t_basedesemp3 = t_basedesemp3 + t_basedesemp;
                    swListo = 3;
               |FINSI;
          |FINSI;
          |SI #3#0 = 718;
               || excluidos de desempleo y fogasa, CTE 718
               || me tengo que llevar algo a la base de desempleo, ya que
               || despues tengo que cotizar a otras cotizaciones por la
               || parte empresarial

               || probablemente haya una mejor forma de hacerlo, pero el caso
               || es muy aislado y el riesgo es grande, de esta manera despues
               || tendre mi base empresaria para otras cotizaciones en los de
               || la constante 718

               t_basedesemp1 = t_basedesemp1 + t_basedesemp;
          |FINSI;
          |SI swListo = 0;
               |SI t_tipodesemp1 = 0;
                    t_basedesemp1 = t_basedesemp;
                    t_tipodesemp1 = t_tipodesemp;
               |SINO;
                    |SI t_tipodesemp2 = 0;
                         t_basedesemp2 = t_basedesemp;
                         t_tipodesemp2 = t_tipodesemp;
                    |SINO;
                         |SI t_tipodesemp3 = 0;
                              t_basedesemp3 = t_basedesemp;
                              t_tipodesemp3 = t_tipodesemp;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     || REDUCCIONES 2012

     |SI s_tat = 2;
          || en finiquitos, me guardo en ese campo el % de reduccion a aplicar
          || porque al ser la reduccion en IT ese campo no lo voy a usar nunca
          || y me hace falta para aplicar la reduccion desglosada por periodos
          || si la liquidacion abarca mas de un periodo
          #7#91 = 0;
     |FINSI;
     nRedCCAlta = nRedCCAlta + #7#90;
     nRedCCEnf = nRedCCEnf + #7#91;
     nRedDesEnf = nRedDesEnf + #7#92;
     nRedCCMat = nRedCCMat + #7#93;
     nRedDesMat = nRedDesMat + #7#94;
     nRedCCAcc = nRedCCAcc + #7#95;
     nRedDesAcc = nRedDesAcc + #7#96;
     nRedCCEnfEmp = nRedCCEnfEmp + #7#97;
     nRedDesEnfEmp = nRedDesEnfEmp + #7#98;

     |SI #7#13 = "X";
          t_altas = t_altas + 1;  t_bajas = t_bajas + 1;
          t_altce = t_altce + 1;  t_bajce = t_bajce + 1;
     |FINSI;
     |SI #7#13 = "A";  t_altas = t_altas + 1;  t_altce = t_altce + 1;  |FINSI;
     |SI #7#13 = "B";  t_bajas = t_bajas + 1;  t_bajce = t_bajce + 1;  |FINSI;

     |SI #7#38 = "E";|Y #50#16 = 2;
          t_enfe2 = t_enfe2 + 1;     || acumula nro. trabajadores enfermos
     |SINO;
          t_epig2 = t_epig2 + 1;     || acumula nro. trabajadores por epigrafe
     |FINSI;
/*
     |SI #7#37 ! 0;|O #7#43 ! 0;|O #7#44 ! 0;       || LINEA DE ILT
          swbonif = 0; swepigr = 0;
          swdetal = 0; swenfer = 1;  || carga el switch de linea de enfermedad
          swclave = 0;
          t_enfe0 = #7#36;           || guarda el epigrafe de enfermedad
          t_enfe1 = t_enfe1 + #7#37; || acumula total epigrafe enfermedad
          ||PRINT;
     |SINO;
          |SI #7#40 ! "                      "; |O #7#41 ! 0; |O #7#42 ! 0;
               swbonif = 0; swepigr = 0;
               swdetal = 0; swenfer = 1;
               swclave = 0;
               pp14 = #7#14; pp15 = #7#15; pp16 = #7#16; pp17 = #7#17;
               pp18 = #7#18; pp36 = #7#36; pp37 = #7#37;
               #7#14 =  0; #7#15 = ""; #7#16 = ""; #7#17 = "";  || chapuzilla !!!
               #7#18 = ""; #7#36 =  0; #7#37 =  0;
               #7#14 = pp14; #7#15 = pp15; #7#16 = pp16; #7#17 = pp17;
               #7#18 = pp18; #7#36 = pp36; #7#37 = pp37;
          |FINSI;                        || imprime suplemento !!!
     |FINSI;
*/
     |HAZ calcula_bonif;

     |SI nume3 ! 0;                  || si tengo cuota IT
          |SI t_porit = g_porit;|| si el % del trab es igual al que tenia
               g_porit = t_porit;       ||     lo grabo: vamos que me quedo con el mismo
          |SINO;                     || si tenia un % distinto
               |SI g_porit = 0;         ||     y este era = cero
                    g_porit = t_porit;   ||         grabo el nuevo
               |SINO;                 ||     si era distinto a cero
                    g_porit = 99;        ||         graba 99: no tengo que pintarlo
               |FINSI;                ||     ya ta
          |FINSI;                    || ya ta
     |FINSI;
     |SI nume2 ! 0;          || si tengo cuota desempleo
          |SI t_pordesem = g_pordesem;    || si el % del trabajador es igual al que tenia
               g_pordesem = t_pordesem;    ||     lo grabo: vamos que me quedo con el mismo
          |SINO;                     || si tenia un % distinto
               |SI g_pordesem = 0;         ||     y este era = cero
                    g_pordesem = t_pordesem;||         grabo el nuevo
               |SINO;                 ||     si era distinto a cero
                    g_pordesem = 99;        ||         graba 99: no tengo que pintarlo
               |FINSI;                ||     ya ta
          |FINSI;                    || ya ta
     |FINSI;

     t_bonif = t_bonif + reducc + reduccb;
     t_reducc = t_reducc + bonifi + bonifib + reduc0502 + reduc0502b + bon_60 + nBonifERE;
     t_subhoras = t_subhoras + sub85pre + sub85dis;
     t_epigr = #7#26;         || carga el epigrafe en alta

     t_epig0 = t_epig1a + t_epig2a + t_epig3a + t_epig4a; || base AT/EP en ALTA
     |HAZ epigrafe;

|| migue
     |SI #0#3 [ 2009;
          t_epigr = 904;           || carga el epigrafe en IT
     |SINO;
          t_epigr = #7#26;           || carga el epigrafe normal
     |FINSI;

     t_epig0 = t_epig1b + t_epig2b + t_epig3b + t_epig4b; || base AT/EP en IT
     t_epig2 = t_enfe2;       || carga el nro. de trabaj. enfermos
     |HAZ epigrafe;           || graba el 126 en el aux. de epigrafes

/*
     |SI #7#37 ! 0;|Y #50#16 = 2;
          t_epigr = t_enfe0;       || carga el epigrafe de enfermedad
          t_epig0 = #7#37;         || carga el total bases enfermedad
          t_epig2 = t_enfe2;       || carga el nro. de trabaj. enfermos
          t_epig3 = "ENFERMEDAD "; || carga el literal del total
          |HAZ epigrafe;           || graba el 126 en el aux. de epigrafes
     |FINSI;
*/

     |SI #3#14 = 0;      || base excluida de fogasa
          t_nofog = t_nofog + t_basedestot + t_basedesemp;
     |FINSI;

     t_epig2 = 0;
     t_epig1a = 0; t_epig2a = 0; t_epig3a = 0; t_epig4a = 0; || base AT/EP en ALTA
     t_epig1b = 0; t_epig2b = 0; t_epig3b = 0; t_epig4b = 0; || base AT/EP en IT
     t_enfe2 = 0;
|FPRC;

|PROCESO bonif_18;
     #8#0 = #7#35;       || este rollo es para comprobar si es fami-
     |LEE 000#8=;        || liar, tendra bonif con clave 18 y su cte
     |SI FSalida = 0;
          nMes = #0#2;
          nAny = #0#3;
          nCodigoBon = #8#0;
          |HAZ VerifBonif;
     |FINSI;
     aAlfa1 = #8#13; |QBF aAlfa1;  || tendra en la parte de la empre-
     aAlfa1 = "000" + aAlfa1;      || sa lo de la empresa y el trabajador
     aAlfa1 = aAlfa1 % -103;       || hay que cotizar en baja solo lo de la em-
                                   || presa, el 0,24 del trab. solo en alta
     |SI aAlfa1 = "018";
          |SI antclave = "E";
               nNume1 = 0.24;
          |SINO;
               nNume1 = 1.55;
          |FINSI;
     |SINO;
          nNume1 = 0;
     |FINSI;
|FPRC;

|| NOTA : Lee todo el fichero !!!
|| CLAVE: Empresa, CLAVE DIAS SALARIO, Bonificacion, Epigrafe,
||                      / Provincia, S.S., Trabajador, Centro

|DEFBUCLE gomyytc21;
 #7#1;
 ;
 "N",     0,   0, 00,   0, bot3,     0,  0;
 "S", 99999, 999, 99, 999, top3, 99999, 99;
 ;
 NULL, impresion;
|FIN;

____________________________________/ CALCULO PRINCIPAL
|PROCESO principal;
     |SI eaVengode ! "silcon16";
          nElAny = #0#3;
          nElMes = #0#2;
     |SINO;
          nElAny = nAnyo;
          nElMes = nMes;
     |FINSI;
          |HAZ ValoresITIMS;

     |SI eaVengode ! "silcon16";
          c_informe = "gomyytc2";
          |HAZ cuadres;
     |SINO;
          sw_cuadre = 0;
          FSalida = 0;
     |FINSI;

     |SI sw_cuadre = 0; |Y FSalida = 0;
          |DDEFECTO #50;
          |ABRE #50;
          |LEE 000#50p;         || lee control aplicacion
          |CIERRA #50;
          #50#17 = 3;    || paso, para los agrarios mensuales que lo haga
          #50#18 = 3;    || siempre como "3"

          alfa1 = Usuario;  |QBF alfa1;    alfa1 = "g" + alfa1;
          |NOME_DAT #7 alfa1;
          |DELINDEX #7;   ||Se carga el temporal que pudiera existir

          |ABRE #1;       || Abre fichero de empresas
          |ABRE #3;       || Abre fichero de constantes
          |ABRE #5;       || Abre fichero de trabajadores
          |ABRE #10;      || Abre fichero de centros
          |ABRET #7;      || Abre fichero temporal (con bloqueo)

          |HAZ temporal0;
          || si vengo del silcon16 acabo aqui de momento, pq ya he grabado
          || en el nomtrtc2 los de esta empresa, ahora grabo el tc1
          |SI eaVengode ! "silcon16";
               |HAZ temporales;
               ||ACABA;
          |FINSI;

          |HAZ el_tc1;
     |SINO;
          |MENAV "    Proceso ABORTADO !!!";
     |FINSI;
|FPRC;

|PROCESO el_tc1;
     |CIERRA #1;
     |CIERRA #3;
     |CIERRA #5;
     |LIBERA #7;
     |CIERRAT #7;
     |CIERRA #10;
     antempre = -1;
     antcentr = -1;
     antbonif = -1;  || inicializa variables para rupturas
     antepigr = -1;
     antclave = ".";
     |HAZ vacibusc;
     |ABRE #2;       || Abre fichero auxiliar empresas
     |ABRE #5;       || Abre fichero auxiliar empresas
     |ABRE #8;       || Abre fichero bonificaciones
     |ABRE #9;       || Abre fichero epigrafes
     |ABRE #11;      || explotaciones (*)
     |ABRE #12;
     haentrat = 0;   || switch para saber si lee
     |SI runnom = "gomsstc2"; || en atrasos he de borrar antes de entrar
          |HAZ borrado;       || por si no hubiera datos
     |FINSI;
     |BUCLE gomyytc21;
     |SI haentrat = 1;   || si ha impreso cierra el informe, totalizando
          antempre = #7#00;
          antcentr = #7#14;
          |HAZ empresas;              || graba en la plantilla en la empresa
          |HAZ centros;               || graba en la plantilla en el centro
          swbonif = 0;
          swdetal = 0;
          swenfer = 0;
          swepigr = 1;            || carga el switch de impresion de epig.(*)
          swclave = 0;
          t_epigr = antepigr;     || carga el epigrafe accidente
          t_epig0 = t_epig1;      || carga el total bases cont. comunes
          t_epig3 = "...........";|| carga el literal del total

          |HAZ auxiliar;              || graba en el auxiliar de empresas
          |HAZ BonifFPCont;
          /*
          |HAZ epigrafe;              || graba en el aux. de epigrafes
          |SI t_enfe1 ! 0;|Y #50#16 = 2;
               t_epigr = t_enfe0;       || carga el epigrafe de enfermedad
               t_epig0 = t_enfe1;       || carga el total bases enfermedad
               t_epig2 = t_enfe2;       || carga el nro. de trabajadores enfermos
               t_epig3 = "ENFERMEDAD "; || carga el literal del total
               |HAZ epigrafe;               || graba el 126 en aux.epigrafes
          |FINSI;
          */
     |FINSI;
     |CIERRA #2;
     |CIERRA #5;
     |CIERRA #8;
     |CIERRA #9;
     |CIERRA #11;  || explotaciones (*)
     |CIERRA #12;
|FPRC;

|PROCESO explota;        || LEE DATOS EXPLOTACION
    #11#0 = #7#0;
|LEE 000#11=;
|SI FSalida = 0;
        nomex = #11#1;
        direx = #11#2;
        locex = #11#3;
        alfa1 = #11#4;  alfa1 =  "00" + alfa1;  alfa1 = alfa1 % -102;
        alfa2 = #11#5;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
        codex = alfa1 + alfa2;
        proex = #11#6;
|SINO;
        alfa1 = #7#5 % 102;
        #12#0 = alfa1;
    |LEE 000#12=;
    |SI FSalida ! 0;  |DDEFECTO #12;  |FINSI;
        nomex = "";
        direx = #7#4;
        locex = #7#6;
        codex = #7#5;
        proex = #12#1;
|FINSI;
|FPRC;

|PROCESO limpieza;   || INICIALIZA ACUMULADORES EMPRESA
    t_enfe1 = 0;     || acumulador bases epigrafe enfermedad
    t_enfe2 = 0;     || acumulador nro. trabajadores enfermos
    t_06 = 0;        || acumuladores pie TC2
    t_07 = 0;
    t_08 = 0;
    t_09 = 0;
    t_10 = 0;
    t_11 = 0;
    t_12 = 0;
    t_14 = 0;
    t_15 = 0;       || (*)
    t_aux1 = 0;
    t_aux2 = 0;
    t_aux3 = 0;
    t_base4 = 0;
    t_aux4 = 0;
    t_por4 = 0;
    tc21 = 0;
    t_fijos = 0;    || (*)
    t_event = 0;    || (*)
    t_epig9 = 0;    || (*)
    t_epiga = 0;    || (*)
    t_epigb = 0;    || (*)
    antclave = "."; || (*)
    t_desemfijos = 0;
    t_desemeven = 0;
    t_porit = 0;
    t_itfijos = 0;
    t_iteven = 0;
    t_bonif = 0;
    t_reducc = 0;
    t_subhoras = 0;
    t_nofog = 0;
     t_aux1a = 0;    || base cont. general, alta, con des.
     t_aux2a = 0;    || base cont. general, alta, sin des.
     t_aux3a = 0;    || base cont. jornadas, alta, con des
     t_aux4a = 0;    || base cont. jornadas, alta, sin des
     t_aux5a = 0;    || base FP
     t_aux6 = 0;     || base cc. cont. emp. (mat)
     t_aux6_01 = 0;  || base cc. cont. emp. (mat) grupo 01
     t_aux1a_01 = 0; || base cont. general, grupo 01
     t_aux1b = 0;    || base cont. general, IT, con des.
     t_aux1c = 0;    || base cont. general, IT, con des.
     t_aux2b = 0;    || base cont. general, IT, sin des.
     t_aux3c = 0;    || base cont. jornadas, IT, con des, pago emp
     t_aux3b = 0;    || base cont. jornadas, IT, con des, pago SS
     t_aux4b = 0;    || base cont. jornadas, IT, sin des (fogasa)
     t_aux7b = 0;    || base cot. solidaridad
     t_aux7c = 0;    || cuota cot. soidaridad

     t_cuotacont = 0;  || total cuota cont. comunes
     t_cuotades1 = 0;  || total cuota desempleo trab+emp
     t_cuotafoga = 0;  || total cuota fogasa

     t_basefoga = 0;

     t_basedestot1 = 0;
     t_tipodestot1 = 0;
     t_basedestot2 = 0;
     t_tipodestot2 = 0;
     t_basedestot3 = 0;
     t_tipodestot3 = 0;
     t_basedesemp1 = 0;
     t_tipodesemp1 = 0;
     t_basedesemp2 = 0;
     t_tipodesemp2 = 0;
     t_basedesemp3 = 0;
     t_tipodesemp3 = 0;
     t_tipo_G01 = 0;
     t_tipo_G01_emp = 0;

     nRedCCAlta = 0;
     nRedCCEnf = 0;
     nRedDesEnf = 0;
     nRedCCMat = 0;
     nRedDesMat = 0;
     nRedCCAcc = 0;
     nRedDesAcc = 0;
     nRedCCEnfEmp = 0;
     nRedDesEnfEmp = 0;
|FPRC;

|PROCESO vacibusc;   || limpia la tabla busca y su puntero
|SI puntero = 0;
        puntero = 99;
|FINSI;
|PARA punt = 0; |SI punt < puntero; |HACIENDO punt = punt + 1;
    Ibusca = busca1 <-;
    Ibusca = Ibusca + punt;
     busca = 0;
|SIGUE;
    puntero = 0;
|FPRC;

|PROCESO cuentc21; || busca en la tabla la bonific. para ver si ya esta contada
    ya = 0;
|PARA punt = 0; |SI punt < puntero; |HACIENDO punt = punt + 1;
        Ibusca = busca1 <-;
        Ibusca = Ibusca + punt;
    |SI busca = #7#35;  ya = 1;  |FINSI;
|SIGUE;
|SI ya = 0;
        Ibusca = busca1 <-;
        Ibusca = Ibusca + puntero;
        busca = #7#35;
    |SI #8#03 ! 0;
            tc21 = tc21 + 1;   || numero de TC2/1 por empresa
    |FINSI;
    |SI #8#11 = "S";
            tc21 = tc21 + 1;   || a¤ade el de subv. tecnol.
    |FINSI;
        puntero = puntero + 1;
|FINSI;
|FPRC;

|PROCESO inicio;    || ABRE INFORME PARA NUEVA EMPRESA, CARGA VARIABLES
||INFOR informe;     || /Y BORRA SU AUXILIAR DE EPIGRAFES
    antempre = #7#00;  antnombr = #7#01;  antdirec = #7#04;
    antcodig = #7#05;  antlocal = #7#06;  antmutua = #7#03;
    antmutco = #7#02;  antcif   = #7#07;  antcuent = #7#45;
|FPRC;
