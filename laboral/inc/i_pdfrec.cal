/************************ PROCESOS IMPRESION EN PDF *************************/


|PROCESO ultimodia;
     |SI #36#19 = "S"; |Y #10para1 = "Accidente ";
          #10para2 = #10para2 - 1;
     |FINSI;
     |SI #10para2 = 0;
          #10para2 = 1;
     |FINSI;
     |SI #10para3 = 0;
          #10para3 = topemes;
     |FINSI;
|FPRC;


|DEFBUCLE GrabaTemporal;
     #pdfdocli#1;
     ;
     aArchivo,   1;
     aArchivo, 999;
     ;
     NULL, CargaCampos;
|FIN;

|PROCESO CargaTemporal;
     #pdfdocca#0 = aArchivo;
     |LEE 000#pdfdocca.=;
     |SI FSalida ! 0;
          aAlfa1 = "    Archivo " + aArchivo + " no encontrado en el Mantenimiento ";
          aAlfa1 = aAlfa1 + "de ficheros PDF.";
          |MENAV aAlfa1;
          |ACABA;
          swCarga = 0;
     |SINO;
          aID = #pdfdocca#2;
     |FINSI;
|FPRC;

|PROCESO BuscaArchivo;
     |SI PARAMETRO = "MFI"; |O PARAMETRO = "HFI";
          aArchivo = "cartafiniq.pdf";
     |SINO;
          aArchivo = "nomina.pdf";
     |FINSI;
|FPRC;

|PROCESO PreparaPDF;
     aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
     |NOME_DAT #200 aAlfa1;
     |DELINDEX #pdfimtmp;
     |ABRE #pdfimtmp;
     |ABRE #pdfdocca;
     |ABRE #pdfdocli;
     swCopia = 1;
     nNroCopias = #36#34;
     |HAZ BuscaArchivo;     ||asigna a aArchivo el nombre del pdf
     |HAZ CargaTemporal;    ||mira a ver si esta el pdf en el mantenimiento
     |SI aArchivo = "nomina.pdf";
          |HAZ CargaCampos;
     |FINSI;
     |SI aArchivo = "cartafiniq.pdf";
          |HAZ CargaFiniq;
     |FINSI;
     |CIERRA #pdfimtmp;
     |CIERRA #pdfdocca;
     |CIERRA #pdfdocli;
     |SUB_EJECUTA "pdfgraba";
|FPRC;

|DEFBUCLE agidanif;
     #agidanif#1;
     ;
     #10#12, 00;
     #10#12, 99;
     ;
     NULL, DatosPersonales;
|FIN;


|PROCESO sustituye2;
     nAscii = & aCaracter;
     aCaracterSal = aCaracter;
     |SI nAscii = 160;             || el caracter  
          aCaracterSal = "\341";
     |FINSI;
     |SI nAscii = 130;             || el caracter ‚
          aCaracterSal = "\351";
     |FINSI;
     |SI nAscii = 161;             || el caracter ¡
          aCaracterSal = "\355";
     |FINSI;
     |SI nAscii = 162; |O nAscii = 243;            || el caracter ¢
          aCaracterSal = "\363";
     |FINSI;
     |SI nAscii = 163;             || el caracter £
          aCaracterSal = "\372";
     |FINSI;
     |SI nAscii = 164;             || el caracter ¤
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 241;             || el caracter ¤ (otro codigo ¨?)
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 165;             || el caracter ¥
          aCaracterSal = "\321";
     |FINSI;
     |SI nAscii = 129;
          aCaracterSal = "\374";   || el caracter u con dieresis
     |FINSI;
     |SI nAscii = 154;
          aCaracterSal = "\334";   || el caracter U (mayuscula) con dieresis
     |FINSI;
     |SI nAscii = 167;
          aCaracterSal = "\272";   || el caracter §
     |FINSI;
     |SI nAscii = 166;
          aCaracterSal = "\252";   || el caracter ¦
     |FINSI;
     |SI aCaracter = "(";
          aCaracterSal = "\(";
     |FINSI;
     |SI aCaracter = ")";
          aCaracterSal = "\)";
     |FINSI;
|FPRC;

|PROCESO sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca = (nPos * 100) + 1;
          aCaracter = aCadena % nBusca;
          |HAZ sustituye2;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO GrabaTemporal;
     |SI nSwNumer = 1;|Y aValor = "0";  aValor = "";   |FINSI;

     aAlfa1 = aValor % 101;
     |SI aAlfa1 = ".";
          aValor = "";
     |FINSI;
     |QBF aValor;
     aCadena = aValor;
     |HAZ sustituye;
     aValor = aCadenaSal;

     aLong = aValor % 0;
     nLong = aLong;

     |SI nLong ] 238;
          aAlfa = aValor % 199;
          aValor = aValor - aAlfa;
          aAlfa2 = aValor % 199;
          aAlfa = aAlfa + aAlfa2;
          aValor = aValor - aAlfa2;
          aAlfa2 = aValor % 140;
          aAlfa = aAlfa + aAlfa2;
          aValor = aAlfa;
     |FINSI;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;

     |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO CargaFiniq;
     nTipo = 0;
     |SI PARAMETRO = "HFI";
          #nomhicca#0  = #10#1;     ||Empresa
          #nomhicca#1  = #10#2;     ||Trabajador
          #nomhicca#66 = #0#4;     ||Anyo
          #nomhicca#2  = #0#5;     ||Mes
          #nomhicca#3  = 2;        ||Tipo
          swDesdeWeb = 1;
          |BUCLELIN 2conceptosFinHisto#nomhicca;
          swDesdeWeb = 0;
     |SINO;
          #nomcalca#0  = #10#1;     ||Empresa
          #nomcalca#1  = #10#2;     ||Trabajador
          #nomcalca#2  = #0#5;     ||Mes
          #nomcalca#3  = 2;        ||Tipo
          swDesdeWeb = 1;
          |BUCLELIN 2conceptosFinMensu#nomcalca;
          swDesdeWeb = 0;
     |FINSI;
    poblafir = #1#6;
|QBF poblafir;

    causa = #10#146;
|QBF causa;

    liquido = #10#142;
|QBF liquido;

          aAlfa = liquido;
          nDec = 2;
          |HAZ PonDecimales;
     aCampo = "liquido";           aValor = aVar;   |HAZ GrabaTemporal;

     aCampo = "codemp";
     aAlfa = "00000" + #10#1;
     aValor = aAlfa % -105;
     |HAZ GrabaTemporal;

     aCampo = "empresa";           aValor = #10#3;
     aAlfa = aValor % 103;         || ATENCION: LA TONTERIA DEL SIGLO, EN ASECOR
     |SI aAlfa = "DE ";            || EN SU IMPRESORA OLIVETTI LAS NOMINAS EN PDF
          aValor = " " + aValor;   || SE LES QUEDABAN COLGADAS SI LA EMPRESA CO-
     |FINSI;                       || MENZABA POR "DE ". INSERTO UN ESPACIO ANTES
     |HAZ GrabaTemporal;
     aCampo = "domicilio";         aValor = #10#4;     |HAZ GrabaTemporal;
     aCampo = "poblacion";         aValor = #10#5;     |HAZ GrabaTemporal;
     aCampo = "trabajador";        aValor = #10#6;     |HAZ GrabaTemporal;
     aCampo = "nif";               aValor = #10#12;    |HAZ GrabaTemporal;
     aCampo = "causa";             aValor = causa;     |HAZ GrabaTemporal;

          aAlfa = #10#118;
          nDec = 2;
          |HAZ PonDecimales;
     aCampo = "devengado";         aValor = aVar;   |HAZ GrabaTemporal;
     aCampo = "poblafir";          aValor = poblafir;  |HAZ GrabaTemporal;
     aCampo = "diafir";            aValor = #10#143;   |HAZ GrabaTemporal;
     aCampo = "mesfir";            aValor = #10#144;   |HAZ GrabaTemporal;
     aCampo = "anyofir";           aValor = #10#145;   |HAZ GrabaTemporal;

     |SI #10#136 ! 0;
          aCampo = "IRPF";              aValor = "I.R.P.F. :";   |HAZ GrabaTemporal;

          aAlfa = #10#135;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "IRPFporc";
               aValor = aVar + " %";
               |HAZ GrabaTemporal;

          aAlfa = #10#136;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "IRPFbase";          aValor = aVar;        |HAZ GrabaTemporal;

          aAlfa = #10#138;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "IRPFtotal";         aValor = aVar;        |HAZ GrabaTemporal;
     |FINSI;

     |SI #10#123 ! 0;
          aCampo = "ContCom";
          aValor = "Contingencias Comunes :";   |HAZ GrabaTemporal;

          aAlfa = #10#127;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "Comporc";          aValor = aVar + " %";        |HAZ GrabaTemporal;

          aAlfa = #10#123;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "Combase";          aValor = aVar;        |HAZ GrabaTemporal;

          aAlfa = #10#131;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "Comtotal";         aValor = aVar;        |HAZ GrabaTemporal;
     |FINSI;

     |SI #10#124 ! 0;
          aCampo = "ContPro";
          aValor = "Contingencias Profesionales :";   |HAZ GrabaTemporal;

          aAlfa = #10#128;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "Proporc";          aValor = aVar + " %";        |HAZ GrabaTemporal;

          aAlfa = #10#124;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "Probase";          aValor = aVar;        |HAZ GrabaTemporal;

          aAlfa = #10#132;
          nDec = 2;
          |HAZ PonDecimales;
          aCampo = "Prototal";         aValor = aVar;        |HAZ GrabaTemporal;
     |FINSI;

|FPRC;

|PROCESO CargaCampos;
     aValor = "";
     aCampo = #pdfdocli#2;
     |QBF aCampo;
     aCadena = aCampo;
     |HAZ sustituye;
     aCampo = aCadenaSal;
     nTipo = #pdfdocli#3;

     nSwNumer = 0;       || para que deje los ceros

     aCampo = "codemp";
     aAlfa = "00000" + #10#1;
     aValor = aAlfa % -105;
     |HAZ GrabaTemporal;

     aCampo = "empresa";           aValor = #10#3;
     aAlfa = aValor % 103;         || ATENCION: LA TONTERIA DEL SIGLO, EN ASECOR
     |SI aAlfa = "DE ";            || EN SU IMPRESORA OLIVETTI LAS NOMINAS EN PDF
          aValor = " " + aValor;   || SE LES QUEDABAN COLGADAS SI LA EMPRESA CO-
     |FINSI;                       || MENZABA POR "DE ". INSERTO UN ESPACIO ANTES
     |HAZ GrabaTemporal;
     aCampo = "domicilio";         aValor = #10#4;     |HAZ GrabaTemporal;
     aCampo = "poblacion";         aValor = #10#5;     |HAZ GrabaTemporal;
     aCampo = "CIF";               aValor = #10#0;     |HAZ GrabaTemporal;
     aCampo = "cta_seg_social";    aValor = #10#9;     |HAZ GrabaTemporal;
     aCampo = "trabajador";        aValor = #10#6;     |HAZ GrabaTemporal;
     aCampo = "nif";               aValor = #10#12;    |HAZ GrabaTemporal;
     aAlfa1 = #labtraba#87;    aAlfa1 = "000" + aAlfa1; aAlfa1 = aAlfa1 % -103;
     aAlfa2 = #labtraba#17;    aAlfa2 = "00" + aAlfa2; aAlfa2 = aAlfa2 % -102;
     aCampo = "con_cat";
     aValor = aAlfa1 + "/" + aAlfa2;
     |HAZ GrabaTemporal;

     nNume = #10#11;
     |SI nNume ! 0;
          aCampo = "num_matricula";     aValor = #10#11;    |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "num_seg_social";    aValor = #10#13;    |HAZ GrabaTemporal;
     aCampo = "cat_profesional";   aValor = #10#7;     |HAZ GrabaTemporal;

     aCampo = "grupo_cotizacion";
     aAlfa = #10#122;      |QBF aAlfa;
     aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
     aValor = aAlfa;
     |HAZ GrabaTemporal;

     aCampo = "fecha_antiguedad";  aValor = #10#10;    |HAZ GrabaTemporal;
     aCampo = "fecha_alta";        aValor = #labtraba#36;  |HAZ GrabaTemporal;
     aCampo = "puesto";            aValor = #labtraba#238; |HAZ GrabaTemporal;
     aCampo = "contrato";          aValor = #labtraba#45;  |HAZ GrabaTemporal;
     aCampo = "literal_atrasos";   aValor = #10#150;   |HAZ GrabaTemporal;

     aCampo = "liquidacion_del_dia";
     aValor = #10#14;    |QBF aValor;
     |SI aValor = "0";   aValor = "";   |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "liquidacion_del_mes";    aValor = #10#15;  |HAZ GrabaTemporal;

     aCampo = "liquidacion_al_dia";
     aValor = #10#16;    |QBF aValor;
     |SI aValor = "0";   aValor = "";   |FINSI;
     |HAZ GrabaTemporal;

     aCampo = "liquidacion_al_mes";     aValor = #10#17;  |HAZ GrabaTemporal;

     aCampo = "liquidacion_anyo";       aValor = #10#18;  |HAZ GrabaTemporal;
     aCampo = "liquidacion_total_dias"; aValor = #10#19;  |HAZ GrabaTemporal;

     nSwNumer = 1;       || para que no deje los ceros

     aCampo = "salario_base";           aValor = #10#23;        |HAZ GrabaTemporal;
     ||DESCRIPCION AMPLIADA QUE PIDE QUALITAS
     aCampo = "desc_sal_dias";           aValor = #10#21;        |HAZ GrabaTemporal;
     aCampo = "desc_sal_valor";          aValor = #10#22;        |HAZ GrabaTemporal;
     nNume = #10#125 + #10#126;
     aCampo = "horas_extraordinarias";  aValor = nNume;        |HAZ GrabaTemporal;
     || aCampo = "horas_extraordinarias";  aValor = #10#37;        |HAZ GrabaTemporal;
     aCampo = "gratificaciones_extra";  aValor = #10#39;        |HAZ GrabaTemporal;
     aCampo = "salario_especie";        aValor = #10#45;        |HAZ GrabaTemporal;

     || aCampo = "comp_sal_des_1";    aValor = #10#63;        |HAZ GrabaTemporal;
     || aCampo = "comp_sal_imp_1";    aValor = #10#24;        |HAZ GrabaTemporal;

     |PARA i = 2; |SI i [ 24; |HACIENDO i = i + 1;
          aAlfa = i;

          aCampo = "comp_sal_imp_" + aAlfa;
          nume1 = i + 22;
          |SI i ! 17;     || el 17 se repite para la paga extra (#10#39)
               |SI #10nume1 ! 0;
                    aValor = #10nume1;
                    |HAZ GrabaTemporal;

                    aCampo = "comp_sal_des_" + aAlfa;
                    nume2 = i + 61;
                    aValor = #10nume2;
                    |HAZ GrabaTemporal;
               |FINSI;
          |FINSI;
     |SIGUE;

     aCampo = "indemnizacion_1";   aValor = #10#93;        |HAZ GrabaTemporal;
     aCampo = "indemnizacion_2";   aValor = #10#54;        |HAZ GrabaTemporal;
     aCampo = "indemnizacion_3";   aValor = #10#94;        |HAZ GrabaTemporal;
     aCampo = "indemnizacion_4";   aValor = #10#55;        |HAZ GrabaTemporal;

     nEnfer = 0;
     nAccid = 0;
     |SI #0#10 = 2;                || parche para que en atrasos refundido
          #10#186 = "";            || me pinte bien las prestaciones por IT
          #10#187 = "";
          #10#188 = "";
          #10#189 = "";
          |SI #10#103 > 0;
               nEnfer = 1;
               #10#186 = "Enfermedad";
          |FINSI;
          |SI #10#104 > 0;
               nAccid = 1;
               #10#187 = "Accidente ";
          |FINSI;
     |FINSI;
     |PARA i = 186; |SI i [ 189; |HACIENDO i = i + 1;
          para1 = i;
          para2 = i - 8;
          para3 = i - 4;
          |SI #10para1 = "Enfermedad";
               |HAZ ultimodia;
               |SI nEnfer [ 1;
                    |SI nEnfer = 0;
                         aCampo = "prestacion1"; aValor = "Enfermedad"; |HAZ GrabaTemporal;
                         |SI #0#10 ! 2;
                              aCampo = "al1";         aValor = "al";         |HAZ GrabaTemporal;
                              aCampo = "del1";        aValor = "del";        |HAZ GrabaTemporal;
                              aCampo = "prestacion1_del";  aValor = #10para2; |HAZ GrabaTemporal;
                              aCampo = "prestacion1_al";   aValor = #10para3; |HAZ GrabaTemporal;
                         |FINSI;
                    |SINO;
                         aCampo = "prestacion11"; aValor = "Enfermedad"; |HAZ GrabaTemporal;
                         |SI #0#10 ! 2;
                              aCampo = "al11";         aValor = "al";         |HAZ GrabaTemporal;
                              aCampo = "del11";        aValor = "del";        |HAZ GrabaTemporal;
                              aCampo = "prestacion11_del";  aValor = #10para2; |HAZ GrabaTemporal;
                              aCampo = "prestacion11_al";   aValor = #10para3; |HAZ GrabaTemporal;
                         |FINSI;
                    |FINSI;
               |FINSI;
               nEnfer  = nEnfer + 1;
          |FINSI;
          |SI #10para1 = "Accidente ";
               |HAZ ultimodia;
               |SI nAccid [ 1;
                    |SI nAccid = 0;
                         aCampo = "prestacion2"; aValor = "Accidente "; |HAZ GrabaTemporal;
                         |SI #0#10 ! 2;
                              aCampo = "al2";         aValor = "al";         |HAZ GrabaTemporal;
                              aCampo = "del2";        aValor = "del";        |HAZ GrabaTemporal;
                              aCampo = "prestacion2_del";  aValor = #10para2; |HAZ GrabaTemporal;
                              aCampo = "prestacion2_al";   aValor = #10para3; |HAZ GrabaTemporal;
                         |FINSI;
                    |SINO;
                         aCampo = "prestacion21"; aValor = "Accidente "; |HAZ GrabaTemporal;
                         |SI #0#10 ! 2;
                              aCampo = "al21";         aValor = "al";         |HAZ GrabaTemporal;
                              aCampo = "del21";        aValor = "del";        |HAZ GrabaTemporal;
                              aCampo = "prestacion21_del";  aValor = #10para2; |HAZ GrabaTemporal;
                              aCampo = "prestacion21_al";   aValor = #10para3; |HAZ GrabaTemporal;
                         |FINSI;
                    |FINSI;
               |FINSI;
               nAccid = nAccid + 1;
          |FINSI;
     |SIGUE;
     |SI nEnfer > 0;
          |SI nEnfer = 1;
               aCampo = "prestacion1_mes";  aValor = #10#103; |HAZ GrabaTemporal;
          |SINO;
               aCampo = "prestacion11_mes";  aValor = #10#103; |HAZ GrabaTemporal;
          |FINSI;
     |FINSI;
     |SI nAccid > 0;
          |SI nAccid = 1;
               aCampo = "prestacion2_mes";  aValor = #10#104; |HAZ GrabaTemporal;
          |SINO;
               aCampo = "prestacion21_mes";  aValor = #10#104; |HAZ GrabaTemporal;
          |FINSI;
     |FINSI;

     aCampo = "traslado_1";        aValor = #10#95;        |HAZ GrabaTemporal;
     aCampo = "traslado_2";        aValor = #10#56;        |HAZ GrabaTemporal;
     aCampo = "traslado_3";        aValor = #10#96;        |HAZ GrabaTemporal;
     aCampo = "traslado_4";        aValor = #10#57;        |HAZ GrabaTemporal;

     aCampo = "otras_percep1";      aValor = #10#97;        |HAZ GrabaTemporal;
     aCampo = "otras_percep1_imp";  aValor = #10#58;        |HAZ GrabaTemporal;
     aCampo = "otras_percep2";      aValor = #10#90;        |HAZ GrabaTemporal;
     aCampo = "otras_percep2_imp";  aValor = #10#51;        |HAZ GrabaTemporal;
     aCampo = "otras_percep3";      aValor = #10#98;        |HAZ GrabaTemporal;
     aCampo = "otras_percep3_imp";  aValor = #10#59;        |HAZ GrabaTemporal;
     aCampo = "otras_percep4";      aValor = #10#91;        |HAZ GrabaTemporal;     aCampo = "otras_percep4_imp";  aValor = #10#52;        |HAZ GrabaTemporal;

     aCampo = "otras_percep5";      aValor = #10#99;        |HAZ GrabaTemporal;
     aCampo = "otras_percep5_imp";  aValor = #10#60;        |HAZ GrabaTemporal;
     aCampo = "otras_percep6";      aValor = #10#92;        |HAZ GrabaTemporal;
     aCampo = "otras_percep6_imp";  aValor = #10#53;        |HAZ GrabaTemporal;
     aCampo = "otras_percep7";      aValor = #10#100;       |HAZ GrabaTemporal;
     aCampo = "otras_percep7_imp";  aValor = #10#61;        |HAZ GrabaTemporal;
     aCampo = "otras_percep8";      aValor = #10#86;        |HAZ GrabaTemporal;
     aCampo = "otras_percep8_imp";  aValor = #10#47;        |HAZ GrabaTemporal;
     aCampo = "otras_percep9";      aValor = #10#88;        |HAZ GrabaTemporal;
     aCampo = "otras_percep9_imp";  aValor = #10#49;        |HAZ GrabaTemporal;
     aCampo = "otras_percep10";     aValor = #10#87;        |HAZ GrabaTemporal;
     aCampo = "otras_percep10_imp"; aValor = #10#48;        |HAZ GrabaTemporal;
     aCampo = "otras_percep11";     aValor = #10#89;        |HAZ GrabaTemporal;
     aCampo = "otras_percep11_imp"; aValor = #10#50;        |HAZ GrabaTemporal;

     aCampo = "cont_comunes_porc";  aValor = #10#127;        |HAZ GrabaTemporal;
     aCampo = "cont_comunes_tot";   aValor = #10#131;        |HAZ GrabaTemporal;
     aCampo = "desempleo_porc";     aValor = #10#162;        |HAZ GrabaTemporal;
     aCampo = "desempleo_tot";      aValor = #10#164;        |HAZ GrabaTemporal;
     aCampo = "form_profe_porc";    aValor = #10#163;        |HAZ GrabaTemporal;
     aCampo = "form_profe_tot";     aValor = #10#165;        |HAZ GrabaTemporal;
     aCampo = "fuerza_mayor_porc";  aValor = #10#129;        |HAZ GrabaTemporal;
     aCampo = "fuerza_mayor_tot";   aValor = #10#133;        |HAZ GrabaTemporal;
     aCampo = "no_estruct_porc";    aValor = #10#130;        |HAZ GrabaTemporal;
     aCampo = "no_estruct_tot";     aValor = #10#134;        |HAZ GrabaTemporal;
     aCampo = "irpf1_porc";         aValor = #10#135;        |HAZ GrabaTemporal;
     aCampo = "irpf1_tot";          aValor = #10#157;        |HAZ GrabaTemporal;
     aCampo = "irpf2_tot";          aValor = #10#158;        |HAZ GrabaTemporal;
     nNume = #10#158;
     |SI nNume ! 0;
          aCampo = "irpf2_porc";
          aValor = #10#151;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "irpf3_tot";          aValor = #10#159;        |HAZ GrabaTemporal;
     nNume = #10#159;
     |SI nNume ! 0;
          aCampo = "irpf3_porc";
          aValor = #10#152;
          |HAZ GrabaTemporal;
     |FINSI;
     aCampo = "irpf1_base";         aValor = #10#153;        |HAZ GrabaTemporal;
     aCampo = "irpf2_base";         aValor = #10#154;        |HAZ GrabaTemporal;
     aCampo = "irpf3_base";         aValor = #10#155;        |HAZ GrabaTemporal;

     aCampo = "anticipos";          aValor = #10#160;        |HAZ GrabaTemporal;
     aCampo = "productos_especie";  aValor = #10#140;        |HAZ GrabaTemporal;

     aCampo = "otras_deducciones1";      aValor = #10#170;        |HAZ GrabaTemporal;
     aCampo = "otras_deducciones1_tot";  aValor = #10#161;        |HAZ GrabaTemporal;

     aCampo = "total_aportaciones";      aValor = #10#137;        |HAZ GrabaTemporal;
     aCampo = "total_a_deducir";         aValor = #10#141;        |HAZ GrabaTemporal;
     aCampo = "liquido_a_percibir";      aValor = #10#142;        |HAZ GrabaTemporal;
     aCampo = "total_devengado";         aValor = #10#118;        |HAZ GrabaTemporal;

     aCampo = "dia_firma";               aValor = #10#143;        |HAZ GrabaTemporal;
     aCampo = "mes_firma";               aValor = #10#144;        |HAZ GrabaTemporal;
     aCampo = "anyo_firma";              aValor = #10#145;        |HAZ GrabaTemporal;
     aCampo = "localidad";               aValor = #labempre#6;    |HAZ GrabaTemporal;


     nSwNumer = 0;       || para que deje los ceros

     aCampo = "moneda";                  aValor = #10#173;        |HAZ GrabaTemporal;
     aCampo = "equivalencia";            aValor = #10#174;        |HAZ GrabaTemporal;
     || aCampo = "firma1";                  aValor = #10#146;        |HAZ GrabaTemporal;
     || aCampo = "firma2";                  aValor = #10#148;        |HAZ GrabaTemporal;
     aCampo = "comen1";
     aValor = #10#146;          |QBF aValor; aValor = aValor + " ";
     aValor = aValor + #10#147; |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "comen2";
     aValor = #10#148; |QBF aValor; aValor = aValor + " ";
     aValor = aValor + #10#149; |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "X";
     aValor = #10#146;          |QBF aValor; aValor = aValor + " ";
     aValor = aValor + #10#147; |QBF aValor; aValor = aValor + " ";
     aValor = aValor + #10#148; |QBF aValor; aValor = aValor + " ";
     aValor = aValor + #10#149; |QBF aValor;
     |HAZ GrabaTemporal;

     nSwNumer = 1;       || para que NO deje los ceros

     aCampo = "base_contin_comunes";         aValor = #10#123;        |HAZ GrabaTemporal;
     aCampo = "remuneracion_mensual";        aValor = #10#119;        |HAZ GrabaTemporal;
     aCampo = "prorrata_pagas_extra";        aValor = #10#120;        |HAZ GrabaTemporal;
     aCampo = "total";                       aValor = #10#121;        |HAZ GrabaTemporal;
     aCampo = "base_contin_profesionales";   aValor = #10#124;        |HAZ GrabaTemporal;

     aCampo = "base_cot_adici_horas_extra";  aValor = #10#125;        |HAZ GrabaTemporal;
     aCampo = "base_sujeta_reten_IRPF";      aValor = #10#136;        |HAZ GrabaTemporal;
     aCampo = "base_cot_volun_horas_extra";  aValor = #10#126;        |HAZ GrabaTemporal;
     nNume = #10#125 + #10#126;
     aCampo = "base_HE";  aValor = nNume;        |HAZ GrabaTemporal;
     nNume = #10#153 + #10#154;
     aCampo = "base_IRPF";  aValor = nNume;        |HAZ GrabaTemporal;

     aCampo = "acum_sal";         aValor = #10#166;        |HAZ GrabaTemporal;
     aCampo = "acum_ret";         aValor = #10#167;        |HAZ GrabaTemporal;
     aCampo = "acum_seg";         aValor = #10#168;        |HAZ GrabaTemporal;

     aAlfa = #10#1; aAlfa = "00000" + aAlfa; aAlfa = aAlfa % -105;
     aValor = aAlfa + "-";
     aAlfa = #10#2; aAlfa = "00000" + aAlfa; aAlfa = aAlfa % -105;
     aValor = aValor + aAlfa;
     aCampo = "cod_tra";     |HAZ GrabaTemporal;

     aAlfa = #labempre#19; aAlfa = "00000" + aAlfa; aAlfa = aAlfa % -105;
     aValor = aAlfa + "-";
     aAlfa = #labtraba#32; aAlfa = "000" + aAlfa; aAlfa = aAlfa % -103;
     aValor = aValor + aAlfa + "-";
     aAlfa = #nomtraca#3; aAlfa = "00" + aAlfa; aAlfa = aAlfa % -102;
     aValor = aValor + aAlfa;
     aCampo = "cod_eec";     |HAZ GrabaTemporal; || entidad-epi-cte

     enCodBanco = #labtraba#71;
     |HAZ LeeBancos;
     aValor = #709#1;
     |QBF aValor;
     aCampo = "banco";   |HAZ GrabaTemporal;

     aValor = #labtraba#72 % 104; aValor = aValor + " ";
     aValor = aValor + (#labtraba#72 % 504); aValor = aValor + " ";
     aValor = aValor + (#labtraba#72 % 910); aValor = aValor + " ";
     aValor = aValor + (#labtraba#72 % 1902);
     aCampo = "cuenta";  |HAZ GrabaTemporal;

     aCampo = "fecha_nac";      aValor = #labtraba#11;   |HAZ GrabaTemporal;

     nDesc3 = 0;
     nDesc25 = 0;
     nAscen = 0;

     |BUCLE agidanif;

     |SI nDesc3 ! 0;
          aCampo = "desc_3";  aValor = nDesc3;         |HAZ GrabaTemporal;
     |FINSI;
     |SI nDesc25 ! 0;
          aCampo = "desc_25"; aValor = nDesc25;        |HAZ GrabaTemporal;
     |FINSI;
     |SI nAscen ! 0;
          aCampo = "ascen";   aValor = nAscen;         |HAZ GrabaTemporal;
     |FINSI;

     nSwNumer = 0;       || para que deje los ceros
|FPRC;

|PROCESO DatosPersonales;
     |SI #agidanif#2 = "TITULAR     ";
          aCampo = "sit_lab";
          aAlfa = #agidanif#36; |QBF aAlfa;
          aAlfa = "A" + aAlfa;
          aValor = aAlfa;
          |HAZ GrabaTemporal;

          aCampo = "sit_fam";      aValor = #agidanif#15;    |HAZ GrabaTemporal;
          aValor = #agidanif#17;
          |QBF aValor;
          |SI aValor ! "";
               aValor = aValor + "%";
          |FINSI;
          aCampo = "grado_minus";  aValor = #agidanif#17;    |HAZ GrabaTemporal;
     |FINSI;
     |SI #agidanif#2 = "CONYUGE     ";
          aCampo = "nif_conyuge";  aValor = #agidanif#8;    |HAZ GrabaTemporal;
     |FINSI;
     |SI #agidanif#2 = "DESCENDIENTE";
          aAlfa1 = #agidanif#13;
          |QBF aAlfa1;
          aAlfa1 = aAlfa1 % -104;
          nNume1 = aAlfa1;              || El anyo de nacimiento
          fFecha = ~;
          aAlfa2 = fFecha;
          aAlfa2 = aAlfa2 % -104;
          nNume2 = aAlfa2;              || El anyo actual
          nEdad = nNume2 - nNume1;
          |SI nEdad < 3;
               nDesc3 = nDesc3 + 1;
          |FINSI;
          |SI nEdad ] 3; |Y nEdad < 25;
               nDesc25 = nDesc25 + 1;
          |FINSI;
     |FINSI;
     |SI #agidanif#2 = "ASCENDIENTE ";
          nAscen = nAscen + 1;
     |FINSI;
|FPRC;

|PROCESO PonDecimales;
     aVar = aAlfa;
     nVar = aAlfa;
     aLong = aVar % 0;
     nLong = aLong;
     aMod = "";
     |PARA nPara = 1; |SI nPara [ nLong; |HACIENDO nPara = nPara + 1;
          nPos = (nPara * 100) + 1;
          aAlfa = aVar % nPos;
          |SI aAlfa = ".";
               nAlfa = aMod;
               |SI nDec = 6;
                    aVar = aVar + "000000";
                    nPos = 100 + (nPara + 6);
                    aVar = aVar % nPos;
               |FINSI;
               |SI nDec = 2;
                    aVar = aVar + "00";
                    nPos = 100 + (nPara + 2);
                    aVar = aVar % nPos;
               |FINSI;
               |SAL;
          |FINSI;
          |SI nPara = nLong;
               |SI nDec = 6;
                    aVar = aVar + ".000000";
               |FINSI;
               |SI nDec = 2;
                    aVar = aVar + ".00";
               |FINSI;
          |FINSI;
          aMod = aMod + aAlfa;
     |SIGUE;
|FPRC;
