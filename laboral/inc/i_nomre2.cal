|FICHEROS;
     nomcateg;
     nomimpr1;
     nomimpr2;
     nomabsli;
     nomconli;
     gomccchi;
     motibaja;
|FIN;

|VARIABLES;
     &swStop = 0;
     numerl = 0;
     &aFechaBaja = "";
     &aMotivo = "";
     aDiaDesde = "";
     aDiaHasta = "";
     aTipoBaja = "";
     nCampo1 = 0;
     nCampo2 = 0;
     nCampo3 = 0;
     fFechaDesde = @;
     fFechaHasta = @;
     aFecha = "";
     aDia = "";
     aMes = "";
     aAny = "";
     aDesde = "";
     FEstadoC = 0;
     swInc = 0;
|FIN;

/************* PROCESOS VARIADOS QUE YA NO CABEN EN EL PUTO NOMRECIN ********/

|PROCESO &quitaval;
     |DDEFECTO #100;
     #100#0 = #2#87;
     #100#1 = infctos;
     |LEE 000#100=;
     |SI #100#3 = "N";    infunid = 0;   |FINSI;
     |SI #100#4 = "N";    infvalo = 0;   |FINSI;
     |SI #100#5 = "N";    infptas = 0;   |FINSI;
|FPRC;

/*****************************************************************/
/*  HISTORICO-PAGAS-ABIERTA                                      */
/*****************************************************************/

|PROCESO desglosaPagHistoAb;
|SI desglo = "S";
    |MENSA "0402Preparando desglose ...";
    |HAZ control;
        dalfa1 = Usuario; |QBF dalfa1; dalfa1 = "c" + dalfa1;
    |NOME_DAT #95 dalfa1;
        dalfa1 = Usuario; |QBF dalfa1; dalfa1 = "l" + dalfa1;
    |NOME_DAT #96 dalfa1;
    |ABRE #2;            || trabajadores
    |ABRE #95;            || tmp. calculos cabs.
    |ABRE #96;            || tmp. calculos lins.
    |ABRE #12;           || calculos lins.
    |ABRE #102;           || convenios cabs.
    |HAZ d_seleccionPagHistoAb;
    |CIERRA #2;
    |CIERRA #95;
    |CIERRA #96;
    |CIERRA #12;
    |CIERRA #102;
    |BLIN 4;
|SINO;
    |NOME_DAT #95 "nomhicca";
    |NOME_DAT #96 "nomhicli";
|FINSI;
|FPRC;

|PROCESO procesoPagHistoAb;
    seleccio = 1;   || para saber si se ha leido algo
    lineas = 0;
    swbaja = 0;
|DDEFECTO #10;
|DDEFECTO #15;
nEmp = #95#0; nTra = #95#1;
|HAZ comple_0;    ||lee empresa, trabajador y constante
|HAZ StopComercio; |SI swStop = 1; |ACABA; |FINSI;
|SI #0#66 < #2#77;|O #0#65 > #2#77;     || seleccion centros
     |ACABA;
|FINSI;
nContrato = #95#9;
|HAZ comple_1;           || construye literales datos empresa
|HAZ comple_2;           || construye periodo de liquidacion nomina
|HAZ comple_5PagHisto;   || CONSTRUYE FECHA LITERAL DEL RECIBI
situac = 0;
|BUCLELIN 0cargas_1PagHistoAb#95;   || carga campos lineas calculos
|HAZ comple_4PagHisto;   || halla totales varios
|HAZ cargas_0PagHistoAb;           || carga campos cabecera calculos
|SI lineas = 1;              || para saber si hay conceptos 2?? !!!
    |HAZ cargas_2PagHistoAb;           || carga campos totales
    |HAZ graba_irpfpagaHis;
     |SI nOpcion = 2;
          |HAZ IMPREArchi;
     |SINO;
          |INFOR "nomyabie";
     |FINSI;
        alguno = 0;
        ninguno = 0;
        situac2 = 0;
    |PARA situac = 1; |SI situac [ 39; |HACIENDO situac = situac + 1;
            camctos = situac + 116;  infctos = #15camctos;
            camptas = situac + 22;   infptas = #10camptas;
            camdesc = situac + 77;   infdesc = #15camdesc;
            camunid = situac -  1;   infunid = #15camunid;
            camvalo = situac + 38;   infvalo = #15camvalo;
            camunia = situac + 155;  infunia = #15camunia;
            retoded = "R";
        |SI infptas ! 0;
                alguno = 1;
                ninguno = ninguno + 1;
            |PRINT;
            |SI ninguno = 15;
                    situac2 = situac + 1;
                    situac = 39;
            |FINSI;
        |FINSI;
    |SIGUE;
        linea16 = 0;
    |SI situac2 ! 0;
        |PARA situac=situac2;|SI situac[39; |HACIENDO situac=situac+1;
                camctos = situac + 116;  infctos = #15camctos;
                camptas = situac + 22;   infptas = #10camptas;
                camdesc = situac + 77;   infdesc = #15camdesc;
                camunid = situac -  1;   infunid = #15camunid;
                camvalo = situac + 38;   infvalo = #15camvalo;
                camunia = situac + 155;  infunia = #15camunia;
                linea16 = linea16 + infptas;
        |SIGUE;
        |SI linea16 ! 0;
                alguno = 1;
                infctos = 0;
                infptas = linea16;
                infdesc = "GLOBAL VARIOS ...";
                infunid = 1;
                infunia = 1;
                infvalo = 1;
            |PRINT;
        |FINSI;
    |FINSI;
          |SI alguno = 1; |O Impresora = "CrystalReport";
               |HAZ LineasDto;
               |SI Impresora = "CrystalReport";
                    |HAZ imprime;
               |SINO;
                    |PIEINF;
                    |HAZ ElFININF;
               |FINSI;
          |SINO;
               |SI #10#142 ! 0;
                    infctos = 0;
                    infptas = 0;
                    infdesc = "-------------------------";
                    infunid = 0;
                    infunia = 0;
                    infvalo = 0;
                    |PRINT;
                    |HAZ imprime;
               |SINO;
                    |HAZ ElFININF;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE nomwpaga0Abierta;
 #95#1;
 ;
 #0#0, #0#2, #0#4, #0#5, 0;
 #0#1, #0#3, #0#4, #0#5, 0;
 ;
 NULL, procesoPagHistoAb;
|FIN;


|PROCESO ordenaPagHistoAb;
|DDEFECTO #1;
    #1#0 = #95#0;
|LEE 000#1=;

|DDEFECTO #2;
    #2#0 = #95#0;
    #2#1 = #95#1;
|LEE 000#2=;

|DDEFECTO #102;
    #102#0 = #2#87;
|LEE 000#102=;

|HAZ cta_cotizacion;
    #0#64 = cta_co;
|FPRC;

|DEFBUCLE nombresPagHistoAb;
 #95#1;
 ;
 nDesdeEmp, nDesdeTra, #0#4, #0#5, 0;
 nHastaEmp, nHastaTra, #0#4, #0#5, 0;
 ;
 NULL, ordenaPagHistoAb, NULL, NULL, NULL, procesoPagHistoAb;
 #2#0, #2#2, #2#1, #95#3;
|FIN;

|DEFBUCLE areasPagHistoAb;
 #95#1;
 ;
 nDesdeEmp, nDesdeTra, #0#4, #0#5, 0;
 nHastaEmp, nHastaTra, #0#4, #0#5, 0;
 ;
 NULL, ordenaPagHistoAb, NULL, NULL, NULL, procesoPagHistoAb;
 #2#0, #2#62, #2#63, #2#1, #95#3;
|FIN;

|DEFBUCLE centrosPagHistoAb;
 #95#1;
 ;
 nDesdeEmp, nDesdeTra, #0#4, #0#5, 0;
 nHastaEmp, nHastaTra, #0#4, #0#5, 0;
 ;
 NULL, ordenaPagHistoAb, NULL, NULL, NULL, procesoPagHistoAb;
 #2#0, #2#77, #2#1, #95#3;
|FIN;

|DEFBUCLE tc2PagHistoAb;
 #95#1;
 ;
 nDesdeEmp, nDesdeTra, #0#4, #0#5, 0;
 nHastaEmp, nHastaTra, #0#4, #0#5, 0;
 ;
 NULL, ordenaPagHistoAb, NULL, NULL, NULL, procesoPagHistoAb;
 #2#0, #0#64, #102#142, #2#75, #2#1, #95#3;
|FIN;

|PROCESO impreHPA2;
     |SI swPorGrupos = 0;
          nDesdeEmp = #0#0;
          nHastaEmp = #0#1;
          nDesdeTra = #0#2;
          nHastaTra = #0#3;
     |SINO;
          nDesdeEmp = #nomgruel#1;
          nHastaEmp = #nomgruel#1;
          nDesdeTra = 00001;
          nHastaTra = 99999;
     |FINSI;
     |SI #0#63 = 1;    |BUCLE nomwpaga0Abierta;   |FINSI;
     |SI #0#63 = 2;    |BUCLE nombresPagHistoAb;     |FINSI;
     |SI #0#63 = 3;    |BUCLE areasPagHistoAb;       |FINSI;
     |SI #0#63 = 4;    |BUCLE centrosPagHistoAb;     |FINSI;
     |SI #0#63 = 5;    |BUCLE tc2PagHistoAb;         |FINSI;
|FPRC;

|DEFBUCLE HPAGrupo;         || lee empresas del grupo
     #nomgruel#1;
     ;
     nGrupo, 00001;
     nGrupo, 99999;
     ;
     NULL, impreHPA2;
|FIN;

|PROCESO HPAPorGrupos;
     swPorGrupos = 1;
     |PARA nCampoG = 70; |SI nCampoG [ 77; |HACIENDO nCampoG = nCampoG + 1;
          nGrupo = #0nCampoG;
          |BUCLE HPAGrupo;
     |SIGUE;
|FPRC;

|PROCESO impreHPA; |TIPO 3;
     c_informe = "nomyabie";
     |HAZ cuadres;
     |SI sw_cuadre = 0;
          desglo = #0#14;
          |HAZ desglosaPagHistoAb;
          |HAZ control;
          |ABRE #1;
          |ABRE #2;
          |ABRE #3;
          |ABRE #6;
          |ABRE #100;
          |ABRE #35;
          |ABRE #102;
          |HAZ ElIMPRE;
          |SI FEstado = 0;
               seleccio = 0;
               |SI #0#21 = 0;
                    |SI #0#70 = 0;
                         |HAZ impreHPA2;
                    |SINO;
                         |HAZ HPAPorGrupos;
                    |FINSI;
               |SINO;
                    |HAZ salteadaPagasHisto;
               |FINSI;
          |SINO;
               |MENAV "    Proceso ABORTADO !!!";
          |FINSI;
          |HAZ ElFINIMP;
          |SI seleccio = 0;
               |MENAV "    Seleccion vacia ...";
          |FINSI;
          |CIERRA #1;
          |CIERRA #2;
          |CIERRA #3;
          |CIERRA #6;
          |CIERRA #100;
          |CIERRA #35;
          |CIERRA #102;
          |SI desglo = "S";
               |DELINDEX #95;
               |DELINDEX #96;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cargas_0PagHistoAb;      || CARGA LOS CAMPOS LITERALES Y LOS FIJOS
    #10#000 = #1#10;          || cif empresa
    #10#001 = #1#00;          || codigo empresa
    #10#002 = #2#01;          || codigo trabajador
    #10#003 = #1#02;          || nombre empresa
    #10#004 = domemp;         || direccion empresa
    #10#005 = pobemp;         || poblacion empresa
    #10#006 = #2#02;          || nombre trabajador
    |HAZ BuscaCateg;          || categoria profesional
    #10#008 = #2#238;         || puesto de trabajo
    #10#009 = afili;          || s.s. empresa
    #10#010 = #2#38;          || fecha impresion
    #10#011 = #2#31;          || nro. de matricula
    #10#012 = #2#07;          || d.n.i. trabajador
    #10#013 = #2#75;          || s.s. trabajador
    #10#172 = #2#77;          || centro de trabajo
    #10#017 = mesliq;         || hasta el mes
    #10#018 = #0#04;          || a¤o confeccion
    |SI #10#18 > 80;  #10#18 = #10#18 + 1900;  |SINO;  #10#18 = #10#18 + 2000;  |FINSI;
    #10#122 = #2#33;          || grupo de cotizacion
    #10#135 = #95#129;          || (%) I.R.P.F.
    #10#141 = deducir;        || total a deducir
    #10#139 = #95#128;         || total anticipos
    #10#175 = #95#128;         || anticipos paga extra
    #10#143 = diarec;         || dia RECIBI
    #10#144 = mesrec;         || mes RECIBI
    #10#145 = anyrec;         || a¤o RECIBI
    |SI #10#145 > 80;  #10#145 = #10#145 + 1900;  |SINO;  #10#145 = #10#145 + 2000;  |FINSI;
    alfa1 = #2#49 % 101;
|SI alfa1 ! "*";
        #10#146 = #2#49 % 130;    || comentario
|FINSI;
    #10#150 = "GRATIFICACION EXTRAORDINARIA";  || literal

nEmpresa=#95#0;   || empresa
nTrabajador=#95#1;   || trabajador
nMes=#95#2;   || mes
nTipo=#95#3;   || tipo
|HAZ ComentariosNomvarca;
|FPRC;

|PROCESO cargas_1_ambosPagHistoAb;
|SI swbaja = 1;
    |SI #2#48 = "N";  incluye = 1;  |FINSI;  || si no es finiquito
|SINO;
    |SI #1#25 = 1;    incluye = 1;  |FINSI;  || si la paga va separada
|FINSI;
|SI incluye = 1;
        lineas = 1;   || para saber si se ha cargado algo de conceptos 2??
    |HAZ leedescriPagHistoAb;
        camptas = situac + 22;
        camdesc = situac + 77;
        camunid = situac -  1;
        camvalo = situac + 38;
        camunia = situac + 155;
        #15camdesc = #100#2;                      || descripcion ampliada
        #10camptas = #10camptas + import;        || devengado
    |SI concep = 515;
            #15camunid = 0;        || unidades cero en ENF.EMP.
            #15camunia = 0;
            #15camvalo = #95#35;    || promedio de enfermedad en ENF.EMP.
    |SINO;
            #15camunia = #15camunia + uniant;        || unidades anterior
            #15camunid = #15camunid + unidad;        || unidades
            #15camvalo = #10camptas / #15camunid;    || valor base
    |FINSI;
    |SI concep = 101;
            dcal_101 = #96#05;
            duni_101 = unidad;
    |FINSI;
    |SI #10#19 < unidad;  #10#19 = unidad;  |FINSI;     || dias alta
    |SI concep ] 201; |Y concep < 208;
        |HAZ BuscaImpDifer;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO cargas_1_conPagHistoAb;
|SI concep < 201; |O concep > 208; |O #96#5 = "X";
    |HAZ cargas_1_ambosPagHistoAb;
|FINSI;
|FPRC;

|PROCESO cargas_1_sinPagHistoAb;
|SI concep ] 201; |Y concep [ 208; |Y #96#5 ! "P";
    |HAZ cargas_1_ambosPagHistoAb;
|FINSI;
|FPRC;

|PROCESO cargas_1PagHistoAb;       || CARGA LOS CAMPOS SEGUN SU SITUACION
    incluye = 0;
    concep = #96#04;
    situac = #96#07;
    descri = #96#08;
    unidad = #96#11;      || unidades calculo
    uniant = #96#09;
    valor  = #96#10;
    import = unidad * valor;
|SI situac ! 0;|Y import ! 0;
    |SI desglo = "N";   |HAZ cargas_1_sinPagHistoAb;  |FINSI;
    |SI desglo = "S";   |HAZ cargas_1_conPagHistoAb;  |FINSI;
|FINSI;
|HAZ Dtos;
|FPRC;

|PROCESO cargas_2PagHistoAb;       || CARGA LOS CAMPOS TOTALES
    #10#021 = duni_101;
|SI #10#021 < 0;
        #10#021 = 0;                                   || si es neg., igual a 0
        #10#022 = 0;
|SINO;
        #10#022 = #10#23 / #10#21;                     || valor salario base
|FINSI;
|SI #10#022 = 0;  #10#021 = 0;  |FINSI;   || si valor es 0, unidades tambien
|PARA campo = 24; |SI campo [ 28;  |HACIENDO campo = campo + 1;
        tot_109 = campo;        #10#109 = #10#109 + #10tot_109;  || personales
        tot_110 = campo +  5;   #10#110 = #10#110 + #10tot_110;  || puesto trab.
        tot_111 = campo + 10;   #10#111 = #10#111 + #10tot_111;  || calidad ...
        tot_112 = campo + 15;   #10#112 = #10#112 + #10tot_112;  || vencimientos
        tot_113 = campo + 20;   #10#113 = #10#113 + #10tot_113;  || en especie
        tot_114 = campo + 25;   #10#114 = #10#114 + #10tot_114;  || acc.empres.
        tot_115 = campo + 30;   #10#115 = #10#115 + #10tot_115;  || indemnizac.
|SIGUE;
    #10#116 = #10#101 + #10#102 + #10#103 + #10#104;    || prestaciones S.S.
    #10#117 = #10#059 + #10#060 + #10#061;              || mejoras voluntarias
|PARA campo = 109; |SI campo [ 117; |HACIENDO campo = campo + 1;
    #10#118 = #10#118 + #10campo;                       || t.devengado parcial
|SIGUE;
    #10#118 = #10#118 + #10#023;                        || t.devengado + s.base
    #10#020 = #10#118;                                  || importe total
    #10#142 = #10#118 - #10#141;                        || liquido a percibir

    #10#136 = #95#16;                                    || base IRPF paga
    #10#138 = #95#17;                                    || ptas. IRPF paga
    #10#153 = #95#16;                                    || base IRPF paga
    #10#157 = #95#17;                                    || ptas. IRPF paga
    |HAZ FinTotales;
|FPRC;

|DDEFECTO #3;
    #3#0 = CodigoCons;
|LEE 020#3=;             || constante

|DDEFECTO #6;
    #6#0 = #2#0;
    #6#1 = #2#77;
|LEE 020#6=;             || centro
|FPRC;

|DEFBUCLE d_nomcalcaPagHistoAb;
 #11#1;
 ;
 #0#0, #0#2, #0#4, #0#5, 0;
 #0#1, #0#3, #0#4, #0#5, 0;
 ;
 NULL, d_proceso_cabPagHistoImpre;
|FIN;

|PROCESO d_salteadaPagHistoAb;
|ABRE #11;
|PARA dsalte_1 = 21; |SI dsalte_1 [ 41; |HACIENDO dsalte_1 = dsalte_1 + 1;
        dsalte_2 = dsalte_1 + 21;
        #11#0 = #0dsalte_1;   || empresa
        #11#1 = #0dsalte_2;   || trabajador
        #11#66= #0#4;         || a¤o
        #11#2 = #0#5;         || mes
        #11#3 = 0;            || tipo
    |LEE 000#11=;
    |SI FSalida = 0;
        |HAZ d_proceso_cabPagHistoImpre;
    |FINSI;
|SIGUE;
|CIERRA #11;
|FPRC;

|PROCESO d_seleccionPagHistoAb;
|SI #0#21  = 0;
    |BUCLE d_nomcalcaPagHistoAb;
|SINO;
    |HAZ d_salteadaPagHistoAb;
|FINSI;
|FPRC;

|PROCESO CompYaEmitida;
     swStop = 0;
     |SALVA_FICHA #labempre;
     #labempre#0 = 301;
     |LEE 000#labempre.=;
     |SI FSalida = 0; |Y #labempre#10 = "B03058542      ";
          |ABRE #nomimpr1;
          #nomimpr1#0 = #94#0;     || emp
          #nomimpr1#1 = #94#1;     || tra
          #nomimpr1#2 = #94#2;     || mes
          #nomimpr1#3 = #94#3;     || tipo
          #nomimpr1#4 = #0#4 + 2000;
          |LEE 101#nomimpr1.=;
          |SI FSalida = 0;
               || si ya he emitido esta paga, aqui no se toca nada
               || esto es por el tiquet 2404.1160, se calculaba la paga de
               || dic. entera, se imprimia y se grababa, y luego al dar
               || el trab. era baja a mediados de dic.
               || Al pasar por aqui, descontaba la paga y ya NO tiene que hacerlo

               || lo hago solo para Hoteles, esto siempre ha estado asi
               || y no me fio de lo que pueda pasar

               swStop = 1;

          |FINSI;
          |CIERRA #nomimpr1;
     |FINSI;
     |REPON_FICHA #labempre;
|FPRC;

|PROCESO Dtos;
     |SI concep ] 201; |Y concep [ 208; |Y #0#10 = 0;
          swStop = 0;
          |HAZ CompYaEmitida;
          |SI swStop = 1;
               |ACABA;
          |FINSI;

          |ABRE #nomconli;
          #nomconli#0 = #2#87;
          #nomconli#2 = concep;
          |LEE 000#nomconli.=;
          swInc = 0;
          |SI FSalida ! 0;
               |CIERRA #nomconli;
               |ACABA;
          |FINSI;

          numer = concep - 200 + 19;
          numerl = concep - 88;
          |SI #0#67 = "M";
               |SI #0#68 = "N"; |Y #5#5 = "P"; |Y #labtraba#numerl# ! "S";
                    |SI #1#25 = 1; |Y incluye = 1; |Y #102numer ! 99; |Y #1#39 ! 1;
                         |SI swbaja ! 1; |Y coment ! 1;
                              || lo del coment ! 1 lo a¤ado para Asefeco que tenia
                              || problemas en nominas con baja el ultimo dia de mes
                              || le a¤adia el irpf de las pagas otra vez sin tener
                              || por que hacerlo, cuidadin que no pase nada
                              || lo pongo solo en v13 (13.03.2007)
                              || (tambien desde el hco, unas lineas mas abajo
                              swInc = 1;
                         |FINSI;
                         |SI coment = 1; |Y swbaja = 0; |Y #nomconli#3 = "P";
                              || a ver, si es baja este mes, con una paga tipo "P"
                              || (o la que sea menos 99) y la fecha de baja es el
                              || ultimo dia del mes (por eso swbaja = 0 y coment = 1)
                              || y las pagas son aparte TENGO que incluir la paga
                              || en el mes, claro
                              swInc = 1;
                         |FINSI;
                         |SI swInc = 1;
                              #4#14 = #4#14 + import;
                              #4#15 = #4#15 + ((import % #4#87) ! 2);
                              #10#141 = #10#141 + ((import % #4#87) ! 2);
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI #0#68 = "P"; |Y #94#5 = "P"; |Y #labtraba#numerl# ! "S";
                    |SI #1#25 = 1; |Y #102numer ! 99;
                         |SI #93#0 = 5114; |Y #93#1 = 4982; |Y #93#2 = 12; |Y #93#3 = 0;
                              || no: caso raro jumram dic 2015, borrar despues
                              || 766.1509
                         |SINO;
                              #93#16 = #93#16 - import;
                              #93#17 = #93#17 - ((import % #93#87) ! 2);
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
/*
          |SI #0#67 = "A";
               |SI #0#68 = "N"; |Y #14#5 = "P"; |Y #labtraba#numerl# ! "S";
                    |SI #1#25 = 1; |Y incluye = 1; |Y #102numer ! 99;
                      |SI swbaja ! 1; |O #1#39 ! 1;
                         #13#14 = #13#14 + import;
                         #13#15 = #13#15 + ((import % #13#87) ! 2);
                         #10#141 = #10#141 + ((import % #13#87) ! 2);
                      |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #0#67 = "H"; |O #0#67 = "T";
*/
          |SI #0#67 = "H";
               |SI #0#68 = "N"; |Y #12#5 = "P"; |Y #labtraba#numerl# ! "S";
                    |SI #1#25 = 1; |Y incluye = 1; |Y #102numer ! 99; |Y #1#39 ! 1;
                      |SI swbaja ! 1; |Y coment ! 1;
                         swInc = 1;
                      |FINSI;
                      |SI coment = 1; |Y swbaja = 0; |Y #nomconli#3 = "P";
                         swInc = 1;
                      |FINSI;
                      |SI swInc = 1;
                         #11#14 = #11#14 + import;
                         #11#15 = #11#15 + ((import % #11#129) ! 2);
                         #10#141 = #10#141 + ((import % #11#129) ! 2);
                      |FINSI;
                    |FINSI;
               |FINSI;
               |SI #0#68 = "P"; |Y #96#5 = "P"; |Y #labtraba#numerl# ! "S";
                    |SI #1#25 = 1; |Y #102numer ! 99;
                         |SI #95#0 = 5114; |Y #95#1 = 4982; |Y #95#2 = 12; |Y #95#3 = 0;
                         |Y #95#66 = 15;
                              || no: caso raro jumram dic 2015, borrar despues
                              || 766.1509
                         |SINO;
                              #95#16 = #95#16 - import;
                              #95#17 = #95#17 - ((import % #95#129) ! 2);
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #nomconli;
     |FINSI;
|FPRC;

|PROCESO Ampliada2;
     ||SI concep = 120; |O concep = 407; |O concep = 411;
     || no se por que motivo pero lo hacia tambien para el 407 y para el 411
     || lo quito 25/01/2007
     |SI concep = 120;
          |SI #labtraba#97 = 2; |O #labtraba#97 = 4;
               |SI #labtraba#213 ] 101;
                    #100#0 = #labtraba#87;
                    #100#1 = #labtraba#213;
                    |LEE 040#100=;
                    |SI FSalida = 0;
                         #10camdesc = #100#2;
                         #15camdesc = #100#2;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaCateg;
/*
     |ABRE #nomcateg;
     #nomcateg#0 = #labtraba#87;
     #nomcateg#1 = #labtraba#17;
     |LEE 000#nomcateg.=;
     |SI FSalida = 0;
          aAlfa = #nomcateg#8;
          |QBF aAlfa;
          |SI aAlfa ! "";
               #10#7 = aAlfa;
          |SINO;
               #10#7 = #labtraba#18;
          |FINSI;
     |FINSI;
     |CIERRA #nomcateg;
*/
     || lo quito, no lo usa nadie
     aAlfa = #labtraba#206;
     |QBF aAlfa;
     |SI aAlfa ! "";
          #10#7 = aAlfa;
     |SINO;
          #10#7 = #labtraba#18;
     |FINSI;
|FPRC;

|PROCESO leedescriNomMensuAb;
    #100#0 = #2#87;
    #100#1 = #5#04;
|LEE 040#100=;
|SI FSalida ! 0;
        #100#0 =   999;
        #100#1 = #5#04;
    |LEE 040#100=;
    |SI FSalida ! 0;
            #100#2 = descri;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO leedescriNomHistoAb;
    #100#0 = #2#87;
    #100#1 = #12#04;
|LEE 040#100=;
|SI FSalida ! 0;
        #100#0 =   999;
        #100#1 = #12#04;
    |LEE 040#100=;
    |SI FSalida ! 0;
            #100#2 = descri;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO leedescriAtrasAb;
    #100#0 = #2#87;
    #100#1 = #14#04;
|LEE 040#100=;
|SI FSalida ! 0;
        #100#0 =   999;
        #100#1 = #14#04;
    |LEE 040#100=;
    |SI FSalida ! 0;
            #100#2 = descri;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO leedescriFinMensu;
     #100#0 = #2#87;
     #100#1 = #5#04;
     |LEE 001#100=;
     aAlfa = "";
     |SI FSalida = 0;
          aAlfa = #100#2;
          |QBF aAlfa;
     |FINSI;
     |SI aAlfa = "";
          #100#0 =   999;
          #100#1 = #5#04;
          |LEE 001#100=;
          |SI FSalida = 0;
               aAlfa = #100#2;
               |QBF aAlfa;
          |FINSI;
          |SI aAlfa = "";
               #100#2 = #5#8;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO leedescriFinHisto;
     #100#0 = #2#87;
     #100#1 = #12#04;
     |LEE 001#100=;
     aAlfa = "";
     |SI FSalida = 0;
          aAlfa = #100#2;
          |QBF aAlfa;
     |FINSI;
     |SI aAlfa = "";
          #100#0 =   999;
          #100#1 = #12#04;
          |LEE 001#100=;
          |SI FSalida = 0;
               aAlfa = #100#2;
               |QBF aAlfa;
          |FINSI;
          |SI aAlfa = "";
               #100#2 = #12#8;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO leedescriPagMensuAb;
     |ABRE #100;
     #100#0 = #2#87;
     #100#1 = #94#04;
     |LEE 040#100=;
     |SI FSalida ! 0;
          #100#0 =   999;
          #100#1 = #94#04;
          |LEE 040#100=;
          |SI FSalida ! 0;
               #100#2 = descri;
          |FINSI;
     |FINSI;
     |CIERRA #100;
|FPRC;

|PROCESO leedescriPagHistoAb;
     |ABRE #100;
    #100#0 = #2#87;
    #100#1 = #96#04;
|LEE 040#100=;
|SI FSalida ! 0;
        #100#0 =   999;
        #100#1 = #96#04;
    |LEE 040#100=;
    |SI FSalida ! 0;
            #100#2 = descri;
    |FINSI;
|FINSI;
     |CIERRA #100;
|FPRC;

/*************** PROCESOS PARA LOS REPRESENTANTES DE COMERCIO ***************/

|PROCESO StopComercio;
     #nomtrnom#229 = #labcentr#2;  || no es el sitio, esta claro

     |SI swComercio = 1;
          |SI #labtraba#247 ! 121;
               swStop = 1;
          |SINO;
               swStop = 0;
          |FINSI;
     |SINO;
          |SI #labtraba#247 = 121;
               swStop = 1;
          |SINO;
               swStop = 0;
          |FINSI;
     |FINSI;

     |SI #0#15 = "S";         || lo siguiente solo si "En baja = N"
          |ACABA;
     |FINSI;
     |SI #0#68 ! "N";         || solo en nominas, no en finiquitos ni pagas
          |ACABA;
     |FINSI;

     |SI #0#67 = "M";                   || MENSUAL
          alfa2 = #nomcalca#5 % 402;
          alfa3 = #nomcalca#5 % -104;
          nume1 = alfa2; || mes baja
          nume2 = alfa3; || a¤o baja
          nume3 = 2000 + #0#4;          || a¤o emision
          |SI nume1 = #0#5; |Y nume2 = nume3;     || soy baja este mes y ya tengo
               swStop = 1;
               |ABRE #nomvarca;              || la nomina calculada,
               #nomvarca#0 = #labtraba#0;    || busco en el nomvarca y si el motivo
               #nomvarca#1 = #labtraba#1;    || de baja no es 08 (cambio de algo)
               #nomvarca#2 = #0#5;           || entonces SI que imprimo
               #nomvarca#3 = 0;
               |LEE 000#nomvarca.=;
               |SI FSalida = 0;
                    |SI #nomcalca#5 = #nomvarca#16;
                         |SI #nomvarca#46 = 08; |O #nomvarca#46 = 09;
                         |O #nomvarca#46 = 10;
                              swStop = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #nomvarca;
          |FINSI;
     |FINSI;
     |SI #0#67 = "H";                   || HISTORICO
          alfa2 = #nomhicca#5 % 402;
          alfa3 = #nomhicca#5 % -104;
          nume1 = alfa2; || mes baja
          nume2 = alfa3; || a¤o baja
          nume3 = 2000 + #0#4;          || a¤o emision
          |SI nume1 = #0#5; |Y nume2 = nume3;     || soy baja este mes y ya tengo
               swStop = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO comple_4NMI_Comercio;        || HALLA TOTALES VARIOS
/*
     tcotiz  = #4#37 + #4#62;
     tbcotiz = tcotiz + #4#38;           || total bases de cotizacion
     |SI #4#40 ! 0;|Y #2#45 ! "087";|Y #2#45 ! "097";|Y #2#45 ! "085";
          apordfp = #3#13+#3#15+#3#17+#3#19;   ||(%) d+fp
          aporfp = #3#17;                      ||(%) fp
          apord = apordfp - aporfp;            ||(%) d
     |SINO;
          apordfp = 0;
          aporfp = 0;
          apord = 0;
     |FINSI;
     |SI #4#41 ! 0;
          aporhe1 = #3#09;                || (%) horas extra estruc.
          |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
               aporhe1 = aporhe1 + #3#13+#3#15+#3#17+#3#19;    || aprendices
          |FINSI;
     |SINO;
          aporhe1 = 0;
     |FINSI;
     |SI #4#42 ! 0;
          aporhe2 = #3#11;                || (%)horas extra no estruc.
          |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
               aporhe2 = aporhe2 + #3#13+#3#15+#3#17+#3#19;    || aprendices
          |FINSI;
     |SINO;
          aporhe2 = 0;
     |FINSI;
     */


     tantici = #4#52 + #4#53;              || total anticipos
     deducir = taporta + #4#75 + tantici + #4#54;  || total a deducir

     |SI swbaja = 0; |Y #1#25 = 2;         || si la paga va junta y no es baja,
          deducir = deducir + #4#17;    || /le suma la parte IRPF de pagas
          tantici = tantici + #4#86;    || y le suma el anticipo Paga Ext(-3-)
          deducir = deducir + #4#86;    || al total anticipos y deducciones
     |FINSI;

     #nomtrnom#192 = #4#48 + #4#49 + #4#50 + #4#51;    || SS Trabajador
     #nomtrnom#193 = #4#45;                            || SS Empresa
     #nomtrnom#194 = #nomtrnom#192 + #nomtrnom#193;    || Total SS
     #nomtrnom#195 = #4#46 - deducir + #nomtrnom#193;  || Total Neto + SS Emp
|FPRC;

|PROCESO comple_4NHI_Comercio;        || HALLA TOTALES VARIOS
/*
    tcotiz  = #11#37 + #11#62;
    tbcotiz = tcotiz + #11#38;                || total bases de cotizacion
|SI #11#40 ! 0;|Y #2#45 ! "087";|Y #2#45 ! "097";|Y #2#45 ! "085";
        apordfp = #3#13+#3#15+#3#17+#3#19;   ||(%) d+fp
        aporfp = #3#17;                      ||(%) fp
        apord = apordfp - aporfp;            ||(%) d
|SINO;
        apordfp = 0;
        aporfp = 0;
        apord = 0;
|FINSI;
|SI #11#41 ! 0;
        aporhe1 = #3#09;                || (%) horas extra estruc.
    |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
            aporhe1 = aporhe1 + #3#13+#3#15+#3#17+#3#19;    || aprendices
    |FINSI;
|SINO;
        aporhe1 = 0;
|FINSI;
|SI #11#42 ! 0;
        aporhe2 = #3#11;                || (%)horas extra no estruc.
    |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
            aporhe2 = aporhe2 + #3#13+#3#15+#3#17+#3#19;    || aprendices
    |FINSI;
|SINO;
        aporhe2 = 0;
|FINSI;
    taporta = #11#48 + #11#49 + #11#50 + #11#51;           || total aportacion
    tantici = #11#52 + #11#53 + #11#128;                   || total anticipos
*/
    nume1   = #11#15 + #11#110 + #11#111;                 || total retenciones
    deducir = taporta + nume1 + tantici + #11#54;       || total a deducir

|SI swbaja = 0; |Y #1#25 = 2;           || si la paga va junta y no es baja,
        deducir = deducir + #11#17;      || /le suma la parte IRPF de pagas
        tantici = tantici + #11#128;    || y le suma el anticipo Paga Ext(-3-)
        deducir = deducir + #11#128;    || al total anticipos y deducciones
|FINSI;

     #nomtrnom#192 = #11#48 + #11#49 + #11#50 + #11#51;     || SS Trabajador
     #nomtrnom#193 = #11#45;                                || SS Empresa
     #nomtrnom#194 = #nomtrnom#192 + #nomtrnom#193;         || Total SS
     #nomtrnom#195 = #11#46 - deducir + #nomtrnom#193;      || Total Neto + SS Emp
|FPRC;

|PROCESO BuscaImpDifer;
     nume1 = concep - 189;    || hasta prorr.
     nume2 = concep - 181;    || mes confecc.
     nume3 = concep - 173;    || tipo paga
     nume4 = concep - 157;    || % paga porcentual
     |SI #102nume2 ! #102nume1; || es diferida
          |ABRE #nomhicli;
          |SI #102nume1 > #102nume2;
               nAny = #0#4 - 1;
          |SINO;
               nAny = #0#4;
          |FINSI;
          #nomhicli#0 = #labtraba#0;
          #nomhicli#1 = #labtraba#1;
          #nomhicli#2 = #102nume1;
          #nomhicli#3 = 0;
          #nomhicli#4 = concep;
          #nomhicli#12 = nAny;
          |LEE 000#nomhicli.=;
          |SI FSalida = 0;
               |SI #102nume3 ! "P";
                    #10#19 = (import / #nomhicli#10);
               |SINO;
                    #10#19 = (import / (#102nume4 * #nomhicli#10));
                    #10#19 = (#10#19 * 30) / 12;
               |FINSI;
          |FINSI;
          |CIERRA #nomhicli;
     |SINO;    || no es diferida, busco si es porcentual
          |SI #102nume3 = "P";
               #10#19 = (import / (#102nume4 * valor));
               #10#19 = (#10#19 * 30) / 12;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescAntic;
     aAlfa = "";
     |SI concep = 906;
          aAlfa = #labempre#61;
          camdesc = 169;
     |FINSI;
     |SI concep = 907;
          aAlfa = #labempre#62;
          camdesc = 170;
     |FINSI;
     |SI concep = 926;
          aAlfa = #labempre#63;
          camdesc = 197;
     |FINSI;
     |QBF aAlfa;
     |SI aAlfa ! "";
          |SI aAlfa = " nticipos"; aAlfa = "Anticipos"; |FINSI;
          #10camdesc = aAlfa;
     |FINSI;
|FPRC;

|PROCESO FechaFijaRecibi;
     #nomconca#0 = #labtraba#87;   || convenio
     |LEE 000#nomconca.=

     |ABRE #nompagfe;
     #nompagfe#0 = #labtraba#87;   || fecha paga extra por convenio
     |LEE 000#nompagfe.=;
     |SI FSalida = 0;
          |PARA nPaga = 1; |SI nPaga [ 8; |HACIENDO nPaga = nPaga + 1;
               nCampo = nPaga + 19;
               |SI #nomconca#nCampo# = #0#5;
                    aAlfa = #nompagfe#nPaga#;
                    |QBF aAlfa;
                    |SI aAlfa ! "";
                         nNume = #0#4;
                         |SI nNume > 90;
                              nNume = 1900 + nNume;
                         |SINO;
                              nNume = 2000 + nNume;
                         |FINSI;
                         aAlfa2 = nNume;
                         aAlfa = aAlfa + "." + aAlfa2;
                         fectra = aAlfa;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #nompagfe;
|FPRC;

/******  PARA LOS TRABAJADORES EN FORMACION Y MATERNIDAD TODO EL MES  *******/

|PROCESO parcheformacionM;
     || para los de formacion que estan en maternidad todo el mes, esos
     || no cotizan la parte del trabajador
     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
          |SI #4#65 ] #4#8;
               #4#48 = 0;
               #4#49 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO parcheformacionH;
     || para los de formacion que estan en maternidad todo el mes, esos
     || no cotizan la parte del trabajador
     |SI #2#45 = "087";|O #2#45 = "097";|O #2#45 = "085";
          |SI #11#65 ] #11#8;
               #11#48 = 0;
               #11#49 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO VariosFiniq;
     |SI #labtraba#136 = "VAL";
          #labtraba#136 = "CAT";
     |FINSI;
     |SI #labtraba#136 ! "CAS"; |Y #labtraba#136 ! "CAT";
          #labtraba#136 = "CAS";
     |FINSI;

     aAlfa = #labtraba#184 % 116;
     |SI aAlfa = "Motivo de baja: ";
          aMotivo = #labtraba#184 - aAlfa;
     |SINO;
          aMotivo = #labtraba#184;
     |FINSI;

     |QBF aMotivo;

     aAlfa = aMotivo % 401;
     |SI aAlfa = "-";
          aMotivo = aMotivo % 0680;
     |FINSI;

     |QBF aMotivo;

     aAlfa = #labtraba#37;
     |QBF aAlfa;
     |SI aAlfa ! ""; |Y aAlfa ! "..........";
          aFechaBaja = aAlfa;
     |FINSI;

     || ahora busco en variaciones, por si hay informacion mas actualizada

     |ABRE #103;
     #103#0 = nEmpresa;    || empresa
     #103#1 = nTrabajador; || trabajador
     #103#2 = nMes;        || mes
     #103#3 = 0;           || tipo
     |LEE 000#103=;

     |SI FSalida = 0;
          aAlfa = #nomvarca#16;
          |QBF aAlfa;
          |SI aAlfa ! ""; |Y aAlfa ! "..........";
               aFechaBaja = aAlfa;

               |SI #nomvarca#46 ! 00;
                    |ABRE #motibaja;
                    #motibaja#0 = #nomvarca#46;
                    |LEE 000#motibaja.=;
                    |SI FSalida = 0;
                         aMotivo = #motibaja#1;
                         |QBF aMotivo;
                    |FINSI;
                    |CIERRA #motibaja;
               |FINSI;

               |ACABA;
          |FINSI;
     |FINSI;
     |CIERRA #103;
|FPRC;

/************** proceso para grabar cuando se emiten las pagas **************/

|PROCESO grabalinpaga;
     #nomimpr2#0 = #nomcalli#0;     || emp
     #nomimpr2#1 = #nomcalli#1;     || tra
     #nomimpr2#2 = #nomcalli#2;     || mes
     #nomimpr2#3 = #nomcalli#3;     || tipo
     #nomimpr2#4 = anyo;
     #nomimpr2#5 = #nomcalli#4;
     |LEE 101#nomimpr2.=;
     FEstado = FSalida;

     #nomimpr2#6 = #nomcalli#5;
     #nomimpr2#7 = #nomcalli#6;
     #nomimpr2#8 = #nomcalli#7;
     #nomimpr2#9 = #nomcalli#8;
     #nomimpr2#10 = #nomcalli#9;
     #nomimpr2#11 = #nomcalli#10;
     #nomimpr2#12 = #nomcalli#11;

     |SI #nomcalli#5 ! "P"; |Y #nomcalli#11 ! 0;    || no guardo pagas prorrateadas
          |SI FEstado = 0;              || ni guardo pagas que no se
               |GRABA 020#nomimpr2.a;   || paguen
          |SINO;
               |GRABA 020#nomimpr2.n;
          |FINSI;
     |SINO;
          #nomimpr1#9 = #nomimpr1#9 - ((#nomcalli#9 * #nomcalli#10) ! 2);   || base prorrata
     |FINSI;

     |LIBERA #nomimpr2;
|FPRC;

|DEFBUCLE grabalinpaga;
     #nomcalli#1;
     ;
     #93#0, #93#1, #93#2, #93#3, 201;
     #93#0, #93#1, #93#2, #93#3, 208;
     ;
     NULL, grabalinpaga;
|FIN;

|PROCESO grabapaga;
     anyo = #0#4 + 2000;
     |ABRE #nomimpr1;
     #nomimpr1#0 = #93#0;     || emp
     #nomimpr1#1 = #93#1;     || tra
     #nomimpr1#2 = #93#2;     || mes
     #nomimpr1#3 = #93#3;     || tipo
     #nomimpr1#4 = anyo;
     |LEE 101#nomimpr1.=;
     FEstadoC = FSalida;

     #nomimpr1#5 = #93#16;   || base pagas
     #nomimpr1#6 = #93#17;   || imp. ret. pagas
     #nomimpr1#7 = #93#87;   || % ret pagas
     #nomimpr1#8 = #93#47;   || bruto pagas
     #nomimpr1#9 = #93#38;   || base prorrata

     #nomimpr1#10 = nEmbargo;   || Embargo

     |ABRE #nomimpr2;
     |BUCLE grabalinpaga;
     |CIERRA #nomimpr2;

     |SI FEstadoC = 0;
          |GRABA 020#nomimpr1.a;
     |SINO;
          |GRABA 020#nomimpr1.n;
     |FINSI;

     |LIBERA #nomimpr1;
     |CIERRA #nomimpr1;
|FPRC;

|PROCESO nomabsli;
     aDiaDesde = #nomabsli#2;
     aDiaDesde = aDiaDesde % 102;
     aDiaHasta = #nomabsli#3;
     aDiaHasta = aDiaHasta % 102;
     aTipoBaja = #nomabsli#4;
     |PARA nCampo1 = 19; |SI nCampo1 [ 22; |HACIENDO nCampo1 = nCampo1 + 1;
          nCampo2 = nCampo1 + 4;
          nCampo3 = nCampo1 + 8;
          |SI aDesde = "M";
               |SI #4nCampo3 = " ";
                    #4nCampo1 = aDiaDesde;
                    #4nCampo2 = aDiaHasta;
                    |SI aTipoBaja = "A";
                         #4nCampo3 = "F";
                    |SINO;
                         #4nCampo3 = aTipoBaja;
                    |FINSI;
                    |SAL;
               |FINSI;
          |FINSI;
          |SI aDesde = "H";
               |SI #11nCampo3 = " ";
                    #11nCampo1 = aDiaDesde;
                    #11nCampo2 = aDiaHasta;
                    |SI aTipoBaja = "A";
                         #11nCampo3 = "F";
                    |SINO;
                         #11nCampo3 = aTipoBaja;
                    |FINSI;
                    |SAL;
               |FINSI;
          |FINSI;
          |SI aDesde = "A";
               |SI #13nCampo3 = " ";
                    #13nCampo1 = aDiaDesde;
                    #13nCampo2 = aDiaHasta;
                    |SI aTipoBaja = "A";
                         #13nCampo3 = "F";
                    |SINO;
                         #13nCampo3 = aTipoBaja;
                    |FINSI;
                    |SAL;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE nomabsli;
     #nomabsli#1;
     ;
     #labtraba#0, #labtraba#1, fFechaDesde;
     #labtraba#0, #labtraba#1, fFechaHasta;
     ;
     NULL, nomabsli;
|FIN;

|PROCESO busca_AHV;
     aMes = "00" + aMes;
     aMes = aMes % -102;
     nAny = #0#4;
     nAny = 2000 + #0#4;
     aAny = nAny;        || desde a¤o
     aFecha = "01" + "." + aMes + "." + aAny;
     fFechaDesde = aFecha;

     |HAZ lib_0;
     aDia = topemes;
     aFecha = aDia + "." + aMes + "." + aAny;
     fFechaHasta = aFecha;

     |BUCLE nomabsli;
|FPRC;

|PROCESO carga_AHV_Men;
     aMes = #4#2;        || desde mes
     mesnum = #4#2;
     aDesde = "M";
     |HAZ busca_AHV;
|FPRC;

|PROCESO carga_AHV_His;
     aMes = #11#2;        || desde mes
     mesnum = #11#2;
     aDesde = "H";
     |HAZ busca_AHV;
|FPRC;

|PROCESO carga_AHV_Atr;
     aMes = #13#2;        || desde mes
     mesnum = #13#2;
     aDesde = "A";
     |HAZ busca_AHV;
|FPRC;
/*
pa na, esto no vale pa na
|PROCESO BuscaCCCEmp;
     |ABRE #gomccchi;
     #gomccchi#0 = #labempre#0;
     #gomccchi#1 = 00;
     |LEE 000#gomccchi.=;
     |SI FSalida = 0;
          |SI #0#4 [ 11;
               afili = #gomccchi#2;
          |FINSI;
     |FINSI;
     |CIERRA #gomccchi;
|FPRC;

|PROCESO BuscaCCCCen;
     |ABRE #gomccchi;
     #gomccchi#0 = #labcentr#0;
     #gomccchi#1 = #labcentr#1;
     |LEE 000#gomccchi.=;
     |SI FSalida = 0;
          |SI #0#4 [ 11;
               afili = #gomccchi#2;
          |FINSI;
     |FINSI;
     |CIERRA #gomccchi;
|FPRC;

|PROCESO afili_agr;
     |SI #0#9 = 1;
          |HAZ BuscaCCCEmp;
     |SINO;
          |HAZ BuscaCCCCen;
     |FINSI;
|FPRC;
*/
|PROCESO ComentariosNomvarca;
     #10#169 = "";
     #10#170 = "";
     #10#171 = "";
     #10#197 = "";
     #10#176 = "Anticipos P.Extra";

     || Ahora busco en nomvarca comentarios de anticipos 1 y 2 y en especie

     |ABRE #103;
     #103#0 = nEmpresa;   || empresa
     #103#1 = nTrabajador;   || trabajador
     #103#2 = nMes;   || mes
     #103#3 = nTipo;   || tipo
     |LEE 000#103=;
     |SI FSalida = 0;
          |SI #103#19 ! 0; #10#169 = #103#28; |FINSI;
          |SI #103#20 ! 0; #10#170 = #103#29; |FINSI;
          |SI #103#21 ! 0; #10#171 = #103#30; |FINSI;
          |SI #103#44 ! 0; #10#197 = #103#45; |FINSI;
     |FINSI;
     |CIERRA #103;

     || para embargos
     || en el mismo campo que anticipos 3, si algun dia coincidieran ya veriamos
     |SI #0#69 ! "A"; || no en la abierta
          |SI #nomcalca#104 ! 0; |O #11#146 ! 0; |O #93#104 ! 0;    || tengo embargo
               #10#197 = "Embargos Salario"
          |FINSI;
     |FINSI;
|FPRC;
