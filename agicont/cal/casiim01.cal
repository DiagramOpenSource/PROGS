|FICHEROS;
     casiim01;
     casiim02;
     casiim03;

     casiiw01;
     casiiw02;

     calibros;
     caclipro;
     cacon300;
     cacuenta;
     camaasil;
     caivaasi;

     caivarep;
     caivasop;

     siim1000@;
|FIN;

|VARIABLES;
     nID           = 0;
     nOk           = 0;
     nCmp1         = 0;
     nCmp2         = 0;
     nCmp3         = 0;
     nSwDefectos   = 0;
     nSw           = 0;
     nNume1        = 0;
     nNumLin       = 0;

     aID           = "";
     aAlfa         = "";
     aAlfa1        = "";
     &aPais        = "";
     aClvPais      = "";
     a340          = "";
     aH60          = "";
     aMas          = "";
     nMensa        = 0;

 {20}aPopup        = "";

     aNifQbf1      = "";
     aNifQbf2      = "";

     &eaVarDni     = "";
     &enCalcCif    = 0;
     &eaSiiPro     = "";
     &enSiiLib     = 0;
     &eaSiiDoc     = "";
     &enSiiDoc     = 0;
     &eaSiiRef     = "";
     &eaSiiSer     = "";
     &enSiiLin     = 0;
     &enSiiIva     = 0;
     &enSiiMod     = 0;
     &eaSiiCta     = "";
     &eaSiiDig     = "";
     &eaSiiCpt     = "";
     &eaSiiDes     = "";
     &enSiiL       = 0;
     &eaSiiEje     = "";
     &enSiiPer     = 0;
     &enSiiRet     = 0;
     &enSiiUlt     = 0;
     &eaSiiCIF     = "";

     &eaCodNif     = "";
     &ewNif        = 0;
     &eaIdenPais   = "";
     &eaTConfig    = "";
     &aTipoIVA     = "";
     &enEmpresa    = 0;
     &enSiiCon     = 0;
     &SwCambia     = 0;
     &enTConLin    = 0;
     &nConcLin     = 0;
     &eaSiiCtr     = "";
     &enSiiCtr     = 0;
     &enExisDef    = 0;
     &enLinDef     = 0;
|FIN;

|PROCESO Inmuebles;
     |PUSHV 0501 2380;
     |PARA nCmp1 = 0;  |SI nCmp1 [ 29;  |HACIENDO nCmp1 = nCmp1 + 1;
           nCmp2 = nCmp1 + 19;
           #casiiw01#nCmp1# = #casiim01#nCmp2#;
     |SIGUE;

     |PINPA #0#casiiw01;
     |PINDA #0#casiiw01;
     |ENDATOS #1#casiiw01;
     |SI FSalida = 0;
         |PARA nCmp1 = 0;  |SI nCmp1 [ 29;  |HACIENDO nCmp1 = nCmp1 + 1;
               nCmp2 = nCmp1 + 19;
               #casiim01#nCmp2# = #casiiw01#nCmp1#;
         |SIGUE;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO Baja02;
     #casiim02#0 = #casiim01#0;
     #casiim02#1 = #casiim01#1;
     #casiim02#2 = #casiim01#2;
     #casiim02#3 = "";
|FPRC;

|PROCESO Alta02;
     #casiim02#0 = #casiim01#0;
     #casiim02#1 = #casiim01#1;
     #casiim02#2 = #casiim01#2;
     #casiim02#3 = "z" * 60;
|FPRC;

|PROCESO casiim02B;
     |BORRA 020#casiim02.a;
     |LIBERA #casiim02;
|FPRC;

|DEFBUCLE casiim02B;
     #casiim02#1;
     ;
     #casiim01#0, #casiim01#1, #casiim01#2, "";
     #casiim01#0, #casiim01#1, #casiim01#2, aH60;
     be;
     NULL, casiim02B;
|FIN;

|PROCESO IdentiFac;
     |PUSHV 0501 2380;

     |ENTLINEAL #1#casiim02, -4, 2, 21, 1, Baja02, Alta02;

     |POPV;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     |SI #casiim01#3 = "XX";
         |ACABA;
     |FINSI;

     |SI aTipoIVA = "R";
         nOk = 0;
         |SI #casiim01#4 = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#4 = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#5 = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#5 = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#6 = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#6 = "13";  nOk = 1;  |FINSI;

         |SI nOk = 1;
             |HAZ Inmuebles;
         |SINO;
             |PDEFECTO #casiim01,19,49;
         |FINSI;
     |FINSI;

     |SI #casiim01#3 = "R1";  |O #casiim01#3 = "R2";
      |O #casiim01#3 = "R3";  |O #casiim01#3 = "R4";
      |O #casiim01#3 = "R5";  |O #casiim01#3 = "R6";
      |O #casiim01#3 = "F3";
         |HAZ IdentiFac;
     |SINO;
         aH60 = "z" * 60;
         |BUCLE casiim02B;
     |FINSI;

     |SI aTipoIVA = "S";
         aAlfa = #casiim01#66;  |QBF aAlfa;
         |SI aAlfa = "";
             |MENAV "0000La referencia debe tener contenido.";
             |POSICIONATE #casiim01#66;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa = #casiim01#13;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000Descripcion de la operacion debe tener contenido.";
         |POSICIONATE #casiim01#13;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO T7C49m01;  |TIPO 7;
     |C_M #casiim01#49, 1, "S";
     |SI #casiim01#4 ! "06";  |Y #casiim01#5 ! "06";  |Y #casiim01#6 ! "06";
         |C_M #casiim01#49, 1, "N";  #casiim01#49 = 0;
     |FINSI;

     |PINTA #casiim01#49;
|FPRC;

|PROCESO T66C13m01;  |TIPO 66;
     |DBASS aMas;
     aMas = aMas + "siibase/def/siim1000.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;
         |MENAV "0000Opcion no instalada.";
         |ACABA;
     |FINSI;

     |CARGA_DEF aMas, siim1000@;
     |ABRE #siim1000@;
     |CONSULTA_CLAVE #2#siim1000@;
     |SI FSalida = 0;
         #casiim01#13 = #siim1000@#1;
         |PINTA #casiim01#13;
     |FINSI;
     |CIERRA #siim1000@;
     |DESCARGA_DEF #siim1000@;
|FPRC;

|PROCESO T0C15m01;  |TIPO 0;
     |C_M #casiim01#15, 0, aAlfa;
     |SI aAlfa = "N";  |ACABA;  |FINSI;

     |SI #casiim01#15 =  " ";
         |MENAV "0000Introduzca valor <S> Sustitucion <I> Por diferencias";
         |ERROR;
         |ACABA;
     |FINSI;

     |C_M #casiim01#16, 1, "S";
     |C_M #casiim01#17, 1, "S";
     |C_M #casiim01#18, 1, "S";

     |SI #casiim01#15 = "I";
         |C_M #casiim01#16, 1, "N";  #casiim01#16 = 0;
         |C_M #casiim01#17, 1, "N";  #casiim01#17 = 0;
         |C_M #casiim01#18, 1, "N";  #casiim01#18 = 0;
     |FINSI;

     |PINTA #casiim01#16;
     |PINTA #casiim01#17;
     |PINTA #casiim01#18;
|FPRC;

|PROCESO T0C4R;
     nOk = 0;

     |SI Campo ! 4;
         |SI #casiim01#Campo# = "  ";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "02";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "04";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "09";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "10";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "16";  nOk = 1;  |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI Campo = 4;
         |C_M #casiim01#5,  1, "S";
         |C_M #casiim01#6,  1, "S";

         |SI #casiim01#4 ! "05";  |Y #casiim01#4 ! "06";
          |Y #casiim01#4 ! "07";  |Y #casiim01#4 ! "11";
          |Y #casiim01#4 ! "12";  |Y #casiim01#4 ! "13";
             |C_M #casiim01#5, 1, "N";  #casiim01#5 = "";
             |C_M #casiim01#6, 1, "N";  #casiim01#6 = "";
         |FINSI;

         |PINTA #casiim01#5;
         |PINTA #casiim01#6;

         |ACABA;
     |FINSI;

     |SI #casiim01#Campo# = "  ";
         |ACABA;
     |FINSI;

     nOk = 0;
     |SI #casiim01#4 = "05";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "06";
         |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "07";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "09";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "11";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "11";  |O #casiim01#4 = "12";  |O #casiim01#4 = "13";
         |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "15";  nOk = 1;  |FINSI;
     |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T0C4S;
     nOk = 0;

     |SI Campo ! 4;
         |SI #casiim01#Campo# = "  ";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "02";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "04";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "09";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "13";  nOk = 1;  |FINSI;
     |SI #casiim01#Campo# = "14";  nOk = 1;  |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI Campo = 4;
         |C_M #casiim01#5, 1, "S";
         |C_M #casiim01#6, 1, "S";

         |SI #casiim01#4 ! "05";  |Y #casiim01#4 ! "07";  |Y #casiim01#4 ! "12";
             |C_M #casiim01#5, 1, "N";  #casiim01#5 = "";
             |C_M #casiim01#6, 1, "N";  #casiim01#6 = "";
         |FINSI;

         |PINTA #casiim01#5;
         |PINTA #casiim01#6;

         |ACABA;
     |FINSI;

     |SI #casiim01#Campo# = "  ";
         |ACABA;
     |FINSI;

     nOk = 0;
     |SI #casiim01#4 = "05";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "07";
         |SI #casiim01#Campo# = "01";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "03";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "12";  nOk = 1;  |FINSI;
     |FINSI;

     |SI #casiim01#4 = "12";
         |SI #casiim01#Campo# = "05";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "06";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "07";  nOk = 1;  |FINSI;
         |SI #casiim01#Campo# = "08";  nOk = 1;  |FINSI;
     |FINSI;

     |SI nOk = 0;
         |MENAV "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T0C4m01;  |TIPO 0;
     |SI #casiim01#3 = "XX";
         |ACABA;
     |FINSI;

     |SI aTipoIVA = "R";
         |HAZ T0C4R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T0C4S;
     |FINSI;
|FPRC;

|PROCESO T66C4R;
     |SI Campo = 4;
         aPopup2  = 16;
         aPopup3  = "01. Operaciones de régimen general";
         aPopup4  = "02. Exportacion";
         aPopup5  = "03. Operaciones de R.E.B.U.";
         aPopup6  = "04. Operaciones régimen especial oro de inversión";
         aPopup7  = "05. Operaciones régimen especial agencias de viajes.";
         aPopup8  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
         aPopup9  = "07. Operaciones de R.E.C.C.";
         aPopup10 = "08. Operaciones sujetas al IPSI/IGIC";
         aPopup11 = "09. Operaciones de facturación de las prestaciones de servicios de agencias de viaje";
         aPopup12 = "10. Cobros por cuenta de terceros de honorarios profesionales";
         aPopup13 = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
         aPopup14 = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
         aPopup15 = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
         aPopup16 = "14. Factura con IVA pendiente de devengo (certificaciones de obra cuyo destinatario sea una Administración Pública)";
         aPopup17 = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         aPopup18 = "16. Facturas primer semestre 2017 y otras anteriores a la inclusion en el SII";
     |FINSI;

     |SI Campo ! 4;
         aPopup2  = "";

         |SI #casiim01#4 = "05";
             aPopup2  = "6";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "07. Operaciones de R.E.C.C.";
             aPopup6  = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
             aPopup7  = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
             aPopup8  = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
         |FINSI;

         |SI #casiim01#4 = "06";
             aPopup2  = "6";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
             aPopup5  = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
             aPopup6  = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
             aPopup7  = "14. Factura con IVA pendiente de devengo (certificaciones de obra cuyo destinatario sea una Administración Pública)";
             aPopup8  = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         |FINSI;

         |SI #casiim01#4 = "07";
             aPopup2  = "10";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "03. Operaciones de R.E.B.U.";
             aPopup6  = "05. Operaciones régimen especial agencias de viajes.";
             aPopup7  = "09. Operaciones de facturación de las prestaciones de servicios de agencias de viaje";
             aPopup8  = "11. Operaciones de arrendamiento de local de negocio sujetas a retención";
             aPopup9  = "12. Operaciones de arrendamiento de local de negocio no sujetos a retención";
             aPopup10 = "13. Operaciones de arrendamiento de local de negocio sujetas y no sujetas a retención";
             aPopup11 = "14. Factura con IVA pendiente de devengo (certificaciones de obra cuyo destinatario sea una Administración Pública)";
             aPopup12 = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         |FINSI;

         |SI #casiim01#4 = "11";  |O #casiim01#4 = "12";  |O #casiim01#4 = "13";
             aPopup2  = "05";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
             aPopup5  = "07. Operaciones de R.E.C.C.";
             aPopup6  = "08. Operaciones sujetas al IPSI/IGIC";
             aPopup7  = "15. Factura con IVA pendiente de devengo - operaciones de tracto sucesivo";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T66C4S;
     |SI Campo = 4;
         aPopup2  = 12;
         aPopup3  = "01. Operaciones de régimen general";
         aPopup4  = "02. Operaciones por las que los Empresarios satisfacen compensaciones REAGYP";
         aPopup5  = "03. Operaciones de R.E.B.U.";
         aPopup6  = "04. Operaciones régimen especial oro de inversión";
         aPopup7  = "05. Operaciones régimen especial agencias de viajes.";
         aPopup8  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
         aPopup9  = "07. Operaciones de R.E.C.C.";
         aPopup10 = "08. Operaciones sujetas al IPSI/IGIC";
         aPopup11 = "09. Adquisiciones intracomunitarias de bienes y prestaciones de servicios";
         aPopup12 = "12. Operaciones de arrendamiento de local de negocio";
         aPopup13 = "13. Factura correspondiente a una importación (informada sin asociar a un DUA)";
         aPopup14 = "14. Primer semestre 2017 y otras facturas anteriores a la inclusion en el SII";
     |FINSI;

     |SI Campo ! 4;
         aPopup2  = "";
         |SI #casiim01#4 = "05";
             aPopup2  = "4";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "07. Operaciones de R.E.C.C.";
             aPopup6  = "12. Operaciones de arrendamiento de local de negocio";
         |FINSI;

         |SI #casiim01#4 = "07";
             aPopup2  = "5";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "01. Operaciones de régimen general";
             aPopup5  = "03. Operaciones de R.E.B.U.";
             aPopup6  = "05. Operaciones régimen especial agencias de viajes.";
             aPopup7  = "12. Operaciones de arrendamiento de local de negocio";
         |FINSI;

         |SI #casiim01#4 = "12";
             aPopup2  = "5";
             aPopup3  = "    No procede clave de operación";
             aPopup4  = "05. Operaciones régimen especial agencias de viajes.";
             aPopup5  = "06. Operaciones régimen especial grupo de entidades en iva (nivel avanzado)";
             aPopup6  = "07. Operaciones de R.E.C.C.";
             aPopup7  = "08. Operaciones sujetas al IPSI/IGIC";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T66C4m01;  |TIPO 66;
     aAlfa = "|C004WID";
     aID   = #casiim01#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion

     |SI aTipoIVA = "R";
         |HAZ T66C4R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T66C4S;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #casiim01#Campo# = aAlfa;
     |FINSI;

     |PINTA #casiim01#Campo#;
|FPRC;

|PROCESO T0C3R;
     |SI #casiim01#3 = "F1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R5";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "XX";  nOk = 1;  |FINSI;
|FPRC;

|PROCESO T0C3S;
     |SI #casiim01#3 = "F1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F5";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "F6";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "LC";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R1";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R2";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R3";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R4";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "R5";  nOk = 1;  |FINSI;
     |SI #casiim01#3 = "XX";  nOk = 1;  |FINSI;
|FPRC;

|PROCESO T0C3m01;  |TIPO 0;
     nOk = 0;

     |SI aTipoIVA = "R";
         |HAZ T0C3R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T0C3S;
     |FINSI;

     |SI #casiim01#3 = "XX";
         |PTEC 806;
         |ACABA;
     |FINSI;

     nMensa = 0;
     |SI #casiim01#3 = "R1";  |O #casiim01#3 = "R2";  |O #casiim01#3 = "R3";
                              |O #casiim01#3 = "R4";  |O #casiim01#3 = "R5";
         |SI a340 ! "D";
             nOk = 0; nMensa = 2;
         |FINSI;
     |SINO;
         |SI a340 = "D";
             nOk = 0; nMensa = 1;
         |FINSI;
     |FINSI;

     |SI enExisDef = 1;
         |HAZ eLeoDefM03;
         |SI #casiim01#3 = #casiim03#6;
             nOk = 1;
         |FINSI;
     |FINSI;

     |SI nOk = 0;
         |SI nMensa = 0;
            aAlfa =  "0000Contenido incorrecto. Pulse F11 para ver tabla de contenido";
         |FINSI;
         |SI nMensa = 1;
            aAlfa =  "0000Concepto de fra.rectificativa y tipo factura distinto de Rx. Reviselo";
         |FINSI;
         |SI nMensa = 2;
            aAlfa =  "0000Tipo factura rectificativa y concepto no. Reviselo";
         |FINSI;

         |MENAV aAlfa;
         |ERROR;
         |ACABA;
     |FINSI;

     |C_M #casiim01#15, 1, "S";
     |C_M #casiim01#16, 1, "S";
     |C_M #casiim01#17, 1, "S";
     |C_M #casiim01#18, 1, "S";

     |SI #casiim01#15 =  " ";
         #casiim01#15 = "I";
     |FINSI;

     |SI #casiim01#3 ! "R1";  |Y #casiim01#3 ! "R2";  |Y #casiim01#3 ! "R3";
                              |Y #casiim01#3 ! "R4";  |Y #casiim01#3 ! "R5";
         |C_M #casiim01#15, 1, "N";  #casiim01#15 = "";
         |C_M #casiim01#16, 1, "N";  #casiim01#16 = 0;
         |C_M #casiim01#17, 1, "N";  #casiim01#17 = 0;
         |C_M #casiim01#18, 1, "N";  #casiim01#18 = 0;
     |FINSI;

     |C_M #casiim01#12, 1, "S";
     |SI #casiim01#3 ! "R5";  |Y #casiim01#3 ! "F4";
         |C_M #casiim01#12, 1, "N";  #casiim01#12 = "N";
     |FINSI;

     |C_M #casiim01#67, 1, "S";
     |C_M #casiim01#68, 1, "S";
     |SI #casiim01#3 = "F2";  |O #casiim01#3 = "F4";
          |O #casiim01#3 = "R5";  |O #casiim01#3 = "LC";
        |C_M #casiim01#67, 1, "N";
        |SI #casiim01#3 = "LC";
            #casiim01#67 = "N";
        |SINO;
            #casiim01#67 = "S";
        |FINSI;
     |FINSI;
     |SI #casiim01#67 = " "; #casiim01#67 = "N"; |FINSI;
     |SI #casiim01#68 = " "; #casiim01#68 = "N"; |FINSI;

     |SI aTipoIVA = "S";
         #casiim01#68 = " ";
         |C_M #casiim01#68, 1, "N";
     |FINSI;

     |PINTA #casiim01#67;
     |PINTA #casiim01#68;
     |PINTA #casiim01#4;
     |PINTA #casiim01#12;
     |PINTA #casiim01#13;
     |PINTA #casiim01#15;
     |PINTA #casiim01#16;
     |PINTA #casiim01#17;
     |PINTA #casiim01#18;
|FPRC;

|PROCESO T66C3R;
     aPopup2  = 10;
     aPopup3  = "F1. Factura completa o simplificada cualificada del art.7.2 y 7.3.";
     aPopup4  = "F2. Factura simplificada o sin identificacion del destinatario art.6.1d";
     aPopup5  = "F3. Factura emitida en sustitucion de facturas simplificadas";
     aPopup6  = "F4. Asiento resumen de facturas.";
     aPopup7  = "R1. Factura rectificativa. Error fundado y Articulo 80 uno y dos LIVA.";
     aPopup8  = "R2. Factura rectificativa. Articulo 80 tres LIVA - concurso acreedores";
     aPopup9  = "R3. Articulo 80 cuatro LIVA - deuda incobrable.";
     aPopup10 = "R4. Resto";
     aPopup11 = "R5. Rectificativa en facturas simplificadas.";
     aPopup12 = "XX. No importable al SII";
|FPRC;

|PROCESO T66C3S;
     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 13;
     aPopup3  = "F1. Factura completa o simplificada cualificada del art.7.2 y 7.3.";
     aPopup4  = "F2. Factura simplificada o sin identificacion del destinatario art.6.1d";
     aPopup5  = "F3. Factura emitida en sustitucion de facturas simplificadas";
     aPopup6  = "F4. Asiento resumen de facturas.";
     aPopup7  = "F5. Importaciones (DUA)";
     aPopup8  = "F6. Otros justificantes contables y documentos justificativos";
     aPopup9  = "LC. Aduanas - Liquidacion complementaria";
     aPopup10 = "R1. Factura rectificativa. Error fundado y Articulo 80 uno y dos LIVA.";
     aPopup11 = "R2. Factura rectificativa. Articulo 80 tres LIVA - concurso acreedores";
     aPopup12 = "R3. Articulo 80 cuatro LIVA - deuda incobrable.";
     aPopup13 = "R4. Resto";
     aPopup14 = "R5. Rectificativa en facturas simplificadas.";
     aPopup15 = "XX. No importable al SII";
|FPRC;

|PROCESO T66C3m01;  |TIPO 66;
     aAlfa = "|C003WID";
     aID   = #casiim01#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion

     |SI aTipoIVA = "R";
         |HAZ T66C3R;
     |FINSI;

     |SI aTipoIVA = "S";
         |HAZ T66C3S;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #casiim01#3 = aAlfa;
     |FINSI;

     |PINTA #casiim01#3;
|FPRC;

|PROCESO T7C66m01; |TIPO 7;
  eaSiiRef = #casiim01#66; |QBF eaSiiRef;

  |SI #caivaasi#54 = "S"; |Y aTipoIVA = "R"; |Y eaSiiRef = "";
      eaSiiRef = enSiiDoc;
      |SI #caivaasi#49 = "S";
           eaSiiRef = ("000000" + eaSiiRef) % -106;
      |FINSI;
      aAlfa = eaSiiSer; |QBF aAlfa;
      |SI aAlfa ! "";
          eaSiiRef = eaSiiSer + #caivaasi#48 + eaSiiRef;
      |FINSI;

      #casiim01#66 = eaSiiRef;
      |SI nSw = 0; |PINTA #casiim01#66; |FINSI;
  |FINSI;
|FPRC;

|PROCESO elDNI;  |TIPO 6;
     |SI FSalida = 9;
         eaVarDni   = #casiim01#70;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #casiim01#70 = eaVarDni;
         |PINTA #casiim01#70;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #casiim01#70;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #casiim01#70; |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;     |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #casiim01#70 = eaVarDni;  |PINTA #casiim01#70;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;
|| //////////////////////////////////////////////////////////////////////

|PROCESO CampoDesdeM03;
     |ABRE #casiim03;
     |DDEFECTO #casiim03;
     #casiim03#15 = eaTConfig;
     #casiim03#0  = enTConLin;
     |LEE 000#casiim03.=;
     |CIERRA #casiim03;

     |SI aTipoIVA = "S"; #casiim03#18 = "N"; |FINSI;

     |SI eaSiiEje = "2017";
        |SI #caivaasi#46 = "M"; |Y enSiiPer [ 6;
            |SI aTipoIVA = "R";
                |SI #casiim03#7 ! "11"; |Y #casiim03#7 ! "12"; |Y #casiim03#7 ! "13";
                     #casiim03#7 = "16";
                |FINSI;
            |SINO;
                 #casiim03#7 = "14";
            |FINSI;
        |FINSI;
        |SI #caivaasi#46 = "T"; |Y enSiiPer [ 2;
            |SI aTipoIVA = "R";
                |SI #casiim03#7 ! "11"; |Y #casiim03#7 ! "12"; |Y #casiim03#7 ! "13";
                     #casiim03#7 = "16";
                |FINSI;
            |SINO;
                #casiim03#7 = "14";
            |FINSI;
        |FINSI;
     |FINSI;

     |SI nNumLin = 0;
         #casiim01#3 = #casiim03#6;
         #casiim01#4 = #casiim03#7;
         #casiim01#5 = #casiim03#8;
         #casiim01#6 = #casiim03#9;
         #casiim01#7 = #casiim03#10;  || Tipo 1
         #casiim01#8 = #casiim03#11;  || Nivel 1

         aAlfa = "";
         |SI #casiim03#14 ! "C";
             |SI #casiim03#14 ! "D";
                 aAlfa = eaSiiDes; |QBF aAlfa;
                 aAlfa = aAlfa + " ";
             |FINSI;

             |SI #casiim03#14 ! "F";
                 aAlfa1 = #casiim03#12; |QBF aAlfa1;
                 aAlfa = aAlfa + aAlfa1;
                 |QBF aAlfa;
             |FINSI;
             enSiiCtr = 0;
             #casiim01#13 = aAlfa;
         |SINO;
              enSiiCtr = 1;
              #casiim01#13 = eaSiiCtr;
         |FINSI;
         #casiim01#15 = #casiim03#13;
         #casiim01#10 = #casiim03#18;
         #casiim01#67 = #casiim03#19;
         #casiim01#68 = #casiim03#20;
    |FINSI;

    |SI nNumLin = 1;
        #casiiw02#0 = #casiim03#10;
        #casiiw02#1 = #casiim03#11;
        |SI enSiiCtr = 1;
            aAlfa = #casiim01#13; |QBF aAlfa;
            |SI aAlfa ! "";
                aAlfa = aAlfa + " ";
            |FINSI;
            #casiim01#13 = aAlfa + eaSiiCtr;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO NuevosDefectos;
     |SI #casiim01#4 ! "  ";  |ACABA;  |FINSI;
     |SI #casiim01#3 = "XX";  |ACABA;  |FINSI;

     enSiiCtr      = 0;
     nSwDefectos   = 0;
     |HAZ CojoConfig;
     |SI eaTConfig ! "X";
         nNumLin   = 0;
         enSiiCon = eaSiiCpt;
         |HAZ ePorLinea;
         |SI SwCambia ! 0;
             |HAZ CampoDesdeM03;
             nSwDefectos = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ElDefectoLin;
     nSwDefectos   = 0;
     |HAZ CojoConfig;
     |SI eaTConfig ! "X";
         nNumLin   = 1;
         enSiiCon = eaSiiCpt;
         |HAZ ePorLinea;
         |SI SwCambia ! 0;
             |HAZ CampoDesdeM03;
             nSwDefectos = 1;
         |FINSI;
     |FINSI;
     |SI nSwDefectos = 0;
         |HAZ T7C0w2;
         |HAZ T7C1w2;
     |FINSI;
|FPRC;

|| //////////////////////////////////////////////////////////////////////

|PROCESO Defectos;
     || Tipo Factura

     |SI #casiim01#4 ! "  ";  |ACABA;  |FINSI;
     |SI #casiim01#3 = "XX";  |ACABA;  |FINSI;

     #casiim01#3 = "F1";

     |SI eaSiiCIF = "";
         #casiim01#3 = "F2";
     |FINSI;

     |SI enSiiUlt > 1;
         #casiim01#3 = "F4";
     |FINSI;

     |SI aTipoIVA = "S";
          |SI #cacon300#1 = 2;  |O #cacon300#1 = 7;
              #casiim01#3 = "F5";
          |FINSI;

          |SI #cacon300#1 = 4;
              #casiim01#3 = "F6";
          |FINSI;
     |FINSI;

     |SI a340 = "D";
         #casiim01#3  = "R4";
         #casiim01#15 = "I";

         |SI eaSiiCIF = "";
             #casiim01#3 = "R5";
         |FINSI;
     |FINSI;

     || Clave operacion

     #casiim01#4 = "01";

     |SI aTipoIVA = "R";
         nOk = 0;
         |SI a340 = "Z";  nOk = 1;  |FINSI;
         |SI a340 = "0";  nOk = 1;  |FINSI;
         |SI a340 = "1";  nOk = 1;  |FINSI;
         |SI a340 = "2";  nOk = 1;  |FINSI;
         |SI a340 = "3";  nOk = 1;  |FINSI;
         |SI a340 = "4";  nOk = 1;  |FINSI;
         |SI a340 = "5";  nOk = 1;  |FINSI;
         |SI a340 = "6";  nOk = 1;  |FINSI;
         |SI a340 = "7";  nOk = 1;  |FINSI;
         |SI a340 = "8";  nOk = 1;  |FINSI;
         |SI a340 = "9";  nOk = 1;  |FINSI;

         |SI nOk = 1;
             #casiim01#4 = "07";
         |FINSI;

         |SI eaSiiEje = "2017";
             |SI #caivaasi#46 = "M"; |Y enSiiPer [ 6;
                 #casiim03#7 = "16";
             |FINSI;
             |SI #caivaasi#46 = "T"; |Y enSiiPer [ 2;
                  #casiim03#7 = "16";
             |FINSI;
         |FINSI;
     |FINSI;

     |SI aTipoIVA = "S";
         || Clave operacion

         nOk = 0;
         |SI a340 = "Z";  nOk = 1;  |FINSI;
         |SI a340 = "0";  nOk = 1;  |FINSI;
         |SI a340 = "1";  nOk = 1;  |FINSI;
         |SI a340 = "2";  nOk = 1;  |FINSI;
         |SI a340 = "3";  nOk = 1;  |FINSI;
         |SI a340 = "4";  nOk = 1;  |FINSI;
         |SI a340 = "5";  nOk = 1;  |FINSI;
         |SI a340 = "6";  nOk = 1;  |FINSI;
         |SI a340 = "7";  nOk = 1;  |FINSI;
         |SI a340 = "8";  nOk = 1;  |FINSI;
         |SI a340 = "9";  nOk = 1;  |FINSI;

         |SI nOk = 1;
             #casiim01#4 = "07";
         |FINSI;

         |SI eaIdenPais = "02";
             #casiim01#4 = "09";
         |FINSI;

          |SI #cacon300#1 = 4;
              #casiim01#4 = "02";
          |FINSI;

         |SI eaSiiEje = "2017";
             |SI #caivaasi#46 = "M"; |Y enSiiPer [ 6;
                 #casiim03#7 = "14";
             |FINSI;
             |SI #caivaasi#46 = "T"; |Y enSiiPer [ 2;
                 #casiim03#7 = "14";
              |FINSI;
         |FINSI;
     |FINSI;

     aAlfa = #casiim01#13; |QBF aAlfa;
     |SI aAlfa = "";
         #casiim01#13 = eaSiiDes;
     |FINSI;

     #casiim01#67 = "N";
     |SI #casiim01#3 = "F2";  |O #casiim01#3 = "F4";
          |O #casiim01#3 = "R5";
            #casiim01#67 = "S";
     |FINSI;
|FPRC;

|PROCESO EntraTipoDesglose;
     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = eaSiiDoc;
     |LEE 101#casiim01.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #casiim01#3 = "XX";  |ACABA;  |FINSI;

     nCmp1 = 0;
     |SI #casiim01#50 = enSiiLin;  nCmp1 = 50;  |FINSI;
     |SI #casiim01#51 = enSiiLin;  nCmp1 = 51;  |FINSI;
     |SI #casiim01#54 = enSiiLin;  nCmp1 = 54;  |FINSI;
     |SI #casiim01#57 = enSiiLin;  nCmp1 = 57;  |FINSI;
     |SI #casiim01#60 = enSiiLin;  nCmp1 = 60;  |FINSI;
     |SI #casiim01#63 = enSiiLin;  nCmp1 = 63;  |FINSI;

     |SI nCmp1 = 0;
         |SI #casiim01#63 = 0;  nCmp1 = 63;  |FINSI;
         |SI #casiim01#60 = 0;  nCmp1 = 60;  |FINSI;
         |SI #casiim01#57 = 0;  nCmp1 = 57;  |FINSI;
         |SI #casiim01#54 = 0;  nCmp1 = 54;  |FINSI;
         |SI #casiim01#51 = 0;  nCmp1 = 51;  |FINSI;
         |SI #casiim01#50 = 0;  nCmp1 = 50;  |FINSI;

         |SI nCmp1 = 0;  |ACABA;  |FINSI;
     |FINSI;

     nNume1 = #casiim01#nCmp1#;

     #casiim01#nCmp1# = enSiiLin;

     |SI nCmp1 = 50;
         nCmp2 = 7;
         nCmp3 = 8;
     |SINO;
         nCmp2 = nCmp1 + 1;
         nCmp3 = nCmp1 + 2;
     |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     #casiiw02#1 = #casiim01#nCmp3#;

     |SI nNume1 = 0; |Y aTipoIVA = "R";
         |HAZ ElDefectoLin;
     |FINSI;

     |SI enSiiMod = 1;
         |PINPA #0#casiiw02;
         |PINDA #0#casiiw02;
         |ENDATOS #1#casiiw02;
         |SI FSalida = 0;
             #casiim01#nCmp2# = #casiiw02#0;
             #casiim01#nCmp3# = #casiiw02#1;
         |FINSI;
     |FINSI;

     |SI enSiiMod = -1;
         #casiim01#nCmp1# = 0;
         #casiim01#nCmp2# = "";
         #casiim01#nCmp3# = "";
     |FINSI;

     |GRABA 020#casiim01.a;
     |LIBERA #casiim01;
|FPRC;

|PROCESO LeeHisto;
     |SI eaSiiPro = "caivarep";
         |ABRE #caivarep;
         #caivarep#0  = enSiiLib;
         #caivarep#27 = eaSiiDoc % 102;
         aAlfa        = eaSiiDoc % 306;
         #caivarep#2  = aAlfa;
         |LEE 000#caivarep.=;
         |SI FSalida ! 0;  |DDEFECTO #caivarep;  |FINSI;
         |CIERRA #caivarep;

         enSiiLin = 0;
         eaSiiCpt = #caivarep#6;
         eaSiiCta = #caivarep#4;
         eaSiiDig = #caivarep#5;
         eaSiiCIF = #caivarep#51;  |QBF eaSiiCIF;
         eaSiiDes = #caivarep#7;
         eaSiiEje = #caivarep#3 % -104;
         enSiiPer = #caivarep#44;
         enSiiUlt = #caivarep#62;
         enSiiRet = 0;
         enSiiDoc = #caivarep#2;
     |FINSI;

     |SI eaSiiPro = "caivasop";
         |ABRE #caivasop;
         #caivasop#0  = enSiiLib;
         #caivasop#27 = eaSiiDoc % 102;
         aAlfa        = eaSiiDoc % 306;
         #caivasop#2  = aAlfa;
         |LEE 000#caivasop.=;
         |SI FSalida ! 0;  |DDEFECTO #caivasop;  |FINSI;
         |CIERRA #caivasop;

         enSiiLin = 0;
         eaSiiCpt = #caivasop#6;
         eaSiiCta = #caivasop#4;
         eaSiiDig = #caivasop#5;
         eaSiiCIF = #caivasop#51;  |QBF eaSiiCIF;
         eaSiiDes = #caivasop#7;
         eaSiiEje = #caivasop#3 % -104;
         enSiiPer = #caivasop#44;
         enSiiUlt = 1;
         enSiiRet = 0;
         enSiiDoc = #caivasop#2;
     |FINSI;
|FPRC;

|PROCESO RellDesglose;
     nCmp1 = 0;
     |SI #casiim01#50 = enSiiLin;  nCmp1 = 50;  |FINSI;
     |SI #casiim01#51 = enSiiLin;  nCmp1 = 51;  |FINSI;
     |SI #casiim01#54 = enSiiLin;  nCmp1 = 54;  |FINSI;
     |SI #casiim01#57 = enSiiLin;  nCmp1 = 57;  |FINSI;
     |SI #casiim01#60 = enSiiLin;  nCmp1 = 60;  |FINSI;
     |SI #casiim01#63 = enSiiLin;  nCmp1 = 63;  |FINSI;

     |SI nCmp1 = 0;
         |SI #casiim01#63 = 0;  nCmp1 = 63;  |FINSI;
         |SI #casiim01#60 = 0;  nCmp1 = 60;  |FINSI;
         |SI #casiim01#57 = 0;  nCmp1 = 57;  |FINSI;
         |SI #casiim01#54 = 0;  nCmp1 = 54;  |FINSI;
         |SI #casiim01#51 = 0;  nCmp1 = 51;  |FINSI;
         |SI #casiim01#50 = 0;  nCmp1 = 50;  |FINSI;

         |SI nCmp1 = 0;  |ACABA;  |FINSI;
     |FINSI;

     #casiim01#nCmp1# = enSiiLin;

     |SI nCmp1 = 50;
         nCmp2 = 7;
         nCmp3 = 8;
     |SINO;
         nCmp2 = nCmp1 + 1;
         nCmp3 = nCmp1 + 2;
     |FINSI;

     #casiiw02#0 = #casiim01#nCmp2#;
     #casiiw02#1 = #casiim01#nCmp3#;

     |HAZ T7C0w2;
     |HAZ T7C1w2;

     #casiim01#nCmp1# = enSiiLin;
     #casiim01#nCmp2# = #casiiw02#0;
     #casiim01#nCmp3# = #casiiw02#1;
|FPRC;

|PROGRAMA;

     |SI enSiiLin ! 0;
         |HAZ EntraTipoDesglose;

         |ACABA;
     |FINSI;

     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = eaSiiDoc;
     |LEE 101#casiim01.=;
     |SI FSalida ! 0;
         |DDEFECTO #casiim01;
         #casiim01#0 = eaSiiPro;
         #casiim01#1 = enSiiLib;
         #casiim01#2 = eaSiiDoc;

         |GRABA 020#casiim01.b;
     |FINSI;

     |SI enSiiL = 0; || No viene de Predefinido ni del Boton SiiDatos
         |HAZ NuevosDefectos;
         |SI nSwDefectos = 0;
             |HAZ Defectos;
         |FINSI;
     |FINSI;

     |SI PARAMETRO = "DEFECTOS";
         aAlfa = #casiim01#13; |QBF aAlfa;
         |SI aAlfa = ""; |Y enSiiCtr = 0;
             #casiim01#13 = eaSiiDes;
         |FINSI;

         |SI eaSiiPro = "caivarep";
             |SI #caivarep#8 ! 0;
                 enSiiLin = 1;
                 enSiiIva = #caivarep#11;
                 |HAZ RellDesglose;
             |FINSI;

             |SI #caivarep#9 ! 0;
                 enSiiLin = 2;
                 enSiiIva = #caivarep#12;
                 |HAZ RellDesglose;
             |FINSI;

             |SI #caivarep#10 ! 0;
                 enSiiLin = 3;
                 enSiiIva = #caivarep#13;
                 |HAZ RellDesglose;
             |FINSI;

             |SI #caivarep#52 ! 0;
                 enSiiLin = 4;
                 enSiiIva = #caivarep#54;
                 |HAZ RellDesglose;
             |FINSI;

             |SI #caivarep#53 ! 0;
                 enSiiLin = 5;
                 enSiiIva = #caivarep#55;
                 |HAZ RellDesglose;
             |FINSI;

             enSiiDoc = #caivarep#2;
             nSw = 1; |HAZ T7C66m01; nSw = 0;
         |FINSI;

         |GRABA 020#casiim01.a;
         |LIBERA #casiim01;

         |ACABA;
     |FINSI;

     |SI enSiiL = 1; |Y aTipoIVA = "R";
         |C_M #casiim01#7, 1, "S";
         |C_M #casiim01#8, 1, "S";
         |SI #casiim01#51 ! 0; |C_M #casiim01#52, 1, "S"; |C_M #casiim01#53, 1, "S"; |FINSI;
         |SI #casiim01#54 ! 0; |C_M #casiim01#55, 1, "S"; |C_M #casiim01#56, 1, "S"; |FINSI;
         |SI #casiim01#57 ! 0; |C_M #casiim01#58, 1, "S"; |C_M #casiim01#59, 1, "S"; |FINSI;
         |SI #casiim01#60 ! 0; |C_M #casiim01#61, 1, "S"; |C_M #casiim01#62, 1, "S"; |FINSI;
         |SI #casiim01#63 ! 0; |C_M #casiim01#64, 1, "S"; |C_M #casiim01#65, 1, "S"; |FINSI;
     |FINSI;

     |C_M #casiim01#66, 1, "S";
     |SI aTipoIVA = "R";
||         |C_M #casiim01#66, 1, "N";   #casiim01#66 = ""; ||  Tique 3824_72
     |FINSI;

     |PINPA #0#casiim01;
     |PINDA #0#casiim01;
     |ENDATOS #1#casiim01;
     |SI FSalida = 0;
         |GRABA 020#casiim01.a;
     |FINSI;
     |LIBERA #casiim01;
|FPRO;

|PROCESO LeeCliPro;
     |ABRE #calibros;
     #calibros#0 = enSiiLib;
     |LEE 000#calibros.=;
     |SI FSalida ! 0;  |DDEFECTO #calibros;  |FINSI;
     |CIERRA #calibros;

     aTipoIVA = #calibros#2;

     enExisDef = 0;
     enLinDef  = 0;
     |HAZ CojoConfig;
     |SI eaTConfig ! "X";
         enSiiCon = eaSiiCpt;
         |HAZ ePorLinea;
         enExisDef = SwCambia;
         enLinDef  = enTConLin;
     |FINSI;

     |ABRE #cacon300;
     |DDEFECTO #cacon300;
     #cacon300#0 = eaSiiCpt;
     |LEE 000#cacon300.=;
     |CIERRA #cacon300;

     a340 = "";
     |SI aTipoIVA = "R"; a340 = #cacon300#5; |FINSI;
     |SI aTipoIVA = "S"; a340 = #cacon300#6; |FINSI;

     |SI a340 ! "Z"; |Y a340 ! "0"; |Y a340 ! "1";
       |Y a340 ! "2"; |Y a340 ! "3"; |Y a340 ! "4";
         |Y a340 ! "5"; |Y a340 ! "6"; |Y a340 ! "7";
          |Y a340 ! "8"; |Y a340 ! "9";

       a340 = "";
         |SI aTipoIVA = "R"; |Y #cacon300#2 = 17; a340 = "D"; |FINSI;
         |SI aTipoIVA = "S"; |Y #cacon300#1 = 10; a340 = "D"; |FINSI;
     |FINSI;

     |ABRE #caclipro;
     |SI aTipoIVA = "R";
         #caclipro#23 = "C";
     |SINO;
         #caclipro#23 = "P";
     |FINSI;
     #caclipro#10 = eaSiiCta;
     #caclipro#11 = eaSiiDig;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     aPais      = #caclipro#24; |QBF aPais;
     eaIdenPais = "01";

     |SI aPais = "";
         aPais = "ES";
     |FINSI;

     |SI aPais = "ESP";
         aPais = "ES";
     |FINSI;

     aAlfa   = aPais;  |QBF aAlfa;
     |SI aAlfa = "GR";  aPais = "EL";  |FINSI;

     |SI aPais ! "ES";
                            eaIdenPais = "06";
         |SI aAlfa = "DE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "AT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "BE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "BG";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "CY";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "DK";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "SI";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "EE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "FI";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "FR";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "EL";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "GB";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "NL";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "HU";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "IT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "IE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "LV";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "LT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "LU";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "MT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "PL";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "PT";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "CZ";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "SK";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "RO";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "SE";  eaIdenPais = "02";  |FINSI;
         |SI aAlfa = "HR";  eaIdenPais = "02";  |FINSI;
     |FINSI;

     |SI aTipoIVA = "R";
         |SI #cacon300#2 = 3;
             eaIdenPais = "02";
         |FINSI;

         |SI #cacon300#2 = 8;
             eaIdenPais  = "04";
         |FINSI;
     |FINSI;

     |SI aTipoIVA = "S";
          |SI #cacon300#1 = 2;  |O #cacon300#1 = 7;
              eaIdenPais  = "04";
          |FINSI;
     |FINSI;

     aAlfa = eaSiiCIF % 101;   |QBF aAlfa;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         eaIdenPais  = "01";
     |FINSI;
|FPRC;

|PROCESO T80;  |TIPO 80;
     |BLIN 04;

     |SI PARAMETRO = "DEFECTOS";
         |HAZ LeeHisto;
     |FINSI;

     |ABRE #caivaasi;
     |DDEFECTO #caivaasi;
     |LEE 041#caivaasi.p;
     |CIERRA #caivaasi;

     aClvPais = "";
     |HAZ LeeCliPro;

     |ABRET #casiim01;
     |ABRET #casiim02;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #casiim01;
     |CIERRAT #casiim02;
|FPRC;
