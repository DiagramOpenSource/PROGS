|FICHEROS;
   cacobrep #0;

   camancob #2;
   caclipro #3;
   carepres #4;
   camanrec #6;
   caivarep #7;

   canempre #30;
   catmprep #999;
|FIN;

|VARIABLES;
   Empresa = "";
   NombreEmp = "";
   informe = "";
   Cont  = 0;
   Cont1 = 0;
   MaxDig = 0;
   Opcion = 0;
   &Emp = "";
   &Per = "";
   &nEjercicio = 0;
   ContLineas = 0;
   alfa1   = "";
   Primero = 0;
   nCampo1 = 0;
   nCampo2 = 0;
   SwError = 0;

   {-1}aMenu  = "";
       aMenu1 = "2400";
       aMenu2 = "1";
       aMenu3 = " Elija opcion: ";
       aMenu4 = "RDS";
       aMenu5 = " Resumido ";
       aMenu6 = " Detallado ";
       aMenu7 = " Det. Sin salto Pagina";

   Path = "";
   Comodin = "";

   Parte1 = "";
   Parte2 = "";
   Long = "";
   LongNum = 0;
   FEstado = 0;
   Posic1 = 0;
   Posic2 = 0;

   &LineaRep = 0;
   &LineaEmp = 0;
   &LineaCli = 0;
   &LineaDet = 0;

   &TotalPCC = 0;
   &TotalCli = 0;
   &TotalEmp = 0;
   &TotalRep = 0;

   &Vacia    = 0;
   &NumPag   = 1;
   &EmpNom   = "";
   &NomRep   = "";

   &ImpOrig = 0;
   &ImpPendte = 0;
   &ImpCobr = 0;

   PrintPie = 0;
   RepAnt = "";
   EmpAnt = 0;
   &CPAnt  = "";
   &PobAnt = "";
   &CtaAnt = "";
   &NomAnt = "";
   &TlfAnt = "";
   DLiq = "";
   HLiq = "";

   EmpresaOrigen = 0;
   PeriodoOrigen = 0;
   aFichero = "";

   nPara1   = 0;
   nPara2   = 0;
   aBlancs  = "";
   aZetas   = "";
|FIN;

|INCLUYE acceso_i;

|PROCESO Mayor;
    #0Campo = #0Campo > #0Campo;
    |PINTA #0Campo;
|FPRC;

|PROCESO MiraSelec;
   |SI Campo = 27;
      |SI #0#27 = "S";
         |C_M #0#28,1,"S";
         |C_M #0#29,1,"S";
         |C_M #0#30,1,"S";
         |C_M #0#31,1,"S";
         |C_M #0#32,1,"S";
         |C_M #0#33,1,"S";
         |C_M #0#34,1,"S";
         |C_M #0#35,1,"S";
         |C_M #0#36,1,"S";
         |C_M #0#37,1,"S";
         |C_M #0#12,1,"N";
         |C_M #0#13,1,"N";
      |SINO;
         |C_M #0#28,1,"N";
         |C_M #0#29,1,"N";
         |C_M #0#30,1,"N";
         |C_M #0#31,1,"N";
         |C_M #0#32,1,"N";
         |C_M #0#33,1,"N";
         |C_M #0#34,1,"N";
         |C_M #0#35,1,"N";
         |C_M #0#36,1,"N";
         |C_M #0#37,1,"N";
         |C_M #0#12,1,"S";
         |C_M #0#13,1,"S";
      |FINSI;
   |FINSI;
   |SI Campo = 38;
      |SI #0#38 = "S";
         |C_M #0#39,1,"S";
         |C_M #0#40,1,"S";
         |C_M #0#41,1,"S";
         |C_M #0#42,1,"S";
         |C_M #0#43,1,"S";
         |C_M #0#44,1,"S";
         |C_M #0#45,1,"S";
         |C_M #0#46,1,"S";
         |C_M #0#47,1,"S";
         |C_M #0#48,1,"S";
         |C_M #0#15,1,"N";
         |C_M #0#16,1,"N";
      |SINO;
         |C_M #0#39,1,"N";
         |C_M #0#40,1,"N";
         |C_M #0#41,1,"N";
         |C_M #0#42,1,"N";
         |C_M #0#43,1,"N";
         |C_M #0#44,1,"N";
         |C_M #0#45,1,"N";
         |C_M #0#46,1,"N";
         |C_M #0#47,1,"N";
         |C_M #0#48,1,"N";
         |C_M #0#15,1,"S";
         |C_M #0#16,1,"S";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Empresa;
     nCampo1 = Campo - 1;
     nCampo2 = Campo;

     |SI #0nCampo1 = EmpresaOrigen; |Y #0nCampo2 = PeriodoOrigen;
         |MENAV "    ERROR. EMPRESA ACTUAL ";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
         |ABRE #30;
         #30#2 = #0nCampo1;
         #30#3 = #0nCampo2;
         |LEE 040#30=;
         |SI FSalida ! 0;
             |MENAV "    No existe Empresa Contable";
             #0nCampo1 = 0;  |PINTA #0nCampo1;
             #0nCampo2 = 0;  |PINTA #0nCampo2;
             |PTEC 808;
             |PTEC 808;
         |FINSI;
         |CIERRA #30;
     |FINSI;
|FPRC;

|PROCESO Cuenta; |TIPO 6;

   |SI dig4 ! 0; MaxDig = dig4; |FINSI;
   |SI dig5 ! 0; MaxDig = dig5; |FINSI;
   |SI dig6 ! 0; MaxDig = dig6; |FINSI;
   |SI dig7 ! 0; MaxDig = dig7; |FINSI;
   |SI dig8 ! 0; MaxDig = dig8; |FINSI;
   |SI dig9 ! 0; MaxDig = dig9; |FINSI;

   Comodin = #0Campo;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      FEstado = FSalida;
      Posic1 = (FEstado / 100) ! 0;
      Posic1 = Posic1 + 99;
      Posic2 = FEstado + 98;
      Parte1 = Comodin % Posic1;
      Parte2 = Comodin % Posic2;
      |QBF Comodin;
      Long = Comodin % 0;
      LongNum = MaxDig - Long;
      Comodin = "0" * LongNum;
      Comodin = Parte1 + Comodin + Parte2;
      #0Campo = Comodin;
      |PINTA #0Campo;
   |FINSI;
|FPRC;                                                                              |PINTA #capredcb#Campo#;

|PROCESO AntesAgrupa; |TIPO 7;
   alfa1    = "N";
   |SI #0#17 ! 0; alfa1 = "S"; |FINSI;
   |SI #0#19 ! 0; alfa1 = "S"; |FINSI;
   |SI #0#21 ! 0; alfa1 = "S"; |FINSI;
   |SI #0#23 ! 0; alfa1 = "S"; |FINSI;
   |SI #0#25 ! 0; alfa1 = "S"; |FINSI;
   |C_M #0#49,1,alfa1;
   |SI alfa1 = "N";
       #0#49 = "N"; |PINTA #0#49;
   |FINSI;
|FPRC;

||  *******************************************************************
|PROCESO Informe1E;  || Ordena Empresa + cuenta
   |SI Primero = 1;
       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       EmpNom = #999#15;
       Primero = 0;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       nEjercicio = #999#23;
       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;
   |FINSI;

   |SI RepAnt ! #999#0;
       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;

       ImpOrig   = 0;
       ImpPendte = 0;
       ImpCobr   = 0;
       LineaRep  = 0;
       LineaEmp  = 0;
       LineaCli  = 0;
       TotalRep  = 1;
       |PRINT;

       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       nEjercicio = #999#23;
       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       EmpNom = #999#15;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;
   |FINSI;

   |SI EmpAnt ! #999#1;
       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;

       ImpOrig   = 0;
       ImpPendte = 0;
       ImpCobr   = 0;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       nEjercicio = #999#23;
       Emp = ("000000" + #999#1) % -106;
       EmpNom = #999#15;
       Per = Emp % 601;
       Emp = Emp % 105;
       LineaRep = 0;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;

       EmpAnt = #999#1;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "N";
       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;

       ImpOrig = 0;
       ImpPendte = 0;
       ImpCobr = 0;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
   |FINSI;

   |SI PobAnt ! #999#19; |Y #0#52 = "S";
       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;

       ImpOrig = 0;
       ImpPendte = 0;
       ImpCobr = 0;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
   |FINSI;

   ImpOrig   = ImpOrig   + #999#6;
   ImpPendte = ImpPendte + #999#7;
   ImpCobr   = ImpCobr   + #999#8;

       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 0;
       TotalRep = 0;
|FPRC;

|PROCESO Informe1;    || ordena cuenta + empresa
   |SI Primero = 1;
       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       EmpNom = #999#15;
       nEjercicio = #999#23;
       Primero = 0;
       RepAnt = #999#0;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       EmpAnt = #999#1;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 0;
       TotalRep = 0;
       |PRINT;
   |FINSI;

   |SI RepAnt ! #999#0;   || Cambia representante
       LineaRep = 0;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;

       ImpOrig   = 0;
       ImpPendte = 0;
       ImpCobr   = 0;
       LineaRep  = 0;
       LineaEmp  = 0;
       LineaCli  = 0;
       TotalRep  = 1;
       |PRINT;

       RepAnt = #999#0;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       EmpAnt = #999#1;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       EmpNom = #999#15;
       nEjercicio = #999#23;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "N";   || Cambia Cliente
       LineaRep = 0;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;

       ImpOrig   = 0;
       ImpPendte = 0;
       ImpCobr   = 0;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       Emp    = ("000000" + #999#1) % -106;
       EmpNom = #999#15;
       nEjercicio = #999#23;
       Per    = Emp % 601;
       Emp    = Emp % 105;
       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;

       EmpAnt = #999#1;
   |FINSI;

   |SI PobAnt ! #999#19; |Y #0#52 = "S";   || Cambia Poblacion
       LineaRep = 0;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;

       ImpOrig   = 0;
       ImpPendte = 0;
       ImpCobr   = 0;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       Emp    = ("000000" + #999#1) % -106;
       EmpNom = #999#15;
       nEjercicio = #999#23;
       Per    = Emp % 601;
       Emp    = Emp % 105;
       LineaRep = 0;
       LineaEmp = 0;
       LineaCli = 1;
       TotalRep = 0;
       |PRINT;

       EmpAnt = #999#1;
   |FINSI;

   |SI EmpAnt ! #999#1;   || cambia empresa
       LineaRep = 0;
       LineaEmp = 1;
       LineaCli = 0;
       TotalRep = 0;
       |PRINT;

       ImpOrig   = 0;
       ImpPendte = 0;
       ImpCobr   = 0;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       Emp = ("000000" + #999#1) % -106;
       EmpNom = #999#15;
       Per = Emp % 601;
       Emp = Emp % 105;

       nEjercicio = #999#23;
       EmpAnt = #999#1;
   |FINSI;

   ImpOrig   = ImpOrig   + #999#6;
   ImpPendte = ImpPendte + #999#7;
   ImpCobr   = ImpCobr   + #999#8;

   LineaRep = 0;
   LineaEmp = 0;
   LineaCli = 0;
   TotalRep = 0;
|FPRC;

|PROCESO Informe2;
   |SI Primero = 1;
       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;

       Primero = 0;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI RepAnt ! #999#0;
       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalCli = 1;
       TotalRep = 1;
       |PRINT;

       |PIEINF;

       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;

       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "N";   || Cambia Cliente

       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 1;
       |PRINT;

       |PIEINF;

       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI PobAnt ! #999#19; |Y #0#52 = "S";   || Cambia Poblacion

       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 1;
       |PRINT;

       |PIEINF;

       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI EmpAnt ! #999#1;  || cambia empresa
       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 1;
       |PRINT;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       Emp = ("000000" + #999#1) % -106;
       EmpNom = #999#15;
       Per = Emp % 601;
       Emp = Emp % 105;

       nEjercicio = #999#23;
       EmpAnt = #999#1;
       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;
       |PRINT;
   |FINSI;

   LineaRep = 0;
   LineaEmp = 0;
   LineaCli = 0;
   LineaDet = 1;
   TotalRep = 0;
   TotalCli = 0;
   |PRINT;

   ImpOrig   = ImpOrig   + #999#6;
   ImpPendte = ImpPendte + #999#7;
   ImpCobr   = ImpCobr   + #999#8;
|FPRC;


|PROCESO Informe2E;
   |SI Primero = 1;
       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;

       Primero = 0;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaEmp = 1;
       LineaCli = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI RepAnt ! #999#0;
       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalCli = 1;
       TotalRep = 1;
       |PRINT;

       |PIEINF;

       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;

       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI EmpAnt ! #999#1;   || cambia empresa
       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 1;
       |PRINT;

       |PIEINF;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;
       Emp = ("000000" + #999#1) % -106;
       EmpNom = #999#15;
       Per = Emp % 601;
       Emp = Emp % 105;

       nEjercicio = #999#23;
       EmpAnt = #999#1;
       LineaRep = 1;
       LineaCli = 1;
       LineaEmp = 1;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;
       |PRINT;
   |FINSI;

   |SI CtaAnt ! #999#2;  |Y #0#52 = "N";    || Cambia Cliente

       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 1;
       |PRINT;

       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 0;
       LineaCli = 1;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   |SI PobAnt ! #999#19;  |Y #0#52 = "S";    || Cambia Cliente

       LineaRep = 0;
       LineaCli = 0;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 1;
       |PRINT;

       Emp = ("000000" + #999#1) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       nEjercicio = #999#23;
       EmpNom = #999#15;
       RepAnt = #999#0;
       EmpAnt = #999#1;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       NomAnt = #999#16;
       TlfAnt = #999#20;

       #0#50 = #999#0;
       #0#51 = #999#21;

       LineaRep = 0;
       LineaCli = 1;
       LineaEmp = 0;
       LineaDet = 0;
       TotalRep = 0;
       TotalCli = 0;

       |PRINT;
   |FINSI;

   LineaRep = 0;
   LineaEmp = 0;
   LineaCli = 0;
   LineaDet = 1;
   TotalRep = 0;
   TotalCli = 0;
   |PRINT;

   ImpOrig   = ImpOrig   + #999#6;
   ImpPendte = ImpPendte + #999#7;
   ImpCobr   = ImpCobr   + #999#8;
|FPRC;

|PROCESO Informe3E;

   |SI Primero = 1;
       Primero = 0;
       RepAnt = #999#0;
       NomRep = #999#21;

       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;

       LineaEmp = 1;
       LineaCli = 1;
   |FINSI;

   |SI RepAnt ! #999#0;
       TotalCli = 1;
       TotalPCC = 1;
       |PRINT;
       |PIEINF;

       RepAnt = #999#0;
       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       LineaCli = 1;
       LineaEmp = 1;
   |FINSI;

   |SI EmpAnt ! #999#1;
       TotalPCC = 1;
       TotalCli = 1;
       |PRINT;

       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       LineaEmp = 1;
       LineaCli = 1;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "N";
       TotalCli = 1;
       |PRINT;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       LineaCli = 1;
   |FINSI;

   |SI PobAnt ! #999#19; |Y #0#52 = "S";
       TotalPCC = 1;
       TotalCli = 1;
       |PRINT;

       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       LineaCli = 1;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "S";
       TotalPCC = 1;
       |PRINT;

       CtaAnt = #999#2;
   |FINSI;

   LineaDet = 1;
   TotalPCC = 0;
   TotalCli = 0;
   TotalEmp = 0;
   |PRINT;
   LineaEmp = 0;
   LineaCli = 0;
   LineaDet = 0;
|FPRC;

|PROCESO Informe3;

   |SI Primero = 1;
       Primero = 0;
       RepAnt = #999#0;
       NomRep = #999#21;

       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;

       LineaEmp = 1;
       LineaCli = 1;
   |FINSI;

   |SI RepAnt ! #999#0;
       TotalEmp = 1;
       TotalCli = 1;
       TotalPCC = 1;
       |PRINT;
       |PIEINF;

       RepAnt = #999#0;
       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       LineaCli = 1;
       LineaEmp = 1;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "N";
       TotalCli = 1;
       |PRINT;

       CtaAnt   = #999#2;
       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       LineaCli = 1;
   |FINSI;

   |SI PobAnt ! #999#19; |Y #0#52 = "S";
       TotalCli = 1;
       TotalEmp = 1;
       TotalPCC = 1;
       |PRINT;

       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
       LineaEmp = 1;
       LineaCli = 1;
   |FINSI;

   |SI EmpAnt ! #999#1;  || cambia empresa
       TotalEmp = 1;
       TotalPCC = 1;
       |PRINT;

       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;

       LineaEmp = 1;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
   |FINSI;

   |SI CtaAnt ! #999#2; |Y #0#52 = "S";
       TotalPCC = 1;
       |PRINT;

       CtaAnt = #999#2;
       EmpAnt = #999#1;
       EmpNom = #999#15;
       CtaAnt = #999#2;
       PobAnt = #999#19;
       CPAnt  = #999#18;
       Emp = EmpAnt; |QBF Emp;
       Emp = ("000000" + Emp) % -106;
       Per = Emp % 601;
       Emp = Emp % 105;
   |FINSI;

   LineaDet = 1;
   TotalCli = 0;
   TotalEmp = 0;
   TotalPCC = 0;
   |PRINT;
   LineaEmp = 0;
   LineaCli = 0;
   LineaDet = 0;
|FPRC;

|PROCESO Informe;
   |SI Opcion = 1;
       |SI #0#49 = "S"; |HAZ Informe1E; |FINSI;
       |SI #0#49 = "N"; |HAZ Informe1;  |FINSI;
   |FINSI;
   |SI Opcion = 2;
       |SI #0#49 = "S"; |HAZ Informe2E; |FINSI;
       |SI #0#49 = "N"; |HAZ Informe2;  |FINSI;
   |FINSI;

   |SI Opcion = 3;
       |SI #0#49 = "S"; |HAZ Informe3E; |FINSI;
       |SI #0#49 = "N"; |HAZ Informe3;  |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Informe;
    #999#1;
    ;
    "  ","            ",000000,"01.01.1900",00,"  ",000001,001;
    "zz","zzzzzzzzzzzz",999999,"31.12.2999",99,"zz",999999,999;
    ;
    NULL,Informe;
|FIN;

|DEFBUCLE InformeP;
    #999#3;
    ;
    "  ",aBlancs,000000,"01.01.1900","            ",00,"  ",000001,001;
    "zz",aZetas, 999999,"31.12.2999","zzzzzzzzzzzz",99,"zz",999999,999;
    ;
    NULL,Informe;
|FIN;

|DEFBUCLE Inform0;
    #999#2;
    ;
    "  ",000000,"            ","01.01.1900",00,"  ",000001,001;
    "zz",999999,"zzzzzzzzzzzz","31.12.2999",99,"zz",999999,999;
    ;
    NULL,Informe;
|FIN;

|DEFBUCLE Inform0P;
    #999#4;
    ;
    "  ", 000000,aBlancs,"01.01.1900","            ",00,"  ",000001,001;
    "zz", 999999,aZetas, "31.12.2999","zzzzzzzzzzzz",99,"zz",999999,999;
    ;
    NULL,Informe;
|FIN;

|DEFBUCLE InformePC;
    #999#5;
    ;
    "  ",aBlancs,000000,"            ","01.01.1900",00,"  ",000001,001;
    "zz",aZetas, 999999,"zzzzzzzzzzzz","31.12.2999",99,"zz",999999,999;
    ;
    NULL,Informe;
|FIN;

|DEFBUCLE Inform0PC;
    #999#6;
    ;
    "  ", 000000,aBlancs,"            ","01.01.1900",00,"  ",000001,001;
    "zz", 999999,aZetas, "zzzzzzzzzzzz","31.12.2999",99,"zz",999999,999;
    ;
    NULL,Informe;
|FIN;

|PROCESO TomaDatos;

   |SI #0#38 = "N";      || Filtro el representante
      |SI #camancob#28 < #0#15; |O #camancob#28 > #0#16; |ACABA; |FINSI;
   |SINO;
      SwError = 0;
      |PARA Cont = 39; |SI Cont [ 48; |HACIENDO Cont = Cont + 1;
         |SI #0Cont = #camancob#28;
             SwError = 1;
             |SAL;
         |FINSI;
      |SIGUE;
      |SI SwError = 0; |ACABA; |FINSI;
   |FINSI;

   |SI #0#27 = "N";      || Filtro el tipo de recibo
      |SI #camancob#11 < #0#12; |O #camancob#11 > #0#13; |ACABA; |FINSI;
   |SINO;
      SwError = 0;
      |PARA Cont = 28; |SI Cont [ 37; |HACIENDO Cont = Cont + 1;
         |SI #0Cont = #camancob#11;
            SwError = 1;
            |SAL;
         |FINSI;
      |SIGUE;
      |SI SwError = 0; |ACABA; |FINSI;
   |FINSI;

   |DDEFECTO #999;
   #999#0  = #camancob#28;         || Representante
   #999#1  = Empresa;              || Empresa + Periodo
   #999#2  = #camancob#4;          || Cuenta Cliente
   #999#3  = #camancob#5;          || Digito Cuenta Cliente
   #999#4  = #camancob#6;          || Cobro:Fecha Emision
   #999#5  = #camancob#7;          || Cobro:Fecha Vencimiento
   #999#6  = #camancob#8;          || Cobro:Importe Original
   #999#8  = #camancob#24;         || Cobro:Importe Cobrado
   #999#7  = #camancob#8 - #camancob#24; || Cobro:Importe Pendiente
   #999#9  = #camancob#0;          || Cobro:Libro
   #999#10 = #camancob#2;          || Cobro:Serie
   #999#11 = #camancob#1;          || Cobro:Factura
   #999#12 = #camancob#3;          || Cobro:N§ recibo
   #999#13 = #camancob#11;         || Cobro:Tipo de recibo
   #999#15 = NombreEmp;            || Empresa:Nombre
   #999#23 = nEjercicio;           || Ejercicio de la Empresa

   #camanrec#0 = #999#13;
   |LEE 010#camanrec.=;
   |SI FSalida = 0;
       #999#14 = #camanrec#1;
   |FINSI;

   #carepres#0 = #camancob#28;
   |LEE 010#carepres.=;
   |SI FSalida = 0;
      #999#21 = #carepres#1;       || Representante:Nombre
   |FINSI;

   #caivarep#0  = #999#9;
   #caivarep#27 = #999#10;
   #caivarep#2  = #999#11;
   |LEE 010#caivarep.=;
   |SI FSalida = 0;
      #999#22 = #caivarep#7;          || Factura:Descripcion Cobro
   |SINO;
      Comodin = "Libro " + #999#9;
      |QBF Comodin;
      Comodin = "/Serie " + #999#10;
      |QBF Comodin;
      Comodin = "/Factura " + #999#11;
      |QBF Comodin;
      #999#22 = Comodin;
   |FINSI;

   #caclipro#23 = "C";
   #caclipro#10 = #999#2;
   #caclipro#11 = #999#3;
   |LEE 010#caclipro.=;
   |SI FSalida = 0;

      #999#16 = #caclipro#1;       || Cliente:Nombre
      #999#17 = #caclipro#2;       || Cliente:Direccion
      Comodin = ("00" + #caclipro#3) % -102;
      Comodin = Comodin + (("000" + #caclipro#4) % -103)
      #999#18 = Comodin;           || Cliente:Codigo Postal

      #999#19 = #caclipro#6;       || Cliente:Poblacion
      #999#20 = #caclipro#7;       || Cliente:Telefono
   |FINSI;

   |GRABA 040#999n;
|FPRC;

|DEFBUCLE TomaDatos;
    #camancob#1;
    4,7,23;
    #0#0,"  ",#0#2,001,#0#4,#0#6,DLiq;
    #0#1,"zz",#0#3,999,#0#5,#0#7,HLiq;
    ;
    NULL,TomaDatos;
|FIN;

|PROGRAMA;

   |HAZ inicio;

   EmpresaOrigen = #30#2;
   PeriodoOrigen = #30#3;

   |CLS;
   |CABEZA "Informe de cobros por representante";
   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |MENU aMenu;
   Opcion = FSalida;
   |SI Opcion < 0; |O Opcion > 3; |ACABA; |FINSI;

   |IMPRE 0;
   |SI FSalida ! 0; |ACABA; |FINSI;

   informe = "cacob1re"; |SI #0#49 = "S"; informe = "cacob4re"; |FINSI;
   |SI Opcion = 2;
       informe = "cacob2re";
       |SI #0#49 = "S"; informe = "cacob5re"; |FINSI;
   |FINSI;
   |SI Opcion = 3;
       informe = "cacob3re";
       |SI #0#49 = "S"; informe = "cacob6re"; |FINSI;
   |FINSI;
   |SI #0#52 = "S";
       informe = informe % 106;
       informe = informe + "po";
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

   |SI #0#14 = "S"; DLiq = "S"; HLiq = "S"; |FINSI;
   |SI #0#14 = "N"; DLiq = "N"; HLiq = "N"; |FINSI;
   |SI #0#14 = "T"; DLiq = "N"; HLiq = "S"; |FINSI;

   aFichero = "3t" + Usuario;
   |NOME_DAT #999 aFichero;

   |DELINDEX #999;

   |ABRE #999;
   |ABRE #3;
   |ABRE #4;
   |ABRE #6;
   |ABRE #7;

   Empresa = ("00000" + #48#2) % -105;
   Empresa = Empresa + #48#3;
   NombreEmp = #48#1;
   nEjercicio = 2000 + #48#26;
   |SI #48#26 > 80; nEjercicio = 1900 + #48#26; |FINSI;
   |BUCLE TomaDatos;

   |CIERRA #7;
   |CIERRA #6;
   |CIERRA #4;
   |CIERRA #3;

   |PARA nPara1 = 17; |SI nPara1 [ 26; |HACIENDO nPara1 = nPara1 + 2;
         Empresa = ("00000" + #0nPara1) % -105;
         nPara2  = nPara1 + 1;
         Empresa = Empresa + #0nPara2;

         |SI Empresa ! "000000";

             |DFICB Path;
             Path = Path + Empresa + "/";

             |PATH_DAT #2 Path;
             |PATH_DAT #3 Path;
             |PATH_DAT #4 Path;
             |PATH_DAT #6 Path;
             |PATH_DAT #7 Path;

             |ABRE #caclipro;
             |ABRE #carepres;
             |ABRE #caivarep;
             |ABRE #camanrec;

             |ABRE #30;
             #30#2 = #0nPara1;
             #30#3 = #0nPara2;
             |LEE 010#30=;
             |SI FSalida = 0;
                 NombreEmp = #30#1;
                 nEjercicio = 2000 + #30#26;
                 |SI #30#26 > 80; nEjercicio = 1900 + #30#26; |FINSI;
                 |BUCLE TomaDatos;
             |FINSI;
             |CIERRA #30;

             |CIERRA #carepres;
             |CIERRA #caclipro;
             |CIERRA #camanrec;
             |CIERRA #caivarep;

        |FINSI;
    |SIGUE;

    aBlancs    = " " * 25;
    aZetas     = "z" * 25;
    Primero    = 1;
    ContLineas = 9;
    NumPag = 1;

    |SI #0#49 = "S";
        |SI #0#52 = "N"; |BUCLE Inform0;  |FINSI;
        |SI #0#52 = "S";
            |SI Opcion = 3;
                |BUCLE Inform0PC;
            |SINO;
                |BUCLE Inform0P;
            |FINSI;
        |FINSI;
    |FINSI;
    |SI #0#49 = "N";
        |SI #0#52 = "N"; |BUCLE Informe;  |FINSI;
        |SI #0#52 = "S";
            |SI Opcion = 3;
                |BUCLE InformePC;
            |SINO;
                |BUCLE InformeP;
            |FINSI;
        |FINSI;
    |FINSI;

    |SI Opcion = 1;
        LineaRep = 0;
        LineaEmp = 0;
        LineaCli = 1;
        TotalRep = 1;
        |PRINT;
    |FINSI;
    |SI Opcion = 2;
        LineaRep = 0;
        LineaEmp = 0;
        LineaCli = 0;
        LineaDet = 0;
        TotalRep = 1;
        TotalCli = 1;
        |PRINT;
    |FINSI;

    |SI Opcion = 3;
       TotalEmp = 1;
       TotalCli = 1;
       TotalPCC = 1;
       |PRINT;
    |FINSI;

    |PIEINF;

    |FININF;
    |FINIMP;
|FPRO;
