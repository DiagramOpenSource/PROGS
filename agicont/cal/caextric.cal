|FICHEROS;
    caextric #0;

    camaasil #1;
    camaasic #2;
    cacuenta #3;
    caclipro #5;
    camanban #6;
    calicont #31;

    camaasi@ #101;

    caw00022 #999;
|FIN;

|VARIABLES;

    &entrada = 1;
    nCampo   = 0;
    aAlfa1   = "";
    nNume1   = 0;
    aFichero = "";
    aMas     = "";
    aDef     = "";

    mensa1   = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    men2     = "     Longitud de Cuenta Fuera de Nivel !";

    &eaDesPac  = "";
    sw_con     = 0;
    x          = 0;
    &cuenta    = "";
    contra     = "";
    digcon     = 0;
    swex_con   = 0;
    aSigno     = "";
    &aNom      = "";
    &aCif      = "";
    nAlgun     = 0;

    &pagina = 0;
    &nSwPagDup = 0;
    &nPagDup = 0;

    digito = 0;
    swdig  = 0;
    cta    = "";
    long   = "";

    sw_pagina = 0;
    &sw_inf = 0;
    &sw_cab = 0;
    sw_prim = 0;
    sw_print = 0;
    sw_cuen = 0;
    swtotal = 0;
    &swant = 0;
    &s_debe = 0;
    &s_haber = 0;
    &s_saldo = 0;
    &debe = 0;
    &haber = 0;

    nDiario    = 0;
    fFecha     = @;
    nDocumento = 0;
    nApunte    = 0;
    primcontra = "";
    ulticontra = "";
    primdig    = 0;
    ultidig    = 0;
    aDCuenta   = "";
    aHCuenta   = "";

    alfa1 = "";
    doce  = "            ";
    informe = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE condes_i;

|| *********************************************************************
||                             COMIENZO
|| *********************************************************************
|PROCESO &c_pagina;
  |SI sw_pagina = 0;
      pagina = #0#38;
      sw_pagina = 1;

      nPagDup = #0#38;
      nSwPagDup = 1;
  |SINO;
      pagina = pagina + 1;

      |HAZ PDuplex;
  |FINSI;
  sw_cab = 1;
|FPRC;

|PROCESO seleccio; |TIPO 0;
|SI #0#4 = "N";
    |C_M #0#05, 1, "S"; |C_M #0#06, 1, "S";
    |C_M #0#07, 1, "S"; |C_M #0#08, 1, "S";
    |C_M #0#09, 1, "S"; |C_M #0#10, 1, "S";
    |C_M #0#11, 1, "S"; |C_M #0#12, 1, "S";
    |C_M #0#13, 1, "S"; |C_M #0#14, 1, "S";
    |C_M #0#15, 1, "S"; |C_M #0#16, 1, "S";
    |C_M #0#17, 1, "S"; |C_M #0#18, 1, "S";
    |C_M #0#19, 1, "S"; |C_M #0#20, 1, "S";
    |C_M #0#21, 1, "S"; |C_M #0#22, 1, "S";
    |C_M #0#23, 1, "S"; |C_M #0#24, 1, "S";
    |C_M #0#25, 1, "S"; |C_M #0#26, 1, "S";
    |C_M #0#27, 1, "S"; |C_M #0#28, 1, "S";
    |C_M #0#33, 1, "N"; |C_M #0#34, 1, "N";
        #0#33 = 1;       |PINTA #0#33;
        #0#34 = 999;     |PINTA #0#34;
|SINO;
    |C_M #0#05, 1, "N"; |C_M #0#06, 1, "N";
    |C_M #0#07, 1, "N"; |C_M #0#08, 1, "N";
    |C_M #0#09, 1, "N"; |C_M #0#10, 1, "N";
    |C_M #0#11, 1, "N"; |C_M #0#12, 1, "N";
    |C_M #0#13, 1, "N"; |C_M #0#14, 1, "N";
    |C_M #0#15, 1, "N"; |C_M #0#16, 1, "N";
    |C_M #0#17, 1, "N"; |C_M #0#18, 1, "N";
    |C_M #0#19, 1, "N"; |C_M #0#20, 1, "N";
    |C_M #0#21, 1, "N"; |C_M #0#22, 1, "N";
    |C_M #0#23, 1, "N"; |C_M #0#24, 1, "N";
    |C_M #0#25, 1, "N"; |C_M #0#26, 1, "N";
    |C_M #0#27, 1, "N"; |C_M #0#28, 1, "N";
    |C_M #0#33, 1, "S"; |C_M #0#34, 1, "S";
|FINSI;
|FPRC;

|PROCESO fechad;
  |SI #0#2 < fec1; |O #0#2 > fec2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO fechah;
  |SI #0#3 < fec1; |O #0#3 > fec2; |O #0#3 < #0#2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO no_dep; |TIPO 7;
   alfa1 = #30#24;
   |C_M #0#36, 1, alfa1; |SI alfa1 = "N"; #0#36 = "  "; |FINSI;
   |C_M #0#37, 1, alfa1; |SI alfa1 = "N"; #0#37 = "zz"; |FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 6;
  p_alfa1 = #0Campo;
  salidas = FSalida;
  |HAZ punto;
  |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
  |SI #0Campo = "            "; |ACABA; |FINSI;

  |SI Campo [ 1;
      digito = Campo + 31;
  |SINO;
      digito = Campo + 18;
  |FINSI;

  cta   = #0Campo; |QBF cta;
  long  = cta % 0;
  swdig = 0;
  |SI long = #30#14; swdig = 1; #0digito = 1; |FINSI;
  |SI long = #30#15; swdig = 1; #0digito = 2; |FINSI;
  |SI long = #30#16; swdig = 1; #0digito = 3; |FINSI;
  |SI long = #30#17; swdig = 1; #0digito = 4; |FINSI;
  |SI long = #30#18; swdig = 1; #0digito = 5; |FINSI;
  |SI long = #30#19; swdig = 1; #0digito = 6; |FINSI;
  |SI swdig = 0;  |MENAV men2;  |ERROR;  |FINSI;
|FPRC;

|PROCESO DHCuenta;
 |SI FSalida = 2; |ACABA; |FINSI;

 nNume1 = Campo - 1;
 |SI #0Campo < #0nNume1;
     |MENAV "    Error al Introducir hasta cuenta";
     |ERROR;
 |FINSI;
|FPRC;
|| ****************************************************************************

|PROGRAMA;
  |HAZ inicio;
  |HAZ VerCaconimp;

  |CLS;
  |CABEZA "Extractos seleccionando contrapartida";

  |DDEFECTO #0;
  |ABRE #0;
  |LEE 000#0p;
  |SI FSalida ! 0;  |GRABA 020#0n; |FINSI;
  |CIERRA #0;

  |DBASE aMas; |QBF aMas;
  aDef = aMas + "def/camaasil";
  |CARGA_DEF aDef, camaasi@;
  |SI FSalida ! 0;
      |MENAV "    Error al cargar camaasil";
      |ACABA;
  |FINSI;

  #0#2 = fec1;
  #0#3 = fec2;
  #0#30 = ~;        || fecha del extracto es siempre fecha del sistema

  FSalida = 1;
  |PARA;|SI FSalida = 1; |HACIENDO;
        sw_pagina = 0;
        sw_prim = 0;
        sw_print = 0;
        sw_inf = 0;
        sw_cuen = 0;
        swtotal = 0;
        |PINPA #0#0;
        |PINDA #0#0;                    || Pinta los datos por defecto
        |ENDATOS #1#0;                  || Seleccion informe
        |SI FSalida = 0;                || Si el conforme es igua a S
            |HAZ borrar;
            |HAZ impre;                 || Calculo impresion
            FSalida = 1;                || Vuelve al bucle
        |SINO;
            FSalida = 0;
        |FINSI;
  |SIGUE;

  |ABRE #0;
  |BORRA 020#0c;
  |SI FSalida = 0;
      |GRABA 020#0n;
  |FINSI;
  |CIERRA #0;

  |DESCARGA_DEF #camaasi@;
|FPRO;

|| *************************************************************************
||                               MEOLLO
|| *************************************************************************

|PROCESO cabecera;
  |ABRE #2;
  #2#0 = nDiario;
  #2#1 = fFecha;
  #2#2 = nDocumento;
  |LEE 040#2=;
  |SI FSalida ! 0;
      |DDEFECTO #2;
  |FINSI;
  |CIERRA #2;
|FPRC;

|PROCESO leecuen;
  aNom = "";
  aCif = "";
  |ABRE #3;
  #3#0 = contra;
  #3#1 = digcon;
  |LEE 001#3=;
  |SI FSalida = 0;
      aNom = #3#2;
  |FINSI;
  |CIERRA #3;

  |ABRE #5;
  #5#23 = "C";
  #5#10 = contra;
  #5#11 = digcon;
  |LEE 040#5=;
  |SI FSalida = 0;
      aNom = #5#1;
      aCif = #5#9;
  |SINO;
      #5#23 = "P";
      #5#10 = contra;
      #5#11 = digcon;
      |LEE 040#5=;
      |SI FSalida = 0;
          aNom = #5#1;
          aCif = #5#9;
      |FINSI;
  |FINSI;
  |CIERRA #5;
|FPRC;

|PROCESO leocontra;
  contra   = "";
  digcon   = 0;
  swex_con = 0;
  |ABRE #31;
  #31#0 = #1#0;
  #31#1 = #1#1;
  #31#2 = #1#2;
  #31#3 = #1#3;
  |LEE 001#31=;
  |SI FSalida = 0;
      swex_con = 1;
      contra   = #31#4;
      digcon   = #31#5;
  |FINSI;
  |CIERRA #31;
|FPRC;

|PROCESO LeoEspejo;

 |SI #101#8 ! aSigno;
     |SI primcontra = "";
         primcontra = #101#4;
         primdig    = #101#5;
     |SINO;
         |SI nApunte > #101#3;
             primcontra = #101#4;
             primdig    = #101#5;
         |SINO;
             ulticontra = #101#4;
             ultidig    = #101#5;
         |FINSI;
     |FINSI;
 |SINO;
     |SI nApunte < #101#3;
         ulticontra = "";
         ultidig    = 0;
         |SI primcontra ! "";
             |ERROR10;
         |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE LeoEspejo;
 #101#1004;
 ;
 nDiario, fFecha, nDocumento, 0001;
 nDiario, fFecha, nDocumento, 9999;
 e;
 NULL, LeoEspejo;
|FIN;

|PROCESO BuscaContra;
 contra     = "";
 digcon     = 0;
 swex_con   = 0;
 primcontra = ""; primdig = 0;
 ulticontra = ""; ultidig = 0;
 |BUCLE LeoEspejo;
 |SI ulticontra > "";
     contra = ulticontra;
     digcon = ultidig;
 |SINO;
     contra = primcontra;
     digcon = primdig;
 |FINSI;
|FPRC;

|PROCESO buclepan;

  |SI #0#4 = "N";
      sw_con = 0;
      |PARA x = 5; |SI x [ 28; |HACIENDO x = x + 1;
            |SI #0x  = #1#6;
                sw_con = 1;
                |SAL;
           |FINSI;
      |SIGUE;
      |SI sw_con = 0; |ACABA;  |FINSI;
  |FINSI;

  nDiario    = #1#0;
  fFecha     = #1#1;
  nDocumento = #1#2;
  nApunte    = #1#3;
  cuenta     = #1#4;
  aSigno     = #1#8;
  |HAZ leocontra;
  |SI swex_con = 0;
      |HAZ BuscaContra;
  |FINSI;

  sw_con = 0;
  |SI contra [ doce; |ACABA; |FINSI; || no la he encontrado
  |SI contra ] #0#50; |Y contra [ #0#51; sw_con = 1; |FINSI;
  |SI contra ] #0#52; |Y contra [ #0#53; sw_con = 1; |FINSI;
  |SI contra ] #0#54; |Y contra [ #0#55; sw_con = 1; |FINSI;
  |SI contra ] #0#56; |Y contra [ #0#57; sw_con = 1; |FINSI;
  |SI contra ] #0#58; |Y contra [ #0#59; sw_con = 1; |FINSI;
  |SI sw_con = 0; |ACABA;  |FINSI;


  #999#0 = #1#0;   #999#1 = #1#1;
  #999#2 = #1#2;   #999#3 = #1#3;
  #999#4 = #1#4;   #999#5 = #1#5;
  #999#6 = #1#6;   #999#7 = #1#7;
  #999#8 = #1#8;   #999#9 = #1#9;
  #999#12 = #1#12; #999#13 = #1#13;
  #999#14 = #1#14; #999#15 = #1#15;
  #999#18 = #1#21; #999#19 = #1#24;

  #999#10 = contra;
  #999#11 = digcon;
  |HAZ leecuen;
  #999#16 = aNom;
  #999#17 = aCif;
  |GRABA 020#999n;

   nAlgun = 1;
|FPRC;

|DEFBUCLE caextrim0;
 #1#3;
 0, 6, 21;
 aDCuenta, 0, #0#2, 000000, #0#39, #0#33, #0#36;
 aHCuenta, 9, #0#3, 999999, #0#40, #0#34, #0#37;
 e;
 NULL, buclepan;
|FIN;
|| ////////////////////////////////////////////////////////////

|PROCESO LeeAuxiliar;

  |SI sw_prim = 0;
      cuenta   = #999#4;
      sw_prim  = 1;
      contra   = #999#4;
      digcon   = #999#5;  ||solo para leer la cuenta
      |HAZ leecuen;
  |FINSI;

  |SI cuenta ! #999#4;
      |PIEINF;
      |HAZ borrar;
      cuenta = #999#4;
      contra = #999#4;
      digcon = #999#5;   ||solo para leer cuenta
      |HAZ leecuen;
  |FINSI;

  eaDesPac = #999#19; |QBF eaDesPac;
  eaDesPac = eaDesPac + " " + #999#7;
  |SI #999#8 = "D";
      debe = #999#9;
      haber = 0;
  |SINO;
      debe = 0;
      haber = #999#9;
  |FINSI;
  nDiario    = #999#0;
  fFecha     = #999#1;
  nDocumento = #999#2;
  |HAZ cabecera;

  |PRINT;
  s_debe  = s_debe  + debe;
  s_haber = s_haber + haber;
  s_saldo = s_debe - s_haber;
  swant = 1;
|FPRC;

|DEFBUCLE LeeAuxiliar;
 #999#1;
 ;
 "            ", fec1, 000001, 01, 0001;
 "zzzzzzzzzzzz", fec2, 999999, 99, 9999;
 ;
 NULL, LeeAuxiliar;
|FIN;
|| \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|PROCESO impre;

  |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

  |IMPRE 0;
  |SI FSalida ! 0;
      |MENAV "    Proceso abortado ...";
      |ACABA;
  |FINSI;

  informe = "caextric";
  |SI eaConDes ! "N";
      informe = "caext0ic";
  |FINSI;

  |INFOR informe;
  |SI FSalida ! 0;
      |FINIMP;
      |ACABA;
  |FINSI;

  aFichero = ("1e" + Usuario) % 108;
  |NOME_DAT #999 aFichero;
  |DELINDEX #999;

  nAlgun = 0;
  |ABRE #999;
  aDCuenta = #0#0; aHCuenta = #0#1;
  |SI aHCuenta > doce; |BUCLE caextrim0; |FINSI;

  aDCuenta = #0#42; aHCuenta = #0#43;
  |SI aHCuenta > doce; |BUCLE caextrim0; |FINSI;

  aDCuenta = #0#44; aHCuenta = #0#45;
  |SI aHCuenta > doce; |BUCLE caextrim0; |FINSI;

  aDCuenta = #0#46; aHCuenta = #0#47;
  |SI aHCuenta > doce; |BUCLE caextrim0; |FINSI;

  aDCuenta = #0#48; aHCuenta = #0#49;
  |SI aHCuenta > doce; |BUCLE caextrim0; |FINSI;
  |CIERRA #999;

  |SI nAlgun = 1;
      sw_prim = 0;
      swant   = 0;
      |BUCLE LeeAuxiliar;
      |SI sw_prim = 1;
          |PIEINF;
      |FINSI;
  |FINSI;
  |FININF;
  |FINIMP;
  |DELINDEX #999;
|FPRC;

|PROCESO borrar;
  s_debe  = 0;
  s_haber = 0;
  s_saldo = 0;
  swant   = 0;
|FPRC;
