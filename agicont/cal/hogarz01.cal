|FICHEROS;
|FIN;

|VARIABLES;
     nHandle             = 0;
     nPausa              = 0;

     aBase               = "";
     aFic                = "";
     aAbre               = "";
     aPathPDF            = "";
     aEjec               = "";
     aAlfa               = "";
     aQH                 = "";
     aBus                = "";

     &eaUnidadBasico     = "";
     &eaOrigen           = "";
     &eaDestino          = "";
|FIN;

|PROCESO RecPdfVG;
     aFic = "VG" + (PARAMETRO % 3);
     |DBASS aBase;

     aAbre = aBase + "hogareur/hogardoc/" + aFic;
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         |CONFI "0000NEl PDF de la factura ya existe, desea recogerlo de nuevo";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |PARA;  |SI;  |HACIENDO;
          aBus = "F*.pdf";
          |BROWSE aBus;   |QBF aBus;
          aBus = aBus % 290;

          aAlfa = (aBus % -103) < "";
          |SI aAlfa ! "pdf";
              |CONFI "0000NBuscamos un documentos PDF, abandonamos la busqueda?";
              |SI FSalida = 0;
                  aBus = "";
                  |SAL;
              |FINSI;
          |SINO;
              |SAL;
          |FINSI;
     |SIGUE;

     |SI aBus = "";
         |MENAV "0000Proceso cancelado.";
         |ACABA;
     |FINSI;

     |DBASS aBase;
     aBase = aBase + "hogareur/hogardoc/";
     aFic  = "VG" + (PARAMETRO % 3);

     eaOrigen  = aBase + aFic;
     eaDestino = aBus;
     |HAZ RecibeEnServidorMD5
|FPRC;

|PROCESO PdfVG;
     aFic = PARAMETRO;
     |DBASS aBase;

     aAbre = aBase + "hogareur/hogardoc/" + aFic;
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |DBASE aBase;
     eaOrigen  = aBase + "hacienda/dsabreextension.exe";
     eaDestino = aPathPDF + "dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;

     eaOrigen  = aAbre;
     eaDestino = aPathPDF + aFic;
     |HAZ EnviaFicheroSinMD5;

     |XABRE "EC", eaDestino, 0;
     |SI FSalida < 0;
         |MENAV "0000No encuento el dsabreextension. Pongase en contacto con su administrador";
         |ACABA;
     |FINSI;

     aEjec = aPathPDF + "dsabreextension ";
     aEjec = aEjec + eaDestino;
     aEjec = aEjec + " " + aPathPDF + "fin" + Usuario + ".txt";

     aAlfa = aPathPDF + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjec;
     aAlfa    = aPathPDF + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;

     |RFBORRA aAlfa;
     |RFBORRA eaDestino;
|FPRC;

|PROCESO RecPdfCC;
     aFic = "CC" + (PARAMETRO % 3);
     |DBASS aBase;

     aAbre = aBase + "hogareur/hogardoc/" + aFic;
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         |CONFI "0000NEl PDF de la factura ya existe, desea recogerlo de nuevo";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |PARA;  |SI;  |HACIENDO;
          aBus = "F*.pdf";
          |BROWSE aBus;   |QBF aBus;
          aBus = aBus % 290;

          aAlfa = (aBus % -103) < "";
          |SI aAlfa ! "pdf";
              |CONFI "0000NBuscamos un documentos PDF, abandonamos la busqueda?";
              |SI FSalida = 0;
                  aBus = "";
                  |SAL;
              |FINSI;
          |SINO;
              |SAL;
          |FINSI;
     |SIGUE;

     |SI aBus = "";
         |MENAV "0000Proceso cancelado.";
         |ACABA;
     |FINSI;

     |DBASS aBase;
     aBase = aBase + "hogareur/hogardoc/";
     aFic  = "CC" + (PARAMETRO % 3);

     eaOrigen  = aBase + aFic;
     eaDestino = aBus;
     |HAZ RecibeEnServidorMD5
|FPRC;

|PROCESO PdfCC;
     aFic = PARAMETRO;
     |DBASS aBase;

     aAbre = aBase + "hogareur/hogardoc/" + aFic;
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |DBASE aBase;
     eaOrigen  = aBase + "hacienda/dsabreextension.exe";
     eaDestino = aPathPDF + "dsabreextension.exe";
     |HAZ EnviaFicheroConMD5;

     eaOrigen  = aAbre;
     eaDestino = aPathPDF + aFic;
     |HAZ EnviaFicheroSinMD5;

     |XABRE "EC", eaDestino, 0;
     |SI FSalida < 0;
         |MENAV "0000No encuento el dsabreextension. Pongase en contacto con su administrador";
         |ACABA;
     |FINSI;

     aEjec = aPathPDF + "dsabreextension ";
     aEjec = aEjec + eaDestino;
     aEjec = aEjec + " " + aPathPDF + "fin" + Usuario + ".txt";

     aAlfa = aPathPDF + "fin" + Usuario + ".txt";
     |RFBORRA aAlfa;

     |RSYSTEM aEjec;
     aAlfa    = aPathPDF + "fin" + Usuario + ".txt";
     |PARA;  |SI;  |HACIENDO;
             |XABRE "EC", aAlfa, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PARA nPausa = 1; |SI nPausa < 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;
             |PULSATECLA;
     |SIGUE;

     |RFBORRA aAlfa;
     |RFBORRA eaDestino;
|FPRC;

|PROGRAMA;
     |SI aQH = "VR";  |HAZ RecPdfVG;  |FINSI;
     |SI aQH = "VG";  |HAZ PdfVG;     |FINSI;

     |SI aQH = "CR";  |HAZ RecPdfCC;  |FINSI;
     |SI aQH = "CC";  |HAZ PdfCC;     |FINSI;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ LeeUnidadBasico;

     aQH = PARAMETRO % 102;

     aPathPDF = eaUnidadBasico + "\documentos";                |RMKDIR aPathPDF;
     aPathPDF = eaUnidadBasico + "\documentos\hogartex";       |RMKDIR aPathPDF;
     aPathPDF = eaUnidadBasico + "\documentos\hogartex\pdf";   |RMKDIR aPathPDF;
     aPathPDF = eaUnidadBasico + "\documentos\hogartex\pdf\";
|FPRC;

|PROCESO T90;  |TIPO 90;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;
