|FICHEROS;
    c3gecomp #0;
    cacuenta #5;         || plan contable
    caconimp #8;
    cacompt1 #11;        || tmp. comparacion
|FIN;

|VARIABLES;
  &pathbal = "";
  &balance = 0;
  alfa1 = "";
  alfa2 = "";
  para1 = 0;
  para2 = 0;
  para3 = 0;

  seleccio = 0;
  saldo    = 0;
  men2  = "     Longitud de Cuenta Fuera de Nivel !";
  men9  = "     Empresa Contable INACTIVA ";

  p_mes  = "";
  &nom1  = "";
  &nom2  = "";
  &ej1   = 0;
  &ej2   = 0;
  &colum = "";
  &des   = "";
  &has   = "";

  d_mes  = 0;
  h_mes  = 0;
  digito = 0;
  swdig  = 0;
  long   = "";
  cta    = "";

  sw_chequeo = 0;
  sw_movimin = 0;
  acum       = 0;
  mas        = 0;
  &r_emp     = 0;
  &r_per     = 0;
  sw_error   = 0;

  xx = 0;
  yy = 0;
  x  = 0;
  y  = 0;
  x1 = 0;
  x2 = 0;
  y1 = 0;
  y2 = 0;
  emp1 = 0;
  emp2 = 0;
  per1 = 0;
  per2 = 0;
  dirfich0 = "";
  dirfich1 = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;


|PROCESO coloca;  |TIPO 8;
  |HAZ inicio;
  |DBASE dir_fich;
  dir_fich = dir_fich + "fich/";
|FPRC;

|PROCESO mayor; |TIPO 0;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO pintames; |TIPO 0;
  |SI #0Campo =  0;  p_mes = "Apertura  ";  |FINSI;
  |SI #0Campo =  1;  p_mes = "Enero     ";  |FINSI;
  |SI #0Campo =  2;  p_mes = "Febrero   ";  |FINSI;
  |SI #0Campo =  3;  p_mes = "Marzo     ";  |FINSI;
  |SI #0Campo =  4;  p_mes = "Abril     ";  |FINSI;
  |SI #0Campo =  5;  p_mes = "Mayo      ";  |FINSI;
  |SI #0Campo =  6;  p_mes = "Junio     ";  |FINSI;
  |SI #0Campo =  7;  p_mes = "Julio     ";  |FINSI;
  |SI #0Campo =  8;  p_mes = "Agosto    ";  |FINSI;
  |SI #0Campo =  9;  p_mes = "Septiembre";  |FINSI;
  |SI #0Campo = 10;  p_mes = "Octubre   ";  |FINSI;
  |SI #0Campo = 11;  p_mes = "Noviembre ";  |FINSI;
  |SI #0Campo = 12;  p_mes = "Diciembre ";  |FINSI;
  |SI #0Campo = 13;  p_mes = "Cierre    ";  |FINSI;

  |SI Campo = 1;     |PINTA 1232, p_mes; des = p_mes;   |FINSI;
  |SI Campo = 2;     |PINTA 1247, p_mes; has = p_mes;   |FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 6;
 p_alfa1 = #0Campo;
 salidas = FSalida;
 |HAZ punto;
 |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
 |SI #0Campo = "            ";  |ERROR;  |ACABA;  |FINSI;
     digito = Campo + 2;
     cta  = #0Campo; |QBF cta;
     long = cta % 0;
     swdig = 0;
 |SI long = #30#14; swdig = 1; #0digito = 1; |FINSI;
 |SI long = #30#15; swdig = 1; #0digito = 2; |FINSI;
 |SI long = #30#16; swdig = 1; #0digito = 3; |FINSI;
 |SI long = #30#17; swdig = 1; #0digito = 4; |FINSI;
 |SI long = #30#18; swdig = 1; #0digito = 5; |FINSI;
 |SI long = #30#19; swdig = 1; #0digito = 6; |FINSI;
 |SI swdig = 0;
     |MENAV men2;
     |ERROR;
 |FINSI;
|FPRC;

|PROCESO nosaldo; |TIPO 7;
  alfa1 = "S";
  |SI #0#8 = "S";  alfa1 = "N";  #0#9 = "S"; |FINSI;
  |CAMPO_MODIFICA #0#9, 1, alfa1;
  |PINTA #0#9;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SUB_EJECUTA "caconemp.run";
  |ERROR;
  #0Campo = r_emp;
  x = Campo + 20;
  #0x = r_per;
  |PTEC 802;
  |PTEC 802;
|FPRC;

|PROCESO pintanter; |TIPO 0;
  |CAMPO_MODIFICA #0Campo,0,alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  x = Campo - 19;
  y = Campo - 20;
  |SI #0y = 0;  |ACABA;  |FINSI;

  #0x = #0y; |PINTA #0x;
  x = Campo + 1;
  #0x = #0Campo - 1;
  |SI #0x < 0;  #0x = 9;  |FINSI;
  |PINTA #0x;
|FPRC;

|PROCESO misma; |TIPO 0;
  |SI FSalida = 2; |ACABA; |FINSI;
  |CAMPO_MODIFICA #0Campo,0,alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  x2 = Campo;      x1 = Campo - 1;
  y2 = Campo - 20; y1 = x1 - 20;
  |SI #0y2 = 0; |O #0y1 = 0; |ACABA;  |FINSI;

  |SI #0x1 = #0x2;|Y #0y1 = #0y2;
      |MENAV "    ATENCION!!! No se puede comparar la misma EMPRESA ...";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO nomodi;
  |CAMPO_MODIFICA #0Campo,0,alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  |PARA x = Campo + 1;  |SI x [ 30;  |HACIENDO x = x + 1;
        #0x = 0;
        |CAMPO_MODIFICA #0x,1,"N";
        y = x + 20;
        #0y = 0;
        |CAMPO_MODIFICA #0y,1,"N";
  |SIGUE;
  y = Campo + 20;
  #0y = 0;
  |CAMPO_MODIFICA #0y,1,"N";
  |PINTA #0y;
|FPRC;

|PROCESO esbuena;
  |SI FSalida = 2; |ACABA; |FINSI;
  |SI #0Campo = 0;
      |SI Campo = 12; |O Campo = 14;  |O Campo = 16;  |O Campo = 18;
                      |O Campo = 20;  |O Campo = 22;  |O Campo = 24;
                      |O Campo = 26;  |O Campo = 28;  |O Campo = 30;
          x = Campo - 1;
          |SI #0x ! 0;
              |MENAV "     DEBE INTRODUCIR UNA EMPRESA QUE EXISTA";
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;
  |FINSI;
  |SI #0Campo = 0; |HAZ nomodi;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0Campo;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0Campo;
      |MENAV "     NO Existe la empresa Contable";
      |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO caldigitos;
  |SI #30#13 < #0#0;  sw_error = 1;  |ACABA;  |FINSI;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2; |ACABA; |FINSI;
  x = Campo - 20;
  |SI #0x = 0;  |ACABA;  |FINSI;
  |ABRE #30;
  x = Campo - 20;
  #30#2 = #0x;
  #30#3 = #0Campo;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la empresa Contable";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #30;
  |SI #30#21 = "I";
      |MENAV men9;
      |ERROR;
      |ACABA;
  |FINSI;
  sw_error = 0;
  |HAZ caldigitos;
  |SI sw_error = 1;
      sw_error = 0;
      |MENAV "      NO SE CORRESPONDEN LOS NIVELES.";
      |ERROR;
      |ACABA;
  |FINSI;
  x = Campo + 20;
  #0x = #30#1;
  |PINTA #0x;
|FPRC;

|| *************************************************************************
|PROCESO tipo3; |TIPO 3;
  |CIERRA #5;

  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |INFOR "cacompar";
  |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

|| *****************************************************************
  |SI #0#7 = "D";    mas = 0;  colum = "DEBE";     |FINSI;
  |SI #0#7 = "H";    mas = 1;  colum = "HABER";    |FINSI;
  |SI #0#7 = "S";    mas = 2;  colum = "SALDO";    |FINSI;
  d_mes = (9 + mas) + (#0#1 * 3);
  h_mes = (9 + mas) + (#0#2 * 3);


 |PARA xx = 11;  |SI xx [ 30;  |HACIENDO xx = xx + 2;
       |SI #0xx = 0;  |SAL;  |FINSI;
       yy = xx + 20;
       alfa1 = #0xx;  emp2 = #0xx;  || Empresa Actual
       alfa2 = #0yy;  per2 = #0yy;
       alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
       alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
       dirfich0 = dir_fich + alfa1 + alfa2 + "/";
       |PATH_DAT #8 dirfich0;
       |ABRE #8;
       |LEE 111#8p;
       |SI #8#2 = "S"  |Y #8#3 = "N";
           pathbal = dirfich0;
           balance = 1;
           |CIERRA #8;
           |SUB_EJECUTA "careccue.tab";
       |FINSI;
       |CIERRA #8;
       yy = xx + 1;
       alfa1 = #0yy;  emp1  = #0yy;  || Empresa Anterior
       yy = yy + 20;
       alfa2 = #0yy;  per1  = #0yy;
       alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
       alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
       dirfich1 = dir_fich + alfa1 + alfa2 + "/";
       |PATH_DAT #8 dirfich1;
       |ABRE #8;
       |LEE 111#8p;
       |SI #8#2 = "S"  |Y #8#3 = "N";
           pathbal = dirfich1;
           balance = 1;
           |CIERRA #8;
           |SUB_EJECUTA "careccue.tab";
       |FINSI;
       |CIERRA #8;
       |HAZ haztodo;
 |SIGUE;

 |FININF;
 |FINIMP;
|FPRC;

|| ****************************************************************
____________________________________/ LECTURA DEL TEMPORAL
|PROCESO lee_tempo1;
  |PRINT;
  seleccio = 1;
|FPRC;

|DEFBUCLE lee_tempo;
 #11#1;
 ;
 "            ", 0;
 "zzzzzzzzzzzz", 9;
 e;
 NULL, lee_tempo1;
|FIN;
____________________________________/ GRABACION DEL TEMPORAL

|PROCESO chequeo;
  sw_chequeo = 0;
  |SI #0#9 = "N";|Y saldo = 0;|Y sw_movimin = 1;
      sw_chequeo = 1;
  |FINSI;
  |SI sw_movimin = 0;|Y #0#8 = "N";
      sw_chequeo = 1;
  |FINSI;
|FPRC;

|PROCESO acumula;
  sw_movimin = 0;
  saldo = 0;
  |PARA para3 = d_mes; |SI para3 [ h_mes; |HACIENDO para3 = para3 + 3;
        |SI #5para3 ! 0;  sw_movimin = 1;  |FINSI;
        |SI #0#7 = "S"; |Y #5para3 = 0;
            para1 = para3 - 2; para2 = para3 - 1;
            |SI #5para1 ! 0; |O #5para2 ! 0;
                sw_movimin = 1;
            |FINSI;
        |FINSI;
        saldo = saldo + #5para3;
  |SIGUE;
|FPRC;

|PROCESO columna1_1;
  |HAZ acumula;
  |HAZ chequeo;
  |SI sw_chequeo ! 0;  |ACABA;  |FINSI;

  #11#0 = #5#0;    || cuenta
  #11#1 = #5#1;    || digito
  |LEE 101#11=;
  |SI FSalida ! 0;
      |DDEFECTO #11;
      #11#0 = #5#0;    || Cuenta
      #11#1 = #5#1;    || digito
      #11#4 = #5#2;    || Nombre
      |GRABA 020#11b;
  |FINSI;

  #11acum = saldo;    || acumulado
  |GRABA 020#11a;
  |LIBERA #11;
|FPRC;

|DEFBUCLE columna1;
 #5#1;
 ;
 #0#3, #0#0;
 #0#4, #0#0;
 e;
 NULL, columna1_1;
|FIN;


|PROCESO haztodo;
  |ABRE #11;
  |CIERRA #11;
  |DELINDEX #11;

  |ABRE #30;
  nom1 = ""; ej1= 0;
  nom2 = ""; ej2= 0;
  #30#2 = emp1;
  #30#3 = per1;
  |LEE 011#30=;
  |SI FSalida = 0;
      nom1 = #30#1; ej1 = #30#26;
  |FINSI;
  #30#2 = emp2;
  #30#3 = per2;
  |LEE 011#30=;
  |SI FSalida = 0;
      nom2 = #30#1; ej2 = #30#26;
  |FINSI;
  |CIERRA #30;

  enEmpresa = #canempre#2;
  enPeriodo = #canempre#3;
  swOperacion = 0
  |SUB_EJECUTA "camoneda.tab";

  |ABRE #11;
  acum = 2;
  |PATH_DAT #5 dirfich1;
  |BUCLE columna1;

  acum = 3;
  |PATH_DAT #5 dirfich0;
  |BUCLE columna1;

  |CIERRA #11;

  |BUCLE lee_tempo;
  |SI seleccio ! 0;
      |PIEINF;
  |FINSI;
  |DELINDEX #11;
|FPRC;
