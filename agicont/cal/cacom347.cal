|FICHEROS;
  cacom347 #0;
  camac347 #1;
  camal347 #2;
  camic347 #3;
  camil347 #4;
  camal348 #44;
  caclipro #10;
|FIN;

|VARIABLES;
  inform1 = "cacom347";
  inform2 = "cainm347";
  &rnif  = "";
  &aTfno = "";
  aNif   = "";
  alfa1  = "";
  d_tipo = 0;
  h_tipo = 0;
  d_segu = "";
  h_segu = "";
  d_arre = "";
  h_arre = "";

  &enSwLinea  = 0;
  &enCobro    = 0;
  &nEjerCobro = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE varnue_i;

|PROCESO Tipo8; |TIPO 8;
  |HAZ inicio;
  |HAZ eVarEmpresa;
|FPRC;

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
  |SI Campo = 3;
      |SI #0Campo = "N";
          |CAMPO_MODIFICA #0#5, 1, "N";
          #0#5 = "N";
          |PINTA #0#5;
      |SINO;
          |CAMPO_MODIFICA #0#5, 1, "S";
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO nummenor;
 |SI #0#1 < #0#0;
     |ERROR;
 |FINSI;
|FPRC;

|PROCESO LeeNifs;
 aTfno = "";
 |ABRE #10;
 |SELECT #4#10;
 #10#9 = aNif;
 |LEE 041#10=;
 |SI FSalida = 0;
     aTfno = #10#7;
 |FINSI;
 |SELECT #1#10;
 |CIERRA #10;
|FPRC;

|PROCESO cainm347;
  aNif = #4#2;
  |HAZ LeeNifs;
  |PRINT;
|FPRC;

|PROCESO Registro2_2010R;
         |PRINT;
         enSwLinea = 1;
|FPRC;

|PROCESO Registro4_2010;
     enCobro = #44#3;
     |SI #44#3 ! 0;
         nEjerCobro = #44#2;  || ejercicio del cobro
         |SI enSwLinea ! 0;
             #2#17 = 0;
             #2#18 = 0;
         |FINSI;
         |HAZ Registro2_2010R;
     |FINSI;
|FPRC;

|DEFBUCLE Registro4_2010;
    #44#1;
    ;
    #2#0, #2#1, 2999;
    #2#0, #2#1, 1990;
    e;
    NULL, Registro4_2010;
|FIN;

|PROCESO imprelin;
     rnif = " ";
     |SI #2#15 = "S"; rnif = "R"; |FINSI;
     aNif = #2#3; |HAZ LeeNifs;

     nEjerCobro = 0;
     enCobro    = #2#17;
     |SI #2#17 ! 0;  nEjerCobro = enEjercicio;  |FINSI;

     enSwLinea = 0;
     |SI #2#2 = 1; |O #2#2 = 2;

         |SI enEjercicio ] 2010;
             |SI #2#17 ! 0;  |HAZ Registro2_2010R; |FINSI;
             |BUCLE Registro4_2010;
         |FINSI;
         |SI enSwLinea = 0;  |HAZ Registro2_2010R; |FINSI;  || no habia cobro alguno
     |SINO;
         |HAZ Registro2_2010R;
     |FINSI;
|FPRC;

|DEFBUCLE cacom347_t;
   #2#2;
   13,14;
   d_tipo, "            ", d_segu, d_arre;
   h_tipo, "zzzzzzzzzzzz", h_segu, h_arre;
   ;
   NULL,imprelin;
|FIN;

|DEFBUCLE cacom347_l;
   #2#1;
   2,13,14;
   #1#0, 00000, d_tipo, d_segu, d_arre;
   #1#0, 99999, h_tipo, h_segu, h_arre;
   ;
   NULL,imprelin;
|FIN;

|PROCESO seleccion;
 d_tipo = #0#0;
 h_tipo = #0#1;
 d_segu = #0#2;
 h_segu = #0#2;
 d_arre = #0#3;
 h_arre = #0#3;
 |SI #0#2 = "A"; d_segu = " "; h_segu = "z"; |FINSI;
 |SI #0#3 = "A"; d_arre = " "; h_arre = "z"; |FINSI;
|FPRC;

|PROCESO impre;  |TIPO 3;

  |SI enEjercicio > 2010;
      inform1 = "cacom348";
      inform2 = "cainm348";
  |FINSI;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

|| .... Primer Informe
  |INFOR inform1;
  |SI FSalida = 0;
      |HAZ seleccion;
      |ABRE #1;
      |LEE 040#1p;
      |SI FSalida = 0;
          |SI #0#4 = 1; |BUCLE cacom347_l; |FINSI;
          |SI #0#4 = 2; |BUCLE cacom347_t; |FINSI;
      |FINSI;
      |CIERRA #1;
      |PIEINF;
      |FININF;
  |FINSI;

|| .... Segundo Informe
  |SI #0#5 = "S";
      |INFOR inform2;
      |SI FSalida = 0;
         |ABRE #3;
         |LEE 040#3p;
         |SI FSalida = 0;
             |BUCLELIN 0cainm347#3;
         |FINSI;
         |CIERRA #3;
         |PIEINF;
         |FININF;
      |FINSI;
  |FINSI;

  |FINIMP;
|FPRC;
