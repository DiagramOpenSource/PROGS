|FICHEROS;
    camocabe #0;
    camoline #1;
|FIN;

|VARIABLES;
    &entrada = 1;
    &sw_lin = 0;
    men1 = "2402Cantidad Negativa de Amort. Fiscal";
    men2 = "2443Cantidad Negativa de Amort. Contable";
    men3 = "2402Cantidad Negativa de Amort. Fiscal       Cantidad Negativa de Amort. Contable";
    men  = "";
    any = "";
    fiac = "  ";
    guarda = "  ";
    relleno = "                                       ";
    aponer = "  ";
    modo = 0;
    import = 0;
    import1 = 0;
    traba = @;
    alfa1 = "";
    elcon = 0;
 &EURO = 1;
 &EURODB = 0;
 &EURODV = 0;
 &EUROTEXTO = "Cambio de Moneda";
 &swOperacion = 0;  || 0 = Lectura / 1 = Alta
 &enEmpresa = 0;
 &enPeriodo = 0;
 &eaMoneda  = "";
|FIN;

|| ...  Calculos desde el campo de LINEA

|PROCESO prim_lin; |TIPO 7;
  |SI entrada = 1; |Y sw_lin = 0;
      sw_lin = 1;
      #1#0 = #0#0;
      #1#1 = #0#1;
      #1#2 = 1;
      any = #0#6 % 704;
      #1#3 = any;
      #1#4 = "C";
      #1#5 = #0#7;
      #1#9 = #0#7;
      #1#6 = "S";
      #1#7 = #0#6;
      #1#8 = "";
      |PINTA #1#2;
      |PINTA #1#3;
      |PINTA #1#7;
      |PINTA #1#4;
      |PINTA #1#8;
      |PINTA #1#5;
      |PINTA #1#9;
      |PINTA #1#6;
      |ENCAMPO #8#1;
      |GRABA 021#1n;
      #0#13 = #0#7;
      #0#19 = #0#7;
      |PINTA #0#13;
      |PINTA #0#19;
      aponer = "nosi";
      |HAZ poncontr;
      |PTEC 809;          ||Flecha Abajo
  |FINSI;
|FPRC;

|PROCESO acumula; |TIPO 2;           || ... desde linea
  |SI elcon = 1; elcon = 0; |ACABA; |FINSI;
  modo = (FEntrada / 100) ! 0;
  |SI #1#4 = "A";
      #0#12 = #0#12 +. #1#5;
      #0#18 = #0#18 +. #1#9;
      #0#13 = #0#13 -. #1#5;
      #0#19 = #0#19 -. #1#9;
      |SI #0#23 > "01.01.0000";
          |SI #1#7 ] #0#23;
              #0#13 = 0;
              #0#19 = 0;
          |FINSI;
      |FINSI;
  |FINSI;
  |SI modo = 3;
      |SI #1#4 ! "C"; |Y #1#7 ] #0#23;
          #0#13 = #0#7 - #0#12;
          #0#19 = #0#7 - #0#18;
      |FINSI;
  |FINSI;
  |SI #1#4 = "C";
      #0#7  = #0#7  +. #1#5;
      #0#13 = #0#13 +. #1#5;
      #0#19 = #0#19 +. #1#5;
  |FINSI;
  |PINDA #0#0;
|FPRC;

|PROCESO lin_imp; |TIPO 0;
  modo = (FEntrada / 100) ! 0;
  |SI modo = 1;
      |SI #0#13 = 0; |Y #0#19 = 0;
          |SI #0#23 > "01.01.0000";
              |MENAV "0000Amortizacion Finalizada y Elemento VENDIDO;";
              |ERROR;
          |SINO;
              |MENAV "0000Amortizacion Finalizada. Solo se puede Vender";
              #1#4 = "V";
              |PINTA #1#4;
          |FINSI;
      |FINSI;
 |FINSI;
|FPRC;

|| .......................................................................

|PROCESO cal_any; |TIPO 7;
  modo = (FEntrada / 100) ! 0;
  |SI modo ! 1; |ACABA; |FINSI;
  traba = ~;
  any   = traba % 704;
  #1#3  = any;

  |PINTA #1#3;
|FPRC;

|PROCESO mayorli; |TIPO 0;

  modo = (FEntrada / 100) ! 0;
  |SI modo = 1; |Y #1Campo = "C";
      |SI #0#12 ! 0;  |O #0#18 ! 0;
          |MENAV "0000Opcion de Compra NO permitida, se esta Amortizando";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI #1#2 = 1; |Y #1Campo ! "C";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI #1Campo = "V";  |Y #0#23 > "01.01.0000";
      |MENAV "0000El elemento ya ha sido Vendido";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI #1Campo = "V";  |O #1Campo = "C";
      |CAMPO_MODIFICA #1#9, 1, "N";
  |SINO;
      |CAMPO_MODIFICA #1#9, 1, "S";
  |FINSI;
|FPRC;

|PROCESO baja; |TIPO 1;
  |SI entrada = 3; |ACABA; |FINSI;

  modo = (FEntrada / 100) ! 0;
  elcon = 0;
  |SI #1#2 = 1; |Y modo = 3;
      |MENAV "0000*** NO PUEDE DAR DE BAJA ESTA LINEA ***";
      |ERROR;
      elcon = 1;
      |ACABA;
  |FINSI;

  |SI #1#6 = "S";
      |AVISO;
      |CONFI "2400N** Linea Contabilizada **. Continuar (S/N) ";
      |SI FSalida ! 0;
          |ERROR;
          elcon = 1;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI #1#4 = "V";
      #0#23 = "00.00.0000";
      |PINTA #0#23;
  |FINSI;
||  |SI #1#4 = "A"; |HAZ impor3; |FINSI;
|FPRC;


|| ************ IMPORTES DE LA AMORTIZACION ********************************

|PROCESO impor; |TIPO 0;
  |SI #1#4 = "C";  |O #1#4 = "V";
      #1#9 = #1#5;
      |PINTA #1#9;
      |ACABA;
  |FINSI;

  |SI #1#5 = 0;  |Y #0#13 ! 0;
      |MENAV "0000********* El Importe debe ser Diferente de CERO *********";
    ||  |ERROR;
      |ACABA;
  |FINSI;

  |HAZ impor3;

  import1 = (#0#12 + #1#5) ! EURODB;
  import  = (#0#7 - import1) ! EURODB;
  |SI #0#7 > 0;
      |SI import < 0;
          |MENAV "0000****La Amortizacion Fiscal supera el importe de la compra";
          |ERROR;
          |ACABA;
      |FINSI;
  |SINO;
      |SI import > 0;
          |MENAV "0000****La Amortizacion Fiscal supera el importe de la compra";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO impor1; |TIPO 0;
  |SI #1#4 ! "A"; |ACABA;  |FINSI;

  |SI #1#9 = 0;  |Y #0#19 ! 0;
      |MENAV "0000********* El Importe debe ser Diferente de CERO *********";
    ||  |ERROR;
      |ACABA;
  |FINSI;

  |HAZ impor3;

  import1 = (#0#18 + #1#9) ! EURODB;
  import  = (#0#7 - import1) ! EURODB;

  |SI #0#7 > 0;
      |SI import < 0;
          |MENAV "0000****La Amortizacion Contable supera el importe de la compra";
          |ERROR;
          |ACABA;
      |FINSI;
  |SINO;
      |SI import > 0;
          |MENAV "0000****La Amortizacion Contable supera el importe de la compra";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO impor3;
  |ACABA;
  |SI #1#5 ] 0; |Y #1#9 ] 0;
      |BLIN 24;
      |ACABA;
  |FINSI;
  |SI #1#5 < 0; |Y #1#9 < 0;
      men = men3;
  |SINO;
      |SI #1#5 < 0;
          men = men1;
      |SINO;
          men = men2;
      |FINSI;
  |FINSI;
  |MENSA men;
|FPRC;

|| **************************************************************************

|PROCESO fecven; |TIPO 3;
  |BLIN 24;
  |SI #1#4 = "V";
      #0#23 = #1#7;
      |PINTA #0#23;
  |FINSI;
  |SI #1#4 = "C"; |Y #1#2 = 1;
      #0#6 = #1#7;
      |PINTA #0#6;
  |FINSI;
|FPRC;

|PROCESO poncontr;                 || calculo 'guarda'
  fiac = Control % A109;
  fiac = fiac + relleno;
  guarda = fiac % A109;
  fiac = Control % A1001;
  Control = Control + fiac;
  Control = Control + relleno;
  Control = Control % A120;
  Control = Control + aponer;
|FPRC;

|PROCESO Amt5; |TIPO 5;
 FSalida = "SINBARRA";
|FPRC;
