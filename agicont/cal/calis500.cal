|FICHEROS;
  calis500 #0;
  camaasil #1;
  cacuenta #2;
  caclipro #3;
  camanban #4;

  catmp500 #5;
  cadatemp #6;
|FIN;


|VARIABLES;
    &entrada = 1;
  men1 = "     NO EXISTE IMPRESORA";
  men2 = "     NO EXISTE INFORME";
  informe = "";
  inform1 = "calis500";
  inform2 = "calis501";

  dfecha = @01.01.1900;
  hfecha = @01.01.2999;

  alfa1 = "";
  alfa2 = "";
  num = 0;
  swencontra = 0;

  &cabecera = "";
  &codcue = "";
  &nomcue = "";
  &cifcue = "";
  &dircue = "";
  &pobcue = "";
  &cp = "";
  &importe  = 0;

  cta = "";
  niv = 0;
  swcta = 0;
  sw = 0;
  swalgun = 0;
  nNume1 = 0;
  aAlfa1 = "";
  nCampo = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;

|PROCESO mayus;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|PROCESO cuenta; |TIPO 0;
    p_alfa1 = #0Campo;
    salidas = FSalida;
|HAZ punto;
|SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
|FPRC;

|PROCESO nomodif;|TIPO 7;
  |SI #0#3 = "N";
      |C_M #0Campo,1,"N";
  |SINO;
      |C_M #0Campo,1,"S";
  |FINSI;
|FPRC;

|PROCESO simodifi;|TIPO 7;
  |SI #0#3 = "S";
      |C_M #0Campo,1,"N";
  |SINO;
      |C_M #0Campo,1,"S";
  |FINSI;
|FPRC;

|PROCESO impresion;

  |SI #0#3 = "S";
      sw = 1;
      |VETE fuera;
  |FINSI;
  sw = 0;
  |PARA num = 6;|SI num [ 40;|HACIENDO num = num + 1;
        |SI #1#6 = #0num;
            sw = 1;
            |SAL;
        |FINSI;
        |SI num = 23; num = 26; |FINSI;
  |SIGUE;

|ET fuera;
  |SI sw ! 1;
      |ACABA;
  |FINSI;
  |SI swcta = 0;
      cta = #1#4;
      niv = #1#5;
      swcta = 1;
  |FINSI;
  |SI cta ! #1#4;
      #2#0 = cta;
      #2#1 = niv;
      |LEE 040#2=;
      |SI FSalida ! 0;
          |DDEFECTO #2;
      |FINSI;
      codcue = #2#0;
      nomcue = #2#2;
      cifcue = "";
      dircue = "";
      pobcue = "";
      cp = "";
      |SI importe ] #0#25;
          |HAZ leeclipro;
          |PRINT;
          swalgun = 1;
      |FINSI;
      cta = #1#4;
      niv = #1#5;
      importe = 0;
  |FINSI;
  |SI #0#24 = "D";
      |SI #1#8 = "D";
          importe = importe + #1#9;
      |SINO;
          importe = importe - #1#9;
      |FINSI;
  |SINO;
      |SI #1#8 = "H";
          importe = importe + #1#9;
      |SINO;
          importe = importe - #1#9;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE calis5000;
 #1#3;
 6;
 #0#1,0,dfecha,000001,#0#4;
 #0#2,9,hfecha,999999,#0#5;
 be;
 NULL,impresion;
|FIN;

|PROCESO periodo;|TIPO 3;
  |HAZ Comienzo;
|FPRC;

|PROCESO leeclipro;
  |HAZ proveedor; |SI swencontra = 1; |ACABA; |FINSI;
  |HAZ cliente;   |SI swencontra = 1; |ACABA; |FINSI;
  |HAZ banco;     |SI swencontra = 1; |ACABA; |FINSI;
|FPRC;

|PROCESO cliente;
  swencontra = 0;
  #3#23 = "C";
  #3#10 = cta;
  #3#11 = niv;
  |LEE 040#3=;
  |SI FSalida = 0;
      nomcue = #3#1;
      cifcue = #3#9;
      dircue = #3#2;
      pobcue = #3#6;
      cp = #3#25; |SI cp = "00000"; cp = ""; |FINSI;
      swencontra = 1;
  |FINSI;
|FPRC;

|PROCESO proveedor;
  swencontra = 0;
  #3#23 = "P";
  #3#10 = cta;
  #3#11 = niv;
  |LEE 040#3=;
  |SI FSalida = 0;
      nomcue = #3#1;
      cifcue = #3#9;
      dircue = #3#2;
      pobcue = #3#6;
      cp = #3#25; |SI cp = "00000"; cp = ""; |FINSI;
      swencontra = 1;
  |FINSI;
|FPRC;

|PROCESO banco;
  swencontra = 0;
  #4#10 = cta;
  #4#11 = niv;
  |LEE 040#4=;
  |SI FSalida = 0;
      nomcue = #4#1;
      cifcue = #4#14;
      dircue = #4#2;
      pobcue = #4#6;
      alfa1 = #4#3; alfa1 = ("000" + alfa1 ) % -102;
      alfa2 = #4#4; alfa2 = ("000" + alfa2 ) % -103;
      cp = alfa1 + alfa2; |SI cp = "00000"; cp = ""; |FINSI;
      swencontra = 1;
  |FINSI;
|FPRC;

*****************************************************************************
*****************************************************************************
***          Nuevo proceso listado 500.000 ptas. desde asientos           ***
*****************************************************************************
*****************************************************************************

|VARIABLES;
   Comodin = "";

   Cont    = 0;
   SwCont  = 0;
   SwError = 0;

   Dobles  = 0;
   Path = "";

   Comodin1 = "";
   ComodNum = 0;

   Empresa = 0;
   Periodo = 0;

   Dia = "";
   Mes1 = "";
   Mes2 = "";
   Year = "";

   FechaIni  = @;
   FechaFin  = @;
|FIN;

|PROCESO Asientos;

   |SI #calis500#3 = "S";
      |SI #camaasil#6 < #calis500#4; |O #camaasil#6 > #calis500#5;
         |ACABA;
      |FINSI;
   |SINO;
      SwError = 1;
      |PARA Cont = 6; |SI Cont [ 40; |HACIENDO Cont = Cont + 1;
         |SI #camaasil#6 = #calis500#Cont#; SwError = 0; |SAL; |FINSI;
      |SIGUE;
      |SI SwError = 1; |ACABA; |FINSI;
   |FINSI;

   SwCont = 1;

   #catmp500#0 = #camaasil#4;
   |LEE 010#catmp500.=;
   |SI FSalida ! 0;
      |DDEFECTO #catmp500;
      #catmp500#0 = #camaasil#4;
      #caclipro#23 = "C";
      #caclipro#10 = #camaasil#4;
      #caclipro#11 = #camaasil#5;
      |LEE 010#caclipro.=;
      |SI FSalida ! 0;
         #caclipro#23 = "P";
         #caclipro#10 = #camaasil#4;
         #caclipro#11 = #camaasil#5;
         |LEE 010#caclipro.=;
         |SI FSalida ! 0;
            |DDEFECTO #caclipro;
         |FINSI;
      |FINSI;

      #catmp500#1 = #caclipro#9;
      #catmp500#3 = #caclipro#23;
      #catmp500#4 = #camaasil#5;
      #catmp500#9 = #caclipro#1;
      |GRABA 020#catmp500.n;
      |LEE 010#catmp500.=;
   |FINSI;

|| ABDON 28/02/2006    Solucion para el tiquet 3042 / 266
||      Se supone que lo que se quiere con la pregunta "DEBE/HABER" no es
||      determinar con que signo acumulan debe o haber, sino que movimientos
||      se deben tomar en cuenta para el listado
||
/*
   |SI #0#24 = "D";
      |SI #camaasil#8 = "D";
         #catmp500#2 = #catmp500#2 + #camaasil#9;
      |SINO;
         #catmp500#2 = #catmp500#2 - #camaasil#9;
      |FINSI;
   |SINO;
      |SI #camaasil#8 = "D";
         #catmp500#2 = #catmp500#2 - #camaasil#9;
      |SINO;
         #catmp500#2 = #catmp500#2 + #camaasil#9;
      |FINSI;
   |FINSI;
*/

   |SI #0#24 = #camaasil#8;
       #catmp500#2 = #catmp500#2 + #camaasil#9;

       aAlfa1 = #camaasil#1;
       aAlfa1 = aAlfa1 % 402;
       nNume1 = aAlfa1;
       |SI nNume1 [ 3;                nCampo = 5; |FINSI;
       |SI nNume1 > 3; |Y nNume1 [ 6; nCampo = 6; |FINSI;
       |SI nNume1 > 6; |Y nNume1 [ 9; nCampo = 7; |FINSI;
       |SI nNume1 > 9;                nCampo = 8; |FINSI;
       #5nCampo = #5nCampo + #1#9;
   |FINSI;

   |GRABA 020#catmp500.a;
|FPRC;

|DEFBUCLE Asientos;
   #camaasil#1;
   ;
   #0#41,FechaIni,000000,0001;
   #0#42,FechaFin,999999,9999;
   ;
   NULL,Asientos;
|FINSI;

|PROCESO MiraEmpresa;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #cadatemp#0 = #48#2; |Y #cadatemp#1 =#48#3;
      |MENAV "    La empresa debe ser distinta a la actual";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Imprime;

   |SI #catmp500#3 = "C"; |Y #catmp500#2 < #calis500#25; |ACABA; |FINSI;
   |SI #catmp500#3 = "P"; |Y #catmp500#2 < #calis500#25; |ACABA; |FINSI;

   #3#23 = #catmp500#3;
   #3#10 = #catmp500#0;
   #3#11 = #catmp500#4;
   |LEE 001#3=;
   |SI FSalida ! 0;
      |DDEFECTO #3;
   |FINSI;
   codcue = #catmp500#0;
   dircue = #3#2;
   pobcue = #3#6;
   nomcue = #3#1;
   cifcue = #3#9;
   cp     = (("00" + #3#3) % -102) + (("000" + #3#4) % -103);
   importe = #catmp500#2;
   |SI cp = "00000"; cp = ""; |FINSI;

   |PRINT;
   ||PIEINF;
|FPRC;

|DEFBUCLE ImprimeCta;
   #catmp500#1;
   ;
   #calis500#1;
   #calis500#2;
   ;
   NULL,Imprime;
|FIN;

|PROCESO Comienzo;
  cabecera = #0#26;

   |DELINDEX #catmp500;
   |ABRE #catmp500;
   |ABRE #48;
   |ABRE #3;

   Comodin = ("00" + #48#26) % -102;
   |SI #48#26 ] 80;
      Year = "19" + Comodin;
   |SINO;
      Year = "20" + Comodin;
   |FINSI;
   Comodin = "01.01." + Year;
   FechaIni = Comodin;
   Comodin = "31.12." + Year;
   FechaFin = Comodin;

   |SI #48#11 ! 1;
      |PUSHV 0501 2380;
      |PINPA #0#6;
      |PINDA #0#6;
      |ENDATOS #1#6;
      |SI FSalida < 0; |ACABA; |FINSI;
      |DFICB Path;
      |QBF Path;
      Path = Path + (("00000" + #cadatemp#0) % -105);
      Path = Path + #cadatemp#1 + "/";
      Dobles = 1;
   |SINO;
      Dobles = 0;
   |FINSI;

   |IMPRE 0;
   |SI FSalida ! 0;  |ERROR;  |ACABA;  |FINSI;

   informe = inform1; |SI #0#43 = "S"; informe = inform2; |FINSI;
   |INFOR informe;
   |SI FSalida ! 0;  |FINIMP;  |ERROR;  |ACABA;  |FINSI;

   SwCont = 0;
   |BUCLE Asientos;
   |SI Dobles = 1;
      |PATH_DAT #1 Path;
      |BUCLE Asientos;
   |FINSI;
   |SI SwCont = 0; |ACABA; |FINSI;

   |CIERRA #48;
   |CIERRA #catmp500;

   |BUCLE ImprimeCta;

   |PIEINF;
   |FININF;
   |FINIMP;

   |CIERRA #3;
|FPRC;

|PROCESO Defectos; |TIPO 7;
   |SI EURODB = 2;
      #calis500#25 = 3005.06;
      #0#26 = "INFORME CTAS SALDO MAYOR 3.005,06 EUROS / APUNTES";
   |SINO;
      #calis500#25 = 500000;
      #0#26 = "INFORME CTAS SALDO MAYOR 500.000 PTAS / APUNTES";
   |FINSI;
   |PINTA #calis500#25;
   |PINTA #0#26;
|FPRC;
