|FICHEROS;
   n43desco #0;
   camaasil #1;
   zdescili #2;
   caconcil #3;
   cacuenta #10;
   n43histo #20;
   n43datos #21;
|FIN;

|VARIABLES;
    conta = 0;
    tipo = 0;
    &entrada = 1;
    cta       = 0;
    cta_t     = 0;
    dig_t     = 0;
    long      = "  ";
    sw        = 0;
    error     = 0;
    &contador = 0;
    &cuenta   = "";
    &digito   = 0;
    &saldoant = 0;
    &nombre   = "";
    feini = @;
    fefin = @;
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE i_ficher;

|PROCESO cuenta; |TIPO 6;
     salidas = FSalida;
    p_alfa1 = #0Campo;
|HAZ punto;
|SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
   cta_t = Campo;
   dig_t = Campo + 1;
   |HAZ cuenta_t;
|FPRC;

|PROCESO cuenta_t;
   cta  = #0cta_t;
   long = cta % 0;
   sw   = 0;
|SI long = dig4; sw = 1; #0dig_t = 1; |FINSI;
|SI long = dig5; sw = 1; #0dig_t = 2; |FINSI;
|SI long = dig6; sw = 1; #0dig_t = 3; |FINSI;
|SI long = dig7; sw = 1; #0dig_t = 4; |FINSI;
|SI long = dig8; sw = 1; #0dig_t = 5; |FINSI;
|SI long = dig9; sw = 1; #0dig_t = 6; |FINSI;

|SI sw = 0;
    #0dig_t = 0;
    |MENAV "    Longitud de cuenta fuera de Nivel !";
    |ERROR;
    |ACABA;
|FINSI;
|FPRC;

|PROCESO cuefin; |TIPO 0;
error = 0;
|ABRE #10;
#10#0 = #0cta_t;
#10#1 = #0dig_t;
|LEE 040#10=;
|SI FSalida ! 0; error = 1; |CIERRA #10; |ERROR; |ACABA; |FINSI;
|SI #10#3 = "N";
    error = 1;
    |CIERRA #10;
    |MENAV "      La cuenta no tiene pase DIRECTO !";
    |ERROR;
    |ACABA;
|FINSI;
#0#4 = #10#2;
|PINTA #0#4;
|CIERRA #10;
|FPRC;

|PROCESO calcuant;
|SI #1#8 = "D";
        #0#2 = #0#2 + #1#9;
|SINO;
        #0#2 = #0#2 - #1#9;
|FINSI;
|FPRC;

|PROCESO indexa;
    contador = contador + 1;
    #2#0 = contador;
    #2#1 = #1#0;
    #2#2 = #1#1;
    #2#3 = #1#2;
    #2#4 = #1#3;
    #2#5 = #1#7;
|SI #1#8 = "D";
        #2#6 = #1#9;
        #2#7 = 0;
|SINO;
        #2#7 = #1#9;
        #2#6 = 0;
|FINSI;
    #2#8 = "*";
|GRABA 020#2n;
|FPRC;

|PROCESO grabaapun;
    #1#0 = #2#1;
    #1#1 = #2#2;
    #1#2 = #2#3;
    #1#3 = #2#4;
|LEE 101#1=;
|SI FSalida = 0;
        #1#18 = " ";
    |GRABA 020#1a;
    |HAZ borrahis;
|FINSI;
|LIBERA #1;
|FPRC;

|DEFBUCLE camaasil0;
#1#3;
18;
#0#0, #0#1, feini, 000000, " ";
#0#0, #0#1, fefin, 999998, " ";
e;
NULL, calcuant;
|FIN;

|DEFBUCLE camaasil1;
#1#3;
18;
#0#0, #0#1, feini, 000000, "û";
#0#0, #0#1, fefin, 999998, "û";
e;
NULL, indexa;
|FIN;

|DEFBUCLE zconcili;
#2#1;
8;
0001, " ";
9999, " ";
e;
NULL, grabaapun;
|FIN;

|PROCESO concilia; |TIPO 3;
|SI error = 1; |ACABA; |FINSI;
 comienza = "y";
 |HAZ fichero;
 |NOME_DAT #2 fichero;

 |ABRE #2;
 |CIERRA #2;
 |DELINDEX #2;

|MENSA "2400 Procesando ......";
feini = "01.01.1900";
fefin = "31.12.2999";
|BUCLE camaasil0;
|PINTA #0#2;

|ABRE #2;
contador = 0;
feini = "01.01.1900";
fefin = "31.12.2999";
|BUCLE camaasil1;
|CIERRA #2;

|BLIN 24;
cuenta   = #0#0;
digito   = #0#1;
saldoant = #0#2;
nombre   = #0#4;

|SI contador = 0;
    |MENAV "      No hay nada para Desconciliar !!!";
    |DELINDEX #2;
    |ACABA;
|FINSI;

|SUB_EJECUTA "zdescili.run";

|CONFI "2400SActualizar Desconciliacion: ";
|SI FSalida = 0;
    |ABRE #1;
    |ABRE #3;
    |ABRET #20;
    |ABRE #21;
    |BUCLE zconcili;
    |CIERRA #1;
    |CIERRA #3;
    |CIERRAT #20;
    |CIERRA #21;
|FINSI;
|DELINDEX #2;
|FPRC;


|PROCESO borrahis;
     |SELECT #3#20;
     #20#10  = #1#4; ||Cuenta Apunte;
     #20#11  = #1#5; ||Digito;
     #20#12  = #1#1; ||Fecha Apunte;
     #20#13  = #1#2; ||Documento Apunte;
     |LEE 040#20=;  ||Lee Fichero Consolidaciones;
        |SI FSalida = 0;
             conta = #20#1;
             tipo  = #20#20;
             |SI tipo = 0;
                  |HAZ cero;
                  |BORRA 020#20c;
             |FINSI;
             |SI tipo = 1;
                  |HAZ uno;
             |FINSI;
             |SI tipo = 2;
                  |HAZ dos;
             |FINSI;
        |FINSI;
|FPRC;

|PROCESO cero;
     #21#0 = #20#1;
     |LEE 040#21=;
     |SI FSalida = 0;
          #21#9 = "N";
          #21#11 = "N";
          |GRABA 020#21a;
     |FINSI;
|FPRC;

|PROCESO lehis;
#21#0 = #20#1;
|LEE 040#21=;                  || Marca los registros de entradas
   |SI FSalida = 0;
       #21#9  = "N";
       #21#11 = "N";
       |GRABA 020#21a;
   |FINSI;

   #1#0 = #20#18; #1#1 = #20#12; #1#2 = #20#13; #1#3 = #20#19;
|LEE 040#1=;
   |SI FSalida = 0;
       #1#18 = " ";
       |GRABA 020#1a;
   |FINSI;
|BORRA 020#20c;
|FPRC;

|DEFBUCLE lehis;
    #20#2;
;
conta;
conta;
;
NULL,lehis;
|FIN;

|PROCESO uno;
     |BUCLE lehis;
|FPRC;

|PROCESO lehis2;
#21#0 = #20#1;
|LEE 040#21=;                  || Marca los registros de entradas
   |SI FSalida = 0;
       #21#9  = "N";
       #21#11 = "N";
       |GRABA 020#21a;
   |FINSI;

   #1#0 = #20#18; #1#1 = #20#12; #1#2 = #20#13; #1#3 = #20#19;
|LEE 040#1=;
   |SI FSalida = 0;
       #1#18 = " ";
       |GRABA 020#1a;
   |FINSI;
|BORRA 020#20c;
|FPRC;

|DEFBUCLE lehis2;
    #20#3;
;
#1#4,#1#5,#1#1,#1#2;
#1#4,#1#5,#1#1,#1#2;
;
NULL,lehis2;
|FIN;

|PROCESO dos;
     |BUCLE lehis2;
|FPRC;
