|FICHEROS;
  cacreano #0;
  casesion #100;
  caseslin #110;
  casescop #50;

  cacuenta #1;
  imagen@  #101;
|FIN;

|VARIABLES;
 aD1 = "";
 aDD = "";
 aH1 = "";
 aHD = "";
 nAntSes = 0;
 aAntDep = "";

 nTecla = 0;
 nPara1 = 0;
 nPara2 = 0;
 aBase  = "";
 aDef   = "";
 fich   = "";
 alfa1  = "";
 alfa2  = "";
 temporal1 = "";
 temporal2 = "";
 nSw    = 0;
 &eaFicbal = "";
 aFicbueno = "";
 aParam = "";
 nUltCodigo = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE vardep_i;

|| ****************************************************************
|PROCESO DesactLin;
  #110#5 = alfa1;
  |GRABA 020#110a;
  |LIBERA #110;
|FPRC;

|DEFBUCLE DesactLin;
 #110#1;
 ;
 nAntSes, aD1;
 nAntSes, aH1;
 be;
 NULL, DesactLin;
|FIN;

|PROCESO Desactualiza;
 #100#0 = nAntSes;
 |LEE 101#100=;
 |SI FSalida = 0;
     alfa1 = "N";
     |SI nAntSes ! #50#0;
         #100#5 = "N";
         |GRABA 020#100a;
         aD1 = ""; aH1 = "zz";
         |BUCLE DesactLin;
     |SINO;
         |SI aAntDep ! #50#1;
             aD1 = aAntDep; aH1 = aAntDep;
             |BUCLE DesactLin;
         |FINSI;
     |FINSI;
 |FINSI;
 |LIBERA #100;
|FPRC;

|PROCESO ActivaSesion;

  |ABRE #0;
  |LEE 101#0p;
  |SI FSalida ! 0;
      |DDEFECTO #0;
      |GRABA 020#0b;
  |FINSI;
  nAntSes = #0#26;
  aAntDep = #0#28;

  #0#25 = "S";
  #0#26 = #100#0;
  #0#27 = #100#31;
  #0#28 = #100#1;
  #0#29 = #100#4;
  #0#30 = #100#2;
  #0#31 = #100#3;
  |PARA nPara1 = 0; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
        nPara2 = nPara1 + 6;
        #0nPara1 = #100nPara2;
  |SIGUE;
  |PARA nPara1 = 34; |SI nPara1 [ 45; |HACIENDO nPara1 = nPara1 + 1;
        nPara2 = nPara1 - 1;
        #0nPara1 = #100nPara2;
  |SIGUE;
  |GRABA 020#0a;
  |LIBERA #0;
  |CIERRA #0;

  |SI nAntSes ! 0;
      |HAZ Desactualiza;
  |FINSI;

  #100#0 = #50#0;
  |LEE 101#100=;
  aD1     = #100#1; aH1     = #100#1;
  nAntSes = #100#0; nAntSes = #100#0;
  alfa1 = "S"; |BUCLE DesactLin;

  #100#5 = "S";
  |GRABA 020#100a;
  |LIBERA #100;
|FPRC;
|| --------------------------------------------------------

|PROCESO QueDep; |TIPO 0;
  alfa1 = "S"; alfa2 = "N"; |SI #50#34 = "D"; alfa1 = "N"; alfa2 = "S"; |FINSI;
  |C_M #50#14, 1, alfa2; |C_M #50#15, 1, alfa2;
  |C_M #50#35, 1, alfa1; |C_M #50#36, 1, alfa1;
  |C_M #50#37, 1, alfa1; |C_M #50#38, 1, alfa1;
  |C_M #50#39, 1, alfa1; |C_M #50#40, 1, alfa1;
  |C_M #50#41, 1, alfa1; |C_M #50#42, 1, alfa1;
  |C_M #50#43, 1, alfa1; |C_M #50#44, 1, alfa1;
  |SI alfa1 = "S";
      #50#14 = "  "; |PINTA #50#14;
      #50#15 = "zz"; |PINTA #50#15;
  |SINO;
      |PDEFECTO #0, 35, 45;
      |PINTA #50#35; |PINTA #50#36;
      |PINTA #50#37; |PINTA #50#38;
      |PINTA #50#39; |PINTA #50#40;
      |PINTA #50#41; |PINTA #50#42;
      |PINTA #50#43; |PINTA #50#44;
  |FINSI;
|FPRC;

|PROCESO MiroEsta;
 |C_M #50Campo, 0, alfa1;
 |SI alfa1 = "N"; |ACABA; |FINSI;

 |SI #50Campo = "  "; |ACABA; |FINSI;

 nSw = 0;
 |SI #100#34 ! "D";
     nSw = 1;
     |PARA nPara1 = 35; |SI nPara1 [ 44; |HACIENDO nPara1 = nPara1 + 1;
           |SI #100nPara1 = #50Campo;
               nSw = 0; |SAL;
           |FINSI;
     |SIGUE;
 |SINO;
     |SI #50Campo < #100#14; |O #50Campo > #100#15;
         nSw = 1;
     |FINSI;
 |FINSI;
 |SI nSw = 1;
     |MENAV "    Error. El Departamento no esta en la Seleccion Original";
     |ERROR;
 |FINSI;
|FPRC;

|PROCESO BuscaNueva;
 |ABRE #100;
 #100#0 = #50#0;
 |LEE 001#100=;
 |SI FSalida = 0;
     |MENAV "    Error. Ya existe Sesion";
     |ERROR;
 |FINSI;
 |CIERRA #100;
|FPRC;

|PROCESO LeoAnterior;
 |ABRE #100;
 |DDEFECTO #100;
 |LEE 020#100u;
 nUltCodigo = #100#0;

 |DDEFECTO #100;
 #100#0 = #50#45;
 |LEE 001#100=;
 |SI FSalida ! 0;
     |MENAV "    Error. No existe Sesion";
     |CIERRA #100;
     |ERROR;
     |ACABA;
 |FINSI;
 |SI #100#31 = "N";
     |MENAV "    En esta sesion no se rompio por Departamentos";
     |CIERRA #100;
     |ERROR;
     |ACABA;
 |FINSI;

 |DDEFECTO #50;
 |PARA nPara1 = 4; |SI nPara1 [ 44; |HACIENDO nPara1 = nPara1 + 1;
       #50nPara1 = #100nPara1;
 |SIGUE;
 #50#45 = #100#0;
 #50#46 = #100#2;
 #50#47 = #100#3;
 #50#48 = #100#4;
 #50#49 = #100#14;
 #50#50 = #100#15;
 |PARA nPara1 = 34; |SI nPara1 [ 44; |HACIENDO nPara1 = nPara1 + 1;
       nPara2 = nPara1 + 17;
       #50nPara2 = #100nPara1;
 |SIGUE;


 #50#0 = nUltCodigo + 1;
 #50#1 = #100#1;
 #50#2 = Usuario % 0810;
 #50#3 = ~;
 #50#4 = #100#4;
 #50#31 = "N";
 |PINDA #0#50;

 |CIERRA #100;
|FPRC;


|PROGRAMA;

  aParam = PARAMETRO;
  |SI aParam = "";
      |HAZ inicio;
      |CLS;
  |SINO;
      #50#45 = eaCodDep;
      |HAZ LeoAnterior;
  |FINSI;

  |PINPA #0#50;
  |PINDA #0#50;
  |ENDATOS #1#50;
  |SI FSalida = 0;
      |HAZ LoCreo;
  |FINSI;
|FPRO;
||************************************************************************

|PROCESO LeoCuentas;
 #1#0 = #101#0;
 #1#1 = #101#1;
 |LEE 101#1=;
 |SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #101#0; #1#1 = #101#1;
     #1#2 = #101#2; #1#3 = #101#3;
     #1#4 = #101#4; #1#5 = #101#5;
     #1#6 = #101#6; #1#7 = #101#7;
     #1#8 = #101#8; #1#54 = #101#54;
     #1#55 = #101#55; #1#56 = #101#56;
     #1#57 = #101#57; #1#58 = #101#58;
     #1#59 = #101#59;
     |GRABA 020#1b;
 |FINSI;
 |PARA nPara2 = 9; |SI nPara2 [ 53; |HACIENDO nPara2 = nPara2 + 1;
       #1nPara2 = #1nPara2 + #101nPara2;
 |SIGUE;
 |GRABA 020#1a;
 |LIBERA #1;
|FPRC;

|DEFBUCLE LeoCuentas;
 #101#1002;
 ;
 "            ", 0;
 "zzzzzzzzzzzz", 9;
 ;
 NULL, LeoCuentas;
|FIN;

|PROCESO LineaDep;
 aFicbueno = #110#6;
 |SI nSw = 0;
     |HAZ copiando;
     nSw = 1;
 |SINO;
     |NOME_DAT #101 aFicbueno;
     |ABRE #1;
     |BUCLE LeoCuentas;
     |CIERRA #1;
 |FINSI;
|FPRC;

|DEFBUCLE LineaDep;
 #110#1;
 ;
 #50#45, aDD;
 #50#45, aHD;
 ;
 NULL, LineaDep;
|FIN;


|PROCESO LoCreo;
 |ABRE #100;

 #100#0 = #50#0;
 |LEE 101#100=;
 |SI FSalida ! 0;
     |DDEFECTO #100;
     #100#0 = #50#0;
     |GRABA 020#100b;
 |FINSI;

 |PARA nPara1 = 0; |SI nPara1 [ 44; |HACIENDO nPara1 = nPara1 + 1;
       #100nPara1 = #50nPara1;
 |SIGUE;
 alfa1 = #100#0; alfa1 = ("00" + alfa1) % -102;
 eaFicbal = "cabala" + alfa1;
 #100#32 = eaFicbal;

 |GRABA 020#100a;
 |LIBERA #100;

 |ABRE #110;
 #110#0 = #100#0;
 #110#1 = "  ";
 |LEE 101#110=;
 |SI FSalida ! 0;
     |DDEFECTO #110;
     #110#0 = #100#0;
     #110#1 = "  ";
     |GRABA 020#110b;
 |FINSI;
 #110#2 = #100#2;
 #110#3 = #100#3;
 #110#4 = #100#4;
 #110#5 = "S";
 #110#6 = "";
 #110#7 = "TODOS LOS DEPARTAMENTOS SELECCIONADOS";
 |GRABA 020#110a;
 |LIBERA #110;
 |CIERRA #110;

|| ................ CreoDepartamento;

  |DBASE aBase;
  aDef = aBase + "def/cacuenta";
  |CARGA_DEF aDef, imagen@;
  |SI FSalida ! 0;
      |MENAV "    Error Cuentas";
      |ACABA;
  |FINSI;

 |NOME_DAT #1 eaFicbal;
 |ABRE #1; |CIERRA #1; |DELINDEX #1;

 nSw = 0;
 |SI #50#34 = "D";
     aDD = #50#14;
     aHD = #50#15;
     |BUCLE LineaDep;
 |SINO;
     |PARA nPara1 = 35; |SI nPara1 [ 44; |HACIENDO nPara1 = nPara1 + 1;
           |SI #50nPara1 ! "  ";
               aDD = #50nPara1;
               aHD = #50nPara1;
               |BUCLE LineaDep;
           |FINSI;
     |SIGUE;
 |FINSI;

 |HAZ ActivaSesion;
 |CIERRA #100;

 |DESCARGA_DEF #imagen@;
|FPRC;

|PROCESO copiando;
  |DFICE fich;
  temporal1 = fich + aFicbueno + ".ixx";
  temporal2 = fich + eaFicbal  + ".ixx";
  |COPIA_FICHERO temporal1,temporal2;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  temporal1 = fich + aFicbueno + ".dat";
  temporal2 = fich + eaFicbal  + ".dat";
  |COPIA_FICHERO temporal1,temporal2;
  |SI FSalida ! 0;
      temporal2 = fich + eaFicbal + ".ixx";
      |FBORRA temporal2;
      |ACABA;
  |FINSI;
  temporal1 = fich + aFicbueno + ".ddx";
  temporal2 = fich + eaFicbal  + ".ddx";
  |COPIA_FICHERO temporal1,temporal2;
|FPRC;
