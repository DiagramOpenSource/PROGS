|FICHEROS;
    cactere2 #00;   ||  el #5 y el #8 estan reservados para los 'INCLUYE'
    camaasic #02;   || /para 'cacuenta' y 'catradia' respect.
    camaasil #03;
  ||cacuenta #05;
  ||catradia #08;
    caremesc #06;
    caremesl #07;
    camandia #10;
    cacuebal #11;
    camancob #12;

    caivarep #13;
    caconcep #14;

    caivaasi #210;
    ca8m0002 #422;
|FIN;

|VARIABLES;
    aCampo1 = "";
    aCampo2 = "";
    aCampo3 = "";
    aAlfa4  = "";
    &enDiario   = 0;
    &enContador = 0;

    aCue = "";
    nCam = 0;
    &entrada = 1;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    arteris = 0;
    muestra = "";
    digito = 0;
    longi = 0;
    asie = 0;
    asivi1 = 0;
    asivi2 = 0;
    apu1   = 0;
    apu2   = 0;
    apun = 0;
    cuen = "";
    digi = 0;
    sign = "";
    ptas = 0;
    conc = 0;
    desc = "";
    aDesc1 = "";
    aDesc2 = "";
    sw = 0;
    FEstado = 0;

    seleccio = 0;
    cta       = 0;
    cta_t     = 0;
    dig_t     = 0;
    long      = "  ";
    &salidas  = 0;
    &enEjerBal = 0;
|FIN;

|INCLUYE varnue_i;
|INCLUYE inicio_i;
|INCLUYE actcta_i;
|INCLUYE punto2_i;
|INCLUYE defec1_i;

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;

|PROCESO contab2;    || graba apunte
    #0#08 = #6#0;   |PINTA #0#08;
    #0#09 = asie;   |PINTA #0#09;
    #0#10 = apun;   |PINTA #0#10;

    |DDEFECTO #3;

    |ABRE #camancob;
    #camancob#0 = #caremesl#2;
    #camancob#1 = #caremesl#3;
    #camancob#2 = #caremesl#4;
    #camancob#3 = #caremesl#5;
    |LEE 010#camancob.=;
    |SI FSalida = 0;
       #3#21 = #camancob#28;
    |FINSI;
    |CIERRA #camancob;

    #3#00 = #0#4;   || diario
    #3#01 = #0#7;   || fecha
    #3#02 = asie;   || asiento
    #3#03 = apun;   || apunte
    #3#04 = cuen;   || cuenta
    #3#05 = digi;   || digito
    #3#06 = conc;   || concepto
    #3#07 = desc;   || descripcion
    #3#08 = sign;   || signo
    #3#09 = ptas;   || importe
|SI #3#08 = "D";
        #3#16 = #3#4;
        #3#17 = #3#5;
        #3#10 = "";
        #3#11 = 0;
|SINO;
        #3#16 = "";
        #3#17 = 0;
        #3#10 = #3#4;
        #3#11 = #3#5;
|FINSI;
|GRABA 020#3n;
|HAZ cabecera;           || cabecera apunte
    ressum = #3#9;
|HAZ actualiz1;          || cuenta
|HAZ actualiz3;          || diario
    opera = "A";
|HAZ altatra;            || subniveles
|FPRC;

|PROCESO clientes;

||----------------------------------------------------------
|SI #0#19 = "N";             || Cuenta 431  Agrupada..NO...
    asie = asivi1;
    apu2 = apu2 + 10;
    apun = apu2;
    aCue = #7#11 % -109;
    cuen = "431" + aCue;
    digi = #7#12;
    sign = "D";
    ptas = #7#7;
    conc = #0#17;

|| ... Descripcion del Asiento
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";

    || .. Descripcion
    alfa2 = #0#18; |QBF alfa2;

    || .. Numero factura
    alfa1 = #7#4 + aCampo2; |QBF alfa1;
    aAlfa4 = #7#3;
    |SI aCampo3 = "S"; aAlfa4 = ("000000" + aAlfa4) % -106; |FINSI;
    alfa1 = alfa1 + aAlfa4;
    alfa1 = " " + alfa1;

    || .. Fecha Vencimiento
    alfa3 = #7#6;
    alfa4 = " " + (alfa3 % 106) + (alfa3 % -104);

    desc = alfa2;
    |SI #0#11 = "D";
        |HAZ DesFactura;
    |SINO;
        |SI #0#11 ! "V";
            desc = desc + alfa1 + " "; ||numero factura
        |FINSI;
        |SI #0#11 ! "F";
            desc = desc + alfa4;
        |FINSI;
    |FINSI;

    |HAZ cuenta;
    |HAZ contab2;
|FINSI;

||----------------------------------------------------------

    asie = asivi1;
    apu2 = apu2 + 10;
    apun = apu2;
    cuen = #7#11;
    digi = #7#12;
    sign = "H";
    ptas = #7#7;
    conc = #0#2;

|| ... Descripcion del Asiento
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    || .. Descripcion
    alfa2 = #0#3; |QBF alfa2;

    || .. Numero factura
    alfa1 = #7#4; |QBF alfa1;
    alfa1 = alfa1 + #7#3;
    alfa1 = " " + alfa1;

    || .. Fecha Vencimiento
    alfa3 = #7#6;
    alfa4 = " " + (alfa3 % 106) + (alfa3 % -104);

    desc = alfa2;
    |SI #0#11 = "D";
        |HAZ DesFactura;
    |SINO;
        |SI #0#11 ! "V";
            desc = desc + alfa1 + " "; ||numero factura
        |FINSI;
        |SI #0#11 ! "F";
            desc = desc + alfa4;
        |FINSI;
    |FINSI;

    |HAZ cuenta;
    |HAZ contab2;
    |SI #0#19 = "N";             || Cuenta 431  Agrupada..NO...
        apu2 = 0;
        enDiario = #0#4;
        |HAZ contador;
        asivi1 = enContador;
    |FINSI;
|FPRC;

|PROCESO contab1;   || controla la grabacion de apuntes
    seleccio = 1;
    apun = 0;
    apu1 = 0;
    apu2 = 0;
enDiario = #0#4;
|HAZ contador;
asivi1 = enContador;
||----------------------------------------------------------
|SI #0#19 = "S";             || Cuenta 431  Agrupada.......
    asie = asivi1;
    apu2 = apu2 + 10;
    apun = apu2;
    cuen = #0#20;            || Cuenta Pedida En Pantalla..
    digi = #0#21;
    sign = "D";
    ptas = #6#10;
    conc = #0#17;
    alfa2 = #0#18;
    |QBF alfa2;
    alfa1 = #6#0;   alfa1 = "00000" + alfa1;  alfa1 = alfa1 % -106;
    desc = alfa2 + " " + alfa1;
    |HAZ cuenta;
    |HAZ contab2;
|FINSI;
|BUCLELIN 2clientes#6;
enDiario = #0#4;
|HAZ contador;
asivi2 = enContador;
||--------------------------------------------------------
    asie = asivi2;
    apu1 = apu1 + 1;
    apun = apu1;
    cuen = #6#14;
    digi = #6#15;             || apunte del banco
    sign = "D";
    ptas = #6#10;
    conc = #0#5;
    alfa2 = #0#6;
|QBF alfa2;
    alfa1 = #6#0;   alfa1 = "00000" + alfa1;  alfa1 = alfa1 % -106;
    desc = alfa2 + " " + alfa1;
|HAZ cuenta;
|HAZ contab2;

|SI #0#14 = "N";             || Cuenta 5208 Agrupada No.
||----------------------------------------------------------
    asie = asivi2;
    apu1 = apu1 + 10;
    apun = apu1;
    aCue = #6#14 % -108;
    cuen = "5208" + aCue;
    digi = #6#15;
    sign = "H";
    ptas = #6#10;
    conc = #0#12;
    alfa2 = #0#13;
|QBF alfa2;
    alfa1 = #6#0;   alfa1 = "00000" + alfa1;  alfa1 = alfa1 % -106;
    desc = alfa2 + " " + alfa1;
|HAZ cuenta;
|HAZ contab2;
|FINSI;
||----------------------------------------------------------
|SI #0#14 = "S";             || Cuenta 5208 Agrupada.......
    asie = asivi2;
    apu1 = apu1 + 10;
    apun = apu1;
    cuen = #0#15;            || Cuenta Pedida En Pantalla..
    digi = #0#16;
    sign = "H";
    ptas = #6#10;
    conc = #0#12;
    alfa2 = #0#13;
|QBF alfa2;
    alfa1 = #6#0;   alfa1 = "00000" + alfa1;  alfa1 = alfa1 % -106;
    desc = alfa2 + " " + alfa1;
|HAZ cuenta;
|HAZ contab2;
|FINSI;
||-------------------------------------------------------
    #6#9 = "S";          || contabilizada
|GRABA 020#6a;
|LIBERA #6;
|FPRC;

|DEFBUCLE cactvpag0;
 #6#1;
 9;
 #0#0, "N";
 #0#1, "N";
 be;
 NULL, contab1;
 #6#1, #6#2, #6#0;
|FIN;

|PROCESO LeeCaivaasi;
 |ABRE #210;
 |DDEFECTO #210;
 |LEE 001#210p;
 |CIERRA #210;
 aCampo1 = #210#45;
 aCampo2 = #210#48;
 aCampo3 = #210#49;
|FPRC;

|PROCESO proceso; |TIPO 3;  || calculo padre
     |SI #30#26 < 80;
         enEjercicio = 2000 + #30#26;
     |SINO;
         enEjercicio = 1900 + #30#26;
     |FINSI;


  |HAZ LeeCaivaasi;
|ABRE #2;
|ABRE #3;
|BUCLE cactvpag0;
|SI seleccio ! 0;
    |HAZ subniveles;
|FINSI;
|CIERRA #2;
|CIERRA #3;
|FPRC;

|PROCESO subniveles;     || actualiza subniveles de cuentas
|SI modcon = 0;
    |ABRE #8;
    |DDEFECTO #8;
        #8#0 = codcon;
    |LEE 001#8=;
    |SI FSalida = 0;
        |BORRA 020#8a;
    |FINSI;
    |CIERRA #8;
|SINO;
    |SUB_EJECUTA "camaapua.run";
|FINSI;
|FPRC;

|PROCESO cabecera;       || actualiza cabeceras
|SI #3#09 ! 0;
    |DDEFECTO #2;
        #2#00 = #3#0; ||  diario
        #2#01 = #3#1; ||  fecha
        #2#02 = #3#2; ||  documento
        #2#03 = #3#2; ||  asiento
    |LEE 101#2=;
        FEstado = FSalida;
    |SI #3#08 = "D";
            #2#04 = #2#04 + #3#09;
        |SI #2#09 = 0; #2#08 = #3#4; #2#09 = #3#5; |FINSI;  || contrp.HABER
    |FINSI;
    |SI #3#08 = "H";
            #2#05 = #2#05 + #3#09;
        |SI #2#11 = 0; #2#10 = #3#4; #2#11 = #3#5; |FINSI;  || contrp.DEBE
    |FINSI;
        #2#6 = #2#4 - #2#5;      || saldo
    |SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
    |SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
    |LIBERA #2;
|FINSI;
|FPRC;

|PROCESO actualiz3;
|ABRE #10;
    #10#0 = #3#0;
|LEE 121#10=;
|SI FSalida = 0;
    |SI #3#8 = "D";  #10#2 = #10#2 + #3#9;  |FINSI;
    |SI #3#8 = "H";  #10#3 = #10#3 + #3#9;  |FINSI;
    |GRABA 020#10a;
|FINSI;
|LIBERA #10;
|CIERRA #10;
|FPRC;

|PROCESO cuenta;    || comprueba si la cuenta esta dada de alta
|ABRE #5;
    #5#0 = cuen;
    #5#1 = digi;
|LEE 001#5=;
|SI FSalida ! 0;
    |DDEFECTO #5;
        #5#0 = cuen;
        #5#1 = digi;
    |HAZ defect1;
    |PUSHV 0501 2380;
    |PINPA #0#5;
    |PINDA #0#5;
    |ENDATOS #1#5;
    |SI FSalida = 0;
        |GRABA 020#5n;
    |FINSI;
    |POPV;
|FINSI;
|CIERRA #5;
|FPRC;

**************************************************************************
          CALCULOS DESDE CAMPOS
**************************************************************************

|PROCESO limite; |TIPO 0;
|SI #0#7 < fec1;|O #0#7 > fec2;
    |MENAV "    ATENCION!!! La fecha no corresponde al ejercicio contable ...";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO final; |TIPO 7;
 |PTEC 816;
|FPRC;

|PROCESO cuenta1; |TIPO 6;
    p_alfa1 = #0Campo;
    salidas = FSalida;
|HAZ punto2;
|SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
   cta_t = Campo;
   dig_t = Campo + 1;
   |HAZ cuenta1_t;
|FPRC;

|PROCESO cuenta1_t;
   cta  = #0cta_t;
   long = cta % 0;
   sw   = 0;

|SI long = dig4; sw = 1; #0dig_t = 1; |FINSI;
|SI long = dig5; sw = 1; #0dig_t = 2; |FINSI;
|SI long = dig6; sw = 1; #0dig_t = 3; |FINSI;
|SI long = dig7; sw = 1; #0dig_t = 4; |FINSI;
|SI long = dig8; sw = 1; #0dig_t = 5; |FINSI;
|SI long = dig9; sw = 1; #0dig_t = 6; |FINSI;

|SI sw = 0;
    #0dig_t = 0;
    |MENAV "    Longitud de cuenta fuera de Nivel !";
    |ERROR;
    |ACABA;
|FINSI;
|FPRC;

|PROCESO permi; |TIPO 0;
     nCam = Campo + 1;
     |SI #0Campo = "S";
          |CAMPO_MODIFICA #0nCam , 1 , "S";
     |SINO;
          |CAMPO_MODIFICA #0nCam , 1 , "N";
          #0nCam = " ";
          |PINTA #0nCam;
     |FINSI;
|FPRC;

|PROCESO DesFactura;
 |ABRE #13;
 #13#0  = #7#2;  || Libro
 #13#27 = #7#4;  || Serie
 #13#2  = #7#3;  || Factura
 |LEE 001#13=;
 |SI FSalida ! 0;
     desc = desc + alfa1; ||numero factura
     |CIERRA #13;
     |ACABA;
 |FINSI;
 |CIERRA #13;

 aDesc1 = #13#7; |QBF aDesc1;

 |ABRE #14;
 aDesc2 = "";
 #14#0 = #13#6;
 |LEE 001#14=;
 |SI FSalida = 0;
     aDesc2 = #14#1; |QBF aDesc2;
 |FINSI;
 aDesc1 = aDesc1 - aDesc2;
 desc = desc + aDesc1;
 |CIERRA #14;
|FPRC;
