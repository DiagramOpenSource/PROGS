|| ... Rutinas del Criterio de Caja
|FICHEROS;
   caivarep;
   caivasop;

   cacon300;

   caivaasi;

   camacc01 #501;
   camacc02 #502;
   camacc12 #512;
   camaccw1 #599;
|FIN;

|VARIABLES;
  nPregunta  = 0;
  aAlfa      = "";
  aAlfa1     = "";
  aAlfa2     = "";
  nDNum      = 0;
  nHNum      = 0;
  nExiste    = 0;
  &i_nom     = "";
  &i_cif     = "";
  &enEmpresa = 0;
|FIN;

|INCLUYE varnue_i;
|INCLUYE varcaj_i;

|PROCESO EsCaja;
       enSwCaja = 0;
       |ABRE #cacon300;
       #cacon300#0 = enConcepto;
       |LEE 041#cacon300.=;
       |SI FSalida = 0;
           |SI aTipoIVA = "S";
               |SI #cacon300#6 = "Z"; |O #cacon300#6 = "1"; |O #cacon300#6 = "2";
                   |O #cacon300#6 = "3"; |O #cacon300#6 = "4"; |O #cacon300#6 = "5";
                      |O #cacon300#6 = "6"; |O #cacon300#6 = "7"; |O #cacon300#6 = "8";
                   enSwCaja = 1;
               |FINSI;
           |FINSI;
           |SI aTipoIVA = "R";
               |SI #cacon300#5 = "Z"; |O #cacon300#5 = "1"; |O #cacon300#5 = "2";
                   |O #cacon300#5 = "3"; |O #cacon300#5 = "4"; |O #cacon300#5 = "5";
                      |O #cacon300#5 = "6"; |O #cacon300#5 = "7"; |O #cacon300#5 = "8";
                   enSwCaja = 1;
               |FINSI;
           |FINSI;
       |FINSI;
       |CIERRA #cacon300;
|FPRC;

|PROCESO EsCajaIva;
   enSwCaja = 0;
   |SI enEjercicio ] 2014;
       |SI enConcepto ! 0;
           |HAZ EsCaja;
       |SINO;
           |SI aTipoIVA = "S";
               enConcepto = #caivasop#6;  |HAZ EsCaja;
           |SINO;
               enConcepto = #caivarep#6;  |HAZ EsCaja;
           |FINSI;
       |FINSI;
   |FINSI;
|FPRC;
|| ///////////////////////////////////////////////////////////////////////

|PROCESO BorraMacc02;
   |BORRA 020#502a;
   |LIBERA #502;
|FPRC;

|DEFBUCLE BorraMacc02;
   #502#1;
   ;
   #501#13, #501#17, #501#0, #501#14, #501#15, 01;
   #501#13, #501#17, #501#0, #501#14, #501#15, 99;
   be;
   NULL, BorraMacc02;
|FIN;

|PROCESO BajaCaja;
   nPregunta = 0;
   |ABRE #501;
   #501#13 = aTipoIVA;
   #501#17 = eDevenCaja;
   #501#0  = enLibroCaja;
   #501#14 = eaSerieCaja;
   #501#15 = enRegisCaja;
   |LEE 141#501=;
   |SI FSalida = 0;
       |BUCLE BorraMacc02;
       |BORRA 020#501a;
   |FINSI;
   |LIBERA #501;
   |CIERRA #501;
|FPRC;

|PROCESO eTrataClaveZ;

   |SI eModoCaja = 3; |O enSwCaja = 0;
       |HAZ BajaCaja;
       |ACABA;
   |FINSI;

   |SI enSwCaja = 1;
       eaFicCaja = "vc" + Usuario;
       |NOME_DAT #599 eaFicCaja;
       |DELINDEX #599;

       |ABRE #599;
       #599#13 = aTipoIVA;
       #599#36 = eDevenCaja;
       #599#0  = enLibroCaja;
       #599#3  = eaSerieCaja;
       #599#2  = enRegisCaja;
       |LEE 041#599=;
       |SI FSalida ! 0;
           |DDEFECTO #599;
           #599#13 = aTipoIVA;
           #599#36 = eDevenCaja;
           #599#0  = enLibroCaja;
           #599#3  = eaSerieCaja;
           #599#2  = enRegisCaja;
           |GRABA 020#599c;
       |FINSI;

       |SI aTipoIVA = "S";
           #599#4  = #caivasop#3;
           #599#5  = #caivasop#4;
           #599#6  = #caivasop#6;
           #599#7  = #caivasop#7;

           #599#8  = #caivasop#8  + #caivasop#9  + #caivasop#10 + #caivasop#52 + #caivasop#53;
           #599#9  = #caivasop#14 + #caivasop#15 + #caivasop#16 + #caivasop#56 + #caivasop#57;
           #599#10 = #caivasop#26;
           #599#11 = #caivasop#50;
           #599#12 = #caivasop#51;
           #599#14 = #caivasop#6;

           #599#21 = #caivasop#45;
           #599#22 = #caivasop#46;
           #599#23 = #caivasop#47;

           #599#26 = #caivasop#8;
           #599#27 = #caivasop#14;

           #599#28 = #caivasop#9;
           #599#29 = #caivasop#15;

           #599#30 = #caivasop#10;
           #599#31 = #caivasop#16;

           #599#32 = #caivasop#52;
           #599#33 = #caivasop#56;

           #599#34 = #caivasop#53;
           #599#35 = #caivasop#57;
       |FINSI;

       |SI aTipoIVA = "R";
           #599#4  = #caivarep#3;
           #599#5  = #caivarep#4;
           #599#6  = #caivarep#6;
           #599#7  = #caivarep#7;

           #599#8  = #caivarep#8  + #caivarep#9  + #caivarep#10 + #caivarep#52 + #caivarep#53;
           #599#9  = #caivarep#14 + #caivarep#15 + #caivarep#16 + #caivarep#56 + #caivarep#57;
           #599#10 = #caivarep#26;
           #599#11 = #caivarep#50;
           #599#12 = #caivarep#51;
           #599#14 = #caivarep#6;

           #599#21 = #caivarep#45;
           #599#22 = #caivarep#46;
           #599#23 = #caivarep#47;

           #599#26 = #caivarep#8;
           #599#27 = #caivarep#14;

           #599#28 = #caivarep#9;
           #599#29 = #caivarep#15;

           #599#30 = #caivarep#10;
           #599#31 = #caivarep#16;

           #599#32 = #caivarep#52;
           #599#33 = #caivarep#56;

           #599#34 = #caivarep#53;
           #599#35 = #caivarep#57;
       |FINSI;

       #599#37   = -1;
       |SI #599#36 ! 0;  #599#37   = ePerioCaja;  |FINSI;
       |GRABA 020#599a;
       |CIERRA #599;
       |SUB_EJECUTA_NP "camaccw1";
   |FINSI;
|FPRC;

|PROCESO ePathCaja;
   |DFICE ePathCaja;
   |SI ePerioCaja ! -1;
       |DFICB aAlfa;
       aAlfa1 = ("00000" + enEmpresa)  % -105;
       aAlfa2 = ("0"     + ePerioCaja) % -101;
       ePathCaja = aAlfa + aAlfa1 + aAlfa2 + "/";
   |FINSI;
|FPRC;
