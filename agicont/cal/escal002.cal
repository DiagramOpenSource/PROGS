
||Procesos realizados por Olalla Hern ndez (Sevilla) 14-06-2000


|FICHEROS;

  escal002 #0;  ||Cabecera Cuentas Escalares
  escal003 #1;  ||Lineas Cuentas Escalares
  escalw14 #2;  ||Temporal Copia Planilla
  canempre #30;

|FIN;


|VARIABLES;

 dirfic = "";
 men = "";
 cta = "           ";
 long = "";
 mensa = "            ­­ LONGITUD DE CUENTA FUERA DE NIVEL !!";
 sw = 0;
 emp = "";
 emp1 = "";
 digi1 = 0;
 digi2 = 0;
 digi3 = 0;
 digi4 = 0;
 digi5 = 0;
 digi6 = 0;

|FIN;


||INCLUYE acceso_i;

||PROCESO alentrar; |TIPO 8;

  ||HAZ inicio;

||FPRC;


|PROCESO lineas;

   #1#0  = #2#1;
   #1#1  = #1#1;
   #1#2  = #1#2;
   #1#3  = #1#3;
   #1#4  = #1#4;
   #1#5  = #1#5;
   #1#6  = #1#6;
   #1#7  = #1#7;
   #1#8  = #1#8;
   #1#9  = #1#9;
   #1#10 = #1#10;
   #1#11 = #1#11;
   |GRABA 020#1n;

|FPRC;



|DEFBUCLE lineas;

  #1#1;
  ;
  #2#0, 001;
  #2#0, 999;
  be;
  NULL, lineas;

|FIN;


|PROCESO teclaf2; |TIPO 0;

  |SI FSalida = 10;

     |DELINDEX #2;
     |ABRE #2;
     |ABRE #0;
     |PUSHV 1020 1740;
     |PINPA #0#2;
     |ENDATOS #1#2;
     |POPV;

     #0#0 = #2#0;
     |LEE 010#0=;
     |SI FSalida ! 0; ||No existe el registro
       |MENAV "2400 No existe el Codigo de Origen indicado";
       |ACABA;
     |FINSI;

     #0#0 = #2#1;
     |LEE 010#0=;
     |SI FSalida = 0; ||Existe el registro
       |MENAV "2400 Ya existe el Codigo de Destino indicado";
       |ACABA;
     |FINSI;

     ||Copiamos la Planilla Origen en la Planilla Destino

     #0#0 = #2#0;
     |LEE 010#0=;
     |SI FSalida = 0;
         #0#0 = #2#1;
         #0#1 = #0#1;
         |GRABA 020#0n;

         ||Lineas

         |BUCLE lineas

     |FINSI;



     |CIERRA #2;
     |CIERRA #0;


  |FINSI;

|FPRC;



|PROCESO comprueba;

|| Proceso realizado para comprobar la longitud de la cuenta.
|| Dicho proceso es llamado desde el campo cuenta del fichero
|| de lineas de las Cuentas escalares

  |DFICE dirfic;

   emp = dirfic % -107;
   emp = emp - "/";

   emp1 = emp % 101;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;

   emp1 = "";
   emp1 = emp % 201;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;

   emp1 = "";
   emp1 = emp % 301;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;

   emp1 = "";
   emp1 = emp % 401;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;


   ||men = "2400 valor de emp es: " + emp;
   ||MENAV men;

   |ABRE #30;
   |SELECT #2#30;
   #30#0 = emp;
   |LEE 101#30=;

   |SI FSalida = 0;
     digi1 = #30#14;
     digi2 = #30#15;
     digi3 = #30#16;
     digi4 = #30#17;
     digi5 = #30#18;
     digi6 = #30#19;
   |FINSI;

   cta = #1#2;
   |QBF cta;
   long = cta % A0;
   sw = 0;

   |SI long = digi1; |O long = digi2; |O long = digi3; |O long = digi4; |O long = digi5; |O long = digi6;
     sw = 1;
   |FINSI;

   |SI sw = 0;
     |MENAV mensa;
     |PINTA #1#2;
     |ERROR;
     |ACABA;
   |FINSI;

   |CIERRA #30;
|FPRC;




|PROCESO modifica;

||Proceso llamado en el campo del fichero de linas C/O, que activa o desactiva
||los campos correspondientes seg£n sea una cuenta o una operacion


  |SI #1#9 = "C";

      |CAMPO_MODIFICA #1#8, 1, "N";
      |CAMPO_MODIFICA #1#2, 1, "S";
      |CAMPO_MODIFICA #1#5, 1, "S";

  |FINSI;

  |SI #1#9 = "O";

      |CAMPO_MODIFICA #1#2, 1, "N";
      |CAMPO_MODIFICA #1#5, 1, "N";
      |CAMPO_MODIFICA #1#8, 1, "S";

  |FINSI;

|FPRC;

|PROCESO acti;

||Proceso llamado en el campo del fichero de lineas Tiene Observaciones, que activa o desactiva
||el campo Observaciones dependiendo de su valor


  |SI #1#10 = "S";|O #1#10 = "s";

      |CAMPO_MODIFICA #1#6, 1, "S";

  |SINO;

      |CAMPO_MODIFICA #1#6, 1, "N";

  |FINSI;


|FPRC;
