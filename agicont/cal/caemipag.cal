|FICHEROS;
    caemipag #0;
    capagcab #1;
    capaglin #2;
    cacuenta #3;
    camanban #4;
    caclipro #5;
    capagaux #6;
    cacuadre #9;

    camanpag #15;
|FIN;

|VARIABLES;
    &entrada = 1;
    &sw = 0;
    &importe = 0;
    &prov = "";
    &prov1 = "";
    &cc1 = "";
    &cc2 = "";
    &cc3 = "";
    &des = " ";
    &dni = " ";
    &dir = " ";
    &pob = " ";
    &pro = " ";

    &pobla = "";
    &xdia  = "";
    &xmes  = "";
    &xmesmay  = "";
    &xany  = 0;
    &xdia_e = "";
    &xmes_e = "";
    &xmes_emay = "";
    &xany_e = 0;

    mes    = 0;
    aAlfa1 = "";
    aAlfa2 = "";

    seleccio = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    pepe = 0;
    sw_act = 0;
    informe = "caemipag";
    ant_pro = "-1";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    para1 = 0;
    &totbar = "";
    &letra1 = "";
    &letra2 = "";
    impletra = "";
    Long = "";
    LongNum = 0;
    lleno = 0;
    traba = "";
    traba1 = "";
    nume = 0;
    cincue = "--------------------------------------------------------------";
    nArriba = 46;
    nAbajo = 53;
    aArriba = "146";
    aAbajo = "153";
    &enCanti = 0;
    &eaCanti = "";
|FIN;

|INCLUYE acceso_i;

|PROCESO cuadre; |TIPO 8;
  |HAZ inicio;

|| ...  |CAMPO_MODIFICA #0#12, 1, "S";
  sw_act = 0; ||  0 = N control (Carta/Pagare) junto / 1 = S por separado
  |ABRE #9;
  #9#0 = 1;
  |LEE 000#9=;
  |SI FSalida = 0;
      |SI #9#17 = "S";
          sw_act = 1;
      |FINSI;
  |FINSI;
  |CIERRA #9;

  alfa1 = #9#78; |QBF alfa1;
  |SI alfa1 = ""; #9#78 = "caemipag"; |FINSI;
|FPRC;

|PROCESO mayor;
   alfa1 = #0Campo > " ";
   #0Campo = alfa1;
   |PINTA #0Campo;

   |SI Campo = 18;
       |SI #0Campo = "N";
           |C_M #0#12,1,"N";
       |SINO;
           |C_M #0#12,1,"S";
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO cuentas;
    des = "<CUENTA SIN DEFINIR>";
    dni = " ";
    dir = " ";
    pob = " ";
    pro = " ";

    #5#23 = "P";
    #5#10 = #1#1;
    #5#11 = #1#2;
|LEE 000#5=;        || lee el proveedor
|SI FSalida = 0;
        des = #5#1;
        dni = #5#9;
        dir = #5#2;
        pob = #5#6;
    |QBF pob;
        alfa1 = #5#3;  alfa1 = "00"  + alfa1;  alfa1 = alfa1 % -102;
        alfa2 = #5#4;  alfa2 = "000" + alfa2;  alfa2 = alfa2 % -103;
        pob = "(" + alfa1 + alfa2 + ") " + pob;
        pro = #5#5;
|SINO;
        #3#0 = #1#1;   || si no esta lee la cuenta del proveedor
        #3#1 = #1#2;
    |LEE 000#3=;
    |SI FSalida = 0;  des = #3#2;  |FINSI;
|FINSI;

|DDEFECTO #4;
    #4#10 = #1#3;   || lee el banco
    #4#11 = #1#4;
|LEE 000#4=;
    cc1 = #4#9 % 104;
    cc2 = #4#9 % 504;
    cc3 = #4#9;
|QBF cc3;
    cc3 = cc3 % -102;
|FPRC;

|PROCESO impresion;
    seleccio = 1;
    |HAZ cuentas;
    importe = importe + #2#7;
    sw = 0;
   |PRINT;
|FPRC;

|PROCESO emitidos;
     #15#0 = #2#2;  || libro
     #15#1 = #2#3;  || orden
     #15#2 = #2#9;  || serie.pago
     #15#3 = #2#4;  || nro.pago
     |LEE 141#15=;
     |SI FSalida = 0;
         #15#13 = "S";
         |GRABA 020#15a;
     |FINSI;
     |LIBERA #15;
|FPRC;

|PROCESO pagares;

 |SI #0#13 ! #1#10;      |ACABA;  |FINSI;  || impresa

 |SI #0#10 ! "A";
     |SI #0#10 ! #1#07;  |ACABA;  |FINSI;  || emision
 |FINSI;

 |SI #0#11 ! "A";
     |SI #0#11 ! #1#08;  |ACABA;  |FINSI;  || vencimiento
 |FINSI;

 |SI #0#14 = "S";
     |SI ant_pro = "-1";
         ant_pro = #1#1;
     |FINSI;
     |SI ant_pro ! #1#1;
         |PIEINF;
         #0#12 = #0#12 + 1;    || va sumando uno
         ant_pro = #1#1;
     |FINSI;
 |FINSI;

 |SI #0#18 = "S";  #1#11 = #0#12; |FINSI;

 aAlfa1 = #1#6;
 aAlfa2 = aAlfa1 % 102;  xdia = aAlfa2;
 aAlfa2 = aAlfa1 % -104; xany = aAlfa2;
 aAlfa2 = aAlfa1 % 402;  mes  = aAlfa2;

 |SI mes =  1; xmes = "Enero";      |FINSI;
 |SI mes =  2; xmes = "Febrero";    |FINSI;
 |SI mes =  3; xmes = "Marzo";      |FINSI;
 |SI mes =  4; xmes = "Abril";      |FINSI;
 |SI mes =  5; xmes = "Mayo";       |FINSI;
 |SI mes =  6; xmes = "Junio";      |FINSI;
 |SI mes =  7; xmes = "Julio";      |FINSI;
 |SI mes =  8; xmes = "Agosto";     |FINSI;
 |SI mes =  9; xmes = "Septiembre"; |FINSI;
 |SI mes = 10; xmes = "Octubre";    |FINSI;
 |SI mes = 11; xmes = "Noviembre";  |FINSI;
 |SI mes = 12; xmes = "Diciembre";  |FINSI;
 xmesmay = xmes > " ";

 aAlfa1 = #1#5;
 aAlfa2 = aAlfa1 % 102;  xdia_e = aAlfa2;
 aAlfa2 = aAlfa1 % -104; xany_e = aAlfa2;
 aAlfa2 = aAlfa1 % 402;  mes    = aAlfa2;

 |SI mes =  1; xmes_e = "Enero";      |FINSI;
 |SI mes =  2; xmes_e = "Febrero";    |FINSI;
 |SI mes =  3; xmes_e = "Marzo";      |FINSI;
 |SI mes =  4; xmes_e = "Abril";      |FINSI;
 |SI mes =  5; xmes_e = "Mayo";       |FINSI;
 |SI mes =  6; xmes_e = "Junio";      |FINSI;
 |SI mes =  7; xmes_e = "Julio";      |FINSI;
 |SI mes =  8; xmes_e = "Agosto";     |FINSI;
 |SI mes =  9; xmes_e = "Septiembre"; |FINSI;
 |SI mes = 10; xmes_e = "Octubre";    |FINSI;
 |SI mes = 11; xmes_e = "Noviembre";  |FINSI;
 |SI mes = 12; xmes_e = "Diciembre";  |FINSI;

 xmes_emay = xmes_e > " ";

 importe = 0;
 seleccio = 0;
 enCanti = #1#9;
 |HAZ ConBarras;
 totbar = eaCanti;

 |HAZ pasaaletra;              ||rutina especial para Hormigones del Vinalopo
 |BUCLELIN 2impresion#1;
 |SI seleccio ! 0;
     sw = 1;
     |PRINT;
     |SI #0#14 = "N";
         |PIEINF;
          #0#12 = #0#12 + 1;      || va sumando uno
     |FINSI;

     || ... Actualiza Pagare
     #1#10 = "S";
     |SI sw_act = 0;
         #1#12 = "S";
         |ABRE #15;
         |BUCLELIN 2emitidos#1;
         |CIERRA #15;
     |FINSI;
     |GRABA 020#1a;
      pepe = 1;
 |FINSI;
 |LIBERA #1;
|FPRC;

|DEFBUCLE por_proveedor;
 #1#1;
 5, 6, 1, 3, 14;
 #0#0, #0#2, #0#4, #0#6, #0#8,#0#15;||Pagare,F.emi,F.vto,Prove,Banco,T.pagare
 #0#1, #0#3, #0#5, #0#7, #0#9,#0#16;
 be;
 NULL, NULL, NULL, NULL, NULL, pagares;
 #1#1, #1#2, #1#0;
|FIN;

|DEFBUCLE por_pagare;
 #1#1;
 5, 6, 1, 3, 14;
 #0#0, #0#2, #0#4, #0#6, #0#8, #0#15; || Pagare,F.emi,F.vto,Prove,Banco
 #0#1, #0#3, #0#5, #0#7, #0#9, #0#16;
 be;
 NULL, pagares;
|FIN;

|PROCESO impre;|TIPO 3;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |ABRE #6;  |DDEFECTO #6;  |LEE 000#6p;   |CIERRA #6;  || datos auxiliares

  informe = #9#78;
  |INFOR informe;
  |SI FSalida ! 0;
      |PUSHV 2301 2380;
      |MENSA "2300­ATENCION! NO EXISTE FORMATO PAGARE ELEGIDO ";
      |CONFI "2400S¨Desea continuar el proceso utilizando el Formato Standard? ";
      |POPV;
      |SI FSalida = 0;
          informe = "caemipag";
          |INFOR informe;
          |SI FSalida ! 0; |FINIMP; |ACABA;|FINSI;
      |SINO;
            |FINIMP;
            |ACABA;
      |FINSI;
  |FINSI;

  pobla = #48#7;   |QBF pobla;
  pobla = (" " * 30) + pobla;     pobla = pobla % -130;

  |ABRE #3;
  |ABRE #4;
  |SELECT #2#4;
  |ABRE #5;
  |SI #0#14 = "N";  |BUCLE por_pagare;    |FINSI;
  |SI #0#14 = "S";  |BUCLE por_proveedor; |FINSI;
  |SI pepe = 0;
      |MENAV "    Seleccion vacia ...";
  |SINO;
      |SI seleccio ! 0;|Y #0#14 = "S";
          |PIEINF;
      |FINSI;
  |FINSI;
  |CIERRA #3;
  |CIERRA #4;
  |CIERRA #5;

  |FININF;
  |FINIMP;
|FPRC;

|PROCESO pasaaletra;
  impletra = #1#9;
  |LETRA impletra;
  Long = impletra % 0;
  LongNum = Long;
  |SI LongNum [ nArriba;
      letra1 = impletra + cincue;
      letra1 = letra1 % aArriba;
      letra2 = cincue;
      letra2 = letra2 % aAbajo;
      |ACABA;
  |FINSI;
  |QBF impletra;
  impletra = impletra + " ";
  LongNum = LongNum + 1;
  lleno = 0;
  letra1 = "";
  letra2 = "";
  traba = "";
  |PARA nume = 1;  |SI nume [ LongNum;  |HACIENDO nume = nume + 1;
        nume1 = (nume * 100) + 1;
        Long = nume1;
        traba1 = impletra % Long;
        |SI lleno = 0;
            |SI traba1 ! " ";
                traba = traba + traba1;
            |SINO;
                |SI nume [ nArriba;
                    letra1 = letra1 + traba + " ";
                    traba = "";
                |SINO;
                    letra2 = traba + " ";
                    lleno = 1;
                    traba = "";
                |FINSI;
            |FINSI;
        |SINO;
            letra2 = letra2 + traba1;
        |FINSI;
  |SIGUE;
  letra1 = letra1 + cincue;
  letra1 = letra1 % aArriba;
  letra2 = letra2 + cincue;
  ||letra2 = letra2 % aAbajo;
|FPRC;
