|FICHEROS;
 caredm08 #0;
 camingca #2;  || Confirming Cabeceras
 camingli #3;  || Confirming Lineas
 caclipro #4;  || Clientes/Proveedores
 camanpag #5;  || Pagos
 caivasop #6;  || Iva
 caconcep #7;  || Concepto
 camanban #8;  || Bancos..............

 caacrval #9;
 calisfra #10;
 caredm01 #11;

 camoneda #50;
|FIN;

|VARIABLES;
 Cantidad = 0;
 MonBase = 0;
 Moneda = "";
 nCalc = 0;

 alfa1 = "";
 alfa2 = "";
 alfa3 = "";
 alfa4 = "";
 nume1 = 0;
 nume2 = 0;
 nume3 = 0;
 nume4 = 0;

 mens     = "";
 swErrorR = 0;
 swErrorP = 0;
 menR1    = "    No Existe Confirme !!!";
 menR2    = "    Confirme YA contabilizado ";
 menR3    = "2400SConfirme YA Emitido en Papel. Aceptar S/N ";
 menR4    = "2400NConfirme YA lanzado en Diskette. Aceptar S/N ";

 Nombre  = "";
 CodCli  = "";
 sino     = "";
 ceros    = "000000000000000";
 fechapre = "      ";
 dd       = "";
 mm       = "";
 aa       = "";
 cabe1    = "1";  || Registro Cabecera
 cabe2    = "2";  || Registro Detalle Pagos
 cabe3    = "3";  || Registro Total

 libre    = " ";
 libre40  = "";

 VAlfa   = "";
 VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = "";
 VAlfa06 = ""; VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = "";
 VAlfa11 = ""; VAlfa12 = ""; VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";
 VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = ""; VAlfa19 = ""; VAlfa20 = "";
 Dato  = 0;
 CtaAnt = "";

 Regs  = 0;
 Benef = 0;
 TotImporte = 0;
 FechaHoy = @;
 NifProv   = "";
 DirecProv = "";
 PoblaProv = "";
 Cp1Prov   = "";
 Cp2Prov   = "";

 handle     = "";
 fiche      = "";
 dirempr    = "";
 varalfa1   = "";
 varalfa2   = "";
 contenido  = "";
 swERROR    = 0;
 CampoDni   = "";
 Letra1     = "";
 Letra2     = "";
 Letra3     = "";
 Letra4     = "";
 Letra5     = "";
 Letra6     = "";
 Letra7     = "";
 Letra8     = "";
 Caracter   = "";
 Carac1     = 0;
 Carac2     = 0;
 Carac3     = 0;
 Carac4     = 0;
 Carac5     = 0;
 XPara      = 0;

 ccc        = "";
 c_alfa1    = "";
 c_alfa2    = "";
 c_nume1    = 0;
 c_nume2    = 0;
 c_nume3    = 0;

 direcc = "";
 numero = 0;
 longi  = 0;
 concepto = "";
 Comodin = "";
 varios  = 0;

 &Dia  = 0;
 &Mes  = 0;
 &Year = 0;
 &MesAlfa = "";

 &programa = "";
 &ficcopia = "";
 aAlfa1 = "";

    &eaVarDni  = "";
    &enCalcCif = 0;

|FIN;

|INCLUYE acceso_i;

|| *************************************************************************

|PROCESO mayus1;
 alfa1 = #0Campo > " ";
 #0Campo = alfa1;
 |PINTA #0Campo;
|FPRC;

|PROCESO ver_confirming; |TIPO 6;
 |SI FSalida = 2; |ACABA; |FINSI;
 |ABRE #2;
 |HAZ leerem;
 |CIERRA #2;
 |SI swErrorR ! 0;
     |SI swErrorR < 3;
         |MENAV mens;
         |ERROR;
         |ACABA;
     |SINO;
         |CONFI mens;
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
 |FINSI;
 #0#2 = #2#3; || Banco
 #0#5 = #2#6; |PINTA #0#5;
  ||#0#3 = #2#1; |PINTA #0#3;

 |PINTA 1035, #2#2;   || Vto.
 |PINTA 1058, #2#8;   || N§ Efectos
 |PINTA 1135, #2#3;   || Banco
 |PINTA 1149, #2#9;   || Importe Total
|FPRC;

|PROCESO leerem;
 swErrorR = 0;
 |DDEFECTO #2;
 #2#0 = #0#1;
 |LEE 001#2=;
 |SI FSalida ! 0;
     swErrorR = 1; mens = menR1;
 |SINO;
     |SI #2#9 = "S";
         swErrorR = 2; mens = menR2;
     |SINO;
         |SI #2#10 = "S"; swErrorR = 3; mens = menR3; |FINSI;
         |SI #2#10 = "D"; swErrorR = 4; mens = menR4; |FINSI;
     |FINSI;
     |ABRE #8;
     #8#0 = #2#3;
     |LEE 000#8=;
     |CIERRA #8;
 |FINSI;
|FPRC;

||...................................................................................
||***********************************************************
||************ REGISTROS DE CABECERA ************************
||***********************************************************
|PROCESO cabecera;

  VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = "";
  VAlfa06 = ""; VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = "";
  VAlfa11 = ""; VAlfa12 = ""; VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";
  VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = ""; VAlfa19 = ""; VAlfa20 = "";

  VAlfa01 = "01";
  |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
  |QBF VAlfa03;
  VAlfa03 = #caredm01#2 % 110;        || NIF
  VAlfa03 = ("          " + VAlfa03) % -110;
  VAlfa04 = "            ";     || Datos tipo D
  VAlfa05 = "001";              || Numero de dato
  VAlfa06 = #caredm08#3 % 102;  || Fecha emision soporte
  VAlfa06 = VAlfa06 + (#caredm08#3 % 0402);
  VAlfa06 = VAlfa06 + (#caredm08#3 % -102);
  VAlfa07 = "      ";           || Libre
  VAlfa08 = "2100";             || Codigo entidad destino
  VAlfa09 = "6202";             || Codigo sucursal
  |QBF VAlfa09;
  VAlfa09 = ("0000" + VAlfa09) % -104;
  VAlfa10 = "0100126210";         || Numero de cuenta
  |QBF VAlfa10;
  VAlfa10 = ("0000000000" + VAlfa10) % -110;
  VAlfa11 = "1";                || Detalle del cargo
  VAlfa12 = "   ";              || Libre
  VAlfa13 = ("00" + (#8#9 % 802)) % -102;         || Digitos de control C.C.C.
  VAlfa14 = "       ";          || Libre
  VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
  VAlfa = VAlfa  + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12 + VAlfa13 + VAlfa14;
  VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
  VAlfa = handle + " " + VAlfa;
  |FGRABA VAlfa;
  Regs = Regs + 1;

  VAlfa01 = "01";
  |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
  |QBF VAlfa03;
  VAlfa03 = #caredm01#2 % 110;        || NIF
  VAlfa03 = ("          " + VAlfa03) % -110;
  VAlfa04 = "            ";     || Datos tipo D
  VAlfa05 = "002";              || Numero de dato
  VAlfa06 = #30#4 % 0136;       || Razon social del emisor
  VAlfa07 = "       ";
  VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
  VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
  VAlfa = handle + " " + VAlfa;
  |FGRABA VAlfa;
  Regs = Regs + 1;

  VAlfa01 = "01";
  |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
  |QBF VAlfa03;
  VAlfa03 = #caredm01#2 % 110;        || NIF
  VAlfa03 = ("          " + VAlfa03) % -110;
  VAlfa04 = "            ";     || Datos tipo D
  VAlfa05 = "003";              || Numero de dato
  VAlfa06 = #30#5 % 0136;       || Domicilio del emisor
  VAlfa07 = "       ";
  VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
  VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
  VAlfa = handle + " " + VAlfa;
  |FGRABA VAlfa;
  Regs = Regs + 1;

  VAlfa01 = "01";
  |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
  |QBF VAlfa03;
  VAlfa03 = #caredm01#2 % 110;        || NIF
  VAlfa03 = ("          " + VAlfa03) % -110;
  VAlfa04 = "            ";     || Datos tipo D
  VAlfa05 = "004";              || Numero de dato
  VAlfa06 = #30#7 % 0136;       || Localidad del emisor
  VAlfa07 = "       ";
  VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
  VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
  VAlfa = handle + " " + VAlfa;
  |FGRABA VAlfa;
  Regs = Regs + 1;
|FPRC;

||***********************************************************
||**************** REGISTROS DE BENEFICIARIO ****************
||***********************************************************

|PROCESO Beneficiario;

   #caclipro#23 = "P";
   #caclipro#10 = #camingli#9;
   #caclipro#11 = #camingli#10;
   |LEE 010#caclipro.=;

   |HAZ MiraVarios;

   #caivasop#0  = #camingli#2;
   #caivasop#27 = #camingli#4;
   #caivasop#2  = #camingli#3;
   |LEE 010#caivasop.=;

   #camanpag#0  = #camingli#2;
   #camanpag#27 = #camingli#4;
   #camanpag#2  = #camingli#3;
   #camanpag#3  = #camingli#5;
   |LEE 010#camanpag.=;

   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = "";
   VAlfa06 = ""; VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = "";
   VAlfa11 = ""; VAlfa12 = ""; VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";
   VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = ""; VAlfa19 = ""; VAlfa20 = "";

   |SI varios = 0;
      NifProv   = #caclipro#9;
      DirecProv = #caclipro#2;
      PoblaProv = #caclipro#6;
      Cp1Prov   = #caclipro#3;
      Cp2Prov   = #caclipro#4;
   |SINO;
      NifProv   = #caacrval#4;
      DirecProv = #caacrval#5;
      PoblaProv = #caacrval#6;
      Cp1Prov   = #caacrval#8;
      Cp2Prov   = #caacrval#9;
   |FINSI;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "010";              || Numero de dato
   Cantidad = #camingli#8; |HAZ Conversion;
   VAlfa06 = Cantidad; TotImporte = TotImporte + Cantidad;
   |QBF VAlfa06;
   VAlfa06 = ("000000000000" + VAlfa06) % -112; || Importe Documento
   VAlfa07 = #caclipro#18 % 0104; || Entidad cuenta de pago
   VAlfa08 = #caclipro#18 % 0504; || Sucursal cuenta de pago
   VAlfa09 = #caclipro#17 % 0110; || N§ de cuenta de pago
   VAlfa10 = "1";                || Gastos
   VAlfa11 = "9  ";              || Concepto de la orden
   VAlfa12 = #caclipro#18 % 0902;|| DC cuenta de pago
   VAlfa13 = "       ";      || Libre
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa  + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "011";              || Numero de dato
   VAlfa06 = #camingli#13 % 0136;|| Razon social del beneficiario
   VAlfa07 = "       ";          || Libre;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "012";              || Numero de dato
   VAlfa06 = DirecProv % 0136; || Domicilio del beneficiario
   VAlfa07 = "       ";          || Libre;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "013";              || Numero de dato
   VAlfa06 = DirecProv % 3736;   || Continuacion domicilio del beneficiario
   VAlfa07 = "       ";          || Libre;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "014";              || Numero de dato
   VAlfa06 = ("00" + Cp1Prov) % -102;   || Codigo Postal 1
   VAlfa07 = ("000" + Cp2Prov) % -103;  || Codigo Postal 2
   VAlfa06 = VAlfa06 + VAlfa07;
   VAlfa07 = PoblaProv;        || Poblacion del beneficiario
   VAlfa07 = VAlfa07 % 0136;
   VAlfa08 = "       ";          || Libre;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
   VAlfa = VAlfa + VAlfa07 + VAlfa08;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "015";              || Numero de dato
   VAlfa06 = NifProv % 115;  || NIF del proveedor
   VAlfa06 = ("               " + VAlfa04) % -115;
   VAlfa07 = " " * 21;           || Libre;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   VAlfa01 = "06";
   |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
   VAlfa03 = #caredm01#2 % 110;        || NIF
   VAlfa03 = ("          " + VAlfa03) % -110;
   VAlfa04 = NifProv % 112;  || NIF del proveedor
   VAlfa04 = ("            " + VAlfa04) % -112;
   VAlfa05 = "016";              || Numero de dato
   VAlfa06 = #camingli#12;       || Forma de pago
   VAlfa07 = #caivasop#3 % 0102; || Fecha de factura
   VAlfa07 = VAlfa07 + (#caivasop#3 % 0402);
   VAlfa07 = VAlfa07 + (#caivasop#3 % -102);
   |ABRE #caconcep;
   #caconcep#0 = #caivasop#6;
   |LEE 010#caconcep.=;
   |CIERRA #caconcep;
   VAlfa08 = #caivasop#7;
   |QBF VAlfa08;
   VAlfa09 = #caconcep#1; |QBF VAlfa09;
   VAlfa08 = VAlfa08 - VAlfa09;
   VAlfa08 = ("               " + VAlfa08) % -115;  || N§ factura del proveedor
   VAlfa09 = #camingli#7 % 0102; || Fecha de vencimiento
   VAlfa09 = VAlfa09 + (#camingli#7 % 0402);
   VAlfa09 = VAlfa09 + (#camingli#7 % -102);
   VAlfa10 = "  ";               || Partida estadistica ???????????????????
   VAlfa11 = "             ";    || N§ orden de pago ??????????????????????
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
   VAlfa = VAlfa   + VAlfa07 + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11;
   VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
   VAlfa = handle + " " + VAlfa;
   |FGRABA VAlfa;
   Regs = Regs + 1;

   Benef = Benef + 1;

|FPRC;

||***********************************************************
||********** REGISTRO TOTAL ORDENANTE Y GENERAL *************
||***********************************************************
|PROCESO Totales;
  VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = "";
  VAlfa06 = ""; VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = "";
  VAlfa11 = ""; VAlfa12 = ""; VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";
  VAlfa16 = ""; VAlfa17 = ""; VAlfa18 = ""; VAlfa19 = ""; VAlfa20 = "";

  VAlfa01 = "08";
  |SI Moneda = "P"; VAlfa02 = "06"; |SINO; VAlfa02 = "56"; |FINSI;
  VAlfa03 = #caredm01#2 % 110;        || NIF
  VAlfa03 = ("          " + VAlfa03) % -110;
  VAlfa04 = "            ";     || Libre
  VAlfa05 = "   ";              || Numero de dato
  VAlfa06 = "000000000000" + #caredm08#12;  |QBF VAlfa06;
  VAlfa06 = VAlfa06 % -112;     || Importe Total del soporte;
  VAlfa07 = "00000000" + #caredm08#10;
  |QBF VAlfa07;
  VAlfa07 = VAlfa07 % -108;     || N§ total de beneficiarios
  VAlfa08 = "0000000000" + #caredm08#11;
  |QBF VAlfa08;
  VAlfa08 = VAlfa08 % -110;     || Total lineas de registros
  VAlfa09 = "             ";    || Libre

  VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
  VAlfa = VAlfa   + VAlfa07 + VAlfa08 + VAlfa09;
  VAlfa = VAlfa + &#caredm08#7 + &#caredm08#8;
  VAlfa = handle + " " + VAlfa;
  |FGRABA VAlfa;
|FPRC;

|| **************************************************************************

|PROCESO LinConfirme;
   |HAZ Beneficiario;
   #camingca#0 = #camingli#0;
   |LEE 010#camingca.=;
   |SI FSalida = 0;
      FechaHoy = ~;
      #camingca#1 = FechaHoy;
      |GRABA 020#camingca.a;
   |FINSI;
|FPRC;

|DEFBUCLE LinConfirme;
#camingli#1;
;
#caredm08#1,001;
#caredm08#1,999;
;
NULL,LinConfirme;
|FIN;

|PROCESO pasecuencial;

  |ABRE #2;
  |HAZ leerem;
  |SI swErrorR = 1; |O swErrorR = 2;
      |MENAV "    ERROR !!! CONFIRME NO CORRECTO ";
      |ACABA;
  |FINSI;

  |HAZ varia_fich;

  |CAMPO_VISUAL #0#10,1,"S"; #0#10 = 0;
  |CAMPO_VISUAL #0#11,1,"S"; #0#11 = 0;
  |CAMPO_VISUAL #0#12,1,"S"; #0#12 = 0;

|| ...................................................
  |ABRE #4;                || Abre Clientes / Proveedores
  |ABRE #5;                || Cobros
  |ABRE #6;                || IVA soportado
  |ABRE #7;                || Conceptos
  |ABRE #camingca;

  Comodin = #caredm08#3 % 0102;
  Dia = Comodin;
  Comodin = #caredm08#3 % 0402;
  Mes = Comodin;
  Comodin = #caredm08#3 % 0704;
  Year = Comodin;
  |HAZ Mes;

|| Abrir Fichero Secuencial

  |DFICE dirempr;
  fiche = "wb  " + dirempr + "casecmin.seq";  || "nomfiche.ext";
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;

     Regs = 0;
     Benef = 0;
     |HAZ cabecera;
     Dato = 19;
     TotImporte = 0;
     |BUCLE LinConfirme;
     Regs = Regs + 1;   || Tambien cuento el registro de totales
     #caredm08#10 = Benef;
     #caredm08#11 = Regs;
     #caredm08#12 = TotImporte;
     |HAZ Totales;

  |FINSI;
  contenido = handle + " " + &#0#9;
  |FGRABA contenido;

  FSalida = handle;
  |FCIERRA FSalida;

  Pos = -1;

  |CIERRA #camingca;
  |CIERRA #2;
  |CIERRA #4;
  |CIERRA #5;
  |CIERRA #6;
  |CIERRA #7;

|| ...   |SI swERROR = 1; |ACABA; |FINSI;

  |D_CUADRO 1261, 2280;
  |ATRI R;
  |PINTA 1362, " Numero Recibos   ";
  |PINTA 1562, " Numero Registros ";
  |PINTA 1762, " Importe Total    ";
  |ATRI 0;
  |PINTA 1462, "                  ";
  |PINTA 1662, "                  ";
  |PINTA 1862, "                  ";
  |PINTA #0#10;
  |PINTA #0#11;
  nCalc = EURODB;
  |SI Moneda = "E";
     EURODB = 2;
     #0#12 = #0#12 / 100;
  |SINO;
     EURODB = 0;
  |FINSI;
  |PINTA #0#12;
  EURODB = nCalc;
  |D_CUADRO 1961, 2280;
  |ATRI R;
  |PINTA 2062, " Desea grabar el  ";
  |PINTA 2162, " diskete ahora    ";
  |ATRI 0;

  programa = " CONFIRMES ";
  ficcopia = "CFREMESA.TXT";
  E_sup = 1;
  E_inf = "SNsn";
  sino  = "N";
  sino  = 2177 ? 1;
  |SI sino = "S"; |O sino = "s"; |CORRE "cared003.tab"; |FINSI;
|FPRC;

|| ********** Rutinas Varias

|PROCESO LetraDni;
     eaVarDni   = CampoDni;
     enCalcCif  = 3;
     |HAZ CalculoDNI;
     CampoDni = eaVarDni;
     CampoDni = ("000000000" + CampoDni) % -109;
|FPRC;

|PROCESO Mes;
   |SI Mes = 1;  MesAlfa = "Enero     "; |FINSI;
   |SI Mes = 2;  MesAlfa = "Febrero   "; |FINSI;
   |SI Mes = 3;  MesAlfa = "Marzo     "; |FINSI;
   |SI Mes = 4;  MesAlfa = "Abril     "; |FINSI;
   |SI Mes = 5;  MesAlfa = "Mayo      "; |FINSI;
   |SI Mes = 6;  MesAlfa = "Junio     "; |FINSI;
   |SI Mes = 7;  MesAlfa = "Julio     "; |FINSI;
   |SI Mes = 8;  MesAlfa = "Agosto    "; |FINSI;
   |SI Mes = 9;  MesAlfa = "Septiembre"; |FINSI;
   |SI Mes = 10; MesAlfa = "Octubre   "; |FINSI;
   |SI Mes = 11; MesAlfa = "Noviembre "; |FINSI;
   |SI Mes = 12; MesAlfa = "Diciembre "; |FINSI;
   |QBF MesAlfa;
|FPRC;

|PROCESO varia_fich;
|| .......... Variables del Presentador, del Ordenante y comunes

  CodCli = #0#5; |QBF CodCli;
  CodCli = CodCli + "  "; CodCli = CodCli % 102;

  libre40 = libre * 40;
  Nombre = #30#4 + libre40;     Nombre = Nombre % 140;

  alfa1 = #0#3;
  dd = alfa1 % A102;
  mm = alfa1 % A402;
  aa = alfa1 % A902;
  fechapre = aa + mm + dd;   || Fecha Formato a¤o + mes + dia

|FPRC;

|PROCESO MiraVarios;
     |DDEFECTO #caacrval;
     |ABRE #calisfra;
     #calisfra#0  = #camingli#2;   || libro
     #calisfra#1  = #camingli#4;   || serie
     #calisfra#2  = #camingli#3;   || orden
     |LEE 000#calisfra.=;
     |SI FSalida = 0;
          |ABRE #caacrval;
          #caacrval#0 = #calisfra#3;    || cuenta
          #caacrval#1 = #calisfra#4;    || digito
          #caacrval#2 = #calisfra#5;    || linea
          |LEE 000#caacrval.=;
          |SI FSalida ! 0;
               aAlfa1 = "0000Direccion [" + #caacrval#0 + "." + #caacrval#2 + "] Factura [" + #camingli#2 + "." + #camingli#4 + "." + #camingli#3 + "] inaccesible.";
               |MENAV aAlfa1;
          |FINSI;
          |CIERRA #caacrval;
          varios = 1;
     |SINO;
          |SI #camingli#16 ! 0;
               |ABRE #caacrval;
               #caacrval#0 = #camingli#9;    || cuenta
               #caacrval#1 = #camingli#10;   || digito
               #caacrval#2 = #camingli#16;   || linea
               |LEE 000#caacrval.=;
               |SI FSalida ! 0;
                    aAlfa1 = "0000Direccion [" + #caacrval#0 + "." + #caacrval#2 + "] Factura [" + #camingli#2 + "." + #camingli#4 + "." + #camingli#3 + "] inaccesible.";
                    |MENAV aAlfa1;
               |FINSI;
               |CIERRA #caacrval;
               varios = 1;
          |SINO;
               varios = 0;
          |FINSI;
     |FINSI;
     |CIERRA #calisfra;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Orden Pago La Caixa";
   |ABRE #caredm08;
   |LEE 010#caredm08.p;
   |SI FSalida ! 0;
      |DDEFECTO #caredm08;
      |GRABA 020#caredm08.n;
      |LEE 020#caredm08.=;
   |FINSI;
   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
       |ABRE #camoneda;
       #camoneda#0 = #48#2;
       #camoneda#1 = #48#3;
       |LEE 000#camoneda.=;
       |SI FSalida = 0;
          Moneda = #camoneda#2;
          |SI #camoneda#2 = "P";
             MonBase = 1;
          |SINO;
             MonBase = 2;
          |FINSI;
       |SINO;
          Moneda = "P";
          MonBase = 1;
       |FINSI;
       |CIERRA #camoneda;

       ||HAZ PideMoneda;
       MonBase = 2;

       |SI MonBase = 2;                  || euros
          EURO = 166.386;
          EURODB = 2;
          EURODV = 0;
       |SINO;
          EURO = 1 / 166.386;
          EURODB = 0;
          EURODV = 2;
       |FINSI;

      |GRABA 020#caredm08.a;
      |ABRE #caredm01;
      #caredm01#0 = #caredm08#17;
      |LEE 000#caredm01.=;
      |HAZ pasecuencial;
      |CIERRA #caredm01;
   |FINSI;
   |CIERRA #caredm08;
|FPRO;

|PROCESO PideMoneda;
   |PUSHV 1943 2177;
   |BLANCO 1943 2177;
   |CUADRO 1945 2175;
   |ATRI R; |PINTA 1946 , " Seleccione moneda de emision "; |ATRI N;
   |PINTA 2053, "(Pesetas/Euros)";
   |ATRI I; |PINTA 2054, "P"; |PINTA 2062, "E"; |ATRI N;
   E_sup  = 1;
   E_inf  = "EP";
   |SI MonBase = 1; Moneda = "P"; |SINO; Moneda = "E"; |FINSI;
   Moneda = 2069 ? 0;
   |POPV;
|FPRC;

|PROCESO Conversion;
   |SI MonBase = 1;
      |SI Moneda = "E";
         Cantidad = ((Cantidad / 166.386) ! 2) * 100;
      |FINSI;
   |SINO;
      |SI Moneda = "P";
         Cantidad = (Cantidad * 166.386) ! 0;
      |SINO;
         Cantidad = Cantidad * 100;
      |FINSI;
   |FINSI;
|FPRC;
