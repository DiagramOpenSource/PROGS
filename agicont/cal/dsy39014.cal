|FICHEROS;
     caem3390 #0;
     caportad #2;
     cama3390 #7;
     cama4390 #8;
     cama5390 #9;
     canempre;

     dsmom108 #108;
     dsmom999 #199;

     caxxx547 #547;
     caxxx548 #548;
     caxxx549 #549;
     caxxx550 #550;
|FIN;

|VARIABLES;
     nTecla       = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;
     nBoton6      = 0;
     nDCliente    = 0;
     nHCliente    = 0;
     nCampo       = 0;
     nCampoS      = 0;
     nCampo1      = 0;
     nCanti       = 0;
     nHandle1     = 0;
     nHay         = 0;
     nNume        = 0;

     aF2          = "";
     aF3          = "";
     aF4          = "";
     aF5          = "";
     aF6          = "";
     aF7          = "";
     aTecla       = "";
     aModelos     = "";
     aImpre       = "";
     aTercera     = "";
     aAbre        = "";
     aFichXml     = "";
     aFichPdf     = "";
     aFichErr     = "";
     aFichJus1    = "";
     aFichJus2    = "";
     aAlfa        = "";
     aPathModelo  = "";
     aOrigen      = "";
     aDestino     = "";
     aIPRemoto    = "";

     nifp         = "";
     nombrep      = "";
     callep       = "";
     nump         = "";
     escp         = "";
     pisop        = "";
     puep         = "";
     poblap       = "";
     provip       = "";
     codp         = "";
     sgp          = "";
     tlfnop       = "";
     vacio_20     = "                    ";
     vacio_16     = "                ";
     vacio_12     = "            ";
     vacio_10     = "          ";

     CampoDni   = "";
     Letra1     = "";
     Letra2     = "";
     Letra3     = "";
     Letra4     = "";
     Letra5     = "";
     Letra6     = "";
     Letra7     = "";
     Letra8     = "";
     Caracter   = "";
     Carac1     = 0;
     Carac2     = 0;
     Carac3     = 0;
     Carac4     = 0;
     Carac5     = 0;
     XPara      = 0;
     Posi       = 0;
     aLetrasCif = "ABCDEFGHPQSKLM";
     aCaracter  = "";
     Cadena     = "";

     &dia           = "";
     &mes           = "";
     &anyo          = "";
     &eaModelos     = "";
     &eaFOrigen     = "";
     &eaFDestino    = "";
     &eaInternet    = "";
     &eaAlfa        = "";
     &eaDirJava     = "";
     &eaPathAcrobat = "";
     &enAnyo        = 0;
     &enError       = 0;
     &enHandle2     = 0;
     &eaFichError   = "";
     &eaFichDatos   = "";
     &eaFichAuxil   = "";
     &eaEscal       = "";
     &eaPiso        = "";
     &eaPuerta      = "";
     &eaEjer        = "";
     &eaPeriodo     = "";
    &eaVarDni  = "";
    &enCalcCif = 0;
     &eaUnidadBasico = "";

     &eaPathEmision      = "";
     &eaPathLanza        = "";
     &eaPathExplorador   = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &enEmpresa          = 0;
     &eaNomEmpresa       = "";
     &eaUnidad           = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &eaCampo0           = "";
     &eaCampo1           = "";
     &eaCampo2           = "";
     &eaCampo3           = "";
|FIN;

|INCLUE acceso_i;

|PROCESO CargaDatosXml;
     nifp        = "";
     nombrep     = "";
     callep      = "";
     nump        = "";
     escp        = "";
     pisop       = "";
     puep        = "";
     poblap      = "";
     provip      = "";
     codp        = "";

     nifp        = #2#38;
     nombrep     = #2#39;   |QBF nombrep;
     callep      = #2#41;
     nump        = #2#42;
     escp        = #2#43;
     pisop       = #2#44;
     puep        = #2#45;
     poblap      = #2#49;
     provip      = #2#50;
     codp        = #2#80;
     sgp         = #2#40;
     tlfnop      = #2#46;
|FPRC;

|PROCESO LetraDniXml;
     eaVarDni   = CampoDni;
     enCalcCif  = 3;
     |HAZ CalculoDNI;
     CampoDni = eaVarDni;
     CampoDni = ("000000000" + CampoDni) % -109;
|FPRC;

|PROCESO Secuencial1Xml;
     |DDEFECTO #547;

     aAlfa   = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);
     |SI aAlfa = "00000"; aAlfa = "     "; |FINSI;
     #547#6  = aAlfa;

     CampoDni = #2#13;   |HAZ LetraDniXml;
     #547#7  = CampoDni;

     eaAlfa  = #2#2 % 130;  |HAZ QuitaRaros;
     #547#8  = eaAlfa;

     aCaracter  = #2#13 % 101;
     aAlfa      = aLetrasCif - aCaracter;
     |SI aAlfa  = aLetrasCif;
         aAlfa  = ".              ";
     |SINO;
         aAlfa  = "               ";
     |FINSI;
     #547#9  = aAlfa;

     #547#10 = #2#14 % 109;

     #547#11 = #2#3 % 102;

     eaAlfa  = #2#4 % 117;  |HAZ QuitaRaros;
     #547#12 = eaAlfa;

     #547#13  = #2#5 % 104;
     eaEscal  = #2#6 % 102;  |QBF eaEscal;
     eaPiso   = #2#7;        |QBF eaPiso;
     eaPuerta = #2#8;        |QBF eaPuerta;

     eaAlfa  = #2#11 % 120;  |HAZ QuitaRaros;
     #547#14 = eaAlfa;

     eaAlfa  = #2#12;  |HAZ QuitaRaros;
     #547#15 = eaAlfa;

     aAlfa   = (("00" + #2#9) % -102) + (("000" + #2#10) % -103);
     |SI aAlfa = "00000"; aAlfa = "     "; |FINSI;
     #547#16 = aAlfa;

     |SI enAnyo = 2008;
         #547#17 = "0";
         |SI #8#67 = "S"; |O #8#67 = "X";
              #547#17 = "1";
         |FINSI;
     |FINSI;

     |SI enAnyo ] 2009;
         #547#17 = "0";
         |SI #8#84 = "S"; |O #8#84 = "X";
             #547#17 = "1";
         |FINSI;
     |FINSI;

     aAlfa  = "20" + (("00" + #0#0) % -102);
     |SI aAlfa = "0000"; aAlfa = "    "; |FINSI;
     #547#18 = aAlfa;

     #547#19 = #7#254;

     eaAlfa  = #7#5;  |HAZ QuitaRaros;  #547#20 = eaAlfa;

     #547#21 = #7#11;

     #547#22 = #7#23;

     eaAlfa  = #7#6;  |HAZ QuitaRaros;  #547#23 = eaAlfa;

     #547#24 = #7#12;

     #547#25 = #7#24;

     eaAlfa  = #7#7;  |HAZ QuitaRaros;  #547#26 = eaAlfa;

     #547#27 = #7#13;

     #547#28 = #7#25;

     eaAlfa  = #7#8;  |HAZ QuitaRaros;  #547#29 = eaAlfa;

     #547#30  = #7#14;

     #547#31  = #7#26;

     eaAlfa   = #7#9;  |HAZ QuitaRaros;  #547#32  = eaAlfa;

     #547#33  = #7#15;

     #547#34  = #7#27;

     eaAlfa   = #7#10;  |HAZ QuitaRaros;  #547#35  = eaAlfa;

     #547#36  = #7#16;

     #547#37  = #7#28;

     #547#38 = "0";
     |SI #8#66 = "S"; |O #8#66 = "X";
         #547#38 = "1";
     |FINSI;

     #547#39 = #8#68;
     #547#40 = #8#69;

     aAlfa  = #2#51 + #2#52;  |QBF aAlfa;
     |SI nombrep ! "";  |O aAlfa = "";
         #547#41 = nifp;

         eaAlfa  = nombrep;  |HAZ QuitaRaros;
         #547#42 = eaAlfa;

         #547#43 = sgp;

         eaAlfa  = callep;  |HAZ QuitaRaros;
         #547#44 = eaAlfa;

         #547#45 = nump;

         #547#46 = escp;

         #547#47 = pisop;

         #547#48 = puep;

         #547#49 = tlfnop;

         eaAlfa  =  poblap;  |HAZ QuitaRaros;
         #547#50 = eaAlfa;

         eaAlfa  = provip;  |HAZ QuitaRaros;
         #547#51 = eaAlfa;

         #547#52 = codp;

         #547#53 = (#0#1 % 102) + (#0#1 % 402) + (#0#1 % 704);

         #547#54 = "";
         #547#55 = "";
         #547#56 = "";
         #547#57 = "";
     |SINO;
         #547#53 = "";

         eaAlfa  = #2#11;  |HAZ QuitaRaros;
         #547#54 = eaAlfa;

         #547#55 = dia;
         #547#56 = mes;
         #547#57 = #0#1 % -104;

         eaAlfa  = (#2#51 + #2#52) % 136; |HAZ QuitaRaros;
         #547#58 = eaAlfa;

         #547#59 = #2#53 % 109;

         #547#60 = (#2#54 % 102) + (#2#54 % 402) + (#2#54 % 704);

         eaAlfa  = #2#55 % 112;  |HAZ QuitaRaros;
         #547#61 = eaAlfa;

         eaAlfa  = (#2#56 + #2#57) % 136; |HAZ QuitaRaros;
         #547#62 = eaAlfa;

         #547#63 = #2#58 % 109;

         #547#64 = (#2#59 % 102) + (#2#59 % 402) + (#2#59 % 704);

         eaAlfa  = #2#60 % 112;  |HAZ QuitaRaros;
         #547#65 = eaAlfa;

         eaAlfa  = (#2#61 + #2#62) % 136; |HAZ QuitaRaros;
         #547#66 = eaAlfa;

         #547#67 = #2#63 % 109;

         #547#68 = (#2#64 % 102) + (#2#64 % 402) + (#2#64 % 704);

         eaAlfa  = #2#65 % 112;  |HAZ QuitaRaros;
         #547#69 = eaAlfa;
     |FINSI;
|FPRC;

|PROCESO Secuencial2Xml;
     |PARA nCampo = 33; |SI nCampo [ 46; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 27;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 53; |SI nCampo [ 54; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 33;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 176; |SI nCampo [ 181; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 154;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 55; |SI nCampo [ 56; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 27;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 182; |SI nCampo [ 183; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 152;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 57; |SI nCampo [ 64; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 25;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 184; |SI nCampo [ 185; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 144;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 65; |SI nCampo [ 66; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 23;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 186; |SI nCampo [ 187; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 142;
           #548nCampo1 = #7nCampo;
     |SIGUE;

     #548#134 = #7#47;
     #548#135 = #7#48;
     #548#136 = #7#49;
     #548#137 = #7#50;
     #548#138 = #7#51;
     #548#139 = #7#52;

     #548#46  = #7#67;
     #548#47  = #7#188;
     #548#48  = #7#68;
     #548#49  = #7#189;
     #548#50  = #7#69;
     #548#51  = #7#190;
     #548#52  = #7#70;
     #548#53  = #7#191;
     #548#54  = #7#71;
     #548#55  = #7#192;
     #548#56  = #7#72;
     #548#57  = #7#193;
     #548#58  = #7#73;
     #548#59  = #7#194;
     #548#60  = #7#74;
     #548#61  = #7#195;
     #548#62  = #7#75;
     #548#63  = #7#76;
     #548#64  = #7#77;

     #548#65  = #7#79;
     #548#66  = #7#80;
     #548#67  = #7#199;
     #548#68  = #7#81;
     #548#69  = #7#200;
     #548#70  = #7#82;
     #548#71  = #7#201;
     #548#72  = #7#83;
     #548#73  = #7#202;
     #548#74  = #7#84;
     #548#75  = #7#203;
     #548#76  = #7#85;
     #548#77  = #7#204;
     #548#78  = #7#196;
     #548#79  = #7#205;
     #548#80  = #7#220;
     #548#81  = #7#221;

     nNume    = #7#222 * 100;
     aAlfa    = nNume;  |QBF aAlfa;
     aAlfa    = (aAlfa % 101) + "." + (aAlfa % 202);
     #548#82  = aAlfa;

     #548#83  = #7#223;
     #548#84  = #7#224;
     #548#85  = #8#56;
     #548#86  = #7#225;
     #548#87  = #7#88;

     #548#88  = #7#90;
     #548#89  = #7#91;
     #548#90  = #7#206;
     #548#91  = #7#92;
     #548#92  = #7#207;
     #548#93  = #7#93;
     #548#94  = #7#208;
     #548#95  = #7#94;
     #548#96  = #7#209;
     #548#97  = #7#95;
     #548#98  = #7#210;
     #548#99  = #7#96;
     #548#100 = #7#211;
     #548#101 = #7#197;
     #548#102 = #7#212;
     #548#103 = #7#226;
     #548#104 = #7#227;

     nNume    = #7#228 * 100;
     aAlfa    = nNume;  |QBF aAlfa;
     aAlfa    = (aAlfa % 101) + "." + (aAlfa % 202);
     #548#105 = aAlfa;

     #548#106 = #7#229;
     #548#107 = #7#230;
     #548#108 = #8#57;
     #548#109 = #7#231;
     #548#110 = #7#99;

     #548#111 = #7#101;
     #548#112 = #7#102;
     #548#113 = #7#213;
     #548#114 = #7#103;
     #548#115 = #7#214;
     #548#116 = #7#104;
     #548#117 = #7#215;
     #548#118 = #7#105;
     #548#119 = #7#216;
     #548#120 = #7#106;
     #548#121 = #7#217;
     #548#122 = #7#107;
     #548#123 = #7#218;
     #548#124 = #7#198;
     #548#125 = #7#219;
     #548#126 = #7#232;
     #548#127 = #7#233;

     nNume    = #7#234 * 100;
     aAlfa    = nNume;  |QBF aAlfa;
     aAlfa    = (aAlfa % 101) + "." + (aAlfa % 202);
     #548#128 = aAlfa;

     #548#129 = #7#235;
     #548#130 = #7#236;
     #548#131 = #8#58;
     #548#132 = #7#237;
     #548#133 = #7#110;

     #548#140 = #8#76;
     #548#141 = #8#77;
     #548#142 = #8#78;
     #548#143 = #8#79;
     #548#144 = #8#80;
     #548#145 = #8#122;
     #548#146 = #8#123;
     #548#147 = #8#124;
|FPRC;

|PROCESO Secuencial3Xml;
     |DDEFECTO #549;

     #549#6  = ("00" + #7#119) % -102;
     #549#7  = #7#123;
     #549#8  = #7#127;
     #549#9  = #7#131;
     #549#10 = #7#244;
     #549#11 = #7#249;

     #549#12 = ("00" + #7#120) % -102;
     #549#13 = #7#124;
     #549#14 = #7#128;
     #549#15 = #7#132;
     #549#16 = #7#245;
     #549#17 = #7#250;

     #549#18 = ("00" + #7#121) % -102;
     #549#19 = #7#125;
     #549#20 = #7#129;
     #549#21 = #7#133;
     #549#22 = #7#246;
     #549#23 = #7#251;

     #549#24 = ("00" + #7#122) % -102;
     #549#25 = #7#126;
     #549#26 = #7#130;
     #549#27 = #7#134;
     #549#28 = #7#247;
     #549#29 = #7#252;

     #549#30 = ("00" + #7#240) % -102;
     #549#31 = #7#241;
     #549#32 = #7#242;
     #549#33 = #7#243;
     #549#34 = #7#248;
     #549#35 = #7#253;

     #549#36 = #7#135;
     #549#37 = #8#59;
     #549#38 = #7#138;
     #549#39 = #7#140;
     #549#40 = #7#139;

     |PARA nCampo = 141; |SI nCampo [ 145; |HACIENDO nCampo = nCampo + 1;
           nCampo1     = nCampo - 100;
           #549nCampo1 = #7nCampo;
     |SIGUE;

     |PARA nCampo = 146; |SI nCampo [ 148; |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo - 100;
           nCanti  = 0;

           |SI #7#149 = 0;  nCanti = #7nCampo;  |FINSI;

           #549nCampo1 = nCanti;
     |SIGUE;

     |PARA nCampo = 149; |SI nCampo [ 153; |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo - 100;
           nCanti  = 0;

           |SI #7#149 ! 0;  nCanti = #7nCampo;  |FINSI;
           #549nCampo1 = nCanti;
     |SIGUE;

     nCanti  = 0;
     |SI #7#149 ! 0;  nCanti = #7#146;  |FINSI;
     #549#54 = nCanti;

                                  || Del -55- al -57-

     |PARA nCampo = 154; |SI nCampo [ 156; |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo - 99;
           nCanti  = 0;

           |SI #7#149 ! 0;  nCanti= #7nCampo;  |FINSI;

           #549nCampo1 = nCanti;
     |SIGUE;

     #549#58 = #7#157;
     #549#59 = #7#158;
     #549#90 = #8#86;
     #549#60 = #7#159;
     #549#61 = #7#160;
     #549#91 = #8#87;
     #549#92 = #8#88;
||aqui
     #549#62 = #7#161;
     #549#63 = #8#146;
     #549#64 = #7#165;
     #549#65 = #7#166;
     #549#66 = #7#167;
     #549#67 = #7#172;
     #549#68 = #7#174;
     #549#69 = #7#162;
     #549#70 = #7#163;
     #549#71 = #7#164;
     #549#72 = #8#61;
     #549#73 = #8#62;
     #549#74 = #7#168;
     #549#75 = #7#169;
     #549#76 = #7#170;

     #549#79 = #8#81;
     #549#80 = #7#171;
     #549#81 = #8#82;
     #549#82 = #8#89;
     #549#83 = #7#173;
     #549#84 = #7#175;
     #549#85 = #8#83;
     #549#86 = #8#147;
     #549#87 = #8#148;
     #549#88 = #8#149;
     #549#89 = #8#150;
|FPRC;

|PROCESO CargaEmpresaXML;
     |ABRE #7;
     #7#0 = enEmpresa;
     #7#1 = #0#0;
     |LEE 101#7=;
     |SI FSalida ! 0;
         |MENAV "0000SELECCION VACIA";
         |CIERRA #7;
         |ACABA;
     |FINSI;

     |ABRE #8;
     #8#0 = enEmpresa;
     #8#1 = #0#0;
     |LEE 001#8=;
     |SI FSalida ! 0; |DDEFECTO #8; |FINSI;
     |CIERRA #8;

     |ABRE #9;
     #9#0 = enEmpresa;
     #9#1 = #0#0;
     |LEE 001#9=;
     |SI FSalida ! 0; |DDEFECTO #9; |FINSI;
     |CIERRA #9;

     |ABRE #2;
     #2#0 = enEmpresa;
     #2#1 = #0#0;
     |LEE 001#2=;
     |SI FSalida ! 0;
         |MENAV "0000No se encuentra el fichero de Portadas Modelos";
         |CIERRA #2;
         |CIERRA #7;
         |ACABA;
     |FINSI;
     |CIERRA #2;

     |HAZ CargaDatosXml;
     |HAZ Secuencial1Xml;
     |HAZ Secuencial3Xml;

     eaFicheroPlano = "390" + (("00000" + #7#0) % -105) + ".xml";
     eaFicheroSalid = "390" + (("00000" + #7#0) % -105) + ".390";
     eaFicheroError = "err" + (("00000" + #7#0) % -105) + ".txt";

     aAbre     = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, enHandle2;

     |ABRE #199;
     |HAZ CargaXml;
     |CIERRA #199;
     |XCIERRA enHandle2;

     enEmpresa    = #7#0;
     eaNomEmpresa = #2#2;

     |HAZ PresentaPortal;

     |SI eaOpcion ! "1";
         #7#3 = "";
         #7#4 = "N";
         |SI enErrorPortal = 0;
             #7#3 = #0#1;
         |FINSI;

         |GRABA 020#7a;
     |FINSI;

     |LIBERA #7;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidad;

     #caem3390#0 = eaCampo0;
     #caem3390#1 = eaCampo1;
     #caem3390#2 = eaCampo2;
     #caem3390#3 = eaCampo3;

     enAnyo     = 2000 + #caem3390#0;
     eaModelos  = "390";
     eaEjer     = enAnyo;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ Botones_2012;

     |SI eaOpcion = "0";  |ACABA;  |FINSI;

     |HAZ CargaEmpresaXML;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3";  |Y enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRO;
