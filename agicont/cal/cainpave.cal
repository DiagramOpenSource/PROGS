|FICHEROS;
     cainpave #0;
     camanpag #1;
     caclipro #2;
     caivasop #3;
     camanrec #4;
     cacuenta #5;
|FIN;

|INCLUYE acceso_i;

|VARIABLES;
     informe = "";
     inform1 = "cainpave";
     inform2 = "cainpav1";
     sw = 0;
     &enfor = 0;
     &ult_cta = "";
     &total = 0;
     &total1 = 0;
     &total2 = 0;
     &sw_inf = 0;
     &empres = "";
     &cp = "";
     &ult_dia = @;
     &ult_mes = "";
     &mes = "";
     &impor = 0;
     alfa1 = "";
     novale = 0;
     Parte1 = "";
     Parte2 = "";
     Posic1 = 0;
     Posic2 = 0;
     Comodin = "";
     Long = "";
     LongNum = 0;
     FEstado = 0;
     MaxDig = 0;


     &eaDescr = "";
|FIN;

|PROCESO mayor;
   alfa1 = #0Campo > " ";
   #0Campo = alfa1;
   |PINTA #0Campo;
|FPRC;

|PROCESO el_mes;
|SI ult_mes = "01";      mes = "ENERO";       |FINSI;
|SI ult_mes = "02";      mes = "FEBRERO";     |FINSI;
|SI ult_mes = "03";      mes = "MARZO";       |FINSI;
|SI ult_mes = "04";      mes = "ABRIL";       |FINSI;
|SI ult_mes = "05";      mes = "MAYO";        |FINSI;
|SI ult_mes = "06";      mes = "JUNIO";       |FINSI;
|SI ult_mes = "07";      mes = "JULIO";       |FINSI;
|SI ult_mes = "08";      mes = "AGOSTO";      |FINSI;
|SI ult_mes = "09";      mes = "SEPTIEMBRE";  |FINSI;
|SI ult_mes = "10";      mes = "OCTUBRE";     |FINSI;
|SI ult_mes = "11";      mes = "NOVIEMBRE";   |FINSI;
|SI ult_mes = "12";      mes = "DICIEMBRE";   |FINSI;
|FPRC;

|PROCESO imprim;
     |HAZ verbueno;
     |SI novale = 1; |ACABA; |FINSI;
     |SI sw = 0;
          sw = 1;
          ult_dia = #1#7;
          alfa1 = #1#7;  alfa1 = alfa1 % 402;
          ult_mes = alfa1;
     |FINSI;
     alfa1 = #1#7;  alfa1 = alfa1 % 402;
     |SI ult_mes ! alfa1;
         sw_inf = 2;
         |PRINT;
         sw_inf = 3;
         |HAZ el_mes;
         |PRINT;
         total = 0;
         total2 = 0;
         ult_mes = alfa1;
         ult_dia = #1#7;
     |SINO;
         |SI ult_dia ! #1#7;
               sw_inf = 2;    ||Imprime el primer total
               |PRINT;
               total = 0;
               ult_dia = #1#7;
          |FINSI;
     |FINSI;
     |HAZ busca_cuen;
     |HAZ leeiva;
     |HAZ leetipo;
     sw_inf = 1;
     |PRINT;
     total  = total  + impor;
     total1 = total1 + impor;
     total2 = total2 + impor;
|FPRC;

|PROCESO leetipo;
     |DDEFECTO #4;
     #4#0 = #1#11;
     |LEE 001#4=;
|FPRC;

|PROCESO leeiva;
     eaDescr = "";
     |DDEFECTO #3;
     #3#0 = #1#0;
     #3#2 = #1#1;
     #3#27 = #1#2;
     |LEE 001#3=;
     eaDescr = #1#28; |QBF eaDescr;
     |SI eaDescr = ""; eaDescr = #3#7; |FINSI;
|FPRC;

|PROCESO busca_cuen;
     |DDEFECTO #2;
     #2#23 = "P";
     #2#10 = #1#4;
     #2#11 = #1#5;
     |LEE 001#2=;
     |SI FSalida ! 0;
         |HAZ lee_cta;
         #2#1 = #5#2;
     |FINSI;
     cp = (("000" + #2#3) % -102) + (("000" + #2#4) % -103);
|FPRC;

|PROCESO lee_cta;
 |ABRE #5;
 |DDEFECTO #5;
 #5#0 = #1#4;
 #5#1 = #1#5;
 |LEE 001#5=;
 |CIERRA #5;
|FPRC;

|DEFBUCLE lee_cobro;
 #1#3;
 4, 0, 1, 11, 26;
 #0#6, "01.01.1900", #0#4, #0#0, #0#2, #0#12, #0#15;
 #0#7, "31.12.2099", #0#5, #0#1, #0#3, #0#13, #0#16;
 e;
 NULL, imprim;
|FIN;

|PROCESO inicia; |TIPO 3;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |SI #0#17 ! "C";
      enfor = 1; |SI #0#17 = "N"; enfor = 2; |FINSI;
      informe = inform1;
  |SINO;
      enfor = 0;
      informe = inform2;
  |FINSI;

  |INFOR informe;
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  empres = #48#1;
  |ABRE #4;
  |ABRE #3;
  |ABRE #2;
  |BUCLE lee_cobro;
  |SI sw = 1;
      sw_inf = 2;
      |PRINT;
      sw_inf = 3;
      |HAZ el_mes;
      |PRINT;
  |FINSI;
  |CIERRA #4;
  |CIERRA #3;
  |CIERRA #2;
  |PIEINF;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO verbueno;
   novale = 0;
   impor = 0;
   |SI #0#14 = "T";
       impor = #1#8; || importe total pago
       |ACABA;
   |FINSI;
   |SI #0#14 = "S";
       impor = #1#23; || importe pagado
       |SI impor = 0;
           novale = 1;
       |FINSI;
       |ACABA;
   |FINSI;
   |SI #0#14 = "N";
       impor = #1#8 - #1#23; || importe total - liquidado
       |SI impor = 0; |O #1#22 = "S";
           novale = 1;
           impor = 0;
       |FINSI;
       |ACABA;
   |FINSI;
|FPRC;

|PROCESO Cuenta; |TIPO 6;

   |SI dig4 ! 0; MaxDig = dig4; |FINSI;
   |SI dig5 ! 0; MaxDig = dig5; |FINSI;
   |SI dig6 ! 0; MaxDig = dig6; |FINSI;
   |SI dig7 ! 0; MaxDig = dig7; |FINSI;
   |SI dig8 ! 0; MaxDig = dig8; |FINSI;
   |SI dig9 ! 0; MaxDig = dig9; |FINSI;

   Comodin = #cainpave#Campo#;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      FEstado = FSalida;
      Posic1 = (FEstado / 100) ! 0;
      Posic1 = Posic1 + 99;
      Posic2 = FEstado + 98;
      Parte1 = Comodin % Posic1;
      Parte2 = Comodin % Posic2;
      |QBF Comodin;
      Long = Comodin % 0;
      LongNum = MaxDig - Long;
      Comodin = "0" * LongNum;
      Comodin = Parte1 + Comodin + Parte2;
      #cainpave#Campo# = Comodin;
      |PINTA #cainpave#Campo#;
   |FINSI;
|FPRC;                                                                              |PINTA #capredcb#Campo#;

|PROCESO init; |TIPO 8;
   |HAZ inicio;
|FPRC;
