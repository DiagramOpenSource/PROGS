|FICHEROS;
  caman110 #0;
  eosclipr #2,MANTE;
  agipobla #3;
  agiprovi #4;
  caprovin #6;
  agim0016 #7;
  agicontr #23;
|FIN;

|VARIABLES;
   xxx = 0;
   Porcentaje = 0;
   Retencion  = 0;
   nAnterior  = 0;
   nAnter1    = 0;
   nAnter2    = 0;
   nAnter3    = 0;
   nPorc      = 0;

   letra1     = "";
   letra2     = "";
   letra3     = "";
   letra4     = "";
   letra5     = "";
   letra6     = "";
   letra7     = "";
   letra8     = "";
   xx = "";
   xnumerica1 = 0;
   xnumerica2 = 0;
   xnumerica3 = 0;
   xnumerica4 = 0;
   xnumerica5 = 0;
    traba   = "";
    &agi    = "";
    &agi1   = "";
    &agi2   = "";
    &aste   = "";
    longi   = "";
    men6    = "    NConfirma el Alta en Fichero General (S/N): ";
    num     = 0;
    antes   = 0;
    salida  = 0;
    modo    = 0;
    mas     = 0;
    antnum  = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;

|INCLUYE acceso_i;

|| **********************************************************************
|| **********************************************************************
|PROCESO alentrar;  |TIPO 8;
  |HAZ inicio;
  |HAZ tipo_8;
|FPRC;

|PROCESO tipo13; |TIPO 13;
  #0#0   = cod1;       |PINTA #0#0;
  #0#2   = #30#1;      |PINTA #0#2;
  #0#134 = #30#26;     |PINTA #0#134;
|FPRC;

|PROCESO quetecla;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |ENCAMPO #7#0;
|FPRC;

|PROCESO def_any; |TIPO 7;
  modo = (FEntrada / 100) ! 0;
  |SI modo ! 1; |ACABA; |FINSI;

  #0#0   = cod1;
  #0#2   = #30#1;
  #0#134 = #30#26;

 |SI modo = 1;
    |SELECT #4#0;
    mas = 1;
    #0#1 = 999999;
    |LEE 001#0];
    |SI FSalida = 0;
        |LEE 001#0a;
        |SI FSalida ! 0; |O cod1 ! #0#0; |O #30#26 ! #0#134;
            mas = 0;
            |DDEFECTO #0;
        |FINSI;
        antnum = #0#1;
    |SINO;
        |LEE 001#0u;
        |SI FSalida ! 0; |O cod1 ! #0#0; |O #30#26 ! #0#134;
            mas = 0;
            |DDEFECTO #0;
        |FINSI;
        antnum = #0#1;
    |FINSI;
    |DDEFECTO #0;
    |SELECT #1#0;
    #0#1 = antnum + mas; |PINTA #0#1;
 |FINSI;
|FPRC;

|PROCESO clienprov;
  traba = #0#7;
  |QBF traba;
  |SI traba = "";  |ACABA;  |FINSI;
  |SI aste = "*";  |ACABA;  |FINSI;
  |ABRE #2;
  #2#0 = #0#7;          ||NIF
  |LEE 001#2=;
  |SI FSalida = 0;
      |HAZ a_campos;
  |SINO;
      |HAZ altaclipr;
  |FINSI;
  |CIERRA #2;
|FPRC;

|PROCESO altaclipr;
 |SI aste = "*"; |ACABA; |FINSI;
    |CONFI men6;
    |SI FSalida = 0;
        |PUSHV 0501 2380;
        |PINPA #0#2;
        |DDEFECTO #2;
        #2#0 = #0#7;
        #2#1 = #0#3;
        #2#3 = #0#127;
        #2#4 = #0#128;
        #2#5 = #0#130;
        #2#6 = #0#131;
        #2#7 = #0#5;
        #2#8 = #0#6;
        #2#9 = #0#132;
        #2#10 = #0#4;

        |PINTA #2#0;
        |PINDA #0#2;
        |ENDATOS #1#2;
        |SI FSalida = 0;
             |POPV;
             |HAZ a_campos;
             |GRABA 020#2n;                 || Graba el agicli
        |SINO;
             |POPV;
        |FINSI;
    |FINSI;
 |LIBERA #2;
|FPRC;

|PROCESO a_campos;
      #0#7 = #2#0;      || Nif
      #0#3 = #2#1;      || Nombre
      traba = #2#2;     || SG
      |QBF traba;
      |SI traba = "";
          #0#127 = #2#3;   || Domicilio
      |SINO;
          #0#127 = traba + " " + #2#3; || Sg. + Domicilio
      |FINSI;
      #0#128 = #2#4;  || Numero
                      || NO existe Escalera #0#129
      #0#130 = #2#5;  || Piso
      #0#131 = #2#6;  || Puerta
      #0#5 = #2#7;    || C.P.1
      #0#6 = #2#8;    || C.P.2
      #0#4 = #2#10;   || Localidad
      #0#132 = #2#9;  || Provincia
      |PINTA #0#3;
      |PINTA #0#7;
      |PINTA #0#127;
      |PINTA #0#128;
      |PINTA #0#129;
      |PINTA #0#130;
      |PINTA #0#131;
      |PINTA #0#5;
      |PINTA #0#6;
      |PINTA #0#4;
      |PINTA #0#132;
|FPRC;

|PROCESO conficha;
  |SI aste = "*"; |ACABA; |FINSI;
  |SI FSalida ! 10; |ACABA; |FINSI;
  antes = 0;
  |ABRE #2;
  |PUSHV 0501 2380;
  |PINPA #0#2;
  #2#0 = #0#7;
  |LEE 000#2];
  |CONSULTA #0#2;
  salida = FSalida;
     |CIERRA #2;
     |POPV;
  |SI salida = 0;
      #0#7 = #2#0;
      |PINTA #0#7;
  |SINO;
      antes = 1;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO provincia; |TIPO 6;
  |SI aste = "*"; |ACABA; |FINSI;
  |ABRE #4;
  #4#0 = #0#5;
  |LEE 001#4=;
  |SI FSalida = 0;
      #0#132 = #4#1;
      |ABRE #6;
      #6#0 = #0#5;
      |LEE 001#6=;
      |SI FSalida ! 0;
          #6#0 = #0#5;
          #6#1 = #4#1;
          |GRABA 020#6n;
      |FINSI;
      |CIERRA #6;
  |FINSI;
  |CIERRA #4;
|FPRC;

|PROCESO poblacion;
  |SI aste = "*"; |ACABA; |FINSI;
  |ABRE #3;
  #3#0 = #0#5;
  #3#1 = #0#6;
  |LEE 011#3=;
  |SI FSalida = 0;
      #0#4 = #3#2;
      |PINTA #0#4;
  |FINSI;
  |CIERRA #3;
|FPRC;

|PROCESO letranif1;
     |SI FSalida = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO desigual; |TIPO 0;
   |SI #0Campo ! "E";|Y #0Campo ! " ";
       |SI Campo = 12;
           |SI #0Campo = #0#13; |O #0Campo = #0#14;
               |MENAV "    ATENCION!!! Claves iguales ...";
               |ERROR;
           |FINSI;
       |FINSI;
       |SI Campo = 13;
           |SI #0Campo = #0#12; |O #0Campo = #0#14;
               |MENAV "    ATENCION!!! Claves iguales ...";
               |ERROR;
           |FINSI;
       |FINSI;
       |SI Campo = 14;
           |SI #0Campo = #0#12; |O #0Campo = #0#13;
               |MENAV "    ATENCION!!! Claves iguales ...";
               |ERROR;
           |FINSI;
       |FINSI;
   |SINO;
       |SI #0Campo = "E";
           |MENAV "    ATENCION!!! Clave gestionada con conceptos 41? ...";
           |ERROR;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO acumula;

    nAnterior = Contenido;

    Porcentaje = -1;
    |SI Campo ] 23;|Y Campo [ 34; Porcentaje = #0#9;  nPorc = nAnter1; |FINSI;
    |SI Campo ] 49;|Y Campo [ 60; Porcentaje = #0#10; nPorc = nAnter2; |FINSI;
    |SI Campo ] 75;|Y Campo [ 86; Porcentaje = #0#11; nPorc = nAnter3; |FINSI;

    |SI Porcentaje ! -1;
        |SI nAnterior = 0;
            Retencion = Campo + 13;
            #0Retencion = #0Campo % Porcentaje;
            |PINTA #0Retencion;
        |SINO;
            |SI nAnterior ! #0Campo;
                |SI nPorc = Porcentaje; |O nPorc = 0;
                    Retencion = Campo + 13;
                    #0Retencion = #0Campo % Porcentaje;
                    |PINTA #0Retencion;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;

    #0#35 = 0;
    |PARA xxx = 23; |SI xxx [ 34; |HACIENDO xxx = xxx + 1;
          #0#35 = #0#35  + #0xxx;
    |SIGUE;

    #0#48 = 0;
    |PARA xxx = 36; |SI xxx [ 47; |HACIENDO xxx = xxx + 1;
          #0#48 = #0#48  + #0xxx;
    |SIGUE;

    #0#61 = 0;
    |PARA xxx = 49; |SI xxx [ 60; |HACIENDO xxx = xxx + 1;
          #0#61 = #0#61  + #0xxx;
    |SIGUE;

    #0#74 = 0;
    |PARA xxx = 62; |SI xxx [ 73; |HACIENDO xxx = xxx + 1;
          #0#74 = #0#74  + #0xxx;
    |SIGUE;

    #0#87 = 0;
    |PARA xxx = 75; |SI xxx [ 86; |HACIENDO xxx = xxx + 1;
          #0#87 = #0#87  + #0xxx;
    |SIGUE;

    #0#100 = 0;
    |PARA xxx = 88; |SI xxx [ 99; |HACIENDO xxx = xxx + 1;
          #0#100 = #0#100 + #0xxx;
    |SIGUE;

    #0#113 = 0;
    |PARA xxx = 101; |SI xxx [ 112; |HACIENDO xxx = xxx + 1;
          #0#113 = #0#113 + #0xxx;
    |SIGUE;

    #0#126 = 0;
    |PARA xxx = 114; |SI xxx [ 125; |HACIENDO xxx = xxx + 1;
          #0#126 = #0#126 + #0xxx;
    |SIGUE;

    |PINTA #0#35;
    |PINTA #0#48;
    |PINTA #0#61;
    |PINTA #0#74;
    |PINTA #0#87;
    |PINTA #0#100;
    |PINTA #0#113;
    |PINTA #0#126;
|FPRC;

|PROCESO cuadro; |TIPO 7;
  |PUSHV 0501 2380;
  |SI #0#135 = "0";  |HAZ Cuadro1;  |FINSI;
  |SI #0#135 = "5";  |HAZ Cuadro2;  |FINSI;
|FPRC;

|PROCESO  Cuadro1;
/*
  |CUADRO 1010 2356;
  |ATRI R;
  |PINTA 1111, " -A- Empleados por cuenta ajena  (Rdto.Trab.)";
  |PINTA 1211, " -B- Pensionistas.               (Rdto.Trab.)";
  |PINTA 1311, " -C- Consejeros.                 (Rdto.Trab.)";
  |PINTA 1411, " -D- Rendimientos irregulares.   (Rdto.Trab.)";
  |PINTA 1511, " -E- Exentas de retencion.       (Rdto.Trab.)";
  |PINTA 1611, " -F- En especie.                 (Rdto.Trab.)";
  |PINTA 1711, " -G- Dinerarios.                 (Profesion.)";
  |PINTA 1811, " -H- En especie.                 (Profesion.)";
  |PINTA 1911, " -I- Dinerarios.                 (Premios)   ";
  |PINTA 2011, " -J- En especie.                 (Premios)   ";
  |PINTA 2111, " -K o Y- Dinerarios.             (Agricolas) ";
  |PINTA 1111, " -A- General.                  (Trabajadores)";
  |PINTA 2211, " -L o Z- En especie.             (Agricolas) ";
  |ATRI 0;
*/

  |PINTA 1056, " ";
  |ATRI R;
  |PINTA 1156, " ";
  |PINTA 1256, " ";
  |PINTA 1356, " ";
  |PINTA 1456, " ";
  |PINTA 1556, " ";
  |ATRI 0;

  |CUADRO 1010 1656;
  |ATRI R;
  |PINTA 1511, " -L  En especie.                  (Agricolas)";
  |PINTA 1411, " -K  Dinerarios.                  (Agricolas)";
  |PINTA 1311, " -H- En especie.              (Profesionales)";
  |PINTA 1211, " -G- Dinerarios.              (Profesionales)";
  |PINTA 1111, " -A- General.                  (Trabajadores)";
  |ATRI 0;

|FPRC;

|PROCESO  Cuadro2;
  |CUADRO 1010 1356;
  |ATRI R;
  |PINTA 1111, " -1- Rendimientos Dinerarios Arrendamientos  ";
  |PINTA 1211, " -2- Rendimientos en Especie Arrendamientos  ";
  |ATRI 0;
|FPRC;

|PROCESO recupera; |TIPO 0;
  |POPV;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO Mayus1;
  #0Campo = #0Campo > #0Campo;  |PINTA #0Campo;
|FPRC;

|PROCESO Porcen; |TIPO 0;
  |SI #0#9 = 0;|Y #0Campo = "A";
      #0#9 = 15;
      |PINTA #0#9;
  |FINSI;
|FPRC;

|CALCULO ElTipo1; |TIPO 1;
 nAnter1 = #0#9;
 nAnter2 = #0#10;
 nAnter3 = #0#11;
|FCAL;

|CALCULO ElTipo3; |TIPO 3;
 nAnter1 = 0;
 nAnter2 = 0;
 nAnter3 = 0;
|FCAL;

|| ..... Procesos de Contabilidad - Ficha General de Clientes

|PROCESO tipo_8; || control de la ficha de clientes general
  |DIRECTORIO agi;
  |QBF agi;
  |PATH_DAT #23 agi;

  |ABRE #23;
  #23#0 = 1;
  |LEE 040#23=;
  |SI FSalida ! 0; aste = "*"; |CIERRA #23; |ACABA; |FINSI;
  |CIERRA #23;
  aste = #23#7;
  |QBF aste;
  |SI aste  = "*"; |ACABA; |FINSI;

  agi1 = #23#8; |QBF agi1;

  longi = agi1 % 0;
  num   = longi;
  num   = 100 + (num - 5);
  longi = num;

  agi2  = (agi1 % longi) + "pan/";

  |PATH_DAT #2 agi1;
  |PATH_DAT #3 agi1;
  |PATH_DAT #4 agi1;
  |PATH_DAT #7 agi1;

  |PATH_PAN #2 agi2;
  |PATH_PAN #3 agi2;
  |PATH_PAN #4 agi2;
  |PATH_PAN #7 agi2;
|FPRC;
|| ===================================================
