|FICHEROS;
    hdepurar #0;
    hcuentas #1;         || lista de cuentas
    hasiento #2;         || lista de asientos
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    seleccio2 = 0;
    modo = 0;
    sw_rup = 0;

    fabre1 = "";
    fabre2 = "";
    field1 = "";
    field2 = "";
    fcanl1 = "";
    fcanl2 = "";
    fgrab1 = "";
    fgrab2 = "";
    buscando = "";
    quitados = 0;
    g_pos1 = 0;
    g_pos2 = 0;
    salto = "";
    sw_salto = 0;
    hojas = 0;
    iguales = "==============================";
    guiones = "------------------------------";
    suma_sigue = "S U M A  Y  S I G U E ...";
    detalle = 1;
    asiento = "------ FECHA :";
    sw_asiento = 0;
    long_ant = 0;
    cont_asi = 0;
|FIN;
____________________________________/
|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO no_fichero; |TIPO 0;
|SI #0#6 = "I";
        alfa1 = "N";
|SINO;
        alfa1 = "S";
|FINSI;
|C_M #0#1, 1, alfa1;
|FPRC;

|PROCESO min2;
    #2#0 = #0#5;
    #2#1 = 1;
|FPRC;

|PROCESO max2;
    #2#0 = #0#5;
    #2#1 = 9999;
|FPRC;

|PROCESO min1;
    #1#0 = #0#5;
    #1#1 = 1;
|FPRC;

|PROCESO max1;
    #1#0 = #0#5;
    #1#1 = 9999;
|FPRC;

|PROCESO funcion; |TIPO 0;
|SI FSalida = 9;
    |PUSHV 0501 2380;
    |ENTLINEAL #1#1, 2, 3, 22, 1, min1, max1;
    |POPV;
    |ERROR;
|FINSI;
|SI FSalida = 10;
    |PUSHV 0501 2380;
    |ENTLINEAL #1#2, 2, 3, 22, 1, min2, max2;
    |POPV;
    |ERROR;
|FINSI;
|FPRC;

|PROGRAMA;
|CLS;
|CABEZA "Depurar Informes";
|PINPA #0#0;
|DDEFECTO #0;
|ABRE #0;
|LEE 101#0p;
|SI FSalida ! 0;    |GRABA 020#0b; |FINSI;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0;
    |SI #0#6 = "F";
        |HAZ tipo3;
        |GRABA 020#0a;
    |SINO;
        |IMPRE 0;
        |SI FSalida = 0;
            |HAZ tipo3;
            |GRABA 020#0a;
        |SINO;
            |MENAV "    Proceso abortado ...";
        |FINSI;
        |FINIMP;
    |FINSI;
|FINSI;
|LIBERA #0;
|CIERRA #0;
|FPRO;
____________________________________/ PROCESOS COMUNES
|PROCESO lee_asientos1;
    alfa1 = #2#2;    alfa1 = ("00" + alfa1) % -102;     || diario
    alfa2 = #2#3;                                       || fecha
    alfa3 = #2#4;    alfa3 = ("      " + alfa3) % -106; || asiento
|SI #0#3 = "D";
        alfa4 = "------ FECHA : " + alfa2 + "  DIARIO : " + alfa1;
        alfa4 = alfa4 + "  ASIENTO : " + alfa3 + "  " + "------";
|FINSI;
|SI #0#3 = "E";
        alfa4 = " " + alfa1 + "     " + alfa2 + " " + alfa3;
|FINSI;
    alfa1 = buscando - alfa4;
|SI alfa1 ! buscando;
        seleccio2 = 1;
|FINSI;
|FPRC;

|DEFBUCLE lee_asientos;
 #2#1;
 ;
 #0#5,    1;
 #0#5, 9999;
 ;
 NULL, lee_asientos1;
|FIN;

|PROCESO lee_cuentas1;
    alfa1 = #1#2;   |QBF alfa1;
    alfa2 = buscando - alfa1;
|SI alfa2 ! buscando;
        seleccio = 1;
|FINSI;
|FPRC;

|DEFBUCLE lee_cuentas;
 #1#1;
 ;
 #0#5,    1;
 #0#5, 9999;
 ;
 NULL, lee_cuentas1;
|FIN;

|PROCESO salida;
|SI #0#6 = "F";  |FGRABA fgrab2;     |FINSI;
|SI #0#6 = "I";  |IMPRIME fgrab2;    |FINSI;
|FPRC;

|PROCESO tipo3;
    salto = #0#2;
|QBF salto;

    alfa1 = #0#0;   |QBF alfa1;
    fabre1 = "rt  " + alfa1;
|FABRE fabre1;
|SI FSalida ] 0;
        fcanl1 = FSalida;
        g_pos1 = Pos;

    |SI #0#6 = "F";
            alfa1 = #0#1;   |QBF alfa1;
            fabre2 = "wt  " + alfa1;
        |FABRE fabre2;
        |SI FSalida ] 0;
                fcanl2 = FSalida;
                g_pos2 = Pos;
            |SI #0#3 = "E";  |HAZ leyendo_ex;    |FINSI;
            |SI #0#3 = "D";  |HAZ leyendo_di;    |FINSI;
            |SI #0#3 = "B";  |HAZ leyendo_ba;    |FINSI;
            |FCIERRA fcanl2;
        |SINO;
                alfa1 = "    [" + (fabre2 % 5) + "] no accesible intentando escritura ...";
            |MENAV alfa1;
        |FINSI;
    |SINO;
        |SI #0#3 = "E";  |HAZ leyendo_ex;    |FINSI;
        |SI #0#3 = "D";  |HAZ leyendo_di;    |FINSI;
        |SI #0#3 = "B";  |HAZ leyendo_ba;    |FINSI;
    |FINSI;
    |FCIERRA fcanl1;
|SINO;
        alfa1 = "    [" + (fabre1 % 5) + "] no accesible intentando lectura ...";
    |MENAV alfa1;
|FINSI;
    Pos = -1;

|AVISO;
|CONFI "    SBorrar Fichero de Entrada (S/N): ";
|SI FSalida = 0;
        alfa1 = fabre1 % 5;
    |FBORRA alfa1;
|FINSI;
|FPRC;
____________________________________/ DEPURACION DE BALANCES
|PROCESO salto_pagina_ba;
    sw_salto = 0;
    alfa1 = buscando - salto;
|SI alfa1 ! buscando;
        sw_salto = 1;
        Pos = g_pos2;
    |PARA para1 = 1; |SI para1 [ quitados; |HACIENDO para1 = para1 + 1;
            fgrab2 = fcanl2 + "  ";
        |HAZ salida;
    |SIGUE;
        g_pos2 = Pos;
        quitados = 0;
|FINSI;
|FPRC;

|PROCESO transfor_ba;
    seleccio = 0;
|BUCLE lee_cuentas;
|SI seleccio = 0;

    |SI sw_salto = 1;    buscando = (buscando - salto) + " ";    |FINSI;

        Pos = g_pos2;
        fgrab2 = fcanl2 + " " + buscando;
    |HAZ salida;
        g_pos2 = Pos;
|SINO;
        quitados = quitados + 1;
|FINSI;
|FPRC;

|PROCESO leyendo_ba;
    Pos = g_pos1;
    field1 = fcanl1 + " 250";
|FLEE field1;
    g_pos1 = Pos;
|PARA; |SI FSalida ] 0; |HACIENDO;
        buscando = field1;
    |HAZ salto_pagina_ba;
    |HAZ transfor_ba;
        Pos = g_pos1;
        field1 = fcanl1 + " 250";
    |FLEE field1;
        g_pos1 = Pos;
|SIGUE;
|FPRC;
____________________________________/ DEPURACION DEL DIARIO
|PROCESO nro_asiento;
    alfa1 = buscando - asiento;
|SI alfa1 ! buscando;
        cont_asi = cont_asi + 1;
        alfa1 = "";
        alfa2 = "";
        alfa3 = "";
        alfa1 = buscando % 149;
        alfa2 = cont_asi; alfa2 = ("       " + alfa2) % -107;
        alfa3 = buscando % 57;
        buscando = alfa1 + alfa2 + alfa3;
|FINSI;
|FPRC;

|PROCESO salto_pagina_di;
    sw_salto = 0;
    alfa1 = buscando - salto;
|SI alfa1 ! buscando;
        sw_salto = 1;
        Pos = g_pos2;
    |PARA para1 = 1; |SI para1 [ quitados; |HACIENDO para1 = para1 + 1;
            fgrab2 = fcanl2 + "  ";
        |HAZ salida;
    |SIGUE;
        g_pos2 = Pos;
        quitados = 0;
|FINSI;
|FPRC;

/*
|SI seleccio = 0;

    |SI sw_salto = 1;    buscando = (buscando - salto) + " ";    |FINSI;

        seleccio = 0;
        alfa1 = buscando - asiento;
    |SI alfa1 ! buscando;
        |SI sw_asiento = 1;
                g_pos2 = g_pos2 - long_ant - 2;   || (el 2 son por los car.
                cont_asi = cont_asi - 1;          || /de final de linea)
                quitados = quitados + 1;
        |FINSI;
            sw_asiento = 1;
            alfa1 = buscando % 0;  long_ant = alfa1;
    |SINO;
            alfa2 = buscando % 0;  nume2 = alfa2;
            alfa3 = buscando - "\";
        |SI nume2 ! 0;|Y alfa3 = buscando;
                sw_asiento = 0;
        |SINO;
            |SI sw_asiento = 1;
                |SI alfa3 ! buscando;
                        g_pos2 = g_pos2 - long_ant - 2;
                        cont_asi = cont_asi - 1;
                        quitados = quitados + 1;
                        sw_asiento = 0;
                |SINO;
                        seleccio = 1;
                        quitados = quitados + 1;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;

    |SI seleccio = 0;
        |HAZ nro_asiento;
            Pos = g_pos2;
            fgrab2 = fcanl2 + " " + buscando;
        |HAZ salida;
            g_pos2 = Pos;
    |FINSI;
|SINO;
        quitados = quitados + 1;
|FINSI;
*/

|PROCESO transfor_di;
    alfa1 = buscando - asiento;
|SI alfa1 ! buscando;
        seleccio2 = 0;
    |BUCLE lee_asientos;
|FINSI;
|SI seleccio2 = 0;

    |SI sw_salto = 1;    buscando = (buscando - salto) + " ";    |FINSI;

    |HAZ nro_asiento;
        Pos = g_pos2;
        fgrab2 = fcanl2 + " " + buscando;
    |HAZ salida;
        g_pos2 = Pos;
|SINO;
        quitados = quitados + 1;
|FINSI;
|FPRC;

|PROCESO leyendo_di;
    Pos = g_pos1;
    field1 = fcanl1 + " 250";
|FLEE field1;
    g_pos1 = Pos;
|PARA; |SI FSalida ] 0; |HACIENDO;
        buscando = field1;
    |HAZ salto_pagina_di;
    |HAZ transfor_di;
        Pos = g_pos1;
        field1 = fcanl1 + " 250";
    |FLEE field1;
        g_pos1 = Pos;
|SIGUE;
|FPRC;
____________________________________/ DEPURACION DEL EXTRACTO CONTABLE
|PROCESO contra_partida;
    alfa1 = buscando - iguales;
|SI alfa1 ! buscando;
        detalle = detalle + 1;
|SINO;
        alfa1 = buscando - guiones;
    |SI alfa1 ! buscando;
            detalle = 0;
    |SINO;
            alfa1 = buscando - suma_sigue;
        |SI alfa1 ! buscando;
                detalle = 1;
        |SINO;
            |SI detalle = 3;          || quita la contrapartida
                    alfa1 = "";
                    alfa2 = "";
                    alfa3 = "";
                    alfa1 = buscando % 128;
                    alfa2 = " " * 12;
                    alfa3 = buscando % 41;
                    buscando = alfa1 + alfa2 + alfa3;
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO numera_pagina;
    alfa1 = buscando - "  HOJA :";
|SI alfa1 ! buscando;
        hojas = hojas + 1;
        alfa1 = "";
        alfa2 = "";
        alfa3 = "";
        alfa1 = buscando % 129;
        alfa2 = hojas;    alfa2 = ("      " + alfa2) % -106;
        alfa3 = buscando % 36;
        buscando = alfa1 + alfa2 + alfa3;
|FINSI;
|FPRC;

|PROCESO transfor_ex;
    alfa1 = buscando - "CUENTA : ";
|SI alfa1 ! buscando;
        seleccio = 0;
    |BUCLE lee_cuentas;
|FINSI;
|SI seleccio = 0;

        seleccio2 = 0;
    |BUCLE lee_asientos;
    |SI seleccio2 = 0;
        |HAZ numera_pagina;        || renumera las hojas
        ||HAZ contra_partida;      || quita las contrapartidas (todas)

        |SI sw_salto = 1;    buscando = (buscando - salto) + " ";    |FINSI;

            Pos = g_pos2;
            fgrab2 = fcanl2 + " " + buscando;
        |HAZ salida;
            g_pos2 = Pos;
    |SINO;
            quitados = quitados + 1;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO salto_pagina_ex;
    sw_salto = 0;
    alfa1 = buscando - salto;
|SI alfa1 ! buscando;
        sw_salto = 1;
        Pos = g_pos2;
    |PARA para1 = 1; |SI para1 [ quitados; |HACIENDO para1 = para1 + 1;
            fgrab2 = fcanl2 + "  ";
        |HAZ salida;
    |SIGUE;
        g_pos2 = Pos;
        quitados = 0;
|FINSI;
|FPRC;

|PROCESO leyendo_ex;
    Pos = g_pos1;
    field1 = fcanl1 + " 250";
|FLEE field1;
    g_pos1 = Pos;
|PARA; |SI FSalida ] 0; |HACIENDO;
        buscando = field1;
    |HAZ salto_pagina_ex;
    |HAZ transfor_ex;
        Pos = g_pos1;
        field1 = fcanl1 + " 250";
    |FLEE field1;
        g_pos1 = Pos;
|SIGUE;
|FPRC;
