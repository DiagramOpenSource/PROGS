|FICHEROS;
 caredm03 #0;
 caredm01 #1;  || Datos Secuencial
 camingca #2;  || Confirming Cabeceras
 camingli #3;  || Confirming Lineas
 caclipro #4;  || Clientes/Proveedores
 camanpag #5;  || Pagos
 caivasop #6;  || iva soportado
 caconcep #7;  || Conceptos
 caacrval #9;
 calisfra #10;

 camoneda #12;
|FIN;

|VARIABLES;
 aTexto = "";
 vl = 0;
 vo = 0;
 vs = "";
 vp = 0;
 prove = "";
 dprove = 0;
 swvic = 0;
 totala = 0;
 to
 alfa1 = "";
 alfa2 = "";
 alfa3 = "";
 alfa4 = "";
 nume1 = 0;
 nume2 = 0;
 nume3 = 0;
 nume4 = 0;

 mens     = "";
 swErrorR = 0;
 swErrorP = 0;
 menR1    = "    No Existe Transferencia !!!";
 menR2    = "    Transferencia YA contabilizada ";
 menR3    = "2400STransferencia YA Emitida en Papel. Aceptar S/N ";
 menR4    = "2400NTransferencia YA lanzada en Diskette. Aceptar S/N ";

 Nombre  = "";
 DniEmp  = "";
 DirEmp  = "";
 CpoEmp  = "";
 PobEmp  = "";
 sino    = "";
 ceros   = "000000000000000";
 fechapre = "      ";
 fechapro = "      ";
 dd       = "";
 mm       = "";
 aa       = "";
 cabe1p   = "0306"; || Cabecera pesetas
 cabe1e   = "0356"; || Cabecera euros
 cabe1    = "";
 cabe2p   = "0606"; || Lineas Individuales pesetas
 cabe2e   = "0656"; || Lineas Individuales euros
 cabe2    = "";
 cabe3p   = "0806"; || Totales pesetas
 cabe3e   = "0856"; || Totales euros
 cabe3    = "";

 NifProv    = "";
 NombreProv = "";
 DirecProv  = "";
 PoblaProv  = "";
 ProviProv  = "";
 Cp1Prov    = "";
 Cp2Prov    = "";
 TelefProv  = "";
 FaxProv    = "";
 PaisProv   = "";
 varios     = 0;

 libre    = " ";
 libre40  = "";
 ca1  = "";
 ca2  = "";
 ca3  = "";
 ca4  = "";
 ca5  = "";
 ca6  = "";
 ca7  = "";
 ca8  = "";
 ca9  = "";
 ca10 = "";
 ca11 = "";
 ca12 = "";
 ca13 = "";
 ca14 = "";
 ca15 = "";
 ca16 = "";
 ca17 = "";
 ca18 = "";
 ca19 = "";
 ca20 = "";
 ca21 = "";
 l          = 0;
 trecibos   = 0;
 timporte   = 0;

 handle     = "";
 fiche      = "";
 dirempr    = "";
 varalfa1   = "";
 varalfa2   = "";
 contenido  = "";
 swERROR    = 0;
 CampoDni   = "";
 Letra1     = "";
 Letra2     = "";
 Letra3     = "";
 Letra4     = "";
 Letra5     = "";
 Letra6     = "";
 Letra7     = "";
 Letra8     = "";
 Caracter   = "";
 Carac1     = 0;
 Carac2     = 0;
 Carac3     = 0;
 Carac4     = 0;
 Carac5     = 0;
 XPara      = 0;

 ccc        = "";
 c_alfa1    = "";
 c_alfa2    = "";
 c_nume1    = 0;
 c_nume2    = 0;
 c_nume3    = 0;

 direcc = "";
 numero = 0;
 longi  = 0;
 concepto  = "";
 concepto1 = "";
 concepto2 = "";

 &programa = "";
 &ficcopia = "";

 Moneda = "";
 aAlfa1 = "";
 Cantidad = 0;
 MonBase = 0;
 nCalc = 0;
 nSwUno = 0;

    &eaVarDni  = "";
    &enCalcCif = 0;

|FIN;

|INCLUYE acces2_i;
|| *************************************************************************
|PROCESO Siagrupo; |TIPO 0;
 alfa1 = #0#13;
 |C_M #0#15,1,alfa1;
 |SI alfa1 = "N"; #0#15 = "N"; |PINTA #0#15; |FINSI;
|FPRC;

|PROCESO mayor;
 alfa1 = #0Campo > " ";
 #0Campo = alfa1;
 |PINTA #0Campo;
|FPRC;

|PROCESO ver_confirming; |TIPO 6;
 |SI FSalida = 2; |ACABA; |FINSI;
 |ABRE #2;
 |HAZ leerem;
 |CIERRA #2;
 |SI swErrorR ! 0;
     |SI swErrorR < 3;
         |MENAV mens;
         |ERROR;
         |ACABA;
     |SINO;
         |CONFI mens;
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
 |FINSI;
 #0#2 = #2#3; || Banco
 #0#3 = #2#1; |PINTA #0#3;
 #0#5 = #2#2; |PINTA #0#5;

 |PINTA 0835, #2#2;   || Vto.
 |PINTA 0858, #2#8;   || N§ Efectos
 |PINTA 0935, #2#3;   || Banco
 |PINTA 0949, #2#9;   || Importe Total
|FPRC;

|PROCESO leerem;
 swErrorR = 0;
 |DDEFECTO #2;
 #2#0 = #0#1;
 |LEE 001#2=;
 |SI FSalida ! 0;
     swErrorR = 1; mens = menR1;
 |SINO;
     |SI #2#9 = "S";
         swErrorR = 2; mens = menR2;
     |SINO;
         |SI #2#10 = "S"; swErrorR = 3; mens = menR3; |FINSI;
         |SI #2#10 = "D"; swErrorR = 4; mens = menR4; |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO lee_pase; |TIPO 6;
 |HAZ leepas;
 |ATRI I;
|| |PINTA 1220, #1#1;
 |ATRI 0;
|FPRC;

|PROCESO leepas;
 swErrorP = 0;
 |ABRE #1;
 |DDEFECTO #1;
 #1#0 = #0#2;
 |LEE 001#1=;
 |SI FSalida ! 0; swErrorP = 1; |FINSI;
 |CIERRA #1;
|FPRC;

||...................................................................................
||*************************************************************************
||************ REGISTROS DE CABECERA **************************************
||*************************************************************************
|PROCESO cabecera;

 || ...................................... Primer Registro Cabecera
    |SI Moneda = "P";
       cabe1 = cabe1p;
       cabe2 = cabe2p;
       cabe3 = cabe3p;
    |SINO;
       cabe1 = cabe1e;
       cabe2 = cabe2e;
       cabe3 = cabe3e;
    |FINSI;

    ca1 = libre * 12;
    ca2 = "001";
    ca3 = #1#4; ca3 = (ceros + ca3) % -104;    || Banco
    ca4 = #1#5; ca4 = (ceros + ca4) % -104;    || Oficina
    ca5 = #1#6; ca5 = (ceros + ca5) % -110;    || Cuenta
    ca6 = "0";
    ca7 = libre * 3;                           || libre (3)
    ca8 = #1#22;ca8 = (ceros + ca8) % -102;    || digito control
    ca9 = libre * 7;                           || libre (7)

    varalfa1 =  cabe1 + DniEmp + ca1 + ca2 + fechapre + fechapro;
    varalfa1 =  varalfa1 + ca3 + ca4 + ca5 + ca6 + ca7 + ca8 + ca9;

    contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
    |FGRABA contenido;

    l = l + 1;

 || ..................................... Segundo Registro Cabecera
    ca1 = libre * 12;
    ca2 = "002";
    ca3 = libre * 7;

    varalfa1 =  cabe1 + DniEmp + ca1 + ca2 + Nombre + ca3;
    contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
    |FGRABA contenido;

    l = l + 1;

 || .....................................  Tercer Registro Cabecera
    ca1 = libre * 12;
    ca2 = "003";
    ca3 = libre * 7;

    varalfa1 =  cabe1 + DniEmp + ca1 + ca2 + DirEmp + ca3;
    contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
    |FGRABA contenido;

    l = l + 1;

 || .....................................  Cuarto Registro Cabecera
    ca1 = libre * 12;
    ca2 = "004";
    ca3 = libre * 7;

    varalfa1 =  cabe1 + DniEmp + ca1 + ca2 + CpoEmp + PobEmp + ca3;
    contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
    |FGRABA contenido;

    l = l + 1;
|FPRC;

||***********************************************************
||******************* REGISTRO INDIVIDUAL *******************
||***********************************************************

|PROCESO leecl_y_cobro;
 || .............. Lee la ficha del Cliente para obtener los datos necesarios
 |DDEFECTO #4;
 |SI #0#13 = "N";
     #4#23 = "P";
     #4#10 = #3#9;
     #4#11 = #3#10;
 |SINO;
     #4#23 = "P";
     #4#10 = prove;
     #4#11 = dprove;
 |FINSI;
 |LEE 001#4=;
 |SI FSalida ! 0;
     |SI #0#13 = "N";
          #4#23 = "C";
          #4#10 = #3#9;
          #4#11 = #3#10;
     |SINO;
          #4#23 = "C";
          #4#10 = prove;
          #4#11 = dprove;
     |FINSI;
     |LEE 001#4=;
     |SI FSalida ! 0; |DDEFECTO #4; swERROR = 1; |FINSI;
 |FINSI;

 |DDEFECTO #5;
 |SI #0#13 = "N";
     #5#0 = #3#2; vl = #3#2;
     #5#1 = #3#3; vo = #3#3;
     #5#2 = #3#4; vs = #3#4;
     #5#3 = #3#5; vp = #3#5;
 |SINO;
     #5#0 = vl;
     #5#1 = vo;
     #5#2 = vs;
     #5#3 = vp;
 |FINSI;
 |LEE 001#5=;

    |HAZ MiraVarios;

    |SI varios = 0;
        NifProv    = #caclipro#9;
        NombreProv = #caclipro#1;
        DirecProv  = #caclipro#2;
        PoblaProv  = #caclipro#6;
        ProviProv  = #caclipro#5;
        Cp1Prov    = #caclipro#3;
        Cp2Prov    = #caclipro#4;
        TelefProv  = #caclipro#7;
        FaxProv    = #caclipro#8;
        PaisProv   = #caclipro#24;
    |SINO;
        NifProv    = #caacrval#4;
        NombreProv = #caacrval#3;
        DirecProv  = #caacrval#5;
        PoblaProv  = #caacrval#6;
        ProviProv  = #caacrval#7;
        Cp1Prov    = #caacrval#8;
        Cp2Prov    = #caacrval#9;
        TelefProv  = #caacrval#11;
        FaxProv    = #caacrval#12;
        PaisProv   = #caacrval#13;
        swERROR    = 0;
    |FINSI;

|FPRC;

|PROCESO grabarecib; ||Calculo registros individuales;
  swERROR = 0;

  |HAZ leecl_y_cobro;
  |SI swERROR = 1; |ACABA; |FINSI;   || Salta este Cobro. NO el resto

|| --------------------------------------- Primer Registro Individual
  ca1 = libre * 11;
  ca2 = "";               || Referencia Cliente
  |SI #0#4 = 1;
     |SI #0#13 = "N";
           ca2 = #3#9;         || Cuenta Contable
     |SINO;
           ca2 = prove;
     |FINSI;
  |SINO;
      ca2 = NifProv;             ||  D.N.I.
      CampoDni = ca2; |HAZ LetraDni; ca2 = CampoDni;
      ca2 = ca2 + libre40; ca2 = ca2 % 112;
  |FINSI;

  ca3 = "010";
  |SI #0#13 = "N";
       nume1 = #3#8;     || nume1 = (#3#8 * 100) ! 0;
  |SINO;
       nume1 = totala;
  |FINSI;
  Cantidad = nume1; |HAZ Conversion;
  ca4 = Cantidad; |QBF ca4;
  ca4 = ceros + "00" + ca4; ca4 = ca4 % -112;  || Importe

  ccc = #5#19; |HAZ cccBanco;         || Datos del banco del Cobro
  ccc = (ccc + ceros) % 110;
  ca5 = ccc % 104;      || Banco
  ca6 = ccc % 504;      || Sucursal
  ca10 = "  " + (ccc % 902);       || digito de control

  ccc = #5#18; |HAZ cccBanco;
  ccc = (ceros + ccc) % -110;
  ca7 = ccc;                 || Cuenta corriente  Proveedor

  ca8  = "1";
  ca9  = "9";

  varalfa1 = "";
  varalfa1 = cabe2    + DniEmp + ca2  + ca3  + ca4  + ca5;
  varalfa1 = varalfa1 + ca6    + ca7  + ca8  + ca9  + ca10 + "       ";

  contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
  |FGRABA contenido;

  trecibos = trecibos + 1;
  l = l + 1;
  timporte = timporte + Cantidad;
|| -------------------------------------- Segundo Registro Individual

  ca1 = libre * 7;

  ca2 = NifProv;             ||  D.N.I.
  CampoDni = ca2; |HAZ LetraDni; ca2 = CampoDni;
  ca2 = ca2 + libre40; ca2 = ca2 % 112;

  ca3 = "011";

  ca4 = (NombreProv + libre40) % 136;   || Nombre Cliente

  varalfa1 = "";
  varalfa1 = cabe2    + DniEmp + ca2  + ca3  + ca4  + ca1;

  contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
  |FGRABA contenido;

  l = l + 1;

|| -------------------------------------- Tercer Registro Individual

  ca3 = "012";
                     || ...........  direcc = #4#2; || Direccion
                     ||              |HAZ separa;
  ca5 = DirecProv;
  ca5 = (ca5 + libre40) % 136;

  varalfa1 = "";
  varalfa1 = cabe2    + DniEmp + ca2  + ca3  + ca5  + ca1;

  contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
  |FGRABA contenido;

  l = l + 1;

|| -------------------------------------- Quinto Registro Individual

  ca3 = "014";

  alfa2 = Cp1Prov; |QBF alfa2; alfa2 = (ceros + alfa2) % -102;
  alfa3 = Cp2Prov; |QBF alfa3; alfa3 = (ceros + alfa3) % -103;
  ca6   = alfa2 + alfa3;                                     || Codigo

  ca7 = (PoblaProv + libre40) % 131;  || Poblacion

  varalfa1 = "";
  varalfa1 = cabe2    + DniEmp + ca2 + ca3 + ca6 + ca7 + ca1;

  contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
  |FGRABA contenido;

  l = l + 1;

|| -------------------------------------- Sexto Registro Individual

  ca3 = "015";

  ca8 = (ProviProv + libre40) % 136;  || Provincia

  varalfa1 = "";
  varalfa1 = cabe2    + DniEmp + ca2 + ca3 + ca8 + ca1;

  contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
  |FGRABA contenido;

  l = l + 1;

|| -------------------------------------- Septimo Registro Individual
|| -------------------------------------y Octavo  Registro Individual

  |SI #1#21 = "S";

      concepto = "";
      ca3 = "016";
      |SI #1#23 = "S";
           concepto = #5#28;
      |SINO;
           concepto = #1#11; |QBF concepto;
           concepto = concepto + " ";
           |SI #1#12 = "S";
               alfa1 = vs; |QBF alfa1;
               concepto = concepto + alfa1;    || Serie
               alfa1 = vo; |QBF alfa1;
               concepto = concepto + alfa1 + " ";  || Numero Orden
          |FINSI;
          |SI #1#13 = "S";
              alfa1 = vp; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || N§ pago
          |FINSI;
          |SI #1#14 = "S";
              alfa1 = #5#6; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || Fecha Emision
          |FINSI;
          |SI #1#15 = "S";
              alfa1 = #5#25; |QBF alfa1;
              concepto = concepto + alfa1;
          |FINSI;
      |FINSI;

      |SI #0#13 = "S";
          |SI #0#15 = "N";
              concepto = "PAGOS VARIOS. ";
          |SINO;
              concepto = concepto1;
          |FINSI;
      |FINSI;

      |QBF concepto;
      |SI concepto ! "";
          ca9 = concepto + libre40; ca9 = ca9 % 136;  || Concepto 1

          varalfa1 = "";
          varalfa1 = cabe2    + DniEmp + ca2 + ca3 + ca9 + ca1;

          contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
          |FGRABA contenido;
          l = l + 1;

          ca3 = "017";
      |FINSI;

      |DDEFECTO #6;
      #6#0  = vl;
      #6#2  = vo;
      #6#27 = vs;
      |LEE 000#6=;

      concepto = "";
      |SI #1#24 = "S";
          concepto = #5#28;
      |SINO;
          concepto = #1#16; |QBF concepto;
          concepto = concepto + " ";
          |SI #1#17 = "S";
              alfa1 = vs; |QBF alfa1;
              concepto = concepto + alfa1;    || Serie
              alfa1 = vo; |QBF alfa1;
              concepto = concepto + alfa1 + " ";  || Numero Orden
          |FINSI;
          |SI #1#18 = "S";
              alfa1 = vp; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || N§ pago
          |FINSI;
          |SI #1#19 = "S";
              alfa1 = #5#6; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || Fecha Emision
          |FINSI;
          |SI #1#20 = "S";
              alfa1 = #5#25; |QBF alfa1;
              concepto = concepto + alfa1;
          |FINSI;
      |FINSI;

      |SI #0#13 = "S";
          |SI #0#15 = "N";
              concepto = "";
          |SINO;
              concepto = concepto2;
          |FINSI;
      |FINSI;

      |QBF concepto;
      |SI concepto ! "";
          ca10 = concepto + libre40; ca10 = ca10 % 136;  || Concepto 1

          varalfa1 = "";
          varalfa1 = cabe2    + DniEmp + ca2 + ca3 + ca10 + ca1;

          contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
          |FGRABA contenido;
          l = l + 1;
      |FINSI;

  |FINSI;
|FPRC;

|PROCESO HagoConceptos;
  |SI #1#21 = "N"; |ACABA; |FINSI;
  |SI #0#15 = "N"; |ACABA; |FINSI;


 |DDEFECTO #5;
 #5#0 = #3#2;
 #5#1 = #3#3;
 #5#2 = #3#4;
 #5#3 = #3#5;
 |LEE 001#5=;

 |ABRE #7;
 |DDEFECTO #7;
 #7#0 = #5#27;
 |LEE 001#7=;
 aTexto = #7#1;
 |QBF aTexto;
 |CIERRA #7;

 |DDEFECTO #6;
 #6#0 = #3#2;
 #6#2 = #3#3;
 #6#27 = #3#4;
 |LEE 000#6=;

      concepto = concepto1;
      |SI nSwUno = 1;
          concepto = "";
          |SI #1#23 = "S";
              concepto = #5#28; |QBF concepto;
          |SINO;
              concepto = #1#11; |QBF concepto;
              concepto = concepto + " ";
          |FINSI;
      |FINSI;
      |SI #1#23 = "N";
          |SI #1#12 = "S";
              alfa1 = #3#4; |QBF alfa1;
              concepto = concepto + alfa1;    || Serie
              alfa1 = #3#3; |QBF alfa1;
              concepto = concepto + alfa1 + " ";  || Numero Orden
          |FINSI;
          |SI #1#13 = "S";
              alfa1 = #3#5; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || N§ pago
          |FINSI;
          |SI #1#14 = "S";
              alfa1 = #5#6; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || Fecha Emision
          |FINSI;
          |SI #1#15 = "S";
              alfa1 = #5#25; |QBF alfa1;
              concepto = concepto + alfa1;
          |FINSI;
      |SINO;
          |SI nSwUno > 1;
              alfa1 = #5#28 - aTexto; |QBF alfa1;
              alfa2 = alfa1 % 101;
              |SI alfa2 ! " ";
                  concepto = concepto + " " + alfa1;
              |SINO;
                  concepto = concepto + alfa1;
              |FINSI;
          |FINSI;
      |FINSI;
      concepto1 = concepto;

      concepto = concepto2;
      |SI nSwUno = 1;
          concepto = "";
          |SI #1#24 = "S";
              concepto = #5#28; |QBF concepto;
          |SINO;
              concepto = #1#16; |QBF concepto;
              concepto = concepto + " ";
          |FINSI;
      |FINSI;
      |SI #1#24 = "N";
          |SI #1#17 = "S";
              alfa1 = #3#4; |QBF alfa1;
              concepto = concepto + alfa1;    || Serie
              alfa1 = #3#3; |QBF alfa1;
              concepto = concepto + alfa1 + " ";  || Numero Orden
          |FINSI;
          |SI #1#18 = "S";
              alfa1 = #3#5; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || N§ pago
          |FINSI;
          |SI #1#19 = "S";
              alfa1 = #5#6; |QBF alfa1;
              concepto = concepto + alfa1 + " ";   || Fecha Emision
          |FINSI;
          |SI #1#20 = "S";
              alfa1 = #5#25; |QBF alfa1;
              concepto = concepto + alfa1;
          |FINSI;
       |SINO;
             |SI nSwUno > 1;
                 alfa1 = #5#28 - aTexto; |QBF alfa1;
                alfa2 = alfa1 % 101;
                |SI alfa2 ! " ";
                    concepto = concepto + " " + alfa1;
                |SINO;
                    concepto = concepto + alfa1;
                |FINSI;
                 concepto = concepto + " " + alfa1;
             |FINSI;
      |FINSI;
      concepto2 = concepto;
|FPRC;

|PROCESO grabareci2;
     |SI swvic = 0;
          swvic = 1;
          prove = #3#9;
          dprove = #3#10;
          totala = 0;
          vl = #3#2;
          vo = #3#3;
          vs = #3#4;
          vp = #3#5;
          concepto1 = "";
          concepto2 = "";
          nSwUno = 0;
     |FINSI;
     |SI prove ! #3#9;
          |SI totala ! 0;
               |HAZ grabarecib;
          |FINSI;
          prove  = #3#9;
          dprove = #3#10;
          totala = 0;
          vl = #3#2;
          vo = #3#3;
          vs = #3#4;
          vp = #3#5;
          concepto1 = "";
          concepto2 = "";
          nSwUno = 0;
     |FINSI;
     totala = totala + #3#8;
     nSwUno = nSwUno + 1;
     |HAZ HagoConceptos;
|FPRC;

|DEFBUCLE camingli;
     #3#1;
     ;
     #2#0,  1;
     #2#0,999;
     ;
     NULL,NULL,NULL,NULL,NULL,grabareci2;
     #3#9;
|FIN;

|PROCESO regindiv;
  trecibos = 0;
  timporte = 0;
  swvic    = 0;
  |SI #0#13 = "N";
      |BUCLELIN 0grabarecib#2;
  |SINO;
      |BUCLE camingli;
      |SI swvic = 1;
          |HAZ grabarecib;
      |FINSI;
  |FINSI;
  |SI swERROR = 1;
      |MENAV "    ATENCION !!!. DATOS DE PROVEEDORES INCOMPLETOS. ";
  |FINSI;
  |SI trecibos ! 0;
      #2#1  = #0#3;
      #2#2  = #0#5;
      #2#10 = "D";
      |GRABA 020#2a;
      |LIBERA #2;
  |FINSI;
|FPRC;

||***********************************************************
||********** REGISTRO TOTAL *********************************
||***********************************************************
|PROCESO campo_totales;

  ca1 = libre * 15;

  nume1 = timporte;
  ca2   = nume1; |QBF ca2;
  ca2   = ceros + ca2; ca2 = ca2 % -112;    || Suma Importes
                       ||  |SI nume1 ] 0; ca2 = ceros + ca2; ca2 = ca2 % -112; |FINSI;  || Importe
                       ||  |SI nume1 < 0; ca2 = "               "+ ca2; ca2 = ca2 % -112; |FINSI;
  nume1 = trecibos;
  ca3   = nume1; |QBF ca3;
  ca3   = ceros + ca3; ca3 = ca3 % -108;    || Numero Recibos 010

  l     = l + 1; || suma tambien este registro
  nume1 = l;
  ca4   = nume1; |QBF ca4;
  ca4   = ceros + ca4; ca4 = ca4 % -110;    || Numero Registros

  ca5 = libre * 13;

  varalfa1 = "";
  varalfa1 = cabe3 + DniEmp + ca1 + ca2 + ca3 + ca4 + ca5;

  contenido = handle + " " + varalfa1 + &#0#7 + &#0#8;
  |FGRABA contenido;
|FPRC;

|| **************************************************************************

|PROCESO pasecuencial; |TIPO 3;
     |ABRE #camoneda;
     #camoneda#0 = #48#2;
     #camoneda#1 = #48#3;
     |LEE 000#camoneda.=;
     |SI FSalida = 0;
        Moneda = #camoneda#2;
        |SI #camoneda#2 = "P";
           MonBase = 1;
        |SINO;
           MonBase = 2;
        |FINSI;
     |SINO;
        Moneda = "P";
        MonBase = 1;
     |FINSI;
     |CIERRA #camoneda;

     |HAZ PideMoneda;

     |SI MonBase = 2;                  || euros
        EURO = 166.386;
        EURODB = 2;
        EURODV = 0;
     |SINO;
        EURO = 1 / 166.386;
        EURODB = 0;
        EURODV = 2;
     |FINSI;

     |SI #0#14 = "P";
          cabe1    = "0307"; || Cabecera
          cabe2    = "0607"; || Lineas Individuales
          cabe3    = "0807"; || Totales
     |SINO;
          cabe1    = "0306"; || Cabecera
          cabe2    = "0606"; || Lineas Individuales
          cabe3    = "0806"; || Totales
     |FINSI;

  |ABRE #2;
  |HAZ leerem;
  |SI swErrorR = 1; |O swErrorR = 2;
      |MENAV "    ERROR !!! TRANSFERENCIA NO CORRECTA ";
      |ACABA;
  |FINSI;

  |HAZ leepas;
  |SI swErrorP ! 0;
      |MENAV "    ERROR !!! CONTROL DE PASE NO CORRECTO ";
      |ACABA;
  |FINSI;

  |HAZ varia_fich;

  |CAMPO_VISUAL #0#10,1,"S"; #0#10 = 0;
  |CAMPO_VISUAL #0#11,1,"S"; #0#11 = 0;
  |CAMPO_VISUAL #0#12,1,"S"; #0#12 = 0;

|| ...................................................
  |ABRE #4;                || Abre Clientes / Proveedores
  |ABRE #5;                || Pagos
  |ABRE #6;                || Iva Soportado

|| Abrir Fichero Secuencial

  |DFICE dirempr;
  fiche = "wb  " + dirempr + "casectra.seq";  || "nomfiche.ext";
  |QBF fiche;
  |FABRE fiche;
  handle = FSalida;
  |SI FSalida ] 0;
      |HAZ cabecera;
      |HAZ regindiv;
      ||   |SI swERROR = 0;
               |HAZ campo_totales;
      ||   |FINSI;
  |FINSI;
  contenido = handle + " " + &#0#9;
  |FGRABA contenido;

  FSalida = handle;
  |FCIERRA FSalida;

  Pos = -1;
  |CIERRA #2;
  |CIERRA #4;
  |CIERRA #5;
  |CIERRA #6;

|| ...   |SI swERROR = 1; |ACABA; |FINSI;

  |D_CUADRO 1261, 2280;
  |ATRI R;
  |PINTA 1362, " Numero Recibos   ";
  |PINTA 1562, " Numero Registros ";
  |PINTA 1762, " Importe Total    ";
  |ATRI 0;
  |PINTA 1462, "                  ";
  |PINTA 1662, "                  ";
  |PINTA 1862, "                  ";
  |D_CUADRO 1961, 2280;
  |ATRI R;
  |PINTA 2062, " Desea grabar el  ";
  |PINTA 2162, " diskete ahora    ";
  |ATRI 0;

  #0#10 = trecibos;  |PINTA #0#10;
  #0#11 = l;         |PINTA #0#11;

  nCalc = EURODB;
  |SI Moneda = "E";
     EURODB = 2;
  |SINO;
     EURODB = 0;
  |FINSI;
  #0#12 = timporte / 100;
  |PINTA #0#12;
  EURODB = nCalc;

  programa = " TRANSFERENCIAS ";
  ficcopia = "transfer.seq";
  E_sup = 1;
  E_inf = "SNsn";
  sino  = "N";
  sino  = 2177 ? 1;
  |SI sino = "S"; |O sino = "s"; |CORRE "cared003.tab"; |FINSI;
|FPRC;

|| ********** Rutinas Varias

|PROCESO LetraDni;
     eaVarDni   = CampoDni;
     enCalcCif  = 3;
     |HAZ CalculoDNI;
     CampoDni = eaVarDni;
     CampoDni = ("000000000" + CampoDni) % -109;
|FPRC;

|PROCESO cccBanco;
 |QBT ccc;
 c_alfa1 = ccc % 0;
 c_nume1 = c_alfa1;
 c_alfa1 = "";
 c_alfa2 = "";
 |PARA c_nume2 = 1; |SI c_nume2 [ c_nume1; |HACIENDO c_nume2 = c_nume2 + 1;
       c_nume3 = c_nume2 * 100 + 1;
       c_alfa2 = ccc % c_nume3;
       |SI c_alfa2 ] "0"; |Y c_alfa2 [ "9";
           c_alfa1 = c_alfa1 + c_alfa2;
       |FINSI;
 |SIGUE;
 ccc = c_alfa1;
|FPRC;

|PROCESO varia_fich;
|| .......... Variables del Presentador, del Ordenante y comunes

  DniEmp = #1#2; |QBF DniEmp;
  DniEmp = ("          " + DniEmp) % -110;

  libre40 = libre * 40;
  Nombre = #1#3 + libre40;     Nombre = Nombre % 136;

  DirEmp = #1#7  + libre40;    DirEmp = DirEmp % 136;

  alfa1 = #1#8; alfa1 = (ceros + alfa1) % -102;
  alfa2 = #1#9; alfa2 = (ceros + alfa2) % -103;

  CpoEmp = alfa1 + alfa2;
  PobEmp = #1#10 + libre40;    PobEmp = PobEmp % 131;

  alfa1 = #0#3;
  dd = alfa1 % A102;
  mm = alfa1 % A402;
  aa = alfa1 % A902;
  || fechapre = aa + mm + dd;   || Fecha Formato a¤o + mes + dia
  fechapre = dd + mm + aa;   || Fecha Formato dia + mes + a¤o VIC 28/09/99

  alfa1 = #0#5;
  dd = alfa1 % A102;
  mm = alfa1 % A402;
  aa = alfa1 % A902;
  || fechapro = aa + mm + dd;   || Fecha Formato a¤o + mes + dia
  fechapro = dd + mm + aa;   || Fecha Formato dia + mes + a¤o VIC 28/09/99
|FPRC;

|CALCULO separa;
  alfa3  = 0;
  numero = 0;
  |QBF direcc;
  alfa1 = direcc % 0;
  longi = alfa1;
  |PARA nume4 = longi; |SI nume4 > 1; |HACIENDO nume4 = nume4 - 1;
        nume2 = (nume4 * 100) + 1;
        alfa2 = direcc % nume2;
        |SI alfa2 = ",";
            nume3  = ((longi - nume4) + 100) * -1;
            alfa3  = direcc % nume3;
            nume2  = (nume4 - 1) + 100;
            direcc = direcc % nume2;
            |SAL;
        |FINSI;
  |SIGUE;
  |QBT alfa3;
  |SI alfa3 ! ""; numero = alfa3; |FINSI;
|FCAL;

|PROCESO MiraVarios;
     |DDEFECTO #caacrval;
     |ABRE #calisfra;
     #calisfra#0  = #camingli#2;   || libro
     #calisfra#1  = #camingli#4;   || serie
     #calisfra#2  = #camingli#3;   || orden
     |LEE 000#calisfra.=;
     |SI FSalida = 0;
          |ABRE #caacrval;
          #caacrval#0 = #calisfra#3;    || cuenta
          #caacrval#1 = #calisfra#4;    || digito
          #caacrval#2 = #calisfra#5;    || linea
          |LEE 000#caacrval.=;
          |SI FSalida ! 0;
               aAlfa1 = "0000Direccion [" + #caacrval#0 + "." + #caacrval#2 + "] Factura [" + #camingli#2 + "." + #camingli#4 + "." + #camingli#3 + "] inaccesible.";
               |MENAV aAlfa1;
          |FINSI;
          |CIERRA #caacrval;
          varios = 1;
     |SINO;
          |SI #camingli#16 ! 0;
               |ABRE #caacrval;
               #caacrval#0 = #camingli#9;    || cuenta
               #caacrval#1 = #camingli#10;   || digito
               #caacrval#2 = #camingli#16;   || linea
               |LEE 000#caacrval.=;
               |SI FSalida ! 0;
                    aAlfa1 = "0000Direccion [" + #caacrval#0 + "." + #caacrval#2 + "] Factura [" + #camingli#2 + "." + #camingli#4 + "." + #camingli#3 + "] inaccesible.";
                    |MENAV aAlfa1;
               |FINSI;
               |CIERRA #caacrval;
               varios = 1;
          |SINO;
               varios = 0;
          |FINSI;
     |FINSI;
     |CIERRA #calisfra;
|FPRC;

|PROCESO PideMoneda;
   |PUSHV 1943 2177;
   |BLANCO 1943 2177;
   |CUADRO 1945 2175;
   |ATRI R; |PINTA 1946 , " Seleccione moneda de emision "; |ATRI N;
   |PINTA 2053, "(Pesetas/Euros)";
   |ATRI I; |PINTA 2054, "P"; |PINTA 2062, "E"; |ATRI N;
   E_sup  = 1;
   E_inf  = "EP";
   |SI MonBase = 1; Moneda = "P"; |SINO; Moneda = "E"; |FINSI;
   Moneda = 2069 ? 0;
   |POPV;
|FPRC;

|PROCESO Conversion;
   |SI MonBase = 1;
      |SI Moneda = "E";
         Cantidad = ((Cantidad / 166.386) ! 2) * 100;
      |SINO;
         Cantidad = Cantidad * 100;
      |FINSI;
   |SINO;
      |SI Moneda = "P";
         Cantidad = (Cantidad * 166.386) ! 0;
      |SINO;
         Cantidad = Cantidad * 100;
      |FINSI;
   |FINSI;
|FPRC;
