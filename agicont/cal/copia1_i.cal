|FICHEROS;
    caagrupa #101;   || agrupaciones
    cacuebal #102;   || cuentas de balance
    caepigra #103;   || epigrafes
    caparbal #104;   || partidas de balance
    caparexp #105;   || partidas de explotacion
|FIN;

|VARIABLES;
    vari1="rb  ";
    fiche="";
    handle="";
    canal= "";
    espacio=" ";
    saber = "";
    menos=-1;
    num = 0;
    field = 0;
    alfa4 = "";
    nCamp5 = 0;
|FIN;

|PROCESO creacion_m;
  alfa4 = "agrupaci";
  |SI nEjerActual ] 2008; alfa4 = "agrupa08"; |FINSI;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";

  |PATH_DAT #101 fich_alta;
  |ABRE #101;
  |CIERRA #101;
  |DELINDEX #101;

  |ABRE #101;
  fiche=vari1 + dir_fich + alfa4;
  |SI nCamp5 = 1;
      fiche = fiche + ".amp";
  |SINO;
      fiche = fiche + ".abr";
  |FINSI;
  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seagru;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ seagru;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #101;
  Pos = menos;

  alfa4 = "cuebalan";
  |SI nEjerActual ] 2008; alfa4 = "cuebal08"; |FINSI;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #102 fich_alta;
  |ABRE #102;
  |CIERRA #102;
  |DELINDEX #102;
  |ABRE #102;
  fiche=vari1 + dir_fich + alfa4;
  |SI nCamp5 = 1;
      fiche = fiche + ".amp";
  |SINO;
      fiche = fiche + ".abr";
  |FINSI;
  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ secueb;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ secueb;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #102;
  Pos = menos;

  alfa4 = "epigrafe";
  |SI nEjerActual ] 2008; alfa4 = "epigra08"; |FINSI;

  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #103 fich_alta;
  |ABRE #103;
  |CIERRA #103;
  |DELINDEX #103;
  |ABRE #103;
  fiche=vari1 + dir_fich + alfa4;
  |SI nCamp5 = 1;
      fiche = fiche + ".amp";
  |SINO;
      fiche = fiche + ".abr";
  |FINSI;
  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seepig;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ seepig;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #103;
  Pos = menos;

  alfa4 = "parbalan";
  |SI nEjerActual ] 2008; alfa4 = "parbal08"; |FINSI;
  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #104 fich_alta;
  |ABRE #104;
  |CIERRA #104;
  |DELINDEX #104;
  |ABRE #104;
  fiche=vari1 + dir_fich + alfa4;
  |SI nCamp5 = 1;
      fiche = fiche + ".amp";
  |SINO;
      fiche = fiche + ".abr";
  |FINSI;
  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ sebala;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ sebala;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #104;
  Pos = menos;

   alfa4 = "parexplo";
   |SI nEjerActual ] 2008; alfa4 = "parexp08"; |FINSI;
  |DBASE dir_fich;
  dir_fich=dir_fich + "fich/";
  |PATH_DAT #105 fich_alta;
  |ABRE #105;
  |CIERRA #105;
  |DELINDEX #105;
  |ABRE #105;
  fiche=vari1 + dir_fich + alfa4;
  |SI nCamp5 = 1;
      fiche = fiche + ".amp";
  |SINO;
      fiche = fiche + ".abr";
  |FINSI;
  |QBF fiche;
  |FABRE fiche;
  |SI FSalida ] 0;
      handle = FSalida;
      |HAZ seexpl;
      |PARA; |SI field > 0; |HACIENDO;
             |HAZ seexpl;
      |SIGUE;
      |FCIERRA handle;
  |FINSI;
  |CIERRA #105;
  Pos = menos;
|FPRC;

|PROCESO seagru;
    canal = handle + espacio;
    canal = canal + 44;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #101#0 = traba;
    traba = canal % 202;
    #101#1 = traba;
|LEE 101#101=;
|SI FSalida = 0;
    |HAZ seagru1;
    |GRABA 020#101a;
|SINO;
    |DDEFECTO #101;
    |HAZ seagru1;
    |GRABA 020#101n;
|FINSI;
|LIBERA #101;
    saber = "Recuperando Agrupacion: " + #101#0 + " " + #101#1 + "         ";
|PINTA 2211,saber;
|FPRC;

|PROCESO seagru1;
    traba = canal %101;
    #101#0 = traba;
    traba = canal %202;
    #101#1 = traba;
    traba = canal % 440;
    #101#2 = traba;
|FPRC;

|PROCESO secueb;
    canal = handle + espacio;
    canal = canal + 21;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 112;
    #102#0 = traba;
|LEE 101#102=;
|SI FSalida = 0;
    |HAZ secueb1;
    |GRABA 020#102a;
|SINO;
    |DDEFECTO #102;
    |HAZ secueb1;
    |GRABA 020#102n;
|FINSI;
|LIBERA #102;
    saber = "Recuperando Cuenta de Balance: " + #102#0 + "           ";
|PINTA 2211,saber;
|FPRC;

|PROCESO secueb1;
    traba = canal %112;
    #102#0 = traba;
    traba = canal %1301;
    #102#1 = traba;
    traba = canal % 1401;
    #102#2 = traba;
    traba = canal %1502;
    #102#3 = traba;
    traba = canal %1702;
    #102#4 = traba;
    traba = canal % 1902;
    #102#5 = traba;
|FPRC;

|PROCESO seepig;
    canal = handle + espacio;
    canal = canal + 86;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #103#0 = traba;
    traba = canal % 202;
    #103#1 = traba;
    traba = canal % 4402;
    #103#3 = traba;
|LEE 101#103=;
|SI FSalida = 0;
    |HAZ seepig1;
    |GRABA 020#103a;
|SINO;
    |DDEFECTO #103;
    |HAZ seepig1;
    |GRABA 020#103n;
|FINSI;
|LIBERA #103;
    saber = "Recuperando Epigrafe: " + #103#0 + "  " + #103#1 + " " + #103#3 + "        ";
|PINTA 2211,saber;
|FPRC;

|PROCESO seepig1;
    traba = canal % 101;
    #103#0 = traba;
    traba = canal % 202;
    #103#1 = traba;
    traba = canal % 4402;
    #103#3 = traba;
    traba = canal % 440;
    #103#2 = traba;
    traba = canal % 4640;
    #103#4 = traba;
|FPRC;

|PROCESO sebala;
    canal = handle + espacio;
    canal = canal + 128;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #104#0 = traba;
    traba = canal % 202;
    #104#1 = traba;
    traba = canal % 4402;
    #104#3 = traba;
    traba = canal % 8602;
    #104#5 = traba;
|LEE 101#104=;
|SI FSalida = 0;
    |HAZ sebala1;
    |GRABA 020#104a;
|SINO;
    |DDEFECTO #104;
    |HAZ sebala1;
    |GRABA 020#104n;
|FINSI;
|LIBERA #104;
    saber = "Rec. Partidas Balance: " + #104#0 + "  " + #104#1 + " " + #104#3 + " " + #104#5 + "       ";
|PINTA 2211,saber;
|FPRC;

|PROCESO sebala1;
    traba = canal % 101;
    #104#0 = traba;
    traba = canal % 202;
    #104#1 = traba;
    traba = canal % 4402;
    #104#3 = traba;
    traba = canal % 8602;
    #104#5 = traba;
    traba = canal % 440;
    #104#2 = traba;
    traba = canal % 4640;
    #104#4 = traba;
    traba = canal % 8840;
    #104#6 = traba;
|FPRC;

|PROCESO seexpl;
    canal = handle + espacio;
    canal = canal + 129;
|FLEE canal;
    field = FSalida;
|SI field [ 0;  |ACABA;  |FINSI;
    traba = canal % 101;
    #105#0 = traba;
    traba = canal % 201;
    #105#1 = traba;
    traba = canal % 302;
    #105#2 = traba;
    traba = canal % 4502;
    #105#4 = traba;
    traba = canal % 8702;
    #105#6 = traba;
|LEE 101#105=;
|SI FSalida = 0;
    |HAZ seexpl1;
    |GRABA 020#105a;
|SINO;
    |DDEFECTO #105;
    |HAZ seexpl1;
    |GRABA 020#105n;
|FINSI;
|LIBERA #105;
    saber = "Rec. Partidas Explotacion: " + #105#0 + "  " + #105#1 + " " + #105#2 + " " + #105#4 + " " + #105#6;
|PINTA 2211,saber;
|FPRC;

|PROCESO seexpl1;
    traba = canal % 101;
    #105#0 = traba;
    traba = canal % 201;
    #105#1 = traba;
    traba = canal % 302;
    #105#2 = traba;
    traba = canal % 4502;
    #105#4 = traba;
    traba = canal % 8702;
    #105#6 = traba;
    traba = canal % 540;
    #105#3 = traba;
    traba = canal % 4740;
    #105#5 = traba;
    traba = canal % 8940;
    #105#7 = traba;
|FPRC;
