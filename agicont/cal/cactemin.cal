|FICHEROS;
    cactemin #00;   ||  el #5 y el #8 estan reservados para los 'INCLUYE'
    camaasic #02;   || /para 'cacuenta' y 'catradia' respect.
    camaasil #03;
    camingca #06;
    camingli #07;
    camandia #10;
    cacuebal #11;
    camanpag #14;
    caivasop #13;

    caivaasi #210;
    ca8m0002 #422;
|FIN;

|VARIABLES;
    &enDiario   = 0;
    &enContador = 0;
    &entrada = 1;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    alfa5 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;

    SwError = 0;

    diar = 0;
    fech = @;
    asie = 0;
    apun = 0;
    cuen = "";
    digi = 0;
    sign = "";
    ptas = 0;
    conc = 0;
    desc = "";

    sw = 0;
    estado = 0;

    VtoAnt = "";
    PrimProv = 0;
    PrimBanc = 0;
    CtaAnt = "";
    ptasbanco = 0;
    ptasprov  = 0;
    LinAnt    = 0;
    GrabaBanco = 0;

    VtoIni = @; VtoFin = @;
    aCampo1 = "";
    aCampo2 = "";
    aCampo3 = "";

    depar   = "";
    deparT  = "";
    deparL  = "";
    swdepar = 0;
    &enEjerBal = 0;
|FIN;

|INCLUYE varnue_i;
|INCLUYE inicio_i;
|INCLUYE actcta_i;
|INCLUYE defec1_i;

|| ************************************************************************
|| *********** CALCULOS PANTALLA ******************************************
|| ************************************************************************
|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
  |SI Campo = 8;
      |SI #0#8 = "S"; |C_M #0#9,1,"N"; |FINSI;
      |SI #0#8 = "N"; |C_M #0#9,1,"S"; |FINSI;
  |FINSI;
|FPRC;

|PROCESO limite; |TIPO 0;
 |C_M #0#9,0,alfa1;
 |SI alfa1 = "N"; |ACABA; |FINSI;
 |SI #0Campo< fec1; |O #0Campo > fec2;
     |MENAV "    ATENCION!!! La fecha no corresponde al ejercicio contable ...";
     |ERROR;
 |FINSI;
|FPRC;

|PROCESO final; |TIPO 7;
 |PTEC 816;
|FPRC;

|| ************************************************************************
|PROCESO banco;
||  apun = apun + 10;

  cuen  = #6#4;
  digi  = #6#5;             || apunte del banco
  sign  = "H";
  conc  = #0#10;
  alfa2 = #0#11; |QBF alfa2;
  alfa1 = #6#0;  alfa1 = "00000" + alfa1;  alfa1 = alfa1 % -106;
  desc = alfa2 + " " + alfa1;
  |SI #0#7 = 2; |O #0#17 = "S";
      depar = deparL;
  |SINO;
      depar = deparT;
  |FINSI;
  |HAZ lineas;
|FPRC;


|PROCESO MiraFra;
 |ABRE #13;
 |DDEFECTO #13;
 #13#0  = #camanpag#0;  || Libro
 #13#27 = #camanpag#2;  || Serie
 #13#2  = #camanpag#1;  || Factura
 |LEE 001#13=;
 |CIERRA #13;
 deparL = #13#49;
 |SI swdepar = 0;
     swdepar = 1;
     deparT = deparL;
 |FINSI;
 |SI deparT ! deparL; deparT = "00"; |FINSI;
|FPRC;

|PROCESO proveedor;
 |SI #camingli#7 < #0#2; |O #camingli#7 > #0#3; |ACABA; |FINSI;

 |SI #cactemin#17 = "S";
    |SI #cactemin#7 = "1";
        |SI VtoAnt ! #camingli#7; |O CtaAnt ! #camingli#9; |O LinAnt ! #camingli#16;
          |SI GrabaBanco = 1;
              ptas = ptasbanco;
              |HAZ banco;
              ptasbanco = 0;
          |SINO;
              GrabaBanco = 1;
          |FINSI;
          enDiario = #0#6;
          |HAZ contador;
          |SI #0#8 = "S"; fech = #6#2; |FINSI;
          asie = enContador;
          apun = 1;
       |FINSI;
    |SINO;
       |SI VtoAnt ! #camingli#7; |O CtaAnt ! #camingli#9; |O LinAnt ! #camingli#16;
           enDiario = #0#6;
           |HAZ contador;
           |SI #0#8 = "S"; fech = #6#2; |FINSI;
           asie = enContador;
           apun = 1;
       |FINSI;
    |FINSI;
    VtoAnt = #camingli#7; |QBF VtoAnt;
    CtaAnt = #camingli#9;
    LinAnt = #camingli#16;
 |SINO;
    |SI sw = 0;
       sw = 1;
       enDiario = #0#6;
       |HAZ contador;
       |SI #0#8 = "S"; fech = #6#2; |FINSI;
       asie = enContador;
       apun = 1;
    |FINSI;
 |FINSI;

 cuen = #7#9;
 digi = #7#10;
 sign = "D";
 ptas = #7#8;
 conc  = #0#12;
 alfa2 = #0#13; |QBF alfa2;
 |ABRE #camanpag;
 #camanpag#0 = #camingli#2;
 #camanpag#2 = #camingli#4;
 #camanpag#1 = #camingli#3;
 #camanpag#3 = #camingli#5;
 |LEE 010#camanpag.=;
 |SI FSalida = 0;
     alfa1 = #camanpag#28; |QBF alfa1;
     |HAZ MiraFra;
 |SINO;
     deparL = "";
     alfa1 = #7#4 + aCampo2; |QBF alfa1;
     alfa4 = #7#3;
     |SI aCampo3 = "S"; alfa4 = ("000000" + alfa4) % -106; |FINSI;
     alfa1 = alfa1 + alfa4; |QBF alfa1;
 |FINSI;
 |CIERRA #camanpag;

 alfa1 = " " + alfa1;
 desc =  alfa2 + alfa1;
 depar = deparL;
 |HAZ lineas;
 #camingli#14 = "S"; |GRABA 020#camingli.a;

 |SI #cactemin#17 = "S";
    |SI #cactemin#7 = "1";
       ptasbanco = ptasbanco + #7#8;
    |SINO;
       ptas = #7#8;
       apun = apun + 10;
       |HAZ banco;
    |FINSI;
 |SINO;
    |SI #cactemin#7 = "1";
       ptasbanco = ptasbanco + #7#8;
    |SINO;
       ptas = #7#8;
       apun = apun + 10;
       |HAZ banco;
       GrabaBanco = 0;
    |FINSI;
 |FINSI;

 apun = apun + 10;

|FPRC;

|DEFBUCLE proveedor;
 #camingli#2;
 14;
 #camingca#0,"01.01.1900","            ",001,"N";
 #camingca#0,"31.12.2999","zzzzzzzzzzzz",999,"N";
 ;
 NULL,proveedor;
|FIN;

|PROCESO MiraSiEntera;
   |SI #camingli#14 = "N"; SwError = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE MiraSiEntera;
#camingli#1;
;
#camingca#0,001;
#camingca#0,999;
;
NULL,MiraSiEntera;
|FIN;

|PROCESO contab1;   || controla la grabacion de apuntes
    |SI #6#10 = "N"; |ACABA; |FINSI;

    swdepar = 0;
    deparT  = "";

    sw = 0;
    |BUCLE proveedor;
    |SI #cactemin#17 = "S";
        |SI GrabaBanco = 1;
            ptas = ptasbanco;
            |HAZ banco;
            ptasbanco = 0;
            GrabaBanco = 0;
        |FINSI;
    |SINO;
       ptas = ptasbanco;
       |SI ptasbanco ! 0; |HAZ banco; ptasbanco = 0; |FINSI;
    |FINSI;

    SwError = 0;
    |BUCLE MiraSiEntera;
    |SI SwError = 0;
       #6#11 = "S";      || contabilizada
       |GRABA 020#6a;
    |FINSI;
    |LIBERA #6;
|FPRC;

|DEFBUCLE cacterem0;
 #6#1;
 2,3,11;
 #0#0, VtoIni, #0#4, "N";
 #0#1, VtoFin, #0#5, "N";
 be;
 NULL, contab1;
|FIN;

|| **************************************************************************
|PROCESO LeeCaivaasi;
 |ABRE #210;
 |DDEFECTO #210;
 |LEE 001#210p;
 |CIERRA #210;
 aCampo1 = #210#45;
 aCampo2 = #210#48;
 aCampo3 = #210#49;
|FPRC;

|PROCESO proceso; |TIPO 3;
 |SI #30#26 < 80;
     enEjercicio = 2000 + #30#26;
 |SINO;
     enEjercicio = 1900 + #30#26;
 |FINSI;

  || .................. Abre fichero Auxiliar de Cuentas
    |ABRE #8;
    |LEE 101#8u;
    |SI FSalida ! 0;
        |DDEFECTO #8;
        #8#0 = 1;
    |SINO;
        #8#0 = #8#0 + 1;
    |FINSI;
    |GRABA 101#8n;
    codcon = #8#0;
    |LIBERA #8;
    |CIERRA #8;
  || ----------------------------------------------------------
  |HAZ LeeCaivaasi;

 |ABRE #2;
 |ABRE #3;

 diar = #0#6;
 fech = #0#9;

 |SI #0#17 = "S";
    VtoIni = "01.01.1900";
    VtoFin = "31.12.2999";
 |SINO;
    VtoIni = #0#2;
    VtoFin = #0#3;
 |FINSI;

 |BUCLE cacterem0;
 |CIERRA #2;
 |CIERRA #3;

 || ............... Terminar
 |SI modcon = 0;
      |ABRET #8
      |DDEFECTO #8;
      #8#0 = codcon;
      |LEE 040#8=;
      |BORRA 101#8a;
      |CIERRAT #8;
 |SINO;
      |CORRE "camaapua.tab"
 |FINSI;

|FPRC;

|| ************************************************************************
|PROCESO lineas;    || graba apunte

    #0#14 = #6#0;   |PINTA #0#14;
    #0#15 = asie;   |PINTA #0#15;
    #0#16 = apun;   |PINTA #0#16;

    |DDEFECTO #3;
    #3#00 = diar;   || diario
    #3#01 = fech;   || fecha
    #3#02 = asie;   || asiento
    #3#03 = apun;   || apunte
    #3#04 = cuen;   || cuenta
    #3#05 = digi;   || digito
    |SI conc = #0#12;
       #3#06 = #0#18;   || concepto
    |SINO;
       #3#06 = conc;   || concepto
    |FINSI;
    #3#07 = desc;   || descripcion
    #3#08 = sign;   || signo
    #3#09 = ptas;   || importe
    |SI #3#08 = "D";
        #3#16 = #3#4;
        #3#17 = #3#5;
        #3#10 = "";
        #3#11 = 0;
    |SINO;
        #3#16 = "";
        #3#17 = 0;
        #3#10 = #3#4;
        #3#11 = #3#5;
    |FINSI;
    #3#21 = depar;
    |GRABA 020#3n;
    |HAZ cabecera;           || cabecera apunte
    ressum = #3#9;
    |HAZ actualiz1;          || cuenta
    |HAZ actualiz3;          || diario
    opera = "A";
    |HAZ altatra;            || subniveles
|FPRC;

|PROCESO cabecera;       || actualiza cabeceras
 |DDEFECTO #2;
 #2#00 = #3#0; ||  diario
 #2#01 = #3#1; ||  fecha
 #2#02 = #3#2; ||  documento
 #2#03 = #3#2; ||  asiento
 |LEE 101#2=;
 estado = FSalida;
 |SI #3#08 = "D";
     #2#04 = #2#04 + #3#09;
     |SI #2#09 = 0; #2#08 = #3#4; #2#09 = #3#5; |FINSI;  || contrp.HABER
 |SINO;
     #2#05 = #2#05 + #3#09;
     |SI #2#11 = 0; #2#10 = #3#4; #2#11 = #3#5; |FINSI;  || contrp.DEBE
 |FINSI;
 #2#6 = #2#4 - #2#5;      || saldo
 |SI estado = 0;  |GRABA 020#2a;  |FINSI;
 |SI estado ! 0;  |GRABA 020#2n;  |FINSI;
 |LIBERA #2;
|FPRC;

|PROCESO actualiz3;
 |ABRE #10;
 #10#0 = #3#0;
 |LEE 121#10=;
 |SI FSalida ! 0;
     |DDEFECTO #10;
     #10#0 = #3#0;
     #10#1 = "<DIARIO SIN DEFINIR>";
     |GRABA 020#10b;
 |FINSI;
 |SI #3#8 = "D";  #10#2 = #10#2 + #3#9;  |FINSI;
 |SI #3#8 = "H";  #10#3 = #10#3 + #3#9;  |FINSI;
 |GRABA 020#10a;
 |LIBERA #10;
 |CIERRA #10;
|FPRC;

|PROCESO cuenta;    || comprueba si la cuenta esta dada de alta
 |ABRE #5;
 #5#0 = cuen;
 #5#1 = digi;
 |LEE 001#5=;
 |SI FSalida ! 0;
     |DDEFECTO #5;
     #5#0 = cuen;
     #5#1 = digi;
     |HAZ defect1;
     |PUSHV 0501 2380;
     |PINPA #0#5;
     |PINDA #0#5;
     |ENDATOS #1#5;
     |GRABA 020#5n;
     |POPV;
 |FINSI;
 |CIERRA #5;
|FPRC;

|| --------------------------------------------------------------------
