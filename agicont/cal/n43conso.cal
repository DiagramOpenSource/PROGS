|FICHEROS;
    n43conso #0;  || Proceso Consolidacion
    n43consl #1;  || consolidados.
    n43datos #2;  || Datos Recepcionados.
    camaasil #3;  || Movimientos Contables.
    cacuenta #10;
|FIN;

|VARIABLES;
   &entrada = 0;
   cuenta1 = "            ";
   cuenta2 = "zzzzzzzzzzzz";
   swgraba = 0;
   contador = 0;
   nNorma = 0;
   nApunt = 0;

   nPara1 = 0;
   aAlfa1 = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;

|PROCESO defecto; |TIPO 7;
 #0#0 = fec1; |PINTA #0#0;
 #0#1 = fec2; |PINTA #0#1;
|FPRC;

|PROCESO Parrilla;
 |SI #0#2 = "S";
     |C_M #0#3, 1, "S";
     |C_M #0#4, 1, "S";
     |PARA nPara1 = 5; |SI nPara1 [ 13; |HACIENDO nPara1 = nPara1 + 1;
           #0nPara1 = ""; |PINTA #0nPara1;
           |C_M #0nPara1, 1, "N";
     |SIGUE;
 |SINO;
     |C_M #0#3, 1, "N"; #0#3 = ""; |PINTA #0#3;
     |C_M #0#4, 1, "N"; #0#4 = "z" * 12; |PINTA #0#4
     |PARA nPara1 = 5; |SI nPara1 [ 13; |HACIENDO nPara1 = nPara1 + 1;
           |C_M #0nPara1, 1, "S";
     |SIGUE;
 |FINSI;
|FPRC;

|PROCESO cuefin;
  |C_M #0Campo, 0, aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

   entrada = 1;
   p_alfa1 = #0Campo;
   salidas = FSalida;
   |HAZ punto;
|FPRC;

|CALCULO cuentas;
 |PINTA 1924,#2#1;|PINTA 2024,#2#2;|PINTA 2124,#2#7;|PINTA 2224,#2#6;
 |PINTA 1943,#3#4;|PINTA 2043,#3#1;|PINTA 2143,#3#9;|PINTA 2243,#3#8;
 #1#10  = #3#4; ||Cuenta Apunte;
 #1#11  = #3#5; ||Digito;
 #1#12  = #3#1; ||Fecha Apunte;
 #1#13  = #3#2; ||Documento Apunte;
 |LEE 040#1=;  ||Lee Fichero Consolidaciones;
 |SI FSalida ! 0;
     nApunt = #3#9 ! EURODB;
     nNorma = #2#7 ! EURODB;
     |SI #3#8 = #2#6; |Y nApunt = nNorma; |Y #3#18 = " ";
         contador = contador + 1;
         #1#0  = contador; #1#1  = #2#0; #1#2  = #2#1;  #1#3  = #2#2;
         #1#4  = #2#3;     #1#5  = #2#4; #1#6  = #2#5;  #1#7  = #2#6;
         #1#8  = #2#7;     #1#9  = #2#8;

         #1#10 = #3#4;     #1#11 = #3#5; #1#12 = #3#1;  #1#13 = #3#2;
         #1#14 = #3#6;     #1#15 = #3#7; #1#16 = #3#8;  #1#17 = #3#9;
         #1#18 = #3#0;     #1#19 = #3#3;

         || Consolidacion uno a uno
         #3#18 = "S";
         |GRABA 020#3a;

         |GRABA 040#1n;
          #2#9 = "S";

         |GRABA 020#2a;
         |ERROR10;
         swgraba = 1;
     |FINSI;
 |SINO;
           nApunt = #3#9 ! EURODB;
           nNorma = #2#7 ! EURODB;
           |SI #3#8 = #2#6; |Y nApunt = nNorma; |Y #3#18 = " "; |Y #1#19 ! #3#3;
             contador = contador + 1;
             #1#0  = contador; #1#1  = #2#0; #1#2  = #2#1;  #1#3  = #2#2;
             #1#4  = #2#3;     #1#5  = #2#4; #1#6  = #2#5;  #1#7  = #2#6;
             #1#8  = #2#7;     #1#9  = #2#8;

             #1#10 = #3#4;     #1#11 = #3#5; #1#12 = #3#1;  #1#13 = #3#2;
             #1#14 = #3#6;     #1#15 = #3#7; #1#16 = #3#8;  #1#17 = #3#9;
             #1#18 = #3#0;     #1#19 = #3#3;

             || Consolidacion uno a uno
             #3#18 = "S";
             |GRABA 020#3a;

             |GRABA 040#1n;
             #2#9 = "S";
             |GRABA 020#2a;
             |ERROR10;
             swgraba = 1;
           |FINSI;
     |FINSI;
  |LIBERA #3;
|FCAL;

|DEFBUCLE cplinmov;
 #3#3;
 ;
 #2#1,0,#0#0,000000;
 #2#1,9,#0#1,999999;
 be;
 NULL,cuentas;
|FIN;

|CALCULO entrada;
 |SI #2#9 = "N";
     |BUCLE cplinmov;
 |FINSI;
 |LIBERA #2;
|FCAL;

|DEFBUCLE cpentrad;
 #2#3;
 ;
 cuenta1, #0#0;
 cuenta2, #0#1;
 be;
 NULL,entrada;
|FIN;
|| --------------------------------------------------------


|PROCESO PongoIgual;
  #3#18 = " ";
  |GRABA 020#3a;
  |LIBERA #3;
|FPRC;

|DEFBUCLE PongoIgual;
 #3#1;
 18;
 00,"01.01.0000", 000001, 0001, "S";
 99,"31.12.2099", 999999, 9999, "S";
 be;
 NULL,PongoIgual;
|FIN;

|CALCULO uno;
swgraba = 0;
|ABRE #3;         ||Lineas Movimiento Diario;
|SELECT #2#3;
  |LEE 040#3p;
    |SI FSalida = 0;
       |HAZ cuentas;
|ET otro;
|SI swgraba = 0;
  |LEE 040#3s;
        |SI FSalida = 0;
           |HAZ cuentas;
             |VETE otro;
        |FINSI;
|FINSI;
    |FINSI;
|CIERRA #3;
|FCAL;

|PROCESO HazTodo;
  |BUCLE cpentrad;           || Bucle entrada;
  |BUCLE PongoIgual;
|FPRC;

|CALCULO pase;|TIPO 3;

  |ABRE #1;
  |LEE 040#1u;
  contador = #1#0;
  |SELECT #3#1;

  |SI #0#2 = "S";
      cuenta1 = #0#3;
      cuenta2 = #0#4;
      |HAZ HazTodo;
  |SINO;
      |PARA nPara1 = 5; |SI nPara1 [ 13; |HACIENDO nPara1 = nPara1 + 1;
            aAlfa1 = #0nPara1; |QBF aAlfa1;
            |SI aAlfa1 ! "";
                cuenta1 = #0nPara1;
                cuenta2 = #0nPara1;
                |HAZ HazTodo;
            |FINSI;
      |SIGUE;
  |FINSI;
  |CIERRA #1;

|FCAL;
