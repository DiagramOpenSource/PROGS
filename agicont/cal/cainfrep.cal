|FICHEROS;
     cainfrep #0;
     camancob #1;
     caclipro #2;
     caivarep #3;
     cacuenta #5;
     canempre #6;
     carepres #7;
     caw00005 #99;
|FIN;

|INCLUYE acceso_i;

|VARIABLES;
     nCampo1     = 0;
     nCampo2     = 0;
     nEmpresaAct = 0;
     nEjercicAct = 0;
     nEmpresa    = 0;
     nImpor      = 0;

     aTempo  = "";
     aAlfa   = "";
     aRepre  = "";

   {-1}aMenu  = "";
       aMenu1 = "2400";
       aMenu2 = "1";
       aMenu3 = " Elija opcion: ";
       aMenu4 = "RD";
       aMenu5 = " Resumido ";
       aMenu6 = " Detallado ";

       PonEmp = 0;
       Linea = 0;
       Cont = 0;
       Testigo = 0;
       &EmpreAnt = 0;
       &EjercAnt = 0;
       &TotalCli = 0;
       &TotalEmp = 0;
       &TotalRep = 0;
       &LinCta = 0;
       &LinFac = 0;
       &TotalCta = 0;
       CuentaAnt = "";
       CobroAnt = 0;
       Primero = 0;
       Segundo = 0;
       &Tercero = 0;
       Cuarto = 0;
       &OrEmp = 0;
       &PeEmp = 0;
       &CoEmp = 0;
       &OrCli = 0;
       &PeCli = 0;
       &CoCli = 0;
       &OrRep = 0;
       &PeRep = 0;
       &CoRep = 0;
       &sw_inf = 0;

     Parte1 = "";
     Parte2 = "";
     Posic1 = 0;
     Posic2 = 0;
     Comodin = "";
     Long = "";
     LongNum = 0;
     FEstado = 0;
     MaxDig = 0;

     HayDatos = 0;
|FIN;

|PROCESO Mayor;
    #0Campo = #0Campo > #0Campo;
    |PINTA #0Campo;
|FPRC;

|PROCESO Empresa;
     nCampo1 = Campo - 1;
     nCampo2 = Campo;
     |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
         |ABRE #6;
         #6#2 = #0nCampo1;
         #6#3 = #0nCampo2;
         |LEE 040#6=;
         |SI FSalida ! 0;
             |MENAV "    No existe Empresa Contable";
             #0nCampo1 = 0;  |PINTA #0nCampo1;
             #0nCampo2 = 0;  |PINTA #0nCampo2;
             |PTEC 808;
             |PTEC 808;
         |FINSI;
         |CIERRA #6;
     |FINSI;
|FPRC;

|PROCESO GrabaTempo;
     |SI #cainfrep#27 = "S";
        Testigo = 0;
        |PARA Cont = 28; |SI Cont [ 37; |HACIENDO Cont = Cont + 1;
           |SI #camancob#11 = #cainfrep#Cont#;
              Testigo = 1;
              |SAL;
           |FINSI;
        |SIGUE;
        |SI Testigo = 0; |ACABA; |FINSI;
     |SINO;
        |SI #camancob#11 < #0#12; |O #camancob#11 > #0#13; |ACABA; |FINSI;
     |FINSI;

     |SI #cainfrep#38 = "S";
        Testigo = 0;
        |PARA Cont = 39; |SI Cont [ 48; |HACIENDO Cont = Cont + 1;
           |SI #camancob#28 = #cainfrep#Cont#;
              Testigo = 1;
              |SAL;
           |FINSI;
        |SIGUE;
        |SI Testigo = 0; |ACABA; |FINSI;
     |SINO;
        |SI #camancob#28 < #0#15; |O #camancob#28 > #0#16; |ACABA; |FINSI;
     |FINSI;

||     |SI #0#14 = "T";
||         nImpor = #1#8;
          nImpor = #1#24;
||     |FINSI;

||     |SI #0#14 = "S";
||         nImpor = #1#24;
||         |SI #1#24 = 0;  |ACABA;  |FINSI;
||     |FINSI;

||     |SI #0#14 = "N";
||         nImpor = #1#8 - #1#24;
||         |SI nImpor = 0; |O #1#23 = "S";   |ACABA;  |FINSI;
||     |FINSI;

     |SI #0#14 = "S"; |Y #1#23 = "N";
          |ACABA;
     |FINSI;
     |SI #0#14 = "N"; |Y #1#23 = "S";
          |ACABA;
     |FINSI;
     |DDEFECTO #99;
     #99#0  = #1#28;         || Representante
     #99#1  = #1#4;          || Cuenta Cliente
     #99#2  = #1#5;          || Digito Cuenta Cliente
     #99#3  = nEmpresa;
     |SI aMenu2 = "2";
         #99#4  = #1#0;      || Libro
         #99#5  = #1#1;      || Factura
         #99#6  = #1#2;      || Serie
         #99#7  = #1#3;      || Numero de Cobro
     |FINSI;
     |LEE 101#99=;
     |SI FSalida = 0;
         #99#8  = #99#8 + #1#26;
         #99#10 = #99#10 + nImpor;
         #99#9  = #99#8  - #99#10;
         #99#13 = #1#11;
         |GRABA 020#99a;
     |SINO;
         #99#8  = #99#8 + #1#26;
         #99#10 = #99#10 + nImpor;
         #99#9  = #99#8 - #99#10;
         #99#13 = #1#11;
         |GRABA 020#99n;
     |FINSI;
     |LIBERA #99;
|FPRC;


|DEFBUCLE camancob;
     #1#6;
     0, 1, 3, 11; || selecciona libro+factura+cobro+tipo recibo
     "  ", #0#4, 0, #0#6, #0#0 , #0#2 ,   0, 00;
     "zz", #0#5, 9, #0#7, #0#1 , #0#3 , 999, 99;
     ;
     NULL, GrabaTempo;
|FIN;

|PROCESO Imprimir;

   OrEmp = OrEmp + #99#8;
   PeEmp = PeEmp + #99#9;
   CoEmp = CoEmp + #99#10;

   OrCli = OrCli + #99#8;
   PeCli = PeCli + #99#9;
   CoCli = CoCli + #99#10;

   OrRep = OrRep + #99#8;
   PeRep = PeRep + #99#9;
   CoRep = CoRep + #99#10;

   |HAZ BuscaDatos;

   |SI Primero = 1;
      LinCta = 1;
      LinFac = 1;
      TotalEmp = 0;
      TotalCli = 0;
      TotalRep = 0;
      CuentaAnt = #99#1;
      CobroAnt  = #99#7;
      EmpreAnt = nEmpresaAct;
      EjercAnt = nEjercicAct;
      Primero = 0;
   |FINSI;

   |SI aRepre = "";
      aRepre = #99#0;
   |FINSI;

   |SI aRepre ! #99#0;
      TotalCli = 1;
      TotalEmp = 0;
      LinFac = 0;
      Segundo = 1;
      Tercero = 1;
      sw_inf = 99;
      |PRINT;
      |PIEINF;
      LinFac = 1;
      TotalCli = 0;
      OrCli = #99#8;
      PeCli = #99#9;
      CoCli = #99#10;
      aRepre = #99#0;
      EmpreAnt = nEmpresaAct;
      EjercAnt = nEjercicAct;
      CuentaAnt = #99#1;
      OrRep = #99#8;
      PeRep = #99#9;
      CoRep = #99#10;
   |SINO;
      |SI EmpreAnt ! #99#11; |O EjercAnt ! #99#12;
          |SI Segundo = 0;
               sw_inf = 1;
               TotalEmp = 1;
               LinFac = 0;
               TotalCli = 0;
               TotalRep = 0;
               |HAZ BuscaDatos;
               |PRINT;
               Linea = 1;
          |FINSI;
          sw_inf = 2;
          OrEmp = #99#8;
          PeEmp = #99#9;
          CoEmp = #99#10;
          EmpreAnt = #99#11;
          EjercAnt = #99#12;
          LinFac = 1;
          |SI Linea ! 0; |PRINT; |FINSI;
          sw_inf = 0;
          |SI Linea ! 0; |PRINT; |FINSI;
          Linea = 0;
      |SINO;
        Linea = 1;
        TotalEmp = 0;
        |SI CuentaAnt ! #99#1;|O #99#7 ! CobroAnt;
            |SI Tercero = 0;|Y CuentaAnt ! #99#1;
                sw_inf = 5;
                |PRINT;
                |PIEINF;
                sw_inf = 2;
                |HAZ BuscaDatos;
                |PRINT;
            |FINSI;
            sw_inf = 0;
            TotalCli = 0;
            OrCli = #99#8;
            PeCli = #99#9;
            CoCli = #99#10;
            LinCta = 1;
            LinFac = 1;
            CuentaAnt = #99#1;
            CobroAnt  = #99#7;
            |PRINT;
        |SINO;
            LinCta = 0;
            LinFac = 1;
            |SI #0#38 = "S"; |Y Linea ! 0;
               |SI PonEmp = 1; |PRINT; |FINSI;
            |FINSI;
        |FINSI;
      |FINSI;
   |FINSI;

   |SI Segundo = 1;
          sw_inf = 1;
          |PRINT;
          sw_inf = 0;
          Segundo = 0;
          Cuarto = 1;
          PonEmp = 1;
   |FINSI;

   |SI Tercero = 1;
          sw_inf = 2;
          |PRINT;
          sw_inf = 0;
          Tercero = 0;
          Cuarto = 1;
   |FINSI;

   |SI Cuarto = 1
          |HAZ BuscaDatos;
          OrCli = #99#8;
          PeCli = #99#9;
          CoCli = #99#10;
          OrEmp = #99#8;
          PeEmp = #99#9;
          CoEmp = #99#10;
          OrRep = #99#8;
          PeRep = #99#9;
          CoRep = #99#10;
          |PRINT;
          Cuarto = 0;
   |FINSI;

   |SI TotalCli = 1;
        OrCli = 0;
        PeCli = 0;
        CoCli = 0;
   |FINSI;
|FPRC;

|PROCESO BuscaDatos;
     aAlfa = "";
     |DBASE aAlfa;  |QBT aAlfa;

     |SI #99#3 = 0;
         aAlfa  = aAlfa + "fich/" + (("00000" + nEmpresaAct) % -105) + (("0" + nEjercicAct) % -101) + "/";
         #99#11 = nEmpresaAct;
         #99#12 = nEjercicAct;
     |SINO;
         nCampo1 = (#99#3 * 2) + 15;
         nCampo2 = nCampo1 + 1;
         aAlfa   = aAlfa + "fich/" + (("00000" + #0nCampo1) % -105) + (("0" + #0nCampo2) % -101) + "/";
         #99#11  = #0nCampo1;
         #99#12  = #0nCampo2;
     |FINSI;

     |PATH_DAT #1 aAlfa;
     |PATH_DAT #2 aAlfa;
     |PATH_DAT #3 aAlfa;
     |PATH_DAT #5 aAlfa;
     |PATH_DAT #7 aAlfa;

     |SI aMenu2 = "2";
         |ABRE #1;
         #1#0 = #99#4;
         #1#1 = #99#5;
         #1#2 = #99#6;
         #1#3 = #99#7;
         |LEE 040#1=;
         |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
         |CIERRA #1;

         |ABRE #3;
         #3#0  = #1#0;
         #3#2  = #1#1;
         #3#27 = #1#2;
         |LEE 000#3=;
         |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
         |CIERRA #3;
     |FINSI;

     |ABRE #2;
     |DDEFECTO #2;
     #2#23 = "C";
     #2#10 = #99#1;
     #2#11 = #99#2;
     |LEE 001#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |ABRE #5;
     |DDEFECTO #5;
     #5#0 = #99#1;
     #5#1 = #99#2;
     |LEE 001#5=;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
     |CIERRA #5;

     |ABRE #7;
     |DDEFECTO #7;
     #7#0 = #99#0;
     |LEE 000#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
     |CIERRA #7;
|FPRC;


|PROCESO PieInf;
    sw_inf = 2;
    Tercero = 0;
||    |PRINT;
    sw_inf = 1;
    Segundo = 0;
||    |PRINT;
    sw_inf = 99;
    TotalCli = 1;
    TotalEmp = 0;
    LinFac = 0;
    |PRINT;
    |PIEINF;
|FPRC;

|DEFBUCLE caw00005;
     #99#1;
     ;
     "  ", "            ", 0, 0, 00, 000000, "  ", 000;
     "zz", "zzzzzzzzzzzz", 9, 9, 99, 999999, "zz", 999;
     ;
     NULL, Imprimir, NULL, NULL, PieInf;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |MENU aMenu;
     aMenu2 = FSalida;
     |SI aMenu2 ! "1";  |Y aMenu2 ! "2";  |ACABA;  |FINSI;

     nEmpresaAct = #48#2;
     nEjercicAct = #48#3;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI aMenu2 = "1";  |INFOR "cainf1re";  |FINSI;
     |SI aMenu2 = "2";  |INFOR "cainf2re";  |FINSI;
     |SI FSalida ! 0;   |FINIMP;  |ACABA;   |FINSI;

     aTempo = ("05" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #99 aTempo;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     |ABRE #99;
     nEmpresa = 0;  |BUCLE camancob;

     |PARA nEmpresa = 1;  |SI nEmpresa [ 5;  |HACIENDO nEmpresa = nEmpresa + 1;
           nCampo1 = (nEmpresa * 2) + 15;
           nCampo2 = nCampo1 + 1;
           |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
               aAlfa = "";
               |DBASE aAlfa;  |QBT aAlfa;
               aAlfa = aAlfa + "fich/" + (("00000" + #0nCampo1) % -105) + (("0" + #0nCampo2) % -101) + "/";
               |PATH_DAT #1 aAlfa;

               |BUCLE camancob;
           |FINSI;
     |SIGUE;
     |CIERRA #99;

     Primero = 1;
     Segundo = 1;
     Tercero = 1;
     sw_inf  = 0;
     |BUCLE caw00005;

     |DELINDEX #99;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO MiraSelec;
   |SI Campo = 27;
      |SI #cainfrep#27 = "S";
         |C_M #cainfrep#28,1,"S";
         |C_M #cainfrep#29,1,"S";
         |C_M #cainfrep#30,1,"S";
         |C_M #cainfrep#31,1,"S";
         |C_M #cainfrep#32,1,"S";
         |C_M #cainfrep#33,1,"S";
         |C_M #cainfrep#34,1,"S";
         |C_M #cainfrep#35,1,"S";
         |C_M #cainfrep#36,1,"S";
         |C_M #cainfrep#37,1,"S";
         |C_M #cainfrep#12,1,"N";
         |C_M #cainfrep#13,1,"N";
      |SINO;
         |C_M #cainfrep#28,1,"N";
         |C_M #cainfrep#29,1,"N";
         |C_M #cainfrep#30,1,"N";
         |C_M #cainfrep#31,1,"N";
         |C_M #cainfrep#32,1,"N";
         |C_M #cainfrep#33,1,"N";
         |C_M #cainfrep#34,1,"N";
         |C_M #cainfrep#35,1,"N";
         |C_M #cainfrep#36,1,"N";
         |C_M #cainfrep#37,1,"N";
         |C_M #cainfrep#12,1,"S";
         |C_M #cainfrep#13,1,"S";
      |FINSI;
   |FINSI;
   |SI Campo = 38;
      |SI #cainfrep#38 = "S";
         |C_M #cainfrep#39,1,"S";
         |C_M #cainfrep#40,1,"S";
         |C_M #cainfrep#41,1,"S";
         |C_M #cainfrep#42,1,"S";
         |C_M #cainfrep#43,1,"S";
         |C_M #cainfrep#44,1,"S";
         |C_M #cainfrep#45,1,"S";
         |C_M #cainfrep#46,1,"S";
         |C_M #cainfrep#47,1,"S";
         |C_M #cainfrep#48,1,"S";
         |C_M #cainfrep#15,1,"N";
         |C_M #cainfrep#16,1,"N";
      |SINO;
         |C_M #cainfrep#39,1,"N";
         |C_M #cainfrep#40,1,"N";
         |C_M #cainfrep#41,1,"N";
         |C_M #cainfrep#42,1,"N";
         |C_M #cainfrep#43,1,"N";
         |C_M #cainfrep#44,1,"N";
         |C_M #cainfrep#45,1,"N";
         |C_M #cainfrep#46,1,"N";
         |C_M #cainfrep#47,1,"N";
         |C_M #cainfrep#48,1,"N";
         |C_M #cainfrep#15,1,"S";
         |C_M #cainfrep#16,1,"S";
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Cuenta; |TIPO 6;

   |SI dig4 ! 0; MaxDig = dig4; |FINSI;
   |SI dig5 ! 0; MaxDig = dig5; |FINSI;
   |SI dig6 ! 0; MaxDig = dig6; |FINSI;
   |SI dig7 ! 0; MaxDig = dig7; |FINSI;
   |SI dig8 ! 0; MaxDig = dig8; |FINSI;
   |SI dig9 ! 0; MaxDig = dig9; |FINSI;

   Comodin = #cainfrep#Campo#;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      FEstado = FSalida;
      Posic1 = (FEstado / 100) ! 0;
      Posic1 = Posic1 + 99;
      Posic2 = FEstado + 98;
      Parte1 = Comodin % Posic1;
      Parte2 = Comodin % Posic2;
      |QBF Comodin;
      Long = Comodin % 0;
      LongNum = MaxDig - Long;
      Comodin = "0" * LongNum;
      Comodin = Parte1 + Comodin + Parte2;
      #cainfrep#Campo# = Comodin;
      |PINTA #cainfrep#Campo#;
   |FINSI;
|FPRC;                                                                              |PINTA #capredcb#Campo#;

|PROCESO init; |TIPO 8;
   |HAZ inicio;
|FPRC;
