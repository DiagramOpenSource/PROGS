|FICHEROS;
     caiva300;
     caman303;
     dsm30304,MANTE;
     dsm30305,MANTE;
     caivarep;
     caivasop;
     cacon300;
     caportad;

     dsmow205,MANTE;
     dsmow224,MANTE;
     dsmow227,MANTE;
     dsmow206,MANTE;

     dsmow220,MANTE;
     dsmow221,MANTE;

     eosw0052,MANTE;
     eosma100,MANTE;
     regiva@;
|FIN;

|VARIABLES;
    cont     = 0;
    trime    = 0;
    anyo     = 0;
    activi   = "";
    compen   = 0;
    base     = 0;
    tipo     = 0;
    rendi1   = 0;
    rendi2   = 0;
    penult   = 0;
    estado   = 0;
    ventas   = 0;
    x        = 0;
    camp     = 0;
    xxxxfiac = "  ";
    xxaponer = "  ";
    xrelleno = "                              ";

    t_bassop = 0;
    t_ivasop = 0;
    FEstado  = 0;
    per_ant  = -1;
    x1       = 0;
    x2       = 0;
    x3       = 0;
    x4       = 0;
    x5       = 0;
    &swliq   = 0;
    &eaCampo45 = "";
    &enCampo1  = 0;
    &enCampo2  = 0;
    perio    = 0;
    peria    = 0;
    any      = 0;
    emp      = "";
    emp1     = "";
    FConcep  = 0;
    tot_rec  = 0;
    tot_iva  = 0;
    tot_bas  = 0;
    &compens = 0;

    trim1    = @;
    trim2    = @;
    trim3    = @;
    alfa1    = "";
    alfa2    = "";
    alfa3    = "";
    alfa4    = "";
    antes1   = 0;
    antes2   = 0;
    antes3   = 0;
    antes4   = 0;
    antes5   = 0;
    antes6   = 0;
    antes11  = 0;
    antes12  = 0;
    antes13  = 0;
    antes14  = 0;
    antes15  = 0;
    antes16  = 0;

    sw_exi   = 0;
    &a_emp   = 0;
    &a_per   = 0;
    &ac_pe   = 0;

    frase_d     = "";
    informado_d = "";
    Linea1      = "";
    Linea2      = "";
    Linea3      = "";
    swyacal     = 0;
    nProrratP   = 0;
    nEjer       = 0;
    nModo       = 0;
    aAlfa       = "";

    nBoton340   = -1;

   nCampo       = 0;
   nCampo1      = 0;
   nCampo2      = 0;
   nCampo3      = 0;
   nActividad   = 0;
   nIVA         = 0;
   nTecla       = 0;
   nError       = 0;
   aBase        = "";
   aMas         = "";
   nSwOp        = 0;

   tiva = 0;
   iva  = 0;
   rec  = 0;
   nSwAcum = 0;
   nPara1 = 0;
   nPara2 = 0;
   nPara3 = 0;
   nPorce1 = 0;
   nPorce2 = 0;

   nOk    = 0;
   nSw    = 0;
   nNume  = 0;
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   nBase  = 0;
   nCuota = 0;
   nSubeIVA = 0;
   nPer     = 0;
   nMasBase = 0;
   nPriIVA  = 0;
   aTipo    = "";

   nIVA5    = 0;
   nIVA8    = 0;
   nIVA11   = 0;
   nIVA14   = 0;
   nIVA17   = 0;
   nIVA46   = 0;

   nCampo20 = 0;
   nCampo21 = 0;
   nCampo22 = 0;
   nCampo60 = 0;
   nCampo61 = 0;
   nSwGraba = 0;
   nPerFin  = 0;
   nModi    = 0;
   nMod390  = 0;

   &enNoMod390 = 0;
   &enImpExp   = 0;

 {-1} aMenu     = "";
      aMenu1    = "1518";
      aMenu2    = "1";
      aMenu3    = "3";
      aMenu4    = "Identificacion                                  ";
      aMenu5    = "Regimen General y resultado                     ";
      aMenu6    = "Sujetos Pasivos que quedan exonerados del M.390 ";

 {-1} a390Menu     = "";
      a390Menu1    = "1845";
      a390Menu2    = "1";
      a390Menu3    = "4";
      a390Menu4    = "Actividades declaracion        ";
      a390Menu5    = "Operaciones realizadas         ";
      a390Menu6    = "Prorrata                       ";
      a390Menu7    = "Act.Reg.deduccion diferenciados";

    nDCampo = 0;
    nHCampo = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE varnue_i;

||////////////////////////////////////////////////////////////////////
|PROCESO Graba100_303;
     |SI #caman303#nCampo1# = 0;  |Y #caman303#nCampo2# = 0;
         |ACABA;
     |FINSI;

     |SI nCampo1 > 17; |Y nCampo1 ! 46;
         nIVA = ((#caman303#nCampo2# / #caman303#nCampo1#) * 100) ! 2;
         |SI nIVA ! 16;  |Y nIVA ! 4;  |Y nIVA ! 7;
            |Y nIVA ! 0.5; |Y nIVA ! 1;
              |Y nIVA ! 8; |Y nIVA ! 18;
                |Y nIVA ! 10; |Y nIVA ! 21;
                   |Y nIVA ! 1.40; |Y nIVA ! 5.20;
               nIVA = 0;
         |FINSI;
     |SINO;
         nIVA = #caman303#nCampo3#;
     |FINSI;

     |DDEFECTO #eosma100;
     #eosma100#0 = "303";
     #eosma100#1 = #caman303#0;        || Empresas
     #eosma100#2 = nActividad;         || Actividad
     #eosma100#3 = #caman303#1;        || Periodo
     #eosma100#4 = #caman303#2;        || A¤o
     #eosma100#5 = nCampo1;
     #eosma100#6 = #caman303#nCampo1#;
     #eosma100#7 = nIVA;
     #eosma100#8 = #caman303#nCampo2#;

     |GRABA 020#eosma100.n;
     |LIBERA #eosma100;
|FPRC;

|PROCESO PonerDesglose;
     nSwAcum = 0;
     |PARA nPara1 = 78;  |SI nPara1 [ 91;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #caman303#nPara2#  = nIVA;
               #caman303#nPara1#  = #caman303#nPara1# + nBase;
               #caman303#nPara2#  = nIVA;
               #caman303#nPara3#  = #caman303#nPara3# + nCuota;
               nSwAcum = 1;
               |SAL;
           |FINSI;
           |SI nPara1 = 87; nPara1 = 88; |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 78;  |SI nPara1 [ 91;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #caman303#nPara2# = 0;
                   #caman303#nPara1#  = nBase;
                   #caman303#nPara2#  = nIVA;
                   #caman303#nPara3#  = nCuota;
                   |SAL;
               |FINSI;
               |SI nPara1 = 87; nPara1 = 88; |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO eosm1303V;
     nActividad = 1;
     nCampo1 = 5;  nCampo2 = 7;   nCampo3 = 6;  |HAZ Graba100_303;
     nCampo1 = 8;  nCampo2 = 10;  nCampo3 = 9;  |HAZ Graba100_303;
     nCampo1 = 11; nCampo2 = 13;  nCampo3 = 12; |HAZ Graba100_303;
     nCampo1 = 14; nCampo2 = 16;  nCampo3 = 15; |HAZ Graba100_303;
     nCampo1 = 17; nCampo2 = 19;  nCampo3 = 18; |HAZ Graba100_303;
     nCampo1 = 46; nCampo2 = 48;  nCampo3 = 47; |HAZ Graba100_303;
     nCampo1 = 46; nCampo2 = 48;  nCampo3 = 47; |HAZ Graba100_303;

     |SI nSw = 0;
          nCampo1 = 62;  nCampo2 = 21;   |HAZ Graba100_303;
          nCampo1 = 63;  nCampo2 = 43;   |HAZ Graba100_303;
          nCampo1 = 64;  nCampo2 = 22;   |HAZ Graba100_303;
          nCampo1 = 65;  nCampo2 = 44;   |HAZ Graba100_303;
          nCampo1 = 66;  nCampo2 = 51;   |HAZ Graba100_303;
          nCampo1 = 67;  nCampo2 = 58;   |HAZ Graba100_303;

          |SI #caman303#49 ! 0; |O #caman303#50 ! 0;
               |SI #caman303#78 = 0; |Y #caman303#80 = 0;
                   |Y #caman303#81 = 0; |Y #caman303#83 = 0;
                      |Y #caman303#84 = 0; |Y #caman303#86 = 0;
                         |Y #caman303#87 = 0; |Y #caman303#89 = 0;
                           |Y #caman303#91 = 0; |Y #caman303#93 = 0;

                    nBase = #caman303#49;
                    nIVA = ((#caman303#49 / #caman303#50) * 100) ! 2;
                    |SI nIVA ! 16;  |Y nIVA ! 4;  |Y nIVA ! 7;
                        |Y nIVA ! 1;  |Y nIVA ! 0.5;
                         |Y nIVA ! 18; |Y nIVA ! 8;
                          |Y nIVA ! 21; |Y nIVA ! 10;
                           |Y nIVA ! 1.40; |Y nIVA ! 5.20;
                        nIVA = 0;
                    |FINSI;
                    nCuota = #caman303#50;
                    |HAZ PonerDesglose;
               |FINSI;
               |GRABA 020#caman303.a;
          |FINSI;
     |FINSI;
     |LIBERA #caman303;
|FPRC;

|DEFBUCLE eosm1303V;
     #caman303#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, eosm1303V;
|FIN;

|PROCESO eosma100C;
     nSw = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE eosma100C;
     #eosma100#1;
     ;
     "   ", 00001, 1, 01, 01, 005;
     "zzz", 99999, 6, 12, 99, 011;
     e;
     NULL, eosma100C;
|FIN;

|PROCESO Tipo88;  |TIPO 88;
     nSw = 0;
     |ABRE #eosma100;
     |LEE 000#eosma100.p;
     |SI FSalida ! 0;
         |MENSA "0000 Grabando desglose IVA Compra, espere un momento.";
         |BUCLE eosm1303V;
         |BLIN 04;
     |SINO;
         |CIERRA #eosma100;
         nSw = 0;
         |BUCLE eosma100C;
         |SI nSw = 0;
             |MENSA "0000 Grabando desglose IVA Ventas, espere un momento.";
             |ABRE #eosma100;
             nSw = 1;
             |BUCLE eosm1303V;
             |BLIN 04;
         |FINSI;
     |FINSI;
     |CIERRA #eosma100;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
      |HAZ inicio;
      |HAZ eVarEmpresa;
      |HAZ DatosPortada;
|FPRC;

||////////////////////////////////////////////////////////////////////
|PROCESO DatosPortada;
      |DDEFECTO #caportad;
      |ABRE #caportad;
      #caportad#0 = #30#2;
      #caportad#1 = #30#26;
      |LEE 000#caportad.=;
      |SI FSalida ! 0;
          |MENAV "    No encontrado Fichero Portadas Modelos";
      |SINO;
          #caman303#45     = #caportad#93; |PINTA #caman303#45;
      |FINSI;
      |CIERRA #caportad;
      |SI #caportad#99  [ 0; |O #caportad#99  > 100;  #caportad#99  = 100; |FINSI;
      |SI #caportad#101 [ 0; |O #caportad#101 > 100;  #caportad#101 = 100; |FINSI;

      enNoMod390 = 0;
      |PARA nPara1 = 32; |SI nPara1 [ 37; |HACIENDO nPara1 = nPara1 + 1;

            aAlfa = #caportad#nPara1# - "E"; |QBT aAlfa
            |SI aAlfa = "8612"; |O aAlfa = "8611";
                enNoMod390 = 1;
            |SINO;
                |SI aAlfa ! ""; enNoMod390 = 0; |SAL; |FINSI;
            |FINSI;
      |SIGUE;
      |SI #caportad#93 = "M"; |O #caportad#93 = "D";
           enNoMod390 = 1;
      |FINSI;
|FPRC;

|PROCESO CalTipoyPer;
     aTipo = #caman303#45;
     |SI aTipo = "F";  aTipo = "T";  |FINSI;
     |SI aTipo = "D";  aTipo = "M";  |FINSI;

     nPer = 7;  |SI aTipo = "T"; nPer = 3; |FINSI;
     nSubeIVA  = 0;
     |SI enEjercicio = 2010; |Y #caman303#1 ] nPer;  nSubeIVA = 1;  |FINSI;
     |SI enEjercicio ] 2011;                  nSubeIVA = 1;  |FINSI;

     nPer = 9;  |SI aTipo = "T"; nPer = 3; |FINSI;
     |SI enEjercicio = 2012; |Y #caman303#1 ] nPer;  nSubeIVA = 2;  |FINSI;
     |SI enEjercicio ] 2013;                  nSubeIVA = 2;  |FINSI;
|FPRC;

|PROCESO LeeControl;
     |HAZ CalTipoyPer;
     |ABRE #caiva300;
     |LEE 000#caiva300.p;
     |SI FSalida ! 0;
         |MENAV "    No esta definido el control del IVA ...";
         |ERROR;
         |CIERRA #caiva300;
         |ACABA;
     |FINSI;
     |CIERRA #caiva300;

     |SI nSubeIVA = 2;
         |SI #caiva300#1 = 7;  |O #caiva300#1 = 8;  #caiva300#1 = 10; |FINSI;
         |SI #caiva300#1 = 16; |O #caiva300#1 = 18; #caiva300#1 = 21; |FINSI;
         |SI #caiva300#2 = 7;  |O #caiva300#2 = 8;  #caiva300#2 = 10; |FINSI;
         |SI #caiva300#2 = 16; |O #caiva300#2 = 18; #caiva300#2 = 21; |FINSI;
         |SI #caiva300#3 = 7;  |O #caiva300#3 = 8;  #caiva300#3 = 10; |FINSI;
         |SI #caiva300#3 = 16; |O #caiva300#3 = 18; #caiva300#3 = 21; |FINSI;

         |SI #caiva300#4 = 1;  #caiva300#4 = 1.40; |FINSI;
         |SI #caiva300#4 = 4;  #caiva300#4 = 5.20; |FINSI;
         |SI #caiva300#5 = 1;  #caiva300#5 = 1.40; |FINSI;
         |SI #caiva300#5 = 4;  #caiva300#5 = 5.20; |FINSI;
         |SI #caiva300#6 = 1;  #caiva300#6 = 1.40; |FINSI;
         |SI #caiva300#6 = 4;  #caiva300#6 = 5.20; |FINSI;
     |SINO;
         |SI #caiva300#4 = 1.40;  #caiva300#4 = 1; |FINSI;
         |SI #caiva300#4 = 5.20;  #caiva300#4 = 4; |FINSI;
         |SI #caiva300#5 = 1.40;  #caiva300#5 = 1; |FINSI;
         |SI #caiva300#5 = 5.20;  #caiva300#5 = 4; |FINSI;
         |SI #caiva300#6 = 1.40;  #caiva300#6 = 1; |FINSI;
         |SI #caiva300#6 = 5.20;  #caiva300#6 = 4; |FINSI;

         |SI nSubeIVA = 1;
             |SI #caiva300#1 = 7;  |O #caiva300#1 = 10; #caiva300#1 = 8;  |FINSI;
             |SI #caiva300#1 = 16; |O #caiva300#1 = 21; #caiva300#1 = 18; |FINSI;
             |SI #caiva300#2 = 7;  |O #caiva300#2 = 10; #caiva300#2 = 8;  |FINSI;
             |SI #caiva300#2 = 16; |O #caiva300#2 = 21; #caiva300#2 = 18; |FINSI;
             |SI #caiva300#3 = 7;  |O #caiva300#3 = 10; #caiva300#3 = 8;  |FINSI;
             |SI #caiva300#3 = 16; |O #caiva300#3 = 21; #caiva300#3 = 18; |FINSI;
         |SINO;
             |SI #caiva300#1 = 8;  |O #caiva300#1 = 10; #caiva300#1 = 7;  |FINSI;
             |SI #caiva300#1 = 18; |O #caiva300#1 = 21; #caiva300#1 = 16; |FINSI;
             |SI #caiva300#2 = 8;  |O #caiva300#2 = 10; #caiva300#2 = 7;  |FINSI;
             |SI #caiva300#2 = 18; |O #caiva300#2 = 21; #caiva300#2 = 16; |FINSI;
             |SI #caiva300#3 = 8;  |O #caiva300#3 = 10; #caiva300#3 = 7;  |FINSI;
             |SI #caiva300#3 = 18; |O #caiva300#3 = 21; #caiva300#3 = 16; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;
|| //////////////////////////////////////////////////////////////////////////
|PROCESO eosma100B;
     |SI nSwOp = 0;
         |BORRA 020#eosma100.a;
     |SINO;
          |SI #eosma100#5 > 17; |Y #eosma100#5 ! 46;
              #eosma100#6  = #eosma100#6  % nPorce1;
              #eosma100#8  = #eosma100#8  % nPorce2;
              #eosma100#9  = #eosma100#9  % nPorce1;
              #eosma100#11 = #eosma100#11 % nPorce2;
              #eosma100#12 = #eosma100#12 % nPorce1;
              #eosma100#14 = #eosma100#14 % nPorce2;
              #eosma100#15 = #eosma100#15 % nPorce1;
              #eosma100#17 = #eosma100#17 % nPorce2;
              #eosma100#18 = #eosma100#18 % nPorce1;
              #eosma100#20 = #eosma100#20 % nPorce2;
              #eosma100#21 = #eosma100#21 % nPorce1;
              #eosma100#23 = #eosma100#23 % nPorce2;
              #eosma100#24 = #eosma100#24 % nPorce1;
              #eosma100#26 = #eosma100#26 % nPorce2;
              |GRABA 020#eosma100.a;
          |FINSI;
     |FINSI;
     |LIBERA #eosma100;
|FPRC;

|DEFBUCLE eosma100B;
     #eosma100#1;
     ;
     "303", #caman303#0, nActividad, #caman303#1, #caman303#2, 000;
     "303", #caman303#0, nActividad, #caman303#1, #caman303#2, 999;
     be;
     NULL, eosma100B;
|FIN;

|PROCESO BorradoM04;
     |BORRA 020#dsm30304.a;
     |LIBERA #dsm30304;
|FPRC;

|DEFBUCLE BorradoM04;
    #dsm30304#1;
    ;
    #caman303#45, #caman303#1, #caman303#2, 00;
    #caman303#45, #caman303#1, #caman303#2, 99;
    be;
    NULL, BorradoM04;
|FIN;

|PROCESO BorradoM05;
     |BORRA 020#dsm30305.a;
     |LIBERA #dsm30305;
|FPRC;

|DEFBUCLE BorradoM05;
    #dsm30305#1;
    ;
    #caman303#45, #caman303#1, #caman303#2, 0;
    #caman303#45, #caman303#1, #caman303#2, 9;
    be;
    NULL, BorradoM05;
|FIN;

|PROCESO borrado; |TIPO 2;
    nModo = (FEntrada / 100) ! 0;
    |SI nModo ! 3; |ACABA; |FINSI;

    nSwOp      = 0;
    nActividad = 1;
    |BUCLE eosma100B;
    |SI #caman303#1 = 12;
        |BUCLE BorradoM04;
        |BUCLE BorradoM05;
    |FINSI;
|FPRC;
|| ************************************************************************

|PROCESO Tipo7C45;  |TIPO 7;
  nModo = (FEntrada / 100) ! 0;
  #caman303#45   = #caportad#93; |PINTA #caman303#45;
  #caman303#0    = #canempre#2;
|FPRC;

|PROCESO Tipo0C45;  |TIPO 0;
  nModo = (FEntrada / 100) ! 0;

  |SI #caman303#45 ! #caportad#93;
      |PUSHV 0920 1364;
      |CUADRO 0920 1364;
      |ATRI R;
      |PINTA 1021, " Atencion. El tipo Periodo del Modelo esta  ";
      |PINTA 1121, " definido de forma diferente en los Datos   ";
      |PINTA 1221, " de Portadas.                               "; |ATRI 0;
      |CUADRO 0920 1364;

      |PAUSA;
      |POPV;
      |SI nModo ! 3;
          |ERROR;
      |FINSI;
 |FINSI;
|FPRC;

|PROCESO periodo; |TIPO 0;
  |SI FSalida = 2; |ACABA; |FINSI;

  |SI #caman303#45 = "T"; |Y #caman303#1 > 4;
      |MENAV "     El 303 esta preparado como Trimestral";
      |ERROR;
  |FINSI;

  |SI #caman303#45 = "A"; |Y #caman303#1 > 1;
      |MENAV "     El 303 esta preparado como Anual";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO def_any; |TIPO 7;
   #caman303#0 = #canempre#2;
   #caman303#2 = #30#26;  |PINTA #caman303#2;
   |C_M #caman303#2, 1, "N";
|FPRC;

|PROCESO cargar;  |TIPO 0;
    |SI FSalida = 2; |ACABA; |FINSI;

    nModo = (FEntrada / 100) ! 0;

    |SI nModo = 1;

        emp = (("000000" + #30#2) % -105) + (("0" + #30#3) % -101);
        |LEE 000#caman303.=;
        |SI FSalida = 0;
            |ACABA;
        |FINSI;

        enImpExp   = 1;
        activi     = #caman303#45;
        perio      = #caman303#1;
        peria      = #caman303#1;
        any        = #caman303#2;
        nActividad = 1;
        |SI swyacal = 0;
           |AVISO;
           |CONFI "2400NDESEA RECALCULAR LOS PERIODOS DE LOS REGISTROS DE IVA S/N : ";
           |SI FSalida = 0;
               swyacal = 1;
               |HAZ Recalculo;
           |FINSI;
       |FINSI;

       swliq = 0;
       |SI #caman303#1 > 1;
           |CONFI "2400SLIQUIDAR FACTURAS PENDIENTES DE PERIODOS ANTERIORES : ";
           |SI FSalida = 0;
               swliq = 1;
               peria = 1;
           |FINSI;
      |FINSI;

      eaCampo45 = #caman303#45;
      enCampo1  = #caman303#1;
      enCampo2  = #caman303#2;
      |LIBERA #caman303;
      |CIERRAT #caman303;
      |SUB_EJECUTA "cacap303;Auto";
      |ABRET #caman303;

      #caman303#45 = eaCampo45;
      #caman303#1  = enCampo1;
      #caman303#2  = enCampo2;
      |LEE 141#caman303.=;

      |BLIN 4;
      |PINDA #0#caman303;
      enImpExp = 0;
      |MENAV "0000Datos Recogidos";
 |FINSI;

 |HAZ empresa;
 |SI nModo = 3; |ACABA; |FINSI;
 |SI nModo = 4;
     |LEE 041#caman303.=;
     |HAZ ElMenu;
 |FINSI;
|FPRC;

|PROCESO empresa;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         |HAZ LeeControl;
         #caman303#6  = #caiva300#1;
         #caman303#9  = #caiva300#2;
         #caman303#12 = #caiva300#3;
         #caman303#15 = #caiva300#4;
         #caman303#18 = #caiva300#5;
         #caman303#47 = #caiva300#6;
    |FINSI;

    |HAZ DatosPortada;

    aAlfa   = "N";
    nMod390 = 0;
    |SI enNoMod390 = 1;
        |SI #caman303#1 =  4; |Y #caman303#45 = "T"; nMod390 = 1; |FINSI;
        |SI #caman303#1 = 12; |Y #caman303#45 ! "T"; nMod390 = 1; |FINSI;
        |SI #caman303#45 = "A";                      nMod390 = 1; |FINSI;
    |FINSI;
|FPRC;

|PROCESO i_archiv; |TIPO 7;
    |SI #caman303#45 = "T"; |Y #caman303#1 = 4;  #caman303#60 = #caportad#101; |FINSI;
    |SI #caman303#45 = "M"; |Y #caman303#1 = 12; #caman303#60 = #caportad#101; |FINSI;
    |SI #caman303#45 = "D"; |Y #caman303#1 = 12; #caman303#60 = #caportad#101; |FINSI;

                             #caman303#94 = "N";
    |SI #caman303#45 = "D";  #caman303#94 = "S";   |FINSI;

                             #caman303#96 = "N";
    |SI #caportad#124 = "S"; #caman303#96 = "S";   |FINSI;

    nPerFin = 0;
    |C_M #caman303#98, 1, "S";
    |C_M #dsmow205#4, 1, "S";
    |C_M #dsmow224#4, 1, "S";
    |C_M #dsmow227#4, 1, "S";

    |C_M #caman303#99, 1, "S";
    |C_M #dsmow205#5, 1, "S";
    |C_M #dsmow224#5, 1, "S";
    |C_M #dsmow227#5, 1, "S";

    |SI #caman303#1  = 12;    nPerFin = 1;  |FINSI;
    |SI #caman303#45 = "T";
        |SI #caman303#1 = 4;  nPerFin = 1;  |FINSI;
    |FINSI;

    |SI nPerFin = 0;
        |C_M #caman303#98, 1, "N";  #caman303#98 = "N";
        |C_M #dsmow205#4, 1, "N";
        |C_M #dsmow224#4, 1, "N";
        |C_M #dsmow227#4, 1, "N";

        |C_M #caman303#99, 1, "N";  #caman303#99 = "N";
        |C_M #dsmow205#5, 1, "N";
        |C_M #dsmow224#5, 1, "N";
        |C_M #dsmow227#5, 1, "N";
    |FINSI;

    #caman303#155 = "N";
    #caman303#171 = "N";
    |SI nPerFin = 1;
        |SI nMod390 = 1;
            #caman303#155 = "S";
            |SI #caman303#153 = 0; |Y enEjercicio < 2018;
                 #caman303#155 = "N";
            |FINSI;
        |FINSI;
    |FINSI;
    |SI #caman303#153 ! 0; |Y enEjercicio ] 2018;
        #caman303#171 = "S";
    |FINSI;

    |C_M #caman303#77, 1, "N";

    |SI #caman303#4 ! "S";  |ACABA;  |FINSI;

    |AVISO;
    |CONFI "2400NEste Modelo ya esta Impreso, quiere introducir el codigo electronico";
    |SI FSalida = 0;
        |C_M #caman303#77, 1, "S";

        |LEE 101#caman303.=;
        |SI FSalida = 0;
            |ENCAMPO #77#caman303;
            |GRABA 020#caman303.a;
            |LIBERA #caman303;
        |FINSI;

        |PTEC 806;
        |ACABA;
    |FINSI;

    |CONFI "2400NEste Modelo ya esta Impreso, Desea Modificarlo : ";
    |SI FSalida = 0;
        |AVISO;
        |CONFI "2400NEsta Seguro? : ";
        |SI FSalida ! 0;
            |PTEC 806;
        |SINO;
            #caman303#4  = "N"; |PINTA #caman303#4;
            #caman303#3  = "";  |PINTA #caman303#3;
            #caman303#77 = "";  |PINTA #caman303#77;
        |FINSI;
    |SINO;
        |PTEC 806;
    |FINSI;
|FPRC;

|PROCESO Comple; |TIPO 0;
  alfa1 = #caman303#156;
  |C_M #caman303#157, 1,alfa1;
  |C_M #caman303#116, 1,alfa1;

  |SI #caman303#156 ! "S";
      #caman303#157 = "";
      #caman303#116 = 0;
  |FINSI;
|FPRC;

|| /////////////////////////////////////////////////////////////////
|| ---------------------------------------------------------------
|| cambio Compensar - Devolver
|PROCESO funcion9; |TIPO 0;
   |SI FSalida ! 9;             |ACABA; |FINSI;

   |SI #dsmow206#31 = 0; |Y #dsmow206#32 = 0; |ACABA; |FINSI;
   |SI #caman303#45 = "T";
       |SI #caman303#1 ! 4; |ACABA; |FINSI; || ¨Solo para el 4§?
   |FINSI;
   |SI #caman303#45 = "M";
       |SI #caman303#1 ! 12; |ACABA; |FINSI; || ¨Solo para el 12§?
   |FINSI;
   frase_d     = "";
   informado_d = "";
   Linea1      = "";
   Linea2      = "";
   Linea3      = "";

   |ABRE #caportad;
   #caportad#0 = #30#2;
   #caportad#1 = #30#26;
   |LIBERA #caportad;
   |LEE 140#caportad.=;
   |SI FSalida = 0;
       |HAZ Cuest_Devol;
       #caportad#71 = informado_d;
       |GRABA 020#caportad.a;
   |FINSI;
   |CIERRA #caportad;
|FPRC;

|PROCESO ActuRepartoAdq;
       |ABRE #eosma100;
       #eosma100#0 = "303";
       #eosma100#1 = #caman303#0;
       #eosma100#2 = nActividad;
       #eosma100#3 = #caman303#1;
       #eosma100#4 = #caman303#2;
       #eosma100#5 = nCampo1;
       |LEE 101#eosma100.=;
       |SI FSalida ! 0;
           |DDEFECTO #eosma100;
           #eosma100#0 = "303";
           #eosma100#1 = #caman303#0;
           #eosma100#2 = nActividad;
           #eosma100#3 = #caman303#1;
           #eosma100#4 = #caman303#2;
           #eosma100#5 = nCampo1;
           |GRABA 020#eosma100.b;
       |FINSI;
       #eosma100#6  = #dsmow206#78 % nPorce1; #eosma100#7  = #dsmow206#79; #eosma100#8  = #dsmow206#80 % nPorce2;
       #eosma100#9  = #dsmow206#81 % nPorce1; #eosma100#10 = #dsmow206#82; #eosma100#11 = #dsmow206#83 % nPorce2;
       #eosma100#12 = #dsmow206#84 % nPorce1; #eosma100#13 = #dsmow206#85; #eosma100#14 = #dsmow206#86 % nPorce2;
       #eosma100#15 = #dsmow206#87 % nPorce1; #eosma100#16 = #dsmow206#88; #eosma100#17 = #dsmow206#89 % nPorce2;
       #eosma100#18 = #dsmow206#91 % nPorce1; #eosma100#19 = #dsmow206#92; #eosma100#20 = #dsmow206#93 % nPorce2;
       |GRABA 020#eosma100.a;
       |LIBERA #eosma100;
       |CIERRA #eosma100;
|FPRC;

|PROCESO PideBase;  |TIPO 0;
     |SI FSalida = 10;
         |PUSHV 0501 2380;
         #eosw0052#0  = "ADQUISICIONES 1 ";
         #eosw0052#1  = "ADQUISICIONES 2 ";
         #eosw0052#2  = "ADQUISICIONES 3 ";
         #eosw0052#3  = "ADQUISICIONES 4 ";
         #eosw0052#16 = "";
         #eosw0052#4  = #dsmow206#78;   #eosw0052#5  = #dsmow206#79;   #eosw0052#6  = #dsmow206#80;
         #eosw0052#7  = #dsmow206#81;   #eosw0052#8  = #dsmow206#82;   #eosw0052#9  = #dsmow206#83;
         #eosw0052#10 = #dsmow206#84;   #eosw0052#11 = #dsmow206#85;   #eosw0052#12 = #dsmow206#86;
         #eosw0052#13 = #dsmow206#87;   #eosw0052#14 = #dsmow206#88;   #eosw0052#15 = #dsmow206#89;
         #eosw0052#17 = #dsmow206#91;   #eosw0052#18 = #dsmow206#92;   #eosw0052#19 = #dsmow206#93;

         |PINPA #0#eosw0052;
         |PINDA #0#eosw0052;
         |ENDATOS #1#eosw0052;
         |SI FSalida = 0;
             #dsmow206#78 = #eosw0052#4;   #dsmow206#79 = #eosw0052#5;   #dsmow206#80 = #eosw0052#6;
             #dsmow206#81 = #eosw0052#7;   #dsmow206#82 = #eosw0052#8;   #dsmow206#83 = #eosw0052#9;
             #dsmow206#84 = #eosw0052#10;  #dsmow206#85 = #eosw0052#11;  #dsmow206#86 = #eosw0052#12;
             #dsmow206#87 = #eosw0052#13;  #dsmow206#88 = #eosw0052#14;  #dsmow206#89 = #eosw0052#15;
             #dsmow206#91 = #eosw0052#17;  #dsmow206#92 = #eosw0052#18;  #dsmow206#93 = #eosw0052#19;

             |CONFI "2400SLo Computamos al IVA Soportado : ";
             |SI FSalida = 0;
                 #dsmow206#66 = #dsmow206#78 + #dsmow206#81 + #dsmow206#84 + #dsmow206#87 + #dsmow206#91;
                 #dsmow206#51 = #dsmow206#80 + #dsmow206#83 + #dsmow206#86 + #dsmow206#89 + #dsmow206#93;
                 nCampo1 = 66;  nActividad = 1;
                 nPorce1 = 100; nPorce2 = #dsmow206#60;
                 |HAZ ActuRepartoAdq;
             |FINSI;
         |FINSI;
         |POPV;
     |FINSI;

     #dsmow206#49 = #dsmow206#78 + #dsmow206#81 + #dsmow206#84 + #dsmow206#87 + #dsmow206#91;  |PINTA #dsmow206#49;
     #dsmow206#50 = #dsmow206#80 + #dsmow206#83 + #dsmow206#86 + #dsmow206#89 + #dsmow206#93;  |PINTA #dsmow206#50;
|FPRC;

|PROCESO PideBaseSopor;  |TIPO 0;
     nTecla = FSalida;

     nActividad = 1;
     |SI Campo = 62;
         nCampo1 = 62;
         nCampo2 = 21;
     |FINSI;

     |SI Campo = 63;
         nCampo1 = 63;
         nCampo2 = 43;
     |FINSI;

     |SI Campo = 64;
         nCampo1 = 64;
         nCampo2 = 22;
     |FINSI;

     |SI Campo = 65;
         nCampo1 = 65;
         nCampo2 = 44;
     |FINSI;

     |SI Campo = 66;
         nCampo1 = 66;
         nCampo2 = 51;
     |FINSI;

     |SI Campo = 67;
         nCampo1 = 67;
         nCampo2 = 58;
     |FINSI;

     |SI Campo = 109;
         nCampo1 = 109;
         nCampo2 = 110;
     |FINSI;

     |C_M #dsmow206#nCampo2#, 1, "N";

     |ABRE #eosma100;
     #eosma100#0 = "303";
     #eosma100#1 = #caman303#0;
     #eosma100#2 = nActividad;
     #eosma100#3 = #caman303#1;
     #eosma100#4 = #caman303#2;
     #eosma100#5 = Campo;
     |LEE 101#eosma100.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosma100;
         #eosma100#0 = "303";
         #eosma100#1 = #caman303#0;
         #eosma100#2 = nActividad;
         #eosma100#3 = #caman303#1;
         #eosma100#4 = #caman303#2;
         #eosma100#5 = Campo;

         #eosma100#6 = #dsmow206#nCampo1#;
         #eosma100#7 = 0;
         #eosma100#8 = #dsmow206#nCampo2#;

         |GRABA 020#eosma100.b;
     |FINSI;

     |SI nTecla = 13;
         |PUSHV 0501 2380;

         |PINPA #0#eosma100;
         |PINDA #0#eosma100;
         |ENDATOS #1#eosma100;
         nError = FSalida;
         |SI FSalida = 0;
             #dsmow206#nCampo1# = #eosma100#6 + #eosma100#9  + #eosma100#12 + #eosma100#15 + #eosma100#18 + #eosma100#21 + #eosma100#24;
             #dsmow206#nCampo2# = #eosma100#8 + #eosma100#11 + #eosma100#14 + #eosma100#17 + #eosma100#20 + #eosma100#23 + #eosma100#26;
         |FINSI;

         |POPV;
     |FINSI;

     |SI nError = 0;
         |GRABA 020#eosma100.a;
     |FINSI;
     |LIBERA #eosma100;

     #dsmow206#nCampo1# = #eosma100#6 + #eosma100#9  + #eosma100#12 + #eosma100#15 + #eosma100#18 + #eosma100#21 + #eosma100#24;
     #dsmow206#nCampo2# = #eosma100#8 + #eosma100#11 + #eosma100#14 + #eosma100#17 + #eosma100#20 + #eosma100#23 + #eosma100#26;

     |PINTA #dsmow206#nCampo1#;
     |PINTA #dsmow206#nCampo2#;
|FPRC;

|PROCESO Cuest_Devol;
   |SI #caportad#71 = "C"; frase_d = "A COMPENSAR"; |FINSI;
   |SI #caportad#71 = "D"; frase_d = "A DEVOLVER "; |FINSI;

   informado_d = #caportad#71;

   |PUSHV 0501 2380;
   |D_CUADRO 1409, 2269;
   |ATRI R;

   Linea1 = ((" Empresa ..: " + #30#2 + " " + #30#1) + (" " * 59)) % 159;
   Linea3 = ((" vaya a la casilla " + frase_d) + (" " * 59)) % 159;

   |PINTA 1510, Linea1;
   || .. |PINTA 1510, Linea2;
   |PINTA 1610, "-----------------------------------------------------------";
   |PINTA 1710, " La Cantidad que nos da el trimestre es negativa y tenemos ";
   |PINTA 1810, " informado en los datos de Portada que el importe del IVA. ";
   |PINTA 1910, Linea3;
   |PINTA 2010, "-----------------------------------------------------------";
   |PINTA 2110, " Desea cambiar lo informado <C>ompensar / <D>evolver :     ";
   |ATRI r;

   E_inf = "CDcd";
   E_sup = "1";

   informado_d = 2165 ? 1;
   |POPV;
   alfa1 = informado_d > " ";
   informado_d = alfa1;
|FPRC;

|PROCESO TotalRepNuevo;
    #dsmow206#nCampo1# = #eosma100#6 + #eosma100#9  + #eosma100#12 + #eosma100#15 + #eosma100#18 + #eosma100#21 + #eosma100#24;
    #dsmow206#nCampo2# = #eosma100#8 + #eosma100#11 + #eosma100#14 + #eosma100#17 + #eosma100#20 + #eosma100#23 + #eosma100#26;
    nMasBase = 0;
    nPriIVA  = 0;
    |SI #eosma100#6  ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#7;  |FINSI;
    |SI #eosma100#9  ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#10; |FINSI;
    |SI #eosma100#12 ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#13; |FINSI;
    |SI #eosma100#15 ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#16; |FINSI;
    |SI #eosma100#18 ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#19; |FINSI;
    |SI #eosma100#21 ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#22; |FINSI;
    |SI #eosma100#24 ! 0; nMasBase = nMasBase + 1; nPriIVA = #eosma100#25; |FINSI;

    |SI nCampo3 ! -1;
        |SI nMasBase ] 2;
            #dsmow206#nCampo3# = (#dsmow206#nCampo2# / #dsmow206#nCampo1#) * 100;
            |SI #dsmow206#nCampo3# < 0;
                #dsmow206#nCampo3# = 0;
            |FINSI;
        |SINO;
            #dsmow206#nCampo3# = nPriIVA;
        |FINSI;
   |FINSI;
|FPRC;

|PROCESO Pide7;
     |HAZ LeeControl;
     aAlfa = "    Base de IVA ";
     |SI nSubeIVA ! 0;
         aAlfa = "    Pulse <F5> para introducir el desglose de IVA  ";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO Pide7R;
     aAlfa = "    Base de Recargo ";
     |SI nSubeIVA = 2;
         aAlfa = "    Pulse <F5> para introducir el desglose de Recargo  ";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO PideBaseReper;  |TIPO 0;
     nTecla = FSalida;

     |BLIN 4;

     nActividad = 1;

     |SI Campo = 5;   nCampo1 = 5;    nCampo2 = 7;   nCampo3 = 6;   |FINSI;
     |SI Campo = 8;   nCampo1 = 8;    nCampo2 = 10;  nCampo3 = 9;   |FINSI;
     |SI Campo = 11;  nCampo1 = 11;   nCampo2 = 13;  nCampo3 = 12;  |FINSI;
     |SI Campo = 14;  nCampo1 = 14;   nCampo2 = 16;  nCampo3 = 15;  |FINSI;
     |SI Campo = 17;  nCampo1 = 17;   nCampo2 = 19;  nCampo3 = 18;  |FINSI;
     |SI Campo = 46;  nCampo1 = 46;   nCampo2 = 48;  nCampo3 = 47;  |FINSI;
     |SI Campo = 103; nCampo1 = 103;  nCampo2 = 104; nCampo3 = -1;  |FINSI;
     |SI Campo = 105; nCampo1 = 105;  nCampo2 = 106; nCampo3 = -1;  |FINSI;
     |SI Campo = 107; nCampo1 = 107;  nCampo2 = 108; nCampo3 = -1;  |FINSI;

     aAlfa = "S";
     |SI nSubeIVA ! 0;  aAlfa = "N"; |FINSI;
     |SI nSubeIVA = 1; |Y Campo > 11;
         aAlfa = "S";
     |FINSI;
     |SI Campo ] 105; aAlfa = "S"; |FINSI;

     |SI nCampo3 ! -1;
         |C_M #dsmow206#nCampo3#, 1, aAlfa;
     |FINSI;

     |C_M #dsmow206#nCampo2#, 1, aAlfa;

     |ABRE #eosma100;
     #eosma100#0 = "303";
     #eosma100#1 = #caman303#0;
     #eosma100#2 = nActividad;
     #eosma100#3 = #caman303#1;
     #eosma100#4 = #caman303#2;
     #eosma100#5 = Campo;
     |LEE 101#eosma100.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosma100;
         #eosma100#0 = "303";
         #eosma100#1 = #caman303#0;
         #eosma100#2 = nActividad;
         #eosma100#3 = #caman303#1;
         #eosma100#4 = #caman303#2;
         #eosma100#5 = Campo;

         #eosma100#6 = #dsmow206#nCampo1#;
         |SI nCampo3 ! -1;
             #eosma100#7 = #dsmow206#nCampo3#;
         |FINSI;

         #eosma100#8 = #dsmow206#nCampo2#;

         |GRABA 020#eosma100.b;
     |FINSI;

     |SI nTecla = 13; |Y nSubeIVA = 1; |Y Campo > 11;
         nTecla = 0;
     |FINSI;

     |SI Campo ] 105; nTecla = 0; |FINSI;

     |SI nTecla = 13; |Y  nSubeIVA ! 0;

         |PUSHV 0501 2380;

         |PINPA #0#eosma100;
         |PINDA #0#eosma100;
         |ENDATOS #1#eosma100;
         nError = FSalida;
         |SI FSalida = 0;
             |HAZ TotalRepNuevo;
         |FINSI;

         |POPV;
     |FINSI;

     |SI nError = 0;
         |SI nSubeIVA = 0; |O Campo ] 105;
             #eosma100#6 = #dsmow206#nCampo1#;
             |SI nCampo3 ! -1;
                 #eosma100#7 = #dsmow206#nCampo3#;
             |FINSI;
             #eosma100#8 = #dsmow206#nCampo2#;
         |FINSI;
         |SI nSubeIVA = 1; |Y Campo > 11;
             #eosma100#6 = #dsmow206#nCampo1#;
             #eosma100#7 = #dsmow206#nCampo3#;
             #eosma100#8 = #dsmow206#nCampo2#;
         |FINSI;
         |GRABA 020#eosma100.a;
     |FINSI;
     |LIBERA #eosma100;
     |CIERRA #eosma100;

     |SI nSubeIVA ! 0;
         |HAZ TotalRepNuevo;
     |FINSI;

     |SI nCampo3 ! -1;
         |SI #dsmow206#nCampo3# = 0;
             |SI nCampo3 = 6;  nCampo = 1; |FINSI;
             |SI nCampo3 = 9;  nCampo = 2; |FINSI;
             |SI nCampo3 = 12; nCampo = 3; |FINSI;

             |SI nCampo3 = 15; nCampo = 4; |FINSI;
             |SI nCampo3 = 18; nCampo = 5; |FINSI;
             |SI nCampo3 = 47; nCampo = 6; |FINSI;
             #dsmow206#nCampo3# = #caiva300#nCampo#;
         |FINSI;

         |PINTA #dsmow206#nCampo3#;
     |FINSI;

     |PINTA #dsmow206#nCampo1#;
     |PINTA #dsmow206#nCampo2#;
|FPRC;

|PROCESO PideCuotaReper;  |TIPO 0;
     |SI Campo = 7;
         nCampo1 = 5;
         nCampo2 = 7;
         nCampo3 = 6;
     |FINSI;

     |SI Campo = 10;
         nCampo1 = 8;
         nCampo2 = 10;
         nCampo3 = 9;
     |FINSI;

     |SI Campo = 13;
         nCampo1 = 11;
         nCampo2 = 13;
         nCampo3 = 12;
     |FINSI;

     |SI Campo = 16;
         nCampo1 = 14;
         nCampo2 = 16;
         nCampo3 = 15;
     |FINSI;

     |SI Campo = 19;
         nCampo1 = 17;
         nCampo2 = 19;
         nCampo3 = 18;
     |FINSI;

     |SI Campo = 48;
         nCampo1 = 46;
         nCampo2 = 48;
         nCampo3 = 47;
     |FINSI;

     nSwGraba = 0;
     |SI nSubeIVA = 0; nSwGraba = 1; |FINSI;
     |SI nSubeIVA = 1; |Y nCampo1 > 11; nSwGraba = 1; |FINSI;
     |SI nSwGraba = 1;
         |ABRE #eosma100;
         #eosma100#0 = "303";
         #eosma100#1 = #caman303#0;
         #eosma100#2 = nActividad;
         #eosma100#3 = #caman303#1;
         #eosma100#4 = #caman303#2;
         #eosma100#5 = nCampo1;
         |LEE 101#eosma100.=;
         |SI FSalida ! 0;
             |DDEFECTO #eosma100;
             #eosma100#0 = "303";
             #eosma100#1 = #caman303#0;
             #eosma100#2 = nActividad;
             #eosma100#3 = #caman303#1;
             #eosma100#4 = #caman303#2;
             #eosma100#5 = nCampo1;
             |GRABA 020#eosma100.b;
         |FINSI;
         #eosma100#6 = #dsmow206#nCampo1#;
         #eosma100#7 = #dsmow206#nCampo3#;
         #eosma100#8 = #dsmow206#nCampo2#;
         |GRABA 020#eosma100.a;
         |LIBERA #eosma100;
         |CIERRA #eosma100;
     |FINSI;
|FPRC;

|PROCESO nomodi; |TIPO 7;
  |SI cont = 1;
      |HAZ nomodifi;
  |FINSI;
|FPRC;

|PROCESO nomodifi;             || RUTINA DE CONVERSION A NO MODIFICABLES
                               || VARIABLES: A_
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FPRC;

|PROCESO antes1;  |TIPO 7;
  antes1 = #dsmow206#Campo#;
  |HAZ Pide7;
|FPRC;

|PROCESO antes2;  |TIPO 7;
  antes2 = #dsmow206#Campo#;
  |HAZ Pide7;
|FPRC;

|PROCESO antes3;  |TIPO 7;
  antes3 = #dsmow206#Campo#;
  |HAZ Pide7;
|FPRC;

|PROCESO antes4;  |TIPO 7;
  antes4 = #dsmow206#Campo#;
  |HAZ Pide7R;
|FPRC;

|PROCESO antes5;  |TIPO 7;
  antes5 = #dsmow206#Campo#;
  |HAZ Pide7R;
|FPRC;

|PROCESO antes6;  |TIPO 7;
  antes6 = #dsmow206#Campo#;
  |HAZ Pide7R;
|FPRC;

|PROCESO despu1;
  |SI antes1 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintabase;
|FPRC;

|PROCESO despu2;
  |SI antes2 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintabase;
|FPRC;

|PROCESO despu3;
  |SI antes3 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintabase;
|FPRC;

|PROCESO despu4;
  |SI antes4 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintabase;
|FPRC;

|PROCESO despu5;
  |SI antes5 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintabase;
|FPRC;

|PROCESO despu6;
  |SI antes6 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintabase;
|FPRC;

|PROCESO pintabase;
  base = Campo + 2;
  tipo = Campo + 1;
  |SI nSubeIVA = 0;
      #dsmow206#base# = (#dsmow206#Campo# % #dsmow206#tipo#) ! 2;
  |FINSI;
  |PINTA #dsmow206#base#;
|FPRC;

|PROCESO antes11;  |TIPO  7;
  antes11 = #dsmow206#Campo#
|FPRC;

|PROCESO antes12;  |TIPO  7;
  antes12 = #dsmow206#Campo#
|FPRC;

|PROCESO antes13;  |TIPO  7;
  antes13 = #dsmow206#Campo#
|FPRC;

|PROCESO antes14;  |TIPO  7;
  antes14 = #dsmow206#Campo#
|FPRC;

|PROCESO antes15;  |TIPO  7;
  antes15 = #dsmow206#Campo#
|FPRC;

|PROCESO antes16;  |TIPO  7;
  antes16 = #dsmow206#Campo#
|FPRC;

|PROCESO despu11;
  |SI antes11 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintatipo;
|FPRC;

|PROCESO despu12;
  |SI antes12 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintatipo;
|FPRC;

|PROCESO despu13;
  |SI antes13 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintatipo;
|FPRC;

|PROCESO despu14;
  |SI antes14 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintatipo;
|FPRC;

|PROCESO despu15;
  |SI antes15 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintatipo;
|FPRC;

|PROCESO despu16;
  |SI antes16 = #dsmow206#Campo#;  |ACABA;  |FINSI;
  |HAZ pintatipo;
|FPRC;

|PROCESO pintatipo;
  base = Campo + 1;
  tipo = Campo - 1;
  #dsmow206#base# = (#dsmow206#tipo# % #dsmow206#Campo#) ! 2;
  |PINTA #dsmow206#base#;
|FPRC;

|PROCESO sumacuot; |TIPO 0;
     #dsmow206#20 = #dsmow206#7  + #dsmow206#10  + #dsmow206#13  + #dsmow206#16;
     #dsmow206#20 = #dsmow206#20 + #dsmow206#19  + #dsmow206#48  + #dsmow206#50;
     #dsmow206#20 = #dsmow206#20 + #dsmow206#104 + #dsmow206#106 + #dsmow206#108;
     |PINTA #dsmow206#20;

     |HAZ especifi;
     |HAZ atribuir;
|FPRC;

|PROCESO cuota2; |TIPO 0;
     #dsmow206#25 = #dsmow206#21 + #dsmow206#43 + #dsmow206#22 + #dsmow206#44 + #dsmow206#51 + #dsmow206#58;
     #dsmow206#25 = #dsmow206#25 + #dsmow206#23 + #dsmow206#24 + #dsmow206#61 + #dsmow206#110;
     |PINTA #dsmow206#25;
     |HAZ atribuir;
|FPRC;

|PROCESO atribuir; |TIPO 0;
     #dsmow206#26 = (#dsmow206#20 - #dsmow206#25) + #dsmow206#118;
     |PINTA #dsmow206#26;
     #dsmow206#28 = #dsmow206#26 % #dsmow206#27; |PINTA #dsmow206#28;
     |HAZ total;
|FPRC;

|PROCESO total; |TIPO 0;
     #dsmow206#115 = #dsmow206#28  + #dsmow206#119 - #dsmow206#29 + #dsmow206#30; |PINTA #dsmow206#115;
     #dsmow206#117 = #dsmow206#115 - #dsmow206#116;              |PINTA #dsmow206#117;

     #dsmow206#33 = 0;
     #dsmow206#32 = 0;
     #dsmow206#31 = 0;
     |SI #dsmow206#117 > 0;
         #dsmow206#33 = #dsmow206#117;
         #dsmow206#31 = 0;
         #dsmow206#32 = 0;
     |SINO;
         #dsmow206#33 = 0;
         #dsmow206#32 = -#dsmow206#117;
         #dsmow206#31 = 0;

         |SI #caportad#71 = "D";
             |SI #caman303#45 = "T"; |Y #caman303#1 = 4;
                 #dsmow206#32 = 0;
                 #dsmow206#31 = -#dsmow206#117;
             |FINSI;
             |SI #caman303#45 = "M"; |Y #caman303#1 = 12;
                 #dsmow206#32 = 0;
                 #dsmow206#31 = -#dsmow206#117;
             |FINSI;
             |SI #caman303#45 = "D";
                 #dsmow206#32 = 0;
                 #dsmow206#31 = -#dsmow206#117;
             |FINSI;
             |SI #caman303#45 = "A";
                 #dsmow206#32 = 0;
                 #dsmow206#31 = -#dsmow206#117;
            |FINSI;
         |FINSI;
     |FINSI;

     |PINTA #dsmow206#31;
     |PINTA #dsmow206#32;
     |PINTA #dsmow206#33;

     |HAZ especifi;

     #dsmow206#97 = "N";
     |SI #dsmow206#113 ! 0;  |O #dsmow206#114 ! 0;
         #dsmow206#97 = "S";
     |FINSI;

|FPRC;

|PROCESO especifi; |TIPO 0;
   |SI enEjercicio < 2014;
       #dsmow206#70 = #dsmow206#5 + #dsmow206#8 + #dsmow206#11 + #dsmow206#105;
       |PINTA #dsmow206#70;
   |FINSI;

   #dsmow206#35  = #dsmow206#54;
   #dsmow206#36  = #dsmow206#68;
   #dsmow206#120 = #dsmow206#111;
   #dsmow206#71  = #dsmow206#69;
   #dsmow206#42  = #dsmow206#70 + #dsmow206#120 + #dsmow206#35 + #dsmow206#36 + #dsmow206#37 + #dsmow206#71 + #dsmow206#56 + #dsmow206#34 + #dsmow206#38;
   #dsmow206#42  = #dsmow206#42 + #dsmow206#39  + #dsmow206#72 + #dsmow206#73 - #dsmow206#40 - #dsmow206#41;
   |PINTA #dsmow206#120;
   |PINTA #dsmow206#35;
   |PINTA #dsmow206#36;
   |PINTA #dsmow206#71;
   |PINTA #dsmow206#42;
|FPRC;

|PROCESO Lee100_303;
     |SI nError = 1;  |ACABA;  |FINSI;

     |SI #dsmow206#nCampo1# ! 0;  |O #dsmow206#nCampo2# ! 0;
         #eosma100#0 = "303";
         #eosma100#1 = #caman303#0;
         #eosma100#2 = nActividad;
         #eosma100#3 = #caman303#1;
         #eosma100#4 = #caman303#2;
         #eosma100#5 = nCampo1;
         |LEE 000#eosma100.=;
         |SI FSalida ! 0;  |DDEFECTO #eosma100;  |FINSI;

         #eosw0052#4 = #eosma100#6 + #eosma100#9  + #eosma100#12 + #eosma100#15 + #eosma100#18 + #eosma100#21 + #eosma100#24;
         #eosw0052#6 = #eosma100#8 + #eosma100#11 + #eosma100#14 + #eosma100#17 + #eosma100#20 + #eosma100#23 + #eosma100#26;

         |SI #regiva@#nCampo1# ! #eosw0052#4;  |O #regiva@#nCampo2# ! #eosw0052#6;
             |MENAV "0000No se puede cancelar la ficha.";
             aAlfa ="0000Se ha introducido desglose de compras y no coincide con los totales de compras.";
             |SI nCampo1 < 12;
                 aAlfa = "0000Se ha introducido desglose de ventas y no coincide con los totales de ventas.";
             |FINSI;
             |MENAV aAlfa;
             nError = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12W; |TIPO 12;
|FPRC;

|PROCESO Tipo0C227; |TIPO 0;
   |C_M #dsmow224#Campo#, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI #dsmow227#Campo# = "S";
       |SI Campo = 10;
           |SI #dsmow227#1  = "S";
               #dsmow227#1  = "N"; |PINTA #dsmow227#1;
           |FINSI;
           |SI #dsmow227#2  = "S";
               #dsmow227#2  = "N"; |PINTA #dsmow227#2;
           |FINSI;
           |SI #dsmow227#4  = "S";
               #dsmow227#4  = "N"; |PINTA #dsmow227#4;
           |FINSI;
           |SI #dsmow227#5  = "S";
               #dsmow227#5  = "N"; |PINTA #dsmow227#5;
           |FINSI;
           |SI #dsmow227#6  = "S";
               #dsmow227#6  = "N"; |PINTA #dsmow227#6;
               |HAZ Tipo0C100;
           |FINSI;
           |SI #dsmow227#11 = "S";
               #dsmow227#11 = "N"; |PINTA #dsmow227#11;
           |FINSI;

       |SINO;
           |SI #dsmow227#10 = "S";
               #dsmow227#10 = "N"; |PINTA #dsmow227#10;
           |FINSI;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo0C224; |TIPO 0;
   |C_M #dsmow224#Campo#, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |SI #dsmow224#Campo# = "S";
       |SI Campo = 10;
           |SI #dsmow224#1  = "S";
               #dsmow224#1  = "N"; |PINTA #dsmow224#1;
           |FINSI;
           |SI #dsmow224#2  = "S";
               #dsmow224#2  = "N"; |PINTA #dsmow224#2;
           |FINSI;
           |SI #dsmow224#4  = "S";
               #dsmow224#4  = "N"; |PINTA #dsmow224#4;
           |FINSI;
           |SI #dsmow224#5  = "S";
               #dsmow224#5  = "N"; |PINTA #dsmow224#5;
           |FINSI;
           |SI #dsmow224#6  = "S";
               #dsmow224#6  = "N"; |PINTA #dsmow224#6;
               |HAZ Tipo0C100;
           |FINSI;
           |SI #dsmow224#11 = "S";
               #dsmow224#11 = "N"; |PINTA #dsmow224#11;
           |FINSI;

       |SINO;
           |SI #dsmow224#10 = "S";
               #dsmow224#10 = "N"; |PINTA #dsmow224#10;
           |FINSI;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo0C100; |TIPO 0;
     |SI nSw = 0;
         |C_M #dsmow205#7, 1, "S";
         |C_M #dsmow205#8, 1, "S";
         |SI #dsmow205#6 = "N";
             |C_M #dsmow205#7, 1, "N";  #dsmow205#7 = "01.01.0000";
             |C_M #dsmow205#8, 1, "N";  #dsmow205#8 = "N";
         |FINSI;

         |PINTA #dsmow205#7;
         |PINTA #dsmow205#8;
     |FINSI;
     |SI nSw = 1; |O nSw = 2;
         |C_M #dsmow224#7, 1, "S";
         |C_M #dsmow224#8, 1, "S";
         |SI #dsmow224#6 = "N";
             |C_M #dsmow224#7, 1, "N";  #dsmow224#7 = "01.01.0000";
             |C_M #dsmow224#8, 1, "N";  #dsmow224#8 = "N";
         |FINSI;

         |PINTA #dsmow224#7;
         |PINTA #dsmow224#8;
     |FINSI;
     |SI nSw = 3;
         |C_M #dsmow227#7, 1, "S";
         |C_M #dsmow227#8, 1, "S";
         |SI #dsmow227#6 = "N";
             |C_M #dsmow227#7, 1, "N";  #dsmow227#7 = "01.01.0000";
             |C_M #dsmow227#8, 1, "N";  #dsmow227#8 = "N";
         |FINSI;

         |PINTA #dsmow227#7;
         |PINTA #dsmow227#8;
     |FINSI;
|FPRC;

|PROCESO Punto01_205;
   |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
         nHCampo = nDCampo + 94;
         #dsmow205#nDCampo# = #caman303#nHCampo#;
   |SIGUE;
   #dsmow205#9  = #caman303#155;

   |PINPA #0#dsmow205;
   |PINDA #0#dsmow205;

   |SI nModo = 4;
       |PAUSA;
   |SINO;
       |ENDATOS #1#dsmow205;
       |SI FSalida = 0;
           |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
                 nHCampo = nDCampo + 94;
                 #caman303#nHCampo# = #dsmow205#nDCampo#;
           |SIGUE;
           #caman303#155 = #dsmow205#9;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Punto01_224;
   |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
         nHCampo = nDCampo + 94;
         #dsmow224#nDCampo# = #caman303#nHCampo#;
   |SIGUE;

   aAlfa = "S";
   #dsmow224#9  = #caman303#155;
   #dsmow224#10 = #caman303#158;
   #dsmow224#11 = #caman303#159;
   |SI #dsmow224#10 = " "; #dsmow224#10 = "N"; |FINSI;
   |SI #dsmow224#11 = " "; #dsmow224#11 = "N"; |FINSI;
   |SI nSw = 2;
       aAlfa = "N";
       #dsmow224#10 = " ";
       #dsmow224#11 = " ";
   |FINSI;
   |C_M #dsmow224#10, 1, aAlfa;
   |C_M #dsmow224#11, 1, aAlfa;

   nOk = 0;
   |SI #caman303#94 = "S"; nOk = 1; |FINSI;
   |SI #caman303#97 = "S"; nOk = 1; |FINSI;

   |SI nOk = 1; |Y nSw = 1;
       #caman303#158 = "N";
       #dsmow224#10  = "N";
       #dsmow224#10  = "N";
       |C_M #dsmow224#10, 1, "N";
   |FINSI;

   |PINPA #0#dsmow224;
   |PINDA #0#dsmow224;

   |SI nModo = 4;
       |PAUSA;
   |SINO;
       |ENDATOS #1#dsmow224;
       |SI FSalida = 0;
           |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
                 nHCampo = nDCampo + 94;
                 #caman303#nHCampo# = #dsmow224#nDCampo#;
           |SIGUE;
           #caman303#155 = #dsmow224#9;
           #caman303#158 = #dsmow224#10;
           #caman303#159 = #dsmow224#11;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Punto01_227;
   |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
         nHCampo = nDCampo + 94;
         #dsmow227#nDCampo# = #caman303#nHCampo#;
   |SIGUE;

     |SI #caman303#155 = "S"; |Y #caman303#171 = " ";
         #caman303#171 = "S";
     |FINSI;
     |SI #caman303#155 = "X";
         #caman303#171 = "N";
         #caman303#155 = "S";
     |FINSI;

   aAlfa = "S";
   #dsmow227#9  = #caman303#155;
   #dsmow227#10 = #caman303#158;
   #dsmow227#11 = #caman303#159;
   #dsmow227#12 = #caman303#171;
   |SI #dsmow227#10 = " "; #dsmow227#10 = "N"; |FINSI;
   |SI #dsmow227#11 = " "; #dsmow227#11 = "N"; |FINSI;

   nOk = 0;
   |SI #caman303#94 = "S"; nOk = 1; |FINSI;
   |SI #caman303#97 = "S"; nOk = 1; |FINSI;

   |SI nOk = 1;
       #caman303#158 = "N";
       #dsmow227#10  = "N";
       |C_M #dsmow227#10, 1, "N";
   |FINSI;

   |PINPA #0#dsmow227;
   |PINDA #0#dsmow227;

   |SI nModo = 4;
       |PAUSA;
   |SINO;
       |ENDATOS #1#dsmow227;
       |SI FSalida = 0;
           |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
                 nHCampo = nDCampo + 94;
                 #caman303#nHCampo# = #dsmow227#nDCampo#;
           |SIGUE;
           #caman303#155 = #dsmow227#9;
           #caman303#158 = #dsmow227#10;
           #caman303#159 = #dsmow227#11;
           #caman303#171 = #dsmow227#12;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Identificacion;

   nSw = 0;
   |SI enEjercicio ] 2018;      nSw = 3; |FINSI;
   |SI enEjercicio = 2018;
       |SI #caman303#45 = "D"; |O #caman303#45 = "M";
           |SI #caman303#1 < 12; nSw = 1; |FINSI;
           |SI #caman303#1 = 1;  nSw = 2; |FINSI;
       |SINO;
           |SI #caman303#1 < 4; nSw = 1; |FINSI;
       |FINSI;
   |FINSI;

   |PUSHV 0501 2380;
   |SI nSw = 0;             |HAZ Punto01_205; |FINSI;
   |SI nSw = 1; |O nSw = 2; |HAZ Punto01_224; |FINSI;
   |SI nSw = 3;             |HAZ Punto01_227; |FINSI;
   |POPV;
|FPRC;

|PROCESO RegimenGeneral;
   |PUSHV 0501 2380;
   |PINTA 0516, "Tipo Periodo:    Periodo:      A¤o:    ";
   |PINTA 0530, #caman303#45;
   |PINTA 0542, #caman303#1;
   |PINTA 0552, #caman303#2;

   |PARA nDCampo = 5;  |SI nDCampo [ 119;  |HACIENDO nDCampo = nDCampo + 1;
         #dsmow206#nDCampo# = #caman303#nDCampo#;
   |SIGUE;
   #dsmow206#120 = #caman303#154;
   |PINPA #0#dsmow206;
   |PINDA #0#dsmow206;

   |SI nModo = 4;
      |ENDATOS #4#dsmow206;
   |SINO;
      |ENDATOS #1#dsmow206;
      |SI FSalida = 0;
          |PARA nDCampo = 5;  |SI nDCampo [ 119;  |HACIENDO nDCampo = nDCampo + 1;
                #caman303#nDCampo# = #dsmow206#nDCampo#;
          |SIGUE;
          #caman303#154 = #dsmow206#120;

||   |HAZ TotalEsp390;
      |FINSI;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO a390Pan01;
   |PUSHV 0501 2380;
   |PINTA 0516, "Tipo Periodo:    Periodo:      A¤o:    ";
   |PINTA 0530, #caman303#45;
   |PINTA 0542, #caman303#1;
   |PINTA 0552, #caman303#2;

  |PARA nDCampo = 0;  |SI nDCampo [ 24;  |HACIENDO nDCampo = nDCampo + 1;
        nHCampo = nDCampo + 120;
        #dsmow220#nDCampo# = #caman303#nHCampo#;
  |SIGUE;
  #dsmow220#25 = #caman303#160;
  #dsmow220#26 = #caman303#161;
  #dsmow220#27 = #caman303#162;
  #dsmow220#28 = #caman303#163;
  #dsmow220#29 = #caman303#172;

  |PINPA #0#dsmow220;
  |PINDA #0#dsmow220;

  |SI nModo = 4;
      |PAUSA;
      || |ENDATOS #4#dsmow220;
  |SINO;
     |ENDATOS #1#dsmow220;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 24;  |HACIENDO nDCampo = nDCampo + 1;
               nHCampo = nDCampo + 120;
               #caman303#nHCampo# = #dsmow220#nDCampo#;
         |SIGUE;
         #caman303#160 = #dsmow220#25;
         #caman303#161 = #dsmow220#26;
         #caman303#162 = #dsmow220#27;
         #caman303#163 = #dsmow220#28;
         #caman303#172 = #dsmow220#29;
     |FINSI;
  |FINSI;
  |POPV;
|FPRC;

|PROCESO a390Pan02;
   |PUSHV 0501 2380;
   |PINTA 0516, "Tipo Periodo:    Periodo:      A¤o:    ";
   |PINTA 0530, #caman303#45;
   |PINTA 0542, #caman303#1;
   |PINTA 0552, #caman303#2;

   #dsmow221#0  = #caman303#145;
   #dsmow221#1  = #caman303#146;
   #dsmow221#2  = #caman303#147;
   #dsmow221#3  = #caman303#148;
   #dsmow221#4  = #caman303#149;
   #dsmow221#5  = #caman303#150;
   #dsmow221#6  = #caman303#151;
   #dsmow221#7  = #caman303#152;
   #dsmow221#8  = #caman303#153;
   #dsmow221#9  = #caman303#164;
   #dsmow221#10 = #caman303#165;
   #dsmow221#11 = #caman303#166;
   #dsmow221#12 = #caman303#167;
   #dsmow221#13 = #caman303#168;
   #dsmow221#14 = #caman303#169;
   #dsmow221#15 = #caman303#170;

   |PINPA #0#dsmow221;
   |PINDA #0#dsmow221;

   |SI nModo = 4;
       |PAUSA;
       ||  ||ENDATOS #4#dsmow221;
   |SINO;
       |ENDATOS #1#dsmow221;
       |SI FSalida = 0;
           #caman303#145 = #dsmow221#0;
           #caman303#146 = #dsmow221#1;
           #caman303#147 = #dsmow221#2;
           #caman303#148 = #dsmow221#3;
           #caman303#149 = #dsmow221#4;
           #caman303#150 = #dsmow221#5;
           #caman303#151 = #dsmow221#6;
           #caman303#152 = #dsmow221#7;
           #caman303#153 = #dsmow221#8;
           #caman303#164 = #dsmow221#9;
           #caman303#165 = #dsmow221#10;
           #caman303#166 = #dsmow221#11;
           #caman303#167 = #dsmow221#12;
           #caman303#168 = #dsmow221#13;
           #caman303#169 = #dsmow221#14;
           #caman303#170 = #dsmow221#15;

           |SI enEjercicio ] 2018;
               #caman303#171 = "N";
               |SI #caman303#153 ! 0;
                   #caman303#171 = "S";
               |FINSI;
          |FINSI;

       |FINSI;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO ClaveBaja4;
   #dsm30304#0 = #caman303#45;
   #dsm30304#1 = #caman303#1;
   #dsm30304#2 = #caman303#2;
   #dsm30304#3 = 01;
|FPRC;

|PROCESO ClaveAlta4;
   #dsm30304#0 = #caman303#45;
   #dsm30304#1 = #caman303#1;
   #dsm30304#2 = #caman303#2;
   #dsm30304#3 = 99;
|FPRC;

|PROCESO a390Pan03;
   |PUSHV 0501 2380;
   |PINTA 0516, "Tipo Periodo:    Periodo:      A¤o:    ";
   |PINTA 0530, #caman303#45;
   |PINTA 0542, #caman303#1;
   |PINTA 0552, #caman303#2;

   |PINPA #0#dsm30304;
   |SI nModo = 4;
       |ENTLINEAL #1#dsm30304, -4, 4, 21, 0, ClaveBaja4, ClaveAlta4;
   |SINO;
       |ENTLINEAL #1#dsm30304, -4, 2, 21, 0, ClaveBaja4, ClaveAlta4;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO TotalM05;
     #dsm30305#21 = #dsm30305#5  + #dsm30305#7  + #dsm30305#9;
     #dsm30305#21 = #dsm30305#21 + #dsm30305#11 + #dsm30305#13 + #dsm30305#15;
     #dsm30305#21 = #dsm30305#21 + #dsm30305#17 + #dsm30305#19 + #dsm30305#20;
     |PINTA #dsm30305#21;
|FPRC;

|PROCESO ClaveBaja5;
   #dsm30305#0 = #caman303#45;
   #dsm30305#1 = #caman303#1;
   #dsm30305#2 = #caman303#2;
   #dsm30305#3 = 1;
|FPRC;

|PROCESO ClaveAlta5;
   #dsm30305#0 = #caman303#45;
   #dsm30305#1 = #caman303#1;
   #dsm30305#2 = #caman303#2;
   #dsm30305#3 = 9;
|FPRC;

|PROCESO a390Pan04;
   |PUSHV 0501 2380;
   |PINTA 0516, "Tipo Periodo:    Periodo:      A¤o:    ";
   |PINTA 0530, #caman303#45;
   |PINTA 0542, #caman303#1;
   |PINTA 0552, #caman303#2;

   |PINPA #0#dsm30305;
   |SI nModo = 4;
       |ENTLINEAL #1#dsm30305, -4, 4, 21, 0, ClaveBaja5, ClaveAlta5;
   |SINO;
       |ENTLINEAL #1#dsm30305, -4, 2, 21, 0, ClaveBaja5, ClaveAlta5;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO NoMod390;

     |SI nMod390 = 0;
         |SI enNoMod390 = 0;
             aAlfa = "0000Empresa sin desglose en este apartado";
         |SINO;
             aAlfa = "0000Solo en el Ultimo Periodo";
         |FINSI;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PUSHV 1505 2380;

     |PARA; |SI; |HACIENDO;
            |MENUG a390Menu;
            a390Menu2 = FSalida;

            |SI a390Menu2 < "1";  |O a390Menu2 > "4";  |SAL;  |FINSI;

            |SI a390Menu2 = "1";    |HAZ a390Pan01;      |FINSI;
            |SI a390Menu2 = "2";    |HAZ a390Pan02;      |FINSI;
            |SI a390Menu2 = "3";    |HAZ a390Pan03;      |FINSI;
            |SI a390Menu2 = "4";    |HAZ a390Pan04;      |FINSI;
     |SIGUE;
     |POPV;
|FPRC;

|PROCESO ElMenu; |TIPO 0;
     |HAZ empresa;
     nModo = (FEntrada / 100) ! 0;
     |PARA; |SI; |HACIENDO;
            |MENUG aMenu;
            aMenu2 = FSalida;

            |SI aMenu2 < "1";  |O aMenu2 > "3";  |SAL;  |FINSI;

            |SI aMenu2 = "1";    |HAZ Identificacion;      |FINSI;
            |SI aMenu2 = "2";    |HAZ RegimenGeneral;      |FINSI;
            |SI aMenu2 = "3";    |HAZ NoMod390;            |FINSI;
     |SIGUE;
|FPRC;

|PROCESO totales; |TIPO 3;
   |HAZ ElMenu;

   #caman303#20 = #caman303#7  + #caman303#10  + #caman303#13  + #caman303#16;
   #caman303#20 = #caman303#20 + #caman303#19  + #caman303#48  + #caman303#50;
   #caman303#20 = #caman303#20 + #caman303#104 + #caman303#106 + #caman303#108;
   #caman303#25 = #caman303#21 + #caman303#43 + #caman303#22 + #caman303#44 + #caman303#51 + #caman303#58;
   #caman303#25 = #caman303#25 + #caman303#23 + #caman303#24 + #caman303#61 + #caman303#110;
   #caman303#26 = (#caman303#20 - #caman303#25) + #caman303#118;
   #caman303#28 = #caman303#26 % #caman303#27;

   |SI nMod390 = 0;
       |PDEFECTO #caman303, 120,154;
       |PDEFECTO #caman303, 160,172;
   |SINO;
       #caman303#155 = "S";
       |SI #caman303#153 = 0; |Y enEjercicio < 2018;
           #caman303#155 = "N";
       |FINSI;
       |SI #caman303#153 = 0; |Y enEjercicio ] 2018;
            #caman303#171 = "S";
       |FINSI;
    |FINSI;
|FPRC;

|| *************************************************************************
|| *************************************************************************
|PROCESO per_sopor1;
    |SI #caman303#45 = "A"; #caivasop#44 = 1; |FINSI;
    |SI #caman303#45 = "T";
        alfa1 = #caivasop#3;   alfa1 = alfa1 % -104;      || saca a¤o
        alfa2 = "31.03." + alfa1;  trim1 = alfa2;  || primer trimestre
        alfa2 = "30.06." + alfa1;  trim2 = alfa2;  || segundo trimestre
        alfa2 = "30.09." + alfa1;  trim3 = alfa2;  || tercer trimestre
        |SI #caivasop#3 [ trim1;                   #caivasop#44 = 1;  |FINSI;
        |SI #caivasop#3 > trim1;|Y #caivasop#3 [ trim2;   #caivasop#44 = 2;  |FINSI;
        |SI #caivasop#3 > trim2;|Y #caivasop#3 [ trim3;   #caivasop#44 = 3;  |FINSI;
        |SI #caivasop#3 > trim3;                   #caivasop#44 = 4;  |FINSI;
    |FINSI;
    |SI #caman303#45 = "M";  |O #caman303#45 = "D";
        alfa1 = #caivasop#3;  alfa1 = alfa1 % 402;      || saca mes
        #caivasop#44 = alfa1;
    |FINSI;
    |GRABA 020#caivasop.a;
    |LIBERA #caivasop;
|FPRC;

|DEFBUCLE per_sopor;
 #caivasop#1;
 ;
  1, "  ",      1;
 99, "zz", 999999;
 be;
 NULL, per_sopor1;
|FIN;

|PROCESO per_reper1;
    |SI #caman303#45 = "A"; #caivarep#44 = 1; |FINSI;
    |SI #caman303#45 = "T";
        alfa1 = #caivarep#3;   alfa1 = alfa1 % -104;      || saca a¤o
        alfa2 = "31.03." + alfa1;  trim1 = alfa2;  || primer trimestre
        alfa2 = "30.06." + alfa1;  trim2 = alfa2;  || segundo trimestre
        alfa2 = "30.09." + alfa1;  trim3 = alfa2;  || tercer trimestre
        |SI #caivarep#3 [ trim1;                   #caivarep#44 = 1;  |FINSI;
        |SI #caivarep#3 > trim1;|Y #caivarep#3 [ trim2;   #caivarep#44 = 2;  |FINSI;
        |SI #caivarep#3 > trim2;|Y #caivarep#3 [ trim3;   #caivarep#44 = 3;  |FINSI;
        |SI #caivarep#3 > trim3;                   #caivarep#44 = 4;  |FINSI;
    |FINSI;
    |SI #caman303#45 = "M";  |O #caman303#45 = "D";
        alfa1 = #caivarep#3;  alfa1 = alfa1 % 402;      || saca mes
        #caivarep#44 = alfa1;
    |FINSI;

    |GRABA 020#caivarep.a;
    |LIBERA #caivarep;
|FPRC;

|DEFBUCLE per_reper;
    #caivarep#1;
    ;
     1, "  ",      1;
    99, "zz", 999999;
    be;
    NULL, per_reper1;
|FIN;

|PROCESO Recalculo;
     |BUCLE per_reper;    || revisa los periodos
     |BUCLE per_sopor;
|FPRC;

|| /////////////////////////////////////////////////////////////////
|PROCESO Tipo1; |TIPO 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;  |ACABA;  |FINSI;

     nEjer = 2000 + #caman303#2;

     aAlfa = "dsmo3401;";
     aAlfa = aAlfa + (("00000" + #caman303#0) % -105);    || Empresa
     aAlfa = aAlfa + (("0000" + nEjer) % -104);    || Ejercicio
     aAlfa = aAlfa + (("00" + #caman303#1) % -102);       || Periodo
     aAlfa = aAlfa + "340";                        || Modelo
     aAlfa = aAlfa + "00";                         || Complemento
     aAlfa = aAlfa + "01";                         || Actividad
     aAlfa = aAlfa + "03";                         || Tipo de entrada
     aAlfa = aAlfa + "0";                          || Mensaje

     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO Boton340;
     |LEE 000#caman303.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nEjer = 2000 + #caman303#2;

     aAlfa = "|:agicont/dsmo3401 canempr1 " + (("00000" + #30#2) % -105) + #30#3 + ";";
     aAlfa = aAlfa + (("00000" + #caman303#0) % -105);    || Empresa
     aAlfa = aAlfa + (("0000" + nEjer) % -104);    || Ejercicio
     aAlfa = aAlfa + (("00" + #caman303#1) % -102);       || Periodo
     aAlfa = aAlfa + "340";                        || Modelo
     aAlfa = aAlfa + "00";                         || Complemento
     aAlfa = aAlfa + "01";                         || Actividad
     aAlfa = aAlfa + "01";                         || Tipo de entrada
     aAlfa = aAlfa + "0";                          || Mensaje

     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO Tipo14;  |TIPO 14;
     |SI nBoton340 ! -1;
         |SI #caportad#104 = "N";
             |ESTADO_CONTROL nBoton340, "DISABLE";
             |ACABA;
         |FINSI;

         nModo = (FEntrada / 100) ! 0;
         |SI nModo ! 4;
             |ESTADO_CONTROL nBoton340, "DISABLE";
             |ACABA;
         |FINSI;

         |LEE 000#caman303.=;
         |SI FSalida ! 0;
               |ESTADO_CONTROL nBoton340, "DISABLE";
         |SINO;
               |ESTADO_CONTROL nBoton340, "ENABLE";
         |FINSI;

         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON, Modelo 340 ", 0562, 0578, Boton340;
     nBoton340 = FSalida;

     |ESTADO_CONTROL nBoton340, "DISABLE";
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |FIN_CONTROL_WINDOWS nBoton340;
|FPRC;
