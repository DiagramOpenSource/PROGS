|FICHEROS;
    c3gedia0 #0;
    caivarep #15;
    caivasop #16;
    calicont #31;
    canempre #30;   || Empresas contable.
|FIN;

|VARIABLES;
||    &eaConDes = "";
    &entrada = 1;
    lin = 0;
    sw_desc = 0;
    fecalf = "";
    men1   = "    NO EXISTE EMPRESA";
    traba1 = "";

    &swlin = 0;
    &descuadre = 0;
    &a_debe = 0;
    &a_haber = 0;
    &contra = "";
    contra_d = "";
    contra_h = "";
    swex_con = 0;
    informe = "";
    inform1 = "caditra0";
    inform2 = "caditra2";
    inform3 = "caditra1";
    inform4 = "caditra3";
    {-1}menu = "";
        menu1 = "2400";
        menu2 = "1";
        menu3 = " Elija opcion: ";
        menu4 = "PI";
        menu5 = " Pantalla ";
        menu6 = " Impresora ";

   &hiva_1 = "";
   &hiva_2 = "";
   &hiva_3 = "";
   &hiva_4 = @;

  &eaDesPac  = "";
  &swVarios  = 0;
  &enDDiario = 0;
  &enHDiario = 0;
  &efDFechas = @;
  &efHFechas = @;
  &enDDocume = 0;
  &enHDocume = 0;
  &enBorraAu = 0;

  empcon = 0;
  ejecon = 0;
  leidos = 0;
  dirfich0 = "";
  emp1 = 0;
  per1 = 0;
  xx = 0;
  yy = 0;
  anu = 0;
  desde = 0;
  hasta = 0;
  x = 0;
  y = 0;
  varcamp = 0;
  any = 0;
  &r_emp = 0;
  &r_per = 0;
  sw_pagina = 0;
  swalgun = 0;
  men9 = "     Empresa Contable INACTIVA ";
  &pagina = 0;
  sw = 0;
  nSwAlgun = 0;
|FIN;

|INCLUYE condes_i;
|INCLUYE acceso_i;
|INCLUYE diario_i;

|| *************************************************************************
||                        CALCULOS DE PANTALLA
|| *************************************************************************

|PROCESO fechasb; |TIPO 7;
   #0#4 = fec1;
   #0#5 = fec2;
   |PINTA #0#4;
   |PINTA #0#5;
|FPRC;

|PROCESO &c_pagina;
|SI sw_pagina = 0 ;
        pagina = 1;
        sw_pagina = 1;
|SINO;
        pagina = pagina + 1;
|FINSI;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SUB_EJECUTA "caconemp.run";
  |ERROR;
  |SI Campo = 16;
      #0#16 = r_emp;
      #0#18 = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
  |SI Campo = 17;
      #0#17 = r_emp;
      #0#19 = r_per;
      |PTEC 802;
  |FINSI;
  |SI Campo ] 20;
      #0Campo = r_emp;
      varcamp = Campo + 20;
      #0varcamp = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
|FPRC;

|PROCESO mayor1;
  |SI #0Campo = "N";
      |PARA x = 20;  |SI x [ 59;  |HACIENDO x = x + 1;
            |CAMPO_MODIFICA #0x,1,"S";
      |SIGUE;
      #0#16 = 0;
      #0#18 = 0;
      #0#17 = 0;
      #0#19 = 0;
      |CAMPO_MODIFICA #0#16,1,"N";
      |CAMPO_MODIFICA #0#18,1,"N";
      |CAMPO_MODIFICA #0#17,1,"N";
      |CAMPO_MODIFICA #0#19,1,"N";
      |PINTA #0#16;
      |PINTA #0#19;
      |PINTA #0#17;
      |PINTA #0#19;
  |SINO;
      |PARA x = 20;  |SI x [ 59;  |HACIENDO x = x + 1;
            #0x = 0;
            |CAMPO_MODIFICA #0x,1,"N";
      |SIGUE;
      |CAMPO_MODIFICA #0#16,1,"S";
      |CAMPO_MODIFICA #0#18,1,"S";
      |CAMPO_MODIFICA #0#17,1,"S";
      |CAMPO_MODIFICA #0#19,1,"S";
  |FINSI;
|FPRC;

|PROCESO desasien;
  |SI #0#1 < #0#0;
      |MENAV "     Error en Introduccion";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO desdiario;
  |SI #0#8 < #0#7;
      |MENAV "     Error en Introduccion";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO no_dep; |TIPO 7;
   alfa1 = #30#24;
   |CAMPO_MODIFICA #0#13, 1, alfa1;
   |CAMPO_MODIFICA #0#14, 1, alfa1;
|FPRC;

|| --------------- comprueba desde-hasta empresas ---------------------------
|PROCESO buscaem1;
  |SI #30#21 = "I"; |ACABA; |FINSI;
  |SI #30#26 ! any; |ACABA; |FINSI;
  leidos = 1;
|FPRC;

|DEFBUCLE buscaempre;
 #30#1;
 ;
 #0#16,desde;
 #0#17,hasta;
 e;
 NULL,buscaem1;
|FIN;


|PROCESO buclempre;
  |SI #0#18 > #0#19;
      |MENAV "     ERROR EN INTRODUCCION";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #0#16 = 0;  |Y #0#17 = 0;  |ACABA;  |FINSI;
  desde = #0#18;
  hasta = #0#19;
  leidos = 0;
  |BUCLE buscaempre;
  |SI leidos = 0;
      |MENAV "    ATENCION SELECCION VACIA";
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO deshas;
  |SI #0#17 < #0#16;
      |MENAV "      Error en Introduccion";
      |ERROR;
  |FINSI;
|FPRC;

|| ------------------------------------------------------------------------


|PROCESO nomodi;
      |PARA x = Campo + 1;  |SI x [ 39;  |HACIENDO x = x + 1;
            #0x = 0;
            |CAMPO_MODIFICA #0x,1,"N";
            y = x + 20;
            #0y = 0;
            |CAMPO_MODIFICA #0y,1,"N";
      |SIGUE;
      y = Campo + 20;
      #0y = 0;
      |CAMPO_MODIFICA #0y,1,"N";
      |PINTA #0y;
|FPRC;


|PROCESO esbuena; || desde campo de empresas seleccion
  |SI FSalida = 2; |ACABA; |FINSI;
  |SI #0Campo = 0; |HAZ nomodi;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0Campo;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0Campo;
      |MENAV "     NO Existe la empresa Contable ";
      |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2;|ACABA;|FINSI;
  x = Campo - 20;
  |SI #0x = 0;  |ACABA;  |FINSI;
  |ABRE #30;
  x = Campo - 20;
  #30#2 = #0x;
  #30#3 = #0Campo;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la empresa Contable";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #30;
  |SI #30#21 = "I";
      |MENAV men9;
      |ERROR;
      |ACABA;
  |FINSI;
  leidos = 0;
  |HAZ buscaem1;
  |SI leidos = 0;
      |MENAV "     NO Corresponde el a¤o contable";
      |ERROR;
      |ACABA;
  |FINSI;
  x = Campo + 20;
  #0x = #30#1;
  |PINTA #0x;
  x = Campo - 20;
  alfa1 = #0x;
  alfa2 = #0Campo;
|FPRC;

|| **********************************************************************
||                       CALCULOS DE IMPRESION
|| **********************************************************************
|| ---------- Seleccion DESDE / HASTA Empresa.

|PROCESO esdesd1;
  |DBASE dir_fich;
  dirfich0 = dir_fich + "fich/";
  alfa1 = #30#2;
  alfa2 = #30#3;
  emp1 = #30#2;
  per1 = #30#3;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
  dirfich0 = dirfich0 + alfa1 + alfa2 + "/";

  |SI #30#26 = any; |Y #30#21 ! "I";
      |HAZ haztodo;
  |FINSI;
|FPRC;

|DEFBUCLE esdesde;
 #30#1;
 ;
 #0#16,#0#18;
 #0#17,#0#19;
 e;
 NULL,esdesd1;
|FIN;

|| ---------- Seleccion en parrilla.

|PROCESO esunaauna;
      |PARA xx = 20;  |SI xx [ 39;  |HACIENDO xx = xx + 1;
            |SI #0xx = 0;  |SAL;  |FINSI;
            |DBASE dir_fich;
            dirfich0 = dir_fich + "fich/";
            yy = xx + 20;
            emp1 = #0xx;
            per1 = #0yy;
            alfa1 = #0xx;
            alfa2 = #0yy;
            alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
            alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
            dirfich0 = dirfich0 + alfa1 + alfa2 + "/";
              || lee empresa
                 |ABRE #30;
                   #30#2 = emp1;
                   #30#3 = per1;
                 |LEE 011#30=;
                 |CIERRA #30;
                 |SI #30#26 = any; |Y #30#21 ! "I";
                     |HAZ haztodo;
                 |FINSI;
      |SIGUE;
|FPRC;

|| *********************************************************************
|PROCESO AImprimir_i;
   swlin = 0;
   contra = "";
   contra_d = #1#10;
   contra_h = #1#8;
   |SI #2#8 = "D";
      a_debe = #2#9;
      a_haber = 0;
      contra = contra_d;
   |SINO;
      a_debe = 0;
      a_haber = #2#9;
      contra = contra_h;
   |FINSI;
   |PRINT;
|FPRC;

|PROCESO Apertura2008_i;
   |SALVA_DATOS #1;
   #1#3 = #1#3 - 1; |SI #1#3 [ 0; #1#3 = 1; |FINSI;
   descuadre = (#1#4 - #1#5) ! EURODB;
   swlin = 1;
   |SI descuadre ! 0;
      swlin = 2;
      |SI descuadre < 0; descuadre = descuadre * (-1); |FINSI;
   |FINSI;
   |PRINT;

   #1#4 = 0; #1#5 = 0; #1#6 = 0;
   nOpe = 0; |BUCLE Leo8m004;

   #1#3 = #1#3 + 1;
   descuadre = (#1#4 - #1#5) ! EURODB;
   swlin = 1;
   |SI descuadre ! 0;
      swlin = 2;
      |SI descuadre < 0; descuadre = descuadre * (-1); |FINSI;
   |FINSI;
   |PRINT;

   nLinea = 0;
   nOpe   = 1; |BUCLE Leo8m004;
   nSwAlgun = 1;
   |REPON_DATOS #1;
|FPRC;

|PROCESO porimpre;
  |SI #2#21 < #0#13;  |O #2#21 > #0#14;  |ACABA;  |FINSI;
  |SI #2#6 < #0#9;  |O #2#6 > #0#10;  |ACABA;  |FINSI;
  #4#0 = #2#4;
  #4#1 = #2#5;
  |LEE 040#4=;
  |SI FSalida ! 0;
      |DDEFECTO #4;
  |FINSI;
  swlin = 0;

  contra = "";
  contra_d = #1#10;
  contra_h = #1#8;
  |HAZ leocontra;

  eaDesPac = #2#24;   ||Descripcion
  |QBF eaDesPac;
  eaDesPac = eaDesPac + " " + #2#7;

  |SI #2#8 = "D";
      a_debe = #2#9;
      a_haber = 0;
      |SI #2#3 < 30; |O swex_con = 1;
          contra = contra_d;       || contrapartida DEBE
      |FINSI;
  |SINO;
      a_debe = 0;
      a_haber = #2#9;
      |SI #2#3 < 30; |O swex_con = 1;
          contra = contra_h;        || contrapartida HABER
      |FINSI;
  |FINSI;

  |SI d_iva = "S";  |HAZ lecturaIVA; |FINSI;
  |PRINT; sw = 1;
|FPRC;

|PROCESO lecturaIVA;
 hiva_1 = ""; hiva_2 = "";
 hiva_3 = ""; hiva_4 = "";
 |SI #2#12 = "R";
     |SI #2#19 = "F"; |O #2#19 = "f"; |O #2#19 = " ";
         |ABRE #15;
         #15#0  = #2#13;
         #15#2  = #2#14;
         #15#27 = #2#15;
         |LEE 001#15=;
         |SI FSalida = 0;
             hiva_1 = #15#0;
             hiva_2 = #15#2;
             hiva_3 = #15#27;
             hiva_4 = #15#3;
         |FINSI;
         |CIERRA #15;
     |FINSI;
 |FINSI;
 |SI #2#12 = "S";
     |SI #2#19 = "F"; |O #2#19 = "f"; |O #2#19 = " ";
         |ABRE #16;
         #16#0  = #2#13;
         #16#2  = #2#14;
         #16#27 = #2#15;
         |LEE 001#16=;
         |SI FSalida = 0;
             hiva_1 = #16#0;
             hiva_2 = #16#2;
             hiva_3 = #16#27;
             hiva_4 = #16#3;
         |FINSI;
         |CIERRA #16;
     |FINSI;
 |FINSI;

 |QBF hiva_1; |SI hiva_1 ! ""; hiva_1 = ("00"+hiva_1) % -102; |FINSI;
 |QBF hiva_2; |SI hiva_2 ! ""; hiva_2 = ("000000"+hiva_2) % -106; |FINSI;
 |QBF hiva_3; |SI hiva_3 ! ""; hiva_3 = "/"+hiva_3; |FINSI;
|FPRC;

|PROCESO leocontra;
 swex_con = 0;
 #31#0 = #2#0;
 #31#1 = #2#1;
 #31#2 = #2#2;
 #31#3 = #2#3;
 |LEE 001#31=;
 |SI FSalida = 0;
     swex_con = 1;
     contra_h = #31#4;
     contra_d = #31#4;
 |FINSI;
|FPRC;

|PROCESO bucleimp;
  nConcepto    = 0;
  aDescripcion = "";
  sw_alguno = 0;
  |BUCLELIN 2alguno#1;
  |SI sw_alguno = 0;  |ACABA;  |FINSI;

  |SI #0nCa17 = "S";
       |SI #1#0 = 0; |Y nDiaAper = 0;
           |HAZ VerAper08_d;
           |SI nIgual = 1;
               |HAZ Apertura2008_i;
               nDiaAper = 1;
               |ACABA;           ||este asiento se trata de forma diferente
           |FINSI;
       |FINSI;
  |FINSI;

  descuadre = #1#4 - #1#5;
  |SI descuadre = 0;
      swlin = 1;
      |PRINT; sw = 1;
  |SINO;
      swlin = 2;
      |SI descuadre < 0; descuadre = descuadre * (-1); |FINSI;
      |PRINT; sw = 1;
  |FINSI;
  |BUCLELIN 0porimpre#1;
|FPRC;

|DEFBUCLE caditra01;
 #1#2;
 ;
 #0#0, #0#4, #0#7, #0#2;
 #0#1, #0#5, #0#8, #0#3;
 e;
 NULL, bucleimp;
|FIN;

|DEFBUCLE caditra02;
 #1#1;
 3;
 #0#7, #0#4, #0#2, #0#0;
 #0#8, #0#5, #0#3, #0#1;
 e;
 NULL, bucleimp;
|FIN;

|DEFBUCLE caditra03;
 #1#3;
 3,1,0;
 #0#2, #0#2,  #0#0, #0#4, #0#7;
 #0#3, #0#3,  #0#1, #0#5, #0#8;
 e;
 NULL, bucleimp;
|FIN;

|PROCESO haztodo;
  enEmpresa = #canempre#2;
  enPeriodo = #canempre#3;
  swOperacion = 0
  |SUB_EJECUTA "camoneda.tab";

  |DDEFECTO #3;
  |PATH_DAT #1  dirfich0;
  |PATH_DAT #2  dirfich0;
  |PATH_DAT #4  dirfich0;
  |PATH_DAT #8  dirfich0;
  |PATH_DAT #15 dirfich0;
  |PATH_DAT #16 dirfich0;
  |PATH_DAT #31 dirfich0;
  |PATH_DAT #404 dirfich0;

  anu = 1900 + #30#26;
  |SI anu [ 1970;  anu = anu + 100;  |FINSI;
  empcon = #30#1;
  ejecon = #30#26;
  sw = 0;
  nDiaAper = 0;
  |ABRE #31;
  |ABRE #4;
  |SI m_orden = 1; |BUCLE caditra01; |FINSI;
  |SI m_orden = 2; |BUCLE caditra02; |FINSI;
  |SI m_orden = 3; |BUCLE caditra03; |FINSI;
  |SI sw ! 0; |PIEINF; |FINSI;
  |CIERRA #4;
  |CIERRA #31;
|FPRC;

|PROCESO impre; |TIPO 3;
   opcion  = 2;  ||por impresora
   m_orden = #0#11;
   d_iva   = #0#12;

   |IMPRE 0;
   |SI FSalida ! 0;
       |MENAV "    Error en Impresora.";
       |ACABA;
   |FINSI;

   informe = inform1;
   |SI d_iva = "S"; informe = inform2; |FINSI;
   |INFOR informe;
   |SI FSalida ! 0;
       |MENAV "    Error en Informe ";
       |FINIMP;
       |ACABA;
   |FINSI;

   |SI #0#15 = "S";
       |BUCLE esdesde;
   |SINO;
       |HAZ esunaauna;
   |FINSI;

   |FININF;
   |FINIMP;
|FPRC;

|PROGRAMA;

   |HAZ inicio;
   |HAZ eVarEmpresa;

   any = #30#26
   |DBASE dir_fich;
   dir_fich = dir_fich + "fich/";
   |HAZ VerCaconimp;
   |SI eaConDes ! "N"; inform1 = inform3; inform2 = inform4; |FINSI;

   nCa17 = 80;
   nCa19 = 82;
   |ABRE #8;
   |DDEFECTO #8;
   #8#0 = 1;
   |LEE 001#8=;
   |CIERRA #8;

   |CLS;
   |CABEZA "Diario Trabajo Gral";
   |PINPA #0#0;
||   |SI enEjercicio ! 2008;
       #0#80 = "N";
       |C_V #0#80,1,"N"; |C_M #0#80,1,"N";
       |C_V #0#82,1,"N"; |C_M #0#82,1,"N";
||  |FINSI;

  |PINDA #0#0;                    || Pinta los datos por defecto
  |ENDATOS #1#0;                  || Seleccion informe
|FPRO;
