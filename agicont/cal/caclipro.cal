|FICHEROS;
  caclipro #0;
  caforpag #1;
  eosclipr #2;
  agipobla #3;
  agiprovi #4;
  caprovin #5;
  agim0016 #7;
  camanban;
|FIN;

|VARIABLES;
  esclipro = "";
  &entrada = 0;
  pepe = 0;
  cuenta = 0;
  digito = 0;
  cta = "";
  long1 = "";
  long = 0;
  sw = 0;
  num = 0;
  men2  = "     Longitud de Cuenta Fuera de Nivel !";

     letra = "";
     alfa1 = "";
     alfa2 = "";
     final = "";
     x = "";
     pos1 = "";
     pos2 = "";
     pos3 = "";
     pos4 = "";
     nume1 = 0;
     nume2 = 0;
     cont = 0;
     lugar = 0;
     nifnum = 0;
     resto = 0;

    esalta = 0;
    directo = "";
    direct1 = "";
    traba = "";
    salida = 0;
    antes = 0;
  men6      = "    NConfirma el Alta en Fichero General (S/N): ";
  &agi   = "";
  &agi1  = "";
  &agi2  = "";
  &aste  = "";
     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;

   aAlfa   = "";
   aAlfa1  = "";
   aAlfa2  = "";
   aCadena = "";

   nCalc   = 0;

     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;

|PROCESO primentra;  |TIPO 8;
  |HAZ inicio;
  esclipro = "C";
  |HAZ tipo_81;
|FPRC;

|PROCESO creacod1; |TIPO 0;
  pos1 = #0#3;
  pos2 = "000" + pos1;
  traba = pos2 % -102;
  pos1 = #0#4;
  pos2 = "0000" + pos1;
  pos1 = pos2 % -103;
  #0#25 = traba + pos1;
|FPRC;

|PROCESO creacod2; |TIPO 0;
  pos1 = #0#15;
  pos2 = "000" + pos1;
  traba = pos2 % -102;
  pos1 = #0#16;
  pos2 = "0000" + pos1;
  pos1 = pos2 % -103;
  #0#26 = traba + pos1;
|FPRC;

|PROCESO antesde;  |TIPO 7;
   #0#23 = esclipro;
|FPRC;

|PROCESO cuenta; |TIPO 6;
  entrada = 1;
  salidas = FSalida;
  cuenta = Campo;
  digito = Campo + 1;
  p_alfa1 = #0cuenta;
  |HAZ punto;
  |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
  cta  = #0cuenta;
  |QBF cta;
  long1 = cta % A0;
  long = long1;
  cont = 0;
  sw = 0;
  |SI cta = 0;  |Y Campo = 21;
      sw = 1;
      #0digito = 1;
      |ACABA;
  |FINSI;
  |PARA num = 14; |SI num [ 19; |HACIENDO num = num + 1;
        cont = cont + 1
        |SI long = #30num;
            sw = 1;
            |SAL;
        |FINSI;
  |SIGUE;
  |SI sw = 0;
      |MENAV men2;
      |ERROR;
      |ACABA;
  |FINSI;
  #0digito = cont;
|FPRC;

|PROCESO modifica; |TIPO 7;
  |SI #30#21 = "N";
      |CAMPO_MODIFICA #0#10, 1, "N";
  |SINO;
      |CAMPO_MODIFICA #0#10, 1, "S";
  |FINSI;
|FPRC;

|PROCESO nocero; |TIPO 6;
  |SI #0#20 ! 0;  |ACABA;  |FINSI;
  |DDEFECTO #1;
  |ABRE #1;
  #1#0 = #0#20;
  |LEE 001#1=;              || graba el codigo cero para que no
  |SI FSalida ! 0;          ||/salga la pantalla
      |GRABA 020#1n;
  |FINSI;
  |CIERRA #1;
|FPRC;

|PROCESO letra_0;  |TIPO 6;
     |SI FSalida = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! ""; |Y #0#24 = "ES ";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO defcodi;  |TIPO 7;
  esalta = (FEntrada /100) !0;
  |SI esalta = 1;
      #0#0 = #0#10;
      |PINTA #0#0;
  |FINSI;
|FPRC;

|PROCESO quetecla;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |ENCAMPO #9#0;
|FPRC;

|PROCESO clienprov;
  traba = #0#9;
  |QBF traba;

  |SI traba = "";  |ACABA;  |FINSI;
  |SI aste = "*";  |ACABA;  |FINSI;
  |ABRE #2;
  #2#0 = #0#9;
  |LEE 011#2=;
  |SI FSalida = 0;
      #0#9 = #2#0;
      #0#1 = #2#1;
      traba = #2#2;
      |QBF traba;
      |SI traba = "";
          #0#2 = #2#3;
      |SINO;
          #0#2 = traba + " " + #2#3;
      |FINSI;
      traba = #0#2;
      |QBF traba;
      #0#2 = traba + ", " + #2#4;
      #0#3 = #2#7;
      #0#4 = #2#8;
      #0#5 = #2#9;
      #0#6 = #2#10;
      |PINTA #0#1;
      |PINTA #0#2;
      |PINTA #0#3;
      |PINTA #0#4;
      |PINTA #0#5;
      |PINTA #0#6;
  |SINO;
      |HAZ altaclipr;
  |FINSI;
  |CIERRA #2;
|FPRC;

|PROCESO tipo_81; || control de la ficha de clientes general
|SI aste  = "*"; |ACABA; |FINSI;
  |PATH_DAT #2 agi1;
  |PATH_DAT #3 agi1;
  |PATH_DAT #4 agi1;
  |PATH_DAT #7 agi1;

  |PATH_PAN #2 agi2;
  |PATH_PAN #3 agi2;
  |PATH_PAN #4 agi2;
  |PATH_PAN #7 agi2;
|FPRC;

|PROCESO altaclipr;
|SI aste = "*"; |ACABA; |FINSI;
    |CONFI men6;
    |SI FSalida = 0;
        |PUSHV 0501 2380;
        |PINPA #0#2;
        |DDEFECTO #2;
        #2#0 = #0#9;
        #2#1 = #0#1;
        #2#3 = #0#2;
        #2#7 = #0#3;
        #2#8 = #0#4;
        #2#9 = #0#5;
        #2#10= #0#6;
        |PINTA #2#0;
        |PINDA #0#2;
        |ENDATOS #1#2;
        |SI FSalida = 0;
            |POPV;
             #0#9 = #2#0;
             #0#1 = #2#1;
             traba = #2#2;
             |QBF traba;
             |SI traba = "";
                 #0#2 = #2#3;
             |SINO;
                 #0#2 = traba + " " + #2#3;
             |FINSI;
             traba = #0#2;
             |QBF traba;
             #0#2 = traba + ", " + #2#4;
             #0#3 = #2#7;
             #0#4 = #2#8;
             #0#5 = #2#9;
             #0#6 = #2#10;
             |PINTA #0#1;
             |PINTA #0#2;
             |PINTA #0#3;
             |PINTA #0#4;
             |PINTA #0#5;
             |PINTA #0#6;
            |GRABA 020#2n;                 || Graba el agicli
        |SINO;
            |POPV;
        |FINSI;
    |FINSI;
|LIBERA #2;
|FPRC;

|PROCESO conficha; |TIPO 6;
  |SI aste = "*"; |ACABA; |FINSI;
  |SI FSalida ! 10; |ACABA; |FINSI;
  antes = 0;
  |ABRE #2;
    |PUSHV 0501 2380;
    |PINPA #0#2;
  #2#0 = #0#9;
  |LEE 000#2];
  |CONSULTA #0#2;
  salida = FSalida;
  |CIERRA #2;
  |POPV;
  |SI salida = 0;
      #0#9 = #2#0;
      |PINTA #0#9;
  |SINO;
      antes = 1;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO cuapais;
 |SI FSalida ! 9; |ACABA; |FINSI;

 |PUSHV 1102 2260;
 |D_CUADRO 1102, 2260;

 |ATRI R;
 |PINTA 1203, " ----------------- PAISES COMUNITARIOS ------------------";

 |ATRI N;
 |PINTA 1303, " DE   Alemania     FR   Francia         LT   Lituania    ";
 |PINTA 1403, " AT   Austria      EL   Grecia          LU   Luxemburgo  ";
 |PINTA 1503, " BE   Belgica      GB   Gran Breta¤a    MT   Malta       ";
 |PINTA 1603, " CY   Chipre       NL   Holanda         PL   Polonia     ";
 |PINTA 1703, " DK   Dinamarca    HU   Hungria         PT   Portugal    ";
 |PINTA 1803, " SI   Eslovenia    IT   Italia          CZ   Rep.Checa   ";
 |PINTA 1903, " EE   Estonia      IE   Irlanda         SK   Rep.Eslovaca";
 |PINTA 2003, " FI   Finlandia    LV   Letonia         SE   Suecia      ";
 |PINTA 2103, " BG   Bulgaria     RO   Rumania         HR   Croacia     ";

 |ATRI I;
 |PINTA 1304 , "DE"; |PINTA 1322 , "FR"; |PINTA 1343 , "LT";
 |PINTA 1404 , "AT"; |PINTA 1422 , "EL"; |PINTA 1443 , "LU";
 |PINTA 1504 , "BE"; |PINTA 1522 , "GB"; |PINTA 1543 , "MT";
 |PINTA 1604 , "CY"; |PINTA 1622 , "NL"; |PINTA 1643 , "PL";
 |PINTA 1704 , "DK"; |PINTA 1722 , "HU"; |PINTA 1743 , "PT";
 |PINTA 1804 , "SI"; |PINTA 1822 , "IT"; |PINTA 1843 , "CZ";
 |PINTA 1904 , "EE"; |PINTA 1922 , "IE"; |PINTA 1943 , "SK";
 |PINTA 2004 , "FI"; |PINTA 2022 , "LV"; |PINTA 2043 , "SE";
 |PINTA 2104 , "BG"; |PINTA 2122 , "RO"; |PINTA 2043 , "HR";
 |ATRI 0;

 |PAUSA;
 |POPV;
|FPRC;

|PROCESO filtro; |TIPO 0;
 |SI FSalida = 9;
     |HAZ cuapais;
     |ERROR;
     |ACABA;
 |FINSI;
 alfa1 = #0Campo > " ";
 #0Campo = alfa1;
 |SI #0#24 = "   ";  #0#24 = "ES "; |FINSI;
 |SI #0#24 = "E  ";  #0#24 = "ES "; |FINSI;
 |PINTA #0Campo;

     |SI #0#24 = "ES ";  |ACABA;  |FINSI;
     |SI #0#24 = "DE ";  |ACABA;  |FINSI;
     |SI #0#24 = "AT ";  |ACABA;  |FINSI;
     |SI #0#24 = "BE ";  |ACABA;  |FINSI;
     |SI #0#24 = "DK ";  |ACABA;  |FINSI;
     |SI #0#24 = "FI ";  |ACABA;  |FINSI;
     |SI #0#24 = "FR ";  |ACABA;  |FINSI;
     |SI #0#24 = "EL ";  |ACABA;  |FINSI;
     |SI #0#24 = "GB ";  |ACABA;  |FINSI;
     |SI #0#24 = "NL ";  |ACABA;  |FINSI;
     |SI #0#24 = "IT ";  |ACABA;  |FINSI;
     |SI #0#24 = "IE ";  |ACABA;  |FINSI;
     |SI #0#24 = "LU ";  |ACABA;  |FINSI;
     |SI #0#24 = "PT ";  |ACABA;  |FINSI;
     |SI #0#24 = "SE ";  |ACABA;  |FINSI;
     |SI #0#24 = "CY ";  |ACABA;  |FINSI;
     |SI #0#24 = "SI ";  |ACABA;  |FINSI;
     |SI #0#24 = "EE ";  |ACABA;  |FINSI;
     |SI #0#24 = "HU ";  |ACABA;  |FINSI;
     |SI #0#24 = "LV ";  |ACABA;  |FINSI;
     |SI #0#24 = "LT ";  |ACABA;  |FINSI;
     |SI #0#24 = "MT ";  |ACABA;  |FINSI;
     |SI #0#24 = "PL ";  |ACABA;  |FINSI;
     |SI #0#24 = "CZ ";  |ACABA;  |FINSI;
     |SI #0#24 = "SK ";  |ACABA;  |FINSI;
     |SI #0#24 = "HR ";  |ACABA;  |FINSI;
     |SI #0#24 = "BG ";  |ACABA;  |FINSI;
     |SI #0#24 = "RO ";  |ACABA;  |FINSI;

||     |MENAV "     Codigo de Pais incorrecto. ";
||     |ERROR;
|FPRC;

|PROCESO NombreBanco; |TIPO 13;
   |ABRE #camanban;
   #camanban#0 = #caclipro#28;
   |LEE 000#camanban.=;
   |SI FSalida = 0;
      |PINTA 1624, #camanban#1;
   |FINSI;
   |CIERRA #camanban;

   |ATRI I;
   |SI #caclipro#38 = "R"; |PINTA 2159, "Recurrente"; |FINSI;
   |SI #caclipro#38 = "U"; |PINTA 2159, "Unico     "; |FINSI;
   |ATRI N;
|FPRC;

|PROCESO NombreBanc1;
   |HAZ NombreBanco;
|FPRC;

|PROCESO TrasPago;
   |ATRI I;
   |SI #caclipro#38 = "R"; |PINTA 2159, "Recurrente"; |FINSI;
   |SI #caclipro#38 = "U"; |PINTA 2159, "Unico     "; |FINSI;
   |ATRI N;
|FPRC;


|PROCESO Tipo7IBAN_Fpro;  |TIPO 7;
     aAlfa = #caclipro#30;   |QBF aAlfa;

     |SI aAlfa ! "";  |ACABA;  |FINSI;

     eaCta  = #caclipro#18 + #caclipro#17; |QBT eaCta;
     eaCta  = eaCta % -120;
     eaPais = #caclipro#39;
     |HAZ CalcuIBAN;

     #caclipro#30 = eaIBAN;
|FPRC;

|PROCESO Tipo0IBAN_Fpro;  |TIPO 0;
     eaCta  = #caclipro#18 + #caclipro#17; |QBT eaCta;
     eaCta  = eaCta % -120;
     eaPais = #caclipro#39;
     |HAZ CheqIBAN;

     aAlfa = #caclipro#30;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
         |SI FSalida = 0;
             #caclipro#30 = eaIBAN;
             |PINTA #caclipro#30;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;
