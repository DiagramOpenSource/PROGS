|| Procesos realizados por Olalla Hern ndez (Sevilla) 15-06-2000

|FICHEROS;

   escal012 #0;      ||Informe Cuentas Escalares (Varios Centros)
   escal001 #1;      ||Bloques
   escal003 #3;      ||Ctas. Escalares (L)
   camaasil #4;      ||Lineas de Apuntes
   escalw10 #5;      ||Temporal Cuentas/Departamentos
   escalw11 #6;      ||Temporal Escalar
   escalcop #7;      ||Copia escal003
   escalw12 #8;      ||Formulas Planilla
   escal005 #9;      ||Parametros Informe
   escalw13 #10;     ||Temporal Impresi¢n Escalar
   escalw15 #11;     ||F¢rmulas Par metros Informe
   escalce2 #20;     ||Impresion Centro 2
   escalce3 #40;     ||Impresion Centro 3
   canempre #30;     ||Empresas Contables

|FIN;


|VARIABLES;

  men = "";
  r_emp = 0;
  r_per = 0;
  i = 0;
  es_diario = "N";
  es_dpto = "N";
  num_niveles = 0;
  ultimo_nivel = 0;
  cta = "";
  long = "";
  dirfic = "";
  emp = "";
  emp1 = "";
  impor = 0;
  patron = "";
  len = "";
  trozo = "";
  len_num = 0;
  acumulado = 0;
  caracter = "";
  longi = "";
  alfa = "";
  nume = 0;
  numero = 0;
  parte = "";
  resultado = "";
  calculo = 0;
  x = 0;
  alfa2 = "";
  beta = "";
  alfa3 = "";
  contador = 0;
  cont = 0;
  sw = 0;
  informe = "escal010";
  sw1 = 0;
  total = 0;

  nume1 = 0;
  nume2 = 0;
  nume3 = 0;
  nume4 = 0;
  ope = "";
  calculo1 = 0;
  calculo2 = 0;
  fichero = "";
  fichero2 = "";
  razon = "";
  ejer = 0;

  porcion = "";
  centroi = 0;
  centrof = 0;

  c = 0;

|FIN;



|PROCESO nivel;

|| Proceso realizado para obtener informaci¢n sobre niveles.


  |DFICE dirfic;

   emp = dirfic % -107;
   emp = emp - "/";

   emp1 = emp % 101;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;

   emp1 = "";
   emp1 = emp % 201;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;

   emp1 = "";
   emp1 = emp % 301;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;

   emp1 = "";
   emp1 = emp % 401;
   |SI emp1 = "0"; emp = emp - "0"; |FINSI;


   |ABRE #30;
   |SELECT #2#30;
   #30#0 = emp;
   |LEE 001#30=;

   |SI FSalida = 0;

     num_niveles = #30#13;

     |SI num_niveles = 4; ultimo_nivel = #30#17; |FINSI;
     |SI num_niveles = 5; ultimo_nivel = #30#18; |FINSI;
     |SI num_niveles = 6; ultimo_nivel = #30#19; |FINSI;


   |FINSI;

   razon = #30#4;

   ejer = #30#26;

   |CIERRA #30;

|FPRC;




|PROCESO leedesde;

   |DDEFECTO #5;

    porcion = "";
    porcion = #4#4 % 102

    #5#0 = #4#4;
    |LEE 001#5=;
    |SI FSalida = 0; ||Existe el registro

      |SI porcion = "61"; |O porcion = "71";

          |SI #4#8 = "D";
              #5#3 = #5#3 + #4#9;
          |FINSI;
          |SI #4#8 = "H";
              #5#4 = #5#4 + #4#9;
          |FINSI;
          |GRABA 020#5a;
      |SINO;

          #5#1 = #5#1 + #4#9;
          |GRABA 020#5a;
      |FINSI;

    |SINO;  ||De FSalida

       |SI porcion = "61"; |O porcion = "71";

           |SI #4#8 = "D";
               #5#3 = #4#9;
           |FINSI;
           |SI #4#8 = "H";
               #5#4 = #4#9;
           |FINSI;
           |GRABA 020#5n;
       |SINO;

           #5#1 = #4#9;
           |GRABA 020#5n;
       |FINSI;
       |LIBERA #5;
    |FINSI;


|FPRC;


|PROCESO busqueda;

  ||Busco en la planilla, si para una cuenta de nivel superior,
  ||existe alguna cuenta de nivel inferior que debo excluir a la hora
  ||de acumular valores

|SI sw = 0;  ||Se trata de una cuenta de la planilla
  |QBF patron;
  cta = "";
  cta = #7#2;
  |QBF cta;
  long = cta % A0;

  |SI long = ultimo_nivel;
      len = "";
      len = patron % A0;
      len_num = len + 100;

      trozo = cta % len_num;

      |SI patron = trozo;

          #5#0 = #7#2;
          |LEE 001#5=;
          |SI FSalida = 0;
              #5#2 = "S";
              |GRABA 020#5a;
          |FINSI;
          |LIBERA #5;

      |FINSI;

   |FINSI;

|FINSI;



|SI sw = 1;  ||Se trata de una cuenta de una formula de la planilla
  |QBF patron;
  cta = "";
  cta = #8#2;
  |QBF cta;
  long = cta % A0;

  |SI long = ultimo_nivel;
      len = "";
      len = patron % A0;
      len_num = len + 100;

      trozo = cta % len_num;

      |SI patron = trozo;

          #5#0 = #8#2;
          |LEE 001#5=;
          |SI FSalida = 0;
              #5#2 = "S";
              |GRABA 020#5a;
          |FINSI;
          |LIBERA #5;

      |FINSI;

   |FINSI;

|FINSI;



|FPRC;


|DEFBUCLE busqueda;
  #7#1;
  ;
  #0#0,   1;
  #0#0, 999;
  be;
  NULL, busqueda;
|FIN;



|PROCESO acumular;

   |QBF patron;
   trozo = "";
   cta= "";
   long = "";
   len = "";
   len_num = 0;

   cta = #5#0;
   |QBF cta;
   long = cta % A0;
   len = patron % A0;
   len_num = len + 100;
   trozo = cta % len_num;
   |SI patron = trozo;
      |SI #3#5 = "+";
          acumulado = acumulado + #5#1;
      |FINSI;
      |SI #3#5 = "-";
          acumulado = acumulado - #5#1;
      |FINSI;
   |FINSI;

|FPRC;



|PROCESO calcular;

  |SI #5#3 ! 0; |O #5#4 !0;
      #5#1 = #5#3 - #5#4;
      |GRABA 020#5a;
  |FINSI;

|FPRC;



|DEFBUCLE calcular;
  #5#1;
  ;
  "            ";
  "zzzzzzzzzzzz";
  be;
  NULL, calcular;
|FIN;




|DEFBUCLE acumular;
  #5#1;
  2;
  "            ", "N";
  "zzzzzzzzzzzz", "N";
  be;
  NULL, acumular;
|FIN;


|PROCESO no_excluir;

  #5#2 = "N";
  |GRABA 020#5a;

|FPRC;


|DEFBUCLE no_excluir;
  #5#1;
  2;
  "            ", "S";
  "999999999999", "S";
  be;
  NULL, no_excluir;
|FIN;



|PROCESO guardar;


||Proceso utilizado para almacenar en el temporal escalw12, los componentes
||de las formulas de la planilla, separados en cuentas y en signos.

  |QBT alfa2;
  |QBT alfa3;

  |SI alfa2 ! "";
    contador = contador + 1;
    #8#0 = contador;
    #8#1 = "C";
    #8#2 = alfa2;
    |GRABA 020#8n;
  |FINSI;

  |SI alfa3 ! "";
    contador = contador + 1;
    #8#0 = contador;
    #8#1 = "O";
    #8#2 = alfa3;
    |GRABA 020#8n;
  |FINSI;


|FPRC;



|PROCESO guardar2;

||Proceso utilizado para almacenar en el temporal escalw15, los componentes
||de las formulas de los parametros del importe, separados en caracteres y
||en signos.



  |QBT alfa2;
  |QBT alfa3;

  |SI alfa2 ! "";
    contador = contador + 1;
    #11#0 = contador;
    #11#1 = "C";
    #11#2 = alfa2;
    |GRABA 020#11n;
  |FINSI;

  |SI alfa3 ! "";
    contador = contador + 1;
    #11#0 = contador;
    #11#1 = "O";
    #11#2 = alfa3;
    |GRABA 020#11n;
  |FINSI;


|FPRC;




|PROCESO c_ultimo;


    |DDEFECTO #6;

    #5#0 = #3#2;
    |LEE 001#5=;
    |SI FSalida = 0; ||Compruebo que la cuenta de la planilla existe en el temporal escalw10

      caracter = #3#3 % 101; ||Compruebo si el primer caracter de la
                             ||descripcion es "="
      |SI caracter ! "=";

           #6#0 = #3#2;  ||Cuenta
           #6#5 = #3#1;  ||Linea

           #1#0 = #3#4;  ||Bloque

           |LEE 001#1=;
           |SI FSalida = 0;
             #6#1 = #1#0;
           |FINSI;

           |SI c = 1;   ||Centro = 1
             |SI #3#5 = "+"; ||Importe
               |SI #3#11 = 0;
                 #6#2 = #5#1;
               |SINO;
                 #6#2 = #3#11;
               |FINSI;
             |FINSI;

             |SI #3#5 = "-";
               |SI #3#11 = 0;
                 #6#2 = - #5#1;
               |SINO;
                 #6#2 = - #3#11;
               |FINSI;
             |FINSI;
           |FINSI;


           |SI c = 2;   ||Centro = 2
             |SI #3#5 = "+"; ||Importe
               |SI #3#12 = 0;
                 #6#2 = #5#1;
               |SINO;
                 #6#2 = #3#12;
               |FINSI;
             |FINSI;

             |SI #3#5 = "-";
               |SI #3#12 = 0;
                 #6#2 = - #5#1;
               |SINO;
                 #6#2 = - #3#12;
               |FINSI;
             |FINSI;
           |FINSI;


           |SI c = 3;   ||Centro = 3
             |SI #3#5 = "+"; ||Importe
               |SI #3#13 = 0;
                 #6#2 = #5#1;
               |SINO;
                 #6#2 = #3#13;
               |FINSI;
             |FINSI;

             |SI #3#5 = "-";
               |SI #3#13 = 0;
                 #6#2 = - #5#1;
               |SINO;
                 #6#2 = - #3#13;
               |FINSI;
             |FINSI;
           |FINSI;


           #6#3 = #3#3;  ||Titulo
           #6#4 = #3#7;  ||SubBloque

           |SI c = 1;     ||Centro 1
               #6#6 = #3#6;  ||Observaciones
           |FINSI;

           |SI c = 2;     ||Centro 2
               #6#6 = #3#14;
           |FINSI;

           |SI c = 3;      ||Centro 3
               #6#6 = #3#15;
           |FINSI;


           |GRABA 020#6n;

      |SINO; ||Caracter es igual a "="

           |LEE 010#6u;
           |SI FSalida = 0; ||Lectura correcta

             #6#0 = "VARIOS";  ||Cuenta


             |SI c = 1; ||Centro 1
               |SI #3#5 = "+"; ||Importe
                 |SI #3#11 = 0;
                   #6#2 = #6#2 + #5#1;
                 |SINO;
                   #6#2 = #6#2 + #3#11;
                 |FINSI;
               |FINSI;

               |SI #3#5 = "-";
                 |SI #3#11 = 0;
                   #6#2 = #6#2 - #5#1;
                 |SINO;
                   #6#2 = #6#2 - #3#11;
                 |FINSI;
               |FINSI;
             |FINSI;



             |SI c = 2; ||Centro 2
               |SI #3#5 = "+"; ||Importe
                 |SI #3#12 = 0;
                   #6#2 = #6#2 + #5#1;
                 |SINO;
                   #6#2 = #6#2 + #3#12;
                 |FINSI;
               |FINSI;

               |SI #3#5 = "-";
                 |SI #3#12 = 0;
                   #6#2 = #6#2 - #5#1;
                 |SINO;
                   #6#2 = #6#2 - #3#12;
                 |FINSI;
               |FINSI;
             |FINSI;


             |SI c = 3; ||Centro 3
               |SI #3#5 = "+"; ||Importe
                 |SI #3#13 = 0;
                   #6#2 = #6#2 + #5#1;
                 |SINO;
                   #6#2 = #6#2 + #3#13;
                 |FINSI;
               |FINSI;

               |SI #3#5 = "-";
                 |SI #3#13 = 0;
                   #6#2 = #6#2 - #5#1;
                 |SINO;
                   #6#2 = #6#2 - #3#13;
                 |FINSI;
               |FINSI;
             |FINSI;


             |SI c = 1;     ||Centro 1
               #6#6 = #3#6;  ||Observaciones
             |FINSI;

             |SI c = 2;     ||Centro 2
               #6#6 = #3#14;
             |FINSI;

             |SI c = 3;      ||Centro 3
               #6#6 = #3#15;
             |FINSI;



             |GRABA 020#6a;

           |FINSI; ||De FSalida

      |FINSI;  ||Si caracter es igual o no a "="

     |SINO;  ||La cuenta de la planilla no aparece en Contabilidad


      caracter = #3#3 % 101; ||Compruebo si el primer caracter de la
                             ||descripcion es "="
      |SI caracter ! "=";


           #6#0 = #3#2;  ||Cuenta
           #6#5 = #3#1;  ||Linea

           #1#0 = #3#4;  ||Bloque

           |LEE 001#1=;
           |SI FSalida = 0;
             #6#1 = #1#0;
           |FINSI;

           |SI c = 1;   ||Centro 1
             |SI #3#11 = 0;
               #6#2 = 0;     ||Importe
             |SINO;
               #6#2 = #3#11;
             |FINSI;
           |FINSI;



           |SI c = 2;   ||Centro 2
             |SI #3#12 = 0;
               #6#2 = 0;     ||Importe
             |SINO;
               #6#2 = #3#12
             |FINSI;
           |FINSI;


           |SI c = 3;   ||Centro 3
             |SI #3#13 = 0;
               #6#2 = 0;     ||Importe
             |SINO;
               #6#2 = #3#13;
             |FINSI;
           |FINSI;

           #6#3 = #3#3;  ||Titulo
           #6#4 = #3#7;  ||SubBloque



           |SI c = 1;     ||Centro 1
               #6#6 = #3#6;  ||Observaciones
           |FINSI;

           |SI c = 2;     ||Centro 2
               #6#6 = #3#14;
           |FINSI;

           |SI c = 3;      ||Centro 3
               #6#6 = #3#15;
           |FINSI;



           |GRABA 020#6n;

        |FINSI;


     |FINSI; ||La cuenta de la planilla existe en el temporal


|FPRC;


|PROCESO c_no_ultimo;

      |DDEFECTO #6;


      patron = #3#2;
      sw = 0;

     |BUCLE busqueda; ||Busqueda de cuentas a excluir

      acumulado = 0;

      |BUCLE acumular;  ||Acumula el importe a grabar en escalw11

      caracter = #3#3 % 101; ||Compruebo si el primer caracter de la
                             ||descripcion es "="
      |SI caracter ! "=";

           #6#0 = #3#2;  ||Cuenta
           #6#5 = #3#1;  ||Linea

           #1#0 = #3#4;  ||Bloque

           |LEE 001#1=;
           |SI FSalida = 0;
             #6#1 = #1#0;
           |FINSI;

           |SI c = 1;   ||Centro 1
             |SI #3#11 = 0;
               #6#2 = acumulado;
             |SINO;
               #6#2 = #3#11;
             |FINSI;
           |FINSI;

           |SI c = 2;   ||Centro 2
             |SI #3#12 = 0;
               #6#2 = acumulado;
             |SINO;
               #6#2 = #3#12;
             |FINSI;
           |FINSI;


           |SI c = 3;   ||Centro 3
             |SI #3#13 = 0;
               #6#2 = acumulado;
             |SINO;
               #6#2 = #3#13;
             |FINSI;
           |FINSI;

           #6#3 = #3#3;  ||Titulo
           #6#4 = #3#7;  ||SubBloque



           |SI c = 1;     ||Centro 1
               #6#6 = #3#6;  ||Observaciones
           |FINSI;

           |SI c = 2;     ||Centro 2
               #6#6 = #3#14;
           |FINSI;

           |SI c = 3;      ||Centro 3
               #6#6 = #3#15;
           |FINSI;



           |GRABA 020#6n;

      |SINO; ||Caracter es igual a "="

           |LEE 010#6u;
           |SI FSalida = 0; ||Lectura correcta

             #6#0 = "VARIOS";  ||Cuenta


             |SI c = 1;  ||Centro 1
               |SI #3#5 = "+"; ||Importe
                 |SI #3#11 = 0;
                    #6#2 = #6#2 + acumulado;
                 |SINO;
                    #6#2 = #6#2 + #3#11;
                 |FINSI;
               |FINSI;

               |SI #3#5 = "-";
                 |SI #3#11 = 0;
                   #6#2 = #6#2 - acumulado;
                 |SINO;
                   #6#2 = #6#2 - #3#11;
                 |FINSI;
               |FINSI;
             |FINSI;


             |SI c = 2;  ||Centro 2
               |SI #3#5 = "+"; ||Importe
                 |SI #3#12 = 0;
                    #6#2 = #6#2 + acumulado;
                 |SINO;
                    #6#2 = #6#2 + #3#12;
                 |FINSI;
               |FINSI;

               |SI #3#5 = "-";
                 |SI #3#12 = 0;
                   #6#2 = #6#2 - acumulado;
                 |SINO;
                   #6#2 = #6#2 - #3#12;
                 |FINSI;
               |FINSI;
             |FINSI;


             |SI c = 3;  ||Centro 3
               |SI #3#5 = "+"; ||Importe
                 |SI #3#13 = 0;
                    #6#2 = #6#2 + acumulado;
                 |SINO;
                    #6#2 = #6#2 + #3#13;
                 |FINSI;
               |FINSI;

               |SI #3#5 = "-";
                 |SI #3#13 = 0;
                   #6#2 = #6#2 - acumulado;
                 |SINO;
                   #6#2 = #6#2 - #3#13;
                 |FINSI;
               |FINSI;
             |FINSI;


             |SI c = 1;     ||Centro 1
               #6#6 = #3#6;  ||Observaciones
             |FINSI;

             |SI c = 2;     ||Centro 2
               #6#6 = #3#14;
             |FINSI;

             |SI c = 3;      ||Centro 3
               #6#6 = #3#15;
             |FINSI;


             |GRABA 020#6a;

           |FINSI; ||De FSalida

      |FINSI;  ||Si caracter es igual o no a "="

      |BUCLE no_excluir;  ||marca todas las cuentas excluidas, como no excluidas


|FPRC;


|PROCESO o_ultimo;

    |DDEFECTO #6;

    #5#0 = #8#2;
    |LEE 001#5=;
    |SI FSalida = 0; ||Compruebo que la cuenta de la formula de la planilla existe en el temporal escalw10


       |SI #3#5 = "+"; ||Importe
           #8#3 = #5#1;
       |FINSI;

       |SI #3#5 = "-";
           #8#3 = - #5#1;
       |FINSI;

       |GRABA 020#8a;


     |FINSI; ||La cuenta de la planilla existe en el temporal

|FPRC;



|PROCESO o_no_ultimo;


     |DDEFECTO #6;

     patron = "";
     patron = #8#2;

     sw = 1;

     |BUCLE busqueda; ||Busqueda de cuentas a excluir

     acumulado = 0;

     |BUCLE acumular;  ||Acumula el importe a grabar en escalw11

     #8#3 = acumulado;

     |GRABA 020#8a;

     |BUCLE no_excluir;  ||marca todas las cuentas excluidas, como no excluidas

|FPRC;



|PROCESO leeform;

  cta = "";
  cta = #8#2;
  |QBF cta;
  long = cta % A0;

  ||Dependiendo de si la cuenta es de £ltimo nivel o no, el proceso ser  difernte. Si
  ||la cuenta es de £ltimo nivel, se leer  el importe directamente (caso de que exista)
  ||del temporal escalw10. Si la cuenta es de nivel superior, habr  que sumar los importes
  ||de las diferentes cuentas de ultimo nivel que existan en escalw10, a excepci¢n de las
  ||otras del mismo grupo indicadas en la planilla


  |SI long = ultimo_nivel;

      |HAZ o_ultimo;

  |SINO;

      |HAZ o_no_ultimo;

  |FINSI;



|FPRC;



|PROCESO busco;

   total = total + #6#2;

|FPRC;


|DEFBUCLE busco_bloque;

  #6#1;
  1;
  001, cta;
  999, cta;
  be;
  NULL, busco;

|FIN;


|DEFBUCLE busco_sub;
  #6#1;
  4;
  001, cta;
  999, cta;
  be;
  NULL, busco;
|FIN;



|PROCESO leeform2;


  cta = "";
  cta = #11#2;
  |QBF cta;
  long = cta % A0;

  ||Si la longitud de la cuenta es 1, entonces se trata de un Bloque,
  ||si la longitud de la cuenta es 2, se trata de un subBloque

  total = 0;

  |SI long = 1;

      |BUCLE busco_bloque;


  |FINSI;

  |SI long = 2;

      |BUCLE busco_sub;


  |FINSI;


  #11#3 = total;
  |GRABA 020#11a;

|FPRC;




|DEFBUCLE leeform;
  #8#1;
  1;
  001, "C";
  999, "C";
  be;
  NULL, leeform;

|FIN;

|DEFBUCLE leeform2;

  #11#1;
  1;
  001, "C";
  999, "C";
  be;
  NULL, leeform2;

|FIN;



|PROCESO resultado;

   calculo1 = 0;
   calculo2 = 0;
   calculo = 0;
   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   ope = "";

  |CIERRA #8;
  |ABRE #8;
  |LEE 001#8u;
  |SI FSalida = 0;


      |SI #8#0 = 1 ;

          |LEE 001#8p;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume1 = #8#3;
              |FINSI;
          |FINSI;

              calculo = nume1;

      |FINSI;


      |SI #8#0 = 3;

      |LEE 001#8p;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume1 = #8#3;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "O";
                  ope = #8#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume2 = #8#3;
              |FINSI;
          |FINSI;

          |SI ope = "+";
              calculo = nume1 + nume2;
          |FINSI;

          |SI ope = "-";
              calculo = nume1 - nume2;

          |FINSI;

          |SI ope = "*";
              calculo = nume1 * nume2;
          |FINSI;

          |SI ope = "/";
              calculo = nume1 / nume2;
          |FINSI;

      |FINSI;

      |SI #8#0 = 5;


          |LEE 001#8p;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume1 = #8#3;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "O";
                  ope = #8#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume2 = #8#3;
              |FINSI;
          |FINSI;

          |SI ope = "+";
              calculo1 = nume1 + nume2;
          |FINSI;

          |SI ope = "-";
              calculo1 = nume1 - nume2;
          |FINSI;

          |SI ope = "*";
              calculo1 = nume1 * nume2;
          |FINSI;

          |SI ope = "/";
              calculo1 = nume1 / nume2;
          |FINSI;

          ope = "";
          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "O";
                  ope = #8#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume3 = #8#3;
              |FINSI;
          |FINSI;


          |SI ope = "+";
              calculo = calculo1 + nume3;
          |FINSI;

          |SI ope = "-";
              calculo = calculo1 - nume3;
          |FINSI;

          |SI ope = "*";
              calculo = calculo1 * nume3;
          |FINSI;

          |SI ope = "/";
              calculo = calculo1 / nume3;
          |FINSI;


      |FINSI;

      |SI #8#0 = 7;


          |LEE 001#8p;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume1 = #8#3;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "O";
                  ope = #8#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume2 = #8#3;
              |FINSI;
          |FINSI;

          |SI ope = "+";
              calculo1 = nume1 + nume2;
          |FINSI;

          |SI ope = "-";
              calculo1 = nume1 - nume2;
          |FINSI;

          |SI ope = "*";
              calculo1 = nume1 * nume2;
          |FINSI;

          |SI ope = "/";
              calculo1 = nume1 / nume2;
          |FINSI;

          ope = "";
          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "O";
                  ope = #8#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume3 = #8#3;
              |FINSI;
          |FINSI;


          |SI ope = "+";
              calculo2 = calculo1 + nume3;
          |FINSI;

          |SI ope = "-";
              calculo2 = calculo1 - nume3;
          |FINSI;

          |SI ope = "*";
              calculo2 = calculo1 * nume3;
          |FINSI;

          |SI ope = "/";
              calculo2 = calculo1 / nume3;
          |FINSI;

          ope = "";
          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "O";
                  ope = #8#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#8s;
          |SI FSalida = 0;
              |SI #8#1 = "C";
                  nume4 = #8#3;
              |FINSI;
          |FINSI;


          |SI ope = "+";
              calculo = calculo2 + nume4;
          |FINSI;

          |SI ope = "-";
              calculo = calculo2 - nume4;
          |FINSI;

          |SI ope = "*";
              calculo = calculo2 * nume4;
          |FINSI;

          |SI ope = "/";
              calculo = calculo2 / nume4;
          |FINSI;

      |FINSI;
  |FINSI;



|FPRC;


|PROCESO resultado2;


   calculo1 = 0;
   calculo2 = 0;
   calculo = 0;
   nume1 = 0;
   nume2 = 0;
   nume3 = 0;
   nume4 = 0;
   ope = "";

  |CIERRA #11;
  |ABRE #11;
  |LEE 001#11u;
  |SI FSalida = 0;


      |SI #11#0 = 1 ;

          |LEE 001#11p;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume1 = #11#3;
              |FINSI;
          |FINSI;

              calculo = nume1;

      |FINSI;


      |SI #11#0 = 3;

          |LEE 001#11p;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume1 = #11#3;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "O";
                  ope = #11#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume2 = #11#3;
              |FINSI;
          |FINSI;

          |SI ope = "+";
              calculo = nume1 + nume2;
          |FINSI;

          |SI ope = "-";
              calculo = nume1 - nume2;
          |FINSI;

          |SI ope = "*";
              calculo = nume1 * nume2;
          |FINSI;

          |SI ope = "/";
              calculo = nume1 / nume2;
          |FINSI;


      |FINSI;

      |SI #11#0 = 5;


          |LEE 001#11p;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume1 = #11#3;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "O";
                  ope = #11#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume2 = #11#3;
              |FINSI;
          |FINSI;

          |SI ope = "+";
              calculo1 = nume1 + nume2;
          |FINSI;

          |SI ope = "-";
              calculo1 = nume1 - nume2;
          |FINSI;

          |SI ope = "*";
              calculo1 = nume1 * nume2;
          |FINSI;

          |SI ope = "/";
              calculo1 = nume1 / nume2;
          |FINSI;

          ope = "";
          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "O";
                  ope = #11#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume3 = #11#3;
              |FINSI;
          |FINSI;


          |SI ope = "+";
              calculo = calculo1 + nume3;
          |FINSI;

          |SI ope = "-";
              calculo = calculo1 - nume3;
          |FINSI;

          |SI ope = "*";
              calculo = calculo1 * nume3;
          |FINSI;

          |SI ope = "/";
              calculo = calculo1 / nume3;
          |FINSI;


      |FINSI;

      |SI #11#0 = 7;


          |LEE 001#11p;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume1 = #11#3;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "O";
                  ope = #11#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume2 = #11#3;
              |FINSI;
          |FINSI;

          |SI ope = "+";
              calculo1 = nume1 + nume2;
          |FINSI;

          |SI ope = "-";
              calculo1 = nume1 - nume2;
          |FINSI;

          |SI ope = "*";
              calculo1 = nume1 * nume2;
          |FINSI;

          |SI ope = "/";
              calculo1 = nume1 / nume2;
          |FINSI;

          ope = "";
          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "O";
                  ope = #11#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume3 = #11#3;
              |FINSI;
          |FINSI;


          |SI ope = "+";
              calculo2 = calculo1 + nume3;
          |FINSI;

          |SI ope = "-";
              calculo2 = calculo1 - nume3;
          |FINSI;

          |SI ope = "*";
              calculo2 = calculo1 * nume3;
          |FINSI;

          |SI ope = "/";
              calculo2 = calculo1 / nume3;
          |FINSI;

          ope = "";
          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "O";
                  ope = #11#2;
                  |QBF ope;
              |FINSI;
          |FINSI;

          |LEE 001#11s;
          |SI FSalida = 0;
              |SI #11#1 = "C";
                  nume4 = #11#3;
              |FINSI;
          |FINSI;


          |SI ope = "+";
              calculo = calculo2 + nume4;
          |FINSI;

          |SI ope = "-";
              calculo = calculo2 - nume4;
          |FINSI;

          |SI ope = "*";
              calculo = calculo2 * nume4;
          |FINSI;

          |SI ope = "/";
              calculo = calculo2 / nume4;
          |FINSI;

      |FINSI;
  |FINSI;

|FPRC;


|PROCESO leeplanilla;


 |SI #3#9 = "C"; ||Si la l¡nea de la planilla es una cuenta

  cta = #3#2;  ||comprobamos la longitud de la cuenta de la planilla
  |QBF cta;
  long = cta % A0;

  ||Dependiendo de si la cuenta es de £ltimo nivel o no, el proceso ser  difernte. Si
  ||la cuenta es de £ltimo nivel, se leer  el importe directamente (caso de que exista)
  ||del temporal escalw10. Si la cuenta es de nivel superior, habr  que sumar los importes
  ||de las diferentes cuentas de ultimo nivel que existan en escalw10, a excepci¢n de las
  ||otras del mismo grupo indicadas en la planilla


  |SI long = ultimo_nivel;

      |HAZ c_ultimo;

  |SINO;  ||La cuenta no es de £ltimo nivel

      |HAZ c_no_ultimo;

  |FINSI;

 |FINSI; || Si la l¡nea es una Cuenta



 |SI #3#9 = "O"; ||Si la linea de la planilla es una operaci¢n


   |DELINDEX #8;
   |ABRE #8;
   contador = 0;

   beta = "";
   beta = #3#8;
   |QBF beta;

   longi = "";
   alfa = "";
   nume = 0;
   alfa2 = "";

   longi = beta % 0;
   numero = longi;

   |PARA x = 1; |SI x [ numero; |HACIENDO x = x + 1;

      nume = (100 * x) + 1;
      alfa = nume;

      parte = beta % alfa;

     |SI parte ! "+"; |Y parte ! "-"; |Y parte ! "*"; |Y parte ! "/"; |Y parte ! "%";

        alfa2 = alfa2 + parte;

     |SINO;

        alfa3 = parte;

        |HAZ guardar; ||almacenamos los componentes de la formula en escalw12

        alfa2 = "";
        alfa3 = "";

     |FINSI;

   |SIGUE;

   |HAZ guardar; ||almacenamos los componentes de la formula en escalw12

   |BUCLE leeform; ||Leo temporal escalw12, para obtener el importe de las cuentas
                   ||y guardo el valor en escalw12

   |HAZ resultado; ||Calculo el resultado de la formula

   ||Grabo el registro correspondiente a la formula en el temporal escalw11

   #6#0 = "";
   #6#5 = #3#1;    ||Linea

   #1#0 = #3#4;    ||Bloque
   |LEE 001#1=;
   |SI FSalida = 0;
       #6#1 = #1#0;
   |FINSI;

   |SI c = 1;   ||Centro 1
     |SI #3#11 = 0;
       #6#2 = calculo; ||Importe
     |SINO;
       #6#2 = #3#11;
     |FINSI;
   |FINSI;


   |SI c = 2;  ||Centro 2
     |SI #3#12 = 0;
       #6#2 = calculo; ||Importe
     |SINO;
       #6#2 = #3#12;
     |FINSI;
   |FINSI;



   |SI c = 3;  ||Centro 3
     |SI #3#13 = 0;
       #6#2 = calculo; ||Importe
     |SINO;
       #6#2 = #3#13;
     |FINSI;
   |FINSI;

   #6#3 = #3#3;    ||Titulo
   #6#4 = #3#7;    ||SubBloque


   |SI c = 1;     ||Centro 1
       #6#6 = #3#6;  ||Observaciones
   |FINSI;

   |SI c = 2;     ||Centro 2
       #6#6 = #3#14;
   |FINSI;

   |SI c = 3;      ||Centro 3
       #6#6 = #3#15;
   |FINSI;





   |GRABA 020#6n;


  |FINSI; ||Fin cuando la l¡nea de la planilla es una operaci¢n

|FPRC;




|DEFBUCLE leedesde;
  #4#3;
  0,21;
  "            ", 1, #0#10, 000000, centroi, #0#8;
  "999999999999", 9, #0#11, 999999, centrof, #0#9;
  be;
  NULL, leedesde;
|FIN;


|DEFBUCLE leeplanilla;
  #3#1;
  ;
  #0#0, 001;
  #0#0, 999;
  be;
  NULL, leeplanilla;
|FIN;


|PROCESO leecuenta;

   cont = cont + 1;
   #10#0 = cont;
   #10#1 = #6#3;
   #10#2 = #6#2;

   #10#4 = #6#6;

   #10#5 = #9#1;

   men = "";
   men = #10#0 +";" +#10#1+";"+#10#2+";"+#10#3+";"+#10#4+";"+#10#5;
   |XGRABA 0,men;

   |GRABA 020#10n;

|FPRC;


|DEFBUCLE leecuenta;
  #6#1;
  1,4;
  001, #9#2, #9#3;
  999, #9#2, #9#3;
  be;
  NULL, leecuenta;
|FIN;

|DEFBUCLE leecuenta2;
  #6#1;
  1,4;
  001, #9#2, #9#3;
  999, #9#2, #9#3;
  be;
  NULL, leecuenta2;
|FIN;


|DEFBUCLE leecuenta3;
  #6#1;
  1,4;
  001, #9#2, #9#3;
  999, #9#2, #9#3;
  be;
  NULL, leecuenta3;
|FIN;



|PROCESO leecuenta2;

   cont = cont + 1;
   #20#0 = cont;
   #20#1 = #6#3;
   #20#2 = #6#2;

   #20#4 = #6#6;

   #20#5 = #9#1;

   men = "";
   men = #20#0 +";" +#20#1+";"+#20#2+";"+#20#3+";"+#20#4+";"+#20#5;
   |XGRABA 0,men;

   |GRABA 020#20n;

|FPRC;


|PROCESO crea_infor;

||Leo los par metros del informe y voy generando el temporal #10 que ser  la
||base de impresi¢n del informe escal010


  |SI #9#1 = "T";  ||Si la l¡nea es un T¡tulo

      |DDEFECTO #10;
      cont = cont + 1;
      #10#0 = cont;
      #10#1 = #9#4;
      #10#5 = #9#1;

      men = "";

      men = #10#0 +";" +#10#1+";"+#10#2+";"+#10#3+";"+#10#4+";"+#10#5;
      |XGRABA 0,men;

      |GRABA 020#10n;

  |FINSI;

  |SI #9#1 = "C";  ||Si la l¡nea es una Cuenta
       sw1 = 1;
      |BUCLE leecuenta;

  |FINSI;


  |SI #9#1 = "F";  ||Si la l¡nea es una F¢rmula

    |CIERRA #11;
    |DELINDEX #11;
    |ABRE #11;
    |DDEFECTO #11;
    contador = 0;

    beta = "";
    beta = #9#5;
    |QBF beta;

    longi = "";
    alfa = "";
    nume = 0;
    alfa2 = "";

    longi = beta % 0;
    numero = longi;

    |PARA x = 1; |SI x [ numero; |HACIENDO x = x + 1;

       nume = (100 * x) + 1;
       alfa = nume;

       parte = beta % alfa;

      |SI parte ! "+"; |Y parte ! "-"; |Y parte ! "*"; |Y parte ! "/"; |Y parte ! "%";

         alfa2 = alfa2 + parte;

      |SINO;

         alfa3 = parte;

         |HAZ guardar2; ||almacenamos los componentes de la formula en escalw12

         alfa2 = "";
         alfa3 = "";

      |FINSI;

    |SIGUE;

    |HAZ guardar2; ||almacenamos los componentes de la formula en escalw12

    |BUCLE leeform2; ||Leo temporal escalw15, para obtener el importe de las cuentas
                     ||y guardo el valor en escalw15

    calculo = 0;
    resultado = " ";

    |HAZ resultado2; ||Calculo el resultado de la formula

      cont = cont + 1;
      #10#0 = cont;
      #10#1 = #9#4;
      #10#2 = calculo;
      #10#5 = #9#1;

      men = "";

   men = #10#0 +";" +#10#1+";"+#10#2+";"+#10#3+";"+#10#4+";"+#10#5;

      |XGRABA 0,men;

      |GRABA 020#10n;


  |FINSI;


|FPRC;



|PROCESO leecuenta3;

   cont = cont + 1;
   #40#0 = cont;
   #40#1 = #6#3;
   #40#2 = #6#2;

   #40#4 = #6#6;

   #40#5 = #9#1;

   men = "";
   men = #40#0 +";" +#40#1+";"+#40#2+";"+#40#3+";"+#40#4+";"+#40#5;
   |XGRABA 0,men;

   |GRABA 020#40n;

|FPRC;


|PROCESO crea_infor3;

||Leo los par metros del informe y voy generando el temporal #10 que ser  la
||base de impresi¢n del informe escal010


  |SI #9#1 = "T";  ||Si la l¡nea es un T¡tulo

      |DDEFECTO #40;
      cont = cont + 1;
      #40#0 = cont;
      #40#1 = #9#4;
      #40#5 = #9#1;

      men = "";

      men = #40#0 +";" +#40#1+";"+#40#2+";"+#40#3+";"+#40#4+";"+#40#5;
      |XGRABA 0,men;

      |GRABA 020#40n;

  |FINSI;

  |SI #9#1 = "C";  ||Si la l¡nea es una Cuenta
       sw1 = 1;
      |BUCLE leecuenta3;

  |FINSI;


  |SI #9#1 = "F";  ||Si la l¡nea es una F¢rmula

    |CIERRA #11;
    |DELINDEX #11;
    |ABRE #11;
    |DDEFECTO #11;
    contador = 0;

    beta = "";
    beta = #9#5;
    |QBF beta;

    longi = "";
    alfa = "";
    nume = 0;
    alfa2 = "";

    longi = beta % 0;
    numero = longi;

    |PARA x = 1; |SI x [ numero; |HACIENDO x = x + 1;

       nume = (100 * x) + 1;
       alfa = nume;

       parte = beta % alfa;

      |SI parte ! "+"; |Y parte ! "-"; |Y parte ! "*"; |Y parte ! "/"; |Y parte ! "%";

         alfa2 = alfa2 + parte;

      |SINO;

         alfa3 = parte;

         |HAZ guardar2; ||almacenamos los componentes de la formula en escalw12

         alfa2 = "";
         alfa3 = "";

      |FINSI;

    |SIGUE;

    |HAZ guardar2; ||almacenamos los componentes de la formula en escalw12

    |BUCLE leeform2; ||Leo temporal escalw15, para obtener el importe de las cuentas
                     ||y guardo el valor en escalw15

    calculo = 0;
    resultado = " ";

    |HAZ resultado2; ||Calculo el resultado de la formula

      cont = cont + 1;
      #40#0 = cont;
      #40#1 = #9#4;
      #40#2 = calculo;
      #40#5 = #9#1;

      men = "";

   men = #40#0 +";" +#40#1+";"+#40#2+";"+#40#3+";"+#40#4+";"+#40#5;

      |XGRABA 0,men;

      |GRABA 020#40n;


  |FINSI;


|FPRC;



|DEFBUCLE crea_infor;

  #9#1;
  ;
  001;
  999;
  be;
  NULL, crea_infor;

|FIN;

|DEFBUCLE crea_infor2;

  #9#1;
  ;
  001;
  999;
  be;
  NULL, crea_infor2;

|FIN;


|DEFBUCLE crea_infor3;

  #9#1;
  ;
  001;
  999;
  be;
  NULL, crea_infor3;

|FIN;



|PROCESO crea_infor2;

||Leo los par metros del informe y voy generando el temporal #10 que ser  la
||base de impresi¢n del informe escal010


  |SI #9#1 = "T";  ||Si la l¡nea es un T¡tulo

      |DDEFECTO #20;
      cont = cont + 1;
      #20#0 = cont;
      #20#1 = #9#4;
      #20#5 = #9#1;

      men = "";

      men = #20#0 +";" +#20#1+";"+#20#2+";"+#20#3+";"+#20#4+";"+#20#5;
      |XGRABA 0,men;

      |GRABA 020#20n;

  |FINSI;

  |SI #9#1 = "C";  ||Si la l¡nea es una Cuenta
       sw1 = 1;
      |BUCLE leecuenta2;

  |FINSI;


  |SI #9#1 = "F";  ||Si la l¡nea es una F¢rmula

    |CIERRA #11;
    |DELINDEX #11;
    |ABRE #11;
    |DDEFECTO #11;
    contador = 0;

    beta = "";
    beta = #9#5;
    |QBF beta;

    longi = "";
    alfa = "";
    nume = 0;
    alfa2 = "";

    longi = beta % 0;
    numero = longi;

    |PARA x = 1; |SI x [ numero; |HACIENDO x = x + 1;

       nume = (100 * x) + 1;
       alfa = nume;

       parte = beta % alfa;

      |SI parte ! "+"; |Y parte ! "-"; |Y parte ! "*"; |Y parte ! "/"; |Y parte ! "%";

         alfa2 = alfa2 + parte;

      |SINO;

         alfa3 = parte;

         |HAZ guardar2; ||almacenamos los componentes de la formula en escalw12

         alfa2 = "";
         alfa3 = "";

      |FINSI;

    |SIGUE;

    |HAZ guardar2; ||almacenamos los componentes de la formula en escalw12

    |BUCLE leeform2; ||Leo temporal escalw15, para obtener el importe de las cuentas
                     ||y guardo el valor en escalw15

    calculo = 0;
    resultado = " ";

    |HAZ resultado2; ||Calculo el resultado de la formula

      cont = cont + 1;
      #20#0 = cont;
      #20#1 = #9#4;
      #20#2 = calculo;
      #20#5 = #9#1;

      men = "";

   men = #20#0 +";" +#20#1+";"+#20#2+";"+#20#3+";"+#20#4+";"+#20#5;

      |XGRABA 0,men;

      |GRABA 020#20n;


  |FINSI;


|FPRC;




|PROCESO imprime;
   |PRINT;
|FPRC;


|DEFBUCLE imprime;
  #10#1;
  ;
  1;
  999;
  be;
  NULL, imprime;
|FIN;



|PROCESO imprimir;


  |IMPRE #0;
  |SI FSalida = 0;
    |INFOR informe;
    |SI FSalida = 0;
        |BUCLE imprime;
        |PIEINF;
        |FININF;
    |FINSI;
  |FINSI;


|FPRC;


|PROCESO copia;
  #7#0 = #3#0;
  #7#1 = #3#1;
  #7#2 = #3#2;
  #7#3 = #3#3;
  #7#4 = #3#4;
  #7#5 = #3#5;
  #7#6 = #3#6;
  #7#7 = #3#7;
  #7#8 = #3#8;
  #7#9 = #3#9;
  |GRABA 020#7n;
|FPRC;

|DEFBUCLE copia;
  #3#1;
  ;
  #0#0,   1;
  #0#0, 999;
  be;
  NULL, copia;

|FIN;


|PROCESO copiar;

||Realizo una copia del fichero escal003 en escalcop, para realizar en este
||ultimo el bucle de busqueda


  |DELINDEX #7;
  |ABRE #7;
  |BUCLE copia;
  |CIERRA #7;

|FPRC;



|PROCESO generar2; |TIPO 3; ||Generaci¢n de un temporal para el informe y su emisi¢n posterior


||***************************+ CENTRO 1 ************************************

|SI #0#2 ! 0;


centroi = #0#2;
centrof = #0#2;
fichero = "";
fichero2 = "";
c = 1;

  ||1.- Leer el Hist¢rico de Apuntes, filtrando por Diarios, Dptos y Fecha
  ||    y guard ndolo en el temporal escalw010

  |CIERRA #5;
  |DELINDEX #5;
  |DELINDEX #6;
  |DELINDEX #8;
  |DELINDEX #10;
  |DELINDEX #11;
  |ABRE #5;
  |ABRE #6;
  |ABRE #1;
  |ABRE #8;
  |ABRE #10;
  |ABRE #11;
  |DDEFECTO #6;
  |DDEFECTO #8;
  |DDEFECTO #10;
  |DDEFECTO #11;

  fichero = "c:\escalar\centro1.txt";
  |XABRE "CW",fichero,0;

  |BUCLE leedesde;


  ||Para las cuentas que han tenido valor en total debe y total haber, calculo el importe
  ||y lo guardo en #5#1

  |BUCLE calcular;


 ||2.- Comprobar en la planilla correspondiente qu‚ cuentas del fichero escalw10
 || hay que presentar en el informe. Las cuentas a mostrar se grabar n en el Temporal
 || escalw11


  |HAZ copiar;   ||Copia del fichero cuentas escalares (L)

  ultimo_nivel = 0;
  |HAZ nivel;  ||comprobar numero digitos de ultimo nivel, el valor se almacena
               ||en la variable ultimo_nivel


  |BUCLE leeplanilla;


 ||3.- Generaci¢n del informe

  cont = 0;



  |BUCLE crea_infor;  ||Generaci¢n del informe


  ||HAZ imprimir;      ||Impresi¢n del informe


  |CIERRA #5;
  |CIERRA #6;
  |CIERRA #1;
  |CIERRA #8;
  |CIERRA #10;
  |CIERRA #11;

  |XCIERRA 0;


  fichero2 = "c:\escalar\cabec2.txt";
  men = "";
  |XABRE "CW",fichero2,0;

   men = razon+";" +ejer+";"+#0#1+";"+#0#5+";"+#0#6+";"+#0#7;
  |XGRABA 0,men;
  |XCIERRA 0;


|SINO;      ||Si el centro es 0 hay que borrar el fichero de texto

  fichero = "";
  fichero2 = "";

  fichero = "c:\escalar\centro1.txt";
  |XABRE "CW",fichero,0;
  men = 9999+";"+" "+";"+0+";"+0+";"+"  "+";"+" "+";";
  |XGRABA 0,men;
  |XCIERRA 0;

|FINSI;  ||Fin Centro 1

||*****************  FIN CENTRO 1 *****************


||***************  CENTRO 2 *******************++

|SI #0#3 ! 0;  ||Centro 2

centroi = #0#3;
centrof = #0#3;
fichero = "";
fichero2 = "";
c = 2;

  |CIERRA #5;
  |DELINDEX #5;
  |DELINDEX #6;
  |DELINDEX #8;
  |DELINDEX #10;
  |DELINDEX #20;
  |DELINDEX #11;
  |ABRE #5;
  |ABRE #6;
  |ABRE #1;
  |ABRE #8;
  |ABRE #10;
  |ABRE #20;
  |ABRE #11;
  |DDEFECTO #6;
  |DDEFECTO #8;
  |DDEFECTO #10;
  |DDEFECTO #20;
  |DDEFECTO #11;

  fichero = "c:\escalar\centro2.txt";
  |XABRE "CW",fichero,0;

  |BUCLE leedesde;


  |BUCLE calcular;


  |HAZ copiar;   ||Copia del fichero cuentas escalares (L)

  ultimo_nivel = 0;
  |HAZ nivel;  ||comprobar numero digitos de ultimo nivel, el valor se almacena
               ||en la variable ultimo_nivel


  |BUCLE leeplanilla;


  cont = 0;


  |BUCLE crea_infor2;  ||Generaci¢n del informe


  ||HAZ imprimir;      ||Impresi¢n del informe


  |CIERRA #5;
  |CIERRA #6;
  |CIERRA #1;
  |CIERRA #8;
  |CIERRA #10;
  |CIERRA #20;
  |CIERRA #11;

  |XCIERRA 0;

|SINO;      ||Si el centro es 0 hay que borrar el fichero de texto

  fichero = "";
  fichero2 = "";

  fichero = "c:\escalar\centro2.txt";
  |XABRE "CW",fichero,0;
  men = 9999+";"+" "+";"+0+";"+0+";"+"  "+";"+" "+";";
  |XGRABA 0,men;
  |XCIERRA 0;


|FINSI;        ||Fin Centro 2

||***********+ FIN CENTRO 2 ************************





||**************  CENTRO 3 ************************

|SI #0#4 ! 0;  ||Centro 3

centroi = #0#4;
centrof = #0#4;
fichero = "";
fichero2 = "";
c = 3;

  |CIERRA #5;
  |DELINDEX #5;
  |DELINDEX #6;
  |DELINDEX #8;
  |DELINDEX #10;
  |DELINDEX #40;
  |DELINDEX #11;
  |ABRE #5;
  |ABRE #6;
  |ABRE #1;
  |ABRE #8;
  |ABRE #10;
  |ABRE #40;
  |ABRE #11;
  |DDEFECTO #6;
  |DDEFECTO #8;
  |DDEFECTO #10;
  |DDEFECTO #40;
  |DDEFECTO #11;

  fichero = "c:\escalar\centro3.txt";
  |XABRE "CW",fichero,0;

  |BUCLE leedesde;


  |BUCLE calcular;


  |HAZ copiar;   ||Copia del fichero cuentas escalares (L)

  ultimo_nivel = 0;
  |HAZ nivel;  ||comprobar numero digitos de ultimo nivel, el valor se almacena
               ||en la variable ultimo_nivel


  |BUCLE leeplanilla;


  cont = 0;


  |BUCLE crea_infor3;  ||Generaci¢n del informe


  ||HAZ imprimir;      ||Impresi¢n del informe


  |CIERRA #5;
  |CIERRA #6;
  |CIERRA #1;
  |CIERRA #8;
  |CIERRA #10;
  |CIERRA #40;
  |CIERRA #11;

  |XCIERRA 0;


|SINO;      ||Si el centro es 0 hay que borrar el fichero de texto

  fichero = "";
  fichero2 = "";

  fichero = "c:\escalar\centro3.txt";
  |XABRE "CW",fichero,0;
  men = 9999+";"+" "+";"+0+";"+0+";"+"  "+";"+" "+";";
  |XGRABA 0,men;
  |XCIERRA 0;

|FINSI;        ||Fin Centro 3

||*********** FIN CENTRO 3 **************************


|FPRC;
