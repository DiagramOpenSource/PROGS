|FICHEROS;
  pcbox001 #0;    ||Pantalla importacion
  impfich  #1;    ||Fichero de control path
  encopcbo #2;    ||fichero de apuntes enlace gestion
  caivarep #5;    ||iva Repercutido, Ventas
  caivasop #6;    ||Iva soportado compras
  calibros #8;    ||libros de iva
  encorec  #12;   ||Fichero de Cobros Enlace Gesion
  imptmp1  #18;   ||temporal nuevos numeros de IVA
  contabi0 #50;   || formato importacion indexado

  camancob #100;
  camanpag #101;
  caclipro #102;
  caivases #103;

  pcbox002 #200;
  pcbox003 #201;
|FIN;

|VARIABLES;
    &dig3     = 0;
    &dig4     = 0;
    &dig5     = 0;
    &dig6     = 0;
    &dig7     = 0;
    &dig8     = 0;
    &dig9     = 0;
    &eNum2008 = 0;
    &enEjerBal = 0;

  aDescFac    = "";
  nNumFac     = 0;
  i_factu     = 0;
  aDescCob    = "";
  aTipo       = "";
  aSerie      = "";

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";

     &EURODB = 0;
  alfa333  = "";
  alfa222  = "";
  &directo = "";
  &fichero = "";
  &alfa1   = "";
  &alfa2   = "";
  &handle  = 0;
  &canal   = "";
  &canal1  = "";
  &dir_fich1 = "";
  &sw_sop = 0;
  &sw_rep = 0;
  &fra_sop = 0;
  &fra_rep = 0;
  &anter = 0;
  &mas = 0;
  &antnum = 0;
  &nume1 = 0;
  &feini = @;
  &fefin = @;
  nNume1 = 0;
  nNume2 = 0;

  nPara1 = 0;
  nPara2 = 0;

  nCopio     = 0;
  fiche      = "";
  aBase      = "";
  &eaOrigen  = "";
  &eaDestino = "";
  &enErrPas  = 0;
  aFichero   = "";

  &emCta    = 0;
  &eaCuenta = "";
  &enNivel  = 0;
|FIN;

|PROCESO grasidx;
  |ABRE #50;
  #50#56 = #2#0;  || diario
  #50#57 = #2#1;  || fecha
  #50#59 = #2#2;  || documento
  #50#60 = #2#4;  || apunte
  |LEE 101#50=;
  |SI FSalida = 0;
      #50#0 = #2#0;         || diario
      #50#1 = #2#1;         || fecha
      #50#2 = #2#47;        || documento
      #50#3 = #50#2;        || asiento
      #50#4 = #2#4;         || apunte
      |GRABA 020#50a;
  |FINSI;
  |LIBERA #50;
  |CIERRA #50;
|FPRC;

|PROCESO sep_recibo;
  |DDEFECTO #12;
  alfa2 = canal %  102;
  #12#00 = alfa2;           || libro
  alfa2 = canal %  306;
  #12#01 = alfa2;           || factura
  alfa2 = canal %  902;
  #12#02 = alfa2;           || serie
  alfa2 = canal % 1103;
  #12#03 = alfa2;           || nro.cobro
  alfa2 = canal % 1412;
  #12#04 = alfa2;           || cuenta

  eaCuenta = #12#4; |HAZ eSacaNivel;
  alfa2 = canal % 2601;
  #12#05 = alfa2;           || nivel
  #12#05 = enNivel;

  alfa2 = canal % 2710;
  #12#06 = alfa2;           || fecha emision
  alfa2 = canal % 3710;
  #12#07 = alfa2;           || fecha vencimiento
  alfa2 = canal % 4711;
  #12#08 = alfa2;           || importe
  alfa2 = canal % 5811;
  #12#09 = alfa2;           || gtos. negociacion
  alfa2 = canal % 6911;
  #12#10 = alfa2;           || gtos. impagados
  alfa2 = canal % 8002;
  #12#11 = alfa2;           || tipo de recibo
  alfa2 = canal % 8205;
  #12#12 = alfa2;           || remesa
  alfa2 = canal % 8701;
  #12#13 = alfa2;           || emitido
  alfa2 = canal % 8810;
  #12#14 = alfa2;           || fecha vto. original
  alfa2 = canal % 9803;
  #12#15 = alfa2;           || banco
  alfa2 = canal % 10112;
  #12#16 = alfa2;           || ccc
  alfa2 = canal % 11316;
  #12#17 = alfa2;           || cta.cte.
  alfa2 = canal % 12901;
  #12#18 = alfa2;           || cobro/pago
  alfa2 = canal % 13030;
  #12#19 = alfa2;           || nombre banco
  alfa2 = canal % 16030;
  #12#20 = alfa2;           || direccion banco
  alfa2 = canal % 19025;
  #12#21 = alfa2;           || poblacion banco
  alfa2 = canal % 21502;
  #12#22 = alfa2;           || cod.postal 1
  alfa2 = canal % 21703;
  #12#23 = alfa2;           || cod.postal 2
  alfa2 = canal % 22001;
  #12#24 = alfa2;           || cobrado/impagado
  alfa2 = canal % 22111;
  #12#25 = alfa2;           || ptas. cobradas/impagadas
  alfa2 = canal % 23211;
  #12#26 = alfa2;           || ptas. gastos negociacion

  |SI #12#18 = "C";  #18#0 = "R";  |FINSI;          || tipo iva
  |SI #12#18 = "P";  #18#0 = "S";  |FINSI;
  #18#1 = #12#0;       || libro
  #18#2 = #12#1;       || fra./orden
  #18#3 = #12#2;       || serie
  |LEE 001#18=;
  |SI FSalida = 0;
      #12#1 = #18#4;   || fra./orden segun historico
  |FINSI;
  |GRABA 020#12n;
|FPRC;

____________________________________/ FICHERO RECIBOS
|PROCESO recibo;
  alfa1 = "enre" + fichero;
  alfa1 = alfa1 % -108;
||...   |PATH_DAT #12 dir_fich1;
  |NOME_DAT #12 alfa1;
  |ABRE #12; |CIERRA #12; |DELINDEX #12;

  alfa1 = directo + "enre" + fichero + ".seq";
  |XABRE "UB", alfa1, handle;
  |SI FSalida < 0;
        |XABRE "CUB", alfa1, handle;
  |FINSI;
  |SI FSalida ] 0;

      |ABRE #12;
      |ABRE #18;
      |PARA; |SI; |HACIENDO;
             |XLEE handle, 242, canal;
             |SI FSalida ! 242;  |SAL;  |FINSI;
             |HAZ sep_recibo;
      |SIGUE;
      |CIERRA #12;
      |CIERRA #18;
  |FINSI;
  |XCIERRA handle;
  Pos = -1;
|FPRC;

_________________________________/ RENUMERA APUNTES SEGUN TEMPORAL
|PROCESO lee_apuntes1;
  #2#16 = #18#4;
  |GRABA 020#2a;
  |LIBERA #2;
|FPRC;

|DEFBUCLE lee_apuntes;
 #2#1;
 13, 14, 16, 17;
 00, feini,      0,     0, #18#0, #18#1, #18#2, #18#3;
 99, fefin, 999999, 99999, #18#0, #18#1, #18#2, #18#3;
 be;
 NULL, lee_apuntes1;
|FIN;

|PROCESO lee_tempo1;
  feini = "01.01.0001";
  fefin = "31.12.8999";
  |BUCLE lee_apuntes;
|FPRC;

|DEFBUCLE lee_tempo;
 #18#1;
 ;
 "R",  0,      0, "  ";
 "S", 99, 999999, "zz";
 e;
 NULL, lee_tempo1;
|FIN;
_________________________________/RENUMERA APUNTES SEGUN HISTORICO IVAS
|PROCESO ren_rep;
  |SI sw_rep ! 0;
      fra_rep = fra_rep + 1;
      #2#16 = fra_rep;
      |ACABA;
  |FINSI;
  sw_rep = 1;
  #5#0 = #2#14;        || libro
  |ABRE #5;
  mas = 1;
  anter = #5#0;
  #5#2 = 999999;
  |LEE 001#5];
  |SI FSalida = 0;
     |LEE 001#5a;
     |SI FSalida ! 0; |O anter ! #5#0;
         mas = 0;
         |DDEFECTO #5;
     |FINSI;
     antnum = #5#2;
  |SINO;
     |LEE 001#5u;
     |SI FSalida ! 0; |O anter ! #5#0;
         mas = 0;
         |DDEFECTO #5;
     |FINSI;
     antnum = #5#2;
  |FINSI;
  |DDEFECTO #5;
  #5#0 = anter;
  #5#2 = antnum + mas;
  |CIERRA #5;
  fra_rep = #5#2;
  #2#16 = fra_rep;
|FPRC;

|PROCESO ren_sop;
  |SI sw_sop ! 0;
      fra_sop = fra_sop + #8#3;
      #2#16 = fra_sop;
      |ACABA;
  |FINSI;
  sw_sop = 1;
  #6#0 = #2#14;        || libro
  |ABRE #6;
  anter = #6#0;
  #6#2 = 999999;
  |LEE 040#6>;
  |SI FSalida = 0;
      |LEE 040#6a;
      antnum = #6#2;
  |SINO;
      |LEE 040#6u;
      |SI FSalida ! 0;
          |DDEFECTO #6;
          #6#2 = 0;
      |FINSI;
      antnum = #6#2;
  |FINSI;
  |DDEFECTO #6;
  #6#0 = anter;
  #6#2 = antnum + #8#3;
|ET sientrada;
  nume1 = #6#2 $ #8#3;
  |SI nume1 ! 0;
      #6#2 = #6#2 - 1;
      |VETE sientrada;
  |FINSI;
  |CIERRA #6;
  fra_sop = #6#2;
  #2#16 = fra_sop;
|FPRC;

|PROCESO sep_apunte;
     ||TODO CCC
  |DDEFECTO #2;
  alfa2 = canal % 102;
  #2#0 = alfa2;             || diario
  alfa2 = canal % 310;
  #2#1 = alfa2;             || fecha
  alfa2 = canal % 1306;
  #2#2 = alfa2;             || documento
  alfa2 = canal % 1906;
  #2#3 = alfa2;             || asiento
  alfa2 = canal % 2504;
  #2#4 = alfa2;             || apunte

  nPara2 = #2#4 + 1;
  |LEE 000#2=;
  |SI FSalida = 0;
      |PARA nPara1 = nPara2; |SI nPara1 [ 9999; |HACIENDO nPara1 = nPara1 + 1;
            #2#4 = nPara1;
            |LEE 001#2=;
            |SI FSalida ! 0;
                |SAL;
            |FINSI;
      |SIGUE;
      |SI nPara1 > 9999;
          |MENAV "    Error, existe mas de 9999 apuntes del Mismo asiento";
          |ACABA;
      |FINSI;
  |FINSI;

  alfa2 = canal % 2912;
  #2#5 = alfa2;             || cuenta debe
  alfa2 = canal % 4112;
  #2#6 = alfa2;             || cuenta haber

  eaCuenta = #2#5; |HAZ eSacaNivel;
  alfa2 = canal % 5301;
  #2#7 = alfa2;             || nivel debe
  #2#7 = enNivel;

  eaCuenta = #2#6; |HAZ eSacaNivel;
  alfa2 = canal % 5401;
  #2#8 = alfa2;             || nivel haber
  #2#8 = enNivel;

  alfa2 = canal % 5503;
  #2#9 = alfa2;             || concepto
  alfa2 = canal % 5830;
  #2#10 = alfa2;            || descripcion
  alfa2 = canal % 8801;
  #2#11 = alfa2;            || signo
  alfa2 = canal % 8911;
  #2#12 = alfa2;            || importe
  alfa2 = canal % 10001;
  #2#13 = alfa2;            || iva sop./rep.
  alfa2 = canal % 10102;
  #2#14 = alfa2;            || libro  (el campo #2#15 no hace falta)
  alfa222 = canal % 10306;
  alfa333 = canal % 10030;
  #2#16 = alfa222;            || factura/orden
  alfa2 = canal % 10902;
  #2#17 = alfa2;            || serie
  alfa2 = canal % 11103;
  #2#18 = alfa2;            || concepto iva
  alfa2 = canal % 11430;
  #2#19 = alfa2;            || descripcion iva
  alfa2 = canal % 14412;
  #2#20 = alfa2;            || cuenta cliente/proveedor

  eaCuenta = #2#20; |HAZ eSacaNivel;
  #2#21 = enNivel;

  alfa2 = canal % 15710;
  #2#22 = alfa2;            || base imp. 1
  alfa2 = canal % 16710;
  #2#23 = alfa2;            || base imp. 2
  alfa2 = canal % 17710;
  #2#24 = alfa2;            || base imp. 3
  alfa2 = canal % 18705;
  #2#25 = alfa2;            || (%) iva 1
  alfa2 = canal % 19205;
  #2#26 = alfa2;            || (%) iva 2
  alfa2 = canal % 19705;
  #2#27 = alfa2;            || (%) iva 3

  alfa2 = canal1 % 110;
  #2#28 = alfa2;            || cuota iva 1
  alfa2 = canal1 % 1110;
  #2#29 = alfa2;            || cuota iva 2
  alfa2 = canal1 % 2110;
  #2#30 = alfa2;            || cuota iva 3
  alfa2 = canal1 % 3105;
  #2#31 = alfa2;            || (%) rec 1
  alfa2 = canal1 % 3605;
  #2#32 = alfa2;            || (%) rec 2
  alfa2 = canal1 % 4105;
  #2#33 = alfa2;            || (%) rec 3
  alfa2 = canal1 % 4610;
  #2#34 = alfa2;            || cuota rec 1
  alfa2 = canal1 % 5610;
  #2#35 = alfa2;            || cuota rec 2
  alfa2 = canal1 % 6610;
  #2#36 = alfa2;            || cuota rec 3
  alfa2 = canal1 % 7610;
  #2#37 = alfa2;            || total factura
  alfa2 = canal1 % 8601;
  #2#38 = alfa2;            || inversion
  alfa2 = canal1 % 8701;
  #2#39 = alfa2;            || deducible
  alfa2 = canal1 % 8802;
  #2#40 = alfa2;            || departamento
  alfa2 = canal1 % 9010;
  #2#41 = alfa2;            || fecha iva
  alfa2 = canal1 % 10001;
  #2#42 = alfa2;            || tipo acumulador iva
  alfa2 = canal1 % 10101;
  #2#43 = alfa2;            || nro. acumulador iva
  alfa2 = canal1 % 10202;
  #2#44 = alfa2;            || periodo
  alfa2 = canal1 % 10403;
  #2#45 = alfa2;            || empresa contable
  alfa2 = canal1 % 10701;
  #2#46 = alfa2;            || periodo     (el campo #2#47 no hace falta)

     ||A partir de aqui cargo las 2 bases restantes

  alfa2 = canal1 % 10810;  ||base -4-
  #2#48 = alfa2;
  alfa2 = canal1 % 11810;  ||base -5-
  #2#49 = alfa2;
  alfa2 = canal1 % 12805;  ||Iva -4-
  #2#50 = alfa2;
  alfa2 = canal1 % 13305;  ||Iva -5-
  #2#51 = alfa2;
  alfa2 = canal1 % 13810;  ||cuota -4-
  #2#52 = alfa2;
  alfa2 = canal1 % 14810;  ||cuota -5-
  #2#53 = alfa2;
  alfa2 = canal1 % 15805;  ||Rec -4-
  #2#54 = alfa2;
  alfa2 = canal1 % 16305;  ||Rec -5-
  #2#55 = alfa2;
  alfa2 = canal1 % 16810;  ||Cuota rec -4-
  #2#56 = alfa2;
  alfa2 = canal1 % 17810;  ||Cuota rec -5-
  #2#57 = alfa2;

  alfa2 = canal1 % 22415;  ||NiF-
  #2#58 = alfa2;
  alfa2 = canal1 % 18836;  ||Nombre Cliente.
  #2#59 = alfa2;
  alfa2 = canal1 % 23901;  ||Machaca Nombre S/N...
  #2#60 = alfa2;

  |SI #2#22 ! 0; |O #2#23 ! 0; |O #2#24 ! 0;
                 |O #2#48 ! 0; |O #2#49 ! 0;        || si es asiento de iva
      |ABRE #18;
      #18#0 = #2#13;        || tipo de iva
      #18#1 = #2#14;        || libro
      #18#2 = #2#16;        || fra./orden
      #18#3 = #2#17;        || serie
      |SI #0#10 = "S";                                 || lo renumera
          |SI #2#13 = "R";  |HAZ ren_rep;  |FINSI;     ||/en su caso
          |SI #2#13 = "S";  |HAZ ren_sop;  |FINSI;
      |FINSI;
      #18#4 = #2#16;        || fra./orden segun historico
      |GRABA 000#18n;
      |SI FSalida ! 0;
          |MENAV "    ATENCION!!! Registro de IVA duplicado en Secuencial ...";
      |FINSI;
      |CIERRA #18;
  |FINSI;
  |GRABA 020#2c;

  aTipo    = #2#13;
  nNumFac  = #2#16;   || factura original
  aDescFac = #2#19;
|FPRC;

____________________________________/ FICHERO APUNTES
|PROCESO nombre;

    nCopio = 0;
    |XABRE "UB", alfa1, handle;
    |SI FSalida < 0;
        |XABRE "CUB", alfa1, handle;
        |SI FSalida = 0; nCopio = 1; |FINSI;
    |FINSI;
    |XCIERRA handle;

    |SI nCopio = 1;
        |DFICE aBase;
        eaOrigen  = alfa1;
        eaDestino = aBase + fiche;
        |HAZ eReciboFich;
        |SI enErrPas = 0; alfa1 = eaDestino; |FINSI;
    |FINSI;
|FPRC;

|PROCESO apunte;

  alfa1 = "enco" + fichero; alfa1 = alfa1 % -108;

  |NOME_DAT #2 alfa1;
  |ABRE #2; |CIERRA #2; |DELINDEX #2;

   alfa1 = directo + "enco" + fichero + ".seq";
   fiche = "enco" + fichero + ".seq";
   |HAZ nombre;

  |XABRE "UB", alfa1, handle;
  |SI FSalida < 0;
      |XABRE "CUB", alfa1, handle;
  |FINSI;
  |SI FSalida ] 0;

      |ABRE #2;
      |PARA; |SI; |HACIENDO;
             || ... ... ... ... ... ... ... ... ... TODO CCC. Paso a EURO del formato.

             |XLEE handle, 201, canal;
             |SI FSalida ! 201;   |SAL;   |FINSI;       ||era 107

             |XLEE handle, 241, canal1;
             |SI FSalida ! 241;   |SAL    |FINSI;       ||era 107   Antes del EURO era 241

             aAlfa = canal % 11101; aAlfa1 = canal % 11201; aAlfa2 = canal % 11301;
             |SI aAlfa = " "; |Y aAlfa1 ] "0"; |Y aAlfa1 [ "9"; |Y aAlfa2 ] "0"; |Y aAlfa2 [ "9";
                  aAlfa = canal % 11202;
                  |SI aTipo = "R";
                      |SI aAlfa ! "99"; |HAZ Cobro; |FINSI;
                  |SINO;
                      |SI aAlfa ! "99"; |HAZ Pago;  |FINSI;
                  |FINSI;
             |FINSI;
             |HAZ sep_apunte;
      |SIGUE;
  |FINSI;

  |XCIERRA handle;
  |CIERRA #2;
  Pos = -1;
|FPRC;
_________________________________________________________________________
____________________________________/ CALCULOS DE LECTURA DE SECUENCIALES
|PROCESO secuencial;

  directo = #1#2;
  |QBF directo;
  fichero = #0#3;
  fichero = "0000" + fichero;
  fichero = fichero % -104;
  |DELINDEX #18;
  |SI #0#8 = "S";
      |MENSA "    Preparando Fichero de Apuntes ...";
      |HAZ apunte;
      |BLIN 4;
  |FINSI;
  |MENSA "    Preparando Fichero de Cobros/Pagos ...";
  |HAZ recibo;
  |BLIN 4;
  |DELINDEX #18;
|FPRC;

|PROCESO Cobro;
  |ABRE #pcbox002; |DDEFECTO #pcbox002;
  alfa2 = canal % 10102;
  #pcbox002#00 = alfa2;           || libro
  alfa2 = canal % 10306;
  #pcbox002#01 = alfa2;           || factura
  alfa2 = canal % 10902;
  #pcbox002#02 = alfa2;           || serie
  #pcbox002#03 = "001";           || nro.cobro

  |SI #0#10 = "S";
     |ABRE #18;
     #18#0 = "R";
     #18#1 = #pcbox002#0;       || libro
     #18#2 = #pcbox002#1;       || fra./orden
     #18#3 = #pcbox002#2;       || serie
     |LEE 001#18=;
     |SI FSalida = 0;
         #pcbox002#1 = #18#4;   || fra./orden segun historico
     |FINSI;
     |CIERRA #18;
  |FINSI;

  || ABDON 09/06/2004
  || PARA VER SI EL COBRO CORRESPONDE A LA FACTURA, PUESTO QUE EL NUMERO DE
  ||    FACTURA DEL REGISTRO DE COBRO VIENE INCORRECTO (NO ES EL MISMO QUE
  ||    EL DE SU FACTURA CORRESPONDIENTE) SE COMPRUEBA QUE LA DESCRIPCION
  ||    DEL CONCEPTO DE LA FACTURA SEA EL MISMO QUE LA DESCRIPCION DEL
  ||    CONCEPTO DEL COBRO. SI POR CUALQUIER CASO CAMBIASEN ESA DESCRIPCION
  ||    EL PASE NO COGERIA CORRECTAMENTE EL CAMPO 'N§ FACTURA' DEL COBRO.

||aqui
||   |SI aDescCob = aDescFac; #pcbox002#1 = nNumFac; |FINSI;
 #pcbox002#1 = nNumFac;  ||tomaremos siempre la ultima factura

  |LEE 000#pcbox002.=;
  |SI FSalida = 0;
     alfa2 = canal % 10102; aAlfa = alfa2 + "/";
     alfa2 = canal % 10306; aAlfa = aAlfa + alfa2 + "/";
     alfa2 = canal % 10902; aAlfa = aAlfa + alfa2;
     aAlfa = "    El cobro " + aAlfa + " ya existe. No se pasara";
     |MENAV aAlfa; |ACABA;
  |FINSI;

  alfa2 = canal % 2912;
  #pcbox002#04 = alfa2;           || cuenta
  alfa2 = canal % 5301;
  eaCuenta = #pcbox002#4; |HAZ eSacaNivel;
  alfa2 = canal % 15710;
  #pcbox002#05 = alfa2;           || nivel
  #pcbox002#05 = enNivel;

  alfa2 = canal % 0310;
  #pcbox002#06 = alfa2;           || fecha emision
  alfa2 = canal % 11410;
  #pcbox002#07 = alfa2;           || fecha vencimiento
  alfa2 = canal % 8911;
  #pcbox002#08 = alfa2;           || importe
  alfa2 = canal % 11202;
  #pcbox002#11 = alfa2;           || tipo de recibo
  alfa2 = canal % 11410;
  #pcbox002#14 = alfa2;           || fecha vto. original

  #pcbox002#07 = #pcbox002#6;     || fecha vencimiento Tique 94(27.10.2004)
  #pcbox002#14 = #pcbox002#6;     || vto original
  #pcbox002#26 = #pcbox002#8;     || Importe Original

  |ABRE #caclipro;
  #caclipro#23 = "C";
  #caclipro#10 = #pcbox002#4;
  #caclipro#11 = #pcbox002#5;
  |LEE 000#caclipro.=;
  |SI FSalida ! 0; |DDEFECTO #caclipro; |FINSI;
  |CIERRA #caclipro;

  #pcbox002#15 = #caclipro#13;           || nombre banco
  #pcbox002#16 = #caclipro#14;           || direccion banco
  #pcbox002#17 = #caclipro#15;           || cod.postal 1
  #pcbox002#18 = #caclipro#16;           || cod.postal 2
  #pcbox002#19 = #caclipro#17;           || cta.cte.
  #pcbox002#20 = #caclipro#18;           || ccc
  #pcbox002#21 = #caclipro#19;           || poblacion banco

  |GRABA 020#pcbox002.n;

  aTipo = "";
  |CIERRA #pcbox002;
|FPRC;

|PROCESO Pago;
  |ABRE #pcbox003; |DDEFECTO #pcbox003;
  alfa2 = canal % 10102;
  #pcbox003#00 = alfa2;           || libro
  alfa2 = canal % 10306;
  #pcbox003#01 = alfa2;           || factura
  alfa2 = canal % 10902;
  #pcbox003#02 = alfa2;           || serie
  #pcbox003#03 = "001";           || nro.cobro

  |SI #0#10 = "S";
     |ABRE #18;
     #18#0 = "R";
     #18#1 = #pcbox003#0;       || libro
     #18#2 = #pcbox003#1;       || fra./orden
     #18#3 = #pcbox003#2;       || serie
     |LEE 001#18=;
     |SI FSalida = 0;
         #pcbox003#1 = #18#4;   || fra./orden segun historico
     |FINSI;
     |CIERRA #18;
  |FINSI;

  || ABDON 09/06/2004
  || PARA VER SI EL PAGO CORRESPONDE A LA FACTURA, PUESTO QUE EL NUMERO DE
  ||    FACTURA DEL REGISTRO DE PAGO VIENE INCORRECTO (NO ES EL MISMO QUE
  ||    EL DE SU FACTURA CORRESPONDIENTE) SE COMPRUEBA QUE LA DESCRIPCION
  ||    DEL CONCEPTO DE LA FACTURA SEA EL MISMO QUE LA DESCRIPCION DEL
  ||    CONCEPTO DEL PAGO. SI POR CUALQUIER CASO CAMBIASEN ESA DESCRIPCION
  ||    EL PASE NO COGERIA CORRECTAMENTE EL CAMPO 'N§ FACTURA' DEL PAGO.

  aDescCob = canal % 5830;
  |SI aDescCob = aDescFac; #pcbox003#1 = nNumFac; |FINSI;
  #pcbox003#1 = nNumFac; || tomaremos siempre la ultima factura

  |LEE 000#pcbox003.=;
  |SI FSalida = 0;
     alfa2 = canal % 10102; aAlfa = alfa2 + "/";
     alfa2 = canal % 10306; aAlfa = aAlfa + alfa2 + "/";
     alfa2 = canal % 10902; aAlfa = aAlfa + alfa2;
     aAlfa = "    El cobro " + aAlfa + " ya existe. No se pasara";
     |MENAV aAlfa; |ACABA;
  |FINSI;

  alfa2 = canal % 2912;
  #pcbox003#04 = alfa2;           || cuenta
  eaCuenta = #pcbox003#4; |HAZ eSacaNivel;
  alfa2 = canal % 5301;
  #pcbox003#05 = alfa2;           || nivel
  #pcbox003#05 = enNivel;

  alfa2 = canal % 0310;
  #pcbox003#06 = alfa2;           || fecha emision
  alfa2 = canal % 11410;
  #pcbox003#07 = alfa2;           || fecha vencimiento
  alfa2 = canal % 8911;
  #pcbox003#08 = alfa2;           || importe
  alfa2 = canal % 11202;
  #pcbox003#11 = alfa2;           || tipo de recibo
  alfa2 = canal % 11410;
  #pcbox003#14 = alfa2;           || fecha vto. original

  |ABRE #caclipro;
  #caclipro#23 = "P";
  #caclipro#10 = #pcbox003#4;
  #caclipro#11 = #pcbox003#5;
  |LEE 000#caclipro.=;
  |SI FSalida ! 0; |DDEFECTO #caclipro; |FINSI;
  |CIERRA #caclipro;

  #pcbox003#15 = #caclipro#13;           || nombre banco
  #pcbox003#16 = #caclipro#14;           || direccion banco
  #pcbox003#17 = #caclipro#15;           || cod.postal 1
  #pcbox003#18 = #caclipro#16;           || cod.postal 2
  #pcbox003#19 = #caclipro#17;           || cta.cte.
  #pcbox003#20 = #caclipro#18;           || ccc
  #pcbox003#21 = #caclipro#19;           || poblacion banco

  |GRABA 020#pcbox003.n;

  aTipo = "";
  |CIERRA #pcbox003;
|FPRC;
