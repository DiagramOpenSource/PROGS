|VARIABLES;
     nPos            = 0;
     nCampo          = 0;
     nHay            = 0;
     nPaso           = 0;
     nLen1           = 0;
     nLen            = 0;
     aCadena         = "";
     aLen            = "";
     aCaracter       = "";
     aIPRemoto       = "";
     aDocRemoto      = "";
     aDocServidor    = "";
     fFecha          = @;

     aAlfa           = "";
     nPunto          = 0;
     nError          = 0;
     aLongVar        = "";
     nLongVar        = 0;
     nCarVar         = 0;
     aCarVar         = "";
     nPosVar         = 0;

     {1}aContiene    = "";
     {50}aCarac      = "";

     &enPorCsv       = 0;
     &eaAlfa         = "";
     &eaTCampo       = "";
     &eaOrigen       = "";
     &eaDestino      = "";
     &enSwNuevoMD5   = 0;
|FIN;

|PROCESO QuitaPuntos;
     nError = 0;
     nPunto = 0;
     |QBT eaAlfa;
     aLongVar = eaAlfa % 0;
     nLongVar = aLongVar;
     aAlfa    = "";
     |PARA nCarVar = 1;  |SI nCarVar [ nLongVar;  |HACIENDO nCarVar = nCarVar + 1;
           nPosVar = (nCarVar * 100) + 1;
           aCarVar = eaAlfa % nPosVar;

           |SI  aCarVar ! ".";
                aAlfa = aAlfa + aCarVar;
           |SINO;
                aAlfa = aAlfa + ",";
                nPunto = nPunto + 1;
                |SI nPunto > 1;
                    nError = 1;
                    |SAL;
                |FINSI;
           |FINSI;
      |SIGUE;

      |SI nError = 0; eaAlfa = aAlfa; |FINSI;
|FPRC;

|PROCESO QuitaRarosNom;
     eaTCampo = "A";
     |QBF eaAlfa;
     |SI eaAlfa = "";  |ACABA;  |FINSI;
     |HAZ QuitaRarosCsv;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;

     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter ! "."; |Y aCaracter ! ","; |Y aCaracter ! "-";
               aCadena = aCadena + aCaracter;
           |FINSI;
     |SIGUE;

     eaAlfa = aCadena;
     |QBT eaAlfa;
|FPRC;

|PROCESO QuitaRarosCsv;
     |QBF eaAlfa;
     |SI eaAlfa = "";  |ACABA;  |FINSI;

     aAlfa = "/";
||     |SI enPorCsv = 2; aAlfa= "-"; |FINSI;
     |SI eaTCampo = "F";
         fFecha = eaAlfa;
         |SI fFecha > "01.01.1900";
             eaAlfa = (eaAlfa % 102) + aAlfa + (eaAlfa % 402) + aAlfa + (eaAlfa % 704);
         |SINO;
             eaAlfa = "";
         |FINSI;
         |ACABA;
     |FINSI;

     |SI eaTCampo = "N"; |Y enPorCsv ! 2;
         |HAZ QuitaPuntos;
         |ACABA;
     |FINSI;

     aCarac1   = "•";
     aCarac2   = "§";
     aCarac3   = "·";
     aCarac4   = "†";
     aCarac5   = "Ç";
     aCarac6   = "°";
     aCarac7   = "¢";
     aCarac8   = "£";
     aCarac9   = "ß";
     aCarac10  = "¶";
     aCarac11  = "®";
     aCarac12  = "Ä";
     aCarac13  = "á";
     aCarac14  = "Ö";
     aCarac15  = "ä";
     aCarac16  = "ç";
     aCarac17  = "ï";
     aCarac18  = "ó";
     aCarac19  = &001;
     aCarac20  = &002;
     aCarac21  = &003;
     aCarac22  = &004;
     aCarac23  = &005;
     aCarac24  = &006;
     aCarac25  = &007;
     aCarac26  = &015;
     aCarac27  = &016;
     aCarac28  = &017;
     aCarac29  = &018;
     aCarac30  = &019;
     aCarac31  = &020;
     aCarac32  = &021;
     aCarac33  = &022;
     aCarac34  = &023;
     aCarac35  = &024;
     aCarac36  = &025;
     aCarac37  = &026;
     aCarac38  = &028;
     aCarac39  = &029;
     aCarac40  = "Å";
     aCarac41  = &008;
     aCarac42  = "Ô";
     aCarac43  = "µ";
     aCarac44  = "ê";
     aCarac45  = "÷";
     aCarac46  = "‡";
     aCarac47  = "È";
     aCarac48  = &009;
     aCarac49  = &010;
     aCarac50  = &013;

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 50;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = eaAlfa - aCarac;
           |SI FSalida ! 0;
               nHay = 1;
               |SAL;
           |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;  |ACABA;  |FINSI;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;

     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           nPaso     = 0;

           |SI aCaracter = aCarac1;  |Y nPaso = 0;  aCaracter = &0209;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac2;  |Y nPaso = 0;  aCaracter = &0241;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac3;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac4;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac5;  |Y nPaso = 0;  aCaracter = &0233;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac6;  |Y nPaso = 0;  aCaracter = &0237;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac7;  |Y nPaso = 0;  aCaracter = &0243;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac8;  |Y nPaso = 0;  aCaracter = &0250;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac9;  |Y nPaso = 0;  aCaracter = &0176;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac10; |Y nPaso = 0;  aCaracter = &0170;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac11; |Y nPaso = 0;  aCaracter = &0191;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac12; |Y nPaso = 0;  aCaracter = "«";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac13; |Y nPaso = 0;  aCaracter = &0231;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac14; |Y nPaso = 0;  aCaracter = &0224;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac15; |Y nPaso = 0;  aCaracter = &0232;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac16; |Y nPaso = 0;  aCaracter = &0236;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac17; |Y nPaso = 0;  aCaracter = &0242;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac18; |Y nPaso = 0;  aCaracter = &0249;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac19; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac20; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac21; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac22; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac23; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac24; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac25; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac26; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac27; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac28; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac29; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac30; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac31; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac32; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac33; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac34; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac35; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac36; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac37; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac38; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac39; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac40; |Y nPaso = 0;  aCaracter = &252;    nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac41; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac42; |Y nPaso = 0;  aCaracter = "¥";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac43; |Y nPaso = 0;  aCaracter = "A";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac44; |Y nPaso = 0;  aCaracter = "E";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac45; |Y nPaso = 0;  aCaracter = "I";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac46; |Y nPaso = 0;  aCaracter = "O";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac47; |Y nPaso = 0;  aCaracter = "U";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac48; |Y nPaso = 0;  aCaracter = " ";     nPaso = 1;  |FINSI;

           |SI aCaracter = aCarac49; |Y nPaso = 0;  || Un retorno de carro
               |SI nCampo < nLen;
                   aCaracter = "";
                   nPaso     = 1;
               |FINSI;
           |FINSI;

           |SI aCaracter = aCarac50; |Y nPaso = 0;  || Un retorno de carro
               nLen1 = nLen - 1;
               |SI nCampo < nLen1;
                   aCaracter = "";
                   nPaso     = 1;
               |FINSI;
           |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa = aCadena;
|FPRC;

|PROCESO RecibeEnServidorMD5;
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;
         aIPRemoto   = "";
         |IP_REMOTO aIPRemoto;
         |SI aIPRemoto ! "";
             |RECIBE_FICHERO eaDestino, eaOrigen;

             aAlfa = "";
             |DIRECTORIO aAlfa;  |QBF aAlfa;
             aAlfa = aAlfa + "bin/agichmod 777 " + eaOrigen;
             |SYSTEM aAlfa;
         |SINO;
             |COPIA_FICHERO eaDestino, eaOrigen;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnviaFicheroSinMD5;
     |PULSATECLA;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     |SI FSalida ! 0;
         |PULSATECLA;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO EnviaFicheroConMD5;
     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocServidor  = FSalida;  |QBF aDocServidor;

     enSwNuevoMD5 = 0;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
         enSwNuevoMD5 = 1;
     |FINSI;
|FPRC;
