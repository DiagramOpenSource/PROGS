|FICHEROS;
     caemi303 #0;
     caman303 #1;
     caportad #2;
     camoneda #3;

     eosw0553 #553;
|FIN;

|VARIABLES;
     informe = "";
     &dia = "";
     &mes = "";
     &anyo = "";
     alfa1 = "";
     sw = 0;
     imsn1 = "";
     imsn2 = "";

     aValfa0     = "";
     aValfa1     = "";
     aValfa2     = "";
     aValfa      = "";
     nPosi       = 0;
     nSwPunto    = 0;

     nCalc       = 0;
     nHandleError = 0;

     nAnyo2D      = 0;
     aAlfa        = "";

     aAbre        = "";
     aModelos     = "";
     aOrigen      = "";
     aDestino     = "";

     nHandle1     = 0;
     nHandle2     = 0;
     nSwHay       = 0;
     nTCampo      = 0;
     nGraba       = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;
     nComa       = 0;
     nCaracter   = 0;
     nLong       = 0;
     nPos        = 0;

     aAlfa1      = "";
     aAlfa2      = "";
     aLong       = "";
     aCaracter   = "";

     aF2          = "";
     aF3          = "";
     aF4          = "";
     aF5          = "";
     aF6          = "";
     aTecla       = "";
     aFichError   = "";

     nHandlePortal = 0;
     aPathEmision  = "";
     aAbrePortal   = "";
     aFichero      = "";
     aUnidad       = "";
     aTipo         = "";

     {1}aContiene   = "";

     &eaMonedEmpre = "";
     &eaFOrigen    = "";
     &eaFDestino   = "";
     &eaInternet   = "";
     &eaImpresora  = "";
     &enNume       = 0;
     &eaAlfa       = "";
     &eaDiaB       = "";
     &eaMesB       = "";
     &eaAnyoB      = "";
     &eaModelos    = "";
     &eaPathModelo = "";

     &eaPathEmision    = "";
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &eaUnidadBasico = "";

     &enSwTrata          = 0;
     &eaEjer             = "";
     &eaPathLanza        = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroImpre     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &enTecla            = 0;
     &eaPeriodo          = "";
     &eaIBAN             = "";
     &eaPaginas          = "";
     &eaCampo0           = "";
     &eaCampo1           = "";
     &eaCampo3           = "";
     &eaCampo5           = "";
     &eaCampo6           = "";
     &eaCampo7           = "";
     &eaCampo8           = "";

     nTecla              = 0;
    perialf              = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE seguim_i;
|INCLUYE i_laserc;

|PROCESO VarVacia_01;
     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + aTipo + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;
|FPRC;

|PROCESO Portal303_2013;
     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     aAlfa = "Conectandose a la pagina de la aeat";
     |PINTA 1210, aAlfa;

     aAbrePortal = eaPathEmision + "portal303.html";
     |XABRE "WB", aAbrePortal, nHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/es13/l/zi21zilk0021" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "IE13030B" + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "N";
     |SI #eosw0553#69 ! "00000000000000000";
         aTipo = "I";
     |SINO;
         |SI #eosw0553#61 ! "00000000000000000";
             aTipo = "C";
         |SINO;
             |SI #eosw0553#63 ! "00000000000000000";
                 aTipo = "D";
             |FINSI;
         |FINSI;
     |FINSI;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "TIA" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "NDC" + &34 + " value=" + &34 + #eosw0553#7 + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "NRC";  |HAZ VarVacia_01;
     aTipo = "ING";  |HAZ VarVacia_01;
     aTipo = "NRR";  |HAZ VarVacia_01;
     aTipo = "ICO";  |HAZ VarVacia_01;
     aTipo = "NR1";  |HAZ VarVacia_01;
     aTipo = "IN1";  |HAZ VarVacia_01;
     aTipo = "NR2";  |HAZ VarVacia_01;
     aTipo = "IN2";  |HAZ VarVacia_01;
     aTipo = "NR3";  |HAZ VarVacia_01;
     aTipo = "IN3";  |HAZ VarVacia_01;
     aTipo = "NR4";  |HAZ VarVacia_01;
     aTipo = "IN4";  |HAZ VarVacia_01;
     aTipo = "NR5";  |HAZ VarVacia_01;
     aTipo = "IN5";  |HAZ VarVacia_01;
     aTipo = "NR6";  |HAZ VarVacia_01;
     aTipo = "IN6";  |HAZ VarVacia_01;
     aTipo = "NR7";  |HAZ VarVacia_01;
     aTipo = "IN7";  |HAZ VarVacia_01;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "F01" + &34 + " value=" + &34 + "<T3030" + #eosw0553#11 + "0A0000><AUX>";
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 150;
     |HAZ GrabaPortalSin;
     |HAZ GrabaPortalSin;

     eaAlfa = "</AUX><VECTOR>001FIN";
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 200;
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 94;
     |HAZ GrabaPortalSin;

     eaAlfa = "</VECTOR>";
     |HAZ GrabaPortalSin;

     |SI #eosw0553#68 = "3";  #eosw0553#68 = "2";   #eosw0553#6 = "I";  |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 82;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #eosw0553#nCampo#;
           |XGRABA nHandlePortal, eaAlfa;
     |SIGUE;

     eaAlfa = "</T3030" + #eosw0553#11 + "0A0000>" + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "TXT";  |HAZ VarVacia_01;
     aTipo = "FIR";  |HAZ VarVacia_01;

     aTipo = "F";
     |SI #eosw0553#70 ! "    ";
         aTipo = #eosw0553#70;
     |SINO;
         |SI #eosw0553#64 ! "    ";
             aTipo = #eosw0553#64;
         |FINSI;
     |FINSI;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #eosw0553#11 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "303" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + "EWLINKPS" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandlePortal;

     eaFOrigen  = aAbrePortal;
     eaFDestino = eaPathLanza + "portal303.html";
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = aContiene1 % 102;

     |SI eaPathExplorador ! "";
         eaAlfa = eaPathExplorador + " " + aUnidad + eaFDestino;
     |SINO;
         eaAlfa = aUnidad + eaFDestino;
     |FINSI;

     |HAZ ConvierteBarra;

     eaAlfa  = "cmd " + &34 + "/c START /WAIT " + eaAlfa + &34;

     |RSYSTEM eaAlfa;

     |FBORRA eaFOrigen;
     |RFBORRA eaFDestino;

     |POPV;
|FPRC;

|PROCESO PresentaModelo;
     enErrorPortal = 0;
     |HAZ ValidaMPF;
     |SI enErrorPortal = 1;  |ACABA;  |FINSI;

     |SI eaOpcion = "1";
         |HAZ Portal303_2013;
     |FINSI;

     |SI eaOpcion = "3";
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroPtl;
     |FINSI;
|FPRC;

|PROCESO MiroM; |TIPO 7;
  |ABRE #1;
  #1#45 = "D";
  #1#1  = 0;
  #1#2  = 0;
  |LEE 001#1];
  |SI FSalida = 0;  |Y  #1#45 = "D";
      |C_M #caemi303#0, 1, "S";
      #caemi303#0 = "D"; |PINTA #caemi303#0;
      |CIERRA #1;
      |ACABA;
  |FINSI;

  #1#45 = "M";
  #1#1  = 0;
  #1#2  = 0;
  |LEE 001#1];
  |SI FSalida = 0;  |Y  #1#45 = "M";
      |C_M #caemi303#0, 1, "S";
      #caemi303#0 = "M"; |PINTA #caemi303#0;
      |CIERRA #1;
      |ACABA;
  |FINSI;
  |CIERRA #1;

  |C_M #caemi303#0, 1, "N";
  #caemi303#0 = "T"; |PINTA #caemi303#0;
|FPRC;

|PROCESO MiraMoneda;
   eaMonedEmpre = "P";
   |ABRE #camoneda;
   #camoneda#0 = #48#2;
   #camoneda#1 = #48#3;
   |LEE 000#camoneda.=;
   |SI FSalida = 0;
       eaMonedEmpre = #camoneda#2;
   |FINSI;
   |CIERRA #camoneda;

   eaMoneda     = "P";
   |SI #caemi303#6 = "L";  |O #caemi303#6 = "F";
        eaMoneda = "E";
   |FINSI;
|FPRC;

|PROCESO def_any; |TIPO 7;
     |SI #30#26 < 80;
         #caemi303#1   = 2000 + #30#26;     |PINTA #caemi303#1;
     |SINO;
         #caemi303#1   = 1900 + #30#26;     |PINTA #caemi303#1;
     |FINSI;
|FPRC;

|PROCESO fecha;
     dia = #caemi303#5 % 102;
     anyo = #caemi303#5 % 704;
     mes = #caemi303#5 % 402;
     mes1 = mes;
     |SI mes1 = 1;  mes = "ENERO";      |FINSI;
     |SI mes1 = 2;  mes = "FEBRERO";    |FINSI;
     |SI mes1 = 3;  mes = "MARZO";      |FINSI;
     |SI mes1 = 4;  mes = "ABRIL";      |FINSI;
     |SI mes1 = 5;  mes = "MAYO";       |FINSI;
     |SI mes1 = 6;  mes = "JUNIO";      |FINSI;
     |SI mes1 = 7;  mes = "JULIO";      |FINSI;
     |SI mes1 = 8;  mes = "AGOSTO";     |FINSI;
     |SI mes1 = 9;  mes = "SEPTIEMBRE"; |FINSI;
     |SI mes1 = 10; mes = "OCTUBRE";    |FINSI;
     |SI mes1 = 11; mes = "NOVIEMBRE";  |FINSI;
     |SI mes1 = 12; mes = "DICIEMBRE";  |FINSI;
|FPRC;

|PROCESO graba1;
    |SI #caemi303#6 = "B"; |ACABA; |FINSI;

    aFichError = eaPathModelo + "ERR" + (("00000" + #1#0) % -105) + ".TXT";
    |XABRE "EC", aFichError, nHandleError;
    |SI FSalida ] 0;
        #1#3 = "";
        #1#4 = "N";
        |GRABA 020#1a;
        |LIBERA #1;

        |ACABA;
    |FINSI;

    |SI #caemi303#6 = "F";
        aOrigen  = eaPathModelo + "303" + (("00000" + #1#0) % -105) + ".TXT";
        aDestino = eaInternet   + "303" + (("00000" + #1#0) % -105) + ".TXT";
        |RCOPIA_FICHERO aOrigen, aDestino;
    |FINSI;

    |SI #caemi303#6 = "L";
    |FINSI;

    aOrigen  = eaPathModelo + "303" + (("00000" + #1#0) % -105) + ".TXT";
    |RFBORRA aOrigen;

    #1#3 = #caemi303#5;
    #1#4 = "S";
    |GRABA 020#1a;
    |LIBERA #1;

    se_ejerc  = #2#1;
    se_modelo = "303";
    se_impor  = #1#33 - #1#31 - #1#32;
    se_fecha  = #1#3;
    |SI SwAgicli = 1;
        |HAZ AlAgicl2;
    |FINSI;
|FPRC;

|DEFBUCLE graba_303;
     #1#1;
     ;
     #caemi303#0 , #caemi303#3 , nAnyo2D;
     #caemi303#0 , #caemi303#3 , nAnyo2D;
     be;
     NULL , graba1;
|FIN;

|PROCESO CargaImprime;
     aAlfa = "del err" + (("00000" + #1#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:303" + (("00000" + #1#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #1#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:N";
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |SI #caemi303#6 = "L";
         aAlfa = "DEL " + "303" + (("00000" + #1#0) % -105) + ".TXT ";
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO TDeclaracion;

     |SI #1#31 ! 0;
         |SI #2#69 ! "          ";
             #553#64 = #2#66;
             #553#65 = #2#67;
             #553#66 = #2#68;
             #553#67 = #2#69;
         |FINSI;
     |FINSI;

     #553#68 = "0";
     |SI #1#33 ! 0;
         #553#68 = "1";
         |SI #caemi303#8 = "S";  |O #caemi303#8 = "D";
             |SI #2#69 ! "          ";
                 |SI #caemi303#8 = "S";  #553#68 = "2";  |FINSI;
                 |SI #caemi303#8 = "D";  #553#68 = "3";  |FINSI;

                 #553#70 = #2#66;
                 #553#71 = #2#67;
                 #553#72 = #2#68;
                 #553#73 = #2#69;
             |FINSI;
         |FINSI;
     |FINSI;

     #553#6 = "";
     |SI #1#32 ! 0; #553#6 = "C"; |FINSI;
     |SI #1#31 ! 0; #553#6 = "D"; |FINSI;

     |SI #1#33 ! 0;
                                              #553#6 = "I";
         |SI  #caemi303#8 = "A";     |Y #caemi303#1 < 2013; #553#6 = "A";  |FINSI;
         |SI  #553#68 = "3";  |Y #caemi303#8 = "D";  #553#6 = "U";  |FINSI;
     |FINSI;

     |SI #1#31 = 0;  |Y #1#32 = 0; |Y #1#33 = 0;
         #553#6 = "N";
     |FINSI;
|FPRC;

|PROCESO BuscaNombre;
     |QBF eaAlfa;
     aAlfa1 = "";
     aAlfa2 = "";
     aLong  = eaAlfa % 0;
     nLong  = aLong;
     nComa  = 0;

     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = eaAlfa % nPos;

           |SI aCaracter = ",";
               nComa = 1;
           |SINO;
               |SI nComa = 0;
                   aAlfa1 = aAlfa1 + aCaracter;
               |SINO;
                   |SI aCaracter = " ";  |Y aAlfa2 = "";
                   |SINO;
                       aAlfa2 = aAlfa2 + aCaracter;
                   |FINSI;
               |FINSI;
           |FINSI;
      |SIGUE;
|FPRC;

|PROCESO Carga303;
     |SI #caemi303#6 = "L";  |O #caemi303#6 = "F";
         aAbre = eaPathModelo + "303" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |DDEFECTO #553;

     #553#0   = #2#0;

     aAlfa    = #2#13;  |QBF aAlfa;
     #553#7   = ("000000000" + aAlfa) % -109;

     aAlfa = #2#13 % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #2#2;      |HAZ BuscaNombre;
         eaAlfa = aAlfa1;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         eaAlfa = aAlfa2;    |HAZ QuitaRaros;     #553#9   = eaAlfa;
     |SINO;
         eaAlfa   = #2#2;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         #553#9   = " ";
     |FINSI;

                       #553#10 = "2";
     |SI #1#45 = "D";  #553#10 = "1";  |FINSI;

     #553#11  = #caemi303#1;

     |SI #caemi303#0 = "T";
         #553#12  = #caemi303#3 + "T";
     |SINO;
         #553#12  = ("00" + #caemi303#3) % -102;
     |FINSI;

     |SI #1#5 = 0;  |Y #1#7 = 0;
         #1#6 = 0;
     |FINSI;

     |SI #1#8 = 0;  |Y #1#10 = 0;
         #1#9 = 0;
     |FINSI;

     |SI #1#11 = 0;  |Y #1#13 = 0;
         #1#12 = 0;
     |FINSI;

     |SI #1#14 = 0;  |Y #1#16 = 0;
         #1#15 = 0;
     |FINSI;

     |SI #1#17 = 0;  |Y #1#19 = 0;
         #1#18 = 0;
     |FINSI;

     |SI #1#46 = 0;  |Y #1#48 = 0;
         #1#47 = 0;
     |FINSI;

     enNume   = #1#5;              |HAZ Conver17;    #553#13 = eaAlfa;
     enNume   = #1#6 * 100;                          #553#14 = ("00000" + enNume) % -105;
     enNume   = #1#7;              |HAZ Conver17;    #553#15 = eaAlfa;

     enNume   = #1#8;              |HAZ Conver17;    #553#16 = eaAlfa;
     enNume   = #1#9 * 100;                          #553#17 = ("00000" + enNume) % -105;
     enNume   = #1#10;             |HAZ Conver17;    #553#18 = eaAlfa;

     enNume   = #1#11;             |HAZ Conver17;    #553#19 = eaAlfa;
     enNume   = #1#12 * 100;                         #553#20 = ("00000" + enNume) % -105;
     enNume   = #1#13;             |HAZ Conver17;    #553#21 = eaAlfa;

     enNume   = #1#14;             |HAZ Conver17;    #553#22 = eaAlfa;
     enNume   = #1#15 * 100;                         #553#23 = ("00000" + enNume) % -105;
     enNume   = #1#16;             |HAZ Conver17;    #553#24 = eaAlfa;

     enNume   = #1#17;             |HAZ Conver17;    #553#25 = eaAlfa;
     enNume   = #1#18 * 100;                         #553#26 = ("00000" + enNume) % -105;
     enNume   = #1#19;             |HAZ Conver17;    #553#27 = eaAlfa;

     enNume   = #1#46;             |HAZ Conver17;    #553#28 = eaAlfa;
     enNume   = #1#47 * 100;                         #553#29 = ("00000" + enNume) % -105;
     enNume   = #1#48;             |HAZ Conver17;    #553#30 = eaAlfa;

     enNume   = #1#49;             |HAZ Conver17;    #553#31 = eaAlfa;
     enNume   = #1#50;             |HAZ Conver17;    #553#32 = eaAlfa;
     enNume   = #1#20;             |HAZ Conver17;    #553#33 = eaAlfa;

     enNume   = #1#62;             |HAZ Conver17;    #553#34 = eaAlfa;
     enNume   = #1#21;             |HAZ Conver17;    #553#35 = eaAlfa;
     enNume   = #1#63;             |HAZ Conver17;    #553#36 = eaAlfa;
     enNume   = #1#43;             |HAZ Conver17;    #553#37 = eaAlfa;
     enNume   = #1#64;             |HAZ Conver17;    #553#38 = eaAlfa;
     enNume   = #1#22;             |HAZ Conver17;    #553#39 = eaAlfa;
     enNume   = #1#65;             |HAZ Conver17;    #553#40 = eaAlfa;
     enNume   = #1#44;             |HAZ Conver17;    #553#41 = eaAlfa;
     enNume   = #1#66;             |HAZ Conver17;    #553#42 = eaAlfa;
     enNume   = #1#51;             |HAZ Conver17;    #553#43 = eaAlfa;
     enNume   = #1#67;             |HAZ Conver17;    #553#44 = eaAlfa;
     enNume   = #1#58;             |HAZ Conver17;    #553#45 = eaAlfa;
     enNume   = #1#23;             |HAZ Conver17;    #553#46 = eaAlfa;
     enNume   = #1#24;             |HAZ Conver17;    #553#47 = eaAlfa;
     enNume   = #1#61;             |HAZ Conver17;    #553#48 = eaAlfa;
     enNume   = #1#25;             |HAZ Conver17;    #553#49 = eaAlfa;
     enNume   = #1#26;             |HAZ Conver17;    #553#50 = eaAlfa;

     enNume  = #1#27 * 100;                          #553#51 = ("00000" + enNume) % -105;
     enNume  = #1#28;              |HAZ Conver17;    #553#52 = eaAlfa;
     enNume  = #1#29;              |HAZ Conver17;    #553#53 = eaAlfa;
     enNume  = #1#54;              |HAZ Conver17;    #553#54 = eaAlfa;
     enNume  = #1#68;              |HAZ Conver17;    #553#55 = eaAlfa;
     enNume  = #1#69;              |HAZ Conver17;    #553#56 = eaAlfa;
     enNume  = #1#30;              |HAZ Conver17;    #553#57 = eaAlfa;
     enNume  = #1#28 - #1#29 + #1#30;
                                   |HAZ Conver17;    #553#58 = eaAlfa;
     enNume  = 0;                  |HAZ Conver17;    #553#59 = eaAlfa;
     enNume  = #1#28 - #1#29 + #1#30;
                                   |HAZ Conver17;    #553#60 = eaAlfa;
     enNume  = #1#32;              |HAZ Conver17;    #553#61 = eaAlfa;

     #553#62 = "0";

     |SI #1#31 = 0;  |Y #1#32 = 0; |Y #1#33 = 0;
         #553#62 = "1";
     |FINSI;

     enNume  = #1#31;              |HAZ Conver17;    #553#63 = eaAlfa;
     enNume  = #1#33;              |HAZ Conver17;    #553#69 = eaAlfa;

     |HAZ TDeclaracion;

     #553#74 = "0";
     #553#75 = "";

     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #553#78 = eaAlfa;

     eaAlfa  = #caemi303#5;     |HAZ FechaBonito;

     #553#79 = eaDiaB;
     #553#80 = eaMesB;
     #553#81 = eaAnyoB;
     #553#83 = &13 + &10;

     nTCampo = 83;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #553nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #caemi303#6 = "L";  |O #caemi303#6 = "F";
         |HAZ CargaImprime;
     |FINSI;

     |SI #caemi303#6 ! "L"; |Y #caemi303#6 ! "F";
         |PRINT;
         |PIEINF;
     |FINSI;

     |GRABA 020#553n;
     |LIBERA #553;

     nSwHay = 1;
|FPRC;

|PROCESO imprimir;
     |SI #caemi303#6 ! "B"; |Y #1#4 ! #caemi303#7; |ACABA; |FINSI;

     |HAZ Carga303;

     |LIBERA #1;
|FPRC;

|DEFBUCLE mira_303;
     #1#2;
     ;
     #caemi303#0 , #caemi303#3 , nAnyo2D , imsn1;
     #caemi303#0 , #caemi303#3 , nAnyo2D , imsn2;
     be;
     NULL , imprimir;
|FIN;

|PROCESO reimpr;
     |SI #caemi303#6 = "B";
         imsn1 = " ";   imsn2 = "z";
     |SINO;
         imsn1 = #caemi303#7;  imsn2 = #caemi303#7;
     |FINSI;
|FPRC;

|PROCESO Impresora;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #caemi303#1 ] 2015;
         |INFOR  "m303co04";
     |SINO;
         |INFOR  "cac01303";
     |FINSI;
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |HAZ reimpr;
     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = nAnyo2D;
     |LEE 001#2=;
     |SI FSalida = 0;
         |HAZ AlAgicl1; || lee Modulo Integrador ....
         |HAZ fecha;
         |BUCLE mira_303;
         |SI sw = 1; |PIEINF; |FINSI;
     |SINO;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
     |FINSI;

     |FININF;
     |FINIMP;

     |CIERRA #2;
|FPRC;

|PROCESO AbreImprime;
     aAbre = eaPathModelo + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = eaUnidadBasico + &13 + &10; |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + eaUnidadBasico + "\MODELOS" + &13 + &10;   |XGRABA nHandle1, aAlfa;
     aAlfa = "CD 303" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + #caemi303#1 + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + (("00" + #caemi303#3) % -102) + &13 + &10;  |XGRABA nHandle1, aAlfa;

     aAlfa = #caemi303#1;
     aAlfa = aAlfa % -102;
     aVersion = "01";

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = (aContiene1 % 102) > "";

     aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + aUnidad + "\MODELOS\303\";
     aAlfa = aAlfa + #caemi303#1 + "\" + (("00" + #caemi303#3) % -102) + "\" + &13 + &10;

     |XGRABA nHandle1, aAlfa;

     aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     eaModelos = "303";   |HAZ Copiampf;

     aAlfa = eaPathModelo + "IMPRIME";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO Laser;
     imsn1 = #caemi303#7;  imsn2 = #caemi303#7;

     eaPathModelo = eaUnidadBasico + "/MODELOS/303/" + #caemi303#1 + "/" + (("00" + #caemi303#3) % -102) + "/";

     |SI #caemi303#6 = "F";  |O #caemi303#6 = "L";
         aAlfa      = eaUnidadBasico + "/AEAT";                       |RMKDIR aAlfa;
         aAlfa      = eaUnidadBasico + "/AEAT/INTERNET";              |RMKDIR aAlfa;
         aAlfa      = eaUnidadBasico + "/AEAT/INTERNET/303";          |RMKDIR aAlfa;
         aAlfa      = eaUnidadBasico + "/AEAT/INTERNET/303/" + #caemi303#1;  |RMKDIR aAlfa;
         aAlfa      = eaUnidadBasico + "/AEAT/INTERNET/303/" + #caemi303#1 + "/" + (("00" + #caemi303#3) % -102);   |RMKDIR aAlfa;
         eaInternet = aAlfa + "/";

         aAlfa = eaUnidadBasico + "/MODELOS";               |RMKDIR aAlfa;
         aAlfa = eaUnidadBasico + "/MODELOS/303";           |RMKDIR aAlfa;
         aAlfa = eaUnidadBasico + "/MODELOS/303/" + #caemi303#1;   |RMKDIR aAlfa;
         aAlfa = eaUnidadBasico + "/MODELOS/303/" + #caemi303#1 + "/" + (("00" + #caemi303#3) % -102);   |RMKDIR aAlfa;
         |HAZ AbreImprime;
     |FINSI;

     nSwHay = 0;

     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = nAnyo2D;
     |LEE 001#2=;
     |SI FSalida = 0;
         |HAZ AlAgicl1; || lee Modulo Integrador ....
         |HAZ fecha;
         |BUCLE mira_303;
     |SINO;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
     |FINSI;
     |CIERRA #2;

     |SI #caemi303#6 = "L";
         |SI nSwHay = 1;
             |HAZ EmiteEsto;
             eaTipoSec = "303";
             eaTipoEmi = "ERRORES";
             enAnyo    = #caemi303#1;
             |SUB_EJECUTA "eosz9999";
         |SINO;
             |MENAV "     Seleccion Vacia";
             |XCIERRA nHandle1;
         |FINSI;

         aAlfa = eaPathModelo + "imprime.bat";
         |RFBORRA aAlfa;

         |BUCLE graba_303;
     |FINSI;

     |SI #caemi303#6 = "F";
         |SI nSwHay = 1;
             |HAZ EmiteEsto;
             eaTipoSec = "303";
             eaTipoEmi = "ERRORES";
             enAnyo    = #caemi303#1;
             |SUB_EJECUTA "eosz9999";
         |SINO;
             |MENAV "     Seleccion Vacia";
             |XCIERRA nHandle1;
         |FINSI;

         aAlfa = eaPathModelo + "imprime.bat";
         |RFBORRA aAlfa;

         |BUCLE graba_303;

         aAlfa =  "      Los ficheros validados estan situados en " + eaInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Boton3031;
     |PTEC 824;
|FPRC;

|PROCESO Boton3032;
     |PTEC 825;
|FPRC;

|PROCESO Boton3033;
     |PTEC 826;
|FPRC;

|PROCESO Boton3034;
     |PTEC 806;
|FPRC;

|PROCESO Boton3035;
     |PTEC 827;
|FPRC;

|PROCESO Botones303;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda          ", 0513, 0754, Boton3031;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica              ", 0913, 1154, Boton3032;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Informe de Comprobacion              ", 1313, 1554, Boton3033;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3034;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Predeterminar Explorador de internet ", 1713, 1954, Boton3035;
     nBoton2 = FSalida;

     eaForzExplorador = "S";

     #caemi303#6 = "";
     aF2   = &255 + "824";
     aF3   = &255 + "825";
     aF4   = &255 + "826";
     aF5   = &255 + "827";
     aF6   = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  #caemi303#6 = "L";   |SAL;  |FINSI;
         |SI aTecla = aF3;  #caemi303#6 = "F";   |SAL;  |FINSI;
         |SI aTecla = aF4;  #caemi303#6 = "B";   |SAL;  |FINSI;
         |SI aTecla = aF5;  |HAZ Explorador;     |FINSI;
         |SI aTecla = aF6;                |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROCESO Bloque2012;
     |SI #caemi303#6 ! "B";
         |HAZ Botones303;
     |FINSI;
     |SI #caemi303#6 = " ";  |ACABA;  |FINSI;

     |ABRE #553;

     |SI #caemi303#6 = "L"; |O #caemi303#6 = "F";  |HAZ Laser;      |FINSI;
     |SI #caemi303#6 = "O"; |O #caemi303#6 = "B";  |HAZ Impresora;  |FINSI;

     |CIERRA #553;
     |DELINDEX #553;
|FPRC;
|| --------------------------------------------------------------------------
|PROCESO Carga303_2013;
     |DDEFECTO #553;

     #553#0   = #2#0;

     aAlfa    = #2#13;  |QBF aAlfa;
     #553#7   = ("000000000" + aAlfa) % -109;

     aAlfa = #2#13 % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #2#2;      |HAZ BuscaNombre;
         eaAlfa = aAlfa1;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         eaAlfa = aAlfa2;    |HAZ QuitaRaros;     #553#9   = eaAlfa;
     |SINO;
         eaAlfa   = #2#2;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         #553#9   = " ";
     |FINSI;

                       #553#10 = "2";
     |SI #1#45 = "D";  #553#10 = "1";  |FINSI;

     #553#11  = #caemi303#1;

     |SI #caemi303#0 = "T";
         #553#12  = #caemi303#3 + "T";
     |SINO;
         #553#12  = ("00" + #caemi303#3) % -102;
     |FINSI;

     |SI #1#5 = 0;  |Y #1#7 = 0;
         #1#6 = 0;
     |FINSI;

     |SI #1#8 = 0;  |Y #1#10 = 0;
         #1#9 = 0;
     |FINSI;

     |SI #1#11 = 0;  |Y #1#13 = 0;
         #1#12 = 0;
     |FINSI;

     |SI #1#14 = 0;  |Y #1#16 = 0;
         #1#15 = 0;
     |FINSI;

     |SI #1#17 = 0;  |Y #1#19 = 0;
         #1#18 = 0;
     |FINSI;

     |SI #1#46 = 0;  |Y #1#48 = 0;
         #1#47 = 0;
     |FINSI;

     enNume   = #1#5;              |HAZ Conver17;    #553#13 = eaAlfa;
     enNume   = #1#6 * 100;                          #553#14 = ("00000" + enNume) % -105;
     enNume   = #1#7;              |HAZ Conver17;    #553#15 = eaAlfa;

     enNume   = #1#8;              |HAZ Conver17;    #553#16 = eaAlfa;
     enNume   = #1#9 * 100;                          #553#17 = ("00000" + enNume) % -105;
     enNume   = #1#10;             |HAZ Conver17;    #553#18 = eaAlfa;

     enNume   = #1#11;             |HAZ Conver17;    #553#19 = eaAlfa;
     enNume   = #1#12 * 100;                         #553#20 = ("00000" + enNume) % -105;
     enNume   = #1#13;             |HAZ Conver17;    #553#21 = eaAlfa;

     enNume   = #1#14;             |HAZ Conver17;    #553#22 = eaAlfa;
     enNume   = #1#15 * 100;                         #553#23 = ("00000" + enNume) % -105;
     enNume   = #1#16;             |HAZ Conver17;    #553#24 = eaAlfa;

     enNume   = #1#17;             |HAZ Conver17;    #553#25 = eaAlfa;
     enNume   = #1#18 * 100;                         #553#26 = ("00000" + enNume) % -105;
     enNume   = #1#19;             |HAZ Conver17;    #553#27 = eaAlfa;

     enNume   = #1#46;             |HAZ Conver17;    #553#28 = eaAlfa;
     enNume   = #1#47 * 100;                         #553#29 = ("00000" + enNume) % -105;
     enNume   = #1#48;             |HAZ Conver17;    #553#30 = eaAlfa;

     enNume   = #1#49;             |HAZ Conver17;    #553#31 = eaAlfa;
     enNume   = #1#50;             |HAZ Conver17;    #553#32 = eaAlfa;
     enNume   = #1#20;             |HAZ Conver17;    #553#33 = eaAlfa;

     enNume   = #1#62;             |HAZ Conver17;    #553#34 = eaAlfa;
     enNume   = #1#21;             |HAZ Conver17;    #553#35 = eaAlfa;
     enNume   = #1#63;             |HAZ Conver17;    #553#36 = eaAlfa;
     enNume   = #1#43;             |HAZ Conver17;    #553#37 = eaAlfa;
     enNume   = #1#64;             |HAZ Conver17;    #553#38 = eaAlfa;
     enNume   = #1#22;             |HAZ Conver17;    #553#39 = eaAlfa;
     enNume   = #1#65;             |HAZ Conver17;    #553#40 = eaAlfa;
     enNume   = #1#44;             |HAZ Conver17;    #553#41 = eaAlfa;
     enNume   = #1#66;             |HAZ Conver17;    #553#42 = eaAlfa;
     enNume   = #1#51;             |HAZ Conver17;    #553#43 = eaAlfa;
     enNume   = #1#67;             |HAZ Conver17;    #553#44 = eaAlfa;
     enNume   = #1#58;             |HAZ Conver17;    #553#45 = eaAlfa;
     enNume   = #1#23;             |HAZ Conver17;    #553#46 = eaAlfa;
     enNume   = #1#24;             |HAZ Conver17;    #553#47 = eaAlfa;
     enNume   = #1#61;             |HAZ Conver17;    #553#48 = eaAlfa;
     enNume   = #1#25;             |HAZ Conver17;    #553#49 = eaAlfa;
     enNume   = #1#26;             |HAZ Conver17;    #553#50 = eaAlfa;

     enNume  = #1#27 * 100;                          #553#51 = ("00000" + enNume) % -105;
     enNume  = #1#28;              |HAZ Conver17;    #553#52 = eaAlfa;
     enNume  = #1#29;              |HAZ Conver17;    #553#53 = eaAlfa;
     enNume  = #1#54;              |HAZ Conver17;    #553#54 = eaAlfa;
     enNume  = #1#68;              |HAZ Conver17;    #553#55 = eaAlfa;
     enNume  = #1#69;              |HAZ Conver17;    #553#56 = eaAlfa;
     enNume  = #1#30;              |HAZ Conver17;    #553#57 = eaAlfa;
     enNume  = #1#28 - #1#29 + #1#30;
                                   |HAZ Conver17;    #553#58 = eaAlfa;
     enNume  = 0;                  |HAZ Conver17;    #553#59 = eaAlfa;
     enNume  = #1#28 - #1#29 + #1#30;
                                   |HAZ Conver17;    #553#60 = eaAlfa;
     enNume  = #1#32;              |HAZ Conver17;    #553#61 = eaAlfa;

     #553#62 = "0";

     |SI #1#31 = 0;  |Y #1#32 = 0; |Y #1#33 = 0;
         #553#62 = "1";
     |FINSI;

     enNume  = #1#31;              |HAZ Conver17;    #553#63 = eaAlfa;
     enNume  = #1#33;              |HAZ Conver17;    #553#69 = eaAlfa;

     |HAZ TDeclaracion;

     #553#74 = "0";
     #553#75 = "";

     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #553#78 = eaAlfa;

     eaAlfa  = #caemi303#5;     |HAZ FechaBonito;

     #553#79 = eaDiaB;
     #553#80 = eaMesB;
     #553#81 = eaAnyoB;
     #553#83 = &13 + &10;

     nTCampo = 83;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #553nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     nSwHay = 1;
|FPRC;

|PROCESO imprimir_2013;
     |SI #1#4 ! #caemi303#7; |ACABA; |FINSI;

     eaFicheroPlano = "303" + (("00000" + #2#0) % -105) + ".txt";
     eaFicheroImpre = "303" + (("00000" + #2#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #2#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Carga303_2013;
     |XCIERRA nHandle2;

     #1#3 = #caemi303#5;
     #1#4 = "S";
     |GRABA 020#1a;
     |LIBERA #1;

     se_ejerc  = #2#1;
     se_modelo = "303";
     se_impor  = #1#33 - #1#31 - #1#32;
     se_fecha  = #1#3;
     |SI SwAgicli = 1;
         |HAZ AlAgicl2;
     |FINSI;

     enEmpresa    = #2#0;
     eaNomEmpresa = #2#2;

     |HAZ PresentaModelo;
|FPRC;

|DEFBUCLE mira_303_2013;
     #1#2;
     ;
     #caemi303#0 , #caemi303#3 , nAnyo2D , imsn1;
     #caemi303#0 , #caemi303#3 , nAnyo2D , imsn2;
     be;
     NULL , imprimir_2013;
|FIN;

|PROCESO Bloque2013;
     |HAZ LeeUnidad;
     eaModelos  = "303";
     eaPeriodo  = ("00" + enPer) % -102;

    perialf = eaPeriodo;
    |SI #caemi303#0 = "T";
        |SI #caemi303#3 = 1;  perialf = "1T"; |FINSI;
        |SI #caemi303#3 = 2;  perialf = "2T"; |FINSI;
        |SI #caemi303#3 = 3;  perialf = "3T"; |FINSI;
        |SI #caemi303#3 = 4;  perialf = "4T"; |FINSI;
    |FINSI;


     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     eaPathModelo = eaUnidad + "\MODELOS";
     eaPathModelo = eaPathModelo + "\" + eaModelos;
     eaPathModelo = eaPathModelo + "\" + eaEjer;
     eaPathModelo = eaPathModelo + "\" + perialf;
     eaPathModelo = eaPathModelo + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ BotonesMPFPortal;
     nTecla = enTecla;
     |SI nTecla = 0;  |ACABA;  |FINSI;

     |ABRE #553;

     imsn1 = #caemi303#7;  imsn2 = #caemi303#7;
     nSwHay = 0;
     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = nAnyo2D;
     |LEE 001#2=;
     |SI FSalida = 0;
         |HAZ AlAgicl1; || lee Modulo Integrador ....
         |HAZ fecha;
         |BUCLE mira_303_2013;
     |SINO;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
     |FINSI;
     |CIERRA #2;

     |CIERRA #553;
     |DELINDEX #553;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3"; |Y nSwHay ! 0;
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO impre; |TIPO 3;
     |HAZ LeeUnidadBasico;

     aAlfa     = #caemi303#1 % -102;
     nAnyo2D   = aAlfa;
     enAnyo    = #caemi303#1;
     eaTipoSec = "303";
     aTipoSec  = "303";
     enPer     = #caemi303#3;
     eaEjer    = #caemi303#1;

     aFichero  = ("iv" + Usuario) % 108;
     |NOME_DAT #553 aFichero;
     |ABRE #553;  |CIERRA #553;  |DELINDEX #553;

     |SI #caemi303#1 [ 2012; |O #caemi303#6 = "B";
         |HAZ Bloque2012;
         |ACABA;
     |FINSI;

     #caemi303#6 = "L";
     |SI #caemi303#1 = 2013;
         |HAZ Bloque2013;
         |ACABA;
     |FINSI;

     eaCampo0  = #caemi303#0;
     eaCampo1  = #caemi303#1;
     eaCampo3  = #caemi303#3;
     eaCampo5  = #caemi303#5;
     eaCampo6  = #caemi303#6;
     eaCampo7  = #caemi303#7;
     eaCampo8  = #caemi303#8;
     enEmpresa = #canempre#2;

     |SUB_EJECUTA "dsmoy303";
|FPRC;
