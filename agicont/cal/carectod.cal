|FICHEROS;
   carectod #0;

   camaasic #1;
   camaasil #2;

   caivarep #3;
   caivasop #4;

   caconcep #5;
   caivaasi #6;
   camandia #7;
   cacuenta #8;

   agif134@ #19;
   agif024@ #21;
   agif001@ #22;
   agif025@ #23;
   agif008@ #24;
   agif059@ #25;
   agif010@ #26;
   agif072@ #27;
   agif077@ #28;
   agif079@ #29;
   agif112@ #30;
   agif041@ #31;
|FIN;

|INCLUYE conasi_i;

|VARIABLES;
   Comodin = ""; Comodin1 = ""; Caracter = "";
   TotIva = 0; TotBase = 0; TotRec = 0; TotIvaRec = 0;
   HayAsiento = 0;
   aLong = ""; nLong = 0;

   Primera = 1;

   Serie1 = ""; Factu1 = 0;

   ivapo      = 0; ivava      = 0; ivaporte   = 0;
   acuporte   = 0; ivavario   = 0; acuvario   = 0;

   Cuenta = ""; Digito = 0; Signo = ""; Fecha = @; Mes = 0;
   CalcDebe = 0; CalcHaber = 0; CalcSaldo = 0;
   Calc = 0;
   Cont = 0; Contador = 0; Cont2 = 0;

   SignoAp = 0; nImporte = 0; Concepto = 0; ConcepAs = 0;
   TipoAcum = 0; NumAcum = 0; DescNFac = 0; DescFech = 0;
   CmpCuenta = 0;

   EmprOpen = 0; EnlacOpen = 0;

|FIN;

|PROCESO CreaSoport;
   |DDEFECTO #caivasop;
   #caivasop#0 = #agif001@#2;   || Libro
   #caivasop#1 = #agif001@#3;   || Descripcion libro
   #caivasop#2 = #agif079@#0;   || N§ Factura
   #caivasop#3 = #agif079@#1;   || Fecha factura
   #caivasop#4 = #agif112@#10;  || Cuenta Proveedor
   Comodin = #caivasop#4; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   |SI nLong = #48#14; #caivasop#5 = 1; |FINSI;
   |SI nLong = #48#15; #caivasop#5 = 2; |FINSI;
   |SI nLong = #48#16; #caivasop#5 = 3; |FINSI;
   |SI nLong = #48#17; #caivasop#5 = 4; |FINSI;
   |SI nLong = #48#18; #caivasop#5 = 5; |FINSI;
   |SI nLong = #48#19; #caivasop#5 = 6; |FINSI;
   #caivasop#6 = #agif001@#119;

   #caconcep#0 = #caivasop#6;
   |LEE 010#caconcep.=;
   |SI FSalida = 0;
      #caivasop#7 = #caconcep#1; || Descripcion concepto
   |FINSI;

   #caivasop#8  = #agif079@#21;     || Base 1
   #caivasop#9  = #agif079@#24;     || Base 2
   #caivasop#10 = #agif079@#27;     || Base 3
   #caivasop#52 = #agif079@#49;     || Base 4
   #caivasop#53 = #agif079@#52;     || Base 5

   #caivasop#11 = #agif079@#56;     || Tipo Iva 1
   #caivasop#12 = #agif079@#58;     || Tipo Iva 2
   #caivasop#13 = #agif079@#60;     || Tipo Iva 3
   #caivasop#54 = #agif079@#62;     || Tipo Iva 4
   #caivasop#55 = #agif079@#64;     || Tipo Iva 5

   #caivasop#14 = #agif079@#22;     || Cuota Iva 1
   #caivasop#15 = #agif079@#25;     || Cuota Iva 2
   #caivasop#16 = #agif079@#28;     || Cuota Iva 3
   #caivasop#56 = #agif079@#50;     || Cuota Iva 4
   #caivasop#57 = #agif079@#53;     || Cuota Iva 5

   #caivasop#17 = #agif079@#57;     || Tipo Rec 1
   #caivasop#18 = #agif079@#59;     || Tipo Rec 2
   #caivasop#19 = #agif079@#61;     || Tipo Rec 3
   #caivasop#58 = #agif079@#63;     || Tipo Rec 4
   #caivasop#59 = #agif079@#65;     || Tipo Rec 5

   #caivasop#20 = #agif079@#23;     || Cuota Rec 1
   #caivasop#21 = #agif079@#26;     || Cuota Rec 2
   #caivasop#22 = #agif079@#55;     || Cuota Rec 3
   #caivasop#60 = #agif079@#51;     || Cuota Rec 4
   #caivasop#61 = #agif079@#54;     || Cuota Rec 5

   #caivasop#23 = #agif001@#122; || Deducible
   #caivasop#24 = ;              || Exportado S/N
   #caivasop#26 = #agif079@#31;  || Total Factura
   #caivasop#27 = #agif079@#66;  || Serie
   #caivasop#28 = ;              || Liquidada
   Comodin = #caivasop#3; |QBF Comodin;
   Comodin = Comodin % 0402;
   |SI #caivaasi#46 = "M";
      #caivasop#44 = Comodin;    || Periodo
   |SINO;
      |SI Comodin ] "01"; |Y Comodin [ "03"; #caivasop#44 = 1; |FINSI;
      |SI Comodin ] "04"; |Y Comodin [ "06"; #caivasop#44 = 2; |FINSI;
      |SI Comodin ] "07"; |Y Comodin [ "09"; #caivasop#44 = 3; |FINSI;
      |SI Comodin ] "10"; |Y Comodin [ "12"; #caivasop#44 = 4; |FINSI;
   |FINSI;
   #caivasop#48 = #agif001@#121; || Inversiones
   #caivasop#49 = #agif001@#123; || Departamento
   #caivasop#50 = #agif079@#3;   || Nombre Proveedor
   #caivasop#51 = #agif112@#9;   || Cif proveedor

   |SI #caivasop#8 = 0; |Y #caivasop#9  = 0; |Y #caivasop#10 = 0;
   |Y #caivasop#52 = 0; |Y #caivasop#53 = 0;
   |Y #caivasop#14 = 0; |Y #caivasop#15 = 0; |Y #caivasop#16 = 0;
   |Y #caivasop#56 = 0; |Y #caivasop#57 = 0;
   |Y #caivasop#20 = 0; |Y #caivasop#21 = 0; |Y #caivasop#22 = 0;
   |Y #caivasop#60 = 0; |Y #caivasop#61 = 0; |Y #caivasop#26 ! 0;
      #caivasop#8 = #caivasop#26;
   |FINSI;

   |GRABA 020#caivasop.n;
   |LEE 010#caivasop.=;
|FPRC;

|PROCESO CreaReperc;
   |DDEFECTO #caivarep;
   #caivarep#0  = #agif001@#2;   || Libro
   #caivarep#1  = #agif001@#3;   || Descripcion libro
   #caivarep#2  = #agif134@#0;   || N§ Factura
   #caivarep#3  = #agif134@#1;   || Fecha factura
   #caivarep#4  = #agif024@#16;  || Cuenta cliente
   Comodin = #caivarep#4; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   |SI nLong = #48#14; #caivarep#5 = 1; |FINSI;
   |SI nLong = #48#15; #caivarep#5 = 2; |FINSI;
   |SI nLong = #48#16; #caivarep#5 = 3; |FINSI;
   |SI nLong = #48#17; #caivarep#5 = 4; |FINSI;
   |SI nLong = #48#18; #caivarep#5 = 5; |FINSI;
   |SI nLong = #48#19; #caivarep#5 = 6; |FINSI;
   #caivarep#6  = #agif001@#119; || Concepto

   #caconcep#0 = #caivarep#6;
   |LEE 010#caconcep.=;
   |SI FSalida = 0;
      #caivarep#7 = #caconcep#1; || Descripcion concepto
   |FINSI;

   #caivarep#8  = #agif134@#21;  || Base 1
   #caivarep#9  = #agif134@#24;  || Base 2
   #caivarep#10 = #agif134@#27;  || Base 3
   #caivarep#52 = #agif134@#33;  || Base 4
   #caivarep#53 = #agif134@#36;  || Base 5
   |SI #caivarep#8  ! 0; #caivarep#11 = #agif134@#39; |FINSI; || Tipo Iva 1
   |SI #caivarep#9  ! 0; #caivarep#12 = #agif134@#41; |FINSI; || Tipo Iva 2
   |SI #caivarep#10 ! 0; #caivarep#13 = #agif134@#43; |FINSI; || Tipo Iva 3
   |SI #caivarep#52 ! 0; #caivarep#54 = #agif134@#50; |FINSI; || Tipo Iva 4
   |SI #caivarep#53 ! 0; #caivarep#55 = #agif134@#52; |FINSI; || Tipo Iva 5
   #caivarep#14 = #agif134@#22;  || Cuota Iva 1
   #caivarep#15 = #agif134@#25;  || Cuota Iva 2
   #caivarep#16 = #agif134@#28;  || Cuota Iva 3
   #caivarep#56 = #agif134@#34;  || Cuota Iva 4
   #caivarep#57 = #agif134@#37;  || Cuota Iva 5
   |SI #caivarep#8  ! 0; #caivarep#17 = #agif134@#40; |FINSI; || Tipo Rec 1
   |SI #caivarep#9  ! 0; #caivarep#18 = #agif134@#42; |FINSI; || Tipo Rec 2
   |SI #caivarep#10 ! 0; #caivarep#19 = #agif134@#44; |FINSI; || Tipo Rec 3
   |SI #caivarep#52 ! 0; #caivarep#58 = #agif134@#51; |FINSI; || Tipo Rec 4
   |SI #caivarep#53 ! 0; #caivarep#59 = #agif134@#53; |FINSI; || Tipo Rec 5
   #caivarep#20 = #agif134@#23;  || Cuota Rec 1
   #caivarep#21 = #agif134@#26;  || Cuota Rec 2
   #caivarep#22 = #agif134@#54;  || Cuota Rec 3
   #caivarep#60 = #agif134@#35;  || Cuota Rec 4
   #caivarep#61 = #agif134@#38;  || Cuota Rec 5
   #caivarep#23 = #agif001@#122; || Deducible
   #caivarep#24 = ;              || Exportado S/N
   #caivarep#26 = #agif134@#31;  || Total Factura
   #caivarep#27 = #agif134@#49;  || Serie
   #caivarep#28 = ;              || Liquidada
   Comodin = #caivarep#3; |QBF Comodin;
   Comodin = Comodin % 0402;
   |SI #caivaasi#46 = "M";
      #caivarep#44 = Comodin;    || Periodo
   |SINO;
      |SI Comodin ] "01"; |Y Comodin [ "03"; #caivarep#44 = 1; |FINSI;
      |SI Comodin ] "04"; |Y Comodin [ "06"; #caivarep#44 = 2; |FINSI;
      |SI Comodin ] "07"; |Y Comodin [ "09"; #caivarep#44 = 3; |FINSI;
      |SI Comodin ] "10"; |Y Comodin [ "12"; #caivarep#44 = 4; |FINSI;
   |FINSI;
   #caivarep#48 = #agif001@#121; || Inversiones
   |SI #agif001@#174 = "S";
      #caivarep#49 = #agif134@#7;   || Representante
   |SINO;
      #caivarep#49 = #agif001@#123; || Departamento
   |FINSI;
   #caivarep#50 = #agif134@#3;   || Nombre Cliente
   #caivarep#51 = #agif024@#15;  || Cif Cliente
   #caivarep#62 = 1;             || N§ de facturas

   |SI #caivarep#8 = 0; |Y #caivarep#9  = 0; |Y #caivarep#10 = 0;
   |Y #caivarep#52 = 0; |Y #caivarep#53 = 0;
   |Y #caivarep#14 = 0; |Y #caivarep#15 = 0; |Y #caivarep#16 = 0;
   |Y #caivarep#56 = 0; |Y #caivarep#57 = 0;
   |Y #caivarep#20 = 0; |Y #caivarep#21 = 0; |Y #caivarep#22 = 0;
   |Y #caivarep#60 = 0; |Y #caivarep#61 = 0; |Y #caivarep#26 ! 0;
      #caivarep#8 = #caivarep#26;
   |FINSI;

   |GRABA 020#caivarep.n;
   |LEE 010#caivarep.=;
|FPRC;

|PROCESO CalcPortesVn;
   |ABRE #agif059@;
   |ABRE #agif010@;
   #agif059@#14 = #agif134@#49;
   #agif059@#0 = #agif134@#0;
   #agif059@#1 = 0;
   |LEE 001#agif059@.];
   |PARA FSalida = FSalida;|SI 0 = FSalida;|Y #agif134@#0 = #agif059@#0;|Y #agif134@#49 = #agif059@#14;
    |HACIENDO FSalida = FSalida;
      |DDEFECTO #agif010@;
      #agif010@#52 = #agif059@#15;
      #agif010@#0  = #agif059@#2; ||numero albaran factura;
      |LEE 001#agif010@.=;||Lee albaran de linea factura;
      |SI FSalida = 0;
         |SI #agif010@#12 = 0; ivapo = 0; |FINSI;
         |SI #agif010@#12 = 1; ivapo = #agif010@#11 % #agif134@#39; |FINSI;
         |SI #agif010@#12 = 2; ivapo = #agif010@#11 % #agif134@#41; |FINSI;
         |SI #agif010@#12 = 3; ivapo = #agif010@#11 % #agif134@#43; |FINSI;
         |SI #agif010@#12 = 4; ivapo = #agif010@#11 % #agif134@#50; |FINSI;
         |SI #agif010@#12 = 5; ivapo = #agif010@#11 % #agif134@#52; |FINSI;
         |SI #agif010@#43 = "S";
            ivapo = -ivapo;
            #agif010@#11 = - #agif010@#11;
         |FINSI;
         ivaporte = ivaporte + ivapo;
         acuporte = acuporte + #agif010@#11;
         |SI #agif010@#14 = 0; ivava = 0; |FINSI;
         |SI #agif010@#14 = 1; ivava = #agif010@#13 % #agif134@#39; |FINSI;
         |SI #agif010@#14 = 2; ivava = #agif010@#13 % #agif134@#41; |FINSI;
         |SI #agif010@#14 = 3; ivava = #agif010@#13 % #agif134@#43; |FINSI;
         |SI #agif010@#14 = 4; ivava = #agif010@#13 % #agif134@#50; |FINSI;
         |SI #agif010@#14 = 5; ivava = #agif010@#13 % #agif134@#52; |FINSI;
         |SI #agif010@#43 = "S";
            ivava = -ivava;
            #agif010@#13 = -#agif010@#13;
         |FINSI;
         ivavario = ivavario + ivava;
         acuvario = acuvario + #agif010@#13;
      |FINSI;
      |LEE 001#agif059@.>;||Lee otra linea de factura;
   |SIGUE;
   |CIERRA #agif059@;
   |CIERRA #agif010@;
|FPRC;

|PROCESO CalcPortesCm;
   |ABRE #agif072@;
   |ABRE #agif077@;
   #agif072@#16 = #agif079@#66;
   #agif072@#0 = #agif079@#0;
   #agif072@#1 = 0;
   |LEE 001#agif072@.];
   |PARA FSalida = FSalida;|SI 0 = FSalida;|Y #agif079@#0 = #agif072@#0;|Y #agif079@#66 = #agif072@#16;
    |HACIENDO FSalida = FSalida;
      |DDEFECTO #agif077@;
      #agif077@#50 = #agif072@#17;
      #agif077@#0  = #agif072@#2; ||numero albaran factura;
      |LEE 001#agif072@.=;||Lee albaran de linea factura;
      |SI FSalida = 0;
         |SI #agif077@#12 = 0; ivapo = 0; |FINSI;
         |SI #agif077@#12 = 1; ivapo = #agif077@#11 % #agif079@#56; |FINSI;
         |SI #agif077@#12 = 2; ivapo = #agif077@#11 % #agif079@#58; |FINSI;
         |SI #agif077@#12 = 3; ivapo = #agif077@#11 % #agif079@#60; |FINSI;
         |SI #agif077@#12 = 4; ivapo = #agif077@#11 % #agif079@#62; |FINSI;
         |SI #agif077@#12 = 5; ivapo = #agif077@#11 % #agif079@#64; |FINSI;
         |SI #agif077@#42 = "S";
            ivapo = -ivapo;
            #agif077@#11 = - #agif077@#11;
         |FINSI;
         ivaporte = ivaporte + ivapo;
         acuporte = acuporte + #agif077@#11;
         |SI #agif077@#14 = 0; ivava = 0; |FINSI;
         |SI #agif077@#14 = 1; ivava = #agif077@#13 % #agif079@#56; |FINSI;
         |SI #agif077@#14 = 2; ivava = #agif077@#13 % #agif079@#58; |FINSI;
         |SI #agif077@#14 = 3; ivava = #agif077@#13 % #agif079@#60; |FINSI;
         |SI #agif077@#14 = 4; ivava = #agif077@#13 % #agif079@#62; |FINSI;
         |SI #agif077@#14 = 5; ivava = #agif077@#13 % #agif079@#64; |FINSI;
         |SI #agif077@#42 = "S";
            ivava = -ivava;
            #agif010@#13 = -#agif010@#13;
         |FINSI;
         ivavario = ivavario + ivava;
         acuvario = acuvario + #agif077@#13;
      |FINSI;
      |LEE 001#agif072@.>;||Lee otra linea de factura;
   |SIGUE;
   |CIERRA #agif072@;
   |CIERRA #agif077@;
|FPRC;

|PROCESO ActDiario;
   #camandia#0 = #camaasil#0;
   |LEE 010#camandia.=;
   |SI FSalida = 0;
      |SI #camaasil#8 = "D";
         #camandia#2 = #camandia#2 + #camaasil#9;
      |SINO;
         #camandia#3 = #camandia#3 + #camaasil#9;
      |FINSI;
      |GRABA 020#camandia.a;
   |FINSI;
|FPRC;

|PROCESO ActCabAsiento;
   |SI #camaasil#8 = "D";
      #camaasic#4 = #camaasic#4 + #camaasil#9;
   |SINO;
      #camaasic#5 = #camaasic#5 + #camaasil#9;
   |FINSI;
   #camaasic#6 = #camaasic#4 - #camaasic#5;
   |GRABA 020#camaasic.a;
|FPRC;

|PROCESO ActCuenta;
   #cacuenta#0 = Cuenta; #cacuenta#1 = Digito;
   |LEE 010#cacuenta.=;
   |SI FSalida = 0;
      |SI #cacuenta#58 < Fecha; #cacuenta#58 = Fecha; |FINSI;
      Comodin = Fecha; |QBF Comodin;
      Comodin = Comodin % 0402;
      Mes = Comodin;
      CalcDebe = 9 + (Mes * 3); CalcHaber = CalcDebe + 1; CalcSaldo = CalcDebe + 2;
      |SI Signo = "D";
         #cacuenta#CalcDebe# = #cacuenta#CalcDebe# + nImporte;
      |SINO;
         #cacuenta#CalcHaber# = #cacuenta#CalcHaber# + nImporte;
      |FINSI;
      #cacuenta#CalcSaldo# = #cacuenta#CalcDebe# - #cacuenta#CalcHaber#;

      #cacuenta#51 = 0; #cacuenta#52 = 0; #cacuenta#53 = 0;
      |PARA Contador = 9; |SI Contador [ 48; |HACIENDO Contador = Contador + 3;
         #cacuenta#51 = #cacuenta#51 + #cacuenta#Contador#; Contador = Contador + 1;
         #cacuenta#52 = #cacuenta#52 + #cacuenta#Contador#; Contador = Contador + 1;
         #cacuenta#53 = #cacuenta#53 + #cacuenta#Contador#; Contador = Contador - 2;
      |SIGUE;

      |GRABA 020#cacuenta.a;
   |FINSI;
|FPRC;

|PROCESO ActGrupos;
   |PARA Cont2 = 14; |SI Cont2 [ 19; |HACIENDO Cont2 = Cont2 + 1;
      Cuenta = #camaasil#4; |QBF Cuenta;
      Calc   = #48#Cont2#; Calc = Calc + 100;
      Cuenta = Cuenta % Calc;  Digito = Cont2;
      Fecha = #camaasil#1; Signo = #camaasil#8; nImporte = #camaasil#9;
      |SI #48#Cont2# ! 0; |HAZ ActCuenta; |FINSI;
   |SIGUE;
|FPRC;

|PROCESO Actualiza;
   |HAZ ActCabAsiento;
   |HAZ ActDiario;
   Cuenta = #camaasil#4; Digito = #camaasil#5; Fecha = #camaasil#1;
   Signo = #camaasil#8;  nImporte = #camaasil#9;
   |HAZ ActCuenta;
   |HAZ ActGrupos;
|FPRC;

|PROCESO CreaAstoCm;
   |DDEFECTO #camaasic;

   enDiario = #carectod#9; |HAZ contador;

   #camaasic#0 = #carectod#9;
   |SI #carectod#13 = "C";
      #camaasic#1 = #carectod#14;
   |SINO;
      #camaasic#1 = #agif079@#1;
   |FINSI;
   #camaasic#2  = enContador;
   #camaasic#3  = enContador;
   #camaasic#4  = 0; #camaasic#5 = 0; #camaasic#6 = 0;
   #camaasic#7  = 0;
   #camaasic#8  = ""; #camaasic#9  = 0;
   #camaasic#10 = ""; #camaasic#11 = 0;
   |GRABA 020#camaasic.n;
   |LEE 010#camaasic.=;

   |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      Concepto = Cont + 4;   Cuenta   = Cont + 12;
      SignoAp  = Cont + 28;  ConcepAs = Cont + 36;
      TipoAcum = Cont + 123; NumAcum  = Cont + 131;
      DescNFac = Cont + 44;  DescFech = Cont + 52;

      |DDEFECTO #camaasil;
      #camaasil#0 = #camaasic#0;
      #camaasil#1 = #camaasic#1;
      #camaasil#2 = #camaasic#2;
      #camaasil#3 = ((Cont - 1) * 10);

      Comodin = #agif001@#CmpCuenta#; |QBF Comodin;
      |SI Comodin = "CLI"; #camaasil#4 = #agif112@#10; |FINSI;
      |SI Comodin = "REP"; #camaasil#4 = #agif025@#56; |FINSI;
      |SI Comodin = "SER"; #camaasil#4 = #agif008@#5;  |FINSI;

      Comodin = #camaasil#4; |QBF Comodin;
      aLong = Comodin % 0; nLong = aLong;
      |SI nLong = #48#14; #camaasil#5 = 1; |FINSI;
      |SI nLong = #48#15; #camaasil#5 = 2; |FINSI;
      |SI nLong = #48#16; #camaasil#5 = 3; |FINSI;
      |SI nLong = #48#17; #camaasil#5 = 4; |FINSI;
      |SI nLong = #48#18; #camaasil#5 = 5; |FINSI;
      |SI nLong = #48#19; #camaasil#5 = 6; |FINSI;

      #camaasil#6 = #agif001@#ConcepAs#;
      #caconcep#0 = #camaasil#6;
      |LEE 010#caconcep.=;
      |SI FSalida = 0;
         #camaasil#7 = #caconcep#1;
      |FINSI;
      Comodin = #camaasil#7; |QBF Comodin;
      |SI #agif001@#DescNFac# = "S";
         Comodin1 = #agif079@#66; |QBF Comodin1;
         Comodin1 = ("  " + Comodin1) % -102;
         Comodin = Comodin + " " + Comodin1;
         Comodin1 = #agif079@#0; |QBF Comodin1;
         Comodin1 = ("000000" + Comodin1) % -106;
         Comodin = Comodin + " " + Comodin1;
      |FINSI;
      #camaasil#8 = #agif001@#SignoAp#;

      |SI #agif001@#Concepto# = 12; |O #agif001@#Concepto# = 13;
         |HAZ CalcPortesCm;
      |FINSI;
      |SI #agif001@#Concepto# ] 27; |Y #agif001@#Concepto# [ 36;
         |HAZ CalcPortesCm;
      |FINSI;

      |SI #agif001@#Concepto# = 3;  #camaasil#9 = #agif079@#17; |FINSI;
      |SI #agif001@#Concepto# = 4;  #camaasil#9 = #agif079@#18; |FINSI;
      |SI #agif001@#Concepto# = 5;
         #camaasil#9 = #agif079@#21 + #agif079@#24 + #agif079@#27;
         #camaasil#9 = #camaasil#9  + #agif079@#49 + #agif079@#52;
         #camaasil#9 = #camaasil#9  + #agif079@#47;
      |FINSI;
      |SI #agif001@#Concepto# = 6;  #camaasil#9 = #agif079@#30; |FINSI;
      |SI #agif001@#Concepto# = 7;  #camaasil#9 = #agif079@#29; |FINSI;
      |SI #agif001@#Concepto# = 8;  #camaasil#9 = #agif079@#19; |FINSI;
      |SI #agif001@#Concepto# = 9;  #camaasil#9 = #agif079@#20; |FINSI;
      |SI #agif001@#Concepto# = 10; #camaasil#9 = #agif079@#31; |FINSI;
      |SI #agif001@#Concepto# = 12; #camaasil#9 = acuporte;     |FINSI;
      |SI #agif001@#Concepto# = 13; #camaasil#9 = acuvario;     |FINSI;
      |SI #agif001@#Concepto# = 14; #camaasil#9 = #agif079@#22; |FINSI;
      |SI #agif001@#Concepto# = 15; #camaasil#9 = #agif079@#23; |FINSI;
      |SI #agif001@#Concepto# = 16; #camaasil#9 = #agif079@#25; |FINSI;
      |SI #agif001@#Concepto# = 17; #camaasil#9 = #agif079@#26; |FINSI;
      |SI #agif001@#Concepto# = 18; #camaasil#9 = #agif079@#28; |FINSI;
      |SI #agif001@#Concepto# = 21; #camaasil#9 = #agif079@#55; |FINSI;
      |SI #agif001@#Concepto# = 22; #camaasil#9 = #agif079@#50; |FINSI;
      |SI #agif001@#Concepto# = 23; #camaasil#9 = #agif079@#51; |FINSI;
      |SI #agif001@#Concepto# = 24; #camaasil#9 = #agif079@#53; |FINSI;
      |SI #agif001@#Concepto# = 25; #camaasil#9 = #agif079@#54; |FINSI;
      |SI #agif001@#Concepto# = 26; #camaasil#9 = #agif079@#67; |FINSI;
      |SI #agif001@#Concepto# = 27;
         #camaasil#9 = #agif079@#21 + #agif079@#24 + #agif079@#27;
         #camaasil#9 = #camaasil#9  + #agif079@#49 + #agif079@#52;
         #camaasil#9 = #camaasil#9  + #agif079@#47 - acuporte;
      |FINSI;
      |SI #agif001@#Concepto# = 28;
         #camaasil#9 = #agif079@#21 + #agif079@#24 + #agif079@#27;
         #camaasil#9 = #camaasil#9  + #agif079@#49 + #agif079@#52;
         #camaasil#9 = #camaasil#9  + #agif079@#47 - acuvario;
      |FINSI;
      |SI #agif001@#Concepto# = 29; #camaasil#9 = #agif079@#29 - ivaporte; |FINSI;
      |SI #agif001@#Concepto# = 30; #camaasil#9 = #agif079@#29 - ivavario; |FINSI;
      |SI #agif001@#Concepto# = 31; #camaasil#9 = acuporte;     |FINSI;
      |SI #agif001@#Concepto# = 32; #camaasil#9 = acuvario;     |FINSI;
      |SI #agif001@#Concepto# = 33; #camaasil#9 = ivaporte;     |FINSI;
      |SI #agif001@#Concepto# = 34; #camaasil#9 = ivavario;     |FINSI;
      |SI #agif001@#Concepto# = 35;
         #camaasil#9 = #agif079@#21 + #agif079@#24 + #agif079@#27;
         #camaasil#9 = #camaasil#9  + #agif079@#49 + #agif079@#52;
         #camaasil#9 = #camaasil#9  + #agif079@#47 - (acuporte + acuvario);
      |FINSI;
      |SI #agif001@#Concepto# = 36; #camaasil#9 = #agif079@#29 - (ivaporte + ivavario); |FINSI;
      |SI #agif001@#Concepto# = 37; #camaasil#9 = #agif079@#21; |FINSI;
      |SI #agif001@#Concepto# = 38; #camaasil#9 = #agif079@#24; |FINSI;
      |SI #agif001@#Concepto# = 39; #camaasil#9 = #agif079@#27; |FINSI;
      |SI #agif001@#Concepto# = 40; #camaasil#9 = #agif079@#49; |FINSI;
      |SI #agif001@#Concepto# = 41; #camaasil#9 = #agif079@#52; |FINSI;

      |SI #camaasil#8 = "D";
         #camaasil#10 = "";          #camaasil#11 = 0;
         #camaasil#16 = #camaasil#4; #camaasil#17 = #camaasil#5;
      |SINO;
         #camaasil#16 = "";          #camaasil#17 = 0;
         #camaasil#10 = #camaasil#4; #camaasil#11 = #camaasil#5;
      |FINSI;

      #camaasil#12 = "S";
      #camaasil#13 = #agif001@#2;
      #camaasil#14 = #agif079@#0;
      #camaasil#15 = #agif079@#66;
      #camaasil#19 = #agif001@#TipoAcum#;
      #camaasil#20 = #agif001@#NumAcum#;
      #camaasil#21 = #agif001@#123;

      |HAZ Actualiza;
   |SIGUE;

|FPRC;

|PROCESO FactCompra;
   #agif112@#0 = #agif079@#2;
   |LEE 010#agif112@.=;
   |SI FSalida ! 0; |DDEFECTO #agif112@; |FINSI;

   |SI #agif079@#48 = "S";   || Si la factura esta contabilizada
      #caivasop#27 = #agif079@#66;
      #caivasop#0  = #carectod#9;
      #caivasop#2  = #agif079@#0;
      |LEE 010#caivasop.=;   || Miro si el registro de IVA de contabilidad ...
      |SI FSalida ! 0;       || ... coincide con dicha factura
         |HAZ CreaSoport;             || Hay que crear el IVA
      |FINSI;

      |SELECT #4#camaasil;
      #camaasil#13 = #agif001@#2;
      #camaasil#15 = #caivasop#27;
      #camaasil#14 = #caivasop#2;
      |LEE 010#camaasil.=;
      |SI FSalida ! 0;
         |HAZ CreaAstoCm;          || Hay que crear el asiento
      |SINO;
         #caivasop#45 = #camaasil#0;
         #caivasop#46 = #camaasil#1;
         #caivasop#47 = #camaasil#2;
         |GRABA 020#caivasop.a;
      |FINSI;
      |SELECT #1#camaasil;
   |FINSI;
|FPRC;

|DEFBUCLE FactCompra;
#agif079@#1002;
2;
#carectod#0,#carectod#1,#carectod#15;
#carectod#3,#carectod#4,#carectod#16;
;
NULL,FactCompra;
|FIN;

|PROCESO CreaAstoVn;
   |DDEFECTO #camaasic;

   enDiario = #carectod#9; |HAZ contador;

   #camaasic#0 = #carectod#9;
   |SI #carectod#13 = "C";
      #camaasic#1 = #carectod#14;
   |SINO;
      #camaasic#1 = #agif134@#1;
   |FINSI;
   #camaasic#2  = enContador;
   #camaasic#3  = enContador;
   #camaasic#4  = 0; #camaasic#5 = 0; #camaasic#6 = 0;
   #camaasic#7  = 0;
   #camaasic#8  = ""; #camaasic#9  = 0;
   #camaasic#10 = ""; #camaasic#11 = 0;
   |GRABA 020#camaasic.n;
   |LEE 010#camaasic.=;

   |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      Concepto = Cont + 4;   Cuenta   = Cont + 12;
      SignoAp  = Cont + 28;  ConcepAs = Cont + 36;
      TipoAcum = Cont + 123; NumAcum  = Cont + 131;
      DescNFac = Cont + 44;  DescFech = Cont + 52;

      |DDEFECTO #camaasil;
      #camaasil#0 = #camaasic#0;
      #camaasil#1 = #camaasic#1;
      #camaasil#2 = #camaasic#2;
      #camaasil#3 = ((Cont - 1) * 10);

      Comodin = #agif001@#CmpCuenta#; |QBF Comodin;
      |SI Comodin = "CLI"; #camaasil#4 = #agif024@#15; |FINSI;
      |SI Comodin = "REP"; #camaasil#4 = #agif025@#56; |FINSI;
      |SI Comodin = "SER"; #camaasil#4 = #agif008@#5;  |FINSI;

      Comodin = #camaasil#4; |QBF Comodin;
      aLong = Comodin % 0; nLong = aLong;
      |SI nLong = #48#14; #camaasil#5 = 1; |FINSI;
      |SI nLong = #48#15; #camaasil#5 = 2; |FINSI;
      |SI nLong = #48#16; #camaasil#5 = 3; |FINSI;
      |SI nLong = #48#17; #camaasil#5 = 4; |FINSI;
      |SI nLong = #48#18; #camaasil#5 = 5; |FINSI;
      |SI nLong = #48#19; #camaasil#5 = 6; |FINSI;

      #camaasil#6 = #agif001@#ConcepAs#;
      #caconcep#0 = #camaasil#6;
      |LEE 010#caconcep.=;
      |SI FSalida = 0;
         #camaasil#7 = #caconcep#1;
      |FINSI;
      Comodin = #camaasil#7; |QBF Comodin;
      |SI #agif001@#DescNFac# = "S";
         Comodin1 = #agif134@#49; |QBF Comodin1;
         Comodin1 = ("  " + Comodin1) % -102;
         Comodin = Comodin + " " + Comodin1;
         Comodin1 = #agif134@#0; |QBF Comodin1;
         Comodin1 = ("000000" + Comodin1) % -106;
         Comodin = Comodin + " " + Comodin1;
      |FINSI;
      #camaasil#8 = #agif001@#SignoAp#;

      |SI #agif001@#Concepto# = 12; |O #agif001@#Concepto# = 13;
         |HAZ CalcPortesVn;
      |FINSI;
      |SI #agif001@#Concepto# ] 27; |Y #agif001@#Concepto# [ 36;
         |HAZ CalcPortesVn;
      |FINSI;

      |SI #agif001@#Concepto# = 3;  #camaasil#9 = #agif134@#17; |FINSI;
      |SI #agif001@#Concepto# = 4;  #camaasil#9 = #agif134@#18; |FINSI;
      |SI #agif001@#Concepto# = 5;
         #camaasil#9 = #agif134@#21 + #agif134@#24 + #agif134@#27;
         #camaasil#9 = #camaasil#9  + #agif134@#33 + #agif134@#36
         #camaasil#9 = #camaasil#9  + #agif134@#47;
      |FINSI;
      |SI #agif001@#Concepto# = 6;  #camaasil#9 = #agif134@#30; |FINSI;
      |SI #agif001@#Concepto# = 7;  #camaasil#9 = #agif134@#29; |FINSI;
      |SI #agif001@#Concepto# = 8;  #camaasil#9 = #agif134@#19; |FINSI;
      |SI #agif001@#Concepto# = 9;  #camaasil#9 = #agif134@#20; |FINSI;
      |SI #agif001@#Concepto# = 10; #camaasil#9 = #agif134@#31; |FINSI;
      |SI #agif001@#Concepto# = 11; #camaasil#9 = #agif134@#8;  |FINSI;
      |SI #agif001@#Concepto# = 12; #camaasil#9 = acuporte;     |FINSI;
      |SI #agif001@#Concepto# = 13; #camaasil#9 = acuvario;     |FINSI;
      |SI #agif001@#Concepto# = 14; #camaasil#9 = #agif134@#22; |FINSI;
      |SI #agif001@#Concepto# = 15; #camaasil#9 = #agif134@#23; |FINSI;
      |SI #agif001@#Concepto# = 16; #camaasil#9 = #agif134@#25; |FINSI;
      |SI #agif001@#Concepto# = 17; #camaasil#9 = #agif134@#26; |FINSI;
      |SI #agif001@#Concepto# = 18; #camaasil#9 = #agif134@#28; |FINSI;
      |SI #agif001@#Concepto# = 19; #camaasil#9 = #agif134@#30 + #agif134@#29; |FINSI;
      |SI #agif001@#Concepto# = 20; #camaasil#9 = #agif134@#47; |FINSI;
      |SI #agif001@#Concepto# = 21; #camaasil#9 = #agif134@#54; |FINSI;
      |SI #agif001@#Concepto# = 22; #camaasil#9 = #agif134@#34; |FINSI;
      |SI #agif001@#Concepto# = 23; #camaasil#9 = #agif134@#35; |FINSI;
      |SI #agif001@#Concepto# = 24; #camaasil#9 = #agif134@#37; |FINSI;
      |SI #agif001@#Concepto# = 25; #camaasil#9 = #agif134@#38; |FINSI;
      |SI #agif001@#Concepto# = 26; #camaasil#9 = #agif134@#55; |FINSI;
      |SI #agif001@#Concepto# = 27;
         #camaasil#9 = #agif134@#21 + #agif134@#24 + #agif134@#27;
         #camaasil#9 = #camaasil#9  + #agif134@#33 + #agif134@#36;
         #camaasil#9 = #camaasil#9  + #agif134@#47 - acuporte;
      |FINSI;
      |SI #agif001@#Concepto# = 28;
         #camaasil#9 = #agif134@#21 + #agif134@#24 + #agif134@#27;
         #camaasil#9 = #camaasil#9  + #agif134@#33 + #agif134@#36;
         #camaasil#9 = #camaasil#9  + #agif134@#47 - acuvario;
      |FINSI;
      |SI #agif001@#Concepto# = 29; #camaasil#9 = #agif134@#29 - ivaporte; |FINSI;
      |SI #agif001@#Concepto# = 30; #camaasil#9 = #agif134@#29 - ivavario; |FINSI;
      |SI #agif001@#Concepto# = 31; #camaasil#9 = acuporte;     |FINSI;
      |SI #agif001@#Concepto# = 32; #camaasil#9 = acuvario;     |FINSI;
      |SI #agif001@#Concepto# = 33; #camaasil#9 = ivaporte;     |FINSI;
      |SI #agif001@#Concepto# = 34; #camaasil#9 = ivavario;     |FINSI;
      |SI #agif001@#Concepto# = 35;
         #camaasil#9 = #agif134@#21 + #agif134@#24 + #agif134@#27;
         #camaasil#9 = #camaasil#9  + #agif134@#33 + #agif134@#36;
         #camaasil#9 = #camaasil#9  + #agif134@#47 - (acuporte + acuvario);
      |FINSI;
      |SI #agif001@#Concepto# = 36; #camaasil#9 = #agif134@#29 - (ivaporte + ivavario); |FINSI;
      |SI #agif001@#Concepto# = 37; #camaasil#9 = #agif134@#21; |FINSI;
      |SI #agif001@#Concepto# = 38; #camaasil#9 = #agif134@#24; |FINSI;
      |SI #agif001@#Concepto# = 39; #camaasil#9 = #agif134@#27; |FINSI;
      |SI #agif001@#Concepto# = 40; #camaasil#9 = #agif134@#33; |FINSI;
      |SI #agif001@#Concepto# = 41; #camaasil#9 = #agif134@#36; |FINSI;

      |SI #camaasil#8 = "D";
         #camaasil#10 = "";          #camaasil#11 = 0;
         #camaasil#16 = #camaasil#4; #camaasil#17 = #camaasil#5;
      |SINO;
         #camaasil#16 = "";          #camaasil#17 = 0;
         #camaasil#10 = #camaasil#4; #camaasil#11 = #camaasil#5;
      |FINSI;

      #camaasil#12 = "R";
      #camaasil#13 = #agif001@#2;
      #camaasil#14 = #agif134@#0;
      #camaasil#15 = #agif134@#49;
      #camaasil#19 = #agif001@#TipoAcum#;
      #camaasil#20 = #agif001@#NumAcum#;
      |SI #agif001@#174 = "S";
         #camaasil#21 = #agif134@#7;
      |SINO;
         #camaasil#21 = #agif001@#123;
      |FINSI;

      |HAZ Actualiza;
   |SIGUE;

|FPRC;

|PROCESO FactVenta;

   #agif024@#0 = #agif134@#2;
   |LEE 010#agif024@.=;
   |SI FSalida ! 0; |DDEFECTO #agif024@; |FINSI;

   #agif025@#0 = #agif134@#7;
   |LEE 010#agif025@.=;
   |SI FSalida ! 0; |DDEFECTO #agif025@; |FINSI;

   |SI #agif134@#48 = "S";   || Si la factura esta contabilizada
      #caivarep#27 = #agif134@#49;
      #caivarep#0  = #carectod#9;
      #caivarep#2  = #agif134@#0;
      |LEE 010#caivarep.=;   || Miro si el registro de IVA de contabilidad ...
      |SI FSalida ! 0;       || ... coincide con dicha factura
         |HAZ CreaReperc;             || Hay que crear el IVA
      |FINSI;

      |SELECT #4#camaasil;
      #camaasil#13 = #agif001@#2;
      #camaasil#15 = #caivarep#27;
      #camaasil#14 = #caivarep#2;
      |LEE 010#camaasil.=;
      |SI FSalida ! 0;
         |HAZ CreaAstoVn;          || Hay que crear el asiento
      |SINO;
         #caivarep#45 = #camaasil#0;
         #caivarep#46 = #camaasil#1;
         #caivarep#47 = #camaasil#2;
         |GRABA 020#caivarep.a;
      |FINSI;
      |SELECT #1#camaasil;
   |FINSI;
|FPRC;

|DEFBUCLE FactVenta;
#agif134@#1002;
2;
#carectod#0,#carectod#1,#carectod#2;
#carectod#3,#carectod#4,#carectod#5;
;
NULL,FactVenta;
|FIN;

|PROCESO AbrePath;
   Comodin  = #0#6; |QBF Comodin;
   Comodin = Comodin % -101;
   |SI Comodin ! "/";
      Comodin  = #0#6; |QBF Comodin;
      Comodin = Comodin + "/";
      #0#6 = Comodin; |PINTA #0#6;
   |FINSI;

   Comodin  = #0#6; |QBF Comodin;
   Comodin1 = Comodin + "def/agifa041.mas"; |CARGA_DEF Comodin1, agif041@;
   |SI FSalida ! 0;
      EmprOpen = 0;
      |MENAV "    Imposible encontrar aplicacion en el path indicado";
      |ERROR;
      |ACABA;
   |SINO;
      EmprOpen = 1;
      Comodin = #0#6; |QBF Comodin;
      Comodin1 = Comodin + "fich/";
      |PATH_DAT #31 Comodin1;
      |ABRE #agif041@;
   |FINSI;

|FPRC;

|PROCESO MiraEmpresa;
   #agif041@#0 = #carectod#7;
   |LEE 010#agif041@.=;
   |SI FSalida ! 0;
      EnlacOpen = 0;
      |MENAV "    No puedo encontrar empresa";
      |ERROR;
      |ACABA;
   |SINO;
      #carectod#8 = #agif041@#1; |PINTA #carectod#8;
      Comodin = #0#6; |QBF Comodin;
      Comodin1 = Comodin + "def/agifa001.mas"; |CARGA_DEF Comodin1, agif001@;
      |SI FSalida = 0;
         EnlacOpen = 1;
         Comodin1 = #0#7; |QBF Comodin1;
         Comodin1 = ("00" + Comodin1) % -102;
         Comodin1 = Comodin + "fich/" + Comodin1 + "/";
         |PATH_DAT #22 Comodin1;
         |ABRE #agif001@;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO TomaNombres;
   |SI FSalida = 10;
      |CONSULTA_CLAVE #1#agif001@;
      |SI FSalida = 0;
         #carectod#Campo# = #agif001@#120; |PINTA #carectod#Campo#;
      |FINSI;
      |ERROR; |ACABA;
   |FINSI;

   |SI #carectod#Campo# = "    "; |ACABA; |FINSI;

   |SI Campo = 11;
      #agif001@#120 = #carectod#11;
   |SINO;
      #agif001@#120 = #carectod#12;
   |FINSI;

   |LEE 010#agif001@.=;
   |SI FSalida = 0;
      |SI Campo = 11; |PINTA 1334, #agif001@#156; |FINSI;
      |SI Campo = 12; |PINTA 1434, #agif001@#156; |FINSI;
   |SINO;
      |MENAV "    No encuentro el enlace";
      |ERROR;
      |ACABA;
   |FINSI;
|FPRC;

|PROCESO RevisaApuntes;

   #camaasic#0 = #camaasil#0;
   #camaasic#1 = #camaasil#1;
   #camaasic#2 = #camaasil#2;
   |LEE 010#camaasic.=;
   |SI FSalida ! 0;
      |SI #camaasil#9 = 0; |BORRA 020#camaasil.a; |ACABA; |FINSI;
   |FINSI;

   |SI #camaasil#12 ! "R"; |ACABA; |FINSI;

   #caconcep#0 = #camaasil#6;
   |LEE 010#caconcep.=;
   |SI FSalida = 0;
      Comodin = #caconcep#1; |QBF Comodin;
      Comodin = #camaasil#7 - Comodin;
      Caracter = Comodin % 0101;
      |PARA; |SI Caracter = " "; |HACIENDO;
         Comodin = Comodin % 0299;
         Caracter = Comodin % 0101;
      |SIGUE;
      Serie1 = Comodin % 0102;
      Comodin1 = Comodin % 0406;
      Factu1 = Comodin1;
   |FINSI;

   |SI #camaasil#15 ! Serie1; |O #camaasil#14 ! Factu1;
      #camaasil#15 = Serie1;
      #camaasil#14 = Factu1;
      |GRABA 020#camaasil.a;
   |FINSI;

|FPRC;

|DEFBUCLE RevisaApuntes;
#camaasil#1;
;
00,"01.01.1900",000000,0000;
99,"31.12.2999",999999,9999;
;
NULL,RevisaApuntes;
|FIN;

|PROGRAMA;

   |CLS;
   |CABEZA "Recalculo general";
   |PINPA #0#0; |PINDA #0#0;

   |ENDATOS #1#0;
   |SI FSalida ! 0;
      |SI EnlacOpen = 1;  |CIERRA #agif001@; |DESCARGA_DEF #agif001@; |FINSI;
      |SI EmprOpen = 1; |CIERRA #agif041@; |DESCARGA_DEF #agif041@; |FINSI;
      |ACABA;
   |FINSI;

   Comodin  = #0#6; |QBF Comodin;
   Comodin1 = Comodin + "def/agifa134.mas"; |CARGA_DEF Comodin1, agif134@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa024.mas"; |CARGA_DEF Comodin1, agif024@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa025.mas"; |CARGA_DEF Comodin1, agif025@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa008.mas"; |CARGA_DEF Comodin1, agif008@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa059.mas"; |CARGA_DEF Comodin1, agif059@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa010.mas"; |CARGA_DEF Comodin1, agif010@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa072.mas"; |CARGA_DEF Comodin1, agif072@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa077.mas"; |CARGA_DEF Comodin1, agif077@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa079.mas"; |CARGA_DEF Comodin1, agif079@;
   |SI FSalida ! 0; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/agifa112.mas"; |CARGA_DEF Comodin1, agif112@;
   |SI FSalida ! 0; |ACABA; |FINSI;

   Comodin1 = ("00" + #0#7) % -102;
   Comodin1 = Comodin + "fich/" + Comodin1 + "/";
   |PATH_DAT #19 Comodin1;
   |PATH_DAT #21 Comodin1;
   |PATH_DAT #22 Comodin1;
   |PATH_DAT #23 Comodin1;
   |PATH_DAT #24 Comodin1;
   |PATH_DAT #25 Comodin1;
   |PATH_DAT #26 Comodin1;
   |PATH_DAT #27 Comodin1;
   |PATH_DAT #28 Comodin1;
   |PATH_DAT #29 Comodin1;
   |PATH_DAT #30 Comodin1;

   |ABRE #agif134@;
   |ABRE #agif024@;
   |ABRE #agif001@;
   |ABRE #agif025@;
   |ABRE #agif008@;
   |ABRE #agif059@;
   |ABRE #agif010@;
   |ABRE #agif072@;
   |ABRE #agif077@;
   |ABRE #agif079@;
   |ABRE #agif112@;

   |ABRE #caivaasi;
   |LEE 010#caivaasi.p;
   |SI FSalida ! 0;
      |DDEFECTO #caivaasi;
      |GRABA 020#caivaasi.n;
      |LEE 010#caivaasi.p;
   |FINSI;

   |ABRE #camaasic;
   |ABRE #camaasil;
   |ABRE #caivarep;
   |ABRE #caivasop;
   |ABRE #caconcep;
   |ABRE #camandia;
   |ABRE #cacuenta;

   Primera = 1;
   |BUCLE RevisaApuntes;

   |SI #carectod#11 ! "    ";
      #agif001@#120 = #carectod#11;
      |LEE 010#agif001@.=;
      |BUCLE FactVenta;
   |FINSI;

   |SI #carectod#12 ! "    ";
      #agif001@#120 = #carectod#12;
      |LEE 010#agif001@.=;
      |BUCLE FactCompra;
   |FINSI;

   |CIERRA #cacuenta;
   |CIERRA #camandia;
   |CIERRA #caconcep;
   |CIERRA #caivasop;
   |CIERRA #caivarep;
   |CIERRA #camaasil;
   |CIERRA #camaasic;
   |CIERRA #caivaasi;

   |CIERRA #agif112@; |DESCARGA_DEF #agif112@;
   |CIERRA #agif079@; |DESCARGA_DEF #agif079@;
   |CIERRA #agif077@; |DESCARGA_DEF #agif077@;
   |CIERRA #agif072@; |DESCARGA_DEF #agif072@;
   |CIERRA #agif010@; |DESCARGA_DEF #agif010@;
   |CIERRA #agif059@; |DESCARGA_DEF #agif059@;
   |CIERRA #agif008@; |DESCARGA_DEF #agif008@;
   |CIERRA #agif025@; |DESCARGA_DEF #agif025@;
   |CIERRA #agif024@; |DESCARGA_DEF #agif024@;
   |CIERRA #agif134@; |DESCARGA_DEF #agif134@;
   |CIERRA #agif001@; |DESCARGA_DEF #agif001@;
   |CIERRA #agif041@; |DESCARGA_DEF #agif041@;

|FPRO;
