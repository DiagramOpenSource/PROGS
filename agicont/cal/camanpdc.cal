|FICHEROS;
   camanpdc #0;
   camanpdl #1;

   camanban #10;
   capagven #11;
   caclipro #12;
   camanpag #13;
|FIN;

|VARIABLES;
   &entrada = 1;
   &fichero = "";
   &nDeci_Base = 2;

   nModo  = 0;
   nCont  = 0;
   nLinea = 0;
   nFlag  = 0;

   aAlfa  = "";
|FIN;

|PROCESO Tipo2c; |TIPO 2;
   nFlag = 0 +. 1;
   |SI nFlag < 0;
      |SI #camanpdc#12 = "S"; |O #camanpdc#13 = "S";
         |MENAV "    Relacion ya contabilizada"; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo2l; |TIPO 2;
   nModo = (FEntrada / 100) ! 0;
   nFlag = 0 +. 1;

   |SI nFlag > 0;
      |ABRE #caclipro;
      #caclipro#23 = "P";
      #caclipro#10 = #camanpag#4;
      #caclipro#11 = #camanpag#5;
      |LEE 000#caclipro.=;
      |SI FSalida ! 0; |DDEFECTO #caclipro; |FINSI;
      |CIERRA #caclipro;

      #camanpdl#6 = #camanpag#7;                  |PINTA #camanpdl#6;
      #camanpdl#7 = #camanpag#8;                  |PINTA #camanpdl#7;
      #camanpdl#8 = #camanpag#4;
      #camanpdl#9 = #caclipro#1;
      #camanpdl#10 = #caclipro#6;
   |FINSI;

   |ABRE #camanpag;
   #camanpag#0 = #camanpdl#2;
   #camanpag#1 = #camanpdl#3;
   #camanpag#2 = #camanpdl#4;
   #camanpag#3 = #camanpdl#5;
   |LEE 101#camanpag.=;
   |SI FSalida = 0;
      |SI nFlag > 0;
         #camanpag#25 = #camanpdc#0;      || N§ Confirming
         #camanpag#22 = "S";       || Liquidado
         #camanpag#23 = #camanpag#23 + #camanpdl#7;
         #camanpag#26 = #camanpdc#2;
      |SINO;
         #camanpag#25 = 0;                || N§ Confirming
         #camanpag#23 = #camanpag#23 - #camanpdl#7;
         #camanpag#22 = "N";              || Liquidado
         #camanpag#26 = 0;
      |FINSI;
      |GRABA 020#camanpag.a; |LIBERA #camanpag;
   |FINSI;
   |CIERRA #camanpag;

   #camanpdc#10 = #camanpdc#10 +. #camanpdl#7; |PINTA #camanpdc#10;
   #camanpdc#5  = #camanpdc#5  +. 1;           |PINTA #camanpdc#5;
|FPRC;

|PROCESO Contador; |TIPO 7;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo ! 1; |ACABA; |FINSI;
   |ABRE #camanpdc;
   |LEE 000#camanpdc.u;
   |SI FSalida = 0;
      nCont = #camanpdc#0 + 1;
   |SINO;
      nCont = 1;
   |FINSI;
   |CIERRA #camanpdc;
   |DDEFECTO #camanpdc;
   #camanpdc#0 = nCont; |PINDA #0#camanpdc;
|FPRC

|PROCESO TomaDatos;
   |ABRE #camanban;
   #camanban#0 = #camanpdc#2;
   |LEE 000#camanban.=;
   |SI FSalida = 0;
      aAlfa = #camanban#8; |QBF aAlfa;
      #camanpdc#18 = aAlfa; |PINTA #camanpdc#18;
      aAlfa = #camanban#9; |QBF aAlfa; aAlfa = aAlfa % 0104;
      #camanpdc#16 = aAlfa; |PINTA #camanpdc#16;
      aAlfa = #camanban#9; |QBF aAlfa; aAlfa = aAlfa % 0504;
      #camanpdc#17 = aAlfa; |PINTA #camanpdc#17;
      aAlfa = #camanban#9; |QBF aAlfa; aAlfa = aAlfa % 0902;
      #camanpdc#19 = aAlfa; |PINTA #camanpdc#19;
   |FINSI;
   |CIERRA #camanban;
|FPRC;

|PROCESO camanpag;
   |DDEFECTO #capagven;
   #capagven#0  = nLinea; nLinea = nLinea + 1;
   #capagven#1  = #camanpag#0;
   #capagven#2  = #camanpag#1;
   #capagven#3  = #camanpag#2;
   #capagven#4  = #camanpag#3;
   #capagven#5  = #camanpag#4;
   #capagven#6  = #camanpag#5;
   #capagven#7  = #camanpag#6;
   #capagven#8  = #camanpag#7;
   #capagven#9  = #camanpag#8;
   #capagven#10 = #camanpag#9;
   #capagven#12 = #camanpag#11;
   |GRABA 020#capagven.n;
|FPRC;

|DEFBUCLE camanpag;
#camanpag#4;
22,12,25;
#camanpdc#7, "01.01.0000", "N", 0, 0;
#camanpdc#7, #camanpdc#1 , "N", 0, 0;
;
NULL,camanpag;
|FIN;

|RUTINA infven;
   #capagven#0 = 1;
|FRUT;

|RUTINA supven;
   #capagven#0 = 999999;
|FRUT;

|PROCESO VuelcaDatos;
   #caclipro#23 = "P";
   #caclipro#10 = #capagven#5;
   #caclipro#11 = #capagven#6;
   |LEE 000#caclipro.=;
   |SI FSalida ! 0; |DDEFECTO #caclipro; |FINSI;

   #camanpdl#0  = #camanpdc#0;
   #camanpdl#1  = nLinea; nLinea = nLinea + 1;
   #camanpdl#2  = #capagven#1;
   #camanpdl#3  = #capagven#2;
   #camanpdl#4  = #capagven#3;
   #camanpdl#5  = #capagven#4;
   #camanpdl#6  = #capagven#8;
   #camanpdl#7  = #capagven#9;
   #camanpdl#8  = #capagven#5;
   #camanpdl#9  = #caclipro#1;
   #camanpdl#10 = #caclipro#6;
   |GRABA 020#camanpdl.n;

   |ABRE #camanpag;
   #camanpag#0 = #camanpdl#2;
   #camanpag#1 = #camanpdl#3;
   #camanpag#2 = #camanpdl#4;
   #camanpag#3 = #camanpdl#5;
   |LEE 101#camanpag.=;
   |SI FSalida = 0;
      #camanpag#25 = #camanpdc#0;      || N§ Confirming
      #camanpag#22 = "S";       || Liquidado
      #camanpag#23 = #camanpag#23 + #camanpdl#7;
      #camanpag#26 = #camanpdc#2;
      |GRABA 020#camanpag.a; |LIBERA #camanpag;
   |FINSI;
   |CIERRA #camanpag;

   #camanpdc#10 = #camanpdc#10  + #camanpdl#7; |PINTA #camanpdc#10;
   #camanpdc#5  = #camanpdc#5   + 1;           |PINTA #camanpdc#10;
|FPRC;

|DEFBUCLE VuelcaDatos;
#capagven#1;
15;
000001,"*";
999999,"*";
be;
NULL,VuelcaDatos;
|FIN;

|PROCESO PagAuto;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
      |CONFI "    NSeleccion automatica ? ";
      |SI FSalida = 0;
         aAlfa = "tm" + Usuario; |NOME_DAT #capagven#aAlfa#; fichero = aAlfa;
         |DELINDEX #capagven; |ABRE #capagven; |ABRE #camanpdl; |ABRE #caclipro;
         nLinea = 1; |BUCLE camanpag;
         |SUB_EJECUTA "capagven.tab";
         nLinea = 1; |BUCLE VuelcaDatos;
         |CIERRA #camanpdl; |CIERRA #caclipro;
         |CIERRA #capagven; |DELINDEX #capagven;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo11l; |TIPO 11;
   |SI FSalida = 10;
      |ABRE #camanpag;
      #camanpag#0 = #camanpdl#2;
      #camanpag#1 = #camanpdl#3;
      #camanpag#2 = #camanpdl#4;
      #camanpag#3 = #camanpdl#5;
      |LEE 000#camanpag.=;
      |SI FSalida ! 0; |DDEFECTO #camanpag; |FINSI;
      |CIERRA #camanpag;

      |PUSHV 0501 2380;
      |PINPA #0#camanpag; |PINDA #0#camanpag;
      |PAUSA;
      |POPV;
      |ERROR;
   |FINSI;
|FPRC;
