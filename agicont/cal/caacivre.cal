|FICHEROS;
    caacivre #0;
    camaasic #1;
    camaasil #2;
    cacuenta #3;
    caivarep #4;
    calibros #5;
    caiivrec #6;
    caiivrel #7;
    catraacr #8;
    catradia #9;  ||    catraac2 #9;
    camandia #10;
    caivarec #11;
    cacon300 #17;
    caivaref #112;

    caivaasi #210;

    camacc01 #501;
    camacc02 #502;
    camacc12 #512;

    casiim01;
    casiim02;
|FIN;

|VARIABLES;
    nEstado = 0;
    nContar = 0;
    aAlfa1  = "";
    aAlfa4  = "";
    &enDiario   = 0;
    &enContador = 0;
    &modcon = 0;
    difant = 0;
    cam = 0;
    totfac = 0;
    totbas = 0;
    cue = "";
    niv = 0;
    deb ="";
    imp = 0;
    diario = 0;
    fecha   = @;
    ffecha1 = @;
    docume = 0;
    asient = 0;
    cabe = 0;
    ordant = 0;
    fecant = @;
    cueant = "";
    digant = 0;
    coaant = 0;
    desant = "";
    conant = "";
    dcoant = 0;
    serant = "";
    nomant = "";
    cifant = "";
    peant  = 0;
    inant  = "";
    itant  = "";
    fopant = @;
    linea = 0;
    mensaji = "";
    sw_fin = 0;
    &entrada = 1;
    aun_hay = 0;
    gua_libro = 0;
    gua_orden = 0;
    gua_serie = "";
    trim1 = @;
    trim2 = @;
    trim3 = @;
    trim4 = @;
    alfa1 = "";
    alfa2 = "";
    para1 = 0;
    iv1 = 0;
    iv2 = 0;
    iv3 = 0;
    iv4 = 0;
    iv5 = 0;
    re1 = 0;
    re2 = 0;
    re3 = 0;
    re4 = 0;
    re5 = 0;
    ac = 0;
    sw_ac = 0;
    sw_che = 0;
    ser_ant = "";
    fra_ant = 0;
    lin_ant = 0;
    fec_ant = @;
    no_hay = 0;
    ini = 0;
    fecalf = "";
    mes = "";
    mesfec = 0;
    mesac = 0;
    a = 0;
    b = 0;
    c = 0;
    aCampo1 = "";
    aCampo2 = "";
    aCampo3 = "";

   nuant    = "";
   aAlfa    = "";
   nPaso    = 0;

   nSwError = 0;
   nSwOp    = 0;
   aCaja    = "";
   nSwCaja  = 0;
   nNumBase  = 0;
   nNumero   = 0;

   nCampo1 = 0;
   nCampo2 = 0;
   nCampo3 = 0;

   nBase   = 0;
   nCuota  = 0;
   nTp     = 0;
   nSuma1  = 0;
   nSuma2  = 0;
   nSuma3  = 0;
   nLineaUlt = 0;
   aH60      = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE tempo_i;
|INCLUYE condes_i;
|INCLUYE varcaj_i;
|INCLUYE varnue_i;

____________________________________/ CHEQUEO DE DUPLICADOS
|PROCESO duplicados;
  sw_che = 0;
  |SI #0#16 = "S";
      alfa1 = #7#26;  |QBF alfa1;
      |SI ser_ant = alfa1;|Y fra_ant = #7#2;|Y lin_ant = #7#3;
          mensaji = "    Factura ";
          mensaji = mensaji + #7#2;
          mensaji = mensaji + " Duplicada en Introd.!! (ACTUALIZACION ANULADA) ...";
          |MENAV mensaji;
          sw_che = 1;
          |ERROR10;
      |FINSI;
  |FINSI;
  |SI ser_ant = alfa1;|Y fra_ant = #7#2;|Y lin_ant ! #7#3;|Y fec_ant ! #7#4;
      mensaji = "    Factura ";
      mensaji = mensaji + #7#2;
      mensaji = mensaji + " Error en Fecha !! (ACTUALIZACION ANULADA) ...";
      |MENAV mensaji;
      sw_che = 1;
      |ERROR10;
  |FINSI;
  ser_ant = #7#26;     |QBF ser_ant;
  fra_ant = #7#2;
  lin_ant = #7#3;
  fec_ant = #7#4;
|FPRC;

|DEFBUCLE chequea2;
 #7#2;
 ;
 #0#0, #0#11, #0#2,  0;
 #0#1, #0#12, #0#3, 99;
 ;
 NULL, duplicados;
|FIN;
____________________________________/ CHEQUEO DE EXISTENTES
|PROCESO si_existe;
  no_hay = no_hay + 1;
    #4#0 = #7#0;    || libro
    #4#2 = #7#2;    || fra.
    #4#27 = #7#26;  || serie
    |LEE 000#4=;
    |SI FSalida = 0;
        mensaji = "    Factura ";
        mensaji = mensaji + #4#2;
        mensaji = mensaji + " YA Existente!! (ACTUALIZACION ANULADA) ...";
        |MENAV mensaji;
        sw_che = 1;
        |ERROR10;
    |FINSI;
|FPRC;

|DEFBUCLE chequea1;
 #7#3;
 ;
 #0#0, #0#4, #0#11, #0#2, 00;
 #0#1, #0#5, #0#12, #0#3, 99;
 ;
 NULL, si_existe;
|FIN;
____________________________________/ ACTUALIZACION
|PROCESO hacer;
    |SI cam = 0;
        |HAZ GrabaContador;
        |HAZ nueva;
        |HAZ guarda;
        |HAZ acerar;
            cam = 1;
    |FINSI;
    |SI ordant ! #7#2; |O serant ! #7#26;
        |HAZ factura;
        |HAZ nueva;
        |SI #0#6 = "R";
            sw_fin = 0;
            |HAZ cuadre;
        |FINSI;
        |SI fecant ! #7#4; |Y #0#6 = "F";
            sw_fin = 0;
            |HAZ cuadre;
        |FINSI;
        |HAZ guarda;
    |FINSI;
    |HAZ lineas;
    |BORRA 020#7a;
    |LIBERA #7;
|FPRC;

|DEFBUCLE caacivre0;
 #7#3;
 ;
 #0#0, #0#4, #0#11, #0#2, 00;
 #0#1, #0#5, #0#12, #0#3, 99;
 be;
 NULL, hacer;
|FIN;

|PROCESO si_quedan;
    aun_hay = 1;
|FPRC;

|PROCESO borra_cab1;
    aun_hay = 0;
    |BUCLELIN 2si_quedan#6;
    |SI aun_hay = 0;
        |BORRA 020#6a;
    |FINSI;
|FPRC;

|DEFBUCLE borra_cab;
 #6#1;
 ;
 #0#0;
 #0#1;
 e;
 NULL, borra_cab1;
|FIN;

|PROCESO actual; |TIPO 3;
  diario = #0#7;
  fecha  = #0#8;
  docume = #0#9;
  asient = #0#10;
  cabe = 0;
  cam = 0;
  sw_che = 0;
  ser_ant = "x";
  fra_ant = -1;
  lin_ant = -1;

 |HAZ nom_usu;
 alfa1 = "b" + nom_tmp;
 |NOME_DAT #8 alfa1;

  |ABRE #1;
  |ABRE #2;
  |ABRE #3;
  |ABRE #4;
  |ABRE #5;
  |ABRE #6;
  |ABRE #7;
  |ABRE #8;
  |ABRE #11;
  |ABRE #112;
  || .................. Abre fichero Auxiliar de Cuentas
    |ABRE #9;
    |LEE 101#9u;
    |SI FSalida ! 0;
        |DDEFECTO #9;
        #9#0 = 1;
    |SINO;
        #9#0 = #9#0 + 1;
    |FINSI;
    |GRABA 101#9n;
    codcon = #9#0;
    |LIBERA #9;
  || ----------------------------------------------------------
  |SI #0#16 = "S";
      |BUCLE chequea1;              || existentes
  |SINO;
      no_hay = 1;
  |FINSI;

  |SI no_hay ! 0;
      |SI sw_che = 0;
          sw_che = -1;
          |BUCLE chequea2;          || duplicados
          |SI sw_che = 0;
              |BUCLE caacivre0;
              |HAZ factura;
              sw_fin = 1;
              |HAZ cuadre;
          |FINSI;
      |FINSI;
  |FINSI;
  |CIERRA #112;
  |CIERRA #11;
  |CIERRA #9;
  |CIERRA #8;
  |CIERRA #7;
  |CIERRA #6;
  |CIERRA #5;
  |CIERRA #4;
  |CIERRA #3;
  |CIERRA #2;
  |CIERRA #1;

  |SI sw_che = 0;
      |BUCLE borra_cab;
  |FINSI;
|FPRC;

|PROCESO fecha;
  |C_M #0Campo,0,alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  |SI #0Campo < fec1; |O #0Campo > fec2;
      |MENAV "     Fecha ERRONEA ";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO entrada; |TIPO 0;
  |SI FSalida = 2; |ACABA; |FINSI;

  enDiario = #0#7;
  |HAZ Descontador;

  |ABRE #1;
  #1#0 = #0#7;
  #1#1 = fec2;
  #1#2 = 999999;
  |LEE 040#1>;
  |SI FSalida = 0;
      |LEE 040#1a;
  |SINO;
      |LEE 040#1u;
      |SI FSalida ! 0;
          #1#1 = fec1;
      |FINSI;
  |FINSI;
  #0#9 = enContador;
  #0#10 = #0#9;
  |PINTA #0#9;
  |PINTA #0#10;
  |CIERRA #1;
  |SI #0#16 = "S";
      #0#17 = 999999;
      |ACABA;
  |FINSI;

  |ABRE #4;
  #4#0 = #0#0;
  #4#27 = "  ";
  #4#2 = 999999;
  |LEE 040#4];
  |SI FSalida ! 0;
      |LEE 040#4u;
      |SI FSalida ! 0;
          #0#17 = 0;
      |SINO;
          |SI #4#0 = #0#0;
              #0#17 = #4#2;
          |SINO;
              #0#17 = 0;
          |FINSI;
      |FINSI;
  |SINO;
      |LEE 040#4a;
      |SI FSalida ! 0;
          #0#17 = 0;
      |SINO;
          |SI #4#0 = #0#0;
              #0#17 = #4#2;
          |SINO;
              #0#17 = 0;
          |FINSI;
      |FINSI;
  |FINSI;
  #0#17 = #0#17 + 1;
  |PINTA #0#17;
  |CIERRA #4;
|FPRC;

|PROCESO EsBueno;
  |SI #0#16 = "S";  |ACABA;  |FINSI;
  |SI #0#0 ! #0#1;
      |MENAV "     La actualizacion se debe de hacer con solo un diario";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO final; |TIPO 7;
  |C_M #0Campo,0,alfa1;
  |SI alfa1 = "S";
      |SI eaConDes ! "N";
          #0Campo = "";
      |FINSI;
      |PTEC 816;
  |FINSI;
|FPRC;

|PROCESO noentres; |TIPO 0;
  |CAMPO_MODIFICA #0#28, 1, "S";
  |CAMPO_MODIFICA #0#14, 1, "N";
  |CAMPO_MODIFICA #0#15, 1, "N";
  |CAMPO_MODIFICA #0#18, 1, "N";

  |SI #0#6 ! "R";
      |CAMPO_MODIFICA #0#14, 1, "S";
      |CAMPO_MODIFICA #0#15, 1, "S";
      |CAMPO_MODIFICA #0#18, 1, "S";
      |SI #0#6 = "T";
          |CAMPO_MODIFICA #0#28, 1, "N";
          #0#28 = "P"; |PINTA #0#28;
      |FINSI;
  |SINO;
      #0#18 = "N"; |PINTA #0#18;
  |FINSI;
|FPRC;

|PROCESO Tipo0C28;
   |SI #0#28 = "F";
       #0#8 = "01.01.0000"; |PINTA #0#8;
       |C_M #0#8,1,"N";
   |SINO;
       |C_M #0#8,1,"S";
       |SI #0#8 [ "01.01.0000";
           #0#8 = ~; |PINTA #0#8;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO noentres2; |TIPO 0;
  |CAMPO_MODIFICA #0#22, 1, "S";
  |CAMPO_MODIFICA #0#23, 1, "S";
  |CAMPO_MODIFICA #0#24, 1, "S";
  |CAMPO_MODIFICA #0#25, 1, "S";

  |SI #0#18 = "S";
      |CAMPO_MODIFICA #0#22, 1, "N"; #0#22 = "N"; |PINTA #0#22;
      |CAMPO_MODIFICA #0#23, 1, "N"; #0#23 = "N"; |PINTA #0#23;
      |CAMPO_MODIFICA #0#24, 1, "N"; #0#24 = "N"; |PINTA #0#24;
      |CAMPO_MODIFICA #0#25, 1, "N"; #0#25 = "N"; |PINTA #0#25;
  |FINSI;
|FPRC;

|| ***********************************************************************

|PROCESO acerar;
   |CIERRA #8;
   |DELINDEX #8;
   |ABRE #8;
    totfac  = 0;
    totbas  = 0;
    nContar = 0;
    nPaso   = 0;
|FPRC;

|PROCESO lineas;
    nContar = nContar + 1;
    #8#6 = 1; |SI #0#18 = "N"; #8#6 = nContar; |FINSI;

    #8#0 = "C";
    #8#1 = #7#17;        || cuenta
    #8#2 = #7#18;        || digito
    #8#4 = #7#13;        || % iva
    #8#5 = #7#15;        || % rec.
    |LEE 101#8=;
    |SI FSalida ! 0;
        #8#0 = "C";
        #8#1 = #7#17;
        #8#2 = #7#18;
        #8#3 = 0;
        #8#4 = #7#13;        || % iva
        #8#5 = #7#15;        || % rec.
        #8#6 = 1; |SI #0#18 = "N"; #8#6 = nContar; |FINSI;
        |GRABA 020#8b;
    |FINSI;
    #8#3 = #8#3 + #7#11 + #7#12;        || base imponible+descuento
    #8#7 = #7#7;

|| Tratamiento del Concepto
   aAlfa1 = #7#8; |QBF aAlfa1;
   |SI #0#22 = "S";
       aAlfa1 = aAlfa1 + " " + #4#27 + aCampo2; |QBF aAlfa1;
   |FINSI;
   |SI #0#23 = "S";
       aAlfa4 = #4#2;
       |SI aCampo3 = "S"; aAlfa4 = ("000000" + aAlfa4) % -106; |FINSI;
       |SI #0#22 = "N"; aAlfa1 = aAlfa1 + " "; |FINSI;
       aAlfa1 = aAlfa1 + aAlfa4; |QBF aAlfa1;
   |FINSI;
   |SI #0#24 = "S";
       aAlfa1 = aAlfa1 + " " + fecant; |QBF aAlfa1;
   |FINSI;
   |SI #0#25 = "S";
       aAlfa1 = aAlfa1 + " " + nomant; |QBF aAlfa1;
    |FINSI;
|| ===================================================================
    #8#8 = aAlfa1;

    |GRABA 020#8a;
    |LIBERA #8;

    cue = #7#17;
    niv = #7#18;
    deb = "H";
    imp = #7#11 + #7#12;
|SI imp < 0;  |Y #0#13 = "S";
        deb = "D";
        imp = -imp;
|FINSI;
|HAZ gratra;

|SI #7#11 = 0;
    |VETE nodescu;
|SINO;
        #8#0 = "D";
        #8#1 = #7#24;
        #8#2 = #7#25;
        #8#4 = #7#13;        || % iva
        #8#5 = #7#15;        || % rec.
        #8#6 = 1;
    |LEE 101#8=;
    |SI FSalida ! 0;
            #8#0 = "D";
            #8#1 = #7#24;
            #8#2 = #7#25;
            #8#3 = 0;
            #8#4 = #7#13;        || % iva
            #8#5 = #7#15;        || % rec.
            #8#6 = 1;
        |GRABA 020#8b;
    |FINSI;
    #8#3 = #8#3 + #7#11;       || descuento
    #8#7 = #7#7;
    #8#8 = #7#8;
    |GRABA 020#8a;
    |LIBERA #8;

        cue = #7#24;
        niv = #7#25;
        deb = "D";
        imp = #7#11;
    |SI imp < 0; |Y #0#13 = "S";
            deb = "H";
            imp = -imp;
    |FINSI;
    |HAZ gratra;
|FINSI;

|ET nodescu;
|SI #7#14 = 0;|Y #7#16 = 0;
    |VETE noiva;
|SINO;
        #8#0 = "I";
        #8#1 = #7#20;
        #8#2 = #7#21;
        #8#4 = #7#13;        || % iva
        #8#5 = #7#15;        || % rec.
        #8#6 = 1;
    |LEE 101#8=;
    |SI FSalida ! 0;
            #8#0 = "I";
            #8#1 = #7#20;
            #8#2 = #7#21;
            #8#3 = 0;
            #8#4 = #7#13;        || % iva
            #8#5 = #7#15;        || % rec.
            #8#6 = 1;
        |GRABA 020#8b;
    |FINSI;
        #8#3 = #8#3 + #7#14;       || cuota iva
    #8#7 = #7#7;
    #8#8 = #7#8;
    |GRABA 020#8a;
    |LIBERA #8;
        cue = #7#20;
        niv = #7#21;
        deb = "H";
        imp = #7#14;
    |SI imp < 0; |Y #0#13 = "S";
            deb = "D";
            imp = -imp;
    |FINSI;
    |HAZ gratra;
|FINSI;
|SI #7#16 ! 0;
        #8#0 = "R";
        #8#1 = #7#22;
        #8#2 = #7#23;
        #8#4 = #7#13;        || % iva
        #8#5 = #7#15;        || % rec.
        #8#6 = 1;
    |LEE 101#8=;
    |SI FSalida ! 0;
            #8#0 = "R";
            #8#1 = #7#22;
            #8#2 = #7#23;
            #8#3 = 0;
            #8#4 = #7#13;        || % iva
            #8#5 = #7#15;        || % rec.
            #8#6 = 1;
        |GRABA 020#8b;
    |FINSI;
        #8#3 = #8#3 + #7#16;       || cuota recargo
    #8#7 = #7#7;
    #8#8 = #7#8;
    |GRABA 020#8a;
    |LIBERA #8;
        cue = #7#22;
        niv = #7#23;
        deb = "H";
        imp = #7#16;
    |SI imp < 0; |Y #0#13 = "S";
            deb = "D";
            imp = -imp;
    |FINSI;
    |HAZ gratra;
|FINSI;

|ET noiva;
|SI #4#11 = #7#13;|Y #4#17 = #7#15;
        #4#8 = #4#8 + #7#12;
        #4#14 = #4#14 + #7#14;
        #4#20 = #4#20 + #7#16;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 1;
        |VETE ParaCaja;
|FINSI;
|SI #4#12 = #7#13;|Y #4#18 = #7#15;
        #4#9 = #4#9 + #7#12;
        #4#15 = #4#15 + #7#14;
        #4#21 = #4#21 + #7#16;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 2;
        |VETE ParaCaja;
|FINSI;
|SI #4#13 = #7#13;|Y #4#19 = #7#15;
        #4#10 = #4#10 + #7#12;
        #4#16 = #4#16 + #7#14;
        #4#22 = #4#22 + #7#16;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 3;
        |VETE ParaCaja;
|FINSI;
|SI #4#54 = #7#13;|Y #4#58 = #7#15;
        #4#52 = #4#52 + #7#12;
        #4#56 = #4#56 + #7#14;
        #4#60 = #4#60 + #7#16;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 4;
        |VETE ParaCaja;
|FINSI;
|SI #4#55 = #7#13;|Y #4#59 = #7#15;
        #4#53 = #4#53 + #7#12;
        #4#57 = #4#57 + #7#14;
        #4#61 = #4#61 + #7#16;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 5;
        |VETE ParaCaja;
|FINSI;
|SI #4#8 = 0;
        #4#8 = #7#12;
        #4#11 = #7#13;
        #4#14 = #7#14;
        #4#17 = #7#15;
        #4#20 = #7#16;
        #4#23 = #7#19;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 1;
        |VETE ParaCaja;
|FINSI;
|SI #4#9 = 0;
        #4#9 = #7#12;
        #4#12 = #7#13;
        #4#15 = #7#14;
        #4#18 = #7#15;
        #4#21 = #7#16;
        #4#24 = #7#19;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 2;
        |VETE ParaCaja;
|FINSI;
|SI #4#10 = 0;
        #4#10 = #7#12;
        #4#13 = #7#13;
        #4#16 = #7#14;
        #4#19 = #7#15;
        #4#22 = #7#16;
        #4#25 = #7#19;
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 3;
        |VETE ParaCaja;
|FINSI;
|SI #4#52 = 0;
        #4#52 = #7#12;   || base
        #4#54 = #7#13;   || % iva
        #4#56 = #7#14;   || cuota iva
        #4#58 = #7#15;   || % rec
        #4#60 = #7#16;   || cuota rec
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 4;
        |VETE ParaCaja;
|FINSI;
|SI #4#53 = 0;
        #4#53 = #7#12;   || base
        #4#55 = #7#13;   || % iva
        #4#57 = #7#14;   || cuota iva
        #4#59 = #7#15;   || % rec
        #4#61 = #7#16;   || cuota rec
        totfac = totfac + #7#12 + #7#14 + #7#16;
        totbas = totbas + #7#12;
        nNumBase = 5;
|FINSI;

|ET ParaCaja;
    |HAZ LaClaveZ14;
|FPRC;

|PROCESO gratra;
    modcon = 1;               || graba el temporal para la actualiz. de ctas.
    #9#0 = codcon;
    #9#1 = cue;
    #9#2 = niv;
    |SI #0#28 = "P";
        #9#3 = fecha;
    |SINO;
        #9#3 = fecant;
    |FINSI;
    #9#4 = deb;
    #9#6 = #0#7;
    |LIBERA #9;
    |LEE 101#9=;
    |SI FSalida ! 0;
        |DDEFECTO #9;
        #9#0 = codcon;
        #9#1 = cue;
        #9#2 = niv;
        |SI #0#28 = "P";
            #9#3 = fecha;
        |SINO;
            #9#3 = fecant;
        |FINSI;
        #9#4 = deb;
        #9#6 = #0#7;
       |GRABA 101#9b;
    |FINSI;
    #9#5 = #9#5 + imp;
    |GRABA 101#9a;
|FPRC;

|PROCESO factura;
    |SI cabe = 0;
        |HAZ cabecera;
        cabe = 1;
    |FINSI;
    #2#0 = diario;

    |SI #0#28 = "P";
        #2#1 = fecha;
    |SINO;
        #2#1 = fecant;
    |FINSI;

    #2#2 = docume;
    linea = linea + 10;
    #2#3 = linea;
    #2#4 = cueant;
    #2#5 = digant;

|| Tratamiento del Concepto
   #2#6 = coaant;
   enNumCon = #2#6; |HAZ VerConcepto; #2#24 = eaDesCon;
   aAlfa1 = desant; |QBF aAlfa1;
   |SI #0#19 = "S";
       aAlfa1 = aAlfa1 + " " + #4#27 + aCampo2; |QBF aAlfa1;
   |FINSI;
   |SI #0#20 = "S";
       aAlfa4 = #4#2;
       |SI aCampo3 = "S"; aAlfa4 = ("000000" + aAlfa4) % -106; |FINSI;
       |SI #0#22 = "N"; aAlfa1 = aAlfa1 + " "; |FINSI;
       aAlfa1 = aAlfa1 + aAlfa4; |QBF aAlfa1;
   |FINSI;
   |SI #0#21 = "S";
       aAlfa1 = aAlfa1 + " " + fecant; |QBF aAlfa1;
   |FINSI;
   #2#7 = aAlfa1;
|| ----------------------------------------------------------------------
    #2#8 = "D";
    |SI itant = "N"; #2#9 = totfac; |FINSI;
    |SI itant = "S"; #2#9 = totbas; |FINSI;
    #2#10 = conant;
    #2#11 = dcoant;
    |SI #2#9 < 0;  |Y #0#13 = "S";
        #2#8 = "H";
        #2#9 = -#2#9;
    |FINSI;
    |HAZ adapta;
    |HAZ a_diario;
    |HAZ a_cuenta;
    #2#12 = "R";           || repercutido
    #2#13 = #4#0;          || libro
    #2#14 = #4#2;          || factura
    #2#15 = #4#27;         || serie (inhibida)
    #2#19 = "F";           || tipo acumulador
    #2#20 = 0;             || nro. acumulador

    |GRABA 020#2n;
    #4#26 = totfac;
    #4#3 = fecant;
    #4#4 = cueant;
    #4#5 = digant;
    #4#6 = coaant;
    #4#7 = desant;
    #4#27 = serant;
    #4#44 = peant;
    #4#48 = inant;       || Inversion
    #4#45 = #2#0;        || diario
    #4#46 = #2#1;        || fecha
    #4#47 = #2#2;        || documento
    #4#50 = nomant;      || nombre cliente
    #4#51 = cifant;      || cif cliente
    |GRABA 020#4a;
    |HAZ TrataRectif;
    |HAZ TrataOtro;

    gua_libro = #4#0;
    gua_orden = #4#2;
    gua_serie = #4#27;
    cue = #2#4;
    niv = #2#5;
    deb = #2#8
    imp = #2#9;
    |HAZ gratra;
    #1#0 = diario;
    |SI #0#28 = "P";
        #1#1 = fecha;
    |SINO;
        #1#1 = fecant;
    |FINSI;
    #1#2 = docume;
    |LEE 101#1=;
    |SI #2#8 = "D";
        #1#4 = #1#4 + #2#9;
        |SI #1#09 = 0; #1#08 = #2#4; #1#09 = #2#5; |FINSI;      || contrp.HABER
    |SINO;
        #1#5 = #1#5 + #2#9;
        |SI #1#11 = 0; #1#10 = #2#4; #1#11 = #2#5; |FINSI;      || contrp.DEBE
    |FINSI;
    #1#6 = #1#4 - #1#5;
    |GRABA 020#1a;
    |LIBERA #1;
    totfac = 0;
    totbas = 0;
|FPRC;

|PROCESO PideRectif;
     |QBF nuant;
     |SI nuant = "";
         |PUSHV 0501 2380;
         |BLANCO 1202 2379;
         |CUADRO 1202 2379;
         |PINTA 1314, "HAY UN CONCEPTO DE FACTURA RECTIFICATIVA";
         aAlfa = "EN LA FACTURA " + #4#0 + "/" + #4#27 + " " + #4#2 + ": " + #4#7;
         |PINTA 1414, aAlfa;
         |PINTA 1514, "Y falta el numero de la factura rectificada. Introduzcalo: ";

         aAlfa = "";
         E_inf = "";
         E_sup = "40";
         aAlfa = 1716 ? 1;
         nuant = aAlfa;
         |POPV;
     |FINSI;
     |DDEFECTO #11;
     #11#0 = #4#0;
     #11#1 = #4#27;
     #11#2 = #4#2;
     |LEE 101#11=;
     |SI FSalida ! 0;
          #11#0 = #4#0;
          #11#1 = #4#27;
          #11#2 = #4#2;
          |GRABA 020#11b;
     |FINSI;
     #11#3 = nuant;
     |GRABA 020#11a;
     |LIBERA #11;
|FPRC;

|PROCESO TrataOtro;
    |SI fopant > "01.01.0000";
        #112#0 = #4#0;
        #112#1 = #4#27;
        #112#2 = #4#2;
        |LEE 101#112=;
        |SI FSalida ! 0;
            #112#0 = #4#0;
            #112#1 = #4#27;
            #112#2 = #4#2;
            |GRABA 020#112b;
        |FINSI;
        #112#3 = fopant;
        |GRABA 020#112a;
        |LIBERA #112;
    |FINSI;
|FPRC;

|PROCESO TrataRectif;
    |ABRE #17;
    #17#0 = #4#6;
    |LEE 001#17=;
    |SI FSalida ! 0;  |DDEFECTO #17;  |FINSI;
    |SI #17#5 = "D";
        |HAZ PideRectif;
    |FINSI;
    |CIERRA #17;
|FPRC;

|| ... Nuevo
|PROCESO Campos502;
|| .. asi el calcul
     nCampo1 = 13 + (nNumBase * 3);
     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;

     #502nCampo1 = ((nBase + nCuota) % #502#13) ! 2;
     #502nCampo2 = (nBase  % #502#13) ! 2;
     #502nCampo3 = (nCuota % #502#13) ! 2;

     nSuma1 = (nSuma1 + #502nCampo1) ! 2;
     nSuma2 = (nSuma2 + #502nCampo2) ! 2;
     nSuma3 = (nSuma3 + #502nCampo3) ! 2;
     nLineaUlt = nNumBase;
|FPRC;

|PROCESO LeoLineaIVA;
     nSuma1 = 0;
     nSuma2 = 0;
     nSuma3 = 0;
     nLineaUlt = 0;
     |PDEFECTO #502,16,31;

     |SI #4#8 ! 0; |O #4#14 ! 0;
         nBase = #4#8;  nCuota = #4#14;
         nNumBase = 1; |HAZ Campos502;
     |FINSI;

     |SI #4#9 ! 0; |O #4#15 ! 0;
         nBase = #4#9;  nCuota = #4#15;
         nNumBase = 2; |HAZ Campos502;
     |FINSI;

     |SI #4#10 ! 0; |O #4#16 ! 0;
         nBase = #4#10;  nCuota = #4#16;
         nNumBase = 3; |HAZ Campos502;
     |FINSI;

     |SI #4#52 ! 0; |O #4#56 ! 0;
         nBase = #4#52;  nCuota = #4#57;
         nNumBase = 4; |HAZ Campos502;
     |FINSI;

     |SI #4#53 ! 0; |O #4#57 ! 0;
         nBase = #4#53;  nCuota = #4#57;
         nNumBase = 5; |HAZ Campos502;
     |FINSI;

     |SI nSuma1 ! #502#10; |O nSuma2 ! #502#11; |O nSuma3 ! #502#12;
         |SI nLineaUlt > 0;
             nCampo1 = 13 + nLineaUlt * 3;
             nCampo2 = nCampo1 + 1;
             nCampo3 = nCampo1 + 2;
             #502nCampo1 = #502nCampo1 + (#502#10 - nSuma1);
             #502nCampo2 = #502nCampo2 + (#502#11 - nSuma2);
             #502nCampo3 = #502nCampo3 + (#502#12 - nSuma3);
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO AuxClaveZ02;
      |SI totfac = #502#10;
          nTp = 100;
      |SINO;
          nTp   = ((#502#10 * 100) / totfac) ! 4;
      |FINSI;
      #502#13 = nTp;

      |HAZ LeoLineaIVA;
      #501#16 = #501#16 + #502#13;

      |GRABA 020#502a;
      |LIBERA #502;
|FPRC;

|DEFBUCLE AuxClaveZ02;
  #502#1;
  ;
  #501#13, #501#17, #501#0, #501#14, #501#15, 01;
  #501#13, #501#17, #501#0, #501#14, #501#15, 99;
  be;
  NULL, AuxClaveZ02;
|FIN;

|PROCESO LaLineaAux;
|| .. asi el calcul
     nCampo1 = 13 + (nNumBase * 3);
     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;

     #502nCampo1 = #502nCampo1 + #512#5;
     #502nCampo2 = #502nCampo2 + #512#6;
     #502nCampo3 = #502nCampo3 + #512#7;
|FPRC;

|PROCESO GrabaAuxClaveZ;
     nSwError = 1;
     |DDEFECTO #502;
      #502#0 = aTipoIVA;
      #502#32 = 0000;
      #502#1 = #4#0;
      #502#2 = #4#27;
      #502#3 = #4#2;
      #502#4 = nNumero;
      |LEE 141#502=;
      |SI FSalida ! 0;
          |DDEFECTO #502;
          #502#0 = aTipoIVA;
          #502#32 = 0000;
          #502#1 = #4#0;
          #502#2 = #4#27;
          #502#3 = #4#2;
          #502#4 = nNumero;
          #502#5 = #512#3;     || Fecha Cobro
          #502#7 = #512#4;     || Periodo
          #502#13 = #512#8;
          #501#16 = #501#16 + #502#13;
          |GRABA 020#502b;
      |FINSI;
      |SI #502#5 = #512#3;
          #502#10 = #502#10 + #512#5;
          #502#11 = #502#11 + #512#6;
          #502#12 = #502#12 + #512#7;
          #502#14 = #512#9;
          #502#15 = #512#10;
          |HAZ LaLineaAux;
          |GRABA 020#502a;
          nSwError = 0;
          #501#6  = #501#6  + #512#6;
          #501#7  = #501#7  + #512#7;
          #501#12 = #501#12 + #512#5;
      |FINSI;
      |LIBERA #502;
|FPRC;

|PROCESO AuxClaveZ;
   |SI nSwOp = 1;            || Graba segun el numero de cobro
      nNumero = #512#2;
      |HAZ GrabaAuxClaveZ;
      |SI nSwError = 0;
          |BORRA 020#512a;
      |FINSI;
   |FINSI;
   |SI nSwOp = 2;
       |DDEFECTO #502;
       #502#0 = aTipoIVA;
       #502#32 = 0000;
       #502#1 = #4#0;
       #502#2 = #4#27;
       #502#3 = #4#2;
       #502#4 = 99;
       |LEE 141#502];
       |SI FSalida = 0;
           |LEE 041#502a;
       |SINO;
           |LEE 041#502u;
       |FINSI;
       nNumero = 1;
       |SI FSalida = 0; |Y #502#0 = aTipoIVA; |Y #502#1 = #4#0;
            |Y #502#2 = #4#27; |Y #502#3 = #4#2; |Y #502#32 = 0;
           nNumero = #502#4 + 1;
       |FINSI;
       |HAZ GrabaAuxClaveZ;
       |BORRA 020#512a;
   |FINSI;
   |LIBERA #512;
|FPRC;

|DEFBUCLE AuxClaveZ;
  #512#1;
  ;
  aTipoIVA, #7#0, #7#1, 00;
  aTipoIVA, #7#0, #7#1, 99;
  be;
  NULL, AuxClaveZ;
|FIN;

|PROCESO LaClaveZ14;
    enConcepto = #7#7;
    |HAZ EsCajaIva;
    |SI enSwCaja = 1;
       |ABRE #501;
       #501#13 = aTipoIVA;
       #501#17 = 0000;
       #501#0  = #4#0;
       #501#14 = #4#27;
       #501#15 = #4#2;
       |LEE 141#501=;
       |SI FSalida ! 0;
           |DDEFECTO #501;
           #501#13 = aTipoIVA;
           #501#17 = 0000;
           #501#0  = #4#0;
           #501#14 = #4#27;
           #501#15 = #4#2;
           |GRABA 020#501b;
       |FINSI;

       |ABRE #502;
       nSwOp = 1; |BUCLE AuxClaveZ;
       nSwOp = 2; |BUCLE AuxClaveZ;
       |CIERRA #502;

       #501#16 = 0;
       |BUCLE AuxClaveZ02;

       |GRABA 020#501a;
       |LIBERA #501;
       |CIERRA #501;
   |FINSI;
|FPRC;

|PROCESO FinCaja;
  |SI enEjercicio ] 2014;
       |ABRE #501;
       #501#13 = aTipoIVA;
       #501#17 = 0000;
       #501#0  = gua_libro;
       #501#14 = gua_serie;
       #501#15 = gua_orden;
       |LEE 141#501=;
       |SI FSalida = 0;
           #501#2 = #2#0;
           #501#3 = #2#1;
           #501#4 = #2#2;
           |GRABA 020#501a;
       |FINSI;
       |LIBERA #501;
       |CIERRA #501;
   |FINSI;
|FPRC;

|PROCESO cabecera;
|DDEFECTO #1;
  #1#0 = diario;
  |SI #0#28 = "P";
      #1#1 = fecha;
  |SINO;
      #1#1 = fecant;
  |FINSI;
  #1#2 = docume;
  #1#3 = asient;
  linea = -9;
  iv1 = 0;  iv2 = 0;  iv3 = 0;  iv4 = 0;  iv5 = 0;
  re1 = 0;  re2 = 0;  re3 = 0;  re4 = 0;  re5 = 0;
  |GRABA 020#1n;
  |SI FSalida ! 0;
      #2#0 = #1#0;
      #2#1 = #1#1;
      #2#2 = #1#2;
      #2#3 = 9999;
      |LEE 040#2];
      |SI FSalida = 0;
          |LEE 040#2a;
          |SI #2#0 = #1#0; |Y #2#1 = #1#1; |Y #2#2 = #1#2;
              linea = #2#3;
          |FINSI;
      |SINO;
          |LEE 040#2u;
          |SI FSalida = 0; |Y  #2#0 = #1#0; |Y #2#1 = #1#1; |Y #2#2 = #1#2;
              linea = #2#3;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO guarda;
  ordant = #7#2;
  fecant = #7#4;
  cueant = #7#5;
  digant = #7#6;
  coaant = #7#7;
  desant = #7#8;
  conant = #7#17;
  dcoant = #7#18;
  serant = #7#26;
  nomant = #7#27;
  cifant = #7#30;
  peant  = #7#31;
  |SI #caivaasi#53 = "A";
      |HAZ periodo;
  |FINSI;
  inant  = #7#32;
  itant  = #7#33;
  aAlfa = #7#35; |QBF aAlfa;
  |SI nPaso = 0; |Y aAlfa ! ""; nPaso = 1; nuant  = #7#35; |FINSI;
  fopant = #7#36;
|FPRC;

|PROCESO cuadre;
|LEE 001#8p;
|VETE sigcua;
|ET siglee;
    |LEE 001#8s;
    |SI FSalida ! 0;
        |VETE fincua;
    |FINSI;
|ET sigcua;
        #2#0 = diario;
        #2#1 = fecant;
        |SI itant = "S";
            |SI #8#0 = "I"; |O #8#0 = "R";
                |VETE siglee;
            |FINSI;
        |FINSI;
        #2#2 = docume;
        linea = linea + 10;
        #2#3 = linea;
        #2#4 = #8#1;
        #2#5 = #8#2;
    |SI #0#6 ! "R";
            #2#6 = #0#14;     || concepto para apuntes de iva y de ventas
            #2#7 = #0#15;
            #2#10 = "";
            #2#11 = 9;
            |SI #0#18 = "N"; |Y #8#0 = "C";
                #2#6 = #8#7;
                #2#7 = #8#8;
            |FINSI;
    |SINO;
            #2#6 = coaant;
            #2#7 = desant; #2#7 = #8#8;
            #2#10 = cueant;
            #2#11 = difant;
    |FINSI;
    enNumCon = #2#6; |HAZ VerConcepto; #2#24 = eaDesCon;
    |SI #8#0 = "D";
            #2#8 = "D";
    |SINO;
            #2#8 = "H";
    |FINSI;
        #2#9 = #8#3;
    |SI #2#9 < 0;  |Y #0#13 = "S";
        |SI #2#8 = "D";
                #2#8 = "H";
        |SINO;
                #2#8 = "D";
        |FINSI;
            #2#9 = -#2#9;
    |FINSI;
    |HAZ adapta;
    |HAZ a_diario;
    |HAZ a_cuenta;
        #2#12 = "R";           || soportado
    |SI #0#6 = "R";
            #2#13 = gua_libro;     || libro  (en la actualizacion por fechas
            #2#14 = gua_orden;     || factura           /no relaciona el IVA)
            #2#15 = gua_serie;     || serie (inhibida)
        |HAZ acumulador;
        |SI #8#0="C";
            #2#19="B"; |SI #8#3 < 0; |Y #0#13 = "S"; #2#19 = "b"; |FINSI;
            #2#20=ac;
        |FINSI;
        |SI #8#0="I";
            #2#19="I"; |SI #8#3 < 0; |Y #0#13 = "S"; #2#19 = "i"; |FINSI;
            #2#20=ac;
        |FINSI;
        |SI #8#0="R";
            #2#19="R"; |SI #8#3 < 0; |Y #0#13 = "S"; #2#19 = "r"; |FINSI;
            #2#20=ac;
        |FINSI;
        |SI #8#0="D";
            #2#19="b"; |SI #8#3 < 0; |Y #0#13 = "S"; #2#19 = "B"; |FINSI;
            #2#20=ac;
        |FINSI;
    |FINSI;
    |GRABA 020#2n;
        #1#0 = diario;
    |SI #0#28 = "P";
            #1#1 = fecha;
    |SINO;
            #1#1 = fecant;
    |FINSI;
        #1#2 = docume;
    |LEE 101#1=;
    |SI #2#8 = "D";
            #1#4 = #1#4 + #2#9;
        |SI #1#09 = 0; #1#08 = #2#4; #1#09 = #2#5; |FINSI;  || contrp.HABER
    |SINO;
            #1#5 = #1#5 + #2#9;
        |SI #1#11 = 0; #1#10 = #2#4; #1#11 = #2#5; |FINSI;  || contrp.DEBE
    |FINSI;
        #1#6 = #1#4 - #1#5;        || saldo
    |GRABA 020#1a;
    |LIBERA #1;
    |VETE siglee;

|ET fincua;
    |HAZ FinCaja;
    cabe = 0;

|SI sw_fin = 0;
    enDiario = #0#7;
    |HAZ contador;
|FINSI;
    docume = enContador;
    asient = asient + 1;
|HAZ acerar;
|FPRC;

|PROCESO acumulador;
    sw_ac = 0;
    ac = 0;

|SI iv1 = #8#4;|Y re1 = #8#5; ac = 1; sw_ac = 1; |FINSI;
|SI iv2 = #8#4;|Y re2 = #8#5; ac = 2; sw_ac = 1; |FINSI;
|SI iv3 = #8#4;|Y re3 = #8#5; ac = 3; sw_ac = 1; |FINSI;
|SI iv4 = #8#4;|Y re4 = #8#5; ac = 4; sw_ac = 1; |FINSI;
|SI iv5 = #8#4;|Y re5 = #8#5; ac = 5; sw_ac = 1; |FINSI;

|SI sw_ac = 0;|Y iv1 = 0;|Y re1 = 0;
        iv1 = #8#4;  re1 = #8#5;  sw_ac = 1; ac = 1;
|FINSI;
|SI sw_ac = 0;|Y iv2 = 0;|Y re2 = 0;
        iv2 = #8#4;  re2 = #8#5;  sw_ac = 1; ac = 2;
|FINSI;
|SI sw_ac = 0;|Y iv3 = 0;|Y re3 = 0;
        iv3 = #8#4;  re3 = #8#5;  sw_ac = 1; ac = 3;
|FINSI;
|SI sw_ac = 0;|Y iv4 = 0;|Y re4 = 0;
        iv4 = #8#4;  re4 = #8#5;  sw_ac = 1; ac = 4;
|FINSI;
|SI sw_ac = 0;|Y iv5 = 0;|Y re5 = 0;
        iv5 = #8#4;  re5 = #8#5;  sw_ac = 1; ac = 5;
|FINSI;

|SI ac = 0;    ac = 6;   |FINSI;
|FPRC;

|PROCESO casiim02;
     #casiim02#0 = "caivarep";
     #casiim02#1 = #caivarep#0;
     #casiim02#2 = #caivarep#27 + (("000000" + #caivarep#2) % -106);
     |GRABA 020#casiim02.n;
     |LIBERA #casiim02;
|FPRC;

|DEFBUCLE casiim02;
     #casiim02#1;
     ;
     #casiim01#0, #casiim01#1, #casiim01#2, "";
     #casiim01#0, #casiim01#1, #casiim01#2, aH60;
     be;
     NULL, casiim02;
|FIN;

|PROCESO nueva;
     |DDEFECTO #4;
     |LIBERA #4;
     #4#0 = #7#0;
     |SI #0#16 = "S";
         #4#2 = #7#2;
     |SINO;
         #4#2  = #0#17;
         #0#17 = #0#17 + 1;
     |FINSI;
     #4#27 = #7#26;

     |ABRE #casiim01;
     #casiim01#0 = "caiivrel";
     #casiim01#1 = #caiivrel#0;
     #casiim01#2 = #caiivrel#1;
     |LEE 000#casiim01.=;
     |SI FSalida = 0;
         aH60 = "z" * 60;
         |BUCLE casiim02;

         #casiim01#0 = "caivarep";
         #casiim01#1 = #caivarep#0;
         #casiim01#2 = #caivarep#27 + (("000000" + #caivarep#2) % -106);
         |GRABA 020#casiim01.n;
         |LIBERA #casiim01;
     |FINSI;
     |CIERRA #casiim01;

     |GRABA 020#4b;

     #5#0 = #7#0;
     |LEE 040#5=;
     |SI FSalida ! 0;
         #4#1 = "INEXISTENTE";
     |SINO;
         #4#1 = #5#1;
     |FINSI;
     nuant = "";
     nPaso = 0;
|FPRC;

|PROCESO adapta;
|SI #2#8 = "D";
        #2#16 = #2#4;
        #2#17 = #2#5;
        #2#10 = "";
        #2#11 = 0;
|SINO;
        #2#16 = "";
        #2#17 = 0;
        #2#10 = #2#4;
        #2#11 = #2#5;
|FINSI;
|FPRC;

|PROCESO a_diario;
|ABRE #10;
    #10#0 = #2#0;
|LEE 101#10=;
|SI FSalida ! 0;              || actualiza el diario
    |DDEFECTO #10;
        #10#0 = #2#0;
        #10#1 = "<DIARIO SIN DEFINIR>";
    |GRABA 020#10b;
|FINSI;
|SI #2#8 = "D";  #10#2 = #10#2 + #2#9;  |FINSI;
|SI #2#8 = "H";  #10#3 = #10#3 + #2#9;  |FINSI;
|GRABA 020#10a;
|LIBERA #10;
|CIERRA #10;
|FPRC;

|PROCESO a_actualiza;                || rutina 'a_cuentas'
  ini = dig1;
  fecalf = #2#1;
  mes = fecalf % 402;
  mesfec = mes;
  |SI ini = 1;
      mesac = mesfec;
  |SINO;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
  |FINSI;
  a = (mesac * 3) + 9;
  b = a + 1;
  c = a + 2;
  |SI #2#8 = "D";
      #3a = #3a + #2#9;
      #3#51 = #3#51 + #2#9;
  |SINO;
      #3b = #3b + #2#9;
      #3#52 = #3#52 + #2#9;
  |FINSI;
  #3c = #3a - #3b;
  #3#53 = #3#51 - #3#52;
|FPRC;

|PROCESO a_cuenta;
 #3#0 = #2#4;
 #3#1 = #2#5;
 |LEE 101#3=;
 |SI FSalida = 0;
     |SI #2#0 = 0;
         |SI #2#8 = "D";
             #3#9  = #3#9  + #2#9;        || diario cero (saldos iniciales)
             #3#51 = #3#51 + #2#9;
         |SINO;
             #3#10 = #3#10 + #2#9;
             #3#52 = #3#52 + #2#9;
         |FINSI;
         #3#11 = #3#9 - #3#10;
         #3#53 = #3#51 - #3#52;
     |SINO;
         |SI #2#0 = 99;
             |SI #2#8 = "D";
                 #3#48 = #3#48 + #2#9;       || diario 99 (saldos finales)
                 #3#51 = #3#51 + #2#9;
             |SINO;
                 #3#49 = #3#49 + #2#9;
                 #3#52 = #3#52 + #2#9;
             |FINSI;
             #3#50 = #3#48 - #3#49;
             #3#53 = #3#51 - #3#52;
         |SINO;
             |HAZ a_actualiza;           || saldos del mes correspondiente
         |FINSI;
     |FINSI;
     |GRABA 020#3a;
     |LIBERA #3;
 |FINSI;
|FPRC;

|PROCESO periodo;
    |SI #0#28 = "P";
        ffecha1 = fecha;
    |SINO;
        ffecha1 = fecant;
    |FINSI;
    |SI #caivaasi#46 = "T";
        alfa1 = ffecha1;   alfa1 = alfa1 % -104;      || saca a¤o
        alfa2 = "31.03." + alfa1;  trim1 = alfa2;  || primer trimestre
        alfa2 = "30.06." + alfa1;  trim2 = alfa2;  || segundo trimestre
        alfa2 = "30.09." + alfa1;  trim3 = alfa2;  || tercer trimestre
        |SI ffecha1 [ trim1;                    peant = 1;  |FINSI;
        |SI ffecha1 > trim1;|Y ffecha1 [ trim2; peant = 2;  |FINSI;
        |SI ffecha1 > trim2;|Y ffecha1 [ trim3; peant = 3;  |FINSI;
        |SI ffecha1 > trim3;                    peant = 4;  |FINSI;
    |SINO;
        alfa1 = ffecha1;
        alfa1 = alfa1 % 0402;
        peant = alfa1;
    |FINSI;
|FPRC;

|PROCESO LeeCaivaasi;
 |ABRE #210;
 |DDEFECTO #210;
 |LEE 001#210p;
 |CIERRA #210;
 aCampo1 = #210#45;
 aCampo2 = #210#48;
 aCampo3 = #210#49;
|FPRC;

|PROGRAMA;
  |CLS;
  |CABEZA "Act.Fras Emitidas";
  |HAZ inicio;
  |HAZ VerCaconimp;
  |HAZ eVarEmpresa;
  |SI eaConDes ! "N";
      |C_P #0#15,1,1551;
      |C_A #0#15,1,20;
      |C_V #0#27,1,"S";
  |FINSI;

  |HAZ LeeCaivaasi;

  |ABRE #0;
  |DDEFECTO #0;
  |LEE 101#0p;
  nEstado = FSalida;
  |SI nEstado ! 0;
      #0#4 = fec1;
  |FINSI;

  aTipoIVA = "R";
  |PINPA #0#0;
  #0#5 = fec2;
  |PINDA #0#0;
  |HAZ entrada;

  |ENDATOS #1#0;
  |SI FSalida = 0;
      |SI nEstado = 0; |GRABA 020#0a; |FINSI;
      |SI nEstado ! 0; |GRABA 020#0n; |FINSI;
      |CIERRA #0;
      |HAZ termino;
  |SINO;
      |CIERRA #0;
  |FINSI;
|FPRO;

|PROCESO termino;
 || ............... Terminar
 |SI modcon = 0;
     |ABRET #9;
     |DDEFECTO #9;
     #9#0 = codcon;
     |LEE 040#9=;
     |BORRA 101#9a;
     |CIERRAT #9;
 |SINO;
     |CORRE "camaapua.tab"
 |FINSI;
|FPRC;
