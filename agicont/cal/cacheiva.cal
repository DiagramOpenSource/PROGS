|FICHEROS;
    cacheiva #0;
    cacuenta #1;    || cuentas
    camaasic #2;    || apuntes cabs.
    camaasil #3;    || apuntes lins.
    caivatmp #4;    || iva temporal
    caivarep #5;    || iva repercutido
    caivasop #6;    || iva soportado
    calibros #7;    || libros

    caivaasi #200;
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    FEstado = 0;
    long = 0;
    sw = 0;
    &tipo = "";
    &fec_ant = @;
    &difa = 0;
    &acua = 0;
    &acui = 0;
    &libi = 0;
    &seri = "";
    &frai = 0;
    &desi = "";
    &impi = 0;
    &sw_lin = 0;
    &serii = "";
    sw_iva = 0;
    sw_nod = 0;
    repetir = 0;
    sw_eof = 0;
    des_signo = "";
    has_signo = "";
    sw_asegura = 0;
    &sw_ruptura = 0;
    &dia = @;
    d_cuen = "";
    h_cuen = "";
    d_digi = 0;
    h_digi = 0;
    primero = 0;
    mayor1 = "";
    ord = 0;

    Cont = 0; Signo = 0;
    ExistLibro = 0;

    Opcion = 0;

{-1}Menu  = "";
    Menu1 = "2400";
    Menu2 = "1";
    Menu3 = "Elija formato: ";
    Menu4 = "AE";
    Menu5 = " < Automatico > ";
    Menu6 = " < Extensivo > ";

|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;

*****************************************************************************
                       CALCULOS DESDE CAMPOS
*****************************************************************************


|PROCESO Defectos;
 |ABRE #200;
 |DDEFECTO #200;
 |LEE 041#200p;
 |CIERRA #200;

 |SI #0Campo = "R"; #0#1 = "477*"; #0#5 = #200#3;  |FINSI;
 |SI #0Campo = "S"; #0#1 = "472*"; #0#5 = #200#29; |FINSI;
 |PINTA #0#1;
 |PINTA #0#5;

 #0#12 = fec1; |PINTA #0#12;
 #0#13 = fec2; |PINTA #0#13;
|FPRC;

|PROCESO asterisco;
  elsw1 = 0;
  |PARA para1 = 1; |SI para1 [ 12; |HACIENDO para1 = para1 + 1;
        nume1 = (para1 * 100) + 1;
        alfa1 = #0#1 % nume1;
        |SI alfa1 = "*";
            elsw1 = para1;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO cuenta; |TIPO 6;
  |HAZ asterisco;
  |SI elsw1 ! 0;  |ACABA;  |FINSI;
  salidas = FSalida;
  p_alfa1 = #0Campo;
  |HAZ punto;
  |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
  alfa1 = #0#1;
  |QBF alfa1;
  alfa1 = alfa1 % 0;
  long = alfa1;
  sw   = 0;
  #0#2 = 0;  || inicializa el digito
  |SI long = dig4; |Y dig4 ! 0; sw = 1; #0#2 = 1; |FINSI;
  |SI long = dig5; |Y dig5 ! 0; sw = 1; #0#2 = 2; |FINSI;
  |SI long = dig6; |Y dig6 ! 0; sw = 1; #0#2 = 3; |FINSI;
  |SI long = dig7; |Y dig7 ! 0; sw = 1; #0#2 = 4; |FINSI;
  |SI long = dig8; |Y dig8 ! 0; sw = 1; #0#2 = 5; |FINSI;
  |SI long = dig9; |Y dig9 ! 0; sw = 1; #0#2 = 6; |FINSI;
  |SI sw = 0;|Y long ! 0;
      |MENAV "    Longitud de Cuenta Fuera de Nivel !";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO cuefin; |TIPO 0;
  |SI #0#1 = "            ";
      |MENAV "    Error de Entrada ...";
      |ERROR;
      |ACABA;
  |FINSI;
  |HAZ asterisco;
  |SI elsw1 = 0;
      |ABRE #1;
      |SELECT #1#1;
      #1#0 = #0#1;
      #1#1 = #0#2;
      |LEE 001#1=;
      FEstado = FSalida;
      |SI FEstado ! 0;
          |DDEFECTO #1;
      |FINSI;
      |ATRI I;
      |PINTA 1438, #1#2;
      |ATRI 0;
      |SI FEstado = 0;|Y #1#3 = "N";
          |MENAV "    Cuenta sin pase directo ...";
          |ERROR;
          |DDEFECTO #1;
      |FINSI;
      |CIERRA #1;
      |HAZ asegura;
  |FINSI;
  |SI #0#11 = "R";
      #1#5 = "P";
  |FINSI;
|FPRC;

|PROCESO favor; |TIPO 7;
  |SI #0#11 = "R";  #0#1 = "477*";  |FINSI;
  |SI #0#11 = "S";  #0#1 = "472*";  |FINSI;
  |PINTA #0#1;
  |PTEC 816;
|FPRC;

|PROCESO asegura; |TIPO 0;
  sw_asegura = 0;
  alfa1 = #0#1 % 103;
  |SI alfa1 = "472";|Y #0#11 = "R";  sw_asegura = 1;  |FINSI;
  |SI alfa1 = "477";|Y #0#11 = "S";  sw_asegura = 1;  |FINSI;
  |SI sw_asegura = 1;
      |MENAV "    Esta Seguro ? ";
  |FINSI;
|FPRC;

|PROCESO fech_bien; |TIPO 0;
  |SI #0Campo < fec1; |O #0Campo > fec2;
      |MENAV "    Fecha fuera de Periodo ...";
      |ERROR;
  |FINSI;
|FPRC;


|PROCESO fech_defe; |TIPO 7;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  #0#12 = fec1;
  #0#13 = fec2;
  |PINTA #0#12;
  |PINTA #0#13;
|FPRC;

|PROCESO libro_bien; |TIPO 0;
  |SI #0Campo ! 0;|Y FSalida ! 2;
      |SI #7#2 = "R";|Y #0#11 = "S";
          |MENAV "    ATENCION!!! Libro de I.V.A. Repercutido ...";
          |ERROR;
      |FINSI;
      |SI #7#2 = "S";|Y #0#11 = "R";
          |MENAV "    ATENCION!!! Libro de I.V.A. Soportado ...";
          |ERROR;
      |FINSI;
  |FINSI;
|FPRC;

*****************************************************************************
                       CALCULOS DE IMPRESION
*****************************************************************************

|PROCESO ivas2;
  nume1 = #4#14 + #4#15 + #4#16 + #4#56 + #4#57;     || cuotas iva
  nume2 = #4#20 + #4#21 + #4#22 + #4#60 + #4#61;     || cuotas recargo
  nume3 = 0;
  |SI #0#4 = 1;  nume3 = nume1 + nume2;   |FINSI;   || incluido recargo
  |SI #0#4 = 2;  nume3 = nume1;           |FINSI;   || no incluido
  |SI #0#4 = 3;  nume3 = nume2;           |FINSI;   || cta. recargo
  acui = acui + nume3;
  impi = nume3;

  libi = #4#0;
  frai = #4#2;
  desi = #4#7;
  serii = #4#27;
  sw_lin = 0;
  |SI #0#0 = "R";  |PRINT;  |FINSI;
  libi = 0;
  frai = 0;
  impi = 0;
  desi = "";
  serii = "";
|FPRC;


|PROCESO ivas1;
  sw_iva = 0;
  sw_nod = 0;
  |SI primero = 0;
      |LEE 001#4=;
  |SINO;
      |LEE 001#4s;
  |FINSI;
  FEstado = FSalida;
  |SI FEstado = 0;
      |SI #0#14=2;|Y #4#23="N"; sw_nod=1; |FINSI;  || no deduc. no incluido
      |SI #0#14=3;|Y #4#23="S"; sw_nod=1; |FINSI;  || no deduc. solamente
      |SI ord = 1;
          |SI #4#3 = dia;|Y sw_nod = 0;
              |HAZ ivas2;
              sw_iva = 1;
              primero = 1;
          |FINSI;
      |SINO;
          |SI #4#46 = dia;|Y sw_nod = 0;
              |HAZ ivas2;
              sw_iva = 1;
              primero = 1;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI sw_iva = 0; |Y sw_eof = 0;          || imprime apunte aunque no hay iva
      |SI #0#0 = "R";  |PRINT;  |FINSI;
  |FINSI;
|FPRC;

|PROCESO ivas0;
  acua = 0;
  acui = 0;
  |DDEFECTO #4;
  |SI ord = 1; #4#3   = dia;  |FINSI;         || fecha factura
  |SI ord = 2; #4#46  = dia;  |FINSI;         || fecha factura
  #4#0 = 0;            || libro
  #4#2 = 0;            || fra.
  |LEE 000#4];
  |SI FSalida = 0;|Y primero = 1;  |LEE 001#4a;   |FINSI;        || se situa
|FPRC;

|PROCESO tot_fecha;
  difa = acua - acui;
  sw_lin = 1;
  |PRINT;                   || imprime total fecha
  sw_lin = 0;
|FPRC;

|PROCESO apuntes2;
  |SI #1#5 = "A";
      |SI #3#8 = "D";  acua = acua + #3#9;  |FINSI;
      |SI #3#8 = "H";  acua = acua - #3#9;  |FINSI;
  |FINSI;
  |SI #1#5 = "P";
      |SI #3#8 = "D";  acua = acua - #3#9;  |FINSI;
      |SI #3#8 = "H";  acua = acua + #3#9;  |FINSI;
  |FINSI;
|FPRC;

|PROCESO apuntes1;

  ExistLibro = 0;
  |PARA Cont = 5; |SI Cont [ 21; |HACIENDO Cont = Cont + 1;
     |SI #camaasil#13 = #cacheiva#Cont#;
        ExistLibro = 1;
        |SAL;
     |FINSI;
     |SI Cont = 10; Cont = 15; |FINSI;
  |SIGUE;

  |SI ExistLibro = 0; |ACABA; |FINSI;

  #2#0 = #3#0;
  #2#1 = #3#1;
  #2#2 = #3#2;
  |LEE 001#2=;        || sigue si la cabecera existe
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |SI fec_ant = "01.01.0001";
      fec_ant = #3#1;
      |HAZ ivas0;
  |FINSI;
  |HAZ apuntes2;
  |HAZ ivas1;
|FPRC;

|DEFBUCLE apuntes;
 #3#4;
 1, 4, 5, 8;
 00, "  ", 000000, dia, d_cuen, d_digi, des_signo;
 99, "zz", 999999, dia, h_cuen, h_digi, has_signo;
 e;
 NULL, apuntes1;
|FIN;

|| -----------------------------------------------------------------------
|PROCESO tmp_sopor1;

  ExistLibro = 0;
  |PARA Cont = 5; |SI Cont [ 21; |HACIENDO Cont = Cont + 1;
     |SI #caivasop#0 = #cacheiva#Cont#;
        ExistLibro = 1;
        |SAL;
     |FINSI;
     |SI Cont = 10; Cont = 15; |FINSI;
  |SIGUE;

  |SI ExistLibro = 0; |ACABA; |FINSI;

      #4#0  = #6#0;   #4#1  = #6#1;   #4#2  = #6#2;   #4#3  = #6#3;
      #4#4  = #6#4;   #4#5  = #6#5;   #4#6  = #6#6;   #4#7  = #6#7;
      #4#8  = #6#8;   #4#9  = #6#9;   #4#10 = #6#10;  #4#11 = #6#11;
      #4#12 = #6#12;  #4#13 = #6#13;  #4#14 = #6#14;  #4#15 = #6#15;
      #4#16 = #6#16;  #4#17 = #6#17;  #4#18 = #6#18;  #4#19 = #6#19;
      #4#20 = #6#20;  #4#21 = #6#21;  #4#22 = #6#22;  #4#23 = #6#23;
      #4#24 = #6#24;  #4#25 = #6#25;  #4#26 = #6#26;  #4#27 = #6#27;
      #4#28 = #6#28;  #4#29 = #6#29;  #4#30 = #6#30;  #4#31 = #6#31;
      #4#32 = #6#32;  #4#33 = #6#33;  #4#34 = #6#34;  #4#35 = #6#35;
      #4#36 = #6#36;  #4#37 = #6#37;  #4#38 = #6#38;  #4#39 = #6#39;
      #4#40 = #6#40;  #4#41 = #6#41;  #4#42 = #6#42;  #4#43 = #6#43;
      #4#44 = #6#44;  #4#45 = #6#45;  #4#46 = #6#46;  #4#47 = #6#47;
      #4#48 = #6#48;  #4#49 = #6#49;  #4#50 = #6#50;  #4#51 = #6#51;
      #4#52 = #6#52;  #4#53 = #6#53;  #4#54 = #6#54;  #4#55 = #6#55;
      #4#56 = #6#56;  #4#57 = #6#57;  #4#58 = #6#58;  #4#59 = #6#59;
      #4#60 = #6#60;  #4#61 = #6#61;
      |GRABA 020#4n;
|FPRC;

|DEFBUCLE tmp_sopor;
 #6#1;
 ;
 00, "  ",      0;
 99, "zz", 999999;
 e;
 NULL, tmp_sopor1;
|FIN;

|PROCESO tmp_reper1;

  ExistLibro = 0;
  |PARA Cont = 5; |SI Cont [ 21; |HACIENDO Cont = Cont + 1;
     |SI #caivarep#0 = #cacheiva#Cont#;
        ExistLibro = 1;
        |SAL;
     |FINSI;
     |SI Cont = 10; Cont = 15; |FINSI;
  |SIGUE;

  |SI ExistLibro = 0; |ACABA; |FINSI;

      #4#0  = #5#0;   #4#1  = #5#1;   #4#2  = #5#2;   #4#3  = #5#3;
      #4#4  = #5#4;   #4#5  = #5#5;   #4#6  = #5#6;   #4#7  = #5#7;
      #4#8  = #5#8;   #4#9  = #5#9;   #4#10 = #5#10;  #4#11 = #5#11;
      #4#12 = #5#12;  #4#13 = #5#13;  #4#14 = #5#14;  #4#15 = #5#15;
      #4#16 = #5#16;  #4#17 = #5#17;  #4#18 = #5#18;  #4#19 = #5#19;
      #4#20 = #5#20;  #4#21 = #5#21;  #4#22 = #5#22;  #4#23 = #5#23;
      #4#24 = #5#24;  #4#25 = #5#25;  #4#26 = #5#26;  #4#27 = #5#27;
      #4#28 = #5#28;  #4#29 = #5#29;  #4#30 = #5#30;  #4#31 = #5#31;
      #4#32 = #5#32;  #4#33 = #5#33;  #4#34 = #5#34;  #4#35 = #5#35;
      #4#36 = #5#36;  #4#37 = #5#37;  #4#38 = #5#38;  #4#39 = #5#39;
      #4#40 = #5#40;  #4#41 = #5#41;  #4#42 = #5#42;  #4#43 = #5#43;
      #4#44 = #5#44;  #4#45 = #5#45;  #4#46 = #5#46;  #4#47 = #5#47;
      #4#48 = #5#48;  #4#49 = #5#49;  #4#50 = #5#50;  #4#51 = #5#51;
      #4#52 = #5#52;  #4#53 = #5#53;  #4#54 = #5#54;  #4#55 = #5#55;
      #4#56 = #5#56;  #4#57 = #5#57;  #4#58 = #5#58;  #4#59 = #5#59;
      #4#60 = #5#60;  #4#61 = #5#61;
      |GRABA 020#4n;
|FPRC;

|DEFBUCLE tmp_reper;
 #5#1;
 ;
 00, "  ",      0;
 99, "zz", 999999;
 e;
 NULL, tmp_reper1;
|FIN;
|| ------------------------------------------------------------------------

|PROCESO desde_hasta;

  d_cuen = #0#1;  h_cuen = #0#1;      || desde/hasta cuenta
  d_digi = #0#2;  h_digi = #0#2;      || desde/hasta digito
  |HAZ asterisco;

  |SI elsw1 = 0;  |ACABA;  |FINSI;
  nume1 = 99 + elsw1;
  alfa1 = #0#1 % nume1;
  d_cuen = alfa1 + "            ";     d_cuen = d_cuen % 112;
  h_cuen = alfa1 + "999999999999";     h_cuen = h_cuen % 112;
  d_digi = 0;
  h_digi = 9;

|FPRC;

|PROCESO Chequea2;

  ord = #0#15;

  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |INFOR "cacheiva";
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

  tipo = #0#1;
  |ABRE #4;
  |CIERRA #4;
  |DELINDEX #4;

  |ABRE #2;
  |ABRE #4;
  |SI ord = 2; |SELECT #2#4; |FINSI;  || .... Fecha Contable

  |ATRI P;  |PINTA 2138, "<TEMPORAL>";  |ATRI 0;
  |HAZ desde_hasta;
  |SI #0#11 = "R";  |BUCLE tmp_reper;  |FINSI;
  |SI #0#11 = "S";  |BUCLE tmp_sopor;  |FINSI;
  |SI #0#3 = "D";  des_signo = "D";  has_signo = "D";  |FINSI;
  |SI #0#3 = "H";  des_signo = "H";  has_signo = "H";  |FINSI;
  |SI #0#3 = "A";  des_signo = " ";  has_signo = "z";  |FINSI;

  primero = 0;
  |PARA dia = #0#12; |SI dia [ #0#13; |HACIENDO dia = dia + 1;
        |ATRI I;  |PINTA 2138, dia;  |ATRI 0;
        fec_ant = "01.01.0001";
        sw_eof = 0;
        |BUCLE apuntes;
        sw_eof = 1;
        sw_ruptura = 1;        || no imprime datos del apunte en informe
        |HAZ ruptura;
        sw_ruptura = 0;
  |SIGUE;
  |PIEINF;
  |FININF;
  |CIERRA #2;
  |CIERRA #4;

  |DELINDEX #4;
  |FINIMP;
|FPRC;

|PROCESO ruptura;
  |SI fec_ant = "01.01.0001";   || si no hay apuntes
      |HAZ ivas0;               || se situa en el iva
  |FINSI;

  FEstado = 0;
  |SI ord = 1; #4#3  = dia; |FINSI;
  |SI ord = 2; #4#46 = dia; |FINSI;
  |SI ord = 1;
     |PARA; |SI FEstado = 0; |Y #4#3 [ dia;  |HACIENDO;
            |HAZ ivas1;               || sigue imprimiendo ivas
     |SIGUE;
  |SINO;
     |PARA; |SI FEstado = 0; |Y #4#46 [ dia;  |HACIENDO;
            |HAZ ivas1;               || sigue imprimiendo ivas
     |SIGUE;
  |FINSI;
  |SI acui ! 0; |O acua ! 0;
      |HAZ tot_fecha;           || totaliza
  |FINSI;
|FPRC;

||****************************************************************************
||****************************************************************************
||****************************************************************************
||****************************************************************************
||****************************************************************************
||****************************************************************************

|FICHEROS;
   catmpapu #100;
   catmpiva #101;
|FIN;

|VARIABLES;
   Cont1 = 0;
   SwLibro = 0;
   SwFecha = 0;

   First = 0;

   Comodin  = "";
   Comodin1 = "";

   Calc = 0;

   CuotaIva = 0;
   CuotaRec = 0;

   &SubTotAp = 0;
   &SubTotLi = 0;

   &FechaAnt = @;
   &SwApunte = 0;
   &SwLinea = 0;
   &nImporte = 0;
   &MarcaDif = "  ";

   DSigno = "";
   HSigno = "";
   nBusco = 0;
   nApunte = 0;
|FIN;

|| **************************************************************************
|PROCESO Encuentra;
 nBusco  = 1;
 nApunte = #catmpapu#3;
|FPRC;

|DEFBUCLE BuscaSop;
 #catmpapu#1;
 4,5,6;
 #6#46,#6#45,#6#47,0001,#6#0,#6#27,#6#2;
 #6#46,#6#45,#6#47,9999,#6#0,#6#27,#6#2;
 ;
 NULL, Encuentra;
|FIN;

|DEFBUCLE BuscaRep;
 #catmpapu#1;
 4,6,5;
 #5#46,#5#45,#5#47, 0001, #5#0,#5#2,#5#27;
 #5#46,#5#45,#5#47, 9999, #5#0,#5#2,#5#27;
 ;
 NULL, Encuentra;
|FIN;

|PROCESO CreaTempo22;

   |SI #0#14 = "2"; |Y #caivasop#23 = "N"; |ACABA; |FINSI;
   |SI #0#14 = "3"; |Y #caivasop#23 = "S"; |ACABA; |FINSI;

   |SI #0#15 = 1;
      |SI #caivasop#3 < #0#12; |O #caivasop#3 > #0#13; |ACABA; |FINSI;
   |FINSI;
   |SI #0#15 = 2;
      |SI #caivasop#46 < #0#12; |O #caivasop#46 > #0#13; |ACABA; |FINSI;
   |FINSI;

   CuotaIva = #caivasop#14 + #caivasop#15 + #caivasop#16 + #caivasop#56 + #caivasop#57;
   CuotaRec = #caivasop#20 + #caivasop#21 + #caivasop#22 + #caivasop#60 + #caivasop#61;

   nBusco = 0;
   |BUCLE BuscaSop;
   |SI nBusco = 0;
       |ABRE #catmpapu;
       |DDEFECTO #catmpapu;
       #catmpapu#0 = #caivasop#46;
       #catmpapu#1 = #caivasop#45;
       #catmpapu#2 = #caivasop#47;
       #catmpapu#3 = 9999;
       #catmpapu#4 = #caivasop#0;
       #catmpapu#5 = #caivasop#27;
       #catmpapu#6 = #caivasop#2;
       |SI #0#4 = "1"; #catmpapu#11 = CuotaIva + CuotaRec; |FINSI;
       |SI #0#4 = "2"; #catmpapu#11 = CuotaIva;            |FINSI;
       |SI #0#4 = "3"; #catmpapu#11 = CuotaRec;            |FINSI;
       |GRABA 020#catmpapu.n;
       |CIERRA #catmpapu;
       nApunte = 9999;
   |FINSI;

   |DDEFECTO #catmpiva;
   #catmpiva#0 = #caivasop#3;
   #catmpiva#1 = #caivasop#0;
   #catmpiva#2 = #caivasop#27;
   #catmpiva#3 = #caivasop#2;
   #catmpiva#4 = #caivasop#45;
   #catmpiva#5 = #caivasop#46;
   #catmpiva#6 = #caivasop#47;
   #catmpiva#7 = #caivasop#7;
   |SI #0#4 = "1"; #catmpiva#8 = CuotaIva + CuotaRec; |FINSI;
   |SI #0#4 = "2"; #catmpiva#8 = CuotaIva;            |FINSI;
   |SI #0#4 = "3"; #catmpiva#8 = CuotaRec;            |FINSI;

   #catmpiva#9  = #caivasop#8;         || Base 1
   #catmpiva#10 = #caivasop#9;         || Base 2
   #catmpiva#11 = #caivasop#10;        || Base 3
   #catmpiva#12 = #caivasop#52;        || Base 4
   #catmpiva#13 = #caivasop#53;        || Base 5
   #catmpiva#14 = #caivasop#14;        || IVA 1
   #catmpiva#15 = #caivasop#15;        || IVA 2
   #catmpiva#16 = #caivasop#16;        || IVA 3
   #catmpiva#17 = #caivasop#56;        || IVA 4
   #catmpiva#18 = #caivasop#57;        || IVA 5
   #catmpiva#19 = #caivasop#20;        || REC 1
   #catmpiva#20 = #caivasop#21;        || REC 2
   #catmpiva#21 = #caivasop#22;        || REC 3
   #catmpiva#22 = #caivasop#60;        || REC 4
   #catmpiva#23 = #caivasop#61;        || REC 5
   #catmpiva#24 = nApunte;         || Apunte
   |GRABA 020#catmpiva.n;
|FPRC;

|DEFBUCLE CreaTempo22;
 #caivasop#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,CreaTempo22;
|FIN;

|PROCESO CreaTempo21;

   |SI #0#14 = "2"; |Y #caivarep#23 = "N"; |ACABA; |FINSI;
   |SI #0#14 = "3"; |Y #caivarep#23 = "S"; |ACABA; |FINSI;

   |SI #0#15 = 1;
      |SI #caivarep#3 < #0#12; |O #caivarep#3 > #0#13; |ACABA; |FINSI;
   |FINSI;
   |SI #0#15 = 2;
      |SI #caivarep#46 < #0#12; |O #caivarep#46 > #0#13; |ACABA; |FINSI;
   |FINSI;

   CuotaIva = #caivarep#14 + #caivarep#15 + #caivarep#16 + #caivarep#56 + #caivarep#57;
   CuotaRec = #caivarep#20 + #caivarep#21 + #caivarep#22 + #caivarep#60 + #caivarep#61;

   nBusco = 0;
   |BUCLE BuscaRep;
   |SI nBusco = 0;
       |ABRE #catmpapu;
       |DDEFECTO #catmpapu;
       #catmpapu#0 = #caivarep#46;
       #catmpapu#1 = #caivarep#45;
       #catmpapu#2 = #caivarep#47;
       #catmpapu#3 = 9999;
       #catmpapu#4 = #caivarep#0;
       #catmpapu#5 = #caivarep#27;
       #catmpapu#6 = #caivarep#2;
       |SI #0#4 = "1"; #catmpapu#11 = CuotaIva + CuotaRec; |FINSI;
       |SI #0#4 = "2"; #catmpapu#11 = CuotaIva;            |FINSI;
       |SI #0#4 = "3"; #catmpapu#11 = CuotaRec;            |FINSI;
       |GRABA 020#catmpapu.n;
       |CIERRA #catmpapu;
       nApunte = 9999;
   |FINSI;

   |DDEFECTO #catmpiva;
   #catmpiva#0 = #caivarep#3;
   #catmpiva#1 = #caivarep#0;
   #catmpiva#2 = #caivarep#27;
   #catmpiva#3 = #caivarep#2;
   #catmpiva#4 = #caivarep#45;
   #catmpiva#5 = #caivarep#46;
   #catmpiva#6 = #caivarep#47;
   #catmpiva#7 = #caivarep#7;
   |SI #0#4 = "1"; #catmpiva#8 = CuotaIva + CuotaRec; |FINSI;
   |SI #0#4 = "2"; #catmpiva#8 = CuotaIva;            |FINSI;
   |SI #0#4 = "3"; #catmpiva#8 = CuotaRec;            |FINSI;

   #catmpiva#9  = #caivarep#8;         || Base 1
   #catmpiva#10 = #caivarep#9;         || Base 2
   #catmpiva#11 = #caivarep#10;        || Base 3
   #catmpiva#12 = #caivarep#52;        || Base 4
   #catmpiva#13 = #caivarep#53;        || Base 5
   #catmpiva#14 = #caivarep#14;        || IVA 1
   #catmpiva#15 = #caivarep#15;        || IVA 2
   #catmpiva#16 = #caivarep#16;        || IVA 3
   #catmpiva#17 = #caivarep#56;        || IVA 4
   #catmpiva#18 = #caivarep#57;        || IVA 5
   #catmpiva#19 = #caivarep#20;        || REC 1
   #catmpiva#20 = #caivarep#21;        || REC 2
   #catmpiva#21 = #caivarep#22;        || REC 3
   #catmpiva#22 = #caivarep#60;        || REC 4
   #catmpiva#23 = #caivarep#61;        || REC 5
   #catmpiva#24 = nApunte;             || Apunte
   |GRABA 020#catmpiva.n;
|FPRC;

|DEFBUCLE CreaTempo21;
 #caivarep#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,CreaTempo21;
|FIN;

|| ------------------------------------------------------------------
|PROCESO CreaTempo1;

   CuotaIva = 0;
   CuotaRec = 0;
   |SI #cacheiva#11 = "R";
       #caivarep#27 = #camaasil#15;
       #caivarep#0  = #camaasil#13;
       #caivarep#2  = #camaasil#14;
       |LEE 010#caivarep.=;
       |SI FSalida ! 0;
           #catmpiva#1 = #camaasil#13;
           #catmpiva#2 = #camaasil#15;
           #catmpiva#3 = #camaasil#14;
           |LEE 010#catmpiva.=;
           |SI FSalida ! 0;
               |DDEFECTO #catmpiva;
               #catmpiva#0 = #camaasil#1;
               #catmpiva#1 = #camaasil#13;
               #catmpiva#2 = #camaasil#15;
               #catmpiva#3 = #camaasil#14;
               #catmpiva#4 = #camaasil#0;
               #catmpiva#5 = #camaasil#1;
               #catmpiva#6 = #camaasil#2;
               #catmpiva#24 = #camaasil#3;
               |GRABA 020#catmpiva.n;
           |FINSI;
       |SINO;
           CuotaIva = #caivarep#14 + #caivarep#15 + #caivarep#16 + #caivarep#56 + #caivarep#57;
           CuotaRec = #caivarep#20 + #caivarep#21 + #caivarep#22 + #caivarep#60 + #caivarep#61;
       |FINSI;
   |SINO;
      #caivasop#27 = #camaasil#15;
      #caivasop#0  = #camaasil#13;
      #caivasop#2  = #camaasil#14;
      |LEE 010#caivasop.=;
      |SI FSalida ! 0;
          #catmpiva#1 = #camaasil#13;
          #catmpiva#2 = #camaasil#15;
          #catmpiva#3 = #camaasil#14;
          |LEE 010#catmpiva.=;
          |SI FSalida ! 0;
              |DDEFECTO #catmpiva;
              #catmpiva#0 = #camaasil#1;
              #catmpiva#1 = #camaasil#13;
              #catmpiva#2 = #camaasil#15;
              #catmpiva#3 = #camaasil#14;
              #catmpiva#4 = #camaasil#0;
              #catmpiva#5 = #camaasil#1;
              #catmpiva#6 = #camaasil#2;
              #catmpiva#24 = #camaasil#3;
              |GRABA 020#catmpiva.n;
          |FINSI;
       |SINO;
           CuotaIva = #caivasop#14 + #caivasop#15 + #caivasop#16 + #caivasop#56 + #caivasop#57;
           CuotaRec = #caivasop#20 + #caivasop#21 + #caivasop#22 + #caivasop#60 + #caivasop#61;
       |FINSI;
   |FINSI;

   #camaasic#0 = #camaasil#0;
   #camaasic#1 = #camaasil#1;
   #camaasic#2 = #camaasil#2;
   |LEE 010#camaasic.=;
   |SI FSalida = 0;
      |DDEFECTO #catmpapu;
      #catmpapu#0 = #camaasil#1;
      #catmpapu#1 = #camaasil#0;
      #catmpapu#2 = #camaasil#2;
      #catmpapu#3 = #camaasil#3;
      #catmpapu#4 = #camaasil#13;
      #catmpapu#5 = #camaasil#15;
      #catmpapu#6 = #camaasil#14;
      #catmpapu#7 = #camaasil#7;
      #catmpapu#8 = #camaasil#8;
      #catmpapu#9 = #camaasil#9;
      #catmpapu#10 = #camaasil#12;
      #catmpapu#12 = #camaasil#19;
      #catmpapu#13 = #camaasil#20;
      |SI #0#4 = "1"; #catmpapu#11 = CuotaIva + CuotaRec; |FINSI;
      |SI #0#4 = "2"; #catmpapu#11 = CuotaIva;            |FINSI;
      |SI #0#4 = "3"; #catmpapu#11 = CuotaRec;            |FINSI;
      |GRABA 020#catmpapu.n;
   |FINSI;
   |LIBERA #camaasil;

|FPRC;

|DEFBUCLE CreaTempo1;
 #camaasil#1;
 12,8,4;
 00,#0#12,000001,0001,#cacheiva#11,DSigno,d_cuen;
 99,#0#13,999999,9999,#cacheiva#11,HSigno,h_cuen;
 be;
 NULL,CreaTempo1;
|FIN;

|| ................................ Proceso para Imprimir
|PROCESO Imprime;

   |SI SwApunte = 0; SwApunte = 1; |FINSI;
   |SI #cacheiva#11 = "R";
      |SI #catmpapu#8 = "H";
          SubTotAp = SubTotAp + #catmpapu#9;
      |SINO;
          SubTotAp = SubTotAp - #catmpapu#9;
      |FINSI;
   |SINO;
      |SI #catmpapu#8 = "D";
          SubTotAp = SubTotAp + #catmpapu#9;
      |SINO;
          SubTotAp = SubTotAp - #catmpapu#9;
      |FINSI;
   |FINSI;
   |SI SwApunte = 1; SubTotLi = SubTotLi + #catmpapu#11; |FINSI;
   |SI #catmpapu#12 = "B";
      |SI #catmpapu#13 = 0;
         |SI #catmpapu#9 = #catmpiva#9;  nImporte = #catmpiva#9;  |FINSI;
         |SI #catmpapu#9 = #catmpiva#10; nImporte = #catmpiva#10; |FINSI;
         |SI #catmpapu#9 = #catmpiva#11; nImporte = #catmpiva#11; |FINSI;
         |SI #catmpapu#9 = #catmpiva#12; nImporte = #catmpiva#12; |FINSI;
         |SI #catmpapu#9 = #catmpiva#13; nImporte = #catmpiva#13; |FINSI;
      |FINSI;
      |SI #catmpapu#13 = 1; nImporte = #catmpiva#9;  |FINSI;
      |SI #catmpapu#13 = 2; nImporte = #catmpiva#10; |FINSI;
      |SI #catmpapu#13 = 3; nImporte = #catmpiva#11; |FINSI;
      |SI #catmpapu#13 = 4; nImporte = #catmpiva#12; |FINSI;
      |SI #catmpapu#13 = 5; nImporte = #catmpiva#13; |FINSI;
   |FINSI;
   |SI #catmpapu#12 = "I";
      |SI #catmpapu#13 = 0;
         |SI #catmpapu#9 = #catmpiva#14; nImporte = #catmpiva#14; |FINSI;
         |SI #catmpapu#9 = #catmpiva#15; nImporte = #catmpiva#15; |FINSI;
         |SI #catmpapu#9 = #catmpiva#16; nImporte = #catmpiva#16; |FINSI;
         |SI #catmpapu#9 = #catmpiva#17; nImporte = #catmpiva#17; |FINSI;
         |SI #catmpapu#9 = #catmpiva#18; nImporte = #catmpiva#18; |FINSI;
      |FINSI;
      |SI #catmpapu#13 = 1; nImporte = #catmpiva#14; |FINSI;
      |SI #catmpapu#13 = 2; nImporte = #catmpiva#15; |FINSI;
      |SI #catmpapu#13 = 3; nImporte = #catmpiva#16; |FINSI;
      |SI #catmpapu#13 = 4; nImporte = #catmpiva#17; |FINSI;
      |SI #catmpapu#13 = 5; nImporte = #catmpiva#18; |FINSI;
   |FINSI;
   |SI #catmpapu#12 = "R";
      |SI #catmpapu#13 = 0;
         |SI #catmpapu#9 = #catmpiva#19; nImporte = #catmpiva#19; |FINSI;
         |SI #catmpapu#9 = #catmpiva#20; nImporte = #catmpiva#20; |FINSI;
         |SI #catmpapu#9 = #catmpiva#21; nImporte = #catmpiva#21; |FINSI;
         |SI #catmpapu#9 = #catmpiva#22; nImporte = #catmpiva#22; |FINSI;
         |SI #catmpapu#9 = #catmpiva#23; nImporte = #catmpiva#23; |FINSI;
      |FINSI;
      |SI #catmpapu#13 = 1; nImporte = #catmpiva#19;  |FINSI;
      |SI #catmpapu#13 = 2; nImporte = #catmpiva#20; |FINSI;
      |SI #catmpapu#13 = 3; nImporte = #catmpiva#21; |FINSI;
      |SI #catmpapu#13 = 4; nImporte = #catmpiva#22; |FINSI;
      |SI #catmpapu#13 = 5; nImporte = #catmpiva#23; |FINSI;
   |FINSI;

   Signo = 1;
   |SI #catmpapu#12 = "F"; |O #catmpapu#12 = " "; nImporte = #catmpiva#8; |FINSI;
   nImporte = nImporte * Signo;

   |SI nImporte ! #catmpapu#9;
      MarcaDif = "->";
   |SINO;
      MarcaDif = "  ";
   |FINSI;

   |SI #cacheiva#0 = "R"; |PRINT; |FINSI;
|FPRC;

|DEFBUCLE Imprime
 #catmpiva#2;
 24;
 #catmpapu#1,#catmpapu#0,#catmpapu#2,#catmpapu#3;
 #catmpapu#1,#catmpapu#0,#catmpapu#2,#catmpapu#3;
 ;
 NULL,Imprime;
|FIN;

|PROCESO Presenta;

   |ATRI I;
   |PINTA 2138, #catmpapu#0;
   |ATRI N;

   SwLibro = 0;
   |PARA Cont1 = 5; |SI Cont1 [ 21; |HACIENDO Cont1 = Cont1 + 1;
         |SI #0#Cont1# = #catmpapu#4; SwLibro = 1; |SAL; |FINSI;
         |SI Cont1 = 10; Cont1 = 15; |FINSI;
   |SIGUE;

   |SI SwLibro = 0; |O #catmpapu#4 = 0; |ACABA; |FINSI;

   |SI FechaAnt = "01.01.1900";
       FechaAnt = #catmpapu#0;
   |SINO;
      |SI FechaAnt ! #catmpapu#0;
          SwLinea = 1;
          |SI SubTotAp ! 0; |O SubTotLi ! 0;
              |PRINT;
          |FINSI;
          SwLinea = 0;
          FechaAnt = #catmpapu#0;
          SubTotAp = 0;
          SubTotLi = 0;
      |FINSI;
   |FINSI;

   || SI #catmpapu#9 ! #catmpapu#11; First = 1; |BUCLE Imprime; |FINSI;
   SwApunte = 0;
   |SI #catmpapu#9 ! #catmpapu#11; First = 1; |FINSI;
   |BUCLE Imprime;
   |SI SwApunte = 0;
       SwApunte = 2;
       |DDEFECTO #catmpiva;
       |HAZ Imprime;
   |FINSI;
|FPRC;

|DEFBUCLE Presenta;
 #catmpapu#1;
 ;
 #0#12,00,000001,0001;
 #0#13,99,999999,9999;
 ;
 NULL,Presenta;
|FIN;
|| :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

|PROCESO Chequea1;

   Comodin = #0#1;
   Comodin = Comodin - "*";
   |SI FSalida ! 0;
      Calc = ((FSalida / 100) ! 0) + 99;
      Comodin = Comodin % Calc;
   |SINO;
      Calc = 0;
   |FINSI;
   |QBF Comodin;
   |HAZ desde_hasta;

   |DELINDEX #catmpapu;
   |DELINDEX #catmpiva;

   |IMPRE 0;
   |SI FSalida < 0; |ACABA; |FINSI;

   |INFOR "cacheiv1";
   |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

   tipo = #0#1;
   |ATRI I;
   |PINTA 2138, "<TEMPORALES>";
   |ATRI N;

   |SI #0#3 = "D"; DSigno = "D"; HSigno = "D"; |FINSI;
   |SI #0#3 = "H"; DSigno = "H"; HSigno = "H"; |FINSI;
   |SI #0#3 = "A"; DSigno = "D"; HSigno = "H"; |FINSI;

   |ABRE #catmpapu;
   |ABRE #catmpiva;
   |ABRE #caivarep;
   |ABRE #caivasop;
   |ABRE #camaasic;
   |BUCLE CreaTempo1;     || Creo los temporales
   |CIERRA #camaasic;
   |CIERRA #caivasop;
   |CIERRA #caivarep;
   |CIERRA #catmpapu;

   |SI #0#11 = "R"; |BUCLE CreaTempo21; |FINSI;
   |SI #0#11 = "S"; |BUCLE CreaTempo22; |FINSI;

   |CIERRA #catmpiva;

   || Ahora hago el bucle de los asientos

   |ATRI I;
   |PINTA 2138, "            ";
   |ATRI N;
   FechaAnt = "01.01.1900";
   |BUCLE Presenta;

   SwLinea = 1;
   |PRINT;

   |PIEINF;
   |FININF;
   |FINIMP;
|FPRC;


|PROCESO Chequea; |TIPO 3;
   |MENU Menu;
   Opcion = FSalida;
   |SI Opcion < 1; |O Opcion > 2; |ACABA; |FINSI;
   |SI Opcion = 1; |HAZ Chequea1; |FINSI;
   |SI Opcion = 2; |HAZ Chequea2; |FINSI;
|FPRC;
