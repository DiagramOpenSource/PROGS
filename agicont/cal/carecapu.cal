|FICHEROS;
    carecapu #0;
    caivarep #1;    || iva repercutido
    camaasic #2;    || apuntes cabs.
    camaasil #3;    || apuntes lins.
    caivasop #4;    || iva soportado
|FIN;

|VARIABLES;
    &enDiario   = 0;
    &enContador = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    sw_docum = 0;
    doce = "            ";
    ult_apunt = 0;
    fecha = @;
    signe = "";
    impor = 0;
    conte = "";
    digcu = 0;
    conce = 0;
    descr = "";
    departam = "";
    tip_acum = "";
    num_acum = "";
    tipos = "";
    libro = 0;
    orden = 0;
    serie = "";
    docum = 0;
    c_impor = 0;
    c_cuent = 0;

    Comodin = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE actcta_i;
|INCLUYE actudi_i;
|INCLUYE condes_i;

____________________________________/ CALCULOS DESDE PANTALLA
|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO def_fec; |TIPO 7;
    #0#0 = fec1;    |PINTA #0#0;
    #0#1 = fec2;    |PINTA #0#1;
|FPRC;

|PROCESO def_doc; |TIPO 7;
|SI sw_docum = 0;
        sw_docum = 1;
    enDiario = #0#2;
    |HAZ contador;
    #0#3 = enContador;    |PINTA #0#3;
|FINSI;
|FPRC;

|PROCESO lee_cuenta; |TIPO 0;
|SI #0Campo ! "            ";
        p_alfa1 = #0Campo;
    |HAZ punto;
    |DDEFECTO #5;
    |ABRE #5;
        #5#0 = #0Campo;
        #5#1 = dig3;
    |LEE 000#5=;
    |SI FSalida ! 0;
        |MENAV "    Cuenta Inexistente ...";
        |ERROR;
    |SINO;
        |SI #5#3 ! "S";
            |MENAV "    Cuenta de pase directo NO ...";
            |ERROR;
        |FINSI;
    |FINSI;
    |ATRI I;   |PINTA 2207, #5#2;  |ATRI 0;
    |CIERRA #5;
|FINSI;
|FPRC;
____________________________________/ GRABACION DE APUNTES
|PROCESO apuntes;
|SI impor ! 0;|Y conte ! doce;|Y digcu ! 0;
    |DDEFECTO #3;
        #3#00 = #0#2;       || diario
        #3#01 = fecha;      || fecha
        #3#02 = docum;      || documento
        #3#03 = ult_apunt;  || apunte
        #3#04 = conte;      || cuenta
        #3#05 = digcu;      || digito cuenta
        #3#06 = conce;      || concepto
        #3#07 = descr;      || descripcion
        enNumCon = #3#6; |HAZ VerConcepto; #3#24 = eaDesCon;
        #3#08 = signe;      || signo
        #3#09 = impor;      || importe
    |SI #3#08 = "D";
            #3#16 = #3#4;
            #3#17 = #3#5;
    |SINO;
            #3#10 = #3#4;
            #3#11 = #3#5;
    |FINSI;
        #3#12 = tipos;        || cobros/pagos
        #3#13 = libro;        || libro
        #3#14 = orden;        || orden
        #3#15 = serie;        || serie
        #3#19 = tip_acum;     || tipo acumulador
        #3#20 = num_acum;     || numero acumulador
    |GRABA 020#3n;
    |HAZ cabecera;
        ressum = #3#9;
    |HAZ actualiz1;     || actualiza cuentas
        opera = "A";
    |HAZ altatra;       || actualiza niveles inferiores
        d_diari = #3#0;
        d_opera = #3#8;
        d_impor = #3#9;
    |HAZ actu_diari;    || actualiza diario
        ult_apunt = ult_apunt + 10;
|FINSI;
|FPRC;

|PROCESO cabecera;
|DDEFECTO #2;
    #2#0 = #3#0;
    #2#1 = #3#1;
    #2#2 = #3#2;
|LEE 101#2=;
    FEstado = FSalida;
    #2#0 = #3#0;         || diario
    #2#1 = #3#1;         || fecha
    #2#2 = #3#2;         || documento
    #2#3 = #2#2;         || asiento
|SI #3#8 = "D";
        #2#4 = #2#4 + #3#9;
    |SI #2#09 = 0; #2#08 = #3#4; #2#09 = #3#5; |FINSI;      || contrp.HABER
|FINSI;
|SI #3#8 = "H";
        #2#5 = #2#5 + #3#9;
    |SI #2#11 = 0; #2#10 = #3#4; #2#11 = #3#5; |FINSI;      || contrp.DEBE
|FINSI;
|SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
|SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
|LIBERA #2;
|FPRC;
____________________________________/ IVA REPERCUTIDO
|PROCESO pasando;
|SI #0#20 = "R";
        fecha = #1#3;         || fecha
        signe = "H";          || signo
        impor = #1c_impor;    || importe
        conte = #0c_cuent;    || cuenta
        digcu = dig3;         || digito
        conce = #1#6;         || concepto
        descr = #1#7;         || descripcion
        tipos = "R";          || tipo iva
        libro = #1#0;         || libro
        orden = #1#2;         || orden
        serie = #1#27;        || serie
|SINO;
        fecha = #4#3;         || fecha
        signe = "D";          || signo
        impor = #4c_impor;    || importe
        conte = #0c_cuent;    || cuenta
        digcu = dig3;         || digito
        conce = #4#6;         || concepto
        descr = #4#7;         || descripcion
        tipos = "S";          || tipo iva
        libro = #4#0;         || libro
        orden = #4#2;         || orden
        serie = #4#27;        || serie
|FINSI;
|HAZ apuntes;
|FPRC;

|PROCESO saldando;
|SI #0#20 = "R";
        fecha = #1#3;         || fecha
        signe = "D";          || signo
        impor = #1#26;        || importe
        conte = #1#4;         || cuenta
        digcu = #1#5;         || digito
        conce = #1#6;         || concepto
        descr = #1#7;         || descripcion
        tipos = "R";          || tipo iva
        libro = #1#0;         || libro
        orden = #1#2;         || orden
        serie = #1#27;        || serie
|SINO;
        fecha = #4#3;         || fecha
        signe = "H";          || signo
        impor = #4#26;        || importe
        conte = #4#4;         || cuenta
        digcu = #4#5;         || digito
        conce = #4#6;         || concepto
        descr = #4#7;         || descripcion
        tipos = "S";          || tipo iva
        libro = #4#0;         || libro
        orden = #4#2;         || orden
        serie = #4#27;        || serie
|FINSI;
|HAZ apuntes;
|FPRC;

|PROCESO leyendo;
    ult_apunt = 1;
    docum = docum + 1;

    tip_acum = "F";  num_acum = 0;
|HAZ saldando;                                         || cliente/proveedor

    tip_acum = "B";      || tipo acumulador
    c_impor =  8;   c_cuent =  4;  num_acum = 1;  |HAZ pasando;
    c_impor =  9;   c_cuent =  5;  num_acum = 2;  |HAZ pasando;
    c_impor = 10;   c_cuent =  6;  num_acum = 3;  |HAZ pasando;  || bases
    c_impor = 52;   c_cuent =  7;  num_acum = 4;  |HAZ pasando;
    c_impor = 53;   c_cuent =  8;  num_acum = 5;  |HAZ pasando;

    tip_acum = "I";      || tipo acumulador
    c_impor = 14;   c_cuent =  9;  num_acum = 1;  |HAZ pasando;
    c_impor = 15;   c_cuent = 10;  num_acum = 2;  |HAZ pasando;
    c_impor = 16;   c_cuent = 11;  num_acum = 3;  |HAZ pasando;  || iva
    c_impor = 56;   c_cuent = 12;  num_acum = 4;  |HAZ pasando;
    c_impor = 57;   c_cuent = 13;  num_acum = 5;  |HAZ pasando;

    tip_acum = "R";      || tipo acumulador
    c_impor = 20;   c_cuent = 14;  num_acum = 1;  |HAZ pasando;
    c_impor = 21;   c_cuent = 15;  num_acum = 2;  |HAZ pasando;
    c_impor = 22;   c_cuent = 16;  num_acum = 3;  |HAZ pasando;  || recargo
    c_impor = 60;   c_cuent = 17;  num_acum = 4;  |HAZ pasando;
    c_impor = 61;   c_cuent = 18;  num_acum = 5;  |HAZ pasando;

|FPRC;

|PROCESO lee_sopor1;
|ATRI I;
    alfa1 = #4#0;   alfa1 = ("00" + alfa1) % -102;     |PINTA 2248, alfa1;
    alfa1 = #4#2;   alfa1 = ("000000" + alfa1) % -106; |PINTA 2251, alfa1;
|ATRI 0;

|HAZ leyendo;
    #4#45 = #0#2;
    #4#46 = #4#3;
    #4#47 = docum;
|GRABA 020#4a;
|LIBERA #4;
|FPRC;

|DEFBUCLE lee_sopor;
 #4#1;
 3;
 #0#21, "  ",      0, #0#0;
 #0#22, "zz", 999999, #0#1;
 be;
 NULL, lee_sopor1;
|FIN;

|PROCESO lee_reper1;
|ATRI I;
    alfa1 = #1#0;   alfa1 = ("00" + alfa1) % -102;     |PINTA 2248, alfa1;
    alfa1 = #1#2;   alfa1 = ("000000" + alfa1) % -106; |PINTA 2251, alfa1;
    alfa1 = #1#27;                                     |PINTA 2258, alfa1;
|ATRI 0;

|HAZ leyendo;
    #1#45 = #0#2;
    #1#46 = #1#3;
    #1#47 = docum;
|GRABA 020#1a;
|LIBERA #1;
|FPRC;

|DEFBUCLE lee_reper;
 #1#1;
 3;
 #0#21, "  ",      0, #0#0;
 #0#22, "zz", 999999, #0#1;
 be;
 NULL, lee_reper1;
|FIN;
____________________________________/ CALCULO PRINCIPAL
|PROCESO inicio_mayor;
|DDEFECTO #8;
|ABRE #8;
|LEE 101#8u;
|SI FSalida ! 0;
        #8#0 = 1;
|SINO;
        #8#0 = #8#0 + 1;
|FINSI;
|GRABA 000#8n;
    codcon = #8#0;
|LIBERA #8;
|CIERRA #8;
|FPRC;

|PROCESO actua_mayor;
|SI modcon = 0;
    |ABRE #8;
    |DDEFECTO #8;
        #8#0 = codcon;
    |LEE 000#8=;
    |SI FSalida = 0;     |BORRA 020#8a;     |FINSI;
    |CIERRA #8;
|SINO;
    enContador = docum;
    enDiario   = #0#2;
    |HAZ GrabaContador;

    |CORRE "camaapua.run"
|FINSI;
|FPRC;

|PROCESO tipo3; |TIPO 3;
|SI #0#19 = "SI";
        docum = #0#3 - 1;
    |HAZ inicio_mayor;
    |ABRE #2;
    |ABRE #3;
    |SI #0#20 = "R";
        |BUCLE lee_reper;
    |SINO;
        |BUCLE lee_sopor;
    |FINSI;
    |CIERRA #2;
    |CIERRA #3;
    |HAZ actua_mayor;
|FINSI;
|FPRC;
