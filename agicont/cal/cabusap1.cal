
 *** LLAMADO POR 'cabusapu' ***
 (esta aqui por el MANTE, ya que da errores de PROCESOS duplicados)

|FICHEROS;
     cabusap1 #0;
     camaasic #1,MANTE;
     cabusap2 #2,MANTE;
     cacuenta #3;
|FIN;

|VARIABLES;
     &tipo     = "";
     &pag      = "";
     &ant_dia  = 0;
     param     = "";
     i         = 0;
     salida    = 0;
     inform1   = "cabusapu";
     inform2   = "cabusap1";
     informe   = "";
     cuenta    = "";
     fichero   = "";
     dfecha    = "31.12.9999";
     hfecha    = "01.01.0000";
     dig       = 0;
     debe      = 0;
     haber     = 0;
     saldo     = 0;
|FIN;

|INCLUYE acces5_i;

|PROCESO cabusapI;
     |SI cuenta ! ""; |Y cuenta ! #0#4; |Y pag ! "2";
          |PIEINF;
     |FINSI;
     |PRINT;
     cuenta = #0#4;
|FPRC;

|DEFBUCLE cabusapI;
     #0#2;
     ;
     "            ", 00, "01.01.0000";
     "zzzzzzzzzzzz", 99, "99.99.9999";
     ;
     NULL, cabusapI;
|FIN;

|PROCESO impresora;
     |IMPRE #0;
     |SI FSalida = 0;
          |SI pag ! "2";
               informe = inform1;
          |SINO;
               informe = inform2;
          |FINSI;
          |INFOR informe;
          |SI FSalida = 0;
               |BUCLE cabusapI;
               |PIEINF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
-------------------------------------------------
|PROCESO tecla; |TIPO 11;
     salida = FSalida;
     |SI salida = 10;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
          |PUSHV 0501 2380;
          |PINPA #0#1;
          |ABRE #1;
          #1#0 = #2#0;
          #1#1 = #2#1;
          #1#2 = #2#2;
          |LEE 000#1=;
          ant_dia = #2#0;
          |CONSULTA #0#1;
          |CIERRA #1;
          |POPV;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO inf;
     #2#0 = 00;
     #2#1 = "01.01.0000";
     #2#2 = 000001;
     #2#3 = 0001;
|FPRC;

|PROCESO sup;
     #2#0 = 99;
     #2#1 = "31.12.9999";
     #2#2 = 999999;
     #2#3 = 9999;
|FPRC;

|PROCESO Pantalla;
     |DDEFECTO #3;
     #3#0 = cuenta;
     #3#1 = dig;
     |LEE 000#3=;
     |ATRI I;
     |PINTA 0704, cuenta;
     |PINTA 0720, #3#2;
     |PINTA 0755, dfecha;
     |PINTA 0766, hfecha;
     |ATRI 0;
     |MENSA "2400 [ESC] Cuenta siguiente     [CTRL+C] Acabar";
     |ENTLINEAL #1#2, 1, 4, 21, 0, inf, sup;
     |CIERRA #2;
     |DELINDEX #2;
     |ABRE #2;
     dfecha    = "31.12.9999";
     hfecha    = "01.01.0000";
     debe      = 0;
     haber     = 0;
     saldo     = 0;
|FPRC;

|PROCESO cabusap1;
     |SI cuenta ! ""; |Y cuenta ! #0#4; |Y pag ! "2";
          |HAZ Pantalla;
     |FINSI;
     |PARA i = 0; |SI i [ 24; |HACIENDO i = i + 1;
          #2i = #0i;
     |SIGUE;
     cuenta = #0#4;
     dig = #0#5;
     |SI #0#1 < dfecha; dfecha = #0#1; |FINSI;
     |SI #0#1 > hfecha; hfecha = #0#1; |FINSI;
     debe  = 0;
     haber = 0;
     |SI #0#8 = "D";
          debe = #0#9;
          saldo = saldo + #0#9;
     |SINO;
          haber = #0#9;
          saldo = saldo - #0#9;
     |FINSI;
     #2#25 = debe;
     #2#26 = haber;
     #2#27 = saldo;
     |GRABA 021#2n;
     |SI salida = 7; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE cabusap1;
     #0#2;
     ;
     "            ", 00, "01.01.0000";
     "zzzzzzzzzzzz", 99, "99.99.9999";
     ;
     NULL, cabusap1;
|FIN;

|PROGRAMA;
     param = PARAMETRO; |QBF param;
     |NOME_DAT #0 param;
     |HAZ inicio5;
     |SI tipo = 2;
          |HAZ impresora;
     |SINO;
          |CLS;
          |CABEZA "Busqueda de Apuntes";
          |PINPA #0#2;
          fichero  = Usuario; |QBF fichero;
          fichero = "1" + fichero;
          |NOME_DAT #2 fichero;
          |DELINDEX #2;
          |ABRE #2; |ABRE #3;
          |BUCLE cabusap1;
          |HAZ Pantalla;
          |CIERRA #2; |CIERRA #3;
          |DELINDEX #2;
     |FINSI;
|FPRO;
