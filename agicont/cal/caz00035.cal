|FICHEROS;
     caz00035 #0;
     refere1@ #999;
     refere2@ #998;
|FIN;

|VARIABLES;
     nHandle         = 0;
     nCampo          = 0;
     nDTexto         = 0;
     nHTexto         = 0;

     aExtension      = "";
     aAplicacion     = "";
     aNombAplica     = "";
     aPathFich       = "";
     aPathDef        = "";
     aDirecBuscar    = "";
     aDirPatrones    = "";
     aFicheroOrigen  = "";
     aQueQuiero      = "";
     aTitulo         = "";
     aDef            = "";
     aFich           = "";
     aInstalar       = "";
     aOrigen         = "";
     aDestino        = "";
     aFichero        = "";
     aAlfa           = "";
     aBase           = "";
     aDirPatron      = "";
     aDExt           = "";
     aHExt           = "";

     &eaPathConta    = "";
     &eaPrograma     = "";
     &eaExtension    = "";
     &eaRenta        = "";
     &enPlan         = 0;
     &enForzar       = 0;
     nEstado         = 0;
     nPara1          = 0;
     nPara2          = 0;
     nNumCampos      = 0;
     nDPlan          = 0;
     nHPlan          = 0;
|FIN;

|PROCESO Mensaje;  |TIPO 7;
     |SI #0#1 = "ca8accaa";
         |MENSA "    Introduzca <1> Instalacion Completa; <2> Solo pat.of.(2008, 2015, 2016, 2018)"
     |FINSI;

     |SI #0#1 = "ca8agmay";  |O #0#1 = "ca8comay"; |O #0#1 = "ca8cumay"; |O #0#1 = "ca8eqmay"; |O #0#1 = "ca8m0010";
         |MENSA "    Introduzca <1> Instalacion Completa; <2> Solo pat.oficiales (0,1,30,31,40,41)"
     |FINSI;

     |SI #0#1 = "ca8m0000";  |O #0#1 = "ca8m0001"; |O #0#1 = "ca8m0002"; |O #0#1 = "ca8m0021"; |O #0#1 = "ca8m0022";
          |O #0#1 = "ca8m0006"; |O #0#1 = "ca8m0007"; |O #0#1 = "ca8mtcol"; |O #0#1 = "ca8mtlin";
         |MENSA "    <1> Inst.Completa; <2> Solo pat.oficiales (0,1,10,30,31,32,40,41,42)";
     |FINSI;
|FPRC;

|PROCESO TInsta;
     |SI #0#5 = "3"; |ERROR; |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |LEE 101#0=;
     |SI #0#4 = "N";
         #0#4 = "S";
     |SINO;
         #0#4 = "N";
     |FINSI;

     |PINTA #0#4;

     |SI #0#1 = "ca8agmay"; |O #0#1 = "ca8comay"; |O #0#1 = "ca8cumay"; |O #0#1 = "ca8eqmay";
           |O #0#1 = "ca8m0000"; |O #0#1 = "ca8m0001"; |O #0#1 = "ca8m0002"; |O #0#1 = "ca8m0010";
              |O #0#1 = "ca8m0021"; |O #0#1 = "ca8m0022"; |O #0#1 = "ca8m0006";
                 |O #0#1 = "ca8m0007"; |O #0#1 = "ca8mtcol"; |O #0#1 = "ca8mtlin";
                    |O #0#1 = "ca8accaa";
         |SI #0#4 = "S";
             |C_M #0#5, 1, "S";

             |ENCAMPO #5#0;

             |C_M #0#5, 1, "N";
         |SINO;
             #0#5 = "";
         |FINSI;
         |PINTA #0#5;
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|PROCESO GrabaLineal;
     aDef = aPathDef + (aFicheroOrigen % 108) + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aQueQuiero = "|TITULO";
     aTitulo    = #999#aQueQuiero#;

     |DESCARGA_DEF #refere1@;

     aInstalar = "S";
     aFich     = aPathFich + (aFicheroOrigen % 108) + ".dat";  |QBT aFich;
     |XABRE "E", aFich, nHandle;
     |SI FSalida ] 0;  |Y enForzar = 0; aInstalar = "N";  |FINSI;

     |DDEFECTO #0;
     #0#0 = (aFicheroOrigen % -103) < "";
     #0#1 = (aFicheroOrigen % 108) < "";
     #0#2 = aTitulo > "";
     #0#3 = aNombAplica;
     #0#4 = aInstalar;

     |SI eaRenta = "soc";
         |SI #0#1 = "soplanca";  |O #0#1 = "soplanli";
             #0#4  = "S";
             #0#5  = "2";
         |FINSI;
     |FINSI;

     |GRABA 020#0n;
     |LIBERA #0;
|FPRC;

|PROCESO b_oficial;
     |BORRA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE b_ca8agmay;
     #999#1003;
     ;
     nPara1, " ", 00;
     nPara1, "z", 99;
     be;
     NULL, b_oficial;
|FIN;

|DEFBUCLE b_ca8xxmay;  ||numero balance + cta
     #999#1002;
     ;
     nPara1, "     ";
     nPara1, "zzzzz";
     be;
     NULL, b_oficial;
|FIN;

|DEFBUCLE b_ca8cumay;  ||numero balance + cta
     #999#1003;
     ;
     nDPlan, nPara1, "     ";
     nHPlan, nPara1, "zzzzz";
     be;
     NULL, b_oficial;
|FIN;

|DEFBUCLE b_ca8m0001;
     #999#1010;
     ;
     nDPlan, nPara1, 0, 0, " ", 00, 0, 00, 00, 0;
     nHPlan, nPara1, 9, 9, "z", 99, 9, 99, 99, 9;
     be;
     NULL, b_oficial;
|FIN;

|DEFBUCLE b_ca8m0002;
     #999#1011;
     ;
     nDPlan, nPara1, 0, 0, " ", 00, 0, 00, 00, 0, 001;
     nHPlan, nPara1, 9, 9, "z", 99, 9, 99, 99, 9, 999;
     be;
     NULL, b_oficial;
|FIN;

|PROCESO Grabaca8agmay;
     #999#3 = #998#3;
     #999#0 = #998#0;
     #999#1 = #998#1;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8agmay;
     #998#1003;
     ;
     nPara1, " ", 00;
     nPara1, "z", 99;
     ;
     NULL, Grabaca8agmay;
|FIN;

|PROCESO Grabaca8titulo;
     |ABRE #998;
     #998#0 = nPara1;
     |LEE 001#998=;
     |SI FSalida = 0;
         #999#0 = #998#0;
         |LEE 101#999=;
         nEstado = FSalida;
         #999#0  = #998#0;
         #999#1  = #998#1;
         #999#2  = #998#2;
         #999#3  = #998#3;
         |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
         |SI nEstado = 0; |GRABA 020#999a; |FINSI;
         |LIBERA #999;
    |FINSI;
    |CIERRA #998;
|FPRC;

|PROCESO Grabaca8cumay;
     #999#12 = #998#12;
     #999#10 = #998#10;
     #999#0  = #998#0;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#12 = #998#12;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     #999#5  = #998#5;
     #999#6  = #998#6;
     #999#7  = #998#7;
     #999#8  = #998#8;
     #999#9  = #998#9;
     #999#10 = #998#10;
     #999#11 = #998#11;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8cumay;
     #998#1003;
     ;
     nDPlan, nPara1, "     ";
     nHPlan, nPara1, "zzzzz";
     ;
     NULL, Grabaca8cumay;
|FIN;

|PROCESO Grabaca8m0010;
     #999#5 = #998#5;
     #999#0 = #998#0;
     #999#1 = #998#1;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#5 = #998#5;
     #999#0 = #998#0;
     #999#1 = #998#1;
     #999#2 = #998#2;
     #999#3 = #998#3;
     #999#4 = #998#4;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8m0010;
     #998#1003;
     ;
     nDPlan, nPara1, "     ";
     nHPlan, nPara1, "zzzzz";
     ;
     NULL, Grabaca8m0010;
|FIN;

|PROCESO Grabaca8xxmay;
     #999#0 = #998#0;
     #999#1 = #998#1;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8xxmay;
     #998#1002;
     ;
     nPara1, "     ";
     nPara1, "zzzzz";
     ;
     NULL, Grabaca8xxmay;
|FIN;

|PROCESO Grabaca8m0001;
     #999#14 = #998#14;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     #999#5  = #998#5;
     #999#6  = #998#6;
     #999#7  = #998#7;
     #999#10 = #998#10;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#14 = #998#14;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     #999#5  = #998#5;
     #999#6  = #998#6;
     #999#7  = #998#7;
     #999#8  = #998#8;
     #999#9  = #998#9;
     #999#10 = #998#10;
     #999#11 = #998#11;
     #999#12 = #998#12;
     #999#13 = #998#13;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8m0001;
     #998#1010;
     ;
     nDPlan, nPara1, 0, 0, " ", 00, 0, 00, 00, 0;
     nHPlan, nPara1, 9, 9, "z", 99, 9, 99, 99, 9;
     ;
     NULL, Grabaca8m0001;
|FIN;

|PROCESO Grabaca8m0002;
     #999#14 = #998#14;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     #999#5  = #998#5;
     #999#6  = #998#6;
     #999#7  = #998#7;
     #999#12 = #998#12;
     #999#8  = #998#8;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#14 = #998#14;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     #999#5  = #998#5;
     #999#6  = #998#6;
     #999#7  = #998#7;
     #999#8  = #998#8;
     #999#9  = #998#9;
     #999#10 = #998#10;
     #999#11 = #998#11;
     #999#12 = #998#12;
     #999#13 = #998#13;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8m0002;
     #998#1011;
     ;
     nDPlan, nPara1, 0, 0, " ", 00, 0, 00, 00, 0, 001;
     nHPlan, nPara1, 9, 9, "z", 99, 9, 99, 99, 9, 999;
     ;
     NULL, Grabaca8m0002;
|FIN;

|DEFBUCLE b_soda8xxx;
     #999#1003;
     ;
     nDPlan, nPara1, 001;
     nHPlan, nPara1, 999;
     be;
     NULL, b_oficial;
|FIN;

|DEFBUCLE b_soda8m03;
     #999#1005;
     ;
     nDPlan, nPara1, 001, 01, 001;
     nHPlan, nPara1, 999, 99, 999;
     be;
     NULL, b_oficial;
|FIN;

|DEFBUCLE b_soda8tco;
     #999#1003;
     ;
     nDPlan, nPara1, 01;
     nHPlan, nPara1, 99;
     be;
     NULL, b_oficial;
|FIN;

|PROCESO Grabasoda8tco;
     #999#5  = #998#5;
     #999#0  = #998#0;
     #999#1  = #998#1;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#5  = #998#5;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE soda8tco;
     #998#1003;
     ;
     nDPlan, nPara1, 01;
     nHPlan, nPara1, 99;
     ;
     NULL, Grabasoda8tco;
|FIN;

|PROCESO Grabasoda8m03;
     #999#7  = #998#7;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#7  = #998#7;
     #999#0  = #998#0;
     #999#1  = #998#1;
     #999#2  = #998#2;
     #999#3  = #998#3;
     #999#4  = #998#4;
     #999#5  = #998#5;
     #999#6  = #998#6;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE soda8m03;
     #998#1005;
     ;
     nDPlan, nPara1, 001, 01, 001;
     nHPlan, nPara1, 999, 99, 999;
     ;
     NULL, Grabasoda8m03;
|FIN;

|PROCESO Grabasoda8xxx;
     #999nNumCampos = #998nNumCampos;
     #999#0  = #998#0;
     #999#1  = #998#1;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#0  = #998#0;
     #999#1  = #998#1;
     |PARA nPara2 = 2; |SI nPara2 [ nNumCampos; |HACIENDO nPara2 = nPara2 + 1;
           #999nPara2  = #998nPara2;
     |SIGUE;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE soda8xxx;
     #998#1003;
     ;
     nDPlan, nPara1, 001;
     nHPlan, nPara1, 999;
     ;
     NULL, Grabasoda8xxx;
|FIN;

|PROCESO ctamayor;
     nDPlan = enPlan;
     nHPlan = enPlan;
     |SI enPlan = 0; |O enPlan = 2999;
         nDPlan = 2008;
         nHPlan = 2018;
     |FINSI;

     aDef = aPathDef + #0#1 + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida = 0;
         |CARGA_DEF aDef, refere2@;
         |SI FSalida = 0;
             aFichero = #0#1 + "." + #0#0;   |QBT aFichero;
             aOrigen  = aDirPatrones + aFichero;
             aFichero = #0#1 + "." + "dat";  |QBT aFichero;
             aDestino = aDirPatrones + aFichero;
             |COPIA_FICHERO aOrigen, aDestino;

             |PATH_DAT #999 aPathFich;
             |PATH_DAT #998 aDirPatrones;

             |PARA nPara1 = 0; |SI nPara1 [ 41; |HACIENDO nPara1 = nPara1 + 1;
                  |SI #0#1 = "ca8agmay"; |BUCLE b_ca8agmay; |FINSI;
                  |SI #0#1 = "ca8cumay"; |BUCLE b_ca8cumay; |FINSI;
                  |SI #0#1 = "ca8eqmay"; |BUCLE b_ca8xxmay; |FINSI;
                  |SI #0#1 = "ca8m0010"; |BUCLE b_ca8cumay; |FINSI;

                  |ABRE #999;
                  |SI #0#1 = "ca8agmay"; |BUCLE ca8agmay; |FINSI;
                  |SI #0#1 = "ca8comay"; |HAZ Grabaca8titulo; |FINSI;
                  |SI #0#1 = "ca8cumay"; |BUCLE ca8cumay; |FINSI;
                  |SI #0#1 = "ca8eqmay"; |BUCLE ca8xxmay; |FINSI;
                  |SI #0#1 = "ca8m0010"; |BUCLE ca8m0010; |FINSI;
                  |CIERRA #999;

                  |SI nPara1 = 1;  nPara1 = 19; |FINSI;
                  |SI nPara1 = 21; nPara1 = 29; |FINSI;
                  |SI nPara1 = 31; nPara1 = 39; |FINSI;
             |SIGUE;

             |DELINDEX #998;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #refere2@;
     |DESCARGA_DEF #refere1@;
|FPRC;

|PROCESO defbalance;
     nDPlan = enPlan;
     nHPlan = enPlan;
     |SI enPlan = 0; |O enPlan = 2999;
         nDPlan = 2008;
         nHPlan = 2018;
     |FINSI;

     aDef = aPathDef + #0#1 + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida = 0;
         |CARGA_DEF aDef, refere2@;
         |SI FSalida = 0;
             aFichero = #0#1 + "." + #0#0;   |QBT aFichero;
             aOrigen  = aDirPatrones + aFichero;
             aFichero = #0#1 + "." + "dat";  |QBT aFichero;
             aDestino = aDirPatrones + aFichero;
             |COPIA_FICHERO aOrigen, aDestino;

             |PATH_DAT #999 aPathFich;
             |PATH_DAT #998 aDirPatrones;

             |PARA nPara1 = 0; |SI nPara1 [ 42; |HACIENDO nPara1 = nPara1 + 1;
                  |SI #0#1 = "ca8m0001"; |O #0#1 = "ca8m0021"; |BUCLE b_ca8m0001; |FINSI;
                  |SI #0#1 = "ca8m0002"; |O #0#1 = "ca8m0022"; |BUCLE b_ca8m0002; |FINSI;
                  |SI #0#1 = "ca8m0006"; |O #0#1 = "ca8mtlin"; |BUCLE b_soda8xxx; |FINSI;
                  |SI #0#1 = "ca8m0007";  |BUCLE b_soda8m03; |FINSI;
                  |SI #0#1 = "ca8mtcol";  |BUCLE b_soda8tco; |FINSI;

                  |ABRE #999;
                  |SI #0#1 = "ca8m0000"; |HAZ Grabaca8titulo; |FINSI;
                  |SI #0#1 = "ca8m0001"; |O #0#1 = "ca8m0021"; |BUCLE ca8m0001; |FINSI;
                  |SI #0#1 = "ca8m0002"; |O #0#1 = "ca8m0022"; |BUCLE ca8m0002; |FINSI;
                  |SI #0#1 = "ca8m0006"; nNumCampos = 34; |BUCLE soda8xxx; |FINSI;
                  |SI #0#1 = "ca8m0007"; |BUCLE soda8m03; |FINSI;
                  |SI #0#1 = "ca8mtcol"; |BUCLE soda8tco; |FINSI;
                  |SI #0#1 = "ca8mtlin"; nNumCampos = 8;  |BUCLE soda8xxx; |FINSI;
                  |CIERRA #999;
                  |SI nPara1 = 1;  nPara1 = 4;  |FINSI;
                  |SI nPara1 = 7;  nPara1 = 9;  |FINSI;
                  |SI nPara1 = 10; nPara1 = 19; |FINSI;
                  |SI nPara1 = 22; nPara1 = 29; |FINSI;
                  |SI nPara1 = 32; nPara1 = 39; |FINSI;
             |SIGUE;

             |DELINDEX #998;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #refere2@;
     |DESCARGA_DEF #refere1@;
|FPRC;

|PROCESO Grabaca8accaa;
     #999#0  = #998#0;
     |LEE 101#999=;
     nEstado = FSalida;
     #999#0  = #998#0;
     #999#1  = #998#1;
     |SI nEstado ! 0; |GRABA 020#999n; |FINSI;
     |SI nEstado = 0; |GRABA 020#999a; |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ca8accaa;
     #998#1001;
     ;
     nDPlan;
     nHPlan;
     ;
     NULL, Grabaca8accaa;
|FIN;

|PROCESO ca8accaa;
     nDPlan = enPlan;
     nHPlan = enPlan;
     |SI enPlan = 0; |O enPlan = 2999;
         nDPlan = 2008;
         nHPlan = 2018;
     |FINSI;

     aDef = aPathDef + #0#1 + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida = 0;
         |CARGA_DEF aDef, refere2@;
         |SI FSalida = 0;
             aFichero = #0#1 + "." + #0#0;   |QBT aFichero;
             aOrigen  = aDirPatrones + aFichero;
             aFichero = #0#1 + "." + "dat";  |QBT aFichero;
             aDestino = aDirPatrones + aFichero;
             |COPIA_FICHERO aOrigen, aDestino;

             |PATH_DAT #999 aPathFich;
             |PATH_DAT #998 aDirPatrones;

             |ABRE #999;
             |BUCLE ca8accaa;
             |CIERRA #999;

             |DELINDEX #998;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #refere2@;
     |DESCARGA_DEF #refere1@;
|FPRC;

|PROCESO CopiaFicheros;

     |SI #0#1 = "ca8accaa";
         |SI enPlan ] 2008; |O #0#5 = "2";
             |HAZ ca8accaa;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #0#1 = "ca8agmay"; |O #0#1 = "ca8comay"; |O #0#1 = "ca8cumay";
        |O  #0#1 = "ca8eqmay"; |O #0#1 = "ca8m0010";
         |SI enPlan ] 2008; |O #0#5 = "2";
             |HAZ ctamayor;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #0#1 = "ca8m0000"; |O #0#1 = "ca8m0001"; |O #0#1 = "ca8m0002";
        |O #0#1 = "ca8m0021"; |O #0#1 = "ca8m0022";
           |O #0#1 = "ca8m0006"; |O #0#1 = "ca8m0007";
              |O #0#1 = "ca8mtcol"; |O #0#1 = "ca8mtlin";

         |SI enPlan ] 2008; |O #0#5 = "2";
             |HAZ defbalance;
             |ACABA;
         |FINSI;
     |FINSI;

     aFichero = #0#1 + "." + "ddx";  |QBT aFichero;
     aDestino = aPathFich    + aFichero;
     |FBORRA aDestino;

     aFichero = #0#1 + "." + "ixx";  |QBT aFichero;
     aDestino = aPathFich    + aFichero;
     |FBORRA aDestino;

     aFichero = #0#1 + "." + #0#0;   |QBT aFichero;
     aOrigen  = aDirPatrones + aFichero;
     aFichero = #0#1 + "." + "dat";  |QBT aFichero;
     aDestino = aPathFich    + aFichero;
     |COPIA_FICHERO aOrigen, aDestino;

     aDef = aPathDef + #0#1 + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en Cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #999 aPathFich;

     |ABRE #999;   |CIERRA #999;

     |DESCARGA_DEF #refere1@;
|FPRC;

|PROCESO Instalar;
     |SI #0#0 = "gen";
         aAplicacion = "agicont";
         aPathDef    = eaPathConta + "def/";
         aPathFich   = eaPathConta + "fich/000000/";
         |HAZ CopiaFicheros;
     |FINSI;
|FPRC;

|DEFBUCLE dspatron;
     #0#1;
     4;
     aDExt, "        ", "S";
     aHExt, "zzzzzzzz", "S";
     ;
     NULL, Instalar;
|FIN;

|RUTINA ClaveBaja0;
     #0#0 = aDExt;
     #0#1 = "        ";
|FRUT;

|RUTINA ClaveAlta0;
     #0#0 = aHExt;
     #0#1 = "zzzzzzzz";
|FRUT;

|PROCESO CogeFicheros;
     aDirecBuscar = aDirPatrones + "*." + aExtension;
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aDirecBuscar - aDirPatrones;

            |HAZ GrabaLineal;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROCESO BorraFicheros;
     aDirecBuscar = aDirPatrones + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aExtension = (aDirecBuscar % -103) > " ";
            |SI aExtension ! "TGZ";  |Y aExtension ! "EXE";
                |FBORRA aDirecBuscar;
            |FINSI;
            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROGRAMA;
     |DBASE aBase;  |QBF aBase;

     eaPathConta = aBase;

     aDirPatron = aBase + "patrones/";
     aFichero   = aDirPatron + "zficcon8.tgz";
     |DESCOMPRIME aFichero;

     aFichero   = aDirPatron + "zficcon8.tar";
     |DETAR aFichero, aDirPatron;

     |FBORRA aFichero;

     |MENSA "     Gestionando Ficheros";

     |DBASS aDirPatrones;  |QBF aDirPatrones;
     aDirPatrones = aDirPatrones + "agicont/patrones/";

     |SI eaPrograma ! "";  |Y eaExtension ! "";
         #0#0 = eaExtension;
         #0#1 = eaPrograma;
         |HAZ Instalar;
         |HAZ BorraFicheros;
         |ACABA;
     |FINSI;

     |ABRE #0;  |CIERRA #0;  |DELINDEX #0;

     |ABRE #0;

     |SI eaPathConta ! "";
         aExtension  = "gen";
         aAplicacion = "agicont";
         aNombAplica = "CONTABILIDAD";

         aPathFich   = eaPathConta + "fich/000000/";
         aPathDef    = eaPathConta + "def/";
         |HAZ CogeFicheros;
     |FINSI;

     |CIERRA #0;

     aDExt = "   ";
     aHExt = "zzz";

     |SI eaExtension = "";
         |ENTLINEAL #1#0, -2, 4, 19, 1, ClaveBaja0, ClaveAlta0;

         |CONFI "0000SDesea Realizar la instalacion en estos momentos : ";
         |SI FSalida = 0;
            |BUCLE dspatron;
         |FINSI;
     |SINO;
         |BUCLE dspatron;
     |FINSI;
     |DELINDEX #0;

     |HAZ BorraFicheros;
|FPRO;
