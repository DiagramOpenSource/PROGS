|FICHEROS;
   caemipds #0;

   caredm01 #1;
   camanpdc #2;
   camanpdl #3;
   camanpag #4;
   camanban #5;
   catmppds #6;

   caclipro #10;
   camanpdl@ #900;
|FIN;

|VARIABLES;

   &Fichero = ""; &Tipo = ""; &Cmp = ""; &CmpNum = 0;
   &eaUsuario = ""; &enImpAnt = 0;  &enImpAct = 0;  &eaDescr = "";
   &eaTipoReg = ""; &eaNumero = ""; &eaTipoOp = "";
   &nDeci_Base = 2; &nDeci_Div = 2; &eaNombre1   = "";
   &aCuenta    = ""; &nNivel = 0;
   &aCuenta1   = "";
   &eaCodigo    = "";
   &eaTipoCod   = "";
   &eaNif       = "";
   &eaNombre    = "";
   &eaDireccion = "";
   &eaDirCobro  = "";
   &eaPoblacion = "";
   &eaProvincia = "";
   &eaCP        = "";
   &eaCP1       = "";
   &eaCP2       = "";
   &eaTelefono  = "";
   &programa    = "";
   &ficcopia    = "";

   aCtaAnt = "";
   aPais = "";
   aResp = "";
   aIp   = "";
   aDestino = "";
   nCont = 0;
   nTotal = 0;

   nNumero = 0;
   nModulo = 0;
   LinPag = 0;
   nCalc  = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   aFinLin = ""; aFinFic = "";
   VAlfa   = "";
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   VAlfa13 = ""; VAlfa14 = ""; VAlfa15 = "";

   Field = ""; Tipo1 = ""; Fecha = ""; Comodin = ""; Comodin1 = "";
   NumDig = 0; Calc = 0;  Handle = 0; aAlfa = ""; aAlfa1 = "";
   aAlfa2 = ""; aAlfa3 = "";

   NumOrd = 0;  TotalOrd = 0;
   NumInd = 0;  TotalInd = 0;
   NumRegs = 0; nPrim   = 0;
   NumDomics = 0;
   EmpreAnt = 0; PerioAnt = 0;
   aDir = ""; aPob = ""; aCP1 = ""; aCP2 = ""; aPrv = ""; aNif = "";

   handle = 0;
   SwEmit  = 0; SwHayNoEmit  = 0; SwHay  = 0;

   &eaOrigen = "";
   &HayConta = 0;
   &Divisa   = "";
   &enEmpCartera = 0; &enEmpGestion = 0; &enBanco = 0;
   &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = "";

   Moneda = "";
   Cambio = 0;
   Redond = 0;
   Prefijo = "";

   fFechaVto = @;
   aBase     = "";
   aMas      = "";
   aPago     = "";

   n870 = 0;

|FIN;

|PROCESO IniVars;
   VAlfa01 = ""; VAlfa02 = ""; VAlfa03 = ""; VAlfa04 = ""; VAlfa05 = ""; VAlfa06 = "";
   VAlfa07 = ""; VAlfa08 = ""; VAlfa09 = ""; VAlfa10 = ""; VAlfa11 = ""; VAlfa12 = "";
   Field = ""; Tipo1 = ""; Fecha = ""; Comodin = "";
   NumDig = 0; Calc = 0;
|FPRC;

|PROCESO Presentador;
   |HAZ IniVars;

   VAlfa01 = Prefijo + "170";
   Field = #caredm01#3;  Tipo1 = "N"; NumDig = 9; |HAZ Formato ; VAlfa02 = Field;
   Field = #caemipds#8;  Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03 = Field;
   Fecha = #caemipds#6;  |HAZ RetocaFecha; VAlfa04 = Fecha;
   VAlfa05 = "      ";
   Field = #caredm01#2; Tipo1 = "A"; NumDig = 40; |HAZ Formato ; VAlfa06 = Field;
   VAlfa07 = " " * 20;
   Field = #caredm01#12; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa08 = Field;
   Field = #caredm01#13; Tipo1 = "N"; NumDig = 4;  |HAZ Formato ; VAlfa09 = Field;
   VAlfa10 = " " * 12;
   Field = #caredm01#19; Tipo1 = "A"; NumDig = 11;  |HAZ Formato ; VAlfa11 = Field;
   VAlfa12 = (" " * 43);
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12;

   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
   n870 = n870 + 1;

   TotalOrd = 0;
   NumOrd = 0;
|FPRC;

|PROCESO Ordenante;
   |HAZ IniVars;

   VAlfa01 = "0359";
   Field = #caredm01#2;  Tipo1 = "A"; NumDig = 9; |HAZ Formato ; VAlfa02  = Field;
   Field = #caemipds#8;  Tipo1 = "N"; NumDig = 3; |HAZ Formato ; VAlfa03  = Field;
   VAlfa04 = " " * 12;
   VAlfa05 = "001";
   Fecha = #caemipds#6;  |HAZ RetocaFecha; VAlfa06 = Fecha;
   VAlfa07 = " " * 9;
   aAlfa = (("0000" + #caredm01#4) % -104) + (("0000" + #caredm01#5) % -104);
   aAlfa = aAlfa + (("00" + #caredm01#22) % -102) + (("0000000000" + #caredm01#6) % -110);
   aAlfa = aAlfa + "142800"; nModulo = 97; |HAZ Modulo; nCalc = aAlfa;
   nCalc = 98 - nCalc;
   VAlfa08 = "ES" + (("00" + nCalc) % -102);
   VAlfa09 = (("0000"       + #caredm01#4)  % -104);
   VAlfa10 = (("0000"       + #caredm01#5)  % -104);
   VAlfa11 = (("00"         + #caredm01#22) % -102);
   VAlfa12 = (("0000000000" + #caredm01#6)  % -110);
   VAlfa13 = " " * 30;

   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = VAlfa   + VAlfa08 + VAlfa09 + VAlfa10 + VAlfa11 + VAlfa12 + VAlfa13;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   TotalInd = 0;
   NumInd = 2;
   NumOrd = NumOrd + 1;
   n870 = n870 + 1;
|FPRC;

|PROCESO TotalProv;
     nTotal = nTotal + #900#7;
|FPRC;

|DEFBUCLE TotalProv;
     #900#3003;
     ;
     #camanpdl#0, #camanpdl#8, #camanpdl#6;
     #camanpdl#0, #camanpdl#8, #camanpdl#6;
     ;
     NULL, TotalProv;
|FIN;

|PROCESO Individual;
   |SI #camanpdl#8 ! aCtaAnt;  |O #camanpdl#6 ! fFechaVto;
      nPrim     = 0;
      aCtaAnt   = #camanpdl#8;
      fFechaVto = #camanpdl#6;
   |FINSI;

   nPrim = nPrim + 1;

   #camanpag#0 = #camanpdl#2;
   #camanpag#1 = #camanpdl#3;
   #camanpag#2 = #camanpdl#4;
   #camanpag#3 = #camanpdl#5;
   |LEE 000#camanpag.=;
   |SI FSalida ! 0; |DDEFECTO #camanpag; |FINSI;

   #caclipro#23 = "P";
   #caclipro#10 = #camanpag#4;
   #caclipro#11 = #camanpag#5;
   |LEE 000#caclipro.=;
   |SI FSalida ! 0;
      |DDEFECTO #caclipro;
   |FINSI;

   aNif = #caclipro#9;
   aDir = #caclipro#2;
   aPob = #caclipro#6;
   aPrv = #caclipro#5;
   aCP1 = #caclipro#3;
   aCP2 = #caclipro#4;
   aPais = "";
   |SI #caclipro#24 = "DE "; aPais = "ALEMANIA    "; |FINSI;
   |SI #caclipro#24 = "AT "; aPais = "AUSTRIA     "; |FINSI;
   |SI #caclipro#24 = "BE "; aPais = "BELGICA     "; |FINSI;
   |SI #caclipro#24 = "CY "; aPais = "CHIPRE      "; |FINSI;
   |SI #caclipro#24 = "DK "; aPais = "DINAMARCA   "; |FINSI;
   |SI #caclipro#24 = "SI "; aPais = "ESLOVENIA   "; |FINSI;
   |SI #caclipro#24 = "EE "; aPais = "ESTONIA     "; |FINSI;
   |SI #caclipro#24 = "FI "; aPais = "FINLANDIA   "; |FINSI;
   |SI #caclipro#24 = "FR "; aPais = "FRANCIA     "; |FINSI;
   |SI #caclipro#24 = "EL "; aPais = "GRECIA      "; |FINSI;
   |SI #caclipro#24 = "GB "; aPais = "GRAN BRETA¥A"; |FINSI;
   |SI #caclipro#24 = "NL "; aPais = "HOLANDA     "; |FINSI;
   |SI #caclipro#24 = "HU "; aPais = "HUNGRIA     "; |FINSI;
   |SI #caclipro#24 = "IT "; aPais = "ITALIA      "; |FINSI;
   |SI #caclipro#24 = "IE "; aPais = "IRLANDA     "; |FINSI;
   |SI #caclipro#24 = "LV "; aPais = "LETONIA     "; |FINSI;
   |SI #caclipro#24 = "LT "; aPais = "LITUANIA    "; |FINSI;
   |SI #caclipro#24 = "LU "; aPais = "LUXEMBURGO  "; |FINSI;
   |SI #caclipro#24 = "MT "; aPais = "MALTA       "; |FINSI;
   |SI #caclipro#24 = "PL "; aPais = "POLONIA     "; |FINSI;
   |SI #caclipro#24 = "PT "; aPais = "PORTUGAL    "; |FINSI;
   |SI #caclipro#24 = "CZ "; aPais = "REP.CHECA   "; |FINSI;
   |SI #caclipro#24 = "SK "; aPais = "REP.ESLOVACA"; |FINSI;
   |SI #caclipro#24 = "CE "; aPais = "SUECIA      "; |FINSI;
   |SI #caclipro#24 = "BG "; aPais = "BULGARIA    "; |FINSI;
   |SI #caclipro#24 = "RO "; aPais = "RUMANIA     "; |FINSI;
   |SI #caclipro#24 = "HR "; aPais = "CROACIA     "; |FINSI;
   |SI aPais = ""; aPais = "ESPA¥A              "; |FINSI;

   Prefijo = "0659";
   Field = #caredm01#2;  Tipo1 = "A"; NumDig = 9; |HAZ Formato; Prefijo = Prefijo + Field;
   Field = #caemipds#8;  Tipo1 = "N"; NumDig = 3; |HAZ Formato; Prefijo = Prefijo + Field;
   Prefijo = Prefijo + ((aNif + (" " * 12)) % 0112);

   |SI nPrim = 1;
      VAlfa01 = "010";
      Field = #caclipro#1; Tipo1 = "A"; NumDig = 40;  |HAZ Formato ; VAlfa02 = Field;
      VAlfa03 = " " * 29;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "011";
      Field = aDir; Tipo1 = "A"; NumDig = 45;  |HAZ Formato ; VAlfa02 = Field;
      VAlfa03 = " " * 24;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "012";
      Field = aCP1; Tipo1 = "N"; NumDig = 2;   |HAZ Formato ; VAlfa02 = Field;
      Field = aCP2; Tipo1 = "N"; NumDig = 3;   |HAZ Formato ; VAlfa03 = Field;
      Field = aPob; Tipo1 = "A"; NumDig = 40;  |HAZ Formato ; VAlfa04 = Field;
      VAlfa05 = " " * 24;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "013";
      Field = aCP1;  Tipo1 = "N"; NumDig = 2;  |HAZ Formato; VAlfa02 = Field;
      Field = aCP2;  Tipo1 = "N"; NumDig = 3;  |HAZ Formato; VAlfa03 = Field;
      VAlfa03 = VAlfa03 + "    ";
      Field = aPrv;  Tipo1 = "A"; NumDig = 30; |HAZ Formato; VAlfa04 = Field;
      Field = aPais; Tipo1 = "A"; NumDig = 20; |HAZ Formato; VAlfa05 = Field;
      VAlfa06 = " " * 10;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      VAlfa01 = "014";
      aAlfa = #caredm01#25; |QBF aAlfa;
      aAlfa = aAlfa + (("0000" + #camanpdc#0) % -104); |QBF aAlfa;
      aAlfa = aAlfa + (("000" + #camanpdl#1) % -103); |QBF aAlfa;
      nModulo = 7; |HAZ Modulo; nCalc = aAlfa; aAlfa = nCalc;

      aPago = (("0000" + #camanpdc#0) % -104) + (("000" + #camanpdl#1) % -103) + aAlfa; |QBF aAlfa;

      Field = aPago;   Tipo1 = "N"; NumDig = 8;  |HAZ Formato; VAlfa02 = Field;
      aAlfa = #camanpdl#6; |QBF aAlfa;
      VAlfa03 = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0704);

      nTotal = 0;

      |DBASE aBase;  |QBF aBase;
      aMas = aBase + "def/camanpdl.mas";
      |CARGA_DEF aMas, camanpdl@;
      |SI FSalida = 0;
          |BUCLE TotalProv;

          |DESCARGA_DEF #camanpdl@;
      |FINSI;

      nCalc = (nTotal * 100) ! 0; aAlfa = nCalc; |QBF aAlfa;
      VAlfa04 = ("000000000000" + aAlfa) % -112;
      VAlfa05 = "0"; || Presentacion
      VAlfa06 = " " * 40;
      VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06;
      VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
      n870 = n870 + 1;

      aDir = ""; aPob = ""; aPrv = ""; aCP1 = ""; aCP2 = ""; aPais = ""; aNif = "";
      nCont = 15;
   |FINSI;

   VAlfa01 = ("000" + nCont) % -103; nCont = nCont + 1;
   Field = aPago; Tipo1 = "N"; NumDig = 8;  |HAZ Formato; VAlfa02 = Field;

   aAlfa = (("00" + #3#2) % -102) + #3#4 + (("000000" + #3#3) % -106) + (("000" + #3#5) % -102);
   Field = aAlfa; Tipo1 = "A"; NumDig = 12; |HAZ Formato; VAlfa03 = Field;

   aAlfa = #camanpag#6; |QBF aAlfa;
   VAlfa04 = (aAlfa % 0102) +(aAlfa % 0402) + (aAlfa % 0704);
   nCalc = #camanpdl#7;
   |SI nCalc < 0;
      nCalc = 0 - nCalc;
      VAlfa06 = "D";
   |SINO;
      VAlfa06 = "H";
   |FINSI;
   nCalc = (nCalc * 100) ! 0; aAlfa = nCalc; |QBF aAlfa;
   VAlfa05 = ("000000000000" + aAlfa) % -112;

   aAlfa = #camanpag#21;  |QBF aAlfa;
   |SI #caredm01#26 = "S";  |Y aAlfa ! "";
       aAlfa = #camanpag#21;
   |SINO;
       aAlfa = (("00" + #3#2) % -102) + #3#4 + (("000000" + #3#3) % -106) + (("000" + #3#5) % -102);
   |FINSI;

   |QBF aAlfa;
   Field = aAlfa; Tipo1 = "A"; NumDig = 28; |HAZ Formato; VAlfa07 = Field;
   VAlfa = Prefijo + VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;

   n870 = n870 + 1;
   TotalInd = TotalInd + #camanpdl#7;
   TotalOrd = TotalOrd + #camanpdl#7;
   NumInd = NumInd + 1;
   NumDomics = NumDomics + 1;

   |SI #camanpdc#8 = "N"; |HAZ ActRecibo; |FINSI;
|FPRC;

|PROCESO TotalGeneral;
   VAlfa01 = "0859";
   Field = #caredm01#2;  Tipo1 = "A"; NumDig = 9;  |HAZ Formato ; VAlfa02  = Field;
   Field = #caemipds#8;  Tipo1 = "N"; NumDig = 3;  |HAZ Formato ; VAlfa03  = Field;
   VAlfa04 = " " * 15;
   nCalc = TotalInd; nCalc = (nCalc * 100) ! 0;
   Field = nCalc;        Tipo1 = "N"; NumDig = 12; |HAZ Formato ; VAlfa05  = Field;
   nCalc = n870 + 1; || Este registro
   Field = nCalc; Tipo1 = "N"; NumDig = 10;|HAZ Formato ; VAlfa06  = Field;
   VAlfa07 = " " * 47;
   VAlfa = VAlfa01 + VAlfa02 + VAlfa03 + VAlfa04 + VAlfa05 + VAlfa06 + VAlfa07;
   VAlfa = Handle + " " + VAlfa + aFinLin; |FGRABA VAlfa;
|FPRC;

|PROCESO ActRecibo;

|FPRC;

|DEFBUCLE Recibos;
     #camanpdl#3;
     ;
     #camanpdc#0, "            ", "01.01.0000";
     #camanpdc#0, "zzzzzzzzzzzz", "31.12.2999";
     ;
     NULL, Individual;
|FIN;

|PROCESO Remesas;

   #camanpdc#0 = #catmppds#0;
   |LEE 101#camanpdc.=;
   |SI FSalida = 0;
      SwEmit = #camanpdc#8;
   |FINSI;

   nPrim = 0; |BUCLE Recibos;

   |SI #camanpdc#8 = "N";
      #camanpdc#8 = "S"; |GRABA 020#camanpdc.a;
   |FINSI;
   |LIBERA #camanpdc;

|FPRC;

|DEFBUCLE Remesas;
#catmppds#1;
;
INICIO;
FINAL;
;
NULL,Remesas;
|FIN;

|PROCESO MiraRemesas;
   SwHay = 1;
   |DDEFECTO #catmppds;
   #catmppds#0 = #camanpdc#0;
   #catmppds#1 = #camanpdc#10;
   #catmppds#2 = #camanpdc#8;
   |SI #catmppds#2 = "N";
      SwHayNoEmit = 1;
   |FINSI;
   |GRABA 020#catmppds.n;
|FPRC;

|DEFBUCLE MiraRemesas;
#camanpdc#1;
1,2;
#0#0,#0#2,#camanban#0;
#0#1,#0#3,#camanban#0;
;
NULL,MiraRemesas;
|FIN;

|RUTINA infw038;
   #catmppds#0 = 00001;
   #catmppds#2 = "N";
|FRUT;

|RUTINA supw038;
   #catmppds#0 = 99999;
   #catmppds#2 = "N";
|FRUT;

|PROCESO Secuencial;
   |DELINDEX #catmppds;
   SwHayNoEmit = 0; SwHay = 0;
   |ABRE #catmppds; |BUCLE MiraRemesas; |CIERRA #catmppds;
   |SI SwHay = 0; |ACABA; |FINSI;

   Comodin1 = ("000" + #camanban#0) % -103;
   Comodin1 = "n6800" + Comodin1 + ".seq";
   |DFICB Comodin;
   eaOrigen = Comodin;
   eaNombre1 = Comodin1;
   Comodin = "wb  " + Comodin + Comodin1;
   |QBF Comodin;
   |FABRE Comodin;
   handle = FSalida;
   |SI FSalida ] 0;
      |ABRE #camanpag; |ABRE #caclipro;
      |ABRE #camanpdc;
      |ABRE #camanpdl;
      |HAZ Ordenante;    NumRegs = NumRegs + 1;
      |BUCLE Remesas;    NumRegs = NumRegs + NumInd;
      |HAZ TotalGeneral; NumRegs = NumRegs + 1;
      #0#9 = NumDomics;
      #0#10 = NumRegs;
      #0#11 = TotalOrd;
      |PINTA #0#9; |PINTA #0#10; |PINTA #0#11;
      |PAUSA;
      |CIERRA #camanpdl;
      |CIERRA #camanpdc;
      |CIERRA #caclipro; |CIERRA #camanpag;
   |FINSI;
   VAlfa = Handle + " " + aFinFic; |FGRABA VAlfa;
   FSalida = handle; |FCIERRA FSalida;

   |DFICB aAlfa2; |QBF aAlfa2;
   Comodin1 = ("000" + #camanban#0) % -103;
   Comodin1 = "n6800" + Comodin1 + ".seq";
   aAlfa2 = aAlfa2 + Comodin1;

   |DFICE aAlfa3; |QBF aAlfa3;
   aAlfa3 = aAlfa3 + Comodin1;
   |COPIA_FICHERO aAlfa2, aAlfa3;

   |HAZ GrabaDiskette

|FPRC;

|DEFBUCLE Secuencial;
#camanban#1;
;
#0#4;
#0#5;
;
NULL,Secuencial;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Emision diskette norma 58";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #caredm01;
      #caredm01#0 = #caemipds#12;
      |LEE 000#caredm01.=;
      |SI FSalida = 0;
         aFinLin = &13 + &10; aFinFic = &0;
      |FINSI;
      |CIERRA #caredm01;

      |BUCLE Secuencial;
   |FINSI;
|FPRO;

|PROCESO RetocaFecha;
   |QBF Fecha;
   Comodin = Fecha % 0102;  || Dia
   Comodin = Comodin + (Fecha % 0402);  || Mes
   Comodin = Comodin + (Fecha % 0902);  || A¤o
   Fecha = Comodin;
|FPRC;

|PROCESO Formato;
   |SI Tipo1 = "I";
      Calc = Field;
      Calc = (Calc * Cambio) ! Redond;
      |SI Moneda = "E"; Calc = Calc * 100; |FINSI;
      Field = Calc;
   |FINSI;
   |SI Tipo1 = "A";
      Comodin = " " * NumDig;
      Comodin = Field + Comodin;
      Calc = 100 + NumDig;
   |SINO;
      Comodin = "0" * NumDig;
      Comodin = Comodin + Field;
      Calc = 0 - (100 + NumDig);
   |FINSI;

   |QBF Field;
   Field = Comodin % Calc;

|FPRC;

|PROCESO Modulo;
   aAlfa1 = aAlfa % 0101;
   |PARA; |SI aAlfa1 = "0"; |HACIENDO;
      aAlfa = aAlfa % 0299; aAlfa1 = aAlfa % 0101;
   |SIGUE;

   |PARA; |SI aAlfa ! ""; |HACIENDO;
      aAlfa1 = aAlfa % 0110; aAlfa = aAlfa % 1199;
      nCalc = aAlfa1;
      nCalc1 = nCalc / nModulo;
      nCalc1 = ((nCalc1 - 0.49) ! 0);
      nCalc1 = nCalc1 * nModulo;
      nCalc = nCalc - nCalc1;
      aAlfa1 = nCalc;
      |SI aAlfa ! ""; aAlfa = aAlfa1 + aAlfa; |FINSI;
   |SIGUE;
   aAlfa = nCalc; |QBF aAlfa;
   aAlfa = ("00" + aAlfa) % -102;
|FPRC;

|PROCESO GrabaDiskette;
   programa = " REMESA N68 ";
   ficcopia = "n6800" + (("000" + #camanban#0) % -103) + ".seq";
   |SUB_EJECUTA_NP "cared003"; |ACABA;

   |PUSHV 0501 2380;
   |BLANCO 0915 1365;
   |CUADRO 1025 1255;
   |PINTA 1127, " ¨ Grabar en Disquete, Carpeta o Ninguno ? ";
   |ATRI R; |PINTA 1140, "D"; |PINTA 1150, "C"; |PINTA 1160, "N"; |ATRI N;
   E_sup = 1;
   E_inf = "DCNdcn";
   aResp = 1151 ? 0;
   |POPV;
   |SI aResp = "N"; |O aResp = "n"; |ACABA; |FINSI;
   |PUSHV 0501 2380;

   |SI aResp = "D";
      |BLANCO 0815 1465;
      |CUADRO 0915 1364;
      |IP_REMOTO aIp; |QBF aAlfa;
      |PINTA 1015, "      Introduzca un disquete en su PC             ";
      |PINTA 1115, "               y pulse una tecla                  ";
      |PAUSA;

      aDestino = "/normas/"; |RMKDIR aDestino;
      aDestino = aDestino + "n6800" + (("000" + #camanban#0) % -103) + ".seq";
      |DFICB aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "n6800" + (("000" + #camanban#0) % -103) + ".seq";
      |SI aIp ! "";
         |ENVIA_FICHERO aAlfa, aDestino;
      |SINO;
         |COPIA_FICHERO aAlfa, aDestino;
      |FINSI;
      aAlfa = "COPY " + aDestino + " A:"; |RSYSTEM aAlfa;
      aAlfa = "DEL " + aDestino;          |RSYSTEM aAlfa;
      |POPV;
   |FINSI;
   |SI aResp = "C";
      |IP_REMOTO aIp; |QBF aIp;
      aDestino = "D "; |BROWSE aDestino; aDestino = aDestino % 0299;
      aAlfa = aDestino % -101;
      |SI aAlfa ! "/"; |Y aAlfa ! "\";
         aDestino = aDestino + "/";
      |FINSI;
      aDestino = aDestino + eaNombre1;
      Comodin = eaOrigen; |QBF Comodin; Comodin = Comodin + eaNombre1;
      |SI aIp ! "";
         |ENVIA_FICHERO Comodin, aDestino;
      |SINO;
         |COPIA_FICHERO Comodin, aDestino;
      |FINSI;
      |SI FSalida = 0;
         |MENAV "    Fichero correctamente ubicado en la carpeta seleccionada";
      |SINO;
         |MENAV "    Ha ocurrido un error al copiar el fichero al directorio destino";
      |FINSI;
   |FINSI;

|FPRC;
