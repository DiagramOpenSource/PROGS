|FICHEROS;
    cainvfi2 #0;
    camocabe #1;
    camoline #2;
    camogrup #3;
    cainftmp #4;
|FIN;

|VARIABLES;
    &entrada = 1;
    &ulti    = "";
    informe  = "cainvfin";
    bueno    = 0;
    &amor    = 0;
    &resid   = 0;
    &lintot  = 0;
    &linnor  = 0;
    &linant  = 0;
    &totval  = 0;
    &totamo  = 0;
    &totano  = 0;
    &totres  = 0;
    &linanyo = 0;
    &anyo1   = 0;
    &anyo2   = 0;
    &anyo3   = 0;
    &anyo4   = 0;
    &anyo5   = 0;
    &anyo6   = 0;
    &anyo7   = 0;
    &anyo8   = 0;
    &a1      = 0;
    &a2      = 0;
    &a3      = 0;
    &a4      = 0;
    &a5      = 0;
    &a6      = 0;
    &a7      = 0;
    &a8      = 0;
    &t1      = 0;
    &t2      = 0;
    &t3      = 0;
    &t4      = 0;
    &t5      = 0;
    &t6      = 0;
    &t7      = 0;
    &t8      = 0;
    nombre = "";
    alfa1 = "";
    &am_ti = "CONTABLE";
    &fec = @;
    fecsys = @;
    SwResid = 0;
    anyov   = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE numamo_i;

|PROCESO numamo; |TIPO 0;
    x_alfa1 = #0Campo;
|HAZ x_punto;
    #0Campo = x_alfa1;
    |PINTA #0Campo;
|FPRC;

|PROCESO no_dep; |TIPO 7;
   alfa1 = #30#24;
   |C_M #0#7, 1, alfa1;
   |C_M #0#8, 1, alfa1;
|FPRC;

|PROCESO cuenta; |TIPO 0;
    p_alfa1 = #0Campo;
    salidas = FSalida;
|HAZ punto;
|SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;
    fecsys = fec2; || fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    #0Campo = alfa1;
|PINTA #0Campo;
|FPRC;


|PROCESO graba_tmp;
  |SI #0#6 = "N";
      |SI #1#22 = "N"; |ACABA; |FINSI;
  |FINSI;
           || ----- preparaba el registro con la cuenta de gastos
              || #3#0 = #1#15;
              || |LEE 001#3=;
              || |SI FSalida = 0;
              ||    |SI #3#1 ] #0#0; |Y #3#1 [ #0#1;
              ||        #4#0 = #3#1;
              ||        #4#1 = #3#2;
              ||        #4#2 = #1#0;
              ||        #4#3 = #1#1;
              ||       |GRABA 021#4n;
              ||       |LIBERA #4;
              ||     |FINSI;
              ||  |FINSI;
   || graba la cuenta de cabecera
      |SI #1#3 ] #0#0; |Y #1#3 [ #0#1;
          #4#0 = #1#3;
          #4#1 = #1#4;
          #4#2 = #1#0;
          #4#3 = #1#1;
          |GRABA 021#4n;
          |LIBERA #4;
      |FINSI;
|FPRC;

|DEFBUCLE carga_tmp;
 #1#1;
 3,28;
 #0#2,00,#0#0, #0#7;
 #0#3,99,#0#1, #0#8;
 e;
 NULL , graba_tmp;
|FIN;


|PROCESO acumano;
  |SI #2#4 = "A";
      |SI anyo1 = #2#3; a1 = a1 + #2#9; |FINSI;
      |SI anyo2 = #2#3; a2 = a2 + #2#9; |FINSI;
      |SI anyo3 = #2#3; a3 = a3 + #2#9; |FINSI;
      |SI anyo4 = #2#3; a4 = a4 + #2#9; |FINSI;
      |SI anyo5 = #2#3; a5 = a5 + #2#9; |FINSI;
      |SI anyo6 = #2#3; a6 = a6 + #2#9; |FINSI;
      |SI anyo7 = #2#3; a7 = a7 + #2#9; |FINSI;
      |SI anyo8 ] #2#3; a8 = a8 + #2#9; |FINSI;
      |SI #2#3 [ anyo1;
          |SI SwResid = 0;
              resid = (resid - #2#9) ! EURODB;
          |FINSI;
          amor  = (amor + #2#9) ! EURODB;
      |FINSI;

      |SI #2#3 [ anyo1; |Y SwResid = 1; |Y #2#3 = anyov;
          resid = 0;
      |FINSI;
  |FINSI;

  |SI #2#4 = "V";
      SwResid = 1;
      anyov   = #2#3;
  |FINSI;
|FPRC;

|PROCESO fechafac;
#1#0 = #4#2;
#1#1 = #4#3;
|LEE 001#1=;
|SI FSalida = 0;
  |SI bueno ! 0;          || si es primera vez imprime cabeceras solo
      |SI #1#3 ! ulti;
          lintot = 1;     || imprime linea de totales
          |PRINT;
          |HAZ poncero;
          lintot = 0;
          linant = 0;
          linnor = 1;     || imprime primera linea de cuenta
      |SINO;
          lintot = 0;
          linnor = 0;
          linant = 1;     || imprime siguientes lineas de misma cuenta
      |FINSI;
  |SINO;
      lintot = 0;
      linnor = 1;
      linant = 0;
  |FINSI;
  bueno = 1;
  ulti = #1#3;               || Cod. de Cuenta;
  a1 = 0;  a2 = 0;  a3 = 0;  a4 = 0;  a5 = 0;  a6 = 0;  a7 = 0;  a8 = 0;
  amor    = 0; ||  ... #1#18;
  resid   = #1#7;
  SwResid = 0;
  anyov   = 0;
  |BUCLELIN 2acumano#1;
  |PRINT;
  totval = totval + #1#7;   || acumula valor inicial;
  totamo = totamo + amor;   || acumula amortizacion;
  t1 = t1 + a1;              || acumula amortizacion en a¤o final;
  t2 = t2 + a2;              || acumula amortizacion en a¤o -1;
  t3 = t3 + a3;              || acumula amortizacion en a¤o -2;
  t4 = t4 + a4;              || acumula amortizacion en a¤o -3;
  t5 = t5 + a5;              || acumula amortizacion en a¤o -4;
  t6 = t6 + a6;              || acumula amortizacion en a¤o -5;
  t7 = t7 + a7;              || acumula amortizacion en a¤o -6;
  t8 = t8 + a8;              || acumula amortizacion en a¤o -7;
  totres = totres + resid;   || acumula valor residual;
  lintot = 0;
  linnor = 0;
  linant = 0;
|FINSI;
|FPRC;

|DEFBUCLE cainvfin0;
  #4#1;
  ;
  #0#0,0,#0#2,00;
  #0#1,9,#0#3,99;
  e;
  NULL,fechafac;
|FIN;

|PROCESO impre; |TIPO 3;
  |IMPRE 0;
  |SI FSalida = 0;
      |INFOR informe;
     nombre = "fin" + Usuario;
     nombre = nombre % 108;
     |QBF nombre;
     |NOME_DAT #4 nombre;
     |ABRE #4;
     |CIERRA #4;
     |DELINDEX #4;
     |ABRE #4;
     |ABRE #3;
     |BUCLE carga_tmp;
     |CIERRA #4;
     |CIERRA #3;
      bueno = 0;
      anyo1 = #0#5;
      anyo2 = #0#5-1;
      anyo3 = #0#5-2;
      anyo4 = #0#5-3;
      anyo5 = #0#5-4;
      anyo6 = #0#5-5;
      anyo7 = #0#5-6;
      anyo8 = #0#5-7;
      fec = #0#4
      |ABRE #1;
      |BUCLE cainvfin0;
      |CIERRA #1;
      lintot = 1;
      |PRINT;
      |PIEINF;
      |FININF;
      |DELINDEX #4;
  |FINSI;
  |FINIMP;
|FPRC;

|PROCESO poncero;
  totval = 0;
  totamo = 0;
  t1 = 0;
  t2 = 0;
  t3 = 0;
  t4 = 0;
  t5 = 0;
  t6 = 0;
  t7 = 0;
  t8 = 0;
  totres = 0;
|FPRC;
