|FICHEROS;
   ca8accaa #409;
   ca8cumay #410;
   ca8m0001 #421;
   ca8m0021 #451;
   ca8m0022 #452;
|FIN;

|VARIABLES;
   aParam       = "";
   aMenu        = "";
   aFichero     = "";
   aAlfa        = "";
   nInkey       = 0;
   aPrincipio   = "";
   aPrincipi1   = "";
   aHandle      = "";
   &ensociedad  = 0;
   nError       = 0;
   aBase        = "";
   aPassword    = "";
   nPassword    = 0;
|FIN;

|INCLUYE varnue_i;
|INCLUYE acceso_i;
|INCLUYE lospat_i;

|PROCESO Creacion;

     enEjerBal = #409#0;
     aMenu = "";
     |DBASS aBase;   |QBF aBase;
     |SI ensociedad = 1;
         aMenu  = aBase + "sociedad/" + "contccaa.men";
         aPrincipio = ":agicont/";
         aPrincipi1 = "";
     |SINO;
         aMenu      = aBase + "agicont/" + "contccaa.men";
         aPrincipio = "";
         aPrincipi1 = ":sociedad/";
     |FINSI;

     |DBASE aBase;   |QBF aBase;

     |FBORRA aMenu;

     Pos = -1;
     aFichero = "wb  " + aMenu;
     |FABRE aFichero;
     aHandle = FSalida;
     |SI aHandle ] 0;

          aAlfa = aHandle + " #:Estructuras CCAA Ejercicio " + enEjerBal + &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 1:Mantenimiento Cuentas de Mayor  {{" + aPrincipio + "ca8z0000;" + enEjerBal + "}}" + &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 2:Estructura Balance de Situacion  {{" + aPrincipio + "ca8z0001;0" + enEjerBal + "}}" + &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 3:Estructura Cuenta de Perdidas y Ganancias  {{" + aPrincipio + "ca8z0001;1" + enEjerBal + "}}" + &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 4:Estructura de Ingresos y Gastos reconocidos" + &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 4,1:Configuracion imputacion de Ingresos y Gastos reconocidos al Patrimonio Neto {{" + aPrincipio + "ca8z0010;" + enEjerBal + "}}" +  &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 4,2:Estructura Estado de Ingresos y Gastos reconocidos {{" + aPrincipio + "ca8z0001;2" + enEjerBal + "}}" +  &13 + &10;
          |FGRABA aAlfa;

          aAlfa = aHandle + " 5:Estructura Estado de Cambios en el Patrimonio Neto" + &13 + &10;
          |FGRABA aAlfa;

          |SI ensociedad = 1;
              aAlfa = aHandle + " 5,1:Descripcion Lineas Balance Estado Cambios del P.Neto {{" + aPrincipi1 + "soda8z01;" + enEjerBal + "}}" +  &13 + &10;
          |SINO;
              aAlfa = aHandle + " 5,1:Descripcion Lineas Balance Estado Cambios del P.Neto {{" + aPrincipio + "ca8zso01;" + enEjerBal + "}}" +  &13 + &10;
          |FINSI;
          |FGRABA aAlfa;

          |SI ensociedad = 1;
              aAlfa = aHandle + " 5,2:Descripcion Columnas  Bal. Estado Cambios del P.Neto {{" + aPrincipi1 + "soda8z00;" + enEjerBal + "}}" +  &13 + &10;
          |SINO;
              aAlfa = aHandle + " 5,2:Descripcion Columnas  Bal. Estado Cambios del P.Neto {{" + aPrincipio + "ca8zso00;" + enEjerBal + "}}" +  &13 + &10;
          |FINSI;
          |FGRABA aAlfa;

          |SI ensociedad = 1;
              aAlfa = aHandle + " 5,3:Estructura Estado de Cambios en el Patrimonio Neto   {{" + aPrincipi1 + "soda8z02;" + enEjerBal + "}}" +  &13 + &10;
          |SINO;
              aAlfa = aHandle + " 5,3:Estructura Estado de Cambios en el Patrimonio Neto   {{" + aPrincipio + "ca8zso02;" + enEjerBal + "}}" +  &13 + &10;
          |FINSI;
          |FGRABA aAlfa;

          |SI ensociedad = 1;
              aAlfa = aHandle + " 5,4:Informe de la Estructura del ECPN  {{" + aPrincipi1 + "soda8y01;" + enEjerBal + "}}" +  &13 + &10;
              |FGRABA aAlfa;
          |FINSI;

          aAlfa = aHandle + " 6:Estructura Estado de Flujo de Efectivo   {{" + aPrincipio + "ca8z0001;4" + enEjerBal + "}}" + &13 + &10;
          |FGRABA aAlfa;

          |SI ensociedad = 1;
              aAlfa = aHandle + " 7:Introduccion de Desglose Balance para Impuesto Sociedades " + &13 + &10;
              |FGRABA aAlfa;

              aAlfa = aHandle + " 7,1:Estructura Balance de Situacion  {{" + aPrincipio + "ca8z0009;0" + enEjerBal + "}}" +  &13 + &10;
              |FGRABA aAlfa;

              aAlfa = aHandle + " 7,2:Estructura Cuenta de Perdidas y Ganancias  {{" + aPrincipio + "ca8z0009;1" + enEjerBal + "}}" +  &13 + &10;
              |FGRABA aAlfa;

              aAlfa = aHandle + " 7,3:Estructura Estado de Cambios en el Patrimonio Neto  {{" + aPrincipi1 + "soda8z22;" + enEjerBal + "}}" +  &13 + &10;
              |FGRABA aAlfa;

          |FINSI;

     |FINSI;
     |FCIERRA aHandle;
|FPRC;

|PROCESO FichStandar;
     |SI nPassword = 0;
         aPassword = "";
         |PUSHV  1801 2379;
         |BLANCO 1801 2379;
         |CUADRO 2013 2263;
         |PINTA 2115, "Introduzca Password : ";
          E_inf = "";
          E_sup = "20";
          aPassword = 2137 ? -1;
          |SI aPassword ! "<MYPASWD>     ";
              |MENAV "     Permiso denegado.";
              |POPV;
              |ACABA;
         |FINSI;
         |POPV;
     |FINSI;

     aAlfa = "Instalando Ficheros Oficiales del Ejercicio " + enDPlan;
     |PINTA 1613, aAlfa;

     nActual = 0;
     enPlan  = enDPlan;
     |HAZ InstaloFich0;
     |BLIN 16;
|FPRC;

|PROCESO Tipo7C0; |TIPO 7;
  |SI #ca8accaa#0 ! 2008; |Y #ca8accaa#0 ! 2015;
        |Y #ca8accaa#0 ! 2016; |Y #ca8accaa#0 ! 2018;
      aAlfa = "0000F2- Nuevo Ejer., F3- Borrar Ejer., F4-Copia Bal, F5-Borra Bal";
      |PINTA 2208, "                        ";
  |SINO;
      aAlfa = "0000F2-Nuevo, F3-Borra, F4-Copia Bal, F5-Borra Bal, F9-Inst.P.O";
      |ATRI S; |PINTA 2208,"<F9>";
      |ATRI P; |PINTA 2215,"Inst. P.Oficiales"; |ATRI 0;
  |FINSI;
  |MENSA aAlfa;
  |CUADRO 1805 2378;
|FPRC;

|PROCESO Tipo11C0; |TIPO 11;
  nInkey = FSalida;
  |SI nInkey = 10;
      |CONFI "0000SDesea dar de Alta Nuevo Ejercicio";
      |SI FSalida = 0;

          |CIERRA #ca8accaa;
          |PUSHV 0501 2380;
          |BLANCO 1805 2378;
          |SUB_EJECUTA_NP ":agicont/caz00101";
          |POPV;
          |SI enDPlan = 2008; |O enDPlan = 2015;
             |O enDPlan = 2016; |O enDPlan = 2018;
              nPassword = 1;
              |HAZ FichStandar;
          |FINSI;
          |ABRE #ca8accaa;

          |PONCONTROL 23, "SI";
      |FINSI;
  |FINSI;

  |SI nInkey = 11;
      |CONFI "0000SDesea borrar el Ejercicio";
      |SI FSalida = 0;
          |SI #ca8accaa#0 = 2008; |O #ca8accaa#0 = 2015;
             |O #ca8accaa#0 = 2016; |O #ca8accaa#0 = 2018;
              |MENAV "0000Se borraran las Estructuras y se instalaran las Oficiales del Ejercicio.";
              |CONFI "0000NContinuar";
              |SI FSalida ! 0;
                  |ACABA;
              |FINSI;
          |FINSI;
          enDPlan = #ca8accaa#0;
          |CIERRA #ca8accaa;

          |PUSHV 0501 2380;
          |BLANCO 1805 2378;
          |SUB_EJECUTA_NP ":agicont/caz00101;baja";
          |POPV;
          |SI enDPlan = 2008; |O enDPlan = 2015;
             |O enDPlan = 2016; |O enDPlan = 2018;
              nPassword = 1;
              |HAZ FichStandar;
          |FINSI;
          |ABRE #ca8accaa;

          |PONCONTROL 23, "SI";
      |FINSI;
  |FINSI;

  |SI nInkey = 12;
      |CONFI "0000SDesea Copiar una Estructura en el Ejercicio";
      |SI FSalida = 0;
          enDPlan = #ca8accaa#0;
          |CIERRA #ca8accaa;

          |PUSHV 0501 2380;
          |BLANCO 1805 2378;
          |SUB_EJECUTA_NP ":agicont/caz00101;copiar";
          |POPV;
          |ABRE #ca8accaa;

          |PONCONTROL 23, "SI";
      |FINSI;
  |FINSI;

  |SI nInkey = 13;
      |CONFI "0000SDesea Borrar una Estructura en el Ejercicio";
      |SI FSalida = 0;
          enDPlan = #ca8accaa#0;
          |CIERRA #ca8accaa;

          |PUSHV 0501 2380;
          |BLANCO 1805 2378;
          |SUB_EJECUTA_NP ":agicont/caz00101;borrar";
          |POPV;
          |ABRE #ca8accaa;

          |PONCONTROL 23, "SI";
      |FINSI;
  |FINSI;

  |SI nInkey = 17;
      enDPlan = #ca8accaa#0;
      |SI enDPlan = 2008; |O enDPlan = 2015;
         |O enDPlan = 2016; |O enDPlan = 2018;
          |CONFI "0000SDesea Instalar los Ficheros Oficiales de este Ejercicio";
          |SI FSalida = 0;
              nPassword = 0;
              |HAZ FichStandar;
          |FINSI;
          |PONCONTROL 23, "SI";
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Tipo0C0; |TIPO 0;
    |BLIN 4;
    |HAZ Creacion;
    nError = 1;
    |PTEC 806;
|FPRC;

|PROCESO Baja100;
     #409#0 = 0;
     |SI FSalida = "POSICION";
         #409#0 = enEjerBal;
     |FINSI;
|FPRC;

|PROCESO Alta100;
     #409#0 = 2999;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |SI aParam = ""; |O aParam = "contccaa.men";
         |HAZ inicio;
     |FINSI;

     |HAZ DirAplicSt;
     |HAZ LosPatrones;

     nError = 0;
     |CLS;
     |PINPA #0#409;
     |ENTLINEAL #1#409, -1, 4, 14, 1, Baja100, Alta100;
     |SI nError = 0;
         |PTEC 806;
     |FINSI;
|FPRO;
