|FICHEROS;
  carecamo #0;
  camocabe #1;
  camoline #2;
|FIN;

|VARIABLES;
  &entrada = 1;
  alfa1    = "";
  cfecha   = @;
  vfecha   = @;
  afecha   = @;
  afiscal  = 0;
  acontab  = 0;
  importe  = 0;
  sw       = 0;
  ele1     = "";
  ele2     = "";
|FIN;

|INCLUYE acceso_i;

|| ********************************************************************

|PROCESO lineas;
  |SI #2#4 = "C";
      importe = (importe + #2#5) ! EURODB;
      |SI sw = 0;
          cfecha = #2#7;
          sw = 1;
      |FINSI;
  |FINSI;

  |SI #2#4 = "A";
      afiscal = (afiscal + #2#5) ! EURODB;
      acontab = (acontab + #2#9) ! EURODB;
      |SI afecha < #2#7;
          afecha = #2#7;   || Ultima fecha de Amortizacion
      |FINSI;
  |FINSI;

  |SI #2#4 = "V";
      vfecha = #2#7;
      |SI #2#9 = 0; |Y #2#5 ! 0;
          #2#9 = #2#5;
          |GRABA 020#2a;
      |FINSI;
  |FINSI;
  |LIBERA #2;
|FPRC;

|PROCESO grabacab;
 importe = 0;
 afiscal = 0;
 acontab = 0;
 cfecha = "01.01.0000";
 afecha = "01.01.0000";
 vfecha = "01.01.0000";
 sw = 0;
 #0#1 = #1#0; |PINTA #0#1;
 #0#2 = #1#1; |PINTA #0#2;

 |BUCLELIN 0lineas#1;
 |SI sw = 1;
     #1#6  = cfecha;
     #1#23 = vfecha;
     #1#7  = importe;
     #1#12 = afiscal;
     #1#13 = (importe - afiscal) ! EURODB;
     |SI #1#13 ! 0;
         |SI #1#23 > "01.01.0000"; |Y #1#23 [ afecha;
             #1#13 = 0;
         |FINSI;
     |FINSI;

     #1#18 = acontab;
     #1#19 = (importe - acontab) ! EURODB;
     |SI #1#19 ! 0;
         |SI #1#23 > "01.01.0000"; |Y #1#23 [ afecha;
             #1#19 = 0;
         |FINSI;
     |FINSI;
     |GRABA 020#1a;
 |FINSI;
 |LIBERA #1;
|FPRC;

|DEFBUCLE calamo0;
   #1#1;
   ;
   ele1, 00;
   ele2, 99;
   be;
   NULL, grabacab;
|FIN;

|PROCESO procal; |TIPO 3;
  |SI #0#0 = "SI";
      ele1 = "        ";
      ele2 = "zzzzzzzz";
      |BUCLE calamo0;
  |FINSI;
|FPRC;
