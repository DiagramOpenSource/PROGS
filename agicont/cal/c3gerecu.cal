|FICHEROS;
  c3gerecu #0;
  caconimp #8;
  canempre #30;
|FIN;

|VARIABLES;
  leidos = 0;
  dirfich0 = "";
  emp1 = 0;
  per1 = 0;
  xx = 0;
  yy = 0;
  x = 0;
  y = 0;
  varcamp = 0;
  &r_emp = 0;
  &r_per = 0;
  alfa2 = "";
  men9 = "     Empresa Contable INACTIVA ";
|FIN;

|INCLUYE varnue_i;
|INCLUYE acceso_i;       || lectura de la empresa
|INCLUYE recupe_i;       || recuperacion de saldos

|| *************************************************************************
||                        CALCULOS DE PANTALLA
|| *************************************************************************

|PROCESO alentrar; |TIPO 7;
  #0#1 = #30#26;
  |PINTA #0#1;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SUB_EJECUTA "caconemp.run";
  |ERROR;
  |SI Campo = 3;
      #0#3 = r_emp;
      #0#5 = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
  |SI Campo = 4;
      #0#4 = r_emp;
      #0#6 = r_per;
      |PTEC 802;
  |FINSI;
  |SI Campo ] 7;
      #0Campo = r_emp;
      varcamp = Campo + 20;
      #0varcamp = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
|FPRC;

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;

|PROCESO mayor1;
  |HAZ mayor;
  |SI #0Campo = "N";
      |PARA x = 7;  |SI x [ 46;  |HACIENDO x = x + 1;
            |CAMPO_MODIFICA #0x,1,"S";
      |SIGUE;
      #0#3 = 0;
      #0#5 = 0;
      #0#4 = 0;
      #0#6 = 0;
      |CAMPO_MODIFICA #0#3,1,"N";
      |CAMPO_MODIFICA #0#5,1,"N";
      |CAMPO_MODIFICA #0#4,1,"N";
      |CAMPO_MODIFICA #0#6,1,"N";
      |PINTA #0#3;
      |PINTA #0#5;
      |PINTA #0#4;
      |PINTA #0#6;
  |SINO;
      |PARA x = 7;  |SI x [ 46;  |HACIENDO x = x + 1;
            #0x = 0;
            |CAMPO_MODIFICA #0x,1,"N";
      |SIGUE;
      |CAMPO_MODIFICA #0#3,1,"S";
      |CAMPO_MODIFICA #0#5,1,"S";
      |CAMPO_MODIFICA #0#4,1,"S";
      |CAMPO_MODIFICA #0#6,1,"S";
  |FINSI;
|FPRC;

|| --------------- comprueba desde-hasta empresas ---------------------------

|PROCESO buscaem1;
  |SI #30#26 ! #0#1; |ACABA; |FINSI;
  |SI #30#21 = "I";  |ACABA; |FINSI;
  leidos = 1;
  |ERROR10;
|FPRC;

|DEFBUCLE buscaempre;
#30#1;
;
#0#3,#0#5;
#0#4,#0#6;
e;
NULL,buscaem1;
|FIN;

|PROCESO buclempre;
  |SI #0#5 > #0#6;
      |MENAV "     ERROR EN INTRODUCCION";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #0#3 = 0;  |Y #0#4 = 0;  |ACABA;  |FINSI;
  leidos = 0;
  |BUCLE buscaempre;
  |SI leidos = 0;
      |MENAV "    ATENCION SELECCION VACIA";
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO deshas;
  |SI #0#4 < #0#3;
      |MENAV "      Error en Introduccion";
      |ERROR;
  |FINSI;
|FPRC;

|| ------------------------------------------------------------------------
|PROCESO simodi; |TIPO 7;
  |PARA x = Campo + 1;  |SI x [ 26;  |HACIENDO x = x + 1;
        |CAMPO_MODIFICA #0x,1,"S";
        y = x + 20;
        |CAMPO_MODIFICA #0y,1,"S";
  |SIGUE;
  y = Campo + 20;
  |CAMPO_MODIFICA #0y,1,"S";
|FPRC;

|PROCESO nomodi;
  |PARA x = Campo + 1;  |SI x [ 26;  |HACIENDO x = x + 1;
        #0x = 0;
        |CAMPO_MODIFICA #0x,1,"N";
        y = x + 20;
        #0y = 0;
        |CAMPO_MODIFICA #0y,1,"N";
  |SIGUE;
  y = Campo + 20;
  #0y = 0;
  |CAMPO_MODIFICA #0y,1,"N";
  |PINTA #0y;
|FPRC;

|PROCESO esbuena; || desde campo de empresas seleccion
  |SI FSalida = 2; |ACABA; |FINSI;
  |SI #0Campo = 0; |HAZ nomodi;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0Campo;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0Campo;
      |MENAV "     NO Existe la Empresa Contable";
      |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2;|ACABA;|FINSI;
  x = Campo - 20;
  |SI #0x = 0;  |ACABA;  |FINSI;
  |ABRE #30;
  x = Campo - 20;
  #30#2 = #0x;
  #30#3 = #0Campo;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la Empresa Contable";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #30;

  |SI #30#21 = "I";
      |MENAV men9;
      |ERROR;
      |ACABA;
  |FINSI;

  |SI #30#26 ! #0#1;
      |MENAV "     El a¤o contable NO esta dentro de la seleccion ";
      |ERROR;
      |ACABA;
  |FINSI;

  x = Campo + 20;
  #0x = #30#1;
  |PINTA #0x;
  x = Campo - 20;
  alfa1 = #0x;
  alfa2 = #0Campo;
|FPRC;

|| **********************************************************************
||                       CALCULOS DE IMPRESION
|| **********************************************************************

|| ---------- Seleccion DESDE / HASTA Empresa.

|PROCESO esdesd1;
  |DBASE dir_fich;
  dirfich0 = dir_fich + "fich/";
  alfa1 = #30#2;
  alfa2 = #30#3;
  emp1 = #30#2;
  per1 = #30#3;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
  dirfich0 = dirfich0 + alfa1 + alfa2 + "/";

  |SI #30#26 ! #0#1; |O #30#21 = "I";
      |ACABA;
  |FINSI;

  |HAZ haztodo;
|FPRC;

|DEFBUCLE esdesde;
#30#1;
;
#0#3,#0#5;
#0#4,#0#6;
e;
NULL,esdesd1;
|FIN;

|| ---------- Seleccion en parrilla.

|PROCESO esunaauna;

  |PARA xx = 7;  |SI xx [ 26;  |HACIENDO xx = xx + 1;
        |SI #0xx = 0;  |SAL;  |FINSI;

        |DBASE dir_fich;
        dirfich0 = dir_fich + "fich/";
        yy = xx + 20;
        emp1 = #0xx;
        per1 = #0yy;
        alfa1 = #0xx;
        alfa2 = #0yy;
        alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
        alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
        dirfich0 = dirfich0 + alfa1 + alfa2 + "/";
|| lee empresa
        |ABRE #30;
        #30#2 = emp1;
        #30#3 = per1;
        |LEE 011#30=;
        |CIERRA #30;
        |SI #30#26 ! #0#1; |O #30#21 = "I";
            |VETE otramas;
        |FINSI;
        |HAZ haztodo;
|ET otramas;
  |SIGUE;
|FPRC;

|| *************** propio del rec lculo

|PROCESO procal;
  |NOPARA;
  conforme = #0#0;
  fini = "01.01.0000";
  ffin = "31.12.9999";
  cini = 1;
  cfin = 999;
  |HAZ recuperacion;
  |SIPARA;
  |ABRE #8;
  |LEE 111#8p;
  |SI FSalida ! 0;
      |DDEFECTO #8;
      #8#3 = "S";
      |GRABA 011#8n;
  |SINO;
      #8#3 = "S";
      |GRABA 011#8a;
  |FINSI;
  |CIERRA #8;
|FPRC;

|| *********************************************************************
||                    COMIENZO con TIPO 3
|| *********************************************************************

|PROCESO impre; |TIPO 3;
  |SI #0#0 = "N"; |ACABA; |FINSI;

  |SI #0#1 < 80;
      enEjercicio = 2000 + #0#1;
  |SINO;
      enEjercicio = 1900 + #0#1;
  |FINSI;
  |PUSHV 2102 2378;
  |ATRI I;
  |CUADRO 2102 2378
  |ATRI N;
  |ATRI R;
  |PINTA 2203," EMPRESA:                                                                  ";
  |ATRI 0;

  |SI #0#2 = "S";
      |BUCLE esdesde;
  |SINO;
      |HAZ esunaauna;
  |FINSI;
  |POPV;
|FPRC;


|PROCESO haztodo;
  |PATH_DAT #1 dirfich0;
  |PATH_DAT #3 dirfich0;
  |PATH_DAT #5 dirfich0;
  |PATH_DAT #8 dirfich0;
  |PATH_DAT #10 dirfich0;

  |ATRI R;
  |PINTA 2213, #30#2;
  |PINTA 2219, #30#3;
  |PINTA 2221, #30#1;
  |ATRI 0;
  |HAZ procal;
|FPRC;
