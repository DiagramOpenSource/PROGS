|FICHEROS;
     caemi130 #0;
     caman130 #1;
     caportad #2;
     camoneda #3;
     caw00003 #99;

     eosw0542 #542;
     dsmow570 #570;
     dsmow576 #576;
     dsmow593 #593;

     eosw0601 #601,MANTE;
|FIN;

|VARIABLES;
     inform1 = "caemi130";
     inform2 = "caemb130";
     inform3 = "caemn130";
     informe = "";
     &dia = "";
     &mes = "";
     &anyo = "";
     alfa1 = "";
     d_emp = 0;
     h_emp = 99999;
     d_act = 1;
     h_act = 9;
     sw = 0;
     imsn1 = "";
     imsn2 = "";
     nEl27 = 0;
     nTecla       = 0;
     perialf      = "";

     nAnyo2D      = 0;
     aAlfa        = "";

     aAbre        = "";
     aModelos     = "";

     nHandle1     = 0;
     nHandle2     = 0;
     nSwHay       = 0;
     nTCampo      = 0;

     aAlfa1       = "";
     aUnidad      = "";

  {1}aContiene    = "";

     &eaMonedEmpre = "";
     &eaFOrigen    = "";
     &eaFDestino   = "";
     &eaInternet   = "";
     &eaImpresora  = "";
     &enNume       = 0;
     &eaAlfa       = "";
     &eaDiaB       = "";
     &eaMesB       = "";
     &eaAnyoB      = "";
     &eaModelos    = "";
     &eaUnidadBasico = "";

     &eaEjer             = "";
     &eaPathEmision      = "";
     &eaPathLanza        = "";
     &eaPathExplorador   = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroImpre     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &enTecla            = 0;
     &eaPeriodo          = "";
     &eaCampo0           = "";
     &eaCampo1           = "";
     &eaCampo2           = "";
     &eaCampo3           = "";
     &eaCampo4           = "";
     &eaCampo5           = "";
     &eaCampo6           = "";
     &eaCampo7           = "";
     &enError15          = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE seguim_i;
|INCLUYE i_laserc;

|PROCESO MiraMoneda;
   eaMoneda = "P";

   |SI #0#0 ] 2001;
      |SI #0#4 = "L";  |O #0#4 = "F";
          |ABRE #camoneda;
          #camoneda#0 = #48#2;
          #camoneda#1 = #48#3;
          |LEE 000#camoneda.=;
          |SI FSalida = 0;
             eaMonedEmpre = #camoneda#2;
          |FINSI;
          |CIERRA #camoneda;

          |SI #0#0 = 2001;
              |PUSHV 1921 2155;
              |BLANCO 1921 2155;
              |CUADRO 1923 2153;
              |ATRI R; |PINTA 1924 , " Seleccione moneda de emision "; |ATRI N;
              |PINTA 2031, "(Pesetas/Euros)";
              |ATRI I; |PINTA 2032, "P"; |PINTA 2040, "E"; |ATRI N;
              E_sup  = 1;
              E_i nf  = "EP";
              eaMoneda = "P";
              eaMoneda = 2047 ? 0;
              |POPV;
          |FINSI;

          |SI #0#0 ] 2002;
              eaMoneda = "E";
          |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO TipoImpreso;  |TIPO 0;
     |SI #0#4 = "F";  |Y #0#0 [ 2001;
         |MENAV "     Tipo de Impreso Incorrecto.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO FPago; |TIPO 0;
 |SI FSalida = 2; |ACABA; |FINSI;

 |SI #0#4 ! "F";
     |SI #0#6 = "A";
         |MENAV "    Opcion valida solo para Fichero / Internet. ";
         |ERROR;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO def_any; |TIPO 7;
     |SI #30#26 < 80;
         #0#0   = 2000 + #30#26;     |PINTA #0#0;
     |SINO;
         #0#0   = 1900 + #30#26;     |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO mayus; |TIPO 0;
     alfa1 = #0Campo > " ";
     #0Campo = alfa1;
     |PINTA #0Campo;
     |SI Campo = 4;
         |SI #0Campo ! "B";
             |C_M #0#5,1,"S";
         |SINO;
             |C_M #0#5,1,"N";
         |FINSI;
     |FINSI;
|FPRC;

|| Secuencial del Modelo 130

|PROCESO Valor12;
     |SI eaMonedEmpre = "P";
        |SI eaMoneda = "P";
           nCanti = nCanti ! 0;
        |SINO;
           nCanti = ((nCanti / 166.386) ! 2) * 100;
        |FINSI;
     |SINO;
        |SI eaMoneda = "P";
           nCanti = (nCanti / 166.386) ! 0;
        |SINO;
           nCanti = nCanti * 100;
        |FINSI;
     |FINSI;

     |SI nCanti ] 0;
         aCanti = nCanti;
         aCanti = ("000000000000" + aCanti) % -112;
     |SINO;
         nCanti = -nCanti;
         aCanti = nCanti;
         aCanti = "N" + (("00000000000" + aCanti) % -111);
     |FINSI;
|FPRC;

|PROCESO Carga130_2001;
     |DDEFECTO #99;

     #99#4  = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);

     Valfa  = #2#13; |QBF Valfa;
     #99#5  = ("000000000" + Valfa) % -109;
     #99#6  = #2#2;
     #99#8  = #2#3;
     #99#9  = #2#4;
     #99#10 = #2#5;
     #99#11 = #2#6;
     #99#12 = #2#7;
     #99#13 = #2#8;
     #99#14 = (("00" + #2#9) % -102) + (("000" + #2#10) % -103);
     #99#15 = #2#11;
     #99#16 = #2#12;
     #99#17 = #2#14;
     #99#18 = #0#0;
     #99#19 = #0#1;

     nCanti = #1#8;                    |HAZ Valor12;  #99#20 = aCanti;
     nCanti = #1#8 - #1#26 + #1#37;    |HAZ Valor12;  #99#21 = aCanti;
     nCanti = #1#37;                   |HAZ Valor12;  #99#22 = aCanti;
     nCanti = #1#26;                   |HAZ Valor12;  #99#23 = aCanti;

     nEl27 = 0;
     |SI #1#27 > 0;
         nCanti = #1#27;
         |HAZ Valor12;
         #99#24 = aCanti;
         nEl27 = nCanti;
     |FINSI;

     |SI #0#0 [ 1998;
         nCanti = #1#25;                   |HAZ Valor12;  #99#25 = aCanti;
         nCanti = #1#28;                   |HAZ Valor12;  #99#26 = aCanti;
     |SINO;
         nCanti = #1#28;                   |HAZ Valor12;  #99#25 = aCanti;
         nCanti = #1#25;                   |HAZ Valor12;  #99#26 = aCanti;
     |FINSI;

     nCanti = nEl27 - #1#25 - #1#28;
     |SI nCanti > 0;
         |HAZ Valor12;
         #99#27  = aCanti;
     |SINO;
         #99#27 = 0;
     |FINSI;

     nCanti = #1#30;  |HAZ Valor12;  #99#28 = aCanti;
     nCanti = #1#31;  |HAZ Valor12;  #99#29 = aCanti;
     nCanti = #1#36;  |HAZ Valor12;  #99#30 = aCanti;

     nCanti = #1#31 - #1#36;
     |SI nCanti > 0;
         |HAZ Valor12;
         #99#31  = aCanti;
     |FINSI;

     nCanti = #1#29;
     |SI nCanti > 0;
         |HAZ Valor12;
         #99#32  = aCanti;
         #99#34  = aCanti;
     |SINO;
         #99#33 = "X";
     |FINSI;

     #99#37 = #2#66;
     #99#38 = #2#67;
     #99#39 = #2#68;
     #99#40 = #2#69;
     #99#41 = #2#11;
     #99#42 = dia;
     #99#43 = mes;
     |SI #0#0 [ 1998;
         #99#44 = #0#3 % -101;
     |SINO;
         #99#44 = #0#3 % -104;
     |FINSI;
     #99#45 = &13 + &10;
|FPRC;

|PROCESO Secuencial130_2001;
     Raiz       = "";  |DIRECTORIO Raiz;
     Directorio = "";
     |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + eaTipoSec;
     |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;

     Empresa  = ("00000" + #1#0) % -105;

     Fichero    = eaTipoSec + Empresa;
     INEmpresas = NEmpresas1 <-;
     INEmpresas = INEmpresas + NACopiar;
     NFichero   = Directorio + Fichero;          |QBF NFichero;
     NEmpresas  = NFichero;
     NACopiar   = NACopiar + 1;

     Fichero  = "wb  "+ NFichero;

     Pos = -1;
     |FABRE Fichero;
     Handle = FSalida;
     |SI FSalida ] 0;
         |HAZ Carga130_2001;
         |SI eaMoneda = "E";
            #99#1 = "132";
            nCanti = #99#24 - #99#25 - #99#26; |SI nCanti < 0; nCanti = 0; |FINSI;
            aCanti = (("0" * 12) + nCanti) %-112; #99#27 = aCanti;
            nCanti = #99#29 - #99#30; |SI nCanti < 0; nCanti = 0; |FINSI;
            aCanti = (("0" * 12) + nCanti) %-112; #99#31 = aCanti;
            |PARA nCampo = 1;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo = 22;
                   |SI #0#0 [ 1998;
                       Cadena = Handle + " " + #99nCampo;
                   |FINSI;
               |SINO;
                   Cadena = Handle + " " + #99nCampo;
               |FINSI;
               |FGRABA Cadena;
            |SIGUE;
            nCanti = #99#27 + #99#31; aCanti = (("0" * 12) + nCanti) %-112; Cadena = aCanti;
            Cadena = Handle + " " + Cadena + "000000000000"; |FGRABA Cadena;
            nCanti = #99#27 + #99#31; aCanti = (("0" * 12) + nCanti) %-112; Cadena = aCanti;
            nCanti = #99#27 + #99#31; aCanti = (("0" * 12) + nCanti) %-112; Cadena = Cadena + aCanti;
            Cadena = Handle + " " + Cadena; |FGRABA Cadena;
            |PARA nCampo = 35;  |SI nCampo [ 40;  |HACIENDO nCampo = nCampo + 1;
                Cadena = Handle + " " + #99nCampo; |FGRABA Cadena;
            |SIGUE;
            Cadena = Handle + " " + #99#33; |FGRABA Cadena;
            Cadena = Handle + "               "; |FGRABA Cadena;
            Cadena = #99#41; Cadena = Cadena % 0116;
            Cadena = Handle + " " + Cadena; |FGRABA Cadena;
            |PARA nCampo = 42;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
                Cadena = Handle + " " + #99nCampo; |FGRABA Cadena;
            |SIGUE;
         |SINO;
            #99#1 = "130";
            |PARA nCampo = 1;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo = 44;  |Y #0#0 [ 1998;
                   Cadena = Handle + " " + (#99nCampo % 101);
               |SINO;
                   |SI nCampo = 22;
                       |SI #0#0 [ 1998;
                           Cadena = Handle + " " + #99nCampo;
                       |FINSI;
                   |SINO;
                       Cadena = Handle + " " + #99nCampo;
                   |FINSI;
               |FINSI;
               |FGRABA Cadena;
            |SIGUE;
         |FINSI;
     |FINSI;
     FSalida = Handle;
     |FCIERRA FSalida;
|FPRC;

|PROCESO CargaImprime;
     aAlfa = "del err" + (("00000" + #1#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:130" + (("00000" + #1#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #1#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #601#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL " + "130" + (("00000" + #1#0) % -105) + ".TXT ";
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion;
     |SI #1#29 > 0;
         enNume = #1#29;  |HAZ Conver13;  #542#36 = eaAlfa;

         |SI #0#6 = "S";  |O #0#6 = "D";
             |SI #2#69 = "          ";
                  #542#37  = "X";
             |SINO;
                  #542#38 = "X";
                  #542#39 = #2#66;
                  #542#40 = #2#67;
                  #542#41 = #2#68;
                  #542#42 = #2#69;
             |FINSI;
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #542#36 = eaAlfa;
      |FINSI;

      #542#4 = "";
      |SI #0#4 = "L";
          |SI #1#29 [ 0;  #542#4 = "N";  |FINSI;
      |SINO;
          |SI #1#29 > 0;
              |SI #2#69 = "          ";
                  #542#4 = "I";
              |SINO;
                  #542#4 = "G";
              |FINSI;
          |SINO;
              #542#4 = "N";
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2002;
     |SI #0#4 = "L";
         aAbre = eaUnidadBasico + "\MODELOS\130\" + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#4 = "F";
         aAbre = eaInternet + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |DDEFECTO #542;

     #542#1   = "130";
     #542#2   = "01";
     #542#3   = "";

     #542#5   = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);
     aAlfa    = #2#13;  |QBF aAlfa;
     #542#6   = ("000000000" + aAlfa) % -109;
     eaAlfa   = #2#102;  |HAZ QuitaRaros;     #542#7   = eaAlfa;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #542#8   = eaAlfa;
     #542#9   = ".";
     eaAlfa   = #2#3;    |HAZ QuitaRaros;     #542#10  = eaAlfa;
     eaAlfa   = #2#4;    |HAZ QuitaRaros;     #542#11  = eaAlfa;
     #542#12  = #2#5;
     #542#13  = #2#6;
     #542#14  = #2#7;
     #542#15  = #2#8;
     #542#16  = (("00" + #2#9) % -102) + (("000" + #2#10) % -103);
     eaAlfa   = #2#11;   |HAZ QuitaRaros;     #542#17  = eaAlfa;
     eaAlfa   = #2#12;   |HAZ QuitaRaros;     #542#18  = eaAlfa;
     eaAlfa   = #2#14;   |HAZ QuitaRarosTfno; #542#19 = eaAlfa;

     #542#20  = #0#0;
     #542#21  = #0#1 + "T";

     enNume  = #1#8;           |HAZ Conver13;  #542#22 = eaAlfa;
     enNume  = #1#8 - #1#22;   |HAZ Conver13;  #542#23 = eaAlfa;
     enNume  = #1#22;          |HAZ Conver13;  #542#24 = eaAlfa;

     nEl27   = 0;
     |SI #1#27 > 0;
         enNume  = #1#27;      |HAZ Conver13;  #542#25 = eaAlfa;
         nEl27   = #1#27;
     |FINSI;

     enNume  = #1#28;                    |HAZ Conver13;  #542#26 = eaAlfa;
     enNume  = #1#25;                    |HAZ Conver13;  #542#27 = eaAlfa;
     enNume  = nEl27 - #1#28 - #1#25;
     |SI enNume > 0;
         |HAZ Conver13;  #542#28 = eaAlfa;
     |FINSI;

     enNume  = #1#30;                    |HAZ Conver13;  #542#29 = eaAlfa;
     enNume  = #1#31;                    |HAZ Conver13;  #542#30 = eaAlfa;
     enNume  = #1#36;                    |HAZ Conver13;  #542#31 = eaAlfa;

     enNume  = #1#31 - #1#36;
     |SI enNume > 0;
         |HAZ Conver13;  #542#32 = eaAlfa;
     |FINSI;

     enNume  = #1#29;
     |SI enNume > 0;
         |HAZ Conver13;  #542#33 = eaAlfa;
                         #542#35 = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion;

     |SI #1#38 = "S";
         #542#43 = #1#40;
         #542#44 = #1#39;
     |FINSI;

     eaAlfa  = #2#89;          |HAZ QuitaRaros;     #542#45  = eaAlfa;
     eaAlfa  = #2#90 + #2#91;  |HAZ QuitaRarosTfno; #542#46  = eaAlfa;

     eaAlfa  = #0#3;     |HAZ FechaBonito;
     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #542#51 = eaAlfa;
     #542#52 = eaDiaB;
     #542#53 = eaMesB;
     #542#54 = eaAnyoB;
     #542#55 = &13 + &10;

     |SI #0#4 = "L";
         #542#7  = "";
         #542#43 = "";
         #542#45 = "";
         #542#46 = "";
         #542#47 = "";
         #542#48 = "";
         #542#49 = "";
         #542#50 = "";
         nTCampo = 55;
     |FINSI;

     |SI #0#4 = "F";
         #542#2  = "";
         #542#3  = "";
         #542#5  = "";
         #542#8  = "";
         #542#9  = "";
         #542#10 = "";
         #542#11 = "";
         #542#12 = "";
         #542#13 = "";
         #542#14 = "";
         #542#15 = "";
         #542#16 = "";
         #542#17 = "";
         #542#18 = "";
         #542#19 = "";
         #542#37 = "";
         #542#38 = "";
         #542#39 = "";
         #542#40 = "";
         #542#41 = "";
         #542#42 = "";
         #542#51 = "";
         #542#52 = "";
         #542#53 = "";
         #542#54 = "";
         #542#55 = "";
         nTCampo = 54;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #542nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#4 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO TDeclaracion_2007;
     |SI #1#29 > 0;
         enNume = #1#29;  |HAZ Conver13;  #570#26 = eaAlfa;

         |SI #0#6 = "S";  |O #0#6 = "D";
             |SI #2#69 = "          ";
                  #570#27  = "1";
             |SINO;
                  #570#27 = "2";
                  |SI #0#4 = "F"; |Y #0#6 = "D";
                      #570#27 = "3";
                  |FINSI;
                  #570#28 = #2#66;
                  #570#29 = #2#67;
                  #570#30 = #2#68;
                  #570#31 = #2#69;
             |FINSI;
         |SINO;
              #570#27  = "1";
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #570#26 = eaAlfa;
                                       #570#27 = "0";
      |FINSI;

      #570#4 = "";
      |SI #0#4 = "L";
          |SI #1#29 [ 0;  #570#4 = "N";  |FINSI;
      |SINO;
          #570#4 = "N";
          |SI #1#29 > 0;
                                  #570#4 = "I";
              |SI #0#6 = "A";     #570#4 = "A";  |FINSI;
              |SI #570#27 = "3";  #570#4 = "U";  |FINSI;
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2007;
     |SI #0#4 = "L";
         aAbre = eaUnidadBasico + "\MODELOS\130\" + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#4 = "F";
         aAbre = eaInternet + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |DDEFECTO #570;

     #570#1   = "130";
     #570#2   = "01";
     #570#3   = "";

     #570#5   = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);
     aAlfa    = #2#13;  |QBF aAlfa;
     #570#6   = ("000000000" + aAlfa) % -109;
     eaAlfa   = #2#102;  |HAZ QuitaRaros;     #570#7   = eaAlfa;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #570#8   = eaAlfa;
     #570#9   = ".";

     #570#10  = #0#0;
     #570#11  = #0#1 + "T";

     enNume  = #1#8;           |HAZ Conver13;  #570#12 = eaAlfa;
     enNume  = #1#8 - #1#22;   |HAZ Conver13;  #570#13 = eaAlfa;
     enNume  = #1#22;          |HAZ Conver13;  #570#14 = eaAlfa;

     nEl27   = 0;
     |SI #1#27 > 0;
         enNume  = #1#27;      |HAZ Conver13;  #570#15 = eaAlfa;
         nEl27   = #1#27;
     |FINSI;

     enNume  = #1#28;                    |HAZ Conver13;  #570#16 = eaAlfa;
     enNume  = #1#25;                    |HAZ Conver13;  #570#17 = eaAlfa;
     enNume  = nEl27 - #1#28 - #1#25;    |HAZ Conver13;  #570#18 = eaAlfa;

     enNume  = #1#30;                    |HAZ Conver13;  #570#19 = eaAlfa;
     enNume  = #1#31;                    |HAZ Conver13;  #570#20 = eaAlfa;
     enNume  = #1#36;                    |HAZ Conver13;  #570#21 = eaAlfa;

     enNume  = #1#31 - #1#36;            |HAZ Conver13;  #570#22 = eaAlfa;

     enNume  = #1#29;
     |SI enNume > 0;
         |HAZ Conver13;  #570#23 = eaAlfa;
                         #570#25 = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion_2007;

     |SI #1#38 = "S";
         #570#32 = #1#40;
         #570#33 = #1#39;
     |FINSI;

     eaAlfa  = #2#89;          |HAZ QuitaRaros;     #570#34  = eaAlfa;
     eaAlfa  = #2#90 + #2#91;  |HAZ QuitaRarosTfno; #570#35  = eaAlfa;

     eaAlfa  = #0#3;     |HAZ FechaBonito;
     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #570#40 = eaAlfa;
     #570#41 = eaDiaB;
     #570#42 = eaMesB;
     #570#43 = eaAnyoB;
     #570#44 = &13 + &10;

     |SI #0#4 = "L";
         #570#7  = "";
         #570#32 = "";
         #570#34 = "";
         #570#35 = "";
         #570#36 = "";
         #570#37 = "";
         #570#38 = "";
         #570#39 = "";
         nTCampo = 44;
     |FINSI;

     |SI #0#4 = "F";
         #570#2  = "";
         #570#3  = "";
         #570#5  = "";
         #570#40 = "";
         #570#41 = "";
         #570#42 = "";
         #570#43 = "";
         #570#44 = "";
         nTCampo = 43;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #570nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#4 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO TDeclaracion_2008_04;
     |SI #1#46 > 0;
         enNume = #1#46;  |HAZ Conver13;  #576#30 = eaAlfa;

         |SI #0#6 = "S";  |O #0#6 = "D";
             |SI #2#69 = "          ";
                  #576#31  = "1";
             |SINO;
                  #576#31 = "2";
                  |SI #0#4 = "F"; |Y #0#6 = "D";
                      #576#31 = "3";
                  |FINSI;
                  #576#32 = #2#66;
                   #576#33 = #2#67;
                  #576#34 = #2#68;
                  #576#35 = #2#69;
             |FINSI;
         |SINO;
              #576#31  = "1";
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #576#31 = eaAlfa;
                                       #576#31 = "0";
         |SI #1#46 < 0; |Y #1#2 ! 4; #576#36 = "X"; |FINSI;
      |FINSI;

      #576#4 = "";
      |SI #0#4 = "L";
          |SI #1#46 [ 0; |Y #576#36 = " ";  #576#4 = "N";  |FINSI;
      |SINO;
          #576#4 = "N";
          |SI #1#46 > 0;
                                              #576#4 = "I";
              |SI #0#6 = "A"; |Y #0#0 < 2013; #576#4 = "A";  |FINSI;
              |SI #576#31 = "3";              #576#4 = "U";  |FINSI;
          |FINSI;
          |SI #1#46 < 0;|Y #1#2 ! 4; #576#4 = "B"; |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2008_04;
     |SI #0#4 = "L";
         aAbre = eaUnidadBasico + "\MODELOS\130\" + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#4 = "F";
         aAbre = eaInternet + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |DDEFECTO #576;

     #576#1   = "130";
     #576#2   = "01";
     #576#3   = "";

     #576#5   = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);
     aAlfa    = #2#13;  |QBF aAlfa;
     #576#6   = ("000000000" + aAlfa) % -109;
     eaAlfa   = #2#102;  |HAZ QuitaRaros;     #576#7   = eaAlfa;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #576#8   = eaAlfa;
     #576#9   = ".";

     #576#10  = #0#0;
     #576#11  = #0#1 + "T";

     enNume  = #1#8;           |HAZ Conver13;  #576#12 = eaAlfa;
     enNume  = #1#8 - #1#22;   |HAZ Conver13;  #576#13 = eaAlfa;
     enNume  = #1#22;          |HAZ Conver13;  #576#14 = eaAlfa;

     nEl27   = 0;
     |SI #1#27 > 0;
         enNume  = #1#27;      |HAZ Conver13;  #576#15 = eaAlfa;
         nEl27   = #1#27;
     |FINSI;

     enNume  = #1#28;                    |HAZ Conver13;  #576#16 = eaAlfa;
     enNume  = #1#25;                    |HAZ Conver13;  #576#17 = eaAlfa;
     enNume  = nEl27 - #1#28 - #1#25;    |HAZ Conver13;  #576#18 = eaAlfa;

     enNume  = #1#30;                    |HAZ Conver13;  #576#19 = eaAlfa;
     enNume  = #1#31;                    |HAZ Conver13;  #576#20 = eaAlfa;
     enNume  = #1#36;                    |HAZ Conver13;  #576#21 = eaAlfa;

     enNume  = #1#31 - #1#36;            |HAZ Conver13;  #576#22 = eaAlfa;

     enNume  = #1#29;                    |HAZ Conver13;  #576#23 = eaAlfa;

     enNume  = #1#41;                    |HAZ Conver13;  #576#24 = eaAlfa;
     enNume  = #1#42;                    |HAZ Conver13;  #576#25 = eaAlfa;
     enNume  = #1#43;                    |HAZ Conver13;  #576#26 = eaAlfa;
     enNume  = #1#44;                    |HAZ Conver13;  #576#27 = eaAlfa;
     enNume  = #1#45;                    |HAZ Conver13;  #576#28 = eaAlfa;
     enNume  = #1#46;                    |HAZ Conver13;  #576#29 = eaAlfa;

     |HAZ TDeclaracion_2008_04;

     |SI #1#38 = "S";
         #570#37 = #1#40;
         #570#38 = #1#39;
     |FINSI;

     eaAlfa  = #2#89;          |HAZ QuitaRaros;     #576#39  = eaAlfa;
     eaAlfa  = #2#90 + #2#91;  |HAZ QuitaRarosTfno; #576#40  = eaAlfa;

     eaAlfa  = #0#3;     |HAZ FechaBonito;
     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #576#45 = eaAlfa;
     #576#46 = eaDiaB;
     #576#47 = eaMesB;
     #576#48 = eaAnyoB;
     #576#49 = &13 + &10;

     |SI #0#4 = "L";
         #576#7  = "";
         #576#37 = "";
         #576#39 = "";
         #576#40 = "";
         #576#41 = "";
         #576#42 = "";
         #576#43 = "";
         #576#44 = "";
         nTCampo = 49;
     |FINSI;

     |SI #0#4 = "F";
         #576#2  = "";
         #576#3  = "";
         #576#5  = "";
         #576#45 = "";
         #576#46 = "";
         #576#47 = "";
         #576#48 = "";
         #576#49 = "";
         nTCampo = 48;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #576nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#4 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO TDeclaracion_2009;

     |SI #1#46 > 0;
         enNume = #1#46;  |HAZ Conver13;  #593#31 = eaAlfa;

         |SI #0#6 = "S";  |O #0#6 = "D";
             |SI #2#69 = "          ";
                  #593#32  = "1";
             |SINO;
                  #593#32 = "2";
                  |SI #0#4 = "F"; |Y #0#6 = "D";
                      #593#32 = "3";
                  |FINSI;
                  #593#33 = #2#66;
                  #593#34 = #2#67;
                  #593#35 = #2#68;
                  #593#36 = #2#69;
             |FINSI;
         |SINO;
              #593#32  = "1";
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #593#32 = eaAlfa;
                                       #593#32 = "0";
         |SI #1#46 < 0; |Y #1#2 ! 4;   #593#37 = "X"; |FINSI;
      |FINSI;

      #593#4 = "";
      |SI #0#4 = "L";
          |SI #1#46 [ 0; |Y #593#37 = " ";   #593#4 = "N";  |FINSI;
      |SINO;
          #593#4 = "N";
          |SI #1#46 > 0;
                                  #593#4 = "I";
              |SI #0#6    = "A";  #593#4 = "A";  |FINSI;
              |SI #593#32 = "3";  #593#4 = "U";  |FINSI;
          |FINSI;
          |SI #1#46 < 0;|Y #1#2 ! 4; #593#4 = "B"; |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2009;
     |SI #0#4 = "L";
         aAbre = eaUnidadBasico + "\MODELOS\130\" + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#4 = "F";
         aAbre = eaInternet + "130" + (("00000" + #1#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |DDEFECTO #593;

     #593#1   = "130";
     #593#2   = "01";
     #593#3   = "";

     #593#5   = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);
     aAlfa    = #2#13;  |QBF aAlfa;
     #593#6   = ("000000000" + aAlfa) % -109;
     eaAlfa   = #2#102;  |HAZ QuitaRaros;     #593#7   = eaAlfa;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #593#8   = eaAlfa;
     #593#9   = ".";

     #593#10  = #0#0;
     #593#11  = #0#1 + "T";

     enNume  = #1#8;           |HAZ Conver13;  #593#12 = eaAlfa;
     enNume  = #1#8 - #1#22;   |HAZ Conver13;  #593#13 = eaAlfa;
     enNume  = #1#22;          |HAZ Conver13;  #593#14 = eaAlfa;

     nEl27   = 0;
     |SI #1#27 > 0;
         enNume  = #1#27;      |HAZ Conver13;  #593#15 = eaAlfa;
         nEl27   = #1#27;
     |FINSI;

     enNume  = #1#28;                    |HAZ Conver13;  #593#16 = eaAlfa;
     enNume  = #1#25;                    |HAZ Conver13;  #593#17 = eaAlfa;
     enNume  = nEl27 - #1#28 - #1#25;    |HAZ Conver13;  #593#18 = eaAlfa;

     enNume  = #1#30;                    |HAZ Conver13;  #593#19 = eaAlfa;
     enNume  = #1#31;                    |HAZ Conver13;  #593#20 = eaAlfa;
     enNume  = #1#36;                    |HAZ Conver13;  #593#21 = eaAlfa;

     enNume  = #1#31 - #1#36;            |HAZ Conver13;  #593#22 = eaAlfa;

     enNume  = #1#29;                    |HAZ Conver13;  #593#23 = eaAlfa;

     enNume  = #1#41;                    |HAZ Conver13;  #593#24 = eaAlfa;
     enNume  = #1#42;                    |HAZ Conver13;  #593#25 = eaAlfa;
     enNume  = #1#43;                    |HAZ Conver13;  #593#26 = eaAlfa;
     enNume  = #1#47;                    |HAZ Conver13;  #593#27 = eaAlfa;
     enNume  = #1#44;                    |HAZ Conver13;  #593#28 = eaAlfa;
     enNume  = #1#45;                    |HAZ Conver13;  #593#29 = eaAlfa;
     enNume  = #1#46;                    |HAZ Conver13;  #593#30 = eaAlfa;

     |HAZ TDeclaracion_2009;

     |SI #1#38 = "S";
         #593#38 = #1#40;
         #593#39 = #1#39;
     |FINSI;

     eaAlfa  = #2#89;          |HAZ QuitaRaros;     #593#40  = eaAlfa;
     eaAlfa  = #2#90 + #2#91;  |HAZ QuitaRarosTfno; #593#41  = eaAlfa;

     eaAlfa  = #0#3;     |HAZ FechaBonito;
     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #593#46 = eaAlfa;
     #593#47 = eaDiaB;
     #593#48 = eaMesB;
     #593#49 = eaAnyoB;
     #593#50 = &13 + &10;

     |SI #0#4 = "L";
         #593#7  = "";
         #593#38 = "";
         #593#40 = "";
         #593#41 = "";
         #593#42 = "";
         #593#43 = "";
         #593#44 = "";
         #593#45 = "";
         nTCampo = 50;
     |FINSI;

     |SI #0#4 = "F";
         #593#2  = "";
         #593#3  = "";
         #593#5  = "";
         #593#46 = "";
         #593#47 = "";
         #593#48 = "";
         #593#49 = "";
         #593#50 = "";
         nTCampo = 49;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #593nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#4 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO imprimir;
     sw = 1;
     |SI #0#4 = "O";  |O #0#4 = "B";
         |PRINT;
     |SINO;
         |SI #0#0 [ 2001;
             |HAZ Secuencial130_2001;
         |FINSI;

         |SI #0#0 ] 2002;  |Y #0#0 [ 2006;
             |HAZ Carga130_2002;
         |FINSI;

         |SI #0#0 = 2007;
             |HAZ Carga130_2007;
         |FINSI;

         |SI #0#0 = 2008;
             |SI #0#1 ] 2;
                 |HAZ Carga130_2008_04;
             |SINO;
                 |HAZ Carga130_2007;
             |FINSI;
         |FINSI;

         |SI #0#0 ] 2009;
             |HAZ Carga130_2009;
         |FINSI;
     |FINSI;

     |LIBERA #1;
|FPRC;

|PROCESO graba1;
    |SI #0#4 = "B"; |ACABA; |FINSI;

    #1#4 = #0#3;
    #1#5 = "S";
    |GRABA 021#1a;
    |LIBERA #1;
     se_empre  = #1#0;
     se_ejerc  = #1#3;
     se_modelo = "130";
     se_impor  = #1#29;
     |SI #0#0 = 2008; |Y #0#1 ] 2;
         se_impor = #1#46;
     |FINSI;
     se_fecha  = #1#4;
     |SI SwAgicli = 1;
         |HAZ AlAgicl2;
     |FINSI;
|FPRC;

|DEFBUCLE mira_130;
     #1#1;
     5;
     d_emp, d_act, #0#1 , nAnyo2D, imsn1;
     h_emp, h_act, #0#1 , nAnyo2D, imsn2;
     e;
     NULL , imprimir;
|FIN;

|DEFBUCLE graba_130;
     #1#1;
     5;
     d_emp, d_act, #0#1 , nAnyo2D, "N";
     h_emp, h_act, #0#1 , nAnyo2D, "N";
     be;
     NULL , graba1;
|FIN;

|PROCESO fecha;
     dia  = #0#3 % 102;
     anyo = #0#3 % 704;
     mes  = #0#3 % 402;
     mes1 = mes;
     |SI mes1 = 1;  mes = "ENERO";      |FINSI;
     |SI mes1 = 2;  mes = "FEBRERO";    |FINSI;
     |SI mes1 = 3;  mes = "MARZO";      |FINSI;
     |SI mes1 = 4;  mes = "ABRIL";      |FINSI;
     |SI mes1 = 5;  mes = "MAYO";       |FINSI;
     |SI mes1 = 6;  mes = "JUNIO";      |FINSI;
     |SI mes1 = 7;  mes = "JULIO";      |FINSI;
     |SI mes1 = 8;  mes = "AGOSTO";     |FINSI;
     |SI mes1 = 9;  mes = "SEPTIEMBRE"; |FINSI;
     |SI mes1 = 10; mes = "OCTUBRE";    |FINSI;
     |SI mes1 = 11; mes = "NOVIEMBRE";  |FINSI;
     |SI mes1 = 12; mes = "DICIEMBRE";  |FINSI;
|FPRC;

|PROCESO reimpr;
     |SI #0#4 = "B";
         imsn1 = " ";  imsn2 = "z";
     |SINO;
         imsn1 = #0#5;  imsn2 = #0#5;
     |FINSI;
|FPRC;

|PROCESO Impresora;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #0#4 = "O";
         informe = inform1;
     |SINO;
         informe = "caemb130";
         |SI #0#0 = 2008; |Y #0#1 ] 2;
             informe = "caemn130";
         |FINSI;

         |SI #0#0 ] 2009;
             informe = "c2009130";
         |FINSI;
     |FINSI;
     |INFOR informe;
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |HAZ reimpr;
     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = #30#26;
     |LEE 001#2=;
     |SI FSalida = 0;
         |HAZ AlAgicl1; || leer Modulo Integrador. ....
         |HAZ fecha;
         |BUCLE mira_130;
         |SI sw = 1; |PIEINF; |FINSI;
         |SI #0#4 = "O"; |Y #0#5 = "N";
             |BUCLE graba_130;
         |FINSI;
     |SINO;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
     |FINSI;
     |FININF;
     |FINIMP;
     |CIERRA #2;
|FPRC;

|PROCESO AbreImprime;
     aAbre = eaUnidadBasico + "\MODELOS\130\imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = eaUnidadBasico + &13 + &10;         |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + eaUnidadBasico + "\MODELOS" + &13 + &10;           |XGRABA nHandle1, aAlfa;
     aAlfa = "CD 130" + &13 + &10;               |XGRABA nHandle1, aAlfa;

     aAlfa = #0#0;
     aAlfa = aAlfa % -102;
     aVersion = "";

     |SI #0#0 ] 2008;
         aVersion = "01";
         |SI #0#0 = 2008;
             |SI #0#1 ] 2;
                 aVersion = "02";
             |FINSI;
         |FINSI;
     |FINSI;

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = (aContiene1 % 102) > "";

     |SI aVersion = "";
         aAlfa = "ZLS" + aAlfa + "MPF.EXE /T:" + aUnidad + "\MODELOS\130\"+ &13 + &10;
     |SINO;
         aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + aUnidad + "\MODELOS\130\"+ &13 + &10;
     |FINSI;

     |XGRABA nHandle1, aAlfa;

     |SI #0#0 ] 2002;
         aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
         aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     eaModelos = "130";    |HAZ Copiampf;

     aAlfa = eaUnidadBasico + "\MODELOS\130\IMPRIME";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO Laser;
     imsn1 = #0#5;  imsn2 = #0#5;

     |SI #0#0 ] 2002;
         |SI #0#4 = "L";
             |PARA;  |SI;  |HACIENDO;
                  |DDEFECTO #601;
                  |PINPA #0#601;
                  |PINDA #0#601;
                  |ENDATOS #1#601;
                  |SI FSalida = 0;
                      aAlfa = eaUnidadBasico + "/MODELOS";          |RMKDIR aAlfa;
                      aAlfa = eaUnidadBasico + "/MODELOS/130";      |RMKDIR aAlfa;
                      |HAZ AbreImprime;
                      |SAL;
                  |FINSI;
             |SIGUE;
          |FINSI;

          |SI #0#4 = "F";
              aAlfa      = eaUnidadBasico + "/AEAT";                       |RMKDIR aAlfa;
              aAlfa      = eaUnidadBasico + "/AEAT/INTERNET";              |RMKDIR aAlfa;
              aAlfa      = eaUnidadBasico + "/AEAT/INTERNET/130";          |RMKDIR aAlfa;
              aAlfa      = eaUnidadBasico + "/AEAT/INTERNET/130/" + #0#0;  |RMKDIR aAlfa;
              eaInternet = aAlfa + "/";
          |FINSI;
     |FINSI;

     nSwHay = 0;

     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = #30#26;
     |LEE 001#2=;
     |SI FSalida = 0;
         |HAZ AlAgicl1; || leer Modulo Integrador. ....
         |HAZ fecha;
         |BUCLE mira_130;
         |SI  #0#5 = "N";   |BUCLE graba_130;  |FINSI;
     |SINO;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
     |FINSI;
     |CIERRA #2;

     |SI #0#4 = "L";
         |SI #0#0 [ 2001;
             |SI sw = 1;  |HAZ GrabaDisketteL;  |FINSI;
         |FINSI;

         |SI #0#0 ] 2002;
             |SI nSwHay = 1;
                 |HAZ EmiteEsto;
                 eaTipoSec = "130";
                 eaTipoEmi = "ERRORES";
                 enAnyo    = #0#0;
                 |SUB_EJECUTA "eosz9999";
             |SINO;
                 |MENAV "     Seleccion Vacia";
                 |XCIERRA nHandle1;
             |FINSI;

             aAlfa = eaUnidadBasico + "\MODELOS\130\imprime.bat";
             |RFBORRA aAlfa;
         |FINSI;
     |FINSI;

     |SI #0#4 = "F";  |Y #0#0 ] 2002;
         |SI nSwHay = 1;
             aAlfa =  "      Ficheros Generados. Situados en " + eaInternet + " de su PC";
             |MENAV aAlfa;
         |SINO;
             |MENAV "     Seleccion Vacia";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2012;
     |SI #0#4 = "L"; |O #0#4 = "F";  |HAZ Laser;      |FINSI;
     |SI #0#4 = "O"; |O #0#4 = "B";  |HAZ Impresora;  |FINSI;
|FPRC;
|| --------------------------------------------------------------------------
|PROCESO Carga130_2013;
     |DDEFECTO #593;

     #593#1   = "130";
     #593#2   = "01";
     #593#3   = "";

     #593#5   = (("00" + #2#16) % -102) + (("000" + #2#17) % -103);
     aAlfa    = #2#13;  |QBF aAlfa;
     #593#6   = ("000000000" + aAlfa) % -109;
     eaAlfa   = #2#102;  |HAZ QuitaRaros;     #593#7   = eaAlfa;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #593#8   = eaAlfa;
     #593#9   = ".";

     #593#10  = #0#0;
     #593#11  = #0#1 + "T";

     enNume  = #1#8;           |HAZ Conver13;  #593#12 = eaAlfa;
     enNume  = #1#8 - #1#22;   |HAZ Conver13;  #593#13 = eaAlfa;
     enNume  = #1#22;          |HAZ Conver13;  #593#14 = eaAlfa;

     nEl27   = 0;
     |SI #1#27 > 0;
         enNume  = #1#27;      |HAZ Conver13;  #593#15 = eaAlfa;
         nEl27   = #1#27;
     |FINSI;

     enNume  = #1#28;                    |HAZ Conver13;  #593#16 = eaAlfa;
     enNume  = #1#25;                    |HAZ Conver13;  #593#17 = eaAlfa;
     enNume  = nEl27 - #1#28 - #1#25;    |HAZ Conver13;  #593#18 = eaAlfa;

     enNume  = #1#30;                    |HAZ Conver13;  #593#19 = eaAlfa;
     enNume  = #1#31;                    |HAZ Conver13;  #593#20 = eaAlfa;
     enNume  = #1#36;                    |HAZ Conver13;  #593#21 = eaAlfa;

     enNume  = #1#31 - #1#36;            |HAZ Conver13;  #593#22 = eaAlfa;

     enNume  = #1#29;                    |HAZ Conver13;  #593#23 = eaAlfa;

     enNume  = #1#41;                    |HAZ Conver13;  #593#24 = eaAlfa;
     enNume  = #1#42;                    |HAZ Conver13;  #593#25 = eaAlfa;
     enNume  = #1#43;                    |HAZ Conver13;  #593#26 = eaAlfa;
     enNume  = #1#47;                    |HAZ Conver13;  #593#27 = eaAlfa;
     enNume  = #1#44;                    |HAZ Conver13;  #593#28 = eaAlfa;
     enNume  = #1#45;                    |HAZ Conver13;  #593#29 = eaAlfa;
     enNume  = #1#46;                    |HAZ Conver13;  #593#30 = eaAlfa;

     |HAZ TDeclaracion_2009;

     |SI #1#38 = "S";
         #593#38 = #1#40;
         #593#39 = #1#39;
     |FINSI;

     eaAlfa  = #2#89;          |HAZ QuitaRaros;     #593#40  = eaAlfa;
     eaAlfa  = #2#90 + #2#91;  |HAZ QuitaRarosTfno; #593#41  = eaAlfa;

     eaAlfa  = #0#3;     |HAZ FechaBonito;
     eaAlfa  = #2#11;    |HAZ QuitaRaros;     #593#46 = eaAlfa;
     #593#47 = eaDiaB;
     #593#48 = eaMesB;
     #593#49 = eaAnyoB;
     #593#50 = &13 + &10;

     |SI nTecla = 1;
         #593#7  = "";
         #593#38 = "";
         #593#40 = "";
         #593#41 = "";
         #593#42 = "";
         #593#43 = "";
         #593#44 = "";
         #593#45 = "";
         nTCampo = 50;
     |FINSI;

     |SI nTecla = 3;
         #593#2  = "";
         #593#3  = "";
         #593#5  = "";
         #593#46 = "";
         #593#47 = "";
         #593#48 = "";
         #593#49 = "";
         #593#50 = "";
         nTCampo = 49;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #593nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     nSwHay = 1;
|FPRC;

|PROCESO imprimir_2013;
     sw = 1;

     eaFicheroPlano = "130" + (("00000" + #2#0) % -105) + ".txt";
     eaFicheroImpre = "130" + (("00000" + #2#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #2#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Carga130_2013;
     |XCIERRA nHandle2;

     |LIBERA #1;

     enEmpresa    = #2#0;
     eaNomEmpresa = #2#2;

     |SI enTecla = 3;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroIP;

          |ACABA;
     |FINSI;

     |HAZ PresentaMPF;
|FPRC;

|DEFBUCLE mira_130_2013;
     #1#1;
     5;
     d_emp, d_act, #0#1 , nAnyo2D, imsn1;
     h_emp, h_act, #0#1 , nAnyo2D, imsn2;
     e;
     NULL , imprimir_2013;
|FIN;

|PROCESO Bloque2013;
     |HAZ LeeUnidad;
     eaModelos  = "130";
     eaPeriodo  = ("00" + enPer) % -102;

     |SI #0#1 = 1;  perialf = "1T"; |FINSI;
     |SI #0#1 = 2;  perialf = "2T"; |FINSI;
     |SI #0#1 = 3;  perialf = "3T"; |FINSI;
     |SI #0#1 = 4;  perialf = "4T"; |FINSI;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ BotonesMPF;
     nTecla = enTecla;
     |SI nTecla = 0;  |ACABA;  |FINSI;

     imsn1 = #0#5;  imsn2 = #0#5;

     nSwHay = 0;
     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = #30#26;
     |LEE 001#2=;
     |SI FSalida = 0;
         |HAZ AlAgicl1; || leer Modulo Integrador. ....
         |HAZ fecha;
         |BUCLE mira_130_2013;
         |SI  #0#5 = "N";   |BUCLE graba_130;  |FINSI;
     |SINO;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
     |FINSI;
     |CIERRA #2;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3"; |Y nSwHay ! 0;
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO impre; |TIPO 3;

     |HAZ LeeUnidadBasico;

     aAlfa     = #0#0 % -102;
     nAnyo2D   = aAlfa;
     enAnyo    = #0#0;
     eaTipoSec = "130";
     aTipoSec  = "130";
     enPer     = #0#1;
     eaEjer    = #0#0;

    |SI #0#0 = 2015;
        |HAZ eVerM130_2015;
        |SI enError15 ! 0;
            |CONFI "0000NDesea Continuar";
            |SI FSalida ! 0;
                |ACABA;
            |FINSI;
        |FINSI;
    |FINSI;

     |SI #0#0 [ 2012; |O #0#4 = "B"; |O #0#4 = "O";
         |HAZ Bloque2012;
         |ACABA;
     |FINSI;

     |SI #0#0 [ 2014;
         |HAZ Bloque2013;
         |ACABA;
     |FINSI;

     #caemi130#7 = #canempre#2;

     eaCampo0  = #caemi130#0;
     eaCampo1  = #caemi130#1;
     eaCampo2  = #caemi130#2;
     eaCampo3  = #caemi130#3;
     eaCampo4  = #caemi130#4;
     eaCampo5  = #caemi130#5;
     eaCampo6  = #caemi130#6;
     eaCampo7  = #caemi130#7;

     |SUB_EJECUTA "dsmoy130";
|FPRC;
