|| COPIADO original de 'imppcbox'

|FICHEROS;
     frigw001 #0;   ||Pantalla importacion
     impfich  #1;   ||Fichero de control path
     encopcbo #2;   ||fichero de apuntes enlace gestion

     camaasic #3;   ||Cabeceras Apuntes
     camaasil #4;   ||lineas de Apuntes
     caivarep #5;   ||iva Repercutido, Ventas
     caivasop #6;   ||Iva soportado compras
     camandia #7;   ||diarios
     calibros #8;   ||libros de iva
     caconcep #9;   ||Conceptos
     cacuenta #11;  ||Fichero de cuentas

     encorec  #12;  ||Fichero de Cobros Enlace Gesion
     camancob #13;  ||Fichero de Cobros
     camanrec #14;  ||Fichero de Tipos de Recibo
     camanpag #15;  ||Fichero de Pagos

     caclipro #16;  ||clientes/proveedores GENERAL

     imptmp1  #18;  ||temporal nuevos numeros de IVA

     catradia #19;  ||temporal niveles superiores

     impcafac #33;  ||Cambio N§ Factura en Cobros....

     caivases #34;  ||contador de series
     caivaasi #200; ||Control de asientos - iva

     reflejo@ #199;
|FIN;

|VARIABLES;
  &enDiario   = 0;
  &enContador = 0;

  nPeriodo    = 0;
  nSal        = 0;
  aFactuan    = "";
  &fichero    = "";
  fichero1    = "";
  &dir_fich1  = "";

  nDebe     = 0;
  nHaber    = 0;

  control   = 0;
  control1  = 0;
  asiento   = 0;
  fecha     = @;
  fecha1    = @;
  diario    = 0;
  asiehaber = 0;
  asiedebe  = 0;
  c_conh    = "";
  d_conh    = 0;
  c_cond    = "";
  d_cond    = 0;


  emprevi   = "";
  c = 0;
  i_factu = 0;
  conta   = 0;
  mensaje = "";
  contab  = "";
  nivel = 0;
  mes = ""; ||0
  fmes = "";
  lon = "";
  niv = 0;
  lon1 = "";
  ok = 0;
  p1 = "";
  cta = "";
  mess = 0;
  cuentaz = "";
  i = 0;
  pasar = 0;
  total = 0;          ||si la variable total = 0 actualizare los importes
  dia = 0;
  docu = 0;
  fech = @;
  ini = 0;
  mesac = 0;
  fecalf = "";
  mesfec = 0;
  a = 0;
  b = 0;
  c1 = 0;
  cuencli = "";
  nivcli = 0;
  nombre = "";
  cif = "";
  nombre1 = "";
  opera = "";
  importe = 0;
  ren_fra = 0;
  EsIva = 0;

  &feini   = @;
  &fefin   = @;

  nLibroR = 0;
  nLibroS = 0;
  nLibro  = 0;
  aLibro  = "";
  nNumFra = 0;

  nNuevo  = 0;
  aTipo   = "";
  nBase   = 0;
  nIva    = 0;
  nRec    = 0;
  aAlfa1  = "";
  aAlfa2  = "";
  nNume1  = 0;
  nNume2  = 0;

  &libro    = 0;
  &orden    = 0;
  &serie    = "";
  &pesetas  = 0;
  &cuenta   = "";
  &digito   = 0;
  &emision  = "";
  &enSwPase = 0;
  &nConcep  = 0;
  &aDesc    = "";
  nCBase    = 0;
  nCamRec1  = 0;
  nCamRec2  = 0;
  nCamRec3  = 0;
  nCamRec4  = 0;
  nCamRec5  = 0;
  nSwRec1   = 0;
  nSwRec2   = 0;
  nSwRec3   = 0;
  nSwRec4   = 0;
  nSwRec5  = 0;
|FIN;

|INCLUYE acceso_i;

|| ***************************************************************
|CALCULO mira;|TIPO 0;        ||miro que exista el registro en el control
     |ABRE #1;                ||de importacines
     #1#0=#0#1;
     |LEE 001#1=;
     |SI FSalida = 0;
          #0#2 = #1#1;
          |PINTA #0#2;
     |SINO;
          |MENAV "0000No Existe el Control Path Importaciones";
          |ERROR;
     |FINSI;
     |CIERRA #1;
|FCAL;


|| ***************************************************************************
|| ***************************************************************************
|| ***************************************************************************
|PROCESO LeeReflejo;

   |SI #199#11 = "D";
       aAlfa1 = #199#5 % 101;
       aAlfa2 = #199#5 % 102;
   |SINO;
       aAlfa1 = #199#6 % 101;
       aAlfa2 = #199#6 % 102;
   |FINSI;

   #199#9  = 1;
   #199#13 = aTipo;
   |SI aTipo = "R"; #199#9 = #200#5;  |FINSI;
   |SI aTipo = "S"; #199#9 = #200#31; |FINSI;

   |SI aTipo ! "";
       #199#14 = nLibro;
       #199#15 = aLibro;
       #199#16 = nNumFra;
       #199#18 = #199#9;
       #199#19 = #199#10;
       |SI aTipo = "R";
           |SI aAlfa1 = "4"; |Y #199#11 = "D"; #199#42 = "F"; #199#43 = 0; |FINSI;
           |SI aAlfa1 = "7";
               #199#42 = "B";
               |SI nCBase > 1;
                   nBase = 0;
               |SINO;
                   nBase = nBase + 1;
               |FINSI;
               #199#43 = nBase;
           |FINSI;
           |SI aAlfa2 = "47";
                |SI #199#25 = 0;
                    |SI #199#31 ! 0;
                        #199#42 = "R";
                        nRec    = nRec + 1;
                        #199#43 = nRec;
                    |FINSI;
                |SINO;
                    #199#42 = "I";
                    nIva    = nIva  + 1;
                    #199#43 = nIva;
                |FINSI;
          |FINSI;
       |SINO;
           |SI aAlfa1 ! "6"; |Y aAlfa2 ! "57";
               |SI #199#11 = "H";
                   #199#42 = "F"; #199#43 = 0;
               |FINSI;
           |FINSI;
           |SI aAlfa1 = "6";
               #199#42 = "B";
               |SI nCBase > 1;
                   nBase = 0;
               |SINO;
                   nBase = nBase + 1;
               |FINSI;
               #199#43 = nBase;
           |FINSI;
           |SI aAlfa2 = "47";
                |SI #199#25 = 0;
                    |SI #199#31 ! 0;
                        #199#42 = "R";
                        nRec    = nRec + 1;
                        #199#43 = nRec;
                    |FINSI;
                |SINO;
                    #199#42 = "I";
                    nIva    = nIva  + 1;
                    #199#43 = nIva;
                |FINSI;
           |FINSI;
       |FINSI;
   |FINSI;
   #199#47 = nNuevo;
   |GRABA 020#199a;
|FPRC;


|DEFBUCLE LeeReflejo;
 #199#1004;
 ;
 diario, fecha1, asiento, 00001;
 diario, fecha1, asiento, 99999;
 e;
 NULL, LeeReflejo;
|FIN;

|PROCESO Completo;
  |SI asiento = -1; |ACABA; |FINSI; || es la Primera

  nLibro  = 0;
  aLibro  = "";
  nNumFra = 0;
  nBase   = 0;
  nIva    = 0;
  nRec    = 0;
  |SI aTipo ! "";
      |ABRE #8;
      |SI aTipo = "R";
          #8#0 = nLibroR;
      |SINO;
          #8#0 = nLibroS;
      |FINSI;
      |LEE 101#8=;
      |SI FSalida ! 0;
          #8#1 = "LIBRO INEXISTENTE";
          #8#2 = aTipo;
          |GRABA 020#8b;
      |FINSI;
      nLibro  = #8#0;
      aLibro  = #8#1;
      nNumFra = #8#4;
      #8#4 = #8#4 + #8#3;
      |GRABA 020#8a;
      |LIBERA #8;
      |CIERRA #8;
  |FINSI;
  |BUCLE LeeReflejo;
  nNuevo = 0;
  nCBase = 0;
  aTipo  = "";
|FPRC;

|PROCESO ComplCampos;

   |SI diario ! #2#0; |O fecha1 ! #2#1; |O asiento ! #2#2;
       |HAZ Completo;
   |FINSI;

   |SI nNuevo = 0; ||No este grabado

       enDiario = #2#0;
       |HAZ contador;
       nNuevo = enContador;

       |ET otravez;
           #3#0 = #2#0;
           #3#1 = #2#1;
           #3#2 = nNuevo;
           |LEE 001#3=;
           |SI FSalida = 0;
               enDiario = #2#0;
               |HAZ contador;
               nNuevo = enContador;
               |VETE otravez;
           |SINO;
               nNuevo = enContador;
           |FINSI;

   |FINSI;

   |SI #2#11 = "D";
       aAlfa1 = #2#5 % 103;
   |SINO;
       aAlfa1 = #2#6 % 103;
   |FINSI;
   |SI #2#25 ! 0; |O #2#22 ! 0; |O #2#31 ! 0;
       |SI aAlfa1 = "477"; aTipo = "R"; |FINSI;
       |SI aAlfa1 = "472"; aTipo = "S"; |FINSI;
       nCBase = nCBase + 1;
   |FINSI;

   diario  = #2#0;
   fecha1  = #2#1;
   asiento = #2#2;
|FPRC;

|DEFBUCLE ComplCampos;
 #2#1;
 ;
 00, feini, 000001, 00001;
 99, fefin, 999999, 99999;
 ;
 NULL, ComplCampos, NULL, NULL, Completo;
|FIN;
|| ...........................

||**********************************************************************
||**********************************************************************
||**********************************************************************
|PROCESO Periodo;
 aAlfa1 = #4#1;
 aAlfa1 = aAlfa1 % 402;
 nNume1 = aAlfa1;
 nPeriodo = nNume1;
 |SI #200#46 = "T";
     |SI nNume1 [ 3;                 nPeriodo = 1; |FINSI;
     |SI nNume1 > 3; |Y nNume1 [ 6;  nPeriodo = 2; |FINSI;
     |SI nNume1 > 6; |Y nNume1 [ 9;  nPeriodo = 3; |FINSI;
     |SI nNume1 > 9;                 nPeriodo = 4; |FINSI;
 |FINSI;
|FPRC;

|PROCESO clientes;
     |ABRE #11;
     |DDEFECTO #11;
     #11#0 = cuencli;
     #11#1 = nivcli;
     |LEE 001#11=;
     nombre1 = #11#2;
     |CIERRA #11;

     nombre = "";
     cif = "";
     |ABRE #16;
     #16#23 = "C";
     #16#10 = cuencli;
     #16#11 = nivcli;
     |LEE 001#16=;
     |SI FSalida = 0;
          nombre = #16#1;     ||nombre
          cif    = #16#9;     ||cif del cliente
     |SINO;
          #16#23 = "P";
          #16#10 = cuencli;
          #16#11 = nivcli;
          |LEE 001#16=;
          |SI FSalida = 0;
               nombre = #16#1;     ||nombre
               cif    = #16#9;        ||cif del cliente
          |SINO;
               nombre = nombre1;   ||nombre de la cuenta
               cif    = "";
          |FINSI;
     |FINSI;
     |CIERRA #16;
|FPRC;

|PROCESO soportado;

     |DDEFECTO #6;
     #6#0  = #2#14;    || libro
     #6#27 = #2#17;    || serie
     #6#2  = #2#16;    || factura original
     |HAZ guardaf;
     aFactuan = #6#2;
     |HAZ guafa;
     ren_fra = #6#2;     || lo guarda para rectificar la relacion con apuntes
     |LEE 001#6=;
     |SI FSalida ! 0;
          #6#27 = #2#17;  ||Serie
          #6#1  = #2#15;  ||descripcion libro
          #6#2  = ren_fra;
          #6#3  = #2#1;   ||Fecha factura
          |GRABA 020#6b;
     |FINSI;

     |SI #2#42 = "F";
         #6#4 = #4#4;
         #6#5 = #4#5;
         #6#6 = #4#6;
         #6#7 = #4#7;
         #6#26 = #4#9;
         #6#45 = #4#0;
         #6#46 = #4#1;
         #6#47 = #4#2;
         #6#49 = #4#21;
         cuencli = #6#4;
         nivcli = #6#5;
         |HAZ clientes;
         #6#50 = nombre;
         #6#51 = cif;
         |HAZ Periodo;
         #6#44 = nPeriodo;
     |FINSI;

/*
     |SI #2#42 = "B";
         nNume1 = 53;
         |SI #2#43 = 1; nNume1 = 8; |FINSI;
         |SI #2#43 = 2; nNume1 = 9; |FINSI;
         |SI #2#43 = 3; nNume1 = 10; |FINSI;
         |SI #2#43 = 4; nNume1 = 52; |FINSI;
         #6nNume1 = #6nNume1 + #4#9;
     |FINSI;
*/
     |SI #2#42 = "I";

         nNume1 = 55; nNume2 = 57;
         |SI #2#43 = 1; nNume1 = 11; nNume2 = 14; |FINSI;
         |SI #2#43 = 2; nNume1 = 12; nNume2 = 15; |FINSI;
         |SI #2#43 = 3; nNume1 = 13; nNume2 = 16; |FINSI;
         |SI #2#43 = 4; nNume1 = 54; nNume2 = 56; |FINSI;
         #6nNume1 = #2#25;
         #6nNume2 = #6nNume2 + #4#9;

         nNume1 = 53;
         |SI #2#43 = 1; nNume1 = 8; |FINSI;
         |SI #2#43 = 2; nNume1 = 9; |FINSI;
         |SI #2#43 = 3; nNume1 = 10; |FINSI;
         |SI #2#43 = 4; nNume1 = 52; |FINSI;
         #6nNume1 = #6nNume1 + #2#22;
     |FINSI;

     |SI #2#42 ! "F"; |Y #2#42 ! "B"; |Y #2#42 ! "I";

         |SI nSwRec1 = 1;
             #2#31   = nCamRec1;
             #2#43   = 1;
             nSwRec1 = 0;
         |SINO;
             |SI nSwRec2 = 1;
                 #2#31 = nCamRec2;
                 #2#43 = 2;
                 nSwRec2 = 0;
             |SINO;
                 |SI nSwRec3 = 1;
                     #2#31 = nCamRec3;
                     #2#43 = 3;
                     nSwRec3 = 0;
                 |SINO;
                     |SI nSwRec4 = 1;
                         #2#31 = nCamRec4;
                         #2#43 = 4;
                         nSwRec4 = 0;
                     |SINO;
                         |SI nSwRec5 = 1;
                             #2#31 = nCamRec5;
                             #2#43 = 5;
                             nSwRec5 = 0;
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
         |SI #2#31 ! 0;
             #2#42 = "R";
             nNume1 = 59; nNume2 = 61;
             |SI #2#43 = 1; nNume1 = 17; nNume2 = 20; |FINSI;
             |SI #2#43 = 2; nNume1 = 18; nNume2 = 21; |FINSI;
             |SI #2#43 = 3; nNume1 = 19; nNume2 = 22; |FINSI;
             |SI #2#43 = 4; nNume1 = 58; nNume2 = 60; |FINSI;
             #6nNume1 = #2#31;
             #6nNume2 = #6nNume2 + #4#9;
         |FINSI;
     |FINSI;

     #6#23 = #2#39; ||deducible
     #6#48 = #2#38; ||inversion
     |GRABA 001#6a;
     |LIBERA #6;

     |SI #2#42 = "F";
         enSwPase = 1;
         libro    = #6#0;
         orden    = #6#2;
         emision  = #6#3;
         serie    = #6#27;
         pesetas  = #6#26;
         cuenta   = #6#4;
         digito   = #6#5;
         nConcep  = #6#6;
         aDesc    = #6#7;
         |SUB_EJECUTA_NP "calinpag";
         enSwPase = 0;
    |FINSI;

    |SI #2#42 = "I";
         |SI #2#31 ! 0;  ||el recargo
             |SI #2#43 = 1; nSwRec1 = 1; nCamRec1 = #2#31; |FINSI;
             |SI #2#43 = 2; nSwRec2 = 1; nCamRec2 = #2#31; |FINSI;
             |SI #2#43 = 3; nSwRec3 = 1; nCamRec3 = #2#31; |FINSI;
             |SI #2#43 = 4; nSwRec4 = 1; nCamRec4 = #2#31; |FINSI;
             |SI #2#43 = 5; nSwRec5 = 1; nCamRec5 = #2#31; |FINSI;
         |SINO;
             |SI #2#43 = 1; nSwRec1  = 0; nCamRec1 = 0; |FINSI;
             |SI #2#43 = 2; nSwRec2  = 0; nCamRec2 = 0; |FINSI;
             |SI #2#43 = 3; nSwRec3  = 0; nCamRec3 = 0; |FINSI;
             |SI #2#43 = 4; nSwRec4  = 0; nCamRec4 = 0; |FINSI;
             |SI #2#43 = 5; nSwRec5  = 0; nCamRec5 = 0; |FINSI;
         |FINSI;
    |FINSI;

|FPRC;

|PROCESO repercutido;

     |DDEFECTO #5;
     #5#0  = #2#14;    || libro
     #5#27 = #2#17;    || serie
     #5#2  = #2#16;    || factura original
     |HAZ guardaf;
     aFactuan = #5#2;
     |HAZ guafa;
     ren_fra = #5#2;     || lo guarda para rectificar la relacion con apuntes
     |LEE 001#5=;
     |SI FSalida ! 0;
          #5#27 = #2#17;  ||Serie
          #5#1  = #2#15;  ||descripcion libro
          #5#2  = ren_fra;
          #5#3  = #2#1;   ||Fecha factura
          |GRABA 020#5b;
     |FINSI;

     |SI #2#42 = "F";
         #5#4 = #4#4;
         #5#5 = #4#5;
         #5#6 = #4#6;
         #5#7 = #4#7;
         #5#26 = #4#9;
         #5#45 = #4#0;
         #5#46 = #4#1;
         #5#47 = #4#2;
         #5#49 = #4#21;
         cuencli = #5#4;
         nivcli = #5#5;
         |HAZ clientes;
         #5#50 = nombre;
         #5#51 = cif;
         |HAZ Periodo;
         #5#44 = nPeriodo;
     |FINSI;

     |SI #2#42 = "I";
         nNume1 = 55; nNume2 = 57;
         |SI #2#43 = 1; nNume1 = 11; nNume2 = 14; |FINSI;
         |SI #2#43 = 2; nNume1 = 12; nNume2 = 15; |FINSI;
         |SI #2#43 = 3; nNume1 = 13; nNume2 = 16; |FINSI;
         |SI #2#43 = 4; nNume1 = 54; nNume2 = 56; |FINSI;
         #5nNume1 = #2#25;
         #5nNume2 = #5nNume2 + #4#9;
         nNume1 = 53;
         |SI #2#43 = 1; nNume1 = 8; |FINSI;
         |SI #2#43 = 2; nNume1 = 9; |FINSI;
         |SI #2#43 = 3; nNume1 = 10; |FINSI;
         |SI #2#43 = 4; nNume1 = 52; |FINSI;
         #5nNume1 = #5nNume1 + #2#22;
     |FINSI;


     |SI #2#42 ! "F"; |Y #2#42 ! "B"; |Y #2#42 ! "I";

         |SI nSwRec1 = 1;
             #2#31   = nCamRec1;
             #2#43   = 1;
             nSwRec1 = 0;
         |SINO;
             |SI nSwRec2 = 1;
                 #2#31 = nCamRec2;
                 #2#43 = 2;
                 nSwRec2 = 0;
             |SINO;
                 |SI nSwRec3 = 1;
                     #2#31 = nCamRec3;
                     #2#43 = 3;
                     nSwRec3 = 0;
                 |SINO;
                     |SI nSwRec4 = 1;
                         #2#31 = nCamRec4;
                         #2#43 = 4;
                         nSwRec4 = 0;
                     |SINO;
                         |SI nSwRec5 = 1;
                             #2#31 = nCamRec5;
                             #2#43 = 5;
                             nSwRec5 = 0;
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
         |SI #2#31 ! 0;
             #2#42 = "R";
             nNume1 = 59; nNume2 = 61;
             |SI #2#43 = 1; nNume1 = 17; nNume2 = 20; |FINSI;
             |SI #2#43 = 2; nNume1 = 18; nNume2 = 21; |FINSI;
             |SI #2#43 = 3; nNume1 = 19; nNume2 = 22; |FINSI;
             |SI #2#43 = 4; nNume1 = 58; nNume2 = 60; |FINSI;
             #5nNume1 = #2#31;
             #5nNume2 = #5nNume2 + #4#9;
         |FINSI;
     |FINSI;

     #5#23 = #2#39; ||deducible
     #5#48 = #2#38; ||inversion
     |GRABA 001#5a;
     |LIBERA #5;

     |SI #2#42 = "F";
         enSwPase = 1;
         libro    = #5#0;
         orden    = #5#2;
         emision  = #5#3;
         serie    = #5#27;
         pesetas  = #5#26;
         cuenta   = #5#4;
         digito   = #5#5;
         |SUB_EJECUTA_NP "calincob";
         enSwPase = 0;
    |FINSI;
    |SI #2#42 = "I";
         |SI #2#31 ! 0;  ||el recargo
             |SI #2#43 = 1; nSwRec1 = 1; nCamRec1 = #2#31; |FINSI;
             |SI #2#43 = 2; nSwRec2 = 1; nCamRec2 = #2#31; |FINSI;
             |SI #2#43 = 3; nSwRec3 = 1; nCamRec3 = #2#31; |FINSI;
             |SI #2#43 = 4; nSwRec4 = 1; nCamRec4 = #2#31; |FINSI;
             |SI #2#43 = 5; nSwRec5 = 1; nCamRec5 = #2#31; |FINSI;
         |SINO;
             |SI #2#43 = 1; nSwRec1  = 0; nCamRec1 = 0; |FINSI;
             |SI #2#43 = 2; nSwRec2  = 0; nCamRec2 = 0; |FINSI;
             |SI #2#43 = 3; nSwRec3  = 0; nCamRec3 = 0; |FINSI;
             |SI #2#43 = 4; nSwRec4  = 0; nCamRec4 = 0; |FINSI;
             |SI #2#43 = 5; nSwRec5  = 0; nCamRec5 = 0; |FINSI;
         |FINSI;
    |FINSI;
|FPRC;


|PROCESO cuentas;

 |ABRE #11;
 #11#0 = cuenta;
 #11#1 = nivel;
 |LEE 101#11=;
 |SI FSalida = 0;
          nombre1 = #11#2;    ||nombre de la cuenta
          ini = dig1;
          fecalf = fecha;          ||la actualizo
          mes = fecalf % 402;
          mesfec = mes;
          |SI ini = 1;
               mesac = mesfec;
          |SINO;
               mesac = (mesfec - ini) + 1;
               |SI mesac [ 0;
                    mesac = (13 - ini) + mesfec;
               |FINSI;
          |FINSI;
          a = (mesac * 3) + 9;
          b = a + 1;
          c1 = a + 2;
          |SI #4#8 = "D";
               #11a = #11a + #4#9;
               #11#51 = #11#51 + #4#9;
          |SINO;
               #11b = #11b + #4#9;
               #11#52 = #11#52 + #4#9;
          |FINSI;
          #11c1 = #11a - #11b;
          #11#53 = #11#51 - #11#52;
          |GRABA 011#11a;
          |LIBERA #11;
|SINO;         ||Si la cuenta no existe, busco la anterior para saber a que
          |LIBERA #11;
     ok =0;    ||Epigrafe ...... pertenece
     |QBF cuenta;
     lon = cuenta % 0;
     |SI dig4 = lon; ok = 1; niv = 1; lon1 = dig4; |FINSI;
     |SI dig5 = lon; ok = 1; niv = 2; lon1 = dig4; |FINSI;
     |SI dig6 = lon; ok = 1; niv = 3; lon1 = dig5; |FINSI;
     |SI dig7 = lon; ok = 1; niv = 4; lon1 = dig6; |FINSI;
     |SI dig8 = lon; ok = 1; niv = 5; lon1 = dig7; |FINSI;
     |SI dig9 = lon; ok = 1; niv = 6; lon1 = dig8; |FINSI;
     |SI ok = 1;
          |PARA ; |SI FSalida !0; |Y niv > 0; |HACIENDO ;
               niv = niv - 1;||Le quito un nivel,para mirar la cuenta anterior
               |SI niv = 1; lon1 = dig4; |FINSI;
               |SI niv = 2; lon1 = dig5; |FINSI;
               |SI niv = 3; lon1 = dig6; |FINSI;
               |SI niv = 4; lon1 = dig7; |FINSI;
               |SI niv = 5; lon1 = dig8; |FINSI;
                    lon1 = "0000" + lon1;
                    lon1 = lon1 % -102;
                    lon1 = "1"+lon1;
                    cta = cuenta % lon1;
                    |QBF cta;
               #11#0 = cta;
               #11#1 = niv;
               |LEE 001#11=;
          |SIGUE;
               |PARA i = 9; |SI i [ 53; |HACIENDO i = i + 1;
                    #11i = 0;
               |SIGUE;
               |SI total = 0;
                    |SI FSalida =0; |O niv = 1;
                         ini = dig1;         ||Actualizo la cuenta
                         fecalf = fecha;
                         mes = fecalf % 402;
                         mesfec = mes;
                         |SI ini = 1;
                              mesac = mesfec;
                         |SINO;
                              mesac = (mesfec - ini) + 1;
                              |SI mesac [ 0;
                                   mesac = (13 - ini) + mesfec;
                              |FINSI;
                         |FINSI;
                         a = (mesac * 3) + 9;
                         b = a + 1;
                         c1 = a + 2;
                         |SI #4#8 = "D";
                              #11a = #11a + #4#9;
                              #11#51 = #11#51 + #4#9;
                         |SINO;
                              #11b = #11b + #4#9;
                              #11#52 = #11#52 + #4#9;
                         |FINSI;
                         #11c1 = #11a - #11b;
                         #11#53 = #11#51 - #11#52;

                    |FINSI;
               |FINSI;

               #11#0 = cuenta;
               #11#1 = nivel;
               #11#3 = "S";
               cuentaz = cuenta + "zzzzzzzzzzzzzzzzzzzz";
               cuentaz = cuentaz % 112;
               #11#54 = cuentaz;
               #11#55 = nivel;

               |PUSHV 0501 2380;
               |PINPA #0#11;
               |PINDA #0#11;
               |CONFI "0000SConfirma el alta : ";
               |SI FSalida = 0;
                    |ENDATOS #1#11;
                    |SI FSalida = 0;
                         nombre1 = #11#2;
                         |GRABA 011#11n;          ||Si acepta el darla de alta
                         |LIBERA #11;             ||la grabo
                         #11#0 = cta;
                         #11#1 = niv;
                         |LEE 101#11=;
                         #11#3 = "N";        ||Quito el pase directo de la cuenta
                         |GRABA 011#11a;     ||en donde he mirado a donde pertenecia
                         |LIBERA #11;        ||puesto que ya no es de pase directo
                    |FINSI;
               |FINSI;
     |FINSI;
     |POPV;
|FINSI;
|LIBERA #11;
|CIERRA #11;
|FPRC;

|PROCESO grabadiario;
   |ABRE #7;
   |DDEFECTO #7;
   #7#0 = #4#0;
   |LEE 101#7=;        ||Grabo en el diario
   |SI FSalida ! 0;
       #7#0 = #4#0;
       #7#1 = "DIARIO SIN DEFINIR";
       |GRABA 020#7b;
   |FINSI;
   #7#2 = #7#2 + nDebe;
   #7#3 = #7#3 + nHaber;
   |GRABA 020#7a;
   |LIBERA #7;
   |CIERRA #7;
|FPRC;

|PROCESO altatra;
    |ABRE #19;
    #19#0 = codcon;
    #19#1 = #4#4;        || cuenta
    #19#2 = #4#5;        || digito
    #19#3 = #4#1;        || fecha
    #19#4 = #4#8;        || signo
    #19#6 = #4#0;        || diario
    |LEE 101#19=;
    |SI FSalida ! 0;
        |DDEFECTO #19;
        #19#0 = codcon;
        #19#1 = #4#4;
        #19#2 = #4#5;
        #19#3 = #4#1;
        #19#4 = #4#8;
        #19#6 = #4#0;
        |GRABA 020#19b;
    |FINSI;
    importe = #4#9;
    |SI opera = "B";
        importe = -importe;
    |FINSI;
    #19#5 = #19#5 + importe;
    |GRABA 020#19a;
    |LIBERA #19;
    |CIERRA #19;
|FPRC;

|PROCESO Actualiza;
     |ABRE #3;
     |DDEFECTO #3;
     #3#0 = diario;
     #3#1 = fecha1;
     #3#2 = asiento;
     |LEE 101#3=;
     |SI FSalida ! 0;
         |DDEFECTO #3;
         #3#0 = diario;
         #3#1 = fecha1;
         #3#2 = asiento;
         |GRABA 020#3b;
     |FINSI;
     #3#3  = #3#2;
     #3#4  = #3#4 + nDebe;
     #3#5  = #3#5 + nHaber;
     #3#6  = #3#4 - #3#5;
     #3#7  = 0;
     #3#8  = c_conh;
     #3#9  = d_conh;
     #3#10 = c_cond;
     #3#11 = d_cond;
     |GRABA 020#3a;
     |LIBERA #3;
     |CIERRA #3;

     |HAZ grabadiario;   ||grabo en el fichero de diario
     opera = "A";
     |HAZ altatra;       || fichero de movimientos
     |HAZ cuentas;
|FPRC;

|PROCESO miraasie;

 |SI diario ! #2#0; |O fecha1 ! #2#1; |O asiento ! #2#47;
     c_conh = "";  d_conh = 0;
     c_cond = "";  d_cond = 0;
     c = -9;
     nCamRec1  = 0; nCamRec2  = 0;
     nCamRec3  = 0; nCamRec4  = 0;
     nCamRec5  = 0;
     nSwRec1   = 0; nSwRec2   = 0;
     nSwRec3   = 0; nSwRec4   = 0;
     nSwRec5  = 0;
 |FINSI;

 c = c + 10;
 diario  = #2#0;
 fecha1  = #2#1;
 asiento = #2#47;

 |DDEFECTO #4;
 #4#0 = diario;
 #4#1 = fecha1;
 #4#2 = asiento;
 #4#3 = c;
 |LEE 101#4=;
 |SI FSalida ! 0;
     #4#0 = diario;
     #4#1 = fecha1;
     #4#2 = asiento;
     #4#3 = c;
     |GRABA 020#4b;
 |FINSI;

 nDebe  = 0;
 nHaber = 0;
 #4#6 = #2#9;
 #4#7 = #2#10;
 #4#8 = #2#11; || Signo
 #4#9 = #2#12; || Importe
 |SI #4#8  = "D";
     #4#4   = #2#5;  #4#16 = #2#5;
     #4#5   = #2#7;  #4#17 = #2#7;
     nDebe  = #2#12;
 |SINO;
     #4#4   = #2#6;  #4#10 = #2#6;
     #4#5   = #2#8;  #4#11 = #2#8;
     nHaber = #2#12;
 |FINSI;

 |SI #2#13 ! " ";
     #4#12 = #2#13;
     #4#13 = #2#14;
     #4#14 = #2#16;
     #4#15 = #2#17;
     #4#19 = #2#42;
     #4#20 = #2#43;
 |FINSI;

 fecha  = #4#1;
 cuenta = #4#4;
 nivel  = #4#5;
 |HAZ Actualiza;

 |SI #2#13 = "R";
     |HAZ repercutido;   ||Si es Ventas Repercutido
 |FINSI;
 |SI #2#13 = "S";
     |HAZ soportado;     ||Si es Compras Soportado
 |FINSI;

 |SI #2#13 ! " ";
     #4#12 = #2#13;
     #4#13 = #2#14;
     #4#14 = #2#16;
     #4#15 = #2#17;
     #4#19 = #2#42;
     #4#20 = #2#43;
 |FINSI;

 #4#21 = #2#40;
 |GRABA 011#4a;
 |LIBERA #4;
|FPRC;


|DEFBUCLE asiento;
 #2#1;
 ;
 00,feini,000001, 00001;
 99,fefin,999999, 99999;
 e;
 NULL, miraasie;
|FIN;


|PROCESO b_apuntes;

     |ABRE #2;
     |LEE 001#2p;
     |SI FSalida!0;
          |MENAV "0000No hay registros"
          |CIERRA #2;
          |ACABA;
     |FINSI;
     |CIERRA #2;

     |DBASE aAlfa1;
     aAlfa1 = aAlfa1 + "def/encopcbo.mas";
     |CARGA_DEF aAlfa1, reflejo@;
     |SI FSalida ! 0;
         |MENAV "    Error en Encopcbo";
         |ACABA;
     |FINSI;

     nLibroR = #200#3;
     nLibroS = #200#29;

     diario = -1;
     fecha1 = "01.01.0000";
     asiento = -1;
     feini = fec1;
     fefin = fec2;
     |BUCLE ComplCampos;

     |ABRE #4;      || lineas astos.
     |ABRE #5;      || iva rep
     |ABRE #6;      || iva sop

     |ABRE #33; |CIERRA #33; |DELINDEX #33;

     |ABRE #33;     ||Cambio N§ Factura.....

     c     = 0;
     feini = fec1;
     fefin = fec2;
     |BUCLE asiento;     ||Grabo los asientos e ivas

     |LIBERA #4;
     |LIBERA #5;
     |LIBERA #6;

     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #6;

     |CIERRA #33;
|FPRC;

||***************************************************************************
||***************************************************************************
||***********************+HASTA AQUI EL ENLACE DE ASIENTOS*******************
||***************************************************************************
||***************************************************************************

|PROCESO guardaf;
      |ABRE #caivases;
      #caivases#0 = #caivarep#27;
      #caivases#1 = "R";
      |LEE 101#caivases.=;
      |SI FSalida = 0;
           |SI #caivases#3 < #caivarep#2;
                #caivases#3 = #caivarep#2;
                |GRABA 020#caivases.a;
           |FINSI;
      |FINSI;
      |LIBERA #caivases;
      |CIERRA #caivases;
|FPRC;

|PROCESO guardas;
      |ABRE #caivases;
      #caivases#0 = #caivasop#27;
      #caivases#1 = "S";
      |LEE 101#caivases.=;
      |SI FSalida = 0;
           |SI #caivases#3 < #caivasop#2;
               #caivases#3 = #caivasop#2;
               |GRABA 020#caivases.a;
           |FINSI;
      |FINSI;
      |LIBERA #caivases;
      |CIERRA #caivases;
|FPRC;

|PROCESO ultimaf;
      |ABRE #caivases;
      #caivases#0 = #caivarep#27;
      #caivases#1 = "R";
      |LEE 101#caivases.=;
      |SI FSalida = 0;
           i_factu = #caivases#3;
           #caivases#3 = #caivases#3 + #caivases#4;
           |GRABA 020#caivases.a;
      |FINSI;
      |LIBERA #caivases;
      |CIERRA #caivases;
|FPRC;

|PROCESO ultimas;
      |ABRE #caivases;
      #caivases#0 = #caivasop#27;
      #caivases#1 = "S";
      |LEE 101#caivases.=;
      |SI FSalida = 0;
           i_factu = #caivases#3;
           #caivases#3 = #caivases#3 + #caivases#4;
           |GRABA 020#caivases.a;
      |FINSI;
      |LIBERA #caivases;
      |CIERRA #caivases;
|FPRC;

|PROCESO guafa;
     #33#0 = #2#16;
     #33#4 = #2#17;
     |LEE 101#33=;
     nSal = FSalida;
     #33#0 = #2#16;
     #33#4 = #2#17;
     #33#1 = aFactuan;
     #33#2 = #2#18;  ||concepto iva
     #33#3 = #2#19;  ||Descripcion concepto LA MISMA QUE EL APUNTE!!!
     |SI nSal = 0; |GRABA 020#33a; |FINSI;
     |SI nSal ! 0; |GRABA 020#33n; |FINSI;
     |LIBERA #33;
|FPRC;

|PROCESO leefa;
     #33#0 = #12#1;
     #33#4 = #12#2;
     |LEE 101#33=;
     |SI FSalida ! 0;
          aFactuan = #12#1;
     |SINO;
          aFactuan = #33#1;
     |FINSI;
     |LIBERA #33;
|FPRC;


|| ***************************************************************

|PROGRAMA;

     |HAZ inicio;
     |CLS;
     |CABEZA "Importacion Gescowin";
     |DDEFECTO #0;

     |DFICE emprevi; |QBF emprevi;
     emprevi = emprevi % -204;
     #0#3    = emprevi;

     #0#7  = 2;
     #0#8  = "S";
     #0#9  = "S";
     #0#10 = "S";
     |PINPA #0#0;
     |PINDA #0#0;

     |ABRE #19;
     |LEE 101#19u;
     |SI FSalida ! 0;
          |DDEFECTO #19;
          #19#0 = 1;
     |SINO;
          #19#0 = #19#0 + 1;
     |FINSI;
     |GRABA 101#19n;
     codcon = #19#0;
     |LIBERA #19;
     |CIERRA #19;

     |ABRE #200;
     |DDEFECTO #200;
     |LEE 000#200p;
     |CIERRA #200;


     |ENDATOS #1#0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |SI #0#0 ! "SI";  |ACABA;  |FINSI;

     dir_fich1 = #1#2; |QBF dir_fich1;

     |DELINDEX #2;
     |DELINDEX #12;

     |HAZ secuencial;

     |HAZ b_apuntes;
     |SUB_EJECUTA "camaapua";        || solo en importacion completa

     |DELINDEX #2;
     |DELINDEX #12;
|FPRO;
