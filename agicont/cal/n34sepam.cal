|FICHEROS;
   n34sepam #0;
   camanban #1;
|FIN;

|VARIABLES;
 NombreP = "";
 NifP    = "";
 EntP    = "";
 SucP    = "";
 CtaP    = "";
 DirP    = "";
 Cp1P    = "";
 Cp2P    = "";
 PobP    = "";
 modo    = 0;
 vale    = 0;
 alfa1   = "";

 Digito1  = 0;
 Digito2  = 0;
 Comodin1 = "";
 Comodin2 = "";

 Cont      = 0;
 Calc      = 0;
 aCaracter = "";

 aAlfa  = "";
 aAlfa1 = "";
 nCalc  = 0;
 nHandle = 0;

 aEntidad  = "";
 aSucursal = "";
 aDC       = "";
 aCuenta   = "";

 NifProv    = "";
 NombreProv = "";
 DirecProv  = "";
 PoblaProv  = "";
 ProviProv  = "";
 Cp1Prov    = "";
 Cp2Prov    = "";
 TelefProv  = "";
 FaxProv    = "";
 PaisProv   = "";
 varios     = 0;

 nSwCarga_Def = 0;

 aAlfa2  = "";

     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";

|FIN;

|INCLUYE acceso_i;
|INCLUYE varnue_i;
|| *************************************************************************

|PROCESO tipo8; |TIPO 8;
  |HAZ inicio;
  |HAZ eVarEmpresa;
  NombreP = #48#1;
  NifP    = #48#8;
  EntP    = "0000";
  SucP    = "0000";
  CtaP    = "0000000000";
  DirP    = #48#5;
  aAlfa   = #48#6; |QBF aAlfa;
  aAlfa1 = aAlfa % 0102;  Cp1P    = aAlfa1;
  aAlfa1 = aAlfa % 0303;  Cp2P    = aAlfa1;
  PobP    = #48#7;

  |SI enEjercicio < 2015;
      |C_V #0#21, 1, "S";
      |C_V #0#11, 1, "S";
      |C_V #0#12, 1, "S";
      |C_V #0#13, 1, "S";
      |C_V #0#14, 1, "S";
      |C_V #0#16, 1, "S";
      |C_V #0#17, 1, "S";
      |C_V #0#18, 1, "S";
      |C_V #0#19, 1, "S";
  |FINSI;
|FPRC;

|PROCESO RegDirec; |TIPO 0;
 alfa1 = #0Campo;
 |SI alfa1 = "N";
    #n34sepam#11 = "";  #n34sepam#16 = "";
    #n34sepam#12 = "N"; #n34sepam#13 = "N"; #n34sepam#14 = "N";
    #n34sepam#17 = "N"; #n34sepam#18 = "N"; #n34sepam#19 = "N";
    |PINTA #n34sepam#11; |PINTA #n34sepam#12; |PINTA #n34sepam#13;
    |PINTA #n34sepam#14; |PINTA #n34sepam#16; |PINTA #n34sepam#17;
    |PINTA #n34sepam#18; |PINTA #n34sepam#19;
 |FINSI;
 |C_M #n34sepam#11,1,alfa1;
 |C_M #n34sepam#12,1,alfa1;
 |C_M #n34sepam#13,1,alfa1;
 |C_M #n34sepam#14,1,alfa1;
 |C_M #n34sepam#16,1,alfa1;
 |C_M #n34sepam#17,1,alfa1;
 |C_M #n34sepam#18,1,alfa1;
 |C_M #n34sepam#19,1,alfa1;
|FPRC;

|PROCESO CalculoDC;
   Digito1 = 0; Digito2 = 0;
   Comodin1 = ""; Comodin2 = "";

   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = aSucursal % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;
   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = aEntidad % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin1 % Calc; Calc = aCaracter;
      |SI Cont = 1; Digito1 = Digito1 + (Calc * 6);  |FINSI;
      |SI Cont = 2; Digito1 = Digito1 + (Calc * 3);  |FINSI;
      |SI Cont = 3; Digito1 = Digito1 + (Calc * 7);  |FINSI;
      |SI Cont = 4; Digito1 = Digito1 + (Calc * 9);  |FINSI;
      |SI Cont = 5; Digito1 = Digito1 + (Calc * 10); |FINSI;
      |SI Cont = 6; Digito1 = Digito1 + (Calc * 5);  |FINSI;
      |SI Cont = 7; Digito1 = Digito1 + (Calc * 8);  |FINSI;
      |SI Cont = 8; Digito1 = Digito1 + (Calc * 4);  |FINSI;
   |SIGUE;
   Digito1 = 11 - (Digito1 $ 11);
   |SI Digito1 = 10; Digito1 = 1; |FINSI;
   |SI Digito1 = 11; Digito1 = 0; |FINSI;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = aCuenta % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin2 = Comodin2 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin2 % Calc; Calc = aCaracter;
      |SI Cont = 1;  Digito2 = Digito2 + (Calc * 6);  |FINSI;
      |SI Cont = 2;  Digito2 = Digito2 + (Calc * 3);  |FINSI;
      |SI Cont = 3;  Digito2 = Digito2 + (Calc * 7);  |FINSI;
      |SI Cont = 4;  Digito2 = Digito2 + (Calc * 9);  |FINSI;
      |SI Cont = 5;  Digito2 = Digito2 + (Calc * 10); |FINSI;
      |SI Cont = 6;  Digito2 = Digito2 + (Calc * 5);  |FINSI;
      |SI Cont = 7;  Digito2 = Digito2 + (Calc * 8);  |FINSI;
      |SI Cont = 8;  Digito2 = Digito2 + (Calc * 4);  |FINSI;
      |SI Cont = 9;  Digito2 = Digito2 + (Calc * 2);  |FINSI;
      |SI Cont = 10; Digito2 = Digito2 + (Calc * 1);  |FINSI;
   |SIGUE;

   Digito2 = 11 - (Digito2 $ 11);
   |SI Digito2 = 10; Digito2 = 1; |FINSI;
   |SI Digito2 = 11; Digito2 = 0; |FINSI;

   aDC = Digito1 + Digito2;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
 |SI enEjercicio ] 2015;
     |PINTA 1602, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
     |BLANCO 1701 2380;
 |FINSI;
|FPRC;

|PROCESO defban; |TIPO 7;
 modo = (FEntrada / 100) ! 0;
 |SI modo ! 1; |ACABA; |FINSI;
 |DDEFECTO #0;
 #n34sepam#2 = NifP;      #n34sepam#7  = DirP;
 #n34sepam#3 = NombreP;   #n34sepam#8  = Cp1P;
 #n34sepam#4 = EntP;      #n34sepam#9  = Cp2P;
 #n34sepam#5 = SucP;      #n34sepam#10 = PobP;
 #n34sepam#6 = CtaP;
 |PINDA #0#n34sepam;


|FPRC;

|PROCESO banco; |TIPO 0;
 modo = (FEntrada / 100) ! 0;

 |SI FSalida = 9;       || Para Consultar Ficha Banco
     |PUSHV 05012380;
     |ABRE #camanban;
     |PINPA #0#camanban;
     #camanban#0 = #n34sepam#0;
     |CONSULTA #0#camanban;
     vale = FSalida;
     |CIERRA #camanban;
     |POPV;
     |SI vale = 0;
         #n34sepam#0 = #camanban#0; |PINTA #n34sepam#0;
     |SINO;
         |ERROR; |ACABA;
     |FINSI;
 |FINSI;

 |SI modo ! 1; |ACABA; |FINSI;
 |ABRE #camanban;
 |DDEFECTO #camanban;
 #camanban#0 = #n34sepam#0;
 |LEE 001#camanban.=;
 |SI FSalida = 0;
     aAlfa = #camanban#9; |QBF aAlfa;
     aEntidad  = aAlfa % 0104;
     aSucursal = aAlfa % 0504;
     aCuenta   = #camanban#8;
     |HAZ CalculoDC;

     #n34sepam#1  = #camanban#1;     |PINTA #n34sepam#1;
     #n34sepam#4  = aEntidad;        |PINTA #n34sepam#4;
     #n34sepam#5  = aSucursal;       |PINTA #n34sepam#5;
     #n34sepam#6  = aCuenta;         |PINTA #n34sepam#6;
     #n34sepam#22 = aDC;             |PINTA #n34sepam#22;
 |FINSI;
 |CIERRA #camanban;
|FPRC;

|PROCESO Tipo7IBAN_F34;  |TIPO 7;
     aAlfa = #n34sepam#30;   |QBF aAlfa;

     |SI aAlfa ! "";  |ACABA;  |FINSI;

     eaCta  = #n34sepam#4 + #n34sepam#5 + #n34sepam#22 + #n34sepam#6;
     eaPais = #n34sepam#36;
     |HAZ CalcuIBAN;

     #n34sepam#30 = eaIBAN;
|FPRC;

|PROCESO Tipo0IBAN_F34;  |TIPO 0;
     eaCta  = #n34sepam#4 + #n34sepam#5 + #n34sepam#22 + #n34sepam#6;
     eaPais = #n34sepam#36;
     |HAZ CheqIBAN;

     aAlfa = #n34sepam#30;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
         |SI FSalida = 0;
             #n34sepam#30 = eaIBAN;
             |PINTA #n34sepam#30;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;
