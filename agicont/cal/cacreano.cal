|FICHEROS;
  cacreano #0;
  cacuenta #1;

  camaasic #2;
  camaasil #3;
  caivarep #4;
  caivasop #14;

  cacuebal #5;
  cacongru #6;

  casesion #100;
  caseslin #110;
  camandep #101;

    cacuen01 #21;     ||LOS FICHEROS cacuenta para repondatos
    cacuen02 #22;     ||LOS FICHEROS cacuenta para repondatos
    cacuen03 #23;     ||LOS FICHEROS cacuenta para repondatos
    cacuen04 #24;     ||LOS FICHEROS cacuenta para repondatos
    cacuen05 #25;     ||LOS FICHEROS cacuenta para repondatos
    cacuen06 #26;     ||LOS FICHEROS cacuenta para repondatos

  ca8m0002 #422;
|FIN;

|VARIABLES;
  nAntSes = 0;
  aAntDep = "";
  aD1     = "";
  aH1     = "";
  aDepar  = "";
  aDDep   = "";
  aHDep   = "";

  nSw1    = 0;
  nAlgun  = 0;
  alfa1   = "";
  alfa2   = "";
  nPara1  = 0;
  nPara2  = 0;

  fich      = "";
  temporal1 = "";
  temporal2 = "";

    juan = 0;
    mensa = "";
    lon = 0;
    prim = 0;
    cuant1 = "";
    cuant2 = "";
    cuant3 = "";
    cuant4 = "";
    cuant5 = "";
    cuant6 = "";
    lon1 = 0;
    lon2 = 0;
    lon3 = 0;
    lon4 = 0;
    lon5 = 0;
    lon6 = 0;

    men2   = "     NO existe el Grupo de Conceptos";
    a = 0;
    b = 0;
    c = 0;
    mesac = 0;
    mesfec = 0;
    mes = "";
    fecalf = "";
    ini = 0;
    errant = "aaaaaaaaaaaa";
    cuant = "";
    iniemp = 0;
    traba = "";
    traba1 = "";
    traba2 = "";
    traba3 = "";
    traba4 = "";
    traba5 = "";
    traba6 = "";
    aar = "";
    aa = 0;
  sw_con = 0;
  x = 0;
  y = 0;

   aFicbueno = "";
   &eaFicbal = "";
   &enDSel1  = 0;  || Diario
   &enHSel1  = 0;
   &efDSel2  = @;  || fecha
   &efHSel2  = @;
   &enDSel3  = 0;  || documento
   &enHSel3  = 0;
   &enDSel4  = 0;  || asiento
   &enHSel4  = 0;
   &eaDSel5  = ""; || cuenta
   &eaHSel5  = "";
   &enDSel6  = 0;  || concepto
   &enHSel6  = 0;
   &eaDSel7  = ""; || departamento
   &eaHSel7  = "";
   &eaDSel8  = ""; || subdepartamento
   &eaHSel8  = "";
   &enDSel9  = 0;  || libro
   &enHSel9  = 0;
   &eaDSel10 = "     "; || serie
   &eaHSel10 = "     ";
   &enDSel11 = 0;  || periodo
   &enHSel11 = 0;
   &efDSel12 = @;  || fecha factura
   &efHSel12 = @;
   &enNRatio = 0;

   aDCuenta = "";
   aHCuenta = "";
   fFecFra  = @;
   nPerIVA  = 0;
   aParam   = "";
   nTecla   = 0;
   fNueFec  = @;
   aNueUsu  = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE vardep_i;
|INCLUYE varnue_i;
|INCLUYE defec1_i;

|PROCESO LaSeccion;
 alfa1 = #0#25;
 |C_M #0#26,1,alfa1;
 |C_M #0#27,1,alfa1;
 || |C_M #0#28,1,alfa1;
 |C_M #0#29,1,alfa1;
 |C_M #0#34,1,alfa1;
 |SI alfa1 = "N";
     |PDEFECTO #0,26,32;
     |PINTA #0#26;
     |PINTA #0#27;
     || |PINTA #0#28;
     |PINTA #0#29;
     |PINTA #0#30;
     |PINTA #0#31;
     |PINTA #0#34;
 |FINSI;
|FPRC;

|PROCESO Min100;
 #100#0 = 01;
|FPRC;

|PROCESO Max100;
 #100#0 = 99;
|FPRC;

|PROCESO SecActiva; |TIPO 0;
 nTecla = FSalida;
 |SI nTecla = 2; |ACABA; |FINSI;

 |C_M #0#26,0,alfa1;
 |SI alfa1 = "N"; |ACABA; |FINSI;

 |ABRE #100;
 |SI nTecla = 10;
     #100#0 = #0#26;
     |CONSULTA_F_CLAVE #1#100, Min100, Max100;
     #0#26 = #100#0;
     |PINTA #0#26;
 |FINSI;

 #100#0 = #0#26;
 |LEE 001#100=;
 |SI FSalida = 0;
     alfa1 = "MODIFICAR SESION";
     #0#26 = #100#0;
     #0#27 = #100#31;
     #0#28 = #100#1;
     #0#29 = #100#4;
     #0#30 = #100#2;
     #0#31 = #100#3;
     |PARA nPara1 = 0; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
           nPara2 = nPara1 + 6;
           #0nPara1 = #100nPara2;
     |SIGUE;
     |PARA nPara1 = 34; |SI nPara1 [ 45; |HACIENDO nPara1 = nPara1 + 1;
           nPara2 = nPara1 - 1;
           #0nPara1 = #100nPara2;
     |SIGUE;
 |SINO;
     alfa1 = "ALTA SESION";
     #0#27 = "N";
     #0#28 = "";
     #0#29 = "";
     #0#30 = aNueUsu;
     #0#31 = fNueFec;
     |PDEFECTO #0, 0, 25;
     |PDEFECTO #0, 34,46;
     #0#2 = fec1;
     #0#3 = fec2;
 |FINSI;
 |CIERRA #100;

 |ATRI P; |PINTA 0725, alfa1; |ATRI 0;
 |PINDA #0#0;

 |SI eaDepar = "N";
     |C_M #0#27, 1, "N"; #0#27 = "N"; |PINTA #0#27;
     |C_M #0#34, 1, "N"; #0#34 = "N"; |PINTA #0#34;
 |FINSI;
|FPRC;

|PROCESO SiRompo;
  alfa1 = #0#27;
  |C_M #0#34,1,alfa1;
  |SI alfa1 = "N"; #0#34 = "N"; |PINTA #0#34; |FINSI;
|FPRC;

|PROCESO recoge; |TIPO 7;
  |SI #0#25 = "N";
      #0#2 = fec1; |PINTA #0#2;
      #0#3 = fec2; |PINTA #0#3;
  |FINSI;
|FPRC;

|PROCESO fechas;
  |SI #0Campo > fec2;|O #0Campo < fec1;
      |MENAV "    Fecha fuera de Periodo ...";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO no_dep; |TIPO 7;
  |C_M #0#8, 1, eaDepar;
  |C_M #0#9, 1, eaDepar;
  |C_M #0#35, 1, eaDepar;
  |C_M #0#36, 1, eaDepar;
  |C_M #0#37, 1, eaDepar;
  |C_M #0#38, 1, eaDepar;
  |C_M #0#39, 1, eaDepar;
  |C_M #0#40, 1, eaDepar;
  |C_M #0#41, 1, eaDepar;
  |C_M #0#42, 1, eaDepar;
  |C_M #0#43, 1, eaDepar;
  |C_M #0#44, 1, eaDepar;
  |C_M #0#45, 1, eaDepar;
|FPRC;

|PROCESO QueDepar; |TIPO 0;
  |C_M #0#35,0,alfa1;
  |SI alfa1 = "N"; |ACABA; |FINSI;

  alfa1 = "S"; alfa2 = "N"; |SI #0#35 = "D"; alfa1 = "N"; alfa2 = "S"; |FINSI;
  |C_M #0#8, 1, alfa2;  |C_M #0#9, 1, alfa2;
  |C_M #0#36, 1, alfa1; |C_M #0#37, 1, alfa1;
  |C_M #0#38, 1, alfa1; |C_M #0#39, 1, alfa1;
  |C_M #0#40, 1, alfa1; |C_M #0#41, 1, alfa1;
  |C_M #0#42, 1, alfa1; |C_M #0#43, 1, alfa1;
  |C_M #0#44, 1, alfa1; |C_M #0#45, 1, alfa1;
  |SI alfa1 = "S";
      #0#8 = "  "; |PINTA #0#8;
      #0#9 = "zz"; |PINTA #0#9;
  |SINO;
      |PDEFECTO #0, 36, 46;
      |PINTA #0#36; |PINTA #0#37;
      |PINTA #0#38; |PINTA #0#39;
      |PINTA #0#40; |PINTA #0#41;
      |PINTA #0#42; |PINTA #0#43;
      |PINTA #0#44; |PINTA #0#45;
  |FINSI;
|FPRC;

|PROCESO selecci2; |TIPO 0;
   |C_M #0#06, 1, "N"; |C_M #0#07, 1, "N";

   |C_M #0#11, 1, "N"; |C_M #0#12, 1, "N";
   |C_M #0#13, 1, "N"; |C_M #0#14, 1, "N";

   |C_M #0#15, 1, "N"; |C_M #0#16, 1, "N";
   |C_M #0#17, 1, "N"; |C_M #0#18, 1, "N";
   |C_M #0#19, 1, "N"; |C_M #0#20, 1, "N";
   |C_M #0#21, 1, "N"; |C_M #0#22, 1, "N";
   |C_M #0#23, 1, "N"; |C_M #0#24, 1, "N";

   |SI #0#10 = "G";
       #0#6  = 1;   |PINTA #0#6;
       #0#7  = 999; |PINTA #0#7;
       #0#15 = 0;   |PINTA #0#15;
       #0#16 = 0;   |PINTA #0#16;
       #0#17 = 0;   |PINTA #0#17;
       #0#18 = 0;   |PINTA #0#18;
       #0#19 = 0;   |PINTA #0#19;
       #0#20 = 0;   |PINTA #0#20;
       #0#21 = 0;   |PINTA #0#21;
       #0#22 = 0;   |PINTA #0#22;
       #0#23 = 0;   |PINTA #0#23;
       #0#24 = 0;   |PINTA #0#24;

       |C_M #0#11, 1, "S";
       |C_M #0#12, 1, "S";
       |C_M #0#13, 1, "S";
       |C_M #0#14, 1, "s";
   |FINSI;

   |SI #0#10 = "D";
       #0#11 = 0;   |PINTA #0#11;
       #0#12 = 0;   |PINTA #0#12;
       #0#13 = 0;   |PINTA #0#13;
       #0#14 = 0;   |PINTA #0#14;

       #0#15 = 0;   |PINTA #0#15;
       #0#16 = 0;   |PINTA #0#16;
       #0#17 = 0;   |PINTA #0#17;
       #0#18 = 0;   |PINTA #0#18;
       #0#19 = 0;   |PINTA #0#19;
       #0#20 = 0;   |PINTA #0#20;
       #0#21 = 0;   |PINTA #0#21;
       #0#22 = 0;   |PINTA #0#22;
       #0#23 = 0;   |PINTA #0#23;
       #0#24 = 0;   |PINTA #0#24;

       |C_M #0#06, 1, "S";
       |C_M #0#07, 1, "S";
   |FINSI;

   |SI #0#10 = "P";
       #0#6  = 1;   |PINTA #0#6;
       #0#7  = 999; |PINTA #0#7;

       #0#11 = 0;   |PINTA #0#11;
       #0#12 = 0;   |PINTA #0#12;
       #0#13 = 0;   |PINTA #0#13;
       #0#14 = 0;   |PINTA #0#14;

       |C_M #0#15, 1, "S";
       |C_M #0#16, 1, "S";
       |C_M #0#17, 1, "S";
       |C_M #0#18, 1, "s";
       |C_M #0#19, 1, "s";
       |C_M #0#20, 1, "S";
       |C_M #0#21, 1, "S";
       |C_M #0#22, 1, "s";
       |C_M #0#23, 1, "s";
       |C_M #0#24, 1, "s";
   |FINSI;
|FPRC;

|PROCESO leegrupo; |TIPO 0;
 |SI FSalida = 2; |ACABA; |FINSI;
 |SI #0Campo = 0; |ACABA; |FINSI;

 |ABRE #cacongru;
 #6#0 = #0Campo;
 |LEE 001#6=;
 |SI FSalida ! 0;
     |MENAV men2;
     |ERROR;
 |FINSI;
 |CIERRA #cacongru;
|FPRC;

|| *************************************************************************

|PROCESO acumulados;
  |PDEFECTO #1,9,54;
  |GRABA 020#1a;
  |LIBERA #1;
|FPRC;

|DEFBUCLE cacreano0;     || acera las cuentas
 #1#1;
 ;
 "            ", 0;
 "999999999999", 9;
 e;
 NULL, acumulados;
|FIN;

|| ////////////////////////////////////////////////////////////////////////
|PROCESO OtraSeleccion; || Seleccion Cuadro de Mandos
      sw_con = 1;

      |ABRE #2;
      |DDEFECTO #2;
      #2#0 = #3#0;
      #2#1 = #3#1;
      #2#2 = #3#2;
      |LEE 001#2=;
      |CIERRA #2;

      |SI #2#3 < enDSel4; |O #2#3 > enHSel4;
          sw_con = 0;
          |ACABA;
      |FINSI;

      |SI #3#13 < enDSel9; |O #3#13 > enHSel9;
          sw_con = 0;
          |ACABA;
      |FINSI;

      |SI #3#15 < eaDSel10; |O #3#15 > eaHSel10;
          sw_con = 0;
          |ACABA;
      |FINSI;

      |SI #3#13 ! 0;
          fFecFra = "01.01.0000";
          nPerIVA = 0;
          |SI #3#12 = "R";
              |ABRE #4;
              #4#0  = #3#13;
              #4#27 = #3#15;
              #4#2  = #3#14;
              |LEE 001#4=;
              |SI FSalida = 0;
                  fFecFra = #4#3;
                  nPerIVA = #4#44;
              |FINSI;
              |CIERRA #4;
          |FINSI;
          |SI #3#12 = "S";
              |ABRE #14;
              #14#0  = #3#13;
              #14#27 = #3#15;
              #14#2  = #3#14;
              |LEE 001#14=;
              |SI FSalida = 0;
                  fFecFra = #14#3;
                  nPerIVA = #14#44;
              |FINSI;
              |CIERRA #14;
          |FINSI;
          |SI nPerIVA < enDSel11; |O nPerIVA > enHSel11;
              sw_con = 0;
              |ACABA;
          |FINSI;
          |SI fFecFra > "01.01.0000";
              |SI fFecFra < efDSel12; |O fFecFra > efHSel12;
                  sw_con = 0;
                  |ACABA;
              |FINSI;
          |FINSI;
      |FINSI;
|FPRC;

|| ////////////////////////////////////////////////////////////////////////
|PROCESO GrabaAuxiliar;
 |SI nSw1 [ 1;
     aDepar = "";
     |HAZ GrabaAux100;
     |SI nSw1 = 0; |Y eaDepar = "S"; |HAZ GrabaAux110; |FINSI;
 |SINO;
     aDepar = #101#1;
     |HAZ GrabaAux110;
 |FINSI;
|FPRC;

|PROCESO GrabaAux100;
 |ABRE #100;
 #100#0 = #0#26;
 |LEE 101#100=;
 |SI FSalida ! 0;
     |DDEFECTO #100;
     #100#0 = #0#26;
     |GRABA 020#100b;
 |FINSI;
 #100#1 = "";
 #100#2 = aNueUsu;
 #100#3 = fNueFec;
 #100#4 = #0#29;
 #100#5 = "S";
 #100#32 = eaFicbal;
 |SI nSw1 = 1;
     #100#1  = #0#28;
     #100#5  = "S";
     #100#32 = "";
 |FINSI;
 |PARA nPara1 = 0; |SI nPara1 [ 24; |HACIENDO nPara1 = nPara1 + 1;
       nPara2 = nPara1 + 6;
       #100nPara2 = #0nPara1;
 |SIGUE;
 #100#31 = #0#27;
 |PARA nPara1 = 34; |SI nPara1 [ 45; |HACIENDO nPara1 = nPara1 + 1;
       nPara2 = nPara1 - 1;
       #100nPara2 = #0nPara1;
 |SIGUE;
 |GRABA 020#100a;
 |LIBERA #100;
 |CIERRA #100;
|FPRC;

|PROCESO GrabaAux110;
 |ABRE #110;
 #110#0 = #0#26;
 #110#1 = aDepar;
 |LEE 101#110=;
 |SI FSalida ! 0;
     |DDEFECTO #110;
     #110#0 = #0#26;
     #110#1 = aDepar;
     |GRABA 020#110b;
 |FINSI;
 #110#2 = aNueUsu;
 #110#3 = fNueFec;
 #110#4 = #0#29;
 #110#5 = "N"; |SI #110#1 = #0#28; |O #0#34 = "S"; #110#5 = "S"; |FINSI;
 #110#6 = eaFicbal;
 #110#7 = #101#2;
 |SI nSw1 = 0;
     #110#7 = "TODOS LOS DEPARTAMENTOS SELECCIONADOS";
     #110#6 = "";
     #110#5 = "S";
 |FINSI;
 |GRABA 020#110a;
 |LIBERA #110;
 |CIERRA #110;
|FPRC;
|| ////////////////////////////////////////////////////////////////////////

|PROCESO conceptos;
  |SI #0#10 = "D"; |ACABA; |FINSI;
  |SI #0#10 = "G";
     sw_con = 0;
     |PARA y = 11; |SI y [ 14; |HACIENDO y = y + 1;
        |SI #0y ! 0;
            #6#0 = #0y;
            |LEE 001#6=;
            |SI FSalida = 0;
                |PARA x = 2; |SI x [ 21; |HACIENDO x = x + 1;
                      |SI #6x  = #3#6;
                          sw_con = 1;
                          |SAL;
                      |FINSI;
                |SIGUE;
            |FINSI;
        |FINSI;
        |SI sw_con = 1; |SAL; |FINSI;
     |SIGUE;
  |FINSI;
  |SI #0#10 = "P";
     sw_con = 0;
     |PARA x = 15; |SI x [ 24; |HACIENDO x = x + 1;
        |SI #0x  = #3#6; sw_con = 1; |SAL; |FINSI;
     |SIGUE;
  |FINSI;
|FPRC;

|PROCESO departamentos;
  |SI #0#35 = "D"; |ACABA; |FINSI;
  sw_con = 0;
  |PARA y = 36; |SI y [ 45; |HACIENDO y = y + 1;
        |SI #0y ! "  "; |Y #0y = #3#21;
            sw_con = 1; |SAL;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO actuali;

  sw_con = 1;
  |HAZ conceptos;
  |SI sw_con = 0; |ACABA; |FINSI;

  sw_con = 1;
  |HAZ departamentos;
  |SI sw_con = 0; |ACABA; |FINSI;

  |SI aParam ! "";
      |HAZ OtraSeleccion;
      |SI sw_con = 0; |ACABA; |FINSI;
  |FINSI;

  aar = lon1;  traba1 = #3#4 % aar;            || coge cuenta1
  aar = lon2;  traba2 = #3#4 % aar;            || coge cuenta2
  aar = lon3;  traba3 = #3#4 % aar;            || coge cuenta3
  aar = lon4;  traba4 = #3#4 % aar;            || coge cuenta4
  aar = lon5;  traba5 = #3#4 % aar;            || coge cuenta5
  aar = lon6;  traba6 = #3#4 % aar;            || coge cuenta6
  |SI lon1 = 100;  traba1 = "";  cuant1 = "";  |FINSI;
  |SI lon2 = 100;  traba2 = "";  cuant2 = "";  |FINSI;
  |SI lon3 = 100;  traba3 = "";  cuant3 = "";  |FINSI;
  |SI lon4 = 100;  traba4 = "";  cuant4 = "";  |FINSI;
  |SI lon5 = 100;  traba5 = "";  cuant5 = "";  |FINSI;
  |SI lon6 = 100;  traba6 = "";  cuant6 = "";  |FINSI;
  |SI prim = 0;
      |DDEFECTO #21;
      |DDEFECTO #22;
      |DDEFECTO #23;
      |DDEFECTO #24;
      |DDEFECTO #25;
      |DDEFECTO #26;
      |SI lon1 ! 100;  |Y #3#5 ] 1;
          cuant1 = traba1;
          #1#0 = cuant1;  #1#1 = 1;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #21;
      |FINSI;
      |SI lon2 ! 100;  |Y #3#5 ] 2;
          cuant2 = traba2;
          #1#0 = cuant2;  #1#1 = 2;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #22;
      |FINSI;
      |SI lon3 ! 100;  |Y #3#5 ] 3;
          cuant3 = traba3;
          #1#0 = cuant3;  #1#1 = 3;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #23;
      |FINSI;
      |SI lon4 ! 100;  |Y #3#5 ] 4;
          cuant4 = traba4;
          #1#0 = cuant4;  #1#1 = 4;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #24;
      |FINSI;
      |SI lon5 ! 100;  |Y #3#5 ] 5;
          cuant5 = traba5;
          #1#0 = cuant5;  #1#1 = 5;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #25;
      |FINSI;
      |SI lon6 ! 100;  |Y #3#5 ] 6;
          cuant6 = traba6;
          #1#0 = cuant6;  #1#1 = 6;
          cuant = #1#0;   juan = #1#1;
          |HAZ leecuenta;
          |SALVA_DATOS #1;
          |REPON_DATOS #26;
      |FINSI;
      prim = 1;
  |FINSI;
  |SI cuant6 ! traba6;
      #1#0 = #26#0;  #1#1 = #26#1;
      |LEE 101#1=;
      |SALVA_DATOS #26;
      |REPON_DATOS #1;
      |GRABA 101#1a;
      cuant6 = traba6;
      #1#0 = cuant6;  #1#1 = 6;
      cuant = #1#0;   juan = #1#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI dig3 = 6;  |O #1#3 = "S";
              mensa = "Recuperando Cuenta: " + #1#0 + "      ";
              |PINTA 2410,mensa;
          |FINSI;
          |SALVA_DATOS #1;
          |REPON_DATOS #26;
      |SINO;
          |DDEFECTO #26;
      |FINSI;
  |FINSI;
  |SI cuant5 ! traba5;
      #1#0 = #25#0;  #1#1 = #25#1;
      |LEE 101#1=;
      |SALVA_DATOS #25;
      |REPON_DATOS #1;
      |GRABA 101#1a; nAlgun = 1;
      cuant5 = traba5;
      #1#0 = cuant5;  #1#1 = 5;
      cuant = #1#0;   juan = #1#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI dig3 = 5;  |O #1#3 = "S";
              mensa = "Recuperando Cuenta: " + #1#0 + "      ";
              |PINTA 2410,mensa;
          |FINSI;
          |SALVA_DATOS #1;
          |REPON_DATOS #25;
      |SINO;
          |DDEFECTO #25;
      |FINSI;
  |FINSI;
  |SI cuant4 ! traba4;
      #1#0 = #24#0;  #1#1 = #24#1;
      |LEE 101#1=;
      |SALVA_DATOS #24;
      |REPON_DATOS #1;
      |GRABA 101#1a; nAlgun = 1;
      cuant4 = traba4;
      #1#0 = cuant4;  #1#1 = 4;
      cuant = #1#0;   juan = #1#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI dig3 = 4;  |O #1#3 = "S";
              mensa = "Recuperando Cuenta: " + #1#0 + "      ";
              |PINTA 2410,mensa;
          |FINSI;
          |SALVA_DATOS #1;
          |REPON_DATOS #24;
      |SINO;
          |DDEFECTO #24;
      |FINSI;
  |FINSI;
  |SI cuant3 ! traba3;
      #1#0 = #23#0;  #1#1 = #23#1;
      |LEE 101#1=;
      |SALVA_DATOS #23;
      |REPON_DATOS #1;
      |GRABA 101#1a; nAlgun = 1;
      cuant3 = traba3;
      #1#0 = cuant3;  #1#1 = 3;
      cuant = #1#0;   juan = #1#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI dig3 = 3;  |O #1#3 = "S";
              mensa = "Recuperando Cuenta: " + #1#0 + "      ";
              |PINTA 2410,mensa;
          |FINSI;
          |SALVA_DATOS #1;
          |REPON_DATOS #23;
      |SINO;
          |DDEFECTO #23;
      |FINSI;
  |FINSI;
  |SI cuant2 ! traba2;
      #1#0 = #22#0;  #1#1 = #22#1;
      |LEE 101#1=;
      |SALVA_DATOS #22;
      |REPON_DATOS #1;
      |GRABA 101#1a; nAlgun = 1;
      cuant2 = traba2;
      #1#0 = cuant2;  #1#1 = 2;
      cuant = #1#0;   juan = #1#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI dig3 = 2;  |O #1#3 = "S";
              mensa = "Recuperando Cuenta: " + #1#0 + "      ";
              |PINTA 2410,mensa;
          |FINSI;
          |SALVA_DATOS #1;
          |REPON_DATOS #22;
      |SINO;
          |DDEFECTO #22;
      |FINSI;
  |FINSI;
  |SI cuant1 ! traba1;
      #1#0 = #21#0;  #1#1 = #21#1;
      |LEE 101#1=;
      |SALVA_DATOS #21;
      |REPON_DATOS #1;
      |GRABA 101#1a; nAlgun = 1;
      cuant1 = traba1;
      #1#0 = cuant1;  #1#1 = 1;
      cuant = #1#0;   juan = #1#1;
      |SI juan [ #3#5;
          |HAZ leecuenta;
          |SI dig3 = 1;  |O #1#3 = "S";
              mensa = "Recuperando Cuenta: " + #1#0 + "      ";
              |PINTA 2410,mensa;
          |FINSI;
          |SALVA_DATOS #1;
          |REPON_DATOS #21;
      |SINO;
          |DDEFECTO #21;
      |FINSI;
  |FINSI;
  |HAZ suma;
  |SI #3#8 = "D";
      #1#51  = #1#51  + #3#9;
      #21#51 = #21#51 + #3#9;
      #22#51 = #22#51 + #3#9;
      #23#51 = #23#51 + #3#9;
      #24#51 = #24#51 + #3#9;
      #25#51 = #25#51 + #3#9;
      #26#51 = #26#51 + #3#9;
  |SINO;
      #1#52  = #1#52  + #3#9;
      #21#52 = #21#52 + #3#9;
      #22#52 = #22#52 + #3#9;
      #23#52 = #23#52 + #3#9;
      #24#52 = #24#52 + #3#9;
      #25#52 = #25#52 + #3#9;
      #26#52 = #26#52 + #3#9;
  |FINSI;
  #1#53  = #1#51  - #1#52;
  #21#53 = #21#51 - #21#52;
  #22#53 = #22#51 - #22#52;
  #23#53 = #23#51 - #23#52;
  #24#53 = #24#51 - #24#52;
  #25#53 = #25#51 - #25#52;
  #26#53 = #26#51 - #26#52;
|FPRC;

|DEFBUCLE cacreano1;
 #3#3;
 0,6,21;
 aDCuenta,    0, #0#2, #0#4, #0#0, #0#6, aDDep;
 aHCuenta,    9, #0#3, #0#5, #0#1, #0#7, aHDep;
 e;
 NULL, actuali;
|FIN;

|PROCESO CopioBlanco;
      |HAZ copiando;
      |NOME_DAT #1 eaFicbal;
      |NOME_DAT #21 eaFicbal;
      |NOME_DAT #22 eaFicbal;
      |NOME_DAT #23 eaFicbal;
      |NOME_DAT #24 eaFicbal;
      |NOME_DAT #25 eaFicbal;
      |NOME_DAT #26 eaFicbal;

      |PINTA 2410,"Poniendo a cero el Plan Contable";
      |BUCLE cacreano0;
|FPRC;

|PROCESO HazTodo;

   nAlgun = 0;
   |SI #0#25 = "N";
       |HAZ CopioBlanco;
   |SINO;
       |HAZ copiando;
       |NOME_DAT #1 eaFicbal;
       |NOME_DAT #21 eaFicbal;
       |NOME_DAT #22 eaFicbal;
       |NOME_DAT #23 eaFicbal;
       |NOME_DAT #24 eaFicbal;
       |NOME_DAT #25 eaFicbal;
       |NOME_DAT #26 eaFicbal;
   |FINSI;

   aDCuenta = "            ";
   aHCuenta = "zzzzzzzzzzzz";
   |SI aParam ! "";
       aDCuenta = eaDSel5;
       aHCuenta = eaHSel5;
   |FINSI;


   lon1 = 100;  lon2 = 100;  lon3 = 100;
   lon4 = 100;  lon5 = 100;  lon6 = 100;
   |SI dig3 ] 1; lon1 = 100 + dig4; |FINSI;
   |SI dig3 ] 2; lon2 = 100 + dig5; |FINSI;
   |SI dig3 ] 3; lon3 = 100 + dig6; |FINSI;
   |SI dig3 ] 4; lon4 = 100 + dig7; |FINSI;
   |SI dig3 ] 5; lon5 = 100 + dig8; |FINSI;
   |SI dig3 ] 6; lon6 = 100 + dig9; |FINSI;

   |DDEFECTO #1;
   |DDEFECTO #21;
   |DDEFECTO #22;
   |DDEFECTO #23;
   |DDEFECTO #24;
   |DDEFECTO #25;
   |DDEFECTO #26;
   prim = 0;
   |ABRE #1;
   |ABRE #6;
   |BUCLE cacreano1;
   |SI prim = 1;
      |SI lon6 ! 100;
          #1#0 = #26#0;  #1#1 = #26#1;
          |LEE 101#1=;
          |SALVA_DATOS #26;
          |REPON_DATOS #1;
          |GRABA 101#1a;
          nAlgun = 1;
      |FINSI;
      |SI lon5 ! 100;
          #1#0 = #25#0;  #1#1 = #25#1;
          |LEE 101#1=;
          |SALVA_DATOS #25;
          |REPON_DATOS #1;
          |GRABA 101#1a;
          nAlgun = 1;
      |FINSI;
      |SI lon4 ! 100;
          #1#0 = #24#0;  #1#1 = #24#1;
          |LEE 101#1=;
          |SALVA_DATOS #24;
          |REPON_DATOS #1;
          |GRABA 101#1a;
          nAlgun = 1;
      |FINSI;
      |SI lon3 ! 100;
          #1#0 = #23#0;  #1#1 = #23#1;
          |LEE 101#1=;
          |SALVA_DATOS #23;
          |REPON_DATOS #1;
          |GRABA 101#1a;
          nAlgun = 1;
      |FINSI;
      |SI lon2 ! 100;
          #1#0 = #22#0;  #1#1 = #22#1;
          |LEE 101#1=;
          |SALVA_DATOS #22;
          |REPON_DATOS #1;
          |GRABA 101#1a;
          nAlgun = 1;
      |FINSI;
      |SI lon1 ! 100;
          #1#0 = #21#0;  #1#1 = #21#1;
          |LEE 101#1=;
          |SALVA_DATOS #21;
          |REPON_DATOS #1;
          |GRABA 101#1a;
          nAlgun = 1;
      |FINSI;
   |FINSI;
   |CIERRA #6;
   |CIERRA #1;
|FPRC;


|PROCESO PorDepartamentos;
 |SI #0#35 ! "D";
     sw_con = 0;
     |PARA y = 36; |SI y [ 45; |HACIENDO y = y + 1;
           |SI #0y ! "  "; |Y #0y = #101#1;
               sw_con = 1; |SAL;
           |FINSI;
     |SIGUE;
     |SI sw_con = 0; |ACABA; |FINSI;
 |FINSI;

 |ATRI R; |PINTA 2310, "Departamento: "; |ATRI 0;
 |PINTA 2324, #101#1;
 |PINTA 2327, #101#2;
 |PINTA 2410, "                                             ";

 aDDep = #101#1;
 aHDep = #101#1;
 alfa1 = #0#26; alfa1 = ("00" + alfa1) % -102;
 eaFicbal = "caba" + alfa1 + #101#1;
 |HAZ HazTodo;
 |SI #0#28 = "  "; #0#28 = #101#1; |FINSI;
 nSw1 = 2;
 |HAZ GrabaAuxiliar;
|FPRC;

|DEFBUCLE PorDepartamentos;
 #101#1;
 ;
 enEmpresa, #0#8;
 enEmpresa, #0#9;
 e;
 NULL, PorDepartamentos;
|FIN;

|| **********************************************************************
|| *** Borrar primero la Sesion
|PROCESO Quitofich;
  |DFICE fich;
  |SI alfa1 ! "";
      temporal2 = fich + alfa1 + ".ixx";
      |FBORRA temporal2;
      temporal2 = fich + alfa1 + ".dat";
      |FBORRA temporal2;
      temporal2 = fich + alfa1 + ".ddx";
      |FBORRA temporal2;
  |FINSI;
|FPRC;

|PROCESO BorroSesLin;
  alfa1 = #110#6; |QBF alfa1;
  |HAZ Quitofich;
  |BORRA 020#110a;
  |LIBERA #110;
|FPRC;

|DEFBUCLE BorroSesLin;
 #110#1;
 ;
 #100#0, "  ";
 #100#0, "zz";
 be;
 NULL, BorroSesLin;
|FIN;

|PROCESO BorroSesion;
 |ABRE #100;
 #100#0 = #0#26;
 |LEE 101#100=;
 |SI FSalida = 0;
     alfa1 = #100#32; |QBF alfa1;
     |HAZ Quitofich;
     |BUCLE BorroSesLin;
     |BORRA 020#100a;
 |FINSI;
 |LIBERA #100;
 |CIERRA #100;
|FPRC;

|PROCESO DesactLin;
  #110#5 = "N";
  |GRABA 020#110a;
  |LIBERA #110;
|FPRC;

|DEFBUCLE DesactLin;
 #110#1;
 ;
 #100#0, aD1;
 #100#0, aH1;
 be;
 NULL, DesactLin;
|FIN;

|PROCESO Desactualiza;
 |ABRE #100;
 #100#0 = nAntSes;
 |LEE 101#100=;
 |SI FSalida = 0;
     |SI nAntSes ! #0#26;
         #100#5 = "N";
         |GRABA 020#100a;
         aD1 = ""; aH1 = "zz";
         |BUCLE DesactLin;
     |SINO;
         |SI aAntDep ! #0#28;
             aD1 = aAntDep; aH1 = aAntDep;
             |BUCLE DesactLin;
         |FINSI;
     |FINSI;
 |FINSI;

 |LIBERA #100;
 |CIERRA #100;
|FPRC;

|PROCESO alsalir;  |TIPO 12;

 |SI #0#33 = "N"; |ACABA; |FINSI;

 aDDep = "  ";
 aHDep = "zz";
 |SI #0#35 = "D";
     aDDep = #0#8;
     aHDep = #0#9;
 |FINSI;

 |SI #0#25 = "N";
     |HAZ HazTodo;
 |SINO;
     |HAZ BorroSesion;
     #0#28 = "";
     |HAZ CopioBlanco;
     aFicbueno = "cabalano";

     |SI #0#27 = "N";
         alfa1 = #0#26; alfa1 = ("00" + alfa1) % -102;
         eaFicbal = "cabala" + alfa1;
         |HAZ HazTodo;
         nSw1 = 0; |HAZ GrabaAuxiliar;
     |SINO;
         |BUCLE PorDepartamentos;
         nSw1 = 1; |HAZ GrabaAuxiliar;
     |FINSI;
 |FINSI;

 |SI aParam = "";
     |SI #0#26 ! nAntSes; |O #0#28 ! aAntDep;
         |HAZ Desactualiza;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO copiando;
  |DFICE fich;
  temporal1 = fich + aFicbueno + ".ixx";
  temporal2 = fich + eaFicbal  + ".ixx";
  |COPIA_FICHERO temporal1,temporal2;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  temporal1 = fich + aFicbueno + ".dat";
  temporal2 = fich + eaFicbal  + ".dat";
  |COPIA_FICHERO temporal1,temporal2;
  |SI FSalida ! 0;
      temporal2 = fich + eaFicbal + ".ixx";
      |FBORRA temporal2;
      |ACABA;
  |FINSI;
  temporal1 = fich + aFicbueno + ".ddx";
  temporal2 = fich + eaFicbal  + ".ddx";
  |COPIA_FICHERO temporal1,temporal2;
|FPRC;

|PROCESO leecuenta;
  |LIBERA #1;
  |LEE 101#1=;
  |SI FSalida ! 0;
      |LIBERA #1;
      |DDEFECTO #1;
      #1#0 = cuant;
      #1#1 = juan;
      |HAZ defect1;
      |PUSHV 0501 1980;
      |PINPA #0#1;
      |PINDA #0#1;
      |ENDATOS #1#1;
      |SI FSalida ! 0;
          |DDEFECTO #1;
          #1#0 = cuant;
          #1#1 = juan;
      |FINSI;
      |GRABA 020#1b;
      |POPV;
  |FINSI;
|FPRC;

|PROCESO suma;
  |SI #3#1 > #1#58;   #1#58  = #3#1;  |FINSI;
  |SI #3#1 > #21#58;  #21#58 = #3#1;  |FINSI;
  |SI #3#1 > #22#58;  #22#58 = #3#1;  |FINSI;
  |SI #3#1 > #23#58;  #23#58 = #3#1;  |FINSI;
  |SI #3#1 > #24#58;  #24#58 = #3#1;  |FINSI;
  |SI #3#1 > #25#58;  #25#58 = #3#1;  |FINSI;
  |SI #3#1 > #26#58;  #26#58 = #3#1;  |FINSI;
  |SI #3#0 ! 0;|Y #3#0 ! 99;
      ini = #30#11;
      fecalf = #3#1;
      mes = fecalf % 402;
      mesfec = mes;
      mesac = (mesfec - ini) + 1;
      |SI mesac [ 0;
          mesac = (13 - ini) + mesfec;
      |FINSI;
      a = (mesac * 3) + 9;
      b = a + 1;
      c = a + 2;
      |SI #3#8 = "D";
          #1a    = #1a    + #3#9;
          #1c    = #1a    - #1b;
          #21a   = #21a   + #3#9;
          #21c   = #21a   - #21b;
          #22a   = #22a   + #3#9;
          #22c   = #22a   - #22b;
          #23a   = #23a   + #3#9;
          #23c   = #23a   - #23b;
          #24a   = #24a   + #3#9;
          #24c   = #24a   - #24b;
          #25a   = #25a   + #3#9;
          #25c   = #25a   - #25b;
          #26a   = #26a   + #3#9;
          #26c   = #26a   - #26b;
          |ACABA;
      |FINSI;
      #1b    = #1b    + #3#9;
      #1c    = #1a    - #1b;
      #21b   = #21b   + #3#9;
      #21c   = #21a   - #21b;
      #22b   = #22b   + #3#9;
      #22c   = #22a   - #22b;
      #23b   = #23b   + #3#9;
      #23c   = #23a   - #23b;
      #24b   = #24b   + #3#9;
      #24c   = #24a   - #24b;
      #25b   = #25b   + #3#9;
      #25c   = #25a   - #25b;
      #26b   = #26b   + #3#9;
      #26c   = #26a   - #26b;
      |ACABA;
  |FINSI;
  |SI #3#0 = 0;
      |SI #3#8 = "D";
          #1#9   = #1#9   + #3#9;
          #1#11  = #1#9   - #1#10;
          #21#9  = #21#9  + #3#9;
          #21#11 = #21#9  - #21#10;
          #22#9  = #22#9  + #3#9;
          #22#11 = #22#9  - #22#10;
          #23#9  = #23#9  + #3#9;
          #23#11 = #23#9  - #23#10;
          #24#9  = #24#9  + #3#9;
          #24#11 = #24#9  - #24#10;
          #25#9  = #25#9  + #3#9;
          #25#11 = #25#9  - #25#10;
          #26#9  = #26#9  + #3#9;
          #26#11 = #26#9  - #26#10;
          |ACABA;
      |FINSI;
      #1#10  = #1#10  + #3#9;
      #1#11  = #1#9   - #1#10;
      #21#10 = #21#10 + #3#9;
      #21#11 = #21#9  - #21#10;
      #22#10 = #22#10 + #3#9;
      #22#11 = #22#9  - #22#10;
      #23#10 = #23#10 + #3#9;
      #23#11 = #23#9  - #23#10;
      #24#10 = #24#10 + #3#9;
      #24#11 = #24#9  - #24#10;
      #25#10 = #25#10 + #3#9;
      #25#11 = #25#9  - #25#10;
      #26#10 = #26#10 + #3#9;
      #26#11 = #26#9  - #26#10;
      |ACABA;
  |FINSI;
  |SI #3#8 = "D";
      #1#48 = #1#48 + #3#9;
      #1#50 = #1#48 - #1#49;
      #21#48 = #21#48 + #3#9;
      #21#50 = #21#48 - #21#49;
      #22#48 = #22#48 + #3#9;
      #22#50 = #22#48 - #22#49;
      #23#48 = #23#48 + #3#9;
      #23#50 = #23#48 - #23#49;
      #24#48 = #24#48 + #3#9;
      #24#50 = #24#48 - #24#49;
      #25#48 = #25#48 + #3#9;
      #25#50 = #25#48 - #25#49;
      #26#48 = #26#48 + #3#9;
      #26#50 = #26#48 - #26#49;
      |ACABA;
  |FINSI;
  #1#49  = #1#49  + #3#9;
  #1#50  = #1#48  - #1#49;
  #21#49 = #21#49 + #3#9;
  #21#50 = #21#48 - #21#49;
  #22#49 = #22#49 + #3#9;
  #22#50 = #22#48 - #22#49;
  #23#49 = #23#49 + #3#9;
  #23#50 = #23#48 - #23#49;
  #24#49 = #24#49 + #3#9;
  #24#50 = #24#48 - #24#49;
  #25#49 = #25#49 + #3#9;
  #25#50 = #25#48 - #25#49;
  #26#49 = #26#49 + #3#9;
  #26#50 = #26#48 - #26#49;
|FPRC;

|PROGRAMA;

 aParam = PARAMETRO; |QBF aParam;

 |ABRE #0;
 |LEE 101#0p;
 |SI FSalida ! 0;
     |DDEFECTO #0;
     |GRABA 020#0b;
 |FINSI;

 nAntSes = #0#26;
 aAntDep = #0#28;

 fNueFec = ~;
 aNueUsu = Usuario % 0810;
 aFicbueno = "cacuenta";
 eaFicbal  = "cabalano";

 |SI aParam = "";
     |HAZ inicio;
     |HAZ eVarEmpresa;
     |CLS;
     |CABEZA "Creacion Fichero Balances a Fechas";

     #0#33 = "N";
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |Y #0#33 = "S";
         |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;

 |SINO;

      |LIBERA #0;
      |CIERRA #0;
      alfa1 = enNRatio; |QBF alfa1;
      alfa1 = ("0000" + alfa1) % -104;
      eaFicbal = "cacr" + alfa1;
      |DDEFECTO #0;
      #0#0 = enDSel1;
      #0#1 = enHSel1;
      #0#2 = efDSel2;
      #0#3 = efHSel2;
      #0#4 = enDSel3;
      #0#5 = enHSel3;
      #0#6 = enDSel6;
      #0#7 = enHSel6;
      #0#8 = eaDSel7;
      #0#9 = eaHSel7;
      #0#10 = "D";
      #0#33 = "S";
      |HAZ alsalir;
  |FINSI;
|FPRO;
