|FICHEROS;
   cabucemp #0;
   cabucem1 #1;

   canempre #30;
   caportad #3;
   camaasic #2;
|FINSI;

|VARIABLES;
   nCont  = 0;
   nNume  = 0;
   nCampo = 0;
   Campo1 = 0;
   Campo2 = 0;

   EmpreAnt = 0;
   PerioAnt = 0;

   DEmpresa = 0; DPeriodo = 0;
   HEmpresa = 0; HPeriodo = 0;

   alfa1 = "";
   alfa2 = "";
   dir_fich = "";
   fFecha = @;
   nDiario = 0;
|FIN;

|PROCESO Seleccion;
   |SI #0#64 = "S";
      |C_M #0#0,1,"S"; |C_M #0#1,1,"S";
      |C_M #0#2,1,"S"; |C_M #0#3,1,"S";
      |PARA nCont = 4; |SI nCont [ 63; |HACIENDO nCont = nCont + 3;
            |C_M #0nCont,1,"N"; nNume = nCont + 1;
            |C_M #0nNume,1,"N";
      |SIGUE;
   |SINO;
      |C_M #0#0,1,"N"; |C_M #0#1,1,"N";
      |C_M #0#2,1,"N"; |C_M #0#3,1,"N";
      |PARA nCont = 4; |SI nCont [ 63; |HACIENDO nCont = nCont + 3;
            |C_M #0nCont,1,"S"; nNume = nCont + 1;
            |C_M #0nNume,1,"S";
      |SIGUE;
   |FINSI;
|FPRC;

|PROCESO AntesEmp;
   |SI FSalida = 2; |ACABA; |FINSI;

   |C_M #0Campo, 0, alfa1;
   |SI alfa1 = "N"; |ACABA; |FINSI;

   Campo1 = Campo + 1;
   |SI #0Campo = 0;
        #0Campo1 = 0;  |C_M #0Campo1, 1, "N"; |PINTA #0Campo1;
        |PARA nCampo = Campo + 3;  |SI nCampo [ 61;  |HACIENDO nCampo = nCampo + 3;
              #0nCampo = 0;  |C_M #0nCampo, 1, "N"; |PINTA #0nCampo;
              Campo1   = nCampo + 1;
              #0Campo1 = 0;  |C_M #0Campo1, 1, "N"; |PINTA #0Campo1;
        |SIGUE;
   |SINO;
        |C_M #0Campo1, 1, "S";
        |PARA nCampo = Campo + 3;  |SI nCampo [ 61;  |HACIENDO nCampo = nCampo + 3;
              |C_M #0nCampo, 1, "S";
              Campo1   = nCampo + 1;
              |C_M #0Campo1, 1, "S";
        |SIGUE;
   |FINSI;
|FPRC;

|PROCESO TrasEmp;
   |SI FSalida = 2; |ACABA; |FINSI;

   |C_M #0Campo, 0, alfa1;
   |SI alfa1 = "N"; |ACABA; |FINSI;

   |SI #0#64 = "S"; |ACABA; |FINSI;

   Campo1 = Campo - 1; Campo2 = Campo + 1;

   #canempre#2 = #0Campo1;
   #canempre#3 = #0Campo;
   |LEE 000#canempre.=;
   |SI FSalida = 0;
      #0Campo2 = #canempre#1; |PINTA #0Campo2;
   |SINO;
      |MENAV "    Empresa inexistente";
      |ERROR;
   |FINSI;
|FPRC;


|PROCESO LeeDiario;
 fFecha = #2#1;
 |ERROR10;
|FPRC;

|DEFBUCLE LeeDiario;
 #2#1;
 ;
 nDiario, "01.00.0000", 000001;
 nDiario, "31.12.9999", 999999;
 ;
 NULL, LeeDiario;
|FIN;

|PROCESO Empresas;

  |DDEFECTO #cabucem1;
  #cabucem1#0 = #canempre#2;
  #cabucem1#1 = #canempre#3;
  #cabucem1#2 = #canempre#11;

  |DBASE dir_fich; |QBF dir_fich;
  dir_fich = dir_fich + "fich/";
  alfa1 = #canempre#2; |QBF alfa1;
  alfa2 = #canempre#3; |QBF alfa2;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"     + alfa2;   alfa2 = alfa2 % -101;
  dir_fich = dir_fich + alfa1 + alfa2 + "/";
  |PATH_DAT #2 dir_fich;
  fFecha = "01.00.0000"; nDiario = 0;  |BUCLE LeeDiario; #cabucem1#3 = fFecha;
  fFecha = "01.00.0000"; nDiario = 99; |BUCLE LeeDiario; #cabucem1#4 = fFecha;

  |GRABA 020#cabucem1.n;
|FPRC;

|DEFBUCLE Empresas;
 #canempre#1;
 ;
 DEmpresa,DPeriodo;
 HEmpresa,HPeriodo;
 ;
 NULL,Empresas;
|FIN;

|PROGRAMA;

   |CLS;
   |PINPA #0#0;
   |PINDA #0#0;
   |DELINDEX #cabucem1;

   |ABRE #cabucem1;
   |ABRE #canempre;
   |ENDATOS #1#0;
   |CIERRA #canempre;
   |SI FSalida = 0;
       |SI #0#64 = "S";
           DEmpresa = #0#0; DPeriodo = #0#1;
           HEmpresa = #0#2; HPeriodo = #0#3;
           |BUCLE Empresas;
      |SINO;
         |PARA nCont = 4; |SI nCont [ 63; |HACIENDO nCont = nCont + 3;
               Campo1 = nCont + 1;
               DEmpresa = #0nCont; DPeriodo = #0Campo1;
               HEmpresa = #0nCont; HPeriodo = #0Campo1;
               |BUCLE Empresas;
         |SIGUE;
      |FINSI;
   |FINSI;
   |CIERRA #cabucem1;
|FPRO;
