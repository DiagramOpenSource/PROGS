|FICHEROS;
     cainpaba #0;
     camanpag #1;
     camanban #2;
     caivasop #3;
|FIN;

|INCLUYE acceso_i;

|VARIABLES;
     informe = "cainpaba";
     sw = 0;
     &ult_ban = 0;
     &total = 0;
     &total1 = 0;
     &sw_inf = 0;
     &empres = "";
     &cp = "";
     &impor = 0;
     alfa1 = "";
     novale = 0;
     Parte1 = "";
     Parte2 = "";
     Posic1 = 0;
     Posic2 = 0;
     Comodin = "";
     Long = "";
     LongNum = 0;
     FEstado = 0;
     MaxDig = 0;

     &eaDescr = "";
|FIN;

|PROCESO mayor;
     alfa1 = #0Campo > " ";
     #0Campo = alfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO imprim;
     |HAZ verbueno;
     |SI novale = 1; |ACABA; |FINSI;
     |SI sw = 0;
          sw = 1;
          sw_inf = 0;
          |HAZ busca_cuen;
          |PRINT;
          ult_ban = #1#26;
     |FINSI;
     |SI ult_ban ! #1#26;
          sw_inf = 2;    ||Imprime el primer total
          |PRINT;
          sw_inf = 0;
          |HAZ busca_cuen;
          |PRINT;
          total = 0;
     |FINSI;
     sw_inf = 1;
     |HAZ leeiva;
     |PRINT;
     total = total + impor;
     total1 = total1 + impor;
     ult_ban = #1#26;
|FPRC;

|PROCESO leeiva;
     eaDescr = "";
     |DDEFECTO #3;
     #3#0 = #1#0;
     #3#2 = #1#1;
     #3#27 = #1#2;
     |LEE 001#3=;
     eaDescr = #1#28; |QBF eaDescr;
     |SI eaDescr = ""; eaDescr = #3#7; |FINSI;
|FPRC;

|PROCESO busca_cuen;
  #2#0  = #1#26;
  |LEE 001#2=;
  |SI FSalida ! 0;
      |DDEFECTO #2;
  |FINSI;
|FPRC;

|DEFBUCLE lee_pago;
 #1#5;
 0, 1, 11; || selecciona libro+factura+tipo recibo
 #0#15, #0#6, #0#4, 0, #0#0, #0#2, #0#12;
 #0#16, #0#7, #0#5, 9, #0#1, #0#3, #0#13;
 e;
 NULL, imprim;
|FIN;

|PROCESO inicia; |TIPO 3;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |INFOR informe;
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  empres = #48#1;
  |ABRE #3;
  |ABRE #2;
  |BUCLE lee_pago;
  |SI sw = 1;
      sw_inf = 2;
      |PRINT;
  |FINSI;
  |CIERRA #3;
  |CIERRA #2;
  |PIEINF;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO verbueno;
   novale = 0;
   impor = 0;
   |SI #0#14 = "T";
       impor = #1#8; || importe total pago
       |ACABA;
   |FINSI;
   |SI #0#14 = "S";
       impor = #1#23; || importe pagado
       |SI impor = 0;
           novale = 1;
       |FINSI;
       |ACABA;
   |FINSI;
   |SI #0#14 = "N";
       impor = #1#8 - #1#23; || importe total - liquidado
       |SI impor = 0; |O #1#22 = "S";
           novale = 1;
           impor = 0;
       |FINSI;
       |ACABA;
   |FINSI;
|FPRC;

|PROCESO Cuenta; |TIPO 6;

   |SI dig4 ! 0; MaxDig = dig4; |FINSI;
   |SI dig5 ! 0; MaxDig = dig5; |FINSI;
   |SI dig6 ! 0; MaxDig = dig6; |FINSI;
   |SI dig7 ! 0; MaxDig = dig7; |FINSI;
   |SI dig8 ! 0; MaxDig = dig8; |FINSI;
   |SI dig9 ! 0; MaxDig = dig9; |FINSI;

   Comodin = #cainpaba#Campo#;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      FEstado = FSalida;
      Posic1 = (FEstado / 100) ! 0;
      Posic1 = Posic1 + 99;
      Posic2 = FEstado + 98;
      Parte1 = Comodin % Posic1;
      Parte2 = Comodin % Posic2;
      |QBF Comodin;
      Long = Comodin % 0;
      LongNum = MaxDig - Long;
      Comodin = "0" * LongNum;
      Comodin = Parte1 + Comodin + Parte2;
      #cainpaba#Campo# = Comodin;
      |PINTA #cainpaba#Campo#;
   |FINSI;
|FPRC;                                                                              |PINTA #capredcb#Campo#;


|PROCESO init; |TIPO 8;
   |HAZ inicio;
|FPRC;
