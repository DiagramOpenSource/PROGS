|FICHEROS;
     ealtai01;
     ealtai02;

     caivaasi;
     camaasic;
     camaasil;
     caclipro;
     caivaref;
     caivarep;
     caivasop;
     casiim01;
     calicont;
     cacon300;
|FIN;

|VARIABLES;
     nHandle             = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp2               = 0;
     nCmp3               = 0;
     nCmp4               = 0;
     nCmp5               = 0;
     nTCmp               = 0;
     nPue                = 0;
     nCar                = 0;
     nLon                = 0;
     nSuma               = 0;
     nLinIVA             = 0;
     nGraba              = 0;
     nSw                 = 0;
     nDConcepto          = 0;
     nHConcepto          = 0;
     nNume               = 0;

     aBase               = "";
     aPathTmp            = "";
     aFic                = "";
     aAbre               = "";
     aHora               = "";
     aTip                = "";
     aTipoLin            = "";
     aAlfa               = "";
     aCar                = "";
     aCad                = "";
     aLon                = "";
     aPais               = "";
     aCntrp              = "";
     aCntrpIva           = "";
     aOri                = "";
     aDes                = "";

 {50}aCmp                = "";

     fFecha              = @;

     &eaUnidadBasico     = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE quitar_i;

|PROCESO PonComa;
     aCad  = "";
     nNume = aAlfa;
     |SI nNume ! 0;
         aLon = aAlfa % 0;
         nLon = aLon;
         |PARA nCar = 1;  |SI nCar [ nLon;  |HACIENDO nCar = nCar + 1;
               nPue = (100 * nCar) + 1;
               aCar = aAlfa % nPue;

               |SI aCar = ".";
                   aCar = ",";
               |FINSI;

               aCad = aCad + aCar;
         |SIGUE;
    |FINSI;
    aAlfa = aCad;
|FPRC;

|PROCESO LimpiaCmp;
     IaCmp = aCmp1 <-;
     |PARA nCmp = 1;  |SI nCmp [ 50;  |HACIENDO nCmp = nCmp + 1;
           aCmp = "";
           IaCmp = IaCmp + 1;
     |SIGUE;
|FPRC;

|PROCESO GrabaTxt;
     IaCmp = aCmp1 <-;
     |PARA nCmp = 1;  |SI nCmp [ nTCmp;  |HACIENDO nCmp = nCmp + 1;
           eaCadena = aCmp; |QBF eaCadena;  |HAZ QuitaRaros;
           |XGRABA nHandle, eaCadena;

           |SI nCmp ! nTCmp;
               |XGRABA nHandle, ";";
           |FINSI;

           aCmp  = "";
           IaCmp = IaCmp + 1;
     |SIGUE;

     aAlfa = &13 + &10;
     |XGRABA nHandle, aAlfa;

     nGraba = 1;
|FPRC;

|PROCESO DetalleC;
     aAlfa = #camaasil#4 % 102;

     aTip = "";
     |SI aAlfa = "40";  aTip = "P";  |FINSI;
     |SI aAlfa = "41";  aTip = "P";  |FINSI;
     |SI aAlfa = "43";  aTip = "C";  |FINSI;
     |SI aAlfa = "44";  aTip = "C";  |FINSI;

     |SI aTip = "";  |ACABA;  |FINSI;

     |HAZ LimpiaCmp;

     #caclipro#23 = aTip;
     #caclipro#10 = #camaasil#4;
     #caclipro#11 = #camaasil#5;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     nTCmp  = 44;
     aCmp1  = "C";
     aCmp2  = #camaasil#4;
     aCmp3  = #caclipro#9;
     aCmp4  = #caclipro#1;
     aCmp6  = #caclipro#2;
     aCmp11 = (("00" + #caclipro#3) % -102) + (("000" + #caclipro#4) % -103);
     aCmp12 = #caclipro#6;
     aCmp13 = #caclipro#5;
     aCmp14 = #caclipro#7;
     aCmp16 = #caclipro#8;
     aCmp20 = #caclipro#24 % 102;
     aCmp23 = "N";
     aCmp26 = "0";

     aPais  = #caclipro#24; |QBF aPais;
     aCmp27 = "1000";

     aAlfa   = aPais;  |QBF aAlfa;
     |SI aAlfa = "GR";  aPais = "EL";  |FINSI;

     |SI aPais ! "ES";
                            aCmp27 = "0001";
         |SI aAlfa = "DE";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "AT";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "BE";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "BG";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "CY";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "DK";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "SI";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "EE";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "FI";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "FR";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "EL";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "GB";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "NL";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "HU";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "IT";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "IE";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "LV";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "LT";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "LU";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "MT";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "PL";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "PT";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "CZ";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "SK";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "RO";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "SE";  aCmp27 = "0100";  |FINSI;
         |SI aAlfa = "HR";  aCmp27 = "0100";  |FINSI;
     |FINSI;

     aAlfa = #caclipro#9 % 101;   |QBF aAlfa;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         aCmp27 = "1000";
     |FINSI;

     |SI aCmp27 = "1000";  aCmp38 = "1";  |FINSI;
     |SI aCmp27 = "0100";  aCmp38 = "2";  |FINSI;
     |SI aCmp27 = "0001";  aCmp38 = "6";  |FINSI;

     |SI aAlfa = "40";  aCmp27 = aCmp27 + "0000000000";  |FINSI;
     |SI aAlfa = "41";  aCmp27 = aCmp27 + "0000000000";  |FINSI;
     |SI aAlfa = "43";  aCmp27 = aCmp27 + "000000";      |FINSI;
     |SI aAlfa = "44";  aCmp27 = aCmp27 + "000000";      |FINSI;

     aCmp31 = #caclipro#21;

     |HAZ GrabaTxt;
|FPRC;

|PROCESO Contrapartida;
     #calicont#0 = #camaasil#0;
     #calicont#1 = #camaasil#1;
     #calicont#2 = #camaasil#2;
     #calicont#3 = #camaasil#3;
     |LEE 000#calicont.=;
     |SI FSalida = 0;
         aCmp5 = #calicont#4;  |QBF aCmp5;
     |FINSI;

     |SI aCmp5 ! "";  |ACABA;  |FINSI;

     |SI #camaasil#8 = "D";
         aCmp5 = #camaasic#10;  |QBF aCmp5;
     |FINSI;

     |SI #camaasil#8 = "H";
         aCmp5 = #camaasic#8;  |QBF aCmp5;
     |FINSI;
|FPRC;

|PROCESO DetalleA;
     |HAZ LimpiaCmp;

     nTCmp  = 36;
     aCmp1  = "A";
     aCmp2  = #camaasil#3;
     aCmp3  = (#camaasil#1 % 102) + "/" + (#camaasil#1 % 402) + "/" + (#camaasil#1 % 704);
     aCmp4  = #camaasil#4;

     |HAZ Contrapartida;
     aCntrp = aCmp5;
     |SI #camaasil#19 = "F"; |O #camaasil#19 = "f"; |O #camaasil#19 = " ";
         |SI aCntrpIva = "";
             aCntrpIva = aCntrp;
         |FINSI;
     |FINSI;

     aCmp6  = #camaasil#7;
     aCmp7  = #camaasil#8;
     aCmp13 = #camaasil#2;
     aCmp14 = "DS";

     aAlfa  = #camaasil#9;  |HAZ PonComa;
     aCmp20 = aAlfa;
     aCmp21 = "E";

     |HAZ GrabaTxt;
|FPRC;

|PROCESO camaasil;
     aCntrp = "";

     |SI aTipoLin = "C";
         |HAZ DetalleC;
         |ACABA;
     |FINSI;

     |SI aTipoLin = "A";
         |HAZ DetalleA;

         |ACABA;
     |FINSI;
|FPRC;

|PROCESO CargaCmpRep;
     |HAZ LimpiaCmp;

     aCmp1  = "I";
     aCmp2  = (#caivarep#3 % 102) + "/" + (#caivarep#3 % 402) + "/" + (#caivarep#3 % 704);

     aAlfa  = #caivarep#nCmp2#;  |HAZ PonComa;  aCmp4  = aAlfa;
     aAlfa  = #caivarep#nCmp4#;  |HAZ PonComa;  aCmp6  = aAlfa;

     aCmp8  = #caivarep#2;
     |SI #caivarep#27 ! "  ";
         aCmp8  = #caivarep#27 + "/" + #caivarep#2;
     |FINSI;

     aCmp9  = #caivarep#4;
     aCmp10 = #caivarep#51; || Nif
     aCmp11 = "1";

     |SI #cacon300#2 = 1;  aCmp11 = "1";  |FINSI;
     |SI #cacon300#2 = 3;  aCmp11 = "2";  |FINSI;
     |SI #cacon300#2 = 8;  aCmp11 = "3";  |FINSI;
     |SI #cacon300#2 = 2;  aCmp11 = "4";  |FINSI;
     |SI #cacon300#2 = 15; aCmp11 = "5";  |FINSI;
     |SI #cacon300#2 = 16; aCmp11 = "8";  |FINSI;
     |SI #cacon300#2 = 18; aCmp11 = "9";  |FINSI;

     aAlfa  = #caivarep#nCmp1#;  |HAZ PonComa;  aCmp12 = aAlfa;
     aAlfa  = #caivarep#nCmp3#;  |HAZ PonComa;  aCmp13 = aAlfa;
     aAlfa  = #caivarep#nCmp5#;  |HAZ PonComa;  aCmp14 = aAlfa;
     aAlfa  = #caivarep#26#;     |HAZ PonComa;  aCmp16 = aAlfa;

     aCmp18 = "N";
     aCmp19 = #caivarep#48;
     aCmp20 = #caivarep#50;

     |SI #cacon300#2 = 9;   aCmp21 = "1";  |FINSI;
     |SI #cacon300#2 = 15;  aCmp21 = "2";  |FINSI;
     |SI #cacon300#2 = 7;   aCmp21 = "6";  |FINSI;
     |SI #cacon300#2 = 14;  aCmp21 = "7";  |FINSI;

     aCmp23 = (#caivarep#3 % 102) + "/" + (#caivarep#3 % 402) + "/" + (#caivarep#3 % 704);
     aCmp25 = aCntrpIva;
     aCmp28 = "N";
     aCmp33 = "N";
     aCmp34 = "";
     aCmp37 = "S";
     aCmp38 = "N";

     |SI #caivaref#3 > "01.01.2000";
         aCmp39 = (#caivaref#3 % 102) + "/" + (#caivaref#3 % 402) + "/" + (#caivaref#3 % 704);
     |FINSI;

     |SI #caivaasi#51 = "S";
         #casiim01#0 = "caivarep";
         #casiim01#1 = #caivarep#0;
         #casiim01#2 = #caivarep#27 + (("000000" + #caivarep#2) % -106);
         |LEE 000#casiim01.=;
         |SI FSalida = 0;
             aCmp41 = #casiim01#10;
         |FINSI;
     |FINSI;

     |HAZ GrabaTxt;
|FPRC;

|PROCESO IVA_Rep;
     nTCmp  = 42;

     #cacon300#0 = #caivarep#6;
     |LEE 000#cacon300.=;
     |SI FSalida ! 0;  |DDEFECTO #cacon300;  |FINSI;

     #caivaref#0 = #caivarep#0;
     #caivaref#1 = #caivarep#27;
     #caivaref#2 = #caivarep#2;
     |LEE 000#caivaref.=;
     |SI FSalida ! 0;  |DDEFECTO #caivaref;  |FINSI;

     nSuma = #caivarep#8 + #caivarep#14 + #caivarep#20;
     |SI nSuma ! 0;
         nLinIVA = 1;
         nCmp1   = 8;
         nCmp2   = 11;
         nCmp3   = 14;
         nCmp4   = 17;
         nCmp5   = 20;

         |HAZ CargaCmpRep;
     |FINSI;

     nSuma = #caivarep#9 + #caivarep#15 + #caivarep#21;
     |SI nSuma ! 0;
         nLinIVA = 2;
         nCmp1   = 9;
         nCmp2   = 12;
         nCmp3   = 15;
         nCmp4   = 18;
         nCmp5   = 21;

         |HAZ CargaCmpRep;
     |FINSI;

     nSuma = #caivarep#10 + #caivarep#16 + #caivarep#22;
     |SI nSuma ! 0;
         nLinIVA = 3;
         nCmp1   = 10;
         nCmp2   = 13;
         nCmp3   = 16;
         nCmp4   = 19;
         nCmp5   = 22;

         |HAZ CargaCmpRep;
     |FINSI;

     nSuma = #caivarep#52 + #caivarep#56 + #caivarep#60;
     |SI nSuma ! 0;
         nLinIVA = 4;
         nCmp1   = 52;
         nCmp2   = 54;
         nCmp3   = 56;
         nCmp4   = 58;
         nCmp5   = 60;

         |HAZ CargaCmpRep;
     |FINSI;

     nSuma = #caivarep#53 + #caivarep#57 + #caivarep#61;
     |SI nSuma ! 0;
         nLinIVA = 5;
         nCmp1   = 53;
         nCmp2   = 55;
         nCmp3   = 57;
         nCmp4   = 59;
         nCmp5   = 61;

         |HAZ CargaCmpRep;
     |FINSI;
|FPRC;

|PROCESO CargaCmpSop;
     |HAZ LimpiaCmp;

     aCmp1  = "I";
     aCmp2  = (#caivasop#3 % 102) + "/" + (#caivasop#3 % 402) + "/" + (#caivasop#3 % 704);

     aAlfa  = #caivasop#nCmp2#;  |HAZ PonComa;  aCmp4  = aAlfa;
     aAlfa  = #caivasop#nCmp4#;  |HAZ PonComa;  aCmp6  = aAlfa;

     aCmp8  = #caivasop#2;
     |SI #caivasop#27 ! "  ";
         aCmp8  = #caivasop#27 + "/" + #caivasop#2;
     |FINSI;

     aCmp9  = #caivasop#4;
     aCmp10 = #caivasop#51; || Nif
     aCmp11 = "1";

     |SI #cacon300#1 = 1;  aCmp11 = "1";  |FINSI;
     |SI #cacon300#1 = 3;  aCmp11 = "2";  |FINSI;
     |SI #cacon300#1 = 2;  aCmp11 = "3";  |FINSI;
     |SI #cacon300#1 = 4;  aCmp11 = "5";  |FINSI;

     aAlfa  = #caivasop#nCmp1#;  |HAZ PonComa;  aCmp12 = aAlfa;
     aAlfa  = #caivasop#nCmp3#;  |HAZ PonComa;  aCmp13 = aAlfa;
     aAlfa  = #caivasop#nCmp5#;  |HAZ PonComa;  aCmp14 = aAlfa;
     aAlfa  = #caivasop#26#;     |HAZ PonComa;  aCmp16 = aAlfa;

     aCmp18 = "N";
     aCmp19 = #caivasop#48;
     aCmp20 = #caivasop#50;

     aCmp22 = "6";
     |SI #cacon300#1 = 9;   aCmp22 = "4";  |FINSI;

     aCmp23 = (#caivasop#3 % 102) + "/" + (#caivasop#3 % 402) + "/" + (#caivasop#3 % 704);
     |SI #caivasop#23 = "N";
         aCmp24 = aCmp13;
     |FINSI;
     aCmp25 = aCntrpIva;
     aCmp28 = "N";
     aCmp33 = "N";
     aCmp34 = "N";
     aCmp37 = "S";
     aCmp38 = "N";

     |SI #caivaref#3 > "01.01.2000";
         aCmp39 = (#caivaref#3 % 102) + "/" + (#caivaref#3 % 402) + "/" + (#caivaref#3 % 704);
     |FINSI;

     |SI #caivaasi#51 = "S";
         #casiim01#0 = "caivasop";
         #casiim01#1 = #caivasop#0;
         #casiim01#2 = #caivasop#27 + (("000000" + #caivasop#2) % -106);
         |LEE 000#casiim01.=;
         |SI FSalida = 0;
             aCmp40 = #caivasop#46;
             aCmp41 = #casiim01#10;
         |FINSI;
     |FINSI;

     |HAZ GrabaTxt;
|FPRC;

|PROCESO IVA_Sop;
     nTCmp  = 42;

     #cacon300#0 = #caivasop#6;
     |LEE 000#cacon300.=;
     |SI FSalida ! 0;  |DDEFECTO #cacon300;  |FINSI;

     #caivaref#0 = #caivasop#0;
     #caivaref#1 = #caivasop#27;
     #caivaref#2 = #caivasop#2;
     |LEE 000#caivaref.=;
     |SI FSalida ! 0;  |DDEFECTO #caivaref;  |FINSI;

     nSuma = #caivasop#8 + #caivasop#14 + #caivasop#20;
     |SI nSuma ! 0;
         nLinIVA = 1;
         nCmp1   = 8;
         nCmp2   = 11;
         nCmp3   = 14;
         nCmp4   = 17;
         nCmp5   = 20;

         |HAZ CargaCmpSop;
     |FINSI;

     nSuma = #caivasop#9 + #caivasop#15 + #caivasop#21;
     |SI nSuma ! 0;
         nLinIVA = 2;
         nCmp1   = 9;
         nCmp2   = 12;
         nCmp3   = 15;
         nCmp4   = 18;
         nCmp5   = 21;

         |HAZ CargaCmpSop;
     |FINSI;

     nSuma = #caivasop#10 + #caivasop#16 + #caivasop#22;
     |SI nSuma ! 0;
         nLinIVA = 3;
         nCmp1   = 10;
         nCmp2   = 13;
         nCmp3   = 16;
         nCmp4   = 19;
         nCmp5   = 22;

         |HAZ CargaCmpSop;
     |FINSI;

     nSuma = #caivasop#52 + #caivasop#56 + #caivasop#60;
     |SI nSuma ! 0;
         nLinIVA = 4;
         nCmp1   = 52;
         nCmp2   = 54;
         nCmp3   = 56;
         nCmp4   = 58;
         nCmp5   = 60;

         |HAZ CargaCmpSop;
     |FINSI;

     nSuma = #caivasop#53 + #caivasop#57 + #caivasop#61;
     |SI nSuma ! 0;
         nLinIVA = 5;
         nCmp1   = 53;
         nCmp2   = 55;
         nCmp3   = 57;
         nCmp4   = 59;
         nCmp5   = 61;

         |HAZ CargaCmpSop;
     |FINSI;
|FPRC;

|PROCESO conceptos;
   |SI #ealtai01#7 = "S";
       nSw = 1;
   |SINO;
       |PARA nCampo = 10;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
             |SI #ealtai01#nCampo# = #camaasil#6; |Y #ealtai01#nCampo# ! 0;
                 nSw = 1;
                 |SAL;
             |FINSI;
       |SIGUE;
   |FINSI;
   |SI nSw = 1;
       |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE conceptos;
   #camaasil#1;
   6;
   #camaasic#0, #camaasic#1, #camaasic#2, 001, nDConcepto;
   #camaasic#0, #camaasic#1, #camaasic#2, 999, nHConcepto;
   ;
   NULL, conceptos;
|FIN;

|PROCESO camaasic;

     nSw = 0;
     |BUCLE conceptos;
     |SI nSw = 0; |ACABA; |FINSI;

     |SI #ealtai01#6 = "N";
         #ealtai02#0 = #camaasic#0;
         #ealtai02#1 = #camaasic#1;
         #ealtai02#2 = #camaasic#2;
         |LEE 000#ealtai02.=;
         |SI FSalida = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     aBase     = "";
     aCntrpIva = "";
     aTipoLin = "C";
     |BUCLELIN 2camaasil#camaasic;

     aTipoLin = "A";
     |BUCLELIN 2camaasil#camaasic;

     #ealtai02#0 = #camaasic#0;
     #ealtai02#1 = #camaasic#1;
     #ealtai02#2 = #camaasic#2;
     |LEE 000#ealtai02.=;
     |SI FSalida ! 0;
         |DDEFECTO #ealtai02;
         #ealtai02#0 = #camaasic#0;
         #ealtai02#1 = #camaasic#1;
         #ealtai02#2 = #camaasic#2;
         |GRABA 020#ealtai02.b;
     |FINSI;

     #ealtai02#3 = ~;
     #ealtai02#4 = Usuario % 810;
     |GRABA 020#ealtai02.a;
     |LIBERA #ealtai02;

     |SELECT #4#caivarep;
     #caivarep#45 = #camaasic#0;
     #caivarep#46 = #camaasic#1;
     #caivarep#47 = #camaasic#2;
     |LEE 000#caivarep.=;
     |SI FSalida = 0;
         |HAZ IVA_Rep;
         |ACABA;
     |FINSI;

     |SELECT #4#caivasop;
     #caivasop#45 = #camaasic#0;
     #caivasop#46 = #camaasic#1;
     #caivasop#47 = #camaasic#2;
     |LEE 000#caivasop.=;
     |SI FSalida = 0;
         |HAZ IVA_Sop;

         |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE camaasic;
     #camaasic#1;
     ;
     #ealtai01#0, #ealtai01#2, #ealtai01#4;
     #ealtai01#1, #ealtai01#3, #ealtai01#5;
     ;
     NULL, camaasic;
|FIN;

|PROCESO T3;  |TIPO 3;

     nDConcepto = 001;
     nHConcepto = 999;
     |SI #ealtai01#7 = "S";
         nDConcepto = #ealtai01#8;
         nHConcepto = #ealtai01#9;
     |FINSI;

     |DBASE aBase;
     aPathTmp = aBase + "tmp";             |MKDIR aPathTmp;
     aPathTmp = aPathTmp + "/" + Usuario;  |MKDIR aPathTmp;
     aPathTmp = aPathTmp + "/";

     fFecha = ~;
     |HORA aHora;

     aFic = fFecha % -104;
     aFic = aFic + (fFecha % 402);
     aFic = aFic + (fFecha % 102);
     aFic = aFic + (aHora  % 102);
     aFic = aFic + (aHora  % 402);
     aFic = aFic + (aHora  % 702);
     aFic = aFic + ".txt";

     aAbre = aPathTmp + aFic;
     |XABRE "WB", aAbre, nHandle;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #ealtai02;
     |ABRE #caclipro;
     |ABRE #calicont;
     |ABRE #caivarep;
     |ABRE #caivasop;
     |ABRE #casiim01;
     |ABRE #cacon300;
     |BUCLE camaasic;
     |CIERRA #ealtai02;
     |CIERRA #caclipro;
     |CIERRA #calicont;
     |CIERRA #caivarep;
     |CIERRA #caivasop;
     |CIERRA #casiim01;
     |CIERRA #cacon300;

     |XCIERRA nHandle;

     |SI nGraba = 0;
         aAbre = aPathTmp + aFic;   |FBORRA aAbre;
         |MENAV "0000Seleccion vacia.";
         |ACABA;
     |FINSI;

     |HAZ LeeUnidadBasico;
     aDes = eaUnidadBasico + "/DOCUMENTOS";  |RMKDIR aDes;
     aDes = aDes + "/ALTAI";                 |RMKDIR aDes;
     aDes = aDes + "/";

     aOri = aPathTmp + aFic;
     aDes = aDes     + aFic;

     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO aOri, aDes;
     |SINO;
         |COPIA_FICHERO aOri, aDes;
     |FINSI;
     |SI FSalida = 0;
         |BLANCO 0501 2380;
         |CUADRO 0501 2380;

         |ATRI I;
         |PINTA 1002, "El TXT generado se encuentra en";
         |ATRI 0;

         |ATRI P;
         |PINTA 1202, aDes;
         |ATRI 0;

         |LEETECLA aAlfa;
     |FINSI;

     |FBORRA aOri;
|FPRC;

|PROCESO T7C0; |TIPO 7;
    |SI nSw = 0;
        #ealtai01#2 = fec1;  |PINTA #ealtai01#2;
        #ealtai01#3 = fec2;  |PINTA #ealtai01#3;
    |FINSI;
    nSw = 1;
|FPRC;

|PROCESO seleccion; |TIPO 0;
     |SI #ealtai01#7 = "N";

         #ealtai01#8 =   1;  |PINTA #ealtai01#8; |C_M #ealtai01#8, 1, "N";
         #ealtai01#9 = 999;  |PINTA #ealtai01#9; |C_M #ealtai01#9, 1, "N";

         |PARA nCampo = 10;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               |C_M #ealtai01#nCampo#, 1, "S";
         |SIGUE;
     |SINO;

         |C_M #ealtai01#8, 1, "S";
         |C_M #ealtai01#9, 1, "S";

         |PARA nCampo = 10;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               |C_M #ealtai01#nCampo#, 1, "N";
               #ealtai01#nCampo# = 0;  |PINTA #ealtai01#nCampo#;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasConceptos; |TIPO 0;
     |SI #ealtai01#Campo# = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               #ealtai01#nCampo# = 0;  |C_M #ealtai01#nCampo#, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               |C_M #ealtai01#nCampo#, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;


|PROGRAMA;

   |HAZ inicio;
   |CLS;
   |PINPA #0#ealtai01;

   nSw = 1;
   |ABRE #ealtai01;
   #ealtai01#20 = "A";
   |LEE 141#ealtai01.=;
   |SI FSalida ! 0;
       nSw = 0;
       |DDEFECTO #ealtai01;
       #ealtai01#20 = "A";
       |GRABA 020#ealtai01.b;
   |FINSI;

   |PINDA #0#ealtai01;
   |ENDATOS #1#ealtai01;
   |SI FSalida = 0;
       #ealtai01#2 = #ealtai01#3;
       #ealtai01#3 = fec2;
       #ealtai01#6 = "N";
       |GRABA 020#ealtai01.a;
   |FINSI;
   |LIBERA #ealtai01;
   |CIERRA #ealtai01;
|FPRO;
