|FICHEROS;
    capre303 #0;

    caiva300 #1;         || control iva
    caman303 #2;         || man. 303

    caivarep #4;         || repercutido
    caivasop #5;         || soportado
    cacon300 #7;         || conceptos IVA
    caportad #8;         || portada modelos

    caw00007 #99;        || Acumulador 303 Anteriores.
    eosma100 #100;
|FIN;

|INCLUYE acceso_i;
|INCLUYE tempo_i;
|INCLUYE varnue_i;

|VARIABLES;
    temporal1 = ""; traba1 = ""; dirfich0 = "";
    temporal2 = ""; traba2 = "";

    cont     = 0;
    trime    = 0;
    anyo     = 0;
    activi   = "";
    compen   = 0;
    tipo     = 0;
    total    = 0;
    rendi1   = 0;
    rendi2   = 0;
    penult   = 0;
    estado   = 0;
    ventas   = 0;
    x        = 0;
    camp     = 0;
    xxxxfiac = "  ";
    xxaponer = "  ";
    xrelleno = "                              ";
    modo = 0;
    t_ivasop = 0;
    t_bassop = 0;
    FEstado= 0;
    per_ant = -1;
    x1 = 0;
    x2 = 0;
    x3 = 0;
    x4 = 0;
    x5 = 0;
    perio = 0;
    peria = 0;
    any   = 0;
    emp   = "";
    emp1  = "";
    FConcep = 0;
    tot_iva = 0;
    tot_bas = 0;
    &compens = 0;

    trim1 = @;
    trim2 = @;
    trim3 = @;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    antes1 = 0;
    antes2 = 0;
    antes3 = 0;
    antes4 = 0;
    antes5 = 0;
    antes6 = 0;
    antes11 = 0;
    antes12 = 0;
    antes13 = 0;
    antes14 = 0;
    antes15 = 0;
    antes16 = 0;

    sw_exi = 0;
    &a_emp = 0;
    &a_per = 0;
    &ac_pe = 0;

   frase_d     = "";
   informado_d = "";
   Linea1      = "";
   Linea2      = "";
   Linea3      = "";
   swyacal = 0;

   nHPeriodo = 0;
   aTipo     = "";
   nSubeIVA  = 0;
   nPer      = 0;
   nIVA5     = 0;
   nIVA8     = 0;
   nIVA11    = 0;
   nIVA14    = 0;
   nIVA17    = 0;
   nIVA46    = 0;

   informe   = "";
   nSwOp        = 0;
   nCampo       = 0;
   nCampo1      = 0;
   nCampo2      = 0;
   nCampo3      = 0;
   nActividad   = 0;
   nPorce1      = 0;
   nPorce2      = 0;

   nNume1       = 0;
   nNume2       = 0;
   nIVA         = 0;
   nBase        = 0;
   nCuota       = 0;
   nMasBase     = 0;

   base = 0;
   tiva = 0;
   iva  = 0;
   rec  = 0;
   nSwAcum = 0;
   nPara1 = 0;
   nPara2 = 0;
   nPara3 = 0;

    &enBase     = 0;
    &enBaseI    = 0;
    &enCuota    = 0;
    &enCuotaI   = 0;
    &enPorce    = 0;
    &enPorceI   = 0;
    &enSwLinea  = 0;
    &aText      = "";
    &aTexr      = "";
    &aDescr     = "";
|FIN;

|PROCESO tipo8; |TIPO 8;
  |HAZ inicio;
  |HAZ eVarEmpresa;

  |DDEFECTO #8;
  |ABRE #8;
  #8#0 = #30#2;
  #8#1 = #30#26;
  |LEE 000#8=;
  |SI FSalida ! 0;
     |MENAV "    No encontrado Fichero Portadas Modelos";
     |CIERRA #8;
     |PTEC 807;
     |ACABA;
  |FINSI;
  |CIERRA #8;
|FPRC;

|PROCESO Mayor;
     |C_M #0#7,1,"S";
     |SI #0#6 = "N";
         |C_M #0#7,1,"N";
         #0#7 = "N"; |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;
  #0#0 = #8#93;
  #0#1 = 1;
  #0#2 = 1;
  |PINDA #0#0;
|FPRC;

|PROCESO per_hasta; |TIPO 0;
  |SI #0#0 = "T"; |Y #0Campo > 4;
     |ERROR;
  |FINSI;
  |SI #0#0 = "A"; |Y #0Campo > 1;
     |ERROR;
  |FINSI;
|FPRC;

|| ************************************************************************
|| ************************************************************************
|PROCESO copiando;
    temporal1 = dirfich0 + "/" + traba1 + ".dat";
    temporal2 = dirfich0 + "/" + traba2 + ".dat";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0; |ACABA; |FINSI;
    temporal1 = dirfich0 + "/" + traba1 + ".ixx";
    temporal2 = dirfich0 + "/" + traba2 + ".ixx";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0; |ACABA; |FINSI;
    temporal1 = dirfich0 + "/" + traba1 + ".ddx";
    temporal2 = dirfich0 + "/" + traba2 + ".ddx";
    |COPIA_FICHERO temporal1,temporal2;
    |SI FSalida ! 0; |ACABA; |FINSI;
|FPRC;

|PROCESO per_reper1;
|SI #2#45 = "A"; #4#44 = 1; |FINSI;
|SI #2#45 = "T";
    alfa1 = #4#3;   alfa1 = alfa1 % -104;      || saca a¤o
    alfa2 = "31.03." + alfa1;  trim1 = alfa2;  || primer trimestre
    alfa2 = "30.06." + alfa1;  trim2 = alfa2;  || segundo trimestre
    alfa2 = "30.09." + alfa1;  trim3 = alfa2;  || tercer trimestre
    |SI #4#3 [ trim1;                   #4#44 = 1;  |FINSI;
    |SI #4#3 > trim1;|Y #4#3 [ trim2;   #4#44 = 2;  |FINSI;
    |SI #4#3 > trim2;|Y #4#3 [ trim3;   #4#44 = 3;  |FINSI;
    |SI #4#3 > trim3;                   #4#44 = 4;  |FINSI;
|FINSI;
|SI #2#45 = "M";
    alfa1 = #4#3;  alfa1 = alfa1 % 402;      || saca mes
    #4#44 = alfa1;
|FINSI;

|GRABA 020#4a;
|LIBERA #4;
|FPRC;

|DEFBUCLE per_reper;
 #4#1;
 ;
  1, "  ",      1;
 99, "zz", 999999;
 be;
 NULL, per_reper1;
|FIN;

|PROCESO per_sopor1;
|SI #2#45 = "A"; #5#44 = 1; |FINSI;
|SI #2#45 = "T";
    alfa1 = #5#3;   alfa1 = alfa1 % -104;      || saca a¤o
    alfa2 = "31.03." + alfa1;  trim1 = alfa2;  || primer trimestre
    alfa2 = "30.06." + alfa1;  trim2 = alfa2;  || segundo trimestre
    alfa2 = "30.09." + alfa1;  trim3 = alfa2;  || tercer trimestre
    |SI #5#3 [ trim1;                   #5#44 = 1;  |FINSI;
    |SI #5#3 > trim1;|Y #5#3 [ trim2;   #5#44 = 2;  |FINSI;
    |SI #5#3 > trim2;|Y #5#3 [ trim3;   #5#44 = 3;  |FINSI;
    |SI #5#3 > trim3;                   #5#44 = 4;  |FINSI;
|FINSI;
|SI #2#45 = "M";
    alfa1 = #5#3;  alfa1 = alfa1 % 402;      || saca mes
    #5#44 = alfa1;
|FINSI;
|GRABA 020#5a;
|LIBERA #5;
|FPRC;

|DEFBUCLE per_sopor;
 #5#1;
 ;
  1, "  ",      1;
 99, "zz", 999999;
 be;
 NULL, per_sopor1;
|FIN;

|| ****************** Tratamiento Fichero 100
|PROCESO ActuRepartoAdq;
       |ABRE #100;
       #100#0 = "303";
       #100#1 = #2#0;
       #100#2 = nActividad;
       #100#3 = #2#1;
       #100#4 = #2#2;
       #100#5 = nCampo1;
       |LEE 101#100=;
       |SI FSalida ! 0;
           |DDEFECTO #100;
           #100#0 = "303";
           #100#1 = #2#0;
           #100#2 = nActividad;
           #100#3 = #2#1;
           #100#4 = #2#2;
           #100#5 = nCampo1;
           |GRABA 020#100b;
       |FINSI;
       #100#6  = #2#78 % nPorce1; #100#7  = #2#79; #100#8  = #2#80 % nPorce2;
       #100#9  = #2#81 % nPorce1; #100#10 = #2#82; #100#11 = #2#83 % nPorce2;
       #100#12 = #2#84 % nPorce1; #100#13 = #2#85; #100#14 = #2#86 % nPorce2;
       #100#15 = #2#87 % nPorce1; #100#16 = #2#88; #100#17 = #2#89 % nPorce2;
       |GRABA 020#100a;
       |LIBERA #100;
       |CIERRA #100;
|FPRC;

|PROCESO eosma100B;
     |SI nSwOp = 0;
         |BORRA 020#100a;
     |SINO;
          |SI #100#5 > 17; |Y #100#5 ! 46;
              #100#6  = #100#6  % nPorce1;
              #100#8  = #100#8  % nPorce2;
              #100#9  = #100#9  % nPorce1;
              #100#11 = #100#11 % nPorce2;
              #100#12 = #100#12 % nPorce1;
              #100#14 = #100#14 % nPorce2;
              #100#15 = #100#15 % nPorce1;
              #100#17 = #100#17 % nPorce2;
              #100#18 = #100#18 % nPorce1;
              #100#20 = #100#20 % nPorce2;
              #100#21 = #100#21 % nPorce1;
              #100#23 = #100#23 % nPorce2;
              #100#24 = #100#24 % nPorce1;
              #100#26 = #100#26 % nPorce2;
              |GRABA 020#100a;
           |FINSI;
     |FINSI;
     |LIBERA #100;
|FPRC;

|DEFBUCLE eosma100B;
     #100#1;
     ;
     "303", #2#0, nActividad, #2#1, #2#2, 000;
     "303", #2#0, nActividad, #2#1, #2#2, 999;
     be;
     NULL, eosma100B;
|FIN;

|PROCESO PonerDesglose;
  |SI nIVA = 0;                              nNume1 = 87; |FINSI;
  |SI nIVA = 16; |O nIVA = 18; |O nIVA = 21; nNume1 = 84; |FINSI;
  |SI nIVA = 7;  |O nIVA =  8; |O nIVA = 10; nNume1 = 81; |FINSI;
  |SI nIVA = 4;                              nNume1 = 78; |FINSI;

   #2nNume1 = nBase; nNume1 = nNume1 + 1;
   #2nNume1 = nIVA;  nNume1 = nNume1 + 1;
   #2nNume1 = nCuota;
|FPRC;

|PROCESO ConcepVenta;
     #100#0 = "303";
     #100#1 = #2#0;
     #100#2 = nActividad;
     #100#3 = #2#1;
     #100#4 = #2#2;
     #100#5 = nCampo1;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #2#0;
         #100#2 = nActividad;
         #100#3 = #2#1;
         #100#4 = #2#2;
         #100#5 = nCampo1;
         |GRABA 020#100b;
     |FINSI;

     nSwAcum = 0;

     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #100nPara2  = tiva;
               #100nPara1  = #100nPara1 + base;
               #100nPara2  = tiva;
               #100nPara3  = #100nPara3 + iva;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #100nPara2 = 0;
                   #100nPara1  = base;
                   #100nPara2 = tiva;
                   #100nPara3  = iva;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;

     |SI nSubeIVA ! 0;
         nMasBase = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
                nPara2 = nPara1 + 1;
                nPara3 = nPara1 + 2;
                |SI #100nPara2 ! 0; nMasBase = nMasBase + 1; |FINSI;
         |SIGUE;
         |SI nMasBase > 1;
             |SI #100#5 = 5;  nIVA5 = 1; |FINSI;
             |SI #100#5 = 8;  nIVA8 = 1; |FINSI;
             |SI #100#5 = 11; nIVA11 = 1; |FINSI;
             |SI #100#5 = 14; nIVA14 = 1; |FINSI;
             |SI #100#5 = 17; nIVA17 = 1; |FINSI;
             |SI #100#5 = 46; nIVA46 = 1; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;


|PROCESO recargo;
    x1 = 0;  x2 = 0;  x3 = 0;  x4 = 0;  x5 = 0;
  |SALVA_DATOS #4;
  |SI nSubeIVA = 2;
      |SI #4#17 =  1; #4#17 = 1.40; |FINSI;
      |SI #4#17 =  4; #4#17 = 5.20; |FINSI;
      |SI #4#18 =  1; #4#18 = 1.40; |FINSI;
      |SI #4#18 =  4; #4#18 = 5.20; |FINSI;
      |SI #4#19 =  1; #4#19 = 1.40; |FINSI;
      |SI #4#19 =  4; #4#19 = 5.20; |FINSI;
      |SI #4#58 =  1; #4#58 = 1.40; |FINSI;
      |SI #4#58 =  4; #4#58 = 5.20; |FINSI;
      |SI #4#59 =  1; #4#59 = 1.40; |FINSI;
      |SI #4#59 =  4; #4#59 = 5.20; |FINSI;
  |FINSI;

|SI #4#17 = #1#4;   x1 = 14;  |FINSI;
|SI #4#17 = #1#5;   x1 = 17;  |FINSI;
|SI #4#17 = #1#6;   x1 = 46;  |FINSI;

|SI #4#18 = #1#4;   x2 = 14;  |FINSI;
|SI #4#18 = #1#5;   x2 = 17;  |FINSI;
|SI #4#18 = #1#6;   x2 = 46;  |FINSI;

|SI #4#19 = #1#4;   x3 = 14;  |FINSI;
|SI #4#19 = #1#5;   x3 = 17;  |FINSI;
|SI #4#19 = #1#6;   x3 = 46;  |FINSI;

|SI #4#58 = #1#4;   x4 = 14;  |FINSI;
|SI #4#58 = #1#5;   x4 = 17;  |FINSI;
|SI #4#58 = #1#6;   x4 = 46;  |FINSI;

|SI #4#59 = #1#4;   x5 = 14;  |FINSI;
|SI #4#59 = #1#5;   x5 = 17;  |FINSI;
|SI #4#59 = #1#6;   x5 = 46;  |FINSI;

|REPON_DATOS #4;

|SI x1 ! 0;
    nCampo1 = x1;
    #2x1 = #2x1 + #4#08;                     || base 1
    x1 = x1 + 1;    #2x1 = #4#17;            || (%) rec. 1
    x1 = x1 + 1;    #2x1 = #2x1 + #4#20;     || cuota rec. 1
    base = #4#8;
    tiva = #4#17;
    iva  = #4#20;
    |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
|FINSI;
|SI x2 ! 0;
    nCampo1 = x2;
    #2x2 = #2x2 + #4#09;                     || base 2
    x2 = x2 + 1;    #2x2 = #4#18;            || (%) rec. 2
    x2 = x2 + 1;    #2x2 = #2x2 + #4#21;     || cuota rec. 2
    base = #4#9;
    tiva = #4#18;
    iva  = #4#21;
    |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
|FINSI;
|SI x3 ! 0;
    nCampo1 = x3;
    #2x3 = #2x3 + #4#10;                     || base 3
    x3 = x3 + 1;    #2x3 = #4#19;            || (%) rec. 3
    x3 = x3 + 1;    #2x3 = #2x3 + #4#22;     || cuota rec. 3
    base = #4#10;
    tiva = #4#19;
    iva  = #4#22;
    |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
|FINSI;
|SI x4 ! 0;
    nCampo1 = x4;
    #2x4 = #2x4 + #4#52;                     || base 4
    x4 = x4 + 1;    #2x4 = #4#58;            || (%) rec. 4
    x4 = x4 + 1;    #2x4 = #2x4 + #4#60;     || cuota rec. 4
    base = #4#52;
    tiva = #4#58;
    iva  = #4#60;
    |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
|FINSI;
|SI x5 ! 0;
    nCampo1 = x5;
    #2x5 = #2x5 + #4#53;                     || base 5
    x5 = x5 + 1;    #2x5 = #4#59;            || (%) rec. 5
    x5 = x5 + 1;    #2x5 = #2x5 + #4#61;     || cuota rec. 5
    base = #4#53;
    tiva = #4#59;
    iva  = #4#61;
    |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
|FINSI;
|FPRC;

|PROCESO ConcepCompra;
     #100#0 = "303";
     #100#1 = #2#0;
     #100#2 = nActividad;
     #100#3 = #2#1;
     #100#4 = #2#2;
     #100#5 = nCampo1;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #2#0;
         #100#2 = nActividad;
         #100#3 = #2#1;
         #100#4 = #2#2;
         #100#5 = nCampo1;
         |GRABA 020#100b;
     |FINSI;

     nSwAcum = 0;

     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #100nPara2  = tiva;
               #100nPara1  = #100nPara1 + (base % nPorce1);
               #100nPara2  = tiva;
               #100nPara3  = #100nPara3 + ((iva + rec) % nPorce2);
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #100nPara2 = 0;
                   #100nPara1  = base % nPorce1;
                   #100nPara2 = tiva;
                   #100nPara3  = iva % nPorce2;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

|PROCESO GuardaBases;
    |ABRE #100;
    |SI #5#14 ! 0; base = #5#8;  iva = #5#14; tiva = #5#11; |HAZ ConcepCompra; |FINSI;
    |SI #5#15 ! 0; base = #5#9;  iva = #5#15; tiva = #5#12; |HAZ ConcepCompra; |FINSI;
    |SI #5#16 ! 0; base = #5#10; iva = #5#16; tiva = #5#13; |HAZ ConcepCompra; |FINSI;
    |SI #5#56 ! 0; base = #5#52; iva = #5#56; tiva = #5#54; |HAZ ConcepCompra; |FINSI;
    |SI #5#57 ! 0; base = #5#53; iva = #5#57; tiva = #5#55; |HAZ ConcepCompra; |FINSI;
    |CIERRA #100;
|FPRC;

|PROCESO iva_sop;
    t_ivasop = #5#14+#5#15+#5#16+#5#20+#5#21+#5#22+#5#56+#5#57+#5#60+#5#61; || suma recargo
    t_bassop = 0;
    |SI #5#14 ! 0; |O #5#20 ! 0; t_bassop = t_bassop + #5#8; |FINSI;
    |SI #5#15 ! 0; |O #5#21 ! 0; t_bassop = t_bassop + #5#9; |FINSI;
    |SI #5#16 ! 0; |O #5#22 ! 0; t_bassop = t_bassop + #5#10; |FINSI;
    |SI #5#56 ! 0; |O #5#60 ! 0; t_bassop = t_bassop + #5#52; |FINSI;
    |SI #5#57 ! 0; |O #5#61 ! 0; t_bassop = t_bassop + #5#53; |FINSI;

    |SI #5#23 = "S";
        |SI #5#48 = "S";
             #2#63 = #2#63 + t_bassop;
             #2#43 = #2#43 + t_ivasop;   || operaciones interiores inversiones
            nCampo1 = 63;
            nCampo2 = 43;
        |SINO;
             #2#62 = #2#62 + t_bassop;
             #2#21 = #2#21 + t_ivasop;   || operaciones interiores corrientes
            nCampo1 = 62;
            nCampo2 = 21;
        |FINSI;
    |FINSI;
|FPRC;


|PROCESO iva_rep;

    x1 = 0;  x2 = 0;  x3 = 0;  x4 = 0;  x5 = 0;
    |SALVA_DATOS #4;
    |SI nSubeIVA = 1;
        |SI #4#11 = 16; #4#11 = 18; |FINSI;
        |SI #4#11 =  7; #4#11 =  8; |FINSI;
        |SI #4#12 = 16; #4#12 = 18; |FINSI;
        |SI #4#12 =  7; #4#12 =  8; |FINSI;
        |SI #4#13 = 16; #4#13 = 18; |FINSI;
        |SI #4#13 =  7; #4#13 =  8; |FINSI;
        |SI #4#54 = 16; #4#54 = 18; |FINSI;
        |SI #4#54 =  7; #4#54 =  8; |FINSI;
        |SI #4#55 = 16; #4#55 = 18; |FINSI;
        |SI #4#55 =  7; #4#55 =  8; |FINSI;
    |FINSI;

    |SI nSubeIVA = 2;
        |SI #4#11 = 18; |O #4#11 = 16; #4#11 = 21; |FINSI;
        |SI #4#11 =  8; |O #4#11 =  7; #4#11 = 10; |FINSI;
        |SI #4#12 = 18; |O #4#12 = 16; #4#12 = 21; |FINSI;
        |SI #4#12 =  8; |O #4#12 =  7; #4#12 = 10; |FINSI;
        |SI #4#13 = 18; |O #4#13 = 16; #4#13 = 18; |FINSI;
        |SI #4#13 =  8; |O #4#13 =  7; #4#13 =  8; |FINSI;
        |SI #4#54 = 18; |O #4#54 = 16; #4#54 = 18; |FINSI;
        |SI #4#54 =  8; |O #4#54 =  7; #4#54 =  8; |FINSI;
        |SI #4#55 = 18; |O #4#55 = 16; #4#55 = 18; |FINSI;
        |SI #4#55 =  8; |O #4#55 =  7; #4#55 =  8; |FINSI;
    |FINSI;

    |SI #4#11 = #1#1;   x1 =  5;  |FINSI;
    |SI #4#11 = #1#2;   x1 =  8;  |FINSI;
    |SI #4#11 = #1#3;   x1 = 11;  |FINSI;

    |SI #4#12 = #1#1;   x2 =  5;  |FINSI;
    |SI #4#12 = #1#2;   x2 =  8;  |FINSI;
    |SI #4#12 = #1#3;   x2 = 11;  |FINSI;

    |SI #4#13 = #1#1;   x3 =  5;  |FINSI;
    |SI #4#13 = #1#2;   x3 =  8;  |FINSI;
    |SI #4#13 = #1#3;   x3 = 11;  |FINSI;

    |SI #4#54 = #1#1;   x4 =  5;  |FINSI;
    |SI #4#54 = #1#2;   x4 =  8;  |FINSI;
    |SI #4#54 = #1#3;   x4 = 11;  |FINSI;

    |SI #4#55 = #1#1;   x5 =  5;  |FINSI;
    |SI #4#55 = #1#2;   x5 =  8;  |FINSI;
    |SI #4#55 = #1#3;   x5 = 11;  |FINSI;

    |REPON_DATOS #4;
    |SI x1 ! 0;
        nCampo1 = x1;
        #2x1 = #2x1 + #4#08;                     || base 1
        x1 = x1 + 1;
        |SI #2x1 ! #4#11;
            |SI x1 = 6;  nIVA5  = 1; |FINSI;
            |SI x1 = 9;  nIVA8  = 1; |FINSI;
            |SI x1 =12;  nIVA11 = 1; |FINSI;
        |FINSI;
        x1 = x1 + 1;    #2x1 = #2x1 + #4#14;     || cuota iva 1
        base = #4#8;
        tiva = #4#11;
        iva  = #4#14;
        |HAZ ConcepVenta;
    |FINSI;

    |SI x2 ! 0;
        nCampo1 = x2;
        #2x2 = #2x2 + #4#09;                     || base 2
        x2 = x2 + 1;
        |SI #2x2 ! #4#12;
            |SI x2 = 6;  nIVA5  = 1; |FINSI;
            |SI x2 = 9;  nIVA8  = 1; |FINSI;
            |SI x2 =12;  nIVA11 = 1; |FINSI;
        |FINSI;
        x2 = x2 + 1;    #2x2 = #2x2 + #4#15;     || cuota iva 2
       base = #4#9;
       tiva = #4#12;
       iva  = #4#15;
       |HAZ ConcepVenta;
    |FINSI;
    |SI x3 ! 0;
       nCampo1 = x3;
        #2x3 = #2x3 + #4#10;                     || base 3
        x3 = x3 + 1;
        |SI #2x3 ! #4#13;
            |SI x3 = 6;  nIVA5  = 1; |FINSI;
            |SI x3 = 9;  nIVA8  = 1; |FINSI;
            |SI x3 =12;  nIVA11 = 1; |FINSI;
        |FINSI;
        x3 = x3 + 1;    #2x3 = #2x3 + #4#16;     || cuota iva 3
       base = #4#10;
       tiva = #4#13;
       iva  = #4#16;
       |HAZ ConcepVenta;
    |FINSI;
    |SI x4 ! 0;
        nCampo1 = x4;
        #2x4 = #2x4 + #4#52;                     || base 4
        x4 = x4 + 1;
        |SI #2x4 ! #4#54;
            |SI x4 = 6;  nIVA5  = 1; |FINSI;
            |SI x4 = 9;  nIVA8  = 1; |FINSI;
            |SI x4 =12;  nIVA11 = 1; |FINSI;
        |FINSI;
        x4 = x4 + 1;    #2x4 = #2x4 + #4#56;     || cuota iva 4
        base = #4#52;
        tiva = #4#54;
        iva  = #4#56;
        |HAZ ConcepVenta;
    |FINSI;
    |SI x5 ! 0;
        nCampo1 = x5;
        #2x5 = #2x5 + #4#53;                     || base 5
        x5 = x5 + 1;
        |SI #2x5 ! #4#55;
            |SI x5 = 6;  nIVA5  = 1; |FINSI;
            |SI x5 = 9;  nIVA8  = 1; |FINSI;
            |SI x5 =12;  nIVA11 = 1; |FINSI;
        |FINSI;
        x5 = x5 + 1;    #2x5 = #2x5 + #4#57;     || cuota iva 5
        base = #4#53;
        tiva = #4#55;
        iva  = #4#57;
        |HAZ ConcepVenta;
    |FINSI;
    #2#42 = #2#42 + #4#8 + #4#9 + #4#10 + #4#52 + #4#53;
|FPRC;

|PROCESO acum_rep;
     tot_bas = #4#8  + #4#9  + #4#10 + #4#52 + #4#53; ||Total bases
     tot_iva = #4#14 + #4#15 + #4#16 + #4#56 + #4#57; || Total IVA
     tot_iva = tot_iva + #4#20 + #4#21 + #4#22 + #4#60 + #4#61; || + recargo

     |SI #7#2 = 2;  ||Adq Intracomunitarias
         #2#49 = #2#49 + tot_bas;          ||base intracomunitario
         #2#50 = #2#50 + tot_iva;
         nCampo1 = 0;
         |SI #7#1 = 3;
             |SI #4#48 = "N";
                 #2#66 = #2#66 + tot_bas;
                 #2#51 = #2#51 + tot_iva;
                 nCampo1 = 66;
             |FINSI;
             |SI #4#48 = "S";
                 #2#67 = #2#67 + tot_iva;
                 #2#58 = #2#58 + tot_iva;
                 nCampo1 = 67;
             |FINSI;
         |FINSI;
         |SI #4#14 ! 0; nBase = #4#8;  nIVA = #4#11; nCuota = #4#14; |HAZ PonerDesglose; |FINSI;
         |SI #4#15 ! 0; nBase = #4#9;  nIVA = #4#12; nCuota = #4#15; |HAZ PonerDesglose; |FINSI;
         |SI #4#16 ! 0; nBase = #4#10; nIVA = #4#13; nCuota = #4#16; |HAZ PonerDesglose; |FINSI;
         |SI #4#56 ! 0; nBase = #4#52; nIVA = #4#54; nCuota = #4#56; |HAZ PonerDesglose; |FINSI;
         |SI #4#57 ! 0; nBase = #4#53; nIVA = #4#55; nCuota = #4#57; |HAZ PonerDesglose; |FINSI;

         nPorce1 = 100; nPorce2 = 100;
         |SI nCampo1 ! 0; |HAZ ActuRepartoAdq; |FINSI;

     |FINSI;

     |SI #7#2 = 3;       ||Entrada Intracomunitaria
         #2#54 = #2#54 + tot_bas;
         #2#35 = #2#35 + tot_bas;
     |FINSI;

     |SI #7#2 = 4;       ||Operaciones Regimen Simplificado
         #2#34 = #2#34 + tot_bas;
     |FINSI;

     |SI #7#2 = 5;       ||Op. AGyP
         #2#38 = #2#38 + tot_bas;
     |FINSI;

     |SI #7#2 = 6;       ||Recargo de equivalencia
         #2#39  = #2#39 + tot_bas;
     |FINSI;

     |SI #7#2 = 7;       ||Operaciones sujetas 91
         #2#59  = #2#59 + tot_bas;
     |FINSI;

     |SI #7#2 = 8;       ||Exportaciones y otras con derecho a deduccion
         #2#36 = #2#36 + tot_bas;
     |FINSI;

     |SI #7#2 = 9;       ||Op Exentas sin derecho a deduccion
         #2#37 = #2#37 + tot_bas;
     |FINSI;

     |SI #7#2 = 10;      ||Entrega bienes inmuebles
         #2#40 = #2#40 + tot_bas;
     |FINSI;

     |SI #7#2 = 11;      ||Ventas a distancia no sujetas
         #2#53 = #2#53 + tot_bas;
     |FINSI;

     |SI #7#2 = 12;      ||Entrega bienes objetos de otros estados miembros
         #2#56 = #2#56 + tot_bas;
     |FINSI;

     |SI #7#2 = 13;      ||Entregas Interiores de Bienes
         #2#57 = #2#57 + tot_bas;
     |FINSI;

     |SI #7#2 = 14;      ||Entrega bienes de inversion
          #2#41 = #2#41 + tot_bas;
     |FINSI;
|FPRC;


|PROCESO abre_303_rep;
  perio  = #0#2; || periodo (1-12)
  activi = #0#0; || tipo (T/M/A)
  any    = #30#26;  || any
  |SI perio ! 1;
       |HAZ lee_ant;        || carga compensar
  |SINO;
       |HAZ lee_any_a; || el del a¤o pasado
  |FINSI;
  #2#00 = #30#2;     || empresa
  #2#45 = #0#0;      || actividad
  #2#01 = #0#2;      || periodo
  #2#02 = #30#26;    || a¤o

  |LEE 001#2=;
  |SI FSalida = 0;
      |BORRA 020#2a;
  |FINSI;
  |DDEFECTO #2;
  #2#00 = #30#2;      || empresa
  #2#45 = #0#0;       || actividad
  #2#01 = #0#2;       || periodo
  #2#02 = #30#26;     || a¤o
  #2#06 = #1#1;
  #2#09 = #1#2;
  #2#12 = #1#3;
  #2#15 = #1#4;
  #2#18 = #1#5;
  #2#47 = #1#6;
  #2#60 = #8#99;
  |SI #2#45 = "T"; |Y #2#1 = 4;  #2#60 = #8#101; |FINSI;
  |SI #2#45 = "M"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
  |SI #2#45 = "D"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
|FPRC;

|PROCESO cierra_303_rep;
  |SI per_ant = -1;  |ACABA;  |FINSI;
  |HAZ totaliza_303;
  |SI nIVA5  = 1;  #2#6  = (#2#7  / #2#5)  * 100;   |FINSI;
  |SI nIVA8  = 1;  #2#9  = (#2#10 / #2#8)  * 100;   |FINSI;
  |SI nIVA11 = 1;  #2#12 = (#2#13 / #2#11) * 100;   |FINSI;
  |SI nIVA14 = 1;  #2#15 = (#2#16 / #2#14) * 100;   |FINSI;
  |SI nIVA17 = 1;  #2#18 = (#2#19 / #2#17) * 100;   |FINSI;
  |SI nIVA46 = 1;  #2#47 = (#2#48 / #2#46) * 100;   |FINSI;
  |GRABA 020#2n;
|FPRC;

|PROCESO reper1;
     |SI #4#44 < perio; |Y #4#28 = "S";
         |ACABA;
     |FINSI;

     |SI per_ant ! perio;
         |HAZ cierra_303_rep;
         |HAZ abre_303_rep;
         per_ant = perio;
     |FINSI;

     |PINTA 2045, #caivarep#0;
     |PINTA 2048, #caivarep#27;
     |PINTA 2051, #caivarep#2;

     #7#0 = #4#6;
     |LEE 001#7=;
     |SI FSalida = 0;
         |SI #7#2 = 1; |O #7#2 = 0;
             |HAZ iva_rep;
             |HAZ recargo;
         |SINO;
             |SI #7#2 = 14; |O #7#2 = 10;
                 |HAZ iva_rep;
                 |HAZ recargo;
             |FINSI;
             |HAZ acum_rep;
         |FINSI;
     |SINO;
         |HAZ iva_rep;
         |HAZ recargo;
     |FINSI;
|FPRC;

|DEFBUCLE reper;
     #4#1;
     44;
     0,  "  ",      0, peria;
     99, "zz", 999999, perio;
     e;
     NULL, NULL, NULL, NULL, NULL, reper1;
     #4#44, #4#0, #4#2, #4#27;    || ordena por periodo
|FIN;
|| ///////////////////////////////////////////////////////////

|PROCESO acum_sop;
     tot_iva = #5#14 + #5#15 + #5#16 + #5#56 + #5#57; || no suma recargo.
     tot_bas = 0;
     |SI #5#14 ! 0; tot_bas = tot_bas + #5#8;  |FINSI;
     |SI #5#15 ! 0; tot_bas = tot_bas + #5#9;  |FINSI;
     |SI #5#16 ! 0; tot_bas = tot_bas + #5#10; |FINSI;
     |SI #5#56 ! 0; tot_bas = tot_bas + #5#52; |FINSI;
     |SI #5#57 ! 0; tot_bas = tot_bas + #5#53; |FINSI;

     |SI #5#23 = "S";
          |SI #5#48 = "N";         ||Si no es de inversion
               |HAZ noinver;
          |SINO;         ||SI es de inversiones
               |HAZ inver;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO inver;
     |SI #7#1 = 5;
         #2#24 = #2#24 + tot_iva;
     |SINO;
         |SI #7#1 = 6;       ||Op. Interiores Inversiones
             #2#63 = #2#63 + tot_bas;
             #2#43 = #2#43 + tot_iva;
             nCampo1 = 63;
             nCampo2 = 43;
         |SINO;
             |SI #7#1 = 7;  ||Importaciones Inversiones
                 #2#65 = #2#65 + tot_bas;
                 #2#44 = #2#44 + tot_iva;
                 nCampo1 = 65;
                 nCampo2 = 44;
             |SINO;
                 |SI #7#1 = 8; || Entregas Intracomunitarias
                     #2#54 = #2#54 - tot_bas;
                     #2#35 = #2#35 - tot_bas;
                 |SINO;
                     |SI #7#1 = 3;
                         #2#67 = #2#67 + tot_bas;
                         #2#58 = #2#58 + tot_iva;
                         nCampo1 = 67;
                         nCampo2 = 58;
                         |SI #7#2 = 2;
                             #2#49 = #2#49 + tot_bas;          ||base intracomunitario
                             #2#50 = #2#50 + tot_iva;
                         |FINSI;
                     |SINO;
                         #2#24 = #2#24 + tot_iva;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO noinver;
     |SI #7#1 = 1;       ||Operaciones Corrientes
         #2#62 = #2#62 + tot_bas;
         #2#21 = #2#21 + tot_iva;
         nCampo1 = 62;
         nCampo2 = 21;
     |SINO;
         |SI #7#1 = 2;  ||Importaciones
             #2#64 = #2#64 + tot_bas;
             #2#22 = #2#22 + tot_iva;
             nCampo1 = 64;
             nCampo2 = 22;
         |SINO;
             |SI #7#1 = 3;  ||Adj. Intracomunitaria
                 #2#66 = #2#66 + tot_bas;
                 #2#51 = #2#51 + tot_iva;
                 nCampo1 = 66;
                 nCampo2 = 51;
                 |SI #7#2 = 2;
                     #2#49 = #2#49 + tot_bas;          ||base intracomunitario
                     #2#50 = #2#50 + tot_iva;
                 |FINSI;
             |SINO;
                 |SI #7#1 = 4;  ||Regimen AGp
                     #2#23 = #2#23 + tot_iva;
                 |SINO;
                     |SI #7#1 = 8;  ||Entrega intracom
                         #2#54 = #2#54 - tot_bas;
                         #2#35 = #2#35 - tot_bas;
                     |SINO;
                         #2#62 = #2#62 + tot_bas;
                         #2#21 = #2#21 + tot_iva;
                         nCampo1 = 62;
                         nCampo2 = 21;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO abre_303_sop;
  perio  = #0#2;
  activi = #0#0;
  any    = #30#26;
  |SI perio ! 1;
      |HAZ lee_ant;        || carga compensar
  |SINO;
       |HAZ lee_any_a;     || el del a¤o pasado
  |FINSI;
  |DDEFECTO #2;
  #2#00 = #30#2;        || empresa
  #2#45 = #0#0;         || actividad
  #2#01 = #0#2;         || periodo
  #2#02 = #30#26;       || a¤o
  |LEE 101#2=;
  FEstado = FSalida;
  #2#00 = #30#2;        || empresa
  #2#45 = #0#0;         || actividad
  #2#01 = #0#2;         || periodo
  #2#02 = #30#26;       || a¤o
  |SI FSalida ! 0;
      #2#06 = #1#1;
      #2#09 = #1#2;
      #2#12 = #1#3;
      #2#15 = #1#4;
      #2#18 = #1#5;
      #2#47 = #1#6;
      #2#60 = #8#99;
      |SI #2#45 = "T"; |Y #2#1 = 4;  #2#60 = #8#101; |FINSI;
      |SI #2#45 = "M"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
      |SI #2#45 = "D"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
  |FINSI;
|FPRC;

|PROCESO cierra_303_sop;
  |SI #0#9 = "N"; #2#60 = 100; |FINSI;
  |SI per_ant = -1;
     |HAZ abre_303_sop;
  |FINSI;
  #2#21 = #2#21 % #2#60;
  #2#43 = #2#43 % #2#60;
  #2#22 = #2#22 % #2#60;
  #2#44 = #2#44 % #2#60;
  #2#51 = #2#51 % #2#60;
  #2#58 = #2#58 % #2#60;
  #2#23 = #2#23 % #2#60;
  |HAZ totaliza_303;
  |SI #2#60 ! 100;
       nSwOp = 1;
       nActividad = 1;
       nPorce1 = 100;
       nPorce2 = #2#60;
       |BUCLE eosma100B;
   |FINSI;
  |SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
  |SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
  |LIBERA #2;

|FPRC;

|PROCESO sopor1;

 |SI #5#44 < perio; |Y #5#28 = "S";
     |ACABA;
 |FINSI;
 |SI per_ant ! perio;
    |HAZ cierra_303_sop;
    |HAZ abre_303_sop;
    per_ant = perio;
 |FINSI;

     |PINTA 2045, #caivasop#0;
     |PINTA 2048, #caivasop#27;
     |PINTA 2051, #caivasop#2;

 nCampo1 = 0;
 nCampo2 = 0;
 #7#0 = #5#6;
 |LEE 001#7=;
 |SI FSalida = 0;
     |SI #7#1 ! 9;
         |HAZ acum_sop;
     |FINSI;
 |SINO;
     |HAZ iva_sop;
 |FINSI;

  nPorce1 = 100; nPorce2 = 100;
  |SI nCampo1 ! 0; |HAZ GuardaBases; |FINSI;

|FPRC;

|DEFBUCLE sopor;
 #5#1;
 44;
  0, "  ",      1, peria;
 99, "zz", 999999, perio;
 e;
 NULL, NULL, NULL, NULL, NULL, sopor1;
 #5#44, #5#0, #5#2, #5#27;    || ordena por periodo
|FIN;

/*
 ************************************************************************
 PROCESOS DE COMPENSACIONES CON MODELOS 303 ANTERIORES
 ************************************************************************

|PROCESO Descarga303;
     #99#5  = #99#5  - #2#5;    #99#7  = #99#7  - #2#7;
     #99#8  = #99#8  - #2#8;    #99#10 = #99#10 - #2#10;
     #99#11 = #99#11 - #2#11;   #99#13 = #99#13 - #2#13;
     #99#14 = #99#14 - #2#14;   #99#16 = #99#16 - #2#16;
     #99#17 = #99#17 - #2#17;   #99#19 = #99#19 - #2#19;
     #99#21 = #99#21 - #2#21;
     #99#22 = #99#22 - #2#22;
     #99#23 = #99#23 - #2#23;
     #99#24 = #99#24 - #2#24;
     #99#34 = #99#34 - #2#34;
     #99#35 = #99#35 - #2#35;
     #99#36 = #99#36 - #2#36;
     #99#37 = #99#37 - #2#37;
     #99#38 = #99#38 - #2#38;
     #99#39 = #99#39 - #2#39;
     #99#40 = #99#40 - #2#40;
     #99#41 = #99#41 - #2#41;
     #99#42 = #99#42 - #2#42;
     #99#43 = #99#43 - #2#43;
     #99#44 = #99#44 - #2#44;
     #99#46 = #99#46 - #2#46;
     #99#48 = #99#48 - #2#48;
     #99#49 = #99#49 - #2#49;
     #99#50 = #99#50 - #2#50;
     #99#51 = #99#51 - #2#51;
     #99#52 = #99#52 - #2#52;
     #99#53 = #99#53 - #2#53;
     #99#56 = #99#56 - #2#56;
     #99#57 = #99#57 - #2#57;
     #99#58 = #99#58 - #2#58;
     #99#59 = #99#59 - #2#59;
|FPRC;

|DEFBUCLE caman303;
     #2#1;
     ;
     activi,         1, any;
     activi, nHPeriodo, any;
     ;
     NULL, Descarga303;
|FIN;
*/

|PROCESO totales;
     #caman303#29 = compens;
     compens = 0;

    #caman303#20  = #caman303#7  + #caman303#10  + #caman303#13  + #caman303#16;
    #caman303#20  = #caman303#20 + #caman303#19  + #caman303#48  + #caman303#50;
    #caman303#20  = #caman303#20 + #caman303#104 + #caman303#106 + #caman303#108;
    #caman303#25  = #caman303#21 + #caman303#43  + #caman303#22 + #caman303#44 + #caman303#51 + #caman303#58;
    #caman303#25  = #caman303#25 + #caman303#23  + #caman303#24 + #caman303#61 + #caman303#110;
    #caman303#26  = #caman303#20 - #caman303#25;
    #caman303#28  = #caman303#26 % #caman303#27;
    #caman303#115 = #caman303#28 - #caman303#29 - #caman303#30;
    #caman303#117 = #caman303#115 - #caman303#116;

    #caman303#33 = 0;
    #caman303#32 = 0;
    #caman303#31 = 0;
    |SI #caman303#117 > 0;
        #caman303#33 = #caman303#117;
        #caman303#31 = 0;
        #caman303#32 = 0;
    |SINO;
        #caman303#33 = 0;
        #caman303#32 = -#caman303#117;
        #caman303#31 = 0;

        |SI #caportad#71 = "D";
             |SI #caman303#45 = "T"; |Y #caman303#1 = 4;
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;

             |SI #caman303#45 = "M"; |Y #caman303#1 = 12;
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;

             |SI #caman303#45 = "D";
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;

             |SI #caman303#45 = "A";
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO totaliza_303;
   |HAZ totales;
|FPRC;

|PROCESO Haztot;
|FPRC;

|| ////////////////////////////////////////////////////////////
|PROCESO lee_ant;
     compens = 0;
     perio = perio - 1;
     #2#45 = activi;
     #2#1 = perio;
     #2#2 = any;
     |LEE 001#2=;
     |SI FSalida = 0;
          compens = #2#32;
     |FINSI;
     perio = perio + 1;
|FPRC;

|PROCESO lee_any_a;
     compens = 0;
     sw_exi = 0;
     || lee el a¤o anterior, para ver si existe
     |ABRE #30;
     a_emp = #30#2;
     ac_pe = #30#3;
     a_per = ac_pe - 1;
     |SI a_per < 0; a_per = 9; |FINSI;
     #30#3 = a_per;
     |LEE 011#30=;
     |SI FSalida ! 0;
         sw_exi = 1;
     |FINSI;
     #30#2 = a_emp;
     #30#3 = ac_pe;
     |LEE 011#30=;
     |CIERRA #30;
     |SI sw_exi = 1; |ACABA; |FINSI;

     |SUB_EJECUTA "caany303";
|FPRC;

|PROCESO CalTipoyPer;
     aTipo = #2#45;
     |SI aTipo = "F";  aTipo = "T";  |FINSI;
     |SI aTipo = "D";  aTipo = "M";  |FINSI;

     nPer = 7;  |SI aTipo = "T"; nPer = 3; |FINSI;
     nSubeIVA  = 0;
     |SI enEjercicio = 2010; |Y #2#1 ] nPer;  nSubeIVA = 1;  |FINSI;
     |SI enEjercicio ] 2011;                  nSubeIVA = 1;  |FINSI;

     nPer = 9;  |SI aTipo = "T"; nPer = 3; |FINSI;
     |SI enEjercicio = 2012; |Y #2#1 ] nPer;  nSubeIVA = 2;  |FINSI;
     |SI enEjercicio ] 2013;                  nSubeIVA = 2;  |FINSI;
|FPRC;

|PROCESO LeeControl;
     |HAZ CalTipoyPer;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida ! 0;
         |MENAV "    No esta definido el control del IVA ...";
         |ERROR;
         |CIERRA #1;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |SI nSubeIVA = 2;
         |SI #1#1 = 7;  |O #1#1 = 8;  #1#1 = 10; |FINSI;
         |SI #1#1 = 16; |O #1#1 = 18; #1#1 = 21; |FINSI;
         |SI #1#2 = 7;  |O #1#2 = 8;  #1#2 = 10; |FINSI;
         |SI #1#2 = 16; |O #1#2 = 18; #1#2 = 21; |FINSI;
         |SI #1#3 = 7;  |O #1#3 = 8;  #1#3 = 10; |FINSI;
         |SI #1#3 = 16; |O #1#3 = 18; #1#3 = 21; |FINSI;

         |SI #1#4 = 1;  #1#4 = 1.40; |FINSI;
         |SI #1#4 = 4;  #1#4 = 5.20; |FINSI;
         |SI #1#5 = 1;  #1#5 = 1.40; |FINSI;
         |SI #1#5 = 4;  #1#5 = 5.20; |FINSI;
         |SI #1#6 = 1;  #1#6 = 1.40; |FINSI;
         |SI #1#6 = 4;  #1#6 = 5.20; |FINSI;
     |SINO;
         |SI #1#4 = 1.40;  #1#4 = 1; |FINSI;
         |SI #1#4 = 5.20;  #1#4 = 4; |FINSI;
         |SI #1#5 = 1.40;  #1#5 = 1; |FINSI;
         |SI #1#5 = 5.20;  #1#5 = 4; |FINSI;
         |SI #1#6 = 1.40;  #1#6 = 1; |FINSI;
         |SI #1#6 = 5.20;  #1#6 = 4; |FINSI;

         |SI nSubeIVA = 1;
             |SI #1#1 = 7;  |O #1#1 = 10; #1#1 = 8;  |FINSI;
             |SI #1#1 = 16; |O #1#1 = 21; #1#1 = 18; |FINSI;
             |SI #1#2 = 7;  |O #1#2 = 10; #1#2 = 8;  |FINSI;
             |SI #1#2 = 16; |O #1#2 = 21; #1#2 = 18; |FINSI;
             |SI #1#3 = 7;  |O #1#3 = 10; #1#3 = 8;  |FINSI;
             |SI #1#3 = 16; |O #1#3 = 21; #1#3 = 18; |FINSI;
         |SINO;
             |SI #1#1 = 8;  |O #1#1 = 10; #1#1 = 7;  |FINSI;
             |SI #1#1 = 18; |O #1#1 = 21; #1#1 = 16; |FINSI;
             |SI #1#2 = 8;  |O #1#2 = 10; #1#2 = 7;  |FINSI;
             |SI #1#2 = 18; |O #1#2 = 21; #1#2 = 16; |FINSI;
             |SI #1#3 = 8;  |O #1#3 = 10; #1#3 = 7;  |FINSI;
             |SI #1#3 = 18; |O #1#3 = 21; #1#3 = 16; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO empresa;
     |HAZ LeeControl;
     #2#6  = #1#1;
     #2#9  = #1#2;
     #2#12 = #1#3;
     #2#15 = #1#4;
     #2#18 = #1#5;
     #2#47 = #1#6;
|FPRC;
|| //////////////////////////////////////////////////////////////////

|PROCESO reo303; |TIPO 3;

     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     informe = "camod303";
||     informe = "capre303";

     |INFOR informe;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DFICE dirfich0;

     alfa1 =  "b" + Usuario;
     traba2 = alfa1;  traba1 = "caman303";  |HAZ copiando;
     |NOME_DAT #2 traba2;

     alfa1 =  "x" + Usuario;
     traba2 = alfa1;  traba1 = "eosma100";  |HAZ copiando;
     |NOME_DAT #100 traba2;

     activi    = #0#0;
     perio     = #0#2;
     peria     = #0#2;
     |SI #0#7 = "S"; |O #0#8 = "S";
         peria = 1;
     |FINSI;
     nHPeriodo = #0#2 - 1;
     any       = #30#26;

     nActividad = 1;
     |ABRE #2;
     #2#00 = #30#2;     || empresa
     #2#45 = #0#0;      ||
     #2#01 = #0#2;      || periodo
     #2#02 = any;
     |LEE 101#2=;
     |SI FSalida = 0;
         |BORRA 020#2a;
         nSwOp      = 0;
         |BUCLE eosma100B;
     |FINSI;
     |LIBERA #2;

      |SI swyacal = 0;
          |SI #0#6 = "S";
               swyacal = 1;
              |BUCLE per_reper;    || revisa los periodos
              |BUCLE per_sopor;
          |FINSI;
      |FINSI;

      |DDEFECTO #2;
      #2#45 = activi;
      #2#1  = perio;
      #2#2  = any;
      #2#0  = #30#2;
      #2#27 = #8#72;

      |HAZ empresa;             || vuelve a cargar porcentajes
      nIVA5 = 0;
      nIVA8 = 0;
      nIVA11 = 0;

      |ATRI P;
      |MENSA "    ***** CALCULANDO *****";
      |ATRI 0;

      |ABRE #7;
      per_ant = -1;
      |ABRE #100;
      |BUCLE reper;
      |HAZ cierra_303_rep;
      |CIERRA #100;

      per_ant = -1;
      |BUCLE sopor;
      #2#29 = compens;
      |HAZ cierra_303_sop;
      |CIERRA #2;
      |CIERRA #7;

      |HAZ Haztot;

      |HAZ Imprime303;

      |FININF;
      |FINIMP;

      |DELINDEX #2;
      |DELINDEX #100;
|FPRC;

|PROCESO MiroCiva;
    |DDEFECTO #100;
    #100#0 = "303";
    #100#1 = #2#0;
    #100#2 = nActividad;
    #100#3 = #2#1;
    #100#4 = #2#2;
    #100#5 = nCampo1;
    |LEE 101#100=;

    |PARA nCampo1 = 6; |SI nCampo1 [ 24; |HACIENDO nCampo1 = nCampo1 + 3;

           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           |SI #100nCampo1 ! 0; |O #100nCampo3 ! 0;
               enBaseI  = #100nCampo1;
               enPorceI = #100nCampo2;
               enCuotaI = #100nCampo3;
               enSwLinea = 6; |PRINT;
               aTexr = "";
           |FINSI;

     |SIGUE;
|FPRC;

|PROCESO Imprime303;
    |ABRE #100;

    aText = "I.V.A. DEVENGADO";
    aTexr = "----------------";
    enSwLinea = 0; |PRINT;
    enSwLinea = 1; |PRINT;

    aDescr = "Regimen General 1 ........";
    enBase = #2#5; enPorce = #2#6; enCuota = #2#7;
    enSwLinea = 2; |PRINT;
    |SI nIVA5  = 1;
        aTexr = "Desglose Tipos IVA";
        nCampo1 = 5; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Regimen General 2 ........";
    enBase = #2#8; enPorce = #2#9; enCuota = #2#10;
    enSwLinea = 2; |PRINT;
    |SI nIVA8  = 1;
        aTexr = "Desglose Tipos IVA";
        nCampo1 = 8; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Regimen General 3 ........";
    enBase = #2#11; enPorce = #2#12; enCuota = #2#13;
    enSwLinea = 2; |PRINT;
    |SI nIVA11  = 1;
        aTexr = "Desglose Tipos IVA";
        nCampo1 = 11; |HAZ MiroCiva;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aDescr = "Recargo Equivalencia 1 ...";
    enBase = #2#14; enPorce = #2#15; enCuota = #2#16;
    enSwLinea = 2; |PRINT;
    |SI nIVA14  = 1;
        aTexr = "Desglose Tipos Recargo";
        nCampo1 = 14; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Recargo Equivalencia 2 ...";
    enBase = #2#17; enPorce = #2#18; enCuota = #2#19;
    enSwLinea = 2; |PRINT;
    |SI nIVA17  = 1;
        aTexr = "Desglose Tipos Recargo";
        nCampo1 = 17; |HAZ MiroCiva;
    |FINSI;

    aDescr = "Recargo Equivalencia 3 ...";
    enBase = #2#46; enPorce = #2#47; enCuota = #2#48;
    enSwLinea = 2; |PRINT;
    |SI nIVA46  = 1;
        aTexr = "Desglose Tipos Recargo";
        nCampo1 = 46; |HAZ MiroCiva;
    |FINSI;

    enSwLinea = 9; |PRINT;

    aDescr  = "Adq.Intracomunitarias ....";
    enBase  = #2#49;
    enPorce = 0
    enCuota = #2#50;
    enSwLinea = 2; |PRINT;
    |SI #2#78 ! 0; |O #2#80 ! 0;
        enBaseI = #2#78; enPorceI = #2#79; enCuotaI = #2#80;
        enSwLinea = 6; |PRINT;
    |FINSI;
    |SI #2#81 ! 0; |O #2#83 ! 0;
        enBaseI = #2#81; enPorceI = #2#82; enCuotaI = #2#83;
        enSwLinea = 6; |PRINT;
    |FINSI;
    |SI #2#84 ! 0; |O #2#86 ! 0;
        enBaseI = #2#84; enPorceI = #2#85; enCuotaI = #2#86;
        enSwLinea = 6; |PRINT;
    |FINSI;
    |SI #2#87 ! 0; |O #2#89 ! 0;
        enBaseI = #2#87; enPorceI = #2#88; enCuotaI = #2#89;
        enSwLinea = 6; |PRINT;
    |FINSI;

    enSwLinea = 3; |PRINT;
    enSwLinea = 9; |PRINT;

|| IVA SOPORTADO
    aText = "I.V.A. DEDUCIBLE";
    aTexr = "----------------";
    enSwLinea = 0; |PRINT;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Op.interiores corrientes ..............";
    enBase = #2#62; enCuota = #2#21; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nCampo1 = 62; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Op.interiores bienes inversion ........";
    enBase = #2#63; enCuota = #2#43; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nCampo1 = 63; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Importaciones bienes corrientes .......";
    enBase = #2#64; enCuota = #2#22; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nCampo1 = 64; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Importaciones bienes inversion ........";
    enBase = #2#65; enCuota = #2#44; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nCampo1 = 65; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Adq.intracomunitarias bienes corrientes";
    enBase = #2#66; enCuota = #2#51; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nCampo1 = 66; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Adq.intracomunitarias bienes inversion ";
    enBase = #2#67; enCuota = #2#58; enSwLinea = 4; |PRINT;
    |SI enBase ! 0; |O enCuota ! 0;  nCampo1 = 67; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Compensaciones Regimen Especial A.G.P. ................";
    enBase = #2#90; enCuota = #2#23; enSwLinea = 4; |PRINT;
    |SI enBase! 0; |O enCuota ! 0;  nCampo1 = 90; |HAZ MiroCiva;  |FINSI;

    aTexr = "Desglose Tipos IVA";
    aDescr = "Regularizacion inversiones ............................";
    enCuota = #2#24; enSwLinea = 5; |PRINT;

    |PIEINF;

    |CIERRA #100;
|FPRC;
