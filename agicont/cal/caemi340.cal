|FICHEROS;
     caemi340 #0;
     caman303 #1;
     caportad #2;

     dsmo3401 #341;
     dsmo3402 #342;
     dsmo3403 #343;
     dsmo3404 #344;
     dsmo3405 #345;

     dsmow584 #584;
     dsmow585 #585;
     dsmow586 #586;
     dsmow587 #587;
     dsmow588 #588;

     dsmow602 #602,MANTE;
|FIN;

|VARIABLES;
     aNombre      = "";
     aIPRemoto    = "";
     aCinta       = "";
     aImpre       = "";
     aSalida      = "";
     aPatrones    = "";
     aCodElec     = "";
     aAlfa        = "";
     aAlfa1       = "";
     aVersion     = "";
     aAbre        = "";
     aOrigen      = "";
     aDestino     = "";
     aFichero     = "";
     aError       = "";
     aEjecutable  = "";

     nReg         = 0;
     nConta       = 0;
     nHandle      = 0;
     nHandleEjec  = 0;
     nError       = 0;
     nHay         = 0;
     nHandle1     = 0;
     nHandle2     = 0;
     nHandleError = 0;
     nNume        = 0;
     nCampo       = 0;
     nAnyo2D         = 0;
     perialf             = "";

     &eaAlfa         = "";
     &eaUnidadBasico = "";
     &eaPathLanza    = "";
     &eaPathEjecu    = "";
     &eaPathEmision  = "";
     &eaPathInternet = "";
     &eaFOrigen      = "";
     &eaFDestino     = "";
     &eaSigno        = 0;
     &enError        = 0;
     &enNume         = 0;

     &eaUnidad           = "";
     &eaModelos          = "";
     &enAnyo             = 0;
     &eaEjer             = "";
     &eaPeriodo          = "";
     &eaFicheroPlano     = "";
     &eaOpcion           = "";
     &enErrorPortal      = 0;
     &eaFicheroImpre     = "";
     &eaFicheroSalid     = "";
     &eaFicheroError     = "";
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
|FIN;

|INCLUYE acceso_i;

|PROCESO Tipo7C0Emi; |TIPO 7;
     |ABRE #1;
     #1#45 = "D";
     #1#1  = 0;
     #1#2  = 0;
     |LEE 001#1];
     |SI FSalida = 0;  |Y  #1#45 = "D";
         |C_M #0#0, 1, "S";
         #0#0 = "D"; |PINTA #0#0;
         |CIERRA #1;
         |ACABA;
     |FINSI;

     #1#45 = "M";
     #1#1  = 0;
     #1#2  = 0;
     |LEE 001#1];
     |SI FSalida = 0;  |Y  #1#45 = "M";
         |C_M #0#0, 1, "S";
         #0#0 = "M"; |PINTA #0#0;
         |CIERRA #1;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |C_M #0#0, 1, "N";
     #0#0 = "T"; |PINTA #0#0;
|FPRC;

|PROCESO Tipo7C1Emi; |TIPO 7;
     #0#1   = 2000 + #30#26;     |PINTA #0#1;
|FPRC;

||__________________________________________________________________________
||__________________________________________________________________________

|PROCESO TraeTgz340;
     nError = 0;

     |SI #0#1 [ 2009;
         aAlfa       = eaPathEjecu + "p3400918.exe";
         aEjecutable = "p3400918";
     |FINSI;

     |SI #0#1 = 2010;
         aAlfa       = eaPathEjecu + "p3401020.txt";
         aEjecutable = "p3401020";
     |FINSI;

     |SI #0#1 = 2011;
         aAlfa       = eaPathEjecu + "p3401110.txt";
         aEjecutable = "p3401110";
     |FINSI;

     |SI #0#1 ] 2012;
         aAlfa       = eaPathEjecu + "p3401240.txt";
         aEjecutable = "p3401240";
     |FINSI;

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida ] 0;  |ACABA;  |FINSI;

     aAlfa    = #0#1;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |DBASE aPatrones;  |QBT aPatrones;
     aPatrones = aPatrones + "hacienda/";

     eaFOrigen  = aPatrones + "z" + aAlfa + aVersion + "340.tgz";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable z" + aAlfa + aVersion + "340.tgz pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         nError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathEjecu + "z" + aAlfa + aVersion + "340.tgz";

     |HAZ CopiaFicheroIP;

     |RDESCOMPRIME eaFDestino;

     eaFDestino = (eaFDestino - ".tgz") + ".tar";
     |RDETAR eaFDestino, eaPathEjecu;

     |RFBORRA eaFDestino;
|FPRC;

|PROCESO LanzaPrograma;
     |HAZ TraeTgz340;
     |SI nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     aAbre = eaPathEjecu + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathEjecu + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "echo off" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET CINTA=" + eaPathLanza + aCinta + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET IMPRE=" + eaPathLanza + aImpre + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET SALIDA=" + eaPathLanza + aSalida + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait " + aEjecutable +  &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO Registro341;
     |DDEFECTO #584;

     #584#1  = "1";
     #584#2  = "340";
     #584#3  = #341#1;

     #584#4   = #2#13;

     eaAlfa   = #2#2;  |HAZ QuitaRaros;
     #584#5   = eaAlfa;

     #584#6  = "T";

     eaAlfa   = #2#14;  |HAZ QuitaRarosTfno;
     #584#7   = eaAlfa;

     eaAlfa   = #2#89;  |HAZ QuitaRaros;
     #584#8   = eaAlfa;

     #584#12 = "0000000000000";

     #584#10 = "";
     #584#11 = "";

     |SI #0#0 = "T";
         |SI #341#2 = 3;   #584#13 = "1T";  nConta = 1;  |FINSI;
         |SI #341#2 = 6;   #584#13 = "2T";  nConta = 2;  |FINSI;
         |SI #341#2 = 9;   #584#13 = "3T";  nConta = 3;  |FINSI;
         |SI #341#2 = 12;  #584#13 = "4T";  nConta = 4;  |FINSI;
     |SINO;
         #584#13 = ("00" + #341#2) % -102;  nConta = #341#2;
     |FINSI;

     #584#9  = "340" + #584#3 + (("00" + #341#2) % -102) + (("0000" + nConta) % -104);

     nNume   = #341#6;
     #584#14 = ("000000000" + nNume) % -109;

     enNume  = #341#7;  |HAZ Conver17Signo;
     #584#15 = eaSigno + eaAlfa;

     enNume  = #341#8;  |HAZ Conver17Signo;
     #584#16 = eaSigno + eaAlfa;

     enNume  = #341#9;  |HAZ Conver17Signo;
     #584#17 = eaSigno + eaAlfa;

     #584#20 = aCodElec;

     #584#22 = &13 + &10;

     aAlfa = "";

     |PARA nCampo = 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #584nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Registro342;

     nReg = nReg + 1;

     |DDEFECTO #dsmow585;

     #dsmow585#1  = "2";
     #dsmow585#2  = "340";
     #dsmow585#3  = #dsmo3401#1;

     #dsmow585#4   = #caportad#13;

     |SI #dsmo3402#8 = "N";
         #dsmow585#5   = #dsmo3402#7;
     |SINO;
         #dsmow585#6   = #dsmo3402#7;
     |FINSI;

     eaAlfa  = #dsmo3402#9;  |HAZ QuitaRaros;  #dsmow585#7  = eaAlfa;

     #dsmow585#8  = #dsmo3402#10;
     #dsmow585#9  = #dsmo3402#11;
     eaAlfa  = #dsmo3402#12;  |HAZ QuitaRaros;  #dsmow585#10  = eaAlfa;

                              #dsmow585#11 = "E";
     |SI #dsmo3402#29 = "S";  #dsmow585#11 = "F";  |FINSI;

     #dsmow585#12 = #dsmo3402#13;

     |SI #dsmo3402#14 ! "01.01.0000";
         #dsmow585#13 = (#dsmo3402#14 % 704) + (#dsmo3402#14 % 402) + (#dsmo3402#14 % 102);
     |FINSI;

     |SI #dsmo3402#15 ! "01.01.0000";
         #dsmow585#14 = (#dsmo3402#15 % 704) + (#dsmo3402#15 % 402) + (#dsmo3402#15 % 102);
     |FINSI;

     nNume   = #dsmo3402#16 * 100;
     #dsmow585#15 = ("00000" + nNume) % -105;

     enNume  = #dsmo3402#17;  |HAZ Conver13Signo;
     #dsmow585#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3402#18;  |HAZ Conver13Signo;
     #dsmow585#17 = eaSigno + eaAlfa;

     enNume  = #dsmo3402#19;  |HAZ Conver13Signo;
     #dsmow585#18 = eaSigno + eaAlfa;

     enNume  = #dsmo3402#20;  |HAZ Conver13Signo;
     #dsmow585#19 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3402#21;  |HAZ QuitaRaros;  #dsmow585#20 = eaAlfa;

     #dsmow585#21 = nReg;

     eaAlfa  = ("00000000" + #dsmo3402#22) % -108;   #dsmow585#22 = eaAlfa;
     eaAlfa  = ("00" + #dsmo3402#23) % -102;         #dsmow585#23 = eaAlfa;

     #dsmow585#24 = #dsmo3402#24;
     #dsmow585#25 = #dsmo3402#25;
     #dsmow585#26 = #dsmo3402#26;

     nNume   = #dsmo3402#27 * 100;
     #dsmow585#27 = ("00000" + nNume) % -105;

     enNume  = #dsmo3402#28;  |HAZ Conver13Signo;
     #dsmow585#28 = eaSigno + eaAlfa;

     aAlfa = #dsmow585#20;  |QBF aAlfa;
     |SI aAlfa = "";
         |SI #dsmo3402#32 ! 0;
             #dsmow585#20 = "IMPORTE PERCIBIDO METALICO";
         |FINSI;

         |SI #dsmo3402#34 ! 0;
             #dsmow585#20 = "IMPORTE PERCIBIDO TRANSMISION INMUEBLE";
         |FINSI;
     |FINSI;

     #dsmow585#29 = #dsmo3402#30;
     |SI #dsmow585#29 = " ";  #dsmow585#29 = "0";  |FINSI;

     #dsmow585#30 = #dsmo3402#31;

     enNume  = #dsmo3402#32;  |HAZ Conver15;  #dsmow585#31 = eaAlfa;

     #dsmow585#32 = ("0000" + #dsmo3402#33) % -104;

     enNume  = #dsmo3402#34;  |HAZ Conver15;  #dsmow585#33 = eaAlfa;

     #dsmow585#34 = "0" * 8;
     #dsmow585#35 = "0" * 13;

     |SI #dsmo3402#36 ! 0;
         |SI #dsmo3402#35 ! "01.01.0000";
             #dsmow585#34 = (#dsmo3402#35 % 704) + (#dsmo3402#35 % 402) + (#dsmo3402#35 % 102);
         |FINSI;

         enNume  = #dsmo3402#36;  |HAZ Conver13;
         #dsmow585#35 = eaAlfa;
         #dsmow585#36 = #dsmo3402#37;
         #dsmow585#37 = #dsmo3402#38;
     |FINSI;

     #dsmow585#38 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow585#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3402;
     #342#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro342;
|FIN;

|PROCESO Registro343;
     nReg = nReg + 1;

     |DDEFECTO #dsmow586;

     #dsmow586#1  = "2";
     #dsmow586#2  = "340";
     #dsmow586#3  = #dsmo3401#1;
     #dsmow586#4  = #caportad#13;

     |SI #dsmo3403#8 = "N";
         #dsmow586#5   = #dsmo3403#7;
     |SINO;
         #dsmow586#6   = #dsmo3403#7;
     |FINSI;

     eaAlfa  = #dsmo3403#9;  |HAZ QuitaRaros;  #dsmow586#7  = eaAlfa;

     #dsmow586#8  = #dsmo3403#10;
     #dsmow586#9  = #dsmo3403#11;
     eaAlfa  = #dsmo3403#12;  |HAZ QuitaRaros;  #dsmow586#10  = eaAlfa;

                         #dsmow586#11 = "R";
     |SI #dsmo3403#27 = "S";  #dsmow586#11 = "S";  |FINSI;

     #dsmow586#12 = #dsmo3403#13;

     |SI #dsmo3403#14 ! "01.01.0000";
         #dsmow586#13 = (#dsmo3403#14 % 704) + (#dsmo3403#14 % 402) + (#dsmo3403#14 % 102);
     |FINSI;

     |SI #dsmo3403#15 ! "01.01.0000";
         #dsmow586#14 = (#dsmo3403#15 % 704) + (#dsmo3403#15 % 402) + (#dsmo3403#15 % 102);
     |FINSI;

     nNume   = #dsmo3403#16 * 100;
     #dsmow586#15 = ("00000" + nNume) % -105;

     enNume  = #dsmo3403#17;  |HAZ Conver13Signo;
     #dsmow586#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3403#18;  |HAZ Conver13Signo;
     #dsmow586#17 = eaSigno + eaAlfa;

     enNume  = #dsmo3403#19;  |HAZ Conver13Signo;
     #dsmow586#18 = eaSigno + eaAlfa;

     enNume  = #dsmo3403#20;  |HAZ Conver13Signo;
     #dsmow586#19 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3403#21;  |HAZ QuitaRaros;  #dsmow586#20 = eaAlfa;

     #dsmow586#21 = nReg;

     eaAlfa  = ("000000000000000000" + #dsmo3403#22) % -118;   #dsmow586#22 = eaAlfa;
     eaAlfa  = ("00" + #dsmo3403#23) % -102;                   #dsmow586#23 = eaAlfa;

     #dsmow586#24 = #dsmo3403#24;
     #dsmow586#25 = #dsmo3403#25;

     enNume  = #dsmo3403#26;  |HAZ Conver13Signo;
     #dsmow586#26 = eaSigno + eaAlfa;

     #dsmow586#27 = "0" * 8;
     #dsmow586#28 = "0" * 13;

     |SI #dsmo3403#29 ! 0;
         |SI #dsmo3403#28 ! "01.01.0000";
             #dsmow586#27 = (#dsmo3403#28 % 704) + (#dsmo3403#28 % 402) + (#dsmo3403#28 % 102);
         |FINSI;

         enNume  = #dsmo3403#29;  |HAZ Conver13;
         #dsmow586#28 = eaAlfa;
         #dsmow586#29 = #dsmo3403#30;
         #dsmow586#30 = #dsmo3403#31;
     |FINSI;

     #dsmow586#32 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow586#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3403;
     #343#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro343;
|FIN;

|PROCESO Registro344;
     nReg = nReg + 1;

     |DDEFECTO #587;

     #587#1  = "2";
     #587#2  = "340";
     #587#3  = #341#1;

     #587#4   = #2#13;

     |SI #344#8 = "N";
         #587#5   = #344#7;
     |SINO;
         #587#6   = #344#7;
     |FINSI;

     eaAlfa  = #344#9;  |HAZ QuitaRaros;  #587#7  = eaAlfa;

     #587#8  = #344#10;
     #587#9  = #344#11;
     eaAlfa  = #344#12;  |HAZ QuitaRaros;  #587#10  = eaAlfa;

                         #587#11 = "I";
     |SI #344#28 = "S";  #587#11 = "J";  |FINSI;

     #587#12 = #344#13;

     |SI #344#14 ! "01.01.0000";
         #587#13 = (#344#14 % 704) + (#344#14 % 402) + (#344#14 % 102);
     |FINSI;

     |SI #344#15 ! "01.01.0000";
         #587#14 = (#344#15 % 704) + (#344#15 % 402) + (#344#15 % 102);
     |FINSI;

     nNume   = #344#16 * 100;
     #587#15 = ("00000" + nNume) % -105;

     enNume  = #344#17;  |HAZ Conver13Signo;
     #587#16 = eaSigno + eaAlfa;

     enNume  = #344#18;  |HAZ Conver13Signo;
     #587#17 = eaSigno + eaAlfa;

     enNume  = #344#19;  |HAZ Conver13Signo;
     #587#18 = eaSigno + eaAlfa;

     enNume  = #344#20;  |HAZ Conver13Signo;
     #587#19 = eaSigno + eaAlfa;

     eaAlfa  = #344#21;  |HAZ QuitaRaros;  #587#20 = eaAlfa;

     #587#21 = nReg;

     nNume   = #344#22 ! 0;
     eaAlfa  = ("000" + nNume) % -103;     #587#22 = eaAlfa;

     enNume  = #344#23;  |HAZ Conver13Signo;
     #587#23 = eaSigno + eaAlfa;

     eaAlfa  = #344#24;  |HAZ QuitaRaros;  #587#24 = eaAlfa;

     enNume  = #344#25;  |HAZ Conver13Signo;
     #587#25 = eaSigno + eaAlfa;

     |SI #344#26 ! "01.01.0000";
         #587#26 = (#344#26 % 704) + (#344#26 % 402) + (#344#26 % 102);
     |FINSI;

     eaAlfa  = #344#27;  |HAZ QuitaRaros;  #587#27 = eaAlfa;

     #587#29 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #587nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3404;
     #344#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro344;
|FIN;

|PROCESO Registro345;
     nReg = nReg + 1;

     |DDEFECTO #588;

     #588#1  = "2";
     #588#2  = "340";
     #588#3  = #341#1;

     #588#4   = #2#13;

     |SI #345#8 = "N";
         #588#5   = #345#7;
     |SINO;
         #588#6   = #345#7;
     |FINSI;

     eaAlfa  = #345#9;  |HAZ QuitaRaros;  #588#7  = eaAlfa;

     #588#8  = #345#10;
     #588#9  = #345#11;
     eaAlfa  = #345#12;  |HAZ QuitaRaros;  #588#10  = eaAlfa;

     #588#11 = "U";

     #588#12 = " ";

     |SI #345#14 ! "01.01.0000";
         #588#13 = (#345#14 % 704) + (#345#14 % 402) + (#345#14 % 102);
     |FINSI;

     |SI #345#15 ! "01.01.0000";
         #588#14 = (#345#15 % 704) + (#345#15 % 402) + (#345#15 % 102);
     |FINSI;

     nNume   = #345#16 * 100;
     #588#15 = ("00000" + nNume) % -105;

     enNume  = #345#17;  |HAZ Conver13Signo;
     #588#16 = eaSigno + eaAlfa;

     enNume  = #345#18;  |HAZ Conver13Signo;
     #588#17 = eaSigno + eaAlfa;

     enNume  = #345#19;  |HAZ Conver13Signo;
     #588#18 = eaSigno + eaAlfa;

     enNume  = 0;        |HAZ Conver13Signo;
     #588#19 = eaSigno + eaAlfa;

     eaAlfa  = #345#20;  |HAZ QuitaRaros;  #588#20 = eaAlfa;

     #588#21 = nReg;
     #588#22 = #345#21;
     #588#23 = #345#22;
     #588#24 = #345#23;

     eaAlfa  = ("000" + #345#24) % -103;     #588#25 = eaAlfa;

     eaAlfa  = #345#25;  |HAZ QuitaRaros;  #588#26 = eaAlfa;
     eaAlfa  = #345#26;  |HAZ QuitaRaros;  #588#27 = eaAlfa;
     eaAlfa  = #345#27;  |HAZ QuitaRaros;  #588#28 = eaAlfa;
     eaAlfa  = #345#28;  |HAZ QuitaRaros;  #588#29 = eaAlfa;
     eaAlfa  = #345#29;  |HAZ QuitaRaros;  #588#30 = eaAlfa;

     #588#32 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #588nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3405;
     #345#1;
     ;
     #341#0, #341#1, #341#2, #341#3, #341#4, 01, 000001;
     #341#0, #341#1, #341#2, #341#3, #341#4, 99, 999999;
     ;
     NULL, Registro345
|FIN;

|PROCESO Baja602;
     #602#0 = 1;
     #602#1 = 0000;
     #602#2 = 00;
     #602#3 = 000;
|FPRC;

|PROCESO Alta602;
     #602#0 = 99999;
     #602#1 = 9999;
     #602#2 = 99;
     #602#3 = 9999;
|FPRC;

|PROCESO SacaResumen;
     aFichero = ("62" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #602 aFichero;
     |ABRE #602;  |CIERRA #602;  |DELINDEX #602;

     |ABRE #602;

     aFichero    = eaPathLanza + "res*.txt";  |QBT aFichero;

     |R_PDIR aFichero;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aAlfa = aFichero % -115;

            aAlfa1 = aAlfa % 705;
            #602#0 = aAlfa1;
            #602#1 = #0#1;
            #602#2 = #0#2;
            #602#3 = 340;
            #602#4 = #2#2;

            #602#5 = "CORRECTA";
            aError = eaPathLanza + ("err" + aAlfa % -112);
            |XABRE "C", aError, nHandleError;
            |SI FSalida ] 0;
            |PARA;  |SI FSalida ] 0;  |HACIENDO;
                 |XLEE nHandleError, 250, aAlfa;

                 |QBF aAlfa;
                 |SI aAlfa ! "";
                     #602#5 = "ERRONEA";
                     |SAL;
                 |FINSI;
            |SIGUE;
         |FINSI;
         |XCIERRA nHandleError;

         |GRABA 020#602n;
         |LIBERA #602;

         #2#0 = #602#0;
         #2#1 = #602#1 - 2000;
         |LEE 000#2=;
         |SI FSalida = 0;
             |SI #602#5 = "CORRECTA  ";
                 aOrigen  = eaPathLanza + "fic" + #602#3 + (("00000" + #602#0) % -105) + ".txt";
                 aDestino = eaPathInternet + "fic" + #602#3 + (("00000" + #602#0) % -105) + ".txt";
                 |RCOPIA_FICHERO aOrigen, aDestino;
             |FINSI;
         |FINSI;

         |R_SDIR aFichero;
     |SIGUE;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#602, -1, 4, 22, 1, Baja602, Alta602;
     |POPV;

     |CIERRA #602;
     |DELINDEX #602;

     aAlfa =  "      Los ficheros correctos estan: " + eaPathInternet + " de su PC";
     |MENAV aAlfa;
|FPRC;

|PROCESO Lanza2012;
     aAbre = eaPathEmision + "fic340" + (("00000" + #341#0) % -105) + ".txt";
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro341;

     nReg = 0;  |BUCLE dsmo3402;
     nReg = 0;  |BUCLE dsmo3403;
     nReg = 0;  |BUCLE dsmo3404;
     nReg = 0;  |BUCLE dsmo3405;

     |XCIERRA nHandle2;

     eaFOrigen  = eaPathEmision  + "fic340" + (("00000" + #341#0) % -105) + ".txt";
     eaFDestino = eaPathLanza    + "fic340" + (("00000" + #341#0) % -105) + ".txt";

     |HAZ CopiaFicheroIP;
     |FBORRA eaFOrigen;

     aCinta  =  "fic340" + (("00000" + #341#0) % -105) + ".txt";
     aImpre  =  "res340" + (("00000" + #341#0) % -105) + ".txt";
     aSalida =  "err340" + (("00000" + #341#0) % -105) + ".txt";

     |HAZ LanzaPrograma;

     |CIERRA #341;

     |HAZ SacaResumen;
|FPRC;

|PROCESO Lanza2013;
     |HAZ PreguntaPresentacion;
     |HAZ TraeTgzCobol;

     eaFicheroPlano = "340" + (("00000" + #2#0) % -105) + ".txt";
     eaFicheroImpre = "340" + (("00000" + #2#0) % -105) + ".imp";
     eaFicheroSalid = "340" + (("00000" + #2#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #2#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Registro341;

     nReg = 0;  |BUCLE dsmo3402;
     nReg = 0;  |BUCLE dsmo3403;
     nReg = 0;  |BUCLE dsmo3404;
     nReg = 0;  |BUCLE dsmo3405;

     |XCIERRA nHandle2;

     enEmpresa    = #341#0;
     eaNomEmpresa = #caportad#2;

     |HAZ PresentaPortal;

     |CIERRA #341;

     |HAZ SacaErrorPtl;

     |SI enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |HAZ LeeUnidad;

     eaOpcion    = "3";
     eaModelos   = "340";
     enAnyo      = #0#1;
     eaEjer      = #0#1;
     eaPeriodo   = ("00" + #0#2) % -102;
     perialf     = ("00" + #0#2) % -102;
     |SI #0#0 = "T";
         |SI #0#2 = 1;  perialf = "1T"; |FINSI;
         |SI #0#2 = 2;  perialf = "2T"; |FINSI;
         |SI #0#2 = 3;  perialf = "3T"; |FINSI;
         |SI #0#2 = 4;  perialf = "4T"; |FINSI;
     |FINSI;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |ABRE #1;
     #1#45 = #0#0;
     #1#1  = #0#2;
     #1#2  = #0#1 - 2000;
     |LEE 001#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     aCodElec = #1#77;  |QBF aCodElec;
     |SI aCodElec = "";
         aAlfa = "0000A la empresa le falta el codigo electronico del modelo 303.";
         |MENAV aAlfa;

         |ACABA;
     |FINSI;

     |ABRE #341;
     #341#0  = #30#2;
     #341#1  = #0#1;
     #341#2  = #0#2;
     #341#3  = 340;
     #341#4  = 0;
     #341#5  = 0;
     |LEE 040#341=;
     |SI FSalida ! 0;
         |MENAV "0000 No existe datos en el modelo 340.";
         |CIERRA #341;
         |ACABA;
     |FINSI;
     |CIERRA #341;


     |ABRE #2;
     #2#0 = #30#2;
     #2#1 = #30#26;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;

     |SI #0#1 [ 2012;  |HAZ Lanza2012;  |FINSI;
     |SI #0#1 ] 2013;  |HAZ Lanza2013;  |FINSI;


     |CIERRA #2;
|FPRC;
