|FICHEROS;
    caliqiva #0;
    caivasop #1;
    caivarep #2;
|FIN;

|VARIABLES;
    &entrada = 1;
    sw_impr = 0;
    informe1 = "caliqiva";
    mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    x = 0;
    y = 0;
    z = 0;
    &descri1 = "";
    &descri2 = "";
    &varnum1 = 0;
    &varnum2 = 0;
    &varnum3 = 0;
    &tiva1 = 0;
    &tiva3 = 0;
    &trec1 = 0;
    &trec3 = 0;
    &ttotal1 = 0;
    &ttotal3 = 0;
    &swlin = 0;
    &bds = 0;
    &bdr = 0;
    &bns = 0;
    &bnr = 0;
    &cus = 0;
    &cur = 0;
    alfa1 = "";

    tiva11 = 0;
    prim = 0;
    blanco = "  ";
    ultimo = "zz";
    xx = 0;
    yy = 0;
    zz = 0;
    desde = 0;
    hasta = 0;
    inver1 = "";
    inver2 = "";
|FIN;

|INCLUYE acceso_i;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO empieza; |TIPO 7;
  |HAZ inicio;
  #0#0 = fec1;
  #0#1 = fec2;
  |PINTA #0#0;
  |PINTA #0#1;
|FPRC;

|PROCESO fechad;
  |SI #0#0 < fec1; |O #0#0 > fec2;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO fechah;
  |SI #0#1 < fec1; |O #0#1 > fec2; |O #0#1 < #0#0;
      |MENAV mensa1;
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO periodoh;
  |SI #0#71 < #0#70;
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO mayus;
 #0Campo = #0Campo > " ";
 |PINTA #0Campo;
|FPRC;

|PROCESO selec;
 |C_M #0#0,1,"S";  |C_M #0#1,1,"S";
 |C_M #0#70,1,"S"; |C_M #0#71,1,"S";
 |PINTA 1032, "                           ";

 |SI #0Campo = 1; alfa1 = "POR FECHA FACTURA  "; |FINSI;
 |SI #0Campo = 2; alfa1 = "POR FECHA CONTABLE "; |FINSI;
 |SI #0Campo = 3; alfa1 = "POR PERIODO DE LIQUIDACION "; |FINSI;
 |ATRI I; |PINTA 1032, alfa1; |ATRI 0;

 |SI #0Campo = 3;
     |C_M #0#0, 1,"N";  |C_M #0#1,1,"N";
     #0#0 = fec1; |PINTA #0#0;
     #0#1 = fec2; |PINTA #0#1;
 |SINO;
     |C_M #0#70, 1,"N";  |C_M #0#71,1,"N";
     #0#70 = 01; |PINTA #0#70;
     #0#71 = 12; |PINTA #0#71;
 |FINSI;
|FPRC;
____________________________________/ IVA SOPORTADO
|PROCESO carga_sopo;
  |PARA xx = desde;  |SI xx [ hasta;  |HACIENDO xx = xx + 1;
        yy = xx + 10;
        zz = xx + 20;
        |SI #0xx = -1;
             #0xx = #1y;
             #0yy = #1x;
             #0zz = #1z;
            |SAL;
        |FINSI;
        |SI #1y = #0xx;
            #0yy = #0yy + #1x;
            #0zz = #0zz + #1z;
            |SAL;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO puntero1;
  |PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;         || carga iva sop.
        y = x + 3;       || % IVA                      || bases 1-3
        z = y + 3;       || ptas. IVA
        |SI #1#23 = "N";
            #0#63 = #0#63 + #1x;
            #0#64 = #0#64 + #1z;
        |SINO;
            |SI #1x ! 0; |O #1z ! 0;
                desde = 3;
                hasta = 12;
                |HAZ carga_sopo;
            |FINSI;
        |FINSI;
  |SIGUE;
  |PARA x = 52; |SI x [ 53; |HACIENDO x = x + 1;         || carga iva sop.
        y = x + 2;       || % IVA                      || bases 4-5
        z = y + 2;       || ptas. IVA
        |SI #1#23 = "N";
            #0#63 = #0#63 + #1x;
            #0#64 = #0#64 + #1z;
        |SINO;
            |SI #1x ! 0; |O #1z ! 0;
                desde = 3;
                hasta = 12;
                |HAZ carga_sopo;
            |FINSI;
        |FINSI;
  |SIGUE;

  |PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;    || Carga rec. sop.
        y = x + 9;       || % recargo             || bases 1-3
        z = y + 3;       || cuota recargo
        |SI #1#23 = "N";
            #0#64 = #0#64 + #1z;
        |SINO;
            |SI #1x ! 0;|Y #1y ! 0;
                desde = 33;
                hasta = 42;
                |HAZ carga_sopo;
            |FINSI;
        |FINSI;
  |SIGUE;
  |PARA x = 52; |SI x [ 53; |HACIENDO x = x + 1;    || Carga rec. sop.
        y = x + 6;       || % recargo             || base 4-5
        z = y + 2;       || cuota recargo
        |SI #1#23 = "N";
            #0#64 = #0#64 + #1z;
        |SINO;
            |SI #1x ! 0;|Y #1y ! 0;
                desde = 33;
                hasta = 42;
                |HAZ carga_sopo;
            |FINSI;
        |FINSI;
  |SIGUE;

|FPRC;

|DEFBUCLE calisopo;
#1#3;
48;
#0#65, #0#0, blanco, 000001, inver1;
#0#66, #0#1, ultimo, 999999, inver2;
be;
NULL,puntero1;
|FIN;

|DEFBUCLE calisopo_2;
#1#1;
46,48;
#0#65, blanco, 000000, #0#0, inver1;
#0#66, ultimo, 999999, #0#1, inver2;
be;
NULL,puntero1;
|FIN;

|DEFBUCLE calisopo_3;
#1#1;
44,48;
#0#65, blanco, 000000, #0#70, inver1;
#0#66, ultimo, 999999, #0#71, inver2;
be;
NULL,puntero1;
|FIN;
____________________________________/ IVA REPERCUTIDO
|PROCESO carga_repe;
  |PARA xx = desde;  |SI xx [ hasta;  |HACIENDO xx = xx + 1;
        yy = xx + 10;
        zz = xx + 20;
        |SI #0xx = -1;
             #0xx = #2y;
             #0yy = #2x;
             #0zz = #2z;
            |SAL;
        |FINSI;
        |SI #2y = #0xx;
            #0yy = #0yy + #2x;
            #0zz = #0zz + #2z;
            |SAL;
        |FINSI;
  |SIGUE;
|FPRC;

|PROCESO puntero2;
  |PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;         || carga iva rep.
        y = x + 3;       || % IVA                      || bases 1-3
        z = y + 3;       || ptas. IVA
        |SI #2#23 = "N";
            #0#63 = #0#63 + #2x;
            #0#64 = #0#64 + #2z;
        |SINO;
            |SI #2x ! 0; |O #2z ! 0;
                desde = 3;
                hasta = 12;
                |HAZ carga_repe;
            |FINSI;
        |FINSI;
  |SIGUE;
  |PARA x = 52; |SI x [ 53; |HACIENDO x = x + 1;         || carga iva rep.
        y = x + 2;       || % IVA                      || bases 4-5
        z = y + 2;       || ptas. IVA
        |SI #2#23 = "N";
            #0#63 = #0#63 + #2x;
            #0#64 = #0#64 + #2z;
        |SINO;
            |SI #2x ! 0; |O #2z ! 0;
                desde = 3;
                hasta = 12;
                |HAZ carga_repe;
            |FINSI;
        |FINSI;
  |SIGUE;

  |PARA x =  8; |SI x [ 10; |HACIENDO x = x + 1;         || carga rec. rep.
        y = x + 9;       || % recargo                  || bases 1-3
        z = y + 3;       || ptas. recargo
        |SI #2#23 = "N";
            #0#64 = #0#64 + #2z;
        |SINO;
            |SI #2x ! 0; |Y #2y ! 0;
                desde = 33;
                hasta = 42;
                |HAZ carga_repe;
            |FINSI;
        |FINSI;
  |SIGUE;
  |PARA x = 52; |SI x [ 53; |HACIENDO x = x + 1;         || carga rec. rep.
        y = x + 6;       || % recargo                  || bases 4-5
        z = y + 2;       || ptas. recargo
        |SI #2#23 = "N";
            #0#64 = #0#64 + #2z;
        |SINO;
            |SI #2x ! 0; |Y #2y ! 0;
                desde = 33;
                hasta = 42;
                |HAZ carga_repe;
            |FINSI;
        |FINSI;
  |SIGUE;
|FPRC;

|DEFBUCLE calirepe;        || Lee por fecha factura
#2#3;
48;
#0#65, #0#0, blanco, 000000, inver1;
#0#66, #0#1, ultimo, 999999, inver2;
be;
NULL,puntero2;
|FIN;

|DEFBUCLE calirepe_2;
#2#1;
46,48;
#0#65, blanco, 000000, #0#0, inver1;
#0#66, ultimo, 999999, #0#1, inver2;
be;
NULL,puntero2;
|FIN;

|DEFBUCLE calirepe_3;
#2#1;
44,48;
#0#65, blanco, 000000, #0#70, inver1;
#0#66, ultimo, 999999, #0#71, inver2;
be;
NULL,puntero2;
|FIN;
____________________________________/ LECTURA Y RUTINAS
|PROCESO impre; |TIPO 3;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |INFOR informe1;
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  sw_impr = 0;
  inver1 = #0#67;
  inver2 = #0#67;
  |SI #0#67 = "A";

     inver1 = "N"; inver2 = "N";
     |PDEFECTO #0,3,65;
     |SI #0#69 = 1; |BUCLE calisopo;   |FINSI;
     |SI #0#69 = 2; |BUCLE calisopo_2; |FINSI;
     |SI #0#69 = 3; |BUCLE calisopo_3; |FINSI;
     |HAZ impre2;

     sw_impr = 0;
     inver1 = "S"; inver2 = "S";
     |PDEFECTO #0,3,65;
     |SI #0#69 = 1; |BUCLE calisopo;   |FINSI;
     |SI #0#69 = 2; |BUCLE calisopo_2; |FINSI;
     |SI #0#69 = 3; |BUCLE calisopo_3; |FINSI;
     |HAZ impre2;

     sw_impr = 0;
     inver1 = "N"; inver2 = "N";
     |PDEFECTO #0,3,65;
     |SI #0#69 = 1; |BUCLE calirepe;   |FINSI;
     |SI #0#69 = 2; |BUCLE calirepe_2; |FINSI;
     |SI #0#69 = 3; |BUCLE calirepe_3; |FINSI;
     |HAZ impre3;

     sw_impr = 0;
     inver1 = "S"; inver2 = "S";
     |PDEFECTO #0,3,65;
     |SI #0#69 = 1; |BUCLE calirepe;   |FINSI;
     |SI #0#69 = 2; |BUCLE calirepe_2; |FINSI;
     |SI #0#69 = 3; |BUCLE calirepe_3; |FINSI;
     |HAZ impre3;
  |FINSI;
  |PIEINF;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO impre2;
  tiva1 = 0; tiva11 = 0; tiva3 = 0;
  prim = 0;
  |PARA xx = 3; |SI xx [ 12; |HACIENDO xx = xx + 1;
        yy = xx + 10;
        zz = xx + 20;
        |SI #0xx = -1;  |SAL;  |FINSI;
        |SI #0yy ! 0;  |O #0zz ! 0; |O xx = 3;
            varnum1 = #0yy;
            varnum2 = #0xx;
            varnum3 = #0zz;
            tiva1 = tiva1 + varnum1;
            tiva11 = tiva11 + varnum1;
            tiva3 = tiva3 + varnum3;
            |SI prim = 0;
                |SI inver1 = "N";
                  descri1 = "*I.V.A. SOPORTADO";
                  descri2 = " ================";
                |SINO;
                  descri1 = "*I.V.A. SOPORTADO (INVERSION)";
                  descri2 = " ============================";
                |FINSI;
                swlin = 1;
                |PRINT;
                prim = 1;
            |FINSI;
            swlin = 2;
            |PRINT;
            sw_impr = 1;
        |FINSI;
  |SIGUE;
  |SI sw_impr ! 0;
      swlin = 3;
      |PRINT;
      sw_impr = 0;
  |FINSI;
  ttotal3 = ttotal3 + tiva3;

  tiva1 = 0; tiva3 = 0;
  prim = 0;
  |PARA xx = 33; |SI xx [ 42; |HACIENDO xx = xx + 1;
        yy = xx + 10;
        zz = xx + 20;
        |SI #0xx = -1;  |SAL;  |FINSI;
        varnum1 = #0yy;
        varnum2 = #0xx;
        varnum3 = #0zz;
        tiva1 = tiva1 + varnum1;
        tiva3 = tiva3 + varnum3;
        |SI prim = 0;
            |SI inver1 = "N";
               descri1 = "*REC. DE EQ. SOPORTADO";
               descri2 = " =====================";
            |SINO;
               descri1 = "*REC. DE EQ. SOPORTADO (INVERSION)";
               descri2 = " =================================";
            |FINSI;
            swlin = 1;
            |PRINT;
            prim = 1;
        |FINSI;
        swlin = 2;
        |PRINT;
        sw_impr = 1;
  |SIGUE;
  |SI sw_impr ! 0;
      swlin = 3;
      |PRINT;
      sw_impr = 0;
  |FINSI;
  |SI #0#63 ! 0;|O #0#64 ! 0;
      swlin = 4;
      |PRINT;
  |FINSI;
  ttotal1 = tiva11 + #0#63 + #0#64;
  ttotal3 = ttotal3 + tiva3;
  bds = bds + tiva11;
  bns = bns + #0#63 + #0#64;
  cus = cus + ttotal3;
  ttotal1 = 0; ttotal3 = 0;
|FPRC;

|PROCESO impre3;       ||imprime IVA repercutido;
  tiva1 = 0; tiva11 = 0; tiva3 = 0;
  prim = 0;
  |PARA xx = 3; |SI xx [ 12; |HACIENDO xx = xx + 1;
        yy = xx + 10;
        zz = xx + 20;
        |SI #0xx = -1;  |SAL;  |FINSI;
        |SI #0yy ! 0;  |O #0zz ! 0; |O xx = 3;
            varnum1 = #0yy;
            varnum2 = #0xx;
            varnum3 = #0zz;
            tiva1 = tiva1 + varnum1;
            tiva11 = tiva11 + varnum1;
            tiva3 = tiva3 + varnum3;
            |SI prim = 0;
                |SI inver1 = "N";
                  descri1 = "*I.V.A. REPERCUTIDO";
                  descri2 = " ==================";
                |SINO;
                  descri1 = "*I.V.A. REPERCUTIDO (INVERSION)";
                  descri2 = " ==============================";
                |FINSI;
                swlin = 1;
                |PRINT;
                prim = 1;
            |FINSI;
            swlin = 2;
            |PRINT;
            sw_impr = 1;
        |FINSI;
  |SIGUE;
  |SI sw_impr ! 0;
      swlin = 3;
      |PRINT;
      sw_impr = 0;
  |FINSI;
  ttotal3 = ttotal3 + tiva3;

  tiva1 = 0; tiva3 = 0;
  prim = 0;
  |PARA xx = 33; |SI xx [ 42; |HACIENDO xx = xx + 1;
        yy = xx + 10;
        zz = xx + 20;
        |SI #0xx = -1;  |SAL;  |FINSI;
        varnum1 = #0yy;
        varnum2 = #0xx;
        varnum3 = #0zz;
        tiva1 = tiva1 + varnum1;
        tiva3 = tiva3 + varnum3;
        |SI prim = 0;
            |SI inver1 = "N";
               descri1 = "*REC. DE EQ. REPERCUTIDO";
               descri2 = " =======================";
            |SINO;
               descri1 = "*REC. DE EQ. REPERCUTIDO (INVERSION)";
               descri2 = " ===================================";
            |FINSI;
            swlin = 1;
            |PRINT;
            prim = 1;
        |FINSI;
        swlin = 2;
        |PRINT;
        sw_impr = 1;
  |SIGUE;
  |SI sw_impr ! 0;
      swlin = 3;
      |PRINT;
      sw_impr = 0;
  |FINSI;
  |SI #0#63 ! 0;|O #0#64 ! 0;
      swlin = 4;
      |PRINT;
  |FINSI;
  ttotal1 = tiva11 + #0#63 + #0#64;
  ttotal3 = ttotal3 + tiva3;
  bdr = bdr + tiva11;
  bnr = bnr + #0#63 + #0#64;
  cur = cur + ttotal3;
  ttotal1 = 0; ttotal3 = 0;
|FPRC;
