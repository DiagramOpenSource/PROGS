|FICHEROS;
   casoplib #0;
   casoplim #11,MANTE;
   casoplil #12,MANTE;

   caportad #2;

   caconimp #5;

   agim0019 #500;
   agim0056 #516;

   fichero@ #900;
   cabucem1 #4;
|FIN;

|VARIABLES;
   nSalir      = 0;
   aSistema    = "";
   aOrigen     = "";
   aDestino    = "";
   EstadoAnt   = "";
   Comodin     = "";
   Comodin1    = "";
   Comodin2    = "";
   Comodin3    = "";
   NombreTotal = "";
   Nombre      = "";
   aApell1     = "";
   aApell2     = "";
   aLong       = "";
   Directorio  = "";
   Dia         = "";
   anyo        = "";
   Cuenta      = "";
   aDia        = "";
   aMes        = "";
   aAnyo       = "";
   ComFecha    = "";
   Caracter    = "";
   aNumer      = "";
   aAlfa       = "";
   aImpre      = "";
   aPath       = "";
   aPathContas = "";
   aSaldoCero  = "";
   aApertura   = "";
   aBorro      = "";
   aBorroS     = "";
   nNoborro    = 0;
   Local       = 0;
   ModoEntrada = 0;
   nLong       = 0;
   nParte1     = 0;
   nParte2     = 0;
   Handle      = 0;
   Calc        = 0;
   Empresa     = 0;
   Periodo     = 0;
   Linea       = 1;
   Cuentador   = 0;
   nCont       = 0;
   NumFecha    = 0;
   Ejercicio   = 0;
   Numeracion  = 0;
   Empre1      = 0;

   Fecha       = @;

   nDejaSI     = 0;
   aEstado     = "";

   nInkey = 0;
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aAlfa4 = "";
   nNume1 = 0;
   nNume2 = 0;
   nNume3 = 0;
   aVerDatos = "";
   nVerDat   = 0;

   &eaUltNiv  = "";
   &enBasImp  = 0;
   &eaNomImp  = "";
   &eaLegEmp  = "";
   &eaLegPer  = "";
   &eaFormato = "";
   &eaPathLeg = "";
   &efFecLeg  = @;
   &eaDatLeg  = "";
   &aMemoria  = "";
   &eaMemSoc   = "";
   &eaUnidadBasico = "";
   &eaUnidadBTmp   = "";
   &eaCtasLeg   = "";
   &enCtasLeg   = 0;
   &enOrdRep    = 0;
   &enOrdSop    = 0;

   aMasNombre   = "";
   nNumLibros   = 0;
   nError       = 0;
   &eaDirGuarda = "";
   &eaOrigen    = "";
   &eaDestino   = "";
   aDef         = "";
   nErrorSec    = 0;
   nBueno       = 0;

     aAbre        = "";
     nHandle      = 0;
     nBaffer      = 0;
     nOpcion      = 0;
     nTotalLinea  = 0;
     nConta       = 0;
     nCogeOpcion  = 0;
     aBase        = "";

     aFichero     = "";
     nSwOpe       = 0;
     nSwOp1       = 0;

  {10}aPopup        = "";
     nID            = 0;
     aID            = "";

   nSal    = 0;
   nModo   = 0;
   nNumeT1 = 0;
   nNumeT2 = 0;
   nNumeT3 = 0;
   nNumeT4 = 0;
   nNumeT5 = 0;
   nNumeT6 = 0;
   nNumeT7 = 0;
   nNumeT8 = 0;
   nPrimero = 0;

   aNombre    = "";
   aOrden     = "";
   aExtension = "";
   &eaVarDni  = "";
   &enCalcCif = 0;
   aAnterior  = "";

   aCampo18 = "";
   aCampo19 = "";
   aCampo20 = "";
   aCampo21 = "";
   aCampo22 = "";
   aCampo23 = "";
   aCampo24 = "";
   aCampo25 = "";
   aCampo26 = "";
   aCampo27 = "";
   aCampo28 = "";
   aCampo29 = "";
   nCampo30 = "";
   nCampo31 = "";
   nPara1   = 0;
   nPara2   = 0;
   nEstado  = 0;
   nEmpresa = 0;
   nPeriodo = 0;
   aCasilla = "";
   nExiste  = 0;

   aNifQbf1   = "";
   aNifQbf2   = "";
   nSociedad = 0;
   nSw       = 0;
|FIN;

|INCLUYE varnue_i;

|| ................. Nuevos documentos
|PROCESO casoplil;
  |SI nSwOp1 = 0;
      |BORRA 020#12a;
  |FINSI;

  |SI nSwOp1 = 1;
      |SI #12#1 = 1; |Y #12#6 > nNumeT1; nNumeT1 = #12#6; |FINSI;
      |SI #12#1 = 2; |Y #12#6 > nNumeT2; nNumeT2 = #12#6; |FINSI;
      |SI #12#1 = 3; |Y #12#6 > nNumeT3; nNumeT3 = #12#6; |FINSI;
      |SI #12#1 = 4; |Y #12#6 > nNumeT4; nNumeT4 = #12#6; |FINSI;
      |SI #12#1 = 5; |Y #12#6 > nNumeT5; nNumeT5 = #12#6; |FINSI;
      |SI #12#1 = 6; |Y #12#6 > nNumeT6; nNumeT6 = #12#6; |FINSI;
      |SI #12#1 = 7; |Y #12#6 > nNumeT7; nNumeT7 = #12#6; |FINSI;
      |SI #12#1 = 8; |Y #12#6 > nNumeT8; nNumeT8 = #12#6; |FINSI;
  |FINSI;

  |SI nSwOp1 = 2;
      eaOrigen = #12#2; |QBF eaOrigen;
      |SI eaOrigen ! "";
          eaDestino = #12#3; |QBF eaDestino;
          |SI eaDestino ! "";
              eaDestino = Comodin1 + eaDestino;

              aAlfa = "";
              |IP_REMOTO aAlfa; |QBF aAlfa;
              |SI aAlfa ! "";
                  |RECIBE_FICHERO eaOrigen, eaDestino;
              |SINO;
                  |COPIA_FICHERO eaOrigen, eaDestino;
              |FINSI;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI nSwOp1 = 3;
       nNumeT1 = nNumeT1 + 1;
  |FINSI;

  |LIBERA #12;
|FPRC;

|DEFBUCLE casoplil;
  #12#1;
  ;
  001;
  999;
  ;
  NULL, casoplil;
|FIN;

|PROCESO CopiaNuevos;

  eaLegEmp = ("00000" + #cabucem1#0) % -105;
  eaLegPer = #cabucem1#1;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "hacienda/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

  nSwOp1 = 2; |BUCLE casoplil;

  |PULSATECLA;
|FPRC;

|PROCESO Tipo0C0;  |TIPO 0;
      nPrimero = #12#1;
      nModo  = (FEntrada / 100) ! 0;
      |SI nModo = 1;
          #12#4 = #cabucem1#3;
          #12#5 = #cabucem1#4;
      |FINSI;
|FPRC;

|PROCESO Tipo2lil;  |TIPO 2;
      |SI #12#1 = 1; nNumeT1 = nNumeT1 +. 1; |FINSI;
      |SI #12#1 = 2; nNumeT2 = nNumeT2 +. 1; |FINSI;
      |SI #12#1 = 3; nNumeT3 = nNumeT3 +. 1; |FINSI;
      |SI #12#1 = 4; nNumeT4 = nNumeT4 +. 1; |FINSI;
      |SI #12#1 = 5; nNumeT5 = nNumeT5 +. 1; |FINSI;
      |SI #12#1 = 6; nNumeT6 = nNumeT6 +. 1; |FINSI;
      |SI #12#1 = 7; nNumeT7 = nNumeT7 +. 1; |FINSI;
      |SI #12#1 = 8; nNumeT8 = nNumeT8 +. 1; |FINSI;
|FPRC;

|PROCESO BuscaFichero;
   |SI FSalida = 10;
       aAlfa = #12#2; |QBF aAlfa;
       |SI aAlfa = ""; aAlfa = "*"; |FINSI;
       aAlfa = "F" + aAlfa;
       |BROWSE aAlfa;
       aAlfa = aAlfa - "F";
       #12#2 = aAlfa;
       |ERROR;
   |FINSI;

   aAlfa = #12#2; |QBF aAlfa;
   |SI aAlfa = "";
       |MENAV "0000Error. No puede dejar el fichero origen en blanco";
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO DestinoBueno;
   |SI FSalida = 2; |ACABA; |FINSI;

   |SI #12#1 = 1; aAlfa = "ACTASCON"; |FINSI;
   |SI #12#1 = 2; aAlfa = "ACTASDET"; |FINSI;
   |SI #12#1 = 3; aAlfa = "ACTALCON"; |FINSI;
   |SI #12#1 = 4; aAlfa = "ACTACODE"; |FINSI;
   |SI #12#1 = 5; aAlfa = "ACCIONES"; |FINSI;
   |SI #12#1 = 6; aAlfa = "SOCIOS";   |FINSI;
   |SI #12#1 = 7; aAlfa = "SOCUNICO"; |FINSI;
   |SI #12#1 = 8; aAlfa = "OTROS";    |FINSI;

   nError = 0;
   aAlfa1 = #12#3 - aAlfa;
   |SI FSalida = 0;
       nError = 1;
   |SINO;
       aAlfa1 = aAlfa1 - "_";
       |SI FSalida = 0;
           nError = 1;
       |SINO;
           aAlfa2 = aAlfa1 % 103;
           |SI aAlfa2 < "001"; |O aAlfa2 > "999";
               nError = 1;
           |SINO;
               aAlfa1 = aAlfa1 % 410;
               aAlfa1 = aAlfa1 - ".";
               |SI FSalida = 0;
                   nError = 1;
               |SINO;
                   |QBF aAlfa1; aAlfa1 = aAlfa1 > " ";
                   |SI aAlfa1 ! "XLS"; |Y aAlfa1 ! "XLSX";
                      |Y aAlfa1 ! "DOC"; |Y aAlfa1 ! "DOCX";
                          |Y aAlfa1 ! "PDF";
                         nError = 1;
                    |FINSI;
                |FINSI;
            |FINSI;
       |FINSI;
   |FINSI;
   |SI nError = 1;
       |MENAV "0000Nombre del Fichero destino NO valido";
   |FINSI;
|FPRC;

|PROCESO Tipo66C01; |TIPO 66;

     aAlfa = "|C001WID";
     aID   = #casoplil#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 8;
     aPopup3  = "1  Libro de Actas";
     aPopup4  = "2  Libro de Detalle de Actas";
     aPopup5  = "3  Libro de Actas del Consejo";
     aPopup6  = "4  Libro de Detalle de Actas del Consejo";
     aPopup7  = "5  Registro de Acciones Nominativas";
     aPopup8  = "6  Registro de Socios";
     aPopup9  = "7  Libro-Registro de Contratos del Socio Unico ";
     aPopup10 = "8  Otros";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #12#1 = aAlfa;
     |FINSI;

     |PINTA #12#1;
|FPRC;

|PROCESO Tipo0C01; |TIPO 0;
     aAlfa  = Contenido;
     nNume1 = aAlfa;
     nModo  = (FEntrada / 100) ! 0;

     |SI nNume1 ! #12#1; |O nModo = 1;
         |SI #12#1 = 1; #12#6 = nNumeT1 + 1; |FINSI;
         |SI #12#1 = 2; #12#6 = nNumeT2 + 1; |FINSI;
         |SI #12#1 = 3; #12#6 = nNumeT3 + 1; |FINSI;
         |SI #12#1 = 4; #12#6 = nNumeT4 + 1; |FINSI;
         |SI #12#1 = 5; #12#6 = nNumeT5 + 1; |FINSI;
         |SI #12#1 = 6; #12#6 = nNumeT6 + 1; |FINSI;
         |SI #12#1 = 7; #12#6 = nNumeT7 + 1; |FINSI;
         |SI #12#1 = 8; #12#6 = nNumeT8 + 1; |FINSI;
         |PINTA #12#6;
     |FINSI;
     |SI #12#1 = 1; #12#7 = "Libro de Actas "; |FINSI;
     |SI #12#1 = 2; #12#7 = "L.Detalle Actas"; |FINSI;
     |SI #12#1 = 3; #12#7 = "L.Actas Consejo"; |FINSI;
     |SI #12#1 = 4; #12#7 = "L.Det.Acta Con."; |FINSI;
     |SI #12#1 = 5; #12#7 = "Reg.Acc.Nomina."; |FINSI;
     |SI #12#1 = 6; #12#7 = "Registro Socios"; |FINSI;
     |SI #12#1 = 7; #12#7 = "L.-R.Cont. S.U."; |FINSI;
     |SI #12#1 = 8; #12#7 = "Otros";           |FINSI;
     |PINTA #12#7;
|FPRC;

|PROCESO PonExtension;
         aOrden = ("000" + #12#6) % -103;

         aAlfa      = #12#2; |QBF aAlfa;
         aAlfa1     = aAlfa % 0;
         nNume1     = aAlfa1;
         aExtension = "";
         |PARA nNume2 = nNume1; |SI nNume2 > 0; |HACIENDO nNume2 = nNume2 - 1;
               nNume3 = 100 * nNume2 + 1;
               aAlfa2 = nNume3;
               aAlfa3 = aAlfa % aAlfa2;
               |SI aAlfa3 = ".";
                   |SAL;
               |SINO;
                   aExtension = aAlfa3 + aExtension;
               |FINSI;
         |SIGUE;
         aExtension = aExtension < "";
|FPRC;

|PROCESO PonerDestino; |TIPO 0;
/*
     |SI #12#6 > 9;
         |MENAV "0000El numero debe ser inferior a 10";
         |ERROR;
         |ACABA;
     |FINSI;
*/
     |SI FSalida = 2; |ACABA; |FINSI;

     nModo  = (FEntrada / 100) ! 0;
     aAlfa1 = #12#3; |QBF aAlfa1;

     |SI nPrimero ! #12#1; |O nModo = 1; |O aAlfa1 = "";
         |SI #12#1 = 1; aNombre = "ACTASCON_"; |FINSI;
         |SI #12#1 = 2; aNombre = "ACTASDET_"; |FINSI;
         |SI #12#1 = 3; aNombre = "ACTALCON_"; |FINSI;
         |SI #12#1 = 4; aNombre = "ACTACODE_"; |FINSI;
         |SI #12#1 = 5; aNombre = "ACCIONES_"; |FINSI;
         |SI #12#1 = 6; aNombre = "SOCIOS_";   |FINSI;
         |SI #12#1 = 7; aNombre = "SOCUNICO_"; |FINSI;
         |SI #12#1 = 8; aNombre = "OTROS_";    |FINSI;

         |HAZ PonExtension;
         aAlfa1 = aNombre + aOrden + "." + aExtension;

         #12#3 = aAlfa1; |PINTA #12#3;

         aAlfa2 = #12#3;
         aAlfa1 = aNombre + aOrden + ".";
         |HAZ VerSiExiste;
     |FINSI;
|FPRC;

|PROCESO VerSi;
   |SI #12#0 ! #900#0;
       nExiste = 1;
   |FINSI;
|FPRC;

|DEFBUCLE VerSi;
  #900#1001;
  1,6;
  001, #12#1, #12#6;
  999, #12#1, #12#6;
  ;
  NULL, VerSi;
|FIN;

|PROCESO VerSiExiste;
         nExiste = 0;
         |DBASE Comodin; |QBF Comodin;
         Comodin  = Comodin + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
         Comodin1 = Comodin + aAlfa1 + "*";
         |_PDIR Comodin1;
         |PARA; |SI FSalida = 0; |HACIENDO;
                nExiste = 1;
                |_SDIR Comodin1;
                aAlfa = Comodin1 - Comodin;
                |SI aAlfa ! aAlfa2;
                    nExiste = 2;
                |FINSI;
         |SIGUE;

         |SI nExiste = 0;
             |BUCLE VerSi;
         |FINSI;

         |SI nExiste = 1;
             |CONFI "0000NYa existe el Fichero. Desea Regrabarlo";
             |SI FSalida ! 0;
                 |ERROR;
             |FINSI;
         |FINSI;
         |SI nExiste = 2;
             |MENAV "0000Existe un fichero igual pero con distinta extension. Modifique numero";
             |ERROR;
         |FINSI;
|FPRC;

|PROCESO ClauA12;
     #12#0 = 1;
|FPRC;

|PROCESO ClauB12;
     #12#0 = 999;
|FPRC;

|PROCESO OtrosLibros;
     #48#2 = #cabucem1#0;
     #48#3 = #cabucem1#1;
     |LEE 000#48=;

     |DFICB Comodin1; |QBF Comodin1;
     Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
     |CIERRA #12;  |PATH_DAT #12 Comodin1;
     |CIERRA #900; |PATH_DAT #900 Comodin1;

     nNumeT1 = 0;  nNumeT2 = 0;  nNumeT3 = 0;
     nNumeT4 = 0;  nNumeT5 = 0;  nNumeT6 = 0;
     nNumeT7 = 0;  nNumeT8 = 0;
     nSwOp1 = 1; |BUCLE casoplil;

     |PINPA #0#12;
     |ENTLINEAL #1#12, -1, 7, 22, 0, ClauA12, ClauB12;

     |PINTA 1513, #cabucem1#0;
     |PINTA 1519, #cabucem1#1;
     |PINTA 1521, #48#1;
     |PINTA 1470, #cabucem1#3;
     |PINTA 1570, #cabucem1#4;

     nSal = 0;
     |PARA; |SI nSal = 0; |HACIENDO;
            |ENTLINEAL #1#12, -1, 2, 22, 0, ClauA12, ClauB12;
            |CONFI "0000SSon los Ficheros Correctos";
            |SI FSalida = 0;
                |HAZ CopiaNuevos;
                nSal = 1;
            |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE OtrosLibros;
     #cabucem1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, OtrosLibros;
|FIN;

|PROCESO Proceso17;
    |DDEF aDef;
    aDef = aDef + "casoplil";
    |CARGA_DEF aDef, fichero@;
    |SI FSalida ! 0;
         |MENAV "    Error al Carga fichero de Otros Libros";
         |ACABA;
    |FINSI;

    |PUSHV 1301 2380;
    |ABRE #48;
    |BUCLE OtrosLibros;
    |CIERRA #48;
    |HAZ ReponBotones;
    |POPV;
    |DESCARGA_DEF #900;
|FPRC;


|PROCESO CopiaLaMemoria;
  eaDirGuarda  = aPContas + "emisiones";
  eaDirGuarda  = eaDirGuarda + "/" + eaLegEmp;
  aAlfa        = enEjercicio;
  eaDirGuarda  = eaDirGuarda + "/" + aAlfa;
  eaDirGuarda  = eaDirGuarda + "/";
  eaOrigen     = eaDirGuarda + "wmemori.doc";   ||recojo la Memoria

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "hacienda/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   Comodin1 = Comodin1 + "MEMORIA_*.doc";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1  = Comodin1 + "hacienda/PresLibr/" + eaLegEmp + eaLegPer + "/";
  Comodin1  = Comodin1 + "MEMORIA_" + (("000" + Numeracion) % -103) + ".doc";
  eaDestino = Comodin1;

  |COPIA_FICHERO eaOrigen, eaDestino;

|FPRC;

|PROCESO CopiaGestion;
  eaDirGuarda  = aPContas + "emisiones";
  eaDirGuarda  = eaDirGuarda + "/" + eaLegEmp;
  aAlfa        = enEjercicio;
  eaDirGuarda  = eaDirGuarda + "/" + aAlfa;
  eaDirGuarda  = eaDirGuarda + "/";
  eaOrigen     = eaDirGuarda + "wgestio.doc";   ||recojo la Memoria

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1 = Comodin1 + "hacienda/PresLibr/";
  |MKDIR Comodin1;
  Comodin1 = Comodin1 + eaLegEmp + eaLegPer + "/";
  |MKDIR Comodin1;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
   Comodin1 = Comodin1 + "GESTION_*.doc";
   |_PDIR Comodin1;
   |SI FSalida = 0;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
         Numeracion = Comodin; Numeracion = Numeracion + 1;
         |_SDIR Comodin1;
      |SIGUE;
   |SINO;
      Numeracion = 1;
   |FINSI;

  |DBASE Comodin1; |QBF Comodin1;
  Comodin1  = Comodin1 + "hacienda/PresLibr/" + eaLegEmp + eaLegPer + "/";
  Comodin1  = Comodin1 + "GESTION_" + (("000" + Numeracion) % -103) + ".doc";
  eaDestino = Comodin1;

  |COPIA_FICHERO eaOrigen, eaDestino;

|FPRC;

|PROCESO MemoriaNueva;
    |SI HaySociedad = 0;  |ACABA; |FINSI;

    aDef = aPContas + "def/zregdocu";
    |CARGA_DEF aDef, fichero@;
    |SI FSalida ! 0;
         |MENAV "    Error al Carga fichero de Registro Documentos";
         |ACABA;
    |FINSI;

    aPathContas = aPContas + "fich/";
    |PATH_DAT #900 aPathContas;

    |ABRE #900;
    #900#0 = eaLegEmp;
    #900#1 = enEjercicio;
    |LEE 001#900=;
    |SI FSalida ! 0;
        |MENAV "    No existe Registro de Documentos de la Empresa";
    |SINO;
        |SI #900#4 = "N";
            |MENAV "    No esta creada la Memoria de la Empresa";
        |SINO;
            |HAZ CopiaLaMemoria;
        |FINSI;
        |SI enEjercicio ] 2010;
            |SI #900#8 = "N";
                |MENAV "    No esta creado el Informe de Gestion";
            |SINO;
                |HAZ CopiaGestion;
            |FINSI;
        |FINSI;
    |FINSI;
    |CIERRA #900;
    |DESCARGA_DEF #900;
|FPRC;

|PROCESO CopiaNuevo;
   |DBASE Comodin; |QBF Comodin;
   Comodin = Comodin + "hacienda/tmp1.xls";
   Comodin1 = "";
   |IP_REMOTO Comodin1; |QBF Comodin1;
   |SI Comodin1 ! "";
      Comodin1 = eaUnidadBTmp + "\tmp1.xls";
      |ENVIA_FICHERO Comodin, Comodin1;
   |SINO;
      Comodin1 = eaUnidadBTmp + "\tmp1.xls";
      |COPIA_FICHERO Comodin, Comodin1;
   |FINSI;
|FPRC;
|| ***********************************************************************

|PROCESO Diario;
     #48#2 = #cabucem1#0;
     #48#3 = #cabucem1#1;
     |LEE 000#48=;

     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;
     eaLegEmp = ("00000" + #cabucem1#0) % -105;
     eaLegPer = #cabucem1#1;

     |SUB_EJECUTA_NP "cadiario.tab;PRUEBA";
|FPRC;

|DEFBUCLE Diario;
 #cabucem1#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,Diario;
|FIN;

|PROCESO Proceso01;
   |ABRE #48;
   |BUCLE Diario;
   |CIERRA #48;
   |HAZ ReponBotones;
|FPRC;
|| //////////////////////////////////////////////////////

|PROCESO Inventario;
   #48#2 = #cabucem1#0;
   #48#3 = #cabucem1#1;
   |LEE 000#48=;

   |SI #48#26 > 80;
        enEjercicio = #48#26 + 1900;
   |SINO;
        enEjercicio = #48#26 + 2000;
   |FINSI;

   Comodin = "Procesando " + #48#1;
   |ATRI I; |PINTA 2110, Comodin; |ATRI N;

   eaLegEmp = ("00000" + #cabucem1#0) % -105;
   eaLegPer = #cabucem1#1;

   |SI eaFormato  = "S";

       |SI aApertura = "N";
           Comodin = "ca8ytodo.tab;1,12,C," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
      |SINO;
           Comodin = "ca8ytodo.tab;0,12,C," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
      |FINSI;

   |SINO;

       |HAZ CopiaNuevo;

       Comodin = "cauxinva.tab;PRUEBA";  |SUB_EJECUTA_NP Comodin;

       |SI aMemoria = "S";
           |SI enEjercicio < 2008;
               Comodin = ":sociedad/memoria1.tab;" + #cabucem1#0; |SUB_EJECUTA_NP Comodin;
           |SINO;
               |HAZ MemoriaNueva;
           |FINSI;
       |FINSI;

       |SI enEjercicio < 2008;
           |SUB_EJECUTA_NP "cabatodo.tab;0,12,C"; |PULSATECLA;
           |SUB_EJECUTA_NP "cabatodo.tab;0,12";   |PULSATECLA;
       |SINO;
           |SI enEjercicio > 2008;
               |SUB_EJECUTA "ca8yf001.tab;0,12,C";     |PULSATECLA;
               |SUB_EJECUTA "ca8yc001.tab;0,12,C";     |PULSATECLA;
               |SUB_EJECUTA "ca8yp001.tab;0,12,C";     |PULSATECLA;
               |SUB_EJECUTA "ca8ye001.tab;0,12,C";     |PULSATECLA;
               |SUB_EJECUTA "ca8ys001.tab;0,12,C";     |PULSATECLA;
           |SINO;
               |SUB_EJECUTA "ca8yf001.tab;0,12";       |PULSATECLA;
               |SUB_EJECUTA "ca8yc001.tab;0,12,C";     |PULSATECLA;
               |SUB_EJECUTA "ca8yp001.tab;0,12";       |PULSATECLA;
               |SUB_EJECUTA "ca8ye001.tab;0,12";       |PULSATECLA;
               |SUB_EJECUTA "ca8ys001.tab;0,12";       |PULSATECLA;
          |FINSI;
       |FINSI;

       |SI aApertura = "N";
           Comodin = "caycosy0.tab;1,12," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
           Comodin = "caycosy0.tab;1,9," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
           Comodin = "caycosy0.tab;1,6," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
           Comodin = "caycosy0.tab;1,3," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
       |SINO;
           Comodin = "caycosy0.tab;0,12," + aSaldoCero; |SUB_EJECUTA_NP Comodin;
           Comodin = "caycosy0.tab;0,9," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
           Comodin = "caycosy0.tab;0,6," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
           Comodin = "caycosy0.tab;0,3," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;
       |FINSI;
       Comodin = "caycosy0.tab;0,0," + aSaldoCero;  |SUB_EJECUTA_NP Comodin;

       |DBASE Comodin1; |QBF Comodin1;
       Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
       Comodin1 = Comodin1 + "INV_CUEN_*.xls";
       |_PDIR Comodin1;
       |SI FSalida = 0;
          |PARA; |SI FSalida = 0; |HACIENDO;
             Comodin = Comodin1 % -107; Comodin = Comodin % 0103;
             Numeracion = Comodin; Numeracion = Numeracion + 1;
             |_SDIR Comodin1;
          |SIGUE;
       |SINO;
          Numeracion = 1;
       |FINSI;

       Comodin = eaUnidadBTmp + "/tmp1.xls";
       aAlfa = "";
       |XCIERRA Handle;
       |DBASE Comodin1; |QBF Comodin1;
       Comodin1 = Comodin1 + "hacienda/PresLibr/";
       |MKDIR Comodin1;
       Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
       |MKDIR Comodin1;
       Comodin1 = Comodin1 + "INV_CUEN_" + (("000" + Numeracion) % -103) + ".xls";
       |IP_REMOTO aAlfa; |QBF aAlfa;
       |SI aAlfa ! "";
          |RECIBE_FICHERO Comodin, Comodin1;
       |SINO;
          |COPIA_FICHERO Comodin, Comodin1;
       |FINSI;
       FSalida = 1;
   |FINSI;
|FPRC;

|DEFBUCLE Inventario;
 #cabucem1#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,Inventario;
|FIN;

|PROCESO Proceso02;
   |ABRE #48;
   |BUCLE Inventario;
   |CIERRA #48;
   |HAZ ReponBotones;
|FPRC;

|| /////////////////////////////////

|PROCESO Mayor;
     #48#2 = #cabucem1#0;
     #48#3 = #cabucem1#1;
     |LEE 000#48=;

     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;
     eaLegEmp = ("00000" + #cabucem1#0) % -105;
     eaLegPer = #cabucem1#1;

     |SUB_EJECUTA_NP "camaydia.tab;PRUEBA";
|FPRC;

|DEFBUCLE Mayor;
 #cabucem1#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,Mayor;
|FIN;

|PROCESO Proceso07;
     |ABRE #48;
     |BUCLE Mayor;
     |CIERRA #48;
     |HAZ ReponBotones;
|FPRC;

|PROCESO Emitidas;
     #48#2 = #cabucem1#0;
     #48#3 = #cabucem1#1;
     |LEE 000#48=;

     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;
     eaLegEmp = ("00000" + #cabucem1#0) % -105;
     eaLegPer = #cabucem1#1;

     |SUB_EJECUTA_NP "cay4ivav.tab;PRUEBA";
|FPRC;

|DEFBUCLE Emitidas;
 #cabucem1#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,Emitidas;
|FIN;

|PROCESO Proceso10;
   |ABRE #48;
   |BUCLE Emitidas;
   |CIERRA #48;
   |HAZ ReponBotones;
|FPRC;

|PROCESO Recibidas;
     #48#2 = #cabucem1#0;
     #48#3 = #cabucem1#1;
     |LEE 000#48=;

     Comodin = "Procesando " + #48#1;
     |ATRI I; |PINTA 2110, Comodin; |ATRI N;

     |HAZ CopiaNuevo;
     eaLegEmp = ("00000" + #cabucem1#0) % -105;
     eaLegPer = #cabucem1#1;

     |SUB_EJECUTA_NP "cay4ivac.tab;PRUEBA";
|FPRC;

|DEFBUCLE Recibidas;
 #cabucem1#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL,Recibidas;
|FIN;

|PROCESO Proceso11;
   |ABRE #48;
   |BUCLE Recibidas;
   |CIERRA #48;
   |HAZ ReponBotones;
|FPRC;
|| -------------------

|PROCESO VerBueno;
        nBueno = 0;
        |SI nNumeT1 = 0;
            aAlfa1 = Comodin1 % -103; aAlfa1 = aAlfa1 < " ";
            |SI eaFormato ! "S";
                |SI aAlfa1 = "xls"; |O aAlfa1 = "doc";
                    nBueno = 1;
                |FINSI;
            |SINO;
                |SI aAlfa1 =  "pdf";
                    nBueno = 1;
                |FINSI;
            |FINSI;
        |SINO;
            aAlfa1 = Comodin1 % -103; aAlfa1 = aAlfa1 < " ";
            |SI aAlfa1 = "xls"; |O aAlfa1 = "doc"; |O aAlfa1 = "pdf";
                nBueno = 1;
            |SINO;
               aAlfa1 = Comodin1 % -104; aAlfa1 = aAlfa1 < " ";
               |SI aAlfa1 =  "xlsx";  |O aAlfa1 = "docx";
                   nBueno = 2;
               |FINSI;
            |FINSI;
        |FINSI;
|FPRC;

|PROCESO CuentaLibros;

     nNumLibros = 0;

     |DFICB Comodin1; |QBF Comodin1;
     Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
     |CIERRA #12;|PATH_DAT #12 Comodin1;
     nNumeT1 = 0;
     nSwOp1 = 3; |BUCLE casoplil;

     |DBASE Comodin1; |QBF Comodin1;
     Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("000000" + #48#0) % -106) + "/";
     Comodin1 = Comodin1 + "*.*";
     |_PDIR Comodin1;
     |PARA; |SI FSalida = 0; |HACIENDO;
            |HAZ VerBueno;
            |SI nBueno ! 0;
                nNumLibros = nNumLibros + 1;
            |FINSI;
            |_SDIR Comodin1;
     |SIGUE;

|FPRC;

|PROCESO MiraCabecera;

   nEmpresa = #48#2;
   nPeriodo = #48#3;
   enEjercicio = #48#26 + 2000;

   |DDEFECTO #0;
   #0#0 = nEmpresa;
   #0#1 = enEjercicio;
   |LEE 141#0=;
   nEstado = FSalida;

   #caportad#0 = #48#2;
   #caportad#1 = #48#26;
   |LEE 000#caportad.=;
   |SI FSalida = 0;
       #casoplib#0 = #48#2;
       |SI #48#26 < 80;
           #casoplib#1 = 2000 + #48#26;
       |SINO;
           #casoplib#1 = 1900 + #48#26;
       |FINSI;
       #casoplib#3 = #caportad#13;
       #casoplib#2 = #caportad#2;
       NombreTotal = #caportad#2;
       |HAZ SeparaNombre;
       aAlfa = #casoplib#3; |QBF aAlfa; aAlfa = aAlfa % 0101;
       |SI aAlfa = "A"; |O aAlfa = "B"; |O aAlfa = "E";
           aApell1 = ""; aApell2 = "";
       |FINSI;
       |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
           #casoplib#4 = Nombre;
           #casoplib#5 = aApell1;
           #casoplib#6 = aApell2;
      |SINO;
           #casoplib#4 = NombreTotal;
           #casoplib#5 = "";
           #casoplib#6 = "";
      |FINSI;

      Comodin = #caportad#3;
      Comodin1 = #caportad#4; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#5; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#6; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#7; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#8; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      #casoplib#7  = Comodin;
      #casoplib#8  = (("00" + #caportad#9) % -102) + (("000" + #caportad#10) % -103);
      #casoplib#9  = #caportad#11;
      #casoplib#10 = #caportad#12;
      #casoplib#11 = #caportad#14;

      #casoplib#13 = #caportad#38;
      #casoplib#14 = #caportad#39;
      NombreTotal = #caportad#39;
      |HAZ SeparaNombre;
      |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
         #casoplib#14 = Nombre;
         #casoplib#15 = aApell1;
         #casoplib#16 = aApell2;
      |SINO;
          #casoplib#14 = NombreTotal;
          #casoplib#15 = "";
          #casoplib#16 = "";
      |FINSI;
      Comodin = #caportad#40;
      Comodin1 = #caportad#41; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#42; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#43; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#44; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      Comodin1 = #caportad#45; |QBF Comodin; |QBF Comodin1; Comodin = Comodin + " " + Comodin1;
      #casoplib#17  = Comodin;
      #casoplib#18  = (("00" + #caportad#47) % -102) + (("000" + #caportad#48) % -103);
      #casoplib#19 = #caportad#49;
      #casoplib#20 = #caportad#50;
      #casoplib#21 = #caportad#46;
   |SINO;
      |MENAV "    Atencion. No existen Datos en Portada Modelos";
      #casoplib#0 = #48#2;
      |SI #48#26 < 80;
          #casoplib#1 = 2000 + #48#26;
      |SINO;
          #casoplib#1 = 1900 + #48#26;
      |FINSI;
      #casoplib#3 = #48#8;
      #casoplib#2 = #48#1;
      NombreTotal = #48#1;
      |HAZ SeparaNombre;
      aAlfa = #casoplib#3; |QBF aAlfa; aAlfa = aAlfa % 0101;
      |SI aAlfa = "A"; |O aAlfa = "B"; |O aAlfa = "E";
          aApell1 = ""; aApell2 = "";
      |FINSI;
      |SI Nombre ! ""; |Y aApell1 ! ""; |Y aApell2 ! "";
         #casoplib#4 = Nombre;
         #casoplib#5 = aApell1;
         #casoplib#6 = aApell2;
      |SINO;
          #casoplib#14 = NombreTotal;
          #casoplib#15 = "";
          #casoplib#16 = "";
      |FINSI;
   |FINSI;

   |SI #11#18 = "S";
         |PARA nPara1 = 13; |SI nPara1 [ 22; |HACIENDO nPara1 = nPara1 + 1;
               nPara2 = nPara1 + 6;
               #casoplib#nPara1# = #11nPara2;
         |SIGUE;
         #casoplib#39 = #11#29;
   |FINSI;

    |DBASS Comodin; |QBF Comodin;
    Comodin = Comodin + "agicli/fich/";
    |PATH_DAT #500 Comodin;
    |PATH_DAT #516 Comodin;

    nSociedad = 0;
    |DDEFECTO #agim0019;
    |ABRE #agim0019;
    #agim0019#0 = nEmpresa;
    #agim0019#1 = 99;
    |LEE 000#agim0019.];
    |SI FSalida = 0;
         |LEE 000#agim0019.a;
    |SINO;
         |LEE 000#agim0019.u;
    |FINSI;
    |SI FSalida ! 0;|O #agim0019#0 ! nEmpresa;
        |DDEFECTO #agim0019;
        nSociedad = 0;
    |SINO;
        nSociedad = #agim0019#1;
    |FINSI;
    |CIERRA #agim0019;

    |SI nSociedad ! 0;
        #casoplib#37 = #agim0019#91;
        #casoplib#23 = #agim0019#29;
        #casoplib#24 = #agim0019#30;
        #casoplib#25 = #agim0019#31;
        #casoplib#26 = #agim0019#32;
        #casoplib#27 = #agim0019#25;
        #casoplib#31 = #agim0019#33;
    |SINO;
        |SI HayAgicli = 1;
            |ABRE #agim0056;
            |SELECT #2#agim0056;
            #agim0056#3 = #casoplib#10;
            |LEE 041#agim0056.=;
            |SI FSalida = 0;
                #casoplib#37 = #agim0056#0;
            |FINSI;
            |SELECT #1#agim0056;
            |CIERRA #agim0056;
        |FINSI;
    |FINSI;

    #casoplib#28 = ("000" + nNumLibros) % -103;
    |PULSATECLA;
|FPRC;

|PROCESO ObtenNombre;
   Comodin1 = "";
   aLong = Nombre % 0; nLong = aLong;
   |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
      Calc = -((nCont * 100) + 1);
      Caracter = Nombre % Calc;
      |SI Caracter = "/";
         |SAL;
      |SINO;
         Comodin1 = Caracter + Comodin1;
      |FINSI;
   |SIGUE;
   Nombre = Comodin1;
|FPRC;

|PROCESO Fecha;
   |SI aMes = "Ultimo"; |O aMes = "Tercero"; |O aMes = "Sexto";
    |O aMes = "Noveno";
      |SI #48#12 ! 12;
         Calc = aAnyo; Calc = Calc + 1; aAnyo = ("00" + Calc) % -102;
      |FINSI;
   |FINSI;
   |SI aAnyo ] "80";
      aAnyo = "19" + aAnyo;
   |SINO;
      aAnyo = "20" + aAnyo;
   |FINSI;
   |SI aMes = "Primero"; aMes = ("00" + #48#11) % -102; |FINSI;
   |SI aMes = "Tercero"; aMes = ("00" + (#48#11+3)) % -102; |FINSI;
   |SI aMes = "Sexto";   aMes = ("00" + (#48#11+6)) % -102; |FINSI;
   |SI aMes = "Noveno";  aMes = ("00" + (#48#11+9)) % -102; |FINSI;
   |SI aMes = "Ultimo";  aMes = ("00" + #48#12) % -102; |FINSI;
   |SI aDia = "Primero"; aDia = "01"; |FINSI;
   |SI aDia = "Ultimo";
      |SI aMes = "02";
         |SI aAnyo = "80"; |O aAnyo = "84"; |O aAnyo = "88"; |O aAnyo = "92";
          |O aAnyo = "96"; |O aAnyo = "04"; |O aAnyo = "08"; |O aAnyo = "12";
          |O aAnyo = "16"; |O aAnyo = "20"; |O aAnyo = "24"; |O aAnyo = "28";
            aDia = "29";
         |SINO;
            aDia = "28";
         |FINSI;
      |SINO;
         |SI aMes = "01"; |O aMes = "03"; |O aMes = "05"; |O aMes = "07";
          |O aMes = "08"; |O aMes = "10"; |O aMes = "12";
            aDia = "31";
         |SINO;
            aDia = "30";
         |FINSI;
      |FINSI;
   |FINSI;
   ComFecha = aDia + "." + aMes + "." + aAnyo;
|FPRC;

|PROCESO SeparaNombre;
     Comodin = NombreTotal; |QBF Comodin;

     Nombre = ""; aApell1 = ""; aApell2 = "";
     Comodin = Comodin - " ";
     |SI FSalida ! 0;
          nParte1 = FSalida;
          Comodin = Comodin - ",";
          |SI FSalida ! 0;
               nParte2 = FSalida + 98;
               Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
               nParte1 = nParte1 + 98;
               aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
               aApell1 = Comodin;
          |SINO;
               Comodin = Comodin - " ";
               |SI FSalida ! 0;
                    nParte2 = FSalida + 98;
                    Nombre = Comodin % nParte2; Comodin = Comodin - Nombre; |QBF Nombre;
                    nParte1 = nParte1 + 98;
                    aApell2 = Comodin % nParte1; Comodin = Comodin - aApell2; |QBF aApell2;
                    aApell1 = Comodin;
               |FINSI;
          |FINSI;
     |FINSI;

     |QBF Nombre; |QBF aApell1; |QBF aApell2;

     |SI Nombre ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = Nombre % 0101;
               |SI Comodin = " "; Nombre = Nombre - " "; |FINSI;
          |SIGUE;
     |FINSI;

     |SI aApell1 ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = aApell1 % 0101;
               |SI Comodin = " "; aApell1 = aApell1 - " "; |FINSI;
          |SIGUE;
     |FINSI;

     |SI aApell2 ! "";
          Comodin = " ";
          |PARA; |SI Comodin = " "; |HACIENDO;
               Comodin = aApell2 % 0101;
               |SI Comodin = " "; aApell2 = aApell2 - " "; |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;


|PROCESO GrabaLinea;
   aAlfa = Comodin; |QBF aAlfa;
   |SI aAlfa ! "";
       Comodin = Handle + " " + aCasilla + Comodin + &13 + &10;
       |FGRABA Comodin;
   |FINSI;
|FPRC;

|PROCESO CreaSecuenciales;
    |DBASE Directorio; |QBF Directorio;
    Directorio = Directorio + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";

    Comodin = "wb  " + Directorio + "desc.txt";
    |FABRE Comodin;
    |SI FSalida ] 0;
        Comodin = Handle + " " + #casoplib#2 + &13 + &10;  |FGRABA Comodin;

        Comodin = #0#1;
        Comodin = Handle + " " + "Ejercicio=" + Comodin + &13 + &10;  |FGRABA Comodin;

        |SI nSociedad ! 0;
            Comodin = Handle + " TipoPersona=J" + &0;  |FGRABA Comodin;
        |SINO;
            Comodin = Handle + " TipoPersona=F" + &0;  |FGRABA Comodin;
        |FINSI;
        FSalida = Handle; |FCIERRA FSalida;
    |FINSI;

    Comodin = "wb  " + Directorio + "nombres.txt";
    |FABRE Comodin;
    |SI FSalida ] 0;
         Handle = FSalida; Nombre = "";
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
         Comodin1 = Comodin1 + "*.*";
         |_PDIR Comodin1;
         |SI FSalida = 0;
            |PARA; |SI FSalida = 0; |HACIENDO;
               aLong = Comodin1 % 0; nLong = aLong;

               |HAZ VerBueno;
               |SI nBueno ! 0;
                   |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                         Calc = -((nCont * 100) + 1);
                         Caracter = Comodin1 % Calc;
                         |SI Caracter = "/";
                             |SAL;
                         |SINO;
                             Nombre = Caracter + Nombre;
                         |FINSI;
                   |SIGUE;

                   Nombre = Nombre > " ";
                   Nombre = Handle + " " + Nombre + &13 + &10; |FGRABA Nombre;
                   Nombre = "";
               |FINSI;
               |_SDIR Comodin1;
            |SIGUE;
         |FINSI;
         FSalida = Handle;
         |FCIERRA FSalida;
      |SINO;
         |MENAV "    Problemas al crear el secuencial de nombres";
         nErrorSec = 1;
         |ACABA;
      |FINSI;

      Comodin = "wb  " + Directorio + "datos.txt";
      |FABRE Comodin;
      |SI FSalida ] 0;
         Handle = FSalida;

          aCasilla = "100"; Comodin = #casoplib#10;
          |QBF Comodin;
          |HAZ GrabaLinea; || Provincia Presentacion
          Comodin = #casoplib#30; |QBF Comodin;
          Comodin = Comodin - "."; Comodin = Comodin - ".";
          aCasilla = "101";                         |HAZ GrabaLinea; || Fecha solicitud
          aCasilla = "102"; Comodin = #casoplib#4;  |HAZ GrabaLinea; || Nombre Empresario
          aCasilla = "103"; Comodin = #casoplib#5;  |HAZ GrabaLinea; || 1 Apellido Empresario
          aCasilla = "104"; Comodin = #casoplib#6;  |HAZ GrabaLinea; || 2 Apellido Empresario
          aCasilla = "105"; Comodin = #casoplib#3;  |HAZ GrabaLinea; || NIF Empresario
          aCasilla = "106"; Comodin = #casoplib#7;  |HAZ GrabaLinea; || Direccion Empresario
          aCasilla = "107"; Comodin = #casoplib#9;  |HAZ GrabaLinea; || Localidad Empresario
          aCasilla = "108"; Comodin = #casoplib#8;  |HAZ GrabaLinea; || C.P. Empresario
          aCasilla = "109"; Comodin = (#casoplib#8 % 0102); |HAZ GrabaLinea; || Cod.Provincia Empresario
          aCasilla = "110"; Comodin = #casoplib#12; |HAZ GrabaLinea; || Fax Empresario
          aCasilla = "111"; Comodin = #casoplib#11; |HAZ GrabaLinea; || Telefono Empresario

          aCasilla = "112"; Comodin = "";
          |SI #casoplib#37 ! 0;
              Comodin = ("00000" + #casoplib#37) % -105;
          |FINSI;
          |HAZ GrabaLinea; || Codigo de Registro

          aCasilla = "201"; Comodin = #casoplib#23; |HAZ GrabaLinea; || N§ Tomo Registro
          aCasilla = "202"; Comodin = #casoplib#24; |HAZ GrabaLinea; || N§ Libro Registro
          aCasilla = "203"; Comodin = #casoplib#25; |HAZ GrabaLinea; || N§ Seccion Registro
          aCasilla = "204"; Comodin = #casoplib#26; |HAZ GrabaLinea; || N§ Folio Registro
          aCasilla = "205"; Comodin = "REGISTRO MERCANTIL"; |HAZ GrabaLinea; || Tipo Registro Publico
          || ...  aCasilla = "205"; Comodin = #casoplib#27; |HAZ GrabaLinea; || Tipo Registro Publico
          aCasilla = "206"; Comodin = #casoplib#31; |HAZ GrabaLinea; || N§ Hoja Registro
          aCasilla = "207"; Comodin = #casoplib#38; |HAZ GrabaLinea; || Otros (Datos Registrables)

          aCasilla = "301"; Comodin = #casoplib#14; |HAZ GrabaLinea; || Nombre Representante
          aCasilla = "302"; Comodin = #casoplib#15; |HAZ GrabaLinea; || 1 Apellido Representante
          aCasilla = "303"; Comodin = #casoplib#16; |HAZ GrabaLinea; || 2 Apellido Representante
          aCasilla = "304"; Comodin = #casoplib#13; |HAZ GrabaLinea; || DNI Representante
          aCasilla = "305"; Comodin = #casoplib#17; |HAZ GrabaLinea; || Direccion Representante
          aCasilla = "306"; Comodin = #casoplib#19; |HAZ GrabaLinea; || Localidad Representante
          aCasilla = "307"; Comodin = #casoplib#18; |HAZ GrabaLinea; || C.P. Representante
          aCasilla = "308"; Comodin = #casoplib#20; |HAZ GrabaLinea; || Provincia Representante
          aCasilla = "309"; Comodin = #casoplib#22; |HAZ GrabaLinea; || Fax Representante
          aCasilla = "310"; Comodin = #casoplib#21; |HAZ GrabaLinea; || Telefono Representante
          aCasilla = "311"; Comodin = #casoplib#39; |HAZ GrabaLinea; || Correo Electronico Representante

          aCasilla = "401"; Comodin = #casoplib#29; |HAZ GrabaLinea; || Solicita Retencion

          aCasilla = "501";
          Comodin = ("000" + #casoplib#28) % -103;  |HAZ GrabaLinea; || Numero libros presentados

         Numeracion = 1;
         |DBASE Comodin1; |QBF Comodin1;
         Comodin1 = Comodin1 + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
         Comodin1 = Comodin1 + "*.*";
         |_PDIR Comodin1;
         |SI FSalida = 0;
             |PARA; |SI FSalida = 0; |HACIENDO;
               aLong = Comodin1 % 0; nLong = aLong;

               |HAZ VerBueno;
               |SI nBueno ! 0;

                   |PARA nCont = 1; |SI nCont [ nLong; |HACIENDO nCont = nCont + 1;
                       Calc = -((nCont * 100) + 1);
                       Caracter = Comodin1 % Calc;
                       |SI Caracter = "/";
                          |SAL;
                       |SINO;
                          Nombre = Caracter + Nombre;
                       |FINSI;
                   |SIGUE;
                   |SI nBueno = 1;
                       Comodin3 = Nombre % -107; Nombre = Nombre - Comodin3;
                   |SINO;
                       Comodin3 = Nombre % -108; Nombre = Nombre - Comodin3;
                   |FINSI;
                   Comodin3 = Comodin3 % 0103;
                   aNumer = ("000" + Numeracion) % -103;
                   Numeracion = Numeracion + 1;
                   Nombre = Nombre > Nombre;
                   |SI Nombre = "DIARIO_";
                       Comodin2 = Handle + " " + aNumer + "01Diario                          " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "INV_CUEN_";
                       Comodin2 = Handle + " " + aNumer + "01Inventario y cuentas anuales    " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "BAL_SUMS_";
                       Comodin2 = Handle + " " + aNumer + "01Balance comprob.sumas y saldos  " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "FAC_EMIT_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de facturas emitidas      " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "FAC_RECI_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de facturas recibidas     " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "MEMORIA_";
                       Comodin2 = Handle + " " + aNumer + "01Memoria                         " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "GESTION_";
                       Comodin2 = Handle + " " + aNumer + "01Memoria                         " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;

                   |SI Nombre = "ACCIONES_";
                       Comodin2 = Handle + " " + aNumer + "01Registro de Acciones Nominativas" + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "SOCIOS_";
                       Comodin2 = Handle + " " + aNumer + "01Registro de Socios              " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "ACTASCON_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de Actas                  " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "ACTASDET_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de Detalle de Actas       " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "ACTALCON_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de Actas del Consejo      " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "ACTACODE_";
                       Comodin2 = Handle + " " + aNumer + "01Libro de Detalle de Actas del Consejo " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "SOCUNICO_";
                       Comodin2 = Handle + " " + aNumer + "01Libro-registro de Contratos del Socio Unico con la Sociedad Unipersonal" + &13 + &10; |FGRABA Comodin2;
                   |FINSI;
                   |SI Nombre = "OTROS_";
                       Comodin2 = Handle + " " + aNumer + "01Otros                           " + &13 + &10; |FGRABA Comodin2;
                   |FINSI;

                   Comodin2 = Handle + " " + aNumer + "02" + Comodin3 + &13 + &10; |FGRABA Comodin2;
                   aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
                   |HAZ Fecha;
                   ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                   Comodin2 = Handle + " " + aNumer + "03" + ComFecha + &13 + &10; |FGRABA Comodin2;
                   aDia = "Ultimo"; aMes = "Ultimo"; aAnyo = (("00" + #48#26) % -102);
                   |HAZ Fecha;
                   ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                   Comodin2 = Handle + " " + aNumer + "04" + ComFecha + &13 + &10; |FGRABA Comodin2;
                   aDia = "01"; aMes = "Primero"; aAnyo = (("00" + #48#26) % -102);
                   |HAZ Fecha;
                   Fecha = ComFecha; NumFecha = Fecha; NumFecha = NumFecha - 1; Fecha = NumFecha; ComFecha = Fecha;
                   ComFecha = ComFecha - "."; ComFecha = ComFecha - ".";
                   Comodin2 = Handle + " " + aNumer + "05" + ComFecha + &13 + &10; |FGRABA Comodin2;
                   Nombre = "";
               |FINSI;
               |_SDIR Comodin1;
            |SIGUE;
         |FINSI;

         FSalida = Handle;
         |FCIERRA FSalida;
      |SINO;
         |MENAV "    Problemas al crear el secuencial de nombres";
         nErrorSec = 1;
      |FINSI;
|FPRC;

|PROCESO Libros;
     nNume1 = #casoplib#28;
     #casoplib#28 = ("000" + nNume1) % -103;
     |PINTA #casoplib#28;
|FPRC;

|PROCESO aBajaC56;
   #agim0056#0 = "00000";
|FPRC;

|PROCESO aAltaC56;
   #agim0056#0 = "99999";
|FPRC;

|PROCESO CodReg;
     |SI FSalida = 10; |Y HayAgicli = 1;
         |ABRE #agim0056;
         #agim0056#0 = #casoplib#Campo#;
         |CONSULTA_F_CLAVE #1#agim0056, aBajaC56, aAltaC56;
         |CIERRA #agim0056;
         #casoplib#Campo# = #agim0056#0;
         |PINTA #casoplib#Campo#;
     |FINSI;
|FPRC;

|PROCESO Empresas;

   #48#2 = #cabucem1#0;
   #48#3 = #cabucem1#1;
   |LEE 000#48=;
   |SI FSalida = 0;

      |HAZ CuentaLibros;

      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "fich/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |PATH_DAT #2 Comodin;

      |ABRE #caportad;
      |HAZ MiraCabecera;
      |CIERRA #caportad;

      |PUSHV 0501 2380;
      |PINPA #0#casoplib;
      |PINDA #0#casoplib;

      nSalir = 1;
      |PARA; |SI nSalir ! 0; |HACIENDO;
             |ENDATOS #1#casoplib;
             nSalir = FSalida;
      |SIGUE;
      |SI nEstado = 0; |GRABA 020#casoplib.a; |FINSI;
      |SI nEstado ! 0; |GRABA 020#casoplib.n; |FINSI;
      |LIBERA #casoplib;
      |POPV;

      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
      |HAZ CreaSecuenciales;
      |PULSATECLA;
   |FINSI;
|FPRC;

|DEFBUCLE Empresas;
   #cabucem1#1;
   ;
   INICIO;
   FINAL;
   ;
   NULL,Empresas;
|FIN;

|PROCESO PasaFicheros;
   |DBASE aOrigen; |QBF aOrigen;
   aOrigen = aOrigen + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/*.*";
   Comodin = aOrigen - "*.*";
   |_PDIR aOrigen;
   |PARA; |SI FSalida = 0; |HACIENDO;
      aDestino = aPath + ((("00000" + #cabucem1#0) % -105) + #cabucem1#1) + "/";
      |RMKDIR aDestino;
      aDestino = aDestino + (aOrigen - Comodin);
      |SI Local = 0;
         |ENVIA_FICHERO aOrigen, aDestino;
      |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
      |FINSI;
      |FBORRA aOrigen;
      |_SDIR aOrigen;
   |SIGUE;
   |RMDIR Comodin;
|FPRC;

|DEFBUCLE PasaFicheros;
    #cabucem1#1;
    ;
    INICIO;
    FINAL;
    ;
    NULL,PasaFicheros;
|FIN;

|PROCESO Proceso14;

   |PULSATECLA;
   |QBF aPath;

   |ABRE #48;
   |ABRE #0;
   |BUCLE Empresas;
   |CIERRA #0;
   |CIERRA #48;

   Comodin = ""; |IP_REMOTO Comodin; |QBF Comodin;
   |SI Comodin = "";
      Local = 1;
   |SINO;
      Local = 0;
   |FINSI;

   Comodin = aPath % -101;
   |SI Comodin ! "/";
      |SI Comodin ! "\";
         aPath = aPath + "/";
      |FINSI;
   |FINSI;

   nErrorSec = 0;
   |BUCLE PasaFicheros;
   |PULSATECLA;

   |SI nErrorSec = 0;
       |MENAV "    Ficheros creados satisfactoriamente";
   |FINSI;

|FPRC;

|PROCESO Proceso15;
   Calc = 1;
   |PULSATECLA;
   |PTEC 801;
|FPRC;

|| ..........................
|PROCESO ReponBotones;
   |MENAV "0000Proceso terminado.";
|FPRC;

|PROCESO Borrado;

   |SI aBorro = "S";
       Comodin = aPath + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";

       Comodin1 = Comodin + "datos.txt";   |RFBORRA Comodin1;
       Comodin1 = Comodin + "nombres.txt"; |RFBORRA Comodin1;
       Comodin1 = Comodin + "desc.txt";    |RFBORRA Comodin1;

       |PARA nCont = 1; |SI nCont [ 10; |HACIENDO nCont = nCont + 1;
             Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xls";
             |RFBORRA Comodin1;
             Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".xlsx";
             |RFBORRA Comodin1;

             Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xls";
             |RFBORRA Comodin1;
             Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".xlsx";
             |RFBORRA Comodin1;

             Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xls";
             |RFBORRA Comodin1;
             Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".xlsx";
             |RFBORRA Comodin1;

             Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xls";
             |RFBORRA Comodin1;
             Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".xlsx";
             |RFBORRA Comodin1;

             Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xls";
             |RFBORRA Comodin1;
             Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".xlsx";
             |RFBORRA Comodin1;

             Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".doc";
             |RFBORRA Comodin1;
             Comodin1 = Comodin + "MEMORIA_" + (("000" + nCont) % -103) + ".docx";
             |RFBORRA Comodin1;

              Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "GESTION_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xls";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".xlsx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".doc";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".docx";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "DIARIO_"   + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "BAL_SUMS_"  + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "INV_CUEN_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "FAC_EMIT_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "FAC_RECI_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;

              Comodin1 = Comodin + "OTROS_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACCIONES_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "SOCIOS_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTASCON_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTASDET_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTALCON_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "ACTACODE_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
              Comodin1 = Comodin + "SOCUNICO_" + (("000" + nCont) % -103) + ".pdf";
              |RFBORRA Comodin1;
       |SIGUE;

       |RRMDIR Comodin;
   |FINSI;

   |SI aBorroS = "S";
      |DBASE aOrigen; |QBF aOrigen;
      aOrigen = aOrigen + "hacienda/PresLibr/" + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/*.*";
      Comodin = aOrigen - "*.*";
      |_PDIR aOrigen;
      |PARA; |SI FSalida = 0; |HACIENDO;
             |FBORRA aOrigen;
             |_SDIR aOrigen;
      |SIGUE;
      |RMDIR Comodin;

       |DFICB Comodin1; |QBF Comodin1;
       Comodin1 = Comodin1 + (("00000" + #cabucem1#0) % -105) + #cabucem1#1 + "/";
       |CIERRA #12;|PATH_DAT #12 Comodin1;
       nSwOp1 = 0; |BUCLE casoplil;

   |FINSI;
|FPRC;

|DEFBUCLE Borrado;
   #cabucem1#1;
   ;
   INICIO;
   FINAL;
   ;
   NULL,Borrado;
|FIN;

|| ............................................................
|PROCESO QuitaExcel;
     |SI enBasImp ! 0;  |ACABA; |FINSI;
     Comodin = "0,9," + aImpre;
     |MENUITEM 0,Comodin;
|FPRC;

|PROCESO PonExcel;
   Comodin = "0,9,1";
   |MENUITEM 0,Comodin; EstadoAnt = FSalida;
   aEstado = FSalida;
   |SI FSalida = "UNCHECKED";
      Comodin = "0,9,0";
      |MENUITEM 0,Comodin;
      aImpre  = "0";
   |SINO;
      aImpre = "1";
   |FINSI;
   |SI aEstado = "CHECKED";  |O aEstado = "UNCHECKED";
       enBasImp = 0;  || .... BASICO 9
       eaNomImp = "";
   |SINO;
       enBasImp = 1;  || .... BASICO 9 - 10
       eaNomImp = "ExcelEstandard";
  |FINSI;
|FPRC;

|| ............................................
|PROCESO CargaArbol;
     aAlfa = aAlfa + &13 + &10;

     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO LosBotones;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "/tmp";  |MKDIR aAlfa;

     |DFICE aAlfa;
     aAbre = aAlfa + "men" + Usuario + ".txt";
     |XABRE "WB", aAbre, nHandle;

     aAlfa = "Diario Ampliado";                          |HAZ CargaArbol;
     aAlfa = "Inventario y cuentas anuales";             |HAZ CargaArbol;
     aAlfa = "Diario Resumido";                          |HAZ CargaArbol;
     aAlfa = "Facturas Emitidas";                        |HAZ CargaArbol;
     aAlfa = "Facturas Recibidas";                       |HAZ CargaArbol;
     aAlfa = "Incorporar Otros Libros: Actas y socios";  |HAZ CargaArbol;
     aAlfa = "Generar ficheros";                         |HAZ CargaArbol;
     aAlfa = "Salir";                                    |HAZ CargaArbol;

     |XCIERRA nHandle;

     nOpcion     = 1;
     nTotalLinea = 0;
     nConta      = -1;
     nBaffer     = 0;

     |LEESECUENCIAL aAbre, nBaffer, nTotalLinea, 0, 0;

     nOpcion = 1;
     |PARA; |SI;  |HACIENDO;
          |BMENUG nBaffer, 0, 1, nTotalLinea, 20, nOpcion;
          nOpcion     = FSalida;
          nCogeOpcion = nOpcion - 1;
          |SI FSalida [ nTotalLinea; |Y FSalida ] 1;
              |DEL_BUF nBaffer, nCogeOpcion, aDestino;

              |SI nOpcion = 1;  |HAZ Proceso01;  |FINSI;
              |SI nOpcion = 2;  |HAZ Proceso02;  |FINSI;
              |SI nOpcion = 3;  |HAZ Proceso07;  |FINSI;
              |SI nOpcion = 4;  |HAZ Proceso10;  |FINSI;
              |SI nOpcion = 5;  |HAZ Proceso11;  |FINSI;
              |SI nOpcion = 6;  |HAZ Proceso17;  |FINSI;
              |SI nOpcion = 7;  |HAZ Proceso14;  |FINSI;
              |SI nOpcion = 8;  |HAZ Proceso15;  |FINSI;

              |SI nOpcion = nTotalLinea;  |SAL;  |FINSI;
         |FINSI;
     |SIGUE;

     |FBORRA aAbre;
|FPRC;

|| ////////////////////////////////////////////////////////////
|PROCESO DePresentador;
     aAlfa = #11#18;
     |C_M #11#19, 1, aAlfa;
     |C_M #11#20, 1, aAlfa;
     |C_M #11#21, 1, aAlfa;
     |C_M #11#22, 1, aAlfa;
     |C_M #11#23, 1, aAlfa;
     |C_M #11#24, 1, aAlfa;
     |C_M #11#25, 1, aAlfa;
     |C_M #11#26, 1, aAlfa;
     |C_M #11#27, 1, aAlfa;
     |C_M #11#28, 1, aAlfa;
     |C_M #11#29, 1, aAlfa;
     |C_M #11#30, 1, aAlfa;
     |C_M #11#31, 1, aAlfa;
|FPRC;

|PROCESO Letra_0;  |TIPO 6;
     |SI FSalida = 9;
         eaVarDni   = #11Campo;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #11Campo = eaVarDni;
         |PINTA #11Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #11Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #11Campo;  |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #11Campo = eaVarDni;  |PINTA #11Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|CALCULO CPPresentador;
   aAlfa1 = ("00"  + #11#30) % -102;
   aAlfa2 = ("000" + #11#31) % -103;
   #11#24 = aAlfa1 + aAlfa2;
|FCAL;

|PROCESO CampoPath;
    nInkey = FSalida;
    |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        aAlfa1 = aAlfa1 % 280;
        #11#1 = aAlfa1;
        |PINTA #11#1;
    |FINSI;
    aAlfa1 = #11#1;
    |QBF aAlfa1;
    aAlfa2 = aAlfa1 % -101;
    |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
         #11#1 = aAlfa1 + "\";
         |PINTA #11#1;
    |FINSI;
|FPRC;

|PROCESO aMemoria;
  |SI #11#2 = "S";
      |ATRI P; |PINTA 1913 , " Incluir Datos Socios Memorias Anteriores a 2008  "; |ATRI N;
      |C_V #11#5, 1, "S"; |C_M #11#5, 1, "S";
      |PINTA #11#5;
  |SINO;
      |C_V #11#5, 1, "N"; |C_M #11#5, 1, "N";
      |PINTA 1913 , "                                                  ";
  |FINSI;
|FPRC;

|PROCESO Datos; |TIPO 12;
   |HAZ CPPresentador;
|FPRC;

|PROCESO VeoRegMer;

     |SI HayAgicli = 1;
         nSw = 0;
         |ABRE #agim0056;
         |LEE 040#agim0056.p;
         |SI FSalida ! 0;
             nSw = 1;
         |SINO;
             #agim0056#0 = "02010";
             |LEE 041#agim0056.=;
             |SI FSalida ! 0;
                 nSw = 1;
             |SINO;
                 aAlfa = #agim0056#1; |QBF aAlfa;
                 |SI aAlfa ! "ALBACETE";  nSw = 1; |FINSI;
             |FINSI;
         |FINSI;
         |CIERRA #agim0056;

         |SI nSw = 1;
             |SUB_EJECUTA_NP ":agicli/instalar;agim0056";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PideVarios;

    aPath = "C:/Progra~1/Adhoc/Legalia/Legalia.exe";
    |XABRE "C", aPath, Handle;
    |SI FSalida < 0;
       aPath = "C:/Archiv~1/Adhoc/Legalia/Legalia.exe";
       |XABRE "C", aPath, Handle;
       |SI FSalida < 0;
          aPath = "C:/Archiv~1/Legalia/Legalia.exe";
          |XABRE "C", aPath, Handle;
          |SI FSalida < 0;
             aPath = "C:/Adhoc/Legalia/Legalia.exe";
             |XABRE "C", aPath, Handle;
             |SI FSalida < 0;
                aPath = "C:/Legalia/Legalia.exe";
             |FINSI;
          |FINSI;
       |FINSI;
    |FINSI;
    aPath = aPath - "Legalia.exe"; aPath = aPath + "Data/";

    |HAZ DirAplicSt;

    |HAZ VeoRegMer;

    |ABRE #11;
    |DDEFECTO #11;
    |LEE 001#11p;
    |SI FSalida ! 0;
        |DDEFECTO #11;
        #11#1 = aPath;
        |GRABA 020#11n;
    |FINSI;
    |CIERRA #11;

     aAnterior = #11#19;
     |PUSHV 0510 2365;
     |PINPA #0#11;
     #11#10 = "N";

/*
     ||  Cuando sea necerario abrir el PDF en Star
     |PINTA 0922, "³ Formato Fichero PDF .....   ³";
     |PINTA 1022, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
     |C_V #11#10, 1, "S"; |C_M #11#10, 1, "S";
*/

     aAlfa1 = #11#2;
     |C_V #11#5,1,aAlfa1;
     |C_M #11#5,1,aAlfa1;
     |SI HaySociedad = 0;
         |C_M #11#2,1,"N";
         #11#2 = "N";
     |FINSI;
     |HAZ aMemoria;

     |PINDA #0#11;
     |ENDATOS #1#11;
     |SI FSalida ! 0;
         nError = 1;
     |SINO;
         Comodin = "";
         |IP_REMOTO Comodin;
         |QBF Comodin;
         |SI Comodin = "";
              Local = 1;
         |SINO;
              Local = 0;
         |FINSI;

         aPath      = #11#1; |QBF aPath;
         aMemoria   = #11#2;
         aSaldoCero = #11#3;
         aApertura  = #11#4;
         eaMemSoc   = #11#5;
         aBorro     = #11#6;
         aBorroS    = #11#15;
         aVerDatos  = #11#7;
         eaUltNiv   = #11#8;
         aMasNombre = #11#9;
         eaFormato  = #11#10;
         efFecLeg   = #11#11;
         eaDatLeg   = #11#12;
         eaPathLeg  = #11#1;
         eaCtasLeg  = #11#13;
         enCtasLeg  = #11#14;
         nVerDat = 0; |SI aVerDatos = "S"; nVerDat = 1; |FINSI;
         enOrdRep   = #11#16;
         enOrdSop   = #11#17;
         aCampo18   = #11#18;
         aCampo19   = #11#19;
         aCampo20   = #11#20;
         aCampo21   = #11#21;
         aCampo22   = #11#22;
         aCampo23   = #11#23;
         aCampo24   = #11#24;
         aCampo25   = #11#25;
         aCampo26   = #11#26;
         aCampo27   = #11#27;
         aCampo28   = #11#28;
         aCampo29   = #11#29;
         nCampo30   = #11#30;
         nCampo31   = #11#31;

         |ABRE #11;
         |LEE 141#11p;
         |SI FSalida ! 0;
             |DDEFECTO #11;
             #11#1 = aPath;
             |GRABA 020#11b;
         |FINSI;
         #11#1  = aPath;
         #11#2  = aMemoria;
         #11#3  = aSaldoCero;
         #11#4  = aApertura;
         #11#5  = eaMemSoc;
         #11#6  = aBorro;
         #11#15 = aBorroS;
         #11#7  = aVerDatos;
         #11#8  = eaUltNiv;
         #11#9  = aMasNombre;
         #11#10 = eaFormato;
         #11#11 = efFecLeg;
         #11#12 = eaDatLeg;
         #11#13 = eaCtasLeg;
         #11#14 = enCtasLeg;
         #11#16 = enOrdRep;
         #11#17 = enOrdSop;
         #11#18 = aCampo18;
         #11#19 = aCampo19;
         #11#20 = aCampo20;
         #11#21 = aCampo21;
         #11#22 = aCampo22;
         #11#23 = aCampo23;
         #11#24 = aCampo24;
         #11#25 = aCampo25;
         #11#26 = aCampo26;
         #11#27 = aCampo27;
         #11#28 = aCampo28;
         #11#29 = aCampo29;
         #11#30 = nCampo30;
         #11#31 = nCampo31;

         |GRABA 020#11a;
         |LIBERA #11;
         |CIERRA #11;
     |FINSI;
     |POPV;

     nNoborro = 1;
     |SI aBorro = "S"; |O aBorroS = "S";
         nNoborro = 0;
     |FINSI;
|FPRC;

|| ///////////////////////////////////////////////////////////////////////////
|PROGRAMA;
   |CLS;
   |CABEZA "Emision de libros para su legalizacion y presentacion telematica";

   nDejaSI = 0;
   |ABRE #caconimp;
   |LEE 101#caconimp.p;
   |SI FSalida ! 0;
        |GRABA 020#caconimp.b;
   |FINSI;
   |SI #caconimp#4 = "S";
        nDejaSI = 1;
   |FINSI;
   #caconimp#4 = "N";
   |GRABA 020#caconimp.a;
   |LIBERA #caconimp;
   |CIERRA #caconimp;

   Empresa = #48#2;
   Periodo = #48#3;
   enEjercicio = #48#26 + 2000;

   |SUB_EJECUTA "cabucemp";

   |ABRE #cabucem1;
   |LEE 000#cabucem1.p;
   |SI FSalida ! 0;
       |CIERRA #cabucem1;
       |MENAV "    Seleccion Vacia";
       |ACABA;
   |FINSI;

   nError = 0;
   |HAZ PideVarios;
   |SI nError = 1;
       |DELINDEX #cabucem1;
       |ACABA;
   |FINSI;

   |SI nNoborro = 0;
       |ABRE #48;
       |BUCLE Borrado;
       |CIERRA #48;
   |FINSI;

   |HAZ LeeUnidadBas;
   |SI eaFormato ! "S";
       |HAZ PonExcel;
   |SINO;
        enBasImp = 1;
        eaNomImp = "CrystalReport";
   |FINSI;

   Comodin = "Path para ficheros : " + aPath;
   |ATRI I; |PINTA 2210, Comodin; |ATRI N;

   |HAZ LosBotones;

|| Aqui lectura del 48

   |SI nDejaSI = 1;
        |ABRE #caconimp;
        |LEE 101#caconimp.p;
        #caconimp#4 = "S";
        |GRABA 020#caconimp.a;
        |LIBERA #caconimp;
        |CIERRA #caconimp;
   |FINSI;

   |SI eaFormato ! "S";
       |HAZ QuitaExcel;
   |FINSI;

   |DELINDEX #cabucem1;
|FPRO;
