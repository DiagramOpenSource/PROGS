|FICHEROS;
    caiivsol #0;
    caconcep #3;         || conceptos
    cacuenta #4;         || plan contable
    cacuivli #5;         || cuentas IVA
    cacoivli #6;         || contrapartidas IVA
    caclipro #7;         || clientes/ proveedores
    caivasop #8;         || historico iva soportado

    caivases #9,MANTE;
    calibros #10;        || libros
    caivaasi #11;

    camacc12 #512;
    camaccw1 #599;
|FIN;

|VARIABLES;
    &eaConDes = "";
    &orant    = 0;
    &entrada  = 1;
    igual     = 0;
    men2      = "     Longitud de Cuenta Fuera de Nivel !";
    men3      = "      Esta Cuenta NO tiene Pase directo";
    long      = "  ";
    cta       = 0;
    num       = 0;
    sw        = 0;
    ctanum    = 0;
    ctaalf    = "";
    longnum   = "";
    &seant    = "";
    &liant    = 0;
    &feant    = @;
    &cuant    = "";
    &diant    = 0;
    &coant    = 0;
    &deant    = "";
    &giant    = 0;
    &noant    = "";
    &ciant    = "";
    &foant    = @;
    &peant    = 0;
    trasum    = 0;
    tipito    = 0;
    &dig3     = 0;
    &dig4     = 0;
    &dig5     = 0;
    &dig6     = 0;
    &dig7     = 0;
    &dig8     = 0;
    &dig9     = 0;
    &fec1     = @;
    &fec2     = @;
    fiac      = "  ";
    guarda    = "  ";
    relleno   = "                                       ";
    aponer    = "  ";
    traba1    = "";
    traba2    = "";
    alfa1     = "";
    alfa2     = "";
    alfa3     = "";
    alfa4     = "";
    nume1     = 0;
    nume2     = 0;
    nume3     = 0;
    nume4     = 0;
    salidas   = 0;
    inkey     = 0;
    guarda_12 = 0;

    letra     = "";
    final     = "";
    x         = "";
    lugar     = 0;
    nifnum    = 0;
    resto     = 0;

    ccuen     = "";
    paso      = 0;
    trim1     = @;
    trim2     = @;
    trim3     = @;
    &ctr10    = "";
    &ctr35    = "";
    &ctr36    = "";

    SerieAnt  = "";
    ComodNum  = 0;
    ModoEntrada = 0;
    NumSopor  = 0;
    Libro     = 0;
    Serie     = "";
    Factura   = 0;
    LineaBase = 0;
    FactAnt   = 0;

    &EURO     = 1;
    &EURODB   = 0;
    &EURODV   = 0;
    &EUROTEXTO = "Cambio de Moneda";

    &swOperacion = 0;  || 0 = Lectura / 1 = Alta
    &enEmpresa = 0;
    &enPeriodo = 0;
    &eaMoneda  = "";

    aNifQbf1   = "";
    aNifQbf2   = "";
    &eaVarDni  = "";
    &enCalcCif = 0;

    aFichero   = "";

     nMod          = 0;
     nOk           = 0;

     &eaSiiPro     = "";
     &enSiiLib     = 0;
     &eaSiiDoc     = "";
     &enSiiDoc     = 0;
     &eaSiiSer     = "";
     &enSiiLin     = 0;
     &enSiiIva     = 0;
     &enSiiMod     = 0;
     &eaSiiCta     = "";
     &eaSiiDig     = "";
     &eaSiiCpt     = "";
     &eaSiiDes     = "";
     &enSiiL       = 0;
     &eaSiiEje     = "";
     &enSiiPer     = 0;
     &enSiiRet     = 0;
     &enSiiUlt     = 0;
     &eaSiiCIF     = "";
     &enSiiCtr     = 0;
     &eaSiiCtr     = "";
|FIN;

|INCLUYE puntos_i;
|INCLUYE varcaj_i;
|INCLUYE varnue_i;

|PROCESO T12; |TIPO 12;       ||Desde Campo Linea
     |SI #caiivsol#3 > 1;  |ACABA;  |FINSI;

     nOk = 0;
     |SI #caivaasi#51 = "S";  nOk = 1; |FINSI;

     |SI nOk = 0;  |ACABA;  |FINSI;

     eaSiiPro = "caiivsol";
     enSiiLib = #caiivsol#0;
     eaSiiDoc = #caiivsol#1;
     enSiiDoc = #caiivsol#2;
     eaSiiSer = #caiivsol#30;
     enSiiLin = 0;
     eaSiiCpt = #caiivsol#7;
     eaSiiCta = #caiivsol#5;
     eaSiiDig = #caiivsol#6;
     eaSiiCIF = #caiivsol#29;  |QBF eaSiiCIF;
     eaSiiDes = #caiivsol#8;
     eaSiiEje = #caiivsol#4 % -104;
     enSiiPer = #caiivsol#31;
     enSiiUlt = 1;
     eaSiiCtr = #caiivsol#27;

     |SUB_EJECUTA "casiim01";
|FPRC;

|CALCULO SinBarra; |TIPO 5;
   FSalida = "SINBARRA";

   aFichero = "wc" + Usuario;
   |NOME_DAT #599 aFichero;
   |DELINDEX #599;
   eaFicCaja = aFichero;
   aTipoIVA  = "S";
|FCAL;

|CALCULO Tipo13; |TIPO 13;
  |PINTA 1160, "                    ";
  |SI eaConDes = "N"; |ACABA; |FINSI;

  ModoEntrada = (FEntrada / 100) ! 0;
  |SI ModoEntrada = 1; |ACABA; |FINSI;
  |ABRE #3;
  #3#0 = #0#7;
  |LEE 040#3=;
  |SI FSalida = 0;
      alfa1 = #3#1 % 120;
      |ATRI S; |PINTA 1160, alfa1;|ATRI 0;
  |FINSI;
  |CIERRA #3;
|FCAL;

|PROCESO entrada;
  |ABRE #8;
  #8#0 = #0#0;
  #8#27 = #0#30;
  #8#2 = 999999;
  |LEE 040#8];
  |SI FSalida ! 0;
      |LEE 040#8u;
      |SI FSalida ! 0;
          #0#2 = 0;
      |SINO;
           |SI #8#0 = #0#0;
               #0#2 = #8#2;
               #0#4 = #8#3;
           |SINO;
               #0#2 = 0;
           |FINSI;
      |FINSI;
  |SINO;
      |LEE 040#8a;
      |SI FSalida ! 0;
          #0#2 = 0;
      |SINO;
          |SI #8#0 = #0#0;
              #0#2 = #8#2;
              #0#4 = #8#3;
          |SINO;
              #0#2 = 0;
          |FINSI;
      |FINSI;
  |FINSI;
  |PINTA #0#2;
  |CIERRA #8;

  |ABRE #caivaasi;
  |LEE 010#caivaasi.p;
  |CIERRA #caivaasi;

  |SI #caivaasi#44 = "N";
      |C_M #caiivsol#30,1,"N";
  |SINO;
      |C_M #caiivsol#30,1,"S";
  |FINSI;
|FPRC;

|PROCESO saalta; |TIPO 7;
  |SI FSalida = 7;
      |SI #caivaasi#44 = "S";
          |ABRE #caivases;
          #caivases#0 = SerieAnt;
          #caivases#1 = "S";
          |LEE 010#caivases.=;
          |SI FSalida = 0;
              |SI ComodNum = #caivases#3;
                  #caivases#3 = #caivases#3 - #caivases#4;
                  |GRABA 020#caivases.a;
              |FINSI;
          |FINSI;
          |CIERRA #caivases;
      |SINO;
          |ABRE #calibros;
          #calibros#0 = #caiivsol#0;
          |LEE 110#calibros.=;
          |SI FSalida = 0;
              |SI #calibros#4 ! 1;
                  #calibros#4 = #calibros#4 - #calibros#3;
              |FINSI;
              |GRABA 020#calibros.a;
          |FINSI;
          |LIBERA #calibros;
          |CIERRA #calibros;
      |FINSI;
  |FINSI;

  ModoEntrada = (FEntrada / 100) ! 0;
  |SI ModoEntrada = 1;
      |SI #0#1 ! 1;
          #0#30 = seant;
          #0#2 = orant + #10#3;
          #0#3 = 1;
          #0#4 = feant;
          #0#5 = cuant;
          #0#6 = diant;
          #0#7 = coant;
          #0#8 = deant;
          #0#9 = giant;
          #0#26 = noant;
          #0#29 = ciant;
          #0#31 = peant;
      |SINO;
          |HAZ entrada;
      |FINSI;
  |FINSI;

  |BLIN 4;
  |SI ModoEntrada > 1;
      enConcepto = #0#7;
      |HAZ EsCajaIva;
      |SI enSwCaja = 1;
          alfa1 = "    F9-Consulta Pagos Caja";
          |MENSA alfa1;
      |FINSI;
  |FINSI;
|FPRC;

|CALCULO El11; |TIPO 11;
  inkey = FSalida;
  |BLIN 4;
  |SI inkey = 17;
      |SI enEjercicio ] 2014;
          |LEE 041#0=;
          |SI FSalida = 0;
              enConcepto = #0#7;
              |HAZ EsCajaIva;
              |SI enSwCaja = 1;
                  ModoEntrada = 4;
                 |HAZ TrataClaveZ;
              |FINSI;
          |FINSI;
      |FINSI;
      |ERROR;
  |FINSI;
|FCAL;

|CALCULO El2; |TIPO 2;
    ModoEntrada = (FEntrada / 100) ! 0;
    |SI ModoEntrada = 3; |Y enEjercicio ] 2014;
        |HAZ TrataClaveZ;
    |FINSI;
|FCAL;

|PROCESO MiraSerie;
   ModoEntrada = (FEntrada / 100) ! 0;

   |SI #caivaasi#44 = "N";
      |SI ModoEntrada = 1;
         |ABRE #calibros;
         #calibros#0 = #caiivsol#0;
         |LEE 110#calibros.=;
         |SI FSalida = 0;
            |SI #caiivsol#2 [ #calibros#4;
               #caiivsol#2 = #calibros#4;  ||PEPE
               #calibros#4 = #calibros#4 + #calibros#3;
            |SINO;
               #calibros#4 = #caiivsol#2;
            |FINSI;
            |GRABA 020#calibros.a;
         |FINSI;
         |LIBERA #calibros;
         |CIERRA #calibros;
      |FINSI;
      |ACABA;
   |FINSI;
   |SI SerieAnt ! #caiivsol#30;
      |ABRE #caivases;
      |SI SerieAnt ! "  XX";
         #caivases#0 = SerieAnt;
         #caivases#1 = "S";
         |LEE 101#caivases.=;
         |SI FSalida = 0;
            ComodNum = #caiivsol#2 + #caivases#4;
            |SI ComodNum = #caivases#3;
               #caivases#3 = #caivases#3 - #caivases#4;
               |GRABA 020#caivases.a;
            |FINSI;
         |FINSI;
      |FINSI;

      #caivases#0 = #caiivsol#30;
      #caivases#1 = "S";
      |LEE 101#caivases.=;
      |SI FSalida = 0;
         #caiivsol#2 = #caivases#3;
         #caivases#3 = #caivases#3 + #caivases#4;
         ComodNum = #caivases#3;
         |GRABA 020#caivases.a;
      |FINSI;
      |LIBERA #caivases;
      |CIERRA #caivases;
      SerieAnt = #caiivsol#30;
   |FINSI;
|FPRC;

|PROCESO InitSerie; |TIPO 7;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 1;
       SerieAnt = "  XX";
   |FINSI;
|FPRC;

|PROCESO TomaNum; |TIPO 7;
   FactAnt = #caiivsol#2;
|FPRC;

|PROCESO varia;
    ModoEntrada = (FEntrada / 100) ! 0;
    igual = 0;
    |SI ModoEntrada = 1;
        |SI #0#2 = orant; |Y #0#30 = seant;
            igual = 1;
            #0#3 = liant + 1; |PINTA #0#3;
            #0#36 = foant;    |PINTA #0#36;
        |SINO;
            igual = 0;
       |FINSI;
    |FINSI;
|FPRC;

|PROCESO cheq_fra; |TIPO 0;
   |ABRE #8;
   #8#0 = #0#0;    || libro
   #8#2 = #0#2;    || orden
   #8#27 = #0#30;  || serie
   |LEE 001#8=;
   |SI FSalida = 0;
      |MENAV "    ATENCION!!! Nro. de Orden ya Existente en Historico de IVA ...";
      |ERROR;
   |SINO;
      |HAZ varia;
      |SI #caiivsol#2 ! FactAnt;
         |SI #caivaasi#44 = "S";
            |ABRE #caivases;
            #caivases#0 = #caiivsol#30;
            #caivases#1 = "S";
            |LEE 110#caivases.=;
            |SI FSalida = 0;
               #caivases#3 = #caivases#3 - #caivases#4;
               |GRABA 020#caivases.a;
            |FINSI;
            |LIBERA #caivases;
            |CIERRA #caivases;
         |SINO;
            |ABRE #calibros;
            #calibros#0 = #caiivsol#0;
            |LEE 110#calibros.=;
            |SI FSalida = 0;
               #calibros#4 = #calibros#4 - #calibros#3;
               |GRABA 020#calibros.a;
            |FINSI;
            |LIBERA #calibros;
            |CIERRA #calibros;
         |FINSI;
         FactAnt = #caiivsol#2;
      |FINSI;

   |FINSI;
   |CIERRA #8;

   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 1;
       Libro   = #caiivsol#0;
       Serie   = #caiivsol#30;
       Factura = #caiivsol#2;
       LineaBase = #caiivsol#3;
       |SALVA_DATOS #caiivsol;
       |SELECT #2#caiivsol;
       #caiivsol#0  = Libro;
       #caiivsol#30 = Serie;
       #caiivsol#2  = Factura;
       #caiivsol#3  = LineaBase;
       |LEE 010#caiivsol.=;
       |SI FSalida = 0;
           |MENAV "    La linea ya existe ";
           |ERROR;
       |FINSI;
       |SELECT #1#caiivsol;
       |REPON_DATOS #caiivsol
   |FINSI;

   |SI #caiivsol#2 ! FactAnt;
      |ABRE #caivases;
      #caivases#0 = #caiivsol#30;
      |LEE 110#caivases.=;
      |SI FSalida = 0;
          FactAnt = FactAnt + #caivases#4;
          |SI #caivases#3 = FactAnt;
              #caivases#3 = #caivases#3 - #caivases#4;
             |GRABA 020#caivases.a;
          |FINSI;
       |FINSI;
       |LIBERA #caivases;
       |CIERRA #caivases;
   |FINSI;
|FPRC;

|| ************************************************
|PROCESO cambiar; |TIPO 7;
    |SI igual = 0;
        aponer = Asino;
        |SI Campo = 8;       || solo en la descripcion del concepto
            |PTEC 816;
        |FINSI;
    |SINO;
        aponer = Anono;
    |FINSI;
    |HAZ poncontr;

    |SI Campo = 5;
        ModoEntrada = (FEntrada / 100) ! 0;
        |SI ModoEntrada ! 1; |Y paso = 0; ccuen = #0#5; |FINSI;
    |FINSI;
|FPRC;

|CALCULO FechaOp; |TIPO 7;
 |SI igual = 1;
     |C_M #0#36, 1, "N";
     |ACABA;
 |FINSI;

 |C_M #0#36,0, alfa1;
 |SI alfa1 = "N"; |ACABA; |FINSI;

 |SI #0#36 = "01.01.0000";
     #0#36 = #0#4; |PINTA #0#36;
 |FINSI;
|FCAL;

|PROCESO fecha;
  inkey = FSalida;
  |C_M #0#36, 1, "N";
  |SI inkey = 11; |O #0#36 ! "01.01.0000";
       |C_M #0#36, 1, "S";
  |FINSI;

  |SI #0Campo < fec1; |O #0Campo > fec2;
      |MENAV "      Fecha Erronea";
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO concepto; |TIPO 0;
    |ABRE #3;
    #3#0 = #0#7;
    |LEE 040#3=;
    |SI FSalida = 0;
        |PINTA 1160, "                    ";
        |SI eaConDes = "N";
            #0#8 = #3#1;
        |SINO;
            alfa1 = #3#1 % 120;
            |ATRI S; |PINTA 1160, alfa1;|ATRI 0;
        |FINSI;
    |FINSI;
    |PINTA #0#8;
    |CIERRA #3;
|FPRC;

|PROCESO conserva;
  |SI ModoEntrada ! 1; |ACABA; |FINSI;
  |SI #0#2 = orant;
      #0#8 = deant;
      |PINTA #0#8;
  |FINSI;
|FPRC;

|PROCESO conserv2;
      #0#26 = noant;
      #0#29 = ciant;
      |PINTA #0#26;
      |PINTA #0#29;
|FPRC;

|PROCESO cuefin; |TIPO 0;
    ModoEntrada = (FEntrada / 100) ! 0;
    |SI igual = 1; |HAZ conserv2; |ACABA; |FINSI;

    |ABRE #4;
    |SELECT #1#4;
    #4#0 = #0#5;
    #4#1 = #0#6;
    |LEE 001#4=;
    |SI FSalida = 0;
        |SI #4#3 = "N";
            |MENAV men3;
            |ERROR;
        |SINO;
            |SI ModoEntrada ! 1;
                |SI ccuen = #0#5; |CIERRA #4; |ACABA; |FINSI;
            |SINO;
                paso = 1;
            |FINSI;
            #0#26 = #4#2; |PINTA #0#26;

            |DDEFECTO #7;
            |ABRE #7;
            #7#23 = "P";
            #7#10 = #0#5;
            #7#11 = #0#6;
            |LEE 001#7=;
            |SI FSalida = 0;
                #0#9 = #7#12;
                #0#29 = #7#9;
            |SINO;
                #0#9 = 1;
                #0#29 = "";
            |FINSI;
            |PINTA #0#9;
            |PINTA #0#29;
            |CIERRA #7;
        |FINSI;
    |SINO;
       |ERROR;
    |FINSI;
    |CIERRA #4;
|FPRC;

|PROCESO cuenta;|TIPO 6;
    p_alfa1 = #0Campo;
    salidas = FSalida;
    |HAZ punto;
    |SI #0#5 = "            ";  |ERROR;  |ACABA;  |FINSI;
    cta  = #0#5;
    long = cta % A0;
    sw = 0;
    |SI long = dig4; sw = 1; #0#6 = 1; |FINSI;
    |SI long = dig5; sw = 1; #0#6 = 2; |FINSI;
    |SI long = dig6; sw = 1; #0#6 = 3; |FINSI;
    |SI long = dig7; sw = 1; #0#6 = 4; |FINSI;
    |SI long = dig8; sw = 1; #0#6 = 5; |FINSI;
    |SI long = dig9; sw = 1; #0#6 = 6; |FINSI;
    |SI sw = 0;
        |MENAV men2;
        |ERROR;
    |FINSI;
|FPRC;

|PROCESO contra6; |TIPO 6;
    p_alfa1 = #0Campo;
    salidas = FSalida;
    |HAZ punto;
    |SI #0#17 = "            ";  |ERROR;  |ACABA;  |FINSI;
    cta  = #0#17;
    long = cta % A0;
    sw = 0;
    |SI long = dig4; sw = 1; #0#18 = 1; |FINSI;
    |SI long = dig5; sw = 1; #0#18 = 2; |FINSI;
    |SI long = dig6; sw = 1; #0#18 = 3; |FINSI;
    |SI long = dig7; sw = 1; #0#18 = 4; |FINSI;
    |SI long = dig8; sw = 1; #0#18 = 5; |FINSI;
    |SI long = dig9; sw = 1; #0#18 = 6; |FINSI;
    |SI sw = 0;
        |MENAV men2;
        |ERROR;
    |FINSI;
|FPRC;

|PROCESO contra0; |TIPO 0;
    |ABRE #4;
    |SELECT #1#4;
    #4#0 = #0#17;
    #4#1 = #0#18;
    |LEE 040#4= ;
    |SI FSalida ! 0; |O #4#3 = "N";
        |MENAV "     Cuenta INEXISTENTE o NO tiene pase Directo";
        |ERROR;
    |SINO;
        #0#27 = #4#2;
        |PINTA #0#27;
    |FINSI;
    |CIERRA #4;
|FPRC;

|PROCESO suma1; |TIPO 0;
    inkey = FSalida;
    |SI inkey = 9;
        guarda_12 = #0#12;
        #0#12 = #0#12  * (100 / (#0#13 + #0#15 + 100));
    |FINSI;
    trasum = #0#12 * #0#13 / 100;
    #0#14 = trasum ! EURODB; ||Redondeo a EURO o Peseta
    trasum = #0#12 * #0#15 / 100;
    #0#16 = trasum ! EURODB; ||Redondeo a EURO o Peseta
    |SI inkey = 9;
        #0#12 = #0#12 + (guarda_12 - (#0#12 + #0#14 + #0#16));
    |FINSI;
    #0#28 = #0#12 + #0#14 + #0#16;
    |PINTA #0#12;
    |PINTA #0#14;
    |PINTA #0#16;
    |PINTA #0#28;
|FPRC;

|PROCESO suma2;
  trasum = #0#12 * #0#13 / 100;
  #0#14 = trasum ! EURODB; ||Redondeo a EURO o Peseta
  |PINTA #0#14;
  #0#28 = #0#12 + #0#14 + #0#16;
  |PINTA #0#28;
|FPRC;

|PROCESO suma3;
  trasum = #0#12 * #0#15 / 100;
  #0#16 = trasum ! EURODB; ||Redondeo a EURO o Peseta
  |PINTA #0#16;
  #0#28 = #0#12 + #0#14 + #0#16;
  |PINTA #0#28;
|FPRC;

|PROCESO suma4;
  #0#28 = #0#12 + #0#14 + #0#16;
  |PINTA #0#28;
|FPRC;

|PROCESO control1;
  |SI FSalida = 2;  |ACABA;  |FINSI;
  |ABRE #6;
  #6#0 = "S";
  #6#1 = #0#10;
  |LEE 040#6=;
  |SI FSalida ! 0;
      |MENAV "     No existe Control en I.V.A.";
      |CIERRA #6;
      |ERROR;
      |ACABA;
  |FINSI;
  nume1 = #7#21;
  |SI nume1 = 0;
      #0#17 = #6#2;
      #0#18 = #6#3;
  |SINO;
      #0#17 = #7#21;
      #0#18 = #7#22;
  |FINSI;
  #0#24 = #6#11;
  #0#25 = #6#12;
  |PINTA #0#17;

  tipito = 0;
  |SI #0#9 = 1; tipito = #6#4;  |FINSI;
  |SI #0#9 = 2; tipito = #6#5;  |FINSI;
  |SI #0#9 = 3; tipito = #6#6;  |FINSI;
  |SI #0#9 = 4; tipito = #6#7;  |FINSI;
  |SI #0#9 = 5; tipito = #6#8;  |FINSI;
  |SI #0#9 = 6; tipito = #6#9;  |FINSI;
  |SI #0#9 = 7; tipito = #6#10;  |FINSI;
  |SI tipito = 0;
      |MENAV "     No existe Control en I.V.A.";
      |CIERRA #6;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #6;
  |ABRE #5;
  #5#0 = "S";
  #5#1 = tipito;
  |LEE 040#5=;
  |SI FSalida ! 0;
      |MENAV "     No existe Control en I.V.A.";
      |CIERRA #5;
      |ERROR;
      |ACABA;
  |FINSI;
  #0#13 = #5#2;
  #0#15 = #5#5;
  #0#19 = #5#8;
  #0#20 = #5#3;
  #0#21 = #5#4;
  #0#22 = #5#6;
  #0#23 = #5#7;
  #0#32 = #5#9;   || Inversion
  #0#33 = #5#10;  || INTRACOMUNITARIO
  |PINTA #0#13;
  |PINTA #0#15;
  |PINTA #0#19;
  |PINTA #0#32;
  |PINTA #0#33;
  |HAZ suma1;
  |CIERRA #5;
|FPRC;

|PROCESO TrasPeriodo;
    inkey = FSalida;
    |C_M #0#36, 1, "N";
    |SI inkey = 11;
        |C_M #0#36, 1, "S";
        |PTEC 808;
    |FINSI;
|FPRC;

|PROCESO losctrl; |TIPO 7;
 |C_M #0Campo, 0, alfa1;
 |SI Campo = 9;
     |SI ctr10 = "N";
         |C_M #0Campo, 1, "N";
     |SINO;
         |C_M #0Campo, 1, alfa1;
     |FINSI;
 |FINSI;
 |SI Campo = 26;
     |SI ctr35 = "N";
         |C_M #0Campo, 1, "N";
     |SINO;
         |C_M #0Campo, 1, alfa1;
     |FINSI;
 |FINSI;
 |SI Campo = 29;
     |SI ctr36 = "N";
         |C_M #0Campo, 1, "N";
     |SINO;
         |C_M #0Campo, 1, alfa1;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO poncontr;
  fiac = Control % A109; || fichero ultima pantalla
  fiac = fiac + relleno;
  guarda = fiac % A109;
  fiac = Control % A1001; || numero pantalla
  Control = Control + fiac;
  Control = Control + relleno;
  Control = Control % A120;
  Control = Control + aponer; || flags de alteracion
|FPRC;

|PROCESO letra_0;  |TIPO 6;
     |SI FSalida = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoDNI;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
        |SI #caclipro#24 = "ES "; |O #caclipro#24 = "E  "; |O  #caclipro#24 = "   ";
            |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
            |SI FSalida = 0;
                #0Campo = eaVarDni;  |PINTA #0Campo;
                |ERROR;
            |FINSI;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO periodo; |TIPO 7;
    |HAZ cambiar;
    |SI igual = 1; |ACABA; |FINSI;

    alfa1 = #0#4;   alfa1 = alfa1 % 402;      || saca el mes
    nume1 = alfa1;
    #0#31 = nume1;
    |SI #caivaasi#46 = "T";
        #0#31 = 1;
        |SI nume1 ]  4; #0#31 = 2; |FINSI;
        |SI nume1 ]  7; #0#31 = 3; |FINSI;
        |SI nume1 ] 10; #0#31 = 4; |FINSI;
    |SINO;
        |SI #caivaasi#46 = "A";
            #0#31 = 0;
        |FINSI;
    |FINSI;
|FPRC;

|| ////////////////////////////////////////////////////////
|PROCESO BorraMacc12;
  |BORRA 020#512a;
  |LIBERA #512;
|FPRC;

|DEFBUCLE  BorraMacc12;
  #512#1;
  ;
  aTipoIVA, #0#0, #0#1, 01;
  aTipoIVA, #0#0, #0#1, 99;
  be;
  NULL, BorraMacc12;
|FIN;

|PROCESO TrataClaveZ;

   |SI ModoEntrada ! 4;
       enConcepto = #0#7;
       |HAZ EsCajaIva;
   |FINSI;

   |SI ModoEntrada = 3; |O enSwCaja = 0;
       |BUCLE BorraMacc12;
       |ACABA;
   |FINSI;

   |SI enSwCaja = 1;
       |ABRE #599;
       #599#13 = aTipoIVA;
       #599#0  = #0#0;
       #599#1  = #0#1;
       #599#2  = #0#2;
       #599#3  = #0#30;
       |LEE 041#599=;
       |SI FSalida ! 0;
           |DDEFECTO #599;
           #599#0  = #0#0;
           #599#1  = #0#1;
           #599#2  = #0#2;
           #599#3  = #0#30;
           |GRABA 020#599c;
       |FINSI;
       eModoCaja = ModoEntrada + 10;
       #599#4    = #0#04;
       #599#5    = #0#05;
       #599#6    = #0#07;
       #599#7    = #0#08;
       #599#8    = #0#12;
       #599#9    = #0#14;
       #599#10   = #0#28;
       #599#11   = #0#26;
       #599#12   = #0#29;
       #599#13   = aTipoIVA;
       #599#14   = "N";
       #599#15   = #0#4;
       #599#17   = #0#31;

       #599#26 = #599#8;
       #599#27 = #599#9;
       |GRABA 020#599a;
       |CIERRA #599;
       |SUB_EJECUTA_NP "camaccw1";
   |FINSI;
|FPRC;

|| ***********************************************************
|PROCESO guarda; |TIPO 3;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI enEjercicio ] 2014;
       |HAZ TrataClaveZ;
   |FINSI;

   paso = 0;
   ccuen = "";
   |SI ModoEntrada = 1;
       seant = #0#30;
       orant = #0#2;
       liant = #0#3;
       feant = #0#4;
       cuant = #0#5;
       diant = #0#6;
       coant = #0#7;
       deant = #0#8;
       giant = #0#9;
       noant = #0#26;
       ciant = #0#29;
       peant = #0#31;
       foant = #0#36; |C_M #0#36,1,"N";
   |FINSI;
|FPRC;
