|FICHEROS;
    imppcbot #0;
    auxpcbo4 #93;
    camandia #20;   || diarios AGICONT
    camaasic #22;   || asientos cabs. AGICONT
    camaasil #23;   || asientos lins. AGICONT
    cacuenta #24;   || cuentas AGICONT
    catradia #27;   || diario de trabajo
    cacuebal #28;   || cuentas de balance
    ca8m0002 #422;
|FIN;

|VARIABLES;
    vic      = 0;
    fecha2   = @;
    fechavic = "";
    fechacon = "";
    nReg5    = 0;
    nReg6    = 0;
    npago    = 0;
    aGrup    = "";
    nAlfa    = 0;
    alfa     = "";
    codigocu = "";
    digitocu = "";
    nomcu    = "";
    aDesc    = "";
    impor1  = 0;
    camas   = 0;
    var_tipo = "";
    var_cta  = "";
    trim1   = "";
    trim2   = "";
    trim3   = "";
    estado  = 0;
    numfac  = 0;
    &enDiario   = 0;
    &enContador = 0;
    &entrada = 1;
    &modcon = 0;
    swnu   = 0;
    aDes   = "";
    conte  = "";
    digcu  = 0;
    tipo   = "";
    signe  = "";
    nocta  = 0;
    coDcli = "";
    aFich  = "";
    alfa1  = "";
    alfa2  = "";
    alfa3  = "";
    alfa4  = "";
    nRegi  = 0;
    nReg2  = 0;
    field  = "";
    fabre  = "";
    fcanl  = "";
    numer  = 0;
    tienda = "";
    afecha = @;
    fpago  = "";
    diario = 0;
    fecha  = @;
    docume = 0;
    linea  = 0;
    nume1  = 0;
    asient = 0;
    impor  = 0;

    desl_rep = "";
    desl_sop = "";
    desl_gas = "";

    p_lugar = 0;
    p_cuan3 = 0;
    p_cuan4 = 0;
    p_cuan5 = 0;
    p_alfa1 = "";
    p_alfa2 = "";
    p_alfa3 = "";
    p_alfa4 = "";
    p_alfa5 = "";
    p_alfa6 = "";
    p_nume1 = 0;
    p_nume2 = 0;
    p_ceros = "";
    p_error = 0;
    p_mensa = "    LONGITUD DE CUENTA FUERA DE NIVEL!";
    desdec1 = "";
    hastac1 = "";
    varia_cod = "";
    sw_nom = 0;
    cuen11 = "";
    cuen21 = "";
    cuen31 = "";
    num_campo = 0;
    p_nifs = "";
    nDevol = 0;
    nSw    = 0;

    ini = 0;
    fecalf = "";
    mes = "";
    mesfec = 0;
    mesac = 0;
    a = 0;
    b = 0;
    c = 0;

    lon = 0;
    aa = 0;
    mensa = "";
    aar = "";
    traba = "";
    errcuent = "aaaaaaaaaaaa";
|FIN;

|INCLUYE acceso_i;
|INCLUYE tempo_i;
|INCLUYE varnue_i;
|INCLUYE defec1_i;

|PROCESO pase_auxiliar;
     nSw = 1;
     ||----------------------------------APUNTE PROVEEDOR
     |DDEFECTO #93;
     alfa1 = field % 1509;
     |HAZ cuenta;
     #93#2  = p_alfa1;     ||Cuenta;
     #93#1 = "P";
     |LEE 000#93=;
     |SI FSalida ! 0; |GRABA 020#93b; |FINSI;
     #93#2  = p_alfa1;
     #93#6 = dig3;        ||Digito Control.
     #93#8 = #0#6;        ||Cod.Concepto.
     #93#7 = #0#9;        ||Des.Concepto.
     alfa1 = field % 2909;
     #93#3 = #93#3 + alfa1;    ||Imponible.
     |GRABA 020#93a;
     |LIBERA #93;

     ||----------------------------------APUNTE BANCO
     |DDEFECTO #93;
     alfa1 = field % 0609;
     |HAZ cuenta;
     #93#2  = p_alfa1;     ||Cuenta;
     #93#1 = "B";
     |LEE 000#93=;
     |SI FSalida ! 0; |GRABA 020#93b; |FINSI;
     #93#2  = p_alfa1;
     #93#6 = dig3;        ||Digito Control.
     #93#8 = #0#7;        ||Cod.Concepto.
     #93#7 = #0#10;       ||Des.Concepto.
     alfa1 = field % 2909;
     #93#3 = #93#3 + alfa1;     ||Imponible.
     |GRABA 020#93a;
     |LIBERA #93;

     ||----------------------------------APUNTE BANCO GASTOS TRANSFER.
     alfa1 = field % 2405;
     nAlfa = alfa1;
     |SI nAlfa ! 0;
          #0#25 = #0#25 + nAlfa;
          |DDEFECTO #93;
          alfa1 = field % 0609;
          |HAZ cuenta;
          #93#2  = p_alfa1;     ||Cuenta;
          #93#1 = "G";
          |LEE 000#93=;
          |SI FSalida ! 0; |GRABA 020#93b; |FINSI;
          #93#2  = p_alfa1;
          #93#6 = dig3;        ||Digito Control.
          #93#8 = #0#33;        ||Cod.Concepto.
          #93#7 = #0#34;       ||Des.Concepto.
          #93#3 = #93#3 + nAlfa;     ||Imponible. Gastos Tranfer.
          |GRABA 020#93a;
          |LIBERA #93;
     |FINSI;
|FPRC;

|PROCESO cuenta;
    p_alfa1 = alfa1;
    p_alfa1 = (p_alfa1 + "                         ") % 112;
    |HAZ punto;
|FPRC;

|PROCESO controlfech;
     |SI nSw = 0;
       aFich = Usuario; aFich = "4" + aFich;
       |NOME_DAT #93 aFich;
       |DELINDEX #93;
       |ABRE #93;
       #0#25 = 0;
       fechavic = fechacon;
       nSw = 1;
     |FINSI;

     |HAZ pase_auxiliar;

|FPRC;

|PROCESO ejecuta;
  fabre = #0#3; |QBT fabre;
  fabre = "rt  " + fabre;
  |FABRE fabre;
  fcanl = FSalida;
  |SI fcanl < 0;
      alfa1 = "    [" + (fabre % 5) + "] inaccesible o inexistente ...";
      |MENAV alfa1;
  |SINO;
      |PARA; |SI; |HACIENDO;
             field = fcanl + " 250";
             |FLEE field;
             |SI FSalida > 0;
                    |HAZ controlfech;
             |SINO;
                 |SAL;
             |FINSI;
      |SIGUE;
  |FINSI;
  |FCIERRA fcanl;
  Pos = -1;
|FPRC;

|PROGRAMA;
 |CLS;
 |CABEZA "Enlace Tranfer.PC-BOX";
 |PINPA #0#0;
 |HAZ inicio;
 |HAZ eVarEmpresa;
 |ABRE #0;
 |ENCAMPO #4#0;
 |SI FSalida = 0;
   |LEE 101#0=;
   |SI FSalida ! 0;
       |GRABA 020#0b;
   |SINO;
       |PINDA #0#0;
   |FINSI;
   |ENDATOS #1#0;
   |SI FSalida = 0;
       tienda = #0#4;
       tienda = ("0000" + tienda) % -102;
       fecha2 = #0#11;
       |ABRE #20;     || Diarios
       |ABRE #22;     || Apuntes Cabs.
       |ABRE #23;     || Apuntes Lins
       |ABRE #24;     || Plan Contable
       |ABRE #27;
       |HAZ ejecuta;
       |CIERRA #93;
       |SI nSw = 1;
          |HAZ registros;
          |DELINDEX #93;
       |FINSI;
       |CIERRA #20;       || Diarios
       |CIERRA #22;       || Apuntes Cabs.
       |CIERRA #23;       || Apuntes Lins
       |CIERRA #24;       || Plan Contable
       #0#25 = 0;
       |GRABA 020#0a;
   |FINSI;
 |FINSI;
   |LIBERA #0;
   |CIERRA #0;
 || ............... Terminar

 |SI modcon = 0;
     |ABRET #27;
     |DDEFECTO #27;
     #27#0 = codcon;
     |LEE 040#27=;
     |BORRA 101#27a;
     |CIERRAT #27;
 |SINO;
     |CORRE "camaapua.tab"
 |FINSI;

|FPRO;

|| *************************************************************************
|| ********************* CALCULOS PANTALLA
|| *************************************************************************

|PROCESO mayus; |TIPO 0;
 #0Campo = #0Campo > #0Campo;
 |PINTA #0Campo;
|FPRC;


|| ************************************************************************
|| *************************************************************************
|PROCESO fecha;
 alfa1 = afecha % 502;      || a¤o
 alfa2 = afecha % 302;      || mes
 alfa3 = afecha % 102;      || dia
 nume1 = alfa1;
 |SI nume1 > 80;  alfa1="19"+alfa1;  |SINO;  alfa1="20"+alfa1;  |FINSI;
 alfa4 = alfa3 + "." + alfa2 + "." + alfa1;
 afecha = alfa4;
|FPRC;

|PROCESO cabecera; || lee la cabecera.
|DDEFECTO #22;
  #22#0 = diario;
  #22#1 = #0#11;
  #22#2 = docume;
  #22#3 = asient;
  linea = -9;
  |GRABA 020#22n;
  |SI FSalida ! 0;
      #23#0 = #22#0;
      #23#1 = #22#1;
      #23#2 = #22#2;
      #23#3 = 9999;
      |LEE 040#23];
      |SI FSalida = 0;
          |LEE 040#23a;
          |SI #23#0 = #22#0; |Y #23#1 = #22#1; |Y #23#2 = #22#2;
              linea = #23#3;
          |FINSI;
      |SINO;
          |LEE 040#23u;
          |SI FSalida = 0; |Y  #23#0 = #22#0; |Y #23#1 = #22#1; |Y #23#2 = #22#2;
              linea = #23#3;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;


|PROCESO punto;
  p_error = 0;
  p_lugar = 0;
  p_cuan3 = 0;
  p_cuan4 = 0;
  p_alfa3 = "";
  p_alfa4 = "";
  p_alfa4 = p_alfa1 > " ";
  p_alfa1 = p_alfa4;
  p_alfa4 = "";
  |PARA p_nume1 = 1; |SI p_nume1 [ 12; |HACIENDO p_nume1 = p_nume1 + 1;
        p_nume2 = (p_nume1 * 100) + 1;
        p_alfa2 = p_alfa1 % p_nume2;
        |SI p_alfa2 ! " ";
            |SI p_alfa2 = ".";
                p_lugar = p_nume1;
            |SINO;
                |SI p_lugar=0; p_alfa3=p_alfa3+p_alfa2; p_cuan3=p_cuan3+1; |FINSI;
                |SI p_lugar!0; p_alfa4=p_alfa4+p_alfa2; p_cuan4=p_cuan4+1; |FINSI;
            |FINSI;
        |FINSI;
  |SIGUE;
  |SI p_lugar ! 0;
      |SI dig3 = 1;  p_cuan5 = dig4;  |FINSI;
      |SI dig3 = 2;  p_cuan5 = dig5;  |FINSI;
      |SI dig3 = 3;  p_cuan5 = dig6;  |FINSI;
      |SI dig3 = 4;  p_cuan5 = dig7;  |FINSI;
      |SI dig3 = 5;  p_cuan5 = dig8;  |FINSI;
      |SI dig3 = 6;  p_cuan5 = dig9;  |FINSI;
      p_nume1 = p_cuan5 - (p_cuan3 + p_cuan4);
      |SI p_nume1 > 0;
          cuen11 = p_alfa4 % 101;
          p_ceros = "0" * p_nume1;
          p_alfa5 = p_alfa3 + p_ceros + p_alfa4;
          cuen11 = p_alfa4 % 101;
          |SI cuen11 = "U";  |O cuen11 = "A";
              cuen31 = cuen11;
              ||HAZ ultialta;
          |FINSI;
              p_alfa1 = p_alfa5;
      |FINSI;
  |SINO;
      p_alfa5 = p_alfa1;
  |FINSI;
|FPRC;

|PROCESO acabaasiento;
|DDEFECTO #23;
 #23#0 = diario;
 #23#1 = #0#11;
 #23#2 = docume;
 linea = linea + 10;
 #23#3 = linea;
 #23#21 = tienda;
      #23#8 = "H";
      #23#4 = #0#14;
      #23#5 = #0#15;
      #23#6 = #0#33;
      #23#7 = #0#34;
      #23#9 = #0#25;
 |HAZ adapta;
 |HAZ a_diario;
 |HAZ a_cuenta;
 #23#21 = tienda;
 |SI #23#9 ! 0;
      |GRABA 020#23n;
      |HAZ gratra;
      |HAZ act_cabecera;
 |FINSI;
|FPRC;

|PROCESO asiento;
|DDEFECTO #23;
 #23#0 = diario;
 #23#1 = #0#11;
 #23#2 = docume;
 linea = linea + 10;
 #23#3 = linea;
|SI tipo = "P";
      #23#6 = #93#8;
      #23#8 = "D";
      #23#4 = #93#2;
      #23#5 = #93#6;
      #23#7 = #93#7;
      #23#9 = #93#3;
|FINSI;
|SI tipo = "B";
      #23#6 = #93#8;
      #23#8 = "H";
      #23#4 = #93#2;
      #23#5 = #93#6;
      #23#7 = #93#7;
      #23#9 = #93#3;
|FINSI;
|SI tipo = "G";
      #23#6 = #93#8;
      #23#8 = "D";
      #23#4 = #93#2;
      #23#5 = #93#6;
      #23#7 = #93#7;
      #23#9 = #93#3;
|FINSI;
 |HAZ adapta;
 |HAZ a_diario;
 |HAZ a_cuenta;
 #23#21 = tienda;
 |SI #23#9 ! 0;
      |GRABA 020#23n;
      |HAZ gratra;
      |HAZ act_cabecera;
 |FINSI;
|FPRC;

|PROCESO nueva;
 diario   = #0#1;        || Diario
 fecha    = #0#11;       || Fecha
 enDiario = #0#1;
 |HAZ contador;
 |PINTA 0672, enContador;
 docume = enContador;    || Documento
 asient = asient + 1;    || Asiento
 |HAZ cabecera;
|FPRC;


|PROCESO auxpcbo4;
     |SI swnu = 0;
          |HAZ nueva;
          swnu = 1;
     |FINSI;
     |HAZ asiento;
|FPRC;


|DEFBUCLE auxpcbo4;
     #93#1;
;
"            ",tipo;
"zzzzzzzzzzzz",tipo;
;
NULL,auxpcbo4;
|FIN;




|PROCESO registros;
     |LEE 101#27u;
     |SI FSalida ! 0;
          |DDEFECTO #27;
          #27#0 = 1;
     |SINO;
          #27#0 = #27#0 + 1;
     |FINSI;
     |GRABA 101#27n;
     codcon = #27#0;
     |LIBERA #27;
     tipo = "P";
     swnu = 0;
     |BUCLE auxpcbo4;        ||Apuntes Proveedores.
     tipo = "B";
     |BUCLE auxpcbo4;        ||Apunte Bancos.
     tipo = "G";
     swnu = 0;
     |BUCLE auxpcbo4;        ||Apunte Gastos Bancos.
     |SI swnu = 1;
          |HAZ acabaasiento;
     |FINSI;
|FPRC;

|PROCESO a_diario;
 |ABRE #20;
 #20#0 = #23#0;
 |LEE 101#20=;
 |SI FSalida ! 0;              || actualiza el diario
     |DDEFECTO #20;
     #20#0 = #23#0;
     #20#1 = "<DIARIO SIN DEFINIR>";
    |GRABA 020#20b;
 |FINSI;
 |SI #23#8 = "D";  #20#2 = #20#2 + #23#9;  |FINSI;
 |SI #23#8 = "H";  #20#3 = #20#3 + #23#9;  |FINSI;
 |GRABA 020#20a;
 |LIBERA #20;
 |CIERRA #20;
|FPRC;

|| ****** ACTUALIZACION DE CUENTAS
|PROCESO a_cuenta;
  #24#0 = #23#4;
  #24#1 = #23#5;
  |LEE 101#24=;
  |SI FSalida ! 0;
      |LIBERA #24;
      |DDEFECTO #24;
      #24#0 = #23#4;
      #24#1 = #23#5;
      #24#3 = "S";
      |HAZ defect1;
      |PUSHV 0501 1980;
      |PINPA #0#24;
      |PINDA #0#24;
      |ENDATOS #1#24;
      |SI FSalida ! 0;
          |POPV;
          |ACABA;
      |FINSI;
      |GRABA 020#24b;
      |POPV;
  |FINSI;
  |SI #23#0 = 0;
      |SI #23#8 = "D";
          #24#9  = #24#9 + #23#9;
          #24#51 = #24#51 + #23#9;
      |SINO;
          #24#10 = #24#10 + #23#9;
          #24#52 = #24#52 + #23#9;
      |FINSI;
      #24#11 = #24#9 - #24#10;
      #24#53 = #24#51 - #24#52;
  |SINO;
      |SI #23#0 = 99;
          |SI #23#8 = "D";
              #24#48 = #24#48 + #23#9;
              #24#51 = #24#51 + #23#9;
          |SINO;
              #24#49 = #24#49 + #23#9;
              #24#52 = #24#52 + #23#9;
          |FINSI;
          #24#50 = #24#48 - #24#49;
          #24#53 = #24#51 - #24#52;
       |SINO;
          |HAZ actualiz2;
       |FINSI;
  |FINSI;
  |SI #24#58 < #23#1;
      #24#58 = #23#1;
  |FINSI;
  |GRABA 020#24a;
  |LIBERA #24;
|FPRC;

|PROCESO actualiz2;
    ini = dig1;      || numero de niveles
    fecalf = #23#1;
    mes = fecalf % 402;
    mesfec = mes;
    |SI ini = 1;
        mesac = mesfec;
    |SINO;
        mesac = (mesfec - ini) + 1;
        |SI mesac [ 0;
            mesac = (13 - ini) + mesfec;
        |FINSI;
    |FINSI;
    a = (mesac * 3) + 9;
    b = a + 1;
    c = a + 2;
   |SI #23#8 = "D";
        #24a = #24a + #23#9;
        #24#51 = #24#51 + #23#9;
   |SINO;
        #24b = #24b + #23#9;
        #24#52 = #24#52 + #23#9;
   |FINSI;
   #24c = #24a - #24b;
   #24#53 = #24#51 - #24#52;
|FPRC;

|PROCESO gratra; || trabajo para actualizar cuentas del Plan Contable
 modcon = 1;
 #27#0 = codcon;
 #27#1 = #23#4;
 #27#2 = #23#5;
 #27#3 = #23#1;
 #27#4 = #23#8;
 #27#6 = #23#0;
 |LEE 101#27=;
 |SI FSalida ! 0;
     |DDEFECTO #27;
     #27#0 = codcon;
     #27#1 = #23#4;
     #27#2 = #23#5;
     #27#3 = #23#1;
     #27#4 = #23#8;
     #27#6 = #23#0;
     |GRABA 101#27b;
 |FINSI;
 #27#5 = #27#5 + #23#9;
 |GRABA 101#27a;
 |LIBERA #27;
|FPRC;

|PROCESO act_cabecera;
  #22#0 = diario;
  #22#1 = #0#11;
  #22#2 = docume;
  |LEE 101#22=;
  |SI #23#8 = "D";
       #22#4 = #22#4 + #23#9;
       |SI #22#09 = 0; #22#08 = #23#4; #22#09 = #23#5; |FINSI;  || contrp.HABER
  |SINO;
       #22#5 = #22#5 + #23#9;
       |SI #22#11 = 0; #22#10 = #23#4; #22#11 = #23#5; |FINSI;  || contrp.DEBE
  |FINSI;
  #22#6 = #22#4 - #22#5;        || saldo
  |GRABA 020#22a;
  |LIBERA #22;
|FPRC;

|PROCESO adapta;
 |SI #23#8 = "D";
     #23#16 = #23#4;
     #23#17 = #23#5;
     #23#10 = "";
     #23#11 = 0;
 |SINO;
     #23#16 = "";
     #23#17 = 0;
     #23#10 = #23#4;
     #23#11 = #23#5;
 |FINSI;
|FPRC;

|PROCESO puntocuent; |TIPO 0;
    camas = Campo + 1;
    p_alfa1 = #0Campo;
    p_alfa1 = (p_alfa1 + "                         ") % 112;
    |HAZ punto;
    #0Campo = p_alfa1;
    |PINTA #0Campo;
    #0camas = dig3;
|FPRC;

|PROCESO leecucu;
  nomcu = "";
  #24#0 = codigocu;
  #24#1 = digitocu;
  |LEE 101#24=;
  |SI FSalida ! 0;
      |LIBERA #24;
      |DDEFECTO #24;
      #24#0 = codigocu;
      #24#1 = digitocu;
      #24#3 = "S";
      |HAZ defect1;
      |PUSHV 0501 1980;
      |PINPA #0#24;
      |PINDA #0#24;
      |ENDATOS #1#24;
      |SI FSalida ! 0;
          |POPV;
          |ACABA;
      |FINSI;
      |GRABA 020#24b;
      |POPV;
      nomcu = #24#2;
  |SINO;
      nomcu = #24#2;
  |FINSI;
|FPRC;
