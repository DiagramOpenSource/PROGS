|FICHEROS;
     cayinf01 #0;
     caivarep #1;
     caivasop #2;

     cawinf01 #900;
     Refer1@   #901;
     Refer2@   #902;
|FIN;

|VARIABLES;
     aSerieAnt = "";
     nLibroAnt = 0;
     nFactuAnt = 0;
     nPrime = 0;
     nCuenta = 0;

     aDef = "";
     aFich = "";
     aSwitch = "";
|FIN;

|PROCESO CuentaIvaRep;
     nCuenta = nCuenta + 1;
|FPRC;

|DEFBUCLE CuentaIvaRep;
     #901#1003;
     ;
     nLibroAnt, "  ", nFactuAnt;
     nLibroAnt, "zz", nFactuAnt;
     ;
     NULL, CuentaIvaRep;
|FIN;

|PROCESO CuentaIvaSop;
     nCuenta = nCuenta + 1;
|FPRC;

|DEFBUCLE CuentaIvaSop;
     #902#1003;
     ;
     nLibroAnt, "  ", nFactuAnt;
     nLibroAnt, "zz", nFactuAnt;
     ;
     NULL, CuentaIvaSop;
|FIN;

|PROCESO caivarep;
     |SI nLibroAnt = #1#0; |Y nFactuAnt = #1#2; |Y nPrime ! 0;
          nCuenta = 0;
          |BUCLE CuentaIvaRep;
          |SI nCuenta > 1;
               #900#0 = #1#4;
               #900#1 = #1#0;
               #900#2 = #1#27;
               #900#3 = #1#2;
               #900#4 = aSwitch;
               |GRABA 020#900n
          |FINSI;
     |FINSI;
     aSerieAnt = #1#27;
     nLibroAnt = #1#0;
     nFactuAnt = #1#2;
     nPrime = 1;
|FPRC;

|PROCESO caivasop;
     |SI nLibroAnt = #2#0; |Y nFactuAnt = #2#2; |Y nPrime ! 0;
          nCuenta = 0;
          |BUCLE CuentaIvaSop;
          |SI nCuenta > 1;
               #900#0 = #2#4;
               #900#1 = #2#0;
               #900#2 = #2#27;
               #900#3 = #2#2;
               #900#4 = aSwitch;
               |GRABA 020#900n
          |FINSI;
     |FINSI;
     aSerieAnt = #2#27;
     nLibroAnt = #2#0;
     nFactuAnt = #2#2;
     nPrime = 1;
|FPRC;


|DEFBUCLE caivarep;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NULL, NULL, NULL, NULL, caivarep;
     #1#0,#1#2,#1#27;
|FIN;

|DEFBUCLE caivasop;
     #2#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NULL, NULL, NULL, NULL, caivasop;
     #2#0,#2#2,#2#27;
|FIN;

|PROCESO elPrint;
     |PRINT;
|FPRC;

|DEFBUCLE Impresion;
     #900#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, elPrint;
|FIN;

|PROCESO Informe;
     |ABRE #900;
     |CIERRA #900;
     |DELINDEX #900;
     |ABRE #900;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "cayinf01";
          |SI FSalida = 0;
               |DBASE aDef;
               aDef = aDef + "def/caivarep.mas";
               |DFICE aFich;
               |CARGA_DEF aDef, Refer1@;
               |SI FSalida = 0;
                    aSwitch = "R";
                    |PATH_DAT #901 aFich;
                    nPrime = 0;
                    |BUCLE caivarep;
                    |DESCARGA_DEF #Refer1@;
               |FINSI;
               |CARGA_DEF aDef, Refer2@;
               |SI FSalida = 0;
                    aSwitch = "S";
                    |PATH_DAT #902 aFich;
                    nPrime = 0;
                    |BUCLE caivasop;
                    |DESCARGA_DEF #Refer1@;
               |FINSI;
          |BUCLE Impresion;
          |FINSI;
          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
     |CIERRA #900;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |SI #0#0 = "SI";
               |HAZ Informe;
          |FINSI;
     |FINSI;
|FPRO;
