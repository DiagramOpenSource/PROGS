|FICHEROS;
  c3geconi #0;
  caivarep #1;    || repercutido
  caivasop #2;    || soportado
  camaasic #3;    || apuntes cabs.
  canempre #30;
|FIN;

|VARIABLES;
  &r_emp = 0;
  &r_per = 0;
  &empcon = 0;
  &ejecon = 0;
  leidos = 0;
  dirfich0 = "";
  xx = 0;
  yy = 0;
  desde = 0;
  hasta = 0;
  x = 0;
  y = 0;
  varcamp = 0;
  informe = "c3geconi";
  sw_algun = 0;

    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;

    &tipo = "";
    &e = "";
    base = 0;
    porc = 0;
    cuot = 0;
    punt = 0;
    men9 = "     Empresa Contable INACTIVA ";
|FIN;

|INCLUYE acceso_i;

|| ***********************************************************************
||                       CALCULOS DE PANTALLA
|| ***********************************************************************

|PROCESO defecto; |TIPO 7;
                  || fecsys = ~;
    alfa1 = fec2;
    alfa1 = alfa1 % -102;
    #0Campo = alfa1;
    |PINTA #0Campo;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SUB_EJECUTA "caconemp.run";
  |ERROR;
  |SI Campo = 10;
      #0#10 = r_emp;
      #0#12 = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
  |SI Campo = 11;
      #0#11 = r_emp;
      #0#13 = r_per;
      |PTEC 802;
  |FINSI;
  |SI Campo ] 14;
      #0Campo = r_emp;
      varcamp = Campo + 20;
      #0varcamp = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
|FPRC;

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;

|PROCESO mayor1;
  |HAZ mayor;
  |SI #0Campo = "N";
      |PARA x = 14;  |SI x [ 53;  |HACIENDO x = x + 1;
            |CAMPO_MODIFICA #0x,1,"S";
      |SIGUE;
      #0#10 = 0;
      #0#12 = 0;
      #0#11 = 0;
      #0#13 = 0;
      |CAMPO_MODIFICA #0#10,1,"N";
      |CAMPO_MODIFICA #0#12,1,"N";
      |CAMPO_MODIFICA #0#11,1,"N";
      |CAMPO_MODIFICA #0#13,1,"N";
      |PINTA #0#10;
      |PINTA #0#12;
      |PINTA #0#11;
      |PINTA #0#13;
  |SINO;
      |PARA x = 14;  |SI x [ 53;  |HACIENDO x = x + 1;
            #0x = 0;
            |CAMPO_MODIFICA #0x,1,"N";
      |SIGUE;
      |CAMPO_MODIFICA #0#10,1,"S";
      |CAMPO_MODIFICA #0#12,1,"S";
      |CAMPO_MODIFICA #0#11,1,"S";
      |CAMPO_MODIFICA #0#13,1,"S";
  |FINSI;
|FPRC;

|| --------------- comprueba desde-hasta empresas ---------------------------

|PROCESO buscaem1;
  |SI #30#21 = "I";  |ACABA; |FINSI;
  |SI #30#26 ! #0#0; |ACABA; |FINSI;
  leidos = 1;
  alfa1 = #30#2;
  alfa2 = #30#3;
|FPRC;

|DEFBUCLE buscaempre;
#30#1;
;
#0#10,desde;
#0#11,hasta;
e;
NULL,buscaem1;
|FIN;

|PROCESO buclempre;
  |SI #0#12 > #0#13;
      |MENAV "     ERROR EN INTRODUCCION";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #0#10 = 0;  |Y #0#11 = 0;  |ACABA;  |FINSI;
  desde = #0#12;
  hasta = #0#13;
  leidos = 0;
  |BUCLE buscaempre;
  |SI leidos = 0;
      |MENAV "    ATENCION SELECCION VACIA";
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO deshas;
  |SI #0#11 < #0#10;
      |MENAV "      Error en Introduccion";
      |ERROR;
  |FINSI;
|FPRC;

|| ------------------------------------------------------------------------

|PROCESO nomodi;
  |PARA x = Campo + 1;  |SI x [ 33;  |HACIENDO x = x + 1;
        #0x = 0;
        |CAMPO_MODIFICA #0x,1,"N";
        y = x + 20;
        #0y = 0;
        |CAMPO_MODIFICA #0y,1,"N";
  |SIGUE;
  y = Campo + 20;
  #0y = 0;
  |CAMPO_MODIFICA #0y,1,"N";
  |PINTA #0y;
|FPRC;

|PROCESO esbuena; || desde campo de empresas seleccion
  |SI FSalida = 2; |ACABA; |FINSI;
  |SI #0Campo = 0; |HAZ nomodi;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0Campo;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0Campo;
      |MENAV "     NO Existe la empresa Contable ";
      |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2;|ACABA;|FINSI;
  x = Campo - 20;
  |SI #0x = 0;  |ACABA;  |FINSI;
  |ABRE #30;
  x = Campo - 20;
  #30#2 = #0x;
  #30#3 = #0Campo;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la empresa Contable ";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #30;
  |SI #30#26 ! #0#0;
      |MENAV "     NO Corresponde Ejercicio Contable ";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #30#21 = "I";
      |MENAV men9;
      |ERROR;
      |ACABA;
  |FINSI;
  x = Campo + 20;
  #0x = #30#1;
  |PINTA #0x;
  x = Campo - 20;
  alfa1 = #0x;
  alfa2 = #0Campo;
|FPRC;

|| **********************************************************************
||                       CALCULOS DE IMPRESION
|| **********************************************************************

|| ---------- Seleccion DESDE / HASTA Empresa.

|PROCESO esdesd1;
  |SI #30#26 = #0#0; |Y #30#21 ! "I";
      |DBASE dir_fich;
      dirfich0 = dir_fich + "fich/";
      alfa1 = #30#2;
      alfa2 = #30#3;
      alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
      alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
      dirfich0 = dirfich0 + alfa1 + alfa2 + "/";
      |HAZ haztodo;
  |FINSI;
|FPRC;

|DEFBUCLE esdesde;
#30#1;
;
#0#10,#0#12;
#0#11,#0#13;
e;
NULL,esdesd1;
|FIN;

|| ---------- Seleccion en parrilla.

|PROCESO esunaauna;
  |PARA xx = 14;  |SI xx [ 33;  |HACIENDO xx = xx + 1;
        |SI #0xx = 0;  |SAL;  |FINSI;
        |DBASE dir_fich;
        dirfich0 = dir_fich + "fich/";
        yy = xx + 20;
        alfa1 = #0xx;
        alfa2 = #0yy;
        alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
        alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
        dirfich0 = dirfich0 + alfa1 + alfa2 + "/";
|| lee empresa
        |ABRE #30;
        #30#2 = #0xx;
        #30#3 = #0yy;
        |LEE 011#30=;
        |CIERRA #30;
        |SI #30#26 = #0#0; |Y #30#21 ! "I";
            |HAZ haztodo;
        |FINSI;
  |SIGUE;
|FPRC;

|| ***********************************************************************
|| ***************** PROCESO PRINCIPAL CON TIPO 3 ************************
|| ***********************************************************************

|PROCESO chequeo; |TIPO 3;

 |SI #0#8 = "NO"; |ACABA; |FINSI;

 |IMPRE 0;
 |SI FSalida ! 0; |ACABA; |FINSI;

 |INFOR informe;
 |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

  |PUSHV 2002 2378;
  |ATRI I;
  |CUADRO 2002 2378
  |ATRI N;
  |ATRI R;
  |PINTA 2103," EMPRESA:                                                                  ";
  |ATRI N;
  |PINTA 2203," En Proceso:                                                               ";
  |ATRI 0;

 |SI #0#9 = "S";
     |BUCLE esdesde;
 |SINO;
     |HAZ esunaauna;
 |FINSI;

 |FININF;
 |FINIMP;
|FPRC;

|| ***********************************************************************
____________________________________/   SOPORTADO

|PROCESO total_sop;
    nume1 = #2#8  + #2#9  + #2#10 + #2#52 + #2#53;
    nume2 = #2#14 + #2#15 + #2#16 + #2#56 + #2#57;
    nume3 = #2#20 + #2#21 + #2#22 + #2#60 + #2#61;
    nume4 = nume1 + nume2 + nume3;
|FPRC;

|PROCESO c_sop3;
    #3#0 = #2#45;
    #3#1 = #2#46;
    #3#2 = #2#47;
|LEE 000#3=;
|SI FSalida ! 0;|Y #2#47 ! 0;
        e = "Asiento Inexistente";
    |PRINT; sw_algun = 1;

        #2#45 = 0;
        #2#46 = "01.01.0001";
        #2#47 = 0;
|FINSI;
|FPRC;

|PROCESO c_sop2;

    nume1 = (base % porc) ! 0;

    nume2 = nume1 - cuot;     |SI nume2 < 0; nume2 = nume2 * -1; |FINSI;

|SI nume2 > #0#2;
    |SI punt =  1;  e = "IVA 1";        #2#14 = nume1; |FINSI;
    |SI punt =  2;  e = "IVA 2";        #2#15 = nume1; |FINSI;
    |SI punt =  3;  e = "IVA 3";        #2#16 = nume1; |FINSI;
    |SI punt =  4;  e = "IVA 4";        #2#56 = nume1; |FINSI;
    |SI punt =  5;  e = "IVA 5";        #2#57 = nume1; |FINSI;
    |SI punt =  6;  e = "Recargo 1";    #2#20 = nume1; |FINSI;
    |SI punt =  7;  e = "Recargo 2";    #2#21 = nume1; |FINSI;
    |SI punt =  8;  e = "Recargo 3";    #2#22 = nume1; |FINSI;
    |SI punt =  9;  e = "Recargo 4";    #2#60 = nume1; |FINSI;
    |SI punt = 10;  e = "Recargo 5";    #2#61 = nume1; |FINSI;
        e = "Error en " + e;
    |PRINT; sw_algun = 1;

    |HAZ total_sop;
|FINSI;
|FPRC;

|PROCESO c_sop1;
|HAZ total_sop;
    nume2 = nume4 - #2#26;
|SI nume2 < 0; nume2 = nume2 * -1; |FINSI;

|SI nume2 > #0#2;
        e = "Error en Importe Total";
    |PRINT; sw_algun = 1;

|FINSI;
|FPRC;

|PROCESO lee_sopor1;
    #0#3 = "IVA Soportado  ";      |PINTA #0#3;
    #0#4 = #2#0;                   |PINTA #0#4;
    #0#5 = #2#2;                   |PINTA #0#5;
    #0#6 = #2#27;                  |PINTA #0#6;

|HAZ c_sop1;             || total factura

    base = #2#8;    porc = #2#11;  cuot = #2#14;  punt =  1;|HAZ c_sop2;
    base = #2#9;    porc = #2#12;  cuot = #2#15;  punt =  2;|HAZ c_sop2;
    base = #2#10;   porc = #2#13;  cuot = #2#16;  punt =  3;|HAZ c_sop2;
    base = #2#52;   porc = #2#54;  cuot = #2#56;  punt =  4;|HAZ c_sop2;
    base = #2#53;   porc = #2#55;  cuot = #2#57;  punt =  5;|HAZ c_sop2;

    base = #2#8;    porc = #2#17;  cuot = #2#20;  punt =  6;|HAZ c_sop2;
    base = #2#9;    porc = #2#18;  cuot = #2#21;  punt =  7;|HAZ c_sop2;
    base = #2#10;   porc = #2#19;  cuot = #2#22;  punt =  8;|HAZ c_sop2;
    base = #2#52;   porc = #2#58;  cuot = #2#60;  punt =  9;|HAZ c_sop2;
    base = #2#53;   porc = #2#59;  cuot = #2#61;  punt = 10;|HAZ c_sop2;

|HAZ c_sop3;        || existencia asiento

|SI #0#1 = "S";
    |HAZ total_sop; #2#26 = nume4;
    |GRABA 020#2a;
|FINSI;
|LIBERA #2;
|FPRC;

|DEFBUCLE lee_sopor;
 #2#1;
 ;
  1, "  ",      1;
 99, "zz", 999999;
 be;
 NULL, lee_sopor1;
|FIN;
____________________________________/   REPERCUTIDO
|PROCESO total_rep;
    nume1 = #1#8  + #1#9  + #1#10 + #1#52 + #1#53;
    nume2 = #1#14 + #1#15 + #1#16 + #1#56 + #1#57;
    nume3 = #1#20 + #1#21 + #1#22 + #1#60 + #1#61;
    nume4 = nume1 + nume2 + nume3;
|FPRC;

|PROCESO c_rep3;
    #3#0 = #1#45;
    #3#1 = #1#46;
    #3#2 = #1#47;
|LEE 000#3=;
|SI FSalida ! 0;|Y #1#47 ! 0;
        e = "Asiento Inexistente";
    |PRINT; sw_algun = 1;

        #1#45 = 0;
        #1#46 = "01.01.0001";
        #1#47 = 0;
|FINSI;
|FPRC;

|PROCESO c_rep2;

    nume1 = (base % porc) ! 0;

    nume2 = nume1 - cuot;     |SI nume2 < 0; nume2 = nume2 * -1; |FINSI;

|SI nume2 > #0#2;
    |SI punt =  1;  e = "IVA 1";        #1#14 = nume1; |FINSI;
    |SI punt =  2;  e = "IVA 2";        #1#15 = nume1; |FINSI;
    |SI punt =  3;  e = "IVA 3";        #1#16 = nume1; |FINSI;
    |SI punt =  4;  e = "IVA 4";        #1#56 = nume1; |FINSI;
    |SI punt =  5;  e = "IVA 5";        #1#57 = nume1; |FINSI;
    |SI punt =  6;  e = "Recargo 1";    #1#20 = nume1; |FINSI;
    |SI punt =  7;  e = "Recargo 2";    #1#21 = nume1; |FINSI;
    |SI punt =  8;  e = "Recargo 3";    #1#22 = nume1; |FINSI;
    |SI punt =  9;  e = "Recargo 4";    #1#60 = nume1; |FINSI;
    |SI punt = 10;  e = "Recargo 5";    #1#61 = nume1; |FINSI;
        e = "Error en " + e;
    |PRINT; sw_algun = 1;

    |HAZ total_rep;
|FINSI;
|FPRC;

|PROCESO c_rep1;
|HAZ total_rep;
    nume2 = nume4 - #1#26;
|SI nume2 < 0; nume2 = nume2 * -1; |FINSI;

|SI nume2 > #0#2;
        e = "Error en Importe Total";
    |PRINT; sw_algun = 1;

|FINSI;
|FPRC;

|PROCESO lee_reper1;
    #0#3 = "IVA Repercutido";      |PINTA #0#3;
    #0#4 = #1#0;                   |PINTA #0#4;
    #0#5 = #1#2;                   |PINTA #0#5;
    #0#6 = #1#27;                  |PINTA #0#6;

|HAZ c_rep1;             || total factura

    base = #1#8;    porc = #1#11;  cuot = #1#14;  punt =  1;|HAZ c_rep2;
    base = #1#9;    porc = #1#12;  cuot = #1#15;  punt =  2;|HAZ c_rep2;
    base = #1#10;   porc = #1#13;  cuot = #1#16;  punt =  3;|HAZ c_rep2;
    base = #1#52;   porc = #1#54;  cuot = #1#56;  punt =  4;|HAZ c_rep2;
    base = #1#53;   porc = #1#55;  cuot = #1#57;  punt =  5;|HAZ c_rep2;

    base = #1#8;    porc = #1#17;  cuot = #1#20;  punt =  6;|HAZ c_rep2;
    base = #1#9;    porc = #1#18;  cuot = #1#21;  punt =  7;|HAZ c_rep2;
    base = #1#10;   porc = #1#19;  cuot = #1#22;  punt =  8;|HAZ c_rep2;
    base = #1#52;   porc = #1#58;  cuot = #1#60;  punt =  9;|HAZ c_rep2;
    base = #1#53;   porc = #1#59;  cuot = #1#61;  punt = 10;|HAZ c_rep2;

|HAZ c_rep3;        || existencia asiento

|SI #0#1 = "S";
    |HAZ total_rep; #1#26 = nume4;
    |GRABA 020#1a;
|FINSI;
|LIBERA #1;
|FPRC;

|DEFBUCLE lee_reper;
 #1#1;
 ;
  1, "  ",      1;
 99, "zz", 999999;
 be;
 NULL, lee_reper1;
|FIN;

|| ***********************************************************************

|PROCESO haztodo;
  enEmpresa = #canempre#2;
  enPeriodo = #canempre#3;
  swOperacion = 0
  |SUB_EJECUTA "camoneda.tab";

 |PATH_DAT #1 dirfich0;
 |PATH_DAT #2 dirfich0;
 |PATH_DAT #3 dirfich0;

  |ATRI R;
  |PINTA 2113, #30#2;
  |PINTA 2119, #30#3;
  |PINTA 2121, #30#1;
  |ATRI 0;

 sw_algun = 0;
 empcon = #30#1;
 ejecon = #30#26;

 |ABRE #3;
 |SI #0#7 = "R";|O #0#7 = "A"; |BUCLE lee_reper; |FINSI;
 |SI #0#7 = "S";|O #0#7 = "A"; |BUCLE lee_sopor; |FINSI;
 |CIERRA #3;
 |SI sw_algun = 1;
     |PIEINF;
 |FINSI;
|FPRC;
