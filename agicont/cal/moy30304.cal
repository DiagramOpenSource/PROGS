|FICHEROS;
     caemi303;
     caman303;
     dsm30304;
     dsm30305;
     caportad;

     t1730301;
     t1730303;
     t1730304;
|FIN;

|VARIABLES;
     informe = "";
     &dia = "";
     &mes = "";
     &anyo = "";
     alfa1 = "";
     sw = 0;
     imsn1 = "";
     imsn2 = "";

     aValfa0     = "";
     aValfa1     = "";
     aValfa2     = "";
     aValfa      = "";
     nPosi       = 0;
     nSwPunto    = 0;

     nCalc       = 0;
     nHandleError = 0;

     nAnyo2D      = 0;
     aAlfa        = "";
     aEnlace     = "";
     aHID        = "";
     aNDC        = "";
     aIDI        = "";
     aEJF        = "";
     aMOD        = "";
     aPRG        = "";
     aTIA        = "";
     aINI        = "";
     aFIN        = "";
     aAbrePortal = "";
     aTipo       = "";

     aAbre        = "";
     aModelos     = "";
     aOrigen      = "";
     aDestino     = "";

     nHandle1     = 0;
     nHandle2     = 0;
     nSwHay       = 0;
     nTCampo      = 0;
     nGraba       = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;
     nComa       = 0;
     nCaracter   = 0;
     nLong       = 0;
     nPos        = 0;
     nCampo      = 0;
     nError      = 0;

     aAlfa1      = "";
     aAlfa2      = "";
     aLong       = "";
     aCaracter   = "";

     aF2           = "";
     aF3           = "";
     aF4           = "";
     aF5           = "";
     aF6           = "";
     aEsc          = "";
     aTecla        = "";
     aFichError    = "";
     aTipoSec      = "";
     aPathEmision  = "";
     aFichero      = "";
     aUnidad       = "";

     nSwHoja4      = 0;
     nConta        = 0;
     nReg          = 0;
     nColumna      = 0;

     {1}aContiene  = "";

     &se_empre     = 0;
     &se_ejerc     = 0;
     &se_modelo    = "";
     &se_impor     = 0;
     &se_fecha     = "";
     &SwAgicli     = 0;
     &eaMonedEmpre = "";
     &eaFOrigen    = "";
     &eaFDestino   = "";
     &eaInternet   = "";
     &eaImpresora  = "";
     &enNume       = 0;
     &eaAlfa       = "";
     &eaDiaB       = "";
     &eaMesB       = "";
     &eaAnyoB      = "";
     &eaModelos    = "";
     &eaPathModelo = "";
     &eaPathEmision    = "";
     &eaPathAEAT       = "";
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &eaUnidadBasico = "";
     &enHandlePortal     = 0;
     &enPer              = 0;
     &enEmpresa          = 0;
     &enAnyo             = 0;
     &enSwTrata          = 0;
     &eaTipoSec          = "";
     &eaEjer             = "";
     &eaUnidad           = "";
     &eaPathLanza        = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroImpre     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &enTecla            = 0;
     &eaPeriodo          = "";
     &eaBIC              = "";
     &eaIBAN             = "";
     &eaPaginas          = "";
     &eaCampo0           = "";
     &eaCampo1           = "";
     &eaCampo3           = "";
     &eaCampo5           = "";
     &eaCampo6           = "";
     &eaCampo7           = "";
     &eaCampo8           = "";

     nTecla              = 0;
     perialf             = "";
     fFechaHoy = @;
|FIN;


|PROCESO t1730301ptrl;
     |PARA nCampo = 1;  |SI nCampo [ 72;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1730301#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|PROCESO t1730303ptrl;
     eaAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 63;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1730303#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|PROCESO t1730304;
     |PARA nCampo = 1;  |SI nCampo [ 70;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #t1730304#nCampo#;
           |XGRABA enHandlePortal, eaAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE t1730304;
     #t1730304#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, t1730304;
|FIN;

|PROCESO t1730304ptrl;
     |BUCLE t1730304;
|FPRC;

|PROCESO AbrePag_8111_2017;
     aEnlace = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";

     aHID    = "IE73030A";
     |SI #caemi303#1 ] 2018;
         aHID    = "IE83030A";
     |FINSI;

     aIDI    = "ES";
     aPRG    = "";
     aEJF    = eaEjer;
     aMOD    = "303";

     aINI = "<T3030" + #t1730301#10 + #t1730301#11 + "0000>";
     aFIN = "</T3030" + #t1730301#10 + #t1730301#11 + "0000>";

     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     eaAlfa = "Conectandose a la pagina de la aeat";
     |PINTA 1210, eaAlfa;

     aAbrePortal = eaPathEmision + "portal303.html";
     |XABRE "WB", aAbrePortal, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aEnlace + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + aIDI + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34 + aINI;
     |HAZ GrabaPortalSin;

     eaAlfa = "<AUX>";     |HAZ GrabaPortalSin;
     eaAlfa = " " * 70;    |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 9;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 213;   |HAZ GrabaPortalSin;
     eaAlfa = "</AUX>";    |HAZ GrabaPortalSin;

     |HAZ t1730301ptrl;
     |HAZ t1730303ptrl;
     |SI nSwHoja4 = 1; |HAZ t1730304ptrl; |FINSI;

     eaAlfa = aFIN + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + aEJF + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + aMOD + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = aAbrePortal;
     eaFDestino = eaPathLanza + "portal303.html";
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         eaAlfa = eaPathExplorador + " " + eaFDestino;
         eaAlfa  = "cmd " + &34 + "/c START /WAIT " + eaAlfa + &34;
     |SINO;
         eaAlfa  = "cmd " + &34 + "/c START /WAIT " + eaFDestino + &34;
     |FINSI;

     |RSYSTEM eaAlfa;

     |FBORRA eaFOrigen;

     |POPV;
|FPRC;

|PROCESO AbrePag_8212_2017;
     aAlfa = eaPathLanza + "*.*";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            |RFBORRA aAlfa;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathLanza + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aEJF = #caemi303#1;
     |SI #caemi303#1 [ 2017;
         aEJF = "0003";
     |FINSI;

     aAbre = eaPathLanza + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + "https://www2.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/ov/servurlp.html";
     |HAZ GrabaPortalSin;

     eaAlfa = "?WEB=INTERNET&PRG=" + "303";
     |HAZ GrabaPortalSin;

     eaAlfa = "&EJE=" + aEJF;
     |HAZ GrabaPortalSin;

     eaAlfa = "&URL=IMP" + &34 +  &13 + &10;
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathLanza + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO AbrePag_8312_2017;
     eaPathAEAT = eaUnidadBasico + "\AEAT";        |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + "303";  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + eaEjer;  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\" + (("00" + enPer) % -102);  |RMKDIR eaPathAEAT;
     eaPathAEAT = eaPathAEAT + "\";

     aAlfa = eaPathAEAT + "*.bat";  |QBT aAlfa;
     |R_PDIR aAlfa;
     |PARA; |SI; |HACIENDO;
            |SI FSalida ! 0; |SAL; |FINSI;

            aAlfa1 = (aAlfa % -103) < "";
            |SI aAlfa1 ! "txt";
                |RFBORRA aAlfa;
            |FINSI;

            |R_SDIR aAlfa;
     |SIGUE;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathAEAT + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aEJF = #caemi303#1;
     |SI #caemi303#1 [ 2017;
         aEJF = "0003";
     |FINSI;

     aAbre = eaPathAEAT + "imp" + Usuario + ".bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathExplorador + " ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + "https://www1.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/ov/servurlp.html";
     |HAZ GrabaPortalSin;

     eaAlfa = "?WEB=INTERNET&PRG=" + "303";
     |HAZ GrabaPortalSin;

     eaAlfa = "&EJE=" + aEJF;
     |HAZ GrabaPortalSin;

     eaAlfa = "&URL=PIR" + &34 +  &13 + &10;
     |HAZ GrabaPortalSin;

     eaAlfa = "";
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     aAlfa = "0000Ubicacion: " + eaPathAEAT + &13 + &10;
     aAlfa = aAlfa  + " Fichero: " + eaFicheroPlano;
     |MENAV aAlfa;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO GrabaImpreso04;
     #caman303#3 = #caemi303#5;
     #caman303#4 = "S";
     |GRABA 020#caman303.a;
     |LIBERA #caman303;

     se_ejerc  = #caportad#1;
     se_modelo = "303";
     se_impor  = #caman303#117;
     se_fecha  = #caman303#3;
     |SI SwAgicli = 1;
         |HAZ AlAgicl2;
     |FINSI;
|FPRC;

|PROCESO PresentaModelo_04;
     |SI eaOpcion = "1";
         |HAZ AbrePag_8212_2017;

         |HAZ GrabaImpreso04;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             eaFOrigen  = eaPathEmision  + eaFicheroPlano;
             eaFDestino = eaPathInternet + eaFicheroPlano;
             |HAZ CopiaFicheroPtl;
         |FINSI;
         |SI enPresentar = 1;
             |HAZ AbrePag_8312_2017;
         |FINSI;

         |HAZ GrabaImpreso04;
     |FINSI;

     |SI eaOpcion = "4";
         |HAZ AbrePag_8111_2017;
     |FINSI;
|FPRC;

|PROCESO BuscaNombre_04;
     |QBF eaAlfa;
     aAlfa1 = "";
     aAlfa2 = "";
     aLong  = eaAlfa % 0;
     nLong  = aLong;
     nComa  = 0;

     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = eaAlfa % nPos;

           |SI aCaracter = ",";
               nComa = 1;
           |SINO;
               |SI nComa = 0;
                   aAlfa1 = aAlfa1 + aCaracter;
               |SINO;
                   |SI aCaracter = " ";  |Y aAlfa2 = "";
                   |SINO;
                       aAlfa2 = aAlfa2 + aCaracter;
                   |FINSI;
               |FINSI;
           |FINSI;
      |SIGUE;
|FPRC;

|PROCESO TDeclaracion2017;
     |SI #caman303#32 ! 0;
         #t1730301#6 = "C";
     |FINSI;

     |SI #caman303#31 ! 0;
         #t1730301#6 = "D";
     |FINSI;

     |SI #caman303#33 ! 0;
                                #t1730301#6 = "I";
         |SI #caemi303#8 = "D"; #t1730301#6 = "U";  |FINSI;
     |FINSI;

     |SI #caman303#20  = 0; |Y #caman303#25  = 0; |Y #caman303#26 = 0;
      |Y #caman303#115 = 0; |Y #caman303#117 = 0; |Y #caman303#29 = 0;
         #t1730301#6 = "N";
     |FINSI;

     |SI #caman303#117 = 0;
         #t1730301#6 = "N";
     |FINSI;

     |SI #caemi303#8 ! "N";
         eaBIC  = #caportad#116;
         eaIBAN = #caportad#117;

         |QBF eaIBAN;
         |SI eaIBAN = "";  nError = 1;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Hoja1_2017;
     |DDEFECTO #t1730301;

     aAlfa       = #caportad#13;  |QBF aAlfa;
     #t1730301#7 = ("000000000" + aAlfa) % -109;

     aAlfa = #caportad#13 % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #caportad#2;      |HAZ BuscaNombre_04;
         eaAlfa = aAlfa1;    |HAZ QuitaRaros;   #t1730301#8   = eaAlfa;
         eaAlfa = aAlfa2;    |HAZ QuitaRaros;   #t1730301#9   = eaAlfa;
     |SINO;
         eaAlfa   = #caportad#2;  |HAZ QuitaRaros;  #t1730301#8 = eaAlfa;
                                                    #t1730301#9 = "";
     |FINSI;

     fFechaHoy = ~;
     |HAZ TDeclaracion2017;

     #t1730301#10  = eaEjer;

     |SI #caemi303#0 = "T";
         |SI #caman303#1 = 1;   #t1730301#11 = "1T";  |FINSI;
         |SI #caman303#1 = 2;   #t1730301#11 = "2T";  |FINSI;
         |SI #caman303#1 = 3;   #t1730301#11 = "3T";  |FINSI;
         |SI #caman303#1 = 4;   #t1730301#11 = "4T";  |FINSI;
     |SINO;
         #t1730301#11 = ("00" + #caman303#1) % -102;
     |FINSI;

     |SI #caman303#94  = "S";  #t1730301#12 = "1";  |FINSI;
     |SI #caman303#94  = "N";  #t1730301#12 = "2";  |FINSI;
                               #t1730301#13 = "3";    ||solo Regimen General

     |SI #caman303#95  = "S";  #t1730301#14 = "1";  |FINSI;
     |SI #caman303#95  = "N";  #t1730301#14 = "2";  |FINSI;
     |SI #caman303#100 = "S";  #t1730301#15 = "1";  |FINSI;
     |SI #caman303#100 = "N";  #t1730301#15 = "2";  |FINSI;

     aAlfa = "";
     |SI #caman303#101 ! "01.01.0000";
         aAlfa = (#caman303#101 % 102) + (#caman303#101 % 402) + (#caman303#101 % -104);
     |FINSI;
     #t1730301#16 = aAlfa;

     |SI #caman303#102 = "A";  #t1730301#17 = "1";  |FINSI;
     |SI #caman303#102 = "D";  #t1730301#17 = "2";  |FINSI;
     |SI #caman303#102 = "N";  #t1730301#17 = " ";  |FINSI;

     |SI #caman303#96 = "S";  #t1730301#18 = "1";  |FINSI;
     |SI #caman303#96 = "N";  #t1730301#18 = "2";  |FINSI;
     |SI #caman303#97 = "S";  #t1730301#19 = "1";  |FINSI;
     |SI #caman303#97 = "N";  #t1730301#19 = "2";  |FINSI;
     |SI #caman303#98 = "S";  #t1730301#20 = "1";  |FINSI;
     |SI #caman303#98 = "N";  #t1730301#20 = "2";  |FINSI;
     |SI #caman303#99 = "S";  #t1730301#21 = "1";  |FINSI;
     |SI #caman303#99 = "N";  #t1730301#21 = "2";  |FINSI;

     enNume = #caman303#5;    |HAZ Conver17;   #t1730301#22 = eaAlfa;
     enNume = #caman303#6  * 100;              #t1730301#23 = ("00000" + enNume) % -105;
     enNume = #caman303#7;    |HAZ Conver17;   #t1730301#24 = eaAlfa;
     enNume = #caman303#8;    |HAZ Conver17;   #t1730301#25 = eaAlfa;
     enNume = #caman303#9  * 100;              #t1730301#26 = ("00000" + enNume) % -105;
     enNume = #caman303#10;   |HAZ Conver17;   #t1730301#27 = eaAlfa;
     enNume = #caman303#11;   |HAZ Conver17;   #t1730301#28 = eaAlfa;
     enNume = #caman303#12 * 100;              #t1730301#29 = ("00000" + enNume) % -105;
     enNume = #caman303#13;   |HAZ Conver17;   #t1730301#30 = eaAlfa;
     enNume = #caman303#49;   |HAZ Conver17;   #t1730301#31 = eaAlfa;
     enNume = #caman303#50;   |HAZ Conver17;   #t1730301#32 = eaAlfa;
     enNume = #caman303#103;  |HAZ Conver17;   #t1730301#33 = eaAlfa;
     enNume = #caman303#104;  |HAZ Conver17;   #t1730301#34 = eaAlfa;
     enNume = #caman303#105;  |HAZ Conver17;   #t1730301#35 = eaAlfa;
     enNume = #caman303#106;  |HAZ Conver17;   #t1730301#36 = eaAlfa;
     enNume = #caman303#14;   |HAZ Conver17;   #t1730301#37 = eaAlfa;
     enNume = #caman303#15 * 100;              #t1730301#38 = ("00000" + enNume) % -105;
     enNume = #caman303#16;   |HAZ Conver17;   #t1730301#39 = eaAlfa;
     enNume = #caman303#17;   |HAZ Conver17;   #t1730301#40 = eaAlfa;
     enNume = #caman303#18 * 100;              #t1730301#41 = ("00000" + enNume) % -105;
     enNume = #caman303#19;   |HAZ Conver17;   #t1730301#42 = eaAlfa;
     enNume = #caman303#46;   |HAZ Conver17;   #t1730301#43 = eaAlfa;
     enNume = #caman303#47 * 100;              #t1730301#44 = ("00000" + enNume) % -105;
     enNume = #caman303#48;   |HAZ Conver17;   #t1730301#45 = eaAlfa;
     enNume = #caman303#107;  |HAZ Conver17;   #t1730301#46 = eaAlfa;
     enNume = #caman303#108;  |HAZ Conver17;   #t1730301#47 = eaAlfa;
     enNume = #caman303#20;   |HAZ Conver17;   #t1730301#48 = eaAlfa;
     enNume = #caman303#62;   |HAZ Conver17;   #t1730301#49 = eaAlfa;
     enNume = #caman303#21;   |HAZ Conver17;   #t1730301#50 = eaAlfa;
     enNume = #caman303#63;   |HAZ Conver17;   #t1730301#51 = eaAlfa;
     enNume = #caman303#43;   |HAZ Conver17;   #t1730301#52 = eaAlfa;
     enNume = #caman303#64;   |HAZ Conver17;   #t1730301#53 = eaAlfa;
     enNume = #caman303#22;   |HAZ Conver17;   #t1730301#54 = eaAlfa;
     enNume = #caman303#65;   |HAZ Conver17;   #t1730301#55 = eaAlfa;
     enNume = #caman303#44;   |HAZ Conver17;   #t1730301#56 = eaAlfa;
     enNume = #caman303#66;   |HAZ Conver17;   #t1730301#57 = eaAlfa;
     enNume = #caman303#51;   |HAZ Conver17;   #t1730301#58 = eaAlfa;
     enNume = #caman303#67;   |HAZ Conver17;   #t1730301#59 = eaAlfa;
     enNume = #caman303#58;   |HAZ Conver17;   #t1730301#60 = eaAlfa;
     enNume = #caman303#109;  |HAZ Conver17;   #t1730301#61 = eaAlfa;
     enNume = #caman303#110;  |HAZ Conver17;   #t1730301#62 = eaAlfa;
     enNume = #caman303#23;   |HAZ Conver17;   #t1730301#63 = eaAlfa;
     enNume = #caman303#24;   |HAZ Conver17;   #t1730301#64 = eaAlfa;
     enNume = #caman303#61;   |HAZ Conver17;   #t1730301#65 = eaAlfa;
     enNume = #caman303#25;   |HAZ Conver17;   #t1730301#66 = eaAlfa;
     enNume = #caman303#26;   |HAZ Conver17;   #t1730301#67 = eaAlfa;

     |SI #caman303#155 = " "; #t1730301#68 = "0";  |FINSI;
     |SI #caman303#155 = "S"; #t1730301#68 = "1";  |FINSI;
     |SI #caman303#155 = "N"; #t1730301#68 = "2";  |FINSI;

     #t1730301#73 = &13 + &10;
|FPRC;

|PROCESO Hoja3_2017;
     |DDEFECTO #t1730303;

     enNume = #caman303#54;   |HAZ Conver17;   #t1730303#5  = eaAlfa;
     enNume = #caman303#68;   |HAZ Conver17;   #t1730303#6  = eaAlfa;
     enNume = #caman303#69;   |HAZ Conver17;   #t1730303#7  = eaAlfa;
     enNume = #caman303#111;  |HAZ Conver17;   #t1730303#8  = eaAlfa;
     enNume = #caman303#112;  |HAZ Conver17;   #t1730303#9  = eaAlfa;
     enNume = #caman303#113;  |HAZ Conver17;   #t1730303#10 = eaAlfa;
     enNume = #caman303#114;  |HAZ Conver17;   #t1730303#11 = eaAlfa;
     enNume = #caman303#118;  |HAZ Conver17;   #t1730303#12 = eaAlfa;
     enNume = #caman303#26;   |HAZ Conver17;   #t1730303#13 = eaAlfa;
     enNume = #caman303#27 * 1000000;          #t1730303#14 = ("000000000" + enNume) % -109;
     enNume = #caman303#28;   |HAZ Conver17;   #t1730303#15 = eaAlfa;
     enNume = #caman303#119;  |HAZ Conver17;   #t1730303#16 = eaAlfa;
     enNume = #caman303#29;   |HAZ Conver17;   #t1730303#17 = eaAlfa;
     enNume = #caman303#30;   |HAZ Conver17;   #t1730303#18 = eaAlfa;
     enNume = #caman303#115;  |HAZ Conver17;   #t1730303#19 = eaAlfa;
     enNume = #caman303#116;  |HAZ Conver17;   #t1730303#20 = eaAlfa;
     enNume = #caman303#117;  |HAZ Conver17;   #t1730303#21 = eaAlfa;

     |SI #caman303#156 = "S";
         #t1730303#22 = "X";
         #t1730303#23 = #caman303#157;
     |FINSI;

     |SI #caman303#20  = 0; |Y #caman303#25  = 0; |Y #caman303#26 = 0;
      |Y #caman303#115 = 0; |Y #caman303#117 = 0;
         #t1730303#24 = "X";
     |FINSI;

     |SI #caman303#31 ! 0;
         #t1730303#25 = eaBIC;
         #t1730303#26 = eaIBAN;
     |FINSI;

     |SI #caman303#33 ! 0;
         #t1730303#26 = eaIBAN;
     |FINSI;

     #t1730303#27 = #caman303#123;
     #t1730303#28 = #caman303#121;
     #t1730303#29 = #caman303#127;
     #t1730303#30 = #caman303#125;
     #t1730303#31 = #caman303#131;
     #t1730303#32 = #caman303#129;
     #t1730303#33 = #caman303#135;
     #t1730303#34 = #caman303#133;
     #t1730303#35 = #caman303#139;
     #t1730303#36 = #caman303#137;
     #t1730303#37 = #caman303#143;
     #t1730303#38 = #caman303#141;

     |SI #caman303#144 = "S";
         #t1730303#39 = "X";
     |FINSI;

     enNume = #caman303#145;   |HAZ Conver17;   #t1730303#40 = eaAlfa;
     enNume = #caman303#146;   |HAZ Conver17;   #t1730303#41 = eaAlfa;
     enNume = #caman303#164;   |HAZ Conver17;   #t1730303#42 = eaAlfa;
     enNume = #caman303#148;   |HAZ Conver17;   #t1730303#43 = eaAlfa;
     enNume = #caman303#149;   |HAZ Conver17;   #t1730303#44 = eaAlfa;
     enNume = #caman303#150;   |HAZ Conver17;   #t1730303#45 = eaAlfa;
     enNume = #caman303#151;   |HAZ Conver17;   #t1730303#46 = eaAlfa;
     enNume = #caman303#152;   |HAZ Conver17;   #t1730303#47 = eaAlfa;
     enNume = #caman303#153;   |HAZ Conver17;   #t1730303#48 = eaAlfa;

     enNume = #caman303#160 * 100;              #t1730303#50 = ("00000" + enNume) % -105;
     enNume = #caman303#161 * 100;              #t1730303#51 = ("00000" + enNume) % -105;
     enNume = #caman303#162 * 100;              #t1730303#52 = ("00000" + enNume) % -105;
     enNume = #caman303#163 * 100;              #t1730303#53 = ("00000" + enNume) % -105;

     enNume = #caman303#165;   |HAZ Conver17;   #t1730303#54 = eaAlfa;
     enNume = #caman303#166;   |HAZ Conver17;   #t1730303#55 = eaAlfa;
     enNume = #caman303#167;   |HAZ Conver17;   #t1730303#56 = eaAlfa;
     enNume = #caman303#168;   |HAZ Conver17;   #t1730303#57 = eaAlfa;
     enNume = #caman303#169;   |HAZ Conver17;   #t1730303#58 = eaAlfa;
     enNume = #caman303#170;   |HAZ Conver17;   #t1730303#59 = eaAlfa;

     #t1730303#64 = &13 + &10;
|FPRC;

|PROCESO dsm30304_04;

     |SI #dsm30304#6 = 0; |Y #dsm30304#7 = 0;
         |ACABA;
     |FINSI;

     nConta = nConta + 1;
     |SI nConta = 6;
         nConta = 1;
         nReg   = nReg + 1;
     |FINSI;

     #t1730304#0 = nReg;
     |LEE 101#t1730304.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1730304;
         #t1730304#0  = nReg;

         |SI nReg ! 0;
             #t1730304#5  = "C";
         |FINSI;

         #t1730304#71 = &13 + &10;

         |GRABA 020#t1730304.b;
     |FINSI;

     nColumna = nConta;
     nCampo   = 6 + (nColumna - 1) * 5;

     #t1730304#nCampo# = #dsm30304#5;

     nCampo = nCampo + 1;
     enNume = #dsm30304#6;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30304#7;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     #t1730304#nCampo# = #dsm30304#8;

     nCampo = nCampo + 1;
     |SI #dsm30304#9 ! 0;
         enNume = #dsm30304#9 * 100;
         aAlfa  = enNume;
         aAlfa  = ("00000" + aAlfa) % -105;
         #t1730304#nCampo# = aAlfa;
     |FINSI;

     |GRABA 020#t1730304.a;
     |LIBERA #t1730304;
     nSwHoja4 = 1;
|FPRC;

|DEFBUCLE dsm30304_04;
     #dsm30304#1;
     ;
     #caman303#45, #caman303#1, #caman303#2, 01;
     #caman303#45, #caman303#1, #caman303#2, 99;
     ;
     NULL, dsm30304_04;
|FIN;

|PROCESO dsm30305_04;
     nConta = nConta + 1;
     |SI nConta = 3;
         nConta = 1;
         nReg   = nReg + 1;
     |FINSI;

     #t1730304#0 = nReg;
     |LEE 101#t1730304.=;
     |SI FSalida ! 0;
         |DDEFECTO #t1730304;
         #t1730304#0  = nReg;

         |SI nReg ! 0;
             #t1730304#5  = "C";
         |FINSI;

         #t1730304#71 = &13 + &10;

         |GRABA 020#t1730304.b;
     |FINSI;

     nColumna = nConta; nCampo = 31;
     |SI nColumna = 2;  nCampo = 49; |FINSI;

     enNume = #dsm30305#4;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#5;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#6;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#7;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#8;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#9;    |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#10;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#11;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#12;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#13;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#14;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#15;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#16;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#17;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#18;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#19;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#20;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     nCampo = nCampo + 1;
     enNume = #dsm30305#21;   |HAZ Conver17; #t1730304#nCampo# = eaAlfa;

     |GRABA 020#t1730304.a;
     |LIBERA #t1730304;
     nSwHoja4 = 1;
|FPRC;

|DEFBUCLE dsm30305_04;
     #dsm30305#1;
     ;
     #caman303#45, #caman303#1, #caman303#2, 1;
     #caman303#45, #caman303#1, #caman303#2, 9;
     ;
     NULL, dsm30305_04;
|FIN;

|PROCESO Hoja4_2017;

     aFichero = "t1730304" + Usuario;
     |NOME_DAT #t1730304#aFichero#;
     |ABRE #t1730304;  |CIERRA #t1730304;  |DELINDEX #t1730304;

     |ABRE #t1730304;
     nConta = 0; nReg = 0; |BUCLE dsm30304_04;
     nConta = 0; nReg = 0; |BUCLE dsm30305_04;
     |CIERRA #t1730304;
|FPRC;

|PROCESO Carga2017;

     nSwHoja4 = 0;
     |HAZ Hoja1_2017;
     |HAZ Hoja3_2017;
     |SI #caman303#1 = 12;
         |HAZ Hoja4_2017;
     |FINSI;

     aINI = "<T3030" + #t1730301#10 + #t1730301#11 + "0000>";
     aFIN = "</T3030" + #t1730301#10 + #t1730301#11 + "0000>";

     eaAlfa = aINI;        |HAZ GrabaPortalSin;
     eaAlfa = "<AUX>";     |HAZ GrabaPortalSin;
     eaAlfa = " " * 70;    |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 4;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 9;     |HAZ GrabaPortalSin;
     eaAlfa = " " * 213;   |HAZ GrabaPortalSin;
     eaAlfa = "</AUX>";    |HAZ GrabaPortalSin;

     |HAZ t1730301ptrl;
     |HAZ t1730303ptrl;
     |SI nSwHoja4 = 1; |HAZ t1730304ptrl; |FINSI;

     eaAlfa = aFIN;
     |HAZ GrabaPortalSin;
|FPRC;

|PROCESO Botones303_2017;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda ", 0513, 0654, BotonF2;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica      ", 0813, 0954, BotonF3;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Borrador ", 1113, 1254, BotonF4;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Predeterminar Explorador de internet ", 1413, 1554, BotonF5;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, BotonEsc;
     nBoton5 = FSalida;

     eaForzExplorador = "S";

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF5  = &255 + "827";
     aEsc = &255 + "806";

     eaOpcion = "0";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  eaOpcion = "1"; |SAL;  |FINSI;
         |SI aTecla = aF3;  eaOpcion = "3"; |SAL;  |FINSI;
         |SI aTecla = aF4;  eaOpcion = "4"; |SAL;  |FINSI;
         |SI aTecla = aF5; |HAZ Explorador;        |FINSI;
         |SI aTecla = aEsc;                 |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |SI eaOpcion = "1";  enTecla = 1;  |FINSI;
     |SI eaOpcion = "3";  enTecla = 3;  |FINSI;
     |SI eaOpcion = "4";  enTecla = 1;  |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Bloque2017;
     |ABRE #caportad;
     #caportad#0 = enEmpresa;
     #caportad#1 = nAnyo2D;
     |LEE 000#caportad.=;
     |SI FSalida ! 0;
         |MENAV "     ATENCION! NO existen datos en PORTADAS MOD. OFICIALES";
         |CIERRA #caportad;
         |ACABA;
     |FINSI;

     |HAZ LeeUnidad;
     eaModelos  = "303";
     eaPeriodo  = ("00" + enPer) % -102;

     perialf = eaPeriodo;
     |SI #caemi303#0 = "T";
         |SI #caemi303#3 = 1;  perialf = "1T"; |FINSI;
         |SI #caemi303#3 = 2;  perialf = "2T"; |FINSI;
         |SI #caemi303#3 = 3;  perialf = "3T"; |FINSI;
         |SI #caemi303#3 = 4;  perialf = "4T"; |FINSI;
     |FINSI;

     eaPathLanza = eaUnidad + "\AEAT";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     eaPathModelo = eaUnidad + "\MODELOS";
     eaPathModelo = eaPathModelo + "\" + eaModelos;
     eaPathModelo = eaPathModelo + "\" + eaEjer;
     eaPathModelo = eaPathModelo + "\" + perialf;
     eaPathModelo = eaPathModelo + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ Botones303_2017;
     |SI enTecla = 0;  |ACABA;  |FINSI;

     |ABRE #caman303;
     #caman303#45 = #caemi303#0;
     #caman303#1  = #caemi303#3;
     #caman303#2  = nAnyo2D;
     |LEE 000#caman303.=;
     |SI FSalida ! 0;  |O #caman303#4 ! #caemi303#7;
         |CIERRA #caman303;
         |ACABA;
     |FINSI;

     nSwHay = 0;
     |HAZ AlAgicl1; || lee Modulo Integrador ....

     eaFicheroPlano = "303" + (("00000" + #caportad#0) % -105) + ".txt";
     eaFicheroImpre = "303" + (("00000" + #caportad#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #caportad#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     eaPaginas  = "00100010030001FIN";

     enPresentar = 0;
     |SI eaOpcion = "3";
         |CONFI "0000SPresentamos la declaracion en el momento de crearlas";
         |SI FSalida = 0;
             enPresentar = 1;
         |FINSI;
     |FINSI;

     |HAZ Carga2017;

     |XCIERRA nHandle2;


     eaNomEmpresa = #caportad#2;

     |HAZ PresentaModelo_04;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;

     |CIERRA #caman303;
|FPRC;

|PROCESO moy30304;
     |HAZ LeeUnidadBasico;

     aAlfa       = #caemi303#1 % -102;
     nAnyo2D     = aAlfa;
     enAnyo      = #caemi303#1;
     eaTipoSec   = "303";
     aTipoSec    = "303";
     enPer       = #caemi303#3;
     eaEjer      = #caemi303#1;

     |HAZ Bloque2017;
|FPRC;
