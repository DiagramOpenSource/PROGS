|FICHEROS;
   camar115 #0;
   catra115 #2;
   caman115 #20;
|FIN;

|VARIABLES;

  alfa1 = "";
  alfa2 = "";
  alfa3 = "";
  alfa4 = "";
  nume1 = 0;
  nume2 = 0;
  nume3 = 0;
  nume4 = 0;
  estado = 0;

  meses = 0;
  campobas1 = 0;
  camporet1 = 0;
  campobas2 = 0;
  camporet2 = 0;

  campotA1 = 0;
  campotA2 = 0;
  campotB1 = 0;
  campotB2 = 0;
  campotR1 = 0;
  campotR2 = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE tempo_i;

|| **********************************************************************

|PROGRAMA;
 |HAZ inicio;
 |CLS;
 |CABEZA "Modelo 115";
 |PINPA #0#0;
 |ABRE #0;
 #0#0 = cod1;
 #0#2 = #30#26;
 |LEE 000#0=;
 |SI FSalida ! 0;
     |DDEFECTO #0;
     #0#0 = cod1;
     #0#2 = #30#26;
     |GRABA 020#0b;
 |FINSI;
 |PINDA #0#0;
 |CONFI "2400SRecalcular Modelo con los datos de Arrendadores ? ";
 |SI FSalida = 0;
     |HAZ recalcul;
 |FINSI;

 |PINDA #0#0;
 |ENDATOS #1#0;
 |SI FSalida = 0;
     |GRABA 020#0a;
 |FINSI;

 |LIBERA #0;
 |CIERRA #0;
|FPRO;

|| ************************************************************
|| Proceso para Recalcular
|| ************************************************************
_____________________________________/ CARGA DEL TEMPORAL POR NIF's
|PROCESO por_dnis2;
  |DDEFECTO #2;
  #2#0  = #20#0;
  #2#7  = #20#7;       || dni
  |LEE 101#2=;
  estado = FSalida;
  #2#12 = 1;  #2#13 = 2;

  nume3 = 0; |SI #20#12 = 2; nume3 = 26; |FINSI;
  |PARA nume1 = 23; |SI nume1 [ 48; |HACIENDO nume1 = nume1 + 1;
        nume2 = nume1 + nume3;
        #2nume2 = #2nume2 + #20nume1;
  |SIGUE;

  nume3 = 0; |SI #20#13 = 1; nume3 = - 26; |FINSI;
  |PARA nume1 = 49; |SI nume1 [ 74; |HACIENDO nume1 = nume1 + 1;
        nume2 = nume1 + nume3;
        #2nume2 = #2nume2 + #20nume1;
  |SIGUE;

  #2#0  = #20#0;
  #2#7  = #20#7;       || dni
  |SI estado = 0;  |GRABA 000#2a;  |FINSI;
  |SI estado ! 0;  |GRABA 000#2n;  |FINSI;
  |LIBERA #2;
|FPRC;

|DEFBUCLE temporal;
  #20#1;
  135;
  #0#0, 00000, #0#2, "5";
  #0#0, 99999, #0#2, "5";
  e;
  NULL, por_dnis2;
|FIN;

|| -----------------------------------------------------------
|PROCESO lasuma;
 |PARA meses = 1; |SI meses [ 12;  |HACIENDO meses = meses + 1;
       campobas1 = meses +  22;
       camporet1 = meses +  35;
       campobas2 = meses +  48;
       camporet2 = meses +  61;

       campotA1 = meses + 3;  campotA2 = meses + 39;
       campotB1 = meses + 15; campotB2 = meses + 51;
       campotR1 = meses + 27; campotR2 = meses + 63;

       #0campotB1 = #0campotB1 + #2campobas1;   || total bases  1
       #0campotR1 = #0campotR1 + #2camporet1;   || total reten. 1
       |SI #2campobas1 ! 0; |O #2camporet1 ! 0;
           #0campotA1 = #0campotA1 + 1;
       |FINSI;

       #0campotB2 = #0campotB2 + #2campobas2;   || total bases  2
       #0campotR2 = #0campotR2 + #2camporet2;   || total reten. 2
       |SI #2campobas2 ! 0; |O #2camporet2 ! 0;
           #0campotA2 = #0campotA2 + 2;
       |FINSI;
  |SIGUE;
|FPRC;

|DEFBUCLE altas;
  #2#1;
  ;
  #0#0, "            ";
  #0#0, "zzzzzzzzzzzz";
  ;
  NULL, lasuma;
|FIN;

|PROCESO recalcul;
  |PINTA 2405, "Preparando Temporal por NIF's ... ";
  |ABRE #2;  |CIERRA #2;  |DELINDEX #2;

  |NOPARA;
  |ABRE #2;
  |BUCLE temporal;
  |CIERRA #2;
  |SIPARA;

  |PINTA 2405, "                                  ";

  |PDEFECTO #0, 4, 76;
  |BUCLE altas;
|FPRC;
