|FICHEROS;
   cainfcol #0;
   catmpcol #1;
   catmpco1 #2;

   cacuenta #10;
   camaasil #11;

   canempr@ #12;
|FIN;

|VARIABLES;
   nCont = 0;

   nParte1 = 0; nParte2 = 0;
   aParte1 = ""; aParte2 = "";

   aLong = ""; nLong = 0;
   MaxDig = 0;

   Calc    = 0;
   nImporte = 0;

   Comodin = ""; Comodin1 = ""; LongAlfa = "";
   Empres = 1;   Cont = 0;      Long = 0;
   Empresa = 1;

   DEmpre = 0; HEmpre = 0;
   DPerio = 0; HPerio = 0;
   RepAnt = "";

   Opcion = 0;
   &SwCta = 0;  &SwApC = 0;  &SwApL = 0; &SwApT = 0;
   &SwCtaL = 0; &SwCtaC = 0; &SwRep = 0; &SwBlk = 0;
   &ContLin = 0;

   &Emp1  = 0; &Emp2  = 0; &Emp3  = 0;
   &TEmp1 = 0; &TEmp2 = 0; &TEmp3 = 0;

   &Col1  = 0; &Col2  = 0; &Col3  = 0;
   &TCol1 = 0; &TCol2 = 0; &TCol3 = 0;
   &Continua = "";

   First = 0;

   NumLins = 66;
   Calc1 = 0;

{-1}menu  = "";
    menu1 = "2400";
    menu2 = "1";
    menu3 = "Elija formato: ";
    menu4 = "RD";
    menu5 = " Reducido ";
    menu6 = " Detallado ";
 &EURO = 1;
 &EURODB = 0;
 &EURODV = 0;
 &EUROTEXTO = "Cambio de Moneda";
 &swOperacion = 0;  || 0 = Lectura / 1 = Alta
 &enEmpresa = 0;
 &enPeriodo = 0;
 &eaMoneda  = "";
|FIN;

|PROCESO MiraEmpresa;
   |SI FSalida = 2; |ACABA; |FINSI;

   Empres = Campo - 1;
   |SI #cainfcol#Empres# = 0; |Y #cainfcol#Campo# = 0; |ACABA; |FINSI;

   |DBASE Comodin;
   Comodin1 = Comodin + "def/canempre.mas";
   Comodin = Comodin + "fich/";
   |CARGA_DEF Comodin1, canempr@;
   |SI FSalida ! 0;
      |MENAV "    Problemas al cargar el def";
      |PTEC 807;
   |SINO;
      |PATH_DAT #12 Comodin;
      |ABRE #canempr@;
      #canempr@#2 = #cainfcol#Empres#;
      #canempr@#3 = #cainfcol#Campo#;
      |LEE 010#canempr@.=;
      |SI FSalida ! 0;
         |MENAV "    Empresa inexistente";
         |ERROR;
          enEmpresa = #canempr@#2;
          enPeriodo = #canempr@#3;
          swOperacion = 1;
          |SUB_EJECUTA "camoneda.tab";
      |FINSI;
      |CIERRA #canempr@;
      |DESCARGA_DEF #canempr@;
   |FINSI;

|FPRC;

|PROCESO Detalle;
   || CLASIFICO POR EMPRESA

   |SI #catmpco1#11 = #cainfcol#4; |Y #catmpco1#12 = #cainfcol#5;
      Emp1 = #catmpco1#10; Emp2 = 0; Emp3 = 0;
   |FINSI;
   |SI #catmpco1#11 = #cainfcol#6; |Y #catmpco1#12 = #cainfcol#7;
      Emp2 = #catmpco1#10; Emp1 = 0; Emp3 = 0;
   |FINSI;
   |SI #catmpco1#11 = #cainfcol#8; |Y #catmpco1#12 = #cainfcol#9;
      Emp3 = #catmpco1#10; Emp2 = 0; Emp1 = 0;
   |FINSI;
   TEmp1 = TEmp1 + Emp1; TEmp2 = TEmp2 + Emp2; TEmp3 = TEmp3 + Emp3;

   || CLASIFICO POR CONCEPTO

   Col1 = 0; Col2 = 0; Col3 = 0;
   |SI #cainfcol#10 ! 0;
      |SI #catmpco1#7 ] #cainfcol#10; |Y #catmpco1#7 [ #cainfcol#11;
         Col1 = #catmpco1#10;
     |FINSI;
   |SINO;
      |PARA nCont = 24; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;
         |SI #catmpco1#7 = #cainfcol#nCont#;
            Col1 = #catmpco1#10;
         |FINSI;
      |SIGUE;
   |FINSI;

   |SI #cainfcol#10 ! 0;
      |SI #catmpco1#7 ] #cainfcol#13; |Y #catmpco1#7 [ #cainfcol#14;
         Col2 = #catmpco1#10;
      |FINSI;
   |SINO;
      |PARA nCont = 31; |SI nCont [ 37; |HACIENDO nCont = nCont + 1;
         |SI #catmpco1#7 = #cainfcol#nCont#;
            Col2 = #catmpco1#10;
         |FINSI;
      |SIGUE;
   |FINSI;

   |SI #cainfcol#10 ! 0;
      |SI #catmpco1#7 ] #cainfcol#16; |Y #catmpco1#7 [ #cainfcol#17;
         Col3 = #catmpco1#10;
      |FINSI;
   |SINO;
      |PARA nCont = 38; |SI nCont [ 44; |HACIENDO nCont = nCont + 1;
         |SI #catmpco1#7 = #cainfcol#nCont#;
            Col3 = #catmpco1#10;
         |FINSI;
      |SIGUE;
   |FINSI;
   TCol1 = TCol1 + Col1; TCol2 = TCol2 + Col2; TCol3 = TCol3 + Col3;

   |SI First = 0; SwApC = 1; First = 1; |FINSI;
   |SI SwApC = 1;
      Calc1 = NumLins - 4;
      |SI ContLin [ Calc1;
         SwApL = 0;
         ContLin = ContLin + 3;
         |PRINT;
         SwApC = 0; SwApL = 1;
         |PRINT; ContLin = ContLin + 1;
      |SINO;
         SwApL = 0;
         SwApC = 0;
         SwApT = 1; ContLin = ContLin + 3; |PRINT; SwApT = 0;
         |HAZ VeteFinal; |PIEINF;
         ContLin = 5;
         Continua = "(Continuacion)";
         SwRep = 1; SwCtaC = 1; SwCtaL = 1; SwApC = 1; |PRINT; ContLin = ContLin + 9;
         SwRep = 0; SwCtaC = 0; SwCtaL = 0; SwApC = 0; SwApL = 1;
         Continua = "";
      |FINSI;
   |SINO;
      Calc1 = NumLins - 4;
      |SI ContLin [ Calc1;
         |PRINT; ContLin = ContLin + 1;
      |SINO;
         SwApL = 0;
         SwApT = 1; ContLin = ContLin + 3; |PRINT; SwApT = 0;
         |HAZ VeteFinal; |PIEINF;
         ContLin = 5;
         Continua = "(Continuacion)";
         SwRep = 1; SwCtaC = 1; SwCtaL = 1; SwApC = 1; |PRINT; ContLin = ContLin + 9;
         SwRep = 0; SwCtaC = 0; SwCtaL = 0; SwApC = 0; SwApL = 1;
         Continua = "";
      |FINSI;
   |FINSI;

|FPRC;

|DEFBUCLE Detalle;
#catmpco1#1;
;
#catmpcol#0,00,"01.01.1900",000001,0001,00001,0;
#catmpcol#0,99,"31.12.2999",999999,9999,99999,9;
;
NULL,Detalle;
|FIN;

|PROCESO Cuentas;
   |SI #cainfcol#23 = "N"; |Y #catmpcol#5 = 0; |ACABA; |FINSI;

      SwCtaL = 1;
      |SI RepAnt ! #catmpcol#9;
         RepAnt = #catmpcol#9;
         Calc1 = NumLins - 6;
         |SI ContLin > Calc1;
            SwCtaL = 0; |HAZ VeteFinal; |PIEINF; SwCtaL = 1;
            ContLin = 5;
         |FINSI;
         SwCtaC = 0; SwCtaL = 0;
         SwRep = 1; |PRINT; ContLin = ContLin + 3; SwRep = 0;
         Calc1 = NumLins - 3;
         |SI ContLin > Calc1;
            SwCtaC = 0; |HAZ VeteFinal; |PIEINF; SwCtaC = 1;
            ContLin = 5;
         |FINSI;
         SwCtaC = 1; |PRINT; ContLin = ContLin + 2; SwCtaC = 0;
         SwCtaL = 1; |PRINT; ContLin = ContLin + 1;
         |SI Opcion = 2;
            SwCtaL = 0; First = 0;
            |BUCLE Detalle;
            SwApC = 0; SwApL = 0;
            SwApT = 1; ContLin = ContLin + 3; |PRINT; SwApT = 0;
            TEmp1 = 0; TEmp2 = 0; TEmp3 = 0;
            TCol1 = 0; TCol2 = 0; TCol3 = 0;
            |SI First = 1;
               SwBlk = 1;
               |PRINT; ContLin = ContLin + 1;
            |FINSI;
            SwBlk = 0;
|| PEPE
            |SI #cainfcol#22 = "S";
               |HAZ VeteFinal; |PIEINF;
               ContLin = 5;
            |FINSI;
            SwRep = 1; SwCtaC = 1; |PRINT; SwCtaC = 0; SwRep = 0;
            ContLin = ContLin + 5;
|| PEPE
            SwCtaL = 1;
         |FINSI;
      |SINO;
         Calc1 = NumLins - 1;
         |SI ContLin > Calc1;
            SwCtaL = 0; |HAZ VeteFinal; |PIEINF; ContLin = 5;
            SwCtaC = 1; |PRINT; ContLin = ContLin + 2; SwCtaC = 0;
            SwCtaL = 1;
         |FINSI;
         |PRINT; ContLin = ContLin + 1;
         |SI Opcion = 2;
            SwCtaL = 0; First = 0;
            |BUCLE Detalle;
            SwApC = 0; SwApL = 0;
            SwApT = 1; ContLin = ContLin + 3; |PRINT; SwApT = 0;
            TEmp1 = 0; TEmp2 = 0; TEmp3 = 0;
            TCol1 = 0; TCol2 = 0; TCol3 = 0;
            |SI First = 1;
               SwBlk = 1;
               |PRINT; ContLin = ContLin + 1;
            |FINSI;
            SwBlk = 0;
|| PEPE
            |SI #cainfcol#22 = "S";
               |HAZ VeteFinal; |PIEINF;
               ContLin = 5;
            |FINSI;
            SwRep = 1; SwCtaC = 1; |PRINT; SwCtaC = 0; SwRep = 0;
            ContLin = ContLin + 5;
|| PEPE
            SwCtaL = 1;
         |FINSI;
      |FINSI;
|FPRC;

|DEFBUCLE Cuentas;
#catmpcol#1;
;
INICIO;
FINAL;
;
NULL,Cuentas;
|FIN;

|PROCESO RellenaTempo;

   |SI #camaasil#8 = "D";
      nImporte = #camaasil#9;
   |SINO;
      nImporte = 0 - #camaasil#9;
   |FINSI;

   |DDEFECTO #catmpco1;
   #catmpco1#0  = #camaasil#4;
   #catmpco1#1  = #camaasil#0;
   #catmpco1#2  = #camaasil#1;
   #catmpco1#3  = #camaasil#2;
   #catmpco1#4  = #camaasil#3;
   #catmpco1#5  = #camaasil#16;
   #catmpco1#6  = #camaasil#10;
   #catmpco1#7  = #camaasil#6;
   #catmpco1#8  = #camaasil#7;
   #catmpco1#9  = #camaasil#21;
   #catmpco1#10 = nImporte;
   |SI Empresa = 1; #catmpco1#11 = #cainfcol#4; #catmpco1#12 = #cainfcol#5; |FINSI;
   |SI Empresa = 2; #catmpco1#11 = #cainfcol#6; #catmpco1#12 = #cainfcol#7; |FINSI;
   |SI Empresa = 3; #catmpco1#11 = #cainfcol#8; #catmpco1#12 = #cainfcol#9; |FINSI;
   |GRABA 020#catmpco1.n;

   #catmpcol#9 = #camaasil#21;
   #catmpcol#0 = #camaasil#4;
   |LEE 010#catmpcol.=;
   |SI FSalida ! 0;
      |DDEFECTO #catmpcol;
      #cacuenta#0 = #camaasil#4;
      #cacuenta#1 = #camaasil#5;
      |LEE 010#cacuenta.=;
      |SI FSalida = 0;
         #catmpcol#1 = #cacuenta#2;
      |FINSI;
      #catmpcol#0 = #camaasil#4;
      #catmpcol#9 = #camaasil#21;
      |GRABA 020#catmpcol.b;
   |FINSI;

   |SI Empresa = 1; #catmpcol#2 = #catmpcol#2 + nImporte; |FINSI;
   |SI Empresa = 2; #catmpcol#3 = #catmpcol#3 + nImporte; |FINSI;
   |SI Empresa = 3; #catmpcol#4 = #catmpcol#4 + nImporte; |FINSI;
   #catmpcol#5 = #catmpcol#2 + #catmpcol#3 + #catmpcol#4;

   |SI #cainfcol#10 ! 0;
      |SI #camaasil#6 ] #cainfcol#10; |Y #camaasil#6 [ #cainfcol#11;
         #catmpcol#6 = #catmpcol#6 + nImporte;
      |FINSI;
   |SINO;
      |PARA nCont = 24; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;
         |SI #camaasil#6 = #cainfcol#nCont#;
            #catmpcol#6 = #catmpcol#6 + nImporte;
         |FINSI;
      |SIGUE;
   |FINSI;

   |SI #cainfcol#13 ! 0;
      |SI #camaasil#6 ] #cainfcol#13; |Y #camaasil#6 [ #cainfcol#14;
         #catmpcol#7 = #catmpcol#7 + nImporte;
      |FINSI;
   |SINO;
      |PARA nCont = 31; |SI nCont [ 37; |HACIENDO nCont = nCont + 1;
         |SI #camaasil#6 = #cainfcol#nCont#;
            #catmpcol#7 = #catmpcol#7 + nImporte;
         |FINSI;
      |SIGUE;
   |FINSI;

   |SI #cainfcol#16 ! 0;
      |SI #camaasil#6 ] #cainfcol#16; |Y #camaasil#6 [ #cainfcol#17;
         #catmpcol#8 = #catmpcol#8 + nImporte;
      |FINSI;
   |SINO;
      |PARA nCont = 38; |SI nCont [ 44; |HACIENDO nCont = nCont + 1;
         |SI #camaasil#6 = #cainfcol#nCont#;
            #catmpcol#8 = #catmpcol#8 + nImporte;
         |FINSI;
      |SIGUE;
   |FINSI;

   #catmpcol#9 = #camaasil#21;

   |GRABA 020#catmpcol.a;

   |ABRE #catmpco1;
   |DDEFECTO #catmpco1;
   |CIERRA #catmpco1;
|FPRC;

|DEFBUCLE RellenaTempo;
#camaasil#3;
21;
#cainfcol#0,0,#cainfcol#2,000001,#cainfcol#19;
#cainfcol#1,9,#cainfcol#3,999999,#cainfcol#20;
;
NULL,RellenaTempo;
|FIN;

|PROCESO Empresas;
   Comodin1 = Comodin + "fich/";
   Comodin1 = Comodin1 + (("00000" + #canempr@#2) % -105);
   Comodin1 = Comodin1 + #canempr@#3 + "/";
   |PATH_DAT #10 Comodin1;
   |PATH_DAT #11 Comodin1;
   |ABRE #cacuenta;
   |ABRE #camaasil;

   |BUCLE RellenaTempo;

   |CIERRA #camaasil;
   |CIERRA #cacuenta;
|FPRC;

|DEFBUCLE Empresas;
#canempr@#1002;
;
DEmpre,DPerio;
HEmpre,HPerio;
;
NULL,Empresas;
|FIN;

|PROCESO JustifCampos;
   Comodin = #cainfcol#Campo#; |QBF Comodin;
   Comodin = Comodin % 0101;
   |SI Comodin = " "; |ACABA; |FINSI;

   Comodin = #cainfcol#Campo#; |QBF Comodin;
   LongAlfa = Comodin % 0;
   Long = LongAlfa;
   Long = ((13 - Long) / 2) ! 0;
   Comodin = (" " * Long) + Comodin;
   #cainfcol#Campo# = Comodin; |PINTA #cainfcol#Campo#;
|FPRC;

|PROCESO VeteFinal;
   SwBlk = 1;
   |PARA Cont = ContLin; |SI Cont < NumLins; |HACIENDO Cont = Cont + 1;
      |PRINT;
   |SIGUE;
   SwBlk = 0;
|FPRC;

|PROCESO PuntoCuenta; |TIPO 6;

   |SI #48#19 ! 0; MaxDig = #48#19; |SINO;
      |SI #48#18 ! 0; MaxDig = #48#18; |SINO;
         |SI #48#17 ! 0; MaxDig = #48#17; |SINO;
            |SI #48#16 ! 0; MaxDig = #48#16; |SINO;
               |SI #48#15 ! 0; MaxDig = #48#15; |SINO;
                  |SI #48#14 ! 0; MaxDig = #48#14; |SINO;
                     MaxDig = 0;
   |FINSI; |FINSI; |FINSI; |FINSI; |FINSI; |FINSI;

   Comodin = #cainfcol#Campo#;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      Calc = FSalida;
      nParte1 = 99 + ((Calc / 100) ! 0);
      aParte1 = Comodin % nParte1;
      nParte2 = 98 + Calc;
      aParte2 = Comodin % nParte2;
      |QBF Comodin;
      aLong = Comodin % 0; nLong = aLong;
      nLong = MaxDig - nLong;
      Comodin = aParte1 + ("0" * nLong) + aParte2;
      #cainfcol#Campo# = Comodin;
      |PINTA #cainfcol#Campo#;
   |FINSI;
|FPRC;

|PROCESO Listado; ||TIPO 3;

   |MENU menu;
   Opcion = FSalida;
   |SI Opcion < 1; |O Opcion > 2; |ACABA; |FINSI;

   |IMPRE 0;
   |SI FSalida < 0; |ACABA; |FINSI;

   |SI Opcion = 1;
      |INFOR "cainfcol";
      |SI FSalida < 0; |ACABA; |FINSI;
   |SINO;
      |INFOR "cainfco1";
      |SI FSalida < 0; |ACABA; |FINSI;
   |FINSI;

   |DELINDEX #catmpcol;
   |DELINDEX #catmpco1;
   |ABRE #catmpcol;
   |ABRE #catmpco1;

   |DBASE Comodin;
   Comodin1 = Comodin + "def/canempre.mas";
   |CARGA_DEF Comodin1, canempr@;
   |SI FSalida ! 0;
      |MENAV "    Problemas al cargar el def";
      |FININF;
      |FINIMP;
      |ACABA;
   |SINO;
      Comodin1 = Comodin + "fich/";
      |PATH_DAT #12 Comodin1;
      |ABRE #canempr@;
      Empresa = 1;
      |PARA Cont = 4; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
         DEmpre = #cainfcol#Cont#; HEmpre = #cainfcol#Cont#;
         Cont = Cont + 1;
         DPerio = #cainfcol#Cont#; HPerio = #cainfcol#Cont#;
         |SI DEmpre ! 0; |Y DPerio ! 0;
            |BUCLE Empresas;
         |FINSI;
         Empresa = Empresa + 1;
      |SIGUE;
      |DESCARGA_DEF #canempr@;
   |FINSI;

   ContLin = 5;
   Continua = "";
   |BUCLE Cuentas;

   |CIERRA #catmpco1;
   |CIERRA #catmpcol;

   |PIEINF;
   |FININF;
   |FINIMP;

|FPRC;

|PROCESO TrasConcep;
   |SI #cainfcol#Campo# = 0;
      |SI Campo = 10;
         #cainfcol#11 = "000"; |PINTA #cainfcol#11; |C_M #cainfcol#11,1,"N";
         |PARA nCont = 24; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;
            |C_M #cainfcol#nCont#,1,"S";
         |SIGUE;
      |FINSI;
      |SI Campo = 13;
         #cainfcol#14 = "000"; |PINTA #cainfcol#14; |C_M #cainfcol#14,1,"N";
         |PARA nCont = 31; |SI nCont [ 37; |HACIENDO nCont = nCont + 1;
            |C_M #cainfcol#nCont#,1,"S";
         |SIGUE;
      |FINSI;
      |SI Campo = 16;
         #cainfcol#17 = "000"; |PINTA #cainfcol#17; |C_M #cainfcol#17,1,"N";
         |PARA nCont = 38; |SI nCont [ 44; |HACIENDO nCont = nCont + 1;
            |C_M #cainfcol#nCont#,1,"S";
         |SIGUE;
      |FINSI;
   |SINO;
      |SI Campo = 10;
         |C_M #cainfcol#11,1,"S";
         |PARA nCont = 24; |SI nCont [ 30; |HACIENDO nCont = nCont + 1;
            #cainfcol#nCont# = 0; |PINTA #cainfcol#nCont#;
            |C_M #cainfcol#nCont#,1,"N";
         |SIGUE;
      |FINSI;
      |SI Campo = 13;
         |C_M #cainfcol#14,1,"S";
         |PARA nCont = 31; |SI nCont [ 37; |HACIENDO nCont = nCont + 1;
            #cainfcol#nCont# = 0; |PINTA #cainfcol#nCont#;
            |C_M #cainfcol#nCont#,1,"N";
         |SIGUE;
      |FINSI;
      |SI Campo = 16;
         |C_M #cainfcol#17,1,"S";
         |PARA nCont = 38; |SI nCont [ 44; |HACIENDO nCont = nCont + 1;
            #cainfcol#nCont# = 0; |PINTA #cainfcol#nCont#;
            |C_M #cainfcol#nCont#,1,"N";
         |SIGUE;
      |FINSI;
   |FINSI;
|FPRC;

|PROGRAMA;
   |CLS;

   |ABRE #cainfcol;
   |LEE 010#cainfcol.p;
   |SI FSalida ! 0;
      |DDEFECTO #cainfcol;
      |GRABA 020#cainfcol.n;
      |LEE 010#cainfcol.p;
   |FINSI;

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#cainfcol.a;
      |HAZ Listado;
   |FINSI;
   |CIERRA #cainfcol;
|FPRO;
