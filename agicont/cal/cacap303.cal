|FICHEROS;

  cacap303 #0;    || def entrada
  caman303 #2;    || modelo 303
  dsm30304;
  dsm30305;
  caivarep #4;    || iva repercutido
  caivasop #5;    || iva soportado
  caiva300 #6;    || control iva
  cacon300 #7;    || Conceptos de IVA a 300
  caportad #8;    || hacienda

  eosma100 #100;
  dsmow204;

  camacc01 #501;
  camacc02 #502;

  regiva@;
|FIN;

|VARIABLES;
  alfa1 = "";
  alfa2 = "";
  nume1 = 0;
  nume2 = 0;
  nume3 = 0;
  nume4 = 0;
  fech1 = @;
  fech2 = @;
  fech3 = @;
  fech4 = @;

  nNume    = 0;
  FEstado  = 0;
  dir_reo  = "";
  per_ant  = -1;
  &compens = 0;

  x1 = 0;
  x2 = 0;
  x3 = 0;
  x4 = 0;
  x5 = 0;
  t_ivasop = 0;
  t_bassop = 0;
  tot_rec  = 0;
  tot_iva  = 0;
  tot_bas  = 0;
  total    = 0;
  &swliq   = 0;
  &eaCampo45 = "";
  &enCampo1  = 0;
  &enCampo2  = 0;
  perio    = 0;
  sw_per   = 0;
  activi   = "";
  any      = 0;
  sw_exi   = 0;
  &a_emp   = 0;
  &a_per   = 0;
  &ac_pe   = 0;
  dirfich0 = "";
  nEjer    = 0;
  aAlfa    = "";
  aFichero = "";
  tri0     = 0;
  nModi    = 0;

   nSwOp        = 0;
   nCampo       = 0;
   nCampo1      = 0;
   nCampo2      = 0;
   nCampo3      = 0;
   nActividad   = 0;
   nPorce1      = 0;
   nPorce2      = 0;

   nNume1       = 0;
   nNume2       = 0;
   nNume3        = 0;
   nIVA         = 0;
   nBase        = 0;
   nCuota       = 0;

   base = 0;
   tiva = 0;
   iva  = 0;
   rec  = 0;
   nSwAcum = 0;
   nPara1 = 0;
   nPara2 = 0;
   nPara3 = 0;
   nPara4 = 0;

   nSw      = 0;
   nSubeIVA = 0;
   nPer     = 0;
   nMasBase = 0;
   nPriIVA  = 0;
   aTipo    = "";
   nIVA5    = 0;
   nIVA8    = 0;
   nIVA11   = 0;
   nIVA14   = 0;
   nIVA17   = 0;
   nIVA46   = 0;

  nCampo20 = 0;
  nCampo21 = 0;
  nCampo22 = 0;
  nCampo60 = 0;
  nCampo61 = 0;
  aCampo28 = "";

   nImpre     = 0;
   nOpera      = 0;
   nOpCaja     = 0;
   nHayCaja    = 0;
   nBaseCaja   = 0;
   nBaseCaja1  = 0;
   nBaseCaja2  = 0;
   nBaseCaja3  = 0;
   nBaseCaja4  = 0;
   nBaseCaja5  = 0;
   nCuotaCaja  = 0;
   nCuotaCaja1 = 0;
   nCuotaCaja2 = 0;
   nCuotaCaja3 = 0;
   nCuotaCaja4 = 0;
   nCuotaCaja5 = 0;

   aBase       = "";
   aMas        = "";
   a340        = "";
   &nPie       = 0;
   aCampo51    = "";
   &enNCobro   = 0;

   &ef502c1    = @;
   &ea502c2    = "";
   &ea502c3    = "";
   &enCobrado1 = 0;
   &enCobrado2 = 0;
   &enCobrado3 = 0;
   &enCobrado4 = 0;
   &enCobrado5 = 0;
   nTotalCaja  = 0;
   aParam      = "";
   nEjerCobro  = 0;
   aPathOrigen = "";
   aTipo501    = "";
   nHagoSub    = 0;
   &enPerLiq   = 0;
   nMod390     = 0;
   &enNoMod390 = 0;
   &enImpExp   = 0;
|FIN;

|INCLUYE acceso_i;
|INCLUYE varnue_i;
|INCLUYE varcaj_i;

***************************************************************************
             DATOS PANTALLA
***************************************************************************

|PROCESO tipo8; |TIPO 8;
  |HAZ inicio;
  |HAZ eVarEmpresa;
  |DDEFECTO #8;
  |ABRE #8;
  #8#0 = #30#2;
  #8#1 = #30#26;
  |LEE 000#8=;
  |SI FSalida ! 0;
      |MENAV "    No encontrado Fichero Portadas Modelos";
      |PTEC 807;
  |FINSI;
  |CIERRA #8;
  |SI #8#99  [ 0; |O #8#99  > 100;  #8#99  = 100; |FINSI;
  |SI #8#101 [ 0; |O #8#101 > 100;  #8#101 = 100; |FINSI;

  enNoMod390 = 0;
  |PARA nPara1 = 32; |SI nPara1 [ 37; |HACIENDO nPara1 = nPara1 + 1;

        aAlfa = #caportad#nPara1# - "E"; |QBT aAlfa
        |SI aAlfa = "8612"; |O aAlfa = "8611";
             enNoMod390 = 1;
        |SINO;
             |SI aAlfa ! ""; enNoMod390 = 0; |SAL; |FINSI;
        |FINSI;
  |SIGUE;
  |SI #caportad#93 = "M"; |O #caportad#93 = "D";
      enNoMod390 = 1;
  |FINSI;
|FPRC;

|PROCESO defecto; |TIPO 7;
  #0#0 = #8#93;
  #0#1 = 1;
  #0#2 = 1;
  |PINDA #0#0;
|FPRC;

|PROCESO mayor;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|PROCESO per_hasta; |TIPO 0;

  |SI #0#0 = "T"; |Y #0Campo > 4;
      |ERROR;
  |FINSI;
  |SI #0#0 = "A"; |Y #0Campo > 1;
      |ERROR;
  |FINSI;
|FPRC;

***************************************************************************
               GRABACION DEL 303
***************************************************************************
|PROCESO eosma100B;
     |SI nSwOp = 0;
         |BORRA 020#100a;
     |SINO;
          |SI #100#5 > 17; |Y #100#5 ! 46;
              #100#6  = #100#6  % nPorce1;
              #100#8  = #100#8  % nPorce2;
              #100#9  = #100#9  % nPorce1;
              #100#11 = #100#11 % nPorce2;
              #100#12 = #100#12 % nPorce1;
              #100#14 = #100#14 % nPorce2;
              #100#15 = #100#15 % nPorce1;
              #100#17 = #100#17 % nPorce2;
              #100#18 = #100#18 % nPorce1;
              #100#20 = #100#20 % nPorce2;
              #100#21 = #100#21 % nPorce1;
              #100#23 = #100#23 % nPorce2;
              #100#24 = #100#24 % nPorce1;
              #100#26 = #100#26 % nPorce2;
              |GRABA 020#100a;
           |FINSI;
     |FINSI;
     |LIBERA #100;
|FPRC;

|DEFBUCLE eosma100B;
     #100#1;
     ;
     "303", #2#0, nActividad, #2#1, #2#2, 000;
     "303", #2#0, nActividad, #2#1, #2#2, 999;
     be;
     NULL, eosma100B;
|FIN;

|PROCESO PonerDesglose;
||   |SI nIVA = 0;                              nNume1 = 87; |FINSI;
||   |SI nIVA = 16; |O nIVA = 18; |O nIVA = 21; nNume1 = 84; |FINSI;
||   |SI nIVA = 7;  |O nIVA =  8; |O nIVA = 10; nNume1 = 81; |FINSI;
||   |SI nIVA = 4;                              nNume1 = 78; |FINSI;

||   #2nNume1 = nBase; nNume1 = nNume1 + 1;
||   #2nNume1 = nIVA;  nNume1 = nNume1 + 1;
||   #2nNume1 = nCuota;

     nSwAcum = 0;
     |PARA nPara1 = 78;  |SI nPara1 [ 91;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #2nPara2  = nIVA;
               #2nPara1  = #2nPara1 + nBase;
               #2nPara2  = nIVA;
               #2nPara3  = #2nPara3 + nCuota;
               nSwAcum = 1;
               |SAL;
           |FINSI;
           |SI nPara1 = 87; nPara1 = 88; |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 78;  |SI nPara1 [ 91;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #2nPara2 = 0;
                   #2nPara1  = nBase;
                   #2nPara2  = nIVA;
                   #2nPara3  = nCuota;
                   |SAL;
               |FINSI;
               |SI nPara1 = 87; nPara1 = 88; |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO ActuRepartoAdq;
       |ABRE #100;
       #100#0 = "303";
       #100#1 = #2#0;
       #100#2 = nActividad;
       #100#3 = #2#1;
       #100#4 = #2#2;
       #100#5 = nCampo1;
       |LEE 101#100=;
       |SI FSalida ! 0;
           |DDEFECTO #100;
           #100#0 = "303";
           #100#1 = #2#0;
           #100#2 = nActividad;
           #100#3 = #2#1;
           #100#4 = #2#2;
           #100#5 = nCampo1;
           |GRABA 020#100b;
       |FINSI;
       #100#6  = #2#78 % nPorce1; #100#7  = #2#79; #100#8  = #2#80 % nPorce2;
       #100#9  = #2#81 % nPorce1; #100#10 = #2#82; #100#11 = #2#83 % nPorce2;
       #100#12 = #2#84 % nPorce1; #100#13 = #2#85; #100#14 = #2#86 % nPorce2;
       #100#15 = #2#87 % nPorce1; #100#16 = #2#88; #100#17 = #2#89 % nPorce2;
       #100#18 = #2#91 % nPorce1; #100#19 = #2#92; #100#20 = #2#93 % nPorce2;
       |GRABA 020#100a;
       |LIBERA #100;
       |CIERRA #100;
|FPRC;

||.........TOTALES 303

|PROCESO totaliza_303;
    #caman303#29 = compens;
    compens = 0;

    #caman303#20  = #caman303#7  + #caman303#10  + #caman303#13  + #caman303#16;
    #caman303#20  = #caman303#20 + #caman303#19  + #caman303#48  + #caman303#50;
    #caman303#20  = #caman303#20 + #caman303#104 + #caman303#106 + #caman303#108;
    #caman303#25  = #caman303#21 + #caman303#43  + #caman303#22 + #caman303#44 + #caman303#51 + #caman303#58;
    #caman303#25  = #caman303#25 + #caman303#23  + #caman303#24 + #caman303#61 + #caman303#110;
    #caman303#26  = #caman303#20 - #caman303#25;
    #caman303#28  = #caman303#26 % #caman303#27;

    |SI enEjercicio < 2014; || |O #caman303#96 ! "S";
        #caman303#70 = #caman303#5 + #caman303#8 + #caman303#11 + #caman303#105;
    |FINSI;

    #caman303#154 = #caman303#111;
    #caman303#35  = #caman303#54;
    #caman303#36  = #caman303#68;
    #caman303#71  = #caman303#69;
    #caman303#42  = #caman303#70 + #caman303#154 + #caman303#35 + #caman303#36 + #caman303#37 + #caman303#71 + #caman303#56 + #caman303#34 + #caman303#38;
    #caman303#42  = #caman303#42 + #caman303#39  + #caman303#72 + #caman303#73 - #caman303#40 - #caman303#41;

    #caman303#115 = #caman303#28 - #caman303#29 - #caman303#30;
    #caman303#117 = #caman303#115 - #caman303#116;

    #caman303#33 = 0;
    #caman303#32 = 0;
    #caman303#31 = 0;
    |SI #caman303#117 > 0;
        #caman303#33 = #caman303#117;
        #caman303#31 = 0;
        #caman303#32 = 0;
    |SINO;
        #caman303#33 = 0;
        #caman303#32 = -#caman303#117;
        #caman303#31 = 0;

        |SI #caportad#71 = "D";
             |SI #caman303#45 = "T"; |Y #caman303#1 = 4;
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;

             |SI #caman303#45 = "M"; |Y #caman303#1 = 12;
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;

             |SI #caman303#45 = "D";
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;

             |SI #caman303#45 = "A";
                 #caman303#32 = 0;
                 #caman303#31 = -#caman303#117;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|| ......................... Procesos para la Caja
|PROCESO Graba340_Caja;
     enNCobro   = #502#4;
     ef502c1    = #502#5;
     ea502c2    = #502#14;
     ea502c3    = #502#15;
     enCobrado1 = 0;
     enCobrado2 = 0;
     enCobrado3 = 0;
     enCobrado4 = 0;
     enCobrado5 = 0;

     |SI aTipoIVA = "S";
         |SALVA_DATOS #caivasop;
         enCobrado1   = #502#16;
         #caivasop#8  = #502#17;
         #caivasop#14 = #502#18;

         enCobrado2   = #502#19;
         #caivasop#9  = #502#20;
         #caivasop#15 = #502#21;

         enCobrado3   = #502#22;
         #caivasop#10 = #502#23;
         #caivasop#16 = #502#24;

         enCobrado4   = #502#25;
         #caivasop#52 = #502#26;
         #caivasop#56 = #502#27;

         enCobrado5   = #502#28;
         #caivasop#53 = #502#29;
         #caivasop#57 = #502#30;
         a340 = "S"; |HAZ Recibidas340;
         |REPON_DATOS #caivasop;
     |SINO;
         |SALVA_DATOS #caivarep;
         enCobrado1   = #502#16;
         #caivarep#8  = #502#17;
         #caivarep#14 = #502#18;

         enCobrado2   = #502#19;
         #caivarep#9  = #502#20;
         #caivarep#15 = #502#21;

         enCobrado3   = #502#22;
         #caivarep#10 = #502#23;
         #caivarep#16 = #502#24;

         enCobrado4   = #502#25;
         #caivarep#52 = #502#26;
         #caivarep#56 = #502#27;

         enCobrado5   = #502#28;
         #caivarep#53 = #502#29;
         #caivarep#57 = #502#30;

         a340 = "S"; |HAZ Expedidas340;
         |REPON_DATOS #caivarep;
    |FINSI;
    enNCobro = 0;
    enCobrado1 = 0;
    enCobrado2 = 0;
    enCobrado3 = 0;
    enCobrado4 = 0;
    enCobrado5 = 0;
|FPRC;

|PROCESO LeeCab501;
        |ABRE #501;
        |DDEFECTO #501;
        #501#13 = aTipoIVA;
        #501#17 = nEjerCobro;
        #501#0  = enLibroCaja;
        #501#14 = eaSerieCaja;
        #501#15 = enRegisCaja;
        |LEE 040#501=;
        |SI FSalida ! 0;  enSwCaja = 0;  |FINSI;
        |CIERRA #501;
|FPRC;

|PROCESO LosCobros;

     |SI nEjerCobro ! 0;
         |SI #502#9 ! 0; |Y #502#9 ! enEjercicio;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #502#8 < #0#2; |Y #502#8 ! 0; |ACABA; |FINSI;


     |SI nOpCaja = 0;

         nHayCaja = 1;
         nBaseCaja1  = (nBaseCaja1  + #502#17) ! 2;
         nCuotaCaja1 = (nCuotaCaja1 + #502#18) ! 2;

         nBaseCaja2  = (nBaseCaja2  + #502#20) ! 2;
         nCuotaCaja2 = (nCuotaCaja2 + #502#21) ! 2;

         nBaseCaja3  = (nBaseCaja3  + #502#23) ! 2;
         nCuotaCaja3 = (nCuotaCaja3 + #502#24) ! 2;

         nBaseCaja4  = (nBaseCaja4  + #502#26) ! 2;
         nCuotaCaja4 = (nCuotaCaja4 + #502#27) ! 2;

         nBaseCaja5  = (nBaseCaja5  + #502#29) ! 2;
         nCuotaCaja5 = (nCuotaCaja5 + #502#30) ! 2;
     |FINSI;

     |SI nOpCaja = 1;
         |SI #502#17 ! 0; |O #502#18 ! 0;
             |O #502#20 ! 0; |O #502#21 ! 0;
                |O #502#23 ! 0; |O #502#24 ! 0;
                   |O #502#26 ! 0; |O #502#27 ! 0;
                      |O #502#29 ! 0; |O #502#30 ! 0;

          |SI nEjerCobro = 0;
              |SI #8#104 = "S"; |HAZ Graba340_Caja; |FINSI;
          |FINSI;
          nHayCaja = 1;
          #502#8 = #0#2;
          #502#9 = enEjercicio;
          |GRABA 020#502a;
        |FINSI;
    |FINSI;
    |LIBERA #502;
|FPRC;

|DEFBUCLE LosCobros;
     #502#1;
     7;
     aTipoIVA, nEjerCobro, enLibroCaja, eaSerieCaja, enRegisCaja, 01, #0#1;
     aTipoIVA, nEjerCobro, enLibroCaja, eaSerieCaja, enRegisCaja, 99, #0#2;
     be;
     NULL, LosCobros;
|FIN;

|PROCESO ElRECC;
     nBaseCaja   = 0; nCuotaCaja  = 0;

     nBaseCaja1  = 0; nCuotaCaja1 = 0;
     nBaseCaja2  = 0; nCuotaCaja2 = 0;
     nBaseCaja3  = 0; nCuotaCaja3 = 0;
     nBaseCaja4  = 0; nCuotaCaja4 = 0;
     nBaseCaja5  = 0; nCuotaCaja5 = 0;

     aCampo28 = "S";
     |SI enSwCaja = 1;
         |BUCLE LosCobros;
         |SI nOpCaja = 1;
            |ABRE #501;
            |DDEFECTO #501;
            #501#13 = aTipoIVA;
            #501#17 = nEjerCobro;
            #501#0  = enLibroCaja;
            #501#14 = eaSerieCaja;
            #501#15 = enRegisCaja;
            |LEE 040#501=;
            |SI FSalida = 0;
                |SI nOpera = 0; |Y a340 = "S";
                    #501#8 = #0#2;
                    #501#9 = enEjercicio;
                |FINSI;
                |SI nHayCaja = 1;
                    |SI #501#11 < enEjercicio;
                        #501#10 = #0#2;
                        #501#11 = enEjercicio;
                    |SINO;
                        |SI #501#11 = enEjercicio; |Y #501#10 < #0#2;
                            #501#10 = #0#2;
                            #501#11 = enEjercicio;
                        |FINSI;
                    |FINSI;
                |FINSI;
                aCampo28 = "N";
                |SI #501#12 = nTotalCaja; aCampo28 = "S"; |FINSI;
                |GRABA 020#501a;
            |FINSI;
            |CIERRA #501;
         |FINSI;
     |FINSI;
|FPRC;

|| .....................

||.........IVA SOPORTADO
|PROCESO ConcepCompra;
     #100#0 = "303";
     #100#1 = #2#0;
     #100#2 = nActividad;
     #100#3 = #2#1;
     #100#4 = #2#2;
     #100#5 = nCampo1;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #2#0;
         #100#2 = nActividad;
         #100#3 = #2#1;
         #100#4 = #2#2;
         #100#5 = nCampo1;
         |GRABA 020#100b;
     |FINSI;

     nSwAcum = 0;

     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #100nPara2  = tiva;
               #100nPara1  = #100nPara1 + (base % nPorce1);
               #100nPara2  = tiva;
               #100nPara3  = #100nPara3 + ((iva + rec) % nPorce2);
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #100nPara2 = 0;
                   #100nPara1  = base % nPorce1;
                   #100nPara2 = tiva;
                   #100nPara3  = iva % nPorce2;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

|PROCESO GuardaBases;
    |ABRE #100;
    |SI enSwCaja = 0;
        |SI #5#14 ! 0; base = #5#8;  iva = #5#14; tiva = #5#11; |HAZ ConcepCompra; |FINSI;
        |SI #5#15 ! 0; base = #5#9;  iva = #5#15; tiva = #5#12; |HAZ ConcepCompra; |FINSI;
        |SI #5#16 ! 0; base = #5#10; iva = #5#16; tiva = #5#13; |HAZ ConcepCompra; |FINSI;
        |SI #5#56 ! 0; base = #5#52; iva = #5#56; tiva = #5#54; |HAZ ConcepCompra; |FINSI;
        |SI #5#57 ! 0; base = #5#53; iva = #5#57; tiva = #5#55; |HAZ ConcepCompra; |FINSI;
    |SINO;
        |SI nCuotaCaja1 ! 0; base = nBaseCaja1; iva = nCuotaCaja1; tiva = #5#11; |HAZ ConcepCompra; |FINSI;
        |SI nCuotaCaja2 ! 0; base = nBaseCaja2; iva = nCuotaCaja2; tiva = #5#12; |HAZ ConcepCompra; |FINSI;
        |SI nCuotaCaja3 ! 0; base = nBaseCaja3; iva = nCuotaCaja3; tiva = #5#13; |HAZ ConcepCompra; |FINSI;
        |SI nCuotaCaja4 ! 0; base = nBaseCaja4; iva = nCuotaCaja4; tiva = #5#54; |HAZ ConcepCompra; |FINSI;
        |SI nCuotaCaja5 ! 0; base = nBaseCaja5; iva = nCuotaCaja5; tiva = #5#55; |HAZ ConcepCompra; |FINSI;
    |FINSI;
    |CIERRA #100;
|FPRC;

|PROCESO iva_sop;   || en el caso que no exista en concepto en cacon300

     t_ivasop = #5#14+#5#15+#5#16+#5#20+#5#21+#5#22+#5#56+#5#57+#5#60+#5#61; || suma recargo
     t_bassop = 0;
     |SI #5#14 ! 0; |O #5#20 ! 0; t_bassop = t_bassop + #5#8; |FINSI;
     |SI #5#15 ! 0; |O #5#21 ! 0; t_bassop = t_bassop + #5#9; |FINSI;
     |SI #5#16 ! 0; |O #5#22 ! 0; t_bassop = t_bassop + #5#10; |FINSI;
     |SI #5#56 ! 0; |O #5#60 ! 0; t_bassop = t_bassop + #5#52; |FINSI;
     |SI #5#57 ! 0; |O #5#61 ! 0; t_bassop = t_bassop + #5#53; |FINSI;

     |SI enSwCaja = 1;
         nBaseCaja  = t_bassop;
         nCuotaCaja = t_ivasop;
         t_ivasop = nCuotaCaja1 + nCuotaCaja2 + nCuotaCaja3 + nCuotaCaja4 + nCuotaCaja5; ||Sin recargo
         t_bassop = 0;
         |SI nCuotaCaja1 ! 0; t_bassop = t_bassop + nBaseCaja1; |FINSI;
         |SI nCuotaCaja2 ! 0; t_bassop = t_bassop + nBaseCaja2; |FINSI;
         |SI nCuotaCaja3 ! 0; t_bassop = t_bassop + nBaseCaja3; |FINSI;
         |SI nCuotaCaja4 ! 0; t_bassop = t_bassop + nBaseCaja4; |FINSI;
         |SI nCuotaCaja5 ! 0; t_bassop = t_bassop + nBaseCaja5; |FINSI;
     |FINSI;

     |SI #5#23 = "S";
         |SI #5#48 = "S";
             #2#63 = #2#63 + t_bassop;
             #2#43 = #2#43 + t_ivasop;   || operaciones interiores inversiones
             nCampo1 = 63;
             nCampo2 = 43;
         |SINO;
             #2#62 = #2#62 + t_bassop;
             #2#21 = #2#21 + t_ivasop;   || operaciones interiores corrientes
             nCampo1 = 62;
             nCampo2 = 21;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO acum_sop;

     tot_iva = #5#14 + #5#15 + #5#16 + #5#56 + #5#57; || no suma recargo
     tot_bas = 0;
     |SI #5#14 ! 0; tot_bas = tot_bas + #5#8;  |FINSI;
     |SI #5#15 ! 0; tot_bas = tot_bas + #5#9;  |FINSI;
     |SI #5#16 ! 0; tot_bas = tot_bas + #5#10; |FINSI;
     |SI #5#56 ! 0; tot_bas = tot_bas + #5#52; |FINSI;
     |SI #5#57 ! 0; tot_bas = tot_bas + #5#53; |FINSI;

     |SI enSwCaja = 1;
         nBaseCaja  = tot_bas;
         nCuotaCaja = tot_iva;
         tot_iva = nCuotaCaja1 + nCuotaCaja2 + nCuotaCaja3 + nCuotaCaja4 + nCuotaCaja5;
         tot_bas = 0;
         |SI nCuotaCaja1 ! 0; tot_bas = tot_bas + nBaseCaja1; |FINSI;
         |SI nCuotaCaja2 ! 0; tot_bas = tot_bas + nBaseCaja2; |FINSI;
         |SI nCuotaCaja3 ! 0; tot_bas = tot_bas + nBaseCaja3; |FINSI;
         |SI nCuotaCaja4 ! 0; tot_bas = tot_bas + nBaseCaja4; |FINSI;
         |SI nCuotaCaja5 ! 0; tot_bas = tot_bas + nBaseCaja5; |FINSI;
     |FINSI;

     |SI #7#1 = 9;
         #2#76 = #2#76 + tot_bas;
         |ACABA;
     |FINSI;

     |SI #5#23 = "S";
         |SI #5#48 = "N";         ||Si no es de inversion
             |HAZ noinver;
         |SINO;         ||SI es de inversiones
             |HAZ inver;
         |FINSI;
     |FINSI;

|FPRC;

|PROCESO inver;
     |SI #7#1 = 5;
         #2#24 = #2#24 + tot_iva;
     |SINO;
         |SI #7#1 = 6;       ||Op. Interiores Inversiones
             #2#63 = #2#63 + tot_bas;
             #2#43 = #2#43 + tot_iva;
             nCampo1 = 63;
             nCampo2 = 43;
         |SINO;
             |SI #7#1 = 7;  ||Importaciones Inversiones
                 #2#65 = #2#65 + tot_bas;
                 #2#44 = #2#44 + tot_iva;
                 nCampo1 = 65;
                 nCampo2 = 44;
             |SINO;
                 |SI #7#1 = 8; || Entregas Intracomunitarias
||                     #2#54 = #2#54 - tot_bas;  tique 700000_8630
||                     #2#35 = #2#35 - tot_bas;
                 |SINO;
                     |SI #7#1 = 3;
                         #2#67 = #2#67 + tot_bas;
                         #2#58 = #2#58 + tot_iva;
                         nCampo1 = 67;
                         nCampo2 = 58;
                         |SI #7#2 = 2;
                             #2#49 = #2#49 + tot_bas;          ||base intracomunitario
                             #2#50 = #2#50 + tot_iva;
                             |SI enSwCaja = 0;
                                 |SI #5#14 ! 0; nBase = #5#8;  nIVA = #5#11; nCuota = #5#14; |HAZ PonerDesglose; |FINSI;
                                 |SI #5#15 ! 0; nBase = #5#9;  nIVA = #5#12; nCuota = #5#15; |HAZ PonerDesglose; |FINSI;
                                 |SI #5#16 ! 0; nBase = #5#10; nIVA = #5#13; nCuota = #5#16; |HAZ PonerDesglose; |FINSI;
                                 |SI #5#56 ! 0; nBase = #5#52; nIVA = #5#54; nCuota = #5#56; |HAZ PonerDesglose; |FINSI;
                                 |SI #5#57 ! 0; nBase = #5#53; nIVA = #5#55; nCuota = #5#57; |HAZ PonerDesglose; |FINSI;
                             |SINO;
                                 |SI nCuotaCaja1 ! 0; nBase = nBaseCaja1; nIVA = #5#11; nCuota = nCuotaCaja1; |HAZ PonerDesglose; |FINSI;
                                 |SI nCuotaCaja2 ! 0; nBase = nBaseCaja2; nIVA = #5#12; nCuota = nCuotaCaja2; |HAZ PonerDesglose; |FINSI;
                                 |SI nCuotaCaja3 ! 0; nBase = nBaseCaja3; nIVA = #5#13; nCuota = nCuotaCaja3; |HAZ PonerDesglose; |FINSI;
                                 |SI nCuotaCaja4 ! 0; nBase = nBaseCaja4; nIVA = #5#54; nCuota = nCuotaCaja4; |HAZ PonerDesglose; |FINSI;
                                 |SI nCuotaCaja5 ! 0; nBase = nBaseCaja5; nIVA = #5#55; nCuota = nCuotaCaja5; |HAZ PonerDesglose; |FINSI;
                             |FINSI;
                         |FINSI;
                     |SINO;
                         |SI #7#1 = 10;
                             #2#109 = #2#109 + tot_bas;
                             #2#110 = #2#110 + tot_iva;
                             nCampo1 = 109;
                             nCampo2 = 110;
                         |SINO;
                             #2#24 = #2#24 + tot_iva;
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO noinver;
     |SI #7#1 = 1;       ||Operaciones Corrientes
         #2#62 = #2#62 + tot_bas;
         #2#21 = #2#21 + tot_iva;
         nCampo1 = 62;
         nCampo2 = 21;
     |SINO;
         |SI #7#1 = 2;  ||Importaciones
             #2#64 = #2#64 + tot_bas;
             #2#22 = #2#22 + tot_iva;
             nCampo1 = 64;
             nCampo2 = 22;
         |SINO;
             |SI #7#1 = 3;  ||Adj. Intracomunitaria
                 #2#66 = #2#66 + tot_bas;
                 #2#51 = #2#51 + tot_iva;
                 nCampo1 = 66;
                 nCampo2 = 51;
                 |SI #7#2 = 2;
                     #2#49 = #2#49 + tot_bas;          ||base intracomunitario
                     #2#50 = #2#50 + tot_iva;
                     |SI enSwCaja = 0;
                         |SI #5#14 ! 0; nBase = #5#8;  nIVA = #5#11; nCuota = #5#14; |HAZ PonerDesglose; |FINSI;
                         |SI #5#15 ! 0; nBase = #5#9;  nIVA = #5#12; nCuota = #5#15; |HAZ PonerDesglose; |FINSI;
                         |SI #5#16 ! 0; nBase = #5#10; nIVA = #5#13; nCuota = #5#16; |HAZ PonerDesglose; |FINSI;
                         |SI #5#56 ! 0; nBase = #5#52; nIVA = #5#54; nCuota = #5#56; |HAZ PonerDesglose; |FINSI;
                         |SI #5#57 ! 0; nBase = #5#53; nIVA = #5#55; nCuota = #5#57; |HAZ PonerDesglose; |FINSI;
                     |SINO;
                         |SI nCuotaCaja1 ! 0; nBase = nBaseCaja1; nIVA = #5#11; nCuota = nCuotaCaja1; |HAZ PonerDesglose; |FINSI;
                         |SI nCuotaCaja2 ! 0; nBase = nBaseCaja2; nIVA = #5#12; nCuota = nCuotaCaja2; |HAZ PonerDesglose; |FINSI;
                         |SI nCuotaCaja3 ! 0; nBase = nBaseCaja3; nIVA = #5#13; nCuota = nCuotaCaja3; |HAZ PonerDesglose; |FINSI;
                         |SI nCuotaCaja4 ! 0; nBase = nBaseCaja4; nIVA = #5#54; nCuota = nCuotaCaja4; |HAZ PonerDesglose; |FINSI;
                         |SI nCuotaCaja5 ! 0; nBase = nBaseCaja5; nIVA = #5#55; nCuota = nCuotaCaja5; |HAZ PonerDesglose; |FINSI;
                     |FINSI;
                 |FINSI;
             |SINO;
                 |SI #7#1 = 4;  ||Regimen AGp
                     #2#90 = #2#90 + tot_bas;
                     #2#23 = #2#23 + tot_iva;
                 |SINO;
                     |SI #7#1 = 8;  ||Entrega intracom
||  #2#54 = #2#54 - tot_bas;  tique 70000 _ 8630
||  #2#35 = #2#35 - tot_bas;
                     |SINO;
                         |SI #7#1 = 10; || Rectificaciones
                             #2#109 = #2#109 + tot_bas;
                             #2#110 = #2#110 + tot_iva;
                             nCampo1 = 109;
                             nCampo2 = 110;
                         |SINO;
                             #2#62 = #2#62 + tot_bas;
                             #2#21 = #2#21 + tot_iva;
                             nCampo1 = 62;
                             nCampo2 = 21;
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO abre_303_sop;
  perio  = #0#2;
  activi = #0#0;
  any    = #30#26;
  |SI perio ! 1;
      |HAZ lee_ant;        || carga compensar
  |SINO;
      |HAZ lee_any_a;     || el del a¤o pasado
  |FINSI;
  |DDEFECTO #2;
  #2#00 = #30#2;        || empresa
  #2#45 = #0#0;         || actividad
  #2#01 = #0#2;         || periodo
  #2#02 = #30#26;       || a¤o
  |LEE 101#2=;
  FEstado = FSalida;
  #2#00 = #30#2;        || empresa
  #2#45 = #0#0;         || actividad
  #2#01 = #0#2;         || periodo
  #2#02 = #30#26;       || a¤o
  |SI FSalida ! 0;
      #2#06 = #6#1;
      #2#09 = #6#2;
      #2#12 = #6#3;
      #2#15 = #6#4;
      #2#18 = #6#5;
      #2#47 = #6#6;
      #2#60 = #8#99;
      |SI #2#45 = "T"; |Y #2#1 = 4;  #2#60 = #8#101; |FINSI;
      |SI #2#45 = "M"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
      |SI #2#45 = "D"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
  |FINSI;
|FPRC;

|PROCESO cierra_303_sop;

  |SI per_ant = -1;
     |HAZ abre_303_sop;
  |FINSI;
  #2#21 = #2#21 % #2#60;
  #2#43 = #2#43 % #2#60;
  #2#22 = #2#22 % #2#60;
  #2#44 = #2#44 % #2#60;
  #2#51 = #2#51 % #2#60;
  #2#58 = #2#58 % #2#60;
  #2#23 = #2#23 % #2#60;
  |HAZ totaliza_303;
  |SI #2#60 ! 100;
       nSwOp = 1;
       nActividad = 1;
       nPorce1 = 100;
       nPorce2 = #2#60;
       |BUCLE eosma100B;
   |FINSI;
  |SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
  |SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
  |LIBERA #2;
|FPRC;

|PROCESO sopor1;
   aCampo28 = "S";

|SI nEjerCobro = 0;
|| ... Procesos nuevos RECC ] 2014
   enSwCaja  = 0;
   nHayCaja  = 0;
   aTipoIVA  = "S";
   |SI enEjercicio ] 2014;
       enConcepto  = #5#6;
       enLibroCaja = #5#0;
       eaSerieCaja = #5#27;
       enRegisCaja = #5#2;
       |HAZ EsCajaIva;
       |SI enSwCaja = 1;  |HAZ LeeCab501;  |FINSI;
   |FINSI;
|FINSI;

   |SI nOpera = 1; |Y enSwCaja = 0; |ACABA; |FINSI;

   |SI nOpera = 0;
       |SI #5#44 < #0#2; |Y #5#28 = "S"; |Y enSwCaja = 0;
           |ACABA;                                        || No seleccionado
       |FINSI;
   |FINSI;

  nCampo20 = #5#20; #5#20 = 0;
  nCampo21 = #5#21; #5#21 = 0;
  nCampo22 = #5#22; #5#22 = 0;
  nCampo60 = #5#60; #5#60 = 0;
  nCampo61 = #5#61; #5#61 = 0;

  |PINTA 2145, #5#44;
  |PINTA 2148, #5#0;
  |PINTA 2151, #5#2;
  |SI per_ant ! #0#2;         || Antes #5#44
      |HAZ cierra_303_sop;
      |HAZ abre_303_sop;
      per_ant = #0#2;
  |FINSI;

  nTotalCaja = #5#26;
  nOpCaja = 0; |HAZ ElRECC;
  |SI enSwCaja = 1; |Y nHayCaja = 0;
       |SI #5#44 < #0#2; |Y #5#28 = "S";
           |ACABA;                                        || No seleccionado
       |FINSI;
  |FINSI;
  |SI nEjerCobro ! 0;
      |SI nBaseCaja1 = 0; |Y nBaseCaja2 = 0;
        |Y nBaseCaja3 = 0; |Y nBaseCaja4 = 0;
         |Y nBaseCaja5 = 0; |Y nCuotaCaja1 = 0;
          |Y nCuotaCaja2 = 0; |Y nCuotaCaja3 = 0;
           |Y nCuotaCaja4 = 0; |Y nCuotaCaja5 = 0;
        |ACABA;
      |FINSI;
  |FINSI;

  nCampo1 = 0;
  nCampo2 = 0;

  |DDEFECTO #7;
  #7#0 = #5#6;
  |LEE 001#7=;
  |SI FSalida = 0;
      |HAZ acum_sop;
  |SINO;
      |HAZ iva_sop;
  |FINSI;

  |SI enSwCaja = 1;
      |SI nOpera = 0; |Y nEjerCobro = 0;
          |SI #5#44 = #0#2;
             #2#113 = #2#113 + nBaseCaja;
             #2#114 = #2#114 + nCuotaCaja;
          |FINSI;
      |FINSI;
  |FINSI;

  nPorce1 = 100; nPorce2 = 100;
  |SI nCampo1 ! 0; |HAZ GuardaBases; |FINSI;

  |SI #7#2 ! 0; |Y #7#1 ! 0;
      |HAZ EspCompraDoble;
  |FINSI;

  |SI #8#104 = "S";
      |SI nOpera = 0; |Y nEjerCobro = 0;
          a340 = "S"; |HAZ Recibidas340;
      |FINSI;
  |FINSI;
  |SI enSwCaja = 1;
      nHayCaja = 0;
      nTotalCaja = #5#26;
      nOpCaja  = 1; |HAZ ElRECC;
  |FINSI;

  #5#20 = nCampo20;
  #5#21 = nCampo21;
  #5#22 = nCampo22;
  #5#60 = nCampo60;
  #5#61 = nCampo61;
  |SI enSwCaja = 0;
      #5#28 = "S";
      #5#44 = #0#2;
  |SINO;
      |SI #5#28 ! "S"; |Y aCampo28 = "S";
          #5#44 = #0#2;
      |FINSI;
      #5#28 = aCampo28;
  |FINSI;
  |SI nEjerCobro = 0;
      |GRABA 011#5a;
  |FINSI;
|FPRC;

|DEFBUCLE sopor;
 #5#1;
 44;
 #0#4, "  ",      1, #0#1;
 #0#5, "zz", 999999, #0#2;
 e;
 NULL, NULL, NULL, NULL, NULL, sopor1;
 #5#44, #5#0, #5#2, #5#27;    || ordena por periodo
|FIN;

|DEFBUCLE lineasRECC_C;
 #5#1;
 44;
 #0#4, "  ",      1,    0;
 #0#5, "zz", 999999, tri0;
 e;
 NULL, sopor1;
|FIN;

|PROCESO EspCompraDoble;
  |SI #7#1 = 9;                |ACABA; |FINSI;
  |SI #7#1 = 3; |Y #7#2 = 2;   |ACABA; |FINSI;

  |DDEFECTO #4;
  |PARA nPara4 = 0; |SI nPara4 [ 61; |HACIENDO nPara4 = nPara4 + 1;
        #4nPara4 = #5nPara4;
  |SIGUE;

  |ABRE #100;
  |SI #7#2 = 1;
      |HAZ iva_rep;
      |HAZ recargo;
  |SINO;
      |SI #7#2 = 14;  |O #7#2 = 10; |O #7#2 = 16; |O #7#2 = 15;
          |HAZ iva_rep;
          |HAZ recargo;
      |FINSI;
      |HAZ acum_rep;
  |FINSI;
  |CIERRA #100;
  |DDEFECTO #4;
|FPRC;

||.........IVA REPERCUTIDO
|PROCESO ConcepVenta;
     #100#0 = "303";
     #100#1 = #2#0;
     #100#2 = nActividad;
     #100#3 = #2#1;
     #100#4 = #2#2;
     #100#5 = nCampo1;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #2#0;
         #100#2 = nActividad;
         #100#3 = #2#1;
         #100#4 = #2#2;
         #100#5 = nCampo1;
         |GRABA 020#100b;
     |FINSI;

     nSwAcum = 0;

     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #100nPara2  = tiva;
               #100nPara1  = #100nPara1 + base;
               #100nPara2  = tiva;
               #100nPara3  = #100nPara3 + iva;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #100nPara2 = 0;
                   #100nPara1  = base;
                   #100nPara2 = tiva;
                   #100nPara3  = iva;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;

     |SI nSubeIVA ! 0;
         nMasBase = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
                nPara2 = nPara1 + 1;
                nPara3 = nPara1 + 2;
                |SI #100nPara2 ! 0; nMasBase = nMasBase + 1; |FINSI;
         |SIGUE;
         |SI nMasBase > 1;
             |SI #100#5 = 5;  nIVA5 = 1; |FINSI;
             |SI #100#5 = 8;  nIVA8 = 1; |FINSI;
             |SI #100#5 = 11; nIVA11 = 1; |FINSI;
             |SI #100#5 = 14; nIVA14 = 1; |FINSI;
             |SI #100#5 = 17; nIVA17 = 1; |FINSI;
             |SI #100#5 = 46; nIVA46 = 1; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO acum_rep;
  tot_bas = #4#8  + #4#9  + #4#10 + #4#52 + #4#53; ||Total bases
  tot_iva = #4#14 + #4#15 + #4#16 + #4#56 + #4#57; || Total IVA
  tot_iva = tot_iva + #4#20 + #4#21 + #4#22 + #4#60 + #4#61; || + recargo

  |SI enSwCaja = 1;
      nBaseCaja  = tot_bas;
      nCuotaCaja = tot_iva;
      tot_iva = nCuotaCaja1 + nCuotaCaja2 + nCuotaCaja3 + nCuotaCaja4 + nCuotaCaja5;
      tot_bas = nBaseCaja1  + nBaseCaja2  + nBaseCaja3  + nBaseCaja4  + nBaseCaja5;
  |FINSI;

  |SI #7#2 = 2;  ||Adq Intracomunitarias
      #2#49 = #2#49 + tot_bas;          ||base intracomunitario
      #2#50 = #2#50 + tot_iva;
      nCampo1 = 0;
      |SI #7#1 = 3;
          |SI #4#48 = "N";
              #2#66 = #2#66 + tot_bas;
              #2#51 = #2#51 + tot_iva;
              nCampo1 = 66;
          |FINSI;
          |SI #4#48 = "S";
               #2#67 = #2#67 + tot_iva;
               #2#58 = #2#58 + tot_iva;
              nCampo1 = 67;
          |FINSI;
      |FINSI;
      |SI enSwCaja = 0;
          |SI #4#14 ! 0; nBase = #4#8;  nIVA = #4#11; nCuota = #4#14; |HAZ PonerDesglose; |FINSI;
          |SI #4#15 ! 0; nBase = #4#9;  nIVA = #4#12; nCuota = #4#15; |HAZ PonerDesglose; |FINSI;
          |SI #4#16 ! 0; nBase = #4#10; nIVA = #4#13; nCuota = #4#16; |HAZ PonerDesglose; |FINSI;
          |SI #4#56 ! 0; nBase = #4#52; nIVA = #4#54; nCuota = #4#56; |HAZ PonerDesglose; |FINSI;
          |SI #4#57 ! 0; nBase = #4#53; nIVA = #4#55; nCuota = #4#57; |HAZ PonerDesglose; |FINSI;
      |SINO;
          |SI nCuotaCaja1 ! 0; nBase = nBaseCaja1; nIVA = #4#11; nCuota = nCuotaCaja1; |HAZ PonerDesglose; |FINSI;
          |SI nCuotaCaja2 ! 0; nBase = nBaseCaja2; nIVA = #4#12; nCuota = nCuotaCaja2; |HAZ PonerDesglose; |FINSI;
          |SI nCuotaCaja3 ! 0; nBase = nBaseCaja3; nIVA = #4#13; nCuota = nCuotaCaja3; |HAZ PonerDesglose; |FINSI;
          |SI nCuotaCaja4 ! 0; nBase = nBaseCaja4; nIVA = #4#54; nCuota = nCuotaCaja4; |HAZ PonerDesglose; |FINSI;
          |SI nCuotaCaja5 ! 0; nBase = nBaseCaja5; nIVA = #4#55; nCuota = nCuotaCaja5; |HAZ PonerDesglose; |FINSI;
      |FINSI;
      nPorce1 = 100; nPorce2 = 100;
      |SI nCampo1 ! 0; |HAZ ActuRepartoAdq; |FINSI;

  |FINSI;

  |SI #7#2 = 3;       ||Entrada Intracomunitaria
      #2#54 = #2#54 + tot_bas;
      #2#35 = #2#35 + tot_bas; || Pto. 83
  |FINSI;

  |SI #7#2 = 4;       ||Operaciones Regimen Simplificado
      #2#34 = #2#34 + tot_bas; || Pto. 80
  |FINSI;

  |SI #7#2 = 5;       ||Op. AGyP
      #2#38 = #2#38 + tot_bas; || Pto. 81
  |FINSI;

  |SI #7#2 = 6;       ||Recargo de equivalencia
      #2#39  = #2#39 + tot_bas; || Pto. 82
  |FINSI;

  |SI #7#2 = 7;       ||Op.sujetas que originan el derecho a devolucion
      #2#53  = #2#53 + tot_bas; || Pto. 91
  |FINSI;

  |SI #7#2 = 8;       ||Exportaciones y otras con derecho a deduccion
      #2#36 = #2#36 + tot_bas; || Pto. 84
      #2#68 = #2#68 + tot_bas; || Pto. 84
  |FINSI;

  |SI #7#2 = 9;       ||Op Exentas sin derecho a deduccion
      #2#37 = #2#37 + tot_bas; || Pto. 85
  |FINSI;

  |SI #7#2 = 10;      ||Entrega bienes inmuebles
      #2#40 = #2#40 + tot_bas; || Pto. 86
  |FINSI;

  |SI #7#2 = 11;      ||Ventas a distancia no sujetas
      #2#53 = #2#53 + tot_bas; || Pto. 90
  |FINSI;

  |SI #7#2 = 12;      ||Entrega bienes objetos de otros estados miembros
      #2#56 = #2#56 + tot_bas; || Pto. 92
  |FINSI;

  |SI #7#2 = 13;      ||Entregas Interiores de Bienes
       #2#57 = #2#57 + tot_bas; || Pto 93
  |FINSI;

  |SI #7#2 = 14;      ||Entrega bienes de inversion
      #2#41 = #2#41 + tot_bas; || Pto 87
  |FINSI;

  |SI #7#2 = 15;
      #2#71 = #2#71 + tot_bas;
      #2#69 = #2#71;
  |FINSI;

  |SI #7#2 = 16; |O #7#2 = 18; ||tique 993_119
      #2#59 = #2#59 + tot_bas;
  |FINSI;

  |SI #7#2 = 17;
      tot_iva = #4#14 + #4#15 + #4#16 + #4#56 + #4#57; || Total IVA
      tot_rec = #4#20 + #4#21 + #4#22 + #4#60 + #4#61; || + recargo
      |SI tot_iva ! 0;
          #2#105 = #2#105 + tot_bas;
          #2#106 = #2#106 + tot_iva;
      |FINSI;
      |SI tot_rec ! 0;
          #2#107 = #2#107 + tot_bas;
          #2#108 = #2#108 + tot_rec;
      |FINSI;
      #2#70 = #2#70 + (#4#8 + #4#9 + #4#10 + #4#52 + #4#53);
  |FINSI;

  |SI #7#2 = 18;  ||Otras ISP
      #2#103 = #2#103 + tot_bas;          ||base intracomunitario
      #2#104 = #2#104 + tot_iva;
      nCampo1 = 103;
      |SI enSwCaja = 0;
          |SI #4#14 ! 0; base = #4#8;  tiva = #4#11; iva = #4#14; |HAZ ConcepVenta; |FINSI;
          |SI #4#15 ! 0; base = #4#9;  tiva = #4#12; iva = #4#15; |HAZ ConcepVenta; |FINSI;
          |SI #4#16 ! 0; base = #4#10; tiva = #4#13; iva = #4#16; |HAZ ConcepVenta; |FINSI;
          |SI #4#56 ! 0; base = #4#52; tiva = #4#54; iva = #4#56; |HAZ ConcepVenta; |FINSI;
          |SI #4#57 ! 0; base = #4#53; tiva = #4#55; iva = #4#57; |HAZ ConcepVenta; |FINSI;
      |SINO;
          |SI nCuotaCaja1 ! 0; base = nBaseCaja1; tiva = #4#11; iva = nCuotaCaja1; |HAZ ConcepVenta; |FINSI;
          |SI nCuotaCaja2 ! 0; base = nBaseCaja2; tiva = #4#12; iva = nCuotaCaja2; |HAZ ConcepVenta; |FINSI;
          |SI nCuotaCaja3 ! 0; base = nBaseCaja3; tiva = #4#13; iva = nCuotaCaja3; |HAZ ConcepVenta; |FINSI;
          |SI nCuotaCaja4 ! 0; base = nBaseCaja4; tiva = #4#54; iva = nCuotaCaja4; |HAZ ConcepVenta; |FINSI;
          |SI nCuotaCaja5 ! 0; base = nBaseCaja5; tiva = #4#55; iva = nCuotaCaja5; |HAZ ConcepVenta; |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO recargo;
  |SI enSwCaja = 1; |ACABA; |FINSI; ||no puede tener recargo si esta en RECC

  x1 = 0;  x2 = 0;  x3 = 0;  x4 = 0;  x5 = 0;
  |SALVA_DATOS #4;
  |SI nSubeIVA = 2;
      |SI #4#17 =  1; #4#17 = 1.40; |FINSI;
      |SI #4#17 =  4; #4#17 = 5.20; |FINSI;
      |SI #4#18 =  1; #4#18 = 1.40; |FINSI;
      |SI #4#18 =  4; #4#18 = 5.20; |FINSI;
      |SI #4#19 =  1; #4#19 = 1.40; |FINSI;
      |SI #4#19 =  4; #4#19 = 5.20; |FINSI;
      |SI #4#58 =  1; #4#58 = 1.40; |FINSI;
      |SI #4#58 =  4; #4#58 = 5.20; |FINSI;
      |SI #4#59 =  1; #4#59 = 1.40; |FINSI;
      |SI #4#59 =  4; #4#59 = 5.20; |FINSI;
  |FINSI;

  |SI #4#17 = #6#4;   x1 = 14;  |FINSI;
  |SI #4#17 = #6#5;   x1 = 17;  |FINSI;
  |SI #4#17 = #6#6;   x1 = 46;  |FINSI;

  |SI #4#18 = #6#4;   x2 = 14;  |FINSI;
  |SI #4#18 = #6#5;   x2 = 17;  |FINSI;
  |SI #4#18 = #6#6;   x2 = 46;  |FINSI;

  |SI #4#19 = #6#4;   x3 = 14;  |FINSI;
  |SI #4#19 = #6#5;   x3 = 17;  |FINSI;
  |SI #4#19 = #6#6;   x3 = 46;  |FINSI;

  |SI #4#58 = #6#4;   x4 = 14;  |FINSI;
  |SI #4#58 = #6#5;   x4 = 17;  |FINSI;
  |SI #4#58 = #6#6;   x4 = 46;  |FINSI;

  |SI #4#59 = #6#4;   x5 = 14;  |FINSI;
  |SI #4#59 = #6#5;   x5 = 17;  |FINSI;
  |SI #4#59 = #6#6;   x5 = 46;  |FINSI;

  |REPON_DATOS #4;
  |SI x1 ! 0;
      nCampo1 = x1;
      #2x1 = #2x1 + #4#08;                     || base 1
      x1 = x1 + 1;    #2x1 = #4#17;            || (%) rec. 1
      x1 = x1 + 1;    #2x1 = #2x1 + #4#20;     || cuota rec. 1
      base = #4#8;
      tiva = #4#17;
      iva  = #4#20;
      |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
  |FINSI;
  |SI x2 ! 0;
      nCampo1 = x2;
      #2x2 = #2x2 + #4#09;                     || base 2
      x2 = x2 + 1;    #2x2 = #4#18;            || (%) rec. 2
      x2 = x2 + 1;    #2x2 = #2x2 + #4#21;     || cuota rec. 2
      base = #4#9;
      tiva = #4#18;
      iva  = #4#21;
      |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
  |FINSI;
  |SI x3 ! 0;
      nCampo1 = x3;
      #2x3 = #2x3 + #4#10;                     || base 3
      x3 = x3 + 1;    #2x3 = #4#19;            || (%) rec. 3
      x3 = x3 + 1;    #2x3 = #2x3 + #4#22;     || cuota rec. 3
      base = #4#10;
      tiva = #4#19;
      iva  = #4#22;
      |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
  |FINSI;
  |SI x4 ! 0;
      nCampo1 = x4;
      #2x4 = #2x4 + #4#52;                     || base 4
      x4 = x4 + 1;    #2x4 = #4#58;            || (%) rec. 4
      x4 = x4 + 1;    #2x4 = #2x4 + #4#60;     || cuota rec. 4
      base = #4#52;
      tiva = #4#58;
      iva  = #4#60;
      |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
  |FINSI;
  |SI x5 ! 0;
      nCampo1 = x5;
      #2x5 = #2x5 + #4#53;                     || base 5
      x5 = x5 + 1;    #2x5 = #4#59;            || (%) rec. 5
      x5 = x5 + 1;    #2x5 = #2x5 + #4#61;     || cuota rec. 5
      base = #4#53;
      tiva = #4#59;
      iva  = #4#61;
      |SI nSubeIVA = 2; |HAZ ConcepVenta; |FINSI;
  |FINSI;
|FPRC;

|PROCESO iva_rep;
  x1 = 0;  x2 = 0;  x3 = 0;  x4 = 0;  x5 = 0;
  |SALVA_DATOS #4;
  |SI nSubeIVA = 1;
      |SI #4#11 = 16; #4#11 = 18; |FINSI;
      |SI #4#11 =  7; #4#11 =  8; |FINSI;
      |SI #4#12 = 16; #4#12 = 18; |FINSI;
      |SI #4#12 =  7; #4#12 =  8; |FINSI;
      |SI #4#13 = 16; #4#13 = 18; |FINSI;
      |SI #4#13 =  7; #4#13 =  8; |FINSI;
      |SI #4#54 = 16; #4#54 = 18; |FINSI;
      |SI #4#54 =  7; #4#54 =  8; |FINSI;
      |SI #4#55 = 16; #4#55 = 18; |FINSI;
      |SI #4#55 =  7; #4#55 =  8; |FINSI;
  |FINSI;

  |SI nSubeIVA = 2;
      |SI #4#11 = 18; |O #4#11 = 16; #4#11 = 21; |FINSI;
      |SI #4#11 =  8; |O #4#11 =  7; #4#11 = 10; |FINSI;
      |SI #4#12 = 18; |O #4#12 = 16; #4#12 = 21; |FINSI;
      |SI #4#12 =  8; |O #4#12 =  7; #4#12 = 10; |FINSI;
      |SI #4#13 = 18; |O #4#13 = 16; #4#13 = 21; |FINSI;
      |SI #4#13 =  8; |O #4#13 =  7; #4#13 = 10; |FINSI;
      |SI #4#54 = 18; |O #4#54 = 16; #4#54 = 21; |FINSI;
      |SI #4#54 =  8; |O #4#54 =  7; #4#54 = 10; |FINSI;
      |SI #4#55 = 18; |O #4#55 = 16; #4#55 = 21; |FINSI;
      |SI #4#55 =  8; |O #4#55 =  7; #4#55 = 10; |FINSI;
  |FINSI;

  |SI #4#11 = #6#1;   x1 =  5;  |FINSI;
  |SI #4#11 = #6#2;   x1 =  8;  |FINSI;
  |SI #4#11 = #6#3;   x1 = 11;  |FINSI;

  |SI #4#12 = #6#1;   x2 =  5;  |FINSI;
  |SI #4#12 = #6#2;   x2 =  8;  |FINSI;
  |SI #4#12 = #6#3;   x2 = 11;  |FINSI;

  |SI #4#13 = #6#1;   x3 =  5;  |FINSI;
  |SI #4#13 = #6#2;   x3 =  8;  |FINSI;
  |SI #4#13 = #6#3;   x3 = 11;  |FINSI;

  |SI #4#54 = #6#1;   x4 =  5;  |FINSI;
  |SI #4#54 = #6#2;   x4 =  8;  |FINSI;
  |SI #4#54 = #6#3;   x4 = 11;  |FINSI;

  |SI #4#55 = #6#1;   x5 =  5;  |FINSI;
  |SI #4#55 = #6#2;   x5 =  8;  |FINSI;
  |SI #4#55 = #6#3;   x5 = 11;  |FINSI;

  |REPON_DATOS #4;
  |SI x1 ! 0;
      nCampo1 = x1;
      base = #4#8;
      tiva = #4#11;
      iva  = #4#14;
      |SI enSwCaja = 1;
          base = nBaseCaja1; nBaseCaja  = nBaseCaja  + #4#8;
          iva = nCuotaCaja1; nCuotaCaja = nCuotaCaja + #4#14;
      |FINSI;
      #2x1 = #2x1 + base;                    || base 1
      x1 = x1 + 1;    #2x1 = #4#11;          || (%) iva 1
      x1 = x1 + 1;    #2x1 = #2x1 + iva;     || cuota iva 1
      |HAZ ConcepVenta;
  |FINSI;
  |SI x2 ! 0;
      nCampo1 = x2;
      base = #4#9;
      tiva = #4#12;
      iva  = #4#15;
      |SI enSwCaja = 1;
          base = nBaseCaja2; nBaseCaja  = nBaseCaja  + #4#9;
          iva = nCuotaCaja2; nCuotaCaja = nCuotaCaja + #4#15;
      |FINSI;
      #2x2 = #2x2 + base;                     || base 2
      x2 = x2 + 1;    #2x2 = #4#12;           || (%) iva 2
      x2 = x2 + 1;    #2x2 = #2x2 + iva;      || cuota iva 2
      |HAZ ConcepVenta;
  |FINSI;
  |SI x3 ! 0;
      nCampo1 = x3;
      base = #4#10;
      tiva = #4#13;
      iva  = #4#16;
      |SI enSwCaja = 1;
          base = nBaseCaja3; nBaseCaja  = nBaseCaja  + #4#10;
          iva = nCuotaCaja3; nCuotaCaja = nCuotaCaja + #4#16;
      |FINSI;
      #2x3 = #2x3 + base;                    || base 3
      x3 = x3 + 1;    #2x3 = #4#13;          || (%) iva 3
      x3 = x3 + 1;    #2x3 = #2x3 + iva;     || cuota iva 3
      |HAZ ConcepVenta;
  |FINSI;
  |SI x4 ! 0;
      nCampo1 = x4;
      base = #4#52;
      tiva = #4#54;
      iva  = #4#56;
      |SI enSwCaja = 1;
          base = nBaseCaja4; nBaseCaja  = nBaseCaja  + #4#52;
          iva = nCuotaCaja4; nCuotaCaja = nCuotaCaja + #4#56;
      |FINSI;
      #2x4 = #2x4 + base;                    || base 4
      x4 = x4 + 1;    #2x4 = #4#54;          || (%) iva 4
      x4 = x4 + 1;    #2x4 = #2x4 + iva;     || cuota iva 4
      |HAZ ConcepVenta;
  |FINSI;
  |SI x5 ! 0;
      nCampo1 = x5;
      base = #4#53;
      tiva = #4#55;
      iva  = #4#57;
      |SI enSwCaja = 1;
          base = nBaseCaja5; nBaseCaja  = nBaseCaja  + #4#53;
          iva = nCuotaCaja5; nCuotaCaja = nCuotaCaja + #4#57;
      |FINSI;
      #2x5 = #2x5 + base;                     || base 5
      x5 = x5 + 1;    #2x5 = #4#55;           || (%) iva 5
      x5 = x5 + 1;    #2x5 = #2x5 + iva;      || cuota iva 5
      |HAZ ConcepVenta;
  |FINSI;

  |SI #7#1 [ 1; |Y enSwCaja = 0;

      #2#70 = #2#70 + (#4#8 + #4#9 + #4#10 + #4#52 + #4#53);

  |FINSI;

|FPRC;

|PROCESO abre_303_rep;
  perio  = #0#2; || periodo (1-12)
  activi = #0#0; || tipo (T/M/A)
  any    = #30#26;  || any
  |SI perio ! 1;
       |HAZ lee_ant;        || carga compensar
  |SINO;
       |HAZ lee_any_a; || el del a¤o pasado
  |FINSI;
  #2#00 = #30#2;     || empresa
  #2#45 = #0#0;      || actividad
  #2#01 = #0#2;      || periodo
  #2#02 = #30#26;    || a¤o

  |LEE 001#2=;
  |SI FSalida = 0;
      |BORRA 020#2a;
  |FINSI;
  |DDEFECTO #2;
  #2#00 = #30#2;      || empresa
  #2#45 = #0#0;       || actividad
  #2#01 = #0#2;       || periodo
  #2#02 = #30#26;     || a¤o
  #2#06 = #6#1;
  #2#09 = #6#2;
  #2#12 = #6#3;
  #2#15 = #6#4;
  #2#18 = #6#5;
  #2#47 = #6#6;
  #2#60 = #8#99;
  |SI #2#45 = "T"; |Y #2#1 = 4;  #2#60 = #8#101; |FINSI;
  |SI #2#45 = "M"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
  |SI #2#45 = "D"; |Y #2#1 = 12; #2#60 = #8#101; |FINSI;
|FPRC;

|PROCESO cierra_303_rep;
  |SI per_ant = -1;  |ACABA;  |FINSI;
  |HAZ totaliza_303;
  |SI nIVA5  = 1;
      #2#6  = (#2#7  / #2#5)  * 100;
      |SI #2#6 [ 0; #2#6 = #6#1; |FINSI;
  |FINSI;
  |SI nIVA8  = 1;
      #2#9  = (#2#10 / #2#8)  * 100;
      |SI #2#9 [ 0; #2#9 = #6#2; |FINSI;
  |FINSI;
  |SI nIVA11 = 1;
      #2#12 = (#2#13 / #2#11) * 100;
      |SI #2#12 [ 0; #2#12 = #6#3; |FINSI;
  |FINSI;
  |SI nIVA14 = 1;
      #2#15 = (#2#16 / #2#14) * 100;
      |SI #2#15 [ 0; #2#15 = #6#4; |FINSI;
  |FINSI;
  |SI nIVA17 = 1;
      #2#18 = (#2#19 / #2#17) * 100;
      |SI #2#18 [ 0; #2#18 = #6#5; |FINSI;
  |FINSI;
  |SI nIVA46 = 1;
      #2#47 = (#2#48 / #2#46) * 100;
      |SI #2#47 [ 0; #2#47 = #6#6; |FINSI;
  |FINSI;
  |GRABA 020#2n;
|FPRC;

|PROCESO reper1;
   aCampo28 = "S";
   aTipoIVA = "R";

|SI nEjerCobro = 0;
|| ... Procesos nuevos RECC ] 2014
   enSwCaja  = 0;
   nHayCaja  = 0;
   |SI enEjercicio ] 2014;
       enConcepto  = #4#6;
       enLibroCaja = #4#0;
       eaSerieCaja = #4#27;
       enRegisCaja = #4#2;
       |HAZ EsCajaIva;
       |SI enSwCaja = 1;  |HAZ LeeCab501;  |FINSI;
   |FINSI;
|FINSI;

   |SI nOpera = 1; |Y enSwCaja = 0; |ACABA; |FINSI;

   |SI nOpera = 0;
       |SI #4#44 < #0#2; |Y #4#28 = "S"; |Y enSwCaja = 0;
           |ACABA;                                        || No seleccionado
       |FINSI;
   |FINSI;

  |PINTA 2045, #4#44;
  |PINTA 2048, #4#0;
  |PINTA 2051, #4#2;
  |SI per_ant ! #0#2;              || Antes #4#44
      |HAZ cierra_303_rep;
      |HAZ abre_303_rep;
      per_ant = #0#2;
  |FINSI;

  nTotalCaja = #4#26;
  nOpCaja = 0; |HAZ ElRECC;
  |SI enSwCaja = 1; |Y nHayCaja = 0;
       |SI #4#44 < #0#2; |Y #4#28 = "S";
           |ACABA;                                        || No seleccionado
       |FINSI;
  |FINSI;
  |SI nEjerCobro ! 0;
      |SI nBaseCaja1 = 0; |Y nBaseCaja2 = 0;
        |Y nBaseCaja3 = 0; |Y nBaseCaja4 = 0;
         |Y nBaseCaja5 = 0; |Y nCuotaCaja1 = 0;
          |Y nCuotaCaja2 = 0; |Y nCuotaCaja3 = 0;
           |Y nCuotaCaja4 = 0; |Y nCuotaCaja5 = 0;
        |ACABA;
      |FINSI;
  |FINSI;

  |DDEFECTO #7;
  #7#0 = #4#6;
  |LEE 001#7=;
  |SI FSalida = 0;
      |SI #7#2 = 1; |O #7#2 = 0;
          |HAZ iva_rep;
          |HAZ recargo;
      |SINO;
          |SI #7#2 = 14;  |O #7#2 = 10; |O #7#2 = 16; |O #7#2 = 15;
              |HAZ iva_rep;
              |HAZ recargo;
          |FINSI;
          |HAZ acum_rep;
      |FINSI;
  |SINO;
      |HAZ iva_rep;
      |HAZ recargo;
  |FINSI;

  |SI enSwCaja = 1;
      |SI nOpera = 0; |Y nEjerCobro = 0;
          |SI #4#44 = #0#2;
              #2#111 = #2#111 + nBaseCaja;
              #2#112 = #2#112 + nCuotaCaja;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI #7#2 ! 0; |Y #7#1 ! 0;
      |HAZ EspVentaDoble;
  |FINSI;

  |SI #8#104 = "S";
      |SI nOpera = 0; |Y nEjerCobro = 0;
          a340 = "S"; |HAZ Expedidas340;
      |FINSI;
  |FINSI;
  |SI enSwCaja = 1;
      nHayCaja = 0;
      nTotalCaja = #4#26;
      nOpCaja  = 1; |HAZ ElRECC;
  |FINSI;

  |SI enSwCaja = 0;
      #4#28 = "S";
      #4#44 = #0#2;
  |SINO;
      |SI #4#28 ! "S"; |Y aCampo28 = "S";
          #4#44 = #0#2;
      |FINSI;
      #4#28 = aCampo28;
  |FINSI;
  |SI nEjerCobro = 0;
      |GRABA 011#4a;
  |FINSI;
|FPRC;

|DEFBUCLE reper;
 #4#1;
 44;
 #0#4, "  ",      0 , #0#1;
 #0#5, "zz", 999999 , #0#2;
 e;
 NULL, NULL, NULL, NULL, NULL, reper1;
 #4#44, #4#0, #4#2, #4#27;    || ordena por periodo
|FIN;

|DEFBUCLE lineasRECC_V;
 #4#1;
 44;
 #0#4, "  ",      0 ,    0;
 #0#5, "zz", 999999 , tri0;
 e;
 NULL, reper1;
|FIN;

|PROCESO EspVentaDoble;
  |SI #7#1 = 9;                |ACABA; |FINSI;
  |SI #7#1 = 3; |Y #7#2 = 2;   |ACABA; |FINSI;

  |DDEFECTO #5;
  |PARA nPara4 = 0; |SI nPara4 [ 61; |HACIENDO nPara4 = nPara4 + 1;
        #5nPara4 = #4nPara4;
  |SIGUE;

  |CIERRA #100;
  |HAZ acum_sop;
  |ABRE #100;
  |DDEFECTO #5;
|FPRC;
|| *********************************************************************
|PROCESO Lee501_2014;
   ePerioCaja = #501#18;
   |HAZ ePathCaja;

   aTipoIVA   = #501#13;
   nHayCaja   = 1;
   enSwCaja   = 1;
   eDevenCaja = #501#17;

   |SI aTipoIVA = "S";
       |CIERRA #5;  |PATH_DAT #5  ePathCaja;
       |ABRE #5;
       #5#0  = #501#0;
       #5#27 = #501#14;
       #5#2  = #501#15;
       |LEE 041#5=;
       |SI FSalida = 0;
           enConcepto  = #5#6;
           enLibroCaja = #5#0;
           eaSerieCaja = #5#27;
           enRegisCaja = #5#2;
           |HAZ sopor1;
      |FINSI;
      |CIERRA #5;
   |FINSI;

   |SI aTipoIVA = "R";
       |CIERRA #4; |PATH_DAT #4 ePathCaja;
       |ABRE #4;
       #4#0  = #501#0;
       #4#27 = #501#14;
       #4#2  = #501#15;
       |LEE 041#4=;
       |SI FSalida = 0;
           enConcepto  = #4#6;
           enLibroCaja = #4#0;
           eaSerieCaja = #4#27;
           enRegisCaja = #4#2;
           |HAZ reper1;
      |FINSI;
      |CIERRA #4;
   |FINSI;
|FPRC;

|DEFBUCLE Lee501_2014;
   #501#1;
   ;
   aTipo501, nEjerCobro, 01, "  ", 000001;
   aTipo501, nEjerCobro, 99, "zz", 999999;
   e;
   NULL, Lee501_2014;
|FIN;
|| *********************************************************************

|PROCESO lee_ant;
     compens = 0;
     perio = perio - 1;
     #2#45 = activi;
     #2#1  = perio;
     #2#2  = any;
     |LEE 001#2=;
     |SI FSalida = 0;
          compens = #2#32;
     |FINSI;
     perio = perio + 1;
     sw_per = 1;
|FPRC;

|PROCESO lee_any_a;
     compens = 0;
     sw_exi = 0;
     || lee el a¤o anterior, para ver si existe
     |ABRE #30;
     a_emp = #30#2;
     ac_pe = #30#3;
     a_per = ac_pe - 1;
     |SI a_per < 0; a_per = 9; |FINSI;
     #30#3 = a_per;
     |LEE 011#30=;
     |SI FSalida ! 0;
         sw_exi = 1;
     |FINSI;
     #30#2 = a_emp;
     #30#3 = ac_pe;
     |LEE 011#30=;
     |CIERRA #30;
     |SI sw_exi = 1; |ACABA; |FINSI;

     |SUB_EJECUTA "caany303";
|FPRC;

|PROCESO CalTipoyPer;
     aTipo = #0#0;
     |SI aTipo = "F";  aTipo = "T";  |FINSI;
     |SI aTipo = "D";  aTipo = "M";  |FINSI;

     nPer = 7;  |SI aTipo = "T"; nPer = 3; |FINSI;
     nSubeIVA  = 0;
     |SI enEjercicio = 2010; |Y #0#2 ] nPer;  nSubeIVA = 1;  |FINSI;
     |SI enEjercicio ] 2011;                  nSubeIVA = 1;  |FINSI;

     nPer = 9;  |SI aTipo = "T"; nPer = 3; |FINSI;
     |SI enEjercicio = 2012; |Y #0#2 ] nPer;  nSubeIVA = 2;  |FINSI;
     |SI enEjercicio ] 2013;                  nSubeIVA = 2;  |FINSI;
|FPRC;

|PROCESO CargaActividad;

     |SI nMod390 = 1;

         nNume = 0; nPara1 = 120;

         |PARA nNume1 = 20; |SI nNume1 [ 25; |HACIENDO nNume1 = nNume1 + 1;
               nNume2 = nNume1 + 12;
               nNume3 = nNume1 + 6;
               aAlfa = #caportad#nNume1#; |QBF aAlfa;
               |SI aAlfa ! "";
                   nNume  = nNume  + 1;   #caman303#nPara1# = nNume;
                   nPara1 = nPara1 + 1;   aAlfa =  #caportad#nNume2# - "E"; #caman303#nPara1# = aAlfa;
                   nPara1 = nPara1 + 1;   #caman303#nPara1# = #caportad#nNume1#;
                   nPara1 = nPara1 + 1;   #caman303#nPara1# = #caportad#nNume3#;
                   nPara1 = nPara1 + 1;
               |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Totalno390;
     #caman303#153 = #caman303#145 + #caman303#146 + #caman303#148;
     #caman303#153 = #caman303#153 + #caman303#149 + #caman303#150 + #caman303#151;
     #caman303#153 = #caman303#153 - #caman303#152;

     #caman303#153 = #caman303#153 + #caman303#164 + #caman303#165;
     #caman303#153 = #caman303#153 + #caman303#166 + #caman303#167;
     #caman303#153 = #caman303#153 + #caman303#168 + #caman303#169;
     #caman303#153 = #caman303#153 - #caman303#170;
|FPRC;

|PROCESO LeoLosOtros;
         #caman303#145 = #caman303#145 + #regiva@#70;
         #caman303#146 = #caman303#146 + #regiva@#154;
         #caman303#148 = #caman303#148 + #regiva@#37;
         #caman303#149 = #caman303#149 + #regiva@#71;
         #caman303#150 = #caman303#150 + #regiva@#56;
         #caman303#151 = #caman303#151 + #regiva@#34;
         #caman303#152 = #caman303#152 + #regiva@#40;

         #caman303#164 = #caman303#164 + #regiva@#35;
         #caman303#165 = #caman303#165 + #regiva@#36;
         #caman303#166 = #caman303#166 + #regiva@#38;
         #caman303#167 = #caman303#167 + #regiva@#39;
         #caman303#168 = #caman303#168 + #regiva@#72;
         #caman303#169 = #caman303#169 + #regiva@#73;
         #caman303#170 = #caman303#170 + #regiva@#41;
|FPRC;

|DEFBUCLE LeoLosOtros;
  #regiva@#1003;
  ;
  #caman303#45,     01, #caman303#2;
  #caman303#45, nNume1, #caman303#2;
  e;
  NULL, LeoLosOtros;
|FIN;

|PROCESO TotalEsp390;
         nNume1 = #caman303#1 - 1;
         #caman303#145 = #caman303#70;
         #caman303#146 = #caman303#154;
         #caman303#148 = #caman303#37;
         #caman303#149 = #caman303#71;
         #caman303#150 = #caman303#56;
         #caman303#151 = #caman303#34;
         #caman303#152 = #caman303#40;

         #caman303#164 = #caman303#35;
         #caman303#165 = #caman303#36;
         #caman303#166 = #caman303#38;
         #caman303#167 = #caman303#39;
         #caman303#168 = #caman303#72;
         #caman303#169 = #caman303#73;
         #caman303#170 = #caman303#41;

         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/caman303.mas";
         |CARGA_DEF aMas, regiva@;
         |BUCLE LeoLosOtros;
         |DESCARGA_DEF #regiva@;

         |HAZ Totalno390;
         #caman303#155 = "S";
|FPRC;

|PROCESO reo303; |TIPO 3;

  |DFICE aPathOrigen;

  |SI enEjercicio ] 2015;
      nHagoSub = 0;
      |SI #0#0 = "A";    nHagoSub = 1; |FINSI;
      |SI #0#0 = "T";
          |SI #0#2 = 4;  nHagoSub = 1; |FINSI;
      |FINSI;
      |SI #0#0 = "D"; |O #0#0 = "M";
          |SI #0#2 = 12; nHagoSub = 1; |FINSI;
      |FINSI;

      |SI nHagoSub = 1;
          enPerLiq = #0#2;
          aAlfa  = "camaccz4;Pase";
          |SUB_EJECUTA_NP aAlfa;
      |FINSI;
  |FINSI;

  |HAZ CalTipoyPer;

  |ABRE #6;
  |LEE 001#6p;
  FEstado = FSalida;
  |CIERRA #6;

  |SI FEstado = 0;
     |SI nSubeIVA = 2;
         |SI #6#1 = 7;  |O #6#1 = 8;  #6#1 = 10; |FINSI;
         |SI #6#1 = 16; |O #6#1 = 18; #6#1 = 21; |FINSI;
         |SI #6#2 = 7;  |O #6#2 = 8;  #6#2 = 10; |FINSI;
         |SI #6#2 = 16; |O #6#2 = 18; #6#2 = 21; |FINSI;
         |SI #6#3 = 7;  |O #6#3 = 8;  #6#3 = 10; |FINSI;
         |SI #6#3 = 16; |O #6#3 = 18; #6#3 = 21; |FINSI;

         |SI #6#4 = 1;  #6#4 = 1.40; |FINSI;
         |SI #6#4 = 4;  #6#4 = 5.20; |FINSI;
         |SI #6#5 = 1;  #6#5 = 1.40; |FINSI;
         |SI #6#5 = 4;  #6#5 = 5.20; |FINSI;
         |SI #6#6 = 1;  #6#6 = 1.40; |FINSI;
         |SI #6#6 = 4;  #6#6 = 5.20; |FINSI;
     |SINO;
         |SI #6#4 = 1.40;  #6#4 = 1; |FINSI;
         |SI #6#4 = 5.20;  #6#4 = 4; |FINSI;
         |SI #6#5 = 1.40;  #6#5 = 1; |FINSI;
         |SI #6#5 = 5.20;  #6#5 = 4; |FINSI;
         |SI #6#6 = 1.40;  #6#6 = 1; |FINSI;
         |SI #6#6 = 5.20;  #6#6 = 4; |FINSI;

         |SI nSubeIVA = 1;
             |SI #6#1 = 7;  |O #6#1 = 10; #6#1 = 8;  |FINSI;
             |SI #6#1 = 16; |O #6#1 = 21; #6#1 = 18; |FINSI;
             |SI #6#2 = 7;  |O #6#2 = 10; #6#2 = 8;  |FINSI;
             |SI #6#2 = 16; |O #6#2 = 21; #6#2 = 18; |FINSI;
             |SI #6#3 = 7;  |O #6#3 = 10; #6#3 = 8;  |FINSI;
             |SI #6#3 = 16; |O #6#3 = 21; #6#3 = 18; |FINSI;
         |SINO;
             |SI #6#1 = 8;  |O #6#1 = 10; #6#1 = 7;  |FINSI;
             |SI #6#1 = 18; |O #6#1 = 21; #6#1 = 16; |FINSI;
             |SI #6#2 = 8;  |O #6#2 = 10; #6#2 = 7;  |FINSI;
             |SI #6#2 = 18; |O #6#2 = 21; #6#2 = 16; |FINSI;
             |SI #6#3 = 8;  |O #6#3 = 10; #6#3 = 7;  |FINSI;
             |SI #6#3 = 18; |O #6#3 = 21; #6#3 = 16; |FINSI;
         |FINSI;
     |FINSI;

      nActividad = 1;
      |ABRE #2;
      #2#00 = #30#2;     || empresa
      #2#45 = #0#0;      ||
      #2#01 = #0#2;      || periodo
      #2#02 = #30#26;    || a¤o
      |LEE 101#2=;
      |SI FSalida = 0;
          |SI #0#6 = "S";
              |BORRA 020#2a;
              nSwOp      = 0;
              |BUCLE eosma100B;
          |SINO;
              |MENAV "    PERIODO DEL MODELO 303 YA CALCULADO ... ";
              |CIERRA #2;
              |ACABA;
          |FINSI;
      |FINSI;
      |LIBERA #2;

     #2#6  = #6#1;
     #2#9  = #6#2;
     #2#12 = #6#3;
     #2#15 = #6#4;
     #2#18 = #6#5;
     #2#47 = #6#6;

                             #2#96 = "N";
    |SI #caportad#124 = "S"; #2#96 = "S";   |FINSI;

    #0#1 = #0#2;
    |SI #0#7 = "S"; #0#1 = 1; |FINSI;
    tri0 = #0#1 - 1;

    |SI #8#104 = "S";
         nEjer = 2000 + #2#2;
         aAlfa = ":agicont/dsmo3401 canempr1 " + (("00000" + #30#2) % -105) + #30#3 + ";";
         aAlfa = aAlfa + (("00000" + #2#0) % -105);    || Empresa
         aAlfa = aAlfa + (("0000" + nEjer) % -104);    || Ejercicio
         aAlfa = aAlfa + (("00" + #2#1) % -102);       || Periodo
         aAlfa = aAlfa + "340";                        || Modelo
         aAlfa = aAlfa + "00";                         || Complemento
         aAlfa = aAlfa + "01";                         || Actividad
         aAlfa = aAlfa + "03";                         || Tipo de entrada
         aAlfa = aAlfa + "0";                          || Mensaje

        |SUB_EJECUTA_NP aAlfa;

        |IMPRE 0;
        |SI FSalida ! 0;  |ACABA;  |FINSI;

        |INFOR "dspas340";
        |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

        aFichero = ("47" + Usuario + "zzzzzzzz") % 108;
        |NOME_DAT #dsmow204#aFichero#;
        |ABRE #dsmow204;  |CIERRA #dsmow204;  |DELINDEX #dsmow204;

        |ABRE #dsmow204;
     |FINSI;

     nEjerCobro = 0;
     |ABRE #7;

     |ABRE #100;
     per_ant = -1;
     a340 = "";
     |SI enEjercicio ] 2014;  nOpera = 1; |BUCLE lineasRECC_V;  |FINSI;

     nOpera = 0;
     |BUCLE reper;
     |SI enEjercicio ] 2015;
         aTipo501 = "R";
         nEjerCobro = enEjercicio - 1;
         |BUCLE Lee501_2014;
     |FINSI;
     |HAZ cierra_303_rep;
     |CIERRA #100;

     |CIERRA #5; |PATH_DAT #5 aPathOrigen;

     nEjerCobro = 0;
     per_ant = -1;
     a340 = "";
     |SI enEjercicio ] 2014;  nOpera = 1; |BUCLE lineasRECC_C;  |FINSI;

     nOpera = 0;
     |BUCLE sopor;
     |SI enEjercicio ] 2015;
         aTipo501 = "S";
         nEjerCobro = enEjercicio - 1;
         |BUCLE Lee501_2014;
     |FINSI;
     |HAZ cierra_303_sop;

     perio  = #0#2; || periodo (1-12)
     activi = #0#0; || tipo (T/M/A)
     any    = #30#26;  || any
     #2#00 = #30#2;     || empresa
     #2#45 = #0#0;      || actividad
     #2#01 = #0#2;      || periodo
     #2#02 = #30#26;    || a¤o
     |LEE 141#2=;
     |SI FSalida = 0;
         nMod390 = 0;
         |SI enNoMod390 = 1;
              |SI #caman303#1 =  4; |Y #caman303#45 = "T"; nMod390 = 1; |FINSI;
              |SI #caman303#1 = 12; |Y #caman303#45 ! "T"; nMod390 = 1; |FINSI;
              |SI #caman303#45 = "A";                      nMod390 = 1; |FINSI;
          |FINSI;

          |PDEFECTO #caman303, 120,154;
          |PDEFECTO #caman303, 160,172;
          #caman303#155 = "N";
          |SI nMod390 = 1;
              |HAZ CargaActividad;
              |HAZ TotalEsp390;
          |FINSI;
          |SI #caman303#153 ! 0; |Y enEjercicio ] 2018;
              #caman303#171 = "S";
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
     |CIERRA #2;
     |CIERRA #7;

     |SI #8#104 = "S";
         |CIERRA #dsmow204;
         |HAZ Transmisiones;
         |HAZ Cobros;

         |PIEINF;
         |FININF;
         |FINIMP;

         nEjer = 2000 + #2#2;
         aAlfa = ":agicont/dsmo3401 canempr1 " + (("00000" + #30#2) % -105) + #30#3 + ";";
         aAlfa = aAlfa + (("00000" + #2#0) % -105);    || Empresa
         aAlfa = aAlfa + (("0000" + nEjer) % -104);    || Ejercicio
         aAlfa = aAlfa + (("00" + #2#1) % -102);       || Periodo
         aAlfa = aAlfa + "340";                        || Modelo
         aAlfa = aAlfa + "00";                         || Complemento
         aAlfa = aAlfa + "01";                         || Actividad
         aAlfa = aAlfa + "98";                         || Tipo de entrada
         aAlfa = aAlfa + "0";                          || Mensaje

         |SUB_EJECUTA_NP aAlfa;
     |FINSI;

  |SINO;
      |MENAV "    ATENCION!!! No Existe Control de IVA ...";
  |FINSI;
|FPRC;


|PROGRAMA;
  aParam = PARAMETRO; |QBF aParam;
  enImpExp = 1;
  |SI aParam = "Auto";
      |HAZ tipo8;
      |DDEFECTO #0;
      #0#0 = eaCampo45;
      #0#2 = enCampo1;
      #0#6 = "S";
      |SI swliq = 1; #0#7 = "S"; |FINSI;
      |HAZ reo303;
  |SINO;
      |MANTE #0;
  |FINSI;
  enImpExp = 0;
|FPRO;
