|FICHEROS;
  cacalend #0;
  calendar #1;
|FIN;

|VARIABLES;

    Calc  = 0;
    Calc1 = 0;
    nume1 = 0;
    trab1 = "";
    varalfa = "";
    varalfa1 = "";
    varalfa2  = "";
    vardia = 0;
    varmes = 0;
    fechadesde = "";
    fechadesde1 = "";
    fechadesde2 = "";
    fechahasta = "";
    fechahasta1 = "";
    fechahasta2 = "";
    camp = 0;
    procesa = "     Estoy procesando espere un poco Por Favor";
    modifi = "2330S  Modificar el Calendario S/N : ";
    alta = "2330S     Dar el alta al Calendario S/N : ";
    errorfec1 = "     Fecha erronea DD/MM";
    errorfec2 = "     Fecha Hasta menor que la Fecha Desde";
    errorfec3 = "     No existe ese dia el a¤o no es bisiesto";
    bisiesto = "";
    swbis = 1;
    anyo = "";  year = 0;

    DiasEnero      = 31; DiasFebrero = 28; DiasMarzo     = 31; DiasAbril     = 30;
    DiasMayo       = 31; DiasJunio   = 30; DiasJulio     = 31; DiasAgosto    = 31;
    DiasSeptiembre = 30; DiasOctubre = 31; DiasNoviembre = 30; DiasDiciembre = 31;

    sdia = 0; alfa1 = ""; fech1 = @; fech2 = @;

    Cont = 0; ContMes = 0; ContDias = 0;
    ModoEntrada = 0; NumDias = 0; Comodin = ""; Comodin1 = "";

    Desde = ""; Hasta = ""; Peso = 0; PesoAnt = 0; aPeso = "";

    DDia = 0; DMes = 0; HDia = 0; HMes = 0;
|FIN;

|INCLUYE acceso_i;

|PROCESO calanyo;  |TIPO 7;
  nume1  = (FEntrada / 100) ! 0;
  |SI fec1 = "00.00.0000";
      |HAZ inicio;
  |FINSI;
  year = #0#1; |HAZ Bisiesto;
  trab1 = fec1 % 704;
  |SI nume1 ! 1;  nume1 = trab1;  |ACABA;  |FINSI;
  nume1 = trab1;
  #0#1 = nume1; |PINTA #0#1;
|FPRC;

|PROCESO  fechbien;  |TIPO 0;        ||Calcula si la fecha es correcta
  varalfa = #0Campo;
  |SI varalfa = "    ";  |ACABA;  |FINSI;
  |SI varalfa = "2902";|Y swbis ! 1;
      |MENAV errorfec3;
      |ERROR;
      |ACABA;
  |FINSI;
  varalfa1 = varalfa / 2;
  varalfa2 = varalfa % A302;
  vardia = varalfa1;
  varmes = varalfa2;
  |SI varmes [ 0;|O varmes > 12;
       |MENAV errorfec1;
       |ERROR;
       |ACABA;
  |FINSI;
  |SI varmes = 1;  |O varmes = 3;  |O varmes = 5;  |O varmes = 7;
                   |O varmes = 8;  |O varmes = 10; |O varmes = 12;
      |SI vardia > 31; |O vardia [ 0;
          |MENAV errorfec1;
          |ERROR;
      |FINSI;
  |SINO;
      |SI varmes = 2;
          |SI vardia > 29;  |O vardia [ 0;
              |MENAV errorfec1;
              |ERROR;
          |FINSI;
      |SINO;
          |SI vardia > 30; |O vardia [ 0;
              |MENAV errorfec1;
              |ERROR;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

                    ||Calcula si la fecha desde es mayor a la fecha desde
|PROCESO desdefec;|TIPO 0;
  camp = Campo - 1;
  fechadesde = #0camp;
  fechadesde1 = fechadesde % A302;
  fechadesde2 = fechadesde % A102;
  fechadesde = fechadesde1 + fechadesde2;
  fechahasta = #0Campo;
  fechahasta1 = fechahasta % A302;
  fechahasta2 = fechahasta % A102;
  fechahasta = fechahasta1 + fechahasta2
  |SI fechadesde > fechahasta;
      |MENAV errorfec2;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO anyo;|TIPO 0;
  |SI nume1 ! #0#1;
      |MENAV "      LA FECHA NO SE CORRESPONDE CON EL EJERCICIO";
      |ERROR;
      |ACABA;
  |FINSI;

|FPRC;

|PROCESO peso;|TIPO 3;

  ModoEntrada = (FEntrada / 100) ! 0;
  |SI ModoEntrada ! 1;  |Y ModoEntrada ! 2;
      |ACABA;
  |FINSI;
  |SI ModoEntrada = 1;
      |CONFI alta;
  |SINO;
      |CONFI modifi;
  |FINSI;
  |SI FSalida ! 0;
      |BLIN 23;
      |ACABA;
  |FINSI;
  |BLIN 23;
  |ABRE #1;
  |HAZ peso1;
  |BLIN 23;
  |GRABA 020#1a;
  |LIBERA #1;
  |CIERRA #1;
|FPRC;

|PROCESO peso1;
  |PINTA 2330,procesa;
  #1#0 = #0#0;
  |LEE 110#1=;
  |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #0#0;
      #1#13 = #0#1;
      |GRABA 020#1c;
  |FINSI;

  year = #0#1; |HAZ Bisiesto;
  |SI swbis = 1;
     DiasFebrero = 29;
  |SINO;
     DiasFebrero = 28;
  |FINSI;

  |HAZ MiraDiaUno;
  Calc = sdia + 1;

  |PARA ContMes = 1; |SI ContMes [ 12; |HACIENDO ContMes = ContMes + 1;
      |SI ContMes = 1;  NumDias = DiasEnero;      |FINSI;
      |SI ContMes = 2;  NumDias = DiasFebrero;    |FINSI;
      |SI ContMes = 3;  NumDias = DiasMarzo;      |FINSI;
      |SI ContMes = 4;  NumDias = DiasAbril;      |FINSI;
      |SI ContMes = 5;  NumDias = DiasMayo;       |FINSI;
      |SI ContMes = 6;  NumDias = DiasJunio;      |FINSI;
      |SI ContMes = 7;  NumDias = DiasJulio;      |FINSI;
      |SI ContMes = 8;  NumDias = DiasAgosto;     |FINSI;
      |SI ContMes = 9;  NumDias = DiasSeptiembre; |FINSI;
      |SI ContMes = 10; NumDias = DiasOctubre;    |FINSI;
      |SI ContMes = 11; NumDias = DiasNoviembre;  |FINSI;
      |SI ContMes = 12; NumDias = DiasDiciembre;  |FINSI;

      Comodin = "";
      |PARA ContDias = 1; |SI ContDias [ 31; |HACIENDO ContDias = ContDias + 1;
         |SI ContDias [ NumDias;
            Comodin = Comodin + #cacalend#Calc#;
            Calc = Calc + 1; |SI Calc > 8; Calc = Calc - 7; |FINSI;
         |SINO;
            Comodin = Comodin + "0";
         |FINSI;
      |SIGUE;

      #calendar#ContMes# = Comodin;
  |SIGUE;

  |GRABA 020#calendar.a;

  |HAZ Fechas;      || Una vez relleno el a¤o completo , pondremos el valor de
                    || las fechas indicadas por separado
|FPRC;

|PROCESO Fechas;
   || Primero los intervalos entre fechas .......
   |PARA Cont = 9; |SI Cont [ 96; |HACIENDO Cont = Cont + 3;
      Desde = #cacalend#Cont#; Calc = Cont + 1;
      Hasta = #cacalend#Calc#; Calc = Cont + 2;
      aPeso = #cacalend#Calc#;
      Peso  = #cacalend#Calc#;

      |SI Desde ! "    "; |Y Hasta ! "    ";
         Comodin = Desde % 0102; DDia = Comodin;
         Comodin = Desde % 0302; DMes = Comodin;
         Comodin = Hasta % 0102; HDia = Comodin;
         Comodin = Hasta % 0302; HMes = Comodin;

         |PARA ContMes = DMes; |SI ContMes [ HMes; |HACIENDO ContMes = ContMes + 1;
            |SI ContMes = 1;  NumDias = DiasEnero;      |FINSI;
            |SI ContMes = 2;  NumDias = DiasFebrero;    |FINSI;
            |SI ContMes = 3;  NumDias = DiasMarzo;      |FINSI;
            |SI ContMes = 4;  NumDias = DiasAbril;      |FINSI;
            |SI ContMes = 5;  NumDias = DiasMayo;       |FINSI;
            |SI ContMes = 6;  NumDias = DiasJunio;      |FINSI;
            |SI ContMes = 7;  NumDias = DiasJulio;      |FINSI;
            |SI ContMes = 8;  NumDias = DiasAgosto;     |FINSI;
            |SI ContMes = 9;  NumDias = DiasSeptiembre; |FINSI;
            |SI ContMes = 10; NumDias = DiasOctubre;    |FINSI;
            |SI ContMes = 11; NumDias = DiasNoviembre;  |FINSI;
            |SI ContMes = 12; NumDias = DiasDiciembre;  |FINSI;

            Comodin = #calendar#ContMes#;

            |SI DMes = HMes;
               |PARA ContDias = DDia; |SI ContDias [ HDia; |HACIENDO ContDias = ContDias + 1;
                  |SI aPeso = "+"; |O aPeso = "-";
                     Calc = (100 * ContDias) + 1;
                     Comodin1 = Comodin % Calc;
                     |SI aPeso = "+"; Peso = Comodin1 + 1; |FINSI;
                     |SI aPeso = "-"; Peso = Comodin1 - 1; |FINSI;
                     |SI Peso > 9; Peso = 9; |FINSI;
                     |SI Peso < 0; Peso = 0; |FINSI;
                  |FINSI;
                  |HAZ CambiaValor;
               |SIGUE;
            |SINO;
               |SI ContMes = DMes;
                  |PARA ContDias = DDia; |SI ContDias [ 31; |HACIENDO ContDias = ContDias + 1;
                     |SI ContDias [ NumDias;
                        |SI aPeso = "+"; |O aPeso = "-";
                           Calc = (100 * ContDias) + 1;
                           Comodin1 = Comodin % Calc;
                           |SI aPeso = "+"; Peso = Comodin1 + 1; |FINSI;
                           |SI aPeso = "-"; Peso = Comodin1 - 1; |FINSI;
                           |SI Peso > 9; Peso = 9; |FINSI;
                           |SI Peso < 0; Peso = 0; |FINSI;
                        |FINSI;
                        |HAZ CambiaValor;
                     |SINO;
                        PesoAnt = Peso;
                        Peso = 0;
                        |HAZ CambiaValor;
                        Peso = PesoAnt;
                     |FINSI;
                  |SIGUE;
               |SINO;
                  |SI ContMes = HMes;
                     |PARA ContDias = 1; |SI ContDias [ HDia; |HACIENDO ContDias = ContDias + 1;
                        |SI ContDias [ NumDias;
                           |SI aPeso = "+"; |O aPeso = "-";
                              Calc = (100 * ContDias) + 1;
                              Comodin1 = Comodin % Calc;
                              |SI aPeso = "+"; Peso = Comodin1 + 1; |FINSI;
                              |SI aPeso = "-"; Peso = Comodin1 - 1; |FINSI;
                              |SI Peso > 9; Peso = 9; |FINSI;
                              |SI Peso < 0; Peso = 0; |FINSI;
                           |FINSI;
                           |HAZ CambiaValor;
                        |SINO;
                           PesoAnt = Peso;
                           Peso = 0;
                           |HAZ CambiaValor;
                           Peso = PesoAnt;
                        |FINSI;
                     |SIGUE;
                  |SINO;
                     |PARA ContDias = 1; |SI ContDias [ 31; |HACIENDO ContDias = ContDias + 1;
                        |SI ContDias [ NumDias;
                           |SI aPeso = "+"; |O aPeso = "-";
                              Calc = (100 * ContDias) + 1;
                              Comodin1 = Comodin % Calc;
                              |SI aPeso = "+"; Peso = Comodin1 + 1; |FINSI;
                              |SI aPeso = "-"; Peso = Comodin1 - 1; |FINSI;
                              |SI Peso > 9; Peso = 9; |FINSI;
                              |SI Peso < 0; Peso = 0; |FINSI;
                           |FINSI;
                           |HAZ CambiaValor;
                        |SINO;
                           PesoAnt = Peso;
                           Peso = 0;
                           |HAZ CambiaValor;
                           Peso = PesoAnt;
                        |FINSI;
                     |SIGUE;
                  |FINSI;
               |FINSI;
            |FINSI;
            #calendar#ContMes# = Comodin;
         |SIGUE;
      |FINSI;
   |SIGUE;

   |PARA Cont = 99; |SI Cont [ 157; |HACIENDO Cont = Cont + 2;
      |SI #cacalend#Cont# = "    "; |SAL; |FINSI;
      Comodin = #cacalend#Cont# % 0102; DDia = Comodin;
      Comodin = #cacalend#Cont# % 0302; DMes = Comodin; Calc = Cont + 1;
      Peso  = #cacalend#Calc#;

      Comodin = #calendar#DMes#;
      Calc    = 100 + (DDia - 1);
      Calc1   = ((DDia + 1) * 100) + 99;
      Comodin1 = Comodin % Calc1;
      Comodin  = Comodin % Calc;
      Comodin = Comodin + Peso + Comodin1;
      #calendar#DMes# = Comodin;
   |SIGUE;
|FPRC;

|PROCESO CambiaValor;
   Calc = 100 + (ContDias - 1);
   Comodin1 = Comodin % Calc;
   Comodin1 = Comodin1 + Peso;
   Calc = ((ContDias + 1) * 100) + 31;
   Comodin1 = Comodin1 + (Comodin % Calc);
   Comodin  = Comodin1;
|FPRC;

|PROCESO Bisiesto;
   Calc = year $ 4;

   |SI Calc = 0;
      Calc = year $ 100;
      |SI Calc = 0;
         swbis = 0;
         Calc = year $ 400;
         |SI Calc = 0;
            swbis = 1;
         |FINSI;
      |SINO;
         swbis = 1;
      |FINSI;
   |SINO;
      swbis = 0
   |FINSI;
|FPRC;

|PROCESO MiraDiaUno;
    alfa1 = #cacalend#1;
    alfa1 = "01.01." + alfa1;
    fech1 = alfa1;            || primero saca el dia de la semana
    fech2 = fech1 % 1;        || que fue el uno de enero
    alfa1 = fech2 % 1199;

    |SI alfa1 = "Lunes";     sdia=1; |FINSI;
    |SI alfa1 = "Martes";    sdia=2; |FINSI;
    |SI alfa1 = "Miercoles"; sdia=3; |FINSI;
    |SI alfa1 = "Jueves";    sdia=4; |FINSI;
    |SI alfa1 = "Viernes";   sdia=5; |FINSI;
    |SI alfa1 = "Sabado";    sdia=6; |FINSI;
    |SI alfa1 = "Domingo";   sdia=7; |FINSI;
|FPRC;
