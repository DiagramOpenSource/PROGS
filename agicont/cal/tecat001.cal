|FICHEROS;
    tecat001 #0;
    cacamctm #1;

    refempre@ #100;
    reftabl1@ #101;
    reftabl2@ #102;
|FIN;

|VARIABLES;
    alfa1    = "";
    alfa2    = "";
    alfa3    = "";
    nume1    = 0;
    nume2    = 0;
    nume3    = 0;
    nume4    = 0;
    para1    = 0;
    para2    = 0;
    para3    = 0;
    para4    = 0;

    aDirAplic = "";
    aDirMas   = "";
    aDirFichE = "";
    aDirFichF = "";
    aMas      = "";
    aMas1     = "";
    aMas2     = "";
    aEmpresa  = "";
    nEmpresa  = 0;
    nContador = 0;
    nEstat    = 0;
    swNo      = 0;
    aCuenta   = "";
    aCtaP     = "";
    nNivel    = 0;
    aDigitos  = "";
    nDigNum   = 0;
|FIN;

|INCLUYE acceso_i;
____________________________________/ CALCULOS DE PANTALLA
|CALCULO LeeEmpresa;
 aDirAplic = #0#1; |QBF aDirAplic;
 aDirMas   = aDirAplic + "def/";
 aDirFichE = aDirAplic + "fich/";
 aMas  = aDirMas + "agifa041";

 |CARGA_DEF aMas, refempre@;
 |SI FSalida ! 0;
     |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
     |ACABA;
 |FINSI;

 |PATH_DAT #100 #aDirFichE#;
 |ABRE #100;
 #100#0 = #0#2;
 |LEE 001#100=;
 |SI FSalida ! 0;
     |MENAV  "      Error No existe Empresa ";
     |ERROR;
 |SINO;
     #0#3 = #100#1; |PINTA #0#3;
 |FINSI;
 |CIERRA #100;
 |DESCARGA_DEF #refempre@;
|FCAL;

|CALCULO LeeTabla; |TIPO 0;
 aDirAplic = #0#1; |QBF aDirAplic;
 aDirMas   = aDirAplic + "def/";
 aDirFichE = aDirAplic + "fich/";
 nEmpresa  = #0#2;
 aEmpresa  = nEmpresa; |QBF aEmpresa;
 aEmpresa  = ("00000" + aEmpresa) % -105;
 aDirFichF = aDirFichE + aEmpresa + "/";

 aMas1  = aDirMas + "agifa153";
 aMas2  = aDirMas + "agifa154";

 |CARGA_DEF aMas1, reftabl1@;
 |SI FSalida ! 0;
     |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
     |ACABA;
 |FINSI;

 |PATH_DAT #101 #aDirFichF#;
 |ABRE #101;
 #101#0 = #0#4;
 |LEE 001#101=;
 |SI FSalida ! 0;
     |MENAV  "      Error No existe Tabla";
     |ERROR;
 |SINO;
     |SI #0#6 ! "C"; |Y #0#6 ! "P"; |Y #0#6 = "R";
         |MENAV  "      Error Tabla de Cambio erroneo";
         |ERROR;
     |SINO;
         #0#5 = #101#1; |PINTA #0#5;
         #0#6 = #101#2; |PINTA #0#6;
     |FINSI;
 |FINSI;
 |CIERRA #101;
 |DESCARGA_DEF #reftabl1@;
|FCAL;

|CALCULO AntesDe; |TIPO 7;
  #0#7 = "4";
  |SI #0#6 = "C";  #0#7 = "4300"; |FINSI;
  |SI #0#6 = "P";  #0#7 = "4000"; |FINSI;
  |PINTA #0#7;
|FCAL;

|| *************************************************************************
|| *************************************************************************
|PROCESO PoneCuenta;
 swNo = 0;
 |QBF aCuenta; |SI aCuenta = "";  swNo = 1; |ACABA; |FINSI;

 alfa2 = aCuenta % 0; nume1 = alfa2;

 aCtaP = #0#7; |QBF aCtaP;
 alfa2 = aCtaP % 0;   nume2 = alfa2;

 nume3 = nDigNum - (nume1 + nume2);

 |SI nume3 < 0;
     nume3 = nume2 + nume3;
     |SI nume3 > 0;
         nume3 = nume3 + 100;
         alfa3 = nume3;
         aCtaP = aCtaP % alfa3;
     |SINO;
         aCtaP = "";
     |FINSI;
 |SINO;
     alfa2 = "0" * nume3;
     aCtaP = aCtaP + alfa2;
 |FINSI;

 aCuenta = aCtaP + aCuenta;
 aCuenta = aCuenta % aDigitos;
 nNivel  = nDigNum;
|FPRC;

|PROCESO LosPasa0;

  #1#8 = nContador;
  |LEE 101#1=;
  nEstat = FSalida;

  aCuenta = #102#2; |HAZ PoneCuenta; |SI swNo = 1; |ACABA; |FINSI;
  #1#0 = aCuenta;
  #1#1 = nNivel;
  #1#2 = #102#4;

  aCuenta = #102#3; |HAZ PoneCuenta; |SI swNo = 1; |ACABA; |FINSI;
  #1#3 = aCuenta;
  #1#4 = nNivel;
  #1#5 = #102#5;

  #1#6 = #0#9;
  #1#7 = "";
  #1#8 = nContador;

  |SI nEstat = 0; |GRABA 020#1a; |FINSI;
  |SI nEstat ! 0; |GRABA 020#1n; |FINSI;
  |LIBERA #1;
  nContador = nContador + 1;
|FPRC;

|DEFBUCLE LosPasa;
 #102#1002;
 ;
 #0#4, 00001;
 #0#4, 99999;
 e;
 NULL, LosPasa0;
|FIN;

|PROCESO CuentaNum0;
 nContador = #1#8;
|FPRC;

|DEFBUCLE CuentaNum;
 #1#1;
 ;
 0001;
 9999;
 ;
 NULL, CuentaNum0;
|FIN;

|PROCESO LaCarga;

|| ... La Longitud de la cuenta
  nDigNum = 1;
  |SI dig3 = 1; nDigNum = dig4; |FINSI;
  |SI dig3 = 2; nDigNum = dig5; |FINSI;
  |SI dig3 = 3; nDigNum = dig6; |FINSI;
  |SI dig3 = 4; nDigNum = dig7; |FINSI;
  |SI dig3 = 5; nDigNum = dig8; |FINSI;
  |SI dig3 = 6; nDigNum = dig9; |FINSI;

  nume1 = 100 + nDigNum; aDigitos = nume1;

|| ... Los Directoros
  aDirAplic = #0#1; |QBF aDirAplic;
  aDirMas   = aDirAplic + "def/";
  aDirFichE = aDirAplic + "fich/";
  nEmpresa  = #0#2;
  aEmpresa  = nEmpresa; |QBF aEmpresa;
  aEmpresa  = ("00000" + aEmpresa) % -105;
  aDirFichF = aDirFichE + aEmpresa + "/";

  aMas1  = aDirMas + "agifa153";
  aMas2  = aDirMas + "agifa154";
  |CARGA_DEF aMas2, reftabl2@;
  |SI FSalida ! 0;
      |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
      |ACABA;
  |FINSI;
  |PATH_DAT #102 #aDirFichF#;

  nContador = 0;
  |SI #0#8 = "N";
      |ABRE #1; |CIERRA #1; |DELINDEX #1;
  |SINO;
      |BUCLE CuentaNum;
  |FINSI;
  nContador = nContador + 1;

  |ABRE #1;
  |BUCLE LosPasa;
  |CIERRA #1;

  |DESCARGA_DEF #reftabl2@;
|FPRC;

|| ********************************************************************
|PROGRAMA;
 |HAZ inicio;
 |CLS;
 |CABEZA "Carga Tabla Cambio Cuentas";

 |ABRE #0;
 |LEE 101#0p;
 |SI FSalida ! 0;
     #0#0 = "A";
     |DBASS alfa1;
     alfa1 = alfa1 + "dscomer9/";
     #0#1 = alfa1;
     |GRABA 020#0b;
 |FINSI;
 |PINPA #0#0;
 |PINDA #0#0;
 |ENDATOS #2#0;
 |SI FSalida = 0;
     |GRABA 020#0a;
     |LIBERA #0;
     |HAZ LaCarga;
 |FINSI;
|FPRO;
