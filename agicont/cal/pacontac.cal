|FICHEROS;
    pacontac #0;

    camaasic #2;    || apuntes cabs.
    camaasil #3;    || apuntes lins.
    cacuenta #4;    || plan contable

    cacuebal #15;   || cuentas de balance
    caclipro #16;   || clientes/proveedores
    pacontmp #17;   || Temporal Libros Iva.
    caivarep #18;   || Libro Iva Repercutido.
    caivasop #19;   || Libro Iva Soportador.
    calibros #20;   || Libros IVA.
    ca8m0002 #422;
    ca8cumay #410;
|FIN;

|VARIABLES;
    &eaOrigen   = "";
    &eaDestino  = "";
    &enErrPas   = 0;
    nCopio      = 0;
    &enDiario   = 0;
    &enContador = 0;
    aBase       = "";
    aFichero    = "";

    esAbono  = "";
    fiche    = "";
    handle   = 0;
    varalfa  = "";
    varalfa0 = "";
    varalfa2 = "";
    varalfa3 = "";
    varalfa4 = "";
    varalfa5 = "";
    varalfa6 = "";
    varalfa7 = "";
    varalfa8 = "";
    nvariable = 0;
    trabajo = "";
    trabaj1 = "";
    traba = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nNume4 = 0;
    sw = 0;
    nCalc = 0;
    nCalcD = 0;
    nCalcH = 0;
    nNume1 = 0;
    ult_apunt = 0;
    docum = 0;
    FEstado = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    digito = 0;
    nada = "";
    fichero = "";
    top = 0;
    resto = 0;
    conte = "";
    digcu = 0;
    fecha = @;
    descr = "";
    signe = "";
    impor = 0;
    impoi = 0;
    iva   = 0;
    rec   = 0;
    cotra = "";
    queiv = "";
    ivcon = "";
    sumar = 0;
    nConta = 0;
    aDcont = "";
    nPepe1 = 0;
    nPepe2 = 0;
    nPepe3 = 0;
    nPepe4 = 0;
    nPepe5 = 0;
    aCual  = "";
    trim1  = "";
    trim2  = "";
    trim3  = "";
    swVic  = 0;
    nGrup  = 0;
    qConta = 0;
    nIs1   = 0;
    nIs2   = 0;
    nIs3   = 0;
    nIs4   = 0;
    nIs5   = 0;
    nIr1   = 0;
    nIr2   = 0;
    nIr3   = 0;
    nIr4   = 0;
    nIr5   = 0;

     nLeeUno = 0;
     nLeeCuantos = 0;
     nLeeNume = 0;
     aLeeAlfa = "";
     aLeeTodo = "";
     nLeeSalida = 0;
     nNueva     = 0;

    &eaFicBase =  "";   || Fichero DBASE para lee
    &enLongR    = 0;    || Longitud Registro
    &enCap      = 0;    || Longitud Cabecera
    &enCamps    = 0;    || Numero de Campos
    &enRegistre = 0;    || Total Registros
    &eswError   = 0;
    mascara     = "";
    nNuevo      = 0;
    diario      = 0;
    impob       = 0;
    Cl340       = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE actcta_i;
|INCLUYE actudi_i;
|INCLUYE varnue_i;
|INCLUYE defect_i;

____________________________________/ CALCULOS DESDE PANTALLA
|CALCULO PonBarra; |TIPO 0;
    |SI FSalida = 10;
        alfa1 = "D c:\";
        |BROWSE alfa1;
        alfa1 = alfa1 % 280;
        #0Campo = alfa1;
        |PINTA #0Campo
    |FINSI;

     alfa1 = #0Campo;
     |QBF alfa1;
     |SI alfa1 = "";
         |MENAV "0000Error, Introduzca un directorio";
         |ERROR;
         |ACABA;
     |FINSI;

     alfa2 = alfa1 % -101;
     |SI alfa2 ! "/";|Y alfa2 ! "\";
          #0Campo = alfa1 + "/";
          |PINTA #0Campo;
     |FINSI;
|FCAL;

|CALCULO Solo8; |TIPO 7;
     |C_M #0#10, 1, "N";
     |C_M #0#18, 1, "N";
     |SI #0#5 = 8;
          |C_M #0#10, 1, "S";
          |C_M #0#18, 1, "S";
     |FINSI;
     |SI #0#5 = 9;
          |C_M #0#10, 1, "S";
     |FINSI;
|FCAL;

|CALCULO Solo9; |TIPO 7;
      alfa1 = "S";
      |SI #0#5 ! 8; |O #0#10 ! 9;
          alfa1 = "N";
          #0#18 = "N"; |PINTA #0#18;
      |FINSI;
      |C_M #0#18, 1, alfa1;
|FCAL;

|PROCESO regrabo; |TIPO 7;
  alfa1 = #0#3;
  |C_M #0#15,1,alfa1;
|FPRC;

|PROCESO Cuadro10; |TIPO 7;
  |SI #0#5 = 8;
      |SI #0#10 ! 0; |Y #0#10 ! 9;
          #0#10 = 9; |PINTA #0#10;
      |FINSI;
  |FINSI;
  |SI #0#5 = 9;
      |SI #0#10 = 0; |O #0#10 > 7;
          #0#10 = 1; |PINTA #0#10;
      |FINSI;
  |FINSI;

  |PUSHV 0739 1574;
  |SI #0#5 = 8;
      |CUADRO 0739 1173;
      |ATRI R;
      |PINTA 0840, "(8) Ficheros extension .DBF      ";
      |ATRI P;
      |PINTA 0940, "9-   Documento de  6 caracteres  ";
      |PINTA 1040, "0-   Documento de 20 caracteres  ";
      |ATRI 0;
      |ATRI I;
      |PINTA 0940, "9-";
      |PINTA 1040, "0-";
      |ATRI 0;
  |FINSI;
  |SI #0#5 = 9;
      |CUADRO 0740 1674;
      |ATRI R;
      |PINTA 0841, "(9) Ficheros extension .TXT      ";
      |ATRI 0;
      |ATRI P;
      |PINTA 0941, "1- Importacion Original          ";
      |PINTA 1041, "2- Importacion Long. Diario 1193 "
      |PINTA 1141, "3- Importacion Long. Diario 1279 ";
      |PINTA 1241, "4- Importacion Long. Diario  310 ";
      |PINTA 1341, "5- Importacion Long. Diario  931 ";
      |PINTA 1441, "6- Importacion Long. Diario  387 ";
      |PINTA 1541, "7- Importacion Long. Diario  917 ";
      |ATRI 0;
      |ATRI I;
      |PINTA 0941, "1-";
      |PINTA 1041, "2-";
      |PINTA 1141, "3-";
      |PINTA 1241, "4-";
      |PINTA 1341, "5-";
      |PINTA 1441, "6-";
      |PINTA 1541, "7-";
      |ATRI 0;
  |FINSI;

|FPRC;

|PROCESO NoCuadro; |TIPO 0;
 |POPV;
 |SI #0#5 = 9; |Y #0#10 > 7; |ERROR; |FINSI;
 |SI #0#5 = 8;
     |SI #0#10 ! 0; |Y #0#10 ! 9;
        |ERROR;
     |FINSI;
 |FINSI;
|FPRC;

____________________________________/ CALCULOS COMUNES CUENTAS Y APUNTES
|PROCESO principio;
    Pos = -1;
    |PARA para1 = top;  |SI para1 > 0;  |HACIENDO para1 = para1 - 250;
          |SI para1 ] 250;
              |XLEE handle, 250, varalfa;
          |SINO;
              |XLEE handle, para1, varalfa;
          |FINSI;
    |SIGUE;
|FPRC;

|PROCESO nombre;
    Pos   = -1;
    alfa1 = #0#1;
    |QBF alfa1;

    |SI #0#5 ! 9;
        alfa1 = alfa1 + fichero;|QBF alfa1;
        traba = trabaj1;        |QBF traba;
        alfa1 = alfa1 + traba + ".dbf";
        |QBF alfa1;
        fiche = alfa1;
        aFichero = fichero + traba + ".dbf";
    |SINO;
        fichero = "x" + fichero;
        alfa1 = alfa1 + fichero;
        |QBF alfa1;
        alfa1 = alfa1 + ".txt";
        fiche = alfa1;
        aFichero = fichero + ".txt";
    |FINSI;

    nCopio = 0;
    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
        |SI FSalida = 0; nCopio = 1; |FINSI;
    |FINSI;
    |XCIERRA handle;

|SI nCopio = 1;
    |DFICE aBase;
    eaOrigen  = fiche;
    eaDestino = aBase + aFichero;
    |HAZ eReciboFich;
    |SI enErrPas = 0; fiche = eaDestino; |FINSI;
|FINSI;

    |SI #0#5 = 8; |Y #0#10 = 9;
        eaFicBase = fiche;
        |HAZ CalculDBF;
        |SI eswError = 1; fiche = ""; |ACABA; |FINSI;
    |FINSI;
|FPRC;

|PROCESO digito;
    alfa1 = conte;  |QBF alfa1;
    alfa2 = alfa1 % 0;   nume1 = alfa2;
    digito = 0;
    |SI nume1 = dig4;   digito = 1;    |FINSI;
    |SI nume1 = dig5;   digito = 2;    |FINSI;
    |SI nume1 = dig6;   digito = 3;    |FINSI;
    |SI nume1 = dig7;   digito = 4;    |FINSI;
    |SI nume1 = dig8;   digito = 5;    |FINSI;
    |SI nume1 = dig9;   digito = 6;    |FINSI;
|FPRC;

|PROCESO LeeUnoaUno;
     aLeeTodo = "";
     nLeeSalida = 0;
     |PARA nLeeUno = 1; |SI nLeeUno [ nLeeCuantos; |HACIENDO nLeeUno = nLeeUno + 1;
          |XLEE handle, 1, aLeeAlfa;
          |SI FSalida = 1;
               nLeeNume = &aLeeAlfa;
               |SI nLeeNume < 32;
                    aLeeTodo = aLeeTodo + " ";
               |SINO;
                    aLeeTodo = aLeeTodo + aLeeAlfa;
               |FINSI;
               nLeeSalida = nLeeSalida + 1;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

____________________________________/ CALCULOS DEL PASE DEL DIARIO
|PROCESO VeoDiario;
   |QBF alfa1;  alfa1 = alfa1 < "";
   alfa1 = alfa1 - "apertura";
   |SI FSalida = 0;
       diario = 1;          || diario General
   |SINO;
       diario = 0;         || diario apertura
   |FINSI;
|FPRC;

|PROCESO ultimo;
    #3#3 = 9999;
    |LEE 000#3];
    |SI FSalida = 0;
        |LEE 000#3a;
    |SINO;
        |LEE 000#3u;
    |FINSI;
    |SI FSalida = 0;|Y #3#0 = diario;|Y #3#1 = fecha;|Y #3#2 = docum;
        ult_apunt = #3#3 + 2;
    |SINO;
        ult_apunt = 1;
    |FINSI;

    |DDEFECTO #3;
    #3#0 = diario;
    #3#1 = fecha;
    #3#2 = docum;
|FPRC;

|PROCESO cabecera;
    |DDEFECTO #2;
    #2#0 = #3#0;
    #2#1 = #3#1;
    #2#2 = #3#2;
    |LEE 101#2=;
    FEstado = FSalida;
    #2#0 = #3#0;         || diario
    #2#1 = #3#1;         || fecha
    #2#2 = #3#2;         || documento
    #2#3 = #2#2;         || asiento
    |SI #3#8 = "D";
        #2#4 = #2#4 + #3#9;
        |SI #2#09 = 0; #2#08 = #3#4; #2#09 = #3#5; |FINSI;      || contrp.HABER
    |FINSI;
    |SI #3#8 = "H";
        #2#5 = #2#5 + #3#9;
        |SI #2#11 = 0; #2#10 = #3#4; #2#11 = #3#5; |FINSI;      || contrp.DEBE
    |FINSI;
    #2#6 = #2#4 - #2#5;
    |SI FEstado = 0;  |GRABA 020#2a;  |FINSI;
    |SI FEstado ! 0;  |GRABA 020#2n;  |FINSI;
    |LIBERA #2;
|FPRC;

|| .... Proceso de Apuntes
|PROCESO apuntes_0;

   varalfa = varalfa % 2;    || primera posicion

    conte = varalfa % 2912;   |QBF conte;
|SI conte ! "";
     alfa1 = varalfa % 7325;
     |HAZ VeoDiario;
    |DDEFECTO #3;
        #3#00 = diario;          || diario
        alfa1 = varalfa % 2108;
        alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
        fecha = alfa1;
        #3#01 = fecha;      || fecha
        alfa1 = varalfa % 0120;
        docum = alfa1;
        #3#02 = docum;      || documento
    |HAZ ultimo;
        #3#03 = ult_apunt;  || apunte
    |HAZ digito;
        #3#04 = conte;      || cuenta
        digcu = digito;
        #3#05 = digcu;      || digito cuenta
        #3#06 = 999;        || concepto
        alfa1 = varalfa % 7325;
        #3#07 = alfa1;      || descripcion
        alfa1 = varalfa2 % 12320;         || DEBE euros
        nume1 = alfa1;
        alfa1 = varalfa2 % 14320;        || HABER euros
        nume2 = alfa1;

        signe = "";
        impor = 0;
        alfa1 = varalfa2 % 16320;   ||Base Imponible en EUROS
        impoi = alfa1; iva = 0; rec = 0; cotra = "";
        |SI impoi ! 0;
            alfa1 = varalfa % 15820; ||% Iva.
            iva   = alfa1;
            alfa1 = varalfa % 17820; ||% Rec.
            rec   = alfa1;
            cotra = varalfa % 4112;  ||Contrapartida.
            queiv = conte % 103;     ||Para Saber que Tipo Iva.
        |FINSI;
        ivcon = #3#07;
    |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
    |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;
        #3#08 = signe;      || signo
        #3#09 = impor;      || importe
    |SI #3#08 = "D";
            #3#16 = #3#4;
            #3#17 = #3#5;
    |SINO;
            #3#10 = #3#4;
            #3#11 = #3#5;
    |FINSI;
        #3#12 = "";           || cobros/pagos
        #3#13 = 0;            || libro
        #3#14 = 0;            || orden
        #3#15 = "";           || serie
        #3#22 = 0;            || nro.recibo
        #3#19 = "";           || tipo acumulador
        #3#20 = 0;            || numero acumulador
        #3#21 = "";           || departamento
    |SI impor ! 0;
        |GRABA 020#3n;
        |SI FSalida = 0;

            |ATRI I;
            |PINTA 2221, #3#1;
            |PINTA 2234, #3#2;
            |PINTA 2245, #3#4;
            |ATRI 0;

          |SI #3#2 = 4555;|Y #3#3 = 49;      |FINSI;

            |HAZ cabecera;
                ressum = #3#9;
            |HAZ actualiz1;     || actualiza cuentas
                opera = "A";
            |HAZ altatra;       || actualiza niveles inferiores
                d_diari = #3#0;
                d_opera = #3#8;
                d_impor = #3#9;
            |HAZ actu_diari;    || actualiza diario
            |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
                |HAZ RegIva;
            |FINSI;
        |FINSI;
    |SINO;
        |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
            |HAZ RegIva;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO Campos_a_25;

        alfa1 = varalfa % 5525;
        #3#07 = alfa1;      || descripcion

        alfa1 = (varalfa % 23911) + (varalfa2 % 105);        || DEBE euros
        nume1 = alfa1;

        alfa1 = varalfa2 % 0616;        || HABER euros
        nume2 = alfa1;
        signe = "";
        impor = 0;

        alfa1 = varalfa2 % 2216;   ||Base Imponible en EUROS
        impoi = alfa1;
        alfa1 = varalfa % 12005; ||% Iva.
        iva   = alfa1;
        alfa1 = varalfa % 12505; ||% Rec.
        rec   = alfa1;
        cotra = varalfa % 2712;  ||Contrapartida.
        queiv = conte % 103;     ||Para Saber que Tipo Iva.
        ivcon = #3#07;
|FPRC;

|PROCESO Campos_a_50;

        alfa1 = varalfa % 5550;
        #3#07 = alfa1;      || descripcion

        alfa1 = varalfa2 % 1516;        || DEBE euros
        nume1 = alfa1;

        alfa1 = varalfa2 % 3116;        || HABER euros
        nume2 = alfa1;
        signe = "";
        impor = 0;

        alfa1 = varalfa2 % 4716;   ||Base Imponible en EUROS
        impoi = alfa1;
        |SI impoi ! 0;
             alfa1 = varalfa % 14505; ||% Iva.
             iva   = alfa1;
             alfa1 = varalfa % 15005; ||% Rec.
             rec   = alfa1;
             cotra = varalfa % 2712;  ||Contrapartida.
             queiv = conte % 103;     ||Para Saber que Tipo Iva.
             ivcon = #3#07;
        |FINSI;
|FPRC;

|PROCESO apuntes_5;
   varalfa = varalfa % 2;    || primera posicion

    conte = varalfa % 1512;   |QBF conte;
|SI conte ! "";
    |SI #0#18 = "S";
        alfa1 = varalfa % 5550;
    |SINO;
        alfa1 = varalfa % 5525;
    |FINSI;
    |HAZ VeoDiario;

    |DDEFECTO #3;
        #3#00 = diario;          || diario
        alfa1 = varalfa % 708;
        alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
        fecha = alfa1;
        #3#01 = fecha;      || fecha
        alfa1 = varalfa % 0106;
        docum = alfa1;
        #3#02 = docum;      || documento
    |HAZ ultimo;
        #3#03 = ult_apunt;  || apunte
    |HAZ digito;
        #3#04 = conte;      || cuenta
        digcu = digito;
        #3#05 = digcu;      || digito cuenta
        #3#06 = 999;        || concepto

        |SI #0#18 = "S";
            |HAZ Campos_a_50;
        |SINO;
            |HAZ Campos_a_25;
        |FINSI;

    |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
    |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;
        #3#08 = signe;      || signo
        #3#09 = impor;      || importe
    |SI #3#08 = "D";
            #3#16 = #3#4;
            #3#17 = #3#5;
    |SINO;
            #3#10 = #3#4;
            #3#11 = #3#5;
    |FINSI;
        #3#12 = "";           || cobros/pagos
        #3#13 = 0;            || libro
        #3#14 = 0;            || orden
        #3#15 = "";           || serie
        #3#22 = 0;            || nro.recibo
        #3#19 = "";           || tipo acumulador
        #3#20 = 0;            || numero acumulador
        #3#21 = "";           || departamento
    |SI impor ! 0;
        |GRABA 020#3n;
        |SI FSalida = 0;

            |ATRI I;
            |PINTA 2221, #3#1;
            |PINTA 2234, #3#2;
            |PINTA 2245, #3#4;
            |ATRI 0;

          |SI #3#2 = 4555;|Y #3#3 = 49;      |FINSI;

            |HAZ cabecera;
                ressum = #3#9;
            |HAZ actualiz1;     || actualiza cuentas
                opera = "A";
            |HAZ altatra;       || actualiza niveles inferiores
                d_diari = #3#0;
                d_opera = #3#8;
                d_impor = #3#9;
            |HAZ actu_diari;    || actualiza diario
            |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
                |HAZ RegIva;
            |FINSI;
        |FINSI;
    |SINO;
        |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
            |HAZ RegIva;
        |FINSI;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO apuntes_9;
     conte = varalfa % 1512;   |QBF conte;

     |SI conte = "";   |ACABA;  |FINSI;

     alfa1 = varalfa % 0106;
     docum = alfa1;

     alfa1 = varalfa % 708;
     alfa1 = (alfa1 % -102) + "." + (alfa1 % 502) + "." + (alfa1 % 104);
     fecha = alfa1;

     alfa1 = varalfa % 5525;
     |HAZ VeoDiario;

     |DDEFECTO #3;
     #3#00 = diario;     || diario
     #3#01 = fecha;      || fecha
     #3#02 = docum;      || documento
     |HAZ ultimo;
     #3#03 = ult_apunt;  || apunte
     |HAZ digito;
     #3#04 = conte;      || cuenta
     #3#05 = digcu;      || digito cuenta

     #3#06 = 999;        || concepto
     alfa1 = varalfa % 5525;
     #3#07 = alfa1;      || descripcion

     signe = "";
     impor = 0;
     |SI #0#10 = 4;
         alfa1 = varalfa % 8416;        || HABER euros
         nume2 = alfa1;
         alfa1 = varalfa % 3916;        || DEBE euros
         nume1 = alfa1;

         alfa1 = varalfa % 10416;   ||Base Imponible en EUROS
         impoi = alfa1;
         |SI impoi ! 0;
             alfa1 = varalfa % 13105; ||% Iva.
             iva   = alfa1;
             alfa1 = varalfa % 14705; ||% Rec.
             rec   = alfa1;
             cotra = varalfa % 2712;  ||Contrapartida.
             queiv = conte % 103;     ||Para Saber que Tipo Iva
             impob = impoi;
         |FINSI;
     |SINO;

         alfa1 = (varalfa % 23911) + (varalfa2 % 105);        || DEBE euros
         nume1 = alfa1;
         alfa1 = varalfa2 % 0616;        || HABER euros
         nume2 = alfa1;

         alfa1 = varalfa2 % 2216;   ||Base Imponible en EUROS
         impoi = alfa1;
         |SI impoi ! 0;
             alfa1 = varalfa % 12005; ||% Iva.
             iva   = alfa1;
             alfa1 = varalfa % 12505; ||% Rec.
             rec   = alfa1;
             cotra = varalfa % 2712;  ||Contrapartida.
             queiv = conte % 103;     ||Para Saber que Tipo Iva.
             impob = impoi;
             |SI #0#5 = 9; |Y #0#10 ] 2;
                 Cl340 = varalfa3 % 15001;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nume1 ! 0; signe = "D";   impor = nume1; |FINSI;
     |SI nume2 ! 0; signe = "H";   impor = nume2; |FINSI;

     #3#08 = signe;      || signo
     #3#09 = impor;      || importe
     |SI #3#08 = "D";
         #3#16 = #3#4;
         #3#17 = #3#5;
     |SINO;
         #3#10 = #3#4;
         #3#11 = #3#5;
     |FINSI;

     #3#12 = "";           || cobros/pagos
     #3#13 = 0;            || libro
     #3#14 = 0;            || orden
     #3#15 = "";           || serie
     #3#22 = 0;            || nro.recibo
     #3#19 = "";           || tipo acumulador
     #3#20 = 0;            || numero acumulador
     #3#21 = "";           || departamento

     |SI impor ! 0;
         |GRABA 020#3n;
         |SI FSalida = 0;
            |ATRI I;
            |PINTA 2221, #3#1;
            |PINTA 2234, #3#2;
            |PINTA 2245, #3#4;
            |ATRI 0;

            |HAZ cabecera;
                ressum = #3#9;
            |HAZ actualiz1;     || actualiza cuentas
                opera = "A";
            |HAZ altatra;       || actualiza niveles inferiores
                d_diari = #3#0;
                d_opera = #3#8;
                d_impor = #3#9;
            |HAZ actu_diari;    || actualiza diario
            |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
                |HAZ RegIva;
            |FINSI;
        |FINSI;
     |SINO;
         |SI impoi ! 0;      || Si base Imponible ! 0; Carga Iva.
             |HAZ RegIva;
         |FINSI;
     |FINSI;
|FPRC;

|| ====================================================
|PROCESO diario_Ult;
    enDiario = 1;
    |HAZ contador;
    docum = enContador;

    |ABRET #2;
    |ABRET #3;

    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

   |SI FSalida ] 0;
        top = enCap;
        |HAZ principio;

        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw        = 1;
               nume1     = 0;
               nvariable = 0;
               |PARA para1 = enLongR;  |SI para1 > 0;  |HACIENDO para1 = para1 - 250;
                     |SI para1 ] 250;
                         |XLEE handle, 250, varalfa0;
                     |SINO;
                         |XLEE handle, para1, varalfa0;
                     |FINSI;
                     nume1 = nume1 + FSalida;
                     |SI nvariable = 0; varalfa  = varalfa0; |FINSI;
                     |SI nvariable = 1; varalfa2 = varalfa0; |FINSI;
                     |SI nvariable = 2; varalfa3 = varalfa0; |FINSI;
                     |SI nvariable = 3; varalfa4 = varalfa0; |FINSI;
                     |SI nvariable = 4; varalfa5 = varalfa0; |FINSI;
                     |SI nvariable = 5; varalfa6 = varalfa0; |FINSI;
                     |SI nvariable = 6; varalfa7 = varalfa0; |FINSI;
                     |SI nvariable = 7; varalfa8 = varalfa0; |FINSI;
                     |SI nvariable ] 8; varalfa8 = varalfa0; |FINSI;
                     nvariable = nvariable + 1;
               |SIGUE;
               |SI nume1 = enLongR;
                   sw = 0;
                   alfa1 = varalfa % 101;
                   |SI alfa1 ! "*";             || registros borrados
                       |SI nNueva ! 0;  |HAZ apuntes_5; |FINSI;
                       |SI nNueva = 0;  |HAZ apuntes_0; |FINSI;
                   |FINSI;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
    |CIERRAT #2;
    |CIERRAT #3;
|FPRC;

|PROCESO diario_08;
    enDiario = 1;
    |HAZ contador;
    docum = enContador;

    |ABRET #2;
    |ABRET #3;
    |DELINDEX #17; |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

    |SI FSalida ] 0;
        top = 1058;  |SI #0#10 ! 3; |Y #0#10 ! 4; top = top + 3; |FINSI;
        |SI #0#10 = 5; top = 1250; |FINSI;
        |SI #0#10 = 7; top = 1282; |FINSI;
        |HAZ principio;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |SI #0#9 = "F";
                   nLeeCuantos = 250;     |HAZ LeeUnoaUno;    varalfa = aLeeTodo;
                   FSalida = nLeeSalida;
               |SINO;
                  |XLEE handle, 250, varalfa;
              |FINSI;
              |SI FSalida = 250;
                  |SI #0#9 = "F";
                      nLeeCuantos = 48;  |HAZ LeeUnoaUno;    varalfa2 = aLeeTodo;
                      FSalida = nLeeSalida;
                  |SINO;
                      |XLEE handle, 48, varalfa2;
                  |FINSI;
                  |SI FSalida = 48;
                      |SI #0#10 = 5;
                          |SI #0#9 = "F";
                              nLeeCuantos = 50;  |HAZ LeeUnoaUno;    varalfa3 = aLeeTodo;
                              FSalida = nLeeSalida;
                          |SINO;
                              |XLEE handle, 50, varalfa3;
                          |FINSI;
                          |SI FSalida ! 50;
                              sw = 1;
                              |SAL;
                          |FINSI;
                   |FINSI;
                   |SI #0#10 = 7;
                       |SI #0#9 = "F";
                            nLeeCuantos = 51;  |HAZ LeeUnoaUno;    varalfa3 = aLeeTodo;
                            FSalida = nLeeSalida;
                        |SINO;
                           |XLEE handle, 51, varalfa3;
                        |FINSI;
                        |SI FSalida ! 51;
                            sw = 1;
                            |SAL;
                        |FINSI;
                   |FINSI;
                   alfa1 = varalfa % 101;
                   |SI alfa1 ! "*";             || registros borrados
                       |HAZ apuntes_5;
                   |FINSI;
              |SINO;
                   sw = 1;
              |FINSI;
           |SINO;
              sw = 1;
           |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #2;
    |CIERRAT #3;
    |CIERRA #17;
|FPRC;

|PROCESO diario_t095;
    nNume4 = 183;
    |SI #0#10 = 7;  nNume4 = 168;  |FINSI;

    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 249, varalfa;
               |SI FSalida = 249;
                   |XLEE handle, 250, varalfa2;
                   |SI FSalida = 250;
                       |XLEE handle, 250, varalfa3;
                       |SI FSalida = 250;
                          |XLEE handle, nNume4, varalfa4;
                          |SI FSalida = nNume4;
                                  alfa1 = varalfa % 101;
                                  |SI alfa1 ! "*";             || registros borrados
                                      |HAZ apuntes_9;
                                  |FINSI;
                           |SINO;
                               sw = 1;
                           |FINSI;
                        |SINO;
                          sw = 1;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;

|PROCESO diario_t093;
    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 249, varalfa;
               |SI FSalida = 249;
                   |XLEE handle, 233, varalfa2;
                   |SI FSalida = 233;
                       |XLEE handle, 240, varalfa3;
                       |SI FSalida = 240;
                          |XLEE handle, 244, varalfa4;
                          |SI FSalida = 244;
                              |XLEE handle, 227, varalfa5;
                              |SI FSalida = 227;
                                  |XLEE handle, 88, varalfa6;
                                  |SI FSalida = 88;
                                      alfa1 = varalfa % 101;
                                      |SI alfa1 ! "*";             || registros borrados
                                          |HAZ apuntes_9;
                                      |FINSI;
                                  |SINO;
                                      sw = 1;
                                  |FINSI;
                              |SINO;
                                  sw = 1;
                              |FINSI;
                          |SINO;
                             sw = 1;
                          |FINSI;
                       |SINO;
                          sw = 1;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;

|PROCESO diario_t092;
    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 249, varalfa;
               |SI FSalida = 249;
                   |XLEE handle, 233, varalfa2;
                   |SI FSalida = 233;
                       |XLEE handle, 240, varalfa3;
                       |SI FSalida = 240;
                          |XLEE handle, 244, varalfa4;
                          |SI FSalida = 244;
                              |XLEE handle, 227, varalfa5;
                              |SI FSalida = 227;
                                  alfa1 = varalfa % 101;
                                  |SI alfa1 ! "*";             || registros borrados
                                      |HAZ apuntes_9;
                                  |FINSI;
                              |SINO;
                                  sw = 1;
                              |FINSI;
                          |SINO;
                             sw = 1;
                          |FINSI;
                       |SINO;
                          sw = 1;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;

|PROCESO diario_t09;
    nNume4 = 50;
    |SI #0#10 = 4;  nNume4 = 62;  |FINSI;
    |SI #0#10 = 6;  nNume4 = 138; |FINSI;

    |DELINDEX #17;
    |ABRE #17;
    trabaj1 = #0#2;
    fichero = "diario";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 249, varalfa;
               |SI FSalida = 249;
                   |XLEE handle, nNume4, varalfa2;
                   |SI FSalida = nNume4;
                       alfa1 = varalfa % 101;
                       |SI alfa1 ! "*";             || registros borrados
                          |HAZ apuntes_9;
                       |FINSI;
                   |SINO;
                       sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRA #17;
|FPRC;
____________________________________/ CALCULOS DEL PASE DE CUENTAS
|PROCESO cli_prov_07;
  alfa1 = #4#0 % 103;
  |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
      |ACABA;
  |FINSI;
  |DDEFECTO #16;
  |SI alfa1 = "430";|O alfa1 = "440";
      #16#23 = "C";
  |SINO;
      #16#23 = "P";
  |FINSI;
  #16#10 = #4#0;             || cuenta contable
  #16#11 = #4#1;             || digito
  |LEE 101#16=;
  FEstado = FSalida;
  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 5835;    || direccion
  #16#6 = varalfa % 9325;    || poblacion
  #16#9 = varalfa % 4315;    || cif
  |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
  |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
  |LIBERA #16;
|FPRC;

|PROCESO cli_prov_02;
  alfa1 = #4#0 % 103;
  |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
      |ACABA;
  |FINSI;
  |DDEFECTO #16;
  |SI alfa1 = "430";|O alfa1 = "440";
      #16#23 = "C";
  |SINO;
      #16#23 = "P";
  |FINSI;
  #16#10 = #4#0;             || cuenta contable
  #16#11 = #4#1;             || digito
  |LEE 101#16=;
  FEstado = FSalida;
  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 6835;    || direccion
  #16#6 = varalfa % 10325;    || poblacion
  #16#9 = varalfa % 5315;    || cif
  |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
  |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
  |LIBERA #16;
|FPRC;

|PROCESO cli_prov_01;
  alfa1 = #4#0 % 103;
  |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
      |ACABA;
  |FINSI;
  |DDEFECTO #16;
  |SI alfa1 = "430";|O alfa1 = "440";
      #16#23 = "C";
  |SINO;
      #16#23 = "P";
  |FINSI;
  #16#10 = #4#0;             || cuenta contable
  #16#11 = #4#1;             || digito
  |LEE 101#16=;
  FEstado = FSalida;
  |SI FEstado = 0; |Y #0#15 = "N"; |LIBERA #16; |ACABA; |FINSI;

  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#2 = varalfa % 5340;    || direccion
  #16#6 = varalfa % 9325;    || poblacion
  #16#9 = varalfa % 4310;    || cif
  |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
  |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
  |LIBERA #16;
|FPRC;

|PROCESO cli_prov_09;
  alfa1 = #4#0 % 103;
  |SI alfa1 ! "430";  |Y alfa1 ! "440";  |Y alfa1 ! "400";  |Y alfa1 ! "410";
      |ACABA;
  |FINSI;
  |DDEFECTO #16;
  |SI alfa1 = "430";|O alfa1 = "440";
      #16#23 = "C";
  |SINO;
      #16#23 = "P";
  |FINSI;
  #16#10 = #4#0;             || cuenta contable
  #16#11 = #4#1;             || digito
  |LEE 101#16=;
  FEstado = FSalida;
  #16#0 = #4#0;              || codigo (cuenta)
  #16#1 = #4#2;              || nombre
  #16#9 = varalfa % 5315;    || cif
  #16#2 = varalfa % 6835;    || direccion
  #16#6 = varalfa % 10325;   || poblacion
  #16#5 = varalfa % 12825;   || provincia

  alfa1 = varalfa % 14802;   || cp 1
  #16#3 = alfa1;
  alfa1 = varalfa % 15003;   || cp 2
  #16#4 = alfa1;
  #16#25 = varalfa % 14805;
  |SI FEstado ! 0;  |GRABA 020#16n;     |FINSI;
  |SI FEstado = 0;  |GRABA 020#16a;     |FINSI;
  |LIBERA #16;
|FPRC;

|PROCESO cuentas9;
|DDEFECTO #4;
    #4#0 = varalfa % 112;     || cuenta
    conte = #4#0;
    alfa1 = conte % 101; |SI alfa1 < "0"; |O alfa1 > "9"; |ACABA; |FINSI;
|HAZ digito;
|SI digito ! 0;
        #4#1 = digito;            || digito
        #4#2 = varalfa % 1340;    || descripcion
        #4#3 = "S";               || pase directo

    |ATRI I;
    |PINTA 2221, #4#0;
    |PINTA 2234, #4#2;
    |ATRI 0;

        mascara = #4#0;
    |QBF mascara;
        mascara = mascara +"zzzzzzzzzzzz";
        mascara = mascara % 112;

        #4#54 = mascara;
        #4#55 = #4#1;

    |HAZ defect;

    |GRABA 000#4n;
    |SI FSalida = 0;
        |HAZ cli_prov_09;
    |FINSI;
|SINO;
    |MENAV "    No corresponden los Niveles; proceso interrumpido ...";
    sw = 1;
|FINSI;
|FPRC;

|PROCESO cuentas;
    alfa1 = varalfa % 101;
    |SI #0#5 = 8; |Y #0#10 = 9;
        |SI alfa1 = "*"; |O alfa1 = " ";
            varalfa = varalfa % 2;    || primera posicion
        |FINSI;
    |FINSI;

    |DDEFECTO #4;
    #4#0 = varalfa % 112;     || cuenta
    conte = #4#0;
    alfa1 = conte % 101; |SI alfa1 < "0"; |O alfa1 > "9"; |ACABA; |FINSI;
    |HAZ digito;
    |SI digito ! 0;
        #4#1 = digito;            || digito
        |LEE 141#4=;
        FEntrada = FSalida;

        #4#2 = varalfa % 1330;    || descripcion
        #4#3 = "S";               || pase directo

    |ATRI I;
    |PINTA 2221, #4#0;
    |PINTA 2234, #4#2;
    |ATRI 0;

        mascara = #4#0;
    |QBF mascara;
        mascara = mascara +"zzzzzzzzzzzz";
        mascara = mascara % 112;

        #4#54 = mascara;
        #4#55 = #4#1;

    |HAZ defect;

    |SI FEntrada ! 0; |GRABA 000#4b; |FINSI;
    |SI FEntrada = 0;
        |SI #0#15 = "S"; |GRABA 020#4a; |FINSI;
    |FINSI;
    |SI #0#5 = 1;              |HAZ cli_prov_01;   |FINSI;
    |SI #0#5 ] 2;|Y #0#5 [ 6;  |HAZ cli_prov_02;   |FINSI;
    |SI #0#5 = 7;              |HAZ cli_prov_07;   |FINSI;
    |SI #0#5 = 8;|Y #0#10 = 9; |HAZ cli_prov_09;   |FINSI;
  |SINO;
    |MENAV "    No corresponden los Niveles; proceso interrumpido ...";
    sw = 1;
  |FINSI;
  |LIBERA #4;
|FPRC;

|| ------------------------- FIN ALEX NUEVO ------------------------------
|PROCESO subcta_Ult;

    |ABRET #4;
    |ABRET #16;
    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;
    |SI eswError ! 0; |ACABA; |FINSI;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

    |SI FSalida ] 0;
        top = enCap;
        |HAZ principio;
        sw = 0;

        |PARA; |SI sw = 0; |HACIENDO;
               sw        = 1;
               nume1     = 0;
               nvariable = 0;
               |PARA para1 = enLongR;  |SI para1 > 0;  |HACIENDO para1 = para1 - 250;
                     |SI para1 ] 250;
                         |XLEE handle, 250, varalfa0;
                     |SINO;
                         |XLEE handle, para1, varalfa0;
                     |FINSI;
                     nume1 = nume1 + FSalida;
                     |SI nvariable = 0; varalfa  = varalfa0; |FINSI;
                     |SI nvariable = 1; varalfa2 = varalfa0; |FINSI;
                     |SI nvariable = 2; varalfa3 = varalfa0; |FINSI;
                     |SI nvariable = 3; varalfa4 = varalfa0; |FINSI;
                     |SI nvariable = 4; varalfa5 = varalfa0; |FINSI;
                     |SI nvariable = 5; varalfa6 = varalfa0; |FINSI;
                     |SI nvariable = 6; varalfa7 = varalfa0; |FINSI;
                     |SI nvariable = 7; varalfa8 = varalfa0; |FINSI;
                     |SI nvariable ] 8; varalfa8 = varalfa0; |FINSI;
                     nvariable = nvariable + 1;
               |SIGUE;
               |SI nume1 = enLongR;
                   sw = 0;
                   |HAZ cuentas;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
    |FINSI;
    Pos = -1;
    |CIERRAT #4;
    |CIERRAT #16;
|FPRC;

|PROCESO subcta_08;

  |SI #0#10 = 3; |HAZ subcta_09; |ACABA; |FINSI;  || nuevo 50052

  |ABRET #4;
  |ABRET #16;
  trabaj1 = #0#2;
  fichero = "subcta";
  |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;

    |SI FSalida ] 0;
        top = 4099; |SI #0#10 = 1; |O #0#10 = 5; top = top + 32; |FINSI;
        |HAZ principio;

        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               sw = 1;
               |XLEE handle, 110, varalfa;                                                ||
               |SI FSalida = 110;                                            ||
                   |XLEE handle, 250, varalfa2;                                          ||
                   |SI FSalida = 250;                                       ||
                      |XLEE handle, 250, varalfa2;                                          ||
                      |SI FSalida = 250;                                  ||
                           |XLEE handle, 250, varalfa2;                                          ||
                           |SI FSalida = 250;                             ||
                                |XLEE handle, 250, varalfa3;                           ||
                                |SI FSalida = 250;                        ||
                                     |XLEE handle, 250, varalfa4;                      ||
                                     |SI FSalida = 250;                   ||
                                         |XLEE handle, 250, varalfa5;                  ||
                                         |SI FSalida = 250;               ||
                                             |XLEE handle, 250, varalfa6;
                                             |SI FSalida = 250;
                                                 |SI #0#10 = 1; |O #0#10 = 5; varalfa7 = handle + " 233";nNume1 = 233; |FINSI; ||8
                                                 |SI #0#10 = 2; |O #0#10 = 4; varalfa7 = handle + " 232";nNume1 = 232; |FINSI; ||8
                                                 |XLEE handle, nNume1, varalfa7;
                                                 |SI FSalida = nNume1;
                                                        sw = 0;
                                                        |HAZ cuentas;
                                                 |FINSI;
                                              |FINSI;
                                         |FINSI;
                                     |FINSI;
                                |FINSI;
                           |FINSI;
                      |FINSI;
                 |FINSI;
            |FINSI;
    |SIGUE;
    |XCIERRA handle;
  |FINSI;
  Pos = -1;
  |CIERRAT #4;
  |CIERRAT #16;
|FPRC;

|PROCESO subcta_09;
  |ABRET #4;
  |ABRET #16;
  trabaj1 = #0#2;
  fichero = "subcta";
  |HAZ nombre;

  |XABRE "UB", fiche, handle;
  |SI FSalida < 0;
      |XABRE "CUB", fiche, handle;
  |FINSI;

  |SI FSalida ] 0;
      top = 419; |HAZ principio;
      sw = 0;
     |PARA; |SI sw = 0; |HACIENDO;
            |XLEE handle, 162, varalfa;
            |SI FSalida = 162;
                |HAZ cuentas9;
            |SINO;
                sw = 1;
            |FINSI;
     |SIGUE;
     |XCIERRA handle;
  |FINSI;
  Pos = -1;
  |CIERRAT #4;
  |CIERRAT #16;
|FPRC;

|PROCESO subcta_t09;  ||Nuevo
    nNume4 = 163;
    |SI #0#10 = 4;  nNume4 = 154;  |FINSI;
    |SI #0#10 = 6;  nNume4 = 209;  |FINSI;
    |ABRET #4;
    |ABRET #16;

    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, nNume4, varalfa;
               |SI FSalida = nNume4;
                   |HAZ cuentas;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
     |FINSI;
     Pos = -1;
     |CIERRAT #4;
     |CIERRAT #16;
|FPRC;

|PROCESO subcta_t092;  ||Nuevo Gemicar
    nNume4 = 250;
    |SI #0#10 = 7;  nNume4 = 221;  |FINSI;

    |ABRET #4;
    |ABRET #16;

    trabaj1 = #0#2;
    fichero = "subcta";
    |HAZ nombre;

    |XABRE "UB", fiche, handle;
    |SI FSalida < 0;
        |XABRE "CUB", fiche, handle;
    |FINSI;
    |SI FSalida ] 0;
        sw = 0;
        |PARA; |SI sw = 0; |HACIENDO;
               |XLEE handle, 217, varalfa;
               |SI FSalida = 217;
                   |XLEE handle, nNume4, varalfa2;
                   |SI FSalida = nNume4;
                       |HAZ cuentas;
                   |SINO;
                        sw = 1;
                   |FINSI;
               |SINO;
                   sw = 1;
               |FINSI;
        |SIGUE;
        |XCIERRA handle;
     |FINSI;
     Pos = -1;
     |CIERRAT #4;
     |CIERRAT #16;
|FPRC;
|| /////////////////////////////////////////// termina cuentas

____________________________________/ CALCULO PRINCIPAL
|PROCESO pasa;  |TIPO 3;

|SI #0#0 = "S";
    nNueva = #0#10;
    |SI #0#3 = "S";
        |SI nNueva = 0;              #0#10 = 9; |FINSI;
        |SI nNueva = 6; |Y #0#5 = 8; #0#10 = 1; |FINSI;
        |SI nNueva = 7; |Y #0#5 = 8; #0#10 = 3; |FINSI;
        |SI nNueva = 8;              #0#10 = 1; |FINSI;

        |SI #0#5 = 8;
             |SI #0#10 ! 9; |HAZ subcta_08; |FINSI;
             |SI #0#10 = 9; |HAZ subcta_Ult; |FINSI;
        |FINSI;

        |SI #0#5 = 9;         || Nuevo Txt
            |SI #0#10 = 1; |HAZ subcta_t09;  |FINSI;
            |SI #0#10 = 4; |HAZ subcta_t09;  |FINSI;
            |SI #0#10 = 5; |HAZ subcta_t09;  |FINSI;
            |SI #0#10 = 6; |HAZ subcta_t09;  |FINSI;
            |SI #0#10 = 2; |HAZ subcta_t092; |FINSI;
            |SI #0#10 = 3; |HAZ subcta_t092; |FINSI;
            |SI #0#10 = 7; |HAZ subcta_t092; |FINSI;
        |FINSI;
    |FINSI;

    #0#10 = nNueva;
    |PINTA 2221, "                                                  ";

    |SI #0#4 = "S";

        |SI nNueva = 0;              #0#10 = 9; |FINSI;
        |SI nNueva = 6; |Y #0#5 = 8; #0#10 = 3; |FINSI;
        |SI nNueva = 8;              #0#10 = 7; |FINSI;

        |SI #0#5 = 8;
            |SI #0#10 ! 9; |HAZ diario_08; |FINSI;
            |SI #0#10 = 9; |HAZ diario_Ult; |FINSI;
        |FINSI;
        |SI #0#5 = 9;
            |ABRET #2;
            |ABRET #3;
            |SI #0#10 = 1; |O #0#10 = 4; |O #0#10 = 6;
                |HAZ diario_t09;
            |FINSI;
            |SI #0#10 = 2; |HAZ diario_t092; |FINSI;
            |SI #0#10 = 3; |HAZ diario_t093; |FINSI;
            |SI #0#10 = 5; |O #0#10 = 7; |HAZ diario_t095; |FINSI;
            |CIERRAT #3;
            |CIERRAT #2;
        |FINSI;

        #0#10 = nNuevo;

        |SUB_EJECUTA "camaapua.run";
    |FINSI;
    #0#10 = nNueva;
    |SI sumar ! 0;
        |HAZ GrabaIva;
    |FINSI;
|FINSI;

|FPRC;

|PROCESO RegIva;

  esAbono = "N";
  #17#0 = queiv;
  #17#1 = docum;      ||N§Documento.
  #17#2 = 1;
  |LEE 000#17];
  |PARA; |SI FSalida = 0; |Y #17#0 = queiv; |Y #17#1 = docum; |HACIENDO;
     |SI #17#9 = "S"; esAbono = "S"; |SAL; |FINSI;
     |LEE 000#17s;
  |SIGUE;

  |DDEFECTO #17;
  sumar = sumar + 1;
  #17#0 = queiv;      ||Que Iva 477 Repercutido 472 Soportado.
  #17#1 = docum;      ||N§Documento.
  #17#2 = sumar;      ||Sumador Registros.
  #17#3 = cotra;      ||Cuenta.
  #17#4 = impoi;      ||Importe.
  #17#5 = iva;        ||Porcentaje Iva.
  #17#6 = ivcon;      ||Concepto.
  #17#7 = fecha;      ||Fecha.
  #17#8 = rec;        ||Porcentaje Rec.

  |SI esAbono = "N";
     |SI #17#0 = "477";
        alfa1 = varalfa % 3916;  nCalc = alfa1;
        |SI nCalc = 0;
           #17#9 = "N";        || Abono S/N
        |SINO;
           #17#9 = "S";        || Abono S/N
        |FINSI;
     |FINSI;

     |SI #17#0 = "472";
        alfa1 = varalfa % 8016;  nCalc = alfa1;
        |SI nCalc = 0;
           #17#9 = "N";        || Abono S/N
        |SINO;
           #17#9 = "S";        || Abono S/N
        |FINSI;
     |FINSI;
  |SINO;
     #17#9 = "S";
  |FINSI;

  |GRABA 020#17n;
  |LIBERA #17;
|FPRC;

|PROCESO IvaSop;
     |DDEFECTO #19;

     #19#0  = #0#8;   || Libro
     #19#27 = "";     || Serie.
     #19#2  = nConta; || Orden.

     |LEE 101#19=;
     |SI FSalida ! 0;
          |GRABA 020#19b;
     |FINSI;

     #19#1  = aDcont; ||
     #19#3  = #17#7;  || Fecha
     #19#4  = #17#3;  || Cuenta
     conte  = #17#3;
     |HAZ digito;
     #19#5  = digito; || Digito
     #19#6  = 999;    || concepto
     #19#7  = #17#6;  || Descrip. Concepto

     |SI nIs1 = 0;
          #19#8  = #17#4;                                            ||Base 1
          #19#11 = #17#5;                                            ||(%)  1
          #19#17 = #17#8;                                            ||(%) R1
          nIs1   = #17#5;                                            ||(%)  1
     |SINO;                                                          ||
          |SI nIs1   = #17#5;                                        ||
               #19#8  = #19#8 + #17#4;                               ||
               #19#11 = #17#5;                                       ||(%)  1
               #19#17 = #17#8;                                       ||(%) R1
          |SINO;                                                     ||
               |SI nIs2  = 0;                                        ||
                    #19#9 = #17#4;                                   ||Base 2
                    #19#12 = #17#5;                                  ||(%)  2
                    #19#18 = #17#8;                                  ||(%) R2
                    nIs2   = #17#5;                                  ||(%)  2
               |SINO;                                                ||
                    |SI nIs2   = #17#5;                              ||
                         #19#9 = #19#9 + #17#4;                      ||
                         #19#12 = #17#5;                             ||(%)  2
                         #19#18 = #17#8;                             ||(%) R2
                    |SINO;                                           ||
                         |SI nIs3   = 0;                             ||
                              #19#10 = #17#4;                        ||Base 3
                              #19#13 = #17#5;                        ||(%)  3
                              nIs3   = #17#5;                        ||(%)  3
                              #19#19 = #17#8;                        ||(%) R3
                         |SINO;                                      ||
                              |SI nIs3   = #17#5;                    ||
                                   #19#10 = #19#10 + #17#4;          ||
                                   #19#13 = #17#5;                   ||(%)  3
                                   #19#19 = #17#8;                   ||(%) R3
                              |SINO;                                 ||
                                   |SI nIs4   = 0;                   ||
                                        #19#52 = #17#4;              ||Base 4
                                        #19#54 = #17#5;              ||(%)  4
                                        #19#58 = #17#8;              ||(%) R4
                                        nIs4   = #17#5;              ||(%)  4
                                   |SINO;                            ||
                                        |SI nIs4   = #17#5;          ||
                                             #19#52 = #19#52 + #17#4;||
                                             #19#54 = #17#5;         ||(%)  4
                                             #19#58 = #17#8;         ||(%) R4
                                        |SINO;                       ||
                                             |SI nIs5   = 0;         ||
                                                  #19#53 = #17#4;    ||Base 5
                                                  #19#55 = #17#5;    ||(%)  5
                                                  #19#59 = #17#8;    ||(%) R5
                                                  nIs5   = #17#5;    ||(%)  5
                                             |SINO;                  ||
                                                  |SI nIs5   = #17#5;||
                                                       #19#53 = #19#53 + #17#4;
                                                       #19#55 = #17#5;
                                                       #19#59 = #17#8; ||(%) R5
                                                  |FINSI;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     #19#14 = ((#19#8  * #19#11)/100) ! EURODB;  ||Cuota Iva 1
     #19#15 = ((#19#9  * #19#12)/100) ! EURODB;  ||Cuota Iva 2
     #19#16 = ((#19#10 * #19#13)/100) ! EURODB;  ||Cuota Iva 3
     #19#56 = ((#19#52 * #19#54)/100) ! EURODB;  ||Cuota Iva 4
     #19#57 = ((#19#53 * #19#55)/100) ! EURODB;  ||Cuota Iva 5

     #19#20 = ((#19#8  * #19#17)/100) ! EURODB;  ||Cuota Rec 1
     #19#21 = ((#19#9  * #19#18)/100) ! EURODB;  ||Cuota Rec 2
     #19#22 = ((#19#10 * #19#19)/100) ! EURODB;  ||Cuota Rec 3
     #19#60 = ((#19#52 * #19#58)/100) ! EURODB;  ||Cuota Rec 4
     #19#61 = ((#19#53 * #19#59)/100) ! EURODB;  ||Cuota Rec 5

     alfa1 = #17#7;      alfa1 = alfa1 %  -104;  || saca a¤o
     alfa2 = "31.03." + alfa1;  trim1 = alfa2;   || primer trimestre
     alfa2 = "30.06." + alfa1;  trim2 = alfa2;   || segundo trimestre
     alfa2 = "30.09." + alfa1;  trim3 = alfa2;   || tercer trimestre
     |SI #19#3 [ trim1;                   #19#44 = 1;  |FINSI;
     |SI #19#3 > trim1;|Y #19#3 [ trim2;  #19#44 = 2;  |FINSI;
     |SI #19#3 > trim2;|Y #19#3 [ trim3;  #19#44 = 3;  |FINSI;
     |SI #19#3 > trim3;                   #19#44 = 4;  |FINSI;
                              || periodo (segun fecha)
    #19#45 = 1;               || diario
    #19#46 = #17#7;           || fecha
    #19#47 = #17#1;           || documento

    #16#23 = "P";
    #16#10 = #19#4;
    #16#11 = #19#5;
    |LEE 000#16=;
    |SI FSalida = 0;
        #19#50 = #16#1;
        #19#51 = #16#9;
    |FINSI;

    |SI #17#9 = "S";
       |SI #19#08 > 0; #19#08 = #19#08 * -1; |FINSI;
       |SI #19#09 > 0; #19#09 = #19#09 * -1; |FINSI;
       |SI #19#10 > 0; #19#10 = #19#10 * -1; |FINSI;
       |SI #19#52 > 0; #19#52 = #19#52 * -1; |FINSI;
       |SI #19#53 > 0; #19#53 = #19#53 * -1; |FINSI;

       |SI #19#14 > 0; #19#14 = #19#14 * -1; |FINSI;
       |SI #19#15 > 0; #19#15 = #19#15 * -1; |FINSI;
       |SI #19#16 > 0; #19#16 = #19#16 * -1; |FINSI;
       |SI #19#56 > 0; #19#56 = #19#56 * -1; |FINSI;
       |SI #19#57 > 0; #19#57 = #19#57 * -1; |FINSI;

       |SI #19#20 > 0; #19#20 = #19#20 * -1; |FINSI;
       |SI #19#21 > 0; #19#21 = #19#21 * -1; |FINSI;
       |SI #19#22 > 0; #19#22 = #19#22 * -1; |FINSI;
       |SI #19#60 > 0; #19#60 = #19#60 * -1; |FINSI;
       |SI #19#61 > 0; #19#61 = #19#61 * -1; |FINSI;
    |FINSI;

    nPepe1  = #19#08+#19#14+#19#20;       || total 1
    nPepe2  = #19#09+#19#15+#19#21;       || total 2
    nPepe3  = #19#10+#19#16+#19#22;       || total 3
    nPepe4  = #19#52+#19#56+#19#60;       || total 4
    nPepe5  = #19#53+#19#57+#19#61;       || total 5
    #19#26  = nPepe1 + nPepe2 + nPepe3 + nPepe4 + nPepe5;
                           || total factura (recalculado!!!)
    |GRABA 020#19a;
    |LIBERA #19;

|FPRC;

|PROCESO IvaRep;
     |DDEFECTO #18;

     #18#0  = #0#7;   || Libro
     #18#27 = "";     || Serie.
     #18#2  = nConta; || Orden.

     |LEE 101#18=;
     |SI FSalida ! 0;
          |GRABA 020#18b;
     |FINSI;

     #18#1  = aDcont; ||
     #18#3  = #17#7;  || Fecha
     #18#4  = #17#3;  || Cuenta
     conte  = #17#3;
     |HAZ digito;
     #18#5  = digito; || Digito
     #18#6  = 999;    || concepto
     #18#7  = #17#6;  || Descrip. Concepto

     |SI nIr1  = 0;
          #18#8  = #17#4;                                            ||Base 1
          #18#11 = #17#5;                                            ||(%)  1
          nIr1   = #17#5;                                            ||(%)  1
          #18#17 = #17#8;                                            ||(%) R1
     |SINO;                                                          ||
          |SI nIr1   = #17#5;                                        ||
               #18#8  = #18#8 + #17#4;                               ||
               #18#11 = #17#5;                                       ||(%) I1
               #18#17 = #17#8;                                       ||(%) R1
          |SINO;                                                     ||
               |SI nIr2  = 0;                                        ||
                    #18#9 = #17#4;                                   ||Base 2
                    #18#12 = #17#5;                                  ||(%)  2
                    nIr2   = #17#5;                                  ||(%)  2
                    #18#18 = #17#8;                                  ||(%) R2
               |SINO;                                                ||
                    |SI nIr2   = #17#5;                              ||
                         #18#9  = #18#9 + #17#4;                     ||
                         #18#12 = #17#5;                             ||(%)  3
                         #18#18 = #17#8;                             ||(%) R3
                    |SINO;                                           ||
                         |SI nIr3   = 0;                             ||
                              #18#10 = #17#4;                        ||Base 3
                              #18#13 = #17#5;                        ||(%)  3
                              #18#19 = #17#8;                        ||(%) R3
                              nIr3   = #17#5;                        ||(%)  3
                         |SINO;                                      ||
                              |SI nIr3   = #17#5;                    ||
                                   #18#10 = #18#10 + #17#4;          ||
                                   #18#13 = #17#5;                   ||(%)  3
                                   #18#19 = #17#8;                   ||(%) R3
                              |SINO;                                 ||
                                   |SI nIr4   = 0;                   ||
                                        #18#52 = #17#4;              ||Base 4
                                        #18#54 = #17#5;              ||(%)  4
                                        #18#58 = #17#8;              ||(%) R4
                                        nIr4   = #17#5;              ||(%)  4
                                   |SINO;                            ||
                                        |SI nIr4   = #17#5;          ||
                                             #18#52 = #18#52 + #17#4;||
                                             #18#54 = #17#5;         ||(%)  4
                                             #18#58 = #17#8;         ||(%) R4
                                        |SINO;                       ||
                                             |SI nIr5   = 0;         ||
                                                  #18#53 = #17#4;    ||Base 5
                                                  #18#55 = #17#5;    ||(%)  5
                                                  #18#59 = #17#8;    ||(%) R5
                                                  nIr5   = #17#5;    ||(%)  5
                                             |SINO;                  ||
                                                  |SI nIr5   = #17#5;||
                                                       #18#53 = #18#53 + #17#4;
                                                       #18#55 = #17#5;
                                                       #18#59 = #17#8;||(%) R5
                                                  |FINSI;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     #18#14 = ((#18#8  * #18#11)/100) ! EURODB;  ||Cuota Iva 1
     #18#15 = ((#18#9  * #18#12)/100) ! EURODB;  ||Cuota Iva 2
     #18#16 = ((#18#10 * #18#13)/100) ! EURODB;  ||Cuota Iva 3
     #18#56 = ((#18#52 * #18#54)/100) ! EURODB;  ||Cuota Iva 4
     #18#57 = ((#18#53 * #18#55)/100) ! EURODB;  ||Cuota Iva 5

     #18#20 = ((#18#8  * #18#17)/100) ! EURODB;  ||Cuota Rec 1
     #18#21 = ((#18#9  * #18#18)/100) ! EURODB;  ||Cuota Rec 2
     #18#22 = ((#18#10 * #18#19)/100) ! EURODB;  ||Cuota Rec 3
     #18#60 = ((#18#52 * #18#58)/100) ! EURODB;  ||Cuota Rec 4
     #18#61 = ((#18#53 * #18#59)/100) ! EURODB;  ||Cuota Rec 5

     alfa1 = #17#7;      alfa1 = alfa1 %  -104;  || saca a¤o
     alfa2 = "31.03." + alfa1;  trim1 = alfa2;   || primer trimestre
     alfa2 = "30.06." + alfa1;  trim2 = alfa2;   || segundo trimestre
     alfa2 = "30.09." + alfa1;  trim3 = alfa2;   || tercer trimestre
     |SI #18#3 [ trim1;                   #18#44 = 1;  |FINSI;
     |SI #18#3 > trim1;|Y #18#3 [ trim2;  #18#44 = 2;  |FINSI;
     |SI #18#3 > trim2;|Y #18#3 [ trim3;  #18#44 = 3;  |FINSI;
     |SI #18#3 > trim3;                   #18#44 = 4;  |FINSI;
                              || periodo (segun fecha)
    #18#45 = 1;               || diario
    #18#46 = #17#7;           || fecha
    #18#47 = #17#1;           || documento

    #16#23 = "C";
    #16#10 = #18#4;
    #16#11 = #18#5;
    |LEE 000#16=;
    |SI FSalida = 0;
        #18#50 = #16#1;
        #18#51 = #16#9;
    |FINSI;

    |SI #17#9 = "S";
       nCalc = -1;
    |SINO;
       nCalc = 1;
    |FINSI;

    |SI #17#9 = "S";
       |SI #18#08 > 0; #18#08 = #18#08 * -1; |FINSI;
       |SI #18#09 > 0; #18#09 = #18#09 * -1; |FINSI;
       |SI #18#10 > 0; #18#10 = #18#10 * -1; |FINSI;
       |SI #18#52 > 0; #18#52 = #18#52 * -1; |FINSI;
       |SI #18#53 > 0; #18#53 = #18#53 * -1; |FINSI;

       |SI #18#14 > 0; #18#14 = #18#14 * -1; |FINSI;
       |SI #18#15 > 0; #18#15 = #18#15 * -1; |FINSI;
       |SI #18#16 > 0; #18#16 = #18#16 * -1; |FINSI;
       |SI #18#56 > 0; #18#56 = #18#56 * -1; |FINSI;
       |SI #18#57 > 0; #18#57 = #18#57 * -1; |FINSI;

       |SI #18#20 > 0; #18#20 = #18#20 * -1; |FINSI;
       |SI #18#21 > 0; #18#21 = #18#21 * -1; |FINSI;
       |SI #18#22 > 0; #18#22 = #18#22 * -1; |FINSI;
       |SI #18#60 > 0; #18#60 = #18#60 * -1; |FINSI;
       |SI #18#61 > 0; #18#61 = #18#61 * -1; |FINSI;
    |FINSI;

    nPepe1  = #18#08+#18#14+#18#20;       || total 1
    nPepe2  = #18#09+#18#15+#18#21;       || total 2
    nPepe3  = #18#10+#18#16+#18#22;       || total 3
    nPepe4  = #18#52+#18#56+#18#60;       || total 4
    nPepe5  = #18#53+#18#57+#18#61;       || total 5
    #18#26  = nPepe1 + nPepe2 + nPepe3 + nPepe4 + nPepe5;
                           || total factura (recalculado!!!)
    |GRABA 020#18a;
    |LIBERA #18;

|FPRC;

|PROCESO pacontmp;
     |SI swVic = 0;
          swVic = 1;
          nGrup = #17#1;
          aCual = #17#0;
          |SI #17#0 = "472";
               qConta = #0#8;
               |HAZ LeeConta;
          |FINSI;
          |SI #17#0 = "477";
               qConta = #0#7;
               |HAZ LeeConta;
          |FINSI;
     |FINSI;
     |SI nGrup ! #17#1; |O aCual ! #17#0;
          nGrup = #17#1;
          aCual = #17#0;
          |SI #17#0 = "472";
               qConta = #0#8;
               |HAZ LeeConta;
          |FINSI;
          |SI #17#0 = "477";
               qConta = #0#7;
               |HAZ LeeConta;
          |FINSI;
     |FINSI;
     |SI #17#0 = "472";
          |HAZ IvaSop;
     |SINO;
          |HAZ IvaRep;
     |FINSI;
|FPRC;

|DEFBUCLE pacontmp;
     #17#1;
     ;
     "   ",000001,1;
     "zzz",999999,9999;
     ;
     NULL,pacontmp;
|FIN;

|PROCESO GrabaIva;
     |ABRE #16;
     |ABRE #18;
     |ABRE #19;
     |ABRE #20;
     |BUCLE pacontmp;
     |CIERRA #16;
     |CIERRA #18;
     |CIERRA #19;
     |CIERRA #20;
|FPRC;

|PROCESO libros; |TIPO 0;
     |SI #0#6 = "N";
          |C_M #0#7 , 1 , "N";
          |C_M #0#8 , 1 , "N";
     |SINO;
          |C_M #0#7 , 1 , "S";
          |C_M #0#8 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO LeeConta;
     #20#0 = qConta;
     |LEE 101#20=;
     |SI FSalida ! 0;
          |GRABA 020#20b;
     |FINSI;
     nConta = #20#4;
     aDcont = #20#1;
     |SI aCual = "472"; #20#4  = nConta + #20#3; |FINSI;
     |SI aCual = "477"; #20#4  = nConta + 1;     |FINSI;
     |GRABA 020#20a;
     |LIBERA #20;
|FPRC;


|PROGRAMA;
 |CLS;
 |CABEZA "Pase Contaplus Completa";
 |HAZ inicio;
 |HAZ eVarEmpresa;

 |PINPA #0#0;
 |ABRE #0;
 |LEE 101#0p;
 |SI FSalida ! 0;
     |DDEFECTO #0;
     |GRABA 020#0b;
 |FINSI;

 #0#0 = "N";
 |PINDA #0#0;

 |ENDATOS #1#0;
 |SI FSalida = 0;
     |GRABA 020#0a;
 |FINSI;
 |CIERRA #0;
|FPRO;
