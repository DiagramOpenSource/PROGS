|FICHEROS;
   camanctc #1;
   camanctl #0,MANTE;

   camaasic #2;
   camaasil #3;

   calicont #4;

   calisasi #5,MANTE;
|FIN;

|VARIABLES;
   &entrada = 1;
   FEstado = 0;

   UltimaLinea = 0;

   FechaTrabajo = @;
   FechaVirtual = @;
   Dias         = 0;
   Porcent      = 0;
   Cuadros      = "";
   LimiteDias   = 0;
   Comodin      = "";

   Parte1 = 0;
   Parte2 = 0;
   Part1 = "";
   Part2 = "";
   ComodNum = 0;

   MaxDig = 0;
   Nivel  = 0;
|FIN;

|INCLUYE acceso_i;

|PROCESO PintaBarra;
   Cuadros = FechaTrabajo % -104;
   Cuadros = "01.01." + Cuadros;
   |QBF Cuadros;
   FechaVirtual = Cuadros;
   FechaTrabajo = FechaTrabajo - FechaVirtual;
   Dias = FechaTrabajo;
   Porcent = ((Dias * 100) / LimiteDias) ! 0;
   Comodin = ("000" + Porcent) % -103;
   |QBF Comodin;
   Comodin = Comodin + " %";
   |PINTA 1238, Comodin;
   Porcent = (Porcent / 5) ! 0;
   Cuadros = &219 * Porcent;
   |PINTA 1130, Cuadros;
|FPRC;

|PROCESO Return; |TIPO 13;
   |SI FSalida = 0; |PTEC 806; |FINSI;
|FPRC;

|PROCESO TomaAsientos;
   #camaasil#0 = #camaasic#0;
   #camaasil#1 = #camaasic#1;
   #camaasil#2 = #camaasic#2;
   #camaasil#3 = 1;
   |LEE 010#camaasil.=;
   |SI FSalida = 0;
      |DDEFECTO #calisasi;
      #calisasi#0 = #camaasic#0;
      #calisasi#1 = #camaasic#1;
      #calisasi#2 = #camaasic#2;
      #calisasi#3 = #camaasil#7;
      |GRABA 020#calisasi.n;
   |FINSI;
   FechaTrabajo = #camaasic#1;
   |HAZ PintaBarra;
|FPRC;

|DEFBUCLE TomaAsientos;
#camaasic#1;
;
00,"01.01.1900",000001;
99,"31.12.2999",999999;
;
NULL,TomaAsientos;
|FIN;

|PROCESO RellenaTempo;
   #calicont#0 = #camaasil#0;
   #calicont#1 = #camaasil#1;
   #calicont#2 = #camaasil#2;
   #calicont#3 = #camaasil#3;
   |LEE 010#calicont.=;
   |SI FSalida = 0;
      |DDEFECTO #camanctl;
      #camanctl#0  = #calicont#0;
      #camanctl#1  = #calicont#1;
      #camanctl#2  = #calicont#2;
      #camanctl#3  = #calicont#3;
      #camanctl#4  = #camaasil#16;
      #camanctl#5  = #camaasil#17;
      #camanctl#6  = #camaasil#10;
      #camanctl#7  = #camaasil#11;
      #camanctl#8  = #calicont#4;
      #camanctl#9  = #calicont#5;
      #camanctl#10 = #camaasil#7;
      |GRABA 020#camanctl.n;
   |SINO;
      #camanctl#0  = #camaasil#0;
      #camanctl#1  = #camaasil#1;
      #camanctl#2  = #camaasil#2;
      #camanctl#3  = #camaasil#3;
      #camanctl#4  = #camaasil#16;
      #camanctl#5  = #camaasil#17;
      #camanctl#6  = #camaasil#10;
      #camanctl#7  = #camaasil#11;
      #camanctl#8  = "";
      #camanctl#9  = 0;
      #camanctl#10 = #camaasil#7;
      |GRABA 020#camanctl.n;
   |FINSI;
|FPRC;

|DEFBUCLE RellenaTempo;
  #camaasil#1;
  ;
  #camanctc#0,#camanctc#1,#camanctc#2,0001;
  #camanctc#0,#camanctc#1,#camanctc#2,9999;
  ;
  NULL,RellenaTempo;
|FIN;

|PROCESO VuelcaTempo;
   #calicont#0 = #camanctl#0;
   #calicont#1 = #camanctl#1;
   #calicont#2 = #camanctl#2;
   #calicont#3 = #camanctl#3;
   |LEE 110#calicont.=;
   |SI FSalida = 0;
      #calicont#4  = #camanctl#8;
      #calicont#5  = #camanctl#9;
      |GRABA 020#calicont.a;
   |SINO;
      #calicont#0 = #camanctl#0;
      #calicont#1 = #camanctl#1;
      #calicont#2 = #camanctl#2;
      #calicont#3 = #camanctl#3;
      #calicont#4  = #camanctl#8;
      #calicont#5  = #camanctl#9;
      |GRABA 020#calicont.n;
   |FINSI;
   |LIBERA #calicont;
|FPRC;

|DEFBUCLE VuelcaTempo;
  #camanctl#1;
  ;
  #camanctc#0,#camanctc#1,#camanctc#2,0001;
  #camanctc#0,#camanctc#1,#camanctc#2,9999;
  ;
  NULL,VuelcaTempo;
|FIN;

|PROCESO inf1;
   #calisasi#0 = 00;
   #calisasi#1 = "01.01.1900";
   #calisasi#2 = 000001;
|FPRC;

|PROCESO sup1;
   #calisasi#0 = 99;
   #calisasi#1 = "31.12.2999";
   #calisasi#2 = 999999;
   FSalida = 1;
|FPRC;

|PROCESO Lista;
   |SI FSalida = 9;
      |DELINDEX #calisasi;
      |ABRE #calisasi;
      |PUSHV 0501 2380;
      |CUADRO 10291351;
      |PINTA 1130, "                    ";
      |PINTA 1230, "                    ";
      |LEE 010#camaasic.u;
      FechaTrabajo = #camaasic#1;
      LimiteDias = FechaTrabajo;
      |BUCLE TomaAsientos;
      |PINPA #0#5;
     ||PINDA #0#5;
      FSalida = 1;
      |ENTLINEAL #1#calisasi,3,4,20,1,inf1,sup1;
      #camanctc#0 = #calisasi#0;
      #camanctc#1 = #calisasi#1;
      #camanctc#2 = #calisasi#2;
      |POPV;
      |PINTA #camanctc#0;
      |PINTA #camanctc#1;
      |PINTA #camanctc#2;
      |SI Campo = 2; |PTEC 802; |FINSI;
      |SI Campo = 1; |PTEC 802; |PTEC 802; |FINSI;
      |CIERRA #calisasi;
   |FINSI;
|FPRC;

|PROCESO Cuenta; |TIPO 6;
      Comodin = #0#Campo#;
      Comodin = Comodin - ".";
      |SI FSalida ! 0;
         Parte1 = (FSalida / 100) ! 0;
         Parte2 = (Parte1 * 100) + 199;
         Parte1 = Parte1 + 99;
         Comodin = #0#Campo#;
         Part1 = Comodin % Parte1;
         |QBF Part1;
         Part2 = Comodin % Parte2;
         |QBF Part2;
         Comodin = Part1 % 0;
         ComodNum = Comodin;
         Comodin = Part2 % 0;
         ComodNum = ComodNum + Comodin;
         ComodNum = MaxDig - ComodNum;
         Comodin = "0" * ComodNum;
         Comodin = Part1 + Comodin + Part2;
         #0#Campo# = Comodin;
         #0#9 = Nivel;
         |PINTA #0#Campo#;
      |FINSI;
|FPRC;

|RUTINA inf;
   #camanctl#0 = #camanctc#0;
   #camanctl#1 = #camanctc#1;
   #camanctl#2 = #camanctc#2;
   #camanctl#3 = 1;
|FRUT;

|RUTINA sup;
   #camanctl#0 = #camanctc#0;
   #camanctl#1 = #camanctc#1;
   #camanctl#2 = #camanctc#2;
   #camanctl#3 = 9999;
|FRUT;

|PROGRAMA;
   |HAZ inicio;
   |CLS;

   |SI dig4 ! 0; MaxDig = #48#14; Nivel = 1; |FINSI;
   |SI dig5 ! 0; MaxDig = #48#15; Nivel = 2; |FINSI;
   |SI dig6 ! 0; MaxDig = #48#16; Nivel = 3; |FINSI;
   |SI dig7 ! 0; MaxDig = #48#17; Nivel = 4; |FINSI;
   |SI dig8 ! 0; MaxDig = #48#18; Nivel = 5; |FINSI;
   |SI dig9 ! 0; MaxDig = #48#19; Nivel = 6; |FINSI;

   |CABEZA "Edicion de contrapartidas";
   |PINPA #0#1;
   |PINDA #0#1;

   |DELINDEX #camanctl;
   |DELINDEX #calisasi;

   |ABRE #calicont;
   |ABRE #camanctl;
   |ABRE #camaasil;
   |ABRE #camaasic;

   FSalida = 1;
   |PARA; |SI FSalida ! 0; |HACIENDO;
      |ENDATOS #1#1;
      FEstado = FSalida;
      |SI FEstado ! 0; |SAL; |FINSI;

      #camaasic#0 = #camanctc#0;
      #camaasic#1 = #camanctc#1;
      #camaasic#2 = #camanctc#2;
      |LEE 010#camaasic.=;
      FEstado = FSalida;
   |SIGUE;

   |SI FEstado ! 0; |ACABA; |FINSI;
   |CIERRA #camaasic;

   |BUCLE RellenaTempo;
   |CIERRA #camanctl;

   |ENTLINEAL #1#0,4,1,20,1,inf,sup;

   |ATRI R;
   |CONFI "0400N¨ Volcar cambios ?";
   FEstado = FSalida;
   |ATRI N;
   |SI FEstado = 0;
      |BUCLE VuelcaTempo;
   |FINSI;

   |CIERRA #calicont;
   |CIERRA #camaasil;

|FPRO;
