|FICHEROS;
  c3geinvx #0;
  camoauxl #1;
  camoauxc #2;
  cacuenta #3;
  catraaux #4;
  canempre #30;
|FIN;

|VARIABLES;
   informe = "";
    &pagina = 0;
    sw_pagina = 0;
    error1 = "0000Nivel repetido";
    error2 = "0000No existe informe";
    error3 = "0000El numero de nivel no coincide con el numero de nivel de la empresa";
    error4 = "0000El numero de nivel coincide con el nivel de las cuentas de trabajo";
    men2  = "     Longitud de Cuenta Fuera de Nivel ";

    sw = 0;
    para1 = 0;
    nume1 = 0;
    alfa1 = "";
    alfa2 = "";
    long = "  ";
    cta  = 0;
    num   = 0;
    swdig = 0;
    digito = 0;

   nivel = 0;
   menor = 0;

   cue_ac = "";
   dig_ac = 0;

   &a_cuen = "";
   &a_digi = 0;
   &a_desc = "";
   &a_busc = "";
   &a_impo = 0;
   &total  = 0;
   &swlinea = 0;
   &descri = "";

   salida = 0;
   descue = "";
   hascue = "";
   swgraba = 0;
   swalgun = 0;
  &r_emp = 0;
  &r_per = 0;
  x = 0;
  varcamp = 0;
  empcon = 0;
  ejecon = 0;
  leidos = 0;
  dirfich0 = "";
  emp1 = 0;
  per1 = 0;
  xx = 0;
  yy = 0;
  desde = 0;
  hasta = 0;
  y = 0;
  sw_error = 0;
  traba = "";
  men9 = "     Empresa Contable INACTIVA ";
|FIN;

|INCLUYE acceso_i;
|INCLUYE puntos_i;
|INCLUYE tempo_i;

|| ***********************************************************************

|PROCESO &c_pagina;
  |SI sw_pagina = 0;
      pagina =  1;
      sw_pagina = 1;
  |SINO;
      pagina = pagina + 1;
  |FINSI;
|FPRC;

|| ***********************************************************************
||                       CALCULOS DE PANTALLA
|| ***********************************************************************

|PROCESO numnivel;|TIPO 0;
  |SI #0Campo ] #30#13;
      |MENAV error3;
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO nivel;|TIPO 7;  || PROCESO para hacer no modificable

 |CAMPO_MODIFICA #0Campo, 1,"S";
 |SI Campo = 6; |Y #0#4 < 2; || Si solo hemos seleccionado
     #0Campo = 0; |PINTA #0Campo;
     |CAMPO_MODIFICA #0Campo, 1,"N";
 |FINSI;
 |SI Campo = 7; |Y #0#4 < 3; || Si solo hemos seleccionado
     #0Campo = 0; |PINTA #0Campo;
     |CAMPO_MODIFICA #0Campo, 1,"N";
 |FINSI;
 |SI Campo = 8; |Y #0#4 < 4; || Si solo hemos seleccionado
     #0Campo = 0; |PINTA #0Campo;
     |CAMPO_MODIFICA #0Campo, 1,"N";
 |FINSI;
 |SI Campo = 9; |Y #0#4 < 5; || Si solo hemos seleccionado
     #0Campo = 0; |PINTA #0Campo;
     |CAMPO_MODIFICA #0Campo, 1,"N";
 |FINSI;
 |SI Campo = 10; |Y #0#4 < 6; || Si solo hemos seleccionado
    #0Campo = 0; |PINTA #0Campo;
    |CAMPO_MODIFICA #0Campo, 1,"N";
 |FINSI;
|FPRC;

|PROCESO nivelrep;|TIPO 0;  || Para comprobar que no repetimos los niveles

 |SI #0Campo ! 0; |Y #0Campo ] #30#13;
      |MENAV error4;
      |ERROR;
      |ACABA;
 |FINSI;

 |SI nivel = 0;        || Buscamo el nivel mas alto;
     nivel = #0#5;
 |FINSI;

 |SI Campo = 6;
    |SI #0#6 = #0#5;|Y #0#6 ! 0;    || Si hay dos niveles iguales error
      |MENAV error1;
      |ERROR;
      |ACABA;
   |SINO;
       |SI #0#6 > #0#5;  || Busca el nivel mas alto
           nivel = #0#6;
       |SINO;
           nivel = #0#5;
       |FINSI;
   |FINSI;
|FINSI;

|SI Campo = 7; |Y #0#7 ! 0;
    |SI #0#7 = #0#5; |O #0#7 = #0#6; || Si hay dos niveles iguales error
       |MENAV error1;
       |ERROR;
       |ACABA;
    |FINSI;

    |SI #0#7 > nivel;  || Busca el nivel mas alto
        nivel = #0#7;
    |FINSI;
|FINSI;

|SI Campo = 8; |Y #0#8 ! 0;      || Si hay dos niveles iguales error
    |SI #0#8 = #0#5; |O #0#8 = #0#6; |O #0#8 = #0#7;
       |MENAV error1;
       |ERROR;
       |ACABA;
    |FINSI;

    |SI #0#8 > nivel;  || Busca el nivel mas alto
        nivel = #0#8;
    |FINSI;
|FINSI;

|SI Campo = 9; |Y #0#9 ! 0;     || Si hay dos niveles iguales error
    |SI #0#9 = #0#5; |O #0#9 = #0#6; |O #0#9 = #0#7; |O #0#9 = #0#8;
       |MENAV error1;
       |ERROR;
       |ACABA;
    |FINSI;

    |SI #0#9 > nivel;  || Busca el nivel mas alto
        nivel = #0#9;
    |FINSI;
|FINSI;

|SI Campo = 10; |Y #0#10 ! 0;    || Si hay dos niveles iguales error
    |SI #0#10 = #0#5; |O #0#10 = #0#6; |O #0#10 = #0#7; |O #0#10 = #0#8; |O #0#10 = #0#9;
       |MENAV error1;
       |ERROR;
       |ACABA;
    |FINSI;

    |SI #0#10 > nivel;  || Busca el nivel mas alto
        nivel = #0#10;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 6;
    p_alfa1 = #0Campo;
    salidas = FSalida;
|HAZ punto;
|SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
|SI #0Campo = "            ";  |ERROR;  |ACABA;  |FINSI;
    digito = Campo + 2;
    cta  = #0Campo;
    long = cta % 0;
    swdig = 0;
|SI long = #30#14; swdig = 1; #0digito = 1; |FINSI;
|SI long = #30#15; swdig = 1; #0digito = 2; |FINSI;
|SI long = #30#16; swdig = 1; #0digito = 3; |FINSI;
|SI long = #30#17; swdig = 1; #0digito = 4; |FINSI;
|SI long = #30#18; swdig = 1; #0digito = 5; |FINSI;
|SI long = #30#19; swdig = 1; #0digito = 6; |FINSI;
|SI swdig = 0;
    |MENAV men2;
    |ERROR;
|FINSI;
|FPRC;

|PROCESO consulta;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SUB_EJECUTA "caconemp.run";
  |ERROR;
  |SI Campo = 18;
      #0#18 = r_emp;
      #0#20 = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
  |SI Campo = 19;
      #0#19 = r_emp;
      #0#21 = r_per;
      |PTEC 802;
  |FINSI;
  |SI Campo ] 22;
      #0Campo = r_emp;
      varcamp = Campo + 20;
      #0varcamp = r_per;
      |PTEC 802;
      |PTEC 802;
  |FINSI;
|FPRC;

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;

|PROCESO mayor1;
  |HAZ mayor;
  |SI #0Campo = "N";
      |PARA x = 22;  |SI x [ 61;  |HACIENDO x = x + 1;
            |CAMPO_MODIFICA #0x,1,"S";
      |SIGUE;
      #0#18  = 0;
      #0#20 = 0;
      #0#19  = 0;
      #0#21 = 0;
      |CAMPO_MODIFICA #0#18,1,"N";
      |CAMPO_MODIFICA #0#20,1,"N";
      |CAMPO_MODIFICA #0#19,1,"N";
      |CAMPO_MODIFICA #0#21,1,"N";
      |PINTA #0#18;
      |PINTA #0#20;
      |PINTA #0#19;
      |PINTA #0#21;
  |SINO;
      |PARA x = 22;  |SI x [ 61;  |HACIENDO x = x + 1;
            #0x = 0;
            |CAMPO_MODIFICA #0x,1,"N";
      |SIGUE;
      |CAMPO_MODIFICA #0#18,1,"S";
      |CAMPO_MODIFICA #0#20,1,"S";
      |CAMPO_MODIFICA #0#19,1,"S";
      |CAMPO_MODIFICA #0#21,1,"S";
  |FINSI;
|FPRC;

|| --------------- comprueba desde-hasta empresas ---------------------------

|PROCESO buscaem1;
  |SI #30#21 = "I"; |ACABA; |FINSI;
  |HAZ caldigitos;
  |SI sw_error = 1;
      alfa1 = #30#2;
      alfa2 = #30#3;
      traba = "      Empresa: " + alfa1 + " " + alfa2;
      |ACABA;
  |FINSI;
  leidos = 1;
  alfa1 = #30#2;
  alfa2 = #30#3;
|FPRC;

|DEFBUCLE buscaempre;
#30#1;
;
#0#18,desde;
#0#19,hasta;
e;
NULL,buscaem1;
|FIN;

|PROCESO buclempre;
  |SI #0#20 > #0#21;
      |MENAV "     ERROR EN INTRODUCCION";
      |ERROR;
      |ACABA;
  |FINSI;
  |SI #0#18 = 0;  |Y #0#19 = 0;  |ACABA;  |FINSI;
  desde = #0#20;
  hasta = #0#21;
  sw_error = 0;
  leidos = 0;
  |BUCLE buscaempre;
  |SI leidos = 0;
      |MENAV "    ATENCION SELECCION VACIA";
      |ERROR;
      |ACABA;
  |FINSI;
|FPRC;

|PROCESO deshas;
  |SI #0#19 < #0#18;
      |MENAV "      Error en Introduccion";
      |ERROR;
  |FINSI;
|FPRC;

|| ------------------------------------------------------------------------

|PROCESO nomodi;
  |PARA x = Campo + 1;  |SI x [ 41;  |HACIENDO x = x + 1;
        #0x = 0;
        |CAMPO_MODIFICA #0x,1,"N";
        y = x + 20;
        #0y = 0;
        |CAMPO_MODIFICA #0y,1,"N";
  |SIGUE;
  y = Campo + 20;
  #0y = 0;
  |CAMPO_MODIFICA #0y,1,"N";
  |PINTA #0y;
|FPRC;

|PROCESO esbuena; || desde campo de empresas seleccion
  |SI FSalida = 2; |ACABA; |FINSI;
  |SI #0Campo = 0; |HAZ nomodi;  |ACABA;  |FINSI;
  |ABRE #30;
  #30#2 = #0Campo;
  #30#3 = 0;
  |LEE 011#30];
  |SI FSalida ! 0;  |O #30#2 ! #0Campo;
      |MENAV "     NO Existe la empresa Contable ";
      |ERROR;
  |FINSI;
  |CIERRA #30;
|FPRC;

|PROCESO esbuena1;
  |SI FSalida = 2;|ACABA;|FINSI;
  x = Campo - 20;
  |SI #0x = 0;  |ACABA;  |FINSI;
  |ABRE #30;
  x = Campo - 20;
  #30#2 = #0x;
  #30#3 = #0Campo;
  |LEE 011#30=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la empresa Contable";
      |CIERRA #30;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #30;
  |SI #30#21 = "I";
      |MENAV men9;
      |ERROR;
      |ACABA;
  |FINSI;
  sw_error = 0;
  |HAZ caldigitos;
  |SI sw_error = 1;
      sw_error = 0;
      |MENAV "      NO SE CORRESPONDEN LOS NIVELES:";
      |ERROR;
      |ACABA;
  |FINSI;
  x = Campo + 20;
  #0x = #30#1;
  |PINTA #0x;
  sw_error = 0;
  x = Campo - 20;
  alfa1 = #0x;
  alfa2 = #0Campo;
|FPRC;

|PROCESO caldigitos;
  |SI #30#13 < #0#05;  sw_error = 1;  |ACABA;  |FINSI;
  |SI #30#13 < #0#06;  sw_error = 1;  |ACABA;  |FINSI;
  |SI #30#13 < #0#07;  sw_error = 1;  |ACABA;  |FINSI;
  |SI #30#13 < #0#08;  sw_error = 1;  |ACABA;  |FINSI;
  |SI #30#13 < #0#09;  sw_error = 1;  |ACABA;  |FINSI;
|FPRC;

|| **********************************************************************
||                       CALCULOS DE IMPRESION
|| **********************************************************************

|PROCESO lee_cue;
 swgraba = 0;
 |SI #3#0 = #2#0; |Y #3#1 = #2#1; |ACABA; |FINSI;

 |SI #3#1 ! 0;
     |SI #3#1 = #0#5;|O #3#1 = #0#6;|O #3#1 = #0#7;
         swgraba = 1;
     |SINO;
         |SI #3#1 = #0#8;|O #3#1 = #0#9;|O #3#1 = #0#10;
             swgraba = 1;
         |FINSI;
     |FINSI;
 |FINSI;
 |SI swgraba = 1;
     cue_ac = #2#0; dig_ac = #3#1;
     |HAZ acortacuen;
     |SI #3#0 = cue_ac;
         a_cuen = #3#0;
         a_digi = #3#1;
         a_desc = #3#2;
         a_busc = "N";
        |HAZ graba_reg;
    |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE cainvaux1;
 #3#1;
 ;
 descue, menor;
 hascue, nivel;
 e;
 NULL, lee_cue;
|FIN;

|PROCESO lee_aux;
   a_cuen = #2#0;
   a_digi = #2#1;
   a_desc = #2#2;
   a_busc = "S";
   a_impo = #2#3;
   |HAZ graba_reg;
|| .............. Cuenta desde
   cue_ac = #2#0; dig_ac = menor; |HAZ acortacuen;
   descue = cue_ac;
   cue_ac = #2#0; dig_ac = nivel; |HAZ acortacuen;
   hascue = cue_ac;

   |BUCLE cainvaux1;
|FPRC;

|PROCESO acortacuen;
    |SI dig_ac = 1;  nume1 = #30#14;  |FINSI;
    |SI dig_ac = 2;  nume1 = #30#15;  |FINSI;   || construye el hasta segun
    |SI dig_ac = 3;  nume1 = #30#16;  |FINSI;   ||/el nivel mas bajo elegido
    |SI dig_ac = 4;  nume1 = #30#17;  |FINSI;
    |SI dig_ac = 5;  nume1 = #30#18;  |FINSI;
    |SI dig_ac = 6;  nume1 = #30#19;  |FINSI;
    nume1 = 100 + nume1;
    cue_ac = cue_ac % nume1;
    cue_ac = cue_ac + "            ";
    cue_ac = cue_ac % 112;
|FPRC;

|PROCESO graba_reg;
  #4#0 = a_cuen;
  #4#1 = a_digi;
  |LEE 101#4=;
  salida = FSalida;
  |SI salida ! 0;
      |DDEFECTO #4;
      #4#0 = a_cuen;
      #4#1 = a_digi;
  |FINSI;
  #4#2 = a_desc;
  #4#3 = a_busc;
  #4#4 = #4#4 + a_impo;
  |SI salida = 0; |GRABA 020#4a; |FINSI;
  |SI salida ! 0; |GRABA 020#4n; |FINSI;
  |LIBERA #4;
|FPRC;

|DEFBUCLE cainvaux0;
 #2#1;
 ;
 #0#0, 1;
 #0#1, 6;
 e;
 NULL, lee_aux;
|FIN;

|PROCESO implineas;
 swalgun = 1;
 swlinea = 2;
 |PRINT;
|FPRC;

|PROCESO imprimir;
  sw = 1;
  a_cuen = #4#0;
  a_digi = #4#1;
  a_desc = #4#2;
  a_impo = #4#4;
  |HAZ descripcion;
  |SI #4#3 = "S";
      swalgun = 0;
      #2#0 = #4#0;
      #2#1 = #4#1;
      |LEE 000#2=;
      |SI FSalida = 0;
          |BUCLELIN 2implineas#2;
      |FINSI;
      swlinea = 1;
      |SI swalgun = 1; swlinea = 3; |FINSI;
      total = total + #4#4;
  |SINO;
      a_impo = 0;
      swlinea = 1;
      |SI #4#1 = menor; swlinea = 0; |FINSI;
  |FINSI;
  |PRINT;
|FPRC;

|DEFBUCLE cainvaux2;
 #4#1;
 ;
 "            ", 1;
 "zzzzzzzzzzzz", 6;
 e;
 NULL, imprimir;
|FIN;

|PROCESO descripcion;
    descri = "";
    |SI a_digi = 1;  nume1 = #30#14; alfa2 = ""; |FINSI;
    |SI a_digi = 2;  nume1 = #30#15; alfa2 = "  "; |FINSI;   || construye el hasta segun
    |SI a_digi = 3;  nume1 = #30#16; alfa2 = "    "; |FINSI;   ||/el nivel mas bajo elegido
    |SI a_digi = 4;  nume1 = #30#17; alfa2 = "      "; |FINSI;
    |SI a_digi = 5;  nume1 = #30#18; alfa2 = "        "; |FINSI;
    |SI a_digi = 6;  nume1 = #30#19; alfa2 = "          "; |FINSI;
    nume1 = 100 + nume1;
    descri = a_cuen % nume1;
    descri = alfa2 + descri + "  ";
    descri = descri + a_desc;
|FPRC;
|| ---------- Seleccion DESDE / HASTA Empresa.

|PROCESO esdesd1;
  |DBASE dir_fich;
  dirfich0 = dir_fich + "fich/";
  alfa1 = #30#2;
  alfa2 = #30#3;
  emp1 = #30#2;
  per1 = #30#3;
  alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
  alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
  dirfich0 = dirfich0 + alfa1 + alfa2 + "/";

  |SI #30#21 = "I"; |ACABA; |FINSI;
  |HAZ caldigitos;
  |SI sw_error = 0;
      |HAZ haztodo;
  |FINSI;
|FPRC;

|DEFBUCLE esdesde;
#30#1;
;
#0#18,#0#20;
#0#19,#0#21;
e;
NULL,esdesd1;
|FIN;

|| ---------- Seleccion en parrilla.

|PROCESO esunaauna;
  |PARA xx = 22;  |SI xx [ 41;  |HACIENDO xx = xx + 1;
        |SI #0xx = 0;  |SAL;  |FINSI;
        |DBASE dir_fich;
        dirfich0 = dir_fich + "fich/";
        yy = xx + 20;
        emp1 = #0xx;
        per1 = #0yy;
        alfa1 = #0xx;
        alfa2 = #0yy;
        alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
        alfa2 = "0"   + alfa2;   alfa2 = alfa2 % -101;
        dirfich0 = dirfich0 + alfa1 + alfa2 + "/";
|| lee empresa
        |ABRE #30;
        #30#2 = emp1;
        #30#3 = per1;
        |LEE 011#30=;
        |CIERRA #30;
        |HAZ haztodo;
  |SIGUE;
|FPRC;
|| ***********************************************************************
|| ***************** PROCESO PRINCIPAL CON TIPO 3 ************************
|| ***********************************************************************

|PROCESO impre; |TIPO 3;

 |IMPRE 0;
 |SI FSalida ! 0; |ACABA; |FINSI;

 |HAZ elmenor;
 |HAZ nom_usu;
 alfa1 = "v" + nom_tmp;
 |NOME_DAT #4 alfa1;
 |ABRE #4;
 |CIERRA #4;
 |DELINDEX #4;

 informe = "c3geinvx";
 |SI  #0#82 = "S"; informe = "c3geinv2"; |FINSI;
 |INFOR informe;
 |SI FSalida ! 0;
     |MENAV error2;
     |FINIMP;
     |ACABA;
 |FINSI;

  |SI #0#17 = "S";
      |BUCLE esdesde;
  |SINO;
      |HAZ esunaauna;
  |FINSI;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO haztodo;
  enEmpresa = #canempre#2;
  enPeriodo = #canempre#3;
  swOperacion = 0
  |SUB_EJECUTA "camoneda.tab";

 |PATH_DAT #1 dirfich0;
 |PATH_DAT #2 dirfich0;
 |PATH_DAT #3 dirfich0;

 |ABRET #2;
 |ABRET #3;
 |ABRE #4;
 |BUCLE cainvaux0;
 |CIERRA #4;
 |CIERRAT #3;

 sw = 0;
 |BUCLE cainvaux2;
 |SI sw = 1; |PIEINF; |FINSI;

 |CIERRAT #2;
 |DELINDEX #4;
 sw_pagina = 0;
 total = 0;
|FPRC;

|PROCESO elmenor;
    menor = -1;
|PARA para1 = 5; |SI para1 [ 10; |HACIENDO para1 = para1 + 1;
    |SI #0para1 ! 0;
        |SI menor = -1;  menor = #0para1;  |FINSI;
        |SI menor > #0para1;  menor = #0para1;  |FINSI;
    |FINSI;                   || saca el nivel elegido mas peque¤o
|SIGUE;
|FPRC;
