|FICHEROS;
  cared003 #0;
|FIN;

|VARIABLES;

  &aparam   = "";
  &programa = "";
  &ficcopia = "";

  ficsecu   = "";
  aOrigen   = "";
  aNombre   = "";
  aNombr1   = "";
  aDestino  = "";

     aPath     = "";
     aCopia    = "";
     aFichero  = "";
     aTecla    = "";
     aIPRemoto = "";

  ip        = "";

  aAlfa     = "";
  aAlfa1    = "";
  aAlfa2    = "";
  aAlfa3    = "";
  nCanal    = 0;
  Existe    = 0;
  nInkey    = 0;

  &eaUnidadBasico = "";

|FIN;

|INCLUYE acceso_i;


|CALCULO PonBarra; |TIPO 0;
     |C_M #0Campo, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     nInkey = FSalida;
     |SI nInkey = 10;
         aAlfa1 = "D c:\";
         |BROWSE aAlfa1;
         aAlfa1 = aAlfa1 % 280;
         #0Campo = aAlfa1;
         |PINTA #0Campo
    |FINSI;

    aAlfa1 = #0Campo; |QBF aAlfa1;
    |SI aAlfa1 = ""; |ERROR; |ACABA; |FINSI;

    aAlfa2 = aAlfa1 % -101;
    |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
         #0Campo = aAlfa1 + "/";
         |PINTA #0Campo;
    |FINSI;
    |PINTA #0Campo;

    Existe = 0;
    aAlfa1 = #0Campo; |QBF aAlfa1;
    aAlfa1 = aAlfa1 + "prova.txt";

    |XABRE "WB", aAlfa1, nCanal;
    |SI FSalida < 0;
        |XABRE "CWB", aAlfa1, nCanal;
    |FINSI;
    |XGRABA nCanal, aAlfa1;
    |SI FSalida < 0; Existe = 1; |FINSI;
    |XCIERRA nCanal;
    |SI Existe = 0; |RFBORRA aAlfa1; |FINSI;

    |SI Existe = 1;
         |MENAV "    No existe directorio. ";
         |ERROR;
    |FINSI;
|FCAL;

|PROCESO LaUnidad;
 |SI #0#0 ! "A"; |Y #0#0 ! "B";
     |C_M #0#3, 1, "S";
     |C_V #0#3, 1, "S";
     |PINTA #0#3;
 |SINO;
     |C_M #0#3, 1, "N";
     |C_V #0#3, 1, "N";
     |PINTA 1222, "                                   ";
 |FINSI;
|FPRC;

|PROGRAMA;

    |HAZ LeeUnidadBasico;

    |ABRE #0;
    |LEE 101#0p;
    |SI FSalida ! 0;
        |DDEFECTO #0;
        |GRABA 020#0b;
    |FINSI;

    |CLS;
    |PINPA #0#0;
    |CABEZA "Grabar Diskette";
    |PINDA #0#0;

    |SI programa = "";
        aparam = PARAMETRO; |QBT aparam;
        aparam = aparam > " ";
        aparam = " " + aparam + " ";
        programa = aparam;
    |FINSI;

    |SI programa = " REMESAS ";        aAlfa = &176 * 9;  ficsecu = "casecrec.seq"; |FINSI;
    |SI programa = " CONFIRMES ";      aAlfa = &176 * 11; ficsecu = "casecmin.seq"; |FINSI ;
    |SI programa = " TRANSFERENCIAS "; aAlfa = &176 * 16; ficsecu = "casectra.seq"; |FINSI;
    |SI programa = " REMESA N19 ";     aAlfa = &176 * 9;  ficsecu = "agifarec.seq"; |FINSI;
    |SI programa = " REMESA N32 ";     aAlfa = &176 * 9;  ficsecu = "agifarec.seq"; |FINSI;
    |SI programa = " PAGARES ";        aAlfa = &176 * 9;  ficsecu = "casecpag.seq"; |FINSI;
    |SI programa = " C.T "; programa = " CONF. O TRANSF "; aAlfa = &176 * 16; ficsecu = "casec   .seq"; |FINSI;

    |ATRI R;
    |PINTA 0944, programa;
    |ATRI 0;

    |SI ficcopia = "";
        |SI programa = " CONFIRMES ";
            ficcopia = "  REMCLI";
            #0#2 = ficcopia;
        |FINSI;
        |SI programa = " TRANSFERENCIAS ";
            ficcopia = "transfer";
            #0#2 = ficcopia;
        |FINSI;
    |SINO;
         #0#2 = ficcopia;
    |FINSI;

    |PINDA #0#0;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |GRABA 020#0a;
        aNombr1 = ficsecu; |QBF aNombr1;
        aNombre = #0#2;    |QBF aNombre;
        |SI aNombr1 = ""; aNombr1 = aNombre; |FINSI;
        aFichero = aNombre;
        |DFICE  aPath;
        |HAZ GrabaDiskette;
  |FINSI;
  |LIBERA #0;
  |CIERRA #0;

|FPRO;

|PROCESO GrabaDiskette;

   |PUSHV 0501 2380;
   |BLANCO 0814 1465;
   |CUADRO 0914 1365;

   |SI #0#0 = "A"; |O #0#0 = "B";
      |PINTA 1015, "      Introduzca un disquete en su PC             ";
      |PINTA 1115, "               y pulse una tecla                  ";
      |PAUSA;
   |FINSI;

   |DFICE  aPath;

   |ATRI P; |ATRI R; |PINTA 2470," Copiando "; |ATRI 0;

   aAlfa = eaUnidadBasico + "/MODELOS";                      |RMKDIR aAlfa;
   aAlfa = eaUnidadBasico + "/MODELOS/DISKETTE";             |RMKDIR aAlfa;
   aAlfa = eaUnidadBasico + "/MODELOS/DISKETTE/";
   |R_PDIR aAlfa;
   |PARA; |SI FSalida = 0; |HACIENDO;
          |RFBORRA aAlfa;
          |R_SDIR aAlfa;
   |SIGUE;

   aAlfa = eaUnidadBasico + "/MODELOS/DISKETTE/";
   aOrigen  = aPath + aNombr1;
   aDestino = aAlfa + aNombre; |QBT aDestino;

   aIPRemoto = "";
   |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
   |SI aIPRemoto ! "";
       |ENVIA_FICHERO aOrigen, aDestino;
   |SINO;
       |COPIA_FICHERO aOrigen, aDestino;
   |FINSI;

   |SI #0#0 = "A"; |O #0#0 = "B";
        aCopia   = "COPY " + aDestino + " " + #0#0 + ":" + aFichero;
        aAlfa3 = "    El Disquette se copio sastisfactoriamente.";
   |SINO;
        aAlfa1 = #0#3; |QBF aAlfa1;
        aCopia   = "COPY " + aDestino + " " + aAlfa1 + aFichero;
        aAlfa3 = "    El fichero se copio sastisfactoriamente en el directorio elegido.";
   |FINSI;
   |RSYSTEM aCopia;

   |MENAV aAlfa3;
   |POPV;
|FPRC;
