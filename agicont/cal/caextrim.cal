|FICHEROS;
    caextrim #0;
    camaasil #1;
    camaasic #2;
    cacuenta #3;
    caivarep #4;
    caclipro #5;
    camanban #6;
    caivasop #7;
    calicont #31;

    caw00022 #999;
    ca8m0003 #403;
|FIN;

|VARIABLES;
    &ext1 = "";

    nCampo   = 0;
    aAlfa1   = "";
    aAlfa2   = "";
    &entrada = 1;
    &eaDesPac  = "";
    mesnum = 0;
    columna = 0;
    sw_con = 0;          || 1 = EL CONCEPTO ES BUENO
    x = 0;
    sw_saldo = 0;        || 1 = EL SALDO DE LA CUENTA ES CERO
    t_debe = 0;
    t_haber = 0;
    t_saldo = 0;
    campo = 0;
    d = 0;
    h = 0;
    sw_print = 0;        || 1 = NO DEBO ESCRIBIR
    sw_prim = 0;         || 0 = PRIMERA VEZ
    mesh = "";
    diah = "";
    anyoh = "";
    &cuenta = "";
    cuen = "";
    xxxxfiac = "  ";
    xxaponer = "  ";
    xrelleno = "                              ";
    fecalf = "";
    mensa1 = "    ERROR ESTA FECHA NO CORRESPONDE AL EJERCICIO";
    traba1 = "";
    varalf = "";
    &swant = 0;
    &s_debe = 0;
    &s_haber = 0;
    &s_saldo = 0;
    &debe = 0;
    &haber = 0;
    &direc = "";
    &codpos = "";
    &pobla = "";
    &provi = "";
    &cif = "";
    &telef = "";
    &contra = "";
    contra_d = "";
    contra_h = "";
    swex_con = 0;
    informe = "";
    men2  = "     Longitud de Cuenta Fuera de Nivel !";
    long = "  ";
    cta  = 0;
    num   = 0;
    swdig = 0;
    digito = 0;
    &sw_inf = 0;
    &sw_cab = 0;
    &y = 0;
    xy = 0;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    sw_pagina = 0;
    &pagina = 0;
    sw_cuen = 0;          ||1 = Hemos Leido la cuenta
    swtotal = 0;

    &nSwPagDup = 0;
    &nPagDup = 0;

    nCont = 0;

    nEjerCam = 0;
    nEjer    = 0;
    nPeriodo = 0;
    aFichero = "";
    dirfich0 = "";
    dirfichO = "";
    aPath08  = "";
    nCambio  = 0;
    aCta08   = "";
    aCta90   = "";
    nSwOp    = 0;
    nume1    = 0;
    nHay     = 0;
    aDCuenta = "";
    aHCuenta = "";
|FIN;

|INCLUYE acceso_i;
|INCLUYE varnue_i;
|INCLUYE puntos_i;
|INCLUYE condes_i;

|| *********************************************************************
||                             COMIENZO
|| *********************************************************************
|PROCESO recoge;
   #0#2 = fec1;
   |SI #0#74 = "S"; #0#2 = "01.01.2000"; |FINSI;
   |PINTA #0#2;
   #0#3 = fec2; |PINTA #0#3;
|FPRC;


|PROCESO &c_pagina;
  |SI sw_pagina = 0;
      pagina = #0#38;
      sw_pagina = 1;

      nPagDup = #0#38;
      nSwPagDup = 1;
  |SINO;
      pagina = pagina + 1;

      |HAZ PDuplex;
  |FINSI;
  sw_cab = 1;
|FPRC;

|PROCESO seleccio; |TIPO 0;
|SI #0#4 = "N";
    |C_M #0#05, 1, "S"; |C_M #0#06, 1, "S";
    |C_M #0#07, 1, "S"; |C_M #0#08, 1, "S";
    |C_M #0#09, 1, "S"; |C_M #0#10, 1, "S";
    |C_M #0#11, 1, "S"; |C_M #0#12, 1, "S";
    |C_M #0#13, 1, "S"; |C_M #0#14, 1, "S";
    |C_M #0#15, 1, "S"; |C_M #0#16, 1, "S";
    |C_M #0#17, 1, "S"; |C_M #0#18, 1, "S";
    |C_M #0#19, 1, "S"; |C_M #0#20, 1, "S";
    |C_M #0#21, 1, "S"; |C_M #0#22, 1, "S";
    |C_M #0#23, 1, "S"; |C_M #0#24, 1, "S";
    |C_M #0#25, 1, "S"; |C_M #0#26, 1, "S";
    |C_M #0#27, 1, "S"; |C_M #0#28, 1, "S";
    |C_M #0#33, 1, "N"; |C_M #0#34, 1, "N";
        #0#33 = 1;       |PINTA #0#33;
        #0#34 = 999;     |PINTA #0#34;
|SINO;
    |C_M #0#05, 1, "N"; |C_M #0#06, 1, "N";
    |C_M #0#07, 1, "N"; |C_M #0#08, 1, "N";
    |C_M #0#09, 1, "N"; |C_M #0#10, 1, "N";
    |C_M #0#11, 1, "N"; |C_M #0#12, 1, "N";
    |C_M #0#13, 1, "N"; |C_M #0#14, 1, "N";
    |C_M #0#15, 1, "N"; |C_M #0#16, 1, "N";
    |C_M #0#17, 1, "N"; |C_M #0#18, 1, "N";
    |C_M #0#19, 1, "N"; |C_M #0#20, 1, "N";
    |C_M #0#21, 1, "N"; |C_M #0#22, 1, "N";
    |C_M #0#23, 1, "N"; |C_M #0#24, 1, "N";
    |C_M #0#25, 1, "N"; |C_M #0#26, 1, "N";
    |C_M #0#27, 1, "N"; |C_M #0#28, 1, "N";
    |C_M #0#33, 1, "S"; |C_M #0#34, 1, "S";
|FINSI;
|FPRC;

|PROCESO seleccio2; |TIPO 0;
|SI ext1 ! ""; |ACABA; |FINSI;
|SI #0#41 = "N";
    |C_M #0#42, 1, "S"; |C_M #0#43, 1, "S";
    |C_M #0#44, 1, "S"; |C_M #0#45, 1, "S";
    |C_M #0#46, 1, "S"; |C_M #0#47, 1, "S";
    |C_M #0#48, 1, "S"; |C_M #0#49, 1, "S";
    |C_M #0#50, 1, "S"; |C_M #0#51, 1, "S";
    |C_M #0#52, 1, "S"; |C_M #0#53, 1, "S";
    |C_M #0#54, 1, "S"; |C_M #0#55, 1, "S";
    |C_M #0#56, 1, "S";
    |C_M #0#0, 1, "N"; |C_M #0#1, 1, "N";
    #0#0 = "            "; #0#31 = 0; |PINTA #0#0;
    #0#1 = "            "; #0#32 = 9; |PINTA #0#1;
|SINO;
    |C_M #0#0, 1, "S"; |C_M #0#1, 1, "S";
    |C_M #0#42, 1, "N"; |C_M #0#43, 1, "N";
    |C_M #0#44, 1, "N"; |C_M #0#45, 1, "N";
    |C_M #0#46, 1, "N"; |C_M #0#47, 1, "N";
    |C_M #0#48, 1, "N"; |C_M #0#49, 1, "N";
    |C_M #0#50, 1, "N"; |C_M #0#51, 1, "N";
    |C_M #0#52, 1, "N"; |C_M #0#53, 1, "N";
    |C_M #0#54, 1, "N"; |C_M #0#55, 1, "N";
    |C_M #0#56, 1, "N";

|FINSI;
|FPRC;


|PROCESO cuenta; |TIPO 6;
  p_alfa1 = #0Campo;
  salidas = FSalida;
  |HAZ punto;
  |SI p_error ! 0;  |ERROR;  |ACABA;  |FINSI;
  |SI #0Campo = "            "; |ACABA; |FINSI;
  |SI Campo [ 1;
       digito = Campo + 31;
  |SINO;
       digito = Campo + 15;
  |FINSI;
  cta  = #0Campo;
  long = cta % 0;
  swdig = 0;
  |SI long = dig4; swdig = 1; #0digito = 1; |FINSI;
  |SI long = dig5; swdig = 1; #0digito = 2; |FINSI;
  |SI long = dig6; swdig = 1; #0digito = 3; |FINSI;
  |SI long = dig7; swdig = 1; #0digito = 4; |FINSI;
  |SI long = dig8; swdig = 1; #0digito = 5; |FINSI;
  |SI long = dig9; swdig = 1; #0digito = 6; |FINSI;
  |SI swdig = 0;  |MENAV men2;  |ERROR;  |FINSI;
|FPRC;

|PROCESO fechas;
  |SI #0#74 = "N";
      |SI #0Campo < fec1; |O #0Campo > fec2;
          |MENAV mensa1;
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
  |SI Campo = 3; |Y #0#3 < #0#2;
      |MENAV mensa1;
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO nomodifi;             || RUTINA DE CONVERSION A NO MODIFICABLES
                               || VARIABLES: A_
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FPRC;

|PROCESO colummes; |TIPO 7;
                          || Calculo para saber en que columna del plan contable
                          || se encuentra el mes hasta, y hacer no modificable
                          || el campo de (Con saldo S/N)
 diah = #0#3 % 102;
 mesh = #0#3 % 402;
 anyoh = #0#3 % 902;
 mesnum = mesh;

 |SI #30#11 ! 1;
     columna = #30#11 + (mesnum + 1);
    |SI columna > 12; columna = columna - 12; |FINSI;
 |SINO;
     columna = mesnum;
 |FINSI;

 |SI diah = "31"; |O diah = "30"; |O diah = "28"; |O diah = "29";
     |SI diah = "30";
         |SI mesh = "01"; |O mesh = "03"; |O mesh = "05"; |O mesh = "07";
          |O mesh = "08"; |O mesh = "10"; |O mesh = "12";
               |HAZ nomodifi;
         |FINSI;
     |FINSI;
     |SI diah = "28"; |O diah = "29";
          |SI mesh ! "02";
             |HAZ nomodifi;
          |SINO;
             |SI diah = "28"
                |SI anyoh = "88"; |O anyoh = "92"; |O anyoh = "96";
                 |O anyoh = "00"; |O anyoh = "04";
                   |HAZ nomodifi;
                |FINSI;
             |SINO;
                |SI anyoh ! "88"; |Y anyoh ! "92"; |Y anyoh ! "96";
                 |Y anyoh ! "00"; |Y anyoh ! "04";
                   |HAZ nomodifi;
                |FINSI;
             |FINSI;
          |FINSI;
     |FINSI;
|SINO;
   |HAZ nomodifi;
|FINSI;
|FPRC;

|PROCESO no_dep; |TIPO 7;
    alfa1 = #30#24;
    |C_M #0#36, 1, alfa1; |SI alfa1 = "N"; #0#36 = "  "; |FINSI;
    |C_M #0#37, 1, alfa1; |SI alfa1 = "N"; #0#37 = "zz"; |FINSI;
|FPRC;

|PROGRAMA;
  |HAZ inicio;
  |HAZ eVarEmpresa;
  |HAZ VerCaconimp;

  aPath08 = "";
  |DFICE dirfichO; |QBF dirfichO;
  |SI enEjercicio = 2008; aPath08 = dirfichO; |FINSI;
  nEjer    = enEjercicio;
  nPeriodo = enPeriodo;
  |SI aPath08 = "";
      |SALVA_DATOS #30;
      |ABRE #30;
      |PARA nume1 = 0; |SI nume1 [ 9; |HACIENDO nume1 = nume1 + 1;
            #30#2 = enEmpresa;
            #30#3 = nume1;
            |LEE 001#30=;
            |SI FSalida = 0; |Y #30#26 = 8;
                aAlfa1 = #30#2; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
                aAlfa2 = #30#3; |QBF aAlfa2; aAlfa2 = ("0"     + aAlfa2) % -101;
                |DFICB aPath08;
                 aPath08 = aPath08 + aAlfa1 + aAlfa2 + "/";
                 |SAL;
            |FINSI;
      |SIGUE;
      |CIERRA #30;
      |REPON_DATOS #30;
  |FINSI;

  |CLS;
  |CABEZA "Extractos por Impresora";

  |DDEFECTO #0;
  |ABRE #0;
  |LEE 000#0p;
  |SI FSalida ! 0;  |GRABA 020#0n; |FINSI;
  |CIERRA #0;

  |SI #0#74 = "N";
      #0#2  = fec1;
      #0#3  = fec2;
  |FINSI;
  #0#30 = ~;        || fecha del extracto es siempre fecha del sistema

  |QBF ext1;
  |SI ext1 ! "";
     #0#0 = ext1;
     #0#1 = ext1;
     #0#41 = "S";
     |C_M #0#0,1,"N"; |C_M #0#1,1,"N";
     |PARA nCont = 41; |SI nCont [ 56; |HACIENDO nCont = nCont + 1;
        |C_M #0nCont,1,"N";
     |SIGUE;
     |PINTA #0#0;
     |PINTA #0#1;
     |PINTA #0#41;
  |SINO;
     |C_M #0#0,1,"S"; |C_M #0#1,1,"S";
     |PARA nCont = 41; |SI nCont [ 56; |HACIENDO nCont = nCont + 1;
        |C_M #0nCont,1,"S";
     |SIGUE;
  |FINSI;

  FSalida = 1;
  |PARA;|SI FSalida = 1; |HACIENDO;
        sw_pagina = 0;
        sw_prim = 0;
        sw_saldo = 0;
        sw_print = 0;
        sw_inf = 0;
        sw_cuen = 0;
        swtotal = 0;
        |PINPA #0#0;
        |PINDA #0#0;                    || Pinta los datos por defecto
        |ENDATOS #1#0;                  || Seleccion informe
        |SI FSalida = 0;                || Si el conforme es igua a S
            |HAZ borrar;
            |HAZ impre;                 || Calculo impresion
            FSalida = 1;                || Vuelve al bucle
        |SINO;
            FSalida = 0;
        |FINSI;
  |SIGUE;

  |ABRE #0;
  |BORRA 020#0c;
  |SI FSalida = 0;
       |GRABA 020#0n;
  |FINSI;
  |CIERRA #0;
|FPRO;

|| *************************************************************************
||                               MEOLLO
|| *************************************************************************

|PROCESO cabecera;
      #2#0 = #1#0;
      #2#1 = #1#1;
      #2#2 = #1#2;
      |LEE 040#2=;
      |SI FSalida ! 0;
          |DDEFECTO #2;
      |FINSI;
|FPRC;

|PROCESO concepto;
  sw_con = 0;
  |PARA x = 5; |SI x [ 28; |HACIENDO x = x + 1;
        |SI #0x  = #1#6;
            sw_con = 1;
            |SAL;
       |FINSI;
  |SIGUE;
|FPRC;

|PROCESO leecuen;
  sw_cuen  = 1;
  sw_saldo = 0;
  #3#0 = #1#4;
  #3#1 = #1#5;
  |LEE 040#3=;
  |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
  t_debe = 0;
  t_haber = 0;
  t_saldo = 0;
  |SI #0#29 = "N";
      campo = 12 + ((columna -1) * 3);
      |SI columna = 12; |Y #0#40 = 99;
          campo = campo + 3;
      |FINSI;
      |PARA d = 9; |SI d [ campo; |HACIENDO d = d + 3;
            h = d + 1;
            t_debe = t_debe + #3d;
            t_haber = t_haber + #3h;
      |SIGUE;
      t_saldo = t_debe - t_haber;
      aAlfa1 = t_saldo; |QBF aAlfa1;
      |SI aAlfa1 = "0"; |O aAlfa1 = "-0";
           t_saldo = 0;
      |FINSI;
      |SI t_saldo = 0;  sw_saldo = 1; sw_print = 1; sw_cuen = 0;  |FINSI;
  |FINSI;

  direc = ""; codpos = ""; pobla = ""; provi = ""; cif = ""; telef = "";

  cuen = #1#4 % 102;

      #5#23 = "C";
      #5#10 = #1#4;
      #5#11 = #1#5;
      |LEE 040#5=;
      |SI FSalida = 0;
          direc = #5#2;
          varalf = #5#3;
          varalf = "0" + varalf;
          varalf = varalf % -102;
          codpos = varalf;
          varalf = #5#4;
          varalf = "00" + varalf;
          varalf = varalf % -103;
          codpos = codpos + varalf;
          pobla = #5#6;
          provi = #5#5;
          cif = #5#9;
          telef = #5#7;
          |ACABA;
      |FINSI;

      #5#23 = "P";
      #5#10 = #1#4;
      #5#11 = #1#5;
      |LEE 040#5=;
      |SI FSalida = 0;
           direc = #5#2;
           varalf = #5#3;
           varalf = "00" + varalf;
           varalf = varalf % -102;
           codpos = varalf;
           varalf = #5#4;
           varalf = "000" + varalf;
           varalf = varalf % -103;
           codpos = codpos + varalf;
           pobla = #5#6;
           provi = #5#5;
           cif = #5#9;
           telef = #5#7;
          |ACABA;
      |FINSI;

      #6#10 = #1#4;
      #6#11 = #1#5;
      |LEE 040#6=;
      |SI FSalida = 0;
           direc  = #6#2;
           varalf = #6#3;
           varalf = "00" + varalf;
           varalf = varalf % -102;
           codpos = varalf;
           varalf = #6#4;
           varalf = "000" + varalf;
           varalf = varalf % -103;
           codpos = codpos + varalf;
           pobla = #6#6;
           provi = #6#5;
           cif   = #6#14;
           telef = #6#7;
      |FINSI;
|FPRC;

          ||La variable 'y' se utiliza para saber cuando se hace un salto de
          ||pagina

|PROCESO buclepan;
  sw_con = 1;
  |SI #0#4 = "N"; |HAZ concepto;  |FINSI;
  |SI sw_con = 0; |ACABA;  |FINSI;

  |SI sw_prim = 0;
      cuenta = #1#4;
      sw_prim  = 1;
      |HAZ leecuen;
      |SI sw_saldo = 1; |ACABA; |FINSI;
  |FINSI;
  |SI cuenta ! #1#4;
      |SI sw_print = 0;
          |SI #0#35 = "N";
              sw_cab = 0;
              sw_inf = 2;
              |PRINT; swtotal = 1;
              sw_cab = 0;
          |SINO;
              |PIEINF;
          |FINSI;
      |FINSI;
      |HAZ borrar;
      cuenta = #1#4;
      |HAZ leecuen;
  |FINSI;
  |SI sw_saldo = 1;   |ACABA;   |FINSI;

  eaDesPac = #1#24;   ||Descripcion
  |QBF eaDesPac;
  eaDesPac = eaDesPac + " " + #1#7;
  |SI #1#8 = "D";
      debe = #1#9;
      haber = 0;
  |SINO;
      debe = 0;
      haber = #1#9;
  |FINSI;
  |SI #1#1 ] #0#2; |Y #1#1 [ #0#3;
      |SI nSwOp = 0;
          |HAZ cabecera;
          |HAZ leocontra;
      |FINSI;
      |SI #1#3 [ 30; |O swex_con = 1;
          |SI #1#8 = "D";
             |SI #1#9 ] 0;
                contra = contra_d;
             |SINO;
                contra = contra_h;
             |FINSI;
          |FINSI;
          |SI #1#8 = "H";
             |SI #1#9 ] 0;
                contra = contra_h;
             |SINO;
                contra = contra_d;
             |FINSI;
          |FINSI;
      |SINO;
          contra = "";
      |FINSI;
      |SI #0#35 = "N";  |Y sw_cuen = 1;
          sw_cab = 1;
          sw_inf = 0;
          |PRINT; swtotal = 1;
          sw_cab = 0;
          sw_cuen = 0;
      |FINSI;
      sw_inf = 1;
      sw_cab = 0;
      |PRINT; swtotal = 1;
      sw_cab = 0;
      sw_print = 0;
      swant = 1;
  |FINSI;
  |SI #1#1 < #0#2;
      |SI #1#8 = "D";
          s_debe = s_debe  + #1#9;
      |SINO;
          s_haber = s_haber + #1#9;
      |FINSI;
      s_saldo = s_debe - s_haber;
      sw_print = 1;
      swant = 1;
  |FINSI;
|FPRC;

|PROCESO leocontra;
  contra = "";
  contra_d = #2#10;
  contra_h = #2#8;
  swex_con = 0;
  #31#0 = #1#0;
  #31#1 = #1#1;
  #31#2 = #1#2;
  #31#3 = #1#3;
  |LEE 001#31=;
  |SI FSalida = 0;
      swex_con = 1;
      contra_h = #31#4;
      contra_d = #31#4;
  |FINSI;
|FPRC;

|DEFBUCLE caextrim0;
 #1#3;
 0, 6, 21;
 #0#0, 0, fec1, 000000, #0#39, #0#33, #0#36;
 #0#1, 9, #0#3, 999999, #0#40, #0#34, #0#37;
 e;
 NULL, NULL, NULL, NULL, NULL, buclepan;
 #1#4,#1#1,#1#2,#1#0,#1#3;
|FIN;

|PROCESO impre;

  |IMPRE 0;
  |SI FSalida ! 0;
      |MENAV "    Proceso abortado ...";
      |ACABA;
  |FINSI;

  |HAZ los_informes;
  |SI #0#35 = "S";
      informe = que_i1;
      |SI #0#72 = "N"; informe = que_i3; |FINSI;
  |SINO;
      informe = que_i2;
      |SI #0#72 = "N"; informe = que_i4; |FINSI;
  |FINSI;
  |SI eaConDes ! "N"; informe = (informe % 105) + "0" + (informe % -102); |FINSI;

  |INFOR informe;
  |SI FSalida ! 0;
      |FINIMP;
      |ACABA;
  |FINSI;

  nSwOp = 0;
  |SI #0#74 = "N";  || si es solo este ejercicio
      |ABRE #2;
      |ABRE #3;
      |ABRE #5;
      |ABRE #6;
      |ABRE #31;
      |SELECT #2#6;
      |SI #0#41 = "N";
          swtotal = 0;
          |PARA nCampo = 42; |SI nCampo [ 56; |HACIENDO nCampo = nCampo + 1;
                #0#0 = #0nCampo;
                #0#1 = #0nCampo;
                |BUCLE caextrim0;
          |SIGUE;
      |SINO;
          swtotal = 0;
          |BUCLE caextrim0;
      |FINSI;
      |CIERRA #2;
      |CIERRA #3;
      |CIERRA #5;
      |CIERRA #6;
      |CIERRA #31;
  |SINO;
      || ... Varios ejercicios
      |HAZ MultiEjercicio;
  |FINSI;

  |SI #0#35 = "N"; |Y sw_print = 0;
      sw_cab = 0;
      sw_inf = 2;
      |SI swtotal = 1; |PRINT; |FINSI;
      sw_cab = 0;
  |FINSI;
  |SI sw_print = 0; |Y swtotal = 1;
      |PIEINF;
  |FINSI;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO borrar;
  s_debe = 0;
  s_haber = 0;
  s_saldo = 0;
  swant = 0;
|FPRC;

|| =========================================================================
|PROCESO LeeAuxiliar;
  nSwOp = 1;
  |DDEFECTO #1;
  |DDEFECTO #2;
  #1#0 = #999#0;
  #1#1 = #999#1;
  #1#2 = #999#2;
  #1#3 = #999#3;
  #1#4 = #999#4;
  #1#5 = #999#5;
  #1#6 = #999#6;
  #1#7 = #999#7;
  #1#8 = #999#8;
  #1#9 = #999#9;
  |SI #1#8 = "D";
      #1#16 = #1#4;
      #1#17 = #1#5;
  |SINO;
      #1#10 = #1#4;
      #1#11 = #1#5;
  |FINSI;
  #1#12 = #999#12;
  #1#13 = #999#13;
  #1#14 = #999#14;
  #1#15 = #999#15;
  #1#21 = #999#18;
  #1#24 = #999#19;
  #2#0  = #1#0;
  #2#1  = #1#1;
  #2#2  = #1#2;
  #2#3  = #999#20;
  contra_h = #999#10;
  contra_d = #999#10;
  swex_con = 1;

  |HAZ buclepan;
|FPRC;

|DEFBUCLE ElAuxiliar;
 #999#1;
 ;
 "            ", #0#2, 000000, 00, 0001;
 "zzzzzzzzzzzz", #0#3, 999999, 99, 9999;
 e;
 NULL, LeeAuxiliar;
|FIN;

|PROCESO caextrim_M;
  sw_con = 1;
  |SI #0#4 = "N"; |HAZ concepto;  |FINSI;
  |SI sw_con = 0; |ACABA;  |FINSI;

  |SI #0#41 = "S";
      eaCuenta = #1#4;
      |SI nCambio ! 0;
          nEjerCam = enEjercicio;
          |HAZ CamCuenta;
          |SI nEjer ] 2008;
              eaCuenta = aCta08;
          |SINO;
              eaCuenta = aCta90;
          |FINSI;
      |FINSI;
      |SI eaCuenta < #0#0; |O eaCuenta > #0#1;
          |ACABA; ||no entra en la seleccion
      |FINSI;
      |HAZ eSacaNivel;
  |FINSI;

  |SI sw_prim = 0;
      cuenta   = eaCuenta;
      sw_prim  = 1;
      |HAZ leecuen;
      |SI sw_saldo = 1; |ACABA; |FINSI;
  |FINSI;
  |SI cuenta ! eaCuenta;
      cuenta = eaCuenta;
      |HAZ leecuen;
  |FINSI;
  |SI sw_saldo = 1;   |ACABA;   |FINSI;

  |HAZ cabecera;
  |HAZ leocontra;
  |SI #1#3 [ 30; |O swex_con = 1;
      |SI #1#8 = "D";
          |SI #1#9 ] 0;
              contra = contra_d;
           |SINO;
              contra = contra_h;
           |FINSI;
       |FINSI;
       |SI #1#8 = "H";
           |SI #1#9 ] 0;
               contra = contra_h;
           |SINO;
               contra = contra_d;
           |FINSI;
        |FINSI;
   |SINO;
        contra = "";
   |FINSI;

   #999#0 = #1#0;
   #999#1 = #1#1;
   #999#2 = #1#2;
   #999#3 = #1#3;
   #999#4 = eaCuenta;
   #999#5 = enNivel;
   #999#6 = #1#6;
   #999#7 = #1#7;
   #999#8 = #1#8;
   #999#9 = #1#9;
   #999#10 = contra;
   #999#11 = enNivel;
   #999#12 = #1#12;
   #999#13 = #1#13;
   #999#14 = #1#14;
   #999#15 = #1#15;
   #999#18 = #1#21;
   #999#19 = #1#24;
   #999#20 = #2#3;
   |GRABA 040#999n;
   nHay = 1;
|FPRC;

|DEFBUCLE caextrim0_M;
 #1#3;
 0, 6, 21;
 aDCuenta, 0, #0#2, 000000, #0#39, #0#33, #0#36;
 aHCuenta, 9, #0#3, 999999, #0#40, #0#34, #0#37;
 e;
 NULL, NULL, NULL, NULL, NULL, caextrim_M;
 #1#4,#1#1,#1#2,#1#0,#1#3;
|FIN;

|PROCESO HazTodo;
      nCambio = 0;
      sw_prim = 0;
      |SI enEjercicio < 2008; |Y nEjer ] 2008; nCambio = 1; |FINSI;
      |SI enEjercicio ] 2008; |Y nEjer < 2008; nCambio = 1; |FINSI;

      |ABRE #2;
      |ABRE #3;
      |ABRE #5;
      |ABRE #6;
      |ABRE #31;
      |SELECT #2#6;
      |SI #0#41 = "N";

          |PARA nCampo = 42; |SI nCampo [ 56; |HACIENDO nCampo = nCampo + 1;
                eaCuenta = #0nCampo;
                x        = nCampo + 15;
                enNivel  = #0x;
                |SI eaCuenta ! "            ";
                    aDCuenta = eaCuenta;
                    aHCuenta = eaCuenta;
                    |SI nCambio ! 0;
                        nEjerCam = nEjer;  ||la cuenta es la del ejercicio actual
                        |HAZ CamCuenta;
                        |SI enEjercicio < 2008;  || para buscar en el bucle
                            aDCuenta = aCta90;
                            aHCuenta = aCta90;
                        |SINO;
                            aDCuenta = aCta08;
                            aHCuenta = aCta08;
                        |FINSI;
                    |FINSI;
                    |BUCLE caextrim0_M;
                |FINSI;
          |SIGUE;
      |SINO;
          aDCuenta = #0#0;
          aHCuenta = #0#1;
          |SI nCambio ! 0; aDCuenta = ""; aHCuenta = "zzzzzzzzzzzzz"; |FINSI;
          |BUCLE caextrim0_M;
      |FINSI;
      |CIERRA #2;
      |CIERRA #3;
      |CIERRA #5;
      |CIERRA #6;
      |CIERRA #31;
|FPRC;

|PROCESO MultiEmp1;

   |HAZ CalFechas;
   |SI #0#2 > fec2; |O #0#3 < fec1;
       |ACABA;  || Fuera de la seleccion
   |FINSI;

   |DBASE dir_fich; |QBF dir_fich;
   dir_fich = dir_fich + "fich/";
   alfa1 = #30#2; |QBF alfa1;
   alfa2 = #30#3; |QBF alfa2;
   alfa1 = "00000" + alfa1;   alfa1 = alfa1 % -105;
   alfa2 = "0"     + alfa2;   alfa2 = alfa2 % -101;
   dirfich0 = dir_fich + alfa1 + alfa2 + "/";
   |QBF dirfich0;

   |PATH_DAT #1 dirfich0;
   |PATH_DAT #2 dirfich0;
   |PATH_DAT #31 dirfich0;
   |HAZ HazTodo;
|FPRC;

|DEFBUCLE MultiEmp0;
 #30#1;
 ;
 enEmpresa, 0;
 enEmpresa, 9;
 ;
 NULL,MultiEmp1;
|FIN;

|PROCESO MultiEjercicio;

   aFichero = "0w" + Usuario;
   |NOME_DAT #999 aFichero;
   nHay = 0;
   |DELINDEX #999;
   nSwOp = 0;
   |ABRE #999;
   |BUCLE MultiEmp0;
   |CIERRA #999;

   enEjercicio = nEjer;
   enPeriodo   = nPeriodo;
   |HAZ inicio;

   |SI nHay ! 0;
       nSwOp   = 1;
       sw_prim = 0;
       |ABRE #3;
       |ABRE #5;
       |ABRE #6;
       |BUCLE ElAuxiliar;
       |CIERRA #6;
       |CIERRA #5;
       |CIERRA #3;
   |FINSI;

   |DELINDEX #999;

   |PATH_DAT #1 dirfichO;
   |PATH_DAT #2 dirfichO;
   |PATH_DAT #3 dirfichO;
   |PATH_DAT #5 dirfichO;
   |PATH_DAT #6 dirfichO;
   |PATH_DAT #31 dirfichO;
|FPRC;

|PROCESO CamCuenta;
   aCta08 = eaCuenta;
   aCta90 = eaCuenta;
   |SI aPath08 ! "";
       |PATH_DAT #403 aPath08;
       |ABRE #403;
       |DDEFECTO #403;
       |SI nEjerCam ] 2008;
           |SELECT #2#403;
           #403#2 = eaCuenta;
           |LEE 041#403];
           |SI FSalida = 0; |Y #403#2 = eaCuenta;
               aCta08 = #403#2;
               aCta90 = #403#0;
           |FINSI;
           |SELECT #1#403;
       |SINO;
           #403#0 = eaCuenta;
           |LEE 041#403=;
           |SI FSalida = 0;
               aCta08 = #403#2;
               aCta90 = #403#0;
           |FINSI;
       |FINSI;
       |CIERRA #403;
   |FINSI;
|FPRC;

|PROCESO CalFechas;
   |SI #30#26 < 80;
       enEjercicio = #30#26 + 2000;
   |SINO;
       enEjercicio = #30#26 + 1900;
   |FINSI;

   cod2 = #30#26;
   tra1 = 100 + cod2;
   clave2 = tra1 % -102;
   tra1 = 100 + #30#11;
   mes1 = tra1 % -102;
   |SI cod2 < 80;
      work1 = "01." + mes1 + ".20" + clave2;
   |SINO;
      work1 = "01." + mes1 + ".19" + clave2;
   |FINSI;
   fec1 = work1;
   tra1 = 100 + #30#12;
   mes1 = tra1 % -102;
   |SI #30#11 > #30#12;
      cod2 = cod2 + 1;
      |SI cod2 > 99; cod2 = cod2 - 100;    |FINSI;
   |FINSI;
   dia1 = "31";
   |SI #30#12 = 4; |O #30#12 = 6; |O #30#12 = 9; |O #30#12 = 11;
      dia1 = "30";
   |FINSI;
   |SI #30#12 = 2;
      dia1 = "28";
      |SI cod2 = 88; |O cod2 = 92; |O cod2 = 96; |O cod2 = 0; |O cod2 = 4; |O cod2 = 8;
         dia1 = "29";
      |FINSI;
   |FINSI;
   tra1 = 100 + cod2;
   clave2 = tra1 % -102;
   |SI cod2 < 80;
      work1 = dia1 + "." + mes1 + ".20" + clave2;
   |SINO;
      work1 = dia1 + "." + mes1 + ".19" + clave2;
   |FINSI;
   fec2 = work1;
|FPRC;
