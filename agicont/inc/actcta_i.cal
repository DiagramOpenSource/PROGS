|FICHEROS;
    cacuenta #5;
    catradia #8;
|FIN;

|VARIABLES;
   &fecalf = "";
   &ini = 0;
   &mes = "";
   &mesfec = 0;
   &mesac = 0;
   &a = 0;
   &b = 0;
   &c = 0;
   &modcon = 0;
   &importe = 0;
   &ressum = 0;
   &opera = "";
|FIN;

**********************************************************************
    ACTUALIZACION DE CUENTAS
**********************************************************************

|PROCESO actualiz1;
 |ABRE #5;
 #5#0 = #3#4;
 #5#1 = #3#5;
 |LEE 101#5=;
 |SI FSalida ! 0;
     |LIBERA #5;
     |CIERRA #5;
     |ACABA;
 |FINSI;
 |SI #3#0 = 0;
     |SI #3#8 = "D";
         #5#9 = #5#9 + ressum;
         #5#51 = #5#51 + ressum;
     |SINO;
         #5#10 = #5#10 + ressum;
         #5#52 = #5#52 + ressum;
     |FINSI;
     #5#11 = #5#9 - #5#10;
     #5#53 = #5#51 - #5#52;
 |SINO;
     |SI #3#0 = 99;
         |SI #3#8 = "D";
             #5#48 = #5#48 + ressum;
             #5#51 = #5#51 + ressum;
         |SINO;
             #5#49 = #5#49 + ressum;
             #5#52 = #5#52 + ressum;
         |FINSI;
         #5#50 = #5#48 - #5#49;
         #5#53 = #5#51 - #5#52;
     |SINO;
         |HAZ actualiz2;
     |FINSI;
 |FINSI;
 |SI #5#58 < #3#1;
     #5#58 = #3#1;
 |FINSI;
 |GRABA 020#5a;
 |LIBERA #5;
 |CIERRA #5;
|FPRC;

|PROCESO actualiz2;
    ini = dig1;      || numero de niveles
    fecalf = #3#1;
    mes = fecalf % 402;
    mesfec = mes;
|SI ini = 1;
        mesac = mesfec;
|SINO;
        mesac = (mesfec - ini) + 1;
    |SI mesac [ 0;
            mesac = (13 - ini) + mesfec;
    |FINSI;
|FINSI;
    a = (mesac * 3) + 9;
    b = a + 1;
    c = a + 2;
|SI #3#8 = "D";
        #5a = #5a + ressum;
        #5#51 = #5#51 + ressum;
|SINO;
        #5b = #5b + ressum;
        #5#52 = #5#52 + ressum;
|FINSI;
    #5c = #5a - #5b;
    #5#53 = #5#51 - #5#52;
|FPRC;

**********************************************************************
    ACTUALIZACION DE 'camaapuc' (PARA LA ACTUALIZACION DE NIVELES)
**********************************************************************

|PROCESO altatra;
 modcon = 1;
 |ABRE #8;
 #8#0 = codcon;
 #8#1 = #3#4;
 #8#2 = #3#5;
 #8#3 = #3#1;
 #8#4 = #3#8;
 #8#6 = #3#0;
 |LEE 101#8=;
 |SI FSalida ! 0;
     |DDEFECTO #8;
     #8#0 = codcon;
     #8#1 = #3#4;
     #8#2 = #3#5;
     #8#3 = #3#1;
     #8#4 = #3#8;
     #8#6 = #3#0;
     |GRABA 101#8b;
 |FINSI;
 importe = #3#9;  || aqui si que se usa el importe real
 |SI opera = "B";
     importe = -importe;
 |FINSI;
 #8#5 = #8#5 + importe;
 |GRABA 101#8a;
 |LIBERA #8;
 |CIERRA #8;
|FPRC;
