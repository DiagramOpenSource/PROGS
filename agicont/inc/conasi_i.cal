|FICHEROS;
    caconasi #20;
    cacontar #900;
|FIN;

|VARIABLES;
     &enDiario   = 0;
     &enContador = 0;
|FIN;

|PROCESO contador;       || desde calculo 'entrada'
     enContador = 0;

     |ABRE #900;
     #900#0 = enDiario;
     |LEE 101#900=;
     |SI FSalida = 0;
         #900#2 = #900#2 + 1;
         |GRABA 020#900a;
         |LIBERA #900;
         enContador = #900#2;
     |FINSI;
     |CIERRA #900;

     |SI enContador ! 0;  |ACABA;  |FINSI;

     |ABRE #20;
     |LEE 101#20p;
     |SI FSalida ! 0;
         |DDEFECTO #20;
         |GRABA 020#20b;
     |FINSI;

     #20#1 = #20#1 + 1;
     |GRABA 020#20a;
     enContador = #20#1;

     |LIBERA #20;
     |CIERRA #20;
|FPRC;

|PROCESO GrabaContador;
     |ABRE #900;
     |DDEFECTO #900;
     #900#0 = enDiario;
     |LEE 101#900=;
     |SI FSalida = 0;
         #900#2 = enContador;
         |GRABA 020#900a;
         |LIBERA #900;
     |FINSI;
     |CIERRA #900;

     |SI #900#2 ! 0;  |ACABA;  |FINSI;

     |ABRE #20;
     |LEE 101#20p;
     |SI FSalida ! 0;
         |DDEFECTO #20;
         |GRABA 020#20b;
     |FINSI;

     #20#1 = enContador;
     |GRABA 020#20a;
     |LIBERA #20;
     |CIERRA #20;
|FPRC;

|PROCESO Descontador;       || desde calculo 'entrada'
     enContador = 0;

     |ABRE #900;
     #900#0 = enDiario;
     |LEE 101#900=;
     |SI FSalida = 0;
         #900#2 = #900#2 + 1;
         |LIBERA #900;
         enContador = #900#2;
     |FINSI;
     |CIERRA #900;

     |SI enContador ! 0;  |ACABA;  |FINSI;

     |ABRE #20;
     |LEE 101#20p;
     |SI FSalida ! 0;
         |DDEFECTO #20;
         |GRABA 020#20b;
     |FINSI;

     #20#1 = #20#1 + 1;
     enContador = #20#1;

     |LIBERA #20;
     |CIERRA #20;
|FPRC;
