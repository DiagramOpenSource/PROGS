|FICHEROS;
     dserpw01 #1;
     dserpm02 #2;
     dserpm03 #3;
     dserpm04 #4;
     dserpm05 #5;
     dserpm06 #6;
     dserpm16 #16;

     dserpw02 #99;
     referen@ #999;
|FIN;

|VARIABLES;
     aParametro = "";
     aCarga        = "";
     aDirDef       = "";
     aQueQuiero    = "";
     aTitulo       = "";
     aDef          = "";
     aFichero      = "";
     aBase         = "";
     aAplica       = "";
     aBaseDef      = "";
     aDirFiltros   = "";
     aNombreFiltro = "";
     aFuncion      = "";
     aAlfa         = "";

     nHandle       = 0;
     nCampo        = 0;
     nTCampo       = 0;
     nModo         = 0;
|FIN;

|RUTINA ClaveBaja1;
     #1#0 = 01;
|FRUT;

|RUTINA ClaveAlta1;
     #1#0 = 99;
|FRUT;

|RUTINA ClaveBaja2;
     #2#0 = #1#0;
     #2#1 = "";
|FRUT;

|RUTINA ClaveAlta2;
     #2#0 = #1#0;
     #2#1 = "zzzzzzzz";
|FRUT;

|RUTINA ClaveBaja4;
     #4#0 = #1#0;
     #4#1 = "";
|FRUT;

|RUTINA ClaveAlta4;
     #4#0 = #1#0;
     #4#1 = "zzzzzzzz";
|FRUT;

|PROCESO Tipo7;  |TIPO 7;
     |SI aParametro = "FILTROS";
         |ENTLINEAL #1#2, -2, 7, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;

     |SI aParametro = "PROGRAMAS";
         |ENTLINEAL #1#4, -2, 7, 22, 0, ClaveBaja4, ClaveAlta4;
     |FINSI;
|FPRC;

|PROCESO Graba99;
     aCarga = aDirDef;  |QBT aCarga;
     |CARGA_DEF aCarga, referen@;
     |SI FSalida = 0;
         aQueQuiero = "|TITULO";
         aTitulo    = #999#aQueQuiero#;

         #99#0 = aDef;
         #99#1 = aTitulo;
         |GRABA 020#99n;

         |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO GrabaTablas;
     aFichero = ("02" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #99 aFichero;

     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     |ABRE #99;

     |DBASS aBase;  |QBF aBase;
     aAplica   = #1#1;  |QBF aAplica;
     aBaseDef  = aBase + aAplica + "/def/";
     aDirDef   = aBaseDef + "*.mas";
     |_PDIR aDirDef;
     |PARA;  |SI FSalida ] 0; |HACIENDO;
          aDef = aDirDef - aBaseDef;
          aDef = aDef - ".mas";

          |HAZ Graba99;

          |_SDIR aDirDef;
     |SIGUE;
     |CIERRA #99;
|FPRC;

|PROCESO PaseCmpsAplic;
   |DDEFECTO #dserpm16;
   #dserpm16#0 = #dserpm06#0;
   #dserpm16#1 = #dserpm06#1;
   #dserpm16#2 = #dserpm06#2;
   #dserpm16#3 = #dserpm02#6;
   #dserpm16#4 = #dserpm06#3;
   #dserpm16#5 = #dserpm06#4;
   #dserpm16#6 = #dserpm06#5;
   #dserpm16#7 = #dserpm06#6;
   |GRABA 020#dserpm16.n;
|FPRC;

|DEFBUCLE PaseCmpsAplic;
#dserpm06#1;
;
#dserpm05#0, #dserpm05#1, #dserpm05#2, 000;
#dserpm05#0, #dserpm05#1, #dserpm05#2, 999;
;
NULL,PaseCmpsAplic;
|FIN;

|PROCESO PaseAplic;
   #dserpm02#0 = #dserpm05#0;
   #dserpm02#1 = #dserpm05#2;
   |LEE 000#dserpm02.=;
   |SI FSalida ! 0; |DDEFECTO #dserpm02; |FINSI;

   |BUCLE PaseCmpsAplic;
|FPRC;

|DEFBUCLE PaseAplic;
#dserpm05#1;
;
INICIO;
FINAL;
be;
NULL, PaseAplic;
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |SI aParametro = "FILTROS";
         |ENTLINEAL #1#2, -2, 2, 22, 0, ClaveBaja2, ClaveAlta2;
     |FINSI;

     |SI aParametro = "PROGRAMAS";
         |ABRE #dserpm16; |ABRE #dserpm06; |ABRE #dserpm02;
         |LEE 000#dserpm16.p;
         |SI FSalida ! 0;
            |LEE 000#dserpm06.p;
            |SI FSalida = 0;
               |BUCLE PaseAplic;
            |FINSI;
         |FINSI;
         |CIERRA #dserpm06; |CIERRA #dserpm16; |CIERRA #dserpm02;

         |HAZ GrabaTablas;
         |ENTLINEAL #1#4, -2, 2, 22, 0, ClaveBaja4, ClaveAlta4;
         |DELINDEX #99;
     |FINSI;
|FPRC;

|PROGRAMA;
     aParametro = PARAMETRO;  |QBF aParametro;

     |CLS;

     |PINPA #0#1;

     |SI aParametro = "FILTROS";   |PINPA #0#2;  |FINSI;
     |SI aParametro = "PROGRAMAS"; |PINPA #0#4;  |FINSI;

     |ENTLINEAL #1#1, -1, 4, 22, 0, ClaveBaja1, ClaveAlta1;
|FPRO;
