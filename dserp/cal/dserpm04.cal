|FICHEROS;
     dserpw01 #1;
     dserpm02 #2,MANTE;
     dserpm03 #3,MANTE;
     dserpm04 #4,MANTE;
     dserpm05 #5,MANTE;
     dserpm06 #6,MANTE;
     dserpm13 #13,MANTE;
     dserpm16 #16,MANTE;

     dserpw03 #98;  || Campos
     dserpw02 #99;  || Tablas

     referen@ #999;
|FIN;

|VARIABLES;
     aCarga        = "";
     aDirDef       = "";
     aQueQuiero    = "";
     aTitulo       = "";
     aDef          = "";
     aFichero      = "";
     aBase         = "";
     aAplica       = "";
     aBaseDef      = "";
     aDirFiltros   = "";
     aNombreFiltro = "";
     aFuncion      = "";
     aAlfa         = "";

     nHandle       = 0;
     nCampo        = 0;
     nTCampo       = 0;
     nModo         = 0;
|FIN;

|RUTINA ClaveBaja5;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = "";
|FRUT;

|RUTINA ClaveAlta5;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = "zzzzzzzz";
|FRUT;

|RUTINA ClaveBaja6;
     #6#0 = #5#0;
     #6#1 = #5#1;
     #6#2 = #5#2;
     #6#3 = 000;
|FRUT;

|RUTINA ClaveAlta6;
     #6#0 = #5#0;
     #6#1 = #5#1;
     #6#2 = #5#2;
     #6#3 = 999;
|FRUT;

|RUTINA ClaveBaja16;
     #16#0 = #5#0;
     #16#1 = #5#1;
     #16#2 = #5#2;
     #16#3 = "        ";
     #16#4 = 000;
|FRUT;

|RUTINA ClaveAlta16;
     #16#0 = #5#0;
     #16#1 = #5#1;
     #16#2 = #5#2;
     #16#3 = "zzzzzzzz";
     #16#4 = 999;
|FRUT;

|RUTINA ClaveBaja3m6;
     #3#0 = #6#0;
     #3#1 = #6#2;
     #3#2 = 000;
|FRUT;

|RUTINA ClaveAlta3m6;
     #3#0 = #6#0;
     #3#1 = #6#2;
     #3#2 = 999;
|FRUT;

|RUTINA ClaveBaja13m6;
     #13#0 = #6#0;
     #13#1 = #6#2;
     #13#2 = "        ";
     #13#3 = 000;
|FRUT;

|RUTINA ClaveAlta13m6;
     #13#0 = #6#0;
     #13#1 = #6#2;
     #13#2 = "zzzzzzzz";
     #13#3 = 999;
|FRUT;

|RUTINA ClaveBaja13m16;
     #13#0 = #16#0;
     #13#1 = #16#2;
     #13#2 = "        ";
     #13#3 = 000;
|FRUT;

|RUTINA ClaveAlta13m16;
     #13#0 = #16#0;
     #13#1 = #16#2;
     #13#2 = "zzzzzzzz";
     #13#3 = 999;
|FRUT;

|PROCESO dserpm06B;
     |BORRA 020#6a;
     |LIBERA #6;
|FPRC;

|DEFBUCLE dserpm06B;
     #6#1;
     ;
     #5#0, #5#1, #5#2, 000;
     #5#0, #5#1, #5#2, 999;
     be;
     NULL, dserpm06B;
|FIN;

|PROCESO dserpm05B;
     |BUCLE dserpm06B;

     |BORRA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE dserpm05B;
     #5#1;
     ;
     #4#0, #4#1, "        ";
     #4#0, #4#1, "zzzzzzzz";
     be;
     NULL, dserpm05B;
|FIN;

|| PROCESOS DEL dserpm06 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo66m6c5;  |TIPO 66;
     |ABRE #98;
     #98#0 = #6#5;
     |LEE 040#98=;

     |CONSULTA_CLAVE #1#98;
     |SI FSalida = 0;
         #6#5 = #98#0;  |PINTA #6#5;
     |FINSI;
     |CIERRA #98;
|FPRC;

|PROCESO Tipo0m6c5;  |TIPO 0;
     |ABRE #98;
     #98#0 = #6#5;
     |LEE 040#98=;
     |SI FSalida ! 0;
         |MENAV "0000 Campo Inexistente en el Programa";
         |ERROR;
         |ACABA;
     |FINSI;

     #6#6 = #98#1;  |PINTA #6#6;
     |CIERRA #98;
|FPRC;

|PROCESO Tipo66m6c3;  |TIPO 66;
     |ABRE #3;
     #3#0 = #6#0;
     #3#1 = #6#2;
     #3#2 = #6#3;
     |LEE 040#3];

     |CONSULTA_F_CLAVE #1#3, ClaveBaja3m6, ClaveAlta3m6;
     |SI FSalida = 0;
         #6#3 = #3#2;  |PINTA #6#3;
         |ERROR;
         |PTEC 802;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Tipo7m6c4;  |TIPO 7;
     |ABRE #3;
     #3#0 = #6#0;
     #3#1 = #6#2;
     #3#2 = #6#3;
     |LEE 040#3=;
     |SI FSalida ! 0;
         |MENAV "0000 Campo Inexistente en el Filtro";
         |PTEC 807;
         |ACABA;
     |FINSI;

     #6#4 = #3#3;  |PINTA #6#4;
     |CIERRA #3;
|FPRC;

|| PROCESOS DEL dserpm16 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo66m16c6;  |TIPO 66;
     |ABRE #98;
     #98#0 = #16#6;
     |LEE 040#98=;

     |CONSULTA_CLAVE #1#98;
     |SI FSalida = 0;
         #16#6 = #98#0;  |PINTA #16#6;
         #16#7 = #98#1;  |PINTA #16#7;
     |FINSI;
     |CIERRA #98;
|FPRC;

|PROCESO Tipo0m16c6;  |TIPO 0;
     |ABRE #98;
     #98#0 = #16#6;
     |LEE 040#98=;
     |SI FSalida ! 0;
         |MENAV "0000 Campo Inexistente en el Programa";
         |ERROR;
         |ACABA;
     |FINSI;

     #16#6 = #98#0;  |PINTA #16#6;
     #16#7 = #98#1;  |PINTA #16#7;
     |CIERRA #98;
|FPRC;

|PROCESO Tipo66m16c4;  |TIPO 66;
     |ABRE #13;
     #13#0 = #16#0;
     #13#1 = #16#2;
     #13#2 = #16#3;
     #13#3 = #16#4;
     |LEE 040#13];

     |CONSULTA_F_CLAVE #1#13, ClaveBaja13m16, ClaveAlta13m16;
     |SI FSalida = 0;
         #16#3 = #13#2;  |PINTA #16#3;
         #16#4 = #13#3;  |PINTA #16#4;
         |ERROR;
         |PTEC 802;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Tipo7m16c4;  |TIPO 7;
     |ABRE #13;
     #13#0 = #16#0;
     #13#1 = #16#2;
     #13#2 = #16#3;
     #13#3 = #16#4;
     |LEE 040#13=;
     |SI FSalida ! 0;
         |MENAV "0000 Campo Inexistente en el Filtro";
         |PTEC 807;
         |ACABA;
     |FINSI;

     #16#4 = #13#3;  |PINTA #16#4;
     #16#5 = #13#4;  |PINTA #16#5;
     |CIERRA #13;
|FPRC;

|PROCESO Tipo66m16c3;  |TIPO 66;
     |ABRE #13;
     #13#0 = #16#0;
     #13#1 = #16#2;
     #13#2 = #16#3;
     #13#3 = 0;
     |LEE 040#13];

     |CONSULTA_F_CLAVE #1#13, ClaveBaja13m16, ClaveAlta13m16;
     |SI FSalida = 0;
         #16#3 = #13#2;  |PINTA #16#3;
         #16#4 = #13#3;  |PINTA #16#4;
         |ERROR;
         |PTEC 802;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Tipo7m16c3;  |TIPO 7;
     |ABRE #13;
     #13#0 = #16#0;
     #13#1 = #16#2;
     #13#2 = #16#3;
     #13#3 = #16#4;
     |LEE 040#13=;
     |SI FSalida ! 0;
         |MENAV "0000 Fichero Inexistente en el Filtro";
         |PTEC 807;
         |ACABA;
     |FINSI;
     |CIERRA #13;
|FPRC;

|| PROCESOS DEL dserpm05 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo0m5c4;  |TIPO 0;
     |DBASE aBase;  |QBF aBase;
     aCarga = aBase + "def/dserpm05.mas";
     |CARGA_DEF aCarga, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #999;
     |SELECT #2#999;
     #999#0 = #5#0;
     #999#1 = #5#1;
     #999#4 = #5#4;
     #999#3 = "";
     |LEE 000#999];
     |SI FSalida = 0;  |Y #999#0 = #5#0;  |Y #999#1 = #5#1;
                       |Y #999#4 = #5#4;
         |SI #999#2 ! #5#2;
             aAlfa = "0000Numero de orden indicado corresponde al filtro " + &34 + #5#2;  |QBF aAlfa;
             aAlfa = aAlfa + &34 + ". " + "Debera indicar otro numero de orden";
             |MENAV aAlfa;
             |ERROR;
         |FINSI;
     |FINSI;
     |CIERRA #999;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Tipo7m5c2;  |TIPO 7;
     ||ENTLINEAL #1#6, -4, 7, 22, 0, ClaveBaja6, ClaveAlta6;
     |ENTLINEAL #1#16, -4, 7, 22, 0, ClaveBaja16, ClaveAlta16;
|FPRC;

|RUTINA ClaveBaja2m5;
     #2#0 = #5#0;
     #2#1 = "";
|FRUT;

|RUTINA ClaveAlta2m5;
     #2#0 = #5#0;
     #2#1 = "zzzzzzzz";
|FRUT;

|PROCESO Tipo66m5c2;  |TIPO 66;
     |ABRE #2;
     #2#0 = #5#0;
     #2#1 = #5#2;
     |LEE 040#2];

     |CONSULTA_F_CLAVE #1#2, ClaveBaja2m5, ClaveAlta2m5;
     |SI FSalida = 0;
         #5#2 = #2#1;  |PINTA #5#2;
         |ERROR;
         |PTEC 802;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Tipo0m5c2;  |TIPO 0;
     |ABRE #2;
     #2#0 = #5#0;
     #2#1 = #5#2;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |MENAV "0000 Filtro Inexistente";
         |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Tipo7m5c3;  |TIPO 7;
     #5#3 = #2#2;  |PINTA #5#3;
|FPRC;

|PROCESO Graba6;
     #6#0 = #5#0;
     #6#1 = #5#1;
     #6#2 = #5#2;
     #6#3 = #3#2;
     #6#4 = #3#3;
     |GRABA 020#6n;
|FPRC;

|DEFBUCLE dserpm03;
     #3#1;
     ;
     #5#0, #5#2, 000;
     #5#0, #5#2, 999;
     ;
     NULL, Graba6;
|FIN;

|PROCESO Graba16;
     #16#0 = #5#0;
     #16#1 = #5#1;
     #16#2 = #5#2;
     #16#3 = #13#2;
     #16#4 = #13#3;
     #16#5 = #13#4;
     |GRABA 020#16n;
|FPRC;

|DEFBUCLE dserpm13;
     #13#1;
     ;
     #5#0, #5#2, "        ", 000;
     #5#0, #5#2, "zzzzzzzz", 999;
     ;
     NULL, Graba16;
|FIN;

|PROCESO Tipo3m5;  |TIPO 3;
/*
     |ABRE #6;
     #6#0 = #5#0;
     #6#1 = #5#1;
     #6#2 = #5#2;
     #6#3 = 0;
     |LEE 040#6];
     |SI FSalida ! 0;  |O  #6#0 ! #5#0;  |O  #6#1 ! #5#1;  |O #6#2 ! #5#2;
         |BUCLE dserpm03;
     |FINSI;
     |CIERRA #6;

     |ENTLINEAL #1#6, -4, 2, 22, 0, ClaveBaja6, ClaveAlta6;
*/
     |ABRE #16;
     #16#0 = #5#0;
     #16#1 = #5#1;
     #16#2 = #5#2;
     #16#3 = "        ";
     #16#4 = 0;
     |LEE 040#16];
     |SI FSalida ! 0;  |O  #16#0 ! #5#0;  |O  #16#1 ! #5#1;  |O #16#2 ! #5#2;
         |BUCLE dserpm13;
     |FINSI;
     |CIERRA #16;

     |ENTLINEAL #1#16, -4, 2, 22, 0, ClaveBaja16, ClaveAlta16;
|FPRC;

|PROCESO Tipo2m5;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;  |ACABA;  |FINSI;

     |BUCLE dserpm06B;
|FPRC;

|| PROCESOS DEL dserpm04 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo7m4c1;  |TIPO 7;
     |ENTLINEAL #1#5, -3, 7, 17, 0, ClaveBaja5, ClaveAlta5;

     |ABRE #5;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = "";
     |LEE 040#5];
     |SI FSalida = 0;  |Y  #5#0 = #4#0;  |Y #5#1 = #4#1;
         ||ENTLINEAL #1#6, -4, 7, 22, 0, ClaveBaja6, ClaveAlta6;
         |ENTLINEAL #1#16, -4, 7, 22, 0, ClaveBaja16, ClaveAlta16;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO Tipo66m4c1;  |TIPO 66;
     |ABRE #99;
     #99#0 = #4#1;
     |LEE 040#99=;

     |CONSULTA_CLAVE #1#99;
     |SI FSalida = 0;
         #4#1 = #99#0;  |PINTA #4#1;
         |ERROR;
         |PTEC 802;
     |FINSI;
     |CIERRA #99;
|FPRC;

|PROCESO Tipo0m4c1;  |TIPO 0;
     |ABRE #99;
     #99#0 = #4#1;
     |LEE 040#99=;
     |SI FSalida ! 0;
         |MENAV "0000 Tabla inexistente.";
         |ERROR;
     |FINSI;
     |CIERRA #99;
|FPRC;

|PROCESO Tipo7m4c2;  |TIPO 7;
     #4#2 = #99#1;  |PINTA #4#2;
|FPRC;

|PROCESO Tipo3m4;  |TIPO 3;
     aFichero = ("03" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #98 aFichero;

     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     |ABRE #98;

     |DBASS aBase;  |QBF aBase;
     aAplica   = #1#1;  |QBF aAplica;
     aBaseDef  = aBase + aAplica + "/def/";
     aCarga    = aBaseDef + #4#1;  |QBF aCarga;
     |CARGA_DEF aCarga, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aAlfa      = #999#aQueQuiero#;
     nTCampo    = aAlfa;
     nTCampo    = nTCampo - 1;

     |PARA nCampo = 0;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aQueQuiero = "|C" + (("000" + nCampo) % -103) + "NOMBRE";
           aFichero   = (#999#aQueQuiero# + (" " * 20)) % 120;
           #98#0 = nCampo;
           #98#1 = aFichero;

           |GRABA 020#98n;
     |SIGUE;
     |CIERRA #98;

     |ENTLINEAL #1#5, -3, 2, 17, 0, ClaveBaja5, ClaveAlta5;

     |DELINDEX #98;
|FPRC;

|PROCESO Tipo2m4;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;  |ACABA;  |FINSI;

     |BUCLE dserpm05B;
|FPRC;

|PROCESO AsignaDoc; TIPO 0;
     aAlfa = #4#3;
     |C_M #4#4, 1, aAlfa;
|FPRC;
