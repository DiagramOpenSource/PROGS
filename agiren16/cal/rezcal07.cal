|FICHEROS;
      rem01033@ #33;
      rem01041@ #41;
      rem01042@ #42;

      rem00100;
      retabla1;
      retabla2;

     &refere1@;
     &refere2@;
     &refere3@;
|FIN;

|VARIABLES;
|FIN;

|INCLUYE i_varcal;

|PROCESO EstatalGeneral;
     |ABRE #retabla2;
     #retabla2#0 = nCodAutonomico;
     |LEE 040#retabla2.=;
     |SI FSalida ! 0;
         #retabla2#0 = 0;
         |LEE 040#retabla2.=;
         |SI FSalida ! 0;  |DDEFECTO #retabla2;  |FINSI;
     |FINSI;
     |CIERRA #retabla2;

     |PARA nCampo4 = 81;  |SI nCampo4 ] 45;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla2#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte1 = #retabla2#nCampo2#;
                   nResta1 = #retabla2#nCampo1#;
                   nTipo1  = #retabla2#nCampo4#;
               |SINO;
                   enLimite2 = #retabla2#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte1 = #retabla2#nCampo2#;
                       nResta1 = #retabla2#nCampo1#;
                       nTipo1  = #retabla2#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla2#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte1 = 0;
         nResta1 = 0;
         nTipo1  = #retabla2#45;
     |FINSI;
|FPRC;

|PROCESO AutonomicaGeneral
     |ABRE #retabla2;
     #retabla2#0 = nCodAutonomico;
     |LEE 040#retabla2.=;
     |SI FSalida ! 0;
         #retabla2#0 = 0;
         |LEE 040#retabla2.=;
         |SI FSalida ! 0;  |DDEFECTO #retabla2;  |FINSI;
     |FINSI;
     |CIERRA #retabla2;

     |PARA nCampo4 = 41;  |SI nCampo4 ] 5;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla2#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte2 = #retabla2#nCampo2#;
                   nResta2 = #retabla2#nCampo1#;
                   nTipo2  = #retabla2#nCampo4#;
               |SINO;
                   enLimite2 = #retabla2#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte2 = #retabla2#nCampo2#;
                       nResta2 = #retabla2#nCampo1#;
                       nTipo2  = #retabla2#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla2#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte2 = 0;
         nResta2 = 0;
         nTipo2  = #retabla2#5;
     |FINSI;
|FPRC;

|PROCESO TablaGeneral;
     nParte1   = 0;
     nResta1   = 0;
     nTipo1    = 0;
     nParte2   = 0;
     nResta2   = 0;
     nTipo2    = 0;

                              nCodAutonomico = #rem00100#11;
     |SI enConta        = 2;  nCodAutonomico = #rem00100#43;  |FINSI;
     |SI nCodAutonomico = 0;  nCodAutonomico = #rem00100#11;  |FINSI;

     |SI #rem00100#94 = "N";
         enLimite1 = 0;   |HAZ EstatalGeneral;
         enLimite2 = 0;   |HAZ AutonomicaGeneral
     |SINO;
         nCodAutonomico = 99;
         enLimite2      = 0;
         enLimite1      = 0;   |HAZ EstatalGeneral;
     |FINSI;
|FPRC;

|PROCESO Calcula486;
     nCuota1 = 0;
     nCuota2 = 0;
     nCuota3 = 0;
     nCuota4 = 0;

     enBloque  = 38;
     eaCasilla = "450"; |HAZ SacaImporte; nCuota = enImporte + nCas480;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota;
         nCuotaT = nCuota;
         |HAZ TablaGeneral;

         nCuota1   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota1 < 0;  nCuota1 = 0;  |FINSI;

         nCuota2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

         enBloque = 40; eaCasilla = "475"; |HAZ SacaImporte;
         nCuotaT  = enImporte;
         |HAZ TablaGeneral;

         nCuota3   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota3 < 0;  nCuota3 = 0;  |FINSI;

         nCuota4   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota4 < 0;  nCuota4 = 0;  |FINSI;

         enSwAcum  = 0;
         enBloque  = 42;
         eaCasilla = "486";
         enImporte = nCuota1 - nCuota3;
         |HAZ GrabaLineal;

         enSwAcum  = 0;
         enBloque  = 43;
         eaCasilla = "487";
         enImporte = nCuota2 - nCuota4;
         |HAZ GrabaLineal;

         |SI nAnuHijos ! 0;
             enSwAcum   = 0;
             enBloque   = 41;
             eaCasilla  = "481";  enImporte  = 0;  |HAZ GrabaLineal;
         |FINSI;
         nAnuHijos = 0;
     |SINO;
         |SI nCuota = 0;  |ACABA; |FINSI;

         enImporte  = nAnuHijos;

         nCuotaT  = enImporte;
         |HAZ TablaGeneral;

         nCuota1   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota1 < 0;  nCuota1 = 0;  |FINSI;

         nCuota2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

         nCuotaT  = nCuota - nAnuHijos;
         |HAZ TablaGeneral;

         nCuota3   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota3 < 0;  nCuota3 = 0;  |FINSI;

         nCuota4   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota4 < 0;  nCuota4 = 0;  |FINSI;

         enBloque = 40; eaCasilla = "475"; |HAZ SacaImporte;
         nCuotaT  = enImporte + 1980;
         |HAZ TablaGeneral;

         nCuota5   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         |SI nCuota5 < 0;  nCuota5 = 0;  |FINSI;

         nCuota6   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         |SI nCuota6 < 0;  nCuota6 = 0;  |FINSI;

         enSwAcum  = 0;
         enBloque  = 42;
         eaCasilla = "486";
         enImporte = nCuota1 + nCuota3 - nCuota5;
         |HAZ GrabaLineal;

         enSwAcum  = 0;
         enBloque  = 43;
         eaCasilla = "487";
         enImporte = nCuota2 + nCuota4 - nCuota6;
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Calcula482;
     enBloque = 38; eaCasilla = "450"; |HAZ SacaImporte; nCuota = enImporte;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota;
         nCuotaT = nCuota;

         |HAZ TablaGeneral;

         |SI nCuota < 0;  nCuota = 0;  |FINSI;

         enSwAcum  = 0;
         enBloque  = 42;
         eaCasilla = "482";

         nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
         enImporte = nValor2;
         |HAZ GrabaLineal;

         enSwAcum  = 0;
         enBloque  = 43;
         eaCasilla = "483";

         nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
         enImporte = nValor2;
         |HAZ GrabaLineal;

         |SI nAnuHijos ! 0;
             enSwAcum   = 0;
             enBloque   = 41;
             eaCasilla  = "481"; enImporte  = 0;  |HAZ GrabaLineal;
         |FINSI;

         nAnuHijos = 0;
     |SINO;
         |SI nCuota = 0;  |ACABA; |FINSI;

         enImporte  = nAnuHijos;

         enSwAcum   = 0;
         enBloque   = 42;
         eaCasilla  = "482";
         enImporte  = nCuota - nAnuHijos;
         |SI enImporte < 0;  enImporte = 0;  |FINSI;
         |HAZ GrabaLineal;

         nCuota1   = enImporte;

         nCuota    = nAnuHijos;
         nCuotaT   = nAnuHijos;
         |HAZ TablaGeneral;

         || Calcula Cuota Estatal 1¦ Base

         nValor1   = (nParte1 + (((nCuota - nResta1) * nTipo1) / 100)) ! 2;
         nVEstatal1 = nValor1 ! 2;

         || Calcula Cuota Autonomica 1¦ Base

         nValor1   = (nParte2 + (((nCuota - nResta2) * nTipo2) / 100)) ! 2;
         nVAutonom1 = nValor1 ! 2;

         || Calcula Cuota Estatal 2¦ Base

         nCuota   = nCuota1;
         nCuotaT  = nCuota1;
         |HAZ TablaGeneral;

         nValor1  = (nParte1 + (((nCuota - nResta1) * nTipo1) / 100)) ! 2;
         nVEstatal2 = nValor1 ! 2;

         || Calcula Cuota Autonomica 2¦ Base

         nValor1   = (nParte2 + (((nCuota - nResta2) * nTipo2) / 100)) ! 2;
         nVAutonom2 = nValor1 ! 2;

         enSwAcum   = 0;
         enBloque   = 42;
         eaCasilla  = "482";
         enImporte  = (nVEstatal1 + nVEstatal2) ! 2;
         |HAZ GrabaLineal;

         enSwAcum   = 0;
         enBloque   = 43;
         eaCasilla  = "483";
         enImporte  = (nVAutonom1 + nVAutonom2) ! 2;
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Calcula484;
     enBloque = 40; eaCasilla = "475"; |HAZ SacaImporte; nCuota       = enImporte;
     enBloque = 38; eaCasilla = "450"; |HAZ SacaImporte; nCuota2      = enImporte;

     |SI nCuota  < 0;  nCuota = 0;  |FINSI;
     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota2;
         nCuotaT = nCuota;
     |SINO;
         nCuotaT = nCuota + 1980;
     |FINSI;

     |HAZ TablaGeneral;

     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     enBloque = 42; eaCasilla = "482"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     enBloque  = 42;
     eaCasilla = "484";

     nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula485;
     enBloque = 40; eaCasilla = "477"; |HAZ SacaImporte; nCuota   = enImporte;
     enBloque = 38; eaCasilla = "450"; |HAZ SacaImporte; nCuota2  = enImporte;

     |SI nCuota  < 0;  nCuota = 0;   |FINSI;
     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

     |SI nAnuHijos = 0;  |O nAnuHijos > nCuota2;
         nCuotaT = nCuota;
     |SINO;
         nCuotaT = nCuota + 1980;
     |FINSI;

     |HAZ TablaGeneral;

     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     enBloque = 43; eaCasilla = "483"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     enBloque  = 43;
     eaCasilla = "485";

     nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula488;
     |SI nCas480 ! 0;
         |HAZ Calcula486;
     |SINO;
         |HAZ Calcula482;
         |HAZ Calcula484;
         |HAZ Calcula485;
     |FINSI;

     |SI nCas480 = 0;
         nValor = 0;
         enBloque = 42; eaCasilla = "482"; |HAZ SacaImporte; nValor = enImporte;
         enBloque = 42; eaCasilla = "484"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         enBloque   = 42;
         eaCasilla  = "486";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         nValor = 0;
         enBloque = 43; eaCasilla = "483"; |HAZ SacaImporte; nValor = enImporte;
         enBloque = 43; eaCasilla = "485"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         enBloque   = 43;
         eaCasilla  = "487";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         enBloque = 38; eaCasilla = "450"; |HAZ SacaImporte; nValor2 = enImporte;
         enBloque = 42; eaCasilla = "486"; |HAZ SacaImporte; nValor1 = enImporte;
     |SINO;
         enBloque = 38; eaCasilla = "450"; |HAZ SacaImporte; nValor2 = enImporte + nCas480;
         enBloque = 42; eaCasilla = "486"; |HAZ SacaImporte; nValor1 = enImporte;
     |FINSI;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     enBloque   = 42;
     eaCasilla  = "488";
     |HAZ GrabaLineal;

     |SI nCas480 ! 0;
         nPorce     = enImporte;
         enBloque   = 38; eaCasilla = "450"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;

         enSwAcum   = 0;
         enBloque   = 42;
         eaCasilla  = "486";
         |HAZ GrabaLineal;
     |FINSI;

     enBloque = 43; eaCasilla = "487"; |HAZ SacaImporte; nValor1 = enImporte;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     enBloque   = 43;
     eaCasilla  = "489";
     |HAZ GrabaLineal;

     |SI nCas480 ! 0;
         nPorce     = enImporte;
         enBloque   = 38; eaCasilla = "450"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;
         enSwAcum   = 0;
         enBloque   = 43;
         eaCasilla  = "487";
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO EstatalAhorro;
     enLimite1 = 0;
     enLimite2 = 0;

     |ABRE #retabla1;
     #retabla1#0 = nCodAutonomico;
     |LEE 040#retabla1.=;
     |SI FSalida ! 0;
         #retabla1#0 = 0;
         |LEE 040#retabla1.=;
         |SI FSalida ! 0;  |DDEFECTO #retabla1;  |FINSI;
     |FINSI;
     |CIERRA #retabla1;

     |PARA nCampo4 = 81;  |SI nCampo4 ] 45;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla1#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte1 = #retabla1#nCampo2#;
                   nResta1 = #retabla1#nCampo1#;
                   nTipo1  = #retabla1#nCampo4#;
               |SINO;
                   enLimite2 = #retabla1#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte1 = #retabla1#nCampo2#;
                       nResta1 = #retabla1#nCampo1#;
                       nTipo1  = #retabla1#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla1#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte1 = 0;
         nResta1 = 0;
         nTipo1  = #retabla1#45;
     |FINSI;

     enLimite1 = 0;
     enLimite2 = 0;

     |PARA nCampo4 = 41;  |SI nCampo4 ] 5;  |HACIENDO nCampo4 = nCampo4 - 4;
           |SI #retabla1#nCampo4# ! 0;
               nCampo1 = nCampo4 - 3;
               nCampo2 = nCampo4 - 2;
               |SI enLimite1 = 0;
                   nParte2 = #retabla1#nCampo2#;
                   nResta2 = #retabla1#nCampo1#;
                   nTipo2  = #retabla1#nCampo4#;
               |SINO;
                   enLimite2 = #retabla1#nCampo1#;
                   |SI nCuotaT [ enLimite1;  |Y nCuotaT > enLimite2;
                       nParte2 = #retabla1#nCampo2#;
                       nResta2 = #retabla1#nCampo1#;
                       nTipo2  = #retabla1#nCampo4#;
                   |FINSI;
               |FINSI;
               enLimite1 = #retabla1#nCampo1#;
           |FINSI;
     |SIGUE;

     |SI nCuotaT = 0;
         nParte2 = 0;
         nResta2 = 0;
         nTipo2  = #retabla1#45;
     |FINSI;
|FPRC;

|PROCESO TablaAhorro;
     nParte1        = 0;
     nResta1        = 0;
     nTipo1         = 0;
     nParte2        = 0;
     nResta2        = 0;
     nTipo2         = 0;
     nCodAutonomico = 0;

     |SI #rem00100#94 ! "N";
         nCodAutonomico = 99;
     |FINSI;

     |HAZ EstatalAhorro;
|FPRC;

|PROCESO Calcula494;
     nCuota1 = 0;
     nCuota2 = 0;
     nCuota3 = 0;
     nCuota4 = 0;

     enBloque  = 39;
     eaCasilla = "455"; |HAZ SacaImporte; nCuota = enImporte + nCas479;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;

     nCuota1   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nCuota1 < 0;  nCuota1 = 0;  |FINSI;

     nCuota2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

     enBloque = 40; eaCasilla = "476"; |HAZ SacaImporte;
     nCuotaT  = enImporte;
     |HAZ TablaAhorro;

     nCuota3   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nCuota3 < 0;  nCuota3 = 0;  |FINSI;

     nCuota4   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nCuota4 < 0;  nCuota4 = 0;  |FINSI;

     enSwAcum  = 0;
     enBloque  = 42;
     eaCasilla = "494";
     enImporte = nCuota1 - nCuota3;
     |HAZ GrabaLineal;

     enSwAcum  = 0;
     enBloque  = 43;
     eaCasilla = "495";
     enImporte = nCuota2 - nCuota4;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula490;
     enBloque = 39; eaCasilla = "455"; |HAZ SacaImporte; nCuota = enImporte;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     enSwAcum  = 0;
     enBloque  = 42;
     eaCasilla = "490";

     nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     enImporte = nValor2;
     |HAZ GrabaLineal;

     enSwAcum  = 0;
     enBloque  = 43;
     eaCasilla = "491";

     nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula492;
     enBloque = 40; eaCasilla = "476"; |HAZ SacaImporte; nCuota  = enImporte;
     enBloque = 39; eaCasilla = "455"; |HAZ SacaImporte; nCuota2 = enImporte;

     |SI nCuota  < 0;  nCuota = 0;  |FINSI;
     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     enBloque = 42; eaCasilla = "490"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     enBloque  = 42;
     eaCasilla = "492";

     nValor2   = (nParte1 + (((nCuotaT - nResta1) * nTipo1) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula493;
     enBloque = 40; eaCasilla = "478"; |HAZ SacaImporte; nCuota  = enImporte;
     enBloque = 39; eaCasilla = "455"; |HAZ SacaImporte; nCuota2 = enImporte;

     |SI nCuota  < 0;  nCuota = 0;   |FINSI;
     |SI nCuota2 < 0;  nCuota2 = 0;  |FINSI;

     nCuotaT = nCuota;
     |HAZ TablaAhorro;
     |SI nCuota < 0;  nCuota = 0;  |FINSI;

     enBloque = 43; eaCasilla = "491"; |HAZ SacaImporte; nValor1 = enImporte;

     enSwAcum  = 0;
     enBloque  = 43;
     eaCasilla = "493";

     nValor2   = (nParte2 + (((nCuotaT - nResta2) * nTipo2) / 100)) ! 2;
     |SI nValor2 > nValor1;  nValor2 = nValor1;  |FINSI;

     enImporte = nValor2;
     |HAZ GrabaLineal;
|FPRC;

|PROCESO Calcula496;
     |SI nCas479 ! 0;
         |HAZ Calcula494;
     |SINO;
         |HAZ Calcula490;
         |HAZ Calcula492;
         |HAZ Calcula493;
     |FINSI;

     |SI nCas479 = 0;
         nValor = 0;
         enBloque = 42; eaCasilla = "490"; |HAZ SacaImporte; nValor = enImporte;
         enBloque = 42; eaCasilla = "492"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         enBloque   = 42;
         eaCasilla  = "494";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         nValor = 0;
         enBloque = 43; eaCasilla = "491"; |HAZ SacaImporte; nValor = enImporte;
         enBloque = 43; eaCasilla = "493"; |HAZ SacaImporte; nValor = nValor - enImporte;
         |SI nValor < 0;  nValor = 0;  |FINSI;

         enSwAcum   = 0;
         enBloque   = 43;
         eaCasilla  = "495";
         enImporte  = nValor;
         |HAZ GrabaLineal;

         enBloque = 39; eaCasilla = "455"; |HAZ SacaImporte; nValor2 = enImporte;
         enBloque = 42; eaCasilla = "494"; |HAZ SacaImporte; nValor1 = enImporte;
     |SINO;
         enBloque = 39; eaCasilla = "455"; |HAZ SacaImporte; nValor2 = enImporte + nCas479;
         enBloque = 42; eaCasilla = "494"; |HAZ SacaImporte; nValor1 = enImporte;
     |FINSI;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     enBloque   = 42;
     eaCasilla  = "496";
     |HAZ GrabaLineal;

     |SI nCas479 ! 0;
         nPorce     = enImporte;
         enBloque   = 39; eaCasilla = "455"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;

         enSwAcum   = 0;
         enBloque   = 42;
         eaCasilla  = "494";
         |HAZ GrabaLineal;
     |FINSI;

     enBloque = 43; eaCasilla = "495"; |HAZ SacaImporte; nValor1 = enImporte;

     enImporte  = (((nValor1 * 100) / nValor2) - 0.0049) ! 2;
     |SI enImporte < 0;  enImporte = 0;  |FINSI;

     enSwAcum   = 0;
     enBloque   = 43;
     eaCasilla  = "497";
     |HAZ GrabaLineal;

     |SI nCas479 ! 0;
         nPorce    = enImporte;
         enBloque  = 39; eaCasilla = "455"; |HAZ SacaImporte; nValor1 = enImporte;
         enImporte  = (nValor1 % nPorce) ! 2;
         enSwAcum   = 0;
         enBloque   = 43;
         eaCasilla  = "495";
         |HAZ GrabaLineal;
     |FINSI;
|FPRC;

|PROCESO Ajusta1;
     |SI nAjuste = 0;  |ACABA;  |FINSI;

     nAcumLimite = nAcumLimite + nAjuste;
     |SI nLimite < nAcumLimite;
         nAjuste     = nAjuste - (nAcumLimite - nLimite);
         nAcumLimite = nLimite;
     |FINSI;
|FPRC;

|PROCESO Donaciones;
     enBloque = 38;  eaCasilla = "445"; |HAZ SacaImporte; nCuota = enImporte;
     enBloque = 39;  eaCasilla = "455"; |HAZ SacaImporte; nCuota = nCuota + enImporte;

     nAjuste10 = nCuota % 10;
     nAjuste15 = nCuota % 15;

     |SI #rem01041@#36 < 0;  #rem01041@#36 = 0;  |FINSI;
     |SI #rem01041@#38 < 0;  #rem01041@#38 = 0;  |FINSI;
     |SI #rem01041@#40 < 0;  #rem01041@#40 = 0;  |FINSI;
     |SI #rem01041@#42 < 0;  #rem01041@#42 = 0;  |FINSI;

     nValor    = #rem01041@#46;
     |SI nValor > nAjuste10;  |Y nValor > 0;
         #rem01041@#46 = nAjuste10;
         #rem01041@#47 = (N\ #rem01041@#46 % 15);
     |FINSI;

     #rem01041@#48 = (N\ #rem01041@#47 % 50);
     #rem01041@#49 = (N\ #rem01041@#47 - #rem01041@#48);

     nValor = #rem01041@#36 + #rem01041@#89;
     |SI nAjuste15 > 0;  |Y nValor > 0;
         |SI #rem01041@#36 > nAjuste15;
             #rem01041@#36 = nAjuste15;
             nAjuste15    = 0;
         |SINO;
             nAjuste15 = nAjuste15 - #rem01041@#36;
         |FINSI;

         |SI nAjuste15 > 0;
             |SI #rem01041@#89 > nAjuste15;
                 #rem01041@#89 = nAjuste15;
                 nAjuste15    = 0;
             |SINO;
                 nAjuste15 = nAjuste15 - #rem01041@#89;
             |FINSI;
         |SINO;
              #rem01041@#89 = 0;
         |FINSI;

         nBase1 = 0;
         nBase2 = 0;
         nBase3 = 0;
         nResto = #rem01041@#36 + #rem01041@#89;
         |SI nResto > 0;
             nBase1 = nResto;
             |SI nResto ] 150;  nBase1 = 150;  |FINSI;
             nResto = nResto - nBase1;

             |SI nResto [ 0;
                 #rem01041@#36 = 0;
                 #rem01041@#89 = 0;
             |FINSI;

             |SI #rem01041@#36 > 0;
                 |SI #rem01041@#36 > nBase1;
                     nBase2 = #rem01041@#36 - nBase1;
                 |FINSI;

                 nResto = nResto - nBase2;
             |FINSI;

             |SI nResto [ 0;
                 #rem01041@#89 = 0;
             |FINSI;

             |SI #rem01041@#89 > 0;
                 nBase3 = nResto;
             |FINSI;
         |FINSI;

         #rem01041@#36 = (N\ nBase1 + nBase2 + nBase3);
         #rem01041@#37 = (N\ nBase1 % 80) + (N\ nBase2 % 35) + (N\ nBase3 % 40);
     |SINO;
          #rem01041@#36 = 0;
          #rem01041@#37 = 0;
          #rem01041@#89 = 0;
     |FINSI;

     nAjuste10 = (nCuota % 10) - #rem01041@#36;
     |SI nAjuste10 < 0;  nAjuste10 = 0;  |FINSI;

     nValor = #rem01041@#38 + #rem01041@#90;
     |SI nAjuste10 > 0;  |Y nValor > 0;
         |SI #rem01041@#38 > nAjuste10;
             #rem01041@#38 = nAjuste10;
             nAjuste10    = 0;
         |SINO;
             nAjuste10 = nAjuste10 - #rem01041@#38;
         |FINSI;

         |SI nAjuste10 > 0;
             |SI #rem01041@#90 > nAjuste10;
                 #rem01041@#90 = nAjuste10;
                 nAjuste10    = 0;
             |SINO;
                 nAjuste10 = nAjuste10 - #rem01041@#90;
             |FINSI;
         |SINO;
              #rem01041@#90 = 0;
         |FINSI;

         nBase1 = 0;
         nBase2 = 0;
         nBase3 = 0;
         nResto = #rem01041@#38 + #rem01041@#90;
         |SI nResto > 0;
             nBase1 = nResto;
             |SI nResto ] 150;  nBase1 = 150;  |FINSI;
             nResto = nResto - nBase1;

             |SI nResto [ 0;
                 #rem01041@#38 = 0;
                 #rem01041@#90 = 0;
             |FINSI;

             |SI #rem01041@#38 > 0;
                 |SI #rem01041@#38 > nBase1;
                     nBase2 = #rem01041@#38 - nBase1;
                 |FINSI;

                 nResto = nResto - nBase2;
             |FINSI;

             |SI nResto [ 0;
                 #rem01041@#90 = 0;
             |FINSI;

             |SI #rem01041@#90 > 0;
                 nBase3 = nResto;
             |FINSI;
         |FINSI;

         #rem01041@#38 = (N\ nBase1 + nBase2 + nBase3);
         #rem01041@#39 = (N\ nBase1 % 75) + (N\ nBase2 % 30) + (N\ nBase3 % 35);
     |SINO;
          #rem01041@#38 = 0;
          #rem01041@#39 = 0;
          #rem01041@#90 = 0;
     |FINSI;

     |SI nAjuste10 > 0;  |Y #rem01041@#40 > 0;
         |SI #rem01041@#40 > nAjuste10;
             #rem01041@#40 = nAjuste10;
             nAjuste10    = 0;
         |SINO;
             nAjuste10 = nAjuste10 - #rem01041@#40;
         |FINSI;

          #rem01041@#41 = (N\ #rem01041@#40 % 10);
     |SINO;
          #rem01041@#40 = 0;
          #rem01041@#41 = 0;
     |FINSI;

     |SI nAjuste10 > 0;  |Y #rem01041@#42 > 0;
         |SI #rem01041@#42 > nAjuste10;
             #rem01041@#42 = nAjuste10;
             nAjuste10    = 0;
         |SINO;
             nAjuste10 = nAjuste10 - #rem01041@#42;
         |FINSI;

          #rem01041@#43 = (N\ #rem01041@#42 % 20);
     |SINO;
          #rem01041@#42 = 0;
          #rem01041@#43 = 0;
     |FINSI;

     #rem01041@#44 = 0;
     #rem01041@#45 = 0;

     nValor = (N\ (#rem01041@#37 + #rem01041@#39 + #rem01041@#41 + #rem01041@#43));
     |SI nValor > 0;
         #rem01041@#44 = (N\ (#rem01041@#37 + #rem01041@#39 + #rem01041@#41 + #rem01041@#43) % 50);
         #rem01041@#45 = (N\ (#rem01041@#37 + #rem01041@#39 + #rem01041@#41 + #rem01041@#43) - #rem01041@#44);
     |FINSI;
|FPRC;

|PROCESO Anexo1Punto1;
     nAcumLimite = 0;

     nLimite = 9040;
     nTope   = nLimite / 2;

     nAjuste = #rem01041@#64;  |HAZ Ajusta1;  #rem01041@#64  = nAjuste;
     nAjuste = #rem01041@#65;  |HAZ Ajusta1;  #rem01041@#65  = nAjuste;
     nAjuste = #rem01041@#66;  |HAZ Ajusta1;  #rem01041@#66  = nAjuste;
     nAjuste = #rem01041@#67;  |HAZ Ajusta1;  #rem01041@#67  = nAjuste;
     nAjuste = #rem01041@#71;  |HAZ Ajusta1;  #rem01041@#71  = nAjuste;

     nAjuste  = #rem01041@#64 + #rem01041@#65 + #rem01041@#66;
     nAjuste2 = 0;
     |SI nAjuste > nTope;
         nAjuste2 = nAjuste - nTope;
         nAjuste  = nTope;
     |FINSI;

     nPorce1 = 7.5;
     nPorce2 = 7.5;
     nPorce3 = 7.5;
     nPorce4 = 7.5;

     |SI #rem01041@#19 < "30.07.2011";   || No cambiar esto es fijo
         |SI nCatalunyaA ! 0;
             |SI enConta = 1;  |Y eaMuerto = "T";  |Y efFechaMuerto < "30.07.2011";
                 nPorce2 =  6;  nPorce4 =  6;
             |FINSI;
             |SI enConta = 2;  |Y eaMuerto = "C";  |Y efFechaMuerto < "30.07.2011";
                 nPorce2 =  6;  nPorce4 =  6;
             |FINSI;
         |FINSI;

         |SI nCatalunyaB ! 0;  nPorce2 =  9;  nPorce4 =  9;  |FINSI;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;
     #rem01041@#3    = nAjuste + nAjuste2;
     #rem01041@#4    = nValor1;
     #rem01041@#5    = nValor2;

     nAjuste  = #rem01041@#67;
     nAjuste2 = 0;
     nLimitee = nTope - #rem01041@#64 - #rem01041@#65 - #rem01041@#66;
     |SI nLimitee < 0;
         nLimitee = 0;
     |FINSI;

     |SI #rem01041@#67 > nLimitee;
         nAjuste  = nLimitee;
         nAjuste2 = #rem01041@#67 - nLimitee;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;
     #rem01041@#6    = nAjuste + nAjuste2;
     #rem01041@#7    = nValor1;
     #rem01041@#8    = nValor2;

     nAjuste  = #rem01041@#71;
     nAjuste2 = 0;
     nLimitee = nTope - #rem01041@#64 - #rem01041@#65 - #rem01041@#66 - #rem01041@#67;
     |SI nLimitee < 0;  nLimitee = 0;  |FINSI;

     |SI #rem01041@#71 > nLimitee;
         nAjuste  = nLimitee;
         nAjuste2 = #rem01041@#71 - nLimitee;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;
     #rem01041@#9    = nAjuste + nAjuste2;
     #rem01041@#10   = nValor1;
     #rem01041@#11   = nValor2;
|FPRC;

|PROCESO Anexo1Punto2;
     nAcumLimite = 0;

     nLimite = 12080;
     nTope   = nLimite / 2;

     nAjuste = #rem01041@#68;  |HAZ Ajusta1;  #rem01041@#68 = nAjuste;
     nAjuste = #rem01041@#69;  |HAZ Ajusta1;  #rem01041@#69 = nAjuste;
     nAjuste = #rem01041@#70;  |HAZ Ajusta1;  #rem01041@#70 = nAjuste;

     nAjuste  = #rem01041@#68 + #rem01041@#69 + #rem01041@#70;
     nAjuste2 = 0;
     |SI nAjuste > nTope;
         nAjuste2 = nAjuste - nTope;
         nAjuste  = nTope;
     |FINSI;

     nPorce1 = 10;
     nPorce2 = 10;
     nPorce3 = 10;
     nPorce4 = 10;

     |SI #rem01041@#19 < "30.07.2011";
         |SI nCatalunyaA ! 0;  nPorce2 =  15;  nPorce4 = 15;  |FINSI;
         |SI nCatalunyaB ! 0;  nPorce2 =  15;  nPorce4 = 15;  |FINSI;
     |SINO;
         |SI nCatalunyaA ! 0;  nPorce2 =  12;  nPorce4 = 12;  |FINSI;
         |SI nCatalunyaB ! 0;  nPorce2 =  12;  nPorce4 = 12;  |FINSI;
     |FINSI;

     nValor1 = ((nAjuste % nPorce1) + (nAjuste2 % nPorce3)) ! 2;
     nValor2 = ((nAjuste % nPorce2) + (nAjuste2 % nPorce4)) ! 2;

     #rem01041@#12   = nAjuste + nAjuste2;
     #rem01041@#13   = nValor1;
     #rem01041@#14   = nValor2;
|FPRC;

|PROCESO AnexoMejoras;
     nAcumLimite = 0;
     nLimite     = 0;

     |SI nLimiteGral < 53007.20;
         nLimite = 4000;
         |SI nLimiteGral > 33007.20;
             nLimite = 4000 - ((nLimiteGral - 33007.20) * 0.2);
             |SI nLimite > 4000;
                 nLimite = 4000;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nLimiteGral < 71007.20;
         nLimite = 6750;
         |SI nLimiteGral > 53007.20;
             nLimite = 6750 - ((nLimiteGral - 53007.20) * 0.375);
             |SI nLimite > 6750;
                 nLimite = 6750;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nLimite > 0;
         nValor = #rem01041@#56;
         |SI nValor > 20000;  #rem01041@#56 = 20000;  |FINSI;
         nValor = #rem01041@#56;

         |SI nValor > nLimite;
             nValor  = nLimite;
             nLimite = 0;
         |SINO;
             nLimite = nLimite - nValor;
         |FINSI;

         #rem01041@#57  = nValor;
         nValor = nValor % 20;
         #rem01041@#58  = nValor;
     |SINO;
         #rem01041@#56 = 0;
         #rem01041@#57 = 0;
         #rem01041@#58 = 0;
     |FINSI;
|FPRC;

|PROCESO CalculaAnexoA;
     aDef    = eaPathDef + "rem01041.mas";
     |CARGA_DEF aDef, rem01041@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01041@#"zdat1041"#;  |FINSI;

     |ABRE #rem01041@;
     #rem01041@#0 = #refere1@#0;
     #rem01041@#1 = #refere1@#1;
     #rem01041@#2 = #refere1@#2;
     |LEE 101#rem01041@.=;
     |SI FSalida ! 0;
         |DDEFECTO #rem01041@;
         #rem01041@#0 = #refere1@#0;
         #rem01041@#1 = #refere1@#1;
         #rem01041@#2 = #refere1@#2;
         |GRABA 020#rem01041@.b;
     |FINSI;

     nLimiteGral = 0;
     enBloque = 29;  eaCasilla = "392"; |HAZ SacaImporte; nLimiteGral = nLimiteGral + enImporte;
     enBloque = 30;  eaCasilla = "405"; |HAZ SacaImporte; nLimiteGral = nLimiteGral + enImporte;

|| Vivienda habitual

     nCatalunyaA = 0;
     nCatalunyaB = 0;

     |SI #rem01041@#78 = "1";  nCatalunyaA = 1;  |FINSI;
     |SI #rem01041@#78 = "2";  nCatalunyaB = 1;  |FINSI;

     |HAZ Anexo1Punto1;
     |HAZ Anexo1Punto2;

     #rem01041@#15   = (N\ #rem01041@#4 + #rem01041@#7 + #rem01041@#10 + #rem01041@#13);
     #rem01041@#16   = (N\ #rem01041@#5 + #rem01041@#8 + #rem01041@#11 + #rem01041@#14);

|| Emresas de nueva creacion

     nValor = #rem01041@#25;
     |SI nValor > 50000;
         nValor = 50000;
     |FINSI;

     #rem01041@#25  = nValor;
     nValor = nValor % 20;
     #rem01041@#26  = nValor;

|| Alquiler de la vivienda habitual

     nValor = #rem01041@#32;

     |SI nLimiteGral < 24107.20;
         |SI nLimiteGral [ 17707.20;
             |SI nValor > 9040;
                 nValor = 9040;
             |FINSI;
         |FINSI;

         |SI nLimiteGral > 17707.20;
             nLimite = 9040 - ((nLimiteGral - 17707.20) * 1.4125);
             |SI nValor > nLimite;
                 nValor = nLimite;
             |FINSI;
         |FINSI;

         #rem01041@#32  = nValor;
         nValor = nValor % 10.05;
         #rem01041@#33  = nValor;

         nValor1 = nValor / 2;

         #rem01041@#34  = nValor1;
         #rem01041@#35  = (N\ (nValor - nValor1));
     |SINO;
         #rem01041@#27 = "";
         #rem01041@#28 = "";
         #rem01041@#29 = "";
         #rem01041@#30 = "";
         #rem01041@#31 = 0;
         #rem01041@#32 = 0;
         #rem01041@#33 = 0;
         #rem01041@#34 = 0;
         #rem01041@#35 = 0;
     |FINSI;

|| Obras de mejora de la vivienda habitual

     |HAZ AnexoMejoras;

|| Donaciones

     |HAZ Donaciones;

|| Ceuta y Melilla

     enBloque = 42;  eaCasilla = "499"; |HAZ SacaImporte; nCuotaIntegra = enImporte;
     enBloque = 43;  eaCasilla = "500"; |HAZ SacaImporte; nCuotaIntegra = nCuotaIntegra + enImporte;
     enBloque = 42;  eaCasilla = "514"; |HAZ SacaImporte; nValor2       = enImporte;
     enBloque = 43;  eaCasilla = "515"; |HAZ SacaImporte; nValor2       = nValor2 + enImporte;

     nValor1 = nCuotaIntegra % 50;

     |SI nValor2 > nValor1;
         #rem01041@#50   = nValor1;
     |SINO;
         #rem01041@#50   = nValor2;
     |FINSI;

     nValor  = #rem01041@#50;
     nValor1 = (nValor % 50) ! 2;
     nValor2 = nValor - nValor1;

     #rem01041@#51 = nValor1;
     #rem01041@#52 = nValor2;

     |GRABA 020#rem01041@.a;
     |LIBERA #rem01041@;
     |CIERRA #rem01041@;

     enSwAcum  = 0;

     enBloque  = 42;
     eaCasilla = "501";  enImporte = #rem01041@#15;  |HAZ GrabaLineal;
     eaCasilla = "503";  enImporte = #rem01041@#26;  |HAZ GrabaLineal;
     eaCasilla = "504";  enImporte = #rem01041@#48;  |HAZ GrabaLineal;
     eaCasilla = "506";  enImporte = #rem01041@#44;  |HAZ GrabaLineal;
     eaCasilla = "514";  enImporte = #rem01041@#51;  |HAZ GrabaLineal;
     eaCasilla = "516";  enImporte = #rem01041@#34;  |HAZ GrabaLineal;
     eaCasilla = "518";  enImporte = #rem01041@#58;  |HAZ GrabaLineal;

     enBloque  = 43;
     eaCasilla = "502";  enImporte = #rem01041@#16;  |HAZ GrabaLineal;
     eaCasilla = "505";  enImporte = #rem01041@#49;  |HAZ GrabaLineal;
     eaCasilla = "507";  enImporte = #rem01041@#45;  |HAZ GrabaLineal;
     eaCasilla = "515";  enImporte = #rem01041@#52;  |HAZ GrabaLineal;
     eaCasilla = "517";  enImporte = #rem01041@#35;  |HAZ GrabaLineal;
     |DESCARGA_DEF #rem01041@;
|FPRC;

|PROCESO Deduce;
     |SI nAcum = 0;     nAplicado = 0;  |ACABA;  |FINSI;
     |SI nLimiteT [ 0;  nAplicado = 0;  |ACABA;  |FINSI;

     nAcum = nAcum - nDeducido;
     |SI nAcum ] 0
         nAplicado = nDeducido;
     |SINO;
         nAplicado = nDeducido + nAcum;
         nAcum     = 0;
     |FINSI;

     nLimiteT = nLimiteT - nAplicado;
     |SI nLimiteT < 0;
         nAplicado = nAplicado + nLimiteT;
         nLimiteT  = 0;
     |FINSI;
|FPRC;

|PROCESO CalculaAnexoC;
     aDef    = eaPathDef + "rem01042.mas";
     |CARGA_DEF aDef, rem01042@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01042@#"zdat1042"#;  |FINSI;

     |ABRE #rem01042@;
     #rem01042@#0 = #refere1@#0;
     #rem01042@#1 = #refere1@#1;
     #rem01042@#2 = #refere1@#2;
     |LEE 101#rem01042@.=;
     |SI FSalida ! 0;
         |CIERRA #rem01042@;
         |DESCARGA_DEF #rem01042@;
         |ACABA;
     |FINSI;

     nValor   = 0;
     enBloque = 42; eaCasilla = "499"; |HAZ SacaImporte; nValor = nValor + enImporte;
     enBloque = 43; eaCasilla = "500"; |HAZ SacaImporte; nValor = nValor + enImporte;
     nLimiteT = nValor;

     enBloque = 42; eaCasilla = "501"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 43; eaCasilla = "502"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 42; eaCasilla = "503"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 42; eaCasilla = "504"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 43; eaCasilla = "505"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 42; eaCasilla = "506"; |HAZ SacaImporte; nValor = nValor - enImporte;
     enBloque = 43; eaCasilla = "507"; |HAZ SacaImporte; nValor = nValor - enImporte;

     |SI nValor < 0;  nValor = 0;  |FINSI;

     nLimite25  = (nValor % 25) ! 2;
     nLimite35  = (nValor % 35) ! 2;
     nLimite50  = (nValor % 50) ! 2;
     nLimite60  = (nValor % 60) ! 2;
     nLimite70  = (nValor % 70) ! 2;
     nLimite90  = (nValor % 90) ! 2;
     nLimite100 = nValor;

                               nAcum = nLimite25;
     |SI #rem01042@#186 = 2;   nAcum = nLimite50;  |FINSI;

     |PARA nCampo1 = 4;  |SI nCampo1 [ 136;  |HACIENDO nCampo1 = nCampo1 + 3;
           nDeducido = #rem01042@#nCampo1#;
           |HAZ Deduce;
           #rem01042@#nCampo1# = nAplicado;
     |SIGUE;

     nAcum     = nLimite50;
     nDeducido = #rem01042@#189; |HAZ Deduce;  #rem01042@#189 = nAplicado;

     nAcum     = nLimite60;
     nDeducido = #rem01042@#146; |HAZ Deduce;  #rem01042@#146 = nAplicado;
     #rem01042@#145 = (N\ #rem01042@#145 + #rem01042@#188);
     #rem01042@#146 = (N\ #rem01042@#146 + #rem01042@#189);

                              nAcum = nLimite60;
     |SI #rem01042@#187 = 2;  nAcum = nLimite90;  |FINSI;

     |PARA nCampo1 = 149;  |SI nCampo1 [ 161;  |HACIENDO nCampo1 = nCampo1 + 3;
           nDeducido = #rem01042@#nCampo1#;
           |HAZ Deduce;
           #rem01042@#nCampo1# = nAplicado;
     |SIGUE;

     nAcum     = nLimite50;
     nDeducido = #rem01042@#164; |HAZ Deduce;  #rem01042@#164 = nAplicado;

     nAcum     = nLimite100;
     nDeducido = #rem01042@#170; |HAZ Deduce;  #rem01042@#170 = nAplicado;
     nDeducido = #rem01042@#171; |HAZ Deduce;  #rem01042@#171 = nAplicado;
     nDeducido = #rem01042@#173; |HAZ Deduce;  #rem01042@#173 = nAplicado;
     nDeducido = #rem01042@#174; |HAZ Deduce;  #rem01042@#174 = nAplicado;
     nDeducido = #rem01042@#177; |HAZ Deduce;  #rem01042@#177 = nAplicado;
     nDeducido = #rem01042@#178; |HAZ Deduce;  #rem01042@#178 = nAplicado;
     nDeducido = #rem01042@#181; |HAZ Deduce;  #rem01042@#181 = nAplicado;
     nDeducido = #rem01042@#182; |HAZ Deduce;  #rem01042@#182 = nAplicado;
     nDeducido = #rem01042@#184; |HAZ Deduce;  #rem01042@#184 = nAplicado;
     nDeducido = #rem01042@#185; |HAZ Deduce;  #rem01042@#185 = nAplicado;

     |PARA nCampo1 = 3;  |SI nCampo1 [ 135;  |HACIENDO nCampo1 = nCampo1 + 3;
           nCampo2   = nCampo1 + 1;
           nCampo3   = nCampo1 + 2;
           #rem01042@#nCampo3# = (N\ #rem01042@#nCampo1# - #rem01042@#nCampo2#);
     |SIGUE;

     |PARA nCampo1 = 145;  |SI nCampo1 [ 163;  |HACIENDO nCampo1 = nCampo1 + 3;
           nCampo2   = nCampo1 + 1;
           nCampo3   = nCampo1 + 2;
           #rem01042@#nCampo3# = (N\ #rem01042@#nCampo1# - #rem01042@#nCampo2#);
     |SIGUE;

     #rem01042@#175 = (N\ #rem01042@#172 - #rem01042@#173 - #rem01042@#174);
     #rem01042@#179 = (N\ #rem01042@#176 - #rem01042@#177 - #rem01042@#178);
     #rem01042@#183 = (N\ #rem01042@#180 - #rem01042@#181 - #rem01042@#182);

     nSuma = #rem01042@#144;
     |PARA nCampo1 = 4;  |SI nCampo1 [ 136;   |HACIENDO nCampo1 = nCampo1 + 3;
           nSuma = nSuma + #rem01042@#nCampo1#;
     |SIGUE;

     |PARA nCampo1 = 146;  |SI nCampo1 [ 164; |HACIENDO nCampo1 = nCampo1 + 3;
           nSuma = nSuma + #rem01042@#nCampo1#;
     |SIGUE;

     #rem01042@#166 = nSuma;

     nValor1 = (nSuma % 50) ! 2;
     nValor2 = nSuma - nValor1;

     #rem01042@#167 = nValor1;
     #rem01042@#168 = nValor2;

     enSwAcum   = 0;
     enBloque   = 42;  eaCasilla  = "508";  enImporte  = nValor1;  |HAZ GrabaLineal;
     enBloque   = 43;  eaCasilla  = "509";  enImporte  = nValor2;  |HAZ GrabaLineal;

     |GRABA 020#rem01042@.a;
     |LIBERA #rem01042@;
     |CIERRA #rem01042@;

     |DESCARGA_DEF #rem01042@;
|FPRC;

|PROCESO AjustaDobleInternac;
     aDef    = eaPathDef + "rem01033.mas";
     |CARGA_DEF aDef, rem01033@;

     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |SI enNomeDat = 1;  |NOME_DAT #rem01033@#"zdat1033"#;  |FINSI;

     |ABRE #rem01033@;
     #rem01033@#0 = #refere1@#0;
     #rem01033@#1 = #refere1@#1;
     #rem01033@#2 = #refere1@#2;
     |LEE 040#rem01033@.=;
     |SI FSalida ! 0;  |DDEFECTO #rem01033@;  |FINSI;
     |CIERRA #rem01033@;

     |SI #rem01033@#123 ! 0;
         nValor1  = #rem01033@#123;
         enBloque = 1;  eaCasilla = "019"; |HAZ SacaImporte; nValor2 = enImporte;
         enBloque = 1;  eaCasilla = "020"; |HAZ SacaImporte; nValor3 = enImporte;

         |SI nValor2 > nValor1;
             nValor  = ((nValor1 * 100) / nValor2) ! 2;
             nValor  = (nValor3 % nValor) ! 2;
             nValor1 = nValor1 - nValor;
         |SINO;
             nValor1 = nValor1 - nValor3;
         |FINSI;

         #rem01033@#123 = nValor1;
     |FINSI;

     nValor = #rem01033@#98 + #rem01033@#123 + #rem01033@#99 + #rem01033@#100 + #rem01033@#101;
     |SI nValor ! 0;
         enBloque   = 38; eaCasilla = "450";  |HAZ SacaImporte; n415 = enImporte;
         enBloque   = 39; eaCasilla = "455";  |HAZ SacaImporte; n419 = enImporte;
         enBloque   = 42; eaCasilla = "486";  |HAZ SacaImporte; n454 = enImporte;
         enBloque   = 43; eaCasilla = "487";  |HAZ SacaImporte; n455 = enImporte;
         enBloque   = 29; eaCasilla = "389";  |HAZ SacaImporte; n363 = enImporte;
         enBloque   = 30; eaCasilla = "386";  |HAZ SacaImporte; n371 = enImporte;
         enBloque   = 42; eaCasilla = "494";  |HAZ SacaImporte; n463 = enImporte;
         enBloque   = 43; eaCasilla = "495";  |HAZ SacaImporte; n464 = enImporte;

         nDed  = 0;
         enBloque  = 42; eaCasilla = "501";  |HAZ SacaImporte; nDed = enImporte;
         enBloque  = 42; eaCasilla = "503";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "504";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "506";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "508";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "510";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "512";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "514";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "516";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 42; eaCasilla = "518";  |HAZ SacaImporte; nDed = nDed  + enImporte;

         enBloque  = 43; eaCasilla = "502";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "505";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "507";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "509";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "511";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "513";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "515";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "517";  |HAZ SacaImporte; nDed = nDed  + enImporte;
         enBloque  = 43; eaCasilla = "519";  |HAZ SacaImporte; nDed = nDed  + enImporte;

         nVal1    = (n454 + n455) - nDed;
         nValorP1 = (((nVal1 * 100) / n415) - 0.0049) ! 2;

         nVal1    = n463 + n464;
         nValorP2 = (((nVal1 * 100) / n419) - 0.0049) ! 2;

         nValorB3 = (n415 * (#rem01033@#98 + #rem01033@#123)) / n363;
         nValorB4 = (n419 * #rem01033@#100) / n371;

         |SI nValorB3 > n415;  nValorB3 = n415;  |FINSI;
         |SI nValorB4 > n419;  nValorB4 = n419;  |FINSI;

         nValorC1 = #rem01033@#99;
         nValor   = ((nValorB3 % nValorP1) - 0.0049) ! 2;
         |SI nValor < 0;  nValor = 0;  |FINSI;
         |SI nValor < nValorC1;
             nValorC1 = nValor;
         |FINSI;

         nValorC2 = #rem01033@#101;
         nValor   = ((nValorB4 % nValorP2) - 0.0049) ! 2;
         |SI nValor < 0;  nValor = 0;  |FINSI;
         |SI nValor < nValorC2;
             nValorC2 = nValor;
         |FINSI;

         enImporte = (nValorC1 + nValorC2) ! 2;
         |SI enImporte < 0;  enImporte = 0;  |FINSI;

         enSwAcum   = 0;
         enBloque   = 44
         eaCasilla  = "533";
         |HAZ GrabaLineal;
     |FINSI;

     |DESCARGA_DEF #rem01033@;
|FPRC;

|PROCESO CalculaN;
     |ABRE #rem00100;
     #rem00100#0 = #refere1@#0;
     |LEE 000#rem00100.=;
     |SI FSalida ! 0;  |DDEFECTO #rem00100;  |FINSI;
     |CIERRA #rem00100;

                              nCodAutonomico = #rem00100#11;
     |SI enConta        = 2;  nCodAutonomico = #rem00100#43;  |FINSI;
     |SI nCodAutonomico = 0;  nCodAutonomico = #rem00100#11;  |FINSI;

     enBloque = 41; eaCasilla = "479"; |HAZ SacaImporte; nCas479   = enImporte;
     enBloque = 41; eaCasilla = "480"; |HAZ SacaImporte; nCas480   = enImporte;
     enBloque = 41; eaCasilla = "481"; |HAZ SacaImporte; nAnuHijos = enImporte;

     |HAZ Calcula488;
     |HAZ Calcula496;

     enBloque = 42; eaCasilla = "486"; |HAZ SacaImporte; nValor1 = enImporte;
     enBloque = 42; eaCasilla = "494"; |HAZ SacaImporte; nValor2 = enImporte;

     enImporte  = nValor1 + nValor2;
     enSwAcum   = 0;
     enBloque   = 42;
     eaCasilla  = "499";
     |HAZ GrabaLineal;

     enBloque = 43; eaCasilla = "487"; |HAZ SacaImporte; nValor1 = enImporte;
     enBloque = 43; eaCasilla = "495"; |HAZ SacaImporte; nValor2 = enImporte;

     enImporte  = nValor1 + nValor2;
     enSwAcum   = 0;
     enBloque   = 43;
     eaCasilla  = "500";
     |HAZ GrabaLineal;

     |HAZ CalculaAnexoA;
     |HAZ CalculaAnexoC;
     |HAZ CalculaAnexoB;   || rezcal08

     nValor    = 0;
     enBloque  = 42;
     eaCasilla = "499"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "501"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "503"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "504"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "506"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "508"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "510"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "512"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "514"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "516"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "518"; |HAZ SacaImporte; nValor = nValor - enImporte;

     |SI nValor < 0;  nValor = 0;  |FINSI;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "520";
     |HAZ GrabaLineal;

     nValor   = 0;
     enBloque  = 43;
     eaCasilla = "500"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "502"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "505"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "507"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "509"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "511"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "513"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "515"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "517"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "519"; |HAZ SacaImporte; nValor = nValor - enImporte;

     |SI nValor < 0;  nValor = 0;  |FINSI;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "521";
     |HAZ GrabaLineal;

     nValor    = 0;
     enBloque  = 42;
     eaCasilla = "520"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "522"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "523"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "524"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "525"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "530";
     |HAZ GrabaLineal;

     nValor    = 0;
     enBloque  = 43;
     eaCasilla = "521"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "526"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "527"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "528"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "529"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "531";
     |HAZ GrabaLineal;

     nValor   = 0;
     enBloque = 42; eaCasilla = "530"; |HAZ SacaImporte; nValor = enImporte;
     enBloque = 43; eaCasilla = "531"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     enBloque   = 44;
     eaCasilla  = "532";
     |HAZ GrabaLineal;

     |HAZ AjustaDobleInternac;

     enBloque = 44;
     eaCasilla = "532"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "533"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "534"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "535"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "536"; |HAZ SacaImporte; nValor = nValor - enImporte;
     |SI nValor < 0;  nValor = 0;  |FINSI;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "537";
     |HAZ GrabaLineal;

     enBloque = 45;
     eaCasilla = "538"; |HAZ SacaImporte; nValor = enImporte;
     eaCasilla = "539"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "540"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "541"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "542"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "543"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "544"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "545"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "546"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "547"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "548"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "549";
     |HAZ GrabaLineal;
     nValor1 = enImporte;

     enBloque = 44; eaCasilla = "537"; |HAZ SacaImporte; nValor = enImporte - nValor1;

     enSwAcum   = 0;
     enBloque   = 46;
     eaCasilla  = "550";
     |SI nValor < 0;
          nValor2 = -nValor;
          |SI nValor2 > nValor1;
               nValor = -nValor1;
          |FINSI;
     |FINSI;
     enImporte  = nValor;
     |HAZ GrabaLineal;

     eaCasilla = "551"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "552"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "562"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "563"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "575"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "576"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "589"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "590"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "591"; |HAZ SacaImporte; nValor = nValor - enImporte;
     eaCasilla = "592"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "593"; |HAZ SacaImporte; nValor = nValor + enImporte;
     eaCasilla = "595"; |HAZ SacaImporte; nValor = nValor + enImporte;

     enImporte  = nValor;
     enSwAcum   = 0;
     eaCasilla  = "600";
     |HAZ GrabaLineal;
|FPRC;

|PROCESO CalculaO;
     |ABRE #rem00100;
     #rem00100#0 = #refere1@#0;
     |LEE 040#rem00100.=;
     |SI FSalida ! 0;  |DDEFECTO #rem00100;  |FINSI;
     |CIERRA #rem00100;

                              nCodAutonomico = #rem00100#11;
     |SI enConta        = 2;  nCodAutonomico = #rem00100#43;  |FINSI;
     |SI nCodAutonomico = 0;  nCodAutonomico = #rem00100#11;  |FINSI;

     |SI nCodAutonomico = 18;  |ACABA; |FINSI;
     |SI nCodAutonomico = 19;  |ACABA; |FINSI;
     |SI nCodAutonomico = 20;  |ACABA; |FINSI;

     nImporte = 0;
     enBloque = 43; eaCasilla = "531"; |HAZ SacaImporte;
     enBloque = 47; eaCasilla = "601"; |HAZ GrabaLineal;

     nImporte = 0;
     enBloque = 44; eaCasilla = "533"; |HAZ SacaImporte;  nImporte = nImporte + enImporte;
     enBloque = 44; eaCasilla = "534"; |HAZ SacaImporte;  nImporte = nImporte + enImporte;
     enBloque = 44; eaCasilla = "535"; |HAZ SacaImporte;  nImporte = nImporte + enImporte;

     nImporte = (nImporte % 50) ! 2;
     enBloque = 47; eaCasilla = "602"; enImporte = nImporte;  |HAZ GrabaLineal;

     nImporte = 0;
     enBloque = 47; eaCasilla = "601"; |HAZ SacaImporte;  nImporte = enImporte;
     enBloque = 47; eaCasilla = "602"; |HAZ SacaImporte;  nImporte = nImporte - enImporte;

     |SI nImporte < 0;  nImporte = 0;  |FINSI;

     enBloque = 47; eaCasilla = "605"; enImporte = nImporte;  |HAZ GrabaLineal;
|FPRC;
