|FICHEROS;
     rem01000;
     rem01001;
     rem01002;
     rem01043;
     rem00901;
     rem00902;

     rew00002;
|FIN;

|VARIABLES;
     aAlfa        = "";
     aEsc1        = "";
     aEsc2        = "";
     aRetu        = "";
     aTecla       = "";
     aAbre        = "";
     aTitulo      = "";
     aPrograma    = "";
     aFichero     = "";
     aRefresca    = "";
     aBloque      = "";
     aTexto       = "";
     aLong        = "";
     aCarac       = "";
     aRenta1      = "";
     aRenta2      = "";
     aRenta3      = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";
     aAlfa5       = "";
     aAlfa6       = "";
     aAlfa7       = "";
     aAlfa8       = "";
     aAlfa9       = "";
     aAlfa10      = "";

     nTree        = 0;
     nNume        = 0;
     nVentana     = 0;
     nPanta       = 0;
     nLinea       = 0;
     nHandle      = 0;
     nPos         = 0;
     nVent        = 0;
     nRango       = 0;
     nGrid        = 0;
     nLong        = 0;
     nPosi        = 0;
     nRenta1      = 0;
     nRenta2      = 0;
     nBloque      = 0;
     nCasilla     = 0;
     nCampo       = 0;
     nCeros       = 0;
     nConta       = 0;
     nPosFin      = 0;
     nComunidad   = 0;

     {-1}aVent    = "";
         aVent1   = 0;
         aVent2   = 0;
         aVent3   = 0;
         aVent4   = 0;
         aVent5   = "";

     {-1}sTree    = 0;
     sT_nID       = 0;
     sT_nOper     = 0;
     sT_aData     = "";

 {-1}nEstado      = 0;
     nWid         = -1;
     nFile        = -1;
     nSid         = -1;
     nId          = -1;
     aOpcion      = "";
     aLiquida     = "";

  {12} aPopup        = "";

     &eaVacio        = "   ";
     &enVentGnrl     = 0;
     &enVentTrab     = 0;

     &eaAzul       = "";
     &eaVerde      = "";
     &eaRojo       = "";
     &eaRosa       = "";
|FIN;

|PROCESO LeeFichero;
     aLiquida  = "";
     nLinea    = 1;

     |XABRE "ACB",  PARAMETRO,  nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 100, aAlfa;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          |SI nLinea = 1;  aAbre     = aAlfa  % 198;  |FINSI;
          |SI nLinea = 2;  aTitulo   = aAlfa  % 198;  |FINSI;
          |SI nLinea = 3;  aPrograma = aAlfa  % 198;  |FINSI;
          |SI nLinea = 4;  aLiquida  = aAlfa  % 102;  |FINSI;
          |SI nLinea = 5;
              aRenta1 = aAlfa % 105;
              aRenta2 = aAlfa % 602;
              aRenta3 = aAlfa % 810;
           |FINSI;

          nLinea = nLinea + 1;
     |SIGUE;
     |XCIERRA nHandle;

     |QBF aAbre;
     |QBF aTitulo;
     |QBF aPrograma;
     |QBF aAbre;
     aPrograma = (aPrograma + "             ") % 111;

     |SI aPrograma = "rem05000   ";  aPrograma = "rew00200P1 ";  |FINSI;
|FPRC;

|PROCESO Baja1002;
     #rem01002#0 = aRenta1;
     #rem01002#1 = aRenta2;
     #rem01002#2 = aRenta3;
     #rem01002#3 = aBloque;
     #rem01002#4 = 000;
|FPRC;

|PROCESO Alta1002;
     #rem01002#0 = aRenta1;
     #rem01002#1 = aRenta2;
     #rem01002#2 = aRenta3;
     #rem01002#3 = aBloque;
     #rem01002#4 = 999;
|FPRC;

|PROCESO rem01000;
     |SI #rem01000#0 = 60;  nComunidad = 1;  |FINSI;
     |SI #rem01000#0 = 61;  nComunidad = 2;  |FINSI;
     |SI #rem01000#0 = 62;  nComunidad = 3;  |FINSI;
     |SI #rem01000#0 = 63;  nComunidad = 4;  |FINSI;
     |SI #rem01000#0 = 64;  nComunidad = 5;  |FINSI;
     |SI #rem01000#0 = 65;  nComunidad = 6;  |FINSI;
     |SI #rem01000#0 = 66;  nComunidad = 7;  |FINSI;
     |SI #rem01000#0 = 67;  nComunidad = 8;  |FINSI;
     |SI #rem01000#0 = 68;  nComunidad = 9;  |FINSI;
     |SI #rem01000#0 = 69;  nComunidad = 10; |FINSI;
     |SI #rem01000#0 = 70;  nComunidad = 11; |FINSI;
     |SI #rem01000#0 = 71;  nComunidad = 12; |FINSI;
     |SI #rem01000#0 = 72;  nComunidad = 13; |FINSI;
     |SI #rem01000#0 = 73;  nComunidad = 16; |FINSI;
     |SI #rem01000#0 = 74;  nComunidad = 17; |FINSI;

     nCasilla = #rem01000#2;
     nCampo   = 6;

     |SI nCasilla = 511;
         nCasilla = 999;
     |FINSI;

     |SI nComunidad = 8;
         |SI nCasilla = 849;  nCasilla = 848;  nCampo = 12;  |FINSI;
         |SI nCasilla = 853;  nCasilla = 852;  nCampo = 12;  |FINSI;
         |SI nCasilla = 864;  nCasilla = 999;  nCampo = 12;  |FINSI;
         |SI nCasilla = 866;  nCasilla = 999;  nCampo = 13;  |FINSI;
         |SI nCasilla = 867;  nCasilla = 999;  nCampo = 14;  |FINSI;
         |SI nCasilla = 980;  nCasilla = 999;  nCampo = 15;  |FINSI;
         |SI nCasilla = 868;  nCasilla = 999;  nCampo = 16;  |FINSI;
     |FINSI;

     #rem01043#0 = aRenta1;
     #rem01043#1 = aRenta2;
     #rem01043#2 = aRenta3;
     #rem01043#3 = nComunidad;
     #rem01043#4 = nCasilla;
     |LEE 000#rem01043.=;
     |SI FSalida ! 0;  |DDEFECTO #rem01043;  |FINSI;

     nLinea  = nLinea + 1;

     |DDEFECTO #rew00002;
     #rew00002#0 = nLinea;
     #rew00002#1 = #rem01000#2;
     #rew00002#2 = #rem01000#3;
     #rew00002#3 = #rem01043#nCampo#;
     #rew00002#4 = "";

     |GRABA 020#rew00002.n;
     |LIBERA #rew00002;
|FPRC;

|DEFBUCLE rem01000;
     #rem01000#1;
     ;
     nBloque, 000;
     nBloque, 999;
     ;
     NULL, rem01000;
|FIN;

|PROCESO EventoTree;
     |SI FEntrada = 0;
         aAlfa = "";
         aLong = Contenido % 0;
         nLong = aLong;
         |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
               nPos = (nPosi * 100) + 1;
               aCarac = Contenido % nPos;
               |SI aCarac = ":";  |SAL;  |FINSI;
               aAlfa  = aAlfa + aCarac;
         |SIGUE;

         |QBT aAlfa;

         aBloque = Contenido;  |QBF aBloque;
         aBloque = aBloque % -102;
         nBloque = aBloque;
         |SI nBloque [ 59;
             sT_nID   = nTree;
             sT_nOper = 5;
             sT_aData = ":" + aAlfa;

             |ESPECIFICA "COMMANDCONTROL", sTree;
             aAlfa   = Contenido;

             aAlfa   = aAlfa - ":";
             nNume   = aAlfa;
             nNume   = nNume - 1;

             sT_nID    = nTree;
             sT_nOper  = 4;
             sT_aData  = ":" + nNume;
             |ESPECIFICA "COMMANDCONTROL", sTree;
             aTexto    = Contenido;
         |SINO;
             sT_nID   = nTree;
             sT_nOper = 5;
             sT_aData = ":" + aAlfa;

             |ESPECIFICA "COMMANDCONTROL", sTree;
             aAlfa   = Contenido;

             aAlfa   = aAlfa - ":";
             nNume   = aAlfa;

             sT_nID    = nTree;
             sT_nOper  = 4;
             sT_aData  = ":" + nNume;
             |ESPECIFICA "COMMANDCONTROL", sTree;
             aTexto    = Contenido;
         |FINSI;

         |ACABA;
     |FINSI;

     aPrograma = Contenido;   |QBF aPrograma;

     |SI aPrograma = "";  |ACABA;  |FINSI;

     |SI aPrograma = "ptec802";
         aPrograma = "";

         |PTEC 802;

         |ACABA;
     |FINSI;

     aAlfa = aPrograma % 103;

     |SI aAlfa = "LIQ";
         aBloque = aPrograma % 502;
         nBloque = aBloque;

         |VENTANA 0501, 3499, -1, 16, aTitulo;
         nVent = FSalida;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODAL";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         aAlfa  = "LABEL,{{2}}" + aTexto;
         |CONTROL_SIMPLE 0, aAlfa, 0502, 0599, NULL;

         |SI nBloque [ 59;
             |ABRE #rem01002;
             nRango = 2 + 4 + 8 + 16 + 32 + 128 + 256;
             |LINEAL_SIMPLE #1#rem01002, nRango, 0602, 3398, Baja1002, Alta1002, NULL;
             nGrid = FSalida;

             aEsc1  = &255 + "806";
             aEsc2  = &255 + "807";
             aRetu  = &255 + "802";
             |PARA; |SI;  |HACIENDO;
                  FSalida = "::{{001}}sa&Lir," + nGrid;
                  |LEETECLA aTecla;
                  |SI aTecla = aEsc1; |SAL;  |FINSI;
                  |SI aTecla = aEsc2; |SAL;  |FINSI;
                  |SI aTecla = aRetu; |SAL;  |FINSI;
             |SIGUE;
             aTecla = "";

             |CIERRA #rem01002;
         |SINO;
             aFichero = ("TC" + Usuario + "zzzzzzzz") % 108;
             |NOME_DAT #rew00002#aFichero#;

             |ABRE #rew00002;  |CIERRA #rew00002;  |DELINDEX #rew00002;

             nLinea = 0;

             |ABRE #rew00002;
             |ABRE #rem01043;
             |BUCLE rem01000;
             |CIERRA #rem01043;

             nRango = 2 + 4 + 8 + 16 + 32 + 128 + 256;
             |LINEAL_SIMPLE #1#rew00002, nRango, 0602, 3398, NULL, NULL, NULL;
             nGrid = FSalida;

             aEsc1  = &255 + "806";
             aEsc2  = &255 + "807";
             aRetu  = &255 + "802";
             |PARA; |SI;  |HACIENDO;
                  FSalida = "::{{001}}sa&Lir," + nGrid;
                  |LEETECLA aTecla;
                  |SI aTecla = aEsc1; |SAL;  |FINSI;
                  |SI aTecla = aEsc2; |SAL;  |FINSI;
                  |SI aTecla = aRetu; |SAL;  |FINSI;
             |SIGUE;

             aTecla = "";
             |CIERRA #rew00002;
             |DELINDEX #rew00002;
         |FINSI;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent;

         |FOCOTECLADO nTree;

         aPrograma = "";
         |ACABA;
     |FINSI;

     |SI aAlfa ! "REN";  |Y aAlfa ! "PAT";  |Y aAlfa ! "LIQ";
      |Y aAlfa ! "TIT";  |Y aAlfa ! "DAT";
         |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO Imprime;
     |SI #rew00002#1 ! "   ";
         |SI nCeros ! 0;  |Y #rew00002#3 = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE rew00002;
     #rew00002#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Imprime;
|FIN;

|PROCESO rem01002;
     nLinea  = nLinea + 1;

     |DDEFECTO #rew00002;
     #rew00002#0 = nLinea;
     #rew00002#1 = #rem01002#5;
     #rew00002#2 = "     " + #rem01002#6;
     #rew00002#3 = #rem01002#7;
     #rew00002#4 = "";

     |GRABA 020#rew00002.n;
     |LIBERA #rew00002;
|FPRC;

|DEFBUCLE rem01002;
     #rem01002#1;
     ;
     nRenta1, nRenta2, aRenta3, nBloque, 000;
     nRenta1, nRenta2, aRenta3, nBloque, 999;
     ;
     NULL, rem01002;
|FIN;

|PROCESO rem00901;
     aAlfa = #rem00901#5;  |QBF aAlfa;
     aAlfa = aAlfa % -102;
     nBloque = aAlfa;
     |SI nBloque ] 50;  |Y nBloque [ 64;
         |ACABA;
     |FINSI;

     aAlfa = #rem00901#5 % 103;

     |SI aAlfa = "TIT";
         nLinea = nLinea + 1;

         #rew00002#0 = nLinea;
         #rew00002#1 = "";
         #rew00002#2 = #rem00901#4;
         #rew00002#3 = 0;
         #rew00002#4 = eaAzul;
         |GRABA 020#rew00002.n;
         |LIBERA #rew00002;
     |FINSI;

     |SI aAlfa = "LIQ";
         aBloque = #rem00901#5 % 502;
         nRenta1 = aRenta1;
         nRenta2 = aRenta2;
         nBloque = aBloque;
         |BUCLE rem01002;
     |FINSI;
|FPRC;

|DEFBUCLE rem00901;
     #rem00901#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, rem00901;
|FIN;

|PROCESO TodasCasillasRen;
     aFichero = ("TC" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #rew00002#aFichero#;

     |ABRE #rew00002;  |CIERRA #rew00002;  |DELINDEX #rew00002;

     nLinea = 0;
     |ABRE #rew00002;
     |BUCLE rem00901;

     |VENTANA 0501, 3499, -1, 16, aTitulo;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aAlfa  = "LABEL,{{2}}Liquidaci¢n completa renta";
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0599, NULL;

     nRango = 2 + 4 + 8 + 16 + 32 + 128 + 256;
     |LINEAL_SIMPLE #1#rew00002, nRango, 0602, 3398, NULL, NULL, NULL;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}sa&Lir," + nGrid;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
     aTecla = "";
     |CIERRA #rew00002;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |FOCOTECLADO nTree;

     |DELINDEX #rew00002;
|FPRC;

|PROCESO ImprimirRen;
     |ABRE #rem01001;
     #rem01001#0 = aRenta1;
     #rem01001#1 = aRenta2;
     #rem01001#2 = aRenta3;
     |LEE 000#rem01001.=;
     |SI FSalida ! 0;  |DDEFECTO #rem01001;  |FINSI;
     |CIERRA #rem01001;

     aFichero = ("TC" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #rew00002#aFichero#;

     |ABRE #rew00002;  |CIERRA #rew00002;  |DELINDEX #rew00002;

     nLinea = 0;
     |ABRE #rew00002;
     |BUCLE rem00901;
     |CIERRA #rew00002;

     |VENTANA 0501, 3499, -1, 16, "Imprimiendo liquidaci¢n";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nCeros = -1;
     |CONFI "0000SImprimir casillas con importes a cero";
     |SI FSalida = 0;
         nCeros = 0;
     |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
         |INFOR "rey00001";
         |SI FSalida = 0;
             |BUCLE rew00002;
             |PIEINF;
             |FININF;
         |FINSI;
         |FINIMP;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |FOCOTECLADO nTree;

     |DELINDEX #rew00002;
|FPRC;

|PROCESO rem00902;
     aAlfa = #rem00902#5;  |QBF aAlfa;
     aAlfa = aAlfa % -102;
     nBloque = aAlfa;

     aAlfa = #rem00902#5 % 103;

     |SI aAlfa = "TIT";
         nLinea = nLinea + 1;

         #rew00002#0 = nLinea;
         #rew00002#1 = "";
         #rew00002#2 = #rem00902#4;
         #rew00002#3 = 0;
         #rew00002#4 = eaAzul;
         |GRABA 020#rew00002.n;
         |LIBERA #rew00002;
     |FINSI;

     |SI aAlfa = "LIQ";
         aBloque = #rem00902#5 % 502;
         nRenta1 = aRenta1;
         nRenta2 = aRenta2;
         nBloque = aBloque;
         |BUCLE rem01002;
     |FINSI;
|FPRC;

|DEFBUCLE rem00902;
     #rem00902#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, rem00902;
|FIN;

|PROCESO TodasCasillasPat;
     aFichero = ("TC" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #rew00002#aFichero#;

     |ABRE #rew00002;  |CIERRA #rew00002;  |DELINDEX #rew00002;

     nLinea = 0;
     |ABRE #rew00002;
     |BUCLE rem00902;

     |VENTANA 0501, 3499, -1, 16, aTitulo;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aAlfa  = "LABEL,{{2}}Liquidaci¢n completa patrimonio";
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0599, NULL;

     nRango = 2 + 4 + 8 + 16 + 32 + 128 + 256;
     |LINEAL_SIMPLE #1#rew00002, nRango, 0602, 3398, NULL, NULL, NULL;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}sa&Lir," + nGrid;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
     aTecla = "";
     |CIERRA #rew00002;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |FOCOTECLADO nTree;

     |DELINDEX #rew00002;
|FPRC;

|PROCESO ImprimirPat;
     |ABRE #rem01001;
     #rem01001#0 = aRenta1;
     #rem01001#1 = aRenta2;
     #rem01001#2 = aRenta3;
     |LEE 000#rem01001.=;
     |SI FSalida ! 0;  |DDEFECTO #rem01001;  |FINSI;
     |CIERRA #rem01001;

     aFichero = ("TC" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #rew00002#aFichero#;

     |ABRE #rew00002;  |CIERRA #rew00002;  |DELINDEX #rew00002;

     nLinea = 0;
     |ABRE #rew00002;
     |BUCLE rem00902;
     |CIERRA #rew00002;

     |VENTANA 0501, 3499, -1, 16, "Imprimiendo liquidaci¢n";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nCeros = -1;
     |CONFI "0000SImprimir casillas con importes a cero";
     |SI FSalida = 0;
         nCeros = 0;
     |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
         |INFOR "rey00001";
         |SI FSalida = 0;
             |BUCLE rew00002;
             |PIEINF;
             |FININF;
         |FINSI;
         |FINIMP;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |FOCOTECLADO nTree;

     |DELINDEX #rew00002;
|FPRC;

|PROCESO rem01001;
     |SI #rem01001#2 = aRenta3;  |ACABA;  |FINSI;

     nConta = nConta + 1;

     aAlfa = #rem01001#2 % 101;

     |SI #rem01001#2 = "ZPATRITIT "; |O #rem01001#2 = "ZPATRICON ";
         |SI #rem01001#2 = "ZPATRITIT ";
              aAlfa = "Liquidación Patrimonio (TITULAR)";
         |SINO;
              aAlfa = "Liquidación Patrimonio (CONYUGE)";
         |FINSI;
     |SINO;
         aAlfa = "Liquidación Renta (" + #rem01001#2;  |QBF aAlfa;
         aAlfa = aAlfa + ")";
     |FINSI;

     |SI nConta = 1;   aPopup3  = aAlfa;  aAlfa1  = #rem01001#2;  |FINSI;
     |SI nConta = 2;   aPopup4  = aAlfa;  aAlfa2  = #rem01001#2;  |FINSI;
     |SI nConta = 3;   aPopup5  = aAlfa;  aAlfa3  = #rem01001#2;  |FINSI;
     |SI nConta = 4;   aPopup6  = aAlfa;  aAlfa4  = #rem01001#2;  |FINSI;
     |SI nConta = 5;   aPopup7  = aAlfa;  aAlfa5  = #rem01001#2;  |FINSI;
     |SI nConta = 6;   aPopup8  = aAlfa;  aAlfa6  = #rem01001#2;  |FINSI;
     |SI nConta = 7;   aPopup9  = aAlfa;  aAlfa7  = #rem01001#2;  |FINSI;
     |SI nConta = 8;   aPopup10 = aAlfa;  aAlfa8  = #rem01001#2;  |FINSI;
     |SI nConta = 9;   aPopup11 = aAlfa;  aAlfa9  = #rem01001#2;  |FINSI;
     |SI nConta = 10;  aPopup12 = aAlfa;  aAlfa10 = #rem01001#2;  |FINSI;
|FPRC;

|DEFBUCLE rem01001;
     #rem01001#1;
     ;
     nRenta1, nRenta2, "          ";
     nRenta1, nRenta2, "zzzzzzzzzz";
     ;
     NULL, rem01001;
|FIN;

|PROCESO CambiarA;
     nConta  = 0;
     nRenta1 = aRenta1;
     nRenta2 = aRenta2;
     nBloque = aBloque;
     |BUCLE rem01001;

     aPopup1  = "0";
     aPopup2  = nConta;

     aPrograma = "";
     IaPopup   = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;

     |SI FSalida = 1;  aPrograma = aAlfa1;   |FINSI;
     |SI FSalida = 2;  aPrograma = aAlfa2;   |FINSI;
     |SI FSalida = 3;  aPrograma = aAlfa3;   |FINSI;
     |SI FSalida = 4;  aPrograma = aAlfa4;   |FINSI;
     |SI FSalida = 5;  aPrograma = aAlfa5;   |FINSI;
     |SI FSalida = 6;  aPrograma = aAlfa6;   |FINSI;
     |SI FSalida = 7;  aPrograma = aAlfa7;   |FINSI;
     |SI FSalida = 8;  aPrograma = aAlfa8;   |FINSI;
     |SI FSalida = 9;  aPrograma = aAlfa9;   |FINSI;
     |SI FSalida = 10; aPrograma = aAlfa10;  |FINSI;

     |SI aPrograma ! "";
         aPrograma = "CAMBIO " + aPrograma;
         |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO Anotaciones;
     |VENTANA 0501, 3499, -1, 1, "";
     nVent = FSalida;

     |PTEC 802;  |PAUSA;

     aAlfa    = aRenta1;
     |SI aAlfa = "";
         aAlfa = aTitulo % 105;
     |FINSI;

     aAlfa    = "rem01005;" + aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     |FINVENTANA nVent;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Borrador;
     aPrograma = "rem05000";

     |PTEC  802;  |PAUSA;
     |PTEC 807;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 3499;
|FPRC;

|PROGRAMA;
     |HAZ CargaColores;

     |PCONTEXTO 0, nWid, nId, nSid;
     nWid    = -1;
     nSid    = 0;
     aOpcion = "HIDE";
     |ESPECIFICA "ESTADO_VENTANA", nEstado;

     |HAZ LeeFichero;

     |SI aLiquida = "RE";
         |CONTROL_SIMPLE 0, "BOTON,&Ver todas las casillas", 3302, 3425, TodasCasillasRen;
         |CONTROL_SIMPLE 0, "BOTON, {{205}} &Imprimir liquidaci¢n", 3328, 3448, ImprimirRen;
         |CONTROL_SIMPLE 0, "BOTON, {{197}} &Cambiar a ...", 3351, 3465, CambiarA;
         |CONTROL_SIMPLE 0, "BOTON, {{197}} a&Notaciones", 3368, 3482, Anotaciones;

         aAlfa    = "TREECTRL,Liquidaci¢n Renta 2016 {{" + aAbre + "}}";
         nPosFin  = 3198;
     |FINSI;

     |SI aLiquida = "PA";
         |CONTROL_SIMPLE 0, "BOTON,&Ver todas las casillas", 3302, 3425, TodasCasillasPat;
         |CONTROL_SIMPLE 0, "BOTON, {{205}} &Imprimir liquidaci¢n", 3328, 3448, ImprimirPat;
         |CONTROL_SIMPLE 0, "BOTON, {{197}} &Cambiar a ...", 3351, 3465, CambiarA;
         |CONTROL_SIMPLE 0, "BOTON, {{197}} a&Notaciones", 3368, 3482, Anotaciones;

         aAlfa    = "TREECTRL,Datos Patrimonio 2016 {{" + aAbre + "}}";
         nPosFin  = 3198;
     |FINSI;

     |SI aLiquida ! "RE";  |Y aLiquida ! "PA";
         aAlfa    = "TREECTRL,Datos Renta 2016 {{" + aAbre + "}}";

         |CONTROL_SIMPLE 0, "BOTON, {{197}} a&Notaciones", 3402, 3415, Anotaciones;
         |CONTROL_SIMPLE 0, "BOTON, {{197}} datos &Fiscales (borrador)", 3418, 3438, Borrador;
         nPosFin  = 3398;
     |FINSI;

     |CONTROL_SIMPLE 0, aAlfa, 0502, nPosFin, EventoTree;
     nTree    = FSalida;

     aAlfa = aPrograma;  |QBF aAlfa;
     |SI aAlfa ! "";
         sT_nID   = nTree;
         sT_nOper = 3;
         sT_aData = "[" + aPrograma;
         |ESPECIFICA "COMMANDCONTROL", sTree;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID   = nTree;
     sT_nOper = 2;
     |SI aRefresca = "";
         sT_aData = "1:";
     |SINO;
         sT_aData = aRefresca;
     |FINSI;

     |ESPECIFICA "COMMANDCONTROL", sTree;

     |PTEC 802;  |PAUSA;
     |PULSATECLA;

     aPrograma = "";
     aEsc1     = &255 + "806";
     aEsc2     = &255 + "807";
     aRetu     = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::sa&Lir," + nTree;
         |LEETECLA aTecla;

         |PULSATECLA;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;

         |FOCOTECLADO nTree;
     |SIGUE;
     aTecla = "";

     |XABRE "WCB", PARAMETRO, nHandle;

     aAlfa = ((aAbre + (" " * 99)) % 198) + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = ((aTitulo + (" " * 99)) % 198) + &13 + &10;
     |XGRABA nHandle, aAlfa;

     aAlfa = ((aPrograma + (" " * 99)) % 198) + &13 + &10;
     |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;
|FPRO;
