|FICHEROS;
     labcerm0 #0;
     labcerm1 #0;

     labtraba;
     &regisnif@ #712;
     :/basica/def/agidanif;
|FIN;

|VARIABLES;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     &aCadena = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &eaCodNif = "";
     aCodPos = "";
     nCampo = 0;

     swLeido = 0;
     aTipo = "";
     &eswNif = 0;
|FIN;

|PROCESO lee_agidanif;
     |SI #agidanif#2 = aTipo;
          swLeido = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE lee_agidanif;
     #agidanif#1;
     ;
     #labcerm1#10, 00;
     #labcerm1#10, 99;
     ;
     NULL, lee_agidanif;
|FIN;

|PROCESO agidanif;
     swLeido = 0;
     |BUCLE lee_agidanif;
|FPRC;

|PROCESO PrimerProgenitor; |TIPO 7;
     aAlfa = #labcerm1#10;
     |QBF aAlfa;
     |SI aAlfa ! "";
          |ACABA;
     |FINSI;

     |ABRE #labtraba;
     #labtraba#0 = #labcerm1#0;
     #labtraba#1 = #labcerm1#1;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          aCadena = #labtraba#2;
          |HAZ SeparaNom_plb;
          |QBF eaNom; |QBF eaApel1; |QBF eaApel2;
          #labcerm1#5 = eaNom;
          #labcerm1#3 = eaApel1;
          #labcerm1#4 = eaApel2;
          #labcerm1#6 = #labtraba#11;
          |SI #labtraba#252 = "V";
               #labcerm1#7 = "H";
          |SINO;
               #labcerm1#7 = #labtraba#252;
          |FINSI;
          aAlfa = #labtraba#75; |QBF aAlfa;
          aAlfa1 = aAlfa % 102;
          aAlfa2 = aAlfa % 310;
          #labcerm1#8 = aAlfa1;
          #labcerm1#9 = aAlfa2;
          #labcerm1#10 = #labtraba#7;
          #labcerm1#11 = #labtraba#244;
          aTipo = "TITULAR     ";
          |HAZ agidanif;
          |SI swLeido = 1;
               #labcerm1#12 = #agidanif#35;
          |FINSI;

          || domicilio
          eaCodNif = #labtraba#7;
          |HAZ LeeNifs;

          #labcerm1#13 = #labtraba#3;
          #labcerm1#14 = #labtraba#4;
          #labcerm1#15 = "";
          #labcerm1#16 = "";
          #labcerm1#17 = #labtraba#5;
          #labcerm1#18 = "";
          aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
          #labcerm1#19 = aCodPos;
          #labcerm1#20 = #labtraba#6;
          #labcerm1#21 = #labtraba#10;
||  VOY POR AQUI

          #labcerm1#22 = #712#13;
          |PARA nCampo = 3; |SI nCampo [ 22; |HACIENDO nCampo = nCampo + 1;
               |PINTA #labcerm1#nCampo#;
          |SIGUE;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO SegundoProgenitor;
     #labcerm1#23 = #agidanif#9;
     #labcerm1#24 = #agidanif#10;
     #labcerm1#25 = #agidanif#11;
     #labcerm1#26 = #agidanif#13;
     #labcerm1#27 = "";
     |SI #labcerm1#7 = "H";
          #labcerm1#27 = "M";
     |FINSI;
     |SI #labcerm1#7 = "M";
          #labcerm1#27 = "H";
     |FINSI;
     #labcerm1#28 = "";
     #labcerm1#29 = "";
     #labcerm1#30 = #agidanif#8;
     #labcerm1#31 = #agidanif#34;
     #labcerm1#32 = #agidanif#35;

     aAlfa = #agidanif#24; |QBF aAlfa; aAlfa = aAlfa + " ";
     aAlfa = aAlfa + #agidanif#25; |QBF aAlfa;
     #labcerm1#33 = aAlfa;
     #labcerm1#34 = #agidanif#26;
     #labcerm1#35 = "";
     #labcerm1#36 = #agidanif#27;
     #labcerm1#37 = #agidanif#28;
     #labcerm1#38 = #agidanif#29;
     aCodPos = (("00" + #agidanif#30) % -102) + (("000" + #agidanif#31) % -103);
     #labcerm1#39 = aCodPos;
     #labcerm1#40 = #agidanif#32;
     #labcerm1#41 = #agidanif#33;

     |SI #agidanif#20 = "S";
          #labcerm1#42 = "ESPA¥A";
     |SINO;
          eaCodNif = #labcerm1#30;
          |HAZ LeeNifs;
          |SI eswNif = 0;
               #labcerm1#42 = #712#13;
          |SINO;
               #labcerm1#42 = "";
          |FINSI;
     |FINSI;
     |PARA nCampo = 23; |SI nCampo [ 42; |HACIENDO nCampo = nCampo + 1;
          |PINTA #labcerm1#nCampo#;
     |SIGUE;
|FPRC;

|PROCESO BuscaConyuge; |TIPO 7;
     swLeido = 0;
     aTipo = "CONYUGE     ";
     |HAZ agidanif;
     |SI swLeido = 1;
          aAlfa = #labcerm1#30;
          |QBF aAlfa;
          |SI aAlfa = "";
               aAlfa = "    ATENCION. Los datos del cónyuge existen en el registro ";
               aAlfa = aAlfa + "general de NIFs";
               |MENAV aAlfa;
               aAlfa = "    S¿Desea usar estos datos como los del segundo progenitor?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    |HAZ SegundoProgenitor;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Segundo;
     |SI FSalida = 13;
          swLeido = 0;
          aTipo = "CONYUGE     ";
          |HAZ agidanif;
          |SI swLeido = 1;
               aAlfa = "    ATENCION. Los datos del cónyuge existen en el registro ";
               aAlfa = aAlfa + "general de NIFs";
               |MENAV aAlfa;
               aAlfa = "    S¿Desea usar estos datos como los del segundo progenitor?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    |HAZ SegundoProgenitor;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
