|FICHEROS;
    labtraba #0;
    labempre #1;         || empresas
    labcentr #2;         || centros
    nomcateg #3;         || categorias
    nomcenes #5;         || centros especiales
    nomregim #6;         || regimenes
    eosm0030 #30;        || acceso IRPF
    eosm0031 #31;        || acumulados IRPF cabs.
    eosm0032 #32;        || acumulados IRPF lins.
    eosm0035;            || acumulados IRPF lins.
    eosm0034 #34;        || modelo 190
    eosm0036;            || modelo 190
    nomfusli #40;        || grupos IRPF lins.
    nompanta #50;        || pantallas de avisos
    nombotra,MANTE;
    dsmom073;            || claves perceptoras

    labtabla #100;
    labtmpct #101;
    tdpmunic #102;
    labmunic #104;
    labvaltb;
    labclean;
    taiclaoc;
    nombonif;
    nomw0021,MANTE;

    nomir001 #1001;      || gestion IRPF
    nomir003 #1003;      || datos IRPF ejercicio
    nomir005 #1005;      || present. calculo IRPF
    nomir006 #1006;      || datos IRPF personales

    copiadef@ #500;
    temp0001@;
    nomhorf1,MANTE;
     nomconca;
|FIN;

|VARIABLES;
    &aCodPos = "";
    &aCodigoMunicipio = "";

    dias18 = 0;
    mod = 0;
    anterior = 0;
    xx = 0;
    irpf = 0;
    rete = 0;
    dtos = 0;
    exen = 0;
    nume2 = 0;
    lugar = 0;
    nifnum = 0;
    resto = 0;
    corta = 0;
    nume3 = 0;
    jg = 0;
    sitio = 0;
    anynac2 = 0;
    mesnac2 = 0;
    dianac2 = 0;
    anyact2 = 0;
    mesact2 = 0;
    diaact2 = 0;
    edadxxx = 0;
    baja = 0;
    letra = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    final = "";
    x     = "";
    fiac = "  ";
    aponer = "  ";
    relleno = "                              ";
    men1 = "0000ATENCION !!! Fecha erronea";
    men2 = "0000Debera cumplimentar este campo !!!";
    men3 = "0000ATENCION !!! Centro de Trabajo asignado inexistente ...";
    dia1 = "";
    mes1 = "";
    any1 = "";
    dia = 0;
    mes = 0;
    any = 0;
    tope = 0;
    sw = 0;
    fec = "";
    blanco = "          ";
    puntos = "..........";
    fecsys = @;
    fecnum = 0;
    nacnum = 0;
    edanum = 0;
    espaci = "               ";
    fechtra = "";
    sistema = @;
    anynac1 = "";
    anyact1 = "";
    mesnac1 = "";
    mesact1 = "";
    dianac1 = "";
    diaact1 = "";
    guarda = "";
    nume1 = 9999999999;
    s_t = 0;
    &em_borr = 0;
    &tr_borr = 0;
    modo = 0;
    modito = 0;
    FEstado = 0;
    sw_clave = 0;
    inkey = 0;
    sw_abrevia = 0;
    aAlfa1 = "";
    aAlfa2 = "";
    &orden = "";
    &pasa = "";
    aFabre = "";

     nTecla = 0;
     nClave = 0;
     nSubCl = 0;
     nEnEsp = 0;
     nReper = 0;
     fFech1 = @;
     &nAnyo  = 0;
     nModo  = 0;
     nEjerc = 0;
     &nif_borr = "";
     aBase = "";
     &nEmpr = 0;
     &nTrab = 0;

     aCR       = "";
     aLF       = "";
     aComillas = "";
     nSwLectura = 0;
     nHandle    = 0;
     nCampo     = 0;
     nCampo1    = 0;
     nAbierto   = 0;
     nPosic     = 0;
     nCalc      = 0;
     nCalc1     = 0;
     nCalc2     = 0;
     nSwUno     = 0;
     nLong      = 0;

     aCadena   = "";
     aLong     = "";
     aTabla    = "";
     aAlfa     = "";
     aAlfa3    = "";
{1}  aContiene = "";
     swAgilab = 0;
     &eaVengoDe = "";
     aTra_borr = "";
     aEmp_borr = "";
     swCambioDNI = 0;
     aDef = "";
     &nBonif = 0;
     fFecha = @;
     &nElAny = 0;
     &nElMes = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
     swExiste = 0;
     swSigue = 0;
     fFechaAnt = @;
     fFechaAlta = @;
     fFechaFor = @;

     &enEmp = 0;
     &enTra = 0;
     &enNom = "";
     &eaNIF = "";
     &eaAlta = "";
     &eaBaja = "";
     &eaContrato = "";
     &enOpcion = 0;
     &nMedia90 = 0;
     &nAltaFechaRef = 0;
     &enParada = 0;
     nNume = 0;
     enBoton = 0;
     nOpcion = 0;
     swBotonSiNo = 0;
     aAntes = "";
     &eaProcedencia = "labtraba";

     aMensa      = "";
     aClave      = "";
     aSubClave   = "";

     &enEjerIRPF = 0;
     &eaEmail = "";
|FIN;

|INCLUYE i_busqu;

|PROCESO T0ClavFtraba; |TIPO 0;
     aClave    = "";
     aSubClave = "";

     |SI Campo = 99;  |O Campo = 102;
         aClave    = #labtraba#99;
         aSubClave = #labtraba#102;
     |FINSI;

     |SI Campo = 100;  |O Campo = 103;
         aClave    = #labtraba#100;
         aSubClave = #labtraba#103;
     |FINSI;

     |SI Campo = 101;  |O Campo = 104;
         aClave    = #labtraba#101;
         aSubClave = #labtraba#104;
     |FINSI;

     |QBF aClave;
     |QBF aSubClave;
     |SI aClave = "";   |Y aClave = "";
         |ACABA;
     |FINSI;

     enEjerIRPF = 2999;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = aClave;
     #dsmom073#2 = aSubClave;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         aAlfa = "0000Clave no correcta en el ejercicio " + enEjerIRPF;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;

|PROCESO Baja73Ftraba;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
|FPRC;

|PROCESO Alta73Ftraba;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = "z";
     #dsmom073#2 = "zz";
|FPRC;

|PROCESO T66ClavFtraba; |TIPO 66;
     |SI Campo = 99;  |O Campo = 102;
         aClave    = #labtraba#99;
         aSubClave = #labtraba#102;
     |FINSI;

     |SI Campo = 100;  |O Campo = 103;
         aClave    = #labtraba#100;
         aSubClave = #labtraba#103;
     |FINSI;

     |SI Campo = 101;  |O Campo = 104;
         aClave    = #labtraba#101;
         aSubClave = #labtraba#104;
     |FINSI;

     enEjerIRPF = 2999;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = aClave;
     #dsmom073#2 = aSubClave;
     |LEE 000#dsmom073.];

     |CONSULTA_F_CLAVE #1#dsmom073, Baja73Ftraba, Alta73Ftraba;
     |SI FSalida = 0;
         |SI Campo = 99;  |O Campo = 102;
             #labtraba#99  = #dsmom073#1;  |PINTA #labtraba#99;
             #labtraba#102 = #dsmom073#2;  |PINTA #labtraba#102;
         |FINSI;

         |SI Campo = 100;  |O Campo = 103;
             #labtraba#100 = #dsmom073#1;  |PINTA #labtraba#100;
             #labtraba#103 = #dsmom073#2;  |PINTA #labtraba#103;
         |FINSI;

         |SI Campo = 101;  |O Campo = 104;
             #labtraba#101 = #dsmom073#1;  |PINTA #labtraba#101;
             #labtraba#104 = #dsmom073#2;  |PINTA #labtraba#104;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom073;

     |ERROR;
|FPRC;



|PROCESO imagenes; |TIPO 0;
     eaVengoDe = "labtraba";
     |SI FSalida = 13;
          aAlfa1 = #0#0; aAlfa1 = ("00000" + aAlfa1) % -105;
          aAlfa2 = #0#1; aAlfa2 = ("00000" + aAlfa2) % -105;
          orden = aAlfa1 + aAlfa2;
          pasa = "T";
          |SUB_EJECUTA "nombmp01";
     |FINSI;
     |SI FSalida = 14;
          |DBIN aAlfa1;
          aAlfa1 = aAlfa1 + "/fuen0001.tab";
          aAlfa1 = "rb  " + aAlfa1;
          |FABRE aAlfa1;
          |SI FSalida ] 0;
               |FCIERRA FSalida;
               em_borr = #0#0;
               tr_borr = #0#2;
               |SUB_EJECUTA "fuen0001;AUTO";
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO siono; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI Campo ! 30;
    |SI #0#14 = An; |O #0#14 = AN;
        |HAZ nopasar;
    |FINSI;
|SINO;
    |SI #0#29 = 0;
        |HAZ nopasar;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO nomodif; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

    fecsys = #0#11;
    nacnum = fecsys;
    fecsys = ~;
    fecnum = fecsys;
    dias18 = 18 * 365; dias18 = dias18 + 4; || cuatro dias por 4 a¤os bisiestos
    edanum = fecnum - nacnum;
|SI edanum ] dias18;
        alfa1 = "N";
|SINO;
        alfa1 = "S";
|FINSI;
|C_M #0#20, 1, alfa1;
|C_M #0#21, 1, alfa1;
|C_M #0#22, 1, alfa1;
|C_M #0#23, 1, alfa1;
|FPRC;

|PROCESO verifech; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

        fec = #0Campo; sw = 0;
|SI fec ! blanco; |Y fec ! puntos;
  dia1 = fec % A102;
  mes1 = fec % A402;
  any1 = fec % A704;
  dia = dia1; mes = mes1; any = any1;
  |SI dia ! 0; |Y mes ! 0; |Y any ! 0;
     |SI mes [ 12; |Y mes ] 1;
       |SI mes = 1; |O mes = 3; |O mes = 5; |O mes = 7; |O mes = 8; |O mes = 10; |O mes = 12;
           tope = 31;
       |SINO;
           |SI mes = 2;
               mod = any $ 4;
               |SI mod = 0;
                   tope = 29;
               |SINO;
                   tope = 28;
               |FINSI;
            |SINO;
               tope = 30;
            |FINSI;
        |FINSI;
        |SI dia [ tope;
            sw = 1;
        |FINSI;
     |FINSI;
  |FINSI;
|SINO;
  sw = 1;
|FINSI;
|SI sw = 0;
    |MENAV men1;
    |ERROR;
|FINSI;

|SI Campo = 11;     |HAZ menor;    |FINSI;
|SI Campo = 11;     |HAZ nomodif;  |FINSI;

     |SI Campo = 132;
          |SI fec ! blanco; |Y fec ! puntos;
               fFecha = fec;
               |SI fFecha < "13.05.2020";
                    aAlfa = "    No se admiten fechas de renuncia al ERTE ";
                    aAlfa = aAlfa + "por fuerza mayor anteriores a 13.05.2020";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nopasar;
    aponer = Anono;
    fiac = Control % A1001;
    Control = Control + fiac;
    Control = Control + relleno;
    Control = Control % A120;
    Control = Control + aponer;
|FPRC;

|PROCESO lee_centr; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|ABRE #2;
    #2#0 = #0#0;
    #2#1 = #0#77;
|LEE 040#2=;
|SI FSalida ! 0;
    |MENAV men3;
    |ERROR;
|FINSI;
|CIERRA #2;
|FPRC;

/*
|PROCESO totales; |TIPO 0;    || totaliza por campos
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI Contenido ! #0Campo;
    |SI Campo ]  99; |Y Campo [ 110;  s_t = 1;  |FINSI;
    |SI Campo ] 111; |Y Campo [ 122;  s_t = 2;  |FINSI;
    |SI Campo ] 123; |Y Campo [ 134;  s_t = 3;  |FINSI;
    |SI Campo ] 135; |Y Campo [ 145;  s_t = 4;  |FINSI;
    |SI Campo ] 176; |Y Campo [ 187;  s_t = 5;  |FINSI;
    |SI Campo ] 188; |Y Campo [ 199;  s_t = 6;  |FINSI;
    |SI Campo ] 200; |Y Campo [ 211;  s_t = 7;  |FINSI;
    |SI Campo ] 212; |Y Campo [ 223;  s_t = 8;  |FINSI;
    |HAZ deltot;
|FINSI;
|FPRC;

/*
|PROCESO totfinal; |TIPO 3;    || totaliza antes de grabar
|PARA s_t = 1; |SI s_t [ 8; |HACIENDO s_t = s_t + 1;
    |HAZ deltot;
|SIGUE;
|HAZ claves;
|FPRC;
*/

|PROCESO deltot;
|SI s_t=1;  #0#151 = 0;  |FINSI;  || irpf 1
|SI s_t=2;  #0#152 = 0;  |FINSI;  || reten. 1
|SI s_t=3;  #0#153 = 0;  |FINSI;  || dto. s.s.
|SI s_t=4;  #0#154 = 0;  |FINSI;  || exenta
|SI s_t=5;  #0#224 = 0;  |FINSI;  || irpf 2
|SI s_t=6;  #0#226 = 0;  |FINSI;  || reten. 2
|SI s_t=7;  #0#225 = 0;  |FINSI;  || irpf 3
|SI s_t=8;  #0#227 = 0;  |FINSI;  || reten. 3
|PARA xx = 1; |SI xx [ 12; |HACIENDO xx = xx + 1;
    |SI s_t=1; nume1=xx+ 98; #0#151=#0#151+#0nume1; |FINSI; || irpf 1
    |SI s_t=2; nume1=xx+110; #0#152=#0#152+#0nume1; |FINSI; || reten. 1
    |SI s_t=3; nume1=xx+122; #0#153=#0#153+#0nume1; |FINSI; || dto. s.s.
    |SI s_t=4; nume1=xx+134; #0#154=#0#154+#0nume1; |FINSI; || exenta
    |SI s_t=5; nume1=xx+175; #0#224=#0#224+#0nume1; |FINSI; || irpf 2
    |SI s_t=6; nume1=xx+187; #0#226=#0#226+#0nume1; |FINSI; || reten. 2
    |SI s_t=7; nume1=xx+199; #0#225=#0#225+#0nume1; |FINSI; || irpf 3
    |SI s_t=8; nume1=xx+211; #0#227=#0#227+#0nume1; |FINSI; || reten. 3
|SIGUE;
|SI s_t=1;  |PINTA #0#151;  |FINSI;
|SI s_t=2;  |PINTA #0#152;  |FINSI;
|SI s_t=3;  |PINTA #0#153;  |FINSI;
|SI s_t=4;  |PINTA #0#154;  |FINSI;
|SI s_t=5;  |PINTA #0#224;  |FINSI;
|SI s_t=6;  |PINTA #0#226;  |FINSI;
|SI s_t=7;  |PINTA #0#225;  |FINSI;
|SI s_t=8;  |PINTA #0#227;  |FINSI;
|FPRC;

|PROCESO claves;
    sw_clave = 0;
    alfa1 = #0#148; |QBF alfa1;
    alfa2 = #0#228; |QBF alfa2;
    alfa3 = #0#229; |QBF alfa3;
|SI alfa1 ! "";     sw_clave = 1;  |FINSI;
|SI alfa2 ! "";     sw_clave = 1;  |FINSI;
|SI alfa3 ! "";     sw_clave = 1;  |FINSI;
|SI sw_clave = 0;
    |MENAV "    AVISO!!! Trabajador sin claves perceptoras ...";
|FINSI;
|FPRC;
*/

|PROCESO nifletra; |TIPO 0;  || CALCULA LETRA NIF CUANDO SE PULSA -F1-
||SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI FSalida = 13;
     |HAZ Acumulados;
     |ERROR;
     |ACABA;
|FINSI;
|SI FSalida = 14;
     |HAZ DatosIrpf;
     |ERROR;
     |ACABA;
|FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;

    modo = (FEntrada / 100) ! 0;
    alfa1 = #0Campo;
|QBT alfa1;
|SI alfa1 = ""; |Y modo ! 4;
    |MENAV "    AVISO !!! Trabajador sin D.N.I. ...";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO control2; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI FSalida = 9;
        alfa1 = #0Campo;
    |QBF alfa1;
        alfa2 = alfa1 % 102; alfa3 = alfa1 % -108;
        alfa4 = alfa3 % 101;
    |SI alfa4 = "0";
            alfa3 = alfa3 % 207;
            alfa1 = alfa2 + alfa3;
    |FINSI;
        nume1 = alfa1;
        nume2 = nume1 / 97;
    |HAZ trunca2;
    |SI nume1 ] 0; |Y nume1 [ 99;
            alfa1 = #0Campo;
        |QBF alfa1;
            alfa2 = nume1;
            alfa2 = "00" + alfa2;
            alfa2 = alfa2 % -102;
            alfa1 = alfa1 + alfa2;
            #0Campo = alfa1;
        |PINTA #0Campo;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO trunca2;
    corta = 0;
    alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
|PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
        sitio = (jg * 100) + 1;
        alfa2 = alfa1 % sitio;
    |SI alfa2 = ".";  corta = jg;  |FINSI;
|SIGUE;
|SI corta ! 0;
        sitio = 100 + corta - 1;
        alfa1 = alfa1 % sitio;
|FINSI;
    nume3 = alfa1;
    nume1 = nume1 - (nume3 * 97);
|FPRC;

|PROCESO menor; |TIPO 0;       || HALLA EDAD A PARTIR DE FECHA NACIMIENTO
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI #0Campo ! blanco; |Y #0Campo ! puntos;
        sistema = ~;
        fechtra = #0Campo;
        anynac1 = fechtra % -104;    || desglosa fecha nacimiento en a¤os
        anynac2 = anynac1;
        mesnac1 = fechtra %  402;    || meses
        mesnac2 = mesnac1;
        dianac1 = fechtra %  102;    || y dias
        dianac2 = dianac1;
        fechtra = sistema;
        anyact1 = fechtra % -104;    || desglosa fecha actual en a¤os
        anyact2 = anyact1;
        mesact1 = fechtra %  402;    || meses
        mesact2 = mesact1;
        diaact1 = fechtra %  102;    || y dias
        diaact2 = diaact1;
        edadxxx = anyact2 - anynac2; || halla los a¤os
    |SI mesnac2 > mesact2;
        edadxxx = edadxxx - 1;   || resta un a¤o si aun no ha llegado el mes
    |FINSI;
    |SI mesnac2 = mesact2; |Y dianac2 > diaact2; ||o si aun no ha llegado el dia
        edadxxx = edadxxx - 1;
    |FINSI;
|SINO;
        edadxxx = -1;
|FINSI;
|SI edadxxx < 16; |Y edadxxx ! -1;
    |MENAV "    AVISO !!! El trabajador es menor de 16 a¤os ...";
|FINSI;
|FPRC;

|PROCESO ayuda1; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|PUSHV 06102351;
|CUADRO 06 10 23 51;
|ATRI R;
||            1234567890123456789012345678901234567890
|PINTA 0711, " ----- CLAVES DE SALARIO POSIBLES ----- ";
|PINTA 0811, " (M) cotizacion mensual                 ";
|PINTA 0911, " (D) cotizacion diaria                  ";
|PINTA 1011, " (I) cotizacion irregular por dias      ";
|PINTA 1111, " (P) cotizacion irregular por horas     ";
|PINTA 1211, " (T) tiempo parcial cotizacion diaria   ";
|PINTA 1311, " (X) tiempo parcial cotizacion mensual  ";
|PINTA 1411, " (A) R.Agrario, Sistema General         ";
|PINTA 1511, " (E) R.Agrario, Jornadas Reales         ";
|PINTA 1611, " (e) R.Agrario, Jornadas-Extranj.Contin.";
|PINTA 1711, " (C) r.citricos, lunes/sabado           ";
|PINTA 1811, " (F) r.citricos, lunes/viernes          ";
|PINTA 1911, " (H) gerentes/cooperativistas autonomos ";
|PINTA 2011, " (L) funcionario Administracion Local   ";
|PINTA 2111, " (N) funcionario sin exencion Seg.Social";
|ATRI 0;
|FPRC;

|PROCESO ayuda2; |TIPO 0;
nTecla = FSalida;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|POPV;
|SI Campo = 42;     |HAZ def_regimen;   |FINSI;
|SI Campo = 97;     |HAZ no_ajuste;     |FINSI;
|FPRC;

|PROCESO ayuda3; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|PUSHV 12322173;
|CUADRO 12 32 21 73;
|ATRI R;
||            9012345678901234567890123456789012345678
|PINTA 1333, " -----  TIPOS DE AJUSTE POSIBLES ------ ";
|PINTA 1433, " (0) Sin ajuste                         ";
|PINTA 1533, " (1) A brutos   (no cotiza -407-)       ";
|PINTA 1633, " (2) A brutos   (cotiza -120-)          ";
|PINTA 1733, " (3) A liquidos (no cotiza -407-)       ";
|PINTA 1833, " (4) A liquidos (cotiza -120-)          ";
|PINTA 1933, " (5) A brutos   (no cot./no IRPF -411-) ";
|PINTA 2033, " (6) A liquidos (no cot./no IRPF -411-) ";
|ATRI 0;
|FPRC;

|PROCESO notipov; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

    nume2 = Campo - 8;
|SI #0nume2 = "V";
    |SI Campo = 165;  |CAMPO_MODIFICA #0#165, 1, "N";  |FINSI;
    |SI Campo = 166;  |CAMPO_MODIFICA #0#166, 1, "N";  |FINSI;
    |SI Campo = 167;  |CAMPO_MODIFICA #0#167, 1, "N";  |FINSI;
    |SI Campo = 168;  |CAMPO_MODIFICA #0#168, 1, "N";  |FINSI;
    |SI Campo = 169;  |CAMPO_MODIFICA #0#169, 1, "N";  |FINSI;
    |SI Campo = 170;  |CAMPO_MODIFICA #0#170, 1, "N";  |FINSI;
    |SI Campo = 171;  |CAMPO_MODIFICA #0#171, 1, "N";  |FINSI;
    |SI Campo = 172;  |CAMPO_MODIFICA #0#172, 1, "N";  |FINSI;
|SINO;
    |SI Campo = 165;  |CAMPO_MODIFICA #0#165, 1, "S";  |FINSI;
    |SI Campo = 166;  |CAMPO_MODIFICA #0#166, 1, "S";  |FINSI;
    |SI Campo = 167;  |CAMPO_MODIFICA #0#167, 1, "S";  |FINSI;
    |SI Campo = 168;  |CAMPO_MODIFICA #0#168, 1, "S";  |FINSI;
    |SI Campo = 169;  |CAMPO_MODIFICA #0#169, 1, "S";  |FINSI;
    |SI Campo = 170;  |CAMPO_MODIFICA #0#170, 1, "S";  |FINSI;
    |SI Campo = 171;  |CAMPO_MODIFICA #0#171, 1, "S";  |FINSI;
    |SI Campo = 172;  |CAMPO_MODIFICA #0#172, 1, "S";  |FINSI;
|FINSI;
|FPRC;

|PROCESO desigual; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI #0Campo ! "E";|Y #0Campo ! " ";
    |SI Campo = 148;
        |SI #0Campo = #0#228; |O #0Campo = #0#229;
            |MENAV "    ATENCION!!! Claves iguales ...";
            |ERROR;
        |FINSI;
    |FINSI;
    |SI Campo = 228;
        |SI #0Campo = #0#148; |O #0Campo = #0#229;
            |MENAV "    ATENCION!!! Claves iguales ...";
            |ERROR;
        |FINSI;
    |FINSI;
    |SI Campo = 229;
        |SI #0Campo = #0#148; |O #0Campo = #0#228;
            |MENAV "    ATENCION!!! Claves iguales ...";
            |ERROR;
        |FINSI;
    |FINSI;
|SINO;
    |SI #0Campo = "E";
        |MENAV "    ATENCION!!! Clave gestionada con conceptos 41? ...";
        |ERROR;
    |FINSI;
|FINSI;

|SI Campo = 228;    |HAZ noentra2; |FINSI;
|SI Campo = 229;    |HAZ noentra3; |FINSI;
|FPRC;

|PROCESO defanti; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI #0Campo = "          ";
        #0Campo = #0#34;
    |PINTA #0Campo;
|FINSI;
|FPRC;

|PROCESO timeparc; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI #0#42 = "X";|O #0#42 = "T";
    |CAMPO_MODIFICA #0#234, 1, "S";
|SINO;
    |CAMPO_MODIFICA #0#234, 1, "N";
|FINSI;
|FPRC;

|PROCESO pluriem; |TIPO 0;
     |SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

     |SI #0#237 = "S";
          |DBASE aAlfa;
          |QBF aAlfa;
          aAlfa = aAlfa + "def/nompluri.mas";
          |CARGA_DEF aAlfa, temp0001@;

          |DBASE aAlfa;
          |QBF aAlfa;
          aAlfa = aAlfa + "fich/";
          |PATH_DAT #temp0001@#aAlfa#;

          |SI FSalida = 0;
               |ABRE #temp0001@;
               #temp0001@#0 = #0#0;
               #temp0001@#1 = #0#1;
               |LEE 101#temp0001@.=;
               |SI FSalida ! 0;
                    aMensa = "    ATENCION. Es necesario definir la proporción en pluriempleo ";
                    aMensa = aMensa + "para los topes de contingencias.";
                    |MENAV aMensa;
                    aMensa = "    Opción: Maestros / Complementarios I / Definición de Topes ";
                    aMensa = aMensa + "de Pluriempleo por Trabajador";
                    |MENAV aMensa;
               |FINSI;
               |CIERRA #temp0001@;
               |DESCARGA_DEF #temp0001@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO pluriem2; |TIPO 0;
|ACABA;
     |SI #0#237 = "S"; |Y #0#236 = 0;
          aAlfa1 = "    En Pluriempleo es necesario indicar el grupo mayor de ";
          aAlfa1 = aAlfa1 + "cotizacion.";
          |MENAV aAlfa1;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO noentra2; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

    alfa1 = #0#228;
|QBF alfa1;
|SI alfa1 = "";  alfa2 = "N";  |FINSI;
|SI alfa1 ! "";  alfa2 = "S";  |FINSI;
|CAMPO_MODIFICA #0#176, 1, alfa2;
|CAMPO_MODIFICA #0#177, 1, alfa2;
|CAMPO_MODIFICA #0#178, 1, alfa2;
|CAMPO_MODIFICA #0#179, 1, alfa2;
|CAMPO_MODIFICA #0#180, 1, alfa2;
|CAMPO_MODIFICA #0#181, 1, alfa2;
|CAMPO_MODIFICA #0#182, 1, alfa2;
|CAMPO_MODIFICA #0#183, 1, alfa2;
|CAMPO_MODIFICA #0#184, 1, alfa2;
|CAMPO_MODIFICA #0#185, 1, alfa2;
|CAMPO_MODIFICA #0#186, 1, alfa2;
|CAMPO_MODIFICA #0#187, 1, alfa2;
|CAMPO_MODIFICA #0#188, 1, alfa2;
|CAMPO_MODIFICA #0#189, 1, alfa2;
|CAMPO_MODIFICA #0#190, 1, alfa2;
|CAMPO_MODIFICA #0#191, 1, alfa2;
|CAMPO_MODIFICA #0#192, 1, alfa2;
|CAMPO_MODIFICA #0#193, 1, alfa2;
|CAMPO_MODIFICA #0#194, 1, alfa2;
|CAMPO_MODIFICA #0#195, 1, alfa2;
|CAMPO_MODIFICA #0#196, 1, alfa2;
|CAMPO_MODIFICA #0#197, 1, alfa2;
|CAMPO_MODIFICA #0#198, 1, alfa2;
|CAMPO_MODIFICA #0#199, 1, alfa2;
|CAMPO_MODIFICA #0#230, 1, alfa2;
|CAMPO_MODIFICA #0#231, 1, alfa2;
|FPRC;

|PROCESO noentra3; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

    alfa1 = #0#229;
|QBF alfa1;
|SI alfa1 = "";  alfa2 = "N";  |FINSI;
|SI alfa1 ! "";  alfa2 = "S";  |FINSI;
|CAMPO_MODIFICA #0#200, 1, alfa2;
|CAMPO_MODIFICA #0#201, 1, alfa2;
|CAMPO_MODIFICA #0#202, 1, alfa2;
|CAMPO_MODIFICA #0#203, 1, alfa2;
|CAMPO_MODIFICA #0#204, 1, alfa2;
|CAMPO_MODIFICA #0#205, 1, alfa2;
|CAMPO_MODIFICA #0#206, 1, alfa2;
|CAMPO_MODIFICA #0#207, 1, alfa2;
|CAMPO_MODIFICA #0#208, 1, alfa2;
|CAMPO_MODIFICA #0#209, 1, alfa2;
|CAMPO_MODIFICA #0#210, 1, alfa2;
|CAMPO_MODIFICA #0#211, 1, alfa2;
|CAMPO_MODIFICA #0#212, 1, alfa2;
|CAMPO_MODIFICA #0#213, 1, alfa2;
|CAMPO_MODIFICA #0#214, 1, alfa2;
|CAMPO_MODIFICA #0#215, 1, alfa2;
|CAMPO_MODIFICA #0#216, 1, alfa2;
|CAMPO_MODIFICA #0#217, 1, alfa2;
|CAMPO_MODIFICA #0#218, 1, alfa2;
|CAMPO_MODIFICA #0#219, 1, alfa2;
|CAMPO_MODIFICA #0#220, 1, alfa2;
|CAMPO_MODIFICA #0#221, 1, alfa2;
|CAMPO_MODIFICA #0#222, 1, alfa2;
|CAMPO_MODIFICA #0#223, 1, alfa2;
|CAMPO_MODIFICA #0#232, 1, alfa2;
|CAMPO_MODIFICA #0#233, 1, alfa2;
|FPRC;

|PROCESO clave_cot; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|CAMPO_MODIFICA #0#64, 1, "S";
|SI #0#42 ! "M";|Y #0#42 ! "D";
 |Y #0#42 ! "X";|Y #0#42 ! "T";
 |Y #0#42 ! "I";|Y #0#42 ! "P";
        #0#64 = #0#42;
    |CAMPO_MODIFICA #0#64, 1, "N";
|SINO;
    |SI #0#64 ! "M";|Y #0#64 ! "D";
        |SI #0#42 = "D";|O #0#42 = "T";
                #0#64 = "D";
        |SINO;
                #0#64 = "M";
        |FINSI;
    |FINSI;
|FINSI;
|PINTA #0#64;
|FPRC;

|PROCESO no240; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI #0#239 = "D";
        alfa1 = "S";
|SINO;
        alfa1 = "N";
|FINSI;
|CAMPO_MODIFICA #0#240, 1, alfa1;
|FPRC;

|PROCESO no_ajuste; |TIPO 0;
|SI #0#97 = 0;
        alfa1 = "N";
|SINO;
        alfa1 = "S";
|FINSI;
|CAMPO_MODIFICA #0#98, 1, alfa1;
|CAMPO_MODIFICA #0#61, 1, alfa1;
|FPRC;

|PROCESO solo_liquido; |TIPO 7;
|SI #0#97 ! 3;|Y #0#97 ! 4;|Y #0#97 ! 6;
        #0#246 = "N";
    |PINTA #0#246;
    |CAMPO_MODIFICA #0#246, 1, "N";
|SINO;
    |CAMPO_MODIFICA #0#246, 1, "S";
|FINSI;
|FPRC;

|PROCESO min_reg;
    #6#0 = 1;
|FPRC;

|PROCESO max_reg;
    #6#0 = 9999;
|FPRC;

|PROCESO regimen; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

    inkey = FSalida;
|SI inkey = 9;
    |PUSHV 0501 2380;
    |ENTLINEAL #1#6, 1, 4, 21, 1, min_reg, max_reg;
    |POPV;
|FINSI;
|HAZ pinta_regimen;
|SI inkey = 9; |ERROR;   |FINSI;
|FPRC;

|PROCESO def_regimen;
    modo = (FEntrada / 100) ! 0;
|SI modo = 1;
    |PDEFECTO #0, 247, 248;
    |SI #0#42 = "H";                                   #0#247 = 521;  |FINSI;
    |SI #0#42 = "A";|O #0#42 = "B";|O #0#42 = "E";|O #0#42 = "e";
         fFecha = ~;
         || aAlfa = fFecha;
         aAlfa = #0#36;
         aAlfa = aAlfa % -104;
         nume1 = aAlfa;
         |SI nume1 ] 2012; |O nume1 = 0;
              #0#247 = 163;
         |SINO;
              #0#247 = 613;
         |FINSI;
    |FINSI;
    |PINTA #0#247;
    |HAZ pinta_regimen;
|FINSI;
|FPRC;

|PROCESO pinta_regimen; |TIPO 7;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|DDEFECTO #6;
|ABRE #6;
    #6#0 = #0#247;
|LEE 000#6=;
|CIERRA #6;
|PINTA #0#247;
    alfa1 = #6#1 % 120;
|ATRI I;  |PINTA 2260, alfa1; |ATRI 0;
|FPRC;

|PROCESO pincat; |TIPO 0;
    nume1 = Contenido;
|SI nume1 ! #0Campo;
        #0#18 = #3#2;
    |PINTA #0#18;
|FINSI;
|FPRC;

|PROCESO abrevia_antes; |TIPO 7;
     aAntes = #0Campo;
|FPRC;

|PROCESO abrevia; |TIPO 0;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;  |ACABA;   |FINSI;        || en alta no!

     |SI Campo ! 204;
          aAntes = Contenido;
     |FINSI;

     |SI #0Campo ! aAntes;
          |PUSHV 0501 2380;
          |AVISO;
          |PINPA #2#50;
          |PAUSA;
          |POPV;
     |FINSI;
|FPRC;
____________________________________/ BORRADO DE RELACIONES
|PROCESO labvaltb;
     |BORRA 020#labvaltb.a;
|FPRC;

|DEFBUCLE labvaltb;
     #labvaltb#1;
     ;
     "labtraba", 000, aEmp_borr, aTra_borr, blanco, blanco, blanco;
     "labtraba", 999, aEmp_borr, aTra_borr, blanco, blanco, blanco;
     be;
     NULL, labvaltb;
|FIN;

|PROCESO CB; |TIPO 12;
     |SI swCambioDNI = 1;
          swCambioDNI = 0;
          |ACABA;
     |FINSI;
     |SI FSalida ! 0; |Y FSalida ! 1; |Y FSalida ! 5; |Y nModo = 1;
          aTra_borr = #labtraba#1;
          aTra_borr = aTra_borr + blanco - "     ";
          aEmp_borr = #labtraba#0;
          aEmp_borr = aEmp_borr + blanco - "     ";
          |BUCLE labvaltb;
     |FINSI;
     |SI FSalida = 1; |O FSalida = 5;
          aAlfa = "     " + &191 + "ES CORRECTO?";
          |CONFI aAlfa;
          |SI FSalida ! 0;
               |ERROR;
               |PTEC 807;
          |SINO;
               |HAZ CambiaRelacion;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO borrando; |TIPO 2;
    baja = FEntrada / 100;
    baja = baja ! 0;
|SI baja = 3;
    |HAZ aviso_tr;
        em_borr = #0#0;
        tr_borr = #0#1;
        nif_borr = #0#7;
    eaProcedencia = "labtraba";
    |SUB_EJECUTA "nomborr1.run";
    eaProcedencia = "labtraba";
    |SUB_EJECUTA "nomborr2.run";
    |HAZ t_aviso9;
|FINSI;
|FPRC;

|PROCESO aviso_tr;
|PUSHV 05012380;
|HAZ t_color_f;
|CUADRO 09 30 11 71;
||            1234567890123456789012345678901234567890
|HAZ t_color_c;
|PINTA 1031, "         Borrando Relaciones ...        ";
|ATRI 0;
|FPRC;

|PROCESO t_color_c;        || activa el color caracter en avisos
|COLOR 14, 0;
|ATRI 0;
|FPRC;

|PROCESO t_color_f;        || activa el color graficos en avisos
|COLOR 4, 0;
|ATRI 0;
|FPRC;

|PROCESO t_aviso9;         || desde calculo 'descuadre', 'modbaj'
|POPV;
|FPRC;
____________________________________/ DATOS APRENDIZAJE/TIEMPO PARCIAL
|PROCESO modo; |TIPO 0;
     |SI FSalida = 5; |O FSalida = 4;
          |ACABA;
     |FINSI;
     modito = (FEntrada / 100) ! 0;      || se perdia en el 'ENDATOS'
|FPRC;

|PROCESO cotizacion; |TIPO 0;
|SI FSalida = 5;|O FSalida = 4;    |ACABA;   |FINSI;

|SI Campo = 45;
     |SI #0#45 = "085"; |O #0#45 = "097"; |O #0#45 = "421";
||O #0#45 = "422";
     ||O #0#45 = "087"; |O #0#45 = "064"; |O #0#45 = "065";
     || ESTOS YA NO EXISTEN: 64,65,87

     ||SI #0#33 = 0;|Y #0#45 ! "064";|Y #0#45 ! "065";
          |SI #0#33 ! 10; |Y #0#33 ! 11;
               #0#33 = 10;
               |PINTA #0#33;
          |FINSI;
     |FINSI;
|FINSI;

|SI Campo = 33;
     |SI #0#45 = "085"; |O #0#45 = "097"; |O #0#45 = "421";
||O #0#45 = "422";
          |SI #0#33 ! 10; |Y #0#33 ! 11;
               alfa1 = "    Grupo de Cotizacion incorrecto."
               |MENAV alfa1;
               |POSICIONATE #0#33;
          |SINO;
               modo = modito;
               |SI #0#45 ! Contenido; modo = 1; |FINSI;
               |SI modo = 1;
                    |HAZ coti_cent;                  || centros especiales
               |FINSI;
          |FINSI;
    |FINSI;
|FINSI;

|FPRC;

|PROCESO coti_cent;
|ABRE #5;
|DDEFECTO #5;
    #5#0 = #0#0;
    #5#13 = #0#77;
|SI #0#45 = "097";|O #0#45 = "085"; |O #0#45 = "421"; |O #0#45 = "422";
        #5#1 = "87";
|SINO;
    |SI #0#45 = "065";
            #5#1 = "64";
    |SINO;
            #5#1 = #0#45 % 2;
    |FINSI;
|FINSI;
|LEE 000#5=;
|SI FSalida ! 0;
    |PUSHV 05012380;
    |ABRE #2;
    |DDEFECTO #2;
        #2#0 = #0#0;
        #2#1 = #0#77;
    |LEE 020#2=;
    |CIERRA #2;
        #5#3 = #2#3;     || calle
        #5#4 = #2#4;     || numero
        #5#5 = #2#5;     || piso
        #5#6 = #2#6;     || localidad
        #5#7 = #2#7;     || cod.postal 1
        #5#8 = #2#8;     || cod.postal 2
        #5#9 = #2#9;     || provincia
        #5#10 = "";      || NAFSS
        #5#11 = 1;       || nro.trabajadores
        #5#14 = #2#13;   || clave entidad
        #5#15 = #2#14;   || entidad
    |PINPA #0#5;
    |PINDA #0#5;
    |ENDATOS #1#5;
    |SI FSalida = 0;
        |GRABA 020#5n;
    |FINSI;
    |POPV;
|FINSI;
|CIERRA #5;
|FPRC;

|PROCESO MinimoDef; |TIPO 7;
     aFabre = "";
     |DIRECTORIO aFabre;
     aFabre = "rt  " + aFabre + "aginom/bin/gafi0001.tab";
     |FABRE aFabre;
     |SI FSalida ] 0;
          |FCIERRA FSalida;
          |DDEF aDef;
          |QBF aDef;
          aAlfa = aDef % 1306;
          |SI aAlfa = "agilab";    || estoy en produccion desde agilab
               |ACABA;             || no me compruebes nada, que si no
          |FINSI;                  || das fallo en CARGA_DEF
          aDef = aDef + "gafi0001";
          |CARGA_DEF aDef, copiadef@;
          |SI FSalida = 0;
               |ABRE #500;
               |LEE 000#500.p;
               |SI FSalida = 0;
                    |SI nModo = 1; |Y #500#2 = "S"; |Y #0Campo = 0;
                         #0Campo = #500#1;
                         |PINTA #0Campo;
                    |FINSI;
               |FINSI;
               |CIERRA #500;
          |FINSI;
          |DESCARGA_DEF #copiadef@;
     |FINSI;
|FPRC;

|PROCESO Minimo; |TIPO 0;
     aFabre = "";
     |DIRECTORIO aFabre;
     aFabre = "rt  " + aFabre + "aginom/bin/gafi0001.tab";
     |FABRE aFabre;
     |SI FSalida ] 0;
          |FCIERRA FSalida;
          |DDEF aDef;
          |QBF aDef;
          aAlfa = aDef % 1306;
          |SI aAlfa = "agilab";    || estoy en produccion desde agilab
               |ACABA;             || no me compruebes nada, que si no
          |FINSI;                  || das fallo en CARGA_DEF
          aDef = aDef + "gafi0001";
          |CARGA_DEF aDef, copiadef@;
          |SI FSalida = 0;
               |ABRE #500;
               |LEE 000#500.p;
               |SI FSalida = 0;
                    |SI #0Campo < #500#1; |Y #500#3 = "N";
                         alfa1 = #500#1;
                         alfa1 = "    Se aplicara la retencion minima definida (" + alfa1;
                         alfa1 = alfa1 + "%).";
                         |MENAV alfa1
                         #0Campo = #500#1;
                         |PINTA #0Campo;
                    |FINSI;
               |FINSI;
               |CIERRA #500;
          |FINSI;
          |DESCARGA_DEF #copiadef@;
     |FINSI;
|FPRC;

|PROCESO modulo; |TIPO 0;
     |SI #0#42 = "L";|O #0#42 = "N";
          aFabre = "";
          |DIRECTORIO aFabre;
          aFabre = "rt  " + aFabre + "aginom/bin/noyprepa.tab";
          |FABRE aFabre;
          |SI FSalida ] 0;
               |FCIERRA FSalida;
          |SINO;
               |MENAV "    Modulo especial requerido no instalado ...";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnEspecie; |TIPO 7;
     nClave = Campo - 6;
     nSubCl = Campo - 3;
     nEnEsp = Campo;
     nReper = Campo + 3;

     |C_M #labtraba#nEnEsp#, 1, "S";
     |C_M #labtraba#nReper#, 1, "S";

     enEjerIRPF = 2999;
     |HAZ BuscaEjerIRPF;

     |ABRE #dsmom073;
     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #labtraba#nClave#;
     #dsmom073#2 = #labtraba#nSubCl#;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;  |O #dsmom073#5 = "N";
         #labtraba#nEnEsp# = "N";
         #labtraba#nReper# = "N";
         |PINTA #labtraba#nEnEsp#;
         |PINTA #labtraba#nReper#;
         |C_M #labtraba#nEnEsp#, 1, "N";
         |C_M #labtraba#nReper#, 1, "N";
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;

|PROCESO Repercute; |TIPO 7;
     nEnEsp = Campo - 3;
     nReper = Campo;
     aAlfa1 = #labtraba#nEnEsp#;
     |C_M #labtraba#nReper#, 1, aAlfa1;
     |SI aAlfa1 = "N";
          #labtraba#nReper# = "N";
          |PINTA #labtraba#nReper#;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja32;
     #32#0 = nEmpr;
     #32#1 = nAnyo;
     #32#2 = #0#7;
     #32#3 = " ";
     #32#4 = "  ";
     #32#5 = 0;
     #32#6 = 01;
|FRUT;

|RUTINA ClaveAlta32;
     #32#0 = nEmpr;
     #32#1 = nAnyo;
     #32#2 = #0#7;
     #32#3 = "z";
     #32#4 = "zz";
     #32#5 = 4;
     #32#6 = 9999;
|FRUT;

|RUTINA ClaveBaja35;
     #eosm0035#0 = nEmpr;
     #eosm0035#1 = nAnyo;
     #eosm0035#2 = #0#7;
     #eosm0035#3 = " ";
     #eosm0035#4 = "  ";
     #eosm0035#5 = 0;
     #eosm0035#6 = 01;
|FRUT;

|RUTINA ClaveAlta35;
     #eosm0035#0 = nEmpr;
     #eosm0035#1 = nAnyo;
     #eosm0035#2 = #0#7;
     #eosm0035#3 = "z";
     #eosm0035#4 = "zz";
     #eosm0035#5 = 4;
     #eosm0035#6 = 9999;
|FRUT;

|PROCESO EsteAnyo;
     |ABRE #30;
     #30#0 = #labtraba#0;
     #30#1 = 9999;
     |LEE 000#30];
     |SI FSalida = 0;
          |LEE 000#30a;
     |SINO;
          |LEE 000#30u;
     |FINSI;
     |SI FSalida = 0;|Y #30#0 = #labtraba#0;
          nAnyo = #30#1;
     |SINO;
          fFech1 = ~;
          aAlfa1 = fFech1;
          aAlfa1 = aAlfa1 % -104;
          nAnyo = aAlfa1;
     |FINSI;
     |CIERRA #30;
|FPRC;

|PROCESO Acumulados;
     nEmpr = #0#0;
     |ABRE #40;
     |SELECT #2#40;
     #40#1 = nEmpr;
     #40#0 = 0;
     |LEE 000#40];
     |SI FSalida = 0;|Y #40#1 = nEmpr;
          nEmpr = #40#0;
     |FINSI;
     |CIERRA #40;

     |HAZ EsteAnyo;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4;
          nModo = 2;
     |FINSI;

     |ABRE #31;
     #31#0 = nEmpr;
     #31#1 = nAnyo;
     #31#2 = #0#7;
     |LEE 000#31=;
     |SI FSalida ! 0;
          #31#3 = #0#2;
          |GRABA 020#31n;
     |FINSI;
     |CIERRA #31;

     |PUSHV 0501 2380;

     |SI nAnyo [ 2015;
         |ABRE #32;
         |ENTLINEAL #1#32, 4, nModo, 22, 1, ClaveBaja32, ClaveAlta32;
         |CIERRA #32;
     |FINSI;

     |SI nAnyo ] 2016;
         |ABRE #eosm0035;
         |ENTLINEAL #1#eosm0035, 4, nModo, 22, 1, ClaveBaja35, ClaveAlta35;
         |CIERRA #eosm0035;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO DatosPersonales;
     |VARIABLES;
          nEstado2 = 0;
          nPara1 = 0;
     |FIN;

     ||PINPA #0#1006;
     ||DDEFECTO #1006;
     |ABRE #1006;
     #1006#0 = #labtraba#7;
     #1006#40 = nAnyo;
     |LEE 101#1006=;                || busca datos personales este a¤o
     nEstado2 = FSalida;
     |SI nEstado2 ! 0;
          #1006#0 = #labtraba#7;
          #1006#40 = nAnyo - 1;
          |LEE 000#1006=;           || busca datos personales a¤o pasado
          |SI FSalida = 0;
               #1006#40 = nAnyo;
               #1006#1 = #1006#1 + 1;
               |GRABA 020#1006b;
               nEstado2 = FSalida;
          |SINO;
               #1003#0 = #labtraba#7;
               #1003#40= nAnyo - 1;
               #1003#41= #labtraba#7;
               |LEE 000#1003=;      || busca parametros a¤o pasado
               |SI FSalida = 0;
                    #1003#40= nAnyo;
                    #1003#1 = #1003#1 + 1;
                    |PARA nPara1 =  1; |SI nPara1 [  8; |HACIENDO nPara1 = nPara1 + 1;
                         #1006nPara1 = #1003nPara1;
                    |SIGUE;
                    |PARA nPara1 = 20; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 1;
                         #1006nPara1 = #1003nPara1;
                    |SIGUE;
                    |PARA nPara1 = 42; |SI nPara1 [ 71; |HACIENDO nPara1 = nPara1 + 1;
                         #1006nPara1 = #1003nPara1;
                    |SIGUE;
                    #1006#40 = nAnyo;
                    |GRABA 020#1006b;
                    nEstado2 = FSalida;
               |SINO;
                    #1006#40 = nAnyo;
               |FINSI;
          |FINSI;
     |FINSI;
     ||PINDA #0#1006;
     ||ENDATOS #1#1006;
     |SI FSalida = 0;
          |SI nEstado2 = 0;   |GRABA 020#1006a;    |FINSI;
          |SI nEstado2 ! 0;   |GRABA 020#1006n;    |FINSI;
     |FINSI;
     |LIBERA #1006;
     |CIERRA #1006;

     |PARA nPara1 =  1; |SI nPara1 [  8; |HACIENDO nPara1 = nPara1 + 1;
          #1003nPara1 = #1006nPara1;
     |SIGUE;
     |PARA nPara1 = 20; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 1;
          #1003nPara1 = #1006nPara1;
     |SIGUE;
     |PARA nPara1 = 42; |SI nPara1 [ 71; |HACIENDO nPara1 = nPara1 + 1;
          #1003nPara1 = #1006nPara1;
     |SIGUE;
|FPRC;

|PROCESO DatosIrpf;
     |HAZ EsteAnyo;
     |PUSHV 05012380;
     |PINPA #0#nomir003;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4;
          |DDEFECTO #nomir003;
          |ABRE #nomir003;
          #nomir003#0 = #labtraba#7;
          #nomir003#40 = nAnyo;
          #nomir003#41 = #labtraba#0;
          |LEE 101#nomir003.=;
          FEstado = FSalida;
          |SI FEstado ! 0;
               |HAZ DatosPersonales;
          |FINSI;
          |PINDA #0#nomir003;
          |ENDATOS #1#nomir003;
          |SI FEstado = 0;
               |GRABA 020#nomir003.a;
          |SINO;
               |GRABA 020#nomir003.n
          |FINSI;
          |LIBERA #nomir003;
          |CIERRA #nomir003;
     |FINSI;
     |SI nModo = 4;
          |DDEFECTO #nomir003;
          |ABRE #nomir003;
          #nomir003#0 = #labtraba#7;
          #nomir003#40 = nAnyo;
          #nomir003#41 = #labtraba#0;
          |LEE 000#nomir003.=;
          |SI FSalida = 0;
               |PINDA #0#nomir003;
               |PAUSA;
          |SINO;
               |MENAV "0000Datos IRPF inaccesibles o inexistentes.";
          |FINSI;
          |CIERRA #nomir003;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO TipoRelacion; |TIPO 7;
     |SI #labtraba#99 = "A";|O #labtraba#100 = "A";|O #labtraba#101 = "A";
          |C_M #labtraba#111, 1, "S";
     |SINO;
          |C_M #labtraba#111, 1, "N";
          #labtraba#111 = 0;
          |PINTA #labtraba#111;
     |FINSI;
|FPRC;

|PROCESO eosm0034_1;
     #eosm0034#2 = #labtraba#7;
     |GRABA 000#eosm0034.n;
     |SI FSalida = 0;
          |BORRA 020#eosm0034.a;
     |FINSI;
     |LIBERA #eosm0034;
|FPRC;

|DEFBUCLE eosm0034;
 #eosm0034#1;
 ;
 nEmpr, 1900, aAlfa1, 0000, " ", "  ", 0;
 nEmpr, 9999, aAlfa1, 9999, "z", "zz", 9;
 be;
 NULL, eosm0034_1;
|FIN;

|PROCESO eosm0036_1;
     #eosm0036#2 = #labtraba#7;
     |GRABA 000#eosm0036.n;
     |SI FSalida = 0;
          |BORRA 020#eosm0036.a;
     |FINSI;
     |LIBERA #eosm0036;
|FPRC;

|DEFBUCLE eosm0036;
 #eosm0036#1;
 ;
 nEmpr, 1900, aAlfa1, 0000, " ", "  ", 0;
 nEmpr, 9999, aAlfa1, 9999, "z", "zz", 9;
 be;
 NULL, eosm0036_1;
|FIN;

|PROCESO nomir006_1;
     #nomir006#0 = #labtraba#7;
     |GRABA 000#nomir006.n;
     |SI FSalida = 0;
          |BORRA 020#nomir006.a;
     |FINSI;
     |LIBERA #nomir006;
|FPRC;

|DEFBUCLE nomir006;
 #nomir006#1;
 ;
 aAlfa1, 1900;
 aAlfa1, 9999;
 be;
 NULL, nomir006_1;
|FIN;

|PROCESO nomir005_1;
     #nomir005#0 = #labtraba#7;
     |GRABA 000#nomir005.n;
     |SI FSalida = 0;
          |BORRA 020#nomir005.a;
     |FINSI;
     |LIBERA #nomir005;
|FPRC;

|DEFBUCLE nomir005;
 #nomir005#1;
 ;
 aAlfa1, 1900, #labtraba#0;
 aAlfa1, 9999, #labtraba#0;
 be;
 NULL, nomir005_1;
|FIN;

|PROCESO nomir003_1;
     #nomir003#0 = #labtraba#7;
     |GRABA 000#nomir003.n;
     |SI FSalida = 0;
          |BORRA 020#nomir003.a;
     |FINSI;
     |LIBERA #nomir003;
|FPRC;

|DEFBUCLE nomir003;
 #nomir003#1;
 ;
 aAlfa1, 1900, #labtraba#0;
 aAlfa1, 9999, #labtraba#0;
 be;
 NULL, nomir003_1;
|FIN;

|PROCESO nomir001_1;
     #nomir001#0 = #labtraba#7;
     |GRABA 000#nomir001.n;
     |SI FSalida = 0;
          |BORRA 020#nomir001.a;
     |FINSI;
     |LIBERA #nomir001;
|FPRC;

|DEFBUCLE nomir001;
 #nomir001#1;
 ;
 aAlfa1, 1900, #labtraba#0;
 aAlfa1, 9999, #labtraba#0;
 be;
 NULL, nomir001_1;
|FIN;

|PROCESO eosm0032_1;
     #eosm0032#2 = #labtraba#7;
     |GRABA 000#eosm0032.n;
     |SI FSalida = 0;
          |BORRA 020#eosm0032.a;
     |FINSI;
     |LIBERA #eosm0032;
|FPRC;

|DEFBUCLE eosm0032;
 #eosm0032#1;
 ;
 #eosm0031#0, #eosm0031#1, aAlfa1, " ", "  ", 0,    0;
 #eosm0031#0, #eosm0031#1, aAlfa1, "z", "zz", 9, 9999;
 be;
 NULL, eosm0032_1;
|FIN;

|PROCESO eosm0035;
     #eosm0035#2 = #labtraba#7;
     |GRABA 000#eosm0035.n;
     |SI FSalida = 0;
          |BORRA 020#eosm0035.a;
     |FINSI;
     |LIBERA #eosm0035;
|FPRC;

|DEFBUCLE eosm0035;
     #eosm0035#1;
     ;
     #eosm0031#0, #eosm0031#1, aAlfa1, " ", "  ", 0,    0;
     #eosm0031#0, #eosm0031#1, aAlfa1, "z", "zz", 9, 9999;
     be;
     NULL, eosm0035;
|FIN;

|PROCESO eosm0031_1;
     #eosm0031#2 = #labtraba#7;
     |GRABA 000#eosm0031.n;
     |SI FSalida = 0;
          |BORRA 020#eosm0031.a;

          |SI #eosm0031#1 [ 2015;
              |BUCLE eosm0032;
          |FINSI;

          |SI #eosm0031#1 ] 2016;
              |BUCLE eosm0035;
          |FINSI;
     |FINSI;
     |LIBERA #eosm0031;
|FPRC;

|DEFBUCLE eosm0031;
 #eosm0031#1;
 ;
 nEmpr, 1900, aAlfa1;
 nEmpr, 9999, aAlfa1;
 be;
 NULL, eosm0031_1;
|FIN;

|PROCESO CambiaDNI; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 2; |ACABA;   |FINSI;

     aAlfa1 = Contenido;
     |SI #labtraba#Campo# ! aAlfa1;
          |MENSA "0000Recuperando Datos IRPF ...";

          nEmpr = #0#0;
          |ABRE #40;
          |SELECT #2#40;
          #40#1 = nEmpr;
          #40#0 = 0;
          |LEE 000#40];
          |SI FSalida = 0;|Y #40#1 = nEmpr;
               nEmpr = #40#0;
          |FINSI;
          |CIERRA #40;

          |BUCLE eosm0031;
          |BUCLE eosm0034;
          |BUCLE eosm0036;
          |BUCLE nomir001;
          |BUCLE nomir003;
          |BUCLE nomir005;
          |BUCLE nomir006;
          |BLIN 4;
          |PTEC 802;
          |PTEC 806;
          swCambioDNI = 1;
     |FINSI;
|FPRC;

|PROCESO n_nomir006_1;
     #nomir006#41 = #labtraba#2;
     |GRABA 020#nomir006.a;
     |LIBERA #nomir006;
|FPRC;

|DEFBUCLE n_nomir006;
 #nomir006#1;
 ;
 #labtraba#7, 1900;
 #labtraba#7, 9999;
 be;
 NULL, n_nomir006_1;
|FIN;

|PROCESO n_nomir001_1;
     #nomir001#1 = #labtraba#2;
     |GRABA 020#nomir001.a;
     |LIBERA #nomir001;
|FPRC;

|DEFBUCLE n_nomir001;
 #nomir001#1;
 ;
 #labtraba#7, 1900, #labtraba#0;
 #labtraba#7, 9999, #labtraba#0;
 be;
 NULL, n_nomir001_1;
|FIN;

|PROCESO CambiaNombre; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 2; |ACABA;   |FINSI;

     aAlfa1 = Contenido;
     |SI #labtraba#Campo# ! aAlfa1;
          |BUCLE n_nomir001;
          |BUCLE n_nomir006;
     |FINSI;
|FPRC;

|PROCESO CambiaAlgo; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 2; |ACABA;   |FINSI;

     aAlfa1 = Contenido;
     |SI #labtraba#Campo# ! aAlfa1;
          |MENAV "    ATENCION. Si se modifica el valor de este campo, ES OBLIGATORIO calcular acumulados.";
          |CONFI "0000N¿Está seguro de que desea modificarlo? (S/N): ";
          |SI FSalida ! 0;
               #labtraba#Campo# = aAlfa1;
               |PINTA #labtraba#Campo#;
          |SINO;
               |SI Campo ] 99;|Y Campo [ 101;
                    |SI #labtraba#Campo# = "L";
                         |MENAV "0000La clave para bases exentas es automatica ...";
                         |MENAV "0000No necesita informarla aqui ...";
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambiaRelacion; |TIPO 0;
     /*
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 2; |ACABA;   |FINSI;

     aAlfa1 = Contenido;
     |SI #labtraba#Campo# ! aAlfa1;
          |AVISO;
          |CONFI "0000SActualizar Tipo de Relacion en Datos de IRPF (S/N): ";
          |SI FSalida = 0;
               |PINTA 2410, "Ejercicio: ";
               E_sup = 2999;
               E_inf = 1900;
               |SI nEjerc = 0;
                    fFech1 = ~;
                    aAlfa1 = fFech1;
                    aAlfa1 = aAlfa1 % -104;
                    nEjerc = aAlfa1;
               |FINSI;
               nEjerc = 2421 ? 1;
               |SI FSalida = 0;
          */
                    fFech1 = ~;
                    aAlfa1 = fFech1;
                    aAlfa1 = aAlfa1 % -104;
                    nEjerc = aAlfa1;
                    |ABRE #nomir003;
                    #nomir003#0 = #labtraba#7;
                    #nomir003#40 = nEjerc;
                    #nomir003#41 = #labtraba#0;
                    |LEE 101#nomir003.=;
                    |SI FSalida = 0;
                         #nomir003#5 = #labtraba#111;
                         #nomir003#121 = #labtraba#130;
                         |GRABA 020#nomir003.a;
                    |FINSI;
                    |LIBERA #nomir003;
                    |CIERRA #nomir003;

                    |ABRE #nomir006;
                    #nomir006#0 = #labtraba#7;
                    #nomir006#40 = nEjerc;
                    |LEE 101#nomir006.=;
                    |SI FSalida = 0;
                         #nomir006#5 = #labtraba#111;
                         #nomir006#121 = #labtraba#130;
                         |GRABA 020#nomir006.a;
                    |FINSI;
                    |LIBERA #nomir006;
                    |CIERRA #nomir006;
               ||FINSI;
          ||FINSI;
     ||FINSI;
|FPRC;

|PROCESO RellenaContrato; |TIPO 0;
     nTecla = FSalida;
     aAlfa1 = #labtraba#45;
     |QBF aAlfa1;
     aAlfa1 = ("000" + aAlfa1) % -103;
     #labtraba#45 = aAlfa1;
     |PINTA #labtraba#45;
|FPRC;

|PROCESO Comp212; |TIPO 0;
     swSigue = 0;
     |SI #0#212 ] 1; |Y #0#212 [ 6;
          swSigue = 1;
     |FINSI;
     |SI #0#212 ] 13; |Y #0#212 [ 16;
          swSigue = 1;
     |FINSI;
     |SI #0#212 = 9;
          swSigue = 1;
     |FINSI;
     |SI swSigue = 0;
          |ERROR;
     |FINSI;
     |SI #0#212 = 9;
          aAlfa1 = "    ATENCION: Con el valor '9' indicado no se aplicara ";
          aAlfa1 = aAlfa1 + " a este trabajador la Bonificacion cuando le corresponda.";
          |MENAV aAlfa1;
          aAlfa1 = "     Desea Continuar?";
          |CONFI aAlfa1;
          |SI FSalida = 0;
               #0#211 = 0;
               |PINTA #0#211;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Rellena112; |TIPO 7;
     |SI #0#112 ! "N";|Y #0#112 ! "S";
          #0#112 = "N";
          |PINTA #0#112;
     |FINSI;
|FPRC;

|PROCESO Avisa35;
     |SI #0Campo ! Contenido;
          aAlfa1 = "    ATENCION: Este porcentaje se actualiza automaticamente";
          aAlfa1 = aAlfa1 + " al calcular la nomina segun normativa legal";
          |MENAV aAlfa1;
          aAlfa1 = "     Esta seguro de que desea cambiarlo manualmente?"
          |CONFI aAlfa1;
          |SI FSalida ! 0;
               #0Campo = Contenido;
               |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Construccion;
     |SI nModo ! 1;      || solo ALTA
          ||ACABA;
     |FINSI;
     |DBASE aBase;
     aBase = aBase + "bin/aomenlac.tab";
     aFabre = "rb  " + aBase;
     |FABRE aFabre;
     |SI FSalida ] 0;
          |DBASE aDef;
          |QBF aDef;
          aDef = aDef + "def/aomparam";
          |CARGA_DEF aDef, copiadef@;
          |SI FSalida = 0;
               |ABRE #500;
               |LEE 000#500p;
               |SI #500#9 = "S";
                    aAlfa1 = "     Enlazar trabajador con Modulo de Construccion?";
                    |CONFI aAlfa1;
                    |SI FSalida = 0;
                         |GRABA 101#labtraba.a;
                         |LIBERA #labtraba;
                         |CIERRA #labtraba;
                         nEmpr = #labtraba#0;
                         nTrab = #labtraba#1;
                         |SUB_EJECUTA "aomenlac;ALTA";
                         |ABRE #labtraba;
                         #labtraba#0 = nEmpr;
                         #labtraba#1 = nTrab;
                         |LEE 101#labtraba.=;
                    |FINSI;
               |FINSI;
               |CIERRA #500;
          |FINSI;
          |DESCARGA_DEF #copiadef@;
     |FINSI;
     |FCIERRA aFabre;
|FPRC;

|PROCESO Cons; |TIPO 3;
     ||HAZ Construccion;   || ANULADO Mon Jun 27 09:40:40 CEST 2005
     || anulado pero repasado el 10.04.2006
|FPRC;

|PROCESO BuscaAgilab;
     swAgilab = 1;
     aFabre = "";
     |DIRECTORIO aFabre;
     aFabre = "rt  " + aFabre + "aginom/bin/labconb1.tab";
     |FABRE aFabre;
     |SI FSalida ] 0;
          |FCIERRA FSalida;
          |CAMPO_MODIFICA #labtraba#6, 1, "N";
          |CAMPO_MODIFICA #labtraba#10, 1, "N";
     |SINO;
          aFabre = "";
          |DIRECTORIO aFabre;
          aFabre = "rt  " + aFabre + "agilab/bin/fuecatip.tab";
          |FABRE aFabre;
          |SI FSalida ] 0;         || estoy en Produccion
               |FCIERRA FSalida;
               |CAMPO_MODIFICA #labtraba#6, 1, "N";
               |CAMPO_MODIFICA #labtraba#10, 1, "N";
          |SINO;
               swAgilab = 0;
               |CAMPO_MODIFICA #labtraba#6, 1, "S";
               |CAMPO_MODIFICA #labtraba#10, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraCP;
     nTecla = FSalida;

     |HAZ BuscaAgilab;
     |SI swAgilab = 0;   |ACABA;   |FINSI;

     |ABRE #labmunic; |DDEFECTO #labmunic;

     aAlfa = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
     #labmunic#4 = aAlfa;
     |LEE 000#labmunic.];
     |SI FSalida = 0; |Y #labmunic#4 = aAlfa;
          |SALVA_FICHA #labmunic;
          |LEE 000#labmunic.s;
          |SI FSalida = 0; |Y #labmunic#4 = aAlfa;
               nSwUno = 0;
          |SINO;
               nSwUno = 1;
          |FINSI;
          |REPON_FICHA #labmunic;
          |SI nSwUno = 0;
               |SI nTecla = 11;
                    aCodPos = #labmunic#4;
                    |SUB_EJECUTA "labmunic.tab";
                    #labmunic#1 = aCodigoMunicipio;
                    #labmunic#4 = aCodPos;
                    |LEE 000#labmunic.=;
                    |SI FSalida ! 0; |DDEFECTO #labmunic; |FINSI;
                    #labtraba#6 = #labmunic#3; |PINTA #labtraba#6;
               |SINO;
                    aAlfa = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
                    #labmunic#4 = aAlfa;
                    |LEE 000#labmunic.];
                    |PARA; |SI FSalida = 0; |Y #labmunic#4 = aAlfa; |HACIENDO;
                         aAlfa1 = #labmunic#3; |QBF aAlfa1; aLong = aAlfa1 % 0; nCalc1 = aLong;
                         aAlfa2 = #labtraba#6; |QBF aAlfa2; aLong = aAlfa2 % 0; nCalc2 = aLong;
                         |SI nCalc1 ] nCalc2;
                              nCalc = 100 + nCalc2; aAlfa = aAlfa % nCalc;
                         |SINO;
                              nCalc = 100 + nCalc1; aAlfa1 = aAlfa1 % nCalc;
                         |FINSI;
                         |SI aAlfa1 = aAlfa2; |SAL; |FINSI;
                         |LEE 000#labmunic.s;
                    |SIGUE;
                    |SI aAlfa1 ! aAlfa2;
                         aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
                         |SUB_EJECUTA "labmunic.tab";
                         #labmunic#1 = aCodigoMunicipio;
                         #labmunic#4 = aCodPos;
                         |LEE 000#labmunic.=;
                         |SI FSalida ! 0; |DDEFECTO #labmunic; |FINSI;
                         #labtraba#6 = #labmunic#3; |PINTA #labtraba#6;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSwUno = 1;
               #labtraba#6 = #labmunic#3; |PINTA #labtraba#6;
          |FINSI;
     |SINO;
          |MENAV "    No se encuentra el codigo postal en la tabla de municipios"; |ERROR;
     |FINSI;
     |CIERRAT #tdpmunic; |CIERRA #labmunic;
|FPRC;

|PROCESO ActCP;
   |HAZ BuscaAgilab;
   |SI swAgilab = 0;   |ACABA;   |FINSI;

   |ABRE #tdpmunic; |ABRE #labmunic;
   |SELECT #2#tdpmunic; |SELECT #3#labmunic;
   #tdpmunic#1 = #labtraba#6;
   |LEE 000#tdpmunic.=;
   |SI FSalida = 0;
      aAlfa = #tdpmunic#0; |QBF aAlfa;
      #labmunic#1 = #tdpmunic#0;
      |LEE 000#labmunic.];
      |PARA; |SI FSalida = 0; |Y #labmunic#1 = aAlfa; |HACIENDO;
         aAlfa1 = #labmunic#3; |QBF aAlfa1; aLong = aAlfa1 % 0; nCalc1 = aLong;
         aAlfa2 = #labtraba#6; |QBF aAlfa2; aLong = aAlfa2 % 0; nCalc2 = aLong;
         |SI nCalc1 ] nCalc2;
            nCalc = 100 + nCalc2; aAlfa1 = aAlfa1 % nCalc;
         |SINO;
            nCalc = 100 + nCalc1; aAlfa2 = aAlfa2 % nCalc;
         |FINSI;
         |SI aAlfa1 = aAlfa2; |SAL; |FINSI;
         |LEE 000#labmunic.s;
      |SIGUE;
      |SI aAlfa1 = aAlfa2;
         aAlfa = #labmunic#4;
         aAlfa1 = aAlfa % 0102; #labtraba#8 = aAlfa1; |PINTA #labtraba#8;
         aAlfa1 = aAlfa % 0303; #labtraba#9 = aAlfa1; |PINTA #labtraba#9;
      |FINSI;
   |FINSI;
   |CIERRA #tdpmunic; |CIERRA #labmunic;
|FPRC;

|PROCESO RestauraL;
     |POPV;
     |ATRI 0;
|FPRC;

|PROCESO AyudaTipoL; |TIPO 7;
     |PUSHV 12261880;
     |ATRI R;
     |PINTA 1230, " Tipo de Relacion Laboral:         ";
     |PINTA 1330, " 1. General                                        ";
     |PINTA 1430, " 2. Duracion inferior a un a¤o                     ";
     |PINTA 1530, " 3. Relaciones laborales especiales de caracter de-"
     |PINTA 1630, "    pendiente (salvo penados y discapacitados)     ";
     |PINTA 1730, " 4. Esporadica propia de retribuciones por peonadas";
     |PINTA 1830, "    o jornales diarios                             ";
     |ATRI 0;
|FPRC;

|| BORRADO BONIFICACIONES FOMENTO EMPLEO

|PROCESO BorraBonFomEmp;
     |BORRA 020#nombotra.a;
     |LIBERA #nombotra;
|FPRC;

|DEFBUCLE BorraBonFomEmp;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     be;
     NULL, BorraBonFomEmp;
|FIN;

|PROCESO BuscaBonFomEmp;
     swExiste = 1;
|FPRC;

|DEFBUCLE BuscaBonFomEmp;
     #nombotra#1;
     ;
     #labtraba#0, #labtraba#1, 001;
     #labtraba#0, #labtraba#1, 999;
     ;
     NULL, BuscaBonFomEmp;
|FIN;

|PROCESO BoniFomComp;
     |SI Contenido = "N"; |O Contenido = " ";
          |SI #0Campo = "S"; |O #0Campo = "T";
               FSalida = 13;
               |HAZ BoniFom;
          |FINSI;
     |FINSI;
     |SI Contenido = "S"; |O Contenido = "T";
          |SI #0Campo = "N";
               |POPV;
               |BUCLE BorraBonFomEmp;
          |FINSI;
     |FINSI;
     |SI Contenido = "S"; |O Contenido = "T";
          |SI #0Campo = "S"; |O #0Campo = "T";
               |SI FSalida = 13;
                    |HAZ BoniFom;
               |FINSI;
               |POPV;
          |FINSI;
     |FINSI;
     |SI Contenido = "S"; |Y #0Campo = "T";
          FSalida = 13;
          |HAZ BoniFom;
     |FINSI;
     |SI Contenido = "T"; |Y #0Campo = "S";
          FSalida = 13;
          |HAZ BoniFom;
     |FINSI;
     |SI #0#121 = "S"; |O #0#121 = "T";
          swExiste = 0;
          |BUCLE BuscaBonFomEmp;
          |SI swExiste = 0;
               #0#121 = "N";
               |PINTA #0#121;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BoniFomPinta; |TIPO 7;
     |SI #0#121 ! "S"; |Y #0#121 ! "N"; |Y #0#121 ! "T";
          #0#121 = "N";
          |PINTA #0#121;
     |FINSI;
     |SI #0#121 = "S"; |O #0#121 = "T";
          |PUSHV 17322380;
          |ENTLINEAL #1#nombotra, 3, 7, 20, 1, min_bon, max_bon;

          |ABRE #nombotra;
          |DDEFECTO #nombotra;
          #nombotra#0 = #0#0;
          #nombotra#1 = #0#1;
          #nombotra#2 = 101;
          |LEE 000#nombotra.];
          |SI FSalida = 0; |Y #nombotra#0 = #0#0; |Y #nombotra#1 = #0#1;
               |PINTA #nombotra#4;
               |PINTA #nombotra#5;
               |PINTA #nombotra#6;
               |PINTA #nombotra#7;
          |FINSI;

          |CIERRA #nombotra;
     |FINSI;
|FPRC;

|PROCESO max_bon;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     #nombotra#2 = 999;
|FPRC;

|PROCESO min_bon;
     #nombotra#0 = #labtraba#0;
     #nombotra#1 = #labtraba#1;
     #nombotra#2 = 101;
|FPRC;

|PROCESO BoniFom;
     |PUSHV 17322380;

          |ENTLINEAL #1#nombotra, 3, -1, 20, 1, min_bon, max_bon;

     || esto esta por retocar
     |SI #nombotra#2 ] 101; |Y #nombotra#2 [ 299; |Y #0#121 ! "S";
          #0#121 = "S";
          |PINTA #0#121;
     |FINSI;
     |SI #nombotra#2 ] 301; |Y #0#121 ! "T";
          #0#121 = "T";
          |PINTA #0#121;
     |FINSI;

     |LIBERA #nombotra;
     |CIERRA #nombotra;
     |POPV;

     |SI #0#121 = "S"; |O #0#121 = "T";
          swExiste = 0;
          |BUCLE BuscaBonFomEmp;
          |SI swExiste = 0;
               #0#121 = "N";
               |PINTA #0#121;
          |FINSI;
     |FINSI;

     |SI #0#121 = "N";
          swExiste = 0;
          |BUCLE BuscaBonFomEmp;
          |SI swExiste = 1;
               #0#121 = "N";
               |BUCLE BorraBonFomEmp;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Ayuda122; |TIPO 7;
     |SI #labtraba#122 ! " "; |Y #labtraba#122 ! "1"; |Y #labtraba#122 ! "2";
     |Y #labtraba#122 ! "3";
          #labtraba#122 = " ";
          |PINTA #labtraba#122;
     |FINSI;
     |PUSHV 18402079;
     |ATRI R;
     ||            4         5         6         9
     ||            0123456789012345678901234567890123456789
     |PINTA 1840, " 1. Personal de alta direccion          ";
     |PINTA 1940, " 2. Deportistas profesionales           ";
     |PINTA 2040, " 3. Abogados en despacho de abogados    ";
|FPRC;

|PROCESO Ayuda212; |TIPO 7;
     |SI #0#212 ! 1; |Y #0#212 ! 2; |Y #0#212 ! 3; |Y #0#212 ! 4;
     |Y #0#212 ! 5; |Y #0#212 ! 6; |Y #0#212 ! 9;
     |Y #0#212 ! 13; |Y #0#212 ! 14; |Y #0#212 ! 15; |Y #0#212 ! 16;
     |Y #0#212 ! 11;
          #0#212 = 1;
          |PINTA #0#212;
     |FINSI;
     |PUSHV 08052352;
     ||            3       4         5         6         7         8
     ||            2345678901234567890123456789012345678901234567890
     |ATRI R;
     |PINTA 0805,  "  - Sin colectivo incentivado -  ³";
     |ATRI 0;
     |PINTA 0905,  "01. Fecha de antigüedad          ³";
     |PINTA 1005,  "02. Fecha de alta                ³";
     |ATRI R;
     |PINTA 1105,  "   - Colectivos incentivados -   ³";
     |ATRI 0;
     |PINTA 1205,  "03. Fecha de antigüedad (textil).³";
     |PINTA 1305,  "04. Fecha de alta (textil).      ³";
     |PINTA 1405,  "05. Fecha de antigüedad (calzado)³";
     |PINTA 1505,  "06. Fecha de alta (calzado).     ³";
     |PINTA 1605,  "13. Fecha de antigüedad (juguete)³";
     |PINTA 1705,  "14. Fecha de alta (juguete).     ³";
     |PINTA 1805,  "15. Fecha de antigüedad (mueble).³";
     |PINTA 1905,  "16. Fecha de alta (mueble).      ³";
     |PINTA 2005,  "---------------------------------³";
     |PINTA 2105,  "09. NO aplicar esta bonificación ³";
     |PINTA 2205,  "                                 ³";
     |PINTA 2305,  "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
     |ATRI R;
     |PINTA 0905, "01.";
     |PINTA 1005, "02.";
     |PINTA 1205, "03.";
     |PINTA 1305, "04.";
     |PINTA 1405, "05.";
     |PINTA 1505, "06.";
     |PINTA 1605, "13.";
     |PINTA 1705, "14.";
     |PINTA 1805, "15.";
     |PINTA 1905, "16.";
     |PINTA 2105, "09.";
     |ATRI 0;
|FPRC;

|PROCESO Ocup;
     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     |SI aAlfa1 = "";
          aAlfa1 = "Se asumen tipos de cotizacion de la actividad de la empresa";
          #0#205 = aAlfa1;
          |PINTA #0#205;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI aAlfa1 = "e"; |Y nModo = 1;
          aAlfa = "    ATENCION. La ocupación 'e' no está en vigor a partir de 2013.";
          aAlfa = aAlfa + " El trabaja- dor cotizará según el CNAE empresa."
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Iniciando;
     || al iniciar el 144, inicio tambien el 132 y el 189 (tema COVID-19)
     #labtraba#144 = 1;
     |SI #labtraba#219 = 75;
          #labtraba#144 = "2";
     |FINSI;
     #labtraba#132 = "";
     #labtraba#189 = "";

     |GRABA 020#labtraba.a;
     |LIBERA #labtraba;
|FPRC;

|DEFBUCLE Iniciando;
     #labtraba#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, Iniciando;
|FIN;

|PROCESO labclean;
     |MODULO aAlfa;
     |QBF aAlfa;
     |SI aAlfa ! "labtraba";
          |ACABA;
     |FINSI;

     |PINTA 1327, "ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿"
     |PINTA 1427, "³   Inicializando nuevos campos.   ³";
     |PINTA 1527, "³ Por favor, espere unos segundos. ³";
     |PINTA 1627, "³                                  ³"
     |PINTA 1727, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ"

     |ABRE #labclean;

     #labclean#0 = "labtraba";
     #labclean#1 = 144;
     |LEE 101#labclean.=;
     FEstado = FSalida;
     |SI FEstado ! 0;
          |BUCLE Iniciando;

          #labclean#0 = "labtraba";
          #labclean#1 = 144;
          #labclean#2 = "S";
          |SI FEstado = 0;
               |GRABA 020#labclean.a;
          |SINO;
               |GRABA 020#labclean.n;
          |FINSI;
          |LIBERA #labclean;
     |FINSI;

     |CIERRA #labclean;

     |PINTA 1327, "                                    ";
     |PINTA 1427, "                                    ";
     |PINTA 1527, "                                    ";
     |PINTA 1627, "                                    ";
     |PINTA 1727, "                                    ";
|FPRC;

|PROCESO ActualizaBonif;
     |SUB_EJECUTA "nomboact";
|FPRC;

|PROCESO Tipo88tra; |TIPO 88;
     |CAMPO_ANCHO #nomconca#1, 1, 23;
     |HAZ ITIMStra;
     |HAZ labclean;
     |HAZ ActualizaBonif;
|FPRC;

|PROCESO ITIMStra;
     |MODULO aAlfa;
     |QBF aAlfa;
     |SI aAlfa ! "labtraba";
          |ACABA;
     |FINSI;

     fFecha = ~;
     aAlfa = fFecha; aAlfa = aAlfa % -104;
     nElAny = aAlfa;
     aAlfa = fFecha; aAlfa = aAlfa % 402;
     nElMes = aAlfa;
     |HAZ ValoresITIMS;
|FPRC;

|PROCESO CodigoPro; |TIPO 7;
     |ABRE #labvaltb;
     #labvaltb#0 = "labtraba";
     #labvaltb#1 = 19;
     #labvaltb#5 = #0#0;
     #labvaltb#6 = #0#1;
     |LEE 000#labvaltb.=;
     |SI FSalida = 0;
          aAlfa = #labvaltb#4;
          |ABRE #taiclaoc;
          |SELECT #2#taiclaoc;
          #taiclaoc#1 = aAlfa;
          |LEE 000#taiclaoc.=;
          |SI FSalida = 0;
               #0#185 = #taiclaoc#0;
               |PINTA #0#185;
          |FINSI;
          |CIERRA #taiclaoc;
     |FINSI;
     |CIERRA #labvaltb;
|FPRC;

|PROCESO CompProf;   || para borrar del labvaltb si la profesion esta en
     aAlfa = #0#19; || blanco, de momento no lo activo
     |QBF aAlfa;
     |SI aAlfa = "";
          |ABRE #labvaltb;
          #labvaltb#0 = "labtraba";
          #labvaltb#1 = 19;
          #labvaltb#5 = #0#0;
          #labvaltb#6 = #0#1;
          |LEE 000#labvaltb.=;
          |SI FSalida = 0;
               |BORRA 020#labvaltb.a;
          |FINSI;
          |CIERRA #labvaltb;
     |FINSI;
|FPRC;

|PROCESO Activa218; |TIPO 7;
     |SI #0#188 = "S";
          |CAMPO_MODIFICA #0#218, 1, "S";
     |SINO;
          #0#218 = 0;
          |PINTA #0#218;
          |CAMPO_MODIFICA #0#218, 1, "N";
     |FINSI;
|FPRC;

|PROCESO TrabAlta;
     |SI #0#219 = 100; |O #0#219 = 0;
          #0#144 = 1;
     |SINO;
          #0#144 = 2;
     |FINSI;
     |PINTA #0#144;
|FPRC;

|PROCESO Limite; |TIPO 14;
     |ABRE #nombonif;
     #nombonif#0 = #0#39
     |LEE 000#nombonif.=;
     |SI FSalida = 0; |Y #nombonif#26 = "S";
          |CAMPO_VISUAL #0#217, 1, "S";
          |CAMPO_MODIFICA #0#217, 1, "S";
          |PINTA #0#217;
          |ATRI I;
     |SINO;
          |ATRI I;
          #0#217 = 0;
          |CAMPO_VISUAL #0#217, 1, "N";
          |CAMPO_MODIFICA #0#217, 1, "N";
          |PINTA 1324, "        ³";
     |FINSI;
     |CIERRA #nombonif;
|FPRC;

|PROCESO EnP14; |TIPO 14;
     |CAMPO_VISUAL #0#190, 1, "N";
     |CAMPO_MODIFICA #0#190, 1, "N";
     |CAMPO_VISUAL #0#191, 1, "N";
     |CAMPO_MODIFICA #0#191, 1, "N";
     |PINTA 1057, "   ³";
     |ATRI I;

     |ATRI 0;
     |PINTA 1057, "   ³";
     |ATRI I;

     nModo = (FEntrada / 100) ! 0;

     |SI #0#45 = "085"; |O #0#45 = "421"; |O #0#45 = "422";
          |ATRI I;

          |CAMPO_VISUAL #0#191, 1, "S";
          |CAMPO_MODIFICA #0#191, 1, "S";
          |PINTA #0#191;

          |SI #0#45 ! "422";
               |CAMPO_POSICION #0#190, 1, 1057;
               |CAMPO_VISUAL #0#190, 1, "S";

               fFechaFor = "18.06.2010";
               fFechaAlta = #0#36;

               |SI fFechaAlta ] fFechaFor;
                    |CAMPO_MODIFICA #0#190, 1, "S";
                    |SI nModo = 1;      || solo en modo alta
                         #0#190 = "S";
                    |FINSI;
               |SINO;
                    |CAMPO_MODIFICA #0#190, 1, "S";
               |FINSI;
               |PINTA #0#190;
          |SINO;
               #0#190 = "N";
               |CAMPO_VISUAL #0#190, 1, "N";
               |CAMPO_MODIFICA #0#190, 1, "N";
          |FINSI;
     |FINSI;
     |ATRI I;
|FPRC;

|PROCESO ForDesBon;
     |SI #0#45 ! "421"; |Y #0#45 ! "085";
          |ACABA;
     |FINSI;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O #0Campo ! Contenido;
          fFechaFor = "18.06.2010";
          fFechaAlta = #0#36;
          |SI fFechaAlta ] fFechaFor;
               #0#190 = "S";
               |PINTA #0#190;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CompDesForm;
     |SI #0#45 ! "421"; |Y #0#45 ! "085";
          |ACABA;
     |FINSI;
     nTecla = FSalida;
     fFechaFor = "18.06.2010";
     fFechaAnt = #0#34;
     fFechaAlta = #0#36;
     |SI #0#190 = "S"; |Y fFechaAlta < fFechaFor; |Y fFechaAnt < fFechaFor;
          aAlfa = "    ATENCION. La fecha de antigüedad y la de alta ";
          aAlfa = aAlfa + "son anteriores al inicio de la cotización por desempleo.";
          |MENAV aAlfa;

          aAlfa = "    Verifique que realmente el contrato de formación introducido ";
          aAlfa = aAlfa + "ha de cotizar por desempleo.";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO MediaForm;
     |SI #0#45 ! "421"; |Y #0#45 ! "085";
          |ACABA;
     |FINSI;
     swSigue = 0;
     |SI enParada = 1;
          swSigue = 1;
     |SINO;
          |SI nAltaFechaRef > 0; |O nMedia90 > 0;
               swSigue = 0;
          |SINO;
               swSigue = 1;
          |FINSI;
     |FINSI;
     |SI swSigue = 0;
          |ACABA;
     |FINSI;

     nNume = #0#0;
     aAlfa = nNume; |QBF aAlfa; aAlfa = ("00000" + aAlfa) % -105;
     aAlfa1 = aAlfa;

     aAlfa = #0#36;
     aAlfa1 = aAlfa1 + aAlfa;
     aAlfa1 = "nomcalme;" + aAlfa1;

     enEmp = #0#0;
     enTra = #0#1;
     enNom = #0#2;
     eaNIF = #0#7;
     eaAlta = #0#36;
     eaBaja = #0#37;
     eaContrato = #0#45;
     enOpcion = 2;
     |SUB_EJECUTA aAlfa1;
|FPRC;

|PROCESO CompBonForm;
     |ACABA;
     |SI #0#45 ! "421"; |Y #0#45 ! "085";
          |ACABA;
     |FINSI;
     |SI #0#191 = "N"; |ACABA; |FINSI; || solo valido si estan bonificados

     |SI #0#190 = "N";
          |SI #0#191 = "S"; |O #0#191 = "T";
               aAlfa = "    ATENCION: No es posible tener esta bonificación sin ";
               aAlfa = aAlfa + "cotizar al desempleo según el Boletín 2010/09 del S. RED.";
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |SINO;
          |ACABA;

          || a partir de 2012 ya no dice nada en ningun sitio de que haya
          || que comprobar que el numero de trabajadores sea superior a
          || la media de los ultimos 90 dias, no lo hacemos

          enParada = 0;
          |HAZ MediaForm;

          |SI nAltaFechaRef > nMedia90;

          |SINO;
               |AVISO;
               aAlfa1 = nAltaFechaRef;
               aAlfa1 = ("    " + aAlfa1) % -104;
               nMedia90 = nMedia90 ! 2;
               aAlfa2 = nMedia90;
               aAlfa2 = ("       " + aAlfa2) % -107;

               |PUSHV 13332279;
              ||        3      4         5         6         7
              ||        34567890123456789012345678901234567890123456789
               |ATRI R;
               aAlfa = "ATENCION: el número de trabajadores en alta in-";
               |PINTA 1333, aAlfa;
               aAlfa = "cluyendo este  contrato es de " + aAlfa1 + ". La media de";
               |PINTA 1433, aAlfa;
               aAlfa = "los últimos 90 días es de " + aAlfa2 + " por lo que la";
               |PINTA 1533, aAlfa;
               aAlfa = "bonificación no  se debería  aplicar. Pulse F10";
               |PINTA 1633, aAlfa;
               aAlfa = "si desea consultar  los cálculos  realizados  y"
               |PINTA 1733, aAlfa;
               aAlfa = "confirme si desea aplicarla.                   ";
               |PINTA 1833, aAlfa;
               |ATRI 0;
               |PAUSA;
               |HAZ CalcMedia;
               |POPV;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalcMedia;
     nTecla = FSalida;
     |SI FSalida = 18;
          enParada = 1;
          |HAZ MediaForm;
     |FINSI;
|FPRC;

|PROCESO PorcBonDes;
     |SI #0#188 = "S"; |O #0#188 = "1"; |O #0#188 = "2"; |O #0#188 = "A";
          |SI #0#219 = 0; |O #0#219 = 50; |O #0#219 = 80;
               #0#219 = 100;
          |FINSI;
          |CAMPO_MODIFICA #0#219, 1, "S";
          |CAMPO_MODIFICA #0#144, 1, "S";
          |CAMPO_MODIFICA #0#132, 1, "S";
          |CAMPO_MODIFICA #0#189, 1, "S";
     |SINO;
          #0#219 = 0; |PINTA #0#219; |CAMPO_MODIFICA #0#219, 1, "N";
          #0#144 = "1"; |PINTA #0#144; |CAMPO_MODIFICA #0#144, 1, "N";
          #0#132 = ""; |PINTA #0#132; |CAMPO_MODIFICA #0#132, 1, "N";
          #0#189 = ""; |PINTA #0#189; |CAMPO_MODIFICA #0#189, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Ayuda129; |TIPO 7;
     |PUSHV 09281680;
                || 23        4         5         6         7
                || 91234567890123456789012345678901234567890123456789
     |ATRI R;
     |PINTA 0929, " Elija una opci¢n si procede:                     ";
     |PINTA 1029, " (G) Guarda Legal.                                ";
     |PINTA 1129, " (T) Maternidad/Paternidad a TP, parte en IT.     ";
     |PINTA 1229, " (R) Maternidad/Paternidad a TP, parte en alta.   ";
     |PINTA 1329, " (E) ERE a tiempo parcial, parte en ERE.          ";
     |PINTA 1429, " (A) ERE a tiempo parcial, parte en alta.         ";
     |PINTA 1529, "                                                  ";
|FPRC;

|PROCESO SSOnline;
     |SI nOpcion = 0;
          |ACABA;
     |FINSI;

     aAlfa1 = #0#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#1; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;
     aAlfa = aAlfa1 + aAlfa2;
     |SI nOpcion = 1;
          aAlfa = "labnct07;"+ "01" + aAlfa;
     |FINSI;
     |SI nOpcion = 2;
          aAlfa = "labnct07;"+ "02" + aAlfa;
     |FINSI;
     |SI nOpcion = 3;
          aAlfa = "labnct07;"+ "03" + aAlfa;
     |FINSI;
     |SI nOpcion = 4;
          aAlfa = "labnct07;"+ "04" + aAlfa;
     |FINSI;
     |SI nOpcion = 5;
          aAlfa = "labnct07;"+ "05" + aAlfa;
     |FINSI;
     |SI nOpcion = 6;
          aAlfa = "labnct07;"+ "07" + aAlfa;
     |FINSI;
     |SI nOpcion = 7;
          aAlfa = "labnct07;"+ "08" + aAlfa;
     |FINSI;
     |SI nOpcion = 8;
          aAlfa = "labnct07;"+ "25" + aAlfa;
     |FINSI;

     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO MenuRED;
     eaVengoDe = "labtraba";
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 8;
     aPopup3 = "1. Enviar alta del trabajador";
     aPopup4 = "2. Enviar baja del trabajador";
     aPopup5 = "3. Cambio de grupo de tarifa";
     aPopup6 = "4. Cambio de contrato";
     aPopup7 = "5. Consulta de situación del afiliado";
     aPopup8 = "6. Consulta del número de afiliación";
     aPopup9 = "7. Duplicado de documentos TA";
     aPopup10 = "8. Consulta de Vida Laboral del Trabajador";
     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nOpcion = FSalida;
     |SALVA_DATOS #labtraba;
     |HAZ SSOnline;
     |REPON_DATOS #labtraba;
|FPRC;

|PROCESO BotonRED; |TIPO 8;
     |MODULO aAlfa;
     |QBF aAlfa;
     |SI aAlfa ! "labtraba";
          |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,Seguridad Social Online", 0860, 0877, ConectaSS;
     enBoton = FSalida;
     |ESTADO_CONTROL enBoton, "ENABLE";
     swBotonSiNo = 1;
|FPRC;

|PROCESO FinBotonRED; |TIPO 9;
     |MODULO aAlfa;
     |QBF aAlfa;
     |SI aAlfa ! "labtraba";
          |ACABA;
     |FINSI;

     |FIN_CONTROL_WINDOWS enBoton;
     |PULSATECLA;
     swBotonSiNo = 0;
|FPRC;

|PROCESO PonBotonRED; |TIPO 14;
     |MODULO aAlfa;
     |QBF aAlfa;
     |SI aAlfa ! "labtraba";
          |ACABA;
     |FINSI;

     |SI swBotonSiNo = 0;
          |HAZ BotonRED;
     |FINSI;
|FPRC;

|PROCESO QuitaBoton; |TIPO 14;
     |SI swBotonSiNo = 1;
          |HAZ FinBotonRED;
     |FINSI;
|FPRC;

|PROCESO Aviso131;
     |SI #0#131 = "S"; |Y #0#111 ! 1;
          aAlfa = "    ATENCION: Para una transformación en indefinido es ";
          aAlfa = aAlfa + "obligatoria la relación laboral tipo 1";
          |MENAV aAlfa;
          aAlfa = "    Se ha cambiado la relación laboral a tipo 1. Revise ";
          aAlfa = aAlfa + "sus datos si es necesario.";
          |MENAV aAlfa;
          #0#111 = 1;
          |PINTA #0#111;
     |FINSI;
|FPRC;

|PROCESO Relacion2; |TIPO 14;
     |SI #0#111 = 2;
          |CAMPO_MODIFICA #0#130, 1, "S";
          |CAMPO_VISUAL #0#130, 1, "S";
          |PINTA #0#130;
     |SINO;
          |CAMPO_MODIFICA #0#130, 1, "N";
          |CAMPO_VISUAL #0#130, 1, "N";
          |ATRI 0;
          |PINTA 2074, "   ";
     |FINSI;
|FPRC;

|PROCESO DefectoRel;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |SI #0Campo ! Contenido;
               nNume = #0#45;
               |SI nNume < 399;
                    #0#111 = 1;
               |SINO;
                    #0#111 = 2;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO no72; |TIPO 0;
     |PINTA 2416, "                                                     ";

     |SI #0#70 ! "T"; |ACABA; |FINSI;
|FPRC;

|PROCESO AyudaDatosBanco; |TIPO 7;
     |SI #0#70 = "T";
          |ATRI R;
          |PINTA 2416, " - Pulse ENTER para introducir los datos bancarios - ";
          |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO EntraNOMW0021;
     |PUSHV 0501 2380;

     #nomw0021#0 = #labtraba#72 % 104;
     #nomw0021#1 = #labtraba#72 % 504;
     #nomw0021#2 = #labtraba#72 % 1110;
     #nomw0021#3 = #labtraba#72 % 902;
     |SI #labtraba#153 = " S "; #labtraba#153 = "ES"; |FINSI;
     #nomw0021#4 = #labtraba#153;
     #nomw0021#5 = #labtraba#154;
     #nomw0021#6 = #labtraba#155;

     |PINPA #0#nomw0021;
     |PINDA #0#nomw0021;

     |ENDATOS #1#nomw0021;
     |SI FSalida = 0;
         #labtraba#72  = #nomw0021#0 + #nomw0021#1 + #nomw0021#3 + #nomw0021#2;
         #labtraba#153 = #nomw0021#4;
         #labtraba#154 = #nomw0021#5;
         #labtraba#155 = #nomw0021#6;
         |PINTA #labtraba#72;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO Tipo7C72;  |TIPO 7;
     nTecla = FSalida;

     |C_M #labtraba#71,  1, "N";

     |SI #labtraba#70 ! "T";  |ACABA;  |FINSI;

     |C_M #labtraba#71,  1, "S";

     |SI nTecla ! 0;  |ACABA;  |FINSI;

     |HAZ EntraNOMW0021;
|FPRC;

|PROCESO Mensa191; |TIPO 7;
     |SI #0#45 ! "422";
          |MENSA "    (S) Bonif. 100% (T) Bonif. 75% (N) No bonif; <F10> Media; <F6> HORAS";
     |SINO;
          |MENSA "    (S) Bonificado 100% -RDL 8/2014- (N) No bonificado; <F6> HORAS ";
     |FINSI;
|FPRC;

|PROCESO HorasForm;
     |SI nTecla = 14; |Y #0#45 = 421;
          |SALVA_DATOS #labtraba;

          |PUSHV 05012380;

          |ABRE #nomhorf1;
          #nomhorf1#0 = #0#0;
          #nomhorf1#1 = #0#1;

          |CLS;
          |PINPA #0#nomhorf1;
          |PINDA #0#nomhorf1;

          |LEE 000#nomhorf1.=;
          |SI FSalida = 0;
               |ENDATOS #2#nomhorf1;
          |SINO;
               |ENDATOS #1#nomhorf1;
          |FINSI;
          |CIERRA #nomhorf1;

          |POPV;

          |REPON_DATOS #labtraba;
     |FINSI;
|FPRC;

|PROCESO Activa138; |TIPO 14;
     |SI #0#241 = "N";
          |ATRI 0;
          |PINTA 1873, " Car:  ³";
          |ATRI I;
          |CAMPO_VISUAL #0#138, 1, "S";
          |CAMPO_MODIFICA #0#138, 1, "S";
          |ATRI I;
          |PINTA #0#138;
          |ATRI I;
     |SINO;
          |ATRI 0;
          |PINTA 1873, "       ³";
          |ATRI I;
          |CAMPO_VISUAL #0#138, 1, "N";
          |CAMPO_MODIFICA #0#138, 1, "N";
     |FINSI;
|FPRC;

|PROCESO CalculaEdad;
     sistema = ~;
     fechtra = #0#11;
     anynac1 = fechtra % -104;    || desglosa fecha nacimiento en a¤os
     anynac2 = anynac1;
     mesnac1 = fechtra %  402;    || meses
     mesnac2 = mesnac1;
     dianac1 = fechtra %  102;    || y dias
     dianac2 = dianac1;
     fechtra = sistema;
     anyact1 = fechtra % -104;    || desglosa fecha actual en a¤os
     anyact2 = anyact1;
     mesact1 = fechtra %  402;    || meses
     mesact2 = mesact1;
     diaact1 = fechtra %  102;    || y dias
     diaact2 = diaact1;
     edadxxx = anyact2 - anynac2; || halla los a¤os
     |SI mesnac2 > mesact2;
          edadxxx = edadxxx - 1;   || resta un a¤o si aun no ha llegado el mes
     |FINSI;
     |SI mesnac2 = mesact2; |Y dianac2 > diaact2; ||o si aun no ha llegado el dia
          edadxxx = edadxxx - 1;
     |FINSI;
|FPRC;

|PROCESO CompEdad;
     |SI #0#135 = "S";
          edadxxx = -1;
          |HAZ CalculaEdad;
          |SI edadxxx < 60;
               aAlfa = "    ATENCION: El trabajador es menor de 60 años. Confirme ";
               aAlfa = aAlfa + "que desea activar la Jubilación Parcial.";
               |MENAV aAlfa;
          |FINSI;
          |CAMPO_MODIFICA #0#220, 1, "S";
     |SINO;
          #0#220 = 0;
          |PINTA #0#220;
          |CAMPO_MODIFICA #0#220, 1, "N";
     |FINSI;
|FPRC;

|PROCESO CompEmail;
     eaEmail = #0Campo;
     |HAZ CompEmail_plb;
|FPRC;
