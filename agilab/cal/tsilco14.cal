|FICHEROS;
     tsilco14 #0;             || parrilla empresas
     tsilco15,MANTE;          || parrilla trabajadores
     tsilco16,MANTE;          || parrilla centros

     labempre;
     labtraba;
     labcentr;
     nomcenes;

     nomcalca;
     nomhicca;
     nomcalac;

     cretap01;
     cretap02;
     cretap11;
     cretam02;
     cretam03;

     nomcreaf;
     gomdetjr;
|FIN;

|VARIABLES;
     alfa1 = "";
     alfa2 = "";
     alfa3 = "";
     alfa4 = "";
     nume1 = 0;
     nume2 = 0;
     nume3 = 0;
     nume4 = 0;
     para1 = 0;
     para2 = 0;
     para3 = 0;
     para4 = 0;
     fech1 = @;
     fech2 = @;
     fech3 = @;
     fech4 = @;
     elsw1 = 0;
     elsw2 = 0;
     elsw3 = 0;
     elsw4 = 0;
     FEstado = 0;
     seleccio = 0;
     modo = 0;
     sw_rup = 0;

     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     swMarcaTodas = 0;
     aMarca = "";
     nMarcarT = 0;

     nEmp = 0;
     nTra = 0;
     eaFuente = "";
     nDesdeTra = 0;
     nHastaTra = 0;
     nAny = 0;
     nAnyXX = 0;
     nDesdeMes = 0;
     nHastaMes = 0;
     nTipo = 0;
     nMes = 0;
     swHayAlguno = 0;
     aModulo = "";
     aCCC = "";
     aCentroNom = "";
     nNume = 0;
     &aParam = "";

     swFlecha = 0;
     &aTmp_tsilco16 = "";
|FIN;
____________________________________/
|PROCESO SelTraCen;
     |MODULO aModulo;
     |QBF aModulo;
     |SI #0#2 = "*";
          |SI aModulo = "cretap11";
               |CUADRO 08661379;
                          || 6  7
                          || 789012345678
               |ATRI R;
               |PINTA 0967, "< F6 >";
               |ATRI S;
               |PINTA 1067, "Seleccionar ";
               |PINTA 1167, "por CENTROS ";
               |ATRI 0;
          |SINO;
               |CUADRO 08661379;
                          || 6  7
                          || 789012345678
               |ATRI R;
               |PINTA 0967, "< F6 >";
               |ATRI S;
               |PINTA 1067, "Seleccionar ";
               |PINTA 1167, "Trabajadores";
               |ATRI 0;
          |FINSI;
     |SINO;
          |PINTA 0866, "              ";
          |PINTA 0966, "              ";
          |PINTA 1066, "              ";
          |PINTA 1166, "              ";
          |PINTA 1266, "              ";
          |PINTA 1366, "              ";
     |FINSI;
|FPRC;

|PROCESO tipo7_atr; |TIPO 7;
     |SI #0#5 ! 00; |Y #0#6 ! 00; |Y #0#7 ! 0000;
          |ATRI R;
          |PINTA 1867, "             "
          |PINTA 1967, "   Atrasos   "
          aAlfa1 = #0#5; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
          aAlfa2 = #0#6; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
          aAlfa3 = #0#7;
          aAlfa = " " + aAlfa1 + "-" + aAlfa2 + "  " + aAlfa3 + " ";
          |PINTA 2067, aAlfa;
          |PINTA 2167, "             "
          |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO tipo7_14; |TIPO 7;
     ||               1        2         3         4         5         6         7
     ||      123456789023456789012345678901234567890123456789012345678901234567890123456

     |MENSA "     < F5 > Seleccionar empresa  < F10 > Marcar todas las empresas     ";
     |HAZ SelTraCen;
|FPRC;

|PROCESO tipo11_14; |TIPO 11;
/*
     |SI FSalida = 3;
          swFlecha = 1;
     |FINSI;
*/
     swFlecha = 0;
     || de moemento no
     |HAZ Selecciona_14;
     swFlecha = 0;
|FPRC;

|PROCESO tipo0_14; |TIPO 0;
     nume1 = Contenido;
     |SI nume1 = #0Campo;
          |HAZ Selecciona_14;
     |FINSI;
|FPRC;

|PROCESO Selecciona5;
     |SI FSalida = 0;|O FSalida = 9;
          |SI #0#2 = "*";
               #0#2 = " ";
          |SINO;
               #0#2 = "*";
          |FINSI;
          |PINTA #0#2;
          |GRABA 020#0a;
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO cta_cotizacion14;
     aCCC = #labempre#13;          || cta.cot. de la empresa
     |SI #labtraba#45 = "085"; |O #labtraba#45 = "087"; |O #labtraba#45 = "097";
     |O #labtraba#45 = "421"; |O #labtraba#45 = "422";
          |DDEFECTO #nomcenes;
          |ABRE #nomcenes;
          #nomcenes#0 = #labtraba#0;
          #nomcenes#13 = #labtraba#77;
          #nomcenes#1 = 87;
          |LEE 000#nomcenes.=;
          |SI FSalida = 0;
               aCCC = #nomcenes#10;      || cta.cto. del centro de trabajo especial
               aCentroNom = #nomcenes#2;
          |FINSI;
          |CIERRA #nomcenes;
     |SINO;
          |DDEFECTO #labcentr;
          |ABRE #labcentr;
          #labcentr#0 = #labtraba#0;
          #labcentr#1 = #labtraba#77;
          |LEE 000#labcentr.=;
          |SI FSalida = 0;
               aCCC = #labcentr#10;      || cta.cot. centro de trabajo
               aCentroNom = #labcentr#2;
          |FINSI;
          |CIERRA #labcentr;
     |FINSI;
     |QBF aCCC;
     |SI aCCC ! "";
          aCCC = ("00000000000" + aCCC) % -111;
     |FINSI;
     aAlfa = #labtraba#247;
     |QBF aAlfa;
     aAlfa = ("0000" + aAlfa) % -104;
     |SI aCCC ! "";
          aCCC = aAlfa + aCCC;
     |FINSI;
|FPRC;

|PROCESO carga_lista_tra;
     |SI #labtraba#247 = 138; |O #labtraba#247 = 121;
     || regimen empleados hogar, rep. comercio
          |ACABA;
     |FINSI;
     |SI #labtraba#42 = "H";       || autonomos
          |ACABA;
     |FINSI;

     || excluyo contratos a partir del 600
     nNume = #labtraba#45;
     |SI nNume > 599;
          |ACABA;
     |FINSI;

     #tsilco15#0 = #labtraba#0;
     #tsilco15#1 = #labtraba#1;
     |LEE 101#tsilco15.=;
     |SI FSalida ! 0;
          #labempre#0 = #labtraba#0;
          |LEE 000#labempre.=;

          |DDEFECTO #tsilco15;
          #tsilco15#0 = #labtraba#0;       || codigo empresa
          #tsilco15#1 = #labtraba#1;       || codigo trabajador
          #tsilco15#2 = #labempre#2;       || nombre empresa
          #tsilco15#3 = #labtraba#2;       || nombre trabajador
          #tsilco15#4 = #labtraba#7;       || DNI
          #tsilco15#5 = #labtraba#75;      || Nro Afiliacion
          #tsilco15#6 = #labtraba#77;      || centro trabajo
          #tsilco15#7 = " ";               || marca
          |HAZ cta_cotizacion14;
          #tsilco15#8 = aCCC;              || ccc centro

          |GRABA 020#tsilco15.n;
          |LIBERA #tsilco15;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#5;
     ;
     "A", #tsilco14#0, 00001;
     "A", #tsilco14#0, 99999;
     ;
     NULL, carga_lista_tra;
|FIN;

|PROCESO CargaTrab_p3;
     |BUCLE labtraba;
|FPRC;

|PROCESO comp_1;
          nEmp = 0;
          nTra = 0;
          |SI eaFuente = "M";
               nEmp = #nomcalca#0;
               nTra = #nomcalca#1;
          |FINSI;
          |SI eaFuente = "H"; #|O eaFuente = "T";
               nEmp = #nomhicca#0;
               nTra = #nomhicca#1;
          |FINSI;
          |SI eaFuente = "A";
               nEmp = #nomcalac#0;
               nTra = #nomcalac#1;
               nNume = #nomcalac#39 + #nomcalac#40 + #nomcalac#62;
               |SI nNume = 0;
                    nEmp = 0;      || p.ej. trab en formacion que tienen las
                    nTra = 0;      || bases a CERO, no cotizan nada
               |FINSI;
          |FINSI;
          |SI nEmp ! 0; |Y nTra ! 0;
               #labtraba#0 = nEmp;
               #labtraba#1 = nTra;
               |LEE 000#labtraba.=;
               |SI FSalida = 0;
                    |SI aModulo = "cretap01";
                         |HAZ carga_lista_tra;
                    |FINSI;
                    |SI aModulo = "nomcreaf";
                         |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
                         |O #labtraba#42 = "I"; |O #labtraba#42 = "P";
                              |HAZ carga_lista_tra;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
|FPRC;

|DEFBUCLE comp_nomcalac;
     #nomcalac#1;
     ;
     nEmp, nDesdeTra, nDesdeMes, nTipo;
     nEmp, nHastaTra, nHastaMes, nTipo;
     ;
     NULL, comp_1;
|FIN;

|DEFBUCLE comp_nomhicca;
     #nomhicca#1;
     ;
     nEmp, nDesdeTra, nAnyXX, nDesdeMes, nTipo;
     nEmp, nHastaTra, nAnyXX, nHastaMes, nTipo;
     ;
     NULL, comp_1;
|FIN;

|DEFBUCLE comp_nomcalca;
     #nomcalca#1;
     ;
     nEmp, nDesdeTra, nDesdeMes, nTipo;
     nEmp, nHastaTra, nHastaMes, nTipo;
     ;
     NULL, comp_1;
|FIN;

|PROCESO CargaTrab_p1;
     nEmp = #tsilco14#0;

     |SI aModulo = "cretap01";
          nDesdeMes = #cretap01#1;
          |SI #cretap01#3 = "M"; |O #cretap01#3 = "H";
               nHastaMes = nDesdeMes;
          |SINO;
               nHastaMes = #cretap01#4;
          |FINSI;
          nAny = #cretap01#0;
          nAnyXX = #cretap01#0 - 2000;
          eaFuente = #cretap01#3;
          nTipo = #cretap01#5;
          |SI nTipo = 90;
               nTipo = 5;
          |FINSI;
     |FINSI;

    |SI aModulo = "nomcreaf";
          nDesdeMes = #nomcreaf#1;
          |SI #nomcreaf#3 = "M"; |O #nomcreaf#3 = "H";
               nHastaMes = nDesdeMes;
          |SINO;
               nHastaMes = #nomcreaf#4;
          |FINSI;
          nAny = #nomcreaf#0;
          nAnyXX = #nomcreaf#0 - 2000;
          eaFuente = #nomcreaf#3;
          nTipo = #nomcreaf#5;
     |FINSI;
     nDesdeTra = 00001;
     nHastaTra = 99999;

     |ABRE #labtraba;

     swHayAlguno = 0;
     |SI eaFuente = "M";
          |BUCLE comp_nomcalca;
     |FINSI;
     |SI eaFuente = "H";
          |BUCLE comp_nomhicca;
     |FINSI;
     |SI eaFuente = "A";
          |BUCLE comp_nomcalac;
     |FINSI;
     |SI eaFuente = "T";
          |BUCLE comp_nomhicca;
     |FINSI;

     |CIERRA #labtraba;
|FPRC;

|PROCESO comp_gomdetjr;
     #labempre#0 = #gomdetjr#0;
     |LEE 000#labempre.=;

     #labtraba#0 = #gomdetjr#0;
     #labtraba#1 = #gomdetjr#1;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
          |SI #labtraba#42 = "C"; |O #labtraba#42 = "F";
               #tsilco15#0 = #labtraba#0;
               #tsilco15#1 = #labtraba#1;
               |LEE 101#tsilco15.=;
               |SI FSalida ! 0;
                    |DDEFECTO #tsilco15;
                    #tsilco15#0 = #labtraba#0;       || codigo empresa
                    #tsilco15#1 = #labtraba#1;       || codigo trabajador
                    #tsilco15#2 = #labempre#2;       || nombre empresa
                    #tsilco15#3 = #labtraba#2;       || nombre trabajador
                    #tsilco15#4 = #labtraba#7;       || DNI
                    #tsilco15#5 = #labtraba#75;      || Nro Afiliacion
                    #tsilco15#6 = #labtraba#77;      || centro trabajo
                    #tsilco15#7 = " ";               || marca
                    |HAZ cta_cotizacion14;
                    #tsilco15#8 = aCCC;              || ccc centro

                    |GRABA 020#tsilco15.n;
                    |LIBERA #tsilco15;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE comp_gomdetjr;
     #gomdetjr#1;
     ;
     nEmp, nDesdeTra, nAny, nDesdeMes;
     nEmp, nHastaTra, nAny, nHastaMes;
     ;
     NULL, comp_gomdetjr;
|FIN;

|PROCESO CargaTrab_p4;
     nEmp = #tsilco14#0;

     nDesdeMes = #nomcreaf#1;
     nHastaMes = nDesdeMes;
     nAny = #nomcreaf#0;
     nAnyXX = #nomcreaf#0 - 2000;

     nDesdeTra = 00001;
     nHastaTra = 99999;

     |ABRE #labtraba;

     swHayAlguno = 0;
     |BUCLE comp_gomdetjr;

     |CIERRA #labtraba;
|FPRC;

|PROCESO CargaTrab_p2;
     #labempre#0 = #cretam03#0;
     |LEE 000#labempre.=;

     #labtraba#0 = #cretam03#0;
     #labtraba#1 = #cretam03#11;
     |LEE 000#labtraba.=;

     #tsilco15#0 = #cretam03#0;
     #tsilco15#1 = #cretam03#11;
     |LEE 101#tsilco15.=;
     |SI FSalida ! 0;
          |DDEFECTO #tsilco15;
          #tsilco15#0 = #labtraba#0;       || codigo empresa
          #tsilco15#1 = #labtraba#1;       || codigo trabajador
          #tsilco15#2 = #labempre#2;       || nombre empresa
          #tsilco15#3 = #labtraba#2;       || nombre trabajador
          #tsilco15#4 = #labtraba#7;       || DNI
          #tsilco15#5 = #labtraba#75;      || Nro Afiliacion
          #tsilco15#6 = #labtraba#77;      || centro trabajo
          #tsilco15#7 = " ";               || marca
          |HAZ cta_cotizacion14;
          #tsilco15#8 = aCCC;              || ccc centro

          |GRABA 020#tsilco15.n;
          |LIBERA #tsilco15;
     |FINSI;
|FPRC;

|DEFBUCLE CargaTrab_p2;
     #cretam03#1;
     ;
     #tsilco14#0, #cretap02#0, nDesdeMes, #cretap02#5, "           ", "            ";
     #tsilco14#0, #cretap02#0, nHastaMes, #cretap02#5, "zzzzzzzzzzz", "zzzzzzzzzzzz";
     ;
     NULL, CargaTrab_p2;
|FIN;

|PROCESO MarcaTodas;
     #tsilco14#2 = aMarca;
     |PINTA #tsilco14#2;
     |GRABA 020#tsilco14.a;
|FPRC;

|DEFBUCLE MarcaTodas;
     #tsilco14#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, MarcaTodas;
|FIN;

|PROCESO min15;
     #tsilco15#0 = #tsilco14#0;
     #tsilco15#1 = 00001;
|FPRC;

|PROCESO max15;
     #tsilco15#0 = #tsilco14#0;
     #tsilco15#1 = 99999;
|FPRC;

|PROCESO BorraSeleccion;
     #tsilco15#7 = " ";
     |GRABA 020#tsilco15.a;
     |LIBERA #tsilco15;
|FPRC;

|DEFBUCLE BorraSeleccion;
     #tsilco15#1;
     ;
     #tsilco14#0, 00001;
     #tsilco14#0, 99999;
     be;
     NULL, BorraSeleccion;
|FIN;

|PROCESO minCen14;
     #tsilco16#0 = #0#0;
     #tsilco16#1 = 000;
|FPRC;

|PROCESO maxCen14;
     #tsilco16#0 = #0#0;
     #tsilco16#1 = 999;
|FPRC;

|PROCESO cretam02_14;
     |SI nTipo ] 5;
          |SI #cretap11#7 ! #cretam02#1;
               || si el a¤o no corresponde
               |ACABA;
          |FINSI;
     |FINSI;

     #tsilco16#0 = #0#0;
     #tsilco16#1 = #cretam02#5;
     #tsilco16#2 = #cretam02#6;
     #tsilco16#3 = "*";
     #tsilco16#4 = #cretam02#4;
     |LEE 000#tsilco16.=;
     |SI FSalida ! 0;
          |GRABA 020#tsilco16.n;
     |SINO;
          |GRABA 020#tsilco16.a;
     |FINSI;
     |LIBERA #tsilco16;
|FPRC;

|DEFBUCLE cretam02_14_atrasos;
     #cretam02#3;
     ;
     #tsilco14#0, nAny, nDesdeMes, nTipo, "               ";
     #tsilco14#0, nAny, nHastaMes, nTipo, "zzzzzzzzzzzzzzz";
     ;
     NULL, cretam02_14;
|FIN;

|DEFBUCLE cretam02_14;
     #cretam02#1;
     ;
     #tsilco14#0, nAny, nDesdeMes, nTipo, "               ";
     #tsilco14#0, nAny, nHastaMes, nTipo, "zzzzzzzzzzzzzzz";
     ;
     NULL, cretam02_14;
|FIN;

|PROCESO Selecciona_14;
     |MODULO aModulo;
     |QBF aModulo;

     |SI swFlecha = 1;
          FSalida = 13;
     |FINSI;

     |SI FSalida = 13; |O FSalida = 0;
          |SI #0#2 = "*";
               #0#2 = " ";
               #0#3 = " ";
               |BUCLE BorraSeleccion;
          |SINO;
               #0#2 = "*";
               #0#3 = " ";
               |HAZ SelTraCen;
          |FINSI;
          |PINTA #0#2;
          |GRABA 020#0a;
     |FINSI;

     |SI swFlecha = 1;
          FSalida = 14;
     |FINSI;

     |SI FSalida = 14; |Y #0#2 = "*";
          |ABRE #labempre;
          |ABRE #labtraba;
          |ABRE #tsilco15;
          |ABRE #gomdetjr;

          |SI aModulo = "cretap01";
               |HAZ CargaTrab_p1;
          |FINSI;
          |SI aModulo = "nomcreaf"; |Y aParam = "DIASALTA";
               |HAZ CargaTrab_p1;
          |FINSI;
          |SI aModulo = "nomcreaf"; |Y aParam = "CONVENIO";
               |HAZ CargaTrab_p3;
          |FINSI;
          |SI aModulo = "nomcreaf"; |Y aParam = "CITRICOS";
               |HAZ CargaTrab_p4;
          |FINSI;
          |SI aModulo = "cretap02";
               |SI #cretap02#5 = 0; |O #cretap02#5 = 2;
                    nDesdeMes = #cretap02#1;
                    nHastaMes = #cretap02#1;
               |SINO;
                    nDesdeMes = #cretap02#1;
                    nHastaMes = #cretap02#6;
               |FINSI;
               |BUCLE CargaTrab_p2;
          |FINSI;
          |SI aModulo = "cretap11";
               || xxxxxxxxxxxxxxx
               |PUSHV 0501 2380;
               |NOME_DAT #tsilco16#aTmp_tsilco16#;
               |ABRE #tsilco16;

               nTipo = #cretap11#6;
               nAny = #cretap11#0;
               nDesdeMes = #cretap11#1;
               nHastaMes = #cretap11#1;
               |SI nTipo < 5;
                    |BUCLE cretam02_14;
               |SINO;
                    |BUCLE cretam02_14_atrasos;
               |FINSI;

               |ENTLINEAL #1#tsilco16, 2, 4, 22, 1, minCen14, maxCen14;
               |CIERRA #tsilco16;

               #0#8 = "*";
               |GRABA 020#0a;
          |SINO;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#tsilco15, 2, 4, 22, 1, min15, max15;

               #0#3 = "*";
               |GRABA 020#0a;
          |FINSI;


          |POPV;
          |CIERRA #gomdetjr;
          |CIERRA #tsilco15;
          |CIERRA #labtraba;
          |CIERRA #labempre;
     |FINSI;

     |SI FSalida = 18;
          |SI swMarcaTodas = 0;
               aMarca = "*";
          |SINO;
               aMarca = " ";
          |FINSI;

          |SI swMarcaTodas = 0;
               swMarcaTodas = 1;
          |SINO;
               swMarcaTodas = 0;
          |FINSI;

          |BUCLE MarcaTodas;

          |LEE 000#tsilco14.p;

          |PONCONTROL 23, "si";
     |FINSI;
|FPRC;
