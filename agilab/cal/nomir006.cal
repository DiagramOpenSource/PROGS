|FICHEROS;
     labtraba #2;             || trabajadores
     nomir006 #102;           || datos IRPF 99
     nomir003 #202;           || datos IRPF 99 (calculo)
|FIN;

|VARIABLES;
     nEdad = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     aAlfa3 = "";
     aAlfa4 = "";
     nNume1 = 0;
     nNume2 = 0;
     nNume3 = 0;
     nNume4 = 0;
     nPara1 = 0;
     nPara2 = 0;
     nPara3 = 0;
     nPara4 = 0;
     fFech1 = @;
     fFech2 = @;
     fFech3 = @;
     fFech4 = @;
     nFEstado = 0;
     nSeleccio = 0;
     nModo = 0;

     x = "";
     final = "";
     letra = "";
     lugar = 0;
     resto = 0;
     nifnum = 0;
     NifLetra = "";

     nInkey = 0;
     nGuardaEntrada = 0;
     swHijos = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
     swHayAlguno = 0;
|FIN;
____________________________________/
|PROCESO nomir003_16;
     |DDEFECTO #labtraba;
     #labtraba#7 = #nomir003#0;
     |LEE 000#labtraba.=;

     |PARA nPara1 =  1; |SI nPara1 [  8; |HACIENDO nPara1 = nPara1 + 1;
          #102nPara1 = #202nPara1;
     |SIGUE;
     |PARA nPara1 = 20; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 1;
          #102nPara1 = #202nPara1;
     |SIGUE;
     #nomir006#0 = #nomir003#0;
     #nomir006#40 = #nomir003#40;
     #nomir006#41 = #labtraba#2;
     |PARA nPara1 = 42; |SI nPara1 [ 114; |HACIENDO nPara1 = nPara1 + 1;
          #102nPara1 = #202nPara1;
     |SIGUE;
     #102#124 = #202#124; || deduccion inversion Viv. Habitual 2008
     #102#126 = #202#126; || deduccion inversion Viv. Habitual 2011
     #102#128 = #202#129; || Aceptacion 2014
     #102#130 = #202#130;
     |GRABA 020#nomir006.n;
|FPRC;

|DEFBUCLE nomir003;
     #nomir003#1;
     ;
     "            ", 1900,     0;
     "zzzzzzzzzzzz", 2999, 99999;
     ;
     NULL, nomir003_16;
|FIN;

|PROCESO Ayudita2; |TIPO 8;
     |LEE 000#nomir006.p;
     |SI FSalida ! 0;
          |ATRI P;
          |MENSA "    Reestructurando fichero ... Espere por favor ...";
          |ATRI 0;
          |ABRE #labtraba;
          |SELECT #2#labtraba;
          |BUCLE nomir003;
          |CIERRA #labtraba;
          |BLIN 4;
     |FINSI;
|FPRC;

|PROCESO DefAlta; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #202;
          #202#0 = #102#0;
          #202#40= #102#40;
          |LEE 000#202];
          |SI FSalida = 0;|Y #202#0 = #102#0;|Y #202#40 = #102#40;
               |PARA nPara1 =  1; |SI nPara1 [  8; |HACIENDO nPara1 = nPara1 + 1;
                    #102nPara1 = #202nPara1;
               |SIGUE;
               |PARA nPara1 = 20; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 1;
                    #102nPara1 = #202nPara1;
               |SIGUE;
               |PARA nPara1 = 42; |SI nPara1 [ 114; |HACIENDO nPara1 = nPara1 + 1;
                    #102nPara1 = #202nPara1;
               |SIGUE;
               #102#124 = #202#124; || deduccion inversion Viv. Habitual 2008
               #102#126 = #202#126; || deduccion inversion Viv. Habitual 2008
               #102#128 = #202#129; || Aceptacion 2014
               #102#130 = #202#130;
               |PINDA #0#102;
          |FINSI;
          |CIERRA #202;
     |FINSI;
|FPRC;

|PROCESO labtraba2_6;
     |SI #labtraba#44 = "A";
          swHayAlguno = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE labtraba2_6;
     #labtraba#2;
     ;
     #nomir006#0;
     #nomir006#0;
     ;
     NULL, labtraba2_6;
|FIN;

|PROCESO Nacido105; |TIPO 7;
     |ABRE #2;
     |SELECT #2#2;
     #2#7 = #102#0;
     |LEE 000#2=;
     |SI FSalida = 0;
          fFech2 = #2#11;          aAlfa2 = fFech2;
          aAlfa2 = aAlfa2 % -104;  nNume2 = aAlfa2;
          |SI nNume2 ! 0;
               #102#1 = #102#40 - nNume2;
               |PINTA #102#1;
          |FINSI;
     |FINSI;
     |CIERRA #2;

     swHayAlguno = 0;
     |BUCLE labtraba2_6;
     |SI swHayAlguno = 1;
          #nomir006#5 = #labtraba#111;
          #nomir006#121 = #labtraba#130;
          |PINTA #nomir006#5;
          |SI #nomir006#5 = 2;
               |PINTA #nomir006#121;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LetraNif105; |TIPO 0;
     eaVarDni  = #102Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;

     aNifQbf1 = #102Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;    |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #102Campo = eaVarDni;  |PINTA #102Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Mayus105; |TIPO 0;
     #102Campo = #102Campo > #102Campo;
     |PINTA #102Campo;
|FPRC;

|PROCESO SinConyuge105; |TIPO 7;
     |SI #102#3 = "2";
          |C_M #102Campo, 1, "S";
     |SINO;
          #102Campo = "";
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO NoMinus105; |TIPO 7;
     |SI #102#6 = "S";
          |C_M #102Campo, 1, "S";
     |SINO;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO NoAyuda105; |TIPO 7;
     |SI #102#6 = "S";
          |SI #102#7 = "1";
               |C_M #102Campo, 1, "S";
          |SINO;
               #102Campo = "N";
               |PINTA #102Campo;
               |C_M #102Campo, 1, "N";
          |FINSI;
     |SINO;
          #102Campo = "N";
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO NoTrabaja105; |TIPO 7;
     |SI #102#2 = "A";
          ||C_M #102Campo, 1, "S";
     |SINO;
          #102Campo = "1";
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Ordenados105;
     nNume1 = 0;
     |PARA nPara1 = 20; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
          |SI #102nPara1 ! 0;
               |SI nNume1 = 0;
                    nNume1 = #102nPara1;
               |FINSI;
               |SI nNume1 > #102nPara1;
                    |MENAV "0000Asegurese de que los descendientes esten ordenados por fecha de nacimiento.";
                    |SAL;
               |SINO;
                    nNume1 = #102nPara1;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO SinPadre105; |TIPO 7;
     nNume1 = Campo + 33;
     |SI #102nNume1 ! 0;
          |C_M #102Campo, 1, "S";
     |SINO;
          nNume2 = Campo + 1;
          |PDEFECTO #102, Campo, nNume2;
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO SinHijo105; |TIPO 7;
     |SI Campo ] 30;|Y Campo [ 39;
          nNume1 = Campo - 10;
     |FINSI;
     |SI Campo ] 42;|Y Campo [ 51;
          nNume1 = Campo - 22;
     |FINSI;
     |SI Campo ] 75;|Y Campo [ 84;
          nNume1 = Campo - 55;
     |FINSI;
     |SI #102nNume1 ! 0;
          |C_M #102Campo, 1, "S";
     |SINO;
          nNume2 = Campo + 1;
          |PDEFECTO #102, Campo, nNume2;
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO SinMovil105; |TIPO 7;
     |SI Campo ] 85;|Y Campo [ 94;
          nNume1 = Campo - 55;
     |FINSI;
     |SI Campo ] 105;|Y Campo [ 114;
          nNume1 = Campo - 43;
     |FINSI;
     |SI #102nNume1 = "1";
          |C_M #102Campo, 1, "S";
     |SINO;
          nNume2 = Campo + 1;
          |PDEFECTO #102, Campo, nNume2;
          |PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO comp_asc105; |TIPO 7;
     |SI Campo ] 52;|Y Campo [ 61;
          nNume1 = Campo + 43;
     |FINSI;
     |SI #102nNume1 ! 0;
          |C_M #102Campo, 1, "S";
     |SINO;
          nNume2 = Campo + 1;
          ||PDEFECTO #102, Campo, nNume2;
          ||PINTA #102Campo;
          |C_M #102Campo, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Buscalo105; |TIPO 0;
     nInkey = FSalida;
     nModo = (FEntrada / 100) ! 0;

     |SI nInkey = 10;
          nGuardaEntrada = FEntrada;
          |ABRE #2;
          |PUSHV 0501 2380;
          |PINPA #0#2;
          |PTEC 820;
          |CONSULTA #1#2;
          |SI FSalida = 0;
               #102#0 = #2#7;
               #102#41 = #2#2;
          |FINSI;
          |POPV;
          |CIERRA #2;
          |PINTA #102#0;
          |PINTA #102#41;
          FEntrada = nGuardaEntrada;
     |SINO;
          |SI nModo = 1;
               |ABRE #2;
               |SELECT #2#2;
               #2#7 = #102#0;
               |LEE 000#2=;
               |SI FSalida ! 0;
                    |MENAV "    NIF inexistente en trabajadores ...";
                    |ERROR;
               |SINO;
                    #102#41 = #2#2;
                    |PINTA #102#41;
               |FINSI;
               |CIERRA #2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Defecto2; |TIPO 7;
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #102Campo = aAlfa1;
     |PINTA #102Campo;
|FPRC;

|PROCESO Tipo13_105; |TIPO 13;
     |ABRE #labtraba;
     |SELECT #2#labtraba;
     #labtraba#7 = #nomir006#0;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;
     #nomir006#41 = #labtraba#2;
     |PINTA #nomir006#41;

     |HAZ Ordenados105;
     |HAZ TipoEstima;
|FPRC;

|PROCESO act_nomir003_16;
     |PARA nPara1 =  1; |SI nPara1 [  8; |HACIENDO nPara1 = nPara1 + 1;
          #nomir003#nPara1# = #nomir006#nPara1#;
     |SIGUE;
     |PARA nPara1 = 20; |SI nPara1 [ 39; |HACIENDO nPara1 = nPara1 + 1;
          #nomir003#nPara1# = #nomir006#nPara1#;
     |SIGUE;
     |PARA nPara1 = 42; |SI nPara1 [ 114; |HACIENDO nPara1 = nPara1 + 1;
          #nomir003#nPara1# = #nomir006#nPara1#;
     |SIGUE;
     #nomir003#121 = #nomir006#121;
     #nomir003#122 = #nomir006#122;
     #nomir003#124 = #nomir006#124; || deduccion inversion Viv. Habitual 2008
     #nomir003#126 = #nomir006#126; || deduccion inversion Viv. Habitual 2008
     #nomir003#129 = #nomir006#128; || Aceptacion 2014
     #nomir003#130 = #nomir006#130;

     |GRABA 020#nomir003.a;
     |LIBERA #nomir003;
|FPRC;

|DEFBUCLE act_nomir003;
     #nomir003#1;
     ;
     #nomir006#0, #nomir006#40,     0;
     #nomir006#0, #nomir006#40, 99999;
     be;
     NULL, act_nomir003_16;
|FIN;

|PROCESO comp_hijos_006;
     swHijos = 0;
     |PARA nPara1 = 20; |SI nPara1 [ 29; |HACIENDO nPara1 = nPara1 + 1;
          nEdad = #102#40 - #102nPara1;
          |SI #102nPara1 ! 0;
               nPara2 = nPara1 + 10;    || grado minusvalia

               || solo tienen reduccion menores de 25 a¤os o mayores c/minusv.
               |SI nEdad < 25;
               |O #102nPara2 = "1"; |O #102nPara2 = "2";
                   swHijos = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     |SI #102#3 = 1; |Y swHijos ! 1;
          aAlfa1 = "    ATENCION. Para la situación familiar tipo 1 es obligatorio tener ";
          aAlfa1 = aAlfa1 + " des- cendientes con derecho a reducción";
          |MENAV aAlfa1;
          #102#3 = 3;
          |PINTA #102#3;
          aAlfa = "    Se ha cambiado la situación familiar a tipo 3. Si no es correcto ";
          aAlfa = aAlfa + "cámbielo al 1 e introduzca los datos de los desc.";
          |MENAV aAlfa;
          |GRABA 020#102a;
     |FINSI;
|FPRC;

|PROCESO comp_conyuge_006;
     aAlfa1 = #102#4;
     |QBF aAlfa1;
     |SI aAlfa1 =""; |Y #102#3 = 2;
          aAlfa1 = "    ATENCION. Para la situación familiar tipo 2 es obligatorio tener informado";
          aAlfa1 = aAlfa1 + " el NIF del cónyuge.";
          |MENAV aAlfa1;
          #102#3 = 3;
          |PINTA #102#3;
          aAlfa = "    Se ha cambiado la situación familiar a tipo 3. Si no es correcto ";
          aAlfa = aAlfa + "cámbielo al 2 e introduzca el NIF del cónyuge";
          |MENAV aAlfa;
          |GRABA 020#102a;
     |FINSI;
|FPRC;

|PROCESO Tipo3_105; |TIPO 3;
     |MODULO aAlfa1;
     |SI aAlfa1 = "nomir006";
          |HAZ comp_conyuge_006;
          |HAZ comp_hijos_006;

          |HAZ Ordenados105;
          |AVISO;
          |CONFI "0000SActualizar parametros de calculo: ";
          |SI FSalida = 0;
               |BUCLE act_nomir003;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TipoEstima;
     |SI #nomir006#5 = 2;
          ||C_M #nomir006#121, 1, "S";
          |C_V #nomir006#121, 1, "S";
          |PINTA #nomir006#121;
     |SINO;
          |C_M #nomir006#121, 1, "N";
          |C_V #nomir006#121, 1, "N";
          |PINTA 1152, "   ";
     |FINSI;
|FPRC;

|PROCESO Ayuda121; |TIPO 7;
|ACABA;
     |PUSHV 13261880;
     |ATRI R;
     |PINTA 1330, " Tipo de Calculo para contratos menores de un a¤o: ";
     |PINTA 1430, " 1. Estimar ingresos hasta la fecha de fin de con- ";
     |PINTA 1530, "    trato indicada o hasta final de a¤o.           ";
     |PINTA 1630, " 2. Tener en cuenta lo ingresado hasta el periodo  ";
     |PINTA 1730, "    que estamos calculando.                        ";
     |ATRI 0;
|FPRC;

|PROCESO Restaura6;
|ACABA;
     |ATRI 0;
     |POPV;
|FPRC;

|PROCESO AyudaTipo6; |TIPO 7;
|ACABA;
     |PUSHV 13262080;
     |ATRI R;
     |PINTA 1330, " Tipo de Relacion Laboral: ";
     |PINTA 1430, " 1. General                                        ";
     |PINTA 1530, " 2. Duracion inferior a un a¤o                     ";
     |PINTA 1630, " 3. Relaciones laborales especiales de caracter de-"
     |PINTA 1730, "    pendiente (salvo penados y discapacitados)     ";
     |PINTA 1830, " 4. Esporadica propia de retribuciones por peonadas";
     |PINTA 1930, "    o jornales diarios                             ";
     |ATRI 0;
|FPRC;

|PROCESO RestauraViv_6;
     |SI #nomir003#124 = "S"; |Y #nomir003#126 = "S";
          || no restaures que si no se jode la pantalla
     |SINO;
          |ATRI 0;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO AyudaViv_6; |TIPO 7;
                 ||     3        4         5         6         7
                 ||     012345678901234567890123456789012345678901234567

     |SI Campo = 124;
          |PUSHV 15022379;
          |ATRI R;
          |PINTA 1630, " Introduzca 'S' si el trabajador se acoge  a la ";
          |PINTA 1730, " deducción por pagos de préstamos  destinados a ";
          |PINTA 1830, " la vivienda habitual del perceptor adquirida o ";
          |PINTA 1930, " rehabilitada CON ANTERIORIDAD A 01/01/2011.    ";
     |FINSI;
     |SI Campo = 126;
          |PUSHV 15022379;
          |ATRI R;
          |PINTA 1630, " Introduzca 'S' si el trabajador se acoge  a la ";
          |PINTA 1730, " deducción por pagos de préstamos  destinados a ";
          |PINTA 1830, " la vivienda habitual del perceptor adquirida o ";
          |PINTA 1930, " rehabilitada  ENTRE EL d¡a 01/01/2011 y el d¡a ";
          |PINTA 2030, " 31/12/2012. NO ES VALIDO PARA VIVIENDAS ADQUI- ";
          |PINTA 2130, " RIDAS O REHABILITADAS A PARTIR DEL 01/01/2013. ";
     |FINSI;
|FPRC;

|PROCESO AvisoViv2013_6;
     |SI #102Campo = "S"; |Y Contenido = "N"; |Y #102#40 ] 2013;
          aAlfa = "    ATENCION. La deducción sólo es aplicable a viviendas ";
          aAlfa = aAlfa + "adquiridas o rehabilitación HASTA el 31/12/2012";
          |MENAV aAlfa;

          aAlfa = "    Compruebe que el trabajador tiene derecho a esta ";
          aAlfa = aAlfa + "deducción a partir del ejercicio 2013";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

/*
|| de momento NO
|PROCESO nomir012;
     |SI #nomir003#124 = "S"; |Y #nomir012#99 = "S";
     |FINSI;
|FPRC;

|DEFBUCLE nomir012;
     #nomir012#2;
     ;
     #nomir003#1;
     #nomir003#1;
     ;
     NULL, nomir012;
|FIN;
*/

|PROCESO CompViv_6;
     |SI #nomir006#124 = "S"; |Y #nomir006#126 = "S";
          aAlfa = "    ATENCION: no se pueden marcar las dos casillas de ";
          aAlfa = aAlfa + "deducción por vivienda. Debe elegir una.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;
