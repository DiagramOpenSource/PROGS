|FICHEROS;
     labnct07 #0;

     labempre;
     labtraba;
     labcentr;
     nomcenes;
     labcontr;
     nomconca;
     labmunic #6;
     nomvarca;
     motibaja;
     nomcalli;
     nomhicli;
     silcon06;
     silcon15;
     labtab01;
     labnct10;      || registro
     labpadre;
     nomconve;
|FIN;

|VARIABLES;
     aParam = "";
     nOpcionSS = 0;
     aCabecera = "";
     avisa_mes = 0;
     htipo = 0;
     meses = "ENERO     FEBRERO   MARZO     ABRIL     MAYO      JUNIO     JULIO     AGOSTO    SEPTIEMBREOCTUBRE   NOVIEMBRE DICIEMBRE ";
     salte_1 = 0;
     salte_2 = 0;

     &nElMesIRPF = 0;         || para 'nomir008'
     &nElAnyIRPF = 0;         || para 'nomir008'
     &nDiferencias = 0;   || para 'nomir008'

     &nElMes = 0;         || para la nomina
     &nElAny = 0;         || para la nomina
     swActiva = 0;
     swPorGrupos = 0;
     nGrupo = 0;
     nCampoG = 0;

     &nEmpAUTO = 0;
     &nEmpAUTO_D = 0;
     &nEmpAUTO_H = 0;
     &nTraAUTO = 0;
     &nTraAUTO_D = 0;
     &nTraAUTO_H = 0;
     &nMesAUTO = 0;
     &nAnyAUTO = 0;
     &nEnEmpresa = 0;
     &nPaso = 0;
     &swCompAjuste = 0;
     &swSegPasada = 0;
     &nRetEstAnu = 0;    || retencion estimada anual
     &swCalPagas = "S";
     aAlfa1 = "";
     aAlfa2 = "";
     alfa1 = "";
     alfa2 = "";
     nume1 = 0;
     nume2 = 0;
     para1 = 0;
     swfuera = 0;
     &nMes = 0;
     &nAny = 0;
     &nDesdeEmp = 0;
     &nHastaEmp = 0;
     &nDesdeTra = 0;
     &nHastaTra = 0;
     seleccio = 0;
     aAlfa = "";
     p_mes = "";
     fecsys = @;
     mesnum = 0;
     anynum = 0;
     guarda = 0;
     topemes = 0;
     aFabre = "";
     aBase = "";
     aMas = "";
     aFich = "";
     &nTopemes = 0;
     &nEmp = 0;
     &nTra = 0;
     &nCen = 0;
     &aHora = "";
     aDef = "";
     FCargaDef = "";
     nCampo1 = 0;
     &swEdicion = 0;

     nOpcion = 0;
     {-1}menu = "";
     menu1 = "2400";
     menu2 = "1";
     menu3 = "";
     menu4 = "VACI";
     menu5 = "Volver a incid.";
     menu6 = "Aceptar y continuar";
     menu7 = "Cancelar proceso";
     menu8 = "Imprimir informe";

     aEstadoNomgirli = "";
     nNroIncid = 0;
     &swStopIRPF = 0;
     nNume1 = 0;
     &nIRPFMes = 0;
     &swBajaEsteMes = 0;
     nMesBaja = 0;
     nAnyBaja = 0;
     FEstado = 0;

     &aFecha = "";
     aFechaAlta = "";
     fFechaLimite = @;
     fFechaAlta = @;
     &swSigue = 0;
     &aCadena = "";
     &eaNom   = "";
     &eaApel1 = "";
     &eaApel2 = "";
     &eaCodNif = "";
     nHorasMax = 0;
     nNume = 0;
     &aCodPos = "";
     &nContMuni = 0;
     &aCodMuni = "";
     nHandle = 0;
     aRuta = "";
     aFichero = "";
     nNivel = 0;
     nNumMov = 0;
     nNumTra = 0;
     aMuni = "";
     nMensajeF5 = 1;
     aCodigoMunicipio = "";
     nJornada = 0;
     aUsuario = "";
     fFecha = @;
     &runnom = "labnct07";
     nUltimo = 0;
     aRutaErrores = "";
     aOrigen = "";
     aDestino = "";
     nSwEtiq = 0;
     aEtiqu = "";
     aError = "";
     nNumChars = 0;
     aRutaSal = "";
     aLon = "";
     nLon = 0;
     nPunt = 0;
     nPos = 0;
     aCaracter = "";
     aMes = "";
     swEncontrado = 0;
     nVez = 0;
     aCCC = "";

     aOpcionSS = "";
     aTrabajador = "";
     aEmp = "";
     aCen = "";
     aTra = "";
     &swEnviado = 0;
     &eaVengoDe = "";
     swPantalla = 0;

     fFechaBaja = @;
     aDiaBaja = "";
     aMesBaja = "";
     aAnyBaja = "";
     nAnyBusca = 0;
     nFechaFin = 0;
     fFechaFin = @;
     aFechaFin = "";
     nFechaBaja = 0;
     aRutaBAT = "";
     nHandleBAT = 0;
     aUnidad = "";
     aResto = "";
     {1}aContiene = "";

     &eaCadena = "";
     &eaCadenaSal = "";
     &eaCaracter1 = "";
     &eaCaracter2 = "";
     swConsultaEmp = 0;
     swConsultaTra = 0;
     swEsConsulta = 0;
     nConsulta = 0;
     swConectaSS = 0;
     swEjecuta = 0;
|FIN;

|PROCESO CompFecha;
     aFecha = #0Campo;
     |HAZ CompFecha_plb;
|FPRC;

|PROCESO PintaCabecera;
     ||                1        2         3         4         5         6         7
     ||                1234567890123456789012345678901234567890123456789021345678901

     |SI nOpcionSS = 1;
          aCabecera = "               ALTA ONLINE EN SEGURIDAD SOCIAL               ";
     |FINSI;
     |SI nOpcionSS = 2;
          aCabecera = "               BAJA ONLINE EN SEGURIDAD SOCIAL               ";
     |FINSI;
     |SI nOpcionSS = 3;
          aCabecera = "                CAMBIO DE GRUPO DE COTIZACION                ";
     |FINSI;
     |SI nOpcionSS = 4;
          aCabecera = "          CAMBIO DE CONTRATO (TIPO/COEFICIENTE ...)          ";
     |FINSI;
     |SI nOpcionSS = 5;
          aCabecera = "          CONSULTA SITUACION AFILIADO EN LA EMPRESA          ";
     |FINSI;
     |SI nOpcionSS = 6;
          aCabecera = "               CONSULTA SITUACION DE LA EMPRESA              ";
     |FINSI;
     |SI nOpcionSS = 7;
          aCabecera = "               CONSULTA ONLINE DE NAF POR IPF                ";
     |FINSI;
     |SI nOpcionSS = 8;
          aCabecera = "              DUPLICADO ONLINE DE DOCUMENTOS TA              ";
     |FINSI;
     |SI nOpcionSS = 9;
          aCabecera = "      CERTIFICADO ONLINE SITUACION COTIZACION EMPRESA        ";
     |FINSI;
     |SI nOpcionSS = 10;
          aCabecera = "           ANOTACION DE CONVENIO COLECTIVO (EMPRESA)         ";
     |FINSI;
     |SI nOpcionSS = 11;
          aCabecera = "             INFORME AFILIADOS EN ALTA EN UN CCC             ";
     |FINSI;
     |SI nOpcionSS = 13;
          aCabecera = "              CONSULTA DE TRABAJADORES EN ALTA               ";
     |FINSI;
     |SI nOpcionSS = 15;
          aCabecera = "              CONSULTA DE CONVENIOS COLECTIVOS               ";
     |FINSI;
     |SI nOpcionSS = 17;
          aCabecera = "         ANOTACION DE CONVENIO COLECTIVO (TRABAJADOR)        ";
     |FINSI;
     |SI nOpcionSS = 18;
          aCabecera = "       INFORME DE DATOS DE COTIZACION POR PERIODO Y CCC      ";
     |FINSI;
     |SI nOpcionSS = 19;
          aCabecera = "         CONSULTA DE CCCs ASIGNADOS A UN AUTORIZADO          ";
     |FINSI;
     |SI nConsulta = 01;
          aCabecera = "              DATOS DE LA EMPRESA EN CONTRAT@                ";
     |FINSI;
     |SI nConsulta = 02;
          aCabecera = "        CONSULTA DE EMPRESAS AUTORIZADAS EN CONTRAT@         ";
     |FINSI;

     |ATRI R;
     |PINTA 0711, aCabecera;
     |ATRI I;
|FPRC;

|PROCESO CuentaMunicipio;
     nContMuni = nContMuni + 1;
     aCodMuni = #6#1;
|FPRC;

|DEFBUCLE CuentaMunicipio;
     #6#1;
     ;
     aCodPos, "00000";
     aCodPos, "99999";
     ;
     NULL,CuentaMunicipio;
|FIN;

|PROCESO BuscaMunicipio;
     aAlfa2 = #6#3;            || aAlfa2 = municipio de labmunic
     |QBT aAlfa2;
     aMuni = #labempre#6;   || aMuniEmp = municipio de labempre
     aMuni = aMuni > "";
     |QBT aMuni;

     aAlfa = aMuni - aAlfa2;
     |SI aAlfa ! aMuni;
          ||aAlfa2 esta en aMuni
          aCodMuni = #6#1;
          nContMuni = nContMuni + 1;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaMunicipio;
     #6#1;
     ;
     aCodPos, "00000";
     aCodPos, "99999";
     ;
     NULL,BuscaMunicipio;
|FIN;

|PROCESO min_labmunic;
     #6#4 = aCodPos;
     #6#1 = "00000";
|FPRC;

|PROCESO max_labmunic;
     #6#4 = aCodPos;
     #6#1 = "99999";
|FPRC;

|PROCESO CodigoMuni;
     nContMuni = 0;
     |BUCLE CuentaMunicipio;

     |SI nContMuni > 1;
          nContMuni = 0;
          |BUCLE BuscaMunicipio;
          |SI nContMuni > 1;
               nMensajeF5 = 1;
               aCodigoMunicipio = "";
               |SUB_EJECUTA "labmunic";
               |SI aCodigoMunicipio ! "";
                    aCodMuni = aCodigoMunicipio;
                    nContMuni = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nContMuni = 0;
          nMensajeF5 = 1;
          aCodigoMunicipio = "";
          |SUB_EJECUTA "labmunic";
          |SI aCodigoMunicipio ! "";
               aCodMuni = aCodigoMunicipio;
               nContMuni = 1;
          |FINSI;
     |FINSI;
     ||ahora se supone que en aCodMuni tenemos el codigo del municipio
|FPRC;

|PROCESO TipoDocumento;
     aAlfa = #labtraba#7; |QBF aAlfa;
     aAlfa1 = aAlfa % 0101;
     |SI aAlfa1 ] "0"; |Y aAlfa1 [ "9";
          aAlfa = "D";
     |SINO;
          |SI aAlfa1 = "X"; |O aAlfa1 = "Y"; |O aAlfa1 = "Z";
               aAlfa = "E";
          |SINO;
               aAlfa1 = #labtraba#76; |QBF aAlfa1;
               aAlfa2 = aAlfa1 % 0599; aAlfa1 = aAlfa1 % 0103;
               |SI aAlfa1 = "ESP"; |O aAlfa1 = "724"; |O aAlfa1 = "250";
                |O aAlfa1 = "276"; |O aAlfa1 = "056"; |O aAlfa1 = "442";
                |O aAlfa1 = "380"; |O aAlfa1 = "208"; |O aAlfa1 = "372";
                |O aAlfa1 = "826"; |O aAlfa1 = "300"; |O aAlfa1 = "620";
                |O aAlfa1 = "040"; |O aAlfa1 = "246"; |O aAlfa1 = "752";
                |O aAlfa1 = "233"; |O aAlfa1 = "428"; |O aAlfa1 = "440";
                |O aAlfa1 = "616"; |O aAlfa1 = "203"; |O aAlfa1 = "703";
                |O aAlfa1 = "705"; |O aAlfa1 = "348"; |O aAlfa1 = "470";
                |O aAlfa1 = "196"; |O aAlfa2 = "HOLANDA";
                    aAlfa = "U";
               |SINO;
                    aAlfa = "W";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Registro;
     |ABRE #labnct10;

     #labnct10#0 = #labtraba#0;
     #labnct10#1 = #labtraba#1;
     |SI swConsultaEmp = 1;
          #labnct10#11 = #0#7;
          #labnct10#1 = 00000;
     |SINO;
          #labnct10#11 = #labtraba#77;
     |FINSI;
     |SI nOpcionSS = 1;
          #labnct10#2 = 001;
          #labnct10#3 = "Alta";
     |FINSI;
     |SI nOpcionSS = 2;                 || para la baja
          #labnct10#2 = 002;
          #labnct10#3 = "Baja";
     |FINSI;
     |SI nOpcionSS = 3;                 || para cambio de grupo de tarifa
          #labnct10#2 = 003;
          #labnct10#3 = "Cambio de grupo de cotizaci¢n";
     |FINSI;
     |SI nOpcionSS = 4;                 || para cambio de contrato
          #labnct10#2 = 004;
          #labnct10#3 = "Cambio de Contrato";
     |FINSI;
     |SI nOpcionSS = 5;
          #labnct10#2 = 005;
          #labnct10#3 = "Consulta situaci¢n de afiliado";
     |FINSI;
     |SI nOpcionSS = 6;
          #labnct10#2 = 006;
          #labnct10#3 = "Consulta situaci¢n de la empresa";
     |FINSI;
     |SI nOpcionSS = 7;
          #labnct10#2 = 007;
          #labnct10#3 = "Consulta de n£mero de afiliaci¢n";
     |FINSI;
     |SI nOpcionSS = 8;
          #labnct10#2 = 008;
          #labnct10#3 = "Duplicado de documentos TA";
     |FINSI;
     |SI nOpcionSS = 9;
          #labnct10#2 = 009;
          #labnct10#3 = "Certificado situaci¢n de cotizaci¢n";
     |FINSI;
     |SI nOpcionSS = 10;
          #labnct10#2 = 010;
          #labnct10#3 = "Anotaci¢n de Convenio";
     |FINSI;
     |SI nOpcionSS = 11;
          #labnct10#2 = 011;
          #labnct10#3 = "Consulta de afiliados en un CCC";
     |FINSI;
     |SI nOpcionSS = 13;
          #labnct10#2 = 013;
          #labnct10#3 = "Consulta trabajadores en alta";
     |FINSI;
     |SI nOpcionSS = 15;
          #labnct10#2 = 015;
          #labnct10#3 = "Consulta de Convenios";
     |FINSI;
     |SI nOpcionSS = 17;
          #labnct10#2 = 017;
          #labnct10#3 = "Anotaci¢n de Convenio (Trabajador)";
     |FINSI;
     |SI nOpcionSS = 19;
          #labnct10#2 = 019;
          #labnct10#3 = "Consulta de CCCs Autorizado";
     |FINSI;
     |SI nOpcionSS = 25;
          #labnct10#2 = 025;
          #labnct10#3 = "Consulta Vida Laboral";
     |FINSI;

     fFecha = ~;
     aFecha = fFecha;
     #labnct10#4 = fFecha;         || fecha

     |HORA aHora;
     |QBF aHora;
     #labnct10#5 = aHora;          || hora

     aUsuario = Usuario % 810;
     |QBF aUsuario;
     #labnct10#6 = aUsuario;       || usuario
     #labnct10#7 = eaVengoDe;

     |SI swConsultaEmp = 0;
          #labnct10#8 = #labtraba#45;             || tipo de contrato
          #labnct10#9 = #labtraba#36;             || fecha de alta
          #labnct10#10 = #labtraba#37;            || fecha de baja
     |FINSI;

     |GRABA 020#labnct10.n;
     |LIBERA #labnct10;
|FPRC;

|PROCESO Linea;
     |QBF aAlfa;
     aCadena = aAlfa;
     |HAZ QuitaRaros;
     |SI nNivel = 1;
          aCadena = aCadena;
     |FINSI;
     |SI nNivel = 2;
          aCadena = "  " + aCadena;
     |FINSI;
     |SI nNivel = 3;
          aCadena = "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 4;
          aCadena = "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 5;
          aCadena = "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     |SI nNivel = 6;
          aCadena = "  " + "  " + "  " + "  " + "  " + aCadena;
     |FINSI;
     aCadena = aCadena + &13 + &10;
     aAlfa = aCadena;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO JornadaMaxima;
     nHorasMax = 40;
     |ABRE #nomconca;
     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |SI FSalida = 0;
          |SI #nomconca#162 ! 0;
               nHorasMax = #nomconca#162;
          |FINSI;
     |FINSI;
     |CIERRA #nomconca;
|FPRC;

|PROCESO convenio;
     |ABRE #nomconca;
     #nomconca#0 = #labtraba#87;
     |LEE 000#nomconca.=;
     |CIERRA #nomconca;
|FPRC;

|PROCESO DatosAlta;
     nNivel = 3;
     aAlfa = "<DATOS_ALTA_AFILIACION>";
     |HAZ Linea;

     aCCC = #labempre#13;

     |ABRE #labcentr;
     |ABRE #nomcenes;
     |SI swConsultaEmp = 0;
          |SI #labtraba#45 ! "421"; |Y #labtraba#45 ! "422";
               #labcentr#0 = #labtraba#0;
               #labcentr#1 = #labtraba#77;
               |LEE 000#labcentr.=;
               |SI FSalida = 0;
                    aCCC = #labcentr#10;
               |SINO;
                    |MENAV "    ATENCION: No se encuentra el centro del trabajador";
               |FINSI;
          |SINO;
               #nomcenes#0 = #labtraba#0;
               #nomcenes#13 = #labtraba#77;
               #nomcenes#1 = "87";
               |LEE 000#nomcenes.=;
               |SI FSalida = 0;
                    aCCC = #nomcenes#10;
               |SINO;
                    |MENAV "    ATENCION: No se encuentra el centro de formación";
               |FINSI;
          |FINSI;
     |SINO;
          |SI #labtraba#45 ! "421";
          |Y #labtraba#45 ! "085"; |Y #labtraba#45 ! "097";
               #labcentr#0 = #0#0;
               #labcentr#1 = #0#7;
               |LEE 000#labcentr.=;
               |SI FSalida = 0;
                    aCCC = #labcentr#10;
               |SINO;
                    |MENAV "    ATENCION: No se encuentra el centro del trabajador";
               |FINSI;
          |SINO;
               #nomcenes#0 = #labtraba#0;
               #nomcenes#13 = #labtraba#77;
               #nomcenes#1 = "87";
               |LEE 000#nomcenes.=;
               |SI FSalida = 0;
                    aCCC = #nomcenes#10;
               |SINO;
                    |MENAV "    ATENCION: No se encuentra el centro de formación";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #nomcenes;
     |CIERRA #labcentr;

     nNivel = 4;

     aAlfa1 = "";
     |ABRE #silcon06;
     |ABRE #silcon15;

     #silcon15#0 = #labempre#0;
     #silcon15#1 = #labcentr#1;
     |LEE 000#silcon15.=;
     |SI FSalida = 0;
          aAlfa1 = #silcon15#2;
          |QBF aAlfa1;
     |SINO;
          #silcon06#0 = #labempre#0;
          |LEE 000#silcon06.=;
          |SI FSalida = 0;
               aAlfa1 = #silcon06#2;
               |QBF aAlfa1;
          |FINSI;
     |FINSI;

     |SI aAlfa1 = "";
          |MENAV "    ATENCION: no se ha encontrado el régimen de la empresa";
     |FINSI;

     |CIERRA #silcon15;
     |CIERRA #silcon06;

     aAlfa1 = ("0000" + aAlfa1) % -104;
     |SI aAlfa1 = "0613"; aAlfa1 = "0163"; |FINSI;
     aAlfa2 = aCCC; |QBF aAlfa2;
     aAlfa = "<CCC>" + aAlfa1 + aAlfa2 + "</CCC>";
     |HAZ Linea;

     aAlfa = #labtraba#45;
     aAlfa = "<CONTRATO>" + aAlfa + "</CONTRATO>";
     |HAZ Linea;

     |SI nOpcionSS = 8;
          aAlfa1 = #labtraba#34; |QBF aAlfa1;
     |SINO;
          aAlfa1 = #labtraba#36; |QBF aAlfa1;
     |FINSI;

     |SI aAlfa1 ! ""; |Y aAlfa1 ! "          "; |Y aAlfa1 ! "..........";
          aAlfa = (aAlfa1 % 102) + "/" + (aAlfa1 % 402) + "/" + (aAlfa1 % -104);
          /*
          |SI nOpcionSS = 8;  || Duplicados de Documentos TA
          || nuevo formato ... de repente 02.02.2012 000628.00006
               aAlfa = (aAlfa1 % -104) + (aAlfa1 % 402) + (aAlfa1 % 102);
          |SINO;
               aAlfa = (aAlfa1 % 102) + "/" + (aAlfa1 % 402) + "/" + (aAlfa1 % -104);
          |FINSI;
          */
     |FINSI;
     aAlfa = "<FECHA_ALTA>" + aAlfa + "</FECHA_ALTA>";
     |HAZ Linea;

     aAlfa = #labtraba#33;
     |QBF aAlfa;
     aAlfa = ("00" + aAlfa) % -102;
     aAlfa = "<GRUPO_TARIFA>" + aAlfa + "</GRUPO_TARIFA>";
     |HAZ Linea;

     swSigue = 0;
     |SI nOpcionSS = 1; |O nOpcionSS = 3;
          aAlfa = "N";
          |SI #labtraba#42 = "M"; |O #labtraba#42 = "X";
               |SI #labtraba#33 ] 08;
                    aAlfa = "S";
               |FINSI;
          |FINSI;
          aAlfa = "<ICOTIZMENSUAL>" + aAlfa + "</ICOTIZMENSUAL>";
          |HAZ Linea;
     |FINSI;

     aAlfa = #0#6;
     |QBF aAlfa;
     |SI #0#6 = 0;
          aAlfa = "";
     |FINSI;

     aAlfa = "<COEFICIENTE>" + aAlfa + "</COEFICIENTE>";
     |HAZ Linea;

     aAlfa = #labtraba#204;
     |QBF aAlfa;
     aAlfa = "<OCUPACION>" + aAlfa + "</OCUPACION>";
     |HAZ Linea;

     |SI nOpcionSS = "01"; |O nOpcionSS = "10"; |O nOpcionSS = "17";
     ||SI nOpcionSS = "10"; |O nOpcionSS = "17";
          |SI nOpcionSS = "01";
               |HAZ convenio;
               aAlfa = #nomconca#142;   || para que preguntarlo antes?
          |SINO;
               aAlfa = #labnct07#11;    || lo pregunto antes
          |FINSI;
          |QBF aAlfa;
          aAlfa = "<CONVENIOCOLECTIVO>" + aAlfa + "</CONVENIOCOLECTIVO>";
          |HAZ Linea;
     |FINSI;

     aAlfa = #labnct07#10;
     |QBF aAlfa;
     aAlfa = "<CONDDESEMPLEADO>" + aAlfa + "</CONDDESEMPLEADO>";
     |HAZ Linea;

     |SI nOpcionSS = 2;
          aAlfa = "";
          aAlfa1 = #0#2;
          |QBF aAlfa1;
          |SI aAlfa1 ! "";
               aAlfa = (aAlfa1 % 102) + "/" + (aAlfa1 % 402) + "/" + (aAlfa1 % -104);
          |FINSI;

          aAlfa = "<FECHA_BAJA>" + aAlfa + "</FECHA_BAJA>";
          |HAZ Linea;

          aAlfa = #0#3;
          |QBF aAlfa;

          nNume = aAlfa;
          |SI nNume = 00;
               aAlfa = "";
          |FINSI;

          aAlfa = "<CAUSABAJA>" + aAlfa + "</CAUSABAJA>";
          |HAZ Linea;

/*
          || no hay que ponerlo, confirmado con Miguel Angel 1714.1108 30/05/2017
          aAlfa = #0#8;
          |QBF aAlfa;

          aAlfa = "<DIASVACACIONES>" + aAlfa + "</DIASVACACIONES>";
          |HAZ Linea;
*/

          aAlfa = "";
          aAlfa1 = #0#9;
          |QBF aAlfa1;
          |SI aAlfa1 ! "";
               aAlfa = (aAlfa1 % 102) + "/" + (aAlfa1 % 402) + "/" + (aAlfa1 % -104);
          |FINSI;

          aAlfa = "<FECHAVACACIONES>" + aAlfa + "</FECHAVACACIONES>";
          |HAZ Linea;

     |FINSI;

     nNivel = 3;
     aAlfa = "</DATOS_ALTA_AFILIACION>";
     |HAZ Linea;
|FPRC;

|PROCESO Domicilio;
     eaCodNif = #labtraba#7;
     ||HAZ LeeNifs;

     nNivel = 3;
     aAlfa = "<DOMICILIO>";
     |HAZ Linea;

     nNivel = 4;

     aAlfa = #labtraba#4;  |QBF aAlfa;
     aAlfa = "<NUMERO>" + aAlfa + "</NUMERO>";
     |HAZ Linea;
/*
     aAlfa = "<ESCALERA>" + aAlfa + "</ESCALERA>";
     |HAZ Linea;

     aAlfa = "<PUERTA>" + aAlfa + "</PUERTA>";
     |HAZ Linea;

     aAlfa = "<TIPO_VIA>" + aAlfa + "</TIPO_VIA>";
     |HAZ Linea;
*/
     aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
     |HAZ CodigoMuni;
     |SI nContMuni = 0;
          aAlfa1 = "";
     |SINO;
          aAlfa1 = aCodMuni;
     |FINSI;
     aAlfa = "<CODIGO_MUNICIPIO>" + aAlfa1 +  "</CODIGO_MUNICIPIO>";
     |HAZ Linea;

     aAlfa = #labtraba#5;  |QBF aAlfa;
     aAlfa = "<PISO>" + aAlfa + "</PISO>";
     |HAZ Linea;

     aAlfa = #labtraba#3;  |QBF aAlfa;
     aAlfa = "<VIA>" + aAlfa + "</VIA>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = "</DOMICILIO>";
     |HAZ Linea;
|FPRC;

|PROCESO Representante;
     nNivel = 3;
     aAlfa = "<REPRESENTANTE>";
     |HAZ Linea;

     nNivel = 4;
     aAlfa = #labtraba#22;
     aAlfa1 = aAlfa % 103;
     |SI aAlfa1 = "...";
          aAlfa = "";
     |FINSI;
     aAlfa = "<DNI>" + aAlfa + "</DNI>";
     |HAZ Linea;

     aAlfa = #labtraba#20;
     aAlfa1 = aAlfa % 103;
     |SI aAlfa1 = "...";
          aAlfa = "";
     |FINSI;
     aAlfa = "<NOMBRE>" + aAlfa + "</NOMBRE>";
     |HAZ Linea;

     aAlfa = #labtraba#23;
     aAlfa1 = aAlfa % 103;
     |SI aAlfa1 = "...";
          aAlfa = "";
     |FINSI;
     aAlfa = "<PARENTESCO>" + aAlfa + "</PARENTESCO>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = "</REPRESENTANTE>";
     |HAZ Linea;
|FPRC;

|PROCESO Trabajadores;
     |SI swConsultaEmp = 1;
          #labtraba#0 = #0#0;
          #labtraba#1 = 99999;
          |LEE 000#labtraba.];
          |SI FSalida = 0; |Y #labtraba#0 = #0#0;
               #0#1 = "99999";
          |SINO;
               |LEE 000#labtraba.a;
               #0#1 = #labtraba#1;
          |FINSI;
     |FINSI;

     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;

     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     nNivel = 2;
     aAlfa = "<TRABAJADOR>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = nOpcionSS;
     aAlfa = "<OPCIONSS>" + aAlfa + "</OPCIONSS>";
     |HAZ Linea;

     |SI swConsultaEmp = 0;
          aCadena = #labtraba#2;
          |HAZ SeparaNom_plb;
     |SINO;
          eaNom = "";
          eaApel1 = "";
          eaApel2 = "";
     |FINSI;

     nNivel = 3;

     aAlfa = "<NOMBRE>" + eaNom + "</NOMBRE>";
     |HAZ Linea;
     aAlfa = "<PRIMER_APELLIDO>" + eaApel1 + "</PRIMER_APELLIDO>";
     |HAZ Linea;
     aAlfa = "<SEGUNDO_APELLIDO>" + eaApel2 + "</SEGUNDO_APELLIDO>";
     |HAZ Linea;

     aAlfa1 = #labtraba#11; |QBF aAlfa1;
     |SI aAlfa1 ! ""; |Y aAlfa1 ! "          "; |Y aAlfa1 ! "..........";
          aAlfa = (aAlfa1 % 102) + "/" + (aAlfa1 % 402) + "/" + (aAlfa1 % -104);
     |FINSI;
     aAlfa = "<FECHA_NACIMIENTO>" + aAlfa + "</FECHA_NACIMIENTO>";
     |HAZ Linea;

     aAlfa = #labtraba#7;  |QBF aAlfa;
     aAlfa = "<NUMERO_DOCUMENTO>" + aAlfa + "</NUMERO_DOCUMENTO>";
     |HAZ Linea;

     |HAZ TipoDocumento;
     aAlfa = "<TIPO_DOCUMENTO>" + aAlfa + "</TIPO_DOCUMENTO>";
     |HAZ Linea;

     aAlfa = "";

     |ABRE #labpadre;
     #labpadre#0 = #labtraba#0;
     #labpadre#1 = #labtraba#1;
     |LEE 000#labpadre.=;
     |SI FSalida = 0;
          aAlfa = #labpadre#5;
     |FINSI;
     |CIERRA #labpadre;

     |SI aAlfa = "V"; aAlfa = "1"; |FINSI;
     |SI aAlfa = "M"; aAlfa = "2"; |FINSI;
     aAlfa = "<SEXO>" + aAlfa + "</SEXO>";
     |HAZ Linea;

     aAlfa = #labtraba#244; |QBF aAlfa;
     aAlfa = "<TELEFONO>" + aAlfa + "</TELEFONO>";
     |HAZ Linea;

     aAlfa = #labtraba#75; |QBF aAlfa;
     aAlfa = "<NUMERO_SEGURIDAD_SOCIAL>" + aAlfa + "</NUMERO_SEGURIDAD_SOCIAL>";
     |HAZ Linea;

     aAlfa = #labtraba#76; |QBF aAlfa;
     aAlfa1 = aAlfa % 0599; aAlfa = aAlfa % 0103;
     |SI aAlfa = "ESP";                   aAlfa = "724"; |FINSI;
     |SI aAlfa < "000"; |O aAlfa > "999"; aAlfa = "724"; |FINSI;
     aAlfa = "<NACIONALIDAD>" +  aAlfa + "</NACIONALIDAD>";
     |HAZ Linea;

     aAlfa = "<PAIS>" + "724" + "</PAIS>";
     |HAZ Linea;

     aAlfa = #labtraba#73; |QBF aAlfa;
     aAlfa = "<ESTUDIOS>" + aAlfa + "</ESTUDIOS>";
     |HAZ Linea;

     |HAZ Domicilio;

     |HAZ Representante;

     |HAZ DatosAlta;

     nNivel = 2;
     aAlfa = "</TRABAJADOR>";
     |HAZ Linea;

     nNumTra = nNumTra + 1;
|FPRC;

|PROCESO VidaLaboral;
     nNivel = 1;
     aAlfa = "<VIDALABORAL>";
     |HAZ Linea;

     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;

     #labempre#0 = #labtraba#0;
     |LEE 000#labempre.=;

     nNivel = 2;

     aAlfa = #labtraba#7;  |QBF aAlfa;
     aAlfa = "<NIF_NIE>" + aAlfa + "</NIF_NIE>";
     |HAZ Linea;

     aAlfa = #labtraba#75; |QBF aAlfa;
     aAlfa = "<NUMERO_SEGURIDAD_SOCIAL>" + aAlfa + "</NUMERO_SEGURIDAD_SOCIAL>";
     |HAZ Linea;

     aCadena = #labtraba#2;
     |HAZ SeparaNom_plb;

     aAlfa = "<NOMBRE_APELLIDOS>";
     |HAZ Linea;

     nNivel = 3;
     aAlfa = "<NOMBRE>" + eaNom + "</NOMBRE>";
     |HAZ Linea;
     aAlfa = "<PRIMER_APELLIDO>" + eaApel1 + "</PRIMER_APELLIDO>";
     |HAZ Linea;
     aAlfa = "<SEGUNDO_APELLIDO>" + eaApel2 + "</SEGUNDO_APELLIDO>";
     |HAZ Linea;

     nNivel = 2;
     aAlfa = "</NOMBRE_APELLIDOS>";
     |HAZ Linea;

     aAlfa = "";

     |ABRE #labpadre;
     #labpadre#0 = #labtraba#0;
     #labpadre#1 = #labtraba#1;
     |LEE 000#labpadre.=;
     |SI FSalida = 0;
          aAlfa = #labpadre#5;
     |FINSI;
     |CIERRA #labpadre;

     |SI aAlfa = "V"; aAlfa = "1"; |FINSI;
     |SI aAlfa = "M"; aAlfa = "2"; |FINSI;
     aAlfa = "<SEXO>" + aAlfa + "</SEXO>";
     |HAZ Linea;

     aAlfa1 = #labtraba#11; |QBF aAlfa1;
     |SI aAlfa1 ! ""; |Y aAlfa1 ! "          "; |Y aAlfa1 ! "..........";
          aAlfa = (aAlfa1 % -104) + (aAlfa1 % 402) + (aAlfa1 % 102);
     |FINSI;
     aAlfa = "<FECHA_NACIMIENTO>" + aAlfa + "</FECHA_NACIMIENTO>";
     |HAZ Linea;

     aAlfa = #labtraba#76; |QBF aAlfa;
     aAlfa1 = aAlfa % 0599; aAlfa = aAlfa % 0103;
     |SI aAlfa = "ESP";                   aAlfa = "724"; |FINSI;
     |SI aAlfa < "000"; |O aAlfa > "999"; aAlfa = "724"; |FINSI;
     aAlfa = "<NACIONALIDAD>" +  aAlfa + "</NACIONALIDAD>";
     |HAZ Linea;

     aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
     aAlfa = "<CODIGO_POSTAL>" + aCodPos + "</CODIGO_POSTAL>";
     |HAZ Linea;

     aAlfa = #labtraba#73; |QBF aAlfa;
     aAlfa = "<ESTUDIOS>" + aAlfa + "</ESTUDIOS>";
     |HAZ Linea;

     aAlfa = #labtraba#244; |QBF aAlfa;
     aAlfa = "<TELEFONO_MOVIL>" + aAlfa + "</TELEFONO_MOVIL>";
     |HAZ Linea;

     nNivel = 1;
     aAlfa = "</VIDALABORAL>";
     |HAZ Linea;
|FPRC;

|PROCESO Simulador;
     nNivel = 1;
     aAlfa = "<SIMULADOR>";
     |HAZ Linea;

     nNivel = 1;
     aAlfa = "</SIMULADOR>";
     |HAZ Linea;
|FPRC;

|PROCESO Zeus;
     nNivel = 1;
     aAlfa = "<ANEXO1>";
     |HAZ Linea;

     nNivel = 1;
     aAlfa = "</ANEXO1>";
     |HAZ Linea;
|FPRC;

|PROCESO Consulta;
     #labempre#0 = #0#0;
     |LEE 000#labempre.=;

     nNivel = 1;
     aAlfa = "<CONSULTAS>";
     |HAZ Linea;

     |SI nConsulta = 1;
          aAlfa = "CMEMPRESA";
     |FINSI;
     |SI nConsulta = 2;
          aAlfa = "CEAUTORIZADAS";
     |FINSI;
     |SI nConsulta = 3;
          aAlfa = "LISTACERTIFICADOS";
     |FINSI;
     |SI nConsulta = 4;
          aAlfa = "BUSCACERTIFICADO";
     |FINSI;
     |SI nConsulta = 90;
          aAlfa = "SIMULADOR";
     |FINSI;
     |SI nConsulta = 91;
          aAlfa = "ANEXO1";
     |FINSI;

     nNivel = 2;
     aAlfa = "<CONSULTA>" + aAlfa + "</CONSULTA>";
     |HAZ Linea;

     |SI nConsulta = 1;
          aAlfa = #labempre#10;
          |QBF aAlfa;
          nNivel = 2;
          aAlfa = "<CIFNIF>" + aAlfa + "</CIFNIF>";
          |HAZ Linea;
     |FINSI;
     |SI nConsulta = 4;
          aAlfa = #labtraba#7;
          |QBF aAlfa;
          nNivel = 2;
          aAlfa = "<NIFNIE>" + aAlfa + "</NIFNIE>";
          |HAZ Linea;
     |FINSI;

     nNivel = 1;
     aAlfa = "</CONSULTAS>";
     |HAZ Linea;
|FPRC;

|PROCESO EsquemaConsulta;
     |SI nConsulta < 90;
          |HAZ Consulta;
     |SINO;
          |SI nConsulta = 90;
               |HAZ Simulador;
          |FINSI;
          |SI nConsulta = 91;
               |HAZ Zeus;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GeneraXML;
     |ABRE #labcontr;
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;

     |ABRE #labempre;
     |ABRE #labtraba;
     |ABRE #nomvarca;

     aRuta = #labcontr#51;
     |QBF aRuta;
     aAlfa = aRuta % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/";
          aRuta = aRuta + "\";
     |FINSI;
     aRuta = aRuta + "NETCONTRATA\"
     |RMKDIR aRuta;
     aRuta = aRuta + "SSONLINE\"
     |RMKDIR aRuta;

     eaCadena = aRuta;
     eaCaracter1 = "/";
     eaCaracter2 = "\";
     |HAZ sustituye_plb;
     aRuta = eaCadenaSal;


     || segun me dijo Miguel Angel la opcion 3, cambio de grupo de cotizacion
     || pasa a ser la 14, lo he probado y la verdad es que funciona igual
     || de un modo y del otro, pero bueno ... dejo la 14. (25.11.2011)

     ||SI nOpcionSS = 3; nOpcionSS = 14; |FINSI;

     || no acaba de funcionar, no me meto en lios, sigo con la 3

     |SI swEsConsulta = 0;
          aAlfa = nOpcionSS;
     |SINO;
          aAlfa = nConsulta;
          |QBF aAlfa;
          aAlfa = "CO" + aAlfa;
     |FINSI;
     |QBF aAlfa;
     aFichero = "OPCION" + aAlfa;

     aAlfa1 = #0#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#1; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;

     aFichero = aFichero + "_" + aAlfa1 + "_" + aAlfa2;

     fFecha = ~;
     aFecha = fFecha;
     aFecha = (aFecha % 102) + (aFecha % 402) + (aFecha % 904);
     aFichero = aFichero + "_" + aFecha;
     |HORA aHora;
     |QBF aHora;
     aHora = aHora - ":" - ":";
     aFichero = aFichero + "_" + aHora + ".xml";

     aRutaBAT = aRuta + "ejecuta.bat";
     aRuta = aRuta + aFichero;
     |XABRE "CBW", aRuta, nHandle;
     |SI FSalida ] 0;
          aFich = aRuta;

          |SI nOpcionSS = 25;
               |HAZ VidaLaboral;
          |SINO;
               nNivel = 1;
               aAlfa = "<?xml version=" + &34 + "1.0" + &34 + " encoding=" + &34 + "ISO-8859-1" + &34 + " ?>";
               |HAZ Linea;

               |SI swEsConsulta = 1;
                    |HAZ EsquemaConsulta;
               |SINO;
                    aAlfa = "<TRABAJADORES>";
                    |HAZ Linea;

                    |HAZ Trabajadores;

                    nNivel = 1;
                    aAlfa = "</TRABAJADORES>";
                    |HAZ Linea;
               |FINSI;
          |FINSI;

          |CIERRA #nomvarca;
          |CIERRA #labtraba;
          |CIERRA #labempre;
     |SINO;
          aAlfa1 = #labcontr#51;
          |QBF aAlfa1;
          aAlfa1 = aAlfa1 + "\NETCONTRATA\SSONLINE\"
          aAlfa = "    ATENCION. No se ha podido grabar el fichero 'ejecuta.bat' ";
          aAlfa = aAlfa + "en la carpeta " + aAlfa1;
          |MENAV aAlfa;

          aAlfa = #labcontr#51;
          |QBF aAlfa;
          aAlfa = "    Compruebe que la ruta especificada en el Control de la Aplicación";
          aAlfa = aAlfa + " para depositar los ficheros XML, es válida.";
          |MENAV aAlfa;
     |FINSI;
     |XCIERRA nHandle;
|FPRC;

|PROCESO CompRuta;
     aRutaSal = "";
     |QBF aRuta;
     aLon = aRuta % 0;
     nLon = aLon;
     |PARA nPunt = 1; |SI nPunt [ nLon; |HACIENDO nPunt = nPunt + 1;
          nPos = (nPunt * 100) + 1;
          aCaracter = aRuta % nPos;
          |SI aCaracter = "/";
               aRutaSal = aRutaSal + "\";
          |SINO;
               aRutaSal = aRutaSal + aCaracter;
          |FINSI;
     |SIGUE;
     aCaracter = aRutaSal % -101;
     |SI aCaracter ! "\";
          aRutaSal = aRutaSal + "\";
     |FINSI;
     aRuta = aRutaSal;

     eaCadena = aRuta;
     eaCaracter1 = "/";
     eaCaracter2 = "\";
     |HAZ sustituye_plb;
     aRuta = eaCadenaSal;
|FPRC;

|PROCESO Envio;
     |SI swConectaSS = 1;
          aContiene = "";
          |ESPECIFICA "RBASS", aContiene;
          aAlfa = aContiene1;
          |QBF aAlfa;
          aAlfa = aAlfa + "conectass";
          #labcontr#63 = aAlfa;
     |FINSI;

     aRuta = #labcontr#51;
     |QBF aRuta;
     aAlfa = aRuta % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/";        || ruta de los XML
          aRuta = aRuta + "/";
     |FINSI;

     || ruta para errores
     aAlfa1 = #labcontr#63;
     |QBF aAlfa1;
     aAlfa = aAlfa1 % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/";        || ruta de los XML
          aAlfa1 = aAlfa1 + "\";
     |FINSI;

     aAlfa = aAlfa1 + "ERRORES";
     aRutaErrores = aAlfa;

     aAlfa = aRutaErrores + "\ERRORESNET.XML";
     |RFBORRA aAlfa;

     |DBASE aOrigen; |QBF aOrigen;
     aOrigen = aOrigen + "ejecutables/rdn.exe";
     aDestino = #labcontr#63; |QBF aDestino; aDestino = aDestino + "rdn.exe";

     || bien, esto es por el tema del VDesk, que en una maquina virtual pare-
     || cia que no funcionaba bien el ejecutar el rdn en el RSYSTEM directamente
     || asi que lo que hice fue hacer un bat y ejecutar el BAT

     |XABRE "CBW", aRutaBAT, nHandleBAT;

     aAlfa = #labcontr#63; |QBF aAlfa;
     aRuta = aAlfa; |HAZ CompRuta; aAlfa = aRuta;
     aAlfa2 = aAlfa + "ERRORES\";
     aRuta = aAlfa2; |HAZ CompRuta; aAlfa2 = aRuta;

     aUnidad = aAlfa % 102;
     aResto = aAlfa - aUnidad;

     aAlfa = "@echo off" + &13 + &10;
     |XGRABA nHandleBAT, aAlfa;

     aUnidad = aUnidad + &13 + &10;
     |XGRABA nHandleBAT, aUnidad;

     aAlfa = "CD " + aResto + &13 + &10;
     |XGRABA nHandleBAT, aAlfa;

     aAlfa1 = #labcontr#62; |QBF aAlfa1;
     aAlfa = "rdn.exe " + aAlfa1 + " " + aFich + " " + aAlfa2;

     aAlfa = "start " + aAlfa + &13 + &10;
     |XGRABA nHandleBAT, aAlfa;

     |XCIERRA nHandleBAT;
     |RSYSTEM aRutaBAT;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     || examinamos la respuesta que nos da

     nSwEtiq = 0; aEtiqu = ""; aError = ""; nNumChars = 0;
     aAlfa = #labcontr#63; |QBF aAlfa;
     aAlfa = aRutaErrores + "\ERRORESNET.XML";

     |HAZ Registro;
|FPRC;

|PROCESO Motivo; |TIPO 0;
     |SI nOpcionSS = 2;
          |HAZ SacaVentana2;
     |FINSI;
|FPRC;

|PROCESO Nombre;
     |SI swConsultaEmp = 0;
          |ATRI I;

          |ABRE #labempre;
          #labempre#0 = #0#0;
          |LEE 000#labempre.=;
          |PINTA 1230, #labempre#2;
          |CIERRA #labempre;

          |ABRE #labtraba;
          #labtraba#0 = #0#0;
          #labtraba#1 = #0#1;
          |LEE 000#labtraba.=;
          |PINTA 1430, #labtraba#2;
          |CIERRA #labtraba;
          |ATRI R;
     |FINSI;
|FPRC;

|PROCESO Chequea08; |TIPO 0;
     |SI nOpcionSS ! 2;
          |ACABA;
     |FINSI;

     |SI #0Campo = 8; |O #0Campo = 9; |O #0Campo = 10;
          aAlfa = "    Los codigos  08, 09 y 10 son internos para indicar el cambio de contrato. ";
          aAlfa = aAlfa + "No son validos para el Sistema RED";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Centro;
     |SI swConsultaEmp = 1;
          |ATRI I;

          |ABRE #labcentr;
          #labcentr#0 = #0#0;
          #labcentr#1 = #0#7;
          |LEE 000#labcentr.=;
          |PINTA 1327, #labcentr#2;
          |CIERRA #labcentr;
          |ATRI R;
     |FINSI;
|FPRC;

|PROCESO BuscaCen; |TIPO 66;
     |SI swConsultaEmp = 0;
          |ACABA;
     |FINSI;

     |ABRE #labcentr;
     #labcentr#0 = #0#0;
     #labcentr#1 = #0#7;
     |LEE 000#labcentr.=;
     |CONSULTA_CLAVE #1#labcentr;
     |SI FSalida = 0;
          #0#0 = #labcentr#0;
          #0#7 = #labcentr#1;
          |PINTA #0#0;
          |PINTA #0#7;
          |HAZ Centro;
     |FINSI;
     |ERROR;
     |CIERRA #labcentr;
|FPRC;

|PROCESO ValidaCen;
     FEstado = FSalida;
     |SI swConsultaEmp = 0;
          |ACABA;
     |FINSI;

     |ABRE #labcentr;
     #labcentr#0 = #0#0;
     #labcentr#1 = #0#7;
     |LEE 000#labcentr.=;
     |SI FSalida ! 0;
          |MENAV "    Clave inexistente en el fichero de CENTROS";
          |SI FEstado ! 2;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #labcentr;
|FPRC;

|PROCESO BuscaTra; |TIPO 66;
     |SI swConsultaEmp = 1;
          |ACABA;
     |FINSI;

     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |CONSULTA_CLAVE #1#labtraba;
     |SI FSalida = 0;
          #0#0 = #labtraba#0;
          #0#1 = #labtraba#1;
          |PINTA #0#0;
          |PINTA #0#1;
          |HAZ Nombre;
     |FINSI;
     |ERROR;
     |CIERRA #labtraba;
|FPRC;

|PROCESO ValidaTra;
     FEstado = FSalida;
     |SI swConsultaEmp = 1;
          |ACABA;
     |FINSI;

     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |SI FSalida ! 0;
          |MENAV "    Clave inexistente en el fichero de TRABAJADORES";
          #labtraba#2 = "";
          |PINTA 1430, #labtraba#2;
          |SI FEstado ! 2;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO PintaJornada;
     nJornada = 0;
     |SI #0#4 ! 0;
          nJornada = #0#4 / #0#5;
          nJornada = (nJornada * 1000) ! 0;
     |FINSI;

     #0#6 = nJornada
     |PINTA #0#6;
|FPRC;

|PROCESO BuscaCond; |TIPO 66;
     |SI swConsultaEmp = 1;
          |ACABA;
     |FINSI;

     |ABRE #labtab01;
     #labtab01#0 = #0#10;
     |LEE 000#labtab01.=;
     |CONSULTA_CLAVE #1#labtab01;
     |SI FSalida = 0;
          #0#10 = #labtab01#0;
          |PINTA #0#10;
     |FINSI;
     |ERROR;
     |CIERRA #labtab01;
|FPRC;

|PROCESO CompCond;
     |SI swConsultaEmp = 1;
          |ACABA;
     |FINSI;

     |ABRE #labtab01;
     #labtab01#0 = #0#10;
     |LEE 000#labtab01.=;
     |SI FSalida ! 0;
          |MENAV "    ATENCION. Valor no permitido para el campo 'Condición de desempleado'";
          |CONSULTA_CLAVE #1#labtab01;
          |SI FSalida = 0;
               #0#10 = #labtab01#0;
               |PINTA #0#10;
          |FINSI;
          |ERROR;
     |FINSI;
     |CIERRA #labtab01;
|FPRC;

|PROCESO BuscaConv; |TIPO 66;
     |ABRE #nomconve;
     #nomconve#0 = #0#11;
     |LEE 000#nomconve.=;
     |CONSULTA_CLAVE #1#nomconve;
     |SI FSalida = 0;
          #0#11 = #nomconve#0;
          |PINTA #0#11;
     |FINSI;
     |ERROR;
     |CIERRA #nomconve;
|FPRC;

|PROCESO CompConv;
     |SI nOpcionSS ! 10; |Y nOpcionSS ! 17;
          |ACABA;
     |FINSI;

     |ABRE #nomconve;
     #nomconve#0 = #0#11;
     |LEE 000#nomconve.=;
     |SI FSalida ! 0;
          |MENAV "    ATENCION. Valor no permitido para el campo 'Codigo de Convenio'";
          |CONSULTA_CLAVE #1#nomconve;
          |SI FSalida = 0;
               #0#11 = #nomconve#0;
               |PINTA #0#11;
          |FINSI;
          |ERROR;
     |FINSI;
     |CIERRA #nomconve;
|FPRC;

|PROCESO Alta;
     nJornada = 0;

     |SI nOpcionSS ! 1;
          |ACABA;
     |FINSI;

     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |SI #labtraba#42 = "X"; |O #labtraba#42 = "T";
          #0#4 = #labtraba#234;

          |HAZ JornadaMaxima;
          #0#5 = nHorasMax;

          |HAZ PintaJornada;

          |CAMPO_MODIFICA #0#4, 1, "S";
          |CAMPO_MODIFICA #0#5, 1, "S";
          |CAMPO_MODIFICA #0#6, 1, "N";

          |CAMPO_VISUAL #0#4, 1, "S";
          |CAMPO_VISUAL #0#5, 1, "S";
          |CAMPO_VISUAL #0#6, 1, "S";

          |ATRI 0;
          |PINTA 1610, "³ Horas trab:         M ximo horas:         Coeficiente:      ³";

          |PINTA #0#4;
          |PINTA #0#5;
          |PINTA #0#6;
     |SINO;
          |CAMPO_MODIFICA #0#4, 1, "N";
          |CAMPO_MODIFICA #0#5, 1, "N";
          |CAMPO_MODIFICA #0#6, 1, "N";

          |CAMPO_VISUAL #0#4, 1, "N";
          |CAMPO_VISUAL #0#5, 1, "N";
          |CAMPO_VISUAL #0#6, 1, "N";

          |ATRI 0;
          |PINTA 1610, "³                                                             ³";
     |FINSI;

     || para la condicion de desempleado

     |PINTA 1712, "Cond.Desempleado:";
     |CAMPO_MODIFICA #0#10, 1, "S";
     |CAMPO_VISUAL #0#10, 1, "S";
     |PINTA #0#10;


     |CIERRA #labtraba;
|FPRC;

|PROCESO fechafin; |TIPO 0;
     #0#9 = "";
     aAlfa = #0#2;
     fFechaBaja = aAlfa;
     nFechaBaja = fFechaBaja;
     |SI #0#8 > 0;
          nFechaFin = nFechaBaja + #0#8;
          fFechaFin = nFechaFin;
          aFechaFin = fFechaFin;
          #0#9 = aFechaFin;
     |FINSI;
     |PINTA #0#9;
|FPRC;

|PROCESO finiquito; |TIPO 0;
     #0#8 = 0;
     aAlfa = #0#2;
     fFechaBaja = aAlfa;
     aDiaBaja = aAlfa % 102;
     aMesBaja = aAlfa % 402;
     aAnyBaja = aAlfa % -104;
     nMesBaja = aMesBaja;
     nAnyBaja = aAnyBaja;
     nAnyBusca = nAnyBaja - 2000;

     |ABRE #nomcalli;
     |ABRE #nomhicli;
     #nomcalli#0 = #0#0;
     #nomcalli#1 = #0#1;
     #nomcalli#2 = nMesBaja;
     #nomcalli#3 = 2;
     #nomcalli#4 = 125;
     |LEE 000#nomcalli.=;
     |SI FSalida = 0;
          #0#8 = (#nomcalli#11 + 0.49) ! 0;
     |SINO;
          #nomhicli#0 = #0#0;
          #nomhicli#1 = #0#1;
          #nomhicli#12 = nAnyBusca;
          #nomhicli#2 = nMesBaja;
          #nomhicli#3 = 2;
          #nomhicli#4 = 125;
          |LEE 000#nomhicli.=;
          |SI FSalida = 0;
               #0#8 = (#nomhicli#11 + 0.49) ! 0;
          |FINSI;
     |FINSI;

     |HAZ fechafin;

     |PINTA #0#8;
     |PINTA #0#9;

     |CIERRA #nomcalli;
     |CIERRA #nomhicli;
|FPRC;

|PROCESO BajaLabtraba;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;

     #0#2 = #labtraba#37;
     |PINTA #0#2;

     aAlfa = #labtraba#184;
     aAlfa = aAlfa % 102;
     aAlfa = aAlfa + "        ";

     |ABRE #motibaja;
     #motibaja#0 = aAlfa;
     |LEE 000#motibaja.=;
     |SI FSalida = 0;
          aAlfa = aAlfa % 102;
          #0#3 = aAlfa;
          |PINTA #0#3;
     |FINSI;
     |CIERRA #motibaja;

     |CIERRA #labtraba;
|FPRC;

|PROCESO Baja;
     |SI nOpcionSS ! 2;
          |ACABA;
     |FINSI;

     #0#2 = "";
     #0#3 = 00;
     #0#8 = 00;
     #0#9 = "";
     |PINTA #0#2;
     |PINTA #0#3;
     |PINTA #0#8;
     |PINTA #0#9;

     fFecha = ~;
     aFecha = fFecha;
     aMes = aFecha % 402;
     nMes = aMes;

     swEncontrado = 0;
     nVez = 0;

     |ABRE #nomvarca;

     #nomvarca#0 = #0#0;
     #nomvarca#1 = #0#1;
     #nomvarca#3 = 0;
     |PARA; |SI; |HACIENDO nMes = nMes - 1;
          |SI nMes = 0;
               nMes = 12;
          |FINSI;
          nVez = nVez + 1;
          #nomvarca#2 = nMes;
          |LEE 000#nomvarca.=;
          |SI FSalida = 0; |O nVez = 3;
               |SI FSalida = 0;
                    aAlfa = #nomvarca#16;
                    |QBF aAlfa;
                    |SI aAlfa ! "";
                         #0#2 = aAlfa;
                         |PINTA #0#2;
/*
                         #0#3 = #nomvarca#46;
                         |PINTA #0#3;
*/
                         swEncontrado = 1;
                    |FINSI;
               |FINSI;
               |SAL;
          |FINSI;
     |SIGUE;
     |CIERRA #nomvarca;

     |SI swEncontrado = 0;
          |HAZ BajaLabtraba;
     |FINSI;

     |HAZ finiquito;

     |ATRI 0;
     |CAMPO_MODIFICA #0#2, 1, "S";
     |CAMPO_VISUAL #0#2, 1, "S";
     |CAMPO_MODIFICA #0#3, 1, "S";
     |CAMPO_VISUAL #0#3, 1, "S";
     |PINTA 1510, "³ Fecha Baja:                                 Causa Baja:     ³";

     |CAMPO_MODIFICA #0#8, 1, "S";
     |CAMPO_VISUAL #0#8, 1, "S";
     |CAMPO_POSICION #0#8, 1, 1624;
     |CAMPO_MODIFICA #0#9, 1, "S";
     |CAMPO_VISUAL #0#9, 1, "S";
     |CAMPO_POSICION #0#9, 1, 1660;
     |PINTA 1610, "³ D¡as vacac:                   Fecha fin vacac.:             ³";
     |ATRI I;
     |PINTA #0#2;
     |PINTA #0#3;
     |PINTA #0#8;
     |PINTA #0#9;
     |ATRI R;
|FPRC;

|PROCESO Pantalla;
     |PINPA #0#0;

     |HAZ PintaCabecera;

     |PINDA #0#0;
     |SI swConsultaEmp = 0;
          |SI aTrabajador ! "";         || vengo de fuera
               || no tengo que pedir trabajador, claro
          |SINO;
               |CAMPO_MODIFICA #0#1, 1, "S";
          |FINSI;
          |CAMPO_VISUAL #0#1, 1, "S";
          |PINTA 1410, "³ Trabajador: ";
          |PINTA #0#1;
          |HAZ Nombre;
     |SINO;
          |CAMPO_MODIFICA #0#7, 1, "S";
          |CAMPO_VISUAL #0#7, 1, "S";
          |PINTA 1310, "³ Centro ...: ";
          |PINTA #0#7
          |HAZ Centro;
     |FINSI;

     |SI nOpcionSS = 10; |O nOpcionSS = 17;
          |CAMPO_MODIFICA #0#11, 1, "S";
          |CAMPO_VISUAL #0#11, 1, "S";
          |ATRI 0;
          |PINTA 1510, "³ Convenio..: ";
          |ATRI 0;
          |CAMPO_POSICION #0#11, 1, 1524;
          |PINTA #0#11;
     |FINSI;

     |ENDATOS #1#0;
|FPRC;

|PROGRAMA;
     |CAMPO_MODIFICA #0#3, 1, "N";      || lo pongo aqui porque no puedo
     |CAMPO_VISUAL #0#3, 1, "N";        || dejarlo a "NO" desde el DEF
                                        || ya que el campo esta relacionado
     swConsultaEmp = 0;
     swConsultaTra = 0;

     swEsConsulta = 0;
     nConsulta = 0;

     aParam = PARAMETRO;
     |QBF aParam;

     aOpcionSS = aParam % 102;
     |QBF aOpcionSS;
     |SI aOpcionSS = "CO";
          swEsConsulta = 1;
          aAlfa = aParam % 302;
          nConsulta = aAlfa;
          aTrabajador = aParam % 510;
     |SINO;
          nOpcionSS = aOpcionSS;
          aTrabajador = aParam % 310;
          |QBF aTrabajador;
     |FINSI;

     swSigue = 0;
     |SUB_EJECUTA "labnct00";
     |SI swSigue = 0;
          |ACABA;
     |FINSI;
     |SI swSigue = 2;
          swConectaSS = 1;
     |FINSI;

     |SI aTrabajador ! "";         || vengo de fuera

          |SI nOpcionSS = 6; |O nOpcionSS = 9; |O nOpcionSS = 11; |O nOpcionSS = 13;
          |O nOpcionSS = 15; |O nOpcionSS = 10; |O nOpcionSS = 18; |O nOpcionSS = 19;
               swConsultaEmp = 1;
               aEmp = aTrabajador % 105;
               aCen = aTrabajador % 605;
               nEmp = aEmp;
               nCen = aCen;
               #0#0 = nEmp;
               #0#7 = nCen;
               |ABRE #labcentr;
               #labcentr#0 = #0#0;
               #labcentr#1 = #0#7;
               |LEE 000#labcentr.=;
               |CIERRA #labcentr;
          |SINO;
               aEmp = aTrabajador % 105;
               aTra = aTrabajador % 605;
               nEmp = aEmp;
               nTra = aTra;
               #0#0 = nEmp;
               #0#1 = nTra;
               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 000#labtraba.=;
               |CIERRA #labtraba;
          |FINSI;
     |SINO;
          eaVengoDe = "labnct07";
     |FINSI;

     |CLS;

     swPantalla = 1;
     swEjecuta = 1;
     |SI eaVengoDe = "labtraba"; |O eaVengoDe = "nomvartr"; |O eaVengoDe = "laborn01";
          |SI nOpcionSS = 1;
               || condicion de desempleado
               swPantalla = 1;
               |CAMPO_MODIFICA #0#0, 1, "N";
               |CAMPO_MODIFICA #0#1, 1, "N";
          |FINSI;
          |SI nOpcionSS = 2;
               |HAZ BajaLabtraba;

               swPantalla = 1;
               |CAMPO_MODIFICA #0#0, 1, "N";
               |CAMPO_MODIFICA #0#1, 1, "N";
          |FINSI;
          |SI nOpcionSS = 3;  || cambio grupo de cotizacion
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 4;  || cambio contrato
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 5;  || Consulta de Situacion del afiliado
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 7;  || Consulta de Numero de Afiliacion
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 8;  || Duplicados de Documentos TA
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 25;  || Vida Laboral
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 16;  || Cambio de ocupacion
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 17;  || Anotacion de convenio (trabajador)
               |CAMPO_MODIFICA #0#0, 1, "N";
               |CAMPO_MODIFICA #0#1, 1, "N";
          |FINSI;
          |SI nOpcionSS = 12;  || IDC
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 18;  || IDC Periodo-CCC
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 20;  || Suspensiones prestaciones corta duracion
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 21;  || IDC Periodo
               swPantalla = 0;
          |FINSI;
          |SI nOpcionSS = 22;  || IDC Relacion Laboral
               swPantalla = 0;
          |FINSI;

     |FINSI;
     |SI eaVengoDe = "labempre";
          |SI swConsultaEmp = 1;
               swPantalla = 1;
               |CAMPO_MODIFICA #0#0, 1, "N";
          |FINSI;
     |FINSI;
     |SI eaVengoDe = "labcentr";
          |SI swConsultaEmp = 1;
               swPantalla = 0;
          |FINSI;
     |FINSI;
     |SI swEsConsulta = 1;
          swPantalla = 0;
     |FINSI;
     |SI nOpcionSS = 19;
          swPantalla = 0;
     |FINSI;
     |SI swPantalla = 1;
          |HAZ Pantalla;
          |SI FSalida ! 0;
               swEjecuta = 0;
          |FINSI;
     |FINSI;

     |SI swEjecuta = 1;
          swEnviado = 1;
          |HAZ GeneraXML;
          |HAZ Envio;
     |FINSI;
|FPRO;
