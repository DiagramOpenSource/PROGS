|FICHEROS;
    labcerag #0;
    labempre #1;    || empresas
    labtraba #2;    || trabajadores
    nomhicli #3;    || historico lins.
    labcentr #4;    || centros
    labpadre #5;    || datos aux. trabajador
    nomhicca #6;    || historico cabs.
     nomcalca;
     nomcalli;
    silcon06 #30;   || para recoger autorizacion silcon

    ||adrian: impresion pdf
     contrato;
     nomregim;
     labacuer;
     labconre;
     labaux01;

     pdfdocca;
     pdfdocli;
     pdfimtmp #100;

     labcon00 #66;
     labvaltb;
     taiclaoc;

     labhisce #1000;
     labcontr;
     labnct10;
     gomccchi;
     nomcenes;
|FIN;

|VARIABLES;
   &enSwError = 0;

    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    sw_rup = 0;

    dmes = 0;
    hmes = 0;
    cany = 0;
    cmes = 0;
    bany = 0;
    bmes = 0;
    hasta = 0;
    sw_fuerza = 0;
    &domemp = "";
    &domtra = "";
    &domcen = "";
    &estado = "";
    direcc = "";
    numero = "";
    piso = "";
    compactado = "";
    locali = "";
    barra = "/";
    coma = ",";

    &silcon1 = "";
    &silcon2 = "";
    &silcon3 = "";
    &silcon4 = "";
    &silcon5 = "";


     || adrian: variables para impresion pdf
     nSuma = 0;
     &aProcedencia = "";
     &aArchivo = "";
     swCarga = 0;
     aValor = "";
     aCampo = "";
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     &aID = "";

||     &domemp = "";

     &des = "";
     &has = "";
     &tiporet = ""; || Tipo Retribucion
     &dia = "";     || dia firma
     &mes = "";     || mes firma
     &anyo = "";    || a¤o firma

     nAscii = 0;
     aCaracter = "";
     aCaracterSal = "";
     aCadena = "";
     aCadenaSal = "";
     aLongitud = "";
     nLongitud = 0;
     nPos = 0;
     nBusca = 0;

     &dura = "";
     nCampo = 0;
     nCampo1 = 0;
     nCampo2 = 0;

     &hora2 = 0;
     &swCopia = 0;
     nNume = 0;
     aNume = "";
     nLimiteClau = 0;
     &swAnexoClaus = 0;
     &swDondeEstoy = 0;
     &aListaFich = "";
     nLimReal = 0;
     &swAnexoHoras = 0;  || flag  si 1 -> se hace anexo de horas complementarias para el cto. indef. a T/P sobre pacto de horas compl.
     &swAnexoRelevo = 0; || flag  si 1 -> se hace anexo del contrato de relevo
     &swCopiaBasica = 2; || flag  si 1 -> no se hace copia basica;  si 2 -> se hace copia basica
     &aTipoContr = "";   || tipo de contrato del anexo de relevo
     nTipo = 0;
     &topeclaus = 0;
     nDesd = 0;
     nHast = 0;
     swAnyoAnt = 0;
     nDesd_ant = 0;
     nHast_ant = 0;


     &nAnyo1 = 0;
     &nAnyo2 = 0;
     &nAnyo3 = 0;
     &nAnyo4 = 0;
     &nAnyo5 = 0;
     &nAnyo6 = 0;
     &nAnyo7 = 0;

     &nMes1 = 0;
     &nMes2 = 0;
     &nMes3 = 0;
     &nMes4 = 0;
     &nMes5 = 0;
     &nMes6 = 0;
     &nMes7 = 0;

     &nanyo = 0;
     nanyo_ant = 0;
     nmes = 0;
     nMess = 0;
     nCamp = 0;
     aObservacion = "";
     aObservacion1 = "";
     aObservacion2 = "";
     aObservacion3 = "";
     mes_ini = 0;

     verrfec = "0000ATENCION !! Fecha erronea o formato incorrecto ";
     vdia1 = "";
     vme1 = "";
     vany1 = "";
     vdia = 0;
     vme = 0;
     vany = 0;
     vtope = 0;
     vsw = 0;
     vfec = "";
     vblanco = "          ";
     vpuntos = "..........";
     mod = 0;
     meslet = "";
     fec2 = 0;

     aCampoJor = "";
     aCampoGru = "";
     aCampoAny = "";
     aCampoMes = "";
     nLinea = 0;

     aDuracion = "";
     aDiaAlta = "";
     aMesAlta = "";
     aAnyAlta = "";
     aDiaBaja = "";
     aMesBaja = "";
     aAnyBaja = "";

     nDiaAlta = 0;
     nMesAlta = 0;
     nAnyAlta = 0;
     nDiaBaja = 0;
     nMesBaja = 0;
     nAnyBaja = 0;

     nAnys = 0;
     nMeses = 0;
     nDias = 0;
     aDias = "";
     aMeses = "";
     aAnys = "";

     xmesnume = 0;
     xanynume = 0;
     xtopemes = 0;
     xmod = 0;
     &eaVengoDe = "";

     nNumero  = 0;
     nCalc    = 0;
     nCalc1   = 0;
     aRes     = "";
     nNumCmp  = 0;
     nCont    = 0;
     swGraba1 = 0;
     swGraba2 = 0;
     aCampoDias = "";
     aParam = "";
     aParam1 = "";
     &aFechaBaja = "";
     fFecha = @;
     aHora = "";

     aEmision = "";
     &aRegimen = "";
     &enEmp = 0;
     &enTra = 0;
     &enSwHisto = 0;
     swDatosHis = 0;
     nOpcion = 0;
     aMensa = "";
     &aPath = "";
     &eaFichero = "";
     &swNetContrata = 0;
     &aAntCCC = "";
     aUsuario = "";
     aFecha = "";
     aFechaRef = "";
     nBase = 0;
     swMen = 0;
     swHis = 0;
     nNume2 = 0;
     aCampoBas = "";
     nPrimerCampo = 0;
     nDiasIni = 0;
     nSobran = 0;
     nNume1 = 0;
     nBaseDiaria = 0;
     nValor = 0;
     nAny = 0;
     nMes = 0;
|FIN;
____________________________________/ CALCULOS DE PANTALLA
|PROCESO CompTraAgr;
     |SI #labtraba#247 ! 613; |Y #labtraba#247 ! 163;
          aAlfa = "    ATENCION. El trabajador NO pertenece al Régimen Agrario.";
          |MENAV aAlfa;
          aAlfa = "    Utilice la opción 'Certificado Empresa Régimen General'.";
          |MENAV aAlfa;
          |PTEC 807;
     |SINO;
          |HAZ Recupera;
     |FINSI;
|FPRC;

|PROCESO PreSaca;
     eaVengoDe = "";
|FPRC;

|PROCESO fechacon1; |TIPO 0;
     vfec = #0Campo; vsw = 0;
     |SI vfec ! vblanco; |Y vfec ! vpuntos;
          vdia1 = vfec % A102;
          vme1 = vfec % A402;
          vany1 = vfec % A704;
          vdia = vdia1; vme = vme1; vany = vany1;
          |SI vdia ! 0; |Y vme ! 0; |Y vany > 1900;
               |SI vme [ 12; |Y vme ] 1;
                    |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7;
                    |O vme = 8; |O vme = 10; |O vme = 12;
                         vtope = 31;
                    |SINO;
                         |SI vme = 2;
                              mod = vany $ 4;
                              |SI mod = 0;
                                   vtope = 29;
                              |SINO;
                                   vtope = 28;
                              |FINSI;
                         |SINO;
                              vtope = 30;
                         |FINSI;
                    |FINSI;
                    |SI vdia [ vtope;
                         vsw = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          vsw = 1;
     |FINSI;
     |SI vsw = 0;
          |MENAV verrfec;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO fechablanco;
     alfa1 = #0#4;
     |QBF alfa1;
     |SI alfa1 = ""; |O alfa1 = "..........";
          |MENAV "    ATENCION: es necesario indicar la fecha de baja";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO mayus; |TIPO 0;
    #0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO Activa102; |TIPO 7;
/*
     |SI #0#97 = 0;
          |CAMPO_MODIFICA #0#102, 1, "N";
          #0#102 = 0;
          |PINTA #0#102;
     |SINO;
          |CAMPO_MODIFICA #0#102, 1, "S";
     |FINSI;
*/
|FPRC;

|PROCESO FechaBaja; |TIPO 7;
     |ABRE #2;
     #2#0 = #0#0;
     #2#1 = #0#1;
     |LEE 000#2=;
     |SI #2#37 ! "          "; |Y #2#37 ! "..........";
          |SI #0#4 = "          "; |O #0#4 = "..........";
               #0#4 = #2#37;
               |PINTA #0#4;
          |FINSI;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO def_fecha; |TIPO 7;
     |ACABA;
     |SI elsw1 = 0;
          |DDEFECTO #2;
          |ABRE #2;
          #2#0 = #0#0;
          #2#1 = #0#1;
          |LEE 000#2=;
          |SI #2#37 ! "          ";|Y #2#37 ! "..........";
               #0#4 = #2#37;
               |PINTA #0#4;
          |FINSI;

          || esto era para que se cargaran las jornadas directamente antes
          || de entrar en el campo fecha de baja, no tiene demasiado sentido
          || y me molesta a la hora de cargar certificados guardados en el
          || historico, lo quito de momento, las jornadas se cargaran solo
          || despues de pasar por el campo fecha (si este se modifica) que es
          || lo mas normal

          sw_fuerza = 1;
          |HAZ carga_meses;

          sw_fuerza = 0;
          |CIERRA #2;
          elsw1 = 1;
     |FINSI;
|FPRC;

|PROCESO totaliza; |TIPO 0;
/*    #0#90=#0#12+#0#13+#0#14+#0#15+#0#16+#0#17+#0#18+#0#19+#0#20+#0#21+#0#22+#0#23;
    #0#91=#0#24+#0#25+#0#26+#0#27+#0#28+#0#29+#0#30+#0#31+#0#32+#0#33+#0#34+#0#35;
    #0#92=#0#36+#0#37+#0#38+#0#39+#0#40+#0#41+#0#42+#0#43+#0#44+#0#45+#0#46+#0#47;
    #0#93=#0#48+#0#49+#0#50+#0#51+#0#52+#0#53+#0#54+#0#55+#0#56+#0#57+#0#58+#0#59;

    #0#94=#0#60+#0#61+#0#62+#0#63+#0#64+#0#65+#0#66+#0#67+#0#68+#0#69+#0#70+#0#71;
    #0#95=#0#72+#0#73+#0#74+#0#75+#0#76+#0#77+#0#78+#0#79+#0#80+#0#81+#0#82+#0#83;
    #0#96=#0#90+#0#91+#0#92+#0#93+#0#94+#0#95;
*/
     nSuma = 0;
     |PARA para1 = nDesd_ant; |SI para1 [ nHast_ant; |HACIENDO para1 = para1 + 1;
          nSuma = nSuma + #0para1;
     |SIGUE;
     #0#94 = nSuma;

     nSuma = 0;
     |PARA para1 = nDesd; |SI para1 [ nHast; |HACIENDO para1 = para1 + 1;
          nSuma = nSuma + #0para1;
     |SIGUE;
     #0#95 = nSuma;
     nSuma = 0;

     || #0#96=#0#90+#0#91+#0#92+#0#93+#0#94+#0#95;
     #0#96 = #0#90 + #0#91 + #0#92 + #0#93 + #0#94 + #0#95 + #0#102;

     |PINDA #0#0;
|FPRC;
____________________________________/ CALCULOS PARA INFORME
|PROCESO estado;
    estado = "";
|DDEFECTO #5;
|ABRE #5;
    #5#0 = #0#0;
    #5#1 = #0#1;
|LEE 000#5=;
|SI FSalida = 0;
    |SI #5#4 = "C"; estado = "CASADO/A";  |FINSI;
    |SI #5#4 = "S"; estado = "SOLTERO/A"; |FINSI;
|FINSI;
|CIERRA #5;
|FPRC;

|PROCESO domicili;                    || RUTINA DEL CALCULO actualiz
     direcc = #1#3;                    || PARA CONSTRUCCION DOMICILIOS
     numero = #1#4;
     piso = #1#5;
     locali = "";
     |HAZ compac;
     domemp = compactado;              || domicilio empresa

     direcc = #2#3;
     numero = #2#4;
     piso = #2#5;
     locali = "";
     |HAZ compac;
     domtra = compactado;              || domicilio trabajador

     |SI #1#3 ! #4#3; |O #1#4 ! #4#4; |O #1#5 ! #4#5;
          direcc = #4#3;
          numero = #4#4;
          piso = #4#5 + " " + barra + " ";
          locali = #4#6;
          |HAZ compac;
          domcen = compactado;              || domicilio centro trabajo
     |FINSI;
|FPRC;

|PROCESO compac;                      || SUBRUTINA DE RUTINA domicili
    compactado = "";                  || DE COMPACTACION DE CAMPOS
|QBF direcc;
|QBF numero;
|QBF piso;
|QBF locali;
    compactado = direcc + coma + " ";
    compactado = compactado + numero;
    compactado = compactado + " - ";
    compactado = compactado + piso;
    compactado = compactado + " " + locali;
|FPRC;

|PROCESO lee_empre;
|DDEFECTO #1;
|ABRE #1;
    #1#0 = #0#0;
|LEE 000#1=;

/*
    alfa1 = #1#6;
|QBF alfa1;
    alfa1 = "                              " + alfa1;
    alfa1 = alfa1 % -130;
    #1#6 = alfa1;
*/

|CIERRA #1;
|FPRC;

|PROCESO lee_traba;
|DDEFECTO #2;
|ABRE #2;
    #2#0 = #0#0;
    #2#1 = #0#1;
|LEE 000#2=;
|CIERRA #2;
|FPRC;

|PROCESO lee_centr_ag;
|DDEFECTO #4;
|ABRE #4;
    #4#0 = #2#0;
    #4#1 = #2#77;
|LEE 000#4=;
|CIERRA #4;
|HAZ BuscaCCCCen;
|FPRC;

|PROCESO Bases;
     nBase = 0;
     |SI swMen = 1;
          |SI #labtraba#42 = "A";
               nBase = #nomcalca#40 + #nomcalca#117;
               nBase = nBase - #nomcalca#41 - #nomcalca#42;
          |FINSI;

          |SI #labtraba#42 = "E";
               #nomcalca#0 = #nomcalli#0;
               #nomcalca#1 = #nomcalli#1;
               #nomcalca#2 = #nomcalli#2;
               #nomcalca#3 = #nomcalli#3;
               #nomcalca#4 = #nomcalli#4;
               |LEE 000#nomcalca.=;
               |SI FSalida = 0;
                    nBase = #nomcalca#40 + #nomcalca#117;
                    nBase = nBase - #nomcalca#41 - #nomcalca#42;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI swHis = 1;
          |SI #labtraba#42 = "A";
               nBase = #nomhicca#40 + #nomhicca#159;
               nBase = nBase - #nomhicca#41 - #nomhicca#42;
          |FINSI;

          |SI #labtraba#42 = "E";
               #nomhicca#0 = #nomhicli#0;
               #nomhicca#1 = #nomhicli#1;
               #nomhicca#2 = #nomhicli#2;
               #nomhicca#3 = #nomhicli#3;
               #nomhicca#4 = #nomhicli#4;
               #nomhicca#66 = #nomhicli#12;
               |LEE 000#nomhicca.=;
               |SI FSalida = 0;
                    nBase = #nomhicca#40 + #nomhicca#159;
                    nBase = nBase - #nomhicca#41 - #nomhicca#42;
               |FINSI;
          |FINSI;
     |FINSI;
     |PARA nCampo = 126; |SI nCampo [ 138; |HACIENDO nCampo = nCampo + 2;
          aAlfa = #0nCampo;
          |QBF aAlfa;
          |SI aAlfa = "";
               aAlfa1 = cmes; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
               nNume2 = cany;
               nNume2 = nNume2 + 2000;
               aAlfa2 = nNume2; |QBF aAlfa2;

               aAlfa = aAlfa2 + aAlfa1;

               nCampo2 = nCampo + 1;
               #0nCampo = aAlfa;
               #0nCampo2 = nBase;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO BuscaJorDias;
     swMen = 0;
     swHis = 0;
     |SI #labtraba#42 = "E";
          |SI nume1 [ hasta;
               #3#2 = cmes;
               #3#3 = 0;
               #3#4 = 903;
               |LEE 000#3=;
               |SI FSalida = 0;
                    #0para2 = #3#9;     || nro. de jornadas
               |FINSI;
               #3#4 = 922;
               |LEE 000#3=;
               |SI FSalida = 0;
                    #0para2 = #0para2 + #3#9;     || nro. de jornadas
               |FINSI;
               |SI #0para2 ! 0;
                    swHis = 1;
                    |HAZ Bases;
               |FINSI;
          |FINSI;
          |SI #0para2 = 0;
               |SI nume1 = hasta;       || si es el ultimo mes
                    #nomcalli#0 = #0#0;   || si no esta en el historico busco
                    #nomcalli#1 = #0#1;   || en el mensual
                    #nomcalli#2 = cmes;
                    #nomcalli#3 = 0;
                    #nomcalli#4 = 903;
                    |LEE 000#nomcalli.=;
                    |SI FSalida = 0;
                         #0para2 = #nomcalli#9;     || nro. de jornadas
                    |FINSI;
                    #nomcalli#4 = 922;
                    |LEE 000#nomcalli.=;
                    |SI FSalida = 0;
                         #0para2 = #0para2 + #nomcalli#9;
                    |FINSI;
                    swMen = 1;
                    |HAZ Bases;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nume1 [ hasta;
               #6#2 = cmes;
               #6#3 = 0;
               |LEE 000#6=;
               |SI FSalida = 0;
                    #0para2 = #6#8;     || nro. de dias
                    swHis = 1;
                    |HAZ Bases;
               |FINSI;
          |FINSI;
          |SI #0para2 = 0;
               |SI nume1 = hasta;       || si es el ultimo mes
                    #nomcalca#0 = #0#0;   || si no esta en el historico busco
                    #nomcalca#1 = #0#1;   || en el mensual
                    #nomcalca#2 = cmes;
                    #nomcalca#3 = 0;
                    |LEE 000#nomcalca.=;
                    |SI FSalida = 0;
                         #0para2 = #nomcalca#8;     || nro. de jornadas
                         swMen = 1;
                         |HAZ Bases;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Topea180;
     nNume = 0;
     nPrimerCampo = 0;
     |PARA nCampo = 60; |SI nCampo [ 83; |HACIENDO nCampo = nCampo + 1;
          |SI #0nCampo ! 0; |Y nPrimerCampo = 0;
               nPrimerCampo = nCampo;
          |FINSI;
          nNume = nNume + #0nCampo;
     |SIGUE;
     nNume1 = 180 - nNume;
     |SI nNume1 < 0;
          nSobran = nNume1 * (-1);
     |FINSI;
     |SI nSobran > 0;
          nDiasIni = #0nPrimerCampo;
          nBaseDiaria = #0#127 / nDiasIni;
          #0nPrimerCampo = #0nPrimerCampo - nSobran;
          #0#127 = #0nPrimerCampo * nBaseDiaria;
     |FINSI;
|FPRC;

|PROCESO carga_histor;

||AAA
     hasta = (bany * 100) + bmes;
     nDesd = bmes-6;
     nHast = bmes;
     swAnyoAnt = 0;
     mes_ini = nDesd;

     |SI nDesd < 1;
          swAnyoAnt = 1;
          nDesd_ant = 12 + nDesd;
          nHast_ant = 12;
          nDesd = 1;
          mes_ini = nDesd_ant;
     |FINSI;

     |ABRE #nomcalca;
     |ABRE #nomcalli;
     |ABRE #3;
     |ABRE #6;
     #3#0 = #0#0;
     #3#1 = #0#1;
     #6#0 = #0#0;
     #6#1 = #0#1;


     |PARA para1 = 88; |SI para1 [ 89; |HACIENDO para1 = para1 + 1;
          cany = #0para1 $ 100;
          #3#12= cany;
          #6#66= cany;

       || dmes = ((para1 - 84) * 12) + 12;
       || hmes = ((para1 - 84) * 12) + 23;

          |SI para1 = 88;
               dmes = ((para1 - 84) * 12) + 12 + nDesd_ant - 1;
               hmes = ((para1 - 84) * 12) + 23;
               nDesd_ant = dmes;
               nHast_ant = hmes;
          |SINO;
               |SI nDesd = 1;
                    dmes = ((para1 - 84) * 12) + 12;
                    mes_ini = 1;
               |SINO;
                    dmes = ((para1 - 84) * 12) + 12 + nDesd -1;
               |FINSI;
               hmes = ((para1 - 84) * 12) + 23 - (12 - nHast);

               nDesd = dmes;
               nHast = hmes;
          |FINSI;
          |PARA para2 = dmes; |SI para2 [ hmes; |HACIENDO para2 = para2 + 1;
               || cmes = (para2 - dmes) + 1;
               cmes = (para2 - dmes) + mes_ini;
               nume1 = (#0para1 * 100) + cmes;
               #0para2 = 0;

               |HAZ BuscaJorDias;
          |SIGUE;
     |SIGUE;
     |CIERRA #3;
     |CIERRA #6;
     |CIERRA #nomcalca;
     |CIERRA #nomcalli;
     |SI #labtraba#42 = "A";
          |HAZ Topea180;
     |FINSI;
|FPRC;

|PROCESO cero_meses;
     |PARA para1 = 60; |SI para1 [ 83; |HACIENDO para1 = para1 + 1;
          #0para1 = 0;
          |PINTA #0para1;
     |SIGUE;
     |PARA nCampo = 126; |SI nCampo [ 138; |HACIENDO nCampo = nCampo + 2;
          nCampo1 = nCampo + 1;
          #0nCampo = "";
          #0nCampo1 = 0;
     |SIGUE;
|FPRC;

|PROCESO activa_meses; |TIPO 0;
     |SI aEmision ! "XML";
          |MENSA "    Leyendo jornadas desde historico ...";
     |FINSI;

     || primero pongo todos a cero


     alfa1 = #0#4;   alfa1 = alfa1 % 402;     bmes = alfa1;
     nDesd = bmes - 6;
     nHast = bmes;
     swAnyoAnt = 0;

     |SI nDesd < 1;
          swAnyoAnt = 1;
          nDesd_ant = 12 + nDesd;
          nHast_ant = 12;
          nDesd = 1;
     |FINSI;

     dmes = ((88 - 84) * 12) + 12 + nDesd_ant - 1;
     hmes = ((88 - 84) * 12) + 23;
     nDesd_ant = dmes;
     nHast_ant = hmes;

     ||PARA EL A¤O ANTERIOR 1§ LOS PONGO TODOS DISABLE
     |PARA para1 = 60; |SI para1 [ 71; |HACIENDO para1 = para1 + 1;
          |CAMPO_MODIFICA #0para1, 1, "N";
     |SIGUE;

     ||2§ POGO ENABLE SOLO LOS QUE TOCA
     |PARA para1 = nDesd_ant; |SI para1 [ nHast_ant; |HACIENDO para1 = para1 + 1;
          |CAMPO_MODIFICA #0para1, 1, "S";
     |SIGUE;

     |SI nDesd = 1;
          dmes = ((89 - 84) * 12) + 12;
     |SINO;
          dmes = ((89 - 84) * 12) + 12 + nDesd -1;
     |FINSI;
     hmes = ((89 - 84) * 12) + 23 - (12 - nHast);

     nDesd = dmes;
     nHast = hmes;

     ||PARA EL A¤O ACTUAL 1§ LOS PONGO TODOS DISABLE
     |PARA para1 = 72; |SI para1 [ 83; |HACIENDO para1 = para1 + 1;
          |CAMPO_MODIFICA #0para1, 1, "N";
     |SIGUE;

     ||2§ POGO ENABLE SOLO LOS QUE TOCA
     |PARA para1 = nDesd; |SI para1 [ nHast; |HACIENDO para1 = para1 + 1;
          |CAMPO_MODIFICA #0para1, 1, "S";
     |SIGUE;

     alfa1 = #0#4;   alfa1 = alfa1 % -104;    bany = alfa1;
     #0#89 = bany;
     #0#88 = #0#89 - 1;
     #0#87 = #0#88 - 1;
     #0#86 = #0#87 - 1;
     #0#85 = #0#86 - 1;
     #0#84 = #0#85 - 1;

     alfa1 = #0#4;   alfa1 = alfa1 % 402;     bmes = alfa1;
     |PARA para1 = bmes + 1; |SI para1 [ 12; |HACIENDO para1 = para1 + 1;
          para2 = para1 + 71;
          |CAMPO_MODIFICA #0para2, 1, "N";
     |SIGUE;

     |SI aEmision ! "XML";
          |BLIN 4;
     |FINSI;
|FPRC;

|PROCESO carga_meses;
     alfa1 = Contenido;
     |SI alfa1 ! #0#4;|O sw_fuerza = 1;
          |HAZ cero_meses;
          |HAZ activa_meses;
          |HAZ carga_histor;
          |HAZ totaliza;
     |FINSI;
|FPRC;

|PROCESO lee_silcon;
    silcon1 = "";
    silcon2 = "";
    silcon3 = "";
    silcon4 = "";
    silcon5 = "";
|DDEFECTO #30;
|ABRE #30;
    #30#0 = #0#0;
|LEE 000#30=;
|SI FSalida = 0;
        silcon1 = "(NO ACOMPA¥A TC2/8" + &59;
        silcon2 = "Aut.TGSS";
        silcon3 = "del";
        silcon4 = #30#5;                || nro.autorizacion SILCON
        silcon5 = #30#6 + ")";          || fecha autorizacion SILCON

        || cargo ya observaciones para PDF
        aObservacion = "NO ACOMPA¥A TC2/8 NI TA/611";
        aObservacion1 = "Autorizacion TGSS";
        aObservacion2 = "Numero " + silcon4;
        aObservacion3 = "Fecha: " + silcon5;
        aObservacion3 = aObservacion3 - ")";
|FINSI;
|CIERRA #30;
|FPRC;

|PROCESO control;
     |ABRE #labcontr;
     |LEE 000#labcontr.p;
     |CIERRA #labcontr;
|FPRC;


____________________________________/ CALCULO PRINCIPAL
|PROCESO tipo3_labcerag; |TIPO 3;
     |SI aParam = "";
          |HAZ GrabaLabtraba;
     |FINSI;
     |HAZ control;
     |HAZ lee_empre;
     |HAZ lee_traba;
     |HAZ lee_centr_ag;
     |HAZ domicili;
     |HAZ lee_silcon;
     |HAZ estado;
     |SI aEmision ! "XML";
          |SI aEmision = "IMP";    || vengo del labimpce
               |HAZ Impresion;
          |SINO;
               nOpcion = 99;
               |PARA; |SI nOpcion ! 5; |Y nOpcion ! 0; |Y nOpcion ! -1; |HACIENDO;
                    |HAZ Impresion;
               |SIGUE;
          |FINSI;
     |SINO;
          || vengo del labimpce
          enSwHisto = 1;
          aRegimen = "A";
          enEmp = #0#0;
          enTra = #0#1;
          |HAZ Carga_Anyos_Meses; ||proceso que carga todo lo relativo al pto. 4
          |HAZ GeneraXML;
     |FINSI;
|FPRC;

||________PROCESO PARA LA IMPRESION DEL PDF

|PROCESO sustituye2;
     nAscii = & aCaracter;
     aCaracterSal = aCaracter;
     |SI nAscii = 160;             || el caracter  
          aCaracterSal = "\341";
     |FINSI;
     |SI nAscii = 130;             || el caracter ‚
          aCaracterSal = "\351";
     |FINSI;
     |SI nAscii = 161;             || el caracter ¡
          aCaracterSal = "\355";
     |FINSI;
     |SI nAscii = 162; |O nAscii = 243;            || el caracter ¢
          aCaracterSal = "\363";
     |FINSI;
     |SI nAscii = 163;             || el caracter £
          aCaracterSal = "\372";
     |FINSI;
     |SI nAscii = 164;             || el caracter ¤
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 241;             || el caracter ¤ (otro codigo ¨?)
          aCaracterSal = "\361";
     |FINSI;
     |SI nAscii = 165;             || el caracter ¥
          aCaracterSal = "\321";
     |FINSI;
     |SI nAscii = 129;
          aCaracterSal = "\374";   || el caracter u con dieresis
     |FINSI;
     |SI nAscii = 154;
          aCaracterSal = "\334";   || el caracter U (mayuscula) con dieresis
     |FINSI;
     |SI nAscii = 167;
          aCaracterSal = "\272";   || el caracter §
     |FINSI;
     |SI nAscii = 166;
          aCaracterSal = "\252";   || el caracter ¦
     |FINSI;
     |SI aCaracter = "(";
          aCaracterSal = "\(";
     |FINSI;
     |SI aCaracter = ")";
          aCaracterSal = "\)";
     |FINSI;
|FPRC;

|PROCESO sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca = (nPos * 100) + 1;
          aCaracter = aCadena % nBusca;
          |HAZ sustituye2;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO GrabaTemporal;
     aAlfa1 = aValor % 101;
     |SI aAlfa1 = ".";
          aValor = "";
     |FINSI;
     |QBF aValor;
     aCadena = aValor;
     |HAZ sustituye;
     aValor = aCadenaSal;
     #pdfimtmp#0 = aCampo;
     #pdfimtmp#1 = aValor;
     #pdfimtmp#2 = nTipo;
     |GRABA 020#pdfimtmp.n;
|FPRC;

|PROCESO CargaCampos;
     aValor = "";
     nTipo = 0;

     aCampo = "Texto1";               ||NOMBRE Y APELLIDOS PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#15;
     |HAZ GrabaTemporal;

     aCampo = "Texto2";              ||DNI O PASAPORTE DE LA PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#17;
     |QBF aValor;
     aValor = "con DNI o NIE: " + aValor;
     |HAZ GrabaTemporal;

     aCampo = "Texto3";            ||CARGO EN LA EMPRESA DE LA PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#18;
     |HAZ GrabaTemporal;
/*
     aCampo = "tfno";             ||TELEFON DE LA PERSONA EXPEND. DEL CERTIFICADO
     aValor = #labempre#111;
     |HAZ GrabaTemporal;
*/
     aCampo = "Texto4";                ||NOMBRE EMPRESA
     aValor = #labempre#2;
     |HAZ GrabaTemporal;

     aCampo = "1";                || COD. CTA. COTIZACION
     aAlfa1 = #labcentr#10;
     |SI #labtraba#45 = "087"; |O #labtraba#45 = "421";
          |ABRE #nomcenes;
          #nomcenes#0 = #labtraba#0;
          #nomcenes#13 = #labtraba#77;
          #nomcenes#1 = 87;
          |LEE 000#nomcenes.=;
          |SI FSalida = 0;
               aAlfa1 = #nomcenes#10;
          |FINSI;
          |CIERRA #nomcenes;
     |FINSI;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

     aCampo = "j";                ||DOMICILIO SOCIAL DE LA EMPRESA
     aValor = domemp;
     |HAZ GrabaTemporal;

     aCampo = "f";                ||LOCALIDAD EMPRESA
     aValor = #labempre#6;
     |HAZ GrabaTemporal;

     aCampo = "6";                ||CODIGO POSTAL DE LA EMPRESA
     alfa1 = #labempre#7; alfa1 = "00" + alfa1; alfa1 = alfa1 % -102;
     alfa2 = #labempre#8; alfa2 = "000" + alfa2; alfa2 = alfa2 % -103;
     aValor = alfa1 + alfa2;
     |HAZ GrabaTemporal;

     aCampo = "g";                ||PROVINCIA DE LA EMPRESA
     aValor = #labempre#9;
     |HAZ GrabaTemporal;

     aCampo = "h";                ||ACTIVIDAD ECONOMICA EMPRESA
     aValor = #labempre#12;
     |HAZ GrabaTemporal;

     aCampo = "l2";               ||DOMICILIO CTRO TRABAJO TRABAJADOR
     aValor = domcen;
     |HAZ GrabaTemporal;

     aCampo = "i";                ||NOMBRE Y APELLIDOS DEL TRABAJADOR
     aValor = #labtraba#2;
     |HAZ GrabaTemporal;

     aCampo = "Texto5b";               ||DNI O PASAPORTE DEL TRABAJADOR
     aValor = #labtraba#7;
     |HAZ GrabaTemporal;

     aCampo = "1a";               || NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

/*
     aCampo = "1a";               ||PRIMEROS DOS DIGITOS DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     aValor = aAlfa1 % 102;
     |HAZ GrabaTemporal;

     aCampo = "1C";               ||LOS 8 DIGITOS DE EN MEDIO DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     aValor = aAlfa1 % 308;
     |HAZ GrabaTemporal;

     aCampo = "1aa";              ||LOS DOS ULTIMOS DIGITOS DEL NUM SS DEL TRABAJADOR
     aAlfa1 = #labtraba#75;
     |QBF aAlfa1;
     aAlfa1 = aAlfa1 % -102;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;
*/
     aCampo = "m";    ||TIPO DE CONTRATO
     aValor = #labtraba#45;

     |ABRE #66;
     #66#0 = #labtraba#45;
     |LEE 000#66=;
     |SI FSalida = 0;
          aAlfa = #66#1;
          |QBF aAlfa;
          |SI aAlfa ! "";
               aValor = aValor + " - " + #66#1;
          |FINSI;
     |FINSI;
     |HAZ GrabaTemporal;
     |CIERRA #66;
/*
     aCampo = "n";
     |SI #0#99 ! 0;
          nNume = #0#99;
          aValor = nNume;
          |HAZ GrabaTemporal;
     |FINSI;
*/
     aCampo = "Texto11";                || DURACION
     aValor = #0#103;
     |HAZ GrabaTemporal;

     aCampo = "\361";                ||PROFESION TRABAJADOR
     aValor = #labtraba#19;
     |HAZ GrabaTemporal;

     aCampo = "n";
     aValor = #labtraba#18;      ||CATEGORIA
     |HAZ GrabaTemporal;

     aCampo = "f1";               ||FECHA DE ALTA EN LA EMPRESA
     aValor = #labtraba#36;
     |HAZ GrabaTemporal;

     || aCampo = "Texto11";          || CODIGO CAUSA SITUACION LEGAL DE DESEMPLEO
     aCampo = "Texto16";          || CODIGO CAUSA SITUACION LEGAL DE DESEMPLEO
     aValor = #labcerag#98;
     |QBF aValor;
     aValor = ("00" + aValor) % -102;
     |HAZ GrabaTemporal;

     || aCampo = "Texto12";                ||CAUSA SITUACION LEGAL DE DESEMPLEO
     aCampo = "Texto17";                ||CAUSA SITUACION LEGAL DE DESEMPLEO
     aValor = #labcerag#5;
     |HAZ GrabaTemporal;

     aCampo = "Texto19";               ||FECHA FIN DE CONTRATO
     aValor = #labcerag#4;
     |HAZ GrabaTemporal;

     || aCampo = "Texto9";               || Fecha fin suspension
     aCampo = "Texto20";               || Fecha fin suspension
     aValor = #labcerag#100;
     |HAZ GrabaTemporal;

     || aCampo = "Texto10";                || Nro expediente Regulacion Empleo
     aCampo = "Texto21";                || Nro expediente Regulacion Empleo
     aValor = #0#101;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "VAC";              ||N§ DIAS DE VACACIONES RETRI. Y NO DISFRUTADAS
     aValor = #labcerag#97;
     |HAZ GrabaTemporal;

     aCampo = "10'";              ||SALARIOS DE TRAMITACION PERIODO DE
     |SI #labcerag#10 ! 0;
          aValor = #labcerag#8;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "10''";             ||SALARIOS DE TRAMITACION A
     |SI #labcerag#10 ! 0;
          aValor = #labcerag#9;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "DIAS";             ||SALARIOS DE TRAMITACION NUMERO DE DIAS
     aValor = #labcerag#10;
     |HAZ GrabaTemporal;

     ||DATOS PIE DEL PDF

     aCampo = "CIUDAD";               ||LOCALIDAD EMPRESA
     aValor = #labempre#6;
     |QBF aValor;
     |HAZ GrabaTemporal;

     aCampo = "DIA";               ||DIA FIRMA
     aAlfa1 = #0#6;
     aAlfa1 = aAlfa1 % 102;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

     aCampo = "MES";               ||MES FIRMA
     aAlfa1 = #0#6;
     aAlfa1 = aAlfa1 % 402;
     nMess = aAlfa1;
     |HAZ PasaAletras;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

     aCampo = "ANY";               ||A¤O FIRMA
     aAlfa1 = #0#6;
     aAlfa1 = aAlfa1 % -104;
     aValor = aAlfa1;
     |HAZ GrabaTemporal;

     aAlfa1 = #labempre#128;       || CNAE empresa
     aAlfa2 = #labcentr#22;        || CNAE centro
     |QBF aAlfa1;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2; |Y aAlfa2 ! "";
          aValor = aAlfa2;
     |SINO;
          aValor = aAlfa1;
     |FINSI;

     aCampo = "Texto7";       || codigo CNAE
     |HAZ GrabaTemporal;

     aAlfa1 = #labempre#128;       || CNAE empresa
     aAlfa2 = #labcentr#22;        || CNAE centro
     |QBF aAlfa1;
     |QBF aAlfa2;
     |SI aAlfa1 ! aAlfa2; |Y aAlfa2 ! "";
          aValor = #labcentr#23;
     |SINO;
          aValor = #labempre#129;
     |FINSI;
     |QBF aValor;

     aCampo = "Texto8";       || literal CNAE
     aAlfa = aValor - "(";
     |SI FSalida ! 0;
          nNume = FSalida;
          nNume = (nNume - 1) / 100;
          nNume = nNume - 1;
          nNume = nNume + 100;
          aValor = aValor % nNume;
     |FINSI;
     |HAZ GrabaTemporal;

     |PARA nCampo = 106; |SI nCampo [ 118; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto9";
          |SI nCampo = 106; aCampo = aCampo; |FINSI;
          |SI nCampo = 110; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 114; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 118; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |HAZ GrabaTemporal;
     |SIGUE;

     |PARA nCampo = 107; |SI nCampo [ 119; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto10";
          |SI nCampo = 107; aCampo = aCampo; |FINSI;
          |SI nCampo = 111; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 115; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 119; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |QBF aValor;
          |SI aValor = "0";
               aValor = "";
          |FINSI;
          |HAZ GrabaTemporal;
     |SIGUE;

     |PARA nCampo = 108; |SI nCampo [ 120; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto12";
          |SI nCampo = 108; aCampo = aCampo; |FINSI;
          |SI nCampo = 112; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 116; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 120; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |HAZ GrabaTemporal;
     |SIGUE;

     |PARA nCampo = 109; |SI nCampo [ 121; |HACIENDO nCampo = nCampo + 4;
          aCampo = "Texto13";
          |SI nCampo = 109; aCampo = aCampo; |FINSI;
          |SI nCampo = 113; aCampo = aCampo + "a"; |FINSI;
          |SI nCampo = 117; aCampo = aCampo + "b"; |FINSI;
          |SI nCampo = 121; aCampo = aCampo + "c"; |FINSI;
          aValor = #0nCampo;
          |HAZ GrabaTemporal;
     |SIGUE;

     aValor = #0#123;    || la descripcion de la profesion
     aCampo = "deno";
     |HAZ GrabaTemporal;

     aValor = #0#122;    || el codigo de la profesion
     aCampo = "Texto14b";
     |HAZ GrabaTemporal;

     aCampo = "Texto22";
     aValor = #0#104;    || % reduccion ERE
     |HAZ GrabaTemporal;

     aCampo = "Texto23";
     aValor = #0#105;    || % reduccion cuidado familiares
     |HAZ GrabaTemporal;

     aCampo = "Texto14";
     aValor = #0#124;    || cargo publico o sindical
     |HAZ GrabaTemporal;

     aCampo = "Texto15y";
     aValor = #0#125;    || dedicacion
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO Carga_Jornadas;
     alfa1 = #0#4;   alfa1 = alfa1 % 402;     nmes = alfa1;
     alfa1 = #0#4;   alfa1 = alfa1 % -104;    nanyo = alfa1;
     nanyo_ant = nanyo -1;
/*
     nMes7 = nmes;
     nAnyo7 = nanyo;

     nMes6 = nMes7 -1;
*/
     nMes6 = nmes;
     nAnyo6 = nanyo;

     nMes5 = nMes6 -1;
     nAnyo5 = nanyo;
     |SI nMes5 = 0;
          nMes5 = 12;
          nAnyo5 = nanyo -1;
     |FINSI;
     |SI nAnyo6 = nanyo_ant;
         nAnyo5 = nanyo_ant;
     |FINSI;
     nMes4 = nMes5 -1;
     nAnyo4 = nanyo;
     |SI nMes4 = 0;
          nMes4 = 12;
          nAnyo4 = nanyo_ant;
     |FINSI;
     |SI nAnyo5 = nanyo_ant;
         nAnyo4 = nanyo_ant;
     |FINSI;
     nMes3 = nMes4 -1;
     nAnyo3 = nanyo;
     |SI nMes3 = 0;
          nMes3 = 12;
          nAnyo3 = nanyo_ant;
     |FINSI;
     |SI nAnyo4 = nanyo_ant;
         nAnyo3 = nanyo_ant;
     |FINSI;
     nMes2 = nMes3 -1;
     nAnyo2 = nanyo;
     |SI nMes2 = 0;
          nMes2 = 12;
          nAnyo2 = nanyo_ant;
     |FINSI;
     |SI nAnyo3 = nanyo_ant;
         nAnyo2 = nanyo_ant;
     |FINSI;
     nMes1 = nMes2 -1;
     nAnyo1 = nanyo;
     |SI nMes1 = 0;
          nMes1 = 12;
          nAnyo1 = nanyo_ant;
     |FINSI;
     |SI nAnyo2 = nanyo_ant;
         nAnyo1 = nanyo_ant;
     |FINSI;
|FPRC;

|PROCESO Carga_General;
     alfa1 = #0#4;   alfa1 = alfa1 % 402;     nmes = alfa1;
     alfa1 = #0#4;   alfa1 = alfa1 % -104;    nanyo = alfa1;
     nanyo_ant = nanyo -1;

     nMes7 = nmes;
     nAnyo7 = nanyo;

     nMes6 = nMes7 - 1;
     nAnyo6 = nanyo;
     |SI nMes6 = 0;
          nMes6 = 12;
          nAnyo6 = nanyo - 1;
     |FINSI;
     |SI nAnyo7 = nanyo_ant;
         nAnyo6 = nanyo_ant;
     |FINSI;

     nMes5 = nMes6 - 1;
     nAnyo5 = nanyo;
     |SI nMes5 = 0;
          nMes5 = 12;
          nAnyo5 = nanyo - 1;
     |FINSI;
     |SI nAnyo6 = nanyo_ant;
         nAnyo5 = nanyo_ant;
     |FINSI;

     nMes4 = nMes5 - 1;
     nAnyo4 = nanyo;
     |SI nMes4 = 0;
          nMes4 = 12;
          nAnyo4 = nanyo_ant;
     |FINSI;
     |SI nAnyo5 = nanyo_ant;
         nAnyo4 = nanyo_ant;
     |FINSI;

     nMes3 = nMes4 - 1;
     nAnyo3 = nanyo;
     |SI nMes3 = 0;
          nMes3 = 12;
          nAnyo3 = nanyo_ant;
     |FINSI;
     |SI nAnyo4 = nanyo_ant;
         nAnyo3 = nanyo_ant;
     |FINSI;

     nMes2 = nMes3 - 1;
     nAnyo2 = nanyo;
     |SI nMes2 = 0;
          nMes2 = 12;
          nAnyo2 = nanyo_ant;
     |FINSI;
     |SI nAnyo3 = nanyo_ant;
         nAnyo2 = nanyo_ant;
     |FINSI;

     nMes1 = nMes2 - 1;
     nAnyo1 = nanyo;
     |SI nMes1 = 0;
          nMes1 = 12;
          nAnyo1 = nanyo_ant;
     |FINSI;
     |SI nAnyo2 = nanyo_ant;
         nAnyo1 = nanyo_ant;
     |FINSI;
|FPRC;

|PROCESO Carga_Anyos_Meses;
     |SI #labtraba#42 = "A";
          |HAZ Carga_General;
     |SINO;
          |HAZ Carga_Jornadas;
     |FINSI;
|FPRC;

|PROCESO BuscaCamposPDF;
     |SI #labtraba#42 ! "E";
          aCampoDias = "_dias";
     |SINO;
          aCampoDias = "";
     |FINSI;
     |SI nLinea = 7;
          aCampoAny = "90f";
          aCampoMes = "80f";
          aCampoGru = "9f";
          aCampoJor = "Texto15f" + aCampoDias;
          aCampoBas = "Basef";
     |FINSI;
     |SI nLinea = 6;
          aCampoAny = "90e";
          aCampoMes = "80e";
          aCampoGru = "9e";
          aCampoJor = "Texto15e" + aCampoDias;
          aCampoBas = "Basee";
     |FINSI;
     |SI nLinea = 5;
          aCampoAny = "90d";
          aCampoMes = "80d";
          aCampoGru = "9d";
          aCampoJor = "Texto15d" + aCampoDias;
          aCampoBas = "Based";
     |FINSI;
     |SI nLinea = 4;
          aCampoAny = "90c";
          aCampoMes = "80c";
          aCampoGru = "9c";
          aCampoJor = "Texto15c" + aCampoDias;
          aCampoBas = "Basec";
     |FINSI;
     |SI nLinea = 3;
          aCampoAny = "90b";
          aCampoMes = "80b";
          aCampoGru = "9b";
          aCampoJor = "Texto15b" + aCampoDias;
          aCampoBas = "Baseb";
     |FINSI;
     |SI nLinea = 2;
          aCampoAny = "90a";
          aCampoMes = "80a";
          aCampoGru = "9a";
          aCampoJor = "Texto15a" + aCampoDias;
          aCampoBas = "Basea";
     |FINSI;
     |SI nLinea = 1;
          aCampoAny = "90";
          aCampoMes = "80";
          aCampoGru = "9";
          aCampoJor = "Texto15" + aCampoDias;
          aCampoBas = "Base";
     |FINSI;
|FPRC;

|PROCESO BuscaBase;
     nValor = 0;
     aValor = nValor;
     |PARA nCampo = 126; |SI nCampo [ 138; |HACIENDO nCampo = nCampo + 2;
          aAlfa1 = nAny;
          aAlfa2 = nMes; |QBF aAlfa2; aAlfa2 = ("00" + aAlfa2) % -102;
          aAlfa = aAlfa1 + aAlfa2;
          |SI #0nCampo = aAlfa;
               nNume = nCampo + 1;
               nValor = #0nNume;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Meses_Anyos;
     nLinea = 0;

     || LINEA 1

     |SI nAnyo1 = nanyo;
          nCamp = 71 + nMes1;
     |SINO;
          nCamp = 59 + nMes1;
     |FINSI;

     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;
          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo1;
          |HAZ GrabaTemporal;

          fec2 = nMes1;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo1;
          nMes = nMes1;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || LINEA 2

     |SI nAnyo2 = nanyo;
          nCamp = 71 + nMes2;
     |SINO;
          nCamp = 59 + nMes2;
     |FINSI;
     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;
          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo2;
          |HAZ GrabaTemporal;

          fec2 = nMes2;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo2;
          nMes = nMes2;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || LINEA 3

     |SI nAnyo3 = nanyo;
          nCamp = 71 + nMes3;
     |SINO;
          nCamp = 59 + nMes3;
     |FINSI;
     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;
          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo3;
          |HAZ GrabaTemporal;

          fec2 = nMes3;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo3;
          nMes = nMes3;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || LINEA 4

     |SI nAnyo4 = nanyo;
          nCamp = 71 + nMes4;
     |SINO;
          nCamp = 59 + nMes4;
     |FINSI;
     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;
          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo4;
          |HAZ GrabaTemporal;

          fec2 = nMes4;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo4;
          nMes = nMes4;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || LINEA 5

     |SI nAnyo5 = nanyo;
          nCamp = 71 + nMes5;
     |SINO;
          nCamp = 59 + nMes5;
     |FINSI;
     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;
          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo5;
          |HAZ GrabaTemporal;

          fec2 = nMes5;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo5;
          nMes = nMes5;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || LINEA 6

     |SI nAnyo6 = nanyo;
          nCamp = 71 + nMes6;
     |SINO;
          nCamp = 59 + nMes6;
     |FINSI;
     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;

          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo6;
          |HAZ GrabaTemporal;

          fec2 = nMes6;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo6;
          nMes = nMes6;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || LINEA 7

     |SI nAnyo7 = nanyo;
          nCamp = 71 + nMes7;
     |SINO;
          nCamp = 59 + nMes7;
     |FINSI;
     |SI #0nCamp ! 0;
          nLinea = nLinea + 1;

          |HAZ BuscaCamposPDF;

          aCampo = aCampoJor;
          aValor = #0nCamp;
          |HAZ GrabaTemporal;

          aCampo = aCampoAny;
          aValor = nAnyo7;
          |HAZ GrabaTemporal;

          fec2 = nMes7;
          |HAZ meseslet;
          aCampo = aCampoMes;
          aValor = meslet;
          |HAZ GrabaTemporal;

          aCampo = aCampoGru;
          aValor = #labtraba#33;
          |QBF aValor; aValor = ("00" + aValor) % -102;
          |HAZ GrabaTemporal;

          aCampo = aCampoBas;
          nAny = nAnyo7;
          nMes = nMes7;
          |HAZ BuscaBase;
          |SI nValor ! 0;
               aValor = nValor;
          |FINSI;
          |HAZ GrabaTemporal;
     |FINSI;

     || VACACIONES

     aCampo = "Texto15g" + aCampoDias;    || COTIZACION POR VACACIONES NO DISFRUTADAS
     aValor = #0#102;         || Y COBRADAS
     |HAZ GrabaTemporal;

     aCampo = "Baseg";        || COTIZACION POR VACACIONES NO DISFRUTADAS
     aValor = #0#140;         || Y COBRADAS (BASE DESEMPLEO)
     |HAZ GrabaTemporal;

     || LAS OBSERVACIONES

     |SI aObservacion1 ! "";
          aCampo = "acompanya";
          aValor = aObservacion;
          |HAZ GrabaTemporal;
     |FINSI;

     aCampo = "a1";
     aValor = aObservacion1;
     |HAZ GrabaTemporal;
     aCampo = "a1a";
     aValor = aObservacion2;
     |HAZ GrabaTemporal;
     aCampo = "a1b";
     aValor = aObservacion3;
     |HAZ GrabaTemporal;
|FPRC;

|PROCESO meseslet;               || RUTINA GENERAL DE TRANSFORMACION
     |SI fec2 = 1;  meslet = "ENE";   |FINSI;
     |SI fec2 = 2;  meslet = "FEB";   |FINSI;
     |SI fec2 = 3;  meslet = "MAR";   |FINSI;
     |SI fec2 = 4;  meslet = "ABR";   |FINSI;
     |SI fec2 = 5;  meslet = "MAY";   |FINSI;
     |SI fec2 = 6;  meslet = "JUN";   |FINSI;
     |SI fec2 = 7;  meslet = "JUL";   |FINSI;
     |SI fec2 = 8;  meslet = "AGO";   |FINSI;
     |SI fec2 = 9;  meslet = "SEP";   |FINSI;
     |SI fec2 = 10; meslet = "OCT";   |FINSI;
     |SI fec2 = 11; meslet = "NOV";   |FINSI;
     |SI fec2 = 12; meslet = "DIC";   |FINSI;
|FPRC;

|PROCESO PasaAletras;
     |SI nMess = 1;
          aAlfa1 = "Enero";
     |FINSI;
     |SI nMess = 2;
          aAlfa1 = "Febrero";
     |FINSI;
     |SI nMess = 3;
          aAlfa1 = "Marzo";
     |FINSI;
     |SI nMess = 4;
          aAlfa1 = "Abril";
     |FINSI;
     |SI nMess = 5;
          aAlfa1 = "Mayo";
     |FINSI;
     |SI nMess = 6;
          aAlfa1 = "Junio";
     |FINSI;
     |SI nMess = 7;
          aAlfa1 = "Julio";
     |FINSI;
     |SI nMess = 8;
          aAlfa1 = "Agosto";
     |FINSI;
     |SI nMess = 9;
          aAlfa1 = "Septiembre";
     |FINSI;
     |SI nMess = 10;
          aAlfa1 = "Octubre";
     |FINSI;
     |SI nMess = 11;
          aAlfa1 = "Noviembre";
     |FINSI;
     |SI nMess = 12;
          aAlfa1 = "Diciembre";
     |FINSI;
|FPRC;

|PROCESO CargaTemporal;
     #pdfdocca#0 = aArchivo;
     |LEE 000#pdfdocca.=;
     |SI FSalida ! 0;
          aAlfa1 = "    Archivo " + aArchivo + " no encontrado en el Mantenimiento ";
          aAlfa1 = aAlfa1 + "de ficheros PDF.";
          |MENAV aAlfa1;
          |ACABA;
          swCarga = 0;
     |SINO;
          aID = #pdfdocca#2;
     |FINSI;
|FPRC;

|PROCESO BuscaArchivo;
     aArchivo = "cert_emp_agrario.pdf";
|FPRC;

|PROCESO Registro;
     |ABRE #labnct10;

     #labnct10#0 = #labtraba#0;
     #labnct10#1 = #labtraba#1;
     #labnct10#11 = #labtraba#77;
     #labnct10#2 = 201;
     #labnct10#3 = "Certificado de Empresa";

     fFecha = ~;
     aFecha = fFecha;
     #labnct10#4 = fFecha;         || fecha

     |HORA aHora;
     |QBF aHora;
     #labnct10#5 = aHora;          || hora

     aUsuario = Usuario % 810;
     |QBF aUsuario;
     #labnct10#6 = aUsuario;       || usuario
     |SI aEmision = "MAN";
          #labnct10#7 = "labcerag";
     |SINO;
          #labnct10#7 = "labhisce";
     |FINSI;
     #labnct10#8 = #labtraba#45;             || tipo de contrato
     #labnct10#9 = #labtraba#36;             || fecha de alta
     #labnct10#10 = #labtraba#37;            || fecha de baja

     |GRABA 020#labnct10.n;
     |LIBERA #labnct10;
|FPRC;

      /************      MENU DE IMPRESION PARA PDF  ***************/

|VARIABLES;
{-1}menu = "";
    menu1 = "2310";
    menu2 = "1";
    menu3 = "";
    menu4 = "VIGES";
    menu5 = " Vista Previa ";
    menu6 = "  Imprimir  ";
    menu7 = " Generar XML ";
    menu8 = " Enviar Online ";
    menu9 = "   Salir  ";  || no imprimo, no veo, no guardo

     &nTipoSalida = 0;
     &nTipoImpre = 0;
     &nNroCopias = 0;
|FIN;

|PROCESO ElMenu;
     nOpcion = 0;
     swNetContrata = 0;
     |SI aParam ! ""; |Y aEmision ! "MAN";
          nTipoSalida = 0;
          nOpcion = 1;
          FSalida = nOpcion;
          |ACABA;
     |FINSI;

     |PINTA 0830,#1#2;
     |PINTA 0930,#2#2;
     |PINDA #0#0;
     |MENSA "    Elija una opcion del menu";
     |MENU menu;
     |BLIN 4;
     nOpcion = FSalida;
     |SI nOpcion = 0;    |ACABA;   |FINSI;
     |SI nOpcion = 1;
          |HAZ GrabaAcot;
          nTipoSalida = 0;
     |FINSI;
     |SI nOpcion = 2;         || nTipoImpre: 0=Predeterminada, 1=Presentar Cuadro
          |SI #labcontr#65 = 1;
               aAlfa = "    ATENCION. Con el parámetro 'Tipo ejecución Acrobat' ";
               aAlfa = aAlfa + "igual a 1 no se puede imprimir directamente.";
               |MENAV aAlfa;
               aAlfa = "    Es necesario usar la vista previa e imprimir ";
               aAlfa = aAlfa + "desde el Acrobat.";
               |MENAV aAlfa;
               nTipoSalida = 0;
               |ACABA;
          |FINSI;
          |HAZ GrabaAcot;

          nTipoSalida = 1;    || nNroCopias: = numero de copias ...
          nTipoImpre = 1;     || de momento por defecto Presentamos cuadro de impresion
          |CONFI "     Impresora Predeterminada?";
          |SI FSalida = 0;
               nTipoImpre = 0;
               |PUSHV 1425 1954;
               |BLANCO 1425 1954;
               |CUADRO 1425 1954;
               |ATRI R; |PINTA 1630 , " Nro de Copias: "; |ATRI N;
               E_sup  = 99;
               E_inf  = 1;
               nNroCopias = #labcerag#7;
               nNroCopias = 1649 ? 1;
               |POPV;
          |FINSI;
     |FINSI;

     |SI nOpcion = 3; |O nOpcion = 4;        || XML o NetContrata
          |SI nOpcion = 4;
               swNetContrata = 1;
          |FINSI;

          |HAZ GrabaAcot;

          aAlfa1 = ("00000" + #labhisce#1) % -105;
          aAlfa2 = ("00000" + #labhisce#2) % -105;
          aAlfa = aAlfa1 + "." + aAlfa2;
          aMensa = "    Creando certificado en xml. Trabajador " + aAlfa;
          |MENSA aMensa;

          aRegimen = "A";
          aAntCCC = "";
          enEmp = #0#0;
          enTra = #0#1;
          |HAZ Carga_Anyos_Meses; ||proceso que carga todo lo relativo al pto. 4

          |HAZ GeneraXML;

          |SI swNetContrata = 1;
               |HAZ EnvioNetContrata;
          |FINSI;

          |BLIN 4;
     |FINSI;

     |SI nOpcion = 5;
          || salida
     |FINSI;

     FSalida = nOpcion;
|FPRC;

|PROCESO BuscaCCCCen;
     |ABRE #gomccchi;
     #gomccchi#0 = #labcentr#0;
     #gomccchi#1 = #labcentr#1;
     |LEE 000#gomccchi.=;
     |SI FSalida = 0;
          aAlfa = #labcerag#4;
          |QBF aAlfa;
          aAlfa = aAlfa % -104;
          nNume = aAlfa;
          |SI nNume [ 2011;
               #labcentr#10 = #gomccchi#2;
          |FINSI;
     |FINSI;
     |CIERRA #gomccchi;
|FPRC;

|PROCESO DatosAdicLabhisce;
     #labhisce#30 = #labtraba#7;   || NIF TRABAJADOR
     aAlfa = #labtraba#247;                  || CCC empresa o centro
     |QBF aAlfa;
     aAlfa = ("0000" + aAlfa) % -104;

     |ABRE #labcentr;
     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |CIERRA #labcentr;
     |HAZ BuscaCCCCen;

     aAlfa1 = #labcentr#10; |QBF aAlfa1;
     aAlfa = aAlfa + aAlfa1;
     |QBF aAlfa;
     #labhisce#31 = aAlfa;   || NIF TRABAJADOR
|FPRC;

|PROCESO GrabaAcot;
     |ABRE #labhisce;

     #labhisce#0 = "A";
     #labhisce#1 = #labcerag#0;
     #labhisce#2 = #labcerag#1;
     || #labhisce#3 = 1;
     |LEE 000#labhisce.=;
     FEstado = FSalida;
/*
     |LEE 000#labhisce.];
     |SI FSalida ! 0; |O #labhisce#0 ! "A"; |O #labhisce#1 ! #labcerag#0; |O #labhisce#2 ! #labcerag#1;
        nNumero = 1;
     |SINO;
        |PARA; |SI FSalida = 0; |Y #labhisce#0 = "A"; |Y #labhisce#1 = #labcerag#0; |Y #labhisce#2 = #labcerag#1; |HACIENDO;
           nNumero = #labhisce#3 + 1;
           |LEE 000#labhisce.s;
        |SIGUE;
     |FINSI;
*/
     ||DDEFECTO #labhisce;
     #labhisce#0 = "A";
     #labhisce#1 = #labcerag#0;
     #labhisce#2 = #labcerag#1;
     || #labhisce#3 = nNumero;
     #labhisce#3 = 001;       || esto antes era la linea pero lo quito de
                              || aqui y grabo siempre 001, ya no es campo clave

     aAlfa = "|NC"; aAlfa = #labcerag#aAlfa#;
     nCalc = aAlfa; aRes = ""; nNumCmp = 4;
     |PARA nCont = 0; |SI nCont < nCalc; |HACIENDO nCont = nCont + 1;
          aAlfa  = "|C" + (("000" + nCont) % -103) + "TIPO";     aAlfa  = #labcerag#aAlfa#;
          aAlfa1 = "|C" + (("000" + nCont) % -103) + "LONGITUD"; aAlfa1 = #labcerag#aAlfa1#;
          ||aAlfa = "{{" + aAlfa + "|" + aAlfa1 + "|";
          aAlfa1 = #labcerag#nCont#; |QBF aAlfa1;
          ||aAlfa = aAlfa + aAlfa1 + "}}";
          aAlfa = "{{" + aAlfa1 + "}}";

          aAlfa1 = aRes + aAlfa;
          aAlfa1 = aAlfa1 % 0; nCalc1 = aAlfa1;
          |SI nCalc1 ] 230;
               #labhisce#nNumCmp# = aRes; aRes = aAlfa;
               nNumCmp = nNumCmp + 1;
          |SINO;
               aRes = aRes + aAlfa; |QBF aRes;
          |FINSI;
     |SIGUE;

     |SI aRes ! ""; #labhisce#nNumCmp# = aRes; |FINSI;

     fFecha = ~;

     |HORA aHora;

     |SI nOpcion = 1; |O nOpcion = 2;   || emision pantalla o impresora
          #labhisce#20 = fFecha;
          #labhisce#28 = aHora;
     |FINSI;
/*
     |SI nOpcion = 3;                   || solo grabado
          #labhisce#20 = fFecha;
          #labhisce#28 = aHora;
     |FINSI;
*/

     |SI nOpcion = 3; |O nOpcion = 4;   || xml
          |SI FEstado ! 0;
               #labhisce#20 = fFecha;
               #labhisce#28 = aHora;
          |FINSI;
     |FINSI;

     |SI aEmision = "EDI"; |O aEmision = "MAN";
          #labhisce#20 = fFecha;
          #labhisce#28 = aHora;
          #labhisce#27 = fFecha;
          #labhisce#29 = aHora;
     |FINSI;

     |HAZ DatosAdicLabhisce;

     |SI swNetContrata = 1;
          #labhisce#32 = "S";
     |FINSI;

     |SI FEstado = 0;
          |GRABA 020#labhisce.a;
     |SINO;
          |GRABA 020#labhisce.n;
     |FINSI;

     |LIBERA #labhisce;

     |CIERRA #labhisce;
|FPRC;

|PROCESO Impresion;
     |HAZ ElMenu;

     |SI nOpcion = 1; |O nOpcion = 2;
          aAlfa1 = Usuario; |QBT aAlfa1;    aAlfa1 = ("c" + aAlfa1) % 108;
          |NOME_DAT #100 aAlfa1;
          |DELINDEX #pdfimtmp;
          |ABRE #pdfimtmp;
          |ABRE #pdfdocca;
          |ABRE #pdfdocli;

          swCopia = 1;

          |HAZ BuscaArchivo;     ||asigna a aArchivo el nombre del pdf
          |HAZ CargaTemporal;    ||mira a ver si esta el pdf en el mantenimiento
          |HAZ CargaCampos;

          |HAZ Carga_Anyos_Meses; ||proceso que carga todo lo relativo al pto. 4
          |HAZ Meses_Anyos;

          |CIERRA #pdfimtmp;
          |CIERRA #pdfdocca;
          |CIERRA #pdfdocli;

          |SUB_EJECUTA "pdfgraba";
          |SUB_EJECUTA "pdfimpre";
     |FINSI;
|FPRC;

||_________FIN DE PROCESOS PARA LA IMPRESION DEL PDF

|PROCESO diaanter;                          || RUTINA DEL CALCULO duracion
     |SI xmesnume = 1;
          xtopemes = 31;
     |FINSI;
     |SI xmesnume = 2;
          xmod = xanynume $ 4;
          |SI xmod = 0;
               xtopemes = 29;
          |SINO;
               xtopemes = 28;
          |FINSI;
     |FINSI;
     |SI xmesnume = 3;   xtopemes = 31; |FINSI;
     |SI xmesnume = 4;   xtopemes = 30; |FINSI;
     |SI xmesnume = 5;   xtopemes = 31; |FINSI;
     |SI xmesnume = 6;   xtopemes = 30; |FINSI;
     |SI xmesnume = 7;   xtopemes = 31; |FINSI;
     |SI xmesnume = 8;   xtopemes = 31; |FINSI;
     |SI xmesnume = 9;   xtopemes = 30; |FINSI;
     |SI xmesnume = 10;  xtopemes = 31; |FINSI;
     |SI xmesnume = 11;  xtopemes = 30; |FINSI;
     |SI xmesnume = 12;  xtopemes = 31; |FINSI;
|FPRC;

|PROCESO CalculaDuracion;
     aDuracion = "";

     aDiaAlta = (aFechaRef % 102);
     aMesAlta = (aFechaRef % 402);
     aAnyAlta = (aFechaRef % -104);
     aDiaBaja = (#0#4 % 102);
     aMesBaja = (#0#4 % 402);
     aAnyBaja = (#0#4 % -104);

     nDiaAlta = aDiaAlta;
     nMesAlta = aMesAlta;
     nAnyAlta = aAnyAlta;
     nDiaBaja = aDiaBaja;
     nMesBaja = aMesBaja;
     nAnyBaja = aAnyBaja;

     nAnys = nAnyBaja - nAnyAlta;

     nMeses = nMesBaja - nMesAlta;
     |SI nMeses [ 0;
          nAnys = nAnys - 1;
          nMeses = 12 + nMeses;
     |FINSI;

     nDias = nDiaBaja - nDiaAlta + 1;
     nume1 = nDiaAlta - 1;
     xmesnume = nMesBaja;
     xanynume = nAnyBaja;
     |HAZ diaanter;
     |SI nDiaBaja = nume1;
          || nMeses = nMeses + 1;
          nDias = 0;
     |SINO;
          |SI nDiaAlta = 1; |Y nDiaBaja = xtopemes;
               nMeses = nMeses + 1;
               nDias = 0;
          |FINSI;
     |FINSI;
     |SI nDias < 0;
          xmesnume = nMesAlta;
          xanynume = nAnyAlta;
          |HAZ diaanter;
          nDias = xtopemes - nDiaAlta + 1;
          nDias = nDias + nDiaBaja;
          nMeses = nMeses - 1;
     |FINSI;
     |SI nMeses = 12;
          nAnys = nAnys + 1;
          nMeses = 0;
     |FINSI;

     aAnys = nAnys;
     aMeses = nMeses;
     aDias = nDias;

     |SI nAnys > 0;
          aDuracion = aAnys + " a¤o";
          |SI nAnys > 1;
               aDuracion = aDuracion + "s";
          |FINSI;
     |FINSI;
     |SI nMeses > 0;
          |SI aDuracion ! "";
               aDuracion = aDuracion + ", ";
          |FINSI;
          aDuracion = aDuracion + aMeses + " mes";
          |SI nMeses > 1;
               aDuracion = aDuracion + "es";
          |FINSI;
     |FINSI;
     |SI nDias > 0;
          |SI aDuracion ! "";
               aDuracion = aDuracion + ", ";
          |FINSI;
          aDuracion = aDuracion + aDias + " dia";
          |SI nDias > 1;
               aDuracion = aDuracion + "s";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Duracion; |TIPO 7;
     alfa1 = #0#4;
     |QBF alfa1;
     |SI alfa1 = "";
          #0#103 = "";
          |PINTA #0#103;
          |ACABA;
     |FINSI;

     aFechaRef = #labtraba#36;
     fech1 = aFechaRef;
     fech2 = #0#4;
     |SI fech1 > fech2;
          |MENAV "    ATENCION: La fecha fin de contrato es inferior a la fecha de alta";
          ||ACABA;
          |ERROR;
     |FINSI;

     |HAZ CalculaDuracion;

     #0#103 = aDuracion;
     |PINTA #0#103;
|FPRC;

|PROCESO CodigoProCer; |TIPO 7;
|| no desde el historico
     swGraba1 = 0;
     swGraba2 = 0;
     aAlfa = #labtraba#19;
     |QBF aAlfa;
     |SI aAlfa = "";

     |SINO;
          #0#123 = aAlfa;
     |FINSI;

     aAlfa = #labtraba#185;
     |QBF aAlfa;
     |SI aAlfa = "";
          |ABRE #labvaltb;
          #labvaltb#0 = "labtraba";
          #labvaltb#1 = 19;
          #labvaltb#5 = #0#0;
          #labvaltb#6 = #0#1;
          |LEE 000#labvaltb.=;
          |SI FSalida = 0;
               aAlfa = #labvaltb#4;
               |ABRE #taiclaoc;
               |SELECT #2#taiclaoc;
               #taiclaoc#1 = aAlfa;
               |LEE 000#taiclaoc.=;
               |SI FSalida = 0;
                    #0#122 = #taiclaoc#0;
               |FINSI;
               |CIERRA #taiclaoc;

               |ABRE #labtraba;
               #labtraba#0 = #0#0;
               #labtraba#1 = #0#1;
               |LEE 101#labtraba.=;
               |SI FSalida = 0;
                    #labtraba#185 = #0#122;
                    |GRABA 020#labtraba.a;
               |FINSI;
               |CIERRA #labtraba;
          |FINSI;
          |CIERRA #labvaltb;
     |SINO;
          #0#122 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO GrabaLabtraba;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 101#labtraba.=;
     |SI FSalida = 0;
          #labtraba#19 = #0#123;
          #labtraba#185 = #0#122;
          |GRABA 020#labtraba.a;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO CompPro;
     aAlfa = #0#123;
     |QBF aAlfa;
     |SI aAlfa = "";
          swGraba1 = 1;
          aAlfa = "    ATENCION: la profesión del trabajador está en blanco. ";
          |MENAV aAlfa;
          aAlfa = "    Es necesario incluir este dato en el certificado. ";
          aAlfa = aAlfa + "Pulse F3 para elegir de la lista CNO.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;

     aAlfa = #0#122;
     |QBF aAlfa;
     |SI aAlfa = "";
          swGraba2 = 1;
          aAlfa = "    ATENCION: el código de la profesión del trabajador está en blanco. ";
          |MENAV aAlfa;
          aAlfa = "    Es necesario incluir este dato en el certificado. ";
          aAlfa = aAlfa + "Pulse F3 para elegir de la lista CNO.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CompTP;
     |SI #labtraba#42 = "I"; |O #labtraba#42 = "P"; |O #labtraba#42 = "T"; |O #labtraba#42 = "X";
          aAlfa1 = "";
          |PARA nCampo = 106; |SI nCampo [ 121; |HACIENDO nCampo = nCampo + 1;
               aAlfa = #0nCampo;
               |QBF aAlfa;
               aAlfa1 = aAlfa1 + aAlfa;
          |SIGUE;
          |SI aAlfa1 = "0000";
               |SI #labtraba#42 = "T"; |O #labtraba#42 = "X";
                    aAlfa1 = "a tiempo parcial";
               |SINO;
                    aAlfa1 = "irregular";
               |FINSI;
               aAlfa1 = "    ATENCION: el trabajador tiene contrato " + aAlfa1 + ".";
               |MENAV aAlfa1;
               aAlfa1 = "    Los campos de distribución de jornadas deberían estar rellenos.";
               |MENAV aAlfa1;
          |FINSI;
     |FINSI;
|FPRC;

____________________________________/ CALCULOS DE PANTALLA

|PROCESO Sindical; |TIPO 7;
     |PUSHV 16422279;
     |ATRI R;
     ||            4       5         6         7
     ||            23456789012345678901234567890123456789
     |PINTA 1642, " Elija una opción si procede:         ";
     |PINTA 1742, " 1 - Alto cargo de la Administración  ";
     |PINTA 1842, " General del Estado                   ";
     |PINTA 1942, " 2 - Cargo representante de sindicato ";
     |PINTA 2042, " al amparo de la Ley 11/1985          ";
     |PINTA 2142, " 3 - Miembro de la corporación local  ";
     |PINTA 2242, " y resto de cargos sindicales         ";
     |ATRI 0;
|FPRC;

|PROCESO RestauraC;
     |POPV;
|FPRC;

|PROCESO Sindical2; |TIPO 7;
     |SI #0#124 = " ";
          #0#125 = 0;
          |PINTA #0#125;
          |CAMPO_MODIFICA #0#125, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0#125, 1, "S";
     |FINSI;
|FPRC;

|PROCESO leeemp;
     |ABRE #labempre;
     #labempre#0 = #0#0;
     |LEE 000#labempre.=;
     |SI aEmision ! "XML"; |Y aEmision ! "IMP";
          |PINTA 0830, #labempre#2;
     |FINSI;
     |CIERRA #labempre;
|FPRC;

|PROCESO leetra;
     |ABRE #labtraba;
     #labtraba#0 = #0#0;
     #labtraba#1 = #0#1;
     |LEE 000#labtraba.=;
     |SI aEmision ! "XML"; |Y aEmision ! "IMP";
          |PINTA 0930, #labtraba#2;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO RecuperaHis;
     |HAZ cero_meses;

     nNumCmp = 0;
     |PARA nCont = 4; |SI nCont [ 8; |HACIENDO nCont = nCont + 1;
          aAlfa = #labhisce#nCont#; |QBF aAlfa;
          |PARA; |SI aAlfa ! ""; |HACIENDO;
               aAlfa1 = aAlfa - "}}";
               nCalc = FSalida; nCalc = (((nCalc / 100) ! 0) + 1) + 100;
               aAlfa1 = aAlfa % nCalc; aAlfa = aAlfa - aAlfa1; |QBF aAlfa;
               aAlfa1 = aAlfa1 - "{{"; aAlfa1 = aAlfa1 - "}}";
               #labcerag#nNumCmp# = aAlfa1; nNumCmp = nNumCmp + 1;
               |SI nNumCmp > 140;
                    || aqui ha habido un problema al traerme el certificado
                    || del historico, o no se grabo bien o los campos no
                    || estan como deben, ME SALGO QUE YA NO HAY MAS CAMPOS

                    nCont = 9;     || para que se salga del otro PARA
                    |SAL;
               |FINSI;
          |SIGUE;
     |SIGUE;

     |HAZ activa_meses;

     |HAZ PreSaca;
|FPRC;

|PROCESO Recupera;
     swDatosHis = 0;
     |SI aParam = "";         || desde punto del menu
          |ABRE #labhisce;
          #labhisce#0 = "A";
          #labhisce#1 = #0#0;
          #labhisce#2 = #0#1;
          |LEE 000#labhisce.=;
          |SI FSalida = 0;
               aAlfa = "    ATENCION: El trabajador seleccionado ya tiene ";
               aAlfa = aAlfa + "un certificado guardado en el histórico.";
               |MENAV aAlfa;
               aAlfa = "    S¿Desea crear el certificado de nuevo?";
               |CONFI aAlfa;
               |SI FSalida ! 0;
                    ||swDatosHis = 1;
                    ||HAZ RecuperaHis;
                    ||PINDA #0#0;
                    |CIERRA #labhisce;
                    |PTEC 807;
               |FINSI;
          |FINSI;
          |CIERRA #labhisce;
     |FINSI;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |QBF aParam;
     aParam1 = aParam % 108;
     |SI aParam1 = "netcontr";
          aParam = aParam - aParam1;
          swNetContrata = 1;
     |FINSI;
     |SI aParam = ""; |O aParam1 = "labornet";
          aEmision = "MAN";
          |CLS;
          |SI aParam1 = "labornet";
               aAlfa = aParam % 905;
               #0#0 = aAlfa;
               aAlfa = aParam % 1405;
               #0#1 = aAlfa;
          |FINSI;

          |PINPA #0#0;
          |PINDA #0#0;

          |SI aParam1 = "labornet";
               |CAMPO_MODIFICA #0#0, 1, "N";
               |CAMPO_MODIFICA #0#1, 1, "N";
               |HAZ leeemp;
               |HAZ leetra;
               #0#4 = aFechaBaja;
               |HAZ carga_meses;
          |FINSI;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |HAZ GrabaAcot;
               |HAZ tipo3_labcerag;
          |FINSI;
     |SINO;
          aAlfa = aParam; |QBF aAlfa;
          |ABRE #labhisce;
          #labhisce#0 = "A";
          aAlfa1 = aAlfa % 0105; #labhisce#1 = aAlfa1;
          aAlfa1 = aAlfa % 0605; #labhisce#2 = aAlfa1;
          aEmision = aAlfa % -103;

          |LEE 000#labhisce.=;
          |SI FSalida = 0;
             enSwError = 0;
             |HAZ RecuperaHis;

             |SI aEmision ! "EDI";
                 |HAZ tipo3_labcerag;
             |SINO;
                  || edicion de certificado ya grabado proveniente del historico

                  |CLS;
                  |PINPA #0#0;
                  |PINDA #0#0;
                  |CAMPO_MODIFICA #0#0, 1, "N";
                  |CAMPO_MODIFICA #0#1, 1, "N";
                  |HAZ leeemp;
                  |HAZ leetra;
                  |ENDATOS #1#0;
                  |SI FSalida = 0;
                    |HAZ GrabaAcot;
                  |FINSI;
             |FINSI;

          |SINO;
             enSwError = -1;
          |FINSI;
          |CIERRA #labhisce;
     |FINSI;
|FPRO;
