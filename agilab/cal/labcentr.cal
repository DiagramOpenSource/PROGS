|FICHEROS;
    labcentr #0;

    labtabla #50;
    labmunic #51;
    tdpmunic #52;
     nomcnahi;
     labtraba;
|FIN;

|VARIABLES;
 anterio0 = 0;
 anterio1 = 0;
 modo = 0;
 nume1 = 0;
 nume2 = 0;
 corta = 0;
 nume3 = 0;
 jg = 0;
 sitio = 0;
    sindical = "";
    mensaje1 = "    ATENCION!!! Solicite Libro de Matricula para este Centro ...";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    runnom = "";

     aCR       = "";
     aLF       = "";
     aComillas = "";
     nSwLectura = 0;
     nHandle    = 0;
     nCampo     = 0;
     nCampo1    = 0;
     nAbierto   = 0;
     nPosic     = 0;
     nCalc      = 0;
     nCalc1     = 0;
     nCalc2     = 0;
     nSwUno     = 0;
     nLong      = 0;
     nTecla     = 0;

     &aCodPos  = "";
     &aCodigoMunicipio = "";
     aCadena   = "";
     aLong     = "";
     aTabla    = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
{1}  aContiene = "";

     swAgilab = 0;
     aFabre = "";
     nModo = 0;
     FEstado = 0;
     aCNAE = "";
     aDesCNAE = "";
     swAgrario = 0;
     &eaVengoDe = "";
     nOpcion = 0;
     enBoton = 0;
     nRegimen = 0;
|FIN;

|PROCESO EsAgrario;
     swAgrario = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE EsAgrario;
     #labtraba#1;
     247;
     #0#0, 00001, nRegimen;
     #0#0, 99999, nRegimen;
     ;
     NULL, EsAgrario;
|FIN;

|PROCESO agrarios; |TIPO 14;
     swAgrario = 0;
     nRegimen = 613;
     |BUCLE EsAgrario;
     nRegimen = 163;
     |BUCLE EsAgrario;
     |SI swAgrario = 1;
          |CAMPO_MODIFICA #0#24, 1, "S";
          |CAMPO_VISUAL #0#24, 1, "S";
          |ATRI 0;
          |PINTA 1948, "Excl. censo agrario:    ³";
          |ATRI I;
          |PINTA #0#24;
          |ATRI I;
     |SINO;
          |CAMPO_MODIFICA #0#24, 1, "N";
          |CAMPO_VISUAL #0#24, 1, "N";
          |ATRI 0;
          |PINTA 1948, "                        ³";
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO sindical; |TIPO 0;
    anterio0 = #0#0;
    anterio1 = #0Campo;
|SI #0Campo > 1;
        #0#1 = 1;
    |LEE 001#0=;
    |SI FSalida = 0;
            sindical = #0#12;
    |SINO;
            sindical = "NO EXISTE";
    |FINSI;
    |DDEFECTO #0;
        #0#0 = anterio0;
        #0#1 = anterio1;
        #0#12 = sindical;
    |MODULO runnom;
    |SI runnom = "labcentr";
        |PINDA #0#0;
    |FINSI;
|FINSI;
|HAZ mensaje;
|FPRC;

|PROCESO mensaje;
    modo = FEntrada /100;
    modo = modo ! 0;
|MODULO alfa1;
|SI modo = 1; |Y alfa1 = "labcentr";
    |MENAV mensaje1;
|FINSI;
|FPRC;

|PROCESO control3; |TIPO 0;
|SI FSalida = 9;
        alfa1 = #0Campo;
    |QBF alfa1;
        alfa2 = alfa1 % 102; alfa3 = alfa1 % -107;
        alfa4 = alfa3 % 101;
    |SI alfa4 = "0";
            alfa3 = alfa3 % 206;
            alfa1 = alfa2 + alfa3;
    |FINSI;
        nume1 = alfa1;
        nume2 = nume1 / 97;
    |HAZ trunca3;
    |SI nume1 ] 0; |Y nume1 [ 99;
            alfa1 = #0Campo;
        |QBF alfa1;
            alfa2 = nume1;
            alfa2 = "00" + alfa2;
            alfa2 = alfa2 % -102;
            alfa1 = alfa1 + alfa2;
            #0Campo = alfa1;
        |PINTA #0Campo;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO trunca3;
    corta = 0;
    alfa1 = nume2;  alfa2 = alfa1 % 0;  nume3 = alfa2;
|PARA jg = nume3; |SI jg ] 1;|Y corta = 0; |HACIENDO jg = jg - 1;
        sitio = (jg * 100) + 1;
        alfa2 = alfa1 % sitio;
    |SI alfa2 = ".";  corta = jg;  |FINSI;
|SIGUE;
|SI corta ! 0;
        sitio = 100 + corta - 1;
        alfa1 = alfa1 % sitio;
|FINSI;
    nume3 = alfa1;
    nume1 = nume1 - (nume3 * 97);
|FPRC;

|PROCESO BuscaAgilab;
     swAgilab = 1;
     aFabre = "";
     |DIRECTORIO aFabre;
     aFabre = "rt  " + aFabre + "aginom/bin/labconb1.tab";
     |FABRE aFabre;
     |SI FSalida ] 0;
          |FCIERRA FSalida;
          |CAMPO_MODIFICA #labcentr#6, 1, "N";
          |CAMPO_MODIFICA #labcentr#9, 1, "N";
     |SINO;
          aFabre = "";
          |DIRECTORIO aFabre;
          aFabre = "rt  " + aFabre + "agilab/bin/fuecatip.tab";
          |FABRE aFabre;
          |SI FSalida ] 0;         || estoy en Produccion
               |FCIERRA FSalida;
               |CAMPO_MODIFICA #labcentr#6, 1, "N";
               |CAMPO_MODIFICA #labcentr#9, 1, "N";
          |SINO;
               swAgilab = 0;
               |CAMPO_MODIFICA #labcentr#6, 1, "S";
               |CAMPO_MODIFICA #labcentr#9, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraCP;
   nTecla = FSalida;

   |HAZ BuscaAgilab;
   |SI swAgilab = 0;   |ACABA;   |FINSI;
   |ABRE #labmunic; |DDEFECTO #labmunic;

   aAlfa = (("00" + #labcentr#7) % -102) + (("000" + #labcentr#8) % -103);
   #labmunic#4 = aAlfa;
   |LEE 000#labmunic.];
   |SI FSalida = 0; |Y #labmunic#4 = aAlfa;
      |SALVA_FICHA #labmunic;
      |LEE 000#labmunic.s;
      |SI FSalida = 0; |Y #labmunic#4 = aAlfa;
         nSwUno = 0;
      |SINO;
         nSwUno = 1;
      |FINSI;
      |REPON_FICHA #labmunic;
      |SI nSwUno = 0;
         |SI nTecla = 11;
            aCodPos = #labmunic#4;
            |SUB_EJECUTA "labmunic.tab";
            #labmunic#1 = aCodigoMunicipio;
            #tdpmunic#0 = #labmunic#1;
            |LEE 000#tdpmunic.=;
            |SI FSalida ! 0; |DDEFECTO #labcentr; |FINSI;
            #labcentr#6 = #labmunic#3; |PINTA #labcentr#6;
         |SINO;
            aAlfa = (("00" + #labcentr#7) % -102) + (("000" + #labcentr#8) % -103);
            #labmunic#4 = aAlfa;
            |LEE 000#labmunic.];
            |PARA; |SI FSalida = 0; |Y #labmunic#4 = aAlfa; |HACIENDO;
               aAlfa1 = #labmunic#3; |QBF aAlfa1; aLong = aAlfa1 % 0; nCalc1 = aLong;
               aAlfa2 = #labcentr#6; |QBF aAlfa2; aLong = aAlfa2 % 0; nCalc2 = aLong;
               |SI nCalc1 ] nCalc2;
                  nCalc = 100 + nCalc2; aAlfa = aAlfa % nCalc;
               |SINO;
                  nCalc = 100 + nCalc1; aAlfa1 = aAlfa1 % nCalc;
               |FINSI;
               |SI aAlfa1 = aAlfa2; |SAL; |FINSI;
               |LEE 000#labmunic.s;
            |SIGUE;
            |SI aAlfa1 ! aAlfa2;
               aCodPos = (("00" + #labcentr#7) % -102) + (("000" + #labcentr#8) % -103);
               |SUB_EJECUTA "labmunic.tab";
               #labmunic#1 = aCodigoMunicipio;
               #tdpmunic#4 = aCodPos;
               |LEE 000#labmunic.=;
               |SI FSalida ! 0; |DDEFECTO #labmunic; |FINSI;
               #labcentr#6 = #labmunic#3; |PINTA #labcentr#6;
            |FINSI;
         |FINSI;
      |FINSI;
      |SI nSwUno = 1;
         #labcentr#6 = #labmunic#3; |PINTA #labcentr#6;
      |FINSI;
   |SINO;
      |MENAV "    No se encuentra el codigo postal en la tabla de municipios"; |ERROR;
   |FINSI;
   |CIERRA #tdpmunic; |CIERRA #labmunic;
|FPRC;

|PROCESO ActCP;
   |HAZ BuscaAgilab;
   |SI swAgilab = 0;   |ACABA;   |FINSI;

   |SELECT #2#labmunic;
   #labmunic#3 = #labcentr#6;
   |LEE 000#labmunic.];
   |PARA; |SI FSalida = 0; |Y #labmunic#3 = #labcentr#6; |HACIENDO;
      aAlfa1 = #labmunic#3; |QBF aAlfa1; aLong = aAlfa1 % 0; nCalc1 = aLong;
      aAlfa2 = #labcentr#6; |QBF aAlfa2; aLong = aAlfa2 % 0; nCalc2 = aLong;
      |SI nCalc1 ] nCalc2;
         nCalc = 100 + nCalc2; aAlfa1 = aAlfa1 % nCalc;
      |SINO;
         nCalc = 100 + nCalc1; aAlfa2 = aAlfa2 % nCalc;
      |FINSI;
      |SI aAlfa1 = aAlfa2; |SAL; |FINSI;
      |LEE 000#labmunic.s;
   |SIGUE;
   |SI aAlfa1 = aAlfa2;
      aAlfa = #labmunic#4;
      aAlfa1 = aAlfa % 0102; #labcentr#7 = aAlfa1; |PINTA #labcentr#7;
      aAlfa1 = aAlfa % 0303; #labcentr#8 = aAlfa1; |PINTA #labcentr#8;
   |FINSI;
   |CIERRA #labmunic;
|FPRC;

|PROCESO CambCNAE_Cen;
|ACABA;
     nModo = (FEntrada / 100) ! 0;
     aAlfa = #0Campo;
     |QBF aAlfa;
     |SI nModo = 2; |Y aAlfa ! aCNAE;
          |ABRE #nomcnahi;
          #nomcnahi#0 = #0#0;
          #nomcnahi#2 = 2009;
          #nomcnahi#4 = #0#1;
          |LEE 000#nomcnahi.=;
          FEstado = FSalida;
          aAlfa = #nomcnahi#3;
          |QBF aAlfa;
          |SI FEstado ! 0; |O aAlfa = "";
               |PUSHV 13392275;
               |ATRI R;
                         ||  3 4        5         6         7
                         ||  9012345678901234567890123456789012345
               |PINTA 1339, " ATENCION: la modificación del  CNAE ";
               |PINTA 1439, " para adaptarlo a las tablas de 2009 ";
               |PINTA 1539, " ha de realizarse mediante el proce- ";
               |PINTA 1639, " ceso  [Maestros/Principales/Tarifas ";
               |PINTA 1739, " de  cotización  AT/EP/Tranformación ";
               |PINTA 1839, " a CNAE 2009] para guardar los valo- ";
               |PINTA 1939, " res de 2008. Si se  modifica direc- ";
               |PINTA 2039, " tamente  este campo se pueden gene- ";
               |PINTA 2139, " rar  errores al calcular  atrasos y ";
               |PINTA 2239, " seguros sociales desde el histórico ";
               |ATRI 0;

               |PAUSA;
               |POPV;
               #0Campo = aCNAE;
               |PINTA #0Campo;
               #0#16 = aDesCNAE;
               |PINTA #0#16;
          |FINSI;
     |FINSI;
     |CIERRA #nomcnahi;
|FPRC;

|PROCESO CNAE_labcentr;
     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     |SI aAlfa1 = "";
          aAlfa1 = "Sin actividad propia. El centro asume el CNAE de la empresa";
          #0#16 = aAlfa1;
          |PINTA #0#16;
     |SINO;
     /*
          |SI aAlfa1 = "01";
               aAlfa1 = "    ATENCION: el codigo 01 no tiene asociada cotizacion. "
               aAlfa1 = aAlfa1 + "Debe elegir una de sus actividades asociadas";
               |MENAV aAlfa1;
               |ERROR;
          |FINSI;
     */
     |FINSI;
|FPRC;

|PROCESO CNAE_Ant; |TIPO 7;
     aCNAE = #labcentr#15;
     |QBF aCNAE;
     aDesCNAE = #labcentr#16;
|FPRC;

|PROCESO SSOnlineCen;
     aAlfa1 = #0#0; |QBF aAlfa1; aAlfa1 = ("00000" + aAlfa1) % -105;
     aAlfa2 = #0#1; |QBF aAlfa2; aAlfa2 = ("00000" + aAlfa2) % -105;
     |SI nOpcion = 1;
          aAlfa = "labnct07;"+ "06" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 2;
          aAlfa = "labnct07;"+ "09" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 3;
          aAlfa = "labnct07;"+ "11" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 4;
          aAlfa = "labnct07;"+ "13" + aAlfa1 + aAlfa2;
     |FINSI;
     |SI nOpcion = 5;
          aAlfa = "labnct07;"+ "15" + aAlfa1 + aAlfa2;
     |FINSI;

     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO MenuREDCen;
     eaVengoDe = "labcentr";
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 4;
     aPopup3 = "1. Situación de la empresa";
     aPopup4 = "2. Certificado situación de cotización";
     aPopup5 = "3. Afiliados en el Cod. Cta. Coticación";
     aPopup6 = "4. Consulta de trabajadores en alta";
     aPopup7 = "5. Consulta de Convenios";
     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nOpcion = FSalida;
     |HAZ SSOnlineCen;
|FPRC;

|PROCESO BotonREDCen; |TIPO 8;
     |MODULO aAlfa; |QBF aAlfa; |SI aAlfa ! "labcentr"; |ACABA; |FINSI;

     ||CONTROL_SIMPLE 0, "BOTON,Seguridad Social Online", 0855, 0870, MenuREDCen;
     |CONTROL_SIMPLE 0, "BOTON,Seguridad Social Online", 0855, 0870, ConectaSS;
     enBoton = FSalida;
     |ESTADO_CONTROL enBoton, "ENABLE";
|FPRC;

|PROCESO FinBotonREDCen; |TIPO 9;
     |MODULO aAlfa; |QBF aAlfa; |SI aAlfa ! "labcentr"; |ACABA; |FINSI;

     |FIN_CONTROL_WINDOWS enBoton;
     |PULSATECLA;
|FPRC;
