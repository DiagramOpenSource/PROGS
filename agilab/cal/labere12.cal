|FICHEROS;
     labere12 #0;
     labere10;
     labere13;
     labere14;

     labtraba;
     labcentr;
|FIN;

|VARIABLES;
     aAlfa = "";
     swHayFechas = 0;
     swHayHorario = 0;
     fHorarioDesde = @;
     fHorarioHasta = @;
     nModo = 0;
     aMensaje = "";
     aNombreTraba = "";
     &aCadena = "";
     &eaNom = "";
     &eaApel1 = "";
     &eaApel2 = "";
|FIN;

|PROCESO ActivaCal; |TIPO 7;
     |SI #0#9 = "B";
          |CAMPO_MODIFICA #0#11, 1, "N";
          #0#11 = 0000;
          |PINTA #0#11;
     |SINO;
          |CAMPO_MODIFICA #0#11, 1, "S";
     |FINSI;
|FPRC;

|PROCESO BuscaHorario;
     |SI #labere14#4 ! "01.01.0000"; |Y #labere14#5 ! "01.01.0000";
          fHorarioDesde = #labere14#4;
          fHorarioHasta = #labere14#5;
          swHayFechas = 1;
     |FINSI;
     |SI #labere14#6 ! 0; |Y #labere14#7 ! 0;
          swHayHorario = 1;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaHorario;
     #labere14#1;
     ;
     #labere12#0, #labere12#11, 001;
     #labere12#0, #labere12#11, 999;
     ;
     NULL, BuscaHorario;
|FIN;

|PROCESO CompCalendario;
     |ABRE #labere13;
     #labere13#0 = #labere12#0;
     #labere13#1 = #labere12#11;
     |LEE 000#labere13.=;
     |SI FSalida ! 0;
          |SI #0#9 ! "B";
               aAlfa = "    Se requiere un calendario para enviar movimientos de ";
               aAlfa = aAlfa + "Alta o Modificación";
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |SINO;
          |SI #0#10 = "E";
               |SI #labere13#3 = "01.01.0000";
                    aAlfa = "    Es obligatoria la fecha de extinción en el calendario ";
                    aAlfa = aAlfa + "en procedimientos por extinción";
                    |MENAV aAlfa;
               |FINSI;
               |SI #labere10#24 [ #labere13#3; |Y #labere13#3 [ #labere10#25;
                    || correcto
               |SINO;
                    aAlfa = "    La fecha de extinción ha de estar dentro del periodo de ";
                    aAlfa = aAlfa + "aplicación del procedimiento";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |SI #0#10 = "S";
               swHayFechas = 0;
               swHayHorario = 0;
               |BUCLE BuscaHorario;
               |SI swHayFechas = 0;
                    aAlfa = "    Es obligatoria de fecha desde-hasta de suspensión "
                    aAlfa = aAlfa + "en procedimientos de suspensión";
                    |MENAV aAlfa;
                    |ERROR;
               |SINO;
                    |SI #labere10#24 [ fHorarioDesde; |Y fHorarioHasta [ #labere10#25;
                         || correcto
                    |SINO;
                         aAlfa = "    La fecha desde-hasta de suspensión ha de estar dentro del periodo de ";
                         aAlfa = aAlfa + "aplicación del procedimiento";
                         |MENAV aAlfa;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #0#10 = "R";
               swHayHorario = 0;
               swHayFechas = 0;
               |BUCLE BuscaHorario;
               |SI swHayHorario = 0;
                    aAlfa = "    Se requiere al menos un horario de susp./red. "
                    aAlfa = aAlfa + "en proc. de reducción";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
               |SI swHayFechas = 0;
                    aAlfa = "    Es obligatoria la fecha desde-hasta de reducción "
                    aAlfa = aAlfa + "en procedimientos de reducción";
                    |MENAV aAlfa;
                    |ERROR;
               |SINO;
                    |SI #labere10#24 [ fHorarioDesde; |Y fHorarioHasta [ #labere10#25;
                         || correcto
                    |SINO;
                         aAlfa = "    La fecha desde-hasta de reducción ha de estar dentro del periodo de ";
                         aAlfa = aAlfa + "aplicación del procedimiento";
                         |MENAV aAlfa;
                    |FINSI;
               |FINSI;
               |SI #labere13#5 = " ";
                    aAlfa = "    Es obligatorio el tipo de reducción "
                    aAlfa = aAlfa + "en procedimientos de reducción";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
               |SI #labere13#4 = 0;
                    aAlfa = "    Es obligatorio el porcentaje de reducción "
                    aAlfa = aAlfa + "en procedimientos de reducción";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #labere13;
|FPRC;

|PROCESO NombreApellidos;
     nModo = (FEntrada / 100)! 0;
     |SI nModo = 1;
          |ABRE #labtraba;
          #labtraba#0 = #labere10#0;
          #labtraba#1 = #labere12#4;
          |LEE 000#labtraba.=;
          |SI FSalida ! 0;
               |DDEFECTO #labtraba;
          |FINSI;

          |SI #labtraba#44 ! "A";
               aMensaje = "0000El trabajador no se encuentra en ALTA en la empresa";
               |MENAV aMensaje;
               |ERROR;
               |ACABA;
          |FINSI;


          aNombreTraba = #labtraba#2;
          |QBF aNombreTraba;
          |CIERRA #labtraba;

          aCadena = aNombreTraba;
          |HAZ SeparaNom_plb;
          #labere12#6 = eaNom;
          #labere12#7 = eaApel1;
          #labere12#8 = eaApel2;
          |PINTA #labere12#6;
          |PINTA #labere12#7;
          |PINTA #labere12#8;
     |FINSI;
|FPRC;


|PROCESO CCCCentro; |TIPO 7;
     |ABRE #labtraba;
     #labtraba#0 = #labere10#0;
     #labtraba#1 = #labere12#4;
     |LEE 000#labtraba.=;
     |CIERRA #labtraba;

     |ABRE #labcentr;
     #labcentr#0 = #labtraba#0;
     #labcentr#1 = #labtraba#77;
     |LEE 000#labcentr.=;
     |SI FSalida = 0;
          #0#12 = #labcentr#10;
     |FINSI;
     |CIERRA #labcentr;
|FPRC;
