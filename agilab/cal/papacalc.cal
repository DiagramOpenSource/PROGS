|INCLUYE i_fiche;
|INCLUYE i_varia;
|INCLUYE i_tempo;

|| *************************** CALCULOS GENERALES
|| **********************************************

|FICHEROS;
     labmunic #10000;
     labco224;
     labaux01;
|FIN;

|VARIABLES;
     nSwError = 0;
     nSwUno   = 0;
     nCalc2   = 0;
     nTecla   = 0;
     aCampo   = "";
     &aCodPos = "";
     &aCodigoMunicipio = "";

     &enHorasSemana = 0;
     &eaTipoJornada = "";
     &eaPrimerDia = "";
     &eaUltimoDia = "";
     &eaSalario = "";
     &enDurMeses = 0;
     &enDurDias = 0;
     &eaFechaIni = "";
     &eaFechaFin = "";
     swNetContrata = 0;
     &swNetContEmi = 0;       || llamada a NetContrata desde la emision
                              || del contrato, no desde historico
     &enExtRegis = 0;
     &eaExtProrr = "";
     &eaExtDef = "";
     &enExtEmp = 0;
     &enExtTra = 0;
     &nEmp = 0;
     &nTra = 0;
     aProcedenciaOri = "";
     swImpFormacion = "";
     swSigue = 0;
     &aBonif224 = "";
     nCampo = 0;

     &aIdCont = "";
     &aCenFor = "";
     &aFechaIni = "";
     &aDNI = "";
|FIN;

|PROCESO CompNroINEM;      || compruebo que sea numerico
/*
     swError = 0;
     aAlfa = #0Campo;
     |QBF aAlfa;
     aLon = aAlfa % 0;
     nLon = aLon;
     nNume = #0Campo;
     |SI nNume = 0; |Y aLon ! 0;
          swError = 1;
     |FINSI;

     aAlfa = nNume;
     aAlfa2 = #0Campo;
     |PARA; |SI; |HACIENDO;
          alfa1 = aAlfa2 % 101;
          |SI alfa1 = "0";
               aAlfa = "0" + aAlfa;
               aAlfa2 = aAlfa2 - "0";
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     aLon2 = aAlfa % 0;
     nLon2 = aLon2;
     |SI nLon ! nLon2; |Y nNume ! 0;
          swError = 1;
     |FINSI;

     |SI swError = 1;
          |MENAV "    ATENCION: Nro. de Contrato NO valido. Ha de ser un valor numerico";
          |ERROR;
     |FINSI;
*/
|FPRC;

|PROCESO LeeProcedencia;
     |MODULO aProcedencia;
     |QBF aProcedencia;
|FPRC;

|PROCESO EsIndefinido;
     |SI #0#0="100";|O #0#0="200";|O #0#0="150";|O #0#0="250";
          |O #0#0="109";|O #0#0="209";|O #0#0="189";|O #0#0="289";
          |O #0#0="389";|O #0#0="130";|O #0#0="230";|O #0#0="139";
          |O #0#0="239";|O #0#0="300";|O #0#0="151";|O #0#0="251";
          aIndefinido="S";
     |SINO;
          aIndefinido="N";
     |FINSI;
|FPRC;

|PROCESO leeempre;|TIPO 14;    || CALCULO PARA ASEGURAR EFECTIVIDAD
     |MODULO aProcedencia;
     |QBF aProcedencia;

     |ABRE #1;                     || DE LA RELACION CON EL FICHERO DE
     #1#0 = #0#1;                  || EMPRESAS
     |LEE 000#1=;
     |SI FSalida = 0;
          |ATRI I;
         |SI aProcedencia = "labcon95"; |O aProcedencia = "labconx4"; |O aProcedencia = "labconb3";
         |O aProcedencia = "labcona6"; |O aProcedencia = "labcona5"; |O aProcedencia = "labcon9a";
         |O aProcedencia = "labcon55"; |O aProcedencia = "labcon51";
            |PINTA 0625,#1#2;
            || PINTA 0665,#1#109;
         |SINO;
            |SI aProcedencia = "labcon86";
                 |PINTA 0723,#1#2;
            |SINO;
                 |PINTA 0725,#1#2;
            |FINSI;
            || PINTA 0765,#1#109;
         |FINSI;
          |ATRI I;
         estado = #1#110;          || carga variables para su posterior uso
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO leetraba; |TIPO 14;    || CALCULO PARA ASEGURAR EFECTIVIDAD
     |MODULO aProcedencia;
     |QBF aProcedencia;

    inkey = FSalida;
     |ABRE #2;                     || EN LA RELACION CON EL FICHERO DE
         #2#0 = #0#1;              || TRABAJADORES
         #2#1 = #0#2;
     |LEE 000#2=;
     |SI FSalida = 0;
          |ATRI I;
         |SI aProcedencia = "labcon95"; |O aProcedencia = "labconx4"; |O aProcedencia = "labconb3";
         |O aProcedencia = "labcona6"; |O aProcedencia = "labcona5"; |O aProcedencia = "labcon9a";
         |O aProcedencia = "labcon55"; |O aProcedencia = "labcon51";
            |PINTA 0725,#2#2;
         |SINO;
            |SI aProcedencia = "labcon86";
                 |PINTA 0823,#2#2;
            |SINO;
                 |PINTA 0825,#2#2;
            |FINSI;
         |FINSI;
          |ATRI I;
         #0#3=#2#77;
         |SI nLabHisto = 0;
              |SI #2#42 ! " "; |Y aProcedencia ! "labcona8";
                      #0#36 = "M";
                      |SI #2#42 = "M"; |O #2#42 = "X"; |O #2#42 = "H";
                           #0#36 = "M";
                      |FINSI;
                      |SI #2#42 = "D"; |O #2#42 = "I"; |O #2#42 = "T";
                           #0#36 = "D";
                      |FINSI;
                  |PINTA #0#36;
              |FINSI;
          |FINSI;
     |SINO;
     /*
         |MENAV mensa2;
             #0#2 = 0;
         |ERROR;
     */
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO dispo; |TIPO 6;
     inkey = FSalida;
     |SI inkey = 18;
         |DDEFECTO #2;
         |ABRE #2;
             #2#0 = #0#1;
             #2#1 = #0#2;
         |LEE 000#2=;
         |CIERRA #2;
         |HAZ disposicion;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO leecentr;|TIPO 14;     || CALCULO PARA ASEGURAR EFECTIVIDAD
     |MODULO aProcedencia;
     |QBF aProcedencia;

     |ABRE #2;
     #2#0=#0#1;
     #2#1=#0#2;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #3;                      || EN LA RELACION CON EL FICHERO DE
         #3#0 = #0#1;               || CENTROS DE TRABAJO
         #3#1 = #0#3;
     |LEE 000#3=;
     |SI FSalida = 0;
          |ATRI I;
         |SI aProcedencia = "labcon95"; |O aProcedencia = "labconx4"; |O aProcedencia = "labconb3";
         |O aProcedencia = "labcona6"; |O aProcedencia = "labcona5"; |O aProcedencia = "labcon9a";
         |O aProcedencia = "labcon55"; |O aProcedencia = "labcon51";
            |PINTA 0827,#3#2;
         |SINO;
            |SI aProcedencia = "labcon86";
                 |PINTA 0920,#3#2;
            |SINO;
                 |PINTA 0927,#3#2;
            |FINSI;
         |FINSI;
          |ATRI I;
     |SINO;
     /*
         |MENAV mensa3;
             #0#3 = 0;
         |ERROR;
     */
     |FINSI;
     |CIERRA #3;
     |SI #0#3 ! #2#77;
         |MENAV mensaK;
         ||ERROR;
     |FINSI;
|FPRC;

|PROCESO excepciones;
     |SI aProcedencia="labcona8";
          #0#50 = "X";
          #0#28 = "P";
          #0#77 = " ";
     |SINO;
          #0#43 = #10#25; |PINTA #0#43;     || periodo de prueba general
          #0#35 = #10#28; |PINTA #0#35;           || retribucion bruta
          #0#36 = #10#29; |PINTA #0#36;           || tipo retribucion

          |SI aProcedencia="labcona6";
               #0#33 = #10#21; |PINTA #0#33;       || concep. salariales 1
               #0#40 = #10#22; |PINTA #0#40;       || concep. salariales 2
               #0#42 = #10#23; |PINTA #0#42;       || concep. salariales 3
          |SINO;
               #0#37 = #10#21; |PINTA #0#37;       || concep. salariales 1
               #0#38 = #10#22; |PINTA #0#38;       || concep. salariales 2
               #0#39 = #10#23; |PINTA #0#39;       || concep. salariales 3
          |FINSI;

          #0#44 = #10#24; |PINTA #0#44;         || duracion vacaciones
          #0#46 = #10#27; |PINTA #0#46;             || localidad firma
          #0#48 = #10#26; |PINTA #0#48;             || nro. de copias
     |FINSI;

     |SI aProcedencia="labconb7";
          #0#27=#10#31; |PINTA #0#27;
     |FINSI;
|FPRC;

|PROCESO leecontr; |TIPO 7;
     |ABRE #10;
     |LEE 000#10p;
     |SI FSalida ! 0;
          |MENAV mensaB;
     |SINO;
          |HAZ LeeProcedencia;

          |HAZ excepciones;
     |FINSI;
     |CIERRA #10;
     |SI nLabHisto = 1;
        aAlfa = "|NC";
        nCalc = #0#aAlfa#;
        |ABRE #labhisto;
        #labhisto#100 = enNumRegis;
        |LEE 000#labhisto.=;
        |PARA nCont = 0; |SI nCont < nCalc; |HACIENDO nCont = nCont + 1;
           |SI nCont [ 99;
                #0#nCont# = #labhisto#nCont#;
           |SINO;
                nCont1 = nCont + 20;
                #0#nCont# = #labhisto#nCont1#;
           |FINSI;
        |SIGUE;
        ||HAZ excepciones;    || lo quito de aqui porque se lee del labhisto
        #labhisto#102 = "S"; |GRABA 020#labhisto.a;
        aCodMuniT = #labhisto#104;
        aCodMuniE = #labhisto#105;
        aCodMuniC = #labhisto#106;
        |CIERRA #labhisto;
        |PINDA #0#0; |HAZ leeempre; |HAZ leetraba; |HAZ leecentr;
        aCodigoC3 = #0#0; |QBF aCodigoC3;
        aCodigoC1 = aCodigoC3 % 0101;
        aCodigoC2 = aCodigoC3 % 0201;
        aCodigoC3 = aCodigoC3 % 0301;
        |HAZ duracion;
        |HAZ decdias;
        |HAZ retribu;
        |HAZ LeePaises;
        |HAZ actualiz; |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO lee_regimen;
     |DDEFECTO #12;
     |ABRE #12;
         #12#0 = #2#247;
     |LEE 000#12=;
     |SI FSalida ! 0;
             alfa1 = "    Regimen de Cotizacion [" + #12#0 + "] inexistente ...";
         |MENAV alfa1;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO siexiste; |TIPO 0;    || CALCULO PARA CHEQUEO CLAUSULAS
     |SI #0Campo ! 0;
         |ABRE #6;
             #6#1 = #0Campo;
         |LEE 000#6=;
         |SI FSalida ! 0;
             |MENAV mensa5;
             |ERROR;
         |FINSI;
         |CIERRA #6;
     |FINSI;
|FPRC;

|PROCESO leeclaus1;
     |SI #0clausula ! 0;
          #6#1 = #0clausula;
          |LEE 000#6=;
          |PARA campoclau = 3;
          |SI campoclau [ 20; |Y linepunt ! #6campoclau; |Y lineespa ! #6campoclau;
          |HACIENDO campoclau = campoclau + 1;
               campocont = campocont + 1;
               registro = registro + 1;
               |SI nLabHisto ! 1;
                    |SI campocont [ 26;
                         #0campocont = #6campoclau; || carga clausulas en contratos
                         |PINTA #0campocont;
                    |FINSI;
               |FINSI;
               #8#0 = registro;
               #8#1 = #6campoclau;       || carga clausulas en temporal
               |GRABA 020#8n;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO leeclaus; |TIPO 0;    || CARGA LAS LINEAS DE LAS CLAUSULAS ELEGIDAS
     |ATRI P;   |MENSA "    Cargando Clausulas ...";    |ATRI 0;
     |HAZ nom_usu;
         alfa1 = nom_tmp;
     |NOME_DAT #8 alfa1;
     |DELINDEX #8;
     |ABRE #6;
     |ABRE #8;
     |SI swtopes = 0;
         |HAZ cargatop;             || carga valor del tope de lineas de clausulas
     |FINSI;
     |SI nLabHisto ! 1;
          |HAZ cleancla;                 || limpia las lineas de clausulas
     |FINSI;
         campocont = 8;
         swhoja = 0;
         registro = 0;
     |PARA clausula =  4; |SI clausula [  8; |HACIENDO clausula=clausula+1;
           |HAZ leeclaus1;
     |SIGUE;
     |PARA clausula = 70; |SI clausula [ 74; |HACIENDO clausula=clausula+1;
           |HAZ leeclaus1;
     |SIGUE;

     |SI #labcontr#59 = "S";
          registro = registro + 2;
     |FINSI;

     |SI campocont > subtope;
             swhoja = 1;
     |FINSI;
     |CIERRA #6;
     |CIERRA #8;

     |ATRI R;   |BLIN 4; |ATRI 0;
|FPRC;

|PROCESO claumanu; |TIPO 0;   || CHEQUEA SI TIENE QUE LANZAR O NO H.ADICIONAL
                              || EN LA CARGA MANUAL
     |SI subtope ! 26;             || !!! si el tope es toda la pantalla sera
         |SI swtopes = 0;          ||     innecesario el chequeo, ya que manual-
             |HAZ cargatop;        ||     mente no podremos pasarnos !!!
         |FINSI;
         |PARA g=26; |SI g]9; |Y #0g=linepunt; |O #0g=lineespa; |HACIENDO g=g-1;
         |SIGUE;
         |SI g > subtope;
                 swhoja = 1;
         |SINO;
                 swhoja = 0;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO senyala; |TIPO 7;          || PONE EL ARTERISCO EN LA PANTALLA DE
     |SI FSalida ! 2;                    || CLAUSULAS ADICIONALES
             sw_senyala = 1;
         |SI swtopes = 0;     |HAZ cargatop; |FINSI;
         |ATRI P; |ATRI I;
             fila = topeclaus + 5;
             fila = fila * 100;
             colu = 3;
             posi = colu + fila;
         |PINTA posi, senyal;
         |ATRI 0;
         |HAZ leeclaus;
     |FINSI;
|FPRC;

|PROCESO fechacon; |TIPO 0;        || RUTINA DE CHEQUEO DE FECHAS
        vfec = #0Campo; vsw = 0;
     |SI vfec ! vblanco; |Y vfec ! vpuntos;
       vdia1 = vfec % A102;
       vme1 = vfec % A402;
       vany1 = vfec % A704;
       vdia = vdia1; vme = vme1; vany = vany1;
       |SI vdia ! 0; |Y vme ! 0; |Y vany > 1900;
          |SI vme [ 12; |Y vme ] 1;
            |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7; |O vme = 8; |O vme = 10; |O vme = 12;
                vtope = 31;
            |SINO;
                |SI vme = 2;
                    mod = vany $ 4;
                    |SI mod = 0;
                        vtope = 29;
                    |SINO;
                        vtope = 28;
                    |FINSI;
                 |SINO;
                    vtope = 30;
                 |FINSI;
             |FINSI;
             |SI vdia [ vtope;
                 vsw = 1;
             |FINSI;
          |FINSI;
       |FINSI;
     |SINO;
       vsw = 1;
     |FINSI;
     |SI vsw = 0;
         |MENAV verrfec;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO duracion; |TIPO 0;                 || CALCULA DURACION DE CONTRATOS
    #0#42 = "";
    xcheck = #0#40 + #0#49;
     |SI xcheck ! 0; |Y #0#41 ! vblanco; |Y #0#41 ! vpuntos;
             nume1 = #0#40 / 1000;            || meses a sumar en formato suma
             nume2 = (#0#49 - 1) + nume1;     || fecha a sumar en formato suma
             xfecreal = #0#41;
             xfecreal = xfecreal + nume2;
             #0#42 = xfecreal;
         |PINTA #0#42;
     |FINSI;
         mesestra = #0#40;
         diastra  = #0#49;
     |HAZ litedura;        || calcula literal de la duracion
     dura = duratra;
|FPRC;

|PROCESO Chequeo4Anys; |TIPO 0;                 || CALCULA DURACION DE CONTRATOS
     nume2 = (-1) + (4 / 1000000);  || suma 4 a¤os para saber el tope
     xfecreal = #0#41;
     xfecreal = xfecreal + nume2;
     nume1 = xfecreal;   || dias hasta (tope)
     xfecreal = #0#42;
     nume2 = xfecreal;   || dias hasta
     |SI nume2 > nume1; |Y FSalida ! 2;  || evita el segundo mensaje
          |SI aProcedencia = "labconb7";
               |SI #0#28 = "P"; |Y #0#53 ! "X";
                    |MENAV mensa9;      || chequea los 4 a¤os
               |FINSI;
          |SINO;
               |MENAV mensa9;      || chequea los 4 a¤os
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO decdias; |TIPO 0;        || TRANSFORMA INICIAL DE DIAS SEMANA
     |SI #0#33 = AL; |O #0#33 = Al;     des = Alunes;  |FINSI;
     |SI #0#33 = AM; |O #0#33 = Am;     des = Amartes; |FINSI;
     |SI #0#33 = AX; |O #0#33 = Ax;     des = Amiercoles;   |FINSI;
     |SI #0#33 = AJ; |O #0#33 = Aj;     des = Ajueves; |FINSI;
     |SI #0#33 = AV; |O #0#33 = Av;     des = Aviernes;     |FINSI;
     |SI #0#33 = AS; |O #0#33 = As;     des = Asabado; |FINSI;
     |SI #0#33 = AD; |O #0#33 = Ad;     des = Adomingo;     |FINSI;
     |SI #0#34 = AL; |O #0#34 = Al;     has = Alunes;  |FINSI;
     |SI #0#34 = AM; |O #0#34 = Am;     has = Amartes; |FINSI;
     |SI #0#34 = AX; |O #0#34 = Ax;     has = Amiercoles;   |FINSI;
     |SI #0#34 = AJ; |O #0#34 = Aj;     has = Ajueves; |FINSI;
     |SI #0#34 = AV; |O #0#34 = Av;     has = Aviernes;     |FINSI;
     |SI #0#34 = AS; |O #0#34 = As;     has = Asabado; |FINSI;
     |SI #0#34 = AD; |O #0#34 = Ad;     has = Adomingo;     |FINSI;
|FPRC;

|PROCESO decdias2; |TIPO 0;        || TRANSFORMA INICIAL DE DIAS SEMANA
     |SI #0#88 = AL; |O #0#88 = Al;     des = Alunes;  |FINSI;
     |SI #0#88 = AM; |O #0#88 = Am;     des = Amartes; |FINSI;
     |SI #0#88 = AX; |O #0#88 = Ax;     des = Amiercoles;   |FINSI;
     |SI #0#88 = AJ; |O #0#88 = Aj;     des = Ajueves; |FINSI;
     |SI #0#88 = AV; |O #0#88 = Av;     des = Aviernes;     |FINSI;
     |SI #0#88 = AS; |O #0#88 = As;     des = Asabado; |FINSI;
     |SI #0#88 = AD; |O #0#88 = Ad;     des = Adomingo;     |FINSI;
     |SI #0#89 = AL; |O #0#89 = Al;     has = Alunes;  |FINSI;
     |SI #0#89 = AM; |O #0#89 = Am;     has = Amartes; |FINSI;
     |SI #0#89 = AX; |O #0#89 = Ax;     has = Amiercoles;   |FINSI;
     |SI #0#89 = AJ; |O #0#89 = Aj;     has = Ajueves; |FINSI;
     |SI #0#89 = AV; |O #0#89 = Av;     has = Aviernes;     |FINSI;
     |SI #0#89 = AS; |O #0#89 = As;     has = Asabado; |FINSI;
     |SI #0#89 = AD; |O #0#89 = Ad;     has = Adomingo;     |FINSI;
|FPRC;

|PROCESO retribu; |TIPO 0;          || TRANSFORMA INICIAL DE TIPO DE RETRIBUCION
     |SI #0#36 = AS; |O #0#36 = As;
         tiporet = "semanales";
     |FINSI;
     |SI #0#36 = AD; |O #0#36 = Ad;
         tiporet = "diarios";
     |FINSI;
     |SI #0#36 = AM; |O #0#36 = Am;
         tiporet = "mensuales";
     |FINSI;
|FPRC;

|PROCESO horas; |TIPO 0;             || TRANSFORMA INICIAL DE TIPO DE HORAS
     |SI #0#31 = "S"; |O #0#31 = "s";
         hora = "semanales";
     |FINSI;
     |SI #0#31 = "D"; |O #0#31 = "d";
         hora = "diarias";
     |FINSI;
     |SI #0#31 = "M"; |O #0#31 = "m";
         hora = "mensuales";
     |FINSI;
     |SI #0#31 = "A"; |O #0#31 = "a";
         hora = "anuales";
     |FINSI;
|FPRC;

|PROCESO LeeEmpreTrabaCentr;
     |ABRE #1;
     #1#0=#0#1;
     |LEE 000#1=;
     |CIERRA #1;

     |ABRE #2;
     #2#0=#0#1;
     #2#1=#0#2;
     |LEE 000#2=;
     |CIERRA #2;


     |ABRE #3;
     #3#0 = #0#1;
     #3#1 = #0#3;
     |LEE 000#3=;
     |CIERRA #3;
|FPRC;

|PROCESO Formacion;
     |PUSHV 11152170;
     |PINTA 1118, "                                              ";
     |ATRI R;
               ||    2         3         4         5         6
               ||  8901234567890123456789012345678901234567890123
     |PINTA 1218, " Opciones de impresi¢n contratos de formaci¢n";
     |ATRI 0;
     |PINTA 1263, " ";
     |PINTA 1318, "                                              ";
     |PINTA 1418, "   - Elija una de las siguientes opciones -   ";
     |PINTA 1518, " (1) Imprimir contrato y acuerdo de formaci¢n ";
     |PINTA 1618, " (2) Imprimir solo el contrato                ";
     |PINTA 1718, " (3) Imprimir solo el acuerdo de formaci¢n    ";
     |PINTA 1818, "                                              ";
     |PINTA 1918, "                  Opci¢n:                     ";
     |PINTA 2018, "                                              ";
     |ATRI R;
     |PINTA 1519, "(1)";
     |PINTA 1619, "(2)";
     |PINTA 1719, "(3)";
     |ATRI 0;
     |CUADRO 11182163;

     E_sup = 1;
     E_inf = "";
     aAlfa = "1";
     aAlfa = 1944 ? 1;
     |QBF aAlfa;
     swImpFormacion = aAlfa;
     |SI swImpFormacion = 3;
          swAnexoFormacion = 1;
     |FINSI;
     |POPV;
|FPRC;

|| *********************** PROCESO DE IMPRESIONES Y ACTUALIZACIONES
|| ****************************************************************

|PROCESO ContratoPDF;         || nTipoSalida: 0=Vista Previa, 1=Imprimir

     |SI nOpcion = 2;         || nTipoImpre: 0=Predeterminada, 1=Presentar Cuadro
          nTipoSalida = 1;    || nNroCopias: = numero de copias ...
          nTipoImpre = 1;     || de momento por defecto Presentamos cuadro de impresion
          |CONFI "     Impresora Predeterminada?";
          |SI FSalida = 0;
               nTipoImpre = 0;
               |PUSHV 1425 1954;
               |BLANCO 1425 1954;
               |CUADRO 1425 1954;
               |ATRI R; |PINTA 1630 , " Nro de Copias: "; |ATRI N;
               E_sup  = 99;
               E_inf  = 1;
               nNroCopias = #labcontr#26;
               nNroCopias = 1649 ? 1;
               |POPV;
          |SINO;
               aAlfa = "    AVISO: Debera especificar el numero de copias en ";
               aAlfa = aAlfa + "el cuadro de impresion de Acrobat Reader.";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;

     nCuantos = 0;
     |HAZ LeeProcedencia;

     |SI aProcedencia = "labcon85"; |O aProcedencia = "labcon86";
     |O aProcedencia = "labcon87";
          |SI PARAMETRO ! "CONTRAT@";
               |HAZ Formacion;
          |FINSI;
     |FINSI;

     swSigue = 1;
     |SI aProcedencia = "labcon85"; |O aProcedencia = "labcon86";
     |O aProcedencia = "labcon87";
          |SI swImpFormacion = 3;
               swSigue = 0;
          |FINSI;
     |FINSI;
     |SI swSigue = 1;
          |HAZ ImpresionPDF;
          nCuantos = nCuantos + 2;
     |FINSI;

     aProcedenciaOri = aProcedencia;

     || ANEXO DE CLAUSULAS ADICIONALES DE BENAGUACIL
     |SI aProcedencia = "labcona8";
          aProcedencia = "anexoclausBena";
          |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
     |FINSI;

     |SI swAnexoClaus = 1;
          nNCA = registro / 40;       || registro:nro total claus,40=max/pag.
          nNCA = nNCA + 0.49;          || Numero de paginas de clausulas adic.
          nNCA = nNCA ! 0;            || que tengo que sacar (trunco)
          |SI nNCA = 0; nNCA = 1; |FINSI;
          |PARA nVoypor = 1; |SI nVoypor [ nNCA; |HACIENDO nVoypor = nVoypor + 1;
               aProcedencia = "AnexoClaus";
               |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI; || Anexo Clausulas
               nCuantos = nCuantos + 2;
          |SIGUE;
     |FINSI;
     |SI swAnexoRelevo = 1;    || Anexo contrato relevo
          aProcedencia = "labconre";
          |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
          nCuantos = nCuantos + 1;
     |FINSI;

     |SI swAnexoHoras = 1;    || Anexo horas complementarias para el contrato indef a t/p
          aProcedencia = "labanetp";
          |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
          nCuantos = nCuantos + 1;
     |FINSI;
     |SI swAnexoFormacion = 1; |Y swImpFormacion ! 2;
          || Anexo formacion para 421
          |SI aProcedenciaOri = "labcon85";
               aProcedencia = "labacuer";
               |ABRE #labacuer;
               #labacuer#0 = #0#1;
               #labacuer#1 = #0#2;
               |LEE 000#labacuer.=;
               |CIERRA #labacuer;
          |FINSI;
          |SI aProcedenciaOri = "labcon86";
          |O aProcedenciaOri = "labcon87";
               || aProcedencia = "labacue1";
               aProcedencia = "labacue2";
               |ABRE #labacue2;
               #labacue2#0 = #0#1;
               #labacue2#1 = #0#2;
               |LEE 000#labacue2.=;
               |CIERRA #labacue2;
          |FINSI;
          |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
          nCuantos = nCuantos + 1;
     |FINSI;

     |SI #labcontr#41 = "S";
        aProcedencia = "ComunDatos";
        |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
        nCuantos = nCuantos + 1;
     |FINSI;

     |SI #labcontr#85 = "S";
        aProcedencia = "clauconf";
        |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
        nCuantos = nCuantos + 1;
     |FINSI;

     aProcedencia = aProcedenciaOri;

     nNume = 28;
     |SI aProcedencia = "labcon95"; |O aProcedencia = "labcon9a";
     |O aProcedencia = "labcon55";
          nNume = 27;
     |FINSI;
     |SI aProcedencia = "labcon09";
          nNume = 64;
     |FINSI;
     |SI aProcedencia = "labcon01"; |O aProcedencia = "labconb1";
     |O aProcedencia = "labcon09"; |O aProcedencia = "labcon95";
     |O aProcedencia = "labcon36"; |O aProcedencia = "labconb7";
     |O aProcedencia = "labconb3"; |O aProcedencia = "labconx4";
     |O aProcedencia = "labconb1"; |O aProcedencia = "labcon9a";
     |O aProcedencia = "labcon55";
          |SI #contrato#nNume# = "P"; |Y #contrato#93 = "S";
               aProcedencia = aProcedencia + "anexored";
               |SI PARAMETRO ! "CONTRAT@"; |HAZ ImpresionPDF; |FINSI;
               nCuantos = nCuantos + 1;
          |FINSI;
     |FINSI;

     |SI PARAMETRO ! "CONTRAT@"; |SUB_EJECUTA "pdfimpre"; |FINSI;
|FPRC;

|PROCESO EnvioOnline;
     enExtRegis = #labhisto#100;
     eaExtProrr = #labhisto#103;
     eaExtDef = #labhisto#101;
     enExtEmp = #labhisto#1;
     enExtTra = #labhisto#2;
     |SUB_EJECUTA "labimpre;ENLACECONT";
|FPRC;

|PROCESO RegistroFormacion;
          aIdCont = #labregis#0;         || codigo de registro
          aCenFor = #labacue2#23;        || codigo centro formacion
          aFechaIni = #labregis#7;         || fecha inicio contrato
          aDNI = #labtraba#7;
          |QBF aDNI;
          |HAZ EnvioFormacion;
|FPRC;

|PROCESO actualiz; |TIPO 3;        || CALCULO EMISOR DE INFORMES Y
                                   || DE ACTUALIZACION EN EL REGISTRO
     |HAZ LeeEmpreTrabaCentr;

     nSwError = 0;
     |HAZ PideDatos;
     |SI nSwError = 1; |ACABA; |FINSI;
     |SI sw_senyala = 0;
          |HAZ leeclaus;
     |FINSI;   || clausulas adicionales

     |ABRE #4;                          || abre registro de contratos
     |HAZ ultimo;                       || lee el ultimo registro de contratos
     |SI limite = 1;
          |VETE fuera;
     |FINSI;
     |HAZ reverinf;                     || carga variables informe1 y 2
     |HAZ trabaj;                       || lee el trabajador para cargar DNI
     |HAZ lee_regimen;                  || lee el regimen de cotizacion
     opcion = 0; FEstado = 0;
     |SELECT #2#4;
     #4#1 = #0#1;
     #4#2 = #0#2;
     |LEE 000#4=;                       || lee registro de contratos
     FEstado = FSalida;             || guarda error para actual. plantilla o no
     #4#3 = #labtraba#7;
     |SI FEstado = 0;                   || comprueba si ya existe
          |HAZ EsIndefinido;

          |SI nLabHisto ! 1;
               |SI sw_mismo = 1; |Y aIndefinido="N";
                    error3 = "4";
                    error7 = " Registrar con el MISMO numero acumulando duracion. ";
               |SINO;
                    |AVISO;
                    |ATRI P;   |MENSA "    > TRABAJADOR YA REGISTRADO <";   |ATRI 0;
               |FINSI;
               sw_acumula = 0;
               |MENUG error;
               opcion = FSalida;
          |SINO;
               opcion = 3;
          |FINSI;
          |SI opcion [ 1;                || cancelar emision
               fuera = 1;
          |SINO;
               |SI opcion = 3;
                    contador = #4#0;   || iguala contador si opcion es actualizar
                    |SI nLabHisto = 1;
                         contador = enNumRegis;
                    |FINSI;
               |FINSI;                    || sino graba ultimo mas uno
               |SI opcion = 4;
                    sw_acumula = 1;
               |FINSI;
          |FINSI;
          |ATRI R;   |BLIN 4;  |ATRI 0;
     |FINSI;
     swPDF = 1;     || siempre PDF por defecto
     |SI aProcedencia = "labcon97"; |O aProcedencia = "labcon19";
      |O aProcedencia = "labcon98"; |O aProcedencia = "labcon96";
          swPDF = 0;
     |FINSI;
     |SI fuera = 0;                     || si cancelan emision 'na' de 'na'
          |SI nLabHisto = 1;
               nOpcion = 1;
               swPDF = 1;
               ||SI enWeb ! 0; nOpcion = 1;   |FINSI;
          |SINO;
               nOpcion = 0;
               |PARA; |SI nOpcion [ 0; |HACIENDO;
                    |MENU histo;
                    nOpcion = FSalida;
                    |SI nOpcion = 0;
                         nOpcion = 5;
                    |FINSI;
                    swNetContrata = 0;
                    swNetContEmi = 0;
                    |SI nOpcion = 4;
                         swNetContrata = 1;
                         swNetContEmi = 1;
                         nOpcion = 3;
                    |FINSI;
                    |SI swPDF = 0; |Y nOpcion = 1;
                         aAlfa = "     Opcion no disponible para este tipo de Contrato.";
                         aAlfa = aAlfa + " Desea imprimir el contrato?";
                         |CONFI aAlfa;
                         |SI FSalida = 0;
                              nOpcion = 2;
                         |SINO;
                              |VETE fuera;
                         |FINSI;
                    |FINSI;
                    |SI nOpcion = 2; |Y swPDF = 1;
                         |SI #labcontr#65 = 1;
                              nOpcion = 0;
                              aAlfa = "    ATENCION. Con el parámetro 'Tipo ejecución Acrobat' ";
                              aAlfa = aAlfa + "igual a 1 no se puede imprimir directamente.";
                              |MENAV aAlfa;
                              aAlfa = "    Es necesario usar la vista previa e imprimir ";
                              aAlfa = aAlfa + "desde el Acrobat.";
                              |MENAV aAlfa;
                         |FINSI;
                    |FINSI;
               |SIGUE;
               |SI nOpcion < 1; |O nOpcion > 3; |VETE fuera; |FINSI;
          |FINSI;
          |SI swPDF = 0;
               |SI nOpcion = 2; |O nOpcion = 3;
                    |SI nLabHisto ! 1;
                         |HAZ Impre;                      || elige impresora
                         |SI FSalida ! 0;               || si pasan de impresora
                              |FINIMP;
                              |VETE fuera;              || se queda todo igual y finaliza
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SELECT #1#4;

         |SI nLabHisto ! 1; |Y opcion = 3;
              |BORRA 020#4c;             || borra registro actual si existe
         |FINSI;
         |SI #10#50 = "S";   || PARA QUE GRABE EN EL HISTORICO
               swGrabaHisto = 1;
          |FINSI;
          |SI swGrabaHisto = 1;
               |SI nLabHisto ! 1;
                    |ABRE #labhisto;
                    #labhisto#100 = contador;
                    |LEE 101#labhisto.=;
                    |SI FSalida = 0;
                         |BORRA 020#labhisto.a; |LIBERA #labhisto;
                    |FINSI;
                    |CIERRA #labhisto;
               |FINSI;
          |FINSI;
          sistema = ~;               || fecha del sistema

          |SI nLabHisto ! 1;
               #4#0 = contador;           || codigo registro
               #4#1 = #0#1;               || codigo empresa
               #4#2 = #0#2;               || codigo trabajador
               |HAZ trad_cto;
               |HAZ decret;                   || lee la definicion del decreto corresp.
               #4#4 = tcto;
               #4#5 = #5#1;               || definicion decreto
               #4#6 = #5#2;               || real decreto

               #4#7=#0#41;  || fecha de inicio

               || en contratos indefinidos la fecha final esta en blanco
               || y la duracion a 0-0
               |HAZ EsIndefinido;

               |SI aIndefinido="S";
                    #4#8="";     || fecha de fin
                    #4#9=0;      || duracion en meses
                    #4#10=0;     || duracion en dias
               |SINO;
                    #4#8=#0#42;  || fecha de fin
                    #4#9=#0#40;      || duracion en meses
                    #4#10=#0#49;     || duracion en dias

                    |SI sw_acumula = 0;
                         #4#18 = #0#40;         || acumulado meses
                         #4#22 = #0#49;         || acumulado dias
                    |SINO;
                         #4#18 = #4#18 + #0#40; || acumulado meses (acumulando)
                         #4#22 = #4#22 + #0#49; || acumulado dias (acumulando)
                    |FINSI;
               |FINSI;

               #4#11 = nada;          || fecha presentacion
               #4#12 = #0#45;         || oficina de empleo
               #4#13 = #0#46;         || localidad
               #4#14 = nada;          || nro. de inem
               #4#15 = 0;             || nro. de prorrogas
               #4#16 = 0;             || duracion prorroga meses
               #4#17 = 0;             || duracion prorroga dias

               #4#19 = nada;          || fecha inicio prorroga
               #4#20 = nada;          || fecha final prorroga
               #4#21 = sistema;       || fecha alta registro
               #4#27 = "P";

               |HAZ recarga2;
               |GRABA 020#4n;

               |DBASS aAlfa;
               |QBF aAlfa;
               |SI aAlfa ! "/u/dsprofes/"; |Y aAlfa ! "/u/dsasesor/";
                    |SI #labregis#4 = 421;
                         |HAZ RegistroFormacion;
                    |FINSI;
               |FINSI;

               |ABRE #labconre;
               #labconre#18 = #labregis#0;
               #labconre#19 = #labregis#1;
               #labconre#20 = #labregis#2;
               #labconre#21 = "";
               |LEE 000#labconre.=;
               |SI FSalida = 0; |BORRA 020#labconre.a; |FINSI;

               #labconre#18 = -1;
               #labconre#19 = -1;
               #labconre#20 = -1;
               #labconre#21 = Usuario;
               |LEE 000#labconre.=;
               |SI FSalida = 0;
                  |BORRA 020#labconre.a;
                  #labconre#18 = #labregis#0;
                  #labconre#19 = #labregis#1;
                  #labconre#20 = #labregis#2;
                  #labconre#21 = "";
                  |GRABA 020#labconre.n;
               |FINSI;
               |CIERRA #labconre;
          |SINO;
               |ABRE #labconre;
               #labconre#18 = #labregis#0;
               #labconre#19 = #labregis#1;
               #labconre#20 = #labregis#2;
               #labconre#21 = "";
               |LEE 000#labconre.=;
               |SI FSalida ! 0; |DDEFECTO #labconre; |FINSI;
          |FINSI;

          |SI #10#20 = "S"; |Y FEstado ! 0; || actualiza plantilla y tipo contrato
               |HAZ actuplan;                || segun fichero control y regis. contratos
          |FINSI;
          |SI nLabHisto ! 1;
               |HAZ tipo_cont;
          |FINSI;
          |HAZ fechafir;             || desglosa fecha firma
          |HAZ domicili;             || construye domicilio
          |HAZ localida;             || ajusta a la derecha la localidad
          |HAZ varios1;              || desglosa nro. s.s. empresa
          |HAZ masuna;               || nro. de copias basicas
          |HAZ ModoDuplex;           || carga activacion y desactivacion DUPLEX

          |SI nOpcion = 1; |O nOpcion = 2;
               repetir = 0;
               |PARA; |SI repetir = 0; |HACIENDO;
                    |SI swPDF = 1;
                         ||SI #10#41 = "W";   swDuplex = 1;  |FINSI;
                         |HAZ ContratoPDF;
                    |SINO;
                         nCopiaDuplex = 1;
                         nCopiaCto = #0#48;
                         |SI #10#41 ! "N";
                              nCopiaDuplex = #0#48;
                              nCopiaCto = 1;
                         |FINSI;
                         |PARA nCopia = 1; |SI nCopia [ nCopiaDuplex;
                              |HACIENDO nCopia = nCopia + 1;
                              |HAZ ImpresionCto;
                         |SIGUE;
                         nCopiaDuplex = 1;
                         nCopiaCto = #10#37;
                         |SI #10#41 ! "N";
                              nCopiaDuplex = #10#37;
                              nCopiaCto = 1;
                         |FINSI;
                         |PARA nCopia = 1; |SI nCopia [ nCopiaDuplex; |HACIENDO nCopia = nCopia + 1;
                              |HAZ ImpresionBasica;
                         |SIGUE;
                    |FINSI;
                    |SI nLabHisto ! 1;
                         |SI #10#19 = "N"; |Y swPDF = 0;
                              |FINIMP;
                         |FINSI;
                         |AVISO;
                         |CONFI "    NRepetir emision (S/N): ";
                         repetir = FSalida;
                         |SI repetir = 0; |Y swPDF = 0;
                              |HAZ Impre;                   || elige impresora
                              |SI FSalida ! 0;            || si pasan de impresora
                                   |FINIMP;
                                   |VETE fuera;           || se queda todo igual y finaliza
                              |FINSI;
                         |FINSI;
                    |SINO;
                         repetir = 1;
                    |FINSI;
               |SIGUE;
          |FINSI;
          |SI nOpcion = 3; |Y nLabHisto ! 1; |Y swGrabaHisto = 0;
               aAlfa = "    Opcion desactivada. Consulte Control de la Aplicacion";
               |MENAV aAlfa;
          |FINSI;
          |SI swGrabaHisto = 1; |Y nLabHisto ! 1;
               |ABRE #labhisto;
               #labhisto#100 = contador;
               |LEE 000#labhisto.=;
               |SI FSalida = 0;
                    |BORRA 020#labhisto.a;
               |FINSI;
               |SI FSalida ! 0;
                    |DDEFECTO #labhisto;
                    #labhisto#100 = contador;
                    |MODULO aAlfa;
                    #labhisto#101 = aAlfa;
                    |SI nOpcion = 2;
                         #labhisto#102 = "N";
                    |SINO;
                         #labhisto#102 = "S";
                    |FINSI;
                    aAlfa = "|NC";
                    nCalc = #0#aAlfa#; nCalc = nCalc - 1;
                    |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
                        |SI nCont [ 99;
                             #labhisto#nCont# = #0#nCont#;
                        |SINO;
                             nCont1 = nCont + 20;
                             #labhisto#nCont1# = #0#nCont#;
                        |FINSI;
                    |SIGUE;
                    #labhisto#104 = aCodMuniT;
                    #labhisto#105 = aCodMuniE;
                    #labhisto#106 = aCodMuniC;
                    |GRABA 020#labhisto.n;
                    alfa1 = contador;
                    alfa0 = "    Se ha grabado la emision del contrato en el historico. ";
                    alfa0 = alfa0 + "Numero de registro: " + alfa1;
                    |MENAV alfa0;
               |FINSI;
               |CIERRA #labhisto;
          |FINSI;
          |HAZ RegistraContrato;
          |SI swNetContrata = 1;
               |HAZ EnvioOnline;
          |FINSI;
     |FINSI;
     |ET fuera;                    || si CTRL-C a impresora o si supera contador
     |CIERRA #4;
     |DELINDEX #8;
|FPRC;

|PROCESO ImpresionCto;
     |SI #10#41 = "S";   |IMPRIME aDuplexSi; |FINSI;
     |HAZ acontrato;            || imprime anverso del contrato
     |HAZ bcontrato;            || imprime reverso del contrato
     |SI #10#41 = "S";   |IMPRIME aDuplexNo; |FINSI;
     |HAZ ccontrato;            || imprime reverso del contrato pag 3
     /*
     |HAZ solicit;              || documento solo en 28,49,69,70 y 71
     |HAZ solici1;              || documento solo en 72 y 73
     */
     |HAZ Clausulas;              || imprime hoja adicional clausulas (en su caso)
     |HAZ AcuerdoFormacion;            || documento solo en 87,97 y 85
     |HAZ AnticipoDatosM;              || documento
     |HAZ AnexoHoras;               || documento horas complementarias
     |HAZ AnexoRelevo;              || documento contrato relevo
|FPRC;

|PROCESO ImpresionBasica;
     |SI #10#37 ! 0;
         |SI #10#2 = 0;
             |SI #10#41 = "S";   |IMPRIME aDuplexSi; |FINSI;
             |HAZ abasica;          || imprime anverso copia basica (0)
             |HAZ bbasica;          || imprime reverso copia basica
             |SI #10#41 = "S";   |IMPRIME aDuplexNo; |FINSI;
             |HAZ ubasica;          || imprime reverso copia basica pag 3
         |SINO;
             |HAZ dbasica;          || imprime copia basica (1)
         |FINSI;
         |HAZ cbasica;              || imprime hoja adicional clausulas
         |SI #10#39 = "S";
             /*
             |HAZ solicit;          || documento solo en 28,49,69,70 y 71
             |HAZ solici1;          || documento solo en 72 y 73
             */
             |HAZ Clausulas;              || imprime hoja adicional clausulas (en su caso)
             |HAZ AcuerdoFormacion;        || documento solo en 87,97 y 85
             |HAZ AnticipoDatosM;      || anticipo datos minusvalidos
             |HAZ AnexoHoras;          || documento horas complementarias
             |HAZ AnexoRelevo;              || documento contrato relevo
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO acontrato;
     |ABRE #2;  #2#0=#0#1;  #2#1=#0#2;  |LEE 000#2=;  |CIERRA #2;
         c1 = "";
         c2 = "";
         c3 = "";
     |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
         |INFOR informe1;
         |PRINT;
         |PIEINF;
         |FININF;
     |SIGUE;
     |SI #10#19 = "S"; |Y nLabHisto ! 1;
         |FINIMP;
     |FINSI;
|FPRC;

|PROCESO bcontrato;
    |SI swhoja = 1;|Y sw_unavez = 0;
            sw_unavez = 1;
        |HAZ recarga;
    |FINSI;
    |SI #10#19 = "S"; |Y nLabHisto ! 1;
        |MENAV mensa4;
        |HAZ Impre;
    |FINSI;
    |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
        |INFOR informe2;
        |PRINT;
        |PIEINF;
        |FININF;
    |SIGUE;
    |SI #10#19 = "S"; |Y nLabHisto ! 1;
        |FINIMP;
    |FINSI;
|FPRC;

|PROCESO ccontrato;
     |SI informe2U!"";
          |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |MENAV mensa4;
             |HAZ Impre;
          |FINSI;
          |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
              |INFOR informe2U;
              |PRINT;
              |PIEINF;
              |FININF;
          |SIGUE;
          |SI #10#19 = "S"; |Y nLabHisto ! 1;
              |FINIMP;
          |FINSI;
          |HAZ HojaBlancoDuplexW;
     |FINSI;
|FPRC;

|PROCESO Clausulas;
     |SI swhoja = 1;
        |SI #10#19 = "S";  |Y nLabHisto ! 1;
            |MENAV mensaA;
            |HAZ Impre;
        |FINSI;

        |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
            |ABRE #8;
            |SI aProcedencia = "labcon95";
               |INFOR informe7a;
            |SINO;
               |INFOR informe7;
            |FINSI;
            |LEE 000#8p;
            |PARA; |SI FSalida = 0; |HACIENDO;
                    texto = #8#1;
                |PRINT;
                |LEE 000#8s;
            |SIGUE;
            |PIEINF;
            |FININF;
            |CIERRA #8;
        |SIGUE;

        |SI #10#19 = "S"; |Y nLabHisto ! 1;
            |FINIMP;
        |FINSI;
        |HAZ HojaBlancoDuplexW;
    |FINSI;
|FPRC;

|PROCESO AnticipoDatosM;
     |SI #0#0="130"; |O #0#0="230"; |O #0#0="139"; |O #0#0="239";
         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV mensa6;
             |HAZ Impre;
         |FINSI;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe3;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;
         |HAZ HojaBlancoDuplexW;
     |FINSI;
|FPRC;

/*
|PROCESO solicit;
     |SI #0#0="28";|O #0#0="49";|O #0#0="69";
                   |O #0#0="70";|O #0#0="71";
                   |O #0#0="v2";|O #0#0="v3";
         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV mensa7;
             |HAZ Impre;
         |FINSI;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe4;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;

         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV mensa0;
             |HAZ Impre;
         |FINSI;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe5;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe6;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;
     |FINSI;
|FPRC;
*/

/*
|PROCESO solici1;
     |SI #0#0="72"; |O #0#0="73";
         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV mensa7;
             |HAZ Impre;
         |FINSI;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe8;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;

         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV mensa0;
             |HAZ Impre;
         |FINSI;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe5;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informe6;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;
     |FINSI;
|FPRC;
*/

|PROCESO acuer2;
     compactado = "";                  || COMPACTACION DE CAMPOS
     direcc = #1#3;                    || PARA CONSTRUCCION DOMICILIOS
     numero = #1#4;
     piso   = #1#5;
     cod1   = #1#7;
     cod2   = #1#8;
     locali = #1#6;
     |HAZ compac;
     |QBF direcc;
     |QBF numero;
     |QBF piso;
     compactado = direcc + coma;
     compactado = compactado + numero;
     compactado = compactado + "  ";
     compactado = compactado + piso;
     domemp = compactado;

|FPRC;

|PROCESO AcuerdoFormacion;
     |SI aProcedencia = "labcon97";
          |ACABA;
     |FINSI;
     |SI #0#0="085"; |O #0#0="097";  |O #0#0 = "421"; || equivalen al 421
         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV "    A IMPRIMIR COMUNICACION DE ACUERDO FORM.TEORICA ...";
             |HAZ Impre;
         |FINSI;
         |HAZ acuer2;
         |DDEFECTO #87;
         |ABRE #87;
             #87#0 = #0#1;
             #87#1 = #0#2;
         |LEE 000#87=;
         |CIERRA #87;
             #87#16 = #0#60;      || codigo encargado
             #87#17 = #0#27;      || encargado
             des87 = #0#41;       || desde
             has87 = #0#42;       || hasta
             tipo87 = "1";        || primer contrato

         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR "labacuer";
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;
         |HAZ HojaBlancoDuplexW;
         |HAZ domicili;
     |FINSI;
|FPRC;

|PROCESO AnexoRelevo;
   |SI #0#0 ! "100"; |Y #0#0 ! "200"; |Y #0#0 ! "150"; |Y #0#0 ! "151";
    |Y #0#0 ! "251"; |Y #0#0 ! "451"; |Y #0#0 ! "551"; |Y #0#0 ! "109";
    |Y #0#0 ! "209"; |Y #0#0 ! "189"; |Y #0#0 ! "289"; |Y #0#0 ! "250";
       |ACABA;
   |FINSI;
   |SI aProcedencia = "labcon01"; aTipoContr = "ordinario por tiempo indefinido                                        "; |FINSI;
   |SI aProcedencia = "labconb1"; aTipoContr = "indefinido a tiempo completo celebrado al amparo de la Ley 12/2001     "; |FINSI;
   |SI aProcedencia = "labcon95"; aTipoContr = "para desempleados contempla.en el apart.uno punto 1.3 Art.4 Ley 12/2001"; |FINSI;
   |SI aProcedencia = "labcon55"; aTipoContr = "a tiempo parcial con vinculaci¢n formativa (RDL 4/2013)                "; |FINSI;
   |SI aProcedencia = "labcona5"; aTipoContr = "comunicaci¢n de conversi¢n de contrato temporal en indefinido          "; |FINSI;
   |SI aProcedencia = "labconb2"; aTipoContr = "indefinido a tiempo parcial celebrado al amparo de la Ley 12/2001      "; |FINSI;
   |SI aProcedencia = "labcon13"; aTipoContr = "indefinido bonificado para trabajadores procedentes del textil y confec"; |FINSI;
   |SI aProcedencia = "labcon9a"; aTipoContr = "para desempleados contratados por empresas de insercion (Ley 44/2007)  "; |FINSI;


   |SI #0#78 = "N";     |ACABA;   |FINSI;

   |SI #10#19 = "S";  |Y nLabHisto ! 1;
       |MENAV "    A IMPRIMIR ANEXO DE CONTRATO DE RELEVO ...";
       |HAZ Impre;
   |FINSI;

   |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
       |INFOR "labconre";
       |PRINT;
       |PIEINF;
       |FININF;
   |SIGUE;

   |SI #10#19 = "S"; |Y nLabHisto ! 1;
       |FINIMP;
   |FINSI;
   |HAZ HojaBlancoDuplexW;
|FPRC;

|PROCESO AnexoHoras;
     || contratos a tiempo parcial o discontinuo menos el de relevo
     |SI #0#0="200"; |O #0#0="250"; |O #0#0="251"; |O #0#0="551";
          |O #0#0="300"; |O #0#0="209"; |O #0#0="289"; |O #0#0="389";
          |O #0#0="239"; |O #0#0="230";

         |SI #0#61 = "N";     |ACABA;   |FINSI;   || pacto S/N

         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV "    A IMPRIMIR ANEXO SOBRE HORAS COMPLEMENTARIAS ...";
             |HAZ Impre;
         |FINSI;

         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR "labanetp";
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;
         |HAZ HojaBlancoDuplexW;
     |FINSI;
|FPRC;

|PROCESO abasica;
         c1 = "===========================";
         c2 = "=     E J E M P L A R     =";
         c3 = "= C O P I A   B A S I C A =";
         g1 = #2#75;     #2#75 = "";         || NAFSS
         g2 = #2#12;     #2#12 = "";         || nivel estudios terminados
         g3 = #2#73;     #2#73 = "";         || codigo nivel estudios
         g4 = #2#11;     #2#11 = "";         || fecha nacimiento
         g5 = #2#07;     #2#07 = "";         || DNI
         g6 = domtra;    domtra = "";        || domicilio trabajador
     |SI #10#19 = "S";  |Y nLabHisto ! 1;
         |MENAV mensaO;
         |HAZ Impre;
     |FINSI;
     |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
         |INFOR informe1;
         |PRINT;
         |PIEINF;
         |FININF;
     |SIGUE;
     |SI #10#19 = "S"; |Y nLabHisto ! 1;
         |FINIMP;
     |FINSI;
         #2#75 = g1;
         #2#12 = g2;
         #2#73 = g3;
         #2#11 = g4;
         #2#07 = g5;
         domtra = g6;
|FPRC;

|PROCESO bbasica;
    |SI #10#19 = "S";  |Y nLabHisto ! 1;
        |MENAV mensaP;
        |HAZ Impre;
    |FINSI;
    |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
        |INFOR informeD;
        |PRINT;
        |PIEINF;
        |FININF;
    |SIGUE;
    |SI #10#19 = "S"; |Y nLabHisto ! 1;
        |FINIMP;
    |FINSI;
|FPRC;

|PROCESO dbasica;
    |SI #10#19 = "S";  |Y nLabHisto ! 1;
        |MENAV mensaP;
        |HAZ Impre;
    |FINSI;
    |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
        |INFOR "labcopi1";
        |PRINT;
        |PIEINF;
        |FININF;
    |SIGUE;
    |SI #10#19 = "S"; |Y nLabHisto ! 1;
        |FINIMP;
    |FINSI;
    |HAZ HojaBlancoDuplexW;
|FPRC;

|PROCESO cbasica;
    |SI swhoja = 1;
        |SI #10#19 = "S";  |Y nLabHisto ! 1;
            |MENAV mensaQ;
            |HAZ Impre;
        |FINSI;

        |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
            |ABRE #8;
            |SI aProcedencia = "labcon95";
               |INFOR informe1E;
            |SINO;
               |INFOR informeE;
            |FINSI;
            |LEE 000#8p;
            |PARA; |SI FSalida = 0; |HACIENDO;
                    texto = #8#1;
                |PRINT;
                |LEE 000#8s;
            |SIGUE;
            |PIEINF;
            |FININF;
            |CIERRA #8;
        |SIGUE;

        |SI #10#19 = "S"; |Y nLabHisto ! 1;
            |FINIMP;
        |FINSI;
        |HAZ HojaBlancoDuplexW;
    |FINSI;
|FPRC;

|PROCESO ubasica;
     |SI informeDU!"";
         |SI #10#19 = "S";  |Y nLabHisto ! 1;
             |MENAV mensaP;
             |HAZ Impre;
         |FINSI;
         |PARA v = 1; |SI v [ nCopiaCto; |HACIENDO v = v + 1;
             |INFOR informeDU;
             |PRINT;
             |PIEINF;
             |FININF;
         |SIGUE;
         |SI #10#19 = "S"; |Y nLabHisto ! 1;
             |FINIMP;
         |FINSI;
         |HAZ HojaBlancoDuplexW;
     |FINSI;
|FPRC;

|PROCESO HojaBlancoDuplexW;
     |SI #10#41 = "W";
          |INFOR "hojablan";
          |PRINT;
          |PIEINF;
          |FININF;
     |FINSI;
|FPRC;

||*************

|PROCESO masuna;   || SI EL REPRES. SINDICAL EXISTE EMITE UNA COPIA B. MAS
         alfa0 = #3#12;
     |QBF alfa0;
     |SI alfa0 ! "NO EXISTE"; |Y alfa0 ! ""; |Y #10#4 = 1;
             #10#37 = #10#37 + 1;
     |FINSI;
|FPRC;

|PROCESO fechafir;              || DESGLOSE DE FECHA DE FIRMA
     |SI #0#47 ! vpuntos; |Y #0#47 ! vblanco;
             fec1 = #0#47;
         |HAZ meseslet;
             dia = dia1;
             mes = meslet;
             anyo = any1;
     |SINO;
         dia = "..";
         mes = "..........";
         anyo = "....";
     |FINSI;
     |SI #0#27 = "S"; |O #0#27 = "s";  si1 = "si";  |FINSI;
     |SI #0#27 = "N"; |O #0#27 = "n";  si1 = "no";  |FINSI;
     |SI #2#21 ! 0;
             edad = #2#21;
     |FINSI;
|FPRC;

|PROCESO domicili;                    || RUTINA DEL CALCULO actualiz
     direcc = #1#3;                    || PARA CONSTRUCCION DOMICILIOS
     numero = #1#4;
     piso   = #1#5;
     cod1   = #1#7;
     cod2   = #1#8;
     locali = #1#6;
     |HAZ compac2;
     domemp = compactado;              || domicilio empresa
     direcc = #2#3;
     numero = #2#4;
     piso   = #2#5;
     cod1   = #2#8;
     cod2   = #2#9;
     locali = #2#6;
     |HAZ compac;
     domtra = compactado;              || domicilio trabajador
     direcc = #3#3;
     numero = #3#4;
     piso   = #3#5;
     cod1   = #3#7;
     cod2   = #3#8;
     locali = #3#6;
     |HAZ compac;
     domcen = compactado;              || domicilio centro trabajo
     domcen2 = direcc + ", " + numero + " - " + locali; || domicilio 2 centro
|FPRC;

|PROCESO localida;       || AJUSTA LOCALIDAD DE FIRMA EN REVERSOS DE CONTRATOS
         localida = #0#46;
     |QBF localida;
         localida = "                         " + localida;
         localida = localida % -125;
         #0#46 = localida;
|FPRC;

|PROCESO varios1;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #0#1;
     #3#1 = #0#3;
     |LEE 000#3=;
     |SI FSalida ! 0;
         |MENAV "    Centro de Trabajo inexistente ...";
     |FINSI;
     |CIERRA #3;
     aCodCCC = #3#10;

     |SI #0#0 = "087";|O #0#0 = "064";|O #0#0 = "085";|O #0#0 = "065";
     |O #0#0 = "421";
         |ABRE #11;
         |DDEFECTO #11;
             #11#0 = #2#0;         || empresa
             #11#13 = #2#77;       || centro
         |SI #0#0 = "085"; #11#1 = "87"; |FINSI;
         |SI #0#0 = "421"; #11#1 = "87"; |FINSI;
         |SI #0#0 = "064"; #11#1 = "64"; |FINSI;
         |SI #0#0 = "065"; #11#1 = "64"; |FINSI;
         |LEE 000#11=;
         |SI FSalida ! 0;
                 alfa1 = "    Centro Especial de Contratacion [" + #11#1 + "] inexistente ...";
             |MENAV alfa1;
         |FINSI;
         |CIERRA #11;
         aCodCCC = #11#10;
     |FINSI;
|FPRC;

|PROCESO actuplan;         || RUTINA DE ACTUALIZACIONES
     |ABRE #1;                  || abre empresas
         #1#0 = #0#1;
     |LEE 101#1=;               || lee empresa para actualizar plantilla
         #1#14 = #1#14 + 1;
     |GRABA 020#1a;
     |LIBERA #1;
     |CIERRA #1;

     |ABRE #3;                  || abre centros de trabajo
         #3#0 = #0#1;
         #3#1 = #0#3;
     |LEE 101#3=;               || lee centro para actualizar plantilla
         #3#11 = #3#11 + 1;
     |GRABA 020#3a;
     |LIBERA #3;
     |CIERRA #3;
|FPRC;

|PROCESO trad_cto;
     tcto=#0#0;
     |SI aProcedencia = "labcona6"; |Y #0#57 ! "N"; tcto = 309; |FINSI;
|FPRC;

|PROCESO fechabaja;
     #nomcalca#5 = #4#8;
     |GRABA 020#nomcalca.a;
|FPRC;

|DEFBUCLE nomcalca;
     #nomcalca#1;
     ;
     #2#0, #2#1,  1, 0;
     #2#0, #2#1, 12, 9;
     e;
     NULL, fechabaja;
|FIN;

|PROCESO tipo_cont;
     |ABRE #2;                 || abre trabajadores
      #2#0 = #0#1;
      #2#1 = #0#2;
     |LEE 121#2=;              || lee trabajador para actualizar tipo contrato

     |HAZ trad_cto;
     |SI #10#49=1; #2#45 = tcto; |FINSI;  || actualiza segun se haya elegido

     |SI #4#7 ! "..........";|Y #4#7 ! "          ";
          |SI #10#46=1;  #2#36 = #4#7;  |FINSI;   || antiguedad
          |SI #10#47=1;  #2#34 = #4#7;  |FINSI;   || alta
          |SI #10#48=1;  #2#38 = #4#7;  |FINSI;   || recibo
     |FINSI;

     |SI #10#3 = 1;|Y #4#8 ! "..........";|Y #4#8 ! "          ";
          |ABRE #nomcalca;
          #2#37 = #4#8;     || baja
          |BUCLE nomcalca;
     |FINSI;
     |GRABA 020#2a;
     |LIBERA #2;
     |CIERRA #2;
     |LIBERA #nomcalca;
     |CIERRA #nomcalca;
|FPRC;

|PROCESO ultimo;               || RUTINA PARA EL CALCULO DE LA ULTIMA
         limite = 0;                || CLAVE EN EL REGISTRO DE CONTRATOS
     |LEE 000#4u;
     |SI FSalida = 0;
          contador = #4#0 + 1;
     |SINO;
          contador = 1;
     |FINSI;
     |SI contador > 999999;
         |MENAV mensaM;
         |MENAV mensaN;
             limite = 1;
     |FINSI;
|FPRC;

|PROCESO trabaj;               || RUTINA PARA LA LECTURA DEL D.N.I.
     |ABRE #2;                      || DEL TRABAJADOR
         #2#0 = #0#1;
         #2#1 = #0#2;
     |LEE 000#2=;
         #4#3 = #2#7;
     |CIERRA #2;
|FPRC;

|PROCESO decret;               || RUTINA PARA LA LECTURA DE LA DESCRIP-
     |ABRE #5;                      || CION DEL DECRETO Y EL NUMERO DEL DECRETO
     |DDEFECTO #5;
         #5#0 = tcto;
     |LEE 000#5=;
     |CIERRA #5;
|FPRC;

|PROCESO reverinf;       || RUTINA PARA ASIGNAR LITERAL A VARIABLE 'informe?'
     |HAZ LeeProcedencia;

     informe2U="";  || para la tercera hoja
     informeDU="";  || para la tercera hoja
     |SI aProcedencia="labcon01";
          informe1="labcon01";
          informe2 = "rabcon01";
          informeD = "raxcon01";
     |FINSI;
     |SI aProcedencia="labconb1";
          informe1 = "labconb1";
          informe2 = "rabconb1";
          informeD = "raxconb1";
     |FINSI;
     |SI aProcedencia="labconb2";
          informe1 = "labconb2";
          informe2 = "rabconb2";
          informeD = "raxconb2";
     |FINSI;
     |SI aProcedencia="labcona5";
          informe1 = "labcona5";
          informe2 = "rabcona5";
          informeD = "raxcona5";
     |FINSI;
     |SI aProcedencia="labconb7";
          informe1 = "labconb7";
          informe2 = "rabconb7";
          informeD = "raxconb7";
          informe2U = "racconb7";
          informeDU = "rayconb7";
     |FINSI;
     |SI aProcedencia="labcona8";
          informe1 = "labcona8";
          informe2 = "rabcona8";
          informeD = "raxcona8";
     |FINSI;
     |SI aProcedencia="labcon75";
          informe1 = "labcon75";
          informe2 = "rabcon75";
          informeD = "raxcon75";
     |FINSI;
     |SI aProcedencia="labconb3";
          informe1 = "labconb3";
          informe2 = "rabconb3";
          informeD = "raxconb3";
          informe2U = "racconb3";
          informeDU = "rayconb3";
     |FINSI;
     |SI aProcedencia="labcon85";
          informe1 = "labcon85";
          informe2 = "rabcon85";
          informeD = "raxcon85";
     |FINSI;
     |SI aProcedencia="labcon36";
          informe1 = "labcon36";
          informe2 = "rabcon36";
          informeD = "raxcon36";
     |FINSI;
     |SI aProcedencia="labcona6";
          informe1 = "labcona6";
          informe2 = "rabcona6";
          informeD = "raxcona6";
     |FINSI;
     |SI aProcedencia="labcon05";
          informe1 = "labcon05";
          informe2 = "rabcon05";
          informeD = "raxcon05";
     |FINSI;
     |SI aProcedencia="labcon95";
          informe1 = "labcon95";
          informe2 = "rabcon95";
          informeD = "raxcon95";
     |FINSI;
     |SI aProcedencia="labcon09";
          informe1 = "labcon09";
          informe2 = "rabcon09";
          informeD = "raxcon09";
     |FINSI;
     |SI aProcedencia="labconx4";
          informe1 = "labconx4";
          informe2 = "rabconx4";
          informeD = "raxconx4";
     |FINSI;
     |SI aProcedencia="labconb5";
          informe1 = "labconb5";
          informe2 = "rabconb5";
          informeD = "raxconb5";
     |FINSI;
     |SI aProcedencia="labcon39";  || este tiene 3 hojas
          informe1 = "labcon39";
          informe2 = "rabcon39";
          informeD = "raxcon39";
          informe2U = "raccon39";
          informeDU = "raycon39";
     |FINSI;

     /* otros contratos */
     |SI aProcedencia="labcon96";
          informe1 = "labcon96";
          informe2 = "rabcon96";
          informeD = "raxcon96";
     |FINSI;
     |SI aProcedencia="labcon97";
          informe1 = "labcon97";
          informe2 = "rabcon97";
          informeD = "raxcon97";
     |FINSI;
     |SI aProcedencia="labcon98";
          informe1 = "labcon98";
          informe2 = "rabcon98";
          informeD = "raxcon98";
     |FINSI;
     |SI aProcedencia="labcon19";
          informe1 = "labcon19";
          informe2 = "rabcon19";
          informeD = "raxcon19";
     |FINSI;
     |SI aProcedencia="labcon99";
          informe1 = "labcon99";
          informe2 = "rabcon99";
          informeD = "raxcon99";
     |FINSI;
     |SI aProcedencia="labconb8";
          informe1 = "labconb8";
          informe2 = "rabconb8";
          informeD = "raxconb8";
          informe2U = "racconb8";
          informeDU = "rayconb8";
     |FINSI;

|FPRC;

|PROCESO cargatop;                           || CARGA VARIABLE DE TOPE DE
     |HAZ LeeProcedencia;

     |SI aProcedencia="labcon01";  topeclaus = 0;   |FINSI; || LINEAS MAXIMAS DE CLAUSULAS
     |SI aProcedencia="labconb1";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labconb2";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcona5";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcona8";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labconb7";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon75";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labconb3";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon85";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon36";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcona6";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon05";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon95";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon09";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labconx4";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labconb5";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon39";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labconb9";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon13";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon02";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon51";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon21";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon22";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon86";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon87";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon52";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon53";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon54";  topeclaus = 0;   |FINSI;
     |SI aProcedencia="labcon55";  topeclaus = 0;   |FINSI;

     /* otros contratos */
     |SI aProcedencia="labcon96";  topeclaus = 0;     |FINSI;
     |SI aProcedencia="labcon97";  topeclaus = 0;      |FINSI;
     |SI aProcedencia="labcon98";  topeclaus = 0;      |FINSI;
     |SI aProcedencia="labcon99";  topeclaus = 0;     |FINSI;
     |SI aProcedencia="labcon19";  topeclaus = 0;     |FINSI;
     |SI aProcedencia="labconb8";  topeclaus = 0;      |FINSI;
     |SI aProcedencia="labcon9a";  topeclaus = 0;      |FINSI;

     subtope = topeclaus + 8;   || variable de tope traducida a nro. campo
     linepunt = punt * 76; lineespa = espa * 76;  || de trabajo
     swhoja = 0;                                  || desactiva hoja adicional
     swtopes = 1;                                 || para no entrar mas aqui
|FPRC;

|PROCESO cleancla;       || ACERA LAS LINEAS DE CLAUSULAS
     |PARA g = 9; |SI g [ 26; |HACIENDO g = g + 1;
          #0g = "";
          |PINTA #0g;
     |SIGUE;
|FPRC;

|PROCESO recarga;   || ACTUALIZA LINEAS DE CLAUSULAS DE CONTRATO A TEMPORAL
     |ABRE #8;

     |PARA g = 9; |SI g [ 26; |HACIENDO g = g + 1;
             #8#0 = g - 8;
         |LEE 101#8=;
             FEstado = FSalida;
             #8#1 = #0g;
         |SI FEstado = 0;  |GRABA 020#8a;  |FINSI;
         |SI FEstado ! 0;  |GRABA 020#8n;  |FINSI;
         |LIBERA #8;                         || bucle para refrescar el
             #0g = "";                       ||/temporal desde la pantalla
     |SIGUE;
         #0#10 = ".- Ver en hoja adjunta.";
         espa = " ";

     |CIERRA #8;
|FPRC;

|PROCESO chequea;  || chequea el trabajador este en periodo de alta
         sistema = ~;   fecalf = sistema;
     |HAZ desglosa;
         sdia = wdia; smes = wmes; sany = wany;

         swfuera = 0;
         fecalf = #2#36;   || fecha de alta
     |HAZ desglosa;
     |SI wany > sany;
             swfuera = 1;
     |SINO;
         |SI wmes > smes; |Y wany = sany;
                 swfuera = 1;
         |FINSI;
     |FINSI;
     |SI swfuera = 0;
             fecalf = #2#37;  || fecha de baja
         |HAZ desglosa;
         |SI wany < sany; |Y wany ! 0;
                 swfuera = 1;
         |SINO;
             |SI wmes < smes; |Y wany = sany; |Y wmes ! 0;
                     swfuera = 1;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;


|| **************************************** SUBRUTINAS GENERALES
|| *************************************************************

|PROCESO meseslet;               || SUBRUTINA GENERAL DE TRANSFORMACION
     dia1 = fec1 % 102;           || DE FECHAS A LETRAS
     any1 = fec1 % 704;
     fec1 = fec1 % 402;
     fec2 = fec1;
     |SI fec2 = 1;   meslet = "Enero ....";   |FINSI;
     |SI fec2 = 2;   meslet = "Febrero ..";   |FINSI;
     |SI fec2 = 3;   meslet = "Marzo ....";   |FINSI;
     |SI fec2 = 4;   meslet = "Abril ....";   |FINSI;
     |SI fec2 = 5;   meslet = "Mayo .....";   |FINSI;
     |SI fec2 = 6;   meslet = "Junio ....";   |FINSI;
     |SI fec2 = 7;   meslet = "Julio ....";   |FINSI;
     |SI fec2 = 8;   meslet = "Agosto ...";   |FINSI;
     |SI fec2 = 9;   meslet = "Septiembre";   |FINSI;
     |SI fec2 = 10;  meslet = "Octubre ..";   |FINSI;
     |SI fec2 = 11;  meslet = "Noviembre ";   |FINSI;
     |SI fec2 = 12;  meslet = "Diciembre ";   |FINSI;
|FPRC;

|PROCESO nopasa;                   || SUBRUTINA PARA HACER <no modificable>
    aponer = "nono";                || LLAMADA EN LOS <nomodifX>
    fiac = Control % A1001;
    Control = Control + fiac;
    Control = Control + relleno;
    Control = Control % A120;
    Control = Control + aponer;
|FPRC;

|PROCESO compac;                      || SUBRUTINA DE RUTINA domicili
     setenta = espa * 70;
     compactado = "";                  || DE COMPACTACION DE CAMPOS
     |QBF direcc;
     |QBF numero;
     |QBF piso;
     |QBF cod1; cod1 = "00" + cod1;   cod1 = cod1 % -102;
     |QBF cod2; cod2 = "000" + cod2;  cod2 = cod2 % -103;
     |QBF locali;
     compactado = direcc + coma;
     compactado = compactado + numero;
     compactado = compactado + "  ";
     compactado = compactado + piso;
     compactado = compactado + " (";
     compactado = compactado + cod1;
     compactado = compactado + cod2;
     compactado = compactado + ") ";
     compactado = compactado + locali;
     compactado = compactado + setenta;
     compactado = compactado % 170;
|FPRC;

|PROCESO compac2;                      || SUBRUTINA DE RUTINA domicili
     compactado = "";                  || DE COMPACTACION DE CAMPOS
     |QBF direcc;                      || PARA EL DOMICILIO DE LA EMPRESA
     |QBF numero;
     |QBF piso;
     compactado = direcc + coma;
     compactado = compactado + numero;
     compactado = compactado + "  ";
     compactado = compactado + piso;
     compactado = compactado % 170;
|FPRC;


|PROCESO litedura;              || CONSTRUYE LITERAL DURACION PARA IMPRESION
     duratra = "";
     |SI mesestra ! 0;
         duratra = mesestra;
         duratra = duratra + " mes";
         |SI mesestra > 1;
             duratra = duratra + "es";
         |FINSI;
     |SINO;
         duratra = "...........";
     |FINSI;
     |SI diastra ! 0;
         |SI mesestra ! 0;
             duratra = duratra + xy;
         |FINSI;
         duratra = duratra + diastra;
         duratra = duratra + " dia";
         |SI diastra > 1;
             duratra = duratra + "s";
         |FINSI;
     |SINO;
         duratra = duratra + "............";
     |FINSI;
|FPRC;

|PROCESO edadanyo; |TIPO 0;      || CALCULA LA EDAD SEGUN FECHA ACTUAL
     |SI fechtra ! blanco; |Y fechtra ! puntos;
         sistema = ~;
         anynac1 = fechtra % -104;    || desglosa fecha nacimiento en a¤os
         anynac2 = anynac1;
         mesnac1 = fechtra %  402;    || meses
         mesnac2 = mesnac1;
         dianac1 = fechtra %  102;    || y dias
         dianac2 = dianac1;
         fechtra = sistema;
         anyact1 = fechtra % -104;    || desglosa fecha actual en a¤os
         anyact2 = anyact1;
         mesact1 = fechtra %  402;    || meses
         mesact2 = mesact1;
         diaact1 = fechtra %  102;    || y dias
         diaact2 = diaact1;
         edadxxx = anyact2 - anynac2; || halla los a¤os
         |SI mesnac2 > mesact2;
             edadxxx = edadxxx - 1;   || resta un a¤o si aun no ha llegado el mes
         |FINSI;
         |SI mesnac2 = mesact2; |Y dianac2 > diaact2; ||o si aun no ha llegado el dia
             edadxxx = edadxxx - 1;
         |FINSI;
     |SINO;
         edadxxx = 0;
     |FINSI;
|FPRC;

|PROCESO recarga2;
     |SI #4#07 ! "..........";|Y #4#07 ! "          ";
             #4#23 = #4#07;
     |SINO;
             #4#23 = "00.00.0000";
     |FINSI;
     |SI #4#08 ! "..........";|Y #4#08 ! "          ";
             #4#24 = #4#08;
     |SINO;
             #4#24 = "00.00.0000";
     |FINSI;
     |SI #4#19 ! "..........";|Y #4#19 ! "          ";
             #4#25 = #4#19;
     |SINO;
             #4#25 = "00.00.0000";
     |FINSI;
     |SI #4#20 ! "..........";|Y #4#20 ! "          ";
             #4#26 = #4#20;
     |SINO;
             #4#26 = "00.00.0000";
     |FINSI;
|FPRC;

|PROCESO desglosa;     || DESGLOSA EN DIA, MES Y ANYO UNA FECHA DD.MM.AAAA
     salfa1 = fecalf %  102;   wdia = salfa1;
     salfa1 = fecalf %  402;   wmes = salfa1;
     salfa1 = fecalf % -104;   wany = salfa1;
     |SI salfa1 = "....";
             wdia = 0;
             wmes = 0;
             wany = 0;
     |FINSI;
|FPRC;

|PROCESO lee_registro;
     sw_mismo = 0;
     |ABRE #4;
     |SELECT #2#4;
         #4#1 = #0#1;         || empresa
         #4#2 = #0#2;         || trabajador
     |LEE 000#4=;
     |SI FSalida = 0;
         |HAZ trad_cto;
         |SI tcto = #4#4;
                 sw_mismo = 1;
             |SI #4#22 ! 0;
                 alfa1 = "    Trabajador ya registrado con este contrato, acumulado: " + #4#18 + " meses y " + #4#22 + " dias.";
             |SINO;
                 alfa1 = "    Trabajador ya registrado con este contrato, acumulado: " + #4#18 + " meses.";
             |FINSI;
             |MENAV alfa1;
         |FINSI;
     |FINSI;
     |SELECT #1#4;
     |CIERRA #4;
|FPRC;

|PROCESO min90;
    #90#0 = #89#0;
    #90#1 = 1;
|FPRC;

|PROCESO max90;
    #90#0 = #89#0;
    #90#1 = 999;
|FPRC;

|PROCESO disposicion;
     |ABRE #89;
         #89#0 = #2#87;
     |LEE 101#89=;
     |SI FSalida ! 0;    |GRABA 020#89n;     |FINSI;

     |PUSHV 0501 2380;
     |PINPA #0#89;
     |PINDA #0#89;
     |ENTLINEAL #1#90, 2, 3, 22, 0, min90, max90;
     |POPV;

     |CIERRA #89;
|FPRC;

|PROCESO ModoDuplex;
     alfa1 = #10#42;     |QBF alfa1;    alfa2 = alfa1 % 0;  nume2 = alfa2;
     aDuplexSi = "";
     |PARA nume1 = 1; |SI nume1 [ nume2; |HACIENDO nume1 = nume1 + 3;
          nume3 = (nume1 * 100) + 3;
          alfa2 = alfa1 % nume3;
          nume3 = alfa2;
          |SI nume3 = 27;|O nume3 = 0;
               aDuplexSi = aDuplexSi + &27 + alfa2;
          |SINO;
               aDuplexSi = aDuplexSi + &nume3;
          |FINSI;
     |SIGUE;

     alfa1 = #10#43;     |QBF alfa1;    alfa2 = alfa1 % 0;  nume2 = alfa2;
     aDuplexNo = "";
     |PARA nume1 = 1; |SI nume1 [ nume2; |HACIENDO nume1 = nume1 + 3;
          nume3 = (nume1 * 100) + 3;
          alfa2 = alfa1 % nume3;
          nume3 = alfa2;
          |SI nume3 = 27;|O nume3 = 0;
               aDuplexNo = aDuplexNo + &27 + alfa2;
          |SINO;
               aDuplexNo = aDuplexNo + &nume3;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Impre;
     alfa1 = #10#44;
     |QBF alfa1;
     Impresora = alfa1;
     |IMPRE 0;
|FPRC;

______________________________/ REGISTRA CONTRATOS PARA LA FACTURACION
|PROCESO RegistraContrato;
    |SI #10#45 ! "S";
         |ACABA;
    |FINSI;

    fFecha = ~;     aFecha = fFecha;    aFecha = aFecha % A704;
    nAnyoContrato = aFecha;

    fFecha = ~;     aFecha = fFecha;    aFecha = aFecha % A402;
    nMesContrato = aFecha;

    nTipoContrato = #labtraba#45;
    nRegContrato  = contador;
    fFecContrato  = sistema;

    r_emp = #0#1;

    |SUB_EJECUTA "labregsb";
|FPRC;

|PROCESO LeePaises;
     |ABRE #21;
     #21#0=#0#1;
     |LEE 000#21=;
     |SI FSalida=0;
          nPaisEmpresa=#21#3;
     |SINO;
          nPaisEmpresa=724;
     |FINSI;
     |CIERRA #21;

     |ABRE #22;
     #22#0=#0#1;
     #22#1=#0#3;
     |LEE 000#22=;
     |SI FSalida=0;
          nPaisCentro=#22#3;
     |SINO;
          nPaisCentro=nPaisEmpresa;
     |FINSI;
     |CIERRA #22;

     |ABRE #labtraba;
     #labtraba#0 = #0#1;
     #labtraba#1 = #0#2;
     |LEE 000#labtraba.=;
     |SI FSalida = 0;
        ||aAlfa = #labtraba#7; aAlfa = aAlfa % 0101;
        aAlfa = #labtraba#76; aAlfa = aAlfa % 0101;
        ||SI aAlfa = "X";
        |SI aAlfa ! "1"; |Y aAlfa ! "2"; |Y aAlfa ! "3"; |Y aAlfa ! "4"; |Y aAlfa ! "5";
         |Y aAlfa ! "6"; |Y aAlfa ! "7"; |Y aAlfa ! "8"; |Y aAlfa ! "9"; |Y aAlfa ! "0";
           nPaisTrabaja = 724;
        |SINO;
           aAlfa = #labtraba#76; aAlfa = aAlfa % 0103;
           nPaisTrabaja = aAlfa;
        |FINSI;
     |FINSI;
     |CIERRA #labtraba;
|FPRC;

|PROCESO pacto; |TIPO 0;
     |SI aProcedencia = "labconb7";
          nCampo = 94;
     |SINO;
          nCampo = 61;
     |FINSI;
     |SI #0nCampo = "S"; |Y FSalida = 0;
          |PUSHV 0501 2380;
          |PINPA #0#labaux01;
          |DDEFECTO #labaux01;
          |ABRE #labaux01;
          #labaux01#0 = #0#1;
          #labaux01#1 = #0#2;
          |LEE 101#labaux01.=;
          FEstado = FSalida;

          |PINDA #0#labaux01;
          |ENDATOS #1#labaux01;
          |SI FSalida = 0;
               |SI FEstado = 0;    |GRABA 020#labaux01.a;     |FINSI;
               |SI FEstado ! 0;    |GRABA 020#labaux01.n;     |FINSI;
          |FINSI;
          |LIBERA #labaux01;
          |CIERRA #labaux01;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO DatosRelevo;
   |SI #0#Campo# = "S";
      |ABRE #labconre;
      #labconre#18 = -1;
      #labconre#19 = -1;
      #labconre#20 = -1;
      #labconre#21 = Usuario;
      |LEE 000#labconre.=;
      |SI FSalida = 0;
         |BORRA 020#labconre.a;
         |DDEFECTO #labconre;
         #labconre#18 = -1;
         #labconre#19 = -1;
         #labconre#20 = -1;
         #labconre#21 = Usuario;
      |FINSI;
      #labconre#4 = #0#1;
      |PUSHV 0501 2380;
      |PINPA #0#labconre; |PINDA #0#labconre;
      |ENDATOS #1#labconre;
      |SI FSalida ! 0;
         |ERROR;
      |SINO;
         |GRABA 020#labconre.n;
      |FINSI;
      |POPV;
      |CIERRA #labconre;
   |FINSI;
|FPRC;

|PROCESO MiraTipos;
     |SI FSalida = 10;
          |PUSHV  1306 1775;
          |BLANCO 1306 1775;
          |CUADRO 1306 1775;
          |ATRI R;
          |PINTA 1407, " (A) La de un trabajador a tiempo completo comparable               ";
          |PINTA 1507, " (B) La jornada a tiempo completo prevista en el C.C. de aplicacion ";
          |PINTA 1607, " (C) La jornada maxima legal                                        ";
          |ATRI N;
          |PAUSA;
          |POPV;
          |ERROR;
     |SINO;
          |SI FSalida = 2; |ACABA; |FINSI;
          |SI #0#Campo# = " "; |ERROR; |FINSI;
     |FINSI;
|FPRC;


|| ****************************************
|| ****************************************
|| ****************************************

|FICHEROS;
   labtmpct #9900;
   labtmpdt #9901,MANTE;
   labvaltb #9902;

   Referen@ #9990;
   Refere1@ #9991;
|FIN;

|VARIABLES;
   aClv     = "";
   aClv1    = "";
   aClv2    = "";
   aFich    = "";
   aTabla   = "";
   aValor   = "";
   aTipoDat = "";
   aAlfa1   = "";
   aAlfa3   = "";
   aCR      = "";
   aLF      = "";
   aComillas = "";
   aLong    = "";
   aCadena  = "";
   aRegistro = "";
   aTitulo  = "";
   aNombre  = "";

   nLinea   = 0;
   nSalida  = 0;
   nLong    = 0;
   nCalc1   = 0;
   nAbierto = 0;
   nCampo1  = 0;
   nCampo2  = 0;
   nPosic   = 0;
   nHandle  = 0;
   nLongDat = 0;
   nCmp     = 0;
   nClave   = 0;
   nSwNuevo = 0;
   nSwLectura = 0;
      nPos1 = 0; nPos2 = 0; nPos3 = 0;
|FIN;

|PROCESO Comprobacion;
   |ABRE #labempre; |ABRE #labtraba;
/*
   |SI nLabHisto ! 1;                   || no estoy desde el historico
         #labtmpct#1 = #contrato#1;     || cargo los valores desde del def
         #labtmpct#2 = #contrato#2;
   |FINSI;
*/
   #labempre#0 = #contrato#1;
   |LEE 101#labempre.=;
   |SI FSalida ! 0;
      aAlfa = "    No se encuentra la empresa [" + #contrato#1 + "]"; |MENAV aAlfa;
      |ACABA;
   |FINSI;

   #labtraba#0 = #contrato#1;
   #labtraba#1 = #contrato#2;
   |LEE 101#labtraba.=;
   |SI FSalida ! 0;
      |LIBERA #labempre;
      aAlfa = "    No se encuentra el trabajador [" + #contrato#1 + "/" + #contrato#2 + "]"; |MENAV aAlfa;
      |ACABA;
   |FINSI;
   |HAZ Comprueba1;

   |LIBERA #labempre; |LIBERA #labtraba;
   |CIERRA #labempre; |CIERRA #labtraba;
|FPRC;

|RUTINA inf;
   #labtmpdt#0 = 0000001;
|FRUT;

|RUTINA sup;
   #labtmpdt#0 = 9999999;
|FRUT;

|PROCESO CompruebaMunic;
   nTecla = FSalida;

   |ABRE #labmunic; |DDEFECTO #labmunic;

   #labmunic#4 = aCodPos;
   |LEE 000#labmunic.];
   |SI FSalida = 0; |Y #labmunic#4 = aCodPos;
      |SALVA_FICHA #labmunic;
      |LEE 000#labmunic.s;
      |SI FSalida = 0; |Y #labmunic#4 = aCodPos;
         nSwUno = 0;
      |SINO;
         nSwUno = 1;
      |FINSI;
      |REPON_FICHA #labmunic;
      |SI nSwUno = 0;
         #labmunic#4 = aCodPos;
         |LEE 000#labmunic.];
         |PARA; |SI FSalida = 0; |Y #labmunic#4 = aCodPos; |HACIENDO;
            aAlfa1 = #labmunic#3; |QBF aAlfa1; aLong = aAlfa1 % 0; nCalc1 = aLong;
            aAlfa2 = #labtraba#6; |QBF aAlfa2; aLong = aAlfa2 % 0; nCalc2 = aLong;
            |SI nCalc1 ] nCalc2;
               nCalc = 100 + nCalc2; aAlfa = aAlfa % nCalc;
            |SINO;
               nCalc = 100 + nCalc1; aAlfa1 = aAlfa1 % nCalc;
            |FINSI;
            |SI aAlfa1 = aAlfa2; |SAL; |FINSI;
            |LEE 000#labmunic.s;
         |SIGUE;
         |SI aAlfa1 ! aAlfa2;
            aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
            |SUB_EJECUTA "labmunic.tab";
            #labmunic#1 = aCodigoMunicipio;
            #labmunic#4 = aCodPos;
            |LEE 000#labmunic.=;
            |SI FSalida ! 0; |DDEFECTO #labmunic; |FINSI;
            #labtraba#6 = #labmunic#3; |PINTA #labtraba#6;
         |FINSI;
      |FINSI;
      |SI nSwUno = 1;
         #labtraba#6 = #labmunic#3; |PINTA #labtraba#6;
      |FINSI;
   |SINO;
      nSwError = 1;
   |FINSI;
   |CIERRA #labmunic;

   |SI nSwError = 1;
      |DDEFECTO #labtmpdt;
      |SELECT #2#labtmpdt;
      #labtmpdt#1 = aFich;
      #labtmpdt#2 = aCampo;
      #labtmpdt#3 = aClv1;
      #labtmpdt#4 = aClv2;
      |LEE 000#labtmpdt.=;
      nSalida = FSalida;
      |SELECT #1#labtmpdt;
      |SI nSalida ! 0;
         |DDEFECTO #labtmpdt;
         #labtmpdt#0 = nLinea; nLinea = nLinea + 1;
         #labtmpdt#1 = aFich;
         #labtmpdt#2 = nCampo;
         #labtmpdt#3 = aClv1;
         #labtmpdt#4 = aClv2;
         #labtmpdt#5 = aCodPos;
         aAlfa = "|C" + (("000" + nCampo) % -103) + "NOMBRE";
         aNombre = #labtraba#aAlfa#;
         aAlfa = "|TITULO"; aAlfa = #labtraba#aAlfa#;
         #labtmpdt#6 = aAlfa;
         #labtmpdt#7 = aNombre;
         #labtmpdt#8 = aRegistro;
         |GRABA 020#labtmpdt.n;
         nSwError = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Comprueba1;
   nSwError = 0;
   aClv1 = #labtraba#0; aClv2 = #labtraba#1;

   || aFich = "labtraba"; nCampo = 6;  aTabla = "tdpmunic"; nCmp = 1; |HAZ CompruebaValor1;
   aFich = "labtraba"; nCampo = 6;  aTabla = "tdpmunic"; nCmp = 1;
   aCodPos = (("00" + #labtraba#8) % -102) + (("000" + #labtraba#9) % -103);
   |HAZ CompruebaMunic;
   aFich = "labtraba"; nCampo = 12; aTabla = "thitiaca"; nCmp = 1; |HAZ CompruebaValor1;
   || aFich = "labtraba"; nCampo = 12; aTabla = "stiacatc"; nCmp = 1; |HAZ CompruebaValor1;
   aFich = "labtraba"; nCampo = 19; aTabla = "taiclaoc"; nCmp = 1; |HAZ CompruebaValor1;
   || aFich = "labtraba"; nCampo = 19; aTabla = "socupatc"; nCmp = 1; |HAZ CompruebaValor1;
   aFich = "labtraba"; nCampo = 33; aTabla = "tfggrcot"; nCmp = 0; |HAZ CompruebaValor1;
   aFich = "labtraba"; nCampo = 73; aTabla = "tbonvfor"; nCmp = 0; |HAZ CompruebaValor1;
   aAlfa = #labtraba#7; |QBF aAlfa; aAlfa = aAlfa % 0101;
   |SI aAlfa < "0"; |O aAlfa > "9";
      aFich = "labtraba"; nCampo = 76; aTabla = "spaisxtc"; nCmp = 1; |HAZ CompruebaValor1;
   |FINSI;

   || aClv1 = #labempre#0; aClv2 = "";
   || aFich = "labempre"; nCampo = 12; aTabla = "sacecotc"; nCmp = 1; |HAZ CompruebaValor1;

   aClv1 = #labtraba#0; aClv2 = #labtraba#1;
   aFich = "labpadre"; nCampo = 5; aTabla = "ssexoxtc"; nCmp = 0; |HAZ CompruebaValor1;
|FPRC;

|PROCESO CompruebaValor1;
   |DDEFECTO #labvaltb;
   #labvaltb#0 = aFich;
   #labvaltb#1 = nCampo;
   #labvaltb#5 = aClv1;
   #labvaltb#6 = aClv2;
   |LEE 000#labvaltb.=;
   |SI FSalida = 0;
      aValor = #labvaltb#4; |QBF aValor;
      |SI aFich = "labempre";
         aAlfa = #labempre#nCampo#; |QBF aAlfa;
/*
         |SI aAlfa ! aValor;
            #labempre#nCampo# = aValor;
            |GRABA 020#labempre.a;
         |FINSI;
*/
      |FINSI;
      |SI aFich = "labtraba";
         aAlfa = #labtraba#nCampo#; |QBF aAlfa;
         |SI aFich = "labtraba"; |Y nCampo = 76;
            aAlfa1 = aAlfa % 0101;
            |SI aAlfa ] "0"; |Y aAlfa [ "9"; aAlfa = aAlfa % 0599; |FINSI;
         |FINSI;
/*
         |SI aAlfa ! aValor;
            #labtraba#nCampo# = aValor;
            |GRABA 020#labtraba.a;
         |FINSI;
*/
      |FINSI;
   |SINO;
      |DBASE aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "def/" + aFich + ".mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |ABRE #Referen@;
         nClave = 1;
         aAlfa = "|K000"; aAlfa = #Referen@#aAlfa#; aAlfa = aAlfa % 0499;
         |PARA; |SI aAlfa ! ""; |HACIENDO;
            |SI nClave = 1; aClv = aClv1; |FINSI;
            |SI nClave = 2; aClv = aClv2; |FINSI;
            aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc = aAlfa1;
            #Referen@#nCalc# = aClv;
            nClave = nClave + 1;
         |SIGUE;
         |LEE 000#Referen@.=;
         |SI FSalida = 0;
            aValor = #Referen@#nCampo#; |QBF aValor;
            aAlfa = "|C" + (("000" + nCampo) % -103) + "TIPO";     aTipoDat = #Referen@#aAlfa#;
            aAlfa = "|C" + (("000" + nCampo) % -103) + "LONGITUD"; nLongDat = #Referen@#aAlfa#;
            |SI aTipoDat = "N";
               aAlfa = "0" * nLongDat; aAlfa = aAlfa + aValor;
               nLongDat = -(nLongDat + 100); aValor = aAlfa % nLongDat;
            |FINSI;
         |SINO;
            |SI aTabla = "ssexoxtc";
               |DDEFECTO #Referen@;
               nClave = 1;
               aAlfa = "|K000"; aAlfa = #Referen@#aAlfa#; aAlfa = aAlfa % 0499;
               |PARA; |SI aAlfa ! ""; |HACIENDO;
                  |SI nClave = 1; aClv = aClv1; |FINSI;
                  |SI nClave = 2; aClv = aClv2; |FINSI;
                  aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc = aAlfa1;
                  #Referen@#nCalc# = aClv;
                  nClave = nClave + 1;
               |SIGUE;
               aValor = #Referen@#nCampo#;
               |GRABA 020#Referen@.n;
            |SINO;
               |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
               nSwError = 1; |ACABA;
            |FINSI;
         |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;
   ||SINO;
   ||   nSwError = 1; |ACABA;
   |FINSI;

   nSwNuevo = 0;
/*
   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "def/" + aTabla + ".mas";
   |XABRE "E", aAlfa, nHandle;
   |SI FSalida < 0;
      aAlfa1 = aTabla;
      aAlfa = "SELECT * FROM labcotmp INTO " + aAlfa1 + ".def WHERE"; |SQL aAlfa;
      nSwNuevo = 1;
   |SINO;
      nSwNuevo = 0;
   |FINSI;
*/
   aAlfa1 = aTabla; |QBF aAlfa1; aAlfa1 = aAlfa1 - ".txt";
   |DBASE aAlfa; aAlfa = aAlfa + "def/" + aAlfa1 + ".mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |ABRE #Referen@;
      |LEE 000#Referen@.p;
      |SI FSalida ! 0; nSwLectura = 1; |FINSI;
      |SI nSwNuevo = 1; |O nSwLectura = 1; |DELINDEX #Referen@; |FINSI;
      |ABRE #Referen@;
      |SI nSwLectura = 1;
         aLF = &13; aComillas = &34; aCR = &10;
         |DBASE aAlfa; aAlfa = aAlfa + "tablas/" + aTabla + ".txt";
         aAlfa = "rb  " + aAlfa;
         |FABRE aAlfa;
         |SI FSalida ] 0;
            nHandle = FSalida;
            |MENSA "    Rellenando tabla .....";
            nCampo1 = 0; nAbierto = 0; nPosic = 0;
            |DDEFECTO #Referen@;
            aAlfa = nHandle + " 250"; |FLEE aAlfa;
            |PARA; |SI FSalida > 0; |HACIENDO;
               aAlfa1 = aAlfa - aLF;
               |PARA; |SI FSalida ! 0; |HACIENDO;
                  nCalc = ((FSalida / 100) ! 0) - 1; nPosic = nPosic + nCalc;
                  |SI nCalc > 99;
                     nCalc1 = 199; aAlfa1 = aAlfa % nCalc1; aAlfa = aAlfa - aAlfa1;
                     nCalc = nCalc - 99;
                  |SINO;
                     aAlfa1 = "";
                  |FINSI;
                  nCalc = nCalc + 100; aAlfa2 = (aAlfa % nCalc);
                  aAlfa1 = aAlfa1 + aAlfa2; aAlfa = aAlfa - aAlfa2;
                  aAlfa2 = aLF + aCR;     aAlfa = aAlfa - aAlfa2; nPosic = nPosic + 2;
                  nCampo1 = 0;
                  aAlfa2 = aAlfa1 - ";";
                  |PARA; |SI FSalida ! 0; |HACIENDO;
                     nCalc = ((FSalida / 100) ! 0) + 99; aAlfa2 = aAlfa1 % nCalc;
                     aLong = aAlfa1 % 0; nLong = aLong;
                     |SI nLong > 99;
                        nCalc1 = ((((FSalida / 100) ! 0) + 1) * 100) + 99; aAlfa3 = aAlfa1 % nCalc1;
                        aAlfa1 = aAlfa1 - aAlfa3;                    aAlfa1 = aAlfa1 % nCalc1;
                        aAlfa1 = aAlfa3 + aAlfa1;
                     |SINO;
                        nCalc = FSalida + 198;                       aAlfa1 = aAlfa1 % nCalc;
                     |FINSI;
                     aAlfa2 = aAlfa2 - aComillas;
                     |PARA; |SI FSalida ! 0; |HACIENDO;
                        aAlfa2 = aAlfa2 - aComillas;
                     |SIGUE;
                     |SI nCampo = 2; |O nCampo = 3;
                        aAlfa2 = (aAlfa2 % 0702) + "." + (aAlfa2 % 0502) + "." (aAlfa2 % 0104);
                     |FINSI;
                     #Referen@#nCampo1# = aAlfa2;
                     nCampo1 = nCampo1 + 1;
                     aAlfa2 = aAlfa1 - ";";
                  |SIGUE;
                  aAlfa1 = aAlfa1 - aComillas;
                  |PARA; |SI FSalida ! 0; |HACIENDO;
                     aAlfa1 = aAlfa1 - aComillas;
                  |SIGUE;
                  |SI nCampo = 2; |O nCampo = 3;
                     aAlfa1 = (aAlfa1 % 0702) + "." + (aAlfa1 % 0502) + "." (aAlfa1 % 0104);
                  |FINSI;
                  aCadena = aAlfa1; |HAZ QuitaRaros; aAlfa1 = aCadena;
                  #Referen@#nCampo1# = aAlfa1;
                  #Referen@#4 = aTabla;
                  |GRABA 020#Referen@.n; |DDEFECTO #Referen@;
                  aAlfa1 = aAlfa - aLF;
                  |SI aAlfa1 = ""; FSalida = 0; |FINSI;
               |SIGUE;
               Pos = nPosic;
               aAlfa = nHandle + " 250"; |FLEE aAlfa;
            |SIGUE;
            |BLIN 4;
         |FINSI;
         FSalida = nHandle; |FCIERRA FSalida;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "def/" + aTabla + ".mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |ABRE #Referen@;
      |SI nCmp = 0; |SELECT #1#Referen@; |FINSI;
      |SI nCmp = 1; |SELECT #2#Referen@; |FINSI;
      #Referen@#nCmp# = aValor;
      |LEE 000#Referen@.=;
      |SI FSalida ! 0;
         |DBASE aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + "def/" + aFich + ".mas";
         |CARGA_DEF aAlfa, Refere1@;
         |SI FSalida = 0;
            |ABRE #Refere1@; nClave = 1; aRegistro = "";
            aAlfa = "|TITULO"; aTitulo = #Refere1@#aAlfa#;
            aAlfa = "|C" + (("000" + nCampo) % -103) + "NOMBRE";
            aNombre = #Refere1@#aAlfa#;
            aAlfa = "|K000"; aAlfa = #Refere1@#aAlfa#; aAlfa = aAlfa % 0499;
            |PARA; |SI aAlfa ! ""; |HACIENDO;
               |SI nClave = 1; aClv = aClv1; |FINSI;
               |SI nClave = 2; aClv = aClv2; |FINSI;
               aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc = aAlfa1;
               #Refere1@#nCalc# = aClv;
               nClave = nClave + 1;
            |SIGUE;
            |LEE 000#Refere1@.=;
            |SI FSalida = 0;
               aRegistro = #Refere1@#2;
               aAlfa1 = aClv1; |QBF aAlfa1;
               |SI aAlfa1 ! "";
                  aAlfa = "[" + aAlfa1;
                  aAlfa1 = aClv2; |QBF aAlfa1;
                  |SI aAlfa1 ! "";
                     aAlfa = aAlfa + "/" + aAlfa1 + "] ";
                  |SINO;
                     aAlfa = aAlfa + "] ";
                  |FINSI;
               |SINO;
                  aAlfa1 = aClv2; |QBF aAlfa1;
                  |SI aAlfa1 ! ""; aAlfa = "[" + aAlfa1 + "] "; |FINSI;
               |FINSI;
               aRegistro = aAlfa + aRegistro;
            |FINSI;
            |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
         |FINSI;

         |DDEFECTO #labtmpdt;
         |SELECT #2#labtmpdt;
         #labtmpdt#1 = aFich;
         #labtmpdt#2 = nCampo;
         #labtmpdt#3 = aClv1;
         #labtmpdt#4 = aClv2;
         |LEE 000#labtmpdt.=;
         nSalida = FSalida;
         |SELECT #1#labtmpdt;
         |SI nSalida ! 0;
            |DDEFECTO #labtmpdt;
            #labtmpdt#0 = nLinea; nLinea = nLinea + 1;
            #labtmpdt#1 = aFich;
            #labtmpdt#2 = nCampo;
            #labtmpdt#3 = aClv1;
            #labtmpdt#4 = aClv2;
            #labtmpdt#5 = aValor;
            #labtmpdt#6 = aTitulo;
            #labtmpdt#7 = aNombre;
            #labtmpdt#8 = aRegistro;
            |GRABA 020#labtmpdt.n;
            nSwError = 1;
         |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |SINO;
      nSwError = 1; |ACABA;
   |FINSI;
|FPRC;

|PROCESO PideDatos;
     |SI #labcontr#55 = "N"; |ACABA; |FINSI;
     aAlfa = "tm" + Usuario; |NOME_DAT #9901 aAlfa;
     |DELINDEX #labtmpdt; |ABRE #labtmpdt; nLinea = 1;
     |ABRE #labvaltb;
     nSwError = 0;
     |HAZ Comprobacion;
     |PARA; |SI nSwError = 1; |HACIENDO;
        |PUSHV 0501 2380;
        |ENTLINEAL #1#labtmpdt, -1, 4, 18, 1, inf, sup;
        |POPV;
        |CIERRA #labtmpdt; |DELINDEX #labtmpdt; |ABRE #labtmpdt;
        nSwError = 0; |HAZ Comprobacion;
        |SI nSwError ! 0;
           |CONFI "    NAun hay datos erroneos. Volver a editar ?";
           |SI FSalida ! 0;
              || nSwError = 1;
              nSwError = 0;   || para que me deje pasar

              |SAL;
           |FINSI;
        |FINSI;
     |SIGUE;
     |CIERRA #labvaltb;

     |CIERRA #labtmpdt; |DELINDEX #labtmpdt;
|FPRC;

|PROCESO TFD; |TIPO 7; || Trabajos duracion determinada
     |HAZ LeeProcedencia;
     |SI aProcedencia = "labcon01";     nCampo = 28;   |FINSI;
     |SI aProcedencia = "labcon02";     nCampo = 75;   |FINSI;
     |SI aProcedencia = "labconb2";     nCampo = 28;   |FINSI;
     |SI aProcedencia = "labcona5";     nCampo = 57;   |FINSI;
     |SI aProcedencia = "labcon95";     nCampo = 27;   |FINSI;
     |SI aProcedencia = "labcon09";     nCampo = 64;   |FINSI;
     |SI aProcedencia = "labcon39";     nCampo = 27;   |FINSI;
     |SI aProcedencia = "labconb5";     nCampo = 64;   |FINSI;
     |SI aProcedencia = "labcon13";     nCampo = 28;   |FINSI;
     |SI aProcedencia = "labcon9a";     nCampo = 27;   |FINSI;
     |SI #0nCampo = "P";
          |SI aProcedencia = "labcon02";
               |CAMPO_POSICION #0#101, 1, 1126;
          |FINSI;
          |CAMPO_VISUAL #0#101, 1, "S";
          |CAMPO_MODIFICA #0#101, 1, "S";
          |PINTA #0#101;
     |SINO;
          |CAMPO_VISUAL #0#101, 1, "N";
          |CAMPO_MODIFICA #0#101, 1, "N";
          |SI aProcedencia = "labcon01";     |PINTA 1125, "   ";  |FINSI;
          |SI aProcedencia = "labcon02"; |Y #0nCampo ! "F";
               |PINTA 1125, "   ";
          |FINSI;
          |SI aProcedencia = "labconb2";     |PINTA 1124, "   ";  |FINSI;
          |SI aProcedencia = "labcona5";     |PINTA 1625, "   ";  |FINSI;
          |SI aProcedencia = "labcon95";     |PINTA 1125, "   ";  |FINSI;
          |SI aProcedencia = "labcon09";     |PINTA 1125, "   ";  |FINSI;
          |SI aProcedencia = "labcon39";     |PINTA 1146, "   ";  |FINSI;
          |SI aProcedencia = "labconb5";     |PINTA 1525, "   ";  |FINSI;
          |SI aProcedencia = "labcon13";     |PINTA 1125, "   ";  |FINSI;
          |SI aProcedencia = "labcon9a";     |PINTA 1125, "   ";  |FINSI;
          #0#101 = "N";
     |FINSI;
|FPRC;

|PROCESO TipoMinus; |TIPO 7;
     |SI aProcedencia = "labconx4";
          nPos1 = 0804; nPos2 = 0836; nPos3 = 0858;
     |FINSI;
     |SI aProcedencia = "labcon09";
          nPos1 = 1104; nPos2 = 1136; nPos3 = 1158;
     |FINSI;
     |SI aProcedencia = "labconb5";
          nPos1 = 2004; nPos2 = 2036; nPos3 = 2058;
     |FINSI;
     |SI aProcedencia = "labcon09"; |O aProcedencia = "labconx4";
      |O aProcedencia = "labconb5";

          |CAMPO_MODIFICA #0#90, 1, "S";
          |CAMPO_MODIFICA #0#91, 1, "S";
          |CAMPO_MODIFICA #0#92, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#90, 1, "N";
          |CAMPO_MODIFICA #0#91, 1, "N";
          |CAMPO_MODIFICA #0#92, 1, "N";
          #0#90 = " ";
          #0#91 = " ";
          #0#92 = " ";
          |PINTA nPos1, "                        ";
          |PINTA nPos2, "      ";
          |PINTA nPos3, "                 ";
     |FINSI;
|FPRC;

|PROCESO PintaDatoMinus; |TIPO 14;
     |SI aProcedencia = "labconx4";
          nPos1 = 0804; nPos2 = 0836; nPos3 = 0858;
     |FINSI;
     |SI aProcedencia = "labcon09";
          nPos1 = 1104; nPos2 = 1136; nPos3 = 1158;
     |FINSI;
     |SI aProcedencia = "labconb5";
          nPos1 = 2004; nPos2 = 2036; nPos3 = 2058;
     |FINSI;
     |ATRI I;
     |SI Campo = 90;
          |SI #0Campo = "0";
               |PINTA nPos1, "Sin discapacidad severa";
          |FINSI;
          |SI #0Campo = "1";
               |PINTA nPos1, "Con discapacidad severa";
          |FINSI;
     |FINSI;
     |SI Campo = 91;
          |SI #0Campo = "H";
               |PINTA nPos2, "Hombre";
          |FINSI;
          |SI #0Campo = "M";
               |PINTA nPos2, "Mujer ";
          |FINSI;
     |FINSI;
     |SI Campo = 92;
          |SI #0Campo = "0";
               |PINTA nPos3, "Menor de 45 a¤os";
          |FINSI;
          |SI #0Campo = "1";
               |PINTA nPos3, "Mayor de 45 a¤os";
          |FINSI;
     |FINSI;
     |ATRI 0;
|FPRC;

|PROCESO CompMinus;
     |SI aProcedencia = "labconx4";
          nPos1 = 0804; nPos2 = 0836; nPos3 = 0858;
     |FINSI;
     |SI aProcedencia = "labcon09";
          nPos1 = 1104; nPos2 = 1136; nPos3 = 1158;
     |FINSI;
     |SI aProcedencia = "labconb5";
          nPos1 = 2004; nPos2 = 2036; nPos3 = 2058;
     |FINSI;
     |PARA nCampo = 90; |SI nCampo [ 92; |HACIENDO nCampo = nCampo + 1;
          |SI #0nCampo = " ";
               #0#90 = " ";
               #0#91 = " ";
               #0#92 = " ";
               |PINTA nPos1, "                        ";
               |PINTA nPos2, "      ";
               |PINTA nPos3, "                 ";
               |PINTA #0#90;
               |PINTA #0#91;
               |PINTA #0#92;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO RestauraCon;
     |POPV;
|FPRC;

|PROCESO Bonificacion224;
     aBonif224 = "N";
     |SI aProcedencia = "labcon01";
          nCampo1 = 62;
          |SI #0nCampo1 = "S";
               aBonif224 = "S";
          |FINSI;
     |FINSI;
     |SI aProcedencia = "labconb1";
          nCampo1 = 58; nCampo2 = 60;
          |SI #0nCampo1 = "X"; |O #0nCampo2 = "X";
               aBonif224 = "S";
          |FINSI;
          nCampo1 = 59;
          |SI #0nCampo1 = "S";
               aBonif224 = "S";
          |FINSI;
     |FINSI;
     |SI aProcedencia = "labcon09";
          nCampo1 = 62;
          |SI #0nCampo1 = "S";
               aBonif224 = "S";
          |FINSI;
     |FINSI;
     |SI aProcedencia = "labcon95"; |O aProcedencia = "labcon9a";
          nCampo1 = 79; nCampo2 = 80;
          |SI #0nCampo1 = "X"; |O #0nCampo2 = "X";
               aBonif224 = "S";
          |FINSI;
          nCampo1 = 62;
          |SI #0nCampo1 = "S";
               aBonif224 = "S";
          |FINSI;
     |FINSI;
     |SI aProcedencia = "labconb3";
          nCampo1 = 57; nCampo2 = 58;
          |SI #0nCampo1 = "X"; |O #0nCampo2 = "X";
               aBonif224 = "S";
          |FINSI;
          nCampo1 = 62; nCampo2 = 81;
          |SI #0nCampo1 = "S"; |O #0nCampo2 = "S";
               aBonif224 = "S";
          |FINSI;
     |FINSI;
     |SI aProcedencia = "labconx4";
          nCampo1 = 51;
          |SI #0nCampo1 = "S";
               aBonif224 = "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MuestraAnexo; |TIPO 7;
     nEmp = #0#1;
     nTra = #0#2;
     |SI #0Campo = "S";
          |ABRE #labco224;
          #labco224#0 = #0#1;
          #labco224#1 = #0#2;
          |LEE 000#labco224.=;
          |SI FSalida = 0;
               |PUSHV 14372380;
               |PINPA #0#labco224;
               |PINDA #0#labco224;
          |FINSI;
          |CIERRA #labco224;
     |FINSI;
|FPRC;

|PROCESO EditaAnexo;
     nEmp = #0#1;
     nTra = #0#2;
     |SI #0Campo = "S";
          |SI FSalida = 13; |O Contenido = "N";
               |HAZ Bonificacion224;
               |SUB_EJECUTA "labco224";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Activa93; |TIPO 7;
     nNume = 28;
     |SI aProcedencia = "labcon95"; |O aProcedencia = "labcon9a";
          nNume = 27;
     |FINSI;
     |SI aProcedencia = "labcon09";
          nNume = 64;
     |FINSI;
     |SI #0nNume = "P";
          |CAMPO_MODIFICA #0#93, 1, "S";
     |SINO;
          |CAMPO_MODIFICA #0#93, 1, "N";
          #0#93 = "N";
          |PINTA #0#93;
     |FINSI;
|FPRC;

|PROCESO CompFecha;
     aFecha = #0Campo;
     |HAZ CompFecha_plb;
|FPRC;
