|FICHEROS;
     eoszp002;

     eosclien;
     eosactiv;
     eoslinco;
     eosconce;
     eosconc6;

     dsmom073;
     eosm0028;
     eosm0029;
     eosm0030;
     eosm0031;
     eosm0032;
     eosm0035;
|FIN;

|VARIABLES;
     aAlfa      = "";

     nCampo     = 0;
     nCampo1    = 0;
     nEmpresa   = 0;
     nDActivid  = 0;
     nHActivid  = 0;
     nDPeriodo  = 0;
     nHPeriodo  = 0;
     nAnyo      = 0;

     aDinEsp    = "";
     aClave     = "";
     aSubClave  = "";
     nBase      = 0;
     nReten     = 0;

     nTipo1     = 0;
     aPasar1    = "";
     aDinEsp1   = "";
     aClave1    = "";
     aSubClave1 = "";

     nTipo2     = 0;
     aPasar2    = "";
     aDinEsp2   = "";
     aClave2    = "";
     aSubClave2 = "";

     nTipo3     = 0;
     aPasar3    = "";
     aDinEsp3   = "";
     aClave3    = "";
     aSubClave3 = "";

     &enEmpresa  = 0;
     &enEjercic  = 0;
     &enEjerIRPF = 0;
|FIN;

|INCLUYE i_consul;
|INCLUYE i_ficher;

|PROCESO Ejercicio; |TIPO 7;
     aAlfa = "01.01." + #eoszp002#40;   #eoszp002#42 = aAlfa;   |PINTA #eoszp002#42;
     aAlfa = "31.12." + #eoszp002#40;   #eoszp002#43 = aAlfa;   |PINTA #eoszp002#43;
|FPRC;

|PROCESO Activi; |TIPO 0;
     nCampo1 = Campo - 20;

     |SI #eoszp002#nCampo1# = 0; |Y #eoszp002#Campo# = 0; |ACABA; |FINSI;

     |SI #eoszp002#Campo#   = 0;  |ACABA;  |FINSI;

     aAlfa = #eoszp002#40 % -102;
     |ABRE #eosactiv;
     #eosactiv#0 = #eoszp002#nCampo1#;
     #eosactiv#1 = #eoszp002#Campo#;
     #eosactiv#2 = aAlfa;
     |LEE 040#eosactiv.=;
     |SI FSalida ! 0;
         |CIERRA #eosactiv;
         |MENAV "     No existe la Actividad.";
         #eoszp002#Campo#  = 0; |PINTA #eoszp002#Campo#;
         |PTEC 808;
         |PTEC 808;
         |ACABA;
     |FINSI;
     |CIERRA #eosactiv;

     |SI #eosactiv#41 ! "S";
         |MENAV "     La Actividad no es agraria.";
         |ACABA;
     |FINSI;

     |SI #eosactiv#17 = "R";
         |MENAV "     La Actividad no tiene Retenciones.";
         #eoszp002#nCampo1# = 0; |PINTA #eoszp002#nCampo1#;
         #eoszp002#Campo#   = 0; |PINTA #eoszp002#Campo#;
         |PTEC 808;
         |PTEC 808;
     |FINSI;
|FPRC;

|PROCESO GrabaApu2015;
     |SI aClave = "A";           || Tique 700000_9602
         |SI #eoszp002#40 < 2015;
             aSubClave = "  ";
         |SINO;
             |SI aSubClave = "  ";
                 aSubClave = "01";
             |FINSI;
         |FINSI;
     |FINSI;

     #eosm0031#0  = nEmpresa;
     #eosm0031#1  = #eoszp002#40;
     #eosm0031#2  = #eoslinco#12;
     |LEE 101#eosm0031.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0031;
         #eosm0031#0  = nEmpresa;
         #eosm0031#1  = #eoszp002#40;
         #eosm0031#2  = #eoslinco#12;
         #eosm0031#3  = #eoslinco#38;
         |GRABA 020#eosm0031.n;
     |FINSI;
     |LIBERA #eosm0031;

     aAlfa = #eoslinco#13 % 402;
     #eosm0032#0  = nEmpresa;
     #eosm0032#1  = #eoszp002#40;
     #eosm0032#2  = #eoslinco#12;
     #eosm0032#3  = aClave;
     #eosm0032#4  = aSubClave;
     #eosm0032#5  = 0;
     |SI #eosm0032#3 = "A";  #eosm0032#5  = #eosm0029#6;  |FINSI;

     #eosm0032#6  = aAlfa;
     |LEE 101#eosm0032.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0032;
         #eosm0032#0  = nEmpresa;
         #eosm0032#1  = #eoszp002#40;
         #eosm0032#2  = #eoslinco#12;
         #eosm0032#3  = aClave;
         #eosm0032#4  = aSubClave;
         #eosm0032#5  = 0;
         |SI #eosm0032#3 = "A";  #eosm0032#5  = #eosm0029#6;  |FINSI;
         #eosm0032#6  = aAlfa;
         |GRABA 020#eosm0032.b;
     |FINSI;

     enEjerIRPF = #eosm0032#1;
     |HAZ BuscaEjerIRPF;

     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #eosm0032#3;
     #dsmom073#2 = #eosm0032#4;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom073;  |FINSI;

     |SI #dsmom073#5 = "N";  aDinEsp = "D";  |FINSI;
     |SI #dsmom073#0 = "L"; |Y #dsmom073#1 = "24";  aDinEsp = "E";  |FINSI;

     |SI aDinEsp = "D";
         |SI #dsmom073#6 = "S";
             #eosm0032#7  = #eosm0032#7 + nBase;
         |SINO;
             #eosm0032#7  = #eosm0032#7 + nBase;
             #eosm0032#9  = #eosm0032#9 + nReten;
             #eosm0032#8  = (#eosm0032#9 / #eosm0032#7) * 100;
         |FINSI;
     |SINO;
         #eosm0032#10 = #eosm0032#10 + nBase;
         #eosm0032#12 = #eosm0032#12 + nReten;
         #eosm0032#11 = (#eosm0032#12 / #eosm0032#10) * 100;
     |FINSI;

     |GRABA 020#eosm0032.a;
     |LIBERA #eosm0032;

     #eosclien#0 = #eosm0032#0;
     |LEE 040#eosclien.=;
     |SI FSalida ! 0;  |DDEFECTO #eosclien;  |FINSI;

     #eosm0030#0 = #eosm0032#0;
     #eosm0030#1 = #eosm0032#1;
     |LEE 101#eosm0030.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0030;
         #eosm0030#0  = #eosm0032#0;
         #eosm0030#1  = #eosm0032#1;
         #eosm0030#2  = #eosclien#3;
         #eosm0030#15 = #eosclien#3;
         #eosm0030#16 = #eosclien#14;
         #eosm0030#17 = #eosclien#3;
         |GRABA 020#eosm0030.n;
     |FINSI;
     |LIBERA #eosm0030;
|FPRC;

|PROCESO GrabaApu2016;
     |SI aClave = "A";
         aSubClave = "";
     |FINSI;

     #eosm0031#0  = nEmpresa;
     #eosm0031#1  = #eoszp002#40;
     #eosm0031#2  = #eoslinco#12;
     |LEE 101#eosm0031.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0031;
         #eosm0031#0  = nEmpresa;
         #eosm0031#1  = #eoszp002#40;
         #eosm0031#2  = #eoslinco#12;
         #eosm0031#3  = #eoslinco#38;
         |GRABA 020#eosm0031.n;
     |FINSI;
     |LIBERA #eosm0031;

     aAlfa = #eoslinco#13 % 402;
     #eosm0035#0  = nEmpresa;
     #eosm0035#1  = #eoszp002#40;
     #eosm0035#2  = #eoslinco#12;
     #eosm0035#3  = aClave;
     #eosm0035#4  = aSubClave;
     #eosm0035#5  = 0;
     |SI #eosm0035#3 = "A";  #eosm0035#5  = #eosm0029#6;  |FINSI;

     #eosm0035#6  = aAlfa;
     |LEE 101#eosm0035.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0035;
         #eosm0035#0  = nEmpresa;
         #eosm0035#1  = #eoszp002#40;
         #eosm0035#2  = #eoslinco#12;
         #eosm0035#3  = aClave;
         #eosm0035#4  = aSubClave;
         #eosm0035#5  = 0;
         |SI #eosm0035#3 = "A";  #eosm0035#5  = #eosm0029#6;  |FINSI;
         #eosm0035#6  = aAlfa;
         |GRABA 020#eosm0035.b;
     |FINSI;

     enEjerIRPF = #eosm0035#1;
     |HAZ BuscaEjerIRPF;

     #dsmom073#0 = enEjerIRPF;
     #dsmom073#1 = #eosm0035#3;
     #dsmom073#2 = #eosm0035#4;
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom073;  |FINSI;

     |SI #dsmom073#5 = "N";
         aDinEsp = "D";
     |FINSI;

     |SI #dsmom073#0 = "L"; |Y #dsmom073#1 = "24";
         aDinEsp = "E";
     |FINSI;

     |SI aDinEsp = "D";
         |SI #dsmom073#6 = "S";
             #eosm0035#7  = #eosm0035#7 + nBase;
         |SINO;
             #eosm0035#7  = #eosm0035#7 + nBase;
             #eosm0035#9  = #eosm0035#9 + nReten;
             #eosm0035#8  = (#eosm0035#9 / #eosm0035#7) * 100;
         |FINSI;
     |SINO;
         #eosm0035#10 = #eosm0035#10 + nBase;
         #eosm0035#12 = #eosm0035#12 + nReten;
         #eosm0035#11 = (#eosm0035#12 / #eosm0035#10) * 100;
     |FINSI;

     |GRABA 020#eosm0035.a;
     |LIBERA #eosm0035;

     #eosclien#0 = #eosm0035#0;
     |LEE 040#eosclien.=;
     |SI FSalida ! 0;  |DDEFECTO #eosclien;  |FINSI;

     #eosm0030#0 = #eosm0035#0;
     #eosm0030#1 = #eosm0035#1;
     |LEE 101#eosm0030.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0030;
         #eosm0030#0  = #eosm0035#0;
         #eosm0030#1  = #eosm0035#1;
         #eosm0030#2  = #eosclien#3;
         #eosm0030#15 = #eosclien#3;
         #eosm0030#16 = #eosclien#14;
         #eosm0030#17 = #eosclien#3;
         |GRABA 020#eosm0030.n;
     |FINSI;
     |LIBERA #eosm0030;
|FPRC;

|PROCESO GrabaApunte;
     |SI #eoszp002#40 [ 2015;
         |HAZ GrabaApu2015;
     |FINSI;

     |SI #eoszp002#40 ] 2016;
         |HAZ GrabaApu2016;
     |FINSI;
|FPRC;

|PROCESO eoslinco;
     |SI #eoslinco#39 = 0; |Y #eoslinco#40 = 0;
      |Y #eoslinco#41 = 0;
         |ACABA;
     |FINSI;

     #eosactiv#0 = #eoslinco#0;
     #eosactiv#1 = #eoslinco#19;
     #eosactiv#2 = #eoslinco#14;
     |LEE 040#eosactiv.=;
     |SI FSalida ! 0; |DDEFECTO #eosactiv; |FINSI;

     |SI #eosactiv#50 = 1;
         #eosconce#0 = #eoslinco#5;
         |LEE 040#eosconce.=;
         |SI FSalida ! 0; |DDEFECTO #eosconce; |FINSI;
         nTipo1     = #eosconce#9;
         aPasar1    = #eosconce#10;
         aDinEsp1   = #eosconce#14;
         aClave1    = #eosconce#12;  |QBF aClave1;
         aSubClave1 = #eosconce#13;

         #eosconce#0 = #eoslinco#33;
         |LEE 040#eosconce.=;
         |SI FSalida ! 0; |DDEFECTO #eosconce; |FINSI;
         nTipo2     = #eosconce#9;
         aPasar2    = #eosconce#10;
         aDinEsp2   = #eosconce#14;
         aClave2    = #eosconce#12;   |QBF aClave2;
         aSubClave2 = #eosconce#13;

         #eosconce#0 = #eoslinco#34;
         |LEE 040#eosconce.=;
         |SI FSalida ! 0; |DDEFECTO #eosconce; |FINSI;
         nTipo3     = #eosconce#9;
         aPasar3    = #eosconce#10;
         aDinEsp3   = #eosconce#14;
         aClave3    = #eosconce#12;    |QBF aClave3;
         aSubClave3 = #eosconce#13;
     |SINO;
         #eosconc6#0 = #eoslinco#72;
         |LEE 040#eosconc6.=;
         |SI FSalida ! 0; |DDEFECTO #eosconc6; |FINSI;
         nTipo1     = #eosconc6#9;
         aPasar1    = #eosconc6#10;
         aDinEsp1   = #eosconc6#21;
         aClave1    = #eosconc6#19;  |QBF aClave1;
         aSubClave1 = #eosconc6#20;

         #eosconc6#0 = #eoslinco#73;
         |LEE 040#eosconc6.=;
         |SI FSalida ! 0; |DDEFECTO #eosconc6; |FINSI;
         nTipo2     = #eosconc6#9;
         aPasar2    = #eosconc6#10;
         aDinEsp2   = #eosconc6#21;
         aClave2    = #eosconc6#19;    |QBF aClave2;
         aSubClave2 = #eosconc6#20;

         #eosconc6#0 = #eoslinco#74;
         |LEE 040#eosconc6.=;
         |SI FSalida ! 0; |DDEFECTO #eosconc6; |FINSI;
         nTipo3     = #eosconc6#9;
         aPasar3    = #eosconc6#10;
         aDinEsp3   = #eosconc6#21;
         aClave3    = #eosconc6#19;    |QBF aClave3;
         aSubClave3 = #eosconc6#20;
     |FINSI;

     |SI aPasar1 = "N"; |Y aPasar2 = "N"; |Y aPasar3 = "N";
         |ACABA;
     |FINSI;

     |SI aClave1 = ""; |Y aClave2 = ""; |Y aClave3 = "";
         |ACABA;
     |FINSI;

     #eosm0029#0 = nEmpresa;
     #eosm0029#1 = #eoslinco#12;
     |LEE 101#eosm0029.=;
     |SI FSalida ! 0;
         |DDEFECTO #eosm0029;
         #eosm0029#0 = nEmpresa;
         #eosm0029#1 = #eoslinco#12;
         #eosm0029#2 = #eoslinco#38;
         |GRABA 020#eosm0029.n;

         #eosclien#0 = nEmpresa;
         |LEE 040#eosclien.=;
         |SI FSalida ! 0;  |DDEFECTO #eosclien;  |FINSI;

         |ABRE #eosm0028;
         #eosm0028#0 = nEmpresa;
         |LEE 101#eosm0028.=;
         |SI FSalida ! 0;
             |DDEFECTO #eosm0028;
             #eosm0028#0 = nEmpresa;
             #eosm0028#1 = #eosclien#3;
             |GRABA 020#eosm0028.n;
         |FINSI;
         |LIBERA #eosm0028;
         |CIERRA #eosm0028;
     |FINSI;
     |LIBERA #eosm0029;

     |SI #eoslinco#39 ! 0; |Y aPasar1 = "S";
         |SI nTipo1 = 2;
             nBase = #eoslinco#7 + #eoslinco#9 + #eoslinco#11;
         |SINO;
             nBase = #eoslinco#7;
         |FINSI;
         nReten    = #eoslinco#42;
         aDinEsp   = aDinEsp1;
         aClave    = aClave1;
         aSubClave = aSubClave1;
         |HAZ GrabaApunte;
     |FINSI;

     |SI #eoslinco#40 ! 0; |Y aPasar2 = "S";
         |SI nTipo2 = 2;
             nBase = #eoslinco#23 + #eoslinco#27 + #eoslinco#31;
         |SINO;
             nBase = #eoslinco#23;
         |FINSI;
         nReten    = #eoslinco#43;
         aDinEsp   = aDinEsp2;
         aClave    = aClave2;
         aSubClave = aSubClave2;
         |HAZ GrabaApunte;
     |FINSI;

     |SI #eoslinco#41 ! 0; |Y aPasar3 = "S";
         |SI nTipo3 = 2;
             nBase = #eoslinco#24 + #eoslinco#28 + #eoslinco#32;
         |SINO;
             nBase = #eoslinco#24;
         |FINSI;
         nReten    = #eoslinco#44;
         aDinEsp   = aDinEsp3;
         aClave    = aClave3;
         aSubClave = aSubClave3;
         |HAZ GrabaApunte;
     |FINSI;
|FPRC;

|DEFBUCLE eoslinco;
     #eoslinco#2;
     ;
     nEmpresa, nAnyo, 1, nDActivid, #eoszp002#42, 00000;
     nEmpresa, nAnyo, 4, nHActivid, #eoszp002#43, 32000;
     ;
     NULL, eoslinco;
|FIN;

|PROCESO eosm0032B;
     |BORRA 020#eosm0032.a;
     |LIBERA #eosm0032;
|FPRC;

|DEFBUCLE eosm0032B;
     #eosm0032#1;
     ;
     nEmpresa, #eoszp002#40, "            ", " ", "  ", 0, nDPeriodo;
     nEmpresa, #eoszp002#40, "zzzzzzzzzzzz", "z", "zz", 9, nHPeriodo;
     be;
     NULL, eosm0032B;
|FIN;

|PROCESO eosm0035B;
     |BORRA 020#eosm0035.a;
     |LIBERA #eosm0035;
|FPRC;

|DEFBUCLE eosm0035B;
     #eosm0035#1;
     ;
     nEmpresa, #eoszp002#40, "            ", " ", "  ", 0, nDPeriodo;
     nEmpresa, #eoszp002#40, "zzzzzzzzzzzz", "z", "zz", 9, nHPeriodo;
     be;
     NULL, eosm0035B;
|FIN;

|PROCESO AJugar;
     aAlfa = #eoszp002#40 % -102;
     nAnyo = aAlfa;
     aAlfa = "c" + (("00000" + #eoszp002#nCampo#) % -105) + (#eoszp002#40 % -102);
     |NOME_DAT #eoslinco#aAlfa#;

     aAlfa = #eoszp002#42 % 402;  nDPeriodo = aAlfa;
     aAlfa = #eoszp002#43 % 402;  nHPeriodo = aAlfa;

     nEmpresa  = #eoszp002#nCampo#;
     nDActivid = #eoszp002#nCampo1#;
     nHActivid = #eoszp002#nCampo1#;
     |SI #eoszp002#nCampo1# = 0;
         nDActivid = 1;
         nHActivid = 9;
     |FINSI;

     |SI #eoszp002#40 [ 2015;
         |BUCLE eosm0032B;
     |FINSI;

     |SI #eoszp002#40 ] 2016;
         |BUCLE eosm0035B;
     |FINSI;

     |ABRE #eosm0032;
     |ABRE #eosm0035;
     |BUCLE eoslinco;
     |CIERRA #eosm0032;
     |CIERRA #eosm0035;
|FPRC;

|PROCESO Tipo3;
     |ABRE #eosactiv;
     |ABRE #eosclien;
     |ABRE #eosconce;
     |ABRE #eosconc6;
     |ABRE #dsmom073;
     |ABRE #eosm0029;
     |ABRE #eosm0030;
     |ABRE #eosm0031;
     |PARA nCampo = 0; |SI nCampo [ 19; |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 20;
           |SI #eoszp002#nCampo# ! 0; |O #eoszp002#nCampo1# ! 0;
               |HAZ AJugar;
           |FINSI;
     |SIGUE;
     |CIERRA #eosactiv;
     |CIERRA #eosclien;
     |CIERRA #eosconce;
     |CIERRA #eosconc6;
     |CIERRA #dsmom073;
     |CIERRA #eosm0029;
     |CIERRA #eosm0030;
     |CIERRA #eosm0031;
|FPRC;

|PROGRAMA;
     |SI enEmpresa = 0;
         |CLS;
         |CABEZA "      Pase desde Libros al 110";
         |PINPA #0#eoszp002;
         |PINDA #0#eoszp002;
         |ENDATOS #1#eoszp002;
         |SI FSalida = 0;  |HAZ Tipo3;  |FINSI;
     |SINO;
         |PINPA #0#eoszp002;
         #eoszp002#0  = enEmpresa;
         #eoszp002#40 = enEjercic;   |C_M #eoszp002#40, 1, "N";

         |PINDA #0#eoszp002;

         |PARA nCampo = 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
               |C_M #eoszp002#nCampo#, 1, "N";
               #eoszp002#nCampo# = 0;  |PINTA #eoszp002#nCampo#;
         |SIGUE;

         |PARA nCampo = 21;  |SI nCampo [ 39;  |HACIENDO nCampo = nCampo + 1;
               |C_M #eoszp002#nCampo#, 1, "N";
               #eoszp002#nCampo# = 0;  |PINTA #eoszp002#nCampo#;
         |SIGUE;

         |PTEC 802;
         |ENDATOS #1#eoszp002;
         |SI FSalida = 0;  |HAZ Tipo3;  |FINSI;
     |FINSI;
|FPRO;
