|FICHEROS;
     eose2370 #0;
     eosm0019 #1;
     eosm0050 #50;
     eosclien #2;
     eoshacie #3;
     eosdaban #4;
     eosm1300 #5;
     eosm1303 #55;
     eosactiv #6;
     iaepigra #7;
     eosw0065 #99;
     eosw0072 #100;

     dsmow572 #572;
     dsmow573 #573;
|FIN;

|VARIABLES;
     Campos      = 0;
     Campo1      = 0;
     Campo2      = 0;
     Campo3      = 0;
     Campo4      = 0;
     Posi        = 0;
     PosiN       = 0;
     FEstado     = 0;
     LLeno40     = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     Vacio40     = "                                        ";
     NEmpresa    = "";
     SwImpre     = 0;
     DEmpre      = 0;
     HEmpre      = 0;
     XPara       = 0;
     XCampos     = 0;
     XBase       = 0;
     XTipo       = 0;
     XCuota      = 0;
     ZBase       = 0;
     ZTipo       = 0;
     ZCuota      = 0;
     Contador    = 0;
     Dia         = "";
     Mes         = "";
     Ejer        = "";
     Compensar   = 0;

     aAlfa       = "";

     aTipo       = "";
     aAbre       = "";

     nEjer       = 0;
     nHandle2    = 0;
     nNume       = 0;
     nCampo      = 0;

     &eaInternet = "";
     &eaAlfa     = "";
     &enNume     = 0;
     perialf     = "";
|FIN;

|INCLUYE i_seguim;
|INCLUYE i_anyode;
|INCLUYE i_cuadre;
|INCLUYE i_pastil;
|INCLUYE i_consul;


|| *********************
|| ********************** CALCULOS DE LA PANTALLA
|| *********************

|PROCESO ModoImpresion; |TIPO 0;
     |SI #0#2 [ 6;  |O #0#2 ] 80;
         |SI #0#32 = "I";
             |MENAV "0000 No procede la emision por internet, a partir del 2007";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Parrilla; |TIPO 0;
     |SI #0#7 = "S";
         |PARA Campos = 8; |SI Campos [ 31; |HACIENDO Campos = Campos + 1;
               |C_M #0Campos, 1, "N";  #0Campos = 0;  |PINTA #0Campos;
         |SIGUE;
         |C_M #0#0, 1, "S";   |C_M #0#1, 1, "S";  |C_M #0#33, 1, "S";
     |SINO;
         |PARA Campos = 8; |SI Campos [ 31; |HACIENDO Campos = Campos + 1;
               |C_M #0Campos, 1, "S";
         |SIGUE;
         |C_M #0#0,  1, "N"; #0#0 = 1;     |PINTA #0#0;
         |C_M #0#1,  1, "N"; #0#1 = 99999; |PINTA #0#1;
         |C_M #0#33, 1, "N"; #0#33 = "C";  |PINTA #0#33;
     |FINSI;
|FPRC;

|PROCESO Fecha;
     |SI #0Campo > "30.04.1994"; |ERROR; |FINSI;
|FPRC;

|PROCESO PintaAnyo; |TIPO 7;
     |HAZ i_anyodef;
     #0#2 = i_anyodef;
     |PINTA #0#2;
|FPRC;

|PROCESO Cuadro; |TIPO 7;
     |PUSHV 0501 2380;
     |CUADRO 1008 1977;
     |ATRI R;
     |PINTA 1109, " La emision del 370 provoca una cuota a compensar distinta a la que ";
     |PINTA 1209, " hubieramos tenido emitiendo el 310 y el 300 por separado, esto im- ";
     |PINTA 1309, " plica el tener que grabar otra cuota a compensar exclusivamente    ";
     |PINTA 1409, " para el 370, que se grabara en el fichero de empresas.             ";
     |PINTA 1509, " Al emitir el 370 la maquina grabara automaticamente la cuota a com-";
     |PINTA 1609, " pensar del trimestre si la hubiera, pero si es la primera vez que  ";
     |PINTA 1709, " lanzamos el 370 con esta version, se tendra que poner manualmente  ";
     |PINTA 1809, " la cuota a compensar del trimestre en el fichero de empresas.      ";
     |ATRI 0;
|FPRC;

|PROCESO Reponer; |TIPO 0;
     |POPV;
     |PINDA #0#0;
|FPRC;

|| *********************
|| ********************** CALCULOS DE LA IMPRESION MODELO 370
|| *********************

|PROCESO Campos300_370;
     #99#54 = "X";
     |PARA XBase = 5; |SI XBase [ 11; |HACIENDO XBase = XBase + 3;
           XTipo  = XBase + 1;
           XCuota = XBase + 2;

           ZBase  = 1;
           ZTipo  = 2;
           ZCuota = 3;

           |SI #5XBase ! 0;  |Y #5XCuota ! 0;
               Contador = 0;
               |ET Arriba370;
                   |SI #99ZTipo ! 0;
                       |SI #5XTipo = #99ZTipo;
                           #99ZBase  = #99ZBase  + #5XBase;
                           #99ZTipo  = #5XTipo;
                           #99ZCuota = #99ZCuota + #5XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba370; |FINSI;
                       |FINSI;
                   |SINO;
                       #99ZBase  = #5XBase;
                       #99ZTipo  = #5XTipo;
                       #99ZCuota = #5XCuota;
                   |FINSI;
                   #99#54 = "";
           |FINSI;
     |SIGUE;

     |PARA XPara = 1; |SI XPara [ 3; |HACIENDO XPara = XPara + 1;
           ZBase  = 10;
           ZTipo  = 11;
           ZCuota = 12;

           |SI XPara = 1; XBase = 14; |FINSI;
           |SI XPara = 2; XBase = 17; |FINSI;
           |SI XPara = 3; XBase = 46; |FINSI;

           XCuota = XBase + 2;
           XTipo  = XBase + 1;

           |SI #5XBase ! 0;  |Y #5XCuota ! 0;
               Contador = 0;
               |ET Arriba3701;
                   |SI #99ZTipo ! 0;
                       |SI #5XTipo = #99ZTipo;
                           #99ZBase  = #99ZBase  + #5XBase;
                           #99ZTipo  = #5XTipo;
                           #99ZCuota = #99ZCuota + #5XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba3701; |FINSI;
                       |FINSI;
                   |SINO;
                       #99ZBase  = #5XBase;
                       #99ZTipo  = #5XTipo;
                       #99ZCuota = #5XCuota;
                   |FINSI;
                   #99#54 = "";
           |FINSI;
     |SIGUE;

     #99#19  = #99#19  + #5#49;
     #99#21  = #99#21  + #5#50;

     #99#23 = #99#23 + (#5#21 + #5#43);
     #99#24 = #99#24 + (#5#22 + #5#44);
     #99#25 = #99#25 + #5#51;
     #99#26 = #99#26 + #5#23;

     #99#22 = #99#22 + #5#20;
     #99#27 = #99#27 + #5#25;
     #99#28 = #99#22 - #99#27;
     #99#51 = #99#51 + #5#54;
|FPRC;

|PROCESO Campos303_370;
     #99#54 = "X";
     |PARA XBase = 5; |SI XBase [ 11; |HACIENDO XBase = XBase + 3;
           XTipo  = XBase + 1;
           XCuota = XBase + 2;

           ZBase  = 1;
           ZTipo  = 2;
           ZCuota = 3;

           |SI #55XBase ! 0;  |Y #55XCuota ! 0;
               Contador = 0;
               |ET Arriba370_55;
                   |SI #99ZTipo ! 0;
                       |SI #55XTipo = #99ZTipo;
                           #99ZBase  = #99ZBase  + #55XBase;
                           #99ZTipo  = #55XTipo;
                           #99ZCuota = #99ZCuota + #55XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba370_55; |FINSI;
                       |FINSI;
                   |SINO;
                       #99ZBase  = #55XBase;
                       #99ZTipo  = #55XTipo;
                       #99ZCuota = #55XCuota;
                   |FINSI;
                   #99#54 = "";
           |FINSI;
     |SIGUE;

     |PARA XPara = 1; |SI XPara [ 3; |HACIENDO XPara = XPara + 1;
           ZBase  = 10;
           ZTipo  = 11;
           ZCuota = 12;

           |SI XPara = 1; XBase = 14; |FINSI;
           |SI XPara = 2; XBase = 17; |FINSI;
           |SI XPara = 3; XBase = 46; |FINSI;

           XCuota = XBase + 2;
           XTipo  = XBase + 1;

           |SI #55XBase ! 0;  |Y #55XCuota ! 0;
               Contador = 0;
               |ET Arriba3701_55;
                   |SI #99ZTipo ! 0;
                       |SI #55XTipo = #99ZTipo;
                           #99ZBase  = #99ZBase  + #55XBase;
                           #99ZTipo  = #55XTipo;
                           #99ZCuota = #99ZCuota + #55XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba3701_55; |FINSI;
                       |FINSI;
                   |SINO;
                       #99ZBase  = #55XBase;
                       #99ZTipo  = #55XTipo;
                       #99ZCuota = #55XCuota;
                   |FINSI;
                   #99#54 = "";
           |FINSI;
     |SIGUE;

     #99#19  = #99#19  + #55#49;
     #99#21  = #99#21  + #55#50;

     #99#23 = #99#23 + (#55#21 + #55#43);
     #99#24 = #99#24 + (#55#22 + #55#44);
     #99#25 = #99#25 + #55#51;
     #99#26 = #99#26 + #55#23;

     #99#22 = #99#22 + #55#20;
     #99#27 = #99#27 + #55#25;
     #99#28 = #99#22 - #99#27;
     #99#51 = #99#51 + #55#54;
|FPRC;

|PROCESO NoAgri_370;
     Campo2 = Campo1 + 1;
     Campo3 = Campo1 + 2;
     Campo4 = Campo1 + 3;

     #7#0 = #1Campo1;
     #7#1 = #1Campo2;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;

     Posi = 0;
     |SI #99#34 = 0;   Posi = 31;  PosiN = 34;  |FINSI;
     |SI #99#33 = 0;   Posi = 30;  PosiN = 33;  |FINSI;
     |SI #99#32 = 0;   Posi = 29;  PosiN = 32;  |FINSI;

     |SI Posi = 0;
         #99#31 = "VARIOS";
         #99#34 = #99#34 + #1Campo4;
     |SINO;
         #99Posi  = #1Campo2;
         #99PosiN = #1Campo4;
     |FINSI;
|FPRC;

|PROCESO SiAgri_370;
     Campo2 = Campo1 + 1;
     Campo3 = Campo1 + 2;
     Campo4 = Campo1 + 3;

     #7#0 = #1Campo1;
     #7#1 = #1Campo2;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;

     Posi = 0;
     |SI #99#40 = 0;   Posi = 37;  PosiN = 40;  |FINSI;
     |SI #99#39 = 0;   Posi = 36;  PosiN = 39;  |FINSI;
     |SI #99#38 = 0;   Posi = 35;  PosiN = 38;  |FINSI;

     |SI Posi = 0;
         #99#37 = "VARIOS";
         #99#40 = #99#40 + #1Campo4;
     |SINO;
        #99Posi  = #7#2;
        #99PosiN = #1Campo4;
     |FINSI;
|FPRC;

|PROCESO Campos310_370;
     |ABRE #6;
     #6#0 = #99#0;
     #6#1 = 1;
     #6#2 = #0#2;
     |LEE 040#6];
     |SI FSalida ! 0;    |DDEFECTO #6; |FINSI;
     |SI #6#0 ! #99#0;   |DDEFECTO #6; |FINSI;

     |SI #1#26 ! 0; #99#54 = " "; |FINSI;

     |ABRE #7;
     |SI #1#8  = "N";  |Y #1#9  ! 0;  Campo1 = 6;   |HAZ NoAgri_370;  |FINSI;
     |SI #1#8  = "S";  |Y #1#9  ! 0;  Campo1 = 6;   |HAZ SiAgri_370;  |FINSI;
     |SI #1#13 = "N";  |Y #1#14 ! 0;  Campo1 = 11;  |HAZ NoAgri_370;  |FINSI;
     |SI #1#13 = "S";  |Y #1#14 ! 0;  Campo1 = 11;  |HAZ SiAgri_370;  |FINSI;
     |SI #1#18 = "N";  |Y #1#19 ! 0;  Campo1 = 16;  |HAZ NoAgri_370;  |FINSI;
     |SI #1#18 = "S";  |Y #1#19 ! 0;  Campo1 = 16;  |HAZ SiAgri_370;  |FINSI;
     |SI #1#23 = "N";  |Y #1#24 ! 0;  Campo1 = 21;  |HAZ NoAgri_370;  |FINSI;
     |SI #1#23 = "S";  |Y #1#24 ! 0;  Campo1 = 21;  |HAZ SiAgri_370;  |FINSI;
     |SI #1#28 = "N";  |Y #1#29 ! 0;  Campo1 = 26;  |HAZ NoAgri_370;  |FINSI;
     |SI #1#28 = "S";  |Y #1#29 ! 0;  Campo1 = 26;  |HAZ SiAgri_370;  |FINSI;
     |CIERRA #7;

     #99#41    = #1#30;
     #99#42    = #1#31;
     #99#43    = #1#32;
     #99#44    = #1#33;
     #99#45    = #1#34;
     #99#46    = #1#35;
     #99#47    = #99#45 - #99#46;
     #99#48    = #99#28 + #99#47;

     |SELECT #1#2;
     #2#0 = #99#0;
     |LIBERA #2;
     |LEE 101#2=;
     FEstado = FSalida;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #99#49 = 0;
     |SI #0#4 = 1; #99#49 = #2#68; |FINSI;
     |SI #0#4 = 2; #99#49 = #2#65; |FINSI;
     |SI #0#4 = 3; #99#49 = #2#66; |FINSI;
     |SI #0#4 = 4; #99#49 = #2#67; |FINSI;

     #99#51 = #99#51 + #1#39;

     #99#50    = #99#48 - #99#49;
     Compensar = 0;
     |SI #99#50 ] 0;
         #99#53 = #99#50;
         #99#52 = 0;
     |SINO;
         #99#52 = -#99#50;
         #99#53 = 0;
         Compensar = #99#52;

         aTipo = #6#26;
         |SI aTipo = "F";  aTipo = "T";  |FINSI;

         |SI #0#4 = 4; |Y aTipo = "T";
             ||  Compensar = 0;  Tique 135_1492 Antes siempre a devolver el 370
         |FINSI;
         |SI #0#4 = 12; |Y aTipo = "M";
             || Compensar = 0;   Tique 135_1492 Antes siempre a devolver el 370
         |FINSI;
     |FINSI;

     |SI #0#32 = "O"; |O #0#32 = "I";
         |SI #0#4 = 1; #2#65 = Compensar; |FINSI;
         |SI #0#4 = 2; #2#66 = Compensar; |FINSI;
         |SI #0#4 = 3; #2#67 = Compensar; |FINSI;
         |SI #0#4 = 4; #2#68 = Compensar; |FINSI;
         |SI FEstado = 0; |GRABA 020#2a; |FINSI;
     |FINSI;
     |CIERRA #6;
|FPRC;

|| *********************
|| ********************** CALCULOS DE LA IMPRESION MODELO 371
|| *********************

|PROCESO Campos300_371;
     #100#58 = "X";
     |PARA XBase = 5; |SI XBase [ 11; |HACIENDO XBase = XBase + 3;
           XTipo  = XBase + 1;
           XCuota = XBase + 2;

           ZBase  = 1;
           ZTipo  = 2;
           ZCuota = 3;

           |SI #5XBase ! 0;  |Y #5XCuota ! 0;
               Contador = 0;
               |ET Arriba371;
                   |SI #100ZTipo ! 0;
                       |SI #5XTipo = #100ZTipo;
                           #100ZBase  = #100ZBase  + #5XBase;
                           #100ZTipo  = #5XTipo;
                           #100ZCuota = #100ZCuota + #5XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba371; |FINSI;
                       |FINSI;
                   |SINO;
                       #100ZBase  = #5XBase;
                       #100ZTipo  = #5XTipo;
                       #100ZCuota = #5XCuota;
                   |FINSI;
                   #100#58 = "";
           |FINSI;
     |SIGUE;

     |PARA XPara = 1; |SI XPara [ 3; |HACIENDO XPara = XPara + 1;
           ZBase  = 10;
           ZTipo  = 11;
           ZCuota = 12;

           |SI XPara = 1; XBase = 14; |FINSI;
           |SI XPara = 2; XBase = 17; |FINSI;
           |SI XPara = 3; XBase = 46; |FINSI;

           XCuota = XBase + 2;
           XTipo  = XBase + 1;

           |SI #5XBase ! 0;  |Y #5XCuota ! 0;
               Contador = 0;
               |ET Arriba3711;
                   |SI #100ZTipo ! 0;
                       |SI #5XTipo = #100ZTipo;
                           #100ZBase  = #100ZBase  + #5XBase;
                           #100ZTipo  = #5XTipo;
                           #100ZCuota = #100ZCuota + #5XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba3711; |FINSI;
                       |FINSI;
                   |SINO;
                       #100ZBase  = #5XBase;
                       #100ZTipo  = #5XTipo;
                       #100ZCuota = #5XCuota;
                   |FINSI;
                   #100#58 = "";
           |FINSI;
     |SIGUE;

     #100#19  = #100#19  + #5#49;
     #100#20  = #100#20  + #5#50;

     #100#22 = #100#22 + (#5#21 + #5#43);
     #100#23 = #100#23 + (#5#22 + #5#44);
     #100#24 = #100#24 + #5#51;
     #100#25 = #100#25 + #5#23;
     #100#26 = #100#26 + #5#24;

     #100#21 = #100#21 + #5#20;
     #100#27 = #100#27 + #5#25;
     #100#28 = #100#21 - #100#27;
     #100#55 = #100#55 + #5#54;
|FPRC;

|PROCESO Campos303_371;
     #100#58 = "X";
     |PARA XBase = 5; |SI XBase [ 11; |HACIENDO XBase = XBase + 3;
           XTipo  = XBase + 1;
           XCuota = XBase + 2;

           ZBase  = 1;
           ZTipo  = 2;
           ZCuota = 3;

           |SI #55XBase ! 0;  |Y #55XCuota ! 0;
               Contador = 0;
               |ET Arriba371_55;
                   |SI #100ZTipo ! 0;
                       |SI #55XTipo = #100ZTipo;
                           #100ZBase  = #100ZBase  + #55XBase;
                           #100ZTipo  = #55XTipo;
                           #100ZCuota = #100ZCuota + #55XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba371_55; |FINSI;
                       |FINSI;
                   |SINO;
                       #100ZBase  = #55XBase;
                       #100ZTipo  = #55XTipo;
                       #100ZCuota = #55XCuota;
                   |FINSI;
                   #100#58 = "";
           |FINSI;
     |SIGUE;

     |PARA XPara = 1; |SI XPara [ 3; |HACIENDO XPara = XPara + 1;
           ZBase  = 10;
           ZTipo  = 11;
           ZCuota = 12;

           |SI XPara = 1; XBase = 14; |FINSI;
           |SI XPara = 2; XBase = 17; |FINSI;
           |SI XPara = 3; XBase = 46; |FINSI;

           XCuota = XBase + 2;
           XTipo  = XBase + 1;

           |SI #55XBase ! 0;  |Y #55XCuota ! 0;
               Contador = 0;
               |ET Arriba3711_55;
                   |SI #100ZTipo ! 0;
                       |SI #55XTipo = #100ZTipo;
                           #100ZBase  = #100ZBase  + #55XBase;
                           #100ZTipo  = #55XTipo;
                           #100ZCuota = #100ZCuota + #55XCuota;
                       |SINO;
                           Contador = Contador + 1;
                           ZBase    = ZBase    + 3;
                           ZTipo    = ZTipo    + 3;
                           ZCuota   = ZCuota   + 3;
                           |SI Contador [ 3; |VETE Arriba3711_55; |FINSI;
                       |FINSI;
                   |SINO;
                       #100ZBase  = #55XBase;
                       #100ZTipo  = #55XTipo;
                       #100ZCuota = #55XCuota;
                   |FINSI;
                   #100#58 = "";
           |FINSI;
     |SIGUE;

     #100#19  = #100#19  + #55#49;
     #100#20  = #100#20  + #55#50;

     #100#22 = #100#22 + (#55#21 + #55#43);
     #100#23 = #100#23 + (#55#22 + #55#44);
     #100#24 = #100#24 + #55#51;
     #100#25 = #100#25 + #55#23;
     #100#26 = #100#26 + #55#24;

     #100#21 = #100#21 + #55#20;
     #100#27 = #100#27 + #55#25;
     #100#28 = #100#21 - #100#27;
     #100#55 = #100#55 + #55#54;
|FPRC;

|PROCESO NoAgri_371;
     Campo2 = Campo1 + 1;
     Campo3 = Campo1 + 2;
     Campo4 = Campo1 + 3;

     #7#0 = #1Campo1;
     #7#1 = #1Campo2;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;

     Posi = 0;
     |SI #100#34 = 0;   Posi = 31;  PosiN = 34;  |FINSI;
     |SI #100#33 = 0;   Posi = 30;  PosiN = 33;  |FINSI;
     |SI #100#32 = 0;   Posi = 29;  PosiN = 32;  |FINSI;

     |SI Posi = 0;
         #100#31 = "VARIOS";
         #100#34 = #100#34 + #1Campo4;
     |SINO;
         #100Posi  = #1Campo2;
         #100PosiN = #1Campo4;
     |FINSI;
|FPRC;

|PROCESO SiAgri_371;
     Campo2 = Campo1 + 1;
     Campo3 = Campo1 + 2;
     Campo4 = Campo1 + 3;

     #7#0 = #1Campo1;
     #7#1 = #1Campo2;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;

     Posi = 0;
     |SI #100#40 = 0;   Posi = 37;  PosiN = 40;  |FINSI;
     |SI #100#39 = 0;   Posi = 36;  PosiN = 39;  |FINSI;
     |SI #100#38 = 0;   Posi = 35;  PosiN = 38;  |FINSI;

     |SI Posi = 0;
         #100#37 = "VARIOS";
         #100#40 = #100#40 + #1Campo4;
     |SINO;
        #100Posi  = #7#2;
        #100PosiN = #1Campo4;
     |FINSI;
|FPRC;

|PROCESO Campos310_371;
     |ABRE #6;
     #6#0 = #100#0;
     #6#1 = 1;
     #6#2 = #0#2;
     |LEE 040#6];
     |SI FSalida ! 0;     |DDEFECTO #6; |FINSI;
     |SI #6#0 ! #100#0;   |DDEFECTO #6; |FINSI;

     |SI #1#26 ! 0; #100#58 = " "; |FINSI;

     |ABRE #7;
     |SI #1#8  = "N";  |Y #1#9  ! 0;  Campo1 = 6;   |HAZ NoAgri_371;  |FINSI;
     |SI #1#8  = "S";  |Y #1#9  ! 0;  Campo1 = 6;   |HAZ SiAgri_371;  |FINSI;
     |SI #1#13 = "N";  |Y #1#14 ! 0;  Campo1 = 11;  |HAZ NoAgri_371;  |FINSI;
     |SI #1#13 = "S";  |Y #1#14 ! 0;  Campo1 = 11;  |HAZ SiAgri_371;  |FINSI;
     |SI #1#18 = "N";  |Y #1#19 ! 0;  Campo1 = 16;  |HAZ NoAgri_371;  |FINSI;
     |SI #1#18 = "S";  |Y #1#19 ! 0;  Campo1 = 16;  |HAZ SiAgri_371;  |FINSI;
     |SI #1#23 = "N";  |Y #1#24 ! 0;  Campo1 = 21;  |HAZ NoAgri_371;  |FINSI;
     |SI #1#23 = "S";  |Y #1#24 ! 0;  Campo1 = 21;  |HAZ SiAgri_371;  |FINSI;
     |SI #1#28 = "N";  |Y #1#29 ! 0;  Campo1 = 26;  |HAZ NoAgri_371;  |FINSI;
     |SI #1#28 = "S";  |Y #1#29 ! 0;  Campo1 = 26;  |HAZ SiAgri_371;  |FINSI;
     |CIERRA #7;

     #100#41    = #1#30;
     #100#42    = #1#43;
     #100#43    = #1#44;
     #100#44    = #1#31;
     #100#45    = #1#32;
     #100#46    = #1#33;
     #100#47    = #1#34;
     #100#48    = #1#35;
     #100#49    = #1#45;
     #100#50    = #1#46;
     #100#51    = #100#47 - #100#50;
     #100#52    = #100#28 + #100#51;

     |SELECT #1#2;
     #2#0 = #100#0;
     |LIBERA #2;
     |LEE 101#2=;
     FEstado = FSalida;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #100#53 = 0;
     |SI #0#4 = 1; #100#53 = #2#68; |FINSI;
     |SI #0#4 = 2; #100#53 = #2#65; |FINSI;
     |SI #0#4 = 3; #100#53 = #2#66; |FINSI;
     |SI #0#4 = 4; #100#53 = #2#67; |FINSI;

     #100#55 = #100#55 + #1#39;

     #100#54    = #100#52 - #100#53;

     Compensar = 0;
     |SI #100#54 ] 0;
         #100#57 = #100#54;
         #100#56 = 0;
         #100#59 = 0;
     |SINO;
         Compensar = -#100#54;
         |SI #6#27 = "C";
             #100#56 = -#100#54;
             #100#57 = 0;
             #100#59 = 0;
         |SINO;
             #100#59 = -#100#54;
             #100#57 = 0;
             #100#56 = 0;
         |FINSI;

         aTipo = #6#26;
         |SI aTipo = "F";  aTipo = "T";  |FINSI;

         |SI #0#4 = 4; |Y aTipo = "T";
             ||  Compensar = 0;  Tique 135_1492 Antes siempre a devolver el 370
         |FINSI;

         |SI #0#4 = 12; |Y aTipo = "M";
             ||  Compensar = 0;  Tique 135_1492 Antes siempre a devolver el 370
         |FINSI;
     |FINSI;

     |SI #0#32 = "O"; |O #0#32 = "I";
         |SI #0#4 = 1; #2#65 = Compensar; |FINSI;
         |SI #0#4 = 2; #2#66 = Compensar; |FINSI;
         |SI #0#4 = 3; #2#67 = Compensar; |FINSI;
         |SI #0#4 = 4; #2#68 = Compensar; |FINSI;
         |SI FEstado = 0; |GRABA 020#2a; |FINSI;
     |FINSI;
     |CIERRA #6;
|FPRC;

|PROCESO TDeclaracion370;
     #572#2 = "N";

     |SI #99#52 > 0;   #572#2 = "C";  |FINSI;

     |SI #99#53 > 0;
         |SI #0#35 = "S";  |O #0#35 = "D";
             |SI #4#5 ! "          ";
                 #572#60 = #4#2;
                 #572#61 = #4#3;
                 #572#62 = #4#4;
                 #572#63 = #4#5;
                 #572#2  = "U";
             |SINO;
                 #572#2  = "I";
             |FINSI;
         |SINO;
             #572#2  = "I";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Internet370;
     aAbre = eaInternet + "370" + (("00000" + #2#0) % -105) + ".TXT";
     |XABRE "CBW", aAbre, nHandle2;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #572;

     #572#1   = "370";

     aAlfa    = #2#1;  |QBF aAlfa;
     #572#3   = ("000000000" + aAlfa) % -109;
     #572#4   = #50#2;
     #572#5   = nEjer;
     #572#6   = #0#4 + "T";

     enNume  = #99#1;   |HAZ Conver13;      #572#7  = eaAlfa;
     nNume   = #99#2  * 100;
     aAlfa   = ("00000" + nNume) % -105;    #572#8  = aAlfa;
     enNume  = #99#3;   |HAZ Conver13;      #572#9  = eaAlfa;

     enNume  = #99#4;   |HAZ Conver13;      #572#10 = eaAlfa;
     nNume   = #99#5  * 100;
     aAlfa   = ("00000" + nNume) % -105;    #572#11 = aAlfa;
     enNume  = #99#6;   |HAZ Conver13;      #572#12 = eaAlfa;

     enNume  = #99#7;   |HAZ Conver13;      #572#13 = eaAlfa;
     nNume   = #99#8  * 100;
     aAlfa   = ("00000" + nNume) % -105;    #572#14 = aAlfa;
     enNume  = #99#9;   |HAZ Conver13;      #572#15 = eaAlfa;

     enNume  = #99#10;   |HAZ Conver13;     #572#16 = eaAlfa;
     nNume   = #99#11  * 100;
     aAlfa   = ("00000" + nNume) % -105;    #572#17 = aAlfa;
     enNume  = #99#12;   |HAZ Conver13;     #572#18 = eaAlfa;

     enNume  = #99#13;   |HAZ Conver13;     #572#19 = eaAlfa;
     nNume   = #99#14  * 100;
     aAlfa   = ("00000" + nNume) % -105;    #572#20 = aAlfa;
     enNume  = #99#15;   |HAZ Conver13;     #572#21 = eaAlfa;

     enNume  = #99#16;   |HAZ Conver13;     #572#22 = eaAlfa;
     nNume   = #99#17  * 100;
     aAlfa   = ("00000" + nNume) % -105;    #572#23 = aAlfa;
     enNume  = #99#18;   |HAZ Conver13;     #572#24 = eaAlfa;

     enNume  = #99#19;   |HAZ Conver13;     #572#25 = eaAlfa;
     enNume  = #99#21;   |HAZ Conver13;     #572#26 = eaAlfa;

     enNume  = #99#22;   |HAZ Conver13;     #572#27 = eaAlfa;
     enNume  = #99#23;   |HAZ Conver13;     #572#28 = eaAlfa;
     enNume  = #99#24;   |HAZ Conver13;     #572#29 = eaAlfa;
     enNume  = #99#25;   |HAZ Conver13;     #572#30 = eaAlfa;
     enNume  = #99#26;   |HAZ Conver13;     #572#31 = eaAlfa;
     enNume  = #99#27;   |HAZ Conver13;     #572#32 = eaAlfa;
     enNume  = #99#28;   |HAZ Conver13;     #572#33 = eaAlfa;

     enNume  = #99#29;   aAlfa = ("00000" + enNume) % -105;  #572#34 = aAlfa;
     enNume  = #99#32;   |HAZ Conver13;     #572#35 = eaAlfa;
     enNume  = #99#30;   aAlfa = ("00000" + enNume) % -105;  #572#36 = aAlfa;
     enNume  = #99#33;   |HAZ Conver13;     #572#37 = eaAlfa;
     enNume  = #99#31;   aAlfa = ("00000" + enNume) % -105;  #572#38 = aAlfa;
     enNume  = #99#34;   |HAZ Conver13;     #572#39 = eaAlfa;

     eaAlfa  = #99#35;   |HAZ QuitaRaros;   #572#40 = eaAlfa;
     enNume  = #99#38;   |HAZ Conver13;     #572#41 = eaAlfa;
     eaAlfa  = #99#36;   |HAZ QuitaRaros;   #572#42 = eaAlfa;
     enNume  = #99#39;   |HAZ Conver13;     #572#43 = eaAlfa;
     eaAlfa  = #99#37;   |HAZ QuitaRaros;   #572#44 = eaAlfa;
     enNume  = #99#40;   |HAZ Conver13;     #572#45 = eaAlfa;

     enNume  = #99#41;   |HAZ Conver13;     #572#46 = eaAlfa;
     enNume  = #99#42;   |HAZ Conver13;     #572#47 = eaAlfa;
     enNume  = #99#43;   |HAZ Conver13;     #572#48 = eaAlfa;
     enNume  = #99#44;   |HAZ Conver13;     #572#49 = eaAlfa;
     enNume  = #99#45;   |HAZ Conver13;     #572#50 = eaAlfa;

     enNume  = #99#46;   |HAZ Conver13;     #572#51 = eaAlfa;
     enNume  = #99#47;   |HAZ Conver13;     #572#52 = eaAlfa;

     enNume  = #99#48;   |HAZ Conver13;     #572#53 = eaAlfa;
     enNume  = #99#49;   |HAZ Conver13;     #572#54 = eaAlfa;
     enNume  = #99#50;   |HAZ Conver13;     #572#55 = eaAlfa;
     enNume  = #99#51;   |HAZ Conver13;     #572#56 = eaAlfa;
     enNume  = #99#50;   |HAZ Conver13;     #572#58 = eaAlfa;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #572#64  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #572#65  = eaAlfa;

     |HAZ TDeclaracion370;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 67;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #572nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     |XCIERRA nHandle2;
|FPRC;

|PROCESO TDeclaracion371;
     |SI #100#56 > 0;   #573#2 = "C";  |FINSI;
     |SI #100#59 > 0;   #573#2 = "C";  |FINSI;

     |SI #100#57 > 0;
         |SI #4#5 ! "          ";
             #573#65 = #4#2;
             #573#66 = #4#3;
             #573#67 = #4#4;
             #573#68 = #4#5;

             #573#2  = "I";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Internet371;
     aAbre = eaInternet + "371" + (("00000" + #2#0) % -105) + ".TXT";
     |XABRE "CBW", aAbre, nHandle2;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #573;

     #573#1   = "371";

     aAlfa    = #2#1;  |QBF aAlfa;
     #573#3   = ("000000000" + aAlfa) % -109;
     #573#4   = #50#2;
     #573#5   = nEjer;
     #573#6   = #0#4 + "T";

     enNume  = #100#1;   |HAZ Conver13;      #573#7  = eaAlfa;
     nNume   = #100#2  * 100;
     aAlfa   = ("00000" + nNume) % -105;     #573#8  = aAlfa;
     enNume  = #100#3;   |HAZ Conver13;      #573#9  = eaAlfa;

     enNume  = #100#4;   |HAZ Conver13;      #573#10 = eaAlfa;
     nNume   = #100#5  * 100;
     aAlfa   = ("00000" + nNume) % -105;     #573#11 = aAlfa;
     enNume  = #100#6;   |HAZ Conver13;      #573#12 = eaAlfa;

     enNume  = #100#7;   |HAZ Conver13;      #573#13 = eaAlfa;
     nNume   = #100#8  * 100;
     aAlfa   = ("00000" + nNume) % -105;     #573#14 = aAlfa;
     enNume  = #100#9;   |HAZ Conver13;      #573#15 = eaAlfa;

     enNume  = #100#10;   |HAZ Conver13;     #573#16 = eaAlfa;
     nNume   = #100#11  * 100;
     aAlfa   = ("00000" + nNume) % -105;     #573#17 = aAlfa;
     enNume  = #100#12;   |HAZ Conver13;     #573#18 = eaAlfa;

     enNume  = #100#13;   |HAZ Conver13;     #573#19 = eaAlfa;
     nNume   = #100#14  * 100;
     aAlfa   = ("00000" + nNume) % -105;     #573#20 = aAlfa;
     enNume  = #100#15;   |HAZ Conver13;     #573#21 = eaAlfa;

     enNume  = #100#16;   |HAZ Conver13;     #573#22 = eaAlfa;
     nNume   = #100#17  * 100;
     aAlfa   = ("00000" + nNume) % -105;     #573#23 = aAlfa;
     enNume  = #100#18;   |HAZ Conver13;     #573#24 = eaAlfa;

     enNume  = #100#19;   |HAZ Conver13;     #573#25 = eaAlfa;
     enNume  = #100#20;   |HAZ Conver13;     #573#26 = eaAlfa;

     enNume  = #100#21;   |HAZ Conver13;     #573#27 = eaAlfa;
     enNume  = #100#22;   |HAZ Conver13;     #573#28 = eaAlfa;
     enNume  = #100#23;   |HAZ Conver13;     #573#29 = eaAlfa;
     enNume  = #100#24;   |HAZ Conver13;     #573#30 = eaAlfa;
     enNume  = #100#25;   |HAZ Conver13;     #573#31 = eaAlfa;
     enNume  = #100#26;   |HAZ Conver13;     #573#32 = eaAlfa;
     enNume  = #100#27;   |HAZ Conver13;     #573#33 = eaAlfa;
     enNume  = #100#28;   |HAZ Conver13;     #573#34 = eaAlfa;

     enNume  = #100#29;   aAlfa = ("00000" + enNume) % -105;  #573#35 = aAlfa;
     enNume  = #100#32;   |HAZ Conver13;     #573#36 = eaAlfa;
     enNume  = #100#30;   aAlfa = ("00000" + enNume) % -105;  #573#37 = aAlfa;
     enNume  = #100#33;   |HAZ Conver13;     #573#38 = eaAlfa;
     enNume  = #100#31;   aAlfa = ("00000" + enNume) % -105;  #573#39 = aAlfa;
     enNume  = #100#34;   |HAZ Conver13;     #573#40 = eaAlfa;

     eaAlfa  = #100#35;   |HAZ QuitaRaros;   #573#41 = eaAlfa;
     enNume  = #100#38;   |HAZ Conver13;     #573#42 = eaAlfa;
     eaAlfa  = #100#36;   |HAZ QuitaRaros;   #573#43 = eaAlfa;
     enNume  = #100#39;   |HAZ Conver13;     #573#44 = eaAlfa;
     eaAlfa  = #100#37;   |HAZ QuitaRaros;   #573#45 = eaAlfa;
     enNume  = #100#40;   |HAZ Conver13;     #573#46 = eaAlfa;

     enNume  = #100#41;   |HAZ Conver13;     #573#47 = eaAlfa;
     enNume  = #100#42;   |HAZ Conver13;     #573#48 = eaAlfa;
     enNume  = #100#43;   |HAZ Conver13;     #573#49 = eaAlfa;

     enNume  = #100#44;   |HAZ Conver13;     #573#50 = eaAlfa;
     enNume  = #100#45;   |HAZ Conver13;     #573#51 = eaAlfa;
     enNume  = #100#46;   |HAZ Conver13;     #573#52 = eaAlfa;
     enNume  = #100#47;   |HAZ Conver13;     #573#53 = eaAlfa;

     enNume  = #100#48;   |HAZ Conver13;     #573#54 = eaAlfa;
     enNume  = #100#49;   |HAZ Conver13;     #573#55 = eaAlfa;
     enNume  = #100#50;   |HAZ Conver13;     #573#56 = eaAlfa;

     enNume  = #100#51;   |HAZ Conver13;     #573#57 = eaAlfa;
     enNume  = #100#52;   |HAZ Conver13;     #573#58 = eaAlfa;
     enNume  = #100#53;   |HAZ Conver13;     #573#59 = eaAlfa;
     enNume  = #100#54;   |HAZ Conver13;     #573#60 = eaAlfa;
     enNume  = #100#55;   |HAZ Conver13;     #573#61 = eaAlfa;
     enNume  = #100#54;   |HAZ Conver13;     #573#63 = eaAlfa;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #573#66  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #573#67  = eaAlfa;

     |HAZ TDeclaracion371;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 72;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #573nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     |XCIERRA nHandle2;
|FPRC;

|PROCESO Impresion;
     #1#0 = #99#0;
     #1#1 = #0#2;
     #1#2 = #0#4;
     |LEE 110#1=;
     |SI FSalida = 0;
        |SI #0#4 ! 4;  |HAZ Campos310_370;  |FINSI;
        |SI #0#4 = 4;  |HAZ Campos310_371;  |FINSI;

        |SELECT #1#2;
        #2#0 = #99#0;
        |LEE 040#2=;
        |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

        #3#0 = #2#18; #3#1 = #2#19;
        |LEE 040#3=;
        |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

        #4#0 = #99#0;
        |LEE 040#4=;
        |SI FSalida ! 0; |DDEFECTO #4; |FINSI;

        |SI #0#32 = "I";
            |SI #0#4 ! 4;  |HAZ Internet370;  |FINSI;
            |SI #0#4 = 4;  |HAZ Internet371;  |FINSI;
        |FINSI;

        |SI #0#32 ! "I";
            |PRINT;
            |PIEINF;
        |FINSI;

        |SI #0#32 ! "B";
            se_empre = #2#0;
            se_ejerc = #0#2;
            se_perio = #0#4;
            se_tipos = 370;
            se_activ = 10;
            |SI #0#4 ! 4;  se_impor = #99#50;   |FINSI;
            |SI #0#4 = 4;  se_impor = #100#54;  |FINSI;
            se_fecha = #0#6;
            se_factu = "N";
            |HAZ seguimie;
            |HAZ AlAgicli;

            #1#3 = #0#6;
            |GRABA 020#1a;
            |LIBERA #1;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO eosm1300;
     |SELECT #1#2;
     #2#0 = #5#0;
     |LEE 040#2=;
     |SI FSalida ! 0;   |ACABA; |FINSI;
     |SI #2#60   ! "S"; |ACABA; |FINSI;
     |SI #5#4    = "S"; |ACABA; |FINSI;

     |SI SwImpre = 0;
         #99#0   = #5#0;
         #100#0  = #5#0;
         SwImpre = 1;
     |FINSI;

     |SI #99#0 = #5#0;
         |SI #0#32 = "O";
             #5#3 = #0#6;
             |GRABA 020#5a;
             |LIBERA #5;
         |FINSI;
     |SINO;
         |SI #0#32 = "O";
             #5#3 = #0#6;
             |GRABA 020#5a;
             |LIBERA #5;
         |FINSI;

         |HAZ Impresion;
         |HAZ Limpia;

         #99#0  = #5#0;
         #100#0 = #5#0;
     |FINSI;

     |SI #0#4 ! 4;  |HAZ Campos300_370;  |FINSI;
     |SI #0#4 = 4;  |HAZ Campos300_371;  |FINSI;
|FPRC;

|DEFBUCLE eosm1300;
     #5#1;
     ;
     DEmpre, 1, #0#4, #0#2;
     HEmpre, 6, #0#4, #0#2;
     be;
     NULL, eosm1300;
|FIN;

|PROCESO eosm1303;
     |SELECT #1#2;
     #2#0 = #55#0;
     |LEE 040#2=;
     |SI FSalida ! 0;   |ACABA; |FINSI;
     |SI #2#60   ! "S"; |ACABA; |FINSI;
     |SI #55#4    = "S"; |ACABA; |FINSI;

     |SI SwImpre = 0;
         #99#0   = #55#0;
         #100#0  = #55#0;
         SwImpre = 1;
     |FINSI;

     |SI #99#0 = #55#0;
         |SI #0#32 ! "B";
             #55#3 = #0#6;
             |GRABA 020#55a;
             |LIBERA #55;
         |FINSI;
     |SINO;
         |SI #0#32 ! "B";
             #55#3 = #0#6;
             |GRABA 020#55a;
             |LIBERA #55;
         |FINSI;

         |HAZ Impresion;
         |HAZ Limpia;

         #99#0  = #55#0;
         #100#0 = #55#0;
     |FINSI;

     |SI #0#4 ! 4;  |HAZ Campos303_370;  |FINSI;
     |SI #0#4 = 4;  |HAZ Campos303_371;  |FINSI;
|FPRC;

|DEFBUCLE eosm1303;
     #55#1;
     ;
     DEmpre, 1, #0#4, #0#2;
     HEmpre, 6, #0#4, #0#2;
     be;
     NULL, eosm1303;
|FIN;

|PROCESO AlModelo;
     NEmpresa = #2#2;
     DEmpre   = #2#0;
     HEmpre   = #2#0;

     |SI #0#2 [ 8;  |O #0#2 ] 80;
         |BUCLE eosm1300;
     |SINO;
         |BUCLE eosm1303;
     |FINSI;

     |SELECT #3#2;
     #2#2 = NEmpresa;
     |LIBERA #2;
     |LEE 101#2=;
|FPRC;

|DEFBUCLE eosclienN;
     #2#3;
     0, 60;
     Vacio40, #0#0, "S";
     LLeno40, #0#1, "S";
     be;
     NULL, AlModelo;
|FIN;

|PROCESO NombreMes;
     |SI Mes = "01"; Mes = "Enero     "; |FINSI;
     |SI Mes = "02"; Mes = "Febrero   "; |FINSI;
     |SI Mes = "03"; Mes = "Marzo     "; |FINSI;
     |SI Mes = "04"; Mes = "Abril     "; |FINSI;
     |SI Mes = "05"; Mes = "Mayo      "; |FINSI;
     |SI Mes = "06"; Mes = "Junio     "; |FINSI;
     |SI Mes = "07"; Mes = "Julio     "; |FINSI;
     |SI Mes = "08"; Mes = "Agosto    "; |FINSI;
     |SI Mes = "09"; Mes = "Septiembre"; |FINSI;
     |SI Mes = "10"; Mes = "Octubre   "; |FINSI;
     |SI Mes = "11"; Mes = "Noviembre "; |FINSI;
     |SI Mes = "12"; Mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO Limpia;
     |SI #0#4 ! 4;
         |DDEFECTO #99;
         #99#55 = Dia;
         #99#56 = Mes;
         #99#57 = Ejer;
     |SINO;
         |DDEFECTO #100;
         #100#60 = Dia;
         #100#61 = Mes;
         #100#62 = Ejer;
     |FINSI;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |SI #0#32 ! "I";
         |IMPRE 0;
         |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     |ABRE #1;
     |ABRE #3;
     |ABRE #4;

     Dia  = #0#6 % 102;
     Mes  = #0#6 % 402;
     |HAZ NombreMes;
     Ejer = #0#6 % -101;

    |SI #0#2 > 80;
        nEjer  = 1900 + #0#2;
    |SINO;
        nEjer  = 2000 + #0#2;
    |FINSI;

     |HAZ Limpia;

     |SI #0#32 = "I";
         |SI #0#4 ! 4;
             perialf    = #0#4 + "T";
             aAlfa      = "/AEAT";                         |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET";                |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/370";            |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/370/" + nEjer;   |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/370/" + nEjer + "/" + perialf; |RMKDIR aAlfa;
             eaInternet = aAlfa + "/";
         |SINO;
             perialf    = ("00" + #0#4) % -102;
             aAlfa      = "/AEAT";                         |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET";                |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/371";            |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/371/" + nEjer;    |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/371/" + nEjer + "/" + perialf; |RMKDIR aAlfa;
             eaInternet = aAlfa + "/";
         |FINSI;
     |FINSI;

     |SI #0#32 = "O";
         |SI #0#4 ! 4;  |INFOR "eose2370";  |FINSI;
         |SI #0#4 = 4;  |INFOR "eose2371";  |FINSI;
         |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
         |HAZ i_cuadre;
     |FINSI;

     |SI #0#32 = "B";
         |SI #0#4 ! 4;  |INFOR "eosb2370";  |FINSI;
         |SI #0#4 = 4;  |INFOR "eosb2371";  |FINSI;
         |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
     |FINSI;

     |SI #0#33 = "N";
         |BUCLE eosclienN;
     |SINO;
         |ABRE #2;
         |SI #0#7 = "N";
              |PARA XCampos = 8; |SI XCampos [ 31; |HACIENDO XCampos = XCampos + 1;
                    |SI #0XCampos ! 0;
                        DEmpre = #0XCampos; HEmpre = #0XCampos;
                        |SI #0#2 [ 8;  |O #0#2 ] 80;
                            |BUCLE eosm1300;
                        |SINO;
                            |BUCLE eosm1303;
                        |FINSI;
                    |FINSI;
              |SIGUE;
         |SINO;
              DEmpre = #0#0;
              HEmpre = #0#1;
              |SI #0#2 [ 8;  |O #0#2 ] 80;
                  |BUCLE eosm1300;
              |SINO;
                  |BUCLE eosm1303;
              |FINSI;
         |FINSI;
         |CIERRA #2;
     |FINSI;

     |ABRE #2;
     |SI SwImpre = 1;
         |HAZ Impresion;
         |HAZ Limpia;
     |FINSI;
     |CIERRA #2;

     |SI #0#32 ! "I";
         |FININF;
         |FINIMP;
     |SINO;
         aAlfa =  "      Los ficheros generados estan en " + eaInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;

     |CIERRA #1;
     |CIERRA #3;
     |CIERRA #4;
|FPRC;
