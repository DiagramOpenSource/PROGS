|FICHEROS;
     eosem303 #0;
     eosclien #2;
     eoshacie #3;
     eosdaban #4;
     eosm1303 #5;
     eosm0050 #50;
     eosactiv #6;
     eosw0553 #553;
     dsmoy000;
|FIN;

|VARIABLES;
     Campos      = 0;
     LLeno40     = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     Vacio40     = "                                        ";

     nPer        = 0;
     pp          = 0;
     sw_sigue    = 0;
     x           = 0;
     sw          = 0;
     inf         = 0;
     inf1        = 0;
     inf2        = 0;
     pepe        = 0;
     informe     = "";
     error1      = "     Impreso Detenido";
     error2      = "     No existe informe";
     sw_hay      = 0;
     varii       = 0;
     varic       = 0;
     varib       = 0;
     aa          = 0;
     nCanti1     = 0;
     nActiv      = 0;

     aDirOri    = "";
     aDirDes    = "";
     aOrigen    = "";
     aDestino   = "";
     aAlfa      = "";

     nNeg = 0;
     aValfa0     = "";
     aValfa1     = "";
     aValfa2     = "";
     aValfa      = "";
     aAlfa2      = "";
     aLong       = "";
     aCaracter   = "";

     nComa       = 0;
     nCaracter   = 0;
     nLong       = 0;
     nPos        = 0;
     nPosi       = 0;
     nSwPunto    = 0;
     nTEuro1     = 0;
     nTEuro2     = 0;
     nTEuro3     = 0;
     nGraba      = 0;
     nHandleError = 0;

     nHandlePortal = 0;
     aAbrePortal   = "";
     aFichero      = "";

     &SwViene    = 0;
     &VEmpresa   = 0;
     &VPeriodo   = 0;
     &VAnyo      = 0;

     &empresa    = 0;
     &sin        = "";
     &dia        = "";
     &mes        = "";
     &anyo       = "";
     &cont       = 0;
     &atri       = 0;
     &compe      = 0;
     &sujet      = 0;
     &t_venta    = 0;
     &t_compr    = 0;
     &dife       = 0;
     &atribu     = 0;
     &total      = 0;
     &t_ing      = 0;
     &t_com      = 0;
     &t_dev      = 0;
     &entrega    = 0;
     &enCampo43  = 0;
     &enCampo44  = 0;

 {-1}&base   = 0;
     &base1  = 0;
     &base2  = 0;
     &base3  = 0;
     &base4  = 0;
     &base5  = 0;
     &base6  = 0;
     &base7  = 0;

 {-1}&tipo   = 0.00;
     &tipo1  = 0.00;
     &tipo2  = 0.00;
     &tipo3  = 0.00;
     &tipo4  = 0.00;
     &tipo5  = 0.00;
     &tipo6  = 0.00;

 {-1}&cuota  = 0;
     &cuota1 = 0;
     &cuota2 = 0;
     &cuota3 = 0;
     &cuota4 = 0;
     &cuota5 = 0;
     &cuota6 = 0;
     &cuota7 = 0;

 {-1}&ivade  = 0;
     &ivade1 = 0;
     &ivade2 = 0;
     &ivade3 = 0;
     &ivade4 = 0;
     &ivade5 = 0;
     &ivade6 = 0;
     &ivade7 = 0;
     &ivade8 = 0;
     &ivade9 = 0;

 {-1}&ivabd  = 0;
     &ivabd1 = 0;
     &ivabd2 = 0;
     &ivabd3 = 0;
     &ivabd4 = 0;
     &ivabd5 = 0;
     &ivabd6 = 0;
     &ivabd7 = 0;
     &ivabd8 = 0;
     &ivabd9 = 0;

     Calc     = 0;
     Calc1    = 0;
     Calc2    = 0;
     TipoDato = "";
     Long     = 0;
     LongDec  = 0;
     Comodin  = "";
     Comodin1 = "";
     Comodin2 = "";
     Vacio1   = "";
     Vacio2   = "";

     &EURODB    = 0;

     {-1}aMoneda   = "";
         aMoneda1  = "LEER";
         aMoneda2  = "";


     aAbre        = "";
     aModelos     = "";
     aTipo        = "";
     aFichError   = "";

     nHandle1     = 0;
     nHandle2     = 0;
     nAnyo2D      = 0;
     nSwHay       = 0;
     nTCampo      = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;

     aF2          = "";
     aF3          = "";
     aF4          = "";
     aF5          = "";
     aF6          = "";
     aTecla       = "";

     aAlfa1       = "";
     aUnidad      = "";

  {1}aContiene    = "";

     fFecha       = @;

     &enEmpresa   = 0;
     &eaFOrigen   = "";
     &eaFDestino  = "";
     &eaInternet  = "";
     &eaImpresora = "";
     &enNume      = 0;
     &eaAlfa      = "";
     &eaDiaB      = "";
     &eaMesB      = "";
     &eaAnyoB     = "";
     &enPor100    = 1;
     &eaModelos   = "";
     &eaPathModelo = "";

     &eaPathEmision    = "";
     &eaPathExplorador = "";
     &eaForzExplorador = "";

     &enSwTrata   = 0;
     &eaEjer             = 0;
     &eaPathLanza        = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroImpre     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &enTecla            = 0;
     &enPeriodo          = 0;
     &eaPeriodo          = "";
     nTecla              = 0;
     perialf             = "";
|FIN;

|INCLUYE i_consul;
|INCLUYE i_seguim;
|INCLUYE i_cuadre;
|INCLUYE i_anyode;
|INCLUYE i_laserc;

|PROCESO VarVacia_01;
     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + aTipo + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;
|FPRC;

|PROCESO Portal303_2013;
     |PUSHV 0501 2380;
     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     aAlfa = "Conectandose a la pagina de la aeat";
     |PINTA 1210, aAlfa;

     aAbrePortal = eaPathEmision + "portal303.html";
     |XABRE "WB", aAbrePortal, nHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + "https://www2.agenciatributaria.gob.es/es13/l/zi21zilk0021" + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + "IE13030B" + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "N";
     |SI #eosw0553#69 ! "00000000000000000";
         aTipo = "I";
     |SINO;
         |SI #eosw0553#61 ! "00000000000000000";
             aTipo = "C";
         |SINO;
             |SI #eosw0553#63 ! "00000000000000000";
                 aTipo = "D";
             |FINSI;
         |FINSI;
     |FINSI;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "TIA" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "NDC" + &34 + " value=" + &34 + #eosw0553#7 + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "NRC";  |HAZ VarVacia_01;
     aTipo = "ING";  |HAZ VarVacia_01;
     aTipo = "NRR";  |HAZ VarVacia_01;
     aTipo = "ICO";  |HAZ VarVacia_01;
     aTipo = "NR1";  |HAZ VarVacia_01;
     aTipo = "IN1";  |HAZ VarVacia_01;
     aTipo = "NR2";  |HAZ VarVacia_01;
     aTipo = "IN2";  |HAZ VarVacia_01;
     aTipo = "NR3";  |HAZ VarVacia_01;
     aTipo = "IN3";  |HAZ VarVacia_01;
     aTipo = "NR4";  |HAZ VarVacia_01;
     aTipo = "IN4";  |HAZ VarVacia_01;
     aTipo = "NR5";  |HAZ VarVacia_01;
     aTipo = "IN5";  |HAZ VarVacia_01;
     aTipo = "NR6";  |HAZ VarVacia_01;
     aTipo = "IN6";  |HAZ VarVacia_01;
     aTipo = "NR7";  |HAZ VarVacia_01;
     aTipo = "IN7";  |HAZ VarVacia_01;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "F01" + &34 + " value=" + &34 + "<T3030" + #eosw0553#11 + "0A0000><AUX>";
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 150;
     |HAZ GrabaPortalSin;
     |HAZ GrabaPortalSin;

     eaAlfa = "</AUX><VECTOR>001FIN";
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 200;
     |HAZ GrabaPortalSin;

     eaAlfa = " " * 94;
     |HAZ GrabaPortalSin;

     eaAlfa = "</VECTOR>";
     |HAZ GrabaPortalSin;

     |SI #eosw0553#68 = "3";  #eosw0553#68 = "2";   #eosw0553#6 = "I";  |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 82;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #eosw0553#nCampo#;
           |XGRABA nHandlePortal, eaAlfa;
     |SIGUE;

     eaAlfa = "</T3030" + #eosw0553#11 + "0A0000>" + &34 + " />";
     |HAZ GrabaPortal;

     aTipo = "TXT";  |HAZ VarVacia_01;
     aTipo = "FIR";  |HAZ VarVacia_01;

     aTipo = "F";
     |SI #eosw0553#70 ! "    ";
         aTipo = #eosw0553#70;
     |SINO;
         |SI #eosw0553#64 ! "    ";
             aTipo = #eosw0553#64;
         |FINSI;
     |FINSI;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + aTipo + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #eosw0553#11 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + "303" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + "EWLINKPS" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandlePortal;

     eaFOrigen  = aAbrePortal;
     eaFDestino = eaPathLanza + "portal303.html";
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = aContiene1 % 102;

     |SI eaPathExplorador ! "";
         eaAlfa = eaPathExplorador + " " + aUnidad + eaFDestino;
     |SINO;
         eaAlfa = aUnidad + eaFDestino;
     |FINSI;

     |HAZ ConvierteBarra;

     eaAlfa  = "cmd " + &34 + "/c START /WAIT " + eaAlfa + &34;

     |RSYSTEM eaAlfa;

     |FBORRA eaFOrigen;
     |RFBORRA eaFDestino;

     |POPV;
|FPRC;

|PROCESO PresentaModelo;
     enErrorPortal = 0;
     |HAZ ValidaMPF;
     |SI enErrorPortal = 1;  |ACABA;  |FINSI;

     |SI eaOpcion = "1";
         |HAZ Portal303_2013;
     |FINSI;

     |SI eaOpcion = "3";
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroPtl;
     |FINSI;
|FPRC;

|PROCESO Mayus; |TIPO 0;
     #0Campo = #0Campo > #0Campo;
     |PINTA #0Campo;
|FPRC;

|PROCESO Mayus1; |TIPO 0;
     #0Campo = #0Campo > #0Campo;
     |PINTA #0Campo;

     |SI #0Campo ! "B"; |Y #0Campo ! "O"; |Y #0#2 ] 2013;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO TipoPeriodo;
     |SI #0#36 = "T";
         |SI #0#4 > 4;
             |MENAV "0000Periodo no trimestral ...";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Parrilla; |TIPO 0;
     |SI VEmpresa ! 0;  |ACABA;  |FINSI;

     |SI #0#7 = "S";
         |PARA Campos = 8; |SI Campos [ 31; |HACIENDO Campos = Campos + 1;
               |C_M #0Campos, 1, "N";  #0Campos = 0;  |PINTA #0Campos;
         |SIGUE;
         |C_M #0#0, 1, "S";   |C_M #0#1, 1, "S";  |C_M #0#33, 1, "S";
     |SINO;
         |PARA Campos = 8; |SI Campos [ 31; |HACIENDO Campos = Campos + 1;
               |C_M #0Campos, 1, "S";
         |SIGUE;
         |C_M #0#0,  1, "N"; #0#0 = 1;     |PINTA #0#0;
         |C_M #0#1,  1, "N"; #0#1 = 99999; |PINTA #0#1;
         |C_M #0#33, 1, "N"; #0#33 = "C";  |PINTA #0#33;
     |FINSI;
|FPRC;

|PROCESO pinta_anyo; |TIPO 7;
     |SI VEmpresa ! 0;  |ACABA;  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#2   = aAlfa;
     |PINTA #0#2;
|FPRC;

|PROCESO calcula;
     sw_hay = 1;
     varii = varii + #5#33;
     varic = varic + #5#32 + #5#31;
|FPRC;

|PROCESO impre92;
     #5#55 = 0;
     |SI #5#33 ! 0; |Y varib > 0;
         |SI #5#33 ] varib;
             #5#55 = varib;
             varib = 0;
         |SINO;
             #5#55 = #5#33;
             varib = varib - #5#55;
         |FINSI;
     |FINSI;
     |SI #5#32 ! 0; |Y varib < 0;
         |SI #5#32 ] varib;
             #5#55 = varib;
             varib = 0;
         |SINO;
             #5#55 = #5#32;
             varib = varib - #5#55;
         |FINSI;
     |FINSI;
     |SI #5#31 ! 0; |Y varib < 0;
         |SI #5#31 ] varib;
             #5#55 = varib;
             varib = 0;
         |SINO;
             #5#55 = #5#31;
             varib = varib - #5#55;
         |FINSI;
     |FINSI;

     |GRABA 020#5a;
     |LIBERA #5;

     sw = 1;
     |HAZ importes;
     nActiv = #5#45;

     |SI #5#55 > 0; |ACABA; |FINSI;

     |SI #5#1 = 4; |O #5#1 = 12;
         |SI #0#32 ! "B";
             |ABRE #6;
             #6#0 = #5#0;
             #6#1 = #5#45;
             #6#2 = nAnyo2D;
             |LIBERA #6;
             |LEE 110#6=;
             |SI FSalida = 0;
                 #6#34 = 0;
                 |SI #6#27 = "C"; #6#34 = -#5#55; |FINSI;
                 |GRABA 020#6a;
             |FINSI;
             |CIERRA #6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO importes;
     sin = "X";

     |SI #5#5 ! 0;|Y #5#7 ! 0;
         base1  = base1 + #5#5;
         cuota1 = cuota1 + #5#7;
         |SI tipo1 = 0;
             tipo1  = #5#6;
         |SINO;
             tipo1 = ((cuota1 * 100) / base1) ! 2;
         |FINSI;
     |FINSI;

     |SI #5#8 ! 0;|Y #5#10 ! 0;
         base2  = base2 + #5#8;
         cuota2 = cuota2 + #5#10;
         |SI tipo2 = 0;
             tipo2  = #5#9;
         |SINO;
             tipo2 = ((cuota2 * 100) / base2) ! 2;
         |FINSI;
     |FINSI;

     |SI #5#11 ! 0;|Y #5#13 ! 0;
         base3  = base3 + #5#11;
         cuota3 = cuota3 + #5#13;
         |SI tipo3 = 0;
             tipo3  = #5#12;
         |SINO;
             tipo3 = ((cuota3 * 100) / base3) ! 2;
         |FINSI;
     |FINSI;

     |SI #5#14 ! 0;|Y #5#16 ! 0;
         base4  = base4 + #5#14;
         cuota4 = cuota4 + #5#16;
         |SI tipo4 = 0;
             tipo4  = #5#15;
         |SINO;
             tipo4 = ((cuota4 * 100) / base4) ! 2;
         |FINSI;
     |FINSI;

     |SI #5#17 ! 0;|Y #5#19 ! 0;
         base5  = base5 + #5#17;
         cuota5 = cuota5 + #5#19;
         |SI tipo5 = 0;
             tipo5  = #5#18;
         |SINO;
             tipo5 = ((cuota5 * 100) / base5) ! 2;
         |FINSI;
     |FINSI;

     |SI #5#46 ! 0;|Y #5#48 ! 0;
         base6  = base6 + #5#46;
         cuota6 = cuota6 + #5#48;
         |SI tipo6 = 0;
             tipo6  = #5#47;
         |SINO;
             tipo6 = ((cuota6 * 100) / base6) ! 2;
         |FINSI;
     |FINSI;

     Ibase  = base7 <-;
     Icuota = cuota7 <-;
     base   = base  + #5#49;
     cuota  = cuota + #5#50;

     |SI #5#70 ! 0;  ivabd1 = ivabd1 + #5#70;  |FINSI;
     |SI #5#21 ! 0;  ivade1 = ivade1 + #5#21;  |FINSI;
     |SI #5#75 ! 0;  ivabd2 = ivabd2 + #5#75;  |FINSI;
     |SI #5#43 ! 0;  ivade2 = ivade2 + #5#43;  |FINSI;
     |SI #5#71 ! 0;  ivabd3 = ivabd3 + #5#71;  |FINSI;
     |SI #5#22 ! 0;  ivade3 = ivade3 + #5#22;  |FINSI;
     |SI #5#76 ! 0;  ivabd4 = ivabd4 + #5#76;  |FINSI;
     |SI #5#44 ! 0;  ivade4 = ivade4 + #5#44;  |FINSI;
     |SI #5#72 ! 0;  ivabd5 = ivabd5 + #5#72;  |FINSI;
     |SI #5#51 ! 0;  ivade5 = ivade5 + #5#51;  |FINSI;
     |SI #5#77 ! 0;  ivabd6 = ivabd6 + #5#77;  |FINSI;
     |SI #5#78 ! 0;  ivade6 = ivade6 + #5#78;  |FINSI;
     |SI #5#73 ! 0;  ivabd7 = ivabd7 + #5#73;  |FINSI;
     |SI #5#23 ! 0;  ivade7 = ivade7 + #5#23;  |FINSI;
     |SI #5#74 ! 0;  ivabd8 = ivabd8 + #5#74;  |FINSI;
     |SI #5#24 ! 0;  ivade8 = ivade8 + #5#24;  |FINSI;
     |SI #5#79 ! 0;  ivabd9 = ivabd9 + #5#79;  |FINSI;
     |SI #5#80 ! 0;  ivade9 = ivade9 + #5#80;  |FINSI;

     cont      = cont + 1;
     atri      = atri + #5#27;
     compe     = compe + #5#29;
     sujet     = sujet + #5#30;
     t_venta   = t_venta + #5#20;
     t_compr   = t_compr + #5#25;
     entrega   = entrega + #5#54;
     enCampo43 = enCampo43 + #5#81;
     enCampo44 = enCampo44 + #5#82;
|FPRC;

|PROCESO totalimp;
     |ABRE #6;
     #6#0 = #2#0;
     #6#1 = nActiv;
     #6#2 = nAnyo2D;
     |LEE 040#6];
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
     |SI #6#0 ! #2#0; |DDEFECTO #6; |FINSI;

     nCanti = base1;   |HAZ ConverCanti;  base1  = nCanti;
     nCanti = base2;   |HAZ ConverCanti;  base2  = nCanti;
     nCanti = base3;   |HAZ ConverCanti;  base3  = nCanti;
     nCanti = base4;   |HAZ ConverCanti;  base4  = nCanti;
     nCanti = base5;   |HAZ ConverCanti;  base5  = nCanti;
     nCanti = base6;   |HAZ ConverCanti;  base6  = nCanti;
     nCanti = base7;   |HAZ ConverCanti;  base7  = nCanti;

     nCanti = cuota1;  |HAZ ConverCanti;  cuota1 = nCanti;
     nCanti = cuota2;  |HAZ ConverCanti;  cuota2 = nCanti;
     nCanti = cuota3;  |HAZ ConverCanti;  cuota3 = nCanti;
     nCanti = cuota4;  |HAZ ConverCanti;  cuota4 = nCanti;
     nCanti = cuota5;  |HAZ ConverCanti;  cuota5 = nCanti;
     nCanti = cuota6;  |HAZ ConverCanti;  cuota6 = nCanti;
     nCanti = cuota7;  |HAZ ConverCanti;  cuota7 = nCanti;

     nCanti = ivade1;  |HAZ ConverCanti;  ivade1 = nCanti;
     nCanti = ivade2;  |HAZ ConverCanti;  ivade2 = nCanti;
     nCanti = ivade3;  |HAZ ConverCanti;  ivade3 = nCanti;
     nCanti = ivade4;  |HAZ ConverCanti;  ivade4 = nCanti;
     nCanti = ivade5;  |HAZ ConverCanti;  ivade5 = nCanti;
     nCanti = ivade6;  |HAZ ConverCanti;  ivade6 = nCanti;
     nCanti = ivade7;  |HAZ ConverCanti;  ivade7 = nCanti;
     nCanti = ivade8;  |HAZ ConverCanti;  ivade8 = nCanti;
     nCanti = ivade9;  |HAZ ConverCanti;  ivade9 = nCanti;

     nCanti = ivabd1;  |HAZ ConverCanti;  ivabd1 = nCanti;
     nCanti = ivabd2;  |HAZ ConverCanti;  ivabd2 = nCanti;
     nCanti = ivabd3;  |HAZ ConverCanti;  ivabd3 = nCanti;
     nCanti = ivabd4;  |HAZ ConverCanti;  ivabd4 = nCanti;
     nCanti = ivabd5;  |HAZ ConverCanti;  ivabd5 = nCanti;
     nCanti = ivabd6;  |HAZ ConverCanti;  ivabd6 = nCanti;
     nCanti = ivabd7;  |HAZ ConverCanti;  ivabd7 = nCanti;
     nCanti = ivabd8;  |HAZ ConverCanti;  ivabd8 = nCanti;
     nCanti = ivabd9;  |HAZ ConverCanti;  ivabd9 = nCanti;

     nCanti = compe;     |HAZ ConverCanti;  compe     = nCanti;
     nCanti = entrega;   |HAZ ConverCanti;  entrega   = nCanti;
     nCanti = enCampo43; |HAZ ConverCanti;  enCampo43 = nCanti;
     nCanti = enCampo44; |HAZ ConverCanti;  enCampo44 = nCanti;
     nCanti = sujet;   |HAZ ConverCanti;  sujet   = nCanti;

     t_venta = cuota1 + cuota2 + cuota3 + cuota4 + cuota5 + cuota6 + cuota7;
     t_compr = ivade1 + ivade2 + ivade3 + ivade4 + ivade5 + ivade6 + ivade7 + ivade8 + ivade9;
     dife    = t_venta - t_compr;
     atri    = atri / cont;
     atribu  = dife % atri;
     total  = atribu - compe + sujet;

     |SI total ] 0;
         t_ing = total;
         t_dev = 0;
         t_com = 0;
     |SINO;
         t_com = -total;
         t_ing = 0;
         t_dev = 0;

         aTipo = #6#26;
         |SI aTipo = "F";  aTipo = "T";  |FINSI;
         |SI aTipo = "D";  aTipo = "M";  |FINSI;

         |SI aTipo = "T"; nPer = 4; |FINSI;
         |SI aTipo = "M";
             |SI #6#26 ! "D";
                 nPer = 12;
             |SINO;
                 nPer = #0#4;
             |FINSI;
         |FINSI;

         |SI #0#4 = nPer; |Y aTipo = "T";
             |SI #6#27 = "D"; t_dev = t_com; t_com = 0; |FINSI;
         |FINSI;
         |SI #0#4 = nPer; |Y aTipo = "M";
             |SI #6#27 = "D"; t_dev = t_com; t_com = 0; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ConverCanti;
     |SI #0#32 = "O";  |O #0#32 = "B";  |ACABA;  |FINSI;

     eaMoneda = #0#34;
     enCanti  = nCanti;
     |HAZ ConverMoneda;
     nCanti   = enCanti;
|FPRC;

|PROCESO CargaImprime;
     aAlfa = "del err" + (("00000" + #2#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:303" + (("00000" + #2#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #2#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + "N";
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion;
     |SI t_dev ! 0;
         |SI #4#5 ! "          ";
             #553#64 = #4#2;
             #553#65 = #4#3;
             #553#66 = #4#4;
             #553#67 = #4#5;
         |FINSI;
     |FINSI;

     #553#68 = "0";
     |SI t_ing ! 0;
         #553#68 = "1";
         |SI #0#35 = "S";  |O #0#35 = "D";
             |SI #4#5 ! "          ";
                 |SI #0#35 = "S";  #553#68 = "2";  |FINSI;
                 |SI #0#35 = "D";  #553#68 = "3";  |FINSI;

                 #553#70 = #4#2;
                 #553#71 = #4#3;
                 #553#72 = #4#4;
                 #553#73 = #4#5;
             |FINSI;
         |FINSI;
     |FINSI;

     #553#6 = "";
     |SI t_com ! 0;  #553#6 = "C";  |FINSI;
     |SI t_dev ! 0;  #553#6 = "D";  |FINSI;
     |SI t_ing ! 0;
                                               #553#6 = "I";
         |SI  #0#35 = "A";    |Y #0#2 < 2013;  #553#6 = "A";  |FINSI;
         |SI  #0#35 = "E";    |Y #0#2 < 2013;  #553#6 = "E";  |FINSI;
         |SI  #553#68 = "3";  |Y #0#35 = "D";  #553#6 = "U";  |FINSI;
     |FINSI;

     |SI t_com = 0;  |Y t_dev = 0; |Y t_ing = 0;
         #553#6 = "N";
     |FINSI;
|FPRC;

|PROCESO BuscaNombre;
     |QBF eaAlfa;
     aAlfa1 = "";
     aAlfa2 = "";
     aLong  = eaAlfa % 0;
     nLong  = aLong;
     nComa  = 0;

     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = eaAlfa % nPos;

           |SI aCaracter = ",";
               nComa = 1;
           |SINO;
               |SI nComa = 0;
                   aAlfa1 = aAlfa1 + aCaracter;
               |SINO;
                   |SI aCaracter = " ";  |Y aAlfa2 = "";
                   |SINO;
                       aAlfa2 = aAlfa2 + aCaracter;
                   |FINSI;
               |FINSI;
           |FINSI;
      |SIGUE;
|FPRC;

|PROCESO Carga303;
     |ABRE #6;
     #6#0 = #2#0;
     #6#1 = nActiv;
     #6#2 = nAnyo2D;
     |LEE 000#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     |SI #0#32 = "L";  |O #0#32 = "F";
         aAbre = eaPathModelo + "303" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #553;

     #553#0   = #2#0;

     aAlfa    = #2#1;  |QBF aAlfa;
     #553#7   = ("000000000" + aAlfa) % -109;

     aAlfa = #2#1 % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #2#2;      |HAZ BuscaNombre;
         eaAlfa = aAlfa1;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         eaAlfa = aAlfa2;    |HAZ QuitaRaros;     #553#9   = eaAlfa;
     |SINO;
         eaAlfa   = #2#2;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         #553#9   = " ";
     |FINSI;
                       #553#10 = "2";
     |SI #6#26 = "D";  #553#10 = "1";  |FINSI;

     #553#11  = #0#2;

     |SI #6#26 = "T";  |O #6#26 = "F";
         #553#12  = #0#4 + "T";
     |SINO;
         #553#12  = ("00" + #0#4) % -102;
     |FINSI;

     enNume  = base1;       |HAZ Conver17;   #553#13 = eaAlfa;
     enNume  = tipo1 * 100;                  #553#14 = ("00000" + enNume) % -105;
     enNume  = cuota1;      |HAZ Conver17;   #553#15 = eaAlfa;

     enNume  = base2;       |HAZ Conver17;   #553#16 = eaAlfa;
     enNume  = tipo2 * 100;                  #553#17 = ("00000" + enNume) % -105;
     enNume  = cuota2;      |HAZ Conver17;   #553#18 = eaAlfa;

     enNume  = base3;       |HAZ Conver17;   #553#19 = eaAlfa;
     enNume  = tipo3 * 100;                  #553#20 = ("00000" + enNume) % -105;
     enNume  = cuota3;      |HAZ Conver17;   #553#21 = eaAlfa;

     enNume  = base4;       |HAZ Conver17;   #553#22 = eaAlfa;
     enNume  = tipo4 * 100;                  #553#23 = ("00000" + enNume) % -105;
     enNume  = cuota4;      |HAZ Conver17;   #553#24 = eaAlfa;

     enNume  = base5;       |HAZ Conver17;   #553#25 = eaAlfa;
     enNume  = tipo5 * 100;                  #553#26 = ("00000" + enNume) % -105;
     enNume  = cuota5;      |HAZ Conver17;   #553#27 = eaAlfa;

     enNume  = base6;       |HAZ Conver17;   #553#28 = eaAlfa;
     enNume  = tipo6 * 100;                  #553#29 = ("00000" + enNume) % -105;
     enNume  = cuota6;      |HAZ Conver17;   #553#30 = eaAlfa;

     enNume  = base7;       |HAZ Conver17;   #553#31 = eaAlfa;
     enNume  = cuota7;      |HAZ Conver17;   #553#32 = eaAlfa;
     enNume  = t_venta;     |HAZ Conver17;   #553#33 = eaAlfa;

     enNume  = ivabd1;      |HAZ Conver17;   #553#34 = eaAlfa;
     enNume  = ivade1;      |HAZ Conver17;   #553#35 = eaAlfa;
     enNume  = ivabd2;      |HAZ Conver17;   #553#36 = eaAlfa;
     enNume  = ivade2;      |HAZ Conver17;   #553#37 = eaAlfa;
     enNume  = ivabd3;      |HAZ Conver17;   #553#38 = eaAlfa;
     enNume  = ivade3;      |HAZ Conver17;   #553#39 = eaAlfa;
     enNume  = ivabd4;      |HAZ Conver17;   #553#40 = eaAlfa;
     enNume  = ivade4;      |HAZ Conver17;   #553#41 = eaAlfa;
     enNume  = ivabd5;      |HAZ Conver17;   #553#42 = eaAlfa;
     enNume  = ivade5;      |HAZ Conver17;   #553#43 = eaAlfa;
     enNume  = ivabd6;      |HAZ Conver17;   #553#44 = eaAlfa;
     enNume  = ivade6;      |HAZ Conver17;   #553#45 = eaAlfa;
     enNume  = ivade7;      |HAZ Conver17;   #553#46 = eaAlfa;
     enNume  = ivade8;      |HAZ Conver17;   #553#47 = eaAlfa;
     enNume  = ivade9;      |HAZ Conver17;   #553#48 = eaAlfa;
     enNume  = t_compr;     |HAZ Conver17;   #553#49 = eaAlfa;
     enNume  = dife;        |HAZ Conver17;   #553#50 = eaAlfa;

     enNume  = atri * 100;                   #553#51 = ("00000" + enNume) % -105;
     enNume  = atribu;      |HAZ Conver17;   #553#52 = eaAlfa;
     enNume  = compe;       |HAZ Conver17;   #553#53 = eaAlfa;
     enNume  = entrega;     |HAZ Conver17;   #553#54 = eaAlfa;
     enNume  = enCampo43;   |HAZ Conver17;   #553#55 = eaAlfa;
     enNume  = enCampo44;   |HAZ Conver17;   #553#56 = eaAlfa;
     enNume  = sujet;       |HAZ Conver17;   #553#57 = eaAlfa;
     enNume  = total;       |HAZ Conver17;   #553#58 = eaAlfa;
     enNume  = 0;           |HAZ Conver17;   #553#59 = eaAlfa;
     enNume  = total;       |HAZ Conver17;   #553#60 = eaAlfa;
     enNume  = t_com;       |HAZ Conver17;   #553#61 = eaAlfa;

     #553#62 = "0";

     |SI t_com = 0;  |Y t_dev   = 0;  |Y t_ing = 0;
         #553#62 = "1";
     |FINSI;

     enNume  = t_dev;       |HAZ Conver17;   #553#63 = eaAlfa;
     enNume  = t_ing;       |HAZ Conver17;   #553#69 = eaAlfa;

     |HAZ TDeclaracion;

     #553#74 = "0";
     #553#75 = "";

     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #553#78 = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     #553#79 = eaDiaB;
     #553#80 = eaMesB;
     #553#81 = eaAnyoB;
     #553#83 = &13 + &10;

     nTCampo = 83;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #553nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#32 = "L";  |O #0#32 = "F";
         |HAZ CargaImprime;
     |FINSI;

     |SI #0#32 ! "L"; |Y #0#32 ! "F";
         |PRINT;
         |PIEINF;
     |FINSI;

     nSwHay = 1;

     |GRABA 020#553n;
     |LIBERA #553;
|FPRC;

|PROCESO impresio;
     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #4#0 = #2#0;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;

     |HAZ Carga303;

     |SI #0#32 = "B"; |ACABA; |FINSI;

     |SI EURODB = 0;  |Y #0#34 = "EUROS  ";
         total = ((total / 100) * 166.386) ! 0;
     |FINSI;

     |SI EURODB ! 0;  |Y #0#34 = "PESETAS";
         total = (total / 166.386) ! 2;
     |FINSI;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 303;
     se_activ = 10;
     se_impor = total;
     |SI #0#32 ! "O";  |Y #0#32 ! "B";
         |SI enSwTrata = 0;  se_impor = se_impor /  100;  |FINSI;
     |FINSI;
     se_fecha = #0#6;
     se_factu = "N";
     |HAZ seguimie;
     |HAZ AlAgicli;
|FPRC;

|PROCESO limpia;
     Ibase = base1 <-;
     Itipo = tipo1 <-;
     Icuota = cuota1 <-;
     |PARA inf = 1;|SI inf [ 6; |HACIENDO inf = inf + 1;
           base = 0;
           tipo = 0;
           cuota = 0;
           Ibase = Ibase + 1;
           Itipo = Itipo + 1;
           Icuota = Icuota + 1;
     |SIGUE;
     Ibase = base7 <-;
     Icuota = cuota7 <-;
     base = 0;
     cuota = 0;

     Iivade = ivade1 <-;
     |PARA inf = 1;|SI inf [ 9; |HACIENDO inf = inf + 1;
           ivade = 0;
           Iivade = Iivade + 1;
     |SIGUE;

     Iivabd = ivabd1 <-;
     |PARA inf = 1;|SI inf [ 9; |HACIENDO inf = inf + 1;
           ivabd = 0;
           Iivabd = Iivabd + 1;
     |SIGUE;

     cont = 0;
     atri = 0;
     compe = 0;
     sujet = 0;
     t_venta = 0;
     t_compr = 0;
     dife = 0;
     atribu = 0;
     total = 0;
     t_ing = 0;
     t_com = 0;
     t_dev = 0;
     entrega   = 0;
     enCampo43 = 0;
     enCampo44 = 0;
|FPRC;

|DEFBUCLE eosm1303_1;
     #5#1;
     4;
     #2#0, 1, #0#4, nAnyo2D, "N";
     #2#0, 6, #0#4, nAnyo2D, "N";
     be;
     NULL, calcula;
|FIN;

|DEFBUCLE eosm1303_2;
     #5#1;
     4;
     #2#0, 1, #0#4, nAnyo2D, "N";
     #2#0, 6, #0#4, nAnyo2D, "N";
     be;
     NULL, impre92;
|FIN;

|PROCESO miraempr;
     sw     = 0;
     sw_hay = 0;
     varii  = 0;
     varic  = 0;
     |BUCLE eosm1303_1;
     varib = varii - varic;

     |SI sw_hay = 0; |ACABA; |FINSI;

     nActiv = 1;
     |BUCLE eosm1303_2;
     |SI sw = 1;
         |HAZ totalimp;
         |HAZ impresio;
         |HAZ limpia;
     |FINSI;
|FPRC;

|DEFBUCLE eosclienC;
     #2#1;
     60;
     #0#0, "N";
     #0#1, "N";
     e;
     NULL, miraempr;
|FIN;

|DEFBUCLE eosclienN;
     #2#3;
     0, 60;
     Vacio40, #0#0, "N";
     LLeno40, #0#1, "N";
     e;
     NULL, miraempr;
|FIN;

|PROCESO mes;
     |SI mes = "01"; mes = "Enero     "; |FINSI;
     |SI mes = "02"; mes = "Febrero   "; |FINSI;
     |SI mes = "03"; mes = "Marzo     "; |FINSI;
     |SI mes = "04"; mes = "Abril     "; |FINSI;
     |SI mes = "05"; mes = "Mayo      "; |FINSI;
     |SI mes = "06"; mes = "Junio     "; |FINSI;
     |SI mes = "07"; mes = "Julio     "; |FINSI;
     |SI mes = "08"; mes = "Agosto    "; |FINSI;
     |SI mes = "09"; mes = "Septiembre"; |FINSI;
     |SI mes = "10"; mes = "Octubre   "; |FINSI;
     |SI mes = "11"; mes = "Noviembre "; |FINSI;
     |SI mes = "12"; mes = "Diciembre "; |FINSI;
     mes = mes > mes;
|FPRC;

|PROCESO Impresora;
     |IMPRE 0;
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |INFOR "eoseb303";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     dia = #0#6 % 102;
     mes = #0#6 % 402;
     |HAZ mes;
     anyo = #0#6 % 704;

     |ABRE #3;
     |ABRE #4;
     |SI #0#7 = "S";
         |SI #0#33 = "C"; |BUCLE eosclienC; |FINSI;
         |SI #0#33 = "N"; |BUCLE eosclienN; |FINSI;
     |SINO;
         |ABRE #2;
         |PARA aa = 8; |SI aa [ 31; |HACIENDO aa = aa + 1;
               |SI #0aa ! 0;
                    #2#0 = #0aa;
                    |LEE 040#2=;
                    |SI FSalida = 0; |Y #2#60 = "N";
                        |HAZ miraempr;
                    |FINSI;
               |FINSI;
         |SIGUE;
         |CIERRA #2;
     |FINSI;

     |FININF;
     |FINIMP;

     |CIERRA #3;
     |CIERRA #4;
|FPRC;

|PROCESO AbreImprime;
     aAbre = eaPathModelo + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD \" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "CD MODELOS" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "CD 303" + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + #0#2 + &13 + &10;  |XGRABA nHandle1, aAlfa;
     aAlfa = "CD " + (("00" + #0#4) % -102) + &13 + &10;  |XGRABA nHandle1, aAlfa;

     aAlfa = #0#2;
     aAlfa = aAlfa % -102;
     aVersion = "01";

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = (aContiene1 % 102) > "";

     aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + aUnidad + "\MODELOS\303\";
     aAlfa = aAlfa + #0#2 + "\" + (("00" + #0#4) % -102) + "\" + &13 + &10;

     |XGRABA nHandle1, aAlfa;

     aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     eaModelos = "303";    |HAZ Copiampf;

     aAlfa = eaPathModelo + "IMPRIME";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO eosm1303G;
    aFichError = eaPathModelo + "ERR" + (("00000" + #5#0) % -105) + ".TXT";
    |XABRE "EC", aFichError, nHandleError;
    |SI FSalida ] 0;
        #5#3 = "";
        |GRABA 020#5a;
        |LIBERA #5;

        |ACABA;
    |FINSI;

    |SI #0#32 = "F";
        aOrigen  = eaPathModelo + "303" + (("00000" + #5#0) % -105) + ".TXT";
        aDestino = eaInternet   + "303" + (("00000" + #5#0) % -105) + ".TXT";
        |RCOPIA_FICHERO aOrigen, aDestino;
    |FINSI;

    aOrigen  = eaPathModelo + "303" + (("00000" + #5#0) % -105) + ".TXT";
    |RFBORRA aOrigen;

    #5#3 = #0#6;
    |GRABA 020#5a;
    |LIBERA #5;
|FPRC;

|DEFBUCLE eosm1303G;
     #5#1;
     4;
     #2#0, 1, #0#4, nAnyo2D, "N";
     #2#0, 6, #0#4, nAnyo2D, "N";
     be;
     NULL, eosm1303G;
|FIN;

|PROCESO eosclienG;
     |BUCLE eosm1303G;
|FPRC;

|DEFBUCLE eosclienG;
     #2#1;
     60;
     #0#0, "N";
     #0#1, "N";
     e;
     NULL, eosclienG;
|FIN;

|PROCESO Laser;
     eaPathModelo = "/MODELOS/303/" + #0#2 + "/" + (("00" + #0#4) % -102) + "/";

     |SI #0#32 = "F"; |O #0#32 = "L";
         aAlfa      = "/AEAT";                       |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET";              |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET/303";          |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET/303/" + #0#2;  |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET/303/" + #0#2 + "/" + (("00" + #0#4) % -102);   |RMKDIR aAlfa;
         eaInternet = aAlfa + "/";

         aAlfa = "/MODELOS";               |RMKDIR aAlfa;
         aAlfa = "/MODELOS/303";           |RMKDIR aAlfa;
         aAlfa = "/MODELOS/303/" + #0#2;   |RMKDIR aAlfa;
         aAlfa = "/MODELOS/303/" + #0#2 + "/" + (("00" + #0#4) % -102);   |RMKDIR aAlfa;
         |HAZ AbreImprime;
     |FINSI;

     nSwHay = 0;

     dia = #0#6 % 102;
     mes = #0#6 % 402;
     |HAZ mes;
     anyo = #0#6 % 704;

     |ABRE #3;
     |ABRE #4;
     |SI #0#7 = "S";
         |SI #0#33 = "C"; |BUCLE eosclienC; |FINSI;
         |SI #0#33 = "N"; |BUCLE eosclienN; |FINSI;
     |SINO;
         |ABRE #2;
         |PARA aa = 8; |SI aa [ 31; |HACIENDO aa = aa + 1;
               |SI #0aa ! 0;
                    #2#0 = #0aa;
                    |LEE 040#2=;
                    |SI FSalida = 0; |Y #2#60 = "N";
                        |HAZ miraempr;
                    |FINSI;
               |FINSI;
         |SIGUE;
         |CIERRA #2;
     |FINSI;

     |CIERRA #3;
     |CIERRA #4;

     |SI #0#32 = "F";  |O #0#32 = "L";
         |SI nSwHay = 1;
             |HAZ EmiteEsto;
             eaTipoSec = "303";
             eaTipoEmi = "ERRORES";
             enAnyo    = #0#2;
             |SUB_EJECUTA "eosz9999";
         |SINO;
             |MENAV "     Seleccion Vacia";
             |XCIERRA nHandle1;
         |FINSI;

         aAlfa = eaPathModelo + "imprime.bat";
         |RFBORRA aAlfa;
     |FINSI;

     |SI #0#32 = "L";
         |DBASE eaPathEmision;  |QBF eaPathEmision;
         eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
         eaPathEmision = eaPathEmision + "/303";            |MKDIR eaPathEmision;
         eaPathEmision = eaPathEmision + "/" + #0#2;        |MKDIR eaPathEmision;
         eaPathEmision = eaPathEmision + "/" + (("00" + #0#4) % -102);  |MKDIR eaPathEmision;
         eaPathEmision = eaPathEmision + "/";
     |FINSI;

     |SI #0#7 = "S";
         |BUCLE eosclienG;
     |SINO;
         |ABRE #2;
         |PARA aa = 8; |SI aa [ 31; |HACIENDO aa = aa + 1;
               |SI #0aa ! 0;
                    #2#0 = #0aa;
                    |LEE 040#2=;
                    |SI FSalida = 0; |Y #2#60 = "N";
                        |HAZ eosclienG;
                    |FINSI;
               |FINSI;
         |SIGUE;
         |CIERRA #2;
     |FINSI;

     |SI #0#32 = "F";
         aAlfa =  "      Los ficheros validados estan situados en " + eaInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Boton3031;
     |PTEC 824;
|FPRC;

|PROCESO Boton3032;
     |PTEC 825;
|FPRC;

|PROCESO Boton3033;
     |PTEC 826;
|FPRC;

|PROCESO Boton3034;
     |PTEC 806;
|FPRC;

|PROCESO Boton3035;
     |PTEC 827;
|FPRC;

|PROCESO Botones303;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision PDF pagina hacienda          ", 0513, 0754, Boton3031;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Presentacion Telematica              ", 0913, 1154, Boton3032;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Informe de Comprobacion              ", 1313, 1554, Boton3033;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton3034;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Predeterminar Explorador de internet ", 1713, 1954, Boton3035;
     nBoton2 = FSalida;

     eaForzExplorador = "S";

     #0#32 = "";
     aF2   = &255 + "824";
     aF3   = &255 + "825";
     aF4   = &255 + "826";
     aF5   = &255 + "827";
     aF6   = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aF2;  #0#32 = "L";   |SAL;  |FINSI;
         |SI aTecla = aF3;  #0#32 = "F";   |SAL;  |FINSI;
         |SI aTecla = aF4;  #0#32 = "B";   |SAL;  |FINSI;
         |SI aTecla = aF5;  |HAZ Explorador;     |FINSI;
         |SI aTecla = aF6;                 |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     |PULSATECLA;
|FPRC;

|PROCESO Bloque2012;

     |SI #0#2 ] 2013; |Y #0#32 = "B";
     |SINO;
         |HAZ Botones303;
     |FINSI;
     |SI #0#32 = " ";  |ACABA;  |FINSI;


     aFichero  = ("iv" + Usuario) % 108;
     |NOME_DAT #553 aFichero;
     |DELINDEX #553;

     |ABRE #553;

     |SI #0#32 = "L"; |O #0#32 = "F"; |HAZ Laser;      |FINSI;
     |SI #0#32 ! "L"; |Y #0#32 ! "F"; |HAZ Impresora;  |FINSI;

     |CIERRA #553;
     |DELINDEX #553;
|FPRC;
|| --------------------------------------------------------------------------
|PROCESO Carga303_2013;

     |ABRE #6;
     #6#0 = #2#0;
     #6#1 = nActiv;
     #6#2 = nAnyo2D;
     |LEE 000#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #553;

     #553#0   = #2#0;

     aAlfa    = #2#1;  |QBF aAlfa;
     #553#7   = ("000000000" + aAlfa) % -109;

     aAlfa = #2#1 % 101;
     |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
      |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
      |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
      |O aAlfa = "Z";
         eaAlfa = #2#2;      |HAZ BuscaNombre;
         eaAlfa = aAlfa1;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         eaAlfa = aAlfa2;    |HAZ QuitaRaros;     #553#9   = eaAlfa;
     |SINO;
         eaAlfa   = #2#2;    |HAZ QuitaRaros;     #553#8   = eaAlfa;
         #553#9   = " ";
     |FINSI;
                       #553#10 = "2";
     |SI #6#26 = "D";  #553#10 = "1";  |FINSI;

     #553#11  = #0#2;

     |SI #6#26 = "T";  |O #6#26 = "F";
         #553#12  = #0#4 + "T";
     |SINO;
         #553#12  = ("00" + #0#4) % -102;
     |FINSI;

     enNume  = base1;       |HAZ Conver17;   #553#13 = eaAlfa;
     enNume  = tipo1 * 100;                  #553#14 = ("00000" + enNume) % -105;
     enNume  = cuota1;      |HAZ Conver17;   #553#15 = eaAlfa;

     enNume  = base2;       |HAZ Conver17;   #553#16 = eaAlfa;
     enNume  = tipo2 * 100;                  #553#17 = ("00000" + enNume) % -105;
     enNume  = cuota2;      |HAZ Conver17;   #553#18 = eaAlfa;

     enNume  = base3;       |HAZ Conver17;   #553#19 = eaAlfa;
     enNume  = tipo3 * 100;                  #553#20 = ("00000" + enNume) % -105;
     enNume  = cuota3;      |HAZ Conver17;   #553#21 = eaAlfa;

     enNume  = base4;       |HAZ Conver17;   #553#22 = eaAlfa;
     enNume  = tipo4 * 100;                  #553#23 = ("00000" + enNume) % -105;
     enNume  = cuota4;      |HAZ Conver17;   #553#24 = eaAlfa;

     enNume  = base5;       |HAZ Conver17;   #553#25 = eaAlfa;
     enNume  = tipo5 * 100;                  #553#26 = ("00000" + enNume) % -105;
     enNume  = cuota5;      |HAZ Conver17;   #553#27 = eaAlfa;

     enNume  = base6;       |HAZ Conver17;   #553#28 = eaAlfa;
     enNume  = tipo6 * 100;                  #553#29 = ("00000" + enNume) % -105;
     enNume  = cuota6;      |HAZ Conver17;   #553#30 = eaAlfa;

     enNume  = base7;       |HAZ Conver17;   #553#31 = eaAlfa;
     enNume  = cuota7;      |HAZ Conver17;   #553#32 = eaAlfa;
     enNume  = t_venta;     |HAZ Conver17;   #553#33 = eaAlfa;

     enNume  = ivabd1;      |HAZ Conver17;   #553#34 = eaAlfa;
     enNume  = ivade1;      |HAZ Conver17;   #553#35 = eaAlfa;
     enNume  = ivabd2;      |HAZ Conver17;   #553#36 = eaAlfa;
     enNume  = ivade2;      |HAZ Conver17;   #553#37 = eaAlfa;
     enNume  = ivabd3;      |HAZ Conver17;   #553#38 = eaAlfa;
     enNume  = ivade3;      |HAZ Conver17;   #553#39 = eaAlfa;
     enNume  = ivabd4;      |HAZ Conver17;   #553#40 = eaAlfa;
     enNume  = ivade4;      |HAZ Conver17;   #553#41 = eaAlfa;
     enNume  = ivabd5;      |HAZ Conver17;   #553#42 = eaAlfa;
     enNume  = ivade5;      |HAZ Conver17;   #553#43 = eaAlfa;
     enNume  = ivabd6;      |HAZ Conver17;   #553#44 = eaAlfa;
     enNume  = ivade6;      |HAZ Conver17;   #553#45 = eaAlfa;
     enNume  = ivade7;      |HAZ Conver17;   #553#46 = eaAlfa;
     enNume  = ivade8;      |HAZ Conver17;   #553#47 = eaAlfa;
     enNume  = ivade9;      |HAZ Conver17;   #553#48 = eaAlfa;
     enNume  = t_compr;     |HAZ Conver17;   #553#49 = eaAlfa;
     enNume  = dife;        |HAZ Conver17;   #553#50 = eaAlfa;

     enNume  = atri * 100;                   #553#51 = ("00000" + enNume) % -105;
     enNume  = atribu;      |HAZ Conver17;   #553#52 = eaAlfa;
     enNume  = compe;       |HAZ Conver17;   #553#53 = eaAlfa;
     enNume  = entrega;     |HAZ Conver17;   #553#54 = eaAlfa;
     enNume  = enCampo43;   |HAZ Conver17;   #553#55 = eaAlfa;
     enNume  = enCampo44;   |HAZ Conver17;   #553#56 = eaAlfa;
     enNume  = sujet;       |HAZ Conver17;   #553#57 = eaAlfa;
     enNume  = total;       |HAZ Conver17;   #553#58 = eaAlfa;
     enNume  = 0;           |HAZ Conver17;   #553#59 = eaAlfa;
     enNume  = total;       |HAZ Conver17;   #553#60 = eaAlfa;
     enNume  = t_com;       |HAZ Conver17;   #553#61 = eaAlfa;

     #553#62 = "0";

     |SI t_com = 0;  |Y t_dev   = 0;  |Y t_ing = 0;
         #553#62 = "1";
     |FINSI;

     enNume  = t_dev;       |HAZ Conver17;   #553#63 = eaAlfa;
     enNume  = t_ing;       |HAZ Conver17;   #553#69 = eaAlfa;

     |HAZ TDeclaracion;

     #553#74 = "0";
     #553#75 = "";

     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #553#78 = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     #553#79 = eaDiaB;
     #553#80 = eaMesB;
     #553#81 = eaAnyoB;
     #553#83 = &13 + &10;

     nTCampo = 83;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #553nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

     nSwHay = 1;
|FPRC;

|PROCESO eosm1303_3I;
        #5#3 = #0#6;
        |GRABA 020#5a;
        |LIBERA #5;
|FPRC;

|DEFBUCLE eosm1303_3I;
     #5#1;
     4;
     #2#0, 1, #0#4, nAnyo2D, "N";
     #2#0, 6, #0#4, nAnyo2D, "N";
     be;
     NULL, eosm1303_3I;
|FIN;

|PROCESO impresio_2013;

     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #4#0 = #2#0;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;

     |ABRE #6;
     #6#0 = #2#0;
     #6#1 = nActiv;
     #6#2 = nAnyo2D;
     |LEE 000#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     |SI #6#26 = "T";  |O #6#26 = "F";
         |SI #0#36 ! "T"; |ACABA; |FINSI;
     |SINO;
         |SI #0#36 ! "M"; |ACABA; |FINSI;
     |FINSI;

     eaFicheroPlano = "303" + (("00000" + #2#0) % -105) + ".txt";
     eaFicheroImpre = "303" + (("00000" + #2#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #2#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Carga303_2013;

     |XCIERRA nHandle2;

     |SI EURODB = 0;  |Y #0#34 = "EUROS  ";
         total = ((total / 100) * 166.386) ! 0;
     |FINSI;

     |SI EURODB ! 0;  |Y #0#34 = "PESETAS";
         total = (total / 166.386) ! 2;
     |FINSI;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 303;
     se_activ = 10;
     se_impor = total;

     |SI enSwTrata = 0;  se_impor = se_impor /  100;  |FINSI;
     se_fecha = #0#6;
     se_factu = "N";
     |HAZ seguimie;
     |HAZ AlAgicli;

     enEmpresa    = #2#0;
     eaNomEmpresa = #2#1;

     |HAZ PresentaModelo;

     |BUCLE eosm1303_3I;
|FPRC;

|PROCESO miraempr_2013;
     sw     = 0;
     sw_hay = 0;
     varii  = 0;
     varic  = 0;
     |BUCLE eosm1303_1;
     varib = varii - varic;

     |SI sw_hay = 0; |ACABA; |FINSI;

     nActiv = 1;
     |BUCLE eosm1303_2;
     |SI sw = 1;
         |HAZ totalimp;
         |HAZ impresio_2013;
         |HAZ limpia;
     |FINSI;
|FPRC;

|DEFBUCLE eosclienC_2013;
     #2#1;
     60;
     #0#0, "N";
     #0#1, "N";
     e;
     NULL, miraempr_2013;
|FIN;

|DEFBUCLE eosclienN_2013;
     #2#3;
     0, 60;
     Vacio40, #0#0, "N";
     LLeno40, #0#1, "N";
     e;
     NULL, miraempr_2013;
|FIN;

|PROCESO Bloque2013;
     |HAZ LeeUnidad;
     eaModelos  = "303";
     eaPeriodo  = ("00" + enPeriodo) % -102;

     perialf = eaPeriodo;
     |SI #0#36 = "T";
        |SI enPeriodo = 1; perialf = "1T"; |FINSI;
        |SI enPeriodo = 2; perialf = "2T"; |FINSI;
        |SI enPeriodo = 3; perialf = "3T"; |FINSI;
        |SI enPeriodo = 4; perialf = "4T"; |FINSI;
     |FINSI;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     eaPathModelo = "\MODELOS";
     eaPathModelo = eaPathModelo + "\" + eaModelos;
     eaPathModelo = eaPathModelo + "\" + eaEjer;
     eaPathModelo = eaPathModelo + "\" + perialf;
     eaPathModelo = eaPathModelo + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     #dsmoy000#0 = eaModelos;
     #dsmoy000#6 = eaEjer;

     |HAZ BotonesMPFPortal;
     nTecla = enTecla;
     |SI nTecla = 0;  |ACABA;  |FINSI;

     aFichero  = ("iv" + Usuario) % 108;
     |NOME_DAT #553 aFichero;
     |DELINDEX #553;

     |ABRE #553;
     nSwHay = 0;

     dia = #0#6 % 102;
     mes = #0#6 % 402;
     |HAZ mes;
     anyo = #0#6 % 704;

     |ABRE #3;
     |ABRE #4;
     |SI #0#7 = "S";
         |SI #0#33 = "C"; |BUCLE eosclienC_2013; |FINSI;
         |SI #0#33 = "N"; |BUCLE eosclienN_2013; |FINSI;
     |SINO;
         |ABRE #2;
         |PARA aa = 8; |SI aa [ 31; |HACIENDO aa = aa + 1;
               |SI #0aa ! 0;
                    #2#0 = #0aa;
                    |LEE 040#2=;
                    |SI FSalida = 0; |Y #2#60 = "N";
                        |HAZ miraempr_2013;
                    |FINSI;
               |FINSI;
         |SIGUE;
         |CIERRA #2;
     |FINSI;

     |CIERRA #3;
     |CIERRA #4;

     |CIERRA #553;
     |DELINDEX #553;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3"; |Y nSwHay ! 0;
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO impre;|TIPO 3;

     aAlfa     = #0#2 % -102;
     nAnyo2D   = aAlfa;
     enAnyo    = #0#2;
     eaEjer    = #0#2;
     enPer     = #0#4;
     enPeriodo = #0#4;

     enPor100  = 1;
     aTipoSec  = "303";
     eaTipoSec = "303";

     |SI #0#2 [ 2012; |O #0#32 = "B";
         |HAZ Bloque2012;
         |ACABA;
     |FINSI;

     #0#32 = "L";
     |HAZ Bloque2013;
|FPRC;

|PROCESO MiraVarMoneda;  |TIPO 0;
     |HAZ PintaMoneda;
     #0#34 = eaMoneda;

     |SI #0#34 = "PESETAS";
         |MENAV "     Moneda Erronea.";
         |ERROR;
     |FINSI;

     |PINTA #0#34;
|FPRC;

|PROGRAMA;
     |SI SwViene = 1;
         #0#7  = "S";
         #0#0  = VEmpresa;
         #0#1  = VEmpresa;
         |SI VAnyo > 80;
             #0#2  = 1900 + VAnyo;
         |SINO;
             #0#2  = 2000 + VAnyo;
         |FINSI;
         #0#4  = VPeriodo;

         |PARA nCampo = 0;  |SI nCampo [ 34;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
         |SIGUE;

         |C_M #0#6,  1, "S";
         |C_M #0#32, 1, "S";

         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
     |SINO;
         |CLS;
         |CABEZA "Emision del 303";
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
     |FINSI;
|FPRO;
