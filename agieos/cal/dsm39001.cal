|FICHEROS;
     dsm39001;
     dsm39002;
     dsm39003;
     dsm39004,MANTE;
     dsm39005;
     dsm39006;

     dsmow064;
     dsmow065;
     dsmow067;
     dsmow169;
     dsmow138;

     dsmom004;
     eosm1303;
     dsm30301;

     dsmom117;

     eosactiv;
|FIN;

|VARIABLES;
     nCampo     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nSwChequea = 0;
     nBorra     = 0;
     nComp      = 0;
     nBoton1    = -1;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton5    = -1;
     nBoton6    = -1;
     nBoton7    = -1;
     nBoton8    = -1;
     nBoton9    = -1;
     nValor     = -1;
     nValor2    = -1;
     nTecla     = -1;
     nModo      = -1;
     nNume1     = 0;
     nCompensar = 0;
     nDesdeMes  = 0;
     nPresMod   = 0;
     nResta     = 0;
     nAnyo      = 0;
     nSwHay     = 0;
     nQuito     = 0;
     nGrupo     = 0;
     nSubGrupo  = 0;
     nOtro      = 0;
     nElUltim   = 0;
     nNoSuma    = 0;
     nUltPer    = 0;
     nEjerCarga = 0;
     nRECC      = 0;
     nREDEME    = 0;
     nEjer      = 0;

     aTecla     = "";
     aAlfa      = "";
     aAlfa1     = "";
     aEsc1      = "";
     aEsc2      = "";
     aRetu      = "";
     aF2        = "";
     aF3        = "";
     aF4        = "";
     aF5        = "";
     aF6        = "";
     aF7        = "";
     aF8        = "";
     aF9        = "";
     aF10       = "";
     nMes       = 0;

     nOpera     = 0;
     nDesde     = 0;
     nHasta     = 0;
     nTVentas   = 0;
     nMayorV    = 0;
     nActPrinci = 0;

  {10}aPopup    = "";
|FIN;

|INCLUYE i_variar;

|PROCESO PulsaF2;
     |PTEC 824;
|FPRC;

|PROCESO PulsaF3;
     |PTEC 825;
|FPRC;

|PROCESO PulsaF4;
     |PTEC 826;
|FPRC;

|PROCESO PulsaF5;
     |PTEC 827;
|FPRC;

|PROCESO PulsaF6;
     |PTEC 828;
|FPRC;

|PROCESO PulsaF7;
     |PTEC 829;
|FPRC;

|PROCESO PulsaF8;
     |PTEC 830;
|FPRC;

|PROCESO PulsaF9;
     |PTEC 831;
|FPRC;

|PROCESO PulsaF10;
     |PTEC 832;
|FPRC;

|PROCESO DesapareceBotones;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "HIDE";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "HIDE";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "HIDE";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "HIDE";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "HIDE";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "HIDE";  |FINSI;
     |SI nBoton7 ! -1;  |ESTADO_CONTROL nBoton7, "HIDE";  |FINSI;
     |SI nBoton8 ! -1;  |ESTADO_CONTROL nBoton8, "HIDE";  |FINSI;
     |SI nBoton9 ! -1;  |ESTADO_CONTROL nBoton9, "HIDE";  |FINSI;
|FPRC;

|PROCESO ApareceBotones;
     |SI nBoton1 ! -1;  |ESTADO_CONTROL nBoton1, "SHOW";  |FINSI;
     |SI nBoton2 ! -1;  |ESTADO_CONTROL nBoton2, "SHOW";  |FINSI;
     |SI nBoton3 ! -1;  |ESTADO_CONTROL nBoton3, "SHOW";  |FINSI;
     |SI nBoton4 ! -1;  |ESTADO_CONTROL nBoton4, "SHOW";  |FINSI;
     |SI nBoton5 ! -1;  |ESTADO_CONTROL nBoton5, "SHOW";  |FINSI;
     |SI nBoton6 ! -1;  |ESTADO_CONTROL nBoton6, "SHOW";  |FINSI;
     |SI nBoton7 ! -1;  |ESTADO_CONTROL nBoton7, "SHOW";  |FINSI;
     |SI nBoton8 ! -1;  |ESTADO_CONTROL nBoton8, "SHOW";  |FINSI;
     |SI nBoton9 ! -1;  |ESTADO_CONTROL nBoton9, "SHOW";  |FINSI;
|FPRC;

|PROCESO QuitaBotones;
     |SI nBoton1 ! -1;  |FIN_CONTROL_WINDOWS nBoton1;  nBoton1 = -1;  |FINSI;
     |SI nBoton2 ! -1;  |FIN_CONTROL_WINDOWS nBoton2;  nBoton2 = -1;  |FINSI;
     |SI nBoton3 ! -1;  |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;  |FINSI;
     |SI nBoton4 ! -1;  |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;  |FINSI;
     |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;  |FINSI;
     |SI nBoton6 ! -1;  |FIN_CONTROL_WINDOWS nBoton6;  nBoton6 = -1;  |FINSI;
     |SI nBoton7 ! -1;  |FIN_CONTROL_WINDOWS nBoton7;  nBoton7 = -1;  |FINSI;
     |SI nBoton8 ! -1;  |FIN_CONTROL_WINDOWS nBoton8;  nBoton8 = -1;  |FINSI;
     |SI nBoton9 ! -1;  |FIN_CONTROL_WINDOWS nBoton9;  nBoton9 = -1;  |FINSI;

     |PULSATECLA;
|FPRC;

|RUTINA ClaveBaja2Gnral;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 1;
     #dsm39002#25 = 0;
|FRUT;

|RUTINA ClaveAlta2Gnral;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 2;
     #dsm39002#25 = 99;
|FRUT;

|PROCESO FuncionF2;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #2#dsm39002, -6, 4, 22, 1, ClaveBaja2Gnral, ClaveAlta2Gnral;
     |HAZ Chequeo_AIS;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja3;
     #dsm39003#0 = #dsm39001#0;
     #dsm39003#1 = #dsm39001#1;
     #dsm39003#2 = #dsm39001#2;
     #dsm39003#3 = #dsm39001#3;
     #dsm39003#4 = 1;
|FRUT;

|RUTINA ClaveAlta3;
     #dsm39003#0 = #dsm39001#0;
     #dsm39003#1 = #dsm39001#1;
     #dsm39003#2 = #dsm39001#2;
     #dsm39003#3 = #dsm39001#3;
     #dsm39003#4 = 99;
|FRUT;

|PROCESO FuncionF3;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |PINPA #0#dsm39003;

     |C_V #dsm39003#29, 1, "S";  |C_M #dsm39003#29, 1, "S";
     |C_V #dsm39003#30, 1, "S";  |C_M #dsm39003#30, 1, "S";
     |C_V #dsm39003#31, 1, "S";  |C_M #dsm39003#31, 1, "S";
     |C_V #dsm39003#33, 1, "S";  |C_M #dsm39003#33, 1, "S";
     |C_V #dsm39003#32, 1, "S";  |C_M #dsm39003#32, 1, "S";
     |C_V #dsm39003#34, 1, "S";  |C_M #dsm39003#34, 1, "S";

     |PINTA 2019, "                            ";
     |C_V #dsm39003#29, 1, "N";  |C_M #dsm39003#29, 1, "N";

     |PINTA 1919, "                            ";
     |C_V #dsm39003#30, 1, "N";  |C_M #dsm39003#30, 1, "N";

     |PINTA 2219, "                            ";
     |C_V #dsm39003#32, 1, "N";  |C_M #dsm39003#32, 1, "N";
     |C_V #dsm39003#34, 1, "N";  |C_M #dsm39003#34, 1, "N";

     aAlfa1 = #dsm39001#1;
     |ATRI I;
     |PINTA 2122, aAlfa1;
     |ATRI 0;

     |ENTLINEAL #1#dsm39003, -5, nModo, 22, 0, ClaveBaja3, ClaveAlta3;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF4;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |PARA nCampo1 = 14;  |SI nCampo1 [ 43;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2     = nCampo1 - 14;
           #dsmow064#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     |PINPA #0#dsmow064;
     |PINDA #0#dsmow064;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow064;
         |SI FSalida = 0;
             |PARA nCampo1 = 14;  |SI nCampo1 [ 43;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2   = nCampo1 - 14;
                   #dsm39001#nCampo1# = #dsmow064#nCampo2#;
             |SIGUE;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF5;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |PARA nCampo1 = 44;  |SI nCampo1 [ 52;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2     = nCampo1 - 44;
           #dsmow065#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     #dsmow065#9 = #dsm39001#5;

     |PINPA #0#dsmow065;
     |PINDA #0#dsmow065;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow065;
         |SI FSalida = 0;
             |PARA nCampo1 = 44;  |SI nCampo1 [ 52;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2   = nCampo1 - 44;
                   #dsm39001#nCampo1# = #dsmow065#nCampo2#;
             |SIGUE;

             #dsm39001#5 = #dsmow065#9;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF6;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |C_V #dsmow138#23,1,"S";
     |SI #dsm39001#1 < 2018; |C_V #dsmow138#23,1,"N"; |FINSI;

     #dsm39001#53  = #dsm39001#4 + #dsm39001#5 + #dsm39001#109;
     #dsm39001#60  = #dsm39001#4 + #dsm39001#5 + #dsm39001#111;

     #dsmow138#19 = #dsm39001#109;
     #dsmow138#0  = #dsm39001#53;
     #dsmow138#20 = #dsm39001#110;
     #dsmow138#1  = #dsm39001#54;
     #dsmow138#2  = #dsm39001#6;
     #dsmow138#3  = #dsm39001#55;
     #dsmow138#4  = #dsm39001#56;
     #dsmow138#5  = #dsm39001#57;
     #dsmow138#6  = #dsm39001#58;
     #dsmow138#7  = #dsm39001#59;

     #dsmow138#21 = #dsm39001#111;
     #dsmow138#8  = #dsm39001#60;
     #dsmow138#9  = #dsm39001#61;
     #dsmow138#22 = #dsm39001#112;
     #dsmow138#10 = #dsm39001#62;
     #dsmow138#11 = #dsm39001#7;
     #dsmow138#12 = #dsm39001#8;
     #dsmow138#13 = #dsm39001#9;
     #dsmow138#14 = #dsm39001#10;
     #dsmow138#15 = #dsm39001#11;
     #dsmow138#16 = #dsm39001#100;
     #dsmow138#17 = #dsm39001#101;
     #dsmow138#18 = #dsm39001#102;
     #dsmow138#23 = #dsm39001#114;

     |HAZ Total138;

     |PINPA #0#dsmow138;

     |SI #dsm39001#1 < 2018;
         |PINTA 2202, "                           ";
     |FINSI;

     |PINDA #0#dsmow138;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow138;
         |SI FSalida = 0;
             #dsm39001#109 = #dsmow138#19;
             #dsm39001#53  = #dsmow138#0;
             #dsm39001#110 = #dsmow138#20;
             #dsm39001#54  = #dsmow138#1;
             #dsm39001#55  = #dsmow138#3;
             #dsm39001#56  = #dsmow138#4;
             #dsm39001#57  = #dsmow138#5;
             #dsm39001#58  = #dsmow138#6;
             #dsm39001#59  = #dsmow138#7;
             #dsm39001#111 = #dsmow138#21;
             #dsm39001#60  = #dsmow138#8;
             #dsm39001#61  = #dsmow138#9;
             #dsm39001#112 = #dsmow138#22;
             #dsm39001#62  = #dsmow138#10;
             #dsm39001#8   = #dsmow138#12;
             #dsm39001#9   = #dsmow138#13;
             #dsm39001#10  = #dsmow138#14;
             #dsm39001#11  = #dsmow138#15;
             #dsm39001#100 = #dsmow138#16;
             #dsm39001#101 = #dsmow138#17;
             #dsm39001#102 = #dsmow138#18;
             #dsm39001#114 = #dsmow138#23;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF3aF5;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |ABRE #dsm39005;
     #dsm39005#0 = #dsm39001#0;
     #dsm39005#1 = #dsm39001#1;
     #dsm39005#2 = #dsm39001#2;
     #dsm39005#3 = #dsm39001#3;
     #dsm39005#4 = nGrupo;
     |LEE 101#dsm39005.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39005;
         #dsm39005#0 = #dsm39001#0;
         #dsm39005#1 = #dsm39001#1;
         #dsm39005#2 = #dsm39001#2;
         #dsm39005#3 = #dsm39001#3;
         #dsm39005#4 = nGrupo;
         |GRABA 020#dsm39005.b;
     |FINSI;

     |PINPA #0#dsm39005;
     |PINDA #0#dsm39005;
     |SI nModo ! 4;
         |ENDATOS #1#dsm39005;
         |SI FSalida = 0;
             |GRABA 020#dsm39005.a;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
     |LIBERA #dsm39005;
     |CIERRA #dsm39005;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja2Oper;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 3;
     #dsm39002#25 = 0;
|FRUT;

|RUTINA ClaveAlta2Oper;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#24 = 4;
     #dsm39002#25 = 99;
|FRUT;

|PROCESO FuncionF7;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #2#dsm39002, -6, 4, 22, 1, ClaveBaja2Oper, ClaveAlta2Oper;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF8_2017;
     |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 63;

           #dsmow067#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     #dsmow067#28  = #dsm39001#92;
     #dsmow067#29  = #dsm39001#93;
     #dsmow067#30  = #dsm39001#94;
     #dsmow067#31  = #dsm39001#95;
     #dsmow067#32  = #dsm39001#96;
     #dsmow067#33  = #dsm39001#97;
     #dsmow067#34  = #dsm39001#98;
     #dsmow067#35  = #dsm39001#99;
     #dsmow067#36  = #dsm39001#103;
     #dsmow067#37  = #dsm39001#104;
     #dsmow067#38  = #dsm39001#105;
     #dsmow067#39  = #dsm39001#106;
     #dsmow067#40  = #dsm39001#107;
     #dsmow067#41  = #dsm39001#108;
     #dsmow067#42  = #dsm39001#113;

     |C_M #dsmow067#41, 1, "N";
     |SI #dsm39001#13 ! "             ";
         |C_M #dsmow067#41, 1, "S";
     |FINSI;

     |C_V #dsmow067#29, 1, "S";
     |C_M #dsmow067#29, 1, "S";
     |C_V #dsmow067#42, 1, "S";
     |C_M #dsmow067#42, 1, "S";

     |SI #dsm39001#1 [ 2015;
         |C_V #dsmow067#42, 1, "N";
         |C_M #dsmow067#42, 1, "N";
     |FINSI;

     |SI #dsm39001#1 ] 2016;
         |C_V #dsmow067#29, 1, "N";
         |C_M #dsmow067#29, 1, "N";
     |FINSI;

     |PINPA #0#dsmow067;
     |PINDA #0#dsmow067;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow067;
         |SI FSalida = 0;
             |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 63;

                   #dsm39001#nCampo1# = #dsmow067#nCampo2#;
             |SIGUE;

             #dsm39001#92  = #dsmow067#28;
             #dsm39001#93  = #dsmow067#29;
             #dsm39001#94  = #dsmow067#30;
             #dsm39001#95  = #dsmow067#31;
             #dsm39001#96  = #dsmow067#32;
             #dsm39001#97  = #dsmow067#33;
             #dsm39001#98  = #dsmow067#34;
             #dsm39001#99  = #dsmow067#35;
             #dsm39001#103 = #dsmow067#36;
             #dsm39001#104 = #dsmow067#37;
             #dsm39001#105 = #dsmow067#38;
             #dsm39001#106 = #dsmow067#39;
             #dsm39001#107 = #dsmow067#40;
             #dsm39001#108 = #dsmow067#41;
             #dsm39001#113 = #dsmow067#42;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
|FPRC;

|PROCESO FuncionF8_2018;
     |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 - 63;

           #dsmow169#nCampo2# = #dsm39001#nCampo1#;
     |SIGUE;

     #dsmow169#28  = #dsm39001#92;
     #dsmow169#29  = #dsm39001#93;
     #dsmow169#30  = #dsm39001#94;
     #dsmow169#31  = #dsm39001#95;
     #dsmow169#32  = #dsm39001#96;
     #dsmow169#33  = #dsm39001#97;
     #dsmow169#34  = #dsm39001#98;
     #dsmow169#35  = #dsm39001#99;
     #dsmow169#36  = #dsm39001#103;
     #dsmow169#37  = #dsm39001#104;
     #dsmow169#38  = #dsm39001#105;
     #dsmow169#39  = #dsm39001#106;
     #dsmow169#40  = #dsm39001#107;
     #dsmow169#41  = #dsm39001#108;
     #dsmow169#42  = #dsm39001#113;

     |C_M #dsmow169#41, 1, "N";
     |SI #dsm39001#3 ! 0;
         |C_M #dsmow169#41, 1, "S";
     |FINSI;

     |PINPA #0#dsmow169;
     |PINDA #0#dsmow169;
     |SI nModo ! 4;
         |ENDATOS #1#dsmow169;
         |SI FSalida = 0;
             |PARA nCampo1 = 63;  |SI nCampo1 [ 90;  |HACIENDO nCampo1 = nCampo1 + 1;
                   nCampo2 = nCampo1 - 63;

                   #dsm39001#nCampo1# = #dsmow169#nCampo2#;
             |SIGUE;

             #dsm39001#92  = #dsmow169#28;
             #dsm39001#93  = #dsmow169#29;
             #dsm39001#94  = #dsmow169#30;
             #dsm39001#95  = #dsmow169#31;
             #dsm39001#96  = #dsmow169#32;
             #dsm39001#97  = #dsmow169#33;
             #dsm39001#98  = #dsmow169#34;
             #dsm39001#99  = #dsmow169#35;
             #dsm39001#103 = #dsmow169#36;
             #dsm39001#104 = #dsmow169#37;
             #dsm39001#105 = #dsmow169#38;
             #dsm39001#106 = #dsmow169#39;
             #dsm39001#107 = #dsmow169#40;
             #dsm39001#108 = #dsmow169#41;
             #dsm39001#113 = #dsmow169#42;
         |FINSI;
     |SINO;
         |LEETECLA aAlfa;
     |FINSI;
|FPRC;

|PROCESO FuncionF8;
     |HAZ DesapareceBotones;

     |PUSHV 0501 2380;

     |SI #dsm39001#1 < 2018;
         |HAZ FuncionF8_2017;
     |FINSI;

     |SI #dsm39001#1 ] 2018;
         |HAZ FuncionF8_2018;
     |FINSI;

     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|RUTINA ClaveBaja4;
     #dsm39004#0 = #dsm39001#0;
     #dsm39004#1 = #dsm39001#1;
     #dsm39004#2 = #dsm39001#2;
     #dsm39004#3 = #dsm39001#3;
     #dsm39004#4 = 1;
|FRUT;

|RUTINA ClaveAlta4;
     #dsm39004#0 = #dsm39001#0;
     #dsm39004#1 = #dsm39001#1;
     #dsm39004#2 = #dsm39001#2;
     #dsm39004#3 = #dsm39001#3;
     #dsm39004#4 = 99;
|FRUT;

|PROCESO NoB_Cnae;
      |SI FSalida = 2; |ACABA; |FINSI;
      |SI  #dsm39004#6 = "    "; |Y #dsm39004#10 ! 100; |Y #dsm39004#10 ! 0;
           |MENAV "    Error. Informe CNAE de la Actividad";
           |PTEC 808; |PTEC 808;
           |PTEC 808; |PTEC 808;
           |ERROR;
      |FINSI;
|FPRC;

|PROCESO FuncionF9;
     |HAZ DesapareceBotones;

     |PUSHV 0401 2380;
     |ENTLINEAL #1#dsm39004, -5, nModo, 22, 1, ClaveBaja4, ClaveAlta4;
     |POPV;

     |HAZ ApareceBotones;
|FPRC;

|PROCESO FuncionF10;
     aPopup1  = -1;
     aPopup2  = 3;
     aPopup3  = "Grupo 1";
     aPopup4  = "Grupo 2";
     aPopup5  = "Grupo 3";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % -101;
         |SI aAlfa = "1";  nGrupo = 1;  |HAZ FuncionF3aF5;  |FINSI;
         |SI aAlfa = "2";  nGrupo = 2;  |HAZ FuncionF3aF5;  |FINSI;
         |SI aAlfa = "3";  nGrupo = 3;  |HAZ FuncionF3aF5;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonGeneral;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F2 Reg.General", 0826, 0840, PulsaF2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F3 Grupo 1", 0842, 0852, PulsaF3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Grupo 2", 0854, 0864, PulsaF4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 Grupo 3", 0866, 0876, PulsaF5;
     nBoton5 = FSalida;
|FPRC;

|PROCESO SacaGeneral;
     nTecla = FSalida;

     |SI nTecla = 10;
         |HAZ FuncionF2;
         |ERROR;
     |FINSI;

     |SI nTecla = 11;
         nGrupo = 1;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 12;
         nGrupo = 2;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 13;
         nGrupo = 3;
         |HAZ FuncionF3aF5;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 10;  |Y  nTecla ! 11;  |Y  nTecla ! 12;  |Y  nTecla ! 13;
      |Y nTecla ! 16;  |Y  nTecla ! 17;
         |SI nBoton2 ! -1;  |FIN_CONTROL_WINDOWS nBoton2;  nBoton2 = -1;  |FINSI;
         |SI nBoton3 ! -1;  |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;  |FINSI;
         |SI nBoton4 ! -1;  |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;  |FINSI;
         |SI nBoton5 ! -1;  |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;  |FINSI;
         |PULSATECLA;

         FSalida = 0;
     |FINSI;

     nValor2 = 0;

     |ABRE #dsm39002;
     |SELECT #1#dsm39002;
     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 1;
     #dsm39002#5 = 13;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;
     nValor = #dsm39002#11;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 2;
     #dsm39002#5 = 12;
     |LEE 040#dsm39002.=;
     |SI FSalida = 0;
         nValor2 = #dsm39002#11;
     |FINSI;

     nValor = nValor - nValor2;
     |CIERRA #dsm39002;

     #dsm39001#4 = nValor;

     |SI enTipoEntrada ! 95;  |PINTA #dsm39001#4;  |FINSI;
|FPRC;

|PROCESO BotonSimplificado;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F3 Modulos", 0826, 0836, PulsaF3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Ganaderia", 0838, 0851, PulsaF4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 IVA Devengado y Deducible", 0853, 0877, PulsaF5;
     nBoton5 = FSalida;
|FPRC;

|PROCESO Calcula03;
     #dsm39001#44 = #dsm39001#44 + #dsm39003#27;
|FPRC;

|DEFBUCLE dsm39003;
     #dsm39003#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 99;
     ;
     NULL, Calcula03;
|FIN;

|PROCESO SacaSimplificado;
     nTecla = FSalida;

     |SI nTecla = 11;
         |HAZ FuncionF3;
     |FINSI;

     |SI nTecla = 12;
         |HAZ FuncionF4;
     |FINSI;

     |SI nTecla = 13;
         |HAZ FuncionF5;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
     |FINSI;

     #dsm39001#44 = 0;
     |BUCLE dsm39003;

     #dsm39001#45 = #dsm39001#19 + #dsm39001#25 + #dsm39001#31 + #dsm39001#37 + #dsm39001#43;
     #dsm39001#49 = #dsm39001#44 + #dsm39001#45 + #dsm39001#46 + #dsm39001#47 + #dsm39001#48;
     #dsm39001#52 = #dsm39001#50 + #dsm39001#51;
     #dsm39001#5  = #dsm39001#49 - #dsm39001#52;

     |SI enTipoEntrada ! 95;
         |PINTA #dsm39001#5;

         nQuito = 1;
         |SI nTecla = 11;  |O nTecla = 12;  |O nTecla = 13;
          |O nTecla = 16;  |O nTecla = 17;
             nQuito = 0;
         |FINSI;

         |SI nQuito = 1;
             |FIN_CONTROL_WINDOWS nBoton3;  nBoton3 = -1;
             |FIN_CONTROL_WINDOWS nBoton4;  nBoton4 = -1;
             |FIN_CONTROL_WINDOWS nBoton5;  nBoton5 = -1;
             |PULSATECLA;
         |SINO;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonResultados;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F6 Resultados", 0826, 0840, PulsaF6;
     nBoton6 = FSalida;
|FPRC;

|PROCESO LeeCompEOSM1303;

    |SI nUltPer ! #eosm1303#1;
        nElUltim = 0;
        nNoSuma  = 0;
        nUltPer  = #eosm1303#1;
    |FINSI;

    |SI nNoSuma = 0;
        |SI #eosm1303#55 ! 0;
            |SI #eosm1303#55 ] 0;
                nElUltim = 0;
            |SINO;
                nElUltim = - #eosm1303#55;
            |FINSI;
            nNoSuma = 1;
        |SINO;
            |SI #eosm1303#31 ! 0;
                nElUltim = 0;
            |SINO;
                |SI #eosm1303#32 ! 0;
                    nElUltim = nElUltim + #eosm1303#32;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeCompEOSM1303;
     #eosm1303#1;
     ;
     #dsm39001#0, 1,  1, nOtro;
     #dsm39001#0, 6, 12, nOtro;
     e;
     NULL, LeeCompEOSM1303;
|FIN;

|PROCESO LeeCompDSM30301;
    nElUltim = #dsm30301#89;
    nSwHay   = 1;
|FPRC;

|DEFBUCLE LeeCompDSM30301;
     #dsm30301#1;
     ;
     #dsm39001#0, nOtro, 12, 303, 00, 0;
     #dsm39001#0, nOtro, 12, 303, 99, 0;
     e;
     NULL, LeeCompDSM30301;
|FIN;

|PROCESO Compensacion;
     nCompensar = 0;
     nSwHay     = 0;
     nElUltim   = 0;

     nOtro    = #dsm39001#1 - 1;
     nElUltim = 0;
     |BUCLE LeeCompDSM30301;
     nCompensar = nCompensar + nElUltim;

     |SI nSwHay = 0;
         nOtro    = (#dsm39001#1 - 2000) - 1;
         nUltPer  = -1;
         |BUCLE LeeCompEOSM1303;
         nCompensar = nCompensar + nElUltim;
     |FINSI;

     |SI nCompensar ! 0;  |ACABA;  |FINSI;
     |SI nSwHay     = 1;  |ACABA;  |FINSI;

     |ABRE #dsm30301;
     |PARA nMes = 1; |SI nMes [ 3; |HACIENDO nMes = nMes + 1;
           #dsm30301#0 = #dsm39001#0;
           #dsm30301#1 = #dsm39001#1;
           #dsm30301#2 = nMes;
           #dsm30301#3 = 303;
           #dsm30301#4 = 0;
           #dsm30301#5 = 0;
           |LEE 040#dsm30301.=;
           |SI FSalida = 0;
               nCompensar = nCompensar + #dsm30301#84;
               |SAL;
          |FINSI;
     |SIGUE;
     |CIERRA #dsm30301;
|FPRC;

|PROCESO SacaResultados;
     nTecla = FSalida;

     |SI #dsm39001#54 = 0;  |Y #dsm39001#62 = 0;
         |HAZ Compensacion;
         #dsm39001#54 = nCompensar;
         #dsm39001#62 = nCompensar;
     |FINSI;

     |SI nTecla = 14;
         |HAZ FuncionF6;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 14;   |Y nTecla ! 16;  |Y nTecla ! 17;
         |FIN_CONTROL_WINDOWS nBoton6;  nBoton6 = -1;
     |FINSI;

     |PULSATECLA;

     |SI enTipoEntrada = 95;
         #dsm39001#53  = #dsm39001#4 + #dsm39001#5 + #dsm39001#109;
         #dsm39001#60  = #dsm39001#4 + #dsm39001#5 + #dsm39001#111;

         #dsmow138#0  = #dsm39001#53;
         #dsmow138#1  = #dsm39001#54;
         #dsmow138#2  = #dsm39001#6;
         #dsmow138#3  = #dsm39001#55;
         #dsmow138#4  = #dsm39001#56;
         #dsmow138#5  = #dsm39001#57;
         #dsmow138#6  = #dsm39001#58;
         #dsmow138#7  = #dsm39001#59;
         #dsmow138#8  = #dsm39001#60;
         #dsmow138#9  = #dsm39001#61;
         #dsmow138#10 = #dsm39001#62;
         #dsmow138#11 = #dsm39001#7;
         #dsmow138#12 = #dsm39001#8;
         #dsmow138#13 = #dsm39001#9;
         #dsmow138#14 = #dsm39001#10;
         #dsmow138#15 = #dsm39001#11;
         #dsmow138#16 = #dsm39001#100;
         #dsmow138#17 = #dsm39001#101;
         #dsmow138#18 = #dsm39001#102;
         #dsmow138#19 = #dsm39001#109;
         #dsmow138#20 = #dsm39001#110;
         #dsmow138#21 = #dsm39001#111;
         #dsmow138#22 = #dsm39001#112;
         #dsmow138#23 = #dsm39001#114;

         |HAZ Total138;

         #dsm39001#53  = #dsmow138#0;
         #dsm39001#54  = #dsmow138#1;
         #dsm39001#55  = #dsmow138#3;
         #dsm39001#56  = #dsmow138#4;
         #dsm39001#57  = #dsmow138#5;
         #dsm39001#58  = #dsmow138#6;
         #dsm39001#59  = #dsmow138#7;
         #dsm39001#60  = #dsmow138#8;
         #dsm39001#61  = #dsmow138#9;
         #dsm39001#62  = #dsmow138#10;
         #dsm39001#8   = #dsmow138#12;
         #dsm39001#9   = #dsmow138#13;
         #dsm39001#10  = #dsmow138#14;
         #dsm39001#11  = #dsmow138#15;
         #dsm39001#100 = #dsmow138#16;
         #dsm39001#101 = #dsmow138#17;
         #dsm39001#102 = #dsmow138#18;
         #dsm39001#109 = #dsmow138#19;
         #dsm39001#110 = #dsmow138#20;
         #dsm39001#111 = #dsmow138#21;
         #dsm39001#112 = #dsmow138#22;
         #dsm39001#114 = #dsmow138#23;
     |FINSI;

     |SI #dsm39001#55 ! 0;
         #dsm39001#60  = #dsm39001#4 + #dsm39001#5 + #dsm39001#111;
         #dsm39001#7   = #dsm39001#61 + #dsm39001#112 - #dsm39001#62;

         #dsm39001#53  = 0;
         #dsm39001#54  = 0;
         #dsm39001#6   = 0;
     |SINO;
         #dsm39001#53  = #dsm39001#4 + #dsm39001#5 + #dsm39001#109;
         #dsm39001#6   = #dsm39001#53 + #dsm39001#110 - #dsm39001#54;
         #dsm39001#60  = 0;
         #dsm39001#61  = 0;
         #dsm39001#62  = 0;
         #dsm39001#7   = 0;
     |FINSI;

     |SI enTipoEntrada ! 95;
         |PINTA #dsm39001#6;
         |PINTA #dsm39001#7;
         |PINTA #dsm39001#8;
         |PINTA #dsm39001#9;
         |PINTA #dsm39001#10;
         |PINTA #dsm39001#11;
     |FINSI;
|FPRC;

|PROCESO BotonOperaciones;  |TIPO 7;
     |CONTROL_SIMPLE 0, "BOTON,F7 Operaciones", 0826, 0840, PulsaF7;
     nBoton7 = FSalida;
|FPRC;

|PROCESO SacaOperaciones;
     nTecla = FSalida;

     |SI nTecla = 15;
         |HAZ FuncionF7;
         |ERROR;
     |FINSI;

     |SI nTecla = 16;
         |HAZ FuncionF8;
         |ERROR;
     |FINSI;

     |SI nTecla = 17;
         |HAZ FuncionF9;
         |ERROR;
     |FINSI;

     |SI nTecla ! 15;   |Y nTecla ! 16;  |Y nTecla ! 17;
         |FIN_CONTROL_WINDOWS nBoton7;  nBoton7 = -1;
     |FINSI;

     |PULSATECLA;

     |ABRE #dsm39002;
     |SELECT #1#dsm39002;
     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 3;
     #dsm39002#5 = 15;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;
     nValor = #dsm39002#10;
     |CIERRA #dsm39002;

     #dsm39001#12 = nValor;
     |SI enTipoEntrada ! 95;
         |PINTA #dsm39001#12;
     |FINSI;
|FPRC;

|PROCESO Justificante;  |TIPO 7;
     |SI #dsm39001#3 = 0;
         #dsm39001#13 = "";  |PINTA #dsm39001#13;
         |C_M #dsm39001#13, 1, "N";
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo12m39001;  |TIPO 12;

|FPRC;

|PROCESO dsmom117;
     #dsm39002#0  = #dsm39001#0;
     #dsm39002#1  = #dsm39001#1;
     #dsm39002#2  = #dsm39001#2;
     #dsm39002#3  = #dsm39001#3;
     #dsm39002#4  = #dsmom117#0;
     #dsm39002#5  = #dsmom117#1;
     |LEE 101#dsm39002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm39002;
         #dsm39002#0  = #dsm39001#0;
         #dsm39002#1  = #dsm39001#1;
         #dsm39002#2  = #dsm39001#2;
         #dsm39002#3  = #dsm39001#3;
         #dsm39002#4  = #dsmom117#0;
         #dsm39002#5  = #dsmom117#1;

         |SI #dsmom117#0 = 5;  |Y #dsmom117#1 = 1;
             #dsm39002#10 = 100;
         |FINSI;

         |GRABA 020#dsm39002.b;
     |FINSI;

     #dsm39002#6  = #dsmom117#2;
     #dsm39002#7  = #dsmom117#3;
     #dsm39002#9  = #dsmom117#5;

     |SI nGrupo ! #dsmom117#0;
         nSubGrupo = 0;
     |FINSI;

     nGrupo    = #dsmom117#0;
     nSubGrupo = nSubGrupo + 1;

     #dsm39002#24 = nGrupo;
     #dsm39002#25 = nSubGrupo;

     |GRABA 020#dsm39002.a;
     |LIBERA #dsm39002;
|FPRC;

|DEFBUCLE dsmom117;
     #dsmom117#3;
     ;
     nEjerCarga, 0001, 0, 00;
     nEjerCarga, 9999, 6, 99;
     ;
     NULL, dsmom117;
|FIN;

|PROCESO dsmom117Ejer;
     nEjerCarga = #dsmom117#8;
|FPRC;

|DEFBUCLE dsmom117Ejer;
     #dsmom117#1;
     ;
     2014,   1, 00;
     enEjer, 1, 01;
     ;
     NULL, dsmom117Ejer;
|FIN;

|PROCESO eosactiv;
     |SI #eosactiv#26 = "N";  |O #eosactiv#14 = "S";
         |ACABA;
     |FINSI;

     |SI nOpera = 1;
         nTVentas = #eosactiv#30 + #eosactiv#31 + #eosactiv#32 + #eosactiv#33;
         |SI nTVentas > nMayorV;
             nActPrinci = #eosactiv#1;
             nMayorV    = nTVentas;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #eosactiv#26 ! "T";  |Y #eosactiv#26 ! "F";
         nREDEME = 1;
     |FINSI;

     |SI #eosactiv#44 = 1;
         nRECC = 1;
     |FINSI;

     |SI nActPrinci = 0; nActPrinci = #eosactiv#1; |FINSI;
     |SI nActPrinci = #eosactiv#1;
         nDesde = 63; nHasta = 66;
     |SINO;
         nDesde = 67; nHasta = 83;
     |FINSI;

     |PARA nCampo = nDesde; |SI nCampo [ nHasta;  |HACIENDO nCampo = nCampo + 4;
           nCampo1 = nCampo + 1;
           nCampo2 = nCampo + 2;
           nCampo3 = nCampo + 3;

           |SI #dsm39001#nCampo#  = 0;
               #dsm39001#nCampo#  = #eosactiv#1;
               #dsm39001#nCampo1# = #eosactiv#5;
               #dsm39001#nCampo2# = #eosactiv#6;
               #dsm39001#nCampo3# = #eosactiv#43;

               |SI #dsm39001#nCampo3# = 0;  |O #dsm39001#nCampo3# = 4;
                |O #dsm39001#nCampo3# = 5;  |O #dsm39001#nCampo3# = 6;
                   #dsm39001#nCampo1# = "";
               |FINSI;

               |SI #dsm39001#nCampo1# = "9999";
                   #dsm39001#nCampo1# = "";
               |FINSI;

               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE eosactiv;
     #eosactiv#1;
     ;
     #dsm39001#0, 01, nEjer;
     #dsm39001#0, 99, nEjer;
     ;
     NULL, eosactiv;
|FIN;

|PROCESO DatosEstadisticos;
     nTVentas   = 0;
     nMayorV    = 0;
     nActPrinci = 0;
     nRECC      = 0;
     nREDEME    = 0;
     nEjer      = enEjer - 2000;
     nOpera     = 1; |BUCLE eosactiv;
     nOpera     = 0; |BUCLE eosactiv;

     #dsm39001#98 = "N";
     |SI nREDEME = 1;
         #dsm39001#98 = "S";
     |FINSI;

     #dsm39001#106 = "N";
     |SI nRECC = 1;
         #dsm39001#106 = "S";
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsm39001#0;
     #dsmom004#1 = #dsm39001#1;
     #dsmom004#2 = 99;
     #dsmom004#3 = 347;
     #dsmom004#4 = 0;
     |LEE 000#dsmom004.=;
     |SI FSalida = 0;
         #dsm39001#87 = "X";
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO OperRECC;
     |ABRE #dsm39002;
     |SELECT #1#dsm39002;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 4;
     #dsm39002#5 = 17;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;

     nValor = #dsm39002#10;

     #dsm39002#0 = #dsm39001#0;
     #dsm39002#1 = #dsm39001#1;
     #dsm39002#2 = #dsm39001#2;
     #dsm39002#3 = #dsm39001#3;
     #dsm39002#4 = 4;
     #dsm39002#5 = 18;
     |LEE 040#dsm39002.=;
     |SI FSalida ! 0;  |DDEFECTO #dsm39002;  |FINSI;
     |CIERRA #dsm39002;

     nValor = nValor + #dsm39002#10;

     #dsm39001#107 = "N";
     |SI nValor ! 0;
         #dsm39001#107 = "S";
     |FINSI;
|FPRC;

|PROCESO Borra02;
     |BORRA 020#dsm39002.a;
     |LIBERA #dsm39002;
|FPRC;

|DEFBUCLE dsm39002B;
     #dsm39002#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 0, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 9, 99;
     ;
     NULL, Borra02;
|FIN;

|PROCESO Borra03;
     |BORRA 020#dsm39003.a;
     |LIBERA #dsm39003;
|FPRC;

|DEFBUCLE dsm39003B;
     #dsm39003#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 99;
     ;
     NULL, Borra03;
|FIN;

|PROCESO Borra04;
     |BORRA 020#dsm39004.a;
     |LIBERA #dsm39004;
|FPRC;

|DEFBUCLE dsm39004B;
     #dsm39004#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 00;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 99;
     ;
     NULL, Borra04;
|FIN;

|PROCESO Borra05;
     |BORRA 020#dsm39005.a;
     |LIBERA #dsm39005;
|FPRC;

|DEFBUCLE dsm39005B;
     #dsm39005#1;
     ;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 0;
     #dsm39001#0, #dsm39001#1, #dsm39001#2, #dsm39001#3, 9;
     ;
     NULL, Borra05;
|FIN;

|PROCESO dsm39006B;
     |ABRE #dsm39006;
     #dsm39006#0 = #dsm39001#0;
     #dsm39006#1 = #dsm39001#1;
     #dsm39006#2 = #dsm39001#2;
     #dsm39006#3 = #dsm39001#3;
     |LEE 141#dsm39006.=;
     |SI FSalida = 0;
         |BORRA 020#dsm39006.a;
     |FINSI;
     |LIBERA #dsm39006;
     |CIERRA #dsm39006;
|FPRC;

|PROCESO Recalculo;
     |ABRE #dsm39002;
    || |SELECT #2#dsm39002;
     |HAZ Totales;
     |CIERRA #dsm39002;

     |HAZ SacaGeneral;
     |HAZ SacaSimplificado;
     |HAZ SacaResultados;
     |HAZ SacaOperaciones;
     |HAZ OperRECC;
|FPRC;

|PROGRAMA;

     enResultado = 0;
     eaNomDef    = "dsm39001";
     nModo       = 2;

|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 390";
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 101#dsm39001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39001;
             #dsm39001#0 = enEmpresa;
             #dsm39001#1 = enEjer;
             #dsm39001#2 = enModelo;
             #dsm39001#3 = enComplem;
             #dsm39001#91 = 1;
             |GRABA 020#dsm39001.b;

             |HAZ DatosEstadisticos;
         |FINSI;

         |ABRE #dsm39002;
         |SELECT #1#dsm39002;

         |BUCLE dsmom117Ejer;
         |BUCLE dsmom117;

         |CIERRA #dsm39002;

         |ABRE #dsmom004;
         #dsmom004#0 = #dsm39001#0;
         #dsmom004#1 = #dsm39001#1;
         #dsmom004#2 = 99;
         #dsmom004#3 = 390;
         #dsmom004#4 = 0;
         |LEE 000#dsmom004.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
         |CIERRA #dsmom004;

         #dsm39001#13 = #dsmom004#21;

         |PINPA #0#dsm39001;;
         |PINDA #0#dsm39001;;

         |CONTROL_SIMPLE 0, "BOTON,F8 Datos Estadisticos  ", 0803, 0824, PulsaF8;
         nBoton8 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F9 Prorratas ", 2268, 2278, PulsaF9;
         nBoton9 = FSalida;

         |ENDATOS #1#dsm39001;

         |HAZ QuitaBotones;

         |SI #dsm39001#4 = 0;  |Y #dsm39001#5  = 0;  |Y #dsm39001#6  = 0;  |Y #dsm39001#7  = 0;  |Y #dsm39001#8 = 0;
          |Y #dsm39001#9  = 0; |Y #dsm39001#10 = 0;  |Y #dsm39001#11 = 0;  |Y #dsm39001#12 = 0;
             |CONFI "0000 Modelo sin Actividad. Desea emitir el Modelo";
             |SI FSalida ! 0;
                 |BUCLE dsm39002B;
                 |BUCLE dsm39003B;
                 |BUCLE dsm39004B;
                 |BUCLE dsm39005B;
                 |HAZ dsm39006B;

                 |BORRA 020#dsm39001.a;
                 enEntrada = 0;
             |SINO;
                 #dsm39001#91 = 1;
                 |HAZ OperRECC;

                 |GRABA 020#dsm39001.a;
                 enEntrada = 1;
             |FINSI;
         |SINO;
             #dsm39001#91 = 1;
             |HAZ OperRECC;

             |GRABA 020#dsm39001.a;
             enEntrada = 1;
         |FINSI;
         |LIBERA #dsm39001;
         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         nModo = 4;
         |CABEZA "Modelo 390";

         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 000#dsm39001.=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |CIERRA #dsm39001;
             |ACABA;
         |FINSI;

         |PINPA #0#dsm39001;;
         |PINDA #0#dsm39001;;

         |CONTROL_SIMPLE 0, "BOTON,F2 R.Gnl", 0803, 0809, PulsaF2;
         nBoton1 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F3 Mod.", 0811, 0817, PulsaF3;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F4 Gan.", 0819, 0825, PulsaF4;
         nBoton3 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F5 I.Dev", 0827, 0833, PulsaF5;
         nBoton4 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F6 Res.", 0835, 0841, PulsaF6;
         nBoton5 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F7 Ope.", 0843, 0849, PulsaF7;
         nBoton6 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F8 D.Est.", 0851, 0858, PulsaF8;
         nBoton7 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F9 Pror.", 0860, 0866, PulsaF9;
         nBoton8 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,F10 Grupos", 0868, 0878, PulsaF10;
         nBoton9 = FSalida;

         aEsc1  = &255 + "806";
         aEsc2  = &255 + "807";
         aRetu  = &255 + "802";
         aF2    = &255 + "824";
         aF3    = &255 + "825";
         aF4    = &255 + "826";
         aF5    = &255 + "827";
         aF6    = &255 + "828";
         aF7    = &255 + "829";
         aF8    = &255 + "830";
         aF9    = &255 + "831";
         aF10   = &255 + "832";

         |PARA; |SI;  |HACIENDO;
             |LEETECLA aTecla;
             |SI aTecla = aEsc1; |SAL;  |FINSI;
             |SI aTecla = aEsc2; |SAL;  |FINSI;
             |SI aTecla = aRetu; |SAL;  |FINSI;

             |SI aTecla = aF2;  |HAZ FuncionF2;   aTecla = "";  |FINSI;
             |SI aTecla = aF3;  |HAZ FuncionF3;   aTecla = "";  |FINSI;
             |SI aTecla = aF4;  |HAZ FuncionF4;   aTecla = "";  |FINSI;
             |SI aTecla = aF5;  |HAZ FuncionF5;   aTecla = "";  |FINSI;
             |SI aTecla = aF6;  |HAZ FuncionF6;   aTecla = "";  |FINSI;
             |SI aTecla = aF7;  |HAZ FuncionF7;   aTecla = "";  |FINSI;
             |SI aTecla = aF8;  |HAZ FuncionF8;   aTecla = "";  |FINSI;
             |SI aTecla = aF9;  |HAZ FuncionF9;   aTecla = "";  |FINSI;
             |SI aTecla = aF10; |HAZ FuncionF10;  aTecla = "";  |FINSI;
         |SIGUE;

         |HAZ QuitaBotones;

         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 101#dsm39001.=;
         |SI FSalida ! 0;
             |SI enMensa = 0;
                 |MENAV "      No existe Registro.";
             |FINSI;
             |CIERRA #dsm39001;
             |ACABA;
         |FINSI;

         |BUCLE dsm39002B;
         |BUCLE dsm39003B;
         |BUCLE dsm39004B;
         |BUCLE dsm39005B;
         |HAZ dsm39006B;

         |BORRA 020#dsm39001.a;
         |LIBERA #dsm39001;

         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 95;
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 101#dsm39001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsm39001;
             #dsm39001#0 = enEmpresa;
             #dsm39001#1 = enEjer;
             #dsm39001#2 = enModelo;
             #dsm39001#3 = enComplem;
             #dsm39001#91 = 1;
             |GRABA 020#dsm39001.b;

             |HAZ DatosEstadisticos;
         |FINSI;

         |ABRE #dsmom004;
         #dsmom004#0 = #dsm39001#0;
         #dsmom004#1 = #dsm39001#1;
         #dsmom004#2 = 99;
         #dsmom004#3 = #dsm39001#2;
         #dsmom004#4 = 0;
         |LEE 000#dsmom004.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
         |CIERRA #dsmom004;

         #dsm39001#13 = #dsmom004#21;

         |ABRE #dsm39002;
         |SELECT #1#dsm39002;

         |BUCLE dsmom117Ejer;
         |BUCLE dsmom117;

         |CIERRA #dsm39002;


         |HAZ Recalculo;

         |GRABA 020#dsm39001.a;

         |LIBERA #dsm39001;
         |CIERRA #dsm39001;

         |PULSATECLA;
         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #dsm39001;
         #dsm39001#0 = enEmpresa;
         #dsm39001#1 = enEjer;
         #dsm39001#2 = enModelo;
         #dsm39001#3 = enComplem;
         |LEE 040#dsm39001.=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #dsm39001;

         |SI enActividad = 0;  enResultado = 0;  |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRO;
