ab|FICHEROS;
     eosivapr #0;
     eosclien #1;
     eosconce #2;
     eoslinco #4;
     eosactiv #6;
     eoscolib #9;
     eosw0009 #10;
     eosw0010 #11;
     eosconc6 #12;
     eoscabco #13;
     eosivacl #14;
     eosw0044 #99,MANTE;

     eosw0002 #102;
|FIN;

|VARIABLES;
     XPara       = 0;
     XPara1      = 0;
     Fichero     = "";
     SwTempo     = 0;
     DActiv      = 0;
     HActiv      = 0;
     Tecla       = 0;
     Contador    = 0;
     LaActiv     = 0;
     Libro       = "";
     VAralf      = "";
     Fecha1      = @;
     Fecha2      = @;
     TipoDef     = "";
     SwCierraInfor = "";

     ValorPie     = 18;
     anyo         = "";
     fichero1     = "";

     Concep2      = 0;
     Concep6      = "";
     Concepto     = "";
     CalIRPF      = 0;
     tipoiva      = "";
     recs         = 0;
     rets         = 0;
     ivas         = 0;
     bases        = 0;
     basesr       = 0;
     tivas        = 0;
     trecs        = 0;
     trets        = 0;

     activida     = 0;
     act          = 0;
     d_act        = 0;
     h_act        = 0;
     FEstado      = 0;
     varalf       = "";
     nDTri        = 0;
     fec1         = @;
     fec2         = @;
     x            = 0;
     guion        = "-";
     sw_rep       = 0;
     sw_inv       = 0;
     sw_adq       = 0;
     situa        = 0;
     c_para       = 0;
     c_parb       = 0;
     c_parz       = 0;
     refer        = 0;
     c_inv        = 0;
     c_rep        = 0;
     c_adq        = 0;
     r_rep1       = 0;
     r_rep2       = 0;
     r_inv1       = 0;
     r_inv2       = 0;
     r_adq1       = 0;
     r_adq2       = 0;
     pepe         = 0;
     sw_impre     = 0;
     longi        = 0;
     informe      = "";

     impre_valor  = "";
     asc1         = 0;
     asc2         = 0;
     asc3         = 0;
     asc4         = 0;
     asc5         = 0;
     asc6         = 0;
     asc7         = 0;
     asc8         = 0;
     asc9         = 0;
     asc10        = 0;
     asc11        = 0;
     asc12        = 0;
     asc13        = 0;
     asc14        = 0;
     asc15        = 0;
     asc16        = 0;
     asc17        = 0;
     asc18        = 0;
     asc19        = 0;
     asc20        = 0;
     co_asc       = 0;
     d_asc        = 0;
     h_asc        = 0;
     co_co        = 0;
     sw_result    = 0;

     &LineaImpre  = 0;
     &clopr       = "PROVEEDOR";
     &varilla     = "";
     &pepe1       = 0;
     &pepe2       = 0;
     &pepe3       = 0;
     &pepe4       = 0;
     &pepe5       = 0;
     &pepe6       = 0;
     &sw          = 0;
     &linea       = 0;
     &swlin       = 0;
     &varinf      = "";
     &tlinea      = 0;
     &vari        = "";

     &PIvaInf       = 0;
     &PRecargoInf   = 0;
     &PRetencionInf = 0;
     &BIvaInf       = 0;
     &BRecargoInf   = 0;
     &BRetencionInf = 0;
     &TIvaInf       = 0;
     &TRecargoInf   = 0;
     &TRetencionInf = 0;

     &tbi         = 0;
     &tii         = 0;
     &tee         = 0;
     &trr         = 0;
     &totali      = 0;

     anyo1        = "";
     anyo2        = "";
     swimpre      = 0;
     xxxxfiac     = "  ";
     xxaponer     = "  ";
     xrelleno     = "                              ";

     Comodin = "";
     aAnyo   = "";
     Calc    = 0;

     nCuento  = 0;
     aBusco   = "";
     ntporc   = 0;
     nBasSumo = 0;
     nCuoSumo = 0;
     ivasI    = 0;
     fFecha   = @;
     aAlfa1   = "";
|FIN;

|INCLUYE i_consul;

|PROCESO Defecto; |TIPO 7;
  fFecha = ~;
  aAlfa1 = fFecha;
  aAlfa1 = aAlfa1 % -102;
  #0#27 = aAlfa1; |PINTA #0#27;
|FPRC;

|PROCESO Antes41; |TIPO 0;
 |SI #0#30 = "T";
     #0#40 = "R";
 |SINO;
     #0#40 = "F";
 |FINSI;
 |PINTA #0#40;
|FPRC;

|PROCESO PonFecha;
/*
  |SI #0#27 = 0;
      Fecha1  = ~;
      VAralf = Fecha1 % -102;
      #0#27   = VAralf;  |PINTA #0#27;
  |FINSI;
*/

  |SI #0#27 ] 80;
      VAralf = "01.01.19" + #0#27;
  |SINO;
      VAralf = "01.01.20" + (("00" + #0#27) % -102);
  |FINSI;
  Fecha1 = VAralf;

  |SI #0#27 ] 80;
      VAralf = "31.12.19" + #0#27;
  |SINO;
      VAralf = "31.12.20" + (("00" + #0#27) % -102);
  |FINSI;
  Fecha2 = VAralf;
|FPRC;

|PROCESO Seleccion;
  |HAZ PonFecha;

  #0#33 = Fecha1;   |PINTA #0#33;
  #0#34 = Fecha2;   |PINTA #0#34;

  |SI #0#0 = "S";
      |C_M #0#1, 1, "N";   #0#1 = 1;      |PINTA #0#1;
      |C_M #0#2, 1, "N";   #0#2 = 99999;  |PINTA #0#2;
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
  |SINO;
      |C_M #0#1, 1, "S";
      |C_M #0#2, 1, "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N";  #0XPara = 0;  |PINTA #0XPara;
      |SIGUE;
  |FINSI;

  |SI #0#30 = "T";
      |C_M #0#33, 1, "N";
      |C_M #0#34, 1, "N";
      |C_M #0#31, 1, "S";
      |C_M #0#32, 1, "S";
  |SINO;
      |C_M #0#33, 1, "S";
      |C_M #0#34, 1, "S";
      |C_M #0#31, 1, "N";  #0#31 = 1;  |PINTA #0#31;
      |C_M #0#32, 1, "N";  #0#32 = 4;  |PINTA #0#32;
  |FINSI;
|FPRC;

|PROCESO Fecha;|TIPO 0;
  |SI #0#33 < Fecha1;|O #0#33 > Fecha2;
       |MENAV "     La fecha no coincide con el a¤o seleccionado.";
       |ERROR;
  |FINSI;
  |SI #0#34 < Fecha1;|O #0#34 > Fecha2;
       |MENAV "     La fecha no coincide con el a¤o seleccionado.";
       |ERROR;
  |FINSI;
  |SI #0#33 > #0#34;
       |MENAV "     La fecha desde es mayor que la fecha hasta.";
       |ERROR;
  |FINSI;
|FPRC;

|PROCESO Actividad;
  |C_M #0#29, 1, "S";
  #0#29 = 6;
  |SI #0#28 = 0;
      |C_M #0#29, 1, "N";  #0#29 = 0;
  |FINSI;
  |PINTA #0#29;
|FPRC;

|| ************************** Procesos para cargar caracteres en impresoras


|PROCESO &carga_asc;
  asc1  = 0; asc2  = 0; asc3  = 0; asc4  = 0; asc5  = 0;
  asc6  = 0; asc7  = 0; asc8  = 0; asc9  = 0; asc10 = 0;
  asc11 = 0; asc12 = 0; asc13 = 0; asc14 = 0; asc15 = 0;
  asc16 = 0; asc17 = 0; asc18 = 0; asc19 = 0; asc20 = 0;
  co_co = 0;
  |PARA co_asc = d_asc; |SI co_asc [ h_asc; |HACIENDO co_asc = co_asc + 1;
        co_co = co_co + 1;
        |SI #9co_asc ! 999;
            |SI co_co = 1;  asc1  = #9co_asc; |FINSI;
            |SI co_co = 2;  asc2  = #9co_asc; |FINSI;
            |SI co_co = 3;  asc3  = #9co_asc; |FINSI;
            |SI co_co = 4;  asc4  = #9co_asc; |FINSI;
            |SI co_co = 5;  asc5  = #9co_asc; |FINSI;
            |SI co_co = 6;  asc6  = #9co_asc; |FINSI;
            |SI co_co = 7;  asc7  = #9co_asc; |FINSI;
            |SI co_co = 8;  asc8  = #9co_asc; |FINSI;
            |SI co_co = 9;  asc9  = #9co_asc; |FINSI;
            |SI co_co = 10; asc10 = #9co_asc; |FINSI;
            |SI co_co = 11; asc11 = #9co_asc; |FINSI;
            |SI co_co = 12; asc12 = #9co_asc; |FINSI;
            |SI co_co = 13; asc13 = #9co_asc; |FINSI;
            |SI co_co = 14; asc14 = #9co_asc; |FINSI;
            |SI co_co = 15; asc15 = #9co_asc; |FINSI;
            |SI co_co = 16; asc16 = #9co_asc; |FINSI;
            |SI co_co = 17; asc17 = #9co_asc; |FINSI;
            |SI co_co = 18; asc18 = #9co_asc; |FINSI;
            |SI co_co = 19; asc19 = #9co_asc; |FINSI;
            |SI co_co = 20; asc20 = #9co_asc; |FINSI;
        |SINO;
            |SAL;
        |FINSI;
  |SIGUE;

  |SI asc1    = 0; |ACABA; |FINSI;

  impre_valor =               &asc1  + &asc2  + &asc3  + &asc4  + &asc5;
  impre_valor = impre_valor + &asc6  + &asc7  + &asc8  + &asc9  + &asc10;
  impre_valor = impre_valor + &asc11 + &asc12 + &asc13 + &asc14 + &asc15;
  impre_valor = impre_valor + &asc16 + &asc17 + &asc18 + &asc19 + &asc20;

  |IMPRIME impre_valor;
|FPRC;

|| ************************* Borrado de todas las Variables

|PROCESO BorraVar;
  Concep2       = 0;
  Concep6       = "";
  Concepto      = "";
  CalIRPF       = 0;
  tipoiva       = "";
  recs          = 0;
  rets          = 0;
  ivas          = 0;
  bases         = 0;
  basesr        = 0;
  tivas         = 0;
  trecs         = 0;
  trets         = 0;
  sw_rep        = 0;
  sw_inv        = 0;
  sw_adq        = 0;
  situa         = 0;
  c_para        = 0;
  c_parb        = 0;
  c_parz        = 0;
  refer         = 0;
  c_inv         = 0;
  c_rep         = 0;
  c_adq         = 0;
  r_rep1        = 0;
  r_rep2        = 0;
  r_inv1        = 0;
  r_inv2        = 0;
  r_adq1        = 0;
  r_adq2        = 0;
  pepe          = 0;
  sw_impre      = 0;
  longi         = 0;
  sw_result     = 0;
  LineaImpre    = 0;
  varilla       = "";
  pepe1         = 0;
  pepe2         = 0;
  pepe3         = 0;
  pepe4         = 0;
  pepe5         = 0;
  pepe6         = 0;
  sw            = 0;
  linea         = 0;
  varinf        = "";
  tlinea        = 0;
  vari          = "";
  PIvaInf       = 0;
  PRecargoInf   = 0;
  PRetencionInf = 0;
  BIvaInf       = 0;
  BRecargoInf   = 0;
  BRetencionInf = 0;
  TIvaInf       = 0;
  TRecargoInf   = 0;
  TRetencionInf = 0;

  tbi           = 0;
  tii           = 0;
  tee           = 0;
  trr           = 0;
  totali        = 0;

  |DELINDEX #102;
|FPRC;

|| *********************** Proceso impresion del Libro
|PROCESO Encuentro;
 |SI ntporc = #102#2;
     ivasI  = 1;
     #102#3 = #102#3 + nBasSumo;
     #102#4 = #102#4 + nCuoSumo;
     |GRABA 020#102a;
 |FINSI;
 nCuento = #102#1;
|FPRC;

|DEFBUCLE BuscoIndi;
 #102#1;
 ;
 aBusco, 00;
 aBusco, 99;
 ;
 NULL, Encuentro;
|FIN;

|PROCESO BuscoIndice;
  nCuento = 0;
  ivasI   = 0;
  |BUCLE BuscoIndi;
  |SI ivasI = 0;
      |ABRE #102;
      |DDEFECTO #102;
      nCuento = nCuento + 1;
      #102#0 = aBusco;
      #102#1 = nCuento;
      #102#2 = ntporc;
      #102#3 = nBasSumo;
      #102#4 = nCuoSumo;
      |GRABA 020#102n;
      |CIERRA #102;
  |FINSI;
|FPRC;

|PROCESO Importes;         *********** ACUMULADOS *********
  tbi       = tbi + bases;
  tii       = tii + tivas;
  tee       = tee + trecs;
  trr       = trr + trets;
  totali    = totali + #10pepe;

  aBusco   = "I";
  ntporc   = ivas;
  nBasSumo = bases;
  nCuoSumo = tivas;
  |HAZ BuscoIndice;

  |SI trecs ! 0;
      aBusco  = "R";
      ntporc  = recs;
      nBasSumo = bases;
      nCuoSumo = trecs;
      |HAZ BuscoIndice;
  |FINSI;

  aBusco   = "P";
  ntporc   = rets;
  nBasSumo = basesr;
  nCuoSumo = trets;
  |HAZ BuscoIndice;
|FPRC;

|PROCESO LeeConce;
  |SI #6#50 = 1;
      |ABRE #2;
      #2#0 = Concep2;
      |LEE 040#2=;
      |SI FSalida = 0;
          tipoiva = #2#2;
          |SI #2#6 = "S";
              tipoiva = "A";
          |FINSI;

          |SI #2#2 ! "S"; |Y #2#2 ! "I"; |Y #2#6 ! "S";
              tipoiva = "";
          |FINSI;

          |SI #0#36 ! "T";
              |SI #0#36 ! tipoiva;  tipoiva = "";  |FINSI;
          |FINSI;

          Concepto = #2#0;
          CalIRPF  = #2#9;
      |SINO;
          tipoiva = "";
      |FINSI;
      |CIERRA #2;
  |SINO;
      |ABRE #12;
      #12#0 = Concep6;
      |LEE 040#12=;
      |SI FSalida = 0;
          tipoiva = #12#2;
          |SI #12#6 = "S";
              tipoiva = "A";
          |FINSI;

          |SI #12#2 ! "S"; |Y #12#2 ! "I"; |Y #12#6 ! "S";
              tipoiva = "";
          |FINSI;

          |SI #0#36 ! "T";
              |SI #0#36 ! tipoiva;  tipoiva = "";  |FINSI;
          |FINSI;

          Concepto = #12#0;
          CalIRPF  = #12#9;
      |SINO;
          tipoiva = "";
      |FINSI;
      |CIERRA #12;
  |FINSI;
|FPRC;

|PROCESO Parcial;
  |SI #10#11 ! 0; |O #10#13 ! 0;
      bases    = #10#11;
      ivas     = #10#12;  tivas = #10#13;
      recs     = #10#14;  trecs = #10#15;
      rets     = #10#16;  trets = #10#17;
      Concepto = #10#10;
      Concep2  = #10#10;
      Concep6  = #10#10;
                          |HAZ LeeConce;
      basesr   = #10#11;
      |SI CalIRPF = 2;
          basesr = #10#11 + #10#13 + #10#15;
      |FINSI;
      pepe     = 18; |HAZ Importes;
  |FINSI;

  |SI #10#20 ! 0; |O #10#22 ! 0;
      bases    = #10#20;
      ivas     = #10#21;  tivas = #10#22;
      recs     = #10#23;  trecs = #10#24;
      rets     = #10#25;  trets = #10#26;
      Concepto = #10#19;
      Concep2  = #10#19;
      Concep6  = #10#19;
                          |HAZ LeeConce;
      basesr   = #10#20;
      |SI CalIRPF = 2;
          basesr = #10#20 + #10#22 + #10#24;
      |FINSI;
      pepe     = 27; |HAZ Importes;
  |FINSI;

  |SI #10#29 ! 0; |O #10#31 ! 0;
      bases    = #10#29;
      ivas     = #10#30;  tivas = #10#31;
      recs     = #10#32;  trecs = #10#33;
      rets     = #10#34;  trets = #10#35;
      Concepto = #10#28;
      Concep2  = #10#28;
      Concep6  = #10#28;
                          |HAZ LeeConce;
      basesr   = #10#29;
      |SI CalIRPF = 2;
          basesr = #10#29 + #10#31 + #10#33;
      |FINSI;
      pepe     = 36; |HAZ Importes;
  |FINSI;
|FPRC;

|PROCESO Imprime;
  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0; |DDEFECTO #1;  |FINSI;

  |DDEFECTO #11;
  pepe1      = 0;
  pepe2      = 0;
  pepe3      = 0;
  pepe4      = 0;
  pepe5      = 0;
  pepe6      = 0;
  LineaImpre = -1;

  |SI sw_impre = 0; |PRINT; sw_impre = 1; |FINSI;

  |SI #10#11 ! 0; |O #10#13 ! 0;
      bases    = #10#11;                          ||  Bases
      ivas     = #10#12;  tivas = #10#13;         ||  Ivas
      recs     = #10#14;  trecs = #10#15;         ||  Recargos
      rets     = #10#16;  trets = #10#17;         ||  Retenciones
      Concepto = #10#10;
      Concep2  = #10#10;
      Concep6  = #10#10;
                          |HAZ LeeConce;
      basesr   = #10#11;
      |SI CalIRPF = 2;
          basesr = #10#11 + #10#13 + #10#15;
      |FINSI;
      pepe     = 18;      |HAZ Importes;

      #11#10  = #10#10;                        ||  Concepto
      #11#11  = #10#11;                        ||  Base 1
      #11#12  = #10#12;  #11#13  = #10#13;     ||  Ivas 1
      #11#14  = #10#14;  #11#15  = #10#15;     ||  Recargos 1
      #11#16  = #10#16;  #11#17  = #10#17;     ||  Retenciones 1
      #11#18  = #10#18;                        ||  Total Linea
      pepe1   = 1;
      LineaImpre = 1; |HAZ Impresion;
  |FINSI;

  |SI #10#20 ! 0; |O #10#22 ! 0;
      bases    = #10#20;                          ||  Bases
      ivas     = #10#21;  tivas = #10#22;         ||  Ivas
      recs     = #10#23;  trecs = #10#24;         ||  Recargo
      rets     = #10#25;  trets = #10#26;         ||  Retenciones
      Concepto = #10#19;
      Concep2  = #10#19;
      Concep6  = #10#19;
                          |HAZ LeeConce;
      basesr   = #10#20;
      |SI CalIRPF = 2;
          basesr = #10#20 + #10#22 + #10#24;
      |FINSI;
      pepe     = 27;  |HAZ Importes;

      |SI pepe1 = 0;
          #11#10  = #10#19;                    ||  Concepto
          #11#11  = #10#20;                    ||  Bases
          #11#12  = #10#21; #11#13  = #10#22;  ||  Ivas
          #11#14  = #10#23; #11#15  = #10#24;  ||  Recargo
          #11#16  = #10#25; #11#17  = #10#26;  ||  Retencion
          #11#18  = #10#27;                    ||  Total Linea
          pepe1   = 1;
          LineaImpre = 1; |HAZ Impresion;
      |SINO;
          #11#10  = #10#19;                    ||  Concepto
          #11#11  = #10#20;                    ||  Bases
          #11#12  = #10#21;  #11#13  = #10#22; ||  Ivas
          #11#14  = #10#23;  #11#15  = #10#24; ||  Recargos
          #11#16  = #10#25;  #11#17  = #10#26; ||  Retenciones
          #11#18  = #10#27;                    ||  Total Linea
          pepe2   = 1;
          LineaImpre = 0; |HAZ Impresion;
      |FINSI;
  |FINSI;

  |SI #10#29 ! 0; |O #10#31 ! 0;
      bases    = #10#29;                             || Bases
      ivas     = #10#30;  tivas = #10#31;            || Ivas
      recs     = #10#32;  trecs = #10#33;            || Recargos
      rets     = #10#34;  trets = #10#35;            || Retenciones
      Concepto = #10#28;
      Concep2  = #10#28;
      Concep6  = #10#28;
                          |HAZ LeeConce;
      basesr   = #10#29;
      |SI CalIRPF = 2;
          basesr = #10#29 + #10#31 + #10#33;
      |FINSI;
      pepe     = 36;  |HAZ Importes;

      |SI pepe1 = 0;
          #11#10  = #10#28;                         || Conceptos
          #11#11  = #10#29;                         || Bases
          #11#12  = #10#30;  #11#13  = #10#31;      || Ivas
          #11#14  = #10#32;  #11#15  = #10#33;      || Recargos
          #11#16  = #10#34;  #11#17  = #10#35;      || Retenciones
          #11#18  = #10#36;                         || Total Linea
          pepe1   = 1;
          LineaImpre = 1; |HAZ Impresion;
      |SINO;
          |SI pepe2 = 0;
              #11#10  = #10#28;                     || Conceptos
              #11#11  = #10#29;                     || Bases
              #11#12  = #10#30; #11#13  = #10#31;   || Ivas
              #11#14  = #10#32; #11#15  = #10#33;   || Recargos
              #11#16  = #10#34; #11#17  = #10#35;   || Retenciones
              #11#18  = #10#36;                     || Total Linea
              pepe2   = 1;
              LineaImpre = 0; |HAZ Impresion;
          |SINO;
              #11#10  = #10#28;                     || Concepto
              #11#11  = #10#29;                     || Bases
              #11#12  = #10#30; #11#13  = #10#31;   || Ivas
              #11#14  = #10#32; #11#15  = #10#33;   || Recargos
              #11#16  = #10#34; #11#17  = #10#35;   || Retenciones
              #11#18  = #10#36;                     || Total Lineas
              pepe3   = 1;
              LineaImpre = 0; |HAZ Impresion;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI swlin = 1; LineaImpre = 2; |HAZ Impresion; |FINSI;
|FPRC;

|PROCESO Impresion;
  #11#2   = #10#2;           || Del Registro
  #11#3   = #10#3;           || Al  Registro
  #11#4   = #10#4;           || Fecha
  #11#5   = #10#5;           || Nombre cliente
  #11#6   = #10#6;           || DNI
  #11#7   = #10#7;           || Descripcion Factura
  #11#8   = #10#8;           || Serie
  #11#9   = #10#9;           || Factura
  #11#19  = #10#64;          || Fecha Operacion

  |PRINT;
  linea = linea + 1;

  |SI #9#9 = "N";
      longi = #9#14 - ValorPie;
      |SI linea ] longi;
          LineaImpre = -1; FSalida = "PAGINA";    |PRINT;
          linea = 0;
      |FINSI;
  |SINO;
      longi = #9#14 - ValorPie;
      |SI linea ] longi;
          LineaImpre = -1; FSalida = "PAGINA";    |PRINT;
          linea = 0;
      |FINSI;
  |FINSI;
  vari = "   TOTAL";
|FPRC;

|DEFBUCLE eosw0009P;
  #10#1;
  ;
  00000, TipoDef;
  99999, TipoDef;
  e;
  NULL, Parcial;
|FIN;

|DEFBUCLE eosw0009S;
  #10#1;
  ;
  00000, TipoDef;
  99999, TipoDef;
  ;
  NULL, Imprime;
|FIN;


|PROCESO ImprimoInd;
  |SI #102#2 ! 0;
      |SI aBusco = "I";
          sw = 0;
          PIvaInf = #102#2;
          BIvaInf = #102#3;
          TIvaInf = #102#4;
      |FINSI;
      |SI aBusco = "R";
          sw = 1;
          PRecargoInf = #102#2;
          BRecargoInf = #102#3;
          TRecargoInf = #102#4;
      |FINSI;
      |SI aBusco = "P";
          sw = 4;
          PRetencionInf = #102#2;
          BRetencionInf = #102#3;
          TRetencionInf = #102#4;
      |FINSI;
      |PRINT;
  |FINSI;

|FPRC;

|DEFBUCLE ImprimoIndi;
 #102#2;
 ;
 aBusco, 0;
 aBusco, 100;
 ;
 NULL, ImprimoInd;
|FIN;

|PROCESO Resultado;        ******* CALCULO SEGUNDO INFORME DE ACUMULADOS IVA ****
  |INFOR "eosivac2";
  |SI FSalida ! 0; |ACABA; |FINSI;

  sw = -1;
  aBusco = "I";
  |BUCLE ImprimoIndi;
  |SI sw = 0; sw = 2; |PRINT; |FINSI;

  sw = -1;
  aBusco = "R";
  |BUCLE ImprimoIndi;
  |SI sw = 1; sw = 3; |PRINT; |FINSI;

  sw = -1;
  aBusco = "P";
  |BUCLE ImprimoIndi;
  |SI sw = 4; sw = 5; |PRINT; |FINSI;

  |PIEINF;
  |FININF;
  |SI #9#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;
|FPRC;

|PROCESO Resumen;                      || ***** Resumen FINALES ************
  |SI #99#7 = "S";
      #6#20 = #99#6 - 1;
      |SI FEstado = 0; |GRABA 040#6a; |FINSI;
  |FINSI;

  |SI #9#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;

  |SI sw_result = 1; |HAZ Resultado; |FINSI;
|FPRC;

|| *********************** Proceso preparacion Temporal del libro

|PROCESO GrabaTempo10;
  #10#0 = refer;
  #10#1 = tipoiva;
  |LIBERA #10;
  |LEE 140#10=;
  |SI FSalida = 0;
      |SI situa = 1;
          #10#10 = Concepto;                            || Concepto
                           #10#11 = #10#11 + bases;     || Bases
          #10#12 = ivas;   #10#13 = #10#13 + tivas;     || Ivas
          #10#14 = recs;   #10#15 = #10#15 + trecs;     || Recargos
          #10#16 = rets;   #10#17 = #10#17 + trets;     || Retenciones
          #10#18 = #10#11 + #10#13 + #10#15 - #10#17;   || Total Linea
      |FINSI;

      |SI situa = 2;
          #10#19 = Concepto;                            || Concepto
                            #10#20 = #10#20 + bases;    || Bases
          #10#21 = ivas;    #10#22 = #10#22 + tivas;    || Ivas
          #10#23 = recs;    #10#24 = #10#24 + trecs;    || Recargos
          #10#25 = rets;    #10#26 = #10#26 + trets;    || Retenciones
          #10#27 = #10#20 + #10#22 + #10#24 - #10#26;   || Total Linea
      |FINSI;

      |SI situa  = 3;
          #10#28 = Concepto;                            || Concepto
                            #10#29 = #10#29 + bases;    || Bases
          #10#30 = ivas;    #10#31 = #10#31 + tivas;    || Ivas
          #10#32 = recs;    #10#33 = #10#33 + trecs;    || Recargos
          #10#34 = rets;    #10#35 = #10#35 + trets;    || Retenciones
          #10#36 = #10#29 + #10#31 + #10#33 - #10#35;   || Total Linea
      |FINSI;

      |GRABA 140#10a;
  |SINO;
      |DDEFECTO #10;
      #10#0 = refer;
      #10#1 = tipoiva;

      r_rep2 = 0; r_inv2 = 0;
      |SI tipoiva = "S"; |O tipoiva = "X";
          |SI #9#10 = "A"; r_rep1 = r_rep1 + 1; |SINO; r_rep1 = #4#1; |FINSI;
          #10#2 = r_rep1;
          |SI #4#20 = "S";
              r_rep2 = (r_rep1 + #4#21) - 1;
              r_rep1 = r_rep2;
          |FINSI;
          #10#3 = r_rep2;
      |FINSI;

      |SI tipoiva = "I"; |O tipoiva = "Y";
          |SI #9#10 = "A"; r_inv1 = r_inv1 + 1; |SINO; r_inv1 = #4#1; |FINSI;
          #10#2 = r_inv1;
          |SI #4#20 = "S";
              r_inv2 = (r_inv1 + #4#21) - 1;
              r_inv1 = r_inv2;
          |FINSI;
          #10#3 = r_inv2;
      |FINSI;

      r_adq2 = 0; r_adq2 = 0;
      |SI tipoiva = "A"; |O tipoiva = "Z";
          |SI #9#10 = "A"; r_adq1 = r_adq1 + 1; |SINO; r_adq1 = #4#1; |FINSI;
          #10#2 = r_adq1;
          |SI #4#20 = "S";
              r_adq2 = (r_adq1 + #4#21) - 1;
              r_adq1 = r_adq2;
          |FINSI;
          #10#3 = r_adq2;
      |FINSI;

      #10#5 = #4#38;
      #10#6 = #4#12;
      |SI #4#3 = 0;
          |SI #4#38 = "                              ";
              #10#5 = "AL CONTADO";
              #10#6 = "";
          |FINSI;
      |FINSI;
      #10#4  = #4#13;
      #10#7  = #4#6;
      #10#8  = #4#15;
      #10#9  = #4#16;
      #10#64 = "";
      |SI #4#79 > "01.01.0000"; |Y #4#79 ! #10#4;
          #10#64 = #4#79;
      |FINSI;


      |SI situa = 1;
          #10#10 = Concepto;                            || Concepto
                           #10#11 = bases;              || Bases
          #10#12 = ivas;   #10#13 = tivas;              || Ivas
          #10#14 = recs;   #10#15 = trecs;              || Recargos
          #10#16 = rets;   #10#17 = trets;              || Retenciones
          #10#18 = #10#11 + #10#13 + #10#15 - #10#17;   || Total Linea
      |FINSI;

      |SI situa = 2;
          #10#19 = Concepto;                            || Concepto
                            #10#20 = bases;             || Bases
          #10#21 = ivas;    #10#22 = tivas;             || Ivas
          #10#23 = recs;    #10#24 = trecs;             || Recargos
          #10#25 = rets;    #10#26 = trets;             || Retenciones
          #10#27 = #10#20 + #10#22 + #10#24 - #10#26;   || Total Linea
      |FINSI;

      |SI situa  = 3;
          #10#28 = Concepto;                            || Concepto
                            #10#29 = bases;             || Bases
          #10#30 = ivas;    #10#31 = tivas;             || Ivas
          #10#32 = recs;    #10#33 = trecs;             || Recargos
          #10#34 = rets;    #10#35 = trets;             || Retenciones
          #10#36 = #10#29 + #10#31 + #10#33 - #10#35;   || Total Linea
      |FINSI;

      |GRABA 140#10n;
  |FINSI;
|FPRC;

|PROCESO FiltroFecha;
  |SI ivas = 0; |Y bases = 0; |ACABA; |FINSI;

  |SI #0#30 = "T";
      |SI #4#17 < #0#31;
          |SI #9#8 = "P"; |ACABA; |FINSI;
          |SI tipoiva = "S";
              |SI sw_rep = 0;
                  tipoiva = "X";
                  c_para  = c_para + 1;
                  refer   = c_para;
                  sw_rep  = 1;
              |SINO;
                  tipoiva = "X";
                  refer  = c_para;
              |FINSI;
          |FINSI;

          |SI tipoiva = "I";
              |SI sw_inv = 0;
                  tipoiva = "Y";
                  c_parb  = c_parb + 1;
                  refer   = c_parb;
                  sw_inv  = 1;
              |SINO;
                  tipoiva = "Y";
                  refer  = c_parb;
              |FINSI;
          |FINSI;

          |SI tipoiva = "A";
              |SI sw_adq = 0;
                  tipoiva = "Z";
                  c_parz  = c_parz + 1;
                  refer   = c_parz;
                  sw_adq  = 1;
              |SINO;
                  tipoiva = "Z";
                  refer  = c_parz;
              |FINSI;
          |FINSI;

          |HAZ GrabaTempo10;
      |SINO;
          |SI tipoiva = "I";
              |SI sw_inv = 0;
                  c_inv  = c_inv + 1;
                  refer  = c_inv;
                  sw_inv = 1;
              |SINO;
                  refer  = c_inv;
              |FINSI;
          |FINSI;

          |SI tipoiva = "S";
              |SI sw_rep = 0;
                  c_rep  = c_rep + 1;
                  refer  = c_rep;
                  sw_rep = 1;
              |SINO;
                  refer  = c_rep;
              |FINSI;
          |FINSI;

          |SI tipoiva = "A";
              |SI sw_adq = 0;
                  c_adq  = c_adq + 1;
                  refer  = c_adq;
                  sw_adq = 1;
              |SINO;
                  refer  = c_adq;
              |FINSI;
          |FINSI;
          |HAZ GrabaTempo10;
      |FINSI;
  |SINO;
      |SI #4#13 < #0#33;
          |SI #9#8 = "P"; |ACABA; |FINSI;
          |SI tipoiva = "S";
              |SI sw_rep = 0;
                  tipoiva = "X";
                  c_para  = c_para + 1;
                  refer  = c_para;
                  sw_rep = 1;
              |SINO;
                  tipoiva = "X";
                  refer  = c_para;
              |FINSI;
          |FINSI;

          |SI tipoiva = "I";
              |SI sw_inv = 0;
                  tipoiva = "Y";
                  c_parb  = c_parb + 1;
                  refer   = c_parb;
                  sw_inv  = 1;
              |SINO;
                  tipoiva = "Y";
                  refer  = c_parb;
              |FINSI;
          |FINSI;

          |SI tipoiva = "A";
              |SI sw_inv = 0;
                  tipoiva = "Z";
                  c_parz  = c_parz + 1;
                  refer   = c_parz;
                  sw_adq  = 1;
              |SINO;
                  tipoiva = "Z";
                  refer  = c_parz;
              |FINSI;
          |FINSI;
          |HAZ GrabaTempo10;
      |SINO;
          |SI tipoiva = "I";
              |SI sw_inv = 0;
                  c_inv  = c_inv + 1;
                  refer  = c_inv;
                  sw_inv = 1;
              |SINO;
                  refer  = c_inv;
              |FINSI;
          |FINSI;

          |SI tipoiva = "S";
              |SI sw_rep = 0;
                  c_rep  = c_rep + 1;
                  refer  = c_rep;
                  sw_rep = 1;
              |SINO;
                  refer  = c_rep;
              |FINSI;
          |FINSI;

          |SI tipoiva = "A";
              |SI sw_adq = 0;
                  c_adq  = c_adq + 1;
                  refer  = c_adq;
                  sw_adq = 1;
              |SINO;
                  refer  = c_adq;
              |FINSI;
          |FINSI;
          |HAZ GrabaTempo10;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO LineasCompras;
  sw_rep   = 0;
  sw_inv   = 0;
  sw_adq   = 0;
  Concep2  = #4#5;
  Concep6  = #4#72;
  |HAZ LeeConce;

  |SI tipoiva = "I"; |O tipoiva = "S";  |O tipoiva = "A";
      situa  = 1;
      bases  = #4#7;
      ivas   = #4#8;
      tivas  = #4#9;
      recs   = #4#10;
      trecs  = #4#11;
      rets   = #4#39;
      trets  = #4#42;
      |HAZ FiltroFecha;
  |FINSI;

  Concep2 = #4#33;
  Concep6 = #4#73;
  |HAZ LeeConce;

  |SI tipoiva = "I"; |O tipoiva = "S";  |O tipoiva = "A";
      situa = 2;
      bases = #4#23;
      ivas  = #4#25;
      tivas = #4#27;
      recs  = #4#29;
      trecs = #4#31;
      rets  = #4#40;
      trets = #4#43;
      |HAZ FiltroFecha;
  |FINSI;

  Concep2 = #4#34;
  Concep6 = #4#74;
  |HAZ LeeConce;

  |SI tipoiva = "I"; |O tipoiva = "S";  |O tipoiva = "A";
      situa = 3;
      bases = #4#24;
      ivas  = #4#26;
      tivas = #4#28;
      recs  = #4#30;
      trecs = #4#32;
      rets  = #4#41;
      trets = #4#44;
      |HAZ FiltroFecha;
  |FINSI;
|FPRC;

|DEFBUCLE eoslinco;
  #4#1;
  17, 13, 19;
  #99#0, #99#2, 00001, nDTri, fec1,  DActiv;
  #99#0, #99#2, 32000, #0#32, #0#34, HActiv;
  ;
  NULL, LineasCompras;
|FIN;

|DEFBUCLE eoslFecha;
  #4#2;
  ;
  #99#0, #99#2, nDTri, DActiv, fec1,  00000;
  #99#0, #99#2, #0#32, HActiv, #0#34, 32000;
  ;
  NULL, NULL, NULL, NULL, NULL, LineasCompras;
  #4#13, #4#1;
|FIN;
|| *********************** Proceso preparacion del libro

|PROCESO Soportado;
  sw_impre = 0;
  varilla  = #9#16;
  TipoDef = "X";  |BUCLE eosw0009P;

  SwCierraInfor = 0;
  |INFOR Libro;
  |SI FSalida ! 0; |DELINDEX #10; |ACABA; |FINSI;

  TipoDef = "S";  |BUCLE eosw0009S;
  |SI sw_impre = 1;
      sw_result     = 1;
      varilla       = #9#20;
      SwCierraInfor = 1;
      |PIEINF;
      |FININF;
      |HAZ Resumen;
  |SINO;
      |SI #0#36 = "T"; |O #0#36 = "S";
          |SI #0#37 = "S";
              sw_result     = 0;
              longi         = #9#14 - ValorPie;
              LineaImpre    = -1; |PRINT;
              SwCierraInfor = 1;
              |PIEINF;
              |FININF;
              varilla       = #9#20;
              |HAZ Resumen;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI SwCierraInfor = 0;  |FININF;  |FINSI;
|FPRC;

|PROCESO Inversiones;
  |HAZ BorraVar;

  sw_impre = 0;
  varilla  = #9#18;

  TipoDef = "Y";  |BUCLE eosw0009P;

  SwCierraInfor = 0;
  |INFOR Libro;
  |SI FSalida ! 0; |DELINDEX #10;  |ACABA; |FINSI;

  TipoDef = "I";  |BUCLE eosw0009S;
  |SI sw_impre = 1;
      sw_result     = 1;
      varilla       = #9#22;
      SwCierraInfor = 1;
      |PIEINF;
      |FININF;
      |HAZ Resumen;
  |SINO;
      |SI #0#36 = "T"; |O #0#36 = "I";
          |SI #0#37 = "S";
              sw_result     = 0;
              longi         = #9#14 - ValorPie;
              LineaImpre    = -1; |PRINT;
              SwCierraInfor = 1;
              |PIEINF;
              |FININF;
              varilla       = #9#22;
              |HAZ Resumen;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI SwCierraInfor = 0;  |FININF;  |FINSI;
|FPRC;

|PROCESO Adquisiciones;
  |HAZ BorraVar;

  sw_impre = 0;
  varilla  = "* REGISTROS DE FACTURAS RECIBIDAS (Adq.Intracomunitarias) *";

  TipoDef = "Z";  |BUCLE eosw0009P;

  SwCierraInfor = 0;
  |INFOR Libro;
  |SI FSalida ! 0; |DELINDEX #10;  |ACABA; |FINSI;

  TipoDef = "A";  |BUCLE eosw0009S;
  |SI sw_impre = 1;
      sw_result     = 1;
      varilla       = "* RESUMEN DE I.V.A. ADQUISICIONES INTRACOMUNITARIAS *";
      SwCierraInfor = 1;
      |PIEINF;
      |FININF;
      |HAZ Resumen;
  |SINO;
      |SI #0#36 = "T"; |O #0#36 = "A";
          |SI #0#37 = "S";
              sw_result     = 0;
              longi         = #9#14 - ValorPie;
              LineaImpre    = -1; |PRINT;
              SwCierraInfor = 1;
              |PIEINF;
              |FININF;
              varilla       = "* RESUMEN DE I.V.A. ADQUISICIONES INTRACOMUNITARIAS *";
              |HAZ Resumen;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI SwCierraInfor = 0;  |FININF;  |FINSI;

  |HAZ BorraVar;
|FPRC;


|PROCESO PreparaLibro;

  |SI PARAMETRO = "";
     |PINDA #0#99;
  |FINSI;

  |SI #99#1 = 0;
      |SELECT #4#6;
      #6#0 = #99#0;
      #6#2 = #99#2;
      #6#1 = 1;
      |LEE 000#6];
  |SINO;
      |SELECT #1#6;
      #6#0 = #99#0;
      #6#1 = #99#1;
      #6#2 = #99#2;
      |LEE 000#6];
  |FINSI;

  |SI FSalida ! 0;   |ACABA;  |FINSI;
  |SI #6#0  ! #99#0; |ACABA;  |FINSI;
  |SI #0#28 ! 0;  |Y #6#2 ! #99#2; |ACABA;  |FINSI;

  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

  |HAZ BorraVar;

  VAralf  = #99#0;   VAralf = ("00000" + #99#0) % -105;
  Fichero = VAralf;
  VAralf  = #99#2;   VAralf = ("00" + #99#2) % -102;
  Fichero = "c" + Fichero + VAralf;
  |NOME_DAT #4 Fichero;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("9" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #10 Fichero;
  |ABRE #10;  |CIERRA #10;  |DELINDEX #10;

  DActiv = #99#1;
  HActiv = #99#1;
  |SI #99#1 = 0;  DActiv = 1;  HActiv = 6;  |FINSI;

  |ABRE #10;
  |SI #0#40 = "F";
      |BUCLE eoslFecha;
  |SINO;
      |BUCLE eoslinco;
  |FINSI;
  |CIERRA #10;

  |HAZ Soportado;
  |HAZ Inversiones;
  |HAZ Adquisiciones;

  |DELINDEX #10;
|FPRC;

|DEFBUCLE eosw0044;
  #99#1;
  8;
  00000, 0, 00, "S";
  99999, 9, 99, "S";
  ;
  NULL, PreparaLibro;
|FIN;

|| ***************************** Preparacion del Temporal

|PROCESO GrabaTempo;
  #13#0 = #6#0;
  #13#4 = #0#27;
  |LEE 040#13=;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  #99#0 = #6#0;
  #99#1 = #6#1;
  |SI #0#28 = 0;  #99#1 = 0;  |FINSI;
  #99#2 = #0#27;
  |LIBERA #99;
  |LEE 140#99=;
  |SI FSalida = 0;  |ACABA;  |FINSI;

  SwTempo = 1;
  #99#0 = #6#0;
  #99#1 = #6#1;
  |SI #0#28 = 0;  #99#1 = 0;  |FINSI;
  #99#2 = #0#27;
  #99#3 = #6#3;
  #99#4 = #6#6;
  #99#5 = #6#20;
  #99#6 = #6#20 + 1;
  #99#7 = "S";
  #99#8 = "S";
  |GRABA 140#99n;
|FPRC;

|DEFBUCLE eosactiv;
  #6#1;
  15, 41;
  #0#1, DActiv, #0#27, "S",   " ";
  #0#2, HActiv, #0#27, "S", #0#38;
  ;
  NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja;
  #99#0 = 00001;
  #99#1 = 0;
  #99#2 = #0#27;
|FRUT;

|RUTINA ClaveAlta;
  #99#0 = 99999;
  #99#1 = 9;
  #99#2 = #0#27;
|FRUT;

|PROCESO Tipo3; |TIPO 3;      || EMPIEZA EL CALCULO
  |PARA XPara = 0; |SI XPara [ 38;  |HACIENDO XPara = XPara + 1;
        #14XPara = #0XPara;
  |SIGUE;

  |ABRE #9;
  |LEE 040#9p;
  |SI FSalida ! 0;
      |MENAV "     No existe control de libros.";
      |CIERRA #9;
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #9;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("L7" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #99 Fichero;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("L9" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #102 Fichero;

  DActiv = #0#28;
  HActiv = #0#29;
  |SI #0#28 = 0; DActiv = 1;  HActiv = 9;  |FINSI;

  |SI PARAMETRO ! "";
     Impresora = "?c:\tmp1,,,?Facturas recibidas";
  |FINSI;

  fec1 = "01.01.1900";
  nDTri = 1;
  |SI #0#41 = "N";
      |SI #0#30 = "F";
          fec1  = #0#33;  || inicio
      |FINSI;
      |SI #0#30 = "T";
          nDTri = #0#31;
      |FINSI;
  |FINSI;

  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  d_asc = 48;  h_asc = 67;  |HAZ carga_asc;

  |SI #9#9 = "N"; swlin = 0; |SINO; swlin = 1; |FINSI;

  Libro = #9#12;  |QBF Libro;
  Libro = Libro < Libro;

  |ABRE #10;
  |ABRE #13;
  |ABRE #99;
  |SI #0#0 = "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |SI #0XPara ! 0;
                #0#1 = #0XPara;
                #0#2 = #0XPara;
                |BUCLE eosactiv;
             |FINSI;
      |SIGUE;
  |SINO;
      |BUCLE eosactiv;
  |FINSI;
  |CIERRA #10;
  |CIERRA #13;
  |CIERRA #99;

  |SI SwTempo = 0;
      |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
      |FINIMP;
      |ACABA;
  |FINSI;

  |SI PARAMETRO = "";
      |ENTLINEAL #1#99, -3, 4, 20, 1, ClaveBaja, ClaveAlta;
  |FINSI;

  |ABRE #1;
  |ABRE #6;
  |BUCLE eosw0044;
  |CIERRA #1;
  |CIERRA #6;

  |SI #9#26 = "S"; d_asc = 68; h_asc = 87; |HAZ carga_asc; |FINSI;
  |FINIMP;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
  |DELINDEX #102;
|FPRC;

|| ****************************** Procesos del Temporal

|PROCESO Tipo11;  |TIPO 11;
  |SI FSalida ! 9;  |Y FSalida ! 10;  |ACABA;  |FINSI;

  Tecla = FSalida;

  |LIBERA #99;
  |LEE 140#99=;

  |SI Tecla = 9;
        |SI #99#8 = "N";
            #99#8 = "S";
        |SINO;
            #99#8 = "N";
            #99#6 = 0;
            #99#7 = "N";
        |FINSI;
  |FINSI;

  |SI Tecla = 10;
      #99#8 = "S";
      |C_M #99#6, 1, "S";
      |C_M #99#7, 1, "S";
      |ENCAMPO #6#99;
      |ENCAMPO #7#99;
  |FINSI;

  |PINTA #99#6;
  |PINTA #99#7;
  |PINTA #99#8;

  |GRABA 140#99a;

  |C_M #99#6, 1, "N";
  |C_M #99#7, 1, "N";
|FPRC;

|PROGRAMA;
   |SI PARAMETRO = "";
       |MANTE #0;
   |SINO;
      #0#0 = "N";
      Comodin = PARAMETRO;
      Comodin = Comodin - ",";
      |SI FSalida ! 0;
         Calc = FSalida + 98;
         aAnyo = Comodin % Calc; Comodin = Comodin - aAnyo;
      |FINSI;
      #0#3 = Comodin;
      #0#28 = 0;
      #0#30 = "F";
      Comodin = "01.01." + aAnyo; #0#33 = Comodin;
      Comodin = "31.12." + aAnyo; #0#34 = Comodin;
      #0#36 = "T";
      #0#38 = "N";
      |HAZ Tipo3;
   |FINSI;
|FPRO;
