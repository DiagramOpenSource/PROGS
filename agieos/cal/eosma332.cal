|FICHEROS;
   eosma332 #0;
   eosclien #2;
   eosaplic #4;
   eosactiv #5;
   eosopes1 #7,MANTE;
   eosw0052 #98,MANTE;
|FIN;

|VARIABLES;
   &sw_sit     = 1;
   &d_empre    = 0;
   &h_empre    = 0;
   &el_anyo    = 0;
   &SwViene    = 1;
   &VEmpresa   = 0;
   &VPeriodo   = 0;
   &VAnyo      = 0;
   &VActiv     = 0;

   Tecla    = 0;
   cont     = 0;
   empresa  = 0;
   trime    = 0;
   anyo     = 0;
   activi   = 0;
   compen   = 0;
   base     = 0;
   tipo     = 0;
   total    = 0;
   rendi1   = 0;
   rendi2   = 0;
   penult   = 0;
   estado   = 0;
   ventas   = 0;
   x        = 0;
   camp     = 0;
   tipo_p   = "";
   devol_1  = 0;
   devol_2  = 0;
   modo     = 0;
   campo    = 0;
   modifica = 0;
   FEstado  = 0;

   pregunta = "2400NEl 130 ya esta impreso desea modificarlo : ";
   xxxxfiac = "  ";
   xxaponer = "  ";
   xrelleno = "                              ";

   nError   = 0;
|FIN;

|INCLUYE i_seguim;

|PROCESO i_archiv; |TIPO 7;
|SI #0#6 = "S";
    |MENAV "     Registro archivado, DESARCHIVELO";
    |PTEC 807;
|FINSI;
|FPRC;

|PROCESO empresa; |TIPO 0;
|ABRE #2;
#2#0 = #0#0;
|LEE 040#2=;
|SI FSalida ! 0;
  |MENAV "     No existe Empresa.";
  |ERROR;
|SINO;
   cont = (FEntrada / 100) ! 0;
   |SI cont ! 1; |CIERRA #2; |ACABA;  |FINSI;

   |ABRE #4;
   |LEE 040#4p;
   |SI FSalida = 0;
       #0#8  = #4#1; |PINTA #0#8;
       #0#11 = #4#2; |PINTA #0#11;
       #0#14 = #4#3; |PINTA #0#14;
       #0#17 = #4#4; |PINTA #0#17;
       #0#20 = #4#5; |PINTA #0#20;
       #0#23 = #4#6; |PINTA #0#23;
       #0#70 = #4#13;
       #0#73 = #4#14;
       #0#76 = #4#15;
   |FINSI;
   |CIERRA #4;
|FINSI;
|CIERRA #2;
|FPRC;

|PROCESO activida; |TIPO 0;
|ABRE #5;
#5#0 = #0#0;
#5#1 = #0#1;
#5#2 = #0#4;
|LEE 040#5=;
|SI FSalida ! 0;
    |MENAV "    No existe Actividad.";
    |ERROR;
|SINO;
    |SI #5#14 = "S";
       |MENAV "    La Actividad es un Comunero";
       |PTEC 807;
    |FINSI;
    |SI #5#22 = "A";
       |MENAV "    La Actividad esta sujeta a Modulos";
       |PTEC 807;
    |FINSI;
|FINSI;
|CIERRA #5;
|FPRC;

|PROCESO borrado; |TIPO 2;
modo = (FEntrada / 100) ! 0;
|SI modo ! 3; |ACABA; |FINSI;

|ABRE #7;
#7#0 = #0#0;
#7#1 = #0#1;
#7#2 = #0#2;
#7#3 = #0#4;
|BORRA 140#7c;
|LIBERA #7;
|CIERRA #7;
|FPRC;

|PROCESO periodo; |TIPO 0;
|CAMPO_MODIFICA #0#3, 1, "S";
|SI #0#2 > 4; #0#3 = "M"; |CAMPO_MODIFICA #0#3, 1, "N"; |FINSI;
|FPRC;

|PROCESO anyopas; |TIPO 0;
cont = (FEntrada / 100) ! 0;
|SI cont ! 1; |ACABA; |FINSI;

|SI #0#2 = 1;
    |ABRE #5;
    #5#0 = #0#0;
    #5#1 = #0#1;
    #5#2 = #0#4 - 1;
    |SI #5#2 < 0;  #5#2 = 99;  |FINSI;
    |LEE 040#5=;
    |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
    #0#44 = #5#34;

    #5#0 = #0#0;
    #5#1 = #0#1;
    #5#2 = #0#4;
    |LEE 040#5=;
    |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
    |CIERRA #5;
|SINO;
    empresa = #0#0;
    activi  = #0#1;
    trime   = #0#2;
    tipo_p  = #0#3;
    anyo    = #0#4;

    |DDEFECTO #0;
    #0#0    = empresa;
    #0#1    = activi;
    #0#2    = trime - 1;
    #0#3    = tipo_p;
    #0#4    = anyo;
    compen  = 0;
    |LEE 040#0=;
    |SI FSalida = 0; compen = #0#52; |FINSI;

    |DDEFECTO #0;
    #0#0    = empresa;
    #0#1    = activi;
    #0#2    = trime;
    #0#3    = tipo_p;
    #0#4    = anyo;
    |LEE 040#0=;
    |SI FSalida ! 0;
        |DDEFECTO #0;
        #0#0    = empresa;
        #0#1    = activi;
        #0#2    = trime;
        #0#3    = tipo_p;
        #0#4    = anyo;
    |FINSI;
    #0#44 = compen;
    |PINTA #0#0;
    |PINTA #0#1;
    |PINTA #0#2;
    |PINTA #0#3;
    |PINTA #0#4;
|FINSI;
|FPRC;

|PROCESO modifica; |TIPO 0;
modifica = 0;
|SI #0Campo ! Contenido; modifica = 1; |FINSI;
|FPRC;

|PROCESO cuota1; |TIPO 7;
|SI modifica = 0; |ACABA; |FINSI;

base = Campo - 2;
tipo = Campo - 1;
#0Campo = #0base % #0tipo;
|PINTA #0Campo;
|FPRC;

|PROCESO sumacuot; |TIPO 0;
     #0#27 = #0#9 + #0#12 + #0#15 + #0#18 + #0#21 + #0#24 + #0#26;
     |PINTA #0#27;
     |HAZ total;
     |HAZ especifi;
|FPRC;

|PROCESO cuota2; |TIPO 0;
     #0#40 = #0#29 + #0#31 + #0#33 + #0#34 + #0#35 + #0#37 + #0#39;
     |PINTA #0#40;
     |HAZ total;
|FPRC;

|PROCESO total; |TIPO 0;
Tecla = FSalida;
|HAZ funcion_9;
campo = Campo;
#0#41 = #0#27 - #0#40;         |PINTA #0#41;
#0#43 = #0#41 % #0#42;         |PINTA #0#43;

|SI #0#4 < 95; |Y #0#4 ] 80;
    #0#48 = (#0#45 + #0#46 + #0#47 + #0#68) % 15;  |PINTA #0#48;
|SINO;
    #0#48 = (#0#45 + #0#46 + #0#47 + #0#68) % 16;  |PINTA #0#48;
|FINSI;

#0#50 = #0#43 - #0#44 + #0#49; |PINTA #0#50;

devol_1 =  #0#48;
devol_2 = -#0#50;

modo = (FEntrada / 100) ! 0;

|SI campo = 51; |O campo = 52; |O campo = 53;
    |SI #0#50 > 0;
        |CAMPO_MODIFICA #0#51, 1, "N";
        |CAMPO_MODIFICA #0#52, 1, "N";
        |CAMPO_MODIFICA #0#53, 1, "N";
        #0#51 = 0;     |PINTA #0#51;
        #0#52 = 0;     |PINTA #0#52;
        #0#53 = #0#50; |PINTA #0#53;
    |SINO;
        |CAMPO_MODIFICA #0#51, 1, "S";
        |CAMPO_MODIFICA #0#52, 1, "N";
        |CAMPO_MODIFICA #0#53, 1, "N";
        #0#52 = devol_2 - #0#51; |PINTA #0#52;
        #0#53 = 0;               |PINTA #0#53;
    |FINSI;
|SINO;
    |SI modo = 1;
        |SI #0#50 < 0;
            |SI #0#51 > devol_1; |Y devol_1 ! 0; #0#51 = devol_1; |FINSI;
            #0#52 = devol_2;
            #0#51 = devol_2 - #0#52;
            #0#53 = 0;
        |SINO;
            #0#51   = 0;
            #0#52   = 0;
            #0#53   = #0#50;
        |FINSI;
    |FINSI;
|FINSI;

|PINTA #0#51;
|PINTA #0#52;
|PINTA #0#53;
|HAZ especifi;
|FPRC;

|PROCESO especifi; |TIPO 0;
|ABRE #7;
#7#0 = #0#0;
#7#1 = #0#1;
#7#2 = #0#2;
#7#3 = #0#4;
|LIBERA #7;
|LEE 140#7=;
FEstado = FSalida;
|SI FSalida ! 0; |CDEFECTO #7, 1; |FINSI;

||#7#7  = #0#45;
||#7#12 = #0#25;

|SI FEstado = 0; |GRABA 140#7a; |SINO; |GRABA 140#7n; |FINSI;
|CIERRA #7;
|FPRC;

|PROCESO graba_segui; |TIPO 30;
|ABRE #5;
#5#0 = #0#0;
#5#1 = #0#1;
#5#2 = #0#4;
|LIBERA #5;
|LEE 140#5=;
|SI FSalida = 0;
    |SI #0#2 = 4; |Y #0#3 = "T";
        |SI #0#52 > 0; #5#34 = #0#52; |FINSI;
        |GRABA 140#5a;
    |FINSI;
    |SI #0#2 = 12; |Y #0#3 = "M";
        |SI #0#52 > 0; #5#34 = #0#52; |FINSI;
        |GRABA 140#5a;
    |FINSI;
|FINSI;
|CIERRA #5;

se_empre = #0#0;
se_ejerc = #0#4;
se_perio = #0#2;
se_tipos = 332;
se_activ = #0#1;
se_impor = #0#50;
se_fecha = #0#5;
se_factu = "";
|HAZ seguimie;

|SI #0#4 [ 80;  |O #0#4 ] 96;
    |SI #0#2 = 4;  |Y #0#3 = "T"; |HAZ Modelo390; |FINSI;
    |SI #0#2 = 12; |Y #0#3 = "M"; |HAZ Modelo390; |FINSI;
|FINSI;
|FPRC;

|PROCESO Modelo390;
|CONFI "2400NDesea hacer el pase del Resumen Anual y Consultarlo : ";
|SI FSalida ! 0; |ACABA; |FINSI;

|CIERRAT #0;
|SALVA_DATOS #0;
d_empre  = #0#0;
h_empre  = #0#0;
el_anyo  = #0#4;
VEmpresa = #0#0;
VAnyo    = #0#4;

|SUB_EJECUTA "eosp2390";
|SUB_EJECUTA "eosm3390";

|ABRET #0;
|REPON_DATOS #0;
|LIBERA #0;
|LEE 140#0=;
|FPRC;

|PROCESO funcion_9; |TIPO 0;
|SI FSalida = 9;
    |PUSHV 0501 2380;
    |ABRE #7;
    #7#0 = #0#0;
    #7#1 = #0#1;
    #7#2 = #0#2;
    #7#3 = #0#4;
    |LIBERA #7;
    |LEE 140#7=;
    FEstado = FSalida;
    |SI FSalida ! 0; |CDEFECTO #7, 1; |FINSI;
    |PINPA #0#7;
    |PINDA #0#7;
    |ENDATOS #1#7;
    |SI FSalida = 0;
        |SI FEstado = 0; |GRABA 140#7a; |SINO; |GRABA 140#7n; |FINSI;
    |FINSI;
    |CIERRA #7;
    |POPV;
|FINSI;
|FPRC;

|PROCESO nomodi; |TIPO 7;
|SI cont = 1;
   |HAZ nomodifi;
|FINSI;
|FPRC;

|PROCESO nomodifi;             || RUTINA DE CONVERSION A NO MODIFICABLES
                               || VARIABLES: A_
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FPRC;

|PROCESO PideBase;  |TIPO 0;
  |SI Tecla  = 10;
      |PUSHV 0501 2380;

      #98#0  = "ADQUISICIONES 1 ";
      #98#1  = "ADQUISICIONES 2 ";
      #98#2  = "ADQUISICIONES 3 ";
      #98#3  = "";
      #98#4  = #0#69;   #98#5  = #0#70;   #98#6  = #0#71;
      #98#7  = #0#72;   #98#8  = #0#73;   #98#9  = #0#74;
      #98#10 = #0#75;   #98#11 = #0#76;   #98#12 = #0#77;
      #98#13 = #0#78;   #98#14 = #0#79;   #98#15 = #0#80;

      |PINPA #0#98;
      |PINDA #0#98;
      |ENDATOS #1#98;
      |SI FSalida = 0;
          #0#69 = #98#4;   #0#70 = #98#5;   #0#71 = #98#6;
          #0#72 = #98#7;   #0#73 = #98#8;   #0#74 = #98#9;
          #0#75 = #98#10;  #0#76 = #98#11;  #0#77 = #98#12;
          #0#78 = #98#13;  #0#79 = #98#14;  #0#80 = #98#15;

         |CONFI "2400SLo Computamos al IVA Soportado : ";
         |SI FSalida = 0;
             #0#32 = #0#69 + #0#72 + #0#75 + #0#78;
             #0#33 = #0#71 + #0#74 + #0#77 + #0#80;
         |FINSI;
      |FINSI;
      |POPV;
  |FINSI;

  #0#25 = #0#69 + #0#72 + #0#75 + #0#78;  |PINTA #0#25;
  #0#26 = #0#71 + #0#74 + #0#77 + #0#80;  |PINTA #0#26;
|FPRC;

|PROCESO PideBaseSopor;  |TIPO 0;
     |SI Tecla ! 10;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;

     |DDEFECTO #98;
     #98#0  = "LINEA 1 ........";
     #98#1  = "LINEA 2 ........";
     #98#2  = "LINEA 3 ........";
     #98#3  = "LINEA 4 ........";

     |PINPA #0#98;
     |PINDA #0#98;
     |ENDATOS #1#98;
     nError = FSalida;
     |POPV;

     |SI nError = 0;
         |SI Campo = 28;
             #0#28 = #98#4 + #98#7 + #98#10 + #98#13;   |PINTA #0#28;
             #0#29 = #98#6 + #98#9 + #98#12 + #98#15;   |PINTA #0#29;
         |FINSI;

         |SI Campo = 30;
             #0#30 = #98#4 + #98#7 + #98#10 + #98#13;   |PINTA #0#30;
             #0#31 = #98#6 + #98#9 + #98#12 + #98#15;   |PINTA #0#31;
         |FINSI;

         |SI Campo = 32;
             #0#32 = #98#4 + #98#7 + #98#10 + #98#13;   |PINTA #0#32;
             #0#33 = #98#6 + #98#9 + #98#12 + #98#15;   |PINTA #0#33;
         |FINSI;

         |SI Campo = 81;
             #0#81 = #98#4 + #98#7 + #98#10 + #98#13;   |PINTA #0#81;
             #0#34 = #98#6 + #98#9 + #98#12 + #98#15;   |PINTA #0#34;
         |FINSI;

         |SI Campo = 36;
             #0#36 = #98#4 + #98#7 + #98#10 + #98#13;   |PINTA #0#36;
             #0#37 = #98#6 + #98#9 + #98#12 + #98#15;   |PINTA #0#37;
         |FINSI;

         |SI Campo = 38;
             #0#38 = #98#4 + #98#7 + #98#10 + #98#13;   |PINTA #0#38;
             #0#39 = #98#6 + #98#9 + #98#12 + #98#15;   |PINTA #0#39;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Imprimir; |TIPO 4;

   SwViene  = 1;
   VEmpresa = #0#0;
   VAnyo    = #0#4;
   VPeriodo = #0#2;
   VActiv   = #0#1;

   |SUB_EJECUTA "eosem332";
|FPRC;
