|FICHEROS;
     eosy0014 #0;
     eosm0040 #40;
     eosm0041 #41;
     eosm0042 #42;
     eosw0089 #89;
|FIN;

|VARIABLES;
     fFech1       = @;

     aAlfa1       = "";
     aFichero     = "";

     nDPeriodo    = 0;
     nHPeriodo    = 0;
     nLinea       = 0;
     nImporte     = 0;
     nGraba       = 0;

     &enEmpresa   = 0;
     &enEjercic   = 0;
|FIN;

|PROCESO NoMo;
     |C_M #0#4, 1, "S";
     |SI #0#3 = "E";  |C_M #0#4, 1, "N";  |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO GrabaTemporal;
     #89#0 = #42#2;
     #89#1 = " ";
     #89#2 = "  ";
     #89#3 = 0;
     #89#4 = 0;
     |SI #42#9 > 999;  #89#4 = #42#9;  |FINSI;
     #89#5 = nLinea;
     |LEE 101#89=;
     |SI FSalida ! 0;
         |DDEFECTO #89;
         #89#0 = #42#2;
         #89#1 = " ";
         #89#2 = "  ";
         #89#3 = 0;
         #89#4 = 0;
         |SI #42#9 > 999;  #89#4 = #42#9;  |FINSI;
         #89#5 = nLinea;
         #89#18 = #41#3;
         |GRABA 020#89b;
     |FINSI;

     |SI #42#9 = 1;   #89#06 = #89#06 + nImporte;  |FINSI;
     |SI #42#9 = 2;   #89#07 = #89#07 + nImporte;  |FINSI;
     |SI #42#9 = 3;   #89#08 = #89#08 + nImporte;  |FINSI;
     |SI #42#9 = 4;   #89#09 = #89#09 + nImporte;  |FINSI;
     |SI #42#9 = 5;   #89#10 = #89#10 + nImporte;  |FINSI;
     |SI #42#9 = 6;   #89#11 = #89#11 + nImporte;  |FINSI;
     |SI #42#9 = 7;   #89#12 = #89#12 + nImporte;  |FINSI;
     |SI #42#9 = 8;   #89#13 = #89#13 + nImporte;  |FINSI;
     |SI #42#9 = 9;   #89#14 = #89#14 + nImporte;  |FINSI;
     |SI #42#9 = 10;  #89#15 = #89#15 + nImporte;  |FINSI;
     |SI #42#9 = 11;  #89#16 = #89#16 + nImporte;  |FINSI;
     |SI #42#9 ] 12;  #89#17 = #89#17 + nImporte;  |FINSI;

     |GRABA 020#89a;
     |LIBERA #89;

     nGraba = 1;
|FPRC;

|PROCESO TrataApuntes;
     #41#0 = #42#0;
     #41#1 = #42#1;
     #41#2 = #42#2;
     #41#4 = #42#11;
     |LEE 040#41=;
     |SI FSalida ! 0;  |DDEFECTO #41;  |FINSI;

     |SI #0#3 = "M";
         |SI #0#4 ! #42#9;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#3 = "T";
         |SI #42#9 < nDPeriodo;  |O #42#9 > nHPeriodo;  |ACABA;  |FINSI;
     |FINSI;

     |SI #42#3 ! 0;
         nLinea   = 1;
         nImporte = #42#3;
         |HAZ GrabaTemporal;
     |FINSI;

     |SI #42#5 ! 0;
         nLinea   = 2;
         nImporte = #42#5;
         |HAZ GrabaTemporal;
     |FINSI;

     |SI #42#6 ! 0;
         nLinea   = 3;
         nImporte = #42#6;
         |HAZ GrabaTemporal;
     |FINSI;

     |SI #42#8 ! 0;
         nLinea   = 4;
         nImporte = #42#8;
         |HAZ GrabaTemporal;
     |FINSI;
|FPRC;

|DEFBUCLE eosm0042;
     #42#1;
     ;
     #40#0, #40#1, "            ", 01,    1;
     #40#0, #40#1, "zzzzzzzzzzzz", 99, 9999;
     ;
     NULL, TrataApuntes;
|FIN;

|PROCESO Imprime;
     |PRINT;
|FPRC;

|DEFBUCLE eosw0089;
     #89#1;
     ;
     "            ", " ", "  ", 0, 0000, 0;
     "zzzzzzzzzzzz", "z", "zz", 9, 9999, 9;
     ;
     NULL, Imprime;
|FIN;

|PROCESO TrataTrabajador;
     nGraba = 0;
     |ABRE #89;
     |ABRE #41;
     |BUCLE eosm0042;
     |CIERRA #41;
     |CIERRA #89;

     |SI nGraba = 1;
         |BUCLE eosw0089;
         |PIEINF;
     |FINSI;
     |DELINDEX #89;
|FPRC;

|DEFBUCLE eosm0040;
     #40#1;
     ;
     #0#0, #0#2;
     #0#1, #0#2;
     ;
     NULL, TrataTrabajador;
|FIN;

|PROCESO LeeEmpresas;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "eosy0014";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |SI #0#3 = "T";
         |SI #0#4 = 1;  nDPeriodo = 1;   nHPeriodo = 3;   |FINSI;
         |SI #0#4 = 2;  nDPeriodo = 4;   nHPeriodo = 6;   |FINSI;
         |SI #0#4 = 3;  nDPeriodo = 7;   nHPeriodo = 9;   |FINSI;
         |SI #0#4 = 4;  nDPeriodo = 10;  nHPeriodo = 12;  |FINSI;
     |FINSI;

     |BUCLE eosm0040;

     |FININF;
     |FINIMP;
|FPRC;

|PROGRAMA;
     aFichero = ("89" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #89 aFichero;
     |ABRE #89;  |CIERRA #89;  |DELINDEX #89;

     |SI enEmpresa = 0;
         |CLS;
         |CABEZA "      Comprobacion de Trabajadores";
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida = 0;  |HAZ LeeEmpresas;  |FINSI;
     |SINO;
         |PINPA #0#0;
         #0#0  = enEmpresa;
         #0#1  = enEmpresa;
         #0#2  = enEjercic;   |C_M #0#2, 1, "N";

         |PINDA #0#0;
         |PTEC 802;
         |PTEC 802;
         |ENDATOS #1#0;
         |SI FSalida = 0;  |HAZ LeeEmpresas;  |FINSI;
     |FINSI;
|FPRO;
