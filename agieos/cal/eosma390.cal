|FICHEROS;
   eosma390 #0;
   eosclien #1;
|FIN;


|VARIABLES;
 cont = 0;
 vsw = 0;
 mod = 0;
    error1 = "      La empresa no tiene emision del 390";
    anoante = 0;
    varcampo = 0;
    total = 0;
    x = 0;
    anyo = 0;
    empresa = 0;
    verrfec = "0000ATENCION !! Fecha erronea o formato incorrecto ";
    vdia1 = "";
    vme1 = "";
    vany1 = "";
    vdia = 0;
    vme = 0;
    vany = 0;
    vtope = 0;
    vsw  0;
    vfec = "";
    vblanco = "          ";
    vpuntos = "..........";
    v = 0;
|FIN;

|CALCULO cliente;|TIPO 0;
|ABRE #1;
#1#0 = #0#0;
|LEE 040#1=;
|SI FSalida ! 0;
   |MENAV "     No existe empresa.";
   |ERROR;
|FINSI;
|CIERRA #1;
|FCAL;

|CALCULO calculo1;|TIPO 0;

  #0#34 = #0#4  + #0#6  + #0#8  + #0#10 + #0#12 + #0#14 + #0#16; || Total
  #0#34 = #0#34 + #0#18 + #0#20 + #0#22 + #0#24 + #0#26 + #0#28; || B.Imponi.

  #0#35 = #0#5  + #0#7  + #0#9  + #0#11 + #0#13 + #0#15 + #0#17; || Total
  #0#35 = #0#35 + #0#19 + #0#21 + #0#23 + #0#25 + #0#27 + #0#29; || Cuotas

  #0#36 = #0#31 + #0#33; || Total recargo

  #0#42 = #0#35 + #0#36;  || Total ventas;

  |PINTA #0#34;
  |PINTA #0#35;
  |PINTA #0#36;

|FCAL;


|CALCULO calculo2;|TIPO 0;

   #0#43 = #0#37 + #0#38 + #0#39 + #0#40 + #0#41; || Total deducciones

   #0#44 = (#0#42) - (#0#43);

   #0#46 = (#0#44) - (#0#45);

   |PINTA #0#42;
   |PINTA #0#43;
   |PINTA #0#44;
   |PINTA #0#45;
   |PINTA #0#46;

|FCAL;


|CALCULO leerante;|TIPO 0;
cont = (FEntrada / 100) ! 0;
empresa = #0#0;
anyo = #0#1;
|SI cont = 1;
   #0#1 = #0#1 - 1;
   |SI #0#1 < 0;  #0#1 = 99;  |FINSI;
   |LEE 040#0=;
   |SI FSalida = 0;
       |SI empresa = #0#0;
           |SI  #0#46 < 0;
                #0#0 = empresa; #0#1 = anyo;
                anoante = #0#46;
           |FINSI;
       |FINSI;
       #0#2 = ""; #0#3 = "";
       |PARA x = 4;|SI x < 91;|HACIENDO x = x + 1;
            #0x = 0;
       |SIGUE;
       #0#45 = anoante;
   |FINSI;
   |SI #0#1 ] 99;  #0#1 = 0;  |FINSI;
|FINSI;
|FCAL;



|CALCULO fechacon; |TIPO 0;
        vfec = #0Campo; vsw = 0;
|SI vfec ! vblanco; |Y vfec ! vpuntos;
  vdia1 = vfec % A102;
  vme1 = vfec % A402;
  vany1 = vfec % A704;
  vdia = vdia1; vme = vme1; vany = vany1;
  |SI vdia ! 0; |Y vme ! 0; |Y vany > 1900;
     |SI vme [ 12; |Y vme ] 1;
       |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7; |O vme = 8; |O vme = 10; |O vme = 12;
           vtope = 31;
       |SINO;
           |SI vme = 2;
               mod = vany $ 4;
               |SI mod = 0;
                   vtope = 29;
               |SINO;
                   vtope = 28;
               |FINSI;
            |SINO;
               vtope = 30;
            |FINSI;
        |FINSI;
        |SI vdia [ vtope;
            vsw = 1;
        |FINSI;
     |FINSI;
  |FINSI;
|SINO;
  vsw = 1;
|FINSI;
|SI vsw = 0;
    |MENAV verrfec;
    |ERROR;
|FINSI;
|FCAL;
