|FICHEROS;
   eosem132 #0;
   eosactiv #1;
   eosclien #2;
   eoshacie #3;
   eoscomul #4;
   eosdaban #5;
   eosm1130 #6;
   eoscomun #7;
   eossegu4 #9;
|FIN;

|VARIABLES;
 x_empre    = 0;
 x_activ    = 0;
 empresad   = 0;
 empresah   = 0;
 swcomu     = 0;
 x          = 0;
 empresa    = 0;
 sw         = 0;
 ventas     = 0;
 rendi      = 0;
 normal     = 0;
 emp        = 0;
 act        = 0;
 cont       = 0;
 especial   = 0;
 informe    = "";
 varalfa    = "";
 xxxxfiac   = "  ";
 xxaponer   = "  ";
 xrelleno   = "                              ";

 &dia       = "";
 &mes       = "";
 &anyo      = "";
 &equis     = "";
 &comunero  = "";
 &imp1      = 0; &imp2  = 0; &imp3  = 0; &imp4  = 0; &imp5  = 0;
 &imp6      = 0; &imp7  = 0; &imp8  = 0; &imp9  = 0; &imp10 = 0;
 &imp11     = 0; &imp12 = 0; &imp13 = 0;
 &EURODB    = 0;
|FIN;

|INCLUYE i_seguim;
|INCLUYE i_cuadre;
|INCLUYE i_consul;

|PROCESO comunero1;
|ABRE #7;
#7#0 = #4#0;
#7#1 = #4#1;
#7#3 = #4#7;
|LEE 040#7=;
|SI FSalida ! 0; |DDEFECTO #7; |FINSI;
|CIERRA #7;

#6#0  = #4#0;
#6#1  = #0#4;
#6#2  = #0#2;
#6#19 = #4#1;
|LEE 110#6=;
|SI FSalida ! 0; |ACABA; |FINSI;
|SI #6#20 = "N"; |ACABA; |FINSI;
|SI #6#4  = "S"; |ACABA; |FINSI;
swcomu = 1;
|HAZ modelo1;
|FPRC;

|PROCESO comunero2;
|ABRE #7;
#7#0 = #4#0;
#7#1 = #4#1;
#7#3 = #4#7;
|LEE 040#7=;
|SI FSalida ! 0; |DDEFECTO #7; |FINSI;
|CIERRA #7;

#6#0  = #4#0;
#6#1  = #0#4;
#6#2  = #0#2;
#6#19 = #4#1;
|LEE 110#6=;
|SI FSalida ! 0; |ACABA; |FINSI;
|SI #6#20 = "N"; |ACABA; |FINSI;
|SI #6#4  = "S"; |ACABA; |FINSI;
swcomu = 1;
|HAZ modelo2;
|FPRC;

|DEFBUCLE eoscomul1;
#4#2;
;
#1#0, #1#1, #1#2;
#1#0, #1#1, #1#2;
e;
NULL, comunero1;
|FIN;

|DEFBUCLE eoscomul2;
#4#2;
;
#1#0, #1#1, #1#2;
#1#0, #1#1, #1#2;
e;
NULL, comunero2;
|FIN;

|PROCESO chequear1;
swcomu = 0;

#2#0 = #1#0;
|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

|SI #1#14 = "S";
    |BUCLE eoscomul1;
|SINO;
    #6#0  = #1#0;
    #6#1  = #0#4;
    #6#19 = #1#1;
    #6#2  = #0#2;
    |LIBERA #6;
    |LEE 110#6=;
    |SI FSalida ! 0; |ACABA; |FINSI;
    |SI #6#20 = "N"; |ACABA; |FINSI;
    |SI #6#4  = "S"; |ACABA; |FINSI;
    |HAZ modelo1;
|FINSI;
|FPRC;

|PROCESO chequear2;
swcomu = 0;

#2#0 = #1#0;
|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

empresa = #1#0;
|SI #1#14 = "S";
    |BUCLE eoscomul2;
|SINO;
    #6#0  = #1#0;
    #6#1  = #0#4;
    #6#2  = #0#2;
    #6#19 = #1#1;
    |LEE 110#6=;
    |SI FSalida ! 0; |ACABA; |FINSI;
    |SI #6#20 = "N"; |ACABA; |FINSI;
    |SI #6#4  = "S"; |ACABA; |FINSI;
    |HAZ modelo2;
|FINSI;
|FPRC;

|PROCESO modelo1;
|SI sw = 0; empresa = #1#0; sw = 1; |FINSI;
#6#3 = #0#6;
|GRABA 020#6a;
|SI empresa ! #1#0;
    |HAZ impreimp;
    |HAZ limpia;
    empresa = #1#0;
|FINSI;
|SI swcomu = 0; |HAZ importe1; |SINO; |HAZ importe2; |FINSI;
|FPRC;

|PROCESO modelo2;
#6#3 = #0#6;
|GRABA 020#6a;
|SI swcomu = 0; |HAZ importe1; |SINO; |HAZ importe2; |FINSI;
|HAZ impreimp;
|HAZ limpia;
|FPRC;

|PROCESO importe1;
comunero = "";
x_empre  = #1#0;
x_activ  = #1#1;

|HAZ recoger;

|SI #1#23 = "E";
    |SI #1#24 = 2; imp1 = imp1 + #6#7; |FINSI;
    |SI #1#24 = 1; imp1 = imp1 + #6#9; |FINSI;
    imp2 = imp2 + ventas
    imp4 = imp4 + rendi;
|FINSI;
|SI #1#23 = "P";
    imp6 = imp6 + #6#14;
    imp7 = imp7 + ventas;
    imp9 = imp9 + rendi;
|FINSI;
imp11 = imp11 + #6#16;
normal = 1;
|FPRC;

|PROCESO importe2;
emp = #1#0;
act = #1#1;

x_empre = #4#0;
x_activ = #4#1;
|HAZ recoger;

|SI #1#23 = "E";
    |SI #1#24 = 2; imp1 = imp1 + (#6#7 % #4#6); |FINSI;
    |SI #1#24 = 1; imp1 = imp1 + (#6#9 % #4#6); |FINSI;
    imp2 = imp2 + (ventas % #4#6);
    imp4 = imp4 + (rendi  % #4#6);
|FINSI;
|SI #1#23 = "P";
    imp6 = imp6 + (#6#14 % #4#6);
    imp7 = imp7 + (ventas % #4#6);
    imp9 = imp9 + (rendi % #4#6);
|FINSI;
imp11 = imp11 + (#6#16 % #4#6);

cont = cont + 1;
|SI cont = 1;
    comunero = "COMUNIDAD DE BIENES " + #7#2 + " AL " + #4#6 + " %";
|SINO;
    comunero = "VARIAS COMUNIDADES DE BIENES ";
|FINSI;
especial = 1;

#1#0 = emp;
#1#1 = act;
#1#2 = #0#2;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;
|FPRC;

|PROCESO recoger;
#1#0 = x_empre;
#1#1 = x_activ;;
#1#2 = #0#2 - 2;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;

ventas = 0;
rendi  = 0;

|SI #6#1 = 1; ventas = #1#30; |FINSI;
|SI #6#1 = 2; ventas = #1#31; |FINSI;
|SI #6#1 = 3; ventas = #1#32; |FINSI;
|SI #6#1 = 4; ventas = #1#33; |FINSI;

#1#0 = x_empre;
#1#1 = x_activ;
#1#2 = #0#2;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;

|SI #6#1 = 1; rendi = #1#35; |FINSI;
|SI #6#1 = 2; rendi = #1#36; |FINSI;
|SI #6#1 = 3; rendi = #1#37; |FINSI;
|SI #6#1 = 4; rendi = #1#38; |FINSI;
|FPRC;

|PROCESO limpia;
comunero = "";
imp1  = 0; imp2  = 0; imp3  = 0;
imp4  = 0; imp5  = 0; imp6  = 0;
imp7  = 0; imp8  = 0; imp9  = 0;
imp10 = 0; imp11 = 0; imp12 = 0;
imp13 = 0;
cont = 0;
normal = 0;
especial = 0;
|FPRC;

|PROCESO impreimp;
imp3  = (imp1 * 100) / imp2; imp3  = imp3  ! EURODB;
imp5  = imp4 % 20;           imp5  = imp5  ! EURODB;
imp8  = (imp6 * 100) / imp7; imp8  = imp8  ! EURODB;
imp10 = imp9 % 20;           imp10 = imp10 ! EURODB;
imp12 = imp5 + imp10 - imp11;
|SI imp12 < 0;
    imp13 = 0;
    equis = "X";
|SINO;
    equis = "";
    imp13 = imp12;
|FINSI;

#2#0 = empresa;
|LEE 040#2=;                             || Lee empresas
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

#3#0 = #2#18; #3#1 = #2#19;
|LEE 040#3=;                             || Lee Hacienda
|SI FSalida ! 0; |DDEFECTO #3; |FINSI;

#5#0 = empresa;
|LEE 040#5=;                             || Lee Bancos
|SI FSalida ! 0; |DDEFECTO #5; |FINSI;

|SI normal = 1; |Y especial = 1;
    comunero = "VARIAS COMUNIDADES DE BIENES";
|FINSI;

|SI normal = 1; |Y especial = 0;
    comunero = "";
|FINSI;

|PRINT;
|PIEINF;

|ABRE #9;
#9#0 = #2#0;
|LIBERA #9;
|LEE 140#9=;
|SI FSalida = 0;
    #9#1 = #9#1 + 1;
    |GRABA 140#9a;
|SINO;
    #9#0 = #2#0;
    #9#1 = 10;
    |GRABA 140#9n;
|FINSI;
|CIERRA #9;

se_empre = #2#0;
se_ejerc = #0#2;
se_perio = #0#4;
se_tipos = 132;
|SI #9#1 = 10; |BUCLE eossegui; |FINSI;

se_empre = #2#0;
se_ejerc = #0#2;
se_perio = #0#4;
se_tipos = 132;
se_activ = #9#1;
se_impor = imp12;
se_fecha = #0#6;
se_factu = "N";
|HAZ seguimie;
|FPRC;

|DEFBUCLE eosactiv1;
#1#1;
42, 46;
empresad, 0, #0#2, "N", "N";
empresah, 6, #0#2, "N", "N";
e;
NULL, chequear1;
|FIN;

|DEFBUCLE eosactiv2;
#1#1;
42, 46;
empresad, 0, #0#2, "S", "N";
empresah, 6, #0#2, "S", "N";
e;
NULL, chequear2;
|FIN;

|PROCESO impre;|TIPO 3;
|DELINDEX #9;

|IMPRE 0;
|SI FSalida ! 0; |ACABA; |FINSI;

|INFOR "eosem132";
|SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

|HAZ i_cuadre;

dia = #0#6 % 102;
mes = #0#6 % 402;
|HAZ mes;
anyo = #0#6 % 704;

empresad = #0#0;
empresah = #0#1;

|ABRE #2;
|ABRE #3;
|ABRE #6;
|ABRE #5;

|SI #0#7 = "S";
    |BUCLE eosactiv1;
|SINO;
    |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
          |SI #0x ! 0;
              empresad = #0x;
              empresah = #0x;
              |BUCLE eosactiv1;
          |FINSI;
    |SIGUE;
|FINSI;
|SI sw = 1; |HAZ impreimp; |FINSI;
|HAZ limpia;

|SI #0#7 = "S";
    |BUCLE eosactiv2;
|SINO;
    |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
          |SI #0x ! 0;
              empresad = #0x;
              empresah = #0x;
              |BUCLE eosactiv2;
          |FINSI;
    |SIGUE;
|FINSI;

|FININF;
|FINIMP;

|CIERRA #2;
|CIERRA #3;
|CIERRA #5;
|CIERRA #6;
|DELINDEX #9;
|FPRC;

|PROCESO mes;
|SI mes = "01"; mes = "Enero     "; |FINSI;
|SI mes = "02"; mes = "Febrero   "; |FINSI;
|SI mes = "03"; mes = "Marzo     "; |FINSI;
|SI mes = "04"; mes = "Abril     "; |FINSI;
|SI mes = "05"; mes = "Mayo      "; |FINSI;
|SI mes = "06"; mes = "Junio     "; |FINSI;
|SI mes = "07"; mes = "Julio     "; |FINSI;
|SI mes = "08"; mes = "Agosto    "; |FINSI;
|SI mes = "09"; mes = "Septiembre"; |FINSI;
|SI mes = "10"; mes = "Octubre   "; |FINSI;
|SI mes = "11"; mes = "Noviembre "; |FINSI;
|SI mes = "12"; mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO nomodi;|TIPO 7;
 |SI #0#7 = "N";
     |HAZ nomodifi;
 |FINSI;
|FPRC;

|PROCESO nomodi1;|TIPO 7;
 |SI #0#7 = "S";
     |HAZ nomodifi;
 |FINSI;
|FPRC;

|PROCESO nomodifi;             || rutina de conversion a no modificables
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FPRC;
