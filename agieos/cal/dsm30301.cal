|FICHEROS;
     dsm30301;
     dsm30302;
     dsm30303;
     dsm30304;
     dsm30305;

     dsmom004;
     dsmom008;
     dsmom033;
     dsmom133;

     dsmociva;
     dsmoc310;
     dsmoc311;
     eosm0017;
     eosm0018;
     eosm0019;
     eoselepi;
     eosactiv;

     dsmow205;
     dsmow224;
     dsmow227;
     dsmow206;
     dsmow207;
     dsmow208;
     dsmow209;
     dsmow210;
     dsmow212;
     dsmow213,MANTE;

     dsmow220,MANTE;
     dsmow221,MANTE;
     dsmow222,MANTE;
     dsmow223,MANTE;

     eosclien;
     eosm0009;
     dsm30301@;

     espejo@;
|FIN;

|VARIABLES;
     aEsc                = "";
     aRetu               = "";
     aTecla              = "";
     aEsc1               = "";
     aEsc2               = "";
     aAlfa               = "";
     aAlfa1              = "";
     aOrigen             = "";
     aDestino            = "";
     aDocServidor        = "";
     aDocRemoto          = "";
     aIPRemoto           = "";
     aEjecuta            = "";
     aBase               = "";
     aRutaOrigen         = "";
     aRutaDestino        = "";
     aFicheroTar         = "";
     aFicheroTxt         = "";
     aFicheroTgz         = "";
     aAbre               = "";
     aBuscar             = "";
     aRefresca           = "";
     aMas                = "";
     aGuardo8            = "";
     aGuardo9            = "";
     aGuardo12           = "";
     aGuardo13           = "";
     aGuardo14           = "";
     aGuardo15           = "";
     aFic                = "";
     aGuardo130          = "";
     aGuardo131          = "";
     aGuardo132          = "";
     aGuardo144          = "";

     nGuardo76           = 0;
     nGuardo77           = 0;
     nVentana            = 0;
     nVentTrab           = -1;
     nRango              = 0;
     nModo               = 0;
     nHandle             = 0;
     nHandleTgz          = 0;
     nLinea              = 0;
     nPanta303           = 0;
     nPanta205           = -1;
     nPanta224           = -1;
     nPanta227           = -1;
     nPanta212           = -1;
     nPanta213           = -1;
     nPanta220           = -1;
     nPanta221           = -1;
     nPanta222           = -1;
     nPanta223           = -1;
     nPintaSalir         = 0;
     nEjerAnt            = 0;
     nEjer               = 0;
     nAnyo               = 0;
     nPer                = 0;
     nPro                = 0;
     nContador           = 0;
     nLSimpl             = 0;
     nLRGral             = 0;
     nIVA1               = 0;
     nIVA2               = 0;
     nIVA3               = 0;
     nIVA4               = 0;
     nIVA5               = 0;
     nIVA6               = 0;
     nBaseMas            = 0;
     nCuotaMas           = 0;
     nCampo1             = 0;
     nCampo2             = 0;
     nCampo3             = 0;
     nCampo11            = 0;
     nCampo22            = 0;
     nCampo33            = 0;
     nDesde              = 0;
     nHasta              = 0;
     nSwAcum             = 0;
     nIVA                = 0;
     nTotal              = 0;
     nTotal303           = 0;
     nNegativo           = 0;
     nNegativoC          = 0;
     nNegativoD          = 0;
     nHComple            = 0;
     nCampo              = 0;
     nFactor             = 0;
     nNume               = 0;
     nNume1              = 0;
     nNume2              = 0;
     nNume3              = 0;
     nNume4              = 0;
     nRes                = 0;
     nBLoteria           = 0;
     nCLoteria           = 0;
     nUni1               = 0;
     nUni2               = 0;
     nUni3               = 0;
     nUni4               = 0;
     nUni5               = 0;
     nUni6               = 0;
     nUni7               = 0;
     nUni8               = 0;
     nUni9               = 0;
     nBtn8               = 0;
     nBtn9               = 0;
     nBtn12              = 0;
     nBtn13              = 0;
     nBtn131             = 0;
     nBtn132             = 0;
     nBtn14              = 0;
     nBtn15              = 0;
     nBtn151             = 0;
     nBtn152             = 0;
     nBtnVal             = 0;
     nBtnCan             = 0;
     nBtnMod213          = 0;
     nBtnMod220          = 0;
     nBtnMod221          = 0;
     nBtnAlt222          = 0;
     nBtnMod222          = 0;
     nBtnBaj222          = 0;
     nBtnMod223          = 0;

     nEstado             = 0;
     nOpera              = 0;
     nSw                 = 0;
     nOk                 = 0;
     nTree               = -1;
     nGrid02             = -1;
     nGrid03             = -1;
     nGrid04             = -1;
     nIdSalir            = -1;
     nDCampo             = 0;
     nHCampo             = 0;
     nPeriodoMin         = 0;

     {2}nNivel           = 0;

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     {-1}sTree           = 0;
         sT_nID          = 0;
         sT_nOper        = 0;
         sT_aData        = "";

     &eMensa             = 0;
     &enNoMod390         = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO UltimoPeriodo;
     nEjer = enEjer - 2000;
     |ABRE #eosactiv;
     |SELECT #4#eosactiv;
     #eosactiv#0 = enEmpresa;
     #eosactiv#1 = 1;
     #eosactiv#2 = nEjer;
     |LEE 000#eosactiv.];
     |SI FSalida ! 0;
         |DDEFECTO #eosactiv;
     |SINO;
         |SI #eosactiv#0 ! enEmpresa; |O #eosactiv#2 ! nEjer;
             |DDEFECTO #eosactiv;
         |FINSI;
     |FINSI;
     |SELECT #1#eosactiv;
     |CIERRA #eosactiv;

     |SI #eosactiv#27 = "C"; eaUltimoPer = "COMPENSAR";  |FINSI;
     |SI #eosactiv#27 = "D"; eaUltimoPer = "DEVOLVER";    |FINSI;
|FPRC;

|PROCESO RecogeAnter;
     nPeriodoMin = 1;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
     |CIERRA #dsmom004;

     |SI #dsmom004#22 = "M";
         nPeriodoMin = 1;
     |SINO;
         nPeriodoMin = 3;
     |FINSI;

     |SI enPeriodo = nPeriodoMin;
         nAnyo     = enEjer - 1;
         nPer      = 12;
     |SINO;
         nAnyo     = enEjer;
         nPer      = enPeriodo - nPeriodoMin;
     |FINSI;

     |SI nAnyo = 2013;
         |ABRE #eosactiv;
         #eosactiv#0 = enEmpresa;
         #eosactiv#1 = 1;
         #eosactiv#2 = 13;
         |LEE 000#eosactiv.=;
         |SI FSalida ! 0;  |DDEFECTO #eosactiv;  |FINSI;
         |CIERRA #eosactiv;

         nEjerAnt = #eosactiv#34;

         |ABRE #eosm0019;
         #eosm0019#0 = enEmpresa;
         #eosm0019#1 = 13;
         #eosm0019#2 = 4;
         |LEE 040#eosm0019.=;
         |SI FSalida = 0;
             nEjerAnt = nEjerAnt + #eosm0019#41;
         |FINSI;
         |CIERRA #eosm0019;

         |ACABA;
     |FINSI;

     |DDEFECTO #dsm30301;
     #dsm30301#0 = enEmpresa;
     #dsm30301#1 = nAnyo;
     #dsm30301#2 = nPer;
     #dsm30301#3 = enModelo;
     #dsm30301#4 = enComplem;
     #dsm30301#5 = 0;
     |LEE 001#dsm30301.=;
     |SI FSalida = 0;
         nEjerAnt = #dsm30301#89;
     |FINSI;
|FPRC;

|PROCESO AcumPorIVA;
     |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
           nCampo11 = nCampo33 - 2;
           nCampo22 = nCampo33 - 1;
           |SI #dsm30301#nCampo22# = nIVA;
               #dsm30301#nCampo11# = #dsm30301#nCampo11# + #dsmociva#nCampo1#;
               #dsm30301#nCampo33# = #dsm30301#nCampo33# + #dsmociva#nCampo3#;
               nSwAcum = 1;

               |SI nIVA ! #dsmociva#nCampo2#;
                   |SI nCampo22 = 17;  nIVA1  = 1;  |FINSI;
                   |SI nCampo22 = 20;  nIVA2  = 1;  |FINSI;
                   |SI nCampo22 = 23;  nIVA3  = 1;  |FINSI;
                   |SI nCampo22 = 32;  nIVA4  = 1;  |FINSI;
                   |SI nCampo22 = 35;  nIVA5  = 1;  |FINSI;
                   |SI nCampo22 = 38;  nIVA6  = 1;  |FINSI;
               |FINSI;
               |SAL;
            |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo33 = nDesde;  |SI nCampo33 [ nHasta;  |HACIENDO nCampo33 = nCampo33 + 3;
               nCampo11 = nCampo33 - 2;
               nCampo22 = nCampo33 - 1;
               |SI #dsm30301#nCampo22# = 0;
                   #dsm30301#nCampo11# = #dsmociva#nCampo1#;
                   #dsm30301#nCampo22# = nIVA;
                   #dsm30301#nCampo33# = #dsmociva#nCampo3#;
                   nSwAcum = 1;

                   |SI nIVA ! #dsmociva#nCampo2#;
                       |SI nCampo22 = 17;  nIVA1  = 1;  |FINSI;
                       |SI nCampo22 = 20;  nIVA2  = 1;  |FINSI;
                       |SI nCampo22 = 23;  nIVA3  = 1;  |FINSI;
                       |SI nCampo22 = 32;  nIVA4  = 1;  |FINSI;
                       |SI nCampo22 = 35;  nIVA5  = 1;  |FINSI;
                       |SI nCampo22 = 38;  nIVA6  = 1;  |FINSI;
                   |FINSI;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         nCampo11     = nHasta - 2;
         nCampo22     = nHasta - 1;
         nCampo33     = nHasta;

         #dsm30301#nCampo11# = #dsm30301#nCampo11# + #dsmociva#nCampo1#;
         #dsm30301#nCampo22# = -1;
         #dsm30301#nCampo33# = #dsm30301#nCampo33# + #dsmociva#nCampo3#;
     |FINSI;
|FPRC;

|PROCESO GrabaDevengado;
     |SI #dsmociva#nCampo3# = 0;  |ACABA;  |FINSI;
     nSwAcum       = 0;

     nIVA     = #dsmociva#nCampo2#;

     |SI nIVA = 18; |O nIVA = 16; nIVA = 21;  |FINSI;
     |SI nIVA = 8;  |O nIVA = 7;  nIVA = 10;  |FINSI;

     |SI nDesde = 33;
         |SI nIVA = 4; nIVA = 5.20;  |FINSI;
         |SI nIVA = 1; nIVA = 1.40;  |FINSI;
     |FINSI;

     |SI nDesde ! nHasta;
         |HAZ AcumPorIVA;
     |SINO;
         nCampo11 = nHasta - 1;
         nCampo33 = nHasta;

         #dsm30301#nCampo11# = #dsm30301#nCampo11# + #dsmociva#nCampo1#;
         #dsm30301#nCampo33# = #dsm30301#nCampo33# + #dsmociva#nCampo3#;
     |FINSI;
|FPRC;

|PROCESO GrabaDeducible;
     |SI nHasta ! -1;
         nHasta = nDesde + 1;
         #dsm30301#nDesde# = #dsm30301#nDesde# + (#dsmociva#14 + #dsmociva#17 + #dsmociva#20 + #dsmociva#23 + #dsmociva#26 + #dsmociva#29 + #dsmociva#32);
         #dsm30301#nHasta# = #dsm30301#nHasta# + (#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34);
     |SINO;
         #dsm30301#nDesde# = #dsm30301#nDesde# + ((#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34) % nProrrata) + nCuotaMas;
     |FINSI;
|FPRC;

|PROCESO GrabaParte1;
     nLRGral      = nLRGral + 1;
     enExistencia = 1;
     nDesde       = 0;
     nHasta       = 0;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 [ 4;   nDesde = 18;  nHasta = 24;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 14;  nDesde = 18;  nHasta = 24;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 16;  nDesde = 18;  nHasta = 24;  |FINSI;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 5;   nDesde = 26;  nHasta = 26;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 15;  nDesde = 26;  nHasta = 26;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 6;   nDesde = 28;  nHasta = 28;  |FINSI;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 7;   nDesde = 30;  nHasta = 30;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 8;   nDesde = 30;  nHasta = 30;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 17;  nDesde = 30;  nHasta = 30;  |FINSI;

     |SI enEjer ] 2015;
         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 18;  nDesde = 30;  nHasta = 30;  |FINSI;
         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 19;  nDesde = 30;  nHasta = 30;  |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 10;  nDesde = 33;  nHasta = 39;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 11;  nDesde = 41;  nHasta = 41;  |FINSI;
     |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 12;  nDesde = 41;  nHasta = 41;  |FINSI;

     |SI enEjer ] 2015;
         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 20;  nDesde = 41;  nHasta = 41;  |FINSI;
     |FINSI;

     |SI nDesde ! 0;
         |PARA nCampo1 = 14;  |SI nCampo1 [ 32;  |HACIENDO nCampo1 = nCampo1 + 3;
               nCampo2 = nCampo1 + 1;
               nCampo3 = nCampo1 + 2;
               |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                   |HAZ GrabaDevengado;
               |FINSI;
         |SIGUE;

         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 15;
             |PARA nCampo1 = 35;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                       |HAZ GrabaDevengado;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #dsmociva#6 = 1;  |Y #dsmociva#7 = 6;
             |PARA nCampo1 = 35;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                       |HAZ GrabaDevengado;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 17;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #dsm30301#nCampo1# = -1;  #dsm30301#nCampo1# = 0;  |FINSI;
     |SIGUE;

     |PARA nCampo1 = 32;  |SI nCampo1 [ 38;  |HACIENDO nCampo1 = nCampo1 + 3;
           |SI #dsm30301#nCampo1# = -1;  #dsm30301#nCampo1# = 0;  |FINSI;
     |SIGUE;

     nDesde = 0;
     nHasta = 0;

     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 1;   nDesde = 43;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 2;   nDesde = 45;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 14;  nDesde = 43;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 15;  nDesde = 45;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 3;   nDesde = 47;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 4;   nDesde = 49;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 5;   nDesde = 51;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 6;   nDesde = 53;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 13;  nDesde = 51;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 7;   nDesde = 57;  nHasta = -1;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 8;   nDesde = 55;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 16;  nDesde = 55;  |FINSI;
     |SI enEjer ] 2015;
        |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 17;  nDesde = 55;  |FINSI;
     |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 9;   nDesde = 58;  nHasta = -1;  |FINSI;
     |SI #dsmociva#6 = 2;  |Y #dsmociva#7 = 10;  nDesde = 59;  nHasta = -1;  |FINSI;

     |SI nDesde ! 0;
         |HAZ GrabaDeducible;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 9;
         #dsm30301#74 = #dsm30301#74 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 16;
         #dsm30301#74 = #dsm30301#74 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 10;
         #dsm30301#75 = #dsm30301#75 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 4;
         #dsm30301#76 = #dsm30301#76 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 5;  |Y #dsmociva#7 = 1;
         #dsm30301#82 = #dsm30301#82 + #dsmociva#12;
         nContador = nContador + 1;
     |FINSI;

     |SI #dsmociva#6 = 5;  |Y #dsmociva#7 = 2;
         #dsm30301#85 = #dsm30301#85 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 4;  |Y #dsmociva#7 = 17;
         #dsm30301#77 = #dsm30301#77 + #dsmociva#12;
         #dsm30301#78 = #dsm30301#78 + #dsmociva#13;
     |FINSI;

     |SI #dsmociva#6 = 4;  |Y #dsmociva#7 = 18;
         #dsm30301#79 = #dsm30301#79 + #dsmociva#12;
         #dsm30301#80 = #dsm30301#80 + #dsmociva#13;
     |FINSI;
|FPRC;

|PROCESO dsmociva;
     enImpIvaSop = 0;
     enImpIvaSub = 0;
     enIvaSopDed = 0;
     nBaseMas    = 0;
     nCuotaMas   = 0;

     |SI #dsmociva#6 = 2;
         |SI #dsmociva#7 ! 5; |Y #dsmociva#7 ! 6;
             |SI #dsmociva#7 ! 10; |Y #dsmociva#7 ! 11; |Y #dsmociva#7 ! 12;
                 enIvaSopDed = (#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34) % nProrrata + nCuotaMas;
             |FINSI;
         |FINSI;

         |SI #dsmociva#7 = 10;
             enImpIvaSop = #dsmociva#13 + nCuotaMas;
         |FINSI;

         |SI #dsmociva#7 = 11;
             enImpIvaSub = #dsmociva#13;
             enIvaSopDed = - (#dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34);
         |FINSI;

         |SI #dsmociva#7 = 12; |ACABA; |FINSI;
     |FINSI;

     |SI #dsmociva#12 = 0;  |Y #dsmociva#13 = 0;  |ACABA;  |FINSI;

     |SI #dsmociva#6 = 5;  |Y #dsmociva#7 = 6;
         nEjerAnt = #dsmociva#12;
     |FINSI;

     |HAZ GrabaParte1;

     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva;
     #dsmociva#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01, 0,  0;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99, 9, 99;
     be;
     NULL, dsmociva;
|FIN;

|PROCESO dsmocivaOper;
     #espejo@#0 = #dsmociva#0;
     #espejo@#1 = #dsmociva#1;
     #espejo@#2 = #dsmociva#2;
     #espejo@#3 = #dsmociva#3;
     #espejo@#4 = #dsmociva#4 + 1;
     #espejo@#5 = #dsmociva#5;
     #espejo@#6 = #dsmociva#6;
     #espejo@#7 = #dsmociva#7;
     |LEE 041#espejo@.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 1;
         #dsm30301#121 = #dsm30301#121 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 17;
         #dsm30301#122 = #dsm30301#122 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 9;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12;  || antes 2017
         #dsm30301#137 = #dsm30301#137 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 16;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12;  || antes
         #dsm30301#137 = #dsm30301#137 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 10;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12; ||antes 2017
         #dsm30301#138 = #dsm30301#138 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 11;
         #dsm30301#123 = #dsm30301#123 + #dsmociva#12; ||antes 2017
         #dsm30301#138 = #dsm30301#138 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 12;
         #dsm30301#124 = #dsm30301#124 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 4;
         #dsm30301#125 = #dsm30301#125 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 7;
         #dsm30301#126 = #dsm30301#126 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 2;
         #dsm30301#127 = #dsm30301#127 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 3;
         #dsm30301#139 = #dsm30301#139 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 8;
         #dsm30301#140 = #dsm30301#140 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 5;
         #dsm30301#141 = #dsm30301#141 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 6;
         #dsm30301#142 = #dsm30301#142 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 13;
         #dsm30301#128 = #dsm30301#128 + #dsmociva#12;
     |FINSI;

     |SI #dsmociva#6 = 3;  |Y #dsmociva#7 = 14;
         |SI #dsm30301#1 ] 2017;
             #dsm30301#143 = #dsm30301#143 + #dsmociva#12;
         |SINO;
             #dsm30301#128 = #dsm30301#128 + #dsmociva#12;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmocivaOper;
     #dsmociva#1;
     ;
     enEmpresa, enEjer, 01, enModelo, 00, 01, 3,  0;
     enEmpresa, enEjer, 12, enModelo, 99, 99, 4, 99;
     ;
     NULL, dsmocivaOper;
|FIN;

|PROCESO CargaProvisional;
     nUni1   = #eosm0017#18;
     nTotal  = #eosm0017#17 * #eosm0017#18;
     |SI nTotal ! #eosm0017#19;  nUni1 = #eosm0017#19 / #eosm0017#17;  |FINSI;

     nUni2   = #eosm0017#29;
     nTotal  = #eosm0017#28 * #eosm0017#29;
     |SI nTotal ! #eosm0017#30;  nUni2 = #eosm0017#30 / #eosm0017#28;  |FINSI;

     nUni3   = #eosm0017#40;
     nTotal  = #eosm0017#39 * #eosm0017#40;
     |SI nTotal ! #eosm0017#41;  nUni3 = #eosm0017#41 / #eosm0017#39;  |FINSI;

     nUni4   = #eosm0017#51;
     nTotal  = #eosm0017#50 * #eosm0017#51;
     |SI nTotal ! #eosm0017#52;  nUni4 = #eosm0017#52 / #eosm0017#50;  |FINSI;

     nUni5   = #eosm0017#62;
     nTotal  = #eosm0017#61 * #eosm0017#62;
     |SI nTotal ! #eosm0017#63;  nUni5 = #eosm0017#63 / #eosm0017#61;  |FINSI;

     nUni6   = #eosm0017#73;
     nTotal  = #eosm0017#72 * #eosm0017#73;
     |SI nTotal ! #eosm0017#74;  nUni6 = #eosm0017#74 / #eosm0017#72;  |FINSI;

     nUni7   = #eosm0017#84;
     nTotal  = #eosm0017#83 * #eosm0017#84;
     |SI nTotal ! #eosm0017#85;  nUni7 = #eosm0017#85 / #eosm0017#83;  |FINSI;

     nUni8   = #eosm0017#95;
     nTotal  = #eosm0017#94 * #eosm0017#95;
     |SI nTotal ! #eosm0017#96;  nUni8 = #eosm0017#96 / #eosm0017#94;  |FINSI;

     nUni9   = #eosm0017#106;
     nTotal  = #eosm0017#105 * #eosm0017#106;
     |SI nTotal ! #eosm0017#107;  nUni9 = #eosm0017#107 / #eosm0017#105;  |FINSI;

     nBLoteria = 0; nCLoteria = 0;
     |SI #dsmoc310#2 = 3; nBLoteria = #eosm0018#117; nCLoteria = #eosm0018#118; |FINSI;
     |SI #dsmoc310#2 = 6; nBLoteria = #eosm0018#119; nCLoteria = #eosm0018#120; |FINSI;
     |SI #dsmoc310#2 = 9; nBLoteria = #eosm0018#121; nCLoteria = #eosm0018#122; |FINSI;
     |SI nCLoteria ! 0;
         |PARA nCampo = 17;  |SI nCampo [ 100;  |HACIENDO nCampo = nCampo + 11;
               |SI #eosm0017#nCampo# = 0;
                   |SI nCampo = 17;  nUni1 = nBLoteria;  #eosm0017#19 = nCLoteria;  |FINSI;
                   |SI nCampo = 28;  nUni2 = nBLoteria;  #eosm0017#30 = nCLoteria;  |FINSI;
                   |SI nCampo = 39;  nUni3 = nBLoteria;  #eosm0017#41 = nCLoteria;  |FINSI;
                   |SI nCampo = 50;  nUni4 = nBLoteria;  #eosm0017#52 = nCLoteria;  |FINSI;
                   |SI nCampo = 61;  nUni5 = nBLoteria;  #eosm0017#63 = nCLoteria;  |FINSI;
                   |SI nCampo = 72;  nUni6 = nBLoteria;  #eosm0017#74 = nCLoteria;  |FINSI;
                   |SI nCampo = 83;  nUni7 = nBLoteria;  #eosm0017#85 = nCLoteria;  |FINSI;
                   |SI nCampo = 94;  nUni8 = nBLoteria;  #eosm0017#96 = nCLoteria;  |FINSI;

                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #eoselepi#nCampo#;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #dsmoc310#6 = "6441"; |O #dsmoc310#6 = "6442";
      |O #dsmoc310#6 = "6443"; |O #dsmoc310#6 = "6446";
         #dsm30303#8  = nUni1 + nUni2 + nUni3;
         #dsm30303#15 = #eosm0017#19 + #eosm0017#30 + #eosm0017#41;

         #dsm30303#9  = nUni4 + nUni5 + nUni6;
         #dsm30303#16 = #eosm0017#52 + #eosm0017#63 + #eosm0017#74;

         #dsm30303#10 = nUni7;
         #dsm30303#17 = #eosm0017#85;

         #dsm30303#11 = nUni8;
         #dsm30303#18 = #eosm0017#96;

         #dsm30303#12 = nUni9;
         #dsm30303#19 = #eosm0017#107;
     |SINO;
         #dsm30303#8  = nUni1 + nUni2;
         #dsm30303#15 = #eosm0017#19 + #eosm0017#30;

         #dsm30303#9  = nUni3;
         #dsm30303#16 = #eosm0017#41;

         #dsm30303#10 = nUni4;
         #dsm30303#17 = #eosm0017#52;

         #dsm30303#11 = nUni5;
         #dsm30303#18 = #eosm0017#63;

         #dsm30303#12 = nUni6;
         #dsm30303#19 = #eosm0017#74;

         #dsm30303#13 = nUni7;
         #dsm30303#20 = #eosm0017#85;

         #dsm30303#14 = nUni8;
         #dsm30303#21 = #eosm0017#96;
     |FINSI;

     #dsm30303#22 = #dsm30303#15 + #dsm30303#16 + #dsm30303#17 + #dsm30303#18;
     #dsm30303#22 = #dsm30303#22 + #dsm30303#19 + #dsm30303#20 + #dsm30303#21;
     #dsm30303#23 = #eosm0018#149;
     #dsm30303#24 = #eosm0018#63;
     #dsm30303#25 = #eosm0017#122;

     |SI #dsmoc310#2 = 3;   #dsm30303#26 = #eosm0017#124;  |FINSI;
     |SI #dsmoc310#2 = 6;   #dsm30303#26 = #eosm0017#125;  |FINSI;
     |SI #dsmoc310#2 = 9;   #dsm30303#26 = #eosm0017#126;  |FINSI;

     #dsm30301#62 = #dsm30301#62 + #dsm30303#26;
|FPRC;

|PROCESO CargaDefinitivo;
     nUni1   = #eosm0017#20;
     nTotal  = #eosm0017#17 * #eosm0017#20;
     |SI nTotal ! #eosm0017#21;  nUni1 = #eosm0017#21 / #eosm0017#17;  |FINSI;

     nUni2   = #eosm0017#31;
     nTotal  = #eosm0017#28 * #eosm0017#31;
     |SI nTotal ! #eosm0017#32;  nUni2 = #eosm0017#32 / #eosm0017#28;  |FINSI;

     nUni3   = #eosm0017#42;
     nTotal  = #eosm0017#39 * #eosm0017#42;
     |SI nTotal ! #eosm0017#43;  nUni3 = #eosm0017#43 / #eosm0017#39;  |FINSI;

     nUni4   = #eosm0017#53;
     nTotal  = #eosm0017#50 * #eosm0017#53;
     |SI nTotal ! #eosm0017#54;  nUni4 = #eosm0017#54 / #eosm0017#50;  |FINSI;

     nUni5   = #eosm0017#64;
     nTotal  = #eosm0017#61 * #eosm0017#64;
     |SI nTotal ! #eosm0017#65;  nUni5 = #eosm0017#65 / #eosm0017#61;  |FINSI;

     nUni6   = #eosm0017#75;
     nTotal  = #eosm0017#72 * #eosm0017#75;
     |SI nTotal ! #eosm0017#76;  nUni6 = #eosm0017#76 / #eosm0017#72;  |FINSI;

     nUni7   = #eosm0017#86;
     nTotal  = #eosm0017#83 * #eosm0017#86;
     |SI nTotal ! #eosm0017#87;  nUni7 = #eosm0017#87 / #eosm0017#83;  |FINSI;

     nUni8   = #eosm0017#97;
     nTotal  = #eosm0017#94 * #eosm0017#97;
     |SI nTotal ! #eosm0017#98;  nUni8 = #eosm0017#98 / #eosm0017#94;  |FINSI;

     nUni9   = #eosm0017#108;
     nTotal  = #eosm0017#105 * #eosm0017#108;
     |SI nTotal ! #eosm0017#109;  nUni9 = #eosm0017#109 / #eosm0017#105;  |FINSI;

     nBLoteria = #eosm0018#117 + #eosm0018#119 + #eosm0018#121 + #eosm0018#123;
     nCLoteria = #eosm0018#118 + #eosm0018#120 + #eosm0018#122 + #eosm0018#124;
     |SI nCLoteria ! 0;
         |PARA nCampo = 17;  |SI nCampo [ 100;  |HACIENDO nCampo = nCampo + 11;
               |SI #eosm0017#nCampo# = 0;
                   |SI nCampo = 17;  nUni1 = nBLoteria; #eosm0017#20 = nBLoteria;  #eosm0017#21 = nCLoteria;  |FINSI;
                   |SI nCampo = 28;  nUni2 = nBLoteria; #eosm0017#31 = nBLoteria;  #eosm0017#32 = nCLoteria;  |FINSI;
                   |SI nCampo = 39;  nUni3 = nBLoteria; #eosm0017#42 = nBLoteria;  #eosm0017#43 = nCLoteria;  |FINSI;
                   |SI nCampo = 50;  nUni4 = nBLoteria; #eosm0017#53 = nBLoteria;  #eosm0017#54 = nCLoteria;  |FINSI;
                   |SI nCampo = 61;  nUni5 = nBLoteria; #eosm0017#64 = nBLoteria;  #eosm0017#65 = nCLoteria;  |FINSI;
                   |SI nCampo = 72;  nUni6 = nBLoteria; #eosm0017#75 = nBLoteria;  #eosm0017#76 = nCLoteria;  |FINSI;
                   |SI nCampo = 83;  nUni7 = nBLoteria; #eosm0017#86 = nBLoteria;  #eosm0017#87 = nCLoteria;  |FINSI;
                   |SI nCampo = 94;  nUni8 = nBLoteria; #eosm0017#97 = nBLoteria;  #eosm0017#98 = nCLoteria;  |FINSI;

                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #eoselepi#nCampo#;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #dsmoc310#6 = "6441"; |O #dsmoc310#6 = "6442";
      |O #dsmoc310#6 = "6443"; |O #dsmoc310#6 = "6446";
         #dsm30303#8  = nUni1 + nUni2 + nUni3;
         #dsm30303#15 = #eosm0017#21 + #eosm0017#32 + #eosm0017#43;

         #dsm30303#9  = nUni4 + nUni5 + nUni6;
         #dsm30303#16 = #eosm0017#54 + #eosm0017#65 + #eosm0017#76;

         #dsm30303#10 = nUni7;
         #dsm30303#17 = #eosm0017#87;

         #dsm30303#11 = nUni8;
         #dsm30303#18 = #eosm0017#98;

         #dsm30303#12 = nUni9;
         #dsm30303#19 = #eosm0017#109;
     |SINO;
         #dsm30303#8  = nUni1 + nUni2;
         #dsm30303#15 = #eosm0017#21 + #eosm0017#32

         #dsm30303#9  = nUni3;
         #dsm30303#16 = #eosm0017#43;

         #dsm30303#10 = nUni4;
         #dsm30303#17 = #eosm0017#54;

         #dsm30303#11 = nUni5;
         #dsm30303#18 = #eosm0017#65;

         #dsm30303#12 = nUni6;
         #dsm30303#19 = #eosm0017#76;

         #dsm30303#13 = nUni7;
         #dsm30303#20 = #eosm0017#87;

         #dsm30303#14 = nUni8;
         #dsm30303#21 = #eosm0017#98;
     |FINSI;

     #dsm30303#22 = #dsm30303#15 + #dsm30303#16 + #dsm30303#17 + #dsm30303#18;
     #dsm30303#22 = #dsm30303#22 + #dsm30303#19 + #dsm30303#20 + #dsm30303#21;

     #dsm30303#23 = #eosm0018#151;
     #dsm30303#27 = #eosm0018#115 + (#eosm0017#113 % 1);
     #dsm30303#28 = #eosm0018#66;

     |SI #dsm30303#28 = 0;
         #dsm30303#28 = 1;
     |FINSI;

     #dsm30303#29 = (#dsm30303#22 - #dsm30303#23 - #dsm30303#27) * #dsm30303#28;

     #dsm30303#30 = 0;
     |SI #dsm30303#8  ! 0;  |O #dsm30303#9  ! 0;  |O #dsm30303#10 ! 0;
     |O  #dsm30303#11 ! 0;  |O #dsm30303#12 ! 0;  |O #dsm30303#13 ! 0;
     |O  #dsm30303#14 ! 0;
         #dsm30303#30 = #eosm0017#123;
     |FINSI;

     #dsm30303#31 = #eosm0018#158;
     #dsm30303#32 = (((#eosm0017#113) % #dsm30303#30) + #dsm30303#31) * #dsm30303#28;
     #dsm30303#33 = #dsm30303#29;

     |SI #dsm30303#33 < #dsm30303#32;
         #dsm30303#33 = #dsm30303#32;
     |FINSI;

     |SI #dsm30303#33 = 0; |Y #eosm0017#127 ! 0;
         #dsm30303#33 = #eosm0017#127;
     |FINSI;


     #dsm30301#63 = #dsm30301#63 + #dsm30303#33;
|FPRC;

|PROCESO GrabaModulo;
     #dsm30303#0 = #dsm30301#0;
     #dsm30303#1 = #dsm30301#1;
     #dsm30303#2 = #dsm30301#2;
     #dsm30303#3 = #dsm30301#3;
     #dsm30303#4 = #dsm30301#4;
     #dsm30303#5 = #dsmoc310#5;
     |LEE 001#dsm30303.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm30303;
         #dsm30303#0 = #dsm30301#0;
         #dsm30303#1 = #dsm30301#1;
         #dsm30303#2 = #dsm30301#2;
         #dsm30303#3 = #dsm30301#3;
         #dsm30303#4 = #dsm30301#4;
         #dsm30303#5 = #dsmoc310#5;
         #dsm30303#6 = #dsmoc310#6;
         #dsm30303#7 = #dsmoc310#7;
         |GRABA 020#dsm30303.b;
     |FINSI;

     |ABRE #eosm0017;
     #eosm0017#0 = #dsmoc310#0;
     #eosm0017#5 = #dsmoc310#1 - 2000;
     #eosm0017#1 = #dsmoc310#5;
     |LEE 040#eosm0017.=;
     |SI FSalida ! 0;  |DDEFECTO #eosm0017;  |FINSI;
     |CIERRA #eosm0017;

     |ABRE #eosm0018;
     #eosm0018#0 = #dsmoc310#0;
     #eosm0018#2 = #dsmoc310#1 - 2000;
     #eosm0018#1 = #dsmoc310#5;
     |LEE 040#eosm0018.=;
     |SI FSalida ! 0;  |DDEFECTO #eosm0018;  |FINSI;
     |CIERRA #eosm0018;

     |ABRE #eoselepi;
     #eoselepi#0  = #eosm0017#2;
     #eoselepi#1  = #eosm0017#3;
     #eoselepi#41 = #eosm0017#4;
     #eoselepi#2  = enEjer;
     |LEE 040#eoselepi.=;
     |SI FSalida ! 0; |DDEFECTO #eoselepi;  |FINSI;
     |CIERRA #eoselepi;

     |SI #dsmoc310#2 ! 12;  |HAZ CargaProvisional;  |FINSI;
     |SI #dsmoc310#2 = 12;  |HAZ CargaDefinitivo;   |FINSI;

     |GRABA 020#dsm30303.a;
     |LIBERA #dsm30303;
|FPRC;

|PROCESO dsmoc311;
     #dsmom133#0 = #dsmoc311#6;
     #dsmom133#1 = #dsmoc311#1;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom033#0 = #dsmoc311#6;
     |LEE 000#dsmom033.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsm30302#0 = #dsm30301#0;
     #dsm30302#1 = #dsm30301#1;
     #dsm30302#2 = #dsm30301#2;
     #dsm30302#3 = #dsm30301#3;
     #dsm30302#4 = #dsm30301#4;
     #dsm30302#5 = #dsm30301#5;
     #dsm30302#6 = #dsmom133#2;
     |LEE 001#dsm30302.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm30302;
         #dsm30302#0 = #dsm30301#0;
         #dsm30302#1 = #dsm30301#1;
         #dsm30302#2 = #dsm30301#2;
         #dsm30302#3 = #dsm30301#3;
         #dsm30302#4 = #dsm30301#4;
         #dsm30302#5 = #dsm30301#5;
         #dsm30302#6 = #dsmom133#2;
         #dsm30302#7 = #dsmom033#2;
         |GRABA 020#dsm30302.b;
     |FINSI;

     #dsm30302#8  = #dsm30302#8 + #dsmoc311#8;
     #dsm30302#9  = #dsmoc311#9;
     #dsm30302#10 = #dsm30302#8 * #dsm30302#9;

     |SI #dsmoc311#2 ! 12;
         #dsm30302#11 = #dsmoc311#10;
         #dsm30302#12 = #dsm30302#12 + #dsmoc311#12;

         #dsm30301#62 = #dsm30301#62 + #dsmoc311#12;
     |FINSI;

     |SI #dsmoc311#2 = 12;
         #dsm30302#13 = #dsm30302#13 + (#dsmoc311#11 + ((#dsmoc311#8 * #dsmoc311#9) % 1));
         #dsm30302#14 = #dsm30302#14 + #dsmoc311#12;

         #dsm30301#63 = #dsm30301#63 + #dsmoc311#12;
     |FINSI;

     |GRABA 020#dsm30302.a;
     |LIBERA #dsm30302;
|FPRC;

|DEFBUCLE dsmoc311;
     #dsmoc311#1;
     ;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 001;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 999;
     ;
     NULL, dsmoc311;
|FIN;

|PROCESO GrabaAgricola;
     |ABRE #dsmom033;
     |ABRE #dsmom133;
     |BUCLE dsmoc311;
     |CIERRA #dsmom033;
     |CIERRA #dsmom133;
|FPRC;

|PROCESO dsmoc310;
     #dsmom008#0 = #dsmoc310#0;
     #dsmom008#1 = #dsmoc310#1;
     #dsmom008#2 = #dsmoc310#2;
     #dsmom008#3 = #dsmoc310#3;
     #dsmom008#4 = #dsmoc310#4;
     #dsmom008#5 = #dsmoc310#5;
     |LEE 041#dsmom008.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     enExistencia = 1;
     nLSimpl      = nLSimpl + 1;

     |SI #dsmoc310#8 = "N";
         |HAZ GrabaModulo;
     |FINSI;

     |SI #dsmoc310#8 = "S";
         |HAZ GrabaAgricola;
     |FINSI;

     #dsm30301#66 = #dsm30301#66 + #dsmoc310#10;
     #dsm30301#67 = #dsm30301#67 + #dsmoc310#11;
     #dsm30301#68 = #dsm30301#68 + #dsmoc310#12;

     #dsm30301#70 = #dsm30301#70 + #dsmoc310#13;
     #dsm30301#71 = #dsm30301#71 + #dsmoc310#14;

     #dsm30301#74 = #dsm30301#74 + #dsmoc310#15 + #dsmoc310#18;

     |SI #dsmoc310#16 ! 0;
         nEjerAnt = #dsmoc310#16;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc310;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99;
     be;
     NULL, dsmoc310;
|FIN;

|PROCESO dsmoc310Oper;
     #espejo@#0 = #dsmoc310#0;
     #espejo@#1 = #dsmoc310#1;
     #espejo@#2 = #dsmoc310#2;
     #espejo@#3 = #dsmoc310#3;
     #espejo@#4 = #dsmoc310#4 + 1;
     #espejo@#5 = #dsmoc310#5;
     |LEE 041#espejo@.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     #dsm30301#127 = #dsm30301#127 + #dsmoc310#19;
|FPRC;

|DEFBUCLE dsmoc310Oper;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, 01, enModelo, enComplem, 01;
     enEmpresa, enEjer, 12, enModelo, enComplem, 99;
     be;
     NULL, dsmoc310Oper;
|FIN;

|PROCESO dsm30301Otros;
     #dsm30301#87  = #dsm30301#87 + #dsm30301@#91;
     nTotal303     = #dsm30301@#88;

     nNegativoC    = nNegativoC + #dsm30301@#89;
     nNegativoD    = nNegativoD + #dsm30301@#90;
|FPRC;

|DEFBUCLE dsm30301Otros;
     #dsm30301@#1006;
     ;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3,        0, #dsm30301#5;
     #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, nHComple, #dsm30301#5;
     ;
     NULL, dsm30301Otros;
|FIN;

|PROCESO CapturaOtros303;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsm30301.mas";
     |CARGA_DEF aMas, dsm30301@;

     nHComple     = #dsm30301#4 - 1;
     #dsm30301#88 = 0;
     nTotal303    = 0;
     nNegativoD   = 0;
     nNegativoC   = 0;

     |BUCLE dsm30301Otros;

     |SI nNegativoC ! 0;  |O nNegativoD ! 0;
         nNegativo  = (nNegativoC + nNegativoD) * -1;

         |SI nNegativoC ! 0;
             |SI eMensa = 0;
                 |MENAV "0000Declaraciones anteriores a compensar. ";
                 |CONFI "0000NHa compensado el importe en una declaracion posterior";
             |SINO;
                 FSalida = -1;
             |FINSI;
         |SINO;
             |SI eMensa = 0;
                 |MENAV "0000Declaraciones anteriores a devolver.";
                 |CONFI "0000NHa recibido la devolucion";
             |SINO;
                  FSalida = -1;
             |FINSI;
         |FINSI;

         |SI FSalida = 0;
            #dsm30301#87 = #dsm30301#87 + nNegativo;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #dsm30301@;
|FPRC;

|PROCESO IngreRealizados;
     #dsmom004#0 = #dsmoc310#0;
     #dsmom004#1 = #dsmoc310#1;
     #dsmom004#2 = #dsmoc310#2;
     #dsmom004#3 = #dsmoc310#3;
     #dsmom004#4 = #dsmoc310#4;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsm30301#64 = #dsm30301#64 + #dsmoc310#9;

     |SI enNoMod390 = 1;
         #dsm30301#127 = #dsm30301#127 + #dsmoc310#19;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc310R;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, 3, 000, enComplem, 01;
     enEmpresa, enEjer, 9, 999, enComplem, 99;
     ;
     NULL, IngreRealizados;
|FIN;

|PROCESO Totales;

     |SI #dsm30301#95 < 0; #dsm30301#95 = 0; |FINSI; || Tique 700000 _ 9582

     |SI nIVA1 = 1;  #dsm30301#17 = (#dsm30301#18 / #dsm30301#16) * 100;   |FINSI;
     |SI nIVA2 = 1;  #dsm30301#20 = (#dsm30301#21 / #dsm30301#19) * 100;   |FINSI;
     |SI nIVA3 = 1;  #dsm30301#23 = (#dsm30301#24 / #dsm30301#22) * 100;   |FINSI;
     |SI nIVA4 = 1;  #dsm30301#32 = (#dsm30301#33 / #dsm30301#31) * 100;   |FINSI;
     |SI nIVA5 = 1;  #dsm30301#35 = (#dsm30301#36 / #dsm30301#34) * 100;   |FINSI;
     |SI nIVA6 = 1;  #dsm30301#38 = (#dsm30301#39 / #dsm30301#37) * 100;   |FINSI;

     #dsm30301#92 = nPro;
     #dsm30301#93 = eaProrrat;

     #dsm30301#42 = #dsm30301#18 + #dsm30301#21 + #dsm30301#24 + #dsm30301#26;
     #dsm30301#42 = #dsm30301#42 + #dsm30301#28 + #dsm30301#30 + #dsm30301#33;
     #dsm30301#42 = #dsm30301#42 + #dsm30301#36 + #dsm30301#39 + #dsm30301#41;

     #dsm30301#60 = #dsm30301#44 + #dsm30301#46 + #dsm30301#48 + #dsm30301#50;
     #dsm30301#60 = #dsm30301#60 + #dsm30301#52 + #dsm30301#54 + #dsm30301#56;
     #dsm30301#60 = #dsm30301#60 + #dsm30301#57 + #dsm30301#58 + #dsm30301#59;
     #dsm30301#61 = #dsm30301#42 - #dsm30301#60;

     |SI #dsm30301#2 = 12;
         #dsm30301#64 = 0;

         |ABRE #dsmom004;
         |BUCLE dsmoc310R;
         |CIERRA #dsmom004;

         #dsm30301#65 = #dsm30301#63 - #dsm30301#64;
     |FINSI;

     |SI enPeriodo ! 12;
         #dsm30301#69 = #dsm30301#62 + #dsm30301#66 + #dsm30301#67 + #dsm30301#68;
         #dsm30301#12 = "N";
     |FINSI;

     |SI enPeriodo = 12;
         #dsm30301#69 = #dsm30301#65 + #dsm30301#66 + #dsm30301#67 + #dsm30301#68;
     |FINSI;

     #dsm30301#72 = #dsm30301#70 + #dsm30301#71;
     #dsm30301#73 = #dsm30301#69 - #dsm30301#72;

     #dsm30301#81 = #dsm30301#61 + #dsm30301#73 + #dsm30301#94;
     #dsm30301#82 = #dsm30301#82 / nContador;

     |SI nContador = 0;
         #dsm30301#82 = 100;
     |FINSI;

     #dsm30301#83 = #dsm30301#81 % #dsm30301#82;
     #dsm30301#84 = nEjerAnt;
     #dsm30301#86 = #dsm30301#83 + #dsm30301#95 - #dsm30301#84 + #dsm30301#85;

     |ABRE #dsmom004;
     |DDEFECTO #dsmom004;
     #dsmom004#0 = #dsm30301#0;
     #dsmom004#1 = #dsm30301#1;
     #dsmom004#2 = #dsm30301#2;
     #dsmom004#3 = #dsm30301#3;
     #dsmom004#4 = #dsm30301#4;
     |LEE 040#dsmom004.=;
     |CIERRA #dsmom004;

     |SI #dsmom004#24 = "S";
         #dsm30301#87 = #dsmom004#27;

         nRes = #dsm30301#86 - #dsm30301#87;

         |SI nRes < nTotal303; |Y eMensa = 0;
             |MENAV "0000RECUERDE. Si el resultado es inferior a la declaracion anterior, NO procede complementaria";
         |FINSI;
     |FINSI;

     #dsm30301#88 = #dsm30301#86 - #dsm30301#87;

     |SI #dsm30301#88 > 0;
         #dsm30301#91 = #dsm30301#88;
         #dsm30301#89 = 0;
         #dsm30301#90 = 0;
     |SINO;
         |ABRE #dsmom004;
         #dsmom004#0 = enEmpresa;
         #dsmom004#1 = enEjer;
         #dsmom004#2 = enPeriodo;
         #dsmom004#3 = enModelo;
         #dsmom004#4 = enComplem;
         |LEE 040#dsmom004.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;
         |CIERRA #dsmom004;

         |SI #dsmom004#23 = "S";
              |HAZ UltimoPeriodo;
              |SI eaUltimoPer = "COMPENSAR";
                  #dsm30301#89 = -#dsm30301#88;
                  #dsm30301#90 = 0;
                  #dsm30301#91 = 0;
              |SINO;
                  #dsm30301#90 = -#dsm30301#88;
                  #dsm30301#89 = 0;
                  #dsm30301#91 = 0;
              |FINSI;
         |FINSI;

         |SI #dsmom004#23 = "N";
             |SI #dsm30301#2 = 12;
                 |HAZ UltimoPeriodo;
                 |SI eaUltimoPer = "COMPENSAR";
                     #dsm30301#89 = -#dsm30301#88;
                     #dsm30301#90 = 0;
                     #dsm30301#91 = 0;
                 |SINO;
                     #dsm30301#90 = -#dsm30301#88;
                     #dsm30301#89 = 0;
                     #dsm30301#91 = 0;
                 |FINSI;
             |SINO;
                 #dsm30301#89 = -#dsm30301#88;
                 #dsm30301#90 = 0;
                 #dsm30301#91 = 0;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nLRGral = 0; |Y nLSimpl ! 0;
         #dsm30301#7 = "S";
     |FINSI;

     |SI #dsm30301#1 ] 2015;
         |SI nLRGral ! 0; |Y nLSimpl = 0;   || tique 70000_9314
             #dsm30301#7 = "G";
         |FINSI;
     |FINSI;

     |SI #dsm30301#79 ! 0;  |O #dsm30301#80 ! 0;
         #dsm30301#11 = "S";
     |FINSI;
|FPRC;

|PROCESO dsmom008;

     #eosactiv#0 = #dsmom008#0;
     #eosactiv#1 = #dsmom008#5;
     #eosactiv#2 = #dsmom008#1 - 2000;
     |LEE 000#eosactiv.=;
     |SI FSalida ! 0;  |DDEFECTO #eosactiv;  |FINSI;

     |SI #eosactiv#26 = "D";  || tique 1044 _ 859
         #dsm30301#6 = "S";
     |FINSI;

     |SI #eosactiv#44 = 1;
         #dsm30301#10 = "S";
     |FINSI;

     |SI enNoMod390 = 0;
         |ACABA;
     |FINSI;

     |PARA nCampo = 96;  |SI nCampo [ 116;  |HACIENDO nCampo = nCampo + 4;
           nCampo1 = nCampo + 1;
           nCampo2 = nCampo + 2;
           nCampo3 = nCampo + 3;
           |SI #dsm30301#nCampo#  = 0;
               #dsm30301#nCampo#  = #eosactiv#1;
               #dsm30301#nCampo1# = #eosactiv#5;
               #dsm30301#nCampo2# = #eosactiv#6;
               #dsm30301#nCampo3# = #eosactiv#43;

               |SI #dsm30301#nCampo3# = 0;  |O #dsm30301#nCampo3# = 4;
                |O #dsm30301#nCampo3# = 5;  |O #dsm30301#nCampo3# = 6;
                   #dsm30301#nCampo1# = "";
               |FINSI;

               |SI #dsm30301#nCampo1# = "9999";
                   #dsm30301#nCampo1# = "";
               |FINSI;

               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmom008;
     #dsmom008#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99;
     ;
     NULL, dsmom008;
|FIN;

|PROCESO GrabaModelo;
     nProrrata   = 100;

     #dsm30301#0 = enEmpresa;
     #dsm30301#1 = enEjer;
     #dsm30301#2 = enPeriodo;
     #dsm30301#3 = enModelo;
     #dsm30301#4 = enComplem;
     #dsm30301#5 = 0;
     |LEE 101#dsm30301.=;
     |SI FSalida ! 0;
         |HAZ RecogeAnter;

         |DDEFECTO #dsm30301;
         #dsm30301#0  = enEmpresa;
         #dsm30301#1  = enEjer;
         #dsm30301#2  = enPeriodo;
         #dsm30301#3  = enModelo;
         #dsm30301#4  = enComplem;
         #dsm30301#5  = 0;
         #dsm30301#8  = aGuardo8;
         #dsm30301#9  = aGuardo9;
         #dsm30301#12 = aGuardo12;
         #dsm30301#13 = aGuardo13;
         #dsm30301#14 = aGuardo14;
         #dsm30301#15 = aGuardo15;
         #dsm30301#84 = nEjerAnt;
         #dsm30301#94 = nGuardo76;
         #dsm30301#95 = nGuardo77;
         #dsm30301#130 = aGuardo130;
         #dsm30301#131 = aGuardo131;
         #dsm30301#132 = aGuardo132;
         #dsm30301#144 = aGuardo144;

         |GRABA 020#dsm30301.b;
     |FINSI;

     nEjerAnt  = #dsm30301#84;
     nIVA1     = 0;
     nIVA2     = 0;
     nIVA3     = 0;
     nIVA4     = 0;
     nIVA5     = 0;
     nIVA6     = 0;

     enExistencia = 0;
     nContador    = 0;
     nLSimpl      = 0;
     nLRGral      = 0;
     |BUCLE dsmociva;
     |ABRE #dsmom008;
     |BUCLE dsmoc310;
     |CIERRA #dsmom008;


     |SI enNoMod390 = 1;
         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsmociva.mas";
         |CARGA_DEF aMas, espejo@;
         |ABRE #espejo@;
         |BUCLE dsmocivaOper;
         |CIERRA #espejo@;
         |DESCARGA_DEF #espejo@;

         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/dsmoc310.mas";
         |CARGA_DEF aMas, espejo@;
         |ABRE #espejo@;
         |BUCLE dsmoc310Oper;
         |CIERRA #espejo@;
         |DESCARGA_DEF #espejo@;

         |SI #dsm30301#1 ] 2017;
             #dsm30301#123 = 0;
         |FINSI;

     |FINSI;

     |SI enExistencia = 0;
         |BORRA 020#dsm30301.a;
         |LIBERA #dsm30301;
         |ACABA;
     |FINSI;

     |HAZ Totales;

     |ABRE #eosactiv;
     |BUCLE dsmom008;
     |CIERRA #eosactiv;

     |SI #dsm30301#1 ] 2017;
         #dsm30301#123 = 0;
     |FINSI;

     |SI enNoMod390 = 1;
         #dsm30301#129 = #dsm30301#121 + #dsm30301#122 + #dsm30301#123;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#124 + #dsm30301#125;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#126 + #dsm30301#127;
         #dsm30301#129 = #dsm30301#129 - #dsm30301#128;

         #dsm30301#129 = #dsm30301#129 + #dsm30301#137 + #dsm30301#138;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#139 + #dsm30301#140;
         #dsm30301#129 = #dsm30301#129 + #dsm30301#141 + #dsm30301#142;
         #dsm30301#129 = #dsm30301#129 - #dsm30301#143;

         #dsm30301#120 = "N";

         |ABRE #eosm0009;
         #eosm0009#0 = enEmpresa;
         #eosm0009#1 = enEjer - 2000;
         |LEE 040#eosm0009.=;
         |SI FSalida = 0;
             #dsm30301#120 = "S";
         |FINSI;
         |CIERRA #eosm0009;

         |SI enEjer ] 2017;
||             |HAZ CreaLinProrrata;
         |FINSI;
     |FINSI;

     #dsm30301#130 = "N";
     #dsm30301#144 = "N";

     |SI #dsm30301#2 = 12;
         |SI enNoMod390 = 0;
             #dsm30301#130 = "N";
         |SINO;
             #dsm30301#130 = "S";

             |SI #dsm30301#129 = 0; |Y #dsm30301#1 < 2018;
                 #dsm30301#130 = "X";
             |FINSI;
         |FINSI;
     |FINSI;
     |SI #dsm30301#129 ! 0; |Y  #dsm30301#1 ] 2018;
         #dsm30301#144 = "S";
     |FINSI;

     |GRABA 020#dsm30301.a;
     |LIBERA #dsm30301;

     enExistencia = 1;
|FPRC;

|PROCESO CreaVentana;
     |VENTANA 1401, 3799, nPanta303, -1, "";
     nVentTrab = FSalida;

     |PULSATECLA;
|FPRC;

|PROCESO Btn8;
     |SI #dsm30301#8 = "S";
         #dsm30301#8 = "N";
         #dsmow205#2 = "N";
         #dsmow224#2 = "N";
         #dsmow227#2 = "N";
     |SINO;
         #dsm30301#8 = "S";
         #dsmow205#2 = "S";
         #dsmow224#2 = "S";
         #dsmow227#2 = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;             |PINTA #dsmow205#2;  |FINSI;
     |SI nSw = 1; |O nSw = 2; |PINTA #dsmow224#2;  |FINSI;
     |SI nSw = 3;             |PINTA #dsmow227#2;  |FINSI;
|FPRC;

|PROCESO Btn9;
     |SI #dsm30301#9 = "S";
         #dsm30301#9 = "N";
         #dsmow205#3 = "N";
         #dsmow224#3 = "N";
         #dsmow227#3 = "N";

         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";

         #dsmow205#8  = "01.01.0000";
         #dsmow205#9  = "";

         #dsmow224#8  = "01.01.0000";
         #dsmow224#9  = "";

         #dsmow227#8  = "01.01.0000";
         #dsmow227#9  = "";

         #dsm30301#14 = "01.01.0000";
         #dsm30301#15 = "";
     |SINO;
         #dsm30301#9 = "S";
         #dsmow205#3 = "S";
         #dsmow224#3 = "S";
         #dsmow227#3 = "S";

         |ESTADO_CONTROL nBtn14,  "ENABLE";
         |ESTADO_CONTROL nBtn15,  "ENABLE";
         |ESTADO_CONTROL nBtn151, "ENABLE";
         |ESTADO_CONTROL nBtn152, "ENABLE";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#3;  |FINSI;
     |SI nSw = 0;  |PINTA #dsmow205#8;  |FINSI;
     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;

     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#3;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#8;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#9;  |FINSI;

     |SI nSw = 3;  |PINTA #dsmow227#3;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#8;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn131;
     |SI #dsm30301#131 = "S";
         #dsm30301#131 = "N";
         #dsmow205#11  = "N";
         #dsmow224#11  = "N";
         #dsmow227#11  = "N";
     |SINO;
         #dsm30301#131 = "S";
         #dsmow205#11  = "S";
         #dsmow224#11  = "S";
         #dsmow227#11  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#8 = "S";
                 #dsm30301#8 = "N";
                 #dsmow224#2 = "N";
                 #dsmow227#2 = "N";
                 |SI nSw = 1; |PINTA #dsmow224#2; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#2; |FINSI;
             |FINSI;
             |SI #dsm30301#9 = "S";
                 #dsm30301#9 = "N";
                 #dsm30301#14 = "01.01.0000";
                 #dsm30301#15 = "";
                 #dsmow224#3  = "N";
                 #dsmow224#8  = "01.01.0000";
                 #dsmow224#9  = "";
                 #dsmow227#3  = "N";
                 #dsmow227#8  = "01.01.0000";
                 #dsmow227#9  = "";
                 |SI nSw = 1; |PINTA #dsmow224#3; |FINSI;
                 |SI nSw = 1; |PINTA #dsmow224#8; |FINSI;
                 |SI nSw = 1; |PINTA #dsmow224#9; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#3; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#8; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#9; |FINSI;
             |FINSI;
             |SI #dsm30301#132 = "S";
                 #dsm30301#132 = "N";
                 #dsmow224#12  = "N";
                 #dsmow227#12  = "N";
                 |SI nSw = 1;  |PINTA #dsmow224#12; |FINSI;
                 |SI nSw = 3;  |PINTA #dsmow227#12; |FINSI;
             |FINSI;
             |SI #dsm30301#12  = "S";
                 #dsm30301#12  = "N";
                 #dsmow224#6   = "N";
                 #dsmow227#6   = "N";
                 |SI nSw = 1;  |PINTA #dsmow224#6; |FINSI;
                 |SI nSw = 3;  |PINTA #dsmow227#6; |FINSI;
             |FINSI;
             |SI #dsm30301#13  = "S";
                 #dsm30301#13  = "N";
                 #dsmow224#7   = "N";
                 #dsmow227#7   = "N";
                 |SI nSw = 1; |PINTA #dsmow224#7; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#7; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#11;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#11;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#11;  |FINSI;
|FPRC;

|PROCESO Btn132;
     |SI #dsm30301#132 = "S";
         #dsm30301#132 = "N";
         #dsmow205#12  = "N";
         #dsmow224#12  = "N";
         #dsmow227#12  = "N";
     |SINO;
         #dsm30301#132 = "S";
         #dsmow205#12  = "S";
         #dsmow224#12  = "S";
         #dsmow227#12  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#12;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#12;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#12;  |FINSI;
|FPRC;


|PROCESO Btn12;
     |SI #dsm30301#12 = "S";
         #dsm30301#12 = "N";
         #dsmow205#6  = "N";
         #dsmow224#6  = "N";
         #dsmow227#6  = "N";
     |SINO;
         #dsm30301#12 = "S";
         #dsmow205#6  = "S";
         #dsmow224#6  = "S";
         #dsmow227#6  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#6;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#6;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#6;  |FINSI;
|FPRC;

|PROCESO Btn13;
     |SI #dsm30301#13 = "S";
         #dsm30301#13 = "N";
         #dsmow205#7  = "N";
         #dsmow224#7  = "N";
         #dsmow227#7  = "N";
     |SINO;
         #dsm30301#13 = "S";
         #dsmow205#7  = "S";
         #dsmow224#7  = "S";
         #dsmow227#7  = "S";
         |SI nSw = 1; |O nSw = 3;
             |SI #dsm30301#131 = "S";
                 #dsm30301#131 = "N";
                 #dsmow224#11  = "N";
                 #dsmow227#11  = "N";
                 |SI nSw = 1; |PINTA #dsmow224#11; |FINSI;
                 |SI nSw = 3; |PINTA #dsmow227#11; |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nSw = 0;  |PINTA #dsmow205#7;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#7;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#7;  |FINSI;
|FPRC;

|PROCESO Btn14;
     |SI nSw = 0;
         |ENCAMPO #8#dsmow205;
         #dsm30301#14 = #dsmow205#8;
     |FINSI;

     |SI nSw = 1; |O nSw = 2;
         |ENCAMPO #8#dsmow224;
         #dsm30301#14 = #dsmow224#8;
     |FINSI;

     |SI nSw = 3;
         |ENCAMPO #8#dsmow227;
         #dsm30301#14 = #dsmow227#8;
     |FINSI;
|FPRC;

|PROCESO Btn15;
     #dsm30301#15 = "";
     #dsmow205#9  = "";
     #dsmow224#9  = "";
     #dsmow227#9  = "";

     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#9;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn151;
     #dsm30301#15 = "1";
     #dsmow205#9  = "1";
     #dsmow224#9  = "1";
     #dsmow227#9  = "1";

     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;
     |SI nSw = 1; |O nSw = 2; |PINTA #dsmow224#9;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn152;
     #dsm30301#15 = "2";
     #dsmow205#9  = "2";
     #dsmow224#9  = "2";
     #dsmow227#9  = "2";

     |SI nSw = 0;  |PINTA #dsmow205#9;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |PINTA #dsmow224#9;  |FINSI;
     |SI nSw = 3;  |PINTA #dsmow227#9;  |FINSI;
|FPRC;

|PROCESO Btn212_11;
     |C_M #dsmow212#11, 1, "S";

     |ENCAMPO #11#dsmow212;

     #dsm30301#94 = #dsmow212#11;

     nEjerAnt  = #dsm30301#84;
     |HAZ Totales;

     |PARA nDCampo = 0;  |SI nDCampo [ 10;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 81;
           #dsmow212#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow212#11 = #dsm30301#94;
     #dsmow212#12 = #dsm30301#95;

     |C_M #dsmow212#11, 1, "N";

     |PINDA #0#dsmow212;
|FPRC;

|PROCESO Btn212_12;
     |C_M #dsmow212#12, 1, "S";

     |ENCAMPO #12#dsmow212;

     #dsm30301#95 = #dsmow212#12;

     nEjerAnt  = #dsm30301#84;
     |HAZ Totales;

     |PARA nDCampo = 0;  |SI nDCampo [ 10;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 81;
           #dsmow212#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow212#11 = #dsm30301#94;
     #dsmow212#12 = #dsm30301#95;

     |C_M #dsmow212#12, 1, "N";

     |PINDA #0#dsmow212;
|FPRC;

|PROCESO Punto01_w205;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 9;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 6;
           #dsmow205#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow205#10 = #dsm30301#130;

     |SI #dsmow205#1 = "G";
         #dsmow205#1 = "N";
     |FINSI;

     |PINPA #0#dsmow205;   nPanta205 = FSalida;
     |PINDA #0#dsmow205;

     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 0904, 0905, Btn8;   nBtn8   = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2004, 2005, Btn9;   nBtn9   = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2163, 2164, Btn14;  nBtn14  = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2408, 2409, Btn15;  nBtn15  = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2508, 2509, Btn151; nBtn151 = FSalida;
     |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 2608, 2609, Btn152; nBtn152 = FSalida;

     |SI #dsm30301#2 = 12;
         |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 1204, 1205, Btn12; nBtn12  = FSalida;
         |CONTROL_SIMPLE nPanta205, "BOTON,{{197}}", 1304, 1305, Btn13; nBtn13  = FSalida;
     |FINSI;

     |SI #dsm30301#9 = "N";
         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";
     |FINSI;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto01_w224;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 9;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 6;
           #dsmow224#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow224#10 = #dsm30301#130;
     #dsmow224#11 = #dsm30301#131;
     #dsmow224#12 = #dsm30301#132;
     |SI #dsmow224#11 = " "; #dsmow224#11 = "N"; |FINSI;
     |SI #dsmow224#12 = " "; #dsmow224#12 = "N"; |FINSI;
     |SI nSw = 2;  #dsmow224#11 = " ";  #dsmow224#12 = " "; |FINSI;

     |SI #dsmow224#1 = "G";  #dsmow224#1 = "N";  |FINSI;
     nOk = 0;
     |SI #dsm30301#6 = "S"; |O #dsm30301#7 ! "G"; |O #dsm30301#10 = "S";
        |O #dsm30301#11 = "S"; |O #dsm30301#12 = "S";
          |O #dsm30301#13 = "S"; |O #dsm30301#130 = "S";
        nOk = 1;
     |FINSI;

     |PINPA #0#dsmow224;   nPanta224 = FSalida;
     |PINDA #0#dsmow224;

     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 0904, 0905, Btn8;   nBtn8   = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2204, 2205, Btn9;   nBtn9   = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2363, 2364, Btn14;  nBtn14  = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2608, 2609, Btn15;  nBtn15  = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2708, 2709, Btn151; nBtn151 = FSalida;
     |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2808, 2809, Btn152; nBtn152 = FSalida;

     |SI #dsm30301#2 = 12;
         |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 1204, 1205, Btn12; nBtn12  = FSalida;
         |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 1304, 1305, Btn13; nBtn13  = FSalida;
     |FINSI;

     |SI nSw = 1;
         |SI nOk = 0;
             |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 0604, 0605, Btn131; nBtn131 = FSalida;
         |FINSI;
         |CONTROL_SIMPLE nPanta224, "BOTON,{{197}}", 2004, 2005, Btn132; nBtn132 = FSalida;
     |FINSI;

     |SI #dsm30301#9 = "N";
         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";
     |FINSI;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto01_w227;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 9;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 6;
           #dsmow227#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |SI #dsm30301#130 = "S"; |Y #dsm30301#144 = " ";
         #dsm30301#144 = "S";
     |FINSI;
     |SI #dsm30301#130 = "X";
         #dsm30301#144 = "N";
         #dsm30301#130 = "S";
     |FINSI;

     #dsmow227#10 = #dsm30301#130;
     #dsmow227#11 = #dsm30301#131;
     #dsmow227#12 = #dsm30301#132;
     #dsmow227#13 = #dsm30301#144;
     |SI #dsmow227#10 = " "; #dsmow227#10 = "N"; |FINSI;
     |SI #dsmow227#11 = " "; #dsmow227#11 = "N"; |FINSI;
     |SI #dsmow227#12 = " "; #dsmow227#12 = "N"; |FINSI;
     |SI #dsmow227#13 = " "; #dsmow227#13 = "N"; |FINSI;

     |SI #dsmow227#1 = "G";  #dsmow227#1 = "N"; |FINSI;

     nOk = 0;
     |SI #dsm30301#6 = "S"; |O #dsm30301#7 ! "G"; |O #dsm30301#10 = "S";
        |O #dsm30301#11 = "S"; |O #dsm30301#12 = "S";
          |O #dsm30301#13 = "S"; |O #dsm30301#130 = "S";
        nOk = 1;
     |FINSI;

     |PINPA #0#dsmow227;   nPanta227 = FSalida;
     |PINDA #0#dsmow227;

     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 0904, 0905, Btn8;   nBtn8   = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1904, 1905, Btn9;   nBtn9   = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2063, 2064, Btn14;  nBtn14  = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2308, 2309, Btn15;  nBtn15  = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2408, 2409, Btn151; nBtn151 = FSalida;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 2508, 2509, Btn152; nBtn152 = FSalida;

     |SI #dsm30301#2 = 12;
         |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1204, 1205, Btn12; nBtn12  = FSalida;
         |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1304, 1305, Btn13; nBtn13  = FSalida;
     |FINSI;

     |SI nOk = 0;
         |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 0604, 0605, Btn131; nBtn131 = FSalida;
     |FINSI;
     |CONTROL_SIMPLE nPanta227, "BOTON,{{197}}", 1504, 1505, Btn132; nBtn132 = FSalida;

     |SI #dsm30301#9 = "N";
         |ESTADO_CONTROL nBtn14,  "DISABLE";
         |ESTADO_CONTROL nBtn15,  "DISABLE";
         |ESTADO_CONTROL nBtn151, "DISABLE";
         |ESTADO_CONTROL nBtn152, "DISABLE";
     |FINSI;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto01;

     nSw = 0;
     |SI #dsm30301#1 ] 2018;                      nSw = 3; |FINSI;
     |SI #dsm30301#1 = 2018; |Y #dsm30301#2 < 12; nSw = 1; |FINSI;
     |SI #dsm30301#1 = 2018; |Y #dsm30301#2 = 1;  nSw = 2; |FINSI;

     |SI nSw = 0;              |HAZ Punto01_w205;  |FINSI;
     |SI nSw = 1; |O nSw = 2;  |HAZ Punto01_w224;  |FINSI;
     |SI nSw = 3;              |HAZ Punto01_w227;  |FINSI;
|FPRC;

|PROCESO Punto02;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 45;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 16;
           #dsmow206#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow206;
     |PINDA #0#dsmow206;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Evt02;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm30302.=;

         |PARA nDCampo = 0;  |SI nDCampo [ 8;  |HACIENDO nDCampo = nDCampo + 1;
                nHCampo = nDCampo + 6;
                #dsmow209#nDCampo# = #dsm30302#nHCampo#;

                |C_V #dsmow209#nDCampo#, 0, aAlfa;
                |SI aAlfa = "S";
                    |PINTA #dsmow209#nDCampo#;
                |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Baja02;
     #dsm30302#0 = enEmpresa;
     #dsm30302#1 = enEjer;
     #dsm30302#2 = enPeriodo;
     #dsm30302#3 = enModelo;
     #dsm30302#4 = enComplem;
     #dsm30302#5 = enActividad;
     #dsm30302#6 = 001;
|FPRC;

|PROCESO Alta02;
     #dsm30302#0 = enEmpresa;
     #dsm30302#1 = enEjer;
     #dsm30302#2 = enPeriodo;
     #dsm30302#3 = enModelo;
     #dsm30302#4 = enComplem;
     #dsm30302#5 = enActividad;
     #dsm30302#6 = 999;
|FPRC;

|PROCESO Punto03;
     |HAZ CreaVentana;

     |PINPA #0#dsmow209;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsmow209;
     |PINDA #0#dsmow209;

     nRango = 2 + 4 + 8 + 32 + 128;

     |LINEAL_SIMPLE #1#dsm30302, nRango, 0502, 1198, Baja02, Alta02, Evt02;
     nGrid02 = FSalida;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Evt03;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm30303.=;

         |PARA nDCampo = 0;  |SI nDCampo [ 27; |HACIENDO nDCampo = nDCampo + 1;
                nHCampo = nDCampo + 6;
                #dsmow210#nDCampo# = #dsm30303#nHCampo#;

                |C_V #dsmow210#nDCampo#, 0, aAlfa;
                |SI aAlfa = "S";
                    |PINTA #dsmow210#nDCampo#;
                |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO Baja03;
     #dsm30303#0 = enEmpresa;
     #dsm30303#1 = enEjer;
     #dsm30303#2 = enPeriodo;
     #dsm30303#3 = enModelo;
     #dsm30303#4 = enComplem;
     #dsm30303#5 = 00;
|FPRC;

|PROCESO Alta03
     #dsm30303#0 = enEmpresa;
     #dsm30303#1 = enEjer;
     #dsm30303#2 = enPeriodo;
     #dsm30303#3 = enModelo;
     #dsm30303#4 = enComplem;
     #dsm30303#5 = 99;
|FPRC;

|PROCESO Punto04;
     |HAZ CreaVentana;

     |PINPA #0#dsmow210;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsmow210;
     |PINDA #0#dsmow210;

     nRango = 2 + 4 + 8 + 32 + 128;

     |LINEAL_SIMPLE #1#dsm30303, nRango, 0502, 1198, Baja03, Alta03, Evt03;
     nGrid03 = FSalida;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto05;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 11;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 62;
           #dsmow207#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow207;
     |PINDA #0#dsmow207;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto06;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 6;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 74;
           #dsmow208#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow208;
     |PINDA #0#dsmow208;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Cancelar;
     |PTEC 807;
|FPRC;

|PROCESO Validar;
     |PTEC 806;
|FPRC;

|PROCESO Modw213;
     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod213, "DISABLE";

     |CONTROL_SIMPLE nPanta213, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta213, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow213;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 34;  |HACIENDO nDCampo = nDCampo + 1;
               nHCampo = nDCampo + 96;
               #dsm30301#nHCampo# = #dsmow213#nDCampo#;
         |SIGUE;
     |FINSI;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod213, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto07;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 34;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 96;
           #dsmow213#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     |PINPA #0#dsmow213; nPanta213 = FSalida;
     |PINDA #0#dsmow213;

     |CONTROL_SIMPLE nPanta213, "BOTON,{{197}}Modificar", 3002, 3013, Modw213;
     nBtnMod213 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Punto08;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 10;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 81;
           #dsmow212#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow212#11 = #dsm30301#94;
     #dsmow212#12 = #dsm30301#95;

     |PINPA #0#dsmow212;  nPanta212 = FSalida;
     |PINDA #0#dsmow212;

     |CONTROL_SIMPLE nPanta212, "BOTON,{{197}}", 0680, 0682, Btn212_11;
     |CONTROL_SIMPLE nPanta212, "BOTON,{{197}}", 0980, 0982, Btn212_12;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Modw220;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod220, "DISABLE";

     |CONTROL_SIMPLE nPanta220, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta220, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow220;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 24;  |HACIENDO nDCampo = nDCampo + 1;
               nHCampo = nDCampo + 96;
               #dsm30301#nHCampo# = #dsmow220#nDCampo#;
         |SIGUE;
     |FINSI;
     #dsm30301#133 = #dsmow220#25;
     #dsm30301#134 = #dsmow220#26;
     #dsm30301#135 = #dsmow220#27;
     #dsm30301#136 = #dsmow220#28;
     #dsm30301#145 = #dsmow220#29;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod220, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto09;
     |HAZ CreaVentana;

     |PARA nDCampo = 0;  |SI nDCampo [ 24;  |HACIENDO nDCampo = nDCampo + 1;
           nHCampo = nDCampo + 96;
           #dsmow220#nDCampo# = #dsm30301#nHCampo#;
     |SIGUE;

     #dsmow220#25 = #dsm30301#133;
     #dsmow220#26 = #dsm30301#134;
     #dsmow220#27 = #dsm30301#135;
     #dsmow220#28 = #dsm30301#136;
     #dsmow220#29 = #dsm30301#145;

     |PINPA #0#dsmow220; nPanta220 = FSalida;
     |PINDA #0#dsmow220;

     |CONTROL_SIMPLE nPanta220, "BOTON,{{197}}Modificar", 3002, 3013, Modw220;
     nBtnMod220 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Modw221;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod221, "DISABLE";

     |CONTROL_SIMPLE nPanta221, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta221, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow221;
     |SI FSalida = 0;
         |PARA nDCampo = 0;  |SI nDCampo [ 15;  |HACIENDO nDCampo = nDCampo + 1;
               |SI nDCampo [ 8; nHCampo = nDCampo + 121; |FINSI;
               |SI nDCampo > 8; nHCampo = nDCampo + 128; |FINSI;
               #dsm30301#nHCampo# = #dsmow221#nDCampo#;
         |SIGUE;
         |SI #dsm30301#1 ] 2018;
             #dsm30301#144 = "N";
             |SI #dsm30301#129 ! 0;
                 #dsm30301#144 = "S";
             |FINSI;
         |FINSI;
     |FINSI;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod221, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto10;
     |HAZ CreaVentana;

     #dsmow221#0  = #dsm30301#121;
     #dsmow221#1  = #dsm30301#122;
     #dsmow221#2  = #dsm30301#123;
     #dsmow221#3  = #dsm30301#124;
     #dsmow221#4  = #dsm30301#125;
     #dsmow221#5  = #dsm30301#126;
     #dsmow221#6  = #dsm30301#127;
     #dsmow221#7  = #dsm30301#128;
     #dsmow221#8  = #dsm30301#129;
     #dsmow221#9  = #dsm30301#137;
     #dsmow221#10 = #dsm30301#138;
     #dsmow221#11 = #dsm30301#139;
     #dsmow221#12 = #dsm30301#140;
     #dsmow221#13 = #dsm30301#141;
     #dsmow221#14 = #dsm30301#142;
     #dsmow221#15 = #dsm30301#143;

     |PINPA #0#dsmow221; nPanta221 = FSalida;
     |PINDA #0#dsmow221;

     |CONTROL_SIMPLE nPanta221, "BOTON,{{197}}Modificar", 3002, 3013, Modw221;
     nBtnMod221 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Modw222;
     |LEE 101#dsm30304.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir,   "HIDE";
     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnAlt222, "DISABLE";
     |ESTADO_CONTROL nBtnMod222, "DISABLE";
     |ESTADO_CONTROL nBtnBaj222, "DISABLE";

     |CONTROL_SIMPLE nPanta222, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |C_M #dsmow222#0, 1, "N";

     |ENDATOS #1#dsmow222;
     |SI FSalida = 0;
         #dsm30304#4  = #dsmow222#0;
         #dsm30304#5  = #dsmow222#1;
         #dsm30304#6  = #dsmow222#2;
         #dsm30304#7  = #dsmow222#3;
         #dsm30304#8  = #dsmow222#4;
         #dsm30304#9  = #dsmow222#5;
         #dsm30304#10 = #dsmow222#6;

         |GRABA 020#dsm30304.a;
     |FINSI;
     |LIBERA #dsm30304;

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;

     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nBtnAlt222, "ENABLE";
     |ESTADO_CONTROL nBtnMod222, "ENABLE";
     |ESTADO_CONTROL nBtnBaj222, "ENABLE";

     |REFRESCACONTROL nGrid04;
     |FOCOTECLADO nGrid04;
|FPRC;

|PROCESO Altw222;
     nIdSalir  = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir,   "HIDE";
     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnAlt222, "DISABLE";
     |ESTADO_CONTROL nBtnMod222, "DISABLE";
     |ESTADO_CONTROL nBtnBaj222, "DISABLE";

     |CONTROL_SIMPLE nPanta222, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |C_M #dsmow222#0, 1, "S";

     |ENDATOS #1#dsmow222;
     |SI FSalida = 0;
         #dsm30304#0  = enEmpresa;
         #dsm30304#1  = enEjer;
         #dsm30304#2  = enModelo;
         #dsm30304#3  = enComplem;
         #dsm30304#4  = #dsmow222#0;
         #dsm30304#5  = #dsmow222#1;
         #dsm30304#6  = #dsmow222#2;
         #dsm30304#7  = #dsmow222#3;
         #dsm30304#8  = #dsmow222#4;
         #dsm30304#9  = #dsmow222#5;
         #dsm30304#10 = #dsmow222#6;

         |GRABA 020#dsm30304.n;
         |LIBERA #dsm30304;
     |FINSI;

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;

     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nBtnAlt222, "ENABLE";
     |ESTADO_CONTROL nBtnMod222, "ENABLE";
     |ESTADO_CONTROL nBtnBaj222, "ENABLE";

     |REFRESCACONTROL nGrid04;
     |FOCOTECLADO nGrid04;
|FPRC;

|PROCESO Bajw222;
     |CONFI "0000NSeguro que quiere borrar la actividad";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#dsm30304.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#dsm30304.a;
     |LIBERA #dsm30304;

     |ESTADO_CONTROL nBtnAlt222, "ENABLE";
     |ESTADO_CONTROL nBtnMod222, "DISABLE";
     |ESTADO_CONTROL nBtnBaj222, "DISABLE";

     |REFRESCACONTROL nGrid04;
     |FOCOTECLADO nGrid04;
|FPRC;

|PROCESO Evt04;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsm30304.=;

         #dsmow222#7  = enEmpresa;
         #dsmow222#8  = enEjer - 2000;
         #dsmow222#0  = #dsm30304#4;   |PINTA #dsmow222#0;
         #dsmow222#1  = #dsm30304#5;   |PINTA #dsmow222#1;
         #dsmow222#2  = #dsm30304#6;   |PINTA #dsmow222#2;
         #dsmow222#3  = #dsm30304#7;   |PINTA #dsmow222#3;
         #dsmow222#4  = #dsm30304#8;   |PINTA #dsmow222#4;
         #dsmow222#5  = #dsm30304#9;   |PINTA #dsmow222#5;
         #dsmow222#6  = #dsm30304#10;  |PINTA #dsmow222#6;

         |ESTADO_CONTROL nBtnMod222, "ENABLE";
         |ESTADO_CONTROL nBtnBaj222, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Baja04;
     #dsm30304#0 = enEmpresa;
     #dsm30304#1 = enEjer;
     #dsm30304#2 = enModelo;
     #dsm30304#3 = enComplem;
     #dsm30304#4 = 01;
|FPRC;

|PROCESO Alta04;
     #dsm30304#0 = enEmpresa;
     #dsm30304#1 = enEjer;
     #dsm30304#2 = enModelo;
     #dsm30304#3 = enComplem;
     #dsm30304#4 = 99;
|FPRC;

|PROCESO Punto11;
     |HAZ CreaVentana;

     |PINPA #0#dsmow222; nPanta222 = FSalida;

     |PTEC 802;  |PAUSA;

     |DDEFECTO #dsmow222;
     #dsmow222#7  = enEmpresa;
     #dsmow222#8  = enEjer - 2000;
     |PINDA #0#dsmow222;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{197}}Modificar", 1774, 1786, Modw222;
     nBtnMod222 = FSalida;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{197}}Alta", 1788, 1798, Altw222;
     nBtnAlt222 = FSalida;

     |CONTROL_SIMPLE nPanta222, "BOTON,{{197}}Borrar", 1762, 1772, Bajw222;
     nBtnBaj222 = FSalida;

     |ESTADO_CONTROL nBtnMod222, "DISABLE";
     |ESTADO_CONTROL nBtnBaj222, "DISABLE";

     nRango = 2 + 4 + 8 + 32 + 128;

     |LINEAL_SIMPLE #1#dsm30304, nRango, 0502, 1698, Baja04, Alta04, Evt04;
     nGrid04 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Iguala223;
    |DDEFECTO #dsm30305;
    #dsm30305#0 = #dsm30301#0;
    #dsm30305#1 = #dsm30301#1;
    #dsm30305#2 = #dsm30301#3;
    #dsm30305#3 = #dsm30301#4;
    #dsm30305#4 = nLinea;
    |LEE 141#dsm30305.=;
    nEstado = FSalida;

    nNume1 = 1; |SI #dsm30305#4 = 2; nNume1 = 20; |FINSI;
    nNume2 = nNume1 + 17;
    nNume3 = 5;
    |PARA nDCampo = nNume1;  |SI nDCampo [ nNume2;  |HACIENDO nDCampo = nDCampo + 1;
          |SI nOpera = 1; #dsm30305#nNume3# = #dsmow223#nDCampo#; |FINSI;
          |SI nOpera = 4; #dsmow223#nDCampo# = #dsm30305#nNume3#; |FINSI;
          nNume3 = nNume3 + 1;
    |SIGUE;
    |SI nOpera = 1;
        |SI nEstado = 0; |GRABA 020#dsm30305.a; |FINSI;
        |SI nEstado ! 0; |GRABA 020#dsm30305.n; |FINSI;
    |FINSI;

    |LIBERA #dsm30305;
|FPRC;

|PROCESO Modw223;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |ESTADO_CONTROL nTree,      "DISABLE";
     |ESTADO_CONTROL nBtnMod223, "DISABLE";

     |CONTROL_SIMPLE nPanta223, "BOTON,{{206}}Validar", 3072, 3084,  Validar;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE nPanta223, "BOTON,{{207}}Cancelar", 3086, 3098, Cancelar;
     nBtnCan = FSalida;

     |ENDATOS #1#dsmow223;
     |SI FSalida = 0;
         |ABRE #dsm30305;
         nOpera = 1;
         nLinea = 1; |HAZ Iguala223;
         nLinea = 2; |HAZ Iguala223;
         |CIERRA #dsm30305;
     |FINSI;

     |ESTADO_CONTROL nTree,      "ENABLE";
     |ESTADO_CONTROL nIdSalir,   "SHOW";
     |ESTADO_CONTROL nBtnMod223, "ENABLE";

     |FIN_CONTROL_WINDOWS nBtnVal;
     |FIN_CONTROL_WINDOWS nBtnCan;
|FPRC;

|PROCESO Punto12;
     |HAZ CreaVentana;

     |DDEFECTO #dsmow223;
     |ABRE #dsm30305;
     nOpera = 4;
     nLinea = 1; |HAZ Iguala223;
     nLinea = 2; |HAZ Iguala223;
     |CIERRA #dsm30305;

     |PINPA #0#dsmow223; nPanta223 = FSalida;
     |PINDA #0#dsmow223;

     |CONTROL_SIMPLE nPanta223, "BOTON,{{197}}Modificar", 3002, 3013, Modw223;
     nBtnMod223 = FSalida;

     |PTEC 802;  |PAUSA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO EventoTree;
     |SI nPintaSalir = 0;  |ACABA;  |FINSI;
     |SI FEntrada ! 0;     |ACABA;  |FINSI;

     aAlfa = Contenido % -102;  |QBT aAlfa;

     |SI nGrid02 ! -1;
         |DESTRUYECONTROL nGrid02;
         nGrid02 = -1;
     |FINSI;

     |SI nGrid03 ! -1;
         |DESTRUYECONTROL nGrid03;
         nGrid03 = -1;
     |FINSI;

     |SI nVentTrab ! -1;
         |FINVENTANA nVentTrab;
         nVentTrab = -1;
     |FINSI;

     |SI aAlfa = "01";  |HAZ Punto01; |FINSI;
     |SI aAlfa = "02";  |HAZ Punto02; |FINSI;
     |SI aAlfa = "03";  |HAZ Punto03; |FINSI;
     |SI aAlfa = "04";  |HAZ Punto04; |FINSI;
     |SI aAlfa = "05";  |HAZ Punto05; |FINSI;
     |SI aAlfa = "06";  |HAZ Punto06; |FINSI;
     |SI aAlfa = "07";  |HAZ Punto07; |FINSI;
     |SI aAlfa = "08";  |HAZ Punto08; |FINSI;
     |SI aAlfa = "09";  |HAZ Punto09; |FINSI;
     |SI aAlfa = "10";  |HAZ Punto10; |FINSI;
     |SI aAlfa = "11";  |HAZ Punto11; |FINSI;
     |SI aAlfa = "12";  |HAZ Punto12; |FINSI;
|FPRC;

|PROCESO TraeTxtComprimido;
     aAlfa = aRutaOrigen + aFicheroTar + " " + aFicheroTxt;
     |ATAR aAlfa, aRutaOrigen;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaOrigen + aFicheroTar;
          |XABRE "E", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = aRutaOrigen + aFicheroTar;
     |COMPRIME aAlfa;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaOrigen + aFicheroTgz;
          |XABRE "E", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = aRutaOrigen + aFicheroTxt;  |FBORRA aAlfa;
     aAlfa = aRutaOrigen + aFicheroTar;  |FBORRA aAlfa;

     aOrigen  = aRutaOrigen  + aFicheroTgz;
     aDestino = aRutaDestino + aFicheroTgz;

     |RFBORRA aDestino;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaDestino + aFicheroTgz;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     Pos   = -1;
     aAlfa = aRutaDestino + aFicheroTgz;
     |RDESCOMPRIME aAlfa;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaDestino + aFicheroTar;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     |RDETAR aAlfa, aRutaDestino;

     |PARA;  |SI;  |HACIENDO;
          aAbre = aRutaDestino + aFicheroTxt;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = aRutaOrigen  + aFicheroTgz;  |FBORRA aAlfa;
     aAlfa = aRutaDestino + aFicheroTgz;  |RFBORRA aAlfa;
     aAlfa = aRutaDestino + aFicheroTar;  |RFBORRA aAlfa;
|FPRC;

|PROCESO CargaArbol;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO MontaArbol;
     |PTEC 802;  |PAUSA;

     |HAZ LeeUnidad;

     |DBASE aBase;  |QBF aBase;
     aRutaOrigen  = aBase + "tmp";   |MKDIR aRutaOrigen;
     aRutaOrigen  = aRutaOrigen + "/";
     aRutaDestino = eaUnidad + "\modelos";    |RMKDIR aRutaDestino;
     aRutaDestino = aRutaDestino + "\tmp";  |RMKDIR aRutaDestino;
     aRutaDestino = aRutaDestino + "\";

     aFicheroTxt  = "dsm3030101" + Usuario + ".txt";
     aFicheroTgz  = "dsm3030101" + Usuario + ".tgz";
     aFicheroTar  = "dsm3030101" + Usuario + ".tar";

     aAbre = aRutaOrigen + aFicheroTxt;

     sT_nID   = nTree;
     sT_nOper = 0;

     |XABRE "WB", aAbre, nHandle;

     nLinea  = 0;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Identificacin {{01}}";
     |HAZ CargaArbol;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Rgimen general {{02}}";
     |HAZ CargaArbol;

     |SI enEjer ] 2017;
         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado ";
         |HAZ CargaArbol;

         aAlfa   = nLinea + ",1:Actividades agrcolas, ganaderas y forestales {{03}}";
         |HAZ CargaArbol;

         aAlfa   = nLinea + ",2:Actividades en rgimen simplificado {{04}}";
         |HAZ CargaArbol;

         aAlfa   = nLinea + ",3:Totales {{05}}";
         |HAZ CargaArbol;
     |SINO;
         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado - Actividades agrcolas, ganaderas y forestales {{03}}";
         |HAZ CargaArbol;

         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado - Actividades en rgimen simplificado {{04}}";
         |HAZ CargaArbol;

         nLinea  = nLinea + 1;
         aAlfa   = nLinea + ":Rgimen simplificado - Totales {{05}}";
         |HAZ CargaArbol;
     |FINSI;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Informacin adicional {{06}}";
     |HAZ CargaArbol;

     |SI enNoMod390 = 1;
         |SI enEjer ] 2017;
             nLinea  = nLinea + 1;
             aAlfa   = nLinea + ":Sujetos pasivos que queden exonerados de la Declaracin anual";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",1:Actividades a las que se refiere la declaracin {{09}}";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",2:Operaciones realizadas en el ejercicio {{10}}";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",3:Prorrata {{11}}";
             |HAZ CargaArbol;

             aAlfa   = nLinea + ",4:Actividades con regmenes de deduccin diferenciados {{12}}";
             |HAZ CargaArbol;
         |SINO;
             nLinea  = nLinea + 1;
             aAlfa   = nLinea + ":Sujetos pasivos que queden exonerados de la Declaracin anual {{07}}";
             |HAZ CargaArbol;

         |FINSI;
     |FINSI;

     nLinea  = nLinea + 1;
     aAlfa   = nLinea + ":Resultados {{08}}";
     |HAZ CargaArbol;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = aRutaDestino + aFicheroTxt;

     aAlfa = "TREECTRL,Apartados {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nPanta303, aAlfa, 0602, 1398, EventoTree;
     nTree = FSalida;

     aFicheroTxt   = "dsm3030101" + Usuario + ".txt";
     aAlfa         = aRutaDestino + aFicheroTxt;
     |RFBORRA aAlfa;

     sT_nID   = nTree;
     sT_nOper = 2;
     sT_aData = "1:";
     |ESPECIFICA "COMMANDCONTROL", sTree;

     sT_nID   = nTree;
     sT_nOper = 2;
     sT_aData = "0:";
     |ESPECIFICA "COMMANDCONTROL", sTree;
|FPRC;

|PROCESO MontaApartados;
     #dsm30301#0 = enEmpresa;
     #dsm30301#1 = enEjer;
     #dsm30301#2 = enPeriodo;
     #dsm30301#3 = enModelo;
     #dsm30301#4 = enComplem;
     #dsm30301#5 = enActividad;
     |LEE 101#dsm30301.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe registro.";
         |ACABA;
     |FINSI;

     |SI enNoMod390 = 0;
         #dsm30301#130 = " ";
     |FINSI;

     |SI enNoMod390 = 1;
         |SI #dsm30301#130 = " ";
             #dsm30301#130 = "S";
         |FINSI;
     |FINSI;

     |VENTANA 0501, 3899, -1, 0,  "";
     nVentana = FSalida;

     |PINPA #0#dsm30301;  nPanta303 = FSalida;

     |ABRE #eosclien;
     #eosclien#0 = enEmpresa;
     |LEE 000#eosclien.=;
     |CIERRA #eosclien;

     aAlfa = "LABEL,{{15}}Modelo 303 (" + (("00000" + enEmpresa) % -105) + " " + #eosclien#2;  |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |CONTROL_SIMPLE nPanta303, aAlfa, 0502, 0598, NULL;

     nPintaSalir = 0;
     |HAZ MontaArbol;

     aEsc1      = &255 + "806";
     aEsc2      = &255 + "807";
     aRetu      = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         nPintaSalir = 1;
         FSalida = "::{{001}}Salir," + nTree;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |GRABA 020#dsm30301.a;
     |LIBERA #dsm30301;

     |SI nVentTrab ! -1;
         |FINVENTANA nVentTrab;
         nVentTrab = -1;
     |FINSI;

     |PULSATECLA;

     |FINVENTANA nVentana;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 1010#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#15 = #dsm30301#88;
         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO dsm30302B;
     |BORRA 020#dsm30302.a;
     |LIBERA #dsm30302;
|FPRC;

|DEFBUCLE dsm30302B;
     #dsm30302#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,00,000;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,99,999;
     be;
     NULL, dsm30302B;
|FIN;

|PROCESO dsm30303B;
     |BORRA 020#dsm30303.a;
     |LIBERA #dsm30303;
|FPRC;

|DEFBUCLE dsm30303B;
     #dsm30303#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,00;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,99;
     be;
     NULL, dsm30303B;
|FIN;

|PROCESO dsm30304B;
     |BORRA 020#dsm30304.a;
     |LIBERA #dsm30304;
|FPRC;

|DEFBUCLE dsm30304B;
     #dsm30304#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,01;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,99;
     be;
     NULL, dsm30304B;
|FIN;

|PROCESO dsm30305B;
     |BORRA 020#dsm30305.a;
     |LIBERA #dsm30305;
|FPRC;

|DEFBUCLE dsm30305B;
     #dsm30305#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,1;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,9;
     be;
     NULL, dsm30305B;
|FIN;

|PROGRAMA;
     eaNomDef  = "dsm30301";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 1;  |O enTipoEntrada = 4;
         |HAZ MontaApartados;
     |FINSI;

|| \\\\\\ Grabacion del modelo

     |SI enTipoEntrada = 98;
         aGuardo8  = "N";
         aGuardo9  = "N";
         aGuardo12 = "N";
         aGuardo13 = "N";
         aGuardo14 = "01.01.0000";
         aGuardo15 = "";
         nGuardo76 = 0;
         nGuardo77 = 0;
         aGuardo130 = " ";
         aGuardo131 = " ";
         aGuardo132 = " ";
         aGuardo144 = " ";

         #dsm30301#0 = enEmpresa;
         #dsm30301#1 = enEjer;
         #dsm30301#2 = enPeriodo;
         #dsm30301#3 = enModelo;
         #dsm30301#4 = enComplem;
         #dsm30301#5 = 0;
         |LEE 101#dsm30301.=;
         |SI FSalida = 0;
             aGuardo8   = #dsm30301#8;
             aGuardo9   = #dsm30301#9;
             aGuardo12  = #dsm30301#12;
             aGuardo13  = #dsm30301#13;
             aGuardo14  = #dsm30301#14;
             aGuardo15  = #dsm30301#15;
             nGuardo76  = #dsm30301#94;
             nGuardo77  = #dsm30301#95;
             aGuardo130 = #dsm30301#130;
             aGuardo131 = #dsm30301#131;
             aGuardo132 = #dsm30301#132;
             aGuardo144 = #dsm30301#144;

             |SI nGuardo77 < 0; nGuardo77 = 0; |FINSI;

             |BORRA 020#dsm30301.a;
             |LIBERA #dsm30301;

             |BUCLE dsm30302B;
             |BUCLE dsm30303B;
         |FINSI;

         |HAZ GrabaModelo;
     |FINSI;

     |SI enTipoEntrada = 3;   ||borrar solo la parte manual
         #dsm30301#0 = enEmpresa;
         #dsm30301#1 = enEjer;
         #dsm30301#2 = enPeriodo;
         #dsm30301#3 = enModelo;
         #dsm30301#4 = enComplem;
         #dsm30301#5 = 0;
         |LEE 101#dsm30301.=;
         |SI FSalida = 0;
             |SI #dsm30301#2 = 12;
                 |BUCLE dsm30304B;
                 |BUCLE dsm30305B;
             |FINSI;
         |FINSI;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         #dsm30301#0 = enEmpresa;
         #dsm30301#1 = enEjer;
         #dsm30301#2 = enPeriodo;
         #dsm30301#3 = enModelo;
         #dsm30301#4 = enComplem;
         #dsm30301#5 = enActividad;
         |LEE 040#dsm30301.=;
         |SI FSalida ! 0;  enExistencia = 1;  |DDEFECTO #dsm30301; |FINSI;

         |SI enActividad = 0;  enResultado = #dsm30301#88;  |FINSI;
     |FINSI;

     |CLS;
|FPRO;

|PROCESO dsmom008Ult;
     #eosactiv#0 = #dsmom008#0;
     #eosactiv#1 = #dsmom008#5;
     #eosactiv#2 = #dsmom008#1 - 2000;
     |LEE 000#eosactiv.=;
     |SI FSalida ! 0;  |DDEFECTO #eosactiv;  |FINSI;

     |SI enEjer ] 2017;
         |SI #eosactiv#26 = "M"; |O #eosactiv#26 = "D";
            enNoMod390 = 1;
            |ERROR10;
            |ACABA;
         |FINSI;
     |FINSI;

     |SI #eosactiv#22 = "A";
         enNoMod390 = 1;
         |ACABA;
     |FINSI;

     |SI #eosactiv#5 = "8612"; |O #eosactiv#5 = "8611"; || ... |O #eosactiv#5 = "862 "; 700000_10027
         enNoMod390 = 1;
         |ACABA;
     |FINSI;

     enNoMod390 = 0;
     |ERROR10;
|FPRC;

|DEFBUCLE dsmom008Ult;
     #dsmom008#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 01;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, 99;
     ;
     NULL, dsmom008Ult;
|FIN;

|PROCESO dsm30301Ant;
     #dsm30301#0  = #dsm30301@#0;
     #dsm30301#1  = #dsm30301@#1;
     #dsm30301#2  = #dsm30301@#2;
     #dsm30301#3  = #dsm30301@#3;
     #dsm30301#4  = #dsm30301@#4;
     #dsm30301#5  = #dsm30301@#5;
     |LEE 101#dsm30301.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm30301;
         #dsm30301#0  = #dsm30301@#0;
         #dsm30301#1  = #dsm30301@#1;
         #dsm30301#2  = #dsm30301@#2;
         #dsm30301#3  = #dsm30301@#3;
         #dsm30301#4  = #dsm30301@#4;
         #dsm30301#5  = #dsm30301@#5;

         |GRABA 020#dsm30301.b;
     |FINSI;

     |PARA nCampo = 6;  |SI nCampo [ 130;  |HACIENDO nCampo = nCampo + 1;
           #dsm30301#nCampo# = #dsm30301@#nCampo#
     |SIGUE;

     |GRABA 020#dsm30301.a;
     |LIBERA #dsm30301;

     |BORRA 020#dsm30301@.a;
     |LIBERA #dsm30301@;
|FPRC;

|DEFBUCLE dsm30301Ant;
     #dsm30301@#1006;
     ;
     00000, 0000, 00, 000, 00, 00;
     99999, 9999, 99, 999, 99, 99;
     ;
     NULL, dsm30301Ant;
|FIN;

|PROCESO CambiaPath;
     |DBASS aBase;
     aFic = aBase + "modelos/fich/";
     aAlfa = aFic + "dsm30301.dat"
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsm30301.mas";
     |CARGA_DEF aMas, dsm30301@;

     |PATH_DAT #dsm30301@#aFic#;

     |ABRE #dsm30301;
     |BUCLE dsm30301Ant;
     |CIERRA #dsm30301;

     |DELINDEX #dsm30301@;
     |DESCARGA_DEF #dsm30301@;
|FPRC;

|PROCESO Tipo80Fm30301;  |TIPO 80;
     |HAZ CambiaPath;

     aAlfa = PARAMETRO % 105;  enEmpresa     = aAlfa;
     aAlfa = PARAMETRO % 604;  enEjer        = aAlfa;
     aAlfa = PARAMETRO % 1002; enPeriodo     = aAlfa;
     aAlfa = PARAMETRO % 1203; enModelo      = aAlfa;
     aAlfa = PARAMETRO % 1502; enComplem     = aAlfa;
     aAlfa = PARAMETRO % 1702; enActividad   = aAlfa;
     aAlfa = PARAMETRO % 1902; enTipoEntrada = aAlfa;
     aAlfa = PARAMETRO % 2101; enExistencia  = aAlfa;

     enNoMod390 = 0;
     |SI enPeriodo = 12;
         |ABRE #eosactiv;
         |BUCLE dsmom008Ult;
         |CIERRA #eosactiv;
     |FINSI;

     enModelo = 303;

     |ABRET #dsm30301;
     |ABRET #dsm30302;
     |ABRET #dsm30303;
     |ABRET #dsm30304;
|FPRC;

|PROCESO Tipo90Fm30301;  |TIPO 90;
     |CIERRAT #dsm30301;
     |CIERRAT #dsm30302;
     |CIERRAT #dsm30303;
     |CIERRAT #dsm30304;
|FPRC;
