|FICHEROS;
     eoslibsu #0;
     eosclien #1;
     eosconce #2;
     eosconli #3;
     eoslinve #4;
     eosclpre #5;
     eosactiv #6;
     eoscolib #8;
     eosma004 #9;
     eoscabve #10;
     eosconc6 #12;
     eosw0044 #99,MANTE;
|FIN;

|VARIABLES;
     XPara       = 0;
     XPara1      = 0;
     Fichero     = "";
     SwTempo     = 0;
     DActiv      = 0;
     HActiv      = 0;
     Tecla       = 0;
     Contador    = 0;
     LaActiv     = 0;
     Libro       = "";

     TipoConc    = "";

     pp          = 0;
     linealib    = 0;
     base_linea  = 0;
     Concep2     = 0;
     Concep6     = "";
     manolo      = 0;
     activida    = 0;
     act         = 0;
     FEstado     = 0;
     swacum      = 0;
     anyo1       = "";
     anyo2       = "";
     VAralf      = "";
     Fecha1      = @;
     Fecha2      = @;
     SwPrint     = 0;
     x           = 0;
     guion       = "-";
     espacio     = "                                                          ";
     espa        = " ";
     barra       = "\";
     linea1      = 0;
     linea2      = 0;
     cc          = 0;
     impre_valor = "";
     asc1        = 0;
     asc2        = 0;
     asc3        = 0;
     asc4        = 0;
     asc5        = 0;
     asc6        = 0;
     asc7        = 0;
     asc8        = 0;
     asc9        = 0;
     asc10       = 0;
     asc11       = 0;
     asc12       = 0;
     asc13       = 0;
     asc14       = 0;
     asc15       = 0;
     asc16       = 0;
     asc17       = 0;
     asc18       = 0;
     asc19       = 0;
     asc20       = 0;
     co_asc      = 0;
     d_asc       = 0;
     h_asc       = 0;
     longi       = 0;
     co_co       = 0;
     fec         = "";
     fecha       = @;

     pn          = 0;
     p           = "";
     pn1         = 0;
     pn2         = 0;
     pn3         = 0;
     pn4         = 0;
     pn5         = 0;
     pn6         = 0;
     pn7         = 0;
     pn8         = 0;
     pn9         = 0;
     t           = 0;

     &EURODB     = 0;

     aLong       = "";
     aCadena     = "";
     aCaracter   = "";

     nLong       = 0;
     nDecimal    = 0;
     nDec        = 0;
     nCaracter   = 0;
     nPos        = 0;

     &serie      = "";
     &factura    = "";
     &sw_quees   = 1;
     &reg        = 0;
     &reg1       = 0;
     &fech       = "";
     &descr      = "";
     &vari       = " ";
     &coma       = ",";
     &p1         = "";
     &p2         = "";
     &p3         = "";
     &p4         = "";
     &p5         = "";
     &p6         = "";
     &p7         = "";
     &p8         = "";
     &p9         = "";
     &p10        = 0;
     &pt1        = "";
     &pt2        = "";
     &pt3        = "";
     &pt4        = "";
     &pt5        = "";
     &pt6        = "";
     &pt7        = "";
     &pt8        = "";
     &pt9        = "";
     &pnt1       = 0;
     &pnt2       = 0;
     &pnt3       = 0;
     &pnt4       = 0;
     &pnt5       = 0;
     &pnt6       = 0;
     &pnt7       = 0;
     &pnt8       = 0;
     &pnt9       = 0;
     &sw         = 0;
     &ray1       = "";
     &ray2       = "";
     &linea      = 0;
     &activ1     = "";
     &licen1     = "";
     &domic1     = "";
     &pobla1     = "";
     &codpr1     = "";
     &activ2     = "";
     &licen2     = "";
     &domic2     = "";
     &pobla2     = "";
     &codpr2     = "";
     &activ3     = "";
     &licen3     = "";
     &domic3     = "";
     &pobla3     = "";
     &codpr3     = "";

     &hor        = "";
     &asi        = "";
     &aii        = "";
     &tea        = "";
     &tei        = "";
     &cru        = "";
     &teb        = "";
     &ted        = "";
     &vert       = "";
     &asd        = "";
     &aid        = "";
     &eaMoneda   = "";
     &enCanti    = 0;
     &enSwTrata  = 0;
|FIN;

|INCLUYE i_consul;

|PROCESO Mayusculas;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO Antes41; |TIPO 0;
 |SI #0#30 = "T";
     #0#41 = "R";
 |SINO;
     #0#41 = "F";
 |FINSI;
 |PINTA #0#41;
|FPRC;

|PROCESO PonFecha;
/*
  |SI #0#27 = 0;
      Fecha1  = ~;
      VAralf = Fecha1 % -102;
      #0#27   = VAralf;  |PINTA #0#27;
  |FINSI;
*/

  |SI #0#27 ] 80;
      VAralf = "01.01.19" + #0#27;
  |SINO;
      VAralf = "01.01.20" + (("00" + #0#27) % -102);
  |FINSI;
  Fecha1 = VAralf;

  |SI #0#27 ] 80;
      VAralf = "31.12.19" + #0#27;
  |SINO;
      VAralf = "31.12.20" + (("00" + #0#27) % -102);
  |FINSI;
  Fecha2 = VAralf;
|FPRC;

|PROCESO Seleccion;
  |HAZ PonFecha;

  #0#33 = Fecha1;   |PINTA #0#33;
  #0#34 = Fecha2;   |PINTA #0#34;
  #0#37 = Fecha1;   |PINTA #0#37;
  #0#38 = Fecha2;   |PINTA #0#38;

  |SI #0#0 = "S";
      |C_M #0#1, 1, "N";   #0#1 = 1;      |PINTA #0#1;
      |C_M #0#2, 1, "N";   #0#2 = 99999;  |PINTA #0#2;
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
  |SINO;
      |C_M #0#1, 1, "S";
      |C_M #0#2, 1, "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N";  #0XPara = 0;  |PINTA #0XPara;
      |SIGUE;
  |FINSI;

  |SI #0#30 = "T";
      |C_M #0#33, 1, "N";
      |C_M #0#34, 1, "N";
      |C_M #0#31, 1, "S";
      |C_M #0#32, 1, "S";
  |SINO;
      |C_M #0#33, 1, "S";
      |C_M #0#34, 1, "S";
      |C_M #0#31, 1, "N";  #0#31 = 1;  |PINTA #0#31;
      |C_M #0#32, 1, "N";  #0#32 = 4;  |PINTA #0#32;
  |FINSI;
|FPRC;

|PROCESO Fecha;|TIPO 0;
  |SI #0#33 < Fecha1;|O #0#33 > Fecha2;
       |MENAV "     La fecha no coincide con el a¤o seleccionado.";
       |ERROR;
  |FINSI;
  |SI #0#34 < Fecha1;|O #0#34 > Fecha2;
       |MENAV "     La fecha no coincide con el a¤o seleccionado.";
       |ERROR;
  |FINSI;
  |SI #0#33 > #0#34;
       |MENAV "     La fecha desde es mayor que la fecha hasta.";
       |ERROR;
  |FINSI;
|FPRC;

|PROCESO Actividad;
  |C_M #0#29, 1, "S";
  #0#29 = 6;
  |SI #0#28 = 0;
      |C_M #0#29, 1, "N";  #0#29 = 0;
  |FINSI;
  |PINTA #0#29;
|FPRC;

|PROCESO MiraVarMoneda;  |TIPO 7;
     |HAZ PintaMoneda;
     #0#40 = eaMoneda;

     |PINTA #0#40;
|FPRC;

|| ************************** Procesos para cargar caracteres en impresoras

|PROCESO &carga_asc;
  asc1  = 0; asc2  = 0; asc3  = 0; asc4  = 0; asc5  = 0;
  asc6  = 0; asc7  = 0; asc8  = 0; asc9  = 0; asc10 = 0;
  asc11 = 0; asc12 = 0; asc13 = 0; asc14 = 0; asc15 = 0;
  asc16 = 0; asc17 = 0; asc18 = 0; asc19 = 0; asc20 = 0;
  co_co = 0;
  |PARA co_asc = d_asc; |SI co_asc [ h_asc; |HACIENDO co_asc = co_asc + 1;
        co_co = co_co + 1;
        |SI #8co_asc ! 999;
            |SI co_co = 1;  asc1  = #8co_asc; |FINSI;
            |SI co_co = 2;  asc2  = #8co_asc; |FINSI;
            |SI co_co = 3;  asc3  = #8co_asc; |FINSI;
            |SI co_co = 4;  asc4  = #8co_asc; |FINSI;
            |SI co_co = 5;  asc5  = #8co_asc; |FINSI;
            |SI co_co = 6;  asc6  = #8co_asc; |FINSI;
            |SI co_co = 7;  asc7  = #8co_asc; |FINSI;
            |SI co_co = 8;  asc8  = #8co_asc; |FINSI;
            |SI co_co = 9;  asc9  = #8co_asc; |FINSI;
            |SI co_co = 10; asc10 = #8co_asc; |FINSI;
            |SI co_co = 11; asc11 = #8co_asc; |FINSI;
            |SI co_co = 12; asc12 = #8co_asc; |FINSI;
            |SI co_co = 13; asc13 = #8co_asc; |FINSI;
            |SI co_co = 14; asc14 = #8co_asc; |FINSI;
            |SI co_co = 15; asc15 = #8co_asc; |FINSI;
            |SI co_co = 16; asc16 = #8co_asc; |FINSI;
            |SI co_co = 17; asc17 = #8co_asc; |FINSI;
            |SI co_co = 18; asc18 = #8co_asc; |FINSI;
            |SI co_co = 19; asc19 = #8co_asc; |FINSI;
            |SI co_co = 20; asc20 = #8co_asc; |FINSI;
        |SINO;
            |SAL;
        |FINSI;
  |SIGUE;

  |SI asc1    = 0; |ACABA; |FINSI;

  impre_valor =               &asc1  + &asc2  + &asc3  + &asc4  + &asc5;
  impre_valor = impre_valor + &asc6  + &asc7  + &asc8  + &asc9  + &asc10;
  impre_valor = impre_valor + &asc11 + &asc12 + &asc13 + &asc14 + &asc15;
  impre_valor = impre_valor + &asc16 + &asc17 + &asc18 + &asc19 + &asc20;

  |IMPRIME impre_valor;
|FPRC;

|| ************************* Lectura Actividad

|PROCESO CargaActiv;
  Contador = 0;
  LaActiv  = 0;
  |SI #99#1 = 0;
      |PARA XPara1 = 1; |SI XPara1 [ 6; |HACIENDO XPara1 = XPara1 + 1;
            #6#0 = #99#0;
            #6#1 = XPara1;
            #6#2 = #99#2;
            |LIBERA #6; |LEE 110#6=;
            |SI FSalida = 0;
                Contador = Contador + 1;
                |SI Contador = 1;
                    LaActiv = #6#1;
                    activ1  = #6#7;
                    licen1  = #6#8;
                    domic1  = #6#9;
                    pobla1  = #6#10;
                    codpr1  = #6#40;
                |FINSI;
                |SI Contador = 2;
                    activ2 = #6#7;
                    licen2 = #6#8;
                    domic2 = #6#9;
                    pobla2 = #6#10;
                    codpr2 = #6#40;
                |FINSI;
                |SI Contador = 3;
                    activ3 = #6#7;
                    licen3 = #6#8;
                    domic3 = #6#9;
                    pobla3 = #6#10;
                    codpr3 = #6#40;
                |FINSI;
            |FINSI;
      |SIGUE;

      #6#0 = #99#0;
      #6#1 = LaActiv;
      #6#2 = #99#2;
      |LIBERA #6; |LEE 110#6=;
      FEstado = FSalida;
  |SINO;
      #6#0 = #99#0;
      #6#1 = #99#1;
      #6#2 = #99#2;
      |LIBERA #6; |LEE 110#6=;
      |SI FSalida = 0;
          LaActiv = #6#1;
          activ1  = #6#7;
          licen1  = #6#8;
          domic1  = #6#9;
          pobla1  = #6#10;
          codpr1  = #6#40;
      |FINSI;
  |FINSI;

  #3#0 = #6#16;
  |LEE 040#3=;    || Lee conceptos libros
  |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
|FPRC;

|| ************************* Impresion Diligencias

|PROCESO BorraVar;
  SwTempo     = 0;
  DActiv      = 0;
  HActiv      = 0;
  Tecla       = 0;
  Contador    = 0;
  LaActiv     = 0;
  pp          = 0;
  linealib    = 0;
  base_linea  = 0;
  Concep2     = 0;
  Concep6     = "";
  manolo      = 0;
  activida    = 0;
  act         = 0;
  swacum      = 0;
  DActiv      = 0;
  HActiv      = 0;
  TipoConc    = "";
  anyo1       = "";
  anyo2       = "";
  VAralf      = "";
  SwPrint     = 0;
  x           = 0;
  linea1      = 0;
  linea2      = 0;
  cc          = 0;
  impre_valor = "";
  pn          = 0;
  p           = "";
  pn1         = 0;
  pn2         = 0;
  pn3         = 0;
  pn4         = 0;
  pn5         = 0;
  pn6         = 0;
  pn7         = 0;
  pn8         = 0;
  pn9         = 0;
  t           = 0;
  serie       = "";
  factura     = "";
  sw_quees    = 1;
  reg         = 0;
  reg1        = 0;
  fech        = "";
  descr       = "";
  vari        = " ";
  coma        = ",";
  p1          = "";
  p2          = "";
  p3          = "";
  p4          = "";
  p5          = "";
  p6          = "";
  p7          = "";
  p8          = "";
  p9          = "";
  p10         = 0;
  pt1         = "";
  pt2         = "";
  pt3         = "";
  pt4         = "";
  pt5         = "";
  pt6         = "";
  pt7         = "";
  pt8         = "";
  pt9         = "";
  pnt1        = 0;
  pnt2        = 0;
  pnt3        = 0;
  pnt4        = 0;
  pnt5        = 0;
  pnt6        = 0;
  pnt7        = 0;
  pnt8        = 0;
  pnt9        = 0;
  sw          = 0;
  ray1        = "";
  ray2        = "";
  linea       = 0;
  activ1      = "";
  licen1      = "";
  domic1      = "";
  pobla1      = "";
  codpr1      = "";
  activ2      = "";
  licen2      = "";
  domic2      = "";
  pobla2      = "";
  codpr2      = "";
  activ3      = "";
  licen3      = "";
  domic3      = "";
  pobla3      = "";
  codpr3      = "";
|FPRC;

|PROCESO ImpreDilig;
  |INFOR "eosdilig";
  |SI FSalida = 0;
      |PRINT; |PIEINF;
      |PRINT; |PIEINF;
  |FINSI;
  |FININF;

  |INFOR "eosinput";
  |SI FSalida = 0;  |PRINT;  |PIEINF;  |FININF;  |FINSI;
|FPRC;

|| ************************ Impresion del Libro

|PROCESO CambiaNumero;
  eaMoneda  = #0#40;
  enCanti   = pn;
  enSwTrata = 1;
  |HAZ ConverMoneda;
  pn       = enCanti;
  p        = pn;  |QBF p;

  |SI #0#40 = "EUROS  ";
      aLong    = p % 0;
      nLong    = aLong;
      aCadena  = "";
      nDecimal = 0;
      nDec     = 0;
      |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
            nPos      = (100 * nCaracter) + 1;
            aCaracter = p % nPos;
            |SI nDecimal = 1;  nDec = nDec + 1;                    |FINSI;
            |SI aCaracter = ".";  aCaracter = ",";  nDecimal = 1;  |FINSI;
            aCadena = aCadena + aCaracter;
      |SIGUE;
      |SI nDec = 0;  aCadena = aCadena + ".00";  |FINSI;
      |SI nDec = 1;  aCadena = aCadena + "0";    |FINSI;
      p = aCadena;

      |SI pn > -10000;
          |SI pn [ 99999.99;
              |SI pn = 0;
                  |SI #8#4 = "N"; p = #8#91 + "        " + #8#91; |FINSI;
                  |SI #8#4 = "S"; p = "³" + "        " + "³"; |FINSI;
              |SINO;
                  p = "        " + p;
                  |SI #8#4 = "N"; p = #8#91 + (p % -108) + #8#91; |FINSI;
                  |SI #8#4 = "S"; p = "³" + (p % -108) + "³"; |FINSI;
              |FINSI;
          |SINO;
              p = "         " + p;
              |SI #8#4 = "N"; p = (p % -109) + #8#91; |FINSI;
              |SI #8#4 = "S"; p = (p % -109) + "³"; |FINSI;
          |FINSI;
      |SINO;
          p = "         " + p;
          |SI #8#4 = "N"; p = (p % -109) + #8#91; |FINSI;
          |SI #8#4 = "S"; p = (p % -109) + "³"; |FINSI;
      |FINSI;
  |FINSI;

  |SI #0#40 ! "EUROS  ";
      |SI pn > -10000000;
          |SI pn [ 99999999;
              |SI pn = 0;
                  |SI #8#4 = "N"; p = #8#91 + "        " + #8#91; |FINSI;
                  |SI #8#4 = "S"; p = "³" + "        " + "³"; |FINSI;
              |SINO;
                  p = "        " + p;
                  |SI #8#4 = "N"; p = #8#91 + (p % -108) + #8#91; |FINSI;
                  |SI #8#4 = "S"; p = "³" + (p % -108) + "³"; |FINSI;
              |FINSI;
          |SINO;
              p = "         " + p;
              |SI #8#4 = "N"; p = (p % -109) + #8#91; |FINSI;
              |SI #8#4 = "S"; p = (p % -109) + "³"; |FINSI;
          |FINSI;
      |SINO;
          p = "         " + p;
          |SI #8#4 = "N"; p = (p % -109) + #8#91; |FINSI;
          |SI #8#4 = "S"; p = (p % -109) + "³"; |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO importes;
  |SI linealib = 1; pn1 = pn1 + base_linea; |FINSI;
  |SI linealib = 2; pn2 = pn2 + base_linea; |FINSI;
  |SI linealib = 3; pn3 = pn3 + base_linea; |FINSI;
  |SI linealib = 4; pn4 = pn4 + base_linea; |FINSI;
  |SI linealib = 5; pn5 = pn5 + base_linea; |FINSI;
  |SI linealib = 6; pn6 = pn6 + base_linea; |FINSI;
  |SI linealib = 7; pn7 = pn7 + base_linea; |FINSI;
  |SI linealib = 8; pn8 = pn8 + base_linea; |FINSI;
  |SI linealib = 9; pn9 = pn9 + base_linea; |FINSI;
  p10 = pn1 + pn2 + pn3 + pn4 + pn5 + pn6 + pn7 + pn8 + pn9;

  pn = pn1; |HAZ CambiaNumero; p1 = p;
  pn = pn2; |HAZ CambiaNumero; p2 = p;
  pn = pn3; |HAZ CambiaNumero; p3 = p;
  pn = pn4; |HAZ CambiaNumero; p4 = p;
  pn = pn5; |HAZ CambiaNumero; p5 = p;
  pn = pn6; |HAZ CambiaNumero; p6 = p;
  pn = pn7; |HAZ CambiaNumero; p7 = p;
  pn = pn8; |HAZ CambiaNumero; p8 = p;
  pn = pn9; |HAZ CambiaNumero; p9 = p;
|FPRC;

|PROCESO importe2;
  manolo = 1;
  |SI linealib = 1; pnt1 = pnt1 + base_linea; |FINSI;
  |SI linealib = 2; pnt2 = pnt2 + base_linea; |FINSI;
  |SI linealib = 3; pnt3 = pnt3 + base_linea; |FINSI;
  |SI linealib = 4; pnt4 = pnt4 + base_linea; |FINSI;
  |SI linealib = 5; pnt5 = pnt5 + base_linea; |FINSI;
  |SI linealib = 6; pnt6 = pnt6 + base_linea; |FINSI;
  |SI linealib = 7; pnt7 = pnt7 + base_linea; |FINSI;
  |SI linealib = 8; pnt8 = pnt8 + base_linea; |FINSI;
  |SI linealib = 9; pnt9 = pnt9 + base_linea; |FINSI;

  pn = pnt1; |HAZ CambiaNumero; pt1 = p;
  pn = pnt2; |HAZ CambiaNumero; pt2 = p;
  pn = pnt3; |HAZ CambiaNumero; pt3 = p;
  pn = pnt4; |HAZ CambiaNumero; pt4 = p;
  pn = pnt5; |HAZ CambiaNumero; pt5 = p;
  pn = pnt6; |HAZ CambiaNumero; pt6 = p;
  pn = pnt7; |HAZ CambiaNumero; pt7 = p;
  pn = pnt8; |HAZ CambiaNumero; pt8 = p;
  pn = pnt9; |HAZ CambiaNumero; pt9 = p;
|FPRC;

|PROCESO importe3;
  pnt1 = pnt1 + pn1;
  pnt2 = pnt2 + pn2;
  pnt3 = pnt3 + pn3;
  pnt4 = pnt4 + pn4;
  pnt5 = pnt5 + pn5;
  pnt6 = pnt6 + pn6;
  pnt7 = pnt7 + pn7;
  pnt8 = pnt8 + pn8;
  pnt9 = pnt9 + pn9;

  pn = pnt1; |HAZ CambiaNumero; pt1 = p;
  pn = pnt2; |HAZ CambiaNumero; pt2 = p;
  pn = pnt3; |HAZ CambiaNumero; pt3 = p;
  pn = pnt4; |HAZ CambiaNumero; pt4 = p;
  pn = pnt5; |HAZ CambiaNumero; pt5 = p;
  pn = pnt6; |HAZ CambiaNumero; pt6 = p;
  pn = pnt7; |HAZ CambiaNumero; pt7 = p;
  pn = pnt8; |HAZ CambiaNumero; pt8 = p;
  pn = pnt9; |HAZ CambiaNumero; pt9 = p;
|FPRC;

|PROCESO LeeConc;
  |SI #6#50 = 1;
      #2#0 = Concep2;
      |LEE 040#2=;
      |SI FSalida ! 0;
          linealib = 0;
          |DDEFECTO #2;
      |SINO;
          linealib = #2#4;
      |FINSI;
      TipoConc = #2#3;
  |SINO;
      #12#0 = Concep6;
      |LEE 040#12=;
      |SI FSalida ! 0;
          linealib = 0;
          |DDEFECTO #12;
      |SINO;
          linealib = #12#4;
      |FINSI;
      TipoConc = #12#3;
  |FINSI;
|FPRC;

|PROCESO Chequeo1;
  Concep2 = #4#5;
  Concep6 = #4#72;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#7;  |HAZ importe2;  |FINSI;
  |FINSI;

  Concep2 = #4#33;
  Concep6 = #4#73;
  |HAZ LeeConc;

  |SI TipoConc = "S";
       |SI linealib ! 0;  base_linea = #4#23;  |HAZ importe2;  |FINSI;
  |FINSI;

  Concep2 = #4#34;
  Concep6 = #4#74;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#24;  |HAZ importe2;  |FINSI;
  |FINSI;

  Concep2 = #4#60;
  Concep6 = #4#75;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#45;  |HAZ importe2;  |FINSI;
  |FINSI;

  Concep2 = #4#61;
  Concep6 = #4#76;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#46;  |HAZ importe2;  |FINSI;
  |FINSI;

  Concep2 = #4#62;
  Concep6 = #4#77;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#47;  |HAZ importe2;  |FINSI;
  |FINSI;

  |SI manolo = 0; |ACABA; |FINSI;

  |SI #8#2 = "D";  serie   = #4#15;  factura = #4#16;  reg = reg + 1;  |FINSI;
  |SI #8#2 = "M";                                      reg = #4#1;     |FINSI;
  |SI #8#2 = "A";                                      reg = reg + 1;  |FINSI;

  |SI #4#20 = "S";
       reg1 = (reg + #4#21) - 1; reg = reg1;
  |SINO;
       reg1 = 0;
  |FINSI;
|FPRC;

|PROCESO Chequeo;
  Concep2 = #4#5;
  Concep6 = #4#72;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#7;  |HAZ importes;  manolo = 1;  |FINSI;
  |FINSI;

  Concep2 = #4#33;
  Concep6 = #4#73;
  |HAZ LeeConc;

  |SI TipoConc = "S";
       |SI linealib ! 0;  base_linea = #4#23;  |HAZ importes;  manolo = 1;  |FINSI;
  |FINSI;

  Concep2 = #4#34;
  Concep6 = #4#74;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#24;  |HAZ importes;  manolo = 1;  |FINSI;
  |FINSI;

  Concep2 = #4#60;
  Concep6 = #4#75;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#45;   |HAZ importes;  manolo = 1;  |FINSI;
  |FINSI;

  Concep2 = #4#61;
  Concep6 = #4#76;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#46;  |HAZ importes;  manolo = 1;  |FINSI;
  |FINSI;

  Concep2 = #4#62;
  Concep6 = #4#77;
  |HAZ LeeConc;

  |SI TipoConc = "S";
      |SI linealib ! 0;  base_linea = #4#47;  |HAZ importes;  manolo = 1;  |FINSI;
  |FINSI;
|FPRC;

|PROCESO AcuLibros;
  manolo = 0;
  |SI #0#30 = "F";
      |SI #4#13 < #0#33;  |HAZ Chequeo1;  |FINSI;
  |SINO;
      |SI #4#17 < #0#31;  |HAZ Chequeo1;  |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE PorTrimestre;
  #4#1;
  17, 19;
  #99#0, #99#2, 00000, 1,     DActiv;
  #99#0, #99#2, 32000, #0#31, HActiv;
  e;
  NULL, AcuLibros;
|FIN;

|DEFBUCLE PorFechas;
  #4#1;
  13, 19;
  #99#0, #99#2, 00000, Fecha1, DActiv;
  #99#0, #99#2, 32000, #0#33,  HActiv;
  ;
  NULL, AcuLibros;
|FIN;

|PROCESO Libro;
  pn1 = 0; pn2 = 0; pn3 = 0; pn4 = 0;
  pn5 = 0; pn6 = 0; pn7 = 0; pn8 = 0; pn9 = 0;
  manolo = 0;

  |HAZ Chequeo;

  |SI manolo = 1;
      #5#0 = #99#0; #5#1 = #4#3; #5#2 = 1;
      |LEE 040#5=;
      |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
      |SI #4#3 = 0;
          |SI #4#38 = "                              ";
              #5#4 = "AL CONTADO";
              #5#3 = "";
          |SINO;
              #5#4 = #4#38;
              #5#3 = #4#12;
          |FINSI;
      |FINSI;
      fech  = #4#4; descr = #4#6;

      |SI linea ] longi;
          sw = 1;  vari = "SUMA Y SIGUE"; |PRINT;
          sw = 10; FSalida = "PAGINA"; |PRINT; linea = 0; sw = 0; swacum = 0;
      |FINSI;
      vari = "   TOTAL";

      |SI swacum = 1; |HAZ importe3; |FINSI;

      |SI #8#2 = "D";  serie   = #4#15;  factura = #4#16;  reg = reg + 1;  |FINSI;
      |SI #8#2 = "M";                                      reg = #4#1;     |FINSI;
      |SI #8#2 = "A";                                      reg = reg + 1;  |FINSI;
      reg1 = 0;
      |SI #4#20 = "S"; reg1 = (reg + #4#21) - 1; |FINSI;

      t = pnt1 + pnt2 + pnt3 + pnt4 + pnt5 + pnt6 + pnt7 + pnt8 + pnt9;
      |SI t = 0;
          pn = pnt1; |HAZ CambiaNumero; pt1 = p;
          pn = pnt2; |HAZ CambiaNumero; pt2 = p;
          pn = pnt3; |HAZ CambiaNumero; pt3 = p;
          pn = pnt4; |HAZ CambiaNumero; pt4 = p;
          pn = pnt5; |HAZ CambiaNumero; pt5 = p;
          pn = pnt6; |HAZ CambiaNumero; pt6 = p;
          pn = pnt7; |HAZ CambiaNumero; pt7 = p;
          pn = pnt8; |HAZ CambiaNumero; pt8 = p;
          pn = pnt9; |HAZ CambiaNumero; pt9 = p;
      |FINSI;

      fecha = #4#13;
      |PRINT;

      |SI #4#20 = "S"; reg = reg1; |FINSI;

      |SI swacum = 0; |HAZ importe3; swacum = 1; |FINSI;

      SwPrint = 1; linea = linea + 3;
  |FINSI;
|FPRC;

|DEFBUCLE eoslinve;
  #4#1;
  17, 13, 19;
  #99#0, #99#2, 00000, #0#31, #0#33, DActiv;
  #99#0, #99#2, 32000, #0#32, #0#34, HActiv;
  ;
  NULL, Libro;
|FIN;

|DEFBUCLE eoslsFecha;
  #4#2;
  ;
  #99#0, #99#2, #0#31, DActiv, #0#33, 00000;
  #99#0, #99#2, #0#32, HActiv, #0#34, 32000;
  ;
  NULL, NULL, NULL, NULL, NULL, Libro;
  #4#13, #4#1;
|FIN;

|PROCESO Raya;
  |SI SwPrint ! 0;
      sw = 1; |PRINT;

      cc     = longi - linea - 1;
      linea2 = linea;
      linea  = 100 - cc;
      ray1   = guion * linea;
      sw     = 3; |PRINT;

      sw = 2;
      espacio = espa * linea;
      linea1 = longi - linea2 - 4;
      |PARA x = 0;|SI x < linea1;|HACIENDO x = x + 1;
           espacio = espacio + espa;
           ray2    = espacio + barra;
           |PRINT;
      |SIGUE;
  |FINSI;
|FPRC;

|PROCESO LeeControl;
  |ABRE #8;
  |LEE 040#8p;
  |SI FSalida ! 0;
      |MENAV "     No existe control de Libros";
      |ACABA;
  |FINSI;
  |CIERRA #8;

  |SI #8#4 = "S";
      hor  = "³";  asi  = "Ú";  aii  = "À";
      tea  = "Â";  tei  = "Ã";  cru  = "Å";
      teb  = "Á";  ted  = "´";  asd  = "¿";
      aid  = "Ù";  vert = "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
  |SINO;
      hor  = #8#91;  asi  = #8#91;  aii  = #8#91;
      tea  = #8#91;  tei  = #8#91;  cru  = #8#91;
      teb  = #8#91;  ted  = #8#91;  asd  = #8#91;
      aid  = #8#91;  vert = #8#90 * 20;
  |FINSI;
|FPRC;

|| ************************** Grabacion del Modelo 04

|PROCESO Graba04;
  |SI #8#89 = "N"; |ACABA; |FINSI;

  |ABRE #9;
  #9#0 = #99#0;
  #9#1 = LaActiv;
  #9#2 = #0#36;
  #9#3 = #99#2;
  |LIBERA #9;
  |LEE 140#9=;
  |SI FSalida = 0;
      #9#6  = #0#37;
      #9#7  = #0#38;
      #9#20 = 1;
      #9#21 = #99#6 - 1;
      #9#22 = reg;
      #9#23 = fecha;
      |GRABA 140#9a;
  |SINO;
      #9#0  = #99#0;
      #9#1  = LaActiv;
      #9#2  = #0#36;
      #9#3  = #99#2;
      #9#6  = #0#37;
      #9#7  = #0#38;
      #9#20 = 1;
      #9#21 = #99#6 - 1;
      #9#22 = reg;
      #9#23 = fecha;
      |GRABA 140#9n;
  |FINSI;
  |CIERRA #9;
|FPRC;

|| *********************** Proceso preparacion del libro

|PROCESO PreparaLibro;
  |PINDA #0#99;

  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

  |HAZ BorraVar;

  VAralf  = #99#0;   VAralf = ("00000" + #99#0) % -105;
  Fichero = VAralf;
  VAralf  = #99#2;   VAralf = ("00" + #99#2) % -102;
  Fichero = "v" + Fichero + VAralf;
  |NOME_DAT #4 Fichero;

  |HAZ CargaActiv;

  |SI #0#35 = "S"; |HAZ ImpreDilig;  |FINSI;

  DActiv = #99#1;
  HActiv = #99#1;
  |SI #99#1 = 0;  DActiv = 1;  HActiv = 6;  |FINSI;

  |SI #8#1 = "T";
      |SI #0#30 = "T";
          |BUCLE PorTrimestre;    || eoslinve
      |SINO;
          |BUCLE PorFechas;       || eoslinve
      |FINSI;
  |FINSI;

  activ1 = #6#6;
  Libro = #8#88;  |QBF Libro;
  Libro = Libro < Libro;
  |INFOR Libro;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |SI #0#41 = "F";
      |BUCLE eoslsFecha;
  |SINO;
      |BUCLE eoslinve;
  |FINSI;

  |SI SwPrint = 1;
      |HAZ Raya;
      |PIEINF;

      |HAZ Graba04;

      |SI #99#7 = "S";
          #6#47 = #99#6 - 1;
          |SI FEstado = 0; |GRABA 040#6a; |FINSI;
      |FINSI;
   |FINSI;
   |FININF;

   |SI #8#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;
|FPRC;

|DEFBUCLE eosw0044;
  #99#1;
  8;
  00000, 0, 00, "S";
  99999, 9, 99, "S";
  ;
  NULL, PreparaLibro;
|FIN;

|| ***************************** Preparacion del Temporal

|PROCESO GrabaTempo;
  #10#0 = #6#0;
  #10#4 = #0#27;
  |LEE 040#10=;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  #99#0 = #6#0;
  #99#1 = #6#1;
  |SI #0#28 = 0;  #99#1 = 0;  |FINSI;
  #99#2 = #0#27;
  |LIBERA #99;
  |LEE 140#99=;
  |SI FSalida = 0;  |ACABA;  |FINSI;

  SwTempo = 1;
  #99#0 = #6#0;
  #99#1 = #6#1;
  |SI #0#28 = 0;  #99#1 = 0;  |FINSI;
  #99#2 = #0#27;
  #99#3 = #6#3;
  #99#4 = #6#6;
  #99#5 = #6#47;
  #99#6 = #6#47 + 1;
  #99#7 = "S";
  #99#8 = "S";
  |GRABA 140#99n;
|FPRC;

|DEFBUCLE eosactiv;
  #6#1;
  15, 41;
  #0#1, DActiv, #0#27, "S",   " ";
  #0#2, HActiv, #0#27, "S", #0#39;
  ;
  NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja;
  #99#0 = 00001;
  #99#1 = 0;
  #99#2 = #0#27;
|FRUT;

|RUTINA ClaveAlta;
  #99#0 = 99999;
  #99#1 = 9;
  #99#2 = #0#27;
|FRUT;

|PROCESO Tipo3; |TIPO 3;      || EMPIEZA EL CALCULO
  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("L3" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #99 Fichero;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

  DActiv = #0#28;
  HActiv = #0#29;
  |SI #0#28 = 0; DActiv = 1;  HActiv = 9;  |FINSI;

  |IMPRE 0;
  |SI FSalida ! 0; |ACABA; |FINSI;

  |HAZ LeeControl;

  |SI #8#3 ! 3;
      longi = #8#7 - 27; |SI longi < 0; longi = 39; |FINSI;
      d_asc = 48;
      h_asc = 67;
      |HAZ carga_asc;
  |SINO;
      longi = #8#7 - #8#47;
      |SI longi < 0; longi = 39; |FINSI;
      d_asc = 48;
      h_asc = 67;
      |HAZ carga_asc;
  |FINSI;

  SwTempo = 0;

  |ABRE #10;
  |ABRE #99;
  |SI #0#0 = "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |SI #0XPara ! 0;
                #0#1 = #0XPara;
                #0#2 = #0XPara;
                |BUCLE eosactiv;
             |FINSI;
      |SIGUE;
  |SINO;
      |BUCLE eosactiv;
  |FINSI;
  |CIERRA #10;
  |CIERRA #99;

  |SI SwTempo = 0;
      |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
      |FINIMP;
      |ACABA;
  |FINSI;

  |ENTLINEAL #1#99, 3, 4, 20, 1, ClaveBaja, ClaveAlta;

  |ABRE #1;
  |ABRE #2;
  |ABRE #3;
  |ABRE #5;
  |ABRE #6;
  |ABRE #12;
  |BUCLE eosw0044;
  |CIERRA #1;
  |CIERRA #2;
  |CIERRA #3;
  |CIERRA #5;
  |CIERRA #6;
  |CIERRA #12;

  |SI #8#26 = "S"; d_asc = 68; h_asc = 87; |HAZ carga_asc; |FINSI;
  |FINIMP;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
|FPRC;

|| ****************************** Procesos del Temporal

|PROCESO Tipo11;  |TIPO 11;
  |SI FSalida ! 9;  |Y FSalida ! 10;  |ACABA;  |FINSI;

  Tecla = FSalida;

  |LIBERA #99;
  |LEE 140#99=;

  |SI Tecla = 9;
        |SI #99#8 = "N";
            #99#8 = "S";
        |SINO;
            #99#8 = "N";
            #99#6 = 0;
            #99#7 = "N";
        |FINSI;
  |FINSI;

  |SI Tecla = 10;
      #99#8 = "S";
      |C_M #99#6, 1, "S";
      |C_M #99#7, 1, "S";
      |ENCAMPO #6#99;
      |ENCAMPO #7#99;
  |FINSI;

  |PINTA #99#6;
  |PINTA #99#7;
  |PINTA #99#8;

  |GRABA 140#99a;

  |C_M #99#6, 1, "N";
  |C_M #99#7, 1, "N";
|FPRC;
