|FICHEROS;
    eosy0001 #0;
    eosclien #1;
    eosconce #2;
    eosconcd #3;
    eoslinve #4;
    eosclpre #5;
    eosactiv #6;
    eoscolib #8;
    eosconc6 #12;
    eosw0022 #21;
|FIN;

|VARIABLES;
     &EURODB     = 0;

     aCaracter   = "";
     aEntero     = "";
     aDecima     = "";

     nDecimal    = 0;
     nCaracter   = 0;
     nPos        = 0;

 TipoConc    = "";
 CalcIRPF    = 0;
 NConcepto   = "";
 anyo        = "";
 Concep2     = 0;
 Concep6     = "";
 Concepto    = "";

 campo1      = 0;
 campo2      = 0;
 campo3      = 0;
 campo4      = 0;
 campo5      = 0;
 campo6      = 0;
 campo7      = 0;
 campo8      = "";
 campo9      = "";
 campo10     = "";
 campo11     = "";
 campo12     = "";
 campo13     = "";
 campo14     = 0;

 varalf      = "";
 fec1        = @;
 fec2        = @;
 x           = 0;
 fec         = "";
 registro    = 0;

 Directorio    = "";
 NombreFichero = "";
 VariableCarga = "";
 NombreLis     = "";
 Bin           = "";
 Baffer        = 0;
 TotalLinea    = 0;
 LineasAnte    = 0;
 LineasPost    = 0;
 CuadroIni     = 0;
 CuadroFin     = 0;
 GruesoLis     = 0;
 LineaInicial  = 0;
 ColumInicial  = 0;
 ModoEdita     = 0;
 VarAlfaImport = "";
 VarNumeImport = 0;
 Digito1       = "";
 Digito2       = "";
 Digito3       = "";
 Digito4       = "";
 Len           = "";
 Leng          = 0;
 SwRecargo     = 0;
 SwRetencion   = 0;
 Cantidad1     = 0;
 Cantidad2     = 0;
 Cantidad3     = 0;
 Cantidad4     = 0;
 Cantidad5     = 0;
 Cantidad6     = 0;
 Cantidad7     = 0;
 Sombra        = "";
 Fondo         = "";
 Numerador     = 0;

     &eaMoneda   = "";
     &enCanti    = 0;
     &enSwTrata  = 0;
|FIN;

|INCLUYE i_ficher;

|PROCESO activida; |TIPO 0;
|ABRE #6;
#6#0 = #0#0;
#6#1 = #0#2;
#6#2 = #0#1;
|LEE 040#6=;
|SI FSalida ! 0;
    |MENAV "     No existe Actividad.";
    |ERROR;
    |ACABA;
|FINSI;

|SI #6#41 ! "S";
    |MENAV "     La Actividad no es Agraria.";
    |ERROR;
    |ACABA;
|FINSI;
|CIERRA #6;
|FPRC;

|PROCESO anyo;|TIPO 0;
|SI #0#1 ] 80;
    varalf = "01.01.19" + #0#1;
|SINO;
    varalf = "01.01.20" + (("00" + #0#1) % -102);
|FINSI;
fec1   = varalf;
#0#4   = fec1;

|SI #0#1 ] 80;
    varalf = "31.12.19" + #0#1;
|SINO;
    varalf = "31.12.20" + (("00" + #0#1) % -102);
|FINSI;
fec2   = varalf;
#0#5   = fec2;

|PINTA #0#4;
|PINTA #0#5;
|FPRC;

|PROCESO fecha;|TIPO 0;
|SI #0#4 < fec1;|O #0#4 > fec2;
     |MENAV "     La fecha no coincide con el a¤o seleccionado.";
     |ERROR;
|FINSI;
|SI #0#5 < fec1;|O #0#5 > fec2;
     |MENAV "     La fecha no coincide con el a¤o seleccionado.";
     |ERROR;
|FINSI;
|SI #0#4 > #0#5;
     |MENAV "     La fecha desde es mayor que la fecha hasta.";
     |ERROR;
|FINSI;
|FPRC;

|PROCESO que_selec; |TIPO 0;
|SI #0#3 = "F";
    #0#6 = 1;  |PINTA #0#6;
    #0#7 = 4;  |PINTA #0#7;
    |CAMPO_MODIFICA #0#4, 1, "S";
    |CAMPO_MODIFICA #0#5, 1, "S";
    |CAMPO_MODIFICA #0#6, 1, "N";
    |CAMPO_MODIFICA #0#7, 1, "N";
|SINO;
    #0#4 = fec1;  |PINTA #0#4;
    #0#5 = fec2;  |PINTA #0#5;
    |CAMPO_MODIFICA #0#4, 1, "N";
    |CAMPO_MODIFICA #0#5, 1, "N";
    |CAMPO_MODIFICA #0#6, 1, "S";
    |CAMPO_MODIFICA #0#7, 1, "S";
|FINSI;
|FPRC;

|PROCESO MiraVarMoneda;  |TIPO 7;
     |HAZ PintaMoneda;
     #0#8 = eaMoneda;

     |PINTA #0#8;
|FPRC;

|PROCESO LeeConce;
|SI #6#50 = 1;
    #2#0 = Concep2;
    |LEE 040#2=;
    |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

    #3#0 = Concep2;
    |LEE 040#3=;
    |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

    Concepto  = #2#0;
    campo8    = #3#1;
    campo9    = #3#2;
    campo10   = #3#3;
    campo11   = #3#4;
    campo12   = #3#5;
    campo13   = #3#6;
    campo14   = #3#7;

    NConcepto = #2#1;
    TipoConc  = #2#3;
    CalcIRPF  = #2#9;
|SINO;
    #12#0 = Concep6;
    |LEE 040#12=;
    |SI FSalida ! 0; |DDEFECTO #12; |FINSI;

    Concepto  = #12#0;
    campo8    = #12#11;
    campo9    = #12#12;
    campo10   = #12#13;
    campo11   = #12#14;
    campo12   = #12#15;
    campo13   = #12#16;
    campo14   = #12#17;

    NConcepto = #12#1;
    TipoConc  = #12#3;
    CalcIRPF  = #12#9;
|FINSI;
|FPRC;

|PROCESO graba_index;
registro = 1;
#21#0 = Concepto;
#21#1 = campo2;
#21#2 = "T";
|LIBERA #21;
|LEE 140#21=;
|SI FSalida = 0;
    #21#3 = #21#3 + campo7;
    |GRABA 140#21a;
|SINO;
    #21#0 = Concepto;
    #21#1 = campo2;
    #21#2 = "T";
    #21#3 = campo7;
    |GRABA 140#21n;
|FINSI;

#21#0 = Concepto;
#21#1 = campo5;
#21#2 = "R";
|LIBERA #21;
|LEE 140#21=;
|SI FSalida = 0;
    #21#3 = #21#3 + campo1;
    |GRABA 140#21a;
|SINO;
    #21#0 = Concepto;
    #21#1 = campo5;
    #21#2 = "R";
    #21#3 = campo1;
    |GRABA 140#21n;
|FINSI;
|FPRC;

|PROCESO MiraIndexado;
Concep2 = #4#5;
Concep6 = #4#72;
|HAZ LeeConce;
|SI TipoConc = "I";
    |SI CalcIRPF = 1; campo7 = #4#7;                |FINSI;
    |SI CalcIRPF = 2; campo7 = #4#7 + #4#9 + #4#11; |FINSI;
    campo1 = #4#7;
    campo2 = #4#39;
    campo3 = #4#42;
    campo5 = #4#10;
    campo6 = #4#11;
    campo4 = campo7 * campo14;
    |HAZ graba_index;
|FINSI;

Concep2 = #4#33;
Concep6 = #4#73;
|HAZ LeeConce;
|SI TipoConc = "I";
    |SI CalcIRPF = 1; campo7 = #4#23;                 |FINSI;
    |SI CalcIRPF = 2; campo7 = #4#23 + #4#27 + #4#31; |FINSI;
    campo1 = #4#23;
    campo2 = #4#40;
    campo3 = #4#43;
    campo5 = #4#29;
    campo6 = #4#31;
    campo4 = campo7 * campo14;
    |HAZ graba_index;
|FINSI;

Concep2 = #4#34;
Concep6 = #4#74;
|HAZ LeeConce;
|SI TipoConc = "I";
    |SI CalcIRPF = 1; campo7 = #4#24;                 |FINSI;
    |SI CalcIRPF = 2; campo7 = #4#24 + #4#28 + #4#32; |FINSI;
    campo1 = #4#24;
    campo2 = #4#41;
    campo3 = #4#44;
    campo5 = #4#30;
    campo6 = #4#32;
    campo4 = campo7 * campo14;
    |HAZ graba_index;
|FINSI;

Concep2 = #4#60;
Concep6 = #4#75;
|HAZ LeeConce;
|SI TipoConc = "I";
    |SI CalcIRPF = 1; campo7 = #4#45;                 |FINSI;
    |SI CalcIRPF = 2; campo7 = #4#45 + #4#51 + #4#57; |FINSI;
    campo1 = #4#45;
    campo2 = #4#66;
    campo3 = #4#69;
    campo5 = #4#54;
    campo6 = #4#57;
    campo4 = campo7 * campo14;
    |HAZ graba_index;
|FINSI;

Concep2 = #4#61;
Concep6 = #4#76;
|HAZ LeeConce;
|SI TipoConc = "I";
    |SI CalcIRPF = 1; campo7 = #4#46;                 |FINSI;
    |SI CalcIRPF = 2; campo7 = #4#46 + #4#52 + #4#58; |FINSI;
    campo1 = #4#46;
    campo2 = #4#67;
    campo3 = #4#70;
    campo5 = #4#55;
    campo6 = #4#58;
    campo4 = campo7 * campo14;
    |HAZ graba_index;
|FINSI;

Concep2 = #4#62;
Concep6 = #4#77;
|HAZ LeeConce;
|SI TipoConc = "I";
    |SI CalcIRPF = 1; campo7 = #4#47;                 |FINSI;
    |SI CalcIRPF = 2; campo7 = #4#47 + #4#53 + #4#59; |FINSI;
    campo1 = #4#47;
    campo2 = #4#68;
    campo3 = #4#71;
    campo5 = #4#56;
    campo6 = #4#59;
    campo4 = campo7 * campo14;
    |HAZ graba_index;
|FINSI;
|FPRC;

|DEFBUCLE eoslinve;
#4#1;
13, 17, 19;
#0#0, #0#1, 00001, fec1,    1, #0#2;
#0#0, #0#1, 32000, #0#5, #0#7, #0#2;
;
NULL, MiraIndexado;
|FIN;

|PROCESO Caratula;
|SI Concepto = "";
    VariableCarga = " Empresa : " + #0#0 + "  " + #1#2;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = " A¤o ....: " + #0#1;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;
|FINSI;

|SI SwRetencion = 1; |O SwRecargo = 1;
    SwRetencion = 0;
    SwRecargo   = 0;
    VariableCarga = "          ===========                        ==========";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad1;  |HAZ SeparaImporte;
    VariableCarga = "           " + VarAlfaImport;
    VarAlfaImport = Cantidad2;  |HAZ SeparaImporte;
    VariableCarga = VariableCarga + "                        " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad3;  |HAZ SeparaImporte;
    VariableCarga = "  RENDIMIENTO  " + campo14 + "  SOBRE  " + VarAlfaImport;
    VarNumeImport = (Cantidad3 * campo14) ! EURODB;
    VarAlfaImport = VarNumeImport;  |HAZ SeparaImporte;
    VariableCarga = VariableCarga + "  =  " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "*" * 57;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    Cantidad6  = Cantidad6 + Cantidad3;
    Cantidad7  = Cantidad7 + ((Cantidad3 * campo14) ! EURODB);
    Cantidad1  = 0;
    Cantidad2  = 0;
    Cantidad3  = 0;
|FINSI;

Concep2 = #21#0;
Concep6 = #21#0;
|HAZ LeeConce;

VariableCarga = "             < CONCEPTO : " + #21#0 + "  " + NConcepto; |QBF VariableCarga;
VariableCarga = VariableCarga + " >";

TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " ";
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " " + campo8;
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " " + campo9;
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " " + campo10;
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " " + campo11;
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " " + campo12;
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = " " + campo13;
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = "";
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

VariableCarga = "";
TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

Concepto = #21#0;
|FPRC;

|PROCESO resumen;
|SI Concepto ! #21#0; |HAZ Caratula; |FINSI;

|SI #21#2 = "R";
    |SI SwRetencion = 1;
        SwRetencion = 0;
        VariableCarga = "          ===========                        ==========";
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        VarAlfaImport = Cantidad1;  |HAZ SeparaImporte;
        VariableCarga = "           " + VarAlfaImport;
        VarAlfaImport = Cantidad2;  |HAZ SeparaImporte;
        VariableCarga = VariableCarga + "                        " + VarAlfaImport;
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        VariableCarga = "";
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        VariableCarga = "";
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        Cantidad1  = 0;
        Cantidad2  = 0;
    |FINSI;

    VarAlfaImport = #21#3; |HAZ SeparaImporte;
    VariableCarga = " IMPORTE : " + VarAlfaImport;
    VarAlfaImport = ("     " + #21#1) % -105;
    VariableCarga = VariableCarga + "   RECARGO ..: " + VarAlfaImport;
    VarNumeImport = (#21#3 % #21#1) ! EURODB;
    VarAlfaImport = VarNumeImport; |HAZ SeparaImporte;
    VariableCarga = VariableCarga + " %  " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;
    SwRecargo  = 1;
|FINSI;

|SI #21#2 = "T";
    |SI SwRecargo = 1;
        SwRecargo     = 0;
        VariableCarga = "          ===========                        ==========";
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        VarAlfaImport = Cantidad1;  |HAZ SeparaImporte;
        VariableCarga = "           " + VarAlfaImport;
        VarAlfaImport = Cantidad2;  |HAZ SeparaImporte;
        VariableCarga = VariableCarga + "                        " + VarAlfaImport;
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        VariableCarga = "";
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        VariableCarga = "";
        TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

        Cantidad1  = 0;
        Cantidad2  = 0;
    |FINSI;

    VarAlfaImport = #21#3; |HAZ SeparaImporte;
    VariableCarga = " IMPORTE : " + VarAlfaImport;
    VarAlfaImport = ("     " + #21#1) % -105;
    VariableCarga = VariableCarga + "   RETENCION : " + VarAlfaImport;
    VarNumeImport = (#21#3 % #21#1) ! EURODB;
    VarAlfaImport = VarNumeImport; |HAZ SeparaImporte;
    VariableCarga = VariableCarga + " %  " + VarAlfaImport;
    TotalLinea  = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;
    SwRetencion = 1;
|FINSI;

Cantidad1 = Cantidad1 + #21#3;
Cantidad2 = Cantidad2 + ((#21#3 % #21#1) ! EURODB);
|SI #21#2 = "T"; Cantidad3 = Cantidad3 + #21#3;                 |FINSI;
|SI #21#2 = "R"; Cantidad4 = Cantidad4 + ((#21#3 % #21#1) ! EURODB); |FINSI;
|SI #21#2 = "T"; Cantidad5 = Cantidad5 + ((#21#3 % #21#1) ! EURODB); |FINSI;
|FPRC;

|PROCESO SeparaImporte;    || Calculo para poner las comas en el importe
     eaMoneda  = #0#8;
     enCanti   = VarAlfaImport;
     enSwTrata = 1;
     |HAZ ConverMoneda;
     VarAlfaImport  = enCanti;

     |QBF VarAlfaImport;

     aDecima = "";
     aEntero = "";
     |SI #0#8 = "EUROS  ";
         Len      = VarAlfaImport % 0;
         Leng     = Len;
         nDecimal = 0;
         |PARA nCaracter = 1;  |SI nCaracter [ Leng;  |HACIENDO nCaracter = nCaracter + 1;
               nPos      = (100 * nCaracter) + 1;
               aCaracter = VarAlfaImport % nPos;
               |SI aCaracter = ".";
                   nDecimal = 1;
               |SINO;
                   |SI nDecimal = 0;
                       aEntero = aEntero + aCaracter;
                   |SINO;
                       aDecima = aDecima + aCaracter;
                   |FINSI;
               |FINSI;
         |SIGUE;
         aDecima = (aDecima + "00") % 102;
         VarAlfaImport = aEntero;
     |FINSI;

     Len           = VarAlfaImport % 0;
     Leng          = Len;
     VarAlfaImport = ("          " + VarAlfaImport) % -110;
     Digito1       = VarAlfaImport % -103;
     Digito2       = VarAlfaImport % -403;
     Digito3       = VarAlfaImport % -703;
     Digito4       = VarAlfaImport % -1001;

     |SI Leng ] 10;
         |SI Digito4 ! "-";
             VarAlfaImport = Digito4 + "." + Digito3 + "." + Digito2 + "." + Digito1;
         |SINO;
             VarAlfaImport = Digito4 + Digito3 + "." + Digito2 + "." + Digito1;
         |FINSI;
     |SINO;
         |SI Leng ] 7;
             |SI Digito3 ! "  -";
                 VarAlfaImport =  Digito3 + "." + Digito2 + "." + Digito1;
             |SINO;
                 VarAlfaImport =  Digito3 + Digito2 + "." + Digito1;
             |FINSI;
         |SINO;
             |SI Leng ] 4;
                 |SI Digito2 ! "  -";
                     VarAlfaImport = Digito2 + "." + Digito1;
                 |SINO;
                     VarAlfaImport = Digito2 + Digito1;
                 |FINSI;
             |SINO;
                 VarAlfaImport = Digito1;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#8 = "PESETAS";
         VarAlfaImport = ("          " + VarAlfaImport) % -110;
     |SINO;
         VarAlfaImport = ("          " + VarAlfaImport + "," + aDecima) % -110;
     |FINSI;
|FPRC;

|DEFBUCLE eosw0022;
#21#1;
;
"      ", 00.00, " ";
"zzzzzz", 99.99, "z";
;
NULL, resumen;
|FIN;

|PROCESO Prepara;
|DIMENSIONA  2000, Baffer, 0;

|DFICE Directorio;

NombreFichero = "";
NombreFichero = Usuario % 810; |QBF NombreFichero;
NombreFichero = (NombreFichero + "zzzzzzzz") % 108;
NombreFichero = Directorio + NombreFichero + ".txt";

|FBORRA NombreFichero;

TotalLinea    = 0;

|BUCLE eosw0022;

|SI SwRetencion = 1; |O SwRecargo = 1;
    SwRetencion = 0;
    SwRecargo   = 0;
    VariableCarga = "          ===========                        ==========";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad1;  |HAZ SeparaImporte;
    VariableCarga = "           " + VarAlfaImport;
    VarAlfaImport = Cantidad2;  |HAZ SeparaImporte;
    VariableCarga = VariableCarga + "                        " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad3;  |HAZ SeparaImporte;
    VariableCarga = "  RENDIMIENTO  " + campo14 + "  SOBRE  " + VarAlfaImport;
    VarNumeImport = (Cantidad3 * campo14) ! EURODB;
    VarAlfaImport = VarNumeImport;  |HAZ SeparaImporte;
    VariableCarga = VariableCarga + "  =  " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "*" * 57;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    Cantidad6  = Cantidad6 + Cantidad3;
    Cantidad7  = Cantidad7 + ((Cantidad3 * campo14) ! EURODB);
    Cantidad1  = 0;
    Cantidad2  = 0;
    Cantidad3  = 0;

    VariableCarga = "                < TOTALES GENERALES> ";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VariableCarga = "";
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad6;  |HAZ SeparaImporte;
    VariableCarga = "  TOTAL BASE IMPONIBLE : " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad4;  |HAZ SeparaImporte;
    VariableCarga = "  TOTAL RECARGO .......: " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad5;  |HAZ SeparaImporte;
    VariableCarga = "  TOTAL RETENCION .....: " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;

    VarAlfaImport = Cantidad7;  |HAZ SeparaImporte;
    VariableCarga = "  TOTAL RENDIMIENTO ...: " + VarAlfaImport;
    TotalLinea = TotalLinea + 1; |AL_BUF Baffer, TotalLinea, VariableCarga;
|FINSI;

LineasAnte   = 0;
LineasPost   = TotalLinea + 1;
CuadroIni    = 0513;
CuadroFin    = 2168;
NombreLis    = "Libro Agricultura       <F10> Por Impresora";
GruesoLis    = 57;
ModoEdita    = 2;
LineaInicial = 1;
ColumInicial = 1;

|GRABASECUENCIAL NombreFichero, Baffer, LineasAnte, TotalLinea;

Fondo = &219 * 80;

|PARA Numerador = 3; |SI Numerador [ 23; |HACIENDO Numerador = Numerador + 1;
      VarNumeImport = (Numerador * 100) + 1;
      |PINTA VarNumeImport, Fondo;
|SIGUE;

Sombra  = &176 * 58;
|PINTA 2314, Sombra;

Sombra  = &176 * 2;
|PARA Numerador = 5; |SI Numerador [ 23; |HACIENDO Numerador = Numerador + 1;
      VarNumeImport = (Numerador * 100) + 70;
      |PINTA VarNumeImport, Sombra;
|SIGUE;

|D_CUADRO 0412, 2269;

|EDITA Baffer, LineasAnte, LineasPost, CuadroIni, CuadroFin, ModoEdita, NombreLis, GruesoLis, LineaInicial, ColumInicial;

|FINDIM Baffer;

|FBORRA NombreFichero;
|FPRC;

|PROCESO impre; |TIPO 3;      || EMPIEZA EL CALCULO
|ABRE #8;
|LEE 040#8p;
|SI FSalida ! 0;
    |MENAV "     No existe control de Libros";
    |ACABA;
|FINSI;
|CIERRA #8;

fichero = #0#0;
fichero = "00000" + #0#0;
fichero = fichero % -105;
anyo    = #0#1;
anyo    = "00" + anyo;
anyo    = anyo % -102;
fichero = "v" + fichero + anyo;
|NOME_DAT #4fichero;

comienza = "22";
|HAZ fichero;
|NOME_DAT #21 fichero;
|ABRE #21; |CIERRA #21; |DELINDEX #21;

|ABRE #1;
#1#0 = #0#0;      || Leo Cliente
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;
|CIERRA #1;

|ABRE #6;
#6#0 = #0#0;      || Leo Actividad
#6#1 = #0#2;
#6#2 = #0#1;
|LEE 040#6=;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;
|CIERRA #6;

|ABRE #2;
|ABRE #3;
|ABRE #5;
|ABRE #12;
|ABRE #21;
|BUCLE eoslinve;
|CIERRA #21;

|SI registro = 0;
    |CIERRA #2;
    |CIERRA #3;
    |CIERRA #5;
    |CIERRA #12;
    |DELINDEX #21;
    |ACABA;
|FINSI;

Concepto = "";
|HAZ Prepara;

|CIERRA #5;
|CIERRA #2;
|CIERRA #3;
|CIERRA #12;

|ABRE #21; |CIERRA #21; |DELINDEX #21;
|FPRC;
