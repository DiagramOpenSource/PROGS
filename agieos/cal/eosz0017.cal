|FICHEROS;
     eosz0017 #0;
     eosm0017 #12;
     eosclien #7;
     eosm3390 #1;
|FIN;

|VARIABLES;
     aFichero  = "";

     nTecla    = 0;
     nRegistro = 0;
     nCampo    = 0;
     nCampo80  = 0;
     nCampo199 = 0;
     nCampo91  = 0;
     nCampo206 = 0;
     nCampo102 = 0;
     nCampo213 = 0;
     nResta1   = 0;
     nResta2   = 0;
     nResta3   = 0;
     nResta4   = 0;
     nResta5   = 0;
     nResta6   = 0;

     &d_empre  = 0;
     &h_empre  = 0;
     &el_anyo  = 0;
     &sw_sit   = 0;
     &Empresa  = 0;
|FIN;

|PROCESO TrataTempo;
     |SI nTecla = 11;
         d_empre  = #0#0;
         h_empre  = #0#0;
         el_anyo  = 99;
         sw_sit   = 1;
         |SUB_EJECUTA "eosp2390";
         #0#3 = "ARREGLADO";
         |GRABA 020#0a;
         |LIBERA #0;
         |PINTA #0#3;
     |FINSI;

     |SI nTecla = 12;
         |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE eosz0017;
     #0#1;
     ;
     00001, 1999;
     99999, 2999;
     be;
     NULL, TrataTempo;
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     nTecla = FSalida;

     d_empre  = #0#0;
     h_empre  = #0#0;
     el_anyo  = 99;
     sw_sit   = 1;

     |SI nTecla = 10;
         |LEE 101#0=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         d_empre  = #0#0;
         h_empre  = #0#0;
         el_anyo  = 99;
         sw_sit   = 1;
         |SUB_EJECUTA "eosp2390";
         #0#3 = "ARREGLADO";
         |GRABA 020#0a;
         |LIBERA #0;
         |PINTA #0#3;
         |ERROR;
     |FINSI;

     |SI nTecla = 11;
         |BUCLE eosz0017;
     |FINSI;

     |SI nTecla = 12;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "eosz0017";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         |BUCLE eosz0017;

         |PIEINF;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRC;

|PROCESO MiraError;
     nCampo = 0;
     |SI #1#78 = " ";  |Y #1#79 = "    ";
         nCampo = 1;
     |SINO;
         |SI #1#89 = " ";  |Y #1#90 = "    ";
             nCampo = 2;
         |SINO;
             |SI #1#100 = " ";  |Y #1#101 = "    ";
                 nCampo = 3;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nCampo = 0;  |ACABA;  |FINSI;

     |SI nCampo = 1;
         |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
             nCampo80  = (#12#20 + #12#31 + #12#42) ! 2;
             nCampo199 = (#12#21 + #12#32 + #12#43) ! 2;
         |SINO;
             nCampo80  = (#12#20 + #12#31) ! 2;
             nCampo199 = (#12#21 + #12#32) ! 2;
         |FINSI;
     |FINSI;

     |SI nCampo = 2;
         |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
             nCampo91  = (#12#20 + #12#31 + #12#42) ! 2;
             nCampo206 = (#12#21 + #12#32 + #12#43) ! 2;
         |SINO;
             nCampo91  = (#12#20 + #12#31) ! 2;
             nCampo206 = (#12#21 + #12#32) ! 2;
         |FINSI;
     |FINSI;

     |SI nCampo = 3;
         |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
             nCampo102 = (#12#20 + #12#31 + #12#42) ! 2;
             nCampo213 = (#12#21 + #12#32 + #12#43) ! 2;
         |SINO;
             nCampo102 = (#12#20 + #12#31) ! 2;
             nCampo213 = (#12#21 + #12#32) ! 2;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE eosm0017;
     #12#1;
     ;
     #7#0, 99, 1;
     #7#0, 99, 6;
     ;
     NULL, MiraError;
|FIN;

|PROCESO TrataEmpresa;
     |DDEFECTO #1;
     nCampo80  = 0;
     nCampo199 = 0;
     nCampo91  = 0;
     nCampo206 = 0;
     nCampo102 = 0;
     nCampo213 = 0;

     |BUCLE eosm0017;

     |ABRE #1;
     #1#0 = #7#0;
     #1#1 = 99;
     |LEE 040#1=;
     |SI FSalida ! 0;  |CIERRA #1;  |ACABA;  |FINSI;
     |CIERRA #1;

     nResta1 = nCampo80  - #1#80;
     nResta2 = nCampo199 - #1#199;
     nResta3 = nCampo91  - #1#91;
     nResta4 = nCampo206 - #1#206;
     nResta5 = nCampo102 - #1#102;
     nResta6 = nCampo213 - #1#213;

     |SI nResta1 = 0; |Y nResta2 = 0; |Y nResta3 = 0;
      |Y nResta4 = 0; |Y nResta5 = 0; |Y nResta6 = 0;
         |ACABA;
     |FINSI;

     #0#0 = #7#0;
     #0#1 = 1999;
     #0#2 = #7#2;
     #0#3 = "IMPORTES INCORRECTOS";
     |GRABA 020#0n;
     |LIBERA #0;

     nRegistro = 1;
|FPRC;

|DEFBUCLE eosclien;
     #7#1;
     ;
     00001;
     99999;
     ;
     NULL, TrataEmpresa;
|FIN;

|RUTINA ClaveBaja0;
     #0#0 = 1;
     #0#1 = 1999;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0 = 99999;
     #0#1 = 2999;
|FRUT;

|PROGRAMA;
    aFichero = ("z17" + Usuario + "zzzzzzzz") % 108;
    |NOME_DAT #0 aFichero;
    |ABRE #0;  |CIERRA #0;  |DELINDEX #0;

    |CLS;
    |CABEZA "Revision 390";
    |PINPA #0#0;

    nRegistro = 0;
    |ABRE #0;
    |BUCLE eosclien;
    |CIERRA #0;

    |SI nRegistro = 0;
        |MENAV "     No hay errores en el 390.";
        |DELINDEX #0;
        |ACABA;
    |FINSI;

    |ENTLINEAL #1#0, 1, 4, 22, 0, ClaveBaja0, ClaveAlta0;
    |CONFI "2400SDesea imprimir la relacion : ";
    |SI FSalida = 0;
        FSalida = 12;
        |HAZ Tipo11;
    |FINSI;

    |DELINDEX #0;
|FPRO;
