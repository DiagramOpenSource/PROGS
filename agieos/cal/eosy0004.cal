|FICHEROS;
     eosy0004 #0;
     eoscabve #1;
     eoslinve #2;
     eoscabco #3;
     eoslinco #4;
     eosactiv #5;
     eosw0035 #99;
|FIN;

|VARIABLES;
     SwLibro = 0;
     Linea   = 0;
     SwGraba = 0;
     VEmpresa = "";
     VAnyo    = "";
     Fichero  = "";
     SwImpre  = 0;
     CEmpresa = 0;
     CActivid = 0;
     Fecha1   = @;
     Fecha2   = @;
     VAralf   = "";
|FIN;

|INCLUYE i_consul;
|INCLUYE i_ficher;

|PROCESO Anyo; |TIPO 7;
Fecha1 = ~;
VAnyo  = Fecha1 % -102;
#0#2   = VAnyo;
|PINTA #0#2;
|FPRC;

|PROCESO PonFechas;
|SI #0#2 ] 80;
    VAralf = "01.01.19" + #0#2;  Fecha1 = VAralf;  #0#3 = Fecha1;  |PINTA #0#3;
    VAralf = "31.12.19" + #0#2;  Fecha2 = VAralf;  #0#4 = Fecha2;  |PINTA #0#4;
|SINO;
    VAralf = "01.01.20" + (("00" + #0#2) % -102);  Fecha1 = VAralf;  #0#3 = Fecha1;  |PINTA #0#3;
    VAralf = "31.12.20" + (("00" + #0#2) % -102);  Fecha2 = VAralf;  #0#4 = Fecha2;  |PINTA #0#4;
|FINSI;
|FPRC;

|PROCESO Fecha; |TIPO 0;
|SI #0#3 < Fecha1; |O #0#3 > Fecha2;
     |MENAV "     La fecha no coincide con el a¤o seleccionado.";
     |ERROR;
|FINSI;
|SI #0#4 < Fecha1;|O #0#4 > Fecha2;
     |MENAV "     La fecha no coincide con el a¤o seleccionado.";
     |ERROR;
|FINSI;
|SI #0#3 > #0#4;
     |MENAV "     La fecha desde es mayor que la fecha hasta.";
     |ERROR;
|FINSI;
|FPRC;

|PROCESO GrabaIndex;
|SI SwLibro = 1;
    #5#0     = #2#0;
    #5#1     = #2#19;
    #5#2     = #2#14;
    |LEE 040#5=;
    |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

    #99#0 = #2#0;
    #99#1 = #2#19;
    #99#2 = 99999;
    |LEE 040#99];
    |SI FSalida = 0;
        |LEE 040#99a;
    |SINO;
        |LEE 040#99u;
    |FINSI;
    |SI FSalida = 0; |Y #99#0 = #2#0; |Y #99#1 = #2#19;
        Linea = #99#2;
    |SINO;
        Linea = 0;
    |FINSI;

    |SI #2#5 ! 0; |O #2#72 ! "      ";
        Linea = Linea + 1;
        #99#0 = #2#0;
        #99#1 = #2#19;
        #99#2 = Linea;
        #99#3 = #2#13;
        |SI #5#50 = 1; #99#4 = #2#5;  |FINSI;
        |SI #5#50 = 2; #99#4 = #2#72; |FINSI;
        #99#5 = #2#35;
        #99#6 = #2#7;
        #99#7 = 0;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #2#33 ! 0; |O #2#73 ! "      ";
        Linea = Linea + 1;
        #99#0 = #2#0;
        #99#1 = #2#19;
        #99#2 = Linea;
        #99#3 = #2#13;
        |SI #5#50 = 1; #99#4 = #2#33;  |FINSI;
        |SI #5#50 = 2; #99#4 = #2#73; |FINSI;
        #99#5 = #2#36;
        #99#6 = #2#23;
        #99#7 = 0;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #2#34 ! 0; |O #2#74 ! "      ";
        Linea = Linea + 1;
        #99#0 = #2#0;
        #99#1 = #2#19;
        #99#2 = Linea;
        #99#3 = #2#13;
        |SI #5#50 = 1; #99#4 = #2#34;  |FINSI;
        |SI #5#50 = 2; #99#4 = #2#74; |FINSI;
        #99#5 = #2#37;
        #99#6 = #2#24;
        #99#7 = 0;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #2#60 ! 0; |O #2#75 ! "      ";
        Linea = Linea + 1;
        #99#0 = #2#0;
        #99#1 = #2#19;
        #99#2 = Linea;
        #99#3 = #2#13;
        |SI #5#50 = 1; #99#4 = #2#60;  |FINSI;
        |SI #5#50 = 2; #99#4 = #2#75; |FINSI;
        #99#5 = #2#63;
        #99#6 = #2#45;
        #99#7 = 0;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #2#61 ! 0; |O #2#76 ! "      ";
        Linea = Linea + 1;
        #99#0 = #2#0;
        #99#1 = #2#19;
        #99#2 = Linea;
        #99#3 = #2#13;
        |SI #5#50 = 1; #99#4 = #2#61;  |FINSI;
        |SI #5#50 = 2; #99#4 = #2#76; |FINSI;
        #99#5 = #2#64;
        #99#6 = #2#46;
        #99#7 = 0;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #2#62 ! 0; |O #2#77 ! "      ";
        Linea = Linea + 1;
        #99#0 = #2#0;
        #99#1 = #2#19;
        #99#2 = Linea;
        #99#3 = #2#13;
        |SI #5#50 = 1; #99#4 = #2#62;  |FINSI;
        |SI #5#50 = 2; #99#4 = #2#77; |FINSI;
        #99#5 = #2#65;
        #99#6 = #2#47;
        #99#7 = 0;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;
|FINSI;

|SI SwLibro = 2;
    #5#0     = #4#0;
    #5#1     = #4#19;
    #5#2     = #4#14;
    |LEE 040#5=;
    |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

    #99#0 = #4#0;
    #99#1 = #4#19;
    #99#2 = 99999;
    |LEE 040#99];
    |SI FSalida = 0;
        |LEE 040#99a;
    |SINO;
        |LEE 040#99u;
    |FINSI;
    |SI FSalida = 0; |Y #99#0 = #4#0; |Y #99#1 = #4#19;
        Linea = #99#2;
    |SINO;
        Linea = 0;
    |FINSI;

    |SI #4#5 ! 0; |O #4#72 ! "      ";
        Linea = Linea + 1;
        #99#0 = #4#0;
        #99#1 = #4#19;
        #99#2 = Linea;
        #99#3 = #4#13;
        |SI #5#50 = 1; #99#4 = #4#5;  |FINSI;
        |SI #5#50 = 2; #99#4 = #4#72; |FINSI;
        #99#5 = #4#35;
        #99#6 = 0;
        #99#7 = #4#7;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #4#33 ! 0; |O #4#73 ! "      ";
        Linea = Linea + 1;
        #99#0 = #4#0;
        #99#1 = #4#19;
        #99#2 = Linea;
        #99#3 = #4#13;
        |SI #5#50 = 1; #99#4 = #4#33; |FINSI;
        |SI #5#50 = 2; #99#4 = #4#73; |FINSI;
        #99#5 = #4#36;
        #99#6 = 0;
        #99#7 = #4#23;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;

    |SI #4#34 ! 0; |O #4#74 ! "      ";
        Linea = Linea + 1;
        #99#0 = #4#0;
        #99#1 = #4#19;
        #99#2 = Linea;
        #99#3 = #4#13;
        |SI #5#50 = 1; #99#4 = #4#34; |FINSI;
        |SI #5#50 = 2; #99#4 = #4#74; |FINSI;
        #99#5 = #4#37;
        #99#6 = 0;
        #99#7 = #4#24;
        |GRABA 040#99n;
        SwGraba = 1;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE eoslinve;
#2#2;
;
#1#0, #1#4, 01, 01, #0#3, 00000;
#1#0, #1#4, 99, 99, #0#4, 32000;
;
NULL, GrabaIndex;
|FIN;

|DEFBUCLE eoslinco;
#4#2;
;
#3#0, #3#4, 01, 01, #0#3, 00000;
#3#0, #3#4, 99, 99, #0#4, 32000;
;
NULL, GrabaIndex;
|FIN;

|PROCESO MiraLineas;
|SI SwLibro = 1;
    VEmpresa = #1#0;
    VEmpresa = ("00000" + VEmpresa) % -105;
    VAnyo    = #1#4;
    VAnyo    = ("00" + VAnyo) % -102;
    Fichero = "v" + VEmpresa + VAnyo;
    |NOME_DAT #2Fichero;
    |BUCLE eoslinve;
|FINSI;

|SI SwLibro = 2;
    VEmpresa = #3#0;
    VEmpresa = ("00000" + VEmpresa) % -105;
    VAnyo    = #3#4;
    VAnyo    = ("00" + VAnyo) % -102;
    Fichero = "c" + VEmpresa + VAnyo;
    |NOME_DAT #4Fichero;
    |BUCLE eoslinco;
|FINSI;
|FPRC;

|DEFBUCLE eoscabve;
#1#1;
;
#0#0, #0#2;
#0#1, #0#2;
;
NULL, MiraLineas;
|FIN;

|DEFBUCLE eoscabco;
#3#1;
;
#0#0, #0#2;
#0#1, #0#2;
;
NULL, MiraLineas;
|FIN;

|PROCESO Imprimir;
|SI SwImpre = 0;
    CEmpresa = #99#0;
    CActivid = #99#1;
    SwImpre  = 1;
|FINSI;

|SI CEmpresa ! #99#0; |O CActivid ! #99#1;
    |PIEINF;
    CEmpresa = #99#0;
    CActivid = #99#1;
|FINSI;

|PRINT;
|FPRC;

|DEFBUCLE eosw0035;
#99#2;
;
00000, 00, #0#3;
99999, 99, #0#4;
;
NULL, Imprimir;
|FIN;

|PROCESO Tipo3; |TIPO 3;
|IMPRE 0;
|SI FSalida ! 0; |ACABA; |FINSI;

|INFOR "eosy0004";
|SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

comienza = "35";
|HAZ fichero;
|NOME_DAT #99 fichero;
|ABRE #99; |CIERRA #99; |DELINDEX #99;

|ABRE #5;
|ABRE #99;
SwLibro = 1; |BUCLE eoscabve;
SwLibro = 2; |BUCLE eoscabco;
|CIERRA #5;
|CIERRA #99;

|SI SwGraba = 1;
    |BUCLE eosw0035;
    |PIEINF;
|FINSI;
|FININF;
|FINIMP;
|DELINDEX #99;
|FPRC;
