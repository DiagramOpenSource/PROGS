|FICHEROS;
   eosordcl #0;
   eoslinve #1;
   eosw0037 #2;
   eoscabve #3;
   eosm0012 #4;
|FIN;

|VARIABLES;
   XPara     = 0;

   lin       = 0;
   x         = 0;
   sw_pasada = 1;
   copiar    = "";
   anyo      = "";
   fichero   = "";
   fichero1  = "";
   fichero2  = "";
   fich      = "";
   fich1     = "";
   fich2      = "";
|FIN;

|CALCULO Mayor; |TIPO 0;
 #0Campo = #0Campo > " ";
 |PINTA #0Campo;
|FCAL;

|PROCESO lineas;
  sw_pasada = 1;
  lin = lin + 1;
  |PARA x = 0; |SI x [ 79; |HACIENDO x = x + 1;
        #2x = #1x;
  |SIGUE;

  #4#0 = #2#0;
  #4#1 = #2#14;
  #4#3 = #2#1;
  |PARA XPara = 1; |SI XPara [ 6; |HACIENDO XPara = XPara + 1;
        #4#2 = XPara;
        |LIBERA #4;
        |LEE 140#4=;
        |SI FSalida = 0;
            |SALVA_DATOS #4;
            |BORRA 140#4a;

            |REPON_DATOS #4;
            #4#3 = 60000 + lin;
            |GRABA 140#4n;
        |FINSI;
  |SIGUE;

  #2#1 = lin;
  |GRABA 041#2n;

  |PINTA 1946, #2#0;
  |PINTA 1962, #2#1;

  |SI #1#20 = "S"; lin = lin + (#1#21 - 1); |FINSI;
|FPRC;

|DEFBUCLE pasamelo;
  #1#1;
  ;
  #3#0, #3#4, 00001;
  #3#0, #3#4, 32000;
  e;
  NULL, NULL, NULL, NULL, NULL, lineas;
  #1#0, #1#17, #1#13, #1#1;
|FIN;

|DEFBUCLE pasamelo_1;
  #1#1;
  ;
  #3#0, #3#4, 00001;
  #3#0, #3#4, 32000;
  e;
  NULL, NULL, NULL, NULL, NULL, lineas;
  #1#0, #1#13, #1#1;
|FIN;

|PROCESO AlRollo;
  lin       = 0;
  sw_pasada = 0;

  fichero  = #3#0;
  fichero  = "00000" + fichero;
  fichero  = fichero % -105;
  anyo     = #3#4;
  anyo     = "00" + anyo;
  anyo     = anyo % -102;
  fichero  = fichero + anyo;
  fichero1 = "v" + fichero;
  fichero2 = "t" + fichero;

  |NOME_DAT #1 fichero1;
  |NOME_DAT #2 fichero2;

  |ABRE #2; |CIERRA #2; |DELINDEX #2;
  |ABRE #2;
  |SI #0#3 = "T";
      |BUCLE pasamelo;
  |SINO;
      |BUCLE pasamelo_1;
  |FINSI;
  |CIERRA #2;

  |SI sw_pasada ! 1; |ACABA; |FINSI;

  |DFICE fich;
  fich1 = fich + fichero1 + ".ixx";
  fich2 = fich + fichero2 + ".ixx";
  |COPIA_FICHERO fich2, fich1;
  |SI FSalida ! 0; |DELINDEX #2; |ACABA; |FINSI;

  fich1 = fich + fichero1 + ".dat";
  fich2 = fich + fichero2 + ".dat";
  |COPIA_FICHERO fich2, fich1;
  |SI FSalida ! 0;
      fich1 = fich + fichero1 + ".ixx";
      |FBORRA fich1;
      |DELINDEX #2;
      |ACABA;
  |FINSI;

  fich1 = fich + fichero1 + ".ddx";
  fich2 = fich + fichero2 + ".ddx";
  |COPIA_FICHERO fich2, fich1;

  |DELINDEX #2;
|FPRC;

|DEFBUCLE eoscabve;
  #3#1;
  ;
  #0#0, #0#2;
  #0#1, #0#2;
  ;
  NULL, AlRollo;
|FIN;

|PROCESO Renumera;
  |SALVA_DATOS #4;
  |BORRA 140#4a;
  |LIBERA #4;

  |REPON_DATOS #4;
  #4#3 = #4#3 - 60000;
  |GRABA 040#4n;
|FPRC;

|DEFBUCLE eosm0012;
  #4#1;
  ;
  00000, 00, 0, 60000;
  99999, 99, 9, 99999;
  be;
  NULL, Renumera;
|FIN;

|PROCESO pase; |TIPO 3;
  |ABRE #4;
  |BUCLE eoscabve;
  |CIERRA #4;

  |BUCLE eosm0012;
|FPRC;
