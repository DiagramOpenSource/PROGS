|FICHEROS;
    eosem332 #0;
    eosma332 #1;
    eosclien #2;
    eospant2 #3;
    eoshacie #4;
    eosdaban #5;
|FIN;

|VARIABLES;
    &enCmpPagina = 0;

    Valfa     = "";
    Raiz      = "";
    Handle    = "";
    Cadena    = "";

    LLeno40   = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
    Vacio40   = "                                        ";
    DEmpre    = 0;
    HEmpre    = 0;
    x         = 0;

    &dia      = "";
    &mes      = "";
    &anyo     = "";
    &sin      = "";

    &SwViene  = 0;
    &VEmpresa = 0;
    &VAnyo    = 0;
    &VPeriodo = 0;
    &VActiv   = 0;
    &eaMoneda = "";
    &enCanti  = 0;

    Comodin  = "";
    Comodin1 = "";
    Comodin2 = "";
    aAlfa    = "";
    &eaCamino   = "";


    Calc     = 0;
    Calc1    = 0;
    Calc2    = 0;

|FIN;

|INCLUYE i_seguim;
|INCLUYE i_cuadre;
|INCLUYE i_anyode;
|INCLUYE i_consul;

|PROCESO Mayus; |TIPO 0;
#0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO pinta_anyo; |TIPO 7;
|HAZ i_anyodef;
#0#25 = i_anyodef;
|PINTA #0#25;
|FPRC;

|PROCESO seleccion;
|SI #0#3 = "S";
    |PARA x = 4; |SI x [ 24; |HACIENDO x = x + 1;
          |C_M #0x, 1, "N";
          #0x = 0;
          |PINTA #0x;
    |SIGUE;
    |C_M #0#00, 1, "S";
    |C_M #0#01, 1, "S";
    |C_M #0#30, 1, "S";
|SINO;
    #0#0  = 00001; |PINTA #0#0;  |C_M #0#00, 1, "N";
    #0#1  = 99999; |PINTA #0#1;  |C_M #0#01, 1, "N";
    #0#30 = "C";   |PINTA #0#30; |C_M #0#30, 1, "N";

    |PARA x = 4; |SI x [ 24; |HACIENDO x = x + 1;
          |C_M #0x, 1, "S";
    |SIGUE;
|FINSI;
|FPRC;

|PROCESO MiraVarMoneda;  |TIPO 7;
     |HAZ PintaMoneda;
     #0#31 = eaMoneda;

     |SI #0#25 ] 80; |O #0#25 = 00;
         |SI #0#29 = "F"; #0#31 = "PESETAS"; |FINSI;
     |FINSI;
     |SI #0#25 = 1; |Y #0#26 [ 3;
         |SI #0#29 = "F"; #0#31 = "PESETAS"; |FINSI;
     |FINSI;

     |PINTA #0#31;
|FPRC;

|PROCESO impresio;
    |SI #0#30 = "C";
        #2#0 = #1#0;
        |LEE 040#2=;
        |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
    |FINSI;

    #5#0 = #1#0;
    |LEE 040#5=;
    |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

    #4#0 = #2#18;
    #4#1 = #2#19;
    |LEE 040#4=;
    |SI FSalida ! 0; |DDEFECTO #4; |FINSI;

    |SI #1#27 = 0; |Y #1#40 = 0; |Y #1#45 = 0; |Y #1#46 = 0; |Y #1#47 = 0;
     |Y #1#48 = 0; |Y #1#49 = 0; |Y #1#50 = 0;
        sin = "X";
    |SINO;
        sin = " ";
    |FINSI;

    |SI #0#29 = "F";
       |HAZ secuencial;
       se_empre = #1#0;
       se_ejerc = #1#4;
       se_perio = #1#2;
       se_tipos = 332;
       se_activ = #1#1 + 9;
       se_impor = #1#50;
       se_fecha = #0#2;
       se_factu = "N";
       |HAZ seguimie;
       |HAZ AlAgicli;

       #1#5 = #0#2;
       |GRABA 140#1a;
       |LIBERA #1;
       |ACABA;
    |FINSI;

|ET arriba1;
    |SI #0#29 = "O";
        |PINPA #0#3;
        #3#0 = #1#0;
        #3#1 = #2#2;
        #3#2 = "Coloque Impreso 332.      Pulse Tecla para Impresion";

        |PINTA #3#0;
        |PINTA #3#1;
        |ATRI P; |PINTA #3#2; |ATRI 0;
        |PAUSA;

        |INFOR "eosem332";
        |SI FSalida ! 0; |ACABA; |FINSI;
        |HAZ i_cuadre;
    |SINO;
        |INFOR "eoseb332";
        |SI FSalida ! 0; |ACABA; |FINSI;
    |FINSI;

    |PRINT;
    |PIEINF;
    |FININF;

    |SI #0#29 ! "O"; |ACABA; |FINSI;

    |CONFI "2400NDesea imprimirlo de nuevo : ";
    |SI FSalida = 0; |VETE arriba1; |FINSI;

    |CONFI "2400NDesea imprimir EL SOBRE : ";
    |SI FSalida = 0;
        |ET arriba2;
            |INFOR "eosso332";
            |SI FSalida ! 0; |ACABA; |FINSI;
            |PINPA #0#3;
            #3#0 = #1#0;
            #3#1 = #2#2;
            #3#2 = "Coloque SOBRE 332.      Pulse Tecla para Impresion";

            |PINTA #3#0;
            |PINTA #3#1;
            |ATRI P; |PINTA #3#2; |ATRI 0;
            |PAUSA;

            |HAZ i_cuadre;
            |PRINT;
            |PIEINF;
            |FININF;
            |CONFI "2400NDesea imprimirlo de nuevo : ";
            |SI FSalida = 0; |VETE arriba2; |FINSI;
    |FINSI;

se_empre = #1#0;
se_ejerc = #1#4;
se_perio = #1#2;
se_tipos = 332;
se_activ = #1#1 + 9;
se_impor = #1#50;
se_fecha = #0#2;
se_factu = "N";
|HAZ seguimie;
|HAZ AlAgicli;

#1#5 = #0#2;
|GRABA 140#1a;
|LIBERA #1;
|FPRC;

|DEFBUCLE eosma332;
#1#1;
6;
DEmpre, #0#27, #0#26, "M", #0#25, "N";
HEmpre, #0#28, #0#26, "T", #0#25, "N";
be;
NULL, impresio;
|FIN;

|PROCESO AlModelo;
DEmpre = #2#0;
HEmpre = #2#0;
|BUCLE eosma332;
|FPRC;

|DEFBUCLE eosclienN;
#2#3;
0;
Vacio40, #0#0;
LLeno40, #0#1;
e;
NULL, AlModelo;
|FIN;

|PROCESO impre;  |TIPO 3;
|SI #0#29 ! "F";
   |IMPRE 0;
   |SI FSalida ! 0; |ACABA; |FINSI;
|FINSI;

|HAZ fechapre;

|ABRE #4;
|ABRE #5;
|SI #0#30 = "N";
    |BUCLE eosclienN;
|SINO;
    |ABRE #2;
    |SI #0#3 = "S";
        DEmpre = #0#0;
        HEmpre = #0#1;
        |BUCLE eosma332;
    |SINO;
        |PARA x = 4; |SI x [ 24; |HACIENDO x = x + 1;
              |SI #0x ! 0;
                  DEmpre = #0x;
                  HEmpre = #0x;
                  |BUCLE eosma332;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #2;
|FINSI;

|CIERRA #4;
|CIERRA #5;
|SI #0#29 ! "F"; |FINIMP; |FINSI;
|FPRC;

|PROCESO fechapre;
dia  = #0#2 % 102;
anyo = #0#2 % -102;
mes  = #0#2 % 402;
|SI mes = "01"; mes = "Enero     "; |FINSI;
|SI mes = "02"; mes = "Febrero   "; |FINSI;
|SI mes = "03"; mes = "Marzo     "; |FINSI;
|SI mes = "04"; mes = "Abril     "; |FINSI;
|SI mes = "05"; mes = "Mayo      "; |FINSI;
|SI mes = "06"; mes = "Junio     "; |FINSI;
|SI mes = "07"; mes = "Julio     "; |FINSI;
|SI mes = "08"; mes = "Agosto    "; |FINSI;
|SI mes = "09"; mes = "Septiembre"; |FINSI;
|SI mes = "10"; mes = "Octubre   "; |FINSI;
|SI mes = "11"; mes = "Noviembre "; |FINSI;
|SI mes = "12"; mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO Redond17;
     eaMoneda = #0#31;
     enCanti  = Comodin;
     |HAZ ConverMoneda;

     |SI enCanti ] 0;
         Comodin = ("00000000000000000" + enCanti) % -117;
     |SINO;
         enCanti  = -enCanti;
         Comodin = "N" + (("0000000000000000" + enCanti) % -116);
     |FINSI;
|FPRC;

|PROCESO Redond16;
     eaMoneda = #0#31;
     enCanti  = Comodin;
     |HAZ ConverMoneda;

     |SI enCanti ] 0;
         Comodin = ("0000000000000000" + enCanti) % -116;
     |SINO;
         enCanti  = -enCanti;
         Comodin  = "N" + (("000000000000000" + enCanti) % -115);
     |FINSI;
|FPRC;

|PROCESO TomaPorcent;
   |QBF Comodin;
   Calc = Comodin;
   |SI Calc = 0;
       Comodin = "0000";
       |ACABA;
   |FINSI;

   Calc1 = (Calc - .5) ! 0;
   Calc2 = (Calc - Calc1) * 100;

   Comodin  = Calc1; Comodin = "00" + Comodin; Comodin = Comodin % -102;
   Comodin1 = Calc2; Comodin1 = "00" + Comodin1; Comodin1 = Comodin1 % -102;
   Comodin = Comodin + Comodin1;
|FPRC;

|PROCESO secuencial;
     |DBASE Comodin;
     |QBF Comodin;
     Comodin = Comodin + "hacienda";
     |MKDIR Comodin;
     Comodin = Comodin + "/internet";
     |MKDIR Comodin;
     Comodin = Comodin + "/332";
     |MKDIR Comodin;
     Comodin = Comodin + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Comodin;

     Comodin2 = "00000" + #1#0;
     Comodin2 = Comodin2 % -105;
     Comodin1 = Comodin2;

     Comodin2 = "00" + #1#4;
     Comodin2 = Comodin2 % -102;
     Comodin1 = Comodin1 + Comodin2;

     Comodin2 = #1#1;
     Comodin1 = Comodin1 + Comodin2;

     Comodin = Comodin + Comodin1 + ".txt";
     Comodin  = "wb  " + Comodin;

     Pos = -1;
     |FABRE Comodin;
     Handle = FSalida;
     |SI FSalida ] 0;
         Cadena = "332";
         |SI #0#31 = "PESETAS";
            Cadena = Cadena + "P";
         |SINO;
            Cadena = Cadena + "E";
         |FINSI;
         Comodin = #eosclien#1 % 0109;
         Cadena = Cadena + Comodin;
         Comodin = "00" + #eosma332#4; Comodin = Comodin % -102;
         Cadena = Cadena + Comodin;
         Comodin = "00" + #eosma332#2; Comodin = Comodin % -102;
         Cadena = Cadena + Comodin;

||       REGIMEN GENERAL

         |SI #1#7  = 0;  |Y #1#9  = 0;   #1#8  = 0;  |FINSI;
         |SI #1#10 = 0;  |Y #1#12 = 0;   #1#11 = 0;  |FINSI;
         |SI #1#13 = 0;  |Y #1#15 = 0;   #1#14 = 0;  |FINSI;
         |SI #1#16 = 0;  |Y #1#18 = 0;   #1#17 = 0;  |FINSI;
         |SI #1#19 = 0;  |Y #1#21 = 0;   #1#20 = 0;  |FINSI;
         |SI #1#22 = 0;  |Y #1#24 = 0;   #1#23 = 0;  |FINSI;

         Comodin = #eosma332#7; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#8; |HAZ TomaPorcent; Cadena = Cadena + Comodin;
         Comodin = #eosma332#9; |HAZ Redond17; Cadena = Cadena + Comodin;

         Comodin = #eosma332#10; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#11; |HAZ TomaPorcent; Cadena = Cadena + Comodin;
         Comodin = #eosma332#12; |HAZ Redond17; Cadena = Cadena + Comodin;

         Comodin = #eosma332#13; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#14; |HAZ TomaPorcent; Cadena = Cadena + Comodin;
         Comodin = #eosma332#15; |HAZ Redond17; Cadena = Cadena + Comodin;

||       RECARGO DE EQUIVALENCIA

         Comodin = #eosma332#16; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#17; |HAZ TomaPorcent; Cadena = Cadena + Comodin;
         Comodin = #eosma332#18; |HAZ Redond17; Cadena = Cadena + Comodin;

         Comodin = #eosma332#19; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#20; |HAZ TomaPorcent; Cadena = Cadena + Comodin;
         Comodin = #eosma332#21; |HAZ Redond17; Cadena = Cadena + Comodin;

         Comodin = #eosma332#22; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#23; |HAZ TomaPorcent; Cadena = Cadena + Comodin;
         Comodin = #eosma332#24; |HAZ Redond17; Cadena = Cadena + Comodin;

         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;
         Cadena = "";

||       ADQUISICIONES INTRACOMUNITARIAS

         Comodin = #eosma332#25; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#26; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#27; |HAZ Redond17; Cadena = Cadena + Comodin;

||       IVA SOPORTADO

         Calc = #eosma332#28 + #eosma332#36;
         Comodin = Calc;        |HAZ Redond17; Cadena = Cadena + Comodin;
         Calc = #eosma332#29 + #eosma332#37;
         Comodin = Calc;        |HAZ Redond17; Cadena = Cadena + Comodin;
         Calc = #eosma332#30 + #eosma332#38;
         Comodin = Calc;        |HAZ Redond17; Cadena = Cadena + Comodin;
         Calc = #eosma332#31 + #eosma332#39;
         Comodin = Calc;        |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#32; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#33; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#34; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#35; |HAZ Redond17; Cadena = Cadena + Comodin;

         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;
         Cadena = "";

         Comodin = #eosma332#40; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#41; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#42;
         Comodin  = Comodin % 0103; Comodin = "000" + Comodin; Comodin = Comodin % -103;
         Comodin1 = Comodin % 0402; Comodin1 = "00" + Comodin1; Comodin1 = Comodin1 % -102;
         Cadena = Cadena + Comodin + Comodin1;
         Comodin = #eosma332#43; |HAZ Redond17; Cadena = Cadena + Comodin;

         Comodin = #eosma332#44; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#45; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#46; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#47; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#68; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#48; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#49; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#50; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#51; |HAZ Redond17; Cadena = Cadena + Comodin;
         Comodin = #eosma332#52; |HAZ Redond17; Cadena = Cadena + Comodin;

         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;

         Cadena = " " * 250;
         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;

         Cadena = " " * 210;
         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;
     |FINSI;
     FSalida = Handle;
     |FCIERRA FSalida;

     |RMKDIR "/AEAT";
     |RMKDIR "/AEAT/INTERNET/";
     |RMKDIR "/AEAT/INTERNET/332/";
     aAlfa = ""; |IP_REMOTO aAlfa; |QBF aAlfa;
     |DBASE Comodin; |QBF Comodin;
     Comodin = Comodin + "hacienda/internet/332/";
     Comodin2 = Comodin;
     Comodin = Comodin + "*.txt"
     |_PDIR Comodin;
     |PARA; |SI FSalida ] 0; |HACIENDO;
        Comodin1 = "/AEAT/INTERNET/332/" + (Comodin - Comodin2);
        |SI aAlfa ! "";
           |ENVIA_FICHERO Comodin, Comodin1;
        |SINO;
           |COPIA_FICHERO Comodin, Comodin1;
        |FINSI;
        |_SDIR Comodin;
     |SIGUE;

     aAlfa =  "      Ficheros Generados. Situados en \AEAT\INTERNET\332 de su PC";
     |MENAV aAlfa;

     enCmpPagina = 32; |HAZ PideExplorer;
     |SI eaCamino ! "ERROR";
        Comodin1 = eaCamino + " "+ #eosem332#32; |QBF Comodin1;
        |RSYSTEM Comodin1;
     |FINSI;
|FPRC;

|PROGRAMA;
   |SI SwViene = 1;
      #0#0 = VEmpresa;
      #0#1 = VEmpresa;
      #0#3 = "S";
      #0#25 = VAnyo;
      #0#26 = VPeriodo;
      #0#27 = VActiv;
      #0#28 = VActiv;
      #0#29 = "O";
   |SINO;
      |CLS;
      |CABEZA "Emision modelo 332";
      |PINPA #0#0;
      |PINDA #0#0;
      |ENDATOS #1#0;
      |SI FSalida ! 0; |ACABA; |FINSI;
   |FINSI;
|FPRO;
