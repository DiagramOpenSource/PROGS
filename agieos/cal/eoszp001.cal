|FICHEROS;
   eoszp001 #0;
   eosactiv #1;
   eoslinve #3;
   eosconce #4;
   eosconc6 #14;
|FIN;

|VARIABLES;
    hay_libro = 0;
    ingresos  = 0;
    retencion = 0;
    anyo_ant  = 0;
    teorico   = 0;
    fichero   = "";
    anyo      = "";
|FIN;

|INCLUYE i_consul;

|PROCESO ventas;
hay_libro = 1;

|SI #1#50 = 1;
    #4#0 = #3#5;
    |LEE 040#4=;
    |SI FSalida = 0; |Y #4#3 = "I";
        ingresos = ingresos + #3#7;
    |FINSI;

    #4#0 = #3#33;
    |LEE 040#4=;
    |SI FSalida = 0; |Y #4#3 = "I";
        ingresos = ingresos + #3#23;
    |FINSI;

    #4#0 = #3#34;
    |LEE 040#4=;
    |SI FSalida = 0; |Y #4#3 = "I";
        ingresos = ingresos + #3#24;
    |FINSI;

    #4#0 = #3#60;
    |LEE 040#4=;
    |SI FSalida = 0; |Y #4#3 = "I";
        ingresos = ingresos + #3#45;
    |FINSI;

    #4#0 = #3#61;
    |LEE 040#4=;
    |SI FSalida = 0; |Y #4#3 = "I";
        ingresos = ingresos + #3#46;
    |FINSI;

    #4#0 = #3#62;
    |LEE 040#4=;
    |SI FSalida = 0; |Y #4#3 = "I";
        ingresos = ingresos + #3#47;
    |FINSI;
|SINO;
    #14#0 = #3#72;
    |LEE 040#14=;
    |SI FSalida = 0; |Y #14#3 = "I";
        ingresos = ingresos + #3#7;
    |FINSI;

    #14#0 = #3#73;
    |LEE 040#14=;
    |SI FSalida = 0; |Y #14#3 = "I";
        ingresos = ingresos + #3#23;
    |FINSI;

    #14#0 = #3#74;
    |LEE 040#14=;
    |SI FSalida = 0; |Y #14#3 = "I";
        ingresos = ingresos + #3#24;
    |FINSI;

    #14#0 = #3#75;
    |LEE 040#14=;
    |SI FSalida = 0; |Y #14#3 = "I";
        ingresos = ingresos + #3#45;
    |FINSI;

    #14#0 = #3#76;
    |LEE 040#14=;
    |SI FSalida = 0; |Y #14#3 = "I";
        ingresos = ingresos + #3#46;
    |FINSI;

    #14#0 = #3#77;
    |LEE 040#14=;
    |SI FSalida = 0; |Y #14#3 = "I";
        ingresos = ingresos + #3#47;
    |FINSI;
|FINSI;
retencion = retencion + #3#42 + #3#43 + #3#44 + #3#69 + #3#70 + #3#71;
|FPRC;

|DEFBUCLE eoslinve;
#3#1;
19;
#1#0, anyo_ant, 00000, #1#1;
#1#0, anyo_ant, 32000, #1#1;
;
NULL, ventas;
|FIN;

|PROCESO pon_letra;
hay_libro = 0;
ingresos  = 0;
retencion = 0;

fichero = #1#0;
fichero = "00000" + #1#0;
fichero = fichero % -105;
anyo    = anyo_ant;
anyo    = "00" + anyo;
anyo    = anyo % -102;
fichero = "v" + fichero + anyo;
|NOME_DAT #3fichero;

|ABRE #4;
|ABRE #14;
|BUCLE eoslinve;
|CIERRA #4;
|CIERRA #14;

|SI hay_libro = 0; #1#22 = "A"; |FINSI;
|SI hay_libro = 1;
    |SI #1#24 ! 1; #1#24 = 2; |FINSI;
    teorico = retencion / ingresos;
    |SI teorico < 0.70; #1#22 = "N"; |FINSI;
    |SI teorico ] 0.70;
        |SI #1#22 = "N"; #1#22 = "A"; |FINSI;
    |FINSI;
|FINSI;
|GRABA 140#1a;
|LIBERA #1;
|FPRC;

|DEFBUCLE eosactiv;
#1#1;
41;
#0#0, #0#2, #0#4, "S";
#0#1, #0#3, #0#4, "S";
be;
NULL, pon_letra;
|FIN;

|PROCESO tipo_3; |TIPO 3;
anyo_ant = #0#4 - 1;
|SI anyo_ant < 0;  anyo_ant = 99;  |FINSI;
|BUCLE eosactiv;
|FPRC;
