|FICHEROS;
    eosm0001 #1;
    eosm0002 #2;
    eosw0032 #3,MANTE;
|FIN;

|VARIABLES;
    Semanas       = 0;
    HastaSemana   = 0;
    FEstado       = 0;
    Campos        = 0;
    Nume          = 0;
    Modo          = 0;
    PesoSemana    = 0;
    PesoLunes     = 0;
    PesoMartes    = 0;
    PesoMiercoles = 0;
    PesoJueves    = 0;
    PesoViernes   = 0;
    PesoSabado    = 0;
    PesoDomingo   = 0;
    Situacion     = 0;

    VarAlfa  = "";
    Tabla    = "";

    || Dos primeros digitos el A¤o
    || Tercer.- Digito bisiesto S/N
    || Cuarto.- Primer dia de la primera semana
    || Quinto.- Ultimo dia ultima semana
    || Dos Ultimos numero de semanas.

    Tabla1  = "9416653";
    Tabla2  = "9517753";
    Tabla3  = "9601253";
    Tabla4  = "9713353";
    Tabla5  = "9814453";
    Tabla6  = "9915553";
    Tabla7  = "0006754";
    Tabla8  = "0111153";
    Tabla9  = "0212253";
    Tabla10 = "0313353";
    Tabla11 = "0404553";
    Tabla12 = "0516653";
    Tabla13 = "0617753";
    Tabla14 = "0711153";
    Tabla15 = "0802353";
    Tabla16 = "0914453";
    Tabla17 = "1015553";
    Tabla18 = "1116653";
    Tabla19 = "1207154";
    Tabla20 = "1312253";
    Tabla21 = "1413353";
    Tabla22 = "1514453";
|FIN;

|INCLUYE i_ficher;

|PROCESO CargaTabla; |TIPO 14;
Modo = (FEntrada / 100) ! 0;

|LEE 040#1=;
|SI FSalida = 0;
    Modo = -1;
|SINO;
    |SI Modo = 1;
        #1#2 = ""; |PINTA #1#2;
        #1#3 = 0;  |PINTA #1#3;
    |FINSI;
|FINSI;

|SI #1#1 = 1994; Tabla = Tabla1;  |FINSI;
|SI #1#1 = 1995; Tabla = Tabla2;  |FINSI;
|SI #1#1 = 1996; Tabla = Tabla3;  |FINSI;
|SI #1#1 = 1997; Tabla = Tabla4;  |FINSI;
|SI #1#1 = 1998; Tabla = Tabla5;  |FINSI;
|SI #1#1 = 1999; Tabla = Tabla6;  |FINSI;
|SI #1#1 = 2000; Tabla = Tabla7;  |FINSI;
|SI #1#1 = 2001; Tabla = Tabla8;  |FINSI;
|SI #1#1 = 2002; Tabla = Tabla9;  |FINSI;
|SI #1#1 = 2003; Tabla = Tabla10; |FINSI;
|SI #1#1 = 2004; Tabla = Tabla11; |FINSI;
|SI #1#1 = 2005; Tabla = Tabla12; |FINSI;
|SI #1#1 = 2006; Tabla = Tabla13; |FINSI;
|SI #1#1 = 2007; Tabla = Tabla14; |FINSI;
|SI #1#1 = 2008; Tabla = Tabla15; |FINSI;
|SI #1#1 = 2009; Tabla = Tabla16; |FINSI;
|SI #1#1 = 2010; Tabla = Tabla17; |FINSI;
|SI #1#1 = 2011; Tabla = Tabla18; |FINSI;
|SI #1#1 = 2012; Tabla = Tabla19; |FINSI;
|SI #1#1 = 2013; Tabla = Tabla20; |FINSI;
|SI #1#1 = 2014; Tabla = Tabla21; |FINSI;
|SI #1#1 = 2015; Tabla = Tabla22; |FINSI;
|FPRC;

|PROCESO Actuali; |TIPO 2;
#1#3 = #1#3 +. #2#3;
|PINTA #1#3;
|FPRC;

|PROCESO PesoDiario; |TIPO 0;
#2#11 = #2#4 + #2#5 + #2#6 + #2#7 + #2#8 + #2#9 + #2#10;
|PINTA #2#11;
|FPRC;

|PROCESO PonModificables; |TIPO 7;
|C_M #2#4,  1, "S";  |C_M #2#5,  1, "S";  |C_M #2#6,  1, "S";
|C_M #2#7,  1, "S";  |C_M #2#8,  1, "S";  |C_M #2#9,  1, "S";
|C_M #2#10, 1, "S";
|FPRC;

|PROCESO PrimeraSemana; |TIPO 7;
|SI #2#2 ! 1; |ACABA; |FINSI;

VarAlfa = Tabla % 401;
Nume    = VarAlfa;
Nume    = Nume + 3;
|PARA Campos = 4; |SI Campos < Nume; |HACIENDO Campos = Campos + 1;
      #2Campos = 0; |PINTA #2Campos;
      |C_M #2Campos, 1, "N";
|SIGUE;
|FPRC;

|PROCESO UltimaSemana; |TIPO 7;
|SI Situacion > 0; |ACABA; |FINSI;

VarAlfa = Tabla % 602;
Nume    = VarAlfa;
|SI #2#2 > Nume;
    |MENAV "     Ha sobrepasado el numero de semanas del a¤o.";
    |PTEC 807;
    |ACABA;
|FINSI;

|SI #2#2 ! Nume; |ACABA; |FINSI;

VarAlfa = Tabla % 501;
Nume = VarAlfa;
Nume = Nume + 4;
|PARA Campos = Nume; |SI Campos [ 10; |HACIENDO Campos = Campos + 1;
      #2Campos = 0; |PINTA #2Campos;
      |C_M #2Campos, 1, "N";
|SIGUE;
|FPRC;

|PROCESO GrabaLinea;
#2#0  = #1#0;
#2#1  = #1#1;
#2#2  = Semanas;
#2#3  = PesoSemana;
#2#4  = PesoLunes;
#2#5  = PesoMartes;
#2#6  = PesoMiercoles;
#2#7  = PesoJueves;
#2#8  = PesoViernes;
#2#9  = PesoSabado;
#2#10 = PesoDomingo;

|SI Semanas = 1;
    VarAlfa = Tabla % 401;
    Nume    = VarAlfa;
    Nume    = Nume + 3;
    |PARA Campos = 4; |SI Campos < Nume; |HACIENDO Campos = Campos + 1;
          #2Campos = 0;
    |SIGUE;
|FINSI;

|SI Semanas = HastaSemana;
    VarAlfa = Tabla % 501;
    Nume = VarAlfa;
    Nume = Nume + 4;
    |PARA Campos = Nume; |SI Campos [ 10; |HACIENDO Campos = Campos + 1;
          #2Campos = 0;
    |SIGUE;
|FINSI;

#2#11 = #2#4 + #2#5 + #2#6 + #2#7 + #2#8 + #2#9 + #2#10;

|SI FEstado ! 0; |GRABA 140#2n; |FINSI;
|SI FEstado = 0; |GRABA 140#2a; |FINSI;
|FPRC;

|PROCESO CreaCalen;
VarAlfa     = Tabla % 602;
HastaSemana =  VarAlfa;

|SI #3#0 = 000;
    |PARA Semanas = 1; |SI Semanas [ HastaSemana; |HACIENDO Semanas = Semanas + 1;
         #2#0 = #1#0;
         #2#1 = #1#1;
         #2#2 = Semanas;
         |LIBERA #2;
         |LEE 140#2=;
         FEstado = FSalida;

         PesoSemana    = #3#3;
         PesoLunes     = #3#4;
         PesoMartes    = #3#5;
         PesoMiercoles = #3#6;
         PesoJueves    = #3#7;
         PesoViernes   = #3#8;
         PesoSabado    = #3#9;
         PesoDomingo   = #3#10;
         |HAZ GrabaLinea;
    |SIGUE;
    |ACABA;
|FINSI;

|PARA Semanas = #3#1; |SI Semanas [ #3#2; |HACIENDO Semanas = Semanas + 1;
      #2#0 = #1#0;
      #2#1 = #1#1;
      #2#2 = Semanas;
      |LIBERA #2;
      |LEE 140#2=;
      FEstado = FSalida;

      |SI #3#3 !  -1; PesoSemana    = #3#3;  |SINO; PesoSemana    = #2#3;  |FINSI;
      |SI #3#4 !  -1; PesoLunes     = #3#4;  |SINO; PesoLunes     = #2#4;  |FINSI;
      |SI #3#5 !  -1; PesoMartes    = #3#5;  |SINO; PesoMartes    = #2#5;  |FINSI;
      |SI #3#6 !  -1; PesoMiercoles = #3#6;  |SINO; PesoMiercoles = #2#6;  |FINSI;
      |SI #3#7 !  -1; PesoJueves    = #3#7;  |SINO; PesoJueves    = #2#7;  |FINSI;
      |SI #3#8 !  -1; PesoViernes   = #3#8;  |SINO; PesoViernes   = #2#8;  |FINSI;
      |SI #3#9 !  -1; PesoSabado    = #3#9;  |SINO; PesoSabado    = #2#9;  |FINSI;
      |SI #3#10 ! -1; PesoDomingo   = #3#10; |SINO; PesoDomingo   = #2#10; |FINSI;
      |HAZ GrabaLinea;
|SIGUE;
|FPRC;

|DEFBUCLE eosw0032;
#3#1;
;
000;
999;
;
NULL, CreaCalen;
|FIN;

|PROCESO Calcular;
#1#3 = #1#3 + #2#3;
|FPRC;

|DEFBUCLE eosm0002;
#2#1;
;
#1#0, #1#1, 00;
#1#0, #1#1, 99;
;
NULL, Calcular;
|FIN;

|RUTINA ClaveBaja;
#3#0 = 0;
|FRUT;

|RUTINA ClaveAlta;
#3#0 = 999;
|FRUT;

|PROCESO Tipo5; |TIPO 5;
|SI Modo ! 1; |ACABA; |FINSI;

Modo      = 0;
|PUSHV 0501 2380;
comienza = "32";  |HAZ fichero;
|NOME_DAT #3 fichero;
|ABRE #3; |CIERRA #3; |DELINDEX #3;
#1#3 = 0;

|ENTLINEAL #1#3, 1, 1, 22, 1, ClaveBaja, ClaveAlta;
|BUCLE eosw0032;
|BUCLE eosm0002;

|DELINDEX #3;
|POPV;

|PINTA #1#3;

|SI Situacion = 0;
    |PTEC 815;
    |PTEC 815;
    |PTEC 814;
    |ACABA;
|FINSI;

#2#0 = #1#0;
#2#1 = #1#1;
#2#2 = 1;
|LIBERA #2;
|LEE 140#2=;
|PTEC 806;
|PTEC 802;
|FPRC;

|PROCESO Tipo11; |TIPO 11;
Situacion = 0;

|SI FSalida ! 9; |ACABA; |FINSI;

Situacion = 1;
Modo      = 1;  |HAZ Tipo5;
Situacion = 0;
|PTEC 814;
|PTEC 814;
|PTEC 815;
|ERROR;
|FPRC;

|| ************************************************************************
||                          PROCESO DEL ENTLINEAL
|| ************************************************************************

|PROCESO Tipo000; |TIPO 7;
|C_M #3#1, 1, "S";
|C_M #3#2, 1, "S";

|SI #3#0 = 0; |Y Situacion = 1;
    |MENAV "      Referencia valida solo en Alta.";
    |PTEC 807;
    |ACABA;
|FINSI;

|SI #3#0 ! 000; |ACABA; |FINSI;

#3#1 = 1;   |PINTA #3#1;  |C_M #3#1, 1, "N";
#3#2 = 54;  |PINTA #3#2;  |C_M #3#2, 1, "N";
|FPRC;

|PROCESO PesoBajoCero; |TIPO 0;
|SI #3#0 ! 0; |ACABA; |FINSI;

|SI #3Campo = -1; #3Campo = 0; |PINTA #3Campo; |FINSI;
|FPRC;
