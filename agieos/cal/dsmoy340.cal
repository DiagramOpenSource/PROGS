|FICHEROS;
     dsmoy000;
     dsmom004;

     dsmo3401;
     dsmo3402;
     dsmo3403;
     dsmo3404;
     dsmo3405;

     dsmow014;

     dsmow584;
     dsmow585;
     dsmow586;
     dsmow587;
     dsmow588;

     eosclien;
|FIN;

|VARIABLES;
     aNombre     = "";
     aPathAfegir = "";
     aIPRemoto   = "";
     aBue        = "";
     aCinta      = "";
     aImpre      = "";
     aSalida     = "";
     aBasica     = "";
     aCodElec    = "";
     aEjecutable = "";

     nReg        = 0;
     nHandle     = 0;
     nHandleEjec = 0;
     nError      = 0;
     nHay        = 0;
     nHandleError = 0;
     nConta      = 0;

     &enPor100   = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO TraeTgz340;
     nError = 0;

     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida ] 0;  |ACABA;  |FINSI;

     aAlfa    = #dsmoy000#6;
     aAlfa    = aAlfa % -102;
     enError  = 0;
     aVersion = "01";

     |DBASS aBasica;  |QBT aBasica;
     aBasica = aBasica + "basica/";

     eaFOrigen  = aBasica + "patrones/z" + aAlfa + aVersion + "340.tgz";
     |XABRE "E", eaFOrigen, nHandleEjec;
     |SI FSalida < 0;
         aAlfa1 =  "      No existe el ejecutable z" + aAlfa + aVersion + "340.tgz pongase en contacto con su distribuidor";
         |MENAV aAlfa1;
         nError = 1;
         |ACABA;
     |FINSI;

     eaFDestino = eaPathEjecu + "z" + aAlfa + aVersion + "340.tgz";

     |HAZ CopiaFicheroIP;

     |RDESCOMPRIME eaFDestino;

     eaFDestino = (eaFDestino - ".tgz") + ".tar";
     |RDETAR eaFDestino, eaPathEjecu;

     |RFBORRA eaFDestino;
|FPRC;

|PROCESO LanzaPrograma;
     |HAZ TraeTgz340;
     |SI nError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     aAbre = eaPathEjecu + "imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD " + eaPathEjecu + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "echo off" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET CINTA=" + eaPathLanza + aCinta + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET IMPRE=" + eaPathLanza + aImpre + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "SET SALIDA=" + eaPathLanza + aSalida + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait " + aEjecutable +  &13 + &10;
     |XGRABA nHandle1, aAlfa;

     |XCIERRA nHandle1;

     |RSYSTEM aAbre;
|FPRC;

|PROCESO Registro341;
     |DDEFECTO #dsmow584;

     #dsmow584#1  = "1";
     #dsmow584#2  = "340";
     #dsmow584#3  = #dsmo3401#1;

     #dsmow584#4   = #eosclien#1;

     eaAlfa   = #eosclien#2;  |HAZ QuitaRaros;
     #dsmow584#5   = eaAlfa;

     #dsmow584#6  = "T";

     eaAlfa   = #eosclien#14;  |HAZ QuitaRarosTfno;
     #dsmow584#7   = eaAlfa;

     eaAlfa   = #eosclien#2;   |HAZ QuitaRaros;
     #dsmow584#8   = eaAlfa;

     #dsmow584#12 = "0000000000000";

     #dsmow584#10 = "";
     #dsmow584#11 = "";

     |SI #dsmom004#22 = "T";
         |SI #dsmo3401#2 = 3;   #dsmow584#13 = "1T";  nConta = 1;  |FINSI;
         |SI #dsmo3401#2 = 6;   #dsmow584#13 = "2T";  nConta = 2;  |FINSI;
         |SI #dsmo3401#2 = 9;   #dsmow584#13 = "3T";  nConta = 3;  |FINSI;
         |SI #dsmo3401#2 = 12;  #dsmow584#13 = "4T";  nConta = 4;  |FINSI;
     |SINO;
         #dsmow584#13 = ("00" + #dsmo3401#2) % -102;  nConta = #dsmo3401#2;
     |FINSI;

     #dsmow584#9  = "340" + #dsmow584#3 + (("00" + #dsmo3401#2) % -102) + (("0000" + nConta) % -104);

     nNume   = #dsmo3401#6;
     #dsmow584#14 = ("000000000" + nNume) % -109;

     enNume  = #dsmo3401#7;  |HAZ Conver17Signo;
     #dsmow584#15 = eaSigno + eaAlfa;

     enNume  = #dsmo3401#8;  |HAZ Conver17Signo;
     #dsmow584#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3401#9;  |HAZ Conver17Signo;
     #dsmow584#17 = eaSigno + eaAlfa;

     #dsmow584#20 = aCodElec;

     #dsmow584#22 = &13 + &10;

     aAlfa = "";

     |PARA nCampo = 1;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow584#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Registro342;
     nReg = nReg + 1;

     |DDEFECTO #dsmow585;

     #dsmow585#1  = "2";
     #dsmow585#2  = "340";
     #dsmow585#3  = #dsmo3401#1;

     #dsmow585#4   = #eosclien#1;

     |SI #dsmo3402#8 = "N";
         #dsmow585#5   = #dsmo3402#7;
     |SINO;
         #dsmow585#6   = #dsmo3402#7;
     |FINSI;

     eaAlfa  = #dsmo3402#9;  |HAZ QuitaRaros;  #dsmow585#7  = eaAlfa;

     #dsmow585#8  = #dsmo3402#10;
     #dsmow585#9  = #dsmo3402#11;
     eaAlfa  = #dsmo3402#12;  |HAZ QuitaRaros;  #dsmow585#10  = eaAlfa;

                         #dsmow585#11 = "E";
     |SI #dsmo3402#29 = "S";  #dsmow585#11 = "F";  |FINSI;

     #dsmow585#12 = #dsmo3402#13;

     |SI #dsmo3402#14 ! "01.01.0000";
         #dsmow585#13 = (#dsmo3402#14 % 704) + (#dsmo3402#14 % 402) + (#dsmo3402#14 % 102);
     |FINSI;

     |SI #dsmo3402#15 ! "01.01.0000";
         #dsmow585#14 = (#dsmo3402#15 % 704) + (#dsmo3402#15 % 402) + (#dsmo3402#15 % 102);
     |FINSI;

     nNume   = #dsmo3402#16 * 100;
     #dsmow585#15 = ("00000" + nNume) % -105;

     enNume  = #dsmo3402#17;  |HAZ Conver13Signo;
     #dsmow585#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3402#18;  |HAZ Conver13Signo;
     #dsmow585#17 = eaSigno + eaAlfa;

     enNume  = #dsmo3402#19;  |HAZ Conver13Signo;
     #dsmow585#18 = eaSigno + eaAlfa;

     enNume  = #dsmo3402#20;  |HAZ Conver13Signo;
     #dsmow585#19 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3402#21;  |HAZ QuitaRaros;  #dsmow585#20 = eaAlfa;

     #dsmow585#21 = nReg;

     eaAlfa  = ("00000000" + #dsmo3402#22) % -108;   #dsmow585#22 = eaAlfa;
     eaAlfa  = ("00" + #dsmo3402#23) % -102;         #dsmow585#23 = eaAlfa;

     #dsmow585#24 = #dsmo3402#24;
     #dsmow585#25 = #dsmo3402#25;
     #dsmow585#26 = #dsmo3402#26;

     nNume   = #dsmo3402#27 * 100;
     #dsmow585#27 = ("00000" + nNume) % -105;

     enNume  = #dsmo3402#28;  |HAZ Conver13Signo;
     #dsmow585#28 = eaSigno + eaAlfa;

     aAlfa = #dsmow585#20;  |QBF aAlfa;
     |SI aAlfa = "";
         |SI #dsmo3402#32 ! 0;
             #dsmow585#20 = "IMPORTE PERCIBIDO METALICO";
         |FINSI;

         |SI #dsmo3402#34 ! 0;
             #dsmow585#20 = "IMPORTE PERCIBIDO TRANSMISION INMUEBLE";
         |FINSI;
     |FINSI;

     #dsmow585#29 = #dsmo3402#30;
     |SI #dsmow585#29 = " ";  #dsmow585#29 = "0";  |FINSI;

     #dsmow585#30 = #dsmo3402#31;

     enNume  = #dsmo3402#32;  |HAZ Conver15;  #dsmow585#31 = eaAlfa;

     #dsmow585#32 = ("0000" + #dsmo3402#33) % -104;

     enNume  = #dsmo3402#34;  |HAZ Conver15;  #dsmow585#33 = eaAlfa;

     #dsmow585#34 = "0" * 8;
     #dsmow585#35 = "0" * 13;

     |SI #dsmo3402#36 ! 0;
         |SI #dsmo3402#35 ! "01.01.0000";
             #dsmow585#34 = (#dsmo3402#35 % 704) + (#dsmo3402#35 % 402) + (#dsmo3402#35 % 102);
         |FINSI;

         enNume  = #dsmo3402#36;  |HAZ Conver13;
         #dsmow585#35 = eaAlfa;
         #dsmow585#36 = #dsmo3402#37;
         #dsmow585#37 = #dsmo3402#38;
     |FINSI;

     #dsmow585#38 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow585#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3402;
     #dsmo3402#1;
     ;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 01, 000001;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 99, 999999;
     ;
     NULL, Registro342;
|FIN;

|PROCESO Registro343;
     nReg = nReg + 1;

     |DDEFECTO #dsmow586;

     #dsmow586#1  = "2";
     #dsmow586#2  = "340";
     #dsmow586#3  = #dsmo3401#1;

     #dsmow586#4   = #eosclien#1;

     |SI #dsmo3403#8 = "N";
         #dsmow586#5   = #dsmo3403#7;
     |SINO;
         #dsmow586#6   = #dsmo3403#7;
     |FINSI;

     eaAlfa  = #dsmo3403#9;  |HAZ QuitaRaros;  #dsmow586#7  = eaAlfa;

     #dsmow586#8  = #dsmo3403#10;
     #dsmow586#9  = #dsmo3403#11;
     eaAlfa  = #dsmo3403#12;  |HAZ QuitaRaros;  #dsmow586#10  = eaAlfa;

                         #dsmow586#11 = "R";
     |SI #dsmo3403#27 = "S";  #dsmow586#11 = "S";  |FINSI;

     #dsmow586#12 = #dsmo3403#13;

     |SI #dsmo3403#14 ! "01.01.0000";
         #dsmow586#13 = (#dsmo3403#14 % 704) + (#dsmo3403#14 % 402) + (#dsmo3403#14 % 102);
     |FINSI;

     |SI #dsmo3403#15 ! "01.01.0000";
         #dsmow586#14 = (#dsmo3403#15 % 704) + (#dsmo3403#15 % 402) + (#dsmo3403#15 % 102);
     |FINSI;

     nNume   = #dsmo3403#16 * 100;
     #dsmow586#15 = ("00000" + nNume) % -105;

     enNume  = #dsmo3403#17;  |HAZ Conver13Signo;
     #dsmow586#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3403#18;  |HAZ Conver13Signo;
     #dsmow586#17 = eaSigno + eaAlfa;

     enNume  = #dsmo3403#19;  |HAZ Conver13Signo;
     #dsmow586#18 = eaSigno + eaAlfa;

     enNume  = #dsmo3403#20;  |HAZ Conver13Signo;
     #dsmow586#19 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3403#21;  |HAZ QuitaRaros;  #dsmow586#20 = eaAlfa;

     #dsmow586#21 = nReg;

     eaAlfa  = ("000000000000000000" + #dsmo3403#22) % -118;   #dsmow586#22 = eaAlfa;
     eaAlfa  = ("00" + #dsmo3403#23) % -102;                   #dsmow586#23 = eaAlfa;

     #dsmow586#24 = #dsmo3403#24;
     #dsmow586#25 = #dsmo3403#25;

     enNume  = #dsmo3403#26;  |HAZ Conver13Signo;
     #dsmow586#26 = eaSigno + eaAlfa;

     #dsmow586#27 = "0" * 8;
     #dsmow586#28 = "0" * 13;

     |SI #dsmo3403#29 ! 0;
         |SI #dsmo3403#28 ! "01.01.0000";
             #dsmow586#27 = (#dsmo3403#28 % 704) + (#dsmo3403#28 % 402) + (#dsmo3403#28 % 102);
         |FINSI;

         enNume  = #dsmo3403#29;  |HAZ Conver13;
         #dsmow586#28 = eaAlfa;
         #dsmow586#29 = #dsmo3403#30;
         #dsmow586#30 = #dsmo3403#31;
     |FINSI;

     #dsmow586#32 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow586#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3403;
     #dsmo3403#1;
     ;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 01, 000001;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 99, 999999;
     ;
     NULL, Registro343;
|FIN;

|PROCESO Registro344;
     nReg = nReg + 1;

     |DDEFECTO #dsmow587;

     #dsmow587#1  = "2";
     #dsmow587#2  = "340";
     #dsmow587#3  = #dsmo3401#1;

     #dsmow587#4   = #eosclien#1;

     |SI #dsmo3404#8 = "N";
         #dsmow587#5   = #dsmo3404#7;
     |SINO;
         #dsmow587#6   = #dsmo3404#7;
     |FINSI;

     eaAlfa  = #dsmo3404#9;  |HAZ QuitaRaros;  #dsmow587#7  = eaAlfa;

     #dsmow587#8  = #dsmo3404#10;
     #dsmow587#9  = #dsmo3404#11;
     eaAlfa  = #dsmo3404#12;  |HAZ QuitaRaros;  #dsmow587#10  = eaAlfa;

                         #dsmow587#11 = "I";
     |SI #dsmo3404#28 = "S";  #dsmow587#11 = "J";  |FINSI;

     #dsmow587#12 = #dsmo3404#13;

     |SI #dsmo3404#14 ! "01.01.0000";
         #dsmow587#13 = (#dsmo3404#14 % 704) + (#dsmo3404#14 % 402) + (#dsmo3404#14 % 102);
     |FINSI;

     |SI #dsmo3404#15 ! "01.01.0000";
         #dsmow587#14 = (#dsmo3404#15 % 704) + (#dsmo3404#15 % 402) + (#dsmo3404#15 % 102);
     |FINSI;

     nNume   = #dsmo3404#16 * 100;
     #dsmow587#15 = ("00000" + nNume) % -105;

     enNume  = #dsmo3404#17;  |HAZ Conver13Signo;
     #dsmow587#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3404#18;  |HAZ Conver13Signo;
     #dsmow587#17 = eaSigno + eaAlfa;

     enNume  = #dsmo3404#19;  |HAZ Conver13Signo;
     #dsmow587#18 = eaSigno + eaAlfa;

     enNume  = #dsmo3404#20;  |HAZ Conver13Signo;
     #dsmow587#19 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3404#21;  |HAZ QuitaRaros;  #dsmow587#20 = eaAlfa;

     #dsmow587#21 = nReg;

     nNume   = #dsmo3404#22 ! 0;
     eaAlfa  = ("000" + nNume) % -103;     #dsmow587#22 = eaAlfa;

     enNume  = #dsmo3404#23;  |HAZ Conver13Signo;
     #dsmow587#23 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3404#24;  |HAZ QuitaRaros;  #dsmow587#24 = eaAlfa;

     enNume  = #dsmo3404#25;  |HAZ Conver13Signo;
     #dsmow587#25 = eaSigno + eaAlfa;

     |SI #dsmo3404#26 ! "01.01.0000";
         #dsmow587#26 = (#dsmo3404#26 % 704) + (#dsmo3404#26 % 402) + (#dsmo3404#26 % 102);
     |FINSI;

     eaAlfa  = #dsmo3404#27;  |HAZ QuitaRaros;  #dsmow587#27 = eaAlfa;

     #dsmow587#29 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow587#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3404;
     #dsmo3404#1;
     ;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 01, 000001;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 99, 999999;
     ;
     NULL, Registro344;
|FIN;

|PROCESO Registro345;
     nReg = nReg + 1;

     |DDEFECTO #dsmow588;

     #dsmow588#1  = "2";
     #dsmow588#2  = "340";
     #dsmow588#3  = #dsmo3401#1;

     #dsmow588#4   = #eosclien#1;

     |SI #dsmo3405#8 = "N";
         #dsmow588#5   = #dsmo3405#7;
     |SINO;
         #dsmow588#6   = #dsmo3405#7;
     |FINSI;

     eaAlfa  = #dsmo3405#9;  |HAZ QuitaRaros;  #dsmow588#7  = eaAlfa;

     #dsmow588#8  = #dsmo3405#10;
     #dsmow588#9  = #dsmo3405#11;
     eaAlfa  = #dsmo3405#12;  |HAZ QuitaRaros;  #dsmow588#10  = eaAlfa;

     #dsmow588#11 = "U";

     #dsmow588#12 = " ";

     |SI #dsmo3405#14 ! "01.01.0000";
         #dsmow588#13 = (#dsmo3405#14 % 704) + (#dsmo3405#14 % 402) + (#dsmo3405#14 % 102);
     |FINSI;

     |SI #dsmo3405#15 ! "01.01.0000";
         #dsmow588#14 = (#dsmo3405#15 % 704) + (#dsmo3405#15 % 402) + (#dsmo3405#15 % 102);
     |FINSI;

     nNume   = #dsmo3405#16 * 100;
     #dsmow588#15 = ("00000" + nNume) % -105;

     enNume  = #dsmo3405#17;  |HAZ Conver13Signo;
     #dsmow588#16 = eaSigno + eaAlfa;

     enNume  = #dsmo3405#18;  |HAZ Conver13Signo;
     #dsmow588#17 = eaSigno + eaAlfa;

     enNume  = #dsmo3405#19;  |HAZ Conver13Signo;
     #dsmow588#18 = eaSigno + eaAlfa;

     enNume  = 0;        |HAZ Conver13Signo;
     #dsmow588#19 = eaSigno + eaAlfa;

     eaAlfa  = #dsmo3405#20;  |HAZ QuitaRaros;  #dsmow588#20 = eaAlfa;

     #dsmow588#21 = nReg;
     #dsmow588#22 = #dsmo3405#21;
     #dsmow588#23 = #dsmo3405#22;
     #dsmow588#24 = #dsmo3405#23;

     eaAlfa  = ("000" + #dsmo3405#24) % -103;     #dsmow588#25 = eaAlfa;

     eaAlfa  = #dsmo3405#25;  |HAZ QuitaRaros;  #dsmow588#26 = eaAlfa;
     eaAlfa  = #dsmo3405#26;  |HAZ QuitaRaros;  #dsmow588#27 = eaAlfa;
     eaAlfa  = #dsmo3405#27;  |HAZ QuitaRaros;  #dsmow588#28 = eaAlfa;
     eaAlfa  = #dsmo3405#28;  |HAZ QuitaRaros;  #dsmow588#29 = eaAlfa;
     eaAlfa  = #dsmo3405#29;  |HAZ QuitaRaros;  #dsmow588#30 = eaAlfa;

     #dsmow588#32 = &13 + &10;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ 32;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow588#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|DEFBUCLE dsmo3405;
     #dsmo3405#1;
     ;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 01, 000001;
     #dsmo3401#0, #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, 99, 999999;
     ;
     NULL, Registro345
|FIN;

|PROCESO Lanza2014;
     eaFicheroPlano = "340" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaFicheroImpre = "340" + (("00000" + #dsmow014#0) % -105) + ".imp";
     eaFicheroSalid = "340" + (("00000" + #dsmow014#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #dsmow014#0) % -105) + ".txt";
     eaOpcion       = "3";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |ABRE #eosclien;
     #eosclien#0 = #dsmow014#0;
     |LEE 000#eosclien.=;
     |SI FSalida ! 0;  |DDEFECTO #eosclien;  |FINSI;
     |CIERRA #eosclien;

     |HAZ Registro341;

     nReg = 0;  |BUCLE dsmo3402;
     nReg = 0;  |BUCLE dsmo3403;
     nReg = 0;  |BUCLE dsmo3404;
     nReg = 0;  |BUCLE dsmo3405;

     |XCIERRA nHandle2;

     |CIERRA #dsmo3401;

     enEmpresa    = #dsmow014#0;
     eaNomEmpresa = #dsmow014#3;

     |HAZ PresentaPortal;

     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |SI enErrorPortal = 0;
             #dsmom004#9  = "X";
             #dsmom004#10 = #dsmoy000#7;
             #dsmom004#19 = "";
             #dsmom004#25 = "";
         |SINO;
             #dsmom004#9  = " ";
             #dsmom004#10 = "01.01.0000";
             #dsmom004#19 = "";
             #dsmom004#25 = "";
         |FINSI;

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO Lee3401;        || Creacion de Ficheros
     |ABRE #dsmo3401;
     #dsmo3401#0  = #dsmow014#0;
     #dsmo3401#1  = #dsmow014#1;
     #dsmo3401#2  = #dsmow014#2;
     #dsmo3401#3  = #dsmow014#5;
     #dsmo3401#4  = #dsmow014#7;
     #dsmo3401#5  = 0;
     |LEE 101#dsmo3401.=;
     |SI FSalida ! 0;
         |CIERRA #dsmo3401;
         |ACABA;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = 303;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;
         aCodElec = #dsmom004#19;
     |FINSI;
     |CIERRA #dsmom004;

     |QBF aCodElec;
     |SI aCodElec = "";
         aAlfa = "0000Empresa: " + #dsmow014#0 + " " + #dsmow014#3;  |QBF aAlfa;
         aAlfa = aAlfa + " le falta el codigo electronico del modelo 303.";
         |MENAV aAlfa;

         |ACABA;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0  = #dsmow014#0;
     #dsmom004#1  = #dsmow014#1;
     #dsmom004#2  = #dsmow014#2;
     #dsmom004#3  = #dsmow014#5;
     #dsmom004#4  = #dsmow014#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     |GRABA 020#dsmo3401.a;
     |LIBERA #dsmo3401;

     |HAZ Lanza2014;

     nHay = 1;
|FPRC;

|PROCESO QueHacemos340;
     |HAZ Lee3401;          || Creacion de los Ficheros Planos.
|FPRC;

|DEFBUCLE dsmow014C340;
     #dsmow014#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, QueHacemos340;
|FIN;

|DEFBUCLE dsmow014N340;
     #dsmow014#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, QueHacemos340;
|FIN;

|PROCESO Proceso340;
     |HAZ PreguntaPresentacion;
     |HAZ TraeTgzCobol;

     nHay = 0;

     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C340;
     |SINO;
         |BUCLE dsmow014N340;
     |FINSI;

     |SI nHay = 0;
         |MENAV "0000Seleccion vac¡a";
         |ACABA;
     |FINSI;

     |SI nHay = 0;  |ACABA;  |FINSI;

     |HAZ SacaErrorPtl;

     |SI enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Boton3401;
     |PTEC 824;
|FPRC;

|PROCESO Boton3402;
     |PTEC 825;
|FPRC;

|PROCESO Boton3403;
     |PTEC 827;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #dsmoy000#aFichero#;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #dsmow014#aFichero#;

     |ABRE #dsmoy000;
     |LEE 000#dsmoy000.p;
     |CIERRA #dsmoy000;

     eaPathLanza = "\MODELOS";                                 |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #dsmoy000#0;                   |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + #dsmoy000#6;                   |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + (("00" + #dsmoy000#4) % -102); |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     eaPathEjecu = "\MODELOS";                                 |RMKDIR eaPathEjecu;
     eaPathEjecu = eaPathEjecu + "\" + #dsmoy000#0;                   |RMKDIR eaPathEjecu;
     eaPathEjecu = eaPathEjecu + "\" + #dsmoy000#6;                   |RMKDIR eaPathEjecu;
     eaPathEjecu = eaPathEjecu + "\";

     enPor100       = 1;
     enSwTrata      = 0;
     nTecla         = 1;

     |HAZ Proceso340;
|FPRO;
