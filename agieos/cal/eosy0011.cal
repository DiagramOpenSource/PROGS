|FICHEROS;
     eosy0011 #0;
     eosclien #1;
     eosdaban #2;
     eoshacie #3;
     eosm0014 #14;
     eosm0028 #28;
     eosm0040 #30;
     eosm0044 #34;
     eosw0078 #78;
     eosw0079 #79;
     eosw0080 #80;
     eosw0081 #81,MANTE;
     eosm0042 #105;
     eosw0043 #104;
     eosm0045 #35;
     dsmoy000;

     eosaplic #100;
     eosclipr #103;
     :/agicli/def/agicontr #101;
|FIN;

|VARIABLES;
     nPeriodo     = 0;
     nCampoD      = 0;
     aLLeno40     = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     aVacio40     = "                                        ";
     aAlfa        = "";
     aAlfa1       = "";
     nSwLectura   = 0;
     aCadena      = "";
     aCaracter    = "";
     aLong        = "";
     nLong        = 0;
     nPos         = 0;
     Sw           = 0;
     aDComple     = " ";
     aHComple     = "z";
     aFichero     = "";
     aTipo        = "";
     SwError = 0;
     nCanal   = 0;
     nTotalP      = 0;
     nContador    = 0;
     nSwError     = 0;
     aTipoP       = "";
     nNume        = 0;
     nDRegis      = 0;
     nHRegis      = 0;
     nSwDeDonde   = 0;
     aPathFich    = "";
     aPathPan     = "";
     aFichOrigen  = "";
     aFichDestin  = "";
     aBase        = "";

     Just1 = 0;
     Just2 = 0;
     Just3 = 0;
     Just4 = 0;
     Just5 = 0;
     Just6 = 0;
     Just7 = 0;
     Just8 = 0;
     Just9 = 0;
     Just10 = 0;
     Primero = 0;

 {-1} aMenu     = "";
      aMenu1    = "1120";
      aMenu2    = "1";
      aMenu3    = "3";
      aMenu4    = "Papel Continuo (No mas de 25 Perceptores)";
      aMenu5    = "Presentacion Internet Colectivo          ";
      aMenu6    = "Presentacion Internet Individual         ";
      aMenu7    = "";
      aMenu8    = "";

 {-1} aMenuPap  = "";
      aMenuPap1 = "1450";
      aMenuPap2 = "1";
      aMenuPap3 = "2";
      aMenuPap4 = "Portada ";
      aMenuPap5 = "Hojas   ";

 {-1} aMenuCol  = "";
      aMenuCol1 = "1550";
      aMenuCol2 = "1";
      aMenuCol3 = "2";
      aMenuCol4 = "Datos del Presentador ";
      aMenuCol5 = "Creacion del Fichero  ";

 {-1} aMenuInd  = "";
      aMenuInd1 = "1650";
      aMenuInd2 = "1";
      aMenuInd3 = "3";
      aMenuInd4 = "Creacion del Fichero ";
      aMenuInd5 = "Validar Fichero      ";
      aMenuInd6 = "Enviar a Directorio Internet";

     &enEjercic   = 0;
     &dia         = "";
     &mes         = "";
     &anyo        = "";
     &enTHojas    = 0;
     &NumPagina   = 1;
     &SwInit      = 0;
     &Porcent     = 0;

     TotalArrend  = 0;
     TotalRendDin = 0;
     TotalReteDin = 0;
     TotalRendEsp = 0;
     TotalIngACta = 0;

     ConClaveA = 0;
     ConClaveB = 0;
     Percep    = 0;
     Reten     = 0;

     Devengo = 0;
     Nif = 0;
     NifAnt = "";
     RegisAnt = 0;
     Comodin = "";
     aSesion = "";
     Calc    = 0;
     aTipoEmi = "";
     aInternet = "";
     aOrigen   = "";
     aDestino  = "";
     nHandle   = 0;
     nHandle2  = 0;

     &ClaveRet = "";
     &NPag = 1;

     nNume1 = 0; nNume2 = 0; nNume3 = 0; nNume4 = 0; nNume5 = 0;
     nNume6 = 0; nNume7 = 0; nNume8 = 0; nNume9 = 0; nNume10 = 0;

      nBoton1      = 0;
      nBoton2      = 0;
      nBoton3      = 0;
      nBoton4      = 0;
      nBoton5      = 0;
      nBoton6      = 0;
      nBoton7      = 0;

      aF2          = "";
      aF3          = "";
      aF4          = "";
      aF5          = "";
      aF6          = "";
      aF7          = "";
      aF8          = "";
      aTecla       = "";
      aFicheroTxt  = "";
      aFicheroCar  = "";
      aPathLocal   = "";
      aIPRemoto    = "";
      aTercera     = "";
      aAbre        = "";

      nTecla         = 0;
      nEmpresa       = 0;

     &eaTipoE        = "";
     &eaTipoR        = "";
     &eaTipoP        = "";
     &eaTipoC        = "";
     &eaTipoA        = "";
     &eaTipoV        = "";
     &eaModoImpre    = "";
     &eaModelos      = "";
     &eaEjer         = "";
     &eaPeriodo      = "";
     &eaFichDatos    = "";
     &eaFichAuxil    = "";
     &eaFichError    = "";
     &enBuenos       = 0;
     &enMalos        = 0;
     &enValidacion   = 0;
     &eaInternet     = "";
     &enError        = 0;
     &eaPathEmision      = "";
     &eaPathLanza        = "";
     &eaPathExplorador   = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaOpcion           = "";
     &enErrorPortal      = 0;
     &eaFicheroImpre     = "";
     &eaFicheroSalid     = "";
     &eaFicheroError     = "";
     &enEmpresa          = 0;
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
|FIN;

|INCLUYE i_seguim;
|INCLUYE i_consul;
|INCLUYE i_laserc;

||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| CALCULOS DE LAS PANTALLAS
||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampoD = 2;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
               |C_M #0nCampoD, 1, "S";
         |SIGUE;
         |C_M #0#38, 1, "S";
     |SINO;
         |C_M #0#0,  1, "S";
         |C_M #0#1,  1, "S";
         |PARA nCampoD = 2;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
               |C_M #0nCampoD, 1, "N";
               #0nCampoD = 0;  |PINTA #0nCampoD;
         |SIGUE;
         |C_M #0#38, 1, "N";  #0#38 = 0;  |PINTA #0#38;
     |FINSI;
|FPRC;

|PROCESO Planilla;
     |SI #0#38 = 0;  |Y #0#0 = 0;
         |C_M #0#38, 1, "N";  #0#38 = 0;  |PINTA #0#38;
         |PARA nCampoD = 2;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
               |C_M #0nCampoD, 1, "S";
         |SIGUE;
     |SINO;
         |SI #0#0 = 0;
             |C_M #0#38, 1, "S";
             |PARA nCampoD = 2;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |C_M #0nCampoD, 1, "N";
                   #0nCampoD = 0;  |PINTA #0nCampoD;
             |SIGUE;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
               #0Campo = 0;  |C_M #0nCampoD, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
               |C_M #0nCampoD, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO CogeVarMoneda;  |TIPO 0;
     |HAZ PintaMoneda;
     #0#41 = eaMoneda;

     |SI #0#39 [ 2000;
         |SI #0#41 ! "PESETAS";
             |MENAV "0000 La Moneda debe ser PESETAS";
             |ERROR;
         |FINSI;
     |FINSI;

     |PINTA #0#41;
|FPRC;

||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| CALCULOS DE LA EMISION
||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ComparaSiglas;
    |QBF aAlfa;
    |SI aAlfa = "AL";  aAlfa = "ALAM ";  |FINSI;
    |SI aAlfa = "AD";  aAlfa = "ALDEA";  |FINSI;
    |SI aAlfa = "AP";  aAlfa = "APTOS";  |FINSI;
    |SI aAlfa = "AR";  aAlfa = "ARRAL";  |FINSI;
    |SI aAlfa = "AY";  aAlfa = "ARRY ";  |FINSI;
    |SI aAlfa = "AV";  aAlfa = "AVDA ";  |FINSI;
    |SI aAlfa = "BJ";  aAlfa = "BJADA";  |FINSI;
    |SI aAlfa = "BR";  aAlfa = "BRANC";  |FINSI;
    |SI aAlfa = "BO";  aAlfa = "BARRO";  |FINSI;
    |SI aAlfa = "BL";  aAlfa = "BLQUE";  |FINSI;
    |SI aAlfa = "CL";  aAlfa = "CALLE";  |FINSI;
    |SI aAlfa = "CJ";  aAlfa = "CLLJA";  |FINSI;
    |SI aAlfa = "CM";  aAlfa = "CMNO ";  |FINSI;
    |SI aAlfa = "CR";  aAlfa = "CTRA ";  |FINSI;
    |SI aAlfa = "CS";  aAlfa = "CSRIO";  |FINSI;
    |SI aAlfa = "CO";  aAlfa = "COL  ";  |FINSI;
    |SI aAlfa = "CN";  aAlfa = "CJTO ";  |FINSI;
    |SI aAlfa = "CT";  aAlfa = "CUSTA";  |FINSI;
    |SI aAlfa = "CH";  aAlfa = "CHLET";  |FINSI;
    |SI aAlfa = "ED";  aAlfa = "EDIFC";  |FINSI;
    |SI aAlfa = "EN";  aAlfa = "ENTD ";  |FINSI;
    |SI aAlfa = "ES";  aAlfa = "ESCAL";  |FINSI;
    |SI aAlfa = "EX";  aAlfa = "EXPLA";  |FINSI;
    |SI aAlfa = "EM";  aAlfa = "EXTRM";  |FINSI;
    |SI aAlfa = "ER";  aAlfa = "EXTRR";  |FINSI;
    |SI aAlfa = "GL";  aAlfa = "GTA  ";  |FINSI;
    |SI aAlfa = "GV";  aAlfa = "G.V. ";  |FINSI;
    |SI aAlfa = "GR";  aAlfa = "GRUPO";  |FINSI;
    |SI aAlfa = "JR";  aAlfa = "JDIN ";  |FINSI;
    |SI aAlfa = "LG";  aAlfa = "LUGAR";  |FINSI;
    |SI aAlfa = "MS";  aAlfa = "MASIA";  |FINSI;
    |SI aAlfa = "MC";  aAlfa = "MERC ";  |FINSI;
    |SI aAlfa = "MT";  aAlfa = "MONTE";  |FINSI;
    |SI aAlfa = "ML";  aAlfa = "MUELL";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PQ";  aAlfa = "PQUE ";  |FINSI;
    |SI aAlfa = "PD";  aAlfa = "PTDA ";  |FINSI;
    |SI aAlfa = "PJ";  aAlfa = "PSAJE";  |FINSI;
    |SI aAlfa = "PS";  aAlfa = "PASEO";  |FINSI;
    |SI aAlfa = "PZ";  aAlfa = "PLAZA";  |FINSI;
    |SI aAlfa = "PB";  aAlfa = "PBDO ";  |FINSI;
    |SI aAlfa = "PG";  aAlfa = "POLIG";  |FINSI;
    |SI aAlfa = "PR";  aAlfa = "PROL ";  |FINSI;
    |SI aAlfa = "PT";  aAlfa = "PNTE ";  |FINSI;
    |SI aAlfa = "PU";  aAlfa = "PTA  ";  |FINSI;
    |SI aAlfa = "RM";  aAlfa = "RAMAL";  |FINSI;
    |SI aAlfa = "RB";  aAlfa = "RBLA ";  |FINSI;
    |SI aAlfa = "RP";  aAlfa = "RAMPA";  |FINSI;
    |SI aAlfa = "RR";  aAlfa = "RIERA";  |FINSI;
    |SI aAlfa = "RC";  aAlfa = "RCON ";  |FINSI;
    |SI aAlfa = "RD";  aAlfa = "RONDA";  |FINSI;
    |SI aAlfa = "RU";  aAlfa = "RUA  ";  |FINSI;
    |SI aAlfa = "SC";  aAlfa = "SECT ";  |FINSI;
    |SI aAlfa = "SD";  aAlfa = "SENDA";  |FINSI;
    |SI aAlfa = "SB";  aAlfa = "SBIDA";  |FINSI;
    |SI aAlfa = "TO";  aAlfa = "TRRNT";  |FINSI;
    |SI aAlfa = "TR";  aAlfa = "TRVA ";  |FINSI;
    |SI aAlfa = "UR";  aAlfa = "URB  ";  |FINSI;
    |SI aAlfa = "VI";  aAlfa = "VIA  ";  |FINSI;
    |SI aAlfa = "VP";  aAlfa = "VIA  ";  |FINSI;
|FPRC;

|PROCESO Valor5;
     nCanti = nCanti ! 0;
     |SI nCanti ] 0;
         aSigno = " ";
         aCanti = nCanti;
         aCanti = ("00000" + aCanti) % -105;
     |SINO;
         aSigno = "N";
         nCanti = -nCanti;
         aCanti = nCanti;
         aCanti = (("00000" + aCanti) % -105);
     |FINSI;
|FPRC;

|PROCESO Valor9;
     nCanti = nCanti ! 0;
     |SI nCanti ] 0;
         aSigno = " ";
         aCanti = nCanti;
         aCanti = ("000000000" + aCanti) % -109;
     |SINO;
         aSigno = "N";
         nCanti = -nCanti;
         aCanti = nCanti;
         aCanti = (("000000000" + aCanti) % -109);
     |FINSI;
|FPRC;

|PROCESO Valor13;
     eaMoneda = #0#41;
     enCanti  = nCanti;
     |HAZ ConverMoneda;
     nCanti   = enCanti;

     |SI nCanti ] 0;
         aSigno = " ";
         aCanti = nCanti;
         aCanti = ("0000000000000" + aCanti) % -113;
     |SINO;
         aSigno = "N";
         nCanti = -nCanti;
         aCanti = nCanti;
         aCanti = (("0000000000000" + aCanti) % -113);
     |FINSI;
|FPRC;

|PROCESO Valor15;
     eaMoneda = #0#41;
     enCanti  = nCanti;
     |HAZ ConverMoneda;
     nCanti   = enCanti;

     |SI nCanti ] 0;
         aSigno = " ";
         aCanti = nCanti;
         aCanti = ("000000000000000" + aCanti) % -115;
     |SINO;
         aSigno = "N";
         nCanti = -nCanti;
         aCanti = nCanti;
         aCanti = (("000000000000000" + aCanti) % -115);
     |FINSI;
|FPRC;

|PROCESO QuitaComas;
     |QBF aAlfa;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = ",";  aCaracter = "";   |FINSI;
           |SI aCaracter = "";  aCaracter = &209; |FINSI;
           |SI aCaracter = "";  aCaracter = &209; |FINSI;
           |SI aCaracter = "";  aCaracter = &176; |FINSI;
           |SI aCaracter = "";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;
|FPRC;

|PROCESO GrabaDisketteC;
     |SI nSwDeDonde = 1;
         #81#48 = 0;
         |LEE 040#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#34 = 0;
             |MENAV "     Por favor haga la creacion de Diskette.";
             |ACABA;
         |FINSI;
     |SINO;
         #81#48 = 1;
         |LEE 040#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#31 = 0;
             |MENAV "     Por favor haga la creacion de Diskette.";
             |ACABA;
         |FINSI;
     |FINSI;

     aSesion    = "";
     Raiz       = "";  |DIRECTORIO Raiz;
     Directorio = "";  |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;  |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;
     |SYSTEM Valfa;

     Fichero    = "RTPA" + #0#39;
     NFichero   = Directorio + Fichero;          |QBF NFichero;

     aFichero  = "rt  "+ NFichero;
     |FABRE aFichero;
     |SI FSalida < 0;
         Valfa = "      [" + NFichero + "] inaccesible.";
         |MENAV  Valfa;
         |ACABA;
     |FINSI;
     |FCIERRA FSalida;

     Pos = -1;
     |PUSHV 0501 2380;
     |PINPA #1#104;

     E_sup  = 1;
     E_inf  = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

     Unidad = "A";
     Unidad = 0851 ? 0;
     |ATRI I;
     |PINTA 1616, "Introduzca un diskette formateado en D.O.S. ...";
     |ATRI i;
     |PINTA 2380, ".";
     |PAUSA;

     |ATRI P;
     |PINTA 1616, "                  Copiando ...                 ";
     |ATRI p;
     |PINTA 2380, ".";

     |SI enSwDirecta = 1;
         |POPV;
         eaTipoSec    = aTipoSec; eaTipoEmi    = "COPIA";
         eaUnidad     = Unidad;   eaFichCol    = "RTPA" + #0#39;
         |SUB_EJECUTA "eosz9999";
         |SI #eosy0011#39 ] 2001;
            eaTipoSec    = aTipoSec; eaTipoEmi    = "COPIA";
            eaUnidad     = Unidad;   eaFichCol    = "RTPA" + #0#39 + ".car";
            |SUB_EJECUTA "eosz9999";
         |FINSI;
         |ACABA;
     |FINSI;

     |QUE_SISTEMA Sistema;
     |SI Sistema ! "ESDOS";
         Valfa = Raiz + "bin/agcopiaa " + NFichero + " " + Unidad + ":";
         |SYSTEM Valfa;
         |SI #eosy0011#39 ] 2001;
            Valfa = Raiz + "bin/agcopiaa " + NFichero + ".car " + Unidad + ":";
            |SYSTEM Valfa;
         |FINSI;

         |ATRI P;
         |PINTA 1616, "           FICHERO COPIADO !!!!                 ";
         |ATRI p;
         |PINTA 2380, ".";
         |PAUSA;
     |SINO;
         Valfa1 = NFichero;
         Valfa2 = Unidad + ":" + Fichero;

         |COPIA_FICHERO Valfa1, Valfa2;
         |SI FSalida ! 0;
             Valfa3 = "Error [" + FSalida + "] en copia de ficheros ...";
             |PINTA 1616, Valfa3;
             |PINTA 2380, ".";
             |PAUSA;
         |SINO;
             |SI #eosy0011#39 ] 2001;
                Valfa1 = Valfa1 + ".car";
                |SI FSalida ! 0;
                   Valfa3 = "Error [" + FSalida + "] en copia de ficheros ...";
                   |PINTA 1616, Valfa3;
                   |PINTA 2380, ".";
                   |PAUSA;
                |SINO;
                   |COPIA_FICHERO Valfa1, Valfa2;
                |FINSI;
                |ATRI P;
                |PINTA 1616, "           FICHERO COPIADO !!!!                 ";
                |ATRI p;
                |PINTA 2380, ".";
                |PAUSA;
             |FINSI;
         |FINSI;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO DirInternet;
     aOrigen = "\MODELOS\180\" +  "RTPA" + #0#39 + ".txt";
     |XABRE "EC", aOrigen, nHandle;
     |SI FSalida ] 0;
         |MENAV "0000 El Fichero ha dado errores.";
         |ACABA;
     |FINSI;

     aOrigen = "\MODELOS\180\" +  "RTPA" + #0#39;
     |XABRE "EC", aOrigen, nHandle;
     |SI FSalida < 0;
         |MENAV "0000 No se ha validado.";
         |ACABA;
     |FINSI;

     aAlfa      = "/AEAT";                       |RMKDIR aAlfa;
     aAlfa      = "/AEAT/INTERNET";              |RMKDIR aAlfa;
     aAlfa      = "/AEAT/INTERNET/180";          |RMKDIR aAlfa;
     aAlfa      = "/AEAT/INTERNET/180/" + #0#39; |RMKDIR aAlfa;
     aInternet  = aAlfa + "/";

     |SI aTipoEmi = "I";
         aDestino = aInternet + "180" + (("00000" + #30#0) % -105) + ".txt";
     |SINO;
         aDestino = aInternet + "18000000.txt";
     |FINSI;

     |RCOPIA_FICHERO aOrigen, aDestino;

     |FBORRA aOrigen;

     aOrigen = "\MODELOS\180\" +  "RTPA" + #0#39 + ".car";
     |FBORRA aOrigen;

     aOrigen = "\MODELOS\180\" +  "verifica.bat";
     |FBORRA aOrigen;

     aOrigen = "\MODELOS\180\" +  "auxiliar.txt";
     |FBORRA aOrigen;

     aAlfa =  "0000 El fichero se encuentra " + aInternet + " de su PC.";
     |MENAV aAlfa;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| Emision de Portadas
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO ImprimePortada;
     |SI nSwDeDonde = 3;
         |SI #81#31 > 25;  |ACABA;  |FINSI;
     |FINSI;

     |SI Primero = 1;
        Just1  = #81#36; #81#36 = " ";
        Just2  = #81#37; #81#37 = " ";
        Just3  = #81#38; #81#38 = " ";
        Just4  = #81#39; #81#39 = " ";
        Just5  = #81#40; #81#40 = " ";
        Just6  = #81#41; #81#41 = " ";
        Just7  = #81#42; #81#42 = " ";
        Just8  = #81#43; #81#43 = " ";
        Just9  = #81#44; #81#44 = " ";
        Just10 = #81#45; #81#45 = " ";
        Primero = 0;
     |SINO;
        #81#36 = Just1;
        #81#37 = Just2;
        #81#38 = Just3;
        #81#39 = Just4;
        #81#40 = Just5;
        #81#41 = Just6;
        #81#42 = Just7;
        #81#43 = Just8;
        #81#44 = Just9;
        #81#45 = Just10;
     |FINSI;

     |PRINT;
     |PIEINF;
|FPRC;

|DEFBUCLE eosw0081P;
     #81#1;
     ;
     nDRegis;
     nHRegis;
     be;
     NULL, ImprimePortada;
|FIN;

|PROCESO Portadas;
     |SI nSwDeDonde = 1;
         #81#48 = 0;
         |LEE 040#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#34 = 0;
              |MENAV "     Por favor haga la creacion de Diskette.";
              |ACABA;
         |FINSI;
     |FINSI;

     |SI nSwDeDonde = 2;
         #81#48 = 1;
         |LEE 040#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#31 = 0;
              |MENAV "     Por favor haga la creacion de Diskette.";
              |ACABA;
         |FINSI;
     |FINSI;
     |PUSHV 0501 2380;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #eosy0011#39 [ 1999;
        |INFOR "eosy1011";
     |SINO;
        |INFOR "eosy1111";
     |FINSI;
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     Primero = 1;

     |SI nSwDeDonde = 1;
         nDRegis = 0;
         nHRegis = 999;
     |SINO;
         nDRegis = 1;
         nHRegis = 999;
     |FINSI;
     |CIERRAT #81;  |BUCLE eosw0081P;  |ABRET #81;

     |FININF;
     |FINIMP;
|POPV;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| Emision de Etiquetas
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Etiquetas;
     |SI nSwDeDonde = 1;
         #81#48 = 0;
         |LEE 040#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#34 = 0;
             |MENAV "     Por favor haga la creacion de Diskette.";
             |ACABA;
         |FINSI;
     |SINO;
         #81#48 = 1;
         |LEE 040#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#31 = 0;
             |MENAV "     Por favor haga la creacion de Diskette.";
             |ACABA;
         |FINSI;
     |FINSI;

     |PUSHV 0501 2380;

     #104#16 = "Delegacion .........: " + #81#0;
     #104#17 = "Ejercicio ..........: " + #0#39;
     #104#18 = "Modelo .............: 180";
     aAlfa   = "Numero Justificante : 180" + #81#36 + #81#37 + #81#38 + #81#39;
     aAlfa   = aAlfa + #81#40 + #81#41 + #81#42 + #81#43 + #81#44 + #81#45;
     #104#19 = aAlfa;
     #104#20 = "N.I.F. .............: " + #81#9;
     #104#21 = "Nombre : " + #81#11;
     #104#22 = #81#12 + " " + #81#13 + " " + #81#15 + " " + (("00" + #81#17) % -102) + (("000" + #81#18) % -103);
     #104#23 = "P.Cont.: " + #81#46;
     #104#24 = "Telefono ...........: " + #81#10;
     |SI nSwDeDonde = 1;
         nNume   = #81#34 + #81#35 + 1;
     |SINO;
         nNume   = #81#34 + #81#35;
     |FINSI;
     #104#25 = "Numero total Registros ..: " + nNume;
     #104#26 = "Densidad soporte : 1,44 MB en Diskettes de 3 1/2";
     #104#27 = "";
     #104#28 = "";
     |C_M #104#27, 1, "N";
     |C_M #104#28, 1, "N";
     |SI nSwDeDonde = 1;
         #104#27 = "Numero total Declarantes : " + #81#34;
         #104#28 = "Numero total Declarados .: " + #81#35;
         |C_M #104#27, 1, "S";
         |C_M #104#28, 1, "S";
     |FINSI;

     Pos = -1;
     |PINPA #2#104;
     |PINDA #2#104;
     |ENDATOS #1#104;
     |SI FSalida = 0;
         |PINPA #2#104;
         |PINDA #2#104;
         |CONFI "2400SRealizar Impresion de la Etiqueta : ";
         |SI FSalida ! 0; |POPV; |ACABA; |FINSI;

         |IMPRE 0;
         |SI FSalida ! 0;  |POPV;  |ACABA;  |FINSI;

         |INFOR "eoszp015";
         |SI FSalida ! 0;  |POPV;  |FINIMP;  |ACABA;  |FINSI;

         |PRINT; |PIEINF; |FININF; |FINIMP;
     |FINSI;
     |POPV;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| Grabacion del Registro 0
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo0;
  |SI #eosy0011#39 [ 1999;
     |DDEFECTO #78;
     #78#0  = "0";
     #78#1  = "180";
     #78#2  = #81#4;
     aAlfa  = "00" + #81#2;
     aAlfa  = aAlfa % -102;
     #78#3  = aAlfa;
     #78#4  = #81#9;
     aAlfa  = #81#11;  |HAZ QuitaComas;
     #78#5  = aAlfa;
     #78#6  = #81#12;
     #78#7  = #81#13;
     aAlfa  = #81#14; |QBT aAlfa;
     #78#8  = ("00000" + aAlfa) % -105;
     #78#9  = #81#50;
     #78#10 = #81#51;
     #78#11 = #81#52;
     #78#12 = (("00" + #81#17) % -102) + (("000" + #81#18) % -103);
     #78#13 = #81#15;
     nCanti = #81#34;  |HAZ Valor5;   #78#14 = aCanti;
     nCanti = #81#35;  |HAZ Valor9;   #78#15 = aCanti;
     |SI #0#39 [ 2005;
         #78#16 = "D";
     |SINO;
         #78#16 = "T";
     |FINSI;
     #78#17 = #81#10;
     aAlfa  = #81#46;  |HAZ QuitaComas;
     #78#18 = aAlfa;

     |PARA nCampo = 0;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           Cadena = Handle + " " + #78nCampo;
           |FGRABA Cadena;
     |SIGUE;
     Cadena = Handle + " " + &13 + &10;
     |FGRABA Cadena;
  |SINO;
     Cadena = "0180";  Cadena = Handle + " " + Cadena;  |FGRABA Cadena;
     Comodin = #81#4;  Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#9;  Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     aAlfa  = #81#11;  |HAZ QuitaComas; Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140;
     Cadena = Handle + " " + aAlfa; |FGRABA Cadena;
     Comodin = #81#12; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#13; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = "   ";  Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#14; |QBF Comodin; Comodin = ("00000" + Comodin) % -105;
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#50; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#51; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#52; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = (("00" + #81#17) % -102) + (("000" + #81#18) % -103);
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #81#15 % 0112; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = ("00" + #81#17) % -102; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     nCanti = #81#34;  |HAZ Valor5; Cadena = Handle + " " + aCanti; |FGRABA Cadena;
     nCanti = #81#35;  |HAZ Valor9; Cadena = Handle + " " + aCanti; |FGRABA Cadena;

     |SI #0#39 [ 2005;
         Cadena = Handle + " D"; |FGRABA Cadena;
     |SINO;
         Cadena = Handle + " T"; |FGRABA Cadena;
     |FINSI;

     Comodin = #81#10; Cadena = Handle + " " + Comodin;   |FGRABA Cadena;
     aAlfa  = #81#46;  |HAZ QuitaComas; Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140;
     Cadena = Handle + " " + aAlfa; |FGRABA Cadena;
     Comodin = " " * 77; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Cadena = Handle + " " + &13 + &10; |FGRABA Cadena;
  |FINSI;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| Grabacion del Registro 1
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO CuentaArrend;

   |SI #eosy0011#39 [ 1999;
      |SI NifAnt ! #eosm0044#2; |O RegisAnt ! #eosm0044#16;
         TotalArrend = TotalArrend + 1;
         NifAnt   = #eosm0044#2;
         RegisAnt = #eosm0044#16;
         Devengo  = #eosm0044#3;
      |SINO;
         |SI Devengo ! #eosm0044#3;
            TotalArrend = TotalArrend + 1;
            NifAnt   = #eosm0044#2;
            RegisAnt = #eosm0044#16;
            Devengo  = #eosm0044#3;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #eosm0044#4 ! 0; TotalArrend = TotalArrend + 1; |FINSI;
      |SI #eosm0044#6 ! 0; TotalArrend = TotalArrend + 1; |FINSI;
   |FINSI;

   TotalRendDin = TotalRendDin + #eosm0044#4;
   TotalReteDin = TotalReteDin + #eosm0044#5;
   TotalRendEsp = TotalRendEsp + #eosm0044#6;
   TotalIngACta = TotalIngACta + #eosm0044#7;
|FPRC;

|DEFBUCLE CuentaArrend;
     #eosm0044#1;
     8;
     #30#0,#30#1,"            ",0000, 01, aDComple;
     #30#0,#30#1,"zzzzzzzzzzzz",9999, 99, aHComple;
     ;
     NULL,CuentaArrend;
|FIN;

|PROCESO Tipo1;
  |ABRE #eosclien;
  #eosclien#0 = #30#0;
  |LEE 000#eosclien.=;
  |CIERRA #eosclien;

  |SI #eosy0011#39 [ 1999;
     |DDEFECTO #79;
     #79#0  = "1";
     #79#1  = "180";
     #79#2  = #81#4;
     aAlfa  = "00" + #1#18;
     aAlfa  = aAlfa % -102;
     #79#3  = aAlfa;

     #79#4  = #eosclien#1;
     aAlfa  = #eosclien#2;  |HAZ QuitaComas;
     #79#5  = aAlfa;

     TotalArrend  = 0;
     TotalRendDin = 0;
     TotalReteDin = 0;
     TotalRendEsp = 0;
     TotalIngACta = 0;
     Devengo = -1;
     |BUCLE CuentaArrend;

     nCanti = TotalArrend;  |HAZ Valor9;   #79#6 = aCanti;

     |SI TotalRendDin ] 0;
        #79#7 = " ";
     |SINO;
        #79#7 = "N";
     |FINSI;

     nCanti = TotalRendDin;  |HAZ Valor15;   #79#8 = aCanti;
     nCanti = TotalReteDin;  |HAZ Valor15;   #79#9 = aCanti;

     |SI TotalRendEsp ] 0;
        #79#10 = " ";
     |SINO;
        #79#10 = "N";
     |FINSI;

     nCanti = TotalRendEsp;  |HAZ Valor15;   #79#11 = aCanti;
     nCanti = TotalIngACta;  |HAZ Valor15;   #79#12 = aCanti;

     |SI #0#39 [ 2005;
         #79#13 = "D";
     |SINO;
         #79#13 = "T";
     |FINSI;

     aAlfa = #30#16;
     aAlfa = "000000000" + aAlfa;
     aAlfa = aAlfa % -109;
     #79#14 = aAlfa;

     aAlfa  = #30#15;  |HAZ QuitaComas;
     #79#15 = aAlfa;

     |PARA nCampo = 0;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
           Cadena = Handle + " " + #79nCampo;
           |FGRABA Cadena;
     |SIGUE;
     Cadena = Handle + " " + &13 + &10;
     |FGRABA Cadena;
  |SINO;
     Cadena = "1180";  Cadena = Handle + " " + Cadena;  |FGRABA Cadena;
     Comodin = #81#4;  Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Comodin = #eosclien#1; |QBF Comodin;
     Comodin = ("         " + Comodin) % -109;  Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     aAlfa   = #eosclien#2;  |HAZ QuitaComas; Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140;
     Cadena = Handle + " " + aAlfa; |FGRABA Cadena;

     |SI #0#39 [ 2005;
         Cadena = Handle + " D"; |FGRABA Cadena;
     |SINO;
         Cadena = Handle + " T"; |FGRABA Cadena;
     |FINSI;

     Comodin = #30#16; |QBF Comodin; Comodin = (("0" * 9) + Comodin) % -109;
     Cadena  = Handle + " " + Comodin; |FGRABA Cadena;
     aAlfa   = #30#15; |HAZ QuitaComas; Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140;
     Cadena  = Handle + " " + aAlfa; |FGRABA Cadena;
     |SI #eosy0011#39 ] 2001; |Y #eosy0011#39 < 2014;
        Comodin = "1670000000000";
     |SINO;
        Comodin = "1800000000000";
     |FINSI;
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     |SI #30#3 = "C"; Comodin = "C"; |SINO; Comodin = " "; |FINSI;
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     |SI #30#3 = "S";
        |SI #eosy0011#39 < 2001; |O #eosy0011#39 ] 2014;
           Comodin = "S180";
        |SINO;
           Comodin = "S167";
        |FINSI;
        Comodin = Comodin + #30#4 + #30#5 + #30#6 + #30#7 + #30#8 + #30#9;
        Comodin = Comodin + #30#10 + #30#11 + #30#12 + #30#13;
     |SINO;
        Comodin = " 0000000000000";
     |FINSI;
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;

     TotalArrend  = 0; TotalRendDin = 0; TotalReteDin = 0; TotalRendEsp = 0;
     TotalIngACta = 0; Devengo = -1;
     |BUCLE CuentaArrend;

     nCanti = TotalArrend;  |HAZ Valor9;
     Cadena = Handle + " " + aCanti; |FGRABA Cadena;

     TotalRendDin = TotalRendDin + TotalRendEsp;
     TotalReteDin = TotalReteDin + TotalIngACta;
     |SI TotalRendDin ] 0;
        Comodin = " ";
     |SINO;
        Comodin = "N";
        TotalRendDin = -TotalRendDin; TotalReteDin = -TotalReteDin;
     |FINSI;
     nCanti = TotalRendDin;  |HAZ Valor15;  Comodin = Comodin + aCanti;
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     nCanti = TotalReteDin;  |HAZ Valor15; Cadena = Handle + " " + aCanti; |FGRABA Cadena;

     Comodin = " " * 75; Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Cadena = Handle + " " + &13 + &10; |FGRABA Cadena;
  |FINSI;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| Grabacion del Registro 2
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Tipo2;
  |ABRE #eosclien;
  #eosclien#0 = #30#0;
  |LEE 000#eosclien.=;
  |CIERRA #eosclien;

  |SI #eosy0011#39 [ 1999;
     #80#0 = "2";
     #80#1 = "180";
     #80#2 = #30#1;
     aAlfa  = "00" + #1#18;
     aAlfa  = aAlfa % -102;
     #80#3  = aAlfa;

     #80#4 = #eosclien#1;

     |SI #eosm0044#4 ! 0;
         #80#5  = "A";
     |SINO;
         #80#5  = "B";
     |FINSI;

     #80#6  = #eosm0044#2;
     |SI #eosm0044#9 = "S";
        #80#7 = "R";
     |SINO;
        #80#7 = " ";
     |FINSI;

     |ABRE #eosm0045;
     #eosm0045#0 = #30#0;
     #eosm0045#1 = #eosm0044#2;
     |LEE 000#eosm0045.=;
     |SI FSalida = 0;
        #80#8 = #eosm0045#2;
     |FINSI;
     |CIERRA #eosm0045;

     #80#9 = #eosm0044#10;

     |SI #eosm0044#4 ] 0;
        #80#10 = " ";
     |SINO;
        #80#10 = "N";
     |FINSI;

     nCanti = #eosm0044#4;  |HAZ Valor15;   #80#11 = aCanti;
     nCanti = #eosm0044#5;  |HAZ Valor15;   #80#12 = aCanti;
     #80#13 = ("0000" + #eosm0044#3) % -104;

     |PARA nCampo = 0;  |SI nCampo [ 14;  |HACIENDO nCampo = nCampo + 1;
        Cadena = Handle + " " + #80nCampo;
        |FGRABA Cadena;
     |SIGUE;
     Cadena = Handle + " " + &13 + &10;
     |FGRABA Cadena;
  |SINO;
     Comodin = "2180"; Cadena = Comodin;
     Comodin = #30#1;  Cadena = Cadena + Comodin;

     Comodin = #eosclien#1; |QBF Comodin;
     Comodin = ((" " * 9) + Comodin) % -109;

     Cadena = Cadena + Comodin;
     Comodin = #eosm0044#2; |QBF Comodin;
     Comodin = ((" " * 9) + Comodin) % -109;
     |SI #eosm0044#9 = "S";
        Comodin = "         " + Comodin;
     |SINO;
        Comodin = Comodin + "         ";
     |FINSI;
     Cadena = Cadena + Comodin;
     aAlfa = #eosm0044#12; |HAZ QuitaComas; |QBF aAlfa;
     Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140; Cadena = Cadena + aAlfa;
     Comodin = #eosm0044#10 % 0102; Comodin = ("00" + Comodin) % -102;
     Cadena = Cadena + Comodin;
     Comodin = Cadena; Cadena = Handle + " " + Cadena; |FGRABA Cadena;

     |SI #eosm0044#4 ! 0;
        Cadena = Handle + " 1"; |FGRABA Cadena;
     |SINO;
        Cadena = Handle + " 2"; |FGRABA Cadena;
     |FINSI;

     |SI #eosm0044#4 < 0;
        Cadena = Handle + " N"; |FGRABA Cadena;
     |SINO;
        Cadena = Handle + "  "; |FGRABA Cadena;
     |FINSI;

     |SI #eosm0044#4 ! 0;
        nCanti = #eosm0044#4; |HAZ Valor13;
        Calc = #eosm0044#14;
     |SINO;
        nCanti = #eosm0044#6; |HAZ Valor13;
        Calc = #eosm0044#15;
     |FINSI;

     Cadena = Handle + " " + aCanti; |FGRABA Cadena;

     nCanti = Calc;       || Porcentaje
     nCanti = nCanti ! 0; Comodin = ("00" + nCanti) % -102;
     nCanti = (Calc - nCanti) * 100; Comodin = Comodin + (("00" + nCanti)% -102);
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;

     |SI #eosm0044#4 ! 0;
        nCanti = #eosm0044#5; |HAZ Valor13;
     |SINO;
        nCanti = #eosm0044#7; |HAZ Valor13;
     |FINSI;
     Cadena = Handle + " " + aCanti; |FGRABA Cadena;

     Comodin = ("0000" + #eosm0044#3) % -104;
     Cadena = Handle + " " + Comodin; |FGRABA Cadena;
     Cadena = " " * 137; Cadena = Handle + " " + Cadena; |FGRABA Cadena;
     Cadena = Handle + " " + &13 + &10; |FGRABA Cadena;
  |FINSI;
|FPRC;

|PROCESO Trata180;

     |SI nSwLectura = 1;
         |SI #eosy0011#39 > 1999;
            |SI #eosm0044#4 ! 0; #81#31 = #81#31 + 1; |FINSI;
            |SI #eosm0044#6 ! 0; #81#31 = #81#31 + 1; |FINSI;
         |SINO;
            #81#31 = #81#31 + 1;
         |FINSI;
         #81#32 = #81#32 + #34#5;
         #81#33 = #81#33 + #34#7;
         #81#53 = #81#53 + #34#4;
         #81#54 = #81#54 + #34#6;
     |FINSI;

     |SI nSwLectura = 2;
        |SI #eosm0044#4 ! 0; |Y #eosm0044#6 ! 0;
           Percep = #eosm0044#6; Reten = #eosm0044#7;
           #eosm0044#6 = 0; #eosm0044#7 = 0;

           |HAZ Tipo2;
           #eosm0044#6 = Percep; #eosm0044#7 = Reten;
           Percep = #eosm0044#4; Reten = #eosm0044#5;
           #eosm0044#4 = 0;

           |HAZ Tipo2;
           #eosm0044#4 = Percep; #eosm0044#5 = Reten;
        |SINO;

           |HAZ Tipo2;
        |FINSI;
     |FINSI;

     |SI nSwLectura = 3;
||         |SI #34#5 = "  ";  #34#5 = "00";  |FINSI;
||         |PRINT;
           |SI NifAnt ! #eosm0044#2;
              NumPagina = 1;
              NifAnt = #eosm0044#2;
              SwInit = 1;
           |SINO;
              SwInit = 0;
           |FINSI;
           |SI ClaveRet = "A"; |Y #eosm0044#4 = 0; |ACABA; |FINSI;
           |SI ClaveRet = "B"; |Y #eosm0044#6 = 0; |ACABA; |FINSI;
           |SI ClaveRet = " ";
              |SI #eosm0044#4 ! 0;
                 ClaveRet = "1";
                 |ABRE #eosm0042;
                 #eosm0042#0 = #eosm0044#0;
                 #eosm0042#1 = #eosm0044#1;
                 #eosm0042#2 = #eosm0044#2;
                 #eosm0042#3 = 01;
                 |LEE 000#eosm0042.];
                 |SI FSalida = 0; |Y #eosm0042#0 = #eosm0044#0; |Y #eosm0042#1 = #eosm0044#1;
                  |Y #eosm0042#2 = #eosm0044#2;
                     |PARA; |SI; |HACIENDO;
                        |SI FSalida = 0; |Y #eosm0042#0 = #eosm0044#0;
                         |Y #eosm0042#1 = #eosm0044#1; |Y #eosm0042#2 = #eosm0044#2;
                            |SI #eosm0042#4 ! 0; Porcent = #eosm0042#4; |FINSI;
                            |LEE 000#eosm0042.s;
                        |SINO;
                           |SAL;
                        |FINSI;
                     |SIGUE;
                 |FINSI;
                 |CIERRA #eosm0042;
                 |PRINT;
              |FINSI;
              |SI #eosm0044#6 ! 0;
                 ClaveRet = "2";
                 |ABRE #eosm0042;
                 #eosm0042#0 = #eosm0044#0;
                 #eosm0042#1 = #eosm0044#1;
                 #eosm0042#2 = #eosm0044#2;
                 #eosm0042#3 = 01;
                 |LEE 000#eosm0042.];
                 |SI FSalida = 0; |Y #eosm0042#0 = #eosm0044#0; |Y #eosm0042#1 = #eosm0044#1;
                  |Y #eosm0042#2 = #eosm0044#2;
                     |PARA; |SI; |HACIENDO;
                        |SI FSalida = 0; |Y #eosm0042#0 = #eosm0044#0;
                         |Y #eosm0042#1 = #eosm0044#1; |Y #eosm0042#2 = #eosm0044#2;
                            |SI #eosm0042#7 ! 0; Porcent = #eosm0042#7; |FINSI;
                            |LEE 000#eosm0042.s;
                        |SINO;
                           |SAL;
                        |FINSI;
                     |SIGUE;
                 |FINSI;
                 |CIERRA #eosm0042;
                 |PRINT;
              |FINSI;

              ClaveRet = " ";
           |SINO;
              |PRINT;
           |FINSI;
     |FINSI;
     #eosm0044#13 = "S";
     |GRABA 020#eosm0044.a;
|FPRC;

|DEFBUCLE eosm0044;
     #34#1;
     8;
     #30#0, #30#1, "            ", 0000, 01, aDComple;
     #30#0, #30#1, "zzzzzzzzzzzz", 9999, 99, aHComple;
     ;
     NULL, Trata180;
|FIN;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| TRATAMIENTO FICHERO DE PORTADAS
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO AbreFichero;
     nSwError   = 0;
     Raiz       = "";  |DIRECTORIO Raiz;
     Directorio = "";  |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;  |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;

     Fichero    = "RTPA" + #0#39;
     NFichero   = Directorio + Fichero;          |QBF NFichero;

     Fichero  = "wb  "+ NFichero;

     Pos = -1;
     |FABRE Fichero;
     Handle = FSalida;
     |SI FSalida < 0;
         Valfa = "      [" + Fichero + "] inaccesible.";
         |MENAV Valfa;
         nSwError = 1;
     |FINSI;
|FPRC;

|PROCESO GrabaDiskette;
     #1#0 = #30#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

     #3#0 = #1#18; #3#1 = #1#19;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #2#0 = #1#0;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     aDComple = " ";
     aHComple = "z";
     |SI #30#3 = "C";
         aDComple = "S";
         aHComple = "S";
     |FINSI;

     nSwLectura = 2;  |BUCLE eosm0044;
|FPRC;

|PROCESO CuentaClave;
   |SI #eosm0044#4 ! 0;
      ConClaveA = ConClaveA + 1;
   |FINSI;
   |SI #eosm0044#6 ! 0;
      ConClaveB = ConClaveB + 1;
   |FINSI;
|FPRC;

|DEFBUCLE CuentaClave;
  #eosm0044#1;
  ;
  #30#0,#30#1,"            ",0000, 01;
  #30#0,#30#1,"zzzzzzzzzzzz",9999, 99;
  ;
  NULL,CuentaClave;
|FIN;

|PROCESO TrataTemporal;

     |SI nSwLectura = 1;
         |SI #81#48 ! 0;
             |BORRA 020#81a; |LIBERA #81;
         |SINO;
            #81#34 = 0; #81#35 = 0;
            |GRABA 020#81a; |LIBERA #81;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI nSwDeDonde = 3;       || Impresion Hojas Interiores

         #30#0 = #81#49;
         #30#1 = #0#39;
         |LEE 000#30=;
         |SI FSalida = 0;
            ConClaveA = 0;
            ConClaveB = 0;
            |BUCLE CuentaClave;

            |SI #eosy0011#39 [ 1999;
               nNume = ConClaveA $ 7;
               |SI nNume ! 0;
                  enTHojas = (ConClaveA / 7) + 1;
               |SINO;
                  enTHojas = ConClaveA / 7;
               |FINSI;
               nNume = ConClaveB $ 7;
               |SI nNume ! 0;
                  enTHojas = enTHojas + ((ConClaveB / 7) + 1);
               |SINO;
                  enTHojas = enTHojas + (ConClaveB / 7);
               |FINSI;
               ClaveRet = "A";
               NPag = 1;
               nSwLectura = 3;  |BUCLE eosm0044;
               |SI ConClaveA ! 0; |PIEINF; |FINSI;
               ClaveRet = "B";
               nSwLectura = 3;  |BUCLE eosm0044;
               |SI ConClaveB ! 0; |PIEINF; |FINSI;
            |SINO;
               nNume = ConClaveA + ConClaveB;
               |SI nNume ! 0;
                  enTHojas = (((nNume / 8) - 0.5) ! 0) + 1;
               |SINO;
                  enTHojas = ((nNume / 8) - 0.5) ! 0;
               |FINSI;
               ClaveRet = " ";
               NPag = 1;
               nSwLectura = 3;  |BUCLE eosm0044;

               |SI nNume ! 0; |PIEINF; |FINSI;
            |FINSI;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #81#48 = 0;
         |SI nSwDeDonde = 1;
             |HAZ Tipo0;
         |FINSI;
     |SINO;
         #30#0 = #81#49;
         #30#1 = #0#39;
         |LEE 000#30=;
         |SI FSalida = 0;
             |SI #0#39 [ 2005;
                  aTipoP = "D";
             |SINO;
                  aTipoP = "T";
             |FINSI;
             |SI #0#39 [ 1999;  |HAZ Caratula1999;  |FINSI;
             |SI #0#39 = 2000;  |HAZ Caratula2000;  |FINSI;
             |SI #0#39 = 2001;  |HAZ Caratula2000;  |FINSI;
             |SI #0#39 ] 2002;  |HAZ Caratula2002;  |FINSI;
             |HAZ Tipo1;
             |HAZ GrabaDiskette;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE eosw0081C;
     #81#1;
     ;
     000;
     999;
     be;
     NULL, TrataTemporal;
|FIN;

|PROCESO GrabaPortadas1;
     nContador = nContador + 1;

     #1#0 = #30#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

     #3#0 = #1#18; #3#1 = #1#19;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #2#0 = #1#0;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #81#48 = 0;
     |LEE 000#81=;
     |SI FSalida = 0;
        nNume1 = #81#36; nNume2  = #81#37; nNume3 = #81#38; nNume4 = #81#39;
        nNume5 = #81#40; nNume6  = #81#41; nNume7 = #81#42; nNume8 = #81#43;
        nNume9 = #81#44; nNume10 = #81#45;
     |FINSI;

     |DDEFECTO #81;
     #81#48 = nContador;
     #81#0  = #3#2;
     #81#1  = #3#3;
     #81#2  = #3#0;
     #81#3  = #3#1;
     #81#4  = #30#1;

     |SI nSwDeDonde = 1;
         #81#5  = " ";
         #81#6  = " ";
         #81#7  = " ";
         #81#8  = "X";
     |FINSI;

     |SI nSwDeDonde = 2;
         #81#5  = " ";
         #81#6  = "X";
         #81#7  = " ";
         #81#8  = " ";
     |FINSI;

     |SI nSwDeDonde = 3;
         #81#5  = "X";
         #81#6  = " ";
         #81#7  = " ";
         #81#8  = " ";
     |FINSI;

     #81#9  = #1#1;
     #81#10 = #1#14;
     #81#11 = #1#2;
     #81#12 = #1#4;
     aAlfa  = #1#5;  |HAZ QuitaComas;
     #81#13 = aAlfa;
     aAlfa  = #1#6;  |QBT aAlfa;
     #81#14 = ("0000" + aAlfa) % -104;
     #81#50 = #1#7;
     #81#51 = #1#8;
     #81#52 = #1#9;

     aAlfa  = #1#13;  |HAZ QuitaComas;
     #81#15 = aAlfa;
     #81#16 = #1#12;
     #81#17 = #1#10;
     #81#18 = #1#11;

     |SI #30#3 = "C";  #81#19 = "X";  |FINSI;
     |SI #30#3 = "S";  #81#20 = "X";  |FINSI;

     #81#21 = #30#4;
     #81#22 = #30#5;
     #81#23 = #30#6;
     #81#24 = #30#7;
     #81#25 = #30#8;
     #81#26 = #30#9;
     #81#27 = #30#10;
     #81#28 = #30#11;
     #81#29 = #30#12;
     #81#30 = #30#13;
     #81#46 = #30#17;
     #81#47 = #30#18;
     #81#49 = #30#0;

     #81#36 = nNume1;
     #81#37 = nNume2;
     #81#38 = nNume3;
     #81#39 = nNume4;
     #81#40 = nNume5;
     #81#41 = nNume6;
     #81#42 = nNume7;
     #81#43 = nNume8;
     #81#44 = nNume9;
     #81#45 = nNume10;

     aDComple = " ";
     aHComple = "z";
     |SI #30#3 = "C";
         aDComple = "S";
         aHComple = "S";
     |FINSI;

     nSwLectura = 1;  |BUCLE eosm0044;      ||Carga Portada

     |GRABA 020#81n;
     |LIBERA #81;

     nTotalP = #81#31;
     #81#48 = 0;
     |LEE 101#81=;
     |SI FSalida = 0;
         #81#34 = #81#34 + 1;
         #81#35 = #81#35 + nTotalP;
         |GRABA 020#81a;
     |FINSI;
     |LIBERA #81;
|FPRC;

|DEFBUCLE eosm0040C;
     #30#1;
     ;
     #0#0, #0#39;
     #0#1, #0#39;
     ;
     NULL,GrabaPortadas1;
|FIN;

|PROCESO PlanillaImp;
     #30#0 = #14#1;
     #30#1 = #0#39;
     |LEE 000#30=;
     |SI FSalida = 0;  |HAZ GrabaPortadas1;  |FINSI;
|FPRC;

|DEFBUCLE eosm0014C;
     #14#1;
     ;
     #0#38, 00001;
     #0#38, 99999;
     ;
     NULL, PlanillaImp;
|FIN;

|PROCESO Prevalida;
   eaFichCol = "RTPA" + #0#39; eaTipoEmi = "VERIF180"; eaTipoSec = "180";
   |SUB_EJECUTA "eosz9999.tab";

   ||SI enAnyo ] 2001;
      ||Fichero    = "RC" + #0#39 + ".txt";
   ||SINO;
      Fichero    = "RTPA" + #0#39 + ".txt";
   ||FINSI;
   Fichero     = "/MODELOS/" + eaTipoSec + "/" + Fichero;
   |XABRE "EC", Fichero, nCanal;
   |SI FSalida < 0;
      SwError = 0;
      Fichero    = "ERRORES.txt";
      Fichero     = "/MODELOS/" + eaTipoSec + "/" + Fichero;
      |XABRE "EC", Fichero, nCanal;
      |SI FSalida < 0;
         SwError = 0;
      |SINO;
         SwError = 1;
      |FINSI;
   |SINO;
      SwError = 1;
   |FINSI;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| POR COLECTIVO
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Colectivo;

     nSwDeDonde = 1;
     nSwLectura = 1;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;

     |SI #0#0 = 0;
         |SI #0#38 = 0;
             |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |SI #0nCampoD ! 0;
                       #30#0 = #0nCampoD;
                       #30#1 = #0#39;
                       |LEE 000#30=;
                       |SI FSalida = 0;  |HAZ GrabaPortadas1;  |FINSI;
                   |FINSI;
             |SIGUE;
         |SINO;
             |BUCLE eosm0014C;
         |FINSI;
     |SINO;
         |CIERRAT #30;  |BUCLE eosm0040C;  |ABRET #30;
     |FINSI;
|FPRC;

|PROCESO DatosPresen;
     #81#48 = 0;
     |LEE 101#81=;
     |SI FSalida ! 0;
         |DDEFECTO #81;
         #81#48 = 0;
         nSwLectura = 1;
         |GRABA 020#81b;
     |FINSI;

     #81#4  = #0#39;
     #81#5  = " ";
     #81#6  = " ";
     #81#7  = "X";
     #81#8  = " ";

     nContador = 0;
     #81#31    = 0;
     #81#32    = 0;
     #81#33    = 0;
     #81#34    = 0;
     #81#35    = 0;
     |GRABA 020#81a;
     |LIBERA #81;

     |HAZ Colectivo;

     #81#48 = 0;
     |LEE 101#81=;
     |SI FSalida = 0;
         |PUSHV 0501 2380;
         |PINPA #0#81;
         |PINDA #0#81;
         |ENDATOS #1#81;
         |SI FSalida = 0;
             |GRABA 020#81a;
         |FINSI;
         |LIBERA #81;
         |POPV;
     |FINSI;
|FPRC;

|PROCESO CreacionDisk;
     |SI nSwDeDonde = 1;
         #81#48 = 0;
         |LEE 000#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#34 = 0;
             |MENAV "     Por favor haga la creacion de Diskette.";
             |ACABA;
         |FINSI;
     |SINO;
         #81#48 = 1;
         |LEE 000#81=;
         |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
         |SI #81#31 = 0;
             |MENAV "     Por favor haga la creacion de Diskette.";
             |ACABA;
         |FINSI;
     |FINSI;

     |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;
     |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;
     Fichero   = "RTPA" + #eosy0011#39 + ".car";
     NFichero   = Directorio + Fichero;          |QBF NFichero;

     Fichero  = "wb  "+ NFichero;
     Pos = -1;
     |FABRE Fichero;
     Handle1 = FSalida;

     |SI aTipoEmi = "C";
        |HAZ Colectivo;
        #81#48 = 0; |LEE 000#81=;
        aTipo = "P";
        |SI #0#39 [ 1999;  |HAZ Caratula1999;  |FINSI;
        |SI #0#39 = 2000;  |HAZ Caratula2000;  |FINSI;
        |SI #0#39 = 2001;  |HAZ Caratula2000;  |FINSI;
        |SI #0#39 ] 2002;  |HAZ Caratula2002;  |FINSI;
        aTipo = "";
     |FINSI;

     |HAZ AbreFichero;
     |SI nSwError = 0;
         nSwLectura = 2;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;
     |FINSI;

     FSalida = Handle;
     |FCIERRA FSalida;

     FSalida = Handle1; |FCIERRA FSalida;

     |SI aTipoEmi = "C";
         |DBASE aBase;  |QBF aBase;

         eaFichCol   = "RTPA" + #0#39;
         aFichDestin = "/MODELOS/180/" + eaFichCol;
         |RFBORRA aFichDestin;

         aFichOrigen = aBase + "hacienda/180/" + eaFichCol;
         aFichDestin = "/MODELOS/180/" + eaFichCol;
         aAlfa1 = "";
         |IP_REMOTO aAlfa1;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             |ENVIA_FICHERO aFichOrigen, aFichDestin;
         |SINO;
             |COPIA_FICHERO aFichOrigen, aFichDestin;
         |FINSI;

         |XABRE "EC", aFichDestin, nHandle;
         |SI FSalida < 0;
             |MENAV "0000 Seleccion vacia.";
             |ERROR;
         |FINSI;

         aFichOrigen = aBase + "hacienda/180/" + eaFichCol + ".car";
         aFichDestin = "/MODELOS/180/" + eaFichCol + ".car";
         aAlfa1 = "";
         |IP_REMOTO aAlfa1;  |QBT aAlfa1;
         |SI aAlfa1 ! "";
             |ENVIA_FICHERO aFichOrigen, aFichDestin;
         |SINO;
             |COPIA_FICHERO aFichOrigen, aFichDestin;
         |FINSI;

         |HAZ DirInternet;
         |ACABA;
     |FINSI;

     |MENAV "     Fichero Creado con Exito.";
|FPRC;

|PROCESO MenuCol;
     aTipoEmi = "C";
     |PUSHV 0501 2380;
     |PARA; |SI; |HACIENDO;
            |MENUG aMenuCol;
            aMenuCol2 = FSalida; SwError = 0;

            |SI aMenuCol2 < "1";  |O aMenuCol2 > "2";  |SAL;  |FINSI;

            |SI aMenuCol2 = "1"; |HAZ DatosPresen;     |FINSI;
            |SI aMenuCol2 = "2"; |HAZ CreacionDisk;    |SAL;  |FINSI;
     |SIGUE;
     |POPV;

     nSwLectura = 1;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| POR INDIVIDUAL
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Individual;
     nSwLectura = 1;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;

     |SI #0#0 = 0;
         |SI #0#38 = 0;
             |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |SI #0nCampoD ! 0;
                       #30#0 = #0nCampoD;
                       #30#1 = #0#39;
                       |LEE 000#30=;
                       |SI FSalida = 0;  |HAZ GrabaPortadas1;  |FINSI;
                   |FINSI;
             |SIGUE;
         |SINO;
             |BUCLE eosm0014C;
         |FINSI;
     |SINO;
         |CIERRAT #30;  |BUCLE eosm0040C;  |ABRET #30;
     |FINSI;
|FPRC;

|PROCESO MenuInd;
     aTipoEmi = "I";
     nContador = 0;
     |SI #0#0 = 0;
         |CUADRO 0501 2380;
         |BLANCO 0602 2279;
         |PINTA 0702, "PARA EMITIR LA INDIVIDUAL PONER EN EL DESDE/HASTA DE";
         |PINTA 0802, "LA SELECCION DE EMPRESAS EL MISMO CODIGO DE CLIENTE,";
         |PINTA 0902, "YA QUE CREAMOS UN DISKETTE POR EMPRESA.             ";
         |PAUSA;
         |ACABA;
     |FINSI;

     |SI #0#0 ! 0;
         |SI #0#1 ! #0#0;
             |CUADRO 0501 2380;
             |BLANCO 0602 2279;
             |PINTA 0702, "PARA EMITIR LA INDIVIDUAL PONER EN EL DESDE/HASTA DE";
             |PINTA 0802, "LA SELECCION DE EMPRESAS EL MISMO CODIGO DE CLIENTE,";
             |PINTA 0902, "YA QUE CREAMOS UN DISKETTE POR EMPRESA.             ";
             |PAUSA;
             |ACABA;
        |FINSI;
     |FINSI;

     |PUSHV 0501 2380;
     nSwDeDonde = 2;
     |HAZ Individual;
     |PARA; |SI; |HACIENDO;
            |MENUG aMenuInd;
            aMenuInd2 = FSalida; SwError = 0;

            |SI aMenuInd2 < "1";  |O aMenuInd2 > "3";  |SAL;  |FINSI;

            |SI aMenuInd2 = "1"; |HAZ CreacionDisk;   |FINSI;
            |SI aMenuInd2 = "2";
                |HAZ Prevalida;
                |SI SwError = 1; |HAZ Errores180; |FINSI;
            |FINSI;
            |SI aMenuInd2 = "3"; |HAZ DirInternet;  |SAL;   |FINSI;
     |SIGUE;
     |POPV;

     nSwLectura = 1;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;
|FPRC;

|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| POR LASER
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Caratula1999;
         Cadena = Handle1 + " " + "1";     |FGRABA Cadena;
         Cadena = Handle1 + " " + "180";   |FGRABA Cadena;
         Cadena = Handle1 + " " + #30#1;   |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#9;   |FGRABA Cadena;
         aAlfa  = (("00" + #81#2) % -102) + (("000" + #81#3) % -103);
         Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#12;  |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#13;  |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#14;  |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#15;  |FGRABA Cadena;
         aAlfa  = (("00" + #81#17) % -102);
         Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
         aAlfa  = (("00" + #81#17) % -102) + (("000" + #81#18) % -103);
         Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
         aAlfa  = (#0#40 % 102) + "/" + (#0#40 % 402) + "/" + (#0#40 % 704);
         Cadena = Handle1 + " " + aAlfa;  |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#46;  |FGRABA Cadena;
         Cadena = Handle1 + " " + #81#47;  |FGRABA Cadena;
         Cadena = Handle1 + " " + &13 + &10;   |FGRABA Cadena;
|FPRC;

|PROCESO Caratula2000;
     |SI aTipo = "";
        Cadena = Handle1 + " " + "1";     |FGRABA Cadena;
     |SINO;
        Cadena = Handle1 + " " + "0";     |FGRABA Cadena;
     |FINSI;
     Cadena = Handle1 + " " + "180";   |FGRABA Cadena;
     Cadena = Handle1 + " " + #0#39;   |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#9;   |FGRABA Cadena;
     aAlfa  = (("00" + #81#2) % -102) + (("000" + #81#3) % -103);
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#12;  |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#13 + "   ";  |FGRABA Cadena;
     nNume  = #81#14;
     Cadena = Handle1 + " " + (("00000" + nNume) % -105);  |FGRABA Cadena;
     Cadena = Handle1 + " " + (#81#15 % 112);  |FGRABA Cadena;
     aAlfa  = (("00" + #81#17) % -102);
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     aAlfa  = (("00" + #81#17) % -102) + (("000" + #81#18) % -103);
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     aAlfa  = (#0#40 % 704) + (#0#40 % 402) + (#0#40 % 102);
     Cadena = Handle1 + " " + aAlfa;  |FGRABA Cadena;
     aAlfa = #81#46; |HAZ QuitaComas; aAlfa = (aAlfa + (" " * 30)) % 130;
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#47;  |FGRABA Cadena;
     Cadena = Handle1 + " " + &13 + &10;   |FGRABA Cadena;
|FPRC;

|PROCESO Caratula2002;
     |SI aTipo = "";
        Cadena = Handle1 + " " + "1";     |FGRABA Cadena;
     |SINO;
        Cadena = Handle1 + " " + "0";     |FGRABA Cadena;
     |FINSI;
     Cadena = Handle1 + " " + "180";   |FGRABA Cadena;
     Cadena = Handle1 + " " + #0#39;   |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#9;   |FGRABA Cadena;
     aAlfa  = (("00" + #81#2) % -102) + (("000" + #81#3) % -103);
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#12;  |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#13 + "   ";  |FGRABA Cadena;
     nNume  = #81#14;
     Cadena = Handle1 + " " + (("00000" + nNume) % -105);  |FGRABA Cadena;
     Cadena = Handle1 + " " + (#81#15 % 112);  |FGRABA Cadena;
     aAlfa  = (("00" + #81#17) % -102);
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     aAlfa  = (("00" + #81#17) % -102) + (("000" + #81#18) % -103);
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     aAlfa  = (#0#40 % 704) + (#0#40 % 402) + (#0#40 % 102);
     Cadena = Handle1 + " " + aAlfa;  |FGRABA Cadena;
     aAlfa = #81#46; |HAZ QuitaComas; aAlfa = (aAlfa + (" " * 30)) % 130;
     Cadena = Handle1 + " " + aAlfa;   |FGRABA Cadena;
     Cadena = Handle1 + " " + #81#47;  |FGRABA Cadena;
     |SI aTipo = "";
         Cadena = Handle1 + " " + ((("00000" + #81#49) % -105) + (" " * 15));  |FGRABA Cadena;
     |SINO;
         Cadena = Handle1 + " " + (" " * 20);  |FGRABA Cadena;
     |FINSI;
     Cadena = Handle1 + " " + &13 + &10;   |FGRABA Cadena;
|FPRC;

|PROCESO DesarrollaLaser;
     #1#0 = #30#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

     #3#0 = #1#18; #3#1 = #1#19;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #2#0 = #1#0;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     |DDEFECTO #81;
     #81#0  = #3#2;
     #81#1  = #3#3;
     #81#2  = #3#0;
     #81#3  = #3#1;
     #81#4  = #30#1;
     #81#5  = "X";
     #81#6  = " ";
     #81#7  = " ";
     #81#8  = " ";
     #81#9  = #1#1;
     #81#10 = #1#14;
     #81#11 = #1#2;
     #81#12 = #1#4;
     aAlfa  = #1#5;  |HAZ QuitaComas;
     #81#13 = aAlfa;
     aAlfa  = #1#6;  |QBT aAlfa;
     #81#14 = ("00000" + aAlfa) % -105;
     aAlfa  = #1#13;  |HAZ QuitaComas;
     #81#15 = aAlfa;
     #81#16 = #1#12;
     #81#17 = #1#10;
     #81#18 = #1#11;

     |SI #30#3 = "C";  #81#19 = "X";  |FINSI;
     |SI #30#3 = "S";  #81#20 = "X";  |FINSI;

     #81#21 = #30#4;
     #81#22 = #30#5;
     #81#23 = #30#6;
     #81#24 = #30#7;
     #81#25 = #30#8;
     #81#26 = #30#9;
     #81#27 = #30#10;
     #81#28 = #30#11;
     #81#29 = #30#12;
     #81#30 = #30#13;
     #81#46 = #30#17;
     #81#47 = #30#18;
     #81#49 = #30#0;

     aDComple = " ";
     aHComple = "z";
     |SI #30#3 = "C";
         aDComple = "S";
         aHComple = "S";
     |FINSI;

     nSwLectura = 1; |BUCLE eosm0044;      ||Carga Portada

     |SI #0#39 [ 2005;
         |SI #81#31 > 25;  |ACABA;  |FINSI;
     |SINO;
         |SI #81#31 > 15;  |Y nTecla = 1;
             |MENAV "0000 Emitalo por intenet tiene mas de 15 perceptores.";
             |ACABA;
         |FINSI;
     |FINSI;

     Raiz       = "";  |DIRECTORIO Raiz;
     Directorio = "";
     |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;
     |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;

     Empresa  = #30#0;  Empresa  = ("00000" + Empresa) % -105;

     Fichero     = aTipoSec + Empresa;
     INEmpresas  = NEmpresas1 <-;
     INEmpresas  = INEmpresas + NACopiar;
     NFichero    = Directorio + Fichero;          |QBF NFichero;
     NEmpresas   = NFichero;
     aFicheroTxt = NFichero;
     nEmpresa    = Empresa;

     Fichero  = "wb  "+ NFichero;
     Pos = -1;
     |FABRE Fichero;
     Handle = FSalida;
     |SI FSalida ] 0;
         aTipoP = "C";
         |HAZ Tipo1;

         nSwLectura = 2;  |BUCLE eosm0044;
     |FINSI;
     FSalida = Handle;
     |FCIERRA FSalida;

     Fichero    = aTipoSec + Empresa + ".car";
     INEmpresas  = NEmpresas1 <-;
     INEmpresas  = INEmpresas + NACopiar;
     NFichero    = Directorio + Fichero;          |QBF NFichero;
     aFicheroCar = NFichero;

     Fichero  = "wb  "+ NFichero;
     Pos = -1;
     |FABRE Fichero;
     Handle1 = FSalida;

     |SI FSalida ] 0;
        |SI #0#39 [ 1999;  |HAZ Caratula1999;  |FINSI;
        |SI #0#39 = 2000;  |HAZ Caratula2000;  |FINSI;
        |SI #0#39 = 2001;  |HAZ Caratula2000;  |FINSI;
        |SI #0#39 ] 2002;  |HAZ Caratula2002;  |FINSI;
     |FINSI;

     FSalida = Handle; |FCIERRA FSalida;
     NACopiar   = NACopiar + 1;

     |SI #0#39 [ 2005;  |ACABA;  |FINSI;

     aOrigen = aFicheroTxt;
     aDestino = aPathLocal + "RTA" + (("00000" + nEmpresa) % -105) + ".TXT";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     aOrigen = aFicheroCar;
     aDestino = aPathLocal + "RTB" + (("00000" + nEmpresa) % -105) + ".TXT";

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     eaTipoE =  "RTA" + (("00000" + #30#0) % -105) + ".TXT";
     eaTipoR =  "RTC" + (("00000" + #30#0) % -105) + ".TXT";
     eaTipoP =  "PDF" + (("00000" + #30#0) % -105) + ".PDF";

     |SI nTecla = 1;
         eaTipoC =  aTercera;
         eaTipoA =  "RTB" + (("00000" + #30#0) % -105) + ".TXT";
         eaTipoV =  "N";
     |SINO;
         eaTipoV =  "S";
     |FINSI;

     |HAZ LineaShellJava;
|FPRC;

|DEFBUCLE eosm0040L;
     #30#1;
     ;
     #0#0, #0#39;
     #0#1, #0#39;
     ;
     NULL, DesarrollaLaser;
|FIN;

|PROCESO PlanillaLaser;
     #30#0 = #14#1;
     #30#1 = #0#39;
     |LEE 000#30=;
     |SI FSalida = 0;  |HAZ DesarrollaLaser;  |FINSI;
|FPRC;

|DEFBUCLE eosm0014L;
     #14#1;
     ;
     #0#38, 00000;
     #0#38, 99999;
     ;
     NULL, PlanillaLaser;
|FIN;

|PROCESO Laser;
     |SI #0#0 = 0;
         |SI #0#38 = 0;
             |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |SI #0nCampoD ! 0;
                       #30#0 = #0nCampoD;
                       #30#1 = #0#39;
                       |LEE 000#30=;
                       |SI FSalida = 0;  |HAZ DesarrollaLaser;  |FINSI;
                   |FINSI;
             |SIGUE;
         |SINO;
             |BUCLE eosm0014L;
         |FINSI;
     |SINO;
         |CIERRAT #30;  |BUCLE eosm0040L;  |ABRET #30;
     |FINSI;

     |SI #0#39 [ 2005;
         |HAZ GrabaDisketteL;
     |FINSI;
|FPRC;


|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|| POR PAPEL OFICIAL
|| 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Interiores;

|PUSHV 0501 2380;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #eosy0011#39 [ 1999;
        |INFOR "eosy2011";
     |SINO;
        |INFOR "eosy2111";
     |FINSI;
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     nSwLectura = 3;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;

     |FININF;
     |FINIMP;
|POPV;
|FPRC;

|PROCESO MenuPap;
     nSwDeDonde = 3;
     |HAZ Individual;
     |PUSHV 0501 2380;
     |PARA; |SI; |HACIENDO;
            |MENUG aMenuPap;
            aMenuPap2 = FSalida;
            |SI aMenuPap2 < "1";  |O aMenuPap2 > "2";  |SAL;  |FINSI;

            |SI aMenuPap2 = "1";  |HAZ Portadas;    |FINSI;
            |SI aMenuPap2 = "2";  |HAZ Interiores;  |FINSI;
     |SIGUE;
     |POPV;
     nSwLectura = 1;  |CIERRAT #81;  |BUCLE eosw0081C;  |ABRET #81;
|FPRC;

|PROCESO Menus;
     enAnyo = #0#39;
     Sw = 0;
     |SI enAnyo ] 2001; |Y #0#41 = "PESETAS";
        aAlfa = "2,8,0"; |MENUITEM 0,aAlfa;
        Sw = 1;
     |FINSI;
     |CLS;
     |CUADRO 0501 2380;
     |BLANCO 0602 2279;
     |PARA; |SI; |HACIENDO;
            INEmpresas = NEmpresas1 <-;
            |PARA XPara = 1; |SI XPara [ 700; |HACIENDO XPara = XPara + 1;
                  NEmpresas = "";
                  INEmpresas = INEmpresas + 1;
            |SIGUE;
            NACopiar   = 0;

            |SI #eosy0011#39 > 1999;
               |HAZ QueVersion;
               |SI enSwDirecta = 1;
                   aMenu3 = "5";
                   aMenu8 = "Ver Errores";
               |SINO;
                   aMenu3 = "4";
                   aMenu8 = "";
               |FINSI;
            |FINSI;

            |MENUG aMenu;
            aMenu2 = FSalida;

            |SI #eosy0011#39 > 1999;
               |SI enSwDirecta = 1;
                  |SI aMenu2 < "1";  |O aMenu2 > "5";  |SAL;  |FINSI;
               |SINO;
                  |SI aMenu2 < "1";  |O aMenu2 > "4";  |SAL;  |FINSI;
               |FINSI;
            |SINO;
               |SI aMenu2 < "1";  |O aMenu2 > "3";  |SAL;  |FINSI;
            |FINSI;

            |SI aMenu2 = "1";  |HAZ MenuPap;    |FINSI;
            |SI aMenu2 = "2";  |HAZ MenuCol; |FINSI;
            |SI aMenu2 = "3";  |HAZ MenuInd; |FINSI;
            |SI aMenu2 = "4";  |HAZ Laser;   aMenu2 = "5"; |FINSI;
            |SI aMenu2 = "5";  |HAZ Errores180; |FINSI;
     |SIGUE;
     |SI Sw = 1;  aAlfa = "2,8,0"; |MENUITEM 0,aAlfa; |FINSI;
|FPRC;

|PROCESO Tipo8;
     |ABRE #100;
     |LEE 000#100p;
     |SI FSalida ! 0; |DDEFECTO #100; |FINSI;
     |CIERRA #100;

     |SI #100#11 = 1; |ACABA; |FINSI;

     |ABRE #101;
     |LEE 000#101p;
     |SI FSalida ! 0; |CIERRA #101; |ACABA; |FINSI;
     |CIERRA #101;

     aPathFich = #101#8; |QBF aPathFich;
     |SI aPathFich = "*";  |ACABA;  |FINSI;
     aPathPan = (aPathFich - "fich/") + "pan/";

     |PATH_DAT #103 aPathFich;
     |PATH_PAN #103 aPathPan;
|FPRC;

|PROCESO Ejercicio2005;
     |SI #eosy0011#39 > 1999;
         aMenu3 = "4";
         aMenu7    = "Laser (No mas de 25 perceptores)         ";
     |FINSI;

     |HAZ Menus;
|FPRC;

|PROCESO Boton1801;
     |PTEC 824;
|FPRC;

|PROCESO Boton1802;
     |PTEC 825;
|FPRC;

|PROCESO Boton1803;
     |PTEC 826;
|FPRC;

|PROCESO Boton1804;
     |PTEC 827;
|FPRC;

|PROCESO Boton1805;
     |PTEC 828;
|FPRC;

|PROCESO Boton1806;
     |PTEC 829;
|FPRC;

|PROCESO Boton1807;
     |PTEC 806;
|FPRC;

|PROCESO Botones180_2006;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Emision Papel Oficial Laser (Directo por impresora) ", 0513, 0654, Boton1801;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Emision Papel Oficial Laser (Vista previa por el Acrobat) ", 0813, 0954, Boton1802;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica Individual (Con validacion)", 1113, 1254, Boton1803;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Presentacion Telematica Colectiva (Sin validacion)", 1413, 1554, Boton1804;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F7> Directorio Acrobat  ", 1713, 1854, Boton1806;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, Boton1807;
     nBoton7 = FSalida;

     aF2 = &255 + "824";
     aF3 = &255 + "825";
     aF4 = &255 + "826";
     aF5 = &255 + "827";
     aF6 = &255 + "828";
     aF7 = &255 + "829";
     aF8 = &255 + "806";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  nTecla = 1; eaModoImpre = "I";    |SAL;  |FINSI;
         |SI aTecla = aF3;  nTecla = 1; eaModoImpre = "P";    |SAL;  |FINSI;
         |SI aTecla = aF4;  nTecla = 3;                       |SAL;  |FINSI;
         |SI aTecla = aF5;  nTecla = 4;                       |SAL;  |FINSI;
         |SI aTecla = aF7;  |HAZ Acrobat;                            |FINSI;
         |SI aTecla = aF8;  nTecla = 0;   |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;

     |PULSATECLA;

     aPathLocal = "\MODELOS";                       |RMKDIR aPathLocal;
     aPathLocal = "\MODELOS\180";                   |RMKDIR aPathLocal;
     aPathLocal = "\MODELOS\180\" + #0#39;          |RMKDIR aPathLocal;
     aPathLocal = "\MODELOS\180\" + #0#39 + "\";

     |SI nTecla = 1;
         aTercera = "N";
         aAlfa    = "0000NDesea la impresion de la tercera copia  ";
         |CONFI aAlfa;
         |SI FSalida = 0;  aTercera = "S";  |FINSI;

         |HAZ Laser;
     |FINSI;

     |SI nTecla = 3;
         |SI #0#0 = 0;
             |CUADRO 0501 2380;
             |BLANCO 0602 2279;
             |PINTA 0702, "PARA EMITIR LA INDIVIDUAL PONER EN EL DESDE/HASTA DE";
             |PINTA 0802, "LA SELECCION DE EMPRESAS EL MISMO CODIGO DE CLIENTE,";
             |PINTA 0902, "YA QUE CREAMOS UN DISKETTE POR EMPRESA.             ";
             |PAUSA;
             |ACABA;
         |FINSI;

         |SI #0#0 ! 0;
             |SI #0#1 ! #0#0;
                 |CUADRO 0501 2380;
                 |BLANCO 0602 2279;
                 |PINTA 0702, "PARA EMITIR LA INDIVIDUAL PONER EN EL DESDE/HASTA DE";
                 |PINTA 0802, "LA SELECCION DE EMPRESAS EL MISMO CODIGO DE CLIENTE,";
                 |PINTA 0902, "YA QUE CREAMOS UN DISKETTE POR EMPRESA.             ";
                 |PAUSA;
                 |ACABA;
            |FINSI;
         |FINSI;

         |HAZ Laser;
     |FINSI;

     |SI nTecla = 4;
         |HAZ MenuCol;
     |FINSI;
|FPRC;

|PROCESO CopiaInternet;
     aAlfa      = "/AEAT";                      |RMKDIR aAlfa;
     aAlfa      = "/AEAT/INTERNET";             |RMKDIR aAlfa;
     aAlfa      = "/AEAT/INTERNET/180";         |RMKDIR aAlfa;
     aAlfa      = "/AEAT/INTERNET/180/" + #0#39; |RMKDIR aAlfa;

     |SI nTecla = 3;
         aOrigen  = "/MODELOS/180/" + #0#39 + "/AINTERNET/RTA" + (("00000" + nEmpresa) % -105) + ".BUE";
         aDestino = "/AEAT/INTERNET/180/" + #0#39 + "/" + "RTP" + (("00000" + nEmpresa) % -105) + ".TXT";
         |RCOPIA_FICHERO aOrigen, aDestino;
         |RFBORRA aOrigen;
     |SINO;
         aOrigen  = "/MODELOS/180/" + #0#39 + "/RTA" + #0#6 + ".TXT";
         aDestino = "/AEAT/INTERNET/180/" + #0#39 + "/RTPA" + #0#39 + ".TXT";
         |RCOPIA_FICHERO aOrigen, aDestino;
         |RFBORRA aOrigen;
     |FINSI;

     aAlfa = "     Los ficheros generados estan en el directorio \AEAT\INTERNET\180\" + #0#39;
     |MENAV aAlfa;
|FPRC;

|PROCESO Ejercicio2006;
     enAnyo     = #0#39;
     eaModelos  = "180";
     eaEjer     = #0#39;

     |HAZ Botones180_2006;

     eaFichError  = "rtc";
     eaFichDatos  = "rta";
     eaFichAuxil  = "rtb";

     |SI nTecla = 1;
         enValidacion = 0;
         |HAZ BuscaErroresL;
     |FINSI;

     |SI nTecla = 3;
         enValidacion = 1;
         |HAZ BuscaErroresL;
         |SI enError ! 0;
             |MENAV "      Ha habido Errores, arreglelos y vuelva a emitir.";
             |ACABA;
         |FINSI;

         |HAZ CopiaInternet;
     |FINSI;
|FPRC;

|PROCESO Bloque2011;
     |ABRE #eosm0044;

     |SI #0#39 [ 2005;  |HAZ Ejercicio2005;  |FINSI;
     |SI #0#39 ] 2006;  |HAZ Ejercicio2006;  |FINSI;

     |CIERRA #eosm0044;
|FPRC;

|PROCESO Tipo1_2012;
     |ABRE #eosclien;
     #eosclien#0 = #30#0;
     |LEE 000#eosclien.=;
     |CIERRA #eosclien;

     Cadena = "1180";  |XGRABA nHandle2, Cadena;
     Comodin = #81#4;  |XGRABA nHandle2, Comodin;
     Comodin = #eosclien#1; |QBF Comodin;
     Comodin = ("         " + Comodin) % -109;  |XGRABA nHandle2, Comodin;
     aAlfa   = #eosclien#2;  |HAZ QuitaComas; Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140;
     |XGRABA nHandle2, aAlfa;

     Comodin = "T";   |XGRABA nHandle2, Comodin;

     Comodin = #30#16; |QBF Comodin; Comodin = (("0" * 9) + Comodin) % -109;
     |XGRABA nHandle2, Comodin;

     aAlfa   = #30#15; |HAZ QuitaComas; Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140;
     |XGRABA nHandle2, aAlfa;

     Comodin = "1800000000000";
     |XGRABA nHandle2, Comodin;

     |SI #30#3 = "C"; Comodin = "C"; |SINO; Comodin = " "; |FINSI;
     |XGRABA nHandle2, Comodin;

     |SI #30#3 = "S";
         Comodin = "S180";
         Comodin = Comodin + #30#4 + #30#5 + #30#6 + #30#7 + #30#8 + #30#9;
         Comodin = Comodin + #30#10 + #30#11 + #30#12 + #30#13;
     |SINO;
         Comodin = " 0000000000000";
     |FINSI;
     |XGRABA nHandle2, Comodin;

     TotalArrend  = 0; TotalRendDin = 0; TotalReteDin = 0; TotalRendEsp = 0;
     TotalIngACta = 0; Devengo = -1; NifAnt = ""; RegisAnt = 0;
     |BUCLE CuentaArrend;

     nCanti  = TotalArrend;  |HAZ Valor9;
     Comodin = aCanti;
     |XGRABA nHandle2, Comodin;

     TotalRendDin = TotalRendDin + TotalRendEsp;
     TotalReteDin = TotalReteDin + TotalIngACta;
     |SI TotalRendDin ] 0;
        Comodin = " ";
     |SINO;
        Comodin = "N";
        TotalRendDin = -TotalRendDin; TotalReteDin = -TotalReteDin;
     |FINSI;
     nCanti = TotalRendDin;  |HAZ Valor15;  Comodin = Comodin + aCanti;
     |XGRABA nHandle2, Comodin;

     nCanti = TotalReteDin;  |HAZ Valor15; Comodin = aCanti;
     |XGRABA nHandle2, Comodin;

     Comodin = " " * 75;
     |XGRABA nHandle2, Comodin;
     |SI #0#39 ] 2014;
         Comodin = " " * 250;
         |XGRABA nHandle2, Comodin;
     |FINSI;

     |SI eaOpcion = "3";
         Comodin = &13 + &10;
         |XGRABA nHandle2, Comodin;
     |FINSI;
|FPRC;

|PROCESO Tipo2_2012;

     |SI #0#39 ] 2014;

         |HAZ Tipo2_2014;

     |SINO;
         Comodin = "2180"; Cadena = Comodin;
         Comodin = #30#1;  Cadena = Cadena + Comodin;

         Comodin = #eosclien#1; |QBF Comodin;
         Comodin = ((" " * 9) + Comodin) % -109;

         Cadena = Cadena + Comodin;
         Comodin = #eosm0044#2; |QBF Comodin;
         Comodin = ((" " * 9) + Comodin) % -109;
         |SI #eosm0044#9 = "S";
            Comodin = "         " + Comodin;
         |SINO;
            Comodin = Comodin + "         ";
         |FINSI;
         Cadena = Cadena + Comodin;
         aAlfa = #eosm0044#12; |HAZ QuitaComas; |QBF aAlfa;
         Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140; Cadena = Cadena + aAlfa;
         Comodin = #eosm0044#10 % 0102; Comodin = ("00" + Comodin) % -102;
         Cadena = Cadena + Comodin;
         |XGRABA nHandle2, Cadena;

         |SI #eosm0044#4 ! 0;
             Cadena = "1";
         |SINO;
             Cadena = "2";
         |FINSI;
         |XGRABA nHandle2, Cadena;

         |SI #eosm0044#4 < 0;
            Cadena = "N";
         |SINO;
            Cadena = " ";
         |FINSI;
         |XGRABA nHandle2, Cadena;

         |SI #eosm0044#4 ! 0;
            nCanti = #eosm0044#4; |HAZ Valor13;
            Calc = #eosm0044#14;
         |SINO;
            nCanti = #eosm0044#6; |HAZ Valor13;
            Calc = #eosm0044#15;
         |FINSI;

         |XGRABA nHandle2, aCanti;

         nCanti = Calc;       || Porcentaje
         nCanti = nCanti ! 0; Comodin = ("00" + nCanti) % -102;
         nCanti = (Calc - nCanti) * 100; Comodin = Comodin + (("00" + nCanti)% -102);
         |XGRABA nHandle2, Comodin;

         |SI #eosm0044#4 ! 0;
            nCanti = #eosm0044#5; |HAZ Valor13;
         |SINO;
            nCanti = #eosm0044#7; |HAZ Valor13;
         |FINSI;
         |XGRABA nHandle2, aCanti;

         Comodin = ("0000" + #eosm0044#3) % -104;
         |XGRABA nHandle2, Comodin;
         Cadena = " " * 137;
         |XGRABA nHandle2, Cadena;
     |FINSI;

     |SI eaOpcion = "3";
         Comodin = &13 + &10;
         |XGRABA nHandle2, Comodin;
     |FINSI;
|FPRC;

|PROCESO Tipo2_2014;
         Comodin = "2180"; Cadena = Comodin;
         Comodin = #30#1;  Cadena = Cadena + Comodin;

         Comodin = #eosclien#1; |QBF Comodin;
         Comodin = ((" " * 9) + Comodin) % -109;

         Cadena = Cadena + Comodin;
         Comodin = #eosm0044#2; |QBF Comodin;
         Comodin = ((" " * 9) + Comodin) % -109;
         |SI #eosm0044#9 = "S";
            Comodin = "         " + Comodin;
         |SINO;
            Comodin = Comodin + "         ";
         |FINSI;
         Cadena = Cadena + Comodin;
         aAlfa = #eosm0044#12; |HAZ QuitaComas; |QBF aAlfa;
         Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 0140; Cadena = Cadena + aAlfa;
         Comodin = #eosm0044#10 % 0102; Comodin = ("00" + Comodin) % -102;
         Cadena = Cadena + Comodin;
         |XGRABA nHandle2, Cadena;

         |SI #eosm0044#4 ! 0;
             Cadena = "1";
         |SINO;
             Cadena = "2";
         |FINSI;
         |XGRABA nHandle2, Cadena;

         |SI #eosm0044#4 < 0;
            Cadena = "N";
         |SINO;
            Cadena = " ";
         |FINSI;
         |XGRABA nHandle2, Cadena;

         |SI #eosm0044#4 ! 0;
            nCanti = #eosm0044#4; |HAZ Valor13;
            Calc = #eosm0044#14;
         |SINO;
            nCanti = #eosm0044#6; |HAZ Valor13;
            Calc = #eosm0044#15;
         |FINSI;

         |XGRABA nHandle2, aCanti;

         nCanti = Calc;       || Porcentaje
         |SI #0#39 = 2014;
             |SI nCanti ! 21; |Y nCanti ! 10.5;
              |Y nCanti > 0;
                 |SI nCanti ] 11;  nCanti = 21;    |FINSI;
                 |SI nCanti < 11;  nCanti = 10.5;  |FINSI;
             |FINSI;
         |FINSI;

         |SI #0#39 = 2015;
             |SI nCanti ! 20; |Y nCanti ! 19.5;
              |Y nCanti ! 10; |Y nCanti ! 9.75;
              |Y nCanti > 0;
                 |SI nCanti < 20;  nCanti = 19.5;  |FINSI;
                 |SI nCanti < 12;  nCanti = 10;    |FINSI;
                 |SI nCanti < 10;  nCanti = 9.75;  |FINSI;
                 |SI nCanti > 20;  nCanti = 20;    |FINSI;
             |FINSI;
         |FINSI;

         nCanti = nCanti * 100; Comodin = ("0000" + nCanti) % -104;
         |XGRABA nHandle2, Comodin;

         |SI #eosm0044#4 ! 0;
            nCanti = #eosm0044#5; |HAZ Valor13;
         |SINO;
            nCanti = #eosm0044#7; |HAZ Valor13;
         |FINSI;
         |XGRABA nHandle2, aCanti;

         Comodin = ("0000" + #eosm0044#3) % -104;
         |XGRABA nHandle2, Comodin;

         Comodin = #eosm0045#16;   || Situacion Inmueble
         |XGRABA nHandle2, Comodin;

         aAlfa  = #eosm0045#5;  |HAZ QuitaComas;   |QBF aAlfa;   || Ref. Catastral
         Comodin = " " * 40; aAlfa = (aAlfa + Comodin) % 120;
         |XGRABA nHandle2, aAlfa;

         aAlfa   = #eosm0045#10;  |HAZ ComparaSiglas;  || SG
         aAlfa = (aAlfa + "     ") % 105;
         |XGRABA nHandle2, aAlfa;

         aAlfa  = #eosm0045#11;  |HAZ QuitaComas;     |QBF aAlfa;
         Comodin = " " * 50; aAlfa = (aAlfa + Comodin) % 150;
         |XGRABA nHandle2, aAlfa;

         Comodin = "   ";
         |SI #eosm0045#12 ! "    "; Comodin = "NUM"; |FINSI;

         nNume = #eosm0045#12;
         aAlfa = ( "00000" + nNume) % -105; || Numero Casa
         Comodin = Comodin + aAlfa;

         Comodin = Comodin + "         ";  || cal, bloque y portal

         aAlfa = #eosm0045#13; || Escalera
         Comodin = Comodin + aAlfa;

         aAlfa = #eosm0045#14 + " ";  || Piso
         Comodin = Comodin + aAlfa;

         aAlfa = #eosm0045#15 + " "; || Puerta
         Comodin = Comodin + aAlfa;
         |XGRABA nHandle2, Comodin;

         Comodin = " " * 70;
         |XGRABA nHandle2, Comodin;

         aAlfa = #eosm0045#8;  |HAZ QuitaComas; |QBF aAlfa; || Municipio
         Comodin = " " * 30; aAlfa = (aAlfa + Comodin) % 0130;
         |XGRABA nHandle2, aAlfa;

         aAlfa = #eosm0045#17;  || Codigo Municipio
         Comodin = ("00000" + aAlfa) % -105;
         |XGRABA nHandle2, Comodin;

         aAlfa = ("00" + #eosm0045#6) % -102;
         |XGRABA nHandle2, aAlfa;
         aAlfa = (("00" + #eosm0045#6) % -102) + (("000" + #eosm0045#7) % -103);
         |XGRABA nHandle2, aAlfa;

         Cadena = " " * 173;
         |XGRABA nHandle2, Cadena;
|FPRC;

|PROCESO eosm0044_2012;
     |SI nSwLectura = 1;
         |SI #eosy0011#39 > 1999;
            |SI #eosm0044#4 ! 0; #81#31 = #81#31 + 1; |FINSI;
            |SI #eosm0044#6 ! 0; #81#31 = #81#31 + 1; |FINSI;
         |SINO;
            #81#31 = #81#31 + 1;
         |FINSI;

         #81#32 = #81#32 + #34#5;
         #81#33 = #81#33 + #34#7;
         #81#53 = #81#53 + #34#4;
         #81#54 = #81#54 + #34#6;
     |FINSI;

     |SI nSwLectura = 2;
         |DDEFECTO #eosm0045;
         #eosm0045#0 = #eosm0044#0;
         #eosm0045#1 = #eosm0044#2;
         #eosm0045#4 = #eosm0044#16;
         |LEE 041#eosm0045.=;

         |SI #eosm0044#4 ! 0; |Y #eosm0044#6 ! 0;
             Percep = #eosm0044#6; Reten = #eosm0044#7;
             #eosm0044#6 = 0; #eosm0044#7 = 0;

             |HAZ Tipo2_2012;
             #eosm0044#6 = Percep; #eosm0044#7 = Reten;
             Percep = #eosm0044#4; Reten = #eosm0044#5;
             #eosm0044#4 = 0;

             |HAZ Tipo2_2012;
             #eosm0044#4 = Percep; #eosm0044#5 = Reten;
        |SINO;

            |HAZ Tipo2_2012;
        |FINSI;
     |FINSI;

     #eosm0044#13 = "S";
     |GRABA 020#eosm0044.a;
|FPRC;

|DEFBUCLE eosm0044_2012;
     #34#1;
     8;
     #30#0, #30#1, "            ", 0000, 01, aDComple;
     #30#0, #30#1, "zzzzzzzzzzzz", 9999, 99, aHComple;
     ;
     NULL, eosm0044_2012;
|FIN;

|PROCESO GeneraFicheros2012;
     #1#0 = #30#0;
     |LEE 000#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

     #3#0 = #1#18; #3#1 = #1#19;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #2#0 = #1#0;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     |DDEFECTO #81;
     #81#0  = #3#2;
     #81#1  = #3#3;
     #81#2  = #3#0;
     #81#3  = #3#1;
     #81#4  = #30#1;
     #81#5  = "X";
     #81#6  = " ";
     #81#7  = " ";
     #81#8  = " ";
     #81#9  = #1#1;
     #81#10 = #1#14;
     #81#11 = #1#2;
     #81#12 = #1#4;
     aAlfa  = #1#5;  |HAZ QuitaComas;
     #81#13 = aAlfa;
     aAlfa  = #1#6;  |QBT aAlfa;
     #81#14 = ("00000" + aAlfa) % -105;
     aAlfa  = #1#13;  |HAZ QuitaComas;
     #81#15 = aAlfa;
     #81#16 = #1#12;
     #81#17 = #1#10;
     #81#18 = #1#11;

     |SI #30#3 = "C";  #81#19 = "X";  |FINSI;
     |SI #30#3 = "S";  #81#20 = "X";  |FINSI;

     #81#21 = #30#4;
     #81#22 = #30#5;
     #81#23 = #30#6;
     #81#24 = #30#7;
     #81#25 = #30#8;
     #81#26 = #30#9;
     #81#27 = #30#10;
     #81#28 = #30#11;
     #81#29 = #30#12;
     #81#30 = #30#13;
     #81#46 = #30#17;
     #81#47 = #30#18;
     #81#49 = #30#0;

     aDComple = " ";
     aHComple = "z";
     |SI #30#3 = "C";
         aDComple = "S";
         aHComple = "S";
     |FINSI;

     nSwLectura = 1; |BUCLE eosm0044_2012;

     eaFicheroPlano = eaModelos + (("00000" + #30#0) % -105) + ".txt";
     eaFicheroImpre = eaModelos + (("00000" + #30#0) % -105) + ".imp";
     eaFicheroSalid = eaModelos + (("00000" + #30#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #30#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     aTipoP = "C";
     |HAZ Tipo1_2012;

     |ABRE #eosm0045;
     nSwLectura = 2;  |BUCLE eosm0044_2012;
     |CIERRA #eosm0045;

     |XCIERRA nHandle2;

     enEmpresa    = #30#0;
     eaNomEmpresa = #1#2;
     |HAZ PresentaPortal;

     |SI eaOpcion ! "1";  |Y enErrorPortal = 0;
         #eosm0040#14 = "S";
         |GRABA 020#eosm0040.a;
     |FINSI;

     |LIBERA #eosm0040;
|FPRC;

|PROCESO eosm0014_2012;
     #30#0 = #14#1;
     #30#1 = #0#39;
     |LEE 101#30=;
     |SI FSalida = 0;  |HAZ GeneraFicheros2012;  |FINSI;
|FPRC;

|DEFBUCLE eosm0014_2012;
     #14#1;
     ;
     #0#38, 00000;
     #0#38, 99999;
     ;
     NULL, eosm0014_2012;
|FIN;

|DEFBUCLE eosm0040_2012;
     #30#1;
     ;
     #0#0, #0#39;
     #0#1, #0#39;
     be;
     NULL, GeneraFicheros2012;
|FIN;

|PROCESO Bloque2012;
     enAnyo     = #0#39;
     eaModelos  = "180";
     eaEjer     = #0#39;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ Botones_2012;
     |SI eaOpcion = "0";  |ACABA;  |FINSI;

     nTecla = 1;

     |SI #0#0 = 0;
         |SI #0#38 = 0;
             |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |SI #0nCampoD ! 0;
                       #30#0 = #0nCampoD;
                       #30#1 = #0#39;
                       |LEE 101#30=;
                       |SI FSalida = 0;  |HAZ GeneraFicheros2012;  |FINSI;
                   |FINSI;
             |SIGUE;
         |SINO;
             |BUCLE eosm0014_2012;
         |FINSI;
     |SINO;
         |CIERRAT #30;
         |BUCLE eosm0040_2012;
         |ABRET #30;
     |FINSI;

     |SI eaOpcion = "3";
         |HAZ SacaErrorPtl;

         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2015;
     enAnyo     = #0#39;
     eaModelos  = "180";
     eaEjer     = #0#39;

     #dsmoy000#0 = 180;
     #dsmoy000#6 = enAnyo;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ Botones_2015;
     |SI eaOpcion = "0";  |ACABA;  |FINSI;

     nTecla = 1;

     |SI #0#0 = 0;
         |SI #0#38 = 0;
             |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |SI #0nCampoD ! 0;
                       #30#0 = #0nCampoD;
                       #30#1 = #0#39;
                       |LEE 101#30=;
                       |SI FSalida = 0;  |HAZ GeneraFicheros2012;  |FINSI;
                   |FINSI;
             |SIGUE;
         |SINO;
             |BUCLE eosm0014_2012;
         |FINSI;
     |SINO;
         |CIERRAT #30;
         |BUCLE eosm0040_2012;
         |ABRET #30;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Procede;
     |SI #0#39 [ 2011;  |HAZ Bloque2011;  |ACABA;  |FINSI;
     |SI #0#39 [ 2014;  |HAZ Bloque2012;  |ACABA;  |FINSI;
     |SI #0#39 ] 2015;  |HAZ Bloque2015;  |ACABA;  |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidad;
     |HAZ Tipo8;

     aFichero = (Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #81 aFichero;
     |ABRET #81;
     #81#48 = 0;
     |LEE 101#81=;
     |SI FSalida = 0;
         #81#31 = 0;
         #81#32 = 0;
         #81#33 = 0;
         #81#34 = 0;
         #81#35 = 0;
         |GRABA 020#81a;
     |FINSI;
     |LIBERA #81;

     |ABRET #1;
     |ABRET #2;
     |ABRET #3;
     |ABRET #30;

     aTipoSec = "180";
     |SI enEmpresa = 0;
         |CLS;
         |CABEZA "      Emision Modelo 180";
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida = 0;
             |HAZ Procede;
         |FINSI;
     |SINO;
         |ABRE #28;
         #28#0 = enEmpresa;
         #28#1 = enEjercic;
         |LEE 000#28=;
         |SI FSalida ! 0;  |DDEFECTO #28;  |FINSI;
         |CIERRA #28;

         |PINPA #0#0;
         #0#0  = enEmpresa;
         #0#1  = enEmpresa;
         #0#38 = 0;           |C_M #0#38, 1, "N";
         #0#39 = enEjercic;   |C_M #0#39, 1, "N";

         |PINDA #0#0;

         |PTEC 802;
         |PTEC 802;
         |ENDATOS #1#0;
         |SI FSalida = 0;
             |HAZ Procede;
         |FINSI;
     |FINSI;

     |CIERRAT #1;
     |CIERRAT #2;
     |CIERRAT #3;
     |CIERRAT #30;
     |CIERRAT #81;
|FPRO;
