|FICHEROS;
   eosre300 #0;
   eosr1300 #1;
   eosclien #2;
   eosactiv #3;
   eosm1300 #5;
   eosm1303 #55;
|FIN;

|VARIABLES;
 &Empresa    = 0;
 &el_anyo    = 0;

 XPara       = 0;
 xxxxfiac    = "  ";
 xxaponer    = "  ";
 xrelleno    = "                              ";
 sw_hay      = 0;
 varii       = 0;
 varic       = 0;
 varib       = 0;
 aa          = 0;
 total       = 0;
|FIN;

|INCLUYE i_anyode;
|INCLUYE i_consul;

|PROCESO pinta_anyo; |TIPO 7;
     |HAZ i_anyodef;
     #0#2 = i_anyodef;
     |PINTA #0#2;
|FPRC;

|PROCESO nomodi;|TIPO 7;
     |SI #0#4 = "S"; |ACABA; |FINSI;
     #0#0 = 1;     |PINTA #0#0;
     #0#1 = 99999; |PINTA #0#1;
     |HAZ nomodifi;
|FPRC;

|PROCESO nomodi1;|TIPO 7;
     |SI #0#4 = "N"; |ACABA; |FINSI;
     |HAZ nomodifi;
|FPRC;

|PROCESO nomodifi;             || rutina de conversion a no modificables
     xxaponer = Anono;
     xxxxfiac = Control % A1001;
     Control = Control + xxxxfiac;
     Control = Control + xrelleno;
     Control = Control % A120;
     Control = Control + xxaponer;
|FPRC;

|PROCESO cuadro; |TIPO 7;
     |PUSHV 0501 2380;

     |CUADRO 642 1879;
     |ATRI R;
     |PINTA 0743, "   Calcula el campo de Resultado    ";
     |PINTA 0843, " Multiple Periodo del mantenimiento ";
     |PINTA 0943, " del 300, para poder controlar el   ";
     |PINTA 1043, " resultado correcto del a compensar ";
     |PINTA 1143, " o del a ingresar de un trimestre a ";
     |PINTA 1243, " otro.                              ";
     |PINTA 1343, "                                    ";
     |PINTA 1443, "   Calcular siempre desde el primer ";
     |PINTA 1543, " trimestre, ya que cuando calcula-  ";
     |PINTA 1643, " mos un trimestre ponemos el a com- ";
     |PINTA 1743, " pensar correcto en el siguiente.   ";
     |ATRI 0;
|FPRC;

|PROCESO reponer; |TIPO 0;
     |POPV;
     |PINDA #0#0;
|FPRC;

|PROCESO eosm1300Calcula;
     sw_hay = 1;
     varii  = varii + #5#33;
     varic  = varic + #5#32 + #5#31;
|FPRC;

|DEFBUCLE eosm1300Calcula;
     #5#1;
     ;
     #2#0, 1, #0#3, #0#2;
     #2#0, 6, #0#3, #0#2;
     ;
     NULL, eosm1300Calcula;
|FIN;

|PROCESO eosm1300Graba;
     #5#55 = 0;
     |SI #5#33 ! 0; |Y varib > 0;
         |SI #5#33 ] varib;
             #5#55 = varib;
             varib = 0;
         |SINO;
             #5#55 = #5#33;
             varib = varib - #5#55;
         |FINSI;
     |FINSI;
     |SI #5#32 ! 0; |Y varib < 0;
         |SI #5#32 ] varib;
             #5#55 = varib;
             varib = 0;
         |SINO;
             #5#55 = #5#32;
             varib = varib - #5#55;
         |FINSI;
     |FINSI;
     |SI #5#31 ! 0; |Y varib < 0;
         |SI #5#31 ] varib;
             #5#55 = varib;
             varib = 0;
         |SINO;
             #5#55 = #5#31;
             varib = varib - #5#55;
         |FINSI;
     |FINSI;
     |GRABA 020#5a;

/*
     #1#0 = #5#0;
     #1#1 = #5#45;
     #1#2 = #5#1;
     #1#3 = #5#2;
     #1#4 = #5#55;
     |GRABA 020#1n;
     |LIBERA #1;

     |SI #5#55 > 0; |ACABA; |FINSI;

     |SI #5#1 = 4; |O #5#1 = 12;
         #3#0 = #5#0;
         #3#1 = #5#45;
         #3#2 = #0#2;
         |LIBERA #3;
         |LEE 110#3=;
         |SI FSalida = 0;
             #3#34 = 0;
             |SI #3#27 = "C";  #3#34 = -#5#55; |FINSI;
             |GRABA 020#3a;
         |FINSI;
     |FINSI;
*/
|FPRC;

|DEFBUCLE eosm1300Graba;
     #5#1;
     ;
     #2#0, 1, #0#3, #0#2;
     #2#0, 6, #0#3, #0#2;
     be;
     NULL, eosm1300Graba;
|FIN;

|PROCESO eosm1303Calcula;
     sw_hay = 1;
     varii  = varii + #55#33;
     varic  = varic + #55#32 + #5#31;
|FPRC;

|DEFBUCLE eosm1303Calcula;
     #55#1;
     ;
     #2#0, 1, #0#3, #0#2;
     #2#0, 6, #0#3, #0#2;
     ;
     NULL, eosm1303Calcula;
|FIN;

|PROCESO eosm1303Graba;
     #55#55 = 0;
     |SI #55#33 ! 0; |Y varib > 0;
         |SI #55#33 ] varib;
             #55#55 = varib;
             varib = 0;
         |SINO;
             #55#55 = #55#33;
             varib = varib - #55#55;
         |FINSI;
     |FINSI;
     |SI #55#32 ! 0; |Y varib < 0;
         |SI #55#32 ] varib;
             #55#55 = varib;
             varib = 0;
         |SINO;
             #55#55 = #55#32;
             varib = varib - #55#55;
         |FINSI;
     |FINSI;
     |SI #55#31 ! 0; |Y varib < 0;
         |SI #55#31 ] varib;
             #55#55 = varib;
             varib = 0;
         |SINO;
             #55#55 = #55#31;
             varib = varib - #55#55;
         |FINSI;
     |FINSI;
     |GRABA 020#55a;
|FPRC;

|DEFBUCLE eosm1303Graba;
     #55#1;
     ;
     #2#0, 1, #0#3, #0#2;
     #2#0, 6, #0#3, #0#2;
     be;
     NULL, eosm1303Graba;
|FIN;

|PROCESO eosclien;
     sw_hay = 0;
     varii  = 0;
     varic  = 0;
     varib  = 0;
     |BUCLE eosm1300Calcula;
     varib = varii - varic;
     |SI sw_hay ! 0;
        |BUCLE eosm1300Graba;
     |FINSI;

     sw_hay = 0;
     varii  = 0;
     varic  = 0;
     varib  = 0;
     |BUCLE eosm1303Calcula;
     varib = varii - varic;

     |SI sw_hay ! 0;
        |BUCLE eosm1303Graba;
     |FINSI;
|FPRC;

|DEFBUCLE eosclien;
     #2#1;
     ;
     #0#0;
     #0#1;
     e;
     NULL, eosclien;
|FIN;

|PROCESO ajusta;
    |SI #1#4 = 0; |ACABA; |FINSI;

    #5#0  = #1#0;
    #5#45 = #1#1;
    #5#1  = #1#2 + 1;
    #5#2  = #1#3;
    |LEE 101#5=;
    |SI FSalida = 0;
        #5#29 = 0;
        |SI #1#4 < 0; #5#29 = -#1#4; |FINSI;
        total = #5#28 - #5#29 + #5#30;
        #5#33 = 0;
        #5#32 = 0;
        #5#31 = 0;
        |SI total > 0; #5#33 = total; |FINSI;
        |SI total < 0;
            total = -total
            |SI #5#3 ! 4;
                #5#32 = total;
            |SINO;
                |HAZ leactiv;
                |SI #3#27 = "C";
                    #5#32 = total;
                |SINO;
                    #5#31 = total;
                |FINSI;
            |FINSI;
         |FINSI;
         |GRABA 020#5a;
         |LIBERA #5;
    |FINSI;
|FPRC;

|PROCESO leactiv;
    #3#0 = #5#0;
    #3#1 = #5#45;
    #3#2 = #0#2;
    |LEE 040#3=;
    |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
|FPRC;

|DEFBUCLE eosr1300;
    #1#1;
    ;
    #0#0, 1, #0#3, #0#2;
    #0#1, 6, #0#3, #0#2;
    e;
    NULL, ajusta;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
||     |ABRE #1; |CIERRA #1; |DELINDEX #1;

||     |ABRE #1;
     |ABRE #3;
     |SI #0#4 = "S";
         |BUCLE eosclien;
     |SINO;
         |ABRE #2;
         |PARA aa = 5; |SI aa [ 28; |HACIENDO aa = aa + 1;
               |SI #0aa ! 0;
                   #2#0 = #0aa;
                   |LEE 040#2=;
                   |SI FSalida = 0;
                       |HAZ eosclien;
                   |FINSI;
               |FINSI;
         |SIGUE;
         |CIERRA #2;
     |FINSI;

/*
     |CIERRA #1;

     |SI #0#3 = 4; |CIERRA #3; |DELINDEX #1; |ACABA; |FINSI;

     |ABRE #5;
     |BUCLE eosr1300;
     |CIERRA #5;

     |DELINDEX #1;
*/

     |CIERRA #3;
|FPRC;

|PROGRAMA;
     |SI Empresa = 0;
         |CLS;
         |CABEZA "     Recalculo 300";
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
     |SINO;
         |PARA XPara = 1; |SI XPara [ 4; |HACIENDO XPara = XPara + 1;
               #0#4 = "S";
               #0#0 = Empresa;
               #0#1 = Empresa;
               #0#2 = el_anyo;
               #0#3 = XPara;
               |HAZ Tipo3;
         |SIGUE;
     |FINSI;
|FPRO;
