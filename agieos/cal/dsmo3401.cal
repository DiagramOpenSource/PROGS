|FICHEROS;
     dsmo3401;
     dsmo3402;
     dsmo3403;
     dsmo3404;
     dsmo3405;

     dsmom004;
     dsmom008;
     eosclien;
     eosactiv;

     dsmow200;
     dsmow201;
     dsmow202;
     dsmow203;
|FIN;

|VARIABLES;
     nVent       = 0;
     nDActiv     = 0;
     nHActiv     = 0;
     nPanta      = 0;
     nSubPan     = 0;
     nRango      = 0;
     nCampo      = 0;
     nFichero    = 0;
     nReg        = 0;
     nComple     = 0;
     nIdSalir    = 0;
     nBoton1     = -1;
     nBoton2     = -1;
     nBoton3     = -1;
     nBoton4     = -1;

     nSubBoton1  = -1;
     nSubBoton2  = -1;
     nSubBoton3  = -1;

     nGrid2      = -1;
     nGrid3      = -1;
     nGrid4      = -1;
     nGrid5      = -1;

     aAlfa      = "";
     aTitulo    = "";
     aEsc1      = "";
     aEsc2      = "";
     aRetu      = "";
     aTecla     = "";

     &enEmpresa     = 0;
     &enEjer        = 0;
     &enPeriodo     = 0;
     &enModelo      = 0;
     &enComplem     = 0;
     &enActividad   = 0;
     &enTipoEntrada = 0;
     &enMensa       = 0;

     {2}nNivel    = 0;

     {-1}aVent    = "";
         aVent1   = 0;
         aVent2   = 0;
         aVent3   = 0;
         aVent4   = 0;
         aVent5   = "";
|FIN;

|PROCESO QuitaBotonSalir;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO PonBotonSalir;
     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO Baja2;
     #dsmo3402#0  = #dsmo3401#0;
     #dsmo3402#1  = #dsmo3401#1;
     #dsmo3402#2  = #dsmo3401#2;
     #dsmo3402#3  = #dsmo3401#3;
     #dsmo3402#4  = #dsmo3401#4;
     #dsmo3402#5  = nDActiv;
     #dsmo3402#6  = 1;
|FPRC;

|PROCESO Alta2;
     #dsmo3402#0  = #dsmo3401#0;
     #dsmo3402#1  = #dsmo3401#1;
     #dsmo3402#2  = #dsmo3401#2;
     #dsmo3402#3  = #dsmo3401#3;
     #dsmo3402#4  = #dsmo3401#4;
     #dsmo3402#5  = nHActiv;
     #dsmo3402#6  = 999999;
|FPRC;

|PROCESO Baja3;
     #dsmo3403#0  = #dsmo3401#0;
     #dsmo3403#1  = #dsmo3401#1;
     #dsmo3403#2  = #dsmo3401#2;
     #dsmo3403#3  = #dsmo3401#3;
     #dsmo3403#4  = #dsmo3401#4;
     #dsmo3403#5  = nDActiv;
     #dsmo3403#6  = 1;
|FPRC;

|PROCESO Alta3;
     #dsmo3403#0  = #dsmo3401#0;
     #dsmo3403#1  = #dsmo3401#1;
     #dsmo3403#2  = #dsmo3401#2;
     #dsmo3403#3  = #dsmo3401#3;
     #dsmo3403#4  = #dsmo3401#4;
     #dsmo3403#5  = nHActiv;
     #dsmo3403#6  = 999999;
|FPRC;

|PROCESO Baja4;
     #dsmo3404#0  = #dsmo3401#0;
     #dsmo3404#1  = #dsmo3401#1;
     #dsmo3404#2  = #dsmo3401#2;
     #dsmo3404#3  = #dsmo3401#3;
     #dsmo3404#4  = #dsmo3401#4;
     #dsmo3404#5  = nDActiv;
     #dsmo3404#6  = 1;
|FPRC;

|PROCESO Alta4;
     #dsmo3404#0  = #dsmo3401#0;
     #dsmo3404#1  = #dsmo3401#1;
     #dsmo3404#2  = #dsmo3401#2;
     #dsmo3404#3  = #dsmo3401#3;
     #dsmo3404#4  = #dsmo3401#4;
     #dsmo3404#5  = nHActiv;
     #dsmo3404#6  = 999999;
|FPRC;

|PROCESO Baja5;
     #dsmo3405#0  = #dsmo3401#0;
     #dsmo3405#1  = #dsmo3401#1;
     #dsmo3405#2  = #dsmo3401#2;
     #dsmo3405#3  = #dsmo3401#3;
     #dsmo3405#4  = #dsmo3401#4;
     #dsmo3405#5  = nDActiv;
     #dsmo3405#6  = 1;
|FPRC;

|PROCESO Alta5;
     #dsmo3405#0  = #dsmo3401#0;
     #dsmo3405#1  = #dsmo3401#1;
     #dsmo3405#2  = #dsmo3401#2;
     #dsmo3405#3  = #dsmo3401#3;
     #dsmo3405#4  = #dsmo3401#4;
     #dsmo3405#5  = nHActiv;
     #dsmo3405#6  = 999999;
|FPRC;

|PROCESO CamposAyudaFw200;
     |HAZ Tipo7C10Fw200;
     |HAZ Tipo0C10Fw200;
     |HAZ Tipo0C11Fw200;
     |HAZ Tipo0C13Fw200;
|FPRC;

|PROCESO CamposAyudaFw201;
     |HAZ Tipo7C10Fw201;
     |HAZ Tipo0C10Fw201;
     |HAZ Tipo0C11Fw201;
     |HAZ Tipo0C13Fw201;
|FPRC;

|PROCESO CamposAyudaFw202;
     |HAZ Tipo7C10Fw202;
     |HAZ Tipo0C10Fw202;
     |HAZ Tipo0C11Fw202;
     |HAZ Tipo0C13Fw202;
|FPRC;

|PROCESO CamposAyudaFw203;
     |HAZ Tipo7C10Fw203;
     |HAZ Tipo0C10Fw203;
     |HAZ Tipo0C11Fw203;
     |HAZ Tipo0C21Fw203;
     |HAZ Tipo0C22Fw203;
     |HAZ Tipo7C23Fw203;
     |HAZ Tipo0C23Fw203;
|FPRC;

|PROCESO EntraDatos200;
     |DDEFECTO #dsmow200;

     |PARA nCampo = 0;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
            #dsmow200#nCampo# = #dsmo3402#nCampo#;

            |C_V #dsmow200#nCampo#, 0, aAlfa;
            |SI aAlfa = "S";  |PINTA #dsmow200#nCampo#;  |FINSI;
     |SIGUE;

     |HAZ CamposAyudaFw200;

     |PULSATECLA;
     |ENDATOS #1#dsmow200;
|FPRC;

|PROCESO EntraDatos201;
     |DDEFECTO #dsmow201;

     |PARA nCampo = 0;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
            #dsmow201#nCampo# = #dsmo3403#nCampo#;

            |C_V #dsmow201#nCampo#, 0, aAlfa;
            |SI aAlfa = "S";  |PINTA #dsmow201#nCampo#;  |FINSI;
     |SIGUE;

     |HAZ CamposAyudaFw201;

     |PULSATECLA;
     |ENDATOS #1#dsmow201;
|FPRC;

|PROCESO EntraDatos202;
     |DDEFECTO #dsmow202;

     |PARA nCampo = 0;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
            #dsmow202#nCampo# = #dsmo3404#nCampo#;

            |C_V #dsmow202#nCampo#, 0, aAlfa;
            |SI aAlfa = "S";  |PINTA #dsmow202#nCampo#;  |FINSI;
     |SIGUE;

     |HAZ CamposAyudaFw202;

     |PULSATECLA;
     |ENDATOS #1#dsmow202;
|FPRC;

|PROCESO EntraDatos203;
     |DDEFECTO #dsmow203;

     |PARA nCampo = 0;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
            #dsmow203#nCampo# = #dsmo3405#nCampo#;

            |C_V #dsmow203#nCampo#, 0, aAlfa;
            |SI aAlfa = "S";  |PINTA #dsmow203#nCampo#;  |FINSI;
     |SIGUE;

     |HAZ CamposAyudaFw203;

     |PULSATECLA;
     |ENDATOS #1#dsmow203;
|FPRC;

|PROCESO Alta;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";

     |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |ESTADO_CONTROL nSubBoton2, "DISABLE";
     |ESTADO_CONTROL nSubBoton3, "DISABLE";

     |HAZ QuitaBotonSalir;

     |SI nFichero = 2;
         |ESTADO_CONTROL nGrid2, "DISABLE";

         |SELECT #1#dsmo3402;
         #dsmo3402#0  = #dsmo3401#0;
         #dsmo3402#1  = #dsmo3401#1;
         #dsmo3402#2  = #dsmo3401#2;
         #dsmo3402#3  = #dsmo3401#3;
         #dsmo3402#4  = #dsmo3401#4;
         #dsmo3402#5  = #dsmo3401#5;
         #dsmo3402#6  = 999999;
         |LEE 000#dsmo3402.];
         |SI FSalida = 0;
             |LEE 000#dsmo3402.a;
         |SINO;
             |LEE 000#dsmo3402.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y #dsmo3402#0  = #dsmo3401#0; |Y #dsmo3402#1  = #dsmo3401#1;
          |Y #dsmo3402#2  = #dsmo3401#2; |Y #dsmo3402#3  = #dsmo3401#3; |Y #dsmo3402#4  = #dsmo3401#4;
          |Y #dsmo3402#5  = #dsmo3401#5;
             nReg = #dsmo3402#6 + 1;
         |FINSI;

         |DDEFECTO #dsmo3402;
         #dsmo3402#0  = #dsmo3401#0;
         #dsmo3402#1  = #dsmo3401#1;
         #dsmo3402#2  = #dsmo3401#2;
         #dsmo3402#3  = #dsmo3401#3;
         #dsmo3402#4  = #dsmo3401#4;
         #dsmo3402#5  = #dsmo3401#5;
         #dsmo3402#6  = nReg;
         |GRABA 020#dsmo3402.n;
         |LIBERA #dsmo3402;

         |HAZ EntraDatos200;

         |SI FSalida = 0;
             #dsmo3402#0  = #dsmo3401#0;
             #dsmo3402#1  = #dsmo3401#1;
             #dsmo3402#2  = #dsmo3401#2;
             #dsmo3402#3  = #dsmo3401#3;
             #dsmo3402#4  = #dsmo3401#4;
             #dsmo3402#5  = #dsmo3401#5;
             #dsmo3402#6  = nReg;
             |LEE 101#dsmo3402.=;

             |PARA nCampo = 7;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
                   #dsmo3402#nCampo# = #dsmow200#nCampo#;
             |SIGUE;

             |GRABA 020#dsmo3402.a;

             #dsmo3401#6 = #dsmo3401#6 + 1;
             #dsmo3401#7 = #dsmo3401#7 + #dsmo3402#17;
             #dsmo3401#8 = #dsmo3401#8 + #dsmo3402#18;
             #dsmo3401#9 = #dsmo3401#9 + #dsmo3402#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;
         |SINO;
             |SELECT #1#dsmo3402;
             #dsmo3402#0  = #dsmo3401#0;
             #dsmo3402#1  = #dsmo3401#1;
             #dsmo3402#2  = #dsmo3401#2;
             #dsmo3402#3  = #dsmo3401#3;
             #dsmo3402#4  = #dsmo3401#4;
             #dsmo3402#5  = #dsmo3401#5;
             #dsmo3402#6  = nReg;
             |LEE 101#dsmo3402.=;

             |BORRA 020#dsmo3402.a;
         |FINSI;
         |LIBERA #dsmo3402;

         |REFRESCACONTROL nGrid2;
         |FOCOTECLADO nGrid2;

         |ESTADO_CONTROL nBoton1, "DISABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         |ESTADO_CONTROL nBoton4, "ENABLE";
         |ESTADO_CONTROL nGrid2,  "ENABLE";

     |FINSI;

     |SI nFichero = 3;
         |ESTADO_CONTROL nGrid3, "DISABLE";

         |SELECT #1#dsmo3403;
         #dsmo3403#0  = #dsmo3401#0;
         #dsmo3403#1  = #dsmo3401#1;
         #dsmo3403#2  = #dsmo3401#2;
         #dsmo3403#3  = #dsmo3401#3;
         #dsmo3403#4  = #dsmo3401#4;
         #dsmo3403#5  = #dsmo3401#5;
         #dsmo3403#6  = 999999;
         |LEE 000#dsmo3403.];
         |SI FSalida = 0;
             |LEE 000#dsmo3403.a;
         |SINO;
             |LEE 000#dsmo3403.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y #dsmo3403#0  = #dsmo3401#0; |Y #dsmo3403#1  = #dsmo3401#1;
          |Y #dsmo3403#2  = #dsmo3401#2; |Y #dsmo3403#3  = #dsmo3401#3; |Y #dsmo3403#4  = #dsmo3401#4;
          |Y #dsmo3403#5  = #dsmo3401#5;
             nReg = #dsmo3403#6 + 1;
         |FINSI;

         |DDEFECTO #dsmo3403;
         #dsmo3403#0  = #dsmo3401#0;
         #dsmo3403#1  = #dsmo3401#1;
         #dsmo3403#2  = #dsmo3401#2;
         #dsmo3403#3  = #dsmo3401#3;
         #dsmo3403#4  = #dsmo3401#4;
         #dsmo3403#5  = #dsmo3401#5;
         #dsmo3403#6  = nReg;
         |GRABA 020#dsmo3403.n;
         |LIBERA #dsmo3403;

         |HAZ EntraDatos201;

         |SI FSalida = 0;
             #dsmo3403#0  = #dsmo3401#0;
             #dsmo3403#1  = #dsmo3401#1;
             #dsmo3403#2  = #dsmo3401#2;
             #dsmo3403#3  = #dsmo3401#3;
             #dsmo3403#4  = #dsmo3401#4;
             #dsmo3403#5  = #dsmo3401#5;
             #dsmo3403#6  = nReg;
             |LEE 101#dsmo3403.=;

             |PARA nCampo = 7;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
                   #dsmo3403#nCampo# = #dsmow201#nCampo#;
             |SIGUE;

             |GRABA 020#dsmo3403.a;

             #dsmo3401#6 = #dsmo3401#6 + 1;
             #dsmo3401#7 = #dsmo3401#7 + #dsmo3403#17;
             #dsmo3401#8 = #dsmo3401#8 + #dsmo3403#18;
             #dsmo3401#9 = #dsmo3401#9 + #dsmo3403#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;
         |SINO;
             #dsmo3403#0  = #dsmo3401#0;
             #dsmo3403#1  = #dsmo3401#1;
             #dsmo3403#2  = #dsmo3401#2;
             #dsmo3403#3  = #dsmo3401#3;
             #dsmo3403#4  = #dsmo3401#4;
             #dsmo3403#5  = #dsmo3401#5;
             #dsmo3403#6  = nReg;
             |LEE 101#dsmo3403.=;

             |BORRA 020#dsmo3403.a;
         |FINSI;
         |LIBERA #dsmo3403;

         |REFRESCACONTROL nGrid3;
         |FOCOTECLADO nGrid3;

         |ESTADO_CONTROL nBoton2, "DISABLE";
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         |ESTADO_CONTROL nBoton4, "ENABLE";
         |ESTADO_CONTROL nGrid3,  "ENABLE";
     |FINSI;

     |SI nFichero = 4;
         |ESTADO_CONTROL nGrid4, "DISABLE";

         |SELECT #1#dsmo3404;
         #dsmo3404#0  = #dsmo3401#0;
         #dsmo3404#1  = #dsmo3401#1;
         #dsmo3404#2  = #dsmo3401#2;
         #dsmo3404#3  = #dsmo3401#3;
         #dsmo3404#4  = #dsmo3401#4;
         #dsmo3404#5  = #dsmo3401#5;
         #dsmo3404#6  = 999999;
         |LEE 000#dsmo3404.];
         |SI FSalida = 0;
             |LEE 000#dsmo3404.a;
         |SINO;
             |LEE 000#dsmo3404.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y #dsmo3404#0  = #dsmo3401#0; |Y #dsmo3404#1  = #dsmo3401#1;
          |Y #dsmo3404#2  = #dsmo3401#2; |Y #dsmo3404#3  = #dsmo3401#3; |Y #dsmo3404#4  = #dsmo3401#4;
          |Y #dsmo3404#5  = #dsmo3401#5;
             nReg = #dsmo3404#6 + 1;
         |FINSI;

         |DDEFECTO #dsmo3404;
         #dsmo3404#0  = #dsmo3401#0;
         #dsmo3404#1  = #dsmo3401#1;
         #dsmo3404#2  = #dsmo3401#2;
         #dsmo3404#3  = #dsmo3401#3;
         #dsmo3404#4  = #dsmo3401#4;
         #dsmo3404#5  = #dsmo3401#5;
         #dsmo3404#6  = nReg;
         |GRABA 020#dsmo3404.n;
         |LIBERA #dsmo3404;

         |HAZ EntraDatos202;

         |SI FSalida = 0;
             #dsmo3404#0  = #dsmo3401#0;
             #dsmo3404#1  = #dsmo3401#1;
             #dsmo3404#2  = #dsmo3401#2;
             #dsmo3404#3  = #dsmo3401#3;
             #dsmo3404#4  = #dsmo3401#4;
             #dsmo3404#5  = #dsmo3401#5;
             #dsmo3404#6  = nReg;
             |LEE 101#dsmo3404.=;

             |PARA nCampo = 7;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
                   #dsmo3404#nCampo# = #dsmow202#nCampo#;
             |SIGUE;

             |GRABA 020#dsmo3404.a;

             #dsmo3401#6 = #dsmo3401#6 + 1;
             #dsmo3401#7 = #dsmo3401#7 + #dsmo3404#17;
             #dsmo3401#8 = #dsmo3401#8 + #dsmo3404#18;
             #dsmo3401#9 = #dsmo3401#9 + #dsmo3404#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;
         |SINO;
             #dsmo3404#0  = #dsmo3401#0;
             #dsmo3404#1  = #dsmo3401#1;
             #dsmo3404#2  = #dsmo3401#2;
             #dsmo3404#3  = #dsmo3401#3;
             #dsmo3404#4  = #dsmo3401#4;
             #dsmo3404#5  = #dsmo3401#5;
             #dsmo3404#6  = nReg;
             |LEE 101#dsmo3404.=;

             |BORRA 020#dsmo3404.a;
         |FINSI;
         |LIBERA #dsmo3404;

         |REFRESCACONTROL nGrid4;
         |FOCOTECLADO nGrid4;

         |ESTADO_CONTROL nBoton3, "DISABLE";
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton4, "ENABLE";
         |ESTADO_CONTROL nGrid4,  "ENABLE";
     |FINSI;

     |SI nFichero = 5;
         |ESTADO_CONTROL nGrid5, "DISABLE";

         |SELECT #1#dsmo3405;
         #dsmo3405#0  = #dsmo3401#0;
         #dsmo3405#1  = #dsmo3401#1;
         #dsmo3405#2  = #dsmo3401#2;
         #dsmo3405#3  = #dsmo3401#3;
         #dsmo3405#4  = #dsmo3401#4;
         #dsmo3405#5  = #dsmo3401#5;
         #dsmo3405#6  = 999999;
         |LEE 000#dsmo3405.];
         |SI FSalida = 0;
             |LEE 000#dsmo3405.a;
         |SINO;
             |LEE 000#dsmo3405.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y #dsmo3405#0  = #dsmo3401#0; |Y #dsmo3405#1  = #dsmo3401#1;
          |Y #dsmo3405#2  = #dsmo3401#2; |Y #dsmo3405#3  = #dsmo3401#3; |Y #dsmo3405#4  = #dsmo3401#4;
          |Y #dsmo3405#5  = #dsmo3401#5;
             nReg = #dsmo3405#6 + 1;
         |FINSI;

         |DDEFECTO #dsmo3405;
         #dsmo3405#0  = #dsmo3401#0;
         #dsmo3405#1  = #dsmo3401#1;
         #dsmo3405#2  = #dsmo3401#2;
         #dsmo3405#3  = #dsmo3401#3;
         #dsmo3405#4  = #dsmo3401#4;
         #dsmo3405#5  = #dsmo3401#5;
         #dsmo3405#6  = nReg;
         |GRABA 020#dsmo3405.n;
         |LIBERA #dsmo3405;

         |HAZ EntraDatos203;

         |SI FSalida = 0;
             #dsmo3405#0  = #dsmo3401#0;
             #dsmo3405#1  = #dsmo3401#1;
             #dsmo3405#2  = #dsmo3401#2;
             #dsmo3405#3  = #dsmo3401#3;
             #dsmo3405#4  = #dsmo3401#4;
             #dsmo3405#5  = #dsmo3401#5;
             #dsmo3405#6  = nReg;
             |LEE 101#dsmo3405.=;

             |PARA nCampo = 7;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
                   #dsmo3405#nCampo# = #dsmow203#nCampo#;
             |SIGUE;

             |GRABA 020#dsmo3405.a;

             #dsmo3401#6 = #dsmo3401#6 + 1;
             #dsmo3401#7 = #dsmo3401#7 + #dsmo3405#17;
             #dsmo3401#8 = #dsmo3401#8 + #dsmo3405#18;
             #dsmo3401#9 = #dsmo3401#9 + #dsmo3405#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;
         |SINO;
             #dsmo3405#0  = #dsmo3401#0;
             #dsmo3405#1  = #dsmo3401#1;
             #dsmo3405#2  = #dsmo3401#2;
             #dsmo3405#3  = #dsmo3401#3;
             #dsmo3405#4  = #dsmo3401#4;
             #dsmo3405#5  = #dsmo3401#5;
             #dsmo3405#6  = nReg;
             |LEE 101#dsmo3405.=;

             |BORRA 020#dsmo3405.a;
         |FINSI;
         |LIBERA #dsmo3405;

         |REFRESCACONTROL nGrid5;
         |FOCOTECLADO nGrid5;

         |ESTADO_CONTROL nBoton4, "DISABLE";
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         |ESTADO_CONTROL nGrid5,  "ENABLE";
     |FINSI;

     |ESTADO_CONTROL nSubBoton1, "ENABLE";
     |ESTADO_CONTROL nSubBoton2, "ENABLE";
     |ESTADO_CONTROL nSubBoton3, "ENABLE";

     |HAZ PonBotonSalir;
|FPRC;

|PROCESO Modificar;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";

     |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |ESTADO_CONTROL nSubBoton2, "DISABLE";
     |ESTADO_CONTROL nSubBoton3, "DISABLE";

     |HAZ QuitaBotonSalir;

     |SI nFichero = 2;
         |ESTADO_CONTROL nGrid2, "DISABLE";

         |SELECT #1#dsmo3402;
         |LEE 101#dsmo3402.=;
         |SI FSalida = 0;
             |HAZ EntraDatos200;
             |SI FSalida = 0;
                #dsmo3401#6 = #dsmo3401#6 - 1;
                #dsmo3401#7 = #dsmo3401#7 - #dsmo3402#17;
                #dsmo3401#8 = #dsmo3401#8 - #dsmo3402#18;
                #dsmo3401#9 = #dsmo3401#9 - #dsmo3402#19;

                |PARA nCampo = 7;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
                      #dsmo3402#nCampo# = #dsmow200#nCampo#;
                |SIGUE;

                |GRABA 020#dsmo3402.a;
                |LIBERA #dsmo3402;

                #dsmo3401#6 = #dsmo3401#6 + 1;
                #dsmo3401#7 = #dsmo3401#7 + #dsmo3402#17;
                #dsmo3401#8 = #dsmo3401#8 + #dsmo3402#18;
                #dsmo3401#9 = #dsmo3401#9 + #dsmo3402#19;

                |PINTA #dsmo3401#6;
                |PINTA #dsmo3401#7;
                |PINTA #dsmo3401#8;
                |PINTA #dsmo3401#9;

                |REFRESCACONTROL nGrid2;
                |FOCOTECLADO nGrid2;
             |FINSI;
         |FINSI;

         |ESTADO_CONTROL nBoton1, "DISABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         |ESTADO_CONTROL nBoton4, "ENABLE";
         |ESTADO_CONTROL nGrid2,  "ENABLE";
     |FINSI;

     |SI nFichero = 3;
         |ESTADO_CONTROL nGrid3, "DISABLE";

         |SELECT #1#dsmo3403;
         |LEE 101#dsmo3403.=;
         |SI FSalida = 0;
             |HAZ EntraDatos201;
             |SI FSalida = 0;
                #dsmo3401#6 = #dsmo3401#6 - 1;
                #dsmo3401#7 = #dsmo3401#7 - #dsmo3403#17;
                #dsmo3401#8 = #dsmo3401#8 - #dsmo3403#18;
                #dsmo3401#9 = #dsmo3401#9 - #dsmo3403#19;

                |PARA nCampo = 7;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
                      #dsmo3403#nCampo# = #dsmow201#nCampo#;
                |SIGUE;

                |GRABA 020#dsmo3403.a;
                |LIBERA #dsmo3403;

                #dsmo3401#6 = #dsmo3401#6 + 1;
                #dsmo3401#7 = #dsmo3401#7 + #dsmo3403#17;
                #dsmo3401#8 = #dsmo3401#8 + #dsmo3403#18;
                #dsmo3401#9 = #dsmo3401#9 + #dsmo3403#19;

                |PINTA #dsmo3401#6;
                |PINTA #dsmo3401#7;
                |PINTA #dsmo3401#8;
                |PINTA #dsmo3401#9;

                |REFRESCACONTROL nGrid3;
                |FOCOTECLADO nGrid3;
             |FINSI;
         |FINSI;

         |ESTADO_CONTROL nBoton2, "DISABLE";
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         |ESTADO_CONTROL nBoton4, "ENABLE";
         |ESTADO_CONTROL nGrid3,  "ENABLE";
     |FINSI;

     |SI nFichero = 4;
         |ESTADO_CONTROL nGrid4, "DISABLE";

         |SELECT #1#dsmo3404;
         |LEE 101#dsmo3404.=;
         |SI FSalida = 0;
             |HAZ EntraDatos202;
             |SI FSalida = 0;
                #dsmo3401#6 = #dsmo3401#6 - 1;
                #dsmo3401#7 = #dsmo3401#7 - #dsmo3404#17;
                #dsmo3401#8 = #dsmo3401#8 - #dsmo3404#18;
                #dsmo3401#9 = #dsmo3401#9 - #dsmo3404#19;

                |PARA nCampo = 7;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
                      #dsmo3404#nCampo# = #dsmow202#nCampo#;
                |SIGUE;

                |GRABA 020#dsmo3404.a;
                |LIBERA #dsmo3404;

                #dsmo3401#6 = #dsmo3401#6 + 1;
                #dsmo3401#7 = #dsmo3401#7 + #dsmo3404#17;
                #dsmo3401#8 = #dsmo3401#8 + #dsmo3404#18;
                #dsmo3401#9 = #dsmo3401#9 + #dsmo3404#19;

                |PINTA #dsmo3401#6;
                |PINTA #dsmo3401#7;
                |PINTA #dsmo3401#8;
                |PINTA #dsmo3401#9;

                |REFRESCACONTROL nGrid4;
                |FOCOTECLADO nGrid4;
             |FINSI;
         |FINSI;

         |ESTADO_CONTROL nBoton3, "DISABLE";
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton4, "ENABLE";
         |ESTADO_CONTROL nGrid4,  "ENABLE";
     |FINSI;

     |SI nFichero = 5;
         |ESTADO_CONTROL nGrid5, "DISABLE";

         |SELECT #1#dsmo3405;
         |LEE 101#dsmo3405.=;
         |SI FSalida = 0;
             |HAZ EntraDatos203;
             |SI FSalida = 0;
                #dsmo3401#6 = #dsmo3401#6 - 1;
                #dsmo3401#7 = #dsmo3401#7 - #dsmo3405#17;
                #dsmo3401#8 = #dsmo3401#8 - #dsmo3405#18;
                #dsmo3401#9 = #dsmo3401#9 - #dsmo3405#19;

                |PARA nCampo = 7;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
                      #dsmo3405#nCampo# = #dsmow203#nCampo#;
                |SIGUE;

                |GRABA 020#dsmo3405.a;
                |LIBERA #dsmo3405;

                #dsmo3401#6 = #dsmo3401#6 + 1;
                #dsmo3401#7 = #dsmo3401#7 + #dsmo3405#17;
                #dsmo3401#8 = #dsmo3401#8 + #dsmo3405#18;
                #dsmo3401#9 = #dsmo3401#9 + #dsmo3405#19;

                |PINTA #dsmo3401#6;
                |PINTA #dsmo3401#7;
                |PINTA #dsmo3401#8;
                |PINTA #dsmo3401#9;

                |REFRESCACONTROL nGrid5;
                |FOCOTECLADO nGrid5;
             |FINSI;
         |FINSI;

         |ESTADO_CONTROL nBoton4, "DISABLE";
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
         |ESTADO_CONTROL nGrid5,  "ENABLE";
     |FINSI;

     |ESTADO_CONTROL nSubBoton1, "ENABLE";
     |ESTADO_CONTROL nSubBoton2, "ENABLE";
     |ESTADO_CONTROL nSubBoton3, "ENABLE";

     |HAZ PonBotonSalir;
|FPRC;

|PROCESO Baja;
     |SI nFichero = 2;
         |SELECT #1#dsmo3402;
         |LEE 101#dsmo3402.=;
         |SI FSalida = 0;
             |CONFI "0000 Confirma la baja del registro seleccionado";
             |SI FSalida ! 0;
                 |LIBERA #dsmo3402;
                 |ACABA;
             |FINSI;

             |BORRA 020#dsmo3402.a;
             |LIBERA #dsmo3402;

             #dsmo3401#6 = #dsmo3401#6 - 1;
             #dsmo3401#7 = #dsmo3401#7 - #dsmo3402#17;
             #dsmo3401#8 = #dsmo3401#8 - #dsmo3402#18;
             #dsmo3401#9 = #dsmo3401#9 - #dsmo3402#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;

             |REFRESCACONTROL nGrid2;
             |FOCOTECLADO nGrid2;
         |FINSI;
     |FINSI;

     |SI nFichero = 3;
         |SELECT #1#dsmo3403;
         |LEE 101#dsmo3403.=;
         |SI FSalida = 0;
             |CONFI "0000 Confirma la baja del registro seleccionado";
             |SI FSalida ! 0;
                 |LIBERA #dsmo3403;
                 |ACABA;
             |FINSI;

             |BORRA 020#dsmo3403.a;
             |LIBERA #dsmo3403;

             #dsmo3401#6 = #dsmo3401#6 - 1;
             #dsmo3401#7 = #dsmo3401#7 - #dsmo3403#17;
             #dsmo3401#8 = #dsmo3401#8 - #dsmo3403#18;
             #dsmo3401#9 = #dsmo3401#9 - #dsmo3403#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;

             |REFRESCACONTROL nGrid3;
             |FOCOTECLADO nGrid3;
         |FINSI;
     |FINSI;

     |SI nFichero = 4;
         |SELECT #1#dsmo3404;
         |LEE 101#dsmo3404.=;
         |SI FSalida = 0;
             |CONFI "0000 Confirma la baja del registro seleccionado";
             |SI FSalida ! 0;
                 |LIBERA #dsmo3404;
                 |ACABA;
             |FINSI;

             |BORRA 020#dsmo3404.a;
             |LIBERA #dsmo3404;

             #dsmo3401#6 = #dsmo3401#6 - 1;
             #dsmo3401#7 = #dsmo3401#7 - #dsmo3404#17;
             #dsmo3401#8 = #dsmo3401#8 - #dsmo3404#18;
             #dsmo3401#9 = #dsmo3401#9 - #dsmo3404#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;

             |REFRESCACONTROL nGrid4;
             |FOCOTECLADO nGrid4;
         |FINSI;
     |FINSI;

     |SI nFichero = 5;
         |SELECT #1#dsmo3405;
         |LEE 101#dsmo3405.=;
         |SI FSalida = 0;
             |CONFI "0000 Confirma la baja del registro seleccionado";
             |SI FSalida ! 0;
                 |LIBERA #dsmo3405;
                 |ACABA;
             |FINSI;

             |BORRA 020#dsmo3405.a;
             |LIBERA #dsmo3405;

             #dsmo3401#6 = #dsmo3401#6 - 1;
             #dsmo3401#7 = #dsmo3401#7 - #dsmo3405#17;
             #dsmo3401#8 = #dsmo3401#8 - #dsmo3405#18;
             #dsmo3401#9 = #dsmo3401#9 - #dsmo3405#19;

             |PINTA #dsmo3401#6;
             |PINTA #dsmo3401#7;
             |PINTA #dsmo3401#8;
             |PINTA #dsmo3401#9;

             |REFRESCACONTROL nGrid5;
             |FOCOTECLADO nGrid5;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonesSubPanta;
     |CONTROL_SIMPLE nSubPan, "BOTON,{{193}}Alta ", 1964, 1974, Alta;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE nSubPan, "BOTON,{{197}}Modificar ", 1976, 1986, Modificar;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE nSubPan, "BOTON,{{199}}Borrar", 1988, 1998, Baja;
     nSubBoton3 = FSalida;
|FPRC;

|PROCESO Evento2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsmo3402.=;
         |SI FSalida ! 0;  |O #dsmo3401#0 ! #dsmo3402#0;  |O #dsmo3401#1 ! #dsmo3402#1;  |O #dsmo3401#2 ! #dsmo3402#2;
                           |O #dsmo3401#3 ! #dsmo3402#3;  |O #dsmo3401#4 ! #dsmo3402#4;
             |DDEFECTO #dsmo3402;
         |FINSI;

         |PULSATECLA;
         |DDEFECTO #dsmow200;
         |PARA nCampo = 0;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 1;
               #dsmow200#nCampo# = #dsmo3402#nCampo#;

               |C_V #dsmow200#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #dsmow200#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw200;
     |FINSI;
|FPRC;

|PROCESO Evento3;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsmo3403.=;
         |SI FSalida ! 0;  |O #dsmo3401#0 ! #dsmo3403#0;  |O #dsmo3401#1 ! #dsmo3403#1;  |O #dsmo3401#2 ! #dsmo3403#2;
                           |O #dsmo3401#3 ! #dsmo3403#3;  |O #dsmo3401#4 ! #dsmo3403#4;
             |DDEFECTO #dsmo3403;
         |FINSI;

         |PULSATECLA;
         |DDEFECTO #dsmow201;
         |PARA nCampo = 0;  |SI nCampo [ 31;  |HACIENDO nCampo = nCampo + 1;
               #dsmow201#nCampo# = #dsmo3403#nCampo#;

               |C_V #dsmow201#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #dsmow201#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw201;
     |FINSI;
|FPRC;

|PROCESO Evento4;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsmo3404.=;
         |SI FSalida ! 0;  |O #dsmo3401#0 ! #dsmo3404#0;  |O #dsmo3401#1 ! #dsmo3404#1;  |O #dsmo3401#2 ! #dsmo3404#2;
                           |O #dsmo3401#3 ! #dsmo3404#3;  |O #dsmo3401#4 ! #dsmo3404#4;
             |DDEFECTO #dsmo3404;
         |FINSI;

         |PULSATECLA;
         |DDEFECTO #dsmow202;
         |PARA nCampo = 0;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               #dsmow202#nCampo# = #dsmo3404#nCampo#;

               |C_V #dsmow202#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #dsmow202#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw202;
     |FINSI;
|FPRC;

|PROCESO Evento5;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsmo3405.=;
         |SI FSalida ! 0;  |O #dsmo3401#0 ! #dsmo3405#0;  |O #dsmo3401#1 ! #dsmo3405#1;  |O #dsmo3401#2 ! #dsmo3405#2;
                           |O #dsmo3401#3 ! #dsmo3405#3;  |O #dsmo3401#4 ! #dsmo3405#4;
             |DDEFECTO #dsmo3405;
         |FINSI;

         |PULSATECLA;
         |DDEFECTO #dsmow203;
         |PARA nCampo = 0;  |SI nCampo [ 29;  |HACIENDO nCampo = nCampo + 1;
               #dsmow203#nCampo# = #dsmo3405#nCampo#;

               |C_V #dsmow203#nCampo#, 0, aAlfa;
               |SI aAlfa = "S";  |PINTA #dsmow203#nCampo#;  |FINSI;
         |SIGUE;

         |HAZ CamposAyudaFw203;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |SI nFichero = 2;
         |DESTRUYECONTROL nGrid2;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid2 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 3;
         |DESTRUYECONTROL nGrid3;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid3 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 4;
         |DESTRUYECONTROL nGrid4;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid4 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 5;
         |DESTRUYECONTROL nGrid5;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid5 = -1;
         |PTEC 806;
     |FINSI;

     |PULSATECLA;
     |BORRA_HIJOS_PAN #0#dsmo3401;
     |SUB_PINPA #0#dsmow200, nPanta;
     nSubPan =  FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsmo3402, nRango, 0902, 1898, Baja2, Alta2, Evento2;
     nGrid2 = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";
     |ESTADO_CONTROL nBoton4, "ENABLE";

     nFichero = 2;

     |SI enTipoEntrada ! 4;
         |HAZ BotonesSubPanta;
     |FINSI;

     FSalida = 1;  |HAZ Evento2;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid2;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aTecla = "";
|FPRC;

|PROCESO Boton2;
     |SI nFichero = 2;
         |DESTRUYECONTROL nGrid2;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid2 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 3;
         |DESTRUYECONTROL nGrid3;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid3 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 4;
         |DESTRUYECONTROL nGrid4;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid4 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 5;
         |DESTRUYECONTROL nGrid5;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid5 = -1;
         |PTEC 806;
     |FINSI;

     |PULSATECLA;
     |BORRA_HIJOS_PAN #0#dsmo3401;
     |SUB_PINPA #0#dsmow201, nPanta;
     nSubPan =  FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsmo3403, nRango, 0902, 1898, Baja3, Alta3, Evento3;
     nGrid3 = FSalida;

     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";
     |ESTADO_CONTROL nBoton4, "ENABLE";

     nFichero = 3;

     |SI enTipoEntrada ! 4;
         |HAZ BotonesSubPanta;
     |FINSI;

     FSalida = 1;  |HAZ Evento3;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid3;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aTecla = "";
|FPRC;

|PROCESO Boton3;
     |SI nFichero = 2;
         |DESTRUYECONTROL nGrid2;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid2 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 3;
         |DESTRUYECONTROL nGrid3;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid3 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 4;
         |DESTRUYECONTROL nGrid4;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid4 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 5;
         |DESTRUYECONTROL nGrid5;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid5 = -1;
         |PTEC 806;
     |FINSI;

     |PULSATECLA;
     |BORRA_HIJOS_PAN #0#dsmo3401;
     |SUB_PINPA #0#dsmow202, nPanta;
     nSubPan =  FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsmo3404, nRango, 0902, 1898, Baja4, Alta4, Evento4;
     nGrid4 = FSalida;

     |ESTADO_CONTROL nBoton3, "DISABLE";
     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton4, "ENABLE";

     nFichero = 4;

     |SI enTipoEntrada ! 4;
         |HAZ BotonesSubPanta;
     |FINSI;

     FSalida = 1;  |HAZ Evento4;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid4;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aTecla = "";
|FPRC;

|PROCESO Boton4;
     |SI nFichero = 2;
         |DESTRUYECONTROL nGrid2;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid2 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 3;
         |DESTRUYECONTROL nGrid3;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid3 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 4;
         |DESTRUYECONTROL nGrid4;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid4 = -1;
         |PTEC 806;
     |FINSI;

     |SI nFichero = 5;
         |DESTRUYECONTROL nGrid5;

         |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
         |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
         |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

         nGrid5 = -1;
         |PTEC 806;
     |FINSI;

     |PULSATECLA;
     |BORRA_HIJOS_PAN #0#dsmo3401;
     |SUB_PINPA #0#dsmow203, nPanta;
     nSubPan =  FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsmo3405, nRango, 0902, 1898, Baja5, Alta5, Evento5;
     nGrid5 = FSalida;

     |ESTADO_CONTROL nBoton4, "DISABLE";
     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";

     nFichero = 5;

     |SI enTipoEntrada ! 4;
         |HAZ BotonesSubPanta;
     |FINSI;

     FSalida = 1;  |HAZ Evento5;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid5;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aTecla = "";
|FPRC;

|PROCESO PintaDatosEnX;
     aTitulo = "MODELO 340 ";
     aTitulo = aTitulo + "(Empresa: " + (("00000" + enEmpresa) % -105);
     aTitulo = aTitulo + " Ejercicio: " + enEjer;
     aTitulo = aTitulo + " Periodo: " + (("00" + enPeriodo) % -102);;
     aTitulo = aTitulo + " Complementaria: " + (("00" + enComplem) % -102);
     aTitulo = aTitulo + " Actividad: " + (("00" + enActividad) % -102);

     |VENTANA 0501, 3599, -1, 16, aTitulo;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#dsmo3401;
     |PINDA #0#dsmo3401;
     nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Facturas Expedidas", 802, 820, Boton1;
     nBoton1      = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Facturas Recibidas", 823, 841, Boton2;
     nBoton2      = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Bienes de Inversi¢n", 844, 862, Boton3;
     nBoton3      = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Determinadas Operaciones Intracomunitarias", 865, 898, Boton4;
     nBoton4      = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";

     |HAZ Boton1;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;

     |SI nGrid2 ! -1;  |DESTRUYECONTROL nGrid2;  |FINSI;
     |SI nGrid3 ! -1;  |DESTRUYECONTROL nGrid3;  |FINSI;
     |SI nGrid4 ! -1;  |DESTRUYECONTROL nGrid4;  |FINSI;
     |SI nGrid5 ! -1;  |DESTRUYECONTROL nGrid5;  |FINSI;

     |SI nSubBoton1 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton1;  |FINSI;
     |SI nSubBoton2 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton2;  |FINSI;
     |SI nSubBoton3 ! -1;  |FIN_CONTROL_WINDOWS nSubBoton3;  |FINSI;

     |FINVENTANA nVent;
|FPRC;

|PROCESO LeeParametro;
     |SI PARAMETRO = "";  |ACABA;  |FINSI;

     aAlfa = PARAMETRO % 105;   enEmpresa     = aAlfa;
     aAlfa = PARAMETRO % 604;   enEjer        = aAlfa;
     aAlfa = PARAMETRO % 1002;  enPeriodo     = aAlfa;
     aAlfa = PARAMETRO % 1203;  enModelo      = aAlfa;
     aAlfa = PARAMETRO % 1502;  enComplem     = aAlfa;
     aAlfa = PARAMETRO % 1702;  enActividad   = aAlfa;
     aAlfa = PARAMETRO % 1902;  enTipoEntrada = aAlfa;
     aAlfa = PARAMETRO % 2101;  enMensa       = aAlfa;
|FPRC;

|PROCESO dsmo3402R;
     #dsmo3401#6 = #dsmo3401#6 + 1;
     #dsmo3401#7 = #dsmo3401#7 + #dsmo3402#17;
     #dsmo3401#8 = #dsmo3401#8 + #dsmo3402#18;
     #dsmo3401#9 = #dsmo3401#9 + #dsmo3402#19;
|FPRC;

|DEFBUCLE dsmo3402R;
     #dsmo3402#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nDActiv,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nHActiv, 999999;
     ;
     NULL, dsmo3402R;
|FIN;

|PROCESO dsmo3403R;
     #dsmo3401#6 = #dsmo3401#6 + 1;
     #dsmo3401#7 = #dsmo3401#7 + #dsmo3403#17;
     #dsmo3401#8 = #dsmo3401#8 + #dsmo3403#18;
     #dsmo3401#9 = #dsmo3401#9 + #dsmo3403#19;
|FPRC;

|DEFBUCLE dsmo3403R;
     #dsmo3403#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nDActiv,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nHActiv, 999999;
     ;
     NULL, dsmo3403R;
|FIN;

|PROCESO dsmo3404R;
     #dsmo3401#6 = #dsmo3401#6 + 1;
     #dsmo3401#7 = #dsmo3401#7 + #dsmo3404#17;
     #dsmo3401#8 = #dsmo3401#8 + #dsmo3404#18;
     #dsmo3401#9 = #dsmo3401#9 + #dsmo3404#19;
|FPRC;

|DEFBUCLE dsmo3404R;
     #dsmo3404#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nDActiv,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nHActiv, 999999;
     ;
     NULL, dsmo3404R;
|FIN;

|PROCESO dsmo3405R;
     #dsmo3401#6 = #dsmo3401#6 + 1;
     #dsmo3401#7 = #dsmo3401#7 + #dsmo3405#17;
     #dsmo3401#8 = #dsmo3401#8 + #dsmo3405#18;
     #dsmo3401#9 = #dsmo3401#9 + #dsmo3405#19;
|FPRC;

|DEFBUCLE dsmo3405R;
     #dsmo3405#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nDActiv,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, nHActiv, 999999;
     ;
     NULL, dsmo3405R;
|FIN;

|PROCESO Recalculo;
     #dsmo3401#6 = 0;
     #dsmo3401#7 = 0;
     #dsmo3401#8 = 0;
     #dsmo3401#9 = 0;
     |BUCLE dsmo3402R;
     |BUCLE dsmo3403R;
     |BUCLE dsmo3404R;
     |BUCLE dsmo3405R;
|FPRC;

|PROCESO dsmo3402B;
     |BORRA 020#dsmo3402.a;
     |LIBERA #dsmo3402;
|FPRC;

|DEFBUCLE dsmo3402B;
     #dsmo3402#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5, 999999;
     be;
     NULL, dsmo3402B;
|FIN;

|PROCESO dsmo3403B;
     |BORRA 020#dsmo3403.a;
     |LIBERA #dsmo3403;
|FPRC;

|DEFBUCLE dsmo3403B;
     #dsmo3403#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5, 999999;
     be;
     NULL, dsmo3403B;
|FIN;

|PROCESO dsmo3404B;
     |BORRA 020#dsmo3404.a;
     |LIBERA #dsmo3404;
|FPRC;

|DEFBUCLE dsmo3404B;
     #dsmo3404#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5, 999999;
     be;
     NULL, dsmo3404B;
|FIN;

|PROCESO dsmo3405B;
     |BORRA 020#dsmo3405.a;
     |LIBERA #dsmo3405;
|FPRC;

|DEFBUCLE dsmo3405B;
     #dsmo3405#1;
     ;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5,      1;
     #dsmo3401#0 , #dsmo3401#1, #dsmo3401#2, #dsmo3401#3, #dsmo3401#4, #dsmo3401#5, 999999;
     be;
     NULL, dsmo3405B;
|FIN;

|PROCESO dsmo3401S;
     #dsmo3401#4 = enComplem;
     |GRABA 020#dsmo3401.n;
     |LIBERA #dsmo3401;
|FPRC;

|DEFBUCLE dsmo3401S;
     #dsmo3401#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 00;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 99;
     be;
     NULL, dsmo3401S;
|FIN;

|PROCESO dsmo3402S;
     #dsmo3402#4 = enComplem;
     |GRABA 020#dsmo3402.n;
     |LIBERA #dsmo3402;
|FPRC;

|DEFBUCLE dsmo3402S;
     #dsmo3402#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 00,      1;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 99, 999999;
     be;
     NULL, dsmo3402S;
|FIN;

|PROCESO dsmo3403S;
     #dsmo3403#4 = enComplem;
     |GRABA 020#dsmo3403.n;
     |LIBERA #dsmo3403;
|FPRC;

|DEFBUCLE dsmo3403S;
     #dsmo3403#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 00,      1;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 99, 999999;
     be;
     NULL, dsmo3403S;
|FIN;

|PROCESO dsmo3404S;
     #dsmo3404#4 = enComplem;
     |GRABA 020#dsmo3404.n;
     |LIBERA #dsmo3404;
|FPRC;

|DEFBUCLE dsmo3404S;
     #dsmo3404#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 00,      1;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 99, 999999;
     be;
     NULL, dsmo3404S;
|FIN;

|PROCESO dsmo3405S;
     #dsmo3405#4 = enComplem;
     |GRABA 020#dsmo3405.n;
     |LIBERA #dsmo3405;
|FPRC;

|DEFBUCLE dsmo3405S;
     #dsmo3405#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 00,      1;
     enEmpresa, enEjer, enPeriodo, enModelo, nComple, 99, 999999;
     be;
     NULL, dsmo3405S;
|FIN;

|PROCESO Tipo80_340;  |TIPO 80;
     |ABRET #dsmo3401;
     |ABRET #dsmo3402;
     |ABRET #dsmo3403;
     |ABRET #dsmo3404;
     |ABRET #dsmo3405;
|FPRC;

|PROCESO Tipo90_340;  |TIPO 90;
     |CIERRAT #dsmo3401;
     |CIERRAT #dsmo3402;
     |CIERRAT #dsmo3403;
     |CIERRAT #dsmo3404;
     |CIERRAT #dsmo3405;
|FPRC;

|PROCESO CreaSustitutiva;
     nComple = enComplem - 1;

     |BUCLE dsmo3401S;
     |BUCLE dsmo3402S;
     |BUCLE dsmo3403S;
     |BUCLE dsmo3404S;
     |BUCLE dsmo3405S;
|FPRC;

|PROCESO CreaDSMOM004;
     |ABRE #eosclien;
     #eosclien#0 = enEmpresa;
     |LEE 000#eosclien.=;
     |SI FSalida ! 0; |DDEFECTO #eosclien;  |FINSI;
     |CIERRA #eosclien;

     |DDEFECTO #dsmom004;
     #dsmom004#0  = enEmpresa;
     #dsmom004#1  = enEjer;
     #dsmom004#2  = enPeriodo;
     #dsmom004#3  = 340;
     #dsmom004#4  = 00;
     #dsmom004#17 = "SIN DATOS";
     #dsmom004#26 = #eosclien#2;

     |GRABA 020#dsmom004.n;
     |LIBERA #dsmom004;

     #dsmom008#0  = #dsmom004#0;
     #dsmom008#1  = #dsmom004#1;
     #dsmom008#2  = #dsmom004#2;
     #dsmom008#3  = #dsmom004#3;
     #dsmom008#4  = #dsmom004#4;
     #dsmom008#5  = 0;
     #dsmom008#6  = "REGISTRO DE IMPRESION";
     aAlfa        = "REGISTRO DEL MODELO 340 EJERCICIO " + #dsmom008#1;
     aAlfa        = aAlfa + " PERIODO " + (("00" + #dsmom008#2) % -102);
     #dsmom008#8  = aAlfa;
     #dsmom008#11 = "SIN DATOS";
     #dsmom008#12 = 340;
     #dsmom008#13 = "N";

     |GRABA 020#dsmom008.n;
     |LIBERA #dsmom008;
|FPRC;

|PROCESO CreaDSMOM008;
     |ABRE #eosactiv;
     #eosactiv#0 = enEmpresa;
     #eosactiv#1 = enActividad;
     #eosactiv#2 = enEjer - 2000;
     |LEE 000#eosactiv.=;
     |CIERRA #eosactiv;

     #dsmom008#0  = #dsmom004#0;
     #dsmom008#1  = #dsmom004#1;
     #dsmom008#2  = #dsmom004#2;
     #dsmom008#3  = #dsmom004#3;
     #dsmom008#4  = #dsmom004#4;
     #dsmom008#5  = enActividad;
     #dsmom008#6  = #eosactiv#6;
     aAlfa        = "REGISTRO DEL MODELO 340 EJERCICIO " + #dsmom008#1;
     aAlfa        = aAlfa + " PERIODO " + (("00" + #dsmom008#2) % -102);
     #dsmom008#8  = aAlfa;
     #dsmom008#11 = "SIN DATOS";
     #dsmom008#12 = 340;
     #dsmom008#7  = "dsmo3401";
     #dsmom008#13 = "N";

     |GRABA 020#dsmom008.n;
     |LIBERA #dsmom008;
|FPRC;

|PROCESO LeePlaning;
     |ABRE #dsmom004;
     |ABRE #dsmom008;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = 340;
     #dsmom004#4 = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;
         |HAZ CreaDSMOM004;
     |FINSI;

     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = 340;
     #dsmom008#4 = 0;
     #dsmom008#5 = enActividad;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;
         |HAZ CreaDSMOM008;
     |FINSI;
     |CIERRA #dsmom008;

     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = 340;
     #dsmom004#4 = 0;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROGRAMA;
     |HAZ LeeParametro;

     nDActiv = enActividad;
     nHActiv = enActividad;
     |SI enActividad = 0;
         nDActiv = 1;
         nHActiv = 99;
     |FINSI;

|| \\\\\\ Alta del Modelo ////////

     |SI enTipoEntrada = 1;              || Consulta del Modelo
         |CABEZA "Modelo 340";

         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = enActividad;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmo3401;
             #dsmo3401#0 = enEmpresa;
             #dsmo3401#1 = enEjer;
             #dsmo3401#2 = enPeriodo;
             #dsmo3401#3 = enModelo;
             #dsmo3401#4 = enComplem;
             #dsmo3401#5 = enActividad;
             |GRABA 020#dsmo3401.b;
         |FINSI;

         |HAZ PintaDatosEnX;

         nDActiv = #dsmo3401#5;
         nHActiv = #dsmo3401#5;
         |HAZ Recalculo;

         |SI #dsmo3401#6 = 0;
             |BORRA 020#dsmo3401.a;
         |SINO;
             |GRABA 020#dsmo3401.a;
         |FINSI;
         |LIBERA #dsmo3401;

         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = 0;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmo3401;
             #dsmo3401#0 = enEmpresa;
             #dsmo3401#1 = enEjer;
             #dsmo3401#2 = enPeriodo;
             #dsmo3401#3 = enModelo;
             #dsmo3401#4 = enComplem;
             #dsmo3401#5 = 0;
             |GRABA 020#dsmo3401.b;
         |FINSI;

         nDActiv = 1;
         nHActiv = 99;
         |HAZ Recalculo;

         |SI #dsmo3401#6 = 0;
             |CONFI "0000NNo hay registros introducidos del 340, quiere emitirlo sin actividad";
             |SI FSalida ! 0;
                 |BORRA 020#dsmo3401.a;
             |SINO;
                 |GRABA 020#dsmo3401.a;
             |FINSI;
         |SINO;
             |GRABA 020#dsmo3401.a;
         |FINSI;
         |LIBERA #dsmo3401;

         |ACABA;
     |FINSI;

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |CABEZA "Modelo 340";
         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = enActividad;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |MENAV "      No existe Registro.";
             |ACABA;
         |FINSI;

         |HAZ PintaDatosEnX;

         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              || Baja del Modelo
         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = enActividad;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;

         |BUCLE dsmo3402B;
         |BUCLE dsmo3403B;
         |BUCLE dsmo3404B;
         |BUCLE dsmo3405B;

         |BORRA 020#dsmo3401.a;
         |LIBERA #dsmo3401;

         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = 0;
         |LEE 101#dsmo3405.=;
         |SI FSalida = 0;
             nDActiv = 1;
             nHActiv = 99;
             |HAZ Recalculo;

             |SI #dsmo3401#6 = 0;
                 |BORRA 020#dsmo3401.a;
             |SINO;
                 |GRABA 020#dsmo3401.a;
             |FINSI;
             |LIBERA #dsmo3401;
         |FINSI;

         |ACABA;
     |FINSI;

|| \\\\\\ Alta desde el Pase del Modelo

     |SI enTipoEntrada = 91;
         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = enActividad;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmo3401;
             #dsmo3401#0 = enEmpresa;
             #dsmo3401#1 = enEjer;
             #dsmo3401#2 = enPeriodo;
             #dsmo3401#3 = enModelo;
             #dsmo3401#4 = enComplem;
             #dsmo3401#5 = enActividad;
             |GRABA 020#dsmo3401.b;
         |FINSI;

         nDActiv = #dsmo3401#5;
         nHActiv = #dsmo3401#5;
         |HAZ Recalculo;

         |SI #dsmo3401#6 = 0;
             |BORRA 020#dsmo3401.a;
         |SINO;
             |GRABA 020#dsmo3401.a;
         |FINSI;
         |LIBERA #dsmo3401;

         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = 0;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmo3401;
             #dsmo3401#0 = enEmpresa;
             #dsmo3401#1 = enEjer;
             #dsmo3401#2 = enPeriodo;
             #dsmo3401#3 = enModelo;
             #dsmo3401#4 = enComplem;
             #dsmo3401#5 = 0;
             |GRABA 020#dsmo3401.b;
         |FINSI;

         nDActiv = 1;
         nHActiv = 99;
         |HAZ Recalculo;

         |SI #dsmo3401#6 = 0;
             |BORRA 020#dsmo3401.a;
         |SINO;
             |GRABA 020#dsmo3401.a;
         |FINSI;
         |LIBERA #dsmo3401;

         |ACABA;
     |FINSI;

     |SI enTipoEntrada = 98;
         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = enActividad;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmo3401;
             #dsmo3401#0 = enEmpresa;
             #dsmo3401#1 = enEjer;
             #dsmo3401#2 = enPeriodo;
             #dsmo3401#3 = enModelo;
             #dsmo3401#4 = enComplem;
             #dsmo3401#5 = enActividad;
             |GRABA 020#dsmo3401.b;
         |FINSI;

         nDActiv = #dsmo3401#5;
         nHActiv = #dsmo3401#5;
         |HAZ Recalculo;

         |SI #dsmo3401#6 = 0;
             |BORRA 020#dsmo3401.a;
         |SINO;
             |GRABA 020#dsmo3401.a;
         |FINSI;
         |LIBERA #dsmo3401;

         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = 0;
         |LEE 000#dsmo3401.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmo3401;
             #dsmo3401#0 = enEmpresa;
             #dsmo3401#1 = enEjer;
             #dsmo3401#2 = enPeriodo;
             #dsmo3401#3 = enModelo;
             #dsmo3401#4 = enComplem;
             #dsmo3401#5 = 0;
             |GRABA 020#dsmo3401.b;
         |FINSI;

         nDActiv = 1;
         nHActiv = 99;
         |HAZ Recalculo;

         |SI #dsmo3401#6 = 0;
             |CONFI "0000NNo hay registros introducidos del 340, quiere emitirlo sin actividad";
             |SI FSalida ! 0;
                 |BORRA 020#dsmo3401.a;
             |SINO;
                 |GRABA 020#dsmo3401.a;
             |FINSI;
         |SINO;
             |GRABA 020#dsmo3401.a;
         |FINSI;
         |LIBERA #dsmo3401;

         |HAZ LeePlaning;

         |ACABA;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         #dsmo3401#0 = enEmpresa;
         #dsmo3401#1 = enEjer;
         #dsmo3401#2 = enPeriodo;
         #dsmo3401#3 = enModelo;
         #dsmo3401#4 = enComplem;
         #dsmo3401#5 = enActividad;
         |LEE 000#dsmo3401.=;
     |FINSI;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRO;
