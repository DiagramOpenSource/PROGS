|FICHEROS;
     eosz0035 #0;
     refere1@ #999;
     refere2@ #998;
|FIN;

|VARIABLES;
     nHandle         = 0;
     nCampo          = 0;
     nDTexto         = 0;
     nHTexto         = 0;

     aExtension      = "";
     aAplicacion     = "";
     aNombAplica     = "";
     aPathFich       = "";
     aPathDef        = "";
     aDirecBuscar    = "";
     aDirPatrones    = "";
     aFicheroOrigen  = "";
     aQueQuiero      = "";
     aTitulo         = "";
     aDef            = "";
     aFich           = "";
     aInstalar       = "";
     aOrigen         = "";
     aDestino        = "";
     aFichero        = "";
     aAlfa           = "";
     aBase           = "";
     aDirPatron      = "";
     aDExt           = "";
     aHExt           = "";

     &eaPathEos    = "";
     &eaPrograma     = "";
     &eaExtension    = "";
     &enPlan         = 0;
     &enForzar       = 0;
     nEstado         = 0;
     nPara1          = 0;
     nPara2          = 0;
     nNumCampos      = 0;
     aParam          = "";
     nSw             = 0;
|FIN;

|PROCESO Mensaje;  |TIPO 7;
     |SI #0#1 = "ca8agmay";  |O #0#1 = "ca8comay"; |O #0#1 = "ca8cumay"; |O #0#1 = "ca8eqmay"; |O #0#1 = "ca8m0010";
         |MENSA "    Introduzca <1> Instalacion Completa; <2> Solo pat.oficiales (0,1,20,21,30,31)"
     |FINSI;

     |SI #0#1 = "ca8m0000";  |O #0#1 = "ca8m0001"; |O #0#1 = "ca8m0002"; |O #0#1 = "ca8m0021"; |O #0#1 = "ca8m0022";
          |O #0#1 = "ca8m0006"; |O #0#1 = "ca8m0007"; |O #0#1 = "ca8mtcol"; |O #0#1 = "ca8mtlin";
         |MENSA "    <1> Inst.Completa; <2> Solo pat.oficiales (0,1,5,6,7,10,20,21,22,30,31,32)"
     |FINSI;
|FPRC;

|PROCESO TInsta;
     |SI #0#5 = "3"; |ERROR; |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |LEE 101#0=;
     |SI #0#4 = "N";
         #0#4 = "S";
     |SINO;
         #0#4 = "N";
     |FINSI;

     |PINTA #0#4;

     |SI #0#1 = "ca8agmay"; |O #0#1 = "ca8comay"; |O #0#1 = "ca8cumay"; |O #0#1 = "ca8eqmay";
           |O #0#1 = "ca8m0000"; |O #0#1 = "ca8m0001"; |O #0#1 = "ca8m0002"; |O #0#1 = "ca8m0010";
              |O #0#1 = "ca8m0021"; |O #0#1 = "ca8m0022";
                 |O #0#1 = "ca8m0006"; |O #0#1 = "ca8m0007";
                    |O #0#1 = "ca8mtcol"; |O #0#1 = "ca8mtlin";
         |SI #0#4 = "S";
             |C_M #0#5, 1, "S";

             |ENCAMPO #5#0;

             |C_M #0#5, 1, "N";
         |SINO;
             #0#5 = "";
         |FINSI;
         |PINTA #0#5;
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|PROCESO GrabaLineal;
     aDef = aPathDef + (aFicheroOrigen % 108) + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aQueQuiero = "|TITULO";
     aTitulo    = #999#aQueQuiero#;

     |DESCARGA_DEF #refere1@;

     aInstalar = "S";
     aFich     = aPathFich + (aFicheroOrigen % 108) + ".dat";  |QBT aFich;
     |XABRE "E", aFich, nHandle;
     |SI FSalida ] 0;  |Y enForzar = 0; aInstalar = "N";  |FINSI;

     |DDEFECTO #0;
     #0#0 = (aFicheroOrigen % -103) < "";
     #0#1 = (aFicheroOrigen % 108) < "";
     #0#2 = aTitulo > "";
     #0#3 = aNombAplica;
     #0#4 = aInstalar;

     nSw = 0;
     |SI aParam = "210";
         nSw = 1;
         aAlfa = #0#1 % 105;
         |SI aAlfa = "dsm21";    nSw = 0; |FINSI;
         |SI #0#1  = "eospaise"; nSw = 0; |FINSI;
     |FINSI;

     |SI nSw = 0;
         |GRABA 020#0n;
     |FINSI;
     |LIBERA #0;
|FPRC;

|PROCESO CopiaFicheros;

     aFichero = #0#1 + "." + "ddx";  |QBT aFichero;
     aDestino = aPathFich    + aFichero;
     |FBORRA aDestino;

     aFichero = #0#1 + "." + "ixx";  |QBT aFichero;
     aDestino = aPathFich    + aFichero;
     |FBORRA aDestino;

     aFichero = #0#1 + "." + #0#0;   |QBT aFichero;
     aOrigen  = aDirPatrones + aFichero;
     aFichero = #0#1 + "." + "dat";  |QBT aFichero;
     aDestino = aPathFich    + aFichero;
     |COPIA_FICHERO aOrigen, aDestino;

     aDef = aPathDef + #0#1 + ".mas";  |QBT aDef;
     |CARGA_DEF aDef, refere1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en Cargar el Def " + aDef;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |PATH_DAT #999 aPathFich;

     |ABRE #999;   |CIERRA #999;

     |DESCARGA_DEF #refere1@;
|FPRC;

|PROCESO Instalar;
     |SI #0#0 = "eos";
         aAplicacion = "agieos";
         aPathDef    = eaPathEos + "def/";
         aPathFich   = eaPathEos + "fich/";
         |HAZ CopiaFicheros;
     |FINSI;
|FPRC;

|DEFBUCLE dspatron;
     #0#1;
     4;
     aDExt, "        ", "S";
     aHExt, "zzzzzzzz", "S";
     ;
     NULL, Instalar;
|FIN;

|RUTINA ClaveBaja0;
     #0#0 = aDExt;
     #0#1 = "        ";
|FRUT;

|RUTINA ClaveAlta0;
     #0#0 = aHExt;
     #0#1 = "zzzzzzzz";
|FRUT;

|PROCESO CogeFicheros;
     aDirecBuscar = aDirPatrones + "*." + aExtension;
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aDirecBuscar - aDirPatrones;

            |HAZ GrabaLineal;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROCESO BorraFicheros;
     aDirecBuscar = aDirPatrones + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aExtension = (aDirecBuscar % -103) > " ";
            |SI aExtension ! "TGZ";  |Y aExtension ! "EXE";
                |FBORRA aDirecBuscar;
            |FINSI;
            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROGRAMA;

     aParam = PARAMETRO; |QBF aParam;

     |DBASE aBase;  |QBF aBase;

     eaPathEos = aBase;

     aDirPatron = aBase + "patrones/";
     aFichero   = aDirPatron + "zficheos.tgz";
     |DESCOMPRIME aFichero;

     aFichero   = aDirPatron + "zficheos.tar";
     |DETAR aFichero, aDirPatron;

     |FBORRA aFichero;

     |MENSA "     Gestionando Ficheros";

     |DBASS aDirPatrones;  |QBF aDirPatrones;
     aDirPatrones = aDirPatrones + "agieos/patrones/";

     |SI eaPrograma ! "";  |Y eaExtension ! "";
         #0#0 = eaExtension;
         #0#1 = eaPrograma;
         |HAZ Instalar;
         |HAZ BorraFicheros;
         |ACABA;
     |FINSI;

     |ABRE #0;  |CIERRA #0;  |DELINDEX #0;

     |ABRE #0;

     |SI eaPathEos ! "";
         aExtension  = "eos";
         aAplicacion = "agieos";
         aNombAplica = "REO";

         aPathFich   = eaPathEos + "fich/";
         aPathDef    = eaPathEos + "def/";
         |HAZ CogeFicheros;
     |FINSI;

     |CIERRA #0;

     aDExt = "   ";
     aHExt = "zzz";

     |SI eaExtension = "";
         |ENTLINEAL #1#0, -2, 4, 19, 1, ClaveBaja0, ClaveAlta0;

         |CONFI "0000SDesea Realizar el pase en estos momentos : ";
         |SI FSalida = 0;
            |BUCLE dspatron;
         |FINSI;
     |SINO;
         |BUCLE dspatron;
     |FINSI;
     |DELINDEX #0;

     |HAZ BorraFicheros;
|FPRO;
