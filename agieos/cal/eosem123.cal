|FICHEROS;
     eosem123 #0;
     eosma123 #1;
     eosclien #2;
     eoshacie #3;
     eosm0050 #50;

     eosw0547 #547;
     eosw0551 #551;
     eosw0601 #601,MANTE;
|FIN;

|VARIABLES;
   &enNume     = 0;

   &DiaAlfa    = "";
   &MesAlfa    = "";
   &AnyoAlfa   = "";
   &LugarAlfa  = "";
   &eaAlfa     = "";
   &eaInternet = "";
   &eaDiaB      = "";
   &eaMesB      = "";
   &eaAnyoB     = "";
   &eaImpresora = "";
   &eaModelos   = "";

   EmpreFin = 0;
   EmpreIni = 0;
   nHandle1 = 0;
   nHandle2 = 0;
   Cont    = 0;
   Mes     = 0;
   Long    = 0;
   nTCampo = 0;
   nSwHay  = 0;

   aAbre    = "";
   aFichero = "";
   aAlfa    = "";
   LongAlfa = "";
   Path     = "";

     aAlfa1       = "";
     aUnidad      = "";

  {1}aContiene    = "";

     &eaFOrigen          = "";
     &eaFDestino         = "";
     &eaEjer             = "";
     &eaPathEmision      = "";
     &eaPathLanza        = "";
     &eaPathExplorador   = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroImpre     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &enEmpresa          = 0;
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &enTecla            = 0;
     &enPeriodo          = 0;
     &eaPeriodo          = "";
     nTecla              = 0;
     perialf             = "";
|FIN;

|INCLUYE i_laserc;
|INCLUYE i_consul;

|PROCESO Tipo;
     |SI #0#44 = "L";  |Y #0#40 < 2003;
         |MENAV "0000 En Laser a partir del Ejercicio 2003";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MiraSelec;
   |SI #eosem123#0 = "S";
      |C_M #eosem123#1,1,"S";
      |C_M #eosem123#2,1,"S";
      |PARA Cont = 3; |SI Cont [ 38; |HACIENDO Cont = Cont + 1;
         |C_M #eosem123#Cont#,1,"N";
      |SIGUE;
   |SINO;
      |C_M #eosem123#1,1,"N";
      |C_M #eosem123#2,1,"N";
      |PARA Cont = 3; |SI Cont [ 38; |HACIENDO Cont = Cont + 1;
         |C_M #eosem123#Cont#,1,"S";
      |SIGUE;
   |FINSI;
|FPRC;

|PROCESO TipoPeriodo;
     |SI #0#45 = "T";
         |SI #0#39 > 4;
             |MENAV "0000Periodo no trimestral ...";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO TDeclaracion123;
     |SI #1#26 ! 0;
         enNume = #1#26;  |HAZ Conver13;  #547#39 = eaAlfa;

         |SI #1#30 = "E";
             #547#37 = "X";
         |SINO;
             #547#38 = "X";
             #547#40 = #1#31;
             #547#41 = #1#32;
             #547#42 = #1#33;
             #547#43 = #1#34;
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #547#39 = eaAlfa;
      |FINSI;

      #547#4 = "";
      |SI #0#44 = "L";
          |SI #1#17 = 0;  |Y #1#20 = 0;  |Y #1#25 = 0;
              #547#4 = "N";
          |FINSI;
      |SINO;
          #547#4 = "";
          |SI #1#26 ! 0;  #547#4 = "I";  |FINSI;

          |SI #1#17 = 0;  |Y #1#20 = 0;  |Y #1#25 = 0;
              #547#4 = "N";
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO CargaImprime;
     aAlfa = "del err" + (("00000" + #2#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:123" + (("00000" + #2#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #2#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #601#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL " + "123" + (("00000" + #2#0) % -105) + ".TXT ";
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO Carga123;
     |SI #0#44 = "F";
         aAlfa      = "/AEAT";                       |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET";              |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET/123";          |RMKDIR aAlfa;
         aAlfa      = ("0000" + #0#40) % -104;
         aAlfa      = "/AEAT/INTERNET/123/" + aAlfa; |RMKDIR aAlfa;
         eaInternet = aAlfa + "/";
         aAbre = eaInternet + "123" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |SINO;
         aAlfa = "/MODELOS";                       |RMKDIR aAlfa;
         aAlfa = aAlfa + "/123";                   |RMKDIR aAlfa;
         aAlfa = aAlfa + "/";
         aAbre = aAlfa + "123" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #547;

     #547#1   = "123";
     #547#2   = "01";
     #547#3   = "";
     #547#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);

     aAlfa    = #2#1;  |QBF aAlfa;
     #547#6   = ("000000000" + aAlfa) % -109;
     #547#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #547#8   = eaAlfa;
     #547#9   = ".";
     eaAlfa   = #2#4;    |HAZ QuitaRaros;     #547#10  = eaAlfa;
     eaAlfa   = #2#5;    |HAZ QuitaRaros;     #547#11  = eaAlfa;
     #547#12  = #2#6;
     #547#13  = #2#7;
     #547#14  = #2#8;
     #547#15  = #2#9;
     eaAlfa   = #2#14;   |HAZ QuitaRarosTfno; #547#16 = eaAlfa;
     eaAlfa   = #2#13;   |HAZ QuitaRaros;     #547#17  = eaAlfa;
     eaAlfa   = #2#12;   |HAZ QuitaRaros;     #547#18  = eaAlfa;
     #547#19  = (("00" + #2#10) % -102) + (("000" + #2#11) % -103);
     #547#20  = #0#40;

     |SI #eosma123#29 = "M";
         aAlfa  = #eosma123#2; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
     |SINO;
        aAlfa  = #eosma123#2; |QBF aAlfa; aAlfa = aAlfa + "T";
     |FINSI;
     #547#21  = aAlfa;

     #547#22 = ("000000" + #1#15) % -106;
     enNume  = #eosma123#16; |HAZ Conver13;  #547#23 = eaAlfa;
     enNume  = #eosma123#17; |HAZ Conver13;  #547#24 = eaAlfa;
     enNume  = #eosma123#24; |HAZ Conver13;  #547#25 = eaAlfa;
     enNume  = #eosma123#20 - #eosma123#25;  |HAZ Conver13;  #547#26 = eaAlfa;
     enNume  = #eosma123#26; |HAZ Conver13;  #547#27 = eaAlfa;

     |HAZ TDeclaracion123;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #547#28  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #547#29  = eaAlfa;

     eaAlfa  = #0#41;     |HAZ FechaBonito;
     #547#34 = eaDiaB;
     #547#35 = eaMesB;
     #547#36 = eaAnyoB;
     #547#44 = &13 + &10;

     |SI #0#44 = "L";
         #547#7  = "";
         #547#28 = "";
         #547#29 = "";
         #547#30 = "";
         #547#31 = "";
         #547#32 = "";
         #547#33 = "";
         nTCampo = 44;
     |FINSI;

     |SI #0#44 = "F";
         #547#2  = "";
         #547#3  = "";
         #547#5  = "";
         #547#8  = "";
         #547#9  = "";
         #547#10 = "";
         #547#11 = "";
         #547#12 = "";
         #547#13 = "";
         #547#14 = "";
         #547#15 = "";
         #547#16 = "";
         #547#17 = "";
         #547#18 = "";
         #547#19 = "";
         #547#34 = "";
         #547#35 = "";
         #547#36 = "";
         nTCampo = 43;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #547nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#44 = "L";
         |HAZ CargaImprime;
     |FINSI;
|FPRC;

|PROCESO TDeclaracion123_2008;
     #551#21 = "0";
     |SI #1#26 > 0;
         enNume = #1#26;  |HAZ Conver13;  #551#20 = eaAlfa;

         |SI #1#30 = "E";  #551#21 = "1";  |FINSI;
         |SI #1#30 = "C";  #551#21 = "2";  |FINSI;
         |SI #1#30 = "D";  #551#21 = "3";  |FINSI;

         |SI #1#30 ! "E";
             #551#22 = #1#31;
             #551#23 = #1#32;
             #551#24 = #1#33;
             #551#25 = #1#34;
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #551#20 = eaAlfa;
      |FINSI;

      #551#4 = "";
      |SI #0#44 = "L";
          |SI #1#17 = 0;  |Y #1#20 = 0;  |Y #1#25 = 0;
              #551#4 = "N";
          |FINSI;
      |SINO;
          #551#4 = "";
          |SI #1#26 ! 0;
              #551#4 = "I";
              |SI #551#21 = "3";  #551#4 = "U";  |FINSI;
          |FINSI;

          |SI #1#17 = 0;  |Y #1#20 = 0;  |Y #1#25 = 0;
              #551#4 = "N";
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga123_2008;
     |SI #0#44 = "F";
         aAlfa      = "/AEAT";                       |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET";              |RMKDIR aAlfa;
         aAlfa      = "/AEAT/INTERNET/123";          |RMKDIR aAlfa;
         aAlfa      = ("0000" + #0#40) % -104;
         aAlfa      = "/AEAT/INTERNET/123/" + aAlfa; |RMKDIR aAlfa;
         eaInternet = aAlfa + "/";
         aAbre = eaInternet + "123" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |SINO;
         aAlfa = "/MODELOS";                       |RMKDIR aAlfa;
         aAlfa = aAlfa + "/123";                   |RMKDIR aAlfa;
         aAlfa = aAlfa + "/";
         aAbre = aAlfa + "123" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #551;

     #551#1   = "123";
     #551#2   = "01";
     #551#3   = "";
     #551#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);

     aAlfa    = #2#1;  |QBF aAlfa;
     #551#6   = ("000000000" + aAlfa) % -109;
     #551#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #551#8   = eaAlfa;
     #551#9   = ".";
     eaAlfa   = #2#13;   |HAZ QuitaRaros;     #551#34  = eaAlfa;
     #551#10  = #0#40;

     |SI #eosma123#29 = "M";
         aAlfa  = #eosma123#2; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
     |SINO;
        aAlfa  = #eosma123#2; |QBF aAlfa; aAlfa = aAlfa + "T";
     |FINSI;
     #551#11  = aAlfa;

     #551#12 = ("000000" + #1#15) % -106;
     enNume  = #eosma123#16; |HAZ Conver13;  #551#13 = eaAlfa;
     enNume  = #eosma123#17; |HAZ Conver13;  #551#14 = eaAlfa;
     enNume  = #eosma123#24; |HAZ Conver13;  #551#15 = eaAlfa;
     enNume  = #eosma123#20 - #eosma123#25;  |HAZ Conver13;  #551#16 = eaAlfa;
     enNume  = #eosma123#26; |HAZ Conver13;  #551#17 = eaAlfa;
     enNume  = 0;            |HAZ Conver13;  #551#18 = eaAlfa;
     enNume  = #eosma123#26; |HAZ Conver13;  #551#19 = eaAlfa;

     |HAZ TDeclaracion123_2008;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #551#28  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #551#29  = eaAlfa;

     eaAlfa  = #0#41;     |HAZ FechaBonito;
     #551#35 = eaDiaB;
     #551#36 = eaMesB;
     #551#37 = eaAnyoB;
     #551#38 = &13 + &10;

     |SI #0#44 = "L";
         #551#7  = "";
         #551#26 = "";
         #551#28 = "";
         #551#29 = "";
         #551#30 = "";
         #551#31 = "";
         #551#32 = "";
         #551#33 = "";
         nTCampo = 38;
     |FINSI;

     |SI #0#44 = "F";
         #551#2  = "";
         #551#3  = "";
         #551#5  = "";
         #551#8  = "";
         #551#9  = "";
         #551#34 = "";
         #551#35 = "";
         #551#36 = "";
         #551#37 = "";
         #551#38 = "";
         nTCampo = 37;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #551nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#44 = "L";
         |HAZ CargaImprime;
     |FINSI;
|FPRC;

|PROCESO Impresion;
     #eosclien#0 = #eosma123#0;
     |LEE 010#eosclien.=;

     DiaAlfa  = #eosem123#41 % 0102;
     MesAlfa  = #eosem123#41 % 0402;
     AnyoAlfa = #eosem123#41 % -104;
     Mes      = MesAlfa;
     |HAZ MesLetra;

     LongAlfa = #eosem123#42 % 0;
     Long = LongAlfa;
     Long = 25 - Long

     LugarAlfa = " " * Long;
     LugarAlfa = LugarAlfa + #eosem123#42;

     #eosma123#27 = "S";
     #eosma123#28 = ~;
     |GRABA 020#eosma123.a;

     nSwHay = 1;

     |ABRE #3;
     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     |SI #eosem123#44 = "O";
         |PRINT;
     |FINSI;

     |SI #eosem123#44 ! "O";
         |SI #0#40 [ 2007;
             |HAZ Carga123;
         |SINO;
             |HAZ Carga123_2008;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Impresion;
     #eosma123#1;
     ;
     EmpreIni,#0#40,#0#39;
     EmpreFin,#0#40,#0#39;
     ;
     NULL,Impresion;
|FIN;

|PROCESO MesLetra;
   |SI Mes = 1;  MesAlfa = "Enero     "; |FINSI;
   |SI Mes = 2;  MesAlfa = "Febrero   "; |FINSI;
   |SI Mes = 3;  MesAlfa = "Marzo     "; |FINSI;
   |SI Mes = 4;  MesAlfa = "Abril     "; |FINSI;
   |SI Mes = 5;  MesAlfa = "Mayo      "; |FINSI;
   |SI Mes = 6;  MesAlfa = "Junio     "; |FINSI;
   |SI Mes = 7;  MesAlfa = "Julio     "; |FINSI;
   |SI Mes = 8;  MesAlfa = "Agosto    "; |FINSI;
   |SI Mes = 9;  MesAlfa = "Septiembre"; |FINSI;
   |SI Mes = 10; MesAlfa = "Octubre   "; |FINSI;
   |SI Mes = 11; MesAlfa = "Noviembre "; |FINSI;
   |SI Mes = 12; MesAlfa = "Diciembre "; |FINSI;
|FPRC;

|PROCESO MiraEmision;
     |SI #eosem123#40 < 2002;
         |C_M #eosem123#44,1,"N"; #eosem123#44 = "O";
     |SINO;
         |C_M #eosem123#44,1,"S";
     |FINSI;
     |PINTA #eosem123#44;

     |C_M #eosem123#42,1,"S";
     |SI #eosem123#40 ] 2015;
         |C_M #eosem123#42, 1, "N";
     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     eaModelos = "123";    |HAZ Copiampf;

     aAlfa = "\MODELOS\123\IMPRIME";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO AbreImprime;
     aAbre = "\MODELOS\123\imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD \" + &13 + &10;                 |XGRABA nHandle1, aAlfa;
     aAlfa = "CD MODELOS" + &13 + &10;           |XGRABA nHandle1, aAlfa;
     aAlfa = "CD 123" + &13 + &10;               |XGRABA nHandle1, aAlfa;

     aAlfa = #0#40;
     aAlfa = aAlfa % -102;
     aVersion = "";

     |SI #0#40 ] 2008;
         aVersion = "01";
         |SI #0#40 = 2008;
             |SI #0#39 ] 2;
                 aVersion = "02";
             |FINSI;
         |FINSI;
     |FINSI;

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = (aContiene1 % 102) > "";

     |SI aVersion = "";
         aAlfa = "ZLS" + aAlfa + "MPF.EXE /T:" + aUnidad + "\MODELOS\123\"+ &13 + &10;
     |SINO;
         aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + aUnidad + "\MODELOS\123\"+ &13 + &10;
     |FINSI;

     |XGRABA nHandle1, aAlfa;

     aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO Bloque2012;
     |SI #eosem123#44 = "O";
         |IMPRE 0;
         |SI FSalida < 0; |ACABA; |FINSI;

         |INFOR "eosem123";
         |SI FSalida ! 0; |ACABA |FINSI;
     |FINSI;

     |SI #eosem123#44 = "L";
         |PARA;  |SI;  |HACIENDO;
              |DDEFECTO #601;
              |PINPA #0#601;
              |PINDA #0#601;
              |ENDATOS #1#601;
              |SI FSalida = 0;
                  aAlfa = "/MODELOS";           |RMKDIR aAlfa;
                  aAlfa = "/MODELOS/123";       |RMKDIR aAlfa;
                  |HAZ AbreImprime;
                  |SAL;
              |FINSI;
          |SIGUE;
     |FINSI;

     |ABRE #eosma123;
     |ABRE #eosclien;
     |SI #0#0 = "S";
         EmpreIni = #0#1;
         EmpreFin = #0#2;
         |BUCLE Impresion;
     |SINO;
         |PARA Cont = 3; |SI Cont [ 38; |HACIENDO Cont = Cont + 1;
               EmpreIni = #0#Cont#;
               EmpreFin = #0#Cont#;
               |BUCLE Impresion;
         |SIGUE;
     |FINSI;
     |CIERRA #eosma123;
     |CIERRA #eosclien;

     |SI #eosem123#44 = "O";
         |PIEINF;
         |FININF;
         |FINIMP;
     |FINSI;

     |SI nSwHay = 0;
         |SI #0#44 = "L";
             |XCIERRA nHandle1;
             aAlfa = "\MODELOS\123\imprime.bat";
             |RFBORRA aAlfa;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #0#44 = "F";
         aAlfa = "0000 El fichero esta situado en la Carpeta " + eaInternet;
         |MENAV aAlfa;
     |FINSI;

     |SI #0#44 = "L";
         |HAZ EmiteEsto;
         eaTipoSec = "123";
         eaTipoEmi = "ERRORES";
         enAnyo    = #0#40;
         |SUB_EJECUTA "eosz9999";

         aAlfa = "\MODELOS\123\imprime.bat";
         |RFBORRA aAlfa;
     |FINSI;
|FPRC;
|| --------------------------------------------------------------------------
|PROCESO Carga123_2013;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #551;

     #551#1   = "123";
     #551#2   = "01";
     #551#3   = "";
     #551#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);

     aAlfa    = #2#1;  |QBF aAlfa;
     #551#6   = ("000000000" + aAlfa) % -109;
     #551#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #551#8   = eaAlfa;
     #551#9   = ".";
     eaAlfa   = #2#13;   |HAZ QuitaRaros;     #551#34  = eaAlfa;
     #551#10  = #0#40;

     |SI #eosma123#29 = "M";
         aAlfa  = #eosma123#2; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
     |SINO;
        aAlfa  = #eosma123#2; |QBF aAlfa; aAlfa = aAlfa + "T";
     |FINSI;
     #551#11  = aAlfa;

     #551#12 = ("000000" + #1#15) % -106;
     enNume  = #eosma123#16; |HAZ Conver13;  #551#13 = eaAlfa;
     enNume  = #eosma123#17; |HAZ Conver13;  #551#14 = eaAlfa;
     enNume  = #eosma123#24; |HAZ Conver13;  #551#15 = eaAlfa;
     enNume  = #eosma123#20 - #eosma123#25;  |HAZ Conver13;  #551#16 = eaAlfa;
     enNume  = #eosma123#26; |HAZ Conver13;  #551#17 = eaAlfa;
     enNume  = 0;            |HAZ Conver13;  #551#18 = eaAlfa;
     enNume  = #eosma123#26; |HAZ Conver13;  #551#19 = eaAlfa;

     |HAZ TDeclaracion123_2008;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #551#28  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #551#29  = eaAlfa;

     eaAlfa  = #0#41;     |HAZ FechaBonito;
     #551#35 = eaDiaB;
     #551#36 = eaMesB;
     #551#37 = eaAnyoB;
     #551#38 = &13 + &10;

     |SI nTecla = 1;
         #551#7  = "";
         #551#26 = "";
         #551#28 = "";
         #551#29 = "";
         #551#30 = "";
         #551#31 = "";
         #551#32 = "";
         #551#33 = "";
         nTCampo = 38;
     |FINSI;

     |SI nTecla = 3;
         #551#2  = "";
         #551#3  = "";
         #551#5  = "";
         #551#8  = "";
         #551#9  = "";
         #551#34 = "";
         #551#35 = "";
         #551#36 = "";
         #551#37 = "";
         #551#38 = "";
         nTCampo = 37;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #551nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;

|FPRC;

|PROCESO Impresion_2013;
     #eosclien#0 = #eosma123#0;
     |LEE 010#eosclien.=;

     DiaAlfa  = #eosem123#41 % 0102;
     MesAlfa  = #eosem123#41 % 0402;
     AnyoAlfa = #eosem123#41 % -104;
     Mes      = MesAlfa;
     |HAZ MesLetra;

     LongAlfa = #eosem123#42 % 0;
     Long = LongAlfa;
     Long = 25 - Long

     LugarAlfa = " " * Long;
     LugarAlfa = LugarAlfa + #eosem123#42;

     #eosma123#27 = "S";
     #eosma123#28 = ~;
     |GRABA 020#eosma123.a;

     nSwHay = 1;

     |ABRE #3;
     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     eaFicheroPlano = "130" + (("00000" + #2#0) % -105) + ".txt";
     eaFicheroImpre = "130" + (("00000" + #2#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #2#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Carga123_2013;

     |XCIERRA nHandle2;

     enEmpresa    = #2#0;
     eaNomEmpresa = #2#1;

     |SI enTecla = 3;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroIP;

         |ACABA;
     |FINSI;

     |HAZ PresentaMPF;
|FPRC;

|DEFBUCLE Impresion_2013;
     #eosma123#1;
     ;
     EmpreIni,#0#40,#0#39;
     EmpreFin,#0#40,#0#39;
     ;
     NULL,Impresion_2013;
|FIN;

|PROCESO Bloque2013;
     |HAZ LeeUnidad;
     eaModelos  = "123";
     eaPeriodo  = ("00" + enPeriodo) % -102;
     perialf = eaPeriodo;
     |SI #0#45 = "T";
         |SI #0#39 = 1; perialf = "1T"; |FINSI;
         |SI #0#39 = 2; perialf = "2T"; |FINSI;
         |SI #0#39 = 3; perialf = "3T"; |FINSI;
         |SI #0#39 = 4; perialf = "4T"; |FINSI;
    |FINSI;
     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ BotonesMPF;
     nTecla = enTecla;
     |SI nTecla = 0;  |ACABA;  |FINSI;

     |ABRE #eosma123;
     |ABRE #eosclien;
     |SI #0#0 = "S";
         EmpreIni = #0#1;
         EmpreFin = #0#2;
         |BUCLE Impresion_2013;
     |SINO;
         |PARA Cont = 3; |SI Cont [ 38; |HACIENDO Cont = Cont + 1;
               EmpreIni = #0Cont;
               EmpreFin = #0Cont;
               |BUCLE Impresion_2013;
         |SIGUE;
     |FINSI;
     |CIERRA #eosma123;
     |CIERRA #eosclien;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     aFichero = "eosem123" + Usuario;
     |NOME_DAT #eosem123#aFichero#;
     |ABRE #eosem123;  |CIERRA #eosem123;  |DELINDEX #eosem123;

     |ABRE #eosem123;

     |CABEZA " Emision modelo 123";

     |PINPA #0#0;
     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     enPer     = #0#39;
     enAnyo    = #0#40;
     aTipoSec  = "123";
     eaTipoSec = "123";
     eaEjer    = #0#40;
     enPeriodo = #0#39;

     |SI #0#40 [ 2012; |O #0#44 = "B"; |O #0#44 = "O";
         |HAZ Bloque2012;

         |CIERRA #eosem123;  |DELINDEX #eosem123;
         |ACABA;
     |FINSI;

     |SI #0#40 [ 2014;
         |HAZ Bloque2013;

         |CIERRA #eosem123;  |DELINDEX #eosem123;
         |ACABA;
     |FINSI;

     |GRABA 020#eosem123.n;
     |LIBERA #eosem123;
     |CIERRA #eosem123;

     |SUB_EJECUTA "dsmoy123";

     |DELINDEX #eosem123;
|FPRO;
