|FICHEROS;
   eosmccz1 #0;

   eosmccw4 #999,MANTE;

   eoscabco #1;
   eoslinco #2;

   eosactiv #3;

   eoscabve #11;
   eoslinve #12;

   eosmcc01 #501;
   eosmcc02 #502;

   espejo@ #990;
|FIN;

|VARIABLES;

    nInkey   = 0;
    nError   = 0;
    aAlfa1   = "";
    aAlfa2   = "";
    XPara    = 0;
    nNume1   = 0;
    nNume2   = 0;
    anyo     = "";
    fichero  = "";
    aFichero = "";
    inform1  = "eosmccz1";
    inform2  = "eosmccy1";
    informe  = "";

    fechad   = @;
    fechah   = @;
    d_act    = 0;
    h_act    = 0;
    fDFecha  = @;
    fHFecha  = @;
    nDTrim   = 0;
    nHTrim   = 0;

    nCampo    = 0;
    aMas      = "";
    aDef      = "";
    nSwAlgun  = 0;
    nSwSel    = 0;
    nSw       = 0;

    &enSwLinea = 0;
    &enTotal   = 0;
    &enTBases  = 0;
    &enTCuotas = 0;
    &eaTexto   = "";
    &aCuenta   = "";
    &aCif      = "";
    aParam     = "";
    nOp        = 0;
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcaj;
|INCLUYE i_consul;

|| ***************** Calculos de Pantalla
|PROCESO ConsuPro;
   Campo10020 = #0#33;
   |SI #0#27 = "R";
       Campo10022 = 1;
   |SINO;
       Campo10022 = 2;
   |FINSI;
   Campo10021 = #0Campo;
   nCampo     = Campo;
   |HAZ ConsuCliProv;
   #0nCampo = Campo10021;  |PINTA #0nCampo;
|FPRC;

|PROCESO leelibro; |TIPO 0;

   |SI FSalida = 2; |ACABA; |FINSI;

   nError = 0;
   |SI #0#27 = "R";
       |ABRE #11;
       #11#0 = #0#33;
       #11#4 = #0#34;
       |LEE 040#11=;
       |SI FSalida ! 0;
           nError = 1;
           aAlfa1 = "    No existe Registro de Ventas";
       |FINSI;
       |CIERRA #11;
   |SINO;
       |ABRE #1;
       #1#0 = #0#33;
       #1#4 = #0#34;
       |LEE 040#1=;
       |SI FSalida ! 0;
           nError = 1;
           aAlfa1 = "    No existe Registro de Compras";
       |FINSI;
       |CIERRA #1;
    |FINSI;
    |SI nError = 1;
        |MENAV aAlfa1;
        |ERROR;
    |SINO;
        enEjer = 2000 + #0#34;
        aAlfa1 = enEjer; aAlfa1 = "01.01." + aAlfa1; fechad = aAlfa1;
        aAlfa1 = enEjer; aAlfa1 = "31.12." + aAlfa1; fechah = aAlfa1;
        #0#4 = fechad; |PINTA #0#4;
        #0#5 = fechah; |PINTA #0#5;
    |FINSI;
|FPRC;

|PROCESO activida; |TIPO 0;

    |SI FSalida = 2; |ACABA; |FINSI;

    enDigCaja = 0;
    |ABRE #3;
    |SI #0#35 ! 0;
        #3#0 = #0#33;
        #3#1 = #0#35;
        #3#2 = #0#34;
        |LEE 040#3=;
        |SI FSalida ! 0;
            |MENAV "     No existe esta Actividad en la Empresa";
            |ERROR;
        |SINO;
            d_act     = #0#35;
            h_act     = #0#35;
            enDigCaja = #3#50;
        |FINSI;
    |SINO;
        d_act = 1;
        h_act = 6;
        #3#0 = #0#33;
        #3#1 = 1;
        #3#2 = #0#34;
        |LEE 040#3];
        |SI FSalida = 0; |Y #3#0 = #0#33; |Y #3#2 = #0#34;
            enDigCaja = #3#50;
        |SINO;
            |MENAV "      No existen actividades con esta empresa.";
            |ERROR;
        |FINSI;
    |FINSI;
    |CIERRA #3;

    |SI enDigCaja = 0; |ACABA; |FINSI;

    |PINTA 1746, "      ";  |PINTA 1757, "      ";
    |PINTA 1820, "      ";  |PINTA 1829, "      ";
    |PINTA 1838, "      ";  |PINTA 1847, "      ";
    |PINTA 1856, "      ";  |PINTA 1865, "      ";

    |SI enDigCaja = 1;
         |PARA XPara = 12; |SI XPara [ 19; |HACIENDO XPara = XPara + 1;
               |C_M #0XPara, 1, "S";
               |C_V #0XPara, 1, "S"; |PINTA #0XPara;
         |SIGUE;

         |PARA XPara = 20; |SI XPara [ 38; |HACIENDO XPara = XPara + 1;
               |C_M #0XPara, 1, "N";
               |C_V #0XPara, 1, "N";
               |SI XPara = 25; XPara = 36; |FINSI;
         |SIGUE;
    |FINSI;

    |SI enDigCaja = 2;
        |PARA XPara = 12; |SI XPara [ 19; |HACIENDO XPara = XPara + 1;
              |C_M #0XPara, 1, "N";
              |C_V #0XPara, 1, "N";
        |SIGUE;

        |PARA XPara = 20; |SI XPara [ 38; |HACIENDO XPara = XPara + 1;
              |C_M #0XPara, 1, "S";
              |C_V #0XPara, 1, "S";  |PINTA #0XPara;
              |SI XPara = 25; XPara = 36; |FINSI;
        |SIGUE;
    |FINSI;
|FPRC;

|PROCESO seleccion; |TIPO 0;
    |SI #0#6 = "T";
        #0#4 = fechad; |PINTA #0#4;
        #0#5 = fechah; |PINTA #0#5;
        |C_M #0#4,  1, "N";
        |C_M #0#5,  1, "N";
        |C_M #0#9,  1, "S";
        |C_M #0#10, 1, "S";
    |SINO;
        #0#9  = 01; |PINTA #0#9;
        #0#10 = 04; |PINTA #0#10;
        |C_M #0#4,  1, "S";
        |C_M #0#5,  1, "S";
        |C_M #0#9,  1, "N";
        |C_M #0#10, 1, "N";
    |FINSI;
|FPRC;

|PROCESO fecha; |TIPO 0;
     |SI #0Campo < fechad; |O #0Campo > fechah;
         |MENAV "     Fecha Incorrecta";
         |ERROR;
     |FINSI;
|FPRC;

|CALCULO DesHasC; |TIPO 0;
     |SI enDigCaja = 1;
         |SI #0#11 = "N";
             #0#12 = 01;  |PINTA #0#12;  |C_M #0#12, 1, "N";
             #0#13 = 99;  |PINTA #0#13;  |C_M #0#13, 1, "N";
             |PARA nCampo = 14;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   |C_M #0nCampo, 1, "S";
             |SIGUE;
         |SINO;
             |C_M #0#12, 1, "S";
             |C_M #0#13, 1, "S";
             |PARA nCampo = 14;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   |C_M #0nCampo, 1, "N";
                   #0nCampo = 0;  |PINTA #0nCampo;
             |SIGUE;
         |FINSI;
     |SINO;
         |SI #0#11 = "N";
             #0#37 = "";  |PINTA #0#37;  |C_M #0#37, 1, "N";
             #0#38 = "";  |PINTA #0#38;  |C_M #0#38, 1, "N";
             |PARA nCampo = 20;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
                   |C_M #0nCampo, 1, "S";
             |SIGUE;
         |SINO;
             |C_M #0#37, 1, "S";
             |C_M #0#38, 1, "S";
             |PARA nCampo = 20;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
                   |C_M #0nCampo, 1, "N";
                   #0nCampo = "";  |PINTA #0nCampo;
             |SIGUE;
         |FINSI;
     |FINSI;
|FCAL;

|CALCULO NoMasCon; |TIPO 0;
     |SI enDigCaja = 1;
         |SI #0Campo = 0;
             |PARA nCampo = Campo + 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   #0nCampo = 0;  |C_M #0nCampo, 1, "N";
             |SIGUE;
         |SINO;
             |PARA nCampo = Campo + 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   |C_M #0nCampo, 1, "S";
             |SIGUE;
         |FINSI;
     |SINO;
         |SI #0Campo = "      ";
             |PARA nCampo = Campo + 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   #0nCampo = "";  |C_M #0nCampo, 1, "N";
             |SIGUE;
         |SINO;
             |PARA nCampo = Campo + 1;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
                   |C_M #0nCampo, 1, "S";
             |SIGUE;
         |FINSI;
     |FINSI;
|FCAL;

|CALCULO Tipo7C26; |TIPO 7;
    |SI #0#27 = "R";
        aAlfa1 = "    (S) Fra Cobradas, (N) Fras pendientes de Cobrar, (T) Todas";
    |SINO;
        aAlfa1 = "    (S) Fra Pagadas, (N) Fras pendientes de Pagar, (T) Todas";
    |FINSI;
    |MENSA aAlfa1;
|FCAL;

|| *************************************************************************

|PROCESO ModCobros;
   enSwCaja = 1;
   |SI nInkey = 12; eModoCaja = 4; |FINSI;
   |SI nInkey = 13; eModoCaja = 2; |FINSI;

   eDevenCaja = #999#44;
   ePerioCaja = #999#45;
   |HAZ ePathCaja;

   nError = 0;
   |SI aTipoIVA = "S";
       aFichero = "c" + ePathCaja;
       |CIERRA #2;  |NOME_DAT #2  aFichero;
       |ABRE #2;
       #2#0  = #999#0;
       #2#14 = eClvDeCaja;
       #2#1  = #999#1;
       |LEE 041#2=;
       |SI FSalida ! 0;
           nError = 1;
       |FINSI;
       |CIERRA #2;
   |SINO;
       aFichero = "v" + ePathCaja;
       |CIERRA #12;  |NOME_DAT #12  aFichero;
       |ABRE #12;
       #12#0  = #999#0;
       #12#14 = eClvDeCaja;
       #12#1  = #999#1;
       |LEE 041#12=;
       |SI FSalida ! 0;
           nError = 1;
       |FINSI;
       |CIERRA #12;
   |FINSI;
   |SI nError = 1;
       |MENAV "    Hay un error en los ficheros, no existe la factura";
       |ACABA;
   |FINSI;

   eEmpreCaja = #999#0;
   eRegisCaja = #999#1;
   enEjerCaja = #999#21;
   eDevenCaja = #999#44;
   |HAZ eTrataClaveZ;

   |SI eModoCaja = 2;

|| ... Graba Auxiliar
       |ABRE #501;
       #501#0  = #999#0;
       #501#1  = #999#21;
       #501#13 = #999#13;
       #501#17 = #999#44;
       #501#2  = #999#1;
       |LEE 141#501=;
       |SI FSalida ! 0;
           |BORRA 020#999a;
           |LIBERA #501;
           |CIERRA #501;
           |ACABA;
       |FINSI;
       #999#16 = #501#12;
       #999#17 = #501#8;
       #999#18 = #501#16;
       #999#19 = #501#6;
       #999#20 = #501#7;

       |LIBERA #501;
       |CIERRA #501;

       |SI #0#26 ! "T";
            |SI #999#16 ! #999#10; |Y #0#26 = "S";
                |BORRA 020#999a;
                |ACABA;
            |FINSI;
            |SI #999#16 = #999#10; |Y #0#26 = "N";
                |BORRA 020#999a;
                |ACABA;
            |FINSI;
        |FINSI;

        |GRABA 020#999a;
   |FINSI;
|FPRC;

|PROCESO LeeCc502;
  |PRINT;
  enSwLinea = 2;
|FPRC;

|DEFBUCLE LeeCc502;
   #502#1;
   ;
   eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 01;
   eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 99;
   ;
   NULL, LeeCc502;
|FIN;

|PROCESO ImprimeAux;

  |SI nSw = 0;
      aCif    = #990#12;
      aCuenta = #990#5;
  |FINSI;

  |SI aCif ! #990#12;
     |SI #0#28 = "C";
         enSwLinea = 3; |PRINT;
     |FINSI;
     aCif      = #990#12;
     aCuenta   = #990#5;
     enSwLinea = 0;
  |FINSI;

  |SI aCuenta ! #990#5;
      enSwLinea = 1;
      aCuenta   = #990#5;
  |FINSI;

  |PDEFECTO #0,39,51;
  nError = 0;

  eDevenCaja = #990#44;
  ePerioCaja = #990#45;
  |HAZ ePathCaja;

   |SI aTipoIVA = "S";
       aFichero = "c" + ePathCaja;
       |CIERRA #2;  |NOME_DAT #2  aFichero;

       |ABRE #2;
       |DDEFECTO #2;
       #2#0  = #990#0;
       #2#14 = eClvDeCaja;
       #2#1  = #990#1;
       |LEE 041#2=;
       #0#39 = #2#12;
       |SI  #2#3 ! 0;
            aAlfa1 = ("00000" + #2#3) % -105;
            #0#40 = aAlfa1;
       |FINSI;
       #0#41  = #2#38;
       aAlfa1 = ("00000" + #2#1) % -105;
       #0#42  = aAlfa1;
       #0#43  = #2#15;
       aAlfa1 = ("000000" + #2#16) % -106;
       #0#44  = aAlfa1;
       #0#45  = #2#13;
       |SI enDigCaja = 1;
           aAlfa1 = (("00" + #2#5) % -102);
       |SINO;
           aAlfa1 = #2#72;
       |FINSI;
       #0#46 = aAlfa1 + " " + #2#35;
       #0#47 = #2#6;
       #0#48 = #2#22;
       #0#49 = #2#7 + #2#23 + #2#24;
       #0#50 = #2#9 + #2#27 + #2#28;
       |CIERRA #2;

   |SINO;
       aFichero = "v" + ePathCaja;
       |CIERRA #12;  |NOME_DAT #12  aFichero;

       |ABRE #12;
       |DDEFECTO #12;
       #12#0  = #990#0;
       #12#14 = eClvDeCaja;
       #12#1  = #990#1;
       |LEE 041#12=;
       #0#39 = #12#12;
       |SI  #12#3 ! 0;
            aAlfa1 = ("00000" + #12#3) % -105;
            #0#40 = aAlfa1;
       |FINSI;
       #0#41  = #12#38;
       aAlfa1 = ("00000" + #12#1) % -105;
       #0#42  = aAlfa1;
       #0#43  = #12#15;
       aAlfa1 = ("000000" + #12#16) % -106;
       #0#44  = aAlfa1;
       #0#45  = #12#13;
       |SI enDigCaja = 1;
           aAlfa1 = (("00" + #12#5) % -102);
       |SINO;
           aAlfa1 = #12#72;
       |FINSI;
       #0#46 = aAlfa1 + " " + #12#35;
       #0#47 = #12#6;
       #0#48 = #12#22;
       #0#49 = #12#7 + #12#23 + #12#24 + #12#45 + #12#46 + #12#47;
       #0#50 = #12#9 + #12#27 + #12#28 + #12#51 + #12#52 + #12#53;
       |CIERRA #12;
   |FINSI;

   eEmpreCaja = #990#0;
   eRegisCaja = #990#1;
   enEjerCaja = #990#21;
   eDevenCaja = #990#44;
   enTotal    = #990#16;
   enTBases   = #990#19;
   enTCuotas  = #990#20;

  |SI #0#28 ! "C"; enSwLinea = 0; |FINSI;

  |PRINT;
  |SI #0#28 = "D";
      enSwLinea = 1;
      |BUCLE LeeCc502;
      |SI enSwLinea = 2; enSwLinea = 3; |PRINT; |FINSI;
  |FINSI;
  nSw       = 1;
  enSwLinea = 2;
|FPRC;

|DEFBUCLE ImprimeAux;
   #990#3003;
   ;
   aTipoIVA, "01.01.0000", 00001;
   aTipoIVA, "31.12.2999", 32000;
   ;
   NULL, ImprimeAux;
|FIN;

|DEFBUCLE ImprimeAux_Cif;
   #990#2006;
   ;
   "            ", #0#33, #0#34, aTipoIVA, "01.01.2000", 00001;
   "zzzzzzzzzzzz", #0#33, #0#34, aTipoIVA, "31.12.2999", 32000;
   ;
   NULL, ImprimeAux;
|FIN;

|PROCESO Imprimir;

  informe = inform2;
  |SI #0#28 ! "C";
      informe = inform1;
  |FINSI;
  |MENAV "0000 Recuerde seleccionar el papel de la impresora en Horizontal";

  |IMPRE 0;
  |SI FSalida ! 0;
      |MENAV "    Proceso interrumpido";
      |ACABA;
  |FINSI;
  |INFOR informe;
  |SI FSalida ! 0;
      |MENAV "    Error. No existe informe";
      |FINIMP;
      |ACABA;
  |FINSI;

  nSw = 0;
  enSwLinea = 0;
  |SI #0#28 ! "C";
      |BUCLE ImprimeAux;
  |SINO;
      |BUCLE ImprimeAux_Cif;
  |FINSI;

  |SI nSw = 1;
      |SI #0#28 = "C";
          enSwLinea = 3; |PRINT;
      |FINSI;
      |PIEINF;
  |FINSI;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO AntesImprimir;
  |C_M #0#28,1,"S"; |C_V #0#28,1,"S"; |C_P #0#28, 1, 1134;
  |C_M #0#29,1,"S"; |C_V #0#29,1,"S"; |C_P #0#29, 1, 1222;
  |C_M #0#30,1,"S"; |C_V #0#30,1,"S"; |C_P #0#30, 1, 1322; |C_A #0#30,1,50;

  |PUSHV  1003 1474;
  |BLANCO 1003 1474;
  |CUADRO 1003 1474;
  |CUADRO 1004 1473;
  |PINTA 1105, " Inf. Det/Res/Res. por CIF : "; |PINTA #0#28;
  |ATRI S; |PINTA 1111, "D";
           |PINTA 1115, "R";
           |PINTA 1128, "C"; |ATRI 0;
  |PINTA 1205, " Fecha Informe :  "; |PINTA #0#29
  |PINTA 1305, " Titulo Informe:  "; |PINTA #0#30

|ET Campo28;
  |ENCAMPO #28#0;
  |SI FSalida = 7; |POPV; |ACABA; |FINSI;
  |SI FSalida = 1; |VETE ElInforme; |FINSI;

|ET Campo29;
  |ENCAMPO #29#0;
  |SI FSalida = 1; |VETE ElInforme; |FINSI;
  |SI FSalida = 7; |POPV; |ACABA; |FINSI;
  |SI FSalida = 2; |VETE Campo28; |FINSI;

  |ENCAMPO #30#0;
  |SI FSalida = 1; |VETE ElInforme; |FINSI;
  |SI FSalida = 7; |POPV; |ACABA; |FINSI;
  |SI FSalida = 2; |VETE Campo29; |FINSI;

|ET ElInforme;
  |CONFI "0000SImprimir informe ";
  |SI FSalida = 0;
      |HAZ Imprimir;
  |FINSI;
  |POPV;
|FPRC;

|| ******************************************************

|CALCULO Tipo7Ccw4; |TIPO 7;
   |SI aTipoIVA = "R";
       aAlfa1 = "0000<F3> Imprime Relacion, <F4> Consulta Cobros, <F5> Modifica Cobros";
   |SINO;
       aAlfa1 = "0000<F3> Imprime Relacion, <F4> Consulta Pagos, <F5> Modifica Pagos";
   |FINSI;
   |MENSA aAlfa1;
|FCAL;

|CALCULO Tipo11Ccw4; |TIPO 11;

 nInkey = FSalida;

 |SI nInkey = 11;
     |HAZ AntesImprimir;
 |FINSI;

 |SI nInkey = 12; |O nInkey = 13;
     |LEE 141#999=;
     |HAZ ModCobros;
     |LIBERA #999;
     |PONCONTROL 23, "SI";
 |FINSI;

|FCAL;
|| *************************************************************************
|PROCESO IgualoCampos;
     |DDEFECTO #999;
     #999#0  = eEmpreCaja;
     #999#21 = enEjerCaja;
     #999#13 = aTipoIVA;
     #999#1  = eRegisCaja;

     |SI aTipoIVA = "S";
         #999#2  = #eoslinco#16;
         #999#3  = #eoslinco#15;
         #999#4  = #eoslinco#13;
         #999#5  = #eoslinco#3;
         |SI enDigCaja = 1;
             aAlfa1   = ("00" + #eoslinco#5) % -102;
             #999#6 = aAlfa1;
         |SINO;
             #999#6 = #eoslinco#72;
         |FINSI;
         #999#7  = #eoslinco#35;
         #999#8  = #eoslinco#7 + #eoslinco#23 + #eoslinco#24;
         #999#9  = #eoslinco#9 + #eoslinco#27 + #eoslinco#28;
         #999#10 = #eoslinco#22;
         #999#11 = #eoslinco#38;
         #999#12 = #eoslinco#12;
         #999#14 = #eoslinco#6;
         #999#15 = #eoslinco#13;
         #999#17 = #eoslinco#17;

         #999#26 = #eoslinco#7;
         #999#27 = #eoslinco#9;
         #999#28 = #eoslinco#42;

         #999#29 = #eoslinco#23;
         #999#30 = #eoslinco#27;
         #999#31 = #eoslinco#43;

         #999#32 = #eoslinco#24;
         #999#33 = #eoslinco#28;
         #999#34 = #eoslinco#44;
    |FINSI;
    |SI aTipoIVA = "R";
        #999#2  = #eoslinve#16;
        #999#3  = #eoslinve#15;
        #999#4  = #eoslinve#13;
        #999#5  = #eoslinve#3;
        |SI enDigCaja = 1;
            aAlfa1 = ("00" + #eoslinve#5) % -102;
            #999#6 = aAlfa1;
        |SINO;
            #999#6 = #eoslinve#72;
        |FINSI;
        #999#7  = #eoslinve#35;
        #999#8  = #eoslinve#7 + #eoslinve#23 + #eoslinve#24 + #eoslinve#45 + #eoslinve#46 + #eoslinve#47;
        #999#9  = #eoslinve#9 + #eoslinve#27 + #eoslinve#28 + #eoslinve#51 + #eoslinve#52 + #eoslinve#53;
        #999#10 = #eoslinve#22;
        #999#11 = #eoslinve#38;
        #999#12 = #eoslinve#12;
        #999#14 = #eoslinve#6;
        #999#15 = #eoslinve#13;
        #999#17 = #eoslinve#17;

        #999#26 = #eoslinve#7;
        #999#27 = #eoslinve#9;
        #999#28 = #eoslinve#42;

        #999#29 = #eoslinve#23;
        #999#30 = #eoslinve#27;
        #999#31 = #eoslinve#43;

        #999#32 = #eoslinve#24;
        #999#33 = #eoslinve#28;
        #999#34 = #eoslinve#44;

        #999#35 = #eoslinve#45;
        #999#36 = #eoslinve#51;
        #999#37 = #eoslinve#69;

        #999#38 = #eoslinve#46;
        #999#39 = #eoslinve#52;
        #999#40 = #eoslinve#70;

        #999#41 = #eoslinve#47;
        #999#42 = #eoslinve#53;
        #999#43 = #eoslinve#71;
    |FINSI;

    #999#22 = enEjer;
|FPRC;

|| ///////////////////////////////////////////////////
|PROCESO SelCon2;
   |SI enConcepto ! 0;
       |SI #0#11 = "S";
           |SI enConcepto ] #0#12; |Y enConcepto [ #0#13; nSwSel = 1; |FINSI;
       |SINO;
           |SI enConcepto = #0#14; nSwSel = 1; |FINSI;
           |SI enConcepto = #0#15; nSwSel = 1; |FINSI;
           |SI enConcepto = #0#16; nSwSel = 1; |FINSI;
           |SI enConcepto = #0#17; nSwSel = 1; |FINSI;
           |SI enConcepto = #0#18; nSwSel = 1; |FINSI;
           |SI enConcepto = #0#19; nSwSel = 1; |FINSI;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO SelCon6;
   |SI eaConcepto ! "      ";
       |SI #0#11 = "S";
           |SI eaConcepto ] #0#37; |Y eaConcepto [ #0#38; nSwSel = 1; |FINSI;
       |SINO;
           |SI eaConcepto = #0#20; nSwSel = 1; |FINSI;
           |SI eaConcepto = #0#21; nSwSel = 1; |FINSI;
           |SI eaConcepto = #0#22; nSwSel = 1; |FINSI;
           |SI eaConcepto = #0#23; nSwSel = 1; |FINSI;
           |SI eaConcepto = #0#24; nSwSel = 1; |FINSI;
           |SI eaConcepto = #0#25; nSwSel = 1; |FINSI;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO GrabaAuxiliar;
   |HAZ EsCajaIva;
   |SI enSwCaja = 0; |ACABA; |FINSI;

   |HAZ IgualoCampos;

|SI nOp = 0;
|| ... Graba Auxiliar
   #501#0  = #999#0;
   #501#1  = #999#21;
   #501#13 = #999#13;
   #501#17 = eDevenCaja;
   #501#2  = #999#1;
   |LEE 141#501=;
   |SI FSalida ! 0;
       |DDEFECTO #501;
       #501#0  = #999#0;
       #501#1  = #999#21;
       #501#13 = #999#13;
       #501#17 = eDevenCaja;
       #501#2  = #999#1;

       #501#3  = #999#4;   || Fecha Factura
       #501#4  = #999#1;
       #501#8  = #999#17;
       #501#9  = #999#22;
       #501#14 = #999#3;
       #501#15 = #999#2;

       |GRABA 020#501b;
    |FINSI;
    |LIBERA #501;
|FINSI;

    #999#16 = #501#12;
    #999#17 = #501#8;
    #999#18 = #501#16;
    #999#19 = #501#6;
    #999#20 = #501#7;

    |SI #0#26 ! "T";
        |SI #999#16 ! #999#10; |Y #0#26 = "S"; |ACABA; |FINSI;
        |SI #999#16 = #999#10; |Y #0#26 = "N"; |ACABA; |FINSI;
    |FINSI;

    #999#44 = #501#17;
    #999#45 = #501#18;

    |GRABA 020#999n;
    nSwAlgun = 1;
|FPRC;

|PROCESO Facturas_C;
   nSwSel = 0;
   |SI enDigCaja = 1;
       enConcepto = #2#5;  |HAZ SelCon2;
       enConcepto = #2#33; |HAZ SelCon2;
       enConcepto = #2#34; |HAZ SelCon2;
   |SINO;
       eaConcepto = #2#72;  |HAZ SelCon6;
       eaConcepto = #2#73;  |HAZ SelCon6;
       eaConcepto = #2#74;  |HAZ SelCon6;
       eaConcepto = #2#75;  |HAZ SelCon6;
       eaConcepto = #2#76;  |HAZ SelCon6;
       eaConcepto = #2#77;  |HAZ SelCon6;
   |FINSI;
   |SI nSwSel = 0; |ACABA; |FINSI;

   eRegisCaja = #2#1;
   |HAZ GrabaAuxiliar;
|FPRC;

|PROCESO Facturas_V;
   nSwSel = 0;
   |SI enDigCaja = 1;
       enConcepto = #12#5;  |HAZ SelCon2;
       enConcepto = #12#33; |HAZ SelCon2;
       enConcepto = #12#34; |HAZ SelCon2;
       enConcepto = #12#60; |HAZ SelCon2;
       enConcepto = #12#61; |HAZ SelCon2;
       enConcepto = #12#62; |HAZ SelCon2;
   |SINO;
       eaConcepto = #12#72;  |HAZ SelCon6;
       eaConcepto = #12#73;  |HAZ SelCon6;
       eaConcepto = #12#74;  |HAZ SelCon6;
       eaConcepto = #12#75;  |HAZ SelCon6;
       eaConcepto = #12#76;  |HAZ SelCon6;
       eaConcepto = #12#77;  |HAZ SelCon6;
   |FINSI;
   |SI nSwSel = 0; |ACABA; |FINSI;

   eRegisCaja = #12#1;
   |HAZ GrabaAuxiliar;
|FPRC;

|DEFBUCLE FraVenta_T;
   #12#2;
   15, 16, 3;
   #0#33, #0#34, nDTrim, d_act, fDFecha, #0#0, #0#7, #0#2, #0#31;
   #0#33, #0#34, nHTrim, h_act, fHFecha, #0#1, #0#8, #0#3, #0#32;
   e;
   NULL, Facturas_V;
|FIN;

|DEFBUCLE FraVenta_F;
   #12#1;
   19, 13, 15, 16, 3;
   #0#33, #0#34, #0#0, d_act, fDFecha, #0#7, #0#2, #0#31;
   #0#33, #0#34, #0#1, h_act, fHFecha, #0#8, #0#3, #0#32;
   e;
   NULL, Facturas_V;
|FIN;

|DEFBUCLE FraCompra_T;
   #2#2;
   15, 16, 3;
   #0#33, #0#34, nDTrim, d_act, fDFecha, #0#0, #0#7, #0#2, #0#31;
   #0#33, #0#34, nHTrim, h_act, fHFecha, #0#1, #0#8, #0#3, #0#32;
   e;
   NULL, Facturas_C;
|FIN;

|DEFBUCLE FraCompra_F;
   #2#1;
   19, 13, 15, 16, 3;
   eEmpreCaja, enEjerCaja, #0#0, d_act, fDFecha, #0#7, #0#2, #0#31;
   eEmpreCaja, enEjerCaja, #0#1, h_act, fHFecha, #0#8, #0#3, #0#32;
   e;
   NULL, Facturas_C;
|FIN;

|PROCESO Lee501;

   eDevenCaja = #501#17;
   ePerioCaja = #501#18;
   |HAZ ePathCaja;

   |SI aTipoIVA = "S";
       aFichero = "c" + ePathCaja;
       |CIERRA #2;  |NOME_DAT #2  aFichero;

       |ABRE #2;
       #2#0  = #501#0;
       #2#14 = eClvDeCaja;
       #2#1  = #501#2;
       |LEE 041#2=;
       |SI FSalida = 0;
           nSwSel = 1;
           |SI #2#19 < d_act; |O #2#19 > h_act; nSwSel = 0; |FINSI;
           |SI #2#15 < #0#7;  |O #2#15 > #0#8;  nSwSel = 0; |FINSI;
           |SI #2#16 < #0#2;  |O #2#16 > #0#3;  nSwSel = 0; |FINSI;
           |SI #2#3  < #0#31; |O #2#3  > #0#32; nSwSel = 0; |FINSI;
           |SI nSwSel = 1;
               |HAZ Facturas_C;
           |FINSI;
      |FINSI;
      |CIERRA #2;
   |FINSI;

   |SI aTipoIVA = "R";
       aFichero = "v" + ePathCaja;
       |CIERRA #12; |NOME_DAT #12 aFichero;
       |ABRE #12;
       #12#0  = #501#0;
       #12#14 = eClvDeCaja;
       #12#1  = #501#2;
       |LEE 041#12=;
       |SI FSalida = 0;
           nSwSel = 1;
           |SI #12#19 < d_act; |O #12#19 > h_act; nSwSel = 0; |FINSI;
           |SI #12#15 < #0#7;  |O #12#15 > #0#8;  nSwSel = 0; |FINSI;
           |SI #12#16 < #0#2;  |O #12#16 > #0#3;  nSwSel = 0; |FINSI;
           |SI #12#3  < #0#31; |O #12#3  > #0#32; nSwSel = 0; |FINSI;
           |SI nSwSel = 1;
               |HAZ Facturas_V;
           |FINSI;
       |FINSI;
       |CIERRA #12;
   |FINSI;
|FPRC;

|DEFBUCLE Lee501;
   #501#1;
   ;
   eEmpreCaja, enEjerCaja, aTipoIVA, 0001, 00001;
   eEmpreCaja, enEjerCaja, aTipoIVA, 9999, 32000;
   e;
   NULL, Lee501;
|FIN;

|| ******************************************************
|PROCESO AuxMin;
  #999#0  = #0#33;
  #999#21 = #0#34;
  #999#44 = 0000;
  #999#13 = aTipoIVA;
  #999#1  = 00001;
  #999#4  = "01.01.2000";
|FPRC;

|PROCESO AuxMax;
  #999#0  = #0#33;
  #999#21 = #0#34;
  #999#44 = 9999;
  #999#13 = aTipoIVA;
  #999#1  = 32000;
  #999#4  = "31.12.2999";
|FPRC;

|CALCULO impre; |TIPO 3;

    |DBASE aMas;
    aDef = aMas + "def/eosmccw4";
    |CARGA_DEF aDef, espejo@;
    |SI FSalida ! 0;
        |MENAV "    Error cargando def eosmccw4";
        |ACABA;
    |FINSI;

    aTipoIVA = #0#27;
    |SI #0#6 = "T";
        nDTrim = #0#9;
        nHTrim = #0#10;
        fDFecha = fechad;
        fHFecha = fechah;
    |SINO;
        nDTrim = 01;
        nHTrim = 04;
        fDFecha = #0#4;
        fHFecha = #0#5;
    |FINSI;

    d_act = #0#35;
    h_act = #0#35;
    |SI #0#35 = 0;
        d_act = 1;
        h_act = 6;
    |FINSI;

    eEmpreCaja = #0#33;
    enEjerCaja = #0#34;

    aFichero = "x" + Usuario;
    |NOME_DAT #999 aFichero;
    |NOME_DAT #990 aFichero;
    |DELINDEX #999;

    fichero = #0#33;
    fichero = "00000" + fichero;
    fichero = fichero % -105;
    anyo    = #0#34;
    anyo    = ("00" + anyo) % -102;
    eaNCaja = fichero + anyo;

    aFichero = "c" + fichero + anyo; |NOME_DAT #2   aFichero;
    aFichero = "v" + fichero + anyo; |NOME_DAT #12  aFichero;

    aFichero = "f" + eaNCaja;        |NOME_DAT #501 aFichero;
    aFichero = "m" + eaNCaja;        |NOME_DAT #502 aFichero;

    nSwAlgun = 0;
    |ABRE #999;
    |ABRE #501;
    eDevenCaja = 0;
    nOp        = 0;
    |SI aTipoIVA = "R";
        |SI #0#6 = "F"; |BUCLE FraVenta_F;  |FINSI;
        |SI #0#6 = "T"; |BUCLE FraVenta_T;  |FINSI;
    |SINO;
        |SI #0#6 = "F"; |BUCLE FraCompra_F; |FINSI;
        |SI #0#6 = "T"; |BUCLE FraCompra_T; |FINSI;
    |FINSI;
    |CIERRA #501;

    |SI enEjer > 2014;
        nOp = 1; |BUCLE Lee501;
    |FINSI;

    |CIERRA #999;

    |SI enDigCaja = 1; |C_A #999#6,1,02; |FINSI;

    nForzCaja = 1;
    |SI nSwAlgun = 1;
        |SI aParam = "Informe";
            |HAZ Imprimir;
        |SINO;
            |PINPA #0#999;
            |SI #0#27 = "S";
               |ATRI R; |PINTA 0522, "Compra en Regimen Especial de Criterio de Caja"; |ATRI 0;
               |ATRI R; |PINTA 0830, "%Pagado "; |ATRI 0;
               |ATRI I; |PINTA 1967, "Pagado";
               |ATRI 0; |PINTA 1973, " -";
            |FINSI;
            |ENTLINEAL #3#999, -3, 4, 22, 0, AuxMin, AuxMax;
        |FINSI;
    |SINO;
        |MENAV "    No existe Facturas dentro de la seleccion informada";
    |FINSI;
    nForzCaja = 0;

    |DELINDEX #999;

    |DESCARGA_DEF #990;
|FCAL;

|PROGRAMA;
   aParam = PARAMETRO; |QBF aParam;
   aAlfa1 = aParam % 101;
   aParam = aParam - aAlfa1;

   #0#27 = aAlfa1;

   |CLS;
   |PINPA #0#0;
   |SI #0#27 = "R";
       |ATRI R; |PINTA 0607, "Facturas de Venta en Regimen de Criterio de Caja"; |ATRI 0;
       |PINTA 2018, "Cobradas : ";
       eaTexto = "Cobrados";
       #0#51   = "Cliente";
   |SINO;
       |ATRI R; |PINTA 0607, "Facturas de Compra en Regimen de Criterio de Caja"; |ATRI 0;
       |PINTA 2018, "Pagadas .: ";
       eaTexto = "Pagados";
       #0#51   = "Proveedor";
   |FINSI;
   aTipoIVA = #0#27;

   |SI aParam = "Informe";
       |ATRI R;
       |SI #0#27 = "R";
           |PINTA 0607, "Informe Fras de Venta en Regimen Especial de Criterio de Caja";
           #0#30 = "INFORME DE FACTURAS DE VENTA EN REGIMEN DE CRITERIO DE CAJA";
       |SINO;
           |PINTA 0607, "Informe Fras de Compra en Regimen Especial de Criterio de Caja";
           #0#30 = "INFORME DE FACTURAS DE COMPRA EN REGIMEN DE CRITERIO DE CAJA";
       |FINSI;
       |ATRI 0;
       |PINTA 2035, "Inf.Det/Res/Res.por CIF:   ";
       |ATRI S; |PINTA 2039, "D";
                |PINTA 2043, "R";
                |PINTA 2055, "C"; |ATRI 0;
       |PINTA 2107, " Fecha :                                                        ";
       |PINTA 2207, " Titulo:                                                        ";
       |PINTA 2307, "읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸";
       |C_M #0#28, 1, "S"; |C_V #0#28, 1, "S";
       |C_M #0#29, 1, "S"; |C_V #0#29, 1, "S";
       |C_M #0#30, 1, "S"; |C_V #0#30, 1, "S";
   |FINSI;
   |PINDA #0#0;

   |ENDATOS #1#0;
|FPRO;
