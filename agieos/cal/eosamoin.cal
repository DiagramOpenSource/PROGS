|FICHEROS;
     eosamoin #0;
     eosamorc #1;
     eosamorl #2;
     eosclien #3;
     eosactiv #4;
     eoscolib #5;
     eosma004 #9;
     eosw0044 #99,MANTE;
|FIN;

|VARIABLES;
     XPara       = 0;
     XPara1      = 0;
     Fichero     = "";
     SwTempo     = 0;
     DActiv      = 0;
     HActiv      = 0;
     Tecla       = 0;
     Contador    = 0;
     LaActiv     = 0;
     Fecha1      = @;
     Fecha2      = @;
     VAralf      = "";

     swprint = 0;
     cc      = 0;
     linea2  = 0;
     linea1  = 0;
     x       = 0;
     guion   = "-";
     espacio = "                                                          ";
     espa    = " ";
     barra   = "\";
     reg     = 0;

     impre_valor = "";
     asc1        = 0;
     asc2        = 0;
     asc3        = 0;
     asc4        = 0;
     asc5        = 0;
     asc6        = 0;
     asc7        = 0;
     asc8        = 0;
     asc9        = 0;
     asc10       = 0;
     asc11       = 0;
     asc12       = 0;
     asc13       = 0;
     asc14       = 0;
     asc15       = 0;
     asc16       = 0;
     asc17       = 0;
     asc18       = 0;
     asc19       = 0;
     asc20       = 0;
     co_asc      = 0;
     d_asc       = 0;
     h_asc       = 0;
     longi       = 0;
     co_co       = 0;
     fec         = "";
     fecha       = @;
     nAnyo1 = 0;
     nAnyo2 = 0;

     &ray1   = "";
     &ray2   = "";
     &linea  = 0;
     &sw     = 0;
     &hoj    = 0;
     &amo    = 0;
     &acu    = 0;
     &pendi  = 0;
     &enEjer = 0;

     nAny1 = 0;
     nAny2 = 0;
     nAny3 = 0;
     nSw   = 0;
     nEmpresa = 0;
     nActividad = 0;

     &EURODB = 0;
|FIN;

|INCLUYE i_consul;

|PROCESO Mayusculas;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO PonFecha; |TIPO 0;
/*
  |SI #0#27 = 0;
      Fecha1  = ~;
      VAralf = Fecha1 % -102;
      #0#27   = VAralf;  |PINTA #0#27;
  |FINSI;
*/
  |SI Campo = 27;
      #0#36 = #0#27; |PINTA #0#36;


      |SI #0#27 ] 80;
          VAralf = "01.01.19" + #0#27;
      |SINO;
          VAralf = "01.01.20" + (("00" + #0#27) % -102);
      |FINSI;
       Fecha1 = VAralf;
  |FINSI;

  |SI #0#36 ] 80;
      VAralf = "31.12.19" + #0#36;
  |SINO;
      VAralf = "31.12.20" + (("00" + #0#36) % -102);
  |FINSI;
  Fecha2 = VAralf;

  #0#30 = #0#36;   |PINTA #0#36;
  #0#33 = Fecha1;  |PINTA #0#33;
  #0#34 = Fecha2;  |PINTA #0#34;

  |SI Fecha1 > Fecha2; |ERROR; |FINSI;
|FPRC;

|PROCESO Seleccion;
  |HAZ PonFecha;
  |SI #0#0 = "S";
      |C_M #0#1, 1, "N";   #0#1 = 1;      |PINTA #0#1;
      |C_M #0#2, 1, "N";   #0#2 = 99999;  |PINTA #0#2;
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
  |SINO;
      |C_M #0#1, 1, "S";
      |C_M #0#2, 1, "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N";  #0XPara = 0;  |PINTA #0XPara;
      |SIGUE;
  |FINSI;
|FPRC;

|PROCESO Actividad;
  |C_M #0#29, 1, "S";
  #0#29 = 6;
  |SI #0#28 = 0;
      |C_M #0#29, 1, "N";  #0#29 = 0;
  |FINSI;
  |PINTA #0#29;
|FPRC;

|| ************************ Proceso para cargar caracteres en impresoras

|PROCESO &carga_asc;
  asc1  = 0; asc2  = 0; asc3  = 0; asc4  = 0; asc5  = 0;
  asc6  = 0; asc7  = 0; asc8  = 0; asc9  = 0; asc10 = 0;
  asc11 = 0; asc12 = 0; asc13 = 0; asc14 = 0; asc15 = 0;
  asc16 = 0; asc17 = 0; asc18 = 0; asc19 = 0; asc20 = 0;
  co_co = 0;
  |PARA co_asc = d_asc; |SI co_asc [ h_asc; |HACIENDO co_asc = co_asc + 1;
        co_co = co_co + 1;
        |SI #5co_asc ! 999;
            |SI co_co = 1;  asc1  = #5co_asc; |FINSI;
            |SI co_co = 2;  asc2  = #5co_asc; |FINSI;
            |SI co_co = 3;  asc3  = #5co_asc; |FINSI;
            |SI co_co = 4;  asc4  = #5co_asc; |FINSI;
            |SI co_co = 5;  asc5  = #5co_asc; |FINSI;
            |SI co_co = 6;  asc6  = #5co_asc; |FINSI;
            |SI co_co = 7;  asc7  = #5co_asc; |FINSI;
            |SI co_co = 8;  asc8  = #5co_asc; |FINSI;
            |SI co_co = 9;  asc9  = #5co_asc; |FINSI;
            |SI co_co = 10; asc10 = #5co_asc; |FINSI;
            |SI co_co = 11; asc11 = #5co_asc; |FINSI;
            |SI co_co = 12; asc12 = #5co_asc; |FINSI;
            |SI co_co = 13; asc13 = #5co_asc; |FINSI;
            |SI co_co = 14; asc14 = #5co_asc; |FINSI;
            |SI co_co = 15; asc15 = #5co_asc; |FINSI;
            |SI co_co = 16; asc16 = #5co_asc; |FINSI;
            |SI co_co = 17; asc17 = #5co_asc; |FINSI;
            |SI co_co = 18; asc18 = #5co_asc; |FINSI;
            |SI co_co = 19; asc19 = #5co_asc; |FINSI;
            |SI co_co = 20; asc20 = #5co_asc; |FINSI;
        |SINO;
            |SAL;
        |FINSI;
  |SIGUE;

  |SI asc1    = 0; |ACABA; |FINSI;

  impre_valor =               &asc1  + &asc2  + &asc3  + &asc4  + &asc5;
  impre_valor = impre_valor + &asc6  + &asc7  + &asc8  + &asc9  + &asc10;
  impre_valor = impre_valor + &asc11 + &asc12 + &asc13 + &asc14 + &asc15;
  impre_valor = impre_valor + &asc16 + &asc17 + &asc18 + &asc19 + &asc20;

  |IMPRIME impre_valor;
|FPRC;

|| ********************************** Proceso Grabacion Modelo 04

|PROCESO Graba04;
  |SI #5#89 = "N"; |ACABA; |FINSI;

  |ABRE #9;
  #9#0 = #99#0;
  #9#1 = LaActiv;
  #9#2 = #0#32;
  #9#3 = #0#30; || ... #99#2;
  |LIBERA #9;
  |LEE 140#9=;
  |SI FSalida = 0;
      #9#6  = #0#33;
      #9#7  = #0#34;
      #9#16 = 1;
      #9#17 = #99#6 - 1;
      #9#18 = reg;
      #9#19 = fecha;
      |GRABA 140#9a;
  |SINO;
      #9#0  = #99#0;
      #9#1  = LaActiv;
      #9#2  = #0#32;
      #9#3  = #0#30; || ... #99#2;
      #9#6  = #0#33;
      #9#7  = #0#34;
      #9#16 = 1;
      #9#17 = #99#6 - 1;
      #9#18 = reg;
      #9#19 = fecha;
      |GRABA 140#9n;
  |FINSI;
  |CIERRA #9;
|FPRC;

|| ********************************** Proceso pie de pagina

|PROCESO Rayas;                      || ***** Rayas FINALES ************
  |SI swprint = 0;  |ACABA;  |FINSI;

  cc      = longi - linea - 1;
  linea2  = linea;
  linea   =  100 - cc;

  sw      = 3;
  ray1    = guion * linea;
  espacio = espa * linea;
  |PRINT;

  sw     = 2;
  linea1 = longi - linea2 - 4;
  |PARA x = 0;|SI x < linea1;|HACIENDO x = x + 1;
        espacio = espacio + espa;
        ray2 = espacio + barra;
        |PRINT;
  |SIGUE;
  |PIEINF;

  |SI #5#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;
|FPRC;

|PROCESO BorraVar;
  swprint = 0;
  cc      = 0;
  linea2  = 0;
  linea1  = 0;
  x       = 0;
  reg     = 0;

  ray1   = "";
  ray2   = "";
  linea  = 0;
  sw     = 0;
  hoj    = 0;
  amo    = 0;
  acu    = 0;
  pendi  = 0;
|FPRC;

|PROCESO lineasli;
  |SI #0#30 [ 80;
      nAnyo1 = 2000 + #0#30;
  |SINO;
      nAnyo1 = 1900 + #0#30;
  |FINSI;

  |SI #2#4 [ 80;
      nAnyo2 = 2000 + #2#4;
  |SINO;
      nAnyo2 = 1900 + #2#4;
  |FINSI;

  |SI nAnyo2 = nAnyo1;  amo = (amo + #2#11) ! EURODB;  |FINSI;
  |SI nAnyo2 [ nAnyo1;  acu = (acu + #2#11) ! EURODB;  |FINSI;
|FPRC;

|PROCESO Imprimir;
  amo = 0;  acu = 0;  |BUCLELIN 0lineasli#1;

  |SI amo = 0; |Y #0#37 = "N"; |ACABA; |FINSI;

  |ABRE #4;
  #4#0 = #1#0;
  #4#1 = #1#16;
  #4#2 = #1#1;
  |LEE 040#4=;
  |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
  |CIERRA #4;

  LaActiv = #1#16;

  swprint = 1;
  #3#0 = #1#0;
  |LEE 040#3=;
  |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

  linea = linea + 1;
  pendi = #1#11 - acu;
  |SI linea ] longi; FSalida = "PAGINA"; |PRINT; linea = 0;  |FINSI;

  reg = reg + 1;
  fecha = #1#10;
  |PRINT;
|FPRC;

|DEFBUCLE eosamorcS;
  #1#1;
  16;
  #99#0, #99#2, 00001, DActiv;
  #99#0, #99#2, 99999, HActiv;
  ;
  NULL, Imprimir;
|FIN;

|PROCESO PreparaLibro;
  |SI nSw = 0; |O nEmpresa ! #99#0; |O nActividad ! #99#1;

      |SI nSw = 1; |HAZ Rayas; |FINSI;
      nSw = 1;
      nEmpresa   = #99#0;
      nActividad = #99#1;
      |HAZ BorraVar;

      LaActiv = 0;
      DActiv  = #99#1;
      HActiv  = #99#1;
      |SI #99#1 = 0;  DActiv = 1;  HActiv = 6;  |FINSI;
  |FINSI;

  |BUCLE eosamorcS;

  |SI #99#2 = #0#30; |HAZ Graba04; |FINSI;

|FPRC;

|DEFBUCLE eosw0044;
  #99#2;
  8;
  00000, 0, 1900, "S";
  99999, 9, 2999, "S";
  ;
  NULL, PreparaLibro;
|FIN;

|| ***************************** Preparacion del Temporal

|PROCESO GrabaTempo;
  nAny3 = 2000 + #1#1;
  |SI #1#1 ] 80; nAny3 = 1900 + #1#1; |FINSI;
  |SI nAny3 < nAny1; |O nAny3 > nAny2; |ACABA; |FINSI;

  |ABRE #4;
  #4#0 = #1#0;
  #4#1 = #1#16;
  #4#2 = #1#1;
  |LEE 040#4=;
  |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
  |CIERRA #4;

  #99#0 = #1#0;
  #99#1 = #1#16;
  |SI #0#28 = 0;  #99#1 = 0;  |FINSI;
  #99#2 = #1#1;
  |LIBERA #99;
  |LEE 140#99=;
  |SI FSalida = 0;  |ACABA;  |FINSI;

  SwTempo = 1;
  #99#0 = #1#0;
  #99#1 = #1#16;
  |SI #0#28 = 0;  #99#1 = 0;  |FINSI;
  #99#2 = #1#1;
  #99#3 = #4#3;
  #99#4 = #4#6;
  #99#5 = 1;
  #99#6 = 1;
  #99#7 = "N";
  #99#8 = "S";
  #99#9 = nAny3;
  |GRABA 140#99n;
|FPRC;

|DEFBUCLE eosamorcP;
  #1#1;
  16;
  #0#1, 00, 00001, DActiv;
  #0#2, 99, 99999, HActiv;
  ;
  NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja;
  #99#0 = 00001;
  #99#1 = 0;
  #99#9 = nAny1;
|FRUT;

|RUTINA ClaveAlta;
  #99#0 = 99999;
  #99#1 = 9;
  #99#9 = nAny2;
|FRUT;

|PROCESO Tipo3; |TIPO 3;
  enEjer = 2000 + #0#30;
  |SI #0#30 ] 80;  enEjer = 1900 + #0#30;  |FINSI;

  nAny1 = 2000 + #0#27;
  |SI #0#27 ] 80; nAny1 = 1900 + #0#27; |FINSI;
  nAny2 = 2000 + #0#36;
  |SI #0#36 ] 80; nAny1 = 1900 + #0#36; |FINSI;

  |ABRE #5;
  |LEE 040#5p;
  |SI FSalida ! 0;
      |MENAV "       No existe control del libros.";
      |CIERRA #5;
      |ACABA;
  |FINSI;
  |CIERRA #5;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("L5" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #99 Fichero;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

  DActiv = #0#28;
  HActiv = #0#29;
  |SI #0#28 = 0; DActiv = 1;  HActiv = 9;  |FINSI;

  |IMPRE 0;
  |SI FSalida ! 0; |ACABA; |FINSI;

  longi = #5#7 - 18;
  d_asc = 48; h_asc = 67; |HAZ carga_asc;


  |ABRE #99;
  |SI #0#0 = "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |SI #0XPara ! 0;
                #0#1 = #0XPara;
                #0#2 = #0XPara;
                |BUCLE eosamorcP;
             |FINSI;
      |SIGUE;
  |SINO;
      |BUCLE eosamorcP;
  |FINSI;
  |CIERRA #99;

  |SI SwTempo = 0;
      |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
      |ACABA;
  |FINSI;

  |C_V #99#2,1,"N"; |C_M #99#2,1,"N";
  |C_V #99#9,1,"S"; |C_M #99#9,1,"S";

  |ENTLINEAL #2#99, -3, 4, 20, 1, ClaveBaja, ClaveAlta;

  |INFOR "eosamoin";
  |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

  nSw      = 0;
  nEmpresa = 0;

  |ABRE #3;
  |BUCLE eosw0044;
  |CIERRA #3;
  |SI nSw = 1; |HAZ Rayas; |FINSI;
  |FININF;

  d_asc = 68; h_asc = 87; |HAZ carga_asc;
  |FINIMP;
|FPRC;

|| ****************************** Procesos del Temporal

|PROCESO Tipo11;  |TIPO 11;
  |SI FSalida ! 9;  |Y FSalida ! 10;  |ACABA;  |FINSI;

  Tecla = FSalida;

  |LIBERA #99;
  |LEE 140#99=;

  |SI Tecla = 9;
        |SI #99#8 = "N";
            #99#8 = "S";
        |SINO;
            #99#8 = "N";
            #99#6 = 0;
        |FINSI;
  |FINSI;

  |SI Tecla = 10;
      #99#8 = "S";
      |C_M #99#6, 1, "S";
      |ENCAMPO #6#99;
  |FINSI;

  |PINTA #99#6;
  |PINTA #99#8;

  |GRABA 140#99a;

  |C_M #99#6, 1, "N";
|FPRC;
