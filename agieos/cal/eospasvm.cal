|FICHEROS;
   eosveaut #0;
   eoslinve #1;
   eosconce #2;
   eospasvm #3;
   eosclpre #4;
   eosclien #5;
   eoscabve #7;
   eosactiv #8;
   eosconc6 #9;
|FIN;

|VARIABLES;
 NConcepto = "";
 nAnyo     = 0;
 fichero   = "";
 anyoalfa  = "";

 dianum1 = 0;
 dianum2 = 0;
 dianum3 = 0;
 dianum4 = 0;
 dianum5 = 0;
 dianum6 = 0;
 dianum7 = 0;
 dianum8 = 0;
 dianum9 = 0;
 dianum10 = 0;
 dianum11 = 0;
 dianum12 = 0;
 period = 0;
 estado = 0;
    bruto = 0;
    reg = 0;
    cliente = 0;
    trimes = 0;
    swplani = 0;
    t = "t";
    T = "T";
    sw = 0;
    contado = "AL CONTADO";
    fecha = "";
    ejer = 0;
    error1 = "     NO EXISTE VENTAS AUTOMATICAS";
    error2 = "     NO EXISTE EMPRESA ";
    error3 = "     NO EXISTE CONCEPTO ";
    error4 = "     NO EXISTE CLIENTE ";
    errorfec3 = "     No existe ese dia el a¤o no es bisiesto";
    x = 0;
    vacio = "              ";
    vac1 = "                                                                  ";
    num = 0;
    total = 0;
    swlin = 0;
    sw1 = 0;
    sw2 = 0;
    sw3 = 0;
    sw4 = 0;
    sw5 = 0;
    sw6 = 0;
    sw7 = 0;
    sw8 = 0;
    sw9 = 0;
    sw10 = 0;
    sw11 = 0;
    sw12 = 0;
    anu1 = "8512";
    anu2 = "8613";
    anu3 = "8714";
    anu4 = "8805";
    anu5 = "8917";
    anu6 = "9011";
    anu7 = "9112";
    anu8 = "9203";
    anu9 = "9315";
    anu10 = "9416";
    anu11 = "9517";
    anu12 = "9601";
    anu13 = "9713";
    anu14 = "9814";
    anu15 = "9915";
    anu16 = "0006";
    anu17 = "0111";
    anu18 = "0212";
    anu19 = "0313";
    anu20 = "0404";
    anu21 = "0516";
    anu22 = "0617";
    anu23 = "0711";
    anu24 = "0802";
    anu25 = "0914";
    anu26 = "1015";
    anu27 = "1116";
    anu28 = "1207";
    anu29 = "1312";
    anu30 = "1413";
    anu31 = "1514";
    anu32 = "1605";
    anu33 = "1717";
    anu34 = "1811";
    anu35 = "1912";
    anu36 = "2003";

    dia1 = 0;
    dia2 = 31;
    dia3 = 60;
    dia4 = 91;
    dia5 = 121;
    dia6 = 152;
    dia7 = 182;
    dia8 = 213;
    dia9 = 244;
    dia10 = 274;
    dia11 = 305;
    dia12 = 335;
    diapri = "";
    diapri1 = 0;
    bisiesto = "";
    swbis = 1;
    anyo = "";
    mes = "";
    mesnum = 0;
    dia = "";
    cantidad = 0;
    indice = 0;
    anyoal = "";
    peri = "";
    {366}cant = 0;

    &EURODB = 0;
|FIN;

|CALCULO anyo;
|SI #0#94 = "1985"; anyo = anu1;  |FINSI;
|SI #0#94 = "1986"; anyo = anu2;  |FINSI;
|SI #0#94 = "1987"; anyo = anu3;  |FINSI;
|SI #0#94 = "1988"; anyo = anu4;  |FINSI;
|SI #0#94 = "1989"; anyo = anu5;  |FINSI;
|SI #0#94 = "1990"; anyo = anu6;  |FINSI;
|SI #0#94 = "1991"; anyo = anu7;  |FINSI;
|SI #0#94 = "1992"; anyo = anu8;  |FINSI;
|SI #0#94 = "1993"; anyo = anu9;  |FINSI;
|SI #0#94 = "1994"; anyo = anu10; |FINSI;
|SI #0#94 = "1995"; anyo = anu11; |FINSI;
|SI #0#94 = "1996"; anyo = anu12; |FINSI;
|SI #0#94 = "1997"; anyo = anu13; |FINSI;
|SI #0#94 = "1998"; anyo = anu14; |FINSI;
|SI #0#94 = "1999"; anyo = anu15; |FINSI;
|SI #0#94 = "2000"; anyo = anu16; |FINSI;
|SI #0#94 = "2001"; anyo = anu17; |FINSI;
|SI #0#94 = "2002"; anyo = anu18; |FINSI;
|SI #0#94 = "2003"; anyo = anu19; |FINSI;
|SI #0#94 = "2004"; anyo = anu20; |FINSI;
|SI #0#94 = "2005"; anyo = anu21; |FINSI;
|SI #0#94 = "2006"; anyo = anu22; |FINSI;
|SI #0#94 = "2007"; anyo = anu23; |FINSI;
|SI #0#94 = "2008"; anyo = anu24; |FINSI;
|SI #0#94 = "2009"; anyo = anu25; |FINSI;
|SI #0#94 = "2010"; anyo = anu26; |FINSI;
|SI #0#94 = "2011"; anyo = anu27; |FINSI;
|SI #0#94 = "2012"; anyo = anu28; |FINSI;
|SI #0#94 = "2013"; anyo = anu29; |FINSI;
|SI #0#94 = "2014"; anyo = anu30; |FINSI;
|SI #0#94 = "2015"; anyo = anu31; |FINSI;
|SI #0#94 = "2016"; anyo = anu32; |FINSI;
|SI #0#94 = "2017"; anyo = anu33; |FINSI;
|SI #0#94 = "2018"; anyo = anu34; |FINSI;
|SI #0#94 = "2019"; anyo = anu35; |FINSI;
|SI #0#94 = "2020"; anyo = anu36; |FINSI;

anyoal = #0#94 % -102;
                          ||Calcular si es o no anyo bisiesto;
swbis = 0;
bisiesto = anyo % 301;
|SI bisiesto = "1"; swbis = 1; |FINSI;
|FCAL;

|CALCULO clave;|TIPO 0;
|ABRE #0;
|ABRE #5;

#0#0 = #3#0;
#0#1 = 1;
|LEE 040#0=;
|SI FSalida = 0;
   |HAZ anyo;
   |ATRI I;
   |PINTA 0944,#0#94;
   |ATRI 0;
   Icant = cant1 <-;
   num = 1;
   |PARA x = 0;|SI x < 91;|HACIENDO x = x + 1;
       num = num + 1;
       cant = #0num;
       total = total + cant;
       Icant = Icant + 1;
   |SIGUE;
|SINO;
   |MENAV error1;
   |ERROR;
   |VETE fin;
|FINSI;

#0#0 = #3#0;
#0#1 = 2;
|LEE 040#0=;
|SI FSalida = 0;
   num = 1;
   |PARA x = 0;|SI x < 91;|HACIENDO x = x + 1;
        num = num + 1;
        cant = #0num;
        Icant = Icant + 1;
   |SIGUE;
|SINO;
   |MENAV error1;
   |ERROR;
   |VETE fin;
|FINSI;

#0#0 = #3#0;
#0#1 = 3;
|LEE 040#0=;
|SI FSalida = 0;
   num = 1;
   |PARA x = 0;|SI x < 92;|HACIENDO x = x + 1;
        num = num + 1;
        cant = #0num;
        Icant = Icant + 1;
   |SIGUE;
|SINO;
   |MENAV error1;
   |ERROR;
   |VETE fin;
|FINSI;

#0#0 = #3#0;
#0#1 = 4;
|LEE 040#0=;
|SI FSalida = 0;
   num = 1;
   |PARA x = 0;|SI x < 92;|HACIENDO x = x + 1;
        num = num + 1;
        cant = #0num;
        Icant = Icant + 1;
   |SIGUE;
|SINO;
   |MENAV error1;
   |ERROR;
   |VETE fin;
|FINSI;

#5#0 = #3#0;
|LEE 040#5=;
|SI FSalida ! 0;
     |MENAV error2;
     |ERROR;
|FINSI;

|ATRI I;
|PINTA 0826,#5#2;
|ATRI 0;
|ET fin;
|CIERRA #0;
|CIERRA #5;
|FCAL;

|CALCULO Concepto2; |TIPO 0;
|SI #8#50 = 2; |ACABA; |FINSI;

|ABRE #2;
#2#0 = #3#3;
|LEE 040#2=;
|SI FSalida ! 0;
    |MENAV error3;
    |ERROR;
|FINSI;
|CIERRA #2;

|ATRI I;
|PINTA 1648, #2#1;
|ATRI 0;
NConcepto = #2#1;
|FCAL;

|CALCULO Concepto6; |TIPO 0;
|SI #8#50 = 1; |ACABA; |FINSI;

|ABRE #9;
#9#0 = #3#9;
|LEE 040#9=;
|SI FSalida ! 0;
    |MENAV error3;
    |ERROR;
|FINSI;
|CIERRA #9;

|ATRI I;
|PINTA 1648, #9#1;
|ATRI 0;
NConcepto = #9#1;
|FCAL;

|CALCULO cliente;|TIPO 0;
|ABRE #4;
|SI #3#5 = 0;
|ATRI I;
    |PINTA 1927,contado;
|ATRI 0;
    |VETE cliente;
|FINSI;
#4#0 = #3#0;
#4#1 = #3#5;
#4#2 = 1;
|LEE 040#4=;
  |SI FSalida ! 0;
      |MENAV error4;
      |ERROR;
  |FINSI;
|ATRI I;
|PINTA 1927,#4#4;
|ATRI 0;
|ET cliente;
|LIBERA #4;
|CIERRA #4;
|FCAL;

|CALCULO lineasven;
reg = #1#1;
|FCAL;

|CALCULO pase;|TIPO 3;
fichero  = #0#0;
fichero  = "00000" + #0#0;
fichero  = fichero % -105;
anyoalfa = ("00" + anyoal) % -102;
fichero  = "v" + fichero + anyoalfa;
|NOME_DAT #1fichero;

swlin = 0;
|ABRE #7;
|ABRE #2;
|ABRE #4;
#7#0 = #3#0; #7#4 = anyoal;
|LEE 110#7=;
   |SI FSalida ! 0;
      |DDEFECTO #7;
      #7#0 = #3#0;
      #7#1 = #5#2;
      #7#2 = #5#1;
      #7#3 = 1;
      #7#4 = anyoal;
      |GRABA 020#7n;
      |LIBERA #7;
      #7#0 = #3#0;
      #7#1 = #5#2;
      #7#2 = #5#1;
      #7#3 = 1;
      #7#4 = anyoal;
      |LEE 110#7=;
      reg = 1;
   |SINO;
      |BUCLELIN 0lineasven#7;
      reg = reg + 1;
   |FINSI;
|ABRE #1;
|HAZ paselin;
|HAZ borraven;
|GRABA 020#7a;
|LIBERA #7;
|CIERRA #7;
|CIERRA #1;
|CIERRA #2;
|CIERRA #4;
|FCAL;

|CALCULO paselin;
indice = 0;
dianum1  = 0; dianum2  = 0; dianum3  = 0;
dianum4  = 0; dianum5  = 0; dianum6  = 0;
dianum7  = 0; dianum8  = 0; dianum9  = 0;
dianum10 = 0; dianum11 = 0; dianum12 = 0;
sw2 = 0;sw3 = 0;sw4 = 0;sw5 = 0;sw6 = 0;sw7 = 0;
sw1 = 0;sw8 = 0;sw9 = 0;sw10 = 0;sw11 = 0;sw12 = 0;

Icant = cant1<-;

|PARA x = 0;|SI x < 366;|HACIENDO x = x + 1;
   indice = indice + 1;

   |SI cant = 0;|Y indice [ 31;
       dianum1 = dianum1 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 31;|Y indice [ 60;
       dianum2 = dianum2 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 60;|Y indice [ 91;
       dianum3 = dianum3 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 91;|Y indice [ 121;
       dianum4 = dianum4 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 121;|Y indice [ 152;
       dianum5 = dianum5 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 152;|Y indice [ 182;
       dianum6 = dianum6 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 182;|Y indice [ 213;
       dianum7 = dianum7 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 213;|Y indice [ 244;
       dianum8 = dianum8 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 244;|Y indice [ 274;
       dianum9 = dianum9 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 274;|Y indice [ 305;
       dianum10 = dianum10 + 1;
       |VETE mas;
   |FINSI;

   |SI cant = 0;|Y indice > 305;|Y indice [ 335;
       dianum11 = dianum11 + 1;
       |VETE mas;
   |FINSI;

    |SI cant = 0;|Y indice > 335;
        dianum12 = dianum12 + 1;
        |VETE mas;
    |FINSI;

    |DDEFECTO #1;
    #1#0 = #3#0;
    #1#1 = reg;
    #1#2 = 1;
    #1#3 = #3#5;
    #1#14 = anyoal;

    |SI indice [ 31;
        |SI sw1 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Enero    ";
            |ATRI 0;
        |FINSI;
        mes = "01";
        dianum1 = dianum1 + 1;
        sw1 = 1;
        dia = dianum1;
    |FINSI;

    |SI indice > 31;|Y indice [ 60;
        |SI indice = 60;|Y swbis = 1;
            |VETE mas;
        |FINSI;
        |SI sw2 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Febrero ";
            |ATRI 0;
        |FINSI;
        mes = "02";
        dianum2 = dianum2 + 1;
        sw2 = 1;
        dia = dianum2;
    |FINSI;

    |SI indice > 60;|Y indice [ 91;
        |SI sw3 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Marzo    ";
            |ATRI 0;
        |FINSI;
        mes = "03";
        dianum3 = dianum3 + 1;
        sw3 = 1;
        dia = dianum3;
    |FINSI;

    |SI indice > 91;|Y indice [ 121;
        |SI sw4 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Abril    ";
            |ATRI 0;
        |FINSI;
        mes = "04";
        dianum4 = dianum4 + 1;
        sw4 = 1;
        dia = dianum4;
    |FINSI;

    |SI indice > 121;|Y indice [ 152;
        |SI sw5 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Mayo      ";
            |ATRI 0;
        |FINSI;
         mes = "05";
         dianum5 = dianum5 + 1;
         sw5 = 1;
         dia = dianum5;
    |FINSI;

    |SI indice > 152;|Y indice [ 182;
        |SI sw6 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Junio     ";
            |ATRI 0;
        |FINSI;
        mes = "06";
        dianum6 = dianum6 + 1;
        sw6 = 1;
        dia = dianum6;
    |FINSI;

    |SI indice > 182;|Y indice [ 213;
        |SI sw7 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Julio     ";
            |ATRI 0;
        |FINSI;
        mes = "07";
        dianum7 = dianum7 + 1;
        sw7 = 1;
        dia = dianum7;
    |FINSI;

    |SI indice > 213;|Y indice [ 244;
        |SI sw8 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Agosto    ";
            |ATRI 0;
        |FINSI;
        mes = "08";
        dianum8 = dianum8 + 1;
        sw8 = 1;
        dia = dianum8;
    |FINSI;

    |SI indice > 244;|Y indice [ 274;
        |SI sw9 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Septiembre ";
            |ATRI 0;
        |FINSI;
        mes = "09";
        dianum9 = dianum9 + 1;
        sw9 = 1;
        dia = dianum9;
    |FINSI;

    |SI indice > 274;|Y indice [ 305;
        |SI sw10 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Octubre    ";
            |ATRI 0;
        |FINSI;
        mes = "10";
        dianum10 = dianum10 + 1;
        sw10 = 1;
        dia = dianum10;
    |FINSI;

    |SI indice > 305;|Y indice [ 335;
        |SI sw11 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Noviembre  ";
            |ATRI 0;
        |FINSI;
        mes = "11";
        dianum11 = dianum11 + 1;
        sw11 = 1;
        dia = dianum11;
    |FINSI;

    |SI indice > 335;
        |SI sw12 = 0;
            |ATRI R;
            |PINTA 2350," Pasando el mes de Diciembre  ";
            |ATRI 0;
        |FINSI;
        mes = "12";
        dianum12 = dianum12 + 1;
        sw12 = 1;
        dia = dianum12;
    |FINSI;
    dia = "0" + dia;
    dia = dia % -102;

    #1#4  = dia + mes;
    #1#5  = #3#3;
    #1#72 = #3#9;
    #1#35 = NConcepto;
    #1#6  = #3#4;

    |SI #3#2 = "N";
        #1#7  = cant;
        #1#8  = #3#1;                  || Iva
        #1#9  = #1#7 % #1#8;
        #1#10 = #3#7;                  || Recargo
        #1#11 = #1#7 % #1#10;
        #1#39 = #3#8;                  || Retencion
        #1#42 = #1#7 % #1#39;
    |SINO;
        bruto = cant / (1 + ((#3#1 + #3#7 - #3#8) / 100));
        #1#7 = bruto ! EURODB;

        #1#8  = #3#1;                  || IVA
        #1#9  = #1#7 % #1#8;
        #1#10 = #3#7;                  || Recargo
        #1#11 = #1#7 % #1#10;
        #1#39 = #3#8;                  || Retencion
        #1#42 = #1#7 % #1#39;

        #1#7 = cant - (#1#9 + #1#11 - #1#42);
    |FINSI;

   nAnyo = anyoal;
    |SI nAnyo > 80;
        fecha = dia + "." + mes + "." + "19" + anyoal;
    |SINO;
        fecha = dia + "." + mes + "." + "20" + anyoal;
    |FINSI;

    #1#20 = "N";
    #1#22 = #1#7 + #1#9 + #1#11 - #1#42;

    |SI #3#5 = 0;
        #1#38 = "";
        #1#12 = "";
    |SINO;
        #1#38 = #4#4;
        #1#12 = #4#3;
    |FINSI;

    #1#13 = fecha;

    |HAZ periodo;

    #1#17 = period;
    #1#18 = "N";
    #1#19 = #3#6;
    |GRABA 020#1n;
    |LIBERA #1;

    |HAZ grabacli;
    reg = reg + 1;
  |ET mas;
    Icant = Icant + 1;
|SIGUE;
|FCAL;

|CALCULO borraven;
|ATRI 0;
|ABRE #0;
#0#0 = #3#0; #0#1 = 1; |BORRA 020#0c; |LIBERA #0;
#0#0 = #3#0; #0#1 = 2; |BORRA 020#0c; |LIBERA #0;
#0#0 = #3#0; #0#1 = 3; |BORRA 020#0c; |LIBERA #0;
#0#0 = #3#0; #0#1 = 4; |BORRA 020#0c; |LIBERA #0;
|CIERRA #0;
|FCAL;

|CALCULO grabacli;
#4#0 = #3#0;
#4#1 = #3#5;
#4#2 = 1;
|LEE 110#4=;
estado = FSalida;
|SI #3#1 ! 0;
   #4#17 = #4#17 + #1#7 + #1#9;
|SINO;
   #4#16 = #4#16 + #1#7;
|FINSI;
|SI estado ! 0;
   #4#0 = #3#0;
   #4#1 = #3#5;
   #4#2 = 1;
   #4#4 = contado;
   |GRABA 040#4n;
|SINO;
   |GRABA 040#4a;
|FINSI;
|LIBERA #4;
#7#5 = #7#5 + #1#7;
#7#6 = #7#6 + #1#9;
#7#7 = #7#7 + #1#11;
#7#9 = #7#9 + #1#42;
#7#8 = #7#5 + #7#6 + #7#7 - #7#9;
|FCAL;

|CALCULO periodo;
peri = #1#13 % 402;
|SI peri = "01"; |O peri = "02"; |O peri = "03";
    period = 1;
|FINSI;
|SI peri = "04"; |O peri = "05"; |O peri = "06";
    period = 2;
|FINSI;
|SI peri = "07"; |O peri = "08"; |O peri = "09";
    period = 3;
|FINSI;
|SI peri = "10"; |O peri = "11"; |O peri = "12";
    period = 4;
|FINSI;
|FCAL;

|CALCULO Activida; |TIPO 0;
#3#3 = 0;
#3#9 = "";
|PINTA 1641, "      ";

|ABRE #8;
#8#0 = #3#0;
#8#1 = #3#6;
#8#2 = anyoal;
|LEE 040#8=;
|SI FSalida ! 0;
    |MENAV "      No existe Actividad.";
    |ERROR;
|SINO;
    |SI #8#15 = "N";
        |MENAV "      La Actividad no esta preparada para hacer libros";
        |ERROR;
    |FINSI;
    |SI #8#14 = "S";
        |MENAV "      La Actividad es un Comunero";
        |ERROR;
    |FINSI;
|FINSI;
|CIERRA #8;

|SI #8#50 = 1;
    |C_V #3#3, 1, "S";  |C_M #3#3, 1, "S";
    |C_V #3#9, 1, "N";  |C_M #3#9, 1, "N";
|FINSI;

|SI #8#50 = 2;
    |C_V #3#3, 1, "N";  |C_M #3#3, 1, "N";
    |C_V #3#9, 1, "S";  |C_M #3#9, 1, "S";
|FINSI;
|FCAL;
