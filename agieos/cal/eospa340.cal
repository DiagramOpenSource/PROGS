|FICHEROS;
     eospa303 #0;
     eosclien #1;
     eosactiv #4;
     eosm1303 #25;        || man. 303
     eoslinve #7;         || repercutido
     eoslinco #5;         || soportado
     eosconce #8;         || conceptos IVA
     eosconc6 #28;        || conceptos IVA

     eosm0008;            || Conceptos 347
     eosm0011;            || Referencias catastrales
     eosm0012;            || Referencias catastrales

     eosclipr #709;
     eosclpre #106;

     dsmo3402 #342;
     dsmo3403 #343;

     dsmow204;
|FIN;

|VARIABLES;
    aAlfa       = "";
    aAlfa1      = "";
    aAlfa2      = "";
    aNombre     = "";
    aPais       = "";
    aCodNif     = "";
    aClaveOp    = "";
    aTipoConce  = "";
    aIntra      = "";
    aIGIC       = "";

    nBoton340   = -1;
     nIva       = -1;
     nIva1      = -1;
     nIva2      = -1;
     nIva3      = -1;
     nIva4      = -1;
     nIva5      = -1;
     nIva6      = -1;
     nBaseImpo  = 0;
     nBaseImpo1 = 0;
     nBaseImpo2 = 0;
     nBaseImpo3 = 0;
     nBaseImpo4 = 0;
     nBaseImpo5 = 0;
     nBaseImpo6 = 0;
     nCuotaIva  = 0;
     nCuotaIva1 = 0;
     nCuotaIva2 = 0;
     nCuotaIva3 = 0;
     nCuotaIva4 = 0;
     nCuotaIva5 = 0;
     nCuotaIva6 = 0;
     nRec       = 0;
     nRec1      = 0;
     nRec2      = 0;
     nRec3      = 0;
     nRec4      = 0;
     nRec5      = 0;
     nRec6      = 0;
     nCuotaRec  = 0;
     nCuotaRec1 = 0;
     nCuotaRec2 = 0;
     nCuotaRec3 = 0;
     nCuotaRec4 = 0;
     nCuotaRec5 = 0;
     nCuotaRec6 = 0;
     nConcep1   = 0;
     nConcep2   = 0;
     nConcep3   = 0;
     nConcep4   = 0;
     nConcep5   = 0;
     nConcep6   = 0;
     aConcep1   = "";
     aConcep2   = "";
     aConcep3   = "";
     aConcep4   = "";
     aConcep5   = "";
     aConcep6   = "";
     nReg       = 0;
     nChequeaNif= 0;
     nVarios    = 0;
     nNume      = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     nCampo4    = 0;
     nCampo5    = 0;
     nCampo6    = 0;
     nCampo7    = 0;
     nTipoConce = 0;
     nConcepto  = 0;
     nError     = 0;
     nBaffer    = 0;
     nTotalLinea= 0;
     nConta     = 0;
     nOpcion    = 0;
     nPosConce  = 0;

     aConcepto  = "";
     aTabla     = "";
     aDestino   = "";

     &eaAlfa       = "";
     &eaLibro      = "";
     &eaReg        = "";
     &eaLib340     = "";
     &eaReg340     = "";
     &eaError      = "";
     &eaVarDni     = "";
     &enActividad  = 0;
     &enEjer       = 0;
     &enPeriodo    = 0;
     &nPie         = 0;

     &enSwCaja  = 0;
     &enNCobro  = 0;
     &ef502c1   = @;
     &ea502c2   = "";
     &ea502c3   = "";
     &enCobrado1 = 0;
     &enCobrado2 = 0;
     &enCobrado3 = 0;
     &enCobrado4 = 0;
     &enCobrado5 = 0;
     &enCobrado6 = 0;
     nCobrado    = 0;
     nCobrado1   = 0;
     nCobrado2   = 0;
     nCobrado3   = 0;
     nCobrado4   = 0;
     nCobrado5   = 0;
     nCobrado6   = 0;
|FIN;

|PROCESO ErroresExp340;
     eaLibro = (("00000" + #7#1) % -105);
     eaReg   = #7#15 + "-" + (("000000" + #7#16) % -106);

     eaLib340 = "EXPEDIDAS";
     eaReg340 = (("000000" + nReg) % -106);

     |SI nChequeaNif = 1;
         eaVarDni  = #7#12;    |HAZ DNISinChequeo;
         aAlfa1    = #7#12;    |QBF aAlfa1;
         aAlfa2    = eaVarDni; |QBF aAlfa2;

         |SI aAlfa1 ! aAlfa2;  |O eaAlfa ! "";  |O aAlfa1 = "";
             eaError = eaAlfa;

             |SI aAlfa1 = "";
                 eaError = "El NIF/CIF Sin contenido";
                 |PRINT; nPie = 1;
             |SINO;
                 |SI aAlfa1 ! aAlfa2;
                     eaError = "El NIF/CIF puede ser erroneo";
                     |PRINT; nPie = 1;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         eaVarDni = "";
     |FINSI;

     |SI nBaseImpo = 0;
         eaError = "Sin contenido en Base Imponible";
         |PRINT; nPie = 1;
     |FINSI;

     aAlfa = aNombre;  |QBF aAlfa;
     |SI aAlfa = "";
         eaError = "Sin contenido en Apellidos y Nombre";
         |PRINT; nPie = 1;
     |SINO;
         aAlfa = eaVarDni % 101;
         |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
          |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
          |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
          |O aAlfa = "Z";
              aAlfa = aNombre;  |QBF aAlfa;
              aAlfa1 = aAlfa - " ";
              |SI aAlfa1 = aAlfa;
                  eaError =  "Formato del Apellidos y Nombre puede ser erroneo";
                  |PRINT; nPie = 1;
              |FINSI;
         |FINSI;
     |FINSI;

     |DBASE aTabla;  |QBF aTabla;
     aTabla = aTabla + "fich/";

     aTabla      = aTabla + "ztabla05.txt";
     nOpcion     = 1;
     nTotalLinea = 0;
     nConta      = -1;
     nBaffer     = 0;

     |LEESECUENCIAL aTabla, nBaffer, nTotalLinea, 0, 0;

     nError = 1;
     |PARA nConta = 0;  |SI nConta [ nTotalLinea;  |HACIENDO nConta = nConta + 1;
         |DEL_BUF nBaffer, nConta, aDestino;
         aAlfa = aDestino % 102;

         |QBF aAlfa;
         |QBF aPais;

         |SI aAlfa = aPais;  nError = 0;  |SAL;  |FINSI;
     |SIGUE;

     |SI nError = 1;
         eaError =  "Contenido incorrecto en el codigo del Pais: " + aPais;
         |PRINT; nPie = 1;
     |FINSI;

     |FINDIM nBaffer;
|FPRC;

|PROCESO GrabaTransmisiones;
     #dsmow204#0 = #7#12;
     #dsmow204#1 = enEjer;
     |LEE 101#dsmow204.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmow204;
         #dsmow204#0 = #7#12;
         #dsmow204#1 = enEjer;
         #dsmow204#4 = #7#38;
         |GRABA 020#dsmow204.b;
     |FINSI;

     #dsmow204#2 = #dsmow204#2 + (nBaseImpo + nCuotaIva + nCuotaRec);
     #dsmow204#3 = "S";
     #dsmow204#5 = #7#13;

     |GRABA 020#dsmow204.a;
     |LIBERA #dsmow204;
|FPRC;

|PROCESO FacturasExpedidas;
     #1#0 = #4#0;
     |LEE 040#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;

     |SI #4#50 = 1;
         #8#0 = nConcepto;
         |LEE 040#8=;
         |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

         |SI #8#16  = "*";  |ACABA;  |FINSI;

         |SI nConcepto ! 0
             |SI nConcepto = #eosm0008#146;  |O nConcepto = #eosm0008#147;
              |O nConcepto = #eosm0008#148;  |O nConcepto = #eosm0008#149;
                 |HAZ GrabaTransmisiones;
              |FINSI;
         |FINSI;

         aClaveOp   = #8#16;
         aTipoConce = #8#2;
         aIntra     = #8#6;
         nTipoConce = #8#8;
         aIGIC      = #8#17;
     |SINO;
         #28#0 = aConcepto;
         |LEE 040#28=;
         |SI FSalida ! 0; |DDEFECTO #28; |FINSI;

         |SI #28#22 = "*";  |ACABA;  |FINSI;

         |SI aConcepto ! "      "
             |SI aConcepto = #eosm0008#150;  |O aConcepto = #eosm0008#151;
              |O aConcepto = #eosm0008#152;  |O aConcepto = #eosm0008#153;
                 |HAZ GrabaTransmisiones;
              |FINSI;
         |FINSI;

         aClaveOp   = #28#22;
         aTipoConce = #28#2;
         aIntra     = #28#6;
         nTipoConce = #28#8;
         aIGIC      = #28#23;
     |FINSI;

     |SI aClaveOp = " ";   |Y #7#20 = "S";
         aClaveOp = "B";
     |FINSI;

     |SI enSwCaja = 1; |Y enNCobro = 0;
         aClaveOp = " ";
     |FINSI;

     |ABRE #342;
     |SELECT #1#342;
     #342#0  = #1#0;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = 0;
     #342#5  = enActividad;
     #342#6  = 999999;
     |LEE 000#342];
     |SI FSalida = 0;
         |LEE 000#342a;
     |SINO;
         |LEE 000#342u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #342#0  = #1#0;       |Y #342#1  = enEjer;
                       |Y #342#2  = enPeriodo;  |Y #342#3  = 340;
                       |Y #342#4  = 0;          |Y #342#5  = enActividad;
         nReg = #342#6 + 1;
     |FINSI;

     aCodNif  = #7#12;  |QBF aCodNif;

     aPais   = "";
     aNombre = "";

     |SI aCodNif ! "";
         |ABRE #709;
         #709#0 = aCodNif;
         |LEE 000#709=;
         |SI FSalida = 0;
             aPais   = #709#14;  |QBF aPais;
             aNombre = #709#1;   |QBF aNombre;
         |FINSI;
         |CIERRA #709;
     |FINSI;

     |SI aPais = "";  |O aNombre = "";
         |ABRE #106;
         #106#0 = #7#0;
         #106#1 = #7#3;
         #106#2 = 1;
         |LEE 000#106=;
         |SI FSalida = 0;
             |SI aPais   = "";   aPais   = #106#23;   |FINSI;
             |SI aNombre = "";   aNombre = #106#4;    |FINSI;
         |FINSI;
         |CIERRA #106;
     |FINSI;

     |QBF aNombre;

     aPais = aPais % 102;
     |QBF aPais;

     |SI aPais = "";  |O aPais = "E";
         aPais = "ES";
     |FINSI;

     |SI aNombre = "";  aNombre = #7#38;  |FINSI;

     |DDEFECTO #342;
     #342#0  = #1#0;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = 0;
     #342#5  = enActividad;
     #342#6  = nReg;
     #342#9  = aNombre;
     #342#10 = aPais;
     |SI #342#10 = "   ";
         #342#10 = "ES";
     |FINSI;

     #342#13 = aClaveOp;
     #342#14 = #7#13;
     #342#15 = #7#79;

     #342#16 = nIva;
     #342#17 = nBaseImpo;
     #342#18 = nCuotaIva;
     #342#27 = nRec;
     #342#28 = nCuotaRec;
     #342#19 = #342#17 + #342#18 + #342#28;
     #342#22 = #7#21;
     |SI #342#22 = 0;  #342#22 = 1;  |FINSI;

     |SI nVarios > 1;  |Y #342#13 = " ";
         #342#13 = "C";
         #342#23 = nVarios;
     |FINSI;

     aAlfa   = (("00000" + #7#1) % -105) + " / " + #7#15 + " " + (("000000" + #7#16) % -106);
     #342#21 = aAlfa;

     |SI #342#13 = " ";
         |SI aTipoConce = "S";  #342#13 = "I";  |FINSI;
     |FINSI;

     |SI #342#13 = "A";  |O #342#13 = "B";
         aAlfa   = #7#15 + " - " + (("000000" + #7#16) % -106);
         #342#24 = aAlfa;
         nNume   = (#7#16 + #7#21) - 1;
         aAlfa   = #7#15 + " - " + (("000000" + nNume) % -106);
         #342#25 = aAlfa;
     |FINSI;

     nChequeaNif = 1;

     |SI #342#10 ! "ES ";
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #7#12;

                            #342#11 = "6";
         |SI aAlfa = "DE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #342#11 = "2";  |FINSI;

         nChequeaNif = 0;
     |FINSI;

     |SI aIntra = "E";
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #7#12;
         #342#11 = "2";
         nChequeaNif = 0;
     |FINSI;

     |SI nTipoConce = 1;
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #7#12;
         #342#11 = "2";
         nChequeaNif = 0;
     |FINSI;

     |SI nTipoConce = 2;
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #342#12 = aAlfa + #7#12;
         #342#11 = "4";
         nChequeaNif = 0;
     |FINSI;


     aClaveOp = #342#13;
     aNombre  = #342#9;

     |SI aClaveOp = "A";  |O aClaveOp = "B";  |O aClaveOp = "J";
      |O aClaveOp = "P";
         nChequeaNif = 0;
     |FINSI;

     |SI aClaveOp = "D";
         #342#26 = #7#78;
     |FINSI;

     |SI aClaveOp = "R";
         |ABRE #eosm0012;
         #eosm0012#0 = #1#0;                    || Empresa
         #eosm0012#1 = #7#14;                   || A¤o
         #eosm0012#2 = nPosConce;               || Linea Base
         #eosm0012#3 = #7#1;                    || Linea
         |LEE 000#eosm0012.=;
         |SI FSalida ! 0;  |DDEFECTO #eosm0012;  |FINSI;
         |CIERRA #eosm0012;

         |ABRE #eosm0011;
         #eosm0011#0  = #1#0;                   || Empresa
         #eosm0011#1  = #eosm0012#4;            || Referencia Interna;
         |LEE 000#eosm0011.=;
         |SI FSalida ! 0;  |DDEFECTO #eosm0011;  |FINSI;
         |CIERRA #eosm0011;

         #342#30 = "1";
         #342#31 = #eosm0011#5;
     |FINSI;

     |HAZ ErroresExp340;

     #342#7  = eaVarDni;
     #342#29 = aIGIC;

     aAlfa = #342#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #342#11 = "4";
     |FINSI;

     |SI #342#13 = "S";  |O #342#13 = "T";  |O #342#13 = "W";  |O #342#13 = "U";
         #342#16 = 0;
         #342#17 = 0;
         #342#18 = 0;
         #342#27 = 0;
         #342#28 = 0;
     |FINSI;

     |SI enSwCaja = 1; |Y enNCobro ! 0;
         #342#35 = ef502c1;
         #342#36 = nCobrado;
         #342#37 = ea502c2;
         #342#38 = ea502c3;
     |FINSI;

     |GRABA 020#342n;
     |LIBERA #342;

     |CIERRA #342;
|FPRC;

|PROCESO AcumulaFac7;
     |SI #7nCampo1 = 0;  |ACABA;  |FINSI;

     |SI #7nCampo2 = nIva1;
         nBaseImpo1 = nBaseImpo1 + #7nCampo1;
         nIva1      = #7nCampo2;
         nCuotaIva1 = nCuotaIva1 + #7nCampo3;
         nRec1      = #7nCampo4;
         nCuotaRec1 = nCuotaRec1 + #7nCampo5;
         nConcep1   = #7nCampo6;
         aConcep1   = #7nCampo7;
         nCobrado1  = nCobrado1 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #7nCampo2 = nIva2;
         nBaseImpo2 = nBaseImpo2 + #7nCampo1;
         nIva2      = #7nCampo2;
         nCuotaIva2 = nCuotaIva2 + #7nCampo3;
         nRec2      = #7nCampo4;
         nCuotaRec2 = nCuotaRec2 + #7nCampo5;
         nConcep2   = #7nCampo6;
         aConcep2   = #7nCampo7;
         nCobrado2  = nCobrado2 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #7nCampo2 = nIva3;
         nBaseImpo3 = nBaseImpo3 + #7nCampo1;
         nIva3      = #7nCampo2;
         nCuotaIva3 = nCuotaIva3 + #7nCampo3;
         nRec3      = #7nCampo4;
         nCuotaRec3 = nCuotaRec3 + #7nCampo5;
         nConcep3   = #7nCampo6;
         aConcep3   = #7nCampo7;
         nCobrado3  = nCobrado3 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #7nCampo2 = nIva4;
         nBaseImpo4 = nBaseImpo4 + #7nCampo1;
         nIva4      = #7nCampo2;
         nCuotaIva4 = nCuotaIva4 + #7nCampo3;
         nRec4      = #7nCampo4;
         nCuotaRec4 = nCuotaRec4 + #7nCampo5;
         nConcep4   = #7nCampo6;
         aConcep4   = #7nCampo7;
         nCobrado4  = nCobrado4 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #7nCampo2 = nIva5;
         nBaseImpo5 = nBaseImpo5 + #7nCampo1;
         nIva5      = #7nCampo2;
         nCuotaIva5 = nCuotaIva5 + #7nCampo3;
         nRec5      = #7nCampo4;
         nCuotaRec5 = nCuotaRec5 + #7nCampo5;
         nConcep5   = #7nCampo6;
         aConcep5   = #7nCampo7;
         nCobrado5  = nCobrado5 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #7nCampo2 = nIva6;
         nBaseImpo6 = nBaseImpo6 + #7nCampo1;
         nIva6      = #7nCampo2;
         nCuotaIva6 = nCuotaIva6 + #7nCampo3;
         nRec6      = #7nCampo4;
         nCuotaRec6 = nCuotaRec6 + #7nCampo5;
         nConcep6   = #7nCampo6;
         aConcep6   = #7nCampo7;
         nCobrado6  = nCobrado6 + nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva1 = -1;
         nBaseImpo1 = #7nCampo1;
         nIva1      = #7nCampo2;
         nCuotaIva1 = #7nCampo3;
         nRec1      = #7nCampo4;
         nCuotaRec1 = #7nCampo5;
         nConcep1   = #7nCampo6;
         aConcep1   = #7nCampo7;
         nCobrado1  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva2 = -1;
         nBaseImpo2 = #7nCampo1;
         nIva2      = #7nCampo2;
         nCuotaIva2 = #7nCampo3;
         nRec2      = #7nCampo4;
         nCuotaRec2 = #7nCampo5;
         nConcep2   = #7nCampo6;
         aConcep2   = #7nCampo7;
         nCobrado2  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva3 = -1;
         nBaseImpo3 = #7nCampo1;
         nIva3      = #7nCampo2;
         nCuotaIva3 = #7nCampo3;
         nRec3      = #7nCampo4;
         nCuotaRec3 = #7nCampo5;
         nConcep3   = #7nCampo6;
         aConcep3   = #7nCampo7;
         nCobrado3  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva4 = -1;
         nBaseImpo4 = #7nCampo1;
         nIva4      = #7nCampo2;
         nCuotaIva4 = #7nCampo3;
         nRec4      = #7nCampo4;
         nCuotaRec4 = #7nCampo5;
         nConcep4   = #7nCampo6;
         aConcep4   = #7nCampo7;
         nCobrado4  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva5 = -1;
         nBaseImpo5 = #7nCampo1;
         nIva5      = #7nCampo2;
         nCuotaIva5 = #7nCampo3;
         nRec5      = #7nCampo4;
         nCuotaRec5 = #7nCampo5;
         nConcep5   = #7nCampo6;
         aConcep5   = #7nCampo7;
         nCobrado5  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva6 = -1;
         nBaseImpo6 = #7nCampo1;
         nIva6      = #7nCampo2;
         nCuotaIva6 = #7nCampo3;
         nRec6      = #7nCampo4;
         nCuotaRec6 = #7nCampo5;
         nConcep6   = #7nCampo6;
         aConcep6   = #7nCampo7;
         nCobrado6  = nCobrado;

         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Expedidas340;
     nIva1      = -1;
     nIva2      = -1;
     nIva3      = -1;
     nIva4      = -1;
     nIva5      = -1;
     nIva6      = -1;
     nBaseImpo1 = 0;
     nBaseImpo2 = 0;
     nBaseImpo3 = 0;
     nBaseImpo4 = 0;
     nBaseImpo5 = 0;
     nBaseImpo6 = 0;
     nCuotaIva1 = 0;
     nCuotaIva2 = 0;
     nCuotaIva3 = 0;
     nCuotaIva4 = 0;
     nCuotaIva5 = 0;
     nCuotaIva6 = 0;
     nRec1      = 0;
     nRec2      = 0;
     nRec3      = 0;
     nRec4      = 0;
     nRec5      = 0;
     nRec6      = 0;
     nCuotaRec1 = 0;
     nCuotaRec2 = 0;
     nCuotaRec3 = 0;
     nCuotaRec4 = 0;
     nCuotaRec5 = 0;
     nCuotaRec6 = 0;
     nConcep1   = 0;
     nConcep2   = 0;
     nConcep3   = 0;
     nConcep4   = 0;
     nConcep5   = 0;
     nConcep6   = 0;
     aConcep1   = "";
     aConcep2   = "";
     aConcep3   = "";
     aConcep4   = "";
     aConcep5   = "";
     aConcep6   = "";
     nCobrado1  = 0;
     nCobrado2  = 0;
     nCobrado3  = 0;
     nCobrado4  = 0;
     nCobrado5  = 0;
     nCobrado6  = 0;

     nCampo1 = 7;
     nCampo2 = 8;
     nCampo3 = 9;
     nCampo4 = 10;
     nCampo5 = 11;
     nCampo6 = 5;
     nCampo7 = 72;
     nCobrado = enCobrado1;
     |HAZ AcumulaFac7;

     nCampo1 = 23;
     nCampo2 = 25;
     nCampo3 = 27;
     nCampo4 = 29;
     nCampo5 = 31;
     nCampo6 = 33;
     nCampo7 = 73;
     nCobrado = enCobrado2;
     |HAZ AcumulaFac7;

     nCampo1 = 24;
     nCampo2 = 26;
     nCampo3 = 28;
     nCampo4 = 30;
     nCampo5 = 32;
     nCampo6 = 34;
     nCampo7 = 74;
     nCobrado = enCobrado3;
     |HAZ AcumulaFac7;

     nCampo1 = 45;
     nCampo2 = 48;
     nCampo3 = 51;
     nCampo4 = 54;
     nCampo5 = 57;
     nCampo6 = 60;
     nCampo7 = 75;
     nCobrado = enCobrado4;
     |HAZ AcumulaFac7;

     nCampo1 = 46;
     nCampo2 = 49;
     nCampo3 = 52;
     nCampo4 = 55;
     nCampo5 = 58;
     nCampo6 = 61;
     nCampo7 = 76;
     nCobrado = enCobrado5;
     |HAZ AcumulaFac7;

     nCampo1 = 47;
     nCampo2 = 50;
     nCampo3 = 53;
     nCampo4 = 56;
     nCampo5 = 59;
     nCampo6 = 62;
     nCampo7 = 77;
     nCobrado = enCobrado6;
     |HAZ AcumulaFac7;

     |SI #7#20 = "S";
         |SI nIva2 ! -1;
             eaLibro = (("00000" + #7#1) % -105);
             eaReg   = #7#15 + "-" + (("000000" + #7#16) % -106);

             eaLib340 = "EXPEDIDAS";

             eaReg340 = "------";
             eaError  = "Factura resumen con varios tipos de iva. No se pasa el registro al 340";

             |PRINT; nPie = 1;
             |ACABA;
          |FINSI;
     |FINSI;

     nVarios = 0;
     |SI nIva1 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva2 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva3 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva4 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva5 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva6 ! -1;  nVarios = nVarios + 1;  |FINSI;

     |SI nIva1 ! -1;
         nBaseImpo = nBaseImpo1;
         nIva      = nIva1;
         nCuotaIva = nCuotaIva1;
         nRec      = nRec1;
         nCuotaRec = nCuotaRec1;
         nConcepto = nConcep1;
         aConcepto = aConcep1;
         nPosConce = 1;
         nCobrado  = nCobrado1;
         |HAZ FacturasExpedidas;
     |FINSI;

     |SI nIva2 ! -1;
         nBaseImpo = nBaseImpo2;
         nIva      = nIva2;
         nCuotaIva = nCuotaIva2;
         nRec      = nRec2;
         nCuotaRec = nCuotaRec2;
         nConcepto = nConcep2;
         aConcepto = aConcep2;
         nPosConce = 2;
         nCobrado  = nCobrado2;
         |HAZ FacturasExpedidas;
     |FINSI;

     |SI nIva3 ! -1;
         nBaseImpo = nBaseImpo3;
         nIva      = nIva3;
         nCuotaIva = nCuotaIva3;
         nRec      = nRec3;
         nCuotaRec = nCuotaRec3;
         nConcepto = nConcep3;
         aConcepto = aConcep3;
         nPosConce = 3;
         nCobrado  = nCobrado3;
         |HAZ FacturasExpedidas;
     |FINSI;

     |SI nIva4 ! -1;
         nBaseImpo = nBaseImpo4;
         nIva      = nIva4;
         nCuotaIva = nCuotaIva4;
         nRec      = nRec4;
         nCuotaRec = nCuotaRec4;
         nConcepto = nConcep4;
         aConcepto = aConcep4;
         nPosConce = 4;
         nCobrado  = nCobrado4;
         |HAZ FacturasExpedidas;
     |FINSI;

     |SI nIva5 ! -1;
         nBaseImpo = nBaseImpo5;
         nIva      = nIva5;
         nCuotaIva = nCuotaIva5;
         nRec      = nRec5;
         nCuotaRec = nCuotaRec5;
         nConcepto = nConcep5;
         aConcepto = aConcep5;
         nPosConce = 5;
         nCobrado  = nCobrado5;
         |HAZ FacturasExpedidas;
     |FINSI;

     |SI nIva6 ! -1;
         nBaseImpo = nBaseImpo6;
         nIva      = nIva6;
         nCuotaIva = nCuotaIva6;
         nRec      = nRec6;
         nCuotaRec = nCuotaRec6;
         nConcepto = nConcep6;
         aConcepto = aConcep6;
         nPosConce = 6;
         nCobrado  = nCobrado6;
         |HAZ FacturasExpedidas;
     |FINSI;
|FPRC;

|PROCESO ErroresRec340;
     eaLibro = (("00000" + #5#1) % -105);
     eaReg   = #5#15 + "-" + (("000000" + #5#16) % -106);

     eaLib340 = "RECIBIDAS";
     eaReg340 = (("000000" + nReg) % -106);

     |SI nChequeaNif = 1;
         eaVarDni  = #5#12;    |HAZ DNISinChequeo;
         aAlfa1    = #5#12;    |QBF aAlfa1;
         aAlfa2    = eaVarDni; |QBF aAlfa2;

         |SI aAlfa1 ! aAlfa2;  |O eaAlfa ! "";  |O aAlfa1 = "";
             eaError = eaAlfa;

             |SI aAlfa1 = "";
                 eaError = "El NIF/CIF Sin contenido";
                 |PRINT; nPie = 1;
             |SINO;
                 |SI aAlfa1 ! aAlfa2;
                     eaError = "El NIF/CIF puede ser erroneo";
                     |PRINT; nPie = 1;
                 |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         eaVarDni = "";
     |FINSI;

     |SI nBaseImpo = 0;
         eaError = "Sin contenido en Base Imponible";
         |PRINT; nPie = 1;
     |FINSI;

     aAlfa = aNombre;  |QBF aAlfa;
     |SI aAlfa = "";
         eaError = "Sin contenido en Apellidos y Nombre";
         |PRINT; nPie = 1;
     |SINO;
         aAlfa = eaVarDni % 101;
         |SI aAlfa = "0"; |O aAlfa = "1"; |O aAlfa = "2"; |O aAlfa = "3";
          |O aAlfa = "4"; |O aAlfa = "5"; |O aAlfa = "6"; |O aAlfa = "7";
          |O aAlfa = "8"; |O aAlfa = "9"; |O aAlfa = "X"; |O aAlfa = "Y";
          |O aAlfa = "Z";
              aAlfa = aNombre;  |QBF aAlfa;
              aAlfa1 = aAlfa - " ";
              |SI aAlfa1 = aAlfa;
                  eaError =  "Formato del Apellidos y Nombre puede ser erroneo";
                  |PRINT; nPie = 1;
              |FINSI;
         |FINSI;
     |FINSI;

     |DBASE aTabla;  |QBF aTabla;
     aTabla = aTabla + "fich/";

     aTabla      = aTabla + "ztabla05.txt";
     nOpcion     = 1;
     nTotalLinea = 0;
     nConta      = -1;
     nBaffer     = 0;

     |LEESECUENCIAL aTabla, nBaffer, nTotalLinea, 0, 0;

     nError = 1;
     |PARA nConta = 0;  |SI nConta [ nTotalLinea;  |HACIENDO nConta = nConta + 1;
         |DEL_BUF nBaffer, nConta, aDestino;
         aAlfa = aDestino % 102;

         |QBF aAlfa;
         |QBF aPais;

         |SI aAlfa = aPais;  nError = 0;  |SAL;  |FINSI;
     |SIGUE;

     |SI nError = 1;
         eaError =  "Contenido incorrecto en el codigo del Pais: " + aPais;
         |PRINT; nPie = 1;
     |FINSI;

     |FINDIM nBaffer;
|FPRC;

|PROCESO FacturasRecibidas;
     #1#0 = #4#0;
     |LEE 040#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;

     |SI #4#50 = 1;
         #8#0 = nConcepto;
         |LEE 040#8=;
         |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

         |SI #8#16  = "*";  |ACABA;  |FINSI;

         aClaveOp   = #8#16;
         aTipoConce = #8#2;
         aIntra     = #8#6;
         nTipoConce = #8#8;
         aIGIC      = #8#17;
     |SINO;
         #28#0 = aConcepto;
         |LEE 040#28=;
         |SI FSalida ! 0; |DDEFECTO #28; |FINSI;

         |SI #28#22 = "*";  |ACABA;  |FINSI;

         aClaveOp   = #28#22;
         aTipoConce = #28#2;
         aIntra     = #28#6;
         nTipoConce = #28#8;
         aIGIC      = #28#23;
     |FINSI;

     |SI aClaveOp = " ";   |Y #7#20 = "S";
         aClaveOp = "B";
     |FINSI;

     |SI enSwCaja = 1; |Y enNCobro = 0;
         aClaveOp = " ";
     |FINSI;

     |ABRE #343;
     |SELECT #1#343;
     #343#0  = #1#0;
     #343#1  = enEjer;
     #343#2  = enPeriodo;
     #343#3  = 340;
     #343#4  = 0;
     #343#5  = enActividad;
     #343#6  = 999999;
     |LEE 000#343];
     |SI FSalida = 0;
         |LEE 000#343a;
     |SINO;
         |LEE 000#343u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #343#0  = #1#0;       |Y #343#1  = enEjer;
                       |Y #343#2  = enPeriodo;  |Y #343#3  = 340;
                       |Y #343#4  = 0;          |Y #343#5  = enActividad;
         nReg = #343#6 + 1;
     |FINSI;

     aCodNif  = #5#12;  |QBF aCodNif;

     aPais   = "";
     aNombre = "";

     |SI aCodNif ! "";
         |ABRE #709;
         #709#0 = aCodNif;
         |LEE 000#709=;
         |SI FSalida = 0;
             aPais   = #709#14;  |QBF aPais;
             aNombre = #709#1;   |QBF aNombre;
         |FINSI;
         |CIERRA #709;
     |FINSI;

     |SI aPais = "";  |O aNombre = "";
         |ABRE #106;
         #106#0 = #5#0;
         #106#1 = #5#3;
         #106#2 = 2;
         |LEE 000#106=;
         |SI FSalida = 0;
             |SI aPais   = "";   aPais   = #106#23;   |FINSI;
             |SI aNombre = "";   aNombre = #106#4;    |FINSI;
         |FINSI;
         |CIERRA #106;
     |FINSI;

     |QBF aNombre;

     aPais = aPais % 102;
     |QBF aPais;

     |SI aPais = "";  |O aPais = "E";
         aPais = "ES";
     |FINSI;

     |SI aNombre = "";  aNombre = #5#38;  |FINSI;

     |DDEFECTO #343;
     #343#0  = #1#0;
     #343#1  = enEjer;
     #343#2  = enPeriodo;
     #343#3  = 340;
     #343#4  = 0;
     #343#5  = enActividad;
     #343#6  = nReg;
     #343#9 = aNombre;
     #343#10 = aPais;
     |SI #343#10 = "   ";
         #343#10 = "ES";
     |FINSI;

     #343#13 = aClaveOp;
     #343#14 = #5#13;
     #343#15 = #5#79;

     #343#16 = nIva;
     #343#17 = nBaseImpo;
     #343#18 = nCuotaIva;
     #343#19 = #343#17 + #343#18;
     #343#26 = nCuotaIva;

     #343#22 = 1;

     |SI nVarios > 1;  |Y #343#13 = " ";
         #343#13 = "C";
         #343#23 = nVarios;
     |FINSI;

     aAlfa   = (("00000" + #5#1) % -105) + " / " + #5#15 + " " + (("000000" + #5#16) % -106);
     #343#21 = aAlfa;

     |SI nTipoConce = 6;  |O nTipoConce = 8;
         #343#13 = "P";
     |FINSI;

     |SI #343#13 = "A";  |O #343#13 = "B";
         aAlfa   = #5#15 + " - " + (("000000" + #5#16) % -106);
         #343#24 = aAlfa;
         nNume   = (#5#16 + #5#21) - 1;
         aAlfa   = #5#15 + " - " + (("000000" + nNume) % -106);
         #343#25 = aAlfa;
     |FINSI;

     nChequeaNif = 1;

     |SI #343#10 ! "ES ";
         aAlfa   = #343#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #343#12 = aAlfa + #5#12;

                            #343#11 = "6";
         |SI aAlfa = "DE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #343#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #343#11 = "2";  |FINSI;

         nChequeaNif = 0;
     |FINSI;

     |SI #343#13 = "P";
         aAlfa   = #343#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         #343#12 = aAlfa + #5#12;
         #343#11 = "2";
         nChequeaNif = 0;
     |FINSI;

     |SI #343#13 = " ";
         |SI nTipoConce = 2;
             aAlfa   = #343#10;  |QBF aAlfa;
             |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

             #343#12 = aAlfa + #5#12;
             #343#11 = "4";
             nChequeaNif = 0;
         |FINSI;
     |FINSI;

     aClaveOp = #343#13;
     aNombre  = #343#9;

     |SI aClaveOp = "A";  |O aClaveOp = "B";  |O aClaveOp = "J";
      |O aClaveOp = "P";
         nChequeaNif = 0;
     |FINSI;

     |HAZ ErroresRec340;

     #343#7  = eaVarDni;
     #343#27 = aIGIC;

     aAlfa = #343#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #343#11 = "4";
     |FINSI;

     |SI #343#13 = "S";  |O #343#13 = "W";
         #343#16 = 0;
         #343#17 = 0;
         #343#18 = 0;
         #343#26 = 0;
     |FINSI;

     |SI #343#13 = "X";
         ||  #343#17 = #343#19;
         #343#16 = 0;
     |FINSI;

     |SI enSwCaja = 1; |Y enNCobro ! 0;
         #343#28 = ef502c1;
         #343#29 = nCobrado;
         #343#30 = ea502c2;
         #343#31 = ea502c3;
     |FINSI;

     |GRABA 020#343n;
     |LIBERA #343;

     |CIERRA #343;
|FPRC;

|PROCESO AcumulaFac5;
     |SI #5nCampo1 = 0;  |ACABA;  |FINSI;

     |SI #5nCampo2 = nIva1;
         nBaseImpo1 = nBaseImpo1 + #5nCampo1;
         nIva1      = #5nCampo2;
         nCuotaIva1 = nCuotaIva1 + #5nCampo3;
         nConcep1   = #5nCampo4;
         aConcep1   = #5nCampo5;
         nCobrado1  = nCobrado1 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #5nCampo2 = nIva2;
         nBaseImpo2 = nBaseImpo2 + #5nCampo1;
         nIva2      = #5nCampo2;
         nCuotaIva2 = nCuotaIva2 + #5nCampo3;
         nConcep2   = #5nCampo4;
         aConcep2   = #5nCampo5;
         nCobrado2  = nCobrado2 + nCobrado;

         |ACABA;
     |FINSI;

     |SI #5nCampo2 = nIva3;
         nBaseImpo3 = nBaseImpo3 + #5nCampo1;
         nIva3      = #5nCampo2;
         nCuotaIva3 = nCuotaIva3 + #5nCampo3;
         nConcep3   = #5nCampo4;
         aConcep3   = #5nCampo5;
         nCobrado3  = nCobrado3 + nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva1 = -1;
         nBaseImpo1 = #5nCampo1;
         nIva1      = #5nCampo2;
         nCuotaIva1 = #5nCampo3;
         nConcep1   = #5nCampo4;
         aConcep1   = #5nCampo5;
         nCobrado1  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva2 = -1;
         nBaseImpo2 = #5nCampo1;
         nIva2      = #5nCampo2;
         nCuotaIva2 = #5nCampo3;
         nConcep2   = #5nCampo4;
         aConcep2   = #5nCampo5;
         nCobrado2  = nCobrado;

         |ACABA;
     |FINSI;

     |SI nIva3 = -1;
         nBaseImpo3 = #5nCampo1;
         nIva3      = #5nCampo2;
         nCuotaIva3 = #5nCampo3;
         nConcep3   = #5nCampo4;
         aConcep3   = #5nCampo5;
         nCobrado3  = nCobrado;

         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Recibidas340;
     nIva1      = -1;
     nIva2      = -1;
     nIva3      = -1;
     nBaseImpo1 = 0;
     nBaseImpo2 = 0;
     nBaseImpo3 = 0;
     nCuotaIva1 = 0;
     nCuotaIva2 = 0;
     nCuotaIva3 = 0;
     nConcep1   = 0;
     nConcep2   = 0;
     nConcep3   = 0;
     aConcep1   = "";
     aConcep2   = "";
     aConcep3   = "";
     nCobrado1  = 0;
     nCobrado2  = 0;
     nCobrado3  = 0;

     nCampo1 = 7;
     nCampo2 = 8;
     nCampo3 = 9;
     nCampo4 = 5;
     nCampo5 = 72;
     nCobrado = enCobrado1;
     |HAZ AcumulaFac5;

     nCampo1 = 23;
     nCampo2 = 25;
     nCampo3 = 27;
     nCampo4 = 33;
     nCampo5 = 73;
     nCobrado = enCobrado2;
     |HAZ AcumulaFac5;

     nCampo1 = 24;
     nCampo2 = 26;
     nCampo3 = 28;
     nCampo4 = 34;
     nCampo5 = 74;
     nCobrado = enCobrado3;
     |HAZ AcumulaFac5;

     |SI #5#20 = "S";
         |SI nIva2 ! -1;
             eaLibro = (("00000" + #5#1) % -105);
             eaReg   = #5#15 + "-" + (("000000" + #5#16) % -106);

             eaLib340 = "RECIBIDAS";

             eaReg340 = "------";
             eaError  = "Factura resumen con varios tipos de iva. No se pasa el registro al 340";

             |PRINT; nPie = 1;
             |ACABA;
          |FINSI;
     |FINSI;

     nVarios = 0;
     |SI nIva1 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva2 ! -1;  nVarios = nVarios + 1;  |FINSI;
     |SI nIva3 ! -1;  nVarios = nVarios + 1;  |FINSI;

     |SI nIva1 ! -1;
         nBaseImpo = nBaseImpo1;
         nIva      = nIva1;
         nCuotaIva = nCuotaIva1;
         nRec      = nRec1;
         nCuotaRec = nCuotaRec1;
         nConcepto = nConcep1;
         aConcepto = aConcep1;
         nCobrado  = nCobrado1;
         |HAZ FacturasRecibidas;
     |FINSI;

     |SI nIva2 ! -1;
         nBaseImpo = nBaseImpo2;
         nIva      = nIva2;
         nCuotaIva = nCuotaIva2;
         nRec      = nRec2;
         nCuotaRec = nCuotaRec2;
         nConcepto = nConcep2;
         aConcepto = aConcep2;
         nCobrado  = nCobrado2;
         |HAZ FacturasRecibidas;
     |FINSI;

     |SI nIva3 ! -1;
         nBaseImpo = nBaseImpo3;
         nIva      = nIva3;
         nCuotaIva = nCuotaIva3;
         nRec      = nRec3;
         nCuotaRec = nCuotaRec3;
         nConcepto = nConcep3;
         aConcepto = aConcep3;
         nCobrado  = nCobrado3;
         |HAZ FacturasRecibidas;
     |FINSI;
|FPRC;


|PROCESO dsmow204Trans;   || Trnasmisiones inmuebles
     |SI #dsmow204#3 = "N";   |ACABA;  |FINSI;

     |ABRE #342;
     |SELECT #1#342;
     #342#0  = #1#0;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = 0;
     #342#5  = enActividad;
     #342#6  = 999999;
     |LEE 000#342];
     |SI FSalida = 0;
         |LEE 000#342a;
     |SINO;
         |LEE 000#342u;
     |FINSI;

     nReg = 1;
     |SI FSalida = 0;  |Y #342#0  = #1#0;       |Y #342#1  = enEjer;
                       |Y #342#2  = enPeriodo;  |Y #342#3  = 340;
                       |Y #342#4  = 0;          |Y #342#5  = enActividad;
         nReg = #342#6 + 1;
     |FINSI;

     aCodNif = #dsmow204#0;
     aPais   = "";
     aNombre = "";

     |SI aCodNif ! "";
         |ABRE #709;
         #709#0 = aCodNif;
         |LEE 000#709=;
         |SI FSalida = 0;
             aPais   = #709#14;  |QBF aPais;
             aNombre = #709#1;   |QBF aNombre;
         |FINSI;
         |CIERRA #709;
     |FINSI;

     |SI aPais = "";  |O aNombre = "";
         |ABRE #106;
         #106#0 = #1#0;
         #106#1 = #dsmow204#0;
         #106#2 = 1;
         |LEE 000#106=;
         |SI FSalida = 0;
             |SI aPais   = "";   aPais   = #106#23;   |FINSI;
             |SI aNombre = "";   aNombre = #106#4;    |FINSI;
         |FINSI;
         |CIERRA #106;
     |FINSI;

     |QBF aNombre;

     aPais = aPais % 102;
     |QBF aPais;

     |SI aPais = "";  |O aPais = "E";
         aPais = "ES";
     |FINSI;

     |SI aNombre = "";  aNombre = #dsmow204#4;  |FINSI;

     |DDEFECTO #342;
     #342#0  = #1#0;
     #342#1  = enEjer;
     #342#2  = enPeriodo;
     #342#3  = 340;
     #342#4  = 0;
     #342#5  = enActividad;
     #342#6  = nReg;
     #342#9  = aNombre;
     #342#10 = aPais;
     |SI #342#10 = "   ";
         #342#10 = "ES";
     |FINSI;

     #342#13 = "";
     #342#14 = #dsmow204#5;
     #342#15 = "01.01.0000";

     nChequeaNif = 1;

     |SI #342#10 ! "ES ";
         aAlfa   = #342#10;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                            #342#11 = "6";
         |SI aAlfa = "DE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "AT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "BG";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CY";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "DK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FI";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "FR";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "EL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "GB";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "NL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "IE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LV";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "LU";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "MT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PL";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "PT";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "CZ";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SK";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "RO";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "SE";  #342#11 = "2";  |FINSI;
         |SI aAlfa = "HR";  #342#11 = "2";  |FINSI;

         #342#12 = aAlfa + #dsmow204#0;
         nChequeaNif = 0;
     |FINSI;

     aClaveOp = #342#13;
     aNombre  = #342#9;

     #342#34  = #dsmow204#2;

     |HAZ ErroresExp340;

     #342#7  = eaVarDni;

     aAlfa = #342#7 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         #342#11 = "4";
     |FINSI;

     |GRABA 020#342n;
     |LIBERA #342;

     |CIERRA #342;
|FPRC;

|DEFBUCLE dsmow204Trans;
     #dsmow204#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsmow204Trans;
|FIN;

|PROCESO Transmisiones;
     |BUCLE dsmow204Trans;
|FPRC;
