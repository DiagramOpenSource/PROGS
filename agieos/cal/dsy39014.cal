|FICHEROS;
     dsmoy000;
     dsmom004;
     dsmom999 #199;

     dsm39001 #390;
     dsm39002 #490;
     dsm39003 #590;
     dsm39004 #690;
     dsm39005 #790;

     eosclien #2;             || Clientes
     eoshacie #3;             || Hacienda
     eosdaban #4;             || Datos Bancarios
     eoscomul #5;             || Lineas Comuneros

     dsmow014 #999;

     dsmow547 #547;
     dsmow549 #549;
     dsmow556 #556;
|FIN;

|VARIABLES;
     aLetrasCif      = "ABCDEFGHNPQSKLMJUVWR";
     aImpre          = "";
     aIPRemoto       = "";
     nNueEjer        = 0;

     nGrupo          = 0;
     nSubGrupo       = 0;
     nCampo1         = 0;
     nCampo2         = 0;
     nCampo3         = 0;
     nCampo4         = 0;
     nCampo5         = 0;
     nCampo6         = 0;
     nSwHay          = 0;
     nModulos        = 0;
     nLineaC         = 0;
     nTopeD          = 0;
     nTopeH          = 0;
     nComple         = 0;
     nComplementaria = 0;
     nAnyoDos        = 0;

     aNifp           = "";
     aNombrep        = "";
     aCallep         = "";
     aNump           = "";
     aEscp           = "";
     aPisop          = "";
     aPuep           = "";
     aPoblap         = "";
     aProvip         = "";
     aCodp           = "";
     aSgp            = "";
     aTlfnop         = "";
     aVacio_20       = "                    ";
     aVacio_16       = "                ";
     aVacio_12       = "            ";
     aVacio_10       = "          ";

     &enComunero     = 0;
     &enEjer         = 0;
     &enComplem      = 0;
     &enTipoEntrada  = 0;
     &nSwMod         = 0;
|FIN;

|INCLUYE i_varemi;

|PROCESO LeeCasilla;
     #490#0  = #390#0;
     #490#1  = #390#1;
     #490#2  = #390#2;
     #490#3  = #390#3;
     #490#4  = nGrupo;
     #490#5  = nSubGrupo;
     |SELECT #1#490;
     |LEE 040#490=;
     |SI FSalida ! 0;  |DDEFECTO #490;  |FINSI;
|FPRC;

|PROCESO CargaDatos;
     #2#0 = #dsm39001#0;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     aNifp           = "";
     aNombrep        = "";
     aCallep         = "";
     aNump           = "";
     aEscp           = "";
     aPisop          = "";
     aPuep           = "";
     aPoblap         = "";
     aProvip         = "";
     aCodp           = "";
     aSgp            = "";
     aTlfnop         = "";
     aVacio_20       = "                    ";
     aVacio_16       = "                ";
     aVacio_12       = "            ";
     aVacio_10       = "          ";
     enComuneros     = 0;

     |SELECT #3#5;
     #5#0 = #2#0;
     #5#7 = nAnyoDos;
     #5#1 = 1;
     #5#2 = 1;
     |LEE 040#5];
     |SI FSalida = 0;  |Y #5#0 = #2#0;  |Y #5#7 = nAnyoDos;
         #2#0 = #5#3;
         |LEE 040#2=;
         |SI FSalida = 0;
             enComuneros = 1;
             aNifp        = #2#1;
             aNombrep     = #2#2;
             aCallep      = #2#5;
             aNump        = #2#6;
             aEscp        = #2#7;
             aPisop       = #2#8;
             aPuep        = #2#9;
             aPoblap      = #2#13;
             aProvip      = #2#12;
             aCodp        = #2#21;
         |FINSI;
     |FINSI;

     #2#0 = #dsm39001#0;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     |SI enComuneros = 0;
         aNifp    = #2#1;
         aNombrep = #2#2;
         aCallep  = #2#5;
         aNump    = #2#6;
         aEscp    = #2#7;
         aPisop   = #2#8;
         aPuep    = #2#9;
         aPoblap  = #2#13;
         aProvip  = #2#12;
         aCodp    = #2#21;
         aSgp     = #2#4;
         aTlfnop  = #2#14;

         |SI #2#24 ! aVacio_20; |O #2#25 ! aVacio_20;
          |O #2#26 ! aVacio_12; |O #2#27 ! aVacio_10; |O #2#28 ! aVacio_16;
             aNifp    = "";
             aNombrep = "";
             aCallep  = "";
             aNump    = "";
             aEscp    = "";
             aPisop   = "";
             aPuep    = "";
             aPoblap  = "";
             aProvip  = "";
             aCodp    = "";
             aSgp     = "";
             aTlfnop  = "";
         |FINSI;

         |SI #2#29 ! aVacio_20; |O #2#30 ! aVacio_20;
          |O #2#31 ! aVacio_12; |O #2#32 ! aVacio_10; |O #2#33 ! aVacio_16;
             aNifp    = "";
             aNombrep = "";
             aCallep  = "";
             aNump    = "";
             aEscp    = "";
             aPisop   = "";
             aPuep    = "";
             aPoblap  = "";
             aProvip  = "";
             aCodp    = "";
             aSgp     = "";
             aTlfnop  = "";
         |FINSI;

         |SI #2#34 ! aVacio_20; |O #2#35 ! aVacio_20;
          |O #2#36 ! aVacio_12; |O #2#37 ! aVacio_10; |O #2#38 ! aVacio_16;
             aNifp    = "";
             aNombrep = "";
             aCallep  = "";
             aNump    = "";
             aEscp    = "";
             aPisop   = "";
             aPuep    = "";
             aPoblap  = "";
             aProvip  = "";
             aCodp    = "";
             aSgp     = "";
             aTlfnop  = "";
        |FINSI;
     |FINSI;

     #3#0 = #2#18;
     #3#1 = #2#19;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #4#0 = #2#0;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
|FPRC;

|PROCESO Regis547;
     |DDEFECTO #547;

     aAlfa   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     |SI aAlfa = "00000"; aAlfa = "     "; |FINSI;
     #547#6  = aAlfa;

     eaVarDni = #2#1;  |HAZ CalculoDNI;    #547#7 = eaVarDni;

     eaAlfa  = #2#2 % 130;  |HAZ QuitaRaros;
     #547#8  = eaAlfa;

     aCaracter  = #2#1 % 101;
     aAlfa      = aLetrasCif - aCaracter;
     |SI aAlfa  = aLetrasCif;
         aAlfa  = ".              ";
     |SINO;
         aAlfa  = "               ";
     |FINSI;
     #547#9  = aAlfa;

     #547#10 = #2#14 % 109;

     #547#11 = #2#4 % 102;

     eaAlfa  = #2#5 % 117;  |HAZ QuitaRaros;
     #547#12 = eaAlfa;

     #547#13  = #2#6 % 104;
     eaEscal  = #2#7 % 102;  |QBF eaEscal;
     eaPiso   = #2#8;        |QBF eaPiso;
     eaPuerta = #2#9;        |QBF eaPuerta;

     eaAlfa  = #2#13 % 120;  |HAZ QuitaRaros;
     #547#14 = eaAlfa;

     eaAlfa  = #2#12;  |HAZ QuitaRaros;
     #547#15 = eaAlfa;

     aAlfa   = (("00" + #2#10) % -102) + (("000" + #2#11) % -103);
     |SI aAlfa = "00000"; aAlfa = "     "; |FINSI;
     #547#16 = aAlfa;

     #547#17 = "0";
     |SI #390#88 = "X";  #547#17  = "1";  |FINSI;

     #547#74 = "0";
     |SI #390#98 = "S";  #547#74  = "1";  |FINSI;

     #547#18  = #390#1;
     #547#19  = #390#13;

     |SI #390#64 = "9999";  #390#64 = "";  |FINSI;
     |SI #390#68 = "9999";  #390#68 = "";  |FINSI;
     |SI #390#72 = "9999";  #390#72 = "";  |FINSI;
     |SI #390#76 = "9999";  #390#76 = "";  |FINSI;
     |SI #390#80 = "9999";  #390#80 = "";  |FINSI;
     |SI #390#84 = "9999";  #390#84 = "";  |FINSI;

     eaAlfa   = #390#65;  |HAZ QuitaRaros;      #547#20 = eaAlfa;
     #547#21  = #390#66;
     #547#22  = #390#64;
     eaAlfa   = #390#69;  |HAZ QuitaRaros;      #547#23 = eaAlfa;
     #547#24  = #390#70;
     #547#25  = #390#68;
     eaAlfa   = #390#73;  |HAZ QuitaRaros;      #547#26 = eaAlfa;
     #547#27  = #390#74;
     #547#28  = #390#72;
     eaAlfa   = #390#77;  |HAZ QuitaRaros;      #547#29 = eaAlfa;
     #547#30  = #390#78;
     #547#31  = #390#76;
     eaAlfa   = #390#81;  |HAZ QuitaRaros;      #547#32 = eaAlfa;
     #547#33  = #390#82;
     #547#34  = #390#80;
     eaAlfa   = #390#85;  |HAZ QuitaRaros;      #547#35 = eaAlfa;
     #547#36  = #390#86;
     #547#37  = #390#84;

     #547#38  = "0";
     |SI #390#87 = "X";  #547#38  = "1";  |FINSI;

     eaVarDni = #390#89;  |HAZ CalculoDNI;    #547#39 = eaVarDni;
     eaAlfa   = #390#90;  |HAZ QuitaRaros;      #547#40 = eaAlfa;

                                           #547#41 = aNifp;
     eaAlfa  = aNombrep;  |HAZ QuitaRaros;  #547#42 = eaAlfa;
                                           #547#43 = aSgp;
     eaAlfa  = aCallep;  |HAZ QuitaRaros;   #547#44 = eaAlfa;
                                           #547#45 = aNump;
                                           #547#46 = aEscp;
                                           #547#47 = aPisop;
                                           #547#48 = aPuep;
                                           #547#49 = aTlfnop;
     eaAlfa  = aPoblap;  |HAZ QuitaRaros;  #547#50 = eaAlfa;
     eaAlfa  = aProvip;   |HAZ QuitaRaros;  #547#51 = eaAlfa;
                                           #547#52 = aCodp;

     eaAlfa  = #dsmoy000#7;  |HAZ FechaBonito
     |SI aNombrep ! "";
         #547#53 = (#dsmoy000#7 % 102) + (#dsmoy000#7 % 402) + (#dsmoy000#7 % 704);
         #547#54 = "";
         #547#55 = "";
         #547#56 = "";
         #547#57 = "";
     |SINO;
         eaAlfa  = #2#13;  |HAZ QuitaRaros;  #547#54 = eaAlfa;
                                             #547#55 = eaDiaB;
                                             #547#56 = eaMesB;
                                             #547#57 = eaAnyoB;
     |FINSI;

     eaAlfa  = (#2#24 + #2#25) % 136; |HAZ QuitaRaros;  #547#58 = eaAlfa;
                                                        #547#59 = #2#26 % 109;
                                                        #547#60 = (#2#27 % 102) + (#2#27 % 402) + (#2#27 % 704);
     eaAlfa  = #2#28 % 112;  |HAZ QuitaRaros;           #547#61 = eaAlfa;
     eaAlfa  = (#2#29 + #2#30) % 136; |HAZ QuitaRaros;  #547#62 = eaAlfa;
                                                        #547#63 = #2#31 % 109;
                                                        #547#64 = (#2#32 % 102) + (#2#32 % 402) + (#2#32 % 704);
     eaAlfa  = #2#33 % 112;  |HAZ QuitaRaros;           #547#65 = eaAlfa;
     eaAlfa  = (#2#34 + #2#35) % 136; |HAZ QuitaRaros;  #547#66 = eaAlfa;
                                                        #547#67 = #2#36 % 109;
                                                        #547#68 = (#2#37 % 102) + (#2#37 % 402) + (#2#37 % 704);
     eaAlfa  = #2#38 % 112;  |HAZ QuitaRaros;           #547#69 = eaAlfa;
|FPRC;

|PROCESO Regis549;
     |DDEFECTO #549;

     |ABRE #490;

     |PARA nCampo1 = 14;  |SI nCampo1 [ 38;  |HACIENDO nCampo1 = nCampo1 + 6;
           nCampo2 = nCampo1 + 1;
           nCampo3 = nCampo1 + 2;
           nCampo4 = nCampo1 + 3;
           nCampo5 = nCampo1 + 4;
           nCampo6 = nCampo1 + 5;

           |SI #390nCampo1 ! 0;
               nCampo = nCampo1 - 8;  aAlfa   = ("00" + #390nCampo1) % -102; #549nCampo = aAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo2;  |HAZ Conver13; #549nCampo = eaAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo3 * 100000;        aAlfa  = ("000000" + enNume) % -106;
               #549nCampo = aAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo4;  |HAZ Conver13; #549nCampo = eaAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo4 - #390nCampo6;   |HAZ Conver13; #549nCampo = eaAlfa;
               nCampo = nCampo + 1;   enNume  = #390nCampo6;  |HAZ Conver13; #549nCampo = eaAlfa;
           |FINSI;
     |SIGUE;

     enNume  = #390#44;  |HAZ Conver13;  #549#36 = eaAlfa;
     enNume  = #390#45;  |HAZ Conver13;  #549#37 = eaAlfa;
     enNume  = #390#46;  |HAZ Conver13;  #549#38 = eaAlfa;
     enNume  = #390#47;  |HAZ Conver13;  #549#39 = eaAlfa;
     enNume  = #390#48;  |HAZ Conver13;  #549#40 = eaAlfa;
     enNume  = #390#49;  |HAZ Conver13;  #549#41 = eaAlfa;
     enNume  = #390#50;  |HAZ Conver13;  #549#42 = eaAlfa;
     enNume  = #390#51;  |HAZ Conver13;  #549#43 = eaAlfa;
     enNume  = #390#52;  |HAZ Conver13;  #549#44 = eaAlfa;
     enNume  = #390#5;   |HAZ Conver13;  #549#45 = eaAlfa;
     enNume  = #390#53;  |HAZ Conver13;  #549#46 = eaAlfa;
     enNume  = #390#54;  |HAZ Conver13;  #549#47 = eaAlfa;

     enNume  = #390#6;   |HAZ Conver13;  #549#48 = eaAlfa;
     enNume  = #390#55 * 100;            #549#49 = ("0000" + enNume) % -104;
     enNume  = #390#56 * 100;            #549#50 = ("0000" + enNume) % -104;
     enNume  = #390#57 * 100;            #549#51 = ("0000" + enNume) % -104;
     enNume  = #390#58 * 100;            #549#52 = ("0000" + enNume) % -104;
     enNume  = #390#59 * 100;            #549#53 = ("0000" + enNume) % -104;
     enNume  = #390#60;  |HAZ Conver13;  #549#54 = eaAlfa;
     enNume  = #390#61;  |HAZ Conver13;  #549#55 = eaAlfa;
     enNume  = #390#62;  |HAZ Conver13;  #549#56 = eaAlfa;

     enNume  = #390#7;   |HAZ Conver13;  #549#57 = eaAlfa;
     enNume  = #390#8;   |HAZ Conver13;  #549#58 = eaAlfa;
     enNume  = #390#9;   |HAZ Conver13;  #549#59 = eaAlfa;
     enNume  = #390#10;  |HAZ Conver13;  #549#60 = eaAlfa;
     enNume  = #390#11;  |HAZ Conver13;  #549#61 = eaAlfa;
     enNume  = #390#100; |HAZ Conver13;  #549#90 = eaAlfa;
     enNume  = #390#101; |HAZ Conver13;  #549#91 = eaAlfa;
     enNume  = #390#102; |HAZ Conver13;  #549#92 = eaAlfa;

     |ABRE #490;
     nGrupo  = 3;  nSubGrupo = 1;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#62 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 17;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#63 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 9;  |HAZ LeeCasilla;
     enNume  = #490#10;
     nGrupo  = 3;  nSubGrupo = 16;  |HAZ LeeCasilla;
     enNume  = enNume + #490#10;  |HAZ Conver13;  #549#64 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 10;  |HAZ LeeCasilla;
     enNume  = #490#10;
     nGrupo  = 3;  nSubGrupo = 11;  |HAZ LeeCasilla;
     enNume  = enNume + #490#10;  |HAZ Conver13;  #549#65 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 12;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#66 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 4;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#67 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 7;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#68 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 2;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#69 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 3;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#70 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 8;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#71 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 5;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#72 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 6;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#73 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 13;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#74 = eaAlfa;

     nGrupo  = 3;  nSubGrupo = 14;  |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#75 = eaAlfa;

     enNume  = #390#12;  |HAZ Conver13;  #549#76 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 1;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#79 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 2;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#80 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 3;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#81 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 4;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#82 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 6;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#83 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 8;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#84 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 16;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#85 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 17;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#86 = eaAlfa;
     enNume  = #490#11;  |HAZ Conver13;  #549#87 = eaAlfa;

     nGrupo  = 4;  nSubGrupo = 18;   |HAZ LeeCasilla;
     enNume  = #490#10;  |HAZ Conver13;  #549#88 = eaAlfa;
     enNume  = #490#11;  |HAZ Conver13;  #549#89 = eaAlfa;

     |CIERRA #490;
|FPRC;

|PROCESO CargaGrupo;
     #790#0 = #dsmom004#0;
     #790#1 = #dsmom004#1;
     #790#2 = #dsmom004#3;
     #790#3 = #dsmom004#4;
     #790#4 = nGrupo;
     |LEE 040#790=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nGrupo = 1;  nCampo = 6;  |FINSI;
     |SI nGrupo = 2;  nCampo = 23; |FINSI;
     |SI nGrupo = 3;  nCampo = 40; |FINSI;

                           enNume  = #790#5;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#6;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#7;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#8;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#9;   |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#10;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#11;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#12;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#13;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#14;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#15;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#16;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#17;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#18;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#19;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#20;  |HAZ Conver13;  #556nCampo = eaAlfa;
     nCampo = nCampo + 1;  enNume  = #790#21;  |HAZ Conver13;  #556nCampo = eaAlfa;
     |SI nGrupo = 1; nCampo = 59; |FINSI;
     |SI nGrupo = 2; nCampo = 60; |FINSI;
     |SI nGrupo = 3; nCampo = 61; |FINSI;
     enNume  = #790#22;  |HAZ Conver13;  #556nCampo = eaAlfa;

     |PARA nCampo = 5;  |SI nCampo [ 22;  |HACIENDO nCampo = nCampo + 1;
           |SI #790nCampo ! 0;  nSwHay = 1;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Regis556;
     |DDEFECTO #556;

     |ABRE #790;

     nSwHay = 0;
     nGrupo = 1;  |HAZ CargaGrupo;
     nGrupo = 2;  |HAZ CargaGrupo;
     nGrupo = 3;  |HAZ CargaGrupo;

     |CIERRA #790;
|FPRC;

|PROCESO MiroModulo;
      nSwMod = 1;
|FPRC;

|DEFBUCLE MiroModulo;
     #590#1;
     ;
     #390#0, #390#1, #390#2, #390#3, 01;
     #390#0, #390#1, #390#2, #390#3, 99;
     ;
     NULL, MiroModulo;
|FIN;

|PROCESO  Portal390;
     |ABRE #dsmom004;
     #dsmom004#0  = #999#0;
     #dsmom004#1  = #999#1;
     #dsmom004#2  = #999#2;
     #dsmom004#3  = #999#5;
     #dsmom004#4  = #999#7;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #dsmom004;

     eaFicheroPlano = "390" + (("00000" + #999#0) % -105) + ".xml";
     eaFicheroImpre = "390" + (("00000" + #999#0) % -105) + ".imp";
     eaFicheroSalid = "390" + (("00000" + #999#0) % -105) + ".390";
     eaFicheroError = "err" + (("00000" + #999#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |ABRE #390;
     #390#0 = #dsmom004#0;
     #390#1 = #dsmom004#1;
     #390#2 = #dsmom004#3;
     #390#3 = #dsmom004#4;
     |LEE 040#390=;
     |SI FSalida ! 0;  |CIERRA #390;  |ACABA;  |FINSI;
     |CIERRA #390;

     |HAZ CargaDatos;
     |HAZ Regis547;
     |HAZ Regis651;
     |HAZ Regis549;
     |HAZ Regis556;

     nSwMod = 0;
     |BUCLE MiroModulo;

     nNueEjer = #dsmoy000#6;
     |ABRE #199;
     |DDEFECTO #199;
     #199#0 = #dsmoy000#0;
     #199#1 = #dsmoy000#6;
     #199#2 = 00;
     |LEE 001#199];
     |SI FSalida ! 0; |O #199#1 ! #dsmoy000#6;
         aAlfa1 = "    SNo tenemos informacion del Modelo en el Ejercicio Actual. Lanzar segun dise¤o Anterior?";
         |CONFI aAlfa1;
         |SI FSalida ! 0;
             |CIERRA #199;
             |ACABA;
         |FINSI;
         #dsmoy000#6 = #dsmoy000#6 - 1;
     |FINSI;
     |CIERRA #199;

     |ABRE #199;
     |HAZ CargaXml;
     |CIERRA #199;
     #dsmoy000#6 = nNueEjer;

     |XCIERRA enHandle2;

     enEmpresa    = #999#0;
     eaNomEmpresa = #999#3;
     eaModelos    = "390";
     eaEjer       = #999#1;

     |HAZ PresentaPortal;
|FPRC;

|DEFBUCLE dsmow014C390;
     #999#1;
     6;
     00000, 0000, 00, "S";
     99999, 9999, 99, "S";
     ;
     NULL, Portal390;
|FIN;

|DEFBUCLE dsmow014N390;
     #999#2;
     6;
     "                                        ", "S";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, Portal390;
|FIN;

|PROCESO Bloque2014;
     |HAZ Botones_2012;

     |SI eaOpcion = "0";  enInfComp = 1;  |ACABA;  |FINSI;

     nTecla = 1;

     nSwLee  = 0;
     enTecla = nTecla;

     |ABRET #2;
     |ABRET #3;
     |ABRET #4;
     |ABRET #5;

     |SI #dsmoy000#8 = "C";
         |BUCLE dsmow014C390;
     |SINO;
         |BUCLE dsmow014N390;
     |FINSI;

     |CIERRAT #2;
     |CIERRAT #3;
     |CIERRAT #4;
     |CIERRAT #5;

     |HAZ SacaErrorPtl;

     |SI eaOpcion = "3";  |Y enPresentar = 0;
         aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROGRAMA;
     aFichero = ("000" + Usuario) % 108;
     |NOME_DAT #dsmoy000#aFichero#;

     |ABRE #dsmoy000;
     |LEE 000#dsmoy000.p;
     |CIERRA #dsmoy000;

     nAnyoDos = #dsmoy000#6 - 2000;

     aFichero = ("imp" + Usuario) % 108;
     |NOME_DAT #999#aFichero#;

     enSwTrata      = 0;
     enCambiaMoneda = 1;

     |HAZ Bloque2014;
|FPRO;
