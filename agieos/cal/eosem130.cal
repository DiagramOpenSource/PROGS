|FICHEROS;
     eosem130 #0;
     eosactiv #1;
     eosclien #2;
     eoshacie #3;
     eosdaban #5;
     eossegu4 #9;
     eosm3130 #10;
     eosm2130 #11;
     eoscomul #12;
     eosm0050 #50;
     eosw0069 #99;
     eosw0169 #199;

     eosw0542 #542;
     dsmow570 #570;
     dsmow576 #576;
     dsmow593 #593;

     eosw0601 #601,MANTE;
|FIN;

|VARIABLES;
     &EURO      = 0;
     &EURODB    = 0;
     &EURODV    = 0;

     nNeg = 0;

     Convert    = 0;
     Campos     = 0;
     LLeno40    = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     Vacio40    = "                                        ";
     d_empre    = 0;
     d_activ    = 0;
     d_anyo     = 0;
     rendi      = 0;
     DEmpre     = 0;
     HEmpre     = 0;
     swcomu     = 0;
     x          = 0;
     empresa    = 0;
     sw         = 0;
     normal     = 0;
     cont       = 0;
     especial   = 0;
     pepe       = 0;
     varalfa    = "";
     si_hay     = 0;
     ya_esta    = 0;
     nEl27      = 0;

     aAlfa        = "";
     aCadena      = "";
     aLong        = "";
     aCaracter    = "";
     nLong        = 0;
     nPos         = 0;
     nCont        = 0;
     nAnyo        = 0;

     xxxxfiac   = "  ";
     xxaponer   = "  ";
     xrelleno   = "                              ";

     aDirOri    = "";
     aDirDes    = "";
     aOrigen    = "";
     aDestino   = "";

     aAlfa1       = "";
     aUnidad      = "";

  {1}aContiene    = "";

     &equis     = "";
     &comunero  = "";
     &retencion = 0;
     &pagos     = 0;
     &total     = 0;
     &dia       = "";
     &mes       = "";
     &anyo      = "";
     &peri      = "";
     &imp1      = 0; &imp2  = 0; &imp3  = 0; &imp4  = 0; &imp5  = 0;
     &imp6      = 0; &imp7  = 0; &imp8  = 0; &imp9  = 0; &imp10 = 0;
     &imp11     = 0; &imp12 = 0; &imp13 = 0; &imp14 = 0; &imp15 = 0;

     Calc = 0;   Calc1 = 0;  Calc2 = 0;
     TipoDato = "";  Long  = 0;  LongDec = 0;
     Comodin = "";  Comodin1 = "";  Comodin2 = "";
     Vacio1 = "";  Vacio2 = "";
     nConver = 0;

     aAbre        = "";
     aModelos     = "";
     aFichero     = "";

     nHandle1     = 0;
     nHandle2     = 0;
     nAnyo2D      = 0;
     nSwHay       = 0;
     nTCampo      = 0;

     fFecha       = @;

     &eaFOrigen   = "";
     &eaFDestino  = "";
     &eaInternet  = "";
     &eaImpresora = "";
     &enNume      = 0;
     &eaAlfa      = "";
     &eaDiaB      = "";
     &eaMesB      = "";
     &eaAnyoB     = "";
     &eaModelos   = "";

     &eaDirJava     = "";
     &eaPathAcrobat = "";
     &enError       = 0;
     &enComuneros   = 0;
     &enHandle2     = 0;
     &eaFichError   = "";
     &eaFichDatos   = "";
     &eaFichAuxil   = "";
     &eaEjer        = "";

     &eaPathEmision      = "";
     &eaPathLanza        = "";
     &eaPathExplorador   = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaFicheroSalid     = "";
     &eaFicheroImpre     = "";
     &eaFicheroError     = "";
     &eaOpcion           = "";
     &enEmpresa          = 0;
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enErrorPortal      = 0;
     &enTecla            = 0;
     &enPeriodo          = 0;
     &eaPeriodo          = "";
     nTecla              = 0;
     perialf             = "";

    &enModelo  = 0;
    &enError15 = 0;
    &enPago    = 0;
|FIN;

|INCLUYE i_ficher;
|INCLUYE i_seguim;
|INCLUYE i_cuadre;
|INCLUYE i_anyode;
|INCLUYE i_pastil;
|INCLUYE i_consul;
|INCLUYE i_laserc;

|PROCESO FPago; |TIPO 0;
 |C_M #0Campo, 0, aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |SI FSalida = 2; |ACABA; |FINSI;

 |SI #0#32 ! "F";
     |SI #0#35 = "A";
         |MENAV "    Opcion valida solo para Fichero / Internet. ";
         |ERROR;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO ElAny;
   aAlfa1 = "S";
   |SI #0#2 > 2013; aAlfa1 = "N"; |FINSI;
   |C_M #0#35, 1, aAlfa1;
|FPRC;

|PROCESO Parrilla; |TIPO 0;
     |SI #0#7 = "S";
         |PARA Campos = 8; |SI Campos [ 31; |HACIENDO Campos = Campos + 1;
               |C_M #0Campos, 1, "N";  #0Campos = 0;  |PINTA #0Campos;
         |SIGUE;
         |C_M #0#0, 1, "S";   |C_M #0#1, 1, "S";  |C_M #0#33, 1, "S";
     |SINO;
         |PARA Campos = 8; |SI Campos [ 31; |HACIENDO Campos = Campos + 1;
               |C_M #0Campos, 1, "S";
         |SIGUE;
         |C_M #0#0,  1, "N"; #0#0 = 1;     |PINTA #0#0;
         |C_M #0#1,  1, "N"; #0#1 = 99999; |PINTA #0#1;
         |C_M #0#33, 1, "N"; #0#33 = "C";  |PINTA #0#33;
     |FINSI;
|FPRC;

|PROCESO pinta_anyo; |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#2   = aAlfa;
     |PINTA #0#2;
|FPRC;

|PROCESO MiraVarMoneda;  |TIPO 0;
     |HAZ PintaMoneda;
     #0#34 = eaMoneda;

     |PINTA #0#34;
|FPRC;

|PROCESO mira_trabajo;
     si_hay  = 1;
|FPRC;

|DEFBUCLE eosm2130_2;
     #11#1;
     ;
     #1#0, #1#1, #10#2, #10#3;
     #1#0, #1#1, #10#2, #10#3;
     be;
     NULL, mira_trabajo;
|FIN;

|PROCESO mira_sihay;
     |SI #1#22 = "A";          |ACABA; |FINSI;
     |SI #1#22 = "N";          |ACABA; |FINSI;
     |SI #1#14 = "S";          |ACABA; |FINSI;
     |SI #1#49 ! "01.01.1900"; |ACABA; |FINSI;

     si_hay    = 0;
     |BUCLE eosm2130_2;

     |SI si_hay  = 0;
         ya_esta = 0;
         |PUSHV 0501 2380;
         |CUADRO 810  2067;
         |PINTA  911, "                                                        ";
         |PINTA 1011, "                                                        ";
         |PINTA 1111, "                                                        ";
         |PINTA 1211, "                                                        ";
         |PINTA 1311, "                                                        ";
         |PINTA 1411, "                                                        ";
         |PINTA 1511, "                                                        ";
         |PINTA 1611, "                                                        ";
         |PINTA 1711, "                                                        ";
         |PINTA 1811, "                                                        ";
         |PINTA 1911, "                                                        ";

         |PINTA 1011, "Empresa : ";
         |PINTA 1021, #1#0;
         |PINTA 1027, #1#3;

         |PINTA 1211, "Actividad : ";
         |PINTA 1223, #1#1;
         |PINTA 1225, "A¤o : ";
         |PINTA 1231, #1#2;

         |ATRI P;
         |PINTA 1520, "    NO EXISTE LA ACTIVIDAD EN EL      ";
         |PINTA 1620, "    MANTENIMIENTO DE TRABAJO DEL 130  ";
         |ATRI p;

         |CONFI "2400NDesea imprimirlo : ";
         |SI FSalida = 0;  ya_esta = 1;  |FINSI;

         |POPV;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE eosactiv;
     #1#1;
     ;
     #10#0, 1, #10#3;
     #10#0, 6, #10#3;
     ;
     NULL, mira_sihay;
|FIN;

|PROCESO pon_fecha1;
     #11#4 = #0#6;
     |GRABA 140#11a;
     |LIBERA #11;
|FPRC;

|DEFBUCLE eosm2130_1;
     #11#1;
     ;
     #10#0, 1, #10#2, #10#3;
     #10#0, 6, #10#2, #10#3;
     be;
     NULL, pon_fecha1;
|FIN;

|PROCESO pon_fecha2;
     #11#0 = #12#0;
     #11#1 = #12#1;
     #11#2 = #10#2;
     #11#3 = #10#3;
     |LIBERA #11;
     |LEE 140#11=;
     |SI FSalida = 0;
         #11#4 = #0#6;
         |GRABA 140#11a;
         |LIBERA #11;
     |FINSI;
|FPRC;

|DEFBUCLE eoscomul;
     #12#2;
     ;
     #10#0, 1, #10#3;
     #10#0, 6, #10#3;
     e;
     NULL, pon_fecha2;
|FIN;

|PROCESO mante_trab;
     |SI #0#32 = "B"; |ACABA; |FINSI;

     |SI #10#32 = "N";
         |BUCLE eosm2130_1;
     |SINO;
         |ABRE #11;
         |BUCLE eoscomul;
         |CIERRA #11;
     |FINSI;
|FPRC;

|PROCESO PorImpre;
     ya_esta = 1;
     si_hay  = 0;

     |BUCLE eosactiv;

     |SI ya_esta = 0; |ACABA; |FINSI;

     |SI #0#33 ! "N";
         #2#0 = #10#0;
         |LEE 040#2=;                             || Lee empresas
         |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
     |FINSI;

     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;                             || Lee Hacienda
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #5#0 = #10#0;
     |LEE 040#5=;                             || Lee Bancos
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     |SI #10#32 = "S"; |Y #10#33 = 1;
         comunero = "COMUNIDAD DE BIENES " + #10#34 + " AL " + #10#35 + " %";
     |FINSI;

     |SI #10#32 = "S"; |Y #10#33 > 1;
         comunero = "COMUNIDADES DE BIENES";
     |FINSI;

     |SI #10#32 = "N"; comunero = ""; |FINSI;

     |PRINT;
     |PIEINF;

     |SI #0#32 ! "B";
         #10#4 = #0#6;
         |GRABA 140#10a;
         |LIBERA #10;
     |FINSI;

     |HAZ mante_trab;

     |SI #0#32 = "B"; |ACABA; |FINSI;

     |ABRE #9;
     #9#0 = #2#0;
     |LIBERA #9;
     |LEE 140#9=;
     |SI FSalida = 0;
         #9#1 = #9#1 + 1;
         |GRABA 140#9a;
     |SINO;
         #9#0 = #2#0;
         #9#1 = 10;
         |GRABA 140#9n;
     |FINSI;
     |CIERRA #9;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 130;
     se_activ = #9#1;

     |SI #9#1 = 10; |BUCLE eossegui; |FINSI;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 130;
     se_activ = #9#1;
     se_impor = #10#29;
     |SI #0#2 = 2008; |Y #0#4 ] 2;
         se_impor = #10#44;
     |FINSI;
     se_fecha = #0#6;
     se_factu = "N";
     |HAZ seguimie;
     |HAZ AlAgicli;
|FPRC;

|| Secuencial del Modelo 130

|PROCESO Valor12;
     eaMoneda = #0#34;
     enCanti  = nCanti;
     |HAZ ConverMoneda;
     nCanti   = enCanti;

     |SI nCanti ] 0;
         aCanti = nCanti;
         aCanti = ("000000000000" + aCanti) % -112;
     |SINO;
         nCanti = -nCanti;
         aCanti = nCanti;
         aCanti = "N" + (("00000000000" + aCanti) % -111);
     |FINSI;
|FPRC;

|PROCESO Carga130_2001;
   Convert = 1;
   |SI #0#2 [ 2000;
     |DDEFECTO #99;

     #99#4  = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);

     Valfa  = #2#1; |QBF Valfa;
     #99#5  = ("000000000" + Valfa) % -109;
     #99#6  = #2#2;
     #99#8  = #2#4;
     #99#9  = #2#5;
     #99#10 = #2#6;
     #99#11 = #2#7;
     #99#12 = #2#8;
     #99#13 = #2#9;
     #99#14 = (("00" + #2#10) % -102) + (("000" + #2#11) % -103);
     #99#15 = #2#13;
     #99#16 = #2#12;
     #99#17 = #2#14;
     #99#18 = #0#2;
     #99#19 = #0#4;

     nCanti = #10#8;                    |HAZ Valor12;  #99#20 = aCanti;
     nCanti = #10#8 - #10#26 + #10#37;  |HAZ Valor12;  #99#21 = aCanti;
     nCanti = #10#37;                   |HAZ Valor12;  #99#22 = aCanti;
     nCanti = #10#26;                   |HAZ Valor12;  #99#23 = aCanti;

     nEl27 = 0;
     |SI #10#27 > 0;
         nEl27  = #10#27;
         nCanti = #10#27;
         |HAZ Valor12;
         #99#24 = aCanti;
     |FINSI;

     |SI #0#2 [ 1998;
         nCanti = #10#25;                   |HAZ Valor12;  #99#25 = aCanti;
         nCanti = #10#28;                   |HAZ Valor12;  #99#26 = aCanti;
     |SINO;
         nCanti = #10#28;                   |HAZ Valor12;  #99#25 = aCanti;
         nCanti = #10#25;                   |HAZ Valor12;  #99#26 = aCanti;
     |FINSI;

     nCanti = nEl27 - #10#25 - #10#28;
     |SI nCanti > 0;
         |HAZ Valor12;
         #99#27  = aCanti;
     |FINSI;

     nCanti = #10#30;  |HAZ Valor12;  #99#28 = aCanti;
     nCanti = #10#31;  |HAZ Valor12;  #99#29 = aCanti;
     nCanti = #10#36;  |HAZ Valor12;  #99#30 = aCanti;

     nCanti = #10#31 - #10#36;
     |SI nCanti > 0;
         |HAZ Valor12;
         #99#31  = aCanti;
     |FINSI;

     nCanti = #10#29;
     |SI nCanti > 0;
         |HAZ Valor12;
         #99#32  = aCanti;
         #99#34  = aCanti;
     |SINO;
         #99#33 = "X";
     |FINSI;

     #99#37 = #5#2;
     #99#38 = #5#3;
     #99#39 = #5#4;
     #99#40 = #5#5;
     #99#41 = #2#13;
     #99#42 = dia;
     #99#43 = mes;
     #99#44 = anyo;
     #99#45 = &13 + &10;
  |SINO;
     |DDEFECTO #199;
     |SI #eosem130#34 = "PESETAS";
        #199#1 = "130";
     |SINO;
        #199#1 = "132";
     |FINSI;

     #199#4  = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);

     Valfa  = #2#1; |QBF Valfa;
     #199#5  = ("000000000" + Valfa) % -109;
     #199#6  = #2#2;
     #199#8  = #2#4;
     #199#9  = #2#5;
     #199#10 = #2#6;
     #199#11 = #2#7;
     #199#12 = #2#8;
     #199#13 = #2#9;
     #199#14 = (("00" + #2#10) % -102) + (("000" + #2#11) % -103);
     #199#15 = #2#13;
     #199#16 = #2#12;
     #199#17 = #2#14;
     #199#18 = #0#2;
     #199#19 = #0#4;

     nCanti = #10#8;              |HAZ Valor12;  #199#20 = aCanti;
     nCanti = #10#8 - #10#22;     |HAZ Valor12;  #199#21 = aCanti;
     nCanti = #10#22;             |HAZ Valor12;  #199#22 = aCanti;

     nEl27 = 0;
     |SI #10#27 > 0;
         nCanti = #10#27; |HAZ Valor12; #199#23 = aCanti; nEl27 = #10#27;
     |FINSI;

     nCanti = #10#28;                   |HAZ Valor12;  #199#24 = aCanti;
     nCanti = #10#25;                   |HAZ Valor12;  #199#25 = aCanti;
     nCanti = #199#23 - #199#24 - #199#25;
     |SI nCanti > 0;
         aCanti = (("0" * 12) + nCanti) % -112; #199#26  = aCanti;
     |FINSI;

     nCanti = #10#30;  |HAZ Valor12;  #199#27 = aCanti;
     nCanti = #10#31;  |HAZ Valor12;  #199#28 = aCanti;
     nCanti = #10#36;  |HAZ Valor12;  #199#29 = aCanti;

     nCanti = #10#31 - #10#36;
     |SI nCanti > 0;
         |HAZ Valor12;
         #199#30  = aCanti;
     |FINSI;

     nCanti = #10#29;
     |SI nCanti > 0;
         |HAZ Valor12;
         #199#31  = aCanti;
         #199#33  = aCanti;
     |SINO;
         #199#32 = "X";
     |FINSI;

     #199#36 = #5#2;
     #199#37 = #5#3;
     #199#38 = #5#4;
     #199#39 = #5#5;
     #199#40 = #2#13;
     #199#41 = dia;
     #199#42 = mes;
     #199#43 = anyo;
     #199#44 = &13 + &10;
  |FINSI;
|FPRC;

|PROCESO Formateo;
   nNeg = 0;
   |SI TipoDato = "N";
      |SI nConver = 1;
          eaMoneda = #0#34;
          enCanti  = Comodin;
          |HAZ ConverMoneda;
          Comodin  = enCanti;
      |FINSI;
      Vacio1 = "0" * Long;
      Vacio2 = "0" * LongDec;
      Comodin = Comodin - "-";
      |SI FSalida ! 0; nNeg = 1; |FINSI;
   |SINO;
      Vacio1 = " " * Long;
   |FINSI;

   |SI LongDec = 0;
      Calc1 = 0 - (100 + Long);
      Comodin = (Vacio1 + Comodin) % Calc1;
   |SINO;
      Comodin = Comodin - ".";
      |SI FSalida = 0;
         Calc1 = 0 - (100 + Long);
         Comodin = (Vacio1 + Comodin) % Calc1;
         Comodin1 = "0" * LongDec;
      |SINO;
         Calc1 = (((FSalida / 100) ! 0) - 1) + 100;
         Calc2 = (((FSalida / 100) ! 0) * 100) + 99;
         Comodin1 = Comodin % Calc2;
         Comodin  = Comodin % Calc1;
         Calc1 = 0 - (100 + Long);
         Comodin  = (Vacio1 + Comodin)  % Calc1;
         Calc1 = 100 + LongDec;
         Comodin1 = (Comodin1 + Vacio2) % Calc1;
      |FINSI;
      Comodin = Comodin + Comodin1;
   |FINSI;
   |SI TipoDato = "N"; |Y nNeg = 1;
      Calc = 0 - (100 + (Long - 1));
      Comodin = "N" + (Comodin % Calc)
   |FINSI;
|FPRC;

|PROCESO Internet130;
     Raiz       = "";  |DIRECTORIO Raiz;
     Directorio = "";
     |DBASE Directorio;
     Directorio = Directorio + "hacienda/internet/" + aTipoSec;
     |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;

     Empresa  = ("00000" + #2#0) % -105;

     Fichero    = aTipoSec + Empresa;
     aNombre    = Fichero;
     INEmpresas = NEmpresas1 <-;
     INEmpresas = INEmpresas + NACopiar;
     NFichero   = Directorio + Fichero;          |QBF NFichero;
     NEmpresas  = NFichero;
     NACopiar   = NACopiar + 1;

     Fichero  = "wb  "+ NFichero;

     Pos = -1;
     |FABRE Fichero;
     Handle = FSalida;
     |SI FSalida ] 0;
         Cadena = "130E";
         Cadena = Cadena + (#eosclien#1 % 0109);    ||NIF
         Cadena = Cadena + "    ";                  || Letras de etiqueta

         Comodin = #0#2;
         Cadena  = Cadena + Comodin;                 || Ejercicio
         Comodin = #eosem130#4; |QBF Comodin; Comodin = Comodin + "T";
         Cadena  = Cadena + Comodin;                 || Periodo

         Long = 17; LongDec = 0; TipoDato = "N";  nConver = 1;
         Comodin = #eosm3130#8;  |HAZ Formateo; Cadena = Cadena + Comodin; || Ingresos computables
         Calc = #eosm3130#8 - #eosm3130#26 + #eosm3130#37;
         |SI Calc < 0; Calc = 0; |FINSI;
         Comodin = Calc;         |HAZ Formateo; Cadena = Cadena + Comodin; || Gastos fiscalmente deducibles
         Comodin = #eosm3130#26; |HAZ Formateo; Cadena = Cadena + Comodin; || Rendimiento neto
         Comodin = #eosm3130#21; |HAZ Formateo; Cadena = Cadena + Comodin; || 20 % del importe impositivo
         Comodin = #eosm3130#28; |HAZ Formateo; Cadena = Cadena + Comodin; || Suma de los pagos anteriores
         Comodin = #eosm3130#25; |HAZ Formateo; Cadena = Cadena + Comodin; || Retenciones e ingresos a cta.
         Calc = #eosm3130#27 - #eosm3130#25 - #eosm3130#28;
         |SI Calc < 0; Calc = 0; |FINSI;
         Comodin = Calc;         |HAZ Formateo; Cadena = Cadena + Comodin; || Pago Fraccionado
         Comodin = #eosm3130#30; |HAZ Formateo; Cadena = Cadena + Comodin; || Ingresos trimestre activ.A.G.y P.
         Comodin = #eosm3130#31; |HAZ Formateo; Cadena = Cadena + Comodin; || 2% de la casilla anterior
         Comodin = #eosm3130#36; |HAZ Formateo; Cadena = Cadena + Comodin; || Retenc.e ing.a cta. del trimestre
         Calc = #eosm3130#31 - #eosm3130#36;
         |SI Calc < 0; Calc = 0; |FINSI;
         Comodin = Calc;         |HAZ Formateo; Cadena = Cadena + Comodin; || Pago fraccionado
         Cadena = Handle + " " + Cadena; |FGRABA Cadena; Cadena = "";
         Calc = (#eosm3130#27 - #eosm3130#25 - #eosm3130#28) + (#eosm3130#31 - #eosm3130#36);
         |SI Calc < 0; Calc = 0; |FINSI;
         Comodin = Calc;         |HAZ Formateo; Cadena = Cadena + Comodin; || Suma de los Pagos Fraccionados
         Comodin = 0;            |HAZ Formateo; Cadena = Cadena + Comodin; || A deducir (complementarias)
         Comodin = Calc;         |HAZ Formateo; Cadena = Cadena + Comodin; || Cuota a ingresar
         Cadena = Handle + " " + Cadena; |FGRABA Cadena;

         Cadena = " " * 129;                                           || Codigo decl.+N§ justif.+Persona de contacto
         Cadena = Handle + " " + Cadena; |FGRABA Cadena;

         Cadena = " " * 210;                                           || Telefono de contacto y parte de observaciones
         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;

         Cadena = " " * 150;                                           || La otra parte de observaciones
         Cadena = Handle + " " + Cadena;
         |FGRABA Cadena;
     |FINSI;
     FSalida = Handle;
     |FCIERRA FSalida;

     aAlfa = ""; |IP_REMOTO aAlfa;
     |DBASE aDirOri; |QBF aDirOri;
     aDirOri = aDirOri + "hacienda/internet/" + aTipoSec + "/";
     aDirDes = "/MODELOS";
     |SI aAlfa ! ""; |RMKDIR aDirDes; |SINO; |MKDIR aDirDes; |FINSI;
     aDirDes = "/MODELOS/INTERNET";
     |SI aAlfa ! ""; |RMKDIR aDirDes; |SINO; |MKDIR aDirDes; |FINSI;
     aDirDes = "/MODELOS/INTERNET/" + aTipoSec;
     |SI aAlfa ! ""; |RMKDIR aDirDes; |SINO; |MKDIR aDirDes; |FINSI;
     aDirDes = aDirDes + "/";
     aOrigen = aDirOri + aNombre; aDestino = aDirDes + aNombre;
     |SI aAlfa ! ""; |ENVIA_FICHERO aOrigen, aDestino; |SINO; |COPIA_FICHERO aOrigen, aDestino; |FINSI;
     |MENAV "    Ficheros creados correctamente";
|FPRC;

|PROCESO QuitaComas;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCont = 1;  |SI nCont [ aLong;  |HACIENDO nCont = nCont + 1;
           nPos = (100 * nCont) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = ",";  aCaracter = " ";  |FINSI;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;

     aAlfa = aAlfa > aAlfa;
|FPRC;

|PROCESO Secuencial130;
     Raiz       = "";  |DIRECTORIO Raiz;
     Directorio = "";
     |DBASE Directorio;
     Directorio = Directorio + "hacienda/" + aTipoSec;
     |MKDIR Directorio;
     Directorio = Directorio + "/";
     Valfa = Raiz + "bin/agichmod 777 " + Directorio;

     Empresa  = ("00000" + #2#0) % -105;

     Fichero    = (aTipoSec % 102) + #10#1 + Empresa;
     INEmpresas = NEmpresas1 <-;
     INEmpresas = INEmpresas + NACopiar;
     NFichero   = Directorio + Fichero;          |QBF NFichero;
     NEmpresas  = NFichero;
     NACopiar   = NACopiar + 1;

     Fichero  = "wb  "+ NFichero;

     Pos = -1;
     |FABRE Fichero;
     Handle = FSalida;
     |SI FSalida ] 0;
         |HAZ Carga130_2001;
         |SI #0#2 [ 2000;
            |PARA nCampo = 1;  |SI nCampo [ 45;  |HACIENDO nCampo = nCampo + 1;
               |SI nCampo = 44;  |Y #0#2 [ 1998;
                   Cadena = Handle + " " + (#99nCampo % 101);
               |SINO;
                   |SI nCampo = 22;
                       |SI #0#2 [ 1998;
                           Cadena = Handle + " " + #99nCampo;
                       |FINSI;
                   |SINO;
                       Cadena = Handle + " " + #99nCampo;
                   |FINSI;
               |FINSI;
               |FGRABA Cadena;
            |SIGUE;
         |SINO;
            |SI #eosem130#34 = "PESETAS";
               |PARA nCampo = 1;  |SI nCampo [ 44;  |HACIENDO nCampo = nCampo + 1;
                  |SI nCampo = 6;  |O nCampo = 7;  |O nCampo = 8; |O nCampo = 9;
                   |O nCampo = 15; |O nCampo = 16; |O nCampo = 40;
                      aAlfa = #199nCampo; |HAZ QuitaComas; #199nCampo = aAlfa;
                  |FINSI;
                  Cadena = Handle + " " + #199nCampo; |FGRABA Cadena;
               |SIGUE;
            |SINO;
               |PARA nCampo = 1;  |SI nCampo [ 30;  |HACIENDO nCampo = nCampo + 1;
                  Cadena = Handle + " " + #199nCampo; |FGRABA Cadena;
               |SIGUE;
               nCanti = #199#26 + #199#30; aCanti = (("0" * 12) + nCanti) % -112;
               Cadena = Handle + " " + aCanti + "000000000000"; |FGRABA Cadena;
               Cadena = Handle + " " + #199#31;                 |FGRABA Cadena;
               |PARA nCampo = 33;  |SI nCampo [ 39;  |HACIENDO nCampo = nCampo + 1;
                  Cadena = Handle + " " + #199nCampo; |FGRABA Cadena;
               |SIGUE;
               Cadena = Handle + " " + #199#32;                  |FGRABA Cadena;
               Cadena = Handle + "               ";              |FGRABA Cadena;
               Cadena = Handle + " " + (#199#40 % 0116);         |FGRABA Cadena;
               |PARA nCampo = 41;  |SI nCampo [ 44;  |HACIENDO nCampo = nCampo + 1;
                  Cadena = Handle + " " + #199nCampo; |FGRABA Cadena;
               |SIGUE;
            |FINSI;
         |FINSI;
     |FINSI;
     FSalida = Handle; |FCIERRA FSalida;
|FPRC;

|PROCESO CargaImprime;
     aAlfa = "del err" + (("00000" + #2#0) % -105) + ".TXT" + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "wait mipf32 ";
     aAlfa = aAlfa + "/E:130" + (("00000" + #2#0) % -105) + ".TXT ";
     aAlfa = aAlfa + "/R:err" + (("00000" + #2#0) % -105) + ".TXT ";
     |SI eaImpresora ! "";
         aAlfa = aAlfa + "/I:" + &34 + eaImpresora + &34;
     |FINSI;
     aAlfa = aAlfa + " /C:" + #601#0;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "DEL " + "130" + (("00000" + #2#0) % -105) + ".TXT ";
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO TDeclaracion;
     |SI #10#29 > 0;
         enNume = #10#29;  |HAZ Conver13;  #542#36 = eaAlfa;

         |SI #0#35 = "S";  |O #0#35 = "D";
             |SI #5#5 = "          ";
                  #542#37  = "X";
             |SINO;
                  #542#38 = "X";
                  #542#39 = #5#2;            || entidad
                  #542#40 = #5#3;            || oficina
                  #542#41 = #5#4;            || DC
                  #542#42 = #5#5;           || cuenta
             |FINSI;
         |SINO;
             #542#37  = "X";
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #542#36 = eaAlfa;
      |FINSI;

      #542#4 = "";
      |SI #0#32 = "L";
          |SI #10#29 [ 0;  #542#4 = "N";  |FINSI;
      |SINO;
          #542#4 = "N";
          |SI #10#29 > 0;  #542#4 = "I";  |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2002;
     |SI #0#32 = "L";
         aAbre = "\MODELOS\130\" + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#32 = "F";
         aAbre = eaInternet + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #542;

     #542#1   = "130";
     #542#2   = "01";
     #542#3   = "";

     #542#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     aAlfa    = #2#1;  |QBF aAlfa;
     #542#6   = ("000000000" + aAlfa) % -109;
     #542#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #542#8   = eaAlfa;
     #542#9   = ".";
     eaAlfa   = #2#4;    |HAZ QuitaRaros;     #542#10  = eaAlfa;
     eaAlfa   = #2#5;    |HAZ QuitaRaros;     #542#11  = eaAlfa;
     #542#12  = #2#6;
     #542#13  = #2#7;
     #542#14  = #2#8;
     #542#15  = #2#9;
     #542#16  = (("00" + #2#10) % -102) + (("000" + #2#11) % -103);
     eaAlfa   = #2#13;   |HAZ QuitaRaros;     #542#17  = eaAlfa;
     eaAlfa   = #2#12;   |HAZ QuitaRaros;     #542#18  = eaAlfa;
     eaAlfa   = #2#14;   |HAZ QuitaRarosTfno; #542#19 = eaAlfa;

     #542#20  = #0#2;
     #542#21  = #0#4 + "T";

     enNume  = #10#8;           |HAZ Conver13;  #542#22 = eaAlfa;
     enNume  = #10#8 - #10#22;  |HAZ Conver13;  #542#23 = eaAlfa;
     enNume  = #10#22;          |HAZ Conver13;  #542#24 = eaAlfa;

     nEl27   = 0;
     |SI #10#27 > 0;
         enNume  = #10#27;      |HAZ Conver13;  #542#25 = eaAlfa;
         nEl27   = #10#27;
     |FINSI;

     enNume  = #10#28;                    |HAZ Conver13;  #542#26 = eaAlfa;
     enNume  = #10#25;                    |HAZ Conver13;  #542#27 = eaAlfa;
     enNume  = nEl27 - #10#28 - #10#25;
     |SI enNume > 0;
         |HAZ Conver13;  #542#28 = eaAlfa;
     |FINSI;

     enNume  = #10#30;                    |HAZ Conver13;  #542#29 = eaAlfa;
     enNume  = #10#31;                    |HAZ Conver13;  #542#30 = eaAlfa;
     enNume  = #10#36;                    |HAZ Conver13;  #542#31 = eaAlfa;

     enNume  = #10#31 - #10#36;
     |SI enNume > 0;
         |HAZ Conver13;  #542#32 = eaAlfa;
     |FINSI;

     enNume  = #10#29;
     |SI enNume > 0;
         |HAZ Conver13;  #542#33 = eaAlfa;
                         #542#35 = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion;

     |SI #10#38 = "S";
         #542#43 = #10#40;
         #542#44 = #10#39;
     |FINSI;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #542#45  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #542#46  = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #542#51 = eaAlfa;
     #542#52 = eaDiaB;
     #542#53 = eaMesB;
     #542#54 = eaAnyoB;
     #542#55 = &13 + &10;

     |SI #0#32 = "L";
         #542#7  = "";
         #542#43 = "";
         #542#45 = "";
         #542#46 = "";
         #542#47 = "";
         #542#48 = "";
         #542#49 = "";
         #542#50 = "";
         nTCampo = 55;
     |FINSI;

     |SI #0#32 = "F";
         #542#2  = "";
         #542#3  = "";
         #542#5  = "";
         #542#8  = "";
         #542#9  = "";
         #542#10 = "";
         #542#11 = "";
         #542#12 = "";
         #542#13 = "";
         #542#14 = "";
         #542#15 = "";
         #542#16 = "";
         #542#17 = "";
         #542#18 = "";
         #542#19 = "";
         #542#37 = "";
         #542#38 = "";
         #542#39 = "";
         #542#40 = "";
         #542#41 = "";
         #542#42 = "";
         #542#51 = "";
         #542#52 = "";
         #542#53 = "";
         #542#54 = "";
         #542#55 = "";
         nTCampo = 54;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #542nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#32 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO TDeclaracion_2007;
     |SI #10#29 > 0;
         enNume = #10#29;  |HAZ Conver13;  #570#26 = eaAlfa;

         |SI #0#35 = "S";  |O #0#35 = "D";
             |SI #5#5 = "          ";
                  #570#27 = "1";
             |SINO;
                  #570#27 = "2";
                  |SI #0#32 = "F"; |Y #0#35 = "D";
                      #570#27 = "3";
                  |FINSI;
                  #570#28 = #5#2;            || entidad
                  #570#29 = #5#3;            || oficina
                  #570#30 = #5#4;            || DC
                  #570#31 = #5#5;           || cuenta
             |FINSI;
         |SINO;
             #570#27 = "1";
         |FINSI;
      |SINO;
         #570#27 = "0";
         enNume  = 0;  |HAZ Conver13;  #570#26 = eaAlfa;
      |FINSI;

      #570#4 = "";
      |SI #0#32 = "L";
          |SI #10#29 [ 0;  #570#4 = "N";  |FINSI;
      |SINO;
          #570#4 = "N";
          |SI #10#29 > 0;
                                                   #570#4 = "I";
              |SI #0#35 = "A";    |Y #0#2 < 2013;  #570#4 = "A";  |FINSI;
              |SI #570#27 = "3";                   #570#4 = "U";  |FINSI;
          |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2007;
     |SI #0#32 = "L";
         aAbre = "\MODELOS\130\" + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#32 = "F";
         aAbre = eaInternet + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #570;

     #570#1   = "130";
     #570#2   = "01";
     #570#3   = "";

     #570#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     aAlfa    = #2#1;  |QBF aAlfa;
     #570#6   = ("000000000" + aAlfa) % -109;
     #570#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #570#8   = eaAlfa;
     #570#9   = ".";

     #570#10  = #0#2;
     #570#11  = #0#4 + "T";

     enNume  = #10#8;           |HAZ Conver13;  #570#12 = eaAlfa;
     enNume  = #10#8 - #10#22;  |HAZ Conver13;  #570#13 = eaAlfa;
     enNume  = #10#22;          |HAZ Conver13;  #570#14 = eaAlfa;

     nEl27   = 0;
     |SI #10#27 > 0;
         enNume  = #10#27;      |HAZ Conver13;  #570#15 = eaAlfa;
         nEl27   = #10#27;
     |FINSI;

     enNume  = #10#28;                    |HAZ Conver13;  #570#16 = eaAlfa;
     enNume  = #10#25;                    |HAZ Conver13;  #570#17 = eaAlfa;
     enNume  = nEl27 - #10#28 - #10#25;   |HAZ Conver13;  #570#18 = eaAlfa;

     enNume  = #10#30;                    |HAZ Conver13;  #570#19 = eaAlfa;
     enNume  = #10#31;                    |HAZ Conver13;  #570#20 = eaAlfa;
     enNume  = #10#36;                    |HAZ Conver13;  #570#21 = eaAlfa;
     enNume  = #10#31 - #10#36;           |HAZ Conver13;  #570#22 = eaAlfa;

     enNume  = #10#29;
     |SI enNume > 0;
         |HAZ Conver13;  #570#23 = eaAlfa;
                         #570#25 = eaAlfa;
     |FINSI;

     |HAZ TDeclaracion_2007;

     |SI #10#38 = "S";
         #570#32 = #10#40;
         #570#33 = #10#39;
     |FINSI;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #570#34  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #570#35  = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #570#40 = eaAlfa;
     #570#41 = eaDiaB;
     #570#42 = eaMesB;
     #570#43 = eaAnyoB;
     #570#44 = &13 + &10;

     |SI #0#32 = "L";
         #570#7  = "";
         #570#32 = "";
         #570#34 = "";
         #570#35 = "";
         #570#36 = "";
         #570#37 = "";
         #570#38 = "";
         #570#39 = "";
         nTCampo = 44;
     |FINSI;

     |SI #0#32 = "F";
         #570#2  = "";
         #570#3  = "";
         #570#5  = "";
         #570#40 = "";
         #570#41 = "";
         #570#42 = "";
         #570#43 = "";
         #570#44 = "";
         nTCampo = 43;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #570nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#32 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO TDeclaracion_2008_04;
     |SI #10#46 > 0;
         enNume = #10#46;  |HAZ Conver13;  #576#30 = eaAlfa;

         |SI #0#35 = "S";  |O #0#35 = "D";
             |SI #5#5 = "          ";
                  #576#31 = "1";
             |SINO;
                  #576#31 = "2";
                  |SI #0#32 = "F"; |Y #0#35 = "D";
                      #576#31 = "3";
                  |FINSI;
                  #576#32 = #5#2;            || entidad
                  #576#33 = #5#3;            || oficina
                  #576#34 = #5#4;            || DC
                  #576#35 = #5#5;           || cuenta
             |FINSI;
         |SINO;
             #576#31 = "1";
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #576#30 = eaAlfa;
                                       #576#31 = "0";
         |SI #10#46 < 0; |Y #10#2 ! 4; #576#36 = "X"; |FINSI;  || hasta que salga el 4
      |FINSI;

      #576#4 = "";
      |SI #0#32 = "L";
          |SI #10#46 [ 0;  |Y #576#36 = " "; #576#4 = "N";  |FINSI;
      |SINO;
          #576#4 = "N";
          |SI #10#46 > 0;
                                                   #576#4 = "I";
              |SI #0#35 = "A";    |Y #0#2 < 2013;  #576#4 = "A";  |FINSI;
              |SI #576#31 = "3";                   #576#4 = "U";  |FINSI;
          |FINSI;
          |SI #10#46 < 0; |Y #10#2 ! 4; #576#4 = "B";  |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2008_04;
     |SI #0#32 = "L";
         aAbre = "\MODELOS\130\" + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#32 = "F";
         aAbre = eaInternet + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #576;

     #576#1   = "130";
     #576#2   = "01";
     #576#3   = "";

     #576#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     aAlfa    = #2#1;  |QBF aAlfa;
     #576#6   = ("000000000" + aAlfa) % -109;
     #576#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #576#8   = eaAlfa;
     #576#9   = ".";

     #576#10  = #0#2;
     #576#11  = #0#4 + "T";

     enNume  = #10#8;           |HAZ Conver13;  #576#12 = eaAlfa;
     enNume  = #10#8 - #10#22;  |HAZ Conver13;  #576#13 = eaAlfa;
     enNume  = #10#22;          |HAZ Conver13;  #576#14 = eaAlfa;

     nEl27   = 0;
     |SI #10#27 > 0;
         enNume  = #10#27;      |HAZ Conver13;  #576#15 = eaAlfa;
         nEl27   = #10#27;
     |FINSI;

     enNume  = #10#28;                    |HAZ Conver13;  #576#16 = eaAlfa;
     enNume  = #10#25;                    |HAZ Conver13;  #576#17 = eaAlfa;
     enNume  = nEl27 - #10#28 - #10#25;   |HAZ Conver13;  #576#18 = eaAlfa;

     enNume  = #10#30;                    |HAZ Conver13;  #576#19 = eaAlfa;
     enNume  = #10#31;                    |HAZ Conver13;  #576#20 = eaAlfa;
     enNume  = #10#36;                    |HAZ Conver13;  #576#21 = eaAlfa;
     enNume  = #10#31 - #10#36;           |HAZ Conver13;  #576#22 = eaAlfa;

     enNume  = #10#29;                    |HAZ Conver13;  #576#23 = eaAlfa; ||[12]

     enNume  = #10#41;                    |HAZ Conver13;  #576#24 = eaAlfa; ||[13]
     enNume  = #10#42;                    |HAZ Conver13;  #576#25 = eaAlfa; ||[14]
     enNume  = #10#43;                    |HAZ Conver13;  #576#26 = eaAlfa; ||[15]
     enNume  = #10#44;                    |HAZ Conver13;  #576#27 = eaAlfa; ||[16]
     enNume  = #10#45;                    |HAZ Conver13;  #576#28 = eaAlfa; ||[17]
     enNume  = #10#46;                    |HAZ Conver13;  #576#29 = eaAlfa; ||[18]

     |HAZ TDeclaracion_2008_04;

     |SI #10#38 = "S";
         #576#37 = #10#40;
         #576#38 = #10#39;
     |FINSI;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #576#39  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #576#40  = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #576#45 = eaAlfa;
     #576#46 = eaDiaB;
     #576#47 = eaMesB;
     #576#48 = eaAnyoB;
     #576#49 = &13 + &10;

     |SI #0#32 = "L";
         #576#7  = "";
         #576#37 = "";
         #576#39 = "";
         #576#40 = "";
         #576#41 = "";
         #576#42 = "";
         #576#43 = "";
         #576#44 = "";
         nTCampo = 49;
     |FINSI;

     |SI #0#32 = "F";
         #576#2  = "";
         #576#3  = "";
         #576#5  = "";
         #576#45 = "";
         #576#46 = "";
         #576#47 = "";
         #576#48 = "";
         #576#49 = "";
         nTCampo = 48;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #576nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#32 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO TDeclaracion_2009;
     |SI #10#46 > 0;
         enNume = #10#46;  |HAZ Conver13;  #593#31 = eaAlfa;

         |SI #0#35 = "S";  |O #0#35 = "D";
             |SI #5#5 = "          ";
                  #593#32 = "1";
             |SINO;
                  #593#32 = "2";
                  |SI #0#32 = "F"; |Y #0#35 = "D";
                      #593#32 = "3";
                  |FINSI;
                  #593#33 = #5#2;            || entidad
                  #593#34 = #5#3;            || oficina
                  #593#35 = #5#4;            || DC
                  #593#36 = #5#5;           || cuenta
             |FINSI;
         |SINO;
             #593#32 = "1";
         |FINSI;
      |SINO;
         enNume  = 0;  |HAZ Conver13;  #593#31 = eaAlfa;
                                       #593#32 = "0";
         |SI #10#46 < 0; |Y #10#2 ! 4; #593#37 = "X"; |FINSI;  || hasta que salga el 4
      |FINSI;

      #593#4 = "";
      |SI #0#32 = "L";
          |SI #10#46 [ 0;  |Y #593#37 = " "; #593#4 = "N";  |FINSI;
      |SINO;
          #593#4 = "N";
          |SI #10#46 > 0;
                                                  #593#4 = "I";
              |SI #0#35   = "A";  |Y #0#2 < 2013; #593#4 = "A";  |FINSI;
              |SI #593#32 = "3";                  #593#4 = "U";  |FINSI;
          |FINSI;
          |SI #10#46 < 0; |Y #10#2 ! 4; #593#4 = "B";  |FINSI;
      |FINSI;
|FPRC;

|PROCESO Carga130_2009;
     |SI #0#32 = "L";
         aAbre = "\MODELOS\130\" + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |SI #0#32 = "F";
         aAbre = eaInternet + "130" + (("00000" + #2#0) % -105) + ".TXT";
         |XABRE "CBW", aAbre, nHandle2;
     |FINSI;

     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #593;

     #593#1   = "130";
     #593#2   = "01";
     #593#3   = "";

     #593#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     aAlfa    = #2#1;  |QBF aAlfa;
     #593#6   = ("000000000" + aAlfa) % -109;
     #593#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #593#8   = eaAlfa;
     #593#9   = ".";

     #593#10  = #0#2;
     #593#11  = #0#4 + "T";

     enNume  = #10#8;           |HAZ Conver13;  #593#12 = eaAlfa;
     enNume  = #10#8 - #10#22;  |HAZ Conver13;  #593#13 = eaAlfa;
     enNume  = #10#22;          |HAZ Conver13;  #593#14 = eaAlfa;

     nEl27   = 0;
     |SI #10#27 > 0;
         enNume  = #10#27;      |HAZ Conver13;  #593#15 = eaAlfa;
         nEl27   = #10#27;
     |FINSI;

     enNume  = #10#28;                    |HAZ Conver13;  #593#16 = eaAlfa;
     enNume  = #10#25;                    |HAZ Conver13;  #593#17 = eaAlfa;
     enNume  = nEl27 - #10#28 - #10#25;   |HAZ Conver13;  #593#18 = eaAlfa;
     enPago  = nEl27 - #10#28 - #10#25;
     |SI enPago < 0; enPago = 0; |FINSI;

     enNume  = #10#30;                    |HAZ Conver13;  #593#19 = eaAlfa;
     enNume  = #10#31;                    |HAZ Conver13;  #593#20 = eaAlfa;
     enNume  = #10#36;                    |HAZ Conver13;  #593#21 = eaAlfa;
     enNume  = #10#31 - #10#36;           |HAZ Conver13;  #593#22 = eaAlfa;

     enNume  = #10#29;                    |HAZ Conver13;  #593#23 = eaAlfa; ||[12]

     enNume  = #10#41;                    |HAZ Conver13;  #593#24 = eaAlfa; ||[13]
     enNume  = #10#42;                    |HAZ Conver13;  #593#25 = eaAlfa; ||[14]
     enNume  = #10#43;                    |HAZ Conver13;  #593#26 = eaAlfa; ||[15]
     enNume  = #10#47;                    |HAZ Conver13;  #593#27 = eaAlfa; ||[16]
     enNume  = #10#44;                    |HAZ Conver13;  #593#28 = eaAlfa; ||[16]
     enNume  = #10#45;                    |HAZ Conver13;  #593#29 = eaAlfa; ||[17]
     enNume  = #10#46;                    |HAZ Conver13;  #593#30 = eaAlfa; ||[18]

     |HAZ TDeclaracion_2009;

     |SI #10#38 = "S";
         #593#38 = #10#40;
         #593#39 = #10#39;
     |FINSI;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #593#40  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #593#41  = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #593#46 = eaAlfa;
     #593#47 = eaDiaB;
     #593#48 = eaMesB;
     #593#49 = eaAnyoB;
     #593#50 = &13 + &10;

     |SI #0#32 = "L";
         #593#7  = "";
         #593#38 = "";
         #593#40 = "";
         #593#41 = "";
         #593#42 = "";
         #593#43 = "";
         #593#44 = "";
         #593#45 = "";
         nTCampo = 50;
     |FINSI;

     |SI #0#32 = "F";
         #593#2  = "";
         #593#3  = "";
         #593#5  = "";
         #593#46 = "";
         #593#47 = "";
         #593#48 = "";
         #593#49 = "";
         #593#50 = "";
         nTCampo = 49;
     |FINSI;

     aAlfa = "";
     |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #593nCampo;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
     |XCIERRA nHandle2;

     |SI #0#32 = "L";
         |HAZ CargaImprime;
     |FINSI;

     nSwHay = 1;
|FPRC;

|PROCESO PorLaser;
     ya_esta = 1;
     si_hay  = 0;

     |BUCLE eosactiv;

     |SI ya_esta = 0; |ACABA; |FINSI;

     |SI #0#33 ! "N";
         #2#0 = #10#0;
         |LEE 040#2=;                             || Lee empresas
         |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
     |FINSI;

     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;                             || Lee Hacienda
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #5#0 = #10#0;
     |LEE 040#5=;                             || Lee Bancos
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     |SI #10#32 = "S"; |Y #10#33 = 1;
         comunero = "COMUNIDAD DE BIENES " + #10#34 + " AL " + #10#35 + " %";
     |FINSI;

     |SI #10#32 = "S"; |Y #10#33 > 1;
         comunero = "COMUNIDADES DE BIENES";
     |FINSI;

     |SI #10#32 = "N"; comunero = ""; |FINSI;

     |SI #0#2 [ 2001;
         |SI #0#32 = "L";
             |HAZ Secuencial130;
         |SINO;
             nAnyo = #0#2;
             |HAZ Internet130;
         |FINSI;
     |FINSI;

     |SI #0#2 ] 2002;  |Y #0#2 [ 2006;
         |HAZ Carga130_2002;
     |FINSI;

     |SI #0#2 = 2007;
         |HAZ Carga130_2007;
     |FINSI;

     |SI #0#2 = 2008;
         |SI #0#4 ] 2;
             |HAZ Carga130_2008_04;
         |SINO;
             |HAZ Carga130_2007;
         |FINSI;
     |FINSI;

     |SI #0#2 ] 2009;
         |HAZ Carga130_2009;
     |FINSI;

     #10#4 = #0#6;
     |GRABA 140#10a;
     |LIBERA #10;

     |HAZ mante_trab;

     |ABRE #9;
     #9#0 = #2#0;
     |LIBERA #9;
     |LEE 140#9=;
     |SI FSalida = 0;
         #9#1 = #9#1 + 1;
         |GRABA 140#9a;
     |SINO;
         #9#0 = #2#0;
         #9#1 = 10;
         |GRABA 140#9n;
     |FINSI;
     |CIERRA #9;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 130;
     se_activ = #9#1;

     |SI #9#1 = 10; |BUCLE eossegui; |FINSI;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 130;
     se_activ = #9#1;
     se_impor = #10#29;
     se_fecha = #0#6;
     se_factu = "N";
     |HAZ seguimie;
     |HAZ AlAgicli;
|FPRC;

|PROCESO Elige;
     |SI #0#32 = "L"; |O #0#32 = "F";  |HAZ PorLaser;  |FINSI;
     |SI #0#32 ! "L"; |Y #0#32 ! "F";  |HAZ PorImpre;  |FINSI;
|FPRC;

|DEFBUCLE eosm3130;
     #10#1;
     5;
     DEmpre, 0, #0#4, nAnyo2D, "N";
     HEmpre, 9, #0#4, nAnyo2D, "N";
     be;
     NULL, Elige;
|FIN;

|PROCESO AlModelo;
     DEmpre = #2#0;
     HEmpre = #2#0;
     |BUCLE eosm3130;
|FPRC;

|DEFBUCLE eosclienN;
     #2#3;
     0;
     Vacio40, #0#0;
     LLeno40, #0#1;
     e;
     NULL, AlModelo;
|FIN;

|PROCESO mes;
     |SI mes = "01"; mes = "Enero     "; |FINSI;
     |SI mes = "02"; mes = "Febrero   "; |FINSI;
     |SI mes = "03"; mes = "Marzo     "; |FINSI;
     |SI mes = "04"; mes = "Abril     "; |FINSI;
     |SI mes = "05"; mes = "Mayo      "; |FINSI;
     |SI mes = "06"; mes = "Junio     "; |FINSI;
     |SI mes = "07"; mes = "Julio     "; |FINSI;
     |SI mes = "08"; mes = "Agosto    "; |FINSI;
     |SI mes = "09"; mes = "Septiembre"; |FINSI;
     |SI mes = "10"; mes = "Octubre   "; |FINSI;
     |SI mes = "11"; mes = "Noviembre "; |FINSI;
     |SI mes = "12"; mes = "Diciembre "; |FINSI;

     mes = mes > mes;
|FPRC;

|PROCESO Impresora;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #0#32 = "O";
         |INFOR "m130h001";
         |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
         |HAZ i_cuadre;
     |SINO;
         |SI #0#2 ] 2009;
             |INFOR "m130h004";
         |FINSI;

         |SI #0#2 [ 2007;
             |INFOR "m130h002";
         |FINSI;

         |SI #0#2 = 2008;
             |SI #0#4 ] 2;
                 |INFOR "m130h003";
             |SINO;
                 |INFOR "m130h002";
             |FINSI;
         |FINSI;

         |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
     |FINSI;

     dia = #0#6 % 102;
     mes = #0#6 % 402;
     |HAZ mes;
     anyo = #0#6 % 704;

     DEmpre = #0#0;
     HEmpre = #0#1;

     |ABRE #3;
     |ABRE #5;

     |SI #0#33 = "N";
         |BUCLE eosclienN;
     |SINO;
         |ABRE #2;
         |SI #0#7 = "S";
             |BUCLE eosm3130;
         |SINO;
             |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
                   |SI #0x ! 0;
                       DEmpre = #0x;
                       HEmpre = #0x;
                       |BUCLE eosm3130;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |CIERRA #2;
     |FINSI;
     |FININF;
     |FINIMP;

     |CIERRA #3;
     |CIERRA #5;
|FPRC;

|PROCESO AbreImprime;
     aAbre = "\MODELOS\130\imprime.bat";
     |XABRE "CBW", aAbre, nHandle1;

     aAlfa = "CD \" + &13 + &10;                 |XGRABA nHandle1, aAlfa;
     aAlfa = "CD MODELOS" + &13 + &10;           |XGRABA nHandle1, aAlfa;
     aAlfa = "CD 130" + &13 + &10;               |XGRABA nHandle1, aAlfa;

     aAlfa = #0#2;
     aAlfa = aAlfa % -102;
     aVersion = "";

     |SI #0#2 ] 2008;
         aVersion = "01";
         |SI #0#2 = 2008;
             |SI #0#4 ] 2;
                 aVersion = "02";
             |FINSI;
         |FINSI;
     |FINSI;

     aAlfa1 = "DEL ERRORES.RST" + &13 + &10;      |XGRABA nHandle1, aAlfa1;

     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     aUnidad = (aContiene1 % 102) > "";

     |SI aVersion = "";
         aAlfa = "ZLS" + aAlfa + "MPF.EXE /T:" + aUnidad + "\MODELOS\130\"+ &13 + &10;
     |SINO;
         aAlfa = "Z" + aAlfa + aVersion + "MPF.EXE /T:" + aUnidad + "\MODELOS\130\"+ &13 + &10;
     |FINSI;

     |XGRABA nHandle1, aAlfa;

     |SI #0#2 ] 2002;
         aAlfa = "MOVE ERRORM~1.TXT ERRORMIPF.TXT" + &13 + &10;      |XGRABA nHandle1, aAlfa;
         aAlfa = "MOVE EAN128~1.DLL EAN128_32.DLL" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     aAlfa = "DEL *.wmf" + &13 + &10;             |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.tab"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.dll"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errorm~1.txt" + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errormipf.txt"  + &13 + &10;    |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL errmipf.txt"  + &13 + &10;      |XGRABA nHandle1, aAlfa;
     aAlfa = "DEL *.exe"  + &13 + &10;            |XGRABA nHandle1, aAlfa;
     |XCIERRA nHandle1;

     eaModelos = "130";   |HAZ Copiampf;

     aAlfa = "\MODELOS\130\IMPRIME";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO Laser;
     |SI #0#2 ] 2002;
         |SI #0#32 = "L";
             |PARA;  |SI;  |HACIENDO;
                  |DDEFECTO #601;
                  |PINPA #0#601;
                  |PINDA #0#601;
                  |ENDATOS #1#601;
                  |SI FSalida = 0;
                      aAlfa = "/MODELOS";          |RMKDIR aAlfa;
                      aAlfa = "/MODELOS/130";      |RMKDIR aAlfa;
                      |HAZ AbreImprime;
                      |SAL;
                  |FINSI;
             |SIGUE;
         |FINSI;

         |SI #0#32 = "F";
             aAlfa      = "/AEAT";                       |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET";              |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/130";          |RMKDIR aAlfa;
             aAlfa      = "/AEAT/INTERNET/130/" + #0#2;  |RMKDIR aAlfa;
             eaInternet = aAlfa + "/";
         |FINSI;
     |FINSI;

     nSwHay = 0;
     dia = #0#6 % 102;
     mes = #0#6 % 402;
     |HAZ mes;

     |SI #0#2 [ 1998;
         anyo = #0#6 % -101;
     |SINO;
         anyo = #0#6 % -104;
     |FINSI;

     DEmpre = #0#0;
     HEmpre = #0#1;

     |ABRE #3;
     |ABRE #5;

     |SI #0#33 = "N";
         |BUCLE eosclienN;
     |SINO;
         |ABRE #2;
         |SI #0#7 = "S";
             |BUCLE eosm3130;
         |SINO;
             |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
                   |SI #0x ! 0;
                       DEmpre = #0x;
                       HEmpre = #0x;
                       |BUCLE eosm3130;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |CIERRA #2;
     |FINSI;

     |CIERRA #3;
     |CIERRA #5;

     |SI #0#32 = "L";
         |SI #0#2 [ 2001;
             |HAZ GrabaDisketteL;
         |FINSI;

         |SI #0#2 ] 2002;
             |SI nSwHay = 1;
                 |HAZ EmiteEsto;
                 eaTipoEmi = "ERRORES";
                 enAnyo    = #0#2;
                 |SUB_EJECUTA "eosz9999";
             |SINO;
                 |MENAV "     Seleccion Vacia";
                 |XCIERRA nHandle1;
             |FINSI;

             aAlfa = "\MODELOS\130\imprime.bat";
             |RFBORRA aAlfa;
        |FINSI;
     |FINSI;

     |SI #0#32 = "F";  |Y #0#2 ] 2002;
         |SI nSwHay = 1;
             aAlfa =  "      Ficheros Generados. Situados en " + eaInternet + " de su PC";
             |MENAV aAlfa;
         |SINO;
             |MENAV "     Seleccion Vacia";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloque2012;
     |SI #0#32 = "L"; |O #0#32 = "F";  |HAZ Laser;      |FINSI;
     |SI #0#32 ! "L"; |Y #0#32 ! "F";  |HAZ Impresora;  |FINSI;

     |DELINDEX #9;
|FPRC;
|| -------------------------------------------------------------------------

|PROCESO Carga130_2013;
     |ABRE #50;
     #50#0 = #2#0;
     |LEE 000#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;

     |DDEFECTO #593;

     #593#1   = "130";
     #593#2   = "01";
     #593#3   = "";

     #593#5   = (("00" + #3#0) % -102) + (("000" + #3#1) % -103);
     aAlfa    = #2#1;  |QBF aAlfa;
     #593#6   = ("000000000" + aAlfa) % -109;
     #593#7   = #50#2;
     eaAlfa   = #2#2;    |HAZ QuitaRaros;     #593#8   = eaAlfa;
     #593#9   = ".";

     #593#10  = #0#2;
     #593#11  = #0#4 + "T";

     enNume  = #10#8;           |HAZ Conver13;  #593#12 = eaAlfa;
     enNume  = #10#8 - #10#22;  |HAZ Conver13;  #593#13 = eaAlfa;
     enNume  = #10#22;          |HAZ Conver13;  #593#14 = eaAlfa;

     nEl27   = 0;
     |SI #10#27 > 0;
         enNume  = #10#27;      |HAZ Conver13;  #593#15 = eaAlfa;
         nEl27   = #10#27;
     |FINSI;

     enNume  = #10#28;                    |HAZ Conver13;  #593#16 = eaAlfa;
     enNume  = #10#25;                    |HAZ Conver13;  #593#17 = eaAlfa;
     enNume  = nEl27 - #10#28 - #10#25;   |HAZ Conver13;  #593#18 = eaAlfa;
     enPago  = nEl27 - #10#28 - #10#25;
     |SI enPago < 0; enPago = 0; |FINSI;

     enNume  = #10#30;                    |HAZ Conver13;  #593#19 = eaAlfa;
     enNume  = #10#31;                    |HAZ Conver13;  #593#20 = eaAlfa;
     enNume  = #10#36;                    |HAZ Conver13;  #593#21 = eaAlfa;
     enNume  = #10#31 - #10#36;           |HAZ Conver13;  #593#22 = eaAlfa;

     enNume  = #10#29;                    |HAZ Conver13;  #593#23 = eaAlfa; ||[12]

     enNume  = #10#41;                    |HAZ Conver13;  #593#24 = eaAlfa; ||[13]
     enNume  = #10#42;                    |HAZ Conver13;  #593#25 = eaAlfa; ||[14]
     enNume  = #10#43;                    |HAZ Conver13;  #593#26 = eaAlfa; ||[15]
     enNume  = #10#47;                    |HAZ Conver13;  #593#27 = eaAlfa; ||[16]
     enNume  = #10#44;                    |HAZ Conver13;  #593#28 = eaAlfa; ||[16]
     enNume  = #10#45;                    |HAZ Conver13;  #593#29 = eaAlfa; ||[17]
     enNume  = #10#46;                    |HAZ Conver13;  #593#30 = eaAlfa; ||[18]

     |HAZ TDeclaracion_2009;

     |SI #10#38 = "S";
         #593#38 = #10#40;
         #593#39 = #10#39;
     |FINSI;

     eaAlfa  = #2#2;     |HAZ QuitaRaros;     #593#40  = eaAlfa;
     eaAlfa  = #2#14;    |HAZ QuitaRarosTfno; #593#41  = eaAlfa;

     eaAlfa  = #0#6;     |HAZ FechaBonito;
     eaAlfa  = #2#13;    |HAZ QuitaRaros;     #593#46 = eaAlfa;
     #593#47 = eaDiaB;
     #593#48 = eaMesB;
     #593#49 = eaAnyoB;
     #593#50 = &13 + &10;

     |SI nTecla = 1;
         #593#7  = "";
         #593#38 = "";
         #593#40 = "";
         #593#41 = "";
         #593#42 = "";
         #593#43 = "";
         #593#44 = "";
         #593#45 = "";
         nTCampo = 50;
     |FINSI;

     |SI nTecla = 3;
         #593#2  = "";
         #593#3  = "";
         #593#5  = "";
         #593#46 = "";
         #593#47 = "";
         #593#48 = "";
         #593#49 = "";
         #593#50 = "";
         nTCampo = 49;
     |FINSI;

     |SI nTecla ! 4;
         aAlfa = "";
         |PARA nCampo = 1;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aAlfa = #593nCampo;
               |XGRABA nHandle2, aAlfa;
         |SIGUE;
     |SINO;
         |PRINT;
         |PIEINF;
     |FINSI;
     nSwHay = 1;
|FPRC;

|PROCESO eosm3130_2013;
     ya_esta = 1;
     si_hay  = 0;

     |BUCLE eosactiv;

     |SI ya_esta = 0; |ACABA; |FINSI;

     |SI #0#33 ! "N";
         #2#0 = #10#0;
         |LEE 040#2=;                             || Lee empresas
         |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
     |FINSI;

     #3#0 = #2#18; #3#1 = #2#19;
     |LEE 040#3=;                             || Lee Hacienda
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     #5#0 = #10#0;
     |LEE 040#5=;                             || Lee Bancos
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     |SI #10#32 = "S"; |Y #10#33 = 1;
         comunero = "COMUNIDAD DE BIENES " + #10#34 + " AL " + #10#35 + " %";
     |FINSI;

     |SI #10#32 = "S"; |Y #10#33 > 1;
         comunero = "COMUNIDADES DE BIENES";
     |FINSI;

     |SI #10#32 = "N"; comunero = ""; |FINSI;

     eaFicheroPlano = "130" + (("00000" + #2#0) % -105) + ".txt";
     eaFicheroImpre = "130" + (("00000" + #2#0) % -105) + ".pdf";
     eaFicheroError = "err" + (("00000" + #2#0) % -105) + ".txt";

     aAlfa = eaPathLanza + eaFicheroPlano;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroImpre;  |RFBORRA aAlfa;
     aAlfa = eaPathLanza + eaFicheroError;  |RFBORRA aAlfa;

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     |HAZ Carga130_2013;

     |XCIERRA nHandle2;

     |SI #0#32 ! "B";
         #10#4 = #0#6;
         |GRABA 140#10a;
     |FINSI;
     |LIBERA #10;

     |HAZ mante_trab;

     |ABRE #9;
     #9#0 = #2#0;
     |LIBERA #9;
     |LEE 140#9=;
     |SI FSalida = 0;
         #9#1 = #9#1 + 1;
         |GRABA 140#9a;
     |SINO;
         #9#0 = #2#0;
         #9#1 = 10;
         |GRABA 140#9n;
     |FINSI;
     |CIERRA #9;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 130;
     se_activ = #9#1;

     |SI #9#1 = 10; |BUCLE eossegui; |FINSI;

     aAlfa    = #0#2 % -102;
     se_empre = #2#0;
     se_ejerc = aAlfa;
     se_perio = #0#4;
     se_tipos = 130;
     se_activ = #9#1;
     se_impor = #10#29;
     se_fecha = #0#6;
     se_factu = "N";
     |HAZ seguimie;
     |HAZ AlAgicli;

     enEmpresa    = #2#0;
     eaNomEmpresa = #2#1;

     |SI enTecla = 3;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroIP;

         |ACABA;
     |FINSI;

     |HAZ PresentaMPF;
|FPRC;

|DEFBUCLE eosm3130_2013;
     #10#1;
     5;
     DEmpre, 0, #0#4, nAnyo2D, "N";
     HEmpre, 9, #0#4, nAnyo2D, "N";
     be;
     NULL, eosm3130_2013;
|FIN;

|PROCESO AlModelo2013;
     DEmpre = #2#0;
     HEmpre = #2#0;
     |BUCLE eosm3130_2013;
|FPRC;

|DEFBUCLE eosclienN_2013;
     #2#3;
     0;
     Vacio40, #0#0;
     LLeno40, #0#1;
     e;
     NULL, AlModelo2013;
|FIN;

|PROCESO Bloque2013;
     |HAZ LeeUnidad;
     eaModelos  = "130";
     eaPeriodo  = ("00" + enPeriodo) % -102;
     |SI #0#4 = 1; perialf = "1T"; |FINSI;
     |SI #0#4 = 2; perialf = "2T"; |FINSI;
     |SI #0#4 = 3; perialf = "3T"; |FINSI;
     |SI #0#4 = 4; perialf = "4T"; |FINSI;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + perialf;      |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + perialf;     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + perialf;    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";


     |SI #0#32 ! "B";
         |HAZ BotonesMPF;
     |SINO;
         enTecla = 4;
     |FINSI;
     nTecla = enTecla;
     |SI nTecla = 0;  |ACABA;  |FINSI;

     |SI nTecla = 4;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "m130co05";

         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
     |FINSI;

     nSwHay = 0;
     dia = #0#6 % 102;
     mes = #0#6 % 402;
     |HAZ mes;
     anyo = #0#6 % -104;

     DEmpre = #0#0;
     HEmpre = #0#1;

     |ABRE #3;
     |ABRE #5;

     |SI #0#33 = "N";
         |BUCLE eosclienN_2013;
     |SINO;
         |ABRE #2;
         |SI #0#7 = "S";
             |BUCLE eosm3130_2013;
         |SINO;
             |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
                   |SI #0x ! 0;
                       DEmpre = #0x;
                       HEmpre = #0x;
                       |BUCLE eosm3130_2013;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |CIERRA #2;
     |FINSI;
     |CIERRA #3;
     |CIERRA #5;

     |SI nTecla ! 4;
         |HAZ SacaErrorPtl;

         |SI eaOpcion = "3"; |Y nSwHay ! 0;
             |SI enPresentar = 0;
                 aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
                 |MENAV aAlfa;
             |FINSI;
         |FINSI;
     |SINO;
         |FININF;
         |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     aAlfa     = #0#2 % -102;
     nAnyo2D   = aAlfa;
     enAnyo    = #0#2;
     eaEjer    = #0#2;
     enPeriodo = #0#4;
     enPer     = #0#4;

     eaTipoSec = "130";
     |SI #0#32 = "O";  #0#32 = "F"; |FINSI;

|| \\\\\ Especial Modelo 130 . Reduc. creacion empleo 2015 ////////
     |SI #0#2 = 2015;
         enModelo = 130;
         aAlfa = "eosy0092;MASIVO";
         |SUB_EJECUTA aAlfa;
         |SI enError15 = 1;
             |CONFI "0000NDesea Continuar";
             |SI FSalida ! 0;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0#2 [ 2014;
         comienza = "09";
         |HAZ fichero;
         |NOME_DAT #9 fichero;
         |DELINDEX #9;
     |FINSI;

     aTipoSec = "130";

     |SI #0#2 [ 2012;
         |HAZ Bloque2012;
         |ACABA;
     |FINSI;

     |SI #0#2 [ 2014; |O #0#32 = "B";
         |HAZ Bloque2013;
         |DELINDEX #9;
         |ACABA;
     |FINSI;

     |GRABA 020#eosem130.n;
     |LIBERA #eosem130;

     |SUB_EJECUTA "dsmoy130";
|FPRC;

|PROGRAMA;
     aFichero = "eosem130" + Usuario;
     |NOME_DAT #eosem130#aFichero#;
     |ABRE #eosem130;  |CIERRA #eosem130;  |DELINDEX #eosem130;

     |ABRE #eosem130;

     eaTipoSec = "130";

     |CLS;
     |CABEZA "      Emision Modelo 130";
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |CIERRA #eosem130;  |DELINDEX #eosem130;
|FPRO;
