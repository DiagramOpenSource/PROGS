|FICHEROS;
     eoszp024 #0;
     eosactiv #1;
     eoslinco #2;
     eosirpf1 #3;
     eosclpre #4;
     eosclien #5;
     eosconce #6;
     eosconc6 #16;
     eosw0025 #25;
|FIN;

|VARIABLES;
     nSwBorra  = 0;
     nTipoArre = 0;
     nLinea    = 0;
     nCampo    = 0;
     FEstado   = 0;
     campo1    = 0;
     campo2    = 0;
     fecha     = @;
     alfa1     = "";
     alfa2     = "";
     xxx       = 0;
     yyy       = 0;
     n_nom1    = "";
     n_nom2    = "";
     n_nom     = "";
     empresa   = 0;
     actividad = 0;
     aPasar1   = "";
     aPasar2   = "";
     aPasar3   = "";
     nTipo1    = 0;
     nTipo2    = 0;
     nTipo3    = 0;
|FIN;

|INCLUYE i_consul;
|INCLUYE i_ficher;

|PROCESO Concepto2; |TIPO 0;
     |SI #0Campo = 0; |ACABA; |FINSI;

     |ABRE #6;
     #6#0 = #0Campo;
     |LEE 040#6=;
     |SI FSalida ! 0;
         |MENAV "       No existe Concepto 2 Digitos.";
         |ERROR;
         |CIERRA #6;
         |ACABA;
     |FINSI;
     |CIERRA #6;

     |SI #6#10 ! "S";
          |MENAV "       El Concepto no tiene permiso de pasar el IRPF.";
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO Concepto6; |TIPO 0;
     |SI #0Campo = "      "; |ACABA; |FINSI;

     |ABRE #16;
     #16#0 = #0Campo;
     |LEE 040#16=;
     |SI FSalida ! 0;
         |MENAV "       No existe Concepto 6 Digitos.";
         |ERROR;
         |CIERRA #16;
         |ACABA;
     |FINSI;
     |CIERRA #16;

     |SI #16#10 ! "S";
          |MENAV "       El Concepto no tiene permiso de pasar el IRPF.";
          |ERROR;
          |ACABA;
      |FINSI;
|FPRC;

|PROCESO ejercicio; |TIPO 7;
     fecha = ~;
     alfa1 = fecha % -102;         #0#40 = alfa1;   |PINTA #0#40;
     alfa2 = "01.01.19" + alfa1;   #0#41 = alfa2;   |PINTA #0#41;
     alfa2 = "31.12.19" + alfa1;   #0#42 = alfa2;   |PINTA #0#42;
|FPRC;

|PROCESO activi; |TIPO 0;
     campo1 = Campo - 20;

     |SI #0campo1 = 0; |Y #0Campo = 0; |ACABA; |FINSI;

     |ABRE #1;
     #1#0 = #0campo1;
     #1#1 = #0Campo;
     #1#2 = #0#40;
     |LEE 040#1=;
     FEstado = FSalida;
     |CIERRA #1;

     |SI FEstado ! 0;
         |MENAV "     No existe la Actividad.";
         #0campo1 = 0; |PINTA #0campo1;
         #0Campo  = 0; |PINTA #0Campo;
         |PTEC 808;
         |PTEC 808;
         |ACABA;
     |FINSI;

     |SI #1#17 = "R";
         |MENAV "     La Actividad no tiene Retenciones.";
         #0campo1 = 0; |PINTA #0campo1;
         #0Campo  = 0; |PINTA #0Campo;
         |PTEC 808;
         |PTEC 808;
     |FINSI;
|FPRC;

|PROCESO GrabaW0025;
     #25#0  = #2#3;
     #25#26 = nTipoArre;
     #25#27 = #0xxx;
     |LIBERA #25;
     |LEE 140#25=;
     FEstado = FSalida;
     |SI FSalida ! 0; |DDEFECTO #25; |FINSI;

     #25#0  = #2#3;
     #25#26 = nTipoArre;
     #25#27 = #0xxx;
     alfa1  = #2#13 % 0402;
     campo1 = alfa1;
     campo2 = campo1 + 12;

     |SI nLinea = 1;
         |SI nTipo1 = 2;
             #25campo1  = #25campo1 + #2#7 + #2#9 + #2#11;
         |SINO;
             #25campo1  = #25campo1 + #2#7;
         |FINSI;
         #25campo2  = #25campo2 + #2#42;
     |FINSI;

     |SI nLinea = 2;
         |SI nTipo2 = 2;
             #25campo1  = #25campo1 + #2#23 + #2#27 + #2#31;
         |SINO;
             #25campo1  = #25campo1 + #2#23;
         |FINSI;
         #25campo2 = #25campo2 + #2#43;
     |FINSI;

     |SI nLinea = 3;
         |SI nTipo3 = 2;
             #25campo1  = #25campo1 + #2#24 + #2#28 + #2#32;
         |SINO;
             #25campo1  = #25campo1 + #2#24;
         |FINSI;
         #25campo2 = #25campo2 + #2#44;
     |FINSI;

     |SI FEstado ! 0; |GRABA 140#25n; |SINO; |GRABA 140#25a; |FINSI;
|FPRC;

|PROCESO GrabaTempo;
     |SI #2#39 = 0; |Y #2#40 = 0; |Y #2#41 = 0; |ACABA; |FINSI;

     #1#0 = #2#0;
     #1#1 = #2#19;
     #1#2 = #2#14;
     |LEE 040#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;

     |SI #1#50 = 1;
         |SI #2#39 ! 0;
             #6#0 = #2#5;
             |LEE 040#6=;
             |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

             nLinea    = 1;
             nTipoArre = 1;
             |PARA nCampo = 43;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #6#0; |Y #0nCampo ! 0;
                       |SI #6#10  = "S";
                           nTipo1 = #6#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             nTipoArre = 2;
             |PARA nCampo = 49;  |SI nCampo [ 54;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #6#0; |Y #0nCampo ! 0;
                       |SI #6#10  = "S";
                           nTipo1 = #6#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #2#40 ! 0;
             #6#0 = #2#33;
             |LEE 040#6=;
             |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

             nLinea    = 2;
             nTipoArre = 1;
             |PARA nCampo = 43;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #6#0; |Y #0nCampo ! 0;
                       |SI #6#10  = "S";
                           nTipo1 = #6#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             nTipoArre = 2;
             |PARA nCampo = 49;  |SI nCampo [ 54;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #6#0; |Y #0nCampo ! 0;
                       |SI #6#10  = "S";
                           nTipo1 = #6#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #2#41 ! 0;
             #6#0 = #2#34;
             |LEE 040#6=;
             |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

             nLinea    = 3;
             nTipoArre = 1;
             |PARA nCampo = 43;  |SI nCampo [ 48;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #6#0; |Y #0nCampo ! 0;
                       |SI #6#10  = "S";
                           nTipo1 = #6#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             nTipoArre = 2;
             |PARA nCampo = 49;  |SI nCampo [ 54;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #6#0; |Y #0nCampo ! 0;
                       |SI #6#10  = "S";
                           nTipo1 = #6#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |SINO;
         |SI #2#39 ! 0;
             #16#0 = #2#72;
             |LEE 040#16=;
             |SI FSalida ! 0; |DDEFECTO #16; |FINSI;

             nLinea    = 1;
             nTipoArre = 1;
             |PARA nCampo = 55;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #16#0; |Y #0nCampo ! "      ";
                       |SI #16#10  = "S";
                           nTipo1 = #16#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             nTipoArre = 2;
             |PARA nCampo = 61;  |SI nCampo [ 66;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #16#0; |Y #0nCampo ! "      ";
                       |SI #16#10  = "S";
                           nTipo1 = #16#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #2#40 ! 0;
             #16#0 = #2#73;
             |LEE 040#16=;
             |SI FSalida ! 0; |DDEFECTO #16; |FINSI;

             nLinea    = 2;
             nTipoArre = 1;
             |PARA nCampo = 55;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #16#0; |Y #0nCampo ! "     ";
                       |SI #16#10  = "S";
                           nTipo1 = #16#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             nTipoArre = 2;
             |PARA nCampo = 61;  |SI nCampo [ 66;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #16#0; |Y #0nCampo ! "     ";
                       |SI #16#10  = "S";
                           nTipo1 = #16#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;

         |SI #2#41 ! 0;
             #16#0 = #2#74;
             |LEE 040#16=;
             |SI FSalida ! 0; |DDEFECTO #16; |FINSI;

             nLinea    = 3;
             nTipoArre = 1;
             |PARA nCampo = 55;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #16#0; |Y #0nCampo ! 0;
                       |SI #16#10  = "S";
                           nTipo1 = #16#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;

             nTipoArre = 2;
             |PARA nCampo = 61;  |SI nCampo [ 66;  |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo = #16#0; |Y #0nCampo ! 0;
                       |SI #16#10  = "S";
                           nTipo1 = #16#9;
                           |HAZ GrabaW0025;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE eoslinco;
     #2#2;
     ;
     empresa, #0#40, 1, actividad, #0#41, 00000;
     empresa, #0#40, 4, actividad, #0#42, 32000;
     e;
     NULL, GrabaTempo;
|FIN;

|PROCESO Letra1;
     #3#12 = #25#26;
     #3#35 = 0;
     #3#48 = 0;
     |PARA campo1   = 23; |SI campo1 [ 34; |HACIENDO campo1 = campo1 + 1;
           campo2   = campo1 - 22;
           #3campo1 = #25campo2;
           #3#35    = #3#35 + #3campo1;
     |SIGUE;

     |PARA campo1   = 36; |SI campo1 [ 47; |HACIENDO campo1 = campo1 + 1;
           campo2   = campo1 - 23;
           #3campo1 = #25campo2;
           #3#48    = #3#48 + #3campo1;
     |SIGUE;
|FPRC;

|PROCESO Letra2;
     #3#13 = #25#26;
     #3#61 = 0;
     #3#74 = 0;
     |PARA campo1   = 49; |SI campo1 [ 60; |HACIENDO campo1 = campo1 + 1;
           campo2   = campo1 - 48;
           #3campo1 = #25campo2;
           #3#61    = #3#61 + #3campo1;
     |SIGUE;

     |PARA campo1   = 62; |SI campo1 [ 73; |HACIENDO campo1 = campo1 + 1;
           campo2   = campo1 - 49;
           #3campo1 = #25campo2;
           #3#74    = #3#74 + #3campo1;
     |SIGUE;
|FPRC;

|PROCESO YaExiste;
    |SI #3#12 = #25#26; |HAZ Letra1;  |ACABA;  |FINSI;
    |SI #3#13 = #25#26; |HAZ Letra2;  |ACABA;  |FINSI;

    |SI #3#12 = " ";   |HAZ Letra1;  |ACABA; |FINSI;
    |SI #3#13 = " ";   |HAZ Letra2;  |ACABA; |FINSI;
|FPRC;

|PROCESO GrabaArrend;
     |SI nSwBorra = 0;
         #3#0 = #25#27;  #3#1 = #25#0;  #3#134 = #0#40; |BORRA 100#3c; |LIBERA #3;
         |ACABA;
     |FINSI;

     #4#0 = #25#27;
     #4#1 = #25#0;
     #4#2 = 2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;

     #5#0 = #25#27;
     |LEE 040#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     #3#0   = #25#27;
     #3#1   = #25#0;
     #3#134 = #0#40;
     |LIBERA #3;
     |LEE 140#3=;
     |SI FSalida ! 0;
         |DDEFECTO #3;
         #3#0   = #25#27;
         #3#1   = #25#0;
         #3#134 = #0#40;
         #3#2   = #5#3;
         #3#3   = #4#4;
         #3#4   = #4#13;
         #3#5   = #4#10;
         #3#6   = #4#11;
         #3#7   = #4#3;
         #3#9   = #4#15;
         #3#12  = #25#26;
         #3#127 = #4#6;
         #3#128 = #4#7;
         #3#130 = #4#8;
         #3#131 = #4#9;
         #3#132 = #4#12;
         #3#135 = 5;
         #3#35 = 0;
         #3#48 = 0;

         |PARA campo1   = 23; |SI campo1 [ 34; |HACIENDO campo1 = campo1 + 1;
               campo2   = campo1 - 22;
               #3campo1 = #25campo2;
               #3#35    = #3#35 + #3campo1;
         |SIGUE;

         |PARA campo1   = 36; |SI campo1 [ 47; |HACIENDO campo1 = campo1 + 1;
               campo2   = campo1 - 23;
               #3campo1 = #25campo2;
               #3#48    = #3#48 + #3campo1;
         |SIGUE;

         |GRABA 140#3n;
     |SINO;
         |HAZ YaExiste;
         |GRABA 140#3a;
     |FINSI;
|FPRC;

|DEFBUCLE eosw0025;
     #25#1;
     ;
     00000, 00000, 1, " ";
     99999, 99999, 2, "z";
     ;
     NULL, GrabaArrend;
|FIN;

|PROCESO Ajugar;
     n_nom1  = ("00000" + #0xxx) % -105;
     n_nom2  = ("00" + #0#40) % -102;
     n_nom   = "c" + n_nom1 + n_nom2;
     |NOME_DAT #2 n_nom;

     empresa   = #0xxx;
     actividad = #0yyy;

     |ABRE #1;
     |ABRE #6;
     |ABRE #16;
     |ABRE #25;
     |BUCLE eoslinco;
     |CIERRA #1;
     |CIERRA #6;
     |CIERRA #16;
     |CIERRA #25;

|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     comienza = "25";
     |HAZ fichero;
     |NOME_DAT #25 fichero;
     |ABRE #25; |CIERRA #25; |DELINDEX #25;

     |PARA xxx = 0; |SI xxx [ 19; |HACIENDO xxx = xxx + 1;
           yyy = xxx + 20;
           |SI #0xxx ! 0; |O #0yyy ! 0;
               |HAZ Ajugar;
           |FINSI;
     |SIGUE;

     |ABRE #3;
     |ABRE #4;
     |ABRE #5;
     nSwBorra = 0; |BUCLE eosw0025;
     nSwBorra = 1; |BUCLE eosw0025;
     |CIERRA #3;
     |CIERRA #4;
     |CIERRA #5;

     |DELINDEX #25;
|FPRC;
