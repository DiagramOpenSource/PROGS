|FICHEROS;
     eosy0009;
     eosclien;
     eosdaban;
     eoshacie;
     eosm0014;
     eosm0030;
     eosm0036;
     dsmoy000;

     eosw0077,MANTE;
     dsmow596;
     dsmow613;
|FIN;

|VARIABLES;
     nPeriodo     = 0;
     nCampoD      = 0;
     Sw           = 0;
     aLLeno40     = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     aVacio40     = "                                        ";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";
     aAlfa5       = "";
     nSwLectura   = 0;
     aCadena      = "";
     aCaracter    = "";
     aLong        = "";
     nLong        = 0;
     nPos         = 0;
     aDComple     = " ";
     aHComple     = "z";
     aFichero     = "";
     SwError      = 0;
     nCanal       = 0;
     nTotalP      = 0;
     nContador    = 0;
     nSwError     = 0;
     aTipoP       = "";
     nNume        = 0;
     nDRegis      = 0;
     nHRegis      = 0;
     nSwDeDonde   = 0;
     nSwSecuen    = 0;
     nTecla       = 0;
     nBoton       = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;
     nBoton6      = 0;
     nHandle1     = 0;
     nHandle2     = 0;
     nHandle3     = 0;
     nHCampo      = 0;
     nCampo       = 0;

     aAbre        = "";
     aTercera     = "";
     aModelos     = "";
     aDig1        = "";
     aDig2        = "";
     aDig3        = "";
     aDig4        = "";
     aDig5        = "";
     aDig6        = "";
     aDig7        = "";
     aDig8        = "";
     aDig9        = "";
     aDig0        = "";
     aPathFich    = "";
     aPathPan     = "";
     aF2          = "";
     aF3          = "";
     aF4          = "";
     aF5          = "";
     aF6          = "";
     aF7          = "";
     aTecla       = "";
     aPathAfegir  = "";
     aOrigen      = "";
     aDestino     = "";
     aIPRemoto    = "";
     aPathInter   = "";
     aBue         = "";
     aJusti       = "";

     &enEjercic   = 0;
     &dia         = "";
     &mes         = "";
     &anyo        = "";
     &enTHojas    = 0;
     &eaMod       = "";
     &eaFOrigen   = "";
     &eaFDestino  = "";
     &eaFichDatos   = "";
     &eaFichAuxil   = "";
     &eaFichError   = "";
     &enBuenos      = 0;
     &enMalos       = 0;
     &enValidacion  = 0;
     &eaInternet    = "";

     &eaTipoE            = "";
     &eaTipoR            = "";
     &eaTipoP            = "";
     &eaTipoC            = "";
     &eaTipoA            = "";
     &eaTipoV            = "";
     &eaModoImpre        = "";
     &eaModelos          = "";
     &eaEjer             = "";
     &eaPeriodo          = "";
     &eaPathEmision      = "";
     &eaPathLanza        = "";
     &eaPathExplorador   = "";
     &eaPathInternet     = "";
     &eaFicheroPlano     = "";
     &eaOpcion           = "";
     &eaFicheroImpre     = "";
     &eaFicheroSalid     = "";
     &eaFicheroError     = "";
     &enEmpresa          = 0;
     &eaNomEmpresa       = "";
     &enPresentar        = 0;
     &enSinActividad     = 0;
     &enAnyo             = 0;
     &eaUnidad           = "";
     &enNume             = 0;
     &eaSigno            = "";
     &eaAlfa             = "";
|FIN;

|PROCESO QuitaComasy1009;
     eaAlfa = aAlfa;
     |HAZ QuitaRaritos;
     aAlfa  = eaAlfa;
|FPRC;

|PROCESO CogeJusti2016;
     |SI #eosm0030#19 = "N";
         aJusti = "1900000000000";
         |ACABA;
     |FINSI;

     aCadena = "";
     aAlfa   = #dsmow596#3;
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos      = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;

           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;  |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;  |FINSI;
     |SIGUE;

     aAlfa1  = #eosw0077#4;
     aAlfa2  = "0";
     |SI #eosw0077#19 ! " ";  aAlfa2  = "1";  |FINSI;

     aCadena = ((aCadena + "0000000") % 107) + (aAlfa1 % -102) + (("00" + aAlfa2) % -101);

     aJusti  = "190" + aCadena;
|FPRC;

|PROCESO Tipo1_2016;
     |DDEFECTO #dsmow596;
     #dsmow596#0  = "1";
     #dsmow596#1  = "190";
     #dsmow596#2  = #eosw0077#4;
     #dsmow596#3  = #eosw0077#9;

     aAlfa  = #eosw0077#11;  |HAZ QuitaComasy1009;
     #dsmow596#4  = aAlfa;

     #dsmow596#5  = aTipoP;

     aAlfa   = #eosm0030#16;  |QBT aAlfa;
     aAlfa   = ("000000000" + aAlfa) % -109;
     #dsmow596#6  = aAlfa;

     aAlfa   = #eosm0030#15;  |HAZ QuitaComasy1009;
     #dsmow596#7  = aAlfa;

     |HAZ CogeJusti2016;
     #dsmow596#8  = aJusti;

     #dsmow596#9  = #eosw0077#19;
     #dsmow596#10 = #eosw0077#20;

     aAlfa  = "0000000000000";
     |SI #eosw0077#20 = "S";  |O  #eosw0077#19 = "C";
         aAlfa  = "190";
         aAlfa  = aAlfa  + #eosw0077#21 + #eosw0077#22 + #eosw0077#23 + #eosw0077#24 + #eosw0077#25 + #eosw0077#26;
         aAlfa  = aAlfa  + #eosw0077#27 + #eosw0077#28 + #eosw0077#29 + #eosw0077#30;
         |QBT aAlfa;
         aAlfa  = (aAlfa + "0000000000") % 113;
     |FINSI;
     #dsmow596#11 = aAlfa;

     nNume   = #eosw0077#31;
     #dsmow596#12 = ("000000000" + nNume) % -109;

     enNume = #eosw0077#32;  |HAZ Conver15Signo;  #dsmow596#13 = eaSigno; #dsmow596#14 = eaAlfa;
     enNume = #eosw0077#33;  |HAZ Conver15Signo;  #dsmow596#15 = eaAlfa;
     #dsmow596#18 = &13 + &10;

     nHCampo = 18;
     |SI eaOpcion ! "3";
         nHCampo = 17;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow596#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO Tipo2_2016;
     #dsmow613#0  = "2";
     #dsmow613#1  = "190";
     #dsmow613#2  = #eosm0030#1;
     #dsmow613#3  = #eosw0077#9;
     |SI #eosm0036#16 = "S";
         #dsmow613#5  = #eosm0036#2;
         #dsmow613#4  = "";
     |SINO;
         #dsmow613#5  = "";
         #dsmow613#4  = #eosm0036#2;
     |FINSI;

     aAlfa  = #eosm0036#17;  |HAZ QuitaComasy1009;
     #dsmow613#6  = aAlfa;

     #dsmow613#7  = ("00" + #eosm0036#21) % -102;
     #dsmow613#8  = #eosm0036#4;

     #dsmow613#9  = "00";
     |SI #eosm0036#5 ! "  ";  #dsmow613#9 = #eosm0036#5;  |FINSI;

     enNume = #eosm0036#7;  |HAZ Conver13Signo;  #dsmow613#10 = eaSigno; #dsmow613#11 = eaAlfa;
     enNume = #eosm0036#8;  |HAZ Conver13;  #dsmow613#12 = eaAlfa;
     enNume = #eosm0036#9;  |HAZ Conver13Signo;  #dsmow613#13 = eaSigno; #dsmow613#14 = eaAlfa;
     enNume = #eosm0036#10; |HAZ Conver13;  #dsmow613#15 = eaAlfa;
     enNume = #eosm0036#11; |HAZ Conver13;  #dsmow613#16 = eaAlfa;
     #dsmow613#17 = ("0000" + #eosm0036#3) % -104;
     #dsmow613#18 = #eosm0036#23;
     #dsmow613#19 = ("0000" + #eosm0036#18) % -104;
     #dsmow613#20 = #eosm0036#20;
     #dsmow613#21 = #eosm0036#22;
     #dsmow613#22 = #eosm0036#19;
     #dsmow613#23 = #eosm0036#6;

     |SI #eosy0009#39 < 2015;
         #dsmow613#24 = "0";
         #dsmow613#25 = "0";

         |SI #eosm0036#36 = "S";  #dsmow613#24 = "1";  |FINSI;
         |SI #eosm0036#37 = "S";  #dsmow613#25 = "1";  |FINSI;
     |FINSI;

     #dsmow613#24 = " ";
     #dsmow613#25 = "0";

     |SI #eosm0036#37 = "S";  #dsmow613#25 = "1";  |FINSI;

     enNume = #eosm0036#12; |HAZ Conver13;  #dsmow613#26 = eaAlfa;
     enNume = #eosm0036#13; |HAZ Conver13;  #dsmow613#27 = eaAlfa;
     enNume = #eosm0036#14; |HAZ Conver13;  #dsmow613#28 = eaAlfa;
     enNume = #eosm0036#15; |HAZ Conver13;  #dsmow613#29 = eaAlfa;

     #dsmow613#30 = ("0"  + #eosm0036#38) % -101;
     #dsmow613#31 = ("0"  + #eosm0036#39) % -101;
     #dsmow613#32 = ("00" + #eosm0036#40) % -102;
     #dsmow613#33 = ("00" + #eosm0036#41) % -102;
     #dsmow613#34 = ("00" + #eosm0036#42) % -102;
     #dsmow613#35 = ("00" + #eosm0036#43) % -102;
     #dsmow613#36 = ("00" + #eosm0036#44) % -102;
     #dsmow613#37 = ("00" + #eosm0036#45) % -102;
     #dsmow613#38 = ("00" + #eosm0036#46) % -102;
     #dsmow613#39 = ("00" + #eosm0036#47) % -102;

     #dsmow613#40 = ("0"  + #eosm0036#48) % -101;
     #dsmow613#41 = ("0"  + #eosm0036#49) % -101;
     #dsmow613#42 = ("0"  + #eosm0036#50) % -101;
     #dsmow613#43 = ("0"  + #eosm0036#51) % -101;
     #dsmow613#44 = ("0"  + #eosm0036#52) % -101;
     #dsmow613#45 = ("0"  + #eosm0036#53) % -101;
     #dsmow613#46 = ("0"  + #eosm0036#54) % -101;
     #dsmow613#47 = ("0"  + #eosm0036#55) % -101;
     #dsmow613#48 = ("0"  + #eosm0036#56) % -101;
     #dsmow613#49 = ("0"  + #eosm0036#57) % -101;
     #dsmow613#50 = #eosm0036#58;
     #dsmow613#51 = #eosm0036#59;
     #dsmow613#52 = #eosm0036#60;
     #dsmow613#53 = #eosm0036#61;

     enNume  = #eosm0036#63 + #eosm0036#65;  |HAZ Conver13Signo;
     #dsmow613#54 = eaSigno;
     #dsmow613#55 = eaAlfa;

     enNume  = #eosm0036#64 + #eosm0036#66;  |HAZ Conver13Signo;
     #dsmow613#56 = eaAlfa;

     enNume  = #eosm0036#67;                  |HAZ Conver13Signo;
     #dsmow613#57 = eaAlfa;

     #dsmow613#59 = &13 + &10;

     |SI #dsmow613#8 ! "A";  |Y #dsmow613#8 ! "B";  |Y #dsmow613#8 ! "C"; |Y #dsmow613#8 ! "D";
         #dsmow613#19 = "0000";
         #dsmow613#20 = "0";
         #dsmow613#21 = "         ";
         #dsmow613#22 = "0";
         #dsmow613#23 = "0";
         #dsmow613#24 = " ";
         #dsmow613#25 = "0";
         #dsmow613#26 = "0000000000000";
         #dsmow613#27 = "0000000000000";
         #dsmow613#28 = "0000000000000";
         #dsmow613#29 = "0000000000000";
         #dsmow613#30 = "0";
         #dsmow613#31 = "0";
         #dsmow613#32 = "00";
         #dsmow613#33 = "00";
         #dsmow613#34 = "00";
         #dsmow613#35 = "00";
         #dsmow613#36 = "00";
         #dsmow613#37 = "00";
         #dsmow613#38 = "00";
         #dsmow613#39 = "00";
         #dsmow613#40 = "0";
         #dsmow613#41 = "0";
         #dsmow613#42 = "0";
         #dsmow613#43 = "0";
         #dsmow613#44 = "0";
         #dsmow613#45 = "0";
         #dsmow613#46 = "0";
         #dsmow613#47 = "0";
         #dsmow613#48 = "0";
         #dsmow613#49 = "0";
         #dsmow613#50 = "0";
         #dsmow613#51 = "0";
         #dsmow613#52 = "0";
         #dsmow613#53 = "0";
     |FINSI;

     nHCampo = 59;
     |SI eaOpcion ! "3";
         nHCampo = 58;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ nHCampo;  |HACIENDO nCampo = nCampo + 1;
           aAlfa = #dsmow613#nCampo#;
           |XGRABA nHandle2, aAlfa;
     |SIGUE;
|FPRC;

|PROCESO eosm0036;
     |SI nSwLectura = 1;
         #eosw0077#31 = #eosw0077#31 + 1;
         #eosw0077#32 = #eosw0077#32 + #eosm0036#7  + #eosm0036#9;
         #eosw0077#32 = #eosw0077#32 + #eosm0036#63 + #eosm0036#65;
         #eosw0077#33 = #eosw0077#33 + #eosm0036#8  + #eosm0036#10;
         #eosw0077#33 = #eosw0077#33 + #eosm0036#64 + #eosm0036#66;
     |FINSI;

     |SI nSwLectura = 2;
         |HAZ Tipo2_2016;
         enSinActividad = 0;
     |FINSI;
|FPRC;

|DEFBUCLE eosm0036;
     #eosm0036#1;
     30;
     #eosm0030#0, #eosm0030#1, "            ", 0000, " ", "  ", 0, aDComple;
     #eosm0030#0, #eosm0030#1, "zzzzzzzzzzzz", 9999, "z", "zz", 9, aHComple;
     ;
     NULL, eosm0036;
|FIN;

|PROCESO GeneraFicheros2016;
     #eosclien#0 = #eosm0030#0;
     |LEE 040#eosclien.=;
     |SI FSalida ! 0;  |DDEFECTO #eosclien;  |FINSI;

     #eoshacie#0 = #eosclien#18; #eoshacie#1 = #eosclien#19;
     |LEE 040#eoshacie.=;
     |SI FSalida ! 0; |DDEFECTO #eoshacie; |FINSI;

     #eosdaban#0 = #eosclien#0;
     |LEE 040#eosdaban.=;
     |SI FSalida ! 0; |DDEFECTO #eosdaban; |FINSI;

     |DDEFECTO #eosw0077;
     #eosw0077#0  = #eoshacie#2;
     #eosw0077#1  = #eoshacie#3;
     #eosw0077#2  = #eoshacie#0;
     #eosw0077#3  = #eoshacie#1;
     #eosw0077#4  = #eosm0030#1;
     #eosw0077#5  = "X";
     #eosw0077#6  = " ";
     #eosw0077#7  = " ";
     #eosw0077#8  = " ";
     #eosw0077#9  = #eosclien#1;
     #eosw0077#10 = #eosclien#14;
     #eosw0077#11 = #eosclien#2;
     #eosw0077#12 = #eosclien#4;
     aAlfa  = #eosclien#5;  |HAZ QuitaComasy1009;
     #eosw0077#13 = aAlfa;
     nNume  = #eosclien#6;
     #eosw0077#14 = ("00000" + nNume) % -105;
     #eosw0077#50 = #eosclien#7;
     #eosw0077#51 = #eosclien#8;
     #eosw0077#52 = #eosclien#9;
     aAlfa  = #eosclien#13;  |HAZ QuitaComasy1009;
     #eosw0077#15 = aAlfa;
     #eosw0077#16 = #eosclien#12;
     #eosw0077#17 = #eosclien#10;
     #eosw0077#18 = #eosclien#11;

     |SI #eosm0030#3 = "C";  #eosw0077#19 = "C";  |FINSI;
     |SI #eosm0030#3 = "S";  #eosw0077#20 = "S";  |FINSI;

     #eosw0077#21 = #eosm0030#4;
     #eosw0077#22 = #eosm0030#5;
     #eosw0077#23 = #eosm0030#6;
     #eosw0077#24 = #eosm0030#7;
     #eosw0077#25 = #eosm0030#8;
     #eosw0077#26 = #eosm0030#9;
     #eosw0077#27 = #eosm0030#10;
     #eosw0077#28 = #eosm0030#11;
     #eosw0077#29 = #eosm0030#12;
     #eosw0077#30 = #eosm0030#13;
     #eosw0077#46 = #eosm0030#17;
     #eosw0077#47 = #eosm0030#18;

     aDComple = " ";
     aHComple = "z";
     |SI #eosm0030#3 = "C";
         aDComple = "S";
         aHComple = "S";
     |FINSI;

     nSwLectura = 1;
     |BUCLE eosm0036;

     eaFicheroPlano = eaModelos + (("00000" + #eosm0030#0) % -105) + ".txt";
     eaFicheroImpre = eaModelos + (("00000" + #eosm0030#0) % -105) + ".imp";
     eaFicheroSalid = eaModelos + (("00000" + #eosm0030#0) % -105) + ".sal";
     eaFicheroError = "err" + (("00000" + #eosm0030#0) % -105) + ".txt";

     aAbre = eaPathEmision + eaFicheroPlano;
     |XABRE "BW", aAbre, nHandle2;

     aTipoP = "T";
     |HAZ Tipo1_2016;

     enSinActividad = 1;
     nSwLectura     = 2;
     |BUCLE eosm0036;

     |XCIERRA nHandle2;

     enEmpresa    = #eosm0030#0;
     eaNomEmpresa = #eosclien#2;

     |HAZ PresentaPortal;
|FPRC;

|PROCESO eosm0014_2016;
     #eosm0030#0 = #eosm0014#1;
     #eosm0030#1 = #eosy0009#39;
     |LEE 000#eosm0030.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ GeneraFicheros2016;
|FPRC;

|DEFBUCLE eosm0014_2016;
     #eosm0014#1;
     ;
     #eosy0009#38, 00000;
     #eosy0009#38, 99999;
     ;
     NULL, eosm0014_2016;
|FIN;

|DEFBUCLE eosm0030_2016;
     #eosm0030#1;
     ;
     #eosy0009#0, #eosy0009#39;
     #eosy0009#1, #eosy0009#39;
     ;
     NULL, GeneraFicheros2016;
|FIN;

|PROCESO Bloque2016;
     enAnyo     = #eosy0009#39;
     eaModelos  = "190";
     eaEjer     = #eosy0009#39;

     #dsmoy000#0 = 190;
     #dsmoy000#6 = enAnyo;

     eaPathLanza = eaUnidad + "\MODELOS";            |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaModelos;    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\" + eaEjer;       |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";       |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaModelos;   |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/" + eaEjer;      |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     eaPathInternet = eaUnidad + "/AEAT";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/INTERNET";      |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaModelos;  |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/" + eaEjer;     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "/";

     |HAZ Botones_2015;

     |SI eaOpcion = "0";  |ACABA;  |FINSI;

     nTecla = 1;

     nSwSecuen = 0;
     |SI #eosy0009#0 = 0;
         |SI #eosy0009#38 = 0;
             |PARA nCampoD = Campo + 1;  |SI nCampoD [ 37;  |HACIENDO nCampoD = nCampoD + 1;
                   |SI #eosy0009#nCampoD# ! 0;
                       #eosm0030#0 = #eosy0009#nCampoD#;
                       #eosm0030#1 = #eosy0009#39;
                       |LEE 040#eosm0030.=;
                       |SI FSalida = 0;  |HAZ GeneraFicheros2016;  |FINSI;
                   |FINSI;
             |SIGUE;
         |SINO;
             |BUCLE eosm0014_2016;
         |FINSI;
     |SINO;
         |CIERRAT #eosm0030;
         |BUCLE eosm0030_2016;
         |ABRET #eosm0030;
     |FINSI;

     |SI eaOpcion = "3";
         |SI enPresentar = 0;
             aAlfa =  "      Los ficheros generados estan: " + eaPathInternet + " de su PC";
             |MENAV aAlfa;
         |FINSI;
     |FINSI;
|FPRC;
