|FICHEROS;
   eos93130 #0;
   eosactiv #1;
   eosclien #2;
   eoshacie #3;
   eoscomul #4;
   eosdaban #5;
   eosm1130 #6;
   eoscomun #7;
   eos130co #8;
   eossegu4 #9;
|FIN;

|VARIABLES;
 d_empre    = 0;
 d_activ    = 0;
 d_anyo     = 0;
 rendi      = 0;
 empresad   = 0;
 empresah   = 0;
 swcomu     = 0;
 x          = 0;
 empresa    = 0;
 sw         = 0;
 normal     = 0;
 cont       = 0;
 especial   = 0;
 pepe       = 0;
 varalfa    = "";
 xxxxfiac   = "  ";
 xxaponer   = "  ";
 xrelleno   = "                              ";

 &equis     = "";
 &comunero  = "";
 &retencion = 0;
 &pagos     = 0;
 &total     = 0;
 &dia       = "";
 &mes       = "";
 &anyo      = "";
 &peri      = "";
 &imp1      = 0; &imp2  = 0; &imp3  = 0; &imp4  = 0; &imp5  = 0;
 &imp6      = 0; &imp7  = 0; &imp8  = 0; &imp9  = 0; &imp10 = 0;
 &imp11     = 0; &imp12 = 0; &imp13 = 0; &imp14 = 0; &imp15 = 0;
|FIN;

|INCLUYE i_seguim;
|INCLUYE i_cuadre;
|INCLUYE i_anyode;
|INCLUYE i_pastil;
|INCLUYE i_consul;

|PROCESO fecha;
|SI #0Campo > "30.04.1994"; |ERROR; |FINSI;
|FPRC;

|PROCESO pinta_anyo; |TIPO 7;
|HAZ i_anyodef;
#0#2 = i_anyodef;
|PINTA #0#2;
|FPRC;

|| ************************************************************************
|| CALCULOS IMPRESION 131 A¥O 1993 ****************************************
|| ************************************************************************

|PROCESO mod_931;
|SI sw = 0; empresa = #1#0; sw = 1; |FINSI;

#6#3 = #0#6;
|GRABA 140#6a;

|SI empresa ! #1#0; |HAZ impre_93; |HAZ limpia_93; empresa = #1#0; |FINSI;

|SI swcomu = 0; |HAZ import_931; |SINO; |HAZ import_932; |FINSI;
|FPRC;

|PROCESO mod_932;
#6#3 = #0#6;
|GRABA 020#6a;

|SI swcomu = 0; |HAZ import_931; |SINO; |HAZ import_932; |FINSI;
|HAZ impre_93;
|HAZ limpia_93;
|FPRC;

|PROCESO import_931;
comunero = "";
imp1  = imp1  + #6#5;  imp2  = imp2  + #6#6;
imp3  = imp3  + #6#7;  imp4  = imp4  + #6#8;
imp5  = imp5  + #6#9;  imp6  = imp6  + #6#10;
imp8  = imp8  + #6#12; imp9  = imp9  + #6#13;
imp10 = imp10 + #6#14; imp11 = imp11 + #6#15;
imp12 = imp12 + #6#16;
normal = 1;
|FPRC;

|PROCESO import_932;
cont = cont + 1;
|SI cont = 1;
    comunero = "COMUNIDAD DE BIENES " + #7#2 + " AL " + #4#6 + " %";
|SINO;
    comunero = "VARIAS COMUNIDADES DE BIENES ";
|FINSI;

d_empre = #1#0;
d_activ = #1#1;
d_anyo  = #1#2;

#1#0    = d_empre;
#1#1    = d_activ;
#1#2    = d_anyo - 2;
|SI #1#2 = -2;  #1#2 = 98;  |FINSI;
|SI #1#2 = -1;  #1#2 = 99;  |FINSI;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;
rendi = #1#39;

#1#0    = d_empre;
#1#1    = d_activ;
#1#2    = d_anyo;
|LEE 040#1=;
|SI FSalida ! 0; |DDEFECTO #1; |FINSI;

|SI #1#23 = "E";
    imp1 = imp1 + rendi;
    |SI #8#1 = "S"; imp2 = imp1 % 6; |SINO; imp2 = 0; |FINSI;
    imp3  = imp3  + (#6#7  % #4#6); imp4  = imp4  + (#6#8  % #4#6);
    imp5  = imp5  + (#6#9  % #4#6); imp6  = imp6  + (#6#10 % #4#6);
|SINO;
    imp8 = imp8 + rendi;
    |SI #8#1 = "S"; imp9 = imp8 % 6; |SINO; imp9 = 0; |FINSI;
    imp10 = imp10 + (#6#14 % #4#6); imp11 = imp11 + (#6#15 % #4#6);
    imp12 = imp12 + (#6#16 % #4#6);
|FINSI;

especial = 1;
|FPRC;

|PROCESO limpia_93;
comunero = "";
imp1  = 0; imp2  = 0; imp3  = 0;
imp4  = 0; imp5  = 0; imp6  = 0;
imp7  = 0; imp8  = 0; imp9  = 0;
imp10 = 0; imp11 = 0; imp12 = 0;
imp13 = 0; imp14 = 0; imp15 = 0;
cont = 0;
normal = 0;
especial = 0;
|FPRC;

|PROCESO impre_93;
pepe = imp4 + imp6;
|SI imp2 ] pepe;
    imp7 = imp2;
|SINO;
    imp7 = pepe;
|FINSI;
|SI imp9 ] imp11;
    imp13 = imp9 - imp12;
|SINO;
    imp13 = imp11 - imp12;
|FINSI;
imp14 = imp7 + imp13;
|SI imp14 > 0;
    equis = "";
    imp15 = imp14;
|SINO;
    equis = "X";
    imp15 = 0;
|FINSI;

#2#0 = empresa;
|LEE 040#2=;                             || Lee empresas
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

#3#0 = #2#18; #3#1 = #2#19;
|LEE 040#3=;                             || Lee Hacienda
|SI FSalida ! 0; |DDEFECTO #3; |FINSI;

#5#0 = empresa;
|LEE 040#5=;                             || Lee Bancos
|SI FSalida ! 0; |DDEFECTO #5; |FINSI;

|SI normal = 1; |Y especial = 1;
    comunero = "VARIAS COMUNIDADES DE BIENES";
|FINSI;

|SI normal = 1; |Y especial = 0;
    comunero = "";
|FINSI;

|PRINT;
|PIEINF;

|ABRE #9;
#9#0 = #2#0;
|LIBERA #9;
|LEE 140#9=;
|SI FSalida = 0;
    #9#1 = #9#1 + 1;
    |GRABA 140#9a;
|SINO;
    #9#0 = #2#0;
    #9#1 = 10;
    |GRABA 140#9n;
|FINSI;
|CIERRA #9;

se_empre = #2#0;
se_ejerc = #0#2;
se_perio = #0#4;
se_tipos = 130;
se_activ = #9#1;

|SI #9#1 = 10; |BUCLE eossegui; |FINSI;

se_empre = #2#0;
se_ejerc = #0#2;
se_perio = #0#4;
se_tipos = 130;
se_activ = #9#1;
se_impor = imp14;
se_fecha = #0#6;
se_factu = "N";
|HAZ seguimie;
|HAZ AlAgicli;
|FPRC;


|| ************************************************************************
|| PROCESOS DE SELECCION DE IMPRESOS Y LECTURA DEL 130
|| ************************************************************************

|PROCESO comunero1;
|ABRE #7;
#7#0 = #4#0;
#7#1 = #4#1;
#7#3 = #4#7;
|LEE 040#7=;
|SI FSalida ! 0; |DDEFECTO #7; |FINSI;
|CIERRA #7;

#6#0  = #4#0;
#6#1  = #0#4;
#6#2  = #0#2;
#6#19 = #4#1;
|LIBERA #6;
|LEE 140#6=;
|SI FSalida ! 0; |ACABA; |FINSI;

|SI #6#20 = "S"; |ACABA; |FINSI;
|SI #6#4  = "S"; |ACABA; |FINSI;

swcomu = 1;
|HAZ mod_931;
|FPRC;

|PROCESO comunero2;
|ABRE #7;
#7#0 = #4#0;
#7#1 = #4#1;
#7#3 = #4#7;
|LEE 040#7=;
|SI FSalida ! 0; |DDEFECTO #7; |FINSI;
|CIERRA #7;

#6#0  = #4#0;
#6#1  = #0#4;
#6#2  = #0#2;
#6#19 = #4#1;
|LIBERA #6;
|LEE 140#6=;
|SI FSalida ! 0; |ACABA; |FINSI;

|SI #6#20 = "S"; |ACABA; |FINSI;
|SI #6#4  = "S"; |ACABA; |FINSI;
swcomu = 1;
|HAZ mod_932;
|FPRC;

|DEFBUCLE eoscomul1;
#4#2;
;
#1#0, #1#1, #1#2;
#1#0, #1#1, #1#2;
e;
NULL, comunero1;
|FIN;

|DEFBUCLE eoscomul2;
#4#2;
;
#1#0, #1#1, #1#2;
#1#0, #1#1, #1#2;
e;
NULL, comunero2;
|FIN;

|PROCESO chequear1;
swcomu = 0;

#2#0 = #1#0;
|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

|SI #1#14 = "S";
    |BUCLE eoscomul1;
|SINO;
    #6#0  = #1#0;
    #6#1  = #0#4;
    #6#2  = #0#2;
    #6#19 = #1#1;
    |LIBERA #6;
    |LEE 140#6=;
    |SI FSalida ! 0; |ACABA; |FINSI;

    |SI #6#20 = "S"; |ACABA; |FINSI;
    |SI #6#4  = "S"; |ACABA; |FINSI;
    |HAZ mod_931;
|FINSI;
|FPRC;

|PROCESO chequear2;
swcomu = 0;

#2#0 = #1#0;
|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO #2; |FINSI;

empresa = #1#0;
|SI #1#14 = "S";
    |BUCLE eoscomul2;
|SINO;
    #6#0  = #1#0;
    #6#1  = #0#4;
    #6#2  = #0#2;
    #6#19 = #1#1;
    |LIBERA #6;
    |LEE 140#6=;
    |SI FSalida ! 0; |ACABA; |FINSI;

    |SI #6#20 = "S"; |ACABA; |FINSI;
    |SI #6#4  = "S"; |ACABA; |FINSI;
    |HAZ mod_932;
|FINSI;
|FPRC;

|DEFBUCLE eosactiv1;
#1#1;
42, 46;
empresad, 0, #0#2, "N", "N";
empresah, 6, #0#2, "N", "N";
e;
NULL, chequear1;
|FIN;

|DEFBUCLE eosactiv2;
#1#1;
42, 46;
empresad, 0, #0#2, "S", "N";
empresah, 6, #0#2, "S", "N";
e;
NULL, chequear2;
|FIN;

|PROCESO impre;|TIPO 3;
|DELINDEX #9;

|ABRE #8;
|LIBERA #8;
|LEE 140#8p;
|SI FSalida ! 0;
    #8#0 = 1;
    #8#1 = "S";
    |GRABA 140#8n;
|FINSI;
|CIERRA #8;

|HAZ pastilla;
|IMPRE 0;
|SI FSalida ! 0; |ACABA; |FINSI;

|INFOR "eos93130";
|SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

|HAZ i_cuadre;
dia = #0#6 % 102;
mes = #0#6 % 402;
|HAZ mes;
anyo = #0#6 % 704;

empresad = #0#0;
empresah = #0#1;

|ABRE #2;
|ABRE #3;
|ABRE #5;
|ABRE #6;

|SI #0#7 = "S";
    |BUCLE eosactiv1;
|SINO;
    |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
          |SI #0x ! 0;
              empresad = #0x;
              empresah = #0x;
              |BUCLE eosactiv1;
          |FINSI;
    |SIGUE;
|FINSI;

|SI sw = 1; |HAZ impre_93; |FINSI;
|HAZ limpia_93;

|SI #0#7 = "S";
    |BUCLE eosactiv2;
|SINO;
    |PARA x = 8; |SI x [ 31; |HACIENDO x = x + 1;
          |SI #0x ! 0;
              empresad = #0x;
              empresah = #0x;
              |BUCLE eosactiv2;
          |FINSI;
    |SIGUE;
|FINSI;

|FININF;
|FINIMP;

|CIERRA #2;
|CIERRA #3;
|CIERRA #5;
|CIERRA #6;
|DELINDEX #9;
|FPRC;

|PROCESO mes;
|SI mes = "01"; mes = "Enero     "; |FINSI;
|SI mes = "02"; mes = "Febrero   "; |FINSI;
|SI mes = "03"; mes = "Marzo     "; |FINSI;
|SI mes = "04"; mes = "Abril     "; |FINSI;
|SI mes = "05"; mes = "Mayo      "; |FINSI;
|SI mes = "06"; mes = "Junio     "; |FINSI;
|SI mes = "07"; mes = "Julio     "; |FINSI;
|SI mes = "08"; mes = "Agosto    "; |FINSI;
|SI mes = "09"; mes = "Septiembre"; |FINSI;
|SI mes = "10"; mes = "Octubre   "; |FINSI;
|SI mes = "11"; mes = "Noviembre "; |FINSI;
|SI mes = "12"; mes = "Diciembre "; |FINSI;
|FPRC;

|PROCESO nomodi;|TIPO 7;
|SI #0#7 = "N"; |HAZ nomodifi; |FINSI;
|FPRC;

|PROCESO nomodi1;|TIPO 7;
|SI #0#7 = "S"; |HAZ nomodifi; |FINSI;
|FPRC;

|PROCESO nomodifi;             || rutina de conversion a no modificables
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FPRC;
