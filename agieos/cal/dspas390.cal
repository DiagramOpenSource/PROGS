|FICHEROS;
     dsmom004;
     dsm30301;
     dsm39001;
     dsm39002;
     dsm39003;
     dsm39004;

     dsmociva;
     dsmoc310;
     dsmoc311;
     eosm0017;
     eosm0018;
     eoselepi;

     dsmow013;
     dsm3902@;
|FIN;

|VARIABLES;
     nError            = 0;
     nVale             = 0;
     nSwAcum           = 0;
     nProrraDif        = 0;
     nBaseMas          = 0;
     nAtri             = 0;
     nErrorSinImporte  = 0;
     nContAtri         = 0;
     nSwHay303         = 0;
     nPeriodo          = 0;
     nHay12            = 0;
     nAnyoDos          = 0;
     n49               = 0;
     n50               = 0;
     aCampo98          = "";
     nCampo1           = 0;
     nCampo2           = 0;
     nCampo3           = 0;
     nCampo4           = 0;
     nCampo5           = 0;
     nCampo6           = 0;
     nCampo11          = 0;
     nCampo22          = 0;
     nCampo33          = 0;
     nCampoB           = 0;
     nCampo            = 0;
     nNume             = 0;
     nFactor           = 0;
     nLinea            = 0;
     nUni1             = 0;
     nUni2             = 0;
     nUni3             = 0;
     nUni4             = 0;
     nUni5             = 0;
     nUni6             = 0;
     nUni7             = 0;
     nUni8             = 0;
     nUni9             = 0;
     nTotal            = 0;
     nBLoteria         = 0;
     nCLoteria         = 0;
     nCultivo          = 0;
     nCodigo           = 0;
     nComplem          = -1;
     nOk               = 0;
     aAlfa             = "";
     nImpor            = 0;
     nHay2_18          = 0;
     aBase             = "";
     aMas              = "";
|FIN;

|INCLUYE i_variar;

|PROCESO Errores;
     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmom004#4;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = " ";
         #dsmom004#8  = ~;
         #dsmom004#9  = " ";
         #dsmom004#15 = 0;
         #dsmom004#17 = "SIN DATOS";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO GrabaIVAEsp;
     nSwAcum = 0;
     |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #dsm3902@#nCampo22# = #dsmociva#nCampo2#;
               #dsm3902@#nCampo11# = #dsm3902@#nCampo11# + #dsmociva#nCampo1#;
               #dsm3902@#nCampo33# = #dsm3902@#nCampo33# + ((#dsmociva#nCampo3# % nProrrata) ! 2);
               nSwAcum = 1;
               |SAL;
           |FINSI;
           |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #dsm3902@#nCampo22# = 0;
                   #dsm3902@#nCampo11# = #dsmociva#nCampo1#;
                   #dsm3902@#nCampo22# = #dsmociva#nCampo2#;
                   #dsm3902@#nCampo33# = ((#dsmociva#nCampo3# % nProrrata) ! 2);
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
               |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         #dsm3902@#32 = #dsm3902@#32 + #dsmociva#nCampo1#;
         #dsm3902@#33 = -1;
         #dsm3902@#34 = #dsm3902@#34 + ((#dsmociva#nCampo3# % nProrrata) ! 2);
     |FINSI;

     nProrraDif = nProrrata;
     #dsm3902@#10 = #dsm3902@#12 + #dsm3902@#15 + #dsm3902@#18 + #dsm3902@#21;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#26 + #dsm3902@#29 + #dsm3902@#32;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#35 + #dsm3902@#38 + #dsm3902@#41;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#44 + #dsm3902@#47 + #dsm3902@#50;
     #dsm3902@#10 = #dsm3902@#10 + #dsm3902@#53;

     #dsm3902@#11 = #dsm3902@#14 + #dsm3902@#17 + #dsm3902@#20 + #dsm3902@#23;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#28 + #dsm3902@#31 + #dsm3902@#34;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#37 + #dsm3902@#40 + #dsm3902@#43;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#46 + #dsm3902@#49 + #dsm3902@#52;
     #dsm3902@#11 = #dsm3902@#11 + #dsm3902@#55;
|FPRC;

|PROCESO MiroVigentes;
     nHay2_18 = 0;

     nOk      = 0;
     |SI #dsmociva#7 = 7;  nOk = 1; |FINSI;
     |SI #dsmociva#7 = 8;  nOk = 1; |FINSI;
     |SI #dsmociva#7 = 9;  nOk = 1; |FINSI;
     |SI #dsmociva#7 = 10; nOk = 1; |FINSI;
     |SI #dsmociva#7 = 16; nOk = 1; |FINSI;
     |SI #dsmociva#7 = 17; nOk = 1; |FINSI;
     |SI nOk = 1; |ACABA; |FINSI;

     |SI #dsmociva#nCampo2# ! 0; |Y #dsmociva#nCampo2# ! 4;
         |Y #dsmociva#nCampo2# ! 10; |Y #dsmociva#nCampo2# ! 21;

             nHay2_18 = 1;
             #dsm3902@#0 = #dsm39001#0;
             #dsm3902@#1 = #dsm39001#1;
             #dsm3902@#2 = #dsm39001#2;
             #dsm3902@#3 = #dsm39001#3;
             #dsm3902@#4 = 2;
             #dsm3902@#5 = 18;
             |LEE 101#dsm3902@.=;
             |SI FSalida = 0;
                 |HAZ GrabaIVAEsp;
                 |GRABA 020#dsm3902@.a;
                 #dsmociva#12 = #dsmociva#12 - #dsmociva#nCampo1#;
                 #dsmociva#13 = #dsmociva#13 - #dsmociva#nCampo3#;
                 #dsmociva#nCampo1# = 0;
                 #dsmociva#nCampo2# = 0;
                 #dsmociva#nCampo3# = 0;
             |FINSI;
             |LIBERA #dsm3902@;
     |FINSI;
|FPRC;

|PROCESO GrabaIVA;
     nProrrata = 100;

     |SI #dsmociva#nCampo2# = 0;
         |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo3# ! 0;
             nVale = 0;
             |SI #dsmociva#6 = 1;
                 |SI #dsmociva#7 = 2; |O #dsmociva#7 = 3; nVale = 1; |FINSI;
             |FINSI;
             |SI nVale = 0;
                 #dsm39002#32 = #dsm39002#32 + #dsmociva#nCampo1#;
                 #dsm39002#33 = -1;
                 #dsm39002#34 = #dsm39002#34 + ((#dsmociva#nCampo3# % nProrrata) ! 2);
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI #dsmociva#6 = 2; |Y enEjer ] 2018;
         |HAZ MiroVigentes;
         |SI nHay2_18 = 1; |ACABA; |FINSI;
     |FINSI;

     nSwAcum = 0;
     |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #dsm39002#nCampo22# = #dsmociva#nCampo2#;
               #dsm39002#nCampo11# = #dsm39002#nCampo11# + #dsmociva#nCampo1#;
               #dsm39002#nCampo33# = #dsm39002#nCampo33# + ((#dsmociva#nCampo3# % nProrrata) ! 2);
               nSwAcum = 1;
               |SAL;
           |FINSI;

           |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 12;  |SI nCampo11 [ 32;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #dsm39002#nCampo22# = 0;
                   #dsm39002#nCampo11# = #dsmociva#nCampo1#;
                   #dsm39002#nCampo22# = #dsmociva#nCampo2#;
                   #dsm39002#nCampo33# = ((#dsmociva#nCampo3# % nProrrata) ! 2);
                   nSwAcum = 1;
                   |SAL;
               |FINSI;

               |SI nCampo11 = 21; nCampo11 = 23; |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         #dsm39002#32 = #dsm39002#32 + #dsmociva#nCampo1#;
         #dsm39002#33 = -1;
         #dsm39002#34 = #dsm39002#34 + ((#dsmociva#nCampo3# % nProrrata) ! 2);
     |FINSI;
|FPRC;

|PROCESO GrabaIVA_F3;
     |SI #dsmociva#nCampo2# = 0;
         |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo3# ! 0;
             #dsm39002#53 = #dsm39002#53 + #dsmociva#nCampo1#;
             #dsm39002#54 = -1;
             #dsm39002#55 = #dsm39002#55 + #dsmociva#nCampo3#;
             |ACABA;
         |FINSI;
     |FINSI;

     nSwAcum = 0;
     |PARA nCampo11  = 35;  |SI nCampo11 [ 53;  |HACIENDO nCampo11 = nCampo11 + 3;
           nCampo22 = nCampo11 + 1;
           nCampo33 = nCampo11 + 2;

           |SI #dsm39002#nCampo22# = #dsmociva#nCampo2#;
               #dsm39002#nCampo11# = #dsm39002#nCampo11# + #dsmociva#nCampo1#;
               #dsm39002#nCampo33# = #dsm39002#nCampo33# + #dsmociva#nCampo3#;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nCampo11  = 35;  |SI nCampo11 [ 53;  |HACIENDO nCampo11 = nCampo11 + 3;
               nCampo22 = nCampo11 + 1;
               nCampo33 = nCampo11 + 2;
               |SI #dsm39002#nCampo22# = 0;
                   #dsm39002#nCampo11# = #dsmociva#nCampo1#;
                   #dsm39002#nCampo22# = #dsmociva#nCampo2#;
                   #dsm39002#nCampo33# = #dsmociva#nCampo3#;
                   nSwAcum = 1;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nSwAcum = 0;
         #dsm39002#53 = #dsm39002#53 + #dsmociva#nCampo1#;
         #dsm39002#54 = -1;
         #dsm39002#55 = #dsm39002#55 + #dsmociva#nCampo3#;
     |FINSI;
|FPRC;

|PROCESO dsmociva;
     nProrraDif = 100;
     nBaseMas   = 0;

     |SI #dsmociva#12 ! 0;  |O #dsmociva#13 ! 0;
         #dsm39002#0 = #dsm39001#0;
         #dsm39002#1 = #dsm39001#1;
         #dsm39002#2 = #dsm39001#2;
         #dsm39002#3 = #dsm39001#3;
         #dsm39002#4 = #dsmociva#6;
         #dsm39002#5 = #dsmociva#7;

         |LEE 101#dsm39002.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #dsm39002#4 = 5;  |Y #dsm39002#5 = 1;
             nAtri         = nAtri     + #dsm39002#10;
             nContAtri     = nContAtri + 1;
             #dsm39002#10  = nAtri / nContAtri;
             |SI #dsm39002#10 ! 100;
                 #dsm39001#55 = #dsm39002#10;
             |FINSI;
         |SINO;
              |PARA nCampo1 = 14;  |SI nCampo1 [ 23;  |HACIENDO nCampo1 = nCampo1 + 3;
                   nCampo2 = nCampo1 + 1;
                   nCampo3 = nCampo1 + 2;
                   nCampo4 = nCampo1 - 4;
                   nCampo5 = nCampo3 - 4;
                   |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                       |HAZ GrabaIVA;
                   |FINSI;
              |SIGUE;

              |SI #dsmociva#6 = 1; |Y #dsmociva#7 = 6;
                  |PARA nCampo1 = 26;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 3;
                        nCampo2 = nCampo1 + 1;
                        nCampo3 = nCampo1 + 2;
                        nCampo5 = -1;
                        |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                            |HAZ GrabaIVA;
                        |FINSI;
                  |SIGUE;

                  |PARA nCampo1 = 35;  |SI nCampo1 [ 55;  |HACIENDO nCampo1 = nCampo1 + 3;
                        nCampo2 = nCampo1 + 1;
                        nCampo3 = nCampo1 + 2;
                        nCampo5 = -1;
                        |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                            |HAZ GrabaIVA_F3;
                        |FINSI;
                  |SIGUE;
              |SINO;
                  |PARA nCampo1 = 26;  |SI nCampo1 [ 53;  |HACIENDO nCampo1 = nCampo1 + 3;
                        nCampo2 = nCampo1 + 1;
                        nCampo3 = nCampo1 + 2;
                        nCampo5 = -1;
                        |SI #dsmociva#nCampo1# ! 0;  |O #dsmociva#nCampo2# ! 0;  |O #dsmociva#nCampo3# ! 0;
                            |HAZ GrabaIVA;
                        |FINSI;
                  |SIGUE;
             |FINSI;

             |SI #dsmociva#6 = 2;   |Y #dsmociva#7 ! 9; |Y #dsmociva#7 ! 10;  |Y #dsmociva#7 ! 11;
               |Y #dsmociva#7 ! 12; |Y #dsmociva#7 ! 16;

                 |SI #dsmociva#13 ! 0; |Y #dsmociva#12 = 0; |Y #dsmociva#7 < 8;
                     nErrorSinImporte = 1;
                 |FINSI;
             |FINSI;

             |PARA nCampo1 = 13;  |SI nCampo1 [ 33;  |HACIENDO nCampo1 = nCampo1 + 3;
                   |SI #dsm39002#nCampo1# = -1;  #dsm39002#nCampo1# = 0;  |FINSI;
                   |SI nCampo1 = 22; nCampo1 = 24; |FINSI;
             |SIGUE;

             |SI #dsm39002#12 ! 0; |O #dsm39002#15 ! 0; |O #dsm39002#18 ! 0; |O #dsm39002#21 ! 0;
              |O #dsm39002#28 ! 0; |O #dsm39002#31 ! 0; |O #dsm39002#34 ! 0;
              |O #dsm39002#37 ! 0; |O #dsm39002#40 ! 0; |O #dsm39002#43 ! 0; |O #dsm39002#46 ! 0;
              |O #dsm39002#49 ! 0; |O #dsm39002#52 ! 0; |O #dsm39002#55 ! 0;
                 #dsm39002#10 = #dsm39002#12 + #dsm39002#15 + #dsm39002#18 + #dsm39002#21;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#26 + #dsm39002#29 + #dsm39002#32;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#35 + #dsm39002#38 + #dsm39002#41;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#44 + #dsm39002#47 + #dsm39002#50;
                 #dsm39002#10 = #dsm39002#10 + #dsm39002#53;

                 #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#37 + #dsm39002#40 + #dsm39002#43;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#46 + #dsm39002#49 + #dsm39002#52;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#55;
             |SINO;
                 #dsm39002#10 = #dsm39002#10 + #dsmociva#12;
                 #dsm39002#11 = #dsm39002#11 + #dsmociva#13;
             |FINSI;

             |SI #dsmociva#6 = 2; |Y #dsmociva#7 = 10; |Y #dsmociva#2 = 12;
                 #dsm39002#11 = #dsm39002#14 + #dsm39002#17 + #dsm39002#20 + #dsm39002#23;
                 #dsm39002#11 = #dsm39002#11 + #dsm39002#28 + #dsm39002#31 + #dsm39002#34;
             |FINSI;
         |FINSI;

         |GRABA 020#dsm39002.a;
         |LIBERA #dsm39002;

         nSwHay303 = 1;
     |FINSI;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmociva;
     #dsmociva#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 01, 0,  0;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99, 9, 99;
     be;
     NULL, dsmociva;
|FIN;

|PROCESO dsm30301;
     |SI #dsm39001#55 = 0;
         #dsm39001#109 = #dsm39001#109 + #dsm30301#94;
         #dsm39001#110 = #dsm39001#110 + #dsm30301#95;
     |SINO;
         #dsm39001#111 = #dsm39001#111 + #dsm30301#94;
         #dsm39001#112 = #dsm39001#112 + #dsm30301#95;
     |FINSI;

     |SI #dsm39001#98 = "S";
         |SI #dsmom004#24 = " ";        || ... |SI #dsm30301#4 = 0; aqui solo hay un registro
             #dsm39001#8  = #dsm39001#8 + #dsm30301#91;
             #dsm39001#9  = #dsm39001#9 + #dsm30301#90;
         |SINO;
             |SI #dsm30301#88 > 0;
                 |SI #dsm30301#87 < 0;
                     nImpor = #dsm30301#88;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#8  = #dsm39001#8 + nImpor;

                     nImpor = #dsm30301#87;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#9  = #dsm39001#9 + nImpor;
                 |FINSI;

                 |SI #dsm30301#87 ] 0;
                     nImpor = #dsm30301#86;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#8  = #dsm39001#8 + nImpor;
                 |FINSI;
             |FINSI;

             |SI #dsm30301#88 < 0;
                 |SI #dsm30301#87 > 0;
                     nImpor = #dsm30301#87;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#8  = #dsm39001#8 + nImpor;

                     nImpor = #dsm30301#88;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#9  = #dsm39001#9 + nImpor;
                 |FINSI;

                 |SI #dsm30301#87 [ 0;
                     nImpor = #dsm30301#86;
                     |SI nImpor < 0; nImpor = -nImpor;  |FINSI;
                     #dsm39001#9  = #dsm39001#9 + nImpor;
                 |FINSI;
            |FINSI;
         |FINSI;
     |SINO;
         |SI #dsmom004#24 = " ";        || ... |SI #dsm30301#4 = 0; aqui solo hay un registro
             #dsm39001#8  = #dsm39001#8 + #dsm30301#91;
         |SINO;
             |SI #dsm30301#86 > 0;
                 #dsm39001#8  = #dsm39001#8 + #dsm30301#86;
             |FINSI;
        |FINSI;
     |FINSI;

     |SI #dsm39001#98 = "S";
         #dsm39001#9  = #dsm39001#9 + #dsm30301#90;
     |FINSI;

     n49     = #dsm30301#89;
     n50     = #dsm30301#90;
     |SI #dsm39001#98 = "S"; n50 = 0; |FINSI;

     |SI #dsm30301#2 = 12;
         |SI #dsm39001#98 = "S";
             #dsm30301#90 = 0;
         |FINSI;

         nHay12  = 1;
         #dsm39001#10 = #dsm39001#10 + #dsm30301#89;
         #dsm39001#11 = #dsm39001#11 + #dsm30301#90;
     |FINSI;
|FPRC;

|DEFBUCLE dsm30301;
     #dsm30301#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99;
     ;
     NULL, dsm30301;
|FIN;

|PROCESO CargaEspejo;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/dsm39002.mas";
     |CARGA_DEF aMas, dsm3902@;
     |ABRE #dsm3902@;
|FPRC;

|PROCESO DescargaEspejo;
     |CIERRA #dsm3902@;
     |DESCARGA_DEF #dsm3902@;
|FPRC;

|PROCESO ControlaRegGeneral;
     nHay12    = 0;
     n49       = 0;
     n50       = 0;
     aCampo98  = #dsm39001#98;

     |HAZ CargaEspejo;
     |ABRE #dsm39002;
     |PARA nPeriodo = 1; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 1;
           nError           = 0;
           nErrorSinImporte = 0;

           #dsmom004#0   = #dsm39001#0;
           #dsmom004#1   = #dsm39001#1;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 303;
           #dsmom004#4   = 99;
           |LEE 000#dsmom004.];
           |SI FSalida = 0;
               |LEE 000#dsmom004.a;
           |SINO;
               |LEE 000#dsmom004.u;
           |FINSI;

           |SI FSalida = 0;  |Y #dsmom004#0 = #dsm39001#0;
                             |Y #dsmom004#1 = #dsm39001#1;
                             |Y #dsmom004#2 = nPeriodo;
                             |Y #dsmom004#3 = 303;
               nProrrata = 100;
               |BUCLE dsmociva;
               #dsm39001#98 = #dsmom004#23;
               |BUCLE dsm30301;
           |FINSI;

           |SI nErrorSinImporte = 1;
               |SI enMasivo = 0;
                   aAlfa = "    Atencion. Faltan bases de IVA Soportado en el Periodo = " + nPeriodo + " de la Empresa = " + #dsmom004#0;
                   |MENAV aAlfa;
               |FINSI;
           |FINSI;
     |SIGUE;

     #dsm39001#98 = aCampo98;
     |SI nHay12 = 0;
         #dsm39001#10 = #dsm39001#10 + n49;
         #dsm39001#11 = #dsm39001#11 + n50;
     |FINSI;

     |CIERRA #dsm39002;
     |HAZ DescargaEspejo;
|FPRC;

|PROCESO eosm0017;
     #eosm0018#0 = #eosm0017#0;
     #eosm0018#1 = #eosm0017#1;
     #eosm0018#2 = #eosm0017#5;
     |LEE 040#eosm0018.=;
     |SI FSalida ! 0;  |DDEFECTO #eosm0018;  |FINSI;

     #eoselepi#0  = #eosm0017#2;
     #eoselepi#1  = #eosm0017#3;
     #eoselepi#41 = #eosm0017#4;
     #eoselepi#2  = #dsmow013#2;
     |LEE 040#eoselepi.=;
     |SI FSalida ! 0; |DDEFECTO #eoselepi; |FINSI;

     nLinea = nLinea + 1;

     #dsm39003#0 = #dsm39001#0;
     #dsm39003#1 = #dsm39001#1;
     #dsm39003#2 = #dsm39001#2;
     #dsm39003#3 = #dsm39001#3;
     #dsm39003#4 = nLinea;
     #dsm39003#5 = #eosm0017#3;

     nUni1    = #eosm0017#20;
     nTotal   = #eosm0017#17 * #eosm0017#20;
     |SI nTotal ! #eosm0017#21;  nUni1 = #eosm0017#21 / #eosm0017#17;  |FINSI;

     nUni2    = #eosm0017#31;
     nTotal   = #eosm0017#28 * #eosm0017#31;
     |SI nTotal ! #eosm0017#32;  nUni2 = #eosm0017#32 / #eosm0017#28;  |FINSI;

     nUni3    = #eosm0017#42;
     nTotal   = #eosm0017#39 * #eosm0017#42;
     |SI nTotal ! #eosm0017#43;  nUni3 = #eosm0017#43 / #eosm0017#39;  |FINSI;

     nUni4    = #eosm0017#53;
     nTotal   = #eosm0017#50 * #eosm0017#53;
     |SI nTotal ! #eosm0017#54;  nUni4 = #eosm0017#54 / #eosm0017#50;  |FINSI;

     nUni5    = #eosm0017#64;
     nTotal   = #eosm0017#61 * #eosm0017#64;
     |SI nTotal ! #eosm0017#65;  nUni5 = #eosm0017#65 / #eosm0017#61;  |FINSI;

     nUni6    = #eosm0017#75;
     nTotal   = #eosm0017#72 * #eosm0017#75;
     |SI nTotal ! #eosm0017#76;  nUni6 = #eosm0017#76 / #eosm0017#72;  |FINSI;

     nUni7    = #eosm0017#86;
     nTotal   = #eosm0017#83 * #eosm0017#86;
     |SI nTotal ! #eosm0017#87;  nUni7 = #eosm0017#87 / #eosm0017#83;  |FINSI;

     nUni8    = #eosm0017#97;
     nTotal   = #eosm0017#94 * #eosm0017#97;
     |SI nTotal ! #eosm0017#98;  nUni8 = #eosm0017#98 / #eosm0017#94;  |FINSI;

     nUni9    = #eosm0017#108;
     nTotal   = #eosm0017#105 * #eosm0017#108;
     |SI nTotal ! #eosm0017#109;  nUni9 = #eosm0017#109 / #eosm0017#105;  |FINSI;

     nBLoteria = #eosm0018#117 + #eosm0018#119 + #eosm0018#121 + #eosm0018#123;
     nCLoteria = #eosm0018#118 + #eosm0018#120 + #eosm0018#122 + #eosm0018#124;
     |SI nCLoteria ! 0;
         |PARA nCampoB = 17;  |SI nCampoB [ 100;  |HACIENDO nCampoB = nCampoB + 11;
               |SI #eosm0017#nCampoB# = 0;
                   |SI nCampoB = 17;   nUni1 = nBLoteria;  #eosm0017#21  = nCLoteria;  |FINSI;
                   |SI nCampoB = 28;   nUni2 = nBLoteria;  #eosm0017#32  = nCLoteria;  |FINSI;
                   |SI nCampoB = 39;   nUni3 = nBLoteria;  #eosm0017#43  = nCLoteria;  |FINSI;
                   |SI nCampoB = 50;   nUni4 = nBLoteria;  #eosm0017#54  = nCLoteria;  |FINSI;
                   |SI nCampoB = 61;   nUni5 = nBLoteria;  #eosm0017#65  = nCLoteria;  |FINSI;
                   |SI nCampoB = 72;   nUni6 = nBLoteria;  #eosm0017#76  = nCLoteria;  |FINSI;
                   |SI nCampoB = 83;   nUni7 = nBLoteria;  #eosm0017#87  = nCLoteria;  |FINSI;
                   |SI nCampoB = 94;   nUni8 = nBLoteria;  #eosm0017#98  = nCLoteria;  |FINSI;
                   |SI nCampoB = 105;  nUni9 = nBLoteria;  #eosm0017#109 = nCLoteria;  |FINSI;

                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |PARA nCampo = 4;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 4;
           nNume = #eoselepi#nCampo#;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI nCampo = 4;   nUni1 = nUni1 / nFactor;  |FINSI;
               |SI nCampo = 8;   nUni2 = nUni2 / nFactor;  |FINSI;
               |SI nCampo = 12;  nUni3 = nUni3 / nFactor;  |FINSI;
               |SI nCampo = 16;  nUni4 = nUni4 / nFactor;  |FINSI;
               |SI nCampo = 20;  nUni5 = nUni5 / nFactor;  |FINSI;
               |SI nCampo = 24;  nUni6 = nUni6 / nFactor;  |FINSI;
               |SI nCampo = 28;  nUni7 = nUni7 / nFactor;  |FINSI;
               |SI nCampo = 32;  nUni8 = nUni8 / nFactor;  |FINSI;
               |SI nCampo = 36;  nUni9 = nUni9 / nFactor;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI #dsm39003#5 = "6441"; |O #dsm39003#5 = "6442"; |O #dsm39003#5 = "6443"; |O #dsm39003#5 = "6446";
         #dsm39003#6  = nUni1 + nUni2 + nUni3;
         #dsm39003#7  = #eosm0017#21 + #eosm0017#32 + #eosm0017#43;

         #dsm39003#8  = nUni4 + nUni5 + nUni6;
         #dsm39003#9  = #eosm0017#54 + #eosm0017#65 + #eosm0017#76;

         #dsm39003#10 = nUni7;
         #dsm39003#11 = #eosm0017#87;

         #dsm39003#12 = nUni8;
         #dsm39003#13 = #eosm0017#98;

         #dsm39003#14 = nUni9;
         #dsm39003#15 = #eosm0017#109;
     |SINO;
         #dsm39003#6  = nUni1 + nUni2;
         #dsm39003#7  = #eosm0017#21 + #eosm0017#32;

         #dsm39003#8  = nUni3;
         #dsm39003#9  = #eosm0017#43;

         #dsm39003#10 = nUni4;
         #dsm39003#11 = #eosm0017#54;

         #dsm39003#12 = nUni5;
         #dsm39003#13 = #eosm0017#65;

         #dsm39003#14 = nUni6;
         #dsm39003#15 = #eosm0017#76;

         #dsm39003#16 = nUni7;
         #dsm39003#17 = #eosm0017#87;

         #dsm39003#18 = nUni8;
         #dsm39003#19 = #eosm0017#98;
     |FINSI;

     #dsm39003#20 = #eosm0017#113;
     #dsm39003#21 = #eosm0018#115 + (#eosm0017#113 % 1);
     #dsm39003#22 = #eosm0018#66;
     |SI #dsm39003#22 = 0;  #dsm39003#22 = 1;  |FINSI;
     #dsm39003#23 = (#eosm0017#113 - #dsm39003#21) * #dsm39003#22;

     #dsm39003#24 = 0;
     |SI #dsm39003#6  ! 0;  |O #dsm39003#8  ! 0;  |O #dsm39003#10 ! 0;
     |O  #dsm39003#12 ! 0;  |O #dsm39003#14 ! 0;  |O #dsm39003#16 ! 0;  |O #dsm39003#18 ! 0;
         #dsm39003#24 = #eosm0017#123;
     |FINSI;

     #dsm39003#25 = #eosm0018#158;
     #dsm39003#26 = ((#eosm0017#113 + #dsm39003#25) % #dsm39003#24) * #dsm39003#22;
     #dsm39003#27 = #dsm39003#23;
     |SI #dsm39003#27 < #dsm39003#26;  #dsm39003#27 = #dsm39003#26; |FINSI;

     |SI #dsm39003#27 = 0;  |Y #eosm0017#127 ! 0;
         #dsm39003#27 = #eosm0017#127;
     |FINSI;

     |SI #eosm0017#137 = 0;
         #dsm39003#29 = "S";
     |FINSI;

     |GRABA 020#dsm39003.n;
     |LIBERA #dsm39003;

     nSwHay303 = 1;
|FPRC;

|DEFBUCLE eosm0017;
     #eosm0017#1;
     ;
     #dsmom004#0, nAnyoDos, 1;
     #dsmom004#0, nAnyoDos, 6;
     ;
     NULL, eosm0017;
|FIN;

|PROCESO PonCodigoCultivo;
     |SI nCultivo = 11;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 12;   nCodigo = 8;  |FINSI;
     |SI nCultivo = 38;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 39;   nCodigo = 4;  |FINSI;
     |SI nCultivo = 72;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 73;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 74;   nCodigo = 3;  |FINSI;
     |SI nCultivo = 75;   nCodigo = 3;  |FINSI;
     |SI nCultivo = 76;   nCodigo = 5;  |FINSI;
     |SI nCultivo = 77;   nCodigo = 5;  |FINSI;
     |SI nCultivo = 78;   nCodigo = 5;  |FINSI;
     |SI nCultivo = 79;   nCodigo = 5;  |FINSI;
     |SI nCultivo = 80;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 81;   nCodigo = 1;  |FINSI;
     |SI nCultivo = 116;  nCodigo = 7;  |FINSI;
     |SI nCultivo = 117;  nCodigo = 7;  |FINSI;
     |SI nCultivo = 120;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 121;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 122;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 123;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 124;  nCodigo = 3;  |FINSI;
     |SI nCultivo = 125;  nCodigo = 3;  |FINSI;
     |SI nCultivo = 130;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 131;  nCodigo = 4;  |FINSI;
     |SI nCultivo = 186;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 193;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 194;  nCodigo = 14; |FINSI;
     |SI nCultivo = 195;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 196;  nCodigo = 14; |FINSI;
     |SI nCultivo = 197;  nCodigo = 2;  |FINSI;
     |SI nCultivo = 198;  nCodigo = 14; |FINSI;
     |SI nCultivo = 284;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 285;  nCodigo = 8;  |FINSI;
     |SI nCultivo = 326;  nCodigo = 6;  |FINSI;
     |SI nCultivo = 327;  nCodigo = 8;  |FINSI;
|FPRC;

|PROCESO dsmoc311;
     nCultivo = #dsmoc311#6;

     |HAZ PonCodigoCultivo;

     |SI nCodigo  = 0;    nCodigo = 1;  |FINSI;

     nCampo1 = 0;
     |PARA nCampo = 14;  |SI nCampo [ 38;  |HACIENDO nCampo = nCampo + 6;
           |SI #dsm39001#nCampo# = nCodigo;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
           |SI #dsm39001#nCampo# = 0;
               nCampo1 = nCampo;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nCampo1 = 0;  |ACABA;  |FINSI;

     nCampo2 = nCampo1 + 1;
     nCampo3 = nCampo1 + 2;
     nCampo4 = nCampo1 + 3;
     nCampo5 = nCampo1 + 4;
     nCampo6 = nCampo1 + 5;

     #dsm39001#nCampo1# = nCodigo;
     #dsm39001#nCampo2# = #dsm39001#nCampo2# + #dsmoc311#8;
     #dsm39001#nCampo3# = #dsmoc311#9;
     #dsm39001#nCampo4# = #dsm39001#nCampo2# * #dsm39001#nCampo3#;
     #dsm39001#nCampo5# = #dsm39001#nCampo5# + #dsmoc311#11;
     #dsm39001#nCampo6# = #dsm39001#nCampo4# - ((#dsm39001#nCampo4# % 1) + #dsm39001#nCampo5#);

     nSwHay303 = 1;
|FPRC;

|DEFBUCLE dsmoc311;
     #dsmoc311#1;
     ;
     #dsm39001#0, #dsm39001#1, 12, 303, nComplem, 00, 001;
     #dsm39001#0, #dsm39001#1, 12, 303, nComplem, 99, 999;
     ;
     NULL, dsmoc311;
|FIN;

|PROCESO CargaSimplificado;
    |ABRE #dsm39002;
    #dsm39002#0 = #dsm39001#0;
    #dsm39002#1 = #dsm39001#1;
    #dsm39002#2 = #dsm39001#2;
    #dsm39002#3 = #dsm39001#3;
    #dsm39002#4 = 3;
    #dsm39002#5 = 2;
    |LEE 101#dsm39002.=;
    |SI FSalida = 0;
        #dsm39002#10 = #dsm39002#10 + #dsmoc310#19;
        |GRABA 020#dsm39002.a;
    |FINSI;
    |LIBERA #dsm39002;
    |CIERRA #dsm39002;
|FPRC;

|PROCESO dsmoc310;
     |SI #dsmoc310#8 = "S";
         |SI #dsmoc310#2 = 12;
             |HAZ CargaSimplificado;
         |FINSI;
     |SINO;
         |HAZ CargaSimplificado;
     |FINSI;

     nSwHay303 = 1;
|FPRC;

|DEFBUCLE dsmoc310S;
   #dsmoc310#1;
   ;
   #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, 00;
   #dsm30301#0, #dsm30301#1, #dsm30301#2, #dsm30301#3, #dsm30301#4, 99;
   ;
   NULL, dsmoc310;
|FIN;

|PROCESO dsm30301S;
     #dsmom004#0   = #dsm30301#0;
     #dsmom004#1   = #dsm30301#1;
     #dsmom004#2   = #dsm30301#2;
     #dsmom004#3   = 303;
     #dsmom004#4   = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsmom004#0   = #dsm30301#0;
     #dsmom004#1   = #dsm30301#1;
     #dsmom004#2   = #dsm30301#2;
     #dsmom004#3   = 303;
     #dsmom004#4   = #dsm30301#4 + 1;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #dsm39001#46 = #dsm39001#46 + #dsm30301#66;
     #dsm39001#47 = #dsm39001#47 + #dsm30301#68;
     #dsm39001#48 = #dsm39001#48 + #dsm30301#67;
     #dsm39001#50 = #dsm39001#50 + #dsm30301#70;
     #dsm39001#51 = #dsm39001#51 + #dsm30301#71;

     |LIBERA #dsm30301;

     |BUCLE dsmoc310S;
|FPRC;

|DEFBUCLE dsm30301S;
     #dsm30301#1;
     ;
     #dsm39001#0, #dsm39001#1, 01, 303, 00, 00;
     #dsm39001#0, #dsm39001#1, 12, 303, 99, 00;
     ;
     NULL, dsm30301S;
|FIN;

|PROCESO ControlaRegSimplificado;
     nLinea    = 0;
     |ABRE #dsm39003;
     |ABRE #eosm0018;
     |ABRE #eoselepi;
     |BUCLE eosm0017;
     |CIERRA #eosm0018;
     |CIERRA #dsm39003;
     |CIERRA #eoselepi;

     nComplem = -1;

     |ABRE #dsmoc311;
     #dsmoc311#0 = #dsm39001#0;
     #dsmoc311#1 = #dsm39001#1;
     #dsmoc311#2 = 12;
     #dsmoc311#3 = 303;
     #dsmoc311#4 = 99;
     #dsmoc311#5 = 0;
     #dsmoc311#6 = 1;
     |LEE 041#dsmoc311.];
     |SI FSalida = 0;
         |LEE 041#dsmoc311.a;
     |SINO;
         |LEE 041#dsmoc311.u;
     |FINSI;
     |SI FSalida = 0; |Y #dsmoc311#0 = #dsm39001#0; |Y #dsmoc311#1 = #dsm39001#1;
      |Y #dsmoc311#2 = 12; |Y #dsmoc311#3 = 303;
          nComplem = #dsmoc311#4;
     |FINSI;
     |CIERRA #dsmoc311;

     |SI nComplem ! -1;
         |BUCLE dsmoc311;
     |FINSI;

     |BUCLE dsm30301S;

     |CIERRA #dsmom004;
|FPRC;

|PROCESO ControlaNoMod390;
     nError = 0;

     |ABRE #dsmom004;
     |PARA nPeriodo = 3; |SI nPeriodo [ 12;  |HACIENDO nPeriodo = nPeriodo + 3;
           #dsmom004#0   = #dsmow013#0;
           #dsmom004#1   = #dsmow013#2;
           #dsmom004#2   = nPeriodo;
           #dsmom004#3   = 303;
           #dsmom004#4   = 0;
           |LEE 040#dsmom004.=;
           |SI FSalida = 0;
               |SI #dsmom004#7 = "X";  |Y #dsmom004#9 = " ";  |Y enSwCheq390 = 0;
                   nError = 1;
               |FINSI;
           |FINSI;

           |SI nError = 1;
               |SI enMasivo = 0;
                   aAlfa = "    Modelos sin Imprimir, Empresa = " + #dsmom004#0 + ", Pase Abortado";
                   |MENAV aAlfa;
               |FINSI;
               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #dsmom004;

     |SI nError = 1;
         |ACABA;
     |FINSI;

     |ABRE #dsm30301;
     #dsm30301#0  = #dsmow013#0;
     #dsm30301#1  = #dsmow013#2
     #dsm30301#2  = 12;
     #dsm30301#3  = 303;
     #dsm30301#4  = 99;
     #dsm30301#5  = 9;
     |LEE 000#dsm30301.];
     |SI FSalida = 0;
         |LEE 000#dsm30301.a;
     |SINO;
         |LEE 000#dsm30301.u;
     |FINSI;

     |SI FSalida = 0;  |Y  #dsm30301#0  = #dsmow013#0;
                       |Y  #dsm30301#1  = #dsmow013#2;
                       |Y  #dsm30301#2  = 12;
                       |Y  #dsm30301#3  = 303;

         |SI #dsm30301#96  ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#100 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#104 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#108 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#112 ! 0;  nError = 1;  |FINSI;
         |SI #dsm30301#116 ! 0;  nError = 1;  |FINSI;

         |SI #dsm30301#129 ! 0;  nError = 1;  |FINSI;
     |FINSI;
     |CIERRA #dsm30301;

     |SI nError = 1;
         |SI enMasivo = 0;
             |CONFI "0000NLa empresa no esta obligada a presentar el 390, quiere presentarlo de todas formas";
             |SI FSalida = 0;
                 nError = 0;
                 |ACABA;
             |FINSI;
         |SINO;
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = "";
         #dsmom004#8  = "01.01.0000";
         #dsmom004#9  = " ";
         #dsmom004#15 = 0;
         #dsmom004#17 = "SIN DATOS";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROCESO Pase390;
     nAnyoDos = #dsmow013#2 - 2000;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |CIERRA #dsmom004; |ACABA;   |FINSI;
     |CIERRA #dsmom004;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmom004#4;
     enTipoEntrada = 3;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     nError = 0;
     |HAZ ControlaNoMod390;
     |SI nError = 1;  |ACABA;  |FINSI;

     enTipoEntrada = 95;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #dsm39001;
     #dsm39001#0  = enEmpresa;
     #dsm39001#1  = enEjer;
     #dsm39001#2  = enModelo;
     #dsm39001#3  = enComplem;
     |LEE 101#dsm39001.=;
     |SI FSalida ! 0;  |CIERRA #dsm39001;  |ACABA;  |FINSI;

     |ABRE #dsmom004;

     nError    = 0;
     nAtri     = 0;
     nContAtri = 0;

     |HAZ ControlaRegGeneral;
     |SI nError = 1;  |LIBERA #dsm39001; |HAZ Errores;  |ACABA;  |FINSI;

     |HAZ ControlaRegSimplificado;
     |SI nError = 1;  |LIBERA #dsm39001; |HAZ Errores;  |ACABA;  |FINSI;

     |SI nSwHay303 = 0;
         |LIBERA #dsm39001;
         |CIERRA #dsm39001;
         |HAZ Errores;
         |SI enMasivo = 0;
             |MENAV "0000Seleccion Vacia";
         |FINSI;

         |ACABA;
     |FINSI;

     |GRABA 020#dsm39001.a;
     |LIBERA #dsm39001;
     |CIERRA #dsm39001;

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;  |CIERRA #dsmom004; |ACABA;   |FINSI;
     |CIERRA #dsmom004;

     enEmpresa     = #dsmow013#0;
     enEjer        = #dsmow013#2;
     enModelo      = #dsmow013#7;
     enComplem     = #dsmom004#4;
     enTipoEntrada = 95;
     enMensa       = 1;
     |SUB_EJECUTA_NP "dsm39001";

     |ABRE #dsmom004;
     #dsmom004#0 = #dsmow013#0;
     #dsmom004#1 = #dsmow013#2;
     #dsmom004#2 = #dsmow013#3;
     #dsmom004#3 = #dsmow013#7;
     #dsmom004#4 = #dsmow013#9;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         #dsmom004#7  = "X";
         #dsmom004#8  = ~;
         #dsmom004#9  = " ";
         #dsmom004#15 = 0;
         #dsmom004#17 = "COMPLETADO";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;
