|FICHEROS;
    eosplan1 #0;                   || Planillas
    eosclien #1;                   || Clientes
    eosconpl #2;                   || Conceptos de gastos
    eoscopl1 #3;                   || Control IVA Planilla
    eosm1300 #4;                   || Mantenimiento del 300
    eosm1130 #5;                   || Mantenimiento del 130 Pasados
    eos130co #6;                   || Control del 130
    eosactiv #7;                   || Actividades
    eosopesp #8;                   || Operaciones Especificas
    eospla11 #10;                  || Fichero de Trabajo Acumuladores
    eosaplic #11;                  || Control de la aplicacion
    eosexist #12;                  || Fichero de Existencias
    eosm2130 #13;                  || Mantenimiento 130 Trabajo Actual
    eosm3130 #14;                  || Mantenimiento 130 Emision Actual
    eoscomul #15;                  || Lineas Comuneros
    eosw0016 #16;                  || Indexado Grabar 130
    eoscapro #17;                  || Pantalla de Porrratas
    eosm0019 #40;                  || Mantenimiento del 310 98
    eosma100 #100;

    eosm1303 #44;                  || Mantenimiento del 303
    eosopes2 #88;                  || Operaciones Especificas

    eosw0027 #98;                  || Pantalla Fantasmas de las Compras
    eosw0026 #99;                  || Pantalla Fantasmas de las Ventas
    eospa303;

    dsmod130@  #1130;
    planilla@  #1000;
    desglose@  #1100;

    espejo6@ #106;
|FIN;

|VARIABLES;
   aAlfa1       = "";
   campo_f1     = 0;
   campo_f2     = 0;
   campo_f3     = 0;
   campo_f4     = 0;
   sw_exist     = 0;
   entera       = "";
   xxx          = 0;
   error        = 0;
   forma        = 0;

   yy        = 0;
   activi_g  = 0;
   pagos_g   = 0;
   FEstado   = 0;
   sw_130    = 0;
   act_nor   = 0;
   sw_esta   = 0;
   empresa   = 0;
   activid   = 0;
   periodo   = 0;
   ejercic   = 0;
   contador  = 0;
   activ     = 0;
   anyo      = 0;
   trime     = 0;
   cont      = 0;
   sw_ex     = 0;
   trime1    = 0;
   x         = 0;

   pepe      = 0;
   penultimo = 0;
   y         = 0;
   pep       = 0;
   importe   = 0;
   campo     = 0;
   juan      = 0;
   campo1    = 0;
   campo2    = 0;
   penult    = 0;
   base      = 0;
   pepin     = 0;
   pepa      = 0;
   juan1     = 0;
   juan2     = 0;
   juan3     = 0;
   iva       = 0;
   total     = 0;
   ventas    = 0;
   camp      = 0;
   modifica  = 1;
   sw_recal  = 0;
   graba2    = "2400NDesea grabar los DATOS de los PAGOS FRACCIONADOS al 130 : ";
   pagos     = 0;
   f_anter   = 0;
   i_anter   = 0;
   el_130    = 0;
   ventas_con = 0;
   ventas_sin = 0;
   TCompra1   = 0;
   TCompra2   = 0;
   TCompra3   = 0;
   TCompra4   = 0;
   TCompra5   = 0;
   TCompra6   = 0;
   TCompra7   = 0;
   PCompra1   = 0;
   PCompra2   = 0;
   PCompra3   = 0;
   PCompra4   = 0;
   PCompra5   = 0;
   PCompra6   = 0;
   PCompra7   = 0;
   Compra1    = 0;
   Compra2    = 0;
   Compra4    = 0;
   Compra5    = 0;
   Compra7    = 0;
   Campos1    = 0;
   Campos2    = 0;
   Campos     = 0;
   nTotal0    = 0;

   prorrata   = 0;
   cuota      = 0;
   Suma1      = 0;
   Suma2      = 0;

   BaseC1     = 0;
   BaseC2     = 0;
   BaseC3     = 0;
   BaseC4     = 0;
   BaseC5     = 0;
   BaseC6     = 0;
   BaseC7     = 0;

   TBaseC1    = 0;
   TBaseC2    = 0;
   TBaseC3    = 0;
   TBaseC4    = 0;
   TBaseC5    = 0;
   TBaseC6    = 0;
   TBaseC7    = 0;

   PBaseC1    = 0;
   PBaseC2    = 0;
   PBaseC3    = 0;
   PBaseC4    = 0;
   PBaseC5    = 0;
   PBaseC6    = 0;
   PBaseC7    = 0;

  _17_9       = 0;
  _17_10      = 0;
  _17_11      = 0;
  _17_12      = 0;
  _17_13      = 0;
  _17_14      = 0;
  _17_15      = 0;
  _17_16      = 0;
  _17_17      = 0;
  _17_18      = 0;
  _17_19      = 0;
  _17_20      = 0;
  _17_21      = 0;
  _17_22      = 0;
  _17_23      = 0;
  _17_24      = 0;
  _17_25      = 0;
  _17_26      = 0;
  _17_27      = 0;
  _17_28      = 0;
  _17_29      = 0;
  _17_30      = 0;
  _17_31      = 0;
  _17_32      = 0;
  _17_33      = 0;
  _17_34      = 0;
  _17_35      = 0;
  _17_36      = 0;

   Total      = 0;
   LaEmpresa  = 0;
   ElPeriodo  = 0;
   ElAnyo     = 0;
   Compensar  = 0;
   nPeriodo   = 0;
   nSwEsta    = 0;

   &emp_exis = 0;
   &act_exis = 0;
   &any_exis = 0;
   &Base1       = 0;
   &Base2       = 0;
   &Base3       = 0;
   &Base4       = 0;
   &Porc1       = 0;
   &Porc2       = 0;
   &Porc3       = 0;
   &Porc4       = 0;
   &Cuot1       = 0;
   &Cuot2       = 0;
   &Cuot3       = 0;
   &Cuot4       = 0;

    nImporte = 0;
    nSwNeg   = 0;
    nSumaD   = 0;
    aBase    = "";
    aMas     = "";
    nHPer    = 0;
    nEl27    = 0;
    enNume   = 0;

    nTope        = 0;
    nTopeAgrario = 0;
    nEjer        = 0;
    nSuma        = 0;
    nEmpresa     = 0;
    nActividad   = 0;
    nNume1       = 0;
    nTecla       = 0;
    nCampo       = 0;
    nCampo1      = 0;
    nCampo2      = 0;
    nCampo3      = 0;
    nCampo1Inv   = 0;
    nError       = 0;
    nIVA         = 0;
    nPara1       = 0;
    nPara2       = 0;
    nPara3       = 0;
    nPara11      = 0;
    nPara22      = 0;
    nPara33      = 0;
    nSwAcum      = 0;
    nCampoDes    = 0;
    nPorce1      = 0;
    nPorce2      = 0;
    nSw          = 0;

    nSubeIVA     = 0;
    nPer         = 0;
    aTipo        = "";
    aAlfa        = "";
    nMasBase     = 0;
    nPriIVA      = 0;
    fFecha1      = @;
    nSwGraba     = 0;

    &enEmpresa   = 0;
    &enActividad = 0;
    &enEjer      = 0;
    &enPeriodo   = 0;
    &enModelo    = 0;

     nTotalG17 = 0;
     nTotalG21 = 0;
     nOpe      = 0;
     nTp       = 0;
     nClave0   = 0;
     nClave1   = 0;
     nClave2   = 0;
     nClave3   = 0;
     aPathModelo = "";
     aDef        = "";
     &enDesdePlan = 0;
|FIN;

|INCLUYE i_seguim;
|INCLUYE i_ficher;
|INCLUYE i_devolv;
|INCLUYE i_period;
|INCLUYE i_vareos;

|PROCESO Graba100_Plan;
     |DDEFECTO #100;
     #100#0 = "PLA";
     #100#1 = #0#0;
     #100#2 = #0#83;
     #100#3 = #0#2;
     #100#4 = #0#1;
     #100#5 = nCampo1;
     #100#6 = #0nCampo1;
     #100#7 = nIVA;
     #100#8 = #0nCampo2;

     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|PROCESO AntesReduccion; |TIPO 7;
  aAlfa1 = "N";
  nEjer  = 2000 + #0#1;
  |SI #0#1 ] 80; nEjer = 1900 + #0#1; |FINSI;

  |SI nEjer ] 2010; |Y enEjer [ 2015;
      aAlfa1 = "S";
      |SI #7#41 = "S"; aAlfa1 = "N"; |FINSI;
      |SI #7#46 = "S"; aAlfa1 = "N"; |FINSI;
  |FINSI;

  |CAMPO_MODIFICA #0#202, 1, aAlfa1;
  |CAMPO_MODIFICA #0#203, 1, aAlfa1;

  |SI aAlfa1 = "N";
      #0#202 = "N";
      #0#203 = 0;
  |FINSI;
  |PINTA #0#202;
  |PINTA #0#203;
|FPRC;

|PROCESO Reduccion;
  |C_M #0#202, 0, aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  aAlfa1 = #0#202;
  |C_M #0#203, 1,aAlfa1;
  |SI #0#202 = "N";
      #0#203 = 0;
      |PINTA #0#203;
  |FINSI;
|FPRC;

|PROCESO Crea2015;
   |C_M #0#203, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 2; |ACABA; |FINSI;

   |SI #0#1 = 15;
       |SI #0#203 ! 0;
           aAlfa1 = "0000SImporte en Reduc.creacion empleo y ejercicio 2015 incompatibles. Modifiquela. ";
           |CONFI aAlfa1;
           |SI FSalida = 0;
               |ERROR;
           |FINSI;
       |SINO;
            #0#202 = "N"; |PINTA #0#202;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO eosplan1;
 |PARA nCampo1 = 19;  |SI nCampo1 [ 21;  |HACIENDO nCampo1 = nCampo1 + 1;
        nCampo2 = nCampo1 + 21;
        |SI #44nCampo1 ! 0;  |O #0nCampo2 ! 0;
            nCampo3 = nCampo1 - 16;
            nIVA = #0nCampo3;
            |HAZ Graba100_Plan;
        |FINSI;
 |SIGUE;
 |SI nSw = 0;
     |PARA nCampo1 = 26;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 104;
           |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
               nIVA = ((#0nCampo2 / #0nCampo1) * 100) ! 2;
               |SI nIVA ! 16;  |Y nIVA ! 4;  |Y nIVA ! 7;
                |Y nIVA ! 0.5; |Y nIVA ! 1;
                   |Y nIVA ! 18; |Y nIVA ! 8;
                     |Y nIVA ! 21; |Y nIVA ! 10;
                      |Y nIVA ! 1.40; |Y nIVA ! 5.20;
                   nIVA = 0;
               |FINSI;

               |HAZ Graba100_Plan;
           |FINSI;
     |SIGUE;

     nCampo1 = 35;
     nCampo2 = 96;
     |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
         nIVA = ((#0nCampo2 / #0nCampo1) * 100) ! 2;
         |SI nIVA ! 16;  |Y nIVA ! 4;  |Y nIVA ! 7;
            |Y nIVA ! 0.5; |Y nIVA ! 1;
               |Y nIVA ! 18; |Y nIVA ! 8;
                 |Y nIVA ! 21; |Y nIVA ! 10;
                   |Y nIVA ! 1.40; |Y nIVA ! 5.20;
            nIVA = 0;
         |FINSI;

         |HAZ Graba100_Plan;
      |FINSI;

     |PARA nCampo1 = 108;  |SI nCampo1 [ 118;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 31;
           |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
               nIVA = ((#0nCampo2 / #0nCampo1) * 100) ! 2;
               |SI nIVA ! 16;  |Y nIVA ! 4;  |Y nIVA ! 7;
                |Y nIVA ! 0.5; |Y nIVA ! 1;
                   |Y nIVA ! 18; |Y nIVA ! 8;
                     |Y nIVA ! 21; |Y nIVA ! 10;
                       |Y nIVA ! 1.40; |Y nIVA ! 5.20;
                   nIVA = 0;
               |FINSI;

               |HAZ Graba100_Plan;
           |FINSI;
     |SIGUE;

  |FINSI;
|FPRC;

|DEFBUCLE eosplan1;
     #0#1;
     ;
     00001, 0, 09, 0;
     99999, 9, 10, 9;
     ;
     NULL, eosplan1;
|FIN;

|PROCESO Graba100_303;
     |SI #44nCampo1 = 0;  |Y #44nCampo2 = 0;
         |ACABA;
     |FINSI;

     nIVA = ((#44nCampo2 / #44nCampo1) * 100) ! 2;
     |SI nIVA ! 16;  |Y nIVA ! 4;  |Y nIVA ! 7;
         |Y nIVA ! 0.5; |Y nIVA ! 1;
            |Y nIVA ! 18; |Y nIVA ! 8;
               |Y nIVA ! 21; |Y nIVA ! 10;
                  |Y nIVA ! 1.40; |Y nIVA ! 5.20;
         nIVA = 0;
     |FINSI;

     |DDEFECTO #100;
     #100#0 = "303";
     #100#1 = #44#0;
     #100#2 = #44#45;
     #100#3 = #44#1;
     #100#4 = #44#2;
     #100#5 = nCampo1;
     #100#6 = #44nCampo1;
     #100#7 = nIVA;
     #100#8 = #44nCampo2;

     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|PROCESO eosm1303V;
     nCampo1 = 5;   nCampo2 = 7;  nCampo3 = 6;  |HAZ Graba100_303;
     nCampo1 = 8;   nCampo2 = 10; nCampo3 = 9;  |HAZ Graba100_303;
     nCampo1 = 11;  nCampo2 = 13; nCampo3 = 12; |HAZ Graba100_303;
     |SI nSw = 0;
         nCampo1 = 70;  nCampo2 = 21;   |HAZ Graba100_303;
         nCampo1 = 71;  nCampo2 = 22;   |HAZ Graba100_303;
         nCampo1 = 72;  nCampo2 = 51;   |HAZ Graba100_303;
         nCampo1 = 75;  nCampo2 = 43;   |HAZ Graba100_303;
         nCampo1 = 76;  nCampo2 = 44;   |HAZ Graba100_303;
         nCampo1 = 77;  nCampo2 = 78;   |HAZ Graba100_303;
    |FINSI;
|FPRC;

|DEFBUCLE eosm1303V;
     #44#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, eosm1303V;
|FIN;

|PROCESO eosma100C;
     nSw = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE eosma100C;
     #100#1;
     ;
     "   ", 00001, 1, 01, 01, 005;
     "zzz", 99999, 6, 12, 99, 021;
     e;
     NULL, eosma100C;
|FIN;

|PROCESO control; |TIPO 8;
     nSw = 0;
     |ABRE #100;
     |LEE 000#100p;
     |SI FSalida ! 0;
         |MENSA "0000 Grabando desglose IVA Compra, espere un momento.";
         |BUCLE eosplan1;
         |BUCLE eosm1303V;
         |BLIN 04;
     |SINO;
         |CIERRA #100;
         nSw = 0;
         |BUCLE eosma100C;
         |SI nSw = 0;
             |MENSA "0000 Grabando desglose IVA Ventas, espere un momento.";
             |ABRE #100;
             nSw = 1;
             |BUCLE eosplan1;
             |BUCLE eosm1303V;
             |BLIN 04;
         |FINSI;
     |FINSI;

     |CIERRA #100;

     |HAZ Periodo;

     |ABRE #11;
     |LEE 040#11p;
     |SI FSalida ! 0;
         |MENAV "     No existe control de 130.";
         |PTEC 807;
         |ACABA;
     |FINSI;
     |CIERRA #11;

     enModelo = 130;
     aAlfa1   = "eosy0092;MASIVO";
     |SUB_EJECUTA aAlfa1;
|FPRC;

|PROCESO activida; |TIPO 6;
     |ABRE #7;
     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1;
     |LEE 040#7=;
     |SI FSalida = 0;
         |SI #7#14 = "S";
             |MENAV "     La Actividad es un Comunero";
             |ERROR;
         |FINSI;
         |SI #7#22 = "A";
             |CONFI "2400NActividad en Modulos desea continuar : ";
             |SI FSalida ! 0; |CIERRA #7; |PTEC 807; |ACABA; |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #7;

     |SI #7#26 ! "N";
         |SI #7#26 ! "T";  |Y #7#26 ! "F";
             |MENAV "0000 Solo periodos trimestrales";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO DfectoPeriodo; |TIPO 7;
    #0#2 = Periodo;
    |PINTA #0#2;
|FPRC;

|PROCESO MiroEoscopl1;
    nSw = 0;
    |SI #0#1 = 10; |Y #0#2 ] 3;
        |ABRE #3;
        #3#0 = #0#2;
        #3#1 = #0#1;
        |LEE 040#3=;
        |SI FSalida = 0;
            nSw = 1;
            |SI #3#2 = 8; |O #3#2 = 18; nSw = 0; |FINSI;
            |SI #3#3 = 8; |O #3#3 = 18; nSw = 0; |FINSI;
            |SI #3#4 = 8; |O #3#4 = 18; nSw = 0; |FINSI;
            |SI #3#5 = 8; |O #3#5 = 18; nSw = 0; |FINSI;
        |SINO;
            nSw = 2;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO compensa; |TIPO 0;
     |SI cont = 1;
         |SI #0#2 = 1;
             |ABRE #7;
             #7#0 = #0#0;
             #7#1 = #0#83;
             #7#2 = #0#1 - 1;
             |SI #7#2 < 0;  #7#2 = 99;  |FINSI;
             |LEE 040#7=;
             |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
             #0#52 = #7#34;

             #7#0 = #0#0;
             #7#1 = #0#83;
             #7#2 = #0#1;
             |LEE 040#7=;
             |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
             |CIERRA #7;
         |SINO;
             |SI #0#1 [ 8;  |O #0#1 ] 80;
                 |ABRE #4;
                 trime = #0#2 - 1;
                 |PARA x = 1; |SI x [ trime; |HACIENDO x = x + 1;
                     #4#0  = #0#0
                     #4#45 = #0#83;
                     #4#1  = x;
                     #4#2  = #0#1;
                     |LEE 000#4=;
                     |SI FSalida = 0;
                         |SI #4#55 < 0;
                             #0#52 = -#4#55;
                         |SINO;
                             #0#52 = 0;
                         |FINSI;
                     |FINSI;
                 |SIGUE;
                 |CIERRA #4;
             |SINO;
                 |ABRE #44;
                 trime = #0#2 - 1;
                 |PARA x = 1; |SI x [ trime; |HACIENDO x = x + 1;
                     #44#0  = #0#0
                     #44#45 = #0#83;
                     #44#1  = x;
                     #44#2  = #0#1;
                     |LEE 000#44=;
                     |SI FSalida = 0;
                         |SI #44#55 < 0;
                             #0#52 = -#44#55;
                         |SINO;
                             #0#52 = 0;
                         |FINSI;
                     |FINSI;
                 |SIGUE;
                 |CIERRA #44;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipo_2_alta; |TIPO 0;
     cont = (FEntrada / 100) ! 0;
     |HAZ MiroEoscopl1;
     |SI nSw ! 0;
         |SI nSw = 1; aAlfa1 = "    Atencion! Revise Control IVA para este Trimestre. Tipos de IVA (%) mal informados"; |FINSI;
         |SI nSw = 2; aAlfa1 = "    Atencion, No existe Control de IVA para este Trimestre."; |FINSI;
         |MENAV aAlfa1;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI cont ! 1; |Y cont ! 2; |ACABA; |FINSI;

     error = 0;   |HAZ esta_super;  |SI error = 1; |PTEC 807; |ACABA; |FINSI;
                  |HAZ nomodifi;
     error = 0;   |HAZ si_exist;    |SI error = 1; |PTEC 807; |ACABA; |FINSI;
                  |HAZ acuant;
                  |HAZ iva;
     error = 0;   |HAZ concepto;    |SI error = 1; |PTEC 807; |ACABA; |FINSI;
                  |HAZ compensa;
                  |HAZ existenc
|FPRC;

|PROCESO eosma100B;
     |BORRA 020#100a;
     |LIBERA #100;
|FPRC;

|DEFBUCLE eosma100B;
     #100#1;
     ;
     "PLA", #0#0, #0#83, #0#2, #0#1, 000;
     "PLA", #0#0, #0#83, #0#2, #0#1, 999;
     be;
     NULL, eosma100B;
|FIN;

|PROCESO tipo_2_modi; |TIPO 2;
     forma = 0 +. 1;
     |SI forma = 1; |ACABA; |FINSI;
     cont = (FEntrada / 100) ! 0;

     error = 0;   |HAZ esta_super;  |SI error = 1; |PTEC 807; |ACABA; |FINSI;
                  |HAZ nomodifi;
     error = 0;   |HAZ si_exist;    |SI error = 1; |PTEC 807; |ACABA; |FINSI;
                  |HAZ acuant;
                  |HAZ iva;
     error = 0;   |HAZ concepto;    |SI error = 1; |PTEC 807; |ACABA; |FINSI;
                  |HAZ compensa;
                  |HAZ existenc

     |SI cont = 3;
         |BUCLE eosma100B;
     |FINSI;
|FPRC;

|PROCESO si_exist;
     |SI cont = 4; |ACABA; |FINSI;

     empresa  = #0#0;
     activ    = #0#83;
     anyo     = #0#1;
     trime    = #0#2;
     cont     = (FEntrada / 100) ! 0;
     modifica = 0;
     sw_ex    = 0;

     |SI #0#2 = 4; |ACABA; |FINSI;

     |DDEFECTO #0;
     trime1 = trime + 1;

     |PARA x = trime1; |SI x [ 4; |HACIENDO x = x + 1;
           #0#0  = empresa;
           #0#83 = activ;
           #0#1  = anyo;
           #0#2  = x;
           |LEE 040#0=;
           |SI FSalida = 0; sw_ex = 1; |FINSI;
     |SIGUE;

     |SI cont = 1; |Y sw_ex = 1;
         |MENAV "    No se puede DAR DE ALTA existen trimestres superiores.";
         error = 1;
         |ACABA;
     |FINSI;

     |SI cont = 2; |Y sw_ex = 1; modifica = 1; |FINSI;

     |SI cont = 3; |Y sw_ex = 1;
         |MENAV "    No se puede DAR DE BAJA existen trimestres superiores.";
         |ERROR;
         error = 1;
         |ACABA;
     |FINSI;

     #0#0  = empresa;
     #0#83 = activ;
     #0#1  = anyo;
     #0#2  = trime;
     |LEE 040#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0  = empresa;
         #0#83 = activ;
         #0#1  = anyo;
         #0#2  = trime;
     |FINSI;
     |SI #0#2 = 1; |DDEFECTO #10; |FINSI;
|FPRC;

|PROCESO esta_super; |TIPO 0;
     cont = (FEntrada / 100) ! 0;
     |SI #0#2 = 4; |Y cont ! 4;
         sw_esta = 0;
         |CONFI "2400SDesea Recalculo del 4§ Trimestre : ";
         sw_recal = 0;
         |SI FSalida = 0; sw_recal = 1; |FINSI;
         |ACABA;
     |FINSI;

     sw_esta   = 0;
     empresa   = #0#0;
     activid   = #0#83;
     periodo   = #0#2;
     ejercic   = #0#1;

     #0#2 = #0#2 + 1;
     |LEE 040#0=;
     |SI FSalida = 0; sw_esta = 1; |FINSI;

     #0#0  = empresa;
     #0#83 = activid;
     #0#2  = periodo;
     #0#1  = ejercic;
     |LIBERA #0;
     |LEE 140#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0  = empresa;
         #0#83 = activid;
         #0#2  = periodo;
         #0#1  = ejercic;
     |FINSI;

     |SI sw_esta = 1; |Y cont = 2;
         |PUSHV 0501 2380;
         |CUADRO 1821 2364;
         |ATRI R;
         |PINTA 1922, " EXISTE PLANILLA CON UN PERIODO SUPERIOR  ";
         |PINTA 2022, " POR LO TANTO NO DARE LA OPCION DE GRABAR ";
         |PINTA 2122, " EL 130.                                  ";
         |PINTA 2259, "     ";
         |CONFI "2222NDESEA CONTINUAR : ";
         |ATRI 0;
         |SI FSalida ! 0; error = 1; |FINSI;
         |POPV;
     |FINSI;
|FPRC;

|PROCESO nomodifi; |TIPO 0;
     |SI #0#1 ] 0;  |Y #0#1 [ 80;
         |CAMPO_MODIFICA #0#50, 1, "N";
         |CAMPO_MODIFICA #0#59, 1, "N";
     |SINO;
         |SI #0#1 [ 93;
             |CAMPO_MODIFICA #0#50, 1, "S";
             |CAMPO_MODIFICA #0#59, 1, "S";
         |SINO;
             |CAMPO_MODIFICA #0#50, 1, "N";
             |CAMPO_MODIFICA #0#59, 1, "N";
         |FINSI;
     |FINSI;

     |SI #0#1 ] 0;  |Y #0#1 [ 80;
         |CAMPO_MODIFICA #0#56, 1, "S";
     |SINO;
         |SI #0#1 [ 97;
             |SI #7#22 = "B";
                 |CAMPO_MODIFICA #0#56, 1, "S";
             |SINO;
                 |CAMPO_MODIFICA #0#56, 1, "N";
             |FINSI;
         |SINO;
             |CAMPO_MODIFICA #0#56, 1, "S";
         |FINSI;
     |FINSI;

    |SI #0#1 ] 10; |Y #0#1 [ 15;
        |CAMPO_MODIFICA #0#202, 1, "S";
        |CAMPO_MODIFICA #0#203, 1, "S";
    |SINO;
        |CAMPO_MODIFICA #0#202, 1, "N";
        |CAMPO_MODIFICA #0#203, 1, "N";
    |FINSI;
|FPRC;

|PROCESO si_entra; |TIPO 13;
     sw_exist = 0;
|FPRC;

|PROCESO acuant;
     penultimo = 0;
     |SI trime = 1;
         |SI cont = 1; |O cont = 2;
             |DDEFECTO #10;
             |SI #0#1 [ 93; |Y #0#1 ] 81;  |HAZ penultimo; |FINSI;
         |FINSI;
         |ACABA;
     |FINSI;

     empresa = #0#0;
     activ   = #0#83;
     anyo    = #0#1;
     trime   = #0#2;

     |SI cont = 1; |O cont = 2;
         |DDEFECTO #10;
         trime1 = trime - 1;
         |PARA x = 1; |SI x [ trime1; |HACIENDO x = x + 1;
               #0#0  = empresa;
               #0#83 = activ;
               #0#1  = anyo;
               #0#2  = x;
               |LEE 040#0=;
               |SI FSalida = 0;
                  |SI #0#1 [ 93; |Y #0#1 ] 81;  penultimo = #0#50; |FINSI;

                  |PARA y = 0; |SI y [ 20; |HACIENDO y = y + 1;
                       pep = y + 62;
                       #10y = #0pep;
                  |SIGUE;

                  |PARA y = 25; |SI y [ 35; |HACIENDO y = y + 1;
                       pep = y + 94;
                       #10y = #0pep;
                  |SIGUE;

                  #10#23 = #10#23 + #0#19 + #0#20 + #0#21 + #0#22 + #0#150 + #0#152;

                  |PARA yy = 26; |SI yy [ 34; |HACIENDO yy = yy + 1;
                        #10#24 = #10#24 + #0yy;
                  |SIGUE;

                  |PARA yy = 108; |SI yy [ 118; |HACIENDO yy = yy + 1;
                        #10#24 = #10#24 + #0yy;
                  |SIGUE;

                  #10#21 = #0#86;
                  #10#22 = #0#89;
                  #10#36 = #0#151;
                  #10#37 = #0#155;
               |FINSI;
         |SIGUE;
         #0#0  = empresa;
         #0#83 = activ;
         #0#1  = anyo;
         #0#2  = trime;
         |LIBERA #0;
         |LEE 140#0=;
     |FINSI;

     |SI cont ! 1; |ACABA; |FINSI;

     |DDEFECTO #0;
     #0#0  = empresa;
     #0#83 = activ;
     #0#1  = anyo;
     #0#2  = trime;
     |PARA y = 0; |SI y [ 20; |HACIENDO y = y + 1;
           pep   = y + 62;
           #0pep = #10y;
     |SIGUE;

     |PARA y = 25; |SI y [ 35; |HACIENDO y = y + 1;
           pep   = y + 94;
           #0pep = #10y;
     |SIGUE;

     #0#86  = #10#21;
     #0#89  = #10#22;
     #0#151 = #10#36;
     #0#155 = #10#37;
     #0#50 = penultimo;

     #0#92 = #0#62 + #0#63 + #0#64 + #0#65 + #0#151;

     #0#95 = 0;
     |PARA xxx = 69; |SI xxx [ 77; |HACIENDO xxx = xxx + 1;
           #0#95 = #0#95 + #0xxx;
     |SIGUE;
     |PARA xxx = 119; |SI xxx [ 129; |HACIENDO xxx = xxx + 1;
           #0#95 = #0#95 + #0xxx;
     |SIGUE;

     |HAZ existenc;
     |HAZ iva;
     |HAZ acumular;
     |HAZ pinta_pan;
|FPRC;

|PROCESO penultimo;
     penultimo = 0;
     |ABRE #7;
     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1 - 2;
     |SI #7#2 = -2;  #7#2 = 98;  |FINSI;
     |SI #7#2 = -1;  #7#2 = 99;  |FINSI;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

     penultimo = #7#39;

     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO iva; |TIPO 0;
     |SI #0#1 ] 94; |O #0#1 [ 80;
         #0#59 = 20;
     |FINSI;

     |SI cont ! 1; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #0#2;
     #3#1 = #0#1;
     |LEE 040#3=;
     |SI FSalida = 0;
         #0#3   = #3#2;
         #0#4   = #3#3;
         #0#5   = #3#4;
         #0#6   = #3#5;
         #0#7   = #3#6;
         #0#8   = #3#7;
         #0#9   = #3#3;
         #0#84  = #3#8;
         #0#153 = #3#13;

         |SI #0#1 ] 0;  |Y #0#1 [ 80;
             #0#56 = #7#25;
         |SINO;
             |SI #0#1 [ 97;
                 |SI #7#22 = "B"; #0#56 = #7#25; |SINO; #0#56 = 0;  |FINSI;
             |SINO;
                 #0#56 = #7#25;
             |FINSI;
         |FINSI;

         |SI #0#1 [ 93; |Y #0#1 ] 81; #0#59 = #7#24; |SINO; #0#59 = 20; |FINSI;
         |PINTA #0#56;
         |PINTA #0#59;
     |SINO;
         |MENAV "    No existe Registro Control de I.V.A.";
         |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO concepto; |TIPO 0;
     |SI cont ! 1; |ACABA; |FINSI;

     |ABRE #2;
     #2#0 = #0#1;
     |LEE 040#2=;
     |SI FSalida ! 0;
         |MENAV "        No existe conceptos de Gastos.";
         error = 1;
         |ACABA;
     |FINSI;
     |CIERRA #2;

     |SI #7#22 = "B"; |O #7#22 = "N";
         |PARA x = 10; |SI x [ 18; |HACIENDO x = x + 1;
               pepe = x - 9;
               #0x = #2pepe;
         |SIGUE;
         |PARA x = 97; |SI x [ 107; |HACIENDO x = x + 1;
               pepe = x - 87;
               #0x = #2pepe;
         |SIGUE;
     |FINSI;

     |SI #7#22 = "C"; |O #7#22 = "A";
         |PARA x = 10; |SI x [ 18; |HACIENDO x = x + 1;
               pepe = x + 11;
               #0x = #2pepe;
         |SIGUE;
         |PARA x = 97; |SI x [ 107; |HACIENDO x = x + 1;
               pepe = x - 67;
               #0x = #2pepe;
         |SIGUE;
     |FINSI;
|FPRC;


|PROCESO alta_exist; |TIPO 0;
     |SI FSalida ! 9; |ACABA; |FINSI;

     emp_exis = #0#0;
     act_exis = #0#83;
     any_exis = #0#1;
     |SUB_EJECUTA "eosexis1.run";
     |HAZ existenc;
|FPRC;

|PROCESO existenc;
     |ABRE #12;
     #12#0 = #0#0;
     #12#1 = #0#83;
     #12#2 = #0#1;
     |LEE 040#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
     |CIERRA #12;

     #0#49 = 0;
     |SI #0#2 = 1; #0#49 = #12#7;  |FINSI;
     |SI #0#2 = 2; #0#49 = #12#8;  |FINSI;
     |SI #0#2 = 3; #0#49 = #12#9;  |FINSI;
     |SI #0#2 = 4; #0#49 = #12#10; |FINSI;
     |PINTA #0#49;

     #0#48 = #12#3;
     |PINTA #0#48;
|FPRC;

|| /////////////
|PROCESO ElRestodelCalculo;
          #106#58 = #106#54 - #106#57;

          |SI #106#202 = "S"; |Y #106#58 > 0;  ||nuevo
              #106#203 = #106#58 % 20;
          |SINO;
              #106#203 = 0;
          |FINSI;
          #106#58 = #106#58 - #106#203;

          #106#55 = 0;
|FPRC;

|PROCESO TotalGastos;
    |SI #106#83 ! nClave1;
        |SI nOpe = 0;
            |SI #106#54 > 0;
                nTotalG17 = nTotalG17 + #106#54;
                #106#57   = #106#54 % #106#56;
                |SI #106#57 < 0;  #106#57 = 0;  |FINSI;
                nTotalG21 = nTotalG21 + #106#57;
            |FINSI;
        |SINO;
            |SI #106#54 > 0;
                #106#57 = (#106#54 / nTp) ! 2;
            |SINO;
                #106#57 = 0;
            |FINSI;
            nTotalG21 = nTotalG21 + #106#57;
            |HAZ ElRestodelCalculo;
            |GRABA 040#106a;
        |FINSI;
    |FINSI;
    |LIBERA #106;
|FPRC;

|DEFBUCLE TotalGastos;
     #106#1004;
     ;
     nClave0, 1, nClave2, nClave3;
     nClave0, 6, nClave2, nClave3;
     e;
     NULL, TotalGastos;
|FIN;

|PROCESO RecogeTotalGastos;
     |DBASE aPathModelo;  |QBT aPathModelo;
     aDef = aPathModelo + "def/eosplan1.mas";
     |CARGA_DEF aDef, espejo6@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def eosplan1";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     nTotalG17 = 0;
     nTotalG21 = 0;
     |SI #0#54 > 0;
         nTotalG17 = #0#54;
         nTotalG21 = #0#54 % #0#56;
     |FINSI;

     nClave0 = #0#0;
     nClave1 = #0#83;
     nClave2 = #0#1;
     nClave3 = #0#2;

     nOpe = 0; |BUCLE TotalGastos;
     nOpe = 2;
     nTp  = (100 / #0#56) ! 2;
     |SI nTotalG21 > 2000;
         nTp  = (nTotalG17 / 2000) ! 2;
         nOpe = 1;
     |FINSI;
     nTotalG21 = 0;
     |BUCLE TotalGastos;
     |SI nOpe = 1;
         #0#57 = 2000 - nTotalG21;
     |SINO;
         #0#57 = (#0#54 % #0#56) ! 2;
     |FINSI;
     |SI #0#57 < 0; #0#57 = 0; |FINSI;
     |DESCARGA_DEF #espejo6@;
|FPRC;
|| /////////////

|PROCESO acumular;
     |HAZ funcion_9;

     |HAZ carga_var98;
     |HAZ descarga_var98;

     #0#53 = #0#40 + #0#41 + #0#42 + #0#43 + #0#44 + #0#45 + #0#46 + #0#87 + #0#90 + #0#156;
     #0#53 = #0#53 - #0#51 - #0#52;

     #0#79 = #0#36 + #10#17;

     |SI sw_recal = 0;
         #0#37 = #0#19  + #0#20 + #0#21 + #0#22 + #0#150 + #0#152;
         #0#80 = #10#18 + #0#37;
     |SINO;
         #0#37 = (#10#23 + #0#19 + #0#20 + #0#21 + #0#22 + #0#150 + #0#152) - #10#18;
         #0#80 = #10#23 + #0#19 + #0#20 + #0#21 + #0#22 + #0#150 + #0#152;
     |FINSI;

     |SI sw_recal = 0;
         #0#38 = #0#94;
         #0#81 = #10#19 + #0#94;
     |SINO;
         #0#38 = #10#24 + #0#94 - #10#19;
         #0#81 = #10#24 + #0#94;
     |FINSI;

     #0#39 = #0#37 - #0#38;
     #0#82 = #0#80 - #0#81;
     #0#54 = #0#82;

     |ABRE #6;
     |LIBERA #6;
     |LEE 140#6p;
     |SI FSalida ! 0;
         #6#0 = 1;
         #6#1 = "S";
         |GRABA 140#6n;
     |FINSI;
     |CIERRA #6;

     #0#47 = #0#49 - #0#48;
     #0#54 = #0#82 + #0#47;

     |SI #0#1 ] 0;  |Y #0#1 [ 80;

         #0#57 = #0#54 % #0#56;
         |SI #0#57 < 0; #0#57 = 0; |FINSI;

         |SI #0#57 > 2000; |Y #0#1 = 15;
             #0#57 = 2000;
         |FINSI;

         |SI #0#1 ] 16; |Y #7#46 ! "S";
             |HAZ RecogeTotalGastos;
         |FINSI;

         #0#58 = #0#54 - #0#57;

         |SI #0#202 = "S"; |Y #0#58 > 0;  ||nuevo
             |SI Campo ! 203; |Y Campo ! 59;
                 #0#203 = #0#58 % 20;
             |FINSI;
         |SINO;
             #0#203 = 0;
         |FINSI;
         #0#58 = #0#58 - #0#203;

         #0#55 = 0;
     |SINO;
          |SI #0#1 [ 97;
              |SI #7#22 = "C"; |O #7#22 = "A";
                  |SI #7#23 = "P";
                      #0#55 = #0#80 % 1;
                      |SI #0#55 < 0; #0#55 = 0; |FINSI;
                  |SINO;
                      #0#55 = 0;
                  |FINSI;
                  #0#58 = #0#54 - #0#55;
                  #0#56 = 0;
                  #0#57 = 0;
              |FINSI;

              |SI #7#22 = "B";
                  #0#57 = #0#54 % #0#56;
                  |SI #0#57 < 0; #0#57 = 0; |FINSI;
                  #0#58 = #0#54 - #0#57;
                  #0#55 = 0;
              |FINSI;
          |SINO;
              #0#57 = #0#54 % #0#56;
              |SI #0#57 < 0; #0#57 = 0; |FINSI;
              #0#58 = #0#54 - #0#57;
              #0#55 = 0;
          |FINSI;
     |FINSI;

     |SI #0#1 ] 0;  |Y #0#1 [ 80;
         |ABRE #13;
         #13#0 = #0#0;
         #13#1 = #0#83;
         #13#2 = #0#2 - 1;
         #13#3 = #0#1;
         |LEE 040#13=;
         |SI FSalida ! 0; |DDEFECTO #13; |FINSI;
         |CIERRA #13;
         pagos = #13#28 + #13#29;

         |SI #11#10 = 1; #0#60 = #0#54 % #0#59; |FINSI;
         |SI #11#10 = 2; #0#60 = #0#58 % #0#59; |FINSI;
         #0#61 = #0#60 - #0#79 - pagos;
     |SINO;
         |SI #0#1 [ 93;
             #0#60 = (#0#19 + #0#20 + #0#21 + #0#22 + #0#150) % #0#59;
             |SI #6#1 = "S"; penult = #0#50 % 6; |SINO; penult = 0; |FINSI;
             |SI penult > #0#60; #0#61 = penult; |SINO; #0#61 = #0#60; |FINSI;
             #0#61 = #0#61 - #0#36;
             |SI #0#61 < 0; #0#61 = 0; |FINSI;
         |SINO;
             |ABRE #13;
             #13#0 = #0#0;
             #13#1 = #0#83;
             #13#2 = #0#2 - 1;
             #13#3 = #0#1;
             |LEE 040#13=;
             |SI FSalida ! 0; |DDEFECTO #13; |FINSI;
             |CIERRA #13;
             pagos = #13#28 + #13#29;

             |SI #11#10 = 1; #0#60 = #0#54 % #0#59; |FINSI;
             |SI #11#10 = 2; #0#60 = #0#58 % #0#59; |FINSI;
             #0#61 = #0#60 - #0#79 - pagos;
         |FINSI;
     |FINSI;

     |SI #7#41 = "S";
         #0#54 = 0;
         #0#55 = 0;
         #0#56 = 0;
         #0#57 = 0;
         #0#58 = 0;
         #0#59 = 0;
         #0#60 = 0;
         #0#61 = #0#37 % 2;
     |FINSI;

     |HAZ pinta_pan;
|FPRC;

|PROCESO pinta_pan;
     |PINTA #0#91;   |PINTA #0#92;  |PINTA #0#93;
     |PINTA #0#94;   |PINTA #0#95;  |PINTA #0#51;
     |PINTA #0#36;   |PINTA #0#79;
     |PINTA #0#48;
     |PINTA #0#49;
     |PINTA #0#47;
     |PINTA #0#37;   |PINTA #0#80;
     |PINTA #0#38;   |PINTA #0#81;
     |PINTA #0#39;   |PINTA #0#82;
     |PINTA #0#50;
     |PINTA #0#52;
     |PINTA #0#53;
     |PINTA #0#54;
     |PINTA #0#55;
     |PINTA #0#56;
     |PINTA #0#57;
     |PINTA #0#58;
     |PINTA #0#59;
     |PINTA #0#60;
     |PINTA #0#61;
     |PINTA #0#203;
|FPRC;

|| *************************************************************************
||                     PROCESO CARGA PANTALLAS AUXILIARES
|| *************************************************************************
|PROCESO CalTipoyPer;
     |SI #0#1 ] 80;
         nEjer = 1900 + #0#1;
     |SINO;
         nEjer = 2000 + #0#1;
     |FINSI;

     aTipo = "T";
     |SI aTipo = "F";  aTipo = "T";  |FINSI;
     |SI aTipo = "D";  aTipo = "M";  |FINSI;

     nPer = 7;  |SI aTipo = "T"; nPer = 3; |FINSI;
     nSubeIVA  = 0;
     |SI nEjer = 2010; |Y #0#2 ] nPer;  nSubeIVA = 1;  |FINSI;
     |SI nEjer ] 2011;                  nSubeIVA = 1;  |FINSI;

     nPer = 9;  |SI aTipo = "T"; nPer = 3; |FINSI;
     |SI nEjer = 2012; |Y #0#2 ] nPer;  nSubeIVA = 2;  |FINSI;
     |SI nEjer ] 2013;                  nSubeIVA = 2;  |FINSI;
|FPRC;

|PROCESO calcu_iva_f7; |TIPO 7;
     |HAZ CalTipoyPer;
     aAlfa = "    Base de IVA ";
     |SI nSubeIVA ! 0;
         aAlfa = "    Pulse <F5> para introducir el desglose de IVA  ";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO calcu_rec_f7; |TIPO 7;
     |HAZ CalTipoyPer;
     aAlfa = "    Base de Recargo ";
     |SI nSubeIVA = 2;
         aAlfa = "    Pulse <F5> para introducir el desglose de Recargo  ";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO access_1; |TIPO 0;
     |SI FSalida ! 9; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #0#2;
     #3#1 = #0#1;
     |LEE 040#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     |PUSHV 0501 2380;
     |PINPA #0#99;
     |HAZ carga_var99;
     |PINDA #0#99;

     |ET pide_los;
         |ENDATOS #1#99;
         Suma1 = #99#9  + #99#10 + #99#11 + #99#12;
         Suma2 = #99#13 + #99#14 + #99#15 + #99#40;
         |SI Suma2 > Suma1;
             |MENAV "      El total de Bases de los Recargos es superior al de los I.V.A.";
             |VETE pide_los;
         |FINSI;
     |POPV;
     |SI FSalida = 0;
         |HAZ descarga_var99;
         |HAZ acumular;
     |FINSI;
     |HAZ pinta_pan;
|FPRC;

|PROCESO carga_var99;
     #99#01 = #0#3;
     #99#02 = #0#4;
     #99#03 = #0#5;
     #99#04 = #0#6;
     #99#05 = #0#7;
     #99#06 = #0#8;
     #99#07 = #0#84;
     #99#08 = #0#9;
     #99#09 = #0#19;
     #99#10 = #0#20;
     #99#11 = #0#21;
     #99#12 = #0#22;
     #99#13 = #0#23;
     #99#14 = #0#24;
     #99#15 = #0#85;
     #99#16 = #0#88;
     #99#17 = #0#25;
     #99#18 = #0#62;
     #99#19 = #0#63;
     #99#20 = #0#64;
     #99#21 = #0#65;
     #99#22 = #0#66;
     #99#23 = #0#67;
     #99#24 = #0#86;
     #99#25 = #0#89;
     #99#26 = #0#68;
     #99#27 = #0#40;
     #99#28 = #0#41;
     #99#29 = #0#42;
     #99#30 = #0#43;
     #99#31 = #0#44;
     #99#32 = #0#45;
     #99#33 = #0#87;
     #99#34 = #0#90;
     #99#35 = #0#46;
     #99#36 = #0#150;
     #99#37 = #0#151;
     #99#38 = #0#152;
     #99#39 = #0#153;
     #99#40 = #0#154;
     #99#41 = #0#155;
     #99#42 = #0#156;
|FPRC;

|PROCESO descarga_var99;
     #0#3   = #99#01;
     #0#4   = #99#02;
     #0#5   = #99#03;
     #0#6   = #99#04;
     #0#7   = #99#05;
     #0#8   = #99#06;
     #0#84  = #99#07;
     #0#9   = #99#08;
     #0#19  = #99#09;
     #0#20  = #99#10;
     #0#21  = #99#11;
     #0#22  = #99#12;
     #0#23  = #99#13;
     #0#24  = #99#14;
     #0#85  = #99#15;
     #0#88  = #99#16;
     #0#25  = #99#17;
     #0#62  = #99#18;
     #0#63  = #99#19;
     #0#64  = #99#20;
     #0#65  = #99#21;
     #0#66  = #99#22;
     #0#67  = #99#23;
     #0#86  = #99#24;
     #0#89  = #99#25;
     #0#68  = #99#26;
     #0#40  = #99#27;
     #0#41  = #99#28;
     #0#42  = #99#29;
     #0#43  = #99#30;
     #0#44  = #99#31;
     #0#45  = #99#32;
     #0#87  = #99#33;
     #0#90  = #99#34;
     #0#46  = #99#35;
     #0#150 = #99#36;
     #0#151 = #99#37;
     #0#152 = #99#38;
     #0#153 = #99#39;
     #0#154 = #99#40;
     #0#155 = #99#41;
     #0#156 = #99#42;
|FPRC;

|PROCESO TotalRepNuevo;
    #99nCampo1 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
    #99nCampo2 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;
    nPriIVA  = 0;
    nMasBase = 0;
    |SI #100#6  ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#7;  |FINSI;
    |SI #100#9  ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#10; |FINSI;
    |SI #100#12 ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#13; |FINSI;
    |SI #100#15 ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#16; |FINSI;
    |SI #100#18 ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#19; |FINSI;
    |SI #100#21 ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#22; |FINSI;
    |SI #100#24 ! 0; nMasBase = nMasBase + 1; nPriIVA = #100#23; |FINSI;
    |SI nMasBase ] 2;
        #99nCampo3 = (#99nCampo2 / #99nCampo1) * 100;
    |SINO;
        #99nCampo3 = nPriIVA;
    |FINSI;
|FPRC;

|PROCESO PonDesglose_Ven;

     nTecla = FSalida;
     nCampo = 0;
     |SI Campo = 9;
         nCampo  = 19;
         nCampo1 = 9;
         nCampo2 = 27;
         nCampo3 = 1;
     |FINSI;

     |SI Campo = 10;
         nCampo  = 20;
         nCampo1 = 10;
         nCampo2 = 28;
         nCampo3 = 2;
     |FINSI;

     |SI Campo = 11;
         nCampo  = 21;
         nCampo1 = 11;
         nCampo2 = 29;
         nCampo3 = 3;
     |FINSI;

     |SI Campo = 12;
         nCampo  = 22;
         nCampo1 = 12;
         nCampo2 = 30;
         nCampo3 = 4;
     |FINSI;

     |SI Campo = 13;
         nCampo  = 23;
         nCampo1 = 13;
         nCampo2 = 31;
         nCampo3 = 5;
     |FINSI;

     |SI Campo = 14;
         nCampo  = 24;
         nCampo1 = 14;
         nCampo2 = 32;
         nCampo3 = 6;
     |FINSI;

     |SI Campo = 15;
         nCampo  = 85;
         nCampo1 = 15;
         nCampo2 = 33;
         nCampo3 = 7;
     |FINSI;

     |SI Campo = 40;
         nCampo  = 154;
         nCampo1 = 40;
         nCampo2 = 42;
         nCampo3 = 39;
     |FINSI;

     |SI nCampo = 0; |ACABA; |FINSI;

     |HAZ CalTipoyPer;

     aAlfa = "S";
     |SI nSubeIVA ! 0;  aAlfa = "N"; |FINSI;
     |SI nSubeIVA = 1; |Y Campo > 12;
         aAlfa = "S";
     |FINSI;
     |C_M #99nCampo2, 1, aAlfa;

     |ABRE #100;
     |DDEFECTO #100;
     #100#0 = "PLA";
     #100#1 = #0#0;
     #100#2 = #0#83;
     #100#3 = #0#2;
     #100#4 = #0#1;
     #100#5 = nCampo;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "PLA";
         #100#1 = #0#0;
         #100#2 = #0#83;
         #100#3 = #0#2;
         #100#4 = #0#1;
         #100#5 = nCampo;

         #100#6 = #99nCampo1;
         #100#7 = #99nCampo3;
         #100#8 = #99nCampo2;

         |GRABA 020#100b;
     |FINSI;

     |SI nTecla = 13; |Y nSubeIVA = 1; |Y Campo > 12;
         nTecla = 0;
     |FINSI;

     |SI nTecla = 13; |Y  nSubeIVA ! 0;
         |PUSHV 0501 2380;

         |PINPA #0#100;
         |PINDA #0#100;
         |ENDATOS #1#100;
         nError = FSalida;
         |SI FSalida = 0;
             |HAZ TotalRepNuevo;
         |FINSI;

         |POPV;
     |FINSI;

     |SI nError = 0;
         |SI nSubeIVA = 0;
             #100#6 = #99nCampo1;
             #100#7 = #99nCampo3;
             #100#8 = #99nCampo2;
         |FINSI;
         |SI nSubeIVA = 1; |Y Campo > 12;
             #100#6 = #99nCampo1;
             #100#7 = #99nCampo3;
             #100#8 = #99nCampo2;
         |FINSI;
         |GRABA 020#100a;
     |FINSI;
     |LIBERA #100;
     |CIERRA #100;

     |SI nSubeIVA ! 0;
         |HAZ TotalRepNuevo;
     |FINSI;
     |SI #99nCampo3 = 0;
         |SI nCampo3 = 1; nCampo = 2; |FINSI;
         |SI nCampo3 = 2; nCampo = 3; |FINSI;
         |SI nCampo3 = 3; nCampo = 4; |FINSI;
         |SI nCampo3 = 4; nCampo = 5; |FINSI;

         |SI nCampo3 = 5;  nCampo = 6; |FINSI;
         |SI nCampo3 = 6;  nCampo = 7; |FINSI;
         |SI nCampo3 = 7;  nCampo = 8; |FINSI;
         |SI nCampo3 = 39; nCampo = 13; |FINSI;
         #99nCampo3 = #3nCampo;
     |FINSI;

     |PINTA #99nCampo1;
     |PINTA #99nCampo2;
     |PINTA #99nCampo3;
|FPRC;

|PROCESO PideCuotaReper;  |TIPO 0;
     nCampo = 0;
     |SI Campo = 27;
         nCampo  = 19;
         nCampo1 = 9;
         nCampo2 = 27;
         nCampo3 = 1;
     |FINSI;

     |SI Campo = 28;
         nCampo  = 20;
         nCampo1 = 10;
         nCampo2 = 28;
         nCampo3 = 2;
     |FINSI;

     |SI Campo = 29;
         nCampo  = 21;
         nCampo1 = 11;
         nCampo2 = 29;
         nCampo3 = 3;
     |FINSI;

     |SI Campo = 30;
         nCampo  = 22;
         nCampo1 = 12;
         nCampo2 = 30;
         nCampo3 = 4;
     |FINSI;

     |SI Campo = 31;
         nCampo  = 23;
         nCampo1 = 13;
         nCampo2 = 31;
         nCampo3 = 5;
     |FINSI;

     |SI Campo = 32;
         nCampo  = 24;
         nCampo1 = 14;
         nCampo2 = 32;
         nCampo3 = 6;
     |FINSI;

     |SI Campo = 33;
         nCampo  = 85;
         nCampo1 = 15;
         nCampo2 = 33;
         nCampo3 = 7;
     |FINSI;

     |SI Campo = 42;
         nCampo  = 154;
         nCampo1 = 40;
         nCampo2 = 42;
         nCampo3 = 39;
     |FINSI;

     |SI nCampo = 0; |ACABA; |FINSI;

     |HAZ CalTipoyPer;

     nSwGraba = 0;
     |SI nSubeIVA = 0;                nSwGraba = 1; |FINSI;
     |SI nSubeIVA = 1; |Y Campo > 12; nSwGraba = 1; |FINSI;

     |SI nSwGraba = 1;
         |ABRE #100;
         #100#0 = "PLA";
         #100#1 = #0#0;
         #100#2 = #0#83;
         #100#3 = #0#2;
         #100#4 = #0#1;
         #100#5 = nCampo;
         |LEE 101#100=;
         |SI FSalida ! 0;
             |DDEFECTO #100;
             #100#0 = "PLA";
             #100#1 = #0#0;
             #100#2 = #0#83;
             #100#3 = #0#2;
             #100#4 = #0#1;
             #100#5 = nCampo;
             |GRABA 020#100b;
         |FINSI;
         #100#6 = #99nCampo1;
         #100#7 = #99nCampo3;
         #100#8 = #99nCampo2;
         |GRABA 020#100a;
         |LIBERA #100;
         |CIERRA #100;
     |FINSI;
|FPRC;

|PROCESO calcu_iva_f1; |TIPO 0;
     |BLIN 4;

     nTecla = FSalida;
     campo_f1 = Campo - 8;   ||% de iva
     campo_f2 = Campo + 9;   ||ejercicio
     campo_f3 = Campo + 18;  ||cuota iva
     campo_f4 = Campo - 9;

     |SI Campo = 17; campo_f1 = 8;  campo_f4 = 6;  |FINSI;
     |SI Campo = 15; campo_f4 = 21;                |FINSI;
     |SI Campo = 16; campo_f4 = 22;                |FINSI;
     |SI Campo = 36; campo_f2 = 37; campo_f4 = 36; |FINSI;
     |SI Campo = 40; campo_f1 = 39; campo_f2 = 41; campo_f3 = 42; campo_f4 = 37; |FINSI;

     |HAZ PonDesglose_Ven;

     |SI nCampo = 0;
         |SI Campo ! 16; |Y Campo ! 36;
             #99campo_f3 = #99Campo % #99campo_f1;   |PINTA #99campo_f3;
         |FINSI;
     |FINSI;
     #99campo_f2 = #99Campo + #10campo_f4;   |PINTA #99campo_f2;

     #0#91 = #99#9  + #99#10 + #99#11 + #99#12 + #99#36;
     #0#92 = #99#18 + #99#19 + #99#20 + #99#21 + #99#37;
     #0#93 = #99#27 + #99#28 + #99#29 + #99#30 + #99#31 + #99#32 + #99#33 + #99#34 + #99#42;
|FPRC;

|PROCESO access_2; |TIPO 0;
     |SI FSalida ! 9; |ACABA; |FINSI;

     |PUSHV 0501 2380;
     |PINPA #0#98;
     |HAZ carga_var98;
     |PINDA #0#98;
     |ENDATOS #1#98;
     |POPV;
     |SI FSalida = 0;
         |HAZ descarga_var98;
         |HAZ acumular;
     |FINSI;
     |HAZ pinta_pan;
|FPRC;

|PROCESO carga_var98;
     || Conceptos

     |PARA campo_f1 = 1; |SI campo_f1 [ 9; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 9;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     |PARA campo_f1 = 10; |SI campo_f1 [ 20; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 87;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     || Trimestre

     |PARA campo_f1 = 21; |SI campo_f1 [ 29; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 5;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     |PARA campo_f1 = 30; |SI campo_f1 [ 40; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 78;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     || Ejercicio

     |PARA campo_f1 = 42; |SI campo_f1 [ 50; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 27;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     |PARA campo_f1 = 51; |SI campo_f1 [ 61; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 68;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     || IVA

     |PARA campo_f1 = 63; |SI campo_f1 [ 82; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 67;
           #98campo_f1 = #0campo_f2;
     |SIGUE;

     #98#41 = #0#35;
     #98#62 = #0#78;
     #98#83 = #0#96;
|FPRC;

|PROCESO descarga_var98;
     || Conceptos

     |PARA campo_f1 = 1; |SI campo_f1 [ 9; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 9;
           #0campo_f2  = #98campo_f1;
     |SIGUE;

     |PARA campo_f1 = 10; |SI campo_f1 [ 20; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 87;
           #0campo_f2  = #98campo_f1;
     |SIGUE;

     || Trimestre

     |PARA campo_f1 = 21; |SI campo_f1 [ 29; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 5;
           #0campo_f2  = #98campo_f1;
     |SIGUE;

     |PARA campo_f1 = 30; |SI campo_f1 [ 40; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 78;
           #0campo_f2  = #98campo_f1;
     |SIGUE;

     || Ejercicio

     |PARA campo_f1 = 42; |SI campo_f1 [ 50; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 27;
           #0campo_f2  = #98campo_f1;
     |SIGUE;

     |PARA campo_f1 = 51; |SI campo_f1 [ 61; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 68;
           #0campo_f2  = #98campo_f1;
     |SIGUE;

     || IVA

     |PARA campo_f1 = 63; |SI campo_f1 [ 82; |HACIENDO campo_f1 = campo_f1 + 1;
           campo_f2    = campo_f1 + 67;  #0campo_f2  = #98campo_f1;
     |SIGUE;

     #0#94 = 0
     #0#95 = 0
     #0#51 = 0
     |PARA campo_f1 = 21; |SI campo_f1 [ 40; |HACIENDO campo_f1 = campo_f1 + 1;
                                      #0#94 = #0#94 + #98campo_f1;
           campo_f2 = campo_f1 + 21;  #0#95 = #0#95 + #98campo_f2;
           campo_f3 = campo_f1 + 42;  #0#51 = #0#51 + #98campo_f3;
     |SIGUE;

     #0#78 = #98#62;
     #0#35 = #98#41;
     #0#96 = #98#83;
     #0#51 = #0#51 + #0#90 + #0#96;
|FPRC;

|PROCESO calcu_compra_f1; |TIPO 7;
     |SI Campo = 41;
         entera   = "INVERSIONES";
         entera   = (entera + (" " * 20)) % 120;
     |SINO;
         campo_f1 = Campo - 20;
         entera   = #98campo_f1; |QBF entera;
         entera   = (entera + (" " * 20)) % 120;
     |FINSI;

     |ATRI I;
     |PINTA 0831, entera;
     |ATRI i;
|FPRC;

|PROCESO PonDesglose;
     nTecla  = FSalida;

     nCampo1 = Campo;
     nCampo2 = nCampo1 + 42;
     nCampo  = nCampo1 + 5;
     |SI nCampo1 ] 30;
         nCampo  = nCampo1 + 78;
     |FINSI;

     |SI nCampo = 119;  nCampo = 35;  |FINSI;

     |C_M #98nCampo2, 1, "N";

     |ABRE #100;
     #100#0 = "PLA";
     #100#1 = #0#0;
     #100#2 = #0#83;
     #100#3 = #0#2;
     #100#4 = #0#1;
     #100#5 = nCampo;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "PLA";
         #100#1 = #0#0;
         #100#2 = #0#83;
         #100#3 = #0#2;
         #100#4 = #0#1;
         #100#5 = nCampo;

         #100#6 = #98nCampo1;
         #100#7 = 0;
         #100#8 = #98nCampo2;

         |GRABA 020#100b;
         |SI #98nCampo1 ! 0; nTecla = 13; |FINSI;
     |FINSI;

     |SI nTecla = 13;
         |PUSHV 0501 2380;

         |PINPA #0#100;
         |PINDA #0#100;
         |ENDATOS #1#100;
         nError = FSalida;
         |SI FSalida = 0;
             #98nCampo1 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
             #98nCampo2 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;
         |FINSI;

         |POPV;
     |FINSI;

     |SI nError = 0;
         |GRABA 020#100a;
     |FINSI;
     |LIBERA #100;

     #98nCampo1 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
     #98nCampo2 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;

     |PINTA #98nCampo1;
     |PINTA #98nCampo2;
|FPRC;

|PROCESO calcu_compra_f2; |TIPO 0;
     |HAZ PonDesglose;

     campo_f2  = Campo + 21;
     campo_f3  = Campo - 14;
     |SI Campo > 29; campo_f3 = Campo - 5; |FINSI;
     |SI Campo = 41; campo_f3 = 16;        |FINSI;

     #98campo_f2 = #98Campo + #10campo_f3;   |PINTA #98campo_f2;
|FPRC;

|PROCESO graba_oper; |TIPO 0;
     |SI #0#1 [ 8;  |O #0#1 ] 80;
         |ABRE #8;
         #8#0 = #0#0;
         #8#1 = #0#83;
         #8#2 = #0#2;
         #8#3 = #0#1;
         |LIBERA #8;
         |LEE 140#8=;
         FEstado = FSalida;
         |SI FSalida ! 0; |CDEFECTO #8, 1; |FINSI;

         #8#7  = #0#152;
         #8#8  = #0#150;
         #8#11 = #0#25;
         #8#12 = #0#88;

         |ABRE #3;
         #3#0 = #0#2;
         #3#1 = #0#1;
         |LEE 040#3=;
         |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
         |CIERRA #3;

         #8#9 = 0;
         |SI #0#3 = 0; |Y #3#9  = "S"; #8#9 = #8#9 + #0#19; |FINSI;
         |SI #0#4 = 0; |Y #3#10 = "S"; #8#9 = #8#9 + #0#20; |FINSI;
         |SI #0#5 = 0; |Y #3#11 = "S"; #8#9 = #8#9 + #0#21; |FINSI;
         |SI #0#6 = 0; |Y #3#12 = "S"; #8#9 = #8#9 + #0#22; |FINSI;

         |SI FEstado = 0; |GRABA 140#8a; |SINO; |GRABA 140#8n; |FINSI;
         |CIERRA #8;
     |SINO;
         |ABRE #88;
         #88#0 = #0#0;
         #88#1 = #0#83;
         #88#2 = #0#2;
         #88#3 = #0#1;
         |LEE 101#88=;
         |SI FSalida ! 0;
             |DDEFECTO #88;
             #88#0 = #0#0;
             #88#1 = #0#83;
             #88#2 = #0#2;
             #88#3 = #0#1;
             |GRABA 020#88b;
         |FINSI;

         #88#9  = #0#152;
         #88#10 = #0#150;
         #88#13 = #0#25;
         #88#16 = #0#88;

         |ABRE #3;
         #3#0 = #0#2;
         #3#1 = #0#1;
         |LEE 040#3=;
         |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
         |CIERRA #3;

         #88#11 = 0;
         |SI #0#3 = 0; |Y #3#9  = "S"; #88#11 = #88#11 + #0#19; |FINSI;
         |SI #0#4 = 0; |Y #3#10 = "S"; #88#11 = #88#11 + #0#20; |FINSI;
         |SI #0#5 = 0; |Y #3#11 = "S"; #88#11 = #88#11 + #0#21; |FINSI;
         |SI #0#6 = 0; |Y #3#12 = "S"; #88#11 = #88#11 + #0#22; |FINSI;

         |GRABA 020#88a;
         |LIBERA #88;
         |CIERRA #88;
     |FINSI;
|FPRC;

|PROCESO funcion_9; |TIPO 0;
     |SI FSalida ! 11; |ACABA; |FINSI;

     |PUSHV 0501 2380;

     |SI #0#1 [ 8;  |O #0#1 ] 80;
         |ABRE #8;
         #8#0 = #0#0;
         #8#1 = #0#83;
         #8#2 = #0#2;
         #8#3 = #0#1;
         |LIBERA #8;
         |LEE 140#8=;
         FEstado = FSalida;
         |SI FSalida ! 0; |CDEFECTO #8, 1; |FINSI;
         |PINPA #0#8;

         #8#7  = #0#152;
         #8#8  = #0#150;
         #8#11 = #0#25;
         #8#12 = #0#88;

         |ABRE #3;
         #3#0 = #0#2;
         #3#1 = #0#1;
         |LEE 040#3=;
         |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
         |CIERRA #3;

         #8#9  = 0;
         |SI #0#3 = 0; |Y #3#9  = "S"; #8#9 = #8#9 + #0#19; |FINSI;
         |SI #0#4 = 0; |Y #3#10 = "S"; #8#9 = #8#9 + #0#20; |FINSI;
         |SI #0#5 = 0; |Y #3#11 = "S"; #8#9 = #8#9 + #0#21; |FINSI;
         |SI #0#6 = 0; |Y #3#12 = "S"; #8#9 = #8#9 + #0#22; |FINSI;

         |PINDA #0#8;
         |ENDATOS #1#8;
         |SI FSalida = 0;
             |SI FEstado = 0; |GRABA 140#8a; |SINO; |GRABA 140#8n; |FINSI;
         |FINSI;
         |CIERRA #8;
     |SINO;
         |ABRE #88;
         #88#0 = #0#0;
         #88#1 = #0#83;
         #88#2 = #0#2;
         #88#3 = #0#1;
         |LEE 101#88=;
         |SI FSalida ! 0;
             |DDEFECTO #88;
             #88#0 = #0#0;
             #88#1 = #0#83;
             #88#2 = #0#2;
             #88#3 = #0#1;
             |GRABA 020#88b;
         |FINSI;

         |PINPA #0#88;

         #88#9  = #0#152;
         #88#10 = #0#150;
         #88#13 = #0#25;
         #88#16 = #0#88;

         |ABRE #3;
         #3#0 = #0#2;
         #3#1 = #0#1;
         |LEE 040#3=;
         |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
         |CIERRA #3;

         #88#11 = 0;
         |SI #0#3 = 0; |Y #3#9  = "S"; #88#11 = #88#11 + #0#19; |FINSI;
         |SI #0#4 = 0; |Y #3#10 = "S"; #88#11 = #88#11 + #0#20; |FINSI;
         |SI #0#5 = 0; |Y #3#11 = "S"; #88#11 = #88#11 + #0#21; |FINSI;
         |SI #0#6 = 0; |Y #3#12 = "S"; #88#11 = #88#11 + #0#22; |FINSI;

         |PINDA #0#88;
         |ENDATOS #1#88;
         |SI FSalida = 0;
             |GRABA 020#88a;
         |FINSI;
         |LIBERA #88;
         |CIERRA #88;
     |FINSI;
     |POPV;
|FPRC;

|| *************************************************************************
||                     PROCESO GRABACION MODELOS
|| *************************************************************************

|PROCESO Tipo12; |TIPO 12;

     |SI FSalida ! 7;
         |SI #0#1 = 15;
             |SI #0#203 ! 0;
                 |MENAV "0000Hay Importe en la Reduccion por creacion de empleo, no es correcto para Ejer. 2015.";
             |SINO;
                 #0#202 = "N";
             |FINSI;
         |FINSI;
         |ACABA;
     |FINSI;

     |HAZ CalTipoyPer;
     |SI nEjer [ 2008;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/eosplan1.mas";
     |CARGA_DEF aMas, planilla@;

     |ABRE #1000;
     #1000#0  = #0#0;
     #1000#83 = #0#83;
     #1000#1  = #0#1;
     #1000#2  = #0#2;
     |LEE 000#1000=;
     |SI FSalida ! 0;  |DDEFECTO #1000;  |FINSI;
     |CIERRA #1000;

     |ABRE #100;
     nError = 0;
     |PARA nCampo1 = 26;  |SI nCampo1 [ 34;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 104;
           |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
               #100#0 = "PLA";
               #100#1 = #0#0;
               #100#2 = #0#83;
               #100#3 = #0#2;
               #100#4 = #0#1;
               #100#5 = nCampo1;
               |LEE 000#100=;
               |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

               #98#21 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
               #98#63 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;

               |SI #1000nCampo1 ! #98#21;  |O #1000nCampo2 ! #98#63;
                   nError = 1;
                   |MENAV "0000No se puede cancelar la ficha.";
                   |MENAV "0000Se ha introducido desglose de compras y no coincide con los totales de compras.";
                   |ERROR;
                   |SAL;
               |FINSI;
           |FINSI;
     |SIGUE;

     |SI nError = 1;
         |DESCARGA_DEF #planilla@;
         |ACABA;
     |FINSI;

     nCampo1 = 35;
     nCampo2 = 96;
     |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
         #100#0 = "PLA";
         #100#1 = #0#0;
         #100#2 = #0#83;
         #100#3 = #0#2;
         #100#4 = #0#1;
         #100#5 = nCampo1;
         |LEE 000#100=;
         |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

         #98#21 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
         #98#63 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;

         |SI #1000nCampo1 ! #98#21;  |O #1000nCampo2 ! #98#63;
             |MENAV "0000No se puede cancelar la ficha.";
             |MENAV "0000Se ha introducido desglose de compras y no coincide con los totales de compras.";
             nError = 1;
             |ERROR;
         |FINSI;
     |FINSI;

     |PARA nCampo1 = 108;  |SI nCampo1 [ 118;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 31;
           |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
               #100#0 = "PLA";
               #100#1 = #0#0;
               #100#2 = #0#83;
               #100#3 = #0#2;
               #100#4 = #0#1;
               #100#5 = nCampo1;
               |LEE 000#100=;
               |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

               #98#21 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
               #98#63 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;

               |SI #1000nCampo1 ! #98#21;  |O #1000nCampo2 ! #98#63;
                   |MENAV "0000No se puede cancelar la ficha.";
                   |MENAV "0000Se ha introducido desglose de compras y no coincide con los totales de compras.";
                   |ERROR;
                   |SAL;
               |FINSI;
           |FINSI;
     |SIGUE;

     |SI nError = 1;
         |DESCARGA_DEF #planilla@;
         |ACABA;
     |FINSI;

     |SI nSubeIVA ! 0;
         |PARA nCampo1 = 19;  |SI nCampo1 [ 21;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 21;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
                    #100#0 = "PLA";
                    #100#1 = #0#0;
                    #100#2 = #0#83;
                    #100#3 = #0#2;
                    #100#4 = #0#1;
                    #100#5 = nCampo1;
                    |LEE 000#100=;
                    |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

                    #98#21 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
                    #98#63 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;

                    |SI #1000nCampo1 ! #98#21;  |O #1000nCampo2 ! #98#63;
                        |MENAV "0000No se puede cancelar la ficha.";
                        |MENAV "0000Se ha introducido desglose de ventas y no coincide con los totales de ventas.";
                        |ERROR;
                        |SAL;
                    |FINSI;
                |FINSI;
         |SIGUE;
         |SI nSubeIVA = 2;
             |PARA nCampo1 = 23;  |SI nCampo1 [ 154;  |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2 = nCampo1 + 21;
               |SI nCampo1 ] 85; nCampo2 = nCampo1 + 2; |FINSI;
               |SI #0nCampo1 ! 0;  |O #0nCampo2 ! 0;
                    #100#0 = "PLA";
                    #100#1 = #0#0;
                    #100#2 = #0#83;
                    #100#3 = #0#2;
                    #100#4 = #0#1;
                    #100#5 = nCampo1;
                    |LEE 000#100=;
                    |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

                    #98#21 = #100#6 + #100#9  + #100#12 + #100#15 + #100#18 + #100#21 + #100#24;
                    #98#63 = #100#8 + #100#11 + #100#14 + #100#17 + #100#20 + #100#23 + #100#26;

                    |SI #1000nCampo1 ! #98#21;  |O #1000nCampo2 ! #98#63;
                        |MENAV "0000No se puede cancelar la ficha.";
                        |MENAV "0000Se ha introducido desglose de ventas y no coincide con los totales de ventas.";
                        |ERROR;
                        |SAL;
                    |FINSI;
                |FINSI;
                |SI nCampo1 = 24; nCampo1 = 84;  |FINSI;
                |SI nCampo1 = 85; nCampo1 = 153; |FINSI;
            |SIGUE;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #planilla@;
|FPRC;

|PROCESO grabamod; |TIPO 30;
     |SI #0#1 ] 80;
         nEjer = 1900 + #0#1;
     |SINO;
         nEjer = 2000 + #0#1;
     |FINSI;

     |SI #7#26 ! "N";
         |SI #7#29 = 7;  |Y #7#26 ! "F";
             |CONFI "2400NDesea grabar los DATOS del I.V.A. en el 310 : ";
             |SI FSalida = 0;
                 |SI nEjer ] 1998;
                     |HAZ Graba31098;
                 |FINSI;
             |FINSI;
         |SINO;
             |CONFI "2400NDesea grabar los DATOS del I.V.A. en el modelo: ";
             |SI FSalida = 0;
                 |SI nEjer ] 2009;
                     |HAZ Graba303;
                 |SINO;
                     |HAZ Graba300;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #7#22 = "B"; |O #7#22 = "C";
         |SI sw_esta = 0;
             |CONFI graba2;
             |SI FSalida = 0;
                 |SI #0#1 ] 0;  |Y #0#1 [ 80;
                     |HAZ el130_94;
                     sw_130 = 0; |HAZ graba_glob;
                     sw_130 = 1; |HAZ graba_glob;
                 |SINO;
                     |SI #0#1 [ 93; |HAZ el130_93; |FINSI;
                     |SI #0#1 ] 94; |HAZ el130_94; |FINSI;
                     |SI #0#1 ] 94; sw_130 = 0; |HAZ graba_glob; |FINSI;
                     |SI #0#1 ] 94; sw_130 = 1; |HAZ graba_glob; |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI modifica = 1; |HAZ grademas; |FINSI;
|FPRC;

|PROCESO grademas;
|DDEFECTO #10;
|PARA y = 0; |SI y [ 20; |HACIENDO y = y + 1;
      pep = y + 62;
      #10y = #0pep;
|SIGUE;

|PARA y = 25; |SI y [ 35; |HACIENDO y = y + 1;
      pep   = y + 94;
      #10y  = #0pep;
|SIGUE;

#10#21 = #10#21 + #0#86;
#10#22 = #10#22 + #0#89;
#10#36 = #10#36 + #0#151;
#10#37 = #10#37 + #0#155;

empresa = #0#0;
activ   = #0#83;
anyo    = #0#1;
trime   = #0#2;
trime1  = #0#2 + 1;

|PARA x = trime1; |SI x [ 4; |HACIENDO x = x + 1;
      #0#0  = empresa;
      #0#83 = activ;
      #0#1  = anyo;
      #0#2  = x;
      |LIBERA #0;
      |LEE 140#0=;
      |SI FSalida = 0;
          |PARA y = 0; |SI y [ 20; |HACIENDO y = y + 1;
                pep = y + 19;   #10y  = #10y + #0pep;
                pep = y + 62;   #0pep = #10y;
          |SIGUE;
          |PARA y = 25; |SI y [ 35; |HACIENDO y = y + 1;
                pep = y + 83;   #10y  = #10y + #0pep;
                pep = y + 94;   #0pep = #10y;
          |SIGUE;
          #10#21 = #10#21 + #0#85;  #0#86  = #10#21;
          #10#22 = #10#22 + #0#88;  #0#89  = #10#22;
          #10#36 = #10#36 + #0#150; #0#151 = #10#36;
          #10#37 = #10#37 + #0#154; #0#155 = #10#37;

          #0#82  = #0#80  - #0#81;
          #0#47  = #0#49 - #0#48;
          #0#54  = #0#82 + #0#47;

          |SI #0#1 ] 0;  |Y #0#1 [ 80;
              #0#57 = #0#54 % #0#56;
              |SI #0#57 < 0; #0#57 = 0; |FINSI;
              #0#58 = #0#54 - #0#57;
          |SINO;
              |SI #0#1 [ 97;
                  |SI #7#22 = "C"; |O #7#22 = "A";
                      #0#55 = 0;
                      |SI #7#23 = "P";
                          #0#55 = #0#80 % 1;
                          |SI #0#55 < 0; #0#55 = 0; |FINSI;
                      |FINSI;
                      #0#58 = #0#54 - #0#55;
                  |FINSI;

                  |SI #7#22 = "B";
                      #0#57 = #0#54 % #0#56;
                      |SI #0#57 < 0; #0#57 = 0; |FINSI;
                      #0#58 = #0#54 - #0#57;
                  |FINSI;
              |SINO;
                  #0#57 = #0#54 % #0#56;
                  |SI #0#57 < 0; #0#57 = 0; |FINSI;
                  #0#58 = #0#54 - #0#57;
              |FINSI;
          |FINSI;

          |GRABA 120#0a;
      |FINSI;
|SIGUE;
#0#0  = empresa;
#0#83 = activ;
#0#1  = anyo;
#0#2  = trime;
|LEE 040#0=;
|FPRC;

|PROCESO eosm1300;
     |ABRE #7;
     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     |CIERRA #7;

     prorrata = #7#28;
     |SI prorrata = 0; prorrata = 100; |FINSI;

     TCompra1 = TCompra1 + ((#4#21 / prorrata) * 100);
     PCompra1 = PCompra1 + #4#21;
     TBaseC1  = TBaseC1 + ((#4#70 / prorrata) * 100);
     PBaseC1  = PBaseC1 + #4#70;

     TCompra2 = TCompra2 + ((#4#22 / prorrata) * 100);
     PCompra2 = PCompra2 + #4#22;
     TBaseC2  = TBaseC2  + ((#4#71 / prorrata) * 100);
     PBaseC2  = PBaseC2  + #4#71;

     TCompra3 = TCompra3 + ((#4#51 / prorrata) * 100);
     PCompra3 = PCompra3 + #4#51;
     TBaseC3  = TBaseC3  + ((#4#72 / prorrata) * 100);
     PBaseC3  = PBaseC3  + #4#72;

     TCompra4 = TCompra4 + ((#4#23 / prorrata) * 100);
     PCompra4 = PCompra4 + #4#23;
     TBaseC4  = TBaseC4  + ((#4#73 / prorrata) * 100);
     PBaseC4  = PBaseC4  + #4#73;

     TCompra5 = TCompra5 + ((#4#24 / prorrata) * 100);
     PCompra5 = PCompra5 + #4#24;
     TBaseC5  = TBaseC5  + ((#4#74 / prorrata) * 100);
     PBaseC5  = PBaseC5  + #4#74;

     TCompra6 = TCompra6 + ((#4#43 / prorrata) * 100);
     PCompra6 = PCompra6 + #4#43;
     TBaseC6  = TBaseC6  + ((#4#75 / prorrata) * 100);
     PBaseC6  = PBaseC6  + #4#75;

     TCompra7 = TCompra7 + ((#4#44 / prorrata) * 100);
     PCompra7 = PCompra7 + #4#44;
     TBaseC7  = TBaseC7  + ((#4#76 / prorrata) * 100);
     PBaseC7  = PBaseC7  + #4#76;
|FPRC;

|DEFBUCLE eosm1300;
     #4#1;
     ;
     #0#0, #0#83, 1, #0#1;
     #0#0, #0#83, 3, #0#1;
     e;
     NULL, eosm1300;
|FIN;

|PROCESO eosm1303;
     |ABRE #7;
     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     |CIERRA #7;

     prorrata = #7#28;
     |SI prorrata = 0; prorrata = 100; |FINSI;

     TCompra1 = TCompra1 + ((#44#21 / prorrata) * 100);
     PCompra1 = PCompra1 + #44#21;
     TBaseC1  = TBaseC1 + ((#44#70 / prorrata) * 100);
     PBaseC1  = PBaseC1 + #44#70;

     TCompra2 = TCompra2 + ((#44#22 / prorrata) * 100);
     PCompra2 = PCompra2 + #44#22;
     TBaseC2  = TBaseC2  + ((#44#71 / prorrata) * 100);
     PBaseC2  = PBaseC2  + #44#71;

     TCompra3 = TCompra3 + ((#44#51 / prorrata) * 100);
     PCompra3 = PCompra3 + #44#51;
     TBaseC3  = TBaseC3  + ((#44#72 / prorrata) * 100);
     PBaseC3  = PBaseC3  + #44#72;

     TCompra4 = TCompra4 + ((#44#23 / prorrata) * 100);
     PCompra4 = PCompra4 + #44#23;
     TBaseC4  = TBaseC4  + ((#44#73 / prorrata) * 100);
     PBaseC4  = PBaseC4  + #44#73;

     TCompra5 = TCompra5 + ((#44#24 / prorrata) * 100);
     PCompra5 = PCompra5 + #44#24;
     TBaseC5  = TBaseC5  + ((#44#74 / prorrata) * 100);
     PBaseC5  = PBaseC5  + #44#74;

     TCompra6 = TCompra6 + ((#44#43 / prorrata) * 100);
     PCompra6 = PCompra6 + #44#43;
     TBaseC6  = TBaseC6  + ((#44#75 / prorrata) * 100);
     PBaseC6  = PBaseC6  + #44#75;

     TCompra7 = TCompra7 + ((#44#44 / prorrata) * 100);
     PCompra7 = PCompra7 + #44#44;
     TBaseC7  = TBaseC7  + ((#44#76 / prorrata) * 100);
     PBaseC7  = PBaseC7  + #44#76;
|FPRC;

|DEFBUCLE eosm1303;
     #44#1;
     ;
     #0#0, #0#83, 1, #0#1;
     #0#0, #0#83, 3, #0#1;
     e;
     NULL, eosm1303;
|FIN;

|PROCESO Busca100;
     nSwAcum = 0;

     |PARA nPara11 = 6;  |SI nPara11 [ 24;  |HACIENDO nPara11 = nPara11 + 3;
           nPara22 = nPara11 + 1;
           nPara33 = nPara11 + 2;

           |SI #1100nPara2 = #100nPara22;
               #100nPara11 = #100nPara11 + #1100nPara1;
               #100nPara22 = #1100nPara2;
               #100nPara33 = #100nPara33 + #1100nPara3;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     |PARA nPara11 = 6;  |SI nPara11 [ 24;  |HACIENDO nPara11 = nPara11 + 3;
           nPara22 = nPara11 + 1;
           nPara33 = nPara11 + 2;

           |SI #100nPara11 = 0;  |Y #100nPara22 = 0;  |Y #100nPara33 = 0;
               #100nPara11 = #1100nPara1;
               #100nPara22 = #1100nPara2;
               #100nPara33 = #1100nPara3;
               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO GrabaCalcDesglose;
     #1100#0 = "PLA";
     #1100#1 = #0#0;
     #1100#2 = #0#83;
     #1100#3 = #0#2;
     #1100#4 = #0#1;
     #1100#5 = Campos2;
     |LEE 000#1100=;
     |SI FSalida ! 0;
         |DDEFECTO #1100;
         |SI Campos2 = 25;
             #1100#6 = #0#25;
             #1100#7 = #0#9;
             #1100#8 = #0#46;
         |FINSI;
     |FINSI;

     #100#0 = "303";
     #100#1 = #0#0;
     #100#2 = #0#83;
     #100#3 = #0#2;
     #100#4 = #0#1;
     #100#5 = nCampoDes;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #0#0;
         #100#2 = #0#83;
         #100#3 = #0#2;
         #100#4 = #0#1;
         #100#5 = nCampoDes;
         |GRABA 020#100b;
     |FINSI;

     nTotal0 = 0;
     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #1100nPara1 ! 0;  |O #1100nPara3 ! 0;
               |SI #1100nPara2 = 0; |Y #1100nPara3 = 0;
                    |Y nCampoDes > 50; |Y nCampoDes ! 72; |Y nCampoDes ! 75;
                   nTotal0 = nTotal0 + #1100nPara1;
               |SINO;
                   |HAZ Busca100;
               |FINSI;
           |FINSI;
     |SIGUE;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

|PROCESO eosma100;
     |BORRA 020#100a;
     |LIBERA #100;
|FPRC;

|DEFBUCLE eosma100;
     #100#1;
     ;
     "303", #0#0, #0#83, #0#2, #0#1, 000;
     "303", #0#0, #0#83, #0#2, #0#1, 999;
     be;
     NULL, eosma100;
|FIN;

|PROCESO CalculaIva;
     |SI nEjer ] 2009;
         |BUCLE eosma100;

         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/eosma100.mas";
         |CARGA_DEF aMas, desglose@;

         |ABRE #1100;
     |FINSI;

    Compra1 = 0;
    Compra2 = 0;
    Compra4 = 0;
    Compra5 = 0;
    Compra7 = 0;

    BaseC1  = 0;
    BaseC2  = 0;
    BaseC4  = 0;
    BaseC5  = 0;
    BaseC7  = 0;

    |ABRE #2;
    #2#0 = #0#1;
    |LEE 040#2=;
    |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
    |CIERRA #2;

    |ABRE #100;
    |SI #7#22 = "B"; |O #7#22 = "N";
        |PARA Campos = 130; |SI Campos [ 149; |HACIENDO Campos = Campos + 1;
              Campos1 = Campos - 89;
              |SI Campos [ 138;
                  Campos2 = Campos - 104;
              |SINO;
                  Campos2 = Campos - 31;
              |FINSI;

              |SI #0Campos ! 0;
                  |SI #2Campos1 = 1;
                      Compra1   = Compra1 + #0Campos;
                      BaseC1    = BaseC1  + #0Campos2;
                      nCampoDes = 70;

                      |SI nEjer ] 2009; |HAZ GrabaCalcDesglose; BaseC1 = BaseC1 - nTotal0; |FINSI;
                  |FINSI;

                  |SI #2Campos1 = 2;
                      Compra2   = Compra2 + #0Campos;
                      BaseC2    = BaseC 2 + #0Campos2;
                      nCampoDes = 71;

                      |SI nEjer ] 2009; |HAZ GrabaCalcDesglose; BaseC2 = BaseC2 - nTotal0; |FINSI;
                  |FINSI;

                  |SI #2Campos1 = 3;
                      Compra4   = Compra4 + #0Campos;
                      BaseC4    = BaseC4  + #0Campos2;
                  |FINSI;

                  |SI #2Campos1 = 4;
                      Compra5  = Compra5 + #0Campos;
                      BaseC5    = BaseC5  + #0Campos2;
                  |FINSI;

                  |SI #2Campos1 = 5;
                      Compra7   = Compra7 + #0Campos;
                      BaseC7    = BaseC7  + #0Campos2;
                      nCampoDes = 76;

                      |SI nEjer ] 2009; |HAZ GrabaCalcDesglose; BaseC7 = BaseC7 - nTotal0; |FINSI;
                  |FINSI;
              |FINSI;
        |SIGUE;
    |FINSI;

    |SI #7#22 = "C"; |O #7#22 = "A";
        |PARA Campos = 130; |SI Campos [ 149; |HACIENDO Campos = Campos + 1;
              Campos1 = Campos - 69;
              |SI Campos [ 138;
                  Campos2 = Campos - 104;
              |SINO;
                  Campos2 = Campos - 31;
              |FINSI;
              |SI #0Campos ! 0;
                  |SI #2Campos1 = 1;
                      Compra1   = Compra1 + #0Campos;
                      BaseC1    = BaseC1  + #0Campos2;
                      nCampoDes = 70;

                      |SI nEjer ] 2009; |HAZ GrabaCalcDesglose; BaseC1 = BaseC1 - nTotal0; |FINSI;
                  |FINSI;

                  |SI #2Campos1 = 2;
                      Compra2   = Compra2 + #0Campos;
                      BaseC2    = BaseC2  + #0Campos2;
                      nCampoDes = 71;

                      |SI nEjer ] 2009; |HAZ GrabaCalcDesglose; BaseC2 = BaseC2 - nTotal0; |FINSI;
                  |FINSI;

                  |SI #2Campos1 = 3;
                      Compra4   = Compra4 + #0Campos;
                      BaseC4    = BaseC4  + #0Campos2;
                  |FINSI;

                  |SI #2Campos1 = 4;
                      Compra5  = Compra5 + #0Campos;
                      BaseC5    = BaseC5  + #0Campos2;
                  |FINSI;

                  |SI #2Campos1 = 5;
                      Compra7   = Compra7 + #0Campos;
                      BaseC7    = BaseC7  + #0Campos2;
                      nCampoDes = 76;

                      |SI nEjer ] 2009; |HAZ GrabaCalcDesglose; BaseC7 = BaseC7 - nTotal0; |FINSI;
                  |FINSI;
              |FINSI;
        |SIGUE;
    |FINSI;

    |SI nEjer ] 2009;
        |SI #0#96 ! 0;  |O #0#35 ! 0;
            Campos2   = 35;
            nCampoDes = 75;
            |HAZ GrabaCalcDesglose;
        |FINSI;
    |FINSI;

    |HAZ CalTipoyPer;
    |SI nSubeIVA ! 0;
        nCampoDes = 2;
        |SI #0#19 ! 0;  |O #0#40 ! 0;
            Campos2   = 19;
            nCampoDes = nCampoDes + 3;   ||5
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#20 ! 0;  |O #0#41  ! 0;
            Campos2   = 20;
            nCampoDes = nCampoDes + 3;   ||8;
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#21 ! 0;  |O #0#42 ! 0;
            Campos2   = 21;
            nCampoDes = nCampoDes + 3;   ||11;
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#22 ! 0;  |O #0#43 ! 0;
            Campos2   = 22;
            nCampoDes = nCampoDes  + 3;  ||11;
            |SI nCampoDes > 11; nCampoDes = 11; |FINSI;
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#25 ! 0; |O #0#46 ! 0;
            Campos2   = 25;
            nCampoDes = nCampo1Inv;
            |SI nCampoDes > 11; nCampoDes = 11; |FINSI;
            |HAZ GrabaCalcDesglose;
        |FINSI;
    |FINSI;
    |SI nSubeIVA  = 2;
        nCampoDes = 11;
        |SI #0#23 ! 0;  |O #0#44 ! 0;
            Campos2   = 23;
            nCampoDes = nCampoDes + 3;   ||14;
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#24 ! 0;  |O #0#45  ! 0;
            Campos2   = 24;
            nCampoDes = nCampoDes + 3;   ||17
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#85 ! 0;  |O #0#87 ! 0;
            Campos2   = 85;
            nCampoDes = nCampoDes + 3;   ||46;
            |SI nCampoDes > 17; nCampoDes = 46; |FINSI;
            |HAZ GrabaCalcDesglose;
        |FINSI;
        |SI #0#154 ! 0;  |O #0#156 ! 0;
            Campos2   = 154;
            nCampoDes = nCampoDes  + 3;  ||46;
            |SI nCampoDes > 17; nCampoDes = 46; |FINSI;
            |HAZ GrabaCalcDesglose;
        |FINSI;
    |FINSI;

    |CIERRA #100;

    |SI nEjer ] 2009;
         |CIERRA #1100;
         |DESCARGA_DEF #desglose@;
     |FINSI;
|FPRC;

|PROCESO prorrata;
     empresa    = #0#0;
     activ      = #0#83;
     anyo       = #0#1;
     trime      = #0#2;
     ventas_con = 0;
     ventas_sin = 0;

     TCompra1   = 0;  PCompra1   = 0;
     TCompra2   = 0;  PCompra2   = 0;
     TCompra3   = 0;  PCompra3   = 0;
     TCompra4   = 0;  PCompra4   = 0;
     TCompra5   = 0;  PCompra5   = 0;
     TCompra6   = 0;  PCompra6   = 0;
     TCompra7   = 0;  PCompra7   = 0;

     TBaseC1    = 0;  PBaseC1    = 0;
     TBaseC2    = 0;  PBaseC2    = 0;
     TBaseC3    = 0;  PBaseC3    = 0;
     TBaseC4    = 0;  PBaseC4    = 0;
     TBaseC5    = 0;  PBaseC5    = 0;
     TBaseC6    = 0;  PBaseC6    = 0;
     TBaseC7    = 0;  PBaseC7    = 0;

     |PARA x = 1; |SI x [ 4; |HACIENDO x = x + 1;
           #0#0  = empresa;
           #0#83 = activ;
           #0#1  = anyo;
           #0#2  = x;
           |LEE 040#0=;
           |SI FSalida = 0;
               |SI #0#3 ! 0; ventas_con = ventas_con + #0#19; |FINSI;
               |SI #0#4 ! 0; ventas_con = ventas_con + #0#20; |FINSI;
               |SI #0#5 ! 0; ventas_con = ventas_con + #0#21; |FINSI;
               |SI #0#6 ! 0; ventas_con = ventas_con + #0#22; |FINSI;

               |SI #0#3 = 0; ventas_sin = ventas_sin + #0#19; |FINSI;
               |SI #0#4 = 0; ventas_sin = ventas_sin + #0#20; |FINSI;
               |SI #0#5 = 0; ventas_sin = ventas_sin + #0#21; |FINSI;
               |SI #0#6 = 0; ventas_sin = ventas_sin + #0#22; |FINSI;
               ventas_sin = ventas_sin + #0#150;
           |FINSI;
     |SIGUE;

     |SI #7#28 = 0;                              || modificado por
         ventas_con = ventas_con + ventas_sin;   || R.aura
         ventas_sin = 0;                         || es referido a la prorrata
     |FINSI;                                     || si no hay que no la calcule

     #0#0  = empresa;
     #0#83 = activ;
     #0#1  = anyo;
     #0#2  = trime;
     |LEE 040#0=;

     |ABRE #17;
     #17#0 = #0#0;
     #17#1 = #0#1;
     #17#2 = #0#83;
     |BORRA 140#17c;
     |LIBERA #17;

     |HAZ CalculaIva;

     |SI #0#1 ] 9;  |Y #0#1 < 80;
         |BUCLE eosm1303;
     |SINO;
         |BUCLE eosm1300;
     |FINSI;

       |DDEFECTO #17;
       #17#0  = #0#0;
       #17#1  = #0#1;
       #17#2  = #0#83;
       #17#3  = #1#3;
       #17#4  = "P";
       #17#5  = ventas_con;
       #17#6  = ventas_sin;
       #17#7  = ventas_con + ventas_sin;
       #17#8  = (((#17#5 / #17#7) * 100) + 0.49) ! 0;
       |SI #17#8 = 0; #17#8 = 100;  |FINSI;

       #17#9  = TCompra1 + Compra1;

       #17#16 = #17#9 % #17#8;
       #17#23 = PCompra1;
       #17#30 = #17#16 - #17#23;
       _17_9  = TBaseC1 + BaseC1;
       _17_16  = _17_9 % #17#8;
       _17_23  = PBaseC1;
       _17_30  = _17_16 - _17_23;

       #17#10 = TCompra2 + Compra2;
       #17#17 = #17#10 % #17#8;
       #17#24 = PCompra2;
       #17#31 = #17#17 - #17#24;
       _17_10 = TBaseC2 + BaseC2;
       _17_17 = _17_10 % #17#8;
       _17_24 = PBaseC2;
       _17_31 = _17_17 - _17_24;

       #17#11 = TCompra3 + #0#90;
       #17#18 = #17#11 % #17#8;
       #17#25 = PCompra3;
       #17#32 = #17#18 - #17#25;
       _17_11 = TBaseC3 + #0#88;
       _17_18 = _17_11 % #17#8;
       _17_25 = PBaseC3;
       _17_32 = _17_18 - _17_25;

       #17#12 = TCompra4 + Compra4;
       #17#19 = #17#12 % #17#8;
       #17#26 = PCompra4;
       #17#33 = #17#19 - #17#26;
       _17_12 = TBaseC4 + BaseC4;
       _17_19 = _17_12 % #17#8;
       _17_26 = PBaseC4;
       _17_33 = _17_19 - _17_26;

       #17#13 = TCompra5 + Compra5;
       #17#20 = #17#13 % #17#8;
       #17#27 = PCompra5;
       #17#34 = #17#20 - #17#27;
       _17_13 = TBaseC5 + BaseC5;
       _17_20 = _17_13 % #17#8;
       _17_27 = PBaseC5;
       _17_34 = _17_20 - _17_27;

       #17#14 = TCompra6 + #0#96;
       #17#21 = #17#14 % #17#8;
       #17#28 = PCompra6;
       #17#35 = #17#21 - #17#28;
       _17_14 = TBaseC6 + #0#35;
       _17_21 = _17_14 % #17#8;
       _17_28 = PBaseC6;
       _17_35 = _17_21 - _17_28;

       #17#15 = TCompra7 + Compra7;
       #17#22 = #17#15 % #17#8;
       #17#29 = PCompra7;
       #17#36 = #17#22 - #17#29;
       _17_15 = TBaseC7 + BaseC7;
       _17_22 = _17_15 % #17#8;
       _17_29 = PCompra7;
       _17_36 = _17_22 - _17_29;

       #17#37 = #17#9  + #17#10 + #17#11 + #17#12 + #17#13 + #17#14 + #17#15;
       #17#38 = #17#16 + #17#21;
       #17#39 = #17#23 + #17#28;
       #17#40 = #17#30 + #17#35;
       |GRABA 040#17n;
       |CIERRA #17;

     |ABRE #7;
     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1 + 1;
     |LIBERA #7;
     |LEE 040#7=;
     |SI FSalida = 0;
         #7#28 = #17#8;
         |GRABA 020#7a;
     |SINO;
         #7#0 = #0#0;
         #7#1 = #0#83;
         #7#2 = #0#1;
         |LIBERA #7;
         |LEE 140#7=;
         |SI FSalida = 0;
            #7#2 = #0#1 + 1;
            #7#28 = #17#8;
            |GRABA 140#7n;
         |FINSI;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO Graba300;
     |SI #0#2 = 4; |HAZ prorrata; |FINSI;

     |HAZ graba_oper;

     |ABRE #4;
     #4#0  = #0#0;
     #4#1  = #0#2;
     #4#2  = #0#1;
     #4#45 = #0#83;
     |LIBERA #4;
     |LEE 140#4=;
     |SI FSalida = 0; |BORRA 140#4c; |LIBERA #4; |FINSI;

     |DDEFECTO #4;
     #4#0  = #0#0;
     #4#1  = #0#2;
     #4#2  = #0#1;
     #4#45 = #0#83;
     |SI #0#19 ! 0; |Y #0#20 ! 0; |Y #0#21 ! 0; |Y #0#22 ! 0;
         base = 0;
         importe = 0;
         |PARA x = 3; |SI x [ 6; |HACIENDO x = x + 1;
              pepa = x + 37;
              pepe = x + 16;

              |SI x = 3; juan1 =  5; juan2 = 6;  juan3 =  7; |FINSI;
              |SI x = 4; juan1 =  8; juan2 = 9;  juan3 = 10; |FINSI;
              |SI x = 5; juan1 = 11; juan2 = 12; juan3 = 13; |FINSI;
              |SI x = 6; juan1 = 11; juan2 = 12; juan3 = 13; |FINSI;
              |SI x = 7; juan1 = 14; juan2 = 15; juan3 = 16; |FINSI;
              |SI x = 8; juan1 = 17; juan2 = 18; juan3 = 19; |FINSI;
              |SI #0x ! 0;
                  |SI x = 5; |O x = 6;
                      base = base + #0pepe;
                      iva = 0;
                      importe = importe + #0pepa;
                      #4juan1 = base;
                      #4juan3 = importe;
                      #4juan2 = #0x;
                      |SI #0#5 ! 0;  |Y #0#6 ! 0;
                          #4juan2 = 0;
                      |FINSI;
                  |SINO;
                      #4juan1 = #0pepe;
                      #4juan2 = #0x;
                      #4juan3 = #0pepa;
                  |FINSI;
              |FINSI;
         |SIGUE;
     |SINO;
        juan1 = 5; juan2 = 6; juan3 = 7;
        |PARA x = 3; |SI x [ 6; |HACIENDO x = x + 1;
              pepa = x + 37;
              pepe = x + 16;
              |SI #0pepe ! 0;
                  #4juan1 = #0pepe;
                  #4juan2 = #0x;
                  #4juan3 = #0pepa;
                  juan1 = juan1 + 3;
                  juan2 = juan2 + 3;
                  juan3 = juan3 + 3;
              |FINSI;
        |SIGUE;

        |PARA x = 5; |SI x [ 11; |HACIENDO x = x + 3;
              pepe = x + 1;
              |SI #4x = 0; #4pepe = 0; |FINSI;
        |SIGUE;
     |FINSI;

     |SI #0#25 ! 0;
        nSwEsta = 0;
        |PARA juan2 = 6; |SI juan2 [ 12; |HACIENDO juan2 = juan2 + 3;
              juan1 = juan2 - 1;
              juan3 = juan2 + 1;
              |SI #4juan2 = #0#9;
                  #4juan1 = #4juan1 + #0#25;
                  #4juan3 = #4juan3 + #0#46;
                  nSwEsta = 1;
                  |SAL;
              |FINSI;
        |SIGUE;

        |SI nSwEsta = 0;
            |PARA juan2 = 6; |SI juan2 [ 12; |HACIENDO juan2 = juan2 + 3;
                  juan1 = juan2 - 1;
                  juan3 = juan2 + 1;
                  |SI #4juan2 = 0;  |Y #4juan1 = 0; |Y #4juan3 = 0;
                      #4juan1 = #0#25;
                      #4juan2 = #0#9;
                      #4juan3 = #0#46;
                      |SAL;
                  |SINO;
                      |SI #4juan2 = 0;
                          #4juan1 = #4juan1 + #0#25;
                          #4juan3 = #4juan3 + #0#46;
                          |SAL;
                      |FINSI;
                  |FINSI;
            |SIGUE;
        |FINSI;
     |FINSI;

/*
     |SI #0#88 ! 0;  |O #0#90 ! 0;
         Base1 = 0;  Base2 = 0;  Base3 = 0;  Base4 = 0;
         Porc1 = 0;  Porc2 = 0;  Porc3 = 0;  Porc4 = 0;
         Cuot1 = 0;  Cuot2 = 0;  Cuot3 = 0;  Cuot4 = 0;

         |HAZ DesgloIvaIntra;

         #4#49 = #0#88;
         #4#50 = #0#90;
         #4#51 = #4#50;

         #4#58 = Base1;  #4#59 = Porc1;  #4#60 = Cuot1;
         #4#61 = Base2;  #4#62 = Porc2;  #4#63 = Cuot2;
         #4#64 = Base3;  #4#65 = Porc3;  #4#66 = Cuot3;
         #4#67 = Base4;  #4#68 = Porc4;  #4#69 = Cuot4;
     |FINSI;
*/

     #4#54 = #0#152;
     contador = 0;
     |PARA x = 1; |SI x [ 3; |HACIENDO x = x + 1;
           |SI x = 1; pepin = 7;   pepe  = 23; pepa  = 44; |FINSI;
           |SI x = 2; pepin = 8;   pepe  = 24; pepa  = 45; |FINSI;
           |SI x = 3; pepin = 84;  pepe  = 85; pepa  = 87; |FINSI;
           |SI #0pepe ! 0;
               contador = contador + 1;
               |SI contador = 1; juan1 = 14; juan2 = 15; juan3 = 16; |FINSI;
               |SI contador = 2; juan1 = 17; juan2 = 18; juan3 = 19; |FINSI;
               |SI contador = 3; juan1 = 46; juan2 = 47; juan3 = 48; |FINSI;

               #4juan1 = #0pepe;
               #4juan2 = #0pepin;
               #4juan3 = #0pepa;
          |FINSI;
     |SIGUE;

     |PARA x = 1; |SI x [ 3; |HACIENDO x = x + 3;
           |SI x = 1; pepa = 14; pepe = 15; |FINSI;
           |SI x = 2; pepa = 17; pepe = 18; |FINSI;
           |SI x = 3; pepa = 46; pepe = 47; |FINSI;
           |SI #4pepa = 0; #4pepe = 0; |FINSI;
     |SIGUE;

     |SI #0#2 = 4;
         #4#21 = #17#30;
         #4#22 = #17#31;
         #4#51 = #17#32;
         #4#23 = #17#33;
         #4#24 = #17#34;
         #4#43 = #17#35;
         #4#44 = #17#36;

         #4#70 = _17_30;
         #4#71 = _17_31;
         #4#72 = _17_32;
         #4#73 = _17_33;
         #4#74 = _17_34;
         #4#75 = _17_35;
         #4#76 = _17_36;
     |SINO;
         |HAZ CalculaIva;

         |SI #7#28 ! 0; #4#21 = Compra1 % #7#28; |FINSI;
         |SI #7#28 ! 0; #4#70 = BaseC1  % #7#28; |FINSI;
         |SI #7#28 = 0; #4#21 = Compra1;         |FINSI;
         |SI #7#28 = 0; #4#70 = BaseC1;          |FINSI;

         |SI #7#28 ! 0; #4#22 = Compra2 % #7#28; |FINSI;
         |SI #7#28 ! 0; #4#71 = BaseC2  % #7#28; |FINSI;
         |SI #7#28 = 0; #4#22 = Compra2;         |FINSI;
         |SI #7#28 = 0; #4#71 = BaseC2;          |FINSI;

         |SI #7#28 ! 0; #4#51 = #0#90 % #7#28;   |FINSI;
         |SI #7#28 ! 0; #4#72 = #0#88 % #7#28;   |FINSI;
         |SI #7#28 = 0; #4#51 = #0#90;           |FINSI;
         |SI #7#28 = 0; #4#72 = #0#88;           |FINSI;

         |SI #7#28 ! 0; #4#23 = Compra4 % #7#28; |FINSI;
         |SI #7#28 ! 0; #4#73 = BaseC4  % #7#28; |FINSI;
         |SI #7#28 = 0; #4#23 = Compra4;         |FINSI;
         |SI #7#28 = 0; #4#73 = BaseC4;          |FINSI;

         |SI #7#28 ! 0; #4#24 = Compra5 % #7#28; |FINSI;
         |SI #7#28 ! 0; #4#74 = BaseC5  % #7#28; |FINSI;
         |SI #7#28 = 0; #4#24 = Compra5;         |FINSI;
         |SI #7#28 = 0; #4#74 = BaseC5;          |FINSI;

         |SI #7#28 ! 0; #4#43 = #0#96 % #7#28;   |FINSI;
         |SI #7#28 ! 0; #4#75 = #0#35 % #7#28;   |FINSI;
         |SI #7#28 = 0; #4#43 = #0#96;           |FINSI;
         |SI #7#28 = 0; #4#75 = #0#35;           |FINSI;

         |SI #7#28 ! 0; #4#44 = Compra7 % #7#28; |FINSI;
         |SI #7#28 ! 0; #4#76 = BaseC7  % #7#28; |FINSI;
         |SI #7#28 = 0; #4#44 = Compra7;         |FINSI;
         |SI #7#28 = 0; #4#76 = BaseC7;          |FINSI;
     |FINSI;

     #4#20 = #4#7  + #4#10 + #4#13 + #4#16 + #4#19 + #4#48 + #4#50;
     #4#25 = #4#21 + #4#22 + #4#23 + #4#24 + #4#43 + #4#44 + #4#51;
     #4#26 = #4#20 - #4#25;
     #4#27 = 100;
     #4#28 = #4#26;
     #4#29 = #0#52;

     total = #4#28 - #4#29 + #4#30;
     |SI total = 0; #4#33 = 0; #4#31 = 0; #4#32 = 0; |FINSI;

     |SI total > 0;
         #4#33 = total; #4#31 = 0; #4#32 = 0;
     |SINO;
         total = total * (-1);
         |SI #4#1 ! 4;
             #4#32 = total;
             #4#31 = 0;
             #4#33 = 0;
         |SINO;
             empresa_d = #0#0;
             activid_d = #0#83;
             anyo_d    = #0#1;
             |HAZ Preg_Devol;

             |SI #7#27 = "C"; #4#32 = total; #4#31 = 0; #4#33 = 0; |FINSI;
             |SI #7#27 = "D"; #4#31 = total; #4#32 = 0; #4#33 = 0; |FINSI;
         |FINSI;
     |FINSI;

     |GRABA 140#4n;
     |LIBERA #4;
     |CIERRA #4;

     se_empre  = #4#0;
     se_ejerc  = #4#2;
     se_perio  = #4#1;
     se_tipos  = 300;
     se_activ  = #4#45;
     se_impor  = 0;
     |SI #4#33 > 0; se_impor =  #4#33; |FINSI;
     |SI #4#32 > 0; se_impor = -#4#32; |FINSI;
     |SI #4#31 > 0; se_impor = -#4#31; |FINSI;
     se_fecha  = #4#3;
     se_factu  = "";
     |HAZ seguimie;
|FPRC;

|PROCESO PonPorceCompra;
     #100#0 = "303";
     #100#1 = #0#0;
     #100#2 = #0#83;
     #100#3 = #0#2;
     #100#4 = #0#1;
     #100#5 = nCampoDes;
     |LEE 101#100=;
     |SI FSalida = 0;
         #100#6  = #100#6  % nPorce1;
         #100#8  = #100#8  % nPorce2;
         #100#9  = #100#9  % nPorce1;
         #100#11 = #100#11 % nPorce2;
         #100#12 = #100#12 % nPorce1;
         #100#14 = #100#14 % nPorce2;
         #100#15 = #100#15 % nPorce1;
         #100#17 = #100#17 % nPorce2;
         #100#18 = #100#18 % nPorce1;
         #100#20 = #100#20 % nPorce2;
         #100#21 = #100#21 % nPorce1;
         #100#23 = #100#23 % nPorce2;

         |GRABA 020#100a;
         |LIBERA #100;
     |FINSI;
|FPRC;

|PROCESO Graba100_303_Adq;
     nSuma = #44#58 + #44#61 + #44#64 + #44#67;
     |SI nSuma = 0;
         |SI #0#88 ! 0;  |O #0#90 ! 0;
             #44#58 = #0#88;
             #44#59 = (#0#90 * 100) / #0#88;
             #44#60 = #0#90;
         |FINSI;
     |FINSI;

     |DDEFECTO #100;
     #100#0  = "303";
     #100#1  = #44#0;
     #100#2  = #44#45;
     #100#3  = #44#1;
     #100#4  = #44#2;
     #100#5  = 72;
     #100#6  = #44#58;
     #100#7  = #44#59;
     #100#8  = #44#60;
     #100#9  = #44#61;
     #100#10 = #44#62;
     #100#11 = #44#63;
     #100#12 = #44#64;
     #100#13 = #44#65;
     #100#14 = #44#66;
     #100#15 = #44#67;
     #100#16 = #44#68;
     #100#17 = #44#69;

     |GRABA 020#100n;
     |LIBERA #100;
|FPRC;

|PROCESO Graba303;
     |SI #0#2 = 4; |HAZ prorrata; |FINSI;

     |HAZ graba_oper;

     |ABRE #44;
     #44#0  = #0#0;
     #44#1  = #0#2;
     #44#2  = #0#1;
     #44#45 = #0#83;
     |LIBERA #44;
     |LEE 140#44=;
     |SI FSalida = 0; |BORRA 140#44c; |LIBERA #44; |FINSI;

     |DDEFECTO #44;
     #44#0  = #0#0;
     #44#1  = #0#2;
     #44#2  = #0#1;
     #44#45 = #0#83;
     |SI #0#19 ! 0; |Y #0#20 ! 0; |Y #0#21 ! 0; |Y #0#22 ! 0;
         base = 0;
         importe = 0;
         |PARA x = 3; |SI x [ 6; |HACIENDO x = x + 1;
              pepa = x + 37;
              pepe = x + 16;

              |SI x = 3; juan1 =  5; juan2 = 6;  juan3 =  7; |FINSI;
              |SI x = 4; juan1 =  8; juan2 = 9;  juan3 = 10; |FINSI;
              |SI x = 5; juan1 = 11; juan2 = 12; juan3 = 13; |FINSI;
              |SI x = 6; juan1 = 11; juan2 = 12; juan3 = 13; |FINSI;
              |SI x = 7; juan1 = 14; juan2 = 15; juan3 = 16; |FINSI;
              |SI x = 8; juan1 = 17; juan2 = 18; juan3 = 19; |FINSI;
              |SI #0x ! 0;
                  |SI x = 5; |O x = 6;
                      base = base + #0pepe;
                      iva = 0;
                      importe = importe + #0pepa;
                      #44juan1 = base;
                      #44juan3 = importe;
                      #44juan2 = #0x;
                      |SI #0#5 ! 0;  |Y #0#6 ! 0;
                          #44juan2 = 0;
                      |FINSI;
                  |SINO;
                      #44juan1 = #0pepe;
                      #44juan2 = #0x;
                      #44juan3 = #0pepa;
                  |FINSI;
              |FINSI;
         |SIGUE;
     |SINO;
        juan1 = 5; juan2 = 6; juan3 = 7;
        |PARA x = 3; |SI x [ 6; |HACIENDO x = x + 1;
              pepa = x + 37;
              pepe = x + 16;
              |SI #0pepe ! 0;
                  #44juan1 = #0pepe;
                  #44juan2 = #0x;
                  #44juan3 = #0pepa;
                  juan1 = juan1 + 3;
                  juan2 = juan2 + 3;
                  juan3 = juan3 + 3;
              |FINSI;
        |SIGUE;

        |PARA x = 5; |SI x [ 11; |HACIENDO x = x + 3;
              pepe = x + 1;
              |SI #44x = 0; #44pepe = 0; |FINSI;
        |SIGUE;
     |FINSI;

     nCampo1Inv = 0;
     |SI #0#25 ! 0;
        nSwEsta = 0;
        |PARA juan2 = 6; |SI juan2 [ 12; |HACIENDO juan2 = juan2 + 3;
              juan1 = juan2 - 1;
              juan3 = juan2 + 1;
              |SI #44juan2 = #0#9;
                  #44juan1 = #44juan1 + #0#25;
                  #44juan3 = #44juan3 + #0#46;
                  nSwEsta = 1;
                  nCampo1Inv = juan1;
                  |SAL;
              |FINSI;
        |SIGUE;

        |SI nSwEsta = 0;
            |PARA juan2 = 6; |SI juan2 [ 12; |HACIENDO juan2 = juan2 + 3;
                  juan1 = juan2 - 1;
                  juan3 = juan2 + 1;
                  |SI #44juan2 = 0;  |Y #44juan1 = 0; |Y #44juan3 = 0;
                      #44juan1 = #0#25;
                      #44juan2 = #0#9;
                      #44juan3 = #0#46;
                      nCampo1Inv = juan1;
                      |SAL;
                  |SINO;
                      |SI #44juan2 = 0;
                          #44juan1 = #44juan1 + #0#25;
                          #44juan3 = #44juan3 + #0#46;
                          nCampo1Inv = juan1;
                          |SAL;
                      |FINSI;
                  |FINSI;
            |SIGUE;
        |FINSI;
     |FINSI;

     #44#54 = #0#152;
     #44#81 = #88#10;
     #44#82 = #88#7;
     contador = 0;
     |PARA x = 1; |SI x [ 3; |HACIENDO x = x + 1;
           |SI x = 1; pepin = 7;   pepe  = 23; pepa  = 44; |FINSI;
           |SI x = 2; pepin = 8;   pepe  = 24; pepa  = 45; |FINSI;
           |SI x = 3; pepin = 84;  pepe  = 85; pepa  = 87; |FINSI;
           |SI #0pepe ! 0;
               contador = contador + 1;
               |SI contador = 1; juan1 = 14; juan2 = 15; juan3 = 16; |FINSI;
               |SI contador = 2; juan1 = 17; juan2 = 18; juan3 = 19; |FINSI;
               |SI contador = 3; juan1 = 46; juan2 = 47; juan3 = 48; |FINSI;

               #44juan1 = #0pepe;
               #44juan2 = #0pepin;
               #44juan3 = #0pepa;
          |FINSI;
     |SIGUE;

     |PARA x = 1; |SI x [ 3; |HACIENDO x = x + 3;
           |SI x = 1; pepa = 14; pepe = 15; |FINSI;
           |SI x = 2; pepa = 17; pepe = 18; |FINSI;
           |SI x = 3; pepa = 46; pepe = 47; |FINSI;
           |SI #44pepa = 0; #44pepe = 0; |FINSI;
     |SIGUE;

     |SI #0#2 = 4;
         |ABRE #100;
         |HAZ Graba100_303_Adq;
         |CIERRA #100;

         #44#21 = #17#30;
         #44#22 = #17#31;
         #44#51 = #17#32;
         #44#23 = #17#33;
         #44#24 = #17#34;
         #44#43 = #17#35;
         #44#44 = #17#36;

         #44#70 = _17_30;
         #44#71 = _17_31;
         #44#72 = _17_32;
         #44#73 = _17_33;
         #44#74 = _17_34;
         #44#75 = _17_35;
         #44#76 = _17_36;

         |ABRE #100;
         nCampoDes = 70;
         nPorce1 = (_17_30 * 100) / BaseC1;
         nPorce2 = (#17#30 * 100) / Compra1;
         |HAZ PonPorceCompra;

         nCampoDes = 71;
         nPorce1 = (_17_31 * 100) / BaseC2;
         nPorce2 = (#17#31 * 100) / Compra2;
         |HAZ PonPorceCompra;

         nCampoDes = 72;
         nPorce1 = (_17_32 * 100) / #0#88;
         nPorce2 = (#17#32 * 100) / #0#90;
         |HAZ PonPorceCompra;

         nCampoDes = 75;
         nPorce1 = (_17_35 * 100) / #0#35;
         nPorce2 = (#17#35 * 100) / #0#96;
         |HAZ PonPorceCompra;

         nCampoDes = 76;
         nPorce1 = (_17_36 * 100) / BaseC7;
         nPorce2 = (#17#36 * 100) / Compra7;
         |HAZ PonPorceCompra;

         |CIERRA #100;
     |SINO;
         |HAZ CalculaIva;

         |ABRE #100;
         |HAZ Graba100_303_Adq;
         |CIERRA #100;

         |SI #7#28 ! 0;
             #44#21 = Compra1 % #7#28;
             #44#70 = BaseC1  % #7#28;

             #44#22 = Compra2 % #7#28;
             #44#71 = BaseC2  % #7#28;

             #44#51 = #0#90 % #7#28;
             #44#72 = #0#88 % #7#28;

             #44#23 = Compra4 % #7#28;
             #44#73 = BaseC4  % #7#28;

             #44#24 = Compra5 % #7#28;
             #44#74 = BaseC5  % #7#28;

             #44#43 = #0#96 % #7#28;
             #44#75 = #0#35 % #7#28;

             #44#44 = Compra7 % #7#28;
             #44#76 = BaseC7  % #7#28;

             |ABRE #100;
             nPorce1   = #7#28;
             nPorce2   = #7#28;
             nCampoDes = 70;  |HAZ PonPorceCompra;
             nCampoDes = 71;  |HAZ PonPorceCompra;
             nCampoDes = 72;  |HAZ PonPorceCompra;
             nCampoDes = 75;  |HAZ PonPorceCompra;
             nCampoDes = 76;  |HAZ PonPorceCompra;
             |CIERRA #100;
         |SINO;
             #44#21 = Compra1;
             #44#70 = BaseC1;

             #44#22 = Compra2;
             #44#71 = BaseC2;

             #44#51 = #0#90;
             #44#72 = #0#88;

             #44#23 = Compra4;
             #44#73 = BaseC4;

             #44#24 = Compra5;
             #44#74 = BaseC5;

             #44#43 = #0#96;
             #44#75 = #0#35;

             #44#44 = Compra7;
             #44#76 = BaseC7;
         |FINSI;
     |FINSI;

     #44#20 = #44#7  + #44#10 + #44#13 + #44#16 + #44#19 + #44#48 + #44#50;
     #44#25 = #44#21 + #44#22 + #44#23 + #44#24 + #44#43 + #44#44 + #44#51;
     #44#26 = #44#20 - #44#25;
     #44#27 = 100;
     #44#28 = #44#26;
     #44#29 = #0#52;

     total = #44#28 - #44#29 + #44#30;
     |SI total = 0; #44#33 = 0; #44#31 = 0; #44#32 = 0; |FINSI;

     |SI total > 0;
         #44#33 = total; #44#31 = 0; #44#32 = 0;
     |SINO;
         total = total * (-1);
         |SI #44#1 ! 4;
             #44#32 = total;
             #44#31 = 0;
             #44#33 = 0;
         |SINO;
             empresa_d = #0#0;
             activid_d = #0#83;
             anyo_d    = #0#1;
             |HAZ Preg_Devol;

             |SI #7#27 = "C"; #44#32 = total; #44#31 = 0; #44#33 = 0; |FINSI;
             |SI #7#27 = "D"; #44#31 = total; #44#32 = 0; #44#33 = 0; |FINSI;
         |FINSI;
     |FINSI;

     |GRABA 140#44n;
     |LIBERA #44;
     |CIERRA #44;

     |SI nEjer ] 2014;
         #eospa303#2 = #eosm1303#2;
         #eospa303#3 = #eosm1303#1;
         enEmpresa   = #eosm1303#0;
         enActividad = #eosm1303#45;
         enEjer      = 2000 + #eosm1303#2;

         |SI #eosm1303#1 = 1;  enPeriodo = 3;   |FINSI;
         |SI #eosm1303#1 = 2;  enPeriodo = 6;   |FINSI;
         |SI #eosm1303#1 = 3;  enPeriodo = 9;   |FINSI;
         |SI #eosm1303#1 = 4;  enPeriodo = 12;  |FINSI;

         enDesdePlan = 1;
         |HAZ ConvierteModelo;
         enDesdePlan = 0;
         |ACABA;
     |FINSI;

     se_empre  = #44#0;
     se_ejerc  = #44#2;
     se_perio  = #44#1;
     se_tipos  = 303;
     se_activ  = #44#45;
     se_impor  = 0;
     |SI #44#33 > 0; se_impor =  #44#33; |FINSI;
     |SI #44#32 > 0; se_impor = -#44#32; |FINSI;
     |SI #44#31 > 0; se_impor = -#44#31; |FINSI;
     se_fecha  = #44#3;
     se_factu  = "";
     |HAZ seguimie;
|FPRC;

|| ***************************************
|| MODELO 310 A¤O 1998
|| ***************************************

|PROCESO Segui310;
     se_empre = #40#0;
     se_ejerc = #40#1;
     se_perio = #40#2;
     se_tipos = 310;
     se_activ = 1;
     se_impor = 0;
     |SI #40#40 > 0; se_impor =  #40#40; |FINSI;
     |SI #40#41 > 0; se_impor = -#40#41; |FINSI;
     |SI #40#42 > 0; se_impor = -#40#42; |FINSI;
     se_fecha = #40#3;
     se_factu = "";
     |HAZ seguimie;
|FPRC;

|PROCESO Calculo310;
     |ABRE #7;
     #7#0 = #40#0;
     #7#1 = #40#5;
     #7#2 = #40#1;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     |CIERRA #7;

     #40#30 = #40#9  + #40#14 + #40#19 + #40#24 + #40#29;
     #40#44 = #40#30 - #40#43;
     #40#34 = #40#44 + #40#31 + #40#32 + #40#33;
     #40#46 = #40#35 + #40#45;
     #40#36 = #40#34 - #40#46;
     #40#38 = #40#36 - #40#37;

     Total = #40#38;
     |SI Total > 0;
         #40#40 = Total;   #40#41 = 0;   #40#42 = 0;
     |SINO;
         |SI #40#2 ! 4;
             #40#41 = Total * -1;  #40#40 = 0;  #40#42 = 0;
         |SINO;
              |SI #7#27 = "C";
                  #40#41 = Total * -1;  #40#40 = 0;  #40#42 = 0;
              |FINSI;

              |SI #7#27 = "D";
                  #40#42 = Total * -1;  #40#40 = 0;  #40#41 = 0;
              |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Del98;
     |DDEFECTO #40;
     #40#0    = LaEmpresa;
     #40#1    = ElAnyo;
     #40#2    = ElPeriodo;
     |LEE 040#40=;
     Compensar = 0;
     |SI FSalida = 0;  Compensar = #40#41;  |FINSI;

     nSuma = 0;
     |SI #0#2 = 4;
         |PARA nPeriodo = 1;  |SI nPeriodo [ 3;  |HACIENDO nPeriodo = nPeriodo + 1;
               #40#0    = LaEmpresa;
               #40#1    = ElAnyo;
               #40#2    = nPeriodo;
               |LEE 040#40=;
               |SI FSalida = 0;  nSuma = nSuma + #40#44;  |FINSI;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO EjerAnt; |TIPO 0;
     |SI #40#2 = 1;
         LaEmpresa = #40#0;
         ElPeriodo = 4;
         ElAnyo    = #40#1 - 1;
         |SI ElAnyo < 0;  ElAnyo = 99;  |FINSI;

         |SI #40#1 ] 0;  |Y #40#1 [ 80;
             |HAZ Del98;
         |SINO;
             |SI #40#1 > 98;  |HAZ Del98;  |FINSI;
         |FINSI;
     |SINO;
         LaEmpresa = #40#0;
         ElAnyo    = #40#1;
         ElPeriodo = #40#2 - 1;
         |HAZ Del98;
     |FINSI;
|FPRC;

|PROCESO Graba31098;
     |ABRE #40;

     #40#0 = #0#0;
     #40#1 = #0#1;
     #40#2 = #0#2;
     |HAZ  EjerAnt;

     #40#0 = #0#0;
     #40#1 = #0#1;
     #40#2 = #0#2;
     |LIBERA #40;
     |LEE 140#40=;
     FEstado = FSalida;
     |SI FEstado ! 0; |DDEFECTO #40; |FINSI;

     #40#0  = #0#0;
     #40#1  = #0#1;
     #40#2  = #0#2;
     #40#37 = Compensar;
     #40#43 = nSuma;
     #40#31 = #0#88;
     #40#39 = #0#152;

     |HAZ Calculo310;
     |SI FEstado ! 0; |GRABA 140#40n; |SINO; |GRABA 140#40a; |FINSI;
     |HAZ Segui310;
     |CIERRA #40;
|FPRC;

|PROCESO el130_93;
     |ABRE #5;
     #5#0  = #0#0;
     #5#1  = #0#2;
     #5#2  = #0#1;
     #5#19 = #0#83;
     |LIBERA #5;
     |LEE 140#5=;
     |SI FSalida = 0; |BORRA 140#5c; |LIBERA #5; |FINSI;

     |DDEFECTO #5;
     #5#0  = #0#0;
     #5#1  = #0#2;
     #5#2  = #0#1;
     #5#19 = #0#83;

     ventas = #0#19 + #0#20 + #0#21 + #0#22 + #0#150;

     |SI #7#23 = "E";
         #5#5   = #0#50;
         |SI #6#1 = "S"; #5#6 = #5#5 % 6; |SINO; #5#6 = 0; |FINSI;
         |SI #7#24 = 1;  #5#9 = ventas; #5#10  = #5#9 % 1; |FINSI;
         |SI #7#24 = 2;  #5#7 = ventas; #5#8   = #5#7 % 2; |FINSI;
     |FINSI;

     |SI #7#23 = "P";
         #5#12 = #0#50;
         |SI #6#1 = "S"; #5#13 = #5#12 % 6; |SINO; #5#13 = 0; |FINSI;
         #5#14 = ventas; #5#15 = #5#14 % 2;
     |FINSI;

     |SI #5#6  ] #5#8; |Y #5#6  ] #5#10; #5#11 = #5#6;  |FINSI;
     |SI #5#8  ] #5#6; |Y #5#8  ] #5#10; #5#11 = #5#8;  |FINSI;
     |SI #5#10 ] #5#6; |Y #5#10 ] #5#8;  #5#11 = #5#10; |FINSI;

     #5#16 = #0#36;

     |SI #5#13 ] #5#15; #5#17 = #5#13 - #5#16; |FINSI;
     |SI #5#15 ] #5#13; #5#17 = #5#15 - #5#16; |FINSI;

     #5#18 = #5#11 + #5#17;
     |SI #5#18 < 0; #5#18 = 0; |FINSI;

     |GRABA 140#5n;
     |LIBERA #5;
     |CIERRA #5;
     |HAZ grabaact;

     se_empre  = #5#0;
     se_ejerc  = #5#2;
     se_perio  = #5#1;
     se_tipos  = 130;
     se_activ  = #5#19;
     se_impor  = #5#18;
     se_fecha  = #5#3;
     se_factu  = "";
     |HAZ seguimie;
|FPRC;

|PROCESO el130_94;
     pagos   = 0;
     f_anter = 0;
     i_anter = 0;

     |ABRE #12;
     #12#0 = #0#0;
     #12#1 = #0#83;
     #12#2 = #0#1;
     |LEE 040#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
     |CIERRA #12;

     |ABRE #13;
     |DDEFECTO #13;
     #13#0  = #0#0;
     #13#1  = #0#83;
     #13#2  = #0#2 - 1;
     #13#3  = #0#1;
     |LEE 040#13=;
     |SI FSalida = 0;
         pagos   = #13#28 + #13#29;
         f_anter = #13#11;
         i_anter = #13#17;
     |FINSI;

     #13#0  = #0#0;
     #13#1  = #0#83;
     #13#2  = #0#2;
     #13#3  = #0#1;
     |LIBERA #13;
     |LEE 140#13=;
     |SI FSalida = 0; |BORRA 140#13c; |LIBERA #13; |FINSI;

     |DDEFECTO #13;
     #13#0  = #0#0;
     #13#1  = #0#83;
     #13#2  = #0#2;
     #13#3  = #0#1;
     #13#4  = "";
     #13#5  = "N";
     #13#6  = #0#37;
     #13#7  = #0#80 - #0#37;
     #13#8  = #0#80;
     #13#9  = #0#49;
     #13#10 = f_anter;
     #13#11 = #0#49;
     #13#12 = #0#38;
     #13#13 = #0#81 - #0#38;
     #13#14 = #0#81;

     |SI #0#2 = 1; #13#15 = #12#3;  |FINSI;
     |SI #0#2 = 2; #13#15 = #12#3;  |FINSI;
     |SI #0#2 = 3; #13#15 = #12#3;  |FINSI;
     |SI #0#2 = 4; #13#15 = #12#3;  |FINSI;

     #13#16 = i_anter;
     |SI #13#16 ! 0; #13#17 = #13#16; |SINO; #13#17 = #13#15; |FINSI;
     #13#18 = #0#54;
     #13#19 = #0#55;
     #13#20 = #0#56;
     #13#21 = #0#57;

     |SI #13#18 < 0; #13#19 = 0; #13#21 = 0; |FINSI;

     #13#38 = #0#202;
     #13#39 = #0#203;
     #13#22 = #0#58;

     #13#23 = #0#36;
     #13#24 = #0#79 - #0#36;
     #13#25 = #0#79;
     |SI #11#10 = 1; #13#26 = #0#54; |FINSI;
     |SI #11#10 = 2; #13#26 = #0#58; |FINSI;
     #13#26 = #13#26 + #13#33;
     #13#27 = #0#60;
     #13#28 = pagos;
     #13#29 = #0#61;
     |SI #13#29 < 0; #13#29 = 0; |FINSI;

     |SI #7#41 = "S";
         |PARA el_130 = 6; |SI el_130 [ 28; |HACIENDO el_130 = el_130 + 1;
               #13el_130 = 0;
         |SIGUE;
         #13#20 = #0#56;
         #13#30 = #0#37;
         #13#31 = #0#37 % 2;
         #13#32 = #0#36;
         #13#29 = #13#31 - #13#32;
         |SI #13#29 < 0; #13#29 = 0; |FINSI;
     |FINSI;

     |GRABA 140#13n;
     |LIBERA #13;
     |CIERRA #13;

     se_empre  = #13#0;
     se_ejerc  = #13#3;
     se_perio  = #13#2;
     se_tipos  = 130;
     se_activ  = #13#1;
     se_impor  = #13#29;
     se_fecha  = #13#4;
     se_factu  = "";
     |HAZ seguimie;
|FPRC;

|PROCESO grabaact;
     |ABRE #7;
     #7#0 = #0#0;
     #7#1 = #0#83;
     #7#2 = #0#1;
     |LIBERA #7;
     |LEE 140#7=;
     |SI FSalida = 0;
         |SI #0#2 = 4;
             |SI #0#1 ] 9;  |Y #0#1 < 80;
                 |SI #44#55 < 0; #7#34 = -#44#55; |FINSI;
             |SINO;
                 |SI #4#55 < 0; #7#34 = -#4#55; |FINSI;
             |FINSI;
         |FINSI;
         |GRABA 120#7a;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO borra_130;
     |BORRA 140#14a;
     |LIBERA #14;
|FPRC;

|DEFBUCLE eosm3130_1;
     #14#1;
     32;
     #0#0, 1, #0#2, #0#1, "N";
     #0#0, 9, #0#2, #0#1, "N";
     e;
     NULL, borra_130;
|FIN;

|PROCESO graba_glob;
     |ABRE #7;
     |PARA act_nor = 1; |SI act_nor [ 6; |HACIENDO act_nor = act_nor + 1;
           #7#0 = #0#0;
           #7#1 = act_nor;
           #7#2 = #0#1;
           |LEE 040#7=;
           |SI FSalida = 0;
               |SI #7#46 = "S"; |HAZ comunero; |SINO; |HAZ normal; |FINSI;
           |FINSI;
     |SIGUE;
     |CIERRA #7;
|FPRC;

|PROCESO dsmod130;
     |SI #1130#3 = 8;  |Y #1130#2 = 1;
          nImporte = #1130#29;
     |SINO;
          nImporte = #1130#46;
     |FINSI;

     |SI nImporte < 0; nSwNeg = 1; |FINSI;

     |SI nImporte ] 0;  |Y nSwNeg = 0; |ACABA;  |FINSI;

     nSumaD = nSumaD + #1130#42;

     |SI nImporte < 0;
         #14#43 = #14#43 + -nImporte;
     |SINO;
         #14#43 = #14#43 - #1130#42;
         |SI #14#43 [ 0; nSwNeg = 0; #14#43 = 0; nSumaD = 0; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsmod130;
     #1130#1004;
     ;
     #14#0, #14#1,     1, #14#3;
     #14#0, #14#1, nHPer, #14#3;
     ;
     NULL, dsmod130;
|FIN;

|PROCESO CapturaNegativos130;
     |SI #14#42 [ 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/eosm3130.mas";
     |CARGA_DEF aMas, dsmod130@;

     nSwNeg   = 0;
     nSumaD   = 0;
     #14#43    = 0;
     nHPer    = #14#2 - 1;
     |BUCLE dsmod130;

     |DESCARGA_DEF #dsmod130@;
|FPRC;

|PROCESO dsmod130Tope;
     nTopeAgrario = nTopeAgrario + #1130#47;
|FPRC;

|DEFBUCLE dsmod130Tope;
     #1130#1004;
     ;
     #14#0, #14#1,     1, #14#3;
     #14#0, #14#1, nHPer, #14#3;
     ;
     NULL, dsmod130Tope;
|FIN;

|PROCESO CapturaTopeAgrario;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/eosm3130.mas";
     |CARGA_DEF aMas, dsmod130@;

     nTopeAgrario  = 0;
     nHPer         = #14#2 - 1;
     |BUCLE dsmod130Tope;

     |DESCARGA_DEF #dsmod130@;
|FPRC;

|PROCESO CalculaDed130;
     |SI nEjer < 2008;
         #14#41 = 0;
         #14#42 = 0;
         #14#43 = 0;
         #14#44 = 0;
         #14#47 = 0;
         |ACABA;
     |FINSI;

     #14#42 = #14#29 - #14#41;

     |SI #14#42 [ 0;
         #14#43 = 0;
         #14#47 = 0;
         |ACABA;
     |FINSI;

     |SI nEjer = 2008;
         |SI #14#2 > 1;
             |HAZ CapturaNegativos130;
         |SINO;
             #14#41 = 0;
             #14#42 = 0;
             #14#43 = 0;
             #14#44 = 0;
             #14#47 = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI nEjer ] 2009;
         |SI #14#2 ! 1;
             |HAZ CapturaNegativos130;
         |FINSI;
     |FINSI;

     nSuma = #14#43 + #14#47;
     |SI nSuma > #14#42;
         |SI #14#43 > #14#42;
             #14#43 = #14#42;
             #14#47 = 0;
             |ACABA;
         |FINSI;

         #14#47 = #14#42 - #14#43;
     |FINSI;
|FPRC;

|PROCESO Casilla5;
     pagos_g = 0;

     |SI #0#2 = 1;  |ACABA;  |FINSI;

     |SI #0#1 ] 80;
         nEjer = 1900 + #0#1;
     |SINO;
         nEjer = 2000 + #0#1;
     |FINSI;

     |SI nEjer [ 2008;
         #14#0 = nEmpresa;
         #14#1 = nActividad;
         #14#2 = #0#2 - 1;
         #14#3 = #0#1;
         |LEE 000#14=;
         |SI FSalida ! 0; |DDEFECTO #14; |FINSI;

         nEl27   = 0;
         |SI #14#27 > 0;
             nEl27 = #14#27;
         |FINSI;

         enNume  = nEl27 - #14#28 - #14#25;
         |SI enNume < 0; enNume = 0; |FINSI;

         pagos_g = enNume + #14#28;

         |ACABA;
     |FINSI;

     nHPer   = #0#2 - 1;
     |PARA nNume1 = 1; |SI nNume1 [ nHPer; |HACIENDO nNume1 = nNume1 + 1;
           |DDEFECTO #14;
           #14#0 = nEmpresa;
           #14#1 = nActividad;
           #14#2 = nNume1;
           #14#3 = #0#1;
           |LEE 040#14=;
           |SI FSalida = 0;
               nEl27   = 0;
               |SI #14#27 > 0;
                   nEl27 = #14#27;
               |FINSI;

               enNume  = nEl27 - #14#28 - #14#25;
               |SI enNume < 0; enNume = 0; |FINSI;

               pagos_g = pagos_g + (enNume - #14#47);
           |FINSI;
     |SIGUE;
|FPRC;

|| ************************************************************************
|PROCESO ParaCalMinoracion;
  enMod130 = 130;
  enEje130 = #13#3;
  enEmp130 = #13#0;
  enAct130 = #13#1;
  enPer130 = #13#2;
  efFec130 = fFecha1;
  enRend_NoAgr = #13#22;
  enRend_Agr   = #13#30;
  |HAZ eGrabadsmom094;
|FPRC;

|PROCESO ParaCalMinoracionC;
  enMod130 = 130;
  enEje130 = #13#3;
  enEmp130 = #15#3;
  enAct130 = #15#5;
  enPer130 = #13#2;
  efFec130 = fFecha1;
  enRend_NoAgr = ( #13#22  % #15#6) ! 2;
  enRend_Agr   = ( #13#30  % #15#6) ! 2;
  |HAZ eGrabadsmom094;
|FPRC;
|| ************************************************************************

|PROCESO normal;
     |SI sw_130 = 0; |BUCLE eosm3130_1; |ACABA; |FINSI;
     |SI #7#42 = "S"; activi_g = #7#1; |SINO; activi_g = 9; |FINSI;

     |ABRE #14;
     |ABRE #13;

     #13#0 = #0#0;
     #13#1 = #7#1;
     #13#2 = #0#2;
     #13#3 = #0#1;
     |LEE 040#13=;
     |SI FSalida ! 0; |CIERRA #13; |CIERRA #14; |ACABA; |FINSI;

     fFecha1    = #7#48;
     nEmpresa   = #0#0;
     nActividad = activi_g;
     |HAZ Casilla5;

     |SI #13#3 ] 80;
         nEjer = 1900 + #13#3;
     |SINO;
         nEjer = 2000 + #13#3;
     |FINSI;
     |SI nEjer ] 2010; |HAZ ParaCalMinoracion; |FINSI;

     #14#0 = #13#0;
     #14#1 = activi_g;
     #14#2 = #13#2;
     #14#3 = #13#3;
     |LIBERA #14;
     |LEE 140#14=;
     FEstado = FSalida;
     |SI FEstado ! 0;
         |DDEFECTO #14;
         #14#0 = #13#0;
         #14#1 = activi_g;
         #14#2 = #13#2;
         #14#3 = #13#3;
     |FINSI;
     |PARA x = 6; |SI x [ 27; |HACIENDO x = x + 1;
           #14x = #14x + #13x;
     |SIGUE;
     #14#20 = #13#20;
     #14#48 = #13#38;
     #14#49 = #13#39;

     #14#37 = #14#37 + #13#33;

     |SI #7#41 = "N"; #14#28 = pagos_g; |FINSI;

     #14#30 = #14#30 + #13#30;
     #14#31 = #14#31 + #13#31;
     #14#36 = #14#31 + #13#32;

     #14#29 = #14#27 - #14#28 - #14#25; || |SI #14#29 < 0; #14#29 = 0; |FINSI;

     cuota = #14#31 - #14#36;           || |SI cuota < 0; cuota = 0; |FINSI;

     #14#29 = #14#29 + cuota;
     |SI #14#29 < 0; #14#29 = 0; |FINSI;

     enMod130 = 130;
     enEmp130 = #14#0;
     enEje130 = #14#3;
     enPer130 = #14#2;
     enRend_NoAgr = #14#22;
     enRend_Agr   = #14#30;
     |HAZ eLeeAplica;

     |SI #14#3 ] 80;
         nEjer = 1900 + #14#3;
     |SINO;
         nEjer = 2000 + #14#3;
     |FINSI;

     #14#41 = 0; #14#42 = 0;
     #14#43 = 0; #14#44 = 0;

     |SI nEjer = 2008; |Y eaAplica1 ! "N";
         |SI #14#2 = 2;  #14#41 = 200;  |FINSI;
         |SI #14#2 = 3;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 4;  #14#41 = 100;  |FINSI;
     |FINSI;

     |SI nEjer = 2009; |Y eaAplica1 ! "N";
         |SI #14#2 = 1;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 2;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 3;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 4;  #14#41 = 100;  |FINSI;
     |FINSI;

     |SI nEjer ] 2010; |Y eaAplica1 ! "N";
         #14#41 = enApli400;
     |FINSI;

     #14#47 = 0;
     |SI nEjer ] 2009; |Y eaAplica2 = "S";
         |SI #14#22 > 0;
             #14#47 = #14#22 % 2;
             |SI enAplica3 = 0;
                 |SI #14#47 > 660.14;
                     #14#47 = 660.14;
                 |FINSI;
             |SINO;
                 |SI #14#47 > 440;
                     #14#47 = 440;
                 |FINSI;
             |FINSI;
         |SINO;
             |SI #14#30 > 0;
                 #14#47 = #14#30 % 2;
                 |HAZ CapturaTopeAgrario;
                 |SI enAplica3 = 0;
                     nTope = 660.14 - nTopeAgrario;
                 |SINO;
                     nTope = 440 - nTopeAgrario;
                 |FINSI;
                 |SI nTope < 0;  nTope = 0;  |FINSI;
                 |SI #14#47 > nTope;
                     #14#47 = nTope;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ CalculaDed130;

     #14#44 = #14#42 - #14#43 - #14#47;
     #14#46 = #14#44 - #14#45;   ||nuevo calculo Ley 80

     |SI FEstado ! 0; |GRABA 140#14n; |SINO; |GRABA 120#14a; |FINSI;

     |CIERRA #13;
     |CIERRA #14;
|FPRC;

|PROCESO graba_inde;
     #16#0 = #15#3;
     |LIBERA #16;
     |LEE 140#16=;
     |SI FSalida = 0; |GRABA 120#16a; |SINO; |GRABA 140#16n; |FINSI;
|FPRC;

|DEFBUCLE eoscomul_1;
     #15#1;
     ;
     #0#0, #0#83, #0#1, 000;
     #0#0, #0#83, #0#1, 999;
     e;
     NULL, graba_inde;
|FIN;

|DEFBUCLE eosm3130_2;
     #14#1;
     32;
     #15#3, 1, #0#2, #0#1, "S";
     #15#3, 9, #0#2, #0#1, "S";
     be;
     NULL, borra_130;
|FIN;

|PROCESO graba_comu;
     |SI sw_130 = 0; |BUCLE eosm3130_2; |ACABA; |FINSI;

     |ABRE #1;
     #1#0 = #15#0;
     |LEE 040#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
     |CIERRA #1;

     #7#0 = #15#3;
     #7#1 = #15#5;
     #7#2 = #15#7;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     fFecha1 = #7#48;

     |SI #7#42 = "S"; activi_g = #15#5; |SINO; activi_g = 9; |FINSI;

     |ABRE #14;
     |ABRE #13;

     #13#0 = #15#0;
     #13#1 = #15#1;
     #13#2 = #0#2;
     #13#3 = #0#1;
     |LEE 040#13=;
     |SI FSalida ! 0; |CIERRA #13; |CIERRA #14; |ACABA; |FINSI;

     nEmpresa   = #15#3;
     nActividad = activi_g;
     |HAZ Casilla5;

     |SI #13#3 ] 80;
         nEjer = 1900 + #13#3;
     |SINO;
         nEjer = 2000 + #13#3;
     |FINSI;
     |SI nEjer ] 2010; |HAZ ParaCalMinoracionC; |FINSI;

     #14#0 = #15#3;
     #14#1 = activi_g;
     #14#2 = #13#2;
     #14#3 = #13#3;
     |LIBERA #14;
     |LEE 140#14=;
     FEstado = FSalida;
     |SI FEstado ! 0;
         |DDEFECTO #14;
         #14#0 = #15#3;
         #14#1 = activi_g;
         #14#2 = #13#2;
         #14#3 = #13#3;
     |FINSI;
     |PARA x = 6; |SI x [ 27; |HACIENDO x = x + 1;
         #14x = #14x + (#13x % #15#6);
     |SIGUE;
     #14#48 = #13#38;
     #14#49 = (#13#39 % #15#6);

     #14#37 = #14#37 + (#13#33 % #15#6);

     |SI #7#41 = "N"; #14#28 = pagos_g; |FINSI;
     #14#20 = #13#20;
     #14#30 = #14#30 + (#13#30 % #15#6);
     #14#31 = #14#31 + (#13#31 % #15#6);
     #14#36 = #14#36 + (#13#32 % #15#6);

     #14#29 = #14#27 - #14#28 - #14#25; || |SI #14#29 < 0; #14#29 = 0; |FINSI;

     cuota = #14#31 - #14#36;           || |SI cuota < 0; cuota = 0; |FINSI;

     #14#29 = #14#29 + cuota;
     |SI #14#29 < 0; #14#29 = 0; |FINSI;

     #14#32 = "S";
     #14#33 = #14#33 + 1;
     #14#34 = #1#2;
     #14#35 = #15#6;

     |SI #14#3 ] 80;
         nEjer = 1900 + #14#3;
     |SINO;
         nEjer = 2000 + #14#3;
     |FINSI;

     enMod130 = 130;
     enEmp130 = #14#0;
     enEje130 = #14#3;
     enPer130 = #14#2;
     enRend_NoAgr = #14#22;
     enRend_Agr   = #14#30;
     |HAZ eLeeAplica;

     #14#41 = 0; #14#42 = 0;
     #14#43 = 0; #14#44 = 0;

     |SI nEjer = 2008; |Y eaAplica1 ! "N";
         |SI #14#2 = 2;  #14#41 = 200;  |FINSI;
         |SI #14#2 = 3;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 4;  #14#41 = 100;  |FINSI;
     |FINSI;

     |SI nEjer = 2009; |Y eaAplica1 ! "N";
         |SI #14#2 = 1;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 2;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 3;  #14#41 = 100;  |FINSI;
         |SI #14#2 = 4;  #14#41 = 100;  |FINSI;
     |FINSI;

     |SI nEjer ] 2010; |Y eaAplica1 ! "N";
         #14#41 = enApli400;
     |FINSI;

     #14#47 = 0;
     |SI nEjer ] 2009; |Y eaAplica2 = "S";
         |SI #14#22 > 0;
             #14#47 = #14#22 % 2;
             |SI enAplica3 = 0;
                 |SI #14#47 > 660.14;
                     #14#47 = 660.14;
                 |FINSI;
             |SINO;
                 |SI #14#47 > 440;
                     #14#47 = 440;
                 |FINSI;
             |FINSI;
         |SINO;
             |SI #14#30 > 0;
                 #14#47 = #14#30 % 2;
                 |HAZ CapturaTopeAgrario;
                 |SI enAplica3 = 0;
                     nTope = 660.14 - nTopeAgrario;
                 |SINO;
                     nTope = 440 - nTopeAgrario;
                 |FINSI;
                 |SI nTope < 0;  nTope = 0;  |FINSI;
                 |SI #14#47 > nTope;
                     #14#47 = nTope;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ CalculaDed130;

     #14#44 = #14#42 - #14#43 - #14#47;
     #14#46 = #14#44 - #14#45;   ||nuevo calculo Ley 80

     |SI FEstado ! 0; |GRABA 140#14n; |SINO; |GRABA 120#14a; |FINSI;

     |CIERRA #13;
     |CIERRA #14;
|FPRC;

|DEFBUCLE eoscomul_2;
     #15#2;
     1;
     #16#0, 1, #0#1, act_nor;
     #16#0, 6, #0#1, act_nor;
     e;
     NULL, graba_comu;
|FIN;

|PROCESO lee_comun;
     |BUCLE eoscomul_2;
|FPRC;

|DEFBUCLE eosw0016;
     #16#1;
     ;
     00000;
     99999;
     e;
     NULL, lee_comun;
|FIN;

|PROCESO comunero;
     comienza = "16";
     |HAZ fichero;
     |NOME_DAT #16 fichero;

     |ABRE #16; |CIERRA #16;
     |DELINDEX #16;

     |ABRE #16;
     |BUCLE eoscomul_1;
     |CIERRA #16;

     |BUCLE eosw0016;
     |DELINDEX #16;
|FPRC;
