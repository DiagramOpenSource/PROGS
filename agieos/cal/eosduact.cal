|FICHEROS;
   eosduact #0;
   eosactiv #1;
   eoszacti #2;
   eosclien #3;

   eoselepi #16;
|FIN;

|VARIABLES;
   x       = 0;
   y       = 0;
   d_empre = 0;
   h_empre = 0;

   aAlfa1  = "";
   nNume1  = 0;
   fFecha1 = @;
   nCampo  = 0;

   &enEjer   = 0;
   nSwModulo = 0;
   nPrint    = 0;
   nHay      = 0;
|FIN;

|INCLUYE i_consul;
|INCLUYE i_anyode;

|PROCESO pinta_anyo; |TIPO 7;
     |HAZ i_anyodef;
     #0#29  = i_anyodef - 1;
     |SI #0#29 < 0;  #0#29 = 99;  |FINSI;
     #0#30  = i_anyodef;
     |PINTA #0#29;
     |PINTA #0#30;
|FPRC;

|CALCULO NoMasEmpresas; |TIPO 0;
     |C_M #0Campo,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 26;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 26;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
    |FINSI;
|FCAL;

|PROCESO modifica; |TIPO 0;
    |CAMPO_MODIFICA #0#01, 1, "S";  |CAMPO_MODIFICA #0#02, 1, "S";
    |CAMPO_MODIFICA #0#03, 1, "S";  |CAMPO_MODIFICA #0#04, 1, "S";
    |CAMPO_MODIFICA #0#05, 1, "S";  |CAMPO_MODIFICA #0#06, 1, "S";
    |CAMPO_MODIFICA #0#07, 1, "S";  |CAMPO_MODIFICA #0#08, 1, "S";
    |CAMPO_MODIFICA #0#09, 1, "S";  |CAMPO_MODIFICA #0#10, 1, "S";
    |CAMPO_MODIFICA #0#11, 1, "S";  |CAMPO_MODIFICA #0#12, 1, "S";
    |CAMPO_MODIFICA #0#13, 1, "S";  |CAMPO_MODIFICA #0#14, 1, "S";
    |CAMPO_MODIFICA #0#15, 1, "S";  |CAMPO_MODIFICA #0#16, 1, "S";
    |CAMPO_MODIFICA #0#17, 1, "S";  |CAMPO_MODIFICA #0#18, 1, "S";
    |CAMPO_MODIFICA #0#19, 1, "S";  |CAMPO_MODIFICA #0#20, 1, "S";
    |CAMPO_MODIFICA #0#21, 1, "S";  |CAMPO_MODIFICA #0#22, 1, "S";
    |CAMPO_MODIFICA #0#23, 1, "S";  |CAMPO_MODIFICA #0#24, 1, "S";
    |CAMPO_MODIFICA #0#25, 1, "S";  |CAMPO_MODIFICA #0#26, 1, "S";
    |SI #0#0 = "S";
        |CAMPO_MODIFICA #0#1, 1, "N";
        |CAMPO_MODIFICA #0#2, 1, "N";
        #0#1 = 1;       |PINTA #0#1;
        #0#2 = 99999;   |PINTA #0#2;
    |SINO;
        |CAMPO_MODIFICA #0#03, 1, "N";  |CAMPO_MODIFICA #0#04, 1, "N";
        |CAMPO_MODIFICA #0#05, 1, "N";  |CAMPO_MODIFICA #0#06, 1, "N";
        |CAMPO_MODIFICA #0#07, 1, "N";  |CAMPO_MODIFICA #0#08, 1, "N";
        |CAMPO_MODIFICA #0#09, 1, "N";  |CAMPO_MODIFICA #0#10, 1, "N";
        |CAMPO_MODIFICA #0#11, 1, "N";  |CAMPO_MODIFICA #0#12, 1, "N";
        |CAMPO_MODIFICA #0#13, 1, "N";  |CAMPO_MODIFICA #0#14, 1, "N";
        |CAMPO_MODIFICA #0#15, 1, "N";  |CAMPO_MODIFICA #0#16, 1, "N";
        |CAMPO_MODIFICA #0#17, 1, "N";  |CAMPO_MODIFICA #0#18, 1, "N";
        |CAMPO_MODIFICA #0#19, 1, "N";  |CAMPO_MODIFICA #0#20, 1, "N";
        |CAMPO_MODIFICA #0#21, 1, "N";  |CAMPO_MODIFICA #0#22, 1, "N";
        |CAMPO_MODIFICA #0#23, 1, "N";  |CAMPO_MODIFICA #0#24, 1, "N";
        |CAMPO_MODIFICA #0#25, 1, "N";  |CAMPO_MODIFICA #0#26, 1, "N";

        |PARA x = 3; |SI x [ 26; |HACIENDO x = x + 1;
              #0x = 0;  |PINTA #0x;
        |SIGUE;
    |FINSI;
|FPRC;

|PROCESO grabaind;
    #2#0 = #1#0;
    #2#1 = #1#1;
    #2#2 = #0#30;
    |PARA y = 3; |SI y [ 51; |HACIENDO y = y + 1;
          #2y = #1y;
    |SIGUE;
    #2#18 = 0;
    #2#19 = 0;
    #2#20 = 0;
    #2#21 = 0;
    #2#30 = 0;
    #2#31 = 0;
    #2#32 = 0;
    #2#33 = 0;
    #2#34 = 0;
    #2#35 = 0;
    #2#36 = 0;
    #2#37 = 0;
    #2#38 = 0;
    #2#39 = 0;

    |GRABA 040#2n;
|FPRC;

|DEFBUCLE eosactiv;
    #1#1;
    ;
    d_empre, #0#27, #0#29;
    h_empre, #0#28, #0#29;
    e;
    NULL, grabaind;
|FIN;

|PROCESO MiroAntesModulos;
     nSwModulo = 0;
     |SI #2#4 ! "E"; |ACABA; |FINSI;

     #16#0  = #2#4;
     #16#1  = #2#5;
     #16#41 = 1;
     #16#2  = enEjer;
     |LEE 040#16=;
     |SI FSalida ! 0;
         |SI nPrint = 0;
             |MENAV "0000Hay Actividades de modulos no Correctas. Imprime informe";

             |IMPRE 0;
             |SI FSalida = 0;
                 nPrint = 1;
                 |INFOR "eosduact";
                 |SI FSalida ! 0; nPrint = 0; |FINIMP; |FINSI;
             |FINSI;
         |FINSI;
         |SI nPrint = 1;
             |DDEFECTO #3;
             #3#0 = #2#0;
             |LEE 041#3=;

             || eaError = "Activ. no incluida en Modulos del " + enEjer + ".Modifique el tipo de Empresa en la Ficha de Actividades";
             |PRINT;
         |FINSI;
         nSwModulo = 1;
         nHay = 1;
     |FINSI;
|FPRC;

|PROCESO grabaact;
    |SI #2#49 > "01.01.1900";
        |SI #2#49 < fFecha1;
            |ACABA;
        |FINSI;
    |FINSI;

    |SI #2#22 = "A";
        |HAZ MiroAntesModulos;
    |FINSI;

    #1#0 = #2#0;
    #1#1 = #2#1;
    #1#2 = #2#2;
    |LIBERA #1;
    |LEE 140#1=;
    |SI FSalida ! 0;
        |DDEFECTO #1;
        |PARA y = 0; |SI y [ 51; |HACIENDO y = y + 1;
              #1y = #2y;
        |SIGUE;
        |GRABA 140#1n;
    |FINSI;
|FPRC;

|DEFBUCLE eoszacti;
    #2#1;
    ;
    00000, 0, 00;
    99999, 9, 99;
    e;
    NULL, grabaact;
|FIN;

|PROCESO duplica; |TIPO 3;
    |SI #0#30 < 80;
        nNume1 = 2000 + #0#30;
    |SINO;
        nNume1 = 1900 + #0#30;
    |FINSI;
    enEjer = nNume1;

    aAlfa1  = nNume1;
    aAlfa1  = "01.01." + aAlfa1;
    fFecha1 = aAlfa1;

    |DELINDEX #2;
    |ABRE #2;
    |SI #0#0 = "N";
        d_empre = #0#1;
        h_empre = #0#2;
        |BUCLE eosactiv;
    |SINO;
        |PARA x = 3; |SI x [ 26; |HACIENDO x = x + 1;
              |SI #0x ! 0;
                  d_empre = #0x;
                  h_empre = #0x;
                  |BUCLE eosactiv;
              |FINSI;
        |SIGUE;
    |FINSI;
    |CIERRA #2;

    nHay = 0;
    |ABRE #1;
    |ABRE #3;
    |ABRE #16;
    |BUCLE eoszacti;
    |CIERRA #16;
    |CIERRA #3;
    |CIERRA #1;

    |DELINDEX #2;

    |SI nHay ! 0;
        |MENAV "0000Repase y modifique las Actividades de Modulos no Correctas";
    |FINSI;

    |SI nPrint ! 0;
        |PIEINF;
        |FININF;
        |FINIMP;
    |FINSI;
|FPRC;
