|| ... Rutinas del Criterio de Caja
|FICHEROS;
   eoscabco;
   eoslinco;

   eoscabve;
   eoslinve;

   eosconce;
   eosconc6;

   eosmcc01 #501;
   eosmcc02 #502;
   eosmccw1 #599;
|FIN;

|VARIABLES;
  aAlfa      = "";
  aAlfa1     = "";
  aAlfa2     = "";
  aFichero   = "";
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcaj;

|| ///////////////////////////////////////////////////////////////////////
|PROCESO EsCaja2;
   |SI enConcepto ! 0;
       |ABRE #eosconce;
       #eosconce#0 = enConcepto;
       |LEE 041#eosconce.=;
       |SI FSalida = 0;
           |SI #eosconce#16 = "Z"; |O #eosconce#16 = "1"; |O #eosconce#16 = "2";
              |O #eosconce#16 = "3"; |O #eosconce#16 = "4"; |O #eosconce#16 = "5";
                |O #eosconce#16 = "6"; |O #eosconce#16 = "7"; |O #eosconce#16 = "8";
             enSwCaja = 1;
           |FINSI;
       |FINSI;
       |CIERRA #eosconce;
   |FINSI;
|FPRC;

|PROCESO EsCaja6;
   |SI eaConcepto ! "      ";
       |ABRE #eosconc6;
       #eosconc6#0 = eaConcepto;
       |LEE 041#eosconc6.=;
       |SI FSalida = 0;
           |SI #eosconc6#22 = "Z"; |O #eosconc6#22 = "1"; |O #eosconc6#22 = "2";
              |O #eosconc6#22 = "3"; |O #eosconc6#22 = "4"; |O #eosconc6#22 = "5";
                |O #eosconc6#22 = "6"; |O #eosconc6#22 = "7"; |O #eosconc6#22 = "8";
             enSwCaja = 1;
           |FINSI;
       |FINSI;
       |CIERRA #eosconc6;
   |FINSI;
|FPRC;

|PROCESO EsCajaIva;
   enSwCaja = 0;
   |SI enEjer ] 2014; |Y aTipoIVA = "S";
       |SI enDigCaja = 1;
           enConcepto = #eoslinco#5;  |HAZ EsCaja2;
           enConcepto = #eoslinco#33; |HAZ EsCaja2;
           enConcepto = #eoslinco#34; |HAZ EsCaja2;
       |SINO;
           eaConcepto = #eoslinco#72;  |HAZ EsCaja6;
           eaConcepto = #eoslinco#73;  |HAZ EsCaja6;
           eaConcepto = #eoslinco#74;  |HAZ EsCaja6;
           eaConcepto = #eoslinco#75;  |HAZ EsCaja6;
           eaConcepto = #eoslinco#76;  |HAZ EsCaja6;
           eaConcepto = #eoslinco#77;  |HAZ EsCaja6;
       |FINSI;
   |FINSI;
   |SI enEjer ] 2014; |Y aTipoIVA = "R";
       |SI enDigCaja = 1;
           enConcepto = #eoslinve#5;  |HAZ EsCaja2;
           enConcepto = #eoslinve#33; |HAZ EsCaja2;
           enConcepto = #eoslinve#34; |HAZ EsCaja2;
           enConcepto = #eoslinve#60; |HAZ EsCaja2;
           enConcepto = #eoslinve#61; |HAZ EsCaja2;
           enConcepto = #eoslinve#62; |HAZ EsCaja2;
       |SINO;
           eaConcepto = #eoslinve#72;  |HAZ EsCaja6;
           eaConcepto = #eoslinve#73;  |HAZ EsCaja6;
           eaConcepto = #eoslinve#74;  |HAZ EsCaja6;
           eaConcepto = #eoslinve#75;  |HAZ EsCaja6;
           eaConcepto = #eoslinve#76;  |HAZ EsCaja6;
           eaConcepto = #eoslinve#77;  |HAZ EsCaja6;
       |FINSI;
   |FINSI;
|FPRC;
|| ///////////////////////////////////////////////////////////////////////

|PROCESO BorraMacc02;
   |BORRA 020#502a;
   |LIBERA #502;
|FPRC;

|DEFBUCLE BorraMacc02;
   #502#1;
   ;
   #501#0, #501#1, #501#13, #501#17, #501#2, 01;
   #501#0, #501#1, #501#13, #501#17, #501#2, 99;
   be;
   NULL, BorraMacc02;
|FIN;

|PROCESO BajaCaja;
   |ABRE #501;
   #501#0  = eEmpreCaja;
   #501#1  = enEjerCaja;
   #501#13 = aTipoIVA;
   #501#17 = eDevenCaja;
   #501#2  = eRegisCaja;
   |LEE 141#501=;
   |SI FSalida = 0;
       |BUCLE BorraMacc02;
       |BORRA 020#501a;
   |FINSI;
   |LIBERA #501;
   |CIERRA #501;
|FPRC;

|PROCESO eTrataClaveZ;

   aFichero = "f" + eaNCaja; |NOME_DAT #501 aFichero;
   aFichero = "m" + eaNCaja; |NOME_DAT #502 aFichero;

   |SI eModoCaja = 3; |O enSwCaja = 0;
       |HAZ BajaCaja;
       |ACABA;
   |FINSI;

   |SI enSwCaja = 1;
       eaFicCaja = "vc" + Usuario;
       |NOME_DAT #599 eaFicCaja;
       |DELINDEX #599;

       |ABRE #599;
       #599#0  = eEmpreCaja;
       #599#21 = enEjerCaja;
       #599#13 = aTipoIVA;
       #599#44 = eDevenCaja;
       #599#1  = eRegisCaja;
       |LEE 041#599=;
       |SI FSalida ! 0;
           |DDEFECTO #599;
           #599#0  = eEmpreCaja;
           #599#21 = enEjerCaja;
           #599#13 = aTipoIVA;
           #599#44 = eDevenCaja;
           #599#1  = eRegisCaja;
           |GRABA 020#599c;
       |FINSI;

       |SI aTipoIVA = "S";
           #599#2  = #eoslinco#16;
           #599#3  = #eoslinco#15;
           #599#4  = #eoslinco#13;
           #599#5  = #eoslinco#3;
           |SI enDigCaja = 1;
               aAlfa   = ("00" + #eoslinco#5) % -102;
               #599#6 = aAlfa;
           |SINO;
               #599#6 = #eoslinco#72;
           |FINSI;
           #599#7  = #eoslinco#35;
           #599#8  = #eoslinco#7 + #eoslinco#23 + #eoslinco#24;
           #599#9  = #eoslinco#9 + #eoslinco#27 + #eoslinco#28;
           #599#10 = #eoslinco#22;
           #599#11 = #eoslinco#38;
           #599#12 = #eoslinco#12;
           #599#14 = #eoslinco#6;
           #599#15 = #eoslinco#13;
           #599#17 = #eoslinco#17;

           #599#26 = #eoslinco#7;
           #599#27 = #eoslinco#9;
           #599#28 = #eoslinco#42;

           #599#29 = #eoslinco#23;
           #599#30 = #eoslinco#27;
           #599#31 = #eoslinco#43;

           #599#32 = #eoslinco#24;
           #599#33 = #eoslinco#28;
           #599#34 = #eoslinco#44;
       |FINSI;

       |SI aTipoIVA = "R";
           #599#2  = #eoslinve#16;
           #599#3  = #eoslinve#15;
           #599#4  = #eoslinve#13;
           #599#5  = #eoslinve#3;
           |SI enDigCaja = 1;
               aAlfa   = ("00" + #eoslinve#5) % -102;
               #599#6 = aAlfa;
           |SINO;
               #599#6 = #eoslinve#72;
           |FINSI;
           #599#7  = #eoslinve#35;
           #599#8  = #eoslinve#7 + #eoslinve#23 + #eoslinve#24 + #eoslinve#45 + #eoslinve#46 + #eoslinve#47;
           #599#9  = #eoslinve#9 + #eoslinve#27 + #eoslinve#28 + #eoslinve#51 + #eoslinve#52 + #eoslinve#53;
           #599#10 = #eoslinve#22;
           #599#11 = #eoslinve#38;
           #599#12 = #eoslinve#12;
           #599#14 = #eoslinve#6;
           #599#15 = #eoslinve#13;
           #599#17 = #eoslinve#17;

           #599#26 = #eoslinve#7;
           #599#27 = #eoslinve#9;
           #599#28 = #eoslinve#42;

           #599#29 = #eoslinve#23;
           #599#30 = #eoslinve#27;
           #599#31 = #eoslinve#43;

           #599#32 = #eoslinve#24;
           #599#33 = #eoslinve#28;
           #599#34 = #eoslinve#44;

           #599#35 = #eoslinve#45;
           #599#36 = #eoslinve#51;
           #599#37 = #eoslinve#69;

           #599#38 = #eoslinve#46;
           #599#39 = #eoslinve#52;
           #599#40 = #eoslinve#70;

           #599#41 = #eoslinve#47;
           #599#42 = #eoslinve#53;
           #599#43 = #eoslinve#71;
       |FINSI;

       #599#22 = enEjer;

       |GRABA 020#599a;
       |CIERRA #599;
       |SUB_EJECUTA_NP "eosmccw1";
   |FINSI;
|FPRC;

|PROCESO ePathCaja;
   eClvDeCaja = enEjerCaja;
   ePathCaja  = eaNCaja;
   |SI ePerioCaja ! -1; |Y eDevenCaja ! 0;
       aAlfa1     = ("00000" + eEmpreCaja) % -105;
       aAlfa2     =            eDevenCaja  % -102;
       eClvDeCaja = aAlfa2;
       ePathCaja  = aAlfa1 + aAlfa2;
   |FINSI;
   || ...  |DFICE ePathCaja; modificar esto para que calcule el nombre
|FPRC;
