|FICHEROS;
     dsmoy000;
|FIN;

|VARIABLES;
     nBtnF2         = -1;
     nBtnF3         = -1;
     nBtnF4         = -1;
     nBtnF5         = -1;
     nBtnEs         = -1;
     nHandleError   = 0;
     nReg           = 0;
     nError         = 0;
     nCodError      = 0;
     nCaracter      = 0;
     nConta         = 0;
     nErrorCC       = 0;
     nErrorEE       = 0;
     nCopiado       = 0;
     nNoLoHago      = 0;
     nHandle        = 0;

     aFicPortal     = "";
     aFicError      = "";
     aPathPatrones  = "";
     aPatron        = "";
     aEjecutable    = "";
     aCadena1       = "";
     aCadena2       = "";
     aCadena3       = "";
     aCadena4       = "";
     aRegistro      = "";
     aNif           = "";
     aNombre        = "";
     aDescri        = "";
     aValidar       = "";
     aEnsobrar      = "";
     aEjecu         = "";
     aNum           = "";
     aPrgJava       = "";
     aPathLocal     = "";
     aPathPlugins   = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aIPRemoto      = "";
     aDIR           = "";

     {1}aContiene   = "";

     {99}aCodEE     = "";
     {99}aCodDCC    = "";
     {99}aCodPCC    = "";
|FIN;

|INCLUYE i_varemi;

|PROCESO CopiaFicheroPtl;
     nCopiado   = 0;

     aContiene1 = eaFDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaFOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaFOrigen, eaFDestino;
         |SINO;
             |COPIA_FICHERO eaFOrigen, eaFDestino;
         |FINSI;

         nCopiado = 1;
     |FINSI;
|FPRC;

|PROCESO TraeDsaeatresp;
     aPathLocal  = eaPathLanza;

     |DBASE aPathPlugins;  |QBT aPathPlugins;
     aPathPlugins = aPathPlugins + "plugins";
     |MKDIR aPathPlugins;
     aOrigen      = aPathPlugins   + "/dsaeatresp.exe";
     aDestino     = aPathLocal + "dsaeatresp.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Validacion;
     enErrorPortal = 0;
     |HAZ TraeDsaeatresp;

     aAlfa = eaPathLanza + aFicError;  |RFBORRA aAlfa;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     aAbre = eaPathLanza + "ejecutaweb.bat";
     |XABRE "WBC", aAbre, nHandle;

     aAlfa = eaPathLanza + "dsaeatresp " + eaPathLanza + aFicPortal + " " + eaPathLanza + aFicError;
     |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     |RSYSTEM aAbre;

     aAbre = eaPathLanza + aFicError;
     |XABRE "UC", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PARA; |SI; |HACIENDO;
          |XLEE nHandle, 250, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          aAlfa1 = aAlfa < "";  |QBF aAlfa1;
          aAlfa2 = aAlfa1 - "<title>";
          |SI FSalida ! 0;
              aAlfa2 = aAlfa1 - "error";
              |SI FSalida ! 0;  enErrorPortal = 1;  |SAL;  |FINSI;

              aAlfa2 = aAlfa1 - "errónea";
              |SI FSalida ! 0;  enErrorPortal = 1;  |SAL;  |FINSI;
          |FINSI;
     |SIGUE;
     |XCIERRA nHandle;

     |SI enErrorPortal = 1;
         aAlfa = "0000Hay errores en la empresa " + (("00000" + enEmpresa) % -105);
         aAlfa = aAlfa + " " + eaNomEmpresa;  |QBF aAlfa;
         |MENAV aAlfa;
         |CONFI "0000SQuiere consultarlos";
         |SI FSalida = 0;
             eaForzExplorador = "N";
             |HAZ Explorador;

             |SI eaPathExplorador ! "";
                 aAlfa = eaPathExplorador + " " + eaPathLanza + aFicError;
                 aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
             |SINO;
                 aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaPathLanza + aFicError + &34;
             |FINSI;

             |RSYSTEM aAlfa;
         |FINSI;
     |FINSI;

     aAlfa = eaPathLanza + aFicError;  |RFBORRA aAlfa;
|FPRC;

|PROCESO GrabaPortal;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA enHandlePortal, eaAlfa;
|FPRC;

|PROCESO GrabaPortalSin;
     |XGRABA enHandlePortal, eaAlfa;
|FPRC;

|PROCESO VarVacia_Plb;
     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + aTipo + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;
|FPRC;

|PROCESO PortalBorrador2015;
     aDIR = "https://www2.agenciatributaria.gob.es/es13/l/zi22zilk0022";
     aHID = "INF5" + #dsmoy000#0 + "A";
     aPRG = "";

     aFicPortal = "Portal" + #dsmoy000#0 + ".html";
     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "WB", aAbre, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aDIR + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandlePortal;

     aDestino   = eaPathEmision + aFicPortal;
     aOrigen    = eaPathEmision + eaFicheroPlano;
     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "AB", aAbre, enHandlePortal;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #dsmoy000#6 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + #dsmoy000#0 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = eaPathEmision + aFicPortal;
     eaFDestino = eaPathLanza   + aFicPortal;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + eaPathLanza + aFicPortal;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaPathLanza + aFicPortal + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;
|FPRC;

|PROCESO PortalPDF2015;
||     aDIR = "https://www6.aeat.es/es13/l/zi21zilk0021";
     aDIR = "https://www2.agenciatributaria.gob.es/es13/l/zi21zilk0021";

     aHID = "INF5" + #dsmoy000#0 + "A";
     aPRG = "PTLINK9T";

     aFicPortal = "Portal" + #dsmoy000#0 + ".html";
     aFicError  = "Error" + #dsmoy000#0 + ".html";
     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "WB", aAbre, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aDIR + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "F01" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandlePortal;

     aDestino   = eaPathEmision + aFicPortal;
     aOrigen    = eaPathEmision + eaFicheroPlano;
     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "AB", aAbre, enHandlePortal;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "ANA" + &34 + " value=" + &34 + (eaNomEmpresa % 103) + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + #dsmoy000#0 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #dsmoy000#6 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = eaPathEmision + aFicPortal;
     eaFDestino = eaPathLanza   + aFicPortal;
     |HAZ CopiaFicheroPtl;

     |HAZ Validacion;
     |SI enErrorPortal = 1;
         aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
         aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;
         aAlfa = eaPathEmision + eaFicheroSalid;  |FBORRA aAlfa;

         aAlfa = eaPathLanza   + aFicPortal;       |RFBORRA aAlfa;
         aAlfa = eaPathLanza   + eaFicheroSalid;   |RFBORRA aAlfa;

          |ACABA;
     |FINSI;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + eaPathLanza + aFicPortal;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaPathLanza + aFicPortal + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;
|FPRC;

|PROCESO PortalInternet2015;
     |SI enPresentar = 0;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroPtl;

         aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

         eaJusti = "";
         |HAZ GrabaImpreso;

         |ACABA;
     |FINSI;

     |DBASE aAlfa;  |QBT aAlfa;
     eaFOrigen  = aAlfa + "hacienda/wait.exe";
     eaFDestino = eaPathInternet + "wait.exe";
     |HAZ CopiaFicheroPtl;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     aAlfa = eaPathLanza + "wait ";
     aAlfa = aAlfa + eaPathExplorador + " " + &34;
     aAlfa = aAlfa + "https://www1.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/ov/servurlp.html";
     aAlfa = aAlfa + "?WEB=INTERNET&PRG=390&EJE=" + #dsmoy000#6 + "&VER=1.00&URL=PIR&IDI=E&EXT=?FIC=";
     aAlfa = aAlfa + eaPathInternet + eaFicheroPlano + &34;

     eaAlfa  = aAlfa;
     |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpreso;
|FPRC;

|PROCESO PortalBorrador2017;
     aDIR = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";
     aHID = "INF7" + #dsmoy000#0 + "A";
     aPRG = "PTLINKN3";

     aFicPortal = "Portal" + #dsmoy000#0 + ".html";
     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "WB", aAbre, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aDIR + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandlePortal;

     aDestino   = eaPathEmision + aFicPortal;
     aOrigen    = eaPathEmision + eaFicheroPlano;
     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "AB", aAbre, enHandlePortal;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #dsmoy000#6 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + #dsmoy000#0 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = eaPathEmision + aFicPortal;
     eaFDestino = eaPathLanza   + aFicPortal;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + eaPathLanza + aFicPortal;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaPathLanza + aFicPortal + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;
|FPRC;

|PROCESO PortalPDF2017;
     |DBASE aAlfa;  |QBT aAlfa;
     eaFOrigen  = aAlfa + "hacienda/wait.exe";
     eaFDestino = eaPathLanza + "wait.exe";
     |HAZ CopiaFicheroPtl;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathLanza + "wait ";                      |HAZ GrabaPortalSin;
     eaAlfa = eaPathExplorador + " " + &34;               |HAZ GrabaPortalSin;
     eaAlfa = "https://www2.agenciatributaria.gob.es/";   |HAZ GrabaPortalSin;
     eaAlfa = "static_files/common/internet/dep/";        |HAZ GrabaPortalSin;
     eaAlfa = "aplicaciones/ov/servurlp.html";            |HAZ GrabaPortalSin;
     eaAlfa = "?WEB=INTERNET&PRG=390&EJE=" + #dsmoy000#6; |HAZ GrabaPortalSin;
     eaAlfa = "&VER=1.00&URL=IMP&IDI=E";                  |HAZ GrabaPortalSin;

     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpreso;
|FPRC;

|PROCESO PortalInternet2017;
     |SI enPresentar = 0;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroPtl;

         aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

         eaJusti = "";
         |HAZ GrabaImpreso;

         |ACABA;
     |FINSI;

     |DBASE aAlfa;  |QBT aAlfa;
     eaFOrigen  = aAlfa + "hacienda/wait.exe";
     eaFDestino = eaPathLanza + "wait.exe";
     |HAZ CopiaFicheroPtl;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathLanza + "wait ";                      |HAZ GrabaPortalSin;
     eaAlfa = eaPathExplorador + " " + &34;               |HAZ GrabaPortalSin;
     eaAlfa = "https://www1.agenciatributaria.gob.es/";   |HAZ GrabaPortalSin;
     eaAlfa = "static_files/common/internet/dep/";        |HAZ GrabaPortalSin;
     eaAlfa = "aplicaciones/ov/servurlp.html";            |HAZ GrabaPortalSin;
     eaAlfa = "?WEB=INTERNET&PRG=390&EJE=" + #dsmoy000#6; |HAZ GrabaPortalSin;
     eaAlfa = "&VER=1.00&URL=PIR&IDI=E";                  |HAZ GrabaPortalSin;

     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpreso;
|FPRC;

|PROCESO PortalBorrador2018;
     aDIR = "https://www6.aeat.es/wlpl/PFTW-PICW/ServVali";
     aHID = "";
     aPRG = "";

     aFicPortal = "Portal" + #dsmoy000#0 + ".html";
     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "WB", aAbre, enHandlePortal;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aDIR + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;
/*
     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;
*/
     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + "ES" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandlePortal;

     aDestino   = eaPathEmision + aFicPortal;
     aOrigen    = eaPathEmision + eaFicheroPlano;
     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = eaPathEmision + aFicPortal;
     |XABRE "AB", aAbre, enHandlePortal;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + #dsmoy000#6 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + #dsmoy000#0 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandlePortal;

     eaFOrigen  = eaPathEmision + aFicPortal;
     eaFDestino = eaPathLanza   + aFicPortal;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + eaPathLanza + aFicPortal;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaPathLanza + aFicPortal + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;
|FPRC;

|PROCESO PortalPDF2018;
     |DBASE aAlfa;  |QBT aAlfa;
     eaFOrigen  = aAlfa + "hacienda/wait.exe";
     eaFDestino = eaPathLanza + "wait.exe";
     |HAZ CopiaFicheroPtl;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathLanza + "wait ";                      |HAZ GrabaPortalSin;
     eaAlfa = eaPathExplorador + " " + &34;               |HAZ GrabaPortalSin;
     eaAlfa = "https://www2.agenciatributaria.gob.es/";   |HAZ GrabaPortalSin;

     aAlfa = #dsmoy000#6; aAlfa = aAlfa % -102;
     eaAlfa = "wlpl/PAIV-IW" + aAlfa + "/CONT/index.zul?EDFI";       |HAZ GrabaPortalSin;

     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpreso;
|FPRC;

|PROCESO PortalInternet2018;
     |SI enPresentar = 0;
         eaFOrigen  = eaPathEmision  + eaFicheroPlano;
         eaFDestino = eaPathInternet + eaFicheroPlano;
         |HAZ CopiaFicheroPtl;

         aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

         eaJusti = "";
         |HAZ GrabaImpreso;

         |ACABA;
     |FINSI;

     |DBASE aAlfa;  |QBT aAlfa;
     eaFOrigen  = aAlfa + "hacienda/wait.exe";
     eaFDestino = eaPathLanza + "wait.exe";
     |HAZ CopiaFicheroPtl;

     eaFOrigen  = eaPathEmision  + eaFicheroPlano;
     eaFDestino = eaPathInternet + eaFicheroPlano;
     |HAZ CopiaFicheroPtl;

     eaForzExplorador = "N";
     |HAZ Explorador;

     aAbre = eaPathLanza + "imprime.bat";
     |XABRE "WBC", aAbre, enHandlePortal;

     eaAlfa = eaPathLanza + "wait ";                      |HAZ GrabaPortalSin;
     eaAlfa = eaPathExplorador + " " + &34;               |HAZ GrabaPortalSin;
     eaAlfa = "https://www1.agenciatributaria.gob.es/";   |HAZ GrabaPortalSin;

     aAlfa = #dsmoy000#6; aAlfa = aAlfa % -102;
     eaAlfa = "wlpl/PAIV-IW" + aAlfa + "/CONT/index.zul?EDFI"; |HAZ GrabaPortalSin;
     |XCIERRA enHandlePortal;

     |RSYSTEM aAbre;

     aAlfa = eaPathEmision + aFicPortal;      |FBORRA aAlfa;
     aAlfa = eaPathEmision + eaFicheroPlano;  |FBORRA aAlfa;

     eaJusti = "";
     |HAZ GrabaImpreso;
|FPRC;

|PROCESO PresentaPortal;
     |SI #dsmoy000#6 [ 2016;
         |SI eaOpcion = "1";  |HAZ PortalBorrador2015;  |FINSI;
         |SI eaOpcion = "2";  |HAZ PortalPDF2015;       |FINSI;
         |SI eaOpcion = "3";  |HAZ PortalInternet2015;  |FINSI;
     |FINSI;

     |SI #dsmoy000#6 = 2017;
         |SI eaOpcion = "1";  |HAZ PortalBorrador2017;  |FINSI;
         |SI eaOpcion = "2";  |HAZ PortalPDF2017;       |FINSI;
         |SI eaOpcion = "3";  |HAZ PortalInternet2017;  |FINSI;
     |FINSI;

     |SI #dsmoy000#6 ] 2018;
         |SI eaOpcion = "1";  |HAZ PortalBorrador2018;  |FINSI;
         |SI eaOpcion = "2";  |HAZ PortalPDF2018;       |FINSI;
         |SI eaOpcion = "3";  |HAZ PortalInternet2018;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonF2;
     |PTEC 824;
|FPRC;

|PROCESO BotonF3;
     |PTEC 825;
|FPRC;

|PROCESO BotonF4;
     |PTEC 826;
|FPRC;

|PROCESO BotonF5;
     |PTEC 827;
|FPRC;

|PROCESO BotonEsc;
     |PTEC 806;
|FPRC;

|PROCESO Botones2015;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Borrador sin validacion ", 0513, 0754, BotonF2;
     nBtnF2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Formato PDF", 0913, 1154, BotonF3;
     nBtnF3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica ", 1313, 1554, BotonF4;
     nBtnF4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, BotonEsc;
     nBtnEs = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Explorador predeterminado", 2113, 2354, BotonF5;
     nBtnF5 = FSalida;

     eaForzExplorador = "S";

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF5  = &255 + "827";
     aEsc = &255 + "806";

     eaOpcion = "0";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  eaOpcion = "1"; |SAL;  |FINSI;
         |SI aTecla = aF3;  eaOpcion = "2"; |SAL;  |FINSI;

         |SI aTecla = aF4;
             enPresentar = 0;
             |CONFI "0000SPresentamos la declaracion en el momento de crearlas";
             |SI FSalida = 0;
                 enPresentar = 1;
             |FINSI;

             eaOpcion   = "3";
             |SAL;
         |FINSI;

         |SI aTecla = aEsc;                 |SAL;  |FINSI;

         |SI aTecla = aF5;
             eaForzExplorador = "S";
             |HAZ Explorador;
         |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnF2;
     |FIN_CONTROL_WINDOWS nBtnF3;
     |FIN_CONTROL_WINDOWS nBtnF4;
     |FIN_CONTROL_WINDOWS nBtnF5;
     |FIN_CONTROL_WINDOWS nBtnEs;

     |PULSATECLA;
|FPRC;

|PROCESO Botones2017;
     |BLANCO 0501 2380;

     |CONTROL_SIMPLE 0, "LBOTON, <F2> Borrador con validacion ", 0513, 0754, BotonF2;
     nBtnF2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F3> Formulario PDF", 0913, 1154, BotonF3;
     nBtnF3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F4> Presentacion Telematica ", 1313, 1554, BotonF4;
     nBtnF4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,ESC Cancelar", 2365, 2378, BotonEsc;
     nBtnEs = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON, <F5> Explorador predeterminado", 2113, 2354, BotonF5;
     nBtnF5 = FSalida;

     eaForzExplorador = "S";

     aF2  = &255 + "824";
     aF3  = &255 + "825";
     aF4  = &255 + "826";
     aF5  = &255 + "827";
     aEsc = &255 + "806";

     eaOpcion = "0";
     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;

         |SI aTecla = aF2;  eaOpcion = "1"; |SAL;  |FINSI;
         |SI aTecla = aF3;  eaOpcion = "2"; |SAL;  |FINSI;

         |SI aTecla = aF4;
             enPresentar = 0;
             |CONFI "0000SPresentamos la declaracion en el momento de crearlas";
             |SI FSalida = 0;
                 enPresentar = 1;
             |FINSI;

             eaOpcion   = "3";
             |SAL;
         |FINSI;

         |SI aTecla = aEsc;                 |SAL;  |FINSI;

         |SI aTecla = aF5;
             eaForzExplorador = "S";
             |HAZ Explorador;
         |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnF2;
     |FIN_CONTROL_WINDOWS nBtnF3;
     |FIN_CONTROL_WINDOWS nBtnF4;
     |FIN_CONTROL_WINDOWS nBtnF5;
     |FIN_CONTROL_WINDOWS nBtnEs;

     |PULSATECLA;
|FPRC;
