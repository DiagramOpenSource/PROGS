|FICHEROS;
   eosyyyyy #0;
   eoscabve #1;
   eoscabco #2;
   eosclien #3;
|FIN;

|VARIABLES;
   fichero  = "";
   fichero1 = "";
   fichero2 = "";
   anyo     = "";
   copiar1  = "";
   copiar2  = "";
   copiar3  = "";
   copiar4  = "";
   copy     = "";
   fich     = "";
   systema  = "";
   pasar    = 0;
   dire     = "";
   &eaNCaja = "";
   &aTipoIVA = "";
|FIN;

|PROGRAMA;
    |CLS;
    |CABEZA "Recuperar Lineas Compras-Ventas";
    |PINPA #0#0;
    |ABRE #0;
    |DDEFECTO #0;
    |LEE 101#0p;
    |SI FSalida ! 0; |CIERRA #0; |ACABA; |FINSI;
    |PINDA #0#0;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |GRABA 020#0a;
        |HAZ pasamelo;
    |FINSI;
    |LIBERA #0;
    |CIERRA #0;
|FPRO;

|PROCESO pasamelo;
    |SI #0#4 ! "<MYPASWD> ";
        |AVISO;  |AVISO;  |AVISO;

        |D_CUADRO 1926, 2357;
        |ATRI R;
        |PINTA 2027, "     CLAVE INCORRECTA         ";
        |PINTA 2127, "------------------------------";
        |PINTA 2227, "  EL FICHERO NO SE HA COPIADO ";
        |ATRI 0;
        |PAUSA;

        |ACABA;
    |FINSI;

    fichero = #0#0;
    fichero = "00000" + fichero;
    fichero = fichero % -105;
    anyo    = #0#1;
    anyo    = "00" + anyo;
    anyo    = anyo % -102;
    eaNCaja = fichero + anyo;

    |SI #0#2 = "C"; |HAZ compras; |FINSI;
    |SI #0#2 = "V"; |HAZ ventas;  |FINSI;

    |SI pasar ! 1; |ACABA; |FINSI;

    |DFICE fich;
    |SI #0#2 = "C"; |HAZ copia_compra; |FINSI;
    |SI #0#2 = "V"; |HAZ copia_venta;  |FINSI;

    |SI #0#1 ] 14; |HAZ copia_RECC; |FINSI;
|FPRC;

|PROCESO compras;
    |ABRE #2;
    #2#0 = #0#0;
    #2#4 = #0#1;
    |LEE 040#2=;
    |SI FSalida = 0;
        pasar    = 1;
        fichero  = "c" + fichero + anyo;
        aTipoIVA = "S";
    |SINO;
        pasar = 0;
        |MENAV "    No existen registros de compras con esa Clave";
    |FINSI;
    |CIERRA #2;
|FPRC;

|PROCESO ventas;
    |ABRE #1;
    #1#0 = #0#0;
    #1#4 = #0#1;
    |LEE 040#1=;
    |SI FSalida = 0;
        pasar    = 1;
        fichero  = "v" + fichero + anyo;
        aTipoIVA = "R";
    |SINO;
        pasar = 0;
        |MENAV "    No existen registros de ventas con esa Clave";
    |FINSI;
    |CIERRA #1;
|FPRC;

|PROCESO copia_compra;
    fichero1 = fich + "eoslinco.ixx"
    fichero2 = fich + fichero + ".ixx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eoslinco.dat"
    fichero2 = fich + fichero + ".dat";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eoslinco.ddx"
    fichero2 = fich + fichero + ".ddx";
    |COPIA_FICHERO fichero1, fichero2;

    |SI FSalida ! 0; |ACABA; |FINSI;

    |AVISO;  |AVISO;  |AVISO;
    |D_CUADRO 2026, 2257;
    |ATRI R;
    |PINTA 2127, "  EL FICHERO YA ESTA COPIADO  ";
    |ATRI 0;
    |PAUSA;
|FPRC;

|PROCESO copia_venta;
    fichero1 = fich + "eoslinve.ixx"
    fichero2 = fich + fichero + ".ixx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eoslinve.dat"
    fichero2 = fich + fichero + ".dat";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eoslinve.ddx"
    fichero2 = fich + fichero + ".ddx";
    |COPIA_FICHERO fichero1, fichero2;

    |SI FSalida ! 0; |ACABA; |FINSI;

    |AVISO;  |AVISO;  |AVISO;
    |D_CUADRO 2026, 2257;
    |ATRI R;
    |PINTA 2127, "  EL FICHERO YA ESTA COPIADO  ";
    |ATRI 0;
    |PAUSA;
|FPRC;

|PROCESO copia_RECC;
    fichero = "f" + eaNCaja;

    fichero1 = fich + "eosmcc01.ixx"
    fichero2 = fich + fichero + ".ixx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eosmcc01.dat"
    fichero2 = fich + fichero + ".dat";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eosmcc01.ddx"
    fichero2 = fich + fichero + ".ddx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero = "m" + eaNCaja;

    fichero1 = fich + "eosmcc02.ixx"
    fichero2 = fich + fichero + ".ixx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eosmcc02.dat"
    fichero2 = fich + fichero + ".dat";
    |COPIA_FICHERO fichero1, fichero2;

    fichero1 = fich + "eosmcc02.ddx"
    fichero2 = fich + fichero + ".ddx";
    |COPIA_FICHERO fichero1, fichero2;
|FPRC;
