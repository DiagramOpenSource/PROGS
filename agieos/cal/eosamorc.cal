|FICHEROS;
     eosamorc #0;
     eosamorl #1;
     eosclpre #2;
     eosconce #3;
     eosutili #4;
     eosclien #5;
     eosactiv #6;
     eosconc6 #7;
|FIN;

|VARIABLES;
     &EURODB = 0;
     &Modo   = 0;
     Sw      = 0;
     Empresa = 0;
     VarNum  = 0;
     VAlfa   = "";
     nForma  = 0;
     nT600   = 0;
     &enEosEmp = 0;
     &enEosCPr = 0;
     &eaEosNIF = "";
     &enEosTip = 0;
     nCampos = 0;
     nInkey  = 0;
|FIN;

|INCLUYE  i_consul;

|PROCESO LeeLineas;
     #0#11 = #0#11 + #1#8;
     #0#12 = #0#12 + #1#11;
     #0#13 = #0#11 - #0#12;
|FPRC;

|PROCESO ActuaCabecera;  |TIPO 2;
     nForma = 0 +. 1;
     |SI nForma = 1;
         #0#11 = 0;
         #0#12 = 0;
         #0#13 = 0;
         |BUCLELIN 0LeeLineas#0;
         |PINTA #0#11;
         |PINTA #0#12;
         |PINTA #0#13;
     |FINSI;
|FPRC;

|PROCESO Tipo14; |TIPO 14;
|ABRE #6;
#6#0 = #0#0;
#6#1 = #0#16;
#6#2 = #0#1;
|LEE 040#6=;
|SI FSalida ! 0; |ACABA; |FINSI;
|CIERRA #6;

Empresa = #0#0;

|PINTA 1315, "      ";
|SI #6#50 = 1;
    |C_V #0#17, 1, "N";  |C_M #0#17, 1, "N";
    |C_V #0#09, 1, "S";  |C_M #0#09, 1, "S";
|FINSI;

|SI #6#50 = 2;
    |C_V #0#17, 1, "S";  |C_M #0#17, 1, "S";
    |C_V #0#09, 1, "N";  |C_M #0#09, 1, "N";
|FINSI;
|FPRC;

|PROCESO Entrada_A; |TIPO 0;
Modo    = (FEntrada / 100) ! 0;
Sw      = 0;

|SI Modo = 1; #1#3 = 1; |FINSI;

|ABRE #5;
#5#0 = #0#0;
|LEE 040#5=;
|SI FSalida ! 0;
    |MENAV "     No existe Empresa.";
    |ERROR;
|FINSI;
|CIERRA #5;
|FPRC;

|PROCESO Actividad; |TIPO 0;
  Sw = 0;
  Empresa = #0#0;

  |ABRE #6;
  #6#0 = #0#0;
  #6#1 = #0#16;
  #6#2 = #0#1;
  |LEE 040#6=;
  |SI FSalida ! 0;
      |MENAV "      No existe Actividad.";
      |ERROR;
  |SINO;
      |SI #6#15 = "N";
           |MENAV "      La Actividad no esta preparada para hacer libros.";
           |ERROR;
      |FINSI;
      |SI #6#14 = "S";
           |MENAV "      La Actividad es un Comunero";
           |ERROR;
      |FINSI;
  |FINSI;
  |CIERRA #6;

  |SI #6#50 = 1; |PINTA #0#9;  |FINSI;
  |SI #6#50 = 2; |PINTA #0#17; |FINSI;

  |C_M #0#18, 1, "N";
  |SI #6#22 = "A";
      |C_M #0#18, 1, "S";
  |FINSI;

  |C_M #0#20, 1, "S";
  |SI #6#22 = "N";
      |C_M #0#20, 1, "N";
      #0#20 = "S";
      |PINTA #0#20;
  |FINSI;
|FPRC;

|PROCESO FechaCom; |TIPO 0;
 VAlfa  = #0Campo;
 VAlfa  = VAlfa % -102;
 VarNum = VAlfa;
 |SI VarNum ! #0#1;
     |MENAV  "     La fecha no coincide con el a¤o.";
     |ERROR;
 |FINSI;
|FPRC;

|CALCULO FInicio7;  |TIPO 7;
     |SI #0Campo [ "01.01.1900";
         #0Campo = #0#21; |PINTA #0Campo;
     |FINSI;
|FCAL;

|CALCULO FInicio0;  |TIPO 0;
     |SI #0#10 < #0#21;
         |MENAV "    La Fecha Inicio debe ser igual o mayor a la de Compra";
         |ERROR;
     |FINSI;
|FCAL;

|PROCESO Empresa; |TIPO 7;
     Empresa = #0#0;
|FPRC;

|PROCESO Empresa66; |TIPO 66;
|FPRC;

|PROCESO inf2;
  #2#0 = Empresa;
  #2#1 = 00000;
  #2#2 = 2;
|FPRC;

|PROCESO sup2;
  #2#0 = Empresa;
  #2#1 = 99999;
  #2#2 = 2;
|FPRC;

|PROCESO ConsuPro; |TIPO 6;
     nInkey = FSalida;
     |SI nInkey = 11;
         |HAZ OtraAltaPrCl;
         |ACABA;
     |FINSI;

     |SI nInkey = 6;
         #2#0 = Empresa;
         #2#1 = #0Campo;
         #2#2 = 2;
         |ABRE #2;
         |CONSULTA_F_CLAVE #1#2, inf2, sup2;
         |CIERRA #2;
         #0Campo = #2#1; |PINTA #0Campo;
     |FINSI;

     Campo10020 = #0#0;
     Campo10022 = 2;
     Campo10021 = #0Campo;
     nCampos    = Campo;
     |HAZ ConsuCliProv;
     Campo     = nCampos;
     #0nCampos = Campo10021;  |PINTA #0nCampos;

     |ABRE #2;
     #2#0 = #0#0;
     #2#1 = #0nCampos;
     #2#2 = 2;
     |LEE 001#2=;
     |SI FSalida ! 0;
         |CIERRA #2;
         |CONFI "    SNo existe Proveedor, Desea darlo de alta ";
         |SI FSalida ! 0;
             #0Campo = 0; |PINTA #0Campo;
         |SINO;
             |HAZ AltaPrCl;
         |FINSI;
     |SINO;
         |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO Proveedor; |TIPO 0;
|SI Empresa ! #0#0;
    #0#0 = Empresa;
    |PINTA #0#0;
    |MENAV "    El proveedor no pertenece a la Empresa seleccionada.";
    |ERROR;
|SINO;
   |ABRE #2;
   |SELECT #1#2;
   #2#0 = Empresa;
   #2#1 = #0#8;
   #2#2 = 2;
   |LEE 040#2=;
   |SI FSalida ! 0;
      |MENAV "     Has seleccionado a un cliente.";
      |ERROR;
   |SINO;
      #0#14 = #2#4;
      |PINTA #0#14;
   |FINSI;
   |CIERRA #2;
|FINSI;
|FPRC;

|PROCESO PintaCon;
|ABRE #6;
#6#0 = #0#0;
#6#1 = #0#16;
#6#2 = #0#1;
|LEE 040#6=;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;
|CIERRA #6;

|SI #6#50 = 1; |HAZ LeeConcepto2; |FINSI;
|SI #6#50 = 2; |HAZ LeeConcepto6; |FINSI;
|FPRC;

|PROCESO LeeConcepto2;
  |ABRE #3;
  #3#0 = #0#9;
  |LEE 040#3=;
  |SI FSalida ! 0;
      |MENAV  "    No existe concepto.";
      |ERROR;
  |SINO;
      |SI #3#3 ! "G";
          |SI #3#2 ! "S"; |Y #3#2 ! "I";
              |CONFI "    NEl concepto no es de Compra ni de Inversion. Continuar ";
              |SI FSalida ! 0;
                  |ERROR;
              |FINSI;
          |FINSI;
      |FINSI;
      #0#15 = #3#1;
      |PINTA #0#15;
  |FINSI;
  |CIERRA #3;
|FPRC;

|PROCESO LeeConcepto6;
  |ABRE #7;
  #7#0 = #0#17;
  |LEE 040#7=;
  |SI FSalida ! 0;
      |MENAV  "    No existe concepto.";
      |ERROR;
  |SINO;
      |SI #7#3 ! "G";
          |SI #7#2 ! "S"; |Y #7#2 ! "I";
              |CONFI "    NEl concepto no es de Compra ni de Inversion. Continuar ";
              |SI FSalida ! 0;
                  |ERROR;
              |FINSI;
          |FINSI;
      |FINSI;
      #0#15 = #7#1;
      |PINTA #0#15;
  |FINSI;
  |CIERRA #7;
|FPRC;

|PROCESO Diferencia; |TIPO 0;
  #0#13 = #0#11 - #0#12;
  |PINTA #0#13;
|FPRC;

|PROCESO LineaNueva; |TIPO 0;
|SI Modo = 1; |Y Sw = 0; |Y #1#3 = 1;
    Sw = 1;
    #1#0 = #0#0;
    #1#1 = #0#1;
    #1#2 = #0#2;
    #1#3 = 1;
    |LEE 040#1=;
    |SI FSalida ! 0;
       |ABRE #4;
       |PUSHV 0501 2379;
       |PINPA #3#4;
       |ENCAMPO #5#4;
       #4#6 = #0#11 % #4#5;
       |ENCAMPO #6#4;
       |POPV;

       |DDEFECTO #1;
       #1#0 = #0#0;
       #1#1 = #0#1;
       #1#2 = #0#2;
       #1#3 = 1;           |PINTA #1#3;
       #1#4 = #0#1;        |PINTA #1#4;
       #1#5 = #0#21;       |PINTA #1#5;
       #1#6 = "C";         |PINTA #1#6;
       #1#7 = "Compra ";   |PINTA #1#7;
       #1#8 = #0#11;       |PINTA #1#8;
       #1#9 = #4#5;        |PINTA #1#9;
       #1#10 = #4#6;       |PINTA #1#10;
       #1#11 = 0;          |PINTA #1#11;
       #1#12 = "N";        |PINTA #1#12;
       #0#11 = 0;
       |PTEC 806;
       |CIERRA #4;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO FiltroAnterior; |TIPO 0;
|SI #1#4 ] 0;  |Y #1#4 [ 80;
    |SI #1#1 ] 0;  |Y #1#1 [ 80;
        |SI #1#4 < #1#1;
            |MENAV "    El A¤o es erroneo";
        |FINSI;
    |FINSI;
    |ACABA;
|FINSI;

|SI #1#4 < #1#1;
    |MENAV "    El A¤o es erroneo";
    |ERROR;
|FINSI;
|FPRC;

|PROCESO Fecha; |TIPO 0;
VAlfa  = #1#5;
VAlfa  = VAlfa % -102;
VarNum = VAlfa;
|SI VarNum ! #1#4;
   |MENAV "      La fecha no coincide con el a¤o.";
   |ERROR;
|FINSI;
|FPRC;

|PROCESO Iva; |TIPO 7;
|SI Modo = 1;
   #1#10 = #1#8 % #1#9;
   |PINTA #1#10;
|FINSI;
|FPRC;

|PROCESO Actual; |TIPO 2;
#0#11 = #0#11 +. #1#8;
#0#12 = #0#12 +. #1#11;
#0#13 = #0#11 - #0#12;
|PINTA #0#11;
|PINTA #0#12;
|PINTA #0#13;
|FPRC;

|PROCESO Nomodifica; |TIPO 0;
|SI #1#6 = "A";
    |C_M #1#8,  1, "N";
    |C_M #1#9,  1, "N";
    |C_M #1#10, 1, "N";
    |C_M #1#11, 1, "S";
|FINSI;

|SI #1#6 = "C";
    |C_M #1#8,  1, "S";
    |C_M #1#9,  1, "S";
    |C_M #1#10, 1, "S";
    |C_M #1#11, 1, "N";
|FINSI;
|FPRC;

|PROCESO Primera; |TIPO 7;
|SI Modo = 1; |Y Sw = 0;|Y #1#3 = 1;
    |PTEC 801;
|FINSI;
|FPRC;

|PROCESO PulsaF1;  |TIPO 0;
  |SI #6#22 ! "A";  |ACABA;  |FINSI;

  VAlfa  = #0#10 % -102;
  VarNum = VAlfa;

  |SI #0#18 = 0;  |Y VAlfa = VarNum; |Y #0#11 [ 100000;
      #0#18 = 5;  |PINTA #0#18;
  |FINSI;

  |SI #0#18 = 5;
      |SI VAlfa ! VarNum; |O #0#11 > 100000;
          |MENAV "     No puede ser tipo 5.";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI FSalida ! 9;  |ACABA;  |FINSI;

  |PUSHV 0501 2380;
  |D_CUADRO 0706, 1460;
  |ATRI R;
  |PINTA 0807, " -0- Nada                                            ";
  |PINTA 0907, " -1- Edificios y otras construcciones    5%   40 a¤os";
  |PINTA 1007, " -2- Utiles, herramientas, equipos.     40%    5 a¤os";
  |PINTA 1107, " -3- Elementos de transportes y resto   25%    8 a¤os";
  |PINTA 1207, " -4- Inmovilizado inmaterial            15%   10 a¤os";
  |PINTA 1307, " -5- Inmovilizado material nuevos      100%          ";
  |ATRI r;
  |PAUSA;
  |POPV;
  |ERROR;
|FPRC;

|CALCULO Eldefecto; |TIPO 0;
 Modo    = (FEntrada / 100) ! 0;
 |SI Modo ! 1; |ACABA; |FINSI;

  nT600 = 100000;
  |SI EURODB = 0;
      nT600 = (nT600 / 166.386) ! EURODB;
  |FINSI;

 |SI #0#20 = "N";
     |SI #0#11 [ nT600;
         #0#5 = 100; |PINTA #0#5;
         #0#6 = 100; |PINTA #0#6;
     |FINSI;
 |FINSI;
|FCAL;

|PROCESO AltaPrCl;
 enEosEmp = #0#0;
 enEosCPr = #0#8;
 eaEosNIF = "";
 enEosTip = 2;
 |SUB_EJECUTA_NP "eosaltcp";
|FPRC;

|PROCESO OtraAltaPrCl;
  |ABRE #2;
  |SELECT #1#2;
  #2#0 = #0#0;
  #2#2 = 2;
  #2#1 = 99999;
  |LEE 010#2];
  |SI FSalida = 0;
      |LEE 040#2a;
  |SINO;
      |LEE 040#2u;
  |FINSI;
  enEosCPr = 0;
  |SI FSalida = 0; |Y #2#0 = #0#0; |Y #2#2 = 2;
      enEosCPr = #2#1;
  |FINSI;
  |CIERRA #2;
  enEosCPr = enEosCPr + 1;
  enEosEmp = #0#0;
  eaEosNIF = "";
  enEosTip = 2;
  |SUB_EJECUTA_NP "eosaltcp";
  #0#8 = enEosCPr; |PINTA #0#8;
|FPRC;
