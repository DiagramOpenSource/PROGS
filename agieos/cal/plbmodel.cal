|FICHEROS;
     dsmom073;
     eosm0032;
     eosm0034;
     eosm0035;
|FIN;

|VARIABLES;
     nEjer        = 0;
     nSw          = 0;
     nHayIRPF     = 0;

     &enEjerIRPF  = 0;
     &eaExtension = "";
     &eaPrograma  = "";
|FIN;

|PROCESO BuscaEjerIRPF;
     nEjer       = enEjerIRPF;
     enEjerIRPF  = 0;

     |ABRE #dsmom073;
     #dsmom073#0 = nEjer;
     #dsmom073#1 = "";
     #dsmom073#2 = "";
     |LEE 000#dsmom073.];
     |SI FSalida = 0;
         |SI #dsmom073#0 > nEjer;
             |LEE 000#dsmom073.a;
             |SI FSalida = 0;
                 |SI #dsmom073#0 < nEjer;
                     enEjerIRPF = #dsmom073#0;
                 |FINSI;
             |FINSI;
         |SINO;
             enEjerIRPF = #dsmom073#0;
         |FINSI;
     |SINO;
         |LEE 000#dsmom073.a;
         |SI FSalida = 0;
             enEjerIRPF = #dsmom073#0;
         |FINSI;
     |FINSI;
     |CIERRA #dsmom073;
|FPRC;

|PROCESO PatronM073;

     nSw = 0;
     |ABRE #dsmom073;
     #dsmom073#0 = 2018;
     #dsmom073#1 = "A";
     #dsmom073#2 = " ";
     |LEE 000#dsmom073.=;
     |SI FSalida ! 0;
         nSw = 1;
     |FINSI;
     |CIERRA #dsmom073;

     |SI nSw ! 0;
         eaExtension = "eos";
         eaPrograma  = "dsmom073";
         |SUB_EJECUTA "eosz0035";

         |ABRE #dsmom073;
         |LEE 000#dsmom073.p;
         #dsmom073#0 = 2018;
         #dsmom073#1 = "A";
         #dsmom073#2 = "  ";
         |LEE 000#dsmom073.=;
         |SI FSalida ! 0;
             |MENAV "0000 El fichero de Claves IRPF no se ha instalado, por favor instale la aplicacion ipbasica";
             nSw = 0;
         |FINSI;
         |CIERRA #dsmom073;
     |FINSI;

     |SI nSw = 1;
         || ... Procedemos a hacer el cambio de Claves.
         ||     Por ahora no hacemos cambio automatico
         ||     |SUB_EJECUTA_NP ":agieos/dsmoz067;ES2018";
     |FINSI;
|FPRC;
