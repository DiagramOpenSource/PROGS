|FICHEROS;
   eosyyyyy #0;
   eoscabve #1;
   eoscabco #2;

   eosmcc01 #501;
|FIN;

|VARIABLES;
   fichero  = "";
   fichero1 = "";
   fichero2 = "";
   anyo     = "";
   copiar1  = "";
   copiar2  = "";
   copiar3  = "";
   copiar4  = "";
   copy     = "";
   fich     = "";
   systema  = "";
   pasar    = 0;
   &eaNCaja = "";
  &aTipoIVA = "";
|FIN;

|PROGRAMA;
    |CLS;
    |CABEZA "Preparar Compras-Ventas";
    |PINPA #0#0;
    |ABRE #0;
    |DDEFECTO #0;
    |LEE 101#0p;
    |SI FSalida ! 0;
        |GRABA 020#0b;
    |FINSI;
    |PINDA #0#0;
    |ENDATOS #1#0;
    |SI FSalida = 0;
        |GRABA 020#0a;
        |HAZ pasamelo;
    |FINSI;
    |LIBERA #0;
    |CIERRA #0;
|FPRO;

|PROCESO pasamelo;
    fichero = #0#0;
    fichero = "00000" + fichero;
    fichero = fichero % -105;
    anyo    = #0#1;
    anyo    = "00" + anyo;
    anyo    = anyo % -102;
    eaNCaja = fichero + anyo;

    |SI #0#2 = "C"; |HAZ compras; |FINSI;
    |SI #0#2 = "V"; |HAZ ventas;  |FINSI;

    |SI pasar ! 1; |ACABA; |FINSI;

    |DFICE fich;
    |SI #0#2 = "C"; |HAZ copia_compra; |FINSI;
    |SI #0#2 = "V"; |HAZ copia_venta;  |FINSI;

    |SI #0#1 ] 14; |HAZ copia_RECC; |FINSI;
|FPRC;

|PROCESO compras;
    |ABRE #2;
    #2#0 = #0#0;
    #2#4 = #0#1;
    |LEE 040#2=;
    |SI FSalida = 0;
        pasar    = 1;
        fichero  = "c" + fichero + anyo;
        aTipoIVA = "S";
    |SINO;
        pasar = 0;
        |MENAV "    No existen registros de compras con esa Clave";
    |FINSI;
    |CIERRA #2;
|FPRC;

|PROCESO ventas;
    |ABRE #1;
    #1#0 = #0#0;
    #1#4 = #0#1;
    |LEE 040#1=;
    |SI FSalida = 0;
        pasar    = 1;
        fichero  = "v" + fichero + anyo;
        aTipoIVA = "R";
    |SINO;
        pasar = 0;
        |MENAV "    No existen registros de ventas con esa Clave";
    |FINSI;
    |CIERRA #1;
|FPRC;

|PROCESO copia_compra;
    fichero2 = fich + "eoslinco.ixx"
    fichero1 = fich + fichero + ".ixx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero2 = fich + "eoslinco.dat"
    fichero1 = fich + fichero + ".dat";
    |COPIA_FICHERO fichero1, fichero2;

    fichero2 = fich + "eoslinco.ddx"
    fichero1 = fich + fichero + ".ddx";
    |COPIA_FICHERO fichero1, fichero2;

    |SI FSalida ! 0; |ACABA; |FINSI;

    |AVISO;  |AVISO;  |AVISO;
    |D_CUADRO 2026, 2257;
    |ATRI R;
    |PINTA 2127, "  EL FICHERO YA ESTA COPIADO  ";
    |ATRI 0;
    |PAUSA;
|FPRC;

|PROCESO copia_venta;
    fichero2 = fich + "eoslinve.ixx"
    fichero1 = fich + fichero + ".ixx";
    |COPIA_FICHERO fichero1, fichero2;

    fichero2 = fich + "eoslinve.dat"
    fichero1 = fich + fichero + ".dat";
    |COPIA_FICHERO fichero1, fichero2;

    fichero2 = fich + "eoslinve.ddx"
    fichero1 = fich + fichero + ".ddx";
    |COPIA_FICHERO fichero1, fichero2;

    |SI FSalida ! 0; |ACABA; |FINSI;

    |AVISO;  |AVISO;  |AVISO;
    |D_CUADRO 2026, 2257;
    |ATRI R;
    |PINTA 2127, "  EL FICHERO YA ESTA COPIADO  ";
    |ATRI 0;
    |PAUSA;
|FPRC;

|PROCESO copia_RECC;
    fichero = "f" + eaNCaja;
    |NOME_DAT #501 fichero;

    pasar = 0;
    |ABRE #501;
    #501#0  = #0#0;
    #501#1  = #0#1;
    #501#13 = aTipoIVA;
    #501#2  = 00001;
    |LEE 041#501];
    |SI FSalida = 0; |Y #501#0 = #0#0; |Y #501#1 = #0#1; |Y #501#13 = aTipoIVA;
        pasar = 1;
    |FINSI;
    |CIERRA #501;

    |SI pasar = 1;

        fichero2 = fich + "eosmcc01.ixx"
        fichero1 = fich + fichero + ".ixx";
        |COPIA_FICHERO fichero1, fichero2;

        fichero2 = fich + "eosmcc01.dat"
        fichero1 = fich + fichero + ".dat";
        |COPIA_FICHERO fichero1, fichero2;

        fichero2 = fich + "eosmcc01.ddx"
        fichero1 = fich + fichero + ".ddx";
        |COPIA_FICHERO fichero1, fichero2;

        |SI FSalida ! 0; |ACABA; |FINSI;

        fichero = "m" + eaNCaja;

        fichero2 = fich + "eosmcc02.ixx"
        fichero1 = fich + fichero + ".ixx";
        |COPIA_FICHERO fichero1, fichero2;

        fichero2 = fich + "eosmcc02.dat"
        fichero1 = fich + fichero + ".dat";
        |COPIA_FICHERO fichero1, fichero2;

        fichero2 = fich + "eosmcc02.ddx"
        fichero1 = fich + fichero + ".ddx";
        |COPIA_FICHERO fichero1, fichero2;

        |SI FSalida ! 0; |ACABA; |FINSI;
   |FINSI;
|FPRC;
