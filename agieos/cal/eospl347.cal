|FICHEROS;
     eospl347 #0;             || Este Def
     eosm0009 #1;             || Cabecera 347
     eosm0010 #2;             || Lineas 347
     eosm0016 #44;            || Lineas 347 Metalico
     eoslinve #3;             || Lineas Ventas
     eoslinco #4;             || Lineas Compras
     eosclien #5;             || Clientes
     eosclpre #6;             || Clientes Proveedores Empresa
     eosconce #7;             || Conceptos 2 Digitos
     eosactiv #8;             || Actividad
     eosm0011 #9;             || Maestros Referencias Catastrales
     eosm0012 #10;            || Registro de Arrendamientos
     eosm0008 #11;            || Control 347
     eosconc6 #17;            || Conceptos 6 Digitos
     eosw0042 #99;            || Temporal del Pase
     eosw0159 #959;           || Temporal del Pase A y B

     eosmcc01 #501;
     eosmcc02 #502;
|FIN;

|VARIABLES;
     XPara        = 0;
     XPara1       = 0;
     XPara2       = 0;
     Clave        = "";
     LocalNegocio = "";
     LocalBueno   = "";
     NLocal       = 0;
     Seguros      = "";
     Factura      = 0;
     PosConcepto  = 0;
     Campos1      = 0;
     Campos2      = 0;
     Campos3      = 0;
     Campos4      = 0;
     SwFichero    = 0;
     Fichero      = "";
     aFichero     = "";
     VAnyo        = "";

     nTrans       = 0;
     fLaFecha     = @;
     aAlfa1       = "";
     nNume1       = 0;
     Trimestre    = 0;
     nCampo1      = 0;
     nCampo2      = 0;
     nNegativo    = 0;
     aOp1         = "";
     aOp2         = "";
     aOp3         = "";
     &enEjer      = 0;

     nBase       = 0;
     nBaseCaja   = 0;
     nBaseCaja1  = 0;
     nBaseCaja2  = 0;
     nBaseCaja3  = 0;
     nBaseCaja4  = 0;
     nBaseCaja5  = 0;
     nBaseCaja6  = 0;
     nCuotaCaja  = 0;
     nCuotaCaja1 = 0;
     nCuotaCaja2 = 0;
     nCuotaCaja3 = 0;
     nCuotaCaja4 = 0;
     nCuotaCaja5 = 0;
     nCuotaCaja6 = 0;
|FIN;

|INCLUYE i_consul;
|INCLUYE i_ficher;
|INCLUYE i_varcaj;

|CALCULO Eano; |TIPO 7;
  fLaFecha = ~;
  aAlfa1   = fLaFecha;
  aAlfa1 = aAlfa1 % -102;
  nNume1 = aAlfa1;
  nNume1 = nNume1 - 1;
  #0Campo = nNume1; |PINTA #0Campo;
|FCAL;

|PROCESO Seleccion; |TIPO 0;
  #0Campo = #0Campo > #0Campo; |PINTA #0Campo;

  |SI #0#0 = "S";
      |C_M #0#1, 1, "N";
      |C_M #0#2, 1, "N";

      |PARA XPara = 3; |SI XPara [ 22; |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
  |SINO;
      |C_M #0#1, 1, "S";
      |C_M #0#2, 1, "S";

      |PARA XPara = 3; |SI XPara [ 22; |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N"; #0XPara = 0;  |PINTA #0XPara;
      |SIGUE;
  |FINSI;
|FPRC;

|PROCESO MiraRefer;
  |SI #99#18 = #9#5;  LocalBueno = #99#4;  |FINSI;
  NLocal = #99#4;
|FPRC;

|DEFBUCLE eosw0042A;
  #99#1;
  ;
  #5#0, #0#23, "Z", #6#3, "N", "N", "00", "N", " ";
  #5#0, #0#23, "Z", #6#3, "N", "N", "99", "N", "z";
  ;
  NULL, MiraRefer;
|FIN;

|PROCESO ElTrimestre;
  |SI #0#23 > 10; |Y #0#23 < 80;
      nCampo1 = 21 + Trimestre;
      nCampo2 = 25 + Trimestre;
      #99nCampo1 = #99nCampo1 + Factura;
      |SI nTrans = 1;
          #99nCampo2 = #99nCampo2 + Factura;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO GrabaTempo;
  aOp3 = "N";
  |SI Clave = "A"; |O Clave = "B";
      |SI aOp1 = "N"; |Y aOp2 = "N";
          |SI enSwCaja = 1;
              aOp3 = "S";
          |FINSI;
      |FINSI;
  |FINSI;
  |SI aOp1 = "S";
      Factura = nBase; ||solo pasa la Base Imponible Op. ISP
  |FINSI;

  #99#00 = #5#0;                   || Empresa
  #99#01 = #0#23;                  || A¤o
  #99#02 = Clave;                  || Clave
  #99#03 = #6#3;                   || NIF
  #99#04 = Seguros;                || Operacion Seguros
  #99#05 = LocalNegocio;           || Arrendamientos
  #99#30 = aOp1;
  #99#31 = aOp2;
  #99#32 = aOp3;
  |LIBERA #99;
  |LEE 140#99=;
  |SI FSalida ! 0;
      |DDEFECTO #99;
      #99#00 = #5#0;                   || Empresa
      #99#01 = #0#23;                  || A¤o
      #99#02 = Clave;                  || Clave
      #99#03 = #6#3;                   || NIF
      #99#04 = Seguros;                || Operacion Seguros
      #99#05 = LocalNegocio;           || Arrendamientos
      #99#30 = aOp1;
      #99#31 = aOp2;
      #99#32 = aOp3;
      #99#06 = #6#4;                   || Apellidos y Nombre
      #99#07 = #6#5;                   || SG
      #99#08 = #6#6;                   || Calle
      #99#09 = #6#7;                   || Numero
      #99#11 = #6#8;                   || Piso
      #99#12 = #6#9;                   || Puerta
      #99#13 = #6#10;                  || Codigo Postal 1
      #99#14 = #6#11;                  || Codigo Postal 2
      #99#15 = #6#13;                  || Poblacion
      #99#16 = #6#12;                  || Provincia
      #99#19 = Factura;                || Importe

      |SI nTrans = 1;
          #99#21 = Factura;            || Transimiones;
      |FINSI;
      |HAZ ElTrimestre;

      |SI aOp3 = "S";
          #99#33 = (nBaseCaja + nCuotaCaja) ! 2;
      |FINSI;
      |GRABA 140#99n;
  |SINO;
      #99#19 = #99#19 + Factura;       || Importe

      |SI nTrans = 1;
          #99#21 = #99#21 + Factura;            || Transimiones;
      |FINSI;

      |HAZ ElTrimestre;

      |SI aOp3 = "S";
          #99#33 = #99#33 + (nBaseCaja + nCuotaCaja) ! 2;
      |FINSI;
      |GRABA 140#99a;
  |FINSI;

  |SI Clave = "A"; |O Clave = "B";
      #959#00 = #5#0;  || Empresa
      #959#01 = #6#3;  || NIF
      #959#02 = Clave; || Clave
      |LEE 041#959=;
      |SI FSalida ! 0;
          |DDEFECTO #959;
          #959#00 = #5#0;  || Empresa
          #959#01 = #6#3;  || NIF
          #959#02 = Clave; || Clave
          #959#3  = Factura;       || Importe
          |GRABA 020#959n;
      |SINO;
          #959#3 = #959#3 + Factura;       || Importe
          |GRABA 020#959a;
      |FINSI;
  |FINSI;

  |SI #99#5     ! "S";  |ACABA;  |FINSI;
  |SI SwFichero ! 1;    |ACABA;  |FINSI;
  |SI Clave     ! "B";  |ACABA;  |FINSI;

  #10#0 = #5#0;                    || Empresa
  #10#1 = #0#23;                   || A¤o
  #10#2 = PosConcepto;             || Linea Base
  #10#3 = #3#1;                    || Linea
  |LEE 040#10=;
  |SI FSalida ! 0;  |DDEFECTO #10;  |FINSI;

  #9#0  = #5#0;                   || Empresa
  #9#1  = #10#4;                  || Referencia Interna;
  |LEE 040#9=;
  |SI FSalida ! 0;  |DDEFECTO #9;  |FINSI;

  NLocal     = 0;
  LocalBueno = "";
  |BUCLE eosw0042A;
  NLocal = NLocal + 1;

  |SI LocalBueno = "";
      LocalBueno = NLocal;
      LocalBueno = ("00" + LocalBueno) % -102;
  |FINSI;

  #99#00 = #5#0;                   || Empresa
  #99#01 = #0#23;                  || A¤o
  #99#02 = "Z";                    || Clave
  #99#03 = #6#3;                   || NIF
  #99#04 = LocalBueno;             || Operacion Seguros
  #99#05 = "N";                    || Arrendamientos
  #99#30 = "N";
  #99#31 = "N";
  #99#32 = aOp3;
  |LIBERA #99;
  |LEE 140#99=;
  |SI FSalida ! 0;
      |DDEFECTO #99;
      #99#00 = #5#0;                   || Empresa
      #99#01 = #0#23;                  || A¤o
      #99#02 = "Z";                    || Clave
      #99#03 = #6#3;                   || NIF
      #99#04 = LocalBueno;             || Operacion Seguros
      #99#05 = "N";                    || Arrendamientos
      #99#30 = "N";
      #99#31 = "N";
      #99#32 = aOp3;
      #99#06 = #6#4;                   || Apellidos y Nombre
      #99#07 = #6#5;                   || SG
      #99#08 = #6#6;                   || Calle
      #99#09 = #6#7;                   || Numero
      #99#11 = #6#8;                   || Piso
      #99#12 = #6#9;                   || Puerta
      #99#13 = #6#10;                  || Codigo Postal 1
      #99#14 = #6#11;                  || Codigo Postal 2
      #99#15 = #6#13;                  || Poblacion
      #99#16 = #6#12;                  || Provincia
      #99#18 = #9#5;                   || Referencia Catastral
      #99#19 = Factura;                || Importe

      |SI nTrans = 1;
          #99#21 = Factura;            || Transimiones;
      |FINSI;
      |HAZ ElTrimestre;

      |SI aOp3 = "S";
          #99#33 = (nBaseCaja + nCuotaCaja) ! 2;
      |FINSI;
      |GRABA 140#99n;
  |SINO;
      #99#19 = #99#19 + Factura;       || Importe

      |SI nTrans = 1;
          #99#21 = #99#21 + Factura;            || Transimiones;
      |FINSI;
      |HAZ ElTrimestre;

      |SI aOp3 = "S";
          #99#33 = #99#33 + (nBaseCaja + nCuotaCaja) ! 2;
      |FINSI;
      |GRABA 140#99a;
  |FINSI;
|FPRC;

|PROCESO MControl2;
  |SI PosConcepto = 1;
      Campos1 = 5;            || Codigo Concepto
      Campos2 = 7;            || Base Imponible
      Campos3 = 9;            || Importe    IVA
      Campos4 = 11;           || Importe    Recargo
      nBaseCaja  = nBaseCaja1;
      nCuotaCaja = nCuotaCaja1;
  |FINSI;

  |SI PosConcepto = 2;
      Campos1 = 33;           || Codigo Concepto
      Campos2 = 23;           || Base Imponible
      Campos3 = 27;           || Importe    IVA
      Campos4 = 31;           || Importe    Recargo
      nBaseCaja  = nBaseCaja2;
      nCuotaCaja = nCuotaCaja2;
  |FINSI;

  |SI PosConcepto = 3;
      Campos1 = 34;           || Codigo Concepto
      Campos2 = 24;           || Base Imponible
      Campos3 = 28;           || Importe    IVA
      Campos4 = 32;           || Importe    Recargo
      nBaseCaja  = nBaseCaja3;
      nCuotaCaja = nCuotaCaja3;
  |FINSI;

  |SI PosConcepto = 4;
      Campos1 = 60;           || Codigo Concepto
      Campos2 = 45;           || Base Imponible
      Campos3 = 51;           || Importe    IVA
      Campos4 = 57;           || Importe    Recargo
      nBaseCaja  = nBaseCaja4;
      nCuotaCaja = nCuotaCaja4;
  |FINSI;

  |SI PosConcepto = 5;
      Campos1 = 61;           || Codigo Concepto
      Campos2 = 46;           || Base Imponible
      Campos3 = 52;           || Importe    IVA
      Campos4 = 58;           || Importe    Recargo
      nBaseCaja  = nBaseCaja5;
      nCuotaCaja = nCuotaCaja5;
  |FINSI;

  |SI PosConcepto = 6;
      Campos1 = 62;           || Codigo Concepto
      Campos2 = 47;           || Base Imponible
      Campos3 = 53;           || Importe    IVA
      Campos4 = 59;           || Importe    Recargo
      nBaseCaja  = nBaseCaja6;
      nCuotaCaja = nCuotaCaja6;
  |FINSI;

  |SI SwFichero = 1;
      Factura   = #3Campos2 + #3Campos3 + #3Campos4;
      nBase     = #3Campos2;
      Trimestre = #3#17;

      #7#0 = #3Campos1;
      |LEE 040#7=;
      |SI FSalida ! 0; |ACABA; |FINSI;

      Clave = "B";
      |SI #7#7 = "S"; Clave = "C"; |FINSI;

      |PARA XPara1 = 26; |SI XPara1 [ 35; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                Clave = "E";
                |SAL;
            |FINSI;
      |SIGUE;

      |PARA XPara1 = 106; |SI XPara1 [ 115; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                Clave = "F";
                |SAL;
            |FINSI;
      |SIGUE;

      Seguros       = "N";
      LocalNegocio  = "N";
      |PARA XPara1 = 46; |SI XPara1 [ 55; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                Seguros = "S";
                |SAL;
            |FINSI;
      |SIGUE;

      |PARA XPara1 = 86; |SI XPara1 [ 95; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                LocalNegocio = "S";
                |SAL;
            |FINSI;
      |SIGUE;

      nTrans = 0;
      |SI Clave = "A";  |O Clave = "B";
          |PARA XPara1 = 146; |SI XPara1 [ 149; |HACIENDO XPara1 = XPara1 + 1;
                |SI #7#0 = #11XPara1;
                    nTrans = 1;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;

      aOp1 = "N";
      aOp2 = "N";
      |SI Seguros = "N"; |Y LocalNegocio = "N";
          |SI Clave = "A";
              |PARA XPara1 = 154; |SI XPara1 [ 163; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #7#0 = #11XPara1;
                        aOp1 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
          |FINSI;

          |SI Clave = "A"; |O Clave = "B";
              |PARA XPara1 = 174; |SI XPara1 [ 183; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #7#0 = #11XPara1;
                        aOp2 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
              |SI aOp1 = "S"; aOp2 = "N"; |FINSI;
          |FINSI;
      |FINSI;

      |HAZ GrabaTempo;
  |SINO;
      Factura   = #4Campos2 + #4Campos3 + #4Campos4;
      nBase     = #4Campos2;
      Trimestre = #4#17;

      #7#0 = #4Campos1;
      |LEE 040#7=;
      |SI FSalida ! 0; |ACABA; |FINSI;

      Clave = "A";
      |SI #7#7 = "S"; Clave = "C"; |FINSI;

      |PARA XPara1 = 5; |SI XPara1 [ 14; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                Clave = "D";
                |SAL;
            |FINSI;
      |SIGUE;

      |PARA XPara1 = 126; |SI XPara1 [ 135; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                Clave = "G";
                |SAL;
            |FINSI;
      |SIGUE;

      Seguros       = "N";
      LocalNegocio  = "N";
      |PARA XPara1 = 66; |SI XPara1 [ 75; |HACIENDO XPara1 = XPara1 + 1;
            |SI #7#0 = #11XPara1;
                LocalNegocio = "S";
                |SAL;
            |FINSI;
      |SIGUE;

      nTrans = 0;
      |SI Clave = "A";  |O Clave = "B";
          |PARA XPara1 = 146; |SI XPara1 [ 149; |HACIENDO XPara1 = XPara1 + 1;
                |SI #7#0 = #11XPara1;
                    nTrans = 1;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;

      aOp1 = "N";
      aOp2 = "N";
      |SI Seguros = "N"; |Y LocalNegocio = "N";
          |SI Clave = "A";
              |PARA XPara1 = 154; |SI XPara1 [ 163; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #7#0 = #11XPara1;
                        aOp1 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
          |FINSI;

          |SI Clave = "A"; |O Clave = "B";
              |PARA XPara1 = 174; |SI XPara1 [ 183; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #7#0 = #11XPara1;
                        aOp2 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
              |SI aOp1 = "S"; aOp2 = "N"; |FINSI;
          |FINSI;
      |FINSI;

      |HAZ GrabaTempo;
  |FINSI;
|FPRC;

|PROCESO MControl6;
  |SI PosConcepto = 1;
      Campos1 = 72;           || Codigo Concepto
      Campos2 = 7;            || Base Imponible
      Campos3 = 9;            || Importe    IVA
      Campos4 = 11;           || Importe    Recargo
      nBaseCaja  = nBaseCaja1;
      nCuotaCaja = nCuotaCaja1;
  |FINSI;

  |SI PosConcepto = 2;
      Campos1 = 73;           || Codigo Concepto
      Campos2 = 23;           || Base Imponible
      Campos3 = 27;           || Importe    IVA
      Campos4 = 31;           || Importe    Recargo
      nBaseCaja  = nBaseCaja2;
      nCuotaCaja = nCuotaCaja2;
  |FINSI;

  |SI PosConcepto = 3;
      Campos1 = 74;           || Codigo Concepto
      Campos2 = 24;           || Base Imponible
      Campos3 = 28;           || Importe    IVA
      Campos4 = 32;           || Importe    Recargo
      nBaseCaja  = nBaseCaja3;
      nCuotaCaja = nCuotaCaja3;
  |FINSI;

  |SI PosConcepto = 4;
      Campos1 = 75;           || Codigo Concepto
      Campos2 = 45;           || Base Imponible
      Campos3 = 51;           || Importe    IVA
      Campos4 = 57;           || Importe    Recargo
      nBaseCaja  = nBaseCaja4;
      nCuotaCaja = nCuotaCaja4;
  |FINSI;

  |SI PosConcepto = 5;
      Campos1 = 76;           || Codigo Concepto
      Campos2 = 46;           || Base Imponible
      Campos3 = 52;           || Importe    IVA
      Campos4 = 58;           || Importe    Recargo
      nBaseCaja  = nBaseCaja5;
      nCuotaCaja = nCuotaCaja5;
  |FINSI;

  |SI PosConcepto = 6;
      Campos1 = 77;           || Codigo Concepto
      Campos2 = 47;           || Base Imponible
      Campos3 = 53;           || Importe    IVA
      Campos4 = 59;           || Importe    Recargo
      nBaseCaja  = nBaseCaja6;
      nCuotaCaja = nCuotaCaja6;
  |FINSI;

  |SI SwFichero = 1;
      Factura   = #3Campos2 + #3Campos3 + #3Campos4;
      nBase     = #3Campos2;
      Trimestre = #3#17;

      #17#0 = #3Campos1;
      |LEE 040#17=;
      |SI FSalida ! 0; |ACABA; |FINSI;

      Clave = "B";
      |SI #17#7 = "S"; Clave = "C"; |FINSI;

      |PARA XPara1 = 36; |SI XPara1 [ 45; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                Clave = "E";
                |SAL;
            |FINSI;
      |SIGUE;

      |PARA XPara1 = 116; |SI XPara1 [ 125; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                Clave = "F";
                |SAL;
            |FINSI;
      |SIGUE;

      Seguros       = "N";
      LocalNegocio  = "N";
      |PARA XPara1 = 56; |SI XPara1 [ 65; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                Seguros = "S";
                |SAL;
            |FINSI;
      |SIGUE;

      |PARA XPara1 = 96; |SI XPara1 [ 105; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                LocalNegocio = "S";
                |SAL;
            |FINSI;
      |SIGUE;

      aOp1 = "N";
      aOp2 = "N";
      |SI Seguros = "N"; |Y LocalNegocio = "N";
          |SI Clave = "A";
              |PARA XPara1 = 164; |SI XPara1 [ 173; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #17#0 = #11XPara1;
                        aOp1 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
          |FINSI;

          |SI Clave = "A"; |O Clave = "B";
              |PARA XPara1 = 184; |SI XPara1 [ 193; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #17#0 = #11XPara1;
                        aOp2 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
              |SI aOp1 = "S"; aOp2 = "N"; |FINSI;
          |FINSI;
      |FINSI;

      |HAZ GrabaTempo;
  |SINO;
      Factura   = #4Campos2 + #4Campos3 + #4Campos4;
      nBase     = #4Campos2;
      Trimestre = #4#17;

      #17#0 = #4Campos1;
      |LEE 040#17=;
      |SI FSalida ! 0; |ACABA; |FINSI;

      Clave = "A";
      |SI #17#7 = "S"; Clave = "C"; |FINSI;

      |PARA XPara1 = 15; |SI XPara1 [ 24; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                Clave = "D";
                |SAL;
            |FINSI;
      |SIGUE;

      |PARA XPara1 = 136; |SI XPara1 [ 145; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                Clave = "G";
                |SAL;
            |FINSI;
      |SIGUE;

      Seguros       = "N";
      LocalNegocio  = "N";
      |PARA XPara1 = 76; |SI XPara1 [ 85; |HACIENDO XPara1 = XPara1 + 1;
            |SI #17#0 = #11XPara1;
                LocalNegocio = "S";
                |SAL;
            |FINSI;
      |SIGUE;

      aOp1 = "N";
      aOp2 = "N";
      |SI Seguros = "N"; |Y LocalNegocio = "N";
          |SI Clave = "A";
              |PARA XPara1 = 164; |SI XPara1 [ 173; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #17#0 = #11XPara1;
                        aOp1 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
          |FINSI;

          |SI Clave = "A"; |O Clave = "B";
              |PARA XPara1 = 184; |SI XPara1 [ 193; |HACIENDO XPara1 = XPara1 + 1;
                    |SI #17#0 = #11XPara1;
                        aOp2 = "S";
                        |SAL;
                    |FINSI;
              |SIGUE;
              |SI aOp1 = "S"; aOp2 = "N"; |FINSI;
          |FINSI;
      |FINSI;

      |HAZ GrabaTempo;
  |FINSI;
|FPRC;

|| ..... Proceso de Caja
|PROCESO LeeCab501;
        |ABRE #501;
        |DDEFECTO #501;
        #501#0  = eEmpreCaja;
        #501#1  = enEjerCaja;
        #501#13 = aTipoIVA;
        #501#17 = eDevenCaja;
        #501#2  = eRegisCaja;
        |LEE 040#501=;
        |SI FSalida ! 0;  enSwCaja = 0;  |FINSI;
        |CIERRA #501;
|FPRC;

|PROCESO LosCobros;
    nBaseCaja1  = (nBaseCaja1  + #502#17) ! 2;
    nCuotaCaja1 = (nCuotaCaja1 + #502#18) ! 2;

    nBaseCaja2  = (nBaseCaja2  + #502#20) ! 2;
    nCuotaCaja2 = (nCuotaCaja2 + #502#21) ! 2;

    nBaseCaja3  = (nBaseCaja3  + #502#23) ! 2;
    nCuotaCaja3 = (nCuotaCaja3 + #502#24) ! 2;

    |SI aTipoIVA = "R";
        nBaseCaja4  = (nBaseCaja4  + #502#26) ! 2;
        nCuotaCaja4 = (nCuotaCaja4 + #502#27) ! 2;

        nBaseCaja5  = (nBaseCaja5  + #502#29) ! 2;
        nCuotaCaja5 = (nCuotaCaja5 + #502#30) ! 2;

        nBaseCaja6  = (nBaseCaja6  + #502#32) ! 2;
        nCuotaCaja6 = (nCuotaCaja6 + #502#33) ! 2;

    |FINSI;
    |LIBERA #502;
|FPRC;

|DEFBUCLE LosCobros;
     #502#1;
     ;
     eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 01;
     eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 99;
     be;
     NULL, LosCobros;
|FIN;

|PROCESO ElRECC;
     nBaseCaja   = 0; nCuotaCaja  = 0;

     nBaseCaja1  = 0; nCuotaCaja1 = 0;
     nBaseCaja2  = 0; nCuotaCaja2 = 0;
     nBaseCaja3  = 0; nCuotaCaja3 = 0;
     nBaseCaja4  = 0; nCuotaCaja4 = 0;
     nBaseCaja5  = 0; nCuotaCaja5 = 0;
     nBaseCaja6  = 0; nCuotaCaja6 = 0;

     |SI enSwCaja = 1;
         |BUCLE LosCobros;
     |FINSI;
|FPRC;

|| ...................................................
|PROCESO MiraVenta;
  #8#0 = #3#0;
  #8#1 = #3#19;
  #8#2 = #3#14;
  |LEE 040#8=;
  |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

  #6#0 = #3#0;
  #6#1 = #3#3;
  #6#2 = 1;
  |LEE 040#6=;
  |SI FSalida ! 0;
      |DDEFECTO #6;
  |FINSI;
  #6#3 = #3#12;   ||el NIF de la Linea

  |SI #6#20 = "N"; |ACABA;        |FINSI;

  aOp3 = "N";
|| ... Procesos nuevos RECC ] 2014
     enSwCaja  = 0;
     |SI enEjer ] 2014;
         eEmpreCaja = #3#0;
         eRegisCaja = #3#1;
         enEjerCaja = #3#14;
         aTipoIVA   = "R";
         enDigCaja  = #8#50;
         |HAZ EsCajaIva;

         |SI enSwCaja = 1;  |HAZ LeeCab501;  |FINSI;
     |FINSI;
     |HAZ ElRECC;
|| ..............................................

  |SI #8#50 = 1;
      |SI #3#5  ! 0; PosConcepto = 1; |HAZ MControl2; |FINSI;
      |SI #3#33 ! 0; PosConcepto = 2; |HAZ MControl2; |FINSI;
      |SI #3#34 ! 0; PosConcepto = 3; |HAZ MControl2; |FINSI;
      |SI #3#60 ! 0; PosConcepto = 4; |HAZ MControl2; |FINSI;
      |SI #3#61 ! 0; PosConcepto = 5; |HAZ MControl2; |FINSI;
      |SI #3#62 ! 0; PosConcepto = 6; |HAZ MControl2; |FINSI;
  |SINO;
      |SI #3#72 ! 0; PosConcepto = 1; |HAZ MControl6; |FINSI;
      |SI #3#73 ! 0; PosConcepto = 2; |HAZ MControl6; |FINSI;
      |SI #3#74 ! 0; PosConcepto = 3; |HAZ MControl6; |FINSI;
      |SI #3#75 ! 0; PosConcepto = 4; |HAZ MControl6; |FINSI;
      |SI #3#76 ! 0; PosConcepto = 5; |HAZ MControl6; |FINSI;
      |SI #3#77 ! 0; PosConcepto = 6; |HAZ MControl6; |FINSI;
  |FINSI;
|FPRC;

|PROCESO MiraCompra;
  #8#0 = #4#0;
  #8#1 = #4#19;
  #8#2 = #4#14;
  |LEE 040#8=;
  |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

  #6#0 = #4#0;
  #6#1 = #4#3;
  #6#2 = 2;
  |LEE 040#6=;
  |SI FSalida ! 0; |DDEFECTO #6;  |FINSI;
  |SI #6#20 = "N"; |ACABA;        |FINSI;

  #6#3 = #4#12;   ||el NIF de la Linea
  aOp3 = "N";
|| ... Procesos nuevos RECC ] 2014
     enSwCaja  = 0;
     |SI enEjer ] 2014;
         eDevenCaja = 0;
         eEmpreCaja = #4#0;
         eRegisCaja = #4#1;
         enEjerCaja = #4#14;
         aTipoIVA   = "S";
         enDigCaja  = #8#50;
         |HAZ EsCajaIva;

         |SI enSwCaja = 1;  |HAZ LeeCab501;  |FINSI;
     |FINSI;
     |HAZ ElRECC;
|| ..............................................

  |SI #8#50 = 1;
      |SI #4#5  ! 0; PosConcepto = 1; |HAZ MControl2; |FINSI;
      |SI #4#33 ! 0; PosConcepto = 2; |HAZ MControl2; |FINSI;
      |SI #4#34 ! 0; PosConcepto = 3; |HAZ MControl2; |FINSI;
  |SINO;
      |SI #4#72 ! 0; PosConcepto = 1; |HAZ MControl6; |FINSI;
      |SI #4#73 ! 0; PosConcepto = 2; |HAZ MControl6; |FINSI;
      |SI #4#74 ! 0; PosConcepto = 3; |HAZ MControl6; |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE eoslinve;
  #3#1;
  ;
  #5#0, #0#23, 00001;
  #5#0, #0#23, 32000;
  ;
  NULL, MiraVenta;
|FIN;

|DEFBUCLE eoslinco;
  #4#1;
  ;
  #5#0, #0#23, 00001;
  #5#0, #0#23, 32000;
  ;
  NULL, MiraCompra;
|FIN;

|PROCESO Borra01;
  |BORRA 140#1a;
  |LIBERA #1;
|FPRC;

|DEFBUCLE eosm0009B;
  #1#1;
  ;
  #5#0, #0#23;
  #5#0, #0#23;
  be;
  NULL, Borra01;
|FIN;

|PROCESO Borra02;
  |BORRA 140#2a;
  |LIBERA #2;
|FPRC;

|DEFBUCLE eosm0010B;
  #2#1;
  ;
  #5#0, #0#23, " ", "            ", " ", " ", "  ", " ", " ";
  #5#0, #0#23, "z", "zzzzzzzzzzzz", "z", "z", "zz", "z", "z";
  be;
  NULL, Borra02;
|FIN;

|PROCESO Borra03;
  |BORRA 140#44a;
  |LIBERA #44;
|FPRC;

|DEFBUCLE eosm0016B;
  #44#1;
  ;
  #5#0, #0#23, " ", "            ", " ", " ", "  ", " ", " ", 2999;
  #5#0, #0#23, "z", "zzzzzzzzzzzz", "z", "z", "zz", "z", "z", 1990;
  be;
  NULL, Borra03;
|FIN;

|PROCESO MiraLibros;
  |BUCLE eosm0009B;
  |BUCLE eosm0010B;
  |BUCLE eosm0016B;



|| ... Ventas
  SwFichero = 1;
  Fichero = #5#0;
  Fichero = ("00000" + Fichero) % -105;
  VAnyo   = #0#23;
  VAnyo   = ("00" + VAnyo) % -102;
  eaNCaja = Fichero + VAnyo;
  Fichero = "v" + Fichero + VAnyo;
  |NOME_DAT #3 Fichero;

  aFichero = "f" + eaNCaja; |NOME_DAT #501 aFichero;
  aFichero = "m" + eaNCaja; |NOME_DAT #502 aFichero;

  |BUCLE eoslinve;

  SwFichero = 2;
  Fichero = #5#0;
  Fichero = ("00000" + Fichero) % -105;
  VAnyo   = #0#23;
  VAnyo   = ("00" + VAnyo) % -102;
  Fichero = "c" + Fichero + VAnyo;
  |NOME_DAT #4 Fichero;
  |BUCLE eoslinco;
|FPRC;

|DEFBUCLE eosclien;
  #5#1;
  ;
  #0#1;
  #0#2;
  ;
  NULL, MiraLibros;
|FIN;

|PROCESO Graba347;

  nNegativo = #99#19;

  |SI #99#2 = "A"; |O #99#2 = "B";
      #959#0  = #99#0;
      #959#01 = #99#3;  || NIF
      #959#02 = #99#2; || Clave
      |LEE 041#959=;
      |SI FSalida = 0;
          nNegativo = #959#3;
      |FINSI;
  |FINSI;

  |SI nNegativo < 0;
      |SI #0#23 > 10; |Y #0#23 < 80;
          nNegativo = - nNegativo;
      |FINSI;
  |FINSI;

  |SI #99#2 = "A"; |Y nNegativo [ #11#1;  |ACABA; |FINSI;
  |SI #99#2 = "B"; |Y #99#5 = "N";  |Y nNegativo [ #11#2;  |ACABA; |FINSI;
  |SI #99#2 = "C"; |Y nNegativo [ #11#3;  |ACABA; |FINSI;
  |SI #99#2 = "D"; |Y nNegativo [ #11#4;  |ACABA; |FINSI;
  |SI #99#2 = "E"; |Y nNegativo [ #11#25; |ACABA; |FINSI;
  |SI #99#2 = "Z";
      #2#0  = #99#0;
      #2#1  = #99#1;
      #2#2  = "B";
      #2#3  = #99#3;
      #2#4  = "N";
      #2#5  = "S";
      #2#35 = "N";
      #2#36 = "N";
      #2#37 = #99#32;
      |LEE 040#2];
      |SI FSalida ! 0; |O #2#0 ! #99#0; |ACABA; |FINSI;
      |DDEFECTO #2;
  |FINSI;

  |PARA XPara1 = 0; |SI XPara1 [ 19; |HACIENDO XPara1 = XPara1 + 1;
        #2XPara1 = #99XPara1;
  |SIGUE;
  #2#22 = #99#20;
  #2#23 = #99#21;
  #2#26 = 0;
  |PARA XPara1 = 27; |SI XPara1 [ 34; |HACIENDO XPara1 = XPara1 + 1;
        XPara2 = XPara1 - 5;
        #2XPara1 = #99XPara2;
  |SIGUE;
  #2#35 = #99#30;
  #2#36 = #99#31;
  #2#37 = #99#32;
  #2#38 = #99#33;
  |SI #2#37 = "S";
      #2#27 = 0; #2#28 = 0;
      #2#29 = 0; #2#30 = 0;
  |FINSI;

  |GRABA 040#2n;

  #1#0 = #2#0;
  #1#1 = #2#1;
  |LIBERA #1;
  |LEE 140#1=;
  |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #2#0;
      #1#1 = #2#1;
      |GRABA 040#1b;
  |FINSI;

  |SI #99#2 = "A"; #1#6  = #1#6  + #2#19; #1#12 = #1#12 + 1;  |FINSI;
  |SI #99#2 = "B"; #1#7  = #1#7  + #2#19; #1#13 = #1#13 + 1;  |FINSI;
  |SI #99#2 = "C"; #1#8  = #1#8  + #2#19; #1#14 = #1#14 + 1;  |FINSI;
  |SI #99#2 = "D"; #1#9  = #1#9  + #2#19; #1#15 = #1#15 + 1;  |FINSI;
  |SI #99#2 = "E"; #1#10 = #1#10 + #2#19; #1#16 = #1#16 + 1;  |FINSI;
  |SI #99#2 = "F"; #1#21 = #1#21 + #2#19; #1#23 = #1#23 + 1;  |FINSI;
  |SI #99#2 = "G"; #1#22 = #1#22 + #2#19; #1#24 = #1#24 + 1;  |FINSI;
  |SI #99#2 = "Z"; #1#11 = #1#11 + #2#19; #1#17 = #1#17 + 1;  |FINSI;

  |ABRE #5;
  #5#0 = #1#0;
  |LEE 040#5=;
  |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
  |CIERRA #5;

  #1#18 = #5#2;
  #1#19 = #5#14;
  #1#5  = "";

  |GRABA 140#1a;
|FPRC;

|DEFBUCLE eosw0042;
  #99#1;
  ;
  00000, 00, " ", "            ", " ", " ", "  ", " ", " ";
  99999, 99, "z", "zzzzzzzzzzzz", "z", "z", "zz", "z", "z";
  ;
  NULL, Graba347;
|FIN;

|PROCESO Tipo3; |TIPO 3;
  |ABRE #11;
  |LEE 040#11p;
  |SI FSalida ! 0;
      |MENAV "      No existe Control 347";
      |PTEC 807;
      |ACABA;
  |FINSI;
  |CIERRA #11;

  enEjer = 2000 + #0#23;

  |SI #0#23 = "10";
      |HAZ MiroEosm0016;
  |FINSI;

  comienza = "42";  |HAZ fichero;
  |NOME_DAT #99 fichero;
  |ABRE #99; |CIERRA #99; |DELINDEX #99;
  comienza = "yy";  |HAZ fichero;
  |NOME_DAT #959 fichero;
  |DELINDEX #959;

  |ABRE #6;
  |ABRE #7;
  |ABRE #8;
  |ABRE #10;
  |ABRE #9;
  |ABRE #17;
  |ABRET #99;
  |ABRE #959;
  |SI #0#0 = "N";
      |BUCLE eosclien;
  |SINO;
      |PARA XPara = 3; |SI XPara [ 22; |HACIENDO XPara = XPara + 1;
            |SI #0XPara ! 0;
                #0#1 = #0XPara;
                #0#2 = #0XPara;
                |BUCLE eosclien;
            |FINSI;
      |SIGUE;
  |FINSI;
  |CIERRA #959;
  |CIERRA #6;
  |CIERRA #7;
  |CIERRA #8;
  |CIERRA #10;
  |CIERRA #9;
  |CIERRA #17;
  |CIERRAT #99;

  |ABRE #2;
  |ABRE #1;
  |ABRE #959;
  |BUCLE eosw0042;
  |CIERRA #959;
  |CIERRA #1;
  |CIERRA #2;

  |DELINDEX #959;
  |DELINDEX #99;
|FPRC;
