|FICHEROS;
   eospa303 #0;
   eosclien #1;
   eosactiv #4;
   eoslinco #5;
   eoslinve #7;
   eosconce #8;
   eosaplic #9;
   eosopes2 #10;
   eoscabco #11;
   eoscabve #12;
   eoscapro #17;
   eosaggan #18;
   eosagga1 #19;
   eosm1303 #25;
   eosconc6 #28;
   eosma100 #100;
   eosmcc01 #501;
   eosmcc02 #502;

   eosm0008;
   dsmow204;

   dsmociva;
|FIN;

|VARIABLES;
   d_empre  = 0;
   d_activ  = 0;
   FEstado  = 0;
   fichero  = "";
   anyocab  = "";

   Concep2  = 0;
   Concep6  = "";
   iva      = 0;
   tiva     = 0;
   rec      = 0;
   trec     = 0;
   base     = 0;
   FEact    = 0;
   rendi1   = 0;
   rendi2   = 0;
   penult   = 0;
   estado   = 0;
   ventas   = 0;
   x        = 0;
   camp     = 0;
   total    = 0;
   activida = 0;
   varalf   = "";

   fec0     = @;
   fec1     = @;
   fec2     = @;
   tri0     = 0;
   tri1     = 0;
   tri2     = 0;
   tri11    = 0;
   tri12    = 0;
   nDAct    = 0;
   nHAct    = 0;
   anio     = "";
   perante  = 0;
   anoante  = 0;
   empresa  = 0;
   anyo     = 0;
   periodo  = 0;
   n        = "N";
   b_anter  = 0;
   p_anter  = 0;
   r_anter  = 0;
   ventas_con = 0;
   ventas_sin = 0;
   t_compra1  = 0;
   t_compra2  = 0;
   t_compra3  = 0;
   t_compra8  = 0;
   t_compra4  = 0;
   t_compra5  = 0;
   t_compra6  = 0;
   t_compra7  = 0;
   p_compra1  = 0;
   p_compra2  = 0;
   p_compra3  = 0;
   p_compra4  = 0;
   p_compra5  = 0;
   p_compra6  = 0;
   p_compra7  = 0;
   p_compra8  = 0;
   prorrata   = 0;

   epig1_1    = "";
   epig2_1    = "";
   epig3_1    = 0;
   epig1_2    = "";
   epig2_2    = "";
   epig3_2    = 0;
   epig1_3    = "";
   epig2_3    = "";
   epig3_3    = 0;
   epig1_4    = "";
   epig2_4    = "";
   epig3_4    = 0;
   epig1_5    = "";
   epig2_5    = "";
   epig3_5    = 0;
   rdtos_1    = 0;
   rdtos_2    = 0;
   rdtos_3    = 0;
   rdtos_4    = 0;
   rdtos_5    = 0;
   sw_330     = 0;
   xxx        = 0;
   yyy        = 0;
   zzz        = 0;
   epig1      = "";
   epig2      = "";
   compensar  = 0;
   FEstado_Op = 0;

   Campo1     = 0;
   Campo2     = 0;
   Campo3     = 0;
   Campo4     = 0;
   Campo5     = 0;
   Campo6     = 0;
   Campo7     = 0;
   Campo8     = 0;
   VCampo1    = 0;
   VCampo2    = "";
   VCampo3    = "";
   VCampo5    = 0;
   VCampo6    = 0;
   VCampo7    = 0;
   VCampo8    = 0;
   SwEstar    = 0;
   Total      = 0;
   LaEmpresa  = 0;
   ElPeriodo  = 0;
   ElAnyo     = 0;
   Compensar  = 0;
   nSuma      = 0;
   nPeriodo   = 0;
   nIVA       = 0;

   aFichero   = "";
   aTipo      = "";
   nPer       = 0;
   nEjer      = 0;
   aAlfa      = "";
   nCampoDes  = 0;
   nSwAcum    = 0;
   nPara1     = 0;
   nPara2     = 0;
   nPara3     = 0;
   nPorce1    = 0;
   nPorce2    = 0;
   aEl2       = "";
   aEl6       = "";
   nEl8       = 0;

   nPerTope   = 0;
   nSubeIVA   = 0;
   nREC       = 0;
   nIVA5      = 0;
   nIVA8      = 0;
   nIVA11     = 0;
   nIVA14     = 0;
   nIVA17     = 0;
   nIVA46     = 0;
   nMasBase   = 0;
   nNume1     = 0;
   nNume2     = 0;
   nImpre     = 0;

     &enEmpresa      = 0;
     &enEjer         = 0;
     &enPeriodo      = 0;
     &enActividad    = 0;
     &enTipoEntrada  = 0;
     &enModelo       = 0;
     &enComplem      = 0;

   nOpera      = 0;
   nOpCaja     = 0;
   nHayCaja    = 0;
   nBaseCaja   = 0;
   nBaseCaja1  = 0;
   nBaseCaja2  = 0;
   nBaseCaja3  = 0;
   nBaseCaja4  = 0;
   nBaseCaja5  = 0;
   nBaseCaja6  = 0;
   nCuotaCaja  = 0;
   nCuotaCaja1 = 0;
   nCuotaCaja2 = 0;
   nCuotaCaja3 = 0;
   nCuotaCaja4 = 0;
   nCuotaCaja5 = 0;
   nCuotaCaja6 = 0;
   a340        = "";
   &nPie       = 0;
   aCampo51    = "";

   &enNCobro   = 0;
   &ef502c1    = @;
   &ea502c2    = "";
   &ea502c3    = "";
   &enCobrado1 = 0;
   &enCobrado2 = 0;
   &enCobrado3 = 0;
   &enCobrado4 = 0;
   &enCobrado5 = 0;
   &enCobrado6 = 0;

   nEjerCobro  = 0;
   aNomOrigen  = "";
   aTipo501    = "";
   nHagoSub    = 0;
   &enPerLiq   = 0;
   aCampo28    = "";
   nTotalCaja  = 0;
   &eaNombreEmp = "";
|FIN;

|INCLUYE i_seguim;
|INCLUYE i_anyode;
|INCLUYE i_devolv;
|INCLUYE i_consul;
|INCLUYE i_varcaj;

|PROCESO pinta_anyo; |TIPO 7;
     |HAZ i_anyodef;
     #0#2 = i_anyodef;
     |PINTA #0#2;
|FPRC;

|PROCESO Tipo0C7;
     |C_M #0#4, 1, "S";
     |SI #0#7 = "M";
         |C_M #0#4, 1, "N";  #0#4 = "F";  |PINTA #0#4;
     |FINSI;
|FPRC;

|| **************************************************************************
||                         Borramos el 303 Seleccionado
|| **************************************************************************

|PROCESO eosma100;
     |BORRA 020#100a;
     |LIBERA #100;
|FPRC;

|DEFBUCLE eosma100;
     #100#1;
     ;
     "303", #25#0, #25#45, #25#1, #25#2, 000;
     "303", #25#0, #25#45, #25#1, #25#2, 999;
     be;
     NULL, eosma100;
|FIN;

|PROCESO borrar;
     #4#0 = #25#0;
     #4#1 = #25#45;
     #4#2 = #25#2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     |SI #4#26 = "M";  |O #4#26 = "D";
         |SI #0#7 ! "M";  |ACABA;  |FINSI;
     |SINO;
         |SI #0#7 ! "T";  |ACABA;  |FINSI;
     |FINSI;

     |SI #4#51 = "S";
        nPer  = enPeriodo;
        nEjer = 2000 + #25#2;
        aAlfa = ":agieos/dsmo3401;";
        aAlfa = aAlfa + (("00000" + #25#0) % -105);   || Empresa
        aAlfa = aAlfa + enEjer;                       || Ejercicio
        aAlfa = aAlfa + (("00" + enPeriodo) % -102);  || Periodo
        aAlfa = aAlfa + "340";                        || Modelo
        aAlfa = aAlfa + "00";                         || Complemento
        aAlfa = aAlfa + ("00" + enActividad) % -102;  || Actividad
        aAlfa = aAlfa + "03";                         || Tipo de entrada
        aAlfa = aAlfa + "0";                          || Mensaje

        |SUB_EJECUTA_NP aAlfa;

        enPeriodo = nPer;
     |FINSI;

     |BORRA 020#25c;
     |LIBERA #25;

     |BUCLE eosma100;

     #10#0 = #25#0;
     #10#1 = #25#45;
     #10#2 = #25#1;
     #10#3 = #25#2;
     |BORRA 140#10c;
     |LIBERA #10;
|FPRC;

|DEFBUCLE baja303;
     #25#1;
     ;
     #0#0, nDAct, #0#3, #0#2;
     #0#1, nHAct, #0#3, #0#2;
     be;
     NULL,borrar;
|FIN;

|PROCESO BorraVariables;
     ventas_con = 0;
     ventas_sin = 0;
     epig1_1    = "";
     epig2_1    = "";
     epig1_2    = "";
     epig2_2    = "";
     epig1_3    = "";
     epig2_3    = "";
     epig1_4    = "";
     epig2_4    = "";
     epig1_5    = "";
     epig2_5    = "";
     rdtos_1    = 0;
     rdtos_2    = 0;
     rdtos_3    = 0;
     rdtos_4    = 0;
     rdtos_5    = 0;

     nIVA5     = 0;
     nIVA8     = 0;
     nIVA11    = 0;
     nIVA14    = 0;
     nIVA17    = 0;
     nIVA46    = 0;
     enSwCaja  = 0;
     nHayCaja  = 0;
     enNCobro  = 0;
|FPRC;

|PROCESO Graba340_Caja;
     enNCobro   = #502#4;
     ef502c1    = #502#5;
     ea502c2    = #502#14;
     ea502c3    = #502#15;
     enCobrado1 = 0;
     enCobrado2 = 0;
     enCobrado3 = 0;
     enCobrado4 = 0;
     enCobrado5 = 0;
     enCobrado6 = 0;

     |SI aTipoIVA = "S";
         enCobrado1 = #502#16;
         #5#7  = #502#17;
         #5#9  = #502#18;

         enCobrado2 = #502#19;
         #5#23 = #502#20;
         #5#27 = #502#21;

         enCobrado3 = #502#22;
         #5#24 = #502#23;
         #5#28 = #502#24;
         a340 = "S"; |HAZ Recibidas340;
     |SINO;
         enCobrado1 = #502#16;
         #7#7  = #502#17;
         #7#9  = #502#18;

         enCobrado2 = #502#19;
         #7#23 = #502#20;
         #7#27 = #502#21;

         enCobrado3 = #502#22;
         #7#24 = #502#23;
         #7#28 = #502#24;

         enCobrado4 = #502#25;
         #7#45 = #502#26;
         #7#51 = #502#27;

         enCobrado5 = #502#28;
         #7#46 = #502#29;
         #7#52 = #502#30;

         enCobrado6 = #502#31;
         #7#47 = #502#32;
         #7#53 = #502#33;

         a340 = "S"; |HAZ Expedidas340;
    |FINSI;
    enNCobro = 0;
    enCobrado1 = 0;
    enCobrado2 = 0;
    enCobrado3 = 0;
    enCobrado4 = 0;
    enCobrado5 = 0;
    enCobrado6 = 0;
|FPRC;

|PROCESO LeeCab501;
        |ABRE #501;
        |DDEFECTO #501;
        #501#0  = eEmpreCaja;
        #501#1  = enEjerCaja;
        #501#13 = aTipoIVA;
        #501#17 = eDevenCaja;
        #501#2  = eRegisCaja;
        |LEE 040#501=;
        |SI FSalida ! 0;  enSwCaja = 0;  |FINSI;
        |CIERRA #501;
|FPRC;

|PROCESO LosCobros;

     |SI nEjerCobro ! 0;
         |SI #502#9 ! 0; |Y #502#9 ! enEjer;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #502#8 < #0#3; |Y #502#8 ! 0; |ACABA; |FINSI;

     |SI nOpCaja = 0;
         nHayCaja = 1;
         nBaseCaja1  = (nBaseCaja1  + #502#17) ! 2;
         nCuotaCaja1 = (nCuotaCaja1 + #502#18) ! 2;

         nBaseCaja2  = (nBaseCaja2  + #502#20) ! 2;
         nCuotaCaja2 = (nCuotaCaja2 + #502#21) ! 2;

         nBaseCaja3  = (nBaseCaja3  + #502#23) ! 2;
         nCuotaCaja3 = (nCuotaCaja3 + #502#24) ! 2;

         |SI aTipoIVA = "R";
             nBaseCaja4  = (nBaseCaja4  + #502#26) ! 2;
             nCuotaCaja4 = (nCuotaCaja4 + #502#27) ! 2;

             nBaseCaja5  = (nBaseCaja5  + #502#29) ! 2;
             nCuotaCaja5 = (nCuotaCaja5 + #502#30) ! 2;

             nBaseCaja6  = (nBaseCaja6  + #502#32) ! 2;
             nCuotaCaja6 = (nCuotaCaja6 + #502#33) ! 2;

         |FINSI;
     |FINSI;

     |SI nOpCaja = 1;
         |SI #502#17 ! 0; |O #502#18 ! 0;
             |O #502#20 ! 0; |O #502#21 ! 0;
                |O #502#23 ! 0; |O #502#24 ! 0;
                   |O #502#26 ! 0; |O #502#27 ! 0;
                      |O #502#29 ! 0; |O #502#30 ! 0;
                         |O #502#32 ! 0; |O #502#33 ! 0;

          |SI nEjerCobro = 0; |HAZ Graba340_Caja; |FINSI;
          nHayCaja = 1;
          #502#8 = #0#3;
          #502#9 = enEjer;
          |GRABA 020#502a;
        |FINSI;
    |FINSI;
    |LIBERA #502;
|FPRC;

|DEFBUCLE LosCobros;
     #502#1;
     5,7;
     eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 01, fec1, tri11;
     eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 99, fec2, tri12;
     be;
     NULL, LosCobros;
|FIN;

|PROCESO ElRECC;
     nBaseCaja   = 0; nCuotaCaja  = 0;

     nBaseCaja1  = 0; nCuotaCaja1 = 0;
     nBaseCaja2  = 0; nCuotaCaja2 = 0;
     nBaseCaja3  = 0; nCuotaCaja3 = 0;
     nBaseCaja4  = 0; nCuotaCaja4 = 0;
     nBaseCaja5  = 0; nCuotaCaja5 = 0;
     nBaseCaja6  = 0; nCuotaCaja6 = 0;

     aCampo28 = "S";
     |SI enSwCaja = 1;
         |BUCLE LosCobros;
         |SI nOpCaja = 1;
            |ABRE #501;
            |DDEFECTO #501;
            #501#0  = eEmpreCaja;
            #501#1  = enEjerCaja;
            #501#13 = aTipoIVA;
            #501#17 = eDevenCaja;
            #501#2  = eRegisCaja;
            |LEE 040#501=;
            |SI FSalida = 0;
                |SI nOpera = 0; |Y a340 = "S";
                    #501#8 = #0#3;
                    #501#9 = enEjerCaja;
                |FINSI;
                |SI nHayCaja = 1;
                    |SI #501#11 < enEjerCaja;
                        #501#10 = #0#3;
                        #501#11 = enEjerCaja;
                    |SINO;
                        |SI #501#11 = enEjerCaja; |Y #501#10 < #0#3;
                            #501#10 = #0#3;
                            #501#11 = enEjerCaja;
                        |FINSI;
                    |FINSI;
                |FINSI;
                aCampo28 = "N";
                |SI #501#12 = nTotalCaja; aCampo28 = "S"; |FINSI;
                |GRABA 020#501a;
            |FINSI;
            |CIERRA #501;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO compensar;|TIPO 0;
     perante = 0;
     |SI #25#1 = 1;
         |ABRE #4;
         #4#0 = d_empre;
         #4#1 = d_activ;
         #4#2 = #0#2 - 1;
         |SI #4#2 < 0;  #4#2 = 99;  |FINSI;
         |LEE 040#4=;
         |SI FSalida = 0; perante = #4#34; |FINSI;
         |DDEFECTO #4;

         #4#0 = d_empre;
         #4#1 = d_activ;
         #4#2 = #0#2;
         |LEE 040#4=;
         |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
         |CIERRA #4;
     |SINO;
         empresa = #25#0;
         periodo = #25#1;
         anyo = #25#2;
         activida = #25#45;
         #25#1 = #25#1 - 1;
         |LEE 040#25=;
         |SI FSalida = 0;
             |SI #25#32 ! 0;
                 |SI #25#55 < 0;
                     perante = -#25#55;
                 |FINSI;
             |FINSI;
         |FINSI;
         |DDEFECTO #25;
         #25#0 = empresa;
         #25#1 = periodo;
         #25#2 = anyo;
         #25#45 = activida;
         |LEE 040#25=;
     |FINSI;
|FPRC;

|PROCESO acumula;
     |ABRE #4;
     #4#0 = #25#0;
     #4#1 = #25#45;
     #4#2 = #25#2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     prorrata = #4#28;
     |SI prorrata = 0; prorrata = 100; |FINSI;

     t_compra1 = t_compra1 + ((#25#21 / prorrata) * 100);
     t_compra2 = t_compra2 + ((#25#22 / prorrata) * 100);
     t_compra3 = t_compra3 + ((#25#51 / prorrata) * 100);
     t_compra4 = t_compra4 + ((#25#23 / prorrata) * 100);
     t_compra5 = t_compra5 + ((#25#24 / prorrata) * 100);
     t_compra6 = t_compra6 + ((#25#43 / prorrata) * 100);
     t_compra7 = t_compra7 + ((#25#44 / prorrata) * 100);
     t_compra8 = t_compra8 + ((#25#78 / prorrata) * 100);

     p_compra1 = p_compra1 + #25#21;
     p_compra2 = p_compra2 + #25#22;
     p_compra3 = p_compra3 + #25#51;
     p_compra4 = p_compra4 + #25#23;
     p_compra5 = p_compra5 + #25#24;
     p_compra6 = p_compra6 + #25#43;
     p_compra7 = p_compra7 + #25#44;
     p_compra8 = p_compra8 + #25#78;
|FPRC;

|DEFBUCLE eosm1303_1;
     #25#1;
     ;
     #0#0, 1, 1, #0#2;
     #0#1, 6, 3, #0#2;
     e;
     NULL, acumula;
|FIN;

|PROCESO RecCompra;
     #100#0 = "303";
     #100#1 = #25#0;
     #100#2 = #25#45;
     #100#3 = #25#1;
     #100#4 = #25#2;
     #100#5 = nCampoDes;
     |LEE 101#100=;
     |SI FSalida = 0;
         #100#6  = #100#6  % nPorce1;
         #100#8  = #100#8  % nPorce2;
         #100#9  = #100#9  % nPorce1;
         #100#11 = #100#11 % nPorce2;
         #100#12 = #100#12 % nPorce1;
         #100#14 = #100#14 % nPorce2;
         #100#15 = #100#15 % nPorce1;
         #100#17 = #100#17 % nPorce2;
         #100#18 = #100#18 % nPorce1;
         #100#20 = #100#20 % nPorce2;
         #100#21 = #100#21 % nPorce1;
         #100#23 = #100#23 % nPorce2;
         #100#24 = #100#24 % nPorce1;
         #100#26 = #100#26 % nPorce2;

         |GRABA 020#100a;
         |LIBERA #100;
     |FINSI;
|FPRC;

|PROCESO graba_pro;
     #1#0 = #25#0;
     |LEE 040#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;

     |ABRE #17;
     #17#0 = #25#0;
     #17#1 = #25#2;
     #17#2 = #25#45;
     |BORRA 140#17c;
     |LIBERA #17;

     |DDEFECTO #17;
     #17#0  = #25#0;
     #17#1  = #25#2;
     #17#2  = #25#45;
     #17#3  = #1#3;
     #17#4  = "L";
     #17#5  = ventas_con;
     #17#6  = ventas_sin;
     #17#7  = ventas_con + ventas_sin;
     #17#8  = (((#17#5 / #17#7) * 100) + 0.49) ! 0;

     |ABRE #4;
     #4#0 = #25#0;
     #4#1 = #25#45;
     #4#2 = #25#2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     prorrata = #4#28;
     |SI prorrata = 0; prorrata = 100; |FINSI;

     #17#9  = t_compra1 + ((#25#21 / prorrata) * 100);
     #17#10 = t_compra2 + ((#25#22 / prorrata) * 100);
     #17#11 = t_compra3 + ((#25#51 / prorrata) * 100);
     #17#12 = t_compra4 + ((#25#23 / prorrata) * 100);
     #17#13 = t_compra5 + ((#25#24 / prorrata) * 100);
     #17#14 = t_compra6 + ((#25#43 / prorrata) * 100);
     #17#15 = t_compra7 + ((#25#44 / prorrata) * 100);
     #17#41 = t_compra8 + ((#25#78 / prorrata) * 100);

     #17#16 = #17#09 % #17#8;
     #17#17 = #17#10 % #17#8;
     #17#18 = #17#11 % #17#8;
     #17#19 = #17#12 % #17#8;
     #17#20 = #17#13 % #17#8;
     #17#21 = #17#14 % #17#8;
     #17#22 = #17#15 % #17#8;
     #17#42 = #17#41 % #17#8;

     #17#23 = p_compra1;
     #17#24 = p_compra2;
     #17#25 = p_compra3;
     #17#26 = p_compra4;
     #17#27 = p_compra5;
     #17#28 = p_compra6;
     #17#29 = p_compra7;
     #17#43 = p_compra8;

     #17#30 = #17#16 - #17#23;
     #17#31 = #17#17 - #17#24;
     #17#32 = #17#18 - #17#25;
     #17#33 = #17#19 - #17#26;
     #17#34 = #17#20 - #17#27;
     #17#35 = #17#21 - #17#28;
     #17#36 = #17#22 - #17#29;
     #17#44 = #17#42 - #17#43;

     #17#37 = #17#09 + #17#10 + #17#11 + #17#12 + #17#13 + #17#14 + #17#15 + #17#41;
     #17#38 = #17#16 + #17#17 + #17#18 + #17#19 + #17#20 + #17#21 + #17#22 + #17#42;
     #17#39 = #17#23 + #17#24 + #17#25 + #17#26 + #17#27 + #17#28 + #17#29 + #17#43;
     #17#40 = #17#30 + #17#31 + #17#32 + #17#33 + #17#34 + #17#35 + #17#36 + #17#44;
     |GRABA 040#17n;
     |CIERRA #17;

     |ABRE #100;
     nPorce1   = 100;

     nCampoDes = 70;  nPorce2 = (#17#30 * 100) / #25#21;  |HAZ RecCompra;
     nCampoDes = 75;  nPorce2 = (#17#35 * 100) / #25#43;  |HAZ RecCompra;
     nCampoDes = 71;  nPorce2 = (#17#31 * 100) / #25#22;  |HAZ RecCompra;
     nCampoDes = 76;  nPorce2 = (#17#36 * 100) / #25#44;  |HAZ RecCompra;
     nCampoDes = 72;  nPorce2 = (#17#32 * 100) / #25#51;  |HAZ RecCompra;
     nCampoDes = 77;  nPorce2 = (#17#44 * 100) / #25#78;  |HAZ RecCompra;
     |CIERRA #100;

     #25#21 = #17#30;
     #25#43 = #17#35;
     #25#22 = #17#31;
     #25#44 = #17#36;
     #25#51 = #17#32;
     #25#78 = #17#44;
     #25#23 = #17#33;
     #25#24 = #17#34;

     |ABRE #4;
     #4#0 = #25#0;
     #4#1 = #25#45;
     #4#2 = #25#2;
     |LIBERA #4;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     #25#20 = #25#7 + #25#10 + #25#13 + #25#16 + #25#19 + #25#48 + #25#50;
     #25#25 = #25#21 + #25#22 + #25#23 + #25#43 + #25#44 + #25#51 + #25#78 + #25#80;
     #25#26 = #25#20 - #25#25;
     #25#27 = 100;
     #25#28 = #25#26 % #25#27;
     total  = #25#28 - #25#29;
     |SI total = 0; #25#33 = 0; #25#32 = 0; #25#31 = 0; |FINSI;

     |SI total > 0; #25#33 = total; #25#32 = 0; #25#31 = 0; |FINSI;

     |SI total < 0;|Y #0#3 ! 4;
         #25#32 = -total;
         #25#31 = 0;
         #25#33 = 0;
     |FINSI;

     |SI total < 0; |Y #0#3 = 4;
         empresa_d = #25#0;
         activid_d = #25#45;
         anyo_d    = #25#2;
         |HAZ Preg_Devol;

         |SI #4#27 = "D";
             #25#31 = -total;
             #25#32 = 0;
             #25#33 = 0;
         |SINO;
             #25#32 = -total;
             #25#31 = 0;
             #25#33 = 0;
         |FINSI;
     |FINSI;
     |GRABA 140#25a;
     |LIBERA #25;

     |ABRE #4;
     #4#0 = #25#0;
     #4#1 = #25#45;
     #4#2 = #25#2 + 1;
     |LIBERA #4;
     |LEE 140#4=;
     |SI FSalida = 0;
         #4#28 = #17#8;
         |GRABA 140#4a;
     |SINO;
         #4#0 = #25#0;
         #4#1 = #25#45;
         #4#2 = #25#2;
         |LIBERA #4;
         |LEE 140#4=;
         |SI FSalida = 0;
            #4#2 = #25#2 + 1;
            #4#28 = #17#8;
            |GRABA 140#4n;
         |FINSI;
     |FINSI;
     |CIERRA #4;
|FPRC;

|DEFBUCLE eosm1303_2;
     #25#1;
     ;
     #12#0, 1, 4, #12#4;
     #12#0, 6, 4, #12#4;
     be;
     NULL, graba_pro;
|FIN;

|PROCESO prorrata;
     t_compra1 = 0;
     t_compra2 = 0;
     t_compra3 = 0;
     t_compra4 = 0;
     t_compra5 = 0;
     t_compra6 = 0;
     t_compra7 = 0;
     t_compra8 = 0;

     p_compra1 = 0;
     p_compra2 = 0;
     p_compra3 = 0;
     p_compra4 = 0;
     p_compra5 = 0;
     p_compra6 = 0;
     p_compra7 = 0;
     p_compra8 = 0;
     |CIERRAT #25;  |BUCLE eosm1303_1;  |ABRET #25;
     |CIERRAT #25;  |BUCLE eosm1303_2;  |ABRET #25;
|FPRC;

|| **************************************************************************
||                              Pasamos las Compras
|| **************************************************************************

|| *********************************************************************
|PROCESO Lee501_2014;

   eDevenCaja  = #501#17;
   ePerioCaja  = #501#18;
   eRegisCaja  = #501#2;
   |HAZ ePathCaja;

   aTipoIVA   = #501#13;
   nHayCaja   = 1;
   enSwCaja   = 1;

   |SI aTipoIVA = "S";
       aFichero = "c" + ePathCaja;
       |CIERRA #5;  |NOME_DAT #5  aFichero;

       |ABRE #5;
       #5#0  = #501#0;
       #5#14 = eClvDeCaja;
       #5#1  = #501#2;
       |LEE 041#5=;
       |SI FSalida = 0;
           |HAZ Compras;
      |FINSI;
      |CIERRA #5;
   |FINSI;

   |SI aTipoIVA = "R";
       aFichero = "v" + ePathCaja;
       |CIERRA #7; |NOME_DAT #7 aFichero;

       |ABRE #7;
       #7#0  = #501#0;
       #7#14 = eClvDeCaja;
       #7#1  = #501#2;
       |LEE 041#7=;
       |SI FSalida = 0;
           |HAZ Ventas;
      |FINSI;
      |CIERRA #7;
   |FINSI;
|FPRC;

|DEFBUCLE Lee501_2014;
   #501#1;
   ;
   eEmpreCaja, enEjerCaja, aTipo501, nEjerCobro, 00001;
   eEmpreCaja, enEjerCaja, aTipo501, nEjerCobro, 32000;
   e;
   NULL, Lee501_2014;
|FIN;

|PROCESO PonPorceCompra;
     #100#0 = "303";
     #100#1 = #25#0;
     #100#2 = #25#45;
     #100#3 = #25#1;
     #100#4 = #25#2;
     #100#5 = nCampoDes;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #25#0;
         #100#2 = #25#45;
         #100#3 = #25#1;
         #100#4 = #25#2;
         #100#5 = nCampoDes;
         |GRABA 020#100b;
     |FINSI;

     nSwAcum = 0;

     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #100nPara2  = tiva;
               #100nPara1  = #100nPara1 + (base % nPorce1);
               #100nPara2  = tiva;
               #100nPara3  = #100nPara3 + ((iva + rec) % nPorce2);
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #100nPara2 = 0;
                   #100nPara1  = base % nPorce1;
                   #100nPara2 = tiva;
                   #100nPara3  = (iva + rec) % nPorce2;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

|PROCESO PonPorceVenta;
     nNume1 = nIVA;
     nNume2 = iva;
     |SI nCampoDes > 13; |Y nCampoDes < 84; nIVA = nREC; iva = rec; |FINSI;

     #100#0 = "303";
     #100#1 = #25#0;
     #100#2 = #25#45;
     #100#3 = #25#1;
     #100#4 = #25#2;
     #100#5 = nCampoDes;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "303";
         #100#1 = #25#0;
         #100#2 = #25#45;
         #100#3 = #25#1;
         #100#4 = #25#2;
         #100#5 = nCampoDes;
         |GRABA 020#100b;
     |FINSI;

     nSwAcum = 0;

     |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #100nPara2  = nIVA;
               #100nPara1  = #100nPara1 + base;
               #100nPara2  = nIVA;
               #100nPara3  = #100nPara3 + iva;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
               nPara2 = nPara1 + 1;
               nPara3 = nPara1 + 2;

               |SI #100nPara2 = 0;
                   #100nPara1 = base;
                   #100nPara2 = nIVA;
                   #100nPara3  = iva;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |GRABA 020#100a;
     |LIBERA #100;

     |SI nSubeIVA ! 0; |Y nCampoDes < 84;
         nMasBase = 0;
         |PARA nPara1 = 6;  |SI nPara1 [ 24;  |HACIENDO nPara1 = nPara1 + 3;
                nPara2 = nPara1 + 1;
                nPara3 = nPara1 + 2;
                |SI #100nPara2 ! 0; nMasBase = nMasBase + 1; |FINSI;
         |SIGUE;
         |SI nMasBase > 1;
             |SI #100#5 = 5;  nIVA5 = 1; |FINSI;
             |SI #100#5 = 8;  nIVA8 = 1; |FINSI;
             |SI #100#5 = 11; nIVA11 = 1; |FINSI;
             |SI #100#5 = 14; nIVA14 = 1; |FINSI;
             |SI #100#5 = 17; nIVA17 = 1; |FINSI;
             |SI #100#5 = 46; nIVA46 = 1; |FINSI;
         |FINSI;
     |FINSI;

     |SI nCampoDes > 13; |Y nCampoDes < 84;
         nIVA = nNume1;
         iva  = nNume2;
     |FINSI;
|FPRC;

|PROCESO ConcepCompra;
     |ABRE #100;
     |SI #4#50 = 1;
         #8#0 = Concep2;
         |LEE 040#8=;
         |SI FSalida ! 0; |ACABA; |FINSI;

         aEl2 = #8#2;
         aEl6 = #8#6;
         nEl8 = #8#8;
     |SINO;
         #28#0 = Concep6;
         |LEE 040#28=;
         |SI FSalida ! 0; |ACABA; |FINSI;

         aEl2 = #28#2;
         aEl6 = #28#6;
         nEl8 = #28#8;
     |FINSI;

     |SI aEl2 = "I";|O aEl2 = "i";|O aEl2 = "S";|O aEl2 = "s";
         |SI aEl6 = "S";  |Y #0#6 = 2;
             #25#59 = #9#13;
             #25#62 = #9#14;
             #25#65 = #9#15;

             |SI tiva = #9#13; #25#58 = #25#58 + base; #25#60 = #25#60 + iva; |FINSI;
             |SI tiva = #9#14; #25#61 = #25#61 + base; #25#63 = #25#63 + iva; |FINSI;
             |SI tiva = #9#15; #25#64 = #25#64 + base; #25#66 = #25#66 + iva; |FINSI;

             #25#49 = #25#58 + #25#61 + #25#64;
             #25#50 = #25#60 + #25#63 + #25#66;

             nPorce1 = 100;
             nPorce2 = 100;
             |SI nEl8 ! 8;
                 #25#72  = #25#72 + (base % nPorce1);
                 #25#51  = #25#51 + ((iva + rec) % nPorce2);
                 nCampoDes = 72;  |HAZ PonPorceCompra;
             |SINO;
                 #25#77  = #25#77 + (base % nPorce1);
                 #25#78  = #25#78 + ((iva + rec) % nPorce2);
                 nCampoDes = 77;  |HAZ PonPorceCompra;
             |FINSI;
        |SINO;
             nPorce1  = 100;
             nPorce2  = 100;
             |SI #4#28 ! 0; |Y #4#28 ! 100;
                 nPorce1 = #4#28;
                 nPorce2 = #4#28;
             |FINSI;

             |SI nEl8 = 1;
                 #25#70 = #25#70 + (base % nPorce1);
                 #25#21 = #25#21 + ((iva + rec) % nPorce2);
                 nCampoDes = 70;  |HAZ PonPorceCompra;
             |FINSI;

             |SI nEl8 = 2;
                 #25#71 = #25#71 + (base % nPorce1);
                 #25#22 = #25#22 + ((iva + rec) % nPorce2);
                 nCampoDes = 71;  |HAZ PonPorceCompra;
             |FINSI;

             |SI nEl8 = 3;
                 #25#73 = #25#73 + (base % nPorce1);
                 #25#23 = #25#23 + ((iva + rec) % nPorce2);
                 |SI enEjer ] 2014;
                     nCampoDes = 73;  |HAZ PonPorceCompra;
                 |FINSI;
             |FINSI;

             |SI nEl8 = 4;
                 #25#75 = #25#75 + (base % nPorce1);
                 #25#43 = #25#43 + ((iva + rec) % nPorce2);
                 nCampoDes = 75;  |HAZ PonPorceCompra;
             |FINSI;

             |SI nEl8 = 5;
                 #25#76 = #25#76 + (base % nPorce1);
                 #25#44 = #25#44 + ((iva + rec) % nPorce2);
                 nCampoDes = 76;  |HAZ PonPorceCompra;
             |FINSI;

             |SI nEl8 = 6;
                 nPorce1 = 100;
                 nPorce2 = 100;
                 #25#72  = #25#72 + base;
                 #25#51  = #25#51 + ((iva + rec) % nPorce2);
                 nCampoDes = 72;  |HAZ PonPorceCompra;
             |FINSI;

             |SI nEl8 = 8;
                 #25#77 = #25#77 + base;
                 #25#78 = #25#78 + ((iva + rec) % nPorce2);
                 nCampoDes = 77;  |HAZ PonPorceCompra;
             |FINSI;

             |SI nEl8 = 7;
                 #25#74 = #25#74 + base;
                 #25#24 = #25#24 + iva + rec;
                 |SI enEjer ] 2014;
                     nCampoDes = 74;  |HAZ PonPorceCompra;
                 |FINSI;
             |FINSI;
             |SI #4#28 ! 0; |Y #4#28 ! 100;
                 nPorce1 = #4#28;
                 nPorce2 = #4#28;
             |FINSI;
        |FINSI;

        |SI enSwCaja = 1;
            |SI nOpera = 0; |Y nEjerCobro = 0;
                nPorce1 = 100;
                nPorce2 = 100;
                base = nBaseCaja;
                iva  = nCuotaCaja;
                #25#86 = #25#86 + nBaseCaja;
                #25#87 = #25#87 + nCuotaCaja;
                nCampoDes = 86;  |HAZ PonPorceCompra;
           |FINSI;
        |FINSI;
     |FINSI;
     |CIERRA #100;
|FPRC;

|PROCESO CalPer25;
     aTipo = #4#26;
     |SI aTipo = "F";  aTipo = "T";  |FINSI;
     |SI aTipo = "D";  aTipo = "M";  |FINSI;

     |SI aTipo = "T";
         nPer = 4;
     |FINSI;

     |SI aTipo = "M";
         |SI #4#26 ! "D";
             nPer = 12;
         |SINO;
             nPer = #25#1;
         |FINSI;
     |FINSI;

     |SI total < 0;
         |SI #25#1 ! nPer;
             #25#32 = -total;
             #25#31 = 0;
             #25#33 = 0;
         |SINO;
             |SI #4#27 = "C";
                 #25#32 = -total;
                 #25#31 = 0;
                 #25#33 = 0;
             |FINSI;

             |SI #4#27 = "D";
                 #25#32 = 0;
                 #25#33 = 0;
                 #25#31 = -total;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Compras;

     aCampo28 = "S";
     |ABRE #4;
     #4#0 = #5#0;
     #4#1 = #5#19;
     #4#2 = #0#2;
     |LIBERA #4;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     |SI #4#22 = "A"; |ACABA; |FINSI;
     |SI #4#26 = "N"; |ACABA; |FINSI;

     |SI #4#26 = "M";  |O #4#26 = "D";
         |SI #0#7 ! "M";  |ACABA;  |FINSI;
     |SINO;
         |SI #0#7 ! "T";  |ACABA;  |FINSI;
     |FINSI;

     |SI #4#26 ! "F";
         |ABRE #19;
         #19#0 = #4#4;
         #19#1 = #4#5;
         |LEE 040#19=;
         |SI FSalida = 0;  |ACABA;  |FINSI;
         |CIERRA #19;
     |FINSI;

|SI nEjerCobro = 0;
|| ... Procesos nuevos RECC ] 2014
     enSwCaja  = 0;
     nHayCaja  = 0;
     |SI enEjer ] 2014;
         eEmpreCaja = #5#0;
         eRegisCaja = #5#1;
         enEjerCaja = #5#14;
         eDevenCaja = 0;
         aTipoIVA   = "S";
         enDigCaja  = #4#50;
         |HAZ EsCajaIva;

         |SI enSwCaja = 1;  |HAZ LeeCab501;  |FINSI;
     |FINSI;
|FINSI;

     |SI nOpera = 1; |Y enSwCaja = 0; |ACABA; |FINSI;

     d_empre = #5#0;
     d_activ = #5#19;

     #25#0 = #5#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #5#19;
     |HAZ compensar;

     #25#0 = #5#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #5#19;
     |LEE 101#25=;
     estado = FSalida;
     |SI estado ! 0; |DDEFECTO #25; |FINSI;

     |SI #25#4 = "S"; |ACABA; |FINSI;

     #25#0 = #5#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #5#19;

     nTotalCaja = #5#22;
     nOpCaja = 0; |HAZ ElRECC;
     |SI nEjerCobro ! 0;
      |SI nBaseCaja1 = 0; |Y nBaseCaja2 = 0;
        |Y nBaseCaja3 = 0; |Y nBaseCaja4 = 0;
         |Y nBaseCaja5 = 0; |Y nBaseCaja6 = 0;
          |Y nCuotaCaja1 = 0; |Y nCuotaCaja2 = 0;
           |Y nCuotaCaja3 = 0; |Y nCuotaCaja4 = 0;
            |Y nCuotaCaja5 = 0; |Y nCuotaCaja6 = 0;
        |ACABA;
      |FINSI;
    |FINSI;

     Concep2 = #5#5;  Concep6 = #5#72; base = #5#7;  iva = #5#9;  rec = #5#11; tiva = #5#8;  rec = 0;
     |SI enSwCaja = 1;
         base = nBaseCaja1; nBaseCaja  = #5#7;
         iva = nCuotaCaja1; nCuotaCaja = #5#9;
     |FINSI;
     |HAZ ConcepCompra;

     Concep2 = #5#33; Concep6 = #5#73; base = #5#23; iva = #5#27; rec = #5#31; tiva = #5#25; rec = 0;
     |SI enSwCaja = 1;
         base = nBaseCaja2; nBaseCaja  = #5#23;
         iva = nCuotaCaja2; nCuotaCaja = #5#27;
     |FINSI;
     |HAZ ConcepCompra;

     Concep2 = #5#34; Concep6 = #5#74; base = #5#24; iva = #5#28; rec = #5#32; tiva = #5#26; rec = 0;
     |SI enSwCaja = 1;
         base = nBaseCaja3; nBaseCaja  = #5#24;
         iva = nCuotaCaja3; nCuotaCaja = #5#28;
     |FINSI;
     |HAZ ConcepCompra;

     #25#20 = #25#7  + #25#10 + #25#13 + #25#16 + #25#19 + #25#48 + #25#50;
     #25#25 = #25#21 + #25#22 + #25#23 + #25#43 + #25#44 + #25#51 + #25#78 + #25#80;
     #25#26 = #25#20 - #25#25;
     #25#27 = 100;
     #25#28 = #25#26 % #25#27;
     #25#29 = perante;
     total = #25#28 - #25#29;
     |SI total = 0; #25#33 = 0; #25#32 = 0; #25#31 = 0; |FINSI;

     |SI total > 0; #25#33 = total; #25#32 = 0; #25#31 = 0; |FINSI;

     |HAZ CalPer25;

     |SI estado ! 0;
         |GRABA 020#25n;
     |SINO;
         |GRABA 020#25a;
     |FINSI;
     |LIBERA #25;

     |SI nEjerCobro = 0;
         |SI #25#1 = nPer;
             |HAZ grabacomp;
         |FINSI;
     |FINSI;

     |SI #4#51 = "S";
         |SI nOpera = 0; |Y nEjerCobro = 0;
             a340 = "S"; |HAZ Recibidas340;
         |FINSI;
     |FINSI;
     |SI enSwCaja = 1;
         nHayCaja = 0;
         nTotalCaja = #5#26;
         nOpCaja  = 1; |HAZ ElRECC;
     |FINSI;
     |SI nOpera = 0; |Y nEjerCobro = 0;
         #5#18 = "S";
     |FINSI;
     |SI enSwCaja = 0;
         #5#18 = "S";
     |SINO;
         #5#18 = aCampo28;
     |FINSI;
     |SI nEjerCobro = 0;
         |GRABA 011#5a;
     |FINSI;
     |LIBERA #5;

|FPRC;

|DEFBUCLE lineacomp;
     #5#2;
     ;
     #11#0, #11#4, tri1, nDAct, fec1, 00001;
     #11#0, #11#4, tri2, nHAct, fec2, 32000;
     be;
     NULL, Compras;
|FIN;

|DEFBUCLE lineaRECC_C;
     #5#2;
     ;
     #11#0, #11#4,    0, nDAct, "01.01.0000", 00001;
     #11#0, #11#4, tri0, nHAct, fec0,         32000;
     e;
     NULL, Compras;
|FIN;

|PROCESO cabecomp;

     aTipoIVA = "S";
     fichero = #11#0;
     fichero = "00000" + fichero;
     fichero = fichero % -105;
     anyocab = #11#4;
     anyocab = "00" + anyocab;
     anyocab = anyocab % -102;
     eaNCaja = fichero + anyocab;
     fichero = "c" + fichero + anyocab; |NOME_DAT #5 fichero;
     aNomOrigen = fichero;

     eEmpreCaja = #11#0;
     enEjerCaja = #11#4;
     aFichero = "f" + eaNCaja; |NOME_DAT #501 aFichero;
     aFichero = "m" + eaNCaja; |NOME_DAT #502 aFichero;

     nEjerCobro = 0;
     a340 = "";
     |SI #0#2 ] 14;  nOpera = 1; |BUCLE lineaRECC_C;  |FINSI;

     nOpera = 0;
     |BUCLE lineacomp;
     |SI enEjer ] 2015;
         aTipo501 = "S";
         nEjerCobro = enEjer - 1;
         |BUCLE Lee501_2014;
     |FINSI;
     |CIERRA #5; |NOME_DAT #5 aNomOrigen;

     |SI a340 = "S";
         |PIEINF; nPie = 0;

        nPer  = enPeriodo;
        nEjer = 2000 + #0#2;
        aAlfa = ":agieos/dsmo3401;";
        aAlfa = aAlfa + (("00000" + #11#0) % -105);   || Empresa
        aAlfa = aAlfa + enEjer;                       || Ejercicio
        aAlfa = aAlfa + (("00" + enPeriodo) % -102);  || Periodo
        aAlfa = aAlfa + "340";                        || Modelo
        aAlfa = aAlfa + "00";                         || Complemento
        aAlfa = aAlfa + ("00" + enActividad) % -102;  || Actividad
        |SI PARAMETRO = "";
            aAlfa = aAlfa + "98";                         || Tipo de entrada
        |SINO;
            aAlfa = aAlfa + "91";                         || Tipo de entrada
        |FINSI;
        aAlfa = aAlfa + "0";                          || Mensaje

        |SUB_EJECUTA_NP aAlfa;

        enPeriodo = nPer;
     |FINSI;
|FPRC;

|DEFBUCLE pasacomp;
     #11#1;
     ;
     #0#0, #0#2;
     #0#1, #0#2;
     e;
     NULL,cabecomp;
|FIN;

|| **************************************************************************
||                               Pasamos las Ventas
|| **************************************************************************

|PROCESO OperEspe2;
     |ABRE #10;
     #10#0 = #25#0;
     #10#1 = #25#45;
     #10#2 = #25#1;
     #10#3 = #25#2;
     |LIBERA #10;
     |LEE 140#10=;
     FEstado_Op = FSalida;
     |SI FSalida ! 0; |CDEFECTO #10, 1; |FINSI;

|SI enSwCaja = 0;
     |SI #8#8 = 0;  #10#24 = #10#24 + base; |FINSI;
     |SI #8#8 = 1;  #10#09 = #10#09 + base; |FINSI;
     |SI #8#8 = 2;  #10#10 = #10#10 + base; #25#81 = #10#10; |FINSI;
     |SI #8#8 = 3;  #10#11 = #10#11 + base; |FINSI;
     |SI #8#8 = 4;  #10#25 = #10#25 + base; |FINSI;
     |SI #8#8 = 5;  #10#08 = #10#08 + base; |FINSI;
     |SI #8#8 = 6;  #10#12 = #10#12 + base; |FINSI;
     |SI #8#8 = 7;  #10#13 = #10#13 + base; |FINSI;
     |SI #8#8 = 8;  #10#16 = #10#16 + base; |FINSI;
     |SI #8#8 = 9;  #10#19 = #10#19 + base; |FINSI;
     |SI #8#8 = 10; #10#21 = #10#21 + base; |FINSI;
     |SI #8#8 = 11; #10#22 = #10#22 + base; |FINSI;
     |SI #8#8 = 12; #10#4  = #10#4  + base; |FINSI;
     |SI #8#8 = 13; #10#7  = #10#7  + base; #25#82 = #10#7; |FINSI;  ||casilla 110
     |SI #8#8 = 14; #10#20 = #10#20 + base; |FINSI;  ||casilla 523
|SINO;
     #10#26 = #10#26 + base;
|FINSI;

     #10#09 = #25#54;

     |SI FEstado_Op = 0; |GRABA 140#10a; |SINO; |GRABA 140#10n; |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO OperEspe6;
     |ABRE #10;
     #10#0 = #25#0;
     #10#1 = #25#45;
     #10#2 = #25#1;
     #10#3 = #25#2;
     |LIBERA #10;
     |LEE 140#10=;
     FEstado_Op = FSalida;
     |SI FSalida ! 0; |CDEFECTO #10, 1; |FINSI;

|SI enSwCaja = 0;
     |SI #28#8 = 0;  #10#24 = #10#24 + base; |FINSI;
     |SI #28#8 = 1;  #10#09 = #10#09 + base; |FINSI;
     |SI #28#8 = 2;  #10#10 = #10#10 + base; #25#81 = #10#10; |FINSI;
     |SI #28#8 = 3;  #10#11 = #10#11 + base; |FINSI;
     |SI #28#8 = 4;  #10#25 = #10#25 + base; |FINSI;
     |SI #28#8 = 5;  #10#08 = #10#08 + base; |FINSI;
     |SI #28#8 = 6;  #10#12 = #10#12 + base; |FINSI;
     |SI #28#8 = 7;  #10#13 = #10#13 + base; |FINSI;
     |SI #28#8 = 8;  #10#16 = #10#16 + base; |FINSI;
     |SI #28#8 = 9;  #10#19 = #10#19 + base; |FINSI;
     |SI #28#8 = 10; #10#21 = #10#21 + base; |FINSI;
     |SI #28#8 = 11; #10#22 = #10#22 + base; |FINSI;
     |SI #28#8 = 12; #10#4  = #10#4  + base; |FINSI;
     |SI #28#8 = 13; #10#7  = #10#7  + base; |FINSI;
     |SI #28#8 = 14; #10#20 = #10#20 + base; |FINSI;
|SINO;
     #10#26 = #10#26 + base;
|FINSI;
     #10#09 = #25#54;

     |SI FEstado_Op = 0; |GRABA 140#10a; |SINO; |GRABA 140#10n; |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO Casilla_1;
         #25#6  = #9#1;
         #25#9  = #9#2;
         #25#12 = #9#3;

         #25#15 = #9#4;
         #25#18 = #9#5;
         #25#47 = #9#6;

         |SI tiva = #9#1; #25#5  = #25#5  + base; #25#7  = #25#7  + iva; nCampoDes = 5;  |HAZ PonPorceVenta; |FINSI;
         |SI tiva = #9#2; #25#8  = #25#8  + base; #25#10 = #25#10 + iva; nCampoDes = 8;  |HAZ PonPorceVenta; |FINSI;
         |SI tiva = #9#3; #25#11 = #25#11 + base; #25#13 = #25#13 + iva; nCampoDes = 11; |HAZ PonPorceVenta; |FINSI;

         |SI trec = #9#4; #25#14 = #25#14 + base; #25#16 = #25#16 + rec; nCampoDes = 14; |HAZ PonPorceVenta; |FINSI;
         |SI trec = #9#5; #25#17 = #25#17 + base; #25#19 = #25#19 + rec; nCampoDes = 17; |HAZ PonPorceVenta; |FINSI;
         |SI trec = #9#6; #25#46 = #25#46 + base; #25#48 = #25#48 + rec; nCampoDes = 46; |HAZ PonPorceVenta; |FINSI;
|FPRC;

|PROCESO Casilla_1_16; ||Caja
         #25#89 = #9#1;
         #25#92 = #9#2;
         #25#95 = #9#3;

         |SI tiva = #9#1; #25#88 = #25#88 + base; #25#90 = #25#90 + iva; nCampoDes = 88; |HAZ PonPorceVenta; |FINSI;
         |SI tiva = #9#2; #25#91 = #25#91 + base; #25#93 = #25#93 + iva; nCampoDes = 91; |HAZ PonPorceVenta; |FINSI;
         |SI tiva = #9#3; #25#94 = #25#94 + base; #25#96 = #25#96 + iva; nCampoDes = 94; |HAZ PonPorceVenta; |FINSI;
|FPRC;

|PROCESO ConcepVenta;
     |ABRE #100;
     nIVA = tiva;
     nREC = trec;
     |SI nSubeIVA = 1;
         |SI tiva = 16;  tiva = 18;  |FINSI;
         |SI tiva = 7;   tiva = 8;   |FINSI;
     |FINSI;
     |SI nSubeIVA = 2;
         |SI tiva = 18; |O tiva = 16;  tiva = 21;  |FINSI;
         |SI tiva = 7;  |O tiva =  8;  tiva = 10;  |FINSI;

         |SI trec = 1;  trec = 1.40; |FINSI;
         |SI trec = 4;  trec = 5.20; |FINSI;
     |FINSI;

     |SI #4#50 = 1;
         #8#0 = Concep2;
         |LEE 040#8=;
         |SI FSalida = 0;
             |SI #8#2 = "R";|O #8#2 = "r";|O #8#2 = "I";|O #8#2 = "i";
                 |SI #8#6 = "E";
                     #25#54 = #25#54 + base;
                 |SINO;
                     |SI #8#6 = "S";
                         |SI #0#6 = 1;
                             #25#59 = #9#13;
                             #25#62 = #9#14;
                             #25#65 = #9#15;

                             |SI tiva = #9#13; #25#58 = #25#58 + base; #25#60 = #25#60 + iva; |FINSI;
                             |SI tiva = #9#14; #25#61 = #25#61 + base; #25#63 = #25#63 + iva; |FINSI;
                             |SI tiva = #9#15; #25#64 = #25#64 + base; #25#66 = #25#66 + iva; |FINSI;

                             #25#49 = #25#58 + #25#61 + #25#64;
                             #25#50 = #25#60 + #25#63 + #25#66;
                             #25#51 = #25#50;
                          |FINSI;
                     |SINO;
                         |SI enSwCaja = 0;
                             |HAZ Casilla_1;
                         |SINO;
                             |HAZ Casilla_1_16; || de caja
                         |FINSI;
                     |FINSI;
                 |FINSI;

                 |SI enSwCaja = 1;
                     |SI nOpera = 0; |Y nEjerCobro = 0;
                         base = nBaseCaja;
                         iva  = nCuotaCaja;
                         #25#84 = #25#84 + base;
                         #25#85 = #25#85 + iva;
                         nCampoDes = 84;  |HAZ PonPorceVenta;
                     |SINO;
                         base = 0;
                         iva  = 0;
                     |FINSI;
                 |FINSI;
                 |HAZ OperEspe2;
             |FINSI;
         |FINSI;
     |SINO;
         #28#0 = Concep6;
         |LEE 040#28=;
         |SI FSalida = 0;
             |SI #28#2 = "R";|O #28#2 = "r";|O #28#2 = "I";|O #28#2 = "i";
                 |SI #28#6 = "E";
                     #25#54 = #25#54 + base;
                 |SINO;
                     |SI #28#6 = "S";
                         |SI #0#6 = 1;
                             #25#59 = #9#13;
                             #25#62 = #9#14;
                             #25#65 = #9#15;

                             |SI tiva = #9#13; #25#58 = #25#58 + base; #25#60 = #25#60 + iva; |FINSI;
                             |SI tiva = #9#14; #25#61 = #25#61 + base; #25#63 = #25#63 + iva; |FINSI;
                             |SI tiva = #9#15; #25#64 = #25#64 + base; #25#66 = #25#66 + iva; |FINSI;

                             #25#49 = #25#58 + #25#61 + #25#64;
                             #25#50 = #25#60 + #25#63 + #25#66;
                             #25#51 = #25#50;
                          |FINSI;
                     |SINO;
                         |SI enSwCaja = 0;
                             |HAZ Casilla_1;
                         |SINO;
                             |HAZ Casilla_1_16; ||Caja
                         |FINSI;
                     |FINSI;
                 |FINSI;
                 |SI enSwCaja = 1;
                     |SI nOpera = 0; |Y nEjerCobro = 0;
                         base   = nBaseCaja;
                         iva    = nCuotaCaja;
                         #25#84 = #25#84 + base;
                         #25#85 = #25#85 + iva;
                         nCampoDes = 84;  |HAZ PonPorceVenta;
                     |SINO;
                         base = 0;
                         iva  = 0;
                     |FINSI;
                 |FINSI;
                 |HAZ OperEspe6;
             |FINSI;
         |FINSI;
     |FINSI;

     |CIERRA #100;
|FPRC;

|PROCESO Ventas;
     |ABRE #4;
     #4#0 = #7#0;
     #4#1 = #7#19;
     #4#2 = #0#2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     |SI #4#22 = "A"; |ACABA; |FINSI;
     |SI #4#26 = "N"; |ACABA; |FINSI;

     d_empre = #7#0;
     d_activ = #7#19;

     |SI #0#2 ] 0;  |Y #0#2 [ 80;
         |SI #4#26 ! "F";
             #19#0 = #4#4;
             #19#1 = #4#5;
             |LEE 040#19=;
             |SI FSalida ! 0;
                 |HAZ Ventas_303;
             |FINSI;
         |SINO;
             |HAZ Ventas_303;
         |FINSI;
     |SINO;
         |SI #0#2 [ 97;
             #18#0 = #4#4;
             #18#1 = #4#5;
             |LEE 040#18=;
             |SI FSalida = 0;
                 |HAZ Ventas_310;
             |SINO;
                 |HAZ Ventas_303;
             |FINSI;
         |SINO;
             |SI #4#26 ! "F";
                 #19#0 = #4#4;
                 #19#1 = #4#5;
                 |LEE 040#19=;
                 |SI FSalida ! 0;
                     |HAZ Ventas_303;
                 |FINSI;
             |SINO;
                 |HAZ Ventas_303;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nOpera = 0; |Y nEjerCobro = 0;
         #7#18 = "S";
     |FINSI;
     |SI enSwCaja = 0;
         #7#18 = "S";
     |SINO;
         #7#18 = aCampo28;
     |FINSI;
     |SI nEjerCobro = 0;
         |GRABA 011#7a;
     |FINSI;
     |LIBERA #7;
|FPRC;

|PROCESO Ventas_310;
     base = 0;

     |SI #4#50 = 1;
         #8#0 = #7#5;
         |LEE 040#8=;
         |SI FSalida = 0; |Y #8#3 = "I";
            base = base + #7#7;
         |FINSI;

         #8#0 = #7#33;
         |LEE 040#8=;
         |SI FSalida = 0; |Y #8#3 = "I";
            base = base + #7#23;
         |FINSI;

         #8#0 = #7#34;
         |LEE 040#8=;
         |SI FSalida = 0; |Y #8#3 = "I";
             base = base + #7#24;
         |FINSI;

         #8#0 = #7#60;
         |LEE 040#8=;
         |SI FSalida = 0; |Y #8#3 = "I";
             base = base + #7#45;
         |FINSI;

         #8#0 = #7#61;
         |LEE 040#8=;
         |SI FSalida = 0; |Y #8#3 = "I";
             base = base + #7#46;
         |FINSI;

         #8#0 = #7#62;
         |LEE 040#8=;
         |SI FSalida = 0; |Y #8#3 = "I";
             base = base + #7#47;
         |FINSI;
     |SINO;
         #28#0 = #7#72;
         |LEE 040#28=;
         |SI FSalida = 0; |Y #28#3 = "I";
             base = base +  #7#7;
         |FINSI;

         #28#0 = #7#73;
         |LEE 040#28=;
         |SI FSalida = 0; |Y #28#3 = "I";
             base = base + #7#23;
         |FINSI;

         #28#0 = #7#74;
         |LEE 040#28=;
         |SI FSalida = 0; |Y #28#3 = "I";
             base = base + #7#24;
         |FINSI;

         #28#0 = #7#75;
         |LEE 040#28=;
         |SI FSalida = 0; |Y #28#3 = "I";
             base = base + #7#45;
         |FINSI;

         #28#0 = #7#76;
         |LEE 040#28=;
         |SI FSalida = 0; |Y #28#3 = "I";
             base = base + #7#46;
         |FINSI;

         #28#0 = #7#77;
         |LEE 040#28=;
         |SI FSalida = 0; |Y #28#3 = "I";
             base = base + #7#47;
         |FINSI;
     |FINSI;

     |SI epig1_1 = ""; |Y epig2_1 = "";
         epig1_1 = #4#4;
         epig2_1 = #4#5;
         epig3_1 = #4#1;
         rdtos_1 = rdtos_1 + base;
         |ACABA;
     |FINSI;

     |SI epig1_1 = #4#4; |Y epig2_1 = #4#5;
         rdtos_1 = rdtos_1 + base;
         |ACABA;
     |FINSI;

     |SI epig1_2 = ""; |Y epig2_2 = "";
         epig1_2 = #4#4;
         epig2_2 = #4#5;
         epig3_2 = #4#1;
         rdtos_2 = rdtos_2 + base;
         |ACABA;
     |FINSI;

     |SI epig1_2 = #4#4; |Y epig2_2 = #4#5;
         rdtos_2 = rdtos_2 + base;
         |ACABA;
     |FINSI;

     |SI epig1_3 = ""; |Y epig2_3 = "";
         epig1_3 = #4#4;
         epig2_3 = #4#5;
         epig3_3 = #4#1;
         rdtos_3 = rdtos_3 + base;
         |ACABA;
     |FINSI;

     |SI epig1_3 = #4#4; |Y epig2_3 = #4#5;
         rdtos_3 = rdtos_3 + base;
         |ACABA;
     |FINSI;

     |SI epig1_4 = ""; |Y epig2_4 = "";
         epig1_4 = #4#4;
         epig2_4 = #4#5;
         epig3_4 = #4#1;
         rdtos_4 = rdtos_4 + base;
         |ACABA;
     |FINSI;

     |SI epig1_4 = #4#4; |Y epig2_4 = #4#5;
         rdtos_4 = rdtos_4 + base;
         |ACABA;
     |FINSI;

     |SI epig1_5 = ""; |Y epig2_5 = "";
         epig1_5 = #4#4;
         epig2_5 = #4#5;
         epig3_5 = #4#1;
         rdtos_5 = rdtos_5 + base;
         |ACABA;
     |FINSI;

     |SI epig1_5 = #4#4; |Y epig2_5 = #4#5;
         rdtos_5 = rdtos_5 + base;
     |FINSI;
|FPRC;

|PROCESO Ventas_303;
     aCampo28 = "S";
     aTipoIVA = "R";

|SI nEjerCobro = 0;
|| ... Procesos nuevos RECC ] 2014
     enSwCaja  = 0;
     nHayCaja  = 0;
     |SI enEjer ] 2014;
         eEmpreCaja = #7#0;
         eRegisCaja = #7#1;
         enEjerCaja = #7#14;
         aTipoIVA   = "R";
         eDevenCaja = 0;
         enDigCaja  = #4#50;
         |HAZ EsCajaIva;

         |SI enSwCaja = 1;  |HAZ LeeCab501;  |FINSI;
     |FINSI;
|FINSI;

     |SI nOpera = 1; |Y enSwCaja = 0; |ACABA; |FINSI;

     #25#0 = #7#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #7#19;
     |HAZ compensar;

     #25#0 = #7#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #7#19;
     |LEE 101#25=;
     estado = FSalida;
     |SI estado ! 0; |DDEFECTO #25; |FINSI;

     |SI #25#4 = "S"; |ACABA; |FINSI;

     nTotalCaja = #7#22;
     nOpCaja = 0; |HAZ ElRECC;
     |SI nEjerCobro ! 0; |O nOpera = 1;
      |SI nBaseCaja1 = 0; |Y nBaseCaja2 = 0;
        |Y nBaseCaja3 = 0; |Y nBaseCaja4 = 0;
         |Y nBaseCaja5 = 0; |Y nBaseCaja6 = 0;
          |Y nCuotaCaja1 = 0; |Y nCuotaCaja2 = 0;
           |Y nCuotaCaja3 = 0; |Y nCuotaCaja4 = 0;
            |Y nCuotaCaja5 = 0; |Y nCuotaCaja6 = 0;
        |ACABA;
      |FINSI;
    |FINSI;

     #25#0 = #7#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #7#19;

     Concep2 = #7#5;
     Concep6 = #7#72;
     base    = #7#7; tiva = #7#8;  iva = #7#9; trec = #7#10; rec = #7#11;
     |SI enSwCaja = 1;
         base = nBaseCaja1; nBaseCaja  = #7#7;
         iva = nCuotaCaja1; nCuotaCaja = #7#9;
     |FINSI;
     |HAZ ConcepVenta;

     Concep2 = #7#33;
     Concep6 = #7#73;
     base    = #7#23; tiva = #7#25; iva = #7#27; trec = #7#29; rec = #7#31;
     |SI enSwCaja = 1;
         base = nBaseCaja2; nBaseCaja  = #7#23;
         iva = nCuotaCaja2; nCuotaCaja = #7#27;
     |FINSI;
     |HAZ ConcepVenta;

     Concep2 = #7#34;
     Concep6 = #7#74;
     base    = #7#24; tiva = #7#26; iva = #7#28; trec = #7#30; rec = #7#32;
     |SI enSwCaja = 1;
         base = nBaseCaja3; nBaseCaja  = #7#24;
         iva = nCuotaCaja3; nCuotaCaja = #7#28;
     |FINSI;
     |HAZ ConcepVenta;

     Concep2 = #7#60;
     Concep6 = #7#75;
     base    = #7#45; tiva = #7#48; iva = #7#51; trec = #7#54; rec = #7#57;
     |SI enSwCaja = 1;
         base = nBaseCaja4; nBaseCaja  = #7#45;
         iva = nCuotaCaja4; nCuotaCaja = #7#51;
     |FINSI;
     |HAZ ConcepVenta;

     Concep2 = #7#61;
     Concep6 = #7#76;
     base    = #7#46; tiva = #7#49; iva = #7#52; trec = #7#55; rec = #7#58;
     |SI enSwCaja = 1;
         base = nBaseCaja5; nBaseCaja  = #7#46;
         iva = nCuotaCaja5; nCuotaCaja = #7#52;
     |FINSI;
     |HAZ ConcepVenta;

     Concep2 = #7#62;
     Concep6 = #7#77;
     base    = #7#47; tiva = #7#50; iva = #7#53; trec = #7#56; rec = #7#59;
     |SI enSwCaja = 1;
         base = nBaseCaja6; nBaseCaja  = #7#47;
         iva = nCuotaCaja6; nCuotaCaja = #7#53;
     |FINSI;
     |HAZ ConcepVenta;

     #25#20 = #25#7 + #25#10 + #25#13 + #25#16 + #25#19 + #25#48 + #25#50;
     #25#25 = #25#21 + #25#22 + #25#23 + #25#43 + #25#44 + #25#51 + #25#78 + #25#80;
     #25#26 = #25#20 - #25#25;
     #25#27 = 100;
     #25#28 = #25#26 % #25#27;
     #25#29 = perante;
     total = #25#28 - #25#29;
     |SI total = 0; #25#33 = 0; #25#32 = 0; #25#31 = 0; |FINSI;
     |SI total > 0; #25#33 = total; #25#32 = 0; #25#31 = 0; |FINSI;

    |SI nIVA5  = 1;
        #25#6  = (#25#7  / #25#5)  * 100;
        |SI #25#6 [ 0; #25#6 = #9#1; |FINSI;
    |FINSI;
    |SI nIVA8  = 1;
         #25#9  = (#25#10 / #25#8)  * 100;
        |SI #25#9 [ 0; #25#9 = #9#2; |FINSI;
    |FINSI;
    |SI nIVA11 = 1;
        #25#12 = (#25#13 / #25#11) * 100;
        |SI #25#12 [ 0; #25#12 = #9#3; |FINSI;
    |FINSI;

    |SI nIVA14 = 1;
        #25#15 = (#25#16 / #25#14) * 100;
        |SI #25#15 [ 0; #25#15 = #9#4; |FINSI;
    |FINSI;
    |SI nIVA17 = 1;
        #25#18 = (#25#19 / #25#17) * 100;
        |SI #25#18 [ 0; #25#18 = #9#5; |FINSI;
    |FINSI;
    |SI nIVA46 = 1;
        #25#47 = (#25#48 / #25#46) * 100;
        |SI #25#47 [ 0; #25#47 = #9#6; |FINSI;
    |FINSI;

     |HAZ CalPer25;

     |SI estado ! 0;
         |GRABA 020#25n;
     |SINO;
         |GRABA 020#25a;
     |FINSI;
     |LIBERA #25;

     |SI nEjerCobro = 0;
         |SI #25#1 = nPer;
             |HAZ grabacomp;
         |FINSI;
     |FINSI;

     |SI #4#51 = "S";
         |SI nOpera = 0; |Y nEjerCobro = 0;
             a340 = "S"; |HAZ Expedidas340;
         |FINSI;
     |FINSI;

     |SI enSwCaja = 1;
         nHayCaja = 0;
         nTotalCaja = #7#26;
         nOpCaja  = 1; |HAZ ElRECC;
     |FINSI;
|FPRC;

|DEFBUCLE lineavent_2;
     #7#2;
     ;
     #12#0, #12#4, tri1, nDAct, fec1, 00001;
     #12#0, #12#4, tri2, nHAct, fec2, 32000;
     be;
     NULL, Ventas;
|FIN;

|DEFBUCLE lineaRECC_V;
     #7#2;
     ;
     #12#0, #12#4,    0, nDAct, "01.01.0000", 00001;
     #12#0, #12#4, tri0, nHAct, fec0,         32000;
     e;
     NULL, Ventas;
|FIN;

|PROCESO ConcepVenta_2;
     |SI #4#50 = 1;
         #8#0 = Concep2;
         |LEE 040#8=;
         |SI FSalida = 0;
             |SI #8#2 = "R";|O #8#2 = "r";|O #8#2 = "I";|O #8#2 = "i";

                 |SI #8#8 = 13; |O #8#8 = 01; |O #8#8 = 02;
                     ventas_con = ventas_con + base;
                 |SINO;
                     |SI iva  ! 0; ventas_con = ventas_con + base; |FINSI;
                     |SI iva  = 0; ventas_sin = ventas_sin + base; |FINSI;
                 |FINSI;

             |FINSI;
         |FINSI;
     |SINO;
         #28#0 = Concep6;
         |LEE 040#28=;
         |SI FSalida = 0;
             |SI #28#2 = "R";|O #28#2 = "r";|O #28#2 = "I";|O #28#2 = "i";
                 |SI #28#8 = 13; |O #28#8 = 01; |O #28#8 = 02;
                     ventas_con = ventas_con + base;
                 |SINO;
                    |SI iva  ! 0; ventas_con = ventas_con + base; |FINSI;
                    |SI iva  = 0; ventas_sin = ventas_sin + base; |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #4#28 = 0;                             ||modificado por R.Aura
         ventas_con = ventas_con + ventas_sin;  ||si no hay % no calcula
         ventas_sin = 0;                        || prorrata
     |FINSI;
|FPRC;

|PROCESO Ventas_acu;
     |ABRE #4;
     #4#0 = #7#0;
     #4#1 = #7#19;
     #4#2 = #0#2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;

     #25#0 = #7#0; #25#1 = #0#3; #25#2 = #0#2; #25#45 = #7#19;

     Concep2 = #7#5;
     Concep6 = #7#72;
     base    = #7#7; tiva = #7#8; iva = #7#9; trec = #7#10; rec = #7#11;
     |HAZ ConcepVenta_2;

     Concep2 = #7#33;
     Concep6 = #7#73;
     base    = #7#23; tiva = #7#25; iva = #7#27; trec = #7#29; rec = #7#31;
     |HAZ ConcepVenta_2;

     Concep2 = #7#34;
     Concep6 = #7#74;
     base    = #7#24; tiva = #7#26; iva = #7#28; trec = #7#30; rec = #7#32;
     |HAZ ConcepVenta_2;

     Concep2 = #7#60;
     Concep6 = #7#75;
     base    = #7#45; tiva = #7#48; iva = #7#51; trec = #7#54; rec = #7#57;
     |HAZ ConcepVenta_2;

     Concep2 = #7#61;
     Concep6 = #7#76;
     base    = #7#46; tiva = #7#49; iva = #7#52; trec = #7#55; rec = #7#58;
     |HAZ ConcepVenta_2;

     Concep2 = #7#62;
     Concep6 = #7#77;
     base    = #7#47; tiva = #7#50; iva = #7#53; trec = #7#56; rec = #7#59;
     |HAZ ConcepVenta_2;
|FPRC;

|DEFBUCLE lineavent_1;
     #7#1;
     ;
     #12#0, #12#4, 00001;
     #12#0, #12#4, 32000;
     be;
     NULL, Ventas_acu;
|FIN;

|PROCESO cabevent;
     fichero = #12#0;
     fichero = "00000" + fichero;
     fichero = fichero % -105;
     anyocab = #12#4;
     anyocab = "00" + anyocab;
     anyocab = anyocab % -102;
     eaNCaja = fichero + anyocab;
     fichero = "v" + fichero + anyocab; |NOME_DAT #7 fichero;
     aNomOrigen = fichero;

     eEmpreCaja = #12#0;
     enEjerCaja = #12#4;

     aFichero = "f" + eaNCaja; |NOME_DAT #501 aFichero;
     aFichero = "m" + eaNCaja; |NOME_DAT #502 aFichero;

     aFichero = ("47" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dsmow204#aFichero#;
     |ABRE #dsmow204;  |CIERRA #dsmow204;  |DELINDEX #dsmow204;

     |ABRE #dsmow204;

     |HAZ BorraVariables;

     |SI #0#3  = 4;  |Y #0#7 = "T"; |BUCLE lineavent_1; |FINSI;
     |SI #0#3  = 12; |Y #0#7 = "M"; |BUCLE lineavent_1; |FINSI;

     nEjerCobro = 0;
     a340 = "";
     |SI #0#2 ] 14;  nOpera = 1; |BUCLE lineaRECC_V;  |FINSI;
     nOpera = 0;
     |BUCLE lineavent_2;
     |SI enEjer ] 2015;
         aTipo501 = "R";
         nEjerCobro = enEjer - 1;
         |BUCLE Lee501_2014;
     |FINSI;
     |CIERRA #7; |NOME_DAT #7 aNomOrigen;

     |SI #0#3  = 4;  |Y #0#7 = "T"; |HAZ prorrata; |FINSI;
     |SI #0#3  = 12; |Y #0#7 = "M"; |HAZ prorrata; |FINSI;

     |CIERRA #dsmow204;

     |SI a340 = "S";
         |HAZ Transmisiones;

         |PIEINF; nPie = 0;

        nPer  = enPeriodo;
        nEjer = 2000 + #0#2;
        aAlfa = ":agieos/dsmo3401;";
        aAlfa = aAlfa + (("00000" + #12#0) % -105);   || Empresa
        aAlfa = aAlfa + enEjer;                       || Ejercicio
        aAlfa = aAlfa + (("00" + enPeriodo) % -102);  || Periodo
        aAlfa = aAlfa + "340";                        || Modelo
        aAlfa = aAlfa + "00";                         || Complemento
        aAlfa = aAlfa + ("00" + enActividad) % -102;  || Actividad

        |SI PARAMETRO = "";
            aAlfa = aAlfa + "98";                         || Tipo de entrada
        |SINO;
            aAlfa = aAlfa + "91";                         || Tipo de entrada
        |FINSI;

        aAlfa = aAlfa + "0";                          || Mensaje

        |SUB_EJECUTA_NP aAlfa;

        enPeriodo = nPer;
     |FINSI;

     |DELINDEX #dsmow204;
|FPRC;

|| ******************
|| PASAMOS LAS VENTAS
|| ******************

|DEFBUCLE pasavent;
     #12#1;
     ;
     #0#0, #0#2;
     #0#1, #0#2;
     e;
     NULL, cabevent;
|FIN;

|| **************************************************************************
||                             Grabamos el 130
|| **************************************************************************

|PROCESO graba303;
     se_empre = #25#0;
     se_ejerc = #25#2;
     se_perio = #25#1;
     se_tipos = 303;
     se_activ = #25#45;
     se_impor = 0;
     |SI #25#33 > 0; se_impor =  #25#33; |FINSI;
     |SI #25#32 > 0; se_impor = -#25#32; |FINSI;
     |SI #25#31 > 0; se_impor = -#25#31; |FINSI;
     se_fecha = #25#3;
     se_factu = "";
     |HAZ seguimie;

     |ABRE #4;
     #4#0 = #25#0;
     #4#1 = #25#45;
     #4#2 = #0#2;
     |LEE 040#4=;
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
     |CIERRA #4;
     ventas = #25#5 + #25#8 + #25#11;
     |HAZ grabaact;
|FPRC;

|DEFBUCLE eosm1303;
     #25#1;
     ;
     #0#0, nDAct, #0#3, #0#2;
     #0#1, nHAct, #0#3, #0#2;
     e;
     NULL, graba303;
|FIN;

|| **************************************************************************
||                            Utilidades
|| **************************************************************************

|PROCESO penultimo;
 penult = 0;
 |ABRE #4;
 #4#0 = #25#0;
 #4#1 = #25#45;
 #4#2 = #0#2 - 2;
 |SI #4#2 = -2;  #4#2 = 98;  |FINSI;
 |SI #4#2 = -1;  #4#2 = 99;  |FINSI;
 |LEE 040#4=;
 |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
 penult = #4#39;

 #4#0 = #25#0;
 #4#1 = #25#45;
 #4#2 = #0#2;
 |LEE 040#4=;
 |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
 |CIERRA #4;
|FPRC;

|PROCESO periodo;
    anio = "20" + (("00" + #0#2) % -102);

    tri0 = 4;
    fec0 = "31.12.2999";

    |SI #0#7 = "M";
        |SI #0#3 = 1;
            varalf = "01.01." + anio; fec1   = varalf;
            varalf = "31.01." + anio; fec2   = varalf;
            tri1   = 1; tri11 = 1;
            tri2   = 4; tri12 =12;
        |FINSI;

        |SI #0#3 = 2;
            varalf = "01.02." + anio; fec1   = varalf;
            varalf = "29.02." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 3;
            varalf = "01.03." + anio; fec1   = varalf;
            varalf = "31.03." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 4;
            varalf = "01.04." + anio; fec1   = varalf;
            varalf = "30.04." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 5;
            varalf = "01.05." + anio; fec1   = varalf;
            varalf = "31.05." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 6;
            varalf = "01.06." + anio; fec1   = varalf;
            varalf = "30.06." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 7;
            varalf = "01.07." + anio; fec1   = varalf;
            varalf = "31.07." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 8;
            varalf = "01.08." + anio; fec1   = varalf;
            varalf = "31.08." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 9;
            varalf = "01.09." + anio; fec1   = varalf;
            varalf = "30.09." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 10;
            varalf = "01.10." + anio; fec1   = varalf;
            varalf = "31.10." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 11;
            varalf = "01.11." + anio; fec1   = varalf;
            varalf = "30.11." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        |SI #0#3 = 12;
            varalf = "01.12." + anio; fec1   = varalf;
            varalf = "31.12." + anio; fec2   = varalf;
            tri1   = 1; tri11 =  1;
            tri2   = 4; tri12 = 12;
        |FINSI;

        nNume1 = fec1;
        nNume1 = nNume1 - 1;
        fec0   = nNume1;
    |SINO;
        |SI #0#4 = "T";
            varalf = "01.01." + anio; fec1   = varalf;
            varalf = "31.12." + anio; fec2   = varalf;
            tri1   = #0#3; tri11 = #0#3;
            tri2   = #0#3; tri12 = #0#3;
            tri0   = tri1 - 1;
        |SINO;
            |SI #0#3 = 1;
                varalf = "01.01." + anio; fec1   = varalf;
                varalf = "31.03." + anio; fec2   = varalf;
                tri1   = 1; tri11 = 1;
                tri2   = 4; tri12 = 4;
            |FINSI;

            |SI #0#3 = 2;
                varalf = "01.04." + anio; fec1   = varalf;
                varalf = "30.06." + anio; fec2   = varalf;
                tri1   = 1; tri11 = 1;
                tri2   = 4; tri12 = 4;
            |FINSI;

            |SI #0#3 = 3;
                varalf = "01.07." + anio; fec1   = varalf;
                varalf = "30.09." + anio; fec2   = varalf;
                tri1   = 1; tri11 = 1;
                tri2   = 4; tri12 = 4;
            |FINSI;

            |SI #0#3 = 4;
                varalf = "01.10." + anio; fec1   = varalf;
                varalf = "31.12." + anio; fec2   = varalf;
                tri1   = 1; tri11 = 1;
                tri2   = 4; tri12 = 4;
            |FINSI;
            nNume1 = fec1;
            nNume1 = nNume1 - 1;
            fec0   = nNume1;
        |FINSI;
    |FINSI;

    nEjer = anio;
    aTipo = #0#7;
    nPerTope = 7;  |SI aTipo = "T"; nPerTope = 3; |FINSI;
    nSubeIVA  = 0;
    |SI nEjer = 2010; |Y #0#3 ] nPerTope;  nSubeIVA = 1;  |FINSI;
    |SI nEjer ] 2011;                      nSubeIVA = 1;  |FINSI;

    nPerTope = 9;  |SI aTipo = "T"; nPerTope = 3; |FINSI;
    |SI nEjer = 2012; |Y #0#3 ] nPerTope;  nSubeIVA = 2;  |FINSI;
    |SI nEjer ] 2013;                      nSubeIVA = 2;  |FINSI;
|FPRC;

|PROCESO grabacomp;
    |ABRE #4;
    #4#0 = d_empre;
    #4#1 = d_activ;
    #4#2 = #0#2;
    |LIBERA #4;
    |LEE 140#4=;
    |SI FSalida = 0;
        #4#34 = 0;
        |SI #25#55 < 0;
            |SI #4#27 = "C"; #4#34 = -#25#55; |FINSI;
        |FINSI;
        |GRABA 140#4a;
    |FINSI;
    |CIERRA #4;
|FPRC;

|PROCESO grabaact;
    |ABRE #4;
    #4#0 = #25#0;
    #4#1 = #25#45;
    #4#2 = #0#2;
    |LIBERA #4;
    |LEE 140#4=;
    |SI FSalida = 0;
        |SI #0#3 = 1; #4#30 = ventas; |FINSI;
        |SI #0#3 = 2; #4#31 = ventas; |FINSI;
        |SI #0#3 = 3; #4#32 = ventas; |FINSI;
        |SI #0#3 = 4; #4#33 = ventas; |FINSI;
        |GRABA 140#4a;
    |FINSI;
    |CIERRA #4;
|FPRC;

|PROCESO LiqCaja;
     #4#0 = #1#0;
     #4#1 = 1;
     #4#2 = #0#2;
     |LEE 040#4];
     |SI FSalida ! 0; |DDEFECTO #4; |FINSI;

     |SI #4#26 = "M";  |O #4#26 = "D";
         |SI #0#7 ! "M";  |ACABA;  |FINSI;
     |SINO;
         |SI #0#7 ! "T";  |ACABA;  |FINSI;
     |FINSI;

     enEmpresa   = #1#0;
     eaNombreEmp = #1#1;
     enPerLiq    = #0#3;
     aAlfa       = "eosmccz4;Pase";
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|DEFBUCLE LiqCaja;
    #1#1;
    ;
    #0#0;
    #0#1;
    e;
    NULL, LiqCaja;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#5 ! "SI";  |ACABA;  |FINSI;

     |SI PARAMETRO = "";
         enEjer      = 2000 + #0#2;
         enPeriodo   = #eospa303#3;
         enActividad = 1;
     |FINSI;


     |ABRE #eosm0008;
     |LEE 040#eosm0008.p;
     |SI FSalida ! 0;  |DDEFECTO #eosm0008;  |FINSI;
     |CIERRA #eosm0008;

     |ABRE #9;
     |LEE 040#9p;
     |SI FSalida ! 0; |DDEFECTO #9; |FINSI;
     |CIERRA #9;

     |SI #9#13 = #9#14;  |Y #9#13 = #9#15;  |Y #9#13 ! 0;
         |MENAV "0000 Los Tipos de IVA de Adquisiones en el Control son iguales. Cambielos";
         |ACABA;
     |FINSI;

     nDAct = 1;
     nHAct = 6;
     |SI PARAMETRO ! "";
         nDAct = enActividad;
         nHAct = enActividad;
     |FINSI;

     |SI enEjer ] 2015;
         nHagoSub = 0;
         |SI #0#7 = "A";    nHagoSub = 1; |FINSI;
         |SI #0#7 = "T"; |Y #0#3 = 4;  nHagoSub = 1; |FINSI;
         |SI #0#7 = "D"; |O #0#7 = "M";
             |SI #0#3 = 12; nHagoSub = 1; |FINSI;
         |FINSI;

         |SI nHagoSub = 1;
             |ABRE #4;
             |SELECT #4#4;
             |BUCLE LiqCaja;
             |SELECT #1#4;
             |CIERRA #4;
         |FINSI;
     |FINSI;

     |ABRE #1;
     |ABRE #8;
     |ABRE #4;
     |ABRE #10;
     |ABRE #28;
     |BUCLE baja303;                 || Baja del 303
     |CIERRA #10;

     |ABRET #25;
     |ABRE #19;

     nImpre = 1;
     |SI PARAMETRO ! "";
         |SI aCampo51 ! "S";
             nImpre = 0;
         |FINSI;
     |FINSI;

     |SI nImpre = 1;
         |IMPRE 0;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |INFOR "dspas340";
         |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

         nPie = 0;
     |FINSI;

     |HAZ periodo;

     |SI nSubeIVA = 2;
         |SI #9#1 = 7;  |O #9#1 = 8;  #9#1 = 10; |FINSI;
         |SI #9#1 = 16; |O #9#1 = 18; #9#1 = 21; |FINSI;
         |SI #9#2 = 7;  |O #9#2 = 8;  #9#2 = 10; |FINSI;
         |SI #9#2 = 16; |O #9#2 = 18; #9#2 = 21; |FINSI;
         |SI #9#3 = 7;  |O #9#3 = 8;  #9#3 = 10; |FINSI;
         |SI #9#3 = 16; |O #9#3 = 18; #9#3 = 21; |FINSI;

         |SI #9#4 = 1;  #9#4 = 1.40; |FINSI;
         |SI #9#4 = 4;  #9#4 = 5.20; |FINSI;
         |SI #9#5 = 1;  #9#5 = 1.40; |FINSI;
         |SI #9#5 = 4;  #9#5 = 5.20; |FINSI;
         |SI #9#6 = 1;  #9#6 = 1.40; |FINSI;
         |SI #9#6 = 4;  #9#6 = 5.20; |FINSI;
     |SINO;
         |SI #9#4 = 1.40;  #9#4 = 1; |FINSI;
         |SI #9#4 = 5.20;  #9#4 = 4; |FINSI;
         |SI #9#5 = 1.40;  #9#5 = 1; |FINSI;
         |SI #9#5 = 5.20;  #9#5 = 4; |FINSI;
         |SI #9#6 = 1.40;  #9#6 = 1; |FINSI;
         |SI #9#6 = 5.20;  #9#6 = 4; |FINSI;

         |SI nSubeIVA = 1;
             |SI #9#1 = 7;  |O #9#1 = 10; #9#1 = 8;  |FINSI;
             |SI #9#1 = 16; |O #9#1 = 21; #9#1 = 18; |FINSI;
             |SI #9#2 = 7;  |O #9#2 = 10; #9#2 = 8;  |FINSI;
             |SI #9#2 = 16; |O #9#2 = 21; #9#2 = 18; |FINSI;
             |SI #9#3 = 7;  |O #9#3 = 10; #9#3 = 8;  |FINSI;
             |SI #9#3 = 16; |O #9#3 = 21; #9#3 = 18; |FINSI;
         |SINO;
             |SI #9#1 = 8;  |O #9#1 = 10; #9#1 = 7;  |FINSI;
             |SI #9#1 = 18; |O #9#1 = 21; #9#1 = 16; |FINSI;
             |SI #9#2 = 8;  |O #9#2 = 10; #9#2 = 7;  |FINSI;
             |SI #9#2 = 18; |O #9#2 = 21; #9#2 = 16; |FINSI;
             |SI #9#3 = 8;  |O #9#3 = 10; #9#3 = 7;  |FINSI;
             |SI #9#3 = 18; |O #9#3 = 21; #9#3 = 16; |FINSI;
         |FINSI;
     |FINSI;

     |ATRI I;
     |PINTA 2330,"PASANDO LAS COMPRAS";
     |ATRI 0;
     |BUCLE pasacomp;                 || Pasamos compras

     |BLIN 23;
     |ATRI I;
     |PINTA 2330,"PASANDO LAS VENTAS";
     |ATRI 0;
     |ABRE #18;

     |BUCLE pasavent;                 || Pasamos  ventas

     |CIERRA #18;
     |CIERRA #19;
     |CIERRAT #25;
     |CIERRA #8;
     |CIERRA #28;

     |BLIN 23;

     |BUCLE eosm1303;

     |CIERRA #1;
     |CIERRA #4;

     |SI nImpre = 1;
         |SI nPie = 1; |PIEINF; |FINSI;
         |FININF;
         |FINIMP;
         nPie = 0;
     |FINSI;
|FPRC;

|PROCESO Anula2014; |TIPO 0;
     |SI #0Campo ] 14;  |Y #0Campo [ 79;
         |MENAV "0000Mantenimiento en desuso, use el programa para 2014 y posteriores.";
         |ERROR;
     |FINSI;
|FPRC;

|PROGRAMA;

     |SI PARAMETRO = "";
         |CLS;
         |MANTE #0;
         |ACABA;
     |FINSI;

     |ABRE #eosactiv;
     #eosactiv#0 = enEmpresa;
     #eosactiv#1 = enActividad;
     #eosactiv#2 = enEjer - 2000;
     |LEE 000#eosactiv.=;
     aCampo51 = #eosactiv#51;
     |CIERRA #eosactiv;

     #eospa303#0 = enEmpresa;
     #eospa303#1 = enEmpresa;
     #eospa303#2 = enEjer - 2000;
     #eospa303#7 = "T";

     |SI #eosactiv#26 = "M";  |O #eosactiv#26 = "D";
         #eospa303#7 = "M";
     |FINSI;

     #eospa303#3 = enPeriodo;
     #eospa303#4 = "F";
     |SI #eospa303#7 = "T";
         |SI enPeriodo = 3;  #eospa303#3 = 1;  |FINSI;
         |SI enPeriodo = 6;  #eospa303#3 = 2;  |FINSI;
         |SI enPeriodo = 9;  #eospa303#3 = 3;  |FINSI;
         |SI enPeriodo = 12; #eospa303#3 = 4;  |FINSI;

         #eospa303#4 = "T";
     |FINSI;

     #eospa303#5 = "SI";
     #eospa303#6 = 2;  ||Tique 2444 _ 585 Intracomunitarias desde Soportado

     aAlfa = ":agieos/dsmo3401;";
     aAlfa = aAlfa + (("00000" + enEmpresa) % -105);   || Empresa
     aAlfa = aAlfa + enEjer;                       || Ejercicio
     aAlfa = aAlfa + (("00" + enPeriodo) % -102);  || Periodo
     aAlfa = aAlfa + "340";                        || Modelo
     aAlfa = aAlfa + "00";                         || Complemento
     aAlfa = aAlfa + ("00" + enActividad) % -102;  || Actividad
     aAlfa = aAlfa + "03";                         || Tipo de entrada
     aAlfa = aAlfa + "0";                          || Mensaje
     |SUB_EJECUTA_NP aAlfa;

     |HAZ Tipo3;

     |HAZ ConvierteModelo;
|FPRO;
