|FICHEROS;
     eosp2390 #0;
     eosm3390 #1;
     eosactiv #2;
     eosm1300 #3;
     eosm1303 #303;
     eosm4390 #4;
     eosclien #7;
     eoscapro #8;
     eosma330 #9;
     eosaggan #10;
     eosopesp #11;
     eosopes2 #21;
     eosm0017 #12;
     eosm0018 #13;
     eosm0019 #14;
     eosagga1 #15;
     eoselepi #16;
     eosma100 #100;
     desglose@  #1100;
|FIN;

|VARIABLES;
     &d_empre    = 0;
     &h_empre    = 0;
     &el_anyo    = 0;
     &sw_sit     = 0;
     &Empresa    = 0;

     LetraEpi    = "";
     FEstado     = 0;
     Dias        = 0;
     z           = 0;
     x           = 0;
     xxx         = 0;
     yyy         = 0;
     zzz         = 0;
     y1          = 0;
     y2          = 0;
     y3          = 0;
     y4          = 0;
     y5          = 0;
     y6          = 0;
     y           = 0;
     c_base      = 0;
     c_cuota     = 0;
     sw_estar    = 0;
     contador    = 0;
     campomas1   = 0;
     campomas2   = 0;
     campomas3   = 0;
     campomas4   = 0;
     campomas5   = 0;
     campomas6   = 0;
     campomas7   = 0;
     campomas8   = 0;
     campomas9   = 0;
     campomas10  = 0;
     campomas11  = 0;
     campomas12  = 0;
     campomas13  = 0;
     elegido     = 0;
     total       = 0;
     sw_pasa     = 0;
     mmm         = 0;
     nnn         = 0;
     ppp         = 0;
     rrr         = 0;

     nCampo      = 0;
     nCampoB     = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nCampo4     = 0;
     nCampo5     = 0;
     nCampo6     = 0;
     nCampo7     = 0;
     nCampo8     = 0;
     nCLoteria   = 0;
     nBLoteria   = 0;

     nConver     = 0;

     nNume      = 0;
     nFactor    = 0;
     nCont      = 0;
     nActividad = 0;
     nEjer      = 0;
     nPara1     = 0;
     nPara2     = 0;
     nPara3     = 0;
     nPara11    = 0;
     nPara22    = 0;
     nPara33    = 0;
     nCampo303  = 0;
     nCampo390  = 0;
     nSwAcum    = 0;

     aAlfa      = "";
     aBase      = "";
     aMas       = "";
     nIVA   = 0;
     nBase  = 0;
     nCuota = 0;
     nHay   = 0;

     nSwAq     = 0;
     nSwRe     = 0;
     nSwRe1    = 0;
     nSwSo1    = 0;
     aLorca    = "";
     aLorca11  = "";
     nImpor12  = 0;
     nImpor11  = 0;
     nNume1    = 0;
|FIN;

|INCLUYE i_anyode;
|INCLUYE i_consul;

|PROCESO pinta_anyo; |TIPO 7;
     |HAZ i_anyodef;
     #0#2 = i_anyodef - 1;
     |SI #0#2 = -1;  #0#2 = 99;  |FINSI;
     |PINTA #0#2;
|FPRC;

|| ----------------\    BORRADO DE LOS 390 SELECCIONADOS
||                  \------------------------------------------------------

|PROCESO Borrar01;
     #4#0 = #1#0; #4#1 = #1#1;
     |LEE 000#4=;
     |SI FSalida = 0; |BORRA 020#4c; |FINSI;
     |BORRA 020#1c;
     |LIBERA #1;
|FPRC;

|DEFBUCLE eosm3390B;
     #1#1;
     ;
     d_empre, el_anyo;
     h_empre, el_anyo;
     be;
     NULL, Borrar01;
|FIN;

|| ----------------\    RECALCULO DEL RESULTADO MULTIPLE PERIODO
||                  \------------------------------------------------------

|PROCESO Recalculo300;
     Empresa = #7#0;
     |SUB_EJECUTA "eosre300";
|FPRC;

|DEFBUCLE eosclien;
     #7#1;
     60;
     d_empre, "S";
     h_empre, "S";
     e;
     NULL, Recalculo300;
|FIN;


|| ----------------\    CARGA LAS BASES Y CUOTAS DEL 300
||                  \------------------------------------------------------

|PROCESO Carga1;
     |SI x ] 59;
         |SI #3x = 4;   #1#53  = #1#53  + #3c_base; #1#54  = #1#54  + #3c_cuota; |FINSI;
         |SI #3x = 7;   #1#176 = #1#176 + #3c_base; #1#177 = #1#177 + #3c_cuota; |FINSI;
         |SI #3x = 16;  #1#178 = #1#178 + #3c_base; #1#179 = #1#179 + #3c_cuota; |FINSI;
         |ACABA;
     |FINSI;

     |SI x = 15; |O x = 18; |O x = 47;
         |SI #3x = 0.5;  #1#59  = #1#59  + #3c_base; #1#60  = #1#60  + #3c_cuota; |FINSI;
         |SI #3x = 1;    #1#61  = #1#61  + #3c_base; #1#62  = #1#62  + #3c_cuota; |FINSI;
         |SI #3x = 4;    #1#63  = #1#63  + #3c_base; #1#64  = #1#64  + #3c_cuota; |FINSI;
         |SI #3x = 1.75; #1#184 = #1#184 + #3c_base; #1#185 = #1#185 + #3c_cuota; |FINSI;
         |ACABA;
     |FINSI;

     |SI #2#29 = 1;
        |SI #3x = 4;  #1#33 = #1#33 + #3c_base; #1#34 = #1#34 + #3c_cuota; |FINSI;
        |SI #3x = 7;  #1#35 = #1#35 + #3c_base; #1#36 = #1#36 + #3c_cuota; |FINSI;
        |SI #3x = 16; #1#37 = #1#37 + #3c_base; #1#38 = #1#38 + #3c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 2;
        |SI #3x = 4;  #1#39 = #1#39 + #3c_base; #1#40 = #1#40 + #3c_cuota; |FINSI;
        |SI #3x = 7;  #1#41 = #1#41 + #3c_base; #1#42 = #1#42 + #3c_cuota; |FINSI;
        |SI #3x = 16; #1#43 = #1#43 + #3c_base; #1#44 = #1#44 + #3c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 3;
        |SI #3x = 4;  #1#39 = #1#39 + #3c_base; #1#40 = #1#40 + #3c_cuota; |FINSI;
        |SI #3x = 7;  #1#41 = #1#41 + #3c_base; #1#42 = #1#42 + #3c_cuota; |FINSI;
        |SI #3x = 16; #1#43 = #1#43 + #3c_base; #1#44 = #1#44 + #3c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 4;
        |SI #3x = 16; #1#45 = #1#45 + #3c_base; #1#46 = #1#46 + #3c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 5;
        |SI #3x = 4;  #1#47 = #1#47 + #3c_base; #1#48 = #1#48 + #3c_cuota; |FINSI;
        |SI #3x = 7;  #1#49 = #1#49 + #3c_base; #1#50 = #1#50 + #3c_cuota; |FINSI;
        |SI #3x = 16; #1#51 = #1#51 + #3c_base; #1#52 = #1#52 + #3c_cuota; |FINSI;
     |FINSI;
|FPRC;

|| ----------------\    CARGA LAS DEDUCCIONES DEL 300
||                  \------------------------------------------------------

|PROCESO Carga2;
     #1#188 = #1#188 + #3#70;
     #1#189 = #1#189 + #3#75;
     #1#190 = #1#190 + #3#71;
     #1#191 = #1#191 + #3#76;
     #1#192 = #1#192 + #3#72;
     #1#193 = #1#193 + #3#77;
     #1#194 = #1#194 + #3#73;

     #1#68 = #1#68 + #3#21;
     #1#69 = #1#69 + #3#43;
     #1#70 = #1#70 + #3#22;
     #1#71 = #1#71 + #3#44;
     #1#72 = #1#72 + #3#51;
     #1#73 = #1#73 + #3#78;
     #1#74 = #1#74 + #3#23;
     #1#75 = #1#75 + #3#24;
|FPRC;

|| ----------------\    CARGA LAS BASES Y CUOTAS DEL 303
||                  \------------------------------------------------------
|PROCESO PongoCampos;
    |SI nEjer < 2012;
        |SI #2#29 = 1;
            |SI nIVA = 4;  #1#33 = #1#33 + nBase; #1#34 = #1#34 + nCuota; |FINSI;
            |SI nIVA = 7;  #1#35 = #1#35 + nBase; #1#36 = #1#36 + nCuota; |FINSI;
            |SI nIVA = 16; #1#37 = #1#37 + nBase; #1#38 = #1#38 + nCuota; |FINSI;
            |SI nIVA = 8;  #4#90 = #4#90 + nBase; #4#91 = #4#91 + nCuota; |FINSI;
            |SI nIVA = 18; #4#92 = #4#92 + nBase; #4#93 = #4#93 + nCuota; |FINSI;
         |FINSI;

         |SI #2#29 = 2; |O #2#29 = 3;
            |SI nIVA = 4;  #1#39 = #1#39 + nBase; #1#40 = #1#40 + nCuota; |FINSI;
            |SI nIVA = 7;  #1#41 = #1#41 + nBase; #1#42 = #1#42 + nCuota; |FINSI;
            |SI nIVA = 16; #1#43 = #1#43 + nBase; #1#44 = #1#44 + nCuota; |FINSI;

            |SI nIVA = 8;  #4#98  = #4#98  + nBase; #4#99  = #4#99 + nCuota; |FINSI;
            |SI nIVA = 18; #4#100 = #4#100 + nBase; #4#101 = #4#101 + nCuota; |FINSI;
         |FINSI;

         |SI #2#29 = 4;
            |SI nIVA = 16; #1#45  = #1#45  + nBase; #1#46  = #1#46  + nCuota; |FINSI;
            |SI nIVA = 18; #4#102 = #4#102 + nBase; #4#103 = #4#103 + nCuota; |FINSI;
         |FINSI;

         |SI #2#29 = 5;
            |SI nIVA = 4;  #1#47 = #1#47 + nBase; #1#48 = #1#48 + nCuota; |FINSI;
            |SI nIVA = 7;  #1#49 = #1#49 + nBase; #1#50 = #1#50 + nCuota; |FINSI;
            |SI nIVA = 16; #1#51 = #1#51 + nBase; #1#52 = #1#52 + nCuota; |FINSI;

            |SI nIVA = 8;  #4#94  = #4#94  + nBase; #4#95  = #4#95 + nCuota; |FINSI;
            |SI nIVA = 18; #4#96  = #4#96  + nBase; #4#97  = #4#97 + nCuota; |FINSI;
         |FINSI;
    |SINO;
        |SI x ! 15; |Y x ! 18; |Y x ! 47;
            |SI #2#29 = 1;
                |SI nIVA = 4;  #1#33 = #1#33 + nBase; #1#34 = #1#34 + nCuota; |FINSI;
                |SI nIVA = 10; #1#35 = #1#35 + nBase; #1#36 = #1#36 + nCuota; |FINSI;
                |SI nIVA = 21; #1#37 = #1#37 + nBase; #1#38 = #1#38 + nCuota; |FINSI;
                |SI nIVA =  8; #4#90 = #4#90 + nBase; #4#91 = #4#91 + nCuota; |FINSI;
                |SI nIVA = 18; #4#92 = #4#92 + nBase; #4#93 = #4#93 + nCuota; |FINSI;
             |FINSI;

             |SI #2#29 = 2; |O #2#29 = 3;
                |SI nIVA = 4;  #1#39 = #1#39 + nBase; #1#40 = #1#40 + nCuota; |FINSI;
                |SI nIVA = 10; #1#41 = #1#41 + nBase; #1#42 = #1#42 + nCuota; |FINSI;
                |SI nIVA = 21; #1#43 = #1#43 + nBase; #1#44 = #1#44 + nCuota; |FINSI;

                |SI nIVA = 8;  #4#98  = #4#98  + nBase; #4#99  = #4#99 + nCuota; |FINSI;
                |SI nIVA = 18; #4#100 = #4#100 + nBase; #4#101 = #4#101 + nCuota; |FINSI;
             |FINSI;

             |SI #2#29 = 4;
                |SI nIVA = 21; #1#45  = #1#45  + nBase; #1#46  = #1#46  + nCuota; |FINSI;
                |SI nIVA = 18; #4#102 = #4#102 + nBase; #4#103 = #4#103 + nCuota; |FINSI;
             |FINSI;

             |SI #2#29 = 5;
                |SI nIVA =  4; #1#47 = #1#47 + nBase; #1#48 = #1#48 + nCuota; |FINSI;
                |SI nIVA = 10; #1#49 = #1#49 + nBase; #1#50 = #1#50 + nCuota; |FINSI;
                |SI nIVA = 21; #1#51 = #1#51 + nBase; #1#52 = #1#52 + nCuota; |FINSI;

                |SI nIVA = 8;  #4#94  = #4#94  + nBase; #4#95  = #4#95 + nCuota; |FINSI;
                |SI nIVA = 18; #4#96  = #4#96  + nBase; #4#97  = #4#97 + nCuota; |FINSI;
             |FINSI;

             |SI nIVA ! 4; |Y nIVA ! 8; |Y nIVA ! 10;
             |Y nIVA ! 18; |Y nIVA ! 21;
                 |SI nIVA = 7; |O nIVA = 16;
                     |SI nBase ! 0; |O nCuota ! 0;
                         nSwRe = 1;
                         #1#55 = #1#55 + nBase;
                         #1#56 = #1#56 + nCuota;
                     |FINSI;
                 |SINO;
                     |SI nBase ! 0; |O nCuota ! 0;
                         nSwRe1 = 1;
                     |FINSI;
                 |FINSI;
              |FINSI;
         |SINO;
             |SI nIVA = 0.5;  #1#59  = #1#59  + nBase; #1#60  = #1#60  + nCuota; |FINSI;
             |SI nIVA = 1;    #1#61  = #1#61  + nBase; #1#62  = #1#62  + nCuota; |FINSI;
             |SI nIVA = 4;    #1#63  = #1#63  + nBase; #1#64  = #1#64  + nCuota; |FINSI;
             |SI nIVA = 1.75; #1#184 = #1#184 + nBase; #1#185 = #1#185 + nCuota; |FINSI;

             |SI nIVA = 1.40; #4#126 = #4#126 + nBase; #4#127 = #4#127 + nCuota; |FINSI;
             |SI nIVA = 5.20; #4#128 = #4#128 + nBase; #4#129 = #4#129 + nCuota; |FINSI;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO Leo100_303;
     nHay = 0;
     |DDEFECTO #1100;
     #1100#0 = "303";
     #1100#1 = #303#0;
     #1100#2 = #303#45;
     #1100#3 = #303#1;
     #1100#4 = #303#2;
     #1100#5 = nCampo303;
     |LEE 041#1100=;
     |SI FSalida ! 0;
         nHay = 1;
     |FINSI;
|FPRC;

|PROCESO Carga1_303;
     |SI x ] 59;
         |SI nEjer < 2012;
             |SI #303x = 4;   #1#53  = #1#53  + #303c_base; #1#54  = #1#54  + #303c_cuota; |FINSI;
             |SI #303x = 7;   #1#176 = #1#176 + #303c_base; #1#177 = #1#177 + #303c_cuota; |FINSI;
             |SI #303x = 16;  #1#178 = #1#178 + #303c_base; #1#179 = #1#179 + #303c_cuota; |FINSI;
             |SI #303x = 8;   #4#104 = #4#104 + #303c_base; #4#105 = #4#105 + #303c_cuota; |FINSI;
             |SI #303x = 18;  #4#106 = #4#106 + #303c_base; #4#107 = #4#107 + #303c_cuota; |FINSI;
         |SINO;
             |SI #303x = 4;   #1#53  = #1#53  + #303c_base; #1#54  = #1#54  + #303c_cuota; |FINSI;
             |SI #303x = 10;  #1#176 = #1#176 + #303c_base; #1#177 = #1#177 + #303c_cuota; |FINSI;
             |SI #303x = 21;  #1#178 = #1#178 + #303c_base; #1#179 = #1#179 + #303c_cuota; |FINSI;
             |SI #303x =  8;  #4#104 = #4#104 + #303c_base; #4#105 = #4#105 + #303c_cuota; |FINSI;
             |SI #303x = 18;  #4#106 = #4#106 + #303c_base; #4#107 = #4#107 + #303c_cuota; |FINSI;

             |SI #303x ! 4; |Y #303x ! 10; |Y #303x ! 21;
                 |Y #303x ! 8; |Y #303x ! 18;
                    |SI #303x = 7; |O #303x = 16;
                        |SI #303c_base ! 0; |O #303c_cuota ! 0;
                             nSwAq = 1;
                             #1#55 = #1#55 + #303c_base;
                             #1#56 = #1#56 + #303c_cuota;
                        |FINSI;
                    |SINO;
                        |SI #303c_base ! 0; |O #303c_cuota ! 0;
                            nSwRe1 = 1;
                        |FINSI;
                    |FINSI;
             |FINSI;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI nEjer < 2012;
         |SI x = 15; |O x = 18; |O x = 47;
             |SI #303x = 0.5;  #1#59  = #1#59  + #303c_base; #1#60  = #1#60  + #303c_cuota; |FINSI;
             |SI #303x = 1;    #1#61  = #1#61  + #303c_base; #1#62  = #1#62  + #303c_cuota; |FINSI;
             |SI #303x = 4;    #1#63  = #1#63  + #303c_base; #1#64  = #1#64  + #303c_cuota; |FINSI;
             |SI #303x = 1.75; #1#184 = #1#184 + #303c_base; #1#185 = #1#185 + #303c_cuota; |FINSI;
             |ACABA;
         |FINSI;
     |FINSI;

     nHay = 1;
     |SI #303#2 ] 10;
         nCampo303 = c_base;
         |HAZ Leo100_303;
     |FINSI;

    |SI nHay = 1;
        nIVA   = #303x;
        nBase  = #303c_base;
        nCuota = #303c_cuota;
        |HAZ PongoCampos;
    |SINO;
        |PARA nPara11 = 6;  |SI nPara11 [ 21;  |HACIENDO nPara11 = nPara11 + 3;
              nPara22 = nPara11 + 1;
              nPara33 = nPara11 + 2;

              nBase  = #1100nPara11;
              nIVA   = #1100nPara22;
              nCuota = #1100nPara33;
              |HAZ PongoCampos;

         |SIGUE;
    |FINSI;
|FPRC;

|PROCESO Busca100;
     nSwAcum = 0;

     |PARA nPara11 = 6;  |SI nPara11 [ 21;  |HACIENDO nPara11 = nPara11 + 3;
           nPara22 = nPara11 + 1;
           nPara33 = nPara11 + 2;

           |SI #1100nPara2 = #100nPara22;
               #100nPara11 = #100nPara11 + #1100nPara1;
               #100nPara22 = #1100nPara2;
               #100nPara33 = #100nPara33 + #1100nPara3;
               nSwAcum = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nSwAcum = 1;  |ACABA;  |FINSI;

     |PARA nPara11 = 6;  |SI nPara11 [ 21;  |HACIENDO nPara11 = nPara11 + 3;
           nPara22 = nPara11 + 1;
           nPara33 = nPara11 + 2;

           |SI #100nPara11 = 0;  |Y #100nPara22 = 0;  |Y #100nPara33 = 0;
               #100nPara11 = #1100nPara1;
               #100nPara22 = #1100nPara2;
               #100nPara33 = #1100nPara3;
               |SAL;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO GrabaDes390;
     #1100#0 = "303";
     #1100#1 = #303#0;
     #1100#2 = #303#45;
     #1100#3 = #303#1;
     #1100#4 = #303#2;
     #1100#5 = nCampo303;
     |LEE 000#1100=;
     |SI FSalida ! 0;  |DDEFECTO #1100;  |FINSI;

     #100#0 = "390";
     #100#1 = #303#0;
     #100#2 = 0;
     #100#3 = 99;
     #100#4 = #0#2;
     #100#5 = nCampo390;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = "390";
         #100#1 = #303#0;
         #100#2 = 0;
         #100#3 = 99;
         #100#4 = #0#2;
         #100#5 = nCampo390;
         |GRABA 020#100b;
     |FINSI;

     |PARA nPara1 = 6;  |SI nPara1 [ 21;  |HACIENDO nPara1 = nPara1 + 3;
           nPara2 = nPara1 + 1;
           nPara3 = nPara1 + 2;

           |SI #1100nPara1 ! 0;  |O #1100nPara3 ! 0;

               |SI #1100nPara2 ! 4; |Y #1100nPara2 ! 7; |Y #1100nPara2 ! 8;
                     |Y #1100nPara2 ! 10; |Y #1100nPara2 ! 16;
                     |Y #1100nPara2 ! 18; |Y #1100nPara2 ! 21;
                     nSwSo1 = 1;
               |FINSI;

               |HAZ Busca100;
           |FINSI;
     |SIGUE;

     |GRABA 020#100a;
     |LIBERA #100;
|FPRC;

|PROCESO Carga2_303;
     #1#188 = #1#188 + #303#70;
     #1#189 = #1#189 + #303#75;
     #1#190 = #1#190 + #303#71;
     #1#191 = #1#191 + #303#76;
     #1#192 = #1#192 + #303#72;
     #1#193 = #1#193 + #303#77;
     #1#194 = #1#194 + #303#73;

     #1#68  = #1#68  + #303#21;
     #1#69  = #1#69  + #303#43;
     #1#70  = #1#70  + #303#22;
     #1#71  = #1#71  + #303#44;
     #1#72  = #1#72  + #303#51;
     #1#73  = #1#73  + #303#78;
     #1#74  = #1#74  + #303#23;
     #1#75  = #1#75  + #303#24;

     nCampo303 = 70;  nCampo390 = 188;  |HAZ GrabaDes390;
     nCampo303 = 75;  nCampo390 = 189;  |HAZ GrabaDes390;
     nCampo303 = 71;  nCampo390 = 190;  |HAZ GrabaDes390;
     nCampo303 = 76;  nCampo390 = 191;  |HAZ GrabaDes390;
     nCampo303 = 72;  nCampo390 = 192;  |HAZ GrabaDes390;
     nCampo303 = 77;  nCampo390 = 193;  |HAZ GrabaDes390;
|FPRC;

|| ----------------\    CARGA BASES Y CUOTAS DEL 330
||                  \------------------------------------------------------

|PROCESO Carga1_9;
     |SI x ] 70;
         |SI #9x = 4;   #1#53  = #1#53  + #9c_base; #1#54  = #1#54  + #9c_cuota; |FINSI;
         |SI #9x = 7;   #1#176 = #1#176 + #9c_base; #1#177 = #1#177 + #9c_cuota; |FINSI;
         |SI #9x = 16;  #1#178 = #1#178 + #9c_base; #1#179 = #1#179 + #9c_cuota; |FINSI;
         |ACABA;
     |FINSI;

     |SI x = 17; |O x = 20; |O x = 23;
        |SI #9x = 0.5;  #1#59  = #1#59  + #9c_base; #1#60  = #1#60  + #9c_cuota; |FINSI;
        |SI #9x = 1;    #1#61  = #1#61  + #9c_base; #1#62  = #1#62  + #9c_cuota; |FINSI;
        |SI #9x = 4;    #1#63  = #1#63  + #9c_base; #1#64  = #1#64  + #9c_cuota; |FINSI;
        |SI #9x = 1.75; #1#184 = #1#184 + #9c_base; #1#185 = #1#185 + #9c_cuota; |FINSI;
        |ACABA;
     |FINSI;

     |SI #2#29 = 1;
        |SI #9x = 4;  #1#33 = #1#33 + #9c_base; #1#34 = #1#34 + #9c_cuota; |FINSI;
        |SI #9x = 7;  #1#35 = #1#35 + #9c_base; #1#36 = #1#36 + #9c_cuota; |FINSI;
        |SI #9x = 16; #1#37 = #1#37 + #9c_base; #1#38 = #1#38 + #9c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 2;
        |SI #9x = 4;  #1#39 = #1#39 + #9c_base; #1#40 = #1#40 + #9c_cuota; |FINSI;
        |SI #9x = 7;  #1#41 = #1#41 + #9c_base; #1#42 = #1#42 + #9c_cuota; |FINSI;
        |SI #9x = 16; #1#43 = #1#43 + #9c_base; #1#44 = #1#44 + #9c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 3;
        |SI #9x = 4;  #1#39 = #1#39 + #9c_base; #1#40 = #1#40 + #9c_cuota; |FINSI;
        |SI #9x = 7;  #1#41 = #1#41 + #9c_base; #1#42 = #1#42 + #9c_cuota; |FINSI;
        |SI #9x = 16; #1#43 = #1#43 + #9c_base; #1#44 = #1#44 + #9c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 4;
        |SI #9x = 16; #1#45 = #1#45 + #9c_base; #1#46 = #1#46 + #9c_cuota; |FINSI;
     |FINSI;

     |SI #2#29 = 5;
        |SI #9x = 4;  #1#47 = #1#47 + #9c_base; #1#48 = #1#48 + #9c_cuota; |FINSI;
        |SI #9x = 7;  #1#49 = #1#49 + #9c_base; #1#50 = #1#50 + #9c_cuota; |FINSI;
        |SI #9x = 16; #1#51 = #1#51 + #9c_base; #1#52 = #1#52 + #9c_cuota; |FINSI;
     |FINSI;
|FPRC;

|| ----------------\    CARGA LAS DEDUCCIONES DEL 330
||                  \------------------------------------------------------

|PROCESO Carga2_9;
     #1#188 = #1#188 + #9#28;
     #1#189 = #1#189 + #9#36;
     #1#190 = #1#190 + #9#30;
     #1#191 = #1#191 + #9#38;
     #1#192 = #1#192 + #9#32;
     #1#194 = #1#194 + #9#81;

     #1#68 = #1#68 + #9#29;
     #1#69 = #1#69 + #9#37;
     #1#70 = #1#70 + #9#31;
     #1#71 = #1#71 + #9#39;
     #1#72 = #1#72 + #9#33;
     #1#74 = #1#74 + #9#34;
     #1#75 = #1#75 + #9#35;
|FPRC;

|| ----------------\    RECOGE EL PORCENTAJE DE Porrata
||                  \------------------------------------------------------

|PROCESO Porrata;
     |ABRE #8;
     #8#0 = #2#0;
     #8#1 = #2#2;
     #8#2 = #2#1;
     |LEE 040#8=;
     |SI FSalida = 0;
        |SI #8#8 ! 100; #1#31 = #8#8; |FINSI;
     |SINO;
        |SI #2#28 ! 0;
            #1#31 = #2#28;
        |FINSI;
     |FINSI;

     |SI #1#31 ! 0;   #1#30 = "X";   |SINO; #1#30 = " "; |FINSI;
     |SI #1#32 = " "; #1#32 = #2#45; |FINSI;

     |CIERRA #8;
|FPRC;

|| ----------------\    BUSCA UN HUECO PARA LA INTRODUCCION DE LOS NUMEROS
||                  \------------------------------------------------------

|PROCESO BuscaHueco;
     elegido = 0;
     |PARA x = 78; |SI x [ 101; |Y elegido = 0; |HACIENDO x = x + 11;
         campomas1 = x + 1;
         campomas2 = x + 2;
         campomas3 = x + 3;
         campomas4 = x + 4;
         |SI #1x = " "; |Y #1campomas1 = "    "; |Y #1campomas2 = 0;
          |Y #1campomas3 = 0; |Y #1campomas4 = 0;
             elegido = x;
             |SAL;
         |FINSI;
     |SIGUE;
|FPRC;

|| ----------------\    CARGA LOS EPIGRAFES DE LA DECLARACION
||                  \----------------------------------------

|PROCESO Pantalla1;  || Carga los epigrafes de la declaracion
     LetraEpi = #2#4;
     |SI #2#4 = "X"; |O #2#4 = "Z";
          LetraEpi = " ";
     |FINSI;
     sw_estar = 0;
     |PARA x = 17; |SI x [ 22; |HACIENDO x = x + 1;
         y = x + 6;
         z = x - 12;
         |SI #1x = LetraEpi; |Y #1y = #2#5; |Y #1z = #2#6; sw_estar = 1; |SAL; |FINSI;
     |SIGUE;

     |SI sw_estar = 1; |ACABA; |FINSI;

     |PARA x = 17; |SI x [ 22; |HACIENDO x = x + 1;
           y1 = x + 6;
           y2 = x - 12;
           y3 = x - 6;

          |SI #1x = " "; |Y #1y1 = "    ";
              #1x  = LetraEpi;
              #1y1 = #2#5;
              #1y2 = #2#6;
              #1y3 = #2#43;
              |HAZ Porrata;
              |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|| ----------------\    CARGA BASE IMPONIBLES, CUOTAS Y DEDUCCIONES DEL 300
||                  \------------------------------------------------------

|PROCESO Pantalla2;
     |PARA x = 6; |SI x [ 18; |HACIENDO x = x + 3;
         c_base  = x - 1;
         c_cuota = x + 1;
         |SI nEjer [ 2008;
             |HAZ Carga1;
         |SINO;
             |HAZ Carga1_303;
         |FINSI;
     |SIGUE;

     |PARA x = 59; |SI x [ 68; |HACIENDO x = x + 3;
         c_base  = x - 1;
         c_cuota = x + 1;
         |SI nEjer [ 2008;
             |HAZ Carga1;
         |SINO;
             |HAZ Carga1_303;
         |FINSI;
     |SIGUE;

     x       = 47;
     c_base  = x - 1;
     c_cuota = x + 1;

     |SI nEjer [ 2008;
         |HAZ Carga1;
         |HAZ Carga2;
     |SINO;
         |HAZ Carga1_303;
         |HAZ Carga2_303;
     |FINSI;
|FPRC;

|| ----------------\    CARGA OPERACIONES ESPECIFICAS DEL 300
||                  \------------------------------------------------------

|PROCESO Pantalla3;

     #1#57  =          #1#33  + #1#35  + #1#37  + #4#90  + #4#92;
     #1#57  = #1#57  + #1#47  + #1#49  + #1#51  + #4#94  + #4#96;
     #1#57  = #1#57  + #1#39  + #1#41  + #1#43  + #4#98  + #4#100;
     #1#57  = #1#57  + #1#45  + #4#102;
     #1#57  = #1#57  + #1#53  + #1#176 + #1#178 + #4#104 + #4#106;
     #1#57  = #1#57  + #4#108 + #4#110 + #4#112 + #4#114 + #4#116;
     #1#57  = #1#57  + #1#180 + #1#55  + #1#182;

     |SI nEjer < 2009;
         #1#161 = #1#57 - (#1#53 + #1#176 + #1#178 + #4#104 + #4#106) - #1#180;
     |SINO;
         #1#161 =          #1#33 + #1#35 + #1#37 + #4#90 + #4#92; || Regimen ordinario + intergrupo
         #1#161 = #1#161 + #1#47 + #1#49 + #1#51 + #4#94 + #4#96; || Regimen ordinario + intergrupo
         #4#61  = #1#39 + #1#41 + #1#43 + #4#98 + #4#100;
         #4#62  = #1#45 + #4#102;
     |FINSI;
|FPRC;

|| ----------------\    CARGA BASE, CUOTAS Y DEDUCCIONES DEL 330
||                  \------------------------------------------------------

|PROCESO Pantalla2_9;
     |PARA x = 70; |SI x [ 79; |HACIENDO x = x + 3;
         c_base  = x - 1;
         c_cuota = x + 1;
         |HAZ Carga1_9;
     |SIGUE;

     |PARA x = 8; |SI x [ 23; |HACIENDO x = x + 3;
         c_base  = x - 1;
         c_cuota = x + 1;
         |HAZ Carga1_9;
     |SIGUE;

     |HAZ Carga2_9;
|FPRC;

|| ----------------\    CARGA OPERACIONES ESPECIFICAS DEL 330
||                  \------------------------------------------------------

|PROCESO Pantalla3_9;
     #1#57  = #1#33  + #1#35 + #1#37 + #1#39 + #1#41 + #1#43 + #1#45 + #1#47;
     #1#57  = #1#57 + #1#49 + #1#51 + #1#53 + #1#55 + #1#176 + #1#178;
     |SI nEjer < 2009;
         #1#161 = #1#57 - (#1#53 + #1#176 + #1#178) - #1#180;
     |SINO;
         #1#161 = #1#33 + #1#35 + #1#37 + #1#47 + #1#49 + #1#51; || Regimen ordinario + intergrupo
         #4#61  = #1#39 + #1#41 + #1#43;
         #4#62  = #1#45;
     |FINSI;
|FPRC;

|| ----------------\    RECALCULA TODO EL 390
||                  \------------------------------------------------------

|PROCESO Total390;             || Totaliza el 390

     #1#058 =          #1#034 + #1#036 + #1#038 + #4#091 + #4#093;
     #1#058 = #1#058 + #1#048 + #1#050 + #1#052 + #4#095 + #4#097;
     #1#058 = #1#058 + #1#040 + #1#042 + #1#044 + #4#099 + #4#101;
     #1#058 = #1#058 + #1#046 + #4#103;
     #1#058 = #1#058 + #1#054 + #1#177 + #1#179 + #4#105 + #4#107;
     #1#058 = #1#058 + #4#109 + #4#111 + #4#113 + #4#115 + #4#117;
     #1#058 = #1#058 + #1#181 + #1#056 + #1#183;

     #1#067 = #1#058 + #1#060 + #1#062 + #1#064 + #1#066 + #1#185 + #1#187 + #4#127 + #4#129;
     #1#076 = #1#068 + #1#069 + #1#070 + #1#071 + #1#072 + #1#073 + #1#074 + #1#075;
     #1#077 = #1#067 - #1#076;
     |SI el_anyo ] 0;  |Y el_anyo [ 80;
         #1#135 = #1#088 + #1#099 + #1#110 + #1#249 + #1#250 + #1#251 + #1#252 + #1#253;
     |SINO;
         |SI el_anyo [ 97;
             #1#135 = #1#088 + #1#099 + #1#110 + #1#131 + #1#132 + #1#133 + #1#134;
             #1#137 = #1#135 - #1#136;
         |SINO;
             #1#135 = #1#088 + #1#099 + #1#110 + #1#249 + #1#250 + #1#251 + #1#252 + #1#253;
         |FINSI;
     |FINSI;

     #1#141 = #1#135 + #1#138 + #1#139 + #1#140;
     #1#144 = #1#142 + #1#143;

     #1#145 = #1#141 - #1#144;
     #1#146 = #1#77  + #1#145;
     #1#148 = #1#146 - #1#147;
     |SI #1#149 ! 0;
         #1#154 = #1#146 % #1#149;
         |SI #1#147 ! 0; #1#155 = #1#147; |FINSI;
         #1#156 = #1#154 - #1#155;
         #1#146 = 0;
         #1#147 = 0;
     |SINO;
         #1#154 = 0;
         #1#155 = 0;
         #1#156 = 0;
     |FINSI;

     |SI nEjer < 2009;
         #1#161 = #1#57 - (#1#53 + #1#176 + #1#178) - #1#180;
     |SINO;
         #1#161 = #1#33 + #1#35 + #1#37 + #4#90 + #4#92 + #1#47 + #1#49 + #1#51 + #4#94 + #4#96; || Regimen ordinario + intergrupo
         #4#61  = #1#39 + #1#41 + #1#43 + #4#98 + #4#100;
         #4#62  = #1#45;
     |FINSI;
     |SI nEjer [ 2005;
         #1#170 = #1#161 + #1#162 + #1#163 + #1#164 + #1#165 + #1#166 + #1#167 - #1#168 - #1#169;
     |SINO;
         #1#170 = #1#161 + #1#165 + #1#166 + #1#167 + #1#172 + #1#174 + #1#162;
         #1#170 = #1#170 + #1#163 + #1#164 + #4#61  + #4#62  - #1#168 - #1#169;
     |FINSI;
|FPRC;

|| ----------------\    CARGA DATOS DEL 300
||                  \------------------------------------------------------

|PROCESO Fichero3;
     |SI #3#3 = "          "; |Y #0#5 = "S";
         |PUSHV 0531 2380;
         |D_CUADRO 1509, 2067;
         |ATRI R;
         |BLANCO 1610 1966;
         |PINTA 1610, "Empresa ..: ";
         |PINTA 1710, "Actividad :        Periodo ...:  ";
         |PINTA 1810, "Modelo ...: 300";
         |PINTA 1622, #3#0;
         |PINTA 1722, #3#45;
         |PINTA 1742, #3#1;
         |PINTA 1910, "         MODELO NO IMPRESO";
         |ATRI 0;
         |PAUSA;
         |POPV;
     |FINSI;

     #1#0 = #3#0;
     #1#1 = #3#2;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0 = #3#0;
         #1#1 = #3#2;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #3#0;
     #4#1 = #3#2;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #3#0;
         #4#1 = #3#2;
         |GRABA 020#4b;
     |FINSI;

     #2#0 = #3#0;
     #2#1 = #3#45;
     #2#2 = el_anyo;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #7#0 = #2#0;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

     |SI #7#17 = "S";
         #1#29 = "X";
         #4#66 = "S";
     |FINSI;
     #1#2  = #7#2;

     |HAZ Pantalla1;
     |HAZ Pantalla2;

     |SI #3#1 = 1; #1#147 = #1#147 + #3#29; |FINSI;
     #1#155 = #1#147;

     |SI #3#1 = 4;
         |SI #3#55 < 0; #1#159 = #1#159 + -#3#55; |FINSI;
         |SI #3#55 > 0; #1#160 = #1#160 +  #3#55; |FINSI;
     |FINSI;

     |SI #3#55 > 0; #1#157 = #1#157 + #3#55; |FINSI;

     #1#158 = 0;

     |HAZ Pantalla3;
     |HAZ Total390;

     |GRABA 020#1a;
     |GRABA 020#4a;
     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosm1300;
     #3#1;
     ;
     d_empre, 1,   1, el_anyo;
     h_empre, 6,  12, el_anyo;
     e;
     NULL, Fichero3;
|FIN;

|| ----------------\    CARGA DATOS DEL 303
||                  \------------------------------------------------------

|PROCESO Fichero303;
     |SI #303#3 = "          "; |Y #0#5 = "S";
         |PUSHV 0531 2380;
         |D_CUADRO 1509, 2067;
         |ATRI R;
         |BLANCO 1610 1966;
         |PINTA 1610, "Empresa ..: ";
         |PINTA 1710, "Actividad :        Periodo ...:  ";
         |PINTA 1810, "Modelo ...: 303";
         |PINTA 1622, #303#0;
         |PINTA 1722, #303#45;
         |PINTA 1742, #303#1;
         |PINTA 1910, "         MODELO NO IMPRESO";
         |ATRI 0;
         |PAUSA;
         |POPV;
     |FINSI;

     #1#0 = #303#0;
     #1#1 = #303#2;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0 = #303#0;
         #1#1 = #303#2;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #303#0;
     #4#1 = #303#2;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #303#0;
         #4#1 = #303#2;
         |GRABA 020#4b;
     |FINSI;

     #2#0 = #303#0;
     #2#1 = #303#45;
     #2#2 = el_anyo;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #7#0 = #2#0;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

     |SI #2#26 ! "T";  |Y #2#26 ! "F";
         #4#84 = "S";
     |FINSI;

     |SI #7#17 = "S";
         #1#29 = "X";
         #4#66 = "S";
     |FINSI;
     #1#2  = #7#2;

     |HAZ Pantalla1;
     |HAZ Pantalla2;

     |SI #303#1 = 1; #1#147 = #1#147 + #303#29; |FINSI;
     #1#155 = #1#147;

     |SI #2#26 = "T";  |O #2#26 = "F";
         |SI #303#1 = 4;
             |SI #303#55 < 0; #1#159 = #1#159 + -#303#55; |FINSI;
             |SI #303#55 > 0; #1#160 = #1#160 +  #303#55; |FINSI;
         |FINSI;
     |SINO;
         |SI #303#1 = 12;
             |SI #303#55 < 0; #1#159 = #1#159 + -#303#55; |FINSI;
             |SI #303#55 > 0; #1#160 = #1#160 +  #303#55; |FINSI;
             |SI #2#26 = "D"; #1#159 = 0; |FINSI;
         |FINSI;
     |FINSI;

     |SI #303#55 > 0;
         #1#157 = #1#157 + #303#55;
     |SINO;
         |SI #2#26 ! "T";  |Y #2#26 ! "F";
             |SI #303#31 ! 0;
                 #1#158 = #1#158 + -#303#55;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ Pantalla3;
     |HAZ Total390;

     |GRABA 020#1a;
     |GRABA 020#4a;
     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosm1303;
     #303#1;
     ;
     d_empre, 1,   1, el_anyo;
     h_empre, 6,  12, el_anyo;
     e;
     NULL, Fichero303;
|FIN;

|| ----------------\    CARGA LOS NUMEROS DE LOS MODULOS 98
||                  \------------------------------------------------------

|PROCESO Pantalla4_98;
     nCampo = 0;
     |SI #1#78 = " ";  |Y #1#79 = "    ";
         nCampo = 1;
     |SINO;
         |SI #1#89 = " ";  |Y #1#90 = "    ";
             nCampo = 2;
         |SINO;
             |SI #1#100 = " ";  |Y #1#101 = "    ";
                 nCampo = 3;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nCampo = 0;  |ACABA;  |FINSI;

     nBLoteria = #13#117 + #13#119 + #13#121 + #13#123;
     nCLoteria = #13#118 + #13#120 + #13#122 + #13#124;
     |SI nCLoteria ! 0;
         |PARA nCampoB = 17;  |SI nCampoB [ 100;  |HACIENDO nCampoB = nCampoB + 11;
               |SI #12nCampoB = 0;
                   |SI nCampoB = 17;  #12#20 = nBLoteria;  #12#21 = nCLoteria;  |FINSI;
                   |SI nCampoB = 28;  #12#31 = nBLoteria;  #12#32 = nCLoteria;  |FINSI;
                   |SI nCampoB = 39;  #12#42 = nBLoteria;  #12#43 = nCLoteria;  |FINSI;
                   |SI nCampoB = 50;  #12#53 = nBLoteria;  #12#54 = nCLoteria;  |FINSI;
                   |SI nCampoB = 61;  #12#64 = nBLoteria;  #12#65 = nCLoteria;  |FINSI;
                   |SI nCampoB = 72;  #12#75 = nBLoteria;  #12#76 = nCLoteria;  |FINSI;
                   |SI nCampoB = 83;  #12#86 = nBLoteria;  #12#87 = nCLoteria;  |FINSI;
                   |SI nCampoB = 94;  #12#97 = nBLoteria;  #12#98 = nCLoteria;  |FINSI;

                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nCampo = 1;
                            #4#122 = "N";
         |SI #12#137 = 0;   #4#122 = "S";  |FINSI;


         #1#78  = #12#2;    #1#79  = #12#3;

         |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
             #1#80  = #12#20 + #12#31 + #12#42;
             #1#199 = #12#21 + #12#32 + #12#43;
             |SI #0#4 = "S";
                 nConver = (#12#53 * #12#54) / (#12#53 * #12#50);
                 nConver = nConver + (#12#64 * #12#65) / (#12#64 * #12#61);
                 nConver = nConver + (#12#75 * #12#76) / (#12#75 * #12#72);
                 #1#81   = nConver;
                 #1#200  = #12#54 + #12#65 + #12#76;

                 nConver = (#12#86 * #12#87) / (#12#86 * #12#83);
                 #1#82   = nConver;
                 #1#201  = #12#87;

                 nConver = (#12#97 * #12#98) / (#12#97 * #12#94);
                 #1#83   = nConver;
                 #1#202  = #12#98;

                 nConver = (#12#108 * #12#109) / (#12#108 * #12#105);
                 #1#84   = nConver;
                 #1#203  = #12#109;
             |SINO;
                 #1#81   = #12#53 + #12#64 + #12#75;
                 #1#200  = #12#54 + #12#65 + #12#76;

                 #1#82   = #12#86;
                 #1#201  = #12#87;

                 #1#83   = #12#97;
                 #1#202  = #12#98;

                 #1#84   = #12#108;
                 #1#203  = #12#109;
             |FINSI;
         |SINO;
             #1#80  = #12#20 + #12#31;   #1#199 = #12#21 + #12#32;
             |SI #0#4 = "S";
                 nConver = (#12#42 * #12#43) / (#12#42 * #12#39);
                 #1#81  = nConver;           #1#200 = #12#43;

                 nConver = (#12#53 * #12#54) / (#12#53 * #12#50);
                 #1#82  = nConver;           #1#201 = #12#54;

                 nConver = (#12#64 * #12#65) / (#12#64 * #12#61);
                 #1#83  = nConver;           #1#202 = #12#65;

                 nConver = (#12#75 * #12#76) / (#12#75 * #12#72);
                 #1#84  = nConver;           #1#203 = #12#76;

                 nConver = (#12#86 * #12#87) / (#12#86 * #12#83);
                 #1#85  = nConver;           #1#204 = #12#87;

                 nConver = (#12#97 * #12#98) / (#12#97 * #12#94);
                 #1#196 = nConver;           #1#205 = #12#98;
             |SINO;
                 #1#81  = #12#42;            #1#200 = #12#43;
                 #1#82  = #12#53;            #1#201 = #12#54;
                 #1#83  = #12#64;            #1#202 = #12#65;
                 #1#84  = #12#75;            #1#203 = #12#76;
                 #1#85  = #12#86;            #1#204 = #12#87;
                 #1#196 = #12#97;            #1#205 = #12#98;
             |FINSI;
         |FINSI;

         |PARA nCont = 4;  |SI nCont [ 36;  |HACIENDO nCont = nCont + 4;
            nNume = #16nCont;
            |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
                   |SI nCont = 4;   #1#80 = #1#80 / nFactor;  |FINSI;
                   |SI nCont = 8;   #1#80 = #1#80 / nFactor;  |FINSI;
                   |SI nCont = 12;  #1#80 = #1#80 / nFactor;  |FINSI;
                   |SI nCont = 16;  #1#81 = #1#81 / nFactor;  |FINSI;
                   |SI nCont = 20;  #1#81 = #1#81 / nFactor;  |FINSI;
                   |SI nCont = 24;  #1#81 = #1#81 / nFactor;  |FINSI;
                   |SI nCont = 28;  #1#82 = #1#82 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#83 = #1#83 / nFactor;  |FINSI;
               |SINO;
                   |SI nCont = 4;   #1#80 = #1#80 / nFactor;  |FINSI;
                   |SI nCont = 8;   #1#80 = #1#80 / nFactor;  |FINSI;
                   |SI nCont = 12;  #1#81 = #1#81 / nFactor;  |FINSI;
                   |SI nCont = 16;  #1#82 = #1#82 / nFactor;  |FINSI;
                   |SI nCont = 20;  #1#83 = #1#83 / nFactor;  |FINSI;
                   |SI nCont = 24;  #1#84 = #1#84 / nFactor;  |FINSI;
                   |SI nCont = 28;  #1#85 = #1#85 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#196 = #1#196 / nFactor;  |FINSI;
               |FINSI;
            |FINSI;
         |SIGUE;

                            #1#220 = #12#113 + (nImpor12 + nImpor11);
                            #1#221 = #13#115 + (#12#113 % 1);
                            #1#222 = #13#66;
                            |SI #1#222 = 0;  #1#222 = 1;  |FINSI;
                            #1#223 = (#12#113 - #1#221) * #1#222;
                            #1#224 = #12#123;
                            #1#225 = #12#113 % #1#224;
                            #1#225 = #1#225 * #1#222;
                            #1#88  = #1#223;
                            |SI #1#88 < #1#225;  #1#88 = #1#225;  |FINSI;

                            |SI #1#88 = 0; |Y #12#127 ! 0;
                                #1#88 = #12#127;
                            |FINSI;

           #4#133 = aLorca;
           #4#136 = aLorca11;
           #4#139 = nImpor12;
           #4#142 = nImpor11;
     |FINSI;

     |SI nCampo = 2;
                            #4#123 = "N";
         |SI #12#137 = 0;   #4#123 = "S";  |FINSI;

         #1#89  = #12#2;    #1#90  = #12#3;

         nBLoteria = #13#117 + #13#119 + #13#121 + #13#123;

         |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
             #1#91  = #12#20 + #12#31 + #12#42;   #1#206 = #12#21 + #12#32 + #12#43;
             |SI #0#4 = "S";
                 nConver = (#12#53 * #12#54) / (#12#53 * #12#50);
                 nConver = nConver + (#12#64 * #12#65) / (#12#64 * #12#61);
                 nConver = nConver + (#12#75 * #12#76) / (#12#75 * #12#72);
                 #1#92   = nConver;
                 #1#207  = #12#54 + #12#65 + #12#76;

                 nConver = (#12#86 * #12#87) / (#12#86 * #12#83);
                 #1#93   = nConver;
                 #1#208  = #12#87;

                 nConver = (#12#97 * #12#98) / (#12#97 * #12#94);
                 #1#94   = nConver;
                 #1#209  = #12#98;

                 nConver = (#12#108 * #12#109) / (#12#108 * #12#105);
                 #1#95   = nConver;
                 #1#210  = #12#109;
             |SINO;
                 #1#92   = #12#53 + #12#64 + #12#75;
                 #1#207  = #12#54 + #12#65 + #12#76;

                 #1#93   = #12#86;
                 #1#208  = #12#87;

                 #1#94   = #12#97;
                 #1#209  = #12#98;

                 #1#95   = #12#108;
                 #1#210  = #12#109;
             |FINSI;
         |SINO;
             #1#91  = #12#20 + #12#31;   #1#206 = #12#21 + #12#32;

             |SI #0#4 = "S";
                 nConver = (#12#42 * #12#43) / (#12#42 * #12#39);
                 #1#92   = nConver;           #1#207 = #12#43;

                 nConver = (#12#53 * #12#54) / (#12#53 * #12#50);
                 #1#93   = nConver;           #1#208 = #12#54;

                 nConver = (#12#64 * #12#65) / (#12#64 * #12#61);
                 #1#94   = nConver;           #1#209 = #12#65;

                 nConver = (#12#75 * #12#76) / (#12#75 * #12#72);
                 #1#95   = nConver;           #1#210 = #12#76;

                 nConver = (#12#86 * #12#87) / (#12#86 * #12#83);
                 #1#96   = nConver;           #1#211 = #12#87;

                 nConver = (#12#97 * #12#98) / (#12#97 * #12#94);
                 #1#197  = nConver;           #1#212 = #12#98;
             |SINO;
                 #1#92  = #12#42;            #1#207 = #12#43;
                 #1#93  = #12#53;            #1#208 = #12#54;
                 #1#94  = #12#64;            #1#209 = #12#65;
                 #1#95  = #12#75;            #1#210 = #12#76;
                 #1#96  = #12#86;            #1#211 = #12#87;
                 #1#197 = #12#97;            #1#212 = #12#98;
             |FINSI;
         |FINSI;

         |PARA nCont = 4;  |SI nCont [ 36;  |HACIENDO nCont = nCont + 4;
           nNume = #16nCont;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
                   |SI nCont = 4;   #1#91 = #1#91 / nFactor;  |FINSI;
                   |SI nCont = 8;   #1#91 = #1#91 / nFactor;  |FINSI;
                   |SI nCont = 12;  #1#91 = #1#91 / nFactor;  |FINSI;
                   |SI nCont = 16;  #1#92 = #1#92 / nFactor;  |FINSI;
                   |SI nCont = 20;  #1#92 = #1#92 / nFactor;  |FINSI;
                   |SI nCont = 24;  #1#92 = #1#92 / nFactor;  |FINSI;
                   |SI nCont = 28;  #1#93 = #1#93 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#94 = #1#94 / nFactor;  |FINSI;
               |SINO;
                   |SI nCont = 4;   #1#91 = #1#91 / nFactor;  |FINSI;
                   |SI nCont = 8;   #1#91 = #1#91 / nFactor;  |FINSI;
                   |SI nCont = 12;  #1#92 = #1#92 / nFactor;  |FINSI;
                   |SI nCont = 16;  #1#93 = #1#93 / nFactor;  |FINSI;
                   |SI nCont = 20;  #1#94 = #1#94 / nFactor;  |FINSI;
                   |SI nCont = 24;  #1#95 = #1#95 / nFactor;  |FINSI;
                   |SI nCont = 28;  #1#96 = #1#96 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#197 = #1#197 / nFactor;  |FINSI;
              |FINSI;
           |FINSI;
         |SIGUE;

                            #1#226 = #12#113 + (nImpor12 + nImpor11);
                            #1#227 = #13#115 + (#12#113 % 1);
                            #1#228 = #13#66;
                            |SI #1#228 = 0;  #1#228 = 1;  |FINSI;
                            #1#229 = (#12#113 - #1#227) * #1#228;
                            #1#230 = #12#123;
                            #1#231 = #12#113 % #1#230;
                            #1#231 = #1#231 * #1#228;
                            #1#99  = #1#229;
                            |SI #1#99 < #1#231;  #1#99 = #1#231;  |FINSI;
           #4#134 = aLorca;
           #4#137 = aLorca11;
           #4#140 = nImpor12;
           #4#143 = nImpor11;
     |FINSI;

     |SI nCampo = 3;
                            #4#124 = "N";
         |SI #12#137 = 0;   #4#124 = "S";  |FINSI;

         #1#100 = #12#2;    #1#101 = #12#3;

         |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
             #1#102 = #12#20 + #12#31 + #12#42;   #1#213 = #12#21 + #12#32 + #12#43;
             |SI #0#4 = "S";
                 nConver = (#12#53 * #12#54) / (#12#53 * #12#50);
                 nConver = nConver + (#12#64 * #12#65) / (#12#64 * #12#61);
                 nConver = nConver + (#12#75 * #12#76) / (#12#75 * #12#72);
                 #1#103  = nConver;
                 #1#214  = #12#54 + #12#65 + #12#76;

                 nConver = (#12#86 * #12#87) / (#12#86 * #12#83);
                 #1#104  = nConver;
                 #1#215  = #12#87;

                 nConver = (#12#97 * #12#98) / (#12#97 * #12#94);
                 #1#105  = nConver;
                 #1#216  = #12#98;

                 nConver = (#12#108 * #12#109) / (#12#108 * #12#105);
                 #1#106  = nConver;
                 #1#217  = #12#109;
            |SINO;
                 #1#103  = #12#53 + #12#64 + #12#75;
                 #1#214  = #12#54 + #12#65 + #12#76;

                 #1#104  = #12#86;
                 #1#215  = #12#87;

                 #1#105  = #12#97;
                 #1#216  = #12#98;

                 #1#106  = #12#108;
                 #1#217  = #12#109;
            |FINSI;
         |SINO;
             #1#102 = #12#20 + #12#31;   #1#213 = #12#21 + #12#32;
             |SI #0#4 = "S";
                 nConver = (#12#42 * #12#43) / (#12#42 * #12#39);
                 #1#103  = nConver;          #1#214 = #12#43;

                 nConver = (#12#53 * #12#54) / (#12#53 * #12#50);
                 #1#104  = nConver;          #1#215 = #12#54;

                 nConver = (#12#64 * #12#65) / (#12#64 * #12#61);
                 #1#105  = nConver;          #1#216 = #12#65;

                 nConver = (#12#75 * #12#76) / (#12#75 * #12#72);
                 #1#106  = nConver;          #1#217 = #12#76;

                 nConver = (#12#86 * #12#87) / (#12#86 * #12#83);
                 #1#107  = nConver;          #1#218 = #12#87;

                 nConver = (#12#97 * #12#98) / (#12#97 * #12#94);
                 #1#198  = nConver;          #1#219 = #12#98;
             |SINO;
                 #1#103 = #12#42;            #1#214 = #12#43;
                 #1#104 = #12#53;            #1#215 = #12#54;
                 #1#105 = #12#64;            #1#216 = #12#65;
                 #1#106 = #12#75;            #1#217 = #12#76;
                 #1#107 = #12#86;            #1#218 = #12#87;
                 #1#198 = #12#97;            #1#219 = #12#98;
             |FINSI;
         |FINSI;

         |PARA nCont = 4;  |SI nCont [ 36;  |HACIENDO nCont = nCont + 4;
           nNume = #16nCont;
           |SI nNume = 3;  |O nNume = 28;  |O nNume = 10;
               nFactor = 100;
               |SI nNume = 10;  nFactor = 1000;  |FINSI;

               |SI #12#3 = "6441"; |O #12#3 = "6442"; |O #12#3 = "6443"; |O #12#3 = "6446";
                   |SI nCont = 4;   #1#102 = #1#102 / nFactor;  |FINSI;
                   |SI nCont = 8;   #1#102 = #1#102 / nFactor;  |FINSI;
                   |SI nCont = 12;  #1#102 = #1#102 / nFactor;  |FINSI;
                   |SI nCont = 16;  #1#103 = #1#103 / nFactor;  |FINSI;
                   |SI nCont = 20;  #1#103 = #1#103 / nFactor;  |FINSI;
                   |SI nCont = 24;  #1#103 = #1#103 / nFactor;  |FINSI;
                   |SI nCont = 28;  #1#104 = #1#104 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#105 = #1#105 / nFactor;  |FINSI;
               |SINO;
                   |SI nCont = 4;   #1#102 = #1#102 / nFactor;  |FINSI;
                   |SI nCont = 8;   #1#102 = #1#102 / nFactor;  |FINSI;
                   |SI nCont = 12;  #1#103 = #1#103 / nFactor;  |FINSI;
                   |SI nCont = 16;  #1#104 = #1#104 / nFactor;  |FINSI;
                   |SI nCont = 20;  #1#105 = #1#105 / nFactor;  |FINSI;
                   |SI nCont = 24;  #1#106 = #1#106 / nFactor;  |FINSI;
                   |SI nCont = 28;  #1#107 = #1#107 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#198 = #1#198 / nFactor;  |FINSI;
                   |SI nCont = 32;  #1#198 = #1#198 / nFactor;  |FINSI;
               |FINSI;
           |FINSI;
         |SIGUE;
                            #1#232 = #12#113 + (nImpor12 + nImpor11);
                            #1#233 = #13#115 + (#12#113 % 1);
                            #1#234 = #13#66;
                            |SI #1#234 = 0;  #1#234 = 1;  |FINSI;
                            #1#235 = (#12#113 - #1#233) * #1#234;
                            #1#236 = #12#123;
                            #1#237 = #12#113 % #1#236;
                            #1#237 = #1#237 * #1#234;
                            #1#110 = #1#235;
                            |SI #1#110 < #1#237;  #1#110 = #1#237;  |FINSI;

           #4#135 = aLorca;
           #4#138 = aLorca11;
           #4#141 = nImpor12;
           #4#144 = nImpor11;
     |FINSI;
|FPRC;

|| ----------------\    CARGA DATOS DEL EOSFIMOD (MODULOS)
||                  \------------------------------------------------------

|PROCESO Fichero12;
     sw_estar = 0;
     |PARA x = 20; |SI x [ 108; |HACIENDO x = x + 11;
          |SI #12x ! 0; sw_estar = 1; |FINSI;
     |SIGUE;

     |SI #12#127 ! 0;  sw_estar = 1;  |FINSI;

     |SI sw_estar = 0; |ACABA; |FINSI;

     #1#0 = #12#0;
     #1#1 = #12#5;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0 = #12#0;
         #1#1 = #12#5;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #12#0;
     #4#1 = #12#5;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #12#0;
         #4#1 = #12#5;
         |GRABA 020#4b;
     |FINSI;

     #2#0 = #12#0;
     #2#1 = #12#1;
     #2#2 = el_anyo;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #16#0 = #12#2;
     #16#1 = #12#3;
     #16#41 = #12#4;
     #16#2 = el_anyo;
     |SI #16#2 [ 80;
        #16#2 = #16#2 + 2000;
     |SINO;
        #16#2 = #16#2 + 1900;
     |FINSI;

     |LEE 040#16=;
     |SI FSalida ! 0; |DDEFECTO #16; |FINSI;

     #7#0 = #2#0;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

     |SI #7#17 = "S";
         #1#29 = "X";
         #4#66 = "S";
     |FINSI;
     #1#2  = #7#2;

     #13#0 = #12#0;
     #13#1 = #12#1;
     #13#2 = #12#5;
     |LEE 040#13=;
     |SI FSalida ! 0;  |DDEFECTO #13;  |FINSI;

     aLorca   = " "; nImpor12 = 0;
     aLorca11 = " "; nImpor11 = 0;
     |SI #13#150 = "S";
         aAlfa = #13#0; aAlfa = ("00000" + aAlfa) % -105;
         |SI nEjer [ 2012;
             aAlfa = "    Modulo Empresa " + aAlfa + " con Reduccion de Lorca. Informe en el Apartado correspondiente";
             |MENAV aAlfa;
         |FINSI;

         aLorca   = "1";
         nImpor12 = #13#151;
         nImpor11 = 0;

         |SI nEjer [ 2012;
             nNume1 = ((#12#113 + #13#151) % 35) ! 2;
             |SI #13#151 > nNume1;
                 nImpor12 = nNume1;
                 aLorca11 = "2";
                 nImpor11 = (#13#151 - nNume1);
                 |SI #12#113 = 0;
                     aLorca11 = "1";
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ Pantalla1;
     |HAZ Pantalla4_98;       || Carga los modulos

     |SI nCampo = 0;  |ACABA;  |FINSI;

     |HAZ Total390;

     |GRABA 020#1a;
     |GRABA 020#4a;
     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosm0017;
     #12#1;
     ;
     d_empre, el_anyo, 1;
     h_empre, el_anyo, 6;
     ;
     NULL, Fichero12;
|FIN;

|| ----------------\   INTRODUCE CUOTAS DE LOS AGRARIOS Y GANADEROS 98
||                  \------------------------------------------------------

|PROCESO Agrario98;
     |SELECT #2#2;
     #2#0 = #14#0;
     #2#4 = #14nCampo2;
     #2#5 = #14nCampo3;
     #2#2 = #14#1;
     |LEE 040#2=;
     |SI FSalida ! 0; |ACABA;  |FINSI;

     |ABRE #15;
     #15#0 = #2#4;
     #15#1 = #2#5;
     |LEE 040#15=;
     |SI FSalida ! 0; |DDEFECTO #15; |FINSI;
     |CIERRA #15;

     |HAZ Pantalla1;

     nCampo = 0;
     |SI #1#111 = " ";  |Y #1#115 = "    ";
         nCampo = 1;
     |SINO;
         |SI #1#112 = " ";  |Y #1#116 = "    ";
             nCampo = 2;
         |SINO;
             |SI #1#113 = " ";  |Y #1#117 = "    ";
                 nCampo = 3;
             |SINO;
                 |SI #1#114 = " ";  |Y #1#118 = "    ";
                     nCampo = 4;
                 |SINO;
                     |SI #1#238 = " ";  |Y #1#239 = "    ";
                         nCampo = 5;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nCampo = 0;  |ACABA;  |FINSI;

     |SI nCampo = 1;
         #1#111 = #14nCampo2;
         #1#115 = #14nCampo3;
         #1#119 = #15#2;
         #1#123 = #14nCampo6 / #15#4;
         #1#127 = #15#4;
         #1#131 = #14nCampo6;
         #1#244 = #14nCampo7 + #14nCampo8;
         #1#249 = #1#131 - #1#244;
     |FINSI;

     |SI nCampo = 2;
         #1#112 = #14nCampo2;
         #1#116 = #14nCampo3;
         #1#120 = #15#2;
         #1#124 = #14nCampo6 / #15#4;
         #1#128 = #15#4;
         #1#132 = #14nCampo6;
         #1#245 = #14nCampo7 + #14nCampo8;
         #1#250 = #1#132 - #1#245;
     |FINSI;

     |SI nCampo = 3;
         #1#113 = #14nCampo2;
         #1#117 = #14nCampo3;
         #1#121 = #15#2;
         #1#125 = #14nCampo6 / #15#4;
         #1#129 = #15#4;
         #1#133 = #14nCampo6;
         #1#246 = #14nCampo7 + #14nCampo8;
         #1#251 = #1#133 - #1#246;
     |FINSI;

     |SI nCampo = 4;
         #1#114 = #14nCampo2;
         #1#118 = #14nCampo3;
         #1#122 = #15#2;
         #1#126 = #14nCampo6 / #15#4;
         #1#130 = #15#4;
         #1#134 = #14nCampo6;
         #1#247 = #14nCampo7 + #14nCampo8;
         #1#252 = #1#134 - #1#247;
     |FINSI;

     |SI nCampo = 5;
         #1#238 = #14nCampo2;
         #1#239 = #14nCampo3;
         #1#240 = #15#2;
         #1#241 = #14nCampo6 / #15#4;
         #1#242 = #15#4;
         #1#243 = #14nCampo6;
         #1#248 = #14nCampo7 + #14nCampo8;
         #1#253 = #1#243 - #1#248;
     |FINSI;
|FPRC;

|| ----------------\    CARGA DATOS DEL 310 AO 1998
||                  \------------------------------------------------------

|PROCESO Fichero14;
     |SI #14#3 = "01.01.0000"; |Y #0#5 = "S";
         |PUSHV 0531 2380;
         |D_CUADRO 1509, 2067;
         |ATRI R;
         |BLANCO 1610 1966;
         |PINTA 1610, "Empresa ..:    ";
         |PINTA 1710, "Periodo ..:    ";
         |PINTA 1810, "Modelo ...: 310";
         |PINTA 1622, #14#0;
         |PINTA 1722, #14#2;
         |PINTA 1910, "         MODELO NO IMPRESO";
         |ATRI 0;
         |PAUSA;
         |POPV;
     |FINSI;

     #1#0 = #14#0;
     #1#1 = #14#1;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;

         #7#0 = #14#0;
         |LEE 040#7=;
         |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

         #1#0 = #14#0;
         #1#1 = #14#1;
         #1#2 = #7#2;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #14#0;
     #4#1 = #14#1;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #14#0;
         #4#1 = #14#1;
         |GRABA 020#4b;
     |FINSI;

     |SI #14#2 = 4;
          |SELECT #2#2;
          |PARA nCampo1 = 5; |SI nCampo1 [ 25; |HACIENDO nCampo1 = nCampo1 + 5;
                nCampo2 = nCampo1 + 1;
                nCampo3 = nCampo1 + 2;
                nCampo4 = nCampo1 + 3;
                nCampo5 = nCampo1 + 4;

                |SI nCampo1 = 5;   nCampo6 = 47;  |FINSI;
                |SI nCampo1 = 10;  nCampo6 = 50;  |FINSI;
                |SI nCampo1 = 15;  nCampo6 = 53;  |FINSI;
                |SI nCampo1 = 20;  nCampo6 = 56;  |FINSI;
                |SI nCampo1 = 25;  nCampo6 = 59;  |FINSI;

                nCampo7 = nCampo6 + 1;
                nCampo8 = nCampo6 + 2;

                |SI #14nCampo4 = "S";
                    |HAZ Agrario98;
                    |HAZ Total390;
                |FINSI;
          |SIGUE;
          #1#160 = #1#160 + #14#40;
          #1#159 = #1#159 + #14#41 + #14#42;
     |FINSI;

     |SELECT #1#2;

     |SI #14#2 ! 4;
          #1#136 = #1#136 + #14#30;
     |FINSI;

     |SI #14#2 = 1; #1#147 = #1#147 + #14#37; |FINSI;

     #1#155   = #1#147;
     #1#138   = #1#138 + #14#31;
     #1#139   = #1#139 + #14#32;
     #1#140   = #1#140 + #14#33;
     #1#142   = #1#142 + #14#35;
     #1#143   = #1#143 + #14#45;
     #1#157   = #1#157 + #14#40;
     |SI #14#62 = "S"; #1#157 = #1#157 + #14#65; |FINSI;

     |HAZ Total390;

     |GRABA 020#1a;
     |GRABA 020#4a;
     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosm0019;
     #14#1;
     ;
     d_empre, el_anyo, 1;
     h_empre, el_anyo, 4;
     ;
     NULL, Fichero14;
|FIN;

|| ----------------\    RECALCULA  EL A COMPENSAR Y EL A DEVOLVER
||                  \------------------------------------------------------

|PROCESO Fichero1;
     |PARA nActividad = 1;  |SI nActividad [ 9;  |HACIENDO nActividad = nActividad + 1;
           #2#0 = #1#0;
           #2#1 = nActividad;
           #2#2 = el_anyo;
           |LEE 040#2=;
           |SI FSalida = 0;  |SAL;  |FINSI;
           |DDEFECTO #2;
     |SIGUE;

     total = #1#160 - #1#159;  || El 160 se ha puesto como a ingresar para poder
                               || operar
     |SI total < 0;
         |SI #2#27 = "C"; #1#159 = -total; #1#160 = 0; |FINSI;
         |SI #2#27 = "D"; #1#160 = -total; #1#159 = 0; |FINSI;
     |SINO;
         #1#159 = 0;
         #1#160 = 0;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE eosm3390;
     #1#1;
     ;
     d_empre, el_anyo;
     h_empre, el_anyo;
     be;
     NULL, Fichero1;
|FIN;

|| ----------------\    CARGA DATOS DEL 330
||                  \------------------------------------------------------

|PROCESO Fichero9;             || Carga datos desde el 330
     |SI #9#5 = "          "; |Y #0#5 = "S";
         |PUSHV 0531 2380;
         |D_CUADRO 1509, 2067;
         |ATRI R;
         |BLANCO 1610 1966;
         |PINTA 1610, "Empresa ..: ";
         |PINTA 1710, "Actividad :        Periodo ...:  ";
         |PINTA 1810, "Modelo ...: 330";
         |PINTA 1622, #9#0;
         |PINTA 1722, #9#1;
         |PINTA 1742, #9#2;
         |PINTA 1910, "         MODELO NO IMPRESO";
         |ATRI 0;
         |PAUSA;
         |POPV;
     |FINSI;

     #1#0 = #9#0;
     #1#1 = #9#4;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0 = #9#0;
         #1#1 = #9#4;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #9#0;
     #4#1 = #9#4;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #9#0;
         #4#1 = #9#4;
         |GRABA 020#4b;
     |FINSI;

     #2#0 = #9#0;
     #2#1 = #9#1;
     #2#2 = el_anyo;
     |LEE 040#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     #7#0 = #2#0;
     |LEE 040#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

     |SI #7#17 = "S";
         #1#29 = "X";
         #4#66 = "S";
     |FINSI;
     #1#2  = #7#2;

     |HAZ Pantalla1;
     |HAZ Pantalla2_9;

     |SI #9#2 = 1; #1#147 = #1#147 + #9#44; |FINSI;
     #1#155 = #1#147;

     |SI #9#2 = 4; |Y #9#3 = "T";
         #1#159 = #1#159 + #9#52;
         #1#160 = #1#160 + #9#51;
     |FINSI;

     |SI #9#2 = 12; |Y #9#3 = "M";
         #1#159 = #1#159 + #9#52;
         #1#160 = #1#160 + #9#51;
     |FINSI;

     #1#157 = #1#157 + #9#53;
     #1#158 = #1#158 + #9#51;

     |HAZ Pantalla3_9;
     |HAZ Total390;

     |GRABA 020#1a;
     |GRABA 020#4a;

     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosma330;
     #9#1;
     ;
     d_empre, 1, 01, " ", el_anyo;
     h_empre, 6, 12, "z", el_anyo;
     e;
     NULL, Fichero9;
|FIN;


|| ----------------\    CARGA DATOS DE LAS OPERACIONES ESPECIFICAS
||                  \------------------------------------------------------

|PROCESO operaciones;             || Carga datos desde las operaciones especi.
     #1#0 = #11#0;
     #1#1 = #11#3;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0 = #11#0;
         #1#1 = #11#3;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #11#0;
     #4#1 = #11#3;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #11#0;
         #4#1 = #11#3;
         |GRABA 020#4b;
     |FINSI;

     #1#162 = #1#162 + #11#4;
     #1#163 = #1#163 + #11#5;
     #1#164 = #1#164 + #11#6;
     #1#165 = #1#165 + #11#7;
     #1#166 = #1#166 + #11#8;
     #1#167 = #1#167 + #11#9;
     #1#168 = #1#168 + #11#10;
     #1#169 = #1#169 + #11#11;
     #1#171 = #1#171 + #11#12;
     #1#172 = #1#172 + #11#13;
     #1#173 = #1#173 + #11#14;
     #1#174 = #1#174 + #11#15;
     #1#175 = #1#175 + #11#16;

     |HAZ Total390;
     |GRABA 020#1a;
     |GRABA 020#4a;
     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosopesp;
     #11#1;
     ;
     d_empre, 1, 01, el_anyo;
     h_empre, 6, 12, el_anyo;
     e;
     NULL, operaciones;
|FIN;

|PROCESO eosopes2;
     #1#0 = #21#0;
     #1#1 = #21#3;
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0 = #21#0;
         #1#1 = #21#3;
         |GRABA 020#1b;
     |FINSI;

     #4#0 = #21#0;
     #4#1 = #21#3;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
         #4#0 = #21#0;
         #4#1 = #21#3;
         |GRABA 020#4b;
     |FINSI;

     #1#165 = #1#165 + #21#9;
     #1#166 = #1#166 + #21#10;
     #1#167 = #1#167 + #21#11;
     #1#172 = #1#172 + #21#7;
     #1#174 = #1#174 + #21#21;
     #1#162 = #1#162 + #21#24;
     #1#163 = #1#163 + #21#25;
     #1#164 = #1#164 + #21#8;
     #4#61  = #4#61  + #21#5;
     #4#62  = #4#62  + #21#6;
     #1#168 = #1#168 + #21#12;
     #1#169 = #1#169 + #21#13;
     #1#170 = #1#170 + #21#14;

     #4#81  = #4#81  + #21#15;
     #1#171 = #1#171 + #21#16;
     #4#82  = #4#82  + #21#17;
     #4#89  = #4#89  + #21#18;
     #1#173 = #1#173 + #21#19;
     #1#175 = #1#175 + #21#22;
     #4#83  = #4#83  + #21#20;

     |HAZ Total390;
     |GRABA 020#1a;
     |GRABA 020#4a;
     |LIBERA #1;
     |LIBERA #4;
|FPRC;

|DEFBUCLE eosopes2;
     #21#1;
     ;
     d_empre, 1, 01, el_anyo;
     h_empre, 6, 12, el_anyo;
     e;
     NULL, eosopes2;
|FIN;

|PROCESO eosma100B;
     |BORRA 020#100a;
     |LIBERA #100;
|FPRC;

|DEFBUCLE eosma100B;
     #100#1;
     ;
     "390", d_empre, 0, 99, el_anyo, 000;
     "390", h_empre, 0, 99, el_anyo, 999;
     be;
     NULL, eosma100B;
|FIN;

|PROCESO Tipo3;
     |ABRET #16;
     |ABRET #4;
     |BUCLE eosm3390B;

     |ABRET #1;
     |ABRET #2;
     |ABRET #7;
     |ABRET #10;
     |ABRET #13;

     |SI #0#2 [ 80;
        nEjer = #0#2 + 2000;
     |SINO;
        nEjer = #0#2 + 1900;
     |FINSI;

     |CIERRAT #7;  |BUCLE eosclien; |ABRET #7; || Recalculo Resultado Multiple periodo para el 370

     |SI nEjer [ 2008;
         |BUCLE eosm1300;
         |SI nEjer ] 1998;
             |BUCLE eosm0017;
             |BUCLE eosm0019;
         |FINSI;
     |SINO;
         |BUCLE eosma100B;

         |DBASE aBase;  |QBF aBase;
         aMas = aBase + "def/eosma100.mas";
         |CARGA_DEF aMas, desglose@;

         |ABRE #1100;
         |ABRE #100;
         |BUCLE eosm1303;
         |CIERRA #100;
         |CIERRA #1100;

         |DESCARGA_DEF #desglose@;

         |BUCLE eosm0017;
         |BUCLE eosm0019;
     |FINSI;

     |CIERRAT #1;  |BUCLE eosm3390;  |ABRET #1;

     |SI nEjer [ 2008;
         |BUCLE eosma330;
     |FINSI;

     |SI nEjer [ 2008;
         |BUCLE eosopesp;
     |SINO;
         |BUCLE eosopes2;
     |FINSI;

     |CIERRAT #1;
     |CIERRAT #2;
     |CIERRAT #7;
     |CIERRAT #10;
     |CIERRAT #13;
     |CIERRAT #4;
     |CIERRAT #16;

     |SI nSwRe = 1;
         |MENAV "    Detectadas Bases al 7% o 16%, tipos no vigentes. ";
         |MENAV "    Se han incluido en MODIFICACION DE BASES Y CUOTAS, casillas 29/30";
     |FINSI;
     |SI nSwRe1 = 1;
         |MENAV "    Detectadas en IVA devengado Bases y Cuotas con tipos incorrectos.";
         |MENAV "    No pasan al Modelo 390. Revisar Datos";
     |FINSI;
     |SI nSwAq = 1;
         |MENAV "    Bases al 7% o 16%, tipos no vigentes, en Adquisiones Intracomunitaria. ";
         |MENAV "    Se han incluido en MODIFICACION DE BASES Y CUOTAS, casillas 29/30";
     |FINSI;
     |SI nSwSo1 = 1;
         |MENAV "    Detectadas en IVA deducible Bases y Cuotas con tipos incorrectos.";
         |MENAV "    Revisar Datos";
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI sw_sit = 0;
         |CLS;
         |CABEZA "Pase del 390";
         |PINPA #0#0;
         |DDEFECTO #0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI #0#3 = "NO"; |O FSalida ! 0; |ACABA; |FINSI;

         d_empre = #0#0;
         h_empre = #0#1;
         el_anyo = #0#2;
         |SI FSalida = 0; |HAZ Tipo3; |FINSI;
     |SINO;
         #0#0 = d_empre;
         #0#1 = h_empre;
         #0#2 = el_anyo;
         |HAZ Tipo3;
     |FINSI;
|FPRO;
