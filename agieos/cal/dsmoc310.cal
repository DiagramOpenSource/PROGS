|FICHEROS;
     dsmoc310;
     dsmoc311,MANTE;
     dsmom008;
     eosm0017;
     eosactiv;

     dsmom033;
     dsmom133;
|FIN;

|VARIABLES;
     aModo       = "";

     nSwEsta     = 0;
     nEjerAnt    = 0;
     nPer        = 0;
     nSwGraba    = 0;
     nTipo       = 0;
     nCompensar  = 0;
     nDPeriodo   = 0;
     nHPeriodo   = 0;
     nCuotaSopor = 0;
     nTotal      = 0;
     nTanto      = 0;
     nHComple    = 0;
     nEl36       = 0;
     nModAnter   = 0;
     nAnyo       = 0;
     nDPer349    = 0;
     nHPer349    = 0;
     nComplem    = 0;
     nParaBorra  = 0;
     aPathModelo = "";
     aDef        = "";
     aAlfa       = "";
     aAlfa1      = "";
     aBase       = "";
     aMas        = "";
     aParametro  = "";

     nDepar      = 0;
     nCtVolumen  = 0;
     nAntes1     = 0;
     nTrim       = 0;
     nHasta      = 0;
     nCampo1     = 0;
     nCampo2     = 0;
     nCampo3     = 0;
     nCampo4     = 0;
     nCampo5     = 0;

     &enProAct   = 0;
     &enProCom   = 0;
     &EURODB     = 0;
|FIN;

|INCLUYE i_variar;

|| --------------------------------------------------------------------------
|| Calculos del proceso dsmoc311
|| --------------------------------------------------------------------------
|PROCESO Tipo12W120; |TIPO 12;
|FPRC;

|PROCESO Tipo7C7; |TIPO 7;
     |ABRE #dsmom033;
     #dsmom033#0 = #dsmoc311#6;
     |LEE 000#dsmom033.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom033;  |FINSI;
     |CIERRA #dsmom033;

     |ABRE #dsmom133;
     #dsmom133#0 = #dsmoc311#6;
     #dsmom133#1 = #dsmoc311#1;
     |LEE 000#dsmom133.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom133;  |FINSI;
     |CIERRA #dsmom133;

     #dsmoc311#9  = #dsmom133#3;
     #dsmoc311#10 = #dsmom133#4;

     |PINTA #dsmoc311#9;
     |PINTA #dsmoc311#10;
|FPRC;

|PROCESO AntesCultivo2010; |TIPO 7;
   aAlfa1 = "    <F11> Consulta de los Cultivos."
   |MENSA aAlfa1;
|FPRC;

|PROCESO DesCultivo; |TIPO 0;
   |BLIN 4;
|FPRC;

|PROCESO Derivada;
     #dsmoc311#23 = 1;

     |SI #dsmoc311#2 ! 12;
         nTotal      = (#dsmoc311#8 * #dsmoc311#9) ! EURODB;
         nTotal      = ((nTotal * #dsmoc311#10) / 100) ! EURODB;
         nCuotaSopor = 0;
     |SINO;
         nTotal      = (#dsmoc311#8 * #dsmoc311#9) ! EURODB;
         nCuotaSopor = (#dsmoc311#11 + (nTotal % 1)) ! EURODB;
     |FINSI;

     #dsmoc311#12 = nTotal - nCuotaSopor;
     |PINTA #dsmoc311#12;
|FPRC;


|| --------------------------------------------------------------------------
|| Calculos del proceso dsmoc310
|| --------------------------------------------------------------------------

|RUTINA Baja1;
     #dsmoc311#0 = #dsmoc310#0;
     #dsmoc311#1 = #dsmoc310#1;
     #dsmoc311#2 = #dsmoc310#2;
     #dsmoc311#3 = #dsmoc310#3;
     #dsmoc311#4 = #dsmoc310#4;
     #dsmoc311#5 = #dsmoc310#5;
     #dsmoc311#6 = 1;
|FRUT;

|RUTINA Alta1;
     #dsmoc311#0 = #dsmoc310#0;
     #dsmoc311#1 = #dsmoc310#1;
     #dsmoc311#2 = #dsmoc310#2;
     #dsmoc311#3 = #dsmoc310#3;
     #dsmoc311#4 = #dsmoc310#4;
     #dsmoc311#5 = #dsmoc310#5;
     #dsmoc311#6 = 999;
|FRUT;

|PROCESO dsmoc311;
     #dsmoc310#9 = #dsmoc310#9 + #dsmoc311#12;
     |SI #dsmoc310#2 = 12;  #dsmoc310#19 = #dsmoc310#19 + #dsmoc311#8; |FINSI;
|FPRC;

|DEFBUCLE dsmoc311;
     #dsmoc311#1;
     ;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 001;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 999;
     ;
     NULL, dsmoc311;
|FIN;

|PROCESO Cultivos;  |TIPO 0;
     |SI #dsmoc310#8 ! "S";  |ACABA;  |FINSI;

     |SI FSalida = 10;
         |PUSHV 0501 2380;

                                |C_M #dsmoc311#11, 1, "S";
         |SI #dsmoc310#2 ! 12;  |C_M #dsmoc311#11, 1, "N";  |FINSI;

         |ENTLINEAL #1#dsmoc311, -7, 2, 22, 1, Baja1, Alta1;
         |POPV;
     |FINSI;

     #dsmoc310#9  = 0;
     #dsmoc310#19 = 0;

     |ABRE #dsmoc311;
     #dsmoc311#0 = #dsmoc310#0;
     #dsmoc311#1 = #dsmoc310#1;
     #dsmoc311#2 = #dsmoc310#2;
     #dsmoc311#3 = #dsmoc310#3;
     #dsmoc311#4 = #dsmoc310#4;
     #dsmoc311#5 = #dsmoc310#5;
     #dsmoc311#6 = 1;
     |LEE 000#dsmoc311.];
     |SI FSalida = 0;  |Y #dsmoc311#0 = #dsmoc310#0; |Y #dsmoc311#1 = #dsmoc310#1; |Y #dsmoc311#2 = #dsmoc310#2;
                       |Y #dsmoc311#3 = #dsmoc310#3; |Y #dsmoc311#4 = #dsmoc310#4; |Y #dsmoc311#5 = #dsmoc310#5;
         |CIERRA #dsmoc311;

         |BUCLE dsmoc311;
     |FINSI;
     |CIERRA #dsmoc311;

     |PINTA #dsmoc310#9;
     |PINTA #dsmoc310#19;
|FPRC;

|PROCESO GrabaRegistro0;
     |ABRE #dsmom008;
     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = enModelo;
     #dsmom008#4 = enComplem;
     #dsmom008#5 = 0;
     |LEE 101#dsmom008.=;
     |SI FSalida = 0;
         #dsmom008#11 = "SIN DATOS ";
         |GRABA 020#dsmom008.a;
     |FINSI;
     |LIBERA #dsmom008;
     |CIERRA #dsmom008;

     nTipo         = enTipoEntrada;
     enTipoEntrada = 98;

     aParametro = ("00000" + enEmpresa) % -105;
     aParametro = aParametro + ("0000" + enEjer) % -104;
     aParametro = aParametro + ("00" + enPeriodo) % -102;
     aParametro = aParametro + ("000" + enModelo) % -103;
     aParametro = aParametro + ("00" + enComplem) % -102;
     aParametro = aParametro + ("00" + enActividad) % -102;
     aParametro = aParametro + ("00" + enTipoEntrada) % -102;
     aParametro = aParametro + ("0" + enExistencia) % -101;

     aAlfa = "dsm30301;" + aParametro;
     |SUB_EJECUTA_NP aAlfa;
     enTipoEntrada = nTipo;
     nSwGraba      = enExistencia;

     |ABRE #dsmom008;
     |ABRE #dsmoc310;
     #dsmoc310#0 = enEmpresa;
     #dsmoc310#1 = enEjer;
     #dsmoc310#2 = enPeriodo;
     #dsmoc310#3 = enModelo;
     #dsmoc310#4 = enComplem;
     #dsmoc310#5 = enActividad;
     |LEE 040#dsmoc310.=;
     |SI FSalida = 0;
         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = enActividad;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "COMPLETADO";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;
     |FINSI;
     |CIERRA #dsmoc310;

     |SI nSwGraba = 1;
         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = 0;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "EXISTENTE";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;
     |FINSI;
     |CIERRA #dsmom008;
|FPRC;

|PROCESO dsmoc311B;
     |BORRA 020#dsmoc311.a;
     |LIBERA #dsmoc311;
|FPRC;

|DEFBUCLE dsmoc311B;
     #dsmoc311#1;
     ;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 001;
     #dsmoc310#0, #dsmoc310#1, #dsmoc310#2, #dsmoc310#3, #dsmoc310#4, #dsmoc310#5, 999;
     be;
     NULL, dsmoc311B;
|FIN;

|PROCESO dsmoc310B;
     |SI #dsmoc310#8 = "S";
         |BUCLE dsmoc311B;
         |BORRA 020#dsmoc310.a;
     |FINSI;

     |SI #dsmoc310#8 = "N";
         |SI enModi310 = 1;  #dsmoc310#9 = 0;  |FINSI;
         |SI #dsmoc310#9 = 0;
             |BORRA 020#dsmoc310.a;
         |SINO;
             #dsmoc310#10 = 0;
             #dsmoc310#11 = 0;
             #dsmoc310#12 = 0;
             #dsmoc310#13 = 0;
             #dsmoc310#14 = 0;
             #dsmoc310#15 = 0;
             #dsmoc310#16 = 0;
             #dsmoc310#17 = 0;
             #dsmoc310#18 = 0;
             #dsmoc310#19 = 0;

             |GRABA 020#dsmoc310.a;
         |FINSI;
         |LIBERA #dsmoc310;
     |FINSI;
|FPRC;

|DEFBUCLE dsmoc310B;
     #dsmoc310#1;
     ;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, enActividad;
     enEmpresa, enEjer, enPeriodo, enModelo, enComplem, enActividad;
     be;
     NULL, dsmoc310B;
|FIN;

|PROCESO Tipo12moc310;  |TIPO 12;
|FPRC;

|PROCESO ChequeaGraba;
     |SI #dsmoc310#9  = 0; |Y  #dsmoc310#10 = 0; |Y  #dsmoc310#11 = 0; |Y  #dsmoc310#12 = 0;
      |Y #dsmoc310#13 = 0; |Y  #dsmoc310#14 = 0; |Y  #dsmoc310#15 = 0; |Y  #dsmoc310#16 = 0;
      |Y #dsmoc310#17 = 0; |Y  #dsmoc310#18 = 0;
         |ABRE #eosm0017;
         #eosm0017#0 = #dsmoc310#0;
         #eosm0017#1 = #dsmoc310#1 - 2000;
         #eosm0017#2 = #dsmoc310#5;
         |LEE 040#eosm0017.=;
         |SI FSalida ! 0;  |DDEFECTO #eosm0017;  |FINSI;
         |CIERRA #eosm0017;

         nParaBorra = 0;
         |SI #dsmoc310#2 = 3;  |Y #eosm0017#124 = 0; nParaBorra = 1;  |FINSI;
         |SI #dsmoc310#2 = 6;  |Y #eosm0017#125 = 0; nParaBorra = 1;  |FINSI;
         |SI #dsmoc310#2 = 9;  |Y #eosm0017#126 = 0; nParaBorra = 1;  |FINSI;
         |SI #dsmoc310#2 = 12; |Y #eosm0017#127 = 0; nParaBorra = 1;  |FINSI;
         |SI nParaBorra = 1;
            |CONFI "0000NEl Importe es igual a Cero, desea Impreso SIN Actividad ";
            |SI FSalida = 0;
                |GRABA 020#dsmoc310.a;
                |ACABA;
            |FINSI;
         |FINSI;

         |SI #dsmoc310#2 = 3;  |Y #eosm0017#124 = 0;
             enEntrada = 0;
             |BORRA 020#dsmoc310.a;
             |ACABA;
         |FINSI;

         |SI #dsmoc310#2 = 6;  |Y #eosm0017#125 = 0;
             enEntrada = 0;
             |BORRA 020#dsmoc310.a;
             |ACABA;
         |FINSI;

         |SI #dsmoc310#2 = 9;  |Y #eosm0017#126 = 0;
             enEntrada = 0;
             |BORRA 020#dsmoc310.a;
             |ACABA;
         |FINSI;

         |SI #dsmoc310#2 = 12; |Y #eosm0017#127 = 0;
             enEntrada = 0;
             |BORRA 020#dsmoc310.a;
             |ACABA;
         |FINSI;
     |FINSI;

     |GRABA 020#dsmoc310.a;
     |LIBERA #dsmoc310;
|FPRC;

|PROCESO AltaModelo;
     nSwEsta   = 0;
     enEntrada = 1;

     |ABRE #dsmoc310;
     #dsmoc310#0 = enEmpresa;
     #dsmoc310#1 = enEjer;
     #dsmoc310#2 = enPeriodo;
     #dsmoc310#3 = enModelo;
     #dsmoc310#4 = enComplem;
     #dsmoc310#5 = enActividad;
     |LEE 101#dsmoc310.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc310;
         #dsmoc310#0 = enEmpresa;
         #dsmoc310#1 = enEjer;
         #dsmoc310#2 = enPeriodo;
         #dsmoc310#3 = enModelo;
         #dsmoc310#4 = enComplem;
         #dsmoc310#5 = enActividad;
         nSwEsta = 1;

         |GRABA 020#dsmoc310.b;
     |FINSI;

     |ABRE #eosactiv;
     #eosactiv#0 = enEmpresa;
     #eosactiv#1 = enActividad;
     #eosactiv#2 = enEjer - 2000;
     |LEE 040#eosactiv.=;
     |SI FSalida ! 0;  |DDEFECTO #eosactiv;  |FINSI;
     |CIERRA #eosactiv;

     #dsmoc310#6  = #eosactiv#5;
     #dsmoc310#7  = #eosactiv#6;
     #dsmoc310#8  = #eosactiv#41;

     |C_M #dsmoc310#9, 1, "S";
     |SI #dsmoc310#8 = "N";
         |C_M #dsmoc310#9, 1, "N";
     |FINSI;

     |PINPA #0#dsmoc310;
     |PINDA #0#dsmoc310;
     |HAZ PintaDatos;
     |ENDATOS #1#dsmoc310;
     |SI FSalida = 0;
         |HAZ ChequeaGraba;

         |ABRE #dsmom008;
         #dsmom008#0 = enEmpresa;
         #dsmom008#1 = enEjer;
         #dsmom008#2 = enPeriodo;
         #dsmom008#3 = enModelo;
         #dsmom008#4 = enComplem;
         #dsmom008#5 = enActividad;
         |LEE 101#dsmom008.=;
         |SI FSalida = 0;
             #dsmom008#11 = "SIN DATOS ";
             |GRABA 020#dsmom008.a;
         |FINSI;
         |LIBERA #dsmom008;
         |CIERRA #dsmom008;
     |SINO;
         |SI nSwEsta = 1;
             enEntrada = 0;
             |BORRA 020#dsmoc310.a;
         |FINSI;
     |FINSI;
     |LIBERA #dsmoc310;
     |CIERRA #dsmoc310;

     |HAZ GrabaRegistro0;
|FPRC;

|PROGRAMA;
     eaNoVisu = "";
     eaNomDef = "dsmoc310";

|| \\\\\\ Consulta del Modelo ////////

     |SI enTipoEntrada = 4;              || Consulta del Modelo
         |HAZ SacaPantallas;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo ////////

     |SI enTipoEntrada = 3;              ||Baja del Modelo
         |BUCLE dsmoc310B;
         |HAZ GrabaRegistro0;
         |ACABA;
     |FINSI;

|| \\\\\\ Baja del Modelo desde Modulo////////

     |SI enTipoEntrada = 97;              ||Baja del Modelo
         |BUCLE dsmoc310B;
         |HAZ GrabaRegistro0;
         |ACABA;
     |FINSI;

|| \\\\\\ Alta o Modificacion del Modelo ////////

     |SI enTipoEntrada = 1;              || Alta del Modelo
         |CABEZA "Modelo Trabajo 310";
         |HAZ AltaModelo;
     |FINSI;

|| \\\\\\ Grabacion del Modelo desde el Exterior

     |SI enTipoEntrada = 91;
         |ABRE #dsmoc310;
         #dsmoc310#0 = enEmpresa;
         #dsmoc310#1 = enEjer;
         #dsmoc310#2 = enPeriodo;
         #dsmoc310#3 = enModelo;
         #dsmoc310#4 = enComplem;
         #dsmoc310#5 = enActividad;
         |LEE 101#dsmoc310.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsmoc310;
             #dsmoc310#0 = enEmpresa;
             #dsmoc310#1 = enEjer;
             #dsmoc310#2 = enPeriodo;
             #dsmoc310#3 = enModelo;
             #dsmoc310#4 = enComplem;
             #dsmoc310#5 = enActividad;
             nSwEsta = 1;

             |GRABA 020#dsmoc310.b;
         |FINSI;

         |SI #dsmoc310#8 = "S";
             #dsmoc310#9 = 0;
             |BUCLE dsmoc311;
             |GRABA 020#dsmoc310.a;
         |FINSI;
         |CIERRA #dsmoc310;

         |HAZ GrabaRegistro0;
     |FINSI;

     |SI enTipoEntrada = 98;
         |HAZ GrabaRegistro0;
     |FINSI;

|| \\\\\\ Comprobacion Existencia del Modelo

     |SI enTipoEntrada = 99;              || Existencia del Modelo ????
         |ABRE #dsmoc310;
         #dsmoc310#0 = enEmpresa;
         #dsmoc310#1 = enEjer;
         #dsmoc310#2 = enPeriodo;
         #dsmoc310#3 = enModelo;
         #dsmoc310#4 = enComplem;
         #dsmoc310#5 = enActividad;
         |LEE 040#dsmoc310.=;
         |SI FSalida ! 0;  enExistencia = 1;  |FINSI;
         |CIERRA #dsmoc310;
     |FINSI;
|FPRO;
