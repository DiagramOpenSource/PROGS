|FICHEROS;
     eospa303;
     dsmociva;
     eosm1303;
     eosopes2;
     eosma100,MANTE;

     dsmom004;
     dsmom008;
     eosactiv;
|FIN;

|VARIABLES;
     nCas1           = 0;
     nCas2           = 0;
     nBase           = 0;
     nIVA            = 0;
     nCuota          = 0;
     nCampo          = 0;
     nCampoDes       = 0;

     aAlfa           = "";
     &enDesdePlan    = 0;
|FIN;

|INCLUYE i_variar;

|PROCESO LeeDSMOCIVA;
     #dsmociva#0 = enEmpresa;
     #dsmociva#1 = enEjer;
     #dsmociva#2 = enPeriodo;
     #dsmociva#3 = enModelo;
     #dsmociva#4 = enComplem;
     #dsmociva#5 = enActividad;
     #dsmociva#6 = nCas1;
     #dsmociva#7 = nCas2;
     |LEE 101#dsmociva.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmociva;
         #dsmociva#0 = enEmpresa;
         #dsmociva#1 = enEjer;
         #dsmociva#2 = enPeriodo;
         #dsmociva#3 = enModelo;
         #dsmociva#4 = enComplem;
         #dsmociva#5 = enActividad;
         #dsmociva#6 = nCas1;
         #dsmociva#7 = nCas2;
         |GRABA 020#dsmociva.b;
     |FINSI;
|FPRC;

|PROCESO CargaDSMOCIVA;
     |SI nIVA = #dsmociva#15;
         #dsmociva#14 = #dsmociva#14 + nBase;
         #dsmociva#16 = #dsmociva#16 + nCuota;
         |ACABA;
     |FINSI;

     |SI nIVA = #dsmociva#18;
         #dsmociva#17 = #dsmociva#17 + nBase;
         #dsmociva#19 = #dsmociva#19 + nCuota;
         |ACABA;
     |FINSI;

     |SI nIVA = #dsmociva#21;
         #dsmociva#20 = #dsmociva#20 + nBase;
         #dsmociva#22 = #dsmociva#22 + nCuota;
         |ACABA;
     |FINSI;

     |SI nIVA = #dsmociva#24;
         #dsmociva#23 = #dsmociva#23 + nBase;
         #dsmociva#25 = #dsmociva#25 + nCuota;
         |ACABA;
     |FINSI;

     |SI nIVA = #dsmociva#27;
         #dsmociva#26 = #dsmociva#26 + nBase;
         #dsmociva#28 = #dsmociva#28 + nCuota;
         |ACABA;
     |FINSI;

     |SI nIVA = #dsmociva#30;
         #dsmociva#29 = #dsmociva#29 + nBase;
         #dsmociva#31 = #dsmociva#31 + nCuota;
         |ACABA;
     |FINSI;

     |SI nIVA = #dsmociva#33;
         #dsmociva#32 = #dsmociva#32 + nBase;
         #dsmociva#34 = #dsmociva#34 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#15 = 0;
         #dsmociva#15 = nIVA;
         #dsmociva#14 = #dsmociva#14 + nBase;
         #dsmociva#16 = #dsmociva#16 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#18 = 0;
         #dsmociva#18 = nIVA;
         #dsmociva#17 = #dsmociva#17 + nBase;
         #dsmociva#19 = #dsmociva#19 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#21 = 0;
         #dsmociva#21 = nIVA;
         #dsmociva#20 = #dsmociva#20 + nBase;
         #dsmociva#22 = #dsmociva#22 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#24 = 0;
         #dsmociva#24 = nIVA;
         #dsmociva#23 = #dsmociva#23 + nBase;
         #dsmociva#25 = #dsmociva#25 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#27 = 0;
         #dsmociva#27 = nIVA;
         #dsmociva#26 = #dsmociva#26 + nBase;
         #dsmociva#28 = #dsmociva#28 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#30 = 0;
         #dsmociva#30 = nIVA;
         #dsmociva#29 = #dsmociva#29 + nBase;
         #dsmociva#31 = #dsmociva#31 + nCuota;
         |ACABA;
     |FINSI;

     |SI #dsmociva#33 = 0;
         #dsmociva#33 = nIVA;
         #dsmociva#32 = #dsmociva#32 + nBase;
         #dsmociva#34 = #dsmociva#34 + nCuota;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO TotalDSMOCIVA;
     #dsmociva#12 = #dsmociva#14 + #dsmociva#17 + #dsmociva#20 + #dsmociva#23 + #dsmociva#26 + #dsmociva#29 + #dsmociva#32;
     #dsmociva#13 = #dsmociva#16 + #dsmociva#19 + #dsmociva#22 + #dsmociva#25 + #dsmociva#28 + #dsmociva#31 + #dsmociva#34;
|FPRC;

|PROCESO GrabaDSMOCIVA;
     |GRABA 020#dsmociva.a;
     |LIBERA #dsmociva;
|FPRC;

|PROCESO eosma100Cas;
     |PARA nCampo = 6;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
           |SI #eosma100#nCampo# ! 0;
                                     nBase  = #eosma100#nCampo#;
               nCampo = nCampo + 1;  nIVA   = #eosma100#nCampo#;
               nCampo = nCampo + 1;  nCuota = #eosma100#nCampo#;

               |HAZ CargaDSMOCIVA;
           |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE eosma100Cas;
     #eosma100#1;
     ;
     "303", #eosm1303#0, #eosm1303#45, #eosm1303#1, #eosm1303#2, nCampoDes;
     "303", #eosm1303#0, #eosm1303#45, #eosm1303#1, #eosm1303#2, nCampoDes;
     ;
     NULL, eosma100Cas;
|FIN;

|PROCESO ConverVentas;
     |SI #eosm1303#5 ! 0;  |O #eosm1303#7 ! 0;
         nCas1 = 1;  nCas2 = 1;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 5;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#8 ! 0;  |O #eosm1303#10 ! 0;
         nCas1 = 1;  nCas2 = 1;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 8;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#11 ! 0;  |O #eosm1303#13 ! 0;
         nCas1 = 1;  nCas2 = 1;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 11; |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

|| Nuevos de Caja
     |SI #eosm1303#88 ! 0;  |O #eosm1303#90 ! 0;
         nCas1 = 1;  nCas2 = 16;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 88;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#91 ! 0;  |O #eosm1303#93 ! 0;
         nCas1 = 1;  nCas2 = 16;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 91;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#94 ! 0;  |O #eosm1303#96 ! 0;
         nCas1 = 1;  nCas2 = 16;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 94; |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
|| ....

     |SI #eosm1303#14 ! 0;  |O #eosm1303#16 ! 0;
         nCas1 = 1;  nCas2 = 10;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 14;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#17 ! 0;  |O #eosm1303#19 ! 0;
         nCas1 = 1;  nCas2 = 10;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 17;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#46 ! 0;  |O #eosm1303#48 ! 0;
         nCas1 = 1;  nCas2 = 10;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 46; |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#58 ! 0;  |O #eosm1303#60 ! 0;
         nCas1 = 1;  nCas2 = 5;
         |HAZ LeeDSMOCIVA;

         nBase  = #eosm1303#58;
         nIVA   = #eosm1303#59;
         nCuota = #eosm1303#60;
         |HAZ CargaDSMOCIVA;

         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#61 ! 0;  |O #eosm1303#63 ! 0;
         nCas1 = 1;  nCas2 = 5;
         |HAZ LeeDSMOCIVA;

         nBase  = #eosm1303#61;
         nIVA   = #eosm1303#62;
         nCuota = #eosm1303#63;
         |HAZ CargaDSMOCIVA;

         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#64 ! 0;  |O #eosm1303#66 ! 0;
         nCas1 = 1;  nCas2 = 5;
         |HAZ LeeDSMOCIVA;

         nBase  = #eosm1303#64;
         nIVA   = #eosm1303#65;
         nCuota = #eosm1303#66;
         |HAZ CargaDSMOCIVA;

         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#67 ! 0;  |O #eosm1303#69 ! 0;
         nCas1 = 1;  nCas2 = 5;
         |HAZ LeeDSMOCIVA;

         nBase  = #eosm1303#67;
         nIVA   = #eosm1303#68;
         nCuota = #eosm1303#69;
         |HAZ CargaDSMOCIVA;

         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#84 ! 0;  |O #eosm1303#85 ! 0;
         || ... nCas1 = 6;  nCas2 = 1;
         nCas1 = 4;  nCas2 = 17;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 84;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
|FPRC;

|PROCESO ConverCompras;
     |SI #eosm1303#70 ! 0;  |O #eosm1303#21 ! 0;
         nCas1 = 2;  nCas2 = 1;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 70;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#75 ! 0;  |O #eosm1303#43 ! 0;
         nCas1 = 2;  nCas2 = 2;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 75;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#71 ! 0;  |O #eosm1303#22 ! 0;
         nCas1 = 2;  nCas2 = 3;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 71;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#76 ! 0;  |O #eosm1303#44 ! 0;
         nCas1 = 2;  nCas2 = 4;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 76;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#72 ! 0;  |O #eosm1303#51 ! 0;
         nCas1 = 2;  nCas2 = 5;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 72;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#77 ! 0;  |O #eosm1303#78 ! 0;
         nCas1 = 2;  nCas2 = 6;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 77;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#73 ! 0;  |O #eosm1303#23 ! 0;
         nCas1 = 2;  nCas2 = 7;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 73;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#74 ! 0;  |O #eosm1303#24 ! 0;
         nCas1 = 2;  nCas2 = 9;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 74;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#79 ! 0;  |O #eosm1303#80 ! 0;
         nCas1 = 2;  nCas2 = 10;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 79;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#54 ! 0;
         nCas1 = 3;  nCas2 = 9;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosm1303#54;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#81 ! 0;
         nCas1 = 3;  nCas2 = 10;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosm1303#81;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#82 ! 0;
         nCas1 = 3;  nCas2 = 4;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosm1303#82;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#30 ! 0;
         nCas1 = 5;  nCas2 = 2;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosm1303#82;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosm1303#86 ! 0;  |O #eosm1303#87 ! 0;
         || nCas1 = 6;  nCas2 = 2;
         nCas1 = 4;  nCas2 = 18;
         |HAZ LeeDSMOCIVA;
         nCampoDes = 86;  |BUCLE eosma100Cas;
         |HAZ TotalDSMOCIVA;
         |HAZ GrabaDSMOCIVA;
    |FINSI;
|FPRC;

|PROCESO ConverOperaciones;
     |ABRE #eosopes2;
     #eosopes2#0 = #eosm1303#0;
     #eosopes2#1 = #eosm1303#45;
     #eosopes2#2 = #eosm1303#1;
     #eosopes2#3 = #eosm1303#2;
     |LEE 000#eosopes2.=;
     |SI FSalida ! 0;  |DDEFECTO #eosopes2;  |FINSI;
     |CIERRA #eosopes2;

     |SI #eosopes2#4 ! 0;
         nCas1 = 3;  nCas2 = 1;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#4;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#26 ! 0;
         nCas1 = 3;  nCas2 = 17;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#26;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#10 ! 0; |Y #eosm1303#81 = 0;
         nCas1 = 3;  nCas2 = 11;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#10;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#11 ! 0;
         nCas1 = 3;  nCas2 = 12;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#11;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#7 ! 0;
         nCas1 = 3;  nCas2 = 4;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#7;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#21 ! 0;
         nCas1 = 3;  nCas2 = 7;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#21;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#24 ! 0;
         nCas1 = 3;  nCas2 = 2;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#24;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#25 ! 0;
         nCas1 = 3;  nCas2 = 3;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#25;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#8 ! 0;
         nCas1 = 3;  nCas2 = 8;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#8;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#5 ! 0;
         nCas1 = 3;  nCas2 = 5;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#5;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#6 ! 0;
         nCas1 = 3;  nCas2 = 6;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#6;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#12 ! 0;
         nCas1 = 3;  nCas2 = 13;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#12;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#13 ! 0;
         nCas1 = 3;  nCas2 = 14;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#13;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

 |SI enDesdePlan = 0; |ACABA; |FINSI;

     |SI #eosopes2#15 ! 0;   ||aqui
         nCas1 = 4;  nCas2 = 1;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#15;
         |HAZ GrabaDSMOCIVA;
     |FINSI;

     |SI #eosopes2#16 ! 0;
         nCas1 = 4;  nCas2 = 2;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#16;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
     |SI #eosopes2#17 ! 0;
         nCas1 = 4;  nCas2 = 3;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#17;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
     |SI #eosopes2#18 ! 0;
         nCas1 = 4;  nCas2 = 4;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#18;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
     |SI #eosopes2#19 ! 0;
         nCas1 = 4;  nCas2 = 6;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#19;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
     |SI #eosopes2#20 ! 0;
         nCas1 = 4;  nCas2 = 8;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#20;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
     |SI #eosopes2#21 ! 0;
         nCas1 = 4;  nCas2 = 16;
         |HAZ LeeDSMOCIVA;
         #dsmociva#12 = #eosopes2#21;
         |HAZ GrabaDSMOCIVA;
     |FINSI;
|FPRC;

|PROCESO CreaDSMOM004;
     |DDEFECTO #dsmom004;
     #dsmom004#0  = enEmpresa;
     #dsmom004#1  = enEjer;
     #dsmom004#2  = enPeriodo;
     #dsmom004#3  = 303;
     #dsmom004#4  = 00;
     #dsmom004#17 = "SIN DATOS";
     #dsmom004#26 = #eosactiv#3;

     |GRABA 020#dsmom004.n;
     |LIBERA #dsmom004;

     #dsmom008#0  = #dsmom004#0;
     #dsmom008#1  = #dsmom004#1;
     #dsmom008#2  = #dsmom004#2;
     #dsmom008#3  = #dsmom004#3;
     #dsmom008#4  = #dsmom004#4;
     #dsmom008#5  = 0;
     #dsmom008#6  = "REGISTRO DE IMPRESION";
     aAlfa        = "REGISTRO DEL MODELO 303 EJERCICIO " + #dsmom008#1;
     aAlfa        = aAlfa + " PERIODO " + (("00" + #dsmom008#2) % -102);
     #dsmom008#8  = aAlfa;
     #dsmom008#11 = "SIN DATOS";

     #dsmom008#12 = 303;
     #dsmom008#13 = "N";

     |GRABA 020#dsmom008.n;
     |LIBERA #dsmom008;
|FPRC;

|PROCESO CreaDSMOM008;
     #dsmom008#0  = #dsmom004#0;
     #dsmom008#1  = #dsmom004#1;
     #dsmom008#2  = #dsmom004#2;
     #dsmom008#3  = #dsmom004#3;
     #dsmom008#4  = #dsmom004#4;
     #dsmom008#5  = enActividad;
     #dsmom008#6  = #eosactiv#6;
     aAlfa        = "REGISTRO DEL MODELO 303 EJERCICIO " + #dsmom008#1;
     aAlfa        = aAlfa + " PERIODO " + (("00" + #dsmom008#2) % -102);
     #dsmom008#8  = aAlfa;
     #dsmom008#11 = "SIN DATOS";

     #dsmom008#12 = 303;
     #dsmom008#7  = "dsmociva";
     #dsmom008#13 = "N";

     |GRABA 020#dsmom008.n;
     |LIBERA #dsmom008;
|FPRC;

|PROCESO eosma100Bor;
     |BORRA 020#eosma100.a;
     |LIBERA #eosma100;
|FPRC;

|DEFBUCLE eosma100Bor;
     #eosma100#1;
     ;
     "303", #eosm1303#0, #eosm1303#45, #eosm1303#1, #eosm1303#2, 000;
     "303", #eosm1303#0, #eosm1303#45, #eosm1303#1, #eosm1303#2, 999;
     be;
     NULL, eosma100Bor;
|FIN;

|PROCESO ConvierteModelo;
     enModelo      = 303;
     enComplem     = 0;

     |ABRE #eosactiv;
     #eosactiv#0 = enEmpresa;
     #eosactiv#1 = enActividad;
     #eosactiv#2 = enEjer - 2000;
     |LEE 000#eosactiv.=;
     |CIERRA #eosactiv;

     |ABRE #dsmom004;
     |ABRE #dsmom008;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = 303;
     #dsmom004#4 = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;
         |HAZ CreaDSMOM004;
     |FINSI;

     #dsmom008#0 = enEmpresa;
     #dsmom008#1 = enEjer;
     #dsmom008#2 = enPeriodo;
     #dsmom008#3 = 303;
     #dsmom008#4 = 0;
     #dsmom008#5 = enActividad;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;
         |HAZ CreaDSMOM008;
     |FINSI;
     |CIERRA #dsmom004;
     |CIERRA #dsmom008;

     enTipoEntrada = 3;   |SUB_EJECUTA "dsmociva";
     enTipoEntrada = 90;  |SUB_EJECUTA "dsmociva";
     enTipoEntrada = 1;

     |ABRE #eosm1303;
     #eosm1303#0  = enEmpresa;
     #eosm1303#45 = enActividad;
     #eosm1303#1  = #eospa303#3;
     #eosm1303#2  = #eospa303#2;
     |LEE 000#eosm1303.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #dsmociva;

     |HAZ ConverVentas;
     |HAZ ConverCompras;
     |HAZ ConverOperaciones;

     |CIERRA #dsmociva;

     enTipoEntrada = 95;  |SUB_EJECUTA "dsmociva";
     enTipoEntrada = 91;  |SUB_EJECUTA "dsmociva";

     |CIERRA #eosm1303;

     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = 303;
     #dsmom004#4 = 0;
     |LEE 101#dsmom004.=;
     |SI FSalida = 0;
         |HAZ ChequeaSituacion;

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;
     |FINSI;
     |CIERRA #dsmom004;

     |SI #eosactiv#51 ! "S";  |ACABA;  |FINSI;

     aAlfa = ":agieos/dsmo3401;";
     aAlfa = aAlfa + (("00000" + enEmpresa) % -105);   || Empresa
     aAlfa = aAlfa + enEjer;                           || Ejercicio
     aAlfa = aAlfa + (("00" + enPeriodo) % -102);      || Periodo
     aAlfa = aAlfa + "340";                            || Modelo
     aAlfa = aAlfa + "00";                             || Complemento
     aAlfa = aAlfa + ("00" + enActividad) % -102;      || Actividad
     aAlfa = aAlfa + "98";                             || Tipo de entrada
     aAlfa = aAlfa + "0";                          || Mensaje

     |SUB_EJECUTA_NP aAlfa;

     |ABRE #eosm1303;
     #eosm1303#0  = enEmpresa;
     #eosm1303#45 = enActividad;
     #eosm1303#1  = #eospa303#3;
     #eosm1303#2  = #eospa303#2;
     |LEE 101#eosm1303.=;
     |SI FSalida = 0;
         |BUCLE eosma100Bor;

         |BORRA 020#eosm1303.a;
         |LIBERA #eosm1303;

         |ABRE #eosopes2;
         #eosopes2#0 = #eosm1303#0;
         #eosopes2#1 = #eosm1303#45;
         #eosopes2#2 = #eosm1303#1;
         #eosopes2#3 = #eosm1303#2;
         |LEE 101#eosopes2.=;
         |SI FSalida = 0; |Y enDesdePlan = 0;
             |BORRA 020#eosopes2.a;
         |FINSI;
         |LIBERA #eosopes2;
         |CIERRA #eosopes2;
     |FINSI;
     |CIERRA #eosm1303;
|FPRC;
