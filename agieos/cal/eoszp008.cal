|FICHEROS;
    eoszp008 #0;
    eosm0001 #1;
    eosm0002 #2;
    eosveaut #4;
|FIN;

|VARIABLES;
         &EURODB     = 0;

         Fecha       = "";
         FechaWay    = @;
         DiaAnyo     = 0;
         DiaSem      = 0;

         Peque       = 0;
         Pasada      = 0;
         Canti       = 0;
         Sumar       = 0;
         Variable    = 0;
         Total       = 0;
         Resto       = 0;
         Did         = 0;
         Repa2       = 0;
         Sumar1      = 0;
         Sumar2      = 0;
         Sumar3      = 0;
         Sumar4      = 0;
         Sumar5      = 0;
         Tpor        = 0;
         xxx         = 0;
         FEstado     = 0;
         Num         = 0;
         ContaVeces  = 0;
         Peso        = 0;
         Campos      = 0;
         Nume        = 0;

         Reparto     = "";
         PrimerDia   = "";
         Tabla       = "";
         Bisiesto    = "";

         Tabla1      = "9416653";
         Tabla2      = "9517753";
         Tabla3      = "9601253";
         Tabla4      = "9713353";
         Tabla5      = "9814453";
         Tabla6      = "9915553";
         Tabla7      = "0006754";
         Tabla8      = "0111153";
         Tabla9      = "0212253";
         Tabla10     = "0313353";
         Tabla11     = "0404553";
         Tabla12     = "0516653";
         Tabla13     = "0617753";
         Tabla14     = "0711153";
         Tabla15     = "0812253";
         Tabla16     = "0914453";
         Tabla17     = "1015553";
         Tabla18     = "1116653";
         Tabla19     = "1207154";
         Tabla20     = "1312253";
         Tabla21     = "1413353";
         Tabla22     = "1514453";

   {400} PesoDia     = 0;
   {400} PesoBueno   = 0;
   {400} CantDiaria  = 0;
|FIN;

|INCLUYE i_random;

|PROCESO Mayus; |TIPO 0;
#0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO Seleccion; |TIPO 0;
Fecha =  "01.01." + #0#7; #0#11 = Fecha;  |PINTA #0#11;
Fecha =  "31.12." + #0#7; #0#12 = Fecha;  |PINTA #0#12;

|SI #0#10 = "S";
    |C_M #0#08, 1, "S";   |C_M #0#09, 1, "S";
    |C_M #0#11, 1, "N";   |C_M #0#12, 1, "N";
|SINO;
    #0#8 = 1;   |PINTA #0#8;
    #0#9 = 55;  |PINTA #0#9;
    |C_M #0#08, 1, "N";   |C_M #0#09, 1, "N";
    |C_M #0#11, 1, "S";   |C_M #0#12, 1, "S";
|FINSI;
|FPRC;

|PROCESO MiraLineas;
|SI Pasada = 1;
    |SI #0#10 = "S";
        |SI #2#2 < #0#8; |O #2#2 > #0#9; |ACABA; |FINSI;
    |FINSI;

    Peso = #2#4  * #2#3; DiaSem = 1; |HAZ MiraPeque;
    Peso = #2#5  * #2#3; DiaSem = 2; |HAZ MiraPeque;
    Peso = #2#6  * #2#3; DiaSem = 3; |HAZ MiraPeque;
    Peso = #2#7  * #2#3; DiaSem = 4; |HAZ MiraPeque;
    Peso = #2#8  * #2#3; DiaSem = 5; |HAZ MiraPeque;
    Peso = #2#9  * #2#3; DiaSem = 6; |HAZ MiraPeque;
    Peso = #2#10 * #2#3; DiaSem = 7; |HAZ MiraPeque;
    |ACABA;
|FINSI;

|PARA xxx = Nume; |SI xxx [ 7; |HACIENDO xxx = xxx + 1;
      |SI #0#10 = "S";
          |SI #2#2 ] #0#8; |Y #2#2 [ #0#9;
              Campos = xxx + 3;
              PesoDia   = ((#2Campos * #2#3) / Peque) ! EURODB;
              Peso      = Peso + PesoDia;
              PesoBueno = 0;
          |SINO;
              PesoDia   = 0;
              PesoBueno = -1;
          |FINSI;
      |SINO;
          Fecha    = "01.01." + #0#7;
          DiaAnyo  = (((#2#2 - 1) * 7) + xxx) - 1;
          FechaWay = Fecha;
          FechaWay = FechaWay + DiaAnyo;
          |SI FechaWay ] #0#11; |Y FechaWay [ #0#12;
              Campos = xxx + 3;
              PesoDia   = ((#2Campos * #2#3) / Peque) ! EURODB;
              Peso      = Peso + PesoDia;
              PesoBueno = 0;
          |SINO;
              PesoDia   = 0;
              PesoBueno = -1;
          |FINSI;
      |FINSI;
      IPesoDia   = IPesoDia   + 1;
      IPesoBueno = IPesoBueno + 1;
|SIGUE;
Nume = 1;
|FPRC;

|PROCESO MiraPeque;
|SI Peso = 0; |ACABA; |FINSI;

|SI #0#10 = "F";
     Fecha    = "01.01." + #0#7;
     DiaAnyo  = (((#2#2 - 1) * 7) + DiaSem) - 1;
     FechaWay = Fecha;
     FechaWay = FechaWay + DiaAnyo;
     |SI FechaWay < #0#11; |O FechaWay > #0#12; |ACABA; |FINSI;
|FINSI;

|SI Peque = 0;       Peque = Peso; |FINSI;
|SI Peque > Peso;    Peque = Peso; |FINSI;
|FPRC;

|DEFBUCLE eosm0002;
#2#1;
;
#0#1, #0#7, 00;
#0#1, #0#7, 99;
;
NULL, MiraLineas;
|FIN;

|PROCESO CargaTabla;
|SI #0#7 = 1994; Tabla = Tabla1;  |FINSI;
|SI #0#7 = 1995; Tabla = Tabla2;  |FINSI;
|SI #0#7 = 1996; Tabla = Tabla3;  |FINSI;
|SI #0#7 = 1997; Tabla = Tabla4;  |FINSI;
|SI #0#7 = 1998; Tabla = Tabla5;  |FINSI;
|SI #0#7 = 1999; Tabla = Tabla6;  |FINSI;
|SI #0#7 = 2000; Tabla = Tabla7;  |FINSI;
|SI #0#7 = 2001; Tabla = Tabla8;  |FINSI;
|SI #0#7 = 2002; Tabla = Tabla9;  |FINSI;
|SI #0#7 = 2003; Tabla = Tabla10; |FINSI;
|SI #0#7 = 2004; Tabla = Tabla11; |FINSI;
|SI #0#7 = 2005; Tabla = Tabla12; |FINSI;
|SI #0#7 = 2006; Tabla = Tabla13; |FINSI;
|SI #0#7 = 2007; Tabla = Tabla14; |FINSI;
|SI #0#7 = 2008; Tabla = Tabla15; |FINSI;
|SI #0#7 = 2009; Tabla = Tabla16; |FINSI;
|SI #0#7 = 2010; Tabla = Tabla17; |FINSI;
|SI #0#7 = 2011; Tabla = Tabla18; |FINSI;
|SI #0#7 = 2012; Tabla = Tabla19; |FINSI;
|SI #0#7 = 2013; Tabla = Tabla20; |FINSI;
|SI #0#7 = 2014; Tabla = Tabla21; |FINSI;
|SI #0#7 = 2015; Tabla = Tabla22; |FINSI;

Bisiesto = Tabla % 301;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
|HAZ CargaTabla;

Peso        = 0;
Peque       = 0;
Pasada      = 1; |BUCLE eosm0002;

PrimerDia   = Tabla % 401;
Nume        = PrimerDia;
Peso        = 0;
IPesoDia    = PesoDia1      <-;
IPesoBueno  = PesoBueno1    <-;
Pasada      = 0; |BUCLE eosm0002;

|HAZ Ventas;
|FPRC;

|PROCESO Ventas;
Canti       =  #0#2 / #0#4;
Sumar       = ((#0#3 / #0#4) / Peso)  ! EURODB;

|HAZ PonFijo;
|HAZ PonVariable;
|FPRC;

|PROCESO PonFijo;
ICantDiaria       = CantDiaria1 <-;
IPesoDia          = PesoDia1    <-;
Total             = 0;
|PARA Variable    = 0; |SI Variable < 400;|HACIENDO Variable = Variable + 1;
      CantDiaria  = Sumar * PesoDia;
      Total       = Total + CantDiaria;
      ICantDiaria = ICantDiaria + 1;
      IPesoDia    = IPesoDia    + 1;
|SIGUE;
|FPRC;

|PROCESO PonVariable;
ContaVeces = 1;
|ET Veces;
    |SI ContaVeces > #0#5;  |VETE Reparto;  |FINSI;

    Resto = Canti - Total;
    Did   = #0#5  + 1 - ContaVeces;
    |SI Resto = 0;  |VETE Termino; |FINSI;

    Repa2  = ((Resto / Did)  - 0.5) ! EURODB;
    Sumar1 = ((Repa2 / Peso) - 0.5) ! EURODB;

    IPesoDia     = PesoDia1    <-;
    ICantDiaria  = CantDiaria1 <-;

    |BLIN 23;
    |ATRI R;
    Reparto = "Repartiendo la " + ContaVeces + "a vez. ";
    |PINTA 2350, Reparto;
    |ATRI 0;

    Total = 0;
    |PARA xxx = 0; |SI xxx < 400; |HACIENDO xxx = xxx + 1;
          |HAZ Random;
          rnd = rnd $  1000;
          rnd = rnd + 1;

          Tpor        = (rnd * (#0#6 * 2) - #0#6) ! EURODB;
          Sumar5      = ((Sumar1 * Tpor) / (10000 * #0#6)) ! EURODB;
          Sumar2      = Sumar1 + Sumar5;
          Sumar3      = Sumar2 * PesoDia;
          CantDiaria  = CantDiaria + Sumar3;
          Total       = Total + CantDiaria;
          IPesoDia    = IPesoDia + 1;
          ICantDiaria = ICantDiaria + 1;
    |SIGUE;

    ContaVeces = ContaVeces + 1;
    |VETE Veces;

|ET Reparto;         ||Reparto del resto;
    Resto = Canti - Total;

    |BLIN  23;
    |ATRI R;
    |PINTA 2350, "Repartiendo el Resto";
    |ATRI 0;
    |SI Resto = 0;  |VETE Termino;  |FINSI;

    Sumar = ((Resto / Peso) - 0.5) ! EURODB;
    |SI Sumar [ 0;  |VETE MasPesetas; |FINSI;

    IPesoDia     = PesoDia1    <-;
    ICantDiaria  = CantDiaria1 <-;
    Total        = 0;
    |PARA xxx = 0; |SI xxx < 400;|HACIENDO xxx = xxx + 1;
          Sumar3      = Sumar       * PesoDia;
          CantDiaria  = CantDiaria  + Sumar3;
          Total       = Total       + CantDiaria;
          IPesoDia    = IPesoDia    + 1;
          ICantDiaria = ICantDiaria + 1;
    |SIGUE;

    |VETE Reparto;

|ET MasPesetas;        || Reparto en ptas;
    |SI Resto < 0;  |VETE MenosPesetas;  |FINSI;

    IPesoDia     = PesoDia1    <-;
    ICantDiaria  = CantDiaria1 <-;

    |PARA xxx   = 0; |SI xxx < 400; |HACIENDO xxx = xxx + 1;
          Sumar     = PesoDia;
          |SI Resto < PesoDia; Sumar = Resto; |FINSI;

          CantDiaria  = CantDiaria   + Sumar;
          Resto       = Resto        - Sumar;

          IPesoDia    = IPesoDia     + 1;
          ICantDiaria = ICantDiaria  + 1;

          |SI Resto = 0;  |SAL;  |FINSI;
    |SIGUE;

    |VETE Termino;

|ET MenosPesetas;        ||Reparto en ptas;

    IPesoDia     = PesoDia1    <-;
    ICantDiaria  = CantDiaria1 <-;
    Resto        = -Resto
    |PARA xxx = 0; |SI xxx < 400; |HACIENDO xxx = xxx + 1;
          Sumar  = PesoDia;
          |SI Resto < PesoDia; Sumar = Resto; |FINSI;

          CantDiaria  = CantDiaria - Sumar;
          Resto       = Resto      - Sumar;

          IPesoDia    = IPesoDia + 1;
          ICantDiaria = ICantDiaria + 1;

          |SI Resto = 0;  |SAL; |FINSI;
    |SIGUE;

|ET Termino;     ||Terminado;

    |BLIN 23;
    |ATRI R;
    |PINTA 2350, " Grabando Registros";
    |ATRI 0;

    ICantDiaria = CantDiaria1 <-;
    Total = 0;
    |PARA xxx = 0; |SI xxx < 400; |HACIENDO xxx = xxx + 1;
          CantDiaria  = CantDiaria  * #0#4;
          Total       = Total       + CantDiaria;   || Solo para comprobar
          ICantDiaria = ICantDiaria + 1;
    |SIGUE;
                                ||Graba fichero de ventas automaticas;

    |ABRE #4;
    #4#0 = #0#0;
    #4#1 = 1;
    |LEE 140#4=;
    FEstado = FSalida;
    |SI FEstado ! 0;  |DDEFECTO #4;  #4#0 = #0#0;  #4#1 = 1; |FINSI;

    ICantDiaria = CantDiaria1 <-;
    IPesoBueno  = PesoBueno1  <-;
    #4#94       = #0#7;
    Num         = 1;
    |PARA xxx = 1;|SI xxx [ 91; |HACIENDO xxx = xxx + 1;
          Num      = Num + 1;
          |SI Num  = 61;
              |SI Bisiesto = "0";
                  |SI PesoBueno = 0; #4Num = CantDiaria; |FINSI;
                  ICantDiaria = ICantDiaria + 1;
                  IPesoBueno  = IPesoBueno  + 1;
              |SINO;
                  #4Num = 0;
              |FINSI;
          |SINO;
              |SI PesoBueno = 0; #4Num = CantDiaria; |FINSI;
              ICantDiaria = ICantDiaria + 1;
              IPesoBueno  = IPesoBueno  + 1;
          |FINSI;
    |SIGUE;
    |SI FEstado = 0; |GRABA 140#4a; |SINO; |GRABA 140#4n; |FINSI;
    |LIBERA #4;

    #4#0 = #0#0;                           ||Graba segundo trimestre
    #4#1 = 2;
    |LEE 110#4=;
    FEstado = FSalida;
    |SI FEstado ! 0;  |DDEFECTO #4;  #4#0 = #0#0;  #4#1 = 2; |FINSI;

    #4#94     = #0#7;
    Num       = 1;
    |PARA xxx = 1;|SI xxx [ 91;|HACIENDO xxx = xxx + 1;
          Num      = Num + 1;
          |SI PesoBueno = 0; #4Num = CantDiaria; |FINSI;
          ICantDiaria = ICantDiaria + 1;
          IPesoBueno  = IPesoBueno  + 1;
    |SIGUE;
    |SI FEstado = 0; |GRABA 140#4a; |SINO; |GRABA 140#4n; |FINSI;
    |LIBERA #4;

    #4#0 = #0#0;                           ||Graba tercer trimestre
    #4#1 = 3;
    |LEE 140#4=;
    FEstado = FSalida;
    |SI FEstado ! 0;  |DDEFECTO #4;  #4#0 = #0#0;  #4#1 = 3; |FINSI;

    #4#94     = #0#7;
    Num       = 1;
    |PARA xxx = 1;|SI xxx [ 92;|HACIENDO xxx = xxx + 1;
          Num = Num + 1;
          |SI PesoBueno = 0; #4Num = CantDiaria; |FINSI;
          ICantDiaria = ICantDiaria + 1;
          IPesoBueno  = IPesoBueno  + 1;
    |SIGUE;
    |SI FEstado = 0; |GRABA 140#4a; |SINO; |GRABA 140#4n; |FINSI;
    |LIBERA #4;

    #4#0 = #0#0;                           ||Graba tercer trimestre
    #4#1 = 4;
    |LEE 140#4=;
    FEstado = FSalida;
    |SI FEstado ! 0;  |DDEFECTO #4;  #4#0 = #0#0;  #4#1 = 4; |FINSI;

    #4#94     = #0#7;
    Num       = 1;
    |PARA xxx = 1;|SI xxx [ 92;|HACIENDO xxx = xxx + 1;
          Num = Num + 1;
          |SI PesoBueno = 0; #4Num = CantDiaria; |FINSI;
          ICantDiaria = ICantDiaria + 1;
          IPesoBueno  = IPesoBueno  + 1;
    |SIGUE;
    |SI FEstado = 0; |GRABA 140#4a; |SINO; |GRABA 140#4n; |FINSI;
    |LIBERA #4;
    |CIERRA #4;
|FPRC;
