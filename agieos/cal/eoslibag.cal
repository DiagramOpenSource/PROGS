|FICHEROS;
     eoslibag #0;
     eosclien #1;
     eosconce #2;
     eosconcd #3;
     eoslinve #4;
     eosclpre #5;
     eosactiv #6;
     eoscolib #8;
     eosconc6 #9;
     eoscabve #10;
     eosw0021 #20;
     eosw0022 #21;
     eosw0044 #99,MANTE;
|FIN;

|VARIABLES;
     XPara       = 0;
     XPara1      = 0;
     Fichero     = "";
     SwTempo     = 0;
     Tecla       = 0;
     Contador    = 0;
     Libro       = "";

     anyo        = "";
     Concep2     = 0;
     Concep6     = "";
     Concepto    = "";
     ConceptoI   = "";
     FEstado     = 0;
     VAralf      = "";
     Fecha1      = @;
     Fecha2      = @;
     x           = 0;
     guion       = "-";
     espacio     = "                                                          ";
     espa        = " ";
     barra       = "\";
     cc          = 0;
     impre_valor = "";
     asc1        = 0;
     asc2        = 0;
     asc3        = 0;
     asc4        = 0;
     asc5        = 0;
     asc6        = 0;
     asc7        = 0;
     asc8        = 0;
     asc9        = 0;
     asc10       = 0;
     asc11       = 0;
     asc12       = 0;
     asc13       = 0;
     asc14       = 0;
     asc15       = 0;
     asc16       = 0;
     asc17       = 0;
     asc18       = 0;
     asc19       = 0;
     asc20       = 0;
     co_asc      = 0;
     d_asc       = 0;
     h_asc       = 0;
     longi       = 0;
     co_co       = 0;
     fec         = "";
     fecha       = @;
     xxx         = 0;
     Registro    = 0;
     Campos1      = 0;
     Campos2      = 0;
     Campos3      = 0;
     Campos4      = 0;
     Campos5      = 0;
     Campos6      = 0;
     Campos7      = 0;
     Campos8      = "";
     Campos9      = "";
     Campos10     = "";
     Campos11     = "";
     Campos12     = "";
     Campos13     = "";
     Campos14     = 0;
     linea1      = 0;
     linea2      = 0;
     linea_a     = 0;
     CalIRPF     = 0;
     TipoCon     = "";

     &RdtoIndice = 0;
     &baser      = 0;
     &baset      = 0;
     &rete       = 0;
     &reca       = 0;
     &rdto       = 0;
     &linea      = 0;
     &ray1       = "";
     &ray2       = "";
     &sw         = 0;
     &vari       = "";
     &vacio      = "                                                                      ";
|FIN;

|INCLUYE i_consul;

|PROCESO Mayusculas;
  #0Campo = #0Campo > #0Campo;
  |PINTA #0Campo;
|FPRC;

|PROCESO Antes37; |TIPO 0;
 |SI #0#30 = "T";
     #0#37 = "R";
 |SINO;
     #0#37 = "F";
 |FINSI;
 |PINTA #0#37;
|FPRC;

|PROCESO PonFecha;
/*
  |SI #0#27 = 0;
      Fecha1  = ~;
      VAralf = Fecha1 % -102;
      #0#27   = VAralf;  |PINTA #0#27;
  |FINSI;
*/

  |SI #0#27 ] 80;
      VAralf = "01.01.19" + #0#27;
  |SINO;
      VAralf = "01.01.20" + (("00" + #0#27) % -102);
  |FINSI;
  Fecha1 = VAralf;

  |SI #0#27 ] 80;
      VAralf = "31.12.19" + #0#27;
  |SINO;
      VAralf = "31.12.20" + (("00" + #0#27) % -102);
  |FINSI;
  Fecha2 = VAralf;
|FPRC;

|PROCESO Seleccion;
  |HAZ PonFecha;

  #0#33 = Fecha1;   |PINTA #0#33;
  #0#34 = Fecha2;   |PINTA #0#34;

  |SI #0#0 = "S";
      |C_M #0#1, 1, "N";   #0#1 = 1;      |PINTA #0#1;
      |C_M #0#2, 1, "N";   #0#2 = 99999;  |PINTA #0#2;
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "S";
      |SIGUE;
  |SINO;
      |C_M #0#1, 1, "S";
      |C_M #0#2, 1, "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |C_M #0XPara, 1, "N";  #0XPara = 0;  |PINTA #0XPara;
      |SIGUE;
  |FINSI;
  |SI #0#30 = "T";
      |C_M #0#33, 1, "N";
      |C_M #0#34, 1, "N";
      |C_M #0#31, 1, "S";
      |C_M #0#32, 1, "S";
  |SINO;
      |C_M #0#33, 1, "S";
      |C_M #0#34, 1, "S";
      |C_M #0#31, 1, "N";  #0#31 = 1;  |PINTA #0#31;
      |C_M #0#32, 1, "N";  #0#32 = 4;  |PINTA #0#32;
  |FINSI;
|FPRC;

|PROCESO Fecha;|TIPO 0;
  |SI #0#33 < Fecha1;|O #0#33 > Fecha2;
       |MENAV "     La fecha no coincide con el a¤o seleccionado.";
       |ERROR;
  |FINSI;
  |SI #0#34 < Fecha1;|O #0#34 > Fecha2;
       |MENAV "     La fecha no coincide con el a¤o seleccionado.";
       |ERROR;
  |FINSI;
  |SI #0#33 > #0#34;
       |MENAV "     La fecha desde es mayor que la fecha hasta.";
       |ERROR;
  |FINSI;
|FPRC;

|| ************************** Procesos para cargar caracteres en impresoras

|PROCESO &carga_asc;
  asc1  = 0; asc2  = 0; asc3  = 0; asc4  = 0; asc5  = 0;
  asc6  = 0; asc7  = 0; asc8  = 0; asc9  = 0; asc10 = 0;
  asc11 = 0; asc12 = 0; asc13 = 0; asc14 = 0; asc15 = 0;
  asc16 = 0; asc17 = 0; asc18 = 0; asc19 = 0; asc20 = 0;
  co_co = 0;
  |PARA co_asc = d_asc; |SI co_asc [ h_asc; |HACIENDO co_asc = co_asc + 1;
        co_co = co_co + 1;
        |SI #8co_asc ! 999;
            |SI co_co = 1;  asc1  = #8co_asc; |FINSI;
            |SI co_co = 2;  asc2  = #8co_asc; |FINSI;
            |SI co_co = 3;  asc3  = #8co_asc; |FINSI;
            |SI co_co = 4;  asc4  = #8co_asc; |FINSI;
            |SI co_co = 5;  asc5  = #8co_asc; |FINSI;
            |SI co_co = 6;  asc6  = #8co_asc; |FINSI;
            |SI co_co = 7;  asc7  = #8co_asc; |FINSI;
            |SI co_co = 8;  asc8  = #8co_asc; |FINSI;
            |SI co_co = 9;  asc9  = #8co_asc; |FINSI;
            |SI co_co = 10; asc10 = #8co_asc; |FINSI;
            |SI co_co = 11; asc11 = #8co_asc; |FINSI;
            |SI co_co = 12; asc12 = #8co_asc; |FINSI;
            |SI co_co = 13; asc13 = #8co_asc; |FINSI;
            |SI co_co = 14; asc14 = #8co_asc; |FINSI;
            |SI co_co = 15; asc15 = #8co_asc; |FINSI;
            |SI co_co = 16; asc16 = #8co_asc; |FINSI;
            |SI co_co = 17; asc17 = #8co_asc; |FINSI;
            |SI co_co = 18; asc18 = #8co_asc; |FINSI;
            |SI co_co = 19; asc19 = #8co_asc; |FINSI;
            |SI co_co = 20; asc20 = #8co_asc; |FINSI;
        |SINO;
            |SAL;
        |FINSI;
  |SIGUE;

  |SI asc1    = 0; |ACABA; |FINSI;

  impre_valor =               &asc1  + &asc2  + &asc3  + &asc4  + &asc5;
  impre_valor = impre_valor + &asc6  + &asc7  + &asc8  + &asc9  + &asc10;
  impre_valor = impre_valor + &asc11 + &asc12 + &asc13 + &asc14 + &asc15;
  impre_valor = impre_valor + &asc16 + &asc17 + &asc18 + &asc19 + &asc20;

  |IMPRIME impre_valor;
|FPRC;

|| **************************** Procesos inicializacion de variables

|PROCESO BorraVar;
  anyo        = "";
  Concep2     = 0;
  Concep6     = "";
  Concepto    = "";
  ConceptoI   = "";
  FEstado     = 0;
  VAralf      = "";
  x           = 0;
  guion       = "-";
  espacio     = "                                                          ";
  espa        = " ";
  barra       = "\";
  longi       = 0;
  co_co       = 0;
  fec         = "";
  xxx         = 0;
  Registro    = 0;
  Campos1      = 0;
  Campos2      = 0;
  Campos3      = 0;
  Campos4      = 0;
  Campos5      = 0;
  Campos6      = 0;
  Campos7      = 0;
  Campos8      = "";
  Campos9      = "";
  Campos10     = "";
  Campos11     = "";
  Campos12     = "";
  Campos13     = "";
  Campos14     = 0;
  linea1      = 0;
  linea2      = 0;
  linea_a     = 0;
  CalIRPF     = 0;
  TipoCon     = "";

  baser      = 0;
  baset      = 0;
  rete       = 0;
  reca       = 0;
  rdto       = 0;
  linea      = 0;
  ray1       = "";
  ray2       = "";
  sw         = 0;
  vari       = "";
  vacio      = "                                                                      ";
|FPRC;

|| ********************************** Procesos grabacion temporal libro

|PROCESO LeeConce;
  |SI #6#50 = 1;
      #2#0 = Concep2;
      |LEE 040#2=;
      |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

      #3#0 = Concep2;
      |LEE 040#3=;
      |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

      Concepto  = #2#0;
      TipoCon   = #2#3;
      CalIRPF   = #2#9;
      Campos8   = #3#1;
      Campos9   = #3#2;
      Campos10  = #3#3;
      Campos11  = #3#4;
      Campos12  = #3#5;
      Campos13  = #3#6;
      Campos14  = #3#7;
  |SINO;
      #9#0 = Concep6;
      |LEE 040#9=;
      |SI FSalida ! 0; |DDEFECTO #9; |FINSI;

      Concepto  = #9#0;
      TipoCon   = #9#3;
      CalIRPF   = #9#9;
      Campos8   = #9#11;
      Campos9   = #9#12;
      Campos10  = #9#13;
      Campos11  = #9#14;
      Campos12  = #9#15;
      Campos13  = #9#16;
      Campos14  = #9#17;
  |FINSI;
|FPRC;

|PROCESO Graba20;
  linea_a  = 0;
  |SI #8#2 = "M"; linea_a = #4#1; |FINSI;
  Registro = Registro + 1;

  #20#0  = Concepto;
  #20#1  = Registro;
  #20#2  = #4#3;
  #20#3  = #4#38;
  #20#4  = #4#13;
  #20#5  = #4#6;
  #20#6  = #4#12;
  #20#7  = #4#15;
  #20#8  = #4#16;
  #20#9  = #4#17;
  #20#10 = Campos1;
  #20#11 = Campos2;
  #20#12 = Campos3;
  #20#13 = linea_a;
  #20#14 = Campos4;
  #20#15 = Campos5;
  #20#16 = Campos6;
  #20#17 = Campos7;
  #20#18 = Campos8;
  #20#19 = Campos9;
  #20#20 = Campos10;
  #20#21 = Campos11;
  #20#22 = Campos12;
  #20#23 = Campos13;
  #20#24 = Campos14;
  |GRABA 140#20n;
|FPRC;

|PROCESO GrabaTempo20;
  Concep2 = #4#5;
  Concep6 = #4#72;
                      |HAZ LeeConce;
  |SI TipoCon = "I";
      |SI CalIRPF = 1; Campos7 = #4#7;                |FINSI;
      |SI CalIRPF = 2; Campos7 = #4#7 + #4#9 + #4#11; |FINSI;
      Campos1 = #4#7;
      Campos2 = #4#39;
      Campos3 = #4#42;
      Campos5 = #4#10;
      Campos6 = #4#11;
      Campos4 = Campos7 * #3#7;
      |HAZ Graba20;
  |FINSI;

  Concep2 = #4#33;
  Concep6 = #4#73;
                      |HAZ LeeConce;
  |SI TipoCon = "I";
      |SI CalIRPF = 1; Campos7 = #4#23;                 |FINSI;
      |SI CalIRPF = 2; Campos7 = #4#23 + #4#27 + #4#31; |FINSI;
      Campos1 = #4#23;
      Campos2 = #4#40;
      Campos3 = #4#43;
      Campos5 = #4#29;
      Campos6 = #4#31;
      Campos4 = Campos7 * #3#7;
      |HAZ Graba20;
  |FINSI;

  Concep2 = #4#34;
  Concep6 = #4#74;
                      |HAZ LeeConce;
  |SI TipoCon = "I";
      |SI CalIRPF = 1; Campos7 = #4#24;                 |FINSI;
      |SI CalIRPF = 2; Campos7 = #4#24 + #4#28 + #4#32; |FINSI;
      Campos1 = #4#24;
      Campos2 = #4#41;
      Campos3 = #4#44;
      Campos5 = #4#30;
      Campos6 = #4#32;
      Campos4 = Campos7 * #3#7;
      |HAZ Graba20;
  |FINSI;

  Concep2 = #4#60;
  Concep6 = #4#75;
                      |HAZ LeeConce;
  |SI TipoCon = "I";
      |SI CalIRPF = 1; Campos7 = #4#45;                 |FINSI;
      |SI CalIRPF = 2; Campos7 = #4#45 + #4#51 + #4#57; |FINSI;
      Campos1 = #4#45;
      Campos2 = #4#66;
      Campos3 = #4#69;
      Campos5 = #4#54;
      Campos6 = #4#57;
      Campos4 = Campos7 * #3#7;
      |HAZ Graba20;
  |FINSI;

  Concep2 = #4#61;
  Concep6 = #4#76;
                      |HAZ LeeConce;
  |SI TipoCon = "I";
      |SI CalIRPF = 1; Campos7 = #4#46;                 |FINSI;
      |SI CalIRPF = 2; Campos7 = #4#46 + #4#52 + #4#58; |FINSI;
      Campos1 = #4#46;
      Campos2 = #4#67;
      Campos3 = #4#70;
      Campos5 = #4#55;
      Campos6 = #4#58;
      Campos4 = Campos7 * #3#7;
      |HAZ Graba20;
  |FINSI;

  Concep2 = #4#62;
  Concep6 = #4#77;
                       |HAZ LeeConce;
  |SI TipoCon = "I";
      |SI CalIRPF = 1; Campos7 = #4#47;                 |FINSI;
      |SI CalIRPF = 2; Campos7 = #4#47 + #4#53 + #4#59; |FINSI;
      Campos1 = #4#47;
      Campos2 = #4#68;
      Campos3 = #4#71;
      Campos5 = #4#56;
      Campos6 = #4#59;
      Campos4 = Campos7 * #3#7;
      |HAZ Graba20;
  |FINSI;
|FPRC;

|DEFBUCLE eoslinve;
  #4#1;
  13, 17, 19;
  #99#0, #99#2, 00001, Fecha1,     1, #99#1;
  #99#0, #99#2, 32000,  #0#34, #0#32, #99#1;
  ;
  NULL, GrabaTempo20;
|FIN;

|DEFBUCLE eoslaFecha;
  #4#2;
  ;
  #99#0, #99#2,     1, #99#1, Fecha1, 00000;
  #99#0, #99#2, #0#32, #99#1, #0#34,  32000;
  ;
  NULL, NULL, NULL, NULL, NULL, GrabaTempo20;
  #4#13, #4#1;
|FIN;

|| ********************************** Procesos de Impresion

|PROCESO Raya;
  sw     = 1; |PRINT;

  cc     = longi - linea - 1;
  linea2 = linea;
  linea  = 100 - cc;
  ray1   = guion * linea;

  sw      = 3; |PRINT;
  sw      = 2;
  espacio = espa * linea;
  linea1  = longi - linea2 - 4;
  |PARA x = 0; |SI x < linea1; |HACIENDO x = x + 1;
        espacio = espacio + espa;
        ray2    = espacio + barra;
        |PRINT;
  |SIGUE;
  sw = 0;
  |PIEINF;
|FPRC;

|PROCESO GrabaResumen;
  #21#0 = #20#0;
  #21#1 = #20#11;
  #21#2 = "T";
  |LIBERA #21;
  |LEE 140#21=;
  |SI FSalida = 0;
      #21#3 = #21#3 + #20#17;
      |GRABA 140#21a;
  |SINO;
      #21#0 = #20#0;
      #21#1 = #20#11;
      #21#2 = "T";
      #21#3 = #20#17;
      |GRABA 140#21n;
  |FINSI;

  #21#0 = #20#0;
  #21#1 = #20#15;
  #21#2 = "R";
  |LIBERA #21;
  |LEE 140#21=;
  |SI FSalida = 0;
      #21#3 = #21#3 + #20#10;
      |GRABA 140#21a;
  |SINO;
      #21#0 = #20#0;
      #21#1 = #20#15;
      #21#2 = "R";
      #21#3 = #20#10;
      |GRABA 140#21n;
  |FINSI;
|FPRC;

|PROCESO Acumula;
  |SI #0#30 = "T";
    |SI #20#9 < #0#31;
        baser = baser + #20#10;
        baset = baset + #20#17;
        rete  = rete  + #20#12;
        reca  = reca  + #20#16;
        rdto  = rdto  + #20#14;
        |HAZ GrabaResumen;
    |FINSI;
|FINSI;

|SI #0#30 = "F";
    |SI #20#4 < #0#1;
        baser = baser + #20#10;
        baset = baset + #20#17;
        rete  = rete  + #20#12;
        reca  = reca  + #20#16;
        rdto  = rdto  + #20#14;
        |HAZ GrabaResumen;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO Imprime;
  |SI ConceptoI = ""; ConceptoI = #20#0; |FINSI;

  |SI ConceptoI ! #20#0;
      |HAZ Raya;
      |SI #8#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;
       ConceptoI = #20#0;
  |FINSI;

  linea_a = linea_a + 1;

  |SI #20#13 = 0; #20#13 = linea_a; |FINSI;

  |PRINT;
  linea = linea + 1;

  |SI linea ] longi;
      sw = 1;  vari = "SUMA Y SIGUE"; |PRINT;
      sw = 10; FSalida = "PAGINA";    |PRINT;
      sw = 0;
  |FINSI;
  vari = "   TOTAL";

  |HAZ GrabaResumen;
|FPRC;

|DEFBUCLE eosw0021_1;
  #20#1;
  ;
  Concepto, 00000;
  Concepto, 99999;
  ;
  NULL, Acumula;
|FIN;

|DEFBUCLE eosw0021_2;
  #20#1;
  4, 9;
  Concepto, 00000, #0#33, #0#31;
  Concepto, 99999, #0#34, #0#32;
  ;
  NULL, Imprime;
|FIN;

|PROCESO AlAtaquer;
  baser    = 0;
  baset    = 0;
  rete     = 0;
  reca     = 0;
  rdto     = 0;
  |SI #6#50 = 1; Concepto = #2#0; |FINSI;
  |SI #6#50 = 2; Concepto = #9#0; |FINSI;

  |SI #8#1 = "T"; |BUCLE eosw0021_1; |FINSI;
  |BUCLE eosw0021_2;
|FPRC;

|DEFBUCLE eosconce;
  #2#1;
  ;
  00;
  99;
  ;
  NULL, AlAtaquer;
|FIN;

|DEFBUCLE eosconc6;
  #9#1;
  ;
  "      ";
  "zzzzzz";
  ;
  NULL, AlAtaquer;
|FIN;

|PROCESO Resumen;
  |PRINT;
|FPRC;

|DEFBUCLE eosw0022;
#21#1;
;
"      ", 00.00, " ";
"zzzzzz", 99.99, "z";
;
NULL, Resumen;
|FIN;

|| *********************** Proceso preparacion del libro

|PROCESO PreparaLibro;
  |PINDA #0#99;

  #1#0 = #99#0;
  |LEE 040#1=;
  |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;

  |ABRE #20;  |CIERRA #20;  |DELINDEX #20;
  |ABRE #21;  |CIERRA #21;  |DELINDEX #21;

  |HAZ BorraVar;

  VAralf  = #99#0;   VAralf = ("00000" + #99#0) % -105;
  Fichero = VAralf;
  VAralf  = #99#2;   VAralf = ("00" + #99#2) % -102;
  Fichero = "v" + Fichero + VAralf;
  |NOME_DAT #4 Fichero;

  #6#0 = #99#0;      || Leo Actividad
  #6#1 = #99#1;
  #6#2 = #99#2;
  |LIBERA #6;
  |LEE 140#6=;
  FEstado = FSalida;

  |ABRE #20;
  |SI #0#37 = "F";
      |BUCLE eoslaFecha;
  |SINO;
      |BUCLE eoslinve;
  |FINSI;
  |CIERRA #20;

  |SI Registro = 0;  |DELINDEX #20;  |ACABA;  |FINSI;

  longi    = #8#7 - 26;
  linea_a  = 0;
  Concep2  = 0;
  Concep6  = "";
  Concepto = "";

  |INFOR "eosliba1";
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  |ABRE #21;
  |SI #6#50 = 1; |CIERRAT #2;  |BUCLE eosconce; |ABRET #2;  |FINSI;
  |SI #6#50 = 2; |CIERRAT #9;  |BUCLE eosconc6; |ABRET #9;  |FINSI;
  |CIERRA #21;
  |HAZ Raya;
  |FININF;
  |SI #8#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;

  linea = 0;
  |INFOR "eosliba2";
  |BUCLE eosw0022;
  |PIEINF;
  |FININF;
  |SI #8#26 = "S"; d_asc = 27; h_asc = 46; |HAZ carga_asc; |FINSI;

  |SI #99#7 = "S";
      #6#19 = #99#6 - 1;
      |SI FEstado = 0; |GRABA 040#6a; |FINSI;
  |FINSI;

  |DELINDEX #20;
  |DELINDEX #21;
|FPRC;

|DEFBUCLE eosw0044;
  #99#1;
  8;
  00000, 0, 00, "S";
  99999, 9, 99, "S";
  ;
  NULL, PreparaLibro;
|FIN;

|| ***************************** Preparacion del Temporal

|PROCESO GrabaTempo;
  #10#0 = #6#0;
  #10#4 = #0#27;
  |LEE 040#10=;
  |SI FSalida ! 0;  |ACABA;  |FINSI;

  #99#0 = #6#0;
  #99#1 = #6#1;
  #99#2 = #0#27;
  |LIBERA #99;
  |LEE 140#99=;
  |SI FSalida = 0;  |ACABA;  |FINSI;

  SwTempo = 1;
  #99#0 = #6#0;
  #99#1 = #6#1;
  #99#2 = #0#27;
  #99#3 = #6#3;
  #99#4 = #6#6;
  #99#5 = #6#19;
  #99#6 = #6#19 + 1;
  #99#7 = "S";
  #99#8 = "S";
  |GRABA 140#99n;
|FPRC;

|DEFBUCLE eosactiv;
  #6#1;
  15, 41;
  #0#1, #0#28, #0#27, "S", "S";
  #0#2, #0#29, #0#27, "S", "S";
  ;
  NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja;
  #99#0 = 00001;
  #99#1 = 0;
  #99#2 = #0#27;
|FRUT;

|RUTINA ClaveAlta;
  #99#0 = 99999;
  #99#1 = 9;
  #99#2 = #0#27;
|FRUT;

|PROCESO Tipo3; |TIPO 3;      || EMPIEZA EL CALCULO
  |ABRE #8;
  |LEE 040#8p;
  |SI FSalida ! 0;
      |MENAV "     No existe control de Libros";
      |ACABA;
  |FINSI;
  |CIERRA #8;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("L4" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #99 Fichero;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("21" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #20 Fichero;
  |ABRE #20;  |CIERRA #20;  |DELINDEX #20;

  Fichero = Usuario % 808;  |QBT Fichero;
  Fichero = ("22" + Fichero + "zzzzzzzz") % 108;
  |NOME_DAT #21 Fichero;
  |ABRE #21;  |CIERRA #21;  |DELINDEX #21;

  |IMPRE 0;
  |SI FSalida ! 0; |ACABA; |FINSI;

  d_asc = 48;  h_asc = 67;  |HAZ carga_asc;

  SwTempo = 0;

  |ABRE #10;
  |ABRE #99;
  |SI #0#0 = "S";
      |PARA XPara = 3; |SI XPara [ 26;  |HACIENDO XPara = XPara + 1;
            |SI #0XPara ! 0;
                #0#1 = #0XPara;
                #0#2 = #0XPara;
                |BUCLE eosactiv;
             |FINSI;
      |SIGUE;
  |SINO;
      |BUCLE eosactiv;
  |FINSI;
  |CIERRA #10;
  |CIERRA #99;

  |SI SwTempo = 0;
      |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
      |FINIMP;
      |ACABA;
  |FINSI;

  |ENTLINEAL #1#99, 3, 4, 20, 1, ClaveBaja, ClaveAlta;

  |ABRET #2;
  |ABRET #9;
  |ABRE #1;
  |ABRE #3;
  |ABRE #5;
  |ABRE #6;
  |BUCLE eosw0044;
  |CIERRA #1;
  |CIERRA #3;
  |CIERRA #5;
  |CIERRA #6;
  |CIERRAT #2;
  |CIERRAT #9;

  |SI #8#26 = "S"; d_asc = 68; h_asc = 87; |HAZ carga_asc; |FINSI;
  |FINIMP;
  |ABRE #99;  |CIERRA #99;  |DELINDEX #99;
|FPRC;

|| ****************************** Procesos del Temporal

|PROCESO Tipo11;  |TIPO 11;
  |SI FSalida ! 9;  |Y FSalida ! 10;  |ACABA;  |FINSI;

  Tecla = FSalida;

  |LIBERA #99;
  |LEE 140#99=;

  |SI Tecla = 9;
        |SI #99#8 = "N";
            #99#8 = "S";
        |SINO;
            #99#8 = "N";
            #99#6 = 0;
            #99#7 = "N";
        |FINSI;
  |FINSI;

  |SI Tecla = 10;
      #99#8 = "S";
      |C_M #99#6, 1, "S";
      |C_M #99#7, 1, "S";
      |ENCAMPO #6#99;
      |ENCAMPO #7#99;
  |FINSI;

  |PINTA #99#6;
  |PINTA #99#7;
  |PINTA #99#8;

  |GRABA 140#99a;

  |C_M #99#6, 1, "N";
  |C_M #99#7, 1, "N";
|FPRC;
