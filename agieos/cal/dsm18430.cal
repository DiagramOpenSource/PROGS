|FICHEROS;
     dsm18430 #0;
     dsm18420,MANTE;
     dsm18401;
     dsm18430;
     dsm18403;
     dsm18405;
     dsm18406;
     dsm18407;
     dsm18408;
     dsm18409;
     dsm18415;
|FIN;

|VARIABLES;
   &eaTabla = ""; &enPosicion = 0; &eaDestino = ""; &enComp = 0;
   &eaAlfa  = ""; &enError    = 0;

   &eaVarDni  = "";
   &enCalcCif = 0;
   &eaCodNif  = "";

   nLCod  = 0;
   nLDes  = 0;
   nCampo = 0;
   nCalc  = 0;
   nCont  = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";

   nImporte  = 0;
   nImporte1 = 0;
   nImporte2 = 0;
   nReducc  = 0;
   nReducc1 = 0;
   nReducc2 = 0;
   nPorc1   = 0;
   nPorc2   = 0;

   nSwClaveD = 0;
   nModo     = 0;
|FIN;

|PROCESO SacaPais30; |TIPO 7;
   eaTabla = "ztabla05.txt";  nLCod = 2; nLDes = 30; |HAZ CargaTabla;
   |MENSA "    <F2> Consulta paises";
|FPRC;

|PROCESO CompPais30;
     |MENSA "     ";
     nCampo   = Campo + 1;

     |SI FSalida = 10;
         enPosicion = 20;
         |HAZ SacaTabla;
         nCalc = 100 + nLCod;
         aAlfa1   = eaDestino % nCalc;
         #dsm18430#Campo#  = aAlfa1; |PINTA #dsm18430#Campo#;
     |FINSI;

     enComp = nLCod;
     aAlfa = "|C" + (("000" + Campo) % -103) + "TIPO"; aAlfa1 = #dsm18430#aAlfa#;
     aAlfa = #dsm18430#Campo#; |QBF aAlfa;
     |SI aAlfa1 = "N"; nCalc = - (100 + nLCod); aAlfa = (("0" * enComp) + aAlfa) % nCalc; |FINSI;
     |SI aAlfa1 ! "N"; nCalc = 100 + nLCod;     aAlfa = (aAlfa + (" " * enComp)) % nCalc; |FINSI;
     eaAlfa = aAlfa; |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     nCalc = 100 + nLCod;                 aAlfa1   = eaDestino % nCalc;
     nCalc = ((nLCod + 2) * 100) + nLDes; aAlfa2   = eaDestino % nCalc;
     #dsm18430#Campo#  = aAlfa1; |PINTA #dsm18430#Campo#;
     #0#35    = aAlfa2; |PINTA #0#35;

     |HAZ FinTabla;
|FPRC;

|PROCESO Linea; |TIPO 11;
   |SI FSalida = 10; |HAZ MiraPantallas; |FINSI;
   |SI FSalida = 11; |HAZ CapturaTodos;  |ERROR; |FINSI;
|FPRC;

|PROCESO AntesC09; |TIPO 14;
   |SI #dsm18430#1 ] 2015;
       |ATRI 0;
       |PINTA 1427, "G) Ganancias y perdidas patrimoniales derivadas ";
       |PINTA 1527, "   de transmisiones de elementos                ";
       |PINTA 1827, "                                                ";
       |PINTA 1927, "                                                ";
       |PINTA 2027, "                                                ";
   |FINSI;
|FPRC;

|PROCESO CalcLetra;
   |SI FSalida = 9;  |HAZ LetraNif;      |FINSI;
|FPRC;

|PROCESO Tipo330; |TIPO 3;
   |PUSHV 0501 2380;
   |PARA nCont = 12; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 12;
         #dsm18420#nCalc# = #dsm18430#nCont#;
   |SIGUE;

   #dsm18420#21 = #dsm18430#43;
   #dsm18420#22 = #dsm18430#44;
   #dsm18420#23 = #dsm18430#45;
   #dsm18420#24 = #dsm18430#46;
   #dsm18420#25 = #dsm18430#47;
   #dsm18420#26 = #dsm18430#48;
   #dsm18420#27 = #dsm18430#49;
   #dsm18420#28 = #dsm18430#50;
   #dsm18420#29 = #dsm18430#51;

   aAlfa1 = "N";
   |SI #dsm18430#1 < 2015;  aAlfa1 = "S"; |FINSI;
   |C_M #dsm18420#27,1,aAlfa1; |C_V #dsm18420#27,1,aAlfa1;
   |C_M #dsm18420#28,1,aAlfa1; |C_V #dsm18420#28,1,aAlfa1;

   |PINPA #0#dsm18420;
   |PINDA #0#dsm18420;
   |ENDATOS #1#dsm18420;
   |SI FSalida = 0;
      |PARA nCont = 12; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 12;
         #dsm18430#nCont# = #dsm18420#nCalc#;
      |SIGUE;
      #dsm18430#43 = #dsm18420#21;
      #dsm18430#44 = #dsm18420#22;
      #dsm18430#45 = #dsm18420#23;
      #dsm18430#46 = #dsm18420#24;
      #dsm18430#47 = #dsm18420#25;
      #dsm18430#48 = #dsm18420#26;
      #dsm18430#49 = #dsm18420#27;
      #dsm18430#50 = #dsm18420#28;
      #dsm18430#51 = #dsm18420#29;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO MiraPantallas;
   |PUSHV 0501 2380;
   |SI FSalida ! 10; |ACABA; |FINSI;
   |LEE 000#dsm18430.=;

   |PARA nCont = 12; |SI nCont [ 32; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 12;
         #dsm18420#nCalc# = #dsm18430#nCont#;
   |SIGUE;

   |PARA nCont = 45; |SI nCont [ 48; |HACIENDO nCont = nCont + 1;
         nCalc = nCont - 22;
         #dsm18420#nCalc# = #dsm18430#nCont#;
   |SIGUE;

   #dsm18420#21 = #dsm18430#43;
   #dsm18420#22 = #dsm18430#44;
   #dsm18420#23 = #dsm18430#45;
   #dsm18420#24 = #dsm18430#46;
   #dsm18420#25 = #dsm18430#47;
   #dsm18420#26 = #dsm18430#48;
   #dsm18420#27 = #dsm18430#49;
   #dsm18420#28 = #dsm18430#50;
   #dsm18420#29 = #dsm18430#51;

   aAlfa1 = "N";
   |SI #dsm18430#1 < 2015;  aAlfa1 = "S"; |FINSI;
   |C_M #dsm18420#27,1,aAlfa1; |C_V #dsm18420#27,1,aAlfa1;
   |C_M #dsm18420#28,1,aAlfa1; |C_V #dsm18420#28,1,aAlfa1;

   |PINPA #0#dsm18420; |PINDA #0#dsm18420; |PAUSA;
   |PINPA #1#dsm18420; |PINDA #1#dsm18420; |PAUSA;
   |PINPA #2#dsm18420; |HAZ AntesC09;
   |PINDA #2#dsm18420; |PAUSA;
   |PINPA #3#dsm18420; |PINDA #3#dsm18420; |PAUSA;
   |PINPA #4#dsm18420; |PINDA #4#dsm18420; |PAUSA;
   |ERROR;
   |POPV;
|FPRC;

|PROCESO ImpM;
   |SI #dsm18415#4 ! "ES";  |ACABA; |FINSI;
   nImporte = nImporte + #dsm18415#6;
|FPRC;

|DEFBUCLE ImpM1;
#dsm18415#1;
5;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001, "G";
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999, "G";
;
NULL,ImpM;
|FIN;

|DEFBUCLE ImpM2;
#dsm18415#1;
5;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001, "P";
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999, "P";
;
NULL,ImpM;
|FIN;

|PROCESO CaptM;
   nImporte = 0;
   |BUCLE ImpM1;
   #dsm18430#49 = nImporte % #dsm18430#11;
   nImporte = 0;
   |BUCLE ImpM2;
   #dsm18430#50 = nImporte % #dsm18430#11;
|FPRC;

|PROCESO CaptK;
   nImporte = #dsm18401#50 + #dsm18401#51 + #dsm18401#52 + #dsm18401#53 + #dsm18401#54;
   #dsm18430#31 = #dsm18401#50 % #dsm18430#11;
   #dsm18430#45 = #dsm18401#51 % #dsm18430#11;
   #dsm18430#46 = #dsm18401#52 % #dsm18430#11;
   #dsm18430#47 = #dsm18401#53 % #dsm18430#11;
   #dsm18430#48 = #dsm18401#54 % #dsm18430#11;
|FPRC;

|PROCESO CaptIJ;
   #dsm18430#23 = " "; #dsm18430#24 = " ";
   |SI #dsm18401#38 = 0; |Y #dsm18401#39 = 0; |Y #dsm18401#40 = 0;
    |Y #dsm18401#41 = 0; |Y #dsm18401#42 = 0; |Y #dsm18401#43 = 0;
       #dsm18430#24 = "X";
       |SI #dsm18401#1 ] 2015;
           #dsm18430#25 = #dsm18401#45 % #dsm18430#11;
           #dsm18430#26 = #dsm18401#46 % #dsm18430#11;
           #dsm18430#27 = #dsm18401#48 % #dsm18430#11;
           #dsm18430#28 = #dsm18401#49 % #dsm18430#11;
           #dsm18430#29 = 0;
           #dsm18430#30 = 0;
       |SINO;
           #dsm18430#25 = #dsm18401#44 % #dsm18430#11;
           #dsm18430#26 = #dsm18401#45 % #dsm18430#11;
           #dsm18430#27 = #dsm18401#46 % #dsm18430#11;
           #dsm18430#28 = #dsm18401#47 % #dsm18430#11;
           #dsm18430#29 = #dsm18401#48 % #dsm18430#11;
           #dsm18430#30 = #dsm18401#49 % #dsm18430#11;
       |FINSI;
   |FINSI;

   |SI #dsm18401#44 = 0; |Y #dsm18401#45 = 0; |Y #dsm18401#46 = 0;
    |Y #dsm18401#47 = 0; |Y #dsm18401#48 = 0; |Y #dsm18401#49 = 0;
       #dsm18430#23 = "X";
       |SI #dsm18430#1 [ 2006; |O #dsm18430#1 ] 2015;
          #dsm18430#25 = #dsm18401#38 % #dsm18430#11;
          #dsm18430#26 = #dsm18401#39 % #dsm18430#11;
          #dsm18430#27 = #dsm18401#40 % #dsm18430#11;
          #dsm18430#28 = #dsm18401#41 % #dsm18430#11;
          |SI #dsm18430#1 < 2015;
              #dsm18430#29 = #dsm18401#42 % #dsm18430#11;
              #dsm18430#30 = #dsm18401#43 % #dsm18430#11;
          |SINO;
              #dsm18430#29 = #dsm18401#43 % #dsm18430#11;
              #dsm18430#30 = #dsm18401#42 % #dsm18430#11;
          |FINSI;
       |SINO;
          #dsm18430#25 = #dsm18401#38 % #dsm18430#11;
          #dsm18430#26 = #dsm18401#39 % #dsm18430#11;
          #dsm18430#27 = #dsm18401#40 % #dsm18430#11;
          #dsm18430#28 = #dsm18401#41 % #dsm18430#11;
          #dsm18430#29 = #dsm18401#43 % #dsm18430#11;
          #dsm18430#30 = 0;
       |FINSI;
   |FINSI;

   |SI #dsm18430#23 = " "; |Y #dsm18430#24 = " ";
      |MENAV "    No se pueden calcular las deducciones automaticamente. Recuerde introducirlas manualmente";
   |FINSI;

   |SI #dsm18430#23 = "X"; |Y #dsm18430#24 = "X";
      #dsm18430#23 = " "; #dsm18430#24 = " ";
   |FINSI;
|FPRC;

|PROCESO ImpG;
   |SI #dsm18409#1 > 2006;
      |SI #dsm18409#9 ! "N"; |O #dsm18409#5 ! "ES"; |ACABA; |FINSI;
   |FINSI;
   nImporte = nImporte + #dsm18409#7;
|FPRC;

|DEFBUCLE ImpG1;
#dsm18409#1;
6;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001, "G";
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999, "G";
;
NULL,ImpG;
|FIN;

|DEFBUCLE ImpG2;
#dsm18409#1;
6;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001, "P";
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999, "P";
;
NULL,ImpG;
|FIN;

|PROCESO CaptG;
   nImporte = 0;
   |BUCLE ImpG1;
   #dsm18430#21 = nImporte % #dsm18430#11;
   nImporte = 0;
   |BUCLE ImpG2;
   #dsm18430#22 = nImporte % #dsm18430#11;
|FPRC;

|PROCESO ImpF;
   |SI #dsm18408#4 ! "ES"; |Y #dsm18408#1 > 2006; |ACABA; |FINSI;
   nImporte = nImporte + #dsm18408#6;
|FPRC;

|DEFBUCLE ImpF1;
#dsm18408#1;
5;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001, "G";
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999, "G";
;
NULL,ImpF;
|FIN;

|DEFBUCLE ImpF2;
#dsm18408#1;
5;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001, "P";
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999, "P";
;
NULL,ImpF;
|FIN;

|PROCESO CaptF;
   nImporte = 0;
   |BUCLE ImpF1;
   #dsm18430#19 = nImporte % #dsm18430#11;
   nImporte = 0;
   |BUCLE ImpF2;
   #dsm18430#20 = nImporte % #dsm18430#11;
|FPRC;

|PROCESO ImpE;
   nImporte = nImporte + #dsm18407#9;
|FPRC;

|DEFBUCLE ImpE;
#dsm18407#1;
;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
;
NULL,ImpE;
|FIN;

|PROCESO CaptE;
   nImporte = 0; nReducc = 0;
   |BUCLE ImpE;
   #dsm18430#18 = nImporte % #dsm18430#11;
|FPRC;

|PROCESO ImpD;
     |SI #dsm18406#7 ! 0; |O #dsm18406#8 ! 0; |O #dsm18406#10 ! 0; |O #dsm18406#11 ! 0;
         nSwClaveD = 1;
     |FINSI;

     nImporte1 = nImporte1 + #dsm18406#9 + #dsm18406#12;
     |SI #dsm18406#4 = 2;
         nImporte2 = nImporte2 + #dsm18406#9 + #dsm18406#12;
     |FINSI;

     nReducc   = nReducc  + #dsm18406#13;
     |SI #dsm18406#26 ! 0;
         nPorc1 = #dsm18406#26;
     |FINSI;
|FPRC;

|DEFBUCLE ImpD;
     #dsm18406#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL,ImpD;
|FIN;

|PROCESO CaptD;
     nImporte1 = 0;
     nImporte2 = 0;
     nReducc   = 0;
     nPorc1    = 0;
     |BUCLE ImpD;

     |SI nReducc > 300000;  |Y nPorc1 = 30;
         nReducc = 300000;
     |FINSI;
     nReducc = nReducc % nPorc1;

     #dsm18430#16 = nImporte1 % #dsm18430#11;
     #dsm18430#17 = nReducc   % #dsm18430#11;

     #dsm18430#51 = 0;
     |SI nImporte2 > 0;
         #dsm18430#51 = (nImporte2 % 5) % #dsm18430#11;
     |FINSI;

     |SI #dsm18430#51 > 2000;
          #dsm18430#51 = 2000;
     |FINSI;
|FPRC;

|PROCESO ImpC;
     nImporte = nImporte + #dsm18405#8;
     nReducc  = nReducc  + #dsm18405#10;

     |SI #dsm18405#9 ! 0;
         nPorc1 = #dsm18405#9;
     |FINSI;
|FPRC;

|DEFBUCLE ImpC;
     #dsm18405#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, ImpC;
|FIN;

|PROCESO CaptC;
     nImporte  = 0;
     nReducc   = 0;
     nPorc1    = 0;
     |BUCLE ImpC;

     |SI nReducc > 300000;  |Y nPorc1 = 30;
         nReducc = 300000;
     |FINSI;
     nReducc = nReducc % nPorc1;

     #dsm18430#14 = nImporte % #dsm18430#11;
     #dsm18430#15 = nReducc  % #dsm18430#11;
|FPRC;

|PROCESO A2015;
     |SI #dsm18403#4 = "S"; |Y #dsm18403#1 > 2006; |ACABA; |FINSI;

     |SI #dsm18403#1 [ 2006;
        nImporte1 = nImporte1 + #dsm18403#8;
        nReducc1  = nReducc1  + #dsm18403#10;
     |SINO;
        |SI #dsm18403#14 = 1;    || Tique 2540_815
           nImporte1 = nImporte1 + #dsm18403#8;
           nReducc1  = nReducc1  + #dsm18403#10;
        |SINO;
           nImporte2 = nImporte2 + #dsm18403#8;
           nReducc2  = nReducc2  + #dsm18403#10;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO A2016;
     |SI #dsm18403#14 = 1;
         nImporte1 = nImporte1 + #dsm18403#8;
         nReducc1  = nReducc1  + #dsm18403#10;

         |SI #dsm18403#9 ! 0;
             nPorc1 = #dsm18403#9;
         |FINSI;
     |FINSI;

     |SI #dsm18403#14 = 2;
         nImporte2 = nImporte2 + #dsm18403#8;
         nReducc2  = nReducc2  + #dsm18403#10;

         |SI #dsm18403#9 ! 0;
             nPorc2 = #dsm18403#9;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ImpA;
     |SI #dsm18403#1 [ 2015;
         |HAZ A2015;
     |FINSI;

     |SI #dsm18403#1 ] 2016;
         |HAZ A2016;
     |FINSI;
|FPRC;

|DEFBUCLE ImpA;
     #dsm18403#1;
     ;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
     #dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
     ;
     NULL, ImpA;
|FIN;

|PROCESO CaptA;
     nImporte1 = 0;
     nImporte2 = 0;
     nReducc1  = 0;
     nReducc2  = 0;
     nPorc1    = 0;
     nPorc2    = 0;
     |BUCLE ImpA;

     |SI #dsm18401#1 [ 2015;
         #dsm18430#12 = nReducc1  % #dsm18430#11;
         #dsm18430#13 = nReducc1  % #dsm18430#11;
         #dsm18430#43 = nImporte2 % #dsm18430#11;
         #dsm18430#44 = nReducc2  % #dsm18430#11;
     |FINSI;

     |SI #dsm18401#1 ] 2016;
         |SI nReducc1 > 300000;  |Y nPorc1 = 30;
             nReducc1 = 300000;
         |FINSI;
         nReducc1 = nReducc1 % nPorc1;

         #dsm18430#12 = nImporte1 % #dsm18430#11;
         #dsm18430#13 = nReducc1  % #dsm18430#11;

         |SI nReducc2 > 300000;  |Y nPorc2 = 30;
             nReducc2 = 300000;
         |FINSI;
         nReducc2 = nReducc2 % nPorc2;

         #dsm18430#43 = nImporte2 % #dsm18430#11;
         #dsm18430#44 = nReducc2  % #dsm18430#11;
     |FINSI;
|FPRC;

|PROCESO Capt;
     nSwClaveD = 0;
     |HAZ CaptA;
     |HAZ CaptC;
     |HAZ CaptD;
     |HAZ CaptE;
     |HAZ CaptF;
     |HAZ CaptG; |HAZ CaptIJ;
     |HAZ CaptK;
     |HAZ CaptM;

     #dsm18430#32 = 0;
     |SI #dsm18430#12 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#14 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#16 ! 0; |O nSwClaveD = 1; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#18 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#19 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#20 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#21 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#22 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#25 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#26 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#27 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#28 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#29 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#30 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#31 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#45 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#46 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#47 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#48 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#49 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;
     |SI #dsm18430#50 ! 0; #dsm18430#32 = #dsm18430#32 + 1; |FINSI;

     |GRABA 020#dsm18430.a;
|FPRC;

|DEFBUCLE CapturaTodos;
#dsm18430#1;
;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 001;
#dsm18401#0, #dsm18401#1, #dsm18401#3, 999;
;
NULL,Capt;
|FIN;

|PROCESO CapturaTodos;
   |SALVA_FICHA #dsm18430;
   |BUCLE CapturaTodos;
   |REPON_FICHA #dsm18430;
|FPRC;
