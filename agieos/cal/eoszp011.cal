|FICHEROS;
     eoszp011 #0;
     eosm0004 #1;
     eoscabco #2;
     eoslinco #3;
     eosclien #4;
     eosm0003 #5;
     eosclpre #6;
|FIN;

|VARIABLES;
     DEmpre  = 0;
     HEmpre  = 0;
     Campos  = 0;
     Divi    = 0;
     Fichero = "";
     VarAnyo = "";
     Linea   = 0;
     Dia     = "";
     Mes     = "";
     Ejer    = "";
     Fecha   = "";
|FIN;

|INCLUYE i_consul;

|PROCESO Mayus; |TIPO 0;
#0Campo = #0Campo > #0Campo;
|PINTA #0Campo;
|FPRC;

|PROCESO Parrilla; |TIPO 0;
|SI #0#4 = "N";
    |PARA Campos = 5; |SI Campos [ 44; |HACIENDO Campos = Campos + 1;
          |C_M #0Campos, 1, "N";  #0Campos = 0;  |PINTA #0Campos;
    |SIGUE;
    |C_M #0#0, 1, "S";   |C_M #0#1, 1, "S";
|SINO;
    |PARA Campos = 4; |SI Campos [ 44; |HACIENDO Campos = Campos + 1;
          |C_M #0Campos, 1, "S";
    |SIGUE;
    |C_M #0#0,  1, "N"; #0#0 = 1;     |PINTA #0#0;
    |C_M #0#1,  1, "N"; #0#1 = 99999; |PINTA #0#1;
|FINSI;
|FPRC;

|PROCESO HazCompra;
#5#0 = #1#1;
|LEE 040#5=;
|SI FSalida ! 0; |DDEFECTO #5; |FINSI;

|SI #5#2 [ 12;
    |SI #5#2 ! #0#3; |ACABA; |FINSI;
|SINO;
    |SI #5#2 = 14;
        Divi = #0#3 $ 2;
        |SI Divi ! 0; |ACABA; |FINSI;
    |FINSI;
    |SI #5#2 = 15;
        Divi = #0#3 $ 3;
        |SI Divi ! 0; |ACABA; |FINSI;
    |FINSI;
    |SI #5#2 = 16;
        |SI #0#3 ! 4; |Y #0#3 ! 8; |Y #0#3 ! 12; |ACABA; |FINSI;
    |FINSI;
    |SI #5#2 = 17;
        Divi = #0#3 $ 6;
        |SI Divi ! 0; |ACABA; |FINSI;
    |FINSI;
|FINSI;

#6#0 = #1#0;
#6#1 = #1#12;
#6#2 = 2;
|LEE 040#6=;
|SI FSalida ! 0; |DDEFECTO #6; |FINSI;

#4#0 = #1#0;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;

|ABRE #2;
#2#0 = #1#0;
#2#4 = #0#2;
|LIBERA #2;
|LEE 140#2=;
|SI FSalida ! 0;
    #2#0 = #1#0;
    #2#4 = #0#2;
    #2#1 = #4#2;
    #2#2 = #4#1;
    #2#3 = 2;
    #2#5 = 0;
    #2#6 = 0;
    #2#7 = 0;
    #2#8 = 0;
    #2#9 = 0;
    |GRABA 140#2b;
|FINSI;

Fichero = #1#0;
Fichero = ("00000" + Fichero) % -105;
Fichero = Fichero % -105;
VarAnyo = #0#2;
VarAnyo = ("00" + VarAnyo) % -102;
Fichero = "c" + Fichero + VarAnyo;
|NOME_DAT #3Fichero;

|ABRE #3;
|LEE 040#3u;
Linea = #3#1;
|SI FSalida ! 0; Linea = 0; |FINSI;
Linea = Linea + 1;

Dia   = #5#3;
Dia   = ("00" + Dia) % -102;
Mes   = #0#3;
Mes   = ("00" + Mes) % -102;

|SI #0#2 > 80;
    Ejer  = "19" + (("00" + #0#2) % -102);
|SINO;
    Ejer  = "20" + (("00" + #0#2) % -102);
|FINSI;

Fecha = Dia + "." + Mes + "." + Ejer;

|DDEFECTO #3;
#3#0  = #1#0;
#3#1  = Linea;
#3#2  = 2;
#3#3  = #1#12;
#3#4  = Dia + Mes;
#3#5  = #1#4;
#3#6  = #1#6;
#3#7  = #1#7;
#3#8  = #1#8;
#3#9  = #3#7 % #3#8;
#3#10 = #1#9;
#3#11 = #3#7 % #3#10;
#3#12 = #6#3;
#3#13 = Fecha;
#3#14 = #0#2;

|SI #0#3 [ 12; #3#17 = 4; |FINSI;
|SI #0#3 [ 9;  #3#17 = 3; |FINSI;
|SI #0#3 [ 6;  #3#17 = 2; |FINSI;
|SI #0#3 [ 3;  #3#17 = 1; |FINSI;

#3#19 = #1#11;
#3#35 = #1#5;
|SI #1#16 ! "                    "; #3#35 = #1#16; |FINSI;
#3#38 = #6#4;
#3#39 = #1#10;
#3#42 = #3#7 % #3#39;
#3#22 = #3#7 + #3#9 + #3#11 - #3#42;
#3#72 = #1#15;
|GRABA 140#3n;
|LIBERA #3;
|CIERRA #3;

#2#5 = #2#5 + #3#7;
#2#6 = #2#6 + #3#9;
#2#7 = #2#7 + #3#11;
#2#9 = #2#9 + #3#42;
#2#8 = #2#5 + #2#6  + #2#7  - #2#9;
|GRABA 140#2a;
|FPRC;

|DEFBUCLE eosm0004;
#1#1;
;
DEmpre, 01;
HEmpre, 99;
;
NULL, HazCompra;
|FIN;

|PROCESO Tipo3; |TIPO 3;
|ABRE #2;
|ABRE #4;
|ABRE #5;
|ABRE #6;

|SI #0#4 = "N";
    DEmpre = #0#0;
    HEmpre = #0#1;
    |BUCLE eosm0004;
|SINO;
    |PARA Campos = 5; |SI Campos [ 44; |HACIENDO Campos = Campos + 1;
          |SI #0Campos ! 0;
              DEmpre = #0Campos;
              HEmpre = #0Campos;
              |BUCLE eosm0004;
          |FINSI;
    |SIGUE;
|FINSI;

|CIERRA #2;
|CIERRA #4;
|CIERRA #5;
|CIERRA #6;
|FPRC;
