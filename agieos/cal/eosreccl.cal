|FICHEROS;
   eosreccl #0;
   eoslinve #1;
   eosclpre #2;
   eoscabve #3;
   eosactiv #4;
   eosclipr #5;
   eosaplic #96;
   :/agicli/def/agicontr #97;
|FIN;

|VARIABLES;
   mensa   = " Estoy recalculando, esperese Por Favor ";
   fichero = "";
   anyo    = "";
   d_agicli  = "";
   p_agicli  = "";
|FIN;

|INCLUYE i_consul;
|INCLUYE i_anyode;

|PROCESO de_donde; |TIPO 8;
|ABRE #96;
|LEE 040#96p;
|SI FSalida ! 0; |DDEFECTO #96; |FINSI;
|CIERRA #96;

|DBASS d_agicli;
|PATH_DAT #97 d_agicli;

|SI #96#11 = 1; |ACABA; |FINSI;

|ABRE #97;
|LEE 040#97p;
|SI FSalida ! 0; |CIERRA #97; |ACABA; |FINSI;
|CIERRA #97;

d_agicli = #97#8; |QBF d_agicli;
|SI d_agicli = "*"; |ACABA; |FINSI;
p_agicli = (d_agicli - "fich/") + "pan/";

|PATH_DAT #5 d_agicli;
|PATH_PAN #5 p_agicli;

|C_V #5#14, 1, "S";
|C_M #5#14, 1, "S";
|FPRC;

|PROCESO pinta_anyo; |TIPO 7;
|HAZ i_anyodef;
#0#2 = i_anyodef;
|PINTA #0#2;
|FPRC;

|CALCULO cero;
#2#16 = 0;
#2#17 = 0;
|GRABA 121#2a;
|LIBERA #2;
|FCAL;

|DEFBUCLE puestaa0;
#2#1;
;
#0#0, 1, 00000;
#0#1, 1, 99999;
be;
NULL,cero;
|FIN;

|CALCULO acumula;
#4#0 = #1#0;
#4#1 = #1#19;
#4#2 = #0#2;
|LEE 040#4=;
|SI FSalida ! 0; |DDEFECTO #4; |FINSI;

|DDEFECTO #2;
#2#0 = #1#0; #2#2 = 1; #2#1 = #1#3;
|LIBERA #2;
|LEE 110#2=;
|SI FSalida = 0;
    |HAZ carga_clie;
    |SI #1#8 ! 0;
        #2#17 = #2#17 + (#1#7 + #1#9 + #1#11 - #1#42);
    |SINO;
        #2#16 = #2#16 + #1#7;
    |FINSI;

    |SI #1#25 ! 0;
        #2#17 = #2#17 + (#1#23 + #1#27 + #1#31 - #1#43);
    |SINO;
        #2#16 = #2#16 + #1#23;
    |FINSI;

    |SI #1#26 ! 0;
        #2#17 = #2#17 + (#1#24 + #1#28 + #1#32 - #1#44);
    |SINO;
        #2#16 = #2#16 + #1#24;
    |FINSI;

    |SI #1#48 ! 0;
        #2#17 = #2#17 + (#1#45 + #1#51 + #1#57 - #1#69);
    |SINO;
        #2#16 = #2#16 + #1#45;
    |FINSI;

    |SI #1#49 ! 0;
        #2#17 = #2#17 + (#1#46 + #1#52 + #1#58 - #1#70);
    |SINO;
        #2#16 = #2#16 + #1#46;
    |FINSI;

    |SI #1#50 ! 0;
        #2#17 = #2#17 + (#1#47 + #1#53 + #1#59 - #1#71);
    |SINO;
        #2#16 = #2#16 + #1#47;
    |FINSI;
    |GRABA 121#2a;
|SINO;
    |DDEFECTO #2;
    #2#0 = #1#0;
    #2#2 = 1;
    #2#1 = #1#3;
    |HAZ carga_clie;

    |SI #1#8 ! 0;
        #2#17 = #1#7 + #1#9 + #1#11 - #1#42;
    |SINO;
        #2#16 = #1#7;
    |FINSI;

    |SI #1#25 ! 0;
        #2#17 = #1#23 + #1#27 + #1#31 - #1#43;
    |SINO;
        #2#16 = #1#23;
    |FINSI;

    |SI #1#26 ! 0;
        #2#17 = #1#24 + #1#28 + #1#32 - #1#44;
    |SINO;
        #2#16 = #1#24;
    |FINSI;

    |SI #1#48 ! 0;
        #2#17 = #1#45 + #1#51 + #1#57 - #1#69;
    |SINO;
        #2#16 = #1#45;
    |FINSI;

    |SI #1#49 ! 0;
        #2#17 = #1#46 + #1#52 + #1#58 - #1#70;
    |SINO;
        #2#16 = #1#46;
    |FINSI;

    |SI #1#50 ! 0;
        #2#17 = #1#47 + #1#53 + #1#59 - #1#71;
    |SINO;
        #2#16 = #1#47;
    |FINSI;
    |GRABA 121#2n;
|FINSI;
|FCAL;

|PROCESO carga_clie;
#5#0 = #1#12;
|LEE 040#5=;
|SI FSalida = 0; |Y #5#0 ! "            ";
    #2#3 = #5#0;
    #2#4 = #5#1;
    #2#5 = #5#2;
    #2#6 = #5#3;
    #2#7 = #5#4;
    #2#8 = #5#5;
    #2#9 = #5#6;
    #2#10 = #5#7;
    #2#11 = #5#8;
    #2#12 = #5#9;
    #2#13 = #5#10;
    #2#14 = #5#11;
    #2#15 = #5#12;
    #2#18 = #5#13;
|SINO;
    #2#3 = #1#12;
    #2#4 = #1#38;
|FINSI;
|FPRC;

|DEFBUCLE lineas;
#1#1;
;
#3#0, #3#4, 00001;
#3#0, #3#4, 32000;
e;
NULL, acumula;
|FIN;

|PROCESO monta;
fichero = #3#0;
fichero = "00000" + fichero;
fichero = fichero % -105;
anyo    = #3#4;
anyo    = "00" + anyo;
anyo    = anyo % -102;
fichero = "v" + fichero + anyo;
|NOME_DAT #1fichero;
|BUCLE lineas;
|FPRC;

|DEFBUCLE cabecera;
#3#1;
;
#0#0, #0#2;
#0#1, #0#2;
e;
NULL,monta;
|FIN;

|CALCULO pase; |TIPO 3;
|ATRI R;
|PINTA 2340,mensa;
|ATRI 0;
|BUCLE puestaa0;  || Pone los clientes a cero

|ABRE #2;
|ABRE #4;
|ABRE #5;
|BUCLE cabecera;  || Acumula los Clientes
|CIERRA #2;
|CIERRA #4;
|CIERRA #5;
|FCAL;
