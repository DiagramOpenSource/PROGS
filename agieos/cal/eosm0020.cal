|FICHEROS;
     eosm0020 #0;
     eosactiv #1;
     eoscomul #2;

     eosm0017 #17;
     eosm0020@ #1131;

     eosclien  #1000;
|FIN;

|VARIABLES;
     nInkey     = 0;
     Modo       = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo     = 0;
     Campo1     = 0;
     Campo2     = 0;
     Campo3     = 0;
     Campo4     = 0;
     Campo5     = 0;
     Campo6     = 0;
     Campo7     = 0;
     MEmpresa   = 0;
     MAnyo      = 0;
     MPeriodo   = 0;

     NActivida  = 0;
     LEpigrafe  = "";
     NEpigrafe  = "";
     REpigrafe  = 0;
     PEpigrafe  = 0;
     CEpigrafe  = 0;

     NActivida1  = 0;
     NActivida2  = 0;
     NActivida3  = 0;
     NActivida4  = 0;
     NActivida5  = 0;

     TEpigrafe1 = "";
     TEpigrafe2 = "";
     TEpigrafe3 = "";
     TEpigrafe4 = "";
     TEpigrafe5 = "";

     LEpigrafe1 = "";
     LEpigrafe2 = "";
     LEpigrafe3 = "";
     LEpigrafe4 = "";
     LEpigrafe5 = "";

     NEpigrafe1 = "";
     NEpigrafe2 = "";
     NEpigrafe3 = "";
     NEpigrafe4 = "";
     NEpigrafe5 = "";

     Forma     = 0;
     SwEstar   = 0;
     SwLeer    = 0;
     nHPer     = 0;
     aBase     = "";
     aMas      = "";

     nSumaD    = 0;
     nSwNeg    = 0;
     nResto    = 0;
     nNume1    = 0;
     nPer131   = 0;

     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     aAlfa4    = "";
     aAlfa5    = "";
     aAlfa6    = "";
     nPanta    = 0;

     nTope     = 0;
     nTope131  = 0;
     nEjer     = 0;
     nSuma     = 0;
     nAgra     = 0;
|FIN;

|INCLUYE i_vareos;
|INCLUYE i_seguim;
|INCLUYE i_devolv;

|PROCESO Archivado; |TIPO 7;
  |SI #0#4 = "S";
      |MENAV "     Registro archivado, DESARCHIVELO";
      |PTEC 807;
  |FINSI;
|FPRC;

|PROCESO LeeActiv;  |TIPO 0;
  Campo1 = Campo + 1;
  Campo2 = Campo + 2;
  Campo3 = Campo + 3;
  Campo4 = Campo + 4;
  Campo5 = Campo + 5;
  Campo6 = Campo + 6;

  |C_M #0Campo4, 1, "S";  |C_M #0Campo5, 1, "S";

  |SI #0Campo = 0;
      |C_M #0Campo4, 1, "N";  |C_M #0Campo5, 1, "N";

      #0Campo1 = "N";   |PINTA #0Campo1;
      #0Campo2 = "";    |PINTA #0Campo2;
      #0Campo3 = "";    |PINTA #0Campo3;
      #0Campo4 = 0;     |PINTA #0Campo4;
      #0Campo5 = 0;     |PINTA #0Campo5;
      #0Campo6 = 0;     |PINTA #0Campo6;
      |ACABA;
  |FINSI;

  |SI #0Campo1 = "C";
      |C_M #0Campo4, 1, "N";  |C_M #0Campo5, 1, "N";
      |ACABA;
  |FINSI;

  |ABRE #1;
  #1#0 = #0#0;
  #1#1 = #0Campo;
  #1#2 = #0#1;
  |LEE 040#1=;
  |SI FSalida ! 0;
      |MENAV "      No existe la actividad";
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #1;

                   #0Campo1 = "N";
  |SI #1#46 = "S"; #0Campo1 = "S";  |FINSI;
  |SI #1#14 = "S"; #0Campo1 = "C";  |FINSI;

  |SI #0Campo1 = "C";
      |C_M #0Campo4, 1, "N";  |C_M #0Campo5, 1, "N";
  |FINSI;

                       |PINTA #0Campo1;
  #0Campo2 = #1#4;     |PINTA #0Campo2;
  #0Campo3 = #1#5;     |PINTA #0Campo3;
|FPRC;

|PROCESO Retenciones;  |TIPO 7;
     |SI #0#1 [ 6;  |O #0#1 ] 80;
         |PUSHV 0501 2380;
         |BLANCO 1742 2180;
         |CUADRO 1742 2180;

         |PINTA 1844, "Retenciones no agricolas:";
         |PINTA 2044, "Retenciones agricolas ..:";

         E_inf = -9999999.99
         E_sup = 9999999.99;

         nCampo1 = #0#41;
         nCampo2 = #0#45;

         |PINTA 1870, nCampo1;
         |PINTA 2070, nCampo2;

         |ET nCampo1;
             nCampo1 = 1870 ? 1;

         |ET nCampo2;
             nCampo2 = 2070 ? 1;
             |SI FSalida = 2;  |VETE nCampo1;  |FINSI;

         #0#41 = nCampo1;
         #0#45 = nCampo2;
         #0#54 = #0#41 + #0#45;

         |POPV;

         |PINTA #0#54;
     |FINSI;
     |SI #0#1 ] 15;
         |MENSA "0000<F7> Introducir Rendimiento Ejer. Anterior para Minoracion";
     |FINSI;

|FPRC;

|CALCULO DespuesRet; |TIPO 0;
 |BLIN 4;
 nInkey = FSalida;
 |SI nInkey = 15; |Y  #0#1 ] 15;
     enMod130 = 131;
     enEmp130 = #0#0;
     enEje130 = #0#1;
     |SUB_EJECUTA "eosz0099";
     |HAZ PintaCalculo;
     |ERROR;
 |FINSI;
|FCAL;

|CALCULO Tipo13; |TIPO 13;
 Modo  = (FEntrada / 100) ! 0;
 |SI Modo < 1; |ACABA; |FINSI;

 nPanta = 1;
 |SI #0#1 ] 8; |Y #0#1 [ 80;
     nPanta = 2;
     |SI #0#1 = 8; |Y #0#2 = 1;
         nPanta = 1;
     |FINSI;
 |FINSI;

 |SI nPanta = 1;
     |C_V #0#59, 1, "N";
     |C_V #0#61, 1, "N";
     |C_P #0#55, 1,1670;
     |C_P #0#56, 1,1770;
     |C_P #0#57, 1,1870;
     |C_P #0#58, 1,1970;

     aAlfa1 = "³ Diferencia .............:";
     aAlfa2 = "³ Resultado Neg.Anteriores:";
     aAlfa3 = "³ Total ..................:";
     aAlfa4 = "´ Ingresos anteriores ....:";
     aAlfa5 = "ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´";
     aAlfa6 = "³                                    ";
 |SINO;
     |C_V #0#59, 1, "S";
     |C_V #0#61, 1, "S";
     |C_P #0#55, 1, 1770;
     |C_P #0#56, 1, 1870;
     |C_P #0#57, 1, 2070;
     |C_P #0#58, 1, 2170;
     |SI #0#1 < 15;
         aAlfa1 = "³ Minoracion (Art.80) ....:";
     |SINO;
         aAlfa1 = "³ Minoracion (Art.110.3.c):";
     |FINSI;
     aAlfa2 = "³ Diferencia .............:           ³";
     aAlfa3 = "³ Resultado Neg.Anteriores:           ³";
     aAlfa4 = "³ Prestamo vivienda hab.  :           ³";
     aAlfa5 = "´ Total ..................:           ³";
     aAlfa6 = "³ Ingresos anteriores ....:           ³";
 |FINSI;
 |PINTA 1642, aAlfa1;
 |PINTA 1742, aAlfa2;
 |PINTA 1842, aAlfa3;
 |PINTA 1942, aAlfa4;
 |PINTA 2042, aAlfa5;
 |PINTA 2142, aAlfa6;
|FCAL;

|CALCULO DesTrim; |TIPO 0;
 nInkey = FSalida;
 |HAZ Tipo13;

 |SI nInkey = 15; |Y  #0#1 ] 15;
     enMod130 = 131;
     enEmp130 = #0#0;
     enEje130 = #0#1;
     |SUB_EJECUTA "eosz0099";
     |ERROR;
 |FINSI;
|FCAL;

|PROCESO ParaCalMinor131;
  #1#0 = #0#0;
  #1#1 = enAct130;
  #1#2 = #0#1;
  |LEE 040#1=;
  |SI FSalida = 0;
     enMod130 = 131;
     enEmp130 = #0#0;
     enEje130 = #0#1;
     enPer130 = #0#2;
     efFec130 = #1#48;
     enRend_Agr   = 0;
     enRend_NoAgr = #0nCampo;
     |SI #1#41 = "S"; |Y nAgra = 0;
         enRend_Agr = #0#43;
         nAgra = 1;
     |FINSI;
     |HAZ LeoDias;
     |HAZ eGrabadsmom094;
  |FINSI;
|FPRC;

|PROCESO BuscoAgraria;
     enAct130 = #1#1;
     enMod130 = 131;
     enEmp130 = #0#0;
     enEje130 = #0#1;
     enPer130 = #0#2;
     efFec130 = #1#48;
     enRend_NoAgr = 0;
     enRend_Agr   = #0#43;
     |HAZ LeoDias;
     |HAZ eGrabadsmom094;
     |ERROR10;
|FPRC;

|DEFBUCLE BuscoAgraria;
  #1#1;
  41;
  #0#0, 1, #0#1, "S";
  #0#0, 6, #0#1, "S";
  ;
  NULL, BuscoAgraria;
|FIN;

|PROCESO LeoDias;
     enDias130 = 0;
     #17#0 = enEmp130;
     #17#1 = enAct130;
     #17#5 = enEje130;
     |LEE 001#17=;
     |SI FSalida = 0;
         |SI enPer130 = 1; enDias130 = #17#129; |FINSI;
         |SI enPer130 = 2; enDias130 = #17#130; |FINSI;
         |SI enPer130 = 3; enDias130 = #17#131; |FINSI;
         |SI enPer130 = 4; enDias130 = #17#132; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Actualm0094;
     nAgra = 0;
     |ABRE #17;
     |ABRE #1;
     |SI #0#6  ! "S"; |Y #0#5 ! 0;
         enAct130 = #0#5;
         nCampo   = 9;
         |HAZ ParaCalMinor131;
     |FINSI;
     |SI #0#13 ! "S"; |Y #0#12 ! 0;
         enAct130 = #0#12;
         nCampo   = 16;
         |HAZ ParaCalMinor131;
     |FINSI;
     |SI #0#20 ! "S"; |Y #0#19 ! 0;
         enAct130 = #0#19;
         nCampo   = 23;
         |HAZ ParaCalMinor131;
     |FINSI;
     |SI #0#27 ! "S"; |Y #0#26 ! 0;
         enAct130 = #0#26;
         nCampo   = 30;
         |HAZ ParaCalMinor131;
     |FINSI;
     |SI #0#34 ! "S"; |Y #0#33 ! 0;
         enAct130 = #0#33;
         nCampo   = 37;
         |HAZ ParaCalMinor131;
     |FINSI;
     |CIERRA #1;
     |SI nAgra = 0;
         |BUCLE BuscoAgraria;
     |FINSI;
     |CIERRA #17;
|FPRC;

|CALCULO Nuevo2008; |TIPO 0;
     enSwApli = 0;
     enMod130 = 131;
     enEmp130 = #0#0;
     enEje130 = #0#1;
     enPer130 = #0#2;
     enRend_NoAgr = #0#60;
     enRend_Agr   = #0#43;
     eaNombreAp   = #1000#2;
     |HAZ eLeeAplica;

     #0#59 = 0;
     |SI nEjer = 2008; |Y eaAplica1 ! "N";
         |SI #0#2 = 2;  #0#59 = 200;  |FINSI;
         |SI #0#2 = 3;  #0#59 = 100;  |FINSI;
         |SI #0#2 = 4;  #0#59 = 100;  |FINSI;
     |FINSI;

     |SI nEjer = 2009; |Y eaAplica1 ! "N";
         |SI #0#2 = 1;  #0#59 = 100;  |FINSI;
         |SI #0#2 = 2;  #0#59 = 100;  |FINSI;
         |SI #0#2 = 3;  #0#59 = 100;  |FINSI;
         |SI #0#2 = 4;  #0#59 = 100;  |FINSI;
     |FINSI;

     |SI nEjer ] 2010; |Y eaAplica1 ! "N";
         #0#59 = enApli400;
     |FINSI;

     #0#61 = 0;
     |SI nEjer ] 2009; |Y eaAplica2 = "S";
         |SI #0#40 ! 0;
             #0#61 = (#0#60 % .5) + (#0#51 % 2);
         |SINO;
             #0#61 = #0#43 % 2;
         |FINSI;

         |HAZ CapturaTope;

         |SI enAplica3 = 0;
             nTope = 660.14 - nTope131;
         |SINO;
             nTope = 440 - nTope131;
         |FINSI;
         |SI nTope < 0;  nTope = 0;  |FINSI;
         |SI #0#61 > nTope;
             #0#61 = nTope;
         |FINSI;
     |FINSI;
|FCAL;

|PROCESO eosm0020_1;
     |SI #1131#47 < 0; nSwNeg = 1; |FINSI;

     |SI #1131#47 ] 0;  |Y nSwNeg = 0; |ACABA;  |FINSI;

     nSumaD = nSumaD + #1131#55;

     |SI #1131#47 < 0;
         #0#56 = #0#56 + -#1131#47;
     |SINO;
         #0#56 = #0#56 - #1131#55;
         |SI #0#56 [ 0; nSwNeg = 0; #0#56 = 0; nSumaD = 0; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE eosm0020_1;
     #1131#1003;
     ;
     #0#0, #0#1,     1;
     #0#0, #0#1, nHPer;
     ;
     NULL, eosm0020_1;
|FIN;

|PROCESO CapturaNegativos131;
     #0#56 = 0;
     |SI #0#55 [ 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/eosm0020.mas";
     |CARGA_DEF aMas, eosm0020@;

     nSwNeg   = 0;
     nSumaD   = 0;
     #0#56    = 0;
     nHPer    = #0#2 - 1;
     |BUCLE eosm0020_1;

     |DESCARGA_DEF #eosm0020@;
|FPRC;

|PROCESO eosm0020Tope;
     nTope131 = nTope131 + #1131#61;
|FPRC;

|DEFBUCLE eosm0020Tope;
     #1131#1003;
     ;
     #0#0, #0#1,     1;
     #0#0, #0#1, nHPer;
     ;
     NULL, eosm0020Tope;
|FIN;

|PROCESO CapturaTope;
     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/eosm0020.mas";
     |CARGA_DEF aMas, eosm0020@;

     nHPer    = #0#2 - 1;
     nTope131 = 0;
     |BUCLE eosm0020Tope;

     |DESCARGA_DEF #eosm0020@;
|FPRC;

|PROCESO CalculaDed131;
     #0#55 = #0#53 - #0#54 - #0#59;

     |SI #0#55 [ 0;
         #0#56 = 0;
         #0#61 = 0;
         |ACABA;
     |FINSI;

     |SI nEjer ] 2008;  |Y #0#2 > 1;
         |HAZ CapturaNegativos131;
     |FINSI;

     nSuma = #0#56 + #0#61;
     |SI nSuma > #0#55;
         |SI #0#56 > #0#55;
             #0#56 = #0#55;
             #0#61 = 0;
             |ACABA;
         |FINSI;

         #0#61 = #0#55 - #0#56;
     |FINSI;
|FPRC;

|PROCESO Calculo;
     #0#11 = #0#09 % #0#10;
     #0#18 = #0#16 % #0#17;
     #0#25 = #0#23 % #0#24;
     #0#32 = #0#30 % #0#31;
     #0#39 = #0#37 % #0#38;

     #0#40 = 0;
     #0#60 = 0;
     |SI #0#6  ! "S";  #0#40 = #0#40 + #0#11;  #0#60 = #0#60 + #0#9;  |FINSI;
     |SI #0#13 ! "S";  #0#40 = #0#40 + #0#18;  #0#60 = #0#60 + #0#16; |FINSI;
     |SI #0#20 ! "S";  #0#40 = #0#40 + #0#25;  #0#60 = #0#60 + #0#23; |FINSI;
     |SI #0#27 ! "S";  #0#40 = #0#40 + #0#32;  #0#60 = #0#60 + #0#30; |FINSI;
     |SI #0#34 ! "S";  #0#40 = #0#40 + #0#39;  #0#60 = #0#60 + #0#37; |FINSI;

     |SI #0#1 ] 80;
         nEjer = 1900 + #0#1;
     |SINO;
         nEjer = 2000 + #0#1;
     |FINSI;

     |SI nEjer ] 2008;
         |SI nEjer ] 2010; |HAZ Actualm0094; |FINSI;

         |HAZ Nuevo2008;
     |FINSI;

     #0#53 = #0#40 + #0#44 + #0#52;

     |SI nEjer [ 2006;
         |C_M #0#51, 1, "N";
         |C_M #0#52, 1, "N";
         |C_M #0#54, 1, "N";
         |C_M #0#56, 1, "N";
         |C_M #0#58, 1, "N";

         #0#42 = #0#40 - #0#41;
         |SI #0#42 < 0;  #0#42 = 0;  |FINSI;

         #0#44 = #0#43 % 2;
         #0#46 = #0#44 - #0#45;
         |SI #0#46 < 0;  #0#46 = 0;  |FINSI;

         #0#54 = #0#41 + #0#45;
         #0#55 = #0#53 - #0#54;
         #0#47 = #0#42 + #0#46;
     |SINO;
         |C_M #0#51, 1, "S";
         |C_M #0#52, 1, "S";
         |C_M #0#54, 1, "S";
         |C_M #0#56, 1, "S";
         |C_M #0#58, 1, "S";

         #0#44 = #0#43 % 2;
         #0#52 = #0#51 % 2;

         |HAZ CalculaDed131;

         #0#57 = #0#55 - #0#56 - #0#61;
         #0#47 = #0#57 - #0#58;
     |FINSI;
|FPRC;

|PROCESO PintaCalculo;
  |HAZ Calculo;

  |PINTA #0#11;
  |PINTA #0#18;
  |PINTA #0#25;
  |PINTA #0#32;
  |PINTA #0#39;
  |PINTA #0#40;
  |PINTA #0#60;
  |PINTA #0#44;
  |PINTA #0#52;
  |PINTA #0#53;
  |PINTA #0#54;
  |PINTA #0#59;
  |PINTA #0#55;
  |PINTA #0#56;
  |PINTA #0#57;
  |PINTA #0#47;
  |PINTA #0#61;
|FPRC;

|PROCESO Seguimiento;
  se_empre = #0#0;
  se_ejerc = #0#1;
  se_perio = #0#2;
  se_tipos = 131;
  se_activ = 1;
  se_impor = #0#47;
  se_fecha = #0#3;
  se_factu = "";
  |HAZ seguimie;
|FPRC;


|PROCESO Comple; |TIPO 0;
 aAlfa1 = "N"; |SI #0#48 = "S"; aAlfa1 = "S"; |FINSI;
 |C_M #0#49,1,aAlfa1;
 |C_M #0#50,1,aAlfa1;

 |SI #0#48 ! "S";
     #0#49 = ""; |PINTA #0#49;
     #0#50 = ""; |PINTA #0#50;
 |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
  |HAZ Calculo;
  |HAZ Seguimiento;
|FPRC;

|| ****************************************
|| GRABACION DE LAS FICHAS DE LOS COMUNEROS
|| ****************************************

|PROCESO GrabaMod;
  #0#0 = #2#3;
  #0#1 = MAnyo;
  #0#2 = MPeriodo;
  |LIBERA #0;
  |LEE 110#0=;
  |SI FSalida = 0;
      SwEstar = 0;
      |PARA Campo1 = 5; |SI Campo1 [ 33; |HACIENDO Campo1 = Campo1 + 7;
            Campo2 = Campo1 + 1;
            Campo3 = Campo1 + 2;
            Campo4 = Campo1 + 3;
            Campo5 = Campo1 + 4;
            Campo6 = Campo1 + 5;
            Campo7 = Campo1 + 6;

            |SI #0Campo1  = #2#5;
                #0Campo2 = "C";
                #0Campo5 = REpigrafe % #2#6;
                #0Campo6 = PEpigrafe;
                #0Campo7 = #0Campo5 % #0Campo6;
                SwEstar = 1;
            |FINSI;
     |SIGUE;

     |PARA Campo1 = 5; |SI Campo1 [ 33; |HACIENDO Campo1 = Campo1 + 7;
           |SI SwEstar = 1; |SAL; |FINSI;

            Campo2 = Campo1 + 1;
            Campo3 = Campo1 + 2;
            Campo4 = Campo1 + 3;
            Campo5 = Campo1 + 4;
            Campo6 = Campo1 + 5;
            Campo7 = Campo1 + 6;

            |SI #0Campo1 = 0;
                #0Campo1 = #2#5;
                #0Campo2 = "C";
                #0Campo3 = LEpigrafe;
                #0Campo4 = NEpigrafe;
                #0Campo5 = REpigrafe % #2#6;
                #0Campo6 = PEpigrafe;
                #0Campo7 = #0Campo5 % #0Campo6;
                SwEstar = 1;
            |FINSI;
    |SIGUE;
    |HAZ Calculo;
    |GRABA 140#0a;
    |LIBERA #0;

    |HAZ Seguimiento;
  |SINO;
     |DDEFECTO #0;
     #0#0  = #2#3;
     #0#1  = MAnyo;
     #0#2  = MPeriodo;
     #0#5  = #2#5;
     #0#6  = "C";
     #0#7  = LEpigrafe;
     #0#8  = NEpigrafe;
     #0#9  = REpigrafe % #2#6;
     #0#10 = PEpigrafe;
     #0#11 = #0#9 % #0#10;
     |HAZ Calculo;
     |GRABA 140#0n;
     |LIBERA #0;

     |HAZ Seguimiento;
  |FINSI;
|FPRC;

|DEFBUCLE eoscomul;
  #2#1;
  ;
  #1#0, #1#1, #1#2, 001;
  #1#0, #1#1, #1#2, 999;
  ;
  NULL, GrabaMod;
|FIN;

|PROCESO MiraActividad;
  MEmpresa = #0#0;
  MAnyo    = #0#1;
  MPeriodo = #0#2;

  |ABRE #1;

  #1#0 = #0#0;
  #1#1 = NActivida;
  #1#2 = #0#1;
  |LEE 040#1=;
  |SI FSalida = 0; |BUCLE eoscomul; |FINSI;
  |CIERRA #1;

  #0#0 = MEmpresa;
  #0#1 = MAnyo;
  #0#2 = MPeriodo;
  |LIBERA #0;
  |LEE 140#0=;
|FPRC;

|PROCESO Tipo30; |TIPO 30;
  nResto = 0;
  |SI #0#6 = "S";
      NActivida = #0#5;
      LEpigrafe = #0#7;
      NEpigrafe = #0#8;
      REpigrafe = #0#9;
      PEpigrafe = #0#10;
      CEpigrafe = #0#11;
      |HAZ MiraActividad;
      nResto = 1;
  |FINSI;

  |SI #0#13 = "S";
      NActivida = #0#12;
      LEpigrafe = #0#14;
      NEpigrafe = #0#15;
      REpigrafe = #0#16;
      PEpigrafe = #0#17;
      CEpigrafe = #0#18;
      |HAZ MiraActividad;
      nResto = 1;
  |FINSI;

  |SI #0#20 = "S";
      NActivida = #0#19;
      LEpigrafe = #0#21;
      NEpigrafe = #0#22;
      REpigrafe = #0#23;
      PEpigrafe = #0#24;
      CEpigrafe = #0#25;
      |HAZ MiraActividad;
      nResto = 1;
  |FINSI;

  |SI #0#27 = "S";
      NActivida = #0#26;
      LEpigrafe = #0#28;
      NEpigrafe = #0#29;
      REpigrafe = #0#30;
      PEpigrafe = #0#31;
      CEpigrafe = #0#32;
      |HAZ MiraActividad;
      nResto = 1;
  |FINSI;

  |SI #0#34 = "S";
      NActivida = #0#33;
      LEpigrafe = #0#35;
      NEpigrafe = #0#36;
      REpigrafe = #0#37;
      PEpigrafe = #0#38;
      CEpigrafe = #0#39;
      |HAZ MiraActividad;
      nResto = 1;
  |FINSI;

  |SI nResto = 0;
      MEmpresa = #0#0;
      MAnyo    = #0#1;
      MPeriodo = #0#2;
      nPer131  = #0#2 + 1;
      |HAZ ActResto131;
  |FINSI;
|FPRC;

|PROCESO ActResto131;
  |PARA nNume1 = nPer131; |SI nNume1 [ 4; |HACIENDO nNume1 = nNume1 + 1;
        #0#0 = MEmpresa;
        #0#1 = MAnyo;
        #0#2 = nNume1;
        |LEE 101#eosm0020.=;
        |SI FSalida = 0;
            |SI #0#3 = "01.01.0000";
                |HAZ Calculo;
                |GRABA 020#0a;
                |HAZ Seguimiento;
            |FINSI;
        |FINSI;
        |LIBERA #eosm0020;
  |SIGUE;

  #0#0 = MEmpresa;
  #0#1 = MAnyo;
  #0#2 = MPeriodo;
  |LIBERA #0;
  |LEE 140#0=;
|FPRC;

|PROCESO BajaMod;
  SwLeer = 1;

  #0#0 = #2#3;
  #0#1 = MAnyo;
  #0#2 = MPeriodo;
  |LIBERA #0;
  |LEE 140#0=;
  |SI FSalida !  0;  |ACABA;  |FINSI;

  SwEstar = 0;
  |PARA Campo1 = 5; |SI Campo1 [ 33; |HACIENDO Campo1 = Campo1 + 7;
        Campo2 = Campo1 + 1;
        Campo3 = Campo1 + 2;
        Campo4 = Campo1 + 3;
        Campo5 = Campo1 + 4;
        Campo6 = Campo1 + 5;
        Campo7 = Campo1 + 6;

        |SI #0Campo1 = #2#5;
            #0Campo1 = 0;
            #0Campo2 = "N";
            #0Campo3 = "";
            #0Campo4 = "";
            #0Campo5 = 0;
            #0Campo6 = 0;
            #0Campo7 = 0;
        |FINSI;
  |SIGUE;

  |PARA Campo1 = 5; |SI Campo1 [ 33; |HACIENDO Campo1 = Campo1 + 7;
        Campo3 = Campo1 + 2;
        Campo4 = Campo1 + 3;

        |SI #0Campo1 ! 0;
             SwEstar = 1;
            |SAL;
        |FINSI;
  |SIGUE;

  |SI #0#43 ! 0;  |O  #0#44 ! 0;  |O  #0#45 ! 0;  |O  #0#46 ! 0;
      SwEstar = 1;
  |FINSI;

  |SI SwEstar = 1;
      |HAZ Calculo;
      |GRABA 020#0a;
      |HAZ Seguimiento;
 |FINSI;

  |SI SwEstar = 0;
      |BORRA 140#0a;
  |FINSI;
|FPRC;

|DEFBUCLE eoscomulB;
  #2#1;
  ;
  #1#0, #1#1, #1#2, 001;
  #1#0, #1#1, #1#2, 999;
  ;
  NULL, BajaMod;
|FIN;

|PROCESO BorraComuneros;
  |ABRE #1;
  #1#0 = #0#0;
  #1#1 = NActivida;
  #1#2 = #0#1;
  |LEE 040#1=;
  |SI FSalida = 0; |BUCLE eoscomulB; |FINSI;
  |CIERRA #1;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
  Modo  = (FEntrada / 100) ! 0;
  Forma = 0 +. 1;

  |SI Modo = 1; |ACABA; |FINSI;

  |SI Modo = 2; |Y Forma ! 1;
      TEpigrafe1 = #0#6;   LEpigrafe1 = #0#7;   NEpigrafe1 = #0#8;   NActivida1 = #0#5;
      TEpigrafe2 = #0#13;  LEpigrafe2 = #0#14;  NEpigrafe2 = #0#15;  NActivida2 = #0#12;
      TEpigrafe3 = #0#20;  LEpigrafe3 = #0#21;  NEpigrafe3 = #0#22;  NActivida3 = #0#19;
      TEpigrafe4 = #0#27;  LEpigrafe4 = #0#28;  NEpigrafe4 = #0#29;  NActivida4 = #0#26;
      TEpigrafe5 = #0#34;  LEpigrafe5 = #0#35;  NEpigrafe5 = #0#36;  NActivida5 = #0#33;
      |ACABA;
  |FINSI;

  |SI Modo = 2; |GRABA 140#0a; |HAZ Seguimiento; |FINSI;

  SwLeer   = 0;
  MEmpresa = #0#0;
  MAnyo    = #0#1;
  MPeriodo = #0#2;

  |SI Modo = 3;
      |SI #0#6 = "S";
          NActivida = #0#5;  |HAZ BorraComuneros;
      |FINSI;

      |SI #0#13 = "S";
          NActivida = #0#12;  |HAZ BorraComuneros;
      |FINSI;

      |SI #0#20 = "S";
          NActivida = #0#19;  |HAZ BorraComuneros;
      |FINSI;

      |SI #0#27 = "S";
          NActivida = #0#26;  |HAZ BorraComuneros;
      |FINSI;

      |SI #0#34 = "S";
          NActivida = #0#33;  |HAZ BorraComuneros;
      |FINSI;
  |FINSI;

  |SI Modo = 2;
      |SI TEpigrafe1 = "S";
          |SI #0#5 ! NActivida1;
              NActivida = NActivida1;
              |HAZ BorraComuneros;
          |FINSI;
      |FINSI;

      |SI TEpigrafe2 = "S";
          |SI #0#12 ! NActivida2;
              NActivida = NActivida2;
              |HAZ BorraComuneros;
          |FINSI;
      |FINSI;

      |SI TEpigrafe3 = "S";
          |SI #0#19 ! NActivida3;
              NActivida = NActivida3;
              |HAZ BorraComuneros;
          |FINSI;
      |FINSI;

      |SI TEpigrafe4 = "S";
          |SI #0#26 ! NActivida4;
              NActivida = NActivida4;
              |HAZ BorraComuneros;
          |FINSI;
      |FINSI;

      |SI TEpigrafe5 = "S";
          |SI #0#33 ! NActivida4;
              NActivida = NActivida5;
              |HAZ BorraComuneros;
          |FINSI;
      |FINSI;
  |FINSI;

  |SI SwLeer = 1;
      #0#0 = MEmpresa;
      #0#1 = MAnyo;
      #0#2 = MPeriodo;
      |LIBERA #0;
      |LEE 140#0=;
  |FINSI;
|FPRC;

|PROCESO eosm0020;
     |SI #0#53 ! 0;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI #0#1 ] 80;
         nEjer = 1900 + #0#1;
     |SINO;
         nEjer = 2000 + #0#1;
     |FINSI;

     |SI nEjer ] 2008;
         |HAZ Nuevo2008;
     |FINSI;

     #0#53 = #0#40 + #0#44 + #0#52;
     #0#54 = #0#41 + #0#45;

     |SI nEjer [ 2006;
          #0#42 = #0#40 - #0#41;
          |SI #0#42 < 0;  #0#42 = 0;  |FINSI;

          #0#44 = #0#43 % 2;
          #0#46 = #0#44 - #0#45;
          |SI #0#46 < 0;  #0#46 = 0;  |FINSI;

          #0#47 = #0#42 + #0#46;
          #0#55 = #0#53 - #0#54 - #0#59;
          #0#47 = #0#42 + #0#46;
     |SINO;
          #0#44 = #0#43 % 2;
          #0#52 = #0#51 % 2;

          |HAZ CalculaDed131;

          #0#57 = #0#55 - #0#56 - #0#61;
          #0#47 = #0#57 - #0#58;
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE eosm0020;
     #0#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, eosm0020;
|FIN;

|PROCESO eosm0020_08;
     |SI #0#2 = 2;
         |SI #0#59 = 200;
            |ERROR10;
            |ACABA;
         |FINSI;
     |FINSI;
     |SI #0#2 ! 1;
         |HAZ Calculo;
         |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
|FPRC;

|DEFBUCLE eosm0020_08;
     #0#1;
     ;
     00001, 08, 01;
     99999, 08, 99;
     be;
     NULL, eosm0020_08;
|FIN;

|PROCESO Tipo80;  |TIPO 80;
     |ABRE #0;
     |LEE 000#0p;
     |SI FSalida = 0;  |Y #0#53 = 0;
         |BUCLE eosm0020;
     |FINSI;
     |CIERRA #0;

     |BUCLE eosm0020_08;
|FPRC;
