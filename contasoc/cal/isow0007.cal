|FICHEROS;
     maempr10 #200;
     isom0000 #100;
     isom0014 #114,MANTE;

     maempr11 #201;
     isow0007 #908;
|FIN;

|VARIABLES;
     nCampoD        = 0;
     nCampoH        = 0;
     nVentana       = 0;
     nRango         = 0;
     nGrid          = 0;

     aAlfa          = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &enEmpresa      = 0;
     &enAnyo         = 0;
     &enCalcCif      = 0;
     &eaVarDni       = "";
     &enModoConsulta = 0;
     &enSaltaError   = 0;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO LetraNif;
     |SI FSalida = 10;
         enCalcCif = 1;
         eaVarDni  =  #114Campo;
         |HAZ CalculoDNI;
         #114Campo = eaVarDni;
         |PINTA #114Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #114Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "            ") % 112;
     |SI #114Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #114Campo = eaVarDni;  |PINTA #114Campo;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 2399;
|FPRC;

|PROCESO Baja114;
     #114#0  = #200#0;
     #114#1  = #200#1;
     #114#2  = 1;
|FPRC;

|PROCESO Alta114;
     #114#0  = #200#0;
     #114#1  = #200#1;
     #114#2  = 9999;
|FPRC;

|PROGRAMA;
     |HAZ SaltaError;

     |ABRE #200;
     #200#0 = enEmpresa;
     #200#1 = enAnyo;
     |LEE 000#200=;
     |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
     |CIERRA #200;

     |ABRE #201;
     #201#0 = enEmpresa;
     #201#1 = enAnyo;
     #201#2 = 21;
     |LEE 040#201=;
     |SI FSalida ! 0;
         |MENAV "     La Empresa no tiene activada el Caracter de la declaracion 21";
         |CIERRA #201;

         |SI enSaltaError = 0;  |ACABA;  |FINSI;
     |FINSI;
     |CIERRA #201;

     aAlfa = "";
     |SI enModoConsulta = 1;
         aAlfa = "(MODO CONSULTA)   ";
     |FINSI;

     aAlfa =  aAlfa + "No residentes establecimiento permanente (" + (("00000" + #200#0) % -105) + " / " + #200#1 + " " + #200#2;
     |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |VENTANA 0501, 2399, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI enModoConsulta = 1;
         |ABRE #114;
         |ABRE #100;
         #100#0 = enEmpresa;
         #100#1 = enAnyo;
         |LEE 000#100=;
         |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
         |CIERRA #100;

         #908#0 = #100#81;
         #908#1 = #100#82;

         |PINPA #0#908;
         |PINDA #0#908;

         nRango = 1 + 4 + 8 + 16 + 32;

         |LINEAL_SIMPLE #1#114, nRango, 1340, 2263, Baja114, Alta114, NULL;
         nGrid = FSalida;

         |PAUSA;

         |CIERRA #114;

         |DESTRUYECONTROL nGrid;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVentana;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |PULSATECLA;

         |FINVENTANA nVentana;

         |ACABA;
     |FINSI;

     |ABRE #114;
     |ABRE #100;
     #100#0 = enEmpresa;
     #100#1 = enAnyo;
     |LEE 101#100=;
     |SI FSalida ! 0;
         |DDEFECTO #100;
         #100#0 = enEmpresa;
         #100#1 = enAnyo;
         |GRABA 020#100b;
     |FINSI;

     #908#0 = #100#81;
     #908#1 = #100#82;

     |PINPA #0#908;
     |PINDA #0#908;

     nRango = 1 + 4 + 8 + 16 + 32;

     |LINEAL_SIMPLE #1#114, nRango, 1340, 2263, Baja114, Alta114, NULL;
     nGrid = FSalida;

     |ENDATOS #1#908;
     |SI FSalida = 0;
         #100#81 = #908#0;
         #100#82 = #908#1;
         |GRABA 020#100a;
     |FINSI;

     |LIBERA #100;
     |CIERRA #100;
     |CIERRA #114;

     |DESTRUYECONTROL nGrid;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA nVentana;
|FPRO;
