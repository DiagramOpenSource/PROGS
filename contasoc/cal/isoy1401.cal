|FICHEROS;
      isoy2014;
      maempr10;
      maempr02;
      maempr03;
      maempr04;
      maempr06;
      maempr11;

      isom0000;
      isom0001;
      isom0002;
      isom0003;
      isom0004;
      isom0005;
      isom0006;
      isom0007;
      isom0009;
      isom0011;
      isom0012;
      isom0016;
      isom0022;
      isom0023;
      isom0025;
      isom0205;

      isom0500;
      isom0501;
      isom0502;
      isom0503;
      isom0504;
      isom0505;
      isom0506;
      isom0507;
      isom0508;
      isom0509;
      isom0510;
      isom0511;
      isom0513;

      zregpres;

      isoh1401;
      isoh0902;
      isoh14di;

      :/basica/def/agim0019 #0;
      :/contagen/def/ca8m0000 #1;

      &clientes@;
|FIN;

|VARIABLES;
     aAlfa          = "";
     aAlfa0         = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aBase          = "";
     aPathPlugins   = "";
     aDirServidor   = "";
     aDirInternet   = "";
     aDirLanza      = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aDirBase       = "";
     aIPRemoto      = "";
     aDelindex      = "";
     aFicheroAux    = "";
     aFicheroTxt    = "";
     aFicheroPtl    = "";
     aFicheroErr    = "";
     aAbre          = "";
     aAbre1         = "";
     aAbre2         = "";
     aOrigen        = "";
     aDestino       = "";
     aContenido     = "";
     aCNAE          = "";
     aDia           = "";
     aMes           = "";
     aEjerc         = "";
     aPais          = "";
     aCodPais       = "";
     aLong          = "";
     aTecla         = "";
     aRetu          = "";
     aEsc1          = "";
     aEsc2          = "";
     aDesde         = "";
     aHasta         = "";
     aEnlace        = "";
     aHID           = "";
     aPRG           = "";
     aEJF           = "";
     aMOD           = "";
     aIDI           = "";
     aParte1        = "";
     aParte2        = "";
     aDirFotoLocal  = "";
     aFotoGen       = "";
     aFotoBor       = "";
     aFotoErr       = "";
     aFotoSal       = "";
     aFotoPre       = "";
     aCaracter      = "";

     nLong          = 0;
     nNume          = 0;
     nPos           = 0;
     nValor         = 0;
     nValor1        = 0;
     nValor2        = 0;
     nValor3        = 0;
     nValor4        = 0;
     nValor5        = 0;
     nExiste        = 0;
     nSuma          = 0;
     nVent          = 0;
     nVent200       = 0;
     nPanta         = 0;
     nPntPres         = 0;
     nCasilla         = 0;
     nFecha           = 0;
     nCampo           = 0;
     nSwPunto         = 0;
     nCaracter        = 0;
     nContaBucle      = 0;
     nContaBucleL     = 0;
     nComple          = 0;
     nPuntero         = 0;
     nDesde           = 0;
     nHasta           = 0;
     nHay             = 0;
     nTotal           = 0;
     nValor626        = 0;
     nValor627        = 0;
     nValor628        = 0;
     nValor629        = 0;
     nCanti1          = 0;
     nCanti2          = 0;
     nCanti3          = 0;
     nCanti4          = 0;
     nCantiT          = 0;
     nTecla           = 0;
     nPasada          = 0;
     nHandle          = 0;
     nHandle1         = 0;
     nHandle2         = 0;
     nCalc1           = 0;
     nCalc2           = 0;
     nSwError         = 0;
     nLbl             = 0;
     nCalc            = 0;
     nImpor264        = 0;
     nImpor265        = 0;
     nImpor266        = 0;
     nImpor955        = 0;
     nImpor956        = 0;
     nImpor957        = 0;

     fFechaD          = @;
     fFechaH          = @;

     {1}aContiene     = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &enEmpresa       = 0;
     &enAnyo          = 0;
     &enNavieras      = 0;
     &enCooperativa   = 0;
     &enTranspa       = 0;
     &enZEC           = 0;
     &enPeqDimen      = 0;
     &enForales       = 0;
     &enError         = 0;
     &enAviso         = 0;
     &eaError         = "";
     &eaAlfa          = "";
     &enHandle        = 0;
     &enCanti         = 0;
     &enCodCli        = 0;
     &enSwDeDonde     = 0;
     &eaEfectivo      = "";
     &eaAdeudo        = "";
     &eaIBAN           = "";
     &enModelo         = 0;
     &enBanco          = 0;
     &enFormaPag       = 0;
     &enForzar         = 0;
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &efFechaImpre     = @;
     &eaImpre          = "";
     &eaJusti          = "";
     &eaFinLinea       = "";
     &eaUnidadBasico   = "";
     &enEjercicio      = 0;
     &eaCasilla        = "";
     &enErrorPortal    = 0;
     &eaOrigen         = "";
     &eaDestino        = "";
|FIN;

|PROCESO PonVentana;
     |VENTANA 0501, 1550, -1, 16, "Emisi¢n modelo 200";
     nVent200 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent200;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{9}}Generando fichero ", 0613, 0749, NULL;
     nLbl = FSalida;

     |PTEC 802;  |PAUSA;  |PULSATECLA;
|FPRC;

|PROCESO QuitaVentana;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent200;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent200;
|FPRC;

|PROCESO TraeDsaeatresp;
     |DBASE aPathPlugins;  |QBT aPathPlugins;
     aPathPlugins = aPathPlugins + "planilla";
     aOrigen      = aPathPlugins   + "/dsaeatresp.exe";
     aDestino     = aDirBase + "dsaeatresp.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CopiaFichero;
     aAlfa = "";
     |IP_REMOTO aAlfa;  |QBT aAlfa;
     |SI aAlfa ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO AbreSecuencial;
     |DBASE aBase;  |QBF aBase;
     aDirServidor = aBase + "tmp";   |MKDIR aDirServidor;
     aDirServidor = aBase + "tmp/";

     aDirLanza    = eaUnidadBasico + "\AEAT";                         |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200";                     |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200\" + #maempr10#1;           |RMKDIR aDirLanza;
     aDirLanza    = eaUnidadBasico + "\AEAT\200\" + #maempr10#1 + "\";

     aDirBase     = eaUnidadBasico + "\AEAT\200\";

     aDirInternet = eaUnidadBasico + "/AEAT";                         |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET";                |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200";            |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200/" + #maempr10#1;  |RMKDIR aDirInternet;
     aDirInternet = eaUnidadBasico + "/AEAT/INTERNET/200/" + #maempr10#1 + "\";

     aFicheroAux = (("00000" + #maempr10#0) % -105) + #maempr10#1 + "AUX.txt";
     aFicheroTxt = (("00000" + #maempr10#0) % -105) + #maempr10#1 + ".txt";
     aFicheroErr = "err" + (("00000" + #maempr10#0) % -105) + #maempr10#1 + ".html";

     aAbre       = aDirServidor + aFicheroTxt;
     |XABRE "BW", aAbre, enHandle;
|FPRC;

|PROCESO GrabaPortal;
     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO GrabaPortalSin;
     |XGRABA enHandle, eaAlfa;
|FPRC;

|PROCESO GrabaHtml;
     aAbre = aDirServidor + aFicheroPtl;
     |XABRE "WB", aAbre, enHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.form1.submit();";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<form method=" + &34 + "POST" + &34 + " action=" + &34 + aEnlace + &34 + " name=" + &34 + "form1" + &34 + " id=" + &34 + "form1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "HID" + &34 + " value=" + &34 + aHID + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "IDI" + &34 + " value=" + &34 + aIDI + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "LEV" + &34 + " value=" + &34 + "000000000000" + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIC" + &34 + " value=" + &34;
     |HAZ GrabaPortalSin;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroPtl;
     aOrigen    = aDirServidor + aFicheroAux;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre = aDirServidor + aFicheroPtl;
     |XABRE "AB", aAbre, enHandle;

     eaAlfa = &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "RUT" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "PRG" + &34 + " value=" + &34 + aPRG + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "FIN" + &34 + " value=" + &34 + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "EJF" + &34 + " value=" + &34 + aEJF + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "     <input type=" + &34 + "hidden" + &34 + " name=" + &34 + "MOD" + &34 + " value=" + &34 + aMOD + &34 + " />";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA enHandle;

     aOrigen  = aDirServidor + aFicheroPtl;
     aDestino = aDirLanza + aFicheroPtl;
     |HAZ CopiaFichero;
|FPRC;

|PROCESO PortalBorrador;
     aFicheroPtl = "bor_" + (("00000" + #maempr10#0) % -105) + ".html";
     aEnlace     = "https://www6.aeat.es/l/zi22zilk0022";
     aHID        = "SOV4200A";
     aPRG        = "";
     aEJF        = "2014";
     aMOD        = "200";

     |SI #isoy2014#6 = "1";  aIDI = "ES";  |FINSI;
     |SI #isoy2014#6 = "2";  aIDI = "VA";  |FINSI;
     |SI #isoy2014#6 = "3";  aIDI = "GL";  |FINSI;
     |SI #isoy2014#6 = "4";  aIDI = "CA";  |FINSI;

     aAlfa = aDirLanza + aFicheroPtl;      |RFBORRA aAlfa;

     |HAZ GrabaHtml;

     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aDestino;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDestino + &34;
     |FINSI;

     |RSYSTEM aAlfa;
|FPRC;

|PROCESO SacaError;
     nSwError = 0;

     aAbre    = aDirLanza + aFicheroErr;
     |XABRE "C", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PARA; |SI; |HACIENDO;
          |XLEE nHandle,  255, aAlfa;
          |SI FSalida < 0; |SAL; |FINSI;

          aAlfa1 = aAlfa < "";  |QBF aAlfa1;
          aAlfa2 = aAlfa1 - "<title>";
          |SI FSalida ! 0;
              aAlfa2 = aAlfa1 - "error";
              |SI FSalida ! 0; nSwError = 1; |SAL;  |FINSI;

              aAlfa2 = aAlfa1 - "errónea";
              |SI FSalida ! 0; nSwError = 1; |SAL;  |FINSI;
           |FINSI;
     |SIGUE;
     |XCIERRA nHandle;
|FPRC;

|PROCESO Generar;
     aOrigen  = aDirServidor + aFicheroAux;
     aDestino = aDirInternet + aFicheroTxt;
     |HAZ CopiaFichero;

     aAlfa = "0000Se ha generado en " + aDirInternet + " el fichero " + aFicheroTxt;
     aAlfa = aAlfa + " para su presentaci¢n.";
     |MENAV aAlfa;

     eaImpre      = "S";
     efFechaImpre = #isoy2014#1;
|FPRC;

|PROCESO Presentar;
     aOrigen  = aDirServidor + aFicheroAux;
     aDestino = aDirLanza + aFicheroTxt;
     |HAZ CopiaFichero;

     aAlfa = "";
     aLong = aDestino % 0;
     nLong = aLong;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = aDestino % nPos;
           |SI aCaracter = "\";
               aCaracter = "\\";
           |FINSI;

           aAlfa = aAlfa + aCaracter;
     |SIGUE;

     aAlfa1  = "https://www1.agenciatributaria.gob.es/static_files";
     aAlfa1  = aAlfa1 + "/common/internet/dep/aplicaciones/ov/servurlp.html";
     aAlfa1  = aAlfa1 + "?WEB=INTERNET&PRG=200&EJE=2014&URL=PIR&EXT=?FIC=";
     aAlfa1  = aAlfa1 + aAlfa;

     aEnlace = aAlfa1;

     aAbre = aDirLanza + "Presenta.html";
     |XABRE "WBC", aAbre, nHandle;

     eaAlfa = "<!DOCTYPE HTML PUBLIC " + &34 + "-//W3C//DTD HTML 4.01 Transitional//EN" + &34;
     |HAZ GrabaPortal;

     eaAlfa = &34 + "http://www.w3.org/TR/html4/loose.dtd" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "<html>";
     |HAZ GrabaPortal;

     eaAlfa = "<head>";
     |HAZ GrabaPortal;

     eaAlfa = "<title>Documento sin t&iacute;tulo</title>";
     |HAZ GrabaPortal;

     eaAlfa = "<meta http-equiv=" + &34 + "Content-Type" + &34 + " content=" + &34 + "text/html; charset=iso-8859-1" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "</head>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<script language=" + &34 + "javascript" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "     function carga()";
     |HAZ GrabaPortal;

     eaAlfa = "     {";
     |HAZ GrabaPortal;

     eaAlfa = "          document.location = ";
     |HAZ GrabaPortalSin;

     eaAlfa = &34 + aEnlace + &34 + ";";
     |HAZ GrabaPortal;

     eaAlfa = "     }";
     |HAZ GrabaPortal;

     eaAlfa = "</script>";
     |HAZ GrabaPortal;

     eaAlfa = "";
     |HAZ GrabaPortal;

     eaAlfa = "<body onload=" + &34 + "javascript:carga();" + &34 + ">";
     |HAZ GrabaPortal;

     eaAlfa = "";  |HAZ GrabaPortal;
     eaAlfa = "";  |HAZ GrabaPortal;

     eaAlfa = "</form>";   |HAZ GrabaPortal;
     eaAlfa = "</body>";   |HAZ GrabaPortal;
     eaAlfa = "</html>";   |HAZ GrabaPortal;

     |XCIERRA nHandle;

     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aAbre;
         aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAbre + &34;
     |FINSI;

     |RSYSTEM aAlfa;
     |PULSATECLA;

     eaImpre      = "S";
     efFechaImpre = #isoy2014#1;
|FPRC;

|PROCESO QuitaPRG;
     aAbre1 = aDirLanza + aFicheroPtl;
     aAbre2 = aDirLanza + "Borrador.html";

     |XABRE "ABC", aAbre1, nHandle1;
     |XABRE "WBC", aAbre2, nHandle2;

     |PARA;  |SI;  |HACIENDO;
           |XLEE nHandle1,  250, aAlfa1;
           |SI FSalida [ 0;  |SAL;  |FINSI;

           aAlfa2 = aAlfa1;
           aAlfa  = aAlfa1 - aPRG;
           |SI FSalida ! 0;
               aAlfa2 = aAlfa;
           |FINSI;

           |XGRABA nHandle2, aAlfa2;
     |SIGUE;

     |XCIERRA nHandle1;
     |XCIERRA nHandle2;
|FPRC;

|PROCESO Borrador;
     aAbre2 = aDirLanza + aFicheroPtl;
     |SI nSwError ! 0;
         |HAZ QuitaPRG;
     |FINSI;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + aAbre2;
     |SINO;
         aAlfa = aAbre2;
     |FINSI;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;

     |RSYSTEM aAlfa;
     |PULSATECLA;
|FPRC;

|PROCESO VerErrores;
     aAlfa1 = aDirLanza + aFicheroErr;
     aAlfa  = eaPathExplorador + " " + aAlfa1;
     aAlfa  = aAlfa - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
            nCalc = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc;
            nCalc = FSalida + 98;               aAlfa2 = aAlfa % nCalc;
            aAlfa = aAlfa1 + "\" + aAlfa2;
            aAlfa = aAlfa - "/";
     |SIGUE;

     aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO Salir;
     |PTEC 806;
|FPRC;

|PROCESO PresentaResultado;
     |HAZ SacaError;

     |FIN_CONTROL_WINDOWS nLbl;

     |PINPA #0#isom0500;  nPntPres = FSalida;

     |SI nSwError = 0;
         |CONTROL_SIMPLE nPntPres, "LABEL,{{9}}Fichero validado correctamente ", 0602, 0749, NULL;

         |CONTROL_SIMPLE nPntPres, aFotoGen, 0805, 1012, Generar;
         |CONTROL_SIMPLE nPntPres, aFotoPre, 0821, 1028, Presentar;
         |CONTROL_SIMPLE nPntPres, aFotoBor, 0838, 1045, Borrador;
     |FINSI;

     |SI nSwError = 1;
         |CONTROL_SIMPLE nPntPres, "LABEL,{{9}}Fichero con errores ", 0610, 0749, NULL;
         |CONTROL_SIMPLE nPntPres, aFotoErr, 0815, 1022, VerErrores;
         |CONTROL_SIMPLE nPntPres, aFotoBor, 0828, 1035, Borrador;
     |FINSI;

     |CONTROL_SIMPLE nPntPres, aFotoSal, 1342, 1549, Salir;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aAlfa = aDirLanza + aFicheroErr;       |RFBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroPtl;       |RFBORRA aAlfa;
     aAlfa = aDirLanza + aFicheroTxt;       |RFBORRA aAlfa;
     aAlfa = aDirLanza + "Presenta.html";   |RFBORRA aAlfa;
|FPRC;

|PROCESO PortalValidacion;
     eaForzExplorador = "N";
     enEjercicio      = enAnyo;
     |HAZ Explorador;

     aFicheroPtl = "ptl_" + (("00000" + #maempr10#0) % -105) + ".html";
     aEnlace     = "https://www6.aeat.es/l/zi22zilk0022";
     aHID        = "SOV4200A";
     aPRG        = "PTLINK7J";
     aIDI        = "ES";
     aEJF        = "2014";
     aMOD        = "200";

     |SI #isoy2014#6 = "1";  aIDI = "ES";  |FINSI;
     |SI #isoy2014#6 = "2";  aIDI = "VA";  |FINSI;
     |SI #isoy2014#6 = "3";  aIDI = "GL";  |FINSI;
     |SI #isoy2014#6 = "4";  aIDI = "CA";  |FINSI;

     aAlfa = aDirInternet + aFicheroTxt;  |RFBORRA aAlfa;

     |HAZ GrabaHtml;

     |FIN_CONTROL_WINDOWS nLbl;

     |CONTROL_SIMPLE 0, "LABEL,{{9}}Validando fichero ", 0613, 0749, NULL;
     nLbl = FSalida;

     enErrorPortal = 0;
     |HAZ TraeDsaeatresp;

     || Filtro las '/' por '\'
     aDestino = aDestino - "/";
     |PARA; |SI FSalida ! 0; |HACIENDO;
        nCalc1 = ((FSalida / 100) ! 0) + 99; aParte1 = aDestino % nCalc1;
        nCalc2 = FSalida + 98;               aParte2 = aDestino % nCalc2;
        aDestino = aParte1 + "\" + aParte2;

        aDestino = aDestino - "/";
     |SIGUE;

     aAlfa = aDirLanza + aFicheroErr;  |RFBORRA aAlfa;

     aAlfa  = aDestino + " " + aDirLanza + aFicheroPtl + " " + aDirLanza + aFicheroErr;
     aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |RSYSTEM aAlfa;

     |HAZ PresentaResultado;
|FPRC;

|PROCESO Portal;
     |HAZ PonVentana;

     |SI PARAMETRO = "BORRADOR";
         |HAZ PortalBorrador;
         |HAZ QuitaVentana;
         |ACABA;
     |FINSI;

     aAlfa = aDirInternet + aFicheroAux;   |RFBORRA aAlfa;

     |HAZ PortalValidacion;

     |HAZ QuitaVentana;
|FPRC;

|PROCESO CierraSecuencial;
     |XCIERRA enHandle;

     aAbre      = aDirServidor + aFicheroAux;

     |XABRE "BW", aAbre, enHandle;

     eaAlfa = "<T2000" + #maempr10#1 + "0A0000>";  |HAZ GrabaSecuencial;
     eaAlfa = "<AUX>";       |HAZ GrabaSecuencial;
     eaAlfa = " " * 70;      |HAZ GrabaSecuencial;
     eaAlfa = "1.00";        |HAZ GrabaSecuencial;
     eaAlfa = "    ";        |HAZ GrabaSecuencial;
     eaAlfa = "B53179768";   |HAZ GrabaSecuencial;
     eaAlfa = " " * 213;     |HAZ GrabaSecuencial;
     eaAlfa = "</AUX>";      |HAZ GrabaSecuencial;
     |XCIERRA enHandle;

     aDestino   = aDirServidor + aFicheroAux;
     aOrigen    = aDirServidor + aFicheroTxt;

     |AFEGIR_FICHERO aOrigen, aDestino;

     aAbre      = aDirServidor + aFicheroAux;

     |XABRE "BA", aAbre, enHandle;
     eaAlfa = "</T2000" + #maempr10#1 + "0A0000>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
     |XCIERRA enHandle;

     |HAZ Portal;

     |SI PARAMETRO = "BORRADOR";
         aAbre = aDirServidor + aFicheroAux;   |FBORRA aAbre;
         |ACABA;
     |FINSI;

     aAlfa = aDirServidor + aFicheroTxt;  |FBORRA aAlfa;
     aAlfa = aDirServidor + aFicheroAux;  |FBORRA aAlfa;
     aAlfa = aDirServidor + aFicheroPtl;  |FBORRA aAlfa;
|FPRC;

|PROCESO Lee201;
     aContenido = "0";

     #maempr11#0 = #maempr10#0;
     #maempr11#1 = #maempr10#1;
     #maempr11#2 = nCasilla;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         aContenido = "1";
     |FINSI;
|FPRC;

|PROCESO maempr04;
     nContaBucle = nContaBucle + 1;
     |SI nContaBucle = 1;
         #isoh1401#86 = #maempr04#3;
         #isoh1401#87 = #maempr04#4;
         #isoh1401#88 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1401#89 = #maempr04#6;
     |FINSI;

     |SI nContaBucle = 2;
         #isoh1401#90 = #maempr04#3;
         #isoh1401#91 = #maempr04#4;
         #isoh1401#92 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1401#93 = #maempr04#6;
     |FINSI;

     |SI nContaBucle = 3;
         #isoh1401#94 = #maempr04#3;
         #isoh1401#95 = #maempr04#4;
         #isoh1401#96 = (#maempr04#5 % -104) + (#maempr04#5 % 402) + (#maempr04#5 % 102);
         #isoh1401#97 = #maempr04#6;
     |FINSI;
|FPRC;

|DEFBUCLE maempr04;
     #maempr04#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr04;
|FIN;

|PROCESO Hoja1;
     |DDEFECTO #isoh1401;

     #isoh1401#6  = #maempr10#31 % -104;           || Del A¤o
     #isoh1401#7  = #maempr10#31 % 402;            || Del Mes
     #isoh1401#8  = #maempr10#31 % 102;            || Del Dia
     #isoh1401#9  = #maempr10#32 % -104;           || Al A¤o
     #isoh1401#10 = #maempr10#32 % 402;            || Al Mes
     #isoh1401#11 = #maempr10#32 % 102;            || Al Dia
     |SI #maempr10#31 = "01.01.2014";  |Y #maempr10#32 = "31.12.2014";
         #isoh1401#12 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #isoh1401#12 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #isoh1401#12 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     |ABRE #agim0019;
     #agim0019#0 = #maempr10#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #maempr10#0;
         aCNAE = #agim0019#40;  |QBF aCNAE;

         |SI aCNAE = "";
             aCNAE = #agim0019#81;  |QBF aCNAE;
         |FINSI;
     |FINSI;

     enCodCli = #maempr10#0;
     |HAZ LeePersona;

     #isoh1401#13 = aCNAE;                         || CNAE
     #isoh1401#14 = #maempr10#3;                   || NIF
     #isoh1401#15 = #maempr10#2;                   || Razon Social
     #isoh1401#16 = "";                            || Telefono 1
     #isoh1401#17 = "";                            || Telefono 2

     |SI #isoy2014#3 = "S";
         #isoh1401#16 = #maempr10#15;
     |FINSI;

     |SI #isoy2014#4 = "S";
         |SI enSwDeDonde = 1;
             aAlfa = #clientes@#55; |QBF aAlfa;
             |SI aAlfa ! "";  #isoh1401#17 = #clientes@#55;  |FINSI;
         |SINO;
             aAlfa   = #clientes@#61; |QBF aAlfa;
             |SI aAlfa ! "";  #isoh1401#17 = #clientes@#61;  |FINSI;
         |FINSI;
     |FINSI;

     #isoh1401#18 = "2014";

     |ABRE #maempr11;
     nCasilla = 1;   |HAZ Lee201;  #isoh1401#19 = aContenido;
     nCasilla = 2;   |HAZ Lee201;  #isoh1401#20 = aContenido;
     nCasilla = 3;   |HAZ Lee201;  #isoh1401#21 = aContenido;
     nCasilla = 4;   |HAZ Lee201;  #isoh1401#22 = aContenido;
     nCasilla = 5;   |HAZ Lee201;  #isoh1401#23 = aContenido;
     nCasilla = 11;  |HAZ Lee201;  #isoh1401#24 = aContenido;
     nCasilla = 13;  |HAZ Lee201;  #isoh1401#25 = aContenido;
     nCasilla = 14;  |HAZ Lee201;  #isoh1401#26 = aContenido;
     nCasilla = 17;  |HAZ Lee201;  #isoh1401#27 = aContenido;
     nCasilla = 18;  |HAZ Lee201;  #isoh1401#28 = aContenido;
     nCasilla = 19;  |HAZ Lee201;  #isoh1401#29 = aContenido;
     nCasilla = 21;  |HAZ Lee201;  #isoh1401#30 = aContenido;
     nCasilla = 23;  |HAZ Lee201;  #isoh1401#31 = aContenido;
     nCasilla = 24;  |HAZ Lee201;  #isoh1401#32 = aContenido;
     nCasilla = 25;  |HAZ Lee201;  #isoh1401#33 = aContenido;
     nCasilla = 31;  |HAZ Lee201;  #isoh1401#34 = aContenido;
     nCasilla = 32;  |HAZ Lee201;  #isoh1401#35 = aContenido;
     nCasilla = 36;  |HAZ Lee201;  #isoh1401#36 = aContenido;
     nCasilla = 48;  |HAZ Lee201;  #isoh1401#37 = aContenido;
     nCasilla = 58;  |HAZ Lee201;  #isoh1401#38 = aContenido;
     nCasilla = 60;  |HAZ Lee201;  #isoh1401#39 = aContenido;
     nCasilla = 6;   |HAZ Lee201;  #isoh1401#40 = aContenido;
     nCasilla = 15;  |HAZ Lee201;  #isoh1401#41 = aContenido;
     nCasilla = 22;  |HAZ Lee201;  #isoh1401#42 = aContenido;
     nCasilla = 28;  |HAZ Lee201;  #isoh1401#43 = aContenido;
     nCasilla = 47;  |HAZ Lee201;  #isoh1401#44 = aContenido;
     nCasilla = 49;  |HAZ Lee201;  #isoh1401#45 = aContenido;
     nCasilla = 29;  |HAZ Lee201;  #isoh1401#46 = aContenido;
     nCasilla = 33;  |HAZ Lee201;  #isoh1401#47 = aContenido;
     nCasilla = 34;  |HAZ Lee201;  #isoh1401#48 = aContenido;
     nCasilla = 38;  |HAZ Lee201;  #isoh1401#49 = aContenido;
     nCasilla = 46;  |HAZ Lee201;  #isoh1401#50 = aContenido;
     nCasilla = 12;  |HAZ Lee201;  #isoh1401#51 = aContenido;
     nCasilla = 64;  |HAZ Lee201;  #isoh1401#52 = aContenido;
     nCasilla = 57;  |HAZ Lee201;  #isoh1401#53 = aContenido;
     nCasilla = 20;  |HAZ Lee201;  #isoh1401#54 = aContenido;
     nCasilla = 56;  |HAZ Lee201;  #isoh1401#55 = aContenido;
     nCasilla = 7;   |HAZ Lee201;  #isoh1401#56 = aContenido;
     nCasilla = 8;   |HAZ Lee201;  #isoh1401#57 = aContenido;
     nCasilla = 9;   |HAZ Lee201;  #isoh1401#58 = aContenido;
     nCasilla = 10;  |HAZ Lee201;  #isoh1401#59 = aContenido;
     nCasilla = 16;  |HAZ Lee201;  #isoh1401#60 = aContenido;
     nCasilla = 26;  |HAZ Lee201;  #isoh1401#61 = aContenido;
     nCasilla = 27;  |HAZ Lee201;  #isoh1401#62 = aContenido;
     nCasilla = 30;  |HAZ Lee201;  #isoh1401#63 = aContenido;
     nCasilla = 35;  |HAZ Lee201;  #isoh1401#64 = aContenido;
     nCasilla = 37;  |HAZ Lee201;  #isoh1401#65 = aContenido;
     nCasilla = 39;  |HAZ Lee201;  #isoh1401#66 = aContenido;
     nCasilla = 43;  |HAZ Lee201;  #isoh1401#67 = aContenido;
     nCasilla = 44;  |HAZ Lee201;  #isoh1401#68 = aContenido;
     nCasilla = 45;  |HAZ Lee201;  #isoh1401#69 = aContenido;
     nCasilla = 62;  |HAZ Lee201;  #isoh1401#70 = aContenido;
     nCasilla = 63;  |HAZ Lee201;  #isoh1401#71 = aContenido;
     nCasilla = 59;  |HAZ Lee201;  #isoh1401#72 = aContenido;
     nCasilla = 65;  |HAZ Lee201;  #isoh1401#73 = aContenido;

     |ABRE #ca8m0000;
     |DDEFECTO #ca8m0000;
     #ca8m0000#0 = #maempr10#101;
     |LEE 000#ca8m0000.=;
     #isoh1401#74 = #ca8m0000#2;

     #isoh1401#75 = "0";
     |SI #isoh1401#61 = "0";
         |DDEFECTO #ca8m0000;
         #ca8m0000#0 = #maempr10#102;
         |LEE 000#ca8m0000.=;
         #isoh1401#75 = #ca8m0000#2;
         |CIERRA #ca8m0000;
     |FINSI;

                               #isoh1401#76 = "0";
     |SI #maempr10#113 = "S";  #isoh1401#76 = "1";  |FINSI;

     nCasilla = 9;  |HAZ Lee201;
     |SI #maempr11#4 ! 0;
          aAlfa = ("000000" + #maempr11#4) % -106;
          aAlfa = (aAlfa % 104) + "/" + (aAlfa % 502);

          #isoh1401#77 = aAlfa;
          #isoh1401#78 = #maempr11#5;
     |SINO;
          nCasilla = 10;  |HAZ Lee201;
          |SI #maempr11#4 ! 0;
              aAlfa = ("000000" + #maempr11#4) % -106;
              aAlfa = (aAlfa % 104) + "/" + (aAlfa % 502);

              #isoh1401#77 = aAlfa;
              #isoh1401#78 = #maempr11#5;
          |FINSI;
     |FINSI;

     |CIERRA #maempr11;

     nNume   = #maempr10#75 * 100;
     #isoh1401#79 = ("0000000000" + nNume) % -109;  || Empleados fijos
     nNume   = #maempr10#76 * 100;
     #isoh1401#80 = ("0000000000" + nNume) % -109;  || Empleados si fijos

     #isoh1401#81 = "0";
     #isoh1401#82 = "0000000000000";

     |SI #maempr10#98 = "S";
         #isoh1401#81 = "1";
         aAlfa1  = #maempr10#99;  |QBT aAlfa1;
         aAlfa2  = #maempr10#100; |QBT aAlfa2;
         #isoh1401#82 = ("0000000000000" + aAlfa1 + aAlfa2) % -113;  || N§ Justificante
     |FINSI;

     #isoh1401#83 = #maempr10#77;                          || Nombre Secretario
     #isoh1401#84 = #maempr10#78;                          || NIF    Secretario
     #isoh1401#85 = "00000000";
     |SI #isoh1401#30 = "1";
         #isoh1401#85 = (#isoy2014#1 % -104) + (#isoy2014#1 % 402) + (#isoy2014#1 % 102);
     |FINSI;

     nContaBucle = 0;    |BUCLE maempr04;

     |SI #isoh1401#88 = "        ";  #isoh1401#88 = "00000000";  |FINSI;
     |SI #isoh1401#92 = "        ";  #isoh1401#92 = "00000000";  |FINSI;
     |SI #isoh1401#96 = "        ";  #isoh1401#96 = "00000000";  |FINSI;

     |DDEFECTO #zregpres;
     #zregpres#0 = #maempr10#1;
     |LEE 000#zregpres.=;
     |CIERRA #zregpres;

     #isoh1401#100  = #zregpres#1;
     nNume    = #zregpres#6;  #isoh1401#101 = (("000000000" + nNume) % -109);
     nNume    = #zregpres#7;  #isoh1401#102 = (("000000000" + nNume) % -109);
     #isoh1401#103 = #zregpres#8;

     |PARA nCampo = 1;  |SI nCampo [ 105;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh1401#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO maempr03;
     nContaBucle  = nContaBucle + 1;
     #isoh0902#0       = ((nContaBucle / 6) + .49) ! 0;
     nContaBucleL = (nContaBucle + 5) - (6 * #isoh0902#0);

     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0 = ((nContaBucle / 6) + .49) ! 0;

                          #isoh0902#5 = "";
         |SI #isoh0902#0 ! 1;  #isoh0902#5 = "C";  nComple = 1;  |FINSI;

         #isoh0902#2   = "200";
         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         |GRABA 020#isoh0902.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 6) + 6;
     #isoh0902#nPuntero# = #maempr03#3;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr03#4;

                        aAlfa = "0";
     |SI #maempr03#8 = "X";  aAlfa = "1";  |FINSI;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr03#5;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr03#6;

     |SI #isoh1401#30 = "1";
         nPuntero     = nPuntero + 1;
         aAlfa        = ("00" + #maempr03#7) % -102;
         #isoh0902#nPuntero# = aAlfa;
     |FINSI;

     |GRABA 020#isoh0902.a;
     |LIBERA #isoh0902;
|FPRC;

|DEFBUCLE maempr03;
     #maempr03#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr03;
|FIN;

|PROCESO maempr06;
     nContaBucle  = nContaBucle + 1;
     #isoh0902#0       = ((nContaBucle / 4) + .49) ! 0;
     nContaBucleL = (nContaBucle + 3) - (4 * #isoh0902#0);

     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0     = ((nContaBucle / 4) + .49) ! 0;

                          #isoh0902#5 = "";
         |SI #isoh0902#0 ! 1;  #isoh0902#5 = "C";  nComple = 1;  |FINSI;

         #isoh0902#2   = "200";
         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         |GRABA 020#isoh0902.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 15) + 42;
     #isoh0902#nPuntero# = #maempr06#3;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr06#4;

     nPuntero     = nPuntero + 1;
     aAlfa        = ("00" + #maempr06#5) % -102;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr06#7;
     |HAZ Calcula3E2D;
     #isoh0902#nPuntero# = eaAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr06#6;
     |HAZ Calcula17D;
     #isoh0902#nPuntero# = eaAlfa;

     |PARA nCampo = 8;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh0902#nPuntero# = eaAlfa;
     |SIGUE;

     |PARA nCampo = 16;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           nPuntero  = nPuntero + 1;
           enCanti   = #maempr06#nCampo#;
           |HAZ Calcula17D;
           #isoh0902#nPuntero# = eaAlfa;
     |SIGUE;

     |GRABA 020#isoh0902.a;
     |LIBERA #isoh0902;
|FPRC;

|DEFBUCLE maempr06;
     #maempr06#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr06;
|FIN;

|PROCESO maempr02;
     nContaBucle  = nContaBucle + 1;
     #isoh0902#0       = ((nContaBucle / 6) + .49) ! 0;
     nContaBucleL = (nContaBucle + 5) - (6 * #isoh0902#0);

     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0 = ((nContaBucle / 6) + .49) ! 0;

                          #isoh0902#5 = "";
         |SI #isoh0902#0 ! 1;  #isoh0902#5 = "C";  nComple = 1;  |FINSI;

         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         |GRABA 020#isoh0902.b;
     |FINSI;

     nPuntero     = (nContaBucleL * 7) + 102;
     #isoh0902#nPuntero# = #maempr02#3;

                        aAlfa = "0";
     |SI #maempr02#9 = "X";  aAlfa = "1";  |FINSI;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr02#4;

     nPuntero     = nPuntero + 1;
     #isoh0902#nPuntero# = #maempr02#5;

     nPuntero     = nPuntero + 1;
     aAlfa        = #maempr02#6;  |QBT aAlfa;
     aAlfa        = ("00" + aAlfa) % -102;
     #isoh0902#nPuntero# = aAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr02#7;
     |HAZ Calcula17D;
     #isoh0902#nPuntero# = eaAlfa;

     nPuntero     = nPuntero + 1;
     enCanti       = #maempr02#8;
     |HAZ Calcula3E2D;
     #isoh0902#nPuntero# = eaAlfa;

     |GRABA 020#isoh0902.a;
     |LIBERA #isoh0902;
|FPRC;

|DEFBUCLE maempr02;
     #maempr02#1;
     ;
     #maempr10#0, #maempr10#1, 00;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, maempr02;
|FIN;

|PROCESO isoh0902;
     |PARA nCampo = 1;  |SI nCampo [ 146;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh0902#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isoh0902;
     #isoh0902#1;
     ;
     01;
     99;
     ;
     NULL, isoh0902;
|FIN;

|PROCESO Hoja2;
     aDelindex = ("h1" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #isoh0902#aDelindex#;
     |ABRE #isoh0902; |CIERRA #isoh0902; |DELINDEX #isoh0902;

     |ABRE #isoh0902;
     #isoh0902#0 = 1;
     |LEE 101#isoh0902.=;
     |SI FSalida ! 0;
         |DDEFECTO #isoh0902;
         #isoh0902#0   = 1;
         #isoh0902#3   = "020";
         #isoh0902#5   = "";
         #isoh0902#2   = "200";
         #isoh0902#3   = "020";
         #isoh0902#146 = "</T200020>";

         |SI #maempr10#73 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;
         |SI #maempr10#74 > 100;  #maempr10#73 = 0;  #maempr10#74 = 0;  |FINSI;

         |SI #isoh0902#5 = " ";
             enCanti   = #maempr10#73;
             |HAZ Calcula3E2D;
             #isoh0902#144 = eaAlfa;

             enCanti   = #maempr10#74;
             |HAZ Calcula3E2D;
             #isoh0902#145 = eaAlfa;
         |FINSI;

         |GRABA 020#isoh0902.n;
         |LIBERA #isoh0902;
     |FINSI;

     nContaBucle = 0;    |BUCLE maempr03;
     nContaBucle = 0;    |BUCLE maempr06;
     nContaBucle = 0;    |BUCLE maempr02;

     |CIERRA #isoh0902;

     |BUCLE isoh0902;

     |ABRE #isoh0902; |CIERRA #isoh0902; |DELINDEX #isoh0902;
|FPRC;

|PROCESO isom0501;
     |SI #isom0501#2 = "     ";  |ACABA;  |FINSI;

     #isom0002#0 = #maempr10#0;
     #isom0002#1 = #maempr10#1;
     #isom0002#2 = #isom0501#1;
     |LEE 000#isom0002.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0002;  |FINSI;

     enCanti  = #isom0002#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0501;
      #isom0501#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0501;
|FIN;

|PROCESO Hoja3;
     eaAlfa = "<T200030> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 15;
     nHasta = 265;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200030>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja4;
     eaAlfa = "<T200040> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 270;
     nHasta = 425;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200040>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja5;
     eaAlfa = "<T200050> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 455;
     nHasta = 675;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200050>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja6;
     eaAlfa = "<T200060> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0002;
     nDesde = 685;
     nHasta = 815;
     |BUCLE isom0501;
     |CIERRA #isom0002;

     eaAlfa = "</T200060>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0502;
     |SI #isom0502#2 = "     ";  |ACABA;  |FINSI;

     #isom0003#0 = #maempr10#0;
     #isom0003#1 = #maempr10#1;
     #isom0003#2 = #isom0502#1;
     |LEE 000#isom0003.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0003;  |FINSI;

     enCanti  = #isom0003#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0502;
      #isom0502#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0502;
|FIN;

|PROCESO Hoja7;
     eaAlfa = "<T200070> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0003;
     nDesde = 15;
     nHasta = 245;
     |BUCLE isom0502;
     |CIERRA #isom0003;

     eaAlfa = "</T200070>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja8;
     eaAlfa = "<T200080> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0003;
     nDesde = 255;
     nHasta = 475;
     |BUCLE isom0502;
     |CIERRA #isom0003;

     eaAlfa = "</T200080>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0503;
     |SI #isom0503#2 = "     ";  |ACABA;  |FINSI;

     #isom0004#0 = #maempr10#0;
     #isom0004#1 = #maempr10#1;
     #isom0004#2 = #isom0503#1;
     |LEE 000#isom0004.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0004;  |FINSI;

     enCanti  = #isom0004#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0503;
      #isom0503#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0503;
|FIN;

|PROCESO Hoja9;
     |SI #isoh1401#74 = "3";  |ACABA;  |FINSI;

     eaAlfa = "<T200090> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0004;
     |BUCLE isom0503;
     |CIERRA #isom0004;

     eaAlfa = "</T200090>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0504;
     |SI #isom0504#2 = "     ";  |ACABA;  |FINSI;

     #isom0005#0 = #maempr10#0;
     #isom0005#1 = #maempr10#1;
     #isom0005#2 = #isom0504#1;
     |LEE 000#isom0005.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0005;  |FINSI;

     enCanti  = #isom0005#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|DEFBUCLE isom0504;
      #isom0504#2;
      ;
      #maempr10#1, aDesde, nDesde;
      #maempr10#1, aHasta, nHasta;
      ;
      NULL, isom0504;
|FIN;

|PROCESO Hoja10;
     eaAlfa = "<T200100> ";  |HAZ GrabaSecuencial;

     nDesde = 5;  nHasta = 800;

     |ABRE #isom0005;
     aDesde = "     ";  aHasta = "631";  |BUCLE isom0504;
     aDesde = "715";    aHasta = "742";  |BUCLE isom0504;
     aDesde = "632";    aHasta = "645";  |BUCLE isom0504;
     |CIERRA #isom0005;

     eaAlfa = "</T200100>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja11;
     eaAlfa = "<T200110> ";  |HAZ GrabaSecuencial;

     nDesde = 810;
     nHasta = 1545;

     |ABRE #isom0005;
     aDesde = "     ";  aHasta = "631";  |BUCLE isom0504;
     aDesde = "715";    aHasta = "742";  |BUCLE isom0504;
     aDesde = "632";    aHasta = "645";  |BUCLE isom0504;
     |CIERRA #isom0005;

     eaAlfa = "</T200110>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0500;
     |SI #isom0500#2 = "900  ";  |ACABA;  |FINSI;
     |SI #isom0500#2 = "901  ";  |ACABA;  |FINSI;
     |SI #isom0500#2 = "     ";  |ACABA;  |FINSI;

     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#2 = #isom0500#1;
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     |SI #isom0500#2 ! "558  ";
         enCanti  = #isom0001#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |SINO;
         enCanti  = #isom0001#5;  |HAZ Calcula2E2D; |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0500;
      #isom0500#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0500;
|FIN;

|DEFBUCLE isom0500_2;
      #isom0500#2;
      ;
      #maempr10#1, aDesde, nDesde;
      #maempr10#1, aHasta, nHasta;
      ;
      NULL, isom0500;
|FIN;

|PROCESO isom0505;
     #isom0006#0 = #maempr10#0;
     #isom0006#1 = #maempr10#1;
     #isom0006#2 = #isom0505#1;
     |LEE 000#isom0006.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0006;  |FINSI;

     |SI #isom0505#2 ! "     ";
         enCanti  = #isom0006#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0505#3 ! "     ";
         enCanti  = #isom0006#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0505;
      #isom0505#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0505;
|FIN;

|PROCESO Hoja12;
     eaAlfa = "<T200120> ";  |HAZ GrabaSecuencial;

     nDesde = 10;
     nHasta = 25;

     |ABRE #isom0001;
     |BUCLE isom0500;
     |CIERRA #isom0001;

     nDesde = 5;
     nHasta = 270;

     |ABRE #isom0006;
     |BUCLE isom0505;
     |CIERRA #isom0006;

     eaAlfa = "</T200120>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja13;
     eaAlfa = "<T200130> ";  |HAZ GrabaSecuencial;

     nDesde = 275;
     nHasta = 365;

     |ABRE #isom0006;
     |BUCLE isom0505;
     |CIERRA #isom0006;

     nDesde = 40;
     nHasta = 210;

     |ABRE #isom0001;
     |BUCLE isom0500;
     |CIERRA #isom0001;

     eaAlfa = "</T200130>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja14;
     eaAlfa = "<T200140> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0001;
     nDesde = 225;  nHasta = 350;  |BUCLE isom0500;
     nDesde = 445;  nHasta = 465;  |BUCLE isom0500;

     aDesde = "599"; aHasta = "616";
     nDesde = 480;   nHasta = 630;  |BUCLE isom0500_2;

     aDesde = "633"; aHasta = "642";
     nDesde = 480;   nHasta = 630;  |BUCLE isom0500_2;

     aDesde = "617"; aHasta = "622";
     nDesde = 480;   nHasta = 630;  |BUCLE isom0500_2;

     nDesde = 545;  nHasta = 550;  |BUCLE isom0500;

     |CIERRA #isom0001;

     eaAlfa = "</T200140>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0507;
     #isom0009#0 = #maempr10#0;
     #isom0009#1 = #maempr10#1;
     #isom0009#2 = #isom0507#1;
     |LEE 000#isom0009.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0009;  |FINSI;

     |SI #isom0507#3 ! "     ";
         eaAlfa = #isom0009#4;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#4 ! "     ";
        enCanti  = #isom0009#6;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#5 ! "     ";
        enCanti  = #isom0009#8;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0507#6 ! "     ";
        enCanti  = #isom0009#10; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0507;
      #isom0507#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0507;
|FIN;

|PROCESO isom0509;
     #isom0012#0 = #maempr10#0;
     #isom0012#1 = #maempr10#1;
     #isom0012#2 = #isom0509#1;
     |LEE 000#isom0012.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0012;  |FINSI;

     |SI #isom0509#2 ! "     ";
         enCanti  = #isom0012#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#3 ! "     ";
         |SI #isom0509#3 ! "103  ";
             enCanti  = #isom0012#7;  |HAZ Calcula2E2D; |HAZ GrabaSecuencial;
         |SINO;
             enCanti  = #isom0012#7;  |HAZ Calcula3E4D; |HAZ GrabaSecuencial;
         |FINSI;
     |FINSI;

     |SI #isom0509#4 ! "     ";
         enCanti  = #isom0012#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#5 ! "     ";
         enCanti  = #isom0012#11; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0509#6 ! "     ";
         enCanti  = #isom0012#13; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0509;
      #isom0509#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0509;
|FIN;

|PROCESO Hoja15;
     eaCasilla = "670";  |HAZ LeeFich109;  nValor1 = #isom0009#6;
     eaCasilla = "116";  |HAZ LeeFich112;  nValor2 = #isom0012#5;
     eaCasilla = "131";  |HAZ LeeFich112;  nValor3 = #isom0012#5;
     eaCasilla = "160";  |HAZ LeeFich112;  nValor4 = #isom0012#5;
     eaCasilla = "171";  |HAZ LeeFich112;  nValor5 = #isom0012#5;

     nSuma = nValor1 + nValor2 + nValor3 + nValor4 + nValor5
     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T200150> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0009;
     |SELECT #1#isom0009;
     nDesde = 5;    nHasta = 95;   |BUCLE isom0507;
     |CIERRA #isom0009;

     |ABRE #isom0012;
     |SELECT #1#isom0012;
     |BUCLE isom0509;
     |CIERRA #isom0012;

     eaAlfa = "</T200150>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0508;
     #isom0011#0 = #maempr10#0;
     #isom0011#1 = #maempr10#1;
     #isom0011#2 = #isom0508#1;
     |LEE 000#isom0011.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0011;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0011#5 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0011#7 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;
         |SI #isom0011#9 ! 0;  nSuma = 1;  |ERROR10;  |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0508#2 = "918  ";
      |O #isom0508#2 = "589  ";
      |O #isom0508#2 = "822  ";
      |O #isom0508#2 = "232  ";
      |O #isom0508#2 = "517  ";
         enCanti  = #isom0011#5;       |HAZ Calcula17D;  |HAZ GrabaSecuencial;
         enCanti  = #isom0011#5 % 80;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
         enCanti  = #isom0011#7;       |HAZ Calcula17D;  |HAZ GrabaSecuencial;
         enCanti  = #isom0011#9;       |HAZ Calcula17D;  |HAZ GrabaSecuencial;

         |ACABA;
     |FINSI;

     |SI #isom0508#2 ! "     ";
         enCanti  = #isom0011#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0508#3 ! "     ";
         enCanti  = #isom0011#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0508#4 ! "     ";
         enCanti  = #isom0011#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0508;
      #isom0508#1;
      ;
      #maempr10#1, nDesde;
      #maempr10#1, nHasta;
      ;
      NULL, isom0508;
|FIN;

|PROCESO Hoja16;
     eaCasilla = "841";  |HAZ LeeFich111;  nValor1 = #isom0011#5;
     eaCasilla = "764";  |HAZ LeeFich111;  nValor2 = #isom0011#5;
     eaCasilla = "886";  |HAZ LeeFich111;  nValor3 = #isom0011#5;

     nSuma = nValor1 + nValor2 + nValor3;
     |SI nSuma = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T200160> ";  |HAZ GrabaSecuencial;

     nPasada  = 1;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 10;    nHasta = 275;    |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = "</T200160>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja17;
     nPasada = 0;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 290;   nHasta = 570; |BUCLE isom0508;
     |CIERRA #isom0011;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     nPasada  = 1;

     eaAlfa = "<T200170> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 290;   nHasta = 570; |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = "</T200170>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Hoja17B;
     nPasada = 0;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 575;   nHasta = 645; |BUCLE isom0508;
     |CIERRA #isom0011;

     |SI nSuma = 0;  |ACABA;  |FINSI;

     nPasada  = 1;

     eaAlfa = "<T20017B> ";  |HAZ GrabaSecuencial;

     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 575;   nHasta = 645; |BUCLE isom0508;
     |CIERRA #isom0011;

     eaAlfa = "</T20017B>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO Graba107;
     enCanti  = #isom0007#5; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0007#7; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0016;
     nContaBucle  = nContaBucle + 1;

     |SI nContaBucle = 1;
         aAlfa1 = #isom0016#3;
     |FINSI;

     |SI nContaBucle = 2;
         aAlfa2 = #isom0016#3;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE isom0016;
     #isom0016#1;
     ;
     #maempr10#0, #maempr10#1, 01;
     #maempr10#0, #maempr10#1, 99;
     ;
     NULL, isom0016;
|FIN;

|PROCESO Hoja18;
     eaCasilla = "598";   |HAZ LeeFich111;  nValor  = nValor + #isom0011#5;
     eaCasilla = "417";   |HAZ LeeFich107;  nValor  = nValor + #isom0007#5 + #isom0007#7;
     eaCasilla = "051";   |HAZ LeeFich107;  nValor  = nValor + #isom0007#5 + #isom0007#7;

     |PARA nCampo = 84;  |SI nCampo [ 105;  |HACIENDO nCampo = nCampo + 1;
           nValor = nValor + #isom0000#nCampo#;
     |SIGUE;

     |ABRE #isom0016;
     #isom0016#0 = #maempr10#0;
     #isom0016#1 = #maempr10#1;
     #isom0016#2 = 1;
     |LEE 000#isom0016.];
     |SI FSalida = 0;  |Y  #isom0016#0 = #maempr10#0;  |Y #isom0016#1 = #maempr10#1;
         nValor = nValor + 1;
     |FINSI;
     |CIERRA #isom0016;

     |SI nValor = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T200180> ";  |HAZ GrabaSecuencial;

     nPasada  = 1;
     |ABRE #isom0011;
     |SELECT #1#isom0011;
     nDesde = 660;   nHasta = 725; |BUCLE isom0508;
     |CIERRA #isom0011;

     enCanti  = #isom0000#84;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#85;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#86 + #isom0000#87;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#88;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#89 + #isom0000#90 + #isom0000#91 + #isom0000#92;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#93;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#94 + #isom0000#95;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#96;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#97;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#98;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#100; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#99 + #isom0000#101 + #isom0000#102 + #isom0000#103;
                               |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#104; |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     enCanti  = #isom0000#105; |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "001";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "003";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "027";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "005";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "029";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "007";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "031";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "009";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "033";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "011";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "035";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "013";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "037";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "015";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "039";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "017";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "041";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "019";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "043";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "021";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "045";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "023";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "047";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "025";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "049";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "417";  |HAZ LeeFich107;  |HAZ Graba107;
     eaCasilla = "051";  |HAZ LeeFich107;  |HAZ Graba107;

     aAlfa1 = "                      ";
     aAlfa2 = "                      ";

     nContaBucle  = 0;
     |BUCLE isom0016;

     eaAlfa = aAlfa1;  |HAZ GrabaSecuencial;
     eaAlfa = aAlfa2;  |HAZ GrabaSecuencial;

     eaAlfa = "</T200180>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO isom0510;
     #isom0022#0 = #maempr10#0;
     #isom0022#1 = #maempr10#1;
     #isom0022#2 = #isom0510#1;
     |LEE 000#isom0022.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0022;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0022#5 ! 0;
             nHay = 1;
             |ERROR10;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0510#2 ! "     ";
         enCanti  = #isom0022#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0510;
      #isom0510#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0510;
|FIN;

|PROCESO isom0511;
     #isom0023#0 = #maempr10#0;
     #isom0023#1 = #maempr10#1;
     #isom0023#2 = #isom0511#1;
     |LEE 000#isom0023.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0023;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0023#2 = 30;  |ACABA;  |FINSI;
         |SI #isom0023#2 = 65;  |ACABA;  |FINSI;

         |SI #isom0023#5 = 0;  |ACABA;  |FINSI;

         |SI #isom0511#2 = "264  ";  |O #isom0511#2 = "955  ";
             |SI #isom0023#9 = 0;  |ACABA;  |FINSI;
         |FINSI;

         nHay = 1;
         |ERROR10;

         |ACABA;
     |FINSI;

     |SI #isom0511#2 = "264  ";
         nImpor264 = #isom0023#5;
         nImpor265 = #isom0023#7;
         nImpor266 = #isom0023#9;
     |FINSI;

     |SI #isom0511#2 = "955  ";
         nImpor955 = #isom0023#5;
         nImpor956 = #isom0023#7;
         nImpor957 = #isom0023#9;
     |FINSI;

     |SI #isom0511#2 = "264  ";  |O #isom0511#2 = "955  ";
         |SI #isom0023#9 = 0;    || No se emiten datos sin no queda nada
             #isom0023#5 = 0;    || para a¤os posteriores
             #isom0023#7 = 0;
         |FINSI;
     |FINSI;

     |SI #isom0511#2 = "267  ";
         |SI nImpor266 = 0;
             #isom0023#5 = #isom0023#5 - nImpor264;
             #isom0023#7 = #isom0023#7 - nImpor265;
         |FINSI;
     |FINSI;

     |SI #isom0511#2 = "538  ";
         |SI nImpor957 = 0;
             #isom0023#5 = #isom0023#5 - nImpor955;
             #isom0023#7 = #isom0023#7 - nImpor956;
         |FINSI;
     |FINSI;

     |SI #isom0511#2 ! "     ";
         enCanti  = #isom0023#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0511#3 ! "     ";
         enCanti  = #isom0023#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0511#4 ! "     ";
         enCanti  = #isom0023#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0511;
      #isom0511#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0511;
|FIN;

|PROCESO isom0513;
     #isom0025#0 = #maempr10#0;
     #isom0025#1 = #maempr10#1;
     #isom0025#2 = #isom0513#1;
     |LEE 000#isom0025.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0025;  |FINSI;

     |SI nPasada = 0;
         |SI #isom0025#5 ! 0;  |O #isom0025#7  ! 0;
          |O #isom0025#9 ! 0;  |O #isom0025#11 ! 0;
             nHay = 1;
             |ERROR10;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #isom0513#3 ! "     ";
         enCanti  = #isom0025#5;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0513#4 ! "     ";
         enCanti  = #isom0025#7;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0513#5 ! "     ";
         enCanti  = #isom0025#9;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;

     |SI #isom0513#6 ! "     ";
         enCanti  = #isom0025#11;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;
     |FINSI;
|FPRC;

|DEFBUCLE isom0513;
      #isom0513#1;
      ;
      #maempr10#1, 0000;
      #maempr10#1, 9999;
      ;
      NULL, isom0513;
|FIN;

|PROCESO Hoja18B;
     nHay    = 0;
     nPasada = 0;
     |ABRE #isom0022;  |SELECT #1#isom0022;
     |ABRE #isom0023;  |SELECT #1#isom0023;
     |ABRE #isom0025;  |SELECT #1#isom0025;

     nHay = #isom0000#121;
     eaCasilla = "150";  |HAZ LeeFich101;  nHay = nHay + #isom0001#5;
     eaCasilla = "506";  |HAZ LeeFich101;  nHay = nHay + #isom0001#5;

     |SI nHay = 0;  |BUCLE isom0510;     |FINSI;
     |SI nHay = 0;  |BUCLE isom0511;     |FINSI;
     |SI nHay = 0;  |BUCLE isom0513;     |FINSI;

     |CIERRA #isom0022;
     |CIERRA #isom0023;
     |CIERRA #isom0025;

     |SI nHay = 0;  |ACABA;  |FINSI;

     eaAlfa = "<T20018B> ";  |HAZ GrabaSecuencial;

     nPasada = 1;

     |ABRE #isom0022;
     |SELECT #1#isom0022;
     |BUCLE isom0510;
     |CIERRA #isom0022;

     |ABRE #isom0023;
     |SELECT #1#isom0023;
     |BUCLE isom0511;
     |CIERRA #isom0023;

     |ABRE #isom0025;
     |SELECT #1#isom0025;
     |BUCLE isom0513;
     |CIERRA #isom0025;

     enCanti  = #isom0000#121;  |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "150";  |HAZ LeeFich101;
     enCanti  = #isom0001#5;    |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaCasilla = "506";  |HAZ LeeFich101;
     enCanti  = #isom0001#5;    |HAZ Calcula17D;  |HAZ GrabaSecuencial;

     eaAlfa = "</T20018B>";  |HAZ GrabaSecuencial;

     eaAlfa = eaFinLinea;  |HAZ GrabaSecuencial;
|FPRC;

|PROCESO HojaDID;
     |DDEFECTO #isoh14di;

     #isoh14di#7  = #maempr10#1;
     |SI #maempr10#31 = "01.01.2014";  |Y #maempr10#32 = "31.12.2014";
         #isoh14di#8 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #isoh14di#8 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #isoh14di#8 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     #isoh14di#9  = "0A";                     || Periodo
     #isoh14di#10 = #maempr10#31 % 102;            || Del Dia
     #isoh14di#11 = #maempr10#31 % 402;            || Del Mes
     #isoh14di#12 = #maempr10#31 % -102;           || Del Anyo
     #isoh14di#13 = #maempr10#32 % 102;            || Al Dia
     #isoh14di#14 = #maempr10#32 % 402;            || Al Mes
     #isoh14di#15 = #maempr10#32 % -102;           || Al A¤o
     #isoh14di#16 = #maempr10#3;                   || NIF
     #isoh14di#17 = #maempr10#2;                   || Apellidos o Razon Social

     eaCasilla = "552";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh14di#18 = eaAlfa;

     eaCasilla = "562";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh14di#19 = eaAlfa;

     eaCasilla = "621";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh14di#20 = eaAlfa;
     nTotal   = #isom0001#5;

     enCodCli = #maempr10#0;
     |HAZ LeePersona;

     |SI #isoh1401#58 = "1"; nTotal = 0; |FINSI;
     |SI #isoh1401#59 = "1"; nTotal = 0; |FINSI;

     |SI #isoy2014#2 = "S";
         #isoh14di#6 = "1";

         |SI nTotal < 0;
             #isoh14di#25 = " ";
             enCanti = -nTotal;  |HAZ Calcula17D;  #isoh14di#26 = eaAlfa;
         |FINSI;

         |SI nTotal > 0;
             #isoh14di#28  = " ";
             enCanti  = nTotal; |HAZ Calcula17D;  #isoh14di#31 = eaAlfa;
         |FINSI;
     |SINO;
         |SI nTotal < 0;
             |SI #isoy2014#5 = "1";  #isoh14di#25 = "D";  |FINSI;
             |SI #isoy2014#5 = "2";  #isoh14di#25 = " ";  |FINSI;
             |SI #isoy2014#5 = "3";  #isoh14di#25 = "R";  |FINSI;

             enCanti  = -nTotal;  |HAZ Calcula17D;  #isoh14di#26 = eaAlfa;
             |SI #isoh14di#25 ! "R";
                 |SI enSwDeDonde = 1;
                     enModelo = 200;  enForzar = 1;  |HAZ CogeDatosBancos;

                     #isoh14di#27 = eaIBAN;
                 |SINO;
                     #isoh14di#27 = #clientes@#99;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nTotal > 0;
             enCanti  = nTotal; |HAZ Calcula17D;  #isoh14di#31 = eaAlfa;
             #isoh14di#28 = #isoy2014#0;
             |SI #isoy2014#0 ! "H";
                 |SI enSwDeDonde = 1;
                     enModelo = 200;  enForzar = 1;  |HAZ CogeDatosBancos;

                     #isoh14di#32 = eaIBAN;
                 |SINO;
                     #isoh14di#32 = #clientes@#99;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nTotal = 0;
             #isoh14di#35 = "1";
         |FINSI;
     |FINSI;

     eaCasilla = "150";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh14di#33 = eaAlfa;

     eaCasilla = "506";  |HAZ LeeFich101;
     enCanti  = #isom0001#5; |HAZ Calcula17D;  #isoh14di#34 = eaAlfa;

     #isoh14di#29 = "";
     #isoh14di#30 = "";

     |PARA nCampo = 1;  |SI nCampo [ 36;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isoh14di#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     nTecla = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |SI nTecla = 7;  |ACABA;  |FINSI;

     aDia   = #isoy2014#1 % 102;
     aMes   = #isoy2014#1 % 402;
     aEjerc = #isoy2014#1 % -104;

     |SI aMes = "01"; aMes = "Enero     "; |FINSI;
     |SI aMes = "02"; aMes = "Febrero   "; |FINSI;
     |SI aMes = "03"; aMes = "Marzo     "; |FINSI;
     |SI aMes = "04"; aMes = "Abril     "; |FINSI;
     |SI aMes = "05"; aMes = "Mayo      "; |FINSI;
     |SI aMes = "06"; aMes = "Junio     "; |FINSI;
     |SI aMes = "07"; aMes = "Julio     "; |FINSI;
     |SI aMes = "08"; aMes = "Agosto    "; |FINSI;
     |SI aMes = "09"; aMes = "Septiembre"; |FINSI;
     |SI aMes = "10"; aMes = "Octubre   "; |FINSI;
     |SI aMes = "11"; aMes = "Noviembre "; |FINSI;
     |SI aMes = "12"; aMes = "Diciembre "; |FINSI;
     aMes = aMes > aMes;

     |ABRE #isom0000;
     #isom0000#0 = #maempr10#0;
     #isom0000#1 = #maempr10#1;
     |LEE 000#isom0000.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0000;  |FINSI;
     |CIERRA #isom0000;

     |HAZ AbreSecuencial;
     |HAZ Hoja1;
     |HAZ Hoja2;
     |HAZ Hoja3;
     |HAZ Hoja4;
     |HAZ Hoja5;
     |HAZ Hoja6;
     |HAZ Hoja7;
     |HAZ Hoja8;
     |HAZ Hoja9;
     |HAZ Hoja10;
     |HAZ Hoja11;
     |HAZ Hoja12;
     |HAZ Hoja13;
     |HAZ Hoja14;
     |HAZ Hoja15;
     |HAZ Hoja16;
     |HAZ Hoja17;
     |HAZ Hoja17B;
     |HAZ Hoja18;
     |HAZ Hoja18B;
     |HAZ Hoja19;
     |HAZ Hoja20;
     |HAZ Hoja21;
     |HAZ Hoja22;
     |HAZ Hoja23;
     |HAZ Hoja24;
     |HAZ HojaDID;

     |HAZ CierraSecuencial;
|FPRC;

|PROGRAMA;
/*
     |MENAV "0000A£n no se ha abierto el portal del 2014.";
     |ACABA;
*/

     |HAZ LeeUnidadBasico;

     efFechaImpre = "01.01.0000";
     eaImpre    = "N";
     eaJusti    = "";
     eaFinLinea = &13 + &10;
     eaFinLinea = "";

     |SI PARAMETRO ! "BORRADOR";
         enError = 0;
         |SUB_EJECUTA_NP "isoz0002;CHEQUEOEMISION";
         |SI enError ! 0;
             |MENAV "0000Hay errores graves, no puedo emitir el modelo.";
             |ACABA;
         |FINSI;

         |SI enAviso ! 0;
             |CONFI "0000SHay errores leves, quiere emitir de todas formas";
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |CIERRA #maempr10;  |ACABA; |FINSI;
     |CIERRA #maempr10;

     |C_M #isoy2014#0, 1, "N";
     |C_M #isoy2014#5, 1, "N";
     eaCasilla = "621";  |HAZ LeeFich101;
     nTotal   = #isom0001#5;

     |SI nTotal > 0;
         |C_M #isoy2014#0, 1, "S";

         enCodCli = #maempr10#0;
         |HAZ LeePersona;
         |SI enSwDeDonde = 1;
              enModelo = 200;  enForzar = 1;  |HAZ CogeDatosBancos;

                                     #isoy2014#0 = "H";
              |SI enFormaPag = 2;    #isoy2014#0 = "I";  |FINSI;
              |SI enFormaPag = 3;    #isoy2014#0 = "U";  |FINSI;
          |FINSI;
     |FINSI;

     |SI nTotal < 0;
         |C_M #isoy2014#5, 1, "S";

         #isoy2014#5 = "1";
         |SI #maempr10#34 = "S";  #isoy2014#5 = "3";  |FINSI;
     |FINSI;

     aAlfa =  "Emisi¢n modelo 200 (" + (("00000" + #maempr10#0) % -105) + " / " + #maempr10#1 + " " + #maempr10#2;
     |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |VENTANA 0501, 1999, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#isoy2014;
     |PINDA #0#isoy2014;

     |ENDATOS #1#isoy2014;

     |PULSATECLA;
|FPRO;

|PROCESO LeeImagenes;
     |DBASE aBase;

     eaOrigen     = aBase  + "planilla/aeat_imagenes.tgz";
     eaDestino    = aDirFotoLocal + "aeat_imagenes.tgz";
     |HAZ EnviaFicheroConMD5;

     aAlfa = aDirFotoLocal + "aeat_imagenes.tgz";
     Pos   = -1;
     |RDESCOMPRIME aAlfa;

     aAlfa1 = aDirFotoLocal;
     |RDETAR aAlfa, aDirFotoLocal;

     aAlfa = aDirFotoLocal + "aeat_imagenes.tar";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;

     aDirFotoLocal = aContiene1;
     aDirFotoLocal = aDirFotoLocal + "botones";   |RMKDIR aDirFotoLocal;
     aDirFotoLocal = aDirFotoLocal + "\";

     |HAZ LeeImagenes;

     aFotoGen = "IMAGEN," + aDirFotoLocal + "aeat_generar.bmp";
     aFotoBor = "IMAGEN," + aDirFotoLocal + "aeat_borrador.bmp";
     aFotoErr = "IMAGEN," + aDirFotoLocal + "aeat_errores.bmp";
     aFotoSal = "IMAGEN," + aDirFotoLocal + "aeat_salir.bmp";
     aFotoPre = "IMAGEN," + aDirFotoLocal + "aeat_presentar.bmp";

     |PULSATECLA;

     FSalida = 1899;
|FPRC;
