|FICHEROS;
     zregfirm;
     zw000006,MANTE;
|FIN;

|VARIABLES;
     n1Btn1           = 0;
     n1Btn2           = 0;
     n1Btn3           = 0;
     n1Vent           = 0;
     n2Vent           = 0;
     nRango           = -1;
     nGrid            = 0;
     nLinea           = 0;

     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

      &enModo         = 0;
      &enEmpresa      = 0;
      &empresa        = 0;
      &anyo           = 0;
      &enAnyo         = 0;
|FIN;

|PROCESO Baja4;
     #zregfirm#0 = enEmpresa;
     #zregfirm#1 = enAnyo;
     #zregfirm#2 = 1;
|FPRC;

|PROCESO Alta4;
     #zregfirm#0 = enEmpresa;
     #zregfirm#1 = enAnyo;
     #zregfirm#2 = 99;
|FPRC;

|PROCESO Alta;
     #zregfirm#0 = enEmpresa;
     #zregfirm#1 = enAnyo;
     #zregfirm#2 = 99;
     |LEE 000#zregfirm.];
     |SI FSalida = 0;
         |LEE 000#zregfirm.a;
     |SINO;
         |LEE 000#zregfirm.u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y  #zregfirm#0 = enEmpresa;  |Y  #zregfirm#1 = enAnyo;
         nLinea = #zregfirm#2 + 1;
     |FINSI;

     |DDEFECTO #zw000006;

     |VENTANA 0501, 1599, -1, 16, "Datos firmante";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#zw000006;
     |PINDA #0#zw000006;
     |ENDATOS #1#zw000006;
     |SI FSalida = 0;
         #zregfirm#0 = enEmpresa;
         #zregfirm#1 = enAnyo;
         #zregfirm#2 = nLinea;
         #zregfirm#3 = #zw000006#3;
         #zregfirm#4 = #zw000006#4;
         #zregfirm#5 = #zw000006#5;
         #zregfirm#6 = #zw000006#6;
         #zregfirm#7 = #zw000006#7;
         #zregfirm#8 = #zw000006#8;

         |SI #zw000006#9 = "A";  #zregfirm#9 = "ADMINISTRADOR";  |FINSI;
         |SI #zw000006#9 = "P";  #zregfirm#9 = "PRESIDENTE";     |FINSI;
         |SI #zw000006#9 = "S";  #zregfirm#9 = "SECRETARIO";     |FINSI;

         |GRABA 020#zregfirm.n;
         |LIBERA #zregfirm;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Modificar;
     |LEE 101#zregfirm.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1599, -1, 16, "Datos firmante";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #zw000006#3  = #zregfirm#3;
     #zw000006#4  = #zregfirm#4;
     #zw000006#5  = #zregfirm#5;
     #zw000006#6  = #zregfirm#6;
     #zw000006#7  = #zregfirm#7;
     #zw000006#8  = #zregfirm#8;
     #zw000006#9  = #zregfirm#9 % 101;

     |PINPA #0#zw000006;
     |PINDA #0#zw000006;
     |ENDATOS #1#zw000006;
     |SI FSalida = 0;
         #zregfirm#3 = #zw000006#3;
         #zregfirm#4 = #zw000006#4;
         #zregfirm#5 = #zw000006#5;
         #zregfirm#6 = #zw000006#6;
         #zregfirm#7 = #zw000006#7;
         #zregfirm#8 = #zw000006#8;

         |SI #zw000006#9 = "A";  #zregfirm#9 = "ADMINISTRADOR";  |FINSI;
         |SI #zw000006#9 = "P";  #zregfirm#9 = "PRESIDENTE";     |FINSI;
         |SI #zw000006#9 = "S";  #zregfirm#9 = "SECRETARIO";     |FINSI;

         |GRABA 020#zregfirm.a;
         |LIBERA #zregfirm;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Baja;
     |LEE 101#zregfirm.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el firmante";
     |SI FSalida ! 0;  |LIBERA #zregfirm;  |ACABA;  |FINSI;

     |BORRA 020#zregfirm.a;
     |LIBERA #zregfirm;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Evento4;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#zregfirm.=;
         |SI FSalida = 0;
             |ESTADO_CONTROL n1Btn2, "ENABLE";
             |ESTADO_CONTROL n1Btn3, "ENABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Modificar;
     |FINSI;
|FPRC;

|PROGRAMA;
     |VENTANA 0501, 1799, -1, 16, "Firmantes del certificado";
     n1Vent = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |ABRE #zregfirm;
     |LINEAL_SIMPLE #1#zregfirm, nRango, 0502, 1498, Baja4, Alta4, Evento4;
     nGrid = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 1564, 1574, Alta;
     n1Btn1  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar ", 1576, 1586, Modificar;
     n1Btn2  = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 1588, 1598, Baja;
     n1Btn3  = FSalida;

     |ESTADO_CONTROL n1Btn2, "DISABLE";
     |ESTADO_CONTROL n1Btn3, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #zregfirm;

     |FIN_CONTROL_WINDOWS n1Btn1;
     |FIN_CONTROL_WINDOWS n1Btn2;
     |FIN_CONTROL_WINDOWS n1Btn3;

     |DESTRUYECONTROL nGrid;

     |FINVENTANA n1Vent;

     |PULSATECLA;
|FPRO;
