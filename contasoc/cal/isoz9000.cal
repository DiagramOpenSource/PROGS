|FICHEROS;
     isoz9000;
     maacceso;
     maempr10;
     maempr11;
     isacceso;
     isom0001;
     isom9000;

     :basica/agim0019;
     :basica/agifigen;

     isw00901;

     espejo@;
|FIN;

|VARIABLES;
     aAlfa            = "";
     aAlfa1           = "";
     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aBase            = "";
     aMas             = "";
     aFichero         = "";
     aPeriodo         = "";
     aDPeriodo        = "";
     aHPeriodo        = "";
     aQueBoton        = "";
     aID              = "";
     aJusti           = "";
     aMarca           = "";
     aPer             = "";
     aQuePeriodo      = "";
     aAbre            = "";

     nGrid901         = 0;
     nRango           = 0;
     nPanta           = 0;
     nPanta9003       = 0;
     nBoton1          = 0;
     nBoton2          = 0;
     nBoton3          = 0;
     nBoton4          = 0;
     nBoton5          = 0;
     nBoton6          = 0;
     nBoton7          = 0;
     nBoton8          = 0;
     nBoton9          = 0;
     nBoton10         = 0;
     nBoton11         = 0;
     nBotonSal        = 0;
     nBoton           = 0;
     nVent            = 0;
     nVentana         = 0;
     nAnyo            = 0;
     nAny             = 0;
     nAnyoD           = 0;
     nAnyoH           = 0;
     aTGravaAnt       = "";
     nCompleAnt       = 0;

     nComple          = 0;
     nEmpresa         = 0;
     nCampo           = 0;
     nResult          = 0;
     nPorce           = 0;
     nLabel           = 0;
     fPerFecha        = @;
     fHasFecha        = @;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &eaFichero       = "";
     &enModo          = 0;
     &enEmpresa       = 0;
     &enAnyo          = 0;
     &fFechaChequeo   = @;
     &enError         = 0;
     &fFechaDisol     = @;
     &eaForzExplorador = "";
     &eaJusti          = "";
     &enGrid           = 0;
     &enEjercicio      = 0;
     &enMensa          = 1;
     &enBtnAnexo       = 0;
     &enFicha          = 0;
     &eaTipo           = "";
     &eaBloqueo        = "";
|FIN;

|PROCESO TGravamenAnt;
     aTGravaAnt = "";
     nAny = #isoz9000#0;
     |SI aPeriodo = "1P"; aAlfa = "3P"; nAny = nAny - 1; |FINSI;
     |SI aPeriodo = "2P"; aAlfa = "1P";                  |FINSI;
     |SI aPeriodo = "3P"; aAlfa = "2P";                  |FINSI;
     #isom9000#0 = nEmpresa;
     #isom9000#1 = nAny;
     #isom9000#2 = aAlfa;
     #isom9000#3 = 0;
     |LEE 000#isom9000.];
     |SI FSalida = 0;  |Y  #isom9000#0 = nEmpresa;  |Y #isom9000#1 = nAny;  |Y #isom9000#2 = aAlfa;
         aTGravaAnt = #isom9000#43;
     |FINSI;
|FPRC;

|PROCESO DAntComplem;
     |ABRE #espejo@;
     #espejo@#0 = #isom9000#0;
     #espejo@#1 = #isom9000#1;
     #espejo@#2 = #isom9000#2;
     #espejo@#3 = nCompleAnt;
     |LEE 000#espejo@.=;
     |SI FSalida = 0;
         #isom9000#6  = #espejo@#6;
         #isom9000#7  = #espejo@#7;
         #isom9000#38 = #espejo@#38;
         #isom9000#39 = #espejo@#39;
         #isom9000#40 = #espejo@#40;
         #isom9000#41 = #espejo@#41;
         #isom9000#42 = #espejo@#42;
         #isom9000#43 = #espejo@#43;
         #isom9000#44 = #espejo@#44;
         #isom9000#53 = #espejo@#53;
         #isom9000#60 = #espejo@#60;
         #isom9000#61 = #espejo@#61;
         #isom9000#62 = #espejo@#62;
         #isom9000#75 = #espejo@#75;
         #isom9000#85 = #espejo@#85;
         #isom9000#86 = #espejo@#86;
     |FINSI;
     |CIERRA #espejo@;
|FPRC;

|PROCESO MiraBloqueo;
     |DBASS aBase;
     aAbre = aBase + "integral/def/dsam0021.mas";
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         aAlfa = ":integral/dsam0021;" + (("00000" + #isom9000#0) % -105);
         aAlfa = aAlfa + "CHEQUEO";
         |SUB_EJECUTA aAlfa;

         |SI eaBloqueo ! "1";
             aAlfa = "|:integral/dsam0021;" + (("00000" + #isom9000#0) % -105);
             aAlfa = aAlfa + "PANTALLA";
             |SUB_EJECUTA aAlfa;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO isacceso;
     |SELECT #2#isom0001;
     #isom0001#0 = #isacceso#0;
     #isom0001#1 = #isacceso#1;
     #isom0001#3 = "599";
     |LEE 000#isom0001.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0001;  |FINSI;

     |DDEFECTO #isw00901;
     #isw00901#0 = #isacceso#0;
     #isw00901#1 = #isacceso#2;
     #isw00901#2 = #isom0001#5;
     |SI #isw00901#2 < 0; #isw00901#2 = 0; |FINSI;

     #isw00901#3 = #isw00901#2 % nPorce;

     enEmpresa = #isw00901#0;
     |SI #isoz9000#1 = "S";  aAlfa = "21.04." + #isoz9000#0;  |FINSI;
     |SI #isoz9000#2 = "S";  aAlfa = "20.10." + #isoz9000#0;  |FINSI;
     |SI #isoz9000#3 = "S";  aAlfa = "22.12." + #isoz9000#0;  |FINSI;
     fFechaChequeo = aAlfa;
     |HAZ ChequeaEmpresa;

     #isw00901#4 = "ACTIVA";

     #isom9000#0 = #isacceso#0;
     #isom9000#1 = #isoz9000#0;
     #isom9000#2 = aPeriodo;
     #isom9000#3 = 0;
     |LEE 000#isom9000.];
     |SI FSalida = 0;  |Y  #isom9000#0 = #isacceso#0;  |Y #isom9000#1 = #isoz9000#0;  |Y #isom9000#2 = aPeriodo;
         enError = 3;
     |FINSI;

     |SI enError = 0;
         #isw00901#5 = "*";
     |SINO;
         |SI enError = 1;
             #isw00901#4 = "INACTIVA";
         |FINSI;

         |SI enError = 2;
             #isw00901#4 = "DISUELTA";
         |FINSI;

         |SI enError = 3;
             #isw00901#4 = "YA EXISTE";
         |FINSI;
     |FINSI;

     #isw00901#6 = aTGravaAnt;
     |GRABA 020#isw00901.n;
     |LIBERA #isw00901;
|FPRC;

|DEFBUCLE isacceso;
     #isacceso#1;
     ;
     nAnyo, 00001;
     nAnyo, 99999;
     ;
     NULL, isacceso;
|FIN;

|PROCESO Leomaempr10;
    #maempr10#0 = #agifigen#0;
    #maempr10#1 = nAny;
    |LEE 041#maempr10.=;
    |SI FSalida = 0;
        |SI #maempr10#32 > "01.01.1900";
            fHasFecha = #maempr10#32;
            fHasFecha = fHasFecha + "0.006";

            |SI fHasFecha [ fPerFecha;
                nAnyo = nAny;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO agifigen;

     #agim0019#0 = #agifigen#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;

     enFicha = 0;
     |SI FSalida ! 0;  |O #agim0019#0 ! #agifigen#0;
         |DDEFECTO #agim0019;
     |FINSI;

     |SI #agim0019#90 ! "1";  |ACABA;  |FINSI;

     nAnyo  = -1;
     nAnyoD = #isoz9000#0 - 3;
     nAnyoH = #isoz9000#0 - 1;
     |PARA nAny = nAnyoH; |SI nAny ] nAnyoD; |HACIENDO nAny = nAny - 1;
           |HAZ Leomaempr10;
           |SI nAnyo ! -1; |SAL; |FINSI;
     |SIGUE;

     |SI nAnyo ! -1;

         #isacceso#0 = #agifigen#0;
         #isacceso#1 = nAnyo;
         |LEE 041#isacceso.=;
         |SI FSalida = 0;
             nEmpresa = #isacceso#0;
             |HAZ TGravamenAnt;
             |HAZ isacceso;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     00001;
     99999;
     ;
     NULL, agifigen;
|FIN;

|PROCESO Evento901;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#isw00901.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#isw00901.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #isw00901#5 = "*";
             #isw00901#5 = " ";
         |SINO;
             |SI #isw00901#4 ! "ACTIVA    ";
                 aAlfa = "0000NLa empresa tiene la siguiente observaci¢n: " + #isw00901#4;  |QBF aAlfa;
                 aAlfa = aAlfa + ". Desea activar la l¡nea de todas formas."
                 |CONFI aAlfa;
                 |SI FSalida ! 0;
                     |LIBERA #isw00901;
                     |ERROR;
                     |ACABA;
                 |FINSI;
             |FINSI;
             #isw00901#5 = "*";
         |FINSI;

         |GRABA 020#isw00901.a;
         |LIBERA #isw00901;

         |REFRESCACONTROL nGrid901;
     |FINSI;
|FPRC;

|PROCESO isw00901C;
     |SI aMarca = "";
         |SI #isw00901#5 = "*";  #isw00901#5 = "";  |FINSI;
     |FINSI;

     |SI aMarca = "*";
         |SI #isw00901#4 ! "ACTIVA    ";  |ACABA;  |FINSI;
         #isw00901#5 = "*";
     |FINSI;

     |GRABA 020#isw00901.a;
     |LIBERA #isw00901;
|FPRC;

|DEFBUCLE isw00901C;
     #isw00901#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, isw00901C;
|FIN;

|PROCESO Activar;
     aMarca = "*";
     |BUCLE isw00901C;

     |REFRESCACONTROL nGrid901;
     |FOCOTECLADO nGrid901;
|FPRC;

|PROCESO Desactivar;
     aMarca = "";
     |BUCLE isw00901C;

     |REFRESCACONTROL nGrid901;
     |FOCOTECLADO nGrid901;
|FPRC;

|PROCESO isw00901;
     #isom9000#0 = #isw00901#0;
     #isom9000#1 = #isoz9000#0;
     #isom9000#2 = aPeriodo;
     #isom9000#3 = 0;
     |LEE 101#isom9000.=;
     |SI FSalida ! 0;
         |DDEFECTO #isom9000;
         #isom9000#0  = #isw00901#0;
         #isom9000#1  = #isoz9000#0;
         #isom9000#2  = aPeriodo;
         #isom9000#3  = 0;
         #isom9000#43 = #isw00901#6;
         |GRABA 020#isom9000.b;
     |FINSI;

     #maempr10#0 = #isom9000#0;
     #maempr10#1 = #isom9000#1;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;
         enEmpresa = #isom9000#0;
         enAnyo    = #isom9000#1;
         enMensa   = 1;
         |SUB_EJECUTA "maempr08";

         #maempr10#0 = #isom9000#0;
         #maempr10#1 = #isom9000#1;
         |LEE 000#maempr10.=;
         |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |FINSI;

     #isom9000#4 = #maempr10#3;
     #isom9000#5 = #maempr10#2;
     #isom9000#6 = "A ";
     |SI #maempr10#31 = "          ";
         #maempr10#31 = "01.01." + nAnyo;
     |FINSI;
     #isom9000#7  = #maempr10#31;
     #isom9000#8  = "N";
     #isom9000#9  = "";
     #isom9000#10 = #isw00901#2;
     #isom9000#11 = nPorce;
     #isom9000#12 = #isw00901#3;
     #isom9000#14 = #isw00901#3;

     |ABRE #maempr11;
     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 6;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#39 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 17;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 18;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 22;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#53 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 1;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#60 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 57;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#61 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 23;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#62 = "S";
     |FINSI;

     |CIERRA #maempr11;

     |GRABA 020#isom9000.a;
     |LIBERA #isom9000;
|FPRC;

|DEFBUCLE isw00901;
     #isw00901#1;
     5;
     00001, "*";
     99999, "*";
     ;
     NULL, isw00901;
|FIN;

|PROCESO PagosAutomaticos;
     |VENTANA 1230, 1458, -1, 16, "Introduzca el porcentaje de aplicaci¢n";
     nVent  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     E_inf  = "0";
     E_sup  = "100.00";

     |PARA;  |SI;  |HACIENDO;
          nPorce = 18;
          nPorce = 1345 ? 1;
          |SI nPorce [ 100;   |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |VENTANA 0501, 2799, -1, 16, "Calculo autom tico. Selecci¢n de empresas";
     nVent  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aFichero = ("a1" + Usuario + "zzzzzzzz") % 108; |NOME_DAT #isw00901#aFichero#;
     |ABRE #isw00901;  |CIERRA #isw00901;  |DELINDEX #isw00901;

     nAnyo = #isoz9000#0 - 2;
     |SI #isoz9000#1 ! "S";
         nAnyo = #isoz9000#0 - 1;
     |FINSI;

     aAlfa = #isoz9000#0;
     |SI #isoz9000#1 = "S"; aAlfa1 = "31.03."; |FINSI;
     |SI #isoz9000#2 = "S"; aAlfa1 = "30.09."; |FINSI;
     |SI #isoz9000#3 = "S"; aAlfa1 = "30.11."; |FINSI;
     aAlfa = aAlfa1 + aAlfa;
     fPerFecha = aAlfa;

     |PTEC 802;
     |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{13}}Procesando trabajo ...", 1302, 1440, NULL;
     nLabel = FSalida;

     |ABRE #isw00901;
     |ABRE #isom0001;
     |ABRE #agim0019;
     |ABRE #isacceso;
     |ABRE #maempr10;
     |BUCLE agifigen;
     |CIERRA #maempr10;
     |CIERRA #isacceso;
     |CIERRA #agim0019;
     |CIERRA #isom0001;

     |FIN_CONTROL_WINDOWS nLabel;

     |LEE 000#isw00901.p;
     |SI FSalida ! 0;
         |MENAV "0000 Seleccion vacia";
         |CIERRA #isw00901;
         |DELINDEX #isw00901;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent;

         |REFRESCACONTROL enGrid;
         |FOCOTECLADO enGrid;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "LABEL,{{2}}Doble click en la l¡nea para ACTIVAR o DESACTIVAR", 0502, 0550, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Activar TODOS", 0560, 0578, Activar;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Desactivar TODOS", 0580, 0598, Desactivar;

     |LINEAL_SIMPLE #1#isw00901, nRango, 0602, 2598, NULL, NULL, Evento901;
     nGrid901 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid901;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
     |CIERRA #isw00901;

     |CONFI "0000SSeguro con lo seleccionado";
     |SI FSalida = 0;
         |ABRE #maempr10;
         |ABRE #isacceso;
         |BUCLE isw00901;
         |CIERRA #maempr10;
         |CIERRA #isacceso;
     |FINSI;

     |DELINDEX #isw00901;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
     |PULSATECLA;
|FPRC;

|PROCESO ExploraPred;
     eaForzExplorador = "S";
     enEjercicio      = #isoz9000#0;
     |HAZ Explorador;
|FPRC;

|PROCESO Dsarchi;
     |SI #isom9000#2 = "1P"; aPer = "01";  |FINSI;
     |SI #isom9000#2 = "2P"; aPer = "02";  |FINSI;
     |SI #isom9000#2 = "3P"; aPer = "03";  |FINSI;

     aAlfa = (("00000" + #isom9000#0) % -105) + #isom9000#1 + aPer + "202" + (("00" + #isom9000#3) % -102);
     aAlfa = aAlfa + #isom9000#5;

     aAlfa = "|:dsarchi/dsarz017;" + aAlfa;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO BotonAdios;
     |PTEC 807;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |FIN_CONTROL_WINDOWS nBotonSal;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |SI #isoz9000#Campo# = Contenido;
         |ACABA;
     |FINSI;

     |SI Campo = 1;
         |SI #isoz9000#1 = "S";
             #isoz9000#2 = "N";  |PINTA #isoz9000#2;
             #isoz9000#3 = "N";  |PINTA #isoz9000#3;
             #isoz9000#4 = "N";  |PINTA #isoz9000#4;
         |FINSI;
     |FINSI;

     |SI Campo = 2;
         |SI #isoz9000#2 = "S";
             #isoz9000#1 = "N";  |PINTA #isoz9000#1;
             #isoz9000#3 = "N";  |PINTA #isoz9000#3;
             #isoz9000#4 = "N";  |PINTA #isoz9000#4;
         |FINSI;
     |FINSI;

     |SI Campo = 3;
         |SI #isoz9000#3 = "S";
             #isoz9000#1 = "N";  |PINTA #isoz9000#1;
             #isoz9000#2 = "N";  |PINTA #isoz9000#2;
             #isoz9000#4 = "N";  |PINTA #isoz9000#4;
         |FINSI;
     |FINSI;

     |SI Campo = 4;
         |SI #isoz9000#4 = "S";
             #isoz9000#1 = "N";  |PINTA #isoz9000#1;
             #isoz9000#2 = "N";  |PINTA #isoz9000#2;
             #isoz9000#3 = "N";  |PINTA #isoz9000#3;
         |FINSI;
     |FINSI;

     |SI #isoz9000#1 = "N";  |Y #isoz9000#2 = "N";  |Y #isoz9000#3 = "N";  |Y #isoz9000#4 = "N";
         #isoz9000#1 = "S";  |PINTA #isoz9000#1;
     |FINSI;

     |PTEC 806;
|FPRC;

|PROCESO Tipo7C0;  |TIPO 7;
     aQueBoton = "|X000";
     aID       = #isoz9000#aQueBoton#;
     nBoton    = aID;
     |ESTADO_CONTROL nBoton, "HIDE";

     aQueBoton = "|X001";
     aID       = #isoz9000#aQueBoton#;
     nBoton    = aID;
     |ESTADO_CONTROL nBoton, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,{{197}} Salir", 3488, 3498, BotonAdios;
     nBotonSal = FSalida;
|FPRC;

|PROCESO MeteDatos;
     aQuePeriodo = #isom9000#1 + #isom9000#2;

     |SI aQuePeriodo [ "20121P";
         |HAZ z9000c01;
         |ACABA;
     |FINSI;

     |SI aQuePeriodo [ "20143P";
         |HAZ z9000c02;
         |ACABA;
     |FINSI;

     |SI aQuePeriodo [ "20153P";
         |HAZ z9000c03;
         |ACABA;
     |FINSI;

     |SI aQuePeriodo = "20161P";
         |HAZ z9000c04;
         |ACABA;
     |FINSI;

     |SI aQuePeriodo [ "20163P";
         |HAZ z9000c05;
         |ACABA;
     |FINSI;

     |SI aQuePeriodo [ "20181P";
         |HAZ z9000c06;
         |ACABA;
     |FINSI;

     |SI aQuePeriodo ] "20182P";
         |HAZ z9000c07;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Evento202;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#isom9000.=;

         |ABRE #espejo@;
         #espejo@#0 = #isom9000#0;
         #espejo@#1 = #isom9000#1;
         #espejo@#2 = #isom9000#2;
         #espejo@#3 = #isom9000#3 + 1;
         |LEE 000#espejo@.=;
         |SI FSalida ! 0;
             |ESTADO_CONTROL nBoton3,  "ENABLE";
             |ESTADO_CONTROL nBoton4,  "ENABLE";
             |ESTADO_CONTROL nBoton6,  "ENABLE";
             |ESTADO_CONTROL nBoton7,  "ENABLE";
             |ESTADO_CONTROL nBoton9,  "ENABLE";
             |ESTADO_CONTROL nBoton11, "ENABLE";

             |SI #isom9000#8 = "S";
                 |ESTADO_CONTROL nBoton8, "ENABLE";
             |SINO;
                 |ESTADO_CONTROL nBoton8, "DISABLE";
             |FINSI;
         |SINO;
             |ESTADO_CONTROL nBoton3,  "DISABLE";
             |ESTADO_CONTROL nBoton4,  "DISABLE";
             |ESTADO_CONTROL nBoton6,  "DISABLE";
             |ESTADO_CONTROL nBoton7,  "DISABLE";
             |ESTADO_CONTROL nBoton8,  "DISABLE";
             |ESTADO_CONTROL nBoton11, "DISABLE";
             |ESTADO_CONTROL nBoton9,  "ENABLE";
         |FINSI;
         |CIERRA #espejo@;
     |FINSI;

     |SI FSalida = 4;
         enModo = 4;
         |HAZ MeteDatos;
     |FINSI;
|FPRC;

|PROCESO Baja202;
     #isom9000#0 = 00001;
     #isom9000#1 = #isoz9000#0;
     #isom9000#2 = aDPeriodo;
     #isom9000#3 = 0;
|FPRC;

|PROCESO Alta202;
     #isom9000#0 = 99999;
     #isom9000#1 = #isoz9000#0;
     #isom9000#2 = aHPeriodo;
     #isom9000#3 = 99;
|FPRC;

|PROCESO Boton1;
     |HAZ QuitaBotonSalir;

     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";
     |ESTADO_CONTROL nBoton4, "DISABLE";
     |ESTADO_CONTROL nBoton5, "DISABLE";
     |ESTADO_CONTROL nBoton6, "DISABLE";
     |ESTADO_CONTROL nBoton7, "DISABLE";
     |ESTADO_CONTROL nBoton8, "DISABLE";
     |ESTADO_CONTROL nBoton9, "DISABLE";
     |ESTADO_CONTROL nBoton10,"DISABLE";
     |ESTADO_CONTROL nBoton11,"DISABLE";

     |DESTRUYECONTROL enGrid;

     |ENDATOS #1#isoz9000;

     |ESTADO_CONTROL enGrid,    "SHOW";

     |SI #isoz9000#4 = "S";
         |ESTADO_CONTROL nBoton2, "DISABLE";
         |ESTADO_CONTROL nBoton5, "DISABLE";
     |SINO;
         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton5, "ENABLE";
     |FINSI;

     |ESTADO_CONTROL nBoton10, "ENABLE";

     |SI #isoz9000#1 = "S";  aPeriodo = "1P";  |FINSI;
     |SI #isoz9000#2 = "S";  aPeriodo = "2P";  |FINSI;
     |SI #isoz9000#3 = "S";  aPeriodo = "3P";  |FINSI;

     aDPeriodo = aPeriodo;
     aHPeriodo = aPeriodo;

     |SI #isoz9000#4 = "S";
         aPeriodo  = "";
         aDPeriodo = "1P";
         aHPeriodo = "3P";
     |FINSI;

     |PULSATECLA;

     |LINEAL_SIMPLE #1#isom9000, nRango, 0702, 3298, Baja202, Alta202, Evento202;
     enGrid = FSalida;

     |FOCOTECLADO enGrid;
     |PULSATECLA;

     |HAZ PonBotonSalir;
|FPRC;

|PROCESO Baja1;
     #maacceso#0 = 1;
     #maacceso#1 = #isoz9000#0;
|FPRC;

|PROCESO Alta1;
     #maacceso#0 = 99999;
     #maacceso#1 = #isoz9000#0;
|FPRC;

|PROCESO OtrosDatos;
     |ABRE #maempr11;
     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 6;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#39 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 17;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 18;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#41 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 22;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#53 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 1;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#60 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 57;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#61 = "S";
     |FINSI;

     #maempr11#0 = #isom9000#0;
     #maempr11#1 = #isom9000#1;
     #maempr11#2 = 23;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         #isom9000#62 = "S";
     |FINSI;

     |CIERRA #maempr11;
|FPRC;

|PROCESO Alta;

     |ABRE #maacceso;
     |CONSULTA_F_CLAVE #5#maacceso, Baja1, Alta1;
     |SI FSalida = 0;
         nEmpresa = #maacceso#0;
     |FINSI;
     |CIERRA #maacceso;

     |SI nEmpresa = 0;  |ACABA;  |FINSI;

     #isom9000#0  = nEmpresa;
     |HAZ MiraBloqueo;
     |SI eaBloqueo = "3";
         |ACABA;
     |FINSI;

     |HAZ TGravamenAnt;
     nComple = 0;
     nResult = 0;
     #isom9000#0  = nEmpresa;
     #isom9000#1  = #isoz9000#0;
     #isom9000#2  = aPeriodo;
     #isom9000#3  = nComple;
     |LEE 000#isom9000.=;
     |SI FSalida = 0;
         |MENAV "0000Ya existe datos del modelo con esta empresa.";
         |CONFI "0000NQuiere crear una complementaria";
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PARA;  |SI;  |HACIENDO;
              #isom9000#0 = nEmpresa;
              #isom9000#1 = #isoz9000#0;
              #isom9000#2 = aPeriodo;
              #isom9000#3 = nComple;
              |LEE 000#isom9000.=;
              |SI FSalida ! 0;  |SAL;  |FINSI;

              aTGravaAnt = #isom9000#43;
              nCompleAnt = #isom9000#3;
              aJusti     = #isom9000#9;
              nResult    = nResult + (#isom9000#14 + #isom9000#34);
              nComple    = nComple + 1;
         |SIGUE;
     |FINSI;

     |ABRE #agim0019;
     #agim0019#0 = #maacceso#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;

     enFicha = 0;
     |SI FSalida ! 0;  |O #agim0019#0 ! #maacceso#0;
         |DDEFECTO #agim0019;
     |SINO;
         enFicha = #agim0019#1;
     |FINSI;
     |CIERRA #agim0019;

     |ABRE #maempr10;
     #maempr10#0 = #maacceso#0;
     #maempr10#1 = #isoz9000#0;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |CIERRA #maempr10;

     enModo = 1;
     |DDEFECTO #isom9000;
     #isom9000#0 = #maacceso#0;
     #isom9000#1 = #isoz9000#0;
     #isom9000#2 = aPeriodo;
     #isom9000#3 = nComple;
     #isom9000#4 = #maacceso#3;
     #isom9000#5 = #maacceso#2;
     |SI nComple ! 0;
         |HAZ DAntComplem;
     |SINO;
         |SI #agim0019#90 = "1";  #isom9000#6 = "A";   |FINSI;
         |SI #agim0019#90 = "2";  #isom9000#6 = "B1";  |FINSI;
         |SI #agim0019#90 = "3";  #isom9000#6 = "B2";  |FINSI;
         |SI #maempr10#31 = "          ";
             #maempr10#31 = "01.01." + nAnyo;
         |FINSI;
         #isom9000#7 = #maempr10#31;
         |HAZ OtrosDatos;
     |FINSI;

     |SI #isom9000#6 = "A ";  #isom9000#13 = nResult;  |FINSI;
     |SI #isom9000#6 = "B1";  #isom9000#32 = nResult;  |FINSI;
     |SI #isom9000#6 = "B2";  #isom9000#32 = nResult;  |FINSI;

     #isom9000#35 = aJusti;
     #isom9000#43 = aTGravaAnt;
     |GRABA 020#isom9000.b;

     |HAZ MeteDatos;

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Modificar;
     |HAZ MiraBloqueo;
     |SI eaBloqueo = "3";
         |ACABA;
     |FINSI;

     |LEE 101#isom9000.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enModo = 2;
     |HAZ MeteDatos;
     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Baja;
     |LEE 101#isom9000.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el modelo seleccionado";
     |SI FSalida ! 0;  |LIBERA #isom9000;  |ACABA;  |FINSI;

     |BORRA 020#isom9000.a;
     |LIBERA #isom9000;

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO Justificante;
     |LEE 101#isom9000.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1350, -1, 16, "N£mero de justificante obtenido";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aAlfa = "LABEL,{{2}}N£mero de justificante ";
     |CONTROL_SIMPLE 0, aAlfa, 0902, 0920, NULL;

     eaJusti = #isom9000#9;
     E_inf   = "";
     E_sup   = "16";

     |PARA;  |SI;  |HACIENDO;
          eaJusti = 0922 ? 1;
          |CONFI "0000SEl n£mero introducido es correcto";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |PULSATECLA;

     #isom9000#9 = eaJusti;
     |GRABA 020#isom9000.a;
     |LIBERA #isom9000;

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/isom9000.mas";
     |CARGA_DEF  aMas, espejo@;

     |SELECT #2#isom9000;
     |LEE 000#isom9000.u;
     |SI FSalida ! 0;  |DDEFECTO #isom9000;  |FINSI;
     |SELECT #1#isom9000;

     #isoz9000#0 = #isom9000#1;
     #isoz9000#1 = "N";
     #isoz9000#2 = "N";
     #isoz9000#3 = "N";
     #isoz9000#4 = "N";

     |SI #isom9000#2 = "1P";  #isoz9000#1 = "S";  |FINSI;
     |SI #isom9000#2 = "2P";  #isoz9000#2 = "S";  |FINSI;
     |SI #isom9000#2 = "3P";  #isoz9000#3 = "S";  |FINSI;

     |SI #isoz9000#1 = "N";  |Y #isoz9000#2 = "N";  |Y #isoz9000#3 = "N";  |Y #isoz9000#4 = "N";
         #isoz9000#1 = "S";
     |FINSI;

     |SI #isoz9000#1 = "S";  aPeriodo = "1P";  |FINSI;
     |SI #isoz9000#2 = "S";  aPeriodo = "2P";  |FINSI;
     |SI #isoz9000#3 = "S";  aPeriodo = "3P";  |FINSI;

     aDPeriodo = aPeriodo;
     aHPeriodo = aPeriodo;

     |PINPA #0#isoz9000;
     nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "LABEL,{{13}}Doble click en la l¡nea para consultar", 0602, 0699, NULL;

     |CONTROL_SIMPLE nPanta, "BOTON,Cambio de ejercicio/periodo", 0578, 0598, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Pagos autom ticos MODALIDAD A", 3302, 3418, PagosAutomaticos;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Explorador predeterminado", 3320, 3436, ExploraPred;
     nBoton10 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta ", 3364, 3474, Alta;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Borrar", 3388, 3498, Baja;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar", 3376, 3486, Modificar;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Borrador del modelo", 3302, 3413, Borrador;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Emisi¢n modelo", 3315, 3426, Emision;
     nBoton7 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Justificante declaraci¢n", 3328, 3440, Justificante;
     nBoton8 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Consultar DSARCHI", 3342, 3452, Dsarchi;
     nBoton9 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Formas de pago", 3354, 3462, FormasDePago;
     nBoton11 = FSalida;

     |ESTADO_CONTROL nBoton3,  "DISABLE";
     |ESTADO_CONTROL nBoton4,  "DISABLE";
     |ESTADO_CONTROL nBoton6,  "DISABLE";
     |ESTADO_CONTROL nBoton7,  "DISABLE";
     |ESTADO_CONTROL nBoton8,  "DISABLE";
     |ESTADO_CONTROL nBoton11, "DISABLE";

     |PINDA #0#isoz9000;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#isom9000, nRango, 0702, 3298, Baja202, Alta202, Evento202;
     enGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;
     |FIN_CONTROL_WINDOWS nBoton8;
     |FIN_CONTROL_WINDOWS nBoton9;
     |FIN_CONTROL_WINDOWS nBoton10;
     |FIN_CONTROL_WINDOWS nBoton11;

     |DESCARGA_DEF #espejo@;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     |ABRET #isom9000;

     FSalida = 3499;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #isom9000;
|FPRC;
