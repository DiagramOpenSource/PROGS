|FICHEROS;
     medeword #100;
     medgword #200;
     meempmem #101;
     mew00004 #98;
|FIN;

|VARIABLES;
     aNombreFich  = "";
     aNombreTexto = "";
     nDesdeAny    = 0;
     nHastaAny    = 0;
     aBase        = "";
     aPlantilla   = "";
     aDirMenu     = "";
     aOrigen      = "";
     aDestino     = "";
     aExtension   = "";
     aCadena1     = "";
     aCadena2     = "";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aLen         = "";
     aImpor1      = "";
     aImpor2      = "";
     aImpor3      = "";
     aImpor4      = "";
     aCadena      = "";
     aCaracter    = "";
     aIPRemoto    = "";

     nEstado       = 0;
     nSwBueno      = 0;
     nContaPuntero = 0;
     nConta        = 0;
     nEmpresas     = 0;
     nLen          = 0;
     nCampo        = 0;
     nPos          = 0;

     &eaContador   = "";
     &eaImporte    = "";
     &eaAlfa       = "";
     &eaOrigen     = "";
     &eaDestino    = "";
     &enSwTrata    = 0;
     &enCanti      = 0;

 {500}npEmpresas = 0;
|FIN;

|PROCESO Importe;    || Calculo para poner las comas en el importe
     enCanti   = eaImporte;
     enSwTrata = 1;
     |HAZ SeparaImporte;
|FPRC;

|PROCESO LeeTexto;
     nSwBueno = 0;

     |SI eaContador = "1,2,2";
         |ABRE #100;
         #100#0 = aNombreFich % 206;
         |LEE 040#100=;
         |SI FSalida = 0;  nSwBueno = 1;  |FINSI;
         |CIERRA #100;
         aNombreTexto = #100#1;
         nDesdeAny    = #100#3;
         nHastaAny    = #100#4;
     |FINSI;

     |SI eaContador = "1,3,2";
         |ABRE #200;
         #200#0 = aNombreFich % 206;
         |LEE 040#200=;
         |SI FSalida = 0;  nSwBueno = 1;  |FINSI;
         |CIERRA #200;
         aNombreTexto = #200#1;
         nDesdeAny    = 0;
         nHastaAny    = 9999;
     |FINSI;
|FPRC;

|PROCESO DirEmpresas;
     aPlantilla = aDirMenu + (("00000" + npEmpresas) % -105) + "/";
     aOrigen    = aDirMenu + (("00000" + npEmpresas) % -105) + "/";
     |_PDIR aOrigen;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aCadena1 = aOrigen    > " ";
            aCadena2 = aExtension > " ";
            aDestino = aCadena1 - aCadena2;
            |SI aDestino ! aCadena1;
                aCadena1    = aOrigen > " ";
                aCadena2    = aPlantilla > " ";  |QBF aCadena2
                aNombreFich = aCadena1 - aCadena2;
                |HAZ LeeTexto;
                |SI nSwBueno = 1;
                    #98#0 = aNombreFich % 206;
                    aAlfa = ("00000" + npEmpresas) % -105;
                    #98#1 = aAlfa;
                    #98#2 = aNombreTexto;
                    #98#3 = nDesdeAny;
                    #98#4 = nHastaAny;
                    |LEE 040#98a;
                    nEstado = FSalida;
                    #98#0 = aNombreFich % 206;
                    aAlfa = ("00000" + npEmpresas) % -105;
                    #98#1 = aAlfa;
                    #98#2 = aNombreTexto;
                    #98#3 = nDesdeAny;
                    #98#4 = nHastaAny;
                    |SI nEstado ! 0; |GRABA 020#98n; |FINSI;
                    |SI nEstado = 0; |GRABA 020#98a; |FINSI;
                    |LIBERA #98;
                |FINSI;
           |FINSI;
           |_SDIR aOrigen;
     |SIGUE;
|FPRC;

|PROCESO CreaTempoMem;
     |ABRE #98;

     |DBASE aBase;   |QBF aBase;
     aDirMenu   = aBase + "word/memoria/";
     aPlantilla = aDirMenu;
     aOrigen    = aDirMenu;
     aExtension = ".doc";

     |_PDIR aOrigen;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aCadena1 = aOrigen    > " ";
            aCadena2 = aExtension > " ";
            aDestino = aCadena1 - aCadena2;
            |SI aDestino ! aCadena1;
                aCadena1    = aOrigen > " ";
                aCadena2    = aPlantilla > " ";  |QBF aCadena2
                aNombreFich = aCadena1 - aCadena2;
                |HAZ LeeTexto;
                |SI nSwBueno = 1;
                    #98#0 = aNombreFich % 206;
                    #98#1 = "00000";
                    #98#2 = aNombreTexto;
                    #98#3 = nDesdeAny;
                    #98#4 = nHastaAny;
                    |LEE 040#98=;
                    nEstado = FSalida;
                    #98#0 = aNombreFich % 206;
                    #98#1 = "00000";
                    #98#2 = aNombreTexto;
                    #98#3 = nDesdeAny;
                    #98#4 = nHastaAny;
                    |SI nEstado ! 0; |GRABA 020#98n; |FINSI;
                    |SI nEstado = 0; |GRABA 020#98a; |FINSI;
                    |LIBERA #98;
                |FINSI;
            |SINO;
                aNombreFich = aOrigen % -105;
                nEmpresas   = aNombreFich;
                |ABRE #101;
                #101#0 = nEmpresas;
                |LEE 040#101=;
                |SI FSalida = 0;
                    InpEmpresas   = npEmpresas1 <-;
                    InpEmpresas   = InpEmpresas + nContaPuntero;
                    npEmpresas    = #101#0;
                    nContaPuntero = nContaPuntero + 1;
                |FINSI;
                |CIERRA #101;
            |FINSI;

            |_SDIR aOrigen;
     |SIGUE;

     |SI nContaPuntero ! 0;
         |PARA nConta = 0;  |SI nConta [ nContaPuntero;  |HACIENDO nConta = nConta + 1;
               InpEmpresas = npEmpresas1 <-;
               InpEmpresas = InpEmpresas + nConta;
               |HAZ DirEmpresas;
         |SIGUE;
     |FINSI;
     |CIERRA #98;
|FPRC;

|PROCESO CreaTempoGes;
     |ABRE #98;

     |DBASE aBase;   |QBF aBase;
     aDirMenu   = aBase + "word/gestion/";
     aPlantilla = aDirMenu;
     aOrigen    = aDirMenu;
     aExtension = ".doc";

     |_PDIR aOrigen;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aCadena1 = aOrigen    > " ";
            aCadena2 = aExtension > " ";
            aDestino = aCadena1 - aCadena2;
            |SI aDestino ! aCadena1;
                aCadena1    = aOrigen > " ";
                aCadena2    = aPlantilla > " ";  |QBF aCadena2
                aNombreFich = aCadena1 - aCadena2;
                |HAZ LeeTexto;
                |SI nSwBueno = 1;
                    #98#0 = aNombreFich % 206;
                    #98#1 = "00000";
                    #98#2 = aNombreTexto;
                    #98#3 = nDesdeAny;
                    #98#4 = nHastaAny;
                    |LEE 040#98=;
                    nEstado = FSalida;
                    #98#0 = aNombreFich % 206;
                    #98#1 = "00000";
                    #98#2 = aNombreTexto;
                    #98#3 = nDesdeAny;
                    #98#4 = nHastaAny;
                    |SI nEstado ! 0; |GRABA 020#98n; |FINSI;
                    |SI nEstado = 0; |GRABA 020#98a; |FINSI;
                    |LIBERA #98;
                |FINSI;
            |SINO;
                aNombreFich = aOrigen % -105;
                nEmpresas   = aNombreFich;
                |ABRE #101;
                #101#0 = nEmpresas;
                |LEE 040#101=;
                |SI FSalida = 0;
                    InpEmpresas   = npEmpresas1 <-;
                    InpEmpresas   = InpEmpresas + nContaPuntero;
                    npEmpresas    = #101#0;
                    nContaPuntero = nContaPuntero + 1;
                |FINSI;
                |CIERRA #101;
            |FINSI;

            |_SDIR aOrigen;
     |SIGUE;

     |SI nContaPuntero ! 0;
         |PARA nConta = 0;  |SI nConta [ nContaPuntero;  |HACIENDO nConta = nConta + 1;
               InpEmpresas = npEmpresas1 <-;
               InpEmpresas = InpEmpresas + nConta;
               |HAZ DirEmpresas;
         |SIGUE;
     |FINSI;
     |CIERRA #98;
|FPRC;

|PROCESO QuitaRaros;
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO QuitaRarosXBRL;
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = "¥";  aCaracter = "Ã‘"; |FINSI;
           |SI aCaracter = "¤";  aCaracter = "Ã±"; |FINSI;
           |SI aCaracter = " ";  aCaracter = "Ã¡"; |FINSI;
           |SI aCaracter = "‚";  aCaracter = "Ã©"; |FINSI;
           |SI aCaracter = "¡";  aCaracter = "Ã­"; |FINSI;
           |SI aCaracter = "¢";  aCaracter = "Ã³"; |FINSI;
           |SI aCaracter = "£";  aCaracter = "Ãº"; |FINSI;
           |SI aCaracter = "§";  aCaracter = "Âº"; |FINSI;
           |SI aCaracter = "¦";  aCaracter = "Âª"; |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO PonComas;
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = ".";  aCaracter = ","; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO SacaFecha;
     aAlfa1 = eaAlfa % 102;
     aAlfa2 = eaAlfa % 402;
     aAlfa3 = eaAlfa % 704;
     |SI aAlfa2 = "01";  aAlfa2 = "Enero";      |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "Febrero";    |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "Marzo";      |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "Abril";      |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "Mayo";       |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "Junio";      |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "Julio";      |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "Agosto";     |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "Septiembre"; |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "Octubre";    |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "Noviembre";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "Diciembre";  |FINSI;

     eaAlfa = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
|FPRC;
