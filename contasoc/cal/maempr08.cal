|FICHEROS;
   maempr08 #0;
   maacceso;
   maempr01;
   maempr02;
   maempr03;
   maempr04;
   maempr05;
   maempr06;
   maempr11;
   maempr12;
   maempr13;
   maempr14;
   maempr15;
   maempr17;
   maempr18;
   maempr19;
   maempr20;
   maempr21;
   maempr22;
   maempr23;
   maempr24;
   maempr25;

  isacceso;

   &clientes@ #715;
|FIN;

|VARIABLES;
    aAlfa     = "";
    aAlfa1    = "";
    fecsys    = @;
    alfa1     = "";
    nume1     = 0;
    mas_uno   = 0;
    fHFecha   = @;
    fDFecha   = @;
    nSw       = 0;
    fFechaA   = @;
    fFechaB   = @;
    &enSwDeDonde = 0;
    &enCodCli    = 0;

    nSwGrabar = 1;

    &enEmpresa = 0;
    &enAnyo    = 0;
    &enMensa   = 0;
    nNume      = 0;
|FIN;

|CALCULO defecto; |TIPO 7;
    fecsys = ~;
    alfa1 = fecsys;
    alfa1 = alfa1 % -104;
    nume1 = alfa1;
    #maempr08#2 = nume1 - 2;
    #maempr08#3 = nume1 - 1;
    |PINTA #maempr08#2;
    |PINTA #maempr08#3;
|FCAL;

|PROCESO Tipo0C3;  |TIPO 0;
    |SI #maempr08#3 [ #maempr08#2;
        |MENAV "0000 El ejercicio destino debe ser superior al ejercicio origen.";
        |ERROR;
    |FINSI;
|FPRC;

||*************************************
|PROCESO LeeEmpr;
 nSw = 0;
 |SI #maempr08#5 = "A";
     |HAZ LeePersona;
     |SI enSwDeDonde = 1;
         fFechaA = #715#6;
         fFechaB = #715#7;
     |SINO;
         fFechaA = #715#93;
         fFechaB = #715#94;
     |FINSI;
     |SI fFechaA > fHFecha; nSw = 1; |FINSI;
     |SI fFechaB > "01.01.1900";
         |SI  fFechaB < fDFecha; nSw = 1; |FINSI;
     |FINSI;
 |FINSI;

 |SI nSw = 0;
     #isacceso#0 = #maacceso#0;   || Acceso al Impuesto
     #isacceso#1 = #maempr08#3;
     |LEE 041#isacceso.=;
     |SI FSalida = 0;
         |SI #isacceso#6 = "S"; nSw = 1; |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

||**************************************************************
|PROCESO BorraFich2;
  |BORRA 020#maempr02.a;
  |LIBERA #maempr02;
|FPRC;

|DEFBUCLE Bmaempr02;
  #maempr02#1;
  ;
  enCodCli, #maempr08#3, 001;
  enCodCli, #maempr08#3, 999;
  be;
  NULL, BorraFich2;
|FIN;

|PROCESO BorraFich3;
  |BORRA 020#maempr03.a;
  |LIBERA #maempr03;
|FPRC;

|DEFBUCLE Bmaempr03;
  #maempr03#1;
  ;
  enCodCli, #maempr08#3, 01;
  enCodCli, #maempr08#3, 99;
  be;
  NULL, BorraFich3;
|FIN;

|PROCESO BorraFich4;
  |BORRA 020#maempr04.a;
  |LIBERA #maempr04;
|FPRC;

|DEFBUCLE Bmaempr04;
  #maempr04#1;
  ;
  enCodCli, #maempr08#3, 01;
  enCodCli, #maempr08#3, 99;
  be;
  NULL, BorraFich4;
|FIN;

|PROCESO BorraFich5;
  |BORRA 020#maempr05.a;
  |LIBERA #maempr05;
|FPRC;

|DEFBUCLE Bmaempr05;
  #maempr05#1;
  ;
  enCodCli, #maempr08#3, 01;
  enCodCli, #maempr08#3, 99;
  be;
  NULL, BorraFich5;
|FIN;

|PROCESO BorraFich6;
  |BORRA 020#maempr06.a;
  |LIBERA #maempr06;
|FPRC;

|DEFBUCLE Bmaempr06;
   #maempr06#1;
   ;
   enCodCli, #maempr08#3, 01;
   enCodCli, #maempr08#3, 99;
   be;
   NULL, BorraFich6;
|FIN;

|PROCESO BorraFich8;
  |BORRA 020#maempr11.a;
  |LIBERA #maempr11;
|FPRC;

|DEFBUCLE Bmaempr11;
   #maempr11#1;
   ;
   enCodCli, #maempr08#3, 001;
   enCodCli, #maempr08#3, 999;
   be;
   NULL, BorraFich8;
|FIN;

|PROCESO BorraFich9;
  |BORRA 020#maempr12.a;
  |LIBERA #maempr12;
|FPRC;

|DEFBUCLE Bmaempr12;
   #maempr12#1;
   ;
   enCodCli, #maempr08#3, 01;
   enCodCli, #maempr08#3, 99;
   be;
   NULL, BorraFich9;
|FIN;

|PROCESO BorraFich10;
  |BORRA 020#maempr13.a;
  |LIBERA #maempr13;
|FPRC;

|DEFBUCLE Bmaempr13;
   #maempr13#1;
   ;
   enCodCli, #maempr08#3, 01, 01;
   enCodCli, #maempr08#3, 99, 99;
   be;
   NULL, BorraFich10;
|FIN;

|PROCESO BorraFich11;
  |BORRA 020#maempr14.a;
  |LIBERA #maempr14;
|FPRC;

|DEFBUCLE Bmaempr14;
   #maempr14#1;
   ;
   enCodCli, #maempr08#3, 00, 01;
   enCodCli, #maempr08#3, 99, 99;
   be;
   NULL, BorraFich11;
|FIN;

|PROCESO BorraFich12;
  |BORRA 020#maempr15.a;
  |LIBERA #maempr15;
|FPRC;

|DEFBUCLE Bmaempr15;
   #maempr15#1;
   ;
   enCodCli, #maempr08#3, 00, 01;
   enCodCli, #maempr08#3, 99, 99;
   be;
   NULL, BorraFich12;
|FIN;

|PROCESO Bmaempr17;
  #maempr17#0 = enCodCli;
  #maempr17#1 = #maempr08#3;
  |LEE 041#maempr17.=;
  |SI FSalida = 0;
      |BORRA 020#maempr17.a;
  |FINSI;
  |LIBERA #maempr17;
|FPRC;

|PROCESO BorraFich18;
  |BORRA 020#maempr18.a;
  |LIBERA #maempr18;
|FPRC;

|DEFBUCLE Bmaempr18;
   #maempr18#1;
   ;
   enCodCli, #maempr08#3, 00, 01;
   enCodCli, #maempr08#3, 99, 99;
   be;
   NULL, BorraFich18;
|FIN;

|PROCESO BorraFich19;
  |BORRA 020#maempr19.a;
  |LIBERA #maempr19;
|FPRC;

|DEFBUCLE Bmaempr19;
  #maempr19#1;
  ;
  enCodCli, #maempr08#3, 00, 01;
  enCodCli, #maempr08#3, 99, 99;
  be;
  NULL, BorraFich19;
|FIN;

|PROCESO BorraFich20;
  |BORRA 020#maempr20.a;
  |LIBERA #maempr20;
|FPRC;

|DEFBUCLE Bmaempr20;
  #maempr20#1;
  ;
  enCodCli, #maempr08#3, 00, 01, 01;
  enCodCli, #maempr08#3, 99, 99, 01;
  be;
  NULL, BorraFich20;
|FIN;

|PROCESO BorraFich21;
  |BORRA 020#maempr21.a;
  |LIBERA #maempr21;
|FPRC;

|DEFBUCLE Bmaempr21;
  #maempr21#1;
  ;
  enCodCli, #maempr08#3, 01;
  enCodCli, #maempr08#3, 99;
  be;
  NULL, BorraFich21;
|FIN;

|PROCESO BorraFich22;
  |BORRA 020#maempr22.a;
  |LIBERA #maempr22;
|FPRC;

|DEFBUCLE Bmaempr22;
  #maempr22#1;
  ;
  enCodCli, #maempr08#3, 001;
  enCodCli, #maempr08#3, 999;
  be;
  NULL, BorraFich22;
|FIN;

|PROCESO BorraFich23;
  |BORRA 020#maempr23.a;
  |LIBERA #maempr23;
|FPRC;

|DEFBUCLE Bmaempr23;
  #maempr23#1;
  ;
  enCodCli, #maempr08#3, 01;
  enCodCli, #maempr08#3, 99;
  be;
  NULL, BorraFich23;
|FIN;

|PROCESO BorraFich24;
  |BORRA 020#maempr24.a;
  |LIBERA #maempr24;
|FPRC;

|DEFBUCLE Bmaempr24;
  #maempr24#1;
  ;
  enCodCli, #maempr08#3, 01;
  enCodCli, #maempr08#3, 99;
  be;
  NULL, BorraFich24;
|FIN;

|PROCESO Bmaempr25;
  |ABRE #maempr25;
  #maempr25#0 = enCodCli;
  #maempr25#1 = #maempr08#3;
  |LEE 141#maempr25.=;
  |SI FSalida = 0;
      |BORRA 020#maempr25.a;
  |FINSI;
  |LIBERA #maempr25;
  |CIERRA #maempr25;
|FPRC;

||******************************************************************
|PROCESO Graba1;
    #maempr01#1 = #maempr08#3;

    aAlfa1 = (#maempr01#16 % -101);
    aAlfa = (#maempr01#1 % -102) + aAlfa1;
    #maempr01#16 = aAlfa;

    #maempr01#31 = "01.01." + #maempr08#3;       || desde per. impositivo
    #maempr01#32 = "31.12." + #maempr08#3;       || hasta per. impositivo

    alfa1 = #maempr01#33 % 106; |QBF alfa1;
    |SI alfa1 = ""; alfa1 = "30.03."; |FINSI;
    #maempr01#33 = alfa1 + mas_uno;    || aprob.cuentas

    alfa1 = #maempr01#83 % 106; |QBF alfa1;
    |SI alfa1 = ""; alfa1 = "30.06."; |FINSI;
    #maempr01#83 = alfa1 + mas_uno;    || aprob.cuenta perd.y ganan.

   |SI nNume = 1;
       #maempr01#87  = #maempr01#86;
       #maempr01#89  = #maempr01#88;
       #maempr01#104 = #maempr01#103;
       #maempr01#106 = #maempr01#105;
       #maempr01#108 = #maempr01#107;
       #maempr01#110 = #maempr01#109;
       #maempr01#112 = #maempr01#111;
   |FINSI;

   |GRABA 000#maempr01.n;
   |LIBERA #maempr01;
|FPRC;

||**************
|PROCESO Graba2;
  #maempr02#1 = #maempr08#3;
  |GRABA 000#maempr02.n;
  |LIBERA #maempr02;
|FPRC;

|DEFBUCLE maempr02;
  #maempr02#1;
  ;
  enCodCli, #maempr08#2, 001;
  enCodCli, #maempr08#2, 999;
  be;
  NULL, Graba2;
|FIN;

||**************
|PROCESO Graba3;
  #maempr03#1 = #maempr08#3;
  |GRABA 000#maempr03.n;
  |LIBERA #maempr03;
|FPRC;

|DEFBUCLE maempr03;
  #maempr03#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL,Graba3;
|FIN;

||*************
|PROCESO Graba4;
  #maempr04#1 = #maempr08#3;
  |GRABA 000#maempr04.n;
  |LIBERA #maempr04;
|FPRC;

|DEFBUCLE maempr04;
  #maempr04#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL,Graba4;
|FIN;

||**************
|PROCESO Graba5;
  #maempr05#1 = #maempr08#3;
  |GRABA 000#maempr05.n;
  |LIBERA #maempr05;
|FPRC;

|DEFBUCLE maempr05;
  #maempr05#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL,Graba5;
|FIN;

||**************
|PROCESO Graba6;
  #maempr06#1 = #maempr08#3;
  |GRABA 000#maempr06.n;
  |LIBERA #maempr06;
|FPRC;

|DEFBUCLE maempr06;
  #maempr06#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL, Graba6;
|FIN;

||**************
|PROCESO Graba8;
  #maempr11#1 = #maempr08#3;
  |GRABA 000#maempr11.n;
  |LIBERA #maempr11;
|FPRC;

|DEFBUCLE maempr11;
  #maempr11#1;
  ;
  enCodCli, #maempr08#2, 001;
  enCodCli, #maempr08#2, 999;
  be;
  NULL, Graba8;
|FIN;

||*************
|PROCESO Graba9;
  #maempr12#1 = #maempr08#3;
  |GRABA 000#maempr12.n;
  |LIBERA #maempr12;
|FPRC;

|DEFBUCLE maempr12;
  #maempr12#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL, Graba9;
|FIN;

||***************
|PROCESO Graba10;
  #maempr13#1 = #maempr08#3;
  |GRABA 000#maempr13.n;
  |LIBERA #maempr13;
|FPRC;

|DEFBUCLE maempr13;
  #maempr13#1;
  ;
  enCodCli, #maempr08#2, 01, 01;
  enCodCli, #maempr08#2, 99, 99;
  be;
  NULL, Graba10;
|FIN;

||***************
|PROCESO Graba11;
  #maempr14#1 = #maempr08#3;
  |GRABA 000#maempr14.n;
  |LIBERA #maempr14;
|FPRC;

|DEFBUCLE maempr14;
  #maempr14#1;
  ;
  enCodCli, #maempr08#2, 00, 01;
  enCodCli, #maempr08#2, 00, 99;
  be;
  NULL, Graba11;
|FIN;

||***************
|PROCESO Graba12;
  #maempr15#1 = #maempr08#3;
  |GRABA 000#maempr15.n;
  |LIBERA #maempr15;
|FPRC;

|DEFBUCLE maempr15;
  #maempr15#1;
  ;
  enCodCli, #maempr08#2, 00, 01;
  enCodCli, #maempr08#2, 00, 99;
  be;
  NULL, Graba12;
|FIN;

||*************************************
|PROCESO Graba17;
  #maempr17#1 = #maempr08#3;
  |GRABA 000#maempr17.n;
  |LIBERA #maempr17;
|FPRC;

||***************
|PROCESO Graba18;
  #maempr18#1 = #maempr08#3;
  |GRABA 000#maempr18.n;
  |LIBERA #maempr18;
|FPRC;

|DEFBUCLE maempr18;
  #maempr18#1;
  ;
  enCodCli, #maempr08#2, 00, 01;
  enCodCli, #maempr08#2, 00, 99;
  be;
  NULL, Graba18;
|FIN;

|PROCESO Graba19;
  #maempr19#1 = #maempr08#3;
  |GRABA 000#maempr19.n;
  |LIBERA #maempr19;
|FPRC;

|DEFBUCLE maempr19;
  #maempr19#1;
  ;
  enCodCli, #maempr08#2, 00, 01;
  enCodCli, #maempr08#2, 99, 99;
  be;
  NULL, Graba19;
|FIN;

|PROCESO Graba20;
  #maempr20#1 = #maempr08#3;
  |GRABA 000#maempr20.n;
  |LIBERA #maempr20;
|FPRC;

|DEFBUCLE maempr20;
  #maempr20#1;
  ;
  enCodCli, #maempr08#2, 00, 01, 01;
  enCodCli, #maempr08#2, 99, 99, 01;
  be;
  NULL, Graba20;
|FIN;

|PROCESO Graba21;
  #maempr21#1 = #maempr08#3;
  |GRABA 000#maempr21.n;
  |LIBERA #maempr21;
|FPRC;

|DEFBUCLE maempr21;
  #maempr21#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL, Graba21;
|FIN;

|PROCESO Graba22;
  #maempr22#1 = #maempr08#3;
  |GRABA 000#maempr22.n;
  |LIBERA #maempr22;
|FPRC;

|DEFBUCLE maempr22;
  #maempr22#1;
  ;
  enCodCli, #maempr08#2, 001;
  enCodCli, #maempr08#2, 999;
  be;
  NULL, Graba22;
|FIN;

|PROCESO Graba23;
  #maempr23#1 = #maempr08#3;
  |GRABA 000#maempr23.n;
  |LIBERA #maempr23;
|FPRC;

|DEFBUCLE maempr23;
  #maempr23#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL, Graba23;
|FIN;

|PROCESO Graba24;
  #maempr24#1 = #maempr08#3;
  |GRABA 000#maempr24.n;
  |LIBERA #maempr24;
|FPRC;

|DEFBUCLE maempr24;
  #maempr24#1;
  ;
  enCodCli, #maempr08#2, 01;
  enCodCli, #maempr08#2, 99;
  be;
  NULL, Graba24;
|FIN;

|PROCESO maempr25;
  |ABRE #maempr25;
  #maempr25#0 = enCodCli;
  #maempr25#1 = #maempr08#2;
  |LEE 141#maempr25.=;
  |SI FSalida = 0;
      #maempr25#1 = #maempr08#3;
      |GRABA 000#maempr25.n;
  |FINSI;
  |LIBERA #maempr25;
  |CIERRA #maempr25;
|FPRC;

|| //////////////////////////////////////////////////////////////////////////
|PROCESO BorraTodo;

     |BORRA 020#maempr01.a;
     |LIBERA #maempr01;

     |BUCLE Bmaempr02;
     |BUCLE Bmaempr03;
     |BUCLE Bmaempr04;
     |BUCLE Bmaempr05;
     |BUCLE Bmaempr06;
     |BUCLE Bmaempr11;
     |BUCLE Bmaempr12;
     |BUCLE Bmaempr13;
     |BUCLE Bmaempr14;
     |BUCLE Bmaempr15;
     |HAZ Bmaempr17;
     |BUCLE Bmaempr18;
     |BUCLE Bmaempr19;
     |BUCLE Bmaempr20;
     |BUCLE Bmaempr21;
     |SI #maempr08#2 ] 2017;
         |BUCLE Bmaempr22;
         |BUCLE Bmaempr23;
         |BUCLE Bmaempr24;
         |HAZ Bmaempr25;
     |FINSI;
|FPRC;

|PROCESO GrabaTodo;

  |DDEFECTO #maempr01;
  #maempr01#0 = #maacceso#0;
  #maempr01#1 = #maempr08#2;
  |LEE 041#maempr01.=;
  |HAZ Graba1;

  |BUCLE maempr02;
  |BUCLE maempr03;
  |BUCLE maempr04;
  |BUCLE maempr05;
  |BUCLE maempr06;
  |BUCLE maempr11;
  |BUCLE maempr12;
  |BUCLE maempr13;
  |BUCLE maempr14;
  |BUCLE maempr15;

  |DDEFECTO #maempr17;
  #maempr17#0 = #maacceso#0;
  #maempr17#1 = #maempr08#2;
  |LEE 041#maempr17.=;
  |HAZ Graba17;

  |BUCLE maempr18;
  |BUCLE maempr19;
  |BUCLE maempr20;
  |BUCLE maempr21;
  |BUCLE maempr22;
  |BUCLE maempr23;
  |BUCLE maempr24;
  |HAZ maempr25;
|FPRC;

|PROCESO acceso;
  enCodCli = #maacceso#0;
  |HAZ LeeEmpr;
  |SI nSw = 1;
      |LIBERA #maacceso;
      |ACABA;
  |FINSI;

  |DDEFECTO #maempr01;
  #maempr01#0 = #maacceso#0;
  #maempr01#1 = #maempr08#2;
  |LEE 041#maempr01.=;
  |SI FSalida ! 0;
      |LIBERA #maacceso;
      |ACABA;
  |FINSI;

  |DDEFECTO #maempr01;
  #maempr01#0 = #maacceso#0;
  #maempr01#1 = #maempr08#3;
  |LEE 041#maempr01.=;
  |SI FSalida = 0;
      |SI #maempr08#4 = "N";
          |LIBERA #maacceso;
          |ACABA;
      |SINO;
          |HAZ BorraTodo;
      |FINSI;
  |FINSI;

  |HAZ GrabaTodo;

  #maacceso#1 = #maempr08#3;
  |GRABA 000#maacceso.n;
  |LIBERA #maacceso;
  nSwGrabar = 1;
|FPRC;

|DEFBUCLE maacceso;
  #maacceso#1;
  ;
  #maempr08#0, #maempr08#2;
  #maempr08#1, #maempr08#2;
  be;
  NULL,acceso;
|FIN;

|PROCESO duplicar; |TIPO 3;
  aAlfa   = "31.12." + #maempr08#3;
  fHFecha = aAlfa;
  aAlfa   = "01.01." + #maempr08#3;
  fDFecha = aAlfa;

  nNume   = #maempr08#3 - #maempr08#2;
  mas_uno = #maempr08#3 + 1;

  |ABRE #isacceso;
  |ABRE #maempr01;
  |ABRE #maempr17;

  |BUCLE maacceso;

  |CIERRA #maempr17;
  |CIERRA #maempr01;
  |CIERRA #isacceso;
|FPRC;

|PROGRAMA;

     |SI enEmpresa = 0;
         |CLS;
         |CABEZA "Duplicar Empresas";
         |PINPA #0#maempr08;
         |PINDA #0#maempr08;
         |ENDATOS #1#maempr08;
         |SI FSalida = 0;  |HAZ duplicar;  |FINSI;
     |SINO;
||         |MENSA "      DUPLICANDO EMPRESAS";
         #maempr08#0 = enEmpresa;
         #maempr08#1 = enEmpresa;
         #maempr08#2 = enAnyo - 1;
         #maempr08#3 = enAnyo;
         #maempr08#4 = "N";
         #maempr08#5 = "T";
         nSwGrabar = 0;
         |HAZ duplicar;
         |SI enMensa = 0;
             |SI nSwGrabar = 1;
                 |MENAV "      EMPRESA DUPLICADA.";
             |SINO;
                 |MENAV "      LA EMPRESA NO SE HA DUPLICADO";
             |FINSI;
         |FINSI;
    |FINSI;
|FPRO;
