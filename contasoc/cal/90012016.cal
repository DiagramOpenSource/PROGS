|FICHEROS;
     isom9000;
     maempr01;

     :basica/agim0019;

     isow9018;                    || Registro emision 2016 H1
     isow9019;                    || Registro emision 2016 H2

     &clientes@;
|FIN;

|INCLUYE 9001vari;

|PROCESO FormaPago2016;
     |SI enSwDeDonde = 1;
         enModelo = 202;  enForzar = 1;  |HAZ CogeDatosBancos;

         #isow9019#32 = eaIBAN;
     |SINO;
         #isow9019#32 = #clientes@#99;
     |FINSI;

                          #isow9018#6 = "I";
     |SI enFormaPag = 3;  #isow9018#6 = "U";  |FINSI;
     |SI enFormaPag = 6;  #isow9018#6 = "G";  |FINSI;
|FPRC;

|PROCESO P90012016_1P;
     |ABRE #agim0019;
     #agim0019#0 = #isom9000#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #isom9000#0;
         aCNAE = #agim0019#40;
     |FINSI;

     |ABRE #maempr01;
     #maempr01#0 = #isom9000#0;
     #maempr01#1 = #isom9000#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr01;  |FINSI;
     |CIERRA #maempr01;

     |DDEFECTO #isow9018;
     |DDEFECTO #isow9019;

     #isow9018#7  = #isom9000#4;
     #isow9018#8  = #isom9000#5;
     #isow9018#10 = #isom9000#1;
     #isow9018#11 = #isom9000#2;
     #isow9018#12 = (#isom9000#7 % 102) + (#isom9000#7 % 402) + (#isom9000#7 % 704);
     #isow9018#13 = aCNAE;

     |SI #isom9000#60 = "S";  #isow9018#14 = "X";  |FINSI;
     |SI #isom9000#61 = "S";  #isow9018#15 = "X";  |FINSI;
     |SI #isom9000#62 = "S";  #isow9018#16 = "X";  |FINSI;
     |SI #isom9000#53 = "S";  #isow9018#17 = "X";  |FINSI;
     |SI #isom9000#39 = "S";  #isow9018#18 = "X";  |FINSI;
     |SI #isom9000#40 = "S";  #isow9018#19 = "X";  |FINSI;

                              #isow9018#20 = "0";
     |SI #isom9000#41 = "S";  #isow9018#20 = "1";  |FINSI;
     |SI #isom9000#42 = "S";  #isow9018#20 = "2";  |FINSI;

     #isow9018#21 = #isom9000#43;
     #isow9018#22 = #isom9000#38;

     || ... |SI #isom9000#44 = "S";  #isow9018#23 = "X";  |FINSI;

     enCanti = #isom9000#10;  |HAZ Calcula17D;  #isow9018#24 = eaAlfa;
     enCanti = #isom9000#13;  |HAZ Calcula17D;  #isow9018#25 = eaAlfa;
     enCanti = #isom9000#14;  |HAZ Calcula17D;  #isow9018#26 = eaAlfa;

     enCanti = #isom9000#15;  |HAZ Calcula17D;  #isow9018#27 = eaAlfa;
     enCanti = #isom9000#45;  |HAZ Calcula17D;  #isow9018#28 = eaAlfa;
     enCanti = #isom9000#46;  |HAZ Calcula17D;  #isow9018#29 = eaAlfa;
     enCanti = #isom9000#54;  |HAZ Calcula17D;  #isow9018#30 = eaAlfa;
     enCanti = #isom9000#55;  |HAZ Calcula17D;  #isow9018#31 = eaAlfa;
     enCanti = #isom9000#47;  |HAZ Calcula17D;  #isow9018#32 = eaAlfa;
     enCanti = #isom9000#48;  |HAZ Calcula17D;  #isow9018#33 = eaAlfa;
     enCanti = #isom9000#56;  |HAZ Calcula17D;  #isow9018#34 = eaAlfa;
     enCanti = #isom9000#57;  |HAZ Calcula17D;  #isow9018#35 = eaAlfa;


     enCanti = #isom9000#50;  |HAZ Calcula17D;  #isow9018#38 = eaAlfa;
     enCanti = #isom9000#64;  |HAZ Calcula17D;  #isow9018#39 = eaAlfa;
     enCanti = #isom9000#17;  |HAZ Calcula17D;  #isow9018#40 = eaAlfa;
     enCanti = #isom9000#65;  |HAZ Calcula17D;  #isow9018#41 = eaAlfa;
     enCanti = #isom9000#66;  |HAZ Calcula17D;  #isow9018#42 = eaAlfa;
     enCanti = #isom9000#18;  |HAZ Calcula17D;  #isow9018#43 = eaAlfa;
     enCanti = #isom9000#19 * 100;              #isow9018#44 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#67;  |HAZ Calcula17D;  #isow9018#45 = eaAlfa;
     enCanti = #isom9000#58;  |HAZ Calcula17D;  #isow9018#46 = eaAlfa;
     enCanti = #isom9000#68;  |HAZ Calcula17D;  #isow9018#47 = eaAlfa;
     enCanti = #isom9000#69;  |HAZ Calcula17D;  #isow9018#48 = eaAlfa;
     enCanti = #isom9000#20;  |HAZ Calcula17D;  #isow9018#49 = eaAlfa;

     enCanti = #isom9000#21;  |HAZ Calcula17D;  #isow9019#6  = eaAlfa;
     enCanti = #isom9000#22;  |HAZ Calcula17D;  #isow9019#7  = eaAlfa;
     enCanti = #isom9000#23 * 100;              #isow9019#8  = ("00000" + enCanti) % -105;
     enCanti = #isom9000#24;  |HAZ Calcula17D;  #isow9019#9  = eaAlfa;
     enCanti = #isom9000#25;  |HAZ Calcula17D;  #isow9019#10 = eaAlfa;
     enCanti = #isom9000#26 * 100;              #isow9019#11 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#27;  |HAZ Calcula17D;  #isow9019#12 = eaAlfa;
     enCanti = #isom9000#70;  |HAZ Calcula17D;  #isow9019#13 = eaAlfa;
     enCanti = #isom9000#59;  |HAZ Calcula17D;  #isow9019#14 = eaAlfa;
     enCanti = #isom9000#71;  |HAZ Calcula17D;  #isow9019#15 = eaAlfa;
     enCanti = #isom9000#72;  |HAZ Calcula17D;  #isow9019#16 = eaAlfa;
     enCanti = #isom9000#28;  |HAZ Calcula17D;  #isow9019#17 = eaAlfa;
     enCanti = #isom9000#29;  |HAZ Calcula17D;  #isow9019#18 = eaAlfa;
     enCanti = #isom9000#30;  |HAZ Calcula17D;  #isow9019#19 = eaAlfa;
                                                #isow9019#20 = "00000";
     |SI #isom9000#6 ! "A ";
         enCanti = #isom9000#31 * 100;          #isow9019#20 = ("00000" + enCanti) % -105;
     |FINSI;

     enCanti = #isom9000#33;  |HAZ Calcula17D;  #isow9019#21 = eaAlfa;
     enCanti = #isom9000#32;  |HAZ Calcula17D;  #isow9019#22 = eaAlfa;
     enCanti = #isom9000#51;  |HAZ Calcula17D;  #isow9019#23 = eaAlfa;

     enCanti = #isom9000#34;  |HAZ Calcula17D;  #isow9019#25 = eaAlfa;

     enCodCli = #isom9000#0;
     |HAZ LeePersona;

     nTotal  = #isom9000#14 + #isom9000#34;
     #isow9019#26 = "";
     #isow9019#27 = "";
     enCanti      = 0;  |HAZ Calcula17D;  #isow9019#28 = eaAlfa;
                                          #isow9019#29 = eaAlfa;

     #isow9019#30 = "";
     |SI #isom9000#3 > 0;
         #isow9019#30 = "X";
         #isow9019#31 = #isom9000#35;
     |FINSI;

     #isow9018#6  = "N";
     |SI nTotal > 0;
         |HAZ FormaPago2016;
     |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9018#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9019#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;

|PROCESO P90012016_3P;
     |ABRE #agim0019;
     #agim0019#0 = #isom9000#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #isom9000#0;
         aCNAE = #agim0019#40;
     |FINSI;

     |ABRE #maempr01;
     #maempr01#0 = #isom9000#0;
     #maempr01#1 = #isom9000#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr01;  |FINSI;
     |CIERRA #maempr01;

     |DDEFECTO #isow9018;
     |DDEFECTO #isow9019;

     #isow9018#7  = #isom9000#4;
     #isow9018#8  = #isom9000#5;
     #isow9018#10 = #isom9000#1;
     #isow9018#11 = #isom9000#2;
     #isow9018#12 = (#isom9000#7 % 102) + (#isom9000#7 % 402) + (#isom9000#7 % 704);
     #isow9018#13 = aCNAE;

     |SI #isom9000#60 = "S";  #isow9018#14 = "X";  |FINSI;
     |SI #isom9000#61 = "S";  #isow9018#15 = "X";  |FINSI;
     |SI #isom9000#62 = "S";  #isow9018#16 = "X";  |FINSI;
     |SI #isom9000#53 = "S";  #isow9018#17 = "X";  |FINSI;
     |SI #isom9000#39 = "S";  #isow9018#18 = "X";  |FINSI;
     |SI #isom9000#40 = "S";  #isow9018#19 = "X";  |FINSI;

                              #isow9018#20 = "0";
     |SI #isom9000#41 = "S";  #isow9018#20 = "1";  |FINSI;
     |SI #isom9000#42 = "S";  #isow9018#20 = "2";  |FINSI;

     #isow9018#21 = #isom9000#43;
     #isow9018#22 = #isom9000#38;

     |SI #isom9000#75 = "S";  #isow9018#23 = "X";  |FINSI;

     enCanti = #isom9000#10;  |HAZ Calcula17D;  #isow9018#24 = eaAlfa;
     enCanti = #isom9000#13;  |HAZ Calcula17D;  #isow9018#25 = eaAlfa;
     enCanti = #isom9000#14;  |HAZ Calcula17D;  #isow9018#26 = eaAlfa;

     enCanti = #isom9000#15;  |HAZ Calcula17D;  #isow9018#27 = eaAlfa;
     enCanti = #isom9000#45;  |HAZ Calcula17D;  #isow9018#28 = eaAlfa;
     enCanti = #isom9000#46;  |HAZ Calcula17D;  #isow9018#29 = eaAlfa;
     enCanti = #isom9000#54;  |HAZ Calcula17D;  #isow9018#30 = eaAlfa;
     enCanti = #isom9000#55;  |HAZ Calcula17D;  #isow9018#31 = eaAlfa;
     enCanti = #isom9000#47;  |HAZ Calcula17D;  #isow9018#32 = eaAlfa;
     enCanti = #isom9000#48;  |HAZ Calcula17D;  #isow9018#33 = eaAlfa;
     enCanti = #isom9000#56;  |HAZ Calcula17D;  #isow9018#34 = eaAlfa;
     enCanti = #isom9000#57;  |HAZ Calcula17D;  #isow9018#35 = eaAlfa;

     enCanti = #isom9000#50;  |HAZ Calcula17D;  #isow9018#38 = eaAlfa;
     enCanti = #isom9000#64;  |HAZ Calcula17D;  #isow9018#39 = eaAlfa;
     enCanti = #isom9000#17;  |HAZ Calcula17D;  #isow9018#40 = eaAlfa;
     enCanti = #isom9000#65;  |HAZ Calcula17D;  #isow9018#41 = eaAlfa;
     enCanti = #isom9000#66;  |HAZ Calcula17D;  #isow9018#42 = eaAlfa;
     enCanti = #isom9000#18;  |HAZ Calcula17D;  #isow9018#43 = eaAlfa;
     enCanti = #isom9000#19 * 100;              #isow9018#44 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#67;  |HAZ Calcula17D;  #isow9018#45 = eaAlfa;
     enCanti = #isom9000#58;  |HAZ Calcula17D;  #isow9018#46 = eaAlfa;
     enCanti = #isom9000#68;  |HAZ Calcula17D;  #isow9018#47 = eaAlfa;
     enCanti = #isom9000#69;  |HAZ Calcula17D;  #isow9018#48 = eaAlfa;
     enCanti = #isom9000#20;  |HAZ Calcula17D;  #isow9018#49 = eaAlfa;

     enCanti = #isom9000#21;  |HAZ Calcula17D;  #isow9019#6  = eaAlfa;
     enCanti = #isom9000#22;  |HAZ Calcula17D;  #isow9019#7  = eaAlfa;
     enCanti = #isom9000#23 * 100;              #isow9019#8  = ("00000" + enCanti) % -105;
     enCanti = #isom9000#24;  |HAZ Calcula17D;  #isow9019#9  = eaAlfa;
     enCanti = #isom9000#25;  |HAZ Calcula17D;  #isow9019#10 = eaAlfa;
     enCanti = #isom9000#26 * 100;              #isow9019#11 = ("00000" + enCanti) % -105;
     enCanti = #isom9000#27;  |HAZ Calcula17D;  #isow9019#12 = eaAlfa;
     enCanti = #isom9000#70;  |HAZ Calcula17D;  #isow9019#13 = eaAlfa;
     enCanti = #isom9000#59;  |HAZ Calcula17D;  #isow9019#14 = eaAlfa;
     enCanti = #isom9000#71;  |HAZ Calcula17D;  #isow9019#15 = eaAlfa;
     enCanti = #isom9000#72;  |HAZ Calcula17D;  #isow9019#16 = eaAlfa;
     enCanti = #isom9000#28;  |HAZ Calcula17D;  #isow9019#17 = eaAlfa;
     enCanti = #isom9000#29;  |HAZ Calcula17D;  #isow9019#18 = eaAlfa;
     enCanti = #isom9000#30;  |HAZ Calcula17D;  #isow9019#19 = eaAlfa;
                                                #isow9019#20 = "00000";
     |SI #isom9000#6 ! "A ";
         enCanti = #isom9000#31 * 100;          #isow9019#20 = ("00000" + enCanti) % -105;
     |FINSI;

     enCanti = #isom9000#33;  |HAZ Calcula17D;  #isow9019#21 = eaAlfa;
     enCanti = #isom9000#32;  |HAZ Calcula17D;  #isow9019#22 = eaAlfa;
     enCanti = #isom9000#51;  |HAZ Calcula17D;  #isow9019#23 = eaAlfa;
     enCanti = #isom9000#52;  |HAZ Calcula17D;  #isow9019#24 = eaAlfa;
     enCanti = #isom9000#34;  |HAZ Calcula17D;  #isow9019#25 = eaAlfa;

     enCodCli = #isom9000#0;
     |HAZ LeePersona;

     nTotal  = #isom9000#14 + #isom9000#34;
     #isow9019#26 = "";
     #isow9019#27 = "";
     enCanti = #isom9000#73;  |HAZ Calcula17D;  #isow9019#28 = eaAlfa;
     enCanti = #isom9000#74;  |HAZ Calcula17D;  #isow9019#29 = eaAlfa;

     #isow9019#30 = "";
     |SI #isom9000#3 > 0;
         #isow9019#30 = "X";
         #isow9019#31 = #isom9000#35;
     |FINSI;

     #isow9018#6  = "N";
     |SI nTotal > 0;
         |HAZ FormaPago2016;
     |FINSI;

     |PARA nCampo = 1;  |SI nCampo [ 51;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9018#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 35;  |HACIENDO nCampo = nCampo + 1;
           eaAlfa = #isow9019#nCampo#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;
