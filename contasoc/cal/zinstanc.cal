|FICHEROS;
     zmenumem #99;
     meempmem #101;
     meempme1 #102;
     maempr01 #6;

     :/basica/def/agim0019 #19;

     megwordc #500;
     megwordl #501;
|FIN;

|VARIABLES;
     aDestino      = "";
     aOrigen       = "";
     aBase         = "";
     aValfa        = "";
     aAlfa         = "";
     aCapitulo     = "";
     aPrograma     = "";
     aParametro    = "";
     aEmpresa      = "";
     aTipo         = "";
     aOpcion       = "";
     aExiste       = "";
     aIPRemoto     = "";
     aConta        = "";
     aHora         = "";
     aAlfa1        = "";
     aAlfa2        = "";
     aAlfa3        = "";
     aAlfa4        = "";
     aLen          = "";
     aImporte1     = "";
     aImporte2     = "";
     aImporte3     = "";
     aImporte4     = "";
     aCuenta       = "";
     aDescri       = "";
     aDesde        = "";
     aHasta        = "";
     aAster        = "";
     aAbre         = "";
     aNumero       = "";
     aVariable     = "";
     aLetra        = "";

     nWord         = 0;
     nEmpresa      = 0;
     nConta        = 0;
     nConta1       = 0;
     nConta2       = 0;
     nCampo        = 0;
     nLen          = 0;
     nHandle       = 0;
     nSwCuenta     = 0;
     nSwFinal      = 0;
     nSwImpre      = 0;
     nSwMovi       = 0;
     nMas          = 0;
     nMenos        = 0;
     nIni          = 0;
     nTotal        = 0;
     nCapitulo     = 0;
     nSwPrimero    = 0;
     nNume         = 0;
     nSwAsignar    = 0;
     nPos          = 0;

     &eaAlfa       = "";
     &eaImporte    = "";
     &eaOrigen     = "";
     &eaDestino    = "";
     &efFecha      = @;
     &eaUnidadBasico = "";
|FIN;

|PROCESO PonFechaLetraI;
     aAlfa2     = efFecha % 102; |LETRA aAlfa2;
     aAlfa3     = efFecha % 102;
     aLetra     = aAlfa2 % -101;
     |SI aLetra = "A"; |Y aAlfa3 ! "30";
         aLen   = aAlfa2 % 0;
         nLen   = aLen;
         nPos   = 100 + (nLen - 1);
         aAlfa2 = (aAlfa2 % nPos) + "O";
     |FINSI;

     aAlfa3  = efFecha % 402;
     |SI aAlfa3 = "01";  aAlfa3 = "Enero";      |FINSI;
     |SI aAlfa3 = "02";  aAlfa3 = "Febrero";    |FINSI;
     |SI aAlfa3 = "03";  aAlfa3 = "Marzo";      |FINSI;
     |SI aAlfa3 = "04";  aAlfa3 = "Abril";      |FINSI;
     |SI aAlfa3 = "05";  aAlfa3 = "Mayo";       |FINSI;
     |SI aAlfa3 = "06";  aAlfa3 = "Junio";      |FINSI;
     |SI aAlfa3 = "07";  aAlfa3 = "Julio";      |FINSI;
     |SI aAlfa3 = "08";  aAlfa3 = "Agosto";     |FINSI;
     |SI aAlfa3 = "09";  aAlfa3 = "Septiembre"; |FINSI;
     |SI aAlfa3 = "10";  aAlfa3 = "Octubre";    |FINSI;
     |SI aAlfa3 = "11";  aAlfa3 = "Noviembre";  |FINSI;
     |SI aAlfa3 = "12";  aAlfa3 = "Diciembre";  |FINSI;

     aAlfa4  = efFecha % 704;                    |LETRA aAlfa4;

     aAlfa2 = aAlfa2 < aAlfa2;
     aAlfa4 = aAlfa4 < aAlfa4;

     aLetra = aAlfa4 % -101;
     |SI aLetra = "a";
         aLen   = aAlfa4 % 0;
         nLen   = aLen;
         nPos   = 100 + (nLen - 1);
         aAlfa4 = (aAlfa4 % nPos) + "o";
     |FINSI;
|FPRC;

|PROCESO AsignaInstancia;
     aAlfa  = #102#3;                            |QBF aAlfa;
     aAlfa  = aAlfa -  "Sr./a. ";
     aAlfa  = aAlfa -  "Sres./as. ";
     aAlfa  = aAlfa -  "Don/Do¤a ";

     |SI aAlfa = "";
         aAlfa = "........................................";
     |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#2",  aAlfa;

     aAlfa  = #102#6;                           |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = "..............................";
     |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#3",  aAlfa;

     aAlfa  = #102#4;                           |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = ".............................., ....";
     |SINO;
         aAlfa  = aAlfa + ", " + #102#5;        |QBF aAlfa;
     |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#4",  aAlfa;

     aAlfa  = #102#2;                           |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = "............";
     |FINSI;
     |WORD_ASIGNA_CAMPO nWord, "#5",  aAlfa;

     aAlfa  = #101#1;                           |QBF aAlfa;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#6",  aAlfa;

     aAlfa  = #6#3;                           |QBF aAlfa;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#7",  aAlfa;

     aAlfa  = #19#29;                           |QBF aAlfa;
     |SI aAlfa = "";  aAlfa = "............";  |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#8",  aAlfa;

     aAlfa  = #19#30;                           |QBF aAlfa;
     |SI aAlfa = "";  aAlfa = "............";  |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#9",  aAlfa;

     aAlfa  = #19#31;                           |QBF aAlfa;
     |SI aAlfa = "";  aAlfa = "............";  |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#10",  aAlfa;

     aAlfa  = #19#32;                           |QBF aAlfa;
     |SI aAlfa = "";  aAlfa = "............";  |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#11",  aAlfa;

     aAlfa  = #19#33;                           |QBF aAlfa;
     |SI aAlfa = "";  aAlfa = "............";  |FINSI;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#12",  aAlfa;

     aAlfa  = #6#32;                           |QBF aAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#13",  aAlfa;

     aAlfa1  = #6#13;                            |QBF aAlfa1;
     aAlfa1  = aAlfa1 + ", ";

     |HAZ PonFechaLetraI;

     aAlfa  = aAlfa1 + " a " + aAlfa2 + " de " + aAlfa3 + " de " + aAlfa4;
     eaAlfa = aAlfa;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "#14", aAlfa;

     eaAlfa = #19#27;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "&REGISTRO",  aAlfa;

     eaAlfa = #19#26;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "&REGISTRADOR",  aAlfa;

     eaAlfa = #19#52;    |HAZ QuitaRaros;  aAlfa = eaAlfa;
     |WORD_ASIGNA_CAMPO nWord, "&NIF",  aAlfa;
|FPRC;

|PROCESO AbreInstancia;
     aOrigen = aBase + "word/actas/a500000.doc";
     aDestino  = eaUnidadBasico + "/MODELOS/MEMORIAS/winstan.doc";
     eaOrigen  = aOrigen;
     eaDestino = aDestino;
     |HAZ EnviaFichero;

     |ATRI S;  |PINTA 1320, "   ABRIENDO EL DOCUMENTO, WINSTAN.DOC   "; |ATRI s;

     eaAlfa = "Abro el documento " + aDestino;
     |HAZ GeneraLog;

     nWord = 1;
     |WORD_ABRE nWord, aDestino;
     |WORD_PROPIEDADES nWord, "Visible", "NO";

     |ATRI S;  |PINTA 1320, "   ASIGNANDO CAMPOS AL DOCUMENTO       "; |ATRI s;

     eaAlfa = "Asigno variables en el documento";
     |HAZ GeneraLog;

     |HAZ AsignaInstancia;
|FPRC;

|PROCESO CreaInstancia;
     aAlfa = eaUnidadBasico + "/MODELOS";                   |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "/MODELOS/MEMORIAS";          |RMKDIR aAlfa;

     aParametro = PARAMETRO;
     aCapitulo  = aParametro % 106;     || Nombre Texto
     aEmpresa   = aParametro % 705;     || Codigo de Empresa
     aTipo      = aParametro % 1201;    || Memoria o Informe de Gestion
     aOpcion    = aParametro % 1301;    || Que se hace
     aExiste    = aParametro % 1401;    || Existe el Documento (1 si) (0 no)
     nEmpresa   = aEmpresa;

     |ABRE #101;
     #101#0 = nEmpresa;
     |LEE 040#101=;
     |SI FSalida ! 0;
         |MENAV "    No esta Definida la Empresa de Memoria";
         |CIERRA #101;
         |ACABA;
     |FINSI;
     |CIERRA #101;

     |ABRE #6;
     #6#0 = #101#0;
     #6#1 = #101#5;
     |LEE 040#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     |ABRE #102;
     #102#0 = #101#0;
     #102#1 = 1;
     |LEE 040#102];
     |SI FSalida ! 0;  |O #102#0 ! #101#0;
         |DDEFECTO #102;
     |FINSI;
     |CIERRA #102;

     |ABRE #19;
     #19#0 = #101#0;
     #19#1 = 99;
     |LEE 040#19];
     |SI FSalida = 0;
         |LEE 040#19a;
     |SINO;
         |LEE 040#19u;
     |FINSI;
     |SI FSalida ! 0;  |O #19#0 ! #101#0;
         |DDEFECTO #19;
     |FINSI;
     |CIERRA #19;


     |PINPA #0#99;
     aAlfa = "Empresa : " + #101#1;  |QBF aAlfa;
     aAlfa = aAlfa + " Ejercicio : " + #101#5;

     |ATRI S;  |PINTA 0812, aAlfa;                       |ATRI s;
     |ATRI P;  |PINTA 1926, "GENERANDOSE LA INSTANCIA";  |ATRI p;

     |DBASE aBase;  |QBF aBase;

     |HAZ AbreInstancia;

     |WORD_PROPIEDADES nWord, "limpiafinal", "";
     |WORD_SALVA nWord, "";

     eaAlfa = "Salvo el documento " + aDestino;
     |HAZ GeneraLog;

     aOrigen   = eaUnidadBasico + "/MODELOS/MEMORIAS/winstan.doc";
     aDestino  = aBase + "emisiones/" + aEmpresa + "/" + #101#5;  |MKDIR aDestino;
     aDestino  = aDestino + "/" + "winstan.doc"

     eaOrigen  = aOrigen;
     eaDestino = aDestino;
     |HAZ RecibeFichero;

     |RFBORRA aOrigen;

     eaAlfa = "Borro el documento " + eaOrigen;
     |HAZ GeneraLog;

     |ABRE #500;
     #500#0 = nEmpresa;
     #500#1 = #101#5;
     |LEE 101#500=;
     |SI FSalida ! 0;
         #500#0 = nEmpresa;
         #500#1 = #101#5;
         #500#2 = #101#1;
         |GRABA 020#500n;
     |FINSI;
     |LIBERA #500;
     |CIERRA #500;

     |ABRE #501;
     #501#0 = nEmpresa;
     #501#1 = #101#5;
     #501#2 = "winstan.doc";
     |LEE 101#501=;
     |SI FSalida ! 0;
         #501#0 = nEmpresa;
         #501#1 = #101#5;
         #501#2 = "winstan.doc";
         |GRABA 020#501b;
     |FINSI;
     #501#3 = "INSTANCIA AL REGISTRADOR";
     #501#4 = ~;
     |HORA aHora;
     #501#5 = aHora % 102;
     #501#6 = aHora % 402;
     |GRABA 020#501a;
     |LIBERA #501;
     |CIERRA #501;
|FPRC;
