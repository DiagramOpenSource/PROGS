|FICHEROS;
     isoz0001 #0;

     isom0001 #101;
     isom0002 #102;
     isom0003 #103;
     isom0004 #104;
     isom0005 #105;
     zregdocu #600;

     maempr10 #200;

     sodacoli #1;
     soda8w04 #4;
|FIN;

|VARIABLES;
     &enAnyo    = 0;
     &enCampo0  = 0;
     nHay       = 0;

     aFichero   = "";
     &aCuenta   = "";
     &aTitulo   = "";
     &aAPR      = "";
     aSigno     = "";
     nImporte   = 0;
     nImporte1  = 0;
     nImporte2  = 0;

     aDCta      = "";
     aHCta      = "";
     aAlfa1     = "";
|FIN;

|INCLUYE varcon_i;
|INCLUYE varbal_i;

|| ***************************************************************************
|| *********************  GRABACION y CALCULOS *******************************
|| ***************************************************************************

|PROCESO LasLineas103;
  |DDEFECTO #103;
  #103#0  = enEmpresa;
  #103#1  = enAnyo;
  #103#3  = #4#2;
  |LEE 101#103=;
  |SI FSalida = 0;
      #103#5 = #103#5 + nImporte;
      |GRABA 020#103a;
  |FINSI;
  |LIBERA #103;
|FPRC;

|PROCESO LaCondicion103;
    nImporte = (nImporte) ! 2;
    |SI nImporte ! 0;
        nImporte = - nImporte; || (H-D)  IMPORTANTE
        |SI aAPR = "D"; |Y #4#5 = "-"; nImporte = - nImporte; |FINSI;
        |SI aAPR = "G"; |Y #4#5 = "-"; nImporte = - nImporte; |FINSI;
        |SI aAPR = "H"; |Y #4#5 = "+"; nImporte = - nImporte; |FINSI;
        |SI aAPR = "I"; |Y #4#5 = "+"; nImporte = - nImporte; |FINSI;
        |SI #4#6 ! " ";
            |SI #4#6 = "P"; |Y nImporte < 0; nImporte = 0; |FINSI;
            |SI #4#6 = "N"; |Y nImporte > 0; nImporte = 0; |FINSI;
        |FINSI;
        |SI nImporte ! 0;
            |HAZ LasLineas103;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO calculit103;
  #0#6 = enAnyo; #0#7 = #1#3;
  || |SI PARAMETRO = ""; |PINTA #0#6; |PINTA #0#7; |FINSI;

  aCuenta = #1#3;
  |HAZ MSigno08_s;

  nImporte = #1#8;
  |HAZ LaCondicion103;
|FPRC;

|DEFBUCLE cabasitu103;
  #1#2;
  ;
  enEmpresa, enAnyo, aDCta;
  enEmpresa, enAnyo, aHCta;
  e;
  NULL,calculit103;
|FIN;

|PROCESO Carga_isom0003;

 aAlfa1 = #4#4; |QBF aAlfa1;
 aDCta = (aAlfa1 + "            ") % 112;
 aHCta = (aAlfa1 + "zzzzzzzzzzzz") % 112;

 |BUCLE cabasitu103;
|FPRC;

|DEFBUCLE Carga_isom0003;
   #4#1;
   ;
   nCtaNum, nBalance, "     ", 001;
   nCtaNum, nBalance, "99999", 999;
   e;
   NULL, Carga_isom0003;
|FIN;

|PROCESO Correcciones;
 nImporte = 0;
 #103#0 = enEmpresa;
 #103#1 = enAnyo;
 #103#3 = "326";       || Impuestos sobre beneficios
 |LEE 001#103=;
 |SI FSalida = 0;
     nImporte = #103#5;
 |FINSI;

 nImporte1 = 0; nImporte2 = 0;
 |SI nImporte < 0; nImporte1 = - nImporte; |FINSI;
 |SI nImporte > 0; nImporte2 =  nImporte;  |FINSI;

 |ABRE #101;
 |SELECT #2#101;
 #101#0 = enEmpresa;
 #101#1 = enAnyo;
 #101#3 = "301";
 |LEE 001#101=;
 |SI FSalida = 0;
     #101#5 = nImporte1;
     |GRABA 020#101a;
 |FINSI;

 #101#0 = enEmpresa;
 #101#1 = enAnyo;
 #101#3 = "302";
 |LEE 001#101=;
 |SI FSalida = 0;
     #101#5 = nImporte2;
     |GRABA 020#101a;
 |FINSI;

 |SELECT #1#101;
 |CIERRA #101;
|FPRC;

|PROCESO Reparto;
 nImporte = 0;
 #103#0 = enEmpresa;
 #103#1 = enAnyo;
 #103#3 = "500";       || Impuestos sobre beneficios
 |LEE 001#103=;
 |SI FSalida = 0;
     nImporte = #103#5;
 |FINSI;

 nImporte1 = 0;
 |SI nImporte > 0; nImporte1 =  nImporte; |FINSI;

 |ABRE #600;
 #600#0 = enEmpresa;
 #600#1 = enAnyo;
 |LEE 101#600=;
 |SI FSalida = 0;
     |SI #600#16 = 0;
         #600#16 = nImporte1;
         |GRABA 020#600a;
     |FINSI;
 |SINO;
     |SI nImporte1 > 0;
         |DDEFECTO #600;
         #600#0 = enEmpresa;
         #600#1 = enAnyo;
         #600#2 = #200#2;
         #600#16 = nImporte1;
         || ... |GRABA 020#600b;  No grabo CCAA tique 1243_2503
     |FINSI;
 |FINSI;
 |LIBERA #600;
 |CIERRA #600;
|FPRC;

|PROCESO Pase_isom0003;

  |SI PARAMETRO = "";
      || |ATRI I; |PINTA 2156, "Cuenta de Resultados   "; |ATRI 0;
  |FINSI;

  aFichero = "2y" + Usuario;
  |NOME_DAT #4 aFichero; |DELINDEX #4;
  enCampo0 = nCtaNum;
  |HAZ MontaEstPase;

  |ABRET #103;

  |SELECT #2#103;
  |BUCLE Carga_isom0003;

  |HAZ Correcciones;
  |SELECT #1#103;

  |ABRET #104;
  |HAZ TotalFich103;
  |CIERRAT #104;

  |HAZ Reparto;
  |CIERRAT #103;
|FPRC;
