|FICHEROS;
   cubal803 #0;
   imagen@  #900;
   :/contagen/def/ca8m0001 #421;  || Def Balance Textos
   cubal802 #10;
|FIN;

|VARIABLES;
   &empresa = 0;
   &anyo    = 0;
   &nombre  = "";
   &nif     = "";
   &tipo    = "";
   &unid    = "";
   &modo    = 0;
   &sw_mod  = 0;
   anyo1    = 0;
   anyo2    = 0;
   x        = 0;
   FEstado  = 0;
   nSeguir  = 0;
   nLinea  = 0;
   activo  = 0;
   activ1  = 0;
   pasivo  = 0;
   pasiv1  = 0;
   saldo   = 0;
   aMas    = "";
   aDef    = "";

   nImporte  = 0;
   nImporte0 = 0;
   nImporte1 = 0;
   nImporte2 = 0;
   nImporte3 = 0;
   nImporte4 = 0;
   nImporte5 = 0;
   nImporte11= 0;
   nImporte12= 0;
   nImporte13= 0;
   nImporte14= 0;
   nImporte15= 0;
   nCampo2 = 0;
   aCampo3 = "";
   nCampo4 = 0;
   nCampo5 = 0;
   nCampo6 = 0;
   nCampo7 = 0;
   nCampo8 = 0;

   nDCampo5 = 0;
   nDCampo6 = 0;
   nDCampo7 = 0;
   nDCampo8 = 0;
   nHCampo5 = 0;
   nHCampo6 = 0;
   nHCampo7 = 0;
   nHCampo8 = 0;
   nSwMod   = 0;
   aAlfa1   = "";
   nInkey   = 0;
   nOpera   = 0;
|FIN;

|INCLUYE varbal_i;

|PROCESO Inferior0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 0001;
|FPRC;

|PROCESO Superior0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 9999;
|FPRC;

|PROCESO LeoNota;
 |ABRE #421;
 |DDEFECTO #421;
 #421#14 = enEjerBal;
 #421#0  = nBalNum;
 #421#1  = nBalance;
 #421#2  = #0#9;
 #421#3  = #0#10;
 #421#4  = #0#11;
 #421#5  = #0#12;
 #421#6  = #0#13;
 #421#7  = #0#14;
 #421#10 = #0#15;
 |LEE 040#421=;
 |CIERRA #421;
 #0#16 = #421#11;
 #0#17 = #421#12;
 #0#5  = #421#13; |PINTA #0#5;
|FPRC;

|PROCESO Nota3; TIPO 0;
 |SI FSalida = 10;
     |HAZ LeoNota;
 |FINSI;
 aAlfa1 = #0#5 % 105;
 #0#5 = aAlfa1;
|FPRC;

|PROCESO Tipo7_3;  |TIPO 7;
    aAlfa1 = "     Pulse <F2> para Introducir Notas, <F3> Recoger Notas Memoria";
    |SI enModBal = 1; |Y #0#8 = "C";
        aAlfa1 = "     Pulse <F2> Introducir Importe y Notas, <F3> Recoger Notas ";
    |FINSI;
    |SI modo = 4; aAlfa1 = "     "; |FINSI;
    |MENSA aAlfa1;
|FPRC;

|PROCESO Tipo11_3;  |TIPO 11;
    nInkey = FSalida;
    |SI nInkey ! 10;  |Y nInkey ! 11; |ACABA; |FINSI;
    |SI modo     = 4;   |ACABA; |FINSI;

    |LEE 101#0=;

    |SI nInkey = 10;
        |ENCAMPO #5#0;

        |SI enModBal = 1; |Y #0#8 = "C";
            |ENCAMPO #7#0;
            |SI sw_mod = 0; |ENCAMPO #6#0; |FINSI;
        |FINSI;
    |FINSI;
    |SI nInkey = 11;
        |HAZ LeoNota;
    |FINSI;

    |GRABA 020#0a;
    |LIBERA #0;

    |SALVA_DATOS #0;

/*
    |SI nInkey = 17;
        |CONFI "0000NEstas Seguro de Borrar Datos";
        |SI FSalida = 0;
            nOpera = 1;
            |HAZ Totales_3;
            nOpera = 0;
        |FINSI;
    |FINSI;
*/

    |SI enModBal = 1; |Y #0#8 = "C"; |Y nInkey = 10;
        |HAZ Totales_3;
    |FINSI;

    |REPON_DATOS #0;

    |PONCONTROL 23, "SI";
|FPRC;

|PROGRAMA;

 |SI enTBal = 3;
     |MENAV "    Informe para Balance NORMAL o ABREVIADO";
     |ACABA;
 |FINSI;

 |DBASS aMas;
 aDef = aMas + "contasoc/def/cubal803";
 |CARGA_DEF aDef, imagen@;
 |SI FSalida ! 0; |ACABA; |FINSI;

 nBalance = 2; ||Ingresos y Gastos Reconocidos
 |PINPA #0#0;
 |HAZ pintaany;

 nSeguir = 0;
 |HAZ pidedato;
 |SI nSeguir = 0;
     |MENAV "    No existe Codigo de Balance ";
     |DESCARGA_DEF #900;
     |ACABA;
 |FINSI;

 |HAZ ActualExplo;
 |ENTLINEAL #1#0, -3, 4, 21, 0, Inferior0, Superior0;
 |DESCARGA_DEF #900;
|FPRO;

|PROCESO pidedato;
 |ABRE #0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 0000;
 |LEE 001#0];
 |SI FSalida ! 0; |O #0#0 ! empresa; |O #0#1 ! anyo;
     |CIERRA #0;
     |HAZ eCrearVacio;
     |ABRE #0;
     #0#0 = empresa;
     #0#1 = anyo;
     #0#2 = 0000;
     |LEE 001#0];
     |SI FSalida = 0; |Y #0#0 = empresa; |Y #0#1 = anyo;
         nSeguir = 1;
     |FINSI;
     |CIERRA #0;
     |ACABA;
 |SINO;
     nSeguir = 1;
 |FINSI;
 |CIERRA #0;
|FPRC;

|PROCESO ActualExplo;
  |SI enModBal = 1; |Y modo ! 4;
      nImporte  = 0;
      nImporte0 = 0;
      |ABRE #10;
      #10#0 = empresa;
      #10#1 = anyo;
      #10#2 = 9999;
      |LEE 010#10];
      |SI FSalida = 0;
          |LEE 040#10a;
      |SINO;
          |LEE 040#10u;
      |FINSI;
      |SI FSalida = 0; |Y #10#0 = empresa; |Y #10#1 = anyo;
          nImporte  = #10#7;
          nImporte0 = #10#6;
      |FINSI;
      |CIERRA #10;
      nSwMod = 0;
      |ABRE #0;
      #0#0 = empresa;
      #0#1 = anyo;
      #0#2 = 1;
      |LEE 001#0=;
      |SI FSalida = 0; |Y #0#16 ! 0;
          |SI nImporte ! #0#7; nSwMod = 1; |FINSI;
          |SI sw_mod = 0; |Y #0#6 ! nImporte0; nSwMod = 1; |FINSI;
          #0#7 = nImporte;
          |SI sw_mod = 0; #0#6 = nImporte0; |FINSI;
          |GRABA 020#0a;
      |FINSI;
      |SI nSwMod = 1; |HAZ Totales_3; |FINSI;
      |CIERRA #0;
  |FINSI;
|FPRC;


|PROCESO pintaany;
 anyo2 = anyo - 1;
 anyo1 = anyo;
 |ATRI P; |PINTA 962, anyo1;
 |PINTA 975, anyo2; |ATRI 0;
|FPRC;

|PROCESO Tipo5_3;  |TIPO 5;
   ||    |LEE 040#0p;
   ||    #0#4 = "N";
   ||    |LINEAS_BI_ATRI #0#4, D, S, -1;
|FPRC;

|PROCESO LeeCas803;  ||Carga Trabajo de Cuentas
  #0#0  = empresa;
  #0#1  = anyo;
  #0#9  = nCampo2;
  #0#10 = aCampo3;
  #0#11 = nCampo4;
  #0#12 = nCampo5;
  #0#13 = nCampo6;
  #0#14 = nCampo7;
  #0#15 = nCampo8;
  |LEE 101#0=;
  |SI FSalida = 0; |Y #0#8 ! "A";
      #0#7 = #0#7 + nImporte;
      |SI sw_mod = 0; #0#6 = #0#6 + nImporte0; |FINSI;
      |GRABA 020#0a;
  |FINSI;
  |LIBERA #0;
|FPRC;

|PROCESO ASumar803;
  nImporte  = #900#7;
  nImporte0 = #900#6;

  nCampo2 = #900#9;
  aCampo3 = #900#10;
  nCampo4 = #900#11;
  nCampo5 = #900#12;
  nCampo6 = #900#13;
  nCampo7 = #900#14;
  nCampo8 = #900#15;

  |SI nCampo8 ! 0;    ||Subpartida (A/P = 0)
      nCampo8 = 0;
      |HAZ LeeCas803;
  |FINSI;

  |SI nCampo7 ! 0;   ||Partida
      nCampo8 = 0;
      nCampo7 = 0;
      |HAZ LeeCas803;
  |FINSI;

  |SI nCampo6 ! 0;   ||Epigrafe
      nCampo8 = 0;
      nCampo7 = 0;
      nCampo6 = 0;
      |HAZ LeeCas803;
  |FINSI;

|FPRC;

|PROCESO LeoTotales;
 |SI #900#8 = "C"; |O nCampo4 = 1;
     nImporte  = nImporte  + #900#7;
     nImporte0 = nImporte0 + #900#6;
 |FINSI;
|FPRC;

|DEFBUCLE LeoTotales;
 #900#2009;
 ;
 empresa, anyo, nCampo2, aCampo3, nCampo4, nDCampo5, nDCampo6, 00,0;
 empresa, anyo, nCampo2, aCampo3, nCampo4, nHCampo5, nHCampo6, 99,9;
 ;
 NULL, LeoTotales;
|FIN;

|PROCESO elTotal;
  |SI #421#8 =  "A"; |ACABA; |FINSI;

  nImporte  = 0;
  nImporte0 = 0;
  nCampo2 = #421#2;  ||Bloque
  aCampo3 = #421#3;  ||Tipo
  nCampo4 = #421#4;  ||Agrupacion
  nCampo5 = #421#5;  ||Subagrupacion

  |SI nCampo4 = 01;
      nDCampo5 = 1; nHCampo5 = 1;
      nDCampo6 = 0; nHCampo6 = 0;
      |BUCLE LeoTotales;
  |FINSI;
  |SI nCampo4 = 02; |O nCampo4 = 03;
      nDCampo5 = 0; nHCampo5 = 0;
      nDCampo6 = 1; nHCampo6 = 99;
      |BUCLE LeoTotales;
  |FINSI;

  |SI nCampo4 = 4;
      nImporte  = nImporte1 + nImporte2 + nImporte3;
      nImporte0 = nImporte11 + nImporte12 + nImporte13;
  |FINSI;

|SI nCampo4 ! 1;
    nCampo6 = 0;
    nCampo7 = 0;
    nCampo8 = 0;
    |HAZ LeeCas803;
|FINSI;

  |SI nCampo4 = 1; nImporte1 = nImporte; nImporte11 = nImporte0; |FINSI;
  |SI nCampo4 = 2; nImporte2 = nImporte; nImporte12 = nImporte0; |FINSI;
  |SI nCampo4 = 3; nImporte3 = nImporte; nImporte13 = nImporte0; |FINSI;
  |SI nCampo4 = 4; nImporte4 = nImporte; nImporte14 = nImporte0; |FINSI;
|FPRC;

|DEFBUCLE elTotal;
 #421#1;
 ;
 enEjerBal, nCtaNum, nBalance, 6, "E", 00, 1, 00, 00, 0;
 enEjerBal, nCtaNum, nBalance, 6, "E", 99, 9, 00, 00, 0;
 e;
 NULL, elTotal;
|FIN;

|PROCESO Final3;
     nImporte1 = 0; nImporte11 = 0;
     nImporte2 = 0; nImporte12 = 0;
     nImporte3 = 0; nImporte13 = 0;
     nImporte4 = 0; nImporte14 = 0;
     nImporte5 = 0; nImporte15 = 0;
     |BUCLE elTotal;
|FPRC;

|DEFBUCLE ASumar803;
 #900#1003;
 8;
 empresa, anyo, 0001, "C";
 empresa, anyo, 9999, "C";
 be;
 NULL, ASumar803;
|FIN;

|PROCESO ACero803;

  |SI nOpera = 1;
      |SI #900#2 = 1;
          #900#16 = 0;
      |FINSI;
      #900#6 = 0;
      #900#7 = 0;
      |GRABA 020#900a;
      |LIBERA #900;
      |ACABA;
  |FINSI;

  |SI #900#8 ! "C"; |Y #900#11 ! 1;
      #900#7 = 0;
      |SI sw_mod = 0; #900#6 = 0; |FINSI;
      |GRABA 020#900a;
  |FINSI;
  |LIBERA #900;
|FPRC;

|DEFBUCLE ACero803;
 #900#1003;
 ;
 empresa, anyo, 0001;
 empresa, anyo, 9999;
 be;
 NULL, ACero803;
|FIN;

|PROCESO Totales_3;

  |BUCLE ACero803;

  activo  = 0; pasivo  = 0;
  activ1  = 0; pasiv1  = 0;

  |SELECT #2#0;
  |BUCLE ASumar803;
  |HAZ Final3;
  |SELECT #1#0;
|FPRC;
