|FICHEROS;
     isom0001;
     isom0022;
     isom0023;
     isom0029;

     isom0510;

     maempr10;
     maempr11;
|FIN;

|VARIABLES;
      nRango         = 0;
      nBotonSal      = 0;
      nBotonAnota    = -1;
      nTree          = 0;
      nHandle        = 0;
      nPanta         = 0;
      nBotonLabel    = 0;
      nVentana       = 0;
      nVent          = 0;
      nGrid          = 0;
      nModo          = 0;
      nLinea         = 0;
      nBase          = 0;
      nBase1         = 0;
      nCasilla560    = 0;
      nSal           = 0;
      nBotonDat      = 0;
      nHija          = 0;

      aContenido     = "";
      aTexto         = "";
      aBase          = "";
      aAlfa          = "";
      aAbre          = "";
      aEsc1          = "";
      aEsc2          = "";
      aRetu          = "";
      aTecla         = "";
      aCasilla       = "";

     {-1}sTree       = 0;
     sT_nID          = 0;
     sT_nOper        = 0;
     sT_aData        = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &enEmpresa      = 0;
     &enAnyo         = 0;
     &eaCasilla      = "";
     &eaTitCasilla   = "";
     &eaRutaOrigen   = "";
     &eaRutaDestino  = "";
     &eaFicheroTra   = "";
     &eaFicheroTxt   = "";
     &eaFicheroTgz   = "";
     &eaFicheroTar   = "";
     &eaOrigen       = "";
     &eaDestino      = "";
     &eaAlfa         = "";
     &eaTipoColor    = "";
     &eaColor        = "";
     &enModoConsulta = 0;
|FIN;

|PROCESO Tipo1;  |TIPO 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;  |O nModo = 3;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     |HAZ Tipo1;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |ABRE #isom0510;
     #isom0510#0 = #isom0022#1;
     #isom0510#1 = #isom0022#2;
     |LEE 000#isom0510.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0510;  |FINSI;
     |CIERRA #isom0510;

     |SI #isom0510#4 ! "I";  |ACABA;  |FINSI;

     |GRABA 020#isom0022.a;
     |LIBERA #isom0022;

     nLinea = #isom0022#2;

     |SI enAnyo [ 2014;  |HAZ Total18Bis;  |FINSI;

     |SI enAnyo ] 2015;
         |SI #isom0022#3 = "305  ";  |Y #isom0022#5 = 0;
             |CONFI "0000NQuiere traerse los datos del balance.";
             |SI FSalida = 0;
                 |HAZ TraeDatos;
             |FINSI;
         |FINSI;

         |HAZ Total20;
     |FINSI;

     #isom0022#0 = #maempr10#0;
     #isom0022#1 = #maempr10#1;
     #isom0022#2 = nLinea;
     |LEE 101#isom0022.=;

     aAlfa = "|IDGRID";
     aAlfa = #isom0022#aAlfa#;
     nGrid = aAlfa;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |C_M #isom0022#5,  1, "N";

     |ABRE #isom0510;
     #isom0510#0 = #isom0022#1;
     #isom0510#1 = #isom0022#2;
     |LEE 000#isom0510.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0510;  |FINSI;
     |CIERRA #isom0510;

     |SI #isom0510#4 ! "I";  |ACABA;  |FINSI;

     |SI #isom0022#3 ! "     ";  |C_M #isom0022#5, 1, "S";  |FINSI;
|FPRC;

|PROCESO IntroDatos;
     aCasilla = #isom0022#3;  |QBF aCasilla;
     nLinea   = #isom0022#2;
     nSal     = 1;
     |PTEC 807;
|FPRC;

|PROCESO Evento122;
     |SI FSalida = 1;
         |SI nBotonDat ! -1;
             |FIN_CONTROL_WINDOWS nBotonDat;
             nBotonDat = -1;
             |PULSATECLA;
         |FINSI;

         |SI nSal = 0;
             nLinea = #isom0022#2;
         |FINSI;

         #isom0022#2 = nLinea;
         |LEE 000#isom0022.=;

         |SI nSal = 1;
             aAlfa = "|IDGRID";
             aAlfa = #isom0022#aAlfa#;
             nGrid = aAlfa;
             |REFRESCACONTROL nGrid;
         |FINSI;

         nSal = 0;

         |SI #isom0022#3 ! "049  ";  |Y #isom0022#3 ! "258  ";
          |Y #isom0022#3 ! "1249 ";  |Y #isom0022#3 ! "1255 ";
          |Y #isom0022#3 ! "1258 ";  |Y #isom0022#3 ! "1259 ";
             |ACABA;
         |FINSI;

         aAlfa = "BOTON,C     T     R     L         &A " + (" " * 15) + "{{197}}";
         aAlfa = aAlfa + (" " * 15) + "C     T     R     L         &A";

         |CONTROL_SIMPLE 0, aAlfa, 0696, 3199, IntroDatos;
         nBotonDat = FSalida;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO isom0510;
     #isom0022#0  = enEmpresa;
     #isom0022#1  = #isom0510#0;
     #isom0022#2  = #isom0510#1;
     |LEE 101#isom0022.=;
     |SI FSalida ! 0;
         |DDEFECTO #isom0022;
         #isom0022#0  = enEmpresa;
         #isom0022#1  = #isom0510#0;
         #isom0022#2  = #isom0510#1;
         |GRABA 020#isom0022.b;
     |FINSI;

     #isom0022#3  = #isom0510#2;
     #isom0022#4  = #isom0510#3;

     eaTipoColor = #isom0510#5;
     |HAZ CogeColor;
     #isom0022#6  = eaColor;

     |GRABA 020#isom0022.a;
     |LIBERA #isom0022;
|FPRC;

|DEFBUCLE isom0510;
     #isom0510#1;
     ;
     enAnyo, 0000;
     enAnyo, 9999;
     ;
     NULL, isom0510;
|FIN;

|PROCESO MontaEstructura510;
     |BUCLE isom0510;

     |SI enAnyo ] 2015;  |HAZ Total20;     |FINSI;
|FPRC;

|PROCESO isom0022;
     |SI #isom0022#5  ! 0;  |ACABA;  |FINSI;

     |BORRA 020#isom0022.a;
     |LIBERA #isom0022;
|FPRC;

|DEFBUCLE isom0022;
     #isom0022#1;
     ;
     enEmpresa, enAnyo, 0000;
     enEmpresa, enAnyo, 9999;
     be;
     NULL, isom0022;
|FIN;

|PROCESO BotonSalir;
     |PTEC 807;
|FPRC;

|PROCESO BotonAnota;
     eaCasilla    = #isom0022#3;     |QBF eaCasilla;
     eaTitCasilla = #isom0022#4;     |QBF eaTitCasilla;

     |SI eaCasilla = "";  |ACABA;  |FINSI;

     |SUB_EJECUTA "isom0499";
|FPRC;

|PROCESO Baja122;
     #isom0022#0  = enEmpresa;
     #isom0022#1  = enAnyo;
     #isom0022#2  = 1;
|FPRC;

|PROCESO Alta122;
     #isom0022#0  = enEmpresa;
     #isom0022#1  = enAnyo;
     #isom0022#2  = 9999;
|FPRC;

|PROCESO isom0023;
     aAlfa = "";
     |SI enModoConsulta = 1;
         aAlfa = "(MODO CONSULTA)   ";
     |FINSI;

     aAlfa =  aAlfa + "Limitaci¢n en la deducibilidad pendientes de deducir (" + (("00000" + #maempr10#0) % -105) + " / " + #maempr10#1 + " " + #maempr10#2;
     |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |VENTANA 0501, 3499, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |PULSATECLA;

     |SUB_EJECUTA_NP "isom0023";

     |PULSATECLA;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;

     |PULSATECLA;

     |SI enAnyo ] 2015;  |HAZ Total20;     |FINSI;
|FPRC;

|PROCESO isom0029;
     aAlfa = "";
     |SI enModoConsulta = 1;
         aAlfa = "(MODO CONSULTA)   ";
     |FINSI;

     aAlfa =  aAlfa + "Limitaci¢n en la deducibilidad pendientes de deducir (" + (("00000" + #maempr10#0) % -105) + " / " + #maempr10#1 + " " + #maempr10#2;
     |QBF aAlfa;
     aAlfa = aAlfa + ")";
     |VENTANA 0501, 3499, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |PULSATECLA;

     |SUB_EJECUTA_NP "isom0029";

     |PULSATECLA;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;

     |PULSATECLA;

     |SI enAnyo ] 2015;  |HAZ Total20;     |FINSI;
|FPRC;

|PROGRAMA;
     |SI nHija = 1;
         |MENAV "0000La empresa tiene un car cter de la declaraci¢n asignado no v lido para este apartado.";
         |ACABA;
     |FINSI;

     aAlfa = "";
     |SI enModoConsulta = 1;
         aAlfa = "(MODO CONSULTA)   ";
     |FINSI;

     aAlfa = aAlfa + "Limitaciones a la deducibilidad";
     |VENTANA 0501, 3599, -1, 16, aAlfa;
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |CIERRA #maempr10;

     |HAZ MontaEstructura510;

     #isom0022#0 = enEmpresa;
     #isom0022#1 = enAnyo;
     #isom0022#2 = 5;
     |LEE 000#isom0022.];

     |PINPA #0#isom0022;
     nPanta = FSalida;

     aAlfa = "LABEL,{{16}}Para calcular automaticamente las casillas ";
     |SI enAnyo [ 2014;
         aAlfa = aAlfa + "179 y 249, introduzca un cero en la 175";
     |SINO;
         aAlfa = aAlfa + "1247, 1250, 1251, 1252, 1253 y 1254, introduzca un cero en la 305";
     |FINSI;

     |CONTROL_SIMPLE 0, aAlfa, 3204, 3298, NULL;

     |PARA;  |SI;  |HACIENDO;
          |CONTROL_SIMPLE 0, "BOTON,{{197}}Sa&Lir", 3485, 3498, BotonSalir;
          nBotonSal = FSalida;

          |CONTROL_SIMPLE 0, "BOTON,{{197}} a&Notaciones de la casilla", 3302, 3425, BotonAnota;
          nBotonAnota = FSalida;

          #isom0022#0 = #maempr10#0;
          #isom0022#1 = #maempr10#1;
          #isom0022#2 = nLinea;
          |LEE 000#isom0022.=;

          |SI enModoConsulta = 0;
              nRango = 1 + 2 + 4 + 8 + 16 + 128 + 256;
          |SINO;
              nRango = 2 + 4 + 8 + 16 + 128 + 256;
          |FINSI;

          |LINEAL_SIMPLE #1#isom0022, nRango, 0602, 3495, Baja122, Alta122, Evento122;

          |FIN_CONTROL_WINDOWS nBotonSal;
          |FIN_CONTROL_WINDOWS nBotonAnota;

          |SI nSal = 0;  |SAL;  |FINSI;

          |SI nBotonDat ! -1;
              |FIN_CONTROL_WINDOWS nBotonDat;
          |FINSI;

          |SI enAnyo [ 2014;
              |SI aCasilla = "049";  |HAZ isom0023;  |FINSI;
              |SI aCasilla = "258";  |HAZ isom0023;  |FINSI;

              |SI enModoConsulta = 0;  |HAZ Total18Bis;  |FINSI;
          |FINSI;

          |SI enAnyo ] 2015;
              |SI aCasilla = "1249";  |HAZ isom0023;  |FINSI;
              |SI aCasilla = "1255";  |HAZ isom0023;  |FINSI;
              |SI aCasilla = "1258";  |HAZ isom0029;  |FINSI;
              |SI aCasilla = "1259";  |HAZ isom0029;  |FINSI;

              |SI enModoConsulta = 0;  |HAZ Total20;  |FINSI;
          |FINSI;
     |SIGUE;

     |BUCLE isom0022;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA nVentana;

     |PULSATECLA;
|FPRO;

|PROCESO Tipo80m22;  |TIPO 80;
     nHija = 0;

     |ABRE #maempr11;
     #maempr11#0 = enEmpresa;
     #maempr11#1 = enAnyo;
     #maempr11#2 = 9;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         nHija = 1;
     |FINSI;

     #maempr11#0 = enEmpresa;
     #maempr11#1 = enAnyo;
     #maempr11#2 = 10;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         nHija = 1;
     |FINSI;

     #maempr11#0 = enEmpresa;
     #maempr11#1 = enAnyo;
     #maempr11#2 = 24;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         nHija = 1;
     |FINSI;

     #maempr11#0 = enEmpresa;
     #maempr11#1 = enAnyo;
     #maempr11#2 = 25;
     |LEE 000#maempr11.=;
     |SI FSalida = 0;
         nHija = 1;
     |FINSI;

     |CIERRA #maempr11;

     |ABRET #isom0022;
     |ABRET #isom0023;
     |ABRET #isom0029;

     FSalida = 3499;
|FPRC;

|PROCESO Tipo90m22;  |TIPO 90;
     |CIERRAT #isom0022;
     |CIERRAT #isom0023;
     |CIERRAT #isom0029;
|FPRC;
