|FICHEROS;
     :basica/agim0019;

     maempr11;

     isom9000;
     isow9002,MANTE;              || Formas de pago
     isow9004,MANTE;

     :integral/dsam0009;
     :integral/dsam0116;
     :basica/agitab99;

     &clientes@;
|FIN;

|VARIABLES;
     aCasilla       = "";
     aAlfa          = "";
     aAlfa0         = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aBase          = "";
     aDirServidor   = "";
     aDirInternet   = "";
     aDirLanza      = "";
     aDirBase       = "";
     aPathPlugins   = "";
     aDelindex      = "";
     aFichero       = "";
     aFicheroP      = "";
     aFicheroE      = "";
     aAbre          = "";
     aOrigen        = "";
     aDestino       = "";
     aContenido     = "";
     aCNAE          = "";
     aDia           = "";
     aMes           = "";
     aEjerc         = "";
     aPais          = "";
     aCodPais       = "";
     aLong          = "";
     aTecla         = "";
     aRetu          = "";
     aEsc1          = "";
     aEsc2          = "";
     aTipo          = "";
     aDocRemoto     = "";
     aDocServidor   = "";
     aIPRemoto      = "";

     nFicha         = 0;
     nLong          = 0;
     nNume          = 0;
     nPos           = 0;
     nValor         = 0;
     nValor1        = 0;
     nValor2        = 0;
     nValor3        = 0;
     nValor4        = 0;
     nValor5        = 0;
     nExiste        = 0;
     nSuma          = 0;
     nVent          = 0;
     nVent202       = 0;
     nPanta         = 0;
     nCasilla       = 0;
     nFecha         = 0;
     nCampo         = 0;
     nSwPunto       = 0;
     nCaracter      = 0;
     nContaBucle    = 0;
     nContaBucleL   = 0;
     nComple        = 0;
     nPuntero       = 0;
     nDesde         = 0;
     nHasta         = 0;
     nHay           = 0;
     nTotal         = 0;
     nValor626      = 0;
     nValor627      = 0;
     nValor628      = 0;
     nValor629      = 0;
     nCanti1        = 0;
     nCanti2        = 0;
     nCanti3        = 0;
     nCanti4        = 0;
     nCantiT        = 0;
     nResto         = 0;
     nTecla         = 0;
     nBotonCont     = 0;
     nBotonSal      = 0;
     nRango         = 0;
     nGrid509       = 0;
     nBoton1        = 0;
     nBoton2        = 0;
     nBoton3        = 0;
     nHandle        = 0;
     nIdSalir       = 0;

     fFechaD        = @;
     fFechaH        = @;

     {2}nNivel        = 0;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     {10}aPopup       = "";

      {1}aContiene    = "";

     &enEmpresa       = 0;
     &enAnyo          = 0;
     &enNavieras      = 0;
     &enCooperativa   = 0;
     &enTranspa       = 0;
     &enZEC           = 0;
     &enPeqDimen      = 0;
     &enForales       = 0;
     &enError         = 0;
     &enAviso         = 0;
     &eaError         = "";
     &eaAlfa          = "";
     &enHandle        = 0;
     &enCanti         = 0;
     &eaPagina        = "";
     &enCodCli        = 0;
     &enSwDeDonde     = 0;
     &eaEfectivo      = "";
     &eaAdeudo        = "";
     &eaEntidad       = "";
     &eaOficina       = "";
     &eaDC             = "";
     &eaCuenta         = "";
     &eaIBAN           = "";
     &enModelo         = 0;
     &enBanco          = 0;
     &enFormaPag       = 0;
     &enForzar         = 0;
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &eaImpre          = "";
     &eaJusti          = "";
     &eaFinLinea       = "";
     &eaUnidadBasico   = "";
     &enGrid           = 0;
     &enEjercicio      = 0;
     &enErrorPortal    = 0;
     &enFicha          = 0;
     &eaTipo           = "";
     &eaPeriodo        = "";
     &enCompl          = 0;
|FIN;

|PROCESO Borrador;
     aAlfa = (("00000" + #isom9000#0) % -105) + "," + #isom9000#1 + "," + #isom9000#2;
     aAlfa = "isoy0005;" + aAlfa;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO Emision;

     |SI #isom9000#8 = "S";
         |CONFI "0000NEl registro ya est  impreso. Quiere volver a emitir";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     enEmpresa  = #isom9000#0;
     enAnyo     = #isom9000#1;
     eaPeriodo  = #isom9000#2;
     enCompl    = #isom9000#3;
     |SUB_EJECUTA "isoz9001;EMISION";

     |REFRESCACONTROL enGrid;
     |FOCOTECLADO enGrid;
|FPRC;

|PROCESO BancoGeneral;
     aAlfa =  "Formas de pago general: " + #isom9000#4;  |QBF aAlfa;
     aAlfa = aAlfa + " - " + #isom9000#5;

     |VENTANA 0501, 1899, -1, 17, aAlfa;
     nVent  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     enCodCli = #isom9000#0;
     |HAZ LeePersona;

     #isow9002#0  = #clientes@#88;
     #isow9002#1  = #clientes@#89;
     #isow9002#2  = #clientes@#90;
     #isow9002#3  = #clientes@#91;
     #isow9002#4  = #clientes@#92;
     #isow9002#5  = #clientes@#93;
     #isow9002#6  = #clientes@#104;
     #isow9002#8  = #clientes@#115;
     #isow9002#9  = #clientes@#116;

     |ABRE #dsam0116;
     #dsam0116#0 = #isow9002#0;
     |LEE 000#dsam0116.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0116;  |FINSI;
     |CIERRA #dsam0116;

     #isow9002#7 = #dsam0116#5;

     |PINPA #0#isow9002;
     |PINDA #0#isow9002;
     |ENDATOS #1#isow9002;
     |SI FSalida = 0;
         |ABRE #clientes@;
         #clientes@#0 =  #isom9000#0;
         |LEE 101#clientes@.=;
         |SI FSalida = 0;
             #clientes@#88  = #isow9002#0;
             #clientes@#89  = #isow9002#1;
             #clientes@#90  = #isow9002#2;
             #clientes@#91  = #isow9002#3;
             #clientes@#92  = #isow9002#4;
             #clientes@#93  = #isow9002#5;
             #clientes@#104 = #isow9002#6;
             #clientes@#115 = #isow9002#8;
             #clientes@#116 = #isow9002#9;
             |GRABA 020#clientes@.a;
             |LIBERA #clientes@;
         |FINSI;
         |CIERRA #clientes@;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO Baja509;
     #dsam0009#0 = #isom9000#0;
     #dsam0009#1 = 001;
|FPRC;

|PROCESO Alta509;
     #dsam0009#0 = #isom9000#0;
     #dsam0009#1 = 999;
|FPRC;

|PROCESO Evento509;
     |SI FSalida = 1;   |O FSalida = 2;
         |LEE 000#dsam0009.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |ESTADO_CONTROL nBoton2, "ENABLE";
         |ESTADO_CONTROL nBoton3, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         |HAZ ModificarBanco;
     |FINSI;
|FPRC;

|PROCESO AltaBanco;
     |ABRE #agitab99;
     #agitab99#0 = 202;
     |LEE 000#agitab99.=;
     |CONSULTA_CLAVE #1#agitab99;
     |SI FSalida ! 0;  |CIERRA #agitab99;  |ACABA;  |FINSI;
     |CIERRA #agitab99;

     #dsam0009#0 = #isom9000#0;
     #dsam0009#1 = #agitab99#0;
     |LEE 000#dsam0009.=;
     |SI FSalida = 0;
         |MENAV "0000Ya existe el banco con este modelo en la empresa.";
         |ACABA;
     |FINSI;

     |DDEFECTO #dsam0009;
     #dsam0009#0 = #isom9000#0;
     #dsam0009#1 = #agitab99#0;
     #dsam0009#2 = #agitab99#1;
     |GRABA 020#dsam0009.b;

     aAlfa =  "Formas de pago modelo: " + #dsam0009#1;  |QBF aAlfa;

     |VENTANA 0501, 1899, -1, 17, aAlfa;
     nVent  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #isow9002#0  = #dsam0009#3;
     #isow9002#1  = #dsam0009#4;
     #isow9002#2  = #dsam0009#5;
     #isow9002#3  = #dsam0009#6;
     #isow9002#4  = #dsam0009#7;
     #isow9002#5  = #dsam0009#8;
     #isow9002#6  = #dsam0009#9;
     #isow9002#7  = #dsam0009#10;
     #isow9002#8  = #dsam0009#18;
     #isow9002#9  = #dsam0009#12;

     |PINPA #0#isow9002;
     |PINDA #0#isow9002;
     |ENDATOS #1#isow9002;
     |SI FSalida = 0;
         #dsam0009#3  = #isow9002#0;
         #dsam0009#4  = #isow9002#1;
         #dsam0009#5  = #isow9002#2;
         #dsam0009#6  = #isow9002#3;
         #dsam0009#7  = #isow9002#4;
         #dsam0009#8  = #isow9002#5;
         #dsam0009#9  = #isow9002#6;
         #dsam0009#10 = #isow9002#7;
         #dsam0009#18 = #isow9002#8;
         #dsam0009#12 = #isow9002#9;
         |GRABA 020#dsam0009.a;
     |SINO;
         |BORRA 020#dsam0009.a;
     |FINSI;
     |LIBERA #dsam0009;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |REFRESCACONTROL nGrid509;
     |FOCOTECLADO nGrid509;
|FPRC;

|PROCESO ModificarBanco;
     |LEE 101#dsam0009.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa =  "Formas de pago modelo: " + #dsam0009#1;  |QBF aAlfa;

     |VENTANA 0501, 1899, -1, 17, aAlfa;
     nVent  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #isow9002#0  = #dsam0009#3;
     #isow9002#1  = #dsam0009#4;
     #isow9002#2  = #dsam0009#5;
     #isow9002#3  = #dsam0009#6;
     #isow9002#4  = #dsam0009#7;
     #isow9002#5  = #dsam0009#8;
     #isow9002#6  = #dsam0009#9;
     #isow9002#7  = #dsam0009#10;
     #isow9002#8  = #dsam0009#18;
     #isow9002#9  = #dsam0009#12;

     |PINPA #0#isow9002;
     |PINDA #0#isow9002;
     |ENDATOS #1#isow9002;
     |SI FSalida = 0;
         #dsam0009#3  = #isow9002#0;
         #dsam0009#4  = #isow9002#1;
         #dsam0009#5  = #isow9002#2;
         #dsam0009#6  = #isow9002#3;
         #dsam0009#7  = #isow9002#4;
         #dsam0009#8  = #isow9002#5;
         #dsam0009#9  = #isow9002#6;
         #dsam0009#10 = #isow9002#7;
         #dsam0009#18 = #isow9002#8;
         #dsam0009#12 = #isow9002#9;
         |GRABA 020#dsam0009.a;
     |FINSI;
     |LIBERA #dsam0009;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |REFRESCACONTROL nGrid509;
     |FOCOTECLADO nGrid509;
|FPRC;

|PROCESO BajaBanco;
     |LEE 101#dsam0009.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = "0000NSeguro que quiere borrar el banco del modelo " + #dsam0009#1;
     |CONFI aAlfa;
     |SI FSalida ! 0;  |LIBERA #dsam0009;  |ACABA;  |FINSI;

     |BORRA 020#dsam0009.a;
     |LIBERA #dsam0009;

     |REFRESCACONTROL nGrid509;
     |FOCOTECLADO nGrid509;
|FPRC;

|PROCESO BancoModelos;
     aAlfa =  "Formas de pago por modelos: " + #isom9000#4;  |QBF aAlfa;
     aAlfa = aAlfa + " - " + #isom9000#5;
     |VENTANA 0501, 2599, -1, 17, aAlfa;
     nVent  = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #dsam0009;
     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dsam0009, nRango, 0502, 2298, Baja509, Alta509, Evento509;
     nGrid509 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 2364, 2374, AltaBanco;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 2388, 2398, BajaBanco;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 2376, 2386, ModificarBanco;
     nBoton3 = FSalida;

     |ESTADO_CONTROL nBoton2, "DISABLE";
     |ESTADO_CONTROL nBoton3, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid509;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #dsam0009;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;
|FPRC;

|PROCESO FormasDePago;
     aPopup1  = -1;  || Si fuera -1 en la posicion
     aPopup2  = 2;
     aPopup3  = "1 Datos banco general";
     aPopup4  = "2 Datos bancos por modelos";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;
         |SI aAlfa = "1";  |HAZ BancoGeneral;  |FINSI;
         |SI aAlfa = "2";  |HAZ BancoModelos;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaFicha;
     |SI enFicha = 0;  |ACABA;  |FINSI;

     |ABRE #agim0019;
     #agim0019#0 = #isom9000#0;
     #agim0019#1 = enFicha;
     |LEE 101#agim0019.=;
     |SI FSalida = 0;
         #agim0019#90 = eaTipo;
         |GRABA 020#agim0019.a;
         |LIBERA #agim0019;
     |FINSI;
     |CIERRA #agim0019;
|FPRC;

|PROCESO QuitaBotonSalir;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO PonBotonSalir;
     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;
