|FICHEROS;
     maempr19;
     maempr20;
     maempr10;

     maempw03,MANTE;
     maempw04,MANTE;
|FIN;

|VARIABLES;
     n0Vent         = 0;
     n1Vent         = 0;
     nPan           = 0;
     nFSalida       = 0;
     nRango         = 0;
     nGrid19        = 0;
     nGrid20        = 0;
     nID            = 0;

     nBtnAlt19      = 0;
     nBtnMod19      = 0;
     nBtnBor19       = 0;
     nBtnAlt20       = 0;
     nBtnMod20       = 0;
     nBtnBor20       = 0;

     aAlfa          = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";
     aID            = "";

     {20}aPopup     = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &enEmpresa      = 0;
     &enAnyo         = 0;
     &enComple       = 0;
     &enModoConsulta = 0;
     &enCalcCif      = 0;
     &eaVarDni       = "";
|FIN;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO LetraNif;  |TIPO 6;
     |SI FSalida = 10;
         enCalcCif = 1;
         eaVarDni  =  #maempw04#Campo#;
         |HAZ CalculoDNI;
         #maempw04#Campo# = eaVarDni;
         |PINTA #maempw04#Campo#;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #maempw04#Campo#;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "            ") % 112;
     |SI #maempw04#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #maempw04#Campo# = eaVarDni;  |PINTA #maempw04#Campo#;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tv2014;
     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 12;
     aPopup3  = "a) Una entidad y sus socios o part¡cipes";
     aPopup4  = "b) Una entidad y sus consejeros o administradores";
     aPopup5  = "c) Una entidad y los cónyuges o personas unidas por relaciones de parentesco ...";
     aPopup6  = "d) Dos entidades que pertenezcan a un grupo";
     aPopup7  = "e) Una entidad y los socios o part¡cipes de otra entidad, cuando ambas pertenezcan a un grupo";
     aPopup8  = "f) Una entidad y los consejeros o adm. de otra entidad, cuando ambas pertenezcan a un grupo";
     aPopup9  = "g) Una entidad y los cónyuges o personas unidas por relaciones, cuando ambas pertenezcan a un grupo";
     aPopup10 = "h) Una entidad y otra participada por la 1a. indirectamente en, al memos, el 25% del cap.social o de los fondos propios";
     aPopup11 = "i) Dos entidades en las cuales los mismos socios, part., o  cónyuges ... participen en, al menos, el 25% ";
     aPopup12 = "j) Una entidad residente en territorio espa¤ol y sus establecimientos permanentes en el extranjero";
     aPopup13 = "k) Una entidad no residente en territorio espa¤ol y sus establecimientos permanentes en el mencionado territorio";
     aPopup14 = "l) Dos entidades que formen parte de un grupo que tribute en régimen de los grupos de sociedades cooperativas";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #maempw04#5 = aAlfa;
     |FINSI;
     |PINTA #maempw04#5;
|FPRC;

|PROCESO Tv2015;
     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 8;
     aPopup3  = "a) Una entidad y sus socios o part¡cipes";
     aPopup4  = "b) Una entidad y sus consejeros o administradores";
     aPopup5  = "c) Una entidad y los cónyuges o personas unidas por relaciones de parentesco ...";
     aPopup6  = "d) Dos entidades que pertenezcan a un grupo";
     aPopup7  = "e) Una entidad y los consejeros o adm. de otra entidad, cuando ambas pertenezcan a un grupo";
     aPopup8  = "f) Una entidad y otra participada por la 1a. indirectamente en, al memos, el 25% del cap.social o de los fondos propios";
     aPopup9  = "g) Dos entidades en las cuales los mismos socios, part., o  cónyuges ... participen en, al menos, el 25% ";
     aPopup10 = "h) Una entidad no residente en territorio espa¤ol y sus establecimientos permanentes en el mencionado territorio";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #maempw04#5 = aAlfa;
     |FINSI;
     |PINTA #maempw04#5;
|FPRC;

|PROCESO Tv2016;
     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 8;
     aPopup3  = "A) Una entidad y sus socios o part¡cipes";
     aPopup4  = "B) Una entidad y sus consejeros o administradores";
     aPopup5  = "C) Una entidad y los cónyuges o personas unidas por relaciones de parentesco ...";
     aPopup6  = "D) Dos entidades que pertenezcan a un grupo";
     aPopup7  = "E) Una entidad y los consejeros o adm. de otra entidad, cuando ambas pertenezcan a un grupo";
     aPopup8  = "F) Una entidad y otra participada por la 1a. indirectamente en, al memos, el 25% del cap.social o de los fondos propios";
     aPopup9  = "G) Dos entidades en las cuales los mismos socios, part., o  cónyuges ... participen en, al menos, el 25% ";
     aPopup10 = "H) Una entidad no residente en territorio espa¤ol y sus establecimientos permanentes en el mencionado territorio";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #maempw04#5 = aAlfa;
     |FINSI;
     |PINTA #maempw04#5;
|FPRC;

|PROCESO Tipo66C05;  |TIPO 66;
     aAlfa = "|C006WID";
     aID   = #maempw04#aAlfa#;
     nID   = aID;

     |SI enAnyo [ 2014;  |HAZ Tv2014;  |FINSI;
     |SI enAnyo = 2015;  |HAZ Tv2015;  |FINSI;
     |SI enAnyo ] 2016;  |HAZ Tv2016;  |FINSI;
|FPRC;

|PROCESO Tipo0C05; |TIPO 0;
     |SI enAnyo [ 2014;
         |SI #maempw04#5 < "a"; |O #maempw04#5 > "l";
             |MENAV "    Valor no admitido";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI enAnyo = 2015;
         |SI #maempw04#5 < "a"; |O #maempw04#5 > "h";
             |MENAV "    Valor no admitido";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI enAnyo ] 2016;
         #maempw04#5 = #maempw04#5 > "";

         |SI #maempw04#5 < "A"; |O #maempw04#5 > "H";
             |MENAV "    Valor no admitido";
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Baja20;
     #maempr20#0  = enEmpresa;
     #maempr20#1  = enAnyo;
     #maempr20#10 = enComple;
     #maempr20#2  = #maempr19#2;
     #maempr20#3  = 1;
|FPRC;

|PROCESO Alta20;
     #maempr20#0  = enEmpresa;
     #maempr20#1  = enAnyo;
     #maempr20#10 = enComple;
     #maempr20#2  = #maempr19#2;
     #maempr20#3  = 99;
|FPRC;

|PROCESO Baja19;
     #maempr19#0  = enEmpresa;
     #maempr19#1  = enAnyo;
     #maempr19#5  = enComple;
     #maempr19#2  = 1;
|FPRC;

|PROCESO Alta19;
     #maempr19#0  = enEmpresa;
     #maempr19#1  = enAnyo;
     #maempr19#5  = enComple;
     #maempr19#2  = 99;
|FPRC;

|PROCESO Evnt19;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#maempr19.=;

         |ESTADO_CONTROL nBtnMod19, "ENABLE";
         |ESTADO_CONTROL nBtnBor19, "ENABLE";
         |ESTADO_CONTROL nBtnAlt20, "ENABLE";
         |ESTADO_CONTROL nBtnMod20, "DISABLE";
         |ESTADO_CONTROL nBtnBor20, "DISABLE";

         |REFRESCACONTROL nGrid20;
     |FINSI;

     |SI FSalida = 4;
         |HAZ Modificar19;
     |FINSI;
|FPRC;

|PROCESO Evnt20;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#maempr20.=;

         |ESTADO_CONTROL nBtnMod20, "ENABLE";
         |ESTADO_CONTROL nBtnBor20, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         |HAZ Modificar20;
     |FINSI;
|FPRC;

|PROCESO PideDatosW03;
     |VENTANA 0501, 1199, -1, 16, "Entrada de datos";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#maempw03;
     |PINDA #0#maempw03;
     |ENDATOS #1#maempw03;
     nFSalida = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA n1Vent;

     |PULSATECLA;
|FPRC;

|PROCESO Nuevo19;
     |DDEFECTO #maempw03;

     #maempr19#0 = enEmpresa;
     #maempr19#1 = enAnyo;
     #maempr19#2 = 99;
     |LEE 000#maempr19.];
     |SI FSalida = 0;
         |LEE 000#maempr19.a;
     |SINO;
         |LEE 000#maempr19.u;
     |FINSI;

     |SI FSalida = 0;  |Y  #maempr19#0 = enEmpresa;  |Y  #maempr19#1 = enAnyo;
          #maempw03#0 = #maempr19#2 + 1;
     |FINSI;

     |HAZ PideDatosW03;
     |SI nFSalida = 0;
         #maempr19#0 = enEmpresa;
         #maempr19#1 = enAnyo;
         #maempr19#2 = #maempw03#0;
         #maempr19#3 = #maempw03#1;
         #maempr19#4 = #maempw03#2;

         |GRABA 020#maempr19.n;
         |LIBERA #maempr19;

         FSalida = "SKIPDEFAULT";
         |REFRESCACONTROL nGrid19;  |PULSATECLA;
         |FOCOTECLADO nGrid19;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO Modificar19;
     |LEE 101#maempr19.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #maempw03#0 = #maempr19#2;
     #maempw03#1 = #maempr19#3;
     #maempw03#2 = #maempr19#4;

     |HAZ PideDatosW03;
     |SI nFSalida = 0;
         #maempr19#2 = #maempw03#0;
         #maempr19#3 = #maempw03#1;
         #maempr19#4 = #maempw03#2;

         |GRABA 020#maempr19.a;
         |LIBERA #maempr19;

         FSalida = "SKIPDEFAULT";
         |REFRESCACONTROL nGrid19;  |PULSATECLA;
         |FOCOTECLADO nGrid19;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO maempr20B;
     |BORRA 020#maempr20.a;
     |LIBERA #maempr20;
|FPRC;

|DEFBUCLE maempr20B;
     #maempr20#1;
     ;
     #maempr19#0, #maempr19#1, #maempr19#5, #maempr19#2, 00;
     #maempr19#0, #maempr19#1, #maempr19#5, #maempr19#2, 99;
     be;
     NULL, maempr20B;
|FIN;

|PROCESO Borrar19;
     |CONFI "0000NSeguro que quiere BORRAR el registro";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#maempr19.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE maempr20B;

     |BORRA 020#maempr19.a;
     |LIBERA #maempr19;

     |ESTADO_CONTROL nBtnMod19,   "DISABLE";
     |ESTADO_CONTROL nBtnBor19,   "DISABLE";

     FSalida = "SKIPDEFAULT";
     |REFRESCACONTROL nGrid19;  |PULSATECLA;
     |FOCOTECLADO nGrid19;
     |PULSATECLA;
|FPRC;

|PROCESO PideDatosW04;
     |VENTANA 0501, 1199, -1, 16, "Entrada de datos";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#maempw04;
     |PINDA #0#maempw04;
     |ENDATOS #1#maempw04;
     nFSalida = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA n1Vent;

     |PULSATECLA;
|FPRC;

|PROCESO Nuevo20;
     |DDEFECTO #maempw04;

     #maempr20#0 = enEmpresa;
     #maempr20#1 = enAnyo;
     #maempr20#2 = #maempr19#2;
     #maempr20#3 = 99;
     |LEE 000#maempr20.];
     |SI FSalida = 0;
         |LEE 000#maempr20.a;
     |SINO;
         |LEE 000#maempr20.u;
     |FINSI;

     |SI FSalida = 0;  |Y  #maempr20#0 = enEmpresa;  |Y  #maempr20#1 = enAnyo;
                       |Y  #maempr20#2 = #maempr19#2;
          #maempw04#0 = #maempr20#3 + 1;
     |FINSI;

     |HAZ PideDatosW04;
     |SI nFSalida = 0;
         #maempr20#0 = enEmpresa;
         #maempr20#1 = enAnyo;
         #maempr20#2 = #maempr19#2;
         #maempr20#3 = #maempw04#0;
         #maempr20#4 = #maempw04#1;
         #maempr20#5 = #maempw04#2;
         #maempr20#6 = #maempw04#3;
         #maempr20#7 = #maempw04#4;
         #maempr20#8 = #maempw04#5;
         #maempr20#9 = #maempw04#6;

         |GRABA 020#maempr20.n;
         |LIBERA #maempr20;

         FSalida = "SKIPDEFAULT";
         |REFRESCACONTROL nGrid20;  |PULSATECLA;
         |FOCOTECLADO nGrid20;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO Modificar20;
     |LEE 101#maempr20.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #maempw04#0 = #maempr20#3;
     #maempw04#1 = #maempr20#4;
     #maempw04#2 = #maempr20#5;
     #maempw04#3 = #maempr20#6;
     #maempw04#4 = #maempr20#7;
     #maempw04#5 = #maempr20#8;
     #maempw04#6 = #maempr20#9;

     |HAZ PideDatosW04;
     |SI nFSalida = 0;
         #maempr20#3 = #maempw04#0;
         #maempr20#4 = #maempw04#1;
         #maempr20#5 = #maempw04#2;
         #maempr20#6 = #maempw04#3;
         #maempr20#7 = #maempw04#4;
         #maempr20#8 = #maempw04#5;
         #maempr20#9 = #maempw04#6;

         |GRABA 020#maempr20.a;
         |LIBERA #maempr20;

         FSalida = "SKIPDEFAULT";
         |REFRESCACONTROL nGrid20;  |PULSATECLA;
         |FOCOTECLADO nGrid20;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO Borrar20;
     |CONFI "0000NSeguro que quiere BORRAR el registro";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#maempr20.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#maempr20.a;
     |LIBERA #maempr20;

     |ESTADO_CONTROL nBtnMod20,   "DISABLE";
     |ESTADO_CONTROL nBtnBor20,   "DISABLE";

     FSalida = "SKIPDEFAULT";
     |REFRESCACONTROL nGrid20;  |PULSATECLA;
     |FOCOTECLADO nGrid20;
     |PULSATECLA;
|FPRC;

|PROGRAMA;
     aAlfa = "";
     |SI enModoConsulta = 1;
         aAlfa = "(MODO CONSULTA)   ";
     |FINSI;

     aAlfa = aAlfa + "Operaciones con personas o entidades vinculadas (art.23 y DT.20)";
     |VENTANA 0501, 3399, -1, 16, aAlfa;
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Personas o entidades vinculadas", 1902, 1980, NULL;

     nRango = 4 + 8 + 16 + 32 + 128;

     |SI enModoConsulta = 0;
         |CONTROL_SIMPLE nPan, "BOTON,{{193}}&Alta ", 1864, 1874, Nuevo19;
         nBtnAlt19  = FSalida;

         |CONTROL_SIMPLE nPan, "BOTON,{{197}}&Modificar ", 1876, 1886, Modificar19;
         nBtnMod19  = FSalida;

         |CONTROL_SIMPLE nPan, "BOTON,{{199}}&Borrar", 1888, 1898, Borrar19;
         nBtnBor19  = FSalida;

         |CONTROL_SIMPLE nPan, "BOTON,{{193}}a&Lta ", 3164, 3174, Nuevo20;
         nBtnAlt20  = FSalida;

         |CONTROL_SIMPLE nPan, "BOTON,{{197}}mo&Dificar ", 3176, 3186, Modificar20;
         nBtnMod20  = FSalida;

         |CONTROL_SIMPLE nPan, "BOTON,{{199}}bo&Rrar", 3188, 3198, Borrar20;
         nBtnBor20  = FSalida;

         |ESTADO_CONTROL nBtnMod19, "DISABLE";
         |ESTADO_CONTROL nBtnBor19, "DISABLE";

         |ESTADO_CONTROL nBtnAlt20, "DISABLE";
         |ESTADO_CONTROL nBtnMod20, "DISABLE";
         |ESTADO_CONTROL nBtnBor20, "DISABLE";
     |FINSI;

     |LINEAL_SIMPLE #1#maempr19, nRango, 0502, 1798, Baja19, Alta19, Evnt19;
     nGrid19 = FSalida;

     |LINEAL_SIMPLE #1#maempr20, nRango, 2002, 3098, Baja20, Alta20, Evnt20;
     nGrid20 = FSalida;

     |PULSATECLA;
     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid19;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL nGrid19;
     |DESTRUYECONTROL nGrid20;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA n0Vent;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     |SI PARAMETRO ! "";
         aAlfa  = PARAMETRO % 104;  enAnyo    = aAlfa;
         aAlfa  = PARAMETRO % 505;  enEmpresa = aAlfa;
                                    enComple  = aAlfa;
     |FINSI;

     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |CIERRA #maempr10;

     |ABRET #maempr19;
     |ABRET #maempr20;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #maempr19;
     |CIERRAT #maempr20;
|FPRC;
