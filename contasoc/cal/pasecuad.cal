|FICHEROS;
    pasecuad #0;
    ctacuadl #1;
    sodacoli #2;
    meempmem #3;
    mem5inma #4;
    mem5mate #5;
    mem5fina #6;
    mem9gtos #7;
    maacceso #8;

    mem11fil #11;
    mem11fic #12;
    mem00002 #202;
    mem00004 #204;
|FIN;

|VARIABLES;
     xxxxfiac = "  ";
     xxaponer = "  ";
     xrelleno = "                              ";
     cuentad  = "";
     cuentah  = "";
     vari     = "";
     aste     = "";
     long     = "";
     numero   = "";
     longi    = 0;
     sw     = 0;
     cuadro = 0;
     campo  = 0;
     campo1 = 0;
     campo2 = 0;
     campo3 = 0;
     campo4 = 0;

     aAlfa1  = "";
     fFecha  = @;
     aCuenta = "";
     nEmpresa = 0;
     nEjer = 0;

     nApar      = 0;
     nSApa      = 0;
     nAgru      = 0;
     nSAgr      = 0;
     nDApar     = 0;
     nHApar     = 0;
     nD1        = 0;
     nD2        = 0;
     nD3        = 0;
     nD4        = 0;
     nH1        = 0;
     nH2        = 0;
     nH3        = 0;
     nH4        = 0;
     nD11       = 0;
     nD21       = 0;
     nD31       = 0;
     nD41       = 0;
     nH11       = 0;
     nH21       = 0;
     nH31       = 0;
     nH41       = 0;
     nValor1    = 0;
     nValor2    = 0;
     nValor3    = 0;
     nValor4    = 0;
     nNume1     = 0;
     nNume2     = 0;
     nEstado    = 0;
     nSuma      = 0;
     nMas       = 0;
     nMenos     = 0;
     nSuma1     = 0;

     nMas1      = 0;
     nMenos1    = 0;
     nSw        = 0;
|FIN;

|PROCESO acumgtos;
         |SI sw < 1;
             |ABRE #7;
             |DDEFECTO #7;
             #7#0 = #3#0;
             #7#1 = #0#33;
             |LEE 101#7=;
             |SI FSalida ! 0;
                 |GRABA 020#7b;
             |SINO;
                 |DDEFECTO #7;
                 #7#0 = #3#0;
                 #7#1 = #0#33;
             |FINSI;
             #7#2 = #8#2;
             #7#3 = #8#3;
             |SI sw = 0; sw = 1; |SINO; sw = 2; |FINSI;
         |FINSI;
         |SI #1#4 < 4; campo1 =  4; |SINO; campo1 = 12; |FINSI;
         |SI #1#4 = 1; campo3 =  6; |FINSI;
         |SI #1#4 = 2; campo3 =  8; |FINSI;
         |SI #1#4 = 3; campo3 = 10; |FINSI;
         |SI #1#4 = 4; campo3 = 14; |FINSI;
         |SI #1#4 = 5; campo3 = 16; |FINSI;
         |SI #1#4 = 6; campo3 = 18; |FINSI;
         |SI #1#4 = 7; campo3 = 20; |FINSI;
         campo2 = campo1 + 1;
         campo4 = campo3 + 1;
         |SI #0#34= "N";
             #7campo1 = #7campo1 + #2#9;  ||  Saldo anterior.
             #7campo3 = #7campo3 + #2#9;  ||  Saldo anterior.
         |FINSI;
         |SI sw = 1;
             #7campo2 = #7campo2 + #2#8;  ||  Saldo actual.
             #7campo4 = #7campo4 + #2#8;  ||  Saldo actual.
         |SINO;
             #7campo1 = #7campo1 + #2#8;  ||  Saldo actual a¤o anterior.
             #7campo3 = #7campo3 + #2#8;  ||  Saldo actual a¤o anterior.
         |FINSI;
|FPRC;

|PROCESO acumfina;
         |SI sw = 0;
             |ABRE #6;
             |DDEFECTO #6;
             #6#0 = #3#0;
             #6#1 = #0#33;
             |LEE 101#6=;
             |SI FSalida ! 0;
                 |GRABA 020#6b;
             |SINO;
                 |DDEFECTO #6;
                 #6#0 = #3#0;
                 #6#1 = #0#33;
             |FINSI;
             #6#2 = #8#2;
             #6#3 = #8#3;
             sw = 1;
         |FINSI;
         |SI #1#5 = "D";
             #6campo1 = #6campo1 + #2#5;  ||  Apertura.
             #6campo2 = #6campo2 + #2#6;  ||  Entradas.
             #6campo3 = #6campo3 + #2#7;  ||  Salidas.
             #6campo4 = #6campo4 + #2#8;  ||  Saldo actual.
         |SINO;
             #6campo1 = #6campo1 + -#2#5; ||  Apertura.
             #6campo2 = #6campo2 + #2#7;  ||  Entradas.
             #6campo3 = #6campo3 + #2#6;  ||  Salidas.
             #6campo4 = #6campo4 + -#2#8; ||  Saldo actual.
         |FINSI;
|FPRC;

|PROCESO acummate;
         |SI sw = 0;
             |ABRE #5;
             |DDEFECTO #5;
             #5#0 = #3#0;
             #5#1 = #0#33;
             |LEE 101#5=;
             |SI FSalida ! 0;
                 |GRABA 020#5b;
             |SINO;
                 |DDEFECTO #5;
                 #5#0 = #3#0;
                 #5#1 = #0#33;
             |FINSI;
             #5#2 = #8#2;
             #5#3 = #8#3;
             sw = 1;
         |FINSI;
         |SI #1#5 = "D";
             #5campo1 = #5campo1 + #2#5;  ||  Apertura.
             #5campo2 = #5campo2 + #2#6;  ||  Entradas.
             #5campo3 = #5campo3 + #2#7;  ||  Salidas.
             #5campo4 = #5campo4 + #2#8;  ||  Saldo actual.
         |SINO;
             #5campo1 = #5campo1 + -#2#5; ||  Apertura.
             #5campo2 = #5campo2 + #2#7;  ||  Entradas.
             #5campo3 = #5campo3 + #2#6;  ||  Salidas.
             #5campo4 = #5campo4 + -#2#8; ||  Saldo actual.
         |FINSI;
|FPRC;

|PROCESO acuminma;
         |SI sw = 0;
             |ABRE #4;
             |DDEFECTO #4;
             #4#0 = #3#0;
             #4#1 = #0#33;
             |LEE 101#4=;
             |SI FSalida ! 0;
                 |GRABA 020#4b;
             |SINO;
                 |DDEFECTO #4;
                 #4#0 = #3#0;
                 #4#1 = #0#33;
             |FINSI;
             #4#2 = #8#2;
             #4#3 = #8#3;
             sw = 1;
         |FINSI;
         |SI #1#5 = "D";
             #4campo1 = #4campo1 + #2#5;  ||  Apertura.
             #4campo2 = #4campo2 + #2#6;  ||  Entradas.
             #4campo3 = #4campo3 + #2#7;  ||  Salidas.
             #4campo4 = #4campo4 + #2#8;  ||  Saldo actual.
         |SINO;
             #4campo1 = #4campo1 + -#2#5; ||  Apertura.
             #4campo2 = #4campo2 + #2#7;  ||  Entradas.
             #4campo3 = #4campo3 + #2#6;  ||  Salidas.
             #4campo4 = #4campo4 + -#2#8; ||  Saldo actual.
         |FINSI;
|FPRC;

|PROCESO posiciona;
          campo1 = 4 * #1#4;   ||  Me posiciono en el primer campo.
          campo2 = campo1 + 1;
          campo3 = campo1 + 2;
          campo4 = campo1 + 3;
|FPRC;

|PROCESO PasoEl5;
  nSuma  = 0; nSuma1  = 0;
  nMas   = 0; nMas1   = 0;
  nMenos = 0; nMenos1 = 0;

  nSuma  = #2#8;  ||Saldo actual
  nSuma1 = #2#9;  ||Saldo Anterior
  |SI #204#7 = "D";
      nMas   = #2#6;
      nMenos = #2#7;
      |SI #2#9 > 0;
          nMas1   = #2#9;
      |SINO;
          nMenos1 = -#2#9;
      |FINSI;
  |SINO;
      nSuma  = - nSuma;
      nSuma1 = - nSuma1;
      nMas   = #2#7;
      nMenos = #2#6;
      |SI #2#9 < 0;
          nMas1   = -#2#9;
      |SINO;
          nMenos1 = #2#9;
      |FINSI;
  |FINSI;

  |SI #204#3 [ 2
      |SI sw = 0;
          nValor1 = nValor1 +  nSuma;
      |FINSI;
      |SI sw = 1;
          nValor2 = nValor2 +  nSuma;
      |FINSI;
      |SI sw = 2;
          nValor1 = nValor1 +  nSuma;
          nValor2 = nValor2 +  nSuma1;
      |FINSI;
  |SINO;
      |SI sw = 0;
          nValor1 = nValor1 +  nMas;
          nValor2 = nValor2 +  nMenos;
      |FINSI;
      |SI sw = 1;
          nValor3 = nValor3 +  nMas;
          nValor4 = nValor4 +  nMenos;
      |FINSI;
      |SI sw = 2;
          nValor1 = nValor1 +  nMas;
          nValor2 = nValor2 +  nMenos;
          nValor3 = nValor3 +  nMas1;
          nValor4 = nValor4 +  nMenos1;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO control;
         |SI cuadro = 5;
             |HAZ PasoEl5;
             |ACABA;
         |FINSI;

         |SI #1#3 = 4;
             |HAZ acumgtos;
         |SINO;
             |HAZ posiciona;
             |SI #1#3 = 1; |HAZ acuminma; |FINSI;
             |SI #1#3 = 2; |HAZ acummate; |FINSI;
             |SI #1#3 = 3; |HAZ acumfina; |FINSI;
         |FINSI;
|FPRC;

|DEFBUCLE apuntes;
          #2#2;
          ;
          #3#0, #0#33, cuentad;
          #3#0, #0#33, cuentah;
          e;
          NULL,control;
|FIN;

|PROCESO lee_apuntes;
        |BUCLE apuntes;    || Lee las lineas de apuntes.
|FPRC;

|PROCESO montacuen;
         aCuenta = #1#2;
         |HAZ DesHasCuenta;
|FPRC;

|DEFBUCLE ctacuad;
          #1#2;
          ;
          #3#2, cuadro, 1, 001;
          #3#2, cuadro, 7, 999;
          e;
          NULL,montacuen,NULL,lee_apuntes;
|FIN;
|| ///////////////////////////////////////////////////////////////////

|PROCESO mem00004;
         aCuenta = #204#2;
         |HAZ DesHasCuenta;

         #11#0 = nEmpresa;
         #11#1 = nEjer;
         #11#2 = #204#3; || agrupacion
         #11#3 = #204#4; || subagrupacion
         #11#4 = #204#5; || partida
         #11#5 = #204#6; || subpartida
         |LEE 101#11=;
         |SI FSalida ! 0;
             nApar = #204#3;
             nSApa = #204#4;
             nAgru = #204#5;
             nSAgr = #204#6;
             |HAZ LeoTexto;
             |HAZ GrabaRegistros;
             |LEE 101#11=;
         |FINSI;

         nValor1 = 0; nValor2 = 0;
         nValor3 = 0; nValor4 = 0;
         |SI #0#34 = "N";
             sw = 2;  || Los dos a la vez
             |BUCLE apuntes;    || Lee las lineas de apuntes.
         |SINO;
             sw = 0;
             |BUCLE apuntes;    || Lee las lineas de apuntes.
             #0#33 = #0#33 - 1;
             sw = 1;
             |BUCLE apuntes;
             #0#33 = #0#33 + 1;
         |FINSI;
         #11#7  = #11#7  + nValor1;
         #11#8  = #11#8  + nValor2;
         #11#9  = #11#9  + nValor3;
         #11#10 = #11#10 + nValor4;
         |GRABA 020#11a;
         |LIBERA #11;
|FPRC;

|DEFBUCLE mem00004;
          #204#1;
          ;
          #3#2, 001;
          #3#2, 999;
          e;
          NULL, mem00004;
|FIN;

|PROCESO GrabaRegistros;
     |DDEFECTO #11;
     #11#0  = nEmpresa;
     #11#1  = nEjer;
     #11#2  = #202#0;
     #11#3  = #202#1;
     #11#4  = #202#4;
     #11#5  = #202#6;
     #11#6  = #202#2;
     #11#11 = #202#3;
     #11#12 = #202#5;
     #11#13 = #202#7;

     |GRABA 020#11n;
     |LIBERA #11;
|FPRC;

|DEFBUCLE mem00002;
     #202#1;
     ;
     1, 00, 00, 00;
     9, 99, 99, 99;
     ;
     NULL, GrabaRegistros;
|FIN;

|PROCESO LeoTexto;
     |ABRE #202;
     #202#0  = nApar;
     #202#1  = nSApa;
     #202#4  = nAgru;
     #202#6  = nSAgr;
     |LEE 040#202=;
     |SI FSalida ! 0;  |DDEFECTO #202;  |FINSI;
     |CIERRA #202;
|FPRC;

|PROCESO BorroLineas;
 |BORRA 020#11a;
 |LIBERA #11;
|FPRC;

|DEFBUCLE BorroLineas;
 #11#1;
 ;
 #12#0, #12#1, 0, 00, 00, 00;
 #12#0, #12#1, 9, 99, 99, 99;
 be;
 NULL, BorroLineas;
|FIN;

|PROCESO CreoFinanciero;
             |ABRE #12;
             #12#0 = nEmpresa;
             #12#1 = nEjer;
             |LEE 001#12=;
             nEstado = FSalida;
                 #12#0 = nEmpresa;
                 #12#1 = nEjer;
                 #12#2 = #8#2;
                 #12#3 = #8#3;
                 #12#5 = #12#1 - 1;
             |SI nEstado = 0; |GRABA 020#12a; |FINSI;
             |SI nEstado ! 0; |GRABA 020#12n; |FINSI;
             |CIERRA #12;
             |BUCLE BorroLineas;

             |ABRE #11;
             |BUCLE mem00002;

             sw     = 0;
             cuadro = 5;
             |BUCLE mem00004;
             |CIERRA #11;


             nDApar = 1; nHApar = 2;
             |HAZ Total;

             nDApar = 3; nHApar = 3;
             |HAZ Total;
|FPRC;


|PROCESO LeeCasilla;
     #11#0  = nEmpresa;
     #11#1  = nEjer;
     #11#2  = nApar;
     #11#3  = nSApa;
     #11#4  = nAgru;
     #11#5  = nSAgr;
     |LEE 040#11=;
     |SI FSalida ! 0;  |DDEFECTO #11;  |FINSI;
|FPRC;

|PROCESO GraboCasilla;
     |ABRE #11;
     #11#0  = nEmpresa;
     #11#1  = nEjer;
     #11#2  = nApar;
     #11#3  = nSApa;
     #11#4  = nAgru;
     #11#5  = nSAgr;
     |LEE 040#11=;
     |SI FSalida ! 0;
         |DDEFECTO #11;
         #11#0  = nEmpresa;
         #11#1  = nEjer;
         #11#2  = nApar;
         #11#3  = nSApa;
         #11#4  = nAgru;
         #11#5  = nSAgr;
         #11#6  = #202#2;
         #11#11 = #202#3;
         #11#12 = #202#5;
         #11#13 = #202#7;
         |GRABA 020#11b;
      |FINSI;
      #11#7  = nValor1;
      #11#8  = nValor2;
      #11#9  = nValor3;
      #11#10 = nValor4;
      |GRABA 020#11a;
      |LIBERA #11;
      |CIERRA #11;
|FPRC;

|PROCESO LeoTotal1;
    nValor1   = nValor1 + #11#7;
    nValor2   = nValor2 + #11#8;
    nValor3   = nValor3 + #11#9;
    nValor4   = nValor4 + #11#10;
|FPRC;

|DEFBUCLE LeoTotal1;
 #11#1;
 ;
 nEmpresa, nEjer, nD11, nD21, nD31, nD41;
 nEmpresa, nEjer, nH11, nH21, nH31, nH41;
 e;
 NULL, LeoTotal1;
|FIN;

|PROCESO LeoTabla;
  |SI #202#5 ! 1;
      |SI #202#3 ! "T"; |ACABA; |FINSI;
  |FINSI;

  |SI nSw = 3;
      nValor1 = 0; nValor2 = 0;
      nValor3 = 0; nValor4 = 0;
      nD11 = #202#0; nH11 = #202#0;
      nD21 = #202#1; nH21 = #202#1;
      nD31 = #202#4; nH31 = #202#4;
      nD41 = 01;    nH41 = 99;
      |BUCLE LeoTotal1;
      nApar = #202#0;
      nSApa = #202#1;
      nAgru = #202#4;
      nSAgr = 00;
      |HAZ GraboCasilla;
  |FINSI;
  |SI nSw = 2;
      nValor1 = 0; nValor2 = 0;
      nValor3 = 0; nValor4 = 0;
      nD11 = #202#0; nH11 = #202#0;
      nD21 = #202#1; nH21 = #202#1;
      nD31 = 01;    nH31 = 99;
      nD41 = 00;    nH41 = 00;
      |BUCLE LeoTotal1;
      nApar = #202#0;
      nSApa = #202#1;
      nAgru = 00;
      nSAgr = 00;
      |HAZ GraboCasilla;
  |FINSI;
  |SI nSw = 1;
      nValor1 = 0; nValor2 = 0;
      nValor3 = 0; nValor4 = 0;
      nD11 = #202#0; nH11 = #202#0;
      nD21 = 01;    nH21 = 89;
      nD31 = 00;    nH31 = 00;
      nD41 = 00;    nH41 = 00;
      |BUCLE LeoTotal1;
      nApar = #202#0;
      nSApa = 90;
      nAgru = 00;
      nSAgr = 00;
      |HAZ GraboCasilla;
  |FINSI;
|FPRC;

|DEFBUCLE leom00002;
 #202#1;
 ;
 nD1, nD2, nD3, nD4;
 nH1, nH2, nH3, nH4;
 e;
 NULL, LeoTabla;
|FIN;

|PROCESO Total;

  nD1 = nDApar; nH1 = nHApar;

  nSw = 3;
  nD2 = 1; nH2 = 89;
  nD3 = 1; nH3 = 99;
  nD4 = 0; nH4 = 0;
  |BUCLE leom00002;

  nSw = 2;
  nD2 = 1; nH2 = 89;
  nD3 = 0; nH3 = 0;
  nD4 = 0; nH4 = 0;
  |BUCLE leom00002;

  nSw = 1;
  nD2 = 0; nH2 = 0;
  nD3 = 0; nH3 = 0;
  nD4 = 0; nH4 = 0;
  |BUCLE leom00002;


  |SI nDApar ! 3;
      nValor3 = 0;
      nValor4 = 0;

      |ABRE #11;
      nApar = 1;  nSApa = 90;
      nAgru = 00; nSAgr = 00;
      |HAZ LeeCasilla;
      nNume1 = #11#7;
      nNume2 = #11#8;

      nApar = 2;  nSApa = 90;
      nAgru = 00; nSAgr = 00;
      |HAZ LeeCasilla;
      nNume1 = nNume1 - #11#7;
      nNume2 = nNume2 - #11#8;
      |CIERRA #11;

      nValor1 = 0; |SI nNume1 > 0; nValor1 = nNume1; |FINSI;
      nValor2 = 0; |SI nNume2 > 0; nValor2 = nNume2; |FINSI;
      nApar = 1;
      nSApa = 91;
      nAgru = 00;
      nSAgr = 00;
      |HAZ GraboCasilla;

      nValor1 = 0; |SI nNume1 < 0; nValor1 = -nNume1; |FINSI;
      nValor2 = 0; |SI nNume2 < 0; nValor2 = -nNume2; |FINSI;
      nApar = 2;
      nSApa = 91;
      nAgru = 00;
      nSAgr = 00;
      |HAZ GraboCasilla;

  |FINSI;
|FPRC;


|| ///////////////////////////////////////////////////////////////////

|PROCESO DesHasCuenta;
         vari   = aCuenta;
         |QBF vari;
         aste   = vari % -101;
         long   = vari % 0;
         longi  = long - 1;
         longi  = 100 + longi;
         numero = vari % longi;
         |SI aste = "*";
             cuentad = numero + "            ";
             cuentad = cuentad % 112;
             cuentah = numero + "zzzzzzzzzzzz";
             cuentah = cuentah % 112;
         |SINO;
             cuentad = aCuenta;
             cuentah = aCuenta;
         |FINSI;
|FPRC;

|PROCESO leeempresa;
         nEmpresa = #3#0;
         nEjer    = #0#33;
         #8#0 = #3#0;
         #8#1 = #0#33;
         |LEE 001#8=;
         |SI FSalida ! 0; #8#2 = #3#1; |DDEFECTO #8; |FINSI;
|FPRC;

|PROCESO estructa;
         |HAZ leeempresa;
         |PARA cuadro = 1; |SI cuadro < 5; |HACIENDO cuadro = cuadro + 1;
               sw = 0;
               |BUCLE ctacuad;
               |SI cuadro = 4; |Y #0#34 = "S";
                   #0#33 = #0#33 - 1;
                   |SI sw = 1; sw = 2; |SINO; sw = -1; |FINSI;
                   |BUCLE ctacuad;
                   #0#33 = #0#33 + 1;
               |FINSI;
               |SI sw > 0;
                   |SI cuadro = 1; |GRABA 020#4a; |LIBERA #4; |CIERRA #4; |FINSI;
                   |SI cuadro = 2; |GRABA 020#5a; |LIBERA #5; |CIERRA #5; |FINSI;
                   |SI cuadro = 3; |GRABA 020#6a; |LIBERA #6; |CIERRA #6; |FINSI;
                   |SI cuadro = 4; |GRABA 020#7a; |LIBERA #7; |CIERRA #7; |FINSI;
               |FINSI;
         |SIGUE;

         |SI #0#35 = "S";
             |HAZ CreoFinanciero;
         |FINSI;
|FPRC;

|DEFBUCLE medatem1;
          #3#1;
          ;
          #0#1;
          #0#2;
          e;
          NULL,estructa;
|FIN;

|PROCESO final; |TIPO 3;

         |ABRE #8;
         |SI #0#0 = "S";
             |BUCLE medatem1;
         |SINO;
             |PARA campo = 3; |SI campo < 33; |HACIENDO campo = campo + 1;
                   |SI #0campo > 0;
                       #0#1 = #0campo;
                       #0#2 = #0campo;
                       |BUCLE medatem1;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |CIERRA #8;
|FPRC;

|| ---------------------- PROCESOS DE ENTRADA DE DATOS -----------------------

|PROCESO ayuda; |TIPO 7;
         |PUSHV 0501 1373;
         |CUADRO 05011373;
         |ATRI R;
         |PINTA 0602," Los comparativos de gastos, en los cuadros de la memoria, los podemos ";
         |PINTA 0702," obtener con dos opciones:                                             ";
         |PINTA 0802,"                                                                       ";
         |PINTA 0902," N - Recoge de la entrada de datos del ejercicio actual la columna     ";
         |PINTA 1002,"     Saldo Anterior para el comparativo.                               ";
         |PINTA 1102," S - Tiene que existir la entrada de datos del ejercicio anterior (n-1)";
         |PINTA 1202,"     ,y de aqui traspasara la informacion a las casillas de dicho ejer.";
         |ATRI r;
|FPRC;

|PROCESO pop; |TIPO 0;
         |POPV;
|FPRC;

|PROCESO empresas; |TIPO 7;
      aAlfa1 = #0#0;
      |C_M #0Campo,1,aAlfa1;
|FPRC;

|PROCESO parrilla; |TIPO 7;
||      aAlfa1 = "S";
||      |SI #0#0 = "S"; aAlfa1 = "N"; |FINSI;
||      |C_M #0Campo,1,aAlfa1;

      |SI #0#0 = "S"; |HAZ nomodi; |FINSI;
|FPRC;

|PROCESO nomodi;
         xxaponer = Anono;
         xxxxfiac = Control % A1001;
         Control = Control + xxxxfiac;
         Control = Control + xrelleno;
         Control = Control % A120;
         Control = Control + xxaponer;
|FPRC;
