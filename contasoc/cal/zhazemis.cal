|FICHEROS;
     zhazdocu;
     zhazcrea;
     zregdocu;
     zw000019;
|FIN;

|VARIABLES;
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aEsc1        = "";
     aEsc2        = "";
     aRetu        = "";
     aTecla       = "";
     aRuta        = "";
     aLong        = "";
     aIPRemoto    = "";
     aBase        = "";
     aDirPatron   = "";
     aDirInsta    = "";
     aOrigen      = "";
     aDestino     = "";
     aFicTmp      = "";
     aTipoInstala = "";
     aAbre        = "";
     aBuscar      = "";
     aRefresca    = "";
     aContenido   = "";
     aCarac       = "";

     nRango       = 0;
     n1Vent       = 0;
     n2Vent       = 0;
     n3Vent       = 0;
     nBtn1        = 0;
     nBtn2        = 0;
     nBtn3        = 0;
     nSalir       = 0;
     nHandle      = 0;
     nRefresca    = 0;
     nConta1      = 0;
     nTree        = 0;
     nCargar      = 0;
     nPosi        = 0;
     nGrid        = 0;

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     {-1}sTree        = 0;
     sT_nID           = 0;
     sT_nOper         = 0;
     sT_aData         = "";

     &enEmpresa       = 0;
     &enGrid          = 0;
     &enError         = 0;
     &enModo          = 0;
     &eaFichero       = "";
     &eaUnidadBasico  = "";
     &eaDSMAC         = "";

     &eaDirPlantilla  = "";
     &eaDirTrabajo    = "";
     &eaDirTrabServi  = "";
     &eaDirSerPlan    = "";
     &eaDirSerDoc     = "";
     &eaDirGuarda     = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaRutaOrigen    = "";
     &eaRutaDestino   = "";
     &eaFicheroTra    = "";
     &eaFicheroTxt    = "";
     &eaFicheroTgz    = "";
     &eaFicheroTar    = "";
     &eaModoPresenta  = "";
     &eaPath          = "";
     &eaVerde         = "";
|FIN;

|PROCESO Imprime;
     |DBASE aBase;
     eaDirGuarda    = aBase  + "emisiones";    |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + (("00000" + #zhazcrea#0) % -105);  |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/" + #zhazcrea#1;                       |MKDIR eaDirGuarda;
     eaDirGuarda    = eaDirGuarda + "/";
     eaDirSerDoc    = eaDirGuarda;
     eaDirSerPlan   = aBase  + "planilla/";

     eaOrigen       = eaDirGuarda  + eaFicheroTra;
     eaDestino      = eaDirTrabajo + eaFicheroTra;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabajo + eaFicheroTra;
     |XABRE "EC", aAbre, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aAlfa        = eaDirTrabajo + "wait dsprintword " + aAbre + " 0";
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO zw000019EMITE;
     |SI #zw000019#2 = "N";
         |ACABA;
     |FINSI;

     #zregdocu#0   = #zw000019#0;
     #zregdocu#1   = #zhazdocu#0;
     |LEE 101#zregdocu.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = "Emitiendo la empresa " + (("00000" + #zw000019#0) % -105);
     aAlfa = aAlfa + " / " + #zw000019#1;
     |VENTANA 0501, 0560, -1, 16, aAlfa;
     n3Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n3Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     #zhazcrea#0   = #zregdocu#0;
     #zhazcrea#1   = #zregdocu#1;
     #zhazcrea#2   = #zregdocu#2;
     #zhazcrea#6   = #zregdocu#7;
     #zhazcrea#7   = #zregdocu#5;
     #zhazcrea#8   = #zregdocu#9;
     #zhazcrea#9   = #zregdocu#12;
     #zhazcrea#10  = #zregdocu#13;
     #zhazcrea#17  = #zregdocu#81;

     |SI #zregdocu#68 = " ";
         aAlfa = #zregdocu#15;  |QBF aAlfa;
         |SI aAlfa ! "";
             #zregdocu#68 = "S";
         |FINSI;

         |SI #zregdocu#68 = " ";
             |SI #zhazdocu#0 ] 2009;
                 |SI #zregdocu#14 = "S";
                     #zregdocu#68 = "S";
                 |FINSI;
             |SINO;
                 #zregdocu#68 = "N";
             |FINSI;
         |FINSI;
     |FINSI;

     #zhazcrea#11  = #zregdocu#68;
     #zhazcrea#15  = #zregdocu#69;
     #zhazcrea#16  = #zregdocu#15;

     |SI #zhazcrea#11 = " ";   #zhazcrea#11 = "N";  |FINSI;

     |SI aContenido = "EmisionMem";
         eaFicheroTra   = "wmemori.doc";
         |HAZ Imprime;
     |FINSI;

     |SI aContenido = "EmisionInf";
         eaFicheroTra   = "wgestio.doc";
         |HAZ Imprime;
     |FINSI;

     |SI aContenido = "EmisionCer";
         eaFicheroTra   = "wcertif.doc";
         |HAZ Imprime;
     |FINSI;

     |SI aContenido = "EmisionAct";
         eaFicheroTra   = "wactapr.doc";
         |HAZ Imprime;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n3Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n3Vent;

     |PULSATECLA;
|FPRC;

|DEFBUCLE zw000019EMITE;
     #zw000019#2;
     ;
     INICIO;
     FINAL;
     be;
     NULL, zw000019EMITE;
|FIN;

|PROCESO Evntw19;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#zw000019.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#zw000019.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |SI #zw000019#2 = "S";
             #zw000019#2 = "N";
             #zw000019#3 = "";
         |SINO;
             #zw000019#2 = "S";
             #zw000019#3 = eaVerde;
         |FINSI;

         |GRABA 020#zw000019.a;
         |LIBERA #zw000019;

         |REFRESCACONTROL nGrid;
     |FINSI;
|FPRC;

|PROCESO zw000019Marca;
     #zw000019#2 = aAlfa;
     #zw000019#3 = "";

     |SI #zw000019#2 = "S";
         #zw000019#3 = eaVerde;
     |FINSI;

     |GRABA 020#zw000019.a;
     |LIBERA #zw000019;
|FPRC;

|DEFBUCLE zw000019Marca;
     #zw000019#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, zw000019Marca;
|FIN;

|PROCESO ActivaTodo;
     aAlfa = "S";
     |BUCLE zw000019Marca;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO DesactivaTodo;
     aAlfa = "N";
     |BUCLE zw000019Marca;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO zregdocuMAS;
     |SI aContenido = "EmisionMem";
         |SI #zregdocu#4 ! "S";  |ACABA;  |FINSI;
     |FINSI;

     |SI aContenido = "EmisionInf";
         |SI #zregdocu#8 ! "S";  |ACABA;  |FINSI;
     |FINSI;

     |SI aContenido = "EmisionCer";
         |SI #zregdocu#11 ! "S";  |ACABA;  |FINSI;
     |FINSI;

     |SI aContenido = "EmisionAct";
         |SI #zregdocu#80 ! "S";  |ACABA;  |FINSI;
     |FINSI;

     #zw000019#0  = #zregdocu#0;
     #zw000019#1  = #zregdocu#2;
     #zw000019#2  = "S";
     #zw000019#3  = eaVerde;

     |GRABA 020#zw000019.n;
     |LIBERA #zw000019;
|FPRC;

|DEFBUCLE zregdocuMAS;
     #zregdocu#1;
     ;
     00000, #zhazdocu#0;
     99999, #zhazdocu#0;
     ;
     NULL, zregdocuMAS;
|FIN;

|PROCESO Cancela;
     |PTEC 807;
|FPRC;

|PROCESO SelecEmpresa;
     |BUCLE zregdocuMAS;

     |LEE 000#zw000019.p;
     |SI FSalida ! 0;
         |MENAV "0000No hay registros a emitir";
         |ACABA;
     |FINSI;

     |CONTROL_SIMPLE 0, "LABEL,{{13}}Doble click en el registro para activar/desactivar el registro", 0515, 0575, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{10}}Se emitir n por la impresora predeterminada los registros en verde ordenados por nombre cliente", 0680, 1298, NULL;
     |CONTROL_SIMPLE 0, "BOTON,Activar todo", 3215, 3228, ActivaTodo;       nBtn1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Desactivar todo", 3230, 3243, DesactivaTodo; nBtn2 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,{{207}}Cancelar", 3470, 3483, Cancela;       nBtn3 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#zw000019, nRango, 0615, 3175, NULL, NULL, Evntw19;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{230}}Emitir," + nGrid;
         |LEETECLA aTecla;

         |SI aTecla = aEsc1;  |O aTecla = aEsc2;  |O aTecla = aRetu;
             |SAL;
         |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtn1;
     |FIN_CONTROL_WINDOWS nBtn2;
     |FIN_CONTROL_WINDOWS nBtn3;

     |SI aTecla = aEsc2;
         |ACABA;
     |FINSI;

     |BUCLE zw000019EMITE;
|FPRC;

|PROCESO EvntTreeMasiva;
     aContenido = Contenido % -110;

     |SI FEntrada = 0;  |ACABA;  |FINSI;

     |SI aContenido = "_____Salir";
         |PTEC 807;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 3499, -1, 16, "Selecci¢n de empresa";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aFicTmp = "zw000019" + Usuario;
     |NOME_DAT #zw000019#aFicTmp#;
     |ABRE #zw000019;  |CIERRA #zw000019;  |DELINDEX #zw000019;

     |ABRE #zw000019;

     |HAZ SelecEmpresa;

     |CIERRA #zw000019;
     |DELINDEX #zw000019;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;
|FPRC;

|PROCESO GrabaArbolMasiva;
     aAlfa = aAlfa1 + aAlfa2 + aAlfa3 + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO ArbolMasiva;
     nConta1 = nConta1 + 1;
     aAlfa1  = nConta1 + ":";
     aAlfa2  = "Memorias";
     aAlfa3  = "{{EmisionMem}}";
     |HAZ GrabaArbolMasiva;

     nConta1 = nConta1 + 1;
     aAlfa1  = nConta1 + ":";
     aAlfa2  = "Informes de gesti¢n";
     aAlfa3  = "{{EmisionInf}}";
     |HAZ GrabaArbolMasiva;

     nConta1 = nConta1 + 1;
     aAlfa1  = nConta1 + ":";
     aAlfa2  = "Certificados";
     aAlfa3  = "{{EmisionCer}}";
     |HAZ GrabaArbolMasiva;

     nConta1 = nConta1 + 1;
     aAlfa1  = nConta1 + ":";
     aAlfa2  = "Actas aprobaci¢n de cuentas";
     aAlfa3  = "{{EmisionAct}}";
     |HAZ GrabaArbolMasiva;

     nConta1 = nConta1 + 1;
     aAlfa1  = nConta1 + ":";
     aAlfa2  = "Salir ";
     aAlfa3  = "{{_____Salir}}";
     |HAZ GrabaArbolMasiva;

     |PULSATECLA;
|FPRC;

|PROCESO EmiMasiva;
     eaDirTrabajo   = eaUnidadBasico + "\MODELOS";            |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = eaUnidadBasico + "\MODELOS\MEMORIAS";   |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = eaUnidadBasico + "\MODELOS\MEMORIAS\" + #zhazdocu#0;         |RMKDIR eaDirTrabajo;
     eaDirTrabajo   = eaUnidadBasico + "\MODELOS\MEMORIAS\" + #zhazdocu#0 + "\";

     eaPath = eaDirTrabajo;
     |HAZ TraeDsPrintWord;

     |VENTANA 0501, 0540, -1, 16, "Procesando trabajo";
     n1Vent = FSalida;

     |PTEC 802;  |PAUSA;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "documentos";      |MKDIR aAlfa;
     aAlfa = aBase + "modelos/tmp";     |MKDIR aAlfa;

     |SI eaUnidadBasico = "";  |HAZ LeeUnidadBasico;  |FINSI;

     eaRutaOrigen  = aBase + "modelos/tmp/";
     eaRutaDestino = eaUnidadBasico + "\modelos\tmp\";

     eaFicheroTxt  = "zhazdocu1" + Usuario + ".txt";
     eaFicheroTgz  = "zhazdocu1" + Usuario + ".tgz";
     eaFicheroTar  = "zhazdocu1" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     |XABRE "WB", aAbre, nHandle;

     nConta1 = 0;

     |HAZ ArbolMasiva;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     |FINVENTANA n1Vent;

     |VENTANA 0501, 3499, -1, 16, "Emisi¢n masiva de documentos";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aAlfa = "TREECTRL,Emisi¢n masiva de  {{" + aAlfa + "}}";

     |CONTROL_SIMPLE 0, aAlfa, 0602, 3298, EvntTreeMasiva;
     nTree = FSalida;

     eaFicheroTxt  = "zhazdocu1" + Usuario + ".txt";

     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     |SI aBuscar ! "";
         sT_nID   = nTree;
         sT_nOper = 3;
         sT_aData = "[" + aBuscar;
         |ESPECIFICA "COMMANDCONTROL", sTree;
         |SI FSalida ] 0;
             aRefresca = ":" + FSalida;
         |SINO;
             aRefresca = "1:";
         |FINSI;
     |FINSI;

     sT_nID   = nTree;
     sT_nOper = 2;
     |SI aRefresca = "";
         sT_aData = "1:";
     |SINO;
         sT_aData = aRefresca;
     |FINSI;
     |ESPECIFICA "COMMANDCONTROL", sTree;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nTree;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |FOCOTECLADO enGrid;

     |PULSATECLA;
|FPRC;
