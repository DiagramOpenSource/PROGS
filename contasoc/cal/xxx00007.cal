|FICHEROS;
    xxx00007 #0;
|FIN;

|VARIABLES;
    &empresa   = 0;
    &anyo      = 0;
    &nombre    = "";
    &modo      = 0;

    FEstado = 0;
    varcamp = 0;
    x       = 0;
    tecla_p = "";
    avance  = "815";
    atras   = "814";

    vdia1   = "";
    vme1    = "";
    vany1   = "";
    vdia    = 0;
    vme     = 0;
    vany    = 0;
    vtope   = 0;
    vsw     = 0;
    vfec    = "";
    vblanco = "          ";
    vpuntos = "..........";
    v       = 0;
    mod     = 0;
    verrfec = "0000ATENCION !! Fecha erronea o formato incorrecto ";
|FIN;

|PROGRAMA;
|ABRE #0;
|PINPA #0#0;
|SI modo = 1; |O modo = 2; |HAZ pidedato; |FINSI;
|SI modo = 4; |HAZ consulta; |FINSI;
|CIERRA #0;
|FPRO;

|PROCESO pidedato;
#0#0   = empresa;
#0#110 = anyo;
|LEE 110#0=;
FEstado = FSalida;
|SI FEstado ! 0; |DDEFECTO #0; #0#0 = empresa; #0#110 = anyo; |FINSI;
|PINDA #0#0;
|SI modo = 1; |ENDATOS #1#0;  |FINSI;
|SI modo = 2; |ENDATOS #2#0;  |FINSI;
|SI FSalida = 0;
    #0#0   = empresa;
    #0#110 = anyo;
    #0#1   = nombre;
    |SI FEstado = 0; |GRABA 020#0a; |SINO; |GRABA 020#0n; |FINSI;
    |LIBERA #0;
    |CIERRA #0;
|FINSI;
|FPRC;

|PROCESO consulta;
  avance  = &255 + avance;
  atras   = &255 + atras;
  #0#0    = empresa;
  #0#110  = anyo;
  |LEE 040#0=;
  |SI FSalida = 0; |HAZ pantalla1; |FINSI;
|FPRC;

|PROCESO pantalla1;
  |PINPA #0#0;
  |PINDA #0#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = avance; |HAZ pantalla2; |ACABA; |FINSI;
|FPRC;

|PROCESO pantalla2;
  |PINPA #1#0;
  |PINDA #1#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = avance; |HAZ pantalla3; |ACABA; |FINSI;
  |SI tecla_p = atras;  |HAZ pantalla1; |ACABA; |FINSI;
|FPRC;

|PROCESO pantalla3;
  |PINPA #2#0;
  |PINDA #2#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = atras; |HAZ pantalla2; |ACABA; |FINSI;
|FPRC;

|PROCESO fechaco1; |TIPO 0;
vfec = #0Campo; vsw = 0;

|SI vfec ! vblanco; |Y vfec ! vpuntos;
    vdia1 = vfec % A102;
    vme1 = vfec % A402;
    vany1 = vfec % A704;
    vdia = vdia1; vme = vme1; vany = vany1;
    |SI vdia ! 0; |Y vme ! 0; |Y vany > 1900;
      |SI vme [ 12; |Y vme ] 1;
        |SI vme = 1; |O vme = 3; |O vme = 5; |O vme = 7; |O vme = 8; |O vme = 10; |O vme = 12;
            vtope = 31;
        |SINO;
            |SI vme = 2;
                mod = vany $ 4;
                |SI mod = 0;
                    vtope = 29;
                |SINO;
                    vtope = 28;
                |FINSI;
            |SINO;
                vtope = 30;
            |FINSI;
        |FINSI;
        |SI vdia [ vtope;
            vsw = 1;
        |FINSI;
      |FINSI;
    |FINSI;
|SINO;
  vsw = 1;
|FINSI;

|SI vsw = 0;
    |MENAV verrfec;
    |ERROR;
|FINSI;
|FPRC;
