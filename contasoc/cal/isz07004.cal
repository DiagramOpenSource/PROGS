|FICHEROS;
     isz00004 #0;
     ism00002 #2;
     isocie30 #30;  || A¤o anterior
     isocie06 #6;   || A¤o Actual
     isocie09 #9;   || Creacion de Empleo
     isocie38 #38;  || Canarias, Cartuja
     isocie70 #70;  || Fichero de Deducciones A¤o 1999

     isocie68 #10;
|FIN;

|VARIABLES;
     &empresa = 0;
     &anyo    = 0;
     &tipo    = 0;

     nLinea     = 0;
     nTotalDec  = 0;
     nAnyoDed   = 0;
     nTipoDec   = 0;
     nAnyoAnt   = 0;
     nAgru      = 0;
     nConc      = 0;
     nAplicar   = 0;

     aTipoDec   = "";
     aTipoCalc  = "";

     &eParametro = "";
|FIN;

|PROCESO CogeNuevo;
     #70#0 = empresa;
     #70#1 = anyo;
     #70#2 = 99;
     |LEE 040#70];
     |SI FSalida = 0;
         |LEE 040#70a;
     |SINO;
         |LEE 040#70u;
     |FINSI;

     nLinea = 1;
     |SI FSalida = 0;  |Y #70#0 = empresa;  |Y #70#1 = anyo;
         nLinea = #70#2 + 1;
     |FINSI;
|FPRC;

|PROCESO el99_30;
     |SI nTotalDec = 0; |ACABA; |FINSI;

     |SI #30#7 [ nTotalDec;
         nTotalDec = nTotalDec - #30#7;
         nAplicar  = #30#7;
     |SINO;
         nAplicar  = nTotalDec;
         nTotalDec = 0;
     |FINSI;

     |SI #30#3 = 94;
         |SI #30#9 = 1;  nAgru = 1;  nConc = 1;  |FINSI;
         |SI #30#9 = 2;  nAgru = 1;  nConc = 2;  |FINSI;
         |SI #30#9 = 3;  nAgru = 1;  nConc = 3;  |FINSI;
     |FINSI;

     |SI #30#3 = 95;
         |SI #30#9 = 1;  nAgru = 1;  nConc = 5;  |FINSI;
         |SI #30#9 = 2;  nAgru = 1;  nConc = 6;  |FINSI;
         |SI #30#9 = 3;  nAgru = 1;  nConc = 7;  |FINSI;
     |FINSI;

     |SI #30#3 = 96;
         |SI #30#9 = 1;  nAgru = 2;  nConc = 1;  |FINSI;
         |SI #30#9 = 4;  nAgru = 1;  nConc = 9;  |FINSI;
     |FINSI;

     |SI #30#3 = 97;
         |SI #30#9 = 1;  nAgru = 2;  nConc = 2;  |FINSI;
     |FINSI;

     |SI #30#3 = 98;
         |SI #30#9 = 1;  nAgru = 2;  nConc = 4;  |FINSI;
         |SI #30#9 = 2;  nAgru = 2;  nConc = 4;  |FINSI;
         |SI #30#9 = 3;  nAgru = 2;  nConc = 4;  |FINSI;
     |FINSI;

     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #30#0;
     #70#1  = anyo;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = nAplicar;
     #70#11 = nAplicar;
     #70#12 = #30#5;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie30_99;
     #30#1;
     3, 8, 9;
     empresa, nAnyoAnt, 001, nAnyoDed, aTipoCalc, nTipoDec;
     empresa, nAnyoAnt, 999, nAnyoDed, aTipoCalc, nTipoDec;
     be;
     NULL, el99_30;
|FIN;

|PROCESO isocie30_99;
     aTipoCalc = "S";  |BUCLE isocie30_99;
     aTipoCalc = "N";  |BUCLE isocie30_99;
|FPRC;

|PROCESO el99_06;
     |SI nTotalDec = 0;    |ACABA;  |FINSI;

     |SI #6#8 [ nTotalDec;
         nTotalDec = nTotalDec - #6#8;
         nAplicar  = #6#8;
     |SINO;
         nTotalDec = 0;
         nAplicar  = nTotalDec;
     |FINSI;

     nAgru    = 2;
     nConc    = 4;

     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #6#0;
     #70#1  = anyo;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = nAplicar;
     #70#11 = nAplicar;
     #70#12 = #6#5;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie06_99;
     #6#1;
     3, 9;
     empresa, nAnyoAnt, 001, aTipoDec, aTipoCalc;
     empresa, nAnyoAnt, 999, aTipoDec, aTipoCalc;
     be;
     NULL, el99_06;
|FIN;

|PROCESO isocie06_99;
     aTipoCalc = "S";  |BUCLE isocie06_99;
     aTipoCalc = "N";  |BUCLE isocie06_99;
|FPRC;

|PROCESO el99_38;
     |SI nTotalDec = 0; |ACABA; |FINSI;

     |SI #38#9 [ nTotalDec;
         nTotalDec = nTotalDec - #38#9;
         nAplicar  = #38#9;
     |SINO;
         nAplicar  = nTotalDec;
         nTotalDec = 0;
     |FINSI;

     nAgru    = 0;
     nConc    = 0;

     |SI #38#3 = "1";
         |SI #38#4 = 94;  nAgru = 5;  nConc = 1;  |FINSI;
         |SI #38#4 = 95;  nAgru = 5;  nConc = 2;  |FINSI;
         |SI #38#4 = 96;  nAgru = 5;  nConc = 3;  |FINSI;
         |SI #38#4 = 97;  nAgru = 5;  nConc = 4;  |FINSI;
         |SI #38#4 = 98;  nAgru = 5;  nConc = 5;  |FINSI;
         |SI #38#4 = 99;  nAgru = 5;  nConc = 6;  |FINSI;
     |FINSI;

     |SI #38#3 = "2";
         |SI #38#4 = 94; nAgru = 4;  nConc = 1;  |FINSI;
         |SI #38#4 = 95; nAgru = 4;  nConc = 2;  |FINSI;
         |SI #38#4 = 96; nAgru = 4;  nConc = 3;  |FINSI;
         |SI #38#4 = 97; nAgru = 4;  nConc = 4;  |FINSI;
         |SI #38#4 = 98; nAgru = 4;  nConc = 5;  |FINSI;
         |SI #38#4 = 99; nAgru = 4;  nConc = 7;  |FINSI;

         |SI #38#4 = 94; |Y #38#5 = 25;  nAgru = 3;  nConc = 1;  |FINSI;
         |SI #38#4 = 95; |Y #38#5 = 25;  nAgru = 3;  nConc = 2;  |FINSI;
         |SI #38#4 = 96; |Y #38#5 = 25;  nAgru = 3;  nConc = 3;  |FINSI;
         |SI #38#4 = 97; |Y #38#5 = 25;  nAgru = 3;  nConc = 4;  |FINSI;
         |SI #38#4 = 98; |Y #38#5 = 25;  nAgru = 3;  nConc = 5;  |FINSI;
         |SI #38#4 = 99; |Y #38#5 = 25;  nAgru = 3;  nConc = 7;  |FINSI;
     |FINSI;

     |SI #38#3 = "4";
         |SI #38#4 = 96;  nAgru = 5;  nConc = 7;  |FINSI;
         |SI #38#4 = 97;  nAgru = 5;  nConc = 8;  |FINSI;
         |SI #38#4 = 98;  nAgru = 5;  nConc = 9;  |FINSI;
         |SI #38#4 = 99;  nAgru = 5;  nConc = 10; |FINSI;
     |FINSI;

     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #38#0;
     #70#1  = anyo;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = nAplicar;
     #70#11 = nAplicar;
     #70#12 = #38#6;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie38_99;
     #38#1;
     3, 4, 10;
     empresa, nAnyoAnt, 001, aTipoDec, nAnyoDed, aTipoCalc;
     empresa, nAnyoAnt, 999, aTipoDec, nAnyoDed, aTipoCalc;
     ;
     NULL, el99_38;
|FIN;

|PROCESO isocie38_99;
     aTipoCalc = "S";  |BUCLE isocie38_99;
     aTipoCalc = "N";  |BUCLE isocie38_99;
|FPRC;

|PROCESO el99_09;
     |SI nTotalDec = 0; |ACABA; |FINSI;

     |SI #9#6 [ nTotalDec;
         nAplicar  = #9#6;
         nTotalDec = nTotalDec - #9#6;
     |SINO;
         nAplicar  = nTotalDec;
         nTotalDec = 0;
     |FINSI;

     nAgru    = 0;
     nConc    = 0;

     |SI #9#3 = 94;   nAgru = 6;  nConc = 1;  |FINSI;
     |SI #9#3 = 95;   nAgru = 6;  nConc = 2;  |FINSI;

     |SI nAgru = 0; |Y nConc = 0;  |ACABA;  |FINSI;

     #2#0 = nAgru;
     #2#1 = nConc;
     |LEE 040#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CogeNuevo;

     |DDEFECTO #70;
     #70#0  = #9#0;
     #70#1  = anyo;
     #70#2  = nLinea;
     #70#3  = #2#0;
     #70#4  = #2#2;
     #70#5  = #2#1;
     #70#6  = #2#3;
     #70#7  = #2#4;
     #70#8  = #2#5;
     #70#9  = #2#6;
     #70#10 = nAplicar;
     #70#11 = nAplicar;
     #70#12 = #9#4;
     |GRABA 020#70n;
     |LIBERA #70;
|FPRC;

|DEFBUCLE isocie09_99;
     #9#1;
     3, 7;
     empresa, nAnyoAnt, 001, nAnyoDed, aTipoCalc;
     empresa, nAnyoAnt, 999, nAnyoDed, aTipoCalc;
     be;
     NULL, el99_09;
|FIN;

|PROCESO isocie09_99;
     aTipoCalc = "S";  |BUCLE isocie09_99;
     aTipoCalc = "N";  |BUCLE isocie09_99;
|FPRC;

|PROCESO importa_99;
     nAnyoAnt = anyo - 1

     |ABRE #10;
     |ABRE #70;
     |ABRE #2;

     #10#0 = empresa;
     #10#1 = nAnyoAnt;
     |LEE 040#10=;
     |SI FSalida ! 0; |CIERRA #10; |ACABA; |FINSI;

     nAnyoDed = 94;
     |SI #10#010 ! 0; nTotalDec = #10#010; nTipoDec = 1; |HAZ isocie30_99; |FINSI;
     |SI #10#013 ! 0; nTotalDec = #10#013; nTipoDec = 2; |HAZ isocie30_99; |FINSI;
     |SI #10#016 ! 0; nTotalDec = #10#016; nTipoDec = 3; |HAZ isocie30_99; |FINSI;

     nAnyoDed = 95;
     |SI #10#022 ! 0; nTotalDec = #10#022; nTipoDec = 1; |HAZ isocie30_99; |FINSI;
     |SI #10#025 ! 0; nTotalDec = #10#025; nTipoDec = 2; |HAZ isocie30_99; |FINSI;
     |SI #10#028 ! 0; nTotalDec = #10#028; nTipoDec = 3; |HAZ isocie30_99; |FINSI;

     nAnyoDed = 96;
     |SI #10#034 ! 0; nTotalDec = #10#034; nTipoDec = 4; |HAZ isocie30_99; |FINSI;
     |SI #10#049 ! 0; nTotalDec = #10#049; nTipoDec = 1; |HAZ isocie30_99; |FINSI;

     nAnyoDed = 97;
     |SI #10#052 ! 0; nTotalDec = #10#052; nTipoDec = 1; |HAZ isocie30_99; |FINSI;

     |SI #10#058 ! 0; nTotalDec = #10#058; aTipoDec   = "PM"; |HAZ isocie06_99; |FINSI;
     |SI #10#061 ! 0; nTotalDec = #10#061; aTipoDec   = "CE"; |HAZ isocie06_99; |FINSI;
     |SI #10#064 ! 0; nTotalDec = #10#064; aTipoDec   = "GI"; |HAZ isocie06_99; |FINSI;
     |SI #10#067 ! 0; nTotalDec = #10#067; aTipoDec   = "PC"; |HAZ isocie06_99; |FINSI;
     |SI #10#070 ! 0; nTotalDec = #10#070; aTipoDec   = "BI"; |HAZ isocie06_99; |FINSI;
     |SI #10#073 ! 0; nTotalDec = #10#073; aTipoDec   = "AE"; |HAZ isocie06_99; |FINSI;
     |SI #10#076 ! 0; nTotalDec = #10#076; aTipoDec   = "FP"; |HAZ isocie06_99; |FINSI;
     |SI #10#079 ! 0; nTotalDec = #10#079; aTipoDec   = "EL"; |HAZ isocie06_99; |FINSI;
     |SI #10#082 ! 0; nTotalDec = #10#082; aTipoDec   = "SJ"; |HAZ isocie06_99; |FINSI;
     |SI #10#085 ! 0; nTotalDec = #10#085; aTipoDec   = "CC"; |HAZ isocie06_99; |FINSI;

     aTipoDec = "2";
     |SI #10#100 ! 0; nTotalDec = #10#100; nAnyoDed = 94; |HAZ isocie38_99; |FINSI;
     |SI #10#103 ! 0; nTotalDec = #10#103; nAnyoDed = 95; |HAZ isocie38_99; |FINSI;
     |SI #10#106 ! 0; nTotalDec = #10#106; nAnyoDed = 96; |HAZ isocie38_99; |FINSI;
     |SI #10#109 ! 0; nTotalDec = #10#109; nAnyoDed = 97; |HAZ isocie38_99; |FINSI;
     |SI #10#112 ! 0; nTotalDec = #10#112; nAnyoDed = 98; |HAZ isocie38_99; |FINSI;

     aTipoDec = "1";
     |SI #10#121 ! 0; nTotalDec = #10#121; nAnyoDed = 94; |HAZ isocie38_99; |FINSI;
     |SI #10#124 ! 0; nTotalDec = #10#124; nAnyoDed = 95; |HAZ isocie38_99; |FINSI;
     |SI #10#133 ! 0; nTotalDec = #10#133; nAnyoDed = 96; |HAZ isocie38_99; |FINSI;
     |SI #10#136 ! 0; nTotalDec = #10#136; nAnyoDed = 97; |HAZ isocie38_99; |FINSI;
     |SI #10#139 ! 0; nTotalDec = #10#139; nAnyoDed = 98; |HAZ isocie38_99; |FINSI;

     aTipoDec = "4";
     |SI #10#127 ! 0; nTotalDec = #10#127; nAnyoDed = 96; |HAZ isocie38_99; |FINSI;
     |SI #10#130 ! 0; nTotalDec = #10#130; nAnyoDed = 97; |HAZ isocie38_99; |FINSI;
     |SI #10#142 ! 0; nTotalDec = #10#142; nAnyoDed = 98; |HAZ isocie38_99; |FINSI;

     |SI #10#151 ! 0; nTotalDec = #10#151; nAnyoDed = 94; |HAZ isocie09_99; |FINSI;
     |SI #10#154 ! 0; nTotalDec = #10#154; nAnyoDed = 95; |HAZ isocie09_99; |FINSI;

     |CIERRA #2;
     |CIERRA #10;
     |CIERRA #70;

     eParametro = "FUERA99";
     |SUB_EJECUTA_NP "isz00006";
|FPRC;
