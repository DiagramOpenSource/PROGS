|FICHEROS;
     isom0001;
     isom0012;
     isom0509;

     maempr10;
|FIN;

|VARIABLES;
      nRango         = 0;
      nBotonSal      = 0;
      nBotonAnota    = -1;
      nTree          = 0;
      nHandle        = 0;
      nPanta         = 0;
      nBotonLabel    = 0;
      nVentana       = 0;
      nVent          = 0;
      nGrid          = 0;
      nModo          = 0;
      nLinea         = 0;
      nValor         = 0;
      nVal562        = 0;
      nVal1330       = 0;
      nLinGrav       = 0;

      aContenido     = "";
      aTexto         = "";
      aBase          = "";
      aAlfa          = "";
      aAbre          = "";
      aEsc1          = "";
      aEsc2          = "";
      aRetu          = "";
      aTecla         = "";
      aCasilla       = "";

     {-1}sTree       = 0;
     sT_nID          = 0;
     sT_nOper        = 0;
     sT_aData        = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &enEmpresa      = 0;
     &enAnyo         = 0;
     &enGravamen     = 0;
     &eaCasilla      = "";
     &eaTitCasilla   = "";
     &eaRutaOrigen   = "";
     &eaRutaDestino  = "";
     &eaFicheroTra   = "";
     &eaFicheroTxt   = "";
     &eaFicheroTgz   = "";
     &eaFicheroTar   = "";
     &eaOrigen       = "";
     &eaDestino      = "";
     &eaAlfa         = "";
     &eaTipoColor    = "";
     &eaColor        = "";
     &enModoConsulta = 0;
|FIN;

|PROCESO Tipo1;  |TIPO 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;  |O nModo = 3;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     |HAZ Tipo1;
|FPRC;

|PROCESO Tipo0C7m12;
     |SI #isom0012#8 = "     ";
         #isom0012#9 = 0;
         |PINTA #isom0012#9;
         |ACABA;
     |FINSI;

     |SI #isom0012#7 = 0;
         #isom0012#9 = #isom0012#5;
     |SINO;
         #isom0012#9 = (#isom0012#5 * ((nVal562 / nVal1330) / (#isom0012#7 / 100))) ! 2;
     |FINSI;

     |PINTA #isom0012#9;
|FPRC;

|PROCESO Tipo0C11m12;
     |SI #isom0012#8 = "     ";
         |SI #isom0012#11 > #isom0012#5;
             #isom0012#11 = #isom0012#5;
         |FINSI;
     |FINSI;

     |SI #isom0012#8 ! "     ";
         |SI #isom0012#11 > #isom0012#9;
             #isom0012#11 = #isom0012#9;
         |FINSI;
     |FINSI;

     |PINTA #isom0012#11;
|FPRC;

|PROCESO Totalm12;
     #isom0012#13 = 0;
     |SI #isom0012#12 = "     ";
         |PINTA #isom0012#13;
         |ACABA;
     |FINSI;

     |SI #isom0012#8 = "     ";
         #isom0012#13 = #isom0012#5 - #isom0012#11;
     |FINSI;

     |SI #isom0012#8 ! "     ";
         #isom0012#13 = #isom0012#9 - #isom0012#11;
     |FINSI;

     |PINTA #isom0012#13;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     #isom0509#0 = #isom0012#1;
     #isom0509#1 = #isom0012#2;
     |LEE 000#isom0509.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0509;  |FINSI;

     |SI #isom0509#8 ! "I";  |ACABA;  |FINSI;

     |GRABA 020#isom0012.a;
     |LIBERA #isom0012;

     nLinea = #isom0012#2;

     |HAZ TotalFich112;

     #isom0012#0 = #maempr10#0;
     #isom0012#1 = #maempr10#1;
     #isom0012#2 = nLinea;
     |LEE 101#isom0012.=;

     aAlfa = "|IDGRID";
     aAlfa = #isom0012#aAlfa#;
     nGrid = aAlfa;
     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |C_M #isom0012#5,  1, "N";
     |C_M #isom0012#7,  1, "N";
     |C_M #isom0012#9,  1, "N";
     |C_M #isom0012#11, 1, "N";

     #isom0509#0 = #isom0012#1;
     #isom0509#1 = #isom0012#2;
     |LEE 000#isom0509.=;
     |SI FSalida ! 0;  |DDEFECTO #isom0509;  |FINSI;

     |SI #isom0509#8 ! "I";  |ACABA;  |FINSI;

     |SI #isom0012#4  ! "     ";  |C_M #isom0012#5,  1, "S";  |FINSI;
     |SI #isom0012#6  ! "     ";  |C_M #isom0012#7,  1, "S";  |FINSI;
     |SI #isom0012#8  ! "     ";  |C_M #isom0012#9,  1, "S";  |FINSI;
     |SI #isom0012#10 ! "     ";  |C_M #isom0012#11, 1, "S";  |FINSI;
|FPRC;

|PROCESO Evento112;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#isom0012.=;
     |FINSI;
|FPRC;

|PROCESO isom0509;
     #isom0012#0  = #maempr10#0;
     #isom0012#1  = #isom0509#0;
     #isom0012#2  = #isom0509#1;
     |LEE 101#isom0012.=;
     |SI FSalida ! 0;
         |DDEFECTO #isom0012;
         #isom0012#0  = #maempr10#0;
         #isom0012#1  = #isom0509#0;
         #isom0012#2  = #isom0509#1;
         |GRABA 020#isom0012.b;
     |FINSI;

     #isom0012#3   = #isom0509#7;
     #isom0012#4   = #isom0509#2;
     #isom0012#6   = #isom0509#3;
     #isom0012#8   = #isom0509#4;
     #isom0012#10  = #isom0509#5;
     #isom0012#12  = #isom0509#6;

     eaTipoColor = #isom0509#9;
     |HAZ CogeColor;
     #isom0012#14  = eaColor;

     |GRABA 020#isom0012.a;
     |LIBERA #isom0012;
|FPRC;

|DEFBUCLE isom0509;
     #isom0509#1;
     ;
     #maempr10#1, 0000;
     #maempr10#1, 9999;
     ;
     NULL, isom0509;
|FIN;

|PROCESO MontaEstructura509;
     |BUCLE isom0509;
|FPRC;

|PROCESO isom0012;
     |SI #isom0012#5   ! 0;  |ACABA;  |FINSI;
     |SI #isom0012#7   ! 0;  |ACABA;  |FINSI;
     |SI #isom0012#9   ! 0;  |ACABA;  |FINSI;
     |SI #isom0012#11  ! 0;  |ACABA;  |FINSI;
     |SI #isom0012#13  ! 0;  |ACABA;  |FINSI;

     |BORRA 020#isom0012.a;
     |LIBERA #isom0012;
|FPRC;

|DEFBUCLE isom0012;
     #isom0012#1;
     ;
     #maempr10#0, #maempr10#1, 0000;
     #maempr10#0, #maempr10#1, 9999;
     be;
     NULL, isom0012;
|FIN;

|PROCESO BotonSalir;
     |PTEC 807;
|FPRC;

|PROCESO BotonAnota;
     |SI #isom0012#4 = "     ";  |ACABA;  |FINSI;

     eaCasilla    = #isom0012#4;     |QBF eaCasilla;
     eaTitCasilla = #isom0012#3;     |QBF eaTitCasilla;
     eaTitCasilla = eaTitCasilla + " Casilla: " + #isom0012#4;     |QBF eaTitCasilla;

     |SUB_EJECUTA "isom0499";
|FPRC;

|PROCESO Baja112;
     #isom0012#0  = #maempr10#0;
     #isom0012#1  = #maempr10#1;
     #isom0012#2  = 1;
|FPRC;

|PROCESO Alta112;
     #isom0012#0  = #maempr10#0;
     #isom0012#1  = #maempr10#1;
     #isom0012#2  = 9999;
|FPRC;

|PROGRAMA;
     |ABRE #maempr10;
     #maempr10#0 = enEmpresa;
     #maempr10#1 = enAnyo;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |CIERRA #maempr10;

     |HAZ MontaEstructura509;

     |ABRE #isom0001;
     |SELECT #2#isom0001;
     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#3 = "562";
     |LEE 000#isom0001.=;
     |SI FSalida = 0;
         nVal562 = #isom0001#5;
     |FINSI;

     #isom0001#0 = #maempr10#0;
     #isom0001#1 = #maempr10#1;
     #isom0001#3 = "1330";
     |LEE 000#isom0001.=;
     |SI FSalida = 0;
         nVal1330 = #isom0001#5;
     |FINSI;

     |SELECT #1#isom0001;
     |CIERRA #isom0001;

     enGravamen = ((nVal562 / nVal1330) * 100) ! 2;

     #isom0012#0 = #maempr10#0;
     #isom0012#1 = #maempr10#1;
     #isom0012#2 = 5;
     |LEE 000#isom0012.];

     |PINPA #0#isom0012;
     nPanta = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} sali&R", 3488, 3498, BotonSalir;
     nBotonSal = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}} a&Notaciones de la deducci¢n", 3302, 3420, BotonAnota;
     nBotonAnota = FSalida;

     |SI enModoConsulta = 0;
         nRango = 1 + 2 + 4 + 8 + 16 + 128 + 256;
     |SINO;
         nRango = 4 + 8 + 16 + 128 + 256;
     |FINSI;

     |LINEAL_SIMPLE #1#isom0012, nRango, 0502, 3498, Baja112, Alta112, Evento112;

     |FIN_CONTROL_WINDOWS nBotonSal;
     |FIN_CONTROL_WINDOWS nBotonAnota;

     |BUCLE isom0012;

     |PULSATECLA;
|FPRO;

|PROCESO Tipo80m12;  |TIPO 80;
     |ABRET #isom0012;
     |ABRET #isom0509;

     FSalida = 3499;
|FPRC;

|PROCESO Tipo90m12;  |TIPO 90;
     |CIERRAT #isom0012;
     |CIERRAT #isom0509;
|FPRC;
