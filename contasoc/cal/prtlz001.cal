|FICHEROS;
     isacceso;
     isom9000;
     maempr01;
     zregdocu;

     :integral/dsam0000;
     :integral/dsam0009;
     :basica/agitab99;
     :dsarchi/prtlm001;
     :dsarchi/dsarm005;
|FIN;

|VARIABLES;
     nDia                = 0;
     nPer                = 0;
     nAny                = 0;
     nCont               = 0;
     nFam                = 0;
     nGad                = 0;

     aAlfa               = "";
     aDia                = "";
     aHora               = "";
     aPer                = "";

     fFec                = @;
     fFecDia             = @;

     &enModelo           = 0;
     &enFormaPag         = 0;
     &eaIBAN             = "";
     &eaVerde            = "0,185,0;255,255,255                     ";
|FIN;

|PROCESO Tipo15Fm5;
|FPRC;

|PROCESO Tipo16Fm5;
|FPRC;

|PROCESO Tipo17Fm5;
|FPRC;

|PROCESO LeeModelo;
     #agitab99#0 = enModelo;
     |LEE 000#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;
|FPRC;

|PROCESO DatosBancos;
     enFormaPag = 0;
     eaIBAN     = "";

     #dsam0009#0 = #dsam0000#0;
     #dsam0009#1 = enModelo;
     |LEE 040#dsam0009.=;
     |SI FSalida = 0;
         |SI #dsam0009#9 = 1;  |O #dsam0009#8 = "          ";
             enFormaPag = 1;
         |SINO;
             enFormaPag = #dsam0009#9;
             eaIBAN     = #dsam0009#12;
         |FINSI;

         |ACABA;
     |FINSI;

     #dsam0009#0 = #dsam0000#0;
     #dsam0009#1 = 999;
     |LEE 040#dsam0009.=;
     |SI FSalida = 0;
         |SI #dsam0009#9 = 1;  |O #dsam0009#8 = "          ";
             enFormaPag = 1;
         |SINO;
             enFormaPag = #dsam0009#9;
             eaIBAN    = #dsam0009#12;
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #dsam0000#104 = 1;  |O #dsam0000#93 = "          ";
         enFormaPag = #dsam0000#104;
     |SINO;
         enFormaPag = #dsam0000#104;
         eaIBAN     = #dsam0000#116;
     |FINSI;
|FPRC;

|PROCESO BuscaGad;
     nGad = 0;

     |SELECT #9#dsarm005;
     #dsarm005#8  = #prtlm001#0;
     #dsarm005#19 = #prtlm001#3;
     #dsarm005#17 = #prtlm001#1;
     #dsarm005#18 = #prtlm001#2;
     #dsarm005#20 = 0;
     #dsarm005#0  = 1;
     |LEE 000#dsarm005.];
     |SI FSalida      ! 0;            |ACABA;  |FINSI;
     |SI #dsarm005#8  ! #prtlm001#0;  |ACABA;  |FINSI;
     |SI #dsarm005#19 ! #prtlm001#3;  |ACABA;  |FINSI;
     |SI #dsarm005#17 ! #prtlm001#1;  |ACABA;  |FINSI;
     |SI #dsarm005#18 ! #prtlm001#2;  |ACABA;  |FINSI;

     nGad = 1;
|FPRC;

|PROCESO Venci200;
     #maempr01#0 = #prtlm001#0;
     #maempr01#1 = #prtlm001#1;
     |LEE 000#maempr01.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #maempr01#32 = "          ";
         |ACABA;
     |FINSI;

     fFec = #maempr01#32;
     nPer = 25.006000;
     fFec = fFec + nPer;

     fFecDia = fFec % 1;
     aDia    = (fFecDia % 1109) > " ";   |QBF aDia;

     |SI aDia = "SABADO";
         fFec = fFec + 2;
     |FINSI;

     |SI aDia = "DOMINGO";
         fFec = fFec + 1;
     |FINSI;

     #prtlm001#9  = fFec;
|FPRC;

|PROCESO isacceso;
     |DDEFECTO #prtlm001;

     #dsam0000#0  = #isacceso#0;
     |LEE 000#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

     #prtlm001#0  = #isacceso#0;
     #prtlm001#1  = #isacceso#1;
     #prtlm001#2  = 99;
     #prtlm001#3  = enModelo;
     #prtlm001#4  = "00";
     #prtlm001#5  = #isacceso#2;
     #prtlm001#6  = #agitab99#1;
     #prtlm001#7  = "ANUAL";

     |HAZ BuscaGad;

                    #prtlm001#8 = "E";
     |SI nGad = 1;  #prtlm001#8 = "A";  |FINSI;

     |HAZ Venci200;

     #prtlm001#10 = #isacceso#8;

     |HAZ DatosBancos;

     #prtlm001#11 = enFormaPag;
     #prtlm001#12 = eaIBAN;
     #prtlm001#13 = #dsam0000#18;
     #prtlm001#14 = #dsam0000#72;
     #prtlm001#15 = #dsam0000#52;
     #prtlm001#16 = "";
     #prtlm001#17 = ~;

     |HORA aHora;  #prtlm001#18 = aHora;

     #prtlm001#19 = "SOCIEDADES";

     |GRABA 000#prtlm001.n;
     |LIBERA #prtlm001;
|FPRC;

|DEFBUCLE isacceso;
     #isacceso#1;
     ;
     2017, 00001;
     9999, 99999;
     ;
     NULL, isacceso;
|FIN;

|PROCESO Venci202;
     |SI #isom9000#2 = "1P"; aAlfa = "20.04." + #isom9000#1;  |FINSI;
     |SI #isom9000#2 = "2P"; aAlfa = "20.10." + #isom9000#1;  |FINSI;
     |SI #isom9000#2 = "3P"; aAlfa = "20.12." + #isom9000#1;  |FINSI;

     fFec = aAlfa;

     fFecDia = fFec % 1;
     aDia    = (fFecDia % 1109) > " ";   |QBF aDia;

     |SI aDia = "SABADO";
         fFec = fFec + 2;
     |FINSI;

     |SI aDia = "DOMINGO";
         fFec = fFec + 1;
     |FINSI;

     #prtlm001#9  = fFec;
|FPRC;

|PROCESO isom9000;
     |DDEFECTO #prtlm001;

     #dsam0000#0  = #isom9000#0;
     |LEE 000#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

     aPer = #isom9000#2 % 101;

     #prtlm001#0  = #isom9000#0;
     #prtlm001#1  = #isom9000#1;
     #prtlm001#2  = aPer;
     #prtlm001#3  = enModelo;
     #prtlm001#4  = ("00" + #isom9000#3) % -102;
     #prtlm001#5  = #isom9000#5;
     #prtlm001#6  = #agitab99#1;

     |SI #isom9000#2 = "1P"; #prtlm001#7  = "1P (PRIMER PLAZO)";   |FINSI;
     |SI #isom9000#2 = "2P"; #prtlm001#7  = "2P (SEGUNDO PLAZO)";  |FINSI;
     |SI #isom9000#2 = "3P"; #prtlm001#7  = "3P (TERCER PLAZO)";   |FINSI;

     |HAZ BuscaGad;

                    #prtlm001#8 = "E";
     |SI nGad = 1;  #prtlm001#8 = "A";  |FINSI;

     |HAZ Venci202;

     |SI #isom9000#6 = "A ";
         #prtlm001#10 = #isom9000#14;
     |SINO;
         #prtlm001#10 = #isom9000#34;
     |FINSI;

     |HAZ DatosBancos;

     #prtlm001#11 = enFormaPag;
     #prtlm001#12 = eaIBAN;
     #prtlm001#13 = #dsam0000#18;
     #prtlm001#14 = #dsam0000#72;
     #prtlm001#15 = #dsam0000#52;
     #prtlm001#16 = "";
     #prtlm001#17 = ~;

     |HORA aHora;  #prtlm001#18 = aHora;

     #prtlm001#19 = "SOCIEDADES";

     |GRABA 000#prtlm001.n;
     |LIBERA #prtlm001;
|FPRC;

|DEFBUCLE isom9000;
     #isom9000#2;
     ;
     2017, "  ", 00, 00001;
     9999, "zz", 99, 99999;
     ;
     NULL, isom9000;
|FIN;

|PROCESO zregdocu;
     |DDEFECTO #prtlm001;

     #dsam0000#0  = #zregdocu#0;
     |LEE 000#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

     aPer = #isom9000#2 % 101;

     #prtlm001#0  = #zregdocu#0;
     #prtlm001#1  = #zregdocu#1;
     #prtlm001#2  = 99;
     #prtlm001#3  = enModelo;
     #prtlm001#4  = "";
     #prtlm001#5  = #zregdocu#2;
     #prtlm001#6  = #agitab99#1;
     #prtlm001#7  = "ANUAL";

                                  #prtlm001#8 = " ";
     |SI #zregdocu#79 = eaVerde;  #prtlm001#8 = "E";  |FINSI;

     |HAZ Venci200;

     #prtlm001#10 = 0;
     #prtlm001#11 = 0;
     #prtlm001#12 = "";
     #prtlm001#13 = #dsam0000#18;
     #prtlm001#14 = #dsam0000#72;
     #prtlm001#15 = #dsam0000#52;
     #prtlm001#16 = "";
     #prtlm001#17 = ~;

     |HORA aHora;  #prtlm001#18 = aHora;

     #prtlm001#19 = "SOCIEDADES";

     |GRABA 000#prtlm001.n;
     |LIBERA #prtlm001;
|FPRC;

|DEFBUCLE zregdocu;
     #zregdocu#1;
     ;
     00000, 2017;
     99999, 9999;
     ;
     NULL, zregdocu;
|FIN;

|PROGRAMA;
     enModelo = 200;  |HAZ LeeModelo;
     |BUCLE isacceso;

     enModelo = 202;  |HAZ LeeModelo;
     |BUCLE isom9000;

     enModelo = 909;  |HAZ LeeModelo;
     |BUCLE zregdocu;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |ABRET #maempr01;
     |ABRET #prtlm001;
     |ABRET #dsam0000;
     |ABRET #dsam0009;
     |ABRET #agitab99;
     |ABRET #dsarm005;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #maempr01;
     |CIERRAT #prtlm001;
     |CIERRAT #dsam0000;
     |CIERRAT #dsam0009;
     |CIERRAT #agitab99;
     |CIERRAT #dsarm005;
|FPRC;
