|FICHEROS;
   cubal801 #0;
   imagen@  #900;
   :/contagen/def/ca8m0001 #421;
|FIN;

|VARIABLES;
   &empresa = 0;
   &anyo    = 0;
   &nombre  = "";
   &nif     = "";
   &tipo    = "";
   &unid    = "";
   &modo    = 0;
   &sw_mod  = 0;
   anyo1    = 0;
   anyo2    = 0;

   nLinea  = 0;
   activo  = 0;
   activ1  = 0;
   pasivo  = 0;
   pasiv1  = 0;
   aMas    = "";
   aDef    = "";

   nCampo2 = 0;
   aCampo3 = "";
   nCampo4 = 0;
   nCampo5 = 0;
   nCampo6 = 0;
   nCampo7 = 0;
   nCampo8 = 0;
   aAlfa1  = "";
   nInkey  = 0;
|FIN;

|INCLUYE varbal_i;

|PROCESO LeoNota;
 |ABRE #421;
 |DDEFECTO #421;
 #421#14 = enEjerBal;
 #421#0  = nBalNum;
 #421#1  = nBalance;
 #421#2  = #0#9;
 #421#3  = #0#10;
 #421#4  = #0#11;
 #421#5  = #0#12;
 #421#6  = #0#13;
 #421#7  = #0#14;
 #421#10 = #0#15;
 |LEE 040#421=;
 |CIERRA #421;

 #0#16 = #421#11;
 #0#17 = #421#12;
 #0#5  = #421#13; |PINTA #0#5;
|FPRC;

|PROCESO Nota1; TIPO 0;
 |SI FSalida = 10;
     |HAZ LeoNota;
 |FINSI;
 aAlfa1 = #0#5 % 105;
 #0#5 = aAlfa1;
|FPRC;

|PROCESO Tipo7_1;  |TIPO 7;
    aAlfa1 = "     Pulse <F2> para Introducir Notas, <F3> Recoger Notas Memoria";
    |SI enModBal = 1; |Y #0#8 = "C";
        aAlfa1 = "     Pulse <F2> para Introducir Importe y Notas, <F3> Recoger Notas";
    |FINSI;
    |SI modo = 4; aAlfa1 = "     "; |FINSI;
    |MENSA aAlfa1;
|FPRC;

|PROCESO Tipo11_1;  |TIPO 11;
    nInkey = FSalida;
    |SI nInkey ! 10;  |Y nInkey ! 11; |ACABA; |FINSI;
    |SI modo     = 4;   |ACABA; |FINSI;

    |LEE 101#0=;

    |SI nInkey = 10;
        |ENCAMPO #5#0;

        |SI enModBal = 1; |Y #0#8 = "C";
            |ENCAMPO #7#0;
            |SI sw_mod = 0; |ENCAMPO #6#0; |FINSI;
        |FINSI;
    |FINSI;
    |SI nInkey = 11;
        |HAZ LeoNota;
    |FINSI;

    |GRABA 020#0a;
    |LIBERA #0;

    |SALVA_DATOS #0;

    |SI enModBal = 1; |Y #0#8 = "C"; |Y nInkey = 10;
        |HAZ Totales_1;
    |FINSI;

    |REPON_DATOS #0;

    |PONCONTROL 23, "SI";
|FPRC;

|PROCESO Inferior0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 0001;
|FPRC;

|PROCESO Superior0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 9999;
|FPRC;

|PROGRAMA;
 |DBASS aMas;
 aDef = aMas + "contasoc/def/cubal801";
 |CARGA_DEF aDef, imagen@;
 |SI FSalida ! 0; |ACABA; |FINSI;

 nBalance = 0; ||Balance de Situacion
 |PINPA #0#0;
 |HAZ pintaany;

 |HAZ pidedato;

 |ENTLINEAL #1#0, -3, 4, 21, 0, Inferior0, Superior0;

 |DESCARGA_DEF #900;
|FPRO;

|PROCESO pidedato;
 |ABRE #0;
 #0#0 = empresa;
 #0#1 = anyo;
 #0#2 = 0000;
 |LEE 001#0];
 |SI FSalida ! 0; |O #0#0 ! empresa; |O #0#1 ! anyo;
     |CIERRA #0;
     |HAZ eCrearVacio;
     |ACABA;
 |FINSI;
 |CIERRA #0;
|FPRC;


|PROCESO pintaany;
 anyo2 = anyo - 1;
 anyo1 = anyo;
 |ATRI P; |PINTA 962, anyo1;
 |PINTA 975, anyo2; |ATRI 0;
|FPRC;

|PROCESO Tipo5_1;  |TIPO 5;
   ||    |LEE 040#0p;
   ||    #0#4 = "N";
   ||    |LINEAS_BI_ATRI #0#4, D, S, -1;
|FPRC;

|| ********************************************************************

|PROCESO LeeCas801;  ||Carga Trabajo de Cuentas
  #0#0  = empresa;
  #0#1  = anyo;
  #0#9  = nCampo2;
  #0#10 = aCampo3;
  #0#11 = nCampo4;
  #0#12 = nCampo5;
  #0#13 = nCampo6;
  #0#14 = nCampo7;
  #0#15 = nCampo8;
  |LEE 101#0=;
  |SI FSalida = 0; |Y #0#8 ! "A";
      #0#7 = #0#7 + #900#7;
      |SI sw_mod = 0; #0#6 = #0#6 + #900#6; |FINSI;
      |GRABA 020#0a;
  |FINSI;
  |LIBERA #0;
|FPRC;

|PROCESO ASumar801;
  nCampo2 = #900#9;
  aCampo3 = #900#10;
  nCampo4 = #900#11;
  nCampo5 = #900#12;
  nCampo6 = #900#13;
  nCampo7 = #900#14;
  nCampo8 = #900#15;

  |SI nCampo8 ! 0;    ||Subpartida (A/P = 0)
      nCampo8 = 0;
      |HAZ LeeCas801;
  |FINSI;

  |SI nCampo7 ! 0;   ||Partida
      nCampo8 = 0;
      nCampo7 = 0;
      |HAZ LeeCas801;
  |FINSI;

  |SI nCampo6 ! 0;   ||Epigrafe
      nCampo8 = 0;
      nCampo7 = 0;
      nCampo6 = 0;
      |HAZ LeeCas801;
  |FINSI;

  |SI nCampo5 ! 0;  ||Subagrupacion
      nCampo8 = 0;
      nCampo7 = 0;
      nCampo6 = 0;
      nCampo5 = 0;
      |HAZ LeeCas801;
  |FINSI;

  |SI nCampo4 ! 0;  ||Agrupacion
      nCampo8 = 0;
      nCampo7 = 0;
      nCampo6 = 0;
      nCampo5 = 0;
      nCampo4 = 0;
      |HAZ LeeCas801;
  |FINSI;

  |SI aCampo3 = "A";
      activ1 = (activ1 + #900#6) ! 2;
      activo = (activo + #900#7) ! 2;
  |SINO;
      pasiv1 = (pasiv1 + #900#6) ! 2;
      pasivo = (pasivo + #900#7) ! 2;
  |FINSI;
|FPRC;

|PROCESO Final1;
  || Total Activo
  #0#0  = empresa;
  #0#1  = anyo;
  #0#9  = 0;
  #0#10 = "A";
  #0#11 = 99;
  #0#12 = 0;
  #0#13 = 0;
  #0#14 = 0;
  #0#15 = 0;
  |LEE 101#0=;
  |SI FSalida = 0;
      #0#7 = activo;
      |SI sw_mod = 0; #0#6 = activ1; |FINSI;
      |GRABA 020#0a;
  |FINSI;
  |LIBERA #0;

  || Total Activo
  #0#0  = empresa;
  #0#1  = anyo;
  #0#9  = 0;
  #0#10 = "P";
  #0#11 = 99;
  #0#12 = 0;
  #0#13 = 0;
  #0#14 = 0;
  #0#15 = 0;
  |LEE 101#0=;
  |SI FSalida = 0;
      #0#7 = pasivo;
      |SI sw_mod = 0; #0#6 = pasiv1; |FINSI;
      |GRABA 020#0a;
  |FINSI;
  |LIBERA #0;
|FPRC;

|DEFBUCLE ASumar801;
 #900#1003;
 8;
 empresa, anyo, 0001, "C";
 empresa, anyo, 9999, "C";
 be;
 NULL, ASumar801;
|FIN;

|PROCESO ACero801;
  |SI #900#8 ! "C";
      #900#7 = 0;
      |SI sw_mod = 0; #900#6 = 0; |FINSI;
      |GRABA 020#900a;
  |FINSI;
  |LIBERA #900;
|FPRC;

|DEFBUCLE ACero801;
 #900#1003;
 ;
 empresa, anyo, 0001;
 empresa, anyo, 9999;
 be;
 NULL, ACero801;
|FIN;

|PROCESO Totales_1;

  |BUCLE ACero801;

  activo  = 0; pasivo  = 0;
  activ1  = 0; pasiv1  = 0;

  |SELECT #2#0;
  |BUCLE ASumar801;
  |HAZ Final1;
  |SELECT #1#0;
|FPRC;
