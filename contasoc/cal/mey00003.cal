|FICHEROS;
     mey00003 #0;
     maacceso #1;
     isocie58 #2;
     isocie59 #3;
     isom0003 #4;
     sodacuen #8;
     isom0000 #600;

     :/basica/def/agim0019 #19;
     :/integral/def/dsam0001 #10;
     isw00101 #901;
|FIN;

|VARIABLES;
     nAnyo     = 0;
     nSwHay    = 0;
     nHandle   = 0;
     nBoton1   = 0;
     nBoton2   = 0;
     nBoton3   = 0;
     nBoton4   = 0;

     aAlfa     = "";
     aFichero  = "";

     &efFecha  = @;
     fFecha    = @;
     nRegis    = 0;
     nExiste   = 0;
     fFecIni   = @;
     fFecFin   = @;
     informe   = "";
     inform1   = "";
     inform2   = "";
     nExis     = 0;
     nImporte  = 0;

     &enPlan = 0;
     &eaCuenta = "";
     &salidas  = 0;
     &emCta    = 0;
|FIN;

|| /////////////////////////////////////////////////////////////////////////
|PROCESO cuen66; |TIPO 66;
|FPRC;

|PROCESO min8;
 #8#0 = "            ";
 #8#2 = enPlan;
|FPRC;

|PROCESO max8;
 #8#0 = "zzzzzzzzzzzz";
 #8#2 = enPlan;
|FPRC;

|CALCULO ConsultaCta; |TIPO 0;
   |SI FSalida = 10;
      |ABRE #8;
      #8#0 = #0#10;
      |CONSULTA_F_CLAVE #1#8, min8, max8;
      #0#10  = #8#0; |PINTA #0#10;
      |CIERRA #8;
      |ERROR;
      |ACABA;
   |FINSI;

   |SI FSalida = 20;
      emCta = 1;        || Dar mensajes de error
      eaCuenta = #0#10;
      salidas  = FSalida;
      |HAZ FiltraPuntos;
      #0#10 = eaCuenta;
      |PINTA #0#10;

      emCta = 0;        || Dar mensajes de error
      |HAZ SacaNivel;
  |FINSI;
|FCAL;

|| /////////////////////////////////////////////////////////////////////////
|PROCESO BuscoRegistro;
 || Lee Ficha Sociedades
  |SI #19#55 > "01.01.1900";
      |SI #19#55 < fFecIni;
          |ACABA;
      |FINSI;
  |SINO;
      |SI #19#7 > fFecFin;
          |ACABA;
      |FINSI;
  |FINSI;
  nRegis = #19#1;  ||Registre
  nExiste = 1;
  |ERROR10;
|FPRC;

|DEFBUCLE BuscoRegistro;
 #19#2;
 ;
 #1#0,99;
 #1#0,01;
 e;
 NULL, BuscoRegistro;
|FIN;

|PROCESO GrabaTempo;

     nExiste = 0;
     nRegis  = 0;
     |BUCLE BuscoRegistro;
     |SI nRegis = 0; |ACABA; |FINSI;

     |SI nAnyo < 2008;
         |DDEFECTO #3;
         #3#0 = #1#0;
         #3#1 = nAnyo;
         |LEE 040#3=;
         nImporte = #3#2;
     |SINO;
         |DDEFECTO #4;
         |SELECT #2#4;
         #4#0 = #1#0;
         #4#1 = nAnyo;
         #4#3 = 500;
         |LEE 040#4=;
         nImporte = #4#5;
         |SELECT #1#4;
     |FINSI;

     #0#0 = #1#0;
     #0#1 = #1#2;
     #0#2 = #1#1;
     #0#3 = "N";
     #0#4 = #1#3;
     #0#5 = #10#1;
     #0#6 = #10#2;
     aAlfa = #10#3;                 |QBF aAlfa;
     aAlfa = aAlfa + " " + #10#4;   |QBF aAlfa;
     aAlfa = aAlfa + " (" + #10#5;  |QBF aAlfa;
     aAlfa = aAlfa + ")";           |QBF aAlfa;
     #0#7  = aAlfa;
     #0#8 = #10#6;
     #0#9 = nImporte;
     |GRABA 020#0n;
     |LIBERA #0;

     nSwHay = 1;
|FPRC;

|DEFBUCLE maacceso;
     #1#1;
     ;
     00000, nAnyo;
     99999, nAnyo;
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja0;
     #0#0 = 1;
|FRUT;

|RUTINA ClaveAlta0;
     #0#0 = 99999;
|FRUT;

|PROCESO PonActivado;
     #0#3 = aAlfa;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE mey00003P;
     #0#1;
     ;
     00000;
     99999;
     be;
     NULL, PonActivado;
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         aAlfa = "S";
         |BUCLE mey00003P;
         |PONCONTROL  23, "SI";
         |PTEC 812;
     |FINSI;

     |SI FSalida = 11;
         aAlfa = "N";
         |BUCLE mey00003P;
         |PONCONTROL  23, "SI";
         |PTEC 812;
     |FINSI;

     |SI FSalida = 12;
         |LEE 101#0=;

         #0#3 = "S";
         |GRABA 020#0a;
         |LIBERA #0;
         |PINTA #0#3;
         |PTEC 809;
     |FINSI;

     |SI FSalida = 13;
         |LEE 101#0=;

         #0#3 = "N";
         |GRABA 020#0a;
         |LIBERA #0;
         |PINTA #0#3;
         |PTEC 809;
     |FINSI;
|FPRC;

|PROCESO Boton141;
     |PTEC 824;
|FPRC;

|PROCESO Boton142;
     |PTEC 825;
|FPRC;

|PROCESO Boton143;
     |PTEC 826;
|FPRC;

|PROCESO Boton144;
     |PTEC 827;
|FPRC;

|PROCESO PonBoton;
     |CONTROL_SIMPLE 0, "BOTON,F2 Activo Todos", 0805, 0820, Boton141;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F3 Desactivo Todos", 0822, 0839, Boton142;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F4 Activo Linea", 0841, 0856, Boton143;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F5 Desactivo Linea", 0858, 0876, Boton144;
     nBoton4 = FSalida;
|FPRC;

|PROCESO QuitaBoton;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
|FPRC;

|PROCESO ImprimeCarta;

     nExis = 0;
     |SI nAnyo < 2008;
         #2#0 = #0#0;
         #2#1 = #0#2;
         |LEE 040#2=;
         |SI FSalida ! 0; nExis = 1;|DDEFECTO #2; |FINSI;
     |SINO;
         #600#0 = #0#0;
         #600#1 = #0#2;
         |LEE 040#600=;
         |SI FSalida ! 0;  nExis = 1; |DDEFECTO #600;  |FINSI;
         |DDEFECTO #901;
         #901#3 = #600#84;
         #901#4 = #600#85;
         #901#5 = #600#86;
         #901#6 = #600#87;
         #901#7 = #600#88;

         #901#10 = #600#89;
         #901#11 = #600#90;
         #901#12 = #600#91;
         #901#13 = #600#92;
         #901#14 = #600#93;
         #901#15 = #600#94;
         #901#16 = #600#95;
         #901#17 = #600#96;
         #901#18 = #600#97;
         #901#19 = #600#98;
         #901#20 = #600#99;
         #901#21 = #600#100;
         #901#22 = #600#101;
         #901#23 = #600#102;
         #901#24 = #600#103;
         #901#25 = #600#104;
         #901#26 = #600#105;
     |FINSI;

     |SI #0#9 = 0;
         nExis = 1;
     |FINSI;

     |SI #0#9 < 0;
         informe = inform2;
         nExis = 0;
         |DDEFECTO #901;
         #901#3  = -#0#9;
         #901#10 = -#0#9;
     |SINO;
         informe = inform1;
     |FINSI;

     |SI nExis = 0;
         |INFOR informe;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         |PRINT;
         |PIEINF;
         |FININF;
     |FINSI;
|FPRC;

|DEFBUCLE mey00003;
     #0#1;
     3;
     00001, "S";
     99999, "S";
     ;
     NULL, ImprimeCarta;
|FIN;

|PROGRAMA;
     |HAZ BusquedaApli;
     fFecha = ~;
     aAlfa = fFecha;
     aAlfa = aAlfa % -104;

     |CLS;
     |CABEZA "Distribucion de Resultados";
     |PINPA #0#0;
     nAnyo = aAlfa;
     nAnyo = nAnyo - 1;
     E_inf = "1900";
     E_sup = "2999";
     nAnyo = 0609 ? 1;

     aAlfa = nAnyo; aAlfa = "01.01." + aAlfa; fFecIni = aAlfa;
     aAlfa = nAnyo; aAlfa = "31.12." + aAlfa; fFecFin = aAlfa;
     aAlfa = nAnyo; aAlfa = "12100000" + aAlfa;
     #0#10 = aAlfa; |PINTA #0#10;

     enPlan = 2008;
     |SI nAnyo < 2008; enPlan = 1990; |FINSI;

     efFecha = ~;
     E_inf   = "";
     E_sup   = "10";
     efFecha = 0631 ? 1;

     |C_M #0#10,1,"S";
     |ENCAMPO #10#0;
     |C_M #0#10,1,"N";

     aFichero = ("003" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #0 aFichero;
     |ABRE #0;  |CIERRA #0;  |DELINDEX #0;

     |ABRE #10;
     |LEE 040#10p;
     |SI FSalida ! 0;  |DDEFECTO #10;  |FINSI;
     |CIERRA #10;

     |ABRE #0;
     |ABRE #3;
     |ABRE #4;
     |BUCLE maacceso;
     |CIERRA #4;
     |CIERRA #3;
     |CIERRA #0;

     |SI nSwHay = 0;
         |MENAV "      Seleccion Vacia ... ";
         |ABRE #0;  |CIERRA #0;  |DELINDEX #0;
         |ACABA;
     |FINSI;

     |HAZ PonBoton;
     |ENTLINEAL #1#0, -1, 4, 22, 0, ClaveBaja0, ClaveAlta0;
     |HAZ QuitaBoton;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI nAnyo < 2008;
         inform1 = "mey00003";
         inform2 = "mey00003";
     |SINO;
         inform1 = "mey10003";
         inform2 = "mey20003";
     |FINSI;

     |ABRE #2;
     |ABRE #600;
     |BUCLE mey00003;
     |CIERRA #600;
     |CIERRA #2;

     |FINIMP;
|FPRO;
