|FICHEROS;
   xxx00014 #0;
   xxx00015 #2;
|FIN;

|VARIABLES;
    &empresa   = 0;
    &anyo      = 0;
    &modo      = 0;
    &EURODB    = 0;

    FEstado  = 0;
    varcamp  = 0;
    x        = 0;
    tecla_p  = "";
    avance   = "815";
    atras    = "814";
    var_ant  = 0;
    var_pen  = 0;
    campillo = 0;
    trab1    = 0;
    trab2    = 0;
    trab3    = 0;
    acum1    = 0;
    acum2    = 0;
    n1       = 0;
    n4       = 0;
    n2       = 0;
    n3       = 0;
    rest     = 0;
    var      = 0;
|FIN;

|PROGRAMA;
|HAZ LeeEURODB;

|ABRE #0;
|PINPA #0#0;
|SI modo = 1; |O modo = 2; |HAZ pidedato; |FINSI;
|SI modo = 4; |HAZ consulta; |FINSI;
|CIERRA #0;
|FPRO;

|PROCESO pidedato;
#0#0  = empresa;
#0#1 = anyo;
|LEE 110#0=;
FEstado = FSalida;
|SI FEstado ! 0; |DDEFECTO #0; #0#0 = empresa; #0#1 = anyo; |FINSI;

|CONFI "2421NDesea hacer el calculo de las deducciones : ";
|SI FSalida = 0; |HAZ ajustando; |FINSI;

|PINDA #0#0;
|SI modo = 1; |ENDATOS #1#0;  |FINSI;
|SI modo = 2; |ENDATOS #2#0;  |FINSI;
|SI FSalida = 0;
    #0#0  = empresa;
    #0#1 = anyo;
    |SI FEstado = 0; |GRABA 020#0a; |SINO; |GRABA 020#0n; |FINSI;
    |LIBERA #0;
    |CIERRA #0;

    |HAZ graba_liq;
|FINSI;
|FPRC;

|PROCESO consulta;
  avance = &255 + avance;
  atras = &255 + atras;
  #0#0 = empresa;
  #0#1 = anyo;
  |LEE 040#0=;
  |SI FSalida = 0; |HAZ pantalla1; |FINSI;
|FPRC;

|PROCESO pantalla1;
  |PINPA #0#0;
  |PINDA #0#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = avance; |HAZ pantalla2; |ACABA; |FINSI;
|FPRC;

|PROCESO pantalla2;
  |PINPA #1#0;
  |PINDA #1#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = avance; |HAZ pantalla3; |ACABA; |FINSI;
  |SI tecla_p = atras;  |HAZ pantalla1; |ACABA; |FINSI;
|FPRC;

|PROCESO pantalla3;
  |PINPA #2#0;
  |PINDA #2#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = atras;  |HAZ pantalla2; |ACABA; |FINSI;
  |SI tecla_p = avance; |HAZ pantalla4; |ACABA; |FINSI;
|FPRC;

|PROCESO pantalla4;
  |PINPA #3#0;
  |PINDA #3#0;
  |MENSA "0411  Av.Pag.= Siguiente Pantalla  Re.Pag. = Pantalla Anterior";
  |LEETECLA tecla_p;
  |SI tecla_p = atras; |HAZ pantalla3; |ACABA; |FINSI;
|FPRC;

|PROCESO pendient;|TIPO 0;
var_ant = Campo - 42;
var_pen = Campo + 42;
#0var_pen = #0var_ant - #0Campo;

|PINTA #0var_pen;
|FPRC;

|PROCESO total; |TIPO 0;
#0#4  = #0#2  + #0#3;                                  |PINTA #0#4;
#0#9  = #0#5  + #0#6  + #0#7  + #0#8;                  |PINTA #0#9;
#0#16 = #0#10 + #0#11 + #0#12 + #0#13 + #0#14 + #0#15; |PINTA #0#16;
#0#17 = #0#4  + #0#9  + #0#16;                         |PINTA #0#17;
#0#24 = #0#18 + #0#19 + #0#20 + #0#21 + #0#22 + #0#23; |PINTA #0#24;
#0#29 = #0#25 + #0#26 + #0#27 + #0#28;                 |PINTA #0#29;
#0#34 = #0#30 + #0#31 + #0#32 + #0#33;                 |PINTA #0#34;
#0#37 = #0#35 + #0#36;                                 |PINTA #0#37;
#0#43 = #0#38 + #0#39 + #0#40 + #0#41 + #0#42;         |PINTA #0#43;

#0#46 = #0#44 + #0#45;                                 |PINTA #0#46;
#0#51 = #0#47 + #0#48 + #0#49 + #0#50;                 |PINTA #0#51;
#0#58 = #0#52 + #0#53 + #0#54 + #0#55 + #0#56 + #0#57; |PINTA #0#58;
#0#59 = #0#46 + #0#51 + #0#58;                         |PINTA #0#59;
#0#66 = #0#60 + #0#61 + #0#62 + #0#63 + #0#64 + #0#65; |PINTA #0#66;
#0#71 = #0#67 + #0#68 + #0#69 + #0#70;                 |PINTA #0#71;
#0#76 = #0#72 + #0#73 + #0#74 + #0#75;                 |PINTA #0#76;
#0#79 = #0#77 + #0#78;                                 |PINTA #0#79;
#0#85 = #0#80 + #0#81 + #0#82 + #0#83 + #0#84;         |PINTA #0#85;

#0#88  = #0#86 + #0#87;                                 |PINTA #0#88;
#0#93  = #0#89 + #0#90 + #0#91 + #0#92;                 |PINTA #0#93;
#0#100 = #0#94 + #0#95 + #0#96 + #0#97 + #0#98 + #0#99; |PINTA #0#100;
#0#101 = #0#88 + #0#93 + #0#100;                        |PINTA #0#101;
#0#108 = #0#102 + #0#103 + #0#104 + #0#105 + #0#106 + #0#107;
                                                        |PINTA #0#108;
#0#113 = #0#109 + #0#110 + #0#111 + #0#112;             |PINTA #0#113;
#0#118 = #0#114 + #0#115 + #0#116 + #0#117;             |PINTA #0#118;
#0#121 = #0#119 + #0#120;                               |PINTA #0#121;
#0#127 = #0#122 + #0#123 + #0#124 + #0#125 + #0#126;    |PINTA #0#127;

|FPRC;

|PROCESO graba_liq;
|ABRE #2;
#2#0 = #0#0;
#2#1 = #0#1;

|LIBERA #2;
|LEE 140#2=;
FEstado = FSalida;

|SI FSalida ! 0;
   |DDEFECTO #2;
   #2#0 = #0#0;
   #2#1 = #0#1;
|FINSI;

#2#25 = #0#59;
#2#26 = #0#66;
#2#28 = #0#71;
#2#29 = #0#76;
#2#30 = #0#79;
#2#31 = #0#85;

#2#5 = #2#2 + #2#3 - #2#4;          || Punto 729
#2#7 = #2#5 - #2#6;                 || Punto 731
|SI #2#8 ! 0;|O #2#9 ! 0;
    #2#11 = (#2#8 + #2#9) % #2#10;  || Punto 735
|SINO;
    #2#11 = #2#7 % #2#10;           || Punto 735
|FINSI;

#2#13 = #2#11 - #2#12;              || Punto 737
#2#18 = #2#13 - (#2#14 + #2#15 + #2#16 + #2#17);  || Punto 742
#2#23 = #2#18 - (#2#19 + #2#20 + #2#21 + #2#22);  || Punto 747
#2#32 = #2#23 - (#2#24 + #2#25 + #2#26 + #2#27 + #2#28 + #2#29 + #2#30 + #2#31);
#2#34 = #2#32 - #2#33;
#2#38 = #2#34 - (#2#35 + #2#36 + #2#37);
#2#43 = #2#38 + #2#39 + #2#40 - #2#41 + #2#42;

|SI FEstado = 0; |GRABA 141#2a; |SINO; |GRABA 141#2n; |FINSI;

|CIERRA #2;
|FPRC;

|PROCESO ajustando;
|ABRE #2;
#2#0 = #0#0;
#2#1 = #0#1;

|LEE 040#2=;
|SI FSalida ! 0; |DDEFECTO  #2; |FINSI;
|CIERRA #2;

trab1 = (#2#23 % 25) ! EURODB;
trab2 = (#2#23 % 20) ! EURODB;
trab3 = #2#23;
acum1 = 0; acum2 = 0;

n1 = 2;   n4 = trab1; |HAZ pepe;
n1 = 3;   n4 = trab1; |HAZ pepe;     || 1987

n1 = 5;   n4 = trab2; |HAZ pepe;
n1 = 6;   n4 = trab2; |HAZ pepe;
n1 = 25;  n4 = trab1; |HAZ pepe;     || 1988
n1 = 30;  n4 = trab1; |HAZ pepe;

n1 = 7;   n4 = trab2; |HAZ pepe;
n1 = 8;   n4 = trab2; |HAZ pepe;
n1 = 26;  n4 = trab1; |HAZ pepe;     || 1989
n1 = 31;  n4 = trab1; |HAZ pepe;

n1 = 10;  n4 = trab1; |HAZ pepe;
n1 = 11;  n4 = trab1; |HAZ pepe;
n1 = 12;  n4 = trab1; |HAZ pepe;
n1 = 13;  n4 = trab1; |HAZ pepe;
n1 = 14;  n4 = trab1; |HAZ pepe;     || 1990
n1 = 15;  n4 = trab1; |HAZ pepe;
n1 = 27;  n4 = trab1; |HAZ pepe;
n1 = 32;  n4 = trab1; |HAZ pepe;
n1 = 35;  n4 = trab1; |HAZ pepe;

n1 = 18;  n4 = trab1; |HAZ pepe;
n1 = 19;  n4 = trab1; |HAZ pepe;
n1 = 20;  n4 = trab1; |HAZ pepe;
n1 = 21;  n4 = trab1; |HAZ pepe;
n1 = 22;  n4 = trab1; |HAZ pepe;
n1 = 23;  n4 = trab1; |HAZ pepe;     ||  1991
n1 = 28;  n4 = trab1; |HAZ pepe;
n1 = 33;  n4 = trab1; |HAZ pepe;
n1 = 36;  n4 = trab1; |HAZ pepe;

n1 = 38;  n4 = trab3; |HAZ pepe2;
n1 = 39;  n4 = trab3; |HAZ pepe2;
n1 = 40;  n4 = trab3; |HAZ pepe2;
n1 = 41;  n4 = trab3; |HAZ pepe2;
n1 = 42;  n4 = trab3; |HAZ pepe2;

|HAZ total_00;
|FPRC;

|PROCESO pepe;
n2 = n1 + 42; n3 = n1 + 84;
#0n3 = #0n1; #0n2 = 0;
rest = n4 - acum1;
var = #2#23 - acum1;
|SI rest > var; rest = var; |FINSI;

|SI #0n1 ! 0; |Y rest > 0;
    |SI #0n1 ] rest;
        #0n2 = rest;
        #0n3 = #0n1 - #0n2;
        acum1 = acum1 + #0n2;
    |SINO;
        #0n2 = #0n1;
        #0n3 = 0;
        acum1 = acum1 + #0n1;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO pepe2;
n2 = n1 + 42; n3 = n1 + 84;
#0n3 = #0n1; #0n2 = 0;
rest = n4 - (acum2 + acum1);
|SI #0n1 ! 0; |Y rest > 0;
    |SI #0n1 ] rest;
        #0n2 = rest;
        #0n3 = #0n1 - #0n2;
        acum2 = acum2 + #0n2;
    |SINO;
        #0n2 = #0n1;
        #0n3 = 0;
        acum2 = acum2 + #0n1;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO total_00;
#0#4  = #0#2  + #0#3;
#0#9  = #0#5  + #0#6  + #0#7  + #0#8;
#0#16 = #0#10 + #0#11 + #0#12 + #0#13 + #0#14 + #0#15;
#0#17 = #0#4  + #0#9  + #0#16;
#0#24 = #0#18 + #0#19 + #0#20 + #0#21 + #0#22 + #0#23;
#0#29 = #0#25 + #0#26 + #0#27 + #0#28;
#0#34 = #0#30 + #0#31 + #0#32 + #0#33;
#0#37 = #0#35 + #0#36;
#0#43 = #0#38 + #0#39 + #0#40 + #0#41 + #0#42;

#0#46 = #0#44 + #0#45;
#0#51 = #0#47 + #0#48 + #0#49 + #0#50;
#0#58 = #0#52 + #0#53 + #0#54 + #0#55 + #0#56 + #0#57;
#0#59 = #0#46 + #0#51 + #0#58;
#0#66 = #0#60 + #0#61 + #0#62 + #0#63 + #0#64 + #0#65;
#0#71 = #0#67 + #0#68 + #0#69 + #0#70;
#0#76 = #0#72 + #0#73 + #0#74 + #0#75;
#0#79 = #0#77 + #0#78;
#0#85 = #0#80 + #0#81 + #0#82 + #0#83 + #0#84;

#0#88  = #0#86 + #0#87;
#0#93  = #0#89 + #0#90 + #0#91 + #0#92;
#0#100 = #0#94 + #0#95 + #0#96 + #0#97 + #0#98 + #0#99;
#0#101 = #0#88 + #0#93 + #0#100;
#0#108 = #0#102 + #0#103 + #0#104 + #0#105 + #0#106 + #0#107;

#0#113 = #0#109 + #0#110 + #0#111 + #0#112;
#0#118 = #0#114 + #0#115 + #0#116 + #0#117;
#0#121 = #0#119 + #0#120;
#0#127 = #0#122 + #0#123 + #0#124 + #0#125 + #0#126;
|FPRC;
