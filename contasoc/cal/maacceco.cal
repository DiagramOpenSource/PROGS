|FICHEROS;
     maacceco #0;   || Acceso al Impuesto
     maempr10 #1;   || Datos Empresas
     maempr02 #2;   || Relacion de Socios
     maempr03 #3;   || Relacion de Administradores
     maempr04 #4;   || Relacion de Representantes
     maempr05 #5;   || Transparencia Fiscal
     maempr06 #6;   || Participaciones otras empresas
     maempr11 #9;   || Caracteres declaracion
     maempr12 #10;  || Transparencia Fiscal Internacional Cabecera
     maempr13 #11;  || Transparencia Fiscal Internacional Lineas
     maempr14 #12;  || Operaciones Paraisos Fiscales
     maempr15 #13;  || Tenencias Paraisos Fiscales
     maempr17 #17;  || Fichero de Personal Asalariado
     maempr18 #18;  || Fichero de Operacion con personas o entidades vinculadas
     maempr19;
     maempr20;
     maempr21;
     maempr22;
     maempr23;
     maempr24;
     maempr25;

     :/basica/def/agim0028 #28;  || Ficha de Sociedades Cabeceras
     :/basica/def/agim0019 #19;  || Ficha de Sociedades Lineas
     :/basica/def/agim0020 #20;  || Caracteres de la Declaracion
     :/basica/def/agim0021 #21;  || Socios Transparencia Fiscal
     :/basica/def/agim0022 #22;  || Internacional C Transparencia Fiscal
     :/basica/def/agim0023 #23;  || Internacional L Transparencia Fiscal
     :/basica/def/agim0024 #24;  || Representantes/Administradores
     :/basica/def/agim0025 #25;  || Socios
     :/basica/def/agim0026 #26;  || Cargos
     :/basica/def/agim0027 #27;  || Participaciones otras empresas
     :/basica/def/agim0058 #58;

     isacceso;

     imagen@;

     &clientes@ #715;
|FIN;

|VARIABLES;
     swreg     = 0;
     sw        = 0;
     Punto1    = 0;
     SwOpcion1 = 0;
     fich      = "";
     provi     = "";
     SwTranspa = 0;
     nEstado   = 0;
     nLinea2   = 0;
     nLinea    = 0;
     nSw       = 0;
     nOpera    = 0;
     nOk       = 0;

     aste       = "";
     longi      = "";
     num        = 0;
     trabacod1  = "";
     trabacod2  = "";
     SwBorra    = 0;
     LineaRepre = 0;
     aAlfa      = "";
     nAnyo      = 0;
     nNume      = 0;

     aCampo16   = "";
     aCampo31   = "";
     aCampo32   = "";
     aCampo33   = "";

     aCampo83   = "";
     nCampo75   = 0;
     nCampo76   = 0;
     nCampo85   = 0;
     nCampo86   = 0;
     nCampo87   = 0;
     nCampo88   = 0;
     nCampo89   = 0;
     nCampo90   = 0;
     nCampo103  = 0;
     nCampo104  = 0;
     nCampo105  = 0;
     nCampo106  = 0;
     nCampo107  = 0;
     nCampo108  = 0;
     nCampo109  = 0;
     nCampo110  = 0;
     nCampo111  = 0;
     nCampo112  = 0;
     nDEmpresa  = 0;
     nHEmpresa  = 0;
     nValor     = 0;
     nHayAnt    = 0;
     nHayAct    = 0;
     nHayTitular= 0;

     aPath      = "";
     aMas       = "";
     nTPC       = 0;

     &enEmpresa = 0;
     &enAnyo    = 0;
     &enModo    = 0;
     &enModo1   = 0;
     &Registro  = 0;

     &empresa   = 0;
     &anyo      = 0;
     &nombre    = "";
     &nif       = "";
     &opcion    = 0;
     &modo      = 0;
     &sw_mod    = 0;

     &enCodCli    = 0;
     &enSwDeDonde = 0;
     &EURODB      = 0;

  {-1} _95Menu   = "";
     _95Menu1    = "1014";
     _95Menu2    = "1";
     _95Menu3    = "6";
     _95Menu4    = "Datos Generales                                      ";
     _95Menu5    = "Relacion de Socios                                   ";
     _95Menu6    = "Relacion Administradores                             ";
     _95Menu7    = "Relacion de Representantes                           ";
     _95Menu8    = "Transparencia Fiscal                                 ";
     _95Menu9    = "Participacion otras Empresas                         ";

  {-1} _96Menu   = "";
     _96Menu1    = "1014";
     _96Menu2    = "1";
     _96Menu3    = "11";
     _96Menu4    = "Datos Generales                                      ";
     _96Menu5    = "Caracteres Declaracion                               ";
     _96Menu6    = "Relacion de Socios                                   ";
     _96Menu7    = "Relacion Administradores                             ";
     _96Menu8    = "Relacion de Representantes                           ";
     _96Menu9    = "A.I.E., U.T.E. o Transparencia fiscal Internacional  ";
     _96Menu10   = "Participacion otras Empresas                         ";
     _96Menu11   = "Operaciones con personas o entidades vinculadas      ";
     _96Menu12   = "Operaciones con paises calificados para¡sos fiscales ";
     _96Menu13   = "Tenencias valores con paises calif.para¡sos fiscales ";

  {-1} _17Menu   = "";
       _17Menu1    = "1214";
       _17Menu2    = "1";
       _17Menu3    = "09";
       _17Menu4    = "Datos Generales                                      ";
       _17Menu5    = "Caracteres Declaracion                               ";
       _17Menu6    = "Relacion de Socios                                   ";
       _17Menu7    = "Relacion Administradores                             ";
       _17Menu8    = "Relacion de Representantes                           ";
       _17Menu9    = "A.I.E., U.T.E. o Transparencia fiscal Internacional  ";
       _17Menu10   = "Participacion otras Empresas                         ";
       _17Menu11   = "Operaciones vinculadas y para¡sos fiscales           ";
       _17Menu12   = "Identificacion del titular real                      ";

  {-1} _19Menu   = "";
       _19Menu1    = "1214";
       _19Menu2    = "1";
       _19Menu3    = "10";
       _19Menu4    = "Datos Generales                                      ";
       _19Menu5    = "Carácteres Declaración                               ";
       _19Menu6    = "Relación de Socios                                   ";
       _19Menu7    = "Relación Administradores                             ";
       _19Menu8    = "Relación de Representantes                           ";
       _19Menu9    = "A.I.E., U.T.E. o Transparencia fiscal Internacional  ";
       _19Menu10   = "Participación otras Empresas                         ";
       _19Menu11   = "Operaciones vinculadas y para¡sos fiscales           ";
       _19Menu12   = "Identificación del titular real                      ";
       _19Menu13   = "Información sobre prestación de servicios a terceros ";

  {-1} MenuTrans   = "";
     MenuTrans1    = "1844";
     MenuTrans2    = "1";
     MenuTrans3    = "2";
     MenuTrans4    = "Relacion de Socios";
     MenuTrans5    = "Internacional     ";

  {-1} MenuOpera  = "";
     MenuOpera1   = "1824";
     MenuOpera2   = "1";
     MenuOpera3   = "4";
     MenuOpera4   = "Op. personas/entidades vinculadas (a.13.4)   ";
     MenuOpera5   = "Op. personas/entidades vinculadas (a.23 DT20)";
     MenuOpera6   = "Op. con paises calificados para¡sos fiscales ";
     MenuOpera7   = "Ten.valores con paises cal.para¡sos fiscales ";

  {-1} MenuTitul  = "";
     MenuTitul1   = "1822";
     MenuTitul2   = "1";
     MenuTitul3   = "3";
     MenuTitul4   = "Persona f¡sica con una participacion superior al 25%";
     MenuTitul5   = "Persona f¡sica asimilada ";
     MenuTitul6   = "Detalle de sociedades intervinientes en la cadena de Control";

     &enCalcCif    = 0;
     &eaVarDni     = "";

     &noContinuar   = 0;
     &enError       = 0;
     &fFechaChequeo = @;
     &fFechaDisol   = @;
     fDFecha        = @;
     fHFecha        = @;
     aCampo11       = "";

     aDni22   = "";
     nLin22   = 0;
     nEstPr22 = 0;

     aDni02   = "";
     nLin02   = 0;
     nEstPr02 = 0;

|FIN;

|PROCESO LetraNif;  |TIPO 6;
   |SI FSalida = 10;
       enCalcCif = 1;
       eaVarDni  =  #0Campo;
       |HAZ CalculoDNI;
       #0Campo = eaVarDni;
       |PINTA #0Campo;
       |ERROR;
       |ACABA;
   |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "            ") % 112;
     |SI #0Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;


*************************
BORRADO FICHEROS ADJUNTOS
*************************

|PROCESO Borra02;
  |BORRA 020#2a;
  |LIBERA #2;
|FPRC;

|DEFBUCLE maempr02;
  #2#1;
  ;
  #0#0, #0#1, 001;
  #0#0, #0#1, 999;
  be;
  NULL, Borra02;
|FIN;

|PROCESO Borra03;
  |BORRA 020#3a;
  |LIBERA #3;
|FPRC;

|DEFBUCLE maempr03;
  #3#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, Borra03;
|FIN;

|PROCESO Borra04;
  |SI SwBorra = 0; |BORRA 020#4a;  |LIBERA #4; |ACABA; |FINSI;

  LineaRepre = LineaRepre + 1;
|FPRC;

|DEFBUCLE maempr04;
  #4#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, Borra04;
|FIN;

|PROCESO Borra05;
  |BORRA 020#5a;
  |LIBERA #5;
|FPRC;

|DEFBUCLE maempr05;
  #5#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, Borra05;
|FIN;

|PROCESO Borra06;
  |BORRA 020#6a;
  |LIBERA #6;
|FPRC;

|DEFBUCLE maempr06;
  #6#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, Borra06;
|FIN;

|PROCESO Borra9;
  |BORRA 020#9a;
  |LIBERA #9;
|FPRC;

|DEFBUCLE maempr11;
  #9#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, Borra9;
|FIN;

|PROCESO Borra10;
  |BORRA 020#10a;
  |LIBERA #10;
|FPRC;

|DEFBUCLE maempr12;
  #10#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, Borra10;
|FIN;

|PROCESO Borra11;
  |BORRA 020#11a;
  |LIBERA #11;
|FPRC;

|DEFBUCLE maempr13;
  #11#1;
  ;
  #0#0, #0#1, 01, 01;
  #0#0, #0#1, 99, 99;
  be;
  NULL, Borra11;
|FIN;

|PROCESO Borra12;
  |BORRA 020#12a;
  |LIBERA #12;
|FPRC;

|DEFBUCLE maempr14;
  #12#1;
  ;
  #0#0, #0#1, 00, 01;
  #0#0, #0#1, 99, 99;
  be;
  NULL, Borra12;
|FIN;

|PROCESO Borra13;
  |BORRA 020#13a;
  |LIBERA #13;
|FPRC;

|DEFBUCLE maempr15;
  #13#1;
  ;
  #0#0, #0#1, 00, 01;
  #0#0, #0#1, 99, 99;
  be;
  NULL, Borra13;
|FIN;

|PROCESO Borra18;
  |BORRA 020#18a;
  |LIBERA #18;
|FPRC;

|DEFBUCLE maempr18;
  #18#1;
  ;
  #0#0, #0#1, 00, 01;
  #0#0, #0#1, 99, 99;
  be;
  NULL, Borra18;
|FIN;

|PROCESO maempr19;
  |BORRA 020#maempr19.a;
  |LIBERA #maempr19;
|FPRC;

|DEFBUCLE maempr19;
  #maempr19#1;
  ;
  #0#0, #0#1, 00, 01;
  #0#0, #0#1, 99, 99;
  be;
  NULL, maempr19;
|FIN;

|PROCESO maempr20;
  |BORRA 020#maempr20.a;
  |LIBERA #maempr20;
|FPRC;

|DEFBUCLE maempr20;
  #maempr20#1;
  ;
  #0#0, #0#1, 00, 01, 01;
  #0#0, #0#1, 99, 99, 01;
  be;
  NULL, maempr20;
|FIN;

|PROCESO maempr21;
  |BORRA 020#maempr21.a;
  |LIBERA #maempr21;
|FPRC;

|DEFBUCLE maempr21;
  #maempr21#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, maempr21;
|FIN;

|PROCESO maempr22;
  |BORRA 020#maempr22.a;
  |LIBERA #maempr22;
|FPRC;

|DEFBUCLE maempr22;
  #maempr22#1;
  ;
  #0#0, #0#1, 001;
  #0#0, #0#1, 999;
  be;
  NULL, maempr22;
|FIN;

|PROCESO maempr23;
  |BORRA 020#maempr23.a;
  |LIBERA #maempr23;
|FPRC;

|DEFBUCLE maempr23;
  #maempr23#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, maempr23;
|FIN;

|PROCESO maempr24;
  |BORRA 020#maempr24.a;
  |LIBERA #maempr24;
|FPRC;

|DEFBUCLE maempr24;
  #maempr24#1;
  ;
  #0#0, #0#1, 01;
  #0#0, #0#1, 99;
  be;
  NULL, maempr24;
|FIN;

|PROCESO maempr25;
  |ABRE #maempr25;
  #maempr25#0 = #0#0;
  #maempr25#1 = #0#1;
  |LEE 141#maempr25.=;
  |SI FSalida = 0;
      |BORRA 020#maempr25.a;
  |FINSI;
  |LIBERA #maempr25;
  |CIERRA #maempr25;
|FPRC;

|PROCESO Borrado; |TIPO 2;
  |SI enModo1 < 98;
      |PINTA 2430,"Borrando Registro ...";
      |ABRE #1;
      #1#0 = #0#0;
      #1#1 = #0#1;
      |BORRA 101#1c;
      |LIBERA #1;
      |CIERRA #1;
  |FINSI;

  SwBorra = 0;
  |BUCLE maempr02;
  |BUCLE maempr03;
  |BUCLE maempr04;
  |BUCLE maempr05;
  |BUCLE maempr06;
  |BUCLE maempr11;
  |BUCLE maempr12;
  |BUCLE maempr13;
  |BUCLE maempr22;
  |BUCLE maempr23;
  |BUCLE maempr24;
  |HAZ maempr25;
  |SI enModo1 < 98;
      |BUCLE maempr14;
      |BUCLE maempr15;
      |BUCLE maempr18;
      |BUCLE maempr19;
      |BUCLE maempr20;
      |BUCLE maempr21;
  |FINSI;

  |PINTA 2430,"                     ";
|FPRC;

***********************
PROCESOS CARGA DE DATOS
***********************

|PROCESO Tipo30; |TIPO 30;
  modo = (FEntrada / 100) ! 0;
  |SI modo = 1; |O modo = 2;
      |SI #0#1 [ 1995;  |HAZ Panta95;   |FINSI;
      |SI #0#1 ] 1996; |Y #0#1 [ 2016; |HAZ Panta96;  |FINSI;
      |SI #0#1 = 2017;  |HAZ Panta2017; |FINSI;
      |SI #0#1 = 2018;  |HAZ Panta2017; |FINSI;
      |SI #0#1 ] 2019;  |HAZ Panta2019; |FINSI;
      |HAZ Modicli;
  |FINSI;
  sw_mod = 0;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
  modo = (FEntrada / 100) ! 0;
  |SI modo ! 4;  |ACABA;  |FINSI;

  |PINTA #0#0;
  |PINTA #0#1;
  |PINTA #0#2;
  |PINTA #0#3;
  |SI #0#1 [ 1995;  |HAZ Panta95;   |FINSI;
  |SI #0#1 ] 1996; |Y #0#1 [ 2016; |HAZ Panta96;  |FINSI;
  |SI #0#1 = 2017;  |HAZ Panta2017; |FINSI;
  |SI #0#1 = 2018;  |HAZ Panta2017; |FINSI;
  |SI #0#1 ] 2019;  |HAZ Panta2019; |FINSI;
|FPRC;

|PROCESO Panta95;
  opcion = 1;
  sw = 0;
  empresa = #0#0;
  anyo    = #0#1;
  nombre  = #0#2;
  nif     = #0#3;
  |PARA; |SI sw = 0; |HACIENDO;
     _95Menu2  = opcion;
     |MENUG _95Menu;
     opcion = FSalida;
     |SI opcion ] 1; |Y opcion [ 8;
         |SI opcion = 1;  |SUB_EJECUTA_NP "maempr01"; |FINSI;
         |SI opcion = 2;  |SUB_EJECUTA_NP "maempz02"; |FINSI;
         |SI opcion = 3;  |SUB_EJECUTA_NP "maempz03"; |FINSI;
         |SI opcion = 4;  |SUB_EJECUTA_NP "maempz04"; |FINSI;
         |SI opcion = 5;  |SUB_EJECUTA_NP "maempz05"; |FINSI;
         |SI opcion = 6;  |SUB_EJECUTA_NP "maempr06"; |FINSI;
     |SINO;
         sw = 1;
     |FINSI;
  |SIGUE;
  |PINPA #0#0;
|FPRC;

|PROCESO Panta96;
  opcion = 1;
  sw = 0;
  empresa = #0#0;
  anyo    = #0#1;
  nombre  = #0#2;
  nif     = #0#3;
  |PARA; |SI sw = 0; |HACIENDO;
     _96Menu2  = opcion;
      |MENUG _96Menu;
     opcion = FSalida;
     |SI opcion ] 1; |Y opcion [ 11;
         |SI opcion = 1;   |SUB_EJECUTA_NP "maempr10"; |FINSI;
         |SI opcion = 2;
             |SI #maacceco#1 [ 2010;
                 |SUB_EJECUTA_NP "maempr11";
             |SINO;
                 aAlfa = "|isow0021;";
                 aAlfa = aAlfa + (("0000" + #0#1) % -104);
                 aAlfa = aAlfa + (("00000" + #0#0) % -105);

                 |SUB_EJECUTA aAlfa;
             |FINSI;
         |FINSI;
         |SI opcion = 3;   |SUB_EJECUTA_NP "maempz02"; |FINSI;
         |SI opcion = 4;   |SUB_EJECUTA_NP "maempz03"; |FINSI;
         |SI opcion = 5;   |SUB_EJECUTA_NP "maempz04"; |FINSI;
         |SI opcion = 6;   |HAZ Transparencia;         |FINSI;
         |SI opcion = 7;   |SUB_EJECUTA_NP "maempr06"; |FINSI;
         |SI opcion = 8;   |SUB_EJECUTA_NP "maempz18"; |FINSI;
         |SI opcion = 9;   |SUB_EJECUTA_NP "maempz19"; |FINSI;
         |SI opcion = 10;  |SUB_EJECUTA_NP "maempz14"; |FINSI;
         |SI opcion = 11;  |SUB_EJECUTA_NP "maempz15"; |FINSI;
     |SINO;
         sw = 1;
     |FINSI;
  |SIGUE;
  |PINPA #0#0;
|FPRC;

|PROCESO Panta2017;
  opcion = 1;
  sw = 0;
  empresa = #0#0;
  anyo    = #0#1;
  nombre  = #0#2;
  nif     = #0#3;
  |PARA; |SI sw = 0; |HACIENDO;
      _17Menu2  = opcion;
      |MENUG _17Menu;
      opcion = FSalida;
      |SI opcion ] 1; |Y opcion [ 9;
          |SI opcion = 1;  |SUB_EJECUTA_NP "maempr10"; |FINSI;

          |SI opcion = 2;
              aAlfa = "|isow0021;";
              aAlfa = aAlfa + (("0000" + #0#1) % -104);
              aAlfa = aAlfa + (("00000" + #0#0) % -105);
              |SUB_EJECUTA aAlfa;
          |FINSI;

         |SI opcion = 3;  |SUB_EJECUTA_NP "maempz02"; |FINSI;
         |SI opcion = 4;  |SUB_EJECUTA_NP "maempz03"; |FINSI;
         |SI opcion = 5;  |SUB_EJECUTA_NP "maempz04"; |FINSI;
         |SI opcion = 6;  |HAZ Transparencia;         |FINSI;
         |SI opcion = 7;  |SUB_EJECUTA_NP "maempr06"; |FINSI;

         |SI opcion = 8;  |HAZ Vinculados;            |FINSI;
         |SI opcion = 9;  |HAZ TitularReal;           |FINSI;

     |SINO;
         sw = 1;
     |FINSI;
  |SIGUE;
  |PINPA #0#0;
|FPRC;

|PROCESO Panta2019;
  opcion = 1;
  sw = 0;
  empresa = #0#0;
  anyo    = #0#1;
  nombre  = #0#2;
  nif     = #0#3;
  |PARA; |SI sw = 0; |HACIENDO;
      _19Menu2  = opcion;
      |MENUG _19Menu;
      opcion = FSalida;
      |SI opcion ] 1; |Y opcion [ 10;
          |SI opcion = 1;  |SUB_EJECUTA_NP "maempr10"; |FINSI;

          |SI opcion = 2;
              aAlfa = "|isow0021;";
              aAlfa = aAlfa + (("0000" + #0#1) % -104);
              aAlfa = aAlfa + (("00000" + #0#0) % -105);
              |SUB_EJECUTA aAlfa;
          |FINSI;

         |SI opcion = 3;  |SUB_EJECUTA_NP "maempz02"; |FINSI;
         |SI opcion = 4;  |SUB_EJECUTA_NP "maempz03"; |FINSI;
         |SI opcion = 5;  |SUB_EJECUTA_NP "maempz04"; |FINSI;
         |SI opcion = 6;  |HAZ Transparencia;         |FINSI;
         |SI opcion = 7;  |SUB_EJECUTA_NP "maempr06"; |FINSI;

         |SI opcion = 8;  |HAZ Vinculados;            |FINSI;
         |SI opcion = 9;  |HAZ TitularReal;           |FINSI;
         |SI opcion = 10; |SUB_EJECUTA_NP "maempr25"; |FINSI;

     |SINO;
         sw = 1;
     |FINSI;
  |SIGUE;
  |PINPA #0#0;
|FPRC;

|PROCESO Transparencia;
  SwTranspa = 0;
  |ABRE #9;
  #9#0 = empresa;
  #9#1 = anyo;
  #9#2 = 12;
  |LEE 040#9=;
  |SI FSalida = 0; |Y #9#1 < 2008; SwTranspa = 1; |FINSI;

  #9#0 = empresa;
  #9#1 = anyo;
  #9#2 = 13;
  |LEE 040#9=;
  |SI FSalida = 0; SwTranspa = 1;  |FINSI;

  #9#0 = empresa;
  #9#1 = anyo;
  #9#2 = 15;
  |LEE 040#9=;
  |SI FSalida = 0; SwTranspa = 1;  |FINSI;
  |CIERRA #9;

  |SI SwTranspa = 0;
      |MENAV  "     La Empresa no consta como AIE,UTE o Transp.Fiscal Inter.";
      |ACABA;
  |FINSI;

  |PUSHV 0501 2380;
  Punto1    = 1;
  SwOpcion1 = 0;

  |PARA; |SI SwOpcion1 = 0; |HACIENDO;
         MenuTrans2 = Punto1;
         |MENUG MenuTrans;
         Punto1 = FSalida;
         |SI Punto1 ] 1; |Y Punto1 [ 4;
             |SI Punto1 = 1;  |SUB_EJECUTA_NP "maempz05";  |FINSI;
             |SI Punto1 = 2;  |SUB_EJECUTA_NP "maempr12";  |FINSI;
         |SINO;
             SwOpcion1 = 1;
         |FINSI;
  |SIGUE;
  |POPV;
|FPRC;

|PROCESO Vinculados;
  |PUSHV 0501 2380;
  Punto1    = 1;
  SwOpcion1 = 0;

  |PARA; |SI SwOpcion1 = 0; |HACIENDO;
         MenuOpera2 = Punto1;
         |MENUG MenuOpera;
         Punto1 = FSalida;
         |SI Punto1 ] 1; |Y Punto1 [ 4;
             |SI Punto1 = 1; |SUB_EJECUTA_NP "maempz18"; |FINSI;
             |SI Punto1 = 2; |SUB_EJECUTA_NP "maempr19"; |FINSI;
             |SI Punto1 = 3; |SUB_EJECUTA_NP "maempz14"; |FINSI;
             |SI Punto1 = 4; |SUB_EJECUTA_NP "maempz15"; |FINSI;
         |SINO;
             SwOpcion1 = 1;
         |FINSI;
  |SIGUE;
  |POPV;
|FPRC;

|PROCESO TitularReal;
  |PUSHV 0501 2380;
  Punto1    = 1;
  SwOpcion1 = 0;
  |SI #maempr10#115 = "N";
      |MENAV "0000NO presenta por primera vez ni actualiza datos ";
  |FINSI;
  |PARA; |SI SwOpcion1 = 0; |HACIENDO;
         MenuTitul2 = Punto1;
         |MENUG MenuTitul;
         Punto1 = FSalida;
         |SI Punto1 ] 1; |Y Punto1 [ 3;
             |SI Punto1 = 1; |SUB_EJECUTA_NP "maempz22"; |FINSI;
             |SI Punto1 = 2; |SUB_EJECUTA_NP "maempr23"; |FINSI;
             |SI Punto1 = 3; |SUB_EJECUTA_NP "maempr24"; |FINSI;
         |SINO;
             SwOpcion1 = 1;
         |FINSI;
  |SIGUE;
  |POPV;
|FPRC;

*******************************************************************
PROCESO QUE COMPRUEBA QUE EXISTA EL CLIENTE EN LA FICHA DEL CLIENTE
*******************************************************************

|PROCESO Modicli;
  enCodCli = #0#0;
  |HAZ LeePersona;
  |SI enSwDeDonde = 1;
      |SI #0#3 ! #715#3;
          |MENAV "    D.N.I. del Cliente es distinto al D.N.I. del Cliente General";
      |FINSI;
  |SINO;
      |SI #0#3 ! #715#13;
          |MENAV "    D.N.I. del Cliente es distinto al D.N.I. del Cliente General";
      |FINSI;
  |FINSI;
|FPRC;

********************************************************************
PROCESO QUE DA DE ALTA EL CLIENTE EN LA FICHA O ACTUALIZA EL CLIENTE
********************************************************************
|PROCESO LeeImagen;
    |SI #imagen@#18 > "01.01.0000"; |Y #imagen@#18 > fHFecha;
        |ACABA;
    |FINSI;
    |SI #imagen@#19 > "01.01.0000"; |Y #imagen@#19 < fDFecha;
        |ACABA;
    |FINSI;

    nTPC = nTPC + #imagen@#13;
|FPRC;

|DEFBUCLE LeeImagen;
   #imagen@#2004;
   ;
   #agim0025#0, #agim0025#1, aDni22, 001;
   #agim0025#0, #agim0025#1, aDni22, 999;
   e;
   NULL, LeeImagen;
|FIN;

|PROCESO BuscoIguales;
   nTPC   = 0;
   aDni22 = #agim0025#3;
   |BUCLE LeeImagen;
|FPRC;

|PROCESO BuscaMaempr22;
   nLin22 = nLinea;

   |SELECT #2#maempr22;
   #maempr22#0  = #0#0;
   #maempr22#1  = #0#1;
   #maempr22#3  = aDni22;
   |LEE 041#maempr22.=;
   |SI FSalida = 0;
       nLinea = #maempr22#2;
   |SINO;
       nLinea = nLinea + 1;
       nLin22 = nLinea;
   |FINSI;

   |SELECT #1#maempr22;
   |DDEFECTO #maempr22;
   #maempr22#0 = #0#0;
   #maempr22#1 = #0#1;
   #maempr22#2 = nLinea;
   |LEE 041#maempr22.=;
   nEstPr22 = FSalida;

|FPRC;

|PROCESO BuscaMaempr02;
   |SELECT #2#maempr02;
   #maempr02#0  = #0#0;
   #maempr02#1  = #0#1;
   #maempr02#3  = aDni02;
   |LEE 041#maempr02.=;
   |SI FSalida = 0;
       nLinea2 = #maempr02#2;
   |FINSI;

   |SELECT #1#maempr02;
   |DDEFECTO #maempr02;
   #maempr02#0 = #0#0;
   #maempr02#1 = #0#1;
   #maempr02#2 = nLinea2;
   |LEE 041#maempr02.=;
   nEstPr02 = FSalida;
|FPRC;

|PROCESO MiraSiEstaYa;
         nOk = 0;
         |SELECT #2#maempr24;
         #maempr24#0  = #0#0;
         #maempr24#1  = #0#1;
         #maempr24#5  = #agim0025#3;
         #maempr24#3  = 1;
         |LEE 041#maempr24.=;
         |SI FSalida = 0;  nOk = 1;  |FINSI;
         |SELECT #1#maempr24;
|FPRC;

|PROCESO BuscoAgim0058;
     |SI nOpera = 0;
         aDni22 = #agim0058#5;
         |HAZ BuscaMaempr22;
         nSw = 1;
         #maempr22#3  = #agim0058#5;
         #maempr22#4  = #agim0025#12;
         #maempr22#5  = #agim0058#6;
         #maempr22#6  = #agim0058#8;
         #maempr22#7  = #agim0058#9;
         #maempr22#8  = #agim0058#10;
         #maempr22#9  = #agim0058#11;
         #maempr22#10 = #agim0058#12;
         #maempr22#12 = #maempr22#12 + #agim0025#13;
         |ERROR10;
     |FINSI;

     |SI nOpera = 1;
         aCampo11 = #agim0058#5;
     |FINSI;
|FPRC;

|DEFBUCLE BuscoAgim0058;
  #agim0058#1;
  4;
  #agim0025#0, #agim0025#1, #agim0025#2, 01, "F";
  #agim0025#0, #agim0025#1, #agim0025#2, 99, "F";
  e;
  NULL, BuscoAgim0058;
|FIN;

|PROCESO Agim0058;
         nSw = nSw + 1;
         nLinea = nLinea + 1;
         #maempr24#0  = #0#0;
         #maempr24#1  = #0#1;
         #maempr24#2  = nLinea;
         #maempr24#3  = nSw;
         #maempr24#4  = #agim0058#4;
         #maempr24#5  = #agim0058#5;
         #maempr24#6  = #agim0058#6;
         #maempr24#7  = #agim0058#7;
         #maempr24#8  = #agim0058#8;
         #maempr24#9  = #agim0058#9;
         #maempr24#10 = #agim0058#13;
         #maempr24#11 = aCampo11;
         |GRABA 041#maempr24.n;
         |LIBERA #maempr24;
         nHayTitular= 1;
|FPRC;

|DEFBUCLE Agim0058;
  #agim0058#1;
  4;
  #agim0025#0, #agim0025#1, #agim0025#2, 01, "J";
  #agim0025#0, #agim0025#1, #agim0025#2, 99, "J";
  e;
  NULL, Agim0058;
|FIN;

|PROCESO Paramaempr24;
     |SI #agim0025#18 > "01.01.0000"; |Y #agim0025#18 > fHFecha;
         |ACABA;
     |FINSI;
     |SI #agim0025#19 > "01.01.0000"; |Y #agim0025#19 < fDFecha;
         |ACABA;
     |FINSI;

     |SI #25#12 = "J";
         |HAZ MiraSiEstaYa;
         |SI nOk = 0;
             |HAZ BuscoIguales;
             |SI nTPC > 25;
                 aCampo11 = "";
                 |BUCLE BuscoAgim0058;

                 nSw = 0;
                 |BUCLE Agim0058;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Paramaempr24;
  #25#1;
  ;
  #19#0, #19#1, 000;
  #19#0, #19#1, 999;
  ;
  NULL, Paramaempr24;
|FIN;

|PROCESO PasaEl25;

     |SI #agim0025#18 > "01.01.0000"; |Y #agim0025#18 > fHFecha;
         |ACABA;
     |FINSI;
     |SI #agim0025#19 > "01.01.0000"; |Y #agim0025#19 < fDFecha;
         |ACABA;
     |FINSI;

     nValor = #25#20;

     |SI EURODB = 0;  |Y #19#51 = "E";
         nValor = (#25#20 * 166.386) ! EURODB;
     |FINSI;

     |SI EURODB ! 0;  |Y #19#51 = "P";
         nValor = (#25#20 / 166.386) ! EURODB;
     |FINSI;

     aDni02  = #25#3;
     nLinea2 = #25#2;
     |HAZ BuscaMaempr02;

     #2#0 = #0#0;
     #2#1 = #0#1;
     #2#2 = nLinea2;
     #2#3 = aDni02;
     #2#4 = #25#12;
     #2#5 = #25#4;
     |SI #25#7 ! 99;
         #2#6 = ("00" + #25#7) % -102;
     |SINO;
         #2#6 = #25#24;
     |FINSI;
     #2#7 = #2#7 + nValor;
     #2#8 = #2#8 + #25#13;
     #2#9 = #25#17;

     |SI nEstPr02 = 0; |GRABA 140#maempr02.a; |FINSI;
     |SI nEstPr02 ! 0; |GRABA 140#maempr02.n; |FINSI;
     |LIBERA #2;

     |SI #1#1 ] 2017;
         |HAZ BuscoIguales;
         |SI #25#12 = "F"; |Y nTPC > 25;
             aDni22 = #25#3;
             |HAZ BuscaMaempr22;

             #maempr22#0  = #0#0;
             #maempr22#1  = #0#1;
             #maempr22#2  = nLinea;
             #maempr22#3  = #agim0025#3;
             #maempr22#4  = #agim0025#12;
             #maempr22#5  = #agim0025#4;
             #maempr22#6  = #agim0025#23;
             #maempr22#7  = #agim0025#22;
             #maempr22#8  = #agim0025#24;
             #maempr22#9  = #agim0025#26;
             #maempr22#10 = #agim0025#25;
             #maempr22#11 = #maempr22#11 + #agim0025#13;
             |SI nEstPr22 = 0; |GRABA 140#maempr22.a; |FINSI;
             |SI nEstPr22 ! 0; |GRABA 140#maempr22.n; |FINSI;
             |LIBERA #maempr22;
             nLinea = nLin22;
             nOk    = 1;
             nHayTitular= 1;
         |FINSI;
         |SI #25#12 = "J"; |Y nTPC > 25;
             nSw    = 0;
             nOpera = 0;
             |BUCLE BuscoAgim0058;
             |SI nSw = 1;
                 #maempr22#0 = #0#0;
                 #maempr22#1 = #0#1;
                 #maempr22#2 = nLinea;
                 |SI nEstPr22 = 0; |GRABA 140#maempr22.a; |FINSI;
                 |SI nEstPr22 ! 0; |GRABA 140#maempr22.n; |FINSI;
                 |LIBERA #maempr22;
                 nLinea = nLin22;
                 nOk    = 1;
                 nHayTitular= 1;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agim0025;
  #25#1;
  ;
  #19#0, #19#1, 000;
  #19#0, #19#1, 999;
  ;
  NULL, PasaEl25;
|FIN;

|PROCESO PasaEl24;
  |SI #agim0024#16 > "01.01.0000"; |Y #agim0024#16 > fHFecha;
      |ACABA;
  |FINSI;

  |SI nOpera = 0;
      |SI #24#15 = "A"; |O #24#15 = "D";
          #3#0 = #0#0;
          #3#1 = #0#1;
          #3#2 = #24#2;
          #3#3 = #24#3;
          #3#4 = #24#14;
          #3#5 = #24#4;
          #3#6 = #24#12;
          |SI #24#9 ! 99;
              #3#7 = ("00" + #24#9) % -102;
          |SINO;
              #3#7 = #24#23;
          |FINSI;
          |GRABA 140#3n;
          |LIBERA #3;
      |FINSI;

      |SI #24#15 = "R"; |O #24#15 = "D";
          #4#0 = #0#0;
          #4#1 = #0#1;
          #4#2 = #24#2;
          #4#3 = #24#4;
          #4#4 = #24#3;
          #4#5 = #24#5;
          #4#6 = #24#6;
          |GRABA 140#4n;
          |LIBERA #4;
      |FINSI;
  |FINSI;

  |SI nOpera = 1;
      |SI #24#15 = "A"; |O #24#15 = "D";
          nLinea = nLinea + 1;
          #maempr23#0  = #0#0;
          #maempr23#1  = #0#1;
          #maempr23#2  = nLinea;
          #maempr23#3  = #agim0024#3;
          #maempr23#4  = #agim0024#14;
          #maempr23#5  = #agim0024#4;
          #maempr23#6  = #agim0024#21;
          #maempr23#7  = #agim0024#22;
          #maempr23#8  = #agim0024#23;
          #maempr23#9  = #agim0024#25;
          #maempr23#10 = #agim0024#24;
          |GRABA 140#maempr23.n;
          |LIBERA #maempr23;
          nHayTitular= 1;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE agim0024;
  #24#1;
  ;
  #19#0, #19#1, 00;
  #19#0, #19#1, 99;
  ;
  NULL, PasaEl24;
|FIN;

|PROCESO PasaEl20;
  #9#0 = #0#0;
  #9#1 = #0#1;
  #9#2 = #20#1;
  #9#3 = #20#2;
  #9#4 = #20#3;
  #9#5 = #20#4;
  |GRABA 140#9n;
  |LIBERA #9;
|FPRC;

|DEFBUCLE agim0020;
  #20#1;
  ;
  #0#0, 000;
  #0#0, 999;
  ;
  NULL, PasaEl20;
|FIN;

|PROCESO PasaEl21;
  #5#0  = #0#0;
  #5#1  = #0#1;
  #5#2  = #21#2;
  #5#3  = #21#3;
  #5#4  = #21#4;
  #5#5  = #21#5;
  #5#6  = #21#6;
  |SI #21#7 ! 99;
      #5#7  = ("00" + #21#7) % -102;
  |FINSI;
  #5#8  = #21#8;
  #5#9  = #21#9;
  #5#10 = #21#10;
  |GRABA 140#5n;
  |LIBERA #5;
|FPRC;

|DEFBUCLE agim0021;
  #21#1;
  ;
  #19#0, #19#1, 00;
  #19#0, #19#1, 99;
  ;
  NULL, PasaEl21;
|FIN;

|PROCESO PasaEl22;
  #10#0 = #0#0;
  #10#1 = #0#1;
  #10#2 = #22#2;
  #10#3 = #22#3;
  #10#4 = #22#4;
  #10#5 = #22#5;
  #10#6 = #22#6;
  |GRABA 140#10n;
  |LIBERA #10;
|FPRC;

|DEFBUCLE agim0022;
  #22#1;
  ;
  #19#0, #19#1, 00;
  #19#0, #19#1, 99;
  ;
  NULL, PasaEl22;
|FIN;

|PROCESO PasaEl23;
  #11#0 = #0#0;
  #11#1 = #0#1;
  #11#2 = #23#2;
  #11#3 = #23#3;
  #11#4 = #23#4;
  #11#5 = #23#5;
  #11#6 = #23#6;
  #11#7 = #23#7;
  |GRABA 140#11n;
  |LIBERA #11;
|FPRC;

|DEFBUCLE agim0023;
  #23#1;
  ;
  #19#0, #19#1, 00, 00;
  #19#0, #19#1, 99, 99;
  ;
  NULL, PasaEl23;
|FIN;

|PROCESO PasaEl27;
  #6#0 = #0#0;
  #6#1 = #0#1;
  #6#2 = #27#2;
  #6#3 = #27#3;
  #6#4 = #27#4;
  #6#5 = #27#5;
  #6#6 = #27#6;
  #6#7 = #27#7;

  #6#8  = #27#8;
  #6#9  = #27#9;
  #6#10 = #27#10;
  #6#11 = #27#11;
  #6#12 = #27#12;
  #6#13 = #27#13;
  #6#14 = #27#14;
  #6#15 = #27#15;
  #6#16 = #27#16;
  #6#17 = #27#17;
  #6#18 = #27#18;
  #6#19 = #27#19;
  #6#20 = #27#20;
  #6#21 = #27#21;
  #6#22 = #27#22;
  #6#23 = #27#23;
  |GRABA 140#6n;
  |LIBERA #6;
|FPRC;

|DEFBUCLE agim0027;
  #27#1;
  ;
  #19#0, #19#1, 00;
  #19#0, #19#1, 99;
  ;
  NULL, PasaEl27;
|FIN;

|PROCESO BuscaSecre;
  |SI #agim0026#14 > "01.01.0000"; |Y #agim0026#14 > fHFecha;
      |ACABA;
  |FINSI;

  #1#77 = #26#4;                         || Nombre Secretario
  #1#78 = #26#3;                         || NIF
  #1#79 = #26#5;                         || Domicilio
  #1#80 = #26#6;                         || Numero
  #1#81 = #26#9;                         || Poblacion
  #1#82 = #26#17;                        || Cargo
  |ERROR10;
|FPRC;

|DEFBUCLE agim0026;
  #26#1;
  16;
  #19#0, #19#1, 01, 3;
  #19#0, #19#1, 99, 3;
  ;
  NULL, BuscaSecre;
|FIN;

|PROCESO BuscaC115;
   #1#115 = "N";
   |ERROR10;
|FPRC;

|DEFBUCLE Buscam22;
  #maempr22#1;
  ;
  #0#0, nAnyo, 001;
  #0#0, nAnyo, 999;
  e;
  NULL, BuscaC115;
|FIN;

|DEFBUCLE Buscam23;
  #maempr23#1;
  ;
  #0#0, nAnyo, 01;
  #0#0, nAnyo, 99;
  e;
  NULL, BuscaC115;
|FIN;

|DEFBUCLE Buscam24;
  #maempr24#1;
  ;
  #0#0, nAnyo, 01;
  #0#0, nAnyo, 99;
  e;
  NULL, BuscaC115;
|FIN;

|PROCESO Recoge;
     |ABRE #28;
     #28#0 = #0#0;
     |LEE 040#28=;
     |SI FSalida ! 0;  |DDEFECTO #28;  |FINSI;
     |CIERRA #28;

     |ABRE #19;
     |SI enModo1 = 98;
         |DDEFECTO #19;
         #19#0 = #0#0;
         #19#1 = Registro;
         |LEE 040#19=;
     |SINO;
         #19#0 = #0#0;
         #19#1 = 99;
         |LEE 040#19];
         |SI FSalida = 0;
             |LEE 040#19a;
         |SINO;
             |LEE 040#19u;
         |FINSI;
         |SI FSalida ! 0;  |O #19#0 ! #0#0;
             |DDEFECTO #19;
         |FINSI;
     |FINSI;
     |CIERRA #19;

     #0#2  = #28#2;  |PINTA #0#2;     || Nombre
     #0#3  = #28#3;  |PINTA #0#3;     || CIF

     aCampo16 = "";
     aCampo31 = "";
     aCampo32 = "";
     aCampo33 = "";
     aCampo83 = "";
     nCampo75 = 0;
     nCampo76 = 0;
     nCampo86 = 0;
     nCampo87 = 0;
     nCampo88 = 0;
     nCampo89 = 0;
     nCampo103 = 0;
     nCampo104 = 0;
     nCampo105 = 0;
     nCampo106 = 0;
     nCampo107 = 0;
     nCampo108 = 0;
     nCampo109 = 0;
     nCampo110 = 0;
     nCampo111 = 0;
     nCampo112 = 0;
     nHayAnt  = 0;
     nHayAct  = 0;
     nHayTitular = 0;

     |ABRE #17;
     #17#0 = #0#1 - 1;
     #17#1 = #0#0;
     |LEE 000#17=;
     |SI FSalida = 0;
         nCampo87 = #17#3;
         nCampo89 = #17#4;
         nHayAnt  = 1;
     |FINSI;

     |ABRE #17;
     #17#0 = #0#1;
     #17#1 = #0#0;
     |LEE 000#17=;
     |SI FSalida = 0;
         nCampo75 = #17#3;
         nCampo76 = #17#4;
         nCampo86 = #17#3;
         nCampo88 = #17#4;
         nHayAct  = 1;
     |FINSI;
     |CIERRA #17;

     |ABRE #1;
     #1#0  = #0#0;                        || Empresa
     #1#1  = #0#1 - 1;                    || A¤o
     |LEE 040#1=;
     |SI FSalida = 0;
         |SI nHayAct = 0;
             nCampo75 = #1#75;
             nCampo76 = #1#76;
             nCampo86 = #1#86;
             nCampo88 = #1#88;
         |FINSI;

|| Cuando existan mas datos en ese mantenimiento, recoga de ahi 1243_2083
         nCampo103 = #1#103;
         nCampo105 = #1#105;
         nCampo107 = #1#107;
         nCampo109 = #1#109;
         nCampo111 = #1#111;

        || |SI nHayAnt = 0;  ||siempre
             nCampo87  = #1#86;
             nCampo89  = #1#88;
             nCampo104 = #1#103;
             nCampo106 = #1#105;
             nCampo108 = #1#107;
             nCampo110 = #1#109;
             nCampo112 = #1#111;
        || |FINSI;

         nCampo85 = #1#85;
         nCampo85 = nCampo85 + 1;
         nCampo90 = #1#90;
         aCampo83 = #1#83;

         aCampo16 = #1#16;
         aCampo31 = #1#31;
         aCampo32 = #1#32;
         aCampo33 = #1#33;
     |FINSI;

     |DDEFECTO #1;

     #1#0  = #0#0;                    || Empresa
     #1#1  = #0#1;                    || A¤o
     |LEE 101#1=;
     |SI FSalida ! 0;
         |DDEFECTO #1;
         #1#0  = #0#0;                    || Empresa
         #1#1  = #0#1;                    || A¤o
         |GRABA 020#1b;
     |FINSI;

     |SI enSwDeDonde = 1;
         #1#2  = #715#1;                   || Nombre
         #1#3  = #715#3;                   || CIF
         #1#4  = #715#19;                  || SG
         #1#5  = #715#20;                  || Calle
         #1#6  = #715#21;                  || Numero
         #1#7  = #715#22;                  || Escalera
         #1#8  = #715#23;                  || Piso
         #1#9  = #715#24;                  || Puerta
         #1#10 = #715#25;                  || Codigo Provincia
         #1#11 = #715#26;                  || Codigo Poblacion
         #1#12 = (("00" + #1#10) % -102) + (("000" + #1#11) % -103); || C.Postal
         #1#13 = #715#27;                  || Poblacion
         #1#14 = #715#28;                  || Provincia
         #1#15 = #715#54;                  || Telefono
         #1#29 = #715#15;                  || Codigo Delegacion
         #1#30 = #715#16;                  || Codigo Administracion
     |SINO;
         #1#2  = #715#2;                   || Nombre
         #1#3  = #715#13;                  || CIF
         #1#4  = #715#3;                   || SG
         #1#5  = #715#4;                   || Calle
         #1#6  = #715#5;                   || Numero
         #1#7  = #715#6;                   || Escalera
         #1#8  = #715#7;                   || Piso
         #1#9  = #715#8;                   || Puerta
         #1#10 = #715#9;                   || Codigo Provincia
         #1#11 = #715#10;                  || Codigo Poblacion
         #1#12 = #715#16;                  || Codigo Postal
         #1#13 = #715#11;                  || Poblacion
         #1#14 = #715#12;                  || Provincia
         #1#15 = #715#14;                  || Telefono
         #1#29 = #715#63;                  || Codigo Delegacion
         #1#30 = #715#64;                  || Codigo Administracion
     |FINSI;

     |SI #1#1 ] 2008;
         #1#17 = #19#40;                   || CNAE
     |SINO;
         #1#17 = #19#81;                   || CNAE
     |FINSI;

     #1#19 = #19#48;                   || Actividad Principal
     #1#24 = #19#46 + " " + #19#47;    || Epigrafe Principal

     |SI enModo1 < 98; |O nEstado = 1;
         aAlfa = "1";
         |SI aCampo16 ! ""; aAlfa = aCampo16 % -101; |FINSI;
         aAlfa = (#1#1 % -102) + aAlfa;
         #1#16 = aAlfa;

         aAlfa = "01.01." + #1#1; #1#31 = aAlfa;
         aAlfa = "31.12." + #1#1; #1#32 = aAlfa;
         aAlfa = #1#16 % -101;
         |SI aAlfa ! 1; |Y aCampo31 ! "";
             aAlfa = (aCampo31 % 106) + #1#1; #1#31 = aAlfa;
         |FINSI;
         aAlfa = #1#16 % -101;
         |SI aAlfa ! 1; |Y aCampo32 ! "";
             aAlfa = (aCampo32 % -104);
             nNume = aAlfa;
             nNume = nNume + 1; aAlfa = nNume;
             aAlfa = (aCampo32 % 106) + aAlfa; #1#32 = aAlfa;
         |FINSI;

         nAnyo = #1#1 + 1;
         |SI aCampo33 ! "";
             aAlfa = (aCampo33 % -104);
             nNume = aAlfa;
             nAnyo = nNume + 1;
         |FINSI;
         aAlfa = aCampo33 % 106; |QBF aAlfa;
         |SI aAlfa = ""; aAlfa = "30.03."; |FINSI;
         aAlfa = aAlfa + nAnyo; #1#33 = aAlfa;

         nAnyo = #1#1 + 1;
         |SI aCampo83 ! "";
             aAlfa = (aCampo83 % -104);
             nNume = aAlfa;
             nAnyo = nNume + 1;
         |FINSI;
         aAlfa = aCampo83 % 106; |QBF aAlfa;
         |SI aAlfa = ""; aAlfa = "30.06."; |FINSI;
         aAlfa = aAlfa + nAnyo;
         #1#83 = aAlfa;

         #1#84 = "JUNTA GENERAL DE ACCIONISTAS";
         #1#75 = nCampo75;
         #1#76 = nCampo76;
         #1#85 = nCampo85;
         #1#86 = nCampo86;
         #1#87 = nCampo87;
         #1#88 = nCampo88;
         #1#89 = nCampo89;
         #1#90 = nCampo90;
         #1#103 = nCampo103;
         #1#104 = nCampo104;
         #1#105 = nCampo105;
         #1#106 = nCampo106;
         #1#107 = nCampo107;
         #1#108 = nCampo108;
         #1#109 = nCampo109;
         #1#110 = nCampo110;
         #1#111 = nCampo111;
         #1#112 = nCampo112;
     |FINSI;

     fDFecha = #1#31;
     fHFecha = #1#32;

     |BUCLE agim0026;                 || Datos Secretario

     #1#101 = #19#87;  ||balance y ECPN
     #1#102 = #19#88;  ||Cuenta Resultados
     #1#114 = #19#94;

     |ABRE #09;                  |BUCLE agim0020;  |CIERRA #09;
     nOk    = 0;
     nLinea = 0;
     nOpera = 0;
     |ABRE #02; |ABRE #maempr22; |BUCLE agim0025;  |CIERRA #maempr22; |CIERRA #02;
     |ABRE #03; |ABRE #04;       |BUCLE agim0024;  |CIERRA #03;  |CIERRA #04;
     |ABRE #05;                  |BUCLE agim0021;  |CIERRA #05;
     |ABRE #10;                  |BUCLE agim0022;  |CIERRA #10;
     |ABRE #11;                  |BUCLE agim0023;  |CIERRA #11;
     |ABRE #06;                  |BUCLE agim0027;  |CIERRA #06;

     |SI nOk = 0; |Y #1#1 ] 2017;
         nOpera = 1;
         |ABRE #maempr23; |BUCLE agim0024;  |CIERRA #maempr23;
     |FINSI;

     nLinea = 0;
     |SI #1#1 ] 2017;
         nOpera = 1;
         |ABRE #maempr24; |BUCLE Paramaempr24; |CIERRA #maempr24;
     |FINSI;
     nOpera = 0;

     |SI nHayTitular = 0;
         #1#115 = "N";
     |SINO;
         #1#115 = "S";
         nAnyo = #0#1 - 1; |BUCLE Buscam22;
                           |BUCLE Buscam23;
                           |BUCLE Buscam24;
     |FINSI;


     |SI #1#1 ] 2020;
         || ... duplicar el maempr25, con el 2019 no hace falta
     |FINSI;

     |GRABA 101#1a;
     |LIBERA #1;
     |CIERRA #1;

|FPRC;

|PROCESO AltaCliente; |TIPO 0;
     modo = (FEntrada / 100) ! 0;
     |SI modo ! 1; |Y enModo1 < 98;  |ACABA;  |FINSI;

     enCodCli = #0#0;
     |HAZ LeePersona;

     |ABRE #715;
     #715#0 = #0#0;
     |LEE 101#715=;
     |SI FSalida = 0;                || Recoge variables del basica
         |SI enSwDeDonde = 1;
             #715#67 = "S";
         |SINO;
             #715#20 = "S";
         |FINSI;
         |GRABA 020#715a;             || Graba el basica
         |HAZ Recoge;
     |FINSI;
     |LIBERA #715;
     |CIERRA #715;

|FPRC;

|PROCESO LeeAccesoIS;
   enError = -1;
   #isacceso#0 = #maacceco#0;
   #isacceso#1 = #maacceco#1;
   |LEE 041#isacceso.=;
   |SI FSalida = 0;
       enError = 0;
       |SI #isacceso#6 = "S";  enError = 1; |FINSI;
   |FINSI;
|FPRC;

|PROCESO RefrescaTodos;

     |HAZ LeeAccesoIS;
     |SI enError ! 1;
         |SI enError = 0; nNume = nNume + 1; |FINSI;
         |HAZ Borrado;
         |HAZ AltaCliente;
         |GRABA 020#0a;
     |FINSI;
|FPRC;

|DEFBUCLE maacceco;
     #0#1;
     ;
     nDEmpresa, enAnyo;
     nHEmpresa, enAnyo;
     be;
     NULL, RefrescaTodos;
|FIN;

|PROGRAMA;
  |DBASS aPath;
  aMas = aPath + "basica/def/agim0025.mas";
  |CARGA_DEF aMas, imagen@;
  |SI FSalida ! 0;
      |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
      |ACABA;
  |FINSI;

 nEstado = 0;
 |SI enModo1 = 99; |O enModo1 = 98;
     nDEmpresa = 1;
     nHEmpresa = 99999;

     |SI enEmpresa ! 0;
         nDEmpresa = enEmpresa;
         nHEmpresa = enEmpresa;

         |ABRE #0;
         #0#0 = enEmpresa;
         #0#1 = enAnyo;
         |LEE 101#0=;
         |SI FSalida ! 0;
             |DDEFECTO #0;
             #0#0 = enEmpresa;
             #0#1 = enAnyo;
             |GRABA 020#0n;
             |LIBERA #0;
             nEstado = 1;
          |FINSI;
          |CIERRA #0;
     |FINSI;

     nNume = 0;
     |ABRE #isacceso;
     |BUCLE maacceco;
     |CIERRA #isacceso;
     |SI nNume ! 0;
         |MENAV "0000Existen datos en el Impuesto de Sociedades. Repaselos";
     |FINSI;
     |DESCARGA_DEF #imagen@;
     |ACABA;
  |FINSI;

   FEntrada = 101;
   modo     = 1;

   |ABRET #0;

   |SI enEmpresa = 0;
       #0#0 = empresa;
       #0#1 = anyo;
       |LEE 040#0=;
       |SI FSalida ! 0;
           |HAZ Borrado;

           |DDEFECTO #0;
           #0#0 = empresa;
           #0#1 = anyo;
           |GRABA 020#0b;
       |SINO;
           |HAZ Borrado;
       |FINSI;

       |HAZ AltaCliente;

       |PINPA #0#0;
       |PINDA #0#0;
       |HAZ Tipo30;
       |GRABA 020#0a;
  |SINO;
       |SI enAnyo = 0;  enAnyo = anyo;  |FINSI;

       |SI enModo1 ! 3;
           |HAZ MiroEmpresa;
           |SI noContinuar = 1; |CIERRAT #0; |ACABA; |FINSI;
       |FINSI;

       #0#0 = enEmpresa;
       #0#1 = enAnyo;
       |LEE 040#0=;
       |SI FSalida ! 0;
           |DDEFECTO #0;
           #0#0 = enEmpresa;
           #0#1 = enAnyo;
           |GRABA 020#0b;

           |HAZ Borrado;
           |HAZ AltaCliente;
       |SINO;
           |HAZ Borrado;
           |SI enModo1 = 0;  |HAZ AltaCliente;  |FINSI;
       |FINSI;

       |SI enModo1 = 3;
           |HAZ Borrado;
           |BORRA 020#0a;
       |SINO;
           |GRABA 020#0a;
       |FINSI;

       |LIBERA #0;
 |FINSI;
 |CIERRAT #0;

 |DESCARGA_DEF #imagen@;
|FPRO;

|PROCESO MiroEmpresa;
     noContinuar = 0;
     aAlfa         = "01.01." + enAnyo;
     fFechaChequeo = aAlfa;
     |HAZ ChequeaEmpresa;

     |SI enError = 1;
         |CONFI "0000NEmpresa INACTIVA. Continuar.";
         |SI FSalida ! 0;
             noContinuar = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI enError = 2;
         aAlfa = "0000NEmpresa con fecha disolucion " + fFechaDisol + ". Continuar.";
         |CONFI aAlfa;
         |SI FSalida ! 0;
              noContinuar = 1;
         |FINSI;
     |FINSI;
|FPRC;
