|FICHEROS;
     isom9232;

     maempr10;
     maempr14;
     maempr15;
     maempr16;
     maempr18;
     maempr19;
     maempr20;

     :/basica/def/agim0019;

     h2321601;
     h2321602;
|FIN;

|INCLUYE 9001vari;

|PROCESO LeePais;
     #maempr16#0 = aPais;
     |LEE 000#maempr16.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr16;  |FINSI;
|FPRC;

|PROCESO maempr14;
     nNumReg     = nNumReg + 1;
     #h2321602#0 = ((nNumReg / 12) + .49) ! 0;
     nNumLin     = (nNumReg + 11) - (12 * #h2321602#0);

     |LEE 101#h2321602.=;
     |SI FSalida ! 0;
         |DDEFECTO #h2321602;

         #h2321602#0 = ((nNumReg / 12) + .49) ! 0;

                               #h2321602#5 = "";
         |SI #h2321602#0 ! 1;  #h2321602#5 = "C";  nComple = 1;  |FINSI;

         |GRABA 020#h2321602.b;
     |FINSI;

     nCmp            = (nNumLin * 6) + 6;
     #h2321602#nCmp# = #maempr14#3;

     nCmp            = nCmp + 1;
     #h2321602#nCmp# = #maempr14#4;

     nCmp            = nCmp + 1;
     #h2321602#nCmp# = "";

     nCmp            = nCmp + 1;
     #h2321602#nCmp# = #maempr14#5;

     nCmp            = nCmp + 1;
     aPais           = #maempr14#6;  |HAZ LeePais;
     #h2321602#nCmp# = #maempr16#2;

     nCmp            = nCmp + 1;
     enCanti         = #maempr14#8;  |HAZ Calcula17D;
     #h2321602#nCmp# = eaAlfa;

     |GRABA 020#h2321602.a;
     |LIBERA #h2321602;
|FPRC;

|DEFBUCLE maempr14;
     #maempr14#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     ;
     NULL, maempr14;
|FIN;

|PROCESO maempr15;
     nNumReg     = nNumReg + 1;
     #h2321602#0 = ((nNumReg / 12) + .49) ! 0;
     nNumLin     = (nNumReg + 11) - (12 * #h2321602#0);

     |LEE 101#h2321602.=;
     |SI FSalida ! 0;
         |DDEFECTO #h2321602;
         #h2321602#0     = ((nNumReg / 6) + .49) ! 0;

                               #h2321602#5 = "";
         |SI #h2321602#0 ! 1;  #h2321602#5 = "C";  nComple = 1;  |FINSI;

         |GRABA 020#h2321602.b;
     |FINSI;

     nCmp            = (nNumLin * 6) + 78;
     #h2321602#nCmp# = #maempr15#3;

     nCmp            = nCmp + 1;
     #h2321602#nCmp# = #maempr15#4;

     nCmp            = nCmp + 1;
     #h2321602#nCmp# = "";

     nCmp            = nCmp + 1;
     aPais           = #maempr15#5;  |HAZ LeePais;
     #h2321602#nCmp# = #maempr16#2;

     nCmp            = nCmp + 1;
     enCanti         = #maempr15#7;  |HAZ Calcula17D;
     #h2321602#nCmp# = eaAlfa;

     nCmp            = nCmp + 1;
     enCanti         = #maempr15#8;  |HAZ Calcula3E2D;
     #h2321602#nCmp# = eaAlfa;

     |GRABA 020#h2321602.a;
     |LIBERA #h2321602;
|FPRC;

|DEFBUCLE maempr15;
     #maempr15#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     ;
     NULL, maempr15;
|FIN;

|PROCESO Hoja2;
     nOk = 0;

     |ABRE #maempr14;
     #maempr14#0 = #isom9232#0;
     #maempr14#1 = #isom9232#1;
     #maempr14#9 = #isom9232#2;
     #maempr14#2 = 1;
     |LEE 000#maempr14.];
     |SI FSalida = 0;  |Y  #maempr14#0 = #isom9232#0;  |Y #maempr14#1 = #isom9232#1;
      |Y #maempr14#9 = #isom9232#2;
         nOk = 1;
     |FINSI;
     |CIERRA #maempr14;

     |ABRE #maempr15;
     #maempr15#0 = #isom9232#0;
     #maempr15#1 = #isom9232#1;
     #maempr15#9 = #isom9232#2;
     #maempr15#2 = 1;
     |LEE 000#maempr15.];
     |SI FSalida = 0;  |Y  #maempr15#0 = #isom9232#0;  |Y #maempr15#1 = #isom9232#1;
      |Y #maempr15#9 = #isom9232#2;
         nOk = 1;
     |FINSI;
     |CIERRA #maempr15;

     |SI nOk = 0;  |ACABA;  |FINSI;

     |ABRE #maempr16;

     nNumReg = 0;    |BUCLE maempr14;
     nNumReg = 0;    |BUCLE maempr15;

     |CIERRA #maempr16;
|FPRC;

|PROCESO maempr18;
     nNumReg      = nNumReg + 1;

     #h2321601#0  = ((nNumReg / 5) + .49) ! 0;
     nNumLin      = (nNumReg + 4) - (5 * #h2321601#0);

     |LEE 101#h2321601.=;
     |SI FSalida ! 0;
         |DDEFECTO #h2321601;

         #h2321601#0  = ((nNumReg / 5) + .49) ! 0;

                               #h2321601#5 = "";
         |SI #h2321601#0 ! 1;  #h2321601#5 = "C";  nComple = 1;  |FINSI;

         |GRABA 020#h2321601.b;
     |FINSI;

     nCmp            = (nNumLin * 10) + 18;
     #h2321601#nCmp# = #maempr18#3;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr18#4;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr18#5;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = "";

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr18#6;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr18#7;

     nCmp            = nCmp + 1;
     aAlfa           = ("00" + #maempr18#8) % -102;
     #h2321601#nCmp# = aAlfa;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr18#9;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr18#10;

     nCmp            = nCmp + 1;
     enCanti         = #maempr18#11;  |HAZ Calcula17D;
     #h2321601#nCmp# = eaAlfa;

     |GRABA 020#h2321601.a;
     |LIBERA #h2321601;
|FPRC;

|DEFBUCLE maempr18;
     #maempr18#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     ;
     NULL, maempr18;
|FIN;

|PROCESO Graba19;
     #h2321601#0  = nNumReg;
     |LEE 000#h2321601.=;
     |SI FSalida ! 0;
         |DDEFECTO #h2321601;
         #h2321601#0  = nNumReg;

         #h2321601#5 = "";
         |SI #h2321601#0 ! 1;
             #h2321601#5 = "C";
             nComple = 1;
         |FINSI;

         |GRABA 020#h2321601.b;
     |FINSI;

     #h2321601#68 = #maempr19#3;
     #h2321601#69 = #maempr19#4;
|FPRC;

|PROCESO maempr20;
     |SI nNumLin = 3;
         |GRABA 020#h2321601.a;
         |LIBERA #h2321601;

         nNumReg  = nNumReg + 1;
         |HAZ Graba19;

         nNumLin  = 0;
     |FINSI;

     nCmp            = (nNumLin * 7) + 70;
     #h2321601#nCmp# = #maempr20#4;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr20#5;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr20#6;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = "";

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr20#7;

     nCmp            = nCmp + 1;
     #h2321601#nCmp# = #maempr20#8;

     nCmp            = nCmp + 1;
     enCanti         = #maempr20#9;  |HAZ Calcula17D;
     #h2321601#nCmp# = eaAlfa;

     nNumLin  = nNumLin + 1;
|FPRC;

|DEFBUCLE maempr20;
     #maempr20#1;
     ;
     #maempr19#0, #maempr19#1, #maempr19#5, #maempr19#2, 00;
     #maempr19#0, #maempr19#1, #maempr19#5, #maempr19#2, 99;
     ;
     NULL, maempr20;
|FIN;

|PROCESO maempr19;
     nNumReg  = nNumReg + 1;
     |HAZ Graba19;

     nNumLin  = 0;
     |BUCLE maempr20;

     |GRABA 020#h2321601.a;
     |LIBERA #h2321601;
|FPRC;

|DEFBUCLE maempr19;
     #maempr19#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     ;
     NULL, maempr19;
|FIN;

|PROCESO DatosEmpresa;
     |ABRE #maempr10;
     #maempr10#0 = #isom9232#0;
     #maempr10#1 = #isom9232#1;
     |LEE 000#maempr10.=;
     |SI FSalida ! 0;  |DDEFECTO #maempr10;  |FINSI;
     |CIERRA #maempr10;

     |ABRE #agim0019;
     #agim0019#0 = #maempr10#0;
     #agim0019#1 = 99;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;
     |CIERRA #agim0019;

     aCNAE = "";
     |SI FSalida = 0;  |Y #agim0019#0 = #maempr10#0;
         aCNAE = #agim0019#40;  |QBF aCNAE;

         |SI aCNAE = "";
             aCNAE = #agim0019#81;  |QBF aCNAE;
         |FINSI;
     |FINSI;

     #h2321601#7  = #isom9232#3;
     #h2321601#8  = #isom9232#4;
     #h2321601#10 = #isom9232#1;
     #h2321601#11 = "0A";

     aAlfa1 = "01.01." + #isom9232#1;
     aAlfa2 = "31.12." + #isom9232#1;
     |SI #maempr10#31 = aAlfa1;  |Y #maempr10#32 = aAlfa2;
         #h2321601#12 = "1";                    || Todo el Ejercicio
     |SINO;
         fFechaD = #maempr10#31;
         fFechaH = #maempr10#32;
         nFecha  = (fFechaH - fFechaD) + 1;
         |SI nFecha ] 365;
             #h2321601#12 = "2";                || No coincide con el A¤o Natural
         |SINO;
             #h2321601#12 = "3";                || No todo el Ejercicio
         |FINSI;
     |FINSI;

     #h2321601#13 = (#maempr10#31 % 102) + (#maempr10#31 % 402) + (#maempr10#31 % 704);
     #h2321601#14 = (#maempr10#32 % 102) + (#maempr10#32 % 402) + (#maempr10#32 % 704);
     #h2321601#15 = aCNAE;

     |SI #isom9232#2 > 0;
         #h2321601#16 = #isom9232#5;
         #h2321601#17 = #isom9232#9;
     |FINSI;
|FPRC;

|PROCESO Hoja1;
     #h2321601#0 = 1;
     |LEE 000#h2321601.=;
     |SI FSalida ! 0;
         |DDEFECTO #h2321601;
         #h2321601#0  = 1;

         |HAZ DatosEmpresa;

         |GRABA 020#h2321601.n;
         |LIBERA #h2321601;
     |FINSI;

     nNumReg = 0;    |BUCLE maempr18;
     nNumReg = 0;    |BUCLE maempr19;

     |CIERRA #h2321601;
|FPRC;

|PROCESO h2321601;
     |PARA nCmp = 1;  |SI nCmp [ 96;  |HACIENDO nCmp = nCmp + 1;
           eaAlfa = #h2321601#nCmp#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;

|DEFBUCLE h2321601;
     #h2321601#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, h2321601;
|FIN;

|PROCESO h2321602;
     |PARA nCmp = 1;  |SI nCmp [ 156;  |HACIENDO nCmp = nCmp + 1;
           eaAlfa = #h2321602#nCmp#;  |HAZ GrabaSecuencial;
     |SIGUE;
|FPRC;

|DEFBUCLE h2321602;
     #h2321602#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, h2321602;
|FIN;

|PROCESO EmiteV2016;
     aFicTmp = "h2321601" + Usuario;
     |NOME_DAT #h2321601#aFicTmp#;
     |ABRE #h2321601; |CIERRA #h2321601; |DELINDEX #h2321601;

     aFicTmp = "h2321602" + Usuario;
     |NOME_DAT #h2321602#aFicTmp#;
     |ABRE #h2321602; |CIERRA #h2321602; |DELINDEX #h2321602;

     |ABRET #h2321601;
     |ABRET #h2321602;

     |HAZ Hoja1;
     |HAZ Hoja2;

     |CIERRAT #h2321601;
     |CIERRAT #h2321602;

     |CIERRA #agim0019;

     eaAlfa = "<T2320" + #isom9232#1 + "0A0000>";  |HAZ GrabaSecuencial;
     eaAlfa = "<AUX>";       |HAZ GrabaSecuencial;
     eaAlfa = " " * 70;      |HAZ GrabaSecuencial;
     eaAlfa = "1.00";        |HAZ GrabaSecuencial;
     eaAlfa = "    ";        |HAZ GrabaSecuencial;
     eaAlfa = "B53179768";   |HAZ GrabaSecuencial;
     eaAlfa = " " * 213;     |HAZ GrabaSecuencial;
     eaAlfa = "</AUX>";      |HAZ GrabaSecuencial;

     |BUCLE h2321601;
     |BUCLE h2321602;

     eaAlfa = "</T2320" + #isom9232#1 + "0A0000>";  |HAZ GrabaSecuencial;
     eaAlfa = &13 + &10;  |HAZ GrabaSecuencial;

     |DELINDEX #h2321601;
     |DELINDEX #h2321602;
|FPRC;
