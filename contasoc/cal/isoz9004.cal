|FICHEROS;
     isoz9004;

     isom9232;
     maempr18;
     maempr19;
     maempr20;
     maempr14;
     maempr15;

     isom232@;
     maacceso;
|FIN;

|VARIABLES;
     aParam       = "";
     nEjerDestino = 0;
     nEjerOrigen  = 0;
     nCompOrigen  = 0;
     aAlfa        = "";
     nVent        = 0;
     nVentana     = 0;

     aMas         = "";
     aDef         = "";
     aAbre        = "";
     aBase        = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

    &enEmpresa = 0;
    &eaBloqueo = "";
|FIN;

|PROCESO VentanaTrabajo;
     |VENTANA 0501, 0540, -1, 16, "Realizando trabajo";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;  |PTEC 802;  |PAUSA;
     |PULSATECLA;
|FPRC;

|PROCESO FinVentanaTrabajo;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
     |PULSATECLA;
|FPRC;

|PROCESO MiraBloqueo;
     |DBASS aBase;
     aAbre = aBase + "integral/def/dsam0021.mas";
     |XABRE "E", aAbre, 0;
     |SI FSalida ] 0;
         aAlfa = ":integral/dsam0021;" + (("00000" + #isom9232#0) % -105);
         aAlfa = aAlfa + "CHEQUEO";
         |SUB_EJECUTA aAlfa;
     |FINSI;
|FPRC;

|PROCESO maempr18B;
     |BORRA 020#maempr18.a;
     |LIBERA #maempr18;
|FPRC;

|DEFBUCLE maempr18B;
     #maempr18#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     be;
     NULL, maempr18B;
|FIN;

|PROCESO maempr19B;
     |BORRA 020#maempr19.a;
     |LIBERA #maempr19;
|FPRC;

|DEFBUCLE maempr19B;
     #maempr19#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     be;
     NULL, maempr19B;
|FIN;

|PROCESO maempr20B;
     |BORRA 020#maempr20.a;
     |LIBERA #maempr20;
|FPRC;

|DEFBUCLE maempr20B;
     #maempr20#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99, 99;
     be;
     NULL, maempr20B;
|FIN;

|PROCESO maempr14B;
     |BORRA 020#maempr14.a;
     |LIBERA #maempr14;
|FPRC;

|DEFBUCLE maempr14B;
     #maempr14#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     be;
     NULL, maempr14B;
|FIN;

|PROCESO maempr15B;
     |BORRA 020#maempr15.a;
     |LIBERA #maempr15;
|FPRC;

|DEFBUCLE maempr15B;
     #maempr15#1;
     ;
     #isom9232#0, #isom9232#1, #isom9232#2, 00;
     #isom9232#0, #isom9232#1, #isom9232#2, 99;
     be;
     NULL, maempr15B;
|FIN;

|PROCESO maempr18A;
     #maempr18#1  = #isom9232#1;
     #maempr18#12 = #isom9232#2;

     |GRABA 000#maempr18.n;
     |LIBERA #maempr18;
|FPRC;

|DEFBUCLE maempr18A;
     #maempr18#1;
     ;
     #isom9232#0, nEjerOrigen, nCompOrigen, 00;
     #isom9232#0, nEjerOrigen, nCompOrigen, 99;
     be;
     NULL, maempr18A;
|FIN;

|PROCESO maempr19A;
     #maempr19#1 = #isom9232#1;
     #maempr19#5 = #isom9232#2;

     |GRABA 000#maempr19.n;
     |LIBERA #maempr19;
|FPRC;

|DEFBUCLE maempr19A;
     #maempr19#1;
     ;
     #isom9232#0, nEjerOrigen, nCompOrigen, 00;
     #isom9232#0, nEjerOrigen, nCompOrigen, 99;
     be;
     NULL, maempr19A;
|FIN;

|PROCESO maempr20A;
     #maempr20#1  = #isom9232#1;
     #maempr20#10 = #isom9232#2;

     |GRABA 000#maempr20.n;
     |LIBERA #maempr20;
|FPRC;

|DEFBUCLE maempr20A;
     #maempr20#1;
     ;
     #isom9232#0, nEjerOrigen, nCompOrigen, 00, 00;
     #isom9232#0, nEjerOrigen, nCompOrigen, 99, 99;
     be;
     NULL, maempr20A;
|FIN;

|PROCESO maempr14A;
     #maempr14#1 = #isom9232#1;
     #maempr14#9 = #isom9232#2;

     |GRABA 000#maempr14.n;
     |LIBERA #maempr14;
|FPRC;

|DEFBUCLE maempr14A;
     #maempr14#1;
     ;
     #isom9232#0, nEjerOrigen, nCompOrigen, 00;
     #isom9232#0, nEjerOrigen, nCompOrigen, 99;
     be;
     NULL, maempr14A;
|FIN;

|PROCESO maempr15A;
     #maempr15#1 = #isom9232#1;
     #maempr15#9 = #isom9232#2;

     |GRABA 000#maempr15.n;
     |LIBERA #maempr15;
|FPRC;

|DEFBUCLE maempr15A;
     #maempr15#1;
     ;
     enEmpresa, nEjerOrigen, nCompOrigen, 00;
     enEmpresa, nEjerOrigen, nCompOrigen, 99;
     be;
     NULL, maempr15A;
|FIN;

|PROCESO LeoIsom232;

    enEmpresa   = #isom232@#0;
    |HAZ MiraBloqueo;
    |SI eaBloqueo = "3";
        |ACABA;
    |FINSI;

    nCompOrigen = #isom232@#2;

    #isom9232#0 = #isom232@#0;
    #isom9232#1 = #isom232@#1;
    #isom9232#2 = #isom232@#2 + 1;
    |LEE 041#isom9232.=;
    |SI FSalida = 0; |ACABA; |FINSI;

    #maacceso#0 = #isom232@#0;
    #maacceso#1 = nEjerDestino;
    |LEE 041#maacceso.=;
    |SI FSalida ! 0; |ACABA;  |FINSI;

    #isom9232#0 = #isom232@#0;
    #isom9232#1 = nEjerDestino;
    #isom9232#2 = 00;
    |LEE 041#isom9232.=;
    |SI FSalida = 0;
        |SI #isoz9004#4 = "N";
            |ACABA;
        |SINO;
            |SI #isom9232#6 = "S"; |ACABA; |FINSI;
            |BUCLE maempr18B;
            |BUCLE maempr19B;
            |BUCLE maempr20B;
            |BUCLE maempr14B;
            |BUCLE maempr15B;
        |FINSI;
    |SINO;
        |DDEFECTO #isom9232;
        #isom9232#0 = #isom232@#0;
        #isom9232#1 = nEjerDestino;
        #isom9232#2 = 0;
        #isom9232#3 = #isom232@#3;
        #isom9232#4 = #isom232@#4;
        |GRABA 020#isom9232.n;
    |FINSI;
    |LIBERA #isom9232;

    |BUCLE maempr18A;
    |BUCLE maempr19A;
    |BUCLE maempr20A;
    |BUCLE maempr14A;
    |BUCLE maempr15A;

    |LIBERA #isom232@;
|FPRC;

|DEFBUCLE LeoIsom232;
     #isom232@#1003;
     ;
     #isoz9004#0, #isoz9004#2, 00;
     #isoz9004#1, #isoz9004#2, 99;
     e;
     NULL, LeoIsom232;
|FIN;

|PROCESO T12; |TIPO 12;

     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     |CONFI "0000SSeguro que quiere realizar el proceso en estos momentos";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

||     |HAZ VentanaTrabajo;

     |DBASE aMas;
     aDef = aMas + "def/isom9232";
     |CARGA_DEF aDef, isom232@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nEjerOrigen  = #isoz9004#2;
     nEjerDestino = #isoz9004#3;

     |ABRE #isom9232;
     |ABRE #maacceso;

     |BUCLE LeoIsom232;

     |CIERRA #maacceso;
     |CIERRA #isom9232;

||     |HAZ FinVentanaTrabajo;
|FPRC;

|PROCESO EjerAnterior;
    |SI #isoz9004#2 ] #isoz9004#3;
        |MENAV "0000Ejercicio Incorrecto. ";
        |ERROR;
    |FINSI;
|FPRC;

|PROGRAMA;

     aParam = PARAMETRO;

     nEjerDestino = aParam;
     aAlfa =  "Recoger datos para el Ejercicio " + (("0000" + nEjerDestino) % -104);
     |QBF aAlfa;
     |VENTANA 0501, 1880, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #isoz9004#3 = nEjerDestino;
     #isoz9004#2 = nEjerDestino - 1;
     #isoz9004#4 = "N";

     |PINPA #0#isoz9004;
     |PINDA #0#isoz9004;

     |ENDATOS #1#isoz9004;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PULSATECLA;

     |FINVENTANA nVent;

     |PULSATECLA;
|FPRO;

|PROCESO T80;  |TIPO 80;
     FSalida = 2399;
|FPRC;
