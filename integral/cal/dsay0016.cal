|FICHEROS;
     dsay0016 #0;
     dsay0004 #1;

     dsam0000 #100;
     dsam0001 #101;
     dsam0002 #102;
     dsam0005 #105;
     dsam0053 #153;
     dsam0054 #154;
     dsam0005 #105;
     dsam0108 #108;
     dsam0111 #111;
     dsam0112 #112;

     :/modelos/def/dsmom004 #204;
     :/modelos/def/dsmod309 #209;
     :/contasoc/def/isacceso #300;
     :/dsarchi/def/dsarw010  #400;

     :/basica/def/agicen14 #6;
     :/basica/def/agitab99 #99;

     dsaw0026 #926;
     dsaw0032 #932;
     rentas@  #900;
|FIN;

|VARIABLES;
     nVentana        = 0;
     nVent           = 0;
     nSubVent        = 0;
     nPanta          = 0;
     nMes            = 0;
     nAnyo           = 0;
     nRango          = 0;
     nGrid           = 0;
     nBoton1         = 0;
     nBoton2         = 0;
     nBoton3         = 0;
     nBoton4         = 0;
     nBoton5         = 0;
     nHandle         = 0;
     nError          = 0;
     nInstala        = 0;
     nContador       = 0;
     nCampo          = 0;
     nDCodigo        = 0;
     nHCodigo        = 0;
     nPosi           = 0;
     nCodigo         = 0;
     nLinea          = 0;
     nHastaCampo     = 0;

     aCampo          = "";
     aCaracter       = "";
     aUsuario        = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aFichero        = "";
     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aTipo           = "";
     aEMail          = "";
     aBasePla        = "";
     aOrigen         = "";
     aDestino        = "";
     aAbre           = "";
     aDirBasico      = "";
     aDirDsPdf       = "";
     aBase           = "";
     aDef            = "";
     aDocRemoto      = "";
     aDocServidor    = "";
     aDirCorreo      = "";
     aIP             = "";
     aFrom           = "";
     aTo             = "";
     aAsunto         = "";
     aSalida         = "";
     aMensaje        = "";
     aAdjunto        = "";
     aAutenti        = "";

     fFecha          = @;

     {1}aContiene    = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";

     &enCodUbica     = 0;
     &eaAlfa         = "";
     &eaOrigen       = "";
     &eaDestino      = "";
     &eaFicheroTra   = "";
     &eaFicheroPlaGz = "";
     &eaFicheroPlaMl = "";
     &eaDirPlantilla = "";
     &eaDirSerPlaMl  = "";
     &eaDirSerPlan   = "";
     &eaDirTrabajo   = "";
     &eaDirTrabServi = "";
     &eaRutaOrigen   = "";
     &eaRutaDestino  = "";
     &eaFicheroTxt   = "";
     &eaFicheroTgz   = "";
     &eaFicheroTar   = "";
     &enHandleTxt    = 0;
     &eaAsigna       = "";
     &eaExtension    = "";
     &eaRutaDocumento= "";
     &enSwNuevoMD5   = 0;
     &eaUnidadBasico = "";
|FIN;

|PROCESO InstalaDSPDF;
     nInstala = 0;

     aDirBasico = "\ds";                     |RMKDIR aDirBasico;
     aDirBasico = aDirBasico + "\bin";       |RMKDIR aDirBasico;
     aDirBasico = aDirBasico + "\";
     aDirDsPdf  = "\ds\dspdf\bin\";
     aAlfa      = aDirDsPdf + "puerto.exe";
     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;  nInstala = 1;  |FINSI;

     |DBASE aBase;  |QBF aBase;

     eaOrigen  = eaDirSerPlan + "dspdf.tgz";
     eaDestino = aDirBasico + "dspdf.tgz";

     |HAZ EnviaFicheroConMD5;
     |SI enSwNuevoMD5 = 1;
         nInstala = 1;
     |FINSI;

     |SI nInstala = 1;
         aAlfa = aDirBasico + "dspdf.tgz";
         Pos   = -1;
         |RDESCOMPRIME aAlfa;
         |RDETAR aAlfa, "\ds\";

         aAlfa = aDirBasico + "dspdf.tar";  |RFBORRA aAlfa;

         aAlfa = aDirDsPdf + "puerto.exe";
         |XABRE "EC", aAlfa, nHandle;
         |SI FSalida < 0;
             |MENAV "0000 No puedo instalar la impresora en PDF.";
             |ACABA;
         |FINSI;

         aAlfa  = "cmd " + &34 + "/c START /WAIT " + aDirDsPdf + "PUERTO.EXE" + &34;
         |RSYSTEM aAlfa;
     |FINSI;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO TraeteDoc;
     enCodUbica  = #111#2;  |HAZ LeeUbicaciones;

     |DBASE aBasePla;      |QBF aBasePla;
     eaDirPlantilla = eaUnidadBasico + "\DOCUMENTOS\PLANING\";
     eaDirTrabajo   = eaUnidadBasico + "\DOCUMENTOS\PLANING\";
     eaDirTrabServi = aBasePla  + "tmp/";   |MKDIR eaDirTrabServi;
     eaFicheroTxt   = #111#4 + ".txt";                 |QBT eaFicheroTxt;
     eaFicheroTra   = #111#4 + "." + eaExtension;      |QBT eaFicheroTra;

     aOrigen   = eaRutaDocumento + "/"    + #111#4 + "." + eaExtension;  |QBT aOrigen;
     aDestino  = eaUnidadBasico + "/DOCUMENTOS/PLANING/" + #111#4 + "." + eaExtension;  |QBT aDestino;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocServidor  = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         |RCOPIA_FICHERO aOrigen, aDestino;
         |SI FSalida ! 0;
             nError = 1;
             |MENAV "      No se ha podido copiar el Documento al Directorio de Trabajo";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsam0112;
     nContador = nContador + 1;
     aAlfa     = ("00000" + #112#1) % -105;

     #932#0    = #112#1;
     |SI #112#5 = "dsam0000";  |O #112#5 = "dsay0004";  |O #112#5 = "dsmom004";
         #932#1 = "#" + (aAlfa % 102) + "#" + "0" + (aAlfa % 303);
     |SINO;
         #932#1 = "#" + (aAlfa % 102) + "#" + nCampo + (aAlfa % 303);
     |FINSI;

     #932#2 = "";
     #932#3 = 0;
     #932#4 = #112#6;
     #932#5 = #112#7;
     |GRABA 020#932n;
     |LIBERA #932;
|FPRC;

|DEFBUCLE dsam0112;
     #112#1;
     ;
     #0#1, nDCodigo;
     #0#1, nHCodigo;
     ;
     NULL, dsam0112;
|FIN;

|PROCESO dsam0000;
     |ABRE #100;
     #100#0 = #926#0;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;;

     #932#0 = 01000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "01";  |LIBERA #932;  |SAL;  |FINSI;
             |SI #932#3 = 0;
                 aCampo = (("00000" + #932#0) % -105) % 303;
                 nCampo = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #100nCampo) % nPosi;
                 |SINO;
                     #932#2 = #100nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|PROCESO dsay0004;
     |ABRE #108;
     #108#0 = #0#0;
     |LEE 000#108=;
     |SI FSalida ! 0;  |DDEFECTO #108;  |FINSI;
     |CIERRA #108;

     |DDEFECTO #1;
     #1#0  = #0#1;
     #1#1  = #0#2;
     #1#65 = #0#0;
     #1#66 = #108#1;
     #1#67 = #0#8;

     #932#0 = 07000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "07";  |LIBERA #932;  |SAL;  |FINSI;
             |SI #932#3 = 0;
                 aCampo = (("00000" + #932#0) % -105) % 303;
                 nCampo = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #1nCampo) % nPosi;
                 |SINO;
                     #932#2 = #1nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|PROCESO dsmom004I;
     |SI #0#3 ! 100;  |Y  #0#3 ! 200;  |Y #0#3 ! 309;
         |ABRE #204;
         #204#0  = #926#0;
         #204#1  = #0#6;
         #204#2  = #0#4;
         #204#3  = #0#3;
         #204#4  = 99;
         |LEE 000#204];
         |SI FSalida ! 0;
             |LEE 000#204u;
         |SINO;
             |LEE 000#204a;
         |FINSI;

         |SI FSalida ! 0;  |O #204#0 ! #926#0;  |O  #204#1 ! #0#6;
                           |O #204#2 ! #0#4;    |O  #204#3 ! #0#3;
             |DDEFECTO #204;
         |FINSI;
         |CIERRA #204;
     |FINSI;

     |SI #0#3 = 100;
         |DBASS aDef;  |QBF aDef;
         aDef = aDef + "ren" + #0#6 + "/def/reacceso.mas";
         |CARGA_DEF aDef, rentas@;
         |SI FSalida ] 0;
             |ABRE #900;
             #900#0 = #926#0;
             |LEE 000#900=;
             |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
             |CIERRA #900;

             |DDEFECTO #204;
             #204#0  = #926#0;
             #204#1  = #0#6;
             #204#2  = 99;
             #204#3  = 100;

             |DESCARGA_DEF #rentas@;
         |FINSI;
     |FINSI;

     |SI #0#3 = 200;
         |ABRE #300;
         #300#0 = #926#0;
         #300#1 = #0#6;
         |LEE 000#300=;
         |SI FSalida ! 0;  |DDEFECTO #300;  |FINSI;
         |CIERRA #300;

         |DDEFECTO #204;
         #204#0  = #926#0;
         #204#1  = #0#6;
         #204#2  = 99;
         #204#3  = 200;
         #204#15 = #300#8;
     |FINSI;

     |SI #0#3 = 309;
         |DBASS aAlfa;  |QBF aAlfa;
         aAlfa = aAlfa + "modelos/fich/";
         |PATH_DAT #209 aAlfa;

         |ABRE #209;
         #209#0 = #926#0;
         #209#1 = 1;
         #209#2 = #0#6;
         #209#3 = #0#4;
         #209#4 = 0;
         #209#5 = 0;
         |LEE 000#209];
         |SI FSalida ! 0;  |DDEFECTO #209;  |FINSI;
         |CIERRA #209;

         |DDEFECTO #204;
         #204#0  = #926#0;
         #204#1  = #0#6;
         #204#2  = #0#4;
         #204#3  = 309;
         #204#4  = #209#4;
         #204#7  = #209#9;
         #204#8  = #209#10;
         #204#9  = #209#11;
         #204#10 = #209#12;
         #204#11 = #209#13;
         #204#12 = #209#14;
         #204#13 = #209#16;
         #204#14 = #209#17;
         #204#15 = #209#18;
     |FINSI;

     #932#0 = 08000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "08";  |LIBERA #932;  |SAL;  |FINSI;
             |SI #932#3 = 0;
                 aCampo = (("00000" + #932#0) % -105) % 303;
                 nCampo = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #204nCampo) % nPosi;
                 |SINO;
                     #932#2 = #204nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|PROCESO dsam0002;
     nCodigo   = 0;
     nContador = nContador + 1;
     |SI nContador > 5;  |ERROR10;  |ACABA;  |FINSI;

     #932#0 = 02000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "02";  |LIBERA #932;  |SAL;  |FINSI;

             |SI #932#3 = 0;  |Y nCodigo ! #932#0;
                 nCodigo = #932#0;
                 aCampo  = (("00000" + #932#0) % -105) % 303;
                 nCampo  = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #102nCampo) % nPosi;
                 |SINO;
                     #932#2 = #102nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|DEFBUCLE dsam0002;
     #102#1;
     ;
     #926#0, 1;
     #926#0, 99;
     ;
     NULL, dsam0002;
|FIN;

|PROCESO dsam0005;
     nCodigo   = 0;
     nContador = nContador + 1;
     |SI nContador > 5;  |ERROR10;  |ACABA;  |FINSI;

     #932#0 = 03000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "03";  |LIBERA #932;  |SAL;  |FINSI;

             |SI #932#3 = 0;  |Y nCodigo ! #932#0;
                 nCodigo = #932#0;
                 aCampo  = (("00000" + #932#0) % -105) % 303;
                 nCampo  = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #105nCampo) % nPosi;
                 |SINO;
                     #932#2 = #105nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|DEFBUCLE dsam0005;
     #105#2;
     ;
     #926#0, 99;
     #926#0, 00;
     ;
     NULL, dsam0005;
|FIN;

|PROCESO agicen14;
     nCodigo   = 0;
     nContador = nContador + 1;
     |SI nContador > 5;  |ERROR10;  |ACABA;  |FINSI;

     #932#0 = 04000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "04";  |LIBERA #932;  |SAL;  |FINSI;

             |SI #932#3 = 0;  |Y nCodigo ! #932#0;
                 nCodigo = #932#0;
                 aCampo  = (("00000" + #932#0) % -105) % 303;
                 nCampo  = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #6nCampo) % nPosi;
                 |SINO;
                     #932#2 = #6nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|DEFBUCLE agicen14;
     #6#1;
     ;
     #926#0, 00;
     #926#0, 99;
     ;
     NULL, agicen14;
|FIN;

|PROCESO dsam0053;
     nCodigo   = 0;
     nContador = nContador + 1;
     |SI nContador > 5;  |ERROR10;  |ACABA;  |FINSI;

     #932#0 = 05000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "05";  |LIBERA #932;  |SAL;  |FINSI;

             |SI #932#3 = 0;  |Y nCodigo ! #932#0;
                 nCodigo = #932#0;
                 aCampo  = (("00000" + #932#0) % -105) % 303;
                 nCampo  = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #153nCampo) % nPosi;
                 |SINO;
                     #932#2 = #153nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|DEFBUCLE dsam0053;
     #153#1;
     ;
     #926#0, "01.01.0000", 00, 00, 00;
     #926#0, "31.12.2999", 99, 99, 99;
     ;
     NULL, dsam0053;
|FIN;

|PROCESO dsam0054;
     nCodigo   = 0;
     nContador = nContador + 1;
     |SI nContador > 5;  |ERROR10;  |ACABA;  |FINSI;

     #932#0 = 06000;
     #932#1 = "      ";
     |LEE 101#932];
     |PARA;  |SI; |HACIENDO;
             aAlfa = (("00000" + #932#0) % -105) % 102;
             |SI FSalida ! 0;     |LIBERA #932;  |SAL;  |FINSI;
             |SI aAlfa   ! "06";  |LIBERA #932;  |SAL;  |FINSI;

             |SI #932#3 = 0;  |Y nCodigo ! #932#0;
                 nCodigo = #932#0;
                 aCampo  = (("00000" + #932#0) % -105) % 303;
                 nCampo  = aCampo;
                 |SI #932#5 = "N";
                     aCaracter = " ";
                     |SI #932#4 [ 5;  aCaracter = "0";  |FINSI;
                     nPosi  = -(100 + #932#4)
                     #932#2 = ((aCaracter * #932#4) + #154nCampo) % nPosi;
                 |SINO;
                     #932#2 = #154nCampo;
                 |FINSI;
                 #932#3 = 1;
                 |GRABA 020#932a;
             |FINSI;
             |LIBERA #932;

             |LEE 101#932s;
     |SIGUE;
|FPRC;

|DEFBUCLE dsam0054;
     #154#2;
     ;
     #926#0, 99;
     #926#0, 00;
     ;
     NULL, dsam0054;
|FIN;

|PROCESO dsaw0032;
     eaAlfa   = #932#2;   |HAZ QuitaRarosPlb;
     eaAsigna = "V" + #932#1;
     |HAZ AsignaWord;
|FPRC;

|DEFBUCLE dsaw0032;
     #932#1;
     ;
     00000, "        ";
     99999, "zzzzzzzz";
     ;
     NULL, dsaw0032;
|FIN;

|PROCESO CargaVariables;
     aFichero = ("32" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #932 aFichero;
     |ABRE #932;  |CIERRA #932;  |DELINDEX #932;

     |ABRE #932;

     nContador   = 0;
     nDCodigo    = 01000;  nHCodigo  = 01999;  |BUCLE dsam0112;
     nDCodigo    = 07000;  nHCodigo  = 07999;  |BUCLE dsam0112;
     nDCodigo    = 08000;  nHCodigo  = 08999;  |BUCLE dsam0112;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 02000;  nHCodigo  = 02999;  |BUCLE dsam0112;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 03000;  nHCodigo  = 03999;  |BUCLE dsam0112;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 04000;  nHCodigo  = 04999;  |BUCLE dsam0112;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 05000;  nHCodigo  = 05999;  |BUCLE dsam0112;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 06000;  nHCodigo  = 06999;  |BUCLE dsam0112;
     |SIGUE;

     |HAZ dsam0000;
     |HAZ dsay0004;
     |HAZ dsmom004I;

     nContador = 0;  |BUCLE dsam0002;
     nContador = 0;  |BUCLE dsam0005;
     nContador = 0;  |BUCLE agicen14;
     nContador = 0;  |BUCLE dsam0053;
     nContador = 0;  |BUCLE dsam0054;

     |CIERRA #932;

     |BUCLE dsaw0032;

     |DELINDEX #932;
|FPRC;

|PROCESO GrabaDocumento;
     |ABRE #108;
     #108#0 = #0#0;
     |LEE 000#108=;
     |SI FSalida ! 0;  |DDEFECTO #108;  |FINSI;
     |CIERRA #108;

     |ABRE #154;
     #154#0  = #926#0;
     #154#1  = 9999;
     |LEE 040#154];
     |SI FSalida = 0;
         |LEE 040#154a;
     |SINO;
         |LEE 040#154u;
     |FINSI;
     |SI FSalida = 0;  |Y #154#0 = #926#0;
         nLinea = #154#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |DDEFECTO #154;
     |HORA aAlfa;
     aAlfa1 = aAlfa % 102;
     aAlfa2 = aAlfa % 402;

     #154#0  = #926#0;
     #154#1  = nLinea;
     #154#2  = #111#1;
     #154#3  = ((eaExtension + "zzz") % 103) + (("00000" + #154#0) % -105) + (("0000" + #154#1) % -104) + "." + eaExtension;
     #154#4  = ~;
     #154#5  = aAlfa1;
     #154#6  = aAlfa2;
     #154#7  = ~;
     #154#8  = aAlfa1;
     #154#9  = aAlfa2;
     #154#10 = enCodUbica;
     #154#11 = #0#0;
     #154#12 = #108#1;
     |GRABA 020#154n;
     |LIBERA #154;
     |CIERRA #154;

     aOrigen  = eaDirTrabajo + (("00000" + #926#0) % -105) + "." + eaExtension;
     aDestino = eaRutaDocumento + "/" + ((eaExtension + "zzz") % 103) + (("00000" + #926#0) % -105) + (("0000" + nLinea) % -104) + "." + eaExtension;
     |QBT aOrigen;
     |QBT aDestino;

     |RCOPIA_FICHERO aOrigen, aDestino;
     |SI FSalida ! 0;
         |MENAV "     No se ha podido copia el Documento al Cliente.";
     |FINSI;
|FPRC;

|PROCESO CargaTexto;
     aAbre    = aDirCorreo + "/adjunto.txt";
     |XABRE "WB", aAbre, nHandle;

     aAlfa  = " " + &13 + &10;
     |XGRABA nHandle, aAlfa;

     |PARA nCampo = 59;  |SI nCampo ] 10;  |HACIENDO nCampo = nCampo - 1;
          eaAlfa  = #0nCampo;
          |QBF eaAlfa;
          |SI eaAlfa ! "";
              nHastaCampo = nCampo;
              |SAL;
          |FINSI;
     |SIGUE;

     |PARA nCampo = 10;  |SI nCampo [ nHastaCampo;  |HACIENDO nCampo = nCampo + 1;
          eaAlfa  = #0nCampo + &13 + &10; |HAZ QuitaRarosPlb;
          |XGRABA nHandle, eaAlfa;
     |SIGUE;

     |XCIERRA nHandle;
|FPRC;

|PROCESO MandaCorreo;
     aDirCorreo  = aBasePla + "dscorreo/";  |MKDIR aDirCorreo;
     eaDestino   = eaDirTrabajo + (("00000" + #926#0) % -105) + ".pdf";
     eaOrigen    = aDirCorreo + "adjunto.pdf";
     |HAZ RecibeFichero;

     aIP      = #400#18;  |QBF aIP;
     aFrom    = #101#8;   |QBF aFrom;
     aSalida  = #400#19;  |QBF aSalida;

     aTo      = #926#3;   |QBF aTo;
     eaAlfa   = #0#9;     |HAZ QuitaRarosPlb;
     aAsunto  = eaAlfa;   |QBF aAsunto;
     aMensaje = "";

     |HAZ CargaTexto;
     aMensaje = "$$$$" + aAbre;

     aAdjunto = aDirCorreo + "adjunto.pdf";

     |SI #400#20 = "N";
          aAutenti = "!" + aFrom;
     |SINO;
          aAutenti = "!" + #400#22;
          |QBF aAutenti;
          aAutenti = aAutenti + ":" + #400#21;
          |QBF aAutenti;
          aAutenti = aAutenti + ":" + aFrom;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAdjunto;
     |SI FSalida ] 0;
         |BORRA 020#926a;
         |LIBERA #926;
     |FINSI;

     aAlfa  = eaDirTrabajo + (("00000" + #926#0) % -105) + ".pdf";
     |RFBORRA aAlfa;

     aAlfa  = aDirCorreo + "/adjunto.txt";  |FBORRA aAlfa;
     aAlfa  = aDirCorreo + "/adjunto.pdf";  |FBORRA aAlfa;
|FPRC;

|PROCESO dsaw0026I;
     |SI #926#4 = "CANCELADO ";
         |BORRA 020#926a;
         |LIBERA #926;
         |ACABA;
     |FINSI;

     aAlfa = "LABEL,{{0}}" + (("00000" + #926#0) % -105) + " " + #926#1;
     |CONTROL_SIMPLE 0, aAlfa, 1412, 1479, NULL;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroTra + "#" + eaDirTrabajo + (("00000" + #926#0) % -105) + "." + eaExtension + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     aAlfa = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     |HAZ CargaVariables;

     |SI #926#4 = "CORREO    "
         eaAlfa = "[IMPRESORA]#I#2#dspdf#2" + &13 + &10;
     |SINO;
         eaAlfa = "[IMPRESORA]#I#0" + &13 + &10;
     |FINSI;
     |XGRABA enHandleTxt, eaAlfa;

     |XCIERRA enHandleTxt;


     eaOrigen  = eaDirTrabServi + eaFicheroTxt;
     eaDestino = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     |FBORRA eaOrigen;

     |HAZ AbreWordExterno;

     |SI #111#5 = "S";
         |HAZ GrabaDocumento;
     |FINSI;

     |SI #926#4 = "CORREO    ";
         |HAZ MandaCorreo;
     |SINO;
         |BORRA 020#926a;
         |LIBERA #926;
     |FINSI;

     aAlfa  = eaDirTrabajo + (("00000" + #926#0) % -105) + "." + eaExtension;
     |RFBORRA aAlfa;
|FPRC;

|DEFBUCLE dsaw0026I;
     #926#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsaw0026I;
|FIN;

|PROCESO Evento926;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#926=;
     |FINSI;
|FPRC;

|PROCESO dsaw0026;
     aAlfa = #926#3;  |QBF aAlfa;

     |SI aTipo = "";
         #926#4 = "PAPEL";
         |SI #0#7 = "1";
             #926#4 = "CORREO";
             |SI aAlfa = "";
                 #926#4 = "CANCELADO";
             |FINSI;
         |FINSI;

         |SI #0#7 = "3";
             |SI aAlfa ! "";
                 #926#4 = "CORREO";
             |FINSI;
         |FINSI;
     |SINO;
          #926#4 = aTipo;
     |FINSI;

     |GRABA 020#926a;
     |LIBERA #926;
|FPRC;

|DEFBUCLE dsaw0026;
     #926#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsaw0026;
|FIN;

|PROCESO Boton1;
     aTipo = "";
     |BUCLE dsaw0026;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Boton2;
     aTipo = "CANCELADO";
     |BUCLE dsaw0026;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Boton3;
     |SI #926#4 = "CORREO    ";  |O  #926#4 = "PAPEL     ";
         |ACABA;
     |FINSI;

     |LEE 101#926=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aTipo = "";
     |HAZ dsaw0026;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Boton4;
     |SI #926#4 = "CANCELADO ";
         |ACABA;
     |FINSI;

     |LEE 101#926=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aTipo = "CANCELADO";
     |HAZ dsaw0026;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO Boton5;
     |VENTANA 1201, 1581, -1, 16, "Introduzca el e_mail";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aEMail = #926#3;
     E_inf  = "";
     E_sup  = "80";
     aEMail = 1301 ? 1;

     #926#3 = aEMail;
     |GRABA 020#926a;
     |LIBERA #926;

     |CONFI "0000NGrabamos en E_MAIL en la ficha del cliente.";
     |SI FSalida = 0;
         |ABRE #100;
         #100#0 = #926#0;
         |LEE 101#100=;
         |SI FSalida = 0;
             #100#71 = #926#3;
             |GRABA 020#100a;
             |LIBERA #100;
         |FINSI;
         |CIERRA #100;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nSubVent;

     |REFRESCACONTROL nGrid;
     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO GrabaTemporal;
     |DDEFECTO #926;
     #926#0 = #100#0;
     #926#1 = #100#1;
     #926#2 = 0;
     #926#3 = #100#71;

     aAlfa  = #100#71;  |QBF aAlfa;
     #926#4 = "PAPEL";
     |SI #0#7 = "1";
         #926#4 = "CORREO";
         |SI aAlfa = "";
             #926#4 = "CANCELADO";
         |FINSI;
     |FINSI;

     |SI #0#7 = "3";
         |SI aAlfa ! "";
             #926#4 = "CORREO";
         |FINSI;
     |FINSI;

     |GRABA 020#926n;
     |LIBERA #926;
|FPRC;

|PROCESO dsmom004;
     #926#0 = #204#0;
     |LEE 000#926=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #100#0 = #204#0;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

     #100#0 = #204#0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE dsmom004;
     #204#1;
     ;
     00001, #0#6, #0#4, #0#3, 00;
     99999, #0#6, #0#4, #0#3, 99;
     ;
     NULL, dsmom004;
|FIN;

|PROCESO reacceso;
     #926#0 = #900#0;
     |LEE 000#926=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #100#0 = #900#0;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

     #100#0 = #900#0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE reacceso;
     #900#1001;
     ;
     00001;
     99999;
     ;
     NULL, reacceso;
|FIN;

|PROCESO isacceso;
     #926#0 = #300#0;
     |LEE 000#926=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #100#0 = #300#0;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

     #100#0 = #300#0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE isacceso;
     #300#1;
     ;
     #0#6, 00001;
     #0#6, 99999;
     ;
     NULL, isacceso;
|FIN;

|PROCESO dsmod309;
     #926#0 = #209#0;
     |LEE 000#926=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #100#0 = #209#0;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;

     #100#0 = #209#0;
     |HAZ GrabaTemporal;
|FPRC;

|DEFBUCLE dsmod309;
     #209#1;
     ;
     00001, 00, #0#6, #0#4, 00, 00;
     99999, 99, #0#6, #0#4, 99, 99;
     ;
     NULL, dsmod309;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |SI #0#7 = "1";  |O #0#7 = "3";
         aAlfa = #0#9;  |QBF aAlfa;
         |SI aAlfa = "";
             |MENAV "0000Introduzca texto en el asunto.";
             |ERROR;
             |ACABA;
         |FINSI;

         aAlfa = #0#10 + #0#11;  |QBF aAlfa;
         |SI aAlfa = "";
             |MENAV "0000Introduzca texto en el cuerpo.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     aFichero = ("26" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #926 aFichero;
     |ABRE #926;  |CIERRA #926;  |DELINDEX #926;

     |ABRE #926;
     |ABRE #100;

     |SI #0#3 = 100;
         |DBASS aDef;  |QBF aDef;
         aDef = aDef + "ren" + #0#6 + "/def/reacceso.mas";
         |CARGA_DEF aDef, rentas@;
         |SI FSalida ] 0;
             |BUCLE reacceso;
             |DESCARGA_DEF #rentas@;
         |FINSI;
     |FINSI;

     |SI #0#3 = 200;
         |BUCLE isacceso;
     |FINSI;

     |SI #0#3 = 309;
         |DBASS aAlfa;  |QBF aAlfa;
         aAlfa = aAlfa + "modelos/fich/";
         |PATH_DAT #209 aAlfa;
         |BUCLE dsmod309;
     |FINSI;

     |SI #0#3 ! 100;  |Y  #0#3 ! 200;  |Y #0#3 ! 309;
         |BUCLE dsmom004;
     |FINSI;

     |CIERRA #100;

     |LEE 000#926p;
     |SI FSalida ! 0;
         |MENAV "0000Selecci¢n vac¡a.";
         |CIERRA #926;
         |DELINDEX #926;
         |ACABA;
     |FINSI;

     |VENTANA 0801, 2999, -1, 16, "Selecci¢n de empresas";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |C_V #926#3, 1, "S";
     |C_V #926#4, 1, "S";

     |CONTROL_SIMPLE 0, "BOTON,Activar Todos", 2702, 2815, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Cancelar Todos", 2717, 2830, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Activar l¡nea", 2732, 2845, Boton3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Cancelar l¡nea", 2747, 2860, Boton4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Cambiar e_mail", 2762, 2875, Boton5;
     nBoton5 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#926, nRango, 0802, 2698, NULL, NULL, Evento926;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Emitir," + nGrid;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #926;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |CONFI "0000SConforme con lo seleccionado.";
     |SI FSalida ! 0;
         |DELINDEX #926;
         |ACABA;
     |FINSI;

     |VENTANA 1310, 1580, -1, 16, "Emitiendo mailing";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |HAZ TraeteDoc;
     |SI nError = 1;
         |ACABA;
     |FINSI;

     |DBASS eaDirSerPlan;  |QBF eaDirSerPlan;
     eaDirSerPlan   = eaDirSerPlan + "dsarchi/dlls/";

     |HAZ InstalaDSPDF;

     |PTEC 802;  |PAUSA;

     |BUCLE dsaw0026I;

     nError = 0;
     |ABRE #926;
     |LEE 000#926p;
     |SI FSalida = 0;
         |CONFI "0000SHan habido correos que no se han mandado. Desea consultarlos";
         |SI FSalida = 0;  nError = 1;  |FINSI;
     |FINSI;
     |CIERRA #926;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |SI nError = 1;
         |VENTANA 0801, 2999, -1, 16, "Correos no enviados";
         nVent = FSalida;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODAL";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |C_V #926#3, 1, "S";
         |C_V #926#4, 1, "S";

         |ABRE #926;
         nRango = 4 + 8 + 16 + 32 + 128;

         |LINEAL_SIMPLE #1#926, nRango, 0802, 2698, NULL, NULL, Evento926;
         nGrid = FSalida;

         aEsc1  = &255 + "806";
         aEsc2  = &255 + "807";
         aRetu  = &255 + "802";
         |PARA; |SI;  |HACIENDO;
              FSalida = "::{{001}}Salir," + nGrid;
              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL;  |FINSI;
              |SI aTecla = aEsc2; |SAL;  |FINSI;
              |SI aTecla = aRetu; |SAL;  |FINSI;
         |SIGUE;
         |CIERRA #926;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent;
     |FINSI;

     |DELINDEX #926;
|FPRC;

|PROCESO Tipo0C7;  |TIPO 0;
     |C_M #0#9,  1, "S";
     |C_M #0#10, 1, "S";
     |SI #0#7 = "2";
         |C_M #0#9,  1, "N";
         |C_M #0#10, 1, "N";
     |FINSI;

     |PINTA #0#9;
     |PINTA #0#10;
|FPRC;

|PROCESO Tipo0C4;  |TIPO 0;
     #0#5 = "          ";
     |SI #0#4 = 1;   #0#5 = "ENERO     ";  |FINSI;
     |SI #0#4 = 2;   #0#5 = "FEBRERO   ";  |FINSI;
     |SI #0#4 = 3;   #0#5 = "MARZO     ";  |FINSI;
     |SI #0#4 = 4;   #0#5 = "ABRIL     ";  |FINSI;
     |SI #0#4 = 5;   #0#5 = "MAYO      ";  |FINSI;
     |SI #0#4 = 6;   #0#5 = "JUNIO     ";  |FINSI;
     |SI #0#4 = 7;   #0#5 = "JULIO     ";  |FINSI;
     |SI #0#4 = 8;   #0#5 = "AGOSTO    ";  |FINSI;
     |SI #0#4 = 9;   #0#5 = "SEPTIEMBRE";  |FINSI;
     |SI #0#4 = 10;  #0#5 = "OCTUBRE   ";  |FINSI;
     |SI #0#4 = 11;  #0#5 = "NOVIEMBRE ";  |FINSI;
     |SI #0#4 = 12;  #0#5 = "DICIEMBRE ";  |FINSI;
     |SI #0#4 = 99;  #0#5 = "ANUAL     ";  |FINSI;

     |SI #0#5 = "          ";
         |MENAV "     Periodo Incorrecto.";
         |ERROR;
     |FINSI;

     |PINTA #0#4;
     |PINTA #0#5;
     |PINTA #0#6;
|FPRC;

|PROCESO Tipo0C3;  |TIPO 0;
     |ABRE #99;
     #99#0 = #0#3;
     |LEE 040#99=;
     |SI FSalida ! 0;  |DDEFECTO #99;  |FINSI;
     |CIERRA #99;

     |SI #0#3 ! 180;  |Y #0#3 ! 190;  |Y #0#3 ! 390;  |Y #0#3 ! 392;
      |Y #0#3 ! 193;  |Y #0#3 ! 184;  |Y #0#3 ! 296;
      |Y #0#3 ! 100;  |Y #0#3 ! 200;  |Y #0#3 ! 202;  |Y #0#3 ! 999;
         |SI #99#4 = "N";
             |MENAV "     Modelo sin Activar.";
             |ERROR;
         |FINSI;
     |FINSI;

     #0#4 = 0;
     |SI #0#3 = 180;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 184;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 190;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 193;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 296;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 390;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 392;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 347;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 100;  #0#4 = 99;  |FINSI;
     |SI #0#3 = 200;  #0#4 = 99;  |FINSI;

     fFecha = ~;
     aAlfa  = fFecha % -104;
     #0#6   = aAlfa;
     |SI #0#4 = 99;
         #0#6 = #0#6 - 1;
     |FINSI;

     |SI #0#4 = 99;
         |C_M #0#4, 1, "N";
     |SINO;
         fFecha = ~;
         aAlfa  = fFecha % 402;   nMes  = aAlfa;
         aAlfa  = fFecha % -104;  nAnyo = aAlfa;
         |SI #99#5 = "T";  |O #99#5 = "C";
             |SI nMes [ 3;
                 #0#4 = 12;
                 #0#6 = nAnyo - 1;
                 |HAZ Tipo0C4;
                 |ACABA;
             |FINSI;

             |SI nMes [ 6;
                 #0#4 = 3;
                 #0#6 = nAnyo;
                 |HAZ Tipo0C4;
                 |ACABA;
             |FINSI;

             |SI nMes [ 9;
                 #0#4 = 6;
                 #0#6 = nAnyo;
                 |HAZ Tipo0C4;
                 |ACABA;
             |FINSI;

             |SI nMes [ 12;
                 #0#4 = 9;
                 #0#6 = nAnyo;
                 |HAZ Tipo0C4;
                 |ACABA;
             |FINSI;
         |FINSI;

         |SI #99#5 = "A";
             #0#4 = 99;
             #0#6 = nAnyo - 1;
             |HAZ Tipo0C4;
         |FINSI;

         |SI #99#5 = "M";
             |SI nMes = 1;
                 #0#4 = 12;
                 #0#6 = nAnyo - 1;
             |SINO;
                 #0#4 = nMes - 1;
                 #0#6 = nAnyo;
             |FINSI;
             |HAZ Tipo0C4;
         |FINSI;
     |FINSI;

     |PINTA #0#4;
     |PINTA #0#5;
     |PINTA #0#6;
|FPRC;

|PROCESO Tipo0C1;  |TIPO 0;
     |ABRE #111;
     #111#0 = #0#1;
     |LEE 000#111=;
     |SI FSalida ! 0;
         |MENAV "0000No existe el MAILING";
         |CIERRA #111;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #111;

     |SI #111#6 = 0;
         |MENAV "0000El MAILING no lleva asociado ning£n MODELO";
         |ERROR;
         |ACABA;
     |FINSI;

     #0#2 = #111#1;  |PINTA #0#2;

     |C_M #0#3, 1, "N";  #0#3 = #111#6;  |PINTA #0#3;

     |SI #0#3 = 999;
         |C_M #0#3, 1, "S";  #0#3 = 0;  |PINTA #0#3;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "dsarchi/dsarchi.men";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;
         |MENAV "0000El programa necesita el GAD instalado con la configuraci¢n del DSCORREO.";
         |ACABA;
     |FINSI;

     aAlfa = aBase + "dsarchi/fich/";
     |PATH_DAT #400 aAlfa;
     |ABRE #400;
     |LEE 000#400p;
     |SI FSalida ! 0;  |DDEFECTO #400;  |FINSI;
     |CIERRA #400;

     aAlfa = #400#18 + #400#19;  |QBT aAlfa;
     |SI aAlfa = "";
         |MENAV "0000No est  configurado el DSCORREO en GAD.";
         |ACABA;
     |FINSI;

     |ABRE #101;
     |LEE 000#101p;
     |SI FSalida ! 0;  |DDEFECTO #101;  |FINSI;
     |CIERRA #101;

     aAlfa = #101#8;  |QBT aAlfa;
     |SI aAlfa = "";
         |MENAV "0000No est  configurada la cuenta del correo del DESPACHO en Datos Generales del Despacho.";
         |ACABA;
     |FINSI;

     aAlfa = eaUnidadBasico + "\DOCUMENTOS";                       |RMKDIR aAlfa;
     aAlfa = eaUnidadBasico + "\DOCUMENTOS\PLANING";               |RMKDIR aAlfa;

     aUsuario = Usuario % 810;

     |ABRE #0;
     #0#0 = aUsuario;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = aUsuario;
         |GRABA 020#0b;
     |FINSI;

     |VENTANA 0501, 2899, -1, 16, "Emisi¢n mailing por modelos";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#0;  nPanta = FSalida;
     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida = 0;
         |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;
|FPRO;
