|FICHEROS;
    dsaz0034;

    dsam0000;
    dsam0025;
    dsam0105;
    dsam0125;

    dsat0005,MANTE;

    :laboral/nomconca;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aFichero  = "";

     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;

     nImport1  = 0;
     nImport2  = 0;
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     nEmpresa  = 0;
     nEjer     = 0;
     nMes      = 0;
     nAlgun    = 0;

     nInkey    = 0;
     aBase     = "";
     nCanal    = 0;
     aPath     = "";

     &eaPathLaboral = "";
     &eaFichero  = "";
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpresa  = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDConve   = 0;
     &enHConve   = 0;
     &enDMes     = 0;
     &eaDMes     = "";
     &enHMes     = 0;
|FIN;

|CALCULO DMes; |TIPO 0;
    enDMes = #dsaz0034#1;
    |SI enDMes = 1;  #dsaz0034#2 = "Enero     "; |FINSI;
    |SI enDMes = 2;  #dsaz0034#2 = "Febrero   "; |FINSI;
    |SI enDMes = 3;  #dsaz0034#2 = "Marzo     "; |FINSI;
    |SI enDMes = 4;  #dsaz0034#2 = "Abril     "; |FINSI;
    |SI enDMes = 5;  #dsaz0034#2 = "Mayo      "; |FINSI;
    |SI enDMes = 6;  #dsaz0034#2 = "Junio     "; |FINSI;
    |SI enDMes = 7;  #dsaz0034#2 = "Julio     "; |FINSI;
    |SI enDMes = 8;  #dsaz0034#2 = "Agosto    "; |FINSI;
    |SI enDMes = 9;  #dsaz0034#2 = "Septiembre"; |FINSI;
    |SI enDMes = 10; #dsaz0034#2 = "Octubre   "; |FINSI;
    |SI enDMes = 11; #dsaz0034#2 = "Noviembre "; |FINSI;
    |SI enDMes = 12; #dsaz0034#2 = "Diciembre "; |FINSI;
    |PINTA #dsaz0034#2;
    eaDMes = #dsaz0034#2;
|FCAL;

|CALCULO HEmpresa; |TIPO 0;
    |SI #dsaz0034#4 < #dsaz0034#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0034#6 < #dsaz0034#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsaz0034#8 < #dsaz0034#7;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO DConvenio; |TIPO 0;
    nInkey = FSalida;

    |SI nInkey = 10;
        eaPathLaboral = "";
        |DBASS aBase;
        aAlfa = aBase + "laboral/def/labempre.mas";

        |XABRE "E", aAlfa, nCanal;
        |SI FSalida ] 0;
            eaPathLaboral   = aBase + "laboral/";
        |SINO;
            |MENAV "0000No existe laboral";
            |ACABA;
        |FINSI;

        aPath = eaPathLaboral + "fich/";
        |PATH_DAT #nomconca#aPath#;

        |ABRE #nomconca;
        #nomconca#0 = #dsaz0034#Campo#;
        |CONSULTA_CLAVE #1#nomconca;
        #dsaz0034#Campo# = #nomconca#0;
        |PINTA #dsaz0034#Campo#;
    |FINSI;

    |SI #dsaz0034#12 < #dsaz0034#11; |Y Campo = 11;
        |MENAV "0000Error. Hasta Convenio inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO LaFecha;
    |SI fFecha > "01.01.0000";
        fFecha = fFecha + "0.000001";
    |FINSI;
|FPRC;

|PROCESO ActuaDatos;
    #dsam0025#0 = #dsat0005#0;
    #dsam0025#1 = #dsat0005#1;
    #dsam0025#2 = #dsat0005#2;
    |LEE 141#dsam0025.=;
    |SI FSalida = 0;
        #dsam0025#8  = #dsat0005#8;
        #dsam0025#9  = #dsat0005#9;
        #dsam0025#10 = #dsat0005#10;
        #dsam0025#11 = #dsat0005#11;

        |GRABA 020#dsam0025.a;
        |LIBERA #dsam0025;

        |SI #dsat0005#32 = "S";  ||abrir ejercicio posterior
            #dsam0025#0 = #dsat0005#0;
            #dsam0025#1 = #dsat0005#1 + 1;
            #dsam0025#2 = #dsat0005#2;
            |LEE 141#dsam0025.=;
            |SI FSalida ! 0;
                |DDEFECTO #dsam0025;
                #dsam0025#0  = #dsat0005#0;
                #dsam0025#1  = #dsat0005#1 + 1;
                #dsam0025#2  = #dsat0005#2;
                #dsam0025#3  = #dsat0005#3;
                #dsam0025#4  = #dsat0005#4;
                fFecha = #dsat0005#5; |HAZ LaFecha; #dsam0025#5 = fFecha;
                fFecha = #dsat0005#6; |HAZ LaFecha; #dsam0025#6 = fFecha;
                fFecha = #dsat0005#7; |HAZ LaFecha; #dsam0025#7 = fFecha;
                #dsam0025#8  = #dsat0005#8 + #dsat0005#9;
                #dsam0025#9  = 0;
                #dsam0025#10 = #dsat0005#11;
                #dsam0025#11 = #dsat0005#11;
                #dsam0025#12 = #dsat0005#12;
                #dsam0025#25 = #dsat0005#25;
                #dsam0025#26 = #dsat0005#26;
                #dsam0025#27 = #dsat0005#27;
                |GRABA 020#dsam0025.b;
            |FINSI;
        |FINSI;
    |FINSI;
    |LIBERA #dsam0025;
|FPRC;

|DEFBUCLE ActuaDatos;
   #dsat0005#1;
   ;
   enDEmpresa, 2000,   enDConve;
   enHEmpresa, enEjer, enHConve;
   ;
   NULL, ActuaDatos;
|FIN;

|PROCESO PasoDatos;
   |ABRE #dsam0025;
   |BUCLE ActuaDatos;
   |CIERRA #dsam0025;
|FPRC;
|| *******************************************************************
|PROCESO GrabaAuxiliar1;

    #dsam0125#0 = #dsam0025#3;
    |LEE 041#dsam0125.=;
    |SI FSalida ! 0; |ACABA; |FINSI;
    |SI #dsaz0034#9 ! "T"; |Y #dsaz0034#9 ! #dsam0125#3;
        |ACABA;
    |FINSI;

    nGraba = 0;
    |SI #dsam0025#7 > "01.01.0000";
        aAlfa = #dsam0025#7; aAlfa = aAlfa % 402;  nMes  = aAlfa;
        aAlfa = #dsam0025#7; aAlfa = aAlfa % -104; nEjer = aAlfa;
        |SI nMes = enDMes; |Y nEjer = enEjer;
             nGraba = 1;
        |FINSI;
    |FINSI;
    |SI nGraba = 0; |ACABA; |FINSI;

    #dsat0005#0 = #dsam0025#0;
    #dsat0005#1 = #dsam0025#1;
    #dsat0005#2 = #dsam0025#2;
    |LEE 141#dsat0005.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0005;
        #dsat0005#0 = #dsam0025#0;
        #dsat0005#1 = #dsam0025#1;
        #dsat0005#2 = #dsam0025#2;
        |GRABA 020#dsat0005.b;
    |FINSI;
    |PARA nPara1 = 3; |SI nPara1 [ 27; |HACIENDO nPara1 = nPara1 + 1;
          #dsat0005#nPara1# = #dsam0025#nPara1#;
    |SIGUE;

    #dsat0005#28 = #dsam0000#1;
    #dsat0005#29 = #dsam0000#54;
    #dsat0005#30 = #dsam0000#72;
    #dsat0005#31 = #dsam0000#52;
    #dsat0005#32 = #dsaz0034#10;
    #dsat0005#33 = #dsam0125#5;
    #dsat0005#34 = #dsam0000#3;

    |GRABA 020#dsat0005.a;
    |LIBERA #dsat0005;

    nAlgun = 1;
|FPRC;

|DEFBUCLE dsam0025;
   #dsam0025#1;
   3;
   nEmpresa, 2000,   enDConve, #dsaz0034#3;
   nEmpresa, enEjer, enHConve, #dsaz0034#4;
   e;
   NULL, GrabaAuxiliar1;
|FIN;

|PROCESO LeoDsam0000;
   nEmpresa = #dsam0000#0;
   |BUCLE dsam0025;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   123,72;
   #dsaz0034#5, "S", enDAgente;
   #dsaz0034#6, "S", enHAgente;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO ClaveBaja005;
   #dsat0005#0 = enDEmpresa;
   #dsat0005#1 = 2000;
   #dsat0005#2 = enDConve;
|FPRC;

|PROCESO ClaveAlta005;
   #dsat0005#0 = enHEmpresa;
   #dsat0005#1 = enEjer;
   #dsat0005#2 = enHConve;
|FPRC;

|PROCESO Procesoz034;

     eaFichero = ("5z" + Usuario) % 108;
     |NOME_DAT #dsat0005#eaFichero#;
     |DELINDEX #dsat0005;

     aAlfa1 = #dsaz0034#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enEjer  = #dsaz0034#0;
     eaDLiqu = " ";
     eaHLiqu = "z";
     enDEmpresa = #dsaz0034#5;
     enHEmpresa = #dsaz0034#6;
     enDAgente  = #dsaz0034#7;
     enHAgente  = #dsaz0034#8;
     enDMes     = #dsaz0034#1;
     enHMes     = #dsaz0034#1;
     eaDMes     = #dsaz0034#2;
     enDConve   = #dsaz0034#11;
     enHConve   = #dsaz0034#12;

     |ABRE #dsat0005;

     nAlgun = 0;
     nGraba = 0;

     |ABRE #dsam0125;
     |BUCLE dsam0000;
     |CIERRA #dsam0125;

     |CIERRA #dsat0005;

     |SI nAlgun = 1;
         |PINPA #0#dsat0005;
         |ENTLINEAL #1#dsat0005, -3, 4, 22, 0, ClaveBaja005, ClaveAlta005;
         |CONFI "0000SActualizar Datos";
         |SI FSalida = 0;
             |HAZ PasoDatos;
         |FINSI;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsat0005;
|FPRC;

|PROGRAMA;

    aFuncion = "a";

    |CLS;
    |CABEZA "Regularizacion Seguros convenio";

    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsaz0034#0 = aAlfa;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % 0402;
    #dsaz0034#1 = aAlfa;

    |PINPA #0#dsaz0034;
    |PINDA #0#dsaz0034;

    |ENDATOS #2#dsaz0034;
    |SI FSalida = 0;
        |HAZ Procesoz034;
    |FINSI;
|FPRO;
