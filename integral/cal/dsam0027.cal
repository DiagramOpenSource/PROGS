|FICHEROS;
     :/integral/def/dsam0027;
     :/integral/def/dsam0028,MANTE;

     :/integral/def/dsam0029;
     :/integral/def/dsam0030;

     :/integral/def/dsam0026;
     :/integral/def/dsam0000;

     :/integral/def/dsam0127;
     :/integral/def/dsam0128;

     dsaw0043,MANTE;
     dsaw0044,MANTE;
     dsaw0046,MANTE;

     dsam028@;
|FIN;

|VARIABLES;
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     nNume1      = 0;
     nNume2      = 0;
     nPara1      = 0;
     nCampo      = 0;
     aBase       = "";
     aDef        = "";
     fFecha      = @;
     aTAny       = "";
     aDEstado    = "";
     aHEstado    = "";
     aEstado     = "";
     nOpcion     = 0;
     nError      = 0;
     aMes        = "";
     aAny        = "";
     nOpera      = 0;
     nAlguno     = 0;
     nSw         = 0;
     nInkey      = 0;
     nInkeyC     = 0;
     nModo       = 0;
     nModoL      = 0;
     nEstado     = 0;
     nGraba      = 0;
     nMensa      = 0;
     aCampo28    = "";

     nBoton5  = 0;
     SwBoton5 = 0;
|FIN;

|INCLUYE i_varfun;

|PROCESO PreguntaNuevaRenovacion;
    |CONFI "0000SExpediente Finalizado. Desea grabar la nueva fecha de renovacion";
    |SI FSalida = 0;
        |PUSHV 0918 1971;
        |PUSHV 1619 1971;
        |PINPA #0#dsaw0046;
        |PINTA 1519, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
        |POPV;
        |ATRI R; |PINTA 1121, "Nueva fecha para renovar tarjeta de transporte"; |ATRI 0;
        |C_V #dsaw0046#2, 1, "N"; #dsaw0046#2 = "R";
        |C_V #dsaw0046#3, 1, "N"; #dsaw0046#3 = "";
        |C_V #dsaw0046#4, 1, "N"; #dsaw0046#4 = "01.01.0000";
        #dsaw0046#0 = #dsam0027#3;
        #dsaw0046#1 = #dsam0027#4 + 2;
        |PINDA #0#dsaw0046;
|ET OtraVez;
        |ENDATOS #1#dsaw0046;
        |SI FSalida = 0;
            eaFun07  = "A";
            enOpcion = 1;
            enMesRen = #dsaw0046#0;
            enEjeRen = #dsaw0046#1;
            enNExpediente = #dsam0027#1;
            enEmpresa     = #dsam0027#5;
            |HAZ ActuaDsm0026;
        |SINO;
            |CONFI "0000NNo actualiza la fecha de Renovacion. Continuar";
            |SI FSalida ! 0;
                |VETE OtraVez;
            |FINSI;
        |FINSI;
        |POPV;
    |FINSI;
|FPRC;

|PROCESO ElProximo;
      nNume1 = 0;
      |ABRE #dsam0029;
      |LEE 041#dsam0029.u;
      |SI FSalida = 0;
          nNume1 = #dsam0029#1;
      |FINSI;
      |CIERRA #dsam0029;

      |LEE 041#dsam0027.u;
      |SI FSalida = 0;
          |SI nNume1 < #dsam0027#1;
              nNume1 = #dsam0027#1;
          |FINSI;
      |FINSI;
|FPRC;

|CALCULO Tipo7C1; |TIPO 7;

   #dsam0027#0 = "A";
   nModo = (FEntrada / 100) ! 0;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
       |SI nMensa = 0;
           |MENAV "0000Recuerde, mejor dar de alta Expedientes por proceso de Carga";
           nMensa = 1;
       |FINSI;
       nNume1 = 0;
       |HAZ ElProximo;

       |DDEFECTO #dsam0027;
       #dsam0027#1 = nNume1 + 1;
       |PINTA #dsam0027#1;
   |FINSI;
   |SI nModo = 2; |O nModo = 3;
       nMensa = 0;
   |FINSI;
|FCAL;

|CALCULO Tipo0C1; |TIPO 0;
   nModo = (FEntrada / 100) ! 0;

   aAlfa1 = "N";
   |SI nModo = 1; aAlfa1 = "S"; |FINSI;

   |C_M #dsam0027#3, 1, aAlfa1;
   |C_M #dsam0027#4, 1, aAlfa1;
   |C_M #dsam0027#5, 1, aAlfa1;

   |SI nModo = 1;
       |ABRE #dsam0029;
       #dsam0029#0 = #dsam0027#0;
       #dsam0029#1 = #dsam0027#1;
       |LEE 041#dsam0029.=;
       |SI FSalida = 0;
           |MENAV "0000El Expediente ya existe en el historico";
           |ERROR;
       |FINSI;
       |CIERRA #dsam0029;
   |FINSI;
|FCAL;

|CALCULO LeeCliente; |TIPO 6;
   |C_M #dsam0027#Campo#, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   |ABRE #dsam0000;
   #dsam0000#0 = #dsam0027#5;
   |LEE 041#dsam0000.=;
   |SI FSalida ! 0;
       |MENAV "0000Error no existe Cliente";
       |CIERRA #dsam0000;
       |ERROR;
   |FINSI;
   |CIERRA #dsam0000;

   #dsam0027#6  = #dsam0000#1;
   #dsam0027#7  = #dsam0000#3;
   #dsam0027#30 = #dsam0000#54;
   #dsam0027#31 = #dsam0000#71;
   |PINTA #dsam0027#6;
   |PINTA #dsam0027#7;
   |PINTA #dsam0027#30;
   |PINTA #dsam0027#31;
|FCAL;

|CALCULO Archiva; |TIPO 0;
   |SI #dsam0027#28 = "S";
        aAlfa = "";
        |SI #dsam0027#12 = "01.01.0000"; aAlfa = "Fecha Entrega"; |FINSI;
        |SI #dsam0027#11 = "01.01.0000"; aAlfa = "Fecha Recogida"; |FINSI;
        |SI #dsam0027#10 = "01.01.0000"; aAlfa = "Fecha Presentacion"; |FINSI;
        |SI aAlfa ! "";
            aAlfa = "0000Error, falta " + aAlfa;
            |MENAV aAlfa;
            |CONFI "0000NContinuar";
            |SI FSalida ! 0;
                #dsam0027#28 = "N"; |PINTA #dsam0027#28;
                |ERROR;
            |FINSI;
        |SINO;
            |SI #dsam0027#24 = "N";
                |CONFI "0000NDesea finalizar el Expediente sin facturar";
                |SI FSalida ! 0;
                    #dsam0027#28 = "N";
                    |PINTA #dsam0027#28;
                    |ERROR;
                |FINSI;
            |FINSI;
        |FINSI;
   |FINSI;

   aAlfa = #dsam0027#Campo#;
   |C_M #dsam0027#8, 1, aAlfa;
   |SI aAlfa = "N";
       #dsam0027#8 = "01.01.0000";
   |SINO;
       |SI #dsam0027#8 = "01.01.0000";
           fFecha = ~;
           #dsam0027#8 = fFecha;
       |FINSI;
   |FINSI;
   |PINTA #dsam0027#8;
|FCAL;

|CALCULO Tipo7C15; |TIPO 7;
   aAlfa = "S";
   |SI #dsam0027#24 = "S"; aAlfa = "N"; |FINSI;

   |C_M #dsam0027#15, 1, aAlfa;
|FCAL;

|CALCULO Tipo0C24; |TIPO 0;
   aAlfa = #dsam0027#24;
   |C_M #dsam0027#25, 1, aAlfa;
   |C_M #dsam0027#26, 1, aAlfa;
   |C_M #dsam0027#27, 1, aAlfa;
   |SI aAlfa = "N";
       #dsam0027#25 = ""; |PINTA #dsam0027#25;
       #dsam0027#26 = 0;  |PINTA #dsam0027#26;
       #dsam0027#27 = "01.01.0000";  |PINTA #dsam0027#27;
   |FINSI;
|FCAL;

|CALCULO Tipo0C15; |TIPO 6;
   |C_M #dsam0027#15, 0, aAlfa;
   |SI aAlfa = "N"; |ACABA; |FINSI;

   aAlfa1 = Contenido;
   nNume1 = aAlfa1;

   nModo = (FEntrada / 100) ! 0;
   |ABRE #dsam0128;
   #dsam0128#0 = #dsam0027#15;
   |LEE 041#dsam0128.=;
   |SI FSalida ! 0;
       |MENAV "0000No existe control de facturacion";
       |ERROR;
   |SINO;
       |SI nModo = 1; |O nNume1 ! #dsam0027#15;
           #dsam0027#16 = #dsam0128#2;  |PINTA #dsam0027#16;
           #dsam0027#17 = #dsam0128#4;  |PINTA #dsam0027#17;
           #dsam0027#18 = #dsam0128#5;  |PINTA #dsam0027#18;
           #dsam0027#19 = #dsam0128#6;  |PINTA #dsam0027#19;
           #dsam0027#20 = #dsam0128#7;  |PINTA #dsam0027#20;
           #dsam0027#21 = #dsam0128#8;  |PINTA #dsam0027#21;
           #dsam0027#22 = #dsam0128#9;  |PINTA #dsam0027#22;
           #dsam0027#23 = #dsam0128#10;
       |FINSI;
   |FINSI;
   |CIERRA #dsam0128;
|FCAL;

|CALCULO Tipo0Des; |TIPO 7;
   |PTEC 816;
|FCAL;

|CALCULO LasFechas; |TIPO 7;
   aAlfa = "S";
   nCampo = Campo - 1;
   |SI #dsam0027#nCampo# = "01.01.0000";
       #dsam0027#Campo# = "01.01.0000";
       |PINTA #dsam0027#Campo#;
       aAlfa = "N";
   |FINSI;
   |C_M #dsam0027#Campo#,1,aAlfa;
|FCAL;

|| ///////////////////////////////////////////////////////////////////
|PROCESO LeeDsam0028;
  |SI nOpera = 3;
      |BORRA 020#dsam0028.a;
  |FINSI;

  |SI nOpera = 4;
      nAlguno = 1;
  |FINSI;

  |LIBERA #dsam0028;
|FPRC;

|DEFBUCLE LeeDsam0028;
  #dsam0028#1;
  ;
  #dsam0027#0, #dsam0027#1, "          ";
  #dsam0027#0, #dsam0027#1, "zzzzzzzzzz";
  be;
  NULL, LeeDsam0028;
|FIN;

|PROCESO ClaveBaja28;
  #dsam0028#0 = #dsam0027#0;
  #dsam0028#1 = #dsam0027#1;
  #dsam0028#2 = "          ";
|FPRC;

|PROCESO ClaveAlta28;
  #dsam0028#0 = #dsam0027#0;
  #dsam0028#1 = #dsam0027#1;
  #dsam0028#2 = "zzzzzzzzzz";
|FPRC;

|PROCESO Tipo13m027; |TIPO 13;
   nModo = (FEntrada / 100) ! 0;
   |SI SwBoton5 = 1; |HAZ NoPulso; |FINSI;
   |SI nModo > 1;
       |SI nModo ! 4; |Y SwBoton5 = 0; |HAZ SiPulso; |FINSI;
       |ENTLINEAL #1#dsam0028, -3, 7, 22, 0, ClaveBaja28, ClaveAlta28;
   |SINO;
       |PINPA #0#dsam0028;
   |FINSI;
|FPRC;

|PROCESO Tipo3m027; |TIPO 12;
   |SI SwBoton5 = 1; |HAZ NoPulso; |FINSI;

   |SI #dsam0027#28 = "S"; |Y aCampo28 ! "S";
       |HAZ PreguntaNuevaRenovacion;
       aCampo28 = "";
       |ACABA;
   |FINSI;

   aCampo28 = "";

|ET LasLineas;
    |ENTLINEAL #1#dsam0028, -3, 4, 22, 0, ClaveBaja28, ClaveAlta28;
    nAlguno = 0;
    nOpera = 4;
    |BUCLE LeeDsam0028;
    |SI nAlguno = 0;
        |CONFI "0000NExpedientes sin lineas. Es Correcto";
        |SI FSalida ! 0;
            |VETE LasLineas;
        |FINSI;
    |FINSI;
    aCampo28 = "";
|FPRC;

|PROCESO Tipo30m027; |TIPO 30;
   |SI #dsam0027#28 = "S";
       |CONFI "0000SDesea pasar al historico este Expediente";
       |SI FSalida = 0;
           eaFun07       = "A";
           enNExpediente = #dsam0027#1;
           |SUB_EJECUTA "dsaz0041;MA";
           |PTEC 801;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo1m027; |TIPO 1;
   nModo    = (FEntrada / 100) ! 0;
   aCampo28 = #dsam0027#28;
   |SI nModo = 2; |O nModo = 3;
       |SI #dsam0027#28 = "S";
           aAlfa = "0000NExpediente finalizado. No procede modificacion. Continuar";
           |SI nModo = 3;
               aAlfa = "0000NExpediente finalizado. No procede baja. Continuar";
           |FINSI;
           |CONFI aAlfa;
           |SI FSalida ! 0;
               |ERROR;
               |ACABA;
           |FINSI;
       |FINSI;
   |FINSI;

   |SI nModo = 3;
       |CONFI "0000NDesea Borrar permanentemente este Expediente";
       |SI FSalida = 0;
           nOpera = 3;
           |BUCLE LeeDsam0028;
       |SINO;
           |ERROR;
       |FINSI;
   |FINSI;
|FPRC;

|| ///////////////////////////////////////////////////////////////////
|PROCESO dsaw0043;
   #dsaw0043#0 = #dsam0026#8;
   #dsaw0043#1 = #dsam0026#9;
   #dsaw0043#2 = #dsam0026#10;
   #dsaw0043#3 = #dsam0026#11;
   #dsaw0043#4 = #dsam0026#1;
   #dsaw0043#5 = "BAJA";
   aAlfa1 = "S";
   |SI #dsaw0043#0 = "A";
       #dsaw0043#5 = "ALTA";
       aAlfa1 = "N";
   |FINSI;

   |C_M #dsaw0043#0,1, "S";
   |C_M #dsaw0043#2,1, aAlfa1;
   |C_M #dsaw0043#3,1, aAlfa1;

   |PUSHV 0836 1480;
   |PINPA #0#dsaw0043;
   |PINDA #0#dsaw0043;

   |ENDATOS #1#dsaw0043;
   |SI FSalida = 0;
       #dsam0026#8  = #dsaw0043#0;
       #dsam0026#9  = #dsaw0043#1;
       |SI #dsam0026#8 = "A";
           #dsam0026#10 = "01.01.0000";
           #dsam0026#11 = "";
       |SINO;
           #dsam0026#10 = #dsaw0043#2;
           #dsam0026#11 = #dsaw0043#3;
       |FINSI;
       |GRABA 020#dsam0026.a;
       |LIBERA #dsam0026;

       #dsam0028#9 = #dsam0026#8;
       nGraba = 1;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO LeeTransporte;
   |DDEFECTO #dsam0026;
   #dsam0026#0 = enEmpresa;
   #dsam0026#1 = eaMatricula;
   |LEE 041#dsam0026.=;
   nEstado = FSalida;
|FPRC;

|PROCESO Tipo7m028; |TIPO 7;
   enEmpresa  = #dsam0027#5;
   eaMatricula = #dsam0028#2;
|FPRC;

|PROCESO AltaLinea;
   eaFun07        = "A";
   enNExpediente  = #dsam0027#1;
   enEmpresa      = #dsam0027#5;
   enEjer         = #dsam0027#4;
   enHMes         = #dsam0027#3;
   eaMatricula    = #dsam0028#2;

   |PUSHV 1319 2380;
   |DDEFECTO #dsaw0044;

   enSalida = 1;
   #dsaw0044#0 = enEmpresa;
   |PINPA #0#dsaw0044;
   |PINDA #0#dsaw0044;
   nGraba = 0;
   |ENDATOS #1#dsaw0044;
   |POPV;
   |SI enSalida = 0;
       |DBASE aBase;
       aDef = aBase + "def/dsam0028";
       |CARGA_DEF aDef, dsam028@;
       |SI FSalida = 0;
           |ABRE #dsam028@;
           #dsam028@#0 = #dsam0027#0;
           #dsam028@#1 = #dsam0027#1;
           #dsam028@#2 = #dsam0026#1;
           |LEE 041#dsam028@.=;
           |SI FSalida ! 0;
               |DDEFECTO #dsam028@;
               #dsam028@#0 = #dsam0027#0;
               #dsam028@#1 = #dsam0027#1;
               #dsam028@#2 = #dsam0026#1;
               #dsam028@#3 = #dsam0026#0;
               #dsam028@#4 = #dsam0026#2;
               #dsam028@#5 = #dsam0026#3;
               #dsam028@#6 = #dsam0026#5;
               #dsam028@#7 = #dsam0026#6;
               #dsam028@#8 = #dsam0026#7;
               #dsam028@#9 = #dsam0026#8;
               |GRABA 020#dsam028@.b;
           |FINSI;
           |CIERRA #dsam028@;
       |FINSI;
       |DESCARGA_DEF #dsam028@;
   |FINSI;

   #dsam0028#2 = eaMatricula;
   |LEE 041#dsam0028.=;

|FPRC;

|PROCESO BajaLinea;
   |LEE 141#dsam0028.=;

   |CONFI "0000NBorrar la Linea del Expediente";
   |SI FSalida = 0;
       |BORRA 040#dsam0028.a;
   |FINSI;
   |LIBERA #dsam0028;
|FPRC;

|PROCESO EstadoLinea;
   |LEE 141#dsam0028.=;

   enEmpresa  = #dsam0027#5;
   eaMatricula = #dsam0028#2;

   |ABRE #dsam0026;
   |HAZ LeeTransporte;
   nGraba = 0;
   |SI nEstado ! 0;
       |MENAV "0000Atencion este transporte ya no existe en el Cliente";
       #dsam0028#9 = "B";
       nGraba = 1;
   |SINO;
       |HAZ dsaw0043;
   |FINSI;
   |SI nGraba = 1;
       |PINTA #dsam0028#9;
       |GRABA 020#dsam0028.a;
   |FINSI;
   |LIBERA #dsam0028;
   |CIERRA #dsam0026;
|FPRC;

|PROCESO Consulta;
   enEmpresa  = #dsam0027#5;
   eaMatricula = #dsam0028#2;
   aEstado     = #dsam0026#8;
   enTecla = 11;
   |HAZ AltasBajas_26;
|FPRC;

|PROCESO Tipo11m028; |TIPO 11;
   nInkey = FSalida;

   |SI nInkey = 10;
       |HAZ AltaLinea;
       |PONCONTROL 23, "si";
   |FINSI;

   |SI nInkey = 11;
       |HAZ BajaLinea;
       |PONCONTROL 23, "SI";
       |ERROR;
   |FINSI;

   |SI nInkey = 12;
       |HAZ EstadoLinea;
       |PONCONTROL 23, "SI";
       |ERROR;
   |FINSI;

   |SI nInkey = 13;
       |HAZ Consulta;
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO ImpExpediente;
   nInkeyC = FSalida;
   |SI nInkeyC = 13; |Y SwBoton5 = 1;
       |HAZ ParaImprimir;
   |FINSI;
|FPRC;

|PROCESO ParaImprimir;
       eaFun07 = "A";
       enNExpediente = #dsam0027#1;
       |SUB_EJECUTA "dsay0025;AUTO";
|FPRC;

|PROCESO Tipo4; |TIPO 4;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo > 1;
       |HAZ ParaImprimir;
   |FINSI;
|FPRC;

|PROCESO NoPulso;
    |ESTADO_CONTROL nBoton5,  "DISABLE"; SwBoton5 = 0;
|FPRC;

|PROCESO SiPulso;
    |ESTADO_CONTROL nBoton5,  "ENABLE";  SwBoton5 = 1;
|FPRC;

|PROCESO Boton5;
     |PTEC 827;
|FPRC;

|PROGRAMA;

   |CONTROL_SIMPLE 0, "LBOTON,F5- Imprimir Expediente", 0560, 0575, Boton5;
   nBoton5 = FSalida;
   |HAZ NoPulso;

   |MANTE #dsam0027;

   |FIN_CONTROL_WINDOWS nBoton5;
|FPRO;
