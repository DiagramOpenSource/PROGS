|FICHEROS;
     nifz0002;

     nifm0001;
     nifm0002;

     dsam0103;

     :modelos/dsm180li;
     :modelos/dsm190li;
     :modelos/dsm19001;
     :modelos/dsm193ga;
     :modelos/dsm193li;
     :modelos/dsmo2347;
     :modelos/dsmo3347;
     :modelos/dsmo4347;
     :modelos/dsm182li;

     nifw0001;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nGrid1              = 0;
     nAnyo               = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp2               = 0;
     nCmp3               = 0;
     nCmp4               = 0;
     nCmp5               = 0;
     nCmp6               = 0;
     nRango              = 0;
     nActual             = 0;

     aAlfa               = "";
     aFicTmp             = "";
     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aLong               = "";
     aSel                = "";
     aPathModelos        = "";
     aBase               = "";

     fFechaSys           = @;

 {-1}aVent               = "";
     aVent1              = 0;
     aVent2              = 0;
     aVent3              = 0;
     aVent4              = 0;
     aVent5              = "";

     &eaAzul             = "";
|FIN;

|PROCESO CierraVtn0;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n0Vent;
|FPRC;

|PROCESO Evnt1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#nifw0001.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 101#nifw0001.=;
         |SI FSalida = 0;
             |SI #nifw0001#4 = "N";
                 #nifw0001#4 = "S";
                 #nifw0001#5 = eaAzul;
             |SINO;
                 #nifw0001#4 = "N";
                 #nifw0001#5 = "";
             |FINSI;

             |GRABA 020#nifw0001.a;
             |LIBERA #nifw0001;

             |REFRESCACONTROL nGrid1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Ptec806;
     |CONFI "0000NSeguro que quiere consultar a la AEAT los registros seleccionados";
     |SI FSalida ! 0;
         |FOCOTECLADO nGrid1;
         |ACABA;
     |FINSI;

     nActual = 1;
     |PTEC 806;
|FPRC;

|PROCESO GrabaW1;
     |DDEFECTO #nifw0001;
     #nifw0001#0 = #dsam0103#0;
     #nifw0001#1 = #dsam0103#1;
     #nifw0001#2 = #nifm0001#2;
     #nifw0001#3 = #nifm0001#3;
     |GRABA 020#nifw0001.n;
     |LIBERA #nifw0001;
|FPRC;

|PROCESO dsam0103;
     aAlfa = #dsam0103#0;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsam0103#0;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsam0103;
     #dsam0103#1;
     ;
     #nifz0002#1;
     #nifz0002#2;
     ;
     NULL, dsam0103;
|FIN;

|PROCESO dsm180li;
     aAlfa = #dsm180li#6;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsm180li#6;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsm180li#6;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsm180li#6;
         #dsam0103#1 = #dsm180li#10;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsm180li#10 = #dsam0103#1;
     |GRABA 020#dsm180li.a;
     |LIBERA #dsm180li;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsm180li;
     #dsm180li#1;
     ;
     #nifz0002#12, #nifz0002#11, 00, 000, 00, 00, "            ", 0, 0000, 00;
     #nifz0002#13, #nifz0002#11, 99, 999, 99, 99, "zzzzzzzzzzzz", 9, 9999, 99;
     be;
     NULL, dsm180li;
|FIN;

|PROCESO dsm19001;
     aAlfa = #dsm19001#6;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsm19001#6;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsm19001#6;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsm19001#6;
         #dsam0103#1 = #dsm19001#12;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsm19001#12 = #dsam0103#1;
     |GRABA 020#dsm19001.a;
     |LIBERA #dsm19001;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsm19001;
     #dsm19001#5;
     ;
     #nifz0002#11, "            ", #nifz0002#12;
     #nifz0002#11, "zzzzzzzzzzzz", #nifz0002#13;
     be;
     NULL, dsm19001;
|FIN;

|PROCESO dsm190li;
     aAlfa = #dsm190li#6;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsm190li#6;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsm190li#6;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsm190li#6;
         #dsam0103#1 = #dsm190li#12;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsm190li#12 = #dsam0103#1;
     |GRABA 020#dsm190li.a;
     |LIBERA #dsm190li;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsm190li;
     #dsm190li#5;
     ;
     #nifz0002#11, "            ", #nifz0002#12;
     #nifz0002#11, "zzzzzzzzzzzz", #nifz0002#13;
     be;
     NULL, dsm190li;
|FIN;

|PROCESO dsm193li;
     aAlfa = #dsm193li#6;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsm193li#6;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsm193li#6;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsm193li#6;
         #dsam0103#1 = #dsm193li#12;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsm193li#12 = #dsam0103#1;
     |GRABA 020#dsm193li.a;
     |LIBERA #dsm193li;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsm193li;
     #dsm193li#1;
     ;
     #nifz0002#12, #nifz0002#11, 00, 000, 00, 00, "            ", 0000, " ", "  ", 0;
     #nifz0002#13, #nifz0002#11, 99, 999, 99, 99, "zzzzzzzzzzzz", 9999, "z", "zz", 9;
     be;
     NULL, dsm193li;
|FIN;

|PROCESO dsm193ga;
     aAlfa = #dsm193ga#6;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsm193ga#6;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsm193ga#6;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsm193ga#6;
         #dsam0103#1 = #dsm193ga#8;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsm193ga#8 = #dsam0103#1;
     |GRABA 020#dsm193ga.a;
     |LIBERA #dsm193ga;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsm193ga;
     #dsm193ga#1;
     ;
     #nifz0002#12, #nifz0002#11, 00, 000, 00, 00, "            ";
     #nifz0002#13, #nifz0002#11, 99, 999, 99, 99, "zzzzzzzzzzzz";
     be;
     NULL, dsm193ga;
|FIN;

|PROCESO dsmo2347;
     aAlfa = #dsmo2347#7;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsmo2347#7;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsmo2347#7;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsmo2347#7;
         #dsam0103#1 = #dsmo2347#11;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsmo2347#11 = #dsam0103#1;
     |GRABA 020#dsmo2347.a;
     |LIBERA #dsmo2347;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsmo2347;
     #dsmo2347#3;
     ;
     #nifz0002#12, #nifz0002#11, 00, 000, 00, 00, "            ", " ";
     #nifz0002#13, #nifz0002#11, 99, 999, 99, 99, "zzzzzzzzzzzz", "z";
     be;
     NULL, dsmo2347;
|FIN;

|PROCESO dsmo3347;
     aAlfa = #dsmo3347#7;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsmo3347#7;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsmo3347#7;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsmo3347#7;
         #dsam0103#1 = #dsmo3347#8;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsmo3347#8 = #dsam0103#1;
     |GRABA 020#dsmo3347.a;
     |LIBERA #dsmo3347;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsmo3347;
     #dsmo3347#1;
     ;
     #nifz0002#12, #nifz0002#11, 00, 000, 00, 00, 01;
     #nifz0002#13, #nifz0002#11, 99, 999, 99, 99, 99;
     be;
     NULL, dsmo3347;
|FIN;

|PROCESO dsmo4347;
     aAlfa = #dsmo4347#7;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsmo4347#7;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsmo4347#7;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsmo4347#7;
         #dsam0103#1 = "";
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsmo4347;
     #dsmo4347#2;
     ;
     #nifz0002#12, #nifz0002#11, "            ";
     #nifz0002#13, #nifz0002#11, "zzzzzzzzzzzz";
     ;
     NULL, dsmo4347;
|FIN;

|PROCESO dsm182li;
     aAlfa = #dsm182li#6;  |QBF aAlfa;
     aLong = aAlfa % 0;
     |SI aLong ! "9";
         |ACABA;
     |FINSI;

     #nifm0001#0 = #dsm182li#6;
     |LEE 000#nifm0001.=;
     |SI FSalida ! 0;  |DDEFECTO #nifm0001;  |FINSI;

     #dsam0103#0 = #dsm182li#6;
     |LEE 000#dsam0103.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0103;
         #dsam0103#0 = #dsm182li#6;
         #dsam0103#1 = #dsm182li#10;
         |GRABA 020#dsam0103.n;
         |LIBERA #dsam0103;
     |FINSI;

     #dsm182li#10 = #dsam0103#1;
     |GRABA 020#dsm182li.a;
     |LIBERA #dsm182li;

     |SI #nifz0002#14 = "1";
         aAlfa = #nifm0001#3;  |QBF aAlfa;
         |SI aAlfa = "IDENTIFICADO";
             |ACABA;
         |FINSI;
     |FINSI;

     #nifw0001#0 = #dsam0103#0;
     |LEE 000#nifw0001.=;
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     |HAZ GrabaW1;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsm182li;
     #dsm182li#1;
     ;
     #nifz0002#12, #nifz0002#11, 00, 000, 00, "            ", 00;
     #nifz0002#13, #nifz0002#11, 99, 999, 99, "zzzzzzzzzzzz", 99;
     be;
     NULL, dsm182li;
|FIN;

|PROCESO nifw0001;
     #nifw0001#4 = aSel;
     #nifw0001#5 = eaAzul;
     |SI #nifw0001#4 = "N";
         #nifw0001#5 = "";
     |FINSI;

     |GRABA 020#nifw0001.a;
     |LIBERA #nifw0001;

     |PULSATECLA;
|FPRC;

|DEFBUCLE nifw0001;
     #nifw0001#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, nifw0001;
|FIN;

|PROCESO SelTodosZ2;
     |VENTANA 0501, 0540, -1, 16, "Espere un momento";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aSel = "S";
     |BUCLE nifw0001;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO DeselTodosZ2;
     |VENTANA 0501, 0540, -1, 16, "Espere un momento";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aSel = "N";
     |BUCLE nifw0001;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |HAZ CierraVtn0;
         |ACABA;
     |FINSI;

     |SI FSalida ! 1;
         |POSICIONATE #nifz0002#0;
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ CierraVtn0;

     |VENTANA 0501, 0540, -1, 16, "Refundiendo informaci¢n";
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SI #nifz0002#0 = "S";
         |BUCLE dsam0103;
     |FINSI;

     |SI #nifz0002#3 = "S";
         |BUCLE dsm180li;
     |FINSI;

     |SI #nifz0002#4 = "S";
         |BUCLE dsm190li;
         |BUCLE dsm19001;
     |FINSI;

     |SI #nifz0002#5 = "S";
         |BUCLE dsm193li;
         |BUCLE dsm193ga;
     |FINSI;

     |SI #nifz0002#6 = "S";
         |BUCLE dsmo2347;
         |BUCLE dsmo3347;
         |BUCLE dsmo4347;
     |FINSI;

     |SI #nifz0002#7 = "S";
         |BUCLE dsm182li;
     |FINSI;

     |HAZ CierraVtn0;

     |LEE 000#nifw0001.p;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 3599, -1, 16, "Seleccionar  NIFS";
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Docle click en el registro para Seleccionar o Deseleccionar", 0502, 0575, NULL;
     |CONTROL_SIMPLE 0, "BOTON,{{206}}Todos", 0590, 0598, SelTodosZ2;
     |CONTROL_SIMPLE 0, "BOTON,{{207}}Todos", 0580, 0588, DeselTodosZ2;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Envio de los seleccionados", 3502, 3525, Ptec806;

     nRango   = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#nifw0001, nRango, 0602, 3398, NULL, NULL, Evnt1;
     nGrid1 = FSalida;

     nActual = 0;
     aEsc1   = &255 + "806";
     aEsc2   = &255 + "807";
     aRetu   = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid1;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |HAZ CierraVtn0;

     |SI nActual = 1;
         |HAZ ConsultaMasiva;
     |FINSI;
|FPRC;

|PROCESO T0Elige;  |TIPO 0;
     nCmp1  = 0;
     nCmp2  = 3;
     nCmp3  = 4;
     nCmp4  = 5;
     nCmp5  = 6;
     nCmp6  = 7;

     |PINTA #nifz0002#nCmp1#;
     |PINTA #nifz0002#nCmp2#;
     |PINTA #nifz0002#nCmp3#;
     |PINTA #nifz0002#nCmp4#;
     |PINTA #nifz0002#nCmp5#;
     |PINTA #nifz0002#nCmp6#;

     |SI #nifz0002#Campo# = "S";
         |PARA nCmp = nCmp1;  |SI nCmp [ nCmp6;  |HACIENDO nCmp = nCmp + 1;
               |SI nCmp ! 1;  |Y nCmp ! 2;
                   |SI Campo ! nCmp;
                       #nifz0002#nCmp# = "N";
                   |FINSI;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #nifz0002#nCmp1#  = "N";  |Y #nifz0002#nCmp2#  = "N";
      |Y #nifz0002#nCmp3#  = "N";  |Y #nifz0002#nCmp4#  = "N";
      |Y #nifz0002#nCmp5#  = "N";  |Y #nifz0002#nCmp6#  = "N";
         #nifz0002#nCmp1# = "S";
     |FINSI;

     |C_M #nifz0002#1,  1, "S";
     |C_M #nifz0002#2,  1, "S";
     |C_M #nifz0002#11, 1, "S";
     |C_M #nifz0002#12, 1, "S";
     |C_M #nifz0002#13, 1, "S";

     |SI #nifz0002#nCmp1#  = "N";
         |C_M #nifz0002#1, 1, "N";  #nifz0002#1 = "";
         |C_M #nifz0002#2, 1, "N";  #nifz0002#2 = "zzzzzzzzz";
     |SINO;
         |C_M #nifz0002#11, 1, "N";  #nifz0002#11 = nAnyo;
         |C_M #nifz0002#12, 1, "N";  #nifz0002#12 = 1;
         |C_M #nifz0002#13, 1, "N";  #nifz0002#13 = 99999;
     |FINSI;

     |PINTA #nifz0002#nCmp1#;
     |PINTA #nifz0002#nCmp2#;
     |PINTA #nifz0002#nCmp3#;
     |PINTA #nifz0002#nCmp4#;
     |PINTA #nifz0002#nCmp5#;
     |PINTA #nifz0002#nCmp6#;
     |PINTA #nifz0002#1;
     |PINTA #nifz0002#2;
     |PINTA #nifz0002#11;
     |PINTA #nifz0002#12;
     |PINTA #nifz0002#13;
|FPRC;

|PROGRAMA;
     |VENTANA 0501, 2155, -1, 16, "Consulta masiva";
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     #nifz0002#11 = nAnyo;

     |PINPA #0#nifz0002;
     |PINDA #0#nifz0002;
     |ENDATOS #1#nifz0002;
|FPRO;

|PROCESO T80;  |TIPO 80;
     fFechaSys = ~;
     aAlfa     = fFechaSys % -104;
     nAnyo     = aAlfa;
     nAnyo     = nAnyo - 1;

     aFicTmp   = "nifw0001" + Usuario;
     |NOME_DAT #nifw0001#aFicTmp#;
     |ABRE #nifw0001;  |CIERRA #nifw0001;  |DELINDEX #nifw0001;

     |DBASS aBase;
     aPathModelos = aBase + "modelos/fich/";

     |PATH_DAT #dsm180li#aPathModelos#;
     |PATH_DAT #dsmo2347#aPathModelos#;
     |PATH_DAT #dsmo3347#aPathModelos#;
     |PATH_DAT #dsmo4347#aPathModelos#;

     |ABRET #dsam0103;
     |ABRET #nifm0001;
     |ABRET #nifm0002;
     |ABRET #nifw0001;

     FSalida = 2499;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #dsam0103;
     |CIERRAT #nifm0001;
     |CIERRAT #nifm0002;

     |CIERRAT #nifw0001;
     |DELINDEX #nifw0001;
|FPRC;
