|FICHEROS;
     dsam0123 #123;
     dsam0124 #124;
     dsam0000 #0;

     espejo1@ #900;
|FIN;

|VARIABLES;
     aCorreo   = "";
     aDef      = "";
     aBase     = "";
     aAlfa     = "";
     nSwHay    = 0;
     aBlancos  = "";
     &eswRel   = 0;
|FIN;

|PROCESO RecogeCliente; |TIPO 0;
     |ABRE #0;
     |SELECT #2#0;
     #0#1 = #123#0;
     |LEE 040#0=;
     |SI FSalida = 0;
         #123#0  = #0#1;    |PINTA #123#0;
         #123#1  = #0#27;   |PINTA #123#1;
         #123#2  = #0#28;   |PINTA #123#2;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO Borralos;
     |BORRA 020#124a;
     |LIBERA #124;
|FPRC;

|DEFBUCLE dsam0124_1;
     #124#1;
     ;
     #0#1, 00;
     #0#1, 99;
     be;
     NULL, Borralos;
|FIN;

|PROCESO Grabalos;
     |BORRA 020#124a;
     |LIBERA #124;

     #124#0 = #0#1;
     |GRABA 020#124n;
     |LIBERA #124;
|FPRC;

|DEFBUCLE dsam0124_2;
     #124#1;
     ;
     #123#0, 00;
     #123#0, 99;
     be;
     NULL, Grabalos;
|FIN;

|PROCESO PasaAEste;
     nSwHay    = 1;
     #900#0 = #123#0;
     |LEE 101#900=;
     |SI FSalida = 0;
         |BORRA 020#900a;
         |LIBERA #900;
     |FINSI;

     #900#0 = #0#1;
     |LEE 101#900=;
     |SI FSalida ! 0;
         #900#0  = #0#1;
         #900#1  = #0#27;
         #900#2  = #0#28;
         |GRABA 020#900n;
         |LIBERA #900;
     |FINSI;

     |BUCLE dsam0124_1;
     |BUCLE dsam0124_2;
|FPRC;

|DEFBUCLE dsam0000;
     #0#1;
     71;
     00001, aCorreo;
     99999, aCorreo;
     ;
     NULL, PasaAEste;
|FIN;

|PROCESO Chequealos;
     aBlancos = " " * 80;

     |ABRE #0;
     |SELECT #2#0;
     #0#1 = #123#0;
     |LEE 040#0=;
     |SI FSalida = 0;
         #123#0  = #0#1;
         #123#1  = #0#27;
         #123#2  = #0#28;
         |GRABA 020#123a;
         |LIBERA #123;
         |CIERRA #0;

         |ABRE #124;
         #124#0 = #123#0;
         #124#1 = 1;
         |LEE 101#124=;
         |SI FSalida ! 0;
             #124#0 = #123#0;
             #124#1 = 1;
             #124#2 = "CORREO PRINCIPAL";
             #124#3 = #0#71;
             |GRABA 020#124n;
             |LIBERA #124;
         |FINSI;

         |CIERRA #124;

         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #124;
     #124#0 = #123#0;
     #124#1 = 1;
     |LEE 040#124=;
     |SI FSalida = 0;
         |CIERRA #124;
         |SI #124#3 ! aBlancos;
             aCorreo   = #124#3;
             nSwHay    = 0;
             |BUCLE dsam0000;
             |SI nSwHay = 0;
                 |QBT aCorreo;
                 aCorreo = (aCorreo + aBlancos) % 180;
                 |BUCLE dsam0000;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #124;
|FPRC;

|DEFBUCLE dsam0123_1;
     #123#1;
     ;
     "                                        ";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, Chequealos;
|FIN;

|PROCESO BorraVacios;
     #124#0 = #123#0;
     #124#1 = 99;
     |LEE 101#124];
     |SI FSalida = 0;
         |LEE 040#124a;
     |SINO;
         |LEE 040#124u;
     |FINSI;

     |SI #124#0 ! #123#0;
         |BORRA 020#123a;
     |FINSI;
     |LIBERA #123;
|FPRC;

|DEFBUCLE dsam0123_2;
     #123#1;
     ;
     "                                        ";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, BorraVacios;
|FIN;

|PROCESO MiraCliente;
     |ACABA;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |DBASE aBase;   |QBT aBase;
     aBase = aBase + "def/";
     aDef  = aBase + "dsam0123.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dsam0123";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     |ABRE #900;
     |BUCLE dsam0123_1;
     |CIERRA #900;

     |DESCARGA_DEF #espejo1@;

     |ABRE #124;
     |BUCLE dsam0123_2;
     |CIERRA #124;
|FPRC;
