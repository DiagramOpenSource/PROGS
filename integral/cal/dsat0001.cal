|FICHEROS;
    dsam0000;
    dsam0023;
    dsam0024;
    dsam0105;
    dsam0109;
    dsam0110;

    dsaw0013,MANTE;
    dsat0001,MANTE;
    dsaw0014,MANTE;
    dsaw0016,MANTE;

    dsat001@;
|FIN;

|VARIABLES;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nBoton8    = -1;
     nNoGraba   = 0;
     nPara1     = 0;
     nTecla     = 0;
     nImporte   = 0;
     nImport2   = 0;
     aBase      = "";
     aDef       = "";

     &enEmpresa = 0;
     &enEmpPD   = 0;
     &enEjer    = 0;
     &aFuncion  = "";
     &enNoPregunta = 0;

     &eaFichero  = "";
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &enHMes     = 0;
|FIN;

|| ///////////////////////////////
|PROCESO Calculo; TIPO 0;
     #dsat0001#11 = (#dsat0001#7 % #dsat0001#8)  ! 2; |PINTA #dsat0001#11;
     #dsat0001#19 = (#dsat0001#7 % #dsat0001#18) ! 2; |PINTA #dsat0001#19;
|FPRC;

|PROCESO MTipo5;  |TIPO 5;
     |LEE 040#dsat0001.p;
     #dsat0001#9 = "N";
     |LINEAS_BI_ATRI #dsat0001#9, D, S, -1;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
  ||
|FPRC;

|PROCESO EntraDatos;

   |LEE 141#dsat0001.=;
   |SI #dsat0001#9 = "S";
       |CONFI "0000NComision ya Liquidada, continuar";
       |SI FSalida ! 0;
           |LIBERA #dsat0001;
           |ACABA;
       |FINSI;
   |FINSI;

   nNoGraba = 0;
   nImporte = #dsaw0013#4 - #dsat0001#11;
   nImport2 = #dsaw0013#5 - #dsat0001#19;

|ET Campo7;
   |ENCAMPO #7#dsat0001;
   |SI FSalida = 7; nNoGraba = 1; |VETE Fin; |FINSI;
   |SI FSalida = 1; |VETE Fin; |FINSI;

|ET Campo8;
   |ENCAMPO #8#dsat0001;
   |SI FSalida = 7; nNoGraba = 1; |VETE Fin; |FINSI;
   |SI FSalida = 1; |VETE Fin; |FINSI;
   |SI FSalida = 2; |VETE Campo7; |FINSI;

|ET Campo18;
   |ENCAMPO #18#dsat0001;
   |SI FSalida = 7; nNoGraba = 1; |VETE Fin; |FINSI;
   |SI FSalida = 1; |VETE Fin; |FINSI;
   |SI FSalida = 2; |VETE Campo8; |FINSI;

|ET Campo17;
   |ENCAMPO #17#dsat0001;
   |SI FSalida = 7; nNoGraba = 1; |VETE Fin; |FINSI;
   |SI FSalida = 1; |VETE Fin; |FINSI;
   |SI FSalida = 2; |VETE Campo17; |FINSI;

|ET Fin;
   |SI nNoGraba = 0;
       #dsaw0013#4 = nImporte + #dsat0001#11;
       #dsaw0013#5 = nImport2 + #dsat0001#18;
       |PINTA #dsaw0013#4;
       |PINTA #dsaw0013#5;
       |GRABA 020#dsat0001.a;
   |FINSI;
   |LIBERA #dsat0001;
|FPRC;

|PROCESO MarcaDatos;
   |LEE 141#dsat0001.=;
   |SI #dsat0001#17 = "*";
       #dsat0001#17 = " ";
   |SINO;
       #dsat0001#17 = "*";
   |FINSI;
   |PINTA #dsat0001#17;

   |GRABA 020#dsat0001.a;
   |LIBERA #dsat0001;
|FPRC;

|PROCESO AltaFuncionAz28;
   |ABRE #dsam0023;
   #dsam0023#0 = #dsaw0014#0;
   #dsam0023#1 = #dsaw0014#1;
   #dsam0023#2 = #dsaw0014#2;
   |LEE 141#dsam0023.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsam0023;
       #dsam0023#0 = #dsaw0014#0;
       #dsam0023#1 = #dsaw0014#1;
       #dsam0023#2 = #dsaw0014#2;
       |GRABA 020#dsam0023.b;
   |FINSI;

   |PARA nPara1 = 3; |SI nPara1 [ 18; |HACIENDO nPara1 = nPara1 + 1;
         #dsam0023#nPara1# = #dsaw0014#nPara1#;
   |SIGUE;
   #dsam0023#15 = 0;
   |GRABA 020#dsam0023.a;
   |LIBERA #dsam0023;
   |CIERRA #dsam0023;

   #dsat001@#0 = aFuncion;
   #dsat001@#1 = #dsaw0014#3;
   #dsat001@#2 = #dsaw0014#1;
   #dsat001@#3 = #dsaw0014#2;
   #dsat001@#4 = #dsaw0014#0;
   |LEE 141#dsat001@.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsat001@;
       #dsat001@#0 = aFuncion;
       #dsat001@#1 = #dsaw0014#3;
       #dsat001@#2 = #dsaw0014#1;
       #dsat001@#3 = #dsaw0014#2;
       #dsat001@#4 = #dsaw0014#0;
       |GRABA 020#dsat001@.b;
    |FINSI;
    #dsat001@#5  = #dsaw0014#4;
    #dsat001@#7  = #dsaw0014#11;
    #dsat001@#8  = #dsaw0014#12;
    #dsat001@#9  = #dsaw0014#13;
    #dsat001@#10 = #dsaw0014#14;
    #dsat001@#11 = #dsaw0014#15;
    #dsat001@#12 = #dsaw0014#16;
    #dsat001@#13 = #dsaw0014#17;
    #dsat001@#14 = #dsaw0014#18;
|FPRC;

|PROCESO AltaFuncionBz28;
    |ABRE #dsam0024;
    #dsam0024#0 = #dsaw0016#0;
    #dsam0024#1 = #dsaw0016#1;
    #dsam0024#2 = #dsaw0016#2;
    |LEE 141#dsam0024.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsam0024;
        #dsam0024#0 = #dsaw0016#0;
        #dsam0024#1 = #dsaw0016#1;
        #dsam0024#2 = #dsaw0016#2;
        |GRABA 020#dsam0024.b;
    |FINSI;
    |PARA nPara1 = 3; |SI nPara1 [ 19; |HACIENDO nPara1 = nPara1 + 1;
          #dsam0024#nPara1# = #dsaw0016#nPara1#;
    |SIGUE;
    #dsam0024#15 = 0;
    #dsam0024#16 = 0;
    |GRABA 020#dsam0024.a;
    |LIBERA #dsam0024;
    |CIERRA #dsam0024;

    #dsat001@#0 = aFuncion;
    #dsat001@#1 = #dsaw0016#3;
    #dsat001@#2 = #dsaw0016#1;
    #dsat001@#3 = #dsaw0016#2;
    #dsat001@#4 = #dsaw0016#0;
    |LEE 141#dsat001@.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat001@;
        #dsat001@#0 = aFuncion;
        #dsat001@#1 = #dsaw0016#3;
        #dsat001@#2 = #dsaw0016#1;
        #dsat001@#3 = #dsaw0016#2;
        #dsat001@#4 = #dsaw0016#0;
        |GRABA 020#dsat001@.b;
    |FINSI;
    #dsat001@#5  = #dsaw0016#4;
    #dsat001@#7  = #dsaw0016#10;
    #dsat001@#8  = #dsaw0016#11;
    #dsat001@#9  = #dsaw0016#13;
    #dsat001@#10 = #dsaw0016#14;
    #dsat001@#11 = #dsaw0016#15;
    #dsat001@#12 = #dsaw0016#17;
    #dsat001@#13 = #dsaw0016#18;
    #dsat001@#14 = #dsaw0016#19;
    #dsat001@#18 = #dsaw0016#12;
    #dsat001@#19 = #dsaw0016#16;
|FPRC;

|PROCESO NuevaAlta;
    |SI aFuncion = "A"; enEmpresa = #dsaw0014#0; |FINSI;
    |SI aFuncion = "B"; enEmpresa = #dsaw0016#0; |FINSI;
    |ABRE #dsam0000;
    #dsam0000#0 = enEmpresa;
    |LEE 141#dsam0000.=;
    |SI FSalida = 0;
        |SI aFuncion = "A"; #dsam0000#121 = "S"; |FINSI;
        |SI aFuncion = "B"; #dsam0000#122 = "S"; |FINSI;
        |GRABA 020#dsam0000.a;
    |FINSI;
    |LIBERA #dsam0000;
    |CIERRA #dsam0000;

    |DBASE aBase;
    aDef = aBase + "def/dsat0001";
    |CARGA_DEF aDef, dsat001@;
    |SI FSalida ! 0; |ACABA; |FINSI;

    |NOME_DAT #dsat001@#eaFichero#;
    |ABRE #dsat001@;

    nImporte = 0;
    nImport2 = 0;
    |SI aFuncion = "A";
        |HAZ AltaFuncionAz28;
    |FINSI;
    |SI aFuncion = "B";
        |HAZ AltaFuncionBz28;
    |FINSI;

    #dsat001@#6  = #dsam0000#1;
    #dsat001@#15 = #dsam0000#72;
    #dsat001@#16 = #dsam0000#52;
    #dsat001@#17 = "*";

    |GRABA 020#dsat001@.a;
    |LIBERA #dsat001@;
    |CIERRA #dsat001@;
    |DESCARGA_DEF #dsat001@;

    #dsaw0013#4 = #dsaw0013#4 + nImporte;  |PINTA #dsaw0013#4;
    #dsaw0013#5 = #dsaw0013#5 + nImport2;  |PINTA #dsaw0013#5;
|FPRC;

|PROCESO CreaNuevo;

   |PUSHV 0923 2380;
   |SI aFuncion = "A";
       |DDEFECTO #dsaw0014;
       #dsaw0014#0  = enEmpresa;
       #dsaw0014#1  = #dsaw0013#1;
       #dsaw0014#2  = #dsaw0013#9;
       #dsaw0014#3  = #dsaw0013#2;
       #dsaw0014#4  = #dsaw0013#3;
       #dsaw0014#12 = #dsaw0013#7;
       #dsaw0014#19 = #dsaw0013#10;

       |PINPA #0#dsaw0014;
       |PINDA #0#dsaw0014;
       |ENDATOS #2#dsaw0014;
   |FINSI;
   |SI aFuncion = "B";
       |DDEFECTO #dsaw0016;
       #dsaw0016#0  = enEmpresa;
       #dsaw0016#1  = #dsaw0013#1;
       #dsaw0016#2  = #dsaw0013#9;
       #dsaw0016#3  = #dsaw0013#2;
       #dsaw0016#4  = #dsaw0013#3;
       #dsaw0016#12 = #dsaw0013#7;
       #dsaw0016#19 = #dsaw0013#10;

       |PINPA #0#dsaw0016;
       |PINDA #0#dsaw0016;
       |ENDATOS #2#dsaw0016;
   |FINSI;

   |SI FSalida = 0;
       |HAZ NuevaAlta;
   |FINSI;
   |POPV;
|FPRC;

|PROCESO Boton2m001;
     |PTEC 824;
|FPRC;

|PROCESO Boton3m001;
     |PTEC 825;
|FPRC;

|PROCESO Boton4m001;
     |PTEC 826;
|FPRC;

/*
|PROCESO Boton8m001;
     |PTEC 830;
|FPRC;
*/

|PROCESO FinBotont001;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
||     |FIN_CONTROL_WINDOWS nBoton8;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo0t001;  |TIPO 0;
     |HAZ FinBotont001;
|FPRC;

|PROCESO Tipo7t001;  |TIPO 7;
     |BLIN 04;

     |CONTROL_SIMPLE 0, "LBOTON,F2  Modificar Datos    ", 1035, 1055, Boton2m001;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3  Marcar/Desmarcar    ", 1135, 1155, Boton3m001;
     nBoton3 = FSalida;

||     |CONTROL_SIMPLE 0, "LBOTON,F8  Dar de baja ", 1058, 1078, Boton8m001;
||     nBoton8 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4  Nuevo Registro       ", 1158, 1178, Boton4m001;
     nBoton4 = FSalida;

|FPRC;

|PROCESO Tipo11t001;  |TIPO 11;
     nTecla = FSalida;

     |HAZ FinBotont001;

     enEmpresa     = #dsat0001#4;
     enEjer        = #dsat0001#2;
     enEmpPD       = #dsat0001#1;

     |SI nTecla = 10;
         enNoPregunta = 0;
         |HAZ EntraDatos;
         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 11;
         enNoPregunta = 0;
         |HAZ MarcaDatos;
         |PONCONTROL  23, "SI";
         |ACABA;
     |FINSI;

     |SI nTecla = 12;
         enNoPregunta = 1;
         |HAZ CreaNuevo;
         |PONCONTROL  23, "SI";
         |PTEC 824;
         |PTEC 806;
         |ACABA;
     |FINSI;
|FPRC;
