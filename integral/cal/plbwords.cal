|FICHEROS;
|FIN;

|VARIABLES;
     aLong            = "";
     aCadena          = "";
     aIPRemoto        = "";
     aAlfa            = "";
     aAlfa1           = "";
     aAlfa2           = "";
     aAlfa3           = "";
     aAlfa4           = "";
     aAlfa5           = "";
     aAlfa6           = "";
     aCaracter        = "";
     aLen             = "";
     aDecima          = "";
     aEntero          = "";
     aImpor1          = "";
     aImpor2          = "";
     aDocRemoto       = "";
     aDocRemotoTra    = "";
     aDocServidor     = "";
     aBase            = "";
     aDirec           = "";
     aLogo            = "";
     aGuarda          = "";
     aAbreId1         = "";
     aAbreId2         = "";
     aAbre            = "";
     aBat             = "";
     aPath            = "";
     aLongitud        = "";
     aSit             = "";
     aUsuario         = "";
     aHora            = "";
     aDirGrafico      = "";
     aFicheroResul    = "";
     aFicheroTgz      = "";
     aFicheroTra      = "";
     aFicheroLCK      = "";
     aFicheroIMA      = "";
     aEjecuta         = "";
     aMac             = "";
     aMini            = "";

     nSwError         = 0;
     nInstala         = 0;
     nLen             = 0;
     nLen1            = 0;
     nLongitud        = 0;
     nSer             = 0;
     nLong            = 0;
     nBarra           = 0;
     nWord            = 0;
     nCar             = 0;
     nPos             = 0;
     nCampo           = 0;
     nDecimal         = 0;
     nCaracter        = 0;
     nHandle          = 0;
     nHandleYa        = 0;
     nTope            = 0;
     nPuntero         = 0;
     nIdSalir         = 0;
     nIdSalir1        = 0;
     nIdSalir2        = 0;
     nIdSalir3        = 0;
     nIdSalir4        = 0;
     nLinea           = 0;
     nHay             = 0;
     nDeci            = 0;
     nPaso            = 0;
     nAscci           = 0;
     nVeces           = 0;
     nHandleTgz       = 0;
     nCarac           = 0;
     nPausa           = 0;
     nConta           = 0;

     fFecha           = @;

     &eaAlfa          = "";
     &eaImporte       = "";
     &eaPathLogo      = "";
     &eaPathLogoIso   = "";
     &eaAsigna        = "";
     &eaMes           = "";
     &enWord1         = 0;
     &enWord2         = 0;
     &enCamWord       = 0;
     &enModoExterno   = 0;
     &enHandleTxt     = 0;
     &enHandleTxt2    = 0;
     &enCargaPuntero  = 0;
     &efFecha         = @;

     &eaDirPlantilla  = "";
     &eaDirTrabajo    = "";
     &eaDirTrabServi  = "";
     &eaDirDocId2     = "";
     &eaDirTraId2     = "";
     &eaDirSerGuarda  = "";
     &eaDirSerPlan    = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaDestinoTra    = "";
     &eaFicheroTra    = "";
     &eaFicheroIma    = "";
     &eaFicheroXgz    = "";
     &eaFicheroTgz    = "";
     &eaFicheroTar    = "";
     &eaFicheroTxt    = "";
     &eaFicheroPdf    = "";
     &eaFicheroPlaGz  = "";
     &eaFicheroPlaMl  = "";
     &eaEtiqueta      = "";
     &eaPlanilla      = "";
     &ea16            = "";
     &eaTipoImpresion = "";
     &enConverPDF     = 0;
     &eaFichero       = "";
     &eaDocumento     = "";
     &eaGrafico       = "";
     &eaRaizDoc       = "";
     &enNumeroDoc     = 0;
     &eaRutaOrigen    = "";
     &eaRutaDestino   = "";
     &eaParametro1    = "";
     &eaParametro2    = "";
     &eaParametro3    = "";
     &eaParametro4    = "";
     &eaParametro5    = "";
     &eaInforme       = "";
     &enBorraDocu     = 0;
     &eaRuta          = "";
     &eaNomFic        = "";
     &enSwNuevoMD5    = 0;

     {1}aContiene     = "";
     {1}aVersion      = "";
     {2}nNivel        = 0;
     {50}aCarac       = "";

        &enError      = 0;
   {100}&eaCamWord    = "";

     &eaUnidadBasico  = "";
     &eaDSMAC         = "";
|FIN;

|PROCESO &QuitaRarosPlb;
     |QBF eaAlfa;
     |SI eaAlfa = "";  |ACABA;  |FINSI;

     aCarac1   = "•";
     aCarac2   = "§";
     aCarac3   = "·";
     aCarac4   = "†";
     aCarac5   = "Ç";
     aCarac6   = "°";
     aCarac7   = "¢";
     aCarac8   = "£";
     aCarac9   = "ß";
     aCarac10  = "¶";
     aCarac11  = "®";
     aCarac12  = "Ä";
     aCarac13  = "á";
     aCarac14  = "Ö";
     aCarac15  = "ä";
     aCarac16  = "ç";
     aCarac17  = "ï";
     aCarac18  = "ó";
     aCarac19  = &001;
     aCarac20  = &002;
     aCarac21  = &003;
     aCarac22  = &004;
     aCarac23  = &005;
     aCarac24  = &006;
     aCarac25  = &007;
     aCarac26  = &015;
     aCarac27  = &016;
     aCarac28  = &017;
     aCarac29  = &018;
     aCarac30  = &019;
     aCarac31  = &020;
     aCarac32  = &021;
     aCarac33  = &022;
     aCarac34  = &023;
     aCarac35  = &024;
     aCarac36  = &025;
     aCarac37  = &026;
     aCarac38  = &028;
     aCarac39  = &029;
     aCarac40  = "Å";
     aCarac41  = &008;
     aCarac42  = "Ô";
     aCarac43  = "µ";
     aCarac44  = "ê";
     aCarac45  = "÷";
     aCarac46  = "‡";
     aCarac47  = "È";
     aCarac48  = &009;
     aCarac49  = &010;
     aCarac50  = &013;

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 50;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = eaAlfa - aCarac;
           |SI FSalida ! 0;
               nHay = 1;
               |SAL;
           |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;  |ACABA;  |FINSI;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;

     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           nPaso     = 0;

           nAscci    = &aCaracter;

           |SI aCaracter = aCarac1;  |Y nPaso = 0;  aCaracter = &0209;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac2;  |Y nPaso = 0;  aCaracter = &0241;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac3;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac4;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac5;  |Y nPaso = 0;  aCaracter = &0233;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac6;  |Y nPaso = 0;  aCaracter = &0237;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac7;  |Y nPaso = 0;  aCaracter = &0243;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac8;  |Y nPaso = 0;  aCaracter = &0250;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac9;  |Y nPaso = 0;  aCaracter = &0176;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac10; |Y nPaso = 0;  aCaracter = &0170;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac11; |Y nPaso = 0;  aCaracter = &0191;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac12; |Y nPaso = 0;  aCaracter = "«";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac13; |Y nPaso = 0;  aCaracter = &0231;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac14; |Y nPaso = 0;  aCaracter = &0224;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac15; |Y nPaso = 0;  aCaracter = &0232;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac16; |Y nPaso = 0;  aCaracter = &0236;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac17; |Y nPaso = 0;  aCaracter = &0242;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac18; |Y nPaso = 0;  aCaracter = &0249;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac19; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac20; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac21; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac22; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac23; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac24; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac25; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac26; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac27; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac28; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac29; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac30; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac31; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac32; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac33; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac34; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac35; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac36; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac37; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac38; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac39; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac40; |Y nPaso = 0;  aCaracter = &252;    nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac41; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac42; |Y nPaso = 0;  aCaracter = "¥";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac43; |Y nPaso = 0;  aCaracter = "A";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac44; |Y nPaso = 0;  aCaracter = "E";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac45; |Y nPaso = 0;  aCaracter = "I";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac46; |Y nPaso = 0;  aCaracter = "O";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac47; |Y nPaso = 0;  aCaracter = "U";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac48; |Y nPaso = 0;  aCaracter = " ";     nPaso = 1;  |FINSI;

           |SI aCaracter = aCarac49; |Y nPaso = 0;  || Un retorno de carro
               |SI nCampo < nLen;
                   aCaracter = "";
                   nPaso     = 1;
               |FINSI;
           |FINSI;

           |SI aCaracter = aCarac50; |Y nPaso = 0;  || Un retorno de carro
               nLen1 = nLen - 1;
               |SI nCampo < nLen1;
                   aCaracter = "";
                   nPaso     = 1;
               |FINSI;
           |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa = aCadena;
|FPRC;

|PROCESO EnviaFicheroSinMD5;
     |PULSATECLA;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     |SI FSalida ! 0;
         |PULSATECLA;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO EnviaFicheroConMD5;
     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocServidor  = FSalida;  |QBF aDocServidor;

     enSwNuevoMD5 = 0;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
         enSwNuevoMD5 = 1;
     |FINSI;
|FPRC;

|PROCESO EjecutaDSXML;
     || eaParametro1 = Path y fichero exe
     || eaParametro2 = Path y fichero txt
     || eaParametro3 = Origen  del dsxml
     || eaParametro4 = Destino 1 del dsxml
     || eaParametro5 = Destino 2 del dsxml

     |XABRE "EC", eaParametro2, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aFicheroLCK  = eaParametro2 < "";
     aFicheroLCK  = aFicheroLCK - ".txt" + ".lck";
     aFicheroIMA  = eaParametro3;

     |SI eaParametro3 ! "";
         eaOrigen       = eaParametro3 + "dsxml.exe";
         eaDestino      = eaParametro4 + "dsxml.exe";
         eaDestinoTra   = eaParametro5 + "dsxml.exe";
         |HAZ EnviaFicheroConMD5;
     |FINSI;

     |RFBORRA aFicheroLCK;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaParametro1 + " " + eaParametro2 + &34;
     |RSYSTEM aAlfa;

     |PARA;  |SI;  |HACIENDO;
             |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;

             |XABRE "EC", aFicheroLCK, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PULSATECLA;
     |SIGUE;

     |PARA nVeces = 0;  |SI nVeces [ 20;  |HACIENDO nVeces = nVeces + 1;
             |XABRE "EC", aFicheroIMA, nHandle;
             |SI FSalida < 0;  |SAL;  |FINSI;

             |MENSA "0000 Esperando cierre del documento.";
             |SLEEP 1;
             |PULSATECLA;
     |SIGUE;

     |RFBORRA eaParametro2;
     |RFBORRA aFicheroLCK;

     |PULSATECLA;
     |MENSA "0000  ";
|FPRC;

|PROCESO RecibeFichero;
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;
        aIPRemoto = "";
        |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

        |SI aIPRemoto ! "";
            |RECIBE_FICHERO eaDestino, eaOrigen;
        |SINO;
            |COPIA_FICHERO eaDestino, eaOrigen;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescomprimeFichero;
     |SI eaFicheroPlaGz ! eaFicheroTgz;  |Y eaFicheroPlaGz ! "";
         eaOrigen  = eaDirTrabajo + eaFicheroPlaGz;
         eaDestino = eaDirTrabajo + eaFicheroTgz;
         |RRENOMBRA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     aAlfa = eaDirTrabajo + eaFicheroTgz;
     Pos   = -1;
     |RDESCOMPRIME aAlfa;
     |RDETAR aAlfa, eaDirTrabajo;

     aAlfa = eaDirTrabajo + eaFicheroTgz;  |RFBORRA aAlfa;
     aAlfa = eaDirTrabajo + eaFicheroTar;  |RFBORRA aAlfa;

     |SI eaFicheroPlaMl ! eaFicheroTra;
         eaOrigen  = eaDirTrabajo + eaFicheroPlaMl;
         eaDestino = eaDirTrabajo + eaFicheroTra;
         |RRENOMBRA_FICHERO eaOrigen, eaDestino;
     |FINSI;
|FPRC;

|PROCESO ComprimeFichero;
     aAlfa = eaDirTrabajo + eaFicheroTar + " " + eaFicheroTra;
     |RATAR aAlfa, eaDirTrabajo;

     aAlfa = eaDirTrabajo + eaFicheroTar;
     |RCOMPRIME aAlfa;

     aAlfa = eaDirTrabajo + eaFicheroTar;  |RFBORRA aAlfa;

     |SI enBorraDocu = 0;  |Y enConverPDF = 0;
         aAlfa = eaDirTrabajo + eaFicheroTra;  |RFBORRA aAlfa;
     |FINSI;
|FPRC;

|PROCESO AsignaWord;
     aAlfa = eaAsigna % 101;
     |SI aAlfa ! "V";  |Y aAlfa ! "M";
      |Y aAlfa ! "I";  |Y aAlfa ! "T";
      |Y aAlfa ! "X";  |Y aAlfa ! "Y";
         |ACABA;
     |FINSI;

     aAlfa = (eaAsigna % 101) + &13 + &10;  |XGRABA enHandleTxt, aAlfa;
     aAlfa = (eaAsigna % 220) + &13 + &10;  |XGRABA enHandleTxt, aAlfa;
     aAlfa = eaAlfa + &13 + &10;            |XGRABA enHandleTxt, aAlfa;
|FPRC;

|PROCESO AbreWordExterno;
     eaParametro1 = eaDirTrabajo + "dsxml";
     eaParametro2 = eaDirTrabajo + eaFicheroTxt;
     eaParametro3 = eaDirSerPlan;
     eaParametro4 = eaDirPlantilla;
     eaParametro5 = eaDirTrabajo;

     |HAZ EjecutaDSXML;
|FPRC;

|PROCESO LeeUnidadBasico;
     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     eaUnidadBasico = (aContiene1 % 102) > "";

     aAlfa = eaUnidadBasico % -101;
     |SI aAlfa ! ":";
         eaUnidadBasico = "";
     |FINSI;
|FPRC;

|PROCESO CreaDirectorios;
     aLong   = aAlfa % 0;
     nLong   = aLong;
     nBarra  = 0;
     aCadena = "";
     |PARA nCar = 1;  |SI nCar [ nLong;  |HACIENDO nCar = nCar + 1;
           nPos      = (nCar * 100) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "/";  |O aCaracter = "\";
               nBarra = nBarra + 1;
               |SI nBarra ! 1;
                   |SI nSer = 0;  |RMKDIR aCadena;  |FINSI;
                   |SI nSer = 1;  |MKDIR aCadena;   |FINSI;
               |FINSI;
           |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
|FPRC;

|PROCESO TraeTxtComprimido;
     aAlfa = eaRutaDestino;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 0;  |HAZ CreaDirectorios;  |FINSI;

     aAlfa = eaRutaOrigen + eaFicheroTar + " " + eaFicheroTxt;
     |ATAR aAlfa, eaRutaOrigen;

     aAlfa = eaRutaOrigen + eaFicheroTar;
     |COMPRIME aAlfa;

     aAlfa = eaRutaOrigen + eaFicheroTxt;  |FBORRA aAlfa;
     aAlfa = eaRutaOrigen + eaFicheroTar;  |FBORRA aAlfa;

     eaOrigen  = eaRutaOrigen  + eaFicheroTgz;
     eaDestino = eaRutaDestino + eaFicheroTgz;

     |RFBORRA eaDestino;
     |HAZ EnviaFicheroSinMD5;

     Pos   = -1;
     aAlfa = eaRutaDestino + eaFicheroTgz;
     |RDESCOMPRIME aAlfa;
     |RDETAR aAlfa, eaRutaDestino;

     aAlfa = eaRutaOrigen  + eaFicheroTgz;  |FBORRA aAlfa;
     aAlfa = eaRutaDestino + eaFicheroTgz;  |RFBORRA aAlfa;
     aAlfa = eaRutaDestino + eaFicheroTar;  |RFBORRA aAlfa;
|FPRC;

|PROCESO TraeEjecutable;
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aDocRemoto ! aDocServidor;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;

     |XABRE "EC", eaDestino, nHandle;
     |SI FSalida < 0;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CogeMac;
     |SI eaDSMAC ! "";  |ACABA;  |FINSI;

     |HAZ LeeUnidadBasico;

     aAlfa = eaUnidadBasico + "\MODELOS";  |RMKDIR aAlfa;
     aAlfa = aAlfa + "\DSMAC";             |RMKDIR aAlfa;

     |DBASE aAlfa;   |QBF aAlfa;
     aAlfa      = aAlfa + "plantillas/";

     eaOrigen   = aAlfa + "dsmini.exe";
     eaDestino  = eaUnidadBasico + "\MODELOS\DSMAC\DSMINI.EXE";
     |HAZ TraeEjecutable;
     aMini = eaUnidadBasico + "\MODELOS\DSMAC\DSMINI.EXE";

     eaOrigen   = aAlfa + "dsmac.exe";
     eaDestino  = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.EXE";
     |HAZ TraeEjecutable;
     aMac = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.EXE";

     aAbre = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";   |RFBORRA aAbre;
     aBat  = eaUnidadBasico + "\MODELOS\DSMAC\EJEMAC.BAT";  |RFBORRA aBat;

     aAbre    = eaUnidadBasico + "\MODELOS\DSMAC\EJEMAC.BAT";
     |XABRE "WC", aBat, nHandle;

     aAlfa = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC " +  eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT" + &13 + &10;
     |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;

     aEjecuta = "cmd " + &34 + "/c START /WAIT " + aMini + " " + aBat + &34;
     |RSYSTEM aEjecuta;

     nConta = 0;
     aAbre  = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";
     |PARA;  |SI;  |HACIENDO;
             |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;

             |XABRE "EC", aAbre, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             nConta = nConta + 1;
             |SI nConta > 100;
                 |SAL;
             |FINSI;

             |PULSATECLA;
     |SIGUE;

     aAbre  = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aEjecuta = "START " + aMini + " " + aBat;
         |RSYSTEM aEjecuta;

         nConta = 0;
         |PARA;  |SI;  |HACIENDO;
                 |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
                 |SIGUE;

                 |XABRE "EC", aAbre, nHandle;
                 |SI FSalida ] 0;
                     |SAL;
                 |FINSI;

                 nConta = nConta + 1;
                 |SI nConta > 100;
                     |SAL;
                 |FINSI;

                 |PULSATECLA;
         |SIGUE;
     |FINSI;

     eaDSMAC   = "";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;   |ACABA;  |FINSI;

     |XLEE nHandle, 250, eaDSMAC;
     |SI FSalida < 0
         eaDSMAC   = "";
     |FINSI;
     |XCIERRA nHandle;

     |QBF eaDSMAC;
|FPRC;
