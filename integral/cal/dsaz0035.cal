|FICHEROS;
    dsaz0035;

    dsam0000;
    dsam0025;
    dsam0105;
    dsam0125;

    dsaw0013;
    dsat0006;

    :laboral/nomconca;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aFichero  = "";

     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;

     nImport1  = 0;
     nImport2  = 0;
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     nEmpresa  = 0;
     nEjer     = 0;
     nAlgun    = 0;

     nInkey    = 0;
     aBase     = "";
     nCanal    = 0;
     aPath     = "";
     aDLiqu1   = "";
     aHLiqu1   = "";
     aDLiqu2   = "";
     aHLiqu2   = "";

     &eaTipoImp     = "";
     &eaPathLaboral = "";
     &eaFichero     = "";
     &aFuncion      = "";
     &enEjer        = 0;
     &enEmpresa     = 0;
     &enDEmpresa    = 0;
     &enHEmpresa    = 0;
     &enDAgente     = 0;
     &enHAgente     = 0;
     &enDConve      = 0;
     &enHConve      = 0;
|FIN;

|CALCULO DConvenio; |TIPO 0;
    nInkey = FSalida;

    |SI nInkey = 10;
        eaPathLaboral = "";
        |DBASS aBase;
        aAlfa = aBase + "laboral/def/labempre.mas";

        |XABRE "E", aAlfa, nCanal;
        |SI FSalida ] 0;
            eaPathLaboral   = aBase + "laboral/";
        |SINO;
            |MENAV "0000No existe laboral";
            |ACABA;
        |FINSI;

        aPath = eaPathLaboral + "fich/";
        |PATH_DAT #nomconca#aPath#;

        |ABRE #nomconca;
        #nomconca#0 = #dsaz0035#Campo#;
        |CONSULTA_CLAVE #1#nomconca;
        #dsaz0035#Campo#  = #nomconca#0;
        #dsaz0035#Campo#5 = #nomconca#1;
        |PINTA #dsaz0035#Campo#;
    |FINSI;

    |SI #dsaz0035#12 < #dsaz0035#11; |Y Campo = 12;
        |MENAV "0000Error. Hasta Convenio inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HEmpresa; |TIPO 0;
    |SI #dsaz0035#4 < #dsaz0035#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0035#6 < #dsaz0035#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsaz0035#8 < #dsaz0035#7;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO GrabaAuxiliar1;
    #dsam0125#0 = #dsam0025#3;
    |LEE 041#dsam0125.=;
    |SI FSalida ! 0; |ACABA; |FINSI;
    |SI #dsam0125#3 ! "S"; |ACABA; |FINSI;

    #dsat0006#0 = #dsam0025#0;
    #dsat0006#1 = #dsam0025#1;
    #dsat0006#2 = #dsam0025#2;
    #dsat0006#3 = #dsam0025#3;
    |LEE 141#dsat0006.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0006;
        #dsat0006#0 = #dsam0025#0;
        #dsat0006#1 = #dsam0025#1;
        #dsat0006#2 = #dsam0025#2;
        #dsat0006#3 = #dsam0025#3;
        |GRABA 020#dsat0006.b;
    |FINSI;
    |PARA nPara1 = 4; |SI nPara1 [ 27; |HACIENDO nPara1 = nPara1 + 1;
          #dsat0006#nPara1# = #dsam0025#nPara1#;
    |SIGUE;

    #dsat0006#28 = #dsam0000#1;
    #dsat0006#29 = #dsam0000#54;
    #dsat0006#30 = #dsam0000#72;
    #dsat0006#31 = #dsam0000#52;
    #dsat0006#33 = #dsam0125#5;
    #dsat0006#34 = #dsam0000#3;

    |SI #dsat0006#13 = "N"; |Y #dsaz0035#13 ! "R";
        #dsat0006#15 = (#dsat0006#8 % #dsat0006#12) ! 2;
    |FINSI;
    |SI #dsat0006#19 = "N"; |Y #dsaz0035#13 ! "P";
        #dsat0006#21 = (#dsat0006#9 % #dsat0006#12) ! 2;
    |FINSI;

    #dsat0006#32 = " ";
    |SI #dsaz0035#10 = "T";  #dsat0006#32 = "*";  |FINSI;
    |SI #dsaz0035#10 = "S";
        |SI #dsat0006#15 ! 0; |Y #dsaz0035#13 ! "R";
            #dsat0006#32 = "*";
        |FINSI;
        |SI #dsat0006#21 ! 0; |Y #dsaz0035#13 ! "P";
            #dsat0006#32 = "*";
        |FINSI;
    |FINSI;

    |GRABA 020#dsat0006.a;
    |LIBERA #dsat0006;

    nGraba = 1;
    nImport1  = #dsat0006#15;
    nImport2  = #dsat0006#21;
    |HAZ GrabaAuxiliar2;
|FPRC;

|DEFBUCLE dsam0025;
   #dsam0025#1;
   3,13,19;
   nEmpresa, enEjer, enDConve, #dsaz0035#3, aDLiqu1, aDLiqu2;
   nEmpresa, enEjer, enHConve, #dsaz0035#4, aHLiqu1, aHLiqu2;
   e;
   NULL, GrabaAuxiliar1;
|FIN;

|PROCESO LeoDsam0000;
   nEmpresa = #dsam0000#0;
   |BUCLE dsam0025;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   123,72;
   #dsaz0035#5, "S", enDAgente;
   #dsaz0035#6, "S", enHAgente;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO GrabaAuxiliar2;
   #dsaw0013#0 = aFuncion;
   #dsaw0013#1 = enEjer;
   #dsaw0013#2 = #dsam0125#0;
   |LEE 041#dsaw0013.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsaw0013;
       #dsaw0013#0 = aFuncion;
       #dsaw0013#1 = enEjer;
       #dsaw0013#2 = #dsam0125#0;
       #dsaw0013#3 = #dsam0125#2;
       #dsaw0013#6 = #dsam0125#9;
       #dsaw0013#7 = #dsam0125#8;
       |GRABA 020#dsaw0013.c;
   |FINSI;
   |SI nGraba = 1;
       #dsaw0013#4 = #dsaw0013#4 + nImport1 + nImport2;
   |FINSI;
   #dsaw0013#9  = #dsaz0035#1;
   #dsaw0013#10 = #dsaz0035#2;

   |GRABA 020#dsaw0013.a;
   nAlgun = 1;
|FPRC;

|PROCESO VerSiHayAlgo;
  nAlgun = 1;
  |ERROR10;
|FPRC;

|DEFBUCLE VerSiHayAlgo;
   #dsat0006#1;
   32;
   enEjer, #dsaz0035#11, enDEmpresa, enDConve, "*";
   enEjer, #dsaz0035#12, enHEmpresa, enHConve, "*";
   ;
   NULL, VerSiHayAlgo;
|FIN;

|PROCESO PanFuncion_a;
   |PINPA #0#dsat0006;

   |C_V #dsaw0013#9,  1, "N"; |C_V #dsaw0013#10, 1, "N";

   aAlfa1 = "S"; aAlfa2 = "S";
   |SI #dsaz0035#13 = "P"; aAlfa2 = "N"; aAlfa = "Imp. Poliza "; |FINSI;
   |SI #dsaz0035#13 = "R"; aAlfa1 = "N"; aAlfa = "Imp.Regular."; |FINSI;

   |C_V #dsat0006#8, 1,aAlfa1; |C_V #dsat0006#9, 1,aAlfa2;
   |C_V #dsat0006#15,1,aAlfa1; |C_V #dsat0006#21,1,aAlfa2;

   |SI #dsaz0035#13 ! "A";
       |ATRI R; |PINTA 1354, aAlfa; |ATRI 0;
   |SINO;

       |PINTA 1213, "ÂÄÄÄÂÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
       |PINTA 1313, "³Cvn³Ag³ % Com.³Imp. Poliza    Comision ";
       |PINTA 1413, "³   ³  ³       ³                        ";
       |PINTA 1513, "³   ³  ³       ³                        ";
       |PINTA 1613, "³   ³  ³       ³                        ";
       |PINTA 1713, "³   ³  ³       ³                        ";
       |PINTA 1813, "³   ³  ³       ³                        ";
       |PINTA 1913, "³   ³  ³       ³                        ";
       |PINTA 2013, "³   ³  ³       ³                        ";
       |PINTA 2113, "³   ³  ³       ³                        ";
       |PINTA 2213, "³   ³  ³       ³                        ";
       |PINTA 2313, "ÁÄÄÄÁÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
       |ATRI R;
       |PINTA 1314, "Cvn";
       |PINTA 1318, "Ag";
       |PINTA 1321, " % Com.";
       |PINTA 1329, "Imp. Poliza    Comision ";
       |ATRI 0;
       |C_P #dsat0006#2,  1, 1414;
       |C_P #dsat0006#30, 1, 1418;
       |C_P #dsat0006#12, 1, 1421;
       |C_P #dsat0006#8,  1, 1429;
       |C_P #dsat0006#15, 1, 1442;

       |C_L #dsat0006#28,  1, "N";
       |C_A #dsat0006#28,  1, 40;
       |C_P #dsat0006#28,  1, 2408;
   |FINSI;
|FPRC;

|PROCESO ClaveBaja999;
   #dsaw0013#0 = aFuncion;
   #dsaw0013#1 = enEjer;
   #dsaw0013#2 = #dsaz0035#3;
|FPRC;

|PROCESO ClaveAlta999;
   #dsaw0013#0 = aFuncion;
   #dsaw0013#1 = enEjer;
   #dsaw0013#2 = #dsaz0035#4;
|FPRC;

|PROCESO Procesoz035;

     aFichero = ("3y" + Usuario) % 108;
     |NOME_DAT #dsaw0013#aFichero#;
     |DELINDEX #dsaw0013;

     eaFichero = ("4y" + Usuario) % 108;
     |NOME_DAT #dsat0006#eaFichero#;
     |DELINDEX #dsat0006;

     aAlfa1 = #dsaz0035#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enEjer  = #dsaz0035#0;

     aDLiqu1 = " ";  aDLiqu2 = " ";
     aHLiqu1 = "z";  aHLiqu2 = "z";

     |SI #dsaz0035#13 ! "R"; |Y #dsaz0035#9 ! "T";
         aDLiqu1 = #dsaz0035#9;
         aHLiqu1 = #dsaz0035#9;
     |FINSI;
     |SI #dsaz0035#13 ! "P"; |Y #dsaz0035#9 ! "T";
         aDLiqu2 = #dsaz0035#9;
         aHLiqu2 = #dsaz0035#9;
     |FINSI;
     enDEmpresa = #dsaz0035#5;
     enHEmpresa = #dsaz0035#6;
     enDAgente  = #dsaz0035#7;
     enHAgente  = #dsaz0035#8;
     enDConve   = #dsaz0035#11;
     enHConve   = #dsaz0035#12;
     eaTipoImp  = #dsaz0035#13;

     |ABRE #dsaw0013;
     |ABRE #dsat0006;

     nAlgun = 0;

     |ABRE #dsam0125;
     |BUCLE dsam0000;
     |CIERRA #dsam0125;

     |CIERRA #dsat0006;
     |CIERRA #dsaw0013;

     |SI nAlgun = 1;
         |PARA; |SI nAlgun = 1; |HACIENDO;
                |HAZ PanFuncion_a;
                |ENTLINEAL #1#dsaw0013, -3, 4, 22, 0, ClaveBaja999, ClaveAlta999;
                nAlgun = 0;
                |BUCLE VerSiHayAlgo;
                |SI nAlgun = 1;
                    |MENAV "0000Hay registros marcados sin actualizar";
                    |CONFI "0000SDesea no actualizarlos y salir del programa";
                    |SI FSalida = 0;
                        nAlgun = 0;
                    |FINSI;
                |FINSI;
         |SIGUE;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsaw0013;
|FPRC;

|PROGRAMA;

    aFuncion = "a";

    |CLS;
    |CABEZA "Calculo Comision";

    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsaz0035#0 = aAlfa;

    |PINPA #0#dsaz0035;
    |PINDA #0#dsaz0035;

    |ENDATOS #2#dsaz0035;
    |SI FSalida = 0;
        |HAZ Procesoz035;
    |FINSI;
|FPRO;
