|FICHEROS;
     dsaz0001 #0;
     dsam0054 #54;
     :/basica/def/dspase15 #1115;
     :/basica/def/agim0018 #1118;
|FIN;

|VARIABLES;
     nCaracter    = 0;
     nPosi        = 0;
     nLong        = 0;
     nSal         = 0;
     nContador    = 0;
     nSeguir      = 0;
     nCanal       = 0;
     nLinea       = 0;
     nCodigoBas   = 0;

     aNombreIP    = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa        = "";
     aDBase       = "";
     aLong        = "";
     aCaracter    = "";
     aPathDocum   = "";
     aFichOrigen  = "";
     aFichDestino = "";
     aRuta        = "";

     &enCodUbica      = 0;
     &eaRutaDocumento = "";
     &eaExtension     = "";
|FIN;

|PROCESO DirecCartas;  |TIPO 0;
     |SI FSalida = 10;
         aRuta = "D" + #0Campo;
         |BROWSE aRuta;
         #0Campo = aRuta % 280;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa  = #0Campo > "";   |QBF aAlfa;
     aAlfa1 = aAlfa - "AGICLI\CARTAS";
     |SI aAlfa = aAlfa1;
         |MENAV "     Ubicacion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO BuscaCodigo;
     |SI #1115#22 = "S";  |ACABA;  |FINSI;

     nCodigoBas = #1115#18;
     |SI nCodigoBas ! 0;  |ERROR10;  |FINSI;
|FPRC;

|DEFBUCLE dspase15;
     #1115#3;
     ;
     #1118#0, "            ", 00;
     #1118#0, "zzzzzzzzzzzz", 99;
     ;
     NULL, BuscaCodigo;
|FIN;

|PROCESO CreaDocu;
     nCodigoBas = 0;
     |BUCLE dspase15;
     |SI nCodigoBas = 0;  |ACABA;  |FINSI;

     #54#0  = #1118#0;
     #54#1  = 9999;
     |LEE 040#54];
     |SI FSalida = 0;
         |LEE 040#54a;
     |SINO;
         |LEE 040#54u;
     |FINSI;
     |SI FSalida = 0;  |Y #54#0 = #1118#0;
         nLinea = #54#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |SI #1118#3 = "C";
         enCodUbica = #0#0;  |HAZ LeeUbicaciones;
     |SINO;
         enCodUbica = #0#2;  |HAZ LeeUbicaciones;
     |FINSI;

     aAlfa2 = "C";
     |SI #1118#3 = "I";  aAlfa2 = "I";  |FINSI;

     aAlfa1      = aAlfa2 + (("00000" + nCodigoBas) % -105) + (("00" + #1118#1) % -102) + ".txt";
     aFichOrigen = #0#4;  |QBF aFichOrigen;
     aFichOrigen = aFichOrigen + "\" + aAlfa1;

     aAlfa1       = eaRutaDocumento;                  |QBF aAlfa1;
     aAlfa3       = ((eaExtension + "zzz") % 103) + (("00000" + #1118#0) % -105) + (("0000" + nLinea) % -104) + "." + eaExtension;
     aFichDestino = aAlfa1 + "\" + aAlfa3;   |QBF aFichDestino;

     |RCOPIA_FICHERO aFichOrigen, aFichDestino;

     |XABRE "EC", aFichDestino, nCanal;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |DDEFECTO #54;
     |HORA aAlfa;
     aAlfa1 = aAlfa % 102;
     aAlfa2 = aAlfa % 402;

     #54#0  = #1118#0;
     #54#1  = nLinea;
     #54#2  = #1118#4 + " : " + #1118#5;
     #54#3  = ((eaExtension + "zzz") % 103) + (("00000" + #54#0) % -105) + (("0000" + #54#1) % -104) + "." + eaExtension;
     #54#4  = #1118#2;
     #54#8  = aAlfa1;
     #54#9  = aAlfa2;
     #54#10 = enCodUbica;
     #54#11 = #1118#6;
     #54#12 = #1118#7;
     |GRABA 020#54n;
     |LIBERA #54;
|FPRC;

|DEFBUCLE agim0018;
     #1118#1;
     ;
     00000, 00;
     99999, 99;
     ;
     NULL, CreaDocu;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |ABRE #54;  |CIERRA #54;  |DELINDEX #54;

     |ABRE #54;
     |BUCLE agim0018;
     |CIERRA #54;
|FPRC;

|PROGRAMA;
     |ABRE #1118;
     |LEE 040#1118p;
     |SI FSalida ! 0;
         |MENAV  "     No hay Registros de Cartas e Informes";
         |ACABA;
     |FINSI;
     |CIERRA #1118;

     |ABRE #1115;
     |LEE 040#1115p;
     |SI FSalida ! 0;  |DDEFECTO #1115;  |FINSI;
     |CIERRA #1115;

     |SI #1115#15 ! "S";
         |MENAV "0000 No se ha hecho la Unificion de los Codigos";
         |ACABA;
     |FINSI;

     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
|FPRO;
