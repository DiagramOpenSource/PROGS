|FICHEROS;
     :/integral/def/dsam0010,MANTE;
     :/integral/def/dsam0000;
     :/integral/def/dsam0116;
     :/integral/def/dsam0118;

     :/facturar/def/facemp1;
     :/facturar/def/asm00022;

     :/integral/def/dsaw0003;
     dsaw0035@;
|FIN;

|VARIABLES;
     nInkey      = 0;
     aAlfa       = "";
     aMas        = "";
     nModo       = 0;
     nNume       = 0;
     nFSalida    = 0;
     nBanco      = 0;
     nSwCambia = 0;

     nEmpres     = 0;
     aEmpres     = "";
     nHandle     = 0;
     nSw         = 0;
     aAlfa1      = "";
     aAlfa2      = "";
     aCuenta     = "";
     aPais       = "";
     aChar       = "";
     aCadena     = "";
     nCalc       = 0;

     &eaEntidad  = "";
     &eaSucursal = "";
     &eaCuenta   = "";
     &eaDC       = "";
     &enSwDSArchi = 0;
     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";
     &eaIBANant  = "";
     nSwC        = 0;

     &eaM22Prog  = "";
     &enM22Clie  = 0;
     &enM22MoFa  = 0;
     &eaM22MoFa  = "";
     &enM22Modo  = 0;
     &enM22Inkey = 0;
|FIN;

|PROCESO Tipo11m0010; |TIPO 11;

     enM22Inkey = FSalida;
     |SI enM22Inkey = 10; |O enM22Inkey = 11;
         eaM22Prog  = "dsam0010";
         enM22Clie  = #dsam0010#0;
         enM22MoFa  = #dsam0010#1;
         enM22Modo  = 4;
         |SUB_EJECUTA_NP ":integral/dsam0022";
         |ERROR;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO CogeCuenta;  |TIPO 7;
     #dsam0010#18 = #dsam0000#1;
     aAlfa = #dsam0010#15;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     #dsam0010#15 = #dsam0000#103;  |PINTA #dsam0010#15;

     aAlfa = #dsam0010#15;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     #dsam0010#15 = "4300000" + (("00000" + #dsam0000#0) % -105); |PINTA #dsam0010#15;
|FPRC;

|PROCESO EmpreFactura;
     |ABRE #facemp1;
     #facemp1#0 = #dsam0010#1;
     |LEE 040#facemp1.=;
     |SI FSalida ! 0;
         |CIERRA #facemp1;
         |MENAV "     No existe Empresa de Facturacion";
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #facemp1;

     |SI #facemp1#3 ! "S";
         |MENAV "     La Empresa no esta activada en la PI";
         |ERROR;
         |ACABA;
     |FINSI;

     #dsam0010#2 = #facemp1#1;
     |PINTA #dsam0010#2;

     aAlfa = #dsam0010#22 + #dsam0010#23 + #dsam0010#24 + #dsam0010#25 + #dsam0010#26 + #dsam0010#27; |QBF aAlfa;
     aAlfa1 = #dsam0010#28; |QBF aAlfa1;
     aAlfa2 = #dsam0010#30; |QBF aAlfa2;
     |SI aAlfa = ""; |Y aAlfa1 = ""; |Y aAlfa2 = "";
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "facturar/fich/" + (("00" + #facemp1#0) % -102) + "/";
        |PATH_DAT #asm00022#aAlfa#;
        |ABRE #asm00022;
        #asm00022#0 = #dsam0000#0;
        |LEE 000#asm00022.=;
        |SI FSalida = 0;
           aAlfa = #asm00022#4; |QBF aAlfa;
           aAlfa1 = aAlfa % 0104; aAlfa = aAlfa % 0599; #dsam0010#22 = aAlfa1;
           aAlfa1 = aAlfa % 0104; aAlfa = aAlfa % 0599; #dsam0010#23 = aAlfa1;
           aAlfa1 = aAlfa % 0104; aAlfa = aAlfa % 0599; #dsam0010#24 = aAlfa1;
           aAlfa1 = aAlfa % 0104; aAlfa = aAlfa % 0599; #dsam0010#25 = aAlfa1;
           aAlfa1 = aAlfa % 0104; aAlfa = aAlfa % 0599; #dsam0010#26 = aAlfa1;
           aAlfa1 = aAlfa % 0104; aAlfa = aAlfa % 0599; #dsam0010#27 = aAlfa1;
           #dsam0010#28 = #asm00022#5;
           #dsam0010#29 = #asm00022#2;
           #dsam0010#30 = #asm00022#3;
           #dsam0010#31 = #asm00022#6;

           |SI #dsam0010#5 = "    "; |Y #dsam0010#6 = "    "; |Y #dsam0010#8 = "          ";
              #dsam0010#5 = #dsam0010#23;
              #dsam0010#6 = #dsam0010#24;
              aAlfa = #dsam0010#25; aAlfa = aAlfa % 0102;
              #dsam0010#7 = aAlfa;
              aAlfa = aAlfa + #dsam0010#26 + #dsam0010#27;
              #dsam0010#8 = aAlfa;
           |FINSI;
        |FINSI;
        |CIERRA #asm00022;
     |FINSI;

     |HAZ IgualoM10aW3;
     |HAZ GrabaAntesM22;
|FPRC;

|PROCESO IgualoM10aW3;
     eaM22Prog  = "dsam0010";
     enM22Clie  = #dsam0010#0;
     enM22MoFa  = #dsam0010#1;
     eaM22MoFa  = #dsam0010#2;
     |DDEFECTO #dsaw0003;
     #dsaw0003#0 = #dsam0010#3;
     #dsaw0003#1 = #dsam0010#4;
     #dsaw0003#2 = #dsam0010#5;
     #dsaw0003#3 = #dsam0010#6;
     #dsaw0003#4 = #dsam0010#7;
     #dsaw0003#5 = #dsam0010#8;
     #dsaw0003#7 = #dsam0010#9;
     #dsaw0003#8 = #dsam0010#10;
     #dsaw0003#9 = #dsam0010#11;
     #dsaw0003#10 = #dsam0010#12;
     #dsaw0003#11 = #dsam0010#13;
     #dsaw0003#12 = #dsam0010#14;
     #dsaw0003#13 = #dsam0010#15;
     #dsaw0003#16 = #dsam0010#19;
     #dsaw0003#17 = #dsam0010#17;
     #dsaw0003#18 = #dsam0010#20;
     #dsaw0003#19 = #dsam0010#21;
     #dsaw0003#20 = #dsam0010#28;
     #dsaw0003#21 = #dsam0010#32;
     #dsaw0003#22 = #dsam0010#22;
     #dsaw0003#23 = #dsam0010#29;
     #dsaw0003#24 = #dsam0010#30;
     #dsaw0003#25 = #dsam0010#31;
|FPRC;

|PROCESO Tipo2m0010; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 2;
         nNume = 0 +. 1;
         |SI nNume < 0; |ACABA; |FINSI;
     |FINSI;
     enM22Modo = nModo;

     |HAZ IgualoM10aW3;
     |HAZ GrabaDespuesM22;
|FPRC;


|PROCESO ConsEntidadm10;  |TIPO 66;
     |DBASE aMas;  |QBF aMas;
     aMas = aMas + "def/dsaw0035.mas";
     |CARGA_DEF aMas, dsaw0035@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;
     |ABRE #dsaw0035@;
     |SELECT #4#dsaw0035@;
     #dsaw0035@#2 = #dsam0010#5;
     #dsaw0035@#3 = #dsam0010#6;
     #dsaw0035@#0 = #dsam0010#3;
     |LEE 040#dsaw0035@.];
     |SI FSalida ! 0;
         |LEE 040#dsaw0035@.p;
     |FINSI;
     |CONSULTA_CLAVE #4#dsaw0035@;
     nFSalida = FSalida;
     |CIERRA #dsaw0035@;
     |POPV;

     |SI nFSalida = 0;
         #dsam0010#3  = #dsaw0035@#0;   |PINTA #dsam0010#3;
         #dsam0010#4  = #dsaw0035@#1;   |PINTA #dsam0010#4;
         #dsam0010#5  = #dsaw0035@#2;   |PINTA #dsam0010#5;
         #dsam0010#6  = #dsaw0035@#3;   |PINTA #dsam0010#6;
         #dsam0010#17 = #dsaw0035@#5;   |PINTA #dsam0010#17;
     |FINSI;

     |DESCARGA_DEF #dsaw0035@;
|FPRC;

|PROCESO SinBancom10;
     nInkey = FSalida;
     |SI nInkey = 10;
         #dsam0010#3  = #dsam0000#88;  |PINTA #dsam0010#3;
         #dsam0010#4  = #dsam0000#89;  |PINTA #dsam0010#4;
         #dsam0010#5  = #dsam0000#90;  |PINTA #dsam0010#5;
         #dsam0010#6  = #dsam0000#91;  |PINTA #dsam0010#6;
         #dsam0010#7  = #dsam0000#92;  |PINTA #dsam0010#7;
         #dsam0010#8  = #dsam0000#93;  |PINTA #dsam0010#8;
         #dsam0010#9  = #dsam0000#94;  |PINTA #dsam0010#9;

         #dsam0010#10 = #dsam0000#73;  |PINTA #dsam0010#10;
         #dsam0010#11 = #dsam0000#74;  |PINTA #dsam0010#11;
         #dsam0010#12 = #dsam0000#95;  |PINTA #dsam0010#12;
         #dsam0010#13 = #dsam0000#96;  |PINTA #dsam0010#13;
         #dsam0010#14 = #dsam0000#97;  |PINTA #dsam0010#14;
         #dsam0010#15 = #dsam0000#103; |PINTA #dsam0010#15;


         |ABRE #dsam0118;
         #dsam0118#0 = #dsam0010#09;
         |LEE 000#dsam0118.=;
         |SI FSalida ! 0;  |DDEFECTO #dsam0118;  |FINSI;
         |CIERRA #dsam0118;
         #dsam0010#16 = #dsam0118#1; |PINTA #dsam0010#16;

         |ABRE #dsam0116;
         #dsam0116#0 = #dsam0010#3;
         |LEE 000#dsam0116.=;
         |SI FSalida ! 0;  |DDEFECTO #dsam0116;  |FINSI;
         |CIERRA #dsam0116;
         #dsam0010#17 = #dsam0116#5; |PINTA #dsam0010#17;

         #dsam0010#19 = #dsam0000#71;  |PINTA #dsam0010#19;
         #dsam0010#20 = #dsam0000#111; |PINTA #dsam0010#20;
         #dsam0010#21 = #dsam0000#112; |PINTA #dsam0010#21;

         #dsam0010#22 = #dsam0000#116; |PINTA #dsam0010#22;
         #dsam0010#28 = #dsam0000#114; |PINTA #dsam0010#28;
         #dsam0010#29 = #dsam0000#118; |PINTA #dsam0010#29;
         #dsam0010#30 = #dsam0000#117; |PINTA #dsam0010#30;
         #dsam0010#31 = #dsam0000#119; |PINTA #dsam0010#31;
         #dsam0010#32 = #dsam0000#115; |PINTA #dsam0010#32;
     |FINSI;

     |C_M #dsam0010#4,  1, "S";
     |C_M #dsam0010#6,  1, "S";
     |C_M #dsam0010#17, 1, "S";
     |C_M #dsam0010#7,  1, "S";
     |C_M #dsam0010#8,  1, "S";

     |SI #dsam0010#5 = "    ";
                               #dsam0010#3  = 0;   |PINTA #dsam0010#3;
         |C_M #dsam0010#4,  1, "N";  #dsam0010#4  = "";  |PINTA #dsam0010#4;
         |C_M #dsam0010#17, 1, "N";  #dsam0010#17 = "";  |PINTA #dsam0010#17;
         |C_M #dsam0010#6,  1, "N";  #dsam0010#6  = "";  |PINTA #dsam0010#6;
         |C_M #dsam0010#8,  1, "N";  #dsam0010#8  = "";  |PINTA #dsam0010#8;
         |C_M #dsam0010#7,  1, "N";  #dsam0010#7  = "";  |PINTA #dsam0010#7;
     |FINSI;

     |SI enSwDSArchi = 0;
         #dsam0010#21 = "N"; |PINTA #dsam0010#21;
     |FINSI;
|FPRC;

|PROCESO ChequeaBancom10;
     |SI #dsam0010#5 = "    ";  |ACABA;  |FINSI;

     |ABRE #dsam0116;
     |SELECT #4#dsam0116;
     #dsam0116#2 = #dsam0010#5;
     #dsam0116#3 = #dsam0010#6;
     #dsam0116#0 = #dsam0010#3;
     |LEE 040#dsam0116.];
     |SI FSalida ! 0;  |O #dsam0116#2 ! #dsam0010#5;  |O  #dsam0116#3 ! #dsam0010#6;
         #dsam0116#2 = #dsam0010#5;
         #dsam0116#3 = #dsam0010#6;
         #dsam0116#0 = 0;
         |LEE 040#dsam0116.];
         |SI FSalida ! 0;  |O #dsam0116#2 ! #dsam0010#5;  |O  #dsam0116#3 ! #dsam0010#6;
             |CONFI "0000SNo existe el Banco, Desea crearlo.";
             |SI FSalida ! 0;  |ERROR;  |ACABA;  |FINSI;

             |SELECT #1#dsam0116;
             |PARA nBanco = 1;  |SI nBanco [ 99999;  |HACIENDO nBanco = nBanco + 1;
                   #dsam0116#0 = nBanco;
                   |LEE 000#dsam0116.=;
                   |SI FSalida ! 0;  |SAL;  |FINSI;
             |SIGUE;

             |SI nBanco > 99999;
                 |MENAV "000 No permito mas Bancos.";
                 |ERROR;
                 |ACABA;
             |FINSI;

             |DDEFECTO #dsam0116;
             #dsam0116#0 = nBanco;
             #dsam0116#2 = #dsam0010#5;
             #dsam0116#3 = #dsam0010#6;
             |GRABA 020#dsam0116.b;

             |PUSHV 0501 2380;
             |PINPA #0#dsam0116;
             |PINDA #0#dsam0116;
             |ENDATOS #1#dsam0116;
             |SI FSalida = 0;
                 |GRABA 020#dsam0116.a;
                 |LIBERA #dsam0116;
             |SINO;
                 |BORRA 020#dsam0116.a;
                 |LIBERA #dsam0116;

                 |POPV;
                 |ERROR;
                 |ACABA;
             |FINSI;
             |POPV;
         |FINSI;
     |FINSI;

     #dsam0010#3  = #dsam0116#0;   |PINTA #dsam0010#3;
     #dsam0010#4  = #dsam0116#1;   |PINTA #dsam0010#4;
     #dsam0010#17 = #dsam0116#5;   |PINTA #dsam0010#17;
     |CIERRA #dsam0116;

     aAlfa = #dsam0010#4;  |QBF aAlfa;
     |C_M #dsam0010#4, 1, "N";
     |SI aAlfa = "";  |C_M #dsam0010#4, 1, "S";  |FINSI;

     |C_M #dsam0010#17, 1, "N";
     |SI aAlfa = "";  |C_M #dsam0010#17, 1, "S";  |FINSI;
|FPRC;

|PROCESO DCm10;
     eaEntidad  = #dsam0010#5; |QBF eaEntidad;
     eaSucursal = #dsam0010#6; |QBF eaSucursal;
     eaCuenta   = #dsam0010#8; |QBF eaCuenta;
     eaDC       = "";

     |SI eaEntidad = "";  |Y eaSucursal = "";  |Y eaCuenta = "";
         |ACABA;
     |FINSI;

     |HAZ CalculoDC;

     |SI FSalida ! 10;
         |SI #dsam0010#7 ! eaDC;
             aAlfa = "     El Digito de Control deberia ser " + eaDC;
             |MENAV aAlfa;
         |FINSI;
         |ACABA;
     |FINSI;

     #dsam0010#7 = eaDC;
     |PINTA #dsam0010#7;
|FPRC;

|PROCESO VerSwC_m10; |TIPO 0;
   aAlfa = Contenido;
   |SI aAlfa ! #dsam0010#Campo#;
       nSwC = 1;
   |FINSI;
|FPRC;

|PROCESO Tipo7IBAN_Fm10;  |TIPO 7;
     aAlfa = #dsam0010#22;   |QBF aAlfa;

     |SI aAlfa ! ""; |Y nSwC = 0;  |ACABA;  |FINSI;

     |SI nSwC = 1; |Y aAlfa ! "";
         |CONFI "0000NSe han modificado los datos de la Cuenta Corriente. Recalcular el IBAN?";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     eaIBANant = "";
     eaCta     = #dsam0010#5 + #dsam0010#6 + #dsam0010#7 + #dsam0010#8;
     eaPais    = #dsam0010#32;
     |HAZ CalcuIBAN;

     #dsam0010#22 = eaIBAN;
     |PINTA #dsam0010#22;
     nSwC = 0;
|FPRC;

|PROCESO Tipo0IBAN_Fm10;  |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     eaIBANant = #dsam0010#22;
     eaCta     = #dsam0010#5 + #dsam0010#6 + #dsam0010#7 + #dsam0010#8;
     eaPais    = #dsam0010#32;
     |HAZ CheqIBAN;

     aAlfa = #dsam0010#22;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |SI aAlfa = "";
             #dsam0010#22 = eaIBAN;
             |PINTA #dsam0010#22;
         |SINO;
             |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
             |SI FSalida = 0;
                 #dsam0010#22 = eaIBAN;
                 |PINTA #dsam0010#22;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo12Fm10;  |TIPO 12;

     eaIBANant = #dsam0010#22;
     eaCta     = #dsam0010#5 + #dsam0010#6 + #dsam0010#7 + #dsam0010#8;
     eaPais    = #dsam0010#32;
     |HAZ CheqIBAN;

     aAlfa = #dsam0010#22;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN; |Y aAlfa ! "";
         |MENAV "0000El codigo IBAN puede ser erroneo.";
     |FINSI;
     nSwC = 0;
|FPRC;
