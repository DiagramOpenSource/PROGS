|FICHEROS;
    dsam0000;
    dsam0126;
    dsat0004,MANTE;

    :laboral/labempre;
    :laboral/labtraba;
    :laboral/nomhicca;
    :laboral/nomconca;

    dsat004@;
|FIN;

|VARIABLES;
     nTecla     = 0;
     nBoton2    = -1;
     nBoton3    = -1;
     nBoton4    = -1;
     nSwBoton3  = 0;

     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;
     nSwError  = 0;
     informe     = "";
     inform1     = "dsat0004";
     inform2     = "dsat1004";

     aDef        = "";
     aBase       = "";
     nEmpresa    = 0;
     nEjer       = 0;
     nMes        = 0;
     nAlgun      = 0;
     nTrabajador = 0;
     nSwBueno    = 0;
     nConvenio   = 0;
     aConvenio   = "";
     aPath       = "";
     nCampNum    = 0;
     aActual     = "";

     &eaParam       = "";
     &eaPathLaboral = "";
     &eaFichero     = "";
     &enProceso     = 0;
     &eaObActual    = "";
     &enAlgun       = 0;

     &enEjer     = 0;
     &enEmpresa  = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &enHMes     = 0;
     &eaDMes     = "";
     &eaObCalcul = "";
     &eaNomEmpresa = "";
     &enAgeEmpresa = 0;
     &eaAgeEmpresa = "";
     &eaTelEmpresa = "";
     &eaNifEmpresa = "";
|FIN;

|| *******************************************************************
|PROCESO GrabaAuxiliar;
    #dsat0004#0 = nEmpresa;
    #dsat0004#1 = enEjer;
    #dsat0004#2 = nConvenio;
    |LEE 141#dsat0004.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0004;
        #dsat0004#0 = nEmpresa;
        #dsat0004#1 = enEjer;
        #dsat0004#2 = nConvenio;
        #dsat0004#3 = #dsam0000#1;
        #dsat0004#4 = aConvenio;
        #dsat0004#5 = 00;
        #dsat0004#6 = 00;
        #dsat0004#8 = aActual;
        #dsat0004#9 = 0000;
        #dsat0004#10= #dsam0000#72;
        #dsat0004#11= #dsam0000#52;
        #dsat0004#12= #dsam0000#54;
        #dsat0004#27= #dsam0000#3;
        |GRABA 020#dsat0004.b;
    |FINSI;
    |SI #dsat0004#5 = 0; |O #dsat0004#5 > nMes;
        #dsat0004#5 = nMes;
    |FINSI;
    |SI #dsat0004#6 = 0; |O #dsat0004#6 < nMes;
        #dsat0004#6 = nMes;
    |FINSI;
    |SI nAlgun = 0;
        #dsat0004#13 = #dsat0004#13 + 1;
    |FINSI;
    nPara1 = nMes + 13;
    #dsat0004#nPara1# = #dsat0004#nPara1# + 1;
    #dsat0004#7 = "SI";

    |GRABA 020#dsat0004.a;
    |LIBERA #dsat0004;
    nAlgun  = 1;
    enAlgun = 1;

    eaObCalcul = #dsat0004#7;
|FPRC;

|PROCESO LeoConvenios;
    #nomconca#0 = nConvenio;
    |LEE 041#nomconca.=;
    |SI FSalida = 0;
        #dsam0126#0 = #nomconca#142;
        |LEE 041#dsam0126.=;
        |SI FSalida = 0; |Y #dsam0126#2 = "S";
            nSwBueno = 0;
            aConvenio = #nomconca#1;
        |FINSI;
    |FINSI;
|FPRC;

|PROCESO LeeTrabajador;
    nSwBueno  = 1;
    nAlgun    = 0;
    nConvenio = 0;
    aConvenio = "";
    |DDEFECTO #labtraba;
    #labtraba#0 = nEmpresa;
    #labtraba#1 = nTrabajador;
    |LEE 041#labtraba.=;
    |SI FSalida = 0; |Y #labtraba#247 ! 0521; |Y #labtraba#247 ! 0138;
        nSwBueno  = 0;
    |FINSI;
    |SI nSwBueno = 0; |Y enProceso = 2;
        nSwBueno = 1;
        nConvenio = #labtraba#87;
        |HAZ LeoConvenios;
    |FINSI;
|FPRC;

|PROCESO nomhicca;
    |SI nTrabajador = 0;
        nTrabajador = #nomhicca#1;
        |HAZ LeeTrabajador;
    |FINSI;
    |SI nTrabajador ! #nomhicca#1;
        nTrabajador = #nomhicca#1;
        |HAZ LeeTrabajador;
    |FINSI;

    |SI nSwBueno = 1; |ACABA; |FINSI;

    nMes = #nomhicca#2;
    |HAZ GrabaAuxiliar;
    nAlgun = 1;
|FPRC;

|DEFBUCLE nomhicca;
     #nomhicca#1;
     ;
     nEmpresa, 00001, nEjer, enDMes, 0;
     nEmpresa, 99999, nEjer, enHMes, 0;
     ;
     NULL, nomhicca;
|FIN;

|PROCESO LeoDsam0000;
   nEmpresa = #dsam0000#0;
   aActual  = "NO";
   |SI #dsam0000#nCampNum# = "S";  aActual = "SI"; |FINSI;
   |SI eaObActual = "N"; |Y #dsam0000#nCampNum# = "S";
       |ACABA;
   |FINSI;

   eaObCalcul = "NO";

   #labempre#0 = #dsam0000#0;
   |LEE 041#labempre.=;
   |SI FSalida = 0;
       nTrabajador = 0;
       |ABRE #labtraba;
       |BUCLE nomhicca;
       |CIERRA #labtraba;
   |FINSI;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   72;
   enDEmpresa, enDAgente;
   enHEmpresa, enHAgente;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO ObligaNomina;

     aPath = eaPathLaboral + "fich/";
     |PATH_DAT #labempre#aPath#;
     |PATH_DAT #labtraba#aPath#;
     |PATH_DAT #nomconca#aPath#;
     |PATH_DAT #nomhicca#aPath#;

     nEjer = enEjer - 2000;
     nCampNum = 122; |SI enProceso = 2; nCampNum = 123; |FINSI;

     enAlgun = 0;
     |ABRE #dsat0004;
     |ABRE #dsam0126;
     |ABRE #labempre;
     |ABRE #nomconca;
     |SI eaParam = "";
         |BUCLE dsam0000;
     |SINO;
         #dsam0000#0  = enEmpresa;
         #dsam0000#1  = eaNomEmpresa;
         #dsam0000#72 = enAgeEmpresa;
         #dsam0000#52 = eaAgeEmpresa;
         #dsam0000#54 = eaTelEmpresa;
         #dsam0000#3  = eaNifEmpresa;
         |HAZ LeoDsam0000;
     |FINSI;
     |CIERRA #nomconca;
     |CIERRA #labempre;
     |CIERRA #dsam0126;

     || |CONSULTA_CLAVE #1#dsat0004;
     |CIERRA #dsat0004;
|FPRC;
||/////////////////////////////////////////////////////////////////////////

|PROCESO Tipo5t004;  |TIPO 5;
     || |LEE 040#dsat0004.p;
     || #dsat0004#8 = "N";
     || |LINEAS_BI_ATRI #dsat0004#8, D, S, -1;
|FPRC;

|| //////////////////////////////////////////////////////////////
|PROCESO InforDsat0004;
   |PARA nPara1 = 0; |SI nPara1 [ 27; |HACIENDO nPara1 = nPara1 + 1;
         #dsat0004#nPara1# = #dsat004@#nPara1#;
   |SIGUE;
   |PRINT;
   nAlgun = 1;
|FPRC;

|DEFBUCLE LeeDsat0004;
   #dsat004@#1003;
   ;
   enEjer, enDEmpresa, 000;
   enEjer, enHEmpresa, 999;
   ;
   NULL, InforDsat0004;
|FIN;
|| //////////////////////////////////////////////////////////////

|PROCESO LosInformes;
   |HAZ CargaFichero;
   |SI nSwError = 1;  |ACABA;  |FINSI;

   informe = inform1;
   |SI enProceso = 2; informe = inform2; |FINSI;

   nAlgun  = 0;
   |IMPRE 0;
   |SI FSalida ! 0;
       |ACABA;
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |MENAV "0000No existe informe";
       |FINIMP;
       |ACABA;
   |FINSI;

   |SALVA_DATOS #dsat0004;
   |BUCLE LeeDsat0004;
   |SI nAlgun = 1;
       |PIEINF;
   |FINSI;
   |FININF;
   |FINIMP;

   |HAZ DesCargaFichero;
   |REPON_DATOS #dsat0004;
|FPRC;

|PROCESO CargaFichero;
   |DBASE aBase;
   aDef = aBase + "def/dsat0004";
   |CARGA_DEF aDef, dsat004@;
   |SI FSalida ! 0;
       |MENAV "0000Error cargado def, proceso interrumpido";
       nSwError = 1;
   |SINO;
       |NOME_DAT #dsat004@#eaFichero#;
   |FINSI;
|FPRC;

|PROCESO DesCargaFichero;
   |DESCARGA_DEF #dsat004@;
|FPRC;

|PROCESO ObligarSI;

   |LEE 141#dsat0004.=;
   |SI #dsat0004#7 = "SI";
       #dsat0004#7 = "NO ";
   |SINO;
       #dsat0004#7 = "SI";
   |FINSI;
   |PINTA #dsat0004#7;

   |GRABA 020#dsat0004.a;
   |LIBERA #dsat0004;
|FPRC;

|| /////////////////////////////////////////////////////////
|PROCESO Boton2t004;
     |PTEC 824;
|FPRC;

|PROCESO Boton3t004;
     |PTEC 825;
|FPRC;

|PROCESO FinBotont004;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo0t004;  |TIPO 0;
     |HAZ FinBotont004;
|FPRC;

|PROCESO Tipo7t004;  |TIPO 7;
     |BLIN 04;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Imprimir ", 0635, 0655, Boton2t004;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Obligado SI/NO ", 0657, 0677, Boton3t004;
     nBoton3 = FSalida;

     |ESTADO_CONTROL nBoton3,  "DISABLE";  nSwBoton3  = 0;
     |SI #dsat0004#8 = "NO";
         |ESTADO_CONTROL nBoton3,  "ENABLE";  nSwBoton3 = 1;
     |FINSI;
|FPRC;

|PROCESO Tipo11t004;  |TIPO 11;
     nTecla = FSalida;

     |HAZ FinBotont004;

     enEmpresa     = #dsat0004#0;
     enEjer        = #dsat0004#1;

     |SI nTecla = 10;
         |HAZ LosInformes;
     |FINSI;

     |SI nTecla = 11; |Y nSwBoton3  = 1;
         |HAZ ObligarSI;
         |PONCONTROL  23, "SI";
     |FINSI;
|FPRC;
