|FICHEROS;
     dsam0001;
     dsam0015;
     dsam0016;
     dsam0108;

     dsaw0040,MANTE;
     dsaw0041,MANTE;

     :modelos/dsmom108;
|FIN;

|VARIABLES;
     nVentana         = -1;
     nVent            = -1;
     nBtnAltaUsu      = -1;
     nBtnBorrUsu      = -1;
     nBtnAlta         = -1;
     nBtnModi         = -1;
     nBtnBorr         = -1;
     nBtnPagi         = -1;
     nBtnUsus         = -1;
     nBtnConf         = -1;
     nRango           = -1;
     nLabel           = -1;
     nGraba           = -1;
     nPanta           = -1;
     nGrid01          = -1;
     nGrid02          = -1;

     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aAlfa            = "";
     aUsuario         = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     {-1}aAviso       = "";
         aAviso1      = "";
         aAviso2      = "";
         aAviso3      = "";
         aAviso4      = "";

     &eaDSMAC          = "";
     &eaPathExplorador = "";
     &eaForzExplorador = "";
     &eaPrograma       = "";
     &enAprobacion     = 0;
|FIN;

|PROCESO Evento01;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsam0015.=;

         |ESTADO_CONTROL nBtnModi, "ENABLE";
         |ESTADO_CONTROL nBtnBorr, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         |HAZ BtnModi;
     |FINSI;
|FPRC;

|PROCESO BtnAlta;
     |VENTANA 0501, 1880, -1, 16, "Nuevo registro";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |C_M #dsaw0040#0, 1, "S";
     |C_M #dsaw0040#1, 1, "S";
     |C_M #dsaw0040#2, 1, "S";
     |C_M #dsaw0040#3, 1, "S";
     |C_M #dsaw0040#4, 1, "S";
     |C_M #dsaw0040#5, 1, "S";

     |DDEFECTO #dsaw0040;
     |PINPA #0#dsaw0040;
     |PINDA #0#dsaw0040;

     |ENDATOS #1#dsaw0040;
     |SI FSalida = 0;
         #dsam0015#0 = #dsaw0040#0;
         #dsam0015#1 = #dsaw0040#1;
         #dsam0015#2 = #dsaw0040#2;
         #dsam0015#3 = #dsaw0040#3;
         #dsam0015#4 = #dsaw0040#4;
         #dsam0015#5 = #dsaw0040#5;
         |GRABA 020#dsam0015.n;
         |LIBERA #dsam0015;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
     |PULSATECLA;
|FPRC;

|PROCESO BtnModi;
     |LEE 101#dsam0015.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1880, -1, 16, "Modificar registro";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |C_M #dsaw0040#0, 1, "N";
     |C_M #dsaw0040#1, 1, "S";
     |C_M #dsaw0040#2, 1, "S";
     |C_M #dsaw0040#3, 1, "S";
     |C_M #dsaw0040#4, 1, "S";
     |C_M #dsaw0040#5, 1, "S";

     |DDEFECTO #dsaw0040;

     #dsaw0040#0 = #dsam0015#0;
     #dsaw0040#1 = #dsam0015#1;
     #dsaw0040#2 = #dsam0015#2;
     #dsaw0040#3 = #dsam0015#3;
     #dsaw0040#4 = #dsam0015#4;
     #dsaw0040#5 = #dsam0015#5;

     |PINPA #0#dsaw0040;
     |PINDA #0#dsaw0040;

     |ENDATOS #1#dsaw0040;
     |SI FSalida = 0;
         #dsam0015#1 = #dsaw0040#1;
         #dsam0015#2 = #dsaw0040#2;
         #dsam0015#3 = #dsaw0040#3;
         #dsam0015#4 = #dsaw0040#4;
         #dsam0015#5 = #dsaw0040#5;
         |GRABA 020#dsam0015.a;
         |LIBERA #dsam0015;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
     |PULSATECLA;
|FPRC;

|PROCESO BtnBorr;
     |LEE 101#dsam0015.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el registro seleccionado";
     |SI FSalida ! 0;
         |LIBERA #dsam0015;
         |ACABA;
     |FINSI;

     |BORRA 020#dsam0015.a;
     |LIBERA #dsam0015;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
|FPRC;

|PROCESO Explorador;
     |HAZ CogeMac;

     |ABRE #dsmom108;
     #dsmom108#0 = eaDSMAC;
     |LEE 101#dsmom108.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom108;
         #dsmom108#0 = eaDSMAC;
         |GRABA 020#dsmom108.b;
     |FINSI;

     eaPathExplorador = #dsmom108#3;  |QBF eaPathExplorador;

     |SI eaPathExplorador = "";  |O eaForzExplorador = "S";
         |MENAV "0000Busque y pinche en el explorador con el que quiera trabajar";

         eaPathExplorador = "F" + eaPathExplorador;
         |BROWSE eaPathExplorador;
         eaPathExplorador = eaPathExplorador % 290;  |QBF eaPathExplorador;
     |FINSI;

     |SI eaPathExplorador ! "";
         #dsmom108#3 = eaPathExplorador;
     |FINSI;

     |GRABA 020#dsmom108.a;
     |LIBERA #dsmom108;
     |CIERRA #dsmom108;
|FPRC;

|PROCESO Explora;
     eaForzExplorador = "S";
     |HAZ Explorador;

     #dsaw0041#0 = eaPathExplorador;   |PINTA #dsaw0041#0;
|FPRC;

|PROCESO BtnConf;
     |VENTANA 0501, 1287, -1, 16, "Configuraci¢n URL";
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     eaForzExplorador = "N";
     |HAZ Explorador;

     #dsaw0041#0 = eaPathExplorador;

     |ABRE #dsam0001;
     |LEE 000#dsam0001.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0001;  |FINSI;

     #dsaw0041#1 = #dsam0001#11;

     |PINPA #0#dsaw0041;  nPanta = FSalida;
     |PINDA #0#dsaw0041;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}", 0786, 0787, Explora;

     |ENDATOS #1#dsaw0041;
     |SI FSalida = 0;
         |LEE 101#dsam0001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsam0001;
             |GRABA 020#dsam0001.b;
         |FINSI;
         #dsam0001#11 = #dsaw0041#1;

         |GRABA 020#dsam0001.a;
         |LIBERA #dsam0001;
     |FINSI;

     |CIERRA #dsam0001;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVent;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
     |PULSATECLA;
|FPRC;

|PROCESO BtnPagi;
     |ABRE #dsam0001;
     |LEE 000#dsam0001.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0001;  |FINSI;
     |CIERRA #dsam0001;

     eaForzExplorador = "N";
     |HAZ Explorador;

     |SI eaPathExplorador ! "";
         aAlfa = eaPathExplorador + " " + #dsam0001#11;  |QBF aAlfa;
         aAlfa = "cmd " + &34 + "/c START /WAIT " + aAlfa + &34;
     |SINO;
         aAlfa  = "cmd " + &34 + "/c START /WAIT " + #dsam0001#11;  |QBF aAlfa;
         aAlfa  = aAlfa + &34;
     |FINSI;

     |RSYSTEM aAlfa;

     aUsuario = Usuario % 810;
     |ABRE #dsam0016;
     #dsam0016#0 = aUsuario;
     |LEE 101#dsam0016.=;
     |SI FSalida = 0;
         aAviso1 = "1";
         aAviso2 = "1";
         aAviso3 = "Plataforma Integrada DS";
         aAviso4 = "DEH revisadas a día de hoy";
         |ESPECIFICA "MENSAJETRAY", aAviso;

         |HORA aAlfa;

         #dsam0016#1 = ~;
         #dsam0016#2 = aAlfa;
         |GRABA 020#dsam0016.a;
         |LIBERA #dsam0016;
     |FINSI;

     |FOCOTECLADO nGrid01;
|FPRC;

|PROCESO Evento02;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsam0016.=;

         |ESTADO_CONTROL nBtnBorrUsu, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO BtnAltaUsu;
     |ABRE #dsam0108;
     |CONSULTA_CLAVE #1#dsam0108;
     |SI FSalida = 0;
         #dsam0016#0 = #dsam0108#0;
         |LEE 101#dsam0016.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsam0016;
             #dsam0016#0 = #dsam0108#0;
             |GRABA 020#dsam0016.n;
         |SINO;
             |MENAV "0000El usuario ya est  en la lista";
         |FINSI;
         |LIBERA #dsam0016;
     |FINSI;
     |CIERRA #dsam0108;

     |REFRESCACONTROL nGrid02;
     |FOCOTECLADO nGrid02;
|FPRC;

|PROCESO BtnBorrUsu;
     |LEE 101#dsam0016.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el usuario seleccionado";
     |SI FSalida ! 0;
         |LIBERA #dsam0016;
         |ACABA;
     |FINSI;

     |BORRA 020#dsam0016.a;
     |LIBERA #dsam0016;

     |REFRESCACONTROL nGrid02;

     |FOCOTECLADO nGrid02;
|FPRC;

|PROCESO BtnUsus;
     |VENTANA 0501, 2035, -1, 16, "Lista usuarios avisos";
     nVent = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 1826, 1834, BtnAltaUsu;
     nBtnAltaUsu = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 1816, 1824, BtnBorrUsu;
     nBtnBorrUsu = FSalida;

     |ABRE #dsam0016;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsam0016, nRango, 0502, 1734, NULL, NULL, Evento02;
     nGrid02 = FSalida;

     |ESTADO_CONTROL nBtnBorrUsu, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid02;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #dsam0016;

     |FIN_CONTROL_WINDOWS nBtnAltaUsu;
     |FIN_CONTROL_WINDOWS nBtnBorrUsu;

     |DESTRUYECONTROL nGrid02;

     |FINVENTANA nVent;
|FPRC;

|PROGRAMA;
     eaPrograma = "ACTIVADEH";
     |HAZ DSARCHI_INI;
     |SI enAprobacion = 1;
         |SUB_EJECUTA "av060z00";
         |ACABA;
     |FINSI;

     |ABRET #dsam0015;

     |VENTANA 0501, 3599, -1, 0, "";
     nVentana = FSalida;

     aAlfa = "LABEL,{{15}}DIRECCION ELECTRONICA HABILITADA";
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0598, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 3362, 3372, BtnAlta;
     nBtnAlta = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 3374, 3386, BtnModi;
     nBtnModi = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 3388, 3398, BtnBorr;
     nBtnBorr = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Ir a la URL", 3302, 3320, BtnPagi;
     nBtnPagi = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Lista usuarios avisos", 3322, 3340, BtnUsus;
     nBtnUsus = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Configuraci¢n URL", 3502, 3520, BtnConf;
     nBtnConf = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsam0015, nRango, 0602, 3298, NULL, NULL, Evento01;
     nGrid01 = FSalida;

     |ESTADO_CONTROL nBtnBorr, "DISABLE";
     |ESTADO_CONTROL nBtnModi, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid01;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnAlta;
     |FIN_CONTROL_WINDOWS nBtnModi;
     |FIN_CONTROL_WINDOWS nBtnBorr;
     |FIN_CONTROL_WINDOWS nBtnPagi;
     |FIN_CONTROL_WINDOWS nBtnUsus;
     |FIN_CONTROL_WINDOWS nBtnConf;

     |DESTRUYECONTROL nGrid01;

     |FINVENTANA nVentana;

     |CIERRAT #dsam0015;
|FPRO;
