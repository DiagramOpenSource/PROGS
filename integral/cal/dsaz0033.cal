|FICHEROS;
    dsaz0033;
    dsam0000;
    dsat0004;
    dsam0025;
|FIN;

|VARIABLES;
     aFichero  = "";
     nCanal    = 0;
     aBase     = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;

     nImport1  = 0;
     nImport2  = 0;
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     nEmpresa  = 0;
     nEjer     = 0;
     nAlgun    = 0;

     &enAlgun    = 0;
     &eaFichero  = "";
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpresa  = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &eaHMes     = "";
     &enHMes     = 0;
     &enProceso  = 0;
     &eaObActual = "";
     &eaObCalcul = "";
     &eaParam    = "";

     &eaPathLaboral = "";
|FIN;

|CALCULO HMes; |TIPO 0;
    enHMes = #dsaz0033#1;
    |SI enHMes = 1;  #dsaz0033#2 = "Enero     "; |FINSI;
    |SI enHMes = 2;  #dsaz0033#2 = "Febrero   "; |FINSI;
    |SI enHMes = 3;  #dsaz0033#2 = "Marzo     "; |FINSI;
    |SI enHMes = 4;  #dsaz0033#2 = "Abril     "; |FINSI;
    |SI enHMes = 5;  #dsaz0033#2 = "Mayo      "; |FINSI;
    |SI enHMes = 6;  #dsaz0033#2 = "Junio     "; |FINSI;
    |SI enHMes = 7;  #dsaz0033#2 = "Julio     "; |FINSI;
    |SI enHMes = 8;  #dsaz0033#2 = "Agosto    "; |FINSI;
    |SI enHMes = 9;  #dsaz0033#2 = "Septiembre"; |FINSI;
    |SI enHMes = 10; #dsaz0033#2 = "Octubre   "; |FINSI;
    |SI enHMes = 11; #dsaz0033#2 = "Noviembre "; |FINSI;
    |SI enHMes = 12; #dsaz0033#2 = "Diciembre "; |FINSI;
    |PINTA #dsaz0033#2;
    eaHMes = #dsaz0033#2;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0033#4 < #dsaz0033#3;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsaz0033#6 < #dsaz0033#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO LeeAuxiliar;
   |SI eaParam = "";
       #dsam0000#0 = #dsat0004#0;
       |LEE 141#dsam0000.=;
       |SI FSalida = 0;
           #dsam0000#123 = #dsat0004#7;
           |GRABA 020#dsam0000.a;
       |FINSI;
       |LIBERA #dsam0000;
  |FINSI;

  |SI #dsat0004#7 = "SI";
      #dsam0025#0 = #dsat0004#0;
      #dsam0025#1 = #dsat0004#1;
      #dsam0025#2 = #dsat0004#2;
      |LEE 141#dsam0025.=;
      |SI FSalida ! 0;
          |DDEFECTO #dsam0025;
          #dsam0025#0 = #dsat0004#0;
          #dsam0025#1 = #dsat0004#1;
          #dsam0025#2 = #dsat0004#2;
          #dsam0025#3 = 0;
          #dsam0025#4 = "";
          #dsam0025#10 = #dsat0004#13;
          #dsam0025#11 = #dsat0004#26;
          #dsam0025#25 = #dsat0004#4;
          |GRABA 020#dsam0025.b;
      |FINSI;
      |LIBERA #dsam0025;
  |FINSI;
|FPRC;

|DEFBUCLE LeeAuxiliar;
  #dsat0004#1;
  ;
  enEjer, enDEmpresa, 000;
  enEjer, enHEmpresa, 999;
  ;
  NULL, LeeAuxiliar;
|FIN;

|PROCESO ClaveBaja999;
   #dsat0004#0 = enDEmpresa;
   #dsat0004#1 = enEjer;
   #dsat0004#2 = 000;
|FPRC;

|PROCESO ClaveAlta999;
   #dsat0004#0 = enHEmpresa;
   #dsat0004#1 = enEjer;
   #dsat0004#2 = 999;
|FPRC;

|PROCESO Procesoz033;

     eaFichero = ("5x" + Usuario) % 108;
     |NOME_DAT #dsat0004#eaFichero#;
     |DELINDEX #dsat0004;

     aAlfa1 = #dsaz0033#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enEjer     = #dsaz0033#0;
     enDEmpresa = #dsaz0033#3;
     enHEmpresa = #dsaz0033#4;
     enDAgente  = #dsaz0033#5;
     enHAgente  = #dsaz0033#6;
     enDMes     = #dsaz0033#1;
     enHMes     = #dsaz0033#1;
     eaHMes     = #dsaz0033#2;
     enProceso  = 2;
     eaObActual = #dsaz0033#7;

     |HAZ ObligaNomina;
     |SI eaParam = "";
         |SI enAlgun = 1;
             |PINPA #0#dsat0004;
             |ENTLINEAL #1#dsat0004, -2, 4, 22, 0, ClaveBaja999, ClaveAlta999;
             |CONFI "0000SDesea actualizar los datos";
             |SI FSalida = 0;
                 |ABRE #dsam0000;
                 |ABRE #dsam0025;
                 |BUCLE LeeAuxiliar;
                 |CIERRA #dsam0025;
                 |CIERRA #dsam0000;
             |FINSI;
         |SINO;
             |MENAV "0000Seleccion vacia";
         |FINSI;
     |SINO;
         |SI enAlgun = 1; |Y eaObCalcul = "SI";
              aAlfa = "0000SEsta empresa esta obligada. Actualizamos los datos";
              |CONFI aAlfa;
              |SI FSalida = 0;
                 |ABRE #dsam0025;
                 |BUCLE LeeAuxiliar;
                 |CIERRA #dsam0025;
              |SINO;
                 eaObCalcul = "";
              |FINSI;
         |FINSI;
     |FINSI;
     |DELINDEX #dsat0004;
|FPRC;


|PROGRAMA;
     eaParam = PARAMETRO; |QBF eaParam;

     eaPathLaboral = "";
     |DBASS aBase;
     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathLaboral   = aBase + "laboral/";
     |SINO;
         |MENAV "0000No existe laboral";
         |ACABA;
     |FINSI;

     fFecha = ~;
     aAlfa  = fFecha;
     aAlfa  = aAlfa % -104;
     #dsaz0033#0 = aAlfa;
     aAlfa  = fFecha;
     aAlfa  = aAlfa % 402;
     #dsaz0033#1 = aAlfa;

     |SI eaParam = "";
         |CLS;
         |CABEZA "Obligacion Seguro Convenio";

         |PINPA #0#dsaz0033;
         |PINDA #0#dsaz0033;

         |ENDATOS #2#dsaz0033;
     |SINO;
         #dsaz0033#3 = enEmpresa;
         #dsaz0033#4 = enEmpresa;
         #dsaz0033#5 = 00;
         #dsaz0033#6 = 99;
         #dsaz0033#7 = "S";
         FSalida     = 0;
     |FINSI;
     |SI FSalida = 0;
         |HAZ Procesoz033;
     |FINSI;
|FPRO;
