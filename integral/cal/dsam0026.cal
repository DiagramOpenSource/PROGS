|FICHEROS;
     :/integral/def/dsam0026,MANTE;
     :/integral/def/dsam0000;
     :/integral/def/dsam0127;

     dsaw0043,MANTE;
     dsam026@;
|FIN;

|VARIABLES;
     aAlfa       = "";
     aDAlfa      = "";
     aHAlfa      = "";
     aAlfa1      = "";
     aAlfa2      = "";
     nNume1      = 0;
     nNume2      = 0;

     aBase       = "";
     aDef        = "";

     aEstado     = "";
     nInkey      = 0;
     nModo       = 0;
     &enModo     = 0;
|FIN;

|INCLUYE i_varfun;

|PROCESO Tipo5m026; |TIPO 5;
   |LEE 040#dsam0026.p;
   #dsam0026#8 = "A";
   |LINEAS_BI_ATRI #dsam0026#8, I, S, -1;
|FPRC;

|PROCESO LeeTipTarjeta; |TIPO 6;
   aAlfa = "X";
   |ABRE #dsam0127;
   #dsam0127#0 = #dsam0026#3;
   |LEE 041#dsam0127.=;
   |SI FSalida = 0;
       #dsam0026#4 = #dsam0127#1;
       aAlfa =  #dsam0127#2;
       |PINTA #dsam0026#4;
   |FINSI;
   |CIERRA #dsam0127;
|FPRC;

|PROCESO Tipo7m026; |TIPO 7;
   |SI enModo = 4;
        aAlfa = "0000Pulse <F2> Datos Estado, <F3> Todos los Transportes, <F4> Transportes en Baja";
   |SINO;
        aAlfa = "0000F2-Datos Estado, F3-Transportes en Alta, F4-Transportes en Baja, F5-Baja Todos";
   |FINSI;
   |MENSA aAlfa;
|FPRC;

|PROCESO ElMes;
   aAlfa1 = "S";
   |SI #dsam0026#5 = 0;
       #dsam0026#6 = 0; |PINTA #dsam0026#6;
       aAlfa1 = "N";
   |FINSI;
   |C_M #dsam0026#6,1,aAlfa1;
|FPRC;

|PROCESO MiraAny;
   |C_M #dsam0026#6,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 2; |ACABA; |FINSI;

   |SI #dsam0026#6 ! 0; |Y #dsam0026#6 < 2000;
       |MENAV "0000Ejercicio incorrecto";
       |ERROR;
       |ACABA;
   |FINSI;

   |SI aAlfa ! ""; |Y aAlfa ! "X";
       nNume1 = #dsam0026#6 / 2;
       nNume2 = (#dsam0026#6 / 2) ! 0;
       aAlfa1 = "I";
       |SI nNume1 = nNume2; aAlfa1 = "P"; |FINSI;
       |SI aAlfa1 ! aAlfa;
           aAlfa2 = "impares";
           |SI aAlfa = "P"; aAlfa2 = "pares"; |FINSI;
           aAlfa2 = "0000El tipo de tarjeta renueva los a¤os "+ aAlfa2;
           |MENAV aAlfa2;
           |ERROR;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO ClaveAlta;
   #dsam026@#0 = enEmpresa;
   #dsam026@#8 = aDAlfa;
   #dsam026@#1 = "          ";
|FPRC;

|PROCESO ClaveBaja;
   #dsam026@#0 = enEmpresa;
   #dsam026@#8 = aHAlfa;
   #dsam026@#1 = "zzzzzzzzzz";
|FPRC;

|PROCESO AltasBajas;
   |DBASE aBase;
   aDef = aBase + "def/dsam0026";
   |CARGA_DEF aDef, dsam026@;
   |SI FSalida = 0;
       aDAlfa = "B"; aHAlfa = "B";
       |SI nInkey = 11;
           aDAlfa = "A"; aHAlfa = "A";
           |SI enModo = 4; aHAlfa = "B"; |FINSI;
       |FINSI;

       |ABRE #dsam026@;
       #dsam026@#0 = #dsam0026#0;
       #dsam026@#1 = #dsam0026#1;
       #dsam026@#8 = #dsam0026#8;
       |CONSULTA_F_CLAVE #2#dsam026@, ClaveAlta, ClaveBaja;
       |CIERRA #dsam026@;
   |FINSI;
   |DESCARGA_DEF #dsam026@;
|FPRC;

|PROCESO dsaw0043;
   |PUSHV 0836 1480;
   |PUSHV 1336 1480;
   #dsaw0043#0 = #dsam0026#8;
   #dsaw0043#1 = #dsam0026#9;
   #dsaw0043#2 = #dsam0026#10;
   #dsaw0043#3 = #dsam0026#11;
   #dsaw0043#4 = #dsam0026#1;
   #dsaw0043#5 = "BAJA";

   |PINPA #0#dsaw0043;
   aAlfa1 = "S"; aAlfa2 = "S";
   |SI #dsaw0043#0 = "A";
       #dsaw0043#5 = "ALTA";
       aAlfa1 = "N"; aAlfa2 = "S";
       |PINTA 1156, "          ";
       |PINTA 1237, "                                            ";
       |PINTA 1337, "                                            ";
       |CUADRO 0837 1280;
       |POPV;
       #dsaw0043#2 = "01.01.0000";
       #dsaw0043#3 = "";
   |FINSI;
   |C_V #dsaw0043#1,1, aAlfa2;
   |C_V #dsaw0043#2,1, aAlfa1;
   |C_V #dsaw0043#3,1, aAlfa1;
   |PINDA #0#dsaw0043;

   |SI nModo = 4;
       |PAUSA;
   |SINO;
       |ENDATOS #1#dsaw0043;
       |SI FSalida = 0;
           #dsam0026#8  = #dsaw0043#0;
           #dsam0026#9  = #dsaw0043#1;
           #dsam0026#10 = #dsaw0043#2;
           #dsam0026#11 = #dsaw0043#3;
       |SINO;
           #dsam0026#8 = aEstado;
       |FINSI;
   |FINSI;
   |SI #dsaw0043#0 = "B"; |POPV; |FINSI;

   |POPV;
|FPRC;

|PROCESO Estado; |TIPO 0;
   nInkey = FSalida;
   nModo = (FEntrada / 100) ! 0;

   aEstado = Contenido;
   |SI nInkey = 0;
       |HAZ dsaw0043;
       |PINTA #dsam0026#8;
   |FINSI;
|FPRC;

|PROCESO TodosDeBaja;
   |SI #dsam026@#8 = "A";
       #dsam026@#8  = "B";
       #dsam026@#10 = #dsaw0043#2;
       #dsam026@#11 = #dsaw0043#3;
       |GRABA 020#dsam026@.a;
   |FINSI;
   |LIBERA #dsam026@;
|FPRC;

|DEFBUCLE TodosDeBaja;
   #dsam026@#1002;
   ;
   #dsam0026#0, "          ";
   #dsam0026#0, "zzzzzzzzzz";
   e;
   NULL, TodosDeBaja;
|FIN;

|PROCESO TodosBaja;

   |PUSHV 1036 1480;
   |BLANCO 1036 1480;
   |CUADRO 1036 1480;
   |PINTA 1139, "Fecha Baja: ";
   |PINTA 1239, "Causa :     ";

   |C_P #dsaw0043#2, 1, 1151;
   |C_V #dsaw0043#1, 1, "N";
   |C_V #dsaw0043#2, 1, "S";
   |C_V #dsaw0043#3, 1, "S";

   #dsaw0043#0 = "B";
   #dsaw0043#1 = "01.01.0000";
   #dsaw0043#2 = ~;
   #dsaw0043#3 = "";
   #dsaw0043#5 = "BAJA";

   |PINTA 1151, #dsaw0043#2;
   |PINTA 1247, #dsaw0043#3;
   |ENDATOS #1#dsaw0043;
   |SI FSalida = 0;
       |DBASE aBase;
       aDef = aBase + "def/dsam0026";
       |CARGA_DEF aDef, dsam026@;
       |SI FSalida = 0;
           |LIBERA #dsam0026;
           |BUCLE TodosDeBaja;
           |DESCARGA_DEF #dsam026@;
       |FINSI;
   |FINSI;
   |POPV;
   |C_P #dsaw0043#2, 1, 1164;
|FPRC;

|PROCESO Tipo11m026; |TIPO 11;
   nInkey = FSalida;
   nModo  = (FEntrada / 100) ! 0;
   |SI nInkey = 10; |Y nModo > 1;
       nModo = 4; |HAZ dsaw0043;
       |ERROR;
   |FINSI;

   |SI nInkey = 11; |O nInkey = 12;
       |HAZ AltasBajas;
       |ERROR;
   |FINSI;

   |SI nInkey = 13; |Y enModo ! 4;
       |CONFI "0000NDesea dar de baja todos los transportes de este Cliente";
       |SI FSalida = 0;
           |HAZ TodosBaja;
           |PONCONTROL 23, "SI";
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO Tipo12m026; |TIPO 12;
   || Sin Conforme

   |HAZ LeeTipTarjeta;
   |SI aAlfa ! ""; |Y aAlfa ! "X"; |Y #dsam0026#6 > 2000;
       nNume1 = #dsam0026#6 / 2;
       nNume2 = (#dsam0026#6 / 2) ! 0;
       aAlfa1 = "I";
       |SI nNume1 = nNume2; aAlfa1 = "P"; |FINSI;
       |SI aAlfa1 ! aAlfa;
           aAlfa2 = "impares";
           |SI aAlfa = "P"; aAlfa2 = "pares"; |FINSI;
           aAlfa2 = "0000El tipo de tarjeta renueva los a¤os "+ aAlfa2;
           |MENAV aAlfa2;
           |ERROR;
       |FINSI;
   |FINSI;

|FPRC;
