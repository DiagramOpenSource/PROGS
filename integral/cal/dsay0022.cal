|FICHEROS;
    dsay0022;

    dsam0000;
    dsam0024;
    dsam0105;
    dsam0110;

    dsat0002;
|FIN;

|VARIABLES;
     aAlfa     = "";
     aFichero  = "";
     aParam    = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;
     aColabora = "";
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     aDLiqu    = "";
     aHLiqu    = "";
     nDEmpresa = 0;
     nHEmpresa = 0;
     nDAgente  = 0;
     nHAgente  = 0;
     nDMes     = 0;
     nHMes     = 0;
     nEmpresa  = 0;
     nEjer     = 0;
     nMes      = 0;
     nAlgun    = 0;
     nHay      = 0;
     aBlancos  = "";
     aZetas    = "";

     nCamp2    = 0;
     nCamp3    = 0;
     aCamp4    = "";
     fCamp5    = @;
     fCamp6    = @;
     fCamp7    = @;
     nCamp8    = 0;
     nCamp9    = 0;
     nCamp10   = 0;
     nCamp11   = 0;
     nCamp12   = 0;
     nCamp13   = 0;
     aCamp17   = "";
     fCamp18   = @;
     nCamp19   = 0;
     nCamp20   = 0;
     aCamp21   = "";
     nCamp22   = 0;
     nCamp23   = 0;
     aCamp25   = "";

     nTipoInf  = 0;
     informe     = "";
     inform1     = "";
     inform2     = "";
     inform3     = "";

     nNumCampo1 = 0;
     nNumCampo2 = 0;

     &efFecha  = @;
     &efFecha1 = @;
     &efFecha2 = @;
     &eSwLinea = 0;
     &enAgente = 0;
     &eaAgent1 = "";
     &eaAgente = "";
     &enEmpPD  = 0;
     &eaEmpPD  = "";
     &eaEmpPD1 = "";
     &eaTfnPD  = "";
     &enTotal1 = 0;
     &enTotal2 = 0;
     &enTotal3 = 0;

     &enMes      = 0;
     &eaMes      = "";
     &eaTitul    = "";
     &eaTitulo   = "";
     &eaTitul1   = "";
     &eaTitul2   = "";
     &eaTitul3   = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpresa  = 0;
|FIN;

|CALCULO DMes; |TIPO 0;
    enMes = #dsay0022#1;
    |SI enMes = 1;  #dsay0022#2 = "Enero     "; |FINSI;
    |SI enMes = 2;  #dsay0022#2 = "Febrero   "; |FINSI;
    |SI enMes = 3;  #dsay0022#2 = "Marzo     "; |FINSI;
    |SI enMes = 4;  #dsay0022#2 = "Abril     "; |FINSI;
    |SI enMes = 5;  #dsay0022#2 = "Mayo      "; |FINSI;
    |SI enMes = 6;  #dsay0022#2 = "Junio     "; |FINSI;
    |SI enMes = 7;  #dsay0022#2 = "Julio     "; |FINSI;
    |SI enMes = 8;  #dsay0022#2 = "Agosto    "; |FINSI;
    |SI enMes = 9;  #dsay0022#2 = "Septiembre"; |FINSI;
    |SI enMes = 10; #dsay0022#2 = "Octubre   "; |FINSI;
    |SI enMes = 11; #dsay0022#2 = "Noviembre "; |FINSI;
    |SI enMes = 12; #dsay0022#2 = "Diciembre "; |FINSI;
    |PINTA #dsay0022#2;
    eaMes = #dsay0022#2;
|FCAL;

|CALCULO HEmpresa; |TIPO 0;
    |SI #dsay0022#4 < #dsay0022#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsay0022#6 < #dsay0022#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsay0022#8 < #dsay0022#7;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO Tipo7C10; |TIPO 7;
    aAlfa = "0000Ordenar por: (A)gente, (C)odigo Cliente, (N)ombre Cliente, (E)mpresa P.Riesgos";
    |SI nTipoInf = 1;
        aAlfa = "0000Ordenar por: (A) Agente, (C) Codigo Cliente, (N) Nombre Cliente";
    |FINSI;
    |MENSA aAlfa;
|FCAL;

|CALCULO Tipo0C10; |TIPO 0;
    |SI nTipoInf = 1; |Y #dsay0022#10 = "E";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO Tipo0C13; |TIPO 0;
    |C_V #dsay0022#13,0,aAlfa;
    |SI aAlfa = "N"; |ACABA; |FINSI;

    |SI #dsay0022#13 = "V";
        aAlfa   = "Vencimiento";
        aAlfa1  = "Informe Clientes Obligados Con Vencimiento en el Mes/Ejercicio";
        eaTitul = "Con Vencimiento en el Mes/Ejercicio";
    |SINO;
        aAlfa   = "Preaviso ..";
        aAlfa1  = "Informe Clientes Obligados Con Preaviso en el Mes/Ejercicio";
        eaTitul = "Con Preaviso en el Mes/Ejercicio";
    |FINSI;
    |ATRI P; |PINTA 1334, aAlfa; |ATRI 0;
    aAlfa1 = aAlfa1 > " ";
    #dsay0022#12 = aAlfa1;
    |PINTA #dsay0022#12;
|FCAL;
|| *******************************************************************
|PROCESO Imprimir;

   |SI nHay = 0;
       enAgente = #dsat0002#15;
       eaAgente = #dsat0002#16;
       eaAgent1 = ("00" + #dsat0002#15) % -102;
       enEmpPD  = #dsat0002#3;
       eaEmpPD  = #dsat0002#4;
       eaEmpPD1 = ("000" + #dsat0002#3) % -103;
       eaTfnPD  = #dsat0002#25;
       eSwLinea = 0;
   |FINSI;

   |SI #dsay0022#10 = "A";
       |SI enAgente ! #dsat0002#15;
           |SI nHay = 1;
               eSwLinea = 2;
               |SI nTipoInf > 3; |PRINT; |FINSI;
           |FINSI;

           enAgente = #dsat0002#15;
           eaAgente = #dsat0002#16;
           eaAgent1 = ("00" + #dsat0002#15) % -102;
           enEmpPD  = #dsat0002#3;
           eaEmpPD  = #dsat0002#4;
           eaEmpPD1 = ("000" + #dsat0002#3) % -103;
           eaTfnPD  = #dsat0002#25;
           eSwLinea = 0;
           enTotal1  = 0;
           enTotal2  = 0;
           enTotal3  = 0;
       |FINSI;
   |FINSI;
   |SI #dsay0022#10 = "E";
       |SI enEmpPD ! #dsat0002#3;
           |SI nHay = 1;
               eSwLinea = 2;
           |FINSI;
           enEmpPD  = #dsat0002#3;
           eaEmpPD  = #dsat0002#4;
           eaEmpPD1 = ("000" + #dsat0002#3) % -103;
           eaTfnPD  = #dsat0002#25;
           eSwLinea  = 0;
           enTotal1  = 0;
           enTotal2  = 0;
           enTotal3  = 0;
       |FINSI;
   |FINSI;

   |SI nTipoInf = 3;
      efFecha1 = #dsat0002#nNumCampo1#;
      efFecha2 = #dsat0002#nNumCampo2#;
   |FINSI;

   |PRINT;
   eSwLinea = 1;
   nHay     = 1;
   enTotal1 = enTotal1 + #dsat0002#11;
   enTotal2 = enTotal2 + #dsat0002#19;
   enTotal3 = enTotal3 + #dsat0002#20;
|FPRC;

|DEFBUCLE LeeDsat0002_E;
   #dsat0002#2;
   ;
   #dsay0022#3, nDEmpresa, enEjer, nDMes;
   #dsay0022#4, nHEmpresa, enEjer, nHMes;
   ;
   NULL, Imprimir;
|FIN;

|DEFBUCLE LeeDsat0002_A;
   #dsat0002#3;
   ;
   #dsay0022#7, nDEmpresa, enEjer, nDMes;
   #dsay0022#8, nHEmpresa, enEjer, nHMes;
   ;
   NULL, Imprimir;
|FIN;

|DEFBUCLE LeeDsat0002_C;
   #dsat0002#4;
   ;
   nDEmpresa, enEjer, nDMes;
   nHEmpresa, enEjer, nHMes;
   ;
   NULL, Imprimir;
|FIN;

|DEFBUCLE LeeDsat0002_N;
   #dsat0002#5;
   ;
   aBlancos, nDEmpresa, enEjer, nDMes;
   aZetas,   nHEmpresa, enEjer, nHMes;
   ;
   NULL, Imprimir;
|FIN;

|PROCESO ImprimirDatos;
    aBlancos = " " * 40;
    aZetas   = "z" * 40;

    informe = inform1;
    |SI #dsay0022#10 = "A"; informe = inform2; |FINSI;
    |SI #dsay0022#10 = "E"; informe = inform3; |FINSI;

    |IMPRE 0;
    |SI FSalida ! 0;
        |MENAV "0000Proceso Interrumpido";
        |ACABA;
    |FINSI;
    |INFOR informe;
    |SI FSalida ! 0;
        |MENAV "0000No existe informe. Proceso Interrumpido";
        |FINIMP;
        |ACABA;
    |FINSI;

    nHay     = 0;
    enAgente = 0;
    eaAgente = "";
    eaAgent1 = "";
    enEmpPD  = 0;
    eaEmpPD  = "";
    eaEmpPD1 = "";
    eaTfnPD  = "";
    enTotal1 = 0;
    enTotal2 = 0;
    enTotal3 = 0;

    |SI #dsay0022#10 = "A";  |BUCLE LeeDsat0002_A; |FINSI;
    |SI #dsay0022#10 = "E";  |BUCLE LeeDsat0002_E; |FINSI;
    |SI #dsay0022#10 = "C";  |BUCLE LeeDsat0002_C; |FINSI;
    |SI #dsay0022#10 = "N";  |BUCLE LeeDsat0002_N; |FINSI;

    |SI nHay ! 0;
        eSwLinea = 2;
        |SI #dsay0022#10 ! "C";  |Y #dsay0022#10 ! "N";
            |SI nTipoInf > 3; |PRINT; |FINSI;
        |FINSI;
        |PIEINF;
    |FINSI;
    |FININF;
    |FINIMP;
|FPRC;

|| *******************************************************************
|PROCESO GrabaAuxiliar1;
    #dsat0002#0 = nEmpresa;
    #dsat0002#1 = enEjer;
    #dsat0002#2 = nCamp2;
    |LEE 141#dsat0002.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0002;
        #dsat0002#0 = nEmpresa;
        #dsat0002#1 = enEjer;
        #dsat0002#2 = nCamp2;
        |GRABA 020#dsat0002.b;
    |FINSI;
    #dsat0002#3  = nCamp3;
    #dsat0002#4  = aCamp4;
    #dsat0002#5  = fCamp5;
    #dsat0002#6  = fCamp6;
    #dsat0002#7  = fCamp7;
    #dsat0002#8  = nCamp8;
    #dsat0002#9  = nCamp9;
    #dsat0002#10 = nCamp10;
    #dsat0002#11 = nCamp11;
    #dsat0002#12 = nCamp12;
    #dsat0002#13 = nCamp13;
    #dsat0002#14 = #dsam0000#1;
    #dsat0002#15 = #dsam0000#72;
    #dsat0002#16 = #dsam0000#52;
    #dsat0002#17 = aCamp17;
    #dsat0002#18 = fCamp18;
    #dsat0002#19 = nCamp19;
    #dsat0002#20 = nCamp20;
    #dsat0002#21 = aCamp21;
    #dsat0002#22 = nCamp22;
    #dsat0002#23 = nCamp23;
    #dsat0002#24 = #dsam0000#54;
    #dsat0002#25 = aCamp25;
    #dsat0002#26 = #dsam0000#3;

    |GRABA 020#dsat0002.a;
    |LIBERA #dsat0002;
    nAlgun = 1;
|FPRC;
|| *******************************************************************
|PROCESO BorraVariables;
     nCamp2  = 1;
     nCamp3  = 0;            aCamp4  = "";
     fCamp5  = "01.01.0000"; fCamp6  = "01.01.0000";
     fCamp7  = "01.01.0000"; nCamp8  = 0;
     nCamp9  = 0;            nCamp10 = 0;
     nCamp11 = 0;            nCamp12 = 0;
     nCamp13 = 0;            aCamp17 = "";
     fCamp18 = "01.01.0000"; nCamp19 = 0;
     nCamp20 = 0;            aCamp21 = "";
     nCamp22 = 0;            nCamp23 = 0;
     aCamp25 = "";
|FPRC;

|PROCESO LeeDatosM024;
    |SI nTipoInf = 1;
        nHay = 1;
        |ERROR10;
        |ACABA;
    |FINSI;

    nGraba    = 0;
    aColabora = "N";
    |DDEFECTO #dsam0110;
    #dsam0110#0 = #dsam0024#3;
    |LEE 041#dsam0110.=;
    |SI FSalida = 0;
        aColabora = #dsam0110#3;
        aCamp25   = #dsam0110#5;
    |FINSI;

    |SI nTipoInf = 2;
        |SI #dsam0024#3 ] #dsay0022#3; |Y #dsam0024#3 [ #dsay0022#4;
            |SI #dsam0024#10 = 0;
                nGraba = 1;
                |SI #dsay0022#11 ! "T"; |Y #dsay0022#11 ! aColabora;
                    nGraba = 0;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;

    |SI nTipoInf = 3;
        |SI #dsam0024#3 ] #dsay0022#3; |Y #dsam0024#3 [ #dsay0022#4;
            |SI #dsam0024#nNumCampo1# > "01.01.0000";
                aAlfa = #dsam0024#nNumCampo1#; aAlfa = aAlfa % 402;  nMes  = aAlfa;
                aAlfa = #dsam0024#nNumCampo1#; aAlfa = aAlfa % -104; nEjer = aAlfa;

                |SI nMes = enMes; |Y nEjer = enEjer;
                    nGraba = 1;
                    |SI #dsay0022#11 ! "T"; |Y #dsay0022#11 ! aColabora;
                        nGraba = 0;
                    |FINSI;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;

    |SI nTipoInf = 4;
        |SI #dsam0024#3 ] #dsay0022#3; |Y #dsam0024#3 [ #dsay0022#4;
            nGraba = 1;
            |SI #dsay0022#9 ! "T";  |Y #dsay0022#9 ! #dsam0024#13;
                nGraba = 0;
            |FINSI;
            |SI #dsay0022#11 ! "T"; |Y #dsay0022#11 ! aColabora;
                nGraba = 0;
            |FINSI;
        |FINSI;
    |FINSI;

     |SI nGraba = 1;
         nCamp2  = #dsam0024#2;
         nCamp3  = #dsam0024#3;
         aCamp4  = #dsam0024#4;
         fCamp5  = #dsam0024#5;
         fCamp6  = #dsam0024#6;
         fCamp7  = #dsam0024#7;
         nCamp8  = #dsam0024#8;
         nCamp9  = "01.01.0000";
         nCamp10 = #dsam0024#9;
         nCamp11 = #dsam0024#10;
         nCamp12 = #dsam0024#11;
         nCamp13 = #dsam0024#12;

         aCamp17 = #dsam0024#13;
         fCamp18 = #dsam0024#14;
         nCamp19 = #dsam0024#15;
         nCamp20 = #dsam0024#16;
         aCamp21 = #dsam0024#17;
         nCamp22 = #dsam0024#18;
         nCamp23 = #dsam0024#19;
         |HAZ GrabaAuxiliar1;
    |FINSI;
|FPRC;

|DEFBUCLE dsam0024;
   #dsam0024#1;
   13;
   nEmpresa, enEjer, nDMes, aDLiqu;
   nEmpresa, enEjer, nHMes, aHLiqu;
   e;
   NULL, LeeDatosM024;
|FIN;

|PROCESO LeoDsam0000;
   |HAZ BorraVariables;

   nHay     = 0;
   nEmpresa = #dsam0000#0;

   |BUCLE dsam0024;
   |SI nTipoInf = 1; |Y nHay = 0;
       |HAZ GrabaAuxiliar1;
   |FINSI;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   122,72;
   nDEmpresa, "S", nDAgente;
   nHEmpresa, "S", nHAgente;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO ProcesoY022;

     aFichero = ("4b" + Usuario) % 108;
     |NOME_DAT #dsat0002#aFichero#;
     |DELINDEX #dsat0002;

     aAlfa1 = #dsay0022#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     eaTitulo = #dsay0022#12;
     efFecha  = #dsay0022#14;
     enEjer = #dsay0022#0;
     aDLiqu = #dsay0022#9;
     aHLiqu = #dsay0022#9;
     |SI #dsay0022#9 = "T";
         aDLiqu = " ";
         aHLiqu = "z";
     |FINSI;

     nDEmpresa = #dsay0022#5;
     nHEmpresa = #dsay0022#6;
     nDAgente  = #dsay0022#7;
     nHAgente  = #dsay0022#8;
     nDMes     = 01;
     nHMes     = 12;
     enMes     = #dsay0022#1;
     eaMes     = #dsay0022#2;

     |SI nTipoInf = 3;
         eaTitul3   = "Vencimiento   Preaviso ";
         nNumCampo1 = 6;
         nNumCampo2 = 7;
         |SI #dsay0022#13 = "P";
             nNumCampo1 = 7;
             nNumCampo2 = 6;
             eaTitul3   = " Preaviso  Vencimiento";
         |FINSI;
     |FINSI;

     |ABRE #dsat0002;
     nAlgun = 0;
     nGraba = 0;
     |ABRE #dsam0110;
     |BUCLE dsam0000;
     |CIERRA #dsam0110;
     |CIERRA #dsat0002;

     |SI nAlgun = 1;
/*
        |ABRE #dsat0002;
        |CONSULTA_CLAVE #1#dsat0002;
        |CIERRA  #dsat0002;
*/
         |HAZ ImprimirDatos;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsat0002;
|FPRC;

|PROGRAMA;

    aFuncion = "B";
    aParam   = PARAMETRO;
    nTipoInf = aParam; |SI nTipoInf = 0; nTipoInf = 4; |FINSI;
    |SI nTipoInf = 1;
        aAlfa1  = "Informe Clientes Obligados Sin Empresa Prevencion de Riesgos asignada ";
        eaTitul = "Sin Empresa de Prevencion de Riesgos asignada ";
        |C_V #dsay0022#3,  1, "N";
        |C_V #dsay0022#4,  1, "N";
        |C_V #dsay0022#11, 1, "N";
        inform1 = "dsay1021";
        inform2 = "dsay1a21";
        inform3 = "";
    |FINSI;
    |SI nTipoInf = 2;
        aAlfa1  = "Informe Clientes Obligados Sin Importe pagado en el Ejercicio ";
        eaTitul = "Sin Importe pagado en el Ejercicio ";
        inform1 = "dsay2021";
        inform2 = "dsay2a21";
        inform3 = "dsay2b21";
    |FINSI;
    |SI nTipoInf = 3;
        aAlfa1  = "Informe Clientes Obligados Con Vto/Preaviso en el Mes/Ejercicio";
        eaTitul = "Con Vencimiento/Preaviso en el Mes/Ejercicio";
        |C_V #dsay0022#1, 1, "S";
        |C_V #dsay0022#2, 1, "S";
        |C_V #dsay0022#13, 1, "S";
        inform1 = "dsay3022";
        inform2 = "dsay3a22";
        inform3 = "dsay3b22";
    |FINSI;
    |SI nTipoInf = 4;
        aAlfa1  = "Informe General de Clientes en Prevencion de Riesgos Laborales";
        eaTitul = "Informe General ";
        |C_V #dsay0022#9, 1, "S";
        inform1 = "dsay4022";
        inform2 = "dsay4a22";
        inform3 = "dsay4b22";
    |FINSI;
    aAlfa1 = aAlfa1 > " ";
    eaTitul1 = "Prevencion Riesgos Laborales";

    |CLS;
    |CABEZA "Inf. Prevencion Riesgos Laborales";

    #dsay0022#12 = aAlfa1;
    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsay0022#0 = aAlfa;

    |SI nTipoInf = 3;
        aAlfa  = fFecha;
        aAlfa  = aAlfa % 402;
        #dsay0022#1 = aAlfa;
    |FINSI;
    |HAZ DMes;

    |PINPA #0#dsay0022;
    |ATRI R; |PINTA 0714, eaTitul; |ATRI 0;
    |SI nTipoInf = 3; |O nTipoInf = 4;
        |ATRI P;
        |SI nTipoInf = 3; |PINTA 1316, "Fecha V/P:    Mes Vencimiento: "; |FINSI;
        |SI nTipoInf = 4; |PINTA 1316, "Liquidados (S/N/T):"; |FINSI;
        |ATRI 0;
    |FINSI;
    |SI nTipoInf = 1;
        |PINTA 1714, "À"; |PINTA 1767, "Ù";
        |BLANCO 1810 2170;
    |FINSI;

    |PINDA #0#dsay0022;

    |ENDATOS #2#dsay0022;
    |SI FSalida = 0;
        |HAZ ProcesoY022;
    |FINSI;
|FPRO;
