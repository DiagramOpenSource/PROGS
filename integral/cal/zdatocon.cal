|FICHEROS;
   :/contagen/def/canempre #330;  || Empresas
   :/modelos/def/dsmom100 #1100;
|FIN;

|VARIABLES;

    aPath  = "";
    {-1}punt1 = 0;

    aAlfa1 = "";
    aAlfa2 = "";
    aAlfa3 = "";
    aAlfa4 = "";
    nNume1 = 0;
    nNume2 = 0;

    p_lugar = 0;
    p_cuan3 = 0;
    p_cuan4 = 0;
    p_cuan5 = 0;
    p_alfa1 = "";
    p_alfa2 = "";
    p_alfa3 = "";
    p_alfa4 = "";
    p_alfa5 = "";
    p_alfa6 = "";
    p_guarda = "";
    p_nume1 = 0;
    p_nume2 = 0;
    p_ceros = "";
    p_error = 0;
    p_mensa1 = "0000LONGITUD DE CUENTA FUERA DE NIVEL!";
    desdec1 = "";
    hastac1 = "";
    varia_cod = "";
    sw_nom = 0;
    cuen11 = "";
    cuen21 = "";
    cuen31 = "";
    num_campo = 0;
    p_nifs = "";

    aLong       = "";
    aPunto      = "";
    aGuarda     = "";
    nCampo = 0;
    nLong  = 0;
    nPos   = 0;
    aLetra = "";
|FIN;

|INCLUYE i_varcon;

|PROCESO LeeEmpContaI;
   fec3 = "01.01.0000";
   swerror = 0;
   cod_emp1 = enEmpresa;  cod_emp1 = "00000" + cod_emp1;
   cod_emp2 = enPerConta; cod_emp2 = "0" + cod_emp2;
   clave1 = cod_emp1 % -105;
   clave2 = cod_emp2 % -101;

   |DBASS aPath; |QBT aPath;
   aPathConta    = aPath + "contagen/fich/" + clave1 + clave2 + "/";
   aPathPanConta = aPath + "contagen/pan/";

   cod1 = clave1;   empre = cod1;
   cod2 = clave2;   ejerc = cod2;

   |ABRE #canempre;
   #canempre#2 = cod1;
   #canempre#3 = cod2;
   |LEE 000#canempre.=;
   |SI FSalida ! 0;
       swerror = 1;
       |SI enSwSinMen = 0; |MENAV "    NO EXISTE EMPRESA CONTABLE "; |FINSI;
       |CIERRA #canempre;
       |ACABA;
   |FINSI;
   dig1 = #canempre#11;       || desde mes
   dig3 = #canempre#13;       || nro. niveles
   dig4 = #canempre#14;       || 1 nivel
   dig5 = #canempre#15;       || 2 nivel
   dig6 = #canempre#16;       || 3 nivel
   dig7 = #canempre#17;       || 4 nivel
   dig8 = #canempre#18;       || 5 nivel
   dig9 = #canempre#19;       || 6 nivel
   eaMonedaCon = #canempre#28; ||Moneda
   eaNombreEmp = #canempre#1;  ||Nombre Empresa
   eaEstadoEmp = "S";
   |SI #canempre#21 = "I"; eaEstadoEmp = "N"; |FINSI;
   |CIERRA #canempre;

   cod2 = #canempre#26;
   tra1 = 100 + cod2;
   clave2 = tra1 % -102;
   tra1 = 100 + #canempre#11;
   mes1 = tra1 % -102;
   |SI cod2 < 80;
      work1 = "01." + mes1 + ".20" + clave2;
      enEjer = 2000 + cod2;
   |SINO;
      work1 = "01." + mes1 + ".19" + clave2;
      enEjer = 1900 + cod2;
   |FINSI;
   fec1 = work1;
   tra1 = 100 + #canempre#12;
   mes1 = tra1 % -102;
   |SI #canempre#11 > #canempre#12;
      cod2 = cod2 + 1;
      |SI cod2 > 99; cod2 = cod2 - 100;    |FINSI;
   |FINSI;
   dia1 = "31";
   |SI #canempre#12 = 4; |O #canempre#12 = 6; |O #canempre#12 = 9; |O #canempre#12 = 11;
      dia1 = "30";
   |FINSI;
   |SI #canempre#12 = 2;
      dia1 = "28";
      |SI cod2 = 88; |O cod2 = 92; |O cod2 = 96; |O cod2 = 0; |O cod2 = 4;
         dia1 = "29";
      |FINSI;
   |FINSI;
   tra1 = 100 + cod2;
   clave2 = tra1 % -102;
   |SI cod2 < 80;
      work1 = dia1 + "." + mes1 + ".20" + clave2;
   |SINO;
      work1 = dia1 + "." + mes1 + ".19" + clave2;
   |FINSI;
   fec2 = work1;
   fec3 = #canempre#34;

   eaDepar  = #canempre#24;
   eaSubde  = #canempre#22;
   eaDfDepC = #canempre#30;
   eaDfSubC = #canempre#31;
   eaDfDepN = #canempre#32;
   eaDfSubN = #canempre#33;

  || Recoger informacion sobre los niveles ...
  Ipunt1 = dig3<-;
  Ipunt1 = Ipunt1 + dig3;
  MaximoDigitos = punt1;
  DigitosPaseDirecto = dig3;

|FPRC;

|PROCESO SituaMaestraI;
  fec3 = "01.01.0000";
  |ABRE #1100;
  |LEE 040#1100p;
  |SI FSalida ! 0;  |DDEFECTO #1100;  |FINSI;
  |CIERRA #1100;

  swerror = 0;
  aAlfa1 = #1100#1; aAlfa1 = ("00000" + aAlfa1) % -105;
  aAlfa2 = #1100#2; aAlfa2 = ("0"     + aAlfa2) % -101;

  |DBASS aPath; |QBT aPath;
  aPathConta    = aPath + "contagen/fich/" + aAlfa1 + aAlfa2 + "/";
  aPathPanConta = aPath + "contagen/pan/";

  |ABRE #canempre;
  #canempre#2 = #1100#1;
  #canempre#3 = #1100#2;
  |LEE 000#canempre.=;
  |SI FSalida ! 0;
      swerror = 1;
      |SI enSwSinMen = 0; |MENAV "    NO EXISTE LA EMPRESA MAESTRA DE CONTABILIDAD"; |FINSI;
      |CIERRA #canempre;
      |ACABA;
  |FINSI;
   dig1 = #canempre#11;       || desde mes
   dig3 = #canempre#13;       || nro. niveles
   dig4 = #canempre#14;       || 1 nivel
   dig5 = #canempre#15;       || 2 nivel
   dig6 = #canempre#16;       || 3 nivel
   dig7 = #canempre#17;       || 4 nivel
   dig8 = #canempre#18;       || 5 nivel
   dig9 = #canempre#19;       || 6 nivel
   eaMonedaCon = #canempre#28; ||Moneda
   |CIERRA #canempre;

  || Recoger informacion sobre los niveles ...
  Ipunt1 = dig3<-;
  Ipunt1 = Ipunt1 + dig3;
  MaximoDigitos = punt1;
  DigitosPaseDirecto = dig3;
|FPRC;

|PROCESO SacaNivelI;
   eswCta = 1;     ||Errores en Cuenta
   aLong = eaCtaCon;
   |QBF aLong;
   aLong = aLong % 0;
   nLong = aLong;
   enNivel = 0;
   |SI nLong = dig4; |Y dig4 ! 0; eswCta = 0; enNivel = 1; |FINSI;
   |SI nLong = dig5; |Y dig5 ! 0; eswCta = 0; enNivel = 2; |FINSI;
   |SI nLong = dig6; |Y dig6 ! 0; eswCta = 0; enNivel = 3; |FINSI;
   |SI nLong = dig7; |Y dig7 ! 0; eswCta = 0; enNivel = 4; |FINSI;
   |SI nLong = dig8; |Y dig8 ! 0; eswCta = 0; enNivel = 5; |FINSI;
   |SI nLong = dig9; |Y dig9 ! 0; eswCta = 0; enNivel = 6; |FINSI;

   |SI eswCta = 1; |Y  nLong ! 0;
       |SI emCta = 1;
           |MENAV p_mensa1;
           |ERROR;
       |FINSI;
   |FINSI;
|FPRC;

|PROCESO FiltraPuntoI; |TIPO 6;
     aGuarda = FSalida;
     |SI eaCtaCon = "            "; |ACABA; |FINSI;

     enSwSinMen = 1;
     || |HAZ LeeEmpContaI;
     || |SI swerror = 1;
         |HAZ SituaMaestraI;
     || |FINSI;

     aPunto = eaCtaCon - ".";
     |SI FSalida ! 0;
         |HAZ PorPuntos;
     |FINSI;

     FSalida = aGuarda;
|FPRC;

|PROCESO PorPuntos;
     nNume1 = FSalida;
     nPos   = 100 + (((nNume1 / 100) ! 0) -1);
     aAlfa2 = eaCtaCon % nPos;   |QBF aAlfa2;
     nPos   = (((nNume1 / 100) ! 0) * 100) + 199;
     aAlfa3 = eaCtaCon % nPos;   |QBF aAlfa3;

     FSalida = nNume1;
     |PARA; |SI FSalida ! 0; |HACIENDO;
           aAlfa3 = aAlfa3 - "."; || limpiar mas puntos (los ignoramos)
     |SIGUE;

     nPos   = MaximoDigitos - ( (A \ aAlfa2 % 0) + (A \ aAlfa3 % 0));
     aAlfa4 = (A\ "0" * nPos);

     aLetra = (aAlfa3 % 101) > " ";
     |SI aLetra = "U";  |O aLetra = "A"; |O aLetra = "B";
         |ERROR;
     |SINO;
         eaCtaCon  = (A\ aAlfa2 + aAlfa4 + aAlfa3);
     |FINSI;
|FPRC;
