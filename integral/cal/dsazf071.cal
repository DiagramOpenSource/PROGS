|FICHEROS;
     dsazf071;

     dsatf101,MANTE;
     dsam0026,MANTE;

     dsam9998;
     :integral/dsam0000;
|FIN;

|VARIABLES;
     nBotonMen1   = 0;
     nBotonMen2   = 0;
     nBotonMen3   = 0;
     nBotonMen4   = 0;
     nBotonMen5   = 0;
     nBotonMen6   = 0;
     nBotonMen7   = 0;
     nBotonMen8   = 0;
     nBotonMen9   = 0;
     nBotonMen10  = 0;
     nBotonMen11  = 0;
     nBotonMen12  = 0;

     aEsc         = "";
     aF2          = "";
     aF3          = "";
     aF4          = "";
     aF5          = "";
     aF6          = "";
     aF7          = "";
     aF8          = "";
     aF9          = "";
     aF10         = "";
     aF11         = "";

     nOkGes = 0;
     nOkSeg = 0;
     nOkCol = 0;

     aMenuF7_1  = "LBOTON,A.- Transportes";
     aMenuF7_2  = "LBOTON,B.- Trafico";
     aMenuF7_3  = "LBOTON,C.- Agricultura";
     aMenuF7_4  = "LBOTON,D.- Gasoleo Profesional";
     aMenuF7_5  = "LBOTON,E.- Salir";
     aLen         = "";
     aCaracter    = "";
     nLen         = 0;
     nPos         = 0;
     nOpcion      = 0;
     aAlfa        = "";
     nCampo       = 0;
     aTecla       = "";
     aCadena      = "";
     aFichero     = "";

     aTitul       = "";
     nAlgun       = 0;
     nTecla       = 0;
     nGraba       = 0;
     aParam       = "";
     nCamFun      = 0;

     &enCamF7    = 0;
     &enEjer     = 0;
     &enEmpresa  = 0;
     &enDCliente = 0;
     &enHCliente = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &eaDNif     = "";
     &eaHNif     = "";

     &enModo     = 0;
     &enAlguno   = 0;
|FIN;

|CALCULO Tipo7; |TIPO 7;
     aParam = PARAMETRO; |QBF aParam;

     aAlfa = "Consulta Gestoria";

     |ATRI R;
     |PINTA 0503, aAlfa;
     |ATRI 0;

|FCAL;

|PROCESO QuitaRaros;
     |QBF aAlfa;
     aCadena = "";
     aLen    = aAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;
|FPRC;

|PROCESO PintaTitulo;
     |ATRI I;  |PINTA 0934, aTitul;  |ATRI i;
|FPRC;

|| Opcion F7 -----------------------------------------------------
|PROCESO ApareceOpcionF7;
     |POPV;
     |ESTADO_CONTROL nBotonMen1,  "SHOW";
     |ESTADO_CONTROL nBotonMen2,  "SHOW";
     |ESTADO_CONTROL nBotonMen3,  "SHOW";
     |ESTADO_CONTROL nBotonMen4,  "SHOW";
     |ESTADO_CONTROL nBotonMen5,  "SHOW";
|FPRC;

|PROCESO DesapareceOpcionF7;
     |PUSHV 0501 2380;
     |BLANCO 0701 2380;
     |ESTADO_CONTROL nBotonMen1,  "HIDE";
     |ESTADO_CONTROL nBotonMen2,  "HIDE";
     |ESTADO_CONTROL nBotonMen3,  "HIDE";
     |ESTADO_CONTROL nBotonMen4,  "HIDE";
     |ESTADO_CONTROL nBotonMen5,  "HIDE";
|FPRC;

|PROCESO FinOpcionF7;
     |FIN_CONTROL_WINDOWS nBotonMen1;
     |FIN_CONTROL_WINDOWS nBotonMen2;
     |FIN_CONTROL_WINDOWS nBotonMen3;
     |FIN_CONTROL_WINDOWS nBotonMen4;
     |FIN_CONTROL_WINDOWS nBotonMen5;

     |PULSATECLA;
|FPRC;

|| --------------------------------------------------------------------
|PROCESO MiraSiHay;
     enAlguno = 0;
     |SI nCamFun = 1;
        |ABRE #dsam0026;
        #dsam0026#0 = #dsam0000#0;
        #dsam0026#1 = "          ";
        |LEE 041#dsam0026.];
        |SI FSalida = 0; |Y #dsam0026#0 = #dsam0000#0;
            enAlguno = 1;
        |FINSI;
        |CIERRA #dsam0026;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja026;
     #dsam0026#0 = #dsam0000#0;
     #dsam0026#1 = "          ";
     #dsam0026#8 = "A";
|FRUT;

|RUTINA ClaveAlta026;
     #dsam0026#0 = #dsam0000#0;
     #dsam0026#1 = "zzzzzzzzzz";
     #dsam0026#8 = "A";
|FRUT;

|PROCESO TrataTransportes;
     enModo = 2;
     |HAZ LeeCliente;

     |PUSHV 0501 0880;
     |BLANCO 0501 0880;
     |PINTA 0502, #dsam0000#0;
     |PINTA 0509, #dsam0000#3;
     |PINTA 0522, #dsam0000#1;
     |PINTA 0563, #dsam0000#54;
     |ATRI I;  |PINTA 0702, aTitul;  |ATRI i;

     |PINPA #0#dsam0026;
     |SI enModo = 4;
         |ENTLINEAL #2#dsam0026, -3, enModo, 22, 1, ClaveBaja026, ClaveAlta026;
     |SINO;
         |ENTLINEAL #1#dsam0026, -2, enModo, 22, 1, ClaveBaja026, ClaveAlta026;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO PrintTransportes;

     |PUSHV 1110 1460;
     |BLANCO 1110 1460;
     |CUADRO 1110 1460;
     |ATRI R; |PINTA 1212," LISTADO DE TRANSPORTES DEL CLIENTE              "; |ATRI 0;

     |PINTA 1312, "Estado Transportes (A-Alta/B-Baja/T-Todos):   ";

      E_inf = "ABTabt";
      E_sup = "1";

      aAlfa = "T";
      aAlfa = 1356 ? 1; |SI FSalida = 7; |POPV; |ACABA; |FINSI;
      aAlfa = aAlfa > ""; |PINTA 1356, aAlfa;

      |POPV;

      aAlfa = "dsay0024;" + aAlfa
      |SUB_EJECUTA_NP aAlfa;
      |PULSATECLA;
|FPRC;

|| /////////////////////////////////////////////////////////////////////
|PROCESO LeeCliente;
    |ABRE #dsam0000;
    |DDEFECTO #dsam0000;
    #dsam0000#0 = enEmpresa;
    |LEE 041#dsam0000.=;
    |CIERRA #dsam0000;
|FPRC;

|PROCESO Tipo7tf101; |TIPO 7;
     enEmpresa   = #dsatf101#0;
     |HAZ LeeCliente;
     |BLIN 4;

     |HAZ PintaTitulo;
     |PINPA #0#dsam0026;
     |ENTLINEAL #1#dsam0026, -2, 7, 22, 1, ClaveBaja026, ClaveAlta026;

     aAlfa= "0000Pulse <F2> para modificar datos, <F3> para obtener listado";
     |MENSA aAlfa;
|FPRC;

|PROCESO Tipo11tf101; |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         |LEE 141#dsatf101.=;

         enEmpresa   = #dsatf101#0;
         |SI nCamFun = 1;  |HAZ TrataTransportes;        |FINSI;

         |GRABA 020#dsatf101.a;
         |LIBERA #dsatf101;
     |FINSI;

     |SI nTecla = 11;
         |LEE 141#dsatf101.=;

         enEmpresa   = #dsatf101#0;
         |SI nCamFun = 1; |HAZ PrintTransportes; |FINSI;

         |LIBERA #dsatf101;

     |FINSI;
|FPRC;
|| /////////////////////////////////////////////////////////////////////

|PROCESO GrabaAuxiliar;
  #dsatf101#0 = #dsam0000#0;
  #dsatf101#1 = #dsam0000#1;
  #dsatf101#2 = #dsam0000#3;
  #dsatf101#3 = #dsam0000#54;
  #dsatf101#4 = #dsam0000#52;
  #dsatf101#5 = #dsam0000#72;
  #dsatf101#6 = nCamFun;
  #dsatf101#7 = nGraba;
  |GRABA 020#dsatf101.n;
  nAlgun = 1;
|FPRC;

|PROCESO LeoDsam0000;
   nGraba = 0;
   |HAZ MiraSiHay;
   |SI enAlguno = 1; nGraba = 1; |FINSI;
   |SI #dsazf071#6 = "T"; |Y nGraba = 0;
       nGraba = 2;
   |FINSI;

   |SI nGraba ! 0; |HAZ GrabaAuxiliar;  |FINSI;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   72,3;
   enDCliente, enDAgente, eaDNif;
   enHCliente, enHAgente, eaHNif;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO ClaveBajaf101;
   #dsatf101#0 = enDCliente;
|FPRC;

|PROCESO ClaveAltaf101;
   #dsatf101#0 = enHCliente;
|FPRC;

|PROCESO ConstruyeFichero;
     aFichero = ("1z" + Usuario) % 108;
     |NOME_DAT #dsatf101#aFichero#;
     |DELINDEX #dsatf101;

     aAlfa  = aAlfa % 0880;
     aTitul = (aAlfa + (" " * 79)) % 135;

     nCamFun = enCamF7;

     nAlgun = 0;
     |ABRE #dsatf101;
     |BUCLE dsam0000;
     |CIERRA #dsatf101;

     |SI nAlgun ! 0;
         |PINPA #0#dsatf101;
         |ENTLINEAL #1#dsatf101, -1, 4, 8, 0, ClaveBajaf101, ClaveAltaf101;
     |FINSI;
     |DELINDEX #dsatf101;
|FPRC;

|PROCESO MenuSalir;
     |PTEC 806;
|FPRC;

|| -------------------------- RUTINAS DE LA OPCION F7 -----------------------

|PROCESO MenuF7_1;
     |SI #dsam9998#2 = "X";
         |ACABA;
     |FINSI;

     |SI #dsam9998#2 = "N";
         |MENAV "0000La opcion no esta ACTIVA, consulte con su administrador";
         |ACABA;
     |FINSI;

     |HAZ DesapareceOpcionF7;

     aAlfa = aMenuF7_1;
     enCamF7 = 1; |HAZ ConstruyeFichero; enCamF7 = 0;

     |HAZ ApareceOpcionF7;
|FPRC;


|PROCESO MenuF7_2;
     |SI #dsam9998#3 = "X";
         |ACABA;
     |FINSI;

     |SI #dsam9998#3 = "N";
         |MENAV "0000La opcion no esta ACTIVA, consulte con su administrador";
         |ACABA;
     |FINSI;

     |HAZ DesapareceOpcionF7;

     |MENAV "0000En construccion";

     |HAZ ApareceOpcionF7;
|FPRC;

|PROCESO MenuF7_3;
     |SI #dsam9998#4 = "X";
         |ACABA;
     |FINSI;

     |SI #dsam9998#4 = "N";
         |MENAV "0000La opcion no esta ACTIVA, consulte con su administrador";
         |ACABA;
     |FINSI;

     |HAZ DesapareceOpcionF7;

     |MENAV "0000En construccion";

     |HAZ ApareceOpcionF7;
|FPRC;

|PROCESO MenuF7_4;
     |SI #dsam9998#5 = "X";
         |ACABA;
     |FINSI;

     |SI #dsam9998#5 = "N";
         |MENAV "0000La opcion no esta ACTIVA, consulte con su administrador";
         |ACABA;
     |FINSI;

     |HAZ DesapareceOpcionF7;

     |MENAV "0000En construccion";

     |HAZ ApareceOpcionF7;
|FPRC;


|PROCESO Tipo12; |TIPO 3;
     |SI FSalida = 1; |O FSalida = 7; |ACABA; |FINSI;

     enDCliente = #dsazf071#0;
     enHCliente = #dsazf071#1;
     enDAgente  = #dsazf071#2;
     enHAgente  = #dsazf071#3;
     eaDNif     = #dsazf071#4;
     eaHNif     = #dsazf071#5;

|| ...     |HAZ OpcionF7;
|| ...     |PROCESO OpcionF7;

     |SI nOkGes = 0;
         |MENAV "0000No Contratado colaboraciones";
         |ACABA;
     |FINSI;

     |ATRI N;

     |SI #dsam9998#2 ! "X";
         aAlfa = aMenuF7_1;  |HAZ QuitaRaros;  aMenuF7_1 = aAlfa;
         |CONTROL_SIMPLE 0, aMenuF7_1, 1110, 1173, MenuF7_1;
         nBotonMen1 = FSalida;
     |FINSI;

     |SI #dsam9998#3 ! "X";
         aAlfa = aMenuF7_2;  |HAZ QuitaRaros;  aMenuF7_2 = aAlfa;
         |CONTROL_SIMPLE 0, aMenuF7_2, 1210, 1273, MenuF7_2;
         nBotonMen2 = FSalida;
     |FINSI;

     |SI #dsam9998#4 ! "X";
         aAlfa = aMenuF7_3;  |HAZ QuitaRaros;  aMenuF7_3 = aAlfa;
         |CONTROL_SIMPLE 0, aMenuF7_3, 1310, 1373, MenuF7_3;
         nBotonMen3 = FSalida;
     |FINSI;

     |SI #dsam9998#5 ! "X";
         aAlfa = aMenuF7_4;  |HAZ QuitaRaros;  aMenuF7_4 = aAlfa;
         |CONTROL_SIMPLE 0, aMenuF7_4, 1410, 1473, MenuF7_4;
         nBotonMen4 = FSalida;
     |FINSI;

     aAlfa = aMenuF7_5;  |HAZ QuitaRaros;  aMenuF7_5 = aAlfa;
     |CONTROL_SIMPLE 0, aMenuF7_5, 1510, 1573, MenuSalir;
     nBotonMen5 = FSalida;

     aF2    = &255 + "824";
     aF3    = &255 + "825";
     aF4    = &255 + "826";
     aF5    = &255 + "827";
     aF6    = &255 + "828";
     aF7    = &255 + "829";
     aF8    = &255 + "830";
     aF9    = &255 + "831";
     aF10   = &255 + "832";
     aEsc   = &255 + "806";

     |PARA; |SI;  |HACIENDO;
         |LEETECLA aTecla;
         |SI aTecla = aEsc; |SAL;  |FINSI;
         |SI aTecla = aF2;  nOpcion = 1;  |SAL;  |FINSI;
         |SI aTecla = aF3;  nOpcion = 2;  |SAL;  |FINSI;
         |SI aTecla = aF4;  nOpcion = 3;  |SAL;  |FINSI;
         |SI aTecla = aF5;  nOpcion = 4;  |SAL;  |FINSI;
         |SI aTecla = aF6;  nOpcion = 5;  |SAL;  |FINSI;
         |SI aTecla = aF7;  nOpcion = 6;  |SAL;  |FINSI;
         |SI aTecla = aF8;  nOpcion = 7;  |SAL;  |FINSI;
         |SI aTecla = aF9;  nOpcion = 8;  |SAL;  |FINSI;
         |SI aTecla = aF10; nOpcion = 9;  |SAL;  |FINSI;

         aTecla = aTecla > aTecla;
         |SI aTecla = "A";  |HAZ MenuF7_1;       |FINSI;
         |SI aTecla = "B";  |HAZ MenuF7_2;       |FINSI;
         |SI aTecla = "C";  |HAZ MenuF7_3;       |FINSI;
         |SI aTecla = "D";  |HAZ MenuF7_4;       |FINSI;
         |SI aTecla = "E";  |SAL;                |FINSI;
     |SIGUE;
     |HAZ FinOpcionF7;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
     |ABRE #dsam9998;
     |LEE 000#dsam9998.p;
     |SI FSalida ! 0;  |DDEFECTO #dsam9998;  |FINSI;
     |CIERRA #dsam9998;

     nOkGes = 0;
     |SI #dsam9998#2  ! "X";  nOkGes = 1;  |FINSI;
     |SI #dsam9998#3  ! "X";  nOkGes = 1;  |FINSI;
     |SI #dsam9998#4  ! "X";  nOkGes = 1;  |FINSI;
     |SI #dsam9998#5  ! "X";  nOkGes = 1;  |FINSI;

     nOkSeg = 0;
     |SI #dsam9998#6  ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#7  ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#8  ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#9  ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#10 ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#11 ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#12 ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#13 ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#14 ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#15 ! "X";  nOkSeg = 1;  |FINSI;
     |SI #dsam9998#16 ! "X";  nOkSeg = 1;  |FINSI;

     nOkCol = 0;
     |SI #dsam9998#17 ! "X";  nOkCol = 1;  |FINSI;
     |SI #dsam9998#18 ! "X";  nOkCol = 1;  |FINSI;
     |SI #dsam9998#19 ! "X";  nOkCol = 1;  |FINSI;
     |SI #dsam9998#20 ! "X";  nOkCol = 1;  |FINSI;
     |SI #dsam9998#21 ! "X";  nOkCol = 1;  |FINSI;
     |SI #dsam9998#22 ! "X";  nOkCol = 1;  |FINSI;
     |SI #dsam9998#23 ! "X";  nOkCol = 1;  |FINSI;
|FPRC;
