|FICHEROS;
    dsaz0036;

    dsam0000;
    dsam0025;
    dsam0105;
    dsam0125;

    dsat0007;
    :facturar/facemp1;
    :laboral/nomconca;

    ashismi@;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aFichero  = "";

     aParam    = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nSw       = 0;
     aTitulo   = "";
     nImport1  = 0;
     nImport2  = 0;
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     nEmpresa  = 0;
     nEjer     = 0;
     nAlgun    = 0;
     aBase     = "";
     aDef      = "";
     nSwError  = 0;
     aDObligA  = "";
     aHObligA  = "";
     aDObligB  = "";
     aHObligB  = "";
     nExisteF  = 0;
     nCamp3    = 0;
     nCamp7    = 0;
     nCamp8    = 0;
     aCamp9    = "";
     nCamp10   = 0;
     nCamp13   = 0;
     nCamp14   = 0;
     aCamp15   = "";
     aCamp16   = "";

     nGraba    = 0;
     nInkey    = 0;
     nCanal    = 0;
     aPath     = "";
     aDLiqu1   = "";
     aHLiqu1   = "";
     aDLiqu2   = "";
     aHLiqu2   = "";

     &eaTipoImp     = "";
     &eaPathLaboral = "";
     &eSwImp     = 0;
     &eaFichero  = "";
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpPD    = 0;
     &enEmpresa  = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDConve   = 0;
     &enHConve   = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enFEmp     = 0;
     &eaSFac     = "";
     &enNFac     = 0;
     &efFFac     = @;

     &enTotal1   = 0;
     &enTotal2   = 0;
|FIN;

|PROCESO Tipo66C3z36; |TIPO 66;
   |SI aFuncion = "a";
       |ABRE #dsam0125;
       #dsam0125#0 = #dsaz0036#Campo#;
       |CONSULTA_CLAVE #1#dsam0125;
       #dsaz0036#Campo# = #dsam0125#0;
       |CIERRA #dsam0125;
   |FINSI;

   |PINTA #dsaz0036#Campo#;
|FPRC;

|PROCESO LeeEmpColab; |TIPO 0;
   nSwError = 0;
   |ABRE #dsam0125;
   #dsam0125#0 = #dsaz0036#3;
   |LEE 041#dsam0125.=;
   |SI FSalida ! 0;
       nSwError = 1;
   |SINO;
       |SI #dsam0125#3 ! "S";
           nSwError = 2;
       |SINO;
           #dsaz0036#4 = #dsam0125#2;
           #dsaz0036#9 = #dsam0125#9;
       |FINSI;
   |FINSI;
   |CIERRA #dsam0125;

   |SI nSwError = 0;
       |PINTA #dsaz0036#4;
       |PINTA #dsaz0036#9;
   |SINO;
       aAlfa = "0000No existe Empresa de Colaboradora";
       |SI nSwError = 2;
           aAlfa = "0000Empresa no Colaboradora";
       |FINSI;
       |MENAV aAlfa;
       |ERROR;
    |FINSI;
|FPRC;

|CALCULO DConvenio; |TIPO 0;
    nInkey = FSalida;

    |SI nInkey = 10;
        eaPathLaboral = "";
        |DBASS aBase;
        aAlfa = aBase + "laboral/def/labempre.mas";

        |XABRE "E", aAlfa, nCanal;
        |SI FSalida ] 0;
            eaPathLaboral   = aBase + "laboral/";
        |SINO;
            |MENAV "0000No existe laboral";
            |ACABA;
        |FINSI;

        aPath = eaPathLaboral + "fich/";
        |PATH_DAT #nomconca#aPath#;

        |ABRE #nomconca;
        #nomconca#0 = #dsaz0036#Campo#;
        |CONSULTA_CLAVE #1#nomconca;
        #dsaz0036#Campo#  = #nomconca#0;
        #dsaz0036#Campo#5 = #nomconca#1;
        |PINTA #dsaz0036#Campo#;
    |FINSI;

    |SI #dsaz0036#2 < #dsaz0036#1; |Y Campo = 2;
        |MENAV "0000Error. Hasta Convenio inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HEmpresa; |TIPO 0;
    |SI #dsaz0036#4 < #dsaz0036#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0036#6 < #dsaz0036#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsaz0036#8 < #dsaz0036#7;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|PROCESO Tipo66C14z036; |TIPO 66;
     aBase = "";
     |DBASS aBase;  |QBT aBase;
     aBase = aBase + "facturar/fich/";

     |PATH_DAT #facemp1#aBase#;
     |ABRE #facemp1;
     #facemp1#0 = #dsaz0036#14;
     |CONSULTA_CLAVE #1#facemp1;
     #dsaz0036#14 = #facemp1#0;
     |PINTA #dsaz0036#14;
     |CIERRA #facemp1;
|FPRC;

|PROCESO Tipo0C14z036; |TIPO 0;
     aBase = "";
     |DBASS aBase;  |QBT aBase;
     aBase = aBase + "facturar/fich/";

     nExisteF = 0;
     #dsaz0036#18 = "";
     |PATH_DAT #facemp1#aBase#;
     |ABRE #facemp1;
     #facemp1#0 = #dsaz0036#14;
     |LEE 041#facemp1.=;
     |SI FSalida = 0;
         #dsaz0036#18 = #facemp1#1;
         nExisteF = 1;
     |FINSI;
     |CIERRA #facemp1;
|FPRC;

|PROCESO ClaveBaja;
   #ashismi@#0  = "  ";
   #ashismi@#1  = 00000;
   #ashismi@#29 = fDFecha;
|FPRC;

|PROCESO ClaveAlta;
   #ashismi@#0  = "zz";
   #ashismi@#1  = 99999;
   #ashismi@#29 = fHFecha;
|FPRC;

|PROCESO Tipo0C15z036; |TIPO 0;
     nInkey = FSalida;

     |SI nExisteF = 1;
         aBase = "";
         |DBASS aBase;  |QBT aBase;
         aDef  = aBase + "facturar/def/ashismic";
         |CARGA_DEF aDef, ashismi@;
         |SI FSalida ! 0; |ACABA; |FINSI;

         aBase = aBase + "facturar/fich/";
         aAlfa = aBase + (("00" + #dsaz0036#14) % -102) + "/";
         |PATH_DAT #ashismi@#aAlfa#;

         aAlfa1 = #dsaz0036#0;
         aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
         aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

         |SI nInkey = 10;
             |ABRE #ashismi@;
             #ashismi@#0 = #dsaz0036#15;
             #ashismi@#1 = #dsaz0036#16;
             |CONSULTA_F_CLAVE #2#ashismi@, ClaveBaja, ClaveAlta;
             #dsaz0036#15 = #ashismi@#0;  |PINTA #dsaz0036#15;
             #dsaz0036#16 = #ashismi@#1;  |PINTA #dsaz0036#16;
             #dsaz0036#17 = #ashismi@#29; |PINTA #dsaz0036#17;
             |CIERRA #ashismi@;
         |FINSI;

         |DESCARGA_DEF #ashismi@;
    |FINSI;
|FPRC;

|| *******************************************************************
|PROCESO GrabaAuxiliar1;

    #dsat0007#0 = aFuncion;
    #dsat0007#1 = #dsaz0036#3;
    #dsat0007#2 = #dsaz0036#0;
    #dsat0007#3 = nCamp3;
    #dsat0007#4 = nEmpresa;
    |LEE 141#dsat0007.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0007;
        #dsat0007#0 = aFuncion;
        #dsat0007#1 = #dsaz0036#3;
        #dsat0007#2 = #dsaz0036#0;
        #dsat0007#3 = nCamp3;
        #dsat0007#4 = nEmpresa;
        |GRABA 020#dsat0007.b;
    |FINSI;
    #dsat0007#5  = #dsaz0036#4;
    #dsat0007#6  = #dsam0000#1;
    #dsat0007#7  = nCamp7;
    #dsat0007#8  = nCamp8;
    #dsat0007#9  = aCamp9;
    #dsat0007#10 = nCamp10;
    #dsat0007#11 = #dsam0000#72;
    #dsat0007#12 = #dsam0000#52;
    #dsat0007#13 = nCamp13;
    #dsat0007#14 = nCamp14;
    #dsat0007#15 = aCamp15;
    #dsat0007#16 = aCamp16;
    #dsat0007#19 = #dsam0000#3;

    #dsat0007#17 = aCamp9;
    #dsat0007#18 = aCamp15;
    |SI #dsat0007#17 = "S"; #dsat0007#9  = "X"; |FINSI;
    |SI #dsat0007#18 = "S"; #dsat0007#15 = "X"; |FINSI;
    |GRABA 020#dsat0007.a;
    |LIBERA #dsat0007;

    |SI aCamp9 ! "S";
        #dsaz0036#10 = #dsaz0036#10 + #dsat0007#10;
    |FINSI;
    |SI aCamp15 ! "S";
        #dsaz0036#11 = #dsaz0036#11 + #dsat0007#14;
    |FINSI;
    nAlgun = 1;
|FPRC;

|PROCESO LeeDsam0025;
   nGraba = 0;
   |SI #dsam0025#13 ! "S"; |Y eaTipoImp ! "R"; |Y #dsam0025#15 ! 0;
       nGraba = 1;
   |FINSI;
   |SI #dsam0025#19 ! "S"; |Y eaTipoImp ! "P"; |Y #dsam0025#21 ! 0;
        nGraba = 1;
   |FINSI;
   |SI nGraba = 1;
       nCamp3  = #dsam0025#2;
       nCamp7  = #dsam0025#8;
       nCamp8  = #dsam0025#12;
       aCamp9  = #dsam0025#13;
       nCamp10 = #dsam0025#15;
       nCamp13 = #dsam0025#9;
       nCamp14 = #dsam0025#21;
       aCamp15 = #dsam0025#19;
       aCamp16 = #dsam0025#25;
       |HAZ GrabaAuxiliar1;
   |FINSI;
|FPRC;

|DEFBUCLE dsam0025;
   #dsam0025#1;
   3;
   nEmpresa, enEjer, enDConve, #dsaz0036#3; ||  aDLiqu1, aDLiqu2;
   nEmpresa, enEjer, enHConve, #dsaz0036#3; ||  aHLiqu1, aHLiqu2;
   e;
   NULL, LeeDsam0025;
|FIN;

|PROCESO LeoDsam0000;
   nEmpresa = #dsam0000#0;
   |BUCLE dsam0025;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   72,123;
   enDEmpresa, enDAgente, "S";
   enHEmpresa, enHAgente, "S";
   e;
   NULL, LeoDsam0000;
|FIN;
|| ///////////////////////////////////////////////////////////////////////
|| ********************************************************************
|PROCESO Grabam0025;
    #dsam0025#0 = #dsat0007#4;
    #dsam0025#1 = #dsat0007#2;
    #dsam0025#2 = #dsat0007#3;
    |LEE 141#dsam0025.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsam0025;
        #dsam0025#0 = #dsat0007#4;
        #dsam0025#1 = #dsat0007#2;
        #dsam0025#2 = #dsat0007#3;
        |GRABA 020#dsam0025.b;
    |FINSI;
    |SI eaTipoImp ! "R"; |Y #dsat0007#17 ! "S";
        #dsam0025#13 = #dsat0007#9;
        |SI #dsat0007#9 = "S";
            #dsam0025#14 = efFFac;
            #dsam0025#16 = eaSFac;
            #dsam0025#17 = enNFac;
            #dsam0025#18 = enFEmp;
        |SINO;
            #dsam0025#14 = "01.01.0000";
            #dsam0025#16 = "";
            #dsam0025#17 = 0;
            #dsam0025#18 = 0;
        |FINSI;
    |FINSI;
    |SI eaTipoImp ! "P"; |Y #dsat0007#18 ! "S";
        #dsam0025#19 = #dsat0007#15;
        |SI #dsat0007#15 = "S";
            #dsam0025#20 = efFFac;
            #dsam0025#22 = eaSFac;
            #dsam0025#23 = enNFac;
            #dsam0025#24 = enFEmp;
        |SINO;
            #dsam0025#20 = "01.01.0000";
            #dsam0025#22 = "";
            #dsam0025#23 = 0;
            #dsam0025#24 = 0;
        |FINSI;
    |FINSI;

    |GRABA 020#dsam0025.a;
    |LIBERA #dsam0025;
    nAlgun = 1;
|FPRC;

|PROCESO dsat0007;
    |HAZ Grabam0025;
|FPRC;

|DEFBUCLE dsat0007;
  #dsat0007#1;
  ;
  aFuncion, #dsaz0036#3, enEjer, enDEmpresa, enDConve;
  aFuncion, #dsaz0036#3, enEjer, enHEmpresa, enHConve;
  ;
  NULL, dsat0007;
|FIN;

|PROCESO PasoDatos;
  nAlgun = 0;
  |ABRE #dsam0025;
  |ATRI S; |PINTA 2302, "Actualizando registros .... .... .... "; |ATRI 0;
  |BUCLE dsat0007;
  |CIERRA #dsam0025;
  |SI nAlgun ! 0;
      |SI eSwImp = 1; |HAZ LosInformes; |FINSI;
      aAlfa = "0000Liquidadas las comisiones seleccionadas";
  |SINO;
      aAlfa = "0000No encontrados registros para Liquidar";
  |FINSI;
  |MENAV aAlfa;
|FPRC;
|| ********************************************************************
|| ///////////////////////////////////////////////////////////////////////

|RUTINA ClaveBaja001;
     #dsat0007#0  = aFuncion;
     #dsat0007#1  = #dsaz0036#3;
     #dsat0007#2  = #dsaz0036#0;
     #dsat0007#3  = enDConve;
     #dsat0007#4  = enDEmpresa;
|FRUT;

|RUTINA ClaveAlta001;
     #dsat0007#0  = aFuncion;
     #dsat0007#1  = #dsaz0036#3;
     #dsat0007#2  = #dsaz0036#0;
     #dsat0007#3  = enHConve;
     #dsat0007#4  = enHEmpresa;
|FRUT;

|PROCESO LaPantalla;
    |PINTA 1217, "                         ";
    |PINTA 1254, "                         ";

    |PINPA #0#dsat0007;
    |SI eaTipoImp ! "A";

        |C_P #dsat0007#6,  1, 1709; |C_L #dsat0007#6,1,"S";
        |C_P #dsat0007#3,  1, 1739;
        |C_P #dsat0007#11, 1, 1743;
        |C_P #dsat0007#8,  1, 1746;
        |C_P #dsat0007#16, 1, 2302;

        |PINTA 1509, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÂÄÄÂÄÄÄÄÄÄ";
        |PINTA 1609, "                             ³   ³  ³      ";
        |PINTA 1709, "                             ³   ³  ³      ";
        |PINTA 1809, "                             ³   ³  ³      ";
        |PINTA 1909, "                             ³   ³  ³      ";
        |PINTA 2009, "                             ³   ³  ³      ";
        |PINTA 2109, "                             ³   ³  ³      ";
        |PINTA 2209, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÁÄÄÁÄÄÄÄÄÄ";

        |ATRI R; |PINTA 1602, " Cliente                            ";
                 |PINTA 1639, "Cvn";
                 |PINTA 1643, "Ag";
                 |PINTA 1646, "% Com."; |ATRI 0;

        aAlfa1 = "N";
        aAlfa2 = "S";
        |SI eaTipoImp = "P";
            aAlfa2 = "N";
            aAlfa1 = "S";
            |ATRI R; |PINTA 1653, "Imp. Poliza  Cuota Comis."; |ATRI 0;
            |C_P #dsat0007#7, 1, 1753;
            |C_P #dsat0007#10,1, 1766;
            |C_P #dsat0007#9, 1, 1779;
        |SINO;
            |C_P #dsaz0036#11, 1, 1217;
            |C_P #dsaz0036#13, 1, 1254;
        |FINSI;

    |SINO;

        |C_P #dsat0007#6,  1, 2302; |C_L #dsat0007#6,1,"N";
        |C_P #dsat0007#3,  1, 1710;
        |C_P #dsat0007#11, 1, 1714;
        |C_P #dsat0007#8,  1, 1717;
        |C_P #dsat0007#16, 1, 2333;
        |C_P #dsaz0036#11, 1, 1230;
        |C_P #dsaz0036#13, 1, 1267;

        aAlfa1 = "S";
        aAlfa2 = "S";
        |C_P #dsat0007#7, 1, 1724;
        |C_P #dsat0007#10,1, 1737;
        |C_P #dsat0007#9, 1, 1750;
    |FINSI;

    |C_V #dsat0007#7,  1, aAlfa1;
    |C_V #dsat0007#10, 1, aAlfa1;
    |C_V #dsat0007#9,  1, aAlfa1;

    |C_V #dsat0007#13, 1, aAlfa2;
    |C_V #dsat0007#14, 1, aAlfa2;
    |C_V #dsat0007#15, 1, aAlfa2;

    |C_V #dsaz0036#10, 1, aAlfa1;
    |C_V #dsaz0036#12, 1, aAlfa1;
    |C_V #dsaz0036#11, 1, aAlfa2;
    |C_V #dsaz0036#13, 1, aAlfa2;

    |PINTA #dsaz0036#10;
    |PINTA #dsaz0036#11;
    |PINTA #dsaz0036#12;
    |PINTA #dsaz0036#13;
|FPRC;

|PROCESO Procesoz036;

     eaFichero = ("4x" + Usuario) % 108;
     |NOME_DAT #dsat0007#eaFichero#;
     |SI aParam ! "Auto";
         |DELINDEX #dsat0007;
     |FINSI;

     aAlfa1 = #dsaz0036#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enEjer  = #dsaz0036#0;
     aDLiqu1 = " ";  aDLiqu2 = " ";
     aHLiqu1 = "z";  aHLiqu2 = "z";
     |SI #dsaz0036#19 ! "R";
         aDLiqu1 = "N";
         aHLiqu1 = "N";
     |FINSI;
     |SI #dsaz0036#19 ! "P";
         aDLiqu2 = "N";
         aHLiqu2 = "N";
     |FINSI;

     enDEmpresa = #dsaz0036#5;
     enHEmpresa = #dsaz0036#6;
     enDAgente  = #dsaz0036#7;
     enHAgente  = #dsaz0036#8;
     enDConve   = #dsaz0036#1;
     enHConve   = #dsaz0036#2;
     eaTipoImp  = #dsaz0036#19;

     #dsaz0036#10 = 0;  #dsaz0036#11 = 0;
     #dsaz0036#12 = 0;  #dsaz0036#13 = 0;

     enFEmp = #dsaz0036#14;
     eaSFac = #dsaz0036#15;
     enNFac = #dsaz0036#16;
     efFFac = #dsaz0036#17;

     |SI aParam ! "Auto";
         nAlgun = 0;
         |ABRE #dsat0007;
         |BUCLE dsam0000;
         |CIERRA #dsat0007;
     |SINO;
         #dsaz0036#10 = enTotal1;
         #dsaz0036#11 = enTotal2;
         nAlgun = 1;
     |FINSI;

     |SI nAlgun = 1;
         |HAZ LaPantalla;
         eSwImp  = 0;
         enEjer  = #dsaz0036#0;
         enEmpPD = #dsaz0036#3;
         |ENTLINEAL #1#dsat0007, -5, 4, 21, 0, ClaveBaja001, ClaveAlta001;
         |SI FSalida = 0;
             |CONFI "0000SDesea actualizar los datos Introducidos";
             |SI FSalida = 0;
                 |CONFI "0000SDesea obtener un informe de las comisiones liquidadas";
                 |SI FSalida = 0; eSwImp = 1; |FINSI;
                 |HAZ PasoDatos;
             |FINSI;
         |FINSI;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;
     |DELINDEX #dsat0007;
|FPRC;

|PROGRAMA;

    aParam = PARAMETRO; |QBF aParam;
    |SI aParam ! "Auto";
        aFuncion = PARAMETRO; |QBF aFuncion;
    |FINSI;
    |SI aFuncion = ""; aFuncion = "a"; |FINSI;

    |CLS;
    |CABEZA "Liquidar Comision";

    aTitulo = "Seguros de Convenio";

    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsaz0036#0 = aAlfa;

    |PINPA #0#dsaz0036;
    |ATRI R; |PINTA 0543, aTitulo; |ATRI 0;


    |SI aParam ! "Auto";
        |PINDA #0#dsaz0036;

        |PUSHV 0701 2380;
        nSw = 0;
        |PARA; |SI nSw = 0; |HACIENDO;

               |ENDATOS #2#dsaz0036;
               |SI FSalida = 0;
                   |HAZ Procesoz036;
                   |POPV;

                    #dsaz0036#3 = 1;
                    #dsaz0036#4 = "";
                    |PDEFECTO #dsaz0036,9,20;
                    |PINDA #0#dsaz0036;
                    |PUSHV 0701 2380;
               |SINO;
                   nSw = 1;
               |FINSI;
        |SIGUE;
        |POPV;
    |SINO;
         eaFichero = ("4x" + Usuario) % 108;
         |NOME_DAT #dsat0007#eaFichero#;

         #dsaz0036#0  = enEjer;     |C_M #dsaz0036#0, 1, "N";
         #dsaz0036#1  = enDConve;   |C_M #dsaz0036#1, 1, "N";
         #dsaz0036#2  = enHConve;   |C_M #dsaz0036#2, 1, "N";
         #dsaz0036#3  = enEmpPD;    |C_M #dsaz0036#3, 1, "N";
         #dsaz0036#5  = enDEmpresa; |C_M #dsaz0036#5, 1, "N";
         #dsaz0036#6  = enHEmpresa; |C_M #dsaz0036#6, 1, "N";
         #dsaz0036#7  = enDAgente;  |C_M #dsaz0036#7, 1, "N";
         #dsaz0036#8  = enHAgente;  |C_M #dsaz0036#8, 1, "N";
         #dsaz0036#19 = eaTipoImp;  |C_M #dsaz0036#19,1, "N";

         |HAZ LeeEmpColab;
         |PINDA #0#dsaz0036;
         |HAZ LaPantalla;
         |ENTLINEAL #1#dsat0007, -5, 7, 21, 0, ClaveBaja001, ClaveAlta001;

         |ENDATOS #2#dsaz0036;
         |SI FSalida = 0;
             |HAZ Procesoz036;
         |FINSI;
    |FINSI;
|FPRO;
