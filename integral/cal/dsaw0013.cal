|FICHEROS;
    dsam0000;
    dsam0023;
    dsam0024;

    dsaw0013,MANTE;
    dsat0001;
    dsat0003;
|FIN;

|VARIABLES;
     aAlfa       = "";
     aAlfa1      = "";
     nPara1      = 0;
     nBoton1     = 0;
     nBoton2     = 0;
     nBoton3     = 0;
     nBoton4     = 0;
     nBoton5     = 0;
     nBoton6     = 0;
     nBoton8     = 0;
     nTecla      = 0;
     nAlgun      = 0;
     nOp         = 0;
     nNoPregunta = 0;
     aDMarca     = "";
     aHMarca     = "";
     informe     = "";
     inform1     = "dsat0001";
     inform2     = "dsat1001";
     nSw         = 0;
     nSw03       = 0;
     aFichero    = "";

     &eaFichero  = "";
     &eaFicher1  = "";
     &enEjer = 0;
     &enEmpresa = 0;
     &enEmpPD = 0;
     &aFuncion = "";
     &enNoPregunta = 0;
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &enHMes     = 0;
     &eaDMes     = "";
     &enTotal1   = 0;
     &enTotal2   = 0;

     &eaTitul1  = "";
     &eaTitul2  = "";
|FIN;

|| ////////////////////////////////////
|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROCESO Boton4;
     |PTEC 827;
|FPRC;

|PROCESO Boton5;
     |PTEC 828;
|FPRC;

|PROCESO Boton6;
     |PTEC 829;
|FPRC;

|PROCESO Boton8;
     |PTEC 830;
|FPRC;

|PROCESO Tipo0;  |TIPO 0;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton8;
     |PULSATECLA;
|FPRC;

|| **********************************************************************
|RUTINA ClaveBaja001;
     #dsat0001#0  = #dsaw0013#0;
     #dsat0001#1  = #dsaw0013#2;
     #dsat0001#2  = #dsaw0013#1;
     #dsat0001#3  = enDMes;
     #dsat0001#4  = enDEmpresa;
|FRUT;

|RUTINA ClaveAlta001;
     #dsat0001#0  = #dsaw0013#0;
     #dsat0001#1  = #dsaw0013#2;
     #dsat0001#2  = #dsaw0013#1;
     #dsat0001#3  = enHMes;
     #dsat0001#4  = enHEmpresa;
|FRUT;

|PROCESO Tipo7;  |TIPO 7;

     |PINTA 0715, #dsaw0013#2;

     |ENTLINEAL #1#dsat0001, -5, 7, 22, 0, ClaveBaja001, ClaveAlta001;

     |BLIN 04;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Entrada al Lineal", 1009, 1025, Boton1;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Inf.Clientes CON Importe", 1027, 1045, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Inf.Clientes SIN Importe", 1127, 1145, Boton3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F5 Marcar Todos", 1046, 1061, Boton4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F6 Desmarcar Todos", 1146, 1161, Boton5;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F7 Borrar Emp. Colab.", 1063, 1078, Boton6;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F8 Actualizar datos ", 1163, 1178, Boton8;
     nBoton8 = FSalida;

|FPRC;

|| //////////////////////////////////////////////////////////////
|PROCESO InforDsat0001;
   |SI nTecla = 11; |Y #dsat0001#7 = 0;
       |ACABA;
   |FINSI;
   |SI nTecla = 12; |Y #dsat0001#7 ! 0;
       |ACABA;
   |FINSI;

   |PRINT;
   nAlgun = 1;
|FPRC;

|PROCESO MarcaDsat0001;
   #dsat0001#17 = aAlfa;
   |GRABA 020#dsat0001.a;
|FPRC;

|PROCESO LeeDsat0001;
   |SI nOp = 0;
       |HAZ MarcaDsat0001;
   |FINSI;

   |SI nOp = 1;
       |HAZ InforDsat0001;
   |FINSI;
   |LIBERA #dsat0001;
|FPRC;

|DEFBUCLE LeeDsat0001;
   #dsat0001#1;
   ;
   #dsaw0013#0, #dsaw0013#2, #dsaw0013#1, enDMes, enDEmpresa;
   #dsaw0013#0, #dsaw0013#2, #dsaw0013#1, enHMes, enHEmpresa;
   be;
   NULL, LeeDsat0001;
|FIN;
|| //////////////////////////////////////////////////////////////
|PROCESO LosInformes;
   nAlgun  = 0;
   |IMPRE 0;
   |SI FSalida ! 0;
       |ACABA;
   |FINSI;
   |SI nTecla = 11; informe = inform1; |FINSI;
   |SI nTecla = 12; informe = inform2; |FINSI;
   eaTitul1 = "PROTECCION DE DATOS";
   eaTitul2 = "Proteccion Datos";
   |SI aFuncion = "B";
       eaTitul1 = "PREVENCION DE RIESGOS LABORALES";
       eaTitul2 = "Preven. Priesgos";
   |FINSI;

   |INFOR informe;
   |SI FSalida ! 0;
       |MENAV "0000No existe informe";
       |FINIMP;
       |ACABA;
   |FINSI;

   nOp = 1; |BUCLE LeeDsat0001;
   |SI nAlgun = 1;
       |PIEINF;
   |SINO;
       |SI nTecla = 11;
           aAlfa = "0000No existen Clientes con Comision calculada";
       |SINO;
           aAlfa = "0000No existen Clientes SIN Importes";
       |FINSI;
       |MENAV aAlfa;
   |FINSI;
   |FININF;
   |FINIMP;
|FPRC;

|PROCESO ActualM0023;
       #dsam0023#0 = #dsat0001#4;
       #dsam0023#1 = #dsat0001#2;
       #dsam0023#2 = #dsat0001#3;
       |LEE 141#dsam0023.=;
       |SI FSalida ! 0;
           |DDEFECTO #dsam0023;
           #dsam0023#0 = #dsat0001#4;
           #dsam0023#1 = #dsat0001#2;
           #dsam0023#2 = #dsat0001#3;
           |GRABA 020#dsam0023.b;
       |FINSI;
       #dsam0023#3  = #dsat0001#1;
       #dsam0023#4  = #dsat0001#5;
       #dsam0023#11 = #dsat0001#7;
       #dsam0023#12 = #dsat0001#8;
       #dsam0023#13 = #dsat0001#9;
       #dsam0023#14 = #dsat0001#10;
       #dsam0023#15 = #dsat0001#11;
       #dsam0023#16 = #dsat0001#12;
       #dsam0023#17 = #dsat0001#13;
       #dsam0023#18 = #dsat0001#14;
       |GRABA 020#dsam0023.a;
       |LIBERA  #dsam0023;
|FPRC;

|PROCESO ActualM0024;
       #dsam0024#0 = #dsat0001#4;
       #dsam0024#1 = #dsat0001#2;
       #dsam0024#2 = #dsat0001#3;
       |LEE 141#dsam0024.=;
       |SI FSalida ! 0;
           |DDEFECTO #dsam0024;
           #dsam0024#0 = #dsat0001#4;
           #dsam0024#1 = #dsat0001#2;
           #dsam0024#2 = #dsat0001#3;
           |GRABA 020#dsam0024.b;
       |FINSI;
       #dsam0024#3  = #dsat0001#1;
       #dsam0024#4  = #dsat0001#5;
       #dsam0024#10 = #dsat0001#7;
       #dsam0024#11 = #dsat0001#8;
       #dsam0024#12 = #dsat0001#18;
       #dsam0024#13 = #dsat0001#9;
       #dsam0024#14 = #dsat0001#10;
       #dsam0024#15 = #dsat0001#11;
       #dsam0024#16 = #dsat0001#19;
       #dsam0024#17 = #dsat0001#12;
       #dsam0024#18 = #dsat0001#13;
       #dsam0024#19 = #dsat0001#14;
       |GRABA 020#dsam0024.a;
       |LIBERA  #dsam0024;
|FPRC;

|PROCESO GrabaDsat0003;
       #dsat0003#0  = #dsat0001#0;
       #dsat0003#1  = #dsat0001#1;
       #dsat0003#2  = #dsat0001#2;
       #dsat0003#3  = #dsat0001#3;
       #dsat0003#4  = #dsat0001#4;
       #dsat0003#5  = #dsat0001#5;
       #dsat0003#6  = #dsat0001#6;
       #dsat0003#7  = #dsat0001#7;
       #dsat0003#8  = #dsat0001#8;
       #dsat0003#9  = #dsat0001#9;
       #dsat0003#10 = #dsat0001#11;
       #dsat0003#11 = #dsat0001#15;
       #dsat0003#12 = #dsat0001#16;
       #dsat0003#13 = #dsat0001#18;
       #dsat0003#14 = #dsat0001#19;
       #dsat0003#15 = #dsat0001#20;

       |SI #dsat0001#9 ! "S";
           |SI #dsat0003#10 ! 0; |O #dsat0003#14 ! 0;
               enTotal1 = enTotal1 + #dsat0003#10;
               enTotal2 = enTotal2 + #dsat0003#14;
               |GRABA 020#dsat0003.n;
               nSw03 = 1;
           |FINSI;
       |FINSI;
|FPRC;

|PROCESO Actualiza;
   |SI nOp = 0;
       #dsam0000#0 = #dsat0001#4;
       |LEE 141#dsam0000.=;
       |SI FSalida = 0;
           |SI aFuncion = "A"; #dsam0000#121 = "S"; |FINSI;
           |SI aFuncion = "B"; #dsam0000#122 = "S"; |FINSI;
           |GRABA 020#dsam0000.a;
       |FINSI;
       |LIBERA #dsam0000;

       |SI aFuncion = "A";  |HAZ ActualM0023;  |FINSI;
       |SI aFuncion = "B";  |HAZ ActualM0024;  |FINSI;

       |HAZ GrabaDsat0003;

   |FINSI;

   |SI nOp ! 2;
      |BORRA 020#dsat0001.a;
   |FINSI;

   |SI nOp = 2;  nSw = 1;  |FINSI;

   |LIBERA #dsat0001;
|FPRC;

|DEFBUCLE Actualiza;
   #dsat0001#1;
   17;
   #dsaw0013#0, #dsaw0013#2, #dsaw0013#1, enDMes, enDEmpresa, aDMarca;
   #dsaw0013#0, #dsaw0013#2, #dsaw0013#1, enHMes, enHEmpresa, aHMarca;
   be;
   NULL, Actualiza;
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     nTecla = FSalida;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton8;
     |PULSATECLA;

     enEjer  = #dsaw0013#1;
     enEmpPD = #dsaw0013#2;
     nNoPregunta = 0;

     |SI nTecla =  10;
         |ENTLINEAL #1#dsat0001, -5, 4, 22, 0, ClaveBaja001, ClaveAlta001;
         |SI FSalida = 0;
             |SI enNoPregunta = 0;
                 |CONFI "0000SDesea actualizar los datos Introducidos";
                 |SI FSalida = 0;
                     nTecla = 16;
                     nNoPregunta = 1;
                 |FINSI;
             |SINO;
                 |ERROR;
             |FINSI;
         |FINSI;
         enNoPregunta = 0;
     |FINSI;

     |SI nTecla = 16;

         |LEE 041#dsaw0013.=;

         |SI nNoPregunta = 0;
             |CONFI "    NEsta Seguro de Actualizar los Datos introducidos ";
             |SI FSalida ! 0;  |ACABA;  |FINSI;
         |FINSI;

         nSw03    = 0;
         aFichero = ("4x" + Usuario) % 108;
         |NOME_DAT #dsat0003#aFichero#
         |DELINDEX #dsat0003;

         enTotal1 = 0;
         enTotal2 = 0;
         aDMarca = "*";
         aHMarca = "*";
         |ABRE #dsat0003;
         |ABRE #dsam0000;
         |ABRE #dsam0023;
         |ABRE #dsam0024;
         nOp = 0; |BUCLE Actualiza;
         |CIERRA #dsam0023;
         |CIERRA #dsam0024;
         |CIERRA #dsam0000;
         |CIERRA #dsat0003;

         nSw     = 0;
         aDMarca = " ";
         aHMarca = " ";
         nOp = 2; |BUCLE Actualiza;
         |SI nSw = 0;
             |BORRA 020#dsaw0013.a;
         |FINSI;

         |SI nSw03 = 1;
             |CONFI "0000SLiquidar comisiones";
             |SI FSalida = 0;
                 eaFicher1 = eaFichero;
                 |SUB_EJECUTA_NP ":integral/dsaz0031;Auto";
                 eaFichero = eaFicher1;
             |FINSI;
         |FINSI;
         |DELINDEX #dsat0003;

         |PTEC 809;
         |PTEC 808;
         |PONCONTROL  23, "SI";

     |FINSI;

     |SI nTecla = 11; |O nTecla = 12;
         |HAZ LosInformes;
         |ERROR;
     |FINSI;

     |SI nTecla = 13; |O nTecla = 14;
         aAlfa = "*";
         |SI nTecla = 14; aAlfa = " "; |FINSI;

         nOp = 0; |BUCLE LeeDsat0001;

         |ENTLINEAL #1#dsat0001, -5, 7, 22, 0, ClaveBaja001, ClaveAlta001;

         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 15;

         |LEE 041#dsaw0013.=;

         |CONFI "    NEsta Seguro de borrar las modificaciones introducidas de esta Empresa";
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         aDMarca = " ";
         aHMarca = "*";
         nOp = 1; |BUCLE Actualiza;

         |BORRA 020#dsaw0013.a;
         |PTEC 809;
         |PTEC 808;
         |PONCONTROL  23, "SI";
     |FINSI;
|FPRC;
