|FICHEROS;
    dsam0000;
    dsam0027;
    dsam0029;

    dsat0008,MANTE;
    dsat0009,MANTE;

    dsaw0045,MANTE;
    dsaw0046,MANTE;

    dsat008@;
|FIN;

|VARIABLES;
     aAlfa       = "";
     aAlfa1      = "";
     nPara1      = 0;
     nBoton1     = 0;
     nBoton2     = 0;
     nBoton3     = 0;
     nBoton4     = 0;
     nBoton5     = 0;
     nBoton6     = 0;
     nBoton8     = 0;
     nTecla      = 0;
     nAlgun      = 0;
     nOp         = 0;
     fFecha      = @;
     informe     = "";
     inform1     = "dsat0009";
     inform2     = "dsat1009";
     nSw         = 0;
     nSw03       = 0;
     aFichero    = "";
     aBase       = "";
     aDef        = "";
     nExpediente = 0;
     nExpedient1 = 0;
     aEstado     = "";
     nModo       = 0;

     &eaFichero  = "";
     &eaFicher1  = "";
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &eaDMes     = "";

     &eSwLinea  = 0;
     &eaTitul1  = "";
     &eaTitul2  = "";
|FIN;

|INCLUYE i_varfun;

|| ////////////////////////////////////
|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Boton2;
     |PTEC 825;
|FPRC;

|PROCESO Boton3;
     |PTEC 826;
|FPRC;

|PROCESO Boton4;
     |PTEC 827;
|FPRC;

|PROCESO Boton5;
     |PTEC 828;
|FPRC;

|PROCESO Boton6;
     |PTEC 829;
|FPRC;

|PROCESO Boton8;
     |PTEC 830;
|FPRC;

|PROCESO FinBotones;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo0t008;  |TIPO 0;
     |HAZ FinBotones;
|FPRC;

|| **********************************************************************
|RUTINA ClaveBaja9;
     #dsat0009#6  = #dsat0008#21;
     #dsat0009#5  = #dsat0008#20;
     #dsat0009#0  = #dsat0008#0;
     #dsat0009#1  = "          ";
|FRUT;

|RUTINA ClaveAlta9;
     #dsat0009#6  = #dsat0008#21;
     #dsat0009#5  = #dsat0008#20;
     #dsat0009#0  = #dsat0008#0;
     #dsat0009#1  = "zzzzzzzzzz";
|FRUT;

|PROCESO Tipo7t008;  |TIPO 7;

     |ENTLINEAL #1#dsat0009, -4, 7, 21, 0, ClaveBaja9, ClaveAlta9;

     |BLIN 04;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Entrada Lineal", 0721, 0739, Boton1;
     nBoton1 = FSalida;

     |SI #dsat0008#8 = "X";
         aAlfa = "LBOTON,F3 Borrar Linea";
     |SINO;
         aAlfa = "LBOTON,F3 Desmarcar Expediente";
     |FINSI;

     |CONTROL_SIMPLE 0, aAlfa, 0821, 0839, Boton2;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Inf. Expediente Actual", 0741, 0759, Boton3;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F5 Listados Expedientes", 0841, 0859, Boton4;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F6 Abrir Expediente", 0760, 0778, Boton5;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F7 Cancelar Expediente", 0860, 0878, Boton6;
     nBoton6 = FSalida;

|FPRC;

|| //////////////////////////////////////////////////////////////
|PROCESO CargaFichero;
   |DBASE aBase;
   aDef = aBase + "def/dsat0008";
   |CARGA_DEF aDef, dsat008@;
   |SI FSalida ! 0;
       aDef = "";
   |FINSI;
|FPRC;

|PROCESO DesCargaFichero;
   |SI aDef ! ""; |DESCARGA_DEF #dsat008@; aDef = ""; |FINSI;
|FPRC;

|PROCESO BuscaExpediente;
   nExpediente = 0;
   nExpedient1 = 0;

   |ABRE #dsam0029;
   |LEE 041#dsam0029.u;
   |SI FSalida = 0;
       nExpediente = #dsam0029#1;
   |FINSI;
   |CIERRA #dsam0029;

   |ABRE #dsam0027;
   |LEE 041#dsam0027.u;
   |SI FSalida = 0;
       |SI nExpediente < #dsam0027#1;
           nExpediente = #dsam0027#1;
       |FINSI;
   |FINSI;
   |CIERRA #dsam0027;

   |HAZ CargaFichero;
   |SI aDef ! "";
       |ABRE #dsat008@;
       |SELECT #2#dsat008@;
       |LEE 040#dsat008@.u;
       |SI FSalida = 0;
           nExpedient1 = #dsat008@#9;
       |FINSI;
       |SELECT #1#dsat008@;
       |CIERRA #dsat008@;
       |HAZ DesCargaFichero;
   |FINSI;

   |SI nExpedient1 > nExpediente;
       nExpediente = nExpedient1;
   |FINSI;
   nExpediente = nExpediente + 1;
|FPRC;

|PROCESO AbrirExpediente;
    nExpediente = #dsat0008#9;
    |SI #dsat0008#8 ! "A";
        |HAZ BuscaExpediente;
    |FINSI;

    |PUSHV 0922 2380;
    |DDEFECTO #dsaw0045;
    #dsaw0045#0 = nExpediente;
    #dsaw0045#1 = #dsat0008#10;
    #dsaw0045#2 = #dsat0008#11;
    #dsaw0045#3 = #dsat0008#12;
    #dsaw0045#4 = #dsat0008#13;
    #dsaw0045#5 = #dsat0008#14;
    #dsaw0045#6 = #dsat0008#15;
    #dsaw0045#7 = #dsat0008#16;
    #dsaw0045#8 = #dsat0008#17;
    |HAZ LeeControl128;
    aAlfa = #dsat0008#18; |QBF aAlfa;
    |SI aAlfa ! ""; #dsaw0045#12 = #dsat0008#18; |FINSI;
    aAlfa = #dsat0008#19; |QBF aAlfa;
    |SI aAlfa ! ""; #dsaw0045#15 = #dsat0008#19; |FINSI;

    enNExpediente = #dsaw0045#1;

    |PINPA #0#dsaw0045;
    |PINDA #0#dsaw0045;
    |ENDATOS #2#dsaw0045;
    |SI FSalida = 0;
       #dsat0008#8  = "A";
       #dsat0008#9  = #dsaw0045#0;
       #dsat0008#10 = #dsaw0045#1;
       #dsat0008#11 = #dsaw0045#2;
       #dsat0008#12 = #dsaw0045#3;
       #dsat0008#13 = #dsaw0045#4;
       #dsat0008#14 = #dsaw0045#5;
       #dsat0008#15 = #dsaw0045#6;
       #dsat0008#16 = #dsaw0045#7;
       #dsat0008#17 = #dsaw0045#8;
       #dsat0008#18 = #dsaw0045#12;
       #dsat0008#19 = #dsaw0045#15;
       #dsat0008#22 = "01.01.0000";
       #dsat0008#23 = "";
       #dsat0008#24 = 00;
       #dsat0008#25 = 0000;
       |GRABA 020#dsat0008.a;
    |FINSI;
    |POPV;
|FPRC;

|PROCESO CancelarExpediente;

    |PUSHV 0918 2380;
    |DDEFECTO #dsaw0046;
    #dsaw0046#0 = #dsat0008#24;
    #dsaw0046#1 = #dsat0008#25;
    #dsaw0046#2 = #dsat0008#26;
    #dsaw0046#3 = #dsat0008#22;
    #dsaw0046#4 = #dsat0008#23;

    |PINPA #0#dsaw0046;
    aAlfa = "CANCELAR EL EXPEDIENTE COMPLETO POR";
    |SI nModo = 4;
        aAlfa = "EXPEDIENTE CANCELADO";
    |FINSI;
    |ATRI R; |PINTA 0919, aAlfa; |ATRI 0;
    |PINDA #0#dsaw0046;
    |SI nModo = 4;
        |PAUSA;
    |SINO;
        |ENDATOS #2#dsaw0046;
        |SI FSalida = 0;
            #dsat0008#8 = "C";
            #dsat0008#24 = #dsaw0046#0;
            #dsat0008#25 = #dsaw0046#1;
            #dsat0008#26 = #dsaw0046#2;
            #dsat0008#22 = #dsaw0046#3;
            #dsat0008#23 = #dsaw0046#4;
            |GRABA 020#dsat0008.a;
        |FINSI;
    |FINSI;
    |POPV;
|FPRC;
|| //////////////////////////////////////////////////////////////
|PROCESO InforDsat0009;
   |PRINT;
   nAlgun   = 1;
   eSwLinea = 1;
|FPRC;

|PROCESO LeeDsat0009;
   |SI nOp = 1;
       |HAZ InforDsat0009;
   |FINSI;
   |SI nOp = 2;
       |BORRA 020#dsat0009.a;
   |FINSI;
   |LIBERA #dsat0009;
|FPRC;

|DEFBUCLE LeeDsat0009;
   #dsat0009#1;
   ;
   #dsat0008#21, #dsat0008#20, #dsat0008#0, "          ";
   #dsat0008#21, #dsat0008#20, #dsat0008#0, "zzzzzzzzzz";
   be;
   NULL, LeeDsat0009;
|FIN;

|PROCESO LeeDsat0008;
  |SI nTecla = 13;
      |PARA nPara1 = 0; |SI nPara1 [ 26; |HACIENDO nPara1 = nPara1 + 1;
            #dsat0008#nPara1# = #dsat008@#nPara1#;
      |SIGUE;
  |FINSI;
  |SI aEstado = ""; |O aEstado = #dsat0008#8;
      eSwLinea = 0;
      nOp = 1; |BUCLE LeeDsat0009;
  |FINSI;
|FPRC;

|DEFBUCLE LeeDsat0008;
   #dsat008@#1003;
   ;
   enEjeRen, enMesRen, enDEmpresa;
   enEjeRen, enMesRen, enHEmpresa;
   ;
   NULL, LeeDsat0008;
|FIN;

|| //////////////////////////////////////////////////////////////
|PROCESO LosInformes;
   |HAZ CargaFichero;
   |SI aDef = "";
       |MENAV "0000Error al cargar dsat0008";
       |ACABA;
   |FINSI;
   aEstado = "";
   |SI nTecla = 13;
       |CONFI "0000NImprimir Solo los Expedientes Abiertos";
       |SI FSalida = 0;
           aEstado = "A";
       |FINSI;
   |FINSI;

   nAlgun  = 0;
   |IMPRE 0;
   |SI FSalida ! 0;
       |HAZ DesCargaFichero;
       |ACABA;
   |FINSI;
   |SI nTecla = 12; informe = inform1; |FINSI;
   |SI nTecla = 13; informe = inform2; |FINSI;
   eaTitul1 = "EXPEDIENTES DE VISADO DE TRANSPORTES";

   |INFOR informe;
   |SI FSalida ! 0;
       |MENAV "0000No existe informe";
       |FINIMP;
       |HAZ DesCargaFichero;
       |ACABA;
   |FINSI;

   |SALVA_DATOS #dsat0008;
   |SI nTecla = 13;
       |BUCLE LeeDsat0008;
   |SINO;
       |HAZ LeeDsat0008;
   |FINSI;

   |SI nAlgun = 1;
       |PIEINF;
   |FINSI;
   |FININF;
   |FINIMP;

   |REPON_DATOS #dsat0008;
   |HAZ DesCargaFichero;
|FPRC;
|| //////////////////////////////////////////////////////////////

|PROCESO F3Borrar;
    nOp = 2; |BUCLE LeeDsat0009;
    |BORRA 020#dsat0008.a;
    |PONCONTROL  23, "SI";

    nSw = 1;
    |HAZ CargaFichero;
    |SI aDef ! "";
        nSw = 0;
        |ABRE #dsat008@;
        #dsat008@#21 = #dsat0008#21;
        #dsat008@#20 = #dsat0008#20;
        #dsat008@#0  = 00001;
        |LEE 040#dsat008@.]
        |SI FSalida = 0;
            |Y #dsat008@#21 = #dsat0008#21; |Y #dsat008@#20 = #dsat0008#20;
            nSw = 1;
        |FINSI;
        |CIERRA #dsat008@;
        |HAZ DesCargaFichero;
    |FINSI;
    |SI nSw = 0;
        |PTEC 806;
    |FINSI;
|FPRC;
|| //////////////////////////////////////////////////////////////

|PROCESO Tipo11t008;  |TIPO 11;
     nTecla = FSalida;
     |HAZ FinBotones;

     |SI nTecla =  10;

         |SI #dsat0008#8 = "C";

             nModo = 4;
             |HAZ CancelarExpediente;
             nModo = 0;
             |ACABA;
         |FINSI;

         |ENTLINEAL #1#dsat0009, -4, 4, 21, 0, ClaveBaja9, ClaveAlta9;
         |SI FSalida = 0; |Y #dsat0008#8 = "X";
             |CONFI "0000SDesea abrir Expendiente";
             |SI FSalida = 0;
                 nTecla = 14;
             |FINSI;
         |FINSI;

     |FINSI;

     |SI nTecla = 12; |O nTecla = 13;
         |HAZ LosInformes;
         |ERROR;
     |FINSI;

     |SI nTecla = 14;

         |LEE 041#dsat0008.=;
         |SI #dsat0008#8 = "C";
             |MENAV "0000Expediente Cancelado. Primero desmarquelo";
             |ACABA;
         |FINSI;

         |HAZ AbrirExpediente;
         |LIBERA #dsat0008;

         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 11;

         |LEE 041#dsat0008.=;

         aAlfa = "0000NDesea desmarcar este Expediente";
         |SI #dsat0008#8 = "X";
             aAlfa = "0000NDesea borrar esta linea ";
         |FINSI;
         |CONFI aAlfa;
         |SI FSalida ! 0;
             |ERROR;
             |ACABA;
         |FINSI;
         |SI #dsat0008#8 ! "X";
             |PDEFECTO #dsat0008, 8,20;
             |PDEFECTO #dsat0008,22,26;
             |GRABA 020#dsat0008.a;
         |SINO;
             |HAZ F3Borrar;
         |FINSI;
     |FINSI;

     |SI nTecla = 15;

         |LEE 041#dsat0008.=;
         aAlfa = "0000NDesea Cancelar este Expediente";
         |CONFI aAlfa;
         |SI FSalida = 0;
             nModo = 0;
             |HAZ CancelarExpediente;
         |FINSI;
         |LIBERA #dsat0008;
         |PONCONTROL  23, "SI";

     |FINSI;
|FPRC;
