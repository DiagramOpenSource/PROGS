|FICHEROS;
     dsay0019 #0;

     :/integral/def/dsam0000 #1;
     :/integral/def/dsam0103 #103;
     :/integral/def/dsam0017 #17;
     :/integral/def/dsam0018 #18;
     dsaz0023 #23;
|FIN;

|VARIABLES;

     nCampo       = 0;
     aAlfa1       = "";
     aAlfa2       = "";
     nNume1       = 0;
     nNume2       = 0;
     nPara1       = 0;
     nPara2       = 0;

     aParam       = "";
     aBase        = "";
     aFichero     = "";
     aAlfa        = "";
     nDCliente    = 0;
     nHCliente    = 0;
     aDNif        = "";
     aHNif        = "";
     aDTEmbargo   = "";
     aHTEmbargo   = "";
     nDTEmbargo   = 0;
     nHTEmbargo   = 0;
     fDFecEmb     = @;
     fHFecEmb     = @;
     nCliente     = 0;
     aNif         = "";
     nSw          = 0;
     nVale        = 0;

     &eaPath      = "";
     &enEmpresa   = 0;
     &enDCliente  = 0;
     &enHCliente  = 0;
     &enDTEmbargo = 0;
     &enHTEmbargo = 0;
     &efDFecEmb   = @;
     &efHFecEmb   = @;
     &eaDNif      = "";
     &eaHNif      = "";
     &eaOrdAgru   = "";
     &eaDetalle   = "";
     &enSwLinea   = 0;

     informe      = "";
     nSelec       = 0;

  &efFecLeg      = @;
   aNombrePDF    = "";
   nSwError      = 0;
   nCalc         = 0;
   aIP           = "";
   &enHayInforme = 0;
{1}aContiene    = "";
|FIN;

|INCLUYE i_masivo;
|INCLUYE i_promas;

|| /////////////////////// PROCESOS ENTRADA POR PANTALLA \\\\\\\\\\\\\\\\\\\\
|PROCESO T7;  |TIPO 7;
     |SI enEmpresa ! 0;
         #0#0 = enEmpresa;  |PINTA #0#0;
         #0#1 = enEmpresa;  |PINTA #0#1;

         |C_M #0#0, 1, "N";
         |C_M #0#1, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Parrilla;
     |SI #0#0 = 0;
         #0#0 = 0;  |PINTA #0#0;
         #0#1 = 0;  |PINTA #0#1;  |C_M #0#1, 1, "N";
         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |SI enEmpresa = 0;
             |C_M #0#0, 1, "S";
             |C_M #0#1, 1, "S";
         |FINSI;

         |PARA nCampo = 2;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = 0;  |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasEmpresas;
     |SI #0Campo = 0;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = 0;  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 13;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO DesdeDni;
     |SI #0#19 = "            ";
         #0#20 = "zzzzzzzzzzzz";  |C_M #0#20,1,"N"; |PINTA #0#20;
         |PARA nCampo = 21;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |SINO;
         |C_M #0#20,1,"S";
         |PARA nCampo = 21;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "N";
               #0nCampo = ""; |PINTA #0nCampo;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO NoMasDni;
     |SI #0Campo = "            ";
         |PARA nCampo = Campo + 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               #0nCampo = "";  |C_M #0nCampo, 1, "N";
         |SIGUE;
     |SINO;
         |PARA nCampo = Campo + 1;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
               |C_M #0nCampo, 1, "S";
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO ENominas;
/*
     aAlfa1 = "S";
     |SI #0#35 = "N";
         aAlfa1 = "N";
         #0#33 = 0; |PINTA #0#33;
         #0#34 = 0; |PINTA #0#34;
     |FINSI;

     |C_M #0#33, 1, aAlfa1;
     |C_M #0#34, 1, aAlfa1;
*/
|FPRC;

|| /////////////////////// //////////////////////////////////////////////////
|PROCESO InformePDF;
   nSwError = 0;

   aIP = ""; |IP_REMOTO aIP;
   aContiene = "";
   |ESPECIFICA "RBASS", aContiene;
   aAlfa = aContiene1;
   aAlfa = aAlfa - "\";
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa = aAlfa % nCalc;
   |SINO;
      aAlfa = aAlfa - "/";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99;
         aAlfa = aAlfa % nCalc;
      |FINSI;
   |FINSI;

   aAlfa = eaPathTemporal;
   aNombrePDF = (("00" + enOrMvo) % - 102) + aNombrePDF;

   |SI aIP ! "";
       |RMKDIR aAlfa;
   |SINO;
       |MKDIR aAlfa;
   |FINSI;

   Impresora = "CrystalReport;" + aAlfa + aNombrePDF;
   |IMPRE -1;
   |SI FSalida = 0;
       |INFOR informe;
       |SI FSalida ! 0;
          || |SI nSwMen = 0; |MENAV "     Error en informe."; |FINSI;
          nSwError = 1;
       |FINSI;
   |FINSI;
   enHayInforme = 1;
|FPRC;

|| /////////////////////// //////////////////////////////////////////////////
|| /////////////////////// PROCESOS DE INFORMES \\\\\\\\\\\\\\\\\\\\\
|PROCESO TotalNif;
    || ... enSwLinea=4; |PRINT;
|FPRC;

|PROCESO LeeEmpresa;
     #23#2 = "";
     #23#3 = "";
     #1#0 = nCliente;
     |LEE 001#1=;
     |SI FSalida = 0;
         #23#2 = #1#1;
         #23#3 = #1#3;
     |FINSI;
     #23#0 = nCliente;
|FPRC;

|PROCESO LeeNif;
     |PDEFECTO #23, 4, 9;
     #103#0 = aNif;
     |LEE 001#103=;
     |SI FSalida = 0;
         #23#4 = #103#1;
     |FINSI;
     #23#1 = aNif;
|FPRC;

|PROCESO CargaCampos;
     |SI #23#0 ! nCliente; |O nSw = 0;
         |HAZ LeeEmpresa;
     |FINSI;
     |SI #23#1 ! aNif; |O nSw = 0;
         |HAZ LeeNif;
     |FINSI;
|FPRC;

|PROCESO Linea0_18;
     |DDEFECTO #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = #17#2;
     #18#3 = 00;
     #18#4 = "01.01.0000";
|FPRC;

|PROCESO Imprime1;
   |PRINT; enSwLinea = 3;
|FPRC;

|DEFBUCLE dsam0018;
     #18#1;
     ;
     #17#0, #17#1, #17#2, 01;
     #17#0, #17#1, #17#2, 99;
     ;
     NULL, Imprime1;
|FIN;

|PROCESO Imprime0;

     |SI #0#18 ! "T";
         |SI #0#18 = "S"; |Y #17#4 = "01.01.0000"; |ACABA; |FINSI;
         |SI #0#18 = "N"; |Y #17#4 > "01.01.0000"; |ACABA; |FINSI;
     |FINSI;

     |SI #0#32 = 1;
         |SI #0#19 = "            ";
             nVale = 0;
             |PARA nCampo = 21; |SI nCampo [ 28; |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo ! "            ";
                       nVale = 1;
                       |SI #0nCampo = #17#1;
                           nVale = 2;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |SI nVale = 1; |ACABA; |FINSI;
     |FINSI;

     |SI #0#32 = 2;
         |SI #0#0 = "            ";
             nVale = 0;
             |PARA nCampo = 2; |SI nCampo [ 13; |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo ! 0;
                       nVale = 1;
                       |SI #0nCampo = #17#0;
                           nVale = 2;
                           |SAL;
                       |FINSI;
                   |FINSI;
             |SIGUE;
         |FINSI;
         |SI nVale = 1; |ACABA; |FINSI;
     |FINSI;

     |SI nSw = 0;
         enSwLinea = 0;
         nCliente = #17#0;
         aNif     = #17#1;
         |HAZ CargaCampos;
         nSw = 1;
     |FINSI;

     |SI #0#32 = 1;
         |SI aNif ! #17#1; |O nCliente ! #17#0;
             |HAZ TotalNif;
             aNif  = #17#1;
             |HAZ LeeNif;
             enSwLinea = 0;
         |FINSI;
         |SI nCliente ! #17#0;
             |PIEINF;
             nCliente = #17#0;
             aNif     = #17#1;
             |HAZ CargaCampos;
             enSwLinea = 0;
         |FINSI;
     |SINO;
         |SI aNif ! #17#1;
             |HAZ TotalNif;
             aNif     = #17#1;
             |HAZ CargaCampos;
             enSwLinea = 0;
         |FINSI;
         nCliente = #17#0; |HAZ LeeEmpresa;
     |FINSI;

     |HAZ Linea0_18;
     |SI #0#31 ! "S";
         |PRINT;
     |SINO;
         enSwLinea = 2;
         |BUCLE dsam0018;
         |SI enSwLinea = 3;
             |HAZ Linea0_18;
             || ... enSwLinea= 5; |PRINT;
         |SINO;
             |HAZ Linea0_18;
             |PRINT;
         |FINSI;
     |FINSI;
     enSwLinea = 1;
     #23#5 = #23#5 + #17#8;
     #23#6 = #23#6 + #17#9;
     #23#7 = #23#7 + #17#10;
|FPRC;

|DEFBUCLE dsam0017_Clave1;
     #17#1;
     3,13,5;
     nDCliente, aDNif, 01, fDFecEmb, aDTEmbargo, #0#29;
     nHCliente, aHNif, 99, fHFecEmb, aHTEmbargo, #0#30;
     ;
     NULL, Imprime0;
|FIN;

|DEFBUCLE dsam0017_Clave2;
     #17#2;
     13,5;
     aDNif, fDFecEmb, nDCliente, 01, aDTEmbargo, #0#29;
     aHNif, fHFecEmb, nHCliente, 99, aHTEmbargo, #0#30;
     ;
     NULL, Imprime0;
|FIN;

|PROCESO Tipo3;  |TIPO 3;

     nDTEmbargo = 0;  || #0#33;
     nHTEmbargo = 9;  || #0#34;
     aDTEmbargo = " ";
     aHTEmbargo = "z";
     |SI #0#35 ! "T";
         aDTEmbargo = #0#35;
         aHTEmbargo = #0#35;
     |FINSI;

     fDFecEmb   = #0#14;
     fHFecEmb   = #0#15;

     informe =  "dsay0019";
     |SI #0#32 = 2; informe = "dsay1019"; |FINSI;

     |SI enSwMvo ! 2;
         Impresora = "CrystalReport";
         |IMPRE -1;
         |SI FSalida ! 0;
             |MENAV "0000Error en Impresora Crystal";
             |ACABA;
         |FINSI;
         || ... |SI Impresora ! "CrystalReport"; informe = "s" + informe % 208; |FINSI;

         |INFOR informe;
         |SI FSalida ! 0;
             |MENAV "0000Error en informe";
             |FINIMP;
             |ACABA;
         |FINSI;
     |SINO;
          aNombrePDF = "Embargos.pdf";
          |HAZ InformePDF;
          |SI nSwError = 1; |ACABA; |FINSI;
     |FINSI;

     nSw      = 0;
     nCliente = 0;
     aNif     = "";
     |ABRE #1;
     |ABRE #103;
     |SI #0#32 = 1;   || por Empresa
         aDNif = #0#19;
         aHNif = #0#20;
         |SI #0#0 ! 0;
             nDCliente = #0#0;
             nHCliente = #0#1;
             |BUCLE dsam0017_Clave1;
         |SINO;
             |PARA nPara1 = 2;  |SI nPara1 [ 13;  |HACIENDO nPara1 = nPara1 + 1;
                   |SI #0nPara1 ! 0;
                       nDCliente = #0nPara1;
                       nHCliente = #0nPara1;
                       |BUCLE dsam0017_Clave1;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |SINO;
         nDCliente = #0#0;
         nHCliente = #0#1;
         nSelec = 1;
         |SI #0#19 = "            ";
             nSelec = 0;
             |PARA nCampo = 21; |SI nCampo [ 28; |HACIENDO nCampo = nCampo + 1;
                   |SI #0nCampo ! "            ";
                       nSelec = 2;
                       |SAL;
                   |FINSI;
             |SIGUE;
             |SI nSelec = 0; nSelec = 1; |FINSI;
         |FINSI;
         |SI nSelec = 1;
             aDNif = #0#19;
             aHNif = #0#20;
             |BUCLE dsam0017_Clave2;
         |SINO;
             |PARA nPara1 = 21;  |SI nPara1 [ 28;  |HACIENDO nPara1 = nPara1 + 1;
                   |SI #0nPara1 ! 0;
                       aDNif = #0nPara1;
                       aHNif = #0nPara1;
                       |BUCLE dsam0017_Clave2;
                   |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;
     |CIERRA #103;
     |CIERRA #1;

     |SI nSw = 0;
         |SI aParam ! ""; |Y enSwMvo = 0;
             |MENAV "     Seleccion Vacia.";
         |FINSI;
     |SINO;
         |SI enSwLinea = 1;
             |HAZ TotalNif;
         |FINSI;
         |PIEINF;
     |FINSI;
     |FININF;
     |FINIMP;

|FPRC;


|PROGRAMA;
      aParam = PARAMETRO; |QBF aParam;

      |SI enSwMvo = 2;
          |HAZ eLosInfBasica;
          |DDEFECTO #0;
          #0#0  = enEmprM;
          #0#1  = enEmprM;
          #0#16 = efFecLeg;
          |PARA nPara1 = 18; |SI nPara1 [ 32; |HACIENDO nPara1 = nPara1 + 1;
                nPara2 = nPara1 + 103;
                #0nPara1 = #dsinfcoc#nPara2#;
          |SIGUE;
          #0#35 = #dsinfcoc#136;

          |HAZ Tipo3;
          |ACABA;
      |FINSI;

      |SI aParam = "";
          |CLS;
          |MANTE #0;
      |SINO;
          |DDEFECTO #0;

          #0#0  = enDCliente;
          #0#1  = enHCliente;
          #0#33 = enDTEmbargo;
          #0#34 = enHTEmbargo;
          #0#14 = efDFecEmb;
          #0#15 = efHFecEmb;
          #0#19 = eaDNif;
          #0#20 = eaHNif;
          |SI eaDetalle ! ""; #0#31 = eaDetalle; |FINSI;
          |SI eaOrdAgru ! ""; #0#32 = eaOrdAgru; |FINSI;
          |HAZ Tipo3;
      |FINSI;
|FPRO;
