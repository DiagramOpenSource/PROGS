ç|FICHEROS;
     :/integral/def/dsam0000;
     :/integral/def/dsaw0003,MANTE;
     :/integral/def/dsam0003;
     :/integral/def/dsam0116;
     :/integral/def/dsam0117;

     :/integral/def/dsam0123;
     :/integral/def/dsam0124;

     dsaw0035@;
|FIN;

|VARIABLES;
     aBase       = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aMas        = "";
     aID         = "";

     nID         = 0;
     nNume       = 0;
     nFSalida    = 0;
     nBanco      = 0;

     nHandle     = 0;
     nSw         = 0;
     nCalc       = 0;
     aChar       = "";
     aCadena     = "";
     aEmpres     = "";
     aCuenta     = "";
     aPais       = "";

     {10} aPopup = "";

     &eaEntidad  = "";
     &eaSucursal = "";
     &eaCuenta   = "";
     &eaDC       = "";
     &eaCta      = "";
     &eaPais     = "";
     &eaIBAN     = "";
     &eaIBANant  = "";

     &eaNuevo1   = "";
     &eaNuevo2   = "";
     nSwC        = 0;

     &eaM22Prog  = "";
     &enM22Clie  = 0;
     &enM22MoFa  = 0;
     &eaM22MoFa  = "";
     &enM22Inkey = 0;
     &enM22Modo  = 0;
|FIN;

|INCLUYE i_varcon;

|PROCESO GrabaCorreoW3;
     aAlfa1 = #dsam0000#1;  |QBF aAlfa1;
     |SI aAlfa1 ! "";
         |ABRE #dsam0123;
         #dsam0123#0 = #dsam0000#1;
         |LEE 101#dsam0123.=;
         |SI FSalida ! 0;
             #dsam0123#0 = #dsam0000#1;
             #dsam0123#1 = #dsam0000#27;
             #dsam0123#2 = #dsam0000#28;
             |GRABA 020#dsam0123.n;
         |SINO;
             #dsam0123#1 = #dsam0000#27;
             #dsam0123#2 = #dsam0000#28;
             |GRABA 020#dsam0123.a;
         |FINSI;
         |LIBERA #dsam0123;
         |CIERRA #dsam0123;

         |ABRE #dsam0124;
         #dsam0124#0 = #dsam0000#1;
         #dsam0124#1 = 1;
         |LEE 001#dsam0124.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsam0124;
             #dsam0124#0 = #dsam0000#1; #dsam0124#1 = 1; #dsam0124#2 = "CORREO PRINCIPAL  "; #dsam0124#3 = #dsam0000#71;
             |GRABA 040#dsam0124.n;
         |FINSI;
         |CIERRA #dsam0124;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja124;
     #dsam0124#0 = #dsam0000#1;
     #dsam0124#1 = 01;
|FRUT;

|RUTINA ClaveAlta124;
     #dsam0124#0 = #dsam0000#1;
     #dsam0124#1 = 99;
|FRUT;

|PROCESO ConsultaCorreo;
     |SI FSalida = 10;
         |HAZ GrabaCorreoW3;
         #dsaw0003#16 = "";
         |PUSHV 0501 2380;
         |ENTLINEAL #1#dsam0124, -2, 2, 22, 1, ClaveBaja124, ClaveAlta124;
         |POPV;
     |FINSI;

     aAlfa = #dsaw0003#16; |QBF aAlfa;
     |ABRE #dsam0124;
     #dsam0124#0 = #dsam0000#1;
     #dsam0124#1 = 1;
     |LEE 141#dsam0124.=;
     |SI FSalida = 0;
         |SI aAlfa = "";
             #dsaw0003#16 = #dsam0124#3; |PINTA #dsaw0003#16;
         |SINO;
             #dsam0124#3 = #dsaw0003#16;
             |GRABA 020#dsam0124.a;
         |FINSI;
     |SINO;
         #dsam0124#0 = #dsam0000#1;
         #dsam0124#1 = 1;
         #dsam0124#2 = "CORREO PRINCIPAL";
         #dsam0124#3 = #dsaw0003#16;
         |GRABA 020#dsam0124.n;
     |FINSI;
     |LIBERA #dsam0124;
     |CIERRA #dsam0124;
|FPRC;

|PROCESO CogeCuentaw3;  |TIPO 7;
     enSwSinMen = 1;
     |HAZ SituaMaestraI;
     enSwSinMen = 0;
     aAlfa = #dsaw0003#13;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     #dsaw0003#13 = #dsam0000#103;  |PINTA #dsaw0003#13;

     aAlfa = #dsaw0003#13;  |QBF aAlfa;
     |SI aAlfa ! "";  |ACABA;  |FINSI;

     |SI MaximoDigitos = 0; MaximoDigitos = 12; |FINSI;
     |SI MaximoDigitos < 7; MaximoDigitos = 7;  |FINSI;
     nNume   = MaximoDigitos - 7;
     aAlfa   = "0" * nNume;
     #dsaw0003#13 = "43" + aAlfa + (("00000" + #dsam0000#0) % -105);
     |PINTA #dsaw0003#13;
|FPRC;

|PROCESO ConsEntidad;  |TIPO 66;
     |DBASE aMas;  |QBF aMas;
     aMas = aMas + "def/dsaw0035.mas";
     |CARGA_DEF aMas, dsaw0035@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;
     |ABRE #dsaw0035@;
     |SELECT #4#dsaw0035@;
     #dsaw0035@#2 = #dsaw0003#2;
     #dsaw0035@#3 = #dsaw0003#3;
     #dsaw0035@#0 = #dsaw0003#0;
     |LEE 040#dsaw0035@.];
     |SI FSalida ! 0;
         |LEE 040#dsaw0035@.p;
     |FINSI;
     |CONSULTA_CLAVE #4#dsaw0035@;
     nFSalida = FSalida;
     |CIERRA #dsaw0035@;
     |POPV;

     |SI nFSalida = 0;
         #dsaw0003#0  = #dsaw0035@#0;   |PINTA #dsaw0003#0;
         #dsaw0003#1  = #dsaw0035@#1;   |PINTA #dsaw0003#1;
         #dsaw0003#2  = #dsaw0035@#2;   |PINTA #dsaw0003#2;
         #dsaw0003#3  = #dsaw0035@#3;   |PINTA #dsaw0003#3;
         #dsaw0003#17 = #dsaw0035@#5;   |PINTA #dsaw0003#17;
     |FINSI;

     |DESCARGA_DEF #dsaw0035@;
|FPRC;

|PROCESO SinBanco;
     enM22Inkey = FSalida;

     |C_M #dsaw0003#1,  1, "S";
     |C_M #dsaw0003#3,  1, "S";
     |C_M #dsaw0003#17, 1, "S";
     |C_M #dsaw0003#4,  1, "S";
     |C_M #dsaw0003#5,  1, "S";

     |SI #dsaw0003#2 = "    ";
                                #dsaw0003#0  = 0;   |PINTA #dsaw0003#0;
         |C_M #dsaw0003#1,  1, "N";  #dsaw0003#1  = "";  |PINTA #dsaw0003#1;
         |C_M #dsaw0003#17, 1, "N";  #dsaw0003#17 = "";  |PINTA #dsaw0003#17;
         |C_M #dsaw0003#3,  1, "N";  #dsaw0003#3  = "";  |PINTA #dsaw0003#3;
         |C_M #dsaw0003#5,  1, "N";  #dsaw0003#5  = "";  |PINTA #dsaw0003#5;
         |C_M #dsaw0003#4,  1, "N";  #dsaw0003#4  = "";  |PINTA #dsaw0003#4;
     |FINSI;

     |SI enM22Inkey = 10;
         |SUB_EJECUTA_NP ":integral/dsam0022";
         |ERROR;
         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO ChequeaBanco;
     |SI #dsaw0003#2 = "    ";  |ACABA;  |FINSI;

     |ABRE #dsam0116;
     |SELECT #4#dsam0116;
     #dsam0116#2 = #dsaw0003#2;
     #dsam0116#3 = #dsaw0003#3;
     #dsam0116#0 = #dsaw0003#0;
     |LEE 040#dsam0116.];
     |SI FSalida ! 0;  |O #dsam0116#2 ! #dsaw0003#2;  |O  #dsam0116#3 ! #dsaw0003#3;
         #dsam0116#2 = #dsaw0003#2;
         #dsam0116#3 = #dsaw0003#3;
         #dsam0116#0 = 0;
         |LEE 040#dsam0116.];
         |SI FSalida ! 0;  |O #dsam0116#2 ! #dsaw0003#2;  |O  #dsam0116#3 ! #dsaw0003#3;
             |CONFI "0000SNo existe el Banco, Desea crearlo.";
             |SI FSalida ! 0;  |ERROR;  |ACABA;  |FINSI;

             |SELECT #1#dsam0116;
             |PARA nBanco = 1;  |SI nBanco [ 99999;  |HACIENDO nBanco = nBanco + 1;
                   #dsam0116#0 = nBanco;
                   |LEE 000#dsam0116.=;
                   |SI FSalida ! 0;  |SAL;  |FINSI;
             |SIGUE;

             |SI nBanco > 99999;
                 |MENAV "000 No permito mas Bancos.";
                 |ERROR;
                 |ACABA;
             |FINSI;

             |DDEFECTO #dsam0116;
             #dsam0116#0 = nBanco;
             #dsam0116#2 = #dsaw0003#2;
             #dsam0116#3 = #dsaw0003#3;
             |GRABA 020#dsam0116.b;

             |PUSHV 0501 2380;
             |PINPA #0#dsam0116;
             |PINDA #0#dsam0116;
             |ENDATOS #1#dsam0116;
             |SI FSalida = 0;
                 |GRABA 020#dsam0116.a;
                 |LIBERA #dsam0116;
             |SINO;
                 |BORRA 020#dsam0116.a;
                 |LIBERA #dsam0116;

                 |POPV;
                 |ERROR;
                 |ACABA;
             |FINSI;
             |POPV;
         |FINSI;
     |FINSI;

     #dsaw0003#0  = #dsam0116#0;   |PINTA #dsaw0003#0;
     #dsaw0003#1  = #dsam0116#1;   |PINTA #dsaw0003#1;
     #dsaw0003#17 = #dsam0116#5;   |PINTA #dsaw0003#17;
     |CIERRA #dsam0116;

     aAlfa = #dsaw0003#1;  |QBF aAlfa;
     |C_M #dsaw0003#1, 1, "N";
     |SI aAlfa = "";  |C_M #dsaw0003#1, 1, "S";  |FINSI;

     aAlfa = #dsaw0003#17;  |QBF aAlfa;
     |C_M #dsaw0003#17, 1, "N";
     |SI aAlfa = "";  |C_M #dsaw0003#17, 1, "S";  |FINSI;
|FPRC;

|PROCESO DC;
     eaEntidad  = #dsaw0003#2; |QBF eaEntidad;
     eaSucursal = #dsaw0003#3; |QBF eaSucursal;
     eaCuenta   = #dsaw0003#5; |QBF eaCuenta;
     eaDC       = "";

     |SI eaEntidad = "";  |Y eaSucursal = "";  |Y eaCuenta = "";
         |ACABA;
     |FINSI;

     |HAZ CalculoDC;

     |SI FSalida ! 10;
         |SI #dsaw0003#4 ! eaDC;
             aAlfa = "     El Digito de Control deberia ser " + eaDC;
             |MENAV aAlfa;
         |FINSI;
         |ACABA;
     |FINSI;

     #dsaw0003#4 = eaDC;
     |PINTA #dsaw0003#4;
|FPRC;

|PROCESO Tipo12w0003;  |TIPO 12;
     |SI #dsaw0003#2 ! "    ";
         |ABRE #dsam0116;
         |SELECT #4#dsam0116;
         #dsam0116#2 = #dsaw0003#2;
         #dsam0116#3 = #dsaw0003#3;
         #dsam0116#0 = #dsaw0003#0;
         |LEE 040#dsam0116.];
         |SI FSalida ! 0;  |O #dsam0116#2 ! #dsaw0003#2;  |O  #dsam0116#3 ! #dsaw0003#3;
             #dsam0116#2 = #dsaw0003#2;
             #dsam0116#3 = #dsaw0003#3;
             #dsam0116#0 = 0;
             |LEE 040#dsam0116.];
             |SI FSalida ! 0;  |O #dsam0116#2 ! #dsaw0003#2;  |O  #dsam0116#3 ! #dsaw0003#3;
                 |MENAV "0000No existe el Banco, revise el dato";
                 |ERROR;
                 |CIERRA #dsam0116;
                 |ACABA;
             |FINSI;
         |FINSI;
         |CIERRA #dsam0116;
     |FINSI;

     eaIBANant =  #dsaw0003#22;
     eaCta  = #dsaw0003#2 + #dsaw0003#3 + #dsaw0003#4 + #dsaw0003#5;
     eaPais = #dsaw0003#21;
     |HAZ CheqIBAN;

     aAlfa = #dsaw0003#22;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |MENAV "0000El codigo IBAN puede ser erroneo.";
     |FINSI;
|FPRC;

|PROCESO LeeBanRem; |TIPO 6;
     |ABRE #dsam0117;
     |DDEFECTO #dsam0117;
     #dsam0117#0 = #dsaw0003#8;
     |LEE 040#dsam0117.=;
     |CIERRA #dsam0117;
     #dsaw0003#9 = #dsam0117#1;  |PINTA #dsaw0003#9;
|FPRC;

|PROCESO LaCuenta;
     eaCtaCon = #dsaw0003#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntoI;
     #dsaw0003#Campo# = eaCtaCon;
     |PINTA #dsaw0003#Campo#;
|FPRC;

|PROCESO Tipo66C6;  |TIPO 66;
     aAlfa = "|C006WID";
     aID   = #dsaw0003#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 6;
     aPopup3  = "1.- Efectivo";
     aPopup4  = "2.- Adeudo en cuenta";
     aPopup5  = "3.- Domiciliacion";
     aPopup6  = "4.- Aplazamiento";
     aPopup7  = "5.- Aplazamiento + Ingreso";
     aPopup8  = "6.- Cuenta corriente tributaria (Ingreso y Devolucion)";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 101;  #dsaw0003#Campo# = aAlfa;
     |FINSI;
     |PINTA #dsaw0003#Campo#;
|FPRC;

|PROCESO PintaPago;
   |ATRI I;
   |SI #dsaw0003#25 = "R";
      |PINTA 1769, "Recurrente";
   |SINO;
      |PINTA 1769, "Unico     ";
   |FINSI;
   |ATRI N;
|FPRC;

|PROCESO VerSwC_w3; |TIPO 0;
   aAlfa = Contenido;
   |SI aAlfa ! #dsaw0003#Campo#;
       nSwC = 1;
   |FINSI;
|FPRC;

|PROCESO HayDatosPers;
    aAlfa1 = #dsaw0003#2 + #dsaw0003#3 + #dsaw0003#4 + #dsaw0003#5;

    |ABRE #dsam0003;
    #dsam0003#0 = #dsam0000#0;
    |LEE 141#dsam0003.=;
    |SI FSalida = 0;
        |SI aAlfa1 ! #dsam0003#53;
            |CONFI "0000SModificar Cuenta Declarante en Datos Personales del Cliente";
            |SI FSalida = 0;
                #dsam0003#53 = aAlfa1;
                |GRABA 020#dsam0003.a;
            |FINSI;
        |FINSI;
    |FINSI;
    |LIBERA #dsam0003;
    |CIERRA #dsam0003;
|FPRC;

|PROCESO Tipo7IBAN_Fw3;  |TIPO 7;
     aAlfa = #dsaw0003#22;   |QBF aAlfa;

     |SI aAlfa ! ""; |Y nSwC = 0;  |ACABA;  |FINSI;

     |SI nSwC = 1;
         |SI aAlfa ! "";
             |CONFI "0000NSe han modificado los datos de la Cuenta Corriente. Recalcular el IBAN?";
             |SI FSalida ! 0; nSwC = 0; |FINSI;
         |FINSI;
         |HAZ HayDatosPers;
         |SI nSwC = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     eaIBANant = "";
     eaCta  = #dsaw0003#2 + #dsaw0003#3 + #dsaw0003#4 + #dsaw0003#5;
     eaPais = #dsaw0003#21;
     |HAZ CalcuIBAN;

     #dsaw0003#22 = eaIBAN;
     |PINTA #dsaw0003#22;
     nSwC = 0;
|FPRC;

|PROCESO Tipo0IBAN_Fw3;  |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     eaIBANant = #dsaw0003#22;
     eaCta     = #dsaw0003#2 + #dsaw0003#3 + #dsaw0003#4 + #dsaw0003#5;
     eaPais    = #dsaw0003#21;
     |HAZ CheqIBAN;

     aAlfa = #dsaw0003#22;    |QBF aAlfa;
     |SI aAlfa ! eaIBAN;
         |SI aAlfa = "";
             #dsaw0003#22 = eaIBAN;
             |PINTA #dsaw0003#22;
         |SINO;
             |CONFI "0000SEl codigo IBAN puede ser erroneo, quiere calcularlo.";
             |SI FSalida = 0;
                 #dsaw0003#22 = eaIBAN;
                 |PINTA #dsaw0003#22;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;
