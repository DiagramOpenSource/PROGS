|FICHEROS;
     dsay0002 #0;
     dsam0013 #13;
     dsam0053 #53;
     dsaw0019 #99,MANTE;
|FIN;

|VARIABLES;
     nFecha   = 0;
     nSwGraba = 0;

     aFichero = "";
     aQueDia  = "";
     aAlfa    = "";

     fFecha   = @;

     &vacio37 = "                                                  ";
|FIN;

|PROCESO ImprimeAviso;
     |PRINT;
|FPRC;

|DEFBUCLE dsaw0019I;
     #99#1;
     15;
     "00.00.0000", 00, 00, 00000, "00.00.0000", 00, 00, 00, "N";
     "31.12.9999", 99, 99, 99999, "31.12.2999", 99, 99, 99, "N";
     ;
     NULL, ImprimeAviso;
|FIN;

|PROCESO Tipo11W001;  |TIPO 11;
     |SI FSalida ! 10;  |Y FSalida ! 11;  |ACABA; |FINSI;

     |SI FSalida = 10;
         |LEE 101#99=;

         |SI #99#15 = "S";
             #99#15 = "N";
         |SINO;
             #99#15 = "S";
         |FINSI;
         |PINTA #99#15;

         |GRABA 020#99a;
         |LIBERA #99;
     |FINSI;

     |SI FSalida = 11;
         |SALVA_DATOS #99;
         |IMPRE 0;
         |SI FSalida = 0;
             |INFOR "dsay0002";
             |SI FSalida = 0;
                 |BUCLE dsaw0019I;
                 |PIEINF;
                 |FININF;
             |FINSI;
             |FINIMP;
         |FINSI;
         |REPON_DATOS #99;
         |LEE 101#99=;
     |FINSI;

     |ERROR;
|FPRC;

|PROCESO GrabaTempo;
                              || -T- Todos los Dias

     fFecha  = #0#0 % 1;
     aQueDia = fFecha % 11;  |QBT aQueDia;  aQueDia = aQueDia > aQueDia;

     |SI #53#18 = "0";         || Solo el Dia del Aviso
         |SI #53#6 > #0#0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #53#18 = "2";
         nFecha  = #53#6 - #0#0;
         |SI nFecha > 14;  |ACABA;  |FINSI;
         |SI nFecha < 0;   |ACABA;  |FINSI;
     |FINSI;

     |SI #53#18 = "1";
         nFecha  = #53#6 - #0#0;
         |SI nFecha > 7;   |ACABA;  |FINSI;
         |SI nFecha < 0;   |ACABA;  |FINSI;
     |FINSI;

     |SI #53#18 = "L";  aAlfa = "LUNES";      |FINSI;
     |SI #53#18 = "M";  aAlfa = "MARTES";     |FINSI;
     |SI #53#18 = "X";  aAlfa = "MIERCOLES";  |FINSI;
     |SI #53#18 = "J";  aAlfa = "JUEVES";     |FINSI;
     |SI #53#18 = "V";  aAlfa = "VIERNES";    |FINSI;
     |SI #53#18 = "S";  aAlfa = "SABADO";     |FINSI;
     |SI #53#18 = "D";  aAlfa = "DOMINGO";    |FINSI;

     |SI #53#18 ! "0";  |Y #53#18 ! "T"; |Y #53#18 ! "1"; |Y #53#18 ! "2";
         |SI aQueDia ! aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nSwGraba = 1;

     #99#15 = "N";
     |SI #53#6 < #0#0;  #99#15 = "S";  |FINSI;

     #99#0  = #53#6;
     #99#1  = #53#7;
     #99#2  = #53#8;
     #99#3  = #53#18;
     #99#4  = #53#1;
     #99#5  = #53#2;
     #99#6  = #53#3;
     #99#7  = #53#4;
     #99#8  = #53#0;
     #99#9  = #53#11;
     #99#10 = #53#12;
     #99#11 = #53#13;
     #99#12 = #53#14;
     #99#13 = #53#15;
     #99#14 = #53#16;
     #99#16 = #53#19;
     #99#17 = #53#20;

     |DDEFECTO #13;
     #13#0 = #99#17;
     |LEE 001#13=;
     #99#18 = #13#1;

     |GRABA 020#99n;
|FPRC;

|DEFBUCLE dsam0053;
     #53#3;
     ;
     #0#1, "N";
     #0#1, "N";
     ;
     NULL, GrabaTempo;
|FIN;

|RUTINA ClaveBaja;
     #99#0  = "01.01.0000";
     #99#1  = 00;
     #99#2  = 00;
     #99#8  = 0;
     #99#4  = "01.01.0000";
     #99#5  = 00;
     #99#6  = 00;
     #99#7  = 00;
|FRUT;

|RUTINA ClaveAlta;
     #99#0  = "3.12.2999";
     #99#1  = 99;
     #99#2  = 99;
     #99#8  = 99999;
     #99#4  = "31.12.2999";
     #99#5  = 99;
     #99#6  = 99;
     #99#7  = 99;
|FRUT;

|PROCESO GrabaAviso;
     #53#0  = #99#8;
     #53#1  = #99#4;
     #53#2  = #99#5;
     #53#3  = #99#6;
     #53#4  = #99#7;
     |LEE 101#53=;
     |SI FSalida = 0;
         #53#17 = "S";
         |GRABA 020#53a;
         |LIBERA #53;
     |FINSI;
|FPRC;

|DEFBUCLE dsaw0019G;
     #99#1;
     15;
     "00.00.0000", 00, 00, 00000, "00.00.0000", 00, 00, 00, "S";
     "31.12.9999", 99, 99, 99999, "31.12.2999", 99, 99, 99, "S";
     ;
     NULL, GrabaAviso;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     aFichero = (Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     nSwGraba = 0;
     |ABRE #13;
     |ABRE #99;
     |BUCLE dsam0053;
     |CIERRA #99;
     |CIERRA #13;

     |SI nSwGraba = 0;
         |MENAV "       Seleccion Vacia.";
         |ACABA;
     |FINSI;

     |ENTLINEAL #1#99, -3, 4, 21, 0, ClaveBaja, ClaveAlta;

     |ABRE #53;
     |BUCLE dsaw0019G;
     |CIERRA #53;

     |DELINDEX #99;
|FPRC;
