|FICHEROS;
    dsay0026;

    dsam0000;
    dsam0026;

    dsam0027;
    dsam0028;
    dsam0029;
    dsam0030;
    dsat0008;
    dsat0009;

    dsat0011;
    dsat0012;
|FIN;

|VARIABLES;
     aFichero  = "";
     aParam    = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nNume1    = 0;

     nSw         = 0;
     fFecha      = @;
     fDFecha     = @;
     fHFecha     = @;
     aDEstado    = "";
     aHEstado    = "";
     nDEmpresa   = 0;
     nHEmpresa   = 0;
     aDTTarjeta  = "";
     aHTTarjeta  = "";
     aDMatricula = "";
     aHMatricula = "";

     nEmpresa  = 0;
     aEmpresa  = "";
     nAlgun    = 0;
     nHay      = 0;
     aBlancs   = "";
     aZetas    = "";

     nTipoInf  = 0;
     informe     = "";
     inform1     = "dsay0026";
     inform2     = "dsay1026";

     &efFecha1 = @;
     &efFecha2 = @;
     &eSwLinea = 0;

     &eaFec1   = "";
     &eaFec2   = "";
     &eaFec3   = "";
     &eaFec4   = "";
     &eaFec5   = "";
     &eaFec6   = "";
     &eaFec7   = "";

     &eaEmpresa = "";
     &eaNomEmp  = "";
     &eaTelEmp  = "";
     &eaNifEmp  = "";
     &eaMail    = "";
|FIN;

|INCLUYE i_varfun;

|CALCULO HTarjeta; |TIPO 0;
    |SI #dsay0026#4 < #dsay0026#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsay0026#1 < #dsay0026#0;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO CampoFecha;
   eaFec1 = "";
   eaFec2 = "";
   eaFec3 = "";
   eaFec4 = "";
   eaFec5 = "";
   eaFec6 = "";
   eaFec7 = "";
   |SI #dsat0011#9  > "01.01.0000"; eaFec1 = #dsat0011#9;  |FINSI;
   |SI #dsat0011#10 > "01.01.0000"; eaFec2 = #dsat0011#10; |FINSI;
   |SI #dsat0011#11 > "01.01.0000"; eaFec3 = #dsat0011#11; |FINSI;
   |SI #dsat0011#12 > "01.01.0000"; eaFec4 = #dsat0011#12; |FINSI;
   |SI #dsat0011#14 > "01.01.0000"; eaFec5 = #dsat0011#14; |FINSI;
   |SI #dsat0011#16 > "01.01.0000"; eaFec6 = #dsat0011#16; |FINSI;
   |SI #dsat0011#17 > "01.01.0000"; eaFec7 = #dsat0011#17; |FINSI;
|FPRC;

|PROCESO LeeDsat0011;
   |HAZ CampoFecha;
   |PRINT;
   eSwLinea = 1;
   nHay     = 1;
|FPRC;

|DEFBUCLE LeeDsat0011;
   #dsat0011#1;
   ;
   #dsat0012#0, #dsat0012#1, 0000000000;
   #dsat0012#0, #dsat0012#1, 9999999999;
   e;
   NULL, LeeDsat0011;
|FIN;

|PROCESO ImpDsat0012;
   |SI nSw = 0;
       enEmpresa = #dsat0012#0;
       eaEmpresa = ("00000" + enEmpresa) % -105;
       eaNomEmp  = #dsat0012#4;
       eaTelEmp  = #dsat0012#13;
       eaNifEmp  = #dsat0012#12;
       eaMail    = #dsat0012#14;
       eaMatricula = #dsat0012#1;
       eSwLinea = 0;
   |FINSI;
   |SI #dsay0026#6 = "C"; |Y enEmpresa ! #dsat0012#0;
       |SI nSw = 1;
           |PIEINF;
       |FINSI;
       enEmpresa   = #dsat0012#0;
       eaEmpresa   = ("00000" + enEmpresa) % -105;
       eaNomEmp    = #dsat0012#4;
       eaTelEmp    = #dsat0012#13;
       eaNifEmp    = #dsat0012#12;
       eaMail      = #dsat0012#14;
       eaMatricula = #dsat0012#1;
       eSwLinea    = 0;
   |FINSI;
   |SI #dsay0026#6 = "N"; |Y aEmpresa ! #dsat0012#4;
       |SI nSw = 1;
           |PIEINF;
       |FINSI;
        enEmpresa   = #dsat0012#0;
        eaEmpresa   = ("00000" + enEmpresa) % -105;
        eaNomEmp    = #dsat0012#4;
        eaTelEmp    = #dsat0012#13;
        eaNifEmp    = #dsat0012#12;
        eaMail      = #dsat0012#14;
        eaMatricula = #dsat0012#1;
        eSwLinea = 0;
   |FINSI;
   |SI #dsay0026#6 = "M";
        enEmpresa    = #dsat0012#0;
        eaEmpresa   = ("00000" + enEmpresa) % -105;
        eaNomEmp    = #dsat0012#4;
        eaTelEmp    = #dsat0012#13;
        eaNifEmp    = #dsat0012#12;
        eaMatricula = #dsat0012#1;
        eSwLinea    = 0;
   |FINSI;

   |BUCLE LeeDsat0011;
   |SI eSwLinea = 1;
       eSwLinea = 2; |PRINT;
   |SINO;
       eSwLinea = 3; |PRINT;
       eSwLinea = 2; |PRINT;
   |FINSI;
   nSw = 1;
   eSwLinea = 0;
|FPRC;

|DEFBUCLE LeeDsat0012_M;
   #dsat0012#2;
   ;
   aDMatricula, nDEmpresa;
   aHMatricula, nHEmpresa;
   ;
   NULL, ImpDsat0012;
|FIN;

|DEFBUCLE LeeDsat0012_C;
   #dsat0012#1;
   ;
   nDEmpresa, aDMatricula;
   nHEmpresa, aHMatricula;
   ;
   NULL, ImpDsat0012;
|FIN;

|DEFBUCLE LeeDsat0012_N;
   #dsat0012#3;
   ;
   aBlancs, nDEmpresa, aDMatricula;
   aZetas,  nHEmpresa, aHMatricula;
   ;
   NULL, ImpDsat0012;
|FIN;

|PROCESO ImprimirDatos;
    aBlancs = " " * 40;
    aZetas  = "z" * 40;
    informe = inform1;
    |SI #dsay0026#6 = "M"; informe = inform2; |FINSI;

    |IMPRE 0;
    |SI FSalida ! 0;
        |MENAV "0000Proceso Interrumpido";
        |ACABA;
    |FINSI;
    |INFOR informe;
    |SI FSalida ! 0;
        |MENAV "0000No existe informe. Proceso Interrumpido";
        |FINIMP;
        |ACABA;
    |FINSI;

    nSw         = 0;
    enEmpresa   = 0;
    nHay        = 0;
    eSwLinea    = 0;
    |SI #dsay0026#6 = "C"; |BUCLE LeeDsat0012_C; |FINSI;
    |SI #dsay0026#6 = "N"; |BUCLE LeeDsat0012_N; |FINSI;
    |SI #dsay0026#6 = "M"; |BUCLE LeeDsat0012_M; |FINSI;
    |SI nHay ! 0;
        |PIEINF;
    |FINSI;
    |FININF;
    |FINIMP;
|FPRC;

|| *******************************************************************
|PROCESO dsam0030;
    |DDEFECTO #dsam0029;
    #dsam0029#0 = #dsam0030#0;
    #dsam0029#1 = #dsam0030#1;
    |LEE 041#dsam0029.=;

    aAlfa = "Archivado historico";
    nNume1 = nNume1 + 1;
    #dsat0011#0 = #dsam0026#0;
    #dsat0011#1 = #dsam0026#1;
    #dsat0011#2 = nNume1;
    |LEE 041#dsat0011.=;
    |SI FSalida ! 0;
        #dsat0011#0 = #dsam0026#0;
        #dsat0011#1 = #dsam0026#1;
        #dsat0011#2 = nNume1;
        |GRABA 020#dsat0011.c;
    |FINSI;
    #dsat0011#3 = #dsam0030#1;  ||numero expediente
    #dsat0011#5 = #dsam0030#6;
    #dsat0011#6 = #dsam0030#7;
    #dsat0011#7 = #dsam0030#9;
    #dsat0011#8 = #dsam0029#2;
    #dsat0011#9 = #dsam0029#9;
    #dsat0011#10 = #dsam0029#10;
    #dsat0011#11 = #dsam0029#11;
    #dsat0011#12 = #dsam0029#12;
    #dsat0011#13 = #dsam0029#28;
    #dsat0011#14 = #dsam0029#8;
    #dsat0011#15 = #dsam0029#24;
    #dsat0011#16 = #dsam0029#27;
    #dsat0011#4 = aAlfa;

    |GRABA 020#dsat0011.a;
|FPRC;

|DEFBUCLE dsam0030;
    #dsam0030#2;
    ;
    eaFun07, #dsam0026#0, #dsam0026#1, 00000001;
    eaFun07, #dsam0026#0, #dsam0026#1, 99999999;
    e;
    NULL, dsam0030;
|FIN;

|PROCESO dsam0028;
    |DDEFECTO #dsam0027;
    #dsam0027#0 = #dsam0028#0;
    #dsam0027#1 = #dsam0028#1;
    |LEE 041#dsam0027.=;

    aAlfa = "Aperturado";
    nNume1 = nNume1 + 1;
    #dsat0011#0 = #dsam0026#0;
    #dsat0011#1 = #dsam0026#1;
    #dsat0011#2 = nNume1;
    |LEE 041#dsat0011.=;
    |SI FSalida ! 0;
        #dsat0011#0 = #dsam0026#0;
        #dsat0011#1 = #dsam0026#1;
        #dsat0011#2 = nNume1;
        |GRABA 020#dsat0011.c;
    |FINSI;
    #dsat0011#3 = #dsam0028#1;  ||numero expediente
    #dsat0011#5 = #dsam0028#6;
    #dsat0011#6 = #dsam0028#7;
    #dsat0011#7 = #dsam0028#9;
    #dsat0011#8 = #dsam0027#2;
    #dsat0011#9 = #dsam0027#9;
    #dsat0011#10 = #dsam0027#10;
    #dsat0011#11 = #dsam0027#11;
    #dsat0011#12 = #dsam0027#12;
    #dsat0011#13 = #dsam0027#28;
    #dsat0011#14 = #dsam0027#8;
    #dsat0011#15 = #dsam0027#24;
    #dsat0011#16 = #dsam0027#27;
    |SI #dsam0027#10 > "01.01.0000"; aAlfa = "Presentado"; |FINSI;
    |SI #dsam0027#11 > "01.01.0000"; aAlfa = "Recogido";   |FINSI;
    |SI #dsam0027#12 > "01.01.0000"; aAlfa = "Entregado";  |FINSI;
    |SI #dsam0027#8  > "01.01.0000"; |Y #dsam0027#28 = "S";
                                     aAlfa = "Finalizado"; |FINSI;
    #dsat0011#4 = aAlfa;

    |GRABA 020#dsat0011.a;
|FPRC;

|DEFBUCLE dsam0028;
    #dsam0028#2;
    ;
    eaFun07, #dsam0026#0, #dsam0026#1, 00000001;
    eaFun07, #dsam0026#0, #dsam0026#1, 99999999;
    e;
    NULL, dsam0028;
|FIN;

|PROCESO dsat0009;

    |DDEFECTO #dsat0008;
    #dsat0008#0  = #dsat0009#0;
    #dsat0008#20 = #dsat0009#5;
    #dsat0008#21 = #dsat0009#6;
    |LEE 041#dsat0008.=;

    nNume1 = nNume1 + 1;
    #dsat0011#0 = #dsam0026#0;
    #dsat0011#1 = #dsam0026#1;
    #dsat0011#2 = nNume1;
    |LEE 041#dsat0011.=;
    |SI FSalida ! 0;
        #dsat0011#0 = #dsam0026#0;
        #dsat0011#1 = #dsam0026#1;
        #dsat0011#2 = nNume1;
        |GRABA 020#dsat0011.c;
    |FINSI;
    #dsat0011#3 = #dsat0008#9;  ||numero expediente
    #dsat0011#4 = "Pendiente Aperturar ";
    #dsat0011#5 = #dsat0008#20;
    #dsat0011#6 = #dsat0008#21;
    #dsat0011#7 = #dsat0009#8;
    #dsat0011#8 = #dsat0008#10;
    #dsat0011#9 = #dsat0008#11;
    #dsat0011#10 = #dsat0008#12;
    #dsat0011#11 = #dsat0008#13;
    #dsat0011#12 = #dsat0008#14;
    #dsat0011#13 = "P";
    #dsat0011#14 = "01.01.0000";
    #dsat0011#15 = "N";
    #dsat0011#16 = "01.01.0000";

    #dsat0011#17 = #dsat0008#22;
    #dsat0011#18 = #dsat0008#23;
    #dsat0011#19 = #dsat0008#24;
    #dsat0011#20 = #dsat0008#25;
    #dsat0011#21 = #dsat0008#26;
    |GRABA 020#dsat0011.a;
|FPRC;

|DEFBUCLE dsat0009;
    #dsat0009#3;
    ;
    #dsam0026#0, #dsam0026#1, 0000, 00;
    #dsam0026#0, #dsam0026#1, 9999, 99;
    e;
    NULL, dsat0009;
|FIN;

|PROCESO LeeDatosM026;
    |DDEFECTO #dsam0000;
    #dsam0000#0 = #dsam0026#0;
    |LEE 041#dsam0000.=;

    nHay = 1;
    #dsat0012#0 = #dsam0026#0;
    #dsat0012#1 = #dsam0026#1;
    |LEE 041#dsat0012.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0009;
        #dsat0012#0 = #dsam0026#0;
        #dsat0012#1 = #dsam0026#1;
        |PARA nPara1 = 2; |SI nPara1 [ 11; |HACIENDO nPara1 = nPara1 + 1;
              #dsat0012#nPara1# = #dsam0026#nPara1#;
        |SIGUE;
        #dsat0012#4 = #dsam0000#1;
        #dsat0012#12= #dsam0000#3;
        #dsat0012#13= #dsam0000#54;
        #dsat0012#14= #dsam0000#71;
        |GRABA 020#dsat0012.n;
    |FINSI;
    nAlgun = 1;
    nNume1 = 0;
    |ABRE #dsam0027;
    |BUCLE dsam0028;
    |CIERRA #dsam0027;

    |ABRE #dsam0029;
    |BUCLE dsam0030;
    |CIERRA #dsam0029;

    |ABRE #dsat0008;
    |BUCLE dsat0009;
    |CIERRA #dsat0008;
|FPRC;

|DEFBUCLE dsam0026;
   #dsam0026#1;
   3,8;
   nDEmpresa, aDMatricula, #dsay0026#3, aDEstado;
   nHEmpresa, aHMatricula, #dsay0026#4, aHEstado;
   e;
   NULL, LeeDatosM026;
|FIN;

|PROCESO ProcesoY026;

     aFichero = ("6b" + Usuario) % 108;
     |NOME_DAT #dsat0012#aFichero#;
     |DELINDEX #dsat0012;
     aFichero = ("6c" + Usuario) % 108;
     |NOME_DAT #dsat0011#aFichero#;
     |DELINDEX #dsat0011;

     nDEmpresa = #dsay0026#0;
     nHEmpresa = #dsay0026#1;
     aDTTarjeta= #dsay0026#3;
     aHTTarjeta= #dsay0026#4;
     aDEstado  = #dsay0026#5;
     aHEstado  = #dsay0026#5;
     |SI #dsay0026#5 = "T";
         aDEstado  = " ";
         aHEstado  = "z";
     |FINSI;
     aDMatricula = #dsay0026#2; |QBF aDMatricula;
     |SI aDMatricula = "";
         aDMatricula = "          ";
         aHMatricula = "zzzzzzzzzz";
     |SINO;
         aDMatricula = #dsay0026#2;
         aHMatricula = #dsay0026#2;
     |FINSI;

     |ABRE #dsat0011;
     |ABRE #dsat0012;
     |ABRE #dsam0000;
     nAlgun = 0;
     |BUCLE dsam0026;
     |CIERRA #dsam0000;
     |CIERRA #dsat0012;
     |CIERRA #dsat0011;

     |SI nAlgun = 1;
        || |ABRE #dsat0011; |CONSULTA_CLAVE #1#dsat0011; |CIERRA  #dsat0011;
        || |ABRE #dsat0012; |CONSULTA_CLAVE #1#dsat0012; |CIERRA  #dsat0012;
        |HAZ ImprimirDatos;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsat0011;
     |DELINDEX #dsat0012;
|FPRC;

|PROGRAMA;

    eaFun07 = "A";
    aParam = PARAMETRO; |QBF aParam;

    |SI aParam = "";
        |CLS;
        |CABEZA "Historial de Expedientes por Matricula";
    |FINSI;

    fFecha = ~;
    |ABRE #dsay0026;
    #dsay0026#8 = "A";
    |LEE 041#dsay0026.=;
    |SI FSalida ! 0;
        #dsay0026#8 = "A";
        |GRABA 020#dsay0026.b;
    |FINSI;

    #dsay0026#9 = fFecha;
    |SI aParam = "";
        |PINPA #0#dsay0026;
        |PINDA #0#dsay0026;
        |ENDATOS #2#dsay0026;
        |SI FSalida = 0;
            |GRABA 020#dsay0026.a;
            |LIBERA #dsay0026;
            |CIERRA #dsay0026;
            |HAZ ProcesoY026;
        |SINO;
            |LIBERA #dsay0026;
            |CIERRA #dsay0026;
        |FINSI;
    |SINO;
        |LIBERA #dsay0026;
        |CIERRA #dsay0026;
        |DDEFECTO #dsay0026;
        #dsay0026#0 = enEmpresa;
        #dsay0026#1 = enEmpresa;
        #dsay0026#2 = eaMatricula;
        #dsay0026#6 = "M";
        |HAZ ProcesoY026;
    |FINSI;
|FPRO;
