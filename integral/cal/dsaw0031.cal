|FICHEROS;
     dsam0004 #1;
     dsam0103 #103;
     dsaw0031 #917,MANTE;
     dsam0101 #10;
     dsaw0027 #939;
|FIN;

|VARIABLES;
     nCampo1   = 0;
     nCampo2   = 0;
     nCampo3   = 0;
     nTecla    = 0;

     aComa     = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     aApellido1 = "";
     aApellido2 = "";
     aNombre    = "";
     aNombreC   = "";
     aNif       = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
     &eaCadena  = "";
     &eaCadena1 = "";
     &eaCadena2 = "";
     &eaCadena3 = "";
|FIN;

|PROCESO VeriFecha;
     |SI #917Campo = "01.01.0000";  |ACABA;  |FINSI;

     |SI #917Campo ] "01.01.2000";
         aAlfa = "     Fecha Incorrecta. Cambie los dos primeros digitos del A" + &209 + "O (20) por (19)";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo12w31;  |TIPO 12;
     || Este proceso sirve para que el endatos que se hace en el
     || calculo dsam0000 no pregunte Correcto S/N
     || POR LO TANTO NO LO QUITEIS !!!!!!
|FPRC;

|PROCESO Minusvalido;
     nCampo1 = Campo + 1;
     |C_M #917nCampo1, 1, "S";
     |SI #917Campo = 0;
         |C_M #917nCampo1, 1, "N";
         #917nCampo1 = "N";  |PINTA #917nCampo1;
     |FINSI;
|FPRC;

|PROCESO Convivencia;
     |C_M #917#60, 1, "S";
     |SI #917#6 ! "L"; |Y #917#6 ! "S";
         #917#60 = " ";  |PINTA #917#60;
         |C_M #917#60, 1, "N";
     |FINSI;
|FPRC;

|PROCESO HayConyuge;
     |PARA nCampo1 = 35;  |SI nCampo1 [ 52;  |HACIENDO nCampo1 = nCampo1 + 1;
           |C_M #917nCampo1, 1, "S";
     |SIGUE;

     |C_M #917#58, 1, "S";
     |C_M #917#62, 1, "S";
     |C_M #917#64, 1, "S";
     |C_M #917#39, 1, "N";
     |SI #917#6 ! "C";
         |PARA nCampo1 = 35;  |SI nCampo1 [ 52;  |HACIENDO nCampo1 = nCampo1 + 1;
               |C_M #917nCampo1, 1, "N";
         |SIGUE;
         |C_M #917#58, 1, "N";
         |C_M #917#62, 1, "N";
         |C_M #917#64, 1, "N";
         |PDEFECTO #917, 35, 53;
         |PDEFECTO #917, 54, 55;
         |PDEFECTO #917, 62, 63;
         |PDEFECTO #917, 64, 65;
     |FINSI;
|FPRC;

|PROCESO PonSexo;
     |SI #917#63 = Contenido;  |ACABA;  |FINSI;
     |SI #917#6  ! "C";        |ACABA;  |FINSI;

     |SI #917#63 = "V";  #917#64 = "M";  |FINSI;
     |SI #917#63 = "M";  #917#64 = "V";  |FINSI;
|FPRC;

|PROCESO Autonomia;
     nTecla = FSalida;
     nCampo1   = Campo - 1;
     nCampo2   = Campo;
     |SI Campo = 21;  nCampo3 = 11;  |FINSI;
     |SI Campo = 51;  nCampo3 = 43;  |FINSI;

     |ABRE #10;
     #10#0 = #917nCampo1;
     #10#1 = #917nCampo2;
     |LEE 040#10=;
     |SI FSalida ! 0;  |DDEFECTO #10;  |FINSI;
     |CIERRA #10;

     |SI #917#59 = "S";
        #917nCampo3 = "20";
     |SINO;
        #917nCampo3 = #10#4;
     |FINSI;

     FSalida = nTecla;
|FPRC;

|PROCESO Tipo6;  |TIPO 6;
     aNif = #917#35;
|FPRC;

|PROCESO NombreEntero;
     |SI aNif ! #917#35;
         #917#36 = "";
         #917#37 = "";
         #917#38 = "";
     |FINSI;

     aApellido1 = #917#36;  |QBT aApellido1;
     aApellido2 = #917#37;  |QBT aApellido2;
     aNombre    = #917#38;  |QBT aNombre;
     aNombreC   = #917#39;  |QBT aNombreC;

     |SI aApellido1 = "";  |Y  aApellido2 = "";  |Y  aNombre    = ""; |Y  aNombreC   ! "";
         eaCadena = #917#39;
         |HAZ SeparaNombre;
         #917#36 = eaCadena1;  |PINTA #917#36;
         #917#37 = eaCadena2;  |PINTA #917#37;
         #917#38 = eaCadena3;  |PINTA #917#38;
         |ACABA;
     |FINSI;

     nCampo1   = Campo - 3;  aAlfa1 = #917nCampo1;  |QBF aAlfa1;
     nCampo1   = Campo - 2;  aAlfa2 = #917nCampo1;  |QBF aAlfa2;
     nCampo1   = Campo - 1;  aAlfa3 = #917nCampo1;  |QBF aAlfa3;
     |SI aAlfa1 ! "";  |O aAlfa2 ! "";  |O aAlfa3 ! "";
         aComa = ",";
     |SINO;
         aComa = "";
     |FINSI;

     aAlfa     = aAlfa1 + " " + aAlfa2 + aComa + " " + aAlfa3;
     #917Campo = aAlfa;
     |PINTA #917Campo;
|FPRC;

|PROCESO Envio;  |TIPO 7;
     |SI #917#14 ! #917#24;  |O #917#15 ! #917#25;  |O #917#16 ! #917#26;
      |O #917#17 ! #917#27;  |O #917#18 ! #917#28;  |O #917#19 ! #917#29;
      |O #917#20 ! #917#30;  |O #917#21 ! #917#31;  |O #917#22 ! #917#32;
         |CONFI "0000NLos Datos de Envio son los mismos que los Datos Fiscales";
         |SI FSalida = 0;
             #917#24  = #917#14;   |PINTA #917#24;
             #917#25  = #917#15;   |PINTA #917#25;
             #917#26  = #917#16;   |PINTA #917#26;
             #917#27  = #917#17;   |PINTA #917#27;
             #917#28  = #917#18;   |PINTA #917#28;
             #917#29  = #917#19;   |PINTA #917#29;
             #917#30  = #917#20;   |PINTA #917#30;
             #917#31  = #917#21;   |PINTA #917#31;
             #917#32  = #917#22;   |PINTA #917#32;
         |FINSI;
     |FINSI;

     |SI #917#6 ! "C";  |ACABA;  |FINSI;

     |SI #917#14 ! #917#44;  |O #917#15 ! #917#45;  |O #917#16 ! #917#46;
      |O #917#17 ! #917#47;  |O #917#18 ! #917#48;  |O #917#19 ! #917#49;
      |O #917#20 ! #917#50;  |O #917#21 ! #917#51;  |O #917#22 ! #917#52;
         |CONFI "0000NLa Direccion del Conyuge es la misma que la del Contribuyente";
         |SI FSalida = 0;
             #917#44  = #917#14;   |PINTA #917#44;
             #917#45  = #917#15;   |PINTA #917#45;
             #917#46  = #917#16;   |PINTA #917#46;
             #917#47  = #917#17;   |PINTA #917#47;
             #917#48  = #917#18;   |PINTA #917#48;
             #917#49  = #917#19;   |PINTA #917#49;
             #917#50  = #917#20;   |PINTA #917#50;
             #917#51  = #917#21;   |PINTA #917#51;
             #917#52  = #917#22;   |PINTA #917#52;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LetraNifPant17;  |TIPO 6;
     |SI FSalida = 10;
         eaVarDni  = #917Campo;
         enCalcCif = 1;
         |HAZ CalculoDNI;
         #917Campo = eaVarDni;
         |PINTA #917Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #917Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #917Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #917Campo = eaVarDni;  |PINTA #917Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CtasCtes;
     |SI Campo = 54;  |Y #917#6 ! "C";  |ACABA;  |FINSI;

     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI Campo ] 54;
         aAlfa = #917Campo;  |QBF aAlfa;
         |SI aAlfa = "";
             #917Campo = #917#53;
         |FINSI;
     |FINSI;

     #939#0 = #917Campo % 104;
     #939#1 = #917Campo % 504;
     #939#2 = #917Campo % 902;
     #939#3 = #917Campo % 1110;




     |PUSHV 0501 2380;
     |PINPA #0#939;

     |ATRI R;
     |SI Campo = 53;  |PINTA 1116, "            CUENTA CONTRIBUYENTE 1          ";  |FINSI;
     |SI Campo = 54;  |PINTA 1116, "            CUENTA CONTRIBUYENTE 2          ";  |FINSI;
     |SI Campo = 55;  |PINTA 1116, "               CUENTA CONJUNTA              ";  |FINSI;
     |ATRI r;

     |PINDA #0#939;
     |ENDATOS #1#939;
     |SI FSalida = 0;
         aAlfa     = #939#0 + #939#1 + #939#2 + #939#3;
         #917Campo = aAlfa;
     |FINSI;
     |POPV;
     |PINTA #917Campo;
|FPRC;

|RUTINA ClaveBaja1;
     #1#0 = #917#0;
     #1#1 = 1;
|FRUT;

|RUTINA ClaveAlta1;
     #1#0 = #917#0;
     #1#1 = 99;
|FRUT;

|PROCESO Tipo14Pant17; |TIPO 14;
     |ENTLINEAL #1#1, -2, 1, 18, 0, ClaveBaja1, ClaveAlta1;
|FPRC;

|PROCESO dsam0004w31;
     |SI #1#2 = "            ";  |ACABA;  |FINSI;

     #103#0 = #1#2;
     |LEE 101#103=;
     |SI FSalida ! 0;
         |DDEFECTO #103;
         #103#0  = #1#2;
         #103#1  = #1#3;
         #103#2  = #917#15;
         #103#3  = #917#16;
         #103#4  = #917#20;
         #103#5  = #917#21;
         #103#6  = #917#22;
         #103#8  = #917#12;
         #103#9  = #917#14;
         #103#10 = #917#18;
         #103#11 = #917#19;
         #103#16 = #917#17;
         |GRABA 020#103n;
         |LIBERA #103;
     |FINSI;
|FPRC;

|DEFBUCLE dsam0004w31;
     #1#1;
     ;
     #917#0,  1;
     #917#0, 99;
     ;
     NULL, dsam0004w31;
|FIN;

|PROCESO PonNif;  |TIPO 7;
     |ABRE #103;
     |SI #917#1 ! "            ";
         #103#0 = #917#1;
         |LEE 101#103=;
         |SI FSalida ! 0;
             |DDEFECTO #103;
             #103#0  = #917#1;
             #103#1  = #917#5;
             #103#2  = #917#15;
             #103#3  = #917#16;
             #103#4  = #917#20;
             #103#5  = #917#21;
             #103#6  = #917#22;
             #103#8  = #917#12;
             #103#9  = #917#14;
             #103#10 = #917#18;
             #103#11 = #917#19;
             #103#16 = #917#17;
             |GRABA 020#103n;
             |LIBERA #103;
         |FINSI;
     |FINSI;

     |SI #917#35 ! "            ";
         #103#0 = #917#35;
         |LEE 101#103=;
         |SI FSalida ! 0;
             |DDEFECTO #103;
             #103#0  = #917#35;
             #103#1  = #917#39;
             #103#2  = #917#45;
             #103#3  = #917#46;
             #103#4  = #917#50;
             #103#5  = #917#51;
             #103#6  = #917#52;
             #103#8  = #917#12;
             #103#9  = #917#44;
             #103#10 = #917#48;
             #103#11 = #917#49;
             #103#16 = #917#47;
             |GRABA 020#103n;
             |LIBERA #103;
         |FINSI;
     |FINSI;

     |BUCLE dsam0004w31;

     |CIERRA #103;
|FPRC;
