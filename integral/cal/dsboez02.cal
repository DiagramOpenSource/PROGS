|FICHEROS;
   dsboez02 #0;
   dsboem01 #1;
   dsboew01 #2;
   dsboem00 #3;
   dsboem03 #4;

   dsam0000 #10;
   :/laboral/def/labtraba  #11;

   :/contagen/def/caclipro #12;
   :/contagen/def/canempre #13;
|FIN;

|VARIABLES;
   &enSwLin = 0;
   aAlfa  = "";
   aAlfa1 = "";
   aAlfaP = "";
   aNif  = "";
   aInforme = "";
   nDAnyo = 0;
   nHAnyo = 0;
   fFecha = @;

   nHandle  = 0;
   nHandle1 = 0;

   nLinea   = 0;

   nSwAgicli  = 0;
   nSwLaboral = 0;
   nSwContab  = 0;
|FIN;

|PROCESO MiraRef;
   aAlfa = #dsboez02#0; |QBT aAlfa;
   aAlfa1 = #dsboez02#0; |QBF aAlfa1;
   |SI aAlfa ! aAlfa1;
      #dsboez02#0 = aAlfa;
      |MENAV "    Espacios en la referencia no permitidos";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO MiraTipo;
   |SI #dsboez02#1 = "E";
      |C_M #dsboez02#2, 1, "S";
   |SINO;
      #dsboez02#2 = 0; |PINTA #dsboez02#2;
      |C_M #dsboez02#2, 1, "N";
   |FINSI;
|FPRC;

|PROCESO Integral;
   #dsboem01#0 = #dsboez02#0;
   #dsboem01#1 = #dsam0000#3;
   #dsboem01#4 = "";
   |LEE 000#dsboem01.];
   |PARA; |SI FSalida = 0; |Y #dsboem01#0 = #dsboez02#0; |Y #dsboem01#1 = #dsam0000#3; |HACIENDO;
      |DDEFECTO #dsboew01;
      #dsboew01#0 = #dsboem01#0;
      #dsboew01#1 = #dsboem01#1;
      #dsboew01#15 = #dsboem01#4;
      |LEE 000#dsboew01.=;
      |SI FSalida ! 0;
         |DDEFECTO #dsboew01;
         #dsboew01#0 = #dsboem01#0;
         #dsboew01#1 = #dsboem01#1;
         #dsboew01#8 = #dsboem01#2;
         #dsboew01#15 = #dsboem01#4;
         |GRABA 020#dsboew01.c;
      |FINSI;
      #dsboew01#2 = #dsam0000#0;
      #dsboew01#9 = #dsam0000#1;
      #dsboew01#12 = #dsboem01#5;
      #dsboew01#13 = #dsboem01#6;
      #dsboew01#14 = #dsboem01#3;
      |GRABA 020#dsboew01.a;

      |LEE 000#dsboem01.s;
   |SIGUE;
|FPRC;

|DEFBUCLE Integral;
#dsam0000#1;
;
INICIO;
FINAL;
;
NULL, Integral;
|FIN;

|PROCESO Laboral;
   #dsboem01#0 = #dsboez02#0;
   #dsboem01#1 = #labtraba#7;
   #dsboem01#4 = "";
   |LEE 000#dsboem01.];
   |PARA; |SI FSalida = 0; |Y #dsboem01#0 = #dsboez02#0; |Y #dsboem01#1 = #labtraba#7; |HACIENDO;
      |DDEFECTO #dsboew01;
      #dsboew01#0  = #dsboem01#0;
      #dsboew01#1  = #dsboem01#1;
      #dsboew01#15 = #dsboem01#4;
      |LEE 000#dsboew01.=;
      |SI FSalida ! 0;
         |DDEFECTO #dsboew01;
         #dsboew01#0 = #dsboem01#0;
         #dsboew01#1 = #dsboem01#1;
         #dsboew01#8 = #dsboem01#2;
         #dsboew01#15 = #dsboem01#4;
         |GRABA 020#dsboew01.c;
      |FINSI;
      #dsboew01#3 = #labtraba#0;
      #dsboew01#4 = #labtraba#1;
      #dsboew01#10 = #labtraba#2;
      #dsboew01#12 = #dsboem01#5;
      #dsboew01#13 = #dsboem01#6;
      #dsboew01#14 = #dsboem01#3;
      |GRABA 020#dsboew01.a;

      |LEE 000#dsboem01.s;
   |SIGUE;
|FPRC;

|DEFBUCLE Laboral;
#labtraba#1;
;
INICIO;
FINAL;
;
NULL,Laboral;
|FIN;

|PROCESO BuscaNIF;
   aNif = #caclipro#9; aNif = aNif % 0112;

   #dsboem01#0 = #dsboez02#0;
   #dsboem01#1 = #caclipro#9;
   #dsboem01#4 = "";
   |LEE 000#dsboem01.];
   |PARA; |SI FSalida = 0; |Y #dsboem01#0 = #dsboez02#0; |Y #dsboem01#1 = aNif; |HACIENDO;
      |DDEFECTO #dsboew01;
      #dsboew01#0 = #dsboem01#0;
      #dsboew01#1 = #dsboem01#1;
      #dsboew01#15 = #dsboem01#4;
      |LEE 000#dsboew01.=;
      |SI FSalida ! 0;
         |DDEFECTO #dsboew01;
         #dsboew01#0 = #dsboem01#0;
         #dsboew01#1 = #dsboem01#1;
         #dsboew01#8 = #dsboem01#2;
         #dsboew01#15 = #dsboem01#4;
         |GRABA 020#dsboew01.c;
      |FINSI;
      #dsboew01#5 = #canempre#2;
      #dsboew01#6 = #canempre#3;
      #dsboew01#7 = #caclipro#10;
      #dsboew01#11 = #caclipro#1;
      #dsboew01#12 = #dsboem01#5;
      #dsboew01#13 = #dsboem01#6;
      #dsboew01#14 = #dsboem01#3;
      |GRABA 020#dsboew01.a;

      |LEE 000#dsboem01.s;
   |SIGUE;
|FPRC;

|DEFBUCLE BuscaNIF;
#caclipro#1;
;
"C", "            ";
"C", "zzzzzzzzzzzz";
;
NULL, BuscaNIF;
|FIN;

|PROCESO Contabilidad;
   |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "contagen/fich/";
   aAlfa = aAlfa + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";
   |PATH_DAT #caclipro#aAlfa#;

   |BUCLE BuscaNIF;
|FPRC;

|DEFBUCLE Contabilidad;
#canempre#1;
26;
00000, 0, nDAnyo;
99999, 9, nHAnyo;
;
NULL,Contabilidad;
|FIN;

|PROCESO Temporal;
   |SI PARAMETRO ! "";
      |SALVA_FICHA #dsboew01;
      |LEE 000#dsboew01.s;
      |SI FSalida = 0;
         aNif = #dsboew01#1;
      |SINO;
         aNif = "";
      |FINSI;
      |REPON_FICHA #dsboew01;

      |SI #dsboew01#2 ! 0;                     nSwAgicli  = 1; |FINSI;
      |SI #dsboew01#3 ! 0; |O #dsboew01#4 ! 0; nSwLaboral = 1; |FINSI;
      |SI #dsboew01#5 ! 0; |O #dsboew01#6 ! 0; nSwContab  = 1; |FINSI;

      nLinea = nLinea + 1;
      |SI nLinea = 1;
         aAlfa = #dsboew01#8; aAlfa = aAlfa % 0144;
         aAlfa = " " + #dsboew01#1 + " " + aAlfa + " ";
      |SINO;
         aAlfa = " " * 65;
      |FINSI;
      aAlfa = aAlfa + #dsboew01#12 + "  " + #dsboew01#13 + " ";
      aAlfa = aAlfa + #dsboew01#15 + "  ";
      aAlfaP = #dsboew01#14; aAlfaP = aAlfaP % 0146;
      aAlfa = aAlfa + aAlfaP + &13 + &10;
      |XGRABA nHandle, aAlfa;

      |SI aNif ! #dsboew01#1;
         |SI nSwAgicli  = 1;
            aAlfa = "          Ficha general de clientes : .......................... ";
            aAlfa = aAlfa + (("00000" + #dsboew01#2) % -105) + " " + #dsboew01#9 + &13 + &10;
            |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI nSwLaboral = 1;
            aAlfa = "          Laboral : ................. Empresa ";
            aAlfa = aAlfa + (("00000" + #dsboew01#3) % -105) + " / " + (("00000" + #dsboew01#4) % -105);
            aAlfa = aAlfa + " " + #dsboew01#10 + &13 + &10;
            |XGRABA nHandle, aAlfa;
         |FINSI;
         |SI nSwContab  = 1;
            aAlfa = "          Contabilidad : Empresa ";
            aAlfa = aAlfa + (("00000" + #dsboew01#5) % -105) + " / Periodo " + #dsboew01#6;
            aAlfa = aAlfa + " Cuenta " + #dsboew01#7 + " " + #dsboew01#11 + &13 + &10;
            |XGRABA nHandle, aAlfa;
         |FINSI;
         nSwAgicli  = 0; nSwLaboral = 0; nSwContab  = 0;
         aAlfa = " " + &13 + &10; |XGRABA nHandle, aAlfa;
         nLinea = 0;
      |FINSI;
   |SINO;
      |PRINT;
   |FINSI;
|FPRC;

|DEFBUCLE Temporal;
#dsboew01#1;
;
INICIO;
FINAL;
;
NULL, Temporal;
|FIN;

|PROGRAMA;
   |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #dsboem00#aAlfa#; |PATH_DAT #dsboem01#aAlfa#;

   |ABRE #dsboem00;
   |SELECT #2#dsboem00;
   |LEE 000#dsboem00.u;
   #dsboez02#0 = #dsboem00#0;
   |SELECT #1#dsboem00;

   |SI PARAMETRO = "";
      |CLS;
      |CABEZA "";

      |PINPA #0#0; |PINDA #0#0;
      |ENDATOS #1#0;
   |SINO;
      |ABRE #dsboem03;
      |LEE 000#dsboem03.p;
      |SI FSalida ! 0; |DDEFECTO #dsboem03; |FINSI;

      aAlfa = PARAMETRO;
      #dsboez02#0 = PARAMETRO;
      #dsboez02#1 = #dsboem03#12;
      #dsboez02#2 = #dsboem03#13;
      |CIERRA #dsboem03;
      FSalida = 0;
   |FINSI;
   |SI FSalida = 0;
      aAlfa = "lc" + Usuario; |NOME_DAT #dsboew01#aAlfa#;
      |DELINDEX #dsboew01; |ABRE #dsboew01;

      aAlfa = #dsboem00#6; |QBF aAlfa;
      |SI aAlfa ! ""; |NOME_DAT #dsboem00#aAlfa#; |FINSI;
      |ABRE #dsboem01; |SELECT #2#dsboem01;

      |BUCLE Integral;
      |BUCLE Laboral;

      nDAnyo = 0; nHAnyo = 9999;
      |SI #dsboez02#1 = "A";
         fFecha = ~; aAlfa = fFecha;
         aAlfa = aAlfa % -102;
         nDAnyo = aAlfa; nHAnyo = aAlfa;
      |FINSI;
      |SI #dsboez02#1 = "E";
         aAlfa = #dsboez02#2; |QBF aAlfa; aAlfa = aAlfa % -102;
         nDAnyo = aAlfa; nHAnyo = aAlfa;
      |FINSI;
      |SI #dsboez02#1 = "T";
         nDAnyo = 0; nHAnyo = 9999;
      |FINSI;
      |BUCLE Contabilidad;
      |LEE 000#dsboew01.p;
      |SI FSalida = 0;
         |SI PARAMETRO ! "";
            |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "boecom/";
            aAlfa = aAlfa + "informe.txt";
            |XABRE "WB", aAlfa, nHandle1;
            |SI FSalida ] 0;
               #dsboem00#0 = #dsboez02#0;
               |LEE 000#dsboem00.=;
               |SI FSalida ! 0; |DDEFECTO #dsboem00; |FINSI;

               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = "  COINCIDENCIAS BOECOM                                ";
               aAlfa = aAlfa + "                                             ";
               aAlfa = aAlfa + "                             Fecha listado : " + &13 + &10;
               |XGRABA nHandle1, aAlfa;
               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = "    Referencia : " + #dsboem00#0 + "    " + #dsboem00#1;
               aAlfa = aAlfa + "       Fecha referencia : " + #dsboem00#2 + &13 + &10;
               |XGRABA nHandle1, aAlfa;
               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = " NIF          Nombre                                             ";
               aAlfa = aAlfa + "Org.responsable  Lugar  Expediente    Procedimiento" + &13 + &10;
               |XGRABA nHandle1, aAlfa;
               aAlfa = " " + ("-" * 152) + &13 + &10; |XGRABA nHandle1, aAlfa;
               nSwAgicli  = 0; nSwLaboral = 0; nSwContab  = 0;
               |BUCLE Temporal;

               |XCIERRA nHandle1;
            |FINSI;
         |SINO;
            Impresora = "CrystalReport";
            aInforme = "dsboez02";
            |IMPRE -1;
            |SI FSalida = 0;
               |INFOR aInforme;
               |SI FSalida = 0;
                  #dsboem00#0 = #dsboez02#0;
                  |LEE 000#dsboem00.=;
                  |SI FSalida ! 0; |DDEFECTO #dsboem00; |FINSI;
                  |BUCLE Temporal;
                  |PIEINF; |FININF;
               |FINSI;
               |FINIMP;
            |FINSI;
         |FINSI;
      |SINO;
         |SI PARAMETRO = "";
            |MENAV "    No existen coincidencias";
         |SINO;
            #dsboem00#0 = #dsboez02#0;
            |LEE 000#dsboem00.=;
            |SI FSalida ! 0; |DDEFECTO #dsboem00; |FINSI;

            |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "boecom/";
            aAlfa = aAlfa + "informe.txt";
            |XABRE "WB", aAlfa, nHandle1;
            |SI FSalida ] 0;
               #dsboem00#0 = #dsboez02#0;
               |LEE 000#dsboem00.=;
               |SI FSalida ! 0; |DDEFECTO #dsboem00; |FINSI;

               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = "  COINCIDENCIAS BOECOM                                ";
               aAlfa = aAlfa + "                                             ";
               aAlfa = aAlfa + "                             Fecha listado : " + &13 + &10;
               |XGRABA nHandle1, aAlfa;
               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = "    Referencia : " + #dsboem00#0 + "    " + #dsboem00#1 + "       Fecha referencia : " + #dsboem00#2 + &13 + &10;
               |XGRABA nHandle1, aAlfa;
               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = " NIF          Nombre                                             Org.responsable  Lugar  Expediente    Procedimiento" + &13 + &10;
               |XGRABA nHandle1, aAlfa;
               aAlfa = " " + ("-" * 152) + &13 + &10; |XGRABA nHandle, aAlfa;
               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = " No se encontraron coincidencias " + &13 + &10; |XGRABA nHandle1, aAlfa;
               aAlfa = " " + &13 + &10; |XGRABA nHandle1, aAlfa;
               |XCIERRA nHandle1;
            |FINSI;
         |FINSI;
      |FINSI;

      |SELECT #1#dsboem01; |CIERRA #dsboem01;
      |CIERRA #dsboew01;
   |FINSI;
   |CIERRA #dsboem00;
|FPRO;
