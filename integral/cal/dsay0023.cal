|FICHEROS;
    dsay0023;

    dsam0000;
    dsam0025;
    dsam0105;
    dsam0125;

    dsat0005;

   :laboral/nomconca;
|FIN;

|VARIABLES;
     aAlfa     = "";
     aFichero  = "";

     aParam    = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;
     aColabora = "";
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     aDLiqu1   = "";
     aHLiqu1   = "";
     aDLiqu2   = "";
     aHLiqu2   = "";
     nDEmpresa = 0;
     nHEmpresa = 0;
     nDAgente  = 0;
     nHAgente  = 0;
     nDConve   = 0;
     nHConve   = 0;
     aBlancs   = "";
     aZetas    = "";

     nEmpresa  = 0;
     nEjer     = 0;
     nAlgun    = 0;
     nHay      = 0;
     nInkey    = 0;

     aBase     = "";
     aDef      = "";
     nCanal    = 0;
     aPath     = "";

     nCamp2  = 0;
     nCamp3  = 0;
     aCamp4  = "";
     fCamp5  = @;
     fCamp6  = @;
     fCamp7  = @;
     nCamp8  = 0;
     nCamp9  = 0;
     nCamp10 = 0;
     nCamp11 = 0;
     nCamp12 = 0;
     aCamp13 = "";
     fCamp14 = @;
     nCamp15 = 0;
     aCamp16 = "";
     nCamp17 = 0;
     nCamp18 = 0;
     aCamp19 = "";
     fCamp20 = @;
     nCamp21 = 0;
     aCamp22 = "";
     nCamp23 = 0;
     nCamp24 = 0;
     aCamp25 = "";
     aCamp26 = "";
     fCamp27 = @;
     aCamp33 = "";

     nTipoInf  = 0;
     informe     = "";
     inform1     = "";
     inform2     = "";
     inform3     = "";

     &eaPathLaboral = "";

     &eSwLinea   = 0;
     &enConvenio = 0;
     &eaConveni1 = "";
     &eaConvenio = "";

     &enEmpPD  = 0;
     &eaEmpPD  = "";
     &eaEmpPD1 = "";
     &eaTfnPD  = "";

     &enTotal1 = 0;
     &enTotal2 = 0;
     &enTotal3 = 0;

     &enMes      = 0;
     &eaMes      = "";
     &efFecha    = @;
     &eaTitul    = "";
     &eaTitulo   = "";
     &eaTitul1   = "";
     &eaTitul2   = "";
     &eaTitul3   = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpresa  = 0;
|FIN;

|CALCULO HEmpresa; |TIPO 0;
    |SI #dsay0023#4 < #dsay0023#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsay0023#6 < #dsay0023#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsay0023#8 < #dsay0023#7;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO DConvenio; |TIPO 0;
    nInkey = FSalida;

    |SI nInkey = 10;
        eaPathLaboral = "";
        |DBASS aBase;
        aAlfa = aBase + "laboral/def/labempre.mas";

        |XABRE "E", aAlfa, nCanal;
        |SI FSalida ] 0;
            eaPathLaboral   = aBase + "laboral/";
        |SINO;
            |MENAV "0000No existe laboral";
            |ACABA;
        |FINSI;

        aPath = eaPathLaboral + "fich/";
        |PATH_DAT #nomconca#aPath#;

        |ABRE #nomconca;
        #nomconca#0 = #dsay0023#Campo#;
        |CONSULTA_CLAVE #1#nomconca;
        #dsay0023#Campo#  = #nomconca#0;
        |PINTA #dsay0023#Campo#;
    |FINSI;

    |SI #dsay0023#15 < #dsay0023#14; |Y Campo = 15;
        |MENAV "0000Error. Hasta Convenio inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO Tipo7C10; |TIPO 7;
    aAlfa = "0000Ordenar por: C(O)nvenio, (C)odigo Cliente, (N)ombre Cliente, (E)mp.Aseguradora";
    |SI nTipoInf = 1;
        aAlfa = "0000Ordenar por: (O) Convenio, (C) Cliente, (N) Nombre Cliente ";
    |FINSI;
    |MENSA aAlfa;
|FCAL;

|CALCULO Tipo0C10; |TIPO 0;
    |SI nTipoInf = 1; |Y #dsay0023#10 = "E";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO Imprimir;

   |SI nHay = 0;
       enEmpresa = #dsat0005#0;
       enConvenio = #dsat0005#2;
       eaConvenio = #dsat0005#25;
       eaConveni1 = ("000" + #dsat0005#2) % -103;
       enEmpPD  = #dsat0005#3;
       eaEmpPD  = #dsat0005#4;
       eaEmpPD1 = ("000" + #dsat0005#3) % -103;
       eaTfnPD  = #dsat0005#33;
       eSwLinea = 0;
   |FINSI;

   |SI #dsay0023#10 = "O";
       |SI enConvenio ! #dsat0005#2;
           |SI nHay = 1;
               eSwLinea = 2;
               |SI nTipoInf > 3; |PRINT; |FINSI;
           |FINSI;
           enEmpresa = #dsat0005#0;
           enConvenio = #dsat0005#2;
           eaConvenio = #dsat0005#25;
           eaConveni1 = ("000" + #dsat0005#2) % -103;
           enEmpPD  = #dsat0005#3;
           eaEmpPD  = #dsat0005#4;
           eaEmpPD1 = ("000" + #dsat0005#3) % -103;
           eaTfnPD  = #dsat0005#33;
           eSwLinea = 0;
           enTotal1  = 0;
           enTotal2  = 0;
           enTotal3  = 0;
       |FINSI;
   |FINSI;
   |SI #dsay0023#10 = "E";
       |SI enEmpPD ! #dsat0005#3;
           |SI nHay = 1;
               eSwLinea = 2;
           |FINSI;
           enEmpPD  = #dsat0005#3;
           eaEmpPD  = #dsat0005#4;
           eaEmpPD1 = ("000" + #dsat0005#3) % -103;
           eaTfnPD  = #dsat0005#33;
           eSwLinea  = 0;
           enTotal1  = 0;
           enTotal2  = 0;
           enTotal3  = 0;
       |FINSI;
   |FINSI;

   |SI #dsay0023#10 = "C"; |O #dsay0023#10 = "N";
       |SI enEmpresa ! #dsat0005#0;
           eSwLinea = 0;
           enEmpresa = #dsat0005#0;
       |FINSI;
   |FINSI;

   |SI nTipoInf = 3;
   |FINSI;

   |PRINT;
   eSwLinea = 1;
   nHay     = 1;
   enTotal1 = enTotal1 + #dsat0005#11;
   enTotal2 = enTotal2 + #dsat0005#19;
   enTotal3 = enTotal3 + #dsat0005#20;
|FPRC;

|DEFBUCLE Leedsat0005_E;
   #dsat0005#2;
   ;
   #dsay0023#3, nDEmpresa, enEjer, nDConve;
   #dsay0023#4, nHEmpresa, enEjer, nHConve;
   ;
   NULL, Imprimir;
|FIN;

|DEFBUCLE Leedsat0005_O;
   #dsat0005#3;
   ;
   nDConve, enEjer, nDEmpresa;
   nHConve, enEjer, nHEmpresa;
   ;
   NULL, Imprimir;
|FIN;

|DEFBUCLE Leedsat0005_C;
   #dsat0005#1;
   ;
   nDEmpresa, enEjer, nDConve;
   nHEmpresa, enEjer, nHConve;
   ;
   NULL, Imprimir;
|FIN;

|DEFBUCLE Leedsat0005_N;
   #dsat0005#4;
   ;
   aBlancs, nDEmpresa, enEjer, nDConve;
   aZetas,  nHEmpresa, enEjer, nHConve;
   ;
   NULL, Imprimir;
|FIN;

|PROCESO ImprimirDatos;
    aBlancs = " " * 40;
    aZetas  = "z" * 40;

    informe = inform1;
    |SI #dsay0023#10 = "O"; informe = inform2; |FINSI;
    |SI #dsay0023#10 = "E"; informe = inform3; |FINSI;

    |IMPRE 0;
    |SI FSalida ! 0;
        |MENAV "0000Proceso Interrumpido";
        |ACABA;
    |FINSI;
    |INFOR informe;
    |SI FSalida ! 0;
        |MENAV "0000No existe informe. Proceso Interrumpido";
        |FINIMP;
        |ACABA;
    |FINSI;

    nHay     = 0;
    enConvenio = 0;
    eaConvenio = "";
    eaConveni1 = "";
    enEmpPD  = 0;
    eaEmpPD  = "";
    eaEmpPD1 = "";
    eaTfnPD  = "";
    enTotal1 = 0;
    enTotal2 = 0;
    enTotal3 = 0;

    |SI #dsay0023#10 = "O"; |BUCLE Leedsat0005_O; |FINSI;
    |SI #dsay0023#10 = "E"; |BUCLE Leedsat0005_E; |FINSI;
    |SI #dsay0023#10 = "C"; |BUCLE Leedsat0005_C; |FINSI;
    |SI #dsay0023#10 = "N"; |BUCLE Leedsat0005_N; |FINSI;
    |SI nHay ! 0;
        eSwLinea = 2;
        |SI #dsay0023#10 ! "C"; |Y #dsay0023#10 ! "N";
            |SI nTipoInf > 3; |PRINT; |FINSI;
        |FINSI;
        |PIEINF;
    |FINSI;
    |FININF;
    |FINIMP;
|FPRC;

|| *******************************************************************
|PROCESO GrabaAuxiliar1;
    #dsat0005#0 = nEmpresa;
    #dsat0005#1 = enEjer;
    #dsat0005#2 = nCamp2;
    |LEE 141#dsat0005.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0005;
        #dsat0005#0 = nEmpresa;
        #dsat0005#1 = enEjer;
        #dsat0005#2 = nCamp2;
        |GRABA 020#dsat0005.b;
    |FINSI;

    #dsat0005#3  = nCamp3;
    #dsat0005#4  = aCamp4;
    #dsat0005#5  = fCamp5;
    #dsat0005#6  = fCamp6;
    #dsat0005#7  = fCamp7;
    #dsat0005#8  = nCamp8;
    #dsat0005#9  = nCamp9;
    #dsat0005#10 = nCamp10;
    #dsat0005#11 = nCamp11;
    #dsat0005#12 = nCamp12;
    #dsat0005#13 = aCamp13;
    #dsat0005#14 = fCamp14;
    #dsat0005#15 = nCamp15;
    #dsat0005#16 = aCamp16;
    #dsat0005#17 = nCamp17;
    #dsat0005#18 = nCamp18;
    #dsat0005#19 = aCamp19;
    #dsat0005#20 = fCamp20;
    #dsat0005#21 = nCamp21;
    #dsat0005#22 = aCamp22;
    #dsat0005#23 = nCamp23;
    #dsat0005#24 = nCamp24;
    #dsat0005#25 = aCamp25;
    #dsat0005#26 = aCamp26;
    #dsat0005#27 = fCamp27;

    #dsat0005#28 = #dsam0000#1;
    #dsat0005#29 = #dsam0000#54;
    #dsat0005#30 = #dsam0000#72;
    #dsat0005#31 = #dsam0000#52;
    #dsat0005#33 = aCamp33;
    #dsat0005#34 = #dsam0000#3;

    |GRABA 020#dsat0005.a;
    |LIBERA #dsat0005;
    nAlgun = 1;
|FPRC;
|| *******************************************************************
|PROCESO BorraVariables;
     nCamp2  = 0;
     nCamp3  = 0;            aCamp4  = "";
     fCamp5  = "01.01.0000"; fCamp6  = "01.01.0000";
     fCamp7  = "01.01.0000"; nCamp8  = 0;
     nCamp9  = 0;            nCamp10 = 0;
     nCamp11 = 0;            nCamp12 = 0;
     aCamp13 = "";
     fCamp14 = "01.01.0000"; nCamp15 = 0;
     aCamp16 = "";           nCamp17 = 0;
     nCamp18 = 0;
     aCamp19 = "";
     fCamp20 = "01.01.0000"; nCamp21 = 0;
     aCamp22 = "";           nCamp23 = 0;
     nCamp24 = 0;
     aCamp25 = "";           aCamp26 = "";
     fCamp27 = "01.01.0000";
     aCamp33 = "";
|FPRC;

|PROCESO LeeDatosM025;

    nGraba    = 0;
    aColabora = "N";
    aCamp33   = "";
    |DDEFECTO #dsam0125;
    #dsam0125#0 = #dsam0025#3;
    |LEE 041#dsam0125.=;
    |SI FSalida = 0;
        aColabora = #dsam0125#3;
        aCamp33   = #dsam0125#5;
    |FINSI;

    |SI nTipoInf = 1;
        nHay = 1;
        enConvenio = #dsam0025#2;
        |SI #dsam0025#3 = 0;
            nGraba  = 1;
        |FINSI;
    |FINSI;

    |SI nTipoInf = 2;
        |SI #dsam0025#3 ] #dsay0023#3; |Y #dsam0025#3 [ #dsay0023#4;
            |SI #dsam0025#8 = 0; |Y #dsay0023#13 ! "R";
                nGraba = 1;
                |SI #dsay0023#11 ! "T"; |Y #dsay0023#11 ! aColabora;
                    nGraba = 0;
                |FINSI;
            |FINSI;
            |SI #dsam0025#9 = 0; |Y #dsay0023#13 ! "P";
                nGraba = 1;
                |SI #dsay0023#11 ! "T"; |Y #dsay0023#11 ! aColabora;
                    nGraba = 0;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;

    |SI nTipoInf = 3;
    |FINSI;

    |SI nTipoInf = 4;
        |SI #dsam0025#3 ] #dsay0023#3; |Y #dsam0025#3 [ #dsay0023#4;
            nGraba = 1;
            |SI #dsay0023#9 ! "T"; |Y #dsay0023#13 ! "R";
               |Y #dsay0023#9 ! #dsam0025#13;
                nGraba = 0;
            |FINSI;
            |SI #dsay0023#9 ! "T"; |Y #dsay0023#13 ! "P";
               |Y #dsay0023#9 ! #dsam0025#19;
                nGraba = 0;
            |FINSI;
            |SI #dsay0023#11 ! "T"; |Y #dsay0023#11 ! aColabora;
                nGraba = 0;
            |FINSI;
        |FINSI;
    |FINSI;

    |SI #dsam0025#2 = 0;
         #dsam0025#25 = "Convenio no definido en la empresa";
     |FINSI;

     |SI nGraba = 1;
         nCamp2  = #dsam0025#2;
         nCamp3  = #dsam0025#3;
         aCamp4  = #dsam0025#4;
         fCamp5  = #dsam0025#5;
         fCamp6  = #dsam0025#6;
         fCamp7  = #dsam0025#7;
         nCamp8  = #dsam0025#8;
         nCamp9  = #dsam0025#9;
         nCamp10 = #dsam0025#10;
         nCamp11 = #dsam0025#11;
         nCamp12 = #dsam0025#12;
         aCamp13 = #dsam0025#13;
         fCamp14 = #dsam0025#14;
         nCamp15 = #dsam0025#15;
         aCamp16 = #dsam0025#16;
         nCamp17 = #dsam0025#17;
         nCamp18 = #dsam0025#18;
         aCamp19 = #dsam0025#19;
         fCamp20 = #dsam0025#20;
         nCamp21 = #dsam0025#21;
         aCamp22 = #dsam0025#22;
         nCamp23 = #dsam0025#23;
         nCamp24 = #dsam0025#24;
         aCamp25 = #dsam0025#25;
         aCamp26 = #dsam0025#26;
         fCamp27 = #dsam0025#27;
         |HAZ GrabaAuxiliar1;
    |FINSI;
|FPRC;

|DEFBUCLE dsam0025;
   #dsam0025#1;
   13,19;
   nEmpresa, enEjer, nDConve, aDLiqu1, aDLiqu2;
   nEmpresa, enEjer, nHConve, aHLiqu1, aHLiqu2;
   e;
   NULL, LeeDatosM025;
|FIN;

|PROCESO LeoDsam0000;
   |HAZ BorraVariables;

   nHay       = 0;
   nEmpresa   = #dsam0000#0;
   enConvenio = 0;

   |BUCLE dsam0025;
   |SI nTipoInf = 1; |Y nHay = 0; |Y enConvenio = 0;
       nCamp2  = 0;
       aCamp25 = "Convenio no definido en la empresa";
       |HAZ GrabaAuxiliar1;
   |FINSI;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   123,72;
   nDEmpresa, "S", nDAgente;
   nHEmpresa, "S", nHAgente;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO ProcesoY023;

     aFichero = ("4c" + Usuario) % 108;
     |NOME_DAT #dsat0005#aFichero#;
     |DELINDEX #dsat0005;

     aAlfa1 = #dsay0023#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     eaTitulo = #dsay0023#12;
     enEjer  = #dsay0023#0;
     efFecha  = #dsay0023#16;

     aDLiqu1 = " ";  aDLiqu2 = " ";
     aHLiqu1 = "z";  aHLiqu2 = "z";

     |SI #dsay0023#13 ! "R"; |Y #dsay0023#9 ! "T";
         aDLiqu1 = #dsay0023#9;
         aHLiqu1 = #dsay0023#9;
     |FINSI;
     |SI #dsay0023#13 ! "P"; |Y #dsay0023#9 ! "T";
         aDLiqu2 = #dsay0023#9;
         aHLiqu2 = #dsay0023#9;
     |FINSI;

     nDEmpresa = #dsay0023#5;
     nHEmpresa = #dsay0023#6;
     nDAgente  = #dsay0023#7;
     nHAgente  = #dsay0023#8;
     nDConve   = #dsay0023#14;
     nHConve   = #dsay0023#15;

     |ABRE #dsat0005;
     nAlgun = 0;
     nGraba = 0;
     |ABRE #dsam0125;
     |BUCLE dsam0000;
     |CIERRA #dsam0125;
     |CIERRA #dsat0005;

     |SI nAlgun = 1;
/*
        |ABRE #dsat0005;
        |CONSULTA_CLAVE #1#dsat0005;
        |CIERRA  #dsat0005;
*/
         |HAZ ImprimirDatos;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsat0005;
|FPRC;

|PROGRAMA;

    aFuncion = "a";
    aParam   = PARAMETRO;
    nTipoInf = aParam; |SI nTipoInf = 0; nTipoInf = 4; |FINSI;
    |SI nTipoInf = 1;
        aAlfa1  = "Clientes Obligados a formalizar un Seg. de Convenio Sin Empresa Aseguradora asignada ";
        eaTitul = "Sin Empresa Aseguradora asignada ";
        |C_V #dsay0023#3,  1, "N";
        |C_V #dsay0023#4,  1, "N";
        |C_V #dsay0023#11, 1, "N";
        |C_V #dsay0023#13, 1, "N";
        inform1 = "dsay1023";
        inform2 = "dsay1a23";
        inform3 = "";
    |FINSI;
    |SI nTipoInf = 2;
        aAlfa1  = "Clientes Obligados a formalizar un Seg.Conv. Sin Importe poliza y/o regularizacion ";
        eaTitul = "Sin Importe poliza y/o regularizacion en el Ejercicio ";
        inform1 = "dsay2023";
        inform2 = "dsay2a23";
        inform3 = "dsay2b23";
    |FINSI;
    |SI nTipoInf = 4;
        aAlfa1  = "Informe General de Clientes con Seguro de Convenio concertado";
        eaTitul = "Informe General ";
        |C_V #dsay0023#9, 1, "S";
        inform1 = "dsay4023";
        inform2 = "dsay4a23";
        inform3 = "dsay4b23";
    |FINSI;
    aAlfa1 = aAlfa1 > " ";
    eaTitul1 = "Seguros de Convenio";

    |CLS;
    |CABEZA "Inf. Seguros de Convenio";

    #dsay0023#12 = aAlfa1;
    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsay0023#0 = aAlfa;

    |PINPA #0#dsay0023;
    |ATRI R; |PINTA 0714, eaTitul; |ATRI 0;
    |SI nTipoInf = 4;
        |ATRI P;
        |PINTA 1316, "Liquidados (S/N/T) ...:";
        |ATRI 0;
    |FINSI;
    |SI nTipoInf = 1;
        |PINTA 1241, "                           ";
        |PINTA 1435, ") .";
        |PINTA 1714, "À"; |PINTA 1768, "Ù";
        |BLANCO 1810 2170;
    |FINSI;

    |PINDA #0#dsay0023;

    |ENDATOS #2#dsay0023;
    |SI FSalida = 0;
        |HAZ ProcesoY023;
    |FINSI;
|FPRO;
